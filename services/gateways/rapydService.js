'use strict';const a50_0x33e864=a50_0x3335;(function(_0x7af94f,_0x2e3109){const _0x3d44b7=a50_0x3335,_0x36bb2d=_0x7af94f();while(!![]){try{const _0x519a93=parseInt(_0x3d44b7(0x107))/0x1*(parseInt(_0x3d44b7(0xd4))/0x2)+parseInt(_0x3d44b7(0xd5))/0x3+parseInt(_0x3d44b7(0xd8))/0x4+parseInt(_0x3d44b7(0x10d))/0x5+parseInt(_0x3d44b7(0xdf))/0x6+-parseInt(_0x3d44b7(0xfb))/0x7+-parseInt(_0x3d44b7(0x122))/0x8*(-parseInt(_0x3d44b7(0xfa))/0x9);if(_0x519a93===_0x2e3109)break;else _0x36bb2d['push'](_0x36bb2d['shift']());}catch(_0x7eeb66){_0x36bb2d['push'](_0x36bb2d['shift']());}}}(a50_0x29e3,0x75f71));function a50_0x29e3(){const _0x3a3981=['429909zPcZiV','status','🔄\x20Rapyd\x20webhook\x20processed:\x20status=','1251876Lciadg','last4','EUR','/v1/hosted/payment_links/','logWhiteDomainError','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','Rapyd\x20API\x20error\x20(','822372tiCYsP','CAN','stringify','Unknown\x20error\x20from\x20Rapyd\x20API','payment_method_type','toUpperCase','fixed_side','data','PAYMENT_EXPIRED','🇬🇧\x20Country\x20used:\x20','verifyPayment','PAYMENT_FAILED','):\x20','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Request\x20Body\x20(Updated\x20Format):','rapyd','https://tesoft.uk/gateway/success.php?id=','paid','UNKNOWN','ERR','Full\x20Error\x20Data:','URL:','💥\x20Rapyd\x20failure\x20message:\x20','\x20(GB\x20-\x20Britain)','failure_message','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','currency','9TqBLzQ','3778005gCXHfU','Headers:','text','\x20\x20\x20requested_currency:\x20EUR','logWhiteDomainResponse','expiration','EXP','SUCCESS','errorCode','CLO','logWhiteDomainRequest','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','1aMeElt','cardLast4','Processing\x20Rapyd\x20webhook:','🇬🇧\x20Country:\x20','PAID','Missing\x20id\x20or\x20redirect_url\x20in\x20response','28575wkVKNP','Response\x20Body:','error_code',',\x20body:\x20','FAILED','GET','now','Error\x20details:','payment_method_data','headers','\x20(always\x20GB\x20for\x20Rapyd)','processWebhook','Rapyd\x20API\x20error:\x20','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','error','Rapyd\x20payment\x20verification\x20error:','redirect_url','💱\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','createPaymentLink','PAYMENT_COMPLETED','Parsed\x20Result:','1488496ovgWzB','/v1/hosted/payment_links','toISOString','loggerService','TesSoft\x20Payment\x20System/1.0','PAYMENT_CANCELED','Unknown\x20error','stack','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','HTTP\x20','log','JSON\x20Parse\x20Error:\x20','__esModule','🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','failure_code','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','statusText','gb_visa_card','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','message',',\x20failureMessage=','EXPIRED','type','apiUrl','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','entries','https://tesoft.uk/gateway/rapyd/','Business\x20Error\x20(','Status\x20Text:','gb_mastercard_card','fromEntries','failureCode','Error\x20Code:','parse','HTTP\x20error!\x20status:\x20','POST','PENDING','RapydService','Payment\x20Link\x20ID:','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Error\x20Message:','Status:','Raw\x20Response\x20Body:','Redirect\x20URL:','ACT','475578KPKdJP'];a50_0x29e3=function(){return _0x3a3981;};return a50_0x29e3();}Object['defineProperty'](exports,a50_0x33e864(0x12e),{'value':!![]}),exports['RapydService']=void 0x0;function a50_0x3335(_0xf83cef,_0x537bad){const _0x29e399=a50_0x29e3();return a50_0x3335=function(_0x33358f,_0x23bdc3){_0x33358f=_0x33358f-0xcd;let _0x3477f6=_0x29e399[_0x33358f];return _0x3477f6;},a50_0x3335(_0xf83cef,_0x537bad);}const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x798d8f=a50_0x33e864;this[_0x798d8f(0x13a)]=_0x798d8f(0x13d),console[_0x798d8f(0x12c)](_0x798d8f(0xf8));}async[a50_0x33e864(0x11f)](_0x5ef6ca){const _0x329d4f=a50_0x33e864,{orderId:_0x59e434,orderName:_0x3b6765,amount:_0xf3b749,currency:_0x57ad52,usage:_0x41471b,maxPayments:_0x30bef4,successUrl:_0x1b475f,failUrl:_0x39daa9}=_0x5ef6ca,_0x203a11=_0x57ad52[_0x329d4f(0xe4)](),_0x3087db='GB';console['log'](_0x329d4f(0x12f));const _0xe2f4e7=_0x329d4f(0xef)+_0x59e434,_0x11ff46='https://tesoft.uk/gateway/fail.php?id='+_0x59e434,_0x4d77a4={'amount':_0xf3b749,'currency':_0x203a11,'cancel_checkout_url':_0x11ff46,'complete_checkout_url':_0xe2f4e7,'complete_payment_url':_0xe2f4e7,'merchant_reference_id':_0x59e434,'description':'ORDER:\x20'+_0x59e434,'country':'GB','payment_method_types_include':[_0x329d4f(0x134),_0x329d4f(0x140)],'custom_elements':{'display_description':!![]}};if(_0x203a11!==_0x329d4f(0xda)){const _0x5cf234=Math['floor'](Date[_0x329d4f(0x113)]()/0x3e8)+0x1e*0x3c;_0x4d77a4[_0x329d4f(0xe5)]='buy',_0x4d77a4['requested_currency']=_0x329d4f(0xda),_0x4d77a4[_0x329d4f(0x100)]=_0x5cf234,console[_0x329d4f(0x12c)](_0x329d4f(0x11e)+_0x203a11+'\x20->\x20EUR:'),console[_0x329d4f(0x12c)]('\x20\x20\x20fixed_side:\x20buy'),console[_0x329d4f(0x12c)](_0x329d4f(0xfe)),console['log']('\x20\x20\x20expiration:\x20'+_0x5cf234+'\x20('+new Date(_0x5cf234*0x3e8)[_0x329d4f(0x124)]()+')');}const _0x29fbe7=Date[_0x329d4f(0x113)]();try{console['log'](_0x329d4f(0x11a)),console['log'](_0x329d4f(0xf4),this[_0x329d4f(0x13a)]),console['log'](_0x329d4f(0xed),JSON[_0x329d4f(0xe1)](_0x4d77a4,null,0x2)),console[_0x329d4f(0x12c)](_0x329d4f(0x10a)+_0x3087db+_0x329d4f(0x117)),console[_0x329d4f(0x12c)](_0x329d4f(0xce)),loggerService_1['loggerService'][_0x329d4f(0x105)](_0x329d4f(0xee),_0x329d4f(0x123),_0x329d4f(0x146),_0x4d77a4);const _0x816577=await fetch(this[_0x329d4f(0x13a)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x4d77a4)}),_0x307f58=Date['now']()-_0x29fbe7;console['log'](_0x329d4f(0x106)),console['log'](_0x329d4f(0xd0),_0x816577['status']),console[_0x329d4f(0x12c)](_0x329d4f(0x13f),_0x816577[_0x329d4f(0x133)]),console[_0x329d4f(0x12c)](_0x329d4f(0xfc),Object[_0x329d4f(0x141)](_0x816577[_0x329d4f(0x116)][_0x329d4f(0x13c)]())),console['log']('Response\x20Time:',_0x307f58+'ms');const _0x523768=await _0x816577[_0x329d4f(0xfd)]();console[_0x329d4f(0x12c)](_0x329d4f(0xd1),_0x523768);if(!_0x816577['ok']){console[_0x329d4f(0x11b)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x329d4f(0x11b)]('HTTP\x20Status:',_0x816577[_0x329d4f(0xd6)]),console[_0x329d4f(0x11b)](_0x329d4f(0x10e),_0x523768),loggerService_1[_0x329d4f(0x125)]['logWhiteDomainResponse'](_0x329d4f(0xee),'/v1/hosted/payment_links',_0x816577[_0x329d4f(0xd6)],_0x523768,_0x307f58),loggerService_1[_0x329d4f(0x125)][_0x329d4f(0xdc)]('rapyd',_0x329d4f(0x123),_0x329d4f(0x12b)+_0x816577['status']+':\x20'+_0x523768);throw new Error(_0x329d4f(0x145)+_0x816577['status']+_0x329d4f(0x110)+_0x523768);}let _0x29caac;try{_0x29caac=JSON[_0x329d4f(0x144)](_0x523768);}catch(_0x88090b){console[_0x329d4f(0x11b)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x88090b),loggerService_1[_0x329d4f(0x125)][_0x329d4f(0xdc)](_0x329d4f(0xee),_0x329d4f(0x123),_0x329d4f(0x12d)+_0x88090b);throw new Error(_0x329d4f(0x12a)+_0x523768);}console[_0x329d4f(0x12c)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x329d4f(0x12c)](_0x329d4f(0x121),JSON[_0x329d4f(0xe1)](_0x29caac,null,0x2)),loggerService_1[_0x329d4f(0x125)][_0x329d4f(0xff)](_0x329d4f(0xee),_0x329d4f(0x123),_0x816577['status'],_0x29caac,_0x307f58);if(_0x29caac[_0x329d4f(0xd6)]?.['status']!=='SUCCESS'){const _0x1d6784=_0x29caac[_0x329d4f(0xd6)]?.[_0x329d4f(0x136)]||_0x329d4f(0xe2),_0x42bc96=_0x29caac[_0x329d4f(0xd6)]?.[_0x329d4f(0x10f)]||_0x329d4f(0xf1);console[_0x329d4f(0x11b)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x329d4f(0x11b)](_0x329d4f(0x143),_0x42bc96),console[_0x329d4f(0x11b)](_0x329d4f(0xcf),_0x1d6784),console[_0x329d4f(0x11b)](_0x329d4f(0xf3),_0x29caac[_0x329d4f(0xd6)]),loggerService_1[_0x329d4f(0x125)][_0x329d4f(0xdc)]('rapyd',_0x329d4f(0x123),_0x329d4f(0x13e)+_0x42bc96+_0x329d4f(0xeb)+_0x1d6784);throw new Error(_0x329d4f(0xde)+_0x42bc96+_0x329d4f(0xeb)+_0x1d6784);}if(!_0x29caac[_0x329d4f(0xe6)]?.['id']||!_0x29caac[_0x329d4f(0xe6)]?.[_0x329d4f(0x11d)]){console['error'](_0x329d4f(0xec)),console['error'](_0x329d4f(0x10c)),console[_0x329d4f(0x11b)]('Response\x20data:',_0x29caac[_0x329d4f(0xe6)]),loggerService_1['loggerService'][_0x329d4f(0xdc)](_0x329d4f(0xee),_0x329d4f(0x123),_0x329d4f(0x135));throw new Error(_0x329d4f(0x13b));}return console[_0x329d4f(0x12c)]('===\x20RAPYD\x20SUCCESS\x20==='),console[_0x329d4f(0x12c)](_0x329d4f(0xcd),_0x29caac[_0x329d4f(0xe6)]['id']),console['log'](_0x329d4f(0xd2),_0x29caac['data'][_0x329d4f(0x11d)]),console[_0x329d4f(0x12c)](_0x329d4f(0xe8)+_0x3087db+_0x329d4f(0xf6)),console[_0x329d4f(0x12c)]('💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x29caac[_0x329d4f(0xe6)]['id'],'payment_url':_0x29caac[_0x329d4f(0xe6)][_0x329d4f(0x11d)]};}catch(_0x493c04){console['error'](_0x329d4f(0xdd)),console['error'](_0x329d4f(0x114),_0x493c04),loggerService_1[_0x329d4f(0x125)][_0x329d4f(0xdc)](_0x329d4f(0xee),'/v1/hosted/payment_links',_0x493c04);if(_0x493c04 instanceof Error){console[_0x329d4f(0x11b)]('Error\x20message:',_0x493c04[_0x329d4f(0x136)]),console['error']('Error\x20stack:',_0x493c04[_0x329d4f(0x129)]);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x493c04[_0x329d4f(0x136)]);}throw new Error(_0x329d4f(0x132));}}async[a50_0x33e864(0xe9)](_0x4ce39f){const _0x14b5de=a50_0x33e864,_0x50d148=Date[_0x14b5de(0x113)]();try{loggerService_1['loggerService'][_0x14b5de(0x105)](_0x14b5de(0xee),'/v1/hosted/payment_links/'+_0x4ce39f,_0x14b5de(0x112),{});const _0x35f6e1=await fetch(this[_0x14b5de(0x13a)]+'/'+_0x4ce39f,{'method':_0x14b5de(0x112),'headers':{'Content-Type':'application/json','User-Agent':_0x14b5de(0x126)}}),_0x4c3550=Date[_0x14b5de(0x113)]()-_0x50d148;if(!_0x35f6e1['ok']){const _0x2e7475=await _0x35f6e1['text']();loggerService_1[_0x14b5de(0x125)][_0x14b5de(0xff)](_0x14b5de(0xee),_0x14b5de(0xdb)+_0x4ce39f,_0x35f6e1[_0x14b5de(0xd6)],_0x2e7475,_0x4c3550);throw new Error(_0x14b5de(0x145)+_0x35f6e1[_0x14b5de(0xd6)]);}const _0x22f924=await _0x35f6e1['json']();loggerService_1[_0x14b5de(0x125)][_0x14b5de(0xff)]('rapyd',_0x14b5de(0xdb)+_0x4ce39f,_0x35f6e1[_0x14b5de(0xd6)],_0x22f924,_0x4c3550);if(_0x22f924[_0x14b5de(0xd6)]?.[_0x14b5de(0xd6)]!==_0x14b5de(0x102)){loggerService_1[_0x14b5de(0x125)][_0x14b5de(0xdc)](_0x14b5de(0xee),_0x14b5de(0xdb)+_0x4ce39f,_0x14b5de(0x119)+(_0x22f924[_0x14b5de(0xd6)]?.['message']||_0x14b5de(0x128)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x22f924[_0x14b5de(0xd6)]?.['message']||_0x14b5de(0x128)));}let _0x194aa6=_0x14b5de(0x147);if(_0x22f924['data']?.['status'])switch(_0x22f924[_0x14b5de(0xe6)][_0x14b5de(0xd6)][_0x14b5de(0xe4)]()){case _0x14b5de(0x104):_0x194aa6=_0x14b5de(0x10b);break;case _0x14b5de(0xe0):_0x194aa6=_0x14b5de(0x111);break;case _0x14b5de(0x101):_0x194aa6='EXPIRED';break;case _0x14b5de(0xf2):_0x194aa6=_0x14b5de(0x111);break;case'NEW':case _0x14b5de(0xd3):default:_0x194aa6='PENDING';break;}return{'status':_0x194aa6,'amount':_0x22f924['data']?.['amount'],'currency':_0x22f924[_0x14b5de(0xe6)]?.['currency']};}catch(_0x435cd6){console['error'](_0x14b5de(0x11c),_0x435cd6),loggerService_1['loggerService'][_0x14b5de(0xdc)](_0x14b5de(0xee),_0x14b5de(0xdb)+_0x4ce39f,_0x435cd6);throw new Error(_0x14b5de(0x130)+(_0x435cd6 instanceof Error?_0x435cd6['message']:_0x14b5de(0x128)));}}async[a50_0x33e864(0x118)](_0x1a811e){const _0x2e0a45=a50_0x33e864;console[_0x2e0a45(0x12c)](_0x2e0a45(0x109),_0x1a811e);let _0x359b5e='PENDING',_0x1305ea;_0x1a811e[_0x2e0a45(0xe6)]?.[_0x2e0a45(0xf7)]&&(_0x1305ea=_0x1a811e[_0x2e0a45(0xe6)][_0x2e0a45(0xf7)],console[_0x2e0a45(0x12c)](_0x2e0a45(0xf5)+_0x1305ea));switch(_0x1a811e[_0x2e0a45(0x139)]?.[_0x2e0a45(0xe4)]()){case _0x2e0a45(0x120):_0x1a811e[_0x2e0a45(0xe6)]?.[_0x2e0a45(0xf0)]===!![]&&_0x1a811e[_0x2e0a45(0xe6)]?.[_0x2e0a45(0xd6)]==='CLO'?_0x359b5e=_0x2e0a45(0x10b):_0x359b5e=_0x2e0a45(0x147);break;case _0x2e0a45(0x127):_0x359b5e=_0x2e0a45(0x111);break;case _0x2e0a45(0xe7):_0x359b5e=_0x2e0a45(0x138);break;case _0x2e0a45(0xea):_0x359b5e='FAILED';!_0x1305ea&&_0x1a811e[_0x2e0a45(0xe6)]?.[_0x2e0a45(0xf7)]&&(_0x1305ea=_0x1a811e[_0x2e0a45(0xe6)][_0x2e0a45(0xf7)]);break;default:switch(_0x1a811e[_0x2e0a45(0xe6)]?.['status']?.[_0x2e0a45(0xe4)]()){case _0x2e0a45(0x104):_0x1a811e['data']?.[_0x2e0a45(0xf0)]===!![]?_0x359b5e='PAID':_0x359b5e='FAILED';break;case _0x2e0a45(0xe0):_0x359b5e='FAILED';break;case _0x2e0a45(0x101):_0x359b5e=_0x2e0a45(0x138);break;case _0x2e0a45(0xf2):_0x359b5e=_0x2e0a45(0x111);!_0x1305ea&&_0x1a811e['data']?.['failure_message']&&(_0x1305ea=_0x1a811e[_0x2e0a45(0xe6)][_0x2e0a45(0xf7)]);break;case'NEW':case'ACT':default:_0x359b5e='PENDING';break;}break;}const _0x5e84e2={};return _0x1a811e[_0x2e0a45(0xe6)]?.[_0x2e0a45(0x115)]?.[_0x2e0a45(0xd9)]&&(_0x5e84e2[_0x2e0a45(0x108)]=_0x1a811e[_0x2e0a45(0xe6)][_0x2e0a45(0x115)]['last4']),_0x1a811e[_0x2e0a45(0xe6)]?.['payment_method_type']&&(_0x5e84e2['paymentMethod']=_0x1a811e[_0x2e0a45(0xe6)][_0x2e0a45(0xe3)]),_0x1a811e['data']?.['error_code']&&(_0x5e84e2[_0x2e0a45(0x103)]=_0x1a811e['data'][_0x2e0a45(0x10f)]),_0x1a811e['data']?.['failure_code']&&(_0x5e84e2[_0x2e0a45(0x142)]=_0x1a811e['data'][_0x2e0a45(0x131)]),console[_0x2e0a45(0x12c)](_0x2e0a45(0xd7)+_0x359b5e+_0x2e0a45(0x137)+(_0x1305ea||'none')),{'paymentId':_0x1a811e['data']?.['merchant_reference_id']||'','status':_0x359b5e,'amount':_0x1a811e[_0x2e0a45(0xe6)]?.['amount'],'currency':_0x1a811e[_0x2e0a45(0xe6)]?.[_0x2e0a45(0xf9)],'failureMessage':_0x1305ea,'additionalInfo':_0x5e84e2};}}exports[a50_0x33e864(0x148)]=RapydService;