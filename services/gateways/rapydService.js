'use strict';const a63_0x155dbc=a63_0x1a31;(function(_0x190f35,_0x4d1333){const _0x3362d9=a63_0x1a31,_0x46d904=_0x190f35();while(!![]){try{const _0x351582=-parseInt(_0x3362d9(0x20d))/0x1+parseInt(_0x3362d9(0x217))/0x2+parseInt(_0x3362d9(0x227))/0x3+-parseInt(_0x3362d9(0x203))/0x4+-parseInt(_0x3362d9(0x229))/0x5+-parseInt(_0x3362d9(0x240))/0x6+parseInt(_0x3362d9(0x264))/0x7*(parseInt(_0x3362d9(0x258))/0x8);if(_0x351582===_0x4d1333)break;else _0x46d904['push'](_0x46d904['shift']());}catch(_0x369df2){_0x46d904['push'](_0x46d904['shift']());}}}(a63_0x48db,0x3b312));function a63_0x48db(){const _0x53cff5=['paymentMethod','address','SUCCESS','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','cardholder_name','headers','Rapyd\x20API\x20error:\x20','payment_method_data','Status:','fixed_side','currency','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','redirect_url','2483310BLpIsV','Payment\x20System/1.0','Request\x20Body\x20(Updated\x20Format):','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','Rapyd\x20payment\x20verification\x20error:','PAYMENT_COMPLETED','https://tesoft.uk/gateway/success.php?id=','üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','stringify','createPaymentLink','URL:','EUR','message','EXPIRED','\x20\x20\x20expiration:\x20','Response\x20Body:',',\x20failureMessage=','HTTP\x20error!\x20status:\x20','\x20\x20\x20requested_currency:\x20EUR','log','Unknown\x20error','failure_message','PAYMENT_EXPIRED','üá¨üáß\x20Country:\x20','616KLpJqy','CAN','__esModule','last4','Rapyd\x20API\x20error\x20(','data','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','\x20\x20\x20fixed_side:\x20buy','type','Status\x20Text:','/v1/hosted/payment_links/','/v1/hosted/payment_links','100849wpBDfr','JSON\x20Parse\x20Error:\x20','email','Business\x20Error\x20(','\x20(GB\x20-\x20Britain)','apiUrl','toISOString','Error\x20message:','merchant_reference_id','parse','Full\x20Error\x20Data:','error_code','FAILED',',\x20body:\x20','ORDER:\x20','json','logWhiteDomainResponse','toUpperCase','failure_code','buy','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','name','POST','Response\x20data:','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','application/json','RapydService','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Unknown\x20error\x20from\x20Rapyd\x20API','Error\x20Code:','CLO','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','Raw\x20Response\x20Body:','üí≥\x20Adding\x20cardholder\x20name:\x20','HTTP\x20Status:','expiration','UNKNOWN','PAYMENT_FAILED','1120964qJOevw','Headers:','payment_method_type','entries','paid','Response\x20Time:','üí•\x20Rapyd\x20failure\x20message:\x20','now','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','327581iPXdXy','gb_visa_card','Error\x20stack:','Parsed\x20Result:','ACT','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','PAYMENT_CANCELED','NEW','verifyPayment','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','844350sLBEwH','text','custom_elements','ERR','GET','floor','defineProperty','logWhiteDomainRequest','EXP','Redirect\x20URL:','Payment\x20Link\x20ID:','processWebhook','loggerService','PAID','amount','logWhiteDomainError','554076evZmyL','error','2260245bFiDAa','\x20->\x20EUR:','stack','PENDING','status','rapyd','errorCode','Error\x20details:','üá¨üáß\x20Country\x20used:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url'];a63_0x48db=function(){return _0x53cff5;};return a63_0x48db();}function a63_0x1a31(_0x216a62,_0x49d724){_0x216a62=_0x216a62-0x1f2;const _0x48db00=a63_0x48db();let _0x1a311e=_0x48db00[_0x216a62];return _0x1a311e;}Object[a63_0x155dbc(0x21d)](exports,a63_0x155dbc(0x25a),{'value':!![]}),exports[a63_0x155dbc(0x1f7)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x1e452a=a63_0x155dbc;this[_0x1e452a(0x269)]='https://tesoft.uk/gateway/rapyd/',console['log']('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a63_0x155dbc(0x249)](_0x2f75ad){const _0x307c8e=a63_0x155dbc,{orderId:_0x4bbb37,orderName:_0x10d1d9,amount:_0x474422,currency:_0x3fc0eb,usage:_0x22c151,maxPayments:_0x56a034,successUrl:_0x1fb608,failUrl:_0x55a3fb,customerName:_0x4144f9,customerEmail:_0x43eb94}=_0x2f75ad,_0x8d3de0=_0x3fc0eb['toUpperCase'](),_0x5528f4='GB';console[_0x307c8e(0x253)](_0x307c8e(0x278));const _0x48e576=_0x307c8e(0x246)+_0x4bbb37,_0x2e8f7d='https://tesoft.uk/gateway/fail.php?id='+_0x4bbb37,_0x1e49a6={'amount':_0x474422,'currency':_0x8d3de0,'payment_method_options':{'3d_required':![]},'cancel_checkout_url':_0x2e8f7d,'complete_checkout_url':_0x48e576,'complete_payment_url':_0x48e576,'merchant_reference_id':_0x4bbb37,'description':_0x307c8e(0x272)+_0x4bbb37,'country':'GB','payment_method_types_include':[_0x307c8e(0x20e),'gb_mastercard_card'],'custom_elements':{'display_description':!![],'billing_address_collect':!![],'required_customer_fields':[_0x307c8e(0x1f2),_0x307c8e(0x266),'phone_number',_0x307c8e(0x234)]}};_0x4144f9&&(_0x1e49a6[_0x307c8e(0x219)][_0x307c8e(0x237)]=_0x4144f9,console['log'](_0x307c8e(0x1fe)+_0x4144f9));if(_0x8d3de0!==_0x307c8e(0x24b)){const _0x118355=Math[_0x307c8e(0x21c)](Date[_0x307c8e(0x20a)]()/0x3e8)+0x1e*0x3c;_0x1e49a6[_0x307c8e(0x23c)]=_0x307c8e(0x277),_0x1e49a6['requested_currency']=_0x307c8e(0x24b),_0x1e49a6[_0x307c8e(0x200)]=_0x118355,console['log'](_0x307c8e(0x247)+_0x8d3de0+_0x307c8e(0x22a)),console[_0x307c8e(0x253)](_0x307c8e(0x25f)),console[_0x307c8e(0x253)](_0x307c8e(0x252)),console[_0x307c8e(0x253)](_0x307c8e(0x24e)+_0x118355+'\x20('+new Date(_0x118355*0x3e8)[_0x307c8e(0x26a)]()+')');}const _0x382582=Date[_0x307c8e(0x20a)]();try{console['log'](_0x307c8e(0x1fc)),console[_0x307c8e(0x253)](_0x307c8e(0x24a),this[_0x307c8e(0x269)]),console[_0x307c8e(0x253)](_0x307c8e(0x242),JSON[_0x307c8e(0x248)](_0x1e49a6,null,0x2)),console[_0x307c8e(0x253)](_0x307c8e(0x257)+_0x5528f4+'\x20(always\x20GB\x20for\x20Rapyd)'),console[_0x307c8e(0x253)](_0x307c8e(0x212)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x307c8e(0x22e),'/v1/hosted/payment_links',_0x307c8e(0x1f3),_0x1e49a6);const _0x4f63dc=await fetch(this[_0x307c8e(0x269)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x307c8e(0x241)},'body':JSON[_0x307c8e(0x248)](_0x1e49a6)}),_0x3e2478=Date[_0x307c8e(0x20a)]()-_0x382582;console[_0x307c8e(0x253)](_0x307c8e(0x20c)),console[_0x307c8e(0x253)](_0x307c8e(0x23b),_0x4f63dc[_0x307c8e(0x22d)]),console[_0x307c8e(0x253)](_0x307c8e(0x261),_0x4f63dc['statusText']),console[_0x307c8e(0x253)](_0x307c8e(0x204),Object['fromEntries'](_0x4f63dc[_0x307c8e(0x238)][_0x307c8e(0x206)]())),console[_0x307c8e(0x253)](_0x307c8e(0x208),_0x3e2478+'ms');const _0x5afd17=await _0x4f63dc[_0x307c8e(0x218)]();console['log'](_0x307c8e(0x1fd),_0x5afd17);if(!_0x4f63dc['ok']){console[_0x307c8e(0x228)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x307c8e(0x228)](_0x307c8e(0x1ff),_0x4f63dc[_0x307c8e(0x22d)]),console[_0x307c8e(0x228)](_0x307c8e(0x24f),_0x5afd17),loggerService_1[_0x307c8e(0x223)][_0x307c8e(0x274)](_0x307c8e(0x22e),'/v1/hosted/payment_links',_0x4f63dc[_0x307c8e(0x22d)],_0x5afd17,_0x3e2478),loggerService_1[_0x307c8e(0x223)][_0x307c8e(0x226)]('rapyd',_0x307c8e(0x263),'HTTP\x20'+_0x4f63dc[_0x307c8e(0x22d)]+':\x20'+_0x5afd17);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4f63dc['status']+_0x307c8e(0x271)+_0x5afd17);}let _0x30cf12;try{_0x30cf12=JSON[_0x307c8e(0x26d)](_0x5afd17);}catch(_0x5723c0){console[_0x307c8e(0x228)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5723c0),loggerService_1[_0x307c8e(0x223)][_0x307c8e(0x226)](_0x307c8e(0x22e),_0x307c8e(0x263),_0x307c8e(0x265)+_0x5723c0);throw new Error(_0x307c8e(0x1f5)+_0x5afd17);}console[_0x307c8e(0x253)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x307c8e(0x253)](_0x307c8e(0x210),JSON['stringify'](_0x30cf12,null,0x2)),loggerService_1[_0x307c8e(0x223)][_0x307c8e(0x274)](_0x307c8e(0x22e),'/v1/hosted/payment_links',_0x4f63dc[_0x307c8e(0x22d)],_0x30cf12,_0x3e2478);if(_0x30cf12['status']?.['status']!==_0x307c8e(0x235)){const _0x580617=_0x30cf12[_0x307c8e(0x22d)]?.['message']||_0x307c8e(0x1f9),_0x359ddb=_0x30cf12[_0x307c8e(0x22d)]?.['error_code']||_0x307c8e(0x201);console[_0x307c8e(0x228)](_0x307c8e(0x23e)),console[_0x307c8e(0x228)](_0x307c8e(0x1fa),_0x359ddb),console[_0x307c8e(0x228)]('Error\x20Message:',_0x580617),console[_0x307c8e(0x228)](_0x307c8e(0x26e),_0x30cf12[_0x307c8e(0x22d)]),loggerService_1[_0x307c8e(0x223)][_0x307c8e(0x226)](_0x307c8e(0x22e),_0x307c8e(0x263),_0x307c8e(0x267)+_0x359ddb+'):\x20'+_0x580617);throw new Error(_0x307c8e(0x25c)+_0x359ddb+'):\x20'+_0x580617);}if(!_0x30cf12[_0x307c8e(0x25d)]?.['id']||!_0x30cf12[_0x307c8e(0x25d)]?.[_0x307c8e(0x23f)]){console[_0x307c8e(0x228)](_0x307c8e(0x216)),console['error'](_0x307c8e(0x1f8)),console[_0x307c8e(0x228)](_0x307c8e(0x1f4),_0x30cf12['data']),loggerService_1[_0x307c8e(0x223)][_0x307c8e(0x226)](_0x307c8e(0x22e),_0x307c8e(0x263),_0x307c8e(0x232));throw new Error(_0x307c8e(0x25e));}return console[_0x307c8e(0x253)]('===\x20RAPYD\x20SUCCESS\x20==='),console['log'](_0x307c8e(0x221),_0x30cf12['data']['id']),console[_0x307c8e(0x253)](_0x307c8e(0x220),_0x30cf12['data']['redirect_url']),console[_0x307c8e(0x253)](_0x307c8e(0x231)+_0x5528f4+_0x307c8e(0x268)),console[_0x307c8e(0x253)](_0x307c8e(0x212)),{'gateway_payment_id':_0x30cf12[_0x307c8e(0x25d)]['id'],'payment_url':_0x30cf12[_0x307c8e(0x25d)]['redirect_url']};}catch(_0xb279fc){console['error']('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console['error'](_0x307c8e(0x230),_0xb279fc),loggerService_1[_0x307c8e(0x223)]['logWhiteDomainError'](_0x307c8e(0x22e),_0x307c8e(0x263),_0xb279fc);if(_0xb279fc instanceof Error){console['error'](_0x307c8e(0x26b),_0xb279fc[_0x307c8e(0x24c)]),console['error'](_0x307c8e(0x20f),_0xb279fc[_0x307c8e(0x22b)]);throw new Error(_0x307c8e(0x20b)+_0xb279fc[_0x307c8e(0x24c)]);}throw new Error(_0x307c8e(0x236));}}async[a63_0x155dbc(0x215)](_0xee4646){const _0x3a0737=a63_0x155dbc,_0x4bbec8=Date[_0x3a0737(0x20a)]();try{loggerService_1[_0x3a0737(0x223)][_0x3a0737(0x21e)]('rapyd',_0x3a0737(0x262)+_0xee4646,_0x3a0737(0x21b),{});const _0x3457e6=await fetch(this['apiUrl']+'/'+_0xee4646,{'method':_0x3a0737(0x21b),'headers':{'Content-Type':_0x3a0737(0x1f6),'User-Agent':'Payment\x20System/1.0'}}),_0x47ee1a=Date[_0x3a0737(0x20a)]()-_0x4bbec8;if(!_0x3457e6['ok']){const _0xb0809=await _0x3457e6['text']();loggerService_1['loggerService'][_0x3a0737(0x274)](_0x3a0737(0x22e),_0x3a0737(0x262)+_0xee4646,_0x3457e6[_0x3a0737(0x22d)],_0xb0809,_0x47ee1a);throw new Error(_0x3a0737(0x251)+_0x3457e6[_0x3a0737(0x22d)]);}const _0x3d6f6=await _0x3457e6[_0x3a0737(0x273)]();loggerService_1[_0x3a0737(0x223)]['logWhiteDomainResponse'](_0x3a0737(0x22e),_0x3a0737(0x262)+_0xee4646,_0x3457e6[_0x3a0737(0x22d)],_0x3d6f6,_0x47ee1a);if(_0x3d6f6[_0x3a0737(0x22d)]?.[_0x3a0737(0x22d)]!=='SUCCESS'){loggerService_1['loggerService'][_0x3a0737(0x226)](_0x3a0737(0x22e),_0x3a0737(0x262)+_0xee4646,_0x3a0737(0x239)+(_0x3d6f6[_0x3a0737(0x22d)]?.['message']||_0x3a0737(0x254)));throw new Error(_0x3a0737(0x239)+(_0x3d6f6[_0x3a0737(0x22d)]?.['message']||'Unknown\x20error'));}let _0x4a65d6='PENDING';if(_0x3d6f6['data']?.['status'])switch(_0x3d6f6[_0x3a0737(0x25d)][_0x3a0737(0x22d)][_0x3a0737(0x275)]()){case _0x3a0737(0x1fb):_0x4a65d6='PAID';break;case _0x3a0737(0x259):_0x4a65d6=_0x3a0737(0x270);break;case _0x3a0737(0x21f):_0x4a65d6=_0x3a0737(0x24d);break;case _0x3a0737(0x21a):_0x4a65d6=_0x3a0737(0x270);break;case _0x3a0737(0x214):case _0x3a0737(0x211):default:_0x4a65d6=_0x3a0737(0x22c);break;}return{'status':_0x4a65d6,'amount':_0x3d6f6['data']?.[_0x3a0737(0x225)],'currency':_0x3d6f6['data']?.[_0x3a0737(0x23d)]};}catch(_0x4dc312){console['error'](_0x3a0737(0x244),_0x4dc312),loggerService_1[_0x3a0737(0x223)][_0x3a0737(0x226)](_0x3a0737(0x22e),_0x3a0737(0x262)+_0xee4646,_0x4dc312);throw new Error(_0x3a0737(0x243)+(_0x4dc312 instanceof Error?_0x4dc312[_0x3a0737(0x24c)]:_0x3a0737(0x254)));}}async[a63_0x155dbc(0x222)](_0x779ac4){const _0x1265db=a63_0x155dbc;console[_0x1265db(0x253)]('Processing\x20Rapyd\x20webhook:',_0x779ac4);let _0x58f72e='PENDING',_0x2a7017;_0x779ac4[_0x1265db(0x25d)]?.[_0x1265db(0x255)]&&(_0x2a7017=_0x779ac4[_0x1265db(0x25d)][_0x1265db(0x255)],console[_0x1265db(0x253)](_0x1265db(0x209)+_0x2a7017));switch(_0x779ac4[_0x1265db(0x260)]?.[_0x1265db(0x275)]()){case _0x1265db(0x245):_0x779ac4[_0x1265db(0x25d)]?.[_0x1265db(0x207)]===!![]&&_0x779ac4[_0x1265db(0x25d)]?.['status']==='CLO'?_0x58f72e='PAID':_0x58f72e=_0x1265db(0x22c);break;case _0x1265db(0x213):_0x58f72e=_0x1265db(0x270);break;case _0x1265db(0x256):_0x58f72e=_0x1265db(0x24d);break;case _0x1265db(0x202):_0x58f72e=_0x1265db(0x270);!_0x2a7017&&_0x779ac4['data']?.[_0x1265db(0x255)]&&(_0x2a7017=_0x779ac4[_0x1265db(0x25d)][_0x1265db(0x255)]);break;default:switch(_0x779ac4[_0x1265db(0x25d)]?.[_0x1265db(0x22d)]?.[_0x1265db(0x275)]()){case _0x1265db(0x1fb):_0x779ac4['data']?.[_0x1265db(0x207)]===!![]?_0x58f72e=_0x1265db(0x224):_0x58f72e=_0x1265db(0x270);break;case _0x1265db(0x259):_0x58f72e='FAILED';break;case _0x1265db(0x21f):_0x58f72e=_0x1265db(0x24d);break;case _0x1265db(0x21a):_0x58f72e=_0x1265db(0x270);!_0x2a7017&&_0x779ac4['data']?.[_0x1265db(0x255)]&&(_0x2a7017=_0x779ac4['data'][_0x1265db(0x255)]);break;case'NEW':case _0x1265db(0x211):default:_0x58f72e=_0x1265db(0x22c);break;}break;}const _0x13262a={};return _0x779ac4['data']?.['payment_method_data']?.[_0x1265db(0x25b)]&&(_0x13262a['cardLast4']=_0x779ac4[_0x1265db(0x25d)][_0x1265db(0x23a)][_0x1265db(0x25b)]),_0x779ac4[_0x1265db(0x25d)]?.[_0x1265db(0x205)]&&(_0x13262a[_0x1265db(0x233)]=_0x779ac4[_0x1265db(0x25d)]['payment_method_type']),_0x779ac4[_0x1265db(0x25d)]?.[_0x1265db(0x26f)]&&(_0x13262a[_0x1265db(0x22f)]=_0x779ac4[_0x1265db(0x25d)][_0x1265db(0x26f)]),_0x779ac4[_0x1265db(0x25d)]?.[_0x1265db(0x276)]&&(_0x13262a['failureCode']=_0x779ac4[_0x1265db(0x25d)]['failure_code']),console[_0x1265db(0x253)]('üîÑ\x20Rapyd\x20webhook\x20processed:\x20status='+_0x58f72e+_0x1265db(0x250)+(_0x2a7017||'none')),{'paymentId':_0x779ac4['data']?.[_0x1265db(0x26c)]||'','status':_0x58f72e,'amount':_0x779ac4['data']?.[_0x1265db(0x225)],'currency':_0x779ac4[_0x1265db(0x25d)]?.[_0x1265db(0x23d)],'failureMessage':_0x2a7017,'additionalInfo':_0x13262a};}}exports[a63_0x155dbc(0x1f7)]=RapydService;