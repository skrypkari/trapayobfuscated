'use strict';const a45_0x3bae03=a45_0x32de;function a45_0x32de(_0x472e68,_0x15cafa){const _0x474ad1=a45_0x474a();return a45_0x32de=function(_0x32dec1,_0x55fde2){_0x32dec1=_0x32dec1-0x10c;let _0x2c331e=_0x474ad1[_0x32dec1];return _0x2c331e;},a45_0x32de(_0x472e68,_0x15cafa);}(function(_0x5d7420,_0x8771f2){const _0xfe7124=a45_0x32de,_0x4ff383=_0x5d7420();while(!![]){try{const _0xcc1df9=-parseInt(_0xfe7124(0x172))/0x1+parseInt(_0xfe7124(0x17a))/0x2*(-parseInt(_0xfe7124(0x12d))/0x3)+-parseInt(_0xfe7124(0x136))/0x4*(parseInt(_0xfe7124(0x16d))/0x5)+parseInt(_0xfe7124(0x129))/0x6+parseInt(_0xfe7124(0x174))/0x7*(parseInt(_0xfe7124(0x158))/0x8)+parseInt(_0xfe7124(0x175))/0x9*(-parseInt(_0xfe7124(0x170))/0xa)+parseInt(_0xfe7124(0x137))/0xb;if(_0xcc1df9===_0x8771f2)break;else _0x4ff383['push'](_0x4ff383['shift']());}catch(_0x4de23b){_0x4ff383['push'](_0x4ff383['shift']());}}}(a45_0x474a,0x9279c));function a45_0x474a(){const _0x1de0f6=['üá¨üáß\x20Country:\x20','\x20(always\x20GB\x20for\x20Rapyd)','Status:','EXP','Error\x20Message:','Payment\x20Link\x20ID:','data','Failed\x20to\x20parse\x20JSON\x20response:','paid','rapyd','errorCode','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','logWhiteDomainError','error_code','):\x20','879385lDfxsx','currency','Request\x20Body\x20(Updated\x20Format):','19020hlWuLV','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','968495sHHtrV','paymentMethod','14voyWdm','234UEmLCh','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','===\x20RAPYD\x20SUCCESS\x20===','logWhiteDomainResponse','defineProperty','298712CXQava','headers','UNKNOWN','message','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','payment_method_type','JSON\x20Parse\x20Error:\x20','Response\x20Body:','Full\x20Error\x20Data:','merchant_reference_id','stringify','SUCCESS','log','redirect_url','Error\x20message:','status','Business\x20Error\x20(','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','now','===\x20RAPYD\x20API\x20ERROR\x20===','NEW','FAILED','Rapyd\x20API\x20error\x20(','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','EXPIRED','PENDING','Rapyd\x20payment\x20verification\x20error:','amount','payment_method_data','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','GET','HTTP\x20','PAID','fromEntries','2392020dmYyTx','\x20(GB\x20-\x20Britain)','URL:','application/json','3LlcDrd','none','PAYMENT_COMPLETED','üá¨üáß\x20Country\x20used:\x20','https://tesoft.uk/gateway/fail.php?id=','loggerService','toUpperCase','/v1/hosted/payment_links/','failureCode','16jzXuRz','16715897XQXiyM','failure_message','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','Parsed\x20Result:','__esModule','Missing\x20id\x20or\x20redirect_url\x20in\x20response','POST','entries','Unknown\x20error','stack','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','processWebhook','failure_code','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','ORDER:\x20','type','TesSoft\x20Payment\x20System/1.0','Redirect\x20URL:','https://tesoft.uk/gateway/rapyd/','Rapyd\x20API\x20error:\x20','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','HTTP\x20error!\x20status:\x20','üí•\x20Rapyd\x20failure\x20message:\x20','ACT','apiUrl','logWhiteDomainRequest','/v1/hosted/payment_links','text','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','ERR','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','error','CLO','2209912FdpDvy','Status\x20Text:','verifyPayment','PAYMENT_CANCELED','../loggerService','createPaymentLink'];a45_0x474a=function(){return _0x1de0f6;};return a45_0x474a();}Object[a45_0x3bae03(0x179)](exports,a45_0x3bae03(0x13b),{'value':!![]}),exports['RapydService']=void 0x0;const loggerService_1=require(a45_0x3bae03(0x15c));class RapydService{constructor(){const _0x489aef=a45_0x3bae03;this[_0x489aef(0x14f)]=_0x489aef(0x149),console[_0x489aef(0x113)](_0x489aef(0x118));}async[a45_0x3bae03(0x15d)](_0x9fbd28){const _0x241dec=a45_0x3bae03,{orderId:_0x1bd587,orderName:_0x37d066,amount:_0x27cc49,currency:_0x5c7d0d,usage:_0x5d5b13,maxPayments:_0x27f045,successUrl:_0x9a431e,failUrl:_0x59597f}=_0x9fbd28,_0xc4a304=_0x5c7d0d['toUpperCase'](),_0x6027d0='GB';console['log'](_0x241dec(0x139));const _0x4604a8='https://tesoft.uk/gateway/success.php?id='+_0x1bd587,_0x3428b6=_0x241dec(0x131)+_0x1bd587,_0x27066e={'amount':_0x27cc49,'currency':_0xc4a304,'cancel_checkout_url':_0x3428b6,'complete_checkout_url':_0x4604a8,'complete_payment_url':_0x4604a8,'merchant_reference_id':_0x1bd587,'description':_0x241dec(0x145)+_0x1bd587,'country':'GB','payment_method_types_include':['gb_visa_card','gb_mastercard_card'],'custom_elements':{'display_description':!![]}},_0x4ba032=Date[_0x241dec(0x119)]();try{console[_0x241dec(0x113)](_0x241dec(0x155)),console[_0x241dec(0x113)](_0x241dec(0x12b),this[_0x241dec(0x14f)]),console[_0x241dec(0x113)](_0x241dec(0x16f),JSON['stringify'](_0x27066e,null,0x2)),console[_0x241dec(0x113)](_0x241dec(0x15e)+_0x6027d0+_0x241dec(0x15f)),console[_0x241dec(0x113)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x241dec(0x132)][_0x241dec(0x150)](_0x241dec(0x167),_0x241dec(0x151),_0x241dec(0x13d),_0x27066e);const _0xc411f6=await fetch(this[_0x241dec(0x14f)],{'method':_0x241dec(0x13d),'headers':{'Content-Type':_0x241dec(0x12c),'User-Agent':_0x241dec(0x147)},'body':JSON['stringify'](_0x27066e)}),_0x3b8af6=Date[_0x241dec(0x119)]()-_0x4ba032;console[_0x241dec(0x113)](_0x241dec(0x17e)),console[_0x241dec(0x113)](_0x241dec(0x160),_0xc411f6['status']),console['log'](_0x241dec(0x159),_0xc411f6['statusText']),console[_0x241dec(0x113)]('Headers:',Object[_0x241dec(0x128)](_0xc411f6[_0x241dec(0x17b)][_0x241dec(0x13e)]())),console[_0x241dec(0x113)]('Response\x20Time:',_0x3b8af6+'ms');const _0x3a9e03=await _0xc411f6[_0x241dec(0x152)]();console['log']('Raw\x20Response\x20Body:',_0x3a9e03);if(!_0xc411f6['ok']){console[_0x241dec(0x156)](_0x241dec(0x11a)),console[_0x241dec(0x156)]('HTTP\x20Status:',_0xc411f6[_0x241dec(0x116)]),console[_0x241dec(0x156)](_0x241dec(0x10e),_0x3a9e03),loggerService_1[_0x241dec(0x132)][_0x241dec(0x178)](_0x241dec(0x167),_0x241dec(0x151),_0xc411f6[_0x241dec(0x116)],_0x3a9e03,_0x3b8af6),loggerService_1[_0x241dec(0x132)][_0x241dec(0x16a)](_0x241dec(0x167),_0x241dec(0x151),_0x241dec(0x126)+_0xc411f6['status']+':\x20'+_0x3a9e03);throw new Error(_0x241dec(0x14c)+_0xc411f6[_0x241dec(0x116)]+',\x20body:\x20'+_0x3a9e03);}let _0x15642d;try{_0x15642d=JSON['parse'](_0x3a9e03);}catch(_0x1d58c4){console['error'](_0x241dec(0x165),_0x1d58c4),loggerService_1['loggerService']['logWhiteDomainError'](_0x241dec(0x167),_0x241dec(0x151),_0x241dec(0x10d)+_0x1d58c4);throw new Error(_0x241dec(0x14b)+_0x3a9e03);}console[_0x241dec(0x113)](_0x241dec(0x141)),console[_0x241dec(0x113)](_0x241dec(0x13a),JSON[_0x241dec(0x111)](_0x15642d,null,0x2)),loggerService_1[_0x241dec(0x132)]['logWhiteDomainResponse'](_0x241dec(0x167),_0x241dec(0x151),_0xc411f6[_0x241dec(0x116)],_0x15642d,_0x3b8af6);if(_0x15642d[_0x241dec(0x116)]?.[_0x241dec(0x116)]!==_0x241dec(0x112)){const _0x3dab3f=_0x15642d[_0x241dec(0x116)]?.[_0x241dec(0x17d)]||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x30bb39=_0x15642d[_0x241dec(0x116)]?.[_0x241dec(0x16b)]||_0x241dec(0x17c);console['error'](_0x241dec(0x144)),console[_0x241dec(0x156)]('Error\x20Code:',_0x30bb39),console['error'](_0x241dec(0x162),_0x3dab3f),console[_0x241dec(0x156)](_0x241dec(0x10f),_0x15642d[_0x241dec(0x116)]),loggerService_1[_0x241dec(0x132)][_0x241dec(0x16a)](_0x241dec(0x167),_0x241dec(0x151),_0x241dec(0x117)+_0x30bb39+_0x241dec(0x16c)+_0x3dab3f);throw new Error(_0x241dec(0x11d)+_0x30bb39+_0x241dec(0x16c)+_0x3dab3f);}if(!_0x15642d['data']?.['id']||!_0x15642d[_0x241dec(0x164)]?.[_0x241dec(0x114)]){console[_0x241dec(0x156)]('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x241dec(0x13c)),console['error']('Response\x20data:',_0x15642d[_0x241dec(0x164)]),loggerService_1[_0x241dec(0x132)][_0x241dec(0x16a)]('rapyd',_0x241dec(0x151),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x241dec(0x169));}return console['log'](_0x241dec(0x177)),console[_0x241dec(0x113)](_0x241dec(0x163),_0x15642d[_0x241dec(0x164)]['id']),console['log'](_0x241dec(0x148),_0x15642d[_0x241dec(0x164)][_0x241dec(0x114)]),console['log'](_0x241dec(0x130)+_0x6027d0+_0x241dec(0x12a)),console[_0x241dec(0x113)](_0x241dec(0x124)),{'gateway_payment_id':_0x15642d[_0x241dec(0x164)]['id'],'payment_url':_0x15642d[_0x241dec(0x164)]['redirect_url']};}catch(_0x1a8f85){console['error']('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console['error']('Error\x20details:',_0x1a8f85),loggerService_1[_0x241dec(0x132)][_0x241dec(0x16a)]('rapyd',_0x241dec(0x151),_0x1a8f85);if(_0x1a8f85 instanceof Error){console[_0x241dec(0x156)](_0x241dec(0x115),_0x1a8f85[_0x241dec(0x17d)]),console[_0x241dec(0x156)]('Error\x20stack:',_0x1a8f85[_0x241dec(0x140)]);throw new Error(_0x241dec(0x176)+_0x1a8f85['message']);}throw new Error(_0x241dec(0x171));}}async[a45_0x3bae03(0x15a)](_0x94a338){const _0x33da9e=a45_0x3bae03,_0x2a2aad=Date['now']();try{loggerService_1['loggerService']['logWhiteDomainRequest']('rapyd','/v1/hosted/payment_links/'+_0x94a338,_0x33da9e(0x125),{});const _0x1944cc=await fetch(this['apiUrl']+'/'+_0x94a338,{'method':'GET','headers':{'Content-Type':_0x33da9e(0x12c),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x3dcbbb=Date[_0x33da9e(0x119)]()-_0x2a2aad;if(!_0x1944cc['ok']){const _0x3f8b10=await _0x1944cc[_0x33da9e(0x152)]();loggerService_1[_0x33da9e(0x132)]['logWhiteDomainResponse']('rapyd',_0x33da9e(0x134)+_0x94a338,_0x1944cc[_0x33da9e(0x116)],_0x3f8b10,_0x3dcbbb);throw new Error(_0x33da9e(0x14c)+_0x1944cc['status']);}const _0x3a0ffc=await _0x1944cc['json']();loggerService_1['loggerService']['logWhiteDomainResponse']('rapyd','/v1/hosted/payment_links/'+_0x94a338,_0x1944cc['status'],_0x3a0ffc,_0x3dcbbb);if(_0x3a0ffc['status']?.['status']!==_0x33da9e(0x112)){loggerService_1[_0x33da9e(0x132)][_0x33da9e(0x16a)](_0x33da9e(0x167),_0x33da9e(0x134)+_0x94a338,_0x33da9e(0x14a)+(_0x3a0ffc[_0x33da9e(0x116)]?.[_0x33da9e(0x17d)]||'Unknown\x20error'));throw new Error(_0x33da9e(0x14a)+(_0x3a0ffc['status']?.['message']||'Unknown\x20error'));}let _0x5071fb='PENDING';if(_0x3a0ffc[_0x33da9e(0x164)]?.[_0x33da9e(0x116)])switch(_0x3a0ffc['data'][_0x33da9e(0x116)][_0x33da9e(0x133)]()){case _0x33da9e(0x157):_0x5071fb=_0x33da9e(0x127);break;case'CAN':_0x5071fb=_0x33da9e(0x11c);break;case _0x33da9e(0x161):_0x5071fb='EXPIRED';break;case'ERR':_0x5071fb='FAILED';break;case _0x33da9e(0x11b):case'ACT':default:_0x5071fb=_0x33da9e(0x120);break;}return{'status':_0x5071fb,'amount':_0x3a0ffc[_0x33da9e(0x164)]?.[_0x33da9e(0x122)],'currency':_0x3a0ffc[_0x33da9e(0x164)]?.[_0x33da9e(0x16e)]};}catch(_0x54ec56){console[_0x33da9e(0x156)](_0x33da9e(0x121),_0x54ec56),loggerService_1['loggerService'][_0x33da9e(0x16a)]('rapyd','/v1/hosted/payment_links/'+_0x94a338,_0x54ec56);throw new Error(_0x33da9e(0x153)+(_0x54ec56 instanceof Error?_0x54ec56['message']:_0x33da9e(0x13f)));}}async[a45_0x3bae03(0x142)](_0x31fbd6){const _0xb94e7=a45_0x3bae03;console[_0xb94e7(0x113)]('Processing\x20Rapyd\x20webhook:',_0x31fbd6);let _0x1dc603=_0xb94e7(0x120),_0x32cbe9;_0x31fbd6[_0xb94e7(0x164)]?.[_0xb94e7(0x138)]&&(_0x32cbe9=_0x31fbd6[_0xb94e7(0x164)][_0xb94e7(0x138)],console[_0xb94e7(0x113)](_0xb94e7(0x14d)+_0x32cbe9));switch(_0x31fbd6[_0xb94e7(0x146)]?.[_0xb94e7(0x133)]()){case _0xb94e7(0x12f):_0x31fbd6[_0xb94e7(0x164)]?.[_0xb94e7(0x166)]===!![]&&_0x31fbd6[_0xb94e7(0x164)]?.[_0xb94e7(0x116)]===_0xb94e7(0x157)?_0x1dc603=_0xb94e7(0x127):_0x1dc603=_0xb94e7(0x120);break;case _0xb94e7(0x15b):_0x1dc603='FAILED';break;case'PAYMENT_EXPIRED':_0x1dc603=_0xb94e7(0x11f);break;case'PAYMENT_FAILED':_0x1dc603=_0xb94e7(0x11c);!_0x32cbe9&&_0x31fbd6[_0xb94e7(0x164)]?.['failure_message']&&(_0x32cbe9=_0x31fbd6[_0xb94e7(0x164)]['failure_message']);break;default:switch(_0x31fbd6[_0xb94e7(0x164)]?.[_0xb94e7(0x116)]?.[_0xb94e7(0x133)]()){case'CLO':_0x31fbd6[_0xb94e7(0x164)]?.[_0xb94e7(0x166)]===!![]?_0x1dc603='PAID':_0x1dc603=_0xb94e7(0x11c);break;case'CAN':_0x1dc603=_0xb94e7(0x11c);break;case _0xb94e7(0x161):_0x1dc603=_0xb94e7(0x11f);break;case _0xb94e7(0x154):_0x1dc603='FAILED';!_0x32cbe9&&_0x31fbd6[_0xb94e7(0x164)]?.[_0xb94e7(0x138)]&&(_0x32cbe9=_0x31fbd6[_0xb94e7(0x164)][_0xb94e7(0x138)]);break;case _0xb94e7(0x11b):case _0xb94e7(0x14e):default:_0x1dc603=_0xb94e7(0x120);break;}break;}const _0x53cc2e={};return _0x31fbd6[_0xb94e7(0x164)]?.[_0xb94e7(0x123)]?.['last4']&&(_0x53cc2e['cardLast4']=_0x31fbd6[_0xb94e7(0x164)][_0xb94e7(0x123)]['last4']),_0x31fbd6[_0xb94e7(0x164)]?.[_0xb94e7(0x10c)]&&(_0x53cc2e[_0xb94e7(0x173)]=_0x31fbd6[_0xb94e7(0x164)][_0xb94e7(0x10c)]),_0x31fbd6[_0xb94e7(0x164)]?.[_0xb94e7(0x16b)]&&(_0x53cc2e[_0xb94e7(0x168)]=_0x31fbd6[_0xb94e7(0x164)][_0xb94e7(0x16b)]),_0x31fbd6[_0xb94e7(0x164)]?.[_0xb94e7(0x143)]&&(_0x53cc2e[_0xb94e7(0x135)]=_0x31fbd6[_0xb94e7(0x164)]['failure_code']),console[_0xb94e7(0x113)](_0xb94e7(0x11e)+_0x1dc603+',\x20failureMessage='+(_0x32cbe9||_0xb94e7(0x12e))),{'paymentId':_0x31fbd6[_0xb94e7(0x164)]?.[_0xb94e7(0x110)]||'','status':_0x1dc603,'amount':_0x31fbd6[_0xb94e7(0x164)]?.[_0xb94e7(0x122)],'currency':_0x31fbd6[_0xb94e7(0x164)]?.[_0xb94e7(0x16e)],'failureMessage':_0x32cbe9,'additionalInfo':_0x53cc2e};}}exports['RapydService']=RapydService;