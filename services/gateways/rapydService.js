'use strict';const a63_0x5b2840=a63_0x31ac;(function(_0x4c9e68,_0x1851d6){const _0x36dc9a=a63_0x31ac,_0x342b8d=_0x4c9e68();while(!![]){try{const _0x4132fe=-parseInt(_0x36dc9a(0xcf))/0x1+parseInt(_0x36dc9a(0xfa))/0x2*(parseInt(_0x36dc9a(0xef))/0x3)+parseInt(_0x36dc9a(0xd0))/0x4+-parseInt(_0x36dc9a(0x143))/0x5+parseInt(_0x36dc9a(0xf4))/0x6+parseInt(_0x36dc9a(0xf7))/0x7*(parseInt(_0x36dc9a(0xd1))/0x8)+parseInt(_0x36dc9a(0x121))/0x9;if(_0x4132fe===_0x1851d6)break;else _0x342b8d['push'](_0x342b8d['shift']());}catch(_0x4e000b){_0x342b8d['push'](_0x342b8d['shift']());}}}(a63_0x6371,0xe7362));Object[a63_0x5b2840(0x12a)](exports,a63_0x5b2840(0x12e),{'value':!![]}),exports['RapydService']=void 0x0;const loggerService_1=require(a63_0x5b2840(0x14e));function a63_0x31ac(_0x3afb58,_0x504b02){_0x3afb58=_0x3afb58-0xc9;const _0x6371ac=a63_0x6371();let _0x31acc6=_0x6371ac[_0x3afb58];return _0x31acc6;}class RapydService{constructor(){const _0x1847f8=a63_0x5b2840;this[_0x1847f8(0xc9)]=_0x1847f8(0xfd),console['log'](_0x1847f8(0xfc));}async[a63_0x5b2840(0xf3)](_0x40024e){const _0x5bd700=a63_0x5b2840,{orderId:_0x57393c,orderName:_0x66d9b9,amount:_0x4e78f1,currency:_0x20cc3c,usage:_0x32a100,maxPayments:_0x4b6241,successUrl:_0x3fb6f1,failUrl:_0x1be55d,customerName:_0x131023,customerEmail:_0x38a2c4}=_0x40024e,_0x57769e=_0x20cc3c['toUpperCase'](),_0x2b5aec='GB';console[_0x5bd700(0xcd)](_0x5bd700(0xf2));const _0x5d2718=_0x5bd700(0xf6)+_0x57393c,_0x3e9808=_0x5bd700(0x135)+_0x57393c,_0x28732c={'amount':_0x4e78f1,'currency':_0x57769e,'payment_method_options':{'3d_required':![]},'cancel_checkout_url':_0x3e9808,'complete_checkout_url':_0x5d2718,'complete_payment_url':_0x5d2718,'merchant_reference_id':_0x57393c,'description':'ORDER:\x20'+_0x57393c,'statement_descriptor':'TESOFT\x20'+(_0x57393c[_0x5bd700(0x106)]('-')[0x1]||_0x57393c),'country':'GB','payment_method_types_include':[_0x5bd700(0x114),_0x5bd700(0x108)],'custom_elements':{'display_description':!![],'billing_address_collect':!![],'required_customer_fields':[_0x5bd700(0x13e),_0x5bd700(0x13b),_0x5bd700(0xcb),_0x5bd700(0xf9)]}};_0x131023&&(_0x28732c[_0x5bd700(0x12f)][_0x5bd700(0x148)]=_0x131023,console[_0x5bd700(0xcd)](_0x5bd700(0x11e)+_0x131023));if(_0x57769e!==_0x5bd700(0x128)){const _0x189965=Math[_0x5bd700(0xdf)](Date[_0x5bd700(0xca)]()/0x3e8)+0x1e*0x3c;_0x28732c['fixed_side']=_0x5bd700(0xe8),_0x28732c[_0x5bd700(0x11a)]='EUR',_0x28732c[_0x5bd700(0x132)]=_0x189965,console['log']('üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20'+_0x57769e+'\x20->\x20EUR:'),console['log'](_0x5bd700(0x101)),console['log'](_0x5bd700(0xf5)),console[_0x5bd700(0xcd)]('\x20\x20\x20expiration:\x20'+_0x189965+'\x20('+new Date(_0x189965*0x3e8)[_0x5bd700(0x102)]()+')');}const _0x44e5a4=Date['now']();try{console['log']('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console['log']('URL:',this[_0x5bd700(0xc9)]),console['log']('Request\x20Body\x20(Updated\x20Format):',JSON['stringify'](_0x28732c,null,0x2)),console[_0x5bd700(0xcd)](_0x5bd700(0xda)+_0x2b5aec+_0x5bd700(0xe7)),console[_0x5bd700(0xcd)](_0x5bd700(0xdc)),loggerService_1['loggerService'][_0x5bd700(0x144)](_0x5bd700(0x13f),_0x5bd700(0x12d),_0x5bd700(0xdb),_0x28732c);const _0x377bbb=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x5bd700(0x129),'User-Agent':_0x5bd700(0x119)},'body':JSON['stringify'](_0x28732c)}),_0x3b5451=Date[_0x5bd700(0xca)]()-_0x44e5a4;console[_0x5bd700(0xcd)](_0x5bd700(0x10b)),console[_0x5bd700(0xcd)](_0x5bd700(0x13a),_0x377bbb[_0x5bd700(0xf0)]),console['log'](_0x5bd700(0x115),_0x377bbb[_0x5bd700(0xd7)]),console['log'](_0x5bd700(0x12b),Object[_0x5bd700(0x127)](_0x377bbb[_0x5bd700(0xe1)][_0x5bd700(0x100)]())),console[_0x5bd700(0xcd)](_0x5bd700(0xff),_0x3b5451+'ms');const _0x362a5d=await _0x377bbb[_0x5bd700(0x131)]();console[_0x5bd700(0xcd)](_0x5bd700(0x124),_0x362a5d);if(!_0x377bbb['ok']){console[_0x5bd700(0x125)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x5bd700(0x125)](_0x5bd700(0x113),_0x377bbb['status']),console[_0x5bd700(0x125)](_0x5bd700(0x10f),_0x362a5d),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x5bd700(0x13f),_0x5bd700(0x12d),_0x377bbb['status'],_0x362a5d,_0x3b5451),loggerService_1['loggerService'][_0x5bd700(0x133)](_0x5bd700(0x13f),_0x5bd700(0x12d),_0x5bd700(0x136)+_0x377bbb[_0x5bd700(0xf0)]+':\x20'+_0x362a5d);throw new Error('HTTP\x20error!\x20status:\x20'+_0x377bbb[_0x5bd700(0xf0)]+',\x20body:\x20'+_0x362a5d);}let _0x14a13d;try{_0x14a13d=JSON[_0x5bd700(0x134)](_0x362a5d);}catch(_0x1665e6){console[_0x5bd700(0x125)](_0x5bd700(0x141),_0x1665e6),loggerService_1['loggerService'][_0x5bd700(0x133)]('rapyd',_0x5bd700(0x12d),_0x5bd700(0xce)+_0x1665e6);throw new Error(_0x5bd700(0xea)+_0x362a5d);}console[_0x5bd700(0xcd)](_0x5bd700(0x12c)),console[_0x5bd700(0xcd)]('Parsed\x20Result:',JSON[_0x5bd700(0xe0)](_0x14a13d,null,0x2)),loggerService_1[_0x5bd700(0xde)][_0x5bd700(0x11b)](_0x5bd700(0x13f),_0x5bd700(0x12d),_0x377bbb[_0x5bd700(0xf0)],_0x14a13d,_0x3b5451);if(_0x14a13d[_0x5bd700(0xf0)]?.[_0x5bd700(0xf0)]!==_0x5bd700(0xf8)){const _0x56eb52=_0x14a13d[_0x5bd700(0xf0)]?.[_0x5bd700(0x14c)]||_0x5bd700(0x105),_0x3e2b73=_0x14a13d[_0x5bd700(0xf0)]?.[_0x5bd700(0x140)]||_0x5bd700(0xe4);console[_0x5bd700(0x125)](_0x5bd700(0x126)),console[_0x5bd700(0x125)](_0x5bd700(0x116),_0x3e2b73),console[_0x5bd700(0x125)]('Error\x20Message:',_0x56eb52),console[_0x5bd700(0x125)]('Full\x20Error\x20Data:',_0x14a13d[_0x5bd700(0xf0)]),loggerService_1[_0x5bd700(0xde)][_0x5bd700(0x133)]('rapyd',_0x5bd700(0x12d),_0x5bd700(0x13d)+_0x3e2b73+_0x5bd700(0x14d)+_0x56eb52);throw new Error(_0x5bd700(0xdd)+_0x3e2b73+_0x5bd700(0x14d)+_0x56eb52);}if(!_0x14a13d[_0x5bd700(0x111)]?.['id']||!_0x14a13d[_0x5bd700(0x111)]?.[_0x5bd700(0xee)]){console[_0x5bd700(0x125)](_0x5bd700(0x117)),console['error']('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console[_0x5bd700(0x125)](_0x5bd700(0xe9),_0x14a13d[_0x5bd700(0x111)]),loggerService_1['loggerService'][_0x5bd700(0x133)](_0x5bd700(0x13f),_0x5bd700(0x12d),_0x5bd700(0xcc));throw new Error(_0x5bd700(0x107));}return console[_0x5bd700(0xcd)](_0x5bd700(0xe2)),console[_0x5bd700(0xcd)](_0x5bd700(0xfb),_0x14a13d[_0x5bd700(0x111)]['id']),console[_0x5bd700(0xcd)]('Redirect\x20URL:',_0x14a13d[_0x5bd700(0x111)][_0x5bd700(0xee)]),console[_0x5bd700(0xcd)](_0x5bd700(0xd6)+_0x2b5aec+_0x5bd700(0xeb)),console[_0x5bd700(0xcd)](_0x5bd700(0xdc)),{'gateway_payment_id':_0x14a13d[_0x5bd700(0x111)]['id'],'payment_url':_0x14a13d[_0x5bd700(0x111)][_0x5bd700(0xee)]};}catch(_0x263e9d){console['error'](_0x5bd700(0x14f)),console['error']('Error\x20details:',_0x263e9d),loggerService_1[_0x5bd700(0xde)]['logWhiteDomainError']('rapyd',_0x5bd700(0x12d),_0x263e9d);if(_0x263e9d instanceof Error){console[_0x5bd700(0x125)](_0x5bd700(0x123),_0x263e9d['message']),console[_0x5bd700(0x125)](_0x5bd700(0x14a),_0x263e9d[_0x5bd700(0x10d)]);throw new Error(_0x5bd700(0x149)+_0x263e9d[_0x5bd700(0x14c)]);}throw new Error(_0x5bd700(0x10e));}}async[a63_0x5b2840(0x14b)](_0x50f6f6){const _0x59c6fe=a63_0x5b2840,_0x2213a5=Date[_0x59c6fe(0xca)]();try{loggerService_1[_0x59c6fe(0xde)][_0x59c6fe(0x144)]('rapyd',_0x59c6fe(0x147)+_0x50f6f6,_0x59c6fe(0x11d),{});const _0x578ea4=await fetch(this['apiUrl']+'/'+_0x50f6f6,{'method':_0x59c6fe(0x11d),'headers':{'Content-Type':_0x59c6fe(0x129),'User-Agent':'Payment\x20System/1.0'}}),_0x2d7e5e=Date[_0x59c6fe(0xca)]()-_0x2213a5;if(!_0x578ea4['ok']){const _0xb2bac1=await _0x578ea4['text']();loggerService_1[_0x59c6fe(0xde)]['logWhiteDomainResponse'](_0x59c6fe(0x13f),'/v1/hosted/payment_links/'+_0x50f6f6,_0x578ea4[_0x59c6fe(0xf0)],_0xb2bac1,_0x2d7e5e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x578ea4['status']);}const _0x57d21b=await _0x578ea4[_0x59c6fe(0x109)]();loggerService_1[_0x59c6fe(0xde)][_0x59c6fe(0x11b)](_0x59c6fe(0x13f),'/v1/hosted/payment_links/'+_0x50f6f6,_0x578ea4['status'],_0x57d21b,_0x2d7e5e);if(_0x57d21b[_0x59c6fe(0xf0)]?.['status']!==_0x59c6fe(0xf8)){loggerService_1[_0x59c6fe(0xde)]['logWhiteDomainError'](_0x59c6fe(0x13f),_0x59c6fe(0x147)+_0x50f6f6,_0x59c6fe(0x122)+(_0x57d21b['status']?.[_0x59c6fe(0x14c)]||'Unknown\x20error'));throw new Error(_0x59c6fe(0x122)+(_0x57d21b[_0x59c6fe(0xf0)]?.[_0x59c6fe(0x14c)]||'Unknown\x20error'));}let _0xe9bf7d=_0x59c6fe(0x104);if(_0x57d21b[_0x59c6fe(0x111)]?.[_0x59c6fe(0xf0)])switch(_0x57d21b[_0x59c6fe(0x111)][_0x59c6fe(0xf0)][_0x59c6fe(0x10c)]()){case _0x59c6fe(0x13c):_0xe9bf7d=_0x59c6fe(0xe5);break;case _0x59c6fe(0xed):_0xe9bf7d=_0x59c6fe(0x142);break;case _0x59c6fe(0x146):_0xe9bf7d=_0x59c6fe(0x130);break;case _0x59c6fe(0x120):_0xe9bf7d=_0x59c6fe(0x142);break;case _0x59c6fe(0xd4):case _0x59c6fe(0xec):default:_0xe9bf7d=_0x59c6fe(0x104);break;}return{'status':_0xe9bf7d,'amount':_0x57d21b[_0x59c6fe(0x111)]?.[_0x59c6fe(0x145)],'currency':_0x57d21b[_0x59c6fe(0x111)]?.[_0x59c6fe(0x137)]};}catch(_0x4ee940){console['error'](_0x59c6fe(0xe6),_0x4ee940),loggerService_1[_0x59c6fe(0xde)]['logWhiteDomainError']('rapyd',_0x59c6fe(0x147)+_0x50f6f6,_0x4ee940);throw new Error(_0x59c6fe(0x118)+(_0x4ee940 instanceof Error?_0x4ee940[_0x59c6fe(0x14c)]:'Unknown\x20error'));}}async['processWebhook'](_0x4afba0){const _0x2ea367=a63_0x5b2840;console[_0x2ea367(0xcd)](_0x2ea367(0x103),_0x4afba0);let _0xc2d355=_0x2ea367(0x104),_0x43514c;_0x4afba0[_0x2ea367(0x111)]?.[_0x2ea367(0xd8)]&&(_0x43514c=_0x4afba0['data'][_0x2ea367(0xd8)],console[_0x2ea367(0xcd)](_0x2ea367(0xd3)+_0x43514c));switch(_0x4afba0[_0x2ea367(0x11c)]?.['toUpperCase']()){case'PAYMENT_COMPLETED':_0x4afba0[_0x2ea367(0x111)]?.[_0x2ea367(0xd9)]===!![]&&_0x4afba0[_0x2ea367(0x111)]?.[_0x2ea367(0xf0)]==='CLO'?_0xc2d355=_0x2ea367(0xe5):_0xc2d355=_0x2ea367(0x104);break;case _0x2ea367(0x138):_0xc2d355=_0x2ea367(0x142);break;case'PAYMENT_EXPIRED':_0xc2d355=_0x2ea367(0x130);break;case'PAYMENT_FAILED':_0xc2d355='FAILED';!_0x43514c&&_0x4afba0[_0x2ea367(0x111)]?.[_0x2ea367(0xd8)]&&(_0x43514c=_0x4afba0[_0x2ea367(0x111)][_0x2ea367(0xd8)]);break;default:switch(_0x4afba0[_0x2ea367(0x111)]?.[_0x2ea367(0xf0)]?.['toUpperCase']()){case'CLO':_0x4afba0[_0x2ea367(0x111)]?.[_0x2ea367(0xd9)]===!![]?_0xc2d355=_0x2ea367(0xe5):_0xc2d355=_0x2ea367(0x142);break;case _0x2ea367(0xed):_0xc2d355=_0x2ea367(0x142);break;case _0x2ea367(0x146):_0xc2d355=_0x2ea367(0x130);break;case _0x2ea367(0x120):_0xc2d355='FAILED';!_0x43514c&&_0x4afba0[_0x2ea367(0x111)]?.[_0x2ea367(0xd8)]&&(_0x43514c=_0x4afba0[_0x2ea367(0x111)]['failure_message']);break;case _0x2ea367(0xd4):case _0x2ea367(0xec):default:_0xc2d355='PENDING';break;}break;}const _0x51f023={};return _0x4afba0[_0x2ea367(0x111)]?.[_0x2ea367(0x112)]?.[_0x2ea367(0x10a)]&&(_0x51f023[_0x2ea367(0xd2)]=_0x4afba0[_0x2ea367(0x111)][_0x2ea367(0x112)][_0x2ea367(0x10a)]),_0x4afba0[_0x2ea367(0x111)]?.[_0x2ea367(0x11f)]&&(_0x51f023[_0x2ea367(0xe3)]=_0x4afba0[_0x2ea367(0x111)][_0x2ea367(0x11f)]),_0x4afba0['data']?.['error_code']&&(_0x51f023[_0x2ea367(0xfe)]=_0x4afba0[_0x2ea367(0x111)]['error_code']),_0x4afba0['data']?.[_0x2ea367(0xf1)]&&(_0x51f023[_0x2ea367(0x139)]=_0x4afba0[_0x2ea367(0x111)]['failure_code']),console[_0x2ea367(0xcd)](_0x2ea367(0xd5)+_0xc2d355+_0x2ea367(0x110)+(_0x43514c||'none')),{'paymentId':_0x4afba0['data']?.['merchant_reference_id']||'','status':_0xc2d355,'amount':_0x4afba0[_0x2ea367(0x111)]?.['amount'],'currency':_0x4afba0[_0x2ea367(0x111)]?.['currency'],'failureMessage':_0x43514c,'additionalInfo':_0x51f023};}}function a63_0x6371(){const _0x31be62=['Error\x20stack:','verifyPayment','message','):\x20','../loggerService','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','apiUrl','now','phone_number','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','log','JSON\x20Parse\x20Error:\x20','1315263PUGVIq','2703232EHnmop','52664RNlWQw','cardLast4','üí•\x20Rapyd\x20failure\x20message:\x20','NEW','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','üá¨üáß\x20Country\x20used:\x20','statusText','failure_message','paid','üá¨üáß\x20Country:\x20','POST','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Rapyd\x20API\x20error\x20(','loggerService','floor','stringify','headers','===\x20RAPYD\x20SUCCESS\x20===','paymentMethod','UNKNOWN','PAID','Rapyd\x20payment\x20verification\x20error:','\x20(always\x20GB\x20for\x20Rapyd)','buy','Response\x20data:','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','\x20(GB\x20-\x20Britain)','ACT','CAN','redirect_url','515316AGnMLd','status','failure_code','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','createPaymentLink','4894830xZomHs','\x20\x20\x20requested_currency:\x20EUR','https://tesoft.uk/gateway/success.php?id=','553FBevrk','SUCCESS','address','4kUAhxG','Payment\x20Link\x20ID:','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','https://tesoft.uk/gateway/rapyd/','errorCode','Response\x20Time:','entries','\x20\x20\x20fixed_side:\x20buy','toISOString','Processing\x20Rapyd\x20webhook:','PENDING','Unknown\x20error\x20from\x20Rapyd\x20API','split','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','gb_mastercard_card','json','last4','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','toUpperCase','stack','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','Response\x20Body:',',\x20failureMessage=','data','payment_method_data','HTTP\x20Status:','gb_visa_card','Status\x20Text:','Error\x20Code:','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','Payment\x20System/1.0','requested_currency','logWhiteDomainResponse','type','GET','üí≥\x20Adding\x20cardholder\x20name:\x20','payment_method_type','ERR','1281114qWikrX','Rapyd\x20API\x20error:\x20','Error\x20message:','Raw\x20Response\x20Body:','error','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','fromEntries','EUR','application/json','defineProperty','Headers:','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','/v1/hosted/payment_links','__esModule','custom_elements','EXPIRED','text','expiration','logWhiteDomainError','parse','https://tesoft.uk/gateway/fail.php?id=','HTTP\x20','currency','PAYMENT_CANCELED','failureCode','Status:','email','CLO','Business\x20Error\x20(','name','rapyd','error_code','Failed\x20to\x20parse\x20JSON\x20response:','FAILED','1176275yCFzmj','logWhiteDomainRequest','amount','EXP','/v1/hosted/payment_links/','cardholder_name','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'];a63_0x6371=function(){return _0x31be62;};return a63_0x6371();}exports['RapydService']=RapydService;