'use strict';const a42_0x53fe73=a42_0x5c5b;function a42_0x2d9d(){const _0x3bd4dc=['json','HTTP\x20','UNKNOWN','EXPIRED','2124370Ufromq','964974UaCTtM','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','text','ACT','üá¨üáß\x20Country:\x20','üá¨üáß\x20Country\x20used:\x20','last4','stack','Request\x20Body\x20(Updated\x20Format):','PENDING','Status:','error_code','logWhiteDomainError','/v1/hosted/payment_links','PAYMENT_FAILED','):\x20','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','NEW','verifyPayment','PAYMENT_CANCELED','logWhiteDomainResponse','CLO','Business\x20Error\x20(','2186466ChuqIM','../loggerService','FAILED','message','PAYMENT_COMPLETED','data','POST','merchant_reference_id','Response\x20data:','Error\x20Code:','Rapyd\x20API\x20error\x20(','SUCCESS','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','Response\x20Time:','Status\x20Text:','headers','now','Error\x20details:','/v1/hosted/payment_links/','gb_mastercard_card','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','Payment\x20Link\x20ID:','rapyd','paymentMethod','Rapyd\x20payment\x20verification\x20error:','HTTP\x20Status:','===\x20RAPYD\x20API\x20ERROR\x20===','none','toUpperCase','loggerService','ERR','statusText','apiUrl','Parsed\x20Result:','HTTP\x20error!\x20status:\x20','status','Processing\x20Rapyd\x20webhook:','error','failureCode','currency','amount','https://tesoft.uk/gateway/rapyd/','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','log','https://tesoft.uk/gateway/success.php?id=','PAID','createPaymentLink','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20',',\x20failureMessage=','Failed\x20to\x20parse\x20JSON\x20response:','RapydService','__esModule','redirect_url','paid','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','type','===\x20RAPYD\x20SUCCESS\x20===','gb_visa_card','Unknown\x20error','failure_code','Missing\x20id\x20or\x20redirect_url\x20in\x20response','payment_method_type','4830784gnqxCl','stringify','Unknown\x20error\x20from\x20Rapyd\x20API','5388515NKuFhJ','cardLast4','4IQWbbd','991089akGsbL','13737144Rbtvjd','\x20(GB\x20-\x20Britain)','processWebhook','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Raw\x20Response\x20Body:','GET','Redirect\x20URL:','entries','Error\x20Message:','üí•\x20Rapyd\x20failure\x20message:\x20','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','CAN','\x20(always\x20GB\x20for\x20Rapyd)','Full\x20Error\x20Data:','JSON\x20Parse\x20Error:\x20','logWhiteDomainRequest','EXP','failure_message'];a42_0x2d9d=function(){return _0x3bd4dc;};return a42_0x2d9d();}(function(_0x3edadb,_0x212fc4){const _0x4f0c04=a42_0x5c5b,_0x306abb=_0x3edadb();while(!![]){try{const _0x150fd7=parseInt(_0x4f0c04(0x17c))/0x1+-parseInt(_0x4f0c04(0x17b))/0x2+parseInt(_0x4f0c04(0x164))/0x3+-parseInt(_0x4f0c04(0x163))/0x4*(parseInt(_0x4f0c04(0x161))/0x5)+parseInt(_0x4f0c04(0x194))/0x6+-parseInt(_0x4f0c04(0x15e))/0x7+parseInt(_0x4f0c04(0x165))/0x8;if(_0x150fd7===_0x212fc4)break;else _0x306abb['push'](_0x306abb['shift']());}catch(_0x76cdd6){_0x306abb['push'](_0x306abb['shift']());}}}(a42_0x2d9d,0x8584b));function a42_0x5c5b(_0x120964,_0x5ae30e){const _0x2d9d55=a42_0x2d9d();return a42_0x5c5b=function(_0x5c5b15,_0x108f9d){_0x5c5b15=_0x5c5b15-0x123;let _0x935b97=_0x2d9d55[_0x5c5b15];return _0x935b97;},a42_0x5c5b(_0x120964,_0x5ae30e);}Object['defineProperty'](exports,a42_0x53fe73(0x153),{'value':!![]}),exports[a42_0x53fe73(0x152)]=void 0x0;const loggerService_1=require(a42_0x53fe73(0x195));class RapydService{constructor(){const _0x47abf5=a42_0x53fe73;this[_0x47abf5(0x140)]=_0x47abf5(0x149),console[_0x47abf5(0x14b)](_0x47abf5(0x168));}async[a42_0x53fe73(0x14e)](_0x53f794){const _0x31b9fa=a42_0x53fe73,{orderId:_0xd33306,orderName:_0x415bab,amount:_0x503121,currency:_0x50f113,usage:_0x16cef2,maxPayments:_0x4f2012,successUrl:_0x4896c8,failUrl:_0x48b936}=_0x53f794,_0x310dde=_0x50f113[_0x31b9fa(0x13c)](),_0x2b6645='GB';console[_0x31b9fa(0x14b)](_0x31b9fa(0x17d));const _0x8e32a3=_0x31b9fa(0x14c)+_0xd33306,_0x2a536d='https://tesoft.uk/gateway/fail.php?id='+_0xd33306,_0x229755={'amount':_0x503121,'currency':_0x310dde,'cancel_checkout_url':_0x2a536d,'complete_checkout_url':_0x8e32a3,'complete_payment_url':_0x8e32a3,'merchant_reference_id':_0xd33306,'description':'ORDER:\x20'+_0xd33306,'country':'GB','payment_method_types_include':[_0x31b9fa(0x159),_0x31b9fa(0x133)],'custom_elements':{'display_description':!![]}},_0x297e15=Date['now']();try{console['log']('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x31b9fa(0x14b)]('URL:',this[_0x31b9fa(0x140)]),console[_0x31b9fa(0x14b)](_0x31b9fa(0x185),JSON[_0x31b9fa(0x15f)](_0x229755,null,0x2)),console[_0x31b9fa(0x14b)](_0x31b9fa(0x181)+_0x2b6645+_0x31b9fa(0x171)),console[_0x31b9fa(0x14b)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x31b9fa(0x13d)][_0x31b9fa(0x174)]('rapyd',_0x31b9fa(0x18a),_0x31b9fa(0x125),_0x229755);const _0x11e1fd=await fetch(this[_0x31b9fa(0x140)],{'method':_0x31b9fa(0x125),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x31b9fa(0x15f)](_0x229755)}),_0xf8197b=Date[_0x31b9fa(0x130)]()-_0x297e15;console[_0x31b9fa(0x14b)](_0x31b9fa(0x14a)),console[_0x31b9fa(0x14b)](_0x31b9fa(0x187),_0x11e1fd[_0x31b9fa(0x143)]),console[_0x31b9fa(0x14b)](_0x31b9fa(0x12e),_0x11e1fd[_0x31b9fa(0x13f)]),console[_0x31b9fa(0x14b)]('Headers:',Object['fromEntries'](_0x11e1fd[_0x31b9fa(0x12f)][_0x31b9fa(0x16c)]())),console[_0x31b9fa(0x14b)](_0x31b9fa(0x12d),_0xf8197b+'ms');const _0x3a03b8=await _0x11e1fd[_0x31b9fa(0x17f)]();console[_0x31b9fa(0x14b)](_0x31b9fa(0x169),_0x3a03b8);if(!_0x11e1fd['ok']){console[_0x31b9fa(0x145)](_0x31b9fa(0x13a)),console[_0x31b9fa(0x145)](_0x31b9fa(0x139),_0x11e1fd[_0x31b9fa(0x143)]),console[_0x31b9fa(0x145)]('Response\x20Body:',_0x3a03b8),loggerService_1[_0x31b9fa(0x13d)][_0x31b9fa(0x191)](_0x31b9fa(0x136),_0x31b9fa(0x18a),_0x11e1fd[_0x31b9fa(0x143)],_0x3a03b8,_0xf8197b),loggerService_1[_0x31b9fa(0x13d)][_0x31b9fa(0x189)](_0x31b9fa(0x136),_0x31b9fa(0x18a),_0x31b9fa(0x178)+_0x11e1fd[_0x31b9fa(0x143)]+':\x20'+_0x3a03b8);throw new Error(_0x31b9fa(0x142)+_0x11e1fd[_0x31b9fa(0x143)]+',\x20body:\x20'+_0x3a03b8);}let _0x2b772d;try{_0x2b772d=JSON['parse'](_0x3a03b8);}catch(_0x2db8a9){console[_0x31b9fa(0x145)](_0x31b9fa(0x151),_0x2db8a9),loggerService_1['loggerService'][_0x31b9fa(0x189)](_0x31b9fa(0x136),_0x31b9fa(0x18a),_0x31b9fa(0x173)+_0x2db8a9);throw new Error(_0x31b9fa(0x14f)+_0x3a03b8);}console[_0x31b9fa(0x14b)](_0x31b9fa(0x134)),console[_0x31b9fa(0x14b)](_0x31b9fa(0x141),JSON[_0x31b9fa(0x15f)](_0x2b772d,null,0x2)),loggerService_1[_0x31b9fa(0x13d)][_0x31b9fa(0x191)](_0x31b9fa(0x136),_0x31b9fa(0x18a),_0x11e1fd[_0x31b9fa(0x143)],_0x2b772d,_0xf8197b);if(_0x2b772d['status']?.[_0x31b9fa(0x143)]!==_0x31b9fa(0x12a)){const _0x265472=_0x2b772d[_0x31b9fa(0x143)]?.[_0x31b9fa(0x197)]||_0x31b9fa(0x160),_0x399085=_0x2b772d['status']?.[_0x31b9fa(0x188)]||_0x31b9fa(0x179);console['error'](_0x31b9fa(0x17e)),console[_0x31b9fa(0x145)](_0x31b9fa(0x128),_0x399085),console['error'](_0x31b9fa(0x16d),_0x265472),console[_0x31b9fa(0x145)](_0x31b9fa(0x172),_0x2b772d[_0x31b9fa(0x143)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x31b9fa(0x136),_0x31b9fa(0x18a),_0x31b9fa(0x193)+_0x399085+'):\x20'+_0x265472);throw new Error(_0x31b9fa(0x129)+_0x399085+_0x31b9fa(0x18c)+_0x265472);}if(!_0x2b772d[_0x31b9fa(0x124)]?.['id']||!_0x2b772d[_0x31b9fa(0x124)]?.['redirect_url']){console[_0x31b9fa(0x145)](_0x31b9fa(0x16f)),console['error'](_0x31b9fa(0x15c)),console[_0x31b9fa(0x145)](_0x31b9fa(0x127),_0x2b772d[_0x31b9fa(0x124)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x31b9fa(0x136),_0x31b9fa(0x18a),_0x31b9fa(0x12c));throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x31b9fa(0x14b)](_0x31b9fa(0x158)),console[_0x31b9fa(0x14b)](_0x31b9fa(0x135),_0x2b772d[_0x31b9fa(0x124)]['id']),console['log'](_0x31b9fa(0x16b),_0x2b772d[_0x31b9fa(0x124)][_0x31b9fa(0x154)]),console['log'](_0x31b9fa(0x182)+_0x2b6645+_0x31b9fa(0x166)),console[_0x31b9fa(0x14b)](_0x31b9fa(0x18d)),{'gateway_payment_id':_0x2b772d[_0x31b9fa(0x124)]['id'],'payment_url':_0x2b772d[_0x31b9fa(0x124)][_0x31b9fa(0x154)]};}catch(_0x5e84b3){console[_0x31b9fa(0x145)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x31b9fa(0x145)](_0x31b9fa(0x131),_0x5e84b3),loggerService_1[_0x31b9fa(0x13d)]['logWhiteDomainError']('rapyd','/v1/hosted/payment_links',_0x5e84b3);if(_0x5e84b3 instanceof Error){console[_0x31b9fa(0x145)]('Error\x20message:',_0x5e84b3[_0x31b9fa(0x197)]),console[_0x31b9fa(0x145)]('Error\x20stack:',_0x5e84b3[_0x31b9fa(0x184)]);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x5e84b3[_0x31b9fa(0x197)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a42_0x53fe73(0x18f)](_0x16bd39){const _0x4116f4=a42_0x53fe73,_0x5b6e8e=Date[_0x4116f4(0x130)]();try{loggerService_1['loggerService'][_0x4116f4(0x174)]('rapyd',_0x4116f4(0x132)+_0x16bd39,_0x4116f4(0x16a),{});const _0x11b9f9=await fetch(this[_0x4116f4(0x140)]+'/'+_0x16bd39,{'method':_0x4116f4(0x16a),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x57a3df=Date['now']()-_0x5b6e8e;if(!_0x11b9f9['ok']){const _0x273bbe=await _0x11b9f9[_0x4116f4(0x17f)]();loggerService_1[_0x4116f4(0x13d)][_0x4116f4(0x191)](_0x4116f4(0x136),_0x4116f4(0x132)+_0x16bd39,_0x11b9f9[_0x4116f4(0x143)],_0x273bbe,_0x57a3df);throw new Error(_0x4116f4(0x142)+_0x11b9f9[_0x4116f4(0x143)]);}const _0x2a4ff4=await _0x11b9f9[_0x4116f4(0x177)]();loggerService_1[_0x4116f4(0x13d)][_0x4116f4(0x191)]('rapyd',_0x4116f4(0x132)+_0x16bd39,_0x11b9f9[_0x4116f4(0x143)],_0x2a4ff4,_0x57a3df);if(_0x2a4ff4[_0x4116f4(0x143)]?.['status']!==_0x4116f4(0x12a)){loggerService_1['loggerService'][_0x4116f4(0x189)](_0x4116f4(0x136),_0x4116f4(0x132)+_0x16bd39,'Rapyd\x20API\x20error:\x20'+(_0x2a4ff4['status']?.[_0x4116f4(0x197)]||_0x4116f4(0x15a)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x2a4ff4[_0x4116f4(0x143)]?.['message']||_0x4116f4(0x15a)));}let _0x451c4a=_0x4116f4(0x186);if(_0x2a4ff4[_0x4116f4(0x124)]?.[_0x4116f4(0x143)])switch(_0x2a4ff4[_0x4116f4(0x124)]['status'][_0x4116f4(0x13c)]()){case _0x4116f4(0x192):_0x451c4a='PAID';break;case _0x4116f4(0x170):_0x451c4a='FAILED';break;case _0x4116f4(0x175):_0x451c4a=_0x4116f4(0x17a);break;case'ERR':_0x451c4a=_0x4116f4(0x196);break;case'NEW':case _0x4116f4(0x180):default:_0x451c4a=_0x4116f4(0x186);break;}return{'status':_0x451c4a,'amount':_0x2a4ff4[_0x4116f4(0x124)]?.[_0x4116f4(0x148)],'currency':_0x2a4ff4[_0x4116f4(0x124)]?.['currency']};}catch(_0x19d1fd){console[_0x4116f4(0x145)](_0x4116f4(0x138),_0x19d1fd),loggerService_1[_0x4116f4(0x13d)][_0x4116f4(0x189)](_0x4116f4(0x136),_0x4116f4(0x132)+_0x16bd39,_0x19d1fd);throw new Error(_0x4116f4(0x12b)+(_0x19d1fd instanceof Error?_0x19d1fd[_0x4116f4(0x197)]:'Unknown\x20error'));}}async[a42_0x53fe73(0x167)](_0x46ba61){const _0x49de50=a42_0x53fe73;console[_0x49de50(0x14b)](_0x49de50(0x144),_0x46ba61);let _0x4af7de=_0x49de50(0x186),_0x3c9ba3;_0x46ba61['data']?.[_0x49de50(0x176)]&&(_0x3c9ba3=_0x46ba61[_0x49de50(0x124)][_0x49de50(0x176)],console[_0x49de50(0x14b)](_0x49de50(0x16e)+_0x3c9ba3));switch(_0x46ba61[_0x49de50(0x157)]?.[_0x49de50(0x13c)]()){case _0x49de50(0x123):_0x46ba61[_0x49de50(0x124)]?.['paid']===!![]&&_0x46ba61['data']?.[_0x49de50(0x143)]===_0x49de50(0x192)?_0x4af7de=_0x49de50(0x14d):_0x4af7de='PENDING';break;case _0x49de50(0x190):_0x4af7de=_0x49de50(0x196);break;case'PAYMENT_EXPIRED':_0x4af7de=_0x49de50(0x17a);break;case _0x49de50(0x18b):_0x4af7de=_0x49de50(0x196);!_0x3c9ba3&&_0x46ba61[_0x49de50(0x124)]?.[_0x49de50(0x176)]&&(_0x3c9ba3=_0x46ba61['data'][_0x49de50(0x176)]);break;default:switch(_0x46ba61[_0x49de50(0x124)]?.[_0x49de50(0x143)]?.[_0x49de50(0x13c)]()){case _0x49de50(0x192):_0x46ba61[_0x49de50(0x124)]?.[_0x49de50(0x155)]===!![]?_0x4af7de=_0x49de50(0x14d):_0x4af7de=_0x49de50(0x196);break;case _0x49de50(0x170):_0x4af7de=_0x49de50(0x196);break;case'EXP':_0x4af7de=_0x49de50(0x17a);break;case _0x49de50(0x13e):_0x4af7de=_0x49de50(0x196);!_0x3c9ba3&&_0x46ba61[_0x49de50(0x124)]?.[_0x49de50(0x176)]&&(_0x3c9ba3=_0x46ba61['data'][_0x49de50(0x176)]);break;case _0x49de50(0x18e):case _0x49de50(0x180):default:_0x4af7de=_0x49de50(0x186);break;}break;}const _0x45ec05={};return _0x46ba61['data']?.['payment_method_data']?.[_0x49de50(0x183)]&&(_0x45ec05[_0x49de50(0x162)]=_0x46ba61['data']['payment_method_data']['last4']),_0x46ba61[_0x49de50(0x124)]?.[_0x49de50(0x15d)]&&(_0x45ec05[_0x49de50(0x137)]=_0x46ba61['data'][_0x49de50(0x15d)]),_0x46ba61['data']?.['error_code']&&(_0x45ec05['errorCode']=_0x46ba61['data'][_0x49de50(0x188)]),_0x46ba61[_0x49de50(0x124)]?.[_0x49de50(0x15b)]&&(_0x45ec05[_0x49de50(0x146)]=_0x46ba61[_0x49de50(0x124)][_0x49de50(0x15b)]),console[_0x49de50(0x14b)](_0x49de50(0x156)+_0x4af7de+_0x49de50(0x150)+(_0x3c9ba3||_0x49de50(0x13b))),{'paymentId':_0x46ba61[_0x49de50(0x124)]?.[_0x49de50(0x126)]||'','status':_0x4af7de,'amount':_0x46ba61[_0x49de50(0x124)]?.['amount'],'currency':_0x46ba61['data']?.[_0x49de50(0x147)],'failureMessage':_0x3c9ba3,'additionalInfo':_0x45ec05};}}exports['RapydService']=RapydService;