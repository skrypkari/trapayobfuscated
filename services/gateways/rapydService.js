'use strict';const a48_0x166b08=a48_0x3853;function a48_0x2474(){const _0x4747bb=['error','91610BcQCiO','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','Rapyd\x20API\x20error:\x20','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','RapydService','parse','PAYMENT_COMPLETED','toISOString','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','EUR','SUCCESS','Response\x20Body:','gb_visa_card','Error\x20stack:','cardLast4','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','apiUrl','gb_mastercard_card','PENDING','Headers:','💥\x20Rapyd\x20failure\x20message:\x20','payment_method_data','Unknown\x20error\x20from\x20Rapyd\x20API','):\x20','\x20\x20\x20expiration:\x20','Status:','Response\x20Time:','URL:','2762898xsOTQO','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','rapyd','Rapyd\x20API\x20error\x20(','ACT','5568932smRbOF','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','ERR','===\x20RAPYD\x20API\x20ERROR\x20===','HTTP\x20Status:','last4','EXP','\x20->\x20EUR:','loggerService','redirect_url','failure_message','json','EXPIRED','message','https://tesoft.uk/gateway/success.php?id=','Full\x20Error\x20Data:','CLO','Unknown\x20error','🔄\x20Rapyd\x20webhook\x20processed:\x20status=','logWhiteDomainResponse','CAN','/v1/hosted/payment_links/','3JJTtDF','application/json','\x20\x20\x20fixed_side:\x20buy','3503376GvulwK','Payment\x20Link\x20ID:','PAYMENT_FAILED','8677730zdwnOe','PAID','createPaymentLink','buy','../loggerService','error_code','POST','none','Status\x20Text:','paid','💱\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','merchant_reference_id','🇬🇧\x20Country:\x20','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','now','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','🇬🇧\x20Country\x20used:\x20','payment_method_type','Processing\x20Rapyd\x20webhook:','FAILED','ORDER:\x20','log','NEW','logWhiteDomainError','stack','paymentMethod','Response\x20data:','amount','failure_code','currency','9919791hZJPaE','HTTP\x20error!\x20status:\x20','status','TesSoft\x20Payment\x20System/1.0','text','===\x20RAPYD\x20SUCCESS\x20===','Error\x20details:','requested_currency','JSON\x20Parse\x20Error:\x20','statusText',',\x20failureMessage=','GET','data','stringify','Raw\x20Response\x20Body:','Error\x20message:','7UAyppM','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','https://tesoft.uk/gateway/fail.php?id=','Rapyd\x20payment\x20verification\x20error:','\x20(always\x20GB\x20for\x20Rapyd)','7329260PhemET','/v1/hosted/payment_links','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','toUpperCase','fixed_side','HTTP\x20','processWebhook','Error\x20Message:','16oOaUKO','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','\x20(GB\x20-\x20Britain)','UNKNOWN'];a48_0x2474=function(){return _0x4747bb;};return a48_0x2474();}(function(_0x11d1a0,_0x534e3f){const _0x1208e7=a48_0x3853,_0x3a40d0=_0x11d1a0();while(!![]){try{const _0x1370af=parseInt(_0x1208e7(0x20d))/0x1*(-parseInt(_0x1208e7(0x21f))/0x2)+parseInt(_0x1208e7(0x1d9))/0x3*(parseInt(_0x1208e7(0x1c3))/0x4)+parseInt(_0x1208e7(0x212))/0x5+-parseInt(_0x1208e7(0x1be))/0x6+-parseInt(_0x1208e7(0x1fd))/0x7+parseInt(_0x1208e7(0x21a))/0x8*(-parseInt(_0x1208e7(0x1dc))/0x9)+parseInt(_0x1208e7(0x1df))/0xa;if(_0x1370af===_0x534e3f)break;else _0x3a40d0['push'](_0x3a40d0['shift']());}catch(_0x2c3008){_0x3a40d0['push'](_0x3a40d0['shift']());}}}(a48_0x2474,0xb6e2b));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a48_0x166b08(0x1a5)]=void 0x0;function a48_0x3853(_0x1d61f4,_0x1b1af6){const _0x2474c1=a48_0x2474();return a48_0x3853=function(_0x38532d,_0x2e2200){_0x38532d=_0x38532d-0x1a5;let _0xe50230=_0x2474c1[_0x38532d];return _0xe50230;},a48_0x3853(_0x1d61f4,_0x1b1af6);}const loggerService_1=require(a48_0x166b08(0x1e3));class RapydService{constructor(){const _0x2e2d7f=a48_0x166b08;this['apiUrl']='https://tesoft.uk/gateway/rapyd/',console[_0x2e2d7f(0x1f4)](_0x2e2d7f(0x1b1));}async[a48_0x166b08(0x1e1)](_0xb7b208){const _0x5e1b9d=a48_0x166b08,{orderId:_0xfe2efc,orderName:_0x54daa1,amount:_0x4dc2cd,currency:_0x626ae6,usage:_0x3b8e2d,maxPayments:_0x1bd59f,successUrl:_0x43c3ae,failUrl:_0x2fd4d7}=_0xb7b208,_0x20d941=_0x626ae6[_0x5e1b9d(0x215)](),_0x31e148='GB';console[_0x5e1b9d(0x1f4)]('🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x380e7f=_0x5e1b9d(0x1d1)+_0xfe2efc,_0x5a594c=_0x5e1b9d(0x20f)+_0xfe2efc,_0x1c5b3b={'amount':_0x4dc2cd,'currency':_0x20d941,'cancel_checkout_url':_0x5a594c,'complete_checkout_url':_0x380e7f,'complete_payment_url':_0x380e7f,'merchant_reference_id':_0xfe2efc,'description':_0x5e1b9d(0x1f3)+_0xfe2efc,'country':'GB','payment_method_types_include':[_0x5e1b9d(0x1ae),_0x5e1b9d(0x1b3)],'custom_elements':{'display_description':!![]}};if(_0x20d941!==_0x5e1b9d(0x1ab)){const _0x4d395d=Math['floor'](Date['now']()/0x3e8)+0x1e*0x3c;_0x1c5b3b[_0x5e1b9d(0x216)]=_0x5e1b9d(0x1e2),_0x1c5b3b[_0x5e1b9d(0x204)]=_0x5e1b9d(0x1ab),_0x1c5b3b['expiration']=_0x4d395d,console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x1e9)+_0x20d941+_0x5e1b9d(0x1ca)),console['log'](_0x5e1b9d(0x1db)),console['log']('\x20\x20\x20requested_currency:\x20EUR'),console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x1ba)+_0x4d395d+'\x20('+new Date(_0x4d395d*0x3e8)[_0x5e1b9d(0x1a8)]()+')');}const _0x3a5c5d=Date[_0x5e1b9d(0x1ed)]();try{console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x20e)),console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x1bd),this['apiUrl']),console[_0x5e1b9d(0x1f4)]('Request\x20Body\x20(Updated\x20Format):',JSON['stringify'](_0x1c5b3b,null,0x2)),console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x1eb)+_0x31e148+_0x5e1b9d(0x211)),console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x1ee)),loggerService_1[_0x5e1b9d(0x1cb)]['logWhiteDomainRequest'](_0x5e1b9d(0x1c0),_0x5e1b9d(0x213),'POST',_0x1c5b3b);const _0x1245f9=await fetch(this[_0x5e1b9d(0x1b2)],{'method':_0x5e1b9d(0x1e5),'headers':{'Content-Type':_0x5e1b9d(0x1da),'User-Agent':_0x5e1b9d(0x200)},'body':JSON[_0x5e1b9d(0x20a)](_0x1c5b3b)}),_0x56b012=Date[_0x5e1b9d(0x1ed)]()-_0x3a5c5d;console[_0x5e1b9d(0x1f4)]('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x1bb),_0x1245f9[_0x5e1b9d(0x1ff)]),console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x1e7),_0x1245f9[_0x5e1b9d(0x206)]),console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x1b5),Object['fromEntries'](_0x1245f9['headers']['entries']())),console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x1bc),_0x56b012+'ms');const _0x2d00b5=await _0x1245f9['text']();console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x20b),_0x2d00b5);if(!_0x1245f9['ok']){console[_0x5e1b9d(0x21e)](_0x5e1b9d(0x1c6)),console[_0x5e1b9d(0x21e)](_0x5e1b9d(0x1c7),_0x1245f9[_0x5e1b9d(0x1ff)]),console[_0x5e1b9d(0x21e)](_0x5e1b9d(0x1ad),_0x2d00b5),loggerService_1[_0x5e1b9d(0x1cb)][_0x5e1b9d(0x1d6)]('rapyd','/v1/hosted/payment_links',_0x1245f9['status'],_0x2d00b5,_0x56b012),loggerService_1[_0x5e1b9d(0x1cb)][_0x5e1b9d(0x1f6)](_0x5e1b9d(0x1c0),_0x5e1b9d(0x213),_0x5e1b9d(0x217)+_0x1245f9[_0x5e1b9d(0x1ff)]+':\x20'+_0x2d00b5);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1245f9[_0x5e1b9d(0x1ff)]+',\x20body:\x20'+_0x2d00b5);}let _0x3966cd;try{_0x3966cd=JSON[_0x5e1b9d(0x1a6)](_0x2d00b5);}catch(_0x176d92){console[_0x5e1b9d(0x21e)](_0x5e1b9d(0x1a9),_0x176d92),loggerService_1[_0x5e1b9d(0x1cb)][_0x5e1b9d(0x1f6)](_0x5e1b9d(0x1c0),'/v1/hosted/payment_links',_0x5e1b9d(0x205)+_0x176d92);throw new Error(_0x5e1b9d(0x1bf)+_0x2d00b5);}console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x222)),console['log']('Parsed\x20Result:',JSON[_0x5e1b9d(0x20a)](_0x3966cd,null,0x2)),loggerService_1[_0x5e1b9d(0x1cb)]['logWhiteDomainResponse']('rapyd',_0x5e1b9d(0x213),_0x1245f9[_0x5e1b9d(0x1ff)],_0x3966cd,_0x56b012);if(_0x3966cd[_0x5e1b9d(0x1ff)]?.['status']!==_0x5e1b9d(0x1ac)){const _0xf11ae4=_0x3966cd[_0x5e1b9d(0x1ff)]?.[_0x5e1b9d(0x1d0)]||_0x5e1b9d(0x1b8),_0xb50ff9=_0x3966cd[_0x5e1b9d(0x1ff)]?.[_0x5e1b9d(0x1e4)]||_0x5e1b9d(0x21d);console['error'](_0x5e1b9d(0x1c4)),console[_0x5e1b9d(0x21e)]('Error\x20Code:',_0xb50ff9),console[_0x5e1b9d(0x21e)](_0x5e1b9d(0x219),_0xf11ae4),console[_0x5e1b9d(0x21e)](_0x5e1b9d(0x1d2),_0x3966cd[_0x5e1b9d(0x1ff)]),loggerService_1['loggerService'][_0x5e1b9d(0x1f6)]('rapyd','/v1/hosted/payment_links','Business\x20Error\x20('+_0xb50ff9+'):\x20'+_0xf11ae4);throw new Error(_0x5e1b9d(0x1c1)+_0xb50ff9+_0x5e1b9d(0x1b9)+_0xf11ae4);}if(!_0x3966cd[_0x5e1b9d(0x209)]?.['id']||!_0x3966cd['data']?.[_0x5e1b9d(0x1cc)]){console['error'](_0x5e1b9d(0x1ec)),console[_0x5e1b9d(0x21e)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console[_0x5e1b9d(0x21e)](_0x5e1b9d(0x1f9),_0x3966cd['data']),loggerService_1[_0x5e1b9d(0x1cb)][_0x5e1b9d(0x1f6)](_0x5e1b9d(0x1c0),_0x5e1b9d(0x213),_0x5e1b9d(0x21b));throw new Error(_0x5e1b9d(0x1aa));}return console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x202)),console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x1dd),_0x3966cd[_0x5e1b9d(0x209)]['id']),console[_0x5e1b9d(0x1f4)]('Redirect\x20URL:',_0x3966cd[_0x5e1b9d(0x209)][_0x5e1b9d(0x1cc)]),console[_0x5e1b9d(0x1f4)](_0x5e1b9d(0x1ef)+_0x31e148+_0x5e1b9d(0x21c)),console['log'](_0x5e1b9d(0x1ee)),{'gateway_payment_id':_0x3966cd['data']['id'],'payment_url':_0x3966cd['data'][_0x5e1b9d(0x1cc)]};}catch(_0x5b7bba){console[_0x5e1b9d(0x21e)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x5e1b9d(0x21e)](_0x5e1b9d(0x203),_0x5b7bba),loggerService_1['loggerService']['logWhiteDomainError']('rapyd','/v1/hosted/payment_links',_0x5b7bba);if(_0x5b7bba instanceof Error){console[_0x5e1b9d(0x21e)](_0x5e1b9d(0x20c),_0x5b7bba[_0x5e1b9d(0x1d0)]),console[_0x5e1b9d(0x21e)](_0x5e1b9d(0x1af),_0x5b7bba[_0x5e1b9d(0x1f7)]);throw new Error(_0x5e1b9d(0x220)+_0x5b7bba['message']);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x38c729){const _0x457fe2=a48_0x166b08,_0x3405c9=Date[_0x457fe2(0x1ed)]();try{loggerService_1['loggerService']['logWhiteDomainRequest']('rapyd',_0x457fe2(0x1d8)+_0x38c729,_0x457fe2(0x208),{});const _0x2ab55e=await fetch(this[_0x457fe2(0x1b2)]+'/'+_0x38c729,{'method':_0x457fe2(0x208),'headers':{'Content-Type':_0x457fe2(0x1da),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x56323e=Date[_0x457fe2(0x1ed)]()-_0x3405c9;if(!_0x2ab55e['ok']){const _0x59fec7=await _0x2ab55e[_0x457fe2(0x201)]();loggerService_1[_0x457fe2(0x1cb)][_0x457fe2(0x1d6)](_0x457fe2(0x1c0),'/v1/hosted/payment_links/'+_0x38c729,_0x2ab55e[_0x457fe2(0x1ff)],_0x59fec7,_0x56323e);throw new Error(_0x457fe2(0x1fe)+_0x2ab55e[_0x457fe2(0x1ff)]);}const _0x1073cf=await _0x2ab55e[_0x457fe2(0x1ce)]();loggerService_1[_0x457fe2(0x1cb)]['logWhiteDomainResponse'](_0x457fe2(0x1c0),_0x457fe2(0x1d8)+_0x38c729,_0x2ab55e['status'],_0x1073cf,_0x56323e);if(_0x1073cf['status']?.[_0x457fe2(0x1ff)]!==_0x457fe2(0x1ac)){loggerService_1[_0x457fe2(0x1cb)][_0x457fe2(0x1f6)](_0x457fe2(0x1c0),_0x457fe2(0x1d8)+_0x38c729,'Rapyd\x20API\x20error:\x20'+(_0x1073cf['status']?.['message']||'Unknown\x20error'));throw new Error(_0x457fe2(0x221)+(_0x1073cf[_0x457fe2(0x1ff)]?.[_0x457fe2(0x1d0)]||_0x457fe2(0x1d4)));}let _0x4d0548=_0x457fe2(0x1b4);if(_0x1073cf[_0x457fe2(0x209)]?.[_0x457fe2(0x1ff)])switch(_0x1073cf[_0x457fe2(0x209)][_0x457fe2(0x1ff)][_0x457fe2(0x215)]()){case _0x457fe2(0x1d3):_0x4d0548='PAID';break;case'CAN':_0x4d0548=_0x457fe2(0x1f2);break;case _0x457fe2(0x1c9):_0x4d0548=_0x457fe2(0x1cf);break;case'ERR':_0x4d0548='FAILED';break;case _0x457fe2(0x1f5):case _0x457fe2(0x1c2):default:_0x4d0548=_0x457fe2(0x1b4);break;}return{'status':_0x4d0548,'amount':_0x1073cf['data']?.[_0x457fe2(0x1fa)],'currency':_0x1073cf[_0x457fe2(0x209)]?.[_0x457fe2(0x1fc)]};}catch(_0x10c2a2){console['error'](_0x457fe2(0x210),_0x10c2a2),loggerService_1[_0x457fe2(0x1cb)][_0x457fe2(0x1f6)](_0x457fe2(0x1c0),_0x457fe2(0x1d8)+_0x38c729,_0x10c2a2);throw new Error(_0x457fe2(0x214)+(_0x10c2a2 instanceof Error?_0x10c2a2['message']:_0x457fe2(0x1d4)));}}async[a48_0x166b08(0x218)](_0x38f286){const _0x1e8f72=a48_0x166b08;console[_0x1e8f72(0x1f4)](_0x1e8f72(0x1f1),_0x38f286);let _0x111e83='PENDING',_0x92abac;_0x38f286['data']?.[_0x1e8f72(0x1cd)]&&(_0x92abac=_0x38f286[_0x1e8f72(0x209)][_0x1e8f72(0x1cd)],console[_0x1e8f72(0x1f4)](_0x1e8f72(0x1b6)+_0x92abac));switch(_0x38f286['type']?.[_0x1e8f72(0x215)]()){case _0x1e8f72(0x1a7):_0x38f286[_0x1e8f72(0x209)]?.['paid']===!![]&&_0x38f286[_0x1e8f72(0x209)]?.[_0x1e8f72(0x1ff)]===_0x1e8f72(0x1d3)?_0x111e83='PAID':_0x111e83=_0x1e8f72(0x1b4);break;case'PAYMENT_CANCELED':_0x111e83=_0x1e8f72(0x1f2);break;case'PAYMENT_EXPIRED':_0x111e83='EXPIRED';break;case _0x1e8f72(0x1de):_0x111e83='FAILED';!_0x92abac&&_0x38f286['data']?.['failure_message']&&(_0x92abac=_0x38f286['data'][_0x1e8f72(0x1cd)]);break;default:switch(_0x38f286['data']?.[_0x1e8f72(0x1ff)]?.[_0x1e8f72(0x215)]()){case _0x1e8f72(0x1d3):_0x38f286[_0x1e8f72(0x209)]?.[_0x1e8f72(0x1e8)]===!![]?_0x111e83=_0x1e8f72(0x1e0):_0x111e83='FAILED';break;case _0x1e8f72(0x1d7):_0x111e83=_0x1e8f72(0x1f2);break;case'EXP':_0x111e83=_0x1e8f72(0x1cf);break;case _0x1e8f72(0x1c5):_0x111e83='FAILED';!_0x92abac&&_0x38f286[_0x1e8f72(0x209)]?.[_0x1e8f72(0x1cd)]&&(_0x92abac=_0x38f286['data'][_0x1e8f72(0x1cd)]);break;case _0x1e8f72(0x1f5):case _0x1e8f72(0x1c2):default:_0x111e83=_0x1e8f72(0x1b4);break;}break;}const _0x254a10={};return _0x38f286[_0x1e8f72(0x209)]?.[_0x1e8f72(0x1b7)]?.['last4']&&(_0x254a10[_0x1e8f72(0x1b0)]=_0x38f286['data'][_0x1e8f72(0x1b7)][_0x1e8f72(0x1c8)]),_0x38f286[_0x1e8f72(0x209)]?.[_0x1e8f72(0x1f0)]&&(_0x254a10[_0x1e8f72(0x1f8)]=_0x38f286['data']['payment_method_type']),_0x38f286[_0x1e8f72(0x209)]?.[_0x1e8f72(0x1e4)]&&(_0x254a10['errorCode']=_0x38f286[_0x1e8f72(0x209)][_0x1e8f72(0x1e4)]),_0x38f286[_0x1e8f72(0x209)]?.[_0x1e8f72(0x1fb)]&&(_0x254a10['failureCode']=_0x38f286[_0x1e8f72(0x209)]['failure_code']),console[_0x1e8f72(0x1f4)](_0x1e8f72(0x1d5)+_0x111e83+_0x1e8f72(0x207)+(_0x92abac||_0x1e8f72(0x1e6))),{'paymentId':_0x38f286[_0x1e8f72(0x209)]?.[_0x1e8f72(0x1ea)]||'','status':_0x111e83,'amount':_0x38f286[_0x1e8f72(0x209)]?.[_0x1e8f72(0x1fa)],'currency':_0x38f286['data']?.[_0x1e8f72(0x1fc)],'failureMessage':_0x92abac,'additionalInfo':_0x254a10};}}exports[a48_0x166b08(0x1a5)]=RapydService;