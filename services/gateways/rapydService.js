'use strict';const a45_0x6c8420=a45_0x5735;(function(_0x33e7c2,_0x2c60c5){const _0x3f961e=a45_0x5735,_0x3ac302=_0x33e7c2();while(!![]){try{const _0x1bc7d1=-parseInt(_0x3f961e(0x216))/0x1*(parseInt(_0x3f961e(0x20c))/0x2)+parseInt(_0x3f961e(0x214))/0x3+-parseInt(_0x3f961e(0x231))/0x4+-parseInt(_0x3f961e(0x1ef))/0x5*(parseInt(_0x3f961e(0x21c))/0x6)+parseInt(_0x3f961e(0x219))/0x7*(parseInt(_0x3f961e(0x21e))/0x8)+parseInt(_0x3f961e(0x1f7))/0x9+-parseInt(_0x3f961e(0x205))/0xa*(-parseInt(_0x3f961e(0x1e1))/0xb);if(_0x1bc7d1===_0x2c60c5)break;else _0x3ac302['push'](_0x3ac302['shift']());}catch(_0x39d0cd){_0x3ac302['push'](_0x3ac302['shift']());}}}(a45_0x1b5b,0x64367));function a45_0x1b5b(){const _0x5a7748=['/v1/hosted/payment_links','amount','paymentMethod','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','üí•\x20Rapyd\x20failure\x20message:\x20','Response\x20Body:','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','text','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','===\x20RAPYD\x20API\x20ERROR\x20===','\x20(GB\x20-\x20Britain)','PAYMENT_FAILED','3227388aZhbxf','Rapyd\x20payment\x20verification\x20error:','):\x20','Rapyd\x20API\x20error:\x20','===\x20RAPYD\x20SUCCESS\x20===','Unknown\x20error','entries',',\x20body:\x20','URL:','error_code','Error\x20stack:','cardLast4','type','EXP','ERR','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','gb_visa_card','PAID','\x20(always\x20GB\x20for\x20Rapyd)','Response\x20data:','apiUrl','TesSoft\x20Payment\x20System/1.0','https://tesoft.uk/gateway/fail.php?id=','Missing\x20id\x20or\x20redirect_url\x20in\x20response','HTTP\x20error!\x20status:\x20','GET','toUpperCase','stack','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','last4','data','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','rapyd','JSON\x20Parse\x20Error:\x20','Unknown\x20error\x20from\x20Rapyd\x20API','logWhiteDomainRequest','67991CeScqJ','paid','CAN','fromEntries','logWhiteDomainResponse','Redirect\x20URL:','gb_mastercard_card','__esModule','RapydService','PAYMENT_EXPIRED','HTTP\x20','/v1/hosted/payment_links/','Processing\x20Rapyd\x20webhook:','UNKNOWN','2155ZBIqDa','Status:','https://tesoft.uk/gateway/success.php?id=','errorCode','error','payment_method_data','Headers:','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','1805004EYcetK','json','NEW','Response\x20Time:','processWebhook','failure_code','Rapyd\x20API\x20error\x20(','createPaymentLink','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','Raw\x20Response\x20Body:','üá¨üáß\x20Country:\x20','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','PENDING','Error\x20details:','1020iAdfPF','EXPIRED','POST','merchant_reference_id','payment_method_type','Error\x20message:','Error\x20Code:','192UNWCwO','loggerService','Full\x20Error\x20Data:','message','log','logWhiteDomainError','Error\x20Message:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','1153236CYLkbJ','FAILED','1865ADvTLJ','CLO','statusText','9093VGNSlL','redirect_url','defineProperty','2400bEQpeu','now','2176cklxuQ','currency','failure_message','status','SUCCESS','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='];a45_0x1b5b=function(){return _0x5a7748;};return a45_0x1b5b();}function a45_0x5735(_0x2ba2e2,_0x312df1){const _0x1b5bf5=a45_0x1b5b();return a45_0x5735=function(_0x57359f,_0xb32f4c){_0x57359f=_0x57359f-0x1c2;let _0x5bc8e4=_0x1b5bf5[_0x57359f];return _0x5bc8e4;},a45_0x5735(_0x2ba2e2,_0x312df1);}Object[a45_0x6c8420(0x21b)](exports,a45_0x6c8420(0x1e8),{'value':!![]}),exports[a45_0x6c8420(0x1e9)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x4dd35b=a45_0x6c8420;this['apiUrl']='https://tesoft.uk/gateway/rapyd/',console[_0x4dd35b(0x210)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a45_0x6c8420(0x1fe)](_0x1d35d0){const _0x2b8a3c=a45_0x6c8420,{orderId:_0x1f7fcf,orderName:_0x40a1c3,amount:_0x30551d,currency:_0x10f9ef,usage:_0x18b825,maxPayments:_0x5c69f9,successUrl:_0x323609,failUrl:_0x42d28a}=_0x1d35d0,_0x4951b3=_0x10f9ef[_0x2b8a3c(0x1d7)](),_0x35f834='GB';console[_0x2b8a3c(0x210)]('üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x5c106e=_0x2b8a3c(0x1f1)+_0x1f7fcf,_0x8167cd=_0x2b8a3c(0x1d3)+_0x1f7fcf,_0xa47f56={'amount':_0x30551d,'currency':_0x4951b3,'cancel_checkout_url':_0x8167cd,'complete_checkout_url':_0x5c106e,'complete_payment_url':_0x5c106e,'merchant_reference_id':_0x1f7fcf,'description':'ORDER:\x20'+_0x1f7fcf,'country':'GB','payment_method_types_include':[_0x2b8a3c(0x1cd),_0x2b8a3c(0x1e7)],'custom_elements':{'display_description':!![]}},_0x4a3acd=Date[_0x2b8a3c(0x21d)]();try{console[_0x2b8a3c(0x210)](_0x2b8a3c(0x1f6)),console[_0x2b8a3c(0x210)](_0x2b8a3c(0x1c5),this[_0x2b8a3c(0x1d1)]),console[_0x2b8a3c(0x210)]('Request\x20Body\x20(Updated\x20Format):',JSON['stringify'](_0xa47f56,null,0x2)),console[_0x2b8a3c(0x210)](_0x2b8a3c(0x201)+_0x35f834+_0x2b8a3c(0x1cf)),console[_0x2b8a3c(0x210)](_0x2b8a3c(0x1dc)),loggerService_1[_0x2b8a3c(0x20d)][_0x2b8a3c(0x1e0)]('rapyd',_0x2b8a3c(0x225),_0x2b8a3c(0x207),_0xa47f56);const _0x96c8e7=await fetch(this[_0x2b8a3c(0x1d1)],{'method':_0x2b8a3c(0x207),'headers':{'Content-Type':'application/json','User-Agent':_0x2b8a3c(0x1d2)},'body':JSON['stringify'](_0xa47f56)}),_0x2e7a5a=Date[_0x2b8a3c(0x21d)]()-_0x4a3acd;console[_0x2b8a3c(0x210)](_0x2b8a3c(0x224)),console['log'](_0x2b8a3c(0x1f0),_0x96c8e7[_0x2b8a3c(0x221)]),console[_0x2b8a3c(0x210)]('Status\x20Text:',_0x96c8e7[_0x2b8a3c(0x218)]),console[_0x2b8a3c(0x210)](_0x2b8a3c(0x1f5),Object[_0x2b8a3c(0x1e4)](_0x96c8e7['headers'][_0x2b8a3c(0x1c3)]())),console[_0x2b8a3c(0x210)](_0x2b8a3c(0x1fa),_0x2e7a5a+'ms');const _0x11f00d=await _0x96c8e7[_0x2b8a3c(0x22c)]();console['log'](_0x2b8a3c(0x200),_0x11f00d);if(!_0x96c8e7['ok']){console[_0x2b8a3c(0x1f3)](_0x2b8a3c(0x22e)),console[_0x2b8a3c(0x1f3)]('HTTP\x20Status:',_0x96c8e7[_0x2b8a3c(0x221)]),console['error'](_0x2b8a3c(0x22a),_0x11f00d),loggerService_1['loggerService'][_0x2b8a3c(0x1e5)](_0x2b8a3c(0x1dd),_0x2b8a3c(0x225),_0x96c8e7[_0x2b8a3c(0x221)],_0x11f00d,_0x2e7a5a),loggerService_1['loggerService']['logWhiteDomainError'](_0x2b8a3c(0x1dd),'/v1/hosted/payment_links',_0x2b8a3c(0x1eb)+_0x96c8e7[_0x2b8a3c(0x221)]+':\x20'+_0x11f00d);throw new Error(_0x2b8a3c(0x1d5)+_0x96c8e7['status']+_0x2b8a3c(0x1c4)+_0x11f00d);}let _0x12c1bb;try{_0x12c1bb=JSON['parse'](_0x11f00d);}catch(_0x139092){console[_0x2b8a3c(0x1f3)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x139092),loggerService_1[_0x2b8a3c(0x20d)][_0x2b8a3c(0x211)](_0x2b8a3c(0x1dd),'/v1/hosted/payment_links',_0x2b8a3c(0x1de)+_0x139092);throw new Error(_0x2b8a3c(0x22b)+_0x11f00d);}console[_0x2b8a3c(0x210)](_0x2b8a3c(0x1d9)),console[_0x2b8a3c(0x210)]('Parsed\x20Result:',JSON['stringify'](_0x12c1bb,null,0x2)),loggerService_1[_0x2b8a3c(0x20d)]['logWhiteDomainResponse'](_0x2b8a3c(0x1dd),'/v1/hosted/payment_links',_0x96c8e7[_0x2b8a3c(0x221)],_0x12c1bb,_0x2e7a5a);if(_0x12c1bb[_0x2b8a3c(0x221)]?.[_0x2b8a3c(0x221)]!=='SUCCESS'){const _0xd31f48=_0x12c1bb[_0x2b8a3c(0x221)]?.[_0x2b8a3c(0x20f)]||_0x2b8a3c(0x1df),_0x445168=_0x12c1bb[_0x2b8a3c(0x221)]?.['error_code']||_0x2b8a3c(0x1ee);console[_0x2b8a3c(0x1f3)](_0x2b8a3c(0x228)),console['error'](_0x2b8a3c(0x20b),_0x445168),console[_0x2b8a3c(0x1f3)](_0x2b8a3c(0x212),_0xd31f48),console[_0x2b8a3c(0x1f3)](_0x2b8a3c(0x20e),_0x12c1bb[_0x2b8a3c(0x221)]),loggerService_1[_0x2b8a3c(0x20d)][_0x2b8a3c(0x211)](_0x2b8a3c(0x1dd),_0x2b8a3c(0x225),'Business\x20Error\x20('+_0x445168+_0x2b8a3c(0x233)+_0xd31f48);throw new Error(_0x2b8a3c(0x1fd)+_0x445168+_0x2b8a3c(0x233)+_0xd31f48);}if(!_0x12c1bb['data']?.['id']||!_0x12c1bb[_0x2b8a3c(0x1db)]?.[_0x2b8a3c(0x21a)]){console['error']('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2b8a3c(0x1f3)](_0x2b8a3c(0x1d4)),console[_0x2b8a3c(0x1f3)](_0x2b8a3c(0x1d0),_0x12c1bb[_0x2b8a3c(0x1db)]),loggerService_1[_0x2b8a3c(0x20d)]['logWhiteDomainError']('rapyd',_0x2b8a3c(0x225),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x2b8a3c(0x223));}return console[_0x2b8a3c(0x210)](_0x2b8a3c(0x235)),console[_0x2b8a3c(0x210)]('Payment\x20Link\x20ID:',_0x12c1bb[_0x2b8a3c(0x1db)]['id']),console[_0x2b8a3c(0x210)](_0x2b8a3c(0x1e6),_0x12c1bb[_0x2b8a3c(0x1db)][_0x2b8a3c(0x21a)]),console[_0x2b8a3c(0x210)]('üá¨üáß\x20Country\x20used:\x20'+_0x35f834+_0x2b8a3c(0x22f)),console[_0x2b8a3c(0x210)](_0x2b8a3c(0x1dc)),{'gateway_payment_id':_0x12c1bb[_0x2b8a3c(0x1db)]['id'],'payment_url':_0x12c1bb[_0x2b8a3c(0x1db)]['redirect_url']};}catch(_0x5a4d42){console['error'](_0x2b8a3c(0x1ff)),console[_0x2b8a3c(0x1f3)](_0x2b8a3c(0x204),_0x5a4d42),loggerService_1['loggerService'][_0x2b8a3c(0x211)](_0x2b8a3c(0x1dd),_0x2b8a3c(0x225),_0x5a4d42);if(_0x5a4d42 instanceof Error){console['error'](_0x2b8a3c(0x20a),_0x5a4d42[_0x2b8a3c(0x20f)]),console[_0x2b8a3c(0x1f3)](_0x2b8a3c(0x1c7),_0x5a4d42[_0x2b8a3c(0x1d8)]);throw new Error(_0x2b8a3c(0x213)+_0x5a4d42[_0x2b8a3c(0x20f)]);}throw new Error(_0x2b8a3c(0x1cc));}}async['verifyPayment'](_0x47e707){const _0x147382=a45_0x6c8420,_0x1b6258=Date['now']();try{loggerService_1[_0x147382(0x20d)]['logWhiteDomainRequest'](_0x147382(0x1dd),'/v1/hosted/payment_links/'+_0x47e707,_0x147382(0x1d6),{});const _0x5086a7=await fetch(this[_0x147382(0x1d1)]+'/'+_0x47e707,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x147382(0x1d2)}}),_0x442ade=Date[_0x147382(0x21d)]()-_0x1b6258;if(!_0x5086a7['ok']){const _0x11c636=await _0x5086a7[_0x147382(0x22c)]();loggerService_1[_0x147382(0x20d)][_0x147382(0x1e5)]('rapyd',_0x147382(0x1ec)+_0x47e707,_0x5086a7[_0x147382(0x221)],_0x11c636,_0x442ade);throw new Error(_0x147382(0x1d5)+_0x5086a7['status']);}const _0x15bf8b=await _0x5086a7[_0x147382(0x1f8)]();loggerService_1[_0x147382(0x20d)][_0x147382(0x1e5)](_0x147382(0x1dd),'/v1/hosted/payment_links/'+_0x47e707,_0x5086a7['status'],_0x15bf8b,_0x442ade);if(_0x15bf8b[_0x147382(0x221)]?.[_0x147382(0x221)]!==_0x147382(0x222)){loggerService_1[_0x147382(0x20d)][_0x147382(0x211)](_0x147382(0x1dd),_0x147382(0x1ec)+_0x47e707,'Rapyd\x20API\x20error:\x20'+(_0x15bf8b[_0x147382(0x221)]?.['message']||'Unknown\x20error'));throw new Error(_0x147382(0x234)+(_0x15bf8b[_0x147382(0x221)]?.[_0x147382(0x20f)]||'Unknown\x20error'));}let _0x4428cf=_0x147382(0x203);if(_0x15bf8b['data']?.[_0x147382(0x221)])switch(_0x15bf8b[_0x147382(0x1db)]['status'][_0x147382(0x1d7)]()){case _0x147382(0x217):_0x4428cf=_0x147382(0x1ce);break;case _0x147382(0x1e3):_0x4428cf=_0x147382(0x215);break;case _0x147382(0x1ca):_0x4428cf=_0x147382(0x206);break;case _0x147382(0x1cb):_0x4428cf='FAILED';break;case _0x147382(0x1f9):case'ACT':default:_0x4428cf='PENDING';break;}return{'status':_0x4428cf,'amount':_0x15bf8b[_0x147382(0x1db)]?.[_0x147382(0x226)],'currency':_0x15bf8b[_0x147382(0x1db)]?.[_0x147382(0x21f)]};}catch(_0x235d87){console[_0x147382(0x1f3)](_0x147382(0x232),_0x235d87),loggerService_1[_0x147382(0x20d)][_0x147382(0x211)]('rapyd',_0x147382(0x1ec)+_0x47e707,_0x235d87);throw new Error(_0x147382(0x202)+(_0x235d87 instanceof Error?_0x235d87[_0x147382(0x20f)]:_0x147382(0x1c2)));}}async[a45_0x6c8420(0x1fb)](_0x3cf0a5){const _0x217f4d=a45_0x6c8420;console['log'](_0x217f4d(0x1ed),_0x3cf0a5);let _0x1d8cc2=_0x217f4d(0x203),_0x50a199;_0x3cf0a5[_0x217f4d(0x1db)]?.[_0x217f4d(0x220)]&&(_0x50a199=_0x3cf0a5[_0x217f4d(0x1db)]['failure_message'],console['log'](_0x217f4d(0x229)+_0x50a199));switch(_0x3cf0a5[_0x217f4d(0x1c9)]?.['toUpperCase']()){case'PAYMENT_COMPLETED':_0x3cf0a5[_0x217f4d(0x1db)]?.[_0x217f4d(0x1e2)]===!![]&&_0x3cf0a5['data']?.[_0x217f4d(0x221)]===_0x217f4d(0x217)?_0x1d8cc2='PAID':_0x1d8cc2=_0x217f4d(0x203);break;case'PAYMENT_CANCELED':_0x1d8cc2=_0x217f4d(0x215);break;case _0x217f4d(0x1ea):_0x1d8cc2=_0x217f4d(0x206);break;case _0x217f4d(0x230):_0x1d8cc2='FAILED';!_0x50a199&&_0x3cf0a5[_0x217f4d(0x1db)]?.[_0x217f4d(0x220)]&&(_0x50a199=_0x3cf0a5[_0x217f4d(0x1db)][_0x217f4d(0x220)]);break;default:switch(_0x3cf0a5[_0x217f4d(0x1db)]?.[_0x217f4d(0x221)]?.[_0x217f4d(0x1d7)]()){case _0x217f4d(0x217):_0x3cf0a5['data']?.[_0x217f4d(0x1e2)]===!![]?_0x1d8cc2=_0x217f4d(0x1ce):_0x1d8cc2=_0x217f4d(0x215);break;case _0x217f4d(0x1e3):_0x1d8cc2=_0x217f4d(0x215);break;case'EXP':_0x1d8cc2=_0x217f4d(0x206);break;case _0x217f4d(0x1cb):_0x1d8cc2=_0x217f4d(0x215);!_0x50a199&&_0x3cf0a5['data']?.['failure_message']&&(_0x50a199=_0x3cf0a5[_0x217f4d(0x1db)][_0x217f4d(0x220)]);break;case'NEW':case'ACT':default:_0x1d8cc2=_0x217f4d(0x203);break;}break;}const _0xea49d8={};return _0x3cf0a5[_0x217f4d(0x1db)]?.[_0x217f4d(0x1f4)]?.[_0x217f4d(0x1da)]&&(_0xea49d8[_0x217f4d(0x1c8)]=_0x3cf0a5[_0x217f4d(0x1db)][_0x217f4d(0x1f4)]['last4']),_0x3cf0a5[_0x217f4d(0x1db)]?.[_0x217f4d(0x209)]&&(_0xea49d8[_0x217f4d(0x227)]=_0x3cf0a5[_0x217f4d(0x1db)]['payment_method_type']),_0x3cf0a5[_0x217f4d(0x1db)]?.[_0x217f4d(0x1c6)]&&(_0xea49d8[_0x217f4d(0x1f2)]=_0x3cf0a5[_0x217f4d(0x1db)][_0x217f4d(0x1c6)]),_0x3cf0a5[_0x217f4d(0x1db)]?.[_0x217f4d(0x1fc)]&&(_0xea49d8['failureCode']=_0x3cf0a5[_0x217f4d(0x1db)][_0x217f4d(0x1fc)]),console[_0x217f4d(0x210)](_0x217f4d(0x22d)+_0x1d8cc2+',\x20failureMessage='+(_0x50a199||'none')),{'paymentId':_0x3cf0a5['data']?.[_0x217f4d(0x208)]||'','status':_0x1d8cc2,'amount':_0x3cf0a5[_0x217f4d(0x1db)]?.['amount'],'currency':_0x3cf0a5[_0x217f4d(0x1db)]?.['currency'],'failureMessage':_0x50a199,'additionalInfo':_0xea49d8};}}exports[a45_0x6c8420(0x1e9)]=RapydService;