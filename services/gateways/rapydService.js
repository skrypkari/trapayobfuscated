'use strict';const a49_0x568ff4=a49_0x53e2;function a49_0x3d3e(){const _0x2cb1dd=['\x20\x20\x20fixed_side:\x20buy','toUpperCase','4578RrPwEv','ERR','🇬🇧\x20Country:\x20','51058089dEvtvy','now','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','Processing\x20Rapyd\x20webhook:','PAYMENT_EXPIRED','error_code','12709480fogxzB',',\x20failureMessage=','gb_visa_card','3427580QtrRPL','UNKNOWN','requested_currency','FAILED','payment_method_data','Payment\x20Link\x20ID:','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','GET','/v1/hosted/payment_links','\x20\x20\x20expiration:\x20','URL:','paid','Raw\x20Response\x20Body:','Rapyd\x20API\x20error\x20(','PAYMENT_FAILED','../loggerService','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','error','toISOString','4086565VaUODk','Response\x20Time:','EXP','/v1/hosted/payment_links/','Business\x20Error\x20(','type','apiUrl','🇬🇧\x20Country\x20used:\x20','💱\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','1769254omFuJZ','currency','\x20\x20\x20requested_currency:\x20EUR','failure_message','Error\x20stack:','PAID','fromEntries','payment_method_type','verifyPayment','log','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','logWhiteDomainRequest','💥\x20Rapyd\x20failure\x20message:\x20','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','expiration','merchant_reference_id','https://tesoft.uk/gateway/rapyd/','CLO','9121wrUzOq','Rapyd\x20API\x20error:\x20','json','PAYMENT_COMPLETED','Missing\x20id\x20or\x20redirect_url\x20in\x20response','data','TesSoft\x20Payment\x20System/1.0','rapyd','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','RapydService','headers','Status:','buy','CAN','amount','Status\x20Text:','failure_code','NEW','EXPIRED','logWhiteDomainError','ACT','EUR','createPaymentLink','Error\x20message:','logWhiteDomainResponse','Rapyd\x20payment\x20verification\x20error:','application/json','message','POST','text','loggerService','Headers:','errorCode','parse','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','SUCCESS','318741sDDsGm','===\x20RAPYD\x20API\x20ERROR\x20===','Unknown\x20error','Parsed\x20Result:','failureCode','https://tesoft.uk/gateway/success.php?id=','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','fixed_side','redirect_url','Failed\x20to\x20parse\x20JSON\x20response:','defineProperty','🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','statusText','):\x20','stringify','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','PENDING','status','last4','Unknown\x20error\x20from\x20Rapyd\x20API','3JgTjaa','none','https://tesoft.uk/gateway/fail.php?id=','ORDER:\x20','gb_mastercard_card'];a49_0x3d3e=function(){return _0x2cb1dd;};return a49_0x3d3e();}(function(_0xb48e9d,_0x5df2c6){const _0x399eeb=a49_0x53e2,_0x317398=_0xb48e9d();while(!![]){try{const _0x156a40=parseInt(_0x399eeb(0x1a4))/0x1+parseInt(_0x399eeb(0x1e7))/0x2*(-parseInt(_0x399eeb(0x1b8))/0x3)+-parseInt(_0x399eeb(0x1cb))/0x4+-parseInt(_0x399eeb(0x1de))/0x5+-parseInt(_0x399eeb(0x1bf))/0x6*(parseInt(_0x399eeb(0x1f9))/0x7)+-parseInt(_0x399eeb(0x1c8))/0x8+parseInt(_0x399eeb(0x1c2))/0x9;if(_0x156a40===_0x5df2c6)break;else _0x317398['push'](_0x317398['shift']());}catch(_0x3b7772){_0x317398['push'](_0x317398['shift']());}}}(a49_0x3d3e,0xcf8e9));function a49_0x53e2(_0x579191,_0x39db2f){const _0x3d3e07=a49_0x3d3e();return a49_0x53e2=function(_0x53e2e4,_0x4ce5fd){_0x53e2e4=_0x53e2e4-0x19c;let _0x24397c=_0x3d3e07[_0x53e2e4];return _0x24397c;},a49_0x53e2(_0x579191,_0x39db2f);}Object[a49_0x568ff4(0x1ae)](exports,'__esModule',{'value':!![]}),exports[a49_0x568ff4(0x202)]=void 0x0;const loggerService_1=require(a49_0x568ff4(0x1da));class RapydService{constructor(){const _0x3fc942=a49_0x568ff4;this[_0x3fc942(0x1e4)]=_0x3fc942(0x1f7),console[_0x3fc942(0x1f0)](_0x3fc942(0x1db));}async[a49_0x568ff4(0x20f)](_0x59062e){const _0x464c52=a49_0x568ff4,{orderId:_0x14f645,orderName:_0x1e469a,amount:_0x2751f5,currency:_0x576634,usage:_0x5c5380,maxPayments:_0x3b9311,successUrl:_0x128e63,failUrl:_0x47a215}=_0x59062e,_0x62c885=_0x576634[_0x464c52(0x1be)](),_0x123a1a='GB';console[_0x464c52(0x1f0)](_0x464c52(0x1af));const _0x3a4767=_0x464c52(0x1a9)+_0x14f645,_0x22a6c2=_0x464c52(0x1ba)+_0x14f645,_0x32b324={'amount':_0x2751f5,'currency':_0x62c885,'cancel_checkout_url':_0x22a6c2,'complete_checkout_url':_0x3a4767,'complete_payment_url':_0x3a4767,'merchant_reference_id':_0x14f645,'description':_0x464c52(0x1bb)+_0x14f645,'country':'GB','payment_method_types_include':[_0x464c52(0x1ca),_0x464c52(0x1bc)],'custom_elements':{'display_description':!![]}};if(_0x62c885!==_0x464c52(0x20e)){const _0x1e0447=Math['floor'](Date[_0x464c52(0x1c3)]()/0x3e8)+0x1e*0x3c;_0x32b324[_0x464c52(0x1ab)]=_0x464c52(0x205),_0x32b324[_0x464c52(0x1cd)]='EUR',_0x32b324[_0x464c52(0x1f5)]=_0x1e0447,console[_0x464c52(0x1f0)](_0x464c52(0x1e6)+_0x62c885+'\x20->\x20EUR:'),console[_0x464c52(0x1f0)](_0x464c52(0x1bd)),console[_0x464c52(0x1f0)](_0x464c52(0x1e9)),console[_0x464c52(0x1f0)](_0x464c52(0x1d4)+_0x1e0447+'\x20('+new Date(_0x1e0447*0x3e8)[_0x464c52(0x1dd)]()+')');}const _0x5bdd34=Date[_0x464c52(0x1c3)]();try{console[_0x464c52(0x1f0)](_0x464c52(0x201)),console[_0x464c52(0x1f0)](_0x464c52(0x1d5),this['apiUrl']),console[_0x464c52(0x1f0)]('Request\x20Body\x20(Updated\x20Format):',JSON[_0x464c52(0x1b2)](_0x32b324,null,0x2)),console[_0x464c52(0x1f0)](_0x464c52(0x1c1)+_0x123a1a+'\x20(always\x20GB\x20for\x20Rapyd)'),console[_0x464c52(0x1f0)](_0x464c52(0x1f1)),loggerService_1[_0x464c52(0x19e)][_0x464c52(0x1f2)](_0x464c52(0x200),_0x464c52(0x1d3),_0x464c52(0x19c),_0x32b324);const _0x5bd863=await fetch(this['apiUrl'],{'method':_0x464c52(0x19c),'headers':{'Content-Type':_0x464c52(0x213),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x464c52(0x1b2)](_0x32b324)}),_0x5488b9=Date[_0x464c52(0x1c3)]()-_0x5bdd34;console[_0x464c52(0x1f0)](_0x464c52(0x1f4)),console[_0x464c52(0x1f0)](_0x464c52(0x204),_0x5bd863[_0x464c52(0x1b5)]),console['log'](_0x464c52(0x208),_0x5bd863[_0x464c52(0x1b0)]),console['log'](_0x464c52(0x19f),Object[_0x464c52(0x1ed)](_0x5bd863[_0x464c52(0x203)]['entries']())),console[_0x464c52(0x1f0)](_0x464c52(0x1df),_0x5488b9+'ms');const _0x5c8016=await _0x5bd863[_0x464c52(0x19d)]();console[_0x464c52(0x1f0)](_0x464c52(0x1d7),_0x5c8016);if(!_0x5bd863['ok']){console['error'](_0x464c52(0x1a5)),console[_0x464c52(0x1dc)]('HTTP\x20Status:',_0x5bd863[_0x464c52(0x1b5)]),console[_0x464c52(0x1dc)]('Response\x20Body:',_0x5c8016),loggerService_1[_0x464c52(0x19e)][_0x464c52(0x211)](_0x464c52(0x200),_0x464c52(0x1d3),_0x5bd863[_0x464c52(0x1b5)],_0x5c8016,_0x5488b9),loggerService_1[_0x464c52(0x19e)][_0x464c52(0x20c)](_0x464c52(0x200),'/v1/hosted/payment_links','HTTP\x20'+_0x5bd863[_0x464c52(0x1b5)]+':\x20'+_0x5c8016);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5bd863[_0x464c52(0x1b5)]+',\x20body:\x20'+_0x5c8016);}let _0x4d5a71;try{_0x4d5a71=JSON[_0x464c52(0x1a1)](_0x5c8016);}catch(_0x4b5524){console['error'](_0x464c52(0x1ad),_0x4b5524),loggerService_1[_0x464c52(0x19e)][_0x464c52(0x20c)](_0x464c52(0x200),_0x464c52(0x1d3),'JSON\x20Parse\x20Error:\x20'+_0x4b5524);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x5c8016);}console[_0x464c52(0x1f0)](_0x464c52(0x1b3)),console[_0x464c52(0x1f0)](_0x464c52(0x1a7),JSON[_0x464c52(0x1b2)](_0x4d5a71,null,0x2)),loggerService_1[_0x464c52(0x19e)][_0x464c52(0x211)](_0x464c52(0x200),_0x464c52(0x1d3),_0x5bd863[_0x464c52(0x1b5)],_0x4d5a71,_0x5488b9);if(_0x4d5a71[_0x464c52(0x1b5)]?.['status']!==_0x464c52(0x1a3)){const _0x2aeb6d=_0x4d5a71['status']?.[_0x464c52(0x214)]||_0x464c52(0x1b7),_0x244c39=_0x4d5a71[_0x464c52(0x1b5)]?.['error_code']||_0x464c52(0x1cc);console['error'](_0x464c52(0x1a2)),console[_0x464c52(0x1dc)]('Error\x20Code:',_0x244c39),console[_0x464c52(0x1dc)]('Error\x20Message:',_0x2aeb6d),console[_0x464c52(0x1dc)]('Full\x20Error\x20Data:',_0x4d5a71['status']),loggerService_1[_0x464c52(0x19e)]['logWhiteDomainError'](_0x464c52(0x200),_0x464c52(0x1d3),_0x464c52(0x1e2)+_0x244c39+_0x464c52(0x1b1)+_0x2aeb6d);throw new Error(_0x464c52(0x1d8)+_0x244c39+'):\x20'+_0x2aeb6d);}if(!_0x4d5a71[_0x464c52(0x1fe)]?.['id']||!_0x4d5a71['data']?.['redirect_url']){console[_0x464c52(0x1dc)](_0x464c52(0x1d1)),console[_0x464c52(0x1dc)](_0x464c52(0x1fd)),console[_0x464c52(0x1dc)]('Response\x20data:',_0x4d5a71[_0x464c52(0x1fe)]),loggerService_1['loggerService'][_0x464c52(0x20c)](_0x464c52(0x200),_0x464c52(0x1d3),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x464c52(0x1f0)]('===\x20RAPYD\x20SUCCESS\x20==='),console[_0x464c52(0x1f0)](_0x464c52(0x1d0),_0x4d5a71[_0x464c52(0x1fe)]['id']),console[_0x464c52(0x1f0)]('Redirect\x20URL:',_0x4d5a71[_0x464c52(0x1fe)]['redirect_url']),console[_0x464c52(0x1f0)](_0x464c52(0x1e5)+_0x123a1a+'\x20(GB\x20-\x20Britain)'),console[_0x464c52(0x1f0)](_0x464c52(0x1f1)),{'gateway_payment_id':_0x4d5a71[_0x464c52(0x1fe)]['id'],'payment_url':_0x4d5a71[_0x464c52(0x1fe)][_0x464c52(0x1ac)]};}catch(_0x47b8e6){console['error']('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x464c52(0x1dc)]('Error\x20details:',_0x47b8e6),loggerService_1[_0x464c52(0x19e)]['logWhiteDomainError'](_0x464c52(0x200),_0x464c52(0x1d3),_0x47b8e6);if(_0x47b8e6 instanceof Error){console[_0x464c52(0x1dc)](_0x464c52(0x210),_0x47b8e6[_0x464c52(0x214)]),console['error'](_0x464c52(0x1eb),_0x47b8e6['stack']);throw new Error(_0x464c52(0x1c4)+_0x47b8e6[_0x464c52(0x214)]);}throw new Error(_0x464c52(0x1aa));}}async[a49_0x568ff4(0x1ef)](_0x317492){const _0x821e46=a49_0x568ff4,_0x7db8c4=Date[_0x821e46(0x1c3)]();try{loggerService_1[_0x821e46(0x19e)][_0x821e46(0x1f2)](_0x821e46(0x200),_0x821e46(0x1e1)+_0x317492,_0x821e46(0x1d2),{});const _0x5519e8=await fetch(this[_0x821e46(0x1e4)]+'/'+_0x317492,{'method':_0x821e46(0x1d2),'headers':{'Content-Type':_0x821e46(0x213),'User-Agent':_0x821e46(0x1ff)}}),_0x6e2224=Date['now']()-_0x7db8c4;if(!_0x5519e8['ok']){const _0x3a7e8f=await _0x5519e8[_0x821e46(0x19d)]();loggerService_1[_0x821e46(0x19e)]['logWhiteDomainResponse'](_0x821e46(0x200),'/v1/hosted/payment_links/'+_0x317492,_0x5519e8[_0x821e46(0x1b5)],_0x3a7e8f,_0x6e2224);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5519e8['status']);}const _0x9d4d3d=await _0x5519e8[_0x821e46(0x1fb)]();loggerService_1['loggerService'][_0x821e46(0x211)](_0x821e46(0x200),'/v1/hosted/payment_links/'+_0x317492,_0x5519e8[_0x821e46(0x1b5)],_0x9d4d3d,_0x6e2224);if(_0x9d4d3d[_0x821e46(0x1b5)]?.[_0x821e46(0x1b5)]!==_0x821e46(0x1a3)){loggerService_1['loggerService'][_0x821e46(0x20c)](_0x821e46(0x200),_0x821e46(0x1e1)+_0x317492,_0x821e46(0x1fa)+(_0x9d4d3d[_0x821e46(0x1b5)]?.['message']||_0x821e46(0x1a6)));throw new Error(_0x821e46(0x1fa)+(_0x9d4d3d[_0x821e46(0x1b5)]?.[_0x821e46(0x214)]||_0x821e46(0x1a6)));}let _0x425bb7=_0x821e46(0x1b4);if(_0x9d4d3d['data']?.['status'])switch(_0x9d4d3d[_0x821e46(0x1fe)][_0x821e46(0x1b5)][_0x821e46(0x1be)]()){case _0x821e46(0x1f8):_0x425bb7='PAID';break;case'CAN':_0x425bb7=_0x821e46(0x1ce);break;case _0x821e46(0x1e0):_0x425bb7='EXPIRED';break;case _0x821e46(0x1c0):_0x425bb7=_0x821e46(0x1ce);break;case _0x821e46(0x20a):case _0x821e46(0x20d):default:_0x425bb7=_0x821e46(0x1b4);break;}return{'status':_0x425bb7,'amount':_0x9d4d3d[_0x821e46(0x1fe)]?.[_0x821e46(0x207)],'currency':_0x9d4d3d[_0x821e46(0x1fe)]?.[_0x821e46(0x1e8)]};}catch(_0x258bbf){console[_0x821e46(0x1dc)](_0x821e46(0x212),_0x258bbf),loggerService_1['loggerService'][_0x821e46(0x20c)](_0x821e46(0x200),_0x821e46(0x1e1)+_0x317492,_0x258bbf);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0x258bbf instanceof Error?_0x258bbf['message']:'Unknown\x20error'));}}async['processWebhook'](_0x5b7627){const _0x57bb78=a49_0x568ff4;console[_0x57bb78(0x1f0)](_0x57bb78(0x1c5),_0x5b7627);let _0x2a6b85='PENDING',_0x6a4f99;_0x5b7627[_0x57bb78(0x1fe)]?.['failure_message']&&(_0x6a4f99=_0x5b7627[_0x57bb78(0x1fe)][_0x57bb78(0x1ea)],console[_0x57bb78(0x1f0)](_0x57bb78(0x1f3)+_0x6a4f99));switch(_0x5b7627[_0x57bb78(0x1e3)]?.[_0x57bb78(0x1be)]()){case _0x57bb78(0x1fc):_0x5b7627[_0x57bb78(0x1fe)]?.[_0x57bb78(0x1d6)]===!![]&&_0x5b7627[_0x57bb78(0x1fe)]?.[_0x57bb78(0x1b5)]==='CLO'?_0x2a6b85=_0x57bb78(0x1ec):_0x2a6b85='PENDING';break;case'PAYMENT_CANCELED':_0x2a6b85='FAILED';break;case _0x57bb78(0x1c6):_0x2a6b85='EXPIRED';break;case _0x57bb78(0x1d9):_0x2a6b85='FAILED';!_0x6a4f99&&_0x5b7627[_0x57bb78(0x1fe)]?.[_0x57bb78(0x1ea)]&&(_0x6a4f99=_0x5b7627[_0x57bb78(0x1fe)][_0x57bb78(0x1ea)]);break;default:switch(_0x5b7627[_0x57bb78(0x1fe)]?.['status']?.[_0x57bb78(0x1be)]()){case _0x57bb78(0x1f8):_0x5b7627[_0x57bb78(0x1fe)]?.[_0x57bb78(0x1d6)]===!![]?_0x2a6b85=_0x57bb78(0x1ec):_0x2a6b85='FAILED';break;case _0x57bb78(0x206):_0x2a6b85=_0x57bb78(0x1ce);break;case'EXP':_0x2a6b85=_0x57bb78(0x20b);break;case _0x57bb78(0x1c0):_0x2a6b85=_0x57bb78(0x1ce);!_0x6a4f99&&_0x5b7627[_0x57bb78(0x1fe)]?.[_0x57bb78(0x1ea)]&&(_0x6a4f99=_0x5b7627[_0x57bb78(0x1fe)][_0x57bb78(0x1ea)]);break;case'NEW':case _0x57bb78(0x20d):default:_0x2a6b85=_0x57bb78(0x1b4);break;}break;}const _0x4df7d0={};return _0x5b7627[_0x57bb78(0x1fe)]?.[_0x57bb78(0x1cf)]?.[_0x57bb78(0x1b6)]&&(_0x4df7d0['cardLast4']=_0x5b7627[_0x57bb78(0x1fe)]['payment_method_data']['last4']),_0x5b7627[_0x57bb78(0x1fe)]?.[_0x57bb78(0x1ee)]&&(_0x4df7d0['paymentMethod']=_0x5b7627[_0x57bb78(0x1fe)][_0x57bb78(0x1ee)]),_0x5b7627['data']?.[_0x57bb78(0x1c7)]&&(_0x4df7d0[_0x57bb78(0x1a0)]=_0x5b7627['data'][_0x57bb78(0x1c7)]),_0x5b7627['data']?.[_0x57bb78(0x209)]&&(_0x4df7d0[_0x57bb78(0x1a8)]=_0x5b7627[_0x57bb78(0x1fe)][_0x57bb78(0x209)]),console[_0x57bb78(0x1f0)]('🔄\x20Rapyd\x20webhook\x20processed:\x20status='+_0x2a6b85+_0x57bb78(0x1c9)+(_0x6a4f99||_0x57bb78(0x1b9))),{'paymentId':_0x5b7627[_0x57bb78(0x1fe)]?.[_0x57bb78(0x1f6)]||'','status':_0x2a6b85,'amount':_0x5b7627[_0x57bb78(0x1fe)]?.[_0x57bb78(0x207)],'currency':_0x5b7627[_0x57bb78(0x1fe)]?.['currency'],'failureMessage':_0x6a4f99,'additionalInfo':_0x4df7d0};}}exports[a49_0x568ff4(0x202)]=RapydService;