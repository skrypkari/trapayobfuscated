'use strict';function a46_0x3a09(){const _0x32f631=['104JITSjw','parse','Missing\x20id\x20or\x20redirect_url\x20in\x20response','logWhiteDomainRequest','logWhiteDomainError','gb_mastercard_card','134udJoZK','PENDING','Raw\x20Response\x20Body:','payment_method_data','errorCode','Request\x20Body\x20(Updated\x20Format):','defineProperty','last4','FAILED','Error\x20Message:','9513XltadE','createPaymentLink','PAYMENT_FAILED','Response\x20Body:','Status\x20Text:','7051134Hjrxcb','POST','Full\x20Error\x20Data:','toUpperCase','redirect_url','193440Gycykw','currency','json',',\x20body:\x20','stringify','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','Rapyd\x20payment\x20verification\x20error:','Parsed\x20Result:','Failed\x20to\x20parse\x20JSON\x20response:','https://tesoft.uk/gateway/rapyd/','Unknown\x20error','rapyd','entries','SUCCESS','13421vVpqde','PAID','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','status','Rapyd\x20API\x20error\x20(','loggerService','data','Error\x20Code:','\x20(GB\x20-\x20Britain)','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','fromEntries','failure_code','4wtyEAZ','ERR','RapydService','üá¨üáß\x20Country\x20used:\x20','CAN','error_code','now','type','error','Business\x20Error\x20(','log','https://tesoft.uk/gateway/fail.php?id=','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','payment_method_type','application/json','__esModule','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','GET','EXPIRED','HTTP\x20','verifyPayment','Payment\x20Link\x20ID:','Processing\x20Rapyd\x20webhook:','PAYMENT_COMPLETED','amount','TesSoft\x20Payment\x20System/1.0','message','https://tesoft.uk/gateway/success.php?id=','ORDER:\x20','/v1/hosted/payment_links/','\x20(always\x20GB\x20for\x20Rapyd)','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','apiUrl','failureCode','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','CLO','PAYMENT_CANCELED','none','):\x20','Response\x20data:','logWhiteDomainResponse','paid','JSON\x20Parse\x20Error:\x20','failure_message','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','Rapyd\x20API\x20error:\x20','HTTP\x20error!\x20status:\x20','üí•\x20Rapyd\x20failure\x20message:\x20','text','Status:','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20message:','Response\x20Time:','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','10482115RxnLRt','/v1/hosted/payment_links','EXP','stack','cardLast4','===\x20RAPYD\x20API\x20ERROR\x20===','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','4685490mhJXAm','gb_visa_card','Error\x20details:','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','4279701nctIwQ','headers'];a46_0x3a09=function(){return _0x32f631;};return a46_0x3a09();}function a46_0x42c2(_0x1b90f4,_0xc54a42){const _0x3a0990=a46_0x3a09();return a46_0x42c2=function(_0x42c21d,_0x40ae79){_0x42c21d=_0x42c21d-0xff;let _0x1c8e51=_0x3a0990[_0x42c21d];return _0x1c8e51;},a46_0x42c2(_0x1b90f4,_0xc54a42);}const a46_0x10891e=a46_0x42c2;(function(_0x4eee2c,_0x570e29){const _0x4c061c=a46_0x42c2,_0x4aa445=_0x4eee2c();while(!![]){try{const _0x135fbd=parseInt(_0x4c061c(0x158))/0x1*(-parseInt(_0x4c061c(0x136))/0x2)+parseInt(_0x4c061c(0x12e))/0x3*(-parseInt(_0x4c061c(0x164))/0x4)+-parseInt(_0x4c061c(0x14a))/0x5+parseInt(_0x4c061c(0x145))/0x6+parseInt(_0x4c061c(0x123))/0x7+-parseInt(_0x4c061c(0x130))/0x8*(-parseInt(_0x4c061c(0x140))/0x9)+parseInt(_0x4c061c(0x12a))/0xa;if(_0x135fbd===_0x570e29)break;else _0x4aa445['push'](_0x4aa445['shift']());}catch(_0x4ff9ee){_0x4aa445['push'](_0x4aa445['shift']());}}}(a46_0x3a09,0xc0fbe));Object[a46_0x10891e(0x13c)](exports,a46_0x10891e(0x174),{'value':!![]}),exports[a46_0x10891e(0x166)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x43c844=a46_0x10891e;this[_0x43c844(0x10d)]=_0x43c844(0x153),console[_0x43c844(0x16e)](_0x43c844(0x175));}async[a46_0x10891e(0x141)](_0x383491){const _0x4796af=a46_0x10891e,{orderId:_0x327738,orderName:_0x3da220,amount:_0x1c86db,currency:_0x230594,usage:_0x2995ce,maxPayments:_0x39f671,successUrl:_0x2015da,failUrl:_0x418d33}=_0x383491,_0x18caea=_0x230594[_0x4796af(0x148)](),_0x16fd28='GB';console[_0x4796af(0x16e)]('üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x429e71=_0x4796af(0x108)+_0x327738,_0x39df6f=_0x4796af(0x16f)+_0x327738,_0x49f771={'amount':_0x1c86db,'currency':_0x18caea,'cancel_checkout_url':_0x39df6f,'complete_checkout_url':_0x429e71,'complete_payment_url':_0x429e71,'merchant_reference_id':_0x327738,'description':_0x4796af(0x109)+_0x327738,'country':'GB','payment_method_types_include':[_0x4796af(0x12b),_0x4796af(0x135)],'custom_elements':{'display_description':!![]}},_0x34bc2e=Date[_0x4796af(0x16a)]();try{console['log'](_0x4796af(0x122)),console[_0x4796af(0x16e)]('URL:',this[_0x4796af(0x10d)]),console[_0x4796af(0x16e)](_0x4796af(0x13b),JSON[_0x4796af(0x14e)](_0x49f771,null,0x2)),console['log']('üá¨üáß\x20Country:\x20'+_0x16fd28+_0x4796af(0x10b)),console[_0x4796af(0x16e)](_0x4796af(0x15a)),loggerService_1[_0x4796af(0x15d)][_0x4796af(0x133)](_0x4796af(0x155),_0x4796af(0x124),_0x4796af(0x146),_0x49f771);const _0x2fba5d=await fetch(this[_0x4796af(0x10d)],{'method':_0x4796af(0x146),'headers':{'Content-Type':_0x4796af(0x173),'User-Agent':_0x4796af(0x106)},'body':JSON[_0x4796af(0x14e)](_0x49f771)}),_0x4e9d92=Date[_0x4796af(0x16a)]()-_0x34bc2e;console[_0x4796af(0x16e)]('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x4796af(0x11e),_0x2fba5d[_0x4796af(0x15b)]),console[_0x4796af(0x16e)](_0x4796af(0x144),_0x2fba5d['statusText']),console[_0x4796af(0x16e)]('Headers:',Object[_0x4796af(0x162)](_0x2fba5d[_0x4796af(0x12f)][_0x4796af(0x156)]())),console[_0x4796af(0x16e)](_0x4796af(0x121),_0x4e9d92+'ms');const _0x4f5cdc=await _0x2fba5d['text']();console[_0x4796af(0x16e)](_0x4796af(0x138),_0x4f5cdc);if(!_0x2fba5d['ok']){console[_0x4796af(0x16c)](_0x4796af(0x128)),console[_0x4796af(0x16c)]('HTTP\x20Status:',_0x2fba5d[_0x4796af(0x15b)]),console[_0x4796af(0x16c)](_0x4796af(0x143),_0x4f5cdc),loggerService_1[_0x4796af(0x15d)]['logWhiteDomainResponse'](_0x4796af(0x155),_0x4796af(0x124),_0x2fba5d[_0x4796af(0x15b)],_0x4f5cdc,_0x4e9d92),loggerService_1['loggerService'][_0x4796af(0x134)](_0x4796af(0x155),_0x4796af(0x124),_0x4796af(0x100)+_0x2fba5d[_0x4796af(0x15b)]+':\x20'+_0x4f5cdc);throw new Error(_0x4796af(0x11b)+_0x2fba5d['status']+_0x4796af(0x14d)+_0x4f5cdc);}let _0x432c00;try{_0x432c00=JSON[_0x4796af(0x131)](_0x4f5cdc);}catch(_0x1cf3ac){console[_0x4796af(0x16c)](_0x4796af(0x152),_0x1cf3ac),loggerService_1['loggerService']['logWhiteDomainError']('rapyd',_0x4796af(0x124),_0x4796af(0x117)+_0x1cf3ac);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x4f5cdc);}console[_0x4796af(0x16e)](_0x4796af(0x12d)),console['log'](_0x4796af(0x151),JSON['stringify'](_0x432c00,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4796af(0x155),'/v1/hosted/payment_links',_0x2fba5d[_0x4796af(0x15b)],_0x432c00,_0x4e9d92);if(_0x432c00['status']?.[_0x4796af(0x15b)]!==_0x4796af(0x157)){const _0x565be6=_0x432c00['status']?.[_0x4796af(0x107)]||'Unknown\x20error\x20from\x20Rapyd\x20API',_0x154bb2=_0x432c00[_0x4796af(0x15b)]?.[_0x4796af(0x169)]||'UNKNOWN';console[_0x4796af(0x16c)](_0x4796af(0x129)),console[_0x4796af(0x16c)](_0x4796af(0x15f),_0x154bb2),console[_0x4796af(0x16c)](_0x4796af(0x13f),_0x565be6),console['error'](_0x4796af(0x147),_0x432c00[_0x4796af(0x15b)]),loggerService_1[_0x4796af(0x15d)][_0x4796af(0x134)]('rapyd',_0x4796af(0x124),_0x4796af(0x16d)+_0x154bb2+_0x4796af(0x113)+_0x565be6);throw new Error(_0x4796af(0x15c)+_0x154bb2+_0x4796af(0x113)+_0x565be6);}if(!_0x432c00['data']?.['id']||!_0x432c00[_0x4796af(0x15e)]?.[_0x4796af(0x149)]){console[_0x4796af(0x16c)](_0x4796af(0x11f)),console[_0x4796af(0x16c)](_0x4796af(0x132)),console[_0x4796af(0x16c)](_0x4796af(0x114),_0x432c00[_0x4796af(0x15e)]),loggerService_1[_0x4796af(0x15d)][_0x4796af(0x134)](_0x4796af(0x155),_0x4796af(0x124),_0x4796af(0x14f));throw new Error(_0x4796af(0x10f));}return console[_0x4796af(0x16e)]('===\x20RAPYD\x20SUCCESS\x20==='),console[_0x4796af(0x16e)](_0x4796af(0x102),_0x432c00['data']['id']),console[_0x4796af(0x16e)]('Redirect\x20URL:',_0x432c00[_0x4796af(0x15e)]['redirect_url']),console[_0x4796af(0x16e)](_0x4796af(0x167)+_0x16fd28+_0x4796af(0x160)),console[_0x4796af(0x16e)](_0x4796af(0x15a)),{'gateway_payment_id':_0x432c00[_0x4796af(0x15e)]['id'],'payment_url':_0x432c00[_0x4796af(0x15e)]['redirect_url']};}catch(_0x552e1d){console[_0x4796af(0x16c)](_0x4796af(0x161)),console[_0x4796af(0x16c)](_0x4796af(0x12c),_0x552e1d),loggerService_1[_0x4796af(0x15d)][_0x4796af(0x134)](_0x4796af(0x155),_0x4796af(0x124),_0x552e1d);if(_0x552e1d instanceof Error){console[_0x4796af(0x16c)](_0x4796af(0x120),_0x552e1d[_0x4796af(0x107)]),console['error']('Error\x20stack:',_0x552e1d[_0x4796af(0x126)]);throw new Error(_0x4796af(0x10c)+_0x552e1d['message']);}throw new Error(_0x4796af(0x119));}}async[a46_0x10891e(0x101)](_0x4a0128){const _0x517080=a46_0x10891e,_0x1d8963=Date[_0x517080(0x16a)]();try{loggerService_1[_0x517080(0x15d)][_0x517080(0x133)](_0x517080(0x155),_0x517080(0x10a)+_0x4a0128,_0x517080(0x176),{});const _0x38f071=await fetch(this[_0x517080(0x10d)]+'/'+_0x4a0128,{'method':_0x517080(0x176),'headers':{'Content-Type':'application/json','User-Agent':_0x517080(0x106)}}),_0x589b17=Date['now']()-_0x1d8963;if(!_0x38f071['ok']){const _0x3626a6=await _0x38f071[_0x517080(0x11d)]();loggerService_1[_0x517080(0x15d)][_0x517080(0x115)](_0x517080(0x155),'/v1/hosted/payment_links/'+_0x4a0128,_0x38f071[_0x517080(0x15b)],_0x3626a6,_0x589b17);throw new Error(_0x517080(0x11b)+_0x38f071[_0x517080(0x15b)]);}const _0x551825=await _0x38f071[_0x517080(0x14c)]();loggerService_1[_0x517080(0x15d)][_0x517080(0x115)](_0x517080(0x155),'/v1/hosted/payment_links/'+_0x4a0128,_0x38f071[_0x517080(0x15b)],_0x551825,_0x589b17);if(_0x551825[_0x517080(0x15b)]?.['status']!==_0x517080(0x157)){loggerService_1[_0x517080(0x15d)]['logWhiteDomainError'](_0x517080(0x155),'/v1/hosted/payment_links/'+_0x4a0128,'Rapyd\x20API\x20error:\x20'+(_0x551825['status']?.[_0x517080(0x107)]||_0x517080(0x154)));throw new Error(_0x517080(0x11a)+(_0x551825[_0x517080(0x15b)]?.['message']||_0x517080(0x154)));}let _0x2e9af0=_0x517080(0x137);if(_0x551825['data']?.['status'])switch(_0x551825[_0x517080(0x15e)][_0x517080(0x15b)][_0x517080(0x148)]()){case _0x517080(0x110):_0x2e9af0=_0x517080(0x159);break;case _0x517080(0x168):_0x2e9af0=_0x517080(0x13e);break;case'EXP':_0x2e9af0=_0x517080(0xff);break;case _0x517080(0x165):_0x2e9af0=_0x517080(0x13e);break;case'NEW':case'ACT':default:_0x2e9af0=_0x517080(0x137);break;}return{'status':_0x2e9af0,'amount':_0x551825[_0x517080(0x15e)]?.[_0x517080(0x105)],'currency':_0x551825[_0x517080(0x15e)]?.[_0x517080(0x14b)]};}catch(_0x50d3ff){console[_0x517080(0x16c)](_0x517080(0x150),_0x50d3ff),loggerService_1[_0x517080(0x15d)][_0x517080(0x134)]('rapyd','/v1/hosted/payment_links/'+_0x4a0128,_0x50d3ff);throw new Error(_0x517080(0x171)+(_0x50d3ff instanceof Error?_0x50d3ff['message']:_0x517080(0x154)));}}async['processWebhook'](_0x333121){const _0x4c2876=a46_0x10891e;console[_0x4c2876(0x16e)](_0x4c2876(0x103),_0x333121);let _0x1ea853=_0x4c2876(0x137),_0x326de8;_0x333121[_0x4c2876(0x15e)]?.['failure_message']&&(_0x326de8=_0x333121['data'][_0x4c2876(0x118)],console['log'](_0x4c2876(0x11c)+_0x326de8));switch(_0x333121[_0x4c2876(0x16b)]?.[_0x4c2876(0x148)]()){case _0x4c2876(0x104):_0x333121['data']?.['paid']===!![]&&_0x333121[_0x4c2876(0x15e)]?.[_0x4c2876(0x15b)]===_0x4c2876(0x110)?_0x1ea853=_0x4c2876(0x159):_0x1ea853=_0x4c2876(0x137);break;case _0x4c2876(0x111):_0x1ea853=_0x4c2876(0x13e);break;case'PAYMENT_EXPIRED':_0x1ea853=_0x4c2876(0xff);break;case _0x4c2876(0x142):_0x1ea853=_0x4c2876(0x13e);!_0x326de8&&_0x333121['data']?.['failure_message']&&(_0x326de8=_0x333121[_0x4c2876(0x15e)][_0x4c2876(0x118)]);break;default:switch(_0x333121['data']?.[_0x4c2876(0x15b)]?.['toUpperCase']()){case _0x4c2876(0x110):_0x333121[_0x4c2876(0x15e)]?.[_0x4c2876(0x116)]===!![]?_0x1ea853=_0x4c2876(0x159):_0x1ea853=_0x4c2876(0x13e);break;case'CAN':_0x1ea853=_0x4c2876(0x13e);break;case _0x4c2876(0x125):_0x1ea853=_0x4c2876(0xff);break;case _0x4c2876(0x165):_0x1ea853='FAILED';!_0x326de8&&_0x333121[_0x4c2876(0x15e)]?.[_0x4c2876(0x118)]&&(_0x326de8=_0x333121[_0x4c2876(0x15e)][_0x4c2876(0x118)]);break;case'NEW':case'ACT':default:_0x1ea853=_0x4c2876(0x137);break;}break;}const _0x2ad51a={};return _0x333121['data']?.[_0x4c2876(0x139)]?.[_0x4c2876(0x13d)]&&(_0x2ad51a[_0x4c2876(0x127)]=_0x333121['data']['payment_method_data'][_0x4c2876(0x13d)]),_0x333121['data']?.[_0x4c2876(0x172)]&&(_0x2ad51a['paymentMethod']=_0x333121[_0x4c2876(0x15e)][_0x4c2876(0x172)]),_0x333121[_0x4c2876(0x15e)]?.[_0x4c2876(0x169)]&&(_0x2ad51a[_0x4c2876(0x13a)]=_0x333121[_0x4c2876(0x15e)]['error_code']),_0x333121[_0x4c2876(0x15e)]?.[_0x4c2876(0x163)]&&(_0x2ad51a[_0x4c2876(0x10e)]=_0x333121[_0x4c2876(0x15e)][_0x4c2876(0x163)]),console[_0x4c2876(0x16e)](_0x4c2876(0x170)+_0x1ea853+',\x20failureMessage='+(_0x326de8||_0x4c2876(0x112))),{'paymentId':_0x333121[_0x4c2876(0x15e)]?.['merchant_reference_id']||'','status':_0x1ea853,'amount':_0x333121[_0x4c2876(0x15e)]?.['amount'],'currency':_0x333121['data']?.[_0x4c2876(0x14b)],'failureMessage':_0x326de8,'additionalInfo':_0x2ad51a};}}exports[a46_0x10891e(0x166)]=RapydService;