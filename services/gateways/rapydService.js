'use strict';const a56_0x114887=a56_0x360e;(function(_0x1d4de2,_0x922e23){const _0x12159=a56_0x360e,_0x2fc82a=_0x1d4de2();while(!![]){try{const _0x7529a0=parseInt(_0x12159(0x15e))/0x1+-parseInt(_0x12159(0x145))/0x2+-parseInt(_0x12159(0x169))/0x3*(-parseInt(_0x12159(0x17b))/0x4)+-parseInt(_0x12159(0x132))/0x5+-parseInt(_0x12159(0x173))/0x6*(-parseInt(_0x12159(0x172))/0x7)+-parseInt(_0x12159(0x13b))/0x8+parseInt(_0x12159(0x13c))/0x9;if(_0x7529a0===_0x922e23)break;else _0x2fc82a['push'](_0x2fc82a['shift']());}catch(_0x1177c4){_0x2fc82a['push'](_0x2fc82a['shift']());}}}(a56_0x1de8,0x95ca8));Object['defineProperty'](exports,a56_0x114887(0x10d),{'value':!![]}),exports[a56_0x114887(0x143)]=void 0x0;const loggerService_1=require(a56_0x114887(0x127));function a56_0x1de8(){const _0x1b065f=['ERR','status','Unknown\x20error','6085535iKMLJU','https://tesoft.uk/gateway/success.php?id=','EXP','headers','GET','entries','json','/v1/hosted/payment_links','CAN','6179544dYboJm','3205314EGqFUF','statusText','/v1/hosted/payment_links/','NEW','\x20\x20\x20fixed_side:\x20buy','PAYMENT_EXPIRED','toUpperCase','RapydService','payment_method_type','1096022TKSAYk','cardLast4','PAYMENT_FAILED','parse','createPaymentLink','now','paid','HTTP\x20Status:',',\x20failureMessage=','EXPIRED','application/json','Error\x20message:','https://tesoft.uk/gateway/fail.php?id=','fixed_side','🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','fromEntries','https://tesoft.uk/gateway/rapyd/','FAILED','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','===\x20RAPYD\x20API\x20ERROR\x20===','PAID','Response\x20data:','):\x20','currency','apiUrl','603032LdktJs','redirect_url','Rapyd\x20payment\x20verification\x20error:','Error\x20Code:','💱\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','Error\x20details:','logWhiteDomainResponse','failureCode','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Rapyd\x20API\x20error\x20(','PENDING','1802376dvWakJ','ACT','error','Unknown\x20error\x20from\x20Rapyd\x20API','logWhiteDomainRequest','Headers:','gb_visa_card','none','HTTP\x20','6932401XAvzLl','6yTNbzW','Status:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','last4','requested_currency','buy','data','log','8kwFqDV','rapyd','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','\x20\x20\x20requested_currency:\x20EUR','Redirect\x20URL:','SUCCESS','verifyPayment','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','__esModule','text','===\x20RAPYD\x20SUCCESS\x20===','PAYMENT_COMPLETED','stringify','POST','failure_message','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','logWhiteDomainError','stack','\x20(GB\x20-\x20Britain)','floor','Processing\x20Rapyd\x20webhook:','Payment\x20System/1.0','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','HTTP\x20error!\x20status:\x20','💥\x20Rapyd\x20failure\x20message:\x20','Rapyd\x20API\x20error:\x20','\x20\x20\x20expiration:\x20','PAYMENT_CANCELED','loggerService','error_code','Business\x20Error\x20(','expiration','failure_code','URL:','../loggerService','amount','gb_mastercard_card',',\x20body:\x20','CLO','Error\x20Message:','message','\x20(always\x20GB\x20for\x20Rapyd)'];a56_0x1de8=function(){return _0x1b065f;};return a56_0x1de8();}function a56_0x360e(_0x482a20,_0x2b7539){const _0x1de829=a56_0x1de8();return a56_0x360e=function(_0x360efe,_0x4a52e1){_0x360efe=_0x360efe-0x10d;let _0x2e995b=_0x1de829[_0x360efe];return _0x2e995b;},a56_0x360e(_0x482a20,_0x2b7539);}class RapydService{constructor(){const _0x5e8b92=a56_0x114887;this[_0x5e8b92(0x15d)]=_0x5e8b92(0x155),console[_0x5e8b92(0x17a)](_0x5e8b92(0x114));}async[a56_0x114887(0x149)](_0x1190fa){const _0x5d2439=a56_0x114887,{orderId:_0x2af827,orderName:_0x31c864,amount:_0x498d73,currency:_0x4961c5,usage:_0x5e9d8e,maxPayments:_0x75b48b,successUrl:_0x3e7aea,failUrl:_0x4ddb9c}=_0x1190fa,_0x27cbee=_0x4961c5['toUpperCase'](),_0x2abb63='GB';console[_0x5d2439(0x17a)](_0x5d2439(0x153));const _0x2d16d0=_0x5d2439(0x133)+_0x2af827,_0x365eb4=_0x5d2439(0x151)+_0x2af827,_0xf61f85={'amount':_0x498d73,'currency':_0x27cbee,'cancel_checkout_url':_0x365eb4,'complete_checkout_url':_0x2d16d0,'complete_payment_url':_0x2d16d0,'merchant_reference_id':_0x2af827,'description':'ORDER:\x20'+_0x2af827,'country':'GB','payment_method_types_include':[_0x5d2439(0x16f),_0x5d2439(0x129)],'custom_elements':{'display_description':!![]}};if(_0x27cbee!=='EUR'){const _0x5c6eff=Math[_0x5d2439(0x118)](Date['now']()/0x3e8)+0x1e*0x3c;_0xf61f85[_0x5d2439(0x152)]=_0x5d2439(0x178),_0xf61f85[_0x5d2439(0x177)]='EUR',_0xf61f85[_0x5d2439(0x124)]=_0x5c6eff,console['log'](_0x5d2439(0x162)+_0x27cbee+'\x20->\x20EUR:'),console[_0x5d2439(0x17a)](_0x5d2439(0x140)),console[_0x5d2439(0x17a)](_0x5d2439(0x17e)),console['log'](_0x5d2439(0x11f)+_0x5c6eff+'\x20('+new Date(_0x5c6eff*0x3e8)['toISOString']()+')');}const _0x2fd8dc=Date['now']();try{console['log'](_0x5d2439(0x182)),console[_0x5d2439(0x17a)](_0x5d2439(0x126),this[_0x5d2439(0x15d)]),console[_0x5d2439(0x17a)]('Request\x20Body\x20(Updated\x20Format):',JSON[_0x5d2439(0x111)](_0xf61f85,null,0x2)),console[_0x5d2439(0x17a)]('🇬🇧\x20Country:\x20'+_0x2abb63+_0x5d2439(0x12e)),console[_0x5d2439(0x17a)](_0x5d2439(0x183)),loggerService_1[_0x5d2439(0x121)][_0x5d2439(0x16d)](_0x5d2439(0x17c),'/v1/hosted/payment_links','POST',_0xf61f85);const _0x11c32e=await fetch(this[_0x5d2439(0x15d)],{'method':_0x5d2439(0x112),'headers':{'Content-Type':_0x5d2439(0x14f),'User-Agent':_0x5d2439(0x11a)},'body':JSON[_0x5d2439(0x111)](_0xf61f85)}),_0x29637c=Date[_0x5d2439(0x14a)]()-_0x2fd8dc;console[_0x5d2439(0x17a)](_0x5d2439(0x17d)),console[_0x5d2439(0x17a)](_0x5d2439(0x174),_0x11c32e[_0x5d2439(0x130)]),console[_0x5d2439(0x17a)]('Status\x20Text:',_0x11c32e[_0x5d2439(0x13d)]),console['log'](_0x5d2439(0x16e),Object[_0x5d2439(0x154)](_0x11c32e[_0x5d2439(0x135)][_0x5d2439(0x137)]())),console[_0x5d2439(0x17a)]('Response\x20Time:',_0x29637c+'ms');const _0xffb032=await _0x11c32e[_0x5d2439(0x10e)]();console[_0x5d2439(0x17a)]('Raw\x20Response\x20Body:',_0xffb032);if(!_0x11c32e['ok']){console['error'](_0x5d2439(0x158)),console['error'](_0x5d2439(0x14c),_0x11c32e['status']),console['error']('Response\x20Body:',_0xffb032),loggerService_1[_0x5d2439(0x121)][_0x5d2439(0x164)](_0x5d2439(0x17c),_0x5d2439(0x139),_0x11c32e[_0x5d2439(0x130)],_0xffb032,_0x29637c),loggerService_1[_0x5d2439(0x121)][_0x5d2439(0x115)](_0x5d2439(0x17c),'/v1/hosted/payment_links',_0x5d2439(0x171)+_0x11c32e[_0x5d2439(0x130)]+':\x20'+_0xffb032);throw new Error(_0x5d2439(0x11c)+_0x11c32e[_0x5d2439(0x130)]+_0x5d2439(0x12a)+_0xffb032);}let _0x58dc7b;try{_0x58dc7b=JSON[_0x5d2439(0x148)](_0xffb032);}catch(_0x21b81c){console[_0x5d2439(0x16b)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x21b81c),loggerService_1[_0x5d2439(0x121)][_0x5d2439(0x115)](_0x5d2439(0x17c),_0x5d2439(0x139),'JSON\x20Parse\x20Error:\x20'+_0x21b81c);throw new Error(_0x5d2439(0x11b)+_0xffb032);}console[_0x5d2439(0x17a)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x5d2439(0x17a)]('Parsed\x20Result:',JSON['stringify'](_0x58dc7b,null,0x2)),loggerService_1[_0x5d2439(0x121)]['logWhiteDomainResponse'](_0x5d2439(0x17c),_0x5d2439(0x139),_0x11c32e[_0x5d2439(0x130)],_0x58dc7b,_0x29637c);if(_0x58dc7b['status']?.[_0x5d2439(0x130)]!==_0x5d2439(0x180)){const _0x25dd37=_0x58dc7b[_0x5d2439(0x130)]?.[_0x5d2439(0x12d)]||_0x5d2439(0x16c),_0x21f079=_0x58dc7b[_0x5d2439(0x130)]?.[_0x5d2439(0x122)]||'UNKNOWN';console[_0x5d2439(0x16b)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x5d2439(0x16b)](_0x5d2439(0x161),_0x21f079),console[_0x5d2439(0x16b)](_0x5d2439(0x12c),_0x25dd37),console['error']('Full\x20Error\x20Data:',_0x58dc7b[_0x5d2439(0x130)]),loggerService_1[_0x5d2439(0x121)][_0x5d2439(0x115)](_0x5d2439(0x17c),_0x5d2439(0x139),_0x5d2439(0x123)+_0x21f079+_0x5d2439(0x15b)+_0x25dd37);throw new Error(_0x5d2439(0x167)+_0x21f079+_0x5d2439(0x15b)+_0x25dd37);}if(!_0x58dc7b[_0x5d2439(0x179)]?.['id']||!_0x58dc7b[_0x5d2439(0x179)]?.[_0x5d2439(0x15f)]){console[_0x5d2439(0x16b)]('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x5d2439(0x16b)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console[_0x5d2439(0x16b)](_0x5d2439(0x15a),_0x58dc7b['data']),loggerService_1[_0x5d2439(0x121)]['logWhiteDomainError'](_0x5d2439(0x17c),_0x5d2439(0x139),_0x5d2439(0x157));throw new Error(_0x5d2439(0x166));}return console[_0x5d2439(0x17a)](_0x5d2439(0x10f)),console['log']('Payment\x20Link\x20ID:',_0x58dc7b['data']['id']),console['log'](_0x5d2439(0x17f),_0x58dc7b[_0x5d2439(0x179)][_0x5d2439(0x15f)]),console['log']('🇬🇧\x20Country\x20used:\x20'+_0x2abb63+_0x5d2439(0x117)),console[_0x5d2439(0x17a)](_0x5d2439(0x183)),{'gateway_payment_id':_0x58dc7b[_0x5d2439(0x179)]['id'],'payment_url':_0x58dc7b[_0x5d2439(0x179)][_0x5d2439(0x15f)]};}catch(_0xbeeffd){console[_0x5d2439(0x16b)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x5d2439(0x16b)](_0x5d2439(0x163),_0xbeeffd),loggerService_1[_0x5d2439(0x121)][_0x5d2439(0x115)](_0x5d2439(0x17c),_0x5d2439(0x139),_0xbeeffd);if(_0xbeeffd instanceof Error){console[_0x5d2439(0x16b)](_0x5d2439(0x150),_0xbeeffd[_0x5d2439(0x12d)]),console[_0x5d2439(0x16b)]('Error\x20stack:',_0xbeeffd[_0x5d2439(0x116)]);throw new Error(_0x5d2439(0x175)+_0xbeeffd[_0x5d2439(0x12d)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a56_0x114887(0x181)](_0x4b8518){const _0x2e13d6=a56_0x114887,_0x446385=Date[_0x2e13d6(0x14a)]();try{loggerService_1['loggerService'][_0x2e13d6(0x16d)](_0x2e13d6(0x17c),_0x2e13d6(0x13e)+_0x4b8518,_0x2e13d6(0x136),{});const _0xd33b90=await fetch(this[_0x2e13d6(0x15d)]+'/'+_0x4b8518,{'method':'GET','headers':{'Content-Type':_0x2e13d6(0x14f),'User-Agent':_0x2e13d6(0x11a)}}),_0xaebf5f=Date[_0x2e13d6(0x14a)]()-_0x446385;if(!_0xd33b90['ok']){const _0x2928fd=await _0xd33b90['text']();loggerService_1[_0x2e13d6(0x121)][_0x2e13d6(0x164)](_0x2e13d6(0x17c),_0x2e13d6(0x13e)+_0x4b8518,_0xd33b90[_0x2e13d6(0x130)],_0x2928fd,_0xaebf5f);throw new Error('HTTP\x20error!\x20status:\x20'+_0xd33b90['status']);}const _0x5cb417=await _0xd33b90[_0x2e13d6(0x138)]();loggerService_1[_0x2e13d6(0x121)]['logWhiteDomainResponse']('rapyd',_0x2e13d6(0x13e)+_0x4b8518,_0xd33b90[_0x2e13d6(0x130)],_0x5cb417,_0xaebf5f);if(_0x5cb417[_0x2e13d6(0x130)]?.['status']!==_0x2e13d6(0x180)){loggerService_1['loggerService']['logWhiteDomainError'](_0x2e13d6(0x17c),'/v1/hosted/payment_links/'+_0x4b8518,_0x2e13d6(0x11e)+(_0x5cb417['status']?.[_0x2e13d6(0x12d)]||_0x2e13d6(0x131)));throw new Error(_0x2e13d6(0x11e)+(_0x5cb417[_0x2e13d6(0x130)]?.['message']||'Unknown\x20error'));}let _0x568071=_0x2e13d6(0x168);if(_0x5cb417['data']?.[_0x2e13d6(0x130)])switch(_0x5cb417[_0x2e13d6(0x179)]['status']['toUpperCase']()){case _0x2e13d6(0x12b):_0x568071='PAID';break;case'CAN':_0x568071='FAILED';break;case _0x2e13d6(0x134):_0x568071='EXPIRED';break;case _0x2e13d6(0x12f):_0x568071='FAILED';break;case _0x2e13d6(0x13f):case _0x2e13d6(0x16a):default:_0x568071='PENDING';break;}return{'status':_0x568071,'amount':_0x5cb417[_0x2e13d6(0x179)]?.[_0x2e13d6(0x128)],'currency':_0x5cb417[_0x2e13d6(0x179)]?.[_0x2e13d6(0x15c)]};}catch(_0xf4afa1){console[_0x2e13d6(0x16b)](_0x2e13d6(0x160),_0xf4afa1),loggerService_1[_0x2e13d6(0x121)][_0x2e13d6(0x115)](_0x2e13d6(0x17c),_0x2e13d6(0x13e)+_0x4b8518,_0xf4afa1);throw new Error('Failed\x20to\x20verify\x20Rapyd\x20payment:\x20'+(_0xf4afa1 instanceof Error?_0xf4afa1[_0x2e13d6(0x12d)]:_0x2e13d6(0x131)));}}async['processWebhook'](_0x580972){const _0x108cc3=a56_0x114887;console[_0x108cc3(0x17a)](_0x108cc3(0x119),_0x580972);let _0x4662d4=_0x108cc3(0x168),_0x33c529;_0x580972[_0x108cc3(0x179)]?.[_0x108cc3(0x113)]&&(_0x33c529=_0x580972['data'][_0x108cc3(0x113)],console['log'](_0x108cc3(0x11d)+_0x33c529));switch(_0x580972['type']?.['toUpperCase']()){case _0x108cc3(0x110):_0x580972[_0x108cc3(0x179)]?.[_0x108cc3(0x14b)]===!![]&&_0x580972[_0x108cc3(0x179)]?.[_0x108cc3(0x130)]===_0x108cc3(0x12b)?_0x4662d4=_0x108cc3(0x159):_0x4662d4='PENDING';break;case _0x108cc3(0x120):_0x4662d4=_0x108cc3(0x156);break;case _0x108cc3(0x141):_0x4662d4='EXPIRED';break;case _0x108cc3(0x147):_0x4662d4=_0x108cc3(0x156);!_0x33c529&&_0x580972[_0x108cc3(0x179)]?.[_0x108cc3(0x113)]&&(_0x33c529=_0x580972[_0x108cc3(0x179)][_0x108cc3(0x113)]);break;default:switch(_0x580972[_0x108cc3(0x179)]?.['status']?.[_0x108cc3(0x142)]()){case _0x108cc3(0x12b):_0x580972[_0x108cc3(0x179)]?.[_0x108cc3(0x14b)]===!![]?_0x4662d4=_0x108cc3(0x159):_0x4662d4=_0x108cc3(0x156);break;case _0x108cc3(0x13a):_0x4662d4=_0x108cc3(0x156);break;case'EXP':_0x4662d4=_0x108cc3(0x14e);break;case _0x108cc3(0x12f):_0x4662d4=_0x108cc3(0x156);!_0x33c529&&_0x580972['data']?.[_0x108cc3(0x113)]&&(_0x33c529=_0x580972[_0x108cc3(0x179)][_0x108cc3(0x113)]);break;case _0x108cc3(0x13f):case _0x108cc3(0x16a):default:_0x4662d4='PENDING';break;}break;}const _0x312ff0={};return _0x580972[_0x108cc3(0x179)]?.['payment_method_data']?.['last4']&&(_0x312ff0[_0x108cc3(0x146)]=_0x580972['data']['payment_method_data'][_0x108cc3(0x176)]),_0x580972[_0x108cc3(0x179)]?.[_0x108cc3(0x144)]&&(_0x312ff0['paymentMethod']=_0x580972[_0x108cc3(0x179)]['payment_method_type']),_0x580972[_0x108cc3(0x179)]?.[_0x108cc3(0x122)]&&(_0x312ff0['errorCode']=_0x580972['data'][_0x108cc3(0x122)]),_0x580972['data']?.[_0x108cc3(0x125)]&&(_0x312ff0[_0x108cc3(0x165)]=_0x580972[_0x108cc3(0x179)][_0x108cc3(0x125)]),console[_0x108cc3(0x17a)]('🔄\x20Rapyd\x20webhook\x20processed:\x20status='+_0x4662d4+_0x108cc3(0x14d)+(_0x33c529||_0x108cc3(0x170))),{'paymentId':_0x580972['data']?.['merchant_reference_id']||'','status':_0x4662d4,'amount':_0x580972[_0x108cc3(0x179)]?.[_0x108cc3(0x128)],'currency':_0x580972['data']?.[_0x108cc3(0x15c)],'failureMessage':_0x33c529,'additionalInfo':_0x312ff0};}}exports['RapydService']=RapydService;