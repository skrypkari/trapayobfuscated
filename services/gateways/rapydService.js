'use strict';const a46_0x496bf5=a46_0x2d8c;function a46_0x1138(){const _0x5caa57=['SUCCESS','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','4904520ewqLsS','failureCode','data','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','Full\x20Error\x20Data:','error_code','/v1/hosted/payment_links/','HTTP\x20','rapyd','CAN','Error\x20message:','UNKNOWN','statusText','redirect_url','defineProperty','PENDING','RapydService','parse','Request\x20Body\x20(Updated\x20Format):','Raw\x20Response\x20Body:','CLO','===\x20RAPYD\x20SUCCESS\x20===','üí•\x20Rapyd\x20failure\x20message:\x20','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','POST','Status:','7aZgLwb','loggerService','merchant_reference_id','logWhiteDomainResponse','414531DAkrZC','none','Rapyd\x20payment\x20verification\x20error:','failure_code','paymentMethod','apiUrl','===\x20RAPYD\x20API\x20ERROR\x20===','2108506txFKKT','3FLNKHs','log','üá¨üáß\x20Country\x20used:\x20',',\x20body:\x20','Unknown\x20error\x20from\x20Rapyd\x20API','4579974uUJgQW','\x20(GB\x20-\x20Britain)','entries','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Business\x20Error\x20(','Error\x20stack:','logWhiteDomainError','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','üá¨üáß\x20Country:\x20','type','TesSoft\x20Payment\x20System/1.0','error','stringify','message','application/json','paid','FAILED','last4','text','56089rGelHX','verifyPayment','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','json','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','payment_method_type','status','toUpperCase','ERR','logWhiteDomainRequest','\x20(always\x20GB\x20for\x20Rapyd)','currency','failure_message','GET','URL:','Response\x20Body:','HTTP\x20error!\x20status:\x20','Error\x20details:','Response\x20Time:','ACT','PAYMENT_COMPLETED','Response\x20data:','createPaymentLink','1XpHHoN','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','248qHhvYf','ORDER:\x20','headers','Rapyd\x20API\x20error\x20(','now','NEW','130ULAQNG','Status\x20Text:','EXP','amount','payment_method_data','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Error\x20Message:','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','Rapyd\x20API\x20error:\x20','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','9487032veCSOK','PAID','Parsed\x20Result:','):\x20','cardLast4','https://tesoft.uk/gateway/success.php?id=','EXPIRED','Unknown\x20error','processWebhook','https://tesoft.uk/gateway/fail.php?id=','/v1/hosted/payment_links',',\x20failureMessage=','131115IGimpN'];a46_0x1138=function(){return _0x5caa57;};return a46_0x1138();}function a46_0x2d8c(_0x43ff80,_0x254ae4){const _0x1138cd=a46_0x1138();return a46_0x2d8c=function(_0x2d8cb2,_0x54fa05){_0x2d8cb2=_0x2d8cb2-0x119;let _0x4e615b=_0x1138cd[_0x2d8cb2];return _0x4e615b;},a46_0x2d8c(_0x43ff80,_0x254ae4);}(function(_0x52c4f7,_0xb7a6f){const _0x56bf8e=a46_0x2d8c,_0x36f497=_0x52c4f7();while(!![]){try{const _0x2da9ac=parseInt(_0x56bf8e(0x18a))/0x1*(parseInt(_0x56bf8e(0x159))/0x2)+-parseInt(_0x56bf8e(0x15a))/0x3*(-parseInt(_0x56bf8e(0x134))/0x4)+parseInt(_0x56bf8e(0x130))/0x5+parseInt(_0x56bf8e(0x15f))/0x6*(parseInt(_0x56bf8e(0x14e))/0x7)+-parseInt(_0x56bf8e(0x18c))/0x8*(parseInt(_0x56bf8e(0x152))/0x9)+-parseInt(_0x56bf8e(0x11a))/0xa*(parseInt(_0x56bf8e(0x172))/0xb)+-parseInt(_0x56bf8e(0x124))/0xc;if(_0x2da9ac===_0xb7a6f)break;else _0x36f497['push'](_0x36f497['shift']());}catch(_0x576944){_0x36f497['push'](_0x36f497['shift']());}}}(a46_0x1138,0xbfb51));Object[a46_0x496bf5(0x142)](exports,'__esModule',{'value':!![]}),exports[a46_0x496bf5(0x144)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x51e7ef=a46_0x496bf5;this[_0x51e7ef(0x157)]='https://tesoft.uk/gateway/rapyd/',console[_0x51e7ef(0x15b)](_0x51e7ef(0x132));}async[a46_0x496bf5(0x189)](_0x56ed21){const _0xf1795e=a46_0x496bf5,{orderId:_0x283c1c,orderName:_0x52d6f6,amount:_0x4eb366,currency:_0x28e7c6,usage:_0x2482da,maxPayments:_0x532dbd,successUrl:_0x28cc22,failUrl:_0xeb4d2b}=_0x56ed21,_0x3ea328=_0x28e7c6[_0xf1795e(0x17a)](),_0x2a1fed='GB';console['log'](_0xf1795e(0x137));const _0x2ca290=_0xf1795e(0x129)+_0x283c1c,_0x1d9615=_0xf1795e(0x12d)+_0x283c1c,_0x454506={'amount':_0x4eb366,'currency':_0x3ea328,'cancel_checkout_url':_0x1d9615,'complete_checkout_url':_0x2ca290,'complete_payment_url':_0x2ca290,'merchant_reference_id':_0x283c1c,'description':_0xf1795e(0x18d)+_0x283c1c,'country':'GB','payment_method_types_include':['gb_visa_card','gb_mastercard_card'],'custom_elements':{'display_description':!![]}},_0x49bb33=Date[_0xf1795e(0x190)]();try{console[_0xf1795e(0x15b)](_0xf1795e(0x174)),console[_0xf1795e(0x15b)](_0xf1795e(0x181),this['apiUrl']),console[_0xf1795e(0x15b)](_0xf1795e(0x146),JSON[_0xf1795e(0x16b)](_0x454506,null,0x2)),console[_0xf1795e(0x15b)](_0xf1795e(0x167)+_0x2a1fed+_0xf1795e(0x17d)),console['log']('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1['loggerService'][_0xf1795e(0x17c)](_0xf1795e(0x13c),_0xf1795e(0x12e),'POST',_0x454506);const _0x23e0e4=await fetch(this[_0xf1795e(0x157)],{'method':_0xf1795e(0x14c),'headers':{'Content-Type':_0xf1795e(0x16d),'User-Agent':_0xf1795e(0x169)},'body':JSON[_0xf1795e(0x16b)](_0x454506)}),_0x19ca28=Date[_0xf1795e(0x190)]()-_0x49bb33;console[_0xf1795e(0x15b)](_0xf1795e(0x14b)),console[_0xf1795e(0x15b)](_0xf1795e(0x14d),_0x23e0e4[_0xf1795e(0x179)]),console[_0xf1795e(0x15b)](_0xf1795e(0x11b),_0x23e0e4[_0xf1795e(0x140)]),console[_0xf1795e(0x15b)]('Headers:',Object['fromEntries'](_0x23e0e4[_0xf1795e(0x18e)][_0xf1795e(0x161)]())),console[_0xf1795e(0x15b)](_0xf1795e(0x185),_0x19ca28+'ms');const _0x4124e3=await _0x23e0e4[_0xf1795e(0x171)]();console['log'](_0xf1795e(0x147),_0x4124e3);if(!_0x23e0e4['ok']){console[_0xf1795e(0x16a)](_0xf1795e(0x158)),console[_0xf1795e(0x16a)]('HTTP\x20Status:',_0x23e0e4[_0xf1795e(0x179)]),console['error'](_0xf1795e(0x182),_0x4124e3),loggerService_1[_0xf1795e(0x14f)][_0xf1795e(0x151)]('rapyd',_0xf1795e(0x12e),_0x23e0e4[_0xf1795e(0x179)],_0x4124e3,_0x19ca28),loggerService_1[_0xf1795e(0x14f)][_0xf1795e(0x165)]('rapyd',_0xf1795e(0x12e),_0xf1795e(0x13b)+_0x23e0e4['status']+':\x20'+_0x4124e3);throw new Error('HTTP\x20error!\x20status:\x20'+_0x23e0e4[_0xf1795e(0x179)]+_0xf1795e(0x15d)+_0x4124e3);}let _0x19d2a4;try{_0x19d2a4=JSON[_0xf1795e(0x145)](_0x4124e3);}catch(_0x48184c){console[_0xf1795e(0x16a)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x48184c),loggerService_1[_0xf1795e(0x14f)]['logWhiteDomainError'](_0xf1795e(0x13c),_0xf1795e(0x12e),'JSON\x20Parse\x20Error:\x20'+_0x48184c);throw new Error(_0xf1795e(0x121)+_0x4124e3);}console[_0xf1795e(0x15b)](_0xf1795e(0x123)),console['log'](_0xf1795e(0x126),JSON[_0xf1795e(0x16b)](_0x19d2a4,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse']('rapyd',_0xf1795e(0x12e),_0x23e0e4[_0xf1795e(0x179)],_0x19d2a4,_0x19ca28);if(_0x19d2a4['status']?.['status']!==_0xf1795e(0x131)){const _0x3846bc=_0x19d2a4['status']?.[_0xf1795e(0x16c)]||_0xf1795e(0x15e),_0xed7e21=_0x19d2a4[_0xf1795e(0x179)]?.[_0xf1795e(0x139)]||_0xf1795e(0x13f);console['error']('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0xf1795e(0x16a)]('Error\x20Code:',_0xed7e21),console[_0xf1795e(0x16a)](_0xf1795e(0x120),_0x3846bc),console[_0xf1795e(0x16a)](_0xf1795e(0x138),_0x19d2a4['status']),loggerService_1[_0xf1795e(0x14f)][_0xf1795e(0x165)]('rapyd',_0xf1795e(0x12e),_0xf1795e(0x163)+_0xed7e21+_0xf1795e(0x127)+_0x3846bc);throw new Error(_0xf1795e(0x18f)+_0xed7e21+_0xf1795e(0x127)+_0x3846bc);}if(!_0x19d2a4[_0xf1795e(0x136)]?.['id']||!_0x19d2a4['data']?.[_0xf1795e(0x141)]){console[_0xf1795e(0x16a)](_0xf1795e(0x133)),console['error'](_0xf1795e(0x162)),console[_0xf1795e(0x16a)](_0xf1795e(0x188),_0x19d2a4[_0xf1795e(0x136)]),loggerService_1[_0xf1795e(0x14f)]['logWhiteDomainError'](_0xf1795e(0x13c),_0xf1795e(0x12e),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0xf1795e(0x175));}return console[_0xf1795e(0x15b)](_0xf1795e(0x149)),console['log']('Payment\x20Link\x20ID:',_0x19d2a4[_0xf1795e(0x136)]['id']),console[_0xf1795e(0x15b)]('Redirect\x20URL:',_0x19d2a4[_0xf1795e(0x136)][_0xf1795e(0x141)]),console[_0xf1795e(0x15b)](_0xf1795e(0x15c)+_0x2a1fed+_0xf1795e(0x160)),console['log'](_0xf1795e(0x11f)),{'gateway_payment_id':_0x19d2a4[_0xf1795e(0x136)]['id'],'payment_url':_0x19d2a4[_0xf1795e(0x136)][_0xf1795e(0x141)]};}catch(_0x20199c){console[_0xf1795e(0x16a)](_0xf1795e(0x166)),console['error'](_0xf1795e(0x184),_0x20199c),loggerService_1[_0xf1795e(0x14f)][_0xf1795e(0x165)]('rapyd',_0xf1795e(0x12e),_0x20199c);if(_0x20199c instanceof Error){console[_0xf1795e(0x16a)](_0xf1795e(0x13e),_0x20199c[_0xf1795e(0x16c)]),console[_0xf1795e(0x16a)](_0xf1795e(0x164),_0x20199c['stack']);throw new Error(_0xf1795e(0x177)+_0x20199c[_0xf1795e(0x16c)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a46_0x496bf5(0x173)](_0x52cf54){const _0x38f1bb=a46_0x496bf5,_0x48773d=Date[_0x38f1bb(0x190)]();try{loggerService_1[_0x38f1bb(0x14f)][_0x38f1bb(0x17c)](_0x38f1bb(0x13c),_0x38f1bb(0x13a)+_0x52cf54,_0x38f1bb(0x180),{});const _0x5bf322=await fetch(this[_0x38f1bb(0x157)]+'/'+_0x52cf54,{'method':_0x38f1bb(0x180),'headers':{'Content-Type':_0x38f1bb(0x16d),'User-Agent':_0x38f1bb(0x169)}}),_0x2901df=Date[_0x38f1bb(0x190)]()-_0x48773d;if(!_0x5bf322['ok']){const _0x3a1c1a=await _0x5bf322['text']();loggerService_1[_0x38f1bb(0x14f)]['logWhiteDomainResponse'](_0x38f1bb(0x13c),_0x38f1bb(0x13a)+_0x52cf54,_0x5bf322[_0x38f1bb(0x179)],_0x3a1c1a,_0x2901df);throw new Error(_0x38f1bb(0x183)+_0x5bf322['status']);}const _0x4453c3=await _0x5bf322[_0x38f1bb(0x176)]();loggerService_1['loggerService'][_0x38f1bb(0x151)]('rapyd','/v1/hosted/payment_links/'+_0x52cf54,_0x5bf322['status'],_0x4453c3,_0x2901df);if(_0x4453c3['status']?.[_0x38f1bb(0x179)]!==_0x38f1bb(0x131)){loggerService_1[_0x38f1bb(0x14f)][_0x38f1bb(0x165)](_0x38f1bb(0x13c),_0x38f1bb(0x13a)+_0x52cf54,_0x38f1bb(0x122)+(_0x4453c3[_0x38f1bb(0x179)]?.[_0x38f1bb(0x16c)]||_0x38f1bb(0x12b)));throw new Error(_0x38f1bb(0x122)+(_0x4453c3[_0x38f1bb(0x179)]?.[_0x38f1bb(0x16c)]||_0x38f1bb(0x12b)));}let _0x11999b=_0x38f1bb(0x143);if(_0x4453c3[_0x38f1bb(0x136)]?.[_0x38f1bb(0x179)])switch(_0x4453c3[_0x38f1bb(0x136)][_0x38f1bb(0x179)]['toUpperCase']()){case _0x38f1bb(0x148):_0x11999b=_0x38f1bb(0x125);break;case _0x38f1bb(0x13d):_0x11999b=_0x38f1bb(0x16f);break;case _0x38f1bb(0x11c):_0x11999b=_0x38f1bb(0x12a);break;case _0x38f1bb(0x17b):_0x11999b=_0x38f1bb(0x16f);break;case _0x38f1bb(0x119):case _0x38f1bb(0x186):default:_0x11999b=_0x38f1bb(0x143);break;}return{'status':_0x11999b,'amount':_0x4453c3['data']?.[_0x38f1bb(0x11d)],'currency':_0x4453c3[_0x38f1bb(0x136)]?.[_0x38f1bb(0x17e)]};}catch(_0x1a3365){console[_0x38f1bb(0x16a)](_0x38f1bb(0x154),_0x1a3365),loggerService_1[_0x38f1bb(0x14f)][_0x38f1bb(0x165)](_0x38f1bb(0x13c),'/v1/hosted/payment_links/'+_0x52cf54,_0x1a3365);throw new Error(_0x38f1bb(0x18b)+(_0x1a3365 instanceof Error?_0x1a3365['message']:_0x38f1bb(0x12b)));}}async[a46_0x496bf5(0x12c)](_0x1e177f){const _0x258c7e=a46_0x496bf5;console[_0x258c7e(0x15b)]('Processing\x20Rapyd\x20webhook:',_0x1e177f);let _0x37a3f6=_0x258c7e(0x143),_0x467bb6;_0x1e177f[_0x258c7e(0x136)]?.[_0x258c7e(0x17f)]&&(_0x467bb6=_0x1e177f[_0x258c7e(0x136)][_0x258c7e(0x17f)],console[_0x258c7e(0x15b)](_0x258c7e(0x14a)+_0x467bb6));switch(_0x1e177f[_0x258c7e(0x168)]?.[_0x258c7e(0x17a)]()){case _0x258c7e(0x187):_0x1e177f[_0x258c7e(0x136)]?.[_0x258c7e(0x16e)]===!![]&&_0x1e177f[_0x258c7e(0x136)]?.[_0x258c7e(0x179)]===_0x258c7e(0x148)?_0x37a3f6=_0x258c7e(0x125):_0x37a3f6=_0x258c7e(0x143);break;case'PAYMENT_CANCELED':_0x37a3f6=_0x258c7e(0x16f);break;case'PAYMENT_EXPIRED':_0x37a3f6=_0x258c7e(0x12a);break;case'PAYMENT_FAILED':_0x37a3f6=_0x258c7e(0x16f);!_0x467bb6&&_0x1e177f[_0x258c7e(0x136)]?.[_0x258c7e(0x17f)]&&(_0x467bb6=_0x1e177f[_0x258c7e(0x136)][_0x258c7e(0x17f)]);break;default:switch(_0x1e177f['data']?.[_0x258c7e(0x179)]?.[_0x258c7e(0x17a)]()){case _0x258c7e(0x148):_0x1e177f[_0x258c7e(0x136)]?.[_0x258c7e(0x16e)]===!![]?_0x37a3f6=_0x258c7e(0x125):_0x37a3f6=_0x258c7e(0x16f);break;case'CAN':_0x37a3f6=_0x258c7e(0x16f);break;case'EXP':_0x37a3f6=_0x258c7e(0x12a);break;case _0x258c7e(0x17b):_0x37a3f6=_0x258c7e(0x16f);!_0x467bb6&&_0x1e177f['data']?.[_0x258c7e(0x17f)]&&(_0x467bb6=_0x1e177f[_0x258c7e(0x136)][_0x258c7e(0x17f)]);break;case'NEW':case _0x258c7e(0x186):default:_0x37a3f6=_0x258c7e(0x143);break;}break;}const _0x31120e={};return _0x1e177f['data']?.[_0x258c7e(0x11e)]?.['last4']&&(_0x31120e[_0x258c7e(0x128)]=_0x1e177f[_0x258c7e(0x136)][_0x258c7e(0x11e)][_0x258c7e(0x170)]),_0x1e177f[_0x258c7e(0x136)]?.['payment_method_type']&&(_0x31120e[_0x258c7e(0x156)]=_0x1e177f[_0x258c7e(0x136)][_0x258c7e(0x178)]),_0x1e177f[_0x258c7e(0x136)]?.[_0x258c7e(0x139)]&&(_0x31120e['errorCode']=_0x1e177f[_0x258c7e(0x136)][_0x258c7e(0x139)]),_0x1e177f[_0x258c7e(0x136)]?.[_0x258c7e(0x155)]&&(_0x31120e[_0x258c7e(0x135)]=_0x1e177f[_0x258c7e(0x136)][_0x258c7e(0x155)]),console['log']('üîÑ\x20Rapyd\x20webhook\x20processed:\x20status='+_0x37a3f6+_0x258c7e(0x12f)+(_0x467bb6||_0x258c7e(0x153))),{'paymentId':_0x1e177f['data']?.[_0x258c7e(0x150)]||'','status':_0x37a3f6,'amount':_0x1e177f[_0x258c7e(0x136)]?.[_0x258c7e(0x11d)],'currency':_0x1e177f[_0x258c7e(0x136)]?.['currency'],'failureMessage':_0x467bb6,'additionalInfo':_0x31120e};}}exports[a46_0x496bf5(0x144)]=RapydService;