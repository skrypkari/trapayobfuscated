'use strict';const a45_0x48a7fe=a45_0x505e;(function(_0x9f7bca,_0x538e1b){const _0x13e896=a45_0x505e,_0x163043=_0x9f7bca();while(!![]){try{const _0x50cfe3=-parseInt(_0x13e896(0x11f))/0x1*(-parseInt(_0x13e896(0x128))/0x2)+parseInt(_0x13e896(0x113))/0x3*(-parseInt(_0x13e896(0xdf))/0x4)+parseInt(_0x13e896(0xf8))/0x5+-parseInt(_0x13e896(0x120))/0x6*(parseInt(_0x13e896(0x12b))/0x7)+parseInt(_0x13e896(0xec))/0x8+parseInt(_0x13e896(0x111))/0x9*(parseInt(_0x13e896(0xd1))/0xa)+-parseInt(_0x13e896(0xd5))/0xb*(parseInt(_0x13e896(0xca))/0xc);if(_0x50cfe3===_0x538e1b)break;else _0x163043['push'](_0x163043['shift']());}catch(_0x584116){_0x163043['push'](_0x163043['shift']());}}}(a45_0x54f5,0x83cd9));Object[a45_0x48a7fe(0xe4)](exports,a45_0x48a7fe(0x123),{'value':!![]}),exports[a45_0x48a7fe(0x12a)]=void 0x0;function a45_0x505e(_0x22b0d1,_0x3ce5a4){const _0x54f5ad=a45_0x54f5();return a45_0x505e=function(_0x505e31,_0x5570b1){_0x505e31=_0x505e31-0xc1;let _0xfee061=_0x54f5ad[_0x505e31];return _0xfee061;},a45_0x505e(_0x22b0d1,_0x3ce5a4);}function a45_0x54f5(){const _0x65b264=['https://tesoft.uk/gateway/success.php?id=','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','EXPIRED','66519xtAMyx','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','119745EokfiP','https://tesoft.uk/gateway/rapyd/','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','ERR','payment_method_data','redirect_url','https://tesoft.uk/gateway/fail.php?id=','Error\x20message:','loggerService','failure_code','json','headers','882560WbYHgi','4404IDxHdQ','message','SUCCESS','__esModule','parse','type','PAID','statusText','2yrnzjF','FAILED','RapydService','3157aTIfwB','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','/v1/hosted/payment_links/','Error\x20Code:','amount','Raw\x20Response\x20Body:','Response\x20Body:','paymentMethod','Processing\x20Rapyd\x20webhook:','ORDER:\x20','===\x20RAPYD\x20SUCCESS\x20===','/v1/hosted/payment_links','createPaymentLink','PAYMENT_CANCELED','Payment\x20Link\x20ID:','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','JSON\x20Parse\x20Error:\x20','Unknown\x20error\x20from\x20Rapyd\x20API','fromEntries','payment_method_type','===\x20RAPYD\x20API\x20ERROR\x20===','error_code','Rapyd\x20API\x20error:\x20','apiUrl',',\x20body:\x20','104628pQboeh','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','POST','Error\x20Message:','entries','PENDING','EXP','1310egkBCf','application/json','log','PAYMENT_COMPLETED','2519QhBdQk','failure_message','):\x20','CAN','logWhiteDomainResponse','Headers:','none','Parsed\x20Result:','CLO','Business\x20Error\x20(','20PXETxW','status','GET','HTTP\x20','TesSoft\x20Payment\x20System/1.0','defineProperty','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','\x20(always\x20GB\x20for\x20Rapyd)','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','logWhiteDomainError','Failed\x20to\x20parse\x20JSON\x20response:','data','merchant_reference_id','6776752jNFRVk','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','ACT','gb_visa_card','Full\x20Error\x20Data:','Rapyd\x20payment\x20verification\x20error:','last4','rapyd','Unknown\x20error','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','NEW','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','1846250qrmfte','Redirect\x20URL:','../loggerService','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','errorCode','now','toUpperCase','HTTP\x20Status:','Response\x20Time:','üí•\x20Rapyd\x20failure\x20message:\x20','\x20(GB\x20-\x20Britain)','text','Response\x20data:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','HTTP\x20error!\x20status:\x20','stringify','paid','stack','gb_mastercard_card',',\x20failureMessage=','error','Missing\x20id\x20or\x20redirect_url\x20in\x20response'];a45_0x54f5=function(){return _0x65b264;};return a45_0x54f5();}const loggerService_1=require(a45_0x48a7fe(0xfa));class RapydService{constructor(){const _0x99a053=a45_0x48a7fe;this['apiUrl']=_0x99a053(0x114),console['log'](_0x99a053(0xcb));}async[a45_0x48a7fe(0x137)](_0x98712c){const _0x506f60=a45_0x48a7fe,{orderId:_0x40d8b5,orderName:_0x10f6ea,amount:_0x4fa962,currency:_0xe6437,usage:_0x4aa0cc,maxPayments:_0x5badf7,successUrl:_0x23b5fc,failUrl:_0x1f4211}=_0x98712c,_0x5b34d0=_0xe6437[_0x506f60(0xfe)](),_0x12dc92='GB';console[_0x506f60(0xd3)]('üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x3b28d8=_0x506f60(0x10e)+_0x40d8b5,_0x444789=_0x506f60(0x119)+_0x40d8b5,_0x5fa06e={'amount':_0x4fa962,'currency':_0x5b34d0,'cancel_checkout_url':_0x444789,'complete_checkout_url':_0x3b28d8,'complete_payment_url':_0x3b28d8,'merchant_reference_id':_0x40d8b5,'description':_0x506f60(0x134)+_0x40d8b5,'country':'GB','payment_method_types_include':[_0x506f60(0xef),_0x506f60(0x10a)],'custom_elements':{'display_description':!![]}},_0x77c21c=Date[_0x506f60(0xfd)]();try{console[_0x506f60(0xd3)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x506f60(0xd3)]('URL:',this['apiUrl']),console['log']('Request\x20Body\x20(Updated\x20Format):',JSON['stringify'](_0x5fa06e,null,0x2)),console[_0x506f60(0xd3)]('üá¨üáß\x20Country:\x20'+_0x12dc92+_0x506f60(0xe6)),console[_0x506f60(0xd3)](_0x506f60(0x13a)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x506f60(0xf3),_0x506f60(0x136),_0x506f60(0xcc),_0x5fa06e);const _0x439369=await fetch(this[_0x506f60(0xc8)],{'method':_0x506f60(0xcc),'headers':{'Content-Type':_0x506f60(0xd2),'User-Agent':_0x506f60(0xe3)},'body':JSON['stringify'](_0x5fa06e)}),_0x34d54c=Date[_0x506f60(0xfd)]()-_0x77c21c;console['log'](_0x506f60(0xe5)),console['log']('Status:',_0x439369[_0x506f60(0xe0)]),console[_0x506f60(0xd3)]('Status\x20Text:',_0x439369[_0x506f60(0x127)]),console[_0x506f60(0xd3)](_0x506f60(0xda),Object[_0x506f60(0xc3)](_0x439369[_0x506f60(0x11e)][_0x506f60(0xce)]())),console[_0x506f60(0xd3)](_0x506f60(0x100),_0x34d54c+'ms');const _0x36538d=await _0x439369['text']();console[_0x506f60(0xd3)](_0x506f60(0x130),_0x36538d);if(!_0x439369['ok']){console[_0x506f60(0x10c)](_0x506f60(0xc5)),console['error'](_0x506f60(0xff),_0x439369[_0x506f60(0xe0)]),console[_0x506f60(0x10c)](_0x506f60(0x131),_0x36538d),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x506f60(0xf3),_0x506f60(0x136),_0x439369[_0x506f60(0xe0)],_0x36538d,_0x34d54c),loggerService_1[_0x506f60(0x11b)]['logWhiteDomainError'](_0x506f60(0xf3),_0x506f60(0x136),_0x506f60(0xe2)+_0x439369[_0x506f60(0xe0)]+':\x20'+_0x36538d);throw new Error(_0x506f60(0x106)+_0x439369[_0x506f60(0xe0)]+_0x506f60(0xc9)+_0x36538d);}let _0x3667ec;try{_0x3667ec=JSON[_0x506f60(0x124)](_0x36538d);}catch(_0x1fcb9e){console[_0x506f60(0x10c)](_0x506f60(0xe9),_0x1fcb9e),loggerService_1['loggerService'][_0x506f60(0xe8)](_0x506f60(0xf3),_0x506f60(0x136),_0x506f60(0xc1)+_0x1fcb9e);throw new Error(_0x506f60(0xfb)+_0x36538d);}console[_0x506f60(0xd3)](_0x506f60(0xf5)),console[_0x506f60(0xd3)](_0x506f60(0xdc),JSON[_0x506f60(0x107)](_0x3667ec,null,0x2)),loggerService_1['loggerService'][_0x506f60(0xd9)](_0x506f60(0xf3),_0x506f60(0x136),_0x439369['status'],_0x3667ec,_0x34d54c);if(_0x3667ec[_0x506f60(0xe0)]?.[_0x506f60(0xe0)]!==_0x506f60(0x122)){const _0x38c456=_0x3667ec[_0x506f60(0xe0)]?.[_0x506f60(0x121)]||_0x506f60(0xc2),_0x4d535b=_0x3667ec[_0x506f60(0xe0)]?.[_0x506f60(0xc6)]||'UNKNOWN';console[_0x506f60(0x10c)](_0x506f60(0xf7)),console['error'](_0x506f60(0x12e),_0x4d535b),console['error'](_0x506f60(0xcd),_0x38c456),console[_0x506f60(0x10c)](_0x506f60(0xf0),_0x3667ec['status']),loggerService_1[_0x506f60(0x11b)]['logWhiteDomainError']('rapyd',_0x506f60(0x136),_0x506f60(0xde)+_0x4d535b+_0x506f60(0xd7)+_0x38c456);throw new Error('Rapyd\x20API\x20error\x20('+_0x4d535b+_0x506f60(0xd7)+_0x38c456);}if(!_0x3667ec[_0x506f60(0xea)]?.['id']||!_0x3667ec[_0x506f60(0xea)]?.[_0x506f60(0x118)]){console['error'](_0x506f60(0xed)),console[_0x506f60(0x10c)](_0x506f60(0x10d)),console['error'](_0x506f60(0x104),_0x3667ec[_0x506f60(0xea)]),loggerService_1[_0x506f60(0x11b)][_0x506f60(0xe8)](_0x506f60(0xf3),_0x506f60(0x136),_0x506f60(0x10f));throw new Error(_0x506f60(0x12c));}return console[_0x506f60(0xd3)](_0x506f60(0x135)),console[_0x506f60(0xd3)](_0x506f60(0x139),_0x3667ec['data']['id']),console['log'](_0x506f60(0xf9),_0x3667ec[_0x506f60(0xea)]['redirect_url']),console[_0x506f60(0xd3)]('üá¨üáß\x20Country\x20used:\x20'+_0x12dc92+_0x506f60(0x102)),console['log'](_0x506f60(0x13a)),{'gateway_payment_id':_0x3667ec['data']['id'],'payment_url':_0x3667ec[_0x506f60(0xea)]['redirect_url']};}catch(_0x2059e6){console[_0x506f60(0x10c)](_0x506f60(0xe7)),console[_0x506f60(0x10c)]('Error\x20details:',_0x2059e6),loggerService_1[_0x506f60(0x11b)][_0x506f60(0xe8)](_0x506f60(0xf3),_0x506f60(0x136),_0x2059e6);if(_0x2059e6 instanceof Error){console['error'](_0x506f60(0x11a),_0x2059e6[_0x506f60(0x121)]),console[_0x506f60(0x10c)]('Error\x20stack:',_0x2059e6[_0x506f60(0x109)]);throw new Error(_0x506f60(0x105)+_0x2059e6['message']);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x570768){const _0x2698a9=a45_0x48a7fe,_0x22f939=Date[_0x2698a9(0xfd)]();try{loggerService_1['loggerService']['logWhiteDomainRequest'](_0x2698a9(0xf3),_0x2698a9(0x12d)+_0x570768,_0x2698a9(0xe1),{});const _0x54a11e=await fetch(this['apiUrl']+'/'+_0x570768,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x2698a9(0xe3)}}),_0x40ecf1=Date['now']()-_0x22f939;if(!_0x54a11e['ok']){const _0xc031c7=await _0x54a11e[_0x2698a9(0x103)]();loggerService_1[_0x2698a9(0x11b)][_0x2698a9(0xd9)](_0x2698a9(0xf3),_0x2698a9(0x12d)+_0x570768,_0x54a11e[_0x2698a9(0xe0)],_0xc031c7,_0x40ecf1);throw new Error(_0x2698a9(0x106)+_0x54a11e['status']);}const _0x380391=await _0x54a11e[_0x2698a9(0x11d)]();loggerService_1[_0x2698a9(0x11b)][_0x2698a9(0xd9)](_0x2698a9(0xf3),'/v1/hosted/payment_links/'+_0x570768,_0x54a11e[_0x2698a9(0xe0)],_0x380391,_0x40ecf1);if(_0x380391[_0x2698a9(0xe0)]?.['status']!==_0x2698a9(0x122)){loggerService_1['loggerService']['logWhiteDomainError'](_0x2698a9(0xf3),_0x2698a9(0x12d)+_0x570768,_0x2698a9(0xc7)+(_0x380391[_0x2698a9(0xe0)]?.[_0x2698a9(0x121)]||_0x2698a9(0xf4)));throw new Error(_0x2698a9(0xc7)+(_0x380391[_0x2698a9(0xe0)]?.[_0x2698a9(0x121)]||_0x2698a9(0xf4)));}let _0x2ae416=_0x2698a9(0xcf);if(_0x380391[_0x2698a9(0xea)]?.['status'])switch(_0x380391[_0x2698a9(0xea)][_0x2698a9(0xe0)][_0x2698a9(0xfe)]()){case _0x2698a9(0xdd):_0x2ae416=_0x2698a9(0x126);break;case _0x2698a9(0xd8):_0x2ae416=_0x2698a9(0x129);break;case _0x2698a9(0xd0):_0x2ae416=_0x2698a9(0x110);break;case _0x2698a9(0x116):_0x2ae416=_0x2698a9(0x129);break;case _0x2698a9(0xf6):case _0x2698a9(0xee):default:_0x2ae416=_0x2698a9(0xcf);break;}return{'status':_0x2ae416,'amount':_0x380391[_0x2698a9(0xea)]?.[_0x2698a9(0x12f)],'currency':_0x380391['data']?.['currency']};}catch(_0x4e7d67){console[_0x2698a9(0x10c)](_0x2698a9(0xf1),_0x4e7d67),loggerService_1[_0x2698a9(0x11b)][_0x2698a9(0xe8)](_0x2698a9(0xf3),_0x2698a9(0x12d)+_0x570768,_0x4e7d67);throw new Error(_0x2698a9(0x115)+(_0x4e7d67 instanceof Error?_0x4e7d67[_0x2698a9(0x121)]:'Unknown\x20error'));}}async['processWebhook'](_0x3e08c9){const _0x2b5018=a45_0x48a7fe;console[_0x2b5018(0xd3)](_0x2b5018(0x133),_0x3e08c9);let _0x3bd9c9=_0x2b5018(0xcf),_0x49cf1c;_0x3e08c9['data']?.[_0x2b5018(0xd6)]&&(_0x49cf1c=_0x3e08c9[_0x2b5018(0xea)][_0x2b5018(0xd6)],console[_0x2b5018(0xd3)](_0x2b5018(0x101)+_0x49cf1c));switch(_0x3e08c9[_0x2b5018(0x125)]?.[_0x2b5018(0xfe)]()){case _0x2b5018(0xd4):_0x3e08c9['data']?.[_0x2b5018(0x108)]===!![]&&_0x3e08c9[_0x2b5018(0xea)]?.[_0x2b5018(0xe0)]===_0x2b5018(0xdd)?_0x3bd9c9=_0x2b5018(0x126):_0x3bd9c9='PENDING';break;case _0x2b5018(0x138):_0x3bd9c9=_0x2b5018(0x129);break;case'PAYMENT_EXPIRED':_0x3bd9c9=_0x2b5018(0x110);break;case'PAYMENT_FAILED':_0x3bd9c9=_0x2b5018(0x129);!_0x49cf1c&&_0x3e08c9[_0x2b5018(0xea)]?.[_0x2b5018(0xd6)]&&(_0x49cf1c=_0x3e08c9[_0x2b5018(0xea)]['failure_message']);break;default:switch(_0x3e08c9[_0x2b5018(0xea)]?.['status']?.[_0x2b5018(0xfe)]()){case _0x2b5018(0xdd):_0x3e08c9[_0x2b5018(0xea)]?.[_0x2b5018(0x108)]===!![]?_0x3bd9c9=_0x2b5018(0x126):_0x3bd9c9=_0x2b5018(0x129);break;case'CAN':_0x3bd9c9=_0x2b5018(0x129);break;case _0x2b5018(0xd0):_0x3bd9c9=_0x2b5018(0x110);break;case _0x2b5018(0x116):_0x3bd9c9=_0x2b5018(0x129);!_0x49cf1c&&_0x3e08c9['data']?.[_0x2b5018(0xd6)]&&(_0x49cf1c=_0x3e08c9[_0x2b5018(0xea)][_0x2b5018(0xd6)]);break;case _0x2b5018(0xf6):case _0x2b5018(0xee):default:_0x3bd9c9=_0x2b5018(0xcf);break;}break;}const _0x157a37={};return _0x3e08c9[_0x2b5018(0xea)]?.['payment_method_data']?.[_0x2b5018(0xf2)]&&(_0x157a37['cardLast4']=_0x3e08c9['data'][_0x2b5018(0x117)][_0x2b5018(0xf2)]),_0x3e08c9[_0x2b5018(0xea)]?.['payment_method_type']&&(_0x157a37[_0x2b5018(0x132)]=_0x3e08c9[_0x2b5018(0xea)][_0x2b5018(0xc4)]),_0x3e08c9[_0x2b5018(0xea)]?.[_0x2b5018(0xc6)]&&(_0x157a37[_0x2b5018(0xfc)]=_0x3e08c9[_0x2b5018(0xea)]['error_code']),_0x3e08c9[_0x2b5018(0xea)]?.[_0x2b5018(0x11c)]&&(_0x157a37['failureCode']=_0x3e08c9[_0x2b5018(0xea)][_0x2b5018(0x11c)]),console[_0x2b5018(0xd3)](_0x2b5018(0x112)+_0x3bd9c9+_0x2b5018(0x10b)+(_0x49cf1c||_0x2b5018(0xdb))),{'paymentId':_0x3e08c9[_0x2b5018(0xea)]?.[_0x2b5018(0xeb)]||'','status':_0x3bd9c9,'amount':_0x3e08c9[_0x2b5018(0xea)]?.[_0x2b5018(0x12f)],'currency':_0x3e08c9[_0x2b5018(0xea)]?.['currency'],'failureMessage':_0x49cf1c,'additionalInfo':_0x157a37};}}exports['RapydService']=RapydService;