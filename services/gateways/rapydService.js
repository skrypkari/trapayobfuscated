'use strict';const a69_0x4f27a2=a69_0x4a5e;(function(_0x2e87db,_0x4a5e2b){const _0x387aba=a69_0x4a5e,_0x44679d=_0x2e87db();while(!![]){try{const _0x23d1a9=-parseInt(_0x387aba(0x215))/0x1+-parseInt(_0x387aba(0x1f3))/0x2+-parseInt(_0x387aba(0x242))/0x3*(parseInt(_0x387aba(0x234))/0x4)+parseInt(_0x387aba(0x251))/0x5*(parseInt(_0x387aba(0x256))/0x6)+-parseInt(_0x387aba(0x20d))/0x7+-parseInt(_0x387aba(0x219))/0x8*(-parseInt(_0x387aba(0x23b))/0x9)+parseInt(_0x387aba(0x206))/0xa;if(_0x23d1a9===_0x4a5e2b)break;else _0x44679d['push'](_0x44679d['shift']());}catch(_0x54d1c6){_0x44679d['push'](_0x44679d['shift']());}}}(a69_0x1ae6,0x968b4));Object[a69_0x4f27a2(0x241)](exports,'__esModule',{'value':!![]}),exports[a69_0x4f27a2(0x22e)]=void 0x0;const loggerService_1=require(a69_0x4f27a2(0x222)),binLookupService_1=require(a69_0x4f27a2(0x24e));function a69_0x4a5e(_0x5138aa,_0x3d6e26){_0x5138aa=_0x5138aa-0x1d1;const _0x1ae630=a69_0x1ae6();let _0x4a5e7b=_0x1ae630[_0x5138aa];return _0x4a5e7b;}class RapydService{constructor(){const _0x9bc7b7=a69_0x4f27a2;this[_0x9bc7b7(0x22a)]='https://tesoft.uk/gateway/rapyd/',console[_0x9bc7b7(0x1d5)](_0x9bc7b7(0x209));}async[a69_0x4f27a2(0x1f8)](_0x41cd3d){const _0x32c663=a69_0x4f27a2,{orderId:_0x358714,orderName:_0x3a1caa,amount:_0x232402,currency:_0x2d4164,usage:_0x4f4717,maxPayments:_0x2645cf,successUrl:_0x197db0,failUrl:_0x480195,customerName:_0x585736,customerEmail:_0x44b01a}=_0x41cd3d,_0x1c2800=_0x2d4164[_0x32c663(0x224)](),_0x54be31='GB';console[_0x32c663(0x1d5)]('üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link');const _0x21fb8f=_0x32c663(0x1fa)+_0x358714,_0x3e2638=_0x32c663(0x1d1)+_0x358714,_0x4a4d35={'amount':_0x232402,'currency':_0x1c2800,'payment_method_options':{'3d_required':![]},'cancel_checkout_url':_0x3e2638,'complete_checkout_url':_0x21fb8f,'complete_payment_url':_0x21fb8f,'merchant_reference_id':_0x358714,'description':_0x32c663(0x220)+_0x358714,'statement_descriptor':'TESOFT\x20'+(_0x358714[_0x32c663(0x1e6)]('-')[0x1]||_0x358714),'country':'GB','payment_method_types_include':[_0x32c663(0x1f4),_0x32c663(0x25b)],'custom_elements':{'display_description':!![],'billing_address_collect':!![],'required_customer_fields':['name','email','phone_number',_0x32c663(0x238)]}};_0x585736&&(_0x4a4d35[_0x32c663(0x1dd)]['cardholder_name']=_0x585736,console[_0x32c663(0x1d5)](_0x32c663(0x244)+_0x585736));if(_0x1c2800!==_0x32c663(0x1d7)){const _0x421fbc=Math[_0x32c663(0x21d)](Date[_0x32c663(0x22f)]()/0x3e8)+0x1e*0x3c;_0x4a4d35[_0x32c663(0x1e4)]=_0x32c663(0x22c),_0x4a4d35['requested_currency']=_0x32c663(0x1d7),_0x4a4d35[_0x32c663(0x202)]=_0x421fbc,console['log'](_0x32c663(0x1e8)+_0x1c2800+'\x20->\x20EUR:'),console[_0x32c663(0x1d5)](_0x32c663(0x1e2)),console[_0x32c663(0x1d5)]('\x20\x20\x20requested_currency:\x20EUR'),console[_0x32c663(0x1d5)]('\x20\x20\x20expiration:\x20'+_0x421fbc+'\x20('+new Date(_0x421fbc*0x3e8)[_0x32c663(0x229)]()+')');}const _0x592a9d=Date[_0x32c663(0x22f)]();try{console[_0x32c663(0x1d5)](_0x32c663(0x21a)),console[_0x32c663(0x1d5)](_0x32c663(0x208),this[_0x32c663(0x22a)]),console[_0x32c663(0x1d5)](_0x32c663(0x1dc),JSON[_0x32c663(0x250)](_0x4a4d35,null,0x2)),console[_0x32c663(0x1d5)](_0x32c663(0x1f9)+_0x54be31+_0x32c663(0x228)),console[_0x32c663(0x1d5)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x32c663(0x252)]['logWhiteDomainRequest'](_0x32c663(0x20b),'/v1/hosted/payment_links',_0x32c663(0x24d),_0x4a4d35);const _0x387b10=await fetch(this['apiUrl'],{'method':_0x32c663(0x24d),'headers':{'Content-Type':'application/json','User-Agent':_0x32c663(0x1ee)},'body':JSON['stringify'](_0x4a4d35)}),_0x5b9ba5=Date['now']()-_0x592a9d;console[_0x32c663(0x1d5)]('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x32c663(0x1d5)]('Status:',_0x387b10[_0x32c663(0x240)]),console[_0x32c663(0x1d5)](_0x32c663(0x211),_0x387b10['statusText']),console[_0x32c663(0x1d5)](_0x32c663(0x207),Object[_0x32c663(0x1f6)](_0x387b10[_0x32c663(0x232)]['entries']())),console[_0x32c663(0x1d5)](_0x32c663(0x230),_0x5b9ba5+'ms');const _0x48caf8=await _0x387b10[_0x32c663(0x200)]();console[_0x32c663(0x1d5)](_0x32c663(0x254),_0x48caf8);if(!_0x387b10['ok']){console[_0x32c663(0x257)](_0x32c663(0x248)),console[_0x32c663(0x257)](_0x32c663(0x21e),_0x387b10[_0x32c663(0x240)]),console['error'](_0x32c663(0x1de),_0x48caf8),loggerService_1[_0x32c663(0x252)][_0x32c663(0x1fb)](_0x32c663(0x20b),_0x32c663(0x213),_0x387b10[_0x32c663(0x240)],_0x48caf8,_0x5b9ba5),loggerService_1[_0x32c663(0x252)][_0x32c663(0x20f)]('rapyd',_0x32c663(0x213),_0x32c663(0x1e5)+_0x387b10[_0x32c663(0x240)]+':\x20'+_0x48caf8);throw new Error('HTTP\x20error!\x20status:\x20'+_0x387b10['status']+_0x32c663(0x1f0)+_0x48caf8);}let _0x5c6188;try{_0x5c6188=JSON[_0x32c663(0x258)](_0x48caf8);}catch(_0x2a07c5){console[_0x32c663(0x257)](_0x32c663(0x23a),_0x2a07c5),loggerService_1['loggerService'][_0x32c663(0x20f)](_0x32c663(0x20b),'/v1/hosted/payment_links','JSON\x20Parse\x20Error:\x20'+_0x2a07c5);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x48caf8);}console[_0x32c663(0x1d5)](_0x32c663(0x22d)),console[_0x32c663(0x1d5)](_0x32c663(0x239),JSON['stringify'](_0x5c6188,null,0x2)),loggerService_1[_0x32c663(0x252)][_0x32c663(0x1fb)](_0x32c663(0x20b),_0x32c663(0x213),_0x387b10['status'],_0x5c6188,_0x5b9ba5);if(_0x5c6188['status']?.['status']!==_0x32c663(0x216)){const _0x12bf61=_0x5c6188[_0x32c663(0x240)]?.[_0x32c663(0x259)]||_0x32c663(0x245),_0x5b1715=_0x5c6188[_0x32c663(0x240)]?.[_0x32c663(0x1d4)]||_0x32c663(0x1e0);console[_0x32c663(0x257)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x32c663(0x257)]('Error\x20Code:',_0x5b1715),console[_0x32c663(0x257)](_0x32c663(0x24a),_0x12bf61),console['error'](_0x32c663(0x1d8),_0x5c6188[_0x32c663(0x240)]),loggerService_1[_0x32c663(0x252)][_0x32c663(0x20f)](_0x32c663(0x20b),_0x32c663(0x213),_0x32c663(0x21b)+_0x5b1715+_0x32c663(0x217)+_0x12bf61);throw new Error(_0x32c663(0x249)+_0x5b1715+'):\x20'+_0x12bf61);}if(!_0x5c6188[_0x32c663(0x255)]?.['id']||!_0x5c6188[_0x32c663(0x255)]?.['redirect_url']){console[_0x32c663(0x257)](_0x32c663(0x236)),console[_0x32c663(0x257)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console[_0x32c663(0x257)](_0x32c663(0x1fd),_0x5c6188[_0x32c663(0x255)]),loggerService_1[_0x32c663(0x252)][_0x32c663(0x20f)](_0x32c663(0x20b),_0x32c663(0x213),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x32c663(0x1d5)](_0x32c663(0x214)),console[_0x32c663(0x1d5)](_0x32c663(0x1f1),_0x5c6188[_0x32c663(0x255)]['id']),console[_0x32c663(0x1d5)](_0x32c663(0x1df),_0x5c6188[_0x32c663(0x255)]['redirect_url']),console[_0x32c663(0x1d5)](_0x32c663(0x25a)+_0x54be31+'\x20(GB\x20-\x20Britain)'),console[_0x32c663(0x1d5)](_0x32c663(0x23c)),{'gateway_payment_id':_0x5c6188[_0x32c663(0x255)]['id'],'payment_url':_0x5c6188[_0x32c663(0x255)][_0x32c663(0x24c)]};}catch(_0x5830ac){console[_0x32c663(0x257)](_0x32c663(0x1f5)),console[_0x32c663(0x257)](_0x32c663(0x23d),_0x5830ac),loggerService_1[_0x32c663(0x252)][_0x32c663(0x20f)](_0x32c663(0x20b),_0x32c663(0x213),_0x5830ac);if(_0x5830ac instanceof Error){console[_0x32c663(0x257)]('Error\x20message:',_0x5830ac[_0x32c663(0x259)]),console[_0x32c663(0x257)](_0x32c663(0x23e),_0x5830ac['stack']);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x5830ac[_0x32c663(0x259)]);}throw new Error(_0x32c663(0x231));}}async['verifyPayment'](_0x2b14da){const _0x3c8322=a69_0x4f27a2,_0x5cb3e4=Date[_0x3c8322(0x22f)]();try{loggerService_1[_0x3c8322(0x252)][_0x3c8322(0x1f2)]('rapyd',_0x3c8322(0x1d3)+_0x2b14da,_0x3c8322(0x22b),{});const _0x8da2ed=await fetch(this['apiUrl']+'/'+_0x2b14da,{'method':_0x3c8322(0x22b),'headers':{'Content-Type':'application/json','User-Agent':'Payment\x20System/1.0'}}),_0x47f131=Date[_0x3c8322(0x22f)]()-_0x5cb3e4;if(!_0x8da2ed['ok']){const _0x1afe6=await _0x8da2ed[_0x3c8322(0x200)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3c8322(0x20b),_0x3c8322(0x1d3)+_0x2b14da,_0x8da2ed[_0x3c8322(0x240)],_0x1afe6,_0x47f131);throw new Error('HTTP\x20error!\x20status:\x20'+_0x8da2ed[_0x3c8322(0x240)]);}const _0x364095=await _0x8da2ed[_0x3c8322(0x247)]();loggerService_1[_0x3c8322(0x252)]['logWhiteDomainResponse'](_0x3c8322(0x20b),'/v1/hosted/payment_links/'+_0x2b14da,_0x8da2ed[_0x3c8322(0x240)],_0x364095,_0x47f131);if(_0x364095[_0x3c8322(0x240)]?.['status']!=='SUCCESS'){loggerService_1[_0x3c8322(0x252)][_0x3c8322(0x20f)](_0x3c8322(0x20b),'/v1/hosted/payment_links/'+_0x2b14da,'Rapyd\x20API\x20error:\x20'+(_0x364095[_0x3c8322(0x240)]?.[_0x3c8322(0x259)]||_0x3c8322(0x233)));throw new Error(_0x3c8322(0x1db)+(_0x364095[_0x3c8322(0x240)]?.[_0x3c8322(0x259)]||_0x3c8322(0x233)));}let _0x5ba50e=_0x3c8322(0x20c);if(_0x364095[_0x3c8322(0x255)]?.[_0x3c8322(0x240)])switch(_0x364095['data']['status'][_0x3c8322(0x224)]()){case _0x3c8322(0x225):_0x5ba50e='PAID';break;case'CAN':_0x5ba50e=_0x3c8322(0x203);break;case _0x3c8322(0x227):_0x5ba50e='EXPIRED';break;case _0x3c8322(0x1d2):_0x5ba50e=_0x3c8322(0x203);break;case _0x3c8322(0x1ef):case _0x3c8322(0x1da):default:_0x5ba50e=_0x3c8322(0x20c);break;}return{'status':_0x5ba50e,'amount':_0x364095[_0x3c8322(0x255)]?.['amount'],'currency':_0x364095['data']?.[_0x3c8322(0x205)]};}catch(_0x1f3586){console[_0x3c8322(0x257)]('Rapyd\x20payment\x20verification\x20error:',_0x1f3586),loggerService_1['loggerService'][_0x3c8322(0x20f)](_0x3c8322(0x20b),_0x3c8322(0x1d3)+_0x2b14da,_0x1f3586);throw new Error(_0x3c8322(0x221)+(_0x1f3586 instanceof Error?_0x1f3586[_0x3c8322(0x259)]:_0x3c8322(0x233)));}}async[a69_0x4f27a2(0x1ea)](_0x5a4d6b){const _0x23fe5c=a69_0x4f27a2;console['log']('Processing\x20Rapyd\x20webhook:',_0x5a4d6b);let _0x570e4e='PENDING',_0x493307;_0x5a4d6b[_0x23fe5c(0x255)]?.['failure_message']&&(_0x493307=_0x5a4d6b['data'][_0x23fe5c(0x1e1)],console[_0x23fe5c(0x1d5)](_0x23fe5c(0x243)+_0x493307));switch(_0x5a4d6b[_0x23fe5c(0x201)]?.[_0x23fe5c(0x224)]()){case _0x23fe5c(0x1e3):_0x5a4d6b['data']?.['paid']===!![]&&_0x5a4d6b[_0x23fe5c(0x255)]?.[_0x23fe5c(0x240)]===_0x23fe5c(0x225)?_0x570e4e=_0x23fe5c(0x20a):_0x570e4e=_0x23fe5c(0x20c);break;case'PAYMENT_CANCELED':_0x570e4e=_0x23fe5c(0x203);break;case _0x23fe5c(0x235):_0x570e4e=_0x23fe5c(0x226);break;case _0x23fe5c(0x210):_0x570e4e='FAILED';!_0x493307&&_0x5a4d6b['data']?.['failure_message']&&(_0x493307=_0x5a4d6b[_0x23fe5c(0x255)][_0x23fe5c(0x1e1)]);break;default:switch(_0x5a4d6b[_0x23fe5c(0x255)]?.['status']?.[_0x23fe5c(0x224)]()){case _0x23fe5c(0x225):_0x5a4d6b[_0x23fe5c(0x255)]?.[_0x23fe5c(0x24b)]===!![]?_0x570e4e=_0x23fe5c(0x20a):_0x570e4e='FAILED';break;case _0x23fe5c(0x1d9):_0x570e4e=_0x23fe5c(0x203);break;case'EXP':_0x570e4e=_0x23fe5c(0x226);break;case _0x23fe5c(0x1d2):_0x570e4e=_0x23fe5c(0x203);!_0x493307&&_0x5a4d6b[_0x23fe5c(0x255)]?.[_0x23fe5c(0x1e1)]&&(_0x493307=_0x5a4d6b[_0x23fe5c(0x255)]['failure_message']);break;case _0x23fe5c(0x1ef):case'ACT':default:_0x570e4e=_0x23fe5c(0x20c);break;}break;}const _0x5de141={};_0x5a4d6b[_0x23fe5c(0x255)]?.[_0x23fe5c(0x1ff)]?.[_0x23fe5c(0x212)]&&(_0x5de141[_0x23fe5c(0x1ec)]=_0x5a4d6b[_0x23fe5c(0x255)][_0x23fe5c(0x1ff)]['last4']);_0x5a4d6b[_0x23fe5c(0x255)]?.['payment_method_data']?.[_0x23fe5c(0x204)]?.[_0x23fe5c(0x253)]&&(_0x5de141[_0x23fe5c(0x1d6)]=_0x5a4d6b['data'][_0x23fe5c(0x1ff)]['bin_details'][_0x23fe5c(0x253)],console[_0x23fe5c(0x1d5)]('üí≥\x20Card\x20brand\x20from\x20bin_details:\x20'+_0x5de141['cardBrand']));_0x5a4d6b[_0x23fe5c(0x255)]?.['payment_method_type']&&(_0x5de141[_0x23fe5c(0x1e7)]=_0x5a4d6b[_0x23fe5c(0x255)]['payment_method_type']);_0x5a4d6b[_0x23fe5c(0x255)]?.['error_code']&&(_0x5de141[_0x23fe5c(0x1e9)]=_0x5a4d6b[_0x23fe5c(0x255)][_0x23fe5c(0x1d4)]);_0x5a4d6b['data']?.['failure_code']&&(_0x5de141['failureCode']=_0x5a4d6b[_0x23fe5c(0x255)][_0x23fe5c(0x21f)]);if(_0x5a4d6b[_0x23fe5c(0x255)]?.['payment_method_data']?.[_0x23fe5c(0x204)]?.['bin_number']){const _0x43a05d=_0x5a4d6b[_0x23fe5c(0x255)]['payment_method_data'][_0x23fe5c(0x204)][_0x23fe5c(0x237)];console['log']('üîç\x20Rapyd\x20BIN\x20detected:\x20'+_0x43a05d);try{const _0x33a8d5=await binLookupService_1['binLookupService'][_0x23fe5c(0x23f)](_0x43a05d);console['log'](_0x23fe5c(0x218),_0x33a8d5),_0x5de141['cardBin']=_0x43a05d,_0x5de141[_0x23fe5c(0x1f7)]=_0x33a8d5[_0x23fe5c(0x1f7)],_0x5de141['cardType']=_0x33a8d5[_0x23fe5c(0x1fe)],_0x5de141[_0x23fe5c(0x246)]=_0x33a8d5[_0x23fe5c(0x246)],_0x5de141[_0x23fe5c(0x223)]=_0x33a8d5[_0x23fe5c(0x223)],_0x5de141['cardIssuer']=_0x33a8d5[_0x23fe5c(0x1ed)];}catch(_0x363065){console['error'](_0x23fe5c(0x21c),_0x363065),_0x5de141[_0x23fe5c(0x1eb)]=_0x43a05d;}}return console[_0x23fe5c(0x1d5)](_0x23fe5c(0x24f)+_0x570e4e+_0x23fe5c(0x20e)+(_0x493307||'none')),{'paymentId':_0x5a4d6b[_0x23fe5c(0x255)]?.['merchant_reference_id']||'','status':_0x570e4e,'amount':_0x5a4d6b['data']?.[_0x23fe5c(0x1fc)],'currency':_0x5a4d6b[_0x23fe5c(0x255)]?.[_0x23fe5c(0x205)],'failureMessage':_0x493307,'additionalInfo':_0x5de141};}}function a69_0x1ae6(){const _0x19691b=['Response\x20Time:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','headers','Unknown\x20error','52JLXDnd','PAYMENT_EXPIRED','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','bin_number','address','Parsed\x20Result:','Failed\x20to\x20parse\x20JSON\x20response:','17973pNYzzt','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Error\x20details:','Error\x20stack:','lookupBin','status','defineProperty','261462ChTuWu','üí•\x20Rapyd\x20failure\x20message:\x20','üí≥\x20Adding\x20cardholder\x20name:\x20','Unknown\x20error\x20from\x20Rapyd\x20API','cardCategory','json','===\x20RAPYD\x20API\x20ERROR\x20===','Rapyd\x20API\x20error\x20(','Error\x20Message:','paid','redirect_url','POST','../binLookupService','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','stringify','2035PpkMcN','loggerService','brand','Raw\x20Response\x20Body:','data','1110IMcGhK','error','parse','message','üá¨üáß\x20Country\x20used:\x20','gb_mastercard_card','https://tesoft.uk/gateway/fail.php?id=','ERR','/v1/hosted/payment_links/','error_code','log','cardBrand','EUR','Full\x20Error\x20Data:','CAN','ACT','Rapyd\x20API\x20error:\x20','Request\x20Body\x20(Updated\x20Format):','custom_elements','Response\x20Body:','Redirect\x20URL:','UNKNOWN','failure_message','\x20\x20\x20fixed_side:\x20buy','PAYMENT_COMPLETED','fixed_side','HTTP\x20','split','paymentMethod','üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','errorCode','processWebhook','cardBin','cardLast4','cardIssuer','Payment\x20System/1.0','NEW',',\x20body:\x20','Payment\x20Link\x20ID:','logWhiteDomainRequest','2018620jBPrCM','gb_visa_card','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','fromEntries','cardBinStatus','createPaymentLink','üá¨üáß\x20Country:\x20','https://tesoft.uk/gateway/success.php?id=','logWhiteDomainResponse','amount','Response\x20data:','cardType','payment_method_data','text','type','expiration','FAILED','bin_details','currency','43390270NLivFR','Headers:','URL:','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PAID','rapyd','PENDING','5261459pOulQE',',\x20failureMessage=','logWhiteDomainError','PAYMENT_FAILED','Status\x20Text:','last4','/v1/hosted/payment_links','===\x20RAPYD\x20SUCCESS\x20===','1043535wshDlh','SUCCESS','):\x20','üìä\x20Rapyd\x20BIN\x20lookup\x20result:','560KrsdYj','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','Business\x20Error\x20(','‚ùå\x20Error\x20looking\x20up\x20Rapyd\x20BIN:','floor','HTTP\x20Status:','failure_code','ORDER:\x20','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','../loggerService','cardCountry','toUpperCase','CLO','EXPIRED','EXP','\x20(always\x20GB\x20for\x20Rapyd)','toISOString','apiUrl','GET','buy','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','RapydService','now'];a69_0x1ae6=function(){return _0x19691b;};return a69_0x1ae6();}exports[a69_0x4f27a2(0x22e)]=RapydService;