'use strict';const a50_0x194bcf=a50_0x11da;function a50_0x56d0(){const _0x584410=['RapydService','Error\x20details:','https://tesoft.uk/gateway/fail.php?id=','410206EKfMpk','🌐\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','FAILED','Rapyd\x20API\x20error:\x20','\x20\x20\x20fixed_side:\x20buy','type','JSON\x20Parse\x20Error:\x20','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','UNKNOWN','gb_mastercard_card','🇬🇧\x20Country:\x20','POST','cardLast4','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','/v1/hosted/payment_links','NEW','headers','log','currency','Headers:','Status\x20Text:','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','\x20(always\x20GB\x20for\x20Rapyd)','PAID','defineProperty','\x20->\x20EUR:','PENDING','ACT','Response\x20data:','/v1/hosted/payment_links/','floor','):\x20','10IyAUlv','payment_method_type','386040mORuUx','now','GET','TesSoft\x20Payment\x20System/1.0','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','💱\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','🇬🇧\x20Country\x20used:\x20','💳\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','rapyd','Unknown\x20error','logWhiteDomainError','Redirect\x20URL:','Error\x20message:','failure_message','Status:','statusText','gb_visa_card','\x20\x20\x20expiration:\x20','data','https://tesoft.uk/gateway/success.php?id=','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','amount','../loggerService','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Unknown\x20error\x20from\x20Rapyd\x20API','text','error','Rapyd\x20API\x20error\x20(','CAN','ERR','json','Error\x20Code:','buy','paymentMethod','81FMlhst','Payment\x20Link\x20ID:','payment_method_data','last4','status','toUpperCase','parse','CLO','fromEntries','Rapyd\x20payment\x20verification\x20error:','===\x20RAPYD\x20API\x20ERROR\x20===','Request\x20Body\x20(Updated\x20Format):','EUR','💥\x20Rapyd\x20failure\x20message:\x20','279604QglnTg','toISOString','616950jBeoQn','636039xzuckn','9005469FpZgyH','failure_code','application/json','error_code','Error\x20stack:','PAYMENT_FAILED','PAYMENT_COMPLETED','SUCCESS','paid','loggerService','\x20\x20\x20requested_currency:\x20EUR','84OecJML','logWhiteDomainResponse','Processing\x20Rapyd\x20webhook:','HTTP\x20Status:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error',',\x20body:\x20','none','failureCode','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','2014596NRYyjz','🇬🇧\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','EXPIRED','stringify','URL:','Response\x20Body:','HTTP\x20error!\x20status:\x20','verifyPayment','message','2LlQGpQ','apiUrl','logWhiteDomainRequest','ORDER:\x20','stack','Missing\x20id\x20or\x20redirect_url\x20in\x20response','redirect_url'];a50_0x56d0=function(){return _0x584410;};return a50_0x56d0();}(function(_0x4b8f31,_0x1b62a1){const _0x2843bf=a50_0x11da,_0x1ecf32=_0x4b8f31();while(!![]){try{const _0x11273b=parseInt(_0x2843bf(0x153))/0x1*(parseInt(_0x2843bf(0x15d))/0x2)+parseInt(_0x2843bf(0x1b2))/0x3+-parseInt(_0x2843bf(0x1af))/0x4+-parseInt(_0x2843bf(0x17d))/0x5*(-parseInt(_0x2843bf(0x1c8))/0x6)+-parseInt(_0x2843bf(0x1be))/0x7*(parseInt(_0x2843bf(0x17f))/0x8)+parseInt(_0x2843bf(0x1a1))/0x9*(parseInt(_0x2843bf(0x1b1))/0xa)+-parseInt(_0x2843bf(0x1b3))/0xb;if(_0x11273b===_0x1b62a1)break;else _0x1ecf32['push'](_0x1ecf32['shift']());}catch(_0x4c572c){_0x1ecf32['push'](_0x1ecf32['shift']());}}}(a50_0x56d0,0x5d1b6));Object[a50_0x194bcf(0x175)](exports,'__esModule',{'value':!![]}),exports[a50_0x194bcf(0x15a)]=void 0x0;const loggerService_1=require(a50_0x194bcf(0x195));function a50_0x11da(_0x5bac0e,_0xafb873){const _0x56d009=a50_0x56d0();return a50_0x11da=function(_0x11da9f,_0x18efc4){_0x11da9f=_0x11da9f-0x14f;let _0x58481f=_0x56d009[_0x11da9f];return _0x58481f;},a50_0x11da(_0x5bac0e,_0xafb873);}class RapydService{constructor(){const _0x633fba=a50_0x194bcf;this['apiUrl']='https://tesoft.uk/gateway/rapyd/',console[_0x633fba(0x16e)](_0x633fba(0x15e));}async['createPaymentLink'](_0x370988){const _0x4f919c=a50_0x194bcf,{orderId:_0x2b3d36,orderName:_0x1124d4,amount:_0x540977,currency:_0x4f61a5,usage:_0x4a16ad,maxPayments:_0x38e9ff,successUrl:_0x78234f,failUrl:_0x2d0dd2}=_0x370988,_0x169510=_0x4f61a5['toUpperCase'](),_0x3030fd='GB';console['log'](_0x4f919c(0x1c9));const _0x41dfca=_0x4f919c(0x192)+_0x2b3d36,_0xf76b18=_0x4f919c(0x15c)+_0x2b3d36,_0xe0508={'amount':_0x540977,'currency':_0x169510,'cancel_checkout_url':_0xf76b18,'complete_checkout_url':_0x41dfca,'complete_payment_url':_0x41dfca,'merchant_reference_id':_0x2b3d36,'description':_0x4f919c(0x156)+_0x2b3d36,'country':'GB','payment_method_types_include':[_0x4f919c(0x18f),_0x4f919c(0x166)],'custom_elements':{'display_description':!![]}};if(_0x169510!=='EUR'){const _0x3809c9=Math[_0x4f919c(0x17b)](Date[_0x4f919c(0x180)]()/0x3e8)+0x1e*0x3c;_0xe0508['fixed_side']=_0x4f919c(0x19f),_0xe0508['requested_currency']=_0x4f919c(0x1ad),_0xe0508['expiration']=_0x3809c9,console[_0x4f919c(0x16e)](_0x4f919c(0x184)+_0x169510+_0x4f919c(0x176)),console[_0x4f919c(0x16e)](_0x4f919c(0x161)),console[_0x4f919c(0x16e)](_0x4f919c(0x1bd)),console[_0x4f919c(0x16e)](_0x4f919c(0x190)+_0x3809c9+'\x20('+new Date(_0x3809c9*0x3e8)[_0x4f919c(0x1b0)]()+')');}const _0xccbfef=Date[_0x4f919c(0x180)]();try{console[_0x4f919c(0x16e)](_0x4f919c(0x193)),console[_0x4f919c(0x16e)](_0x4f919c(0x1cc),this[_0x4f919c(0x154)]),console['log'](_0x4f919c(0x1ac),JSON[_0x4f919c(0x1cb)](_0xe0508,null,0x2)),console[_0x4f919c(0x16e)](_0x4f919c(0x167)+_0x3030fd+_0x4f919c(0x173)),console['log'](_0x4f919c(0x186)),loggerService_1[_0x4f919c(0x1bc)]['logWhiteDomainRequest'](_0x4f919c(0x187),_0x4f919c(0x16b),'POST',_0xe0508);const _0x34e91d=await fetch(this[_0x4f919c(0x154)],{'method':_0x4f919c(0x168),'headers':{'Content-Type':_0x4f919c(0x1b5),'User-Agent':_0x4f919c(0x182)},'body':JSON[_0x4f919c(0x1cb)](_0xe0508)}),_0x57d89e=Date[_0x4f919c(0x180)]()-_0xccbfef;console[_0x4f919c(0x16e)](_0x4f919c(0x172)),console[_0x4f919c(0x16e)](_0x4f919c(0x18d),_0x34e91d[_0x4f919c(0x1a5)]),console['log'](_0x4f919c(0x171),_0x34e91d[_0x4f919c(0x18e)]),console[_0x4f919c(0x16e)](_0x4f919c(0x170),Object[_0x4f919c(0x1a9)](_0x34e91d[_0x4f919c(0x16d)]['entries']())),console['log']('Response\x20Time:',_0x57d89e+'ms');const _0x4840db=await _0x34e91d[_0x4f919c(0x198)]();console[_0x4f919c(0x16e)]('Raw\x20Response\x20Body:',_0x4840db);if(!_0x34e91d['ok']){console[_0x4f919c(0x199)](_0x4f919c(0x1ab)),console['error'](_0x4f919c(0x1c1),_0x34e91d[_0x4f919c(0x1a5)]),console['error'](_0x4f919c(0x14f),_0x4840db),loggerService_1[_0x4f919c(0x1bc)]['logWhiteDomainResponse'](_0x4f919c(0x187),_0x4f919c(0x16b),_0x34e91d[_0x4f919c(0x1a5)],_0x4840db,_0x57d89e),loggerService_1[_0x4f919c(0x1bc)][_0x4f919c(0x189)](_0x4f919c(0x187),_0x4f919c(0x16b),'HTTP\x20'+_0x34e91d[_0x4f919c(0x1a5)]+':\x20'+_0x4840db);throw new Error('HTTP\x20error!\x20status:\x20'+_0x34e91d[_0x4f919c(0x1a5)]+_0x4f919c(0x1c3)+_0x4840db);}let _0x272801;try{_0x272801=JSON[_0x4f919c(0x1a7)](_0x4840db);}catch(_0x1bb20c){console[_0x4f919c(0x199)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x1bb20c),loggerService_1[_0x4f919c(0x1bc)]['logWhiteDomainError'](_0x4f919c(0x187),'/v1/hosted/payment_links',_0x4f919c(0x163)+_0x1bb20c);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x4840db);}console[_0x4f919c(0x16e)](_0x4f919c(0x16a)),console['log']('Parsed\x20Result:',JSON[_0x4f919c(0x1cb)](_0x272801,null,0x2)),loggerService_1['loggerService'][_0x4f919c(0x1bf)](_0x4f919c(0x187),_0x4f919c(0x16b),_0x34e91d['status'],_0x272801,_0x57d89e);if(_0x272801['status']?.[_0x4f919c(0x1a5)]!==_0x4f919c(0x1ba)){const _0x51945b=_0x272801[_0x4f919c(0x1a5)]?.[_0x4f919c(0x152)]||_0x4f919c(0x197),_0x43aa2d=_0x272801['status']?.[_0x4f919c(0x1b6)]||_0x4f919c(0x165);console['error']('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x4f919c(0x19e),_0x43aa2d),console[_0x4f919c(0x199)]('Error\x20Message:',_0x51945b),console['error']('Full\x20Error\x20Data:',_0x272801[_0x4f919c(0x1a5)]),loggerService_1[_0x4f919c(0x1bc)][_0x4f919c(0x189)](_0x4f919c(0x187),_0x4f919c(0x16b),'Business\x20Error\x20('+_0x43aa2d+_0x4f919c(0x17c)+_0x51945b);throw new Error(_0x4f919c(0x19a)+_0x43aa2d+_0x4f919c(0x17c)+_0x51945b);}if(!_0x272801[_0x4f919c(0x191)]?.['id']||!_0x272801['data']?.[_0x4f919c(0x159)]){console[_0x4f919c(0x199)](_0x4f919c(0x183)),console[_0x4f919c(0x199)](_0x4f919c(0x158)),console[_0x4f919c(0x199)](_0x4f919c(0x179),_0x272801['data']),loggerService_1[_0x4f919c(0x1bc)][_0x4f919c(0x189)]('rapyd',_0x4f919c(0x16b),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x4f919c(0x196));}return console[_0x4f919c(0x16e)]('===\x20RAPYD\x20SUCCESS\x20==='),console[_0x4f919c(0x16e)](_0x4f919c(0x1a2),_0x272801[_0x4f919c(0x191)]['id']),console[_0x4f919c(0x16e)](_0x4f919c(0x18a),_0x272801[_0x4f919c(0x191)]['redirect_url']),console[_0x4f919c(0x16e)](_0x4f919c(0x185)+_0x3030fd+'\x20(GB\x20-\x20Britain)'),console[_0x4f919c(0x16e)](_0x4f919c(0x186)),{'gateway_payment_id':_0x272801['data']['id'],'payment_url':_0x272801[_0x4f919c(0x191)][_0x4f919c(0x159)]};}catch(_0x4c906c){console['error'](_0x4f919c(0x164)),console[_0x4f919c(0x199)](_0x4f919c(0x15b),_0x4c906c),loggerService_1['loggerService'][_0x4f919c(0x189)]('rapyd',_0x4f919c(0x16b),_0x4c906c);if(_0x4c906c instanceof Error){console[_0x4f919c(0x199)](_0x4f919c(0x18b),_0x4c906c['message']),console[_0x4f919c(0x199)](_0x4f919c(0x1b7),_0x4c906c[_0x4f919c(0x157)]);throw new Error(_0x4f919c(0x1c7)+_0x4c906c[_0x4f919c(0x152)]);}throw new Error(_0x4f919c(0x1c2));}}async[a50_0x194bcf(0x151)](_0x307082){const _0x257f16=a50_0x194bcf,_0x563e17=Date['now']();try{loggerService_1['loggerService'][_0x257f16(0x155)](_0x257f16(0x187),_0x257f16(0x17a)+_0x307082,_0x257f16(0x181),{});const _0x1e896b=await fetch(this['apiUrl']+'/'+_0x307082,{'method':_0x257f16(0x181),'headers':{'Content-Type':_0x257f16(0x1b5),'User-Agent':_0x257f16(0x182)}}),_0x236fcf=Date[_0x257f16(0x180)]()-_0x563e17;if(!_0x1e896b['ok']){const _0x36a4f8=await _0x1e896b[_0x257f16(0x198)]();loggerService_1[_0x257f16(0x1bc)][_0x257f16(0x1bf)](_0x257f16(0x187),_0x257f16(0x17a)+_0x307082,_0x1e896b[_0x257f16(0x1a5)],_0x36a4f8,_0x236fcf);throw new Error(_0x257f16(0x150)+_0x1e896b[_0x257f16(0x1a5)]);}const _0x114195=await _0x1e896b[_0x257f16(0x19d)]();loggerService_1[_0x257f16(0x1bc)][_0x257f16(0x1bf)](_0x257f16(0x187),_0x257f16(0x17a)+_0x307082,_0x1e896b['status'],_0x114195,_0x236fcf);if(_0x114195[_0x257f16(0x1a5)]?.[_0x257f16(0x1a5)]!=='SUCCESS'){loggerService_1['loggerService'][_0x257f16(0x189)](_0x257f16(0x187),'/v1/hosted/payment_links/'+_0x307082,_0x257f16(0x160)+(_0x114195['status']?.['message']||_0x257f16(0x188)));throw new Error(_0x257f16(0x160)+(_0x114195[_0x257f16(0x1a5)]?.[_0x257f16(0x152)]||'Unknown\x20error'));}let _0x1859c6='PENDING';if(_0x114195[_0x257f16(0x191)]?.[_0x257f16(0x1a5)])switch(_0x114195[_0x257f16(0x191)][_0x257f16(0x1a5)][_0x257f16(0x1a6)]()){case'CLO':_0x1859c6=_0x257f16(0x174);break;case'CAN':_0x1859c6=_0x257f16(0x15f);break;case'EXP':_0x1859c6=_0x257f16(0x1ca);break;case _0x257f16(0x19c):_0x1859c6=_0x257f16(0x15f);break;case'NEW':case'ACT':default:_0x1859c6=_0x257f16(0x177);break;}return{'status':_0x1859c6,'amount':_0x114195[_0x257f16(0x191)]?.[_0x257f16(0x194)],'currency':_0x114195['data']?.[_0x257f16(0x16f)]};}catch(_0xb43fc2){console['error'](_0x257f16(0x1aa),_0xb43fc2),loggerService_1[_0x257f16(0x1bc)][_0x257f16(0x189)]('rapyd',_0x257f16(0x17a)+_0x307082,_0xb43fc2);throw new Error(_0x257f16(0x1c6)+(_0xb43fc2 instanceof Error?_0xb43fc2[_0x257f16(0x152)]:_0x257f16(0x188)));}}async['processWebhook'](_0xd1e4fc){const _0x536cf5=a50_0x194bcf;console[_0x536cf5(0x16e)](_0x536cf5(0x1c0),_0xd1e4fc);let _0x1725e8=_0x536cf5(0x177),_0x53d0b1;_0xd1e4fc[_0x536cf5(0x191)]?.[_0x536cf5(0x18c)]&&(_0x53d0b1=_0xd1e4fc['data'][_0x536cf5(0x18c)],console[_0x536cf5(0x16e)](_0x536cf5(0x1ae)+_0x53d0b1));switch(_0xd1e4fc[_0x536cf5(0x162)]?.[_0x536cf5(0x1a6)]()){case _0x536cf5(0x1b9):_0xd1e4fc[_0x536cf5(0x191)]?.['paid']===!![]&&_0xd1e4fc[_0x536cf5(0x191)]?.[_0x536cf5(0x1a5)]===_0x536cf5(0x1a8)?_0x1725e8=_0x536cf5(0x174):_0x1725e8='PENDING';break;case'PAYMENT_CANCELED':_0x1725e8=_0x536cf5(0x15f);break;case'PAYMENT_EXPIRED':_0x1725e8=_0x536cf5(0x1ca);break;case _0x536cf5(0x1b8):_0x1725e8=_0x536cf5(0x15f);!_0x53d0b1&&_0xd1e4fc['data']?.[_0x536cf5(0x18c)]&&(_0x53d0b1=_0xd1e4fc[_0x536cf5(0x191)][_0x536cf5(0x18c)]);break;default:switch(_0xd1e4fc[_0x536cf5(0x191)]?.[_0x536cf5(0x1a5)]?.[_0x536cf5(0x1a6)]()){case _0x536cf5(0x1a8):_0xd1e4fc[_0x536cf5(0x191)]?.[_0x536cf5(0x1bb)]===!![]?_0x1725e8=_0x536cf5(0x174):_0x1725e8=_0x536cf5(0x15f);break;case _0x536cf5(0x19b):_0x1725e8='FAILED';break;case'EXP':_0x1725e8=_0x536cf5(0x1ca);break;case'ERR':_0x1725e8=_0x536cf5(0x15f);!_0x53d0b1&&_0xd1e4fc[_0x536cf5(0x191)]?.[_0x536cf5(0x18c)]&&(_0x53d0b1=_0xd1e4fc[_0x536cf5(0x191)][_0x536cf5(0x18c)]);break;case _0x536cf5(0x16c):case _0x536cf5(0x178):default:_0x1725e8=_0x536cf5(0x177);break;}break;}const _0xb8d095={};return _0xd1e4fc[_0x536cf5(0x191)]?.['payment_method_data']?.[_0x536cf5(0x1a4)]&&(_0xb8d095[_0x536cf5(0x169)]=_0xd1e4fc[_0x536cf5(0x191)][_0x536cf5(0x1a3)]['last4']),_0xd1e4fc[_0x536cf5(0x191)]?.['payment_method_type']&&(_0xb8d095[_0x536cf5(0x1a0)]=_0xd1e4fc[_0x536cf5(0x191)][_0x536cf5(0x17e)]),_0xd1e4fc[_0x536cf5(0x191)]?.[_0x536cf5(0x1b6)]&&(_0xb8d095['errorCode']=_0xd1e4fc['data'][_0x536cf5(0x1b6)]),_0xd1e4fc[_0x536cf5(0x191)]?.[_0x536cf5(0x1b4)]&&(_0xb8d095[_0x536cf5(0x1c5)]=_0xd1e4fc[_0x536cf5(0x191)][_0x536cf5(0x1b4)]),console[_0x536cf5(0x16e)]('🔄\x20Rapyd\x20webhook\x20processed:\x20status='+_0x1725e8+',\x20failureMessage='+(_0x53d0b1||_0x536cf5(0x1c4))),{'paymentId':_0xd1e4fc['data']?.['merchant_reference_id']||'','status':_0x1725e8,'amount':_0xd1e4fc[_0x536cf5(0x191)]?.['amount'],'currency':_0xd1e4fc[_0x536cf5(0x191)]?.[_0x536cf5(0x16f)],'failureMessage':_0x53d0b1,'additionalInfo':_0xb8d095};}}exports['RapydService']=RapydService;