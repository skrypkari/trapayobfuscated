'use strict';function a42_0x4b66(){const _0x26761b=['PAYMENT_COMPLETED','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','Status\x20Text:','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','URL:','PAYMENT_CANCELED','5841FlJXOD','156671xKoTFs','ACT','1478490SRuyCg','HTTP\x20','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','Response\x20data:','TesSoft\x20Payment\x20System/1.0','94076ezfURA','18mZfNCm','createPaymentLink','Headers:','stringify','/v1/hosted/payment_links/','now','redirect_url','CAN','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','Response\x20Body:','Rapyd\x20payment\x20verification\x20error:','Error\x20details:','7430EIqRgh','type','merchant_reference_id','Redirect\x20URL:','Unknown\x20error\x20from\x20Rapyd\x20API','parse','Response\x20Time:','paid','Error\x20stack:','error_code','EXP','/v1/hosted/payment_links','Unknown\x20error','810005RgEuPw','defineProperty','PAYMENT_FAILED','RapydService','logWhiteDomainError','Raw\x20Response\x20Body:','message','amount','json','üá¨üáß\x20Country:\x20','data','toUpperCase','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','logWhiteDomainResponse','currency','https://tesoft.uk/gateway/success.php?id=','):\x20','status','Request\x20Body\x20(Updated\x20Format):','EXPIRED','Business\x20Error\x20(','UNKNOWN','HTTP\x20Status:','gb_mastercard_card','CLO','ERR','Status:','===\x20RAPYD\x20API\x20ERROR\x20===','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','apiUrl','FAILED','PAID','===\x20RAPYD\x20SUCCESS\x20===','Rapyd\x20API\x20error:\x20','Error\x20Code:','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','NEW','rapyd','Error\x20Message:',',\x20body:\x20','fromEntries','SUCCESS','Missing\x20id\x20or\x20redirect_url\x20in\x20response','error','ORDER:\x20','entries','POST','15YKkqqs','application/json','GET','PENDING','https://tesoft.uk/gateway/rapyd/','loggerService','Rapyd\x20API\x20error\x20(','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','35652OWwOys','HTTP\x20error!\x20status:\x20','2glAJJn','861696kraQqg','log','headers'];a42_0x4b66=function(){return _0x26761b;};return a42_0x4b66();}const a42_0x150ae8=a42_0x4a1d;(function(_0x36b77f,_0x577eed){const _0x291de2=a42_0x4a1d,_0x366391=_0x36b77f();while(!![]){try{const _0x2c8267=parseInt(_0x291de2(0x208))/0x1*(parseInt(_0x291de2(0x1fd))/0x2)+parseInt(_0x291de2(0x1fb))/0x3+parseInt(_0x291de2(0x20f))/0x4*(parseInt(_0x291de2(0x1f2))/0x5)+parseInt(_0x291de2(0x20a))/0x6+-parseInt(_0x291de2(0x229))/0x7+parseInt(_0x291de2(0x1fe))/0x8*(parseInt(_0x291de2(0x210))/0x9)+parseInt(_0x291de2(0x21c))/0xa*(-parseInt(_0x291de2(0x207))/0xb);if(_0x2c8267===_0x577eed)break;else _0x366391['push'](_0x366391['shift']());}catch(_0x3616b5){_0x366391['push'](_0x366391['shift']());}}}(a42_0x4b66,0x2e8ef));Object[a42_0x150ae8(0x22a)](exports,'__esModule',{'value':!![]}),exports[a42_0x150ae8(0x22c)]=void 0x0;const loggerService_1=require('../loggerService');function a42_0x4a1d(_0x4f4bb2,_0x384c24){const _0x4b6617=a42_0x4b66();return a42_0x4a1d=function(_0x4a1d4a,_0x381243){_0x4a1d4a=_0x4a1d4a-0x1d7;let _0xa30224=_0x4b6617[_0x4a1d4a];return _0xa30224;},a42_0x4a1d(_0x4f4bb2,_0x384c24);}class RapydService{constructor(){const _0x496524=a42_0x150ae8;this['apiUrl']=_0x496524(0x1f6),console[_0x496524(0x1ff)](_0x496524(0x204));}async[a42_0x150ae8(0x211)](_0x5ae43d){const _0x301ea3=a42_0x150ae8,{orderId:_0x2c343e,orderName:_0x1eaa54,amount:_0x246eb2,currency:_0x2bcbdf,usage:_0x258e99,maxPayments:_0x2a4a80,successUrl:_0xe69c9e,failUrl:_0x28aba5}=_0x5ae43d,_0x4151d3=_0x2bcbdf[_0x301ea3(0x234)](),_0x42c8b5='GB';console['log'](_0x301ea3(0x1fa));const _0x5b1a52=_0x301ea3(0x238)+_0x2c343e,_0x2f1b74='https://tesoft.uk/gateway/fail.php?id='+_0x2c343e,_0x44f612={'amount':_0x246eb2,'currency':_0x4151d3,'cancel_checkout_url':_0x2f1b74,'complete_checkout_url':_0x5b1a52,'complete_payment_url':_0x5b1a52,'merchant_reference_id':_0x2c343e,'description':_0x301ea3(0x1ef)+_0x2c343e,'country':'GB','payment_method_types_include':['gb_visa_card',_0x301ea3(0x1da)],'custom_elements':{'display_description':!![]}},_0x596d51=Date[_0x301ea3(0x215)]();try{console[_0x301ea3(0x1ff)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console['log'](_0x301ea3(0x205),this['apiUrl']),console['log'](_0x301ea3(0x23b),JSON['stringify'](_0x44f612,null,0x2)),console[_0x301ea3(0x1ff)](_0x301ea3(0x232)+_0x42c8b5+'\x20(always\x20GB\x20for\x20Rapyd)'),console[_0x301ea3(0x1ff)](_0x301ea3(0x235)),loggerService_1[_0x301ea3(0x1f7)]['logWhiteDomainRequest']('rapyd',_0x301ea3(0x227),_0x301ea3(0x1f1),_0x44f612);const _0x6903e9=await fetch(this[_0x301ea3(0x1e0)],{'method':_0x301ea3(0x1f1),'headers':{'Content-Type':_0x301ea3(0x1f3),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x301ea3(0x213)](_0x44f612)}),_0x29acfc=Date[_0x301ea3(0x215)]()-_0x596d51;console['log']('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x301ea3(0x1ff)](_0x301ea3(0x1dd),_0x6903e9[_0x301ea3(0x23a)]),console[_0x301ea3(0x1ff)](_0x301ea3(0x203),_0x6903e9['statusText']),console[_0x301ea3(0x1ff)](_0x301ea3(0x212),Object[_0x301ea3(0x1eb)](_0x6903e9[_0x301ea3(0x200)][_0x301ea3(0x1f0)]())),console[_0x301ea3(0x1ff)](_0x301ea3(0x222),_0x29acfc+'ms');const _0x58b437=await _0x6903e9['text']();console[_0x301ea3(0x1ff)](_0x301ea3(0x22e),_0x58b437);if(!_0x6903e9['ok']){console[_0x301ea3(0x1ee)](_0x301ea3(0x1de)),console[_0x301ea3(0x1ee)](_0x301ea3(0x1d9),_0x6903e9[_0x301ea3(0x23a)]),console[_0x301ea3(0x1ee)](_0x301ea3(0x219),_0x58b437),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x301ea3(0x1e8),_0x301ea3(0x227),_0x6903e9[_0x301ea3(0x23a)],_0x58b437,_0x29acfc),loggerService_1[_0x301ea3(0x1f7)][_0x301ea3(0x22d)](_0x301ea3(0x1e8),_0x301ea3(0x227),_0x301ea3(0x20b)+_0x6903e9[_0x301ea3(0x23a)]+':\x20'+_0x58b437);throw new Error(_0x301ea3(0x1fc)+_0x6903e9[_0x301ea3(0x23a)]+_0x301ea3(0x1ea)+_0x58b437);}let _0x206d5b;try{_0x206d5b=JSON[_0x301ea3(0x221)](_0x58b437);}catch(_0x3c1fcc){console[_0x301ea3(0x1ee)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x3c1fcc),loggerService_1[_0x301ea3(0x1f7)]['logWhiteDomainError'](_0x301ea3(0x1e8),_0x301ea3(0x227),'JSON\x20Parse\x20Error:\x20'+_0x3c1fcc);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x58b437);}console[_0x301ea3(0x1ff)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x301ea3(0x1ff)]('Parsed\x20Result:',JSON[_0x301ea3(0x213)](_0x206d5b,null,0x2)),loggerService_1['loggerService'][_0x301ea3(0x236)]('rapyd','/v1/hosted/payment_links',_0x6903e9[_0x301ea3(0x23a)],_0x206d5b,_0x29acfc);if(_0x206d5b[_0x301ea3(0x23a)]?.['status']!=='SUCCESS'){const _0x2a4326=_0x206d5b[_0x301ea3(0x23a)]?.['message']||_0x301ea3(0x220),_0x1ea29c=_0x206d5b[_0x301ea3(0x23a)]?.[_0x301ea3(0x225)]||_0x301ea3(0x1d8);console[_0x301ea3(0x1ee)](_0x301ea3(0x20c)),console['error'](_0x301ea3(0x1e5),_0x1ea29c),console[_0x301ea3(0x1ee)](_0x301ea3(0x1e9),_0x2a4326),console[_0x301ea3(0x1ee)]('Full\x20Error\x20Data:',_0x206d5b[_0x301ea3(0x23a)]),loggerService_1['loggerService'][_0x301ea3(0x22d)](_0x301ea3(0x1e8),_0x301ea3(0x227),_0x301ea3(0x1d7)+_0x1ea29c+'):\x20'+_0x2a4326);throw new Error(_0x301ea3(0x1f8)+_0x1ea29c+_0x301ea3(0x239)+_0x2a4326);}if(!_0x206d5b[_0x301ea3(0x233)]?.['id']||!_0x206d5b[_0x301ea3(0x233)]?.['redirect_url']){console[_0x301ea3(0x1ee)](_0x301ea3(0x1f9)),console[_0x301ea3(0x1ee)](_0x301ea3(0x1ed)),console[_0x301ea3(0x1ee)](_0x301ea3(0x20d),_0x206d5b['data']),loggerService_1['loggerService'][_0x301ea3(0x22d)](_0x301ea3(0x1e8),_0x301ea3(0x227),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x301ea3(0x1ff)](_0x301ea3(0x1e3)),console[_0x301ea3(0x1ff)]('Payment\x20Link\x20ID:',_0x206d5b[_0x301ea3(0x233)]['id']),console[_0x301ea3(0x1ff)](_0x301ea3(0x21f),_0x206d5b[_0x301ea3(0x233)][_0x301ea3(0x216)]),console[_0x301ea3(0x1ff)]('üá¨üáß\x20Country\x20used:\x20'+_0x42c8b5+'\x20(GB\x20-\x20Britain)'),console[_0x301ea3(0x1ff)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x206d5b['data']['id'],'payment_url':_0x206d5b[_0x301ea3(0x233)][_0x301ea3(0x216)]};}catch(_0x2b9f52){console['error'](_0x301ea3(0x1df)),console[_0x301ea3(0x1ee)](_0x301ea3(0x21b),_0x2b9f52),loggerService_1[_0x301ea3(0x1f7)][_0x301ea3(0x22d)](_0x301ea3(0x1e8),_0x301ea3(0x227),_0x2b9f52);if(_0x2b9f52 instanceof Error){console['error']('Error\x20message:',_0x2b9f52[_0x301ea3(0x22f)]),console[_0x301ea3(0x1ee)](_0x301ea3(0x224),_0x2b9f52['stack']);throw new Error(_0x301ea3(0x218)+_0x2b9f52[_0x301ea3(0x22f)]);}throw new Error(_0x301ea3(0x202));}}async['verifyPayment'](_0x14e32b){const _0x163fdc=a42_0x150ae8,_0x33b025=Date['now']();try{loggerService_1[_0x163fdc(0x1f7)]['logWhiteDomainRequest'](_0x163fdc(0x1e8),_0x163fdc(0x214)+_0x14e32b,_0x163fdc(0x1f4),{});const _0x4fb01d=await fetch(this['apiUrl']+'/'+_0x14e32b,{'method':_0x163fdc(0x1f4),'headers':{'Content-Type':_0x163fdc(0x1f3),'User-Agent':_0x163fdc(0x20e)}}),_0x6e5a12=Date[_0x163fdc(0x215)]()-_0x33b025;if(!_0x4fb01d['ok']){const _0x509541=await _0x4fb01d['text']();loggerService_1['loggerService'][_0x163fdc(0x236)](_0x163fdc(0x1e8),_0x163fdc(0x214)+_0x14e32b,_0x4fb01d[_0x163fdc(0x23a)],_0x509541,_0x6e5a12);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4fb01d[_0x163fdc(0x23a)]);}const _0x50d864=await _0x4fb01d[_0x163fdc(0x231)]();loggerService_1[_0x163fdc(0x1f7)][_0x163fdc(0x236)]('rapyd',_0x163fdc(0x214)+_0x14e32b,_0x4fb01d[_0x163fdc(0x23a)],_0x50d864,_0x6e5a12);if(_0x50d864[_0x163fdc(0x23a)]?.[_0x163fdc(0x23a)]!==_0x163fdc(0x1ec)){loggerService_1[_0x163fdc(0x1f7)]['logWhiteDomainError'](_0x163fdc(0x1e8),_0x163fdc(0x214)+_0x14e32b,_0x163fdc(0x1e4)+(_0x50d864[_0x163fdc(0x23a)]?.['message']||_0x163fdc(0x228)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x50d864[_0x163fdc(0x23a)]?.[_0x163fdc(0x22f)]||_0x163fdc(0x228)));}let _0x40eee8='PENDING';if(_0x50d864[_0x163fdc(0x233)]?.['status'])switch(_0x50d864['data'][_0x163fdc(0x23a)][_0x163fdc(0x234)]()){case _0x163fdc(0x1db):_0x40eee8=_0x163fdc(0x1e2);break;case _0x163fdc(0x217):_0x40eee8=_0x163fdc(0x1e1);break;case _0x163fdc(0x226):_0x40eee8='EXPIRED';break;case _0x163fdc(0x1dc):_0x40eee8=_0x163fdc(0x1e1);break;case _0x163fdc(0x1e7):case'ACT':default:_0x40eee8=_0x163fdc(0x1f5);break;}return{'status':_0x40eee8,'amount':_0x50d864[_0x163fdc(0x233)]?.[_0x163fdc(0x230)],'currency':_0x50d864[_0x163fdc(0x233)]?.[_0x163fdc(0x237)]};}catch(_0x5cda04){console[_0x163fdc(0x1ee)](_0x163fdc(0x21a),_0x5cda04),loggerService_1[_0x163fdc(0x1f7)][_0x163fdc(0x22d)]('rapyd',_0x163fdc(0x214)+_0x14e32b,_0x5cda04);throw new Error(_0x163fdc(0x1e6)+(_0x5cda04 instanceof Error?_0x5cda04[_0x163fdc(0x22f)]:'Unknown\x20error'));}}async['processWebhook'](_0x4e1727){const _0x514832=a42_0x150ae8;console[_0x514832(0x1ff)]('Processing\x20Rapyd\x20webhook:',_0x4e1727);let _0x44bab6=_0x514832(0x1f5);switch(_0x4e1727[_0x514832(0x21d)]?.[_0x514832(0x234)]()){case _0x514832(0x201):_0x4e1727[_0x514832(0x233)]?.[_0x514832(0x223)]===!![]&&_0x4e1727[_0x514832(0x233)]?.[_0x514832(0x23a)]===_0x514832(0x1db)?_0x44bab6=_0x514832(0x1e2):_0x44bab6=_0x514832(0x1f5);break;case _0x514832(0x206):_0x44bab6=_0x514832(0x1e1);break;case'PAYMENT_EXPIRED':_0x44bab6='EXPIRED';break;case _0x514832(0x22b):_0x44bab6=_0x514832(0x1e1);break;default:switch(_0x4e1727['data']?.['status']?.[_0x514832(0x234)]()){case _0x514832(0x1db):_0x4e1727[_0x514832(0x233)]?.[_0x514832(0x223)]===!![]?_0x44bab6=_0x514832(0x1e2):_0x44bab6=_0x514832(0x1e1);break;case _0x514832(0x217):_0x44bab6='FAILED';break;case _0x514832(0x226):_0x44bab6=_0x514832(0x23c);break;case _0x514832(0x1dc):_0x44bab6='FAILED';break;case _0x514832(0x1e7):case _0x514832(0x209):default:_0x44bab6=_0x514832(0x1f5);break;}break;}return{'paymentId':_0x4e1727[_0x514832(0x233)]?.[_0x514832(0x21e)]||'','status':_0x44bab6,'amount':_0x4e1727[_0x514832(0x233)]?.['amount'],'currency':_0x4e1727[_0x514832(0x233)]?.[_0x514832(0x237)]};}}exports[a42_0x150ae8(0x22c)]=RapydService;