'use strict';const a42_0x311eb9=a42_0x54d4;function a42_0x54d4(_0x1f14fb,_0xac18ac){const _0x1d3b9d=a42_0x1d3b();return a42_0x54d4=function(_0x54d47c,_0x598f71){_0x54d47c=_0x54d47c-0x132;let _0x166c52=_0x1d3b9d[_0x54d47c];return _0x166c52;},a42_0x54d4(_0x1f14fb,_0xac18ac);}function a42_0x1d3b(){const _0x166a56=['Headers:','===\x20RAPYD\x20SUCCESS\x20===','Rapyd\x20API\x20error:\x20','NEW','application/json','Error\x20details:','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Full\x20Error\x20Data:','3148DrhPhx','stringify','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','2094HdWKwp','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','HTTP\x20error!\x20status:\x20','/v1/hosted/payment_links/','https://tesoft.uk/gateway/fail.php?id=','10277280oXKXNT','üá¨üáß\x20Country:\x20','status','Business\x20Error\x20(','Status:','ERR','CAN','gb_visa_card','Failed\x20to\x20parse\x20JSON\x20response:','statusText','fromEntries','GET','entries','CLO','190945jpLTGt','PENDING','14776830goayFo','4iNzPJM','logWhiteDomainRequest',',\x20body:\x20','/v1/hosted/payment_links','paid','text','HTTP\x20Status:','POST','defineProperty','amount','\x20(always\x20GB\x20for\x20Rapyd)','processWebhook','verifyPayment','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','HTTP\x20','27123151jAjrFc','Error\x20Code:','toUpperCase','stack','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','URL:','currency','log','EXP','FAILED','Error\x20message:','EXPIRED','RapydService','20aIaQOL','apiUrl','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','PAYMENT_FAILED','ACT','Response\x20data:','Request\x20Body\x20(Updated\x20Format):','Error\x20Message:','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','error','ORDER:\x20','1374965PmaRti','__esModule','Missing\x20id\x20or\x20redirect_url\x20in\x20response','1312wzNBMu','98eswjjO','PAYMENT_EXPIRED','PAID','data','Parsed\x20Result:','logWhiteDomainError','json','loggerService','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','):\x20','Response\x20Body:','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Unknown\x20error\x20from\x20Rapyd\x20API','PAYMENT_COMPLETED','message','logWhiteDomainResponse','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Processing\x20Rapyd\x20webhook:','Status\x20Text:','rapyd','redirect_url','TesSoft\x20Payment\x20System/1.0','https://tesoft.uk/gateway/success.php?id=','Unknown\x20error','UNKNOWN','===\x20RAPYD\x20API\x20ERROR\x20===','Error\x20stack:','now'];a42_0x1d3b=function(){return _0x166a56;};return a42_0x1d3b();}(function(_0x444506,_0x3a4692){const _0x5f3250=a42_0x54d4,_0x419512=_0x444506();while(!![]){try{const _0x16ed78=parseInt(_0x5f3250(0x196))/0x1+parseInt(_0x5f3250(0x17e))/0x2*(-parseInt(_0x5f3250(0x181))/0x3)+-parseInt(_0x5f3250(0x199))/0x4*(-parseInt(_0x5f3250(0x156))/0x5)+-parseInt(_0x5f3250(0x188))/0x6+-parseInt(_0x5f3250(0x15a))/0x7*(parseInt(_0x5f3250(0x159))/0x8)+-parseInt(_0x5f3250(0x198))/0x9+parseInt(_0x5f3250(0x14b))/0xa*(parseInt(_0x5f3250(0x13e))/0xb);if(_0x16ed78===_0x3a4692)break;else _0x419512['push'](_0x419512['shift']());}catch(_0x3719aa){_0x419512['push'](_0x419512['shift']());}}}(a42_0x1d3b,0xe5e9a));Object[a42_0x311eb9(0x137)](exports,a42_0x311eb9(0x157),{'value':!![]}),exports['RapydService']=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x51ad31=a42_0x311eb9;this[_0x51ad31(0x14c)]='https://tesoft.uk/gateway/rapyd/',console['log'](_0x51ad31(0x180));}async['createPaymentLink'](_0x4bea8c){const _0x4c41f9=a42_0x311eb9,{orderId:_0x364345,orderName:_0x5a8181,amount:_0x269227,currency:_0x15048b,usage:_0x115dc1,maxPayments:_0x1bbc42,successUrl:_0x44e364,failUrl:_0x4c89b3}=_0x4bea8c,_0x2f6af9=_0x15048b['toUpperCase'](),_0x2058aa='GB';console[_0x4c41f9(0x145)](_0x4c41f9(0x162));const _0x2d1b9c=_0x4c41f9(0x170)+_0x364345,_0x386f82=_0x4c41f9(0x187)+_0x364345,_0x3f097f={'amount':_0x269227,'currency':_0x2f6af9,'cancel_checkout_url':_0x386f82,'complete_checkout_url':_0x2d1b9c,'complete_payment_url':_0x2d1b9c,'merchant_reference_id':_0x364345,'description':_0x4c41f9(0x155)+_0x364345,'country':'GB','payment_method_types_include':[_0x4c41f9(0x18f),'gb_mastercard_card'],'custom_elements':{'display_description':!![]}},_0x488308=Date[_0x4c41f9(0x175)]();try{console[_0x4c41f9(0x145)](_0x4c41f9(0x153)),console[_0x4c41f9(0x145)](_0x4c41f9(0x143),this[_0x4c41f9(0x14c)]),console[_0x4c41f9(0x145)](_0x4c41f9(0x151),JSON[_0x4c41f9(0x17f)](_0x3f097f,null,0x2)),console[_0x4c41f9(0x145)](_0x4c41f9(0x189)+_0x2058aa+_0x4c41f9(0x139)),console['log']('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x4c41f9(0x161)]['logWhiteDomainRequest']('rapyd',_0x4c41f9(0x132),_0x4c41f9(0x136),_0x3f097f);const _0x1f343b=await fetch(this[_0x4c41f9(0x14c)],{'method':_0x4c41f9(0x136),'headers':{'Content-Type':'application/json','User-Agent':_0x4c41f9(0x16f)},'body':JSON[_0x4c41f9(0x17f)](_0x3f097f)}),_0xc5dbfa=Date[_0x4c41f9(0x175)]()-_0x488308;console['log'](_0x4c41f9(0x13c)),console[_0x4c41f9(0x145)](_0x4c41f9(0x18c),_0x1f343b[_0x4c41f9(0x18a)]),console[_0x4c41f9(0x145)](_0x4c41f9(0x16c),_0x1f343b[_0x4c41f9(0x191)]),console[_0x4c41f9(0x145)](_0x4c41f9(0x176),Object[_0x4c41f9(0x192)](_0x1f343b['headers'][_0x4c41f9(0x194)]())),console[_0x4c41f9(0x145)]('Response\x20Time:',_0xc5dbfa+'ms');const _0x3fabe0=await _0x1f343b[_0x4c41f9(0x134)]();console['log']('Raw\x20Response\x20Body:',_0x3fabe0);if(!_0x1f343b['ok']){console['error'](_0x4c41f9(0x173)),console[_0x4c41f9(0x154)](_0x4c41f9(0x135),_0x1f343b[_0x4c41f9(0x18a)]),console['error'](_0x4c41f9(0x164),_0x3fabe0),loggerService_1[_0x4c41f9(0x161)][_0x4c41f9(0x169)](_0x4c41f9(0x16d),_0x4c41f9(0x132),_0x1f343b['status'],_0x3fabe0,_0xc5dbfa),loggerService_1[_0x4c41f9(0x161)][_0x4c41f9(0x15f)](_0x4c41f9(0x16d),_0x4c41f9(0x132),_0x4c41f9(0x13d)+_0x1f343b[_0x4c41f9(0x18a)]+':\x20'+_0x3fabe0);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1f343b[_0x4c41f9(0x18a)]+_0x4c41f9(0x19b)+_0x3fabe0);}let _0x43f825;try{_0x43f825=JSON['parse'](_0x3fabe0);}catch(_0x4c15cb){console[_0x4c41f9(0x154)](_0x4c41f9(0x190),_0x4c15cb),loggerService_1[_0x4c41f9(0x161)][_0x4c41f9(0x15f)](_0x4c41f9(0x16d),'/v1/hosted/payment_links','JSON\x20Parse\x20Error:\x20'+_0x4c15cb);throw new Error(_0x4c41f9(0x142)+_0x3fabe0);}console['log']('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x4c41f9(0x145)](_0x4c41f9(0x15e),JSON['stringify'](_0x43f825,null,0x2)),loggerService_1[_0x4c41f9(0x161)]['logWhiteDomainResponse'](_0x4c41f9(0x16d),'/v1/hosted/payment_links',_0x1f343b[_0x4c41f9(0x18a)],_0x43f825,_0xc5dbfa);if(_0x43f825[_0x4c41f9(0x18a)]?.[_0x4c41f9(0x18a)]!=='SUCCESS'){const _0x34b887=_0x43f825[_0x4c41f9(0x18a)]?.[_0x4c41f9(0x168)]||_0x4c41f9(0x166),_0x3a47b5=_0x43f825[_0x4c41f9(0x18a)]?.['error_code']||_0x4c41f9(0x172);console['error'](_0x4c41f9(0x14d)),console[_0x4c41f9(0x154)](_0x4c41f9(0x13f),_0x3a47b5),console['error'](_0x4c41f9(0x152),_0x34b887),console[_0x4c41f9(0x154)](_0x4c41f9(0x17d),_0x43f825[_0x4c41f9(0x18a)]),loggerService_1[_0x4c41f9(0x161)]['logWhiteDomainError'](_0x4c41f9(0x16d),'/v1/hosted/payment_links',_0x4c41f9(0x18b)+_0x3a47b5+_0x4c41f9(0x163)+_0x34b887);throw new Error('Rapyd\x20API\x20error\x20('+_0x3a47b5+_0x4c41f9(0x163)+_0x34b887);}if(!_0x43f825[_0x4c41f9(0x15d)]?.['id']||!_0x43f825['data']?.[_0x4c41f9(0x16e)]){console[_0x4c41f9(0x154)](_0x4c41f9(0x16a)),console[_0x4c41f9(0x154)](_0x4c41f9(0x158)),console[_0x4c41f9(0x154)](_0x4c41f9(0x150),_0x43f825[_0x4c41f9(0x15d)]),loggerService_1[_0x4c41f9(0x161)]['logWhiteDomainError']('rapyd',_0x4c41f9(0x132),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x4c41f9(0x17c));}return console['log'](_0x4c41f9(0x177)),console['log']('Payment\x20Link\x20ID:',_0x43f825[_0x4c41f9(0x15d)]['id']),console[_0x4c41f9(0x145)]('Redirect\x20URL:',_0x43f825[_0x4c41f9(0x15d)][_0x4c41f9(0x16e)]),console[_0x4c41f9(0x145)]('üá¨üáß\x20Country\x20used:\x20'+_0x2058aa+'\x20(GB\x20-\x20Britain)'),console[_0x4c41f9(0x145)](_0x4c41f9(0x165)),{'gateway_payment_id':_0x43f825[_0x4c41f9(0x15d)]['id'],'payment_url':_0x43f825[_0x4c41f9(0x15d)][_0x4c41f9(0x16e)]};}catch(_0x31d698){console[_0x4c41f9(0x154)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x4c41f9(0x154)](_0x4c41f9(0x17b),_0x31d698),loggerService_1['loggerService'][_0x4c41f9(0x15f)](_0x4c41f9(0x16d),_0x4c41f9(0x132),_0x31d698);if(_0x31d698 instanceof Error){console[_0x4c41f9(0x154)](_0x4c41f9(0x148),_0x31d698['message']),console[_0x4c41f9(0x154)](_0x4c41f9(0x174),_0x31d698[_0x4c41f9(0x141)]);throw new Error(_0x4c41f9(0x182)+_0x31d698[_0x4c41f9(0x168)]);}throw new Error(_0x4c41f9(0x183));}}async[a42_0x311eb9(0x13b)](_0x24b6ab){const _0x1869e3=a42_0x311eb9,_0x3329cd=Date[_0x1869e3(0x175)]();try{loggerService_1[_0x1869e3(0x161)][_0x1869e3(0x19a)]('rapyd','/v1/hosted/payment_links/'+_0x24b6ab,_0x1869e3(0x193),{});const _0x52eff0=await fetch(this['apiUrl']+'/'+_0x24b6ab,{'method':_0x1869e3(0x193),'headers':{'Content-Type':_0x1869e3(0x17a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x29a164=Date[_0x1869e3(0x175)]()-_0x3329cd;if(!_0x52eff0['ok']){const _0xa75b8b=await _0x52eff0[_0x1869e3(0x134)]();loggerService_1[_0x1869e3(0x161)][_0x1869e3(0x169)]('rapyd',_0x1869e3(0x186)+_0x24b6ab,_0x52eff0[_0x1869e3(0x18a)],_0xa75b8b,_0x29a164);throw new Error(_0x1869e3(0x185)+_0x52eff0[_0x1869e3(0x18a)]);}const _0xe7a816=await _0x52eff0[_0x1869e3(0x160)]();loggerService_1[_0x1869e3(0x161)][_0x1869e3(0x169)](_0x1869e3(0x16d),_0x1869e3(0x186)+_0x24b6ab,_0x52eff0['status'],_0xe7a816,_0x29a164);if(_0xe7a816['status']?.['status']!=='SUCCESS'){loggerService_1['loggerService']['logWhiteDomainError']('rapyd',_0x1869e3(0x186)+_0x24b6ab,_0x1869e3(0x178)+(_0xe7a816[_0x1869e3(0x18a)]?.[_0x1869e3(0x168)]||'Unknown\x20error'));throw new Error(_0x1869e3(0x178)+(_0xe7a816[_0x1869e3(0x18a)]?.[_0x1869e3(0x168)]||_0x1869e3(0x171)));}let _0x50763a='PENDING';if(_0xe7a816[_0x1869e3(0x15d)]?.[_0x1869e3(0x18a)])switch(_0xe7a816[_0x1869e3(0x15d)][_0x1869e3(0x18a)][_0x1869e3(0x140)]()){case _0x1869e3(0x195):_0x50763a=_0x1869e3(0x15c);break;case'CAN':_0x50763a=_0x1869e3(0x147);break;case'EXP':_0x50763a='EXPIRED';break;case'ERR':_0x50763a=_0x1869e3(0x147);break;case _0x1869e3(0x179):case _0x1869e3(0x14f):default:_0x50763a=_0x1869e3(0x197);break;}return{'status':_0x50763a,'amount':_0xe7a816['data']?.['amount'],'currency':_0xe7a816[_0x1869e3(0x15d)]?.[_0x1869e3(0x144)]};}catch(_0x37ee58){console[_0x1869e3(0x154)]('Rapyd\x20payment\x20verification\x20error:',_0x37ee58),loggerService_1[_0x1869e3(0x161)]['logWhiteDomainError'](_0x1869e3(0x16d),_0x1869e3(0x186)+_0x24b6ab,_0x37ee58);throw new Error(_0x1869e3(0x184)+(_0x37ee58 instanceof Error?_0x37ee58[_0x1869e3(0x168)]:_0x1869e3(0x171)));}}async[a42_0x311eb9(0x13a)](_0x4efd35){const _0x3e03c8=a42_0x311eb9;console['log'](_0x3e03c8(0x16b),_0x4efd35);let _0x394367='PENDING';switch(_0x4efd35['type']?.[_0x3e03c8(0x140)]()){case _0x3e03c8(0x167):_0x4efd35[_0x3e03c8(0x15d)]?.[_0x3e03c8(0x133)]===!![]&&_0x4efd35[_0x3e03c8(0x15d)]?.[_0x3e03c8(0x18a)]==='CLO'?_0x394367=_0x3e03c8(0x15c):_0x394367=_0x3e03c8(0x197);break;case'PAYMENT_CANCELED':_0x394367=_0x3e03c8(0x147);break;case _0x3e03c8(0x15b):_0x394367='EXPIRED';break;case _0x3e03c8(0x14e):_0x394367=_0x3e03c8(0x147);break;default:switch(_0x4efd35[_0x3e03c8(0x15d)]?.['status']?.[_0x3e03c8(0x140)]()){case'CLO':_0x4efd35['data']?.[_0x3e03c8(0x133)]===!![]?_0x394367=_0x3e03c8(0x15c):_0x394367=_0x3e03c8(0x147);break;case _0x3e03c8(0x18e):_0x394367=_0x3e03c8(0x147);break;case _0x3e03c8(0x146):_0x394367=_0x3e03c8(0x149);break;case _0x3e03c8(0x18d):_0x394367=_0x3e03c8(0x147);break;case _0x3e03c8(0x179):case _0x3e03c8(0x14f):default:_0x394367='PENDING';break;}break;}return{'paymentId':_0x4efd35[_0x3e03c8(0x15d)]?.['merchant_reference_id']||'','status':_0x394367,'amount':_0x4efd35[_0x3e03c8(0x15d)]?.[_0x3e03c8(0x138)],'currency':_0x4efd35[_0x3e03c8(0x15d)]?.[_0x3e03c8(0x144)]};}}exports[a42_0x311eb9(0x14a)]=RapydService;