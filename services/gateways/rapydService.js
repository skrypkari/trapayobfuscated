'use strict';const a45_0x23ddd0=a45_0x44c3;(function(_0x122a03,_0x15ec59){const _0x1635f2=a45_0x44c3,_0x40d04a=_0x122a03();while(!![]){try{const _0x2f8895=parseInt(_0x1635f2(0x94))/0x1+-parseInt(_0x1635f2(0x99))/0x2+-parseInt(_0x1635f2(0xf2))/0x3*(-parseInt(_0x1635f2(0xc5))/0x4)+-parseInt(_0x1635f2(0xa5))/0x5+parseInt(_0x1635f2(0xdb))/0x6*(-parseInt(_0x1635f2(0xa4))/0x7)+-parseInt(_0x1635f2(0xd5))/0x8+-parseInt(_0x1635f2(0xb9))/0x9*(-parseInt(_0x1635f2(0x98))/0xa);if(_0x2f8895===_0x15ec59)break;else _0x40d04a['push'](_0x40d04a['shift']());}catch(_0x5553eb){_0x40d04a['push'](_0x40d04a['shift']());}}}(a45_0x112d,0x7e173));function a45_0x44c3(_0x166e0d,_0x308724){const _0x112d87=a45_0x112d();return a45_0x44c3=function(_0x44c38e,_0x57eea6){_0x44c38e=_0x44c38e-0x87;let _0x2f58bb=_0x112d87[_0x44c38e];return _0x2f58bb;},a45_0x44c3(_0x166e0d,_0x308724);}Object[a45_0x23ddd0(0xae)](exports,a45_0x23ddd0(0xb8),{'value':!![]}),exports[a45_0x23ddd0(0xef)]=void 0x0;const loggerService_1=require(a45_0x23ddd0(0xad));function a45_0x112d(){const _0x217008=['UNKNOWN','HTTP\x20','9XzDiau','POST','data','URL:','error_code','TesSoft\x20Payment\x20System/1.0','logWhiteDomainRequest','createPaymentLink','https://tesoft.uk/gateway/success.php?id=','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','CLO','amount','Unknown\x20error','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','Rapyd\x20payment\x20verification\x20error:','Request\x20Body\x20(Updated\x20Format):','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','gb_mastercard_card','GET','message','169728HdDYGw','type','PAYMENT_FAILED','HTTP\x20Status:','549210rYqvkq','1477236zPFsLk','NEW','now','):\x20','cardLast4','json','/v1/hosted/payment_links','FAILED','statusText','Response\x20Time:',',\x20failureMessage=','752234sBhoRH','1245045RUgDgR','paymentMethod','logWhiteDomainError','payment_method_type','PENDING','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','gb_visa_card','Failed\x20to\x20parse\x20JSON\x20response:','../loggerService','defineProperty','merchant_reference_id','https://tesoft.uk/gateway/fail.php?id=','üá¨üáß\x20Country\x20used:\x20','ERR','failure_code','Response\x20Body:','apiUrl','Unknown\x20error\x20from\x20Rapyd\x20API','PAYMENT_CANCELED','__esModule','333idCytF','===\x20RAPYD\x20SUCCESS\x20===','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','loggerService','fromEntries','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','failure_message','Response\x20data:','payment_method_data','Business\x20Error\x20(','entries','PAYMENT_COMPLETED','153436stknWs','paid','currency','stringify','EXP','toUpperCase','ACT','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','PAID','CAN','SUCCESS','Headers:','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','\x20(GB\x20-\x20Britain)','application/json','ORDER:\x20','5642608tWekZg','https://tesoft.uk/gateway/rapyd/','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','text','EXPIRED','Error\x20message:','6OGxutK','üá¨üáß\x20Country:\x20','üí•\x20Rapyd\x20failure\x20message:\x20','verifyPayment','status','/v1/hosted/payment_links/','last4','PAYMENT_EXPIRED','===\x20RAPYD\x20API\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','HTTP\x20error!\x20status:\x20','Payment\x20Link\x20ID:','redirect_url','rapyd','error','Full\x20Error\x20Data:','Error\x20Code:','log','logWhiteDomainResponse','RapydService'];a45_0x112d=function(){return _0x217008;};return a45_0x112d();}class RapydService{constructor(){const _0x38876e=a45_0x23ddd0;this[_0x38876e(0xb5)]=_0x38876e(0xd6),console[_0x38876e(0xed)](_0x38876e(0xbe));}async[a45_0x23ddd0(0x87)](_0x2dfdd8){const _0xc787d9=a45_0x23ddd0,{orderId:_0x50ee62,orderName:_0x55ef2d,amount:_0x2c3637,currency:_0x3e448a,usage:_0x4a2782,maxPayments:_0x53dfa1,successUrl:_0x4acfb6,failUrl:_0x1e0a91}=_0x2dfdd8,_0x617623=_0x3e448a[_0xc787d9(0xca)](),_0x1a44ac='GB';console['log'](_0xc787d9(0xcc));const _0xdb90ec=_0xc787d9(0x88)+_0x50ee62,_0x2b55a2=_0xc787d9(0xb0)+_0x50ee62,_0x498c61={'amount':_0x2c3637,'currency':_0x617623,'cancel_checkout_url':_0x2b55a2,'complete_checkout_url':_0xdb90ec,'complete_payment_url':_0xdb90ec,'merchant_reference_id':_0x50ee62,'description':_0xc787d9(0xd4)+_0x50ee62,'country':'GB','payment_method_types_include':[_0xc787d9(0xab),_0xc787d9(0x91)],'custom_elements':{'display_description':!![]}},_0x9c4973=Date[_0xc787d9(0x9b)]();try{console[_0xc787d9(0xed)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console['log'](_0xc787d9(0xf5),this[_0xc787d9(0xb5)]),console[_0xc787d9(0xed)](_0xc787d9(0x8f),JSON[_0xc787d9(0xc8)](_0x498c61,null,0x2)),console[_0xc787d9(0xed)](_0xc787d9(0xdc)+_0x1a44ac+'\x20(always\x20GB\x20for\x20Rapyd)'),console['log'](_0xc787d9(0xe5)),loggerService_1[_0xc787d9(0xbc)][_0xc787d9(0xf8)]('rapyd',_0xc787d9(0x9f),_0xc787d9(0xf3),_0x498c61);const _0x5b7e26=await fetch(this[_0xc787d9(0xb5)],{'method':_0xc787d9(0xf3),'headers':{'Content-Type':_0xc787d9(0xd3),'User-Agent':_0xc787d9(0xf7)},'body':JSON[_0xc787d9(0xc8)](_0x498c61)}),_0x9bbf3b=Date[_0xc787d9(0x9b)]()-_0x9c4973;console[_0xc787d9(0xed)](_0xc787d9(0xaa)),console['log']('Status:',_0x5b7e26[_0xc787d9(0xdf)]),console[_0xc787d9(0xed)]('Status\x20Text:',_0x5b7e26[_0xc787d9(0xa1)]),console[_0xc787d9(0xed)](_0xc787d9(0xd0),Object[_0xc787d9(0xbd)](_0x5b7e26['headers'][_0xc787d9(0xc3)]())),console[_0xc787d9(0xed)](_0xc787d9(0xa2),_0x9bbf3b+'ms');const _0x32d64d=await _0x5b7e26[_0xc787d9(0xd8)]();console[_0xc787d9(0xed)]('Raw\x20Response\x20Body:',_0x32d64d);if(!_0x5b7e26['ok']){console[_0xc787d9(0xea)](_0xc787d9(0xe3)),console[_0xc787d9(0xea)](_0xc787d9(0x97),_0x5b7e26[_0xc787d9(0xdf)]),console[_0xc787d9(0xea)](_0xc787d9(0xb4),_0x32d64d),loggerService_1[_0xc787d9(0xbc)][_0xc787d9(0xee)]('rapyd',_0xc787d9(0x9f),_0x5b7e26[_0xc787d9(0xdf)],_0x32d64d,_0x9bbf3b),loggerService_1[_0xc787d9(0xbc)][_0xc787d9(0xa7)](_0xc787d9(0xe9),_0xc787d9(0x9f),_0xc787d9(0xf1)+_0x5b7e26[_0xc787d9(0xdf)]+':\x20'+_0x32d64d);throw new Error(_0xc787d9(0xe6)+_0x5b7e26[_0xc787d9(0xdf)]+',\x20body:\x20'+_0x32d64d);}let _0x45ed33;try{_0x45ed33=JSON['parse'](_0x32d64d);}catch(_0x1a6471){console['error'](_0xc787d9(0xac),_0x1a6471),loggerService_1[_0xc787d9(0xbc)][_0xc787d9(0xa7)](_0xc787d9(0xe9),_0xc787d9(0x9f),'JSON\x20Parse\x20Error:\x20'+_0x1a6471);throw new Error(_0xc787d9(0xe4)+_0x32d64d);}console[_0xc787d9(0xed)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0xc787d9(0xed)]('Parsed\x20Result:',JSON[_0xc787d9(0xc8)](_0x45ed33,null,0x2)),loggerService_1[_0xc787d9(0xbc)][_0xc787d9(0xee)](_0xc787d9(0xe9),'/v1/hosted/payment_links',_0x5b7e26[_0xc787d9(0xdf)],_0x45ed33,_0x9bbf3b);if(_0x45ed33[_0xc787d9(0xdf)]?.[_0xc787d9(0xdf)]!==_0xc787d9(0xcf)){const _0xaa4440=_0x45ed33[_0xc787d9(0xdf)]?.[_0xc787d9(0x93)]||_0xc787d9(0xb6),_0x605174=_0x45ed33[_0xc787d9(0xdf)]?.[_0xc787d9(0xf6)]||_0xc787d9(0xf0);console['error']('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0xc787d9(0xea)](_0xc787d9(0xec),_0x605174),console['error']('Error\x20Message:',_0xaa4440),console[_0xc787d9(0xea)](_0xc787d9(0xeb),_0x45ed33[_0xc787d9(0xdf)]),loggerService_1[_0xc787d9(0xbc)][_0xc787d9(0xa7)]('rapyd',_0xc787d9(0x9f),_0xc787d9(0xc2)+_0x605174+_0xc787d9(0x9c)+_0xaa4440);throw new Error('Rapyd\x20API\x20error\x20('+_0x605174+'):\x20'+_0xaa4440);}if(!_0x45ed33[_0xc787d9(0xf4)]?.['id']||!_0x45ed33['data']?.['redirect_url']){console[_0xc787d9(0xea)](_0xc787d9(0xd7)),console[_0xc787d9(0xea)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console['error'](_0xc787d9(0xc0),_0x45ed33[_0xc787d9(0xf4)]),loggerService_1[_0xc787d9(0xbc)][_0xc787d9(0xa7)]('rapyd',_0xc787d9(0x9f),_0xc787d9(0x8d));throw new Error(_0xc787d9(0x89));}return console[_0xc787d9(0xed)](_0xc787d9(0xba)),console['log'](_0xc787d9(0xe7),_0x45ed33[_0xc787d9(0xf4)]['id']),console[_0xc787d9(0xed)]('Redirect\x20URL:',_0x45ed33[_0xc787d9(0xf4)]['redirect_url']),console[_0xc787d9(0xed)](_0xc787d9(0xb1)+_0x1a44ac+_0xc787d9(0xd2)),console[_0xc787d9(0xed)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x45ed33[_0xc787d9(0xf4)]['id'],'payment_url':_0x45ed33[_0xc787d9(0xf4)][_0xc787d9(0xe8)]};}catch(_0x479518){console[_0xc787d9(0xea)](_0xc787d9(0xd1)),console[_0xc787d9(0xea)]('Error\x20details:',_0x479518),loggerService_1[_0xc787d9(0xbc)][_0xc787d9(0xa7)](_0xc787d9(0xe9),_0xc787d9(0x9f),_0x479518);if(_0x479518 instanceof Error){console[_0xc787d9(0xea)](_0xc787d9(0xda),_0x479518[_0xc787d9(0x93)]),console[_0xc787d9(0xea)]('Error\x20stack:',_0x479518['stack']);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x479518['message']);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a45_0x23ddd0(0xde)](_0x2ae211){const _0x4f49d0=a45_0x23ddd0,_0x2a8723=Date[_0x4f49d0(0x9b)]();try{loggerService_1[_0x4f49d0(0xbc)][_0x4f49d0(0xf8)](_0x4f49d0(0xe9),'/v1/hosted/payment_links/'+_0x2ae211,_0x4f49d0(0x92),{});const _0x3ae4b2=await fetch(this[_0x4f49d0(0xb5)]+'/'+_0x2ae211,{'method':_0x4f49d0(0x92),'headers':{'Content-Type':_0x4f49d0(0xd3),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x555451=Date[_0x4f49d0(0x9b)]()-_0x2a8723;if(!_0x3ae4b2['ok']){const _0x1b1195=await _0x3ae4b2['text']();loggerService_1[_0x4f49d0(0xbc)][_0x4f49d0(0xee)]('rapyd','/v1/hosted/payment_links/'+_0x2ae211,_0x3ae4b2[_0x4f49d0(0xdf)],_0x1b1195,_0x555451);throw new Error(_0x4f49d0(0xe6)+_0x3ae4b2[_0x4f49d0(0xdf)]);}const _0x3186f8=await _0x3ae4b2[_0x4f49d0(0x9e)]();loggerService_1[_0x4f49d0(0xbc)][_0x4f49d0(0xee)](_0x4f49d0(0xe9),_0x4f49d0(0xe0)+_0x2ae211,_0x3ae4b2[_0x4f49d0(0xdf)],_0x3186f8,_0x555451);if(_0x3186f8[_0x4f49d0(0xdf)]?.['status']!==_0x4f49d0(0xcf)){loggerService_1[_0x4f49d0(0xbc)][_0x4f49d0(0xa7)]('rapyd',_0x4f49d0(0xe0)+_0x2ae211,'Rapyd\x20API\x20error:\x20'+(_0x3186f8[_0x4f49d0(0xdf)]?.[_0x4f49d0(0x93)]||_0x4f49d0(0x8c)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x3186f8['status']?.[_0x4f49d0(0x93)]||_0x4f49d0(0x8c)));}let _0x5965e9=_0x4f49d0(0xa9);if(_0x3186f8[_0x4f49d0(0xf4)]?.[_0x4f49d0(0xdf)])switch(_0x3186f8[_0x4f49d0(0xf4)][_0x4f49d0(0xdf)][_0x4f49d0(0xca)]()){case _0x4f49d0(0x8a):_0x5965e9='PAID';break;case _0x4f49d0(0xce):_0x5965e9=_0x4f49d0(0xa0);break;case _0x4f49d0(0xc9):_0x5965e9=_0x4f49d0(0xd9);break;case _0x4f49d0(0xb2):_0x5965e9=_0x4f49d0(0xa0);break;case'NEW':case'ACT':default:_0x5965e9='PENDING';break;}return{'status':_0x5965e9,'amount':_0x3186f8['data']?.[_0x4f49d0(0x8b)],'currency':_0x3186f8[_0x4f49d0(0xf4)]?.[_0x4f49d0(0xc7)]};}catch(_0x491dba){console[_0x4f49d0(0xea)](_0x4f49d0(0x8e),_0x491dba),loggerService_1[_0x4f49d0(0xbc)][_0x4f49d0(0xa7)](_0x4f49d0(0xe9),_0x4f49d0(0xe0)+_0x2ae211,_0x491dba);throw new Error(_0x4f49d0(0x90)+(_0x491dba instanceof Error?_0x491dba[_0x4f49d0(0x93)]:_0x4f49d0(0x8c)));}}async['processWebhook'](_0x5acfa8){const _0x47a77d=a45_0x23ddd0;console['log']('Processing\x20Rapyd\x20webhook:',_0x5acfa8);let _0x3aa262='PENDING',_0x251a8e;_0x5acfa8[_0x47a77d(0xf4)]?.[_0x47a77d(0xbf)]&&(_0x251a8e=_0x5acfa8[_0x47a77d(0xf4)][_0x47a77d(0xbf)],console[_0x47a77d(0xed)](_0x47a77d(0xdd)+_0x251a8e));switch(_0x5acfa8[_0x47a77d(0x95)]?.[_0x47a77d(0xca)]()){case _0x47a77d(0xc4):_0x5acfa8['data']?.[_0x47a77d(0xc6)]===!![]&&_0x5acfa8[_0x47a77d(0xf4)]?.['status']===_0x47a77d(0x8a)?_0x3aa262=_0x47a77d(0xcd):_0x3aa262='PENDING';break;case _0x47a77d(0xb7):_0x3aa262=_0x47a77d(0xa0);break;case _0x47a77d(0xe2):_0x3aa262=_0x47a77d(0xd9);break;case _0x47a77d(0x96):_0x3aa262=_0x47a77d(0xa0);!_0x251a8e&&_0x5acfa8[_0x47a77d(0xf4)]?.[_0x47a77d(0xbf)]&&(_0x251a8e=_0x5acfa8['data'][_0x47a77d(0xbf)]);break;default:switch(_0x5acfa8[_0x47a77d(0xf4)]?.[_0x47a77d(0xdf)]?.['toUpperCase']()){case _0x47a77d(0x8a):_0x5acfa8[_0x47a77d(0xf4)]?.['paid']===!![]?_0x3aa262=_0x47a77d(0xcd):_0x3aa262=_0x47a77d(0xa0);break;case _0x47a77d(0xce):_0x3aa262='FAILED';break;case _0x47a77d(0xc9):_0x3aa262=_0x47a77d(0xd9);break;case _0x47a77d(0xb2):_0x3aa262=_0x47a77d(0xa0);!_0x251a8e&&_0x5acfa8[_0x47a77d(0xf4)]?.[_0x47a77d(0xbf)]&&(_0x251a8e=_0x5acfa8[_0x47a77d(0xf4)]['failure_message']);break;case _0x47a77d(0x9a):case _0x47a77d(0xcb):default:_0x3aa262='PENDING';break;}break;}const _0x1ccd26={};return _0x5acfa8[_0x47a77d(0xf4)]?.[_0x47a77d(0xc1)]?.[_0x47a77d(0xe1)]&&(_0x1ccd26[_0x47a77d(0x9d)]=_0x5acfa8[_0x47a77d(0xf4)][_0x47a77d(0xc1)][_0x47a77d(0xe1)]),_0x5acfa8[_0x47a77d(0xf4)]?.['payment_method_type']&&(_0x1ccd26[_0x47a77d(0xa6)]=_0x5acfa8[_0x47a77d(0xf4)][_0x47a77d(0xa8)]),_0x5acfa8[_0x47a77d(0xf4)]?.['error_code']&&(_0x1ccd26['errorCode']=_0x5acfa8[_0x47a77d(0xf4)]['error_code']),_0x5acfa8[_0x47a77d(0xf4)]?.['failure_code']&&(_0x1ccd26['failureCode']=_0x5acfa8[_0x47a77d(0xf4)][_0x47a77d(0xb3)]),console['log'](_0x47a77d(0xbb)+_0x3aa262+_0x47a77d(0xa3)+(_0x251a8e||'none')),{'paymentId':_0x5acfa8[_0x47a77d(0xf4)]?.[_0x47a77d(0xaf)]||'','status':_0x3aa262,'amount':_0x5acfa8[_0x47a77d(0xf4)]?.['amount'],'currency':_0x5acfa8['data']?.[_0x47a77d(0xc7)],'failureMessage':_0x251a8e,'additionalInfo':_0x1ccd26};}}exports[a45_0x23ddd0(0xef)]=RapydService;