'use strict';const a45_0x46b990=a45_0xe0d3;(function(_0x35ec05,_0x50e230){const _0x2a6951=a45_0xe0d3,_0x3c3845=_0x35ec05();while(!![]){try{const _0xfa8dbc=-parseInt(_0x2a6951(0x1eb))/0x1+parseInt(_0x2a6951(0x213))/0x2+parseInt(_0x2a6951(0x1cc))/0x3+parseInt(_0x2a6951(0x1cb))/0x4*(parseInt(_0x2a6951(0x20b))/0x5)+-parseInt(_0x2a6951(0x1c9))/0x6+-parseInt(_0x2a6951(0x1fc))/0x7+parseInt(_0x2a6951(0x1b7))/0x8*(parseInt(_0x2a6951(0x209))/0x9);if(_0xfa8dbc===_0x50e230)break;else _0x3c3845['push'](_0x3c3845['shift']());}catch(_0x1bb036){_0x3c3845['push'](_0x3c3845['shift']());}}}(a45_0x355c,0x87680));function a45_0xe0d3(_0x787c16,_0x4f2bdc){const _0x355c66=a45_0x355c();return a45_0xe0d3=function(_0xe0d32b,_0x35ee2f){_0xe0d32b=_0xe0d32b-0x1ab;let _0x52f02f=_0x355c66[_0xe0d32b];return _0x52f02f;},a45_0xe0d3(_0x787c16,_0x4f2bdc);}Object[a45_0x46b990(0x1ca)](exports,'__esModule',{'value':!![]}),exports[a45_0x46b990(0x1b5)]=void 0x0;const loggerService_1=require('../loggerService');function a45_0x355c(){const _0x430c03=['\x20(always\x20GB\x20for\x20Rapyd)','currency','error','https://tesoft.uk/gateway/fail.php?id=','loggerService','Rapyd\x20API\x20error:\x20','text','ACT','statusText','NEW','POST','URL:','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','rapyd','gb_visa_card','826252pKLaPS','Headers:','Error\x20details:','Failed\x20to\x20parse\x20JSON\x20response:','failureCode','createPaymentLink','application/json','merchant_reference_id','fromEntries','redirect_url','Response\x20Body:','ORDER:\x20','üí•\x20Rapyd\x20failure\x20message:\x20','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Redirect\x20URL:','Request\x20Body\x20(Updated\x20Format):','json','769573yUtpXh','Response\x20data:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','ERR','UNKNOWN','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','apiUrl','PAYMENT_COMPLETED','failure_code','error_code',',\x20failureMessage=','Payment\x20Link\x20ID:','failure_message','6165HUSvfW','headers','1998170nIXTEt','JSON\x20Parse\x20Error:\x20','errorCode','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','üá¨üáß\x20Country:\x20','message','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Rapyd\x20payment\x20verification\x20error:','640278EDMfRw','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','verifyPayment','entries','üá¨üáß\x20Country\x20used:\x20','Unknown\x20error\x20from\x20Rapyd\x20API','HTTP\x20','CLO','PAYMENT_CANCELED','logWhiteDomainResponse','stringify','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','GET','PENDING','TesSoft\x20Payment\x20System/1.0','===\x20RAPYD\x20API\x20ERROR\x20===','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','now','RapydService','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','7376ROzvtK','Rapyd\x20API\x20error\x20(','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','log','payment_method_type','payment_method_data','Missing\x20id\x20or\x20redirect_url\x20in\x20response','HTTP\x20error!\x20status:\x20','data','EXP','EXPIRED','SUCCESS','parse','Response\x20Time:','\x20(GB\x20-\x20Britain)','Full\x20Error\x20Data:','amount','Error\x20stack:','4810512wuKgdv','defineProperty','4CAZAKZ','2823672iZeGMX','FAILED','cardLast4','Unknown\x20error','PAID','Raw\x20Response\x20Body:','gb_mastercard_card','paid','/v1/hosted/payment_links/','Processing\x20Rapyd\x20webhook:','logWhiteDomainRequest','logWhiteDomainError','):\x20','status','/v1/hosted/payment_links','toUpperCase'];a45_0x355c=function(){return _0x430c03;};return a45_0x355c();}class RapydService{constructor(){const _0x135cff=a45_0x46b990;this[_0x135cff(0x202)]='https://tesoft.uk/gateway/rapyd/',console[_0x135cff(0x1ba)](_0x135cff(0x1e8));}async[a45_0x46b990(0x1f0)](_0x594aea){const _0x21b7d6=a45_0x46b990,{orderId:_0xf288e2,orderName:_0x7467e6,amount:_0x364134,currency:_0x1167b8,usage:_0x51a2e4,maxPayments:_0x83bb1f,successUrl:_0x856e7,failUrl:_0x45dff0}=_0x594aea,_0x490bac=_0x1167b8[_0x21b7d6(0x1db)](),_0x2e36db='GB';console[_0x21b7d6(0x1ba)](_0x21b7d6(0x1ad));const _0x5b3422='https://tesoft.uk/gateway/success.php?id='+_0xf288e2,_0x4f4321=_0x21b7d6(0x1df)+_0xf288e2,_0x4d3fdd={'amount':_0x364134,'currency':_0x490bac,'cancel_checkout_url':_0x4f4321,'complete_checkout_url':_0x5b3422,'complete_payment_url':_0x5b3422,'merchant_reference_id':_0xf288e2,'description':_0x21b7d6(0x1f6)+_0xf288e2,'country':'GB','payment_method_types_include':[_0x21b7d6(0x1ea),_0x21b7d6(0x1d2)],'custom_elements':{'display_description':!![]}},_0x4298e9=Date[_0x21b7d6(0x1b4)]();try{console['log'](_0x21b7d6(0x20e)),console[_0x21b7d6(0x1ba)](_0x21b7d6(0x1e7),this[_0x21b7d6(0x202)]),console['log'](_0x21b7d6(0x1fa),JSON[_0x21b7d6(0x1ac)](_0x4d3fdd,null,0x2)),console[_0x21b7d6(0x1ba)](_0x21b7d6(0x20f)+_0x2e36db+_0x21b7d6(0x1dc)),console[_0x21b7d6(0x1ba)](_0x21b7d6(0x211)),loggerService_1[_0x21b7d6(0x1e0)][_0x21b7d6(0x1d6)](_0x21b7d6(0x1e9),_0x21b7d6(0x1da),_0x21b7d6(0x1e6),_0x4d3fdd);const _0x16e70b=await fetch(this[_0x21b7d6(0x202)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x21b7d6(0x1b1)},'body':JSON['stringify'](_0x4d3fdd)}),_0x188c2d=Date[_0x21b7d6(0x1b4)]()-_0x4298e9;console[_0x21b7d6(0x1ba)](_0x21b7d6(0x1f8)),console[_0x21b7d6(0x1ba)]('Status:',_0x16e70b[_0x21b7d6(0x1d9)]),console[_0x21b7d6(0x1ba)]('Status\x20Text:',_0x16e70b[_0x21b7d6(0x1e4)]),console[_0x21b7d6(0x1ba)](_0x21b7d6(0x1ec),Object[_0x21b7d6(0x1f3)](_0x16e70b[_0x21b7d6(0x20a)][_0x21b7d6(0x216)]())),console[_0x21b7d6(0x1ba)](_0x21b7d6(0x1c4),_0x188c2d+'ms');const _0x537bba=await _0x16e70b[_0x21b7d6(0x1e2)]();console[_0x21b7d6(0x1ba)](_0x21b7d6(0x1d1),_0x537bba);if(!_0x16e70b['ok']){console[_0x21b7d6(0x1de)](_0x21b7d6(0x1b2)),console[_0x21b7d6(0x1de)]('HTTP\x20Status:',_0x16e70b[_0x21b7d6(0x1d9)]),console[_0x21b7d6(0x1de)](_0x21b7d6(0x1f5),_0x537bba),loggerService_1[_0x21b7d6(0x1e0)][_0x21b7d6(0x1ab)](_0x21b7d6(0x1e9),_0x21b7d6(0x1da),_0x16e70b[_0x21b7d6(0x1d9)],_0x537bba,_0x188c2d),loggerService_1[_0x21b7d6(0x1e0)][_0x21b7d6(0x1d7)](_0x21b7d6(0x1e9),_0x21b7d6(0x1da),_0x21b7d6(0x219)+_0x16e70b[_0x21b7d6(0x1d9)]+':\x20'+_0x537bba);throw new Error(_0x21b7d6(0x1be)+_0x16e70b[_0x21b7d6(0x1d9)]+',\x20body:\x20'+_0x537bba);}let _0x205503;try{_0x205503=JSON[_0x21b7d6(0x1c3)](_0x537bba);}catch(_0x1c6eed){console[_0x21b7d6(0x1de)](_0x21b7d6(0x1ee),_0x1c6eed),loggerService_1['loggerService']['logWhiteDomainError'](_0x21b7d6(0x1e9),_0x21b7d6(0x1da),_0x21b7d6(0x20c)+_0x1c6eed);throw new Error(_0x21b7d6(0x1ae)+_0x537bba);}console['log'](_0x21b7d6(0x1b9)),console[_0x21b7d6(0x1ba)]('Parsed\x20Result:',JSON['stringify'](_0x205503,null,0x2)),loggerService_1[_0x21b7d6(0x1e0)][_0x21b7d6(0x1ab)](_0x21b7d6(0x1e9),_0x21b7d6(0x1da),_0x16e70b[_0x21b7d6(0x1d9)],_0x205503,_0x188c2d);if(_0x205503[_0x21b7d6(0x1d9)]?.[_0x21b7d6(0x1d9)]!=='SUCCESS'){const _0x347edd=_0x205503[_0x21b7d6(0x1d9)]?.[_0x21b7d6(0x210)]||_0x21b7d6(0x218),_0x2ebb9a=_0x205503[_0x21b7d6(0x1d9)]?.['error_code']||_0x21b7d6(0x200);console[_0x21b7d6(0x1de)](_0x21b7d6(0x214)),console[_0x21b7d6(0x1de)]('Error\x20Code:',_0x2ebb9a),console[_0x21b7d6(0x1de)]('Error\x20Message:',_0x347edd),console[_0x21b7d6(0x1de)](_0x21b7d6(0x1c6),_0x205503[_0x21b7d6(0x1d9)]),loggerService_1[_0x21b7d6(0x1e0)][_0x21b7d6(0x1d7)](_0x21b7d6(0x1e9),_0x21b7d6(0x1da),'Business\x20Error\x20('+_0x2ebb9a+_0x21b7d6(0x1d8)+_0x347edd);throw new Error(_0x21b7d6(0x1b8)+_0x2ebb9a+_0x21b7d6(0x1d8)+_0x347edd);}if(!_0x205503['data']?.['id']||!_0x205503[_0x21b7d6(0x1bf)]?.[_0x21b7d6(0x1f4)]){console[_0x21b7d6(0x1de)](_0x21b7d6(0x201)),console[_0x21b7d6(0x1de)](_0x21b7d6(0x1bd)),console['error'](_0x21b7d6(0x1fd),_0x205503[_0x21b7d6(0x1bf)]),loggerService_1[_0x21b7d6(0x1e0)]['logWhiteDomainError']('rapyd',_0x21b7d6(0x1da),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x21b7d6(0x1ba)]('===\x20RAPYD\x20SUCCESS\x20==='),console[_0x21b7d6(0x1ba)](_0x21b7d6(0x207),_0x205503['data']['id']),console['log'](_0x21b7d6(0x1f9),_0x205503[_0x21b7d6(0x1bf)][_0x21b7d6(0x1f4)]),console[_0x21b7d6(0x1ba)](_0x21b7d6(0x217)+_0x2e36db+_0x21b7d6(0x1c5)),console[_0x21b7d6(0x1ba)](_0x21b7d6(0x211)),{'gateway_payment_id':_0x205503[_0x21b7d6(0x1bf)]['id'],'payment_url':_0x205503[_0x21b7d6(0x1bf)][_0x21b7d6(0x1f4)]};}catch(_0x13a7f8){console[_0x21b7d6(0x1de)]('===\x20RAPYD\x20SERVICE\x20ERROR\x20==='),console[_0x21b7d6(0x1de)](_0x21b7d6(0x1ed),_0x13a7f8),loggerService_1[_0x21b7d6(0x1e0)]['logWhiteDomainError'](_0x21b7d6(0x1e9),_0x21b7d6(0x1da),_0x13a7f8);if(_0x13a7f8 instanceof Error){console['error']('Error\x20message:',_0x13a7f8[_0x21b7d6(0x210)]),console[_0x21b7d6(0x1de)](_0x21b7d6(0x1c8),_0x13a7f8['stack']);throw new Error(_0x21b7d6(0x1fe)+_0x13a7f8[_0x21b7d6(0x210)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a45_0x46b990(0x215)](_0x872946){const _0x5538da=a45_0x46b990,_0xec2fe1=Date['now']();try{loggerService_1[_0x5538da(0x1e0)]['logWhiteDomainRequest'](_0x5538da(0x1e9),_0x5538da(0x1d4)+_0x872946,_0x5538da(0x1af),{});const _0x7a1f20=await fetch(this[_0x5538da(0x202)]+'/'+_0x872946,{'method':_0x5538da(0x1af),'headers':{'Content-Type':_0x5538da(0x1f1),'User-Agent':_0x5538da(0x1b1)}}),_0x4dc70f=Date[_0x5538da(0x1b4)]()-_0xec2fe1;if(!_0x7a1f20['ok']){const _0x2dcc75=await _0x7a1f20['text']();loggerService_1[_0x5538da(0x1e0)][_0x5538da(0x1ab)]('rapyd',_0x5538da(0x1d4)+_0x872946,_0x7a1f20[_0x5538da(0x1d9)],_0x2dcc75,_0x4dc70f);throw new Error(_0x5538da(0x1be)+_0x7a1f20[_0x5538da(0x1d9)]);}const _0x3c99a7=await _0x7a1f20[_0x5538da(0x1fb)]();loggerService_1[_0x5538da(0x1e0)][_0x5538da(0x1ab)](_0x5538da(0x1e9),_0x5538da(0x1d4)+_0x872946,_0x7a1f20['status'],_0x3c99a7,_0x4dc70f);if(_0x3c99a7['status']?.[_0x5538da(0x1d9)]!==_0x5538da(0x1c2)){loggerService_1['loggerService'][_0x5538da(0x1d7)](_0x5538da(0x1e9),_0x5538da(0x1d4)+_0x872946,_0x5538da(0x1e1)+(_0x3c99a7[_0x5538da(0x1d9)]?.[_0x5538da(0x210)]||_0x5538da(0x1cf)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x3c99a7[_0x5538da(0x1d9)]?.[_0x5538da(0x210)]||_0x5538da(0x1cf)));}let _0x1e7dbe=_0x5538da(0x1b0);if(_0x3c99a7[_0x5538da(0x1bf)]?.[_0x5538da(0x1d9)])switch(_0x3c99a7['data'][_0x5538da(0x1d9)][_0x5538da(0x1db)]()){case _0x5538da(0x21a):_0x1e7dbe='PAID';break;case'CAN':_0x1e7dbe=_0x5538da(0x1cd);break;case _0x5538da(0x1c0):_0x1e7dbe=_0x5538da(0x1c1);break;case _0x5538da(0x1ff):_0x1e7dbe=_0x5538da(0x1cd);break;case _0x5538da(0x1e5):case _0x5538da(0x1e3):default:_0x1e7dbe=_0x5538da(0x1b0);break;}return{'status':_0x1e7dbe,'amount':_0x3c99a7[_0x5538da(0x1bf)]?.[_0x5538da(0x1c7)],'currency':_0x3c99a7[_0x5538da(0x1bf)]?.['currency']};}catch(_0x10ddd6){console[_0x5538da(0x1de)](_0x5538da(0x212),_0x10ddd6),loggerService_1[_0x5538da(0x1e0)][_0x5538da(0x1d7)](_0x5538da(0x1e9),_0x5538da(0x1d4)+_0x872946,_0x10ddd6);throw new Error(_0x5538da(0x1b6)+(_0x10ddd6 instanceof Error?_0x10ddd6['message']:_0x5538da(0x1cf)));}}async['processWebhook'](_0x2725d3){const _0x443ffc=a45_0x46b990;console['log'](_0x443ffc(0x1d5),_0x2725d3);let _0x21ee94=_0x443ffc(0x1b0),_0x274f1e;_0x2725d3['data']?.['failure_message']&&(_0x274f1e=_0x2725d3['data'][_0x443ffc(0x208)],console['log'](_0x443ffc(0x1f7)+_0x274f1e));switch(_0x2725d3['type']?.[_0x443ffc(0x1db)]()){case _0x443ffc(0x203):_0x2725d3[_0x443ffc(0x1bf)]?.[_0x443ffc(0x1d3)]===!![]&&_0x2725d3[_0x443ffc(0x1bf)]?.[_0x443ffc(0x1d9)]===_0x443ffc(0x21a)?_0x21ee94=_0x443ffc(0x1d0):_0x21ee94=_0x443ffc(0x1b0);break;case _0x443ffc(0x21b):_0x21ee94=_0x443ffc(0x1cd);break;case'PAYMENT_EXPIRED':_0x21ee94=_0x443ffc(0x1c1);break;case'PAYMENT_FAILED':_0x21ee94=_0x443ffc(0x1cd);!_0x274f1e&&_0x2725d3[_0x443ffc(0x1bf)]?.[_0x443ffc(0x208)]&&(_0x274f1e=_0x2725d3[_0x443ffc(0x1bf)][_0x443ffc(0x208)]);break;default:switch(_0x2725d3[_0x443ffc(0x1bf)]?.['status']?.[_0x443ffc(0x1db)]()){case _0x443ffc(0x21a):_0x2725d3[_0x443ffc(0x1bf)]?.[_0x443ffc(0x1d3)]===!![]?_0x21ee94=_0x443ffc(0x1d0):_0x21ee94=_0x443ffc(0x1cd);break;case'CAN':_0x21ee94=_0x443ffc(0x1cd);break;case _0x443ffc(0x1c0):_0x21ee94=_0x443ffc(0x1c1);break;case _0x443ffc(0x1ff):_0x21ee94='FAILED';!_0x274f1e&&_0x2725d3[_0x443ffc(0x1bf)]?.['failure_message']&&(_0x274f1e=_0x2725d3[_0x443ffc(0x1bf)][_0x443ffc(0x208)]);break;case _0x443ffc(0x1e5):case _0x443ffc(0x1e3):default:_0x21ee94='PENDING';break;}break;}const _0x2f92b1={};return _0x2725d3[_0x443ffc(0x1bf)]?.[_0x443ffc(0x1bc)]?.['last4']&&(_0x2f92b1[_0x443ffc(0x1ce)]=_0x2725d3[_0x443ffc(0x1bf)][_0x443ffc(0x1bc)]['last4']),_0x2725d3[_0x443ffc(0x1bf)]?.[_0x443ffc(0x1bb)]&&(_0x2f92b1['paymentMethod']=_0x2725d3[_0x443ffc(0x1bf)][_0x443ffc(0x1bb)]),_0x2725d3[_0x443ffc(0x1bf)]?.['error_code']&&(_0x2f92b1[_0x443ffc(0x20d)]=_0x2725d3['data'][_0x443ffc(0x205)]),_0x2725d3['data']?.[_0x443ffc(0x204)]&&(_0x2f92b1[_0x443ffc(0x1ef)]=_0x2725d3[_0x443ffc(0x1bf)][_0x443ffc(0x204)]),console[_0x443ffc(0x1ba)](_0x443ffc(0x1b3)+_0x21ee94+_0x443ffc(0x206)+(_0x274f1e||'none')),{'paymentId':_0x2725d3[_0x443ffc(0x1bf)]?.[_0x443ffc(0x1f2)]||'','status':_0x21ee94,'amount':_0x2725d3[_0x443ffc(0x1bf)]?.[_0x443ffc(0x1c7)],'currency':_0x2725d3[_0x443ffc(0x1bf)]?.[_0x443ffc(0x1dd)],'failureMessage':_0x274f1e,'additionalInfo':_0x2f92b1};}}exports[a45_0x46b990(0x1b5)]=RapydService;