'use strict';const a45_0x2c9166=a45_0x2595;(function(_0x44a042,_0x37e191){const _0x4232b5=a45_0x2595,_0x4ba833=_0x44a042();while(!![]){try{const _0x306535=-parseInt(_0x4232b5(0x242))/0x1*(parseInt(_0x4232b5(0x22d))/0x2)+-parseInt(_0x4232b5(0x25f))/0x3*(parseInt(_0x4232b5(0x23e))/0x4)+parseInt(_0x4232b5(0x24e))/0x5*(parseInt(_0x4232b5(0x223))/0x6)+-parseInt(_0x4232b5(0x209))/0x7*(parseInt(_0x4232b5(0x229))/0x8)+-parseInt(_0x4232b5(0x25e))/0x9*(-parseInt(_0x4232b5(0x21b))/0xa)+-parseInt(_0x4232b5(0x1fe))/0xb*(parseInt(_0x4232b5(0x258))/0xc)+parseInt(_0x4232b5(0x254))/0xd;if(_0x306535===_0x37e191)break;else _0x4ba833['push'](_0x4ba833['shift']());}catch(_0x466e32){_0x4ba833['push'](_0x4ba833['shift']());}}}(a45_0x4d79,0xe1a2d));function a45_0x4d79(){const _0xd13e75=['Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','../loggerService','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','https://tesoft.uk/gateway/rapyd/','stringify','/v1/hosted/payment_links/','ERR','__esModule','):\x20','PAYMENT_COMPLETED','Error\x20Message:','Status\x20Text:','6952070WVATuI','currency','failure_message','merchant_reference_id','Payment\x20Link\x20ID:','fromEntries','PAYMENT_CANCELED','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','4866uyWKfb','Headers:','Parsed\x20Result:','Full\x20Error\x20Data:','log','NEW','40eGhzGA','paid','Failed\x20to\x20parse\x20JSON\x20response:','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','34836zcBvEz','redirect_url','message','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','Error\x20stack:','TesSoft\x20Payment\x20System/1.0','loggerService','RapydService','https://tesoft.uk/gateway/success.php?id=','defineProperty','payment_method_type','logWhiteDomainResponse','data','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','Request\x20Body\x20(Updated\x20Format):','Response\x20Time:','PAYMENT_EXPIRED','12WSLFaw','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','HTTP\x20error!\x20status:\x20','amount','89eOVlSZ','toUpperCase','logWhiteDomainError','error_code','\x20(GB\x20-\x20Britain)','Status:','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','rapyd','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','POST','https://tesoft.uk/gateway/fail.php?id=','verifyPayment','3030GbmdDO','text','CLO','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','now','error','74935289VwllxA','üá¨üáß\x20Country\x20used:\x20',',\x20body:\x20','last4','20469756kTAfSi','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','/v1/hosted/payment_links','gb_mastercard_card','Rapyd\x20payment\x20verification\x20error:','json','9euuuFv','1761591WZaZtC','headers','Response\x20data:','JSON\x20Parse\x20Error:\x20','===\x20RAPYD\x20SUCCESS\x20===','Unknown\x20error\x20from\x20Rapyd\x20API','type','stack','SUCCESS','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','failure_code','entries','payment_method_data','===\x20RAPYD\x20API\x20ERROR\x20===','cardLast4','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','application/json','EXP','apiUrl','EXPIRED','paymentMethod','üá¨üáß\x20Country:\x20','HTTP\x20','11PxsiUQ','createPaymentLink','Rapyd\x20API\x20error:\x20','PENDING','\x20(always\x20GB\x20for\x20Rapyd)','PAID','parse','FAILED','status','Error\x20message:','gb_visa_card','1412761WBprjY','Business\x20Error\x20(','Raw\x20Response\x20Body:','Unknown\x20error','GET','errorCode'];a45_0x4d79=function(){return _0xd13e75;};return a45_0x4d79();}Object[a45_0x2c9166(0x236)](exports,a45_0x2c9166(0x216),{'value':!![]}),exports[a45_0x2c9166(0x234)]=void 0x0;const loggerService_1=require(a45_0x2c9166(0x210));function a45_0x2595(_0x163098,_0x38386b){const _0x4d792a=a45_0x4d79();return a45_0x2595=function(_0x2595c3,_0x5d64ba){_0x2595c3=_0x2595c3-0x1ed;let _0x4c5923=_0x4d792a[_0x2595c3];return _0x4c5923;},a45_0x2595(_0x163098,_0x38386b);}class RapydService{constructor(){const _0x4991bd=a45_0x2c9166;this[_0x4991bd(0x1f9)]=_0x4991bd(0x212),console[_0x4991bd(0x227)](_0x4991bd(0x23f));}async[a45_0x2c9166(0x1ff)](_0x33d09d){const _0x298311=a45_0x2c9166,{orderId:_0x2ac42b,orderName:_0x211ffb,amount:_0x24f46b,currency:_0x357a74,usage:_0x333105,maxPayments:_0x419a4f,successUrl:_0x11ecd5,failUrl:_0x1afe18}=_0x33d09d,_0x58bd34=_0x357a74[_0x298311(0x243)](),_0x3f32a3='GB';console[_0x298311(0x227)](_0x298311(0x1f0));const _0x3b7d3e=_0x298311(0x235)+_0x2ac42b,_0x10ebc7=_0x298311(0x24c)+_0x2ac42b,_0x36032b={'amount':_0x24f46b,'currency':_0x58bd34,'cancel_checkout_url':_0x10ebc7,'complete_checkout_url':_0x3b7d3e,'complete_payment_url':_0x3b7d3e,'merchant_reference_id':_0x2ac42b,'description':'ORDER:\x20'+_0x2ac42b,'country':'GB','payment_method_types_include':[_0x298311(0x208),_0x298311(0x25b)],'custom_elements':{'display_description':!![]}},_0x1528cd=Date[_0x298311(0x252)]();try{console[_0x298311(0x227)](_0x298311(0x211)),console[_0x298311(0x227)]('URL:',this[_0x298311(0x1f9)]),console[_0x298311(0x227)](_0x298311(0x23b),JSON[_0x298311(0x213)](_0x36032b,null,0x2)),console[_0x298311(0x227)](_0x298311(0x1fc)+_0x3f32a3+_0x298311(0x202)),console[_0x298311(0x227)](_0x298311(0x248)),loggerService_1[_0x298311(0x233)]['logWhiteDomainRequest'](_0x298311(0x249),'/v1/hosted/payment_links',_0x298311(0x24b),_0x36032b);const _0xb7f83c=await fetch(this[_0x298311(0x1f9)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x298311(0x232)},'body':JSON[_0x298311(0x213)](_0x36032b)}),_0x58534d=Date[_0x298311(0x252)]()-_0x1528cd;console['log']('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x298311(0x227)](_0x298311(0x247),_0xb7f83c['status']),console[_0x298311(0x227)](_0x298311(0x21a),_0xb7f83c['statusText']),console['log'](_0x298311(0x224),Object[_0x298311(0x220)](_0xb7f83c[_0x298311(0x260)][_0x298311(0x1f2)]())),console[_0x298311(0x227)](_0x298311(0x23c),_0x58534d+'ms');const _0x563953=await _0xb7f83c[_0x298311(0x24f)]();console[_0x298311(0x227)](_0x298311(0x20b),_0x563953);if(!_0xb7f83c['ok']){console[_0x298311(0x253)](_0x298311(0x1f4)),console[_0x298311(0x253)]('HTTP\x20Status:',_0xb7f83c[_0x298311(0x206)]),console[_0x298311(0x253)]('Response\x20Body:',_0x563953),loggerService_1[_0x298311(0x233)]['logWhiteDomainResponse'](_0x298311(0x249),'/v1/hosted/payment_links',_0xb7f83c[_0x298311(0x206)],_0x563953,_0x58534d),loggerService_1[_0x298311(0x233)]['logWhiteDomainError'](_0x298311(0x249),_0x298311(0x25a),_0x298311(0x1fd)+_0xb7f83c['status']+':\x20'+_0x563953);throw new Error(_0x298311(0x240)+_0xb7f83c[_0x298311(0x206)]+_0x298311(0x256)+_0x563953);}let _0x22c9cd;try{_0x22c9cd=JSON[_0x298311(0x204)](_0x563953);}catch(_0x2303ae){console['error'](_0x298311(0x22b),_0x2303ae),loggerService_1[_0x298311(0x233)][_0x298311(0x244)]('rapyd',_0x298311(0x25a),_0x298311(0x262)+_0x2303ae);throw new Error(_0x298311(0x23a)+_0x563953);}console[_0x298311(0x227)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x298311(0x227)](_0x298311(0x225),JSON[_0x298311(0x213)](_0x22c9cd,null,0x2)),loggerService_1[_0x298311(0x233)][_0x298311(0x238)](_0x298311(0x249),_0x298311(0x25a),_0xb7f83c[_0x298311(0x206)],_0x22c9cd,_0x58534d);if(_0x22c9cd[_0x298311(0x206)]?.[_0x298311(0x206)]!==_0x298311(0x1ef)){const _0x2e7d1b=_0x22c9cd[_0x298311(0x206)]?.[_0x298311(0x22f)]||_0x298311(0x264),_0x45d5da=_0x22c9cd[_0x298311(0x206)]?.[_0x298311(0x245)]||'UNKNOWN';console[_0x298311(0x253)](_0x298311(0x22c)),console[_0x298311(0x253)]('Error\x20Code:',_0x45d5da),console['error'](_0x298311(0x219),_0x2e7d1b),console[_0x298311(0x253)](_0x298311(0x226),_0x22c9cd[_0x298311(0x206)]),loggerService_1[_0x298311(0x233)][_0x298311(0x244)](_0x298311(0x249),_0x298311(0x25a),_0x298311(0x20a)+_0x45d5da+_0x298311(0x217)+_0x2e7d1b);throw new Error('Rapyd\x20API\x20error\x20('+_0x45d5da+_0x298311(0x217)+_0x2e7d1b);}if(!_0x22c9cd[_0x298311(0x239)]?.['id']||!_0x22c9cd[_0x298311(0x239)]?.['redirect_url']){console[_0x298311(0x253)](_0x298311(0x1f6)),console[_0x298311(0x253)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console['error'](_0x298311(0x261),_0x22c9cd[_0x298311(0x239)]),loggerService_1[_0x298311(0x233)][_0x298311(0x244)](_0x298311(0x249),_0x298311(0x25a),_0x298311(0x20f));throw new Error(_0x298311(0x24a));}return console['log'](_0x298311(0x263)),console[_0x298311(0x227)](_0x298311(0x21f),_0x22c9cd[_0x298311(0x239)]['id']),console[_0x298311(0x227)]('Redirect\x20URL:',_0x22c9cd[_0x298311(0x239)][_0x298311(0x22e)]),console[_0x298311(0x227)](_0x298311(0x255)+_0x3f32a3+_0x298311(0x246)),console[_0x298311(0x227)](_0x298311(0x248)),{'gateway_payment_id':_0x22c9cd[_0x298311(0x239)]['id'],'payment_url':_0x22c9cd['data'][_0x298311(0x22e)]};}catch(_0x2d24f8){console[_0x298311(0x253)](_0x298311(0x222)),console['error']('Error\x20details:',_0x2d24f8),loggerService_1[_0x298311(0x233)][_0x298311(0x244)](_0x298311(0x249),_0x298311(0x25a),_0x2d24f8);if(_0x2d24f8 instanceof Error){console[_0x298311(0x253)](_0x298311(0x207),_0x2d24f8['message']),console['error'](_0x298311(0x231),_0x2d24f8[_0x298311(0x1ee)]);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x2d24f8[_0x298311(0x22f)]);}throw new Error(_0x298311(0x251));}}async[a45_0x2c9166(0x24d)](_0x2f10db){const _0x491acc=a45_0x2c9166,_0x54708f=Date[_0x491acc(0x252)]();try{loggerService_1['loggerService']['logWhiteDomainRequest']('rapyd',_0x491acc(0x214)+_0x2f10db,_0x491acc(0x20d),{});const _0x1d418c=await fetch(this[_0x491acc(0x1f9)]+'/'+_0x2f10db,{'method':_0x491acc(0x20d),'headers':{'Content-Type':_0x491acc(0x1f7),'User-Agent':_0x491acc(0x232)}}),_0x57f5ad=Date['now']()-_0x54708f;if(!_0x1d418c['ok']){const _0x5b6338=await _0x1d418c[_0x491acc(0x24f)]();loggerService_1[_0x491acc(0x233)][_0x491acc(0x238)](_0x491acc(0x249),_0x491acc(0x214)+_0x2f10db,_0x1d418c['status'],_0x5b6338,_0x57f5ad);throw new Error(_0x491acc(0x240)+_0x1d418c['status']);}const _0x3f528a=await _0x1d418c[_0x491acc(0x25d)]();loggerService_1[_0x491acc(0x233)]['logWhiteDomainResponse'](_0x491acc(0x249),_0x491acc(0x214)+_0x2f10db,_0x1d418c['status'],_0x3f528a,_0x57f5ad);if(_0x3f528a['status']?.[_0x491acc(0x206)]!==_0x491acc(0x1ef)){loggerService_1['loggerService'][_0x491acc(0x244)]('rapyd',_0x491acc(0x214)+_0x2f10db,_0x491acc(0x200)+(_0x3f528a['status']?.[_0x491acc(0x22f)]||_0x491acc(0x20c)));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x3f528a[_0x491acc(0x206)]?.[_0x491acc(0x22f)]||_0x491acc(0x20c)));}let _0x53c29c=_0x491acc(0x201);if(_0x3f528a[_0x491acc(0x239)]?.[_0x491acc(0x206)])switch(_0x3f528a['data'][_0x491acc(0x206)][_0x491acc(0x243)]()){case _0x491acc(0x250):_0x53c29c='PAID';break;case'CAN':_0x53c29c='FAILED';break;case'EXP':_0x53c29c='EXPIRED';break;case _0x491acc(0x215):_0x53c29c=_0x491acc(0x205);break;case _0x491acc(0x228):case'ACT':default:_0x53c29c=_0x491acc(0x201);break;}return{'status':_0x53c29c,'amount':_0x3f528a['data']?.[_0x491acc(0x241)],'currency':_0x3f528a[_0x491acc(0x239)]?.[_0x491acc(0x21c)]};}catch(_0x3f8671){console[_0x491acc(0x253)](_0x491acc(0x25c),_0x3f8671),loggerService_1[_0x491acc(0x233)][_0x491acc(0x244)](_0x491acc(0x249),_0x491acc(0x214)+_0x2f10db,_0x3f8671);throw new Error(_0x491acc(0x230)+(_0x3f8671 instanceof Error?_0x3f8671['message']:_0x491acc(0x20c)));}}async['processWebhook'](_0x4b44ee){const _0x1cf564=a45_0x2c9166;console[_0x1cf564(0x227)]('Processing\x20Rapyd\x20webhook:',_0x4b44ee);let _0x2a6571=_0x1cf564(0x201),_0x50bea9;_0x4b44ee['data']?.[_0x1cf564(0x21d)]&&(_0x50bea9=_0x4b44ee[_0x1cf564(0x239)]['failure_message'],console['log']('üí•\x20Rapyd\x20failure\x20message:\x20'+_0x50bea9));switch(_0x4b44ee[_0x1cf564(0x1ed)]?.[_0x1cf564(0x243)]()){case _0x1cf564(0x218):_0x4b44ee[_0x1cf564(0x239)]?.['paid']===!![]&&_0x4b44ee['data']?.[_0x1cf564(0x206)]===_0x1cf564(0x250)?_0x2a6571='PAID':_0x2a6571='PENDING';break;case _0x1cf564(0x221):_0x2a6571=_0x1cf564(0x205);break;case _0x1cf564(0x23d):_0x2a6571=_0x1cf564(0x1fa);break;case'PAYMENT_FAILED':_0x2a6571=_0x1cf564(0x205);!_0x50bea9&&_0x4b44ee['data']?.[_0x1cf564(0x21d)]&&(_0x50bea9=_0x4b44ee[_0x1cf564(0x239)]['failure_message']);break;default:switch(_0x4b44ee[_0x1cf564(0x239)]?.[_0x1cf564(0x206)]?.['toUpperCase']()){case _0x1cf564(0x250):_0x4b44ee[_0x1cf564(0x239)]?.[_0x1cf564(0x22a)]===!![]?_0x2a6571=_0x1cf564(0x203):_0x2a6571=_0x1cf564(0x205);break;case'CAN':_0x2a6571=_0x1cf564(0x205);break;case _0x1cf564(0x1f8):_0x2a6571='EXPIRED';break;case _0x1cf564(0x215):_0x2a6571='FAILED';!_0x50bea9&&_0x4b44ee['data']?.[_0x1cf564(0x21d)]&&(_0x50bea9=_0x4b44ee[_0x1cf564(0x239)][_0x1cf564(0x21d)]);break;case _0x1cf564(0x228):case'ACT':default:_0x2a6571=_0x1cf564(0x201);break;}break;}const _0x3528d9={};return _0x4b44ee[_0x1cf564(0x239)]?.[_0x1cf564(0x1f3)]?.[_0x1cf564(0x257)]&&(_0x3528d9[_0x1cf564(0x1f5)]=_0x4b44ee['data'][_0x1cf564(0x1f3)][_0x1cf564(0x257)]),_0x4b44ee['data']?.[_0x1cf564(0x237)]&&(_0x3528d9[_0x1cf564(0x1fb)]=_0x4b44ee[_0x1cf564(0x239)]['payment_method_type']),_0x4b44ee['data']?.[_0x1cf564(0x245)]&&(_0x3528d9[_0x1cf564(0x20e)]=_0x4b44ee[_0x1cf564(0x239)]['error_code']),_0x4b44ee['data']?.[_0x1cf564(0x1f1)]&&(_0x3528d9['failureCode']=_0x4b44ee[_0x1cf564(0x239)][_0x1cf564(0x1f1)]),console[_0x1cf564(0x227)](_0x1cf564(0x259)+_0x2a6571+',\x20failureMessage='+(_0x50bea9||'none')),{'paymentId':_0x4b44ee['data']?.[_0x1cf564(0x21e)]||'','status':_0x2a6571,'amount':_0x4b44ee[_0x1cf564(0x239)]?.[_0x1cf564(0x241)],'currency':_0x4b44ee[_0x1cf564(0x239)]?.[_0x1cf564(0x21c)],'failureMessage':_0x50bea9,'additionalInfo':_0x3528d9};}}exports[a45_0x2c9166(0x234)]=RapydService;