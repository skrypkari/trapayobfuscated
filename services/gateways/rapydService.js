'use strict';function a45_0x83b0(){const _0x6881de=['redirect_url','https://tesoft.uk/gateway/rapyd/','logWhiteDomainRequest','):\x20','verifyPayment','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','/v1/hosted/payment_links/','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','status','Status:','PAYMENT_CANCELED','HTTP\x20error!\x20status:\x20','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','stack','type','Unknown\x20error\x20from\x20Rapyd\x20API','toUpperCase','Error\x20details:','text','fromEntries','ACT','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','NEW','Business\x20Error\x20(','410940YgrqpC','Payment\x20Link\x20ID:','failure_code','12cQMcxY','SUCCESS','https://tesoft.uk/gateway/success.php?id=','üí•\x20Rapyd\x20failure\x20message:\x20','gb_visa_card','Response\x20Body:','Error\x20Code:','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','error_code','Raw\x20Response\x20Body:','last4','failureCode','PAYMENT_EXPIRED','logWhiteDomainResponse','Processing\x20Rapyd\x20webhook:','paymentMethod',',\x20failureMessage=','373955GhFAgr','PAYMENT_COMPLETED','stringify','96UXSkEv','JSON\x20Parse\x20Error:\x20','Status\x20Text:',',\x20body:\x20','EXP','406179fOoDCf','FAILED','284625QDaPrH','1017254mPwzxM','POST','===\x20RAPYD\x20SUCCESS\x20===','Unknown\x20error','errorCode','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','CLO','../loggerService','now','Headers:','PAID','402341vtVVLx','logWhiteDomainError','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','Parsed\x20Result:','üá¨üáß\x20Country\x20used:\x20','===\x20RAPYD\x20API\x20ERROR\x20===','ORDER:\x20','error','/v1/hosted/payment_links','UNKNOWN','parse','Rapyd\x20API\x20error:\x20','Error\x20stack:','cardLast4','loggerService','Rapyd\x20payment\x20verification\x20error:','164766LYtDTU','amount','PENDING','data','rapyd','log','GET','\x20(always\x20GB\x20for\x20Rapyd)','CAN','application/json','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','message','EXPIRED','failure_message','\x20(GB\x20-\x20Britain)','payment_method_type','Error\x20Message:','statusText','apiUrl','Response\x20Time:','headers','payment_method_data','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','defineProperty','Rapyd\x20API\x20error\x20(','Request\x20Body\x20(Updated\x20Format):','paid','RapydService','HTTP\x20'];a45_0x83b0=function(){return _0x6881de;};return a45_0x83b0();}const a45_0x5054a3=a45_0x2358;(function(_0x5de6cb,_0xe16fb4){const _0x507a88=a45_0x2358,_0x8dfd49=_0x5de6cb();while(!![]){try{const _0x3b06a9=-parseInt(_0x507a88(0x11e))/0x1+parseInt(_0x507a88(0x12e))/0x2+parseInt(_0x507a88(0x184))/0x3+-parseInt(_0x507a88(0x166))/0x4+parseInt(_0x507a88(0x17a))/0x5*(parseInt(_0x507a88(0x169))/0x6)+-parseInt(_0x507a88(0x185))/0x7+parseInt(_0x507a88(0x17d))/0x8*(parseInt(_0x507a88(0x182))/0x9);if(_0x3b06a9===_0xe16fb4)break;else _0x8dfd49['push'](_0x8dfd49['shift']());}catch(_0x4defaf){_0x8dfd49['push'](_0x8dfd49['shift']());}}}(a45_0x83b0,0x3539e));Object[a45_0x5054a3(0x146)](exports,'__esModule',{'value':!![]}),exports[a45_0x5054a3(0x14a)]=void 0x0;const loggerService_1=require(a45_0x5054a3(0x11a));class RapydService{constructor(){const _0x3f129d=a45_0x5054a3;this[_0x3f129d(0x140)]=_0x3f129d(0x14d),console['log'](_0x3f129d(0x144));}async['createPaymentLink'](_0x5b8160){const _0x2378f3=a45_0x5054a3,{orderId:_0x1432d8,orderName:_0xe6a6d,amount:_0x8d04f5,currency:_0x428dfb,usage:_0x8f1e25,maxPayments:_0x329a9e,successUrl:_0x3f9d7b,failUrl:_0x174f51}=_0x5b8160,_0x7a0638=_0x428dfb[_0x2378f3(0x15e)](),_0x1332d5='GB';console[_0x2378f3(0x133)](_0x2378f3(0x118));const _0x429fad=_0x2378f3(0x16b)+_0x1432d8,_0x1af4fc='https://tesoft.uk/gateway/fail.php?id='+_0x1432d8,_0xc5f3f2={'amount':_0x8d04f5,'currency':_0x7a0638,'cancel_checkout_url':_0x1af4fc,'complete_checkout_url':_0x429fad,'complete_payment_url':_0x429fad,'merchant_reference_id':_0x1432d8,'description':_0x2378f3(0x124)+_0x1432d8,'country':'GB','payment_method_types_include':[_0x2378f3(0x16d),'gb_mastercard_card'],'custom_elements':{'display_description':!![]}},_0x69a6d5=Date['now']();try{console[_0x2378f3(0x133)](_0x2378f3(0x159)),console[_0x2378f3(0x133)]('URL:',this[_0x2378f3(0x140)]),console['log'](_0x2378f3(0x148),JSON[_0x2378f3(0x17c)](_0xc5f3f2,null,0x2)),console['log']('üá¨üáß\x20Country:\x20'+_0x1332d5+_0x2378f3(0x135)),console[_0x2378f3(0x133)](_0x2378f3(0x163)),loggerService_1[_0x2378f3(0x12c)][_0x2378f3(0x14e)](_0x2378f3(0x132),_0x2378f3(0x126),_0x2378f3(0x186),_0xc5f3f2);const _0x724b17=await fetch(this[_0x2378f3(0x140)],{'method':_0x2378f3(0x186),'headers':{'Content-Type':_0x2378f3(0x137),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0xc5f3f2)}),_0x59a5d1=Date[_0x2378f3(0x11b)]()-_0x69a6d5;console[_0x2378f3(0x133)](_0x2378f3(0x151)),console['log'](_0x2378f3(0x156),_0x724b17[_0x2378f3(0x155)]),console[_0x2378f3(0x133)](_0x2378f3(0x17f),_0x724b17[_0x2378f3(0x13f)]),console['log'](_0x2378f3(0x11c),Object[_0x2378f3(0x161)](_0x724b17[_0x2378f3(0x142)]['entries']())),console[_0x2378f3(0x133)](_0x2378f3(0x141),_0x59a5d1+'ms');const _0x221ef3=await _0x724b17[_0x2378f3(0x160)]();console[_0x2378f3(0x133)](_0x2378f3(0x172),_0x221ef3);if(!_0x724b17['ok']){console['error'](_0x2378f3(0x123)),console[_0x2378f3(0x125)]('HTTP\x20Status:',_0x724b17['status']),console[_0x2378f3(0x125)](_0x2378f3(0x16e),_0x221ef3),loggerService_1[_0x2378f3(0x12c)][_0x2378f3(0x176)](_0x2378f3(0x132),_0x2378f3(0x126),_0x724b17[_0x2378f3(0x155)],_0x221ef3,_0x59a5d1),loggerService_1[_0x2378f3(0x12c)][_0x2378f3(0x11f)](_0x2378f3(0x132),_0x2378f3(0x126),_0x2378f3(0x14b)+_0x724b17[_0x2378f3(0x155)]+':\x20'+_0x221ef3);throw new Error(_0x2378f3(0x158)+_0x724b17['status']+_0x2378f3(0x180)+_0x221ef3);}let _0x100afe;try{_0x100afe=JSON[_0x2378f3(0x128)](_0x221ef3);}catch(_0x1dea09){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x1dea09),loggerService_1[_0x2378f3(0x12c)]['logWhiteDomainError'](_0x2378f3(0x132),'/v1/hosted/payment_links',_0x2378f3(0x17e)+_0x1dea09);throw new Error(_0x2378f3(0x170)+_0x221ef3);}console[_0x2378f3(0x133)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console['log'](_0x2378f3(0x121),JSON[_0x2378f3(0x17c)](_0x100afe,null,0x2)),loggerService_1[_0x2378f3(0x12c)]['logWhiteDomainResponse'](_0x2378f3(0x132),_0x2378f3(0x126),_0x724b17[_0x2378f3(0x155)],_0x100afe,_0x59a5d1);if(_0x100afe[_0x2378f3(0x155)]?.[_0x2378f3(0x155)]!==_0x2378f3(0x16a)){const _0x5d0790=_0x100afe[_0x2378f3(0x155)]?.['message']||_0x2378f3(0x15d),_0x345fec=_0x100afe[_0x2378f3(0x155)]?.[_0x2378f3(0x171)]||_0x2378f3(0x127);console[_0x2378f3(0x125)](_0x2378f3(0x138)),console[_0x2378f3(0x125)](_0x2378f3(0x16f),_0x345fec),console[_0x2378f3(0x125)](_0x2378f3(0x13e),_0x5d0790),console['error']('Full\x20Error\x20Data:',_0x100afe[_0x2378f3(0x155)]),loggerService_1[_0x2378f3(0x12c)][_0x2378f3(0x11f)](_0x2378f3(0x132),'/v1/hosted/payment_links',_0x2378f3(0x165)+_0x345fec+'):\x20'+_0x5d0790);throw new Error(_0x2378f3(0x147)+_0x345fec+_0x2378f3(0x14f)+_0x5d0790);}if(!_0x100afe[_0x2378f3(0x131)]?.['id']||!_0x100afe['data']?.[_0x2378f3(0x14c)]){console[_0x2378f3(0x125)]('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2378f3(0x125)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console[_0x2378f3(0x125)]('Response\x20data:',_0x100afe[_0x2378f3(0x131)]),loggerService_1[_0x2378f3(0x12c)][_0x2378f3(0x11f)](_0x2378f3(0x132),_0x2378f3(0x126),_0x2378f3(0x152));throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x2378f3(0x133)](_0x2378f3(0x187)),console[_0x2378f3(0x133)](_0x2378f3(0x167),_0x100afe[_0x2378f3(0x131)]['id']),console[_0x2378f3(0x133)]('Redirect\x20URL:',_0x100afe['data']['redirect_url']),console['log'](_0x2378f3(0x122)+_0x1332d5+_0x2378f3(0x13c)),console[_0x2378f3(0x133)](_0x2378f3(0x163)),{'gateway_payment_id':_0x100afe[_0x2378f3(0x131)]['id'],'payment_url':_0x100afe[_0x2378f3(0x131)][_0x2378f3(0x14c)]};}catch(_0x54f148){console['error'](_0x2378f3(0x145)),console['error'](_0x2378f3(0x15f),_0x54f148),loggerService_1[_0x2378f3(0x12c)]['logWhiteDomainError'](_0x2378f3(0x132),_0x2378f3(0x126),_0x54f148);if(_0x54f148 instanceof Error){console[_0x2378f3(0x125)]('Error\x20message:',_0x54f148[_0x2378f3(0x139)]),console[_0x2378f3(0x125)](_0x2378f3(0x12a),_0x54f148[_0x2378f3(0x15b)]);throw new Error(_0x2378f3(0x120)+_0x54f148[_0x2378f3(0x139)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a45_0x5054a3(0x150)](_0x2d815c){const _0x260b39=a45_0x5054a3,_0xba7f5e=Date[_0x260b39(0x11b)]();try{loggerService_1[_0x260b39(0x12c)][_0x260b39(0x14e)](_0x260b39(0x132),'/v1/hosted/payment_links/'+_0x2d815c,_0x260b39(0x134),{});const _0x492b4f=await fetch(this[_0x260b39(0x140)]+'/'+_0x2d815c,{'method':_0x260b39(0x134),'headers':{'Content-Type':_0x260b39(0x137),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x34fd70=Date[_0x260b39(0x11b)]()-_0xba7f5e;if(!_0x492b4f['ok']){const _0x5b3c63=await _0x492b4f[_0x260b39(0x160)]();loggerService_1[_0x260b39(0x12c)][_0x260b39(0x176)](_0x260b39(0x132),_0x260b39(0x153)+_0x2d815c,_0x492b4f[_0x260b39(0x155)],_0x5b3c63,_0x34fd70);throw new Error('HTTP\x20error!\x20status:\x20'+_0x492b4f[_0x260b39(0x155)]);}const _0x419426=await _0x492b4f['json']();loggerService_1[_0x260b39(0x12c)][_0x260b39(0x176)](_0x260b39(0x132),_0x260b39(0x153)+_0x2d815c,_0x492b4f[_0x260b39(0x155)],_0x419426,_0x34fd70);if(_0x419426[_0x260b39(0x155)]?.[_0x260b39(0x155)]!=='SUCCESS'){loggerService_1[_0x260b39(0x12c)][_0x260b39(0x11f)]('rapyd',_0x260b39(0x153)+_0x2d815c,_0x260b39(0x129)+(_0x419426[_0x260b39(0x155)]?.['message']||_0x260b39(0x116)));throw new Error(_0x260b39(0x129)+(_0x419426['status']?.[_0x260b39(0x139)]||_0x260b39(0x116)));}let _0x1043b1='PENDING';if(_0x419426[_0x260b39(0x131)]?.['status'])switch(_0x419426[_0x260b39(0x131)][_0x260b39(0x155)][_0x260b39(0x15e)]()){case _0x260b39(0x119):_0x1043b1=_0x260b39(0x11d);break;case _0x260b39(0x136):_0x1043b1=_0x260b39(0x183);break;case'EXP':_0x1043b1=_0x260b39(0x13a);break;case'ERR':_0x1043b1=_0x260b39(0x183);break;case _0x260b39(0x164):case _0x260b39(0x162):default:_0x1043b1='PENDING';break;}return{'status':_0x1043b1,'amount':_0x419426[_0x260b39(0x131)]?.['amount'],'currency':_0x419426[_0x260b39(0x131)]?.['currency']};}catch(_0x1d311b){console['error'](_0x260b39(0x12d),_0x1d311b),loggerService_1[_0x260b39(0x12c)][_0x260b39(0x11f)](_0x260b39(0x132),_0x260b39(0x153)+_0x2d815c,_0x1d311b);throw new Error(_0x260b39(0x15a)+(_0x1d311b instanceof Error?_0x1d311b['message']:_0x260b39(0x116)));}}async['processWebhook'](_0x3a2c5c){const _0x161844=a45_0x5054a3;console[_0x161844(0x133)](_0x161844(0x177),_0x3a2c5c);let _0x2a3059=_0x161844(0x130),_0x3bf6f1;_0x3a2c5c[_0x161844(0x131)]?.[_0x161844(0x13b)]&&(_0x3bf6f1=_0x3a2c5c[_0x161844(0x131)][_0x161844(0x13b)],console['log'](_0x161844(0x16c)+_0x3bf6f1));switch(_0x3a2c5c[_0x161844(0x15c)]?.[_0x161844(0x15e)]()){case _0x161844(0x17b):_0x3a2c5c[_0x161844(0x131)]?.['paid']===!![]&&_0x3a2c5c[_0x161844(0x131)]?.['status']===_0x161844(0x119)?_0x2a3059=_0x161844(0x11d):_0x2a3059=_0x161844(0x130);break;case _0x161844(0x157):_0x2a3059=_0x161844(0x183);break;case _0x161844(0x175):_0x2a3059='EXPIRED';break;case'PAYMENT_FAILED':_0x2a3059=_0x161844(0x183);!_0x3bf6f1&&_0x3a2c5c[_0x161844(0x131)]?.[_0x161844(0x13b)]&&(_0x3bf6f1=_0x3a2c5c[_0x161844(0x131)][_0x161844(0x13b)]);break;default:switch(_0x3a2c5c['data']?.[_0x161844(0x155)]?.[_0x161844(0x15e)]()){case _0x161844(0x119):_0x3a2c5c[_0x161844(0x131)]?.[_0x161844(0x149)]===!![]?_0x2a3059=_0x161844(0x11d):_0x2a3059=_0x161844(0x183);break;case _0x161844(0x136):_0x2a3059=_0x161844(0x183);break;case _0x161844(0x181):_0x2a3059='EXPIRED';break;case'ERR':_0x2a3059=_0x161844(0x183);!_0x3bf6f1&&_0x3a2c5c[_0x161844(0x131)]?.['failure_message']&&(_0x3bf6f1=_0x3a2c5c[_0x161844(0x131)][_0x161844(0x13b)]);break;case _0x161844(0x164):case'ACT':default:_0x2a3059='PENDING';break;}break;}const _0x4cd650={};return _0x3a2c5c[_0x161844(0x131)]?.[_0x161844(0x143)]?.[_0x161844(0x173)]&&(_0x4cd650[_0x161844(0x12b)]=_0x3a2c5c[_0x161844(0x131)]['payment_method_data']['last4']),_0x3a2c5c[_0x161844(0x131)]?.[_0x161844(0x13d)]&&(_0x4cd650[_0x161844(0x178)]=_0x3a2c5c['data']['payment_method_type']),_0x3a2c5c[_0x161844(0x131)]?.['error_code']&&(_0x4cd650[_0x161844(0x117)]=_0x3a2c5c[_0x161844(0x131)][_0x161844(0x171)]),_0x3a2c5c[_0x161844(0x131)]?.[_0x161844(0x168)]&&(_0x4cd650[_0x161844(0x174)]=_0x3a2c5c[_0x161844(0x131)]['failure_code']),console[_0x161844(0x133)](_0x161844(0x154)+_0x2a3059+_0x161844(0x179)+(_0x3bf6f1||'none')),{'paymentId':_0x3a2c5c[_0x161844(0x131)]?.['merchant_reference_id']||'','status':_0x2a3059,'amount':_0x3a2c5c[_0x161844(0x131)]?.[_0x161844(0x12f)],'currency':_0x3a2c5c['data']?.['currency'],'failureMessage':_0x3bf6f1,'additionalInfo':_0x4cd650};}}function a45_0x2358(_0x3b6e73,_0x3b152a){const _0x83b072=a45_0x83b0();return a45_0x2358=function(_0x2358c7,_0x40a83c){_0x2358c7=_0x2358c7-0x116;let _0x5a90e5=_0x83b072[_0x2358c7];return _0x5a90e5;},a45_0x2358(_0x3b6e73,_0x3b152a);}exports[a45_0x5054a3(0x14a)]=RapydService;