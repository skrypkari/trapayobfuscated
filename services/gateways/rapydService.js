'use strict';const a46_0x273b62=a46_0x3b96;function a46_0x3b96(_0x5d0ac4,_0x41aa56){const _0x3f7197=a46_0x3f71();return a46_0x3b96=function(_0x3b96fd,_0x2d68a5){_0x3b96fd=_0x3b96fd-0x123;let _0x37947f=_0x3f7197[_0x3b96fd];return _0x37947f;},a46_0x3b96(_0x5d0ac4,_0x41aa56);}(function(_0x15b0ad,_0x349e1a){const _0x1c09e5=a46_0x3b96,_0x13cca3=_0x15b0ad();while(!![]){try{const _0x590799=parseInt(_0x1c09e5(0x15c))/0x1*(parseInt(_0x1c09e5(0x17b))/0x2)+-parseInt(_0x1c09e5(0x169))/0x3*(-parseInt(_0x1c09e5(0x139))/0x4)+-parseInt(_0x1c09e5(0x123))/0x5+-parseInt(_0x1c09e5(0x17e))/0x6+-parseInt(_0x1c09e5(0x145))/0x7+-parseInt(_0x1c09e5(0x188))/0x8+parseInt(_0x1c09e5(0x161))/0x9;if(_0x590799===_0x349e1a)break;else _0x13cca3['push'](_0x13cca3['shift']());}catch(_0x4e1f72){_0x13cca3['push'](_0x13cca3['shift']());}}}(a46_0x3f71,0x424a4));function a46_0x3f71(){const _0x5742f7=['application/json','data','HTTP\x20error!\x20status:\x20','type','/v1/hosted/payment_links','entries','https://tesoft.uk/gateway/success.php?id=','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','failure_message','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Full\x20Error\x20Data:','statusText','toUpperCase','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','CLO','log','124427AraENN','last4','Payment\x20Link\x20ID:','ERR','https://tesoft.uk/gateway/rapyd/','12939543gjMlbv','error_code','message',',\x20body:\x20','Unknown\x20error\x20from\x20Rapyd\x20API','gb_mastercard_card','CAN','HTTP\x20Status:','789eHoNkM','PAYMENT_EXPIRED','Headers:','EXPIRED','RapydService','URL:','gb_visa_card','GET','PENDING','Error\x20Code:','Rapyd\x20payment\x20verification\x20error:','errorCode','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','paid','loggerService','Error\x20Message:','Business\x20Error\x20(','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','2LDHaZr','__esModule','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','2681904zKzvFf','stringify','Response\x20Time:','now','Rapyd\x20API\x20error:\x20','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','stack','failure_code','merchant_reference_id','ORDER:\x20','3387352Ucowhh','currency',',\x20failureMessage=','payment_method_type','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','text','rapyd','Unknown\x20error','Response\x20Body:','üá¨üáß\x20Country\x20used:\x20','logWhiteDomainResponse','none','Request\x20Body\x20(Updated\x20Format):','SUCCESS','/v1/hosted/payment_links/','paymentMethod','Error\x20details:','amount','1159660uMniUU','NEW','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','createPaymentLink','logWhiteDomainRequest','Redirect\x20URL:','===\x20RAPYD\x20API\x20ERROR\x20===','../loggerService','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','UNKNOWN','Error\x20stack:','Rapyd\x20API\x20error\x20(','payment_method_data','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','status','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','PAID','PAYMENT_COMPLETED','parse','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','üá¨üáß\x20Country:\x20','üí•\x20Rapyd\x20failure\x20message:\x20','4304IBSgeD','processWebhook','===\x20RAPYD\x20SUCCESS\x20===','PAYMENT_FAILED','defineProperty','apiUrl','HTTP\x20','Raw\x20Response\x20Body:','FAILED','cardLast4','logWhiteDomainError','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','3298981vkTXGq','fromEntries','error','TesSoft\x20Payment\x20System/1.0','redirect_url','Parsed\x20Result:','EXP'];a46_0x3f71=function(){return _0x5742f7;};return a46_0x3f71();}Object[a46_0x273b62(0x13d)](exports,a46_0x273b62(0x17c),{'value':!![]}),exports[a46_0x273b62(0x16d)]=void 0x0;const loggerService_1=require(a46_0x273b62(0x12a));class RapydService{constructor(){const _0x37b771=a46_0x273b62;this[_0x37b771(0x13e)]=_0x37b771(0x160),console['log'](_0x37b771(0x17a));}async[a46_0x273b62(0x126)](_0x1f50af){const _0x53bc99=a46_0x273b62,{orderId:_0x5937c7,orderName:_0x226e7a,amount:_0x5ee808,currency:_0x4fc580,usage:_0x37c553,maxPayments:_0x16c2f5,successUrl:_0x1bfc23,failUrl:_0x59b7a1}=_0x1f50af,_0x213871=_0x4fc580[_0x53bc99(0x158)](),_0x982f7='GB';console[_0x53bc99(0x15b)](_0x53bc99(0x132));const _0x33302c=_0x53bc99(0x152)+_0x5937c7,_0x594324='https://tesoft.uk/gateway/fail.php?id='+_0x5937c7,_0x2e7214={'amount':_0x5ee808,'currency':_0x213871,'cancel_checkout_url':_0x594324,'complete_checkout_url':_0x33302c,'complete_payment_url':_0x33302c,'merchant_reference_id':_0x5937c7,'description':_0x53bc99(0x187)+_0x5937c7,'country':'GB','payment_method_types_include':[_0x53bc99(0x16f),_0x53bc99(0x166)],'custom_elements':{'display_description':!![]}},_0xfe5657=Date[_0x53bc99(0x181)]();try{console['log'](_0x53bc99(0x125)),console[_0x53bc99(0x15b)](_0x53bc99(0x16e),this[_0x53bc99(0x13e)]),console[_0x53bc99(0x15b)](_0x53bc99(0x194),JSON[_0x53bc99(0x17f)](_0x2e7214,null,0x2)),console[_0x53bc99(0x15b)](_0x53bc99(0x137)+_0x982f7+'\x20(always\x20GB\x20for\x20Rapyd)'),console['log'](_0x53bc99(0x12b)),loggerService_1['loggerService'][_0x53bc99(0x127)](_0x53bc99(0x18e),'/v1/hosted/payment_links','POST',_0x2e7214);const _0x43f26f=await fetch(this[_0x53bc99(0x13e)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x53bc99(0x148)},'body':JSON[_0x53bc99(0x17f)](_0x2e7214)}),_0x4a6055=Date[_0x53bc99(0x181)]()-_0xfe5657;console[_0x53bc99(0x15b)]('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x53bc99(0x15b)]('Status:',_0x43f26f[_0x53bc99(0x131)]),console[_0x53bc99(0x15b)]('Status\x20Text:',_0x43f26f[_0x53bc99(0x157)]),console[_0x53bc99(0x15b)](_0x53bc99(0x16b),Object[_0x53bc99(0x146)](_0x43f26f['headers'][_0x53bc99(0x151)]())),console[_0x53bc99(0x15b)](_0x53bc99(0x180),_0x4a6055+'ms');const _0x24bb4c=await _0x43f26f['text']();console[_0x53bc99(0x15b)](_0x53bc99(0x140),_0x24bb4c);if(!_0x43f26f['ok']){console['error'](_0x53bc99(0x129)),console['error'](_0x53bc99(0x168),_0x43f26f['status']),console[_0x53bc99(0x147)](_0x53bc99(0x190),_0x24bb4c),loggerService_1[_0x53bc99(0x177)][_0x53bc99(0x192)](_0x53bc99(0x18e),_0x53bc99(0x150),_0x43f26f[_0x53bc99(0x131)],_0x24bb4c,_0x4a6055),loggerService_1[_0x53bc99(0x177)][_0x53bc99(0x143)](_0x53bc99(0x18e),'/v1/hosted/payment_links',_0x53bc99(0x13f)+_0x43f26f[_0x53bc99(0x131)]+':\x20'+_0x24bb4c);throw new Error('HTTP\x20error!\x20status:\x20'+_0x43f26f['status']+_0x53bc99(0x164)+_0x24bb4c);}let _0x53d18c;try{_0x53d18c=JSON[_0x53bc99(0x135)](_0x24bb4c);}catch(_0x24102d){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x24102d),loggerService_1[_0x53bc99(0x177)][_0x53bc99(0x143)](_0x53bc99(0x18e),_0x53bc99(0x150),'JSON\x20Parse\x20Error:\x20'+_0x24102d);throw new Error(_0x53bc99(0x153)+_0x24bb4c);}console[_0x53bc99(0x15b)](_0x53bc99(0x183)),console[_0x53bc99(0x15b)](_0x53bc99(0x14a),JSON['stringify'](_0x53d18c,null,0x2)),loggerService_1['loggerService'][_0x53bc99(0x192)]('rapyd',_0x53bc99(0x150),_0x43f26f[_0x53bc99(0x131)],_0x53d18c,_0x4a6055);if(_0x53d18c['status']?.[_0x53bc99(0x131)]!==_0x53bc99(0x195)){const _0x1d91fd=_0x53d18c[_0x53bc99(0x131)]?.[_0x53bc99(0x163)]||_0x53bc99(0x165),_0x14d120=_0x53d18c[_0x53bc99(0x131)]?.[_0x53bc99(0x162)]||_0x53bc99(0x12c);console['error'](_0x53bc99(0x18c)),console[_0x53bc99(0x147)](_0x53bc99(0x172),_0x14d120),console['error'](_0x53bc99(0x178),_0x1d91fd),console['error'](_0x53bc99(0x156),_0x53d18c['status']),loggerService_1[_0x53bc99(0x177)][_0x53bc99(0x143)](_0x53bc99(0x18e),'/v1/hosted/payment_links',_0x53bc99(0x179)+_0x14d120+'):\x20'+_0x1d91fd);throw new Error(_0x53bc99(0x12e)+_0x14d120+'):\x20'+_0x1d91fd);}if(!_0x53d18c['data']?.['id']||!_0x53d18c[_0x53bc99(0x14d)]?.[_0x53bc99(0x149)]){console[_0x53bc99(0x147)](_0x53bc99(0x144)),console[_0x53bc99(0x147)](_0x53bc99(0x155)),console['error']('Response\x20data:',_0x53d18c[_0x53bc99(0x14d)]),loggerService_1[_0x53bc99(0x177)][_0x53bc99(0x143)](_0x53bc99(0x18e),_0x53bc99(0x150),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x53bc99(0x175));}return console['log'](_0x53bc99(0x13b)),console[_0x53bc99(0x15b)](_0x53bc99(0x15e),_0x53d18c[_0x53bc99(0x14d)]['id']),console[_0x53bc99(0x15b)](_0x53bc99(0x128),_0x53d18c[_0x53bc99(0x14d)][_0x53bc99(0x149)]),console[_0x53bc99(0x15b)](_0x53bc99(0x191)+_0x982f7+'\x20(GB\x20-\x20Britain)'),console['log'](_0x53bc99(0x12b)),{'gateway_payment_id':_0x53d18c[_0x53bc99(0x14d)]['id'],'payment_url':_0x53d18c['data'][_0x53bc99(0x149)]};}catch(_0x599001){console[_0x53bc99(0x147)](_0x53bc99(0x136)),console[_0x53bc99(0x147)](_0x53bc99(0x198),_0x599001),loggerService_1[_0x53bc99(0x177)][_0x53bc99(0x143)]('rapyd',_0x53bc99(0x150),_0x599001);if(_0x599001 instanceof Error){console[_0x53bc99(0x147)]('Error\x20message:',_0x599001[_0x53bc99(0x163)]),console[_0x53bc99(0x147)](_0x53bc99(0x12d),_0x599001[_0x53bc99(0x184)]);throw new Error(_0x53bc99(0x17d)+_0x599001[_0x53bc99(0x163)]);}throw new Error(_0x53bc99(0x130));}}async['verifyPayment'](_0x74bd97){const _0x296639=a46_0x273b62,_0x5ad197=Date['now']();try{loggerService_1[_0x296639(0x177)][_0x296639(0x127)](_0x296639(0x18e),_0x296639(0x196)+_0x74bd97,'GET',{});const _0x35fbfc=await fetch(this['apiUrl']+'/'+_0x74bd97,{'method':_0x296639(0x170),'headers':{'Content-Type':_0x296639(0x14c),'User-Agent':_0x296639(0x148)}}),_0x4c8b9e=Date[_0x296639(0x181)]()-_0x5ad197;if(!_0x35fbfc['ok']){const _0x2fe6d1=await _0x35fbfc[_0x296639(0x18d)]();loggerService_1[_0x296639(0x177)][_0x296639(0x192)](_0x296639(0x18e),_0x296639(0x196)+_0x74bd97,_0x35fbfc['status'],_0x2fe6d1,_0x4c8b9e);throw new Error(_0x296639(0x14e)+_0x35fbfc[_0x296639(0x131)]);}const _0x55d5af=await _0x35fbfc['json']();loggerService_1['loggerService'][_0x296639(0x192)](_0x296639(0x18e),_0x296639(0x196)+_0x74bd97,_0x35fbfc[_0x296639(0x131)],_0x55d5af,_0x4c8b9e);if(_0x55d5af['status']?.[_0x296639(0x131)]!=='SUCCESS'){loggerService_1[_0x296639(0x177)][_0x296639(0x143)](_0x296639(0x18e),_0x296639(0x196)+_0x74bd97,_0x296639(0x182)+(_0x55d5af[_0x296639(0x131)]?.[_0x296639(0x163)]||_0x296639(0x18f)));throw new Error(_0x296639(0x182)+(_0x55d5af[_0x296639(0x131)]?.[_0x296639(0x163)]||'Unknown\x20error'));}let _0x472e1a=_0x296639(0x171);if(_0x55d5af[_0x296639(0x14d)]?.[_0x296639(0x131)])switch(_0x55d5af[_0x296639(0x14d)][_0x296639(0x131)]['toUpperCase']()){case _0x296639(0x15a):_0x472e1a=_0x296639(0x133);break;case _0x296639(0x167):_0x472e1a=_0x296639(0x141);break;case _0x296639(0x14b):_0x472e1a=_0x296639(0x16c);break;case _0x296639(0x15f):_0x472e1a='FAILED';break;case _0x296639(0x124):case'ACT':default:_0x472e1a=_0x296639(0x171);break;}return{'status':_0x472e1a,'amount':_0x55d5af[_0x296639(0x14d)]?.[_0x296639(0x199)],'currency':_0x55d5af[_0x296639(0x14d)]?.[_0x296639(0x189)]};}catch(_0x483cad){console['error'](_0x296639(0x173),_0x483cad),loggerService_1[_0x296639(0x177)][_0x296639(0x143)](_0x296639(0x18e),_0x296639(0x196)+_0x74bd97,_0x483cad);throw new Error(_0x296639(0x159)+(_0x483cad instanceof Error?_0x483cad[_0x296639(0x163)]:_0x296639(0x18f)));}}async[a46_0x273b62(0x13a)](_0x9da92){const _0x124127=a46_0x273b62;console['log']('Processing\x20Rapyd\x20webhook:',_0x9da92);let _0x405146=_0x124127(0x171),_0xffed70;_0x9da92[_0x124127(0x14d)]?.[_0x124127(0x154)]&&(_0xffed70=_0x9da92[_0x124127(0x14d)]['failure_message'],console['log'](_0x124127(0x138)+_0xffed70));switch(_0x9da92[_0x124127(0x14f)]?.[_0x124127(0x158)]()){case _0x124127(0x134):_0x9da92[_0x124127(0x14d)]?.['paid']===!![]&&_0x9da92[_0x124127(0x14d)]?.[_0x124127(0x131)]===_0x124127(0x15a)?_0x405146=_0x124127(0x133):_0x405146='PENDING';break;case'PAYMENT_CANCELED':_0x405146=_0x124127(0x141);break;case _0x124127(0x16a):_0x405146=_0x124127(0x16c);break;case _0x124127(0x13c):_0x405146='FAILED';!_0xffed70&&_0x9da92[_0x124127(0x14d)]?.[_0x124127(0x154)]&&(_0xffed70=_0x9da92[_0x124127(0x14d)][_0x124127(0x154)]);break;default:switch(_0x9da92[_0x124127(0x14d)]?.[_0x124127(0x131)]?.[_0x124127(0x158)]()){case _0x124127(0x15a):_0x9da92[_0x124127(0x14d)]?.[_0x124127(0x176)]===!![]?_0x405146=_0x124127(0x133):_0x405146='FAILED';break;case _0x124127(0x167):_0x405146=_0x124127(0x141);break;case _0x124127(0x14b):_0x405146=_0x124127(0x16c);break;case _0x124127(0x15f):_0x405146=_0x124127(0x141);!_0xffed70&&_0x9da92[_0x124127(0x14d)]?.[_0x124127(0x154)]&&(_0xffed70=_0x9da92['data'][_0x124127(0x154)]);break;case _0x124127(0x124):case'ACT':default:_0x405146=_0x124127(0x171);break;}break;}const _0x1f7d5f={};return _0x9da92[_0x124127(0x14d)]?.[_0x124127(0x12f)]?.[_0x124127(0x15d)]&&(_0x1f7d5f[_0x124127(0x142)]=_0x9da92[_0x124127(0x14d)][_0x124127(0x12f)]['last4']),_0x9da92[_0x124127(0x14d)]?.[_0x124127(0x18b)]&&(_0x1f7d5f[_0x124127(0x197)]=_0x9da92[_0x124127(0x14d)]['payment_method_type']),_0x9da92['data']?.[_0x124127(0x162)]&&(_0x1f7d5f[_0x124127(0x174)]=_0x9da92[_0x124127(0x14d)][_0x124127(0x162)]),_0x9da92[_0x124127(0x14d)]?.[_0x124127(0x185)]&&(_0x1f7d5f['failureCode']=_0x9da92['data'][_0x124127(0x185)]),console[_0x124127(0x15b)]('üîÑ\x20Rapyd\x20webhook\x20processed:\x20status='+_0x405146+_0x124127(0x18a)+(_0xffed70||_0x124127(0x193))),{'paymentId':_0x9da92[_0x124127(0x14d)]?.[_0x124127(0x186)]||'','status':_0x405146,'amount':_0x9da92['data']?.[_0x124127(0x199)],'currency':_0x9da92['data']?.[_0x124127(0x189)],'failureMessage':_0xffed70,'additionalInfo':_0x1f7d5f};}}exports[a46_0x273b62(0x16d)]=RapydService;