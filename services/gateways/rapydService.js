'use strict';const a52_0x28d90a=a52_0x4d83;function a52_0x120e(){const _0x2ee1e8=['===\x20RAPYD\x20API\x20ERROR\x20===','GET','verifyPayment','failure_message','1922616YiatXd','FAILED','1093864WsfziR','Failed\x20to\x20parse\x20JSON\x20response:','buy','Error\x20details:','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','üí•\x20Rapyd\x20failure\x20message:\x20','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','headers','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','log','EXP','now','Payment\x20System/1.0','loggerService','https://tesoft.uk/gateway/success.php?id=','rapyd','9rAviMG','ACT','Unknown\x20error\x20from\x20Rapyd\x20API','HTTP\x20error!\x20status:\x20','requested_currency','\x20->\x20EUR:','toUpperCase','Raw\x20Response\x20Body:','Rapyd\x20API\x20error:\x20','CAN','gb_mastercard_card','logWhiteDomainResponse','URL:','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','POST','logWhiteDomainError','===\x20RAPYD\x20SUCCESS\x20===','Full\x20Error\x20Data:','failureCode','UNKNOWN','Status\x20Text:','PAYMENT_COMPLETED','\x20\x20\x20fixed_side:\x20buy','stringify','https://tesoft.uk/gateway/rapyd/','error_code','EUR','PAYMENT_EXPIRED','Processing\x20Rapyd\x20webhook:','currency','/v1/hosted/payment_links/','811828yVtnuC','type','createPaymentLink','RapydService','NEW','PAYMENT_FAILED','HTTP\x20Status:','Response\x20Body:','Status:','/v1/hosted/payment_links','last4','8Lzuedi','defineProperty','SUCCESS','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','payment_method_type','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','CLO','https://tesoft.uk/gateway/fail.php?id=','1672455tILMSv','Rapyd\x20payment\x20verification\x20error:','Redirect\x20URL:','ERR','data','ORDER:\x20','amount','Rapyd\x20API\x20error\x20(','Response\x20Time:','PAID','logWhiteDomainRequest','failure_code','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','\x20(GB\x20-\x20Britain)','üá¨üáß\x20Country:\x20','status','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','entries','statusText','fixed_side','PAYMENT_CANCELED','üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','merchant_reference_id','json','errorCode','652884OaPMdl','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','998613OheDyk','paymentMethod','error','15HmkFBJ','__esModule','toISOString','\x20(always\x20GB\x20for\x20Rapyd)','stack','payment_method_data','text','cardLast4','üá¨üáß\x20Country\x20used:\x20','parse','\x20\x20\x20expiration:\x20','):\x20','EXPIRED','redirect_url','apiUrl','Error\x20Code:','paid','PENDING',',\x20failureMessage=','Error\x20stack:','message','application/json','1639430jHaBDa','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','Payment\x20Link\x20ID:'];a52_0x120e=function(){return _0x2ee1e8;};return a52_0x120e();}function a52_0x4d83(_0x44a40d,_0x1dbca4){const _0x120ee0=a52_0x120e();return a52_0x4d83=function(_0x4d8382,_0x57574c){_0x4d8382=_0x4d8382-0xf5;let _0x223a88=_0x120ee0[_0x4d8382];return _0x223a88;},a52_0x4d83(_0x44a40d,_0x1dbca4);}(function(_0x12471e,_0x1a2149){const _0x1cc2b5=a52_0x4d83,_0x392c71=_0x12471e();while(!![]){try{const _0x190684=parseInt(_0x1cc2b5(0x16e))/0x1+parseInt(_0x1cc2b5(0x113))/0x2+-parseInt(_0x1cc2b5(0x155))/0x3+parseInt(_0x1cc2b5(0x142))/0x4*(-parseInt(_0x1cc2b5(0x174))/0x5)+parseInt(_0x1cc2b5(0x111))/0x6+parseInt(_0x1cc2b5(0x171))/0x7*(parseInt(_0x1cc2b5(0x14d))/0x8)+-parseInt(_0x1cc2b5(0x123))/0x9*(parseInt(_0x1cc2b5(0x10a))/0xa);if(_0x190684===_0x1a2149)break;else _0x392c71['push'](_0x392c71['shift']());}catch(_0x1c701e){_0x392c71['push'](_0x392c71['shift']());}}}(a52_0x120e,0x51344));Object[a52_0x28d90a(0x14e)](exports,a52_0x28d90a(0xf5),{'value':!![]}),exports[a52_0x28d90a(0x145)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x1a29fe=a52_0x28d90a;this[_0x1a29fe(0x102)]=_0x1a29fe(0x13b),console[_0x1a29fe(0x11c)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a52_0x28d90a(0x144)](_0x540b43){const _0x2f970b=a52_0x28d90a,{orderId:_0x527c6f,orderName:_0x34a895,amount:_0x3e51ec,currency:_0x315136,usage:_0xb8aee0,maxPayments:_0x4f0ff4,successUrl:_0x41ce02,failUrl:_0x5a8a7a}=_0x540b43,_0x2fee97=_0x315136[_0x2f970b(0x129)](),_0x54caea='GB';console['log'](_0x2f970b(0x130));const _0x40da66=_0x2f970b(0x121)+_0x527c6f,_0x402b43=_0x2f970b(0x154)+_0x527c6f,_0x46a703={'amount':_0x3e51ec,'currency':_0x2fee97,'cancel_checkout_url':_0x402b43,'complete_checkout_url':_0x40da66,'complete_payment_url':_0x40da66,'merchant_reference_id':_0x527c6f,'description':_0x2f970b(0x15a)+_0x527c6f,'country':'GB','payment_method_types_include':['gb_visa_card',_0x2f970b(0x12d)],'custom_elements':{'display_description':!![]}};if(_0x2fee97!==_0x2f970b(0x13d)){const _0x24d342=Math['floor'](Date[_0x2f970b(0x11e)]()/0x3e8)+0x1e*0x3c;_0x46a703[_0x2f970b(0x168)]=_0x2f970b(0x115),_0x46a703[_0x2f970b(0x127)]='EUR',_0x46a703['expiration']=_0x24d342,console[_0x2f970b(0x11c)](_0x2f970b(0x16a)+_0x2fee97+_0x2f970b(0x128)),console[_0x2f970b(0x11c)](_0x2f970b(0x139)),console['log']('\x20\x20\x20requested_currency:\x20EUR'),console[_0x2f970b(0x11c)](_0x2f970b(0xfe)+_0x24d342+'\x20('+new Date(_0x24d342*0x3e8)[_0x2f970b(0xf6)]()+')');}const _0x5f16ad=Date['now']();try{console['log']('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x2f970b(0x11c)](_0x2f970b(0x12f),this[_0x2f970b(0x102)]),console['log']('Request\x20Body\x20(Updated\x20Format):',JSON['stringify'](_0x46a703,null,0x2)),console[_0x2f970b(0x11c)](_0x2f970b(0x163)+_0x54caea+_0x2f970b(0xf7)),console[_0x2f970b(0x11c)](_0x2f970b(0x119)),loggerService_1['loggerService'][_0x2f970b(0x15f)](_0x2f970b(0x122),_0x2f970b(0x14b),_0x2f970b(0x131),_0x46a703);const _0x365fdf=await fetch(this[_0x2f970b(0x102)],{'method':_0x2f970b(0x131),'headers':{'Content-Type':'application/json','User-Agent':_0x2f970b(0x11f)},'body':JSON[_0x2f970b(0x13a)](_0x46a703)}),_0x3a7381=Date['now']()-_0x5f16ad;console[_0x2f970b(0x11c)]('===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x2f970b(0x14a),_0x365fdf[_0x2f970b(0x164)]),console[_0x2f970b(0x11c)](_0x2f970b(0x137),_0x365fdf[_0x2f970b(0x167)]),console[_0x2f970b(0x11c)]('Headers:',Object['fromEntries'](_0x365fdf[_0x2f970b(0x11a)][_0x2f970b(0x166)]())),console['log'](_0x2f970b(0x15d),_0x3a7381+'ms');const _0x1b5b03=await _0x365fdf[_0x2f970b(0xfa)]();console[_0x2f970b(0x11c)](_0x2f970b(0x12a),_0x1b5b03);if(!_0x365fdf['ok']){console['error'](_0x2f970b(0x10d)),console['error'](_0x2f970b(0x148),_0x365fdf['status']),console[_0x2f970b(0x173)](_0x2f970b(0x149),_0x1b5b03),loggerService_1[_0x2f970b(0x120)][_0x2f970b(0x12e)](_0x2f970b(0x122),_0x2f970b(0x14b),_0x365fdf['status'],_0x1b5b03,_0x3a7381),loggerService_1['loggerService'][_0x2f970b(0x132)](_0x2f970b(0x122),_0x2f970b(0x14b),'HTTP\x20'+_0x365fdf[_0x2f970b(0x164)]+':\x20'+_0x1b5b03);throw new Error(_0x2f970b(0x126)+_0x365fdf['status']+',\x20body:\x20'+_0x1b5b03);}let _0x5700ce;try{_0x5700ce=JSON[_0x2f970b(0xfd)](_0x1b5b03);}catch(_0x12d10a){console[_0x2f970b(0x173)](_0x2f970b(0x114),_0x12d10a),loggerService_1[_0x2f970b(0x120)][_0x2f970b(0x132)](_0x2f970b(0x122),'/v1/hosted/payment_links','JSON\x20Parse\x20Error:\x20'+_0x12d10a);throw new Error('Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20'+_0x1b5b03);}console['log']('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console['log']('Parsed\x20Result:',JSON['stringify'](_0x5700ce,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2f970b(0x122),_0x2f970b(0x14b),_0x365fdf[_0x2f970b(0x164)],_0x5700ce,_0x3a7381);if(_0x5700ce[_0x2f970b(0x164)]?.[_0x2f970b(0x164)]!==_0x2f970b(0x14f)){const _0x4aa864=_0x5700ce[_0x2f970b(0x164)]?.['message']||_0x2f970b(0x125),_0x1ab0ec=_0x5700ce[_0x2f970b(0x164)]?.['error_code']||_0x2f970b(0x136);console[_0x2f970b(0x173)](_0x2f970b(0x16f)),console['error'](_0x2f970b(0x103),_0x1ab0ec),console[_0x2f970b(0x173)]('Error\x20Message:',_0x4aa864),console[_0x2f970b(0x173)](_0x2f970b(0x134),_0x5700ce['status']),loggerService_1[_0x2f970b(0x120)][_0x2f970b(0x132)](_0x2f970b(0x122),'/v1/hosted/payment_links','Business\x20Error\x20('+_0x1ab0ec+_0x2f970b(0xff)+_0x4aa864);throw new Error(_0x2f970b(0x15c)+_0x1ab0ec+_0x2f970b(0xff)+_0x4aa864);}if(!_0x5700ce[_0x2f970b(0x159)]?.['id']||!_0x5700ce[_0x2f970b(0x159)]?.[_0x2f970b(0x101)]){console[_0x2f970b(0x173)](_0x2f970b(0x170)),console[_0x2f970b(0x173)]('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console[_0x2f970b(0x173)]('Response\x20data:',_0x5700ce[_0x2f970b(0x159)]),loggerService_1[_0x2f970b(0x120)]['logWhiteDomainError'](_0x2f970b(0x122),_0x2f970b(0x14b),_0x2f970b(0x10b));throw new Error(_0x2f970b(0x150));}return console[_0x2f970b(0x11c)](_0x2f970b(0x133)),console[_0x2f970b(0x11c)](_0x2f970b(0x10c),_0x5700ce[_0x2f970b(0x159)]['id']),console[_0x2f970b(0x11c)](_0x2f970b(0x157),_0x5700ce[_0x2f970b(0x159)]['redirect_url']),console[_0x2f970b(0x11c)](_0x2f970b(0xfc)+_0x54caea+_0x2f970b(0x162)),console[_0x2f970b(0x11c)](_0x2f970b(0x119)),{'gateway_payment_id':_0x5700ce[_0x2f970b(0x159)]['id'],'payment_url':_0x5700ce[_0x2f970b(0x159)][_0x2f970b(0x101)]};}catch(_0x4ef88e){console[_0x2f970b(0x173)](_0x2f970b(0x117)),console[_0x2f970b(0x173)](_0x2f970b(0x116),_0x4ef88e),loggerService_1['loggerService'][_0x2f970b(0x132)](_0x2f970b(0x122),_0x2f970b(0x14b),_0x4ef88e);if(_0x4ef88e instanceof Error){console[_0x2f970b(0x173)]('Error\x20message:',_0x4ef88e[_0x2f970b(0x108)]),console[_0x2f970b(0x173)](_0x2f970b(0x107),_0x4ef88e[_0x2f970b(0xf8)]);throw new Error(_0x2f970b(0x152)+_0x4ef88e['message']);}throw new Error(_0x2f970b(0x165));}}async[a52_0x28d90a(0x10f)](_0x2305b6){const _0x33d5ed=a52_0x28d90a,_0x296688=Date[_0x33d5ed(0x11e)]();try{loggerService_1[_0x33d5ed(0x120)]['logWhiteDomainRequest'](_0x33d5ed(0x122),'/v1/hosted/payment_links/'+_0x2305b6,_0x33d5ed(0x10e),{});const _0x33e835=await fetch(this[_0x33d5ed(0x102)]+'/'+_0x2305b6,{'method':_0x33d5ed(0x10e),'headers':{'Content-Type':_0x33d5ed(0x109),'User-Agent':'Payment\x20System/1.0'}}),_0x160b1d=Date['now']()-_0x296688;if(!_0x33e835['ok']){const _0x9d438f=await _0x33e835[_0x33d5ed(0xfa)]();loggerService_1[_0x33d5ed(0x120)][_0x33d5ed(0x12e)](_0x33d5ed(0x122),_0x33d5ed(0x141)+_0x2305b6,_0x33e835['status'],_0x9d438f,_0x160b1d);throw new Error(_0x33d5ed(0x126)+_0x33e835[_0x33d5ed(0x164)]);}const _0x13af39=await _0x33e835[_0x33d5ed(0x16c)]();loggerService_1[_0x33d5ed(0x120)][_0x33d5ed(0x12e)](_0x33d5ed(0x122),_0x33d5ed(0x141)+_0x2305b6,_0x33e835[_0x33d5ed(0x164)],_0x13af39,_0x160b1d);if(_0x13af39[_0x33d5ed(0x164)]?.['status']!==_0x33d5ed(0x14f)){loggerService_1[_0x33d5ed(0x120)][_0x33d5ed(0x132)]('rapyd',_0x33d5ed(0x141)+_0x2305b6,_0x33d5ed(0x12b)+(_0x13af39['status']?.[_0x33d5ed(0x108)]||'Unknown\x20error'));throw new Error('Rapyd\x20API\x20error:\x20'+(_0x13af39[_0x33d5ed(0x164)]?.['message']||'Unknown\x20error'));}let _0x464385=_0x33d5ed(0x105);if(_0x13af39[_0x33d5ed(0x159)]?.[_0x33d5ed(0x164)])switch(_0x13af39['data']['status'][_0x33d5ed(0x129)]()){case _0x33d5ed(0x153):_0x464385='PAID';break;case _0x33d5ed(0x12c):_0x464385=_0x33d5ed(0x112);break;case _0x33d5ed(0x11d):_0x464385=_0x33d5ed(0x100);break;case _0x33d5ed(0x158):_0x464385=_0x33d5ed(0x112);break;case _0x33d5ed(0x146):case _0x33d5ed(0x124):default:_0x464385=_0x33d5ed(0x105);break;}return{'status':_0x464385,'amount':_0x13af39[_0x33d5ed(0x159)]?.[_0x33d5ed(0x15b)],'currency':_0x13af39['data']?.[_0x33d5ed(0x140)]};}catch(_0x7bf7a3){console[_0x33d5ed(0x173)](_0x33d5ed(0x156),_0x7bf7a3),loggerService_1[_0x33d5ed(0x120)][_0x33d5ed(0x132)](_0x33d5ed(0x122),_0x33d5ed(0x141)+_0x2305b6,_0x7bf7a3);throw new Error(_0x33d5ed(0x11b)+(_0x7bf7a3 instanceof Error?_0x7bf7a3[_0x33d5ed(0x108)]:'Unknown\x20error'));}}async['processWebhook'](_0x80764c){const _0x261c40=a52_0x28d90a;console[_0x261c40(0x11c)](_0x261c40(0x13f),_0x80764c);let _0x3ddf5e=_0x261c40(0x105),_0xc3d16a;_0x80764c[_0x261c40(0x159)]?.['failure_message']&&(_0xc3d16a=_0x80764c['data']['failure_message'],console[_0x261c40(0x11c)](_0x261c40(0x118)+_0xc3d16a));switch(_0x80764c[_0x261c40(0x143)]?.[_0x261c40(0x129)]()){case _0x261c40(0x138):_0x80764c[_0x261c40(0x159)]?.[_0x261c40(0x104)]===!![]&&_0x80764c[_0x261c40(0x159)]?.[_0x261c40(0x164)]===_0x261c40(0x153)?_0x3ddf5e=_0x261c40(0x15e):_0x3ddf5e=_0x261c40(0x105);break;case _0x261c40(0x169):_0x3ddf5e=_0x261c40(0x112);break;case _0x261c40(0x13e):_0x3ddf5e=_0x261c40(0x100);break;case _0x261c40(0x147):_0x3ddf5e=_0x261c40(0x112);!_0xc3d16a&&_0x80764c[_0x261c40(0x159)]?.[_0x261c40(0x110)]&&(_0xc3d16a=_0x80764c[_0x261c40(0x159)][_0x261c40(0x110)]);break;default:switch(_0x80764c[_0x261c40(0x159)]?.[_0x261c40(0x164)]?.[_0x261c40(0x129)]()){case _0x261c40(0x153):_0x80764c['data']?.[_0x261c40(0x104)]===!![]?_0x3ddf5e=_0x261c40(0x15e):_0x3ddf5e='FAILED';break;case _0x261c40(0x12c):_0x3ddf5e='FAILED';break;case'EXP':_0x3ddf5e=_0x261c40(0x100);break;case _0x261c40(0x158):_0x3ddf5e='FAILED';!_0xc3d16a&&_0x80764c[_0x261c40(0x159)]?.[_0x261c40(0x110)]&&(_0xc3d16a=_0x80764c[_0x261c40(0x159)]['failure_message']);break;case'NEW':case _0x261c40(0x124):default:_0x3ddf5e=_0x261c40(0x105);break;}break;}const _0x4a7629={};return _0x80764c[_0x261c40(0x159)]?.[_0x261c40(0xf9)]?.[_0x261c40(0x14c)]&&(_0x4a7629[_0x261c40(0xfb)]=_0x80764c['data'][_0x261c40(0xf9)][_0x261c40(0x14c)]),_0x80764c[_0x261c40(0x159)]?.[_0x261c40(0x151)]&&(_0x4a7629[_0x261c40(0x172)]=_0x80764c[_0x261c40(0x159)][_0x261c40(0x151)]),_0x80764c[_0x261c40(0x159)]?.[_0x261c40(0x13c)]&&(_0x4a7629[_0x261c40(0x16d)]=_0x80764c[_0x261c40(0x159)][_0x261c40(0x13c)]),_0x80764c[_0x261c40(0x159)]?.[_0x261c40(0x160)]&&(_0x4a7629[_0x261c40(0x135)]=_0x80764c[_0x261c40(0x159)][_0x261c40(0x160)]),console['log'](_0x261c40(0x161)+_0x3ddf5e+_0x261c40(0x106)+(_0xc3d16a||'none')),{'paymentId':_0x80764c['data']?.[_0x261c40(0x16b)]||'','status':_0x3ddf5e,'amount':_0x80764c[_0x261c40(0x159)]?.[_0x261c40(0x15b)],'currency':_0x80764c[_0x261c40(0x159)]?.[_0x261c40(0x140)],'failureMessage':_0xc3d16a,'additionalInfo':_0x4a7629};}}exports['RapydService']=RapydService;