'use strict';const a45_0x541c63=a45_0x3e83;function a45_0x3e83(_0x5ac31a,_0x17b49c){const _0x11760a=a45_0x1176();return a45_0x3e83=function(_0x3e830a,_0x28e523){_0x3e830a=_0x3e830a-0xeb;let _0x77eba7=_0x11760a[_0x3e830a];return _0x77eba7;},a45_0x3e83(_0x5ac31a,_0x17b49c);}(function(_0x270e05,_0x48a4c1){const _0x5910b2=a45_0x3e83,_0x3b784e=_0x270e05();while(!![]){try{const _0x306c75=-parseInt(_0x5910b2(0xf6))/0x1+-parseInt(_0x5910b2(0x11a))/0x2*(parseInt(_0x5910b2(0x107))/0x3)+-parseInt(_0x5910b2(0xf2))/0x4*(parseInt(_0x5910b2(0x12e))/0x5)+-parseInt(_0x5910b2(0x127))/0x6+-parseInt(_0x5910b2(0x140))/0x7*(parseInt(_0x5910b2(0x115))/0x8)+parseInt(_0x5910b2(0xeb))/0x9*(parseInt(_0x5910b2(0x141))/0xa)+parseInt(_0x5910b2(0x150))/0xb;if(_0x306c75===_0x48a4c1)break;else _0x3b784e['push'](_0x3b784e['shift']());}catch(_0x1bc3da){_0x3b784e['push'](_0x3b784e['shift']());}}}(a45_0x1176,0x68ede));function a45_0x1176(){const _0x3bd3aa=['logWhiteDomainResponse','fromEntries','stringify','logWhiteDomainError','/v1/hosted/payment_links',',\x20body:\x20','Unknown\x20error','__esModule','PAYMENT_EXPIRED','Payment\x20Link\x20ID:','processWebhook','data','787272HznVLP','POST','EXP','===\x20RAPYD\x20SUCCESS\x20===','PAYMENT_CANCELED','NEW','SUCCESS','285930lcrGXo','UNKNOWN','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','amount','Unknown\x20error\x20from\x20Rapyd\x20API','headers','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','TesSoft\x20Payment\x20System/1.0','merchant_reference_id','Headers:','CAN','loggerService','error','Parsed\x20Result:','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PAID','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','7NsuGzn','367020gIVkeO','toUpperCase','Error\x20Message:','ACT','payment_method_data','Status\x20Text:','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','../loggerService','PAYMENT_FAILED','URL:','Request\x20Body\x20(Updated\x20Format):','üá¨üáß\x20Country:\x20','errorCode','gb_visa_card','payment_method_type','18270362BtJkHX','EXPIRED','Response\x20Time:','JSON\x20Parse\x20Error:\x20','last4','Rapyd\x20API\x20error\x20(','failureCode','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','HTTP\x20error!\x20status:\x20','failure_code','CLO','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','):\x20','apiUrl','Redirect\x20URL:','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','FAILED','153ijVCbr','error_code','verifyPayment','ERR','\x20(always\x20GB\x20for\x20Rapyd)','https://tesoft.uk/gateway/rapyd/','PENDING','32UeUGqd','https://tesoft.uk/gateway/fail.php?id=','failure_message','Processing\x20Rapyd\x20webhook:','217851ooUGTg','text','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','entries','application/json','Response\x20data:','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','createPaymentLink','\x20(GB\x20-\x20Britain)','PAYMENT_COMPLETED','gb_mastercard_card','log','/v1/hosted/payment_links/','üí•\x20Rapyd\x20failure\x20message:\x20','RapydService','Status:','statusText','15vbgJIB','üá¨üáß\x20Country\x20used:\x20','status','message','rapyd','Rapyd\x20API\x20error:\x20','Rapyd\x20payment\x20verification\x20error:','Full\x20Error\x20Data:','===\x20RAPYD\x20API\x20ERROR\x20===','HTTP\x20','now','GET','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','json','5534600AgSnDj','Raw\x20Response\x20Body:','redirect_url','HTTP\x20Status:','paid','142684yqwCyf'];a45_0x1176=function(){return _0x3bd3aa;};return a45_0x1176();}Object['defineProperty'](exports,a45_0x541c63(0x122),{'value':!![]}),exports[a45_0x541c63(0x104)]=void 0x0;const loggerService_1=require(a45_0x541c63(0x148));class RapydService{constructor(){const _0x25eb55=a45_0x541c63;this['apiUrl']=_0x25eb55(0xf0),console[_0x25eb55(0x101)](_0x25eb55(0x13c));}async[a45_0x541c63(0xfd)](_0xdaf5a){const _0x323cc1=a45_0x541c63,{orderId:_0x54691c,orderName:_0x251de0,amount:_0x5d6305,currency:_0x29d432,usage:_0x234979,maxPayments:_0x31739,successUrl:_0x202721,failUrl:_0x4c0168}=_0xdaf5a,_0x5113aa=_0x29d432[_0x323cc1(0x142)](),_0x3072ba='GB';console['log'](_0x323cc1(0x134));const _0x36b4b2='https://tesoft.uk/gateway/success.php?id='+_0x54691c,_0x410b05=_0x323cc1(0xf3)+_0x54691c,_0x41307a={'amount':_0x5d6305,'currency':_0x5113aa,'cancel_checkout_url':_0x410b05,'complete_checkout_url':_0x36b4b2,'complete_payment_url':_0x36b4b2,'merchant_reference_id':_0x54691c,'description':'ORDER:\x20'+_0x54691c,'country':'GB','payment_method_types_include':[_0x323cc1(0x14e),_0x323cc1(0x100)],'custom_elements':{'display_description':!![]}},_0x10ed43=Date['now']();try{console['log'](_0x323cc1(0x130)),console[_0x323cc1(0x101)](_0x323cc1(0x14a),this[_0x323cc1(0x15d)]),console[_0x323cc1(0x101)](_0x323cc1(0x14b),JSON[_0x323cc1(0x11d)](_0x41307a,null,0x2)),console[_0x323cc1(0x101)](_0x323cc1(0x14c)+_0x3072ba+_0x323cc1(0xef)),console[_0x323cc1(0x101)](_0x323cc1(0x13e)),loggerService_1[_0x323cc1(0x139)]['logWhiteDomainRequest']('rapyd',_0x323cc1(0x11f),_0x323cc1(0x128),_0x41307a);const _0x34a13c=await fetch(this[_0x323cc1(0x15d)],{'method':_0x323cc1(0x128),'headers':{'Content-Type':_0x323cc1(0xfa),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x323cc1(0x11d)](_0x41307a)}),_0x3b7b2c=Date[_0x323cc1(0x111)]()-_0x10ed43;console[_0x323cc1(0x101)](_0x323cc1(0x15f)),console[_0x323cc1(0x101)](_0x323cc1(0x105),_0x34a13c[_0x323cc1(0x109)]),console['log'](_0x323cc1(0x146),_0x34a13c[_0x323cc1(0x106)]),console[_0x323cc1(0x101)](_0x323cc1(0x137),Object[_0x323cc1(0x11c)](_0x34a13c[_0x323cc1(0x133)][_0x323cc1(0xf9)]())),console[_0x323cc1(0x101)](_0x323cc1(0x152),_0x3b7b2c+'ms');const _0x4c2a75=await _0x34a13c[_0x323cc1(0xf7)]();console['log'](_0x323cc1(0x116),_0x4c2a75);if(!_0x34a13c['ok']){console[_0x323cc1(0x13a)](_0x323cc1(0x10f)),console[_0x323cc1(0x13a)](_0x323cc1(0x118),_0x34a13c['status']),console[_0x323cc1(0x13a)]('Response\x20Body:',_0x4c2a75),loggerService_1[_0x323cc1(0x139)][_0x323cc1(0x11b)](_0x323cc1(0x10b),'/v1/hosted/payment_links',_0x34a13c['status'],_0x4c2a75,_0x3b7b2c),loggerService_1[_0x323cc1(0x139)]['logWhiteDomainError'](_0x323cc1(0x10b),_0x323cc1(0x11f),_0x323cc1(0x110)+_0x34a13c[_0x323cc1(0x109)]+':\x20'+_0x4c2a75);throw new Error(_0x323cc1(0x158)+_0x34a13c['status']+_0x323cc1(0x120)+_0x4c2a75);}let _0x6e29a3;try{_0x6e29a3=JSON['parse'](_0x4c2a75);}catch(_0x2b5d0a){console[_0x323cc1(0x13a)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x2b5d0a),loggerService_1[_0x323cc1(0x139)][_0x323cc1(0x11e)]('rapyd',_0x323cc1(0x11f),_0x323cc1(0x153)+_0x2b5d0a);throw new Error(_0x323cc1(0x15b)+_0x4c2a75);}console[_0x323cc1(0x101)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x323cc1(0x101)](_0x323cc1(0x13b),JSON[_0x323cc1(0x11d)](_0x6e29a3,null,0x2)),loggerService_1[_0x323cc1(0x139)]['logWhiteDomainResponse'](_0x323cc1(0x10b),_0x323cc1(0x11f),_0x34a13c[_0x323cc1(0x109)],_0x6e29a3,_0x3b7b2c);if(_0x6e29a3[_0x323cc1(0x109)]?.['status']!==_0x323cc1(0x12d)){const _0x201fe3=_0x6e29a3['status']?.[_0x323cc1(0x10a)]||_0x323cc1(0x132),_0x2b0466=_0x6e29a3[_0x323cc1(0x109)]?.[_0x323cc1(0xec)]||_0x323cc1(0x12f);console[_0x323cc1(0x13a)](_0x323cc1(0xfc)),console[_0x323cc1(0x13a)]('Error\x20Code:',_0x2b0466),console[_0x323cc1(0x13a)](_0x323cc1(0x143),_0x201fe3),console['error'](_0x323cc1(0x10e),_0x6e29a3[_0x323cc1(0x109)]),loggerService_1[_0x323cc1(0x139)][_0x323cc1(0x11e)](_0x323cc1(0x10b),_0x323cc1(0x11f),'Business\x20Error\x20('+_0x2b0466+_0x323cc1(0x15c)+_0x201fe3);throw new Error(_0x323cc1(0x155)+_0x2b0466+_0x323cc1(0x15c)+_0x201fe3);}if(!_0x6e29a3[_0x323cc1(0x126)]?.['id']||!_0x6e29a3[_0x323cc1(0x126)]?.['redirect_url']){console[_0x323cc1(0x13a)]('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20id\x20or\x20redirect_url\x20in\x20response'),console[_0x323cc1(0x13a)](_0x323cc1(0xfb),_0x6e29a3[_0x323cc1(0x126)]),loggerService_1[_0x323cc1(0x139)]['logWhiteDomainError'](_0x323cc1(0x10b),_0x323cc1(0x11f),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x323cc1(0x113));}return console[_0x323cc1(0x101)](_0x323cc1(0x12a)),console[_0x323cc1(0x101)](_0x323cc1(0x124),_0x6e29a3[_0x323cc1(0x126)]['id']),console['log'](_0x323cc1(0x15e),_0x6e29a3['data'][_0x323cc1(0x117)]),console[_0x323cc1(0x101)](_0x323cc1(0x108)+_0x3072ba+_0x323cc1(0xfe)),console[_0x323cc1(0x101)](_0x323cc1(0x13e)),{'gateway_payment_id':_0x6e29a3[_0x323cc1(0x126)]['id'],'payment_url':_0x6e29a3[_0x323cc1(0x126)][_0x323cc1(0x117)]};}catch(_0xa499f){console[_0x323cc1(0x13a)](_0x323cc1(0xf8)),console[_0x323cc1(0x13a)]('Error\x20details:',_0xa499f),loggerService_1[_0x323cc1(0x139)][_0x323cc1(0x11e)](_0x323cc1(0x10b),_0x323cc1(0x11f),_0xa499f);if(_0xa499f instanceof Error){console['error']('Error\x20message:',_0xa499f['message']),console[_0x323cc1(0x13a)]('Error\x20stack:',_0xa499f['stack']);throw new Error(_0x323cc1(0x157)+_0xa499f[_0x323cc1(0x10a)]);}throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error');}}async[a45_0x541c63(0xed)](_0x5b120b){const _0x5cc84a=a45_0x541c63,_0x57bfbd=Date[_0x5cc84a(0x111)]();try{loggerService_1[_0x5cc84a(0x139)]['logWhiteDomainRequest']('rapyd','/v1/hosted/payment_links/'+_0x5b120b,_0x5cc84a(0x112),{});const _0x5a43de=await fetch(this[_0x5cc84a(0x15d)]+'/'+_0x5b120b,{'method':_0x5cc84a(0x112),'headers':{'Content-Type':_0x5cc84a(0xfa),'User-Agent':_0x5cc84a(0x135)}}),_0x41f629=Date['now']()-_0x57bfbd;if(!_0x5a43de['ok']){const _0x7a7322=await _0x5a43de[_0x5cc84a(0xf7)]();loggerService_1[_0x5cc84a(0x139)][_0x5cc84a(0x11b)](_0x5cc84a(0x10b),'/v1/hosted/payment_links/'+_0x5b120b,_0x5a43de[_0x5cc84a(0x109)],_0x7a7322,_0x41f629);throw new Error(_0x5cc84a(0x158)+_0x5a43de[_0x5cc84a(0x109)]);}const _0x2dd8bc=await _0x5a43de[_0x5cc84a(0x114)]();loggerService_1[_0x5cc84a(0x139)][_0x5cc84a(0x11b)](_0x5cc84a(0x10b),_0x5cc84a(0x102)+_0x5b120b,_0x5a43de['status'],_0x2dd8bc,_0x41f629);if(_0x2dd8bc['status']?.[_0x5cc84a(0x109)]!==_0x5cc84a(0x12d)){loggerService_1[_0x5cc84a(0x139)][_0x5cc84a(0x11e)](_0x5cc84a(0x10b),_0x5cc84a(0x102)+_0x5b120b,'Rapyd\x20API\x20error:\x20'+(_0x2dd8bc[_0x5cc84a(0x109)]?.[_0x5cc84a(0x10a)]||_0x5cc84a(0x121)));throw new Error(_0x5cc84a(0x10c)+(_0x2dd8bc[_0x5cc84a(0x109)]?.['message']||_0x5cc84a(0x121)));}let _0x945f32=_0x5cc84a(0xf1);if(_0x2dd8bc[_0x5cc84a(0x126)]?.[_0x5cc84a(0x109)])switch(_0x2dd8bc[_0x5cc84a(0x126)][_0x5cc84a(0x109)]['toUpperCase']()){case _0x5cc84a(0x15a):_0x945f32='PAID';break;case _0x5cc84a(0x138):_0x945f32=_0x5cc84a(0x160);break;case _0x5cc84a(0x129):_0x945f32=_0x5cc84a(0x151);break;case _0x5cc84a(0xee):_0x945f32=_0x5cc84a(0x160);break;case'NEW':case _0x5cc84a(0x144):default:_0x945f32=_0x5cc84a(0xf1);break;}return{'status':_0x945f32,'amount':_0x2dd8bc[_0x5cc84a(0x126)]?.['amount'],'currency':_0x2dd8bc['data']?.['currency']};}catch(_0x503dd7){console[_0x5cc84a(0x13a)](_0x5cc84a(0x10d),_0x503dd7),loggerService_1[_0x5cc84a(0x139)]['logWhiteDomainError'](_0x5cc84a(0x10b),_0x5cc84a(0x102)+_0x5b120b,_0x503dd7);throw new Error(_0x5cc84a(0x13f)+(_0x503dd7 instanceof Error?_0x503dd7['message']:'Unknown\x20error'));}}async[a45_0x541c63(0x125)](_0x16819e){const _0x46913e=a45_0x541c63;console[_0x46913e(0x101)](_0x46913e(0xf5),_0x16819e);let _0x5d09a2=_0x46913e(0xf1),_0x359617;_0x16819e[_0x46913e(0x126)]?.['failure_message']&&(_0x359617=_0x16819e['data'][_0x46913e(0xf4)],console[_0x46913e(0x101)](_0x46913e(0x103)+_0x359617));switch(_0x16819e['type']?.[_0x46913e(0x142)]()){case _0x46913e(0xff):_0x16819e[_0x46913e(0x126)]?.[_0x46913e(0x119)]===!![]&&_0x16819e[_0x46913e(0x126)]?.[_0x46913e(0x109)]===_0x46913e(0x15a)?_0x5d09a2='PAID':_0x5d09a2=_0x46913e(0xf1);break;case _0x46913e(0x12b):_0x5d09a2='FAILED';break;case _0x46913e(0x123):_0x5d09a2=_0x46913e(0x151);break;case _0x46913e(0x149):_0x5d09a2=_0x46913e(0x160);!_0x359617&&_0x16819e[_0x46913e(0x126)]?.[_0x46913e(0xf4)]&&(_0x359617=_0x16819e[_0x46913e(0x126)][_0x46913e(0xf4)]);break;default:switch(_0x16819e[_0x46913e(0x126)]?.['status']?.[_0x46913e(0x142)]()){case _0x46913e(0x15a):_0x16819e[_0x46913e(0x126)]?.[_0x46913e(0x119)]===!![]?_0x5d09a2=_0x46913e(0x13d):_0x5d09a2=_0x46913e(0x160);break;case _0x46913e(0x138):_0x5d09a2=_0x46913e(0x160);break;case'EXP':_0x5d09a2=_0x46913e(0x151);break;case'ERR':_0x5d09a2=_0x46913e(0x160);!_0x359617&&_0x16819e[_0x46913e(0x126)]?.['failure_message']&&(_0x359617=_0x16819e[_0x46913e(0x126)][_0x46913e(0xf4)]);break;case _0x46913e(0x12c):case _0x46913e(0x144):default:_0x5d09a2=_0x46913e(0xf1);break;}break;}const _0x2d874b={};return _0x16819e[_0x46913e(0x126)]?.[_0x46913e(0x145)]?.[_0x46913e(0x154)]&&(_0x2d874b['cardLast4']=_0x16819e[_0x46913e(0x126)]['payment_method_data'][_0x46913e(0x154)]),_0x16819e[_0x46913e(0x126)]?.[_0x46913e(0x14f)]&&(_0x2d874b['paymentMethod']=_0x16819e['data'][_0x46913e(0x14f)]),_0x16819e['data']?.[_0x46913e(0xec)]&&(_0x2d874b[_0x46913e(0x14d)]=_0x16819e[_0x46913e(0x126)][_0x46913e(0xec)]),_0x16819e[_0x46913e(0x126)]?.['failure_code']&&(_0x2d874b[_0x46913e(0x156)]=_0x16819e[_0x46913e(0x126)][_0x46913e(0x159)]),console[_0x46913e(0x101)](_0x46913e(0x147)+_0x5d09a2+',\x20failureMessage='+(_0x359617||'none')),{'paymentId':_0x16819e[_0x46913e(0x126)]?.[_0x46913e(0x136)]||'','status':_0x5d09a2,'amount':_0x16819e['data']?.[_0x46913e(0x131)],'currency':_0x16819e[_0x46913e(0x126)]?.['currency'],'failureMessage':_0x359617,'additionalInfo':_0x2d874b};}}exports[a45_0x541c63(0x104)]=RapydService;