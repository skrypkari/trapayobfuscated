'use strict';const a42_0x474ddc=a42_0x3936;function a42_0xdb9a(){const _0xcf554b=['):\x20','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','error','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20','PAYMENT_FAILED','üá¨üáß\x20Country:\x20','CAN','TesSoft\x20Payment\x20System/1.0','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20',',\x20body:\x20','Status\x20Text:','Payment\x20Link\x20ID:','text','UNKNOWN','__esModule','verifyPayment','24560109MLfblp','Parsed\x20Result:','/v1/hosted/payment_links','now','HTTP\x20Status:','\x20(always\x20GB\x20for\x20Rapyd)','paid','EXP','Error\x20message:','amount','Business\x20Error\x20(','EXPIRED','data','message','HTTP\x20','apiUrl','Full\x20Error\x20Data:','Response\x20data:','stringify','application/json','Missing\x20id\x20or\x20redirect_url\x20in\x20response','Unknown\x20error','Error\x20Code:','https://tesoft.uk/gateway/success.php?id=','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','SUCCESS','Status:','932713YSKUeq','ORDER:\x20','396368jtrXTt','logWhiteDomainError','Rapyd\x20payment\x20verification\x20error:','stack','log','createPaymentLink','2608496RDOgvZ','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','PAID','rapyd','/v1/hosted/payment_links/','===\x20RAPYD\x20API\x20ERROR\x20===','error_code','10lMKdur','Request\x20Body\x20(Updated\x20Format):','type','NEW','GET','FAILED','merchant_reference_id','currency','PAYMENT_CANCELED','318552oCNeLB','statusText','Error\x20Message:','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','üá¨üáß\x20Country\x20used:\x20','https://tesoft.uk/gateway/rapyd/','https://tesoft.uk/gateway/fail.php?id=','7853784zQkjHX','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','15MLAvAY','fromEntries','Rapyd\x20API\x20error:\x20','PENDING','Headers:','Unknown\x20error\x20from\x20Rapyd\x20API','redirect_url','loggerService','===\x20RAPYD\x20SUCCESS\x20===','RapydService','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','CLO','102dQrfmg','POST','toUpperCase','../loggerService','Raw\x20Response\x20Body:','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','logWhiteDomainResponse','ACT','gb_mastercard_card','parse','headers','logWhiteDomainRequest','Error\x20details:','ERR','status','Failed\x20to\x20parse\x20JSON\x20response:','HTTP\x20error!\x20status:\x20','defineProperty','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','entries','\x20(GB\x20-\x20Britain)','1260390xNCCfS','processWebhook','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='];a42_0xdb9a=function(){return _0xcf554b;};return a42_0xdb9a();}(function(_0x2759ba,_0x4e285b){const _0x4b4968=a42_0x3936,_0x40200d=_0x2759ba();while(!![]){try{const _0x3be669=parseInt(_0x4b4968(0xf3))/0x1+-parseInt(_0x4b4968(0x10b))/0x2*(parseInt(_0x4b4968(0x114))/0x3)+-parseInt(_0x4b4968(0xfb))/0x4+parseInt(_0x4b4968(0xc5))/0x5+parseInt(_0x4b4968(0x120))/0x6*(-parseInt(_0x4b4968(0xf5))/0x7)+-parseInt(_0x4b4968(0x112))/0x8+parseInt(_0x4b4968(0xd8))/0x9*(parseInt(_0x4b4968(0x102))/0xa);if(_0x3be669===_0x4e285b)break;else _0x40200d['push'](_0x40200d['shift']());}catch(_0x85b40d){_0x40200d['push'](_0x40200d['shift']());}}}(a42_0xdb9a,0x7f299));function a42_0x3936(_0x4926aa,_0x6aa289){const _0xdb9a2f=a42_0xdb9a();return a42_0x3936=function(_0x393699,_0x1487b6){_0x393699=_0x393699-0xc1;let _0x330d56=_0xdb9a2f[_0x393699];return _0x330d56;},a42_0x3936(_0x4926aa,_0x6aa289);}Object[a42_0x474ddc(0xc1)](exports,a42_0x474ddc(0xd6),{'value':!![]}),exports[a42_0x474ddc(0x11d)]=void 0x0;const loggerService_1=require(a42_0x474ddc(0x123));class RapydService{constructor(){const _0x1139e7=a42_0x474ddc;this[_0x1139e7(0xe7)]=_0x1139e7(0x110),console[_0x1139e7(0xf9)](_0x1139e7(0x113));}async[a42_0x474ddc(0xfa)](_0x9a7a9d){const _0x21ff70=a42_0x474ddc,{orderId:_0x2adcec,orderName:_0x587fd1,amount:_0x8bfe70,currency:_0xbc910f,usage:_0x51a310,maxPayments:_0x4d7963,successUrl:_0x411006,failUrl:_0x2629db}=_0x9a7a9d,_0x42aa0c=_0xbc910f[_0x21ff70(0x122)](),_0x57df06='GB';console[_0x21ff70(0xf9)](_0x21ff70(0x10e));const _0x394cf7=_0x21ff70(0xef)+_0x2adcec,_0x1be25a=_0x21ff70(0x111)+_0x2adcec,_0x5cfbe6={'amount':_0x8bfe70,'cancel_checkout_url':_0x1be25a,'complete_checkout_url':_0x394cf7,'complete_payment_url':_0x394cf7,'merchant_reference_id':_0x2adcec,'description':_0x21ff70(0xf4)+_0x2adcec,'payment_method_types_include':['gb_visa_card',_0x21ff70(0x128)],'custom_elements':{'display_description':!![]}},_0x44c4fe=Date[_0x21ff70(0xdb)]();try{console[_0x21ff70(0xf9)](_0x21ff70(0xc7)),console['log']('URL:',this['apiUrl']),console['log'](_0x21ff70(0x103),JSON[_0x21ff70(0xea)](_0x5cfbe6,null,0x2)),console[_0x21ff70(0xf9)](_0x21ff70(0xcd)+_0x57df06+_0x21ff70(0xdd)),console[_0x21ff70(0xf9)](_0x21ff70(0x125)),loggerService_1['loggerService'][_0x21ff70(0x12b)](_0x21ff70(0xfe),'/v1/hosted/payment_links',_0x21ff70(0x121),_0x5cfbe6);const _0x172cda=await fetch(this['apiUrl'],{'method':_0x21ff70(0x121),'headers':{'Content-Type':_0x21ff70(0xeb),'User-Agent':_0x21ff70(0xcf)},'body':JSON[_0x21ff70(0xea)](_0x5cfbe6)}),_0x2935b7=Date[_0x21ff70(0xdb)]()-_0x44c4fe;console[_0x21ff70(0xf9)](_0x21ff70(0xc2)),console['log'](_0x21ff70(0xf2),_0x172cda[_0x21ff70(0x12e)]),console[_0x21ff70(0xf9)](_0x21ff70(0xd2),_0x172cda[_0x21ff70(0x10c)]),console[_0x21ff70(0xf9)](_0x21ff70(0x118),Object[_0x21ff70(0x115)](_0x172cda[_0x21ff70(0x12a)][_0x21ff70(0xc3)]())),console[_0x21ff70(0xf9)]('Response\x20Time:',_0x2935b7+'ms');const _0x3eaa42=await _0x172cda[_0x21ff70(0xd4)]();console[_0x21ff70(0xf9)](_0x21ff70(0x124),_0x3eaa42);if(!_0x172cda['ok']){console['error'](_0x21ff70(0x100)),console[_0x21ff70(0xca)](_0x21ff70(0xdc),_0x172cda[_0x21ff70(0x12e)]),console[_0x21ff70(0xca)]('Response\x20Body:',_0x3eaa42),loggerService_1['loggerService'][_0x21ff70(0x126)](_0x21ff70(0xfe),'/v1/hosted/payment_links',_0x172cda[_0x21ff70(0x12e)],_0x3eaa42,_0x2935b7),loggerService_1['loggerService'][_0x21ff70(0xf6)](_0x21ff70(0xfe),_0x21ff70(0xda),_0x21ff70(0xe6)+_0x172cda['status']+':\x20'+_0x3eaa42);throw new Error('HTTP\x20error!\x20status:\x20'+_0x172cda[_0x21ff70(0x12e)]+_0x21ff70(0xd1)+_0x3eaa42);}let _0x3407a6;try{_0x3407a6=JSON[_0x21ff70(0x129)](_0x3eaa42);}catch(_0x209e13){console[_0x21ff70(0xca)](_0x21ff70(0x12f),_0x209e13),loggerService_1['loggerService'][_0x21ff70(0xf6)]('rapyd',_0x21ff70(0xda),'JSON\x20Parse\x20Error:\x20'+_0x209e13);throw new Error(_0x21ff70(0xf0)+_0x3eaa42);}console[_0x21ff70(0xf9)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x21ff70(0xf9)](_0x21ff70(0xd9),JSON[_0x21ff70(0xea)](_0x3407a6,null,0x2)),loggerService_1[_0x21ff70(0x11b)][_0x21ff70(0x126)](_0x21ff70(0xfe),'/v1/hosted/payment_links',_0x172cda[_0x21ff70(0x12e)],_0x3407a6,_0x2935b7);if(_0x3407a6['status']?.[_0x21ff70(0x12e)]!=='SUCCESS'){const _0x4d5711=_0x3407a6['status']?.['message']||_0x21ff70(0x119),_0x552cfa=_0x3407a6[_0x21ff70(0x12e)]?.[_0x21ff70(0x101)]||_0x21ff70(0xd5);console[_0x21ff70(0xca)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x21ff70(0xca)](_0x21ff70(0xee),_0x552cfa),console[_0x21ff70(0xca)](_0x21ff70(0x10d),_0x4d5711),console[_0x21ff70(0xca)](_0x21ff70(0xe8),_0x3407a6[_0x21ff70(0x12e)]),loggerService_1[_0x21ff70(0x11b)][_0x21ff70(0xf6)]('rapyd',_0x21ff70(0xda),_0x21ff70(0xe2)+_0x552cfa+_0x21ff70(0xc8)+_0x4d5711);throw new Error('Rapyd\x20API\x20error\x20('+_0x552cfa+'):\x20'+_0x4d5711);}if(!_0x3407a6[_0x21ff70(0xe4)]?.['id']||!_0x3407a6[_0x21ff70(0xe4)]?.[_0x21ff70(0x11a)]){console[_0x21ff70(0xca)]('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x21ff70(0xec)),console[_0x21ff70(0xca)](_0x21ff70(0xe9),_0x3407a6[_0x21ff70(0xe4)]),loggerService_1[_0x21ff70(0x11b)][_0x21ff70(0xf6)](_0x21ff70(0xfe),_0x21ff70(0xda),'Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url');throw new Error(_0x21ff70(0xfc));}return console[_0x21ff70(0xf9)](_0x21ff70(0x11c)),console[_0x21ff70(0xf9)](_0x21ff70(0xd3),_0x3407a6[_0x21ff70(0xe4)]['id']),console['log']('Redirect\x20URL:',_0x3407a6[_0x21ff70(0xe4)][_0x21ff70(0x11a)]),console[_0x21ff70(0xf9)](_0x21ff70(0x10f)+_0x57df06+_0x21ff70(0xc4)),console[_0x21ff70(0xf9)](_0x21ff70(0x125)),{'gateway_payment_id':_0x3407a6['data']['id'],'payment_url':_0x3407a6[_0x21ff70(0xe4)][_0x21ff70(0x11a)]};}catch(_0x390a1e){console[_0x21ff70(0xca)](_0x21ff70(0x11e)),console['error'](_0x21ff70(0x12c),_0x390a1e),loggerService_1[_0x21ff70(0x11b)]['logWhiteDomainError'](_0x21ff70(0xfe),_0x21ff70(0xda),_0x390a1e);if(_0x390a1e instanceof Error){console[_0x21ff70(0xca)](_0x21ff70(0xe0),_0x390a1e[_0x21ff70(0xe5)]),console[_0x21ff70(0xca)]('Error\x20stack:',_0x390a1e[_0x21ff70(0xf8)]);throw new Error(_0x21ff70(0xcb)+_0x390a1e['message']);}throw new Error(_0x21ff70(0xc9));}}async[a42_0x474ddc(0xd7)](_0x59788f){const _0x2db6c5=a42_0x474ddc,_0x25074f=Date[_0x2db6c5(0xdb)]();try{loggerService_1[_0x2db6c5(0x11b)][_0x2db6c5(0x12b)](_0x2db6c5(0xfe),_0x2db6c5(0xff)+_0x59788f,_0x2db6c5(0x106),{});const _0x1433f3=await fetch(this[_0x2db6c5(0xe7)]+'/'+_0x59788f,{'method':'GET','headers':{'Content-Type':_0x2db6c5(0xeb),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x54fe27=Date[_0x2db6c5(0xdb)]()-_0x25074f;if(!_0x1433f3['ok']){const _0x2d637f=await _0x1433f3[_0x2db6c5(0xd4)]();loggerService_1[_0x2db6c5(0x11b)]['logWhiteDomainResponse'](_0x2db6c5(0xfe),_0x2db6c5(0xff)+_0x59788f,_0x1433f3[_0x2db6c5(0x12e)],_0x2d637f,_0x54fe27);throw new Error(_0x2db6c5(0x130)+_0x1433f3[_0x2db6c5(0x12e)]);}const _0x1e56f0=await _0x1433f3['json']();loggerService_1[_0x2db6c5(0x11b)][_0x2db6c5(0x126)]('rapyd',_0x2db6c5(0xff)+_0x59788f,_0x1433f3[_0x2db6c5(0x12e)],_0x1e56f0,_0x54fe27);if(_0x1e56f0[_0x2db6c5(0x12e)]?.['status']!==_0x2db6c5(0xf1)){loggerService_1['loggerService']['logWhiteDomainError'](_0x2db6c5(0xfe),_0x2db6c5(0xff)+_0x59788f,_0x2db6c5(0x116)+(_0x1e56f0[_0x2db6c5(0x12e)]?.[_0x2db6c5(0xe5)]||_0x2db6c5(0xed)));throw new Error(_0x2db6c5(0x116)+(_0x1e56f0[_0x2db6c5(0x12e)]?.[_0x2db6c5(0xe5)]||_0x2db6c5(0xed)));}let _0x47d726='PENDING';if(_0x1e56f0[_0x2db6c5(0xe4)]?.[_0x2db6c5(0x12e)])switch(_0x1e56f0[_0x2db6c5(0xe4)][_0x2db6c5(0x12e)][_0x2db6c5(0x122)]()){case'CLO':_0x47d726=_0x2db6c5(0xfd);break;case _0x2db6c5(0xce):_0x47d726='FAILED';break;case'EXP':_0x47d726=_0x2db6c5(0xe3);break;case'ERR':_0x47d726='FAILED';break;case _0x2db6c5(0x105):case _0x2db6c5(0x127):default:_0x47d726=_0x2db6c5(0x117);break;}return{'status':_0x47d726,'amount':_0x1e56f0['data']?.[_0x2db6c5(0xe1)],'currency':_0x1e56f0['data']?.[_0x2db6c5(0x109)]};}catch(_0x56467c){console[_0x2db6c5(0xca)](_0x2db6c5(0xf7),_0x56467c),loggerService_1[_0x2db6c5(0x11b)][_0x2db6c5(0xf6)](_0x2db6c5(0xfe),_0x2db6c5(0xff)+_0x59788f,_0x56467c);throw new Error(_0x2db6c5(0xd0)+(_0x56467c instanceof Error?_0x56467c[_0x2db6c5(0xe5)]:_0x2db6c5(0xed)));}}async[a42_0x474ddc(0xc6)](_0x2a1611){const _0x4e479b=a42_0x474ddc;console[_0x4e479b(0xf9)]('Processing\x20Rapyd\x20webhook:',_0x2a1611);let _0x6c5d75=_0x4e479b(0x117);switch(_0x2a1611[_0x4e479b(0x104)]?.[_0x4e479b(0x122)]()){case'PAYMENT_COMPLETED':_0x2a1611[_0x4e479b(0xe4)]?.['paid']===!![]&&_0x2a1611['data']?.[_0x4e479b(0x12e)]===_0x4e479b(0x11f)?_0x6c5d75=_0x4e479b(0xfd):_0x6c5d75=_0x4e479b(0x117);break;case _0x4e479b(0x10a):_0x6c5d75=_0x4e479b(0x107);break;case'PAYMENT_EXPIRED':_0x6c5d75=_0x4e479b(0xe3);break;case _0x4e479b(0xcc):_0x6c5d75=_0x4e479b(0x107);break;default:switch(_0x2a1611[_0x4e479b(0xe4)]?.[_0x4e479b(0x12e)]?.[_0x4e479b(0x122)]()){case _0x4e479b(0x11f):_0x2a1611[_0x4e479b(0xe4)]?.[_0x4e479b(0xde)]===!![]?_0x6c5d75=_0x4e479b(0xfd):_0x6c5d75=_0x4e479b(0x107);break;case _0x4e479b(0xce):_0x6c5d75='FAILED';break;case _0x4e479b(0xdf):_0x6c5d75='EXPIRED';break;case _0x4e479b(0x12d):_0x6c5d75=_0x4e479b(0x107);break;case _0x4e479b(0x105):case _0x4e479b(0x127):default:_0x6c5d75=_0x4e479b(0x117);break;}break;}return{'paymentId':_0x2a1611[_0x4e479b(0xe4)]?.[_0x4e479b(0x108)]||'','status':_0x6c5d75,'amount':_0x2a1611[_0x4e479b(0xe4)]?.[_0x4e479b(0xe1)],'currency':_0x2a1611[_0x4e479b(0xe4)]?.['currency']};}}exports[a42_0x474ddc(0x11d)]=RapydService;