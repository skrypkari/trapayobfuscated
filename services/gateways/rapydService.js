'use strict';function a48_0x7b25(){const _0x5448a5=['/v1/hosted/payment_links/','stringify','1196160oLbaoR','paymentMethod','Rapyd\x20API\x20error:\x20','fixed_side','Rapyd\x20API\x20error\x20(','PENDING','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','payment_method_type','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','expiration','none','):\x20','data','PAYMENT_COMPLETED','defineProperty','logWhiteDomainRequest','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','text','JSON\x20Parse\x20Error:\x20',',\x20body:\x20','PAYMENT_EXPIRED','8hcApvK','now','currency','üí•\x20Rapyd\x20failure\x20message:\x20','\x20->\x20EUR:','failure_message','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','RapydService','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','error','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','/v1/hosted/payment_links','log','buy','\x20\x20\x20expiration:\x20','Full\x20Error\x20Data:','2382716MSWDwV','SUCCESS','GET','1034460wKHreY','rapyd','ERR','ORDER:\x20','loggerService','redirect_url','type','https://tesoft.uk/gateway/success.php?id=','Error\x20Message:','\x20\x20\x20requested_currency:\x20EUR','https://tesoft.uk/gateway/rapyd/','\x20(always\x20GB\x20for\x20Rapyd)','application/json','URL:','cardLast4','logWhiteDomainResponse','EXP','PAYMENT_FAILED','https://tesoft.uk/gateway/fail.php?id=','Parsed\x20Result:','Unknown\x20error\x20from\x20Rapyd\x20API','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PAID',',\x20failureMessage=','13258aUIyXW','2964860rFzRNJ','Error\x20message:','parse','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','failureCode','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','processWebhook','errorCode','Processing\x20Rapyd\x20webhook:','apiUrl','Error\x20stack:','1795192LEsHoF','EUR','gb_visa_card','\x20(GB\x20-\x20Britain)','Response\x20Time:','last4','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','Unknown\x20error','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','POST','3115rWLEls','ACT','Response\x20Body:','üí±\x20Adding\x20currency\x20conversion\x20fields\x20for\x20','\x20\x20\x20fixed_side:\x20buy','toUpperCase','Error\x20details:','===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','fromEntries','üá¨üáß\x20Country\x20used:\x20','EXPIRED','logWhiteDomainError','Error\x20Code:','toISOString','message','status','TesSoft\x20Payment\x20System/1.0','Status:','HTTP\x20','FAILED','PAYMENT_CANCELED','failure_code','verifyPayment','Response\x20data:','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','CLO','CAN','84cIziQH','error_code','Redirect\x20URL:','HTTP\x20Status:','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','createPaymentLink','Missing\x20id\x20or\x20redirect_url\x20in\x20response','9bYkXRv','headers','amount'];a48_0x7b25=function(){return _0x5448a5;};return a48_0x7b25();}const a48_0x12676e=a48_0xf517;(function(_0x11d162,_0x34721c){const _0x47da0a=a48_0xf517,_0xb1756a=_0x11d162();while(!![]){try{const _0x524eb1=-parseInt(_0x47da0a(0x127))/0x1+-parseInt(_0x47da0a(0x10f))/0x2+parseInt(_0x47da0a(0x165))/0x3+parseInt(_0x47da0a(0x133))/0x4+-parseInt(_0x47da0a(0x13d))/0x5*(-parseInt(_0x47da0a(0x159))/0x6)+parseInt(_0x47da0a(0x10c))/0x7*(parseInt(_0x47da0a(0xfc))/0x8)+parseInt(_0x47da0a(0x160))/0x9*(-parseInt(_0x47da0a(0x128))/0xa);if(_0x524eb1===_0x34721c)break;else _0xb1756a['push'](_0xb1756a['shift']());}catch(_0x17918e){_0xb1756a['push'](_0xb1756a['shift']());}}}(a48_0x7b25,0x5a3f6));Object[a48_0x12676e(0xf5)](exports,'__esModule',{'value':!![]}),exports[a48_0x12676e(0x103)]=void 0x0;function a48_0xf517(_0x5bc69a,_0x2ff1e9){const _0x7b25cf=a48_0x7b25();return a48_0xf517=function(_0xf5177,_0x5b2700){_0xf5177=_0xf5177-0xf4;let _0x3421d7=_0x7b25cf[_0xf5177];return _0x3421d7;},a48_0xf517(_0x5bc69a,_0x2ff1e9);}const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x4de27f=a48_0x12676e;this['apiUrl']=_0x4de27f(0x119),console[_0x4de27f(0x108)](_0x4de27f(0x124));}async[a48_0x12676e(0x15e)](_0x5e3898){const _0x3ca0d1=a48_0x12676e,{orderId:_0x126748,orderName:_0x4ce06f,amount:_0x1a85d9,currency:_0x5d14a2,usage:_0x3847df,maxPayments:_0x3b594c,successUrl:_0x36efbd,failUrl:_0x2da65d}=_0x5e3898,_0x1d5cb5=_0x5d14a2[_0x3ca0d1(0x142)](),_0x2b421f='GB';console[_0x3ca0d1(0x108)](_0x3ca0d1(0x106));const _0x41cba0=_0x3ca0d1(0x116)+_0x126748,_0x14c766=_0x3ca0d1(0x121)+_0x126748,_0x59c8be={'amount':_0x1a85d9,'currency':_0x1d5cb5,'cancel_checkout_url':_0x14c766,'complete_checkout_url':_0x41cba0,'complete_payment_url':_0x41cba0,'merchant_reference_id':_0x126748,'description':_0x3ca0d1(0x112)+_0x126748,'country':'GB','payment_method_types_include':[_0x3ca0d1(0x135),'gb_mastercard_card'],'custom_elements':{'display_description':!![]}};if(_0x1d5cb5!==_0x3ca0d1(0x134)){const _0x33e9f5=Math['floor'](Date[_0x3ca0d1(0xfd)]()/0x3e8)+0x1e*0x3c;_0x59c8be[_0x3ca0d1(0x168)]=_0x3ca0d1(0x109),_0x59c8be['requested_currency']=_0x3ca0d1(0x134),_0x59c8be[_0x3ca0d1(0x16f)]=_0x33e9f5,console['log'](_0x3ca0d1(0x140)+_0x1d5cb5+_0x3ca0d1(0x100)),console[_0x3ca0d1(0x108)](_0x3ca0d1(0x141)),console[_0x3ca0d1(0x108)](_0x3ca0d1(0x118)),console[_0x3ca0d1(0x108)](_0x3ca0d1(0x10a)+_0x33e9f5+'\x20('+new Date(_0x33e9f5*0x3e8)[_0x3ca0d1(0x14b)]()+')');}const _0x306441=Date[_0x3ca0d1(0xfd)]();try{console[_0x3ca0d1(0x108)](_0x3ca0d1(0x16e)),console['log'](_0x3ca0d1(0x11c),this['apiUrl']),console[_0x3ca0d1(0x108)]('Request\x20Body\x20(Updated\x20Format):',JSON['stringify'](_0x59c8be,null,0x2)),console[_0x3ca0d1(0x108)]('üá¨üáß\x20Country:\x20'+_0x2b421f+_0x3ca0d1(0x11a)),console[_0x3ca0d1(0x108)](_0x3ca0d1(0x16c)),loggerService_1[_0x3ca0d1(0x113)]['logWhiteDomainRequest'](_0x3ca0d1(0x110),_0x3ca0d1(0x107),_0x3ca0d1(0x13c),_0x59c8be);const _0x16f27f=await fetch(this[_0x3ca0d1(0x131)],{'method':_0x3ca0d1(0x13c),'headers':{'Content-Type':_0x3ca0d1(0x11b),'User-Agent':_0x3ca0d1(0x14e)},'body':JSON['stringify'](_0x59c8be)}),_0x18a009=Date[_0x3ca0d1(0xfd)]()-_0x306441;console['log'](_0x3ca0d1(0x104)),console[_0x3ca0d1(0x108)](_0x3ca0d1(0x14f),_0x16f27f['status']),console[_0x3ca0d1(0x108)]('Status\x20Text:',_0x16f27f['statusText']),console[_0x3ca0d1(0x108)]('Headers:',Object[_0x3ca0d1(0x146)](_0x16f27f[_0x3ca0d1(0x161)]['entries']())),console[_0x3ca0d1(0x108)](_0x3ca0d1(0x137),_0x18a009+'ms');const _0x3c5656=await _0x16f27f['text']();console['log']('Raw\x20Response\x20Body:',_0x3c5656);if(!_0x16f27f['ok']){console[_0x3ca0d1(0x105)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x3ca0d1(0x105)](_0x3ca0d1(0x15c),_0x16f27f[_0x3ca0d1(0x14d)]),console[_0x3ca0d1(0x105)](_0x3ca0d1(0x13f),_0x3c5656),loggerService_1[_0x3ca0d1(0x113)][_0x3ca0d1(0x11e)](_0x3ca0d1(0x110),'/v1/hosted/payment_links',_0x16f27f[_0x3ca0d1(0x14d)],_0x3c5656,_0x18a009),loggerService_1[_0x3ca0d1(0x113)][_0x3ca0d1(0x149)](_0x3ca0d1(0x110),_0x3ca0d1(0x107),_0x3ca0d1(0x150)+_0x16f27f[_0x3ca0d1(0x14d)]+':\x20'+_0x3c5656);throw new Error(_0x3ca0d1(0x145)+_0x16f27f[_0x3ca0d1(0x14d)]+_0x3ca0d1(0xfa)+_0x3c5656);}let _0x2bbe8f;try{_0x2bbe8f=JSON[_0x3ca0d1(0x12a)](_0x3c5656);}catch(_0x33e691){console[_0x3ca0d1(0x105)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x33e691),loggerService_1['loggerService'][_0x3ca0d1(0x149)](_0x3ca0d1(0x110),'/v1/hosted/payment_links',_0x3ca0d1(0xf9)+_0x33e691);throw new Error(_0x3ca0d1(0x139)+_0x3c5656);}console['log'](_0x3ca0d1(0x102)),console[_0x3ca0d1(0x108)](_0x3ca0d1(0x122),JSON[_0x3ca0d1(0x164)](_0x2bbe8f,null,0x2)),loggerService_1[_0x3ca0d1(0x113)][_0x3ca0d1(0x11e)](_0x3ca0d1(0x110),'/v1/hosted/payment_links',_0x16f27f[_0x3ca0d1(0x14d)],_0x2bbe8f,_0x18a009);if(_0x2bbe8f['status']?.[_0x3ca0d1(0x14d)]!==_0x3ca0d1(0x10d)){const _0x29e65e=_0x2bbe8f[_0x3ca0d1(0x14d)]?.[_0x3ca0d1(0x14c)]||_0x3ca0d1(0x123),_0x54eda8=_0x2bbe8f[_0x3ca0d1(0x14d)]?.[_0x3ca0d1(0x15a)]||'UNKNOWN';console['error'](_0x3ca0d1(0x144)),console[_0x3ca0d1(0x105)](_0x3ca0d1(0x14a),_0x54eda8),console[_0x3ca0d1(0x105)](_0x3ca0d1(0x117),_0x29e65e),console[_0x3ca0d1(0x105)](_0x3ca0d1(0x10b),_0x2bbe8f[_0x3ca0d1(0x14d)]),loggerService_1[_0x3ca0d1(0x113)][_0x3ca0d1(0x149)](_0x3ca0d1(0x110),_0x3ca0d1(0x107),'Business\x20Error\x20('+_0x54eda8+_0x3ca0d1(0x171)+_0x29e65e);throw new Error(_0x3ca0d1(0x169)+_0x54eda8+_0x3ca0d1(0x171)+_0x29e65e);}if(!_0x2bbe8f[_0x3ca0d1(0x172)]?.['id']||!_0x2bbe8f['data']?.[_0x3ca0d1(0x114)]){console['error'](_0x3ca0d1(0x13b)),console[_0x3ca0d1(0x105)](_0x3ca0d1(0x15f)),console[_0x3ca0d1(0x105)](_0x3ca0d1(0x155),_0x2bbe8f[_0x3ca0d1(0x172)]),loggerService_1[_0x3ca0d1(0x113)]['logWhiteDomainError'](_0x3ca0d1(0x110),_0x3ca0d1(0x107),_0x3ca0d1(0x156));throw new Error(_0x3ca0d1(0x15d));}return console[_0x3ca0d1(0x108)]('===\x20RAPYD\x20SUCCESS\x20==='),console[_0x3ca0d1(0x108)]('Payment\x20Link\x20ID:',_0x2bbe8f[_0x3ca0d1(0x172)]['id']),console[_0x3ca0d1(0x108)](_0x3ca0d1(0x15b),_0x2bbe8f[_0x3ca0d1(0x172)][_0x3ca0d1(0x114)]),console[_0x3ca0d1(0x108)](_0x3ca0d1(0x147)+_0x2b421f+_0x3ca0d1(0x136)),console[_0x3ca0d1(0x108)](_0x3ca0d1(0x16c)),{'gateway_payment_id':_0x2bbe8f[_0x3ca0d1(0x172)]['id'],'payment_url':_0x2bbe8f['data'][_0x3ca0d1(0x114)]};}catch(_0x3588ae){console['error'](_0x3ca0d1(0x12d)),console[_0x3ca0d1(0x105)](_0x3ca0d1(0x143),_0x3588ae),loggerService_1[_0x3ca0d1(0x113)][_0x3ca0d1(0x149)](_0x3ca0d1(0x110),_0x3ca0d1(0x107),_0x3588ae);if(_0x3588ae instanceof Error){console[_0x3ca0d1(0x105)](_0x3ca0d1(0x129),_0x3588ae[_0x3ca0d1(0x14c)]),console[_0x3ca0d1(0x105)](_0x3ca0d1(0x132),_0x3588ae['stack']);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x3588ae['message']);}throw new Error(_0x3ca0d1(0x16b));}}async[a48_0x12676e(0x154)](_0x522500){const _0x4c364f=a48_0x12676e,_0x1d26d6=Date['now']();try{loggerService_1[_0x4c364f(0x113)][_0x4c364f(0xf6)](_0x4c364f(0x110),'/v1/hosted/payment_links/'+_0x522500,_0x4c364f(0x10e),{});const _0x4a2f95=await fetch(this[_0x4c364f(0x131)]+'/'+_0x522500,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x5be2d1=Date[_0x4c364f(0xfd)]()-_0x1d26d6;if(!_0x4a2f95['ok']){const _0x356e83=await _0x4a2f95[_0x4c364f(0xf8)]();loggerService_1[_0x4c364f(0x113)]['logWhiteDomainResponse'](_0x4c364f(0x110),_0x4c364f(0x163)+_0x522500,_0x4a2f95[_0x4c364f(0x14d)],_0x356e83,_0x5be2d1);throw new Error(_0x4c364f(0x145)+_0x4a2f95['status']);}const _0x5f40bd=await _0x4a2f95['json']();loggerService_1[_0x4c364f(0x113)][_0x4c364f(0x11e)](_0x4c364f(0x110),_0x4c364f(0x163)+_0x522500,_0x4a2f95['status'],_0x5f40bd,_0x5be2d1);if(_0x5f40bd[_0x4c364f(0x14d)]?.[_0x4c364f(0x14d)]!==_0x4c364f(0x10d)){loggerService_1[_0x4c364f(0x113)][_0x4c364f(0x149)](_0x4c364f(0x110),_0x4c364f(0x163)+_0x522500,'Rapyd\x20API\x20error:\x20'+(_0x5f40bd[_0x4c364f(0x14d)]?.[_0x4c364f(0x14c)]||_0x4c364f(0x13a)));throw new Error(_0x4c364f(0x167)+(_0x5f40bd[_0x4c364f(0x14d)]?.[_0x4c364f(0x14c)]||_0x4c364f(0x13a)));}let _0x190e4d=_0x4c364f(0x16a);if(_0x5f40bd['data']?.['status'])switch(_0x5f40bd[_0x4c364f(0x172)][_0x4c364f(0x14d)][_0x4c364f(0x142)]()){case _0x4c364f(0x157):_0x190e4d=_0x4c364f(0x125);break;case _0x4c364f(0x158):_0x190e4d=_0x4c364f(0x151);break;case _0x4c364f(0x11f):_0x190e4d='EXPIRED';break;case _0x4c364f(0x111):_0x190e4d='FAILED';break;case'NEW':case _0x4c364f(0x13e):default:_0x190e4d=_0x4c364f(0x16a);break;}return{'status':_0x190e4d,'amount':_0x5f40bd[_0x4c364f(0x172)]?.[_0x4c364f(0x162)],'currency':_0x5f40bd[_0x4c364f(0x172)]?.[_0x4c364f(0xfe)]};}catch(_0x2ace18){console[_0x4c364f(0x105)]('Rapyd\x20payment\x20verification\x20error:',_0x2ace18),loggerService_1[_0x4c364f(0x113)]['logWhiteDomainError'](_0x4c364f(0x110),'/v1/hosted/payment_links/'+_0x522500,_0x2ace18);throw new Error(_0x4c364f(0x12b)+(_0x2ace18 instanceof Error?_0x2ace18[_0x4c364f(0x14c)]:_0x4c364f(0x13a)));}}async[a48_0x12676e(0x12e)](_0x34a691){const _0x24a92a=a48_0x12676e;console[_0x24a92a(0x108)](_0x24a92a(0x130),_0x34a691);let _0x5a1d00=_0x24a92a(0x16a),_0x5c8b92;_0x34a691['data']?.[_0x24a92a(0x101)]&&(_0x5c8b92=_0x34a691['data'][_0x24a92a(0x101)],console[_0x24a92a(0x108)](_0x24a92a(0xff)+_0x5c8b92));switch(_0x34a691[_0x24a92a(0x115)]?.[_0x24a92a(0x142)]()){case _0x24a92a(0xf4):_0x34a691['data']?.['paid']===!![]&&_0x34a691[_0x24a92a(0x172)]?.['status']===_0x24a92a(0x157)?_0x5a1d00=_0x24a92a(0x125):_0x5a1d00=_0x24a92a(0x16a);break;case _0x24a92a(0x152):_0x5a1d00=_0x24a92a(0x151);break;case _0x24a92a(0xfb):_0x5a1d00=_0x24a92a(0x148);break;case _0x24a92a(0x120):_0x5a1d00=_0x24a92a(0x151);!_0x5c8b92&&_0x34a691[_0x24a92a(0x172)]?.[_0x24a92a(0x101)]&&(_0x5c8b92=_0x34a691['data'][_0x24a92a(0x101)]);break;default:switch(_0x34a691['data']?.[_0x24a92a(0x14d)]?.[_0x24a92a(0x142)]()){case'CLO':_0x34a691[_0x24a92a(0x172)]?.['paid']===!![]?_0x5a1d00=_0x24a92a(0x125):_0x5a1d00='FAILED';break;case _0x24a92a(0x158):_0x5a1d00=_0x24a92a(0x151);break;case'EXP':_0x5a1d00=_0x24a92a(0x148);break;case _0x24a92a(0x111):_0x5a1d00=_0x24a92a(0x151);!_0x5c8b92&&_0x34a691[_0x24a92a(0x172)]?.[_0x24a92a(0x101)]&&(_0x5c8b92=_0x34a691['data'][_0x24a92a(0x101)]);break;case'NEW':case _0x24a92a(0x13e):default:_0x5a1d00=_0x24a92a(0x16a);break;}break;}const _0x269da9={};return _0x34a691[_0x24a92a(0x172)]?.['payment_method_data']?.[_0x24a92a(0x138)]&&(_0x269da9[_0x24a92a(0x11d)]=_0x34a691[_0x24a92a(0x172)]['payment_method_data']['last4']),_0x34a691['data']?.[_0x24a92a(0x16d)]&&(_0x269da9[_0x24a92a(0x166)]=_0x34a691[_0x24a92a(0x172)][_0x24a92a(0x16d)]),_0x34a691[_0x24a92a(0x172)]?.[_0x24a92a(0x15a)]&&(_0x269da9[_0x24a92a(0x12f)]=_0x34a691['data'][_0x24a92a(0x15a)]),_0x34a691['data']?.[_0x24a92a(0x153)]&&(_0x269da9[_0x24a92a(0x12c)]=_0x34a691[_0x24a92a(0x172)][_0x24a92a(0x153)]),console[_0x24a92a(0x108)](_0x24a92a(0xf7)+_0x5a1d00+_0x24a92a(0x126)+(_0x5c8b92||_0x24a92a(0x170))),{'paymentId':_0x34a691['data']?.['merchant_reference_id']||'','status':_0x5a1d00,'amount':_0x34a691['data']?.['amount'],'currency':_0x34a691[_0x24a92a(0x172)]?.[_0x24a92a(0xfe)],'failureMessage':_0x5c8b92,'additionalInfo':_0x269da9};}}exports[a48_0x12676e(0x103)]=RapydService;