'use strict';const a45_0x5bd266=a45_0x3c22;(function(_0x4c5a62,_0x193cca){const _0x44415e=a45_0x3c22,_0x4a7dce=_0x4c5a62();while(!![]){try{const _0x3ba218=parseInt(_0x44415e(0x209))/0x1+parseInt(_0x44415e(0x1ee))/0x2+-parseInt(_0x44415e(0x1e3))/0x3+parseInt(_0x44415e(0x21b))/0x4*(parseInt(_0x44415e(0x1ed))/0x5)+-parseInt(_0x44415e(0x1cd))/0x6*(parseInt(_0x44415e(0x1ff))/0x7)+parseInt(_0x44415e(0x1ef))/0x8*(parseInt(_0x44415e(0x1e5))/0x9)+-parseInt(_0x44415e(0x1e6))/0xa*(-parseInt(_0x44415e(0x208))/0xb);if(_0x3ba218===_0x193cca)break;else _0x4a7dce['push'](_0x4a7dce['shift']());}catch(_0x4d927c){_0x4a7dce['push'](_0x4a7dce['shift']());}}}(a45_0x1fb4,0xcb737));function a45_0x3c22(_0x170182,_0x21460c){const _0x1fb4f9=a45_0x1fb4();return a45_0x3c22=function(_0x3c2275,_0x2fe6e6){_0x3c2275=_0x3c2275-0x1a8;let _0x382f9b=_0x1fb4f9[_0x3c2275];return _0x382f9b;},a45_0x3c22(_0x170182,_0x21460c);}Object[a45_0x5bd266(0x1ec)](exports,a45_0x5bd266(0x1f3),{'value':!![]}),exports[a45_0x5bd266(0x201)]=void 0x0;const loggerService_1=require('../loggerService');class RapydService{constructor(){const _0x5c6990=a45_0x5bd266;this[_0x5c6990(0x1de)]=_0x5c6990(0x1cf),console[_0x5c6990(0x1e1)]('üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a45_0x5bd266(0x1bf)](_0x3af473){const _0x3eea80=a45_0x5bd266,{orderId:_0x20d485,orderName:_0xe872a9,amount:_0x5119eb,currency:_0x3f673d,usage:_0x263072,maxPayments:_0x1d2856,successUrl:_0x3febba,failUrl:_0x3ce728}=_0x3af473,_0x29b634=_0x3f673d[_0x3eea80(0x20c)](),_0x19e367='GB';console[_0x3eea80(0x1e1)](_0x3eea80(0x1c1));const _0x15a76a=_0x3eea80(0x21d)+_0x20d485,_0x188487='https://tesoft.uk/gateway/fail.php?id='+_0x20d485,_0x1d7f9e={'amount':_0x5119eb,'currency':_0x29b634,'cancel_checkout_url':_0x188487,'complete_checkout_url':_0x15a76a,'complete_payment_url':_0x15a76a,'merchant_reference_id':_0x20d485,'description':_0x3eea80(0x1e2)+_0x20d485,'country':'GB','payment_method_types_include':[_0x3eea80(0x1df),'gb_mastercard_card'],'custom_elements':{'display_description':!![]}},_0x425072=Date[_0x3eea80(0x1a9)]();try{console[_0x3eea80(0x1e1)](_0x3eea80(0x1d5)),console['log'](_0x3eea80(0x1f6),this['apiUrl']),console['log'](_0x3eea80(0x1c3),JSON[_0x3eea80(0x1d9)](_0x1d7f9e,null,0x2)),console['log']('üá¨üáß\x20Country:\x20'+_0x19e367+_0x3eea80(0x1f4)),console['log']('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),loggerService_1[_0x3eea80(0x205)]['logWhiteDomainRequest'](_0x3eea80(0x20e),'/v1/hosted/payment_links','POST',_0x1d7f9e);const _0x378ffd=await fetch(this[_0x3eea80(0x1de)],{'method':_0x3eea80(0x1e8),'headers':{'Content-Type':'application/json','User-Agent':_0x3eea80(0x1eb)},'body':JSON[_0x3eea80(0x1d9)](_0x1d7f9e)}),_0x4334a4=Date[_0x3eea80(0x1a9)]()-_0x425072;console[_0x3eea80(0x1e1)](_0x3eea80(0x1c8)),console[_0x3eea80(0x1e1)]('Status:',_0x378ffd[_0x3eea80(0x1b6)]),console[_0x3eea80(0x1e1)](_0x3eea80(0x1dc),_0x378ffd[_0x3eea80(0x1e0)]),console[_0x3eea80(0x1e1)](_0x3eea80(0x1b7),Object['fromEntries'](_0x378ffd[_0x3eea80(0x1c9)][_0x3eea80(0x1ae)]())),console[_0x3eea80(0x1e1)](_0x3eea80(0x1bc),_0x4334a4+'ms');const _0x2c9947=await _0x378ffd['text']();console[_0x3eea80(0x1e1)]('Raw\x20Response\x20Body:',_0x2c9947);if(!_0x378ffd['ok']){console[_0x3eea80(0x20b)](_0x3eea80(0x1b9)),console[_0x3eea80(0x20b)](_0x3eea80(0x1d7),_0x378ffd[_0x3eea80(0x1b6)]),console['error'](_0x3eea80(0x1c7),_0x2c9947),loggerService_1[_0x3eea80(0x205)][_0x3eea80(0x1d8)]('rapyd',_0x3eea80(0x1ac),_0x378ffd[_0x3eea80(0x1b6)],_0x2c9947,_0x4334a4),loggerService_1[_0x3eea80(0x205)][_0x3eea80(0x1fd)]('rapyd',_0x3eea80(0x1ac),_0x3eea80(0x1f8)+_0x378ffd[_0x3eea80(0x1b6)]+':\x20'+_0x2c9947);throw new Error(_0x3eea80(0x1ca)+_0x378ffd[_0x3eea80(0x1b6)]+_0x3eea80(0x216)+_0x2c9947);}let _0xbfec36;try{_0xbfec36=JSON[_0x3eea80(0x1a8)](_0x2c9947);}catch(_0x6ab821){console['error'](_0x3eea80(0x1da),_0x6ab821),loggerService_1[_0x3eea80(0x205)][_0x3eea80(0x1fd)](_0x3eea80(0x20e),'/v1/hosted/payment_links','JSON\x20Parse\x20Error:\x20'+_0x6ab821);throw new Error(_0x3eea80(0x203)+_0x2c9947);}console[_0x3eea80(0x1e1)]('===\x20PARSED\x20RAPYD\x20RESPONSE\x20==='),console[_0x3eea80(0x1e1)]('Parsed\x20Result:',JSON[_0x3eea80(0x1d9)](_0xbfec36,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3eea80(0x20e),'/v1/hosted/payment_links',_0x378ffd[_0x3eea80(0x1b6)],_0xbfec36,_0x4334a4);if(_0xbfec36[_0x3eea80(0x1b6)]?.['status']!==_0x3eea80(0x1c2)){const _0x10608d=_0xbfec36[_0x3eea80(0x1b6)]?.[_0x3eea80(0x207)]||_0x3eea80(0x1c6),_0x141978=_0xbfec36[_0x3eea80(0x1b6)]?.['error_code']||_0x3eea80(0x1ad);console[_0x3eea80(0x20b)]('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x3eea80(0x20b)](_0x3eea80(0x1c5),_0x141978),console[_0x3eea80(0x20b)](_0x3eea80(0x215),_0x10608d),console[_0x3eea80(0x20b)](_0x3eea80(0x214),_0xbfec36[_0x3eea80(0x1b6)]),loggerService_1[_0x3eea80(0x205)][_0x3eea80(0x1fd)](_0x3eea80(0x20e),_0x3eea80(0x1ac),_0x3eea80(0x1f1)+_0x141978+_0x3eea80(0x21f)+_0x10608d);throw new Error(_0x3eea80(0x218)+_0x141978+_0x3eea80(0x21f)+_0x10608d);}if(!_0xbfec36[_0x3eea80(0x1d0)]?.['id']||!_0xbfec36[_0x3eea80(0x1d0)]?.[_0x3eea80(0x1be)]){console['error'](_0x3eea80(0x204)),console[_0x3eea80(0x20b)](_0x3eea80(0x1b0)),console['error'](_0x3eea80(0x1d6),_0xbfec36[_0x3eea80(0x1d0)]),loggerService_1[_0x3eea80(0x205)][_0x3eea80(0x1fd)]('rapyd',_0x3eea80(0x1ac),_0x3eea80(0x1e9));throw new Error('Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url');}return console[_0x3eea80(0x1e1)](_0x3eea80(0x200)),console[_0x3eea80(0x1e1)](_0x3eea80(0x1af),_0xbfec36[_0x3eea80(0x1d0)]['id']),console['log']('Redirect\x20URL:',_0xbfec36[_0x3eea80(0x1d0)][_0x3eea80(0x1be)]),console['log'](_0x3eea80(0x1e4)+_0x19e367+_0x3eea80(0x217)),console[_0x3eea80(0x1e1)](_0x3eea80(0x1bb)),{'gateway_payment_id':_0xbfec36[_0x3eea80(0x1d0)]['id'],'payment_url':_0xbfec36[_0x3eea80(0x1d0)][_0x3eea80(0x1be)]};}catch(_0x4238a5){console[_0x3eea80(0x20b)](_0x3eea80(0x1ce)),console[_0x3eea80(0x20b)](_0x3eea80(0x1f9),_0x4238a5),loggerService_1['loggerService']['logWhiteDomainError']('rapyd',_0x3eea80(0x1ac),_0x4238a5);if(_0x4238a5 instanceof Error){console[_0x3eea80(0x20b)](_0x3eea80(0x211),_0x4238a5[_0x3eea80(0x207)]),console['error'](_0x3eea80(0x1b4),_0x4238a5[_0x3eea80(0x1d3)]);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x4238a5[_0x3eea80(0x207)]);}throw new Error(_0x3eea80(0x1bd));}}async[a45_0x5bd266(0x21a)](_0x54777e){const _0x59625a=a45_0x5bd266,_0xa1c0b3=Date[_0x59625a(0x1a9)]();try{loggerService_1['loggerService'][_0x59625a(0x1ea)]('rapyd',_0x59625a(0x1fa)+_0x54777e,'GET',{});const _0x4665da=await fetch(this[_0x59625a(0x1de)]+'/'+_0x54777e,{'method':_0x59625a(0x1cb),'headers':{'Content-Type':_0x59625a(0x1db),'User-Agent':_0x59625a(0x1eb)}}),_0x3c033a=Date['now']()-_0xa1c0b3;if(!_0x4665da['ok']){const _0x7b9956=await _0x4665da[_0x59625a(0x202)]();loggerService_1[_0x59625a(0x205)][_0x59625a(0x1d8)](_0x59625a(0x20e),_0x59625a(0x1fa)+_0x54777e,_0x4665da[_0x59625a(0x1b6)],_0x7b9956,_0x3c033a);throw new Error(_0x59625a(0x1ca)+_0x4665da[_0x59625a(0x1b6)]);}const _0x3b68cf=await _0x4665da['json']();loggerService_1[_0x59625a(0x205)][_0x59625a(0x1d8)]('rapyd',_0x59625a(0x1fa)+_0x54777e,_0x4665da[_0x59625a(0x1b6)],_0x3b68cf,_0x3c033a);if(_0x3b68cf[_0x59625a(0x1b6)]?.[_0x59625a(0x1b6)]!==_0x59625a(0x1c2)){loggerService_1[_0x59625a(0x205)][_0x59625a(0x1fd)](_0x59625a(0x20e),_0x59625a(0x1fa)+_0x54777e,_0x59625a(0x1ba)+(_0x3b68cf['status']?.['message']||_0x59625a(0x1b8)));throw new Error(_0x59625a(0x1ba)+(_0x3b68cf['status']?.[_0x59625a(0x207)]||_0x59625a(0x1b8)));}let _0x266dd9='PENDING';if(_0x3b68cf[_0x59625a(0x1d0)]?.[_0x59625a(0x1b6)])switch(_0x3b68cf[_0x59625a(0x1d0)][_0x59625a(0x1b6)][_0x59625a(0x20c)]()){case _0x59625a(0x1f0):_0x266dd9='PAID';break;case _0x59625a(0x1b2):_0x266dd9=_0x59625a(0x1fb);break;case _0x59625a(0x21c):_0x266dd9=_0x59625a(0x213);break;case _0x59625a(0x1fc):_0x266dd9=_0x59625a(0x1fb);break;case _0x59625a(0x1d2):case _0x59625a(0x212):default:_0x266dd9=_0x59625a(0x20a);break;}return{'status':_0x266dd9,'amount':_0x3b68cf['data']?.[_0x59625a(0x1d4)],'currency':_0x3b68cf['data']?.[_0x59625a(0x1e7)]};}catch(_0x1a588b){console[_0x59625a(0x20b)]('Rapyd\x20payment\x20verification\x20error:',_0x1a588b),loggerService_1[_0x59625a(0x205)][_0x59625a(0x1fd)](_0x59625a(0x20e),_0x59625a(0x1fa)+_0x54777e,_0x1a588b);throw new Error(_0x59625a(0x219)+(_0x1a588b instanceof Error?_0x1a588b[_0x59625a(0x207)]:'Unknown\x20error'));}}async['processWebhook'](_0x47156d){const _0xb742c=a45_0x5bd266;console[_0xb742c(0x1e1)](_0xb742c(0x1f2),_0x47156d);let _0x38aff6=_0xb742c(0x20a),_0x4c1bae;_0x47156d[_0xb742c(0x1d0)]?.['failure_message']&&(_0x4c1bae=_0x47156d['data']['failure_message'],console[_0xb742c(0x1e1)]('üí•\x20Rapyd\x20failure\x20message:\x20'+_0x4c1bae));switch(_0x47156d[_0xb742c(0x206)]?.[_0xb742c(0x20c)]()){case _0xb742c(0x210):_0x47156d[_0xb742c(0x1d0)]?.[_0xb742c(0x20d)]===!![]&&_0x47156d[_0xb742c(0x1d0)]?.[_0xb742c(0x1b6)]===_0xb742c(0x1f0)?_0x38aff6=_0xb742c(0x21e):_0x38aff6=_0xb742c(0x20a);break;case _0xb742c(0x1b1):_0x38aff6=_0xb742c(0x1fb);break;case _0xb742c(0x1aa):_0x38aff6=_0xb742c(0x213);break;case _0xb742c(0x1f5):_0x38aff6=_0xb742c(0x1fb);!_0x4c1bae&&_0x47156d[_0xb742c(0x1d0)]?.['failure_message']&&(_0x4c1bae=_0x47156d['data'][_0xb742c(0x1d1)]);break;default:switch(_0x47156d[_0xb742c(0x1d0)]?.[_0xb742c(0x1b6)]?.['toUpperCase']()){case _0xb742c(0x1f0):_0x47156d['data']?.[_0xb742c(0x20d)]===!![]?_0x38aff6='PAID':_0x38aff6='FAILED';break;case'CAN':_0x38aff6=_0xb742c(0x1fb);break;case _0xb742c(0x21c):_0x38aff6=_0xb742c(0x213);break;case'ERR':_0x38aff6=_0xb742c(0x1fb);!_0x4c1bae&&_0x47156d[_0xb742c(0x1d0)]?.['failure_message']&&(_0x4c1bae=_0x47156d[_0xb742c(0x1d0)][_0xb742c(0x1d1)]);break;case'NEW':case _0xb742c(0x212):default:_0x38aff6=_0xb742c(0x20a);break;}break;}const _0x1ede7d={};return _0x47156d['data']?.[_0xb742c(0x1dd)]?.[_0xb742c(0x1ab)]&&(_0x1ede7d[_0xb742c(0x1cc)]=_0x47156d[_0xb742c(0x1d0)][_0xb742c(0x1dd)][_0xb742c(0x1ab)]),_0x47156d[_0xb742c(0x1d0)]?.[_0xb742c(0x1b5)]&&(_0x1ede7d[_0xb742c(0x1b3)]=_0x47156d[_0xb742c(0x1d0)][_0xb742c(0x1b5)]),_0x47156d[_0xb742c(0x1d0)]?.[_0xb742c(0x1c4)]&&(_0x1ede7d['errorCode']=_0x47156d[_0xb742c(0x1d0)]['error_code']),_0x47156d[_0xb742c(0x1d0)]?.[_0xb742c(0x1f7)]&&(_0x1ede7d[_0xb742c(0x1fe)]=_0x47156d[_0xb742c(0x1d0)]['failure_code']),console[_0xb742c(0x1e1)](_0xb742c(0x20f)+_0x38aff6+',\x20failureMessage='+(_0x4c1bae||_0xb742c(0x1c0))),{'paymentId':_0x47156d[_0xb742c(0x1d0)]?.['merchant_reference_id']||'','status':_0x38aff6,'amount':_0x47156d['data']?.[_0xb742c(0x1d4)],'currency':_0x47156d[_0xb742c(0x1d0)]?.[_0xb742c(0x1e7)],'failureMessage':_0x4c1bae,'additionalInfo':_0x1ede7d};}}exports[a45_0x5bd266(0x201)]=RapydService;function a45_0x1fb4(){const _0x5056f6=['Headers:','Unknown\x20error','===\x20RAPYD\x20API\x20ERROR\x20===','Rapyd\x20API\x20error:\x20','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','Response\x20Time:','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','redirect_url','createPaymentLink','none','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','SUCCESS','Request\x20Body\x20(Updated\x20Format):','error_code','Error\x20Code:','Unknown\x20error\x20from\x20Rapyd\x20API','Response\x20Body:','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','headers','HTTP\x20error!\x20status:\x20','GET','cardLast4','18LBNTUw','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','https://tesoft.uk/gateway/rapyd/','data','failure_message','NEW','stack','amount','===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20===','Response\x20data:','HTTP\x20Status:','logWhiteDomainResponse','stringify','Failed\x20to\x20parse\x20JSON\x20response:','application/json','Status\x20Text:','payment_method_data','apiUrl','gb_visa_card','statusText','log','ORDER:\x20','4574652BdRyzF','üá¨üáß\x20Country\x20used:\x20','73260xeQtFf','35930lRLCvm','currency','POST','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','logWhiteDomainRequest','TesSoft\x20Payment\x20System/1.0','defineProperty','15eEqBBX','1528398YsbZcy','120fqcLkv','CLO','Business\x20Error\x20(','Processing\x20Rapyd\x20webhook:','__esModule','\x20(always\x20GB\x20for\x20Rapyd)','PAYMENT_FAILED','URL:','failure_code','HTTP\x20','Error\x20details:','/v1/hosted/payment_links/','FAILED','ERR','logWhiteDomainError','failureCode','1574643Xqpvhm','===\x20RAPYD\x20SUCCESS\x20===','RapydService','text','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20===','loggerService','type','message','341BrtqXi','1115968rKVUxq','PENDING','error','toUpperCase','paid','rapyd','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','PAYMENT_COMPLETED','Error\x20message:','ACT','EXPIRED','Full\x20Error\x20Data:','Error\x20Message:',',\x20body:\x20','\x20(GB\x20-\x20Britain)','Rapyd\x20API\x20error\x20(','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','verifyPayment','1225888ENyBUe','EXP','https://tesoft.uk/gateway/success.php?id=','PAID','):\x20','parse','now','PAYMENT_EXPIRED','last4','/v1/hosted/payment_links','UNKNOWN','entries','Payment\x20Link\x20ID:','Missing\x20id\x20or\x20redirect_url\x20in\x20response','PAYMENT_CANCELED','CAN','paymentMethod','Error\x20stack:','payment_method_type','status'];a45_0x1fb4=function(){return _0x5056f6;};return a45_0x1fb4();}