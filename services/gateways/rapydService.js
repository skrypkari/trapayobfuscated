'use strict';const a45_0x3b085c=a45_0x2f63;(function(_0x5317c1,_0x2fed86){const _0x451553=a45_0x2f63,_0x3b8258=_0x5317c1();while(!![]){try{const _0x4356da=parseInt(_0x451553(0x16c))/0x1+-parseInt(_0x451553(0x1bb))/0x2+parseInt(_0x451553(0x171))/0x3+-parseInt(_0x451553(0x1d7))/0x4*(-parseInt(_0x451553(0x183))/0x5)+parseInt(_0x451553(0x19e))/0x6*(parseInt(_0x451553(0x1b2))/0x7)+-parseInt(_0x451553(0x18f))/0x8+parseInt(_0x451553(0x19d))/0x9*(-parseInt(_0x451553(0x1b4))/0xa);if(_0x4356da===_0x2fed86)break;else _0x3b8258['push'](_0x3b8258['shift']());}catch(_0x25c273){_0x3b8258['push'](_0x3b8258['shift']());}}}(a45_0xc4fa,0xf1015));Object[a45_0x3b085c(0x182)](exports,'__esModule',{'value':!![]}),exports[a45_0x3b085c(0x1cf)]=void 0x0;const loggerService_1=require(a45_0x3b085c(0x1a4));function a45_0x2f63(_0x90aa34,_0x5c4fac){const _0xc4fa09=a45_0xc4fa();return a45_0x2f63=function(_0x2f634f,_0x37aa0d){_0x2f634f=_0x2f634f-0x167;let _0x3365fc=_0xc4fa09[_0x2f634f];return _0x3365fc;},a45_0x2f63(_0x90aa34,_0x5c4fac);}function a45_0xc4fa(){const _0x3d29eb=['toUpperCase','Missing\x20id\x20or\x20redirect_url\x20in\x20response','306WDOFiD','1974qhhpxR','Response\x20Body:','üåê\x20Rapyd\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','CLO','Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20Unknown\x20error','Headers:','../loggerService','/v1/hosted/payment_links/','Business\x20Error\x20(','üá¨üáß\x20Country:\x20','statusText','PAYMENT_COMPLETED','PAYMENT_CANCELED','errorCode','parse','üîÑ\x20Rapyd\x20webhook\x20processed:\x20status=','Redirect\x20URL:','ERR','PENDING','üá¨üáß\x20Using\x20GB\x20(Britain)\x20as\x20country\x20for\x20Rapyd\x20payment\x20link','29680KRivqp','data','431090jqXnUf','EXPIRED','===\x20RAPYD\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainError','failure_message','error','HTTP\x20','1541608BtiKJo','stack','Full\x20Error\x20Data:','HTTP\x20error!\x20status:\x20','message','cardLast4','===\x20PARSED\x20RAPYD\x20RESPONSE\x20===','PAYMENT_FAILED',',\x20body:\x20','https://tesoft.uk/gateway/success.php?id=','FAILED','Rapyd\x20API\x20error:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20redirect_url','TesSoft\x20Payment\x20System/1.0','Error\x20message:','Invalid\x20JSON\x20response\x20from\x20Rapyd\x20API:\x20','HTTP\x20Status:','/v1/hosted/payment_links','Rapyd\x20payment\x20verification\x20error:','loggerService','RapydService','failure_code','üí•\x20Rapyd\x20failure\x20message:\x20','last4','entries','PAID','logWhiteDomainRequest','log','12hebCnX','Raw\x20Response\x20Body:','\x20(GB\x20-\x20Britain)','üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card','amount','Error\x20Code:','redirect_url','Invalid\x20response\x20from\x20Rapyd\x20API:\x20missing\x20id\x20or\x20redirect_url','Status:','1692437NrcJlr','error_code','===\x20RAPYD\x20SUCCESS\x20===','CAN','ORDER:\x20','364272HcqohW','URL:','Response\x20data:','payment_method_type','gb_mastercard_card','currency','Error\x20Message:','UNKNOWN','https://tesoft.uk/gateway/rapyd/','NEW','Parsed\x20Result:','Payment\x20Link\x20ID:','gb_visa_card','payment_method_data','json','Request\x20Body\x20(Updated\x20Format):','SUCCESS','defineProperty','881215NgIuHS','GET','paymentMethod','===\x20RAPYD\x20SERVICE\x20ERROR\x20===','logWhiteDomainResponse','headers','PAYMENT_EXPIRED','Failed\x20to\x20verify\x20Rapyd\x20payment:\x20','EXP','status','now','Unknown\x20error','4111064qjGbTp','createPaymentLink','stringify','Unknown\x20error\x20from\x20Rapyd\x20API','ACT','apiUrl',',\x20failureMessage=','application/json','JSON\x20Parse\x20Error:\x20','):\x20','https://tesoft.uk/gateway/fail.php?id=','rapyd'];a45_0xc4fa=function(){return _0x3d29eb;};return a45_0xc4fa();}class RapydService{constructor(){const _0xe6c4e0=a45_0x3b085c;this[_0xe6c4e0(0x194)]=_0xe6c4e0(0x179),console['log'](_0xe6c4e0(0x1a0));}async[a45_0x3b085c(0x190)](_0x3b06b2){const _0x5bc244=a45_0x3b085c,{orderId:_0x3ff3be,orderName:_0x549d1f,amount:_0x22abba,currency:_0xb82660,usage:_0x2cbd13,maxPayments:_0x11c1be,successUrl:_0x200589,failUrl:_0x301c43}=_0x3b06b2,_0x9329ec=_0xb82660[_0x5bc244(0x19b)](),_0x571e98='GB';console[_0x5bc244(0x1d6)](_0x5bc244(0x1b1));const _0x1f39cb=_0x5bc244(0x1c4)+_0x3ff3be,_0x5b4f2f=_0x5bc244(0x199)+_0x3ff3be,_0x3bb605={'amount':_0x22abba,'currency':_0x9329ec,'cancel_checkout_url':_0x5b4f2f,'complete_checkout_url':_0x1f39cb,'complete_payment_url':_0x1f39cb,'merchant_reference_id':_0x3ff3be,'description':_0x5bc244(0x170)+_0x3ff3be,'country':'GB','payment_method_types_include':[_0x5bc244(0x17d),_0x5bc244(0x175)],'custom_elements':{'display_description':!![]}},_0x414529=Date[_0x5bc244(0x18d)]();try{console[_0x5bc244(0x1d6)]('===\x20RAPYD\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Updated\x20Format)\x20==='),console[_0x5bc244(0x1d6)](_0x5bc244(0x172),this[_0x5bc244(0x194)]),console[_0x5bc244(0x1d6)](_0x5bc244(0x180),JSON[_0x5bc244(0x191)](_0x3bb605,null,0x2)),console['log'](_0x5bc244(0x1a7)+_0x571e98+'\x20(always\x20GB\x20for\x20Rapyd)'),console[_0x5bc244(0x1d6)](_0x5bc244(0x1da)),loggerService_1[_0x5bc244(0x1ce)][_0x5bc244(0x1d5)](_0x5bc244(0x19a),'/v1/hosted/payment_links','POST',_0x3bb605);const _0x4be093=await fetch(this[_0x5bc244(0x194)],{'method':'POST','headers':{'Content-Type':_0x5bc244(0x196),'User-Agent':_0x5bc244(0x1c8)},'body':JSON['stringify'](_0x3bb605)}),_0x210ad9=Date[_0x5bc244(0x18d)]()-_0x414529;console['log'](_0x5bc244(0x1b6)),console[_0x5bc244(0x1d6)](_0x5bc244(0x16b),_0x4be093['status']),console[_0x5bc244(0x1d6)]('Status\x20Text:',_0x4be093[_0x5bc244(0x1a8)]),console[_0x5bc244(0x1d6)](_0x5bc244(0x1a3),Object['fromEntries'](_0x4be093[_0x5bc244(0x188)][_0x5bc244(0x1d3)]())),console[_0x5bc244(0x1d6)]('Response\x20Time:',_0x210ad9+'ms');const _0x3fa801=await _0x4be093['text']();console[_0x5bc244(0x1d6)](_0x5bc244(0x1d8),_0x3fa801);if(!_0x4be093['ok']){console[_0x5bc244(0x1b9)]('===\x20RAPYD\x20API\x20ERROR\x20==='),console[_0x5bc244(0x1b9)](_0x5bc244(0x1cb),_0x4be093['status']),console[_0x5bc244(0x1b9)](_0x5bc244(0x19f),_0x3fa801),loggerService_1[_0x5bc244(0x1ce)][_0x5bc244(0x187)](_0x5bc244(0x19a),_0x5bc244(0x1cc),_0x4be093[_0x5bc244(0x18c)],_0x3fa801,_0x210ad9),loggerService_1[_0x5bc244(0x1ce)][_0x5bc244(0x1b7)](_0x5bc244(0x19a),_0x5bc244(0x1cc),_0x5bc244(0x1ba)+_0x4be093[_0x5bc244(0x18c)]+':\x20'+_0x3fa801);throw new Error(_0x5bc244(0x1be)+_0x4be093[_0x5bc244(0x18c)]+_0x5bc244(0x1c3)+_0x3fa801);}let _0x227267;try{_0x227267=JSON[_0x5bc244(0x1ac)](_0x3fa801);}catch(_0x26f237){console[_0x5bc244(0x1b9)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x26f237),loggerService_1[_0x5bc244(0x1ce)][_0x5bc244(0x1b7)](_0x5bc244(0x19a),'/v1/hosted/payment_links',_0x5bc244(0x197)+_0x26f237);throw new Error(_0x5bc244(0x1ca)+_0x3fa801);}console[_0x5bc244(0x1d6)](_0x5bc244(0x1c1)),console[_0x5bc244(0x1d6)](_0x5bc244(0x17b),JSON['stringify'](_0x227267,null,0x2)),loggerService_1[_0x5bc244(0x1ce)]['logWhiteDomainResponse'](_0x5bc244(0x19a),_0x5bc244(0x1cc),_0x4be093[_0x5bc244(0x18c)],_0x227267,_0x210ad9);if(_0x227267[_0x5bc244(0x18c)]?.[_0x5bc244(0x18c)]!==_0x5bc244(0x181)){const _0xcb095a=_0x227267['status']?.[_0x5bc244(0x1bf)]||_0x5bc244(0x192),_0x220114=_0x227267[_0x5bc244(0x18c)]?.[_0x5bc244(0x16d)]||_0x5bc244(0x178);console['error']('===\x20RAPYD\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x5bc244(0x168),_0x220114),console[_0x5bc244(0x1b9)](_0x5bc244(0x177),_0xcb095a),console[_0x5bc244(0x1b9)](_0x5bc244(0x1bd),_0x227267[_0x5bc244(0x18c)]),loggerService_1[_0x5bc244(0x1ce)][_0x5bc244(0x1b7)](_0x5bc244(0x19a),_0x5bc244(0x1cc),_0x5bc244(0x1a6)+_0x220114+'):\x20'+_0xcb095a);throw new Error('Rapyd\x20API\x20error\x20('+_0x220114+_0x5bc244(0x198)+_0xcb095a);}if(!_0x227267['data']?.['id']||!_0x227267['data']?.[_0x5bc244(0x169)]){console['error']('===\x20RAPYD\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x5bc244(0x1b9)](_0x5bc244(0x19c)),console[_0x5bc244(0x1b9)](_0x5bc244(0x173),_0x227267['data']),loggerService_1['loggerService']['logWhiteDomainError'](_0x5bc244(0x19a),_0x5bc244(0x1cc),_0x5bc244(0x1c7));throw new Error(_0x5bc244(0x16a));}return console[_0x5bc244(0x1d6)](_0x5bc244(0x16e)),console['log'](_0x5bc244(0x17c),_0x227267['data']['id']),console[_0x5bc244(0x1d6)](_0x5bc244(0x1ae),_0x227267['data'][_0x5bc244(0x169)]),console[_0x5bc244(0x1d6)]('üá¨üáß\x20Country\x20used:\x20'+_0x571e98+_0x5bc244(0x1d9)),console[_0x5bc244(0x1d6)]('üí≥\x20Payment\x20Methods:\x20gb_visa_card,\x20gb_mastercard_card'),{'gateway_payment_id':_0x227267[_0x5bc244(0x1b3)]['id'],'payment_url':_0x227267[_0x5bc244(0x1b3)]['redirect_url']};}catch(_0x59fd40){console[_0x5bc244(0x1b9)](_0x5bc244(0x186)),console[_0x5bc244(0x1b9)]('Error\x20details:',_0x59fd40),loggerService_1['loggerService'][_0x5bc244(0x1b7)]('rapyd',_0x5bc244(0x1cc),_0x59fd40);if(_0x59fd40 instanceof Error){console[_0x5bc244(0x1b9)](_0x5bc244(0x1c9),_0x59fd40['message']),console['error']('Error\x20stack:',_0x59fd40[_0x5bc244(0x1bc)]);throw new Error('Failed\x20to\x20create\x20Rapyd\x20payment\x20link:\x20'+_0x59fd40['message']);}throw new Error(_0x5bc244(0x1a2));}}async['verifyPayment'](_0x465517){const _0x5b99d2=a45_0x3b085c,_0xfd7bb1=Date[_0x5b99d2(0x18d)]();try{loggerService_1[_0x5b99d2(0x1ce)][_0x5b99d2(0x1d5)]('rapyd',_0x5b99d2(0x1a5)+_0x465517,'GET',{});const _0x28cc34=await fetch(this[_0x5b99d2(0x194)]+'/'+_0x465517,{'method':_0x5b99d2(0x184),'headers':{'Content-Type':_0x5b99d2(0x196),'User-Agent':_0x5b99d2(0x1c8)}}),_0xa8c417=Date[_0x5b99d2(0x18d)]()-_0xfd7bb1;if(!_0x28cc34['ok']){const _0x55631d=await _0x28cc34['text']();loggerService_1[_0x5b99d2(0x1ce)][_0x5b99d2(0x187)]('rapyd',_0x5b99d2(0x1a5)+_0x465517,_0x28cc34[_0x5b99d2(0x18c)],_0x55631d,_0xa8c417);throw new Error(_0x5b99d2(0x1be)+_0x28cc34[_0x5b99d2(0x18c)]);}const _0x315d0a=await _0x28cc34[_0x5b99d2(0x17f)]();loggerService_1[_0x5b99d2(0x1ce)]['logWhiteDomainResponse'](_0x5b99d2(0x19a),_0x5b99d2(0x1a5)+_0x465517,_0x28cc34['status'],_0x315d0a,_0xa8c417);if(_0x315d0a[_0x5b99d2(0x18c)]?.[_0x5b99d2(0x18c)]!==_0x5b99d2(0x181)){loggerService_1['loggerService'][_0x5b99d2(0x1b7)](_0x5b99d2(0x19a),_0x5b99d2(0x1a5)+_0x465517,'Rapyd\x20API\x20error:\x20'+(_0x315d0a['status']?.['message']||_0x5b99d2(0x18e)));throw new Error(_0x5b99d2(0x1c6)+(_0x315d0a[_0x5b99d2(0x18c)]?.['message']||'Unknown\x20error'));}let _0x1b4574=_0x5b99d2(0x1b0);if(_0x315d0a[_0x5b99d2(0x1b3)]?.[_0x5b99d2(0x18c)])switch(_0x315d0a[_0x5b99d2(0x1b3)][_0x5b99d2(0x18c)][_0x5b99d2(0x19b)]()){case _0x5b99d2(0x1a1):_0x1b4574=_0x5b99d2(0x1d4);break;case _0x5b99d2(0x16f):_0x1b4574=_0x5b99d2(0x1c5);break;case _0x5b99d2(0x18b):_0x1b4574='EXPIRED';break;case _0x5b99d2(0x1af):_0x1b4574=_0x5b99d2(0x1c5);break;case _0x5b99d2(0x17a):case _0x5b99d2(0x193):default:_0x1b4574=_0x5b99d2(0x1b0);break;}return{'status':_0x1b4574,'amount':_0x315d0a['data']?.['amount'],'currency':_0x315d0a[_0x5b99d2(0x1b3)]?.[_0x5b99d2(0x176)]};}catch(_0xe623ef){console[_0x5b99d2(0x1b9)](_0x5b99d2(0x1cd),_0xe623ef),loggerService_1['loggerService']['logWhiteDomainError'](_0x5b99d2(0x19a),_0x5b99d2(0x1a5)+_0x465517,_0xe623ef);throw new Error(_0x5b99d2(0x18a)+(_0xe623ef instanceof Error?_0xe623ef['message']:_0x5b99d2(0x18e)));}}async['processWebhook'](_0x22890b){const _0x275106=a45_0x3b085c;console[_0x275106(0x1d6)]('Processing\x20Rapyd\x20webhook:',_0x22890b);let _0x409d33='PENDING',_0x188ea9;_0x22890b[_0x275106(0x1b3)]?.[_0x275106(0x1b8)]&&(_0x188ea9=_0x22890b[_0x275106(0x1b3)][_0x275106(0x1b8)],console[_0x275106(0x1d6)](_0x275106(0x1d1)+_0x188ea9));switch(_0x22890b['type']?.[_0x275106(0x19b)]()){case _0x275106(0x1a9):_0x22890b[_0x275106(0x1b3)]?.['paid']===!![]&&_0x22890b['data']?.['status']===_0x275106(0x1a1)?_0x409d33=_0x275106(0x1d4):_0x409d33=_0x275106(0x1b0);break;case _0x275106(0x1aa):_0x409d33=_0x275106(0x1c5);break;case _0x275106(0x189):_0x409d33=_0x275106(0x1b5);break;case _0x275106(0x1c2):_0x409d33=_0x275106(0x1c5);!_0x188ea9&&_0x22890b[_0x275106(0x1b3)]?.[_0x275106(0x1b8)]&&(_0x188ea9=_0x22890b[_0x275106(0x1b3)][_0x275106(0x1b8)]);break;default:switch(_0x22890b[_0x275106(0x1b3)]?.['status']?.[_0x275106(0x19b)]()){case'CLO':_0x22890b[_0x275106(0x1b3)]?.['paid']===!![]?_0x409d33=_0x275106(0x1d4):_0x409d33='FAILED';break;case _0x275106(0x16f):_0x409d33=_0x275106(0x1c5);break;case _0x275106(0x18b):_0x409d33=_0x275106(0x1b5);break;case _0x275106(0x1af):_0x409d33='FAILED';!_0x188ea9&&_0x22890b[_0x275106(0x1b3)]?.['failure_message']&&(_0x188ea9=_0x22890b[_0x275106(0x1b3)]['failure_message']);break;case'NEW':case'ACT':default:_0x409d33=_0x275106(0x1b0);break;}break;}const _0x3f7f94={};return _0x22890b[_0x275106(0x1b3)]?.[_0x275106(0x17e)]?.[_0x275106(0x1d2)]&&(_0x3f7f94[_0x275106(0x1c0)]=_0x22890b[_0x275106(0x1b3)][_0x275106(0x17e)][_0x275106(0x1d2)]),_0x22890b[_0x275106(0x1b3)]?.['payment_method_type']&&(_0x3f7f94[_0x275106(0x185)]=_0x22890b[_0x275106(0x1b3)][_0x275106(0x174)]),_0x22890b[_0x275106(0x1b3)]?.[_0x275106(0x16d)]&&(_0x3f7f94[_0x275106(0x1ab)]=_0x22890b[_0x275106(0x1b3)]['error_code']),_0x22890b[_0x275106(0x1b3)]?.[_0x275106(0x1d0)]&&(_0x3f7f94['failureCode']=_0x22890b[_0x275106(0x1b3)][_0x275106(0x1d0)]),console['log'](_0x275106(0x1ad)+_0x409d33+_0x275106(0x195)+(_0x188ea9||'none')),{'paymentId':_0x22890b[_0x275106(0x1b3)]?.['merchant_reference_id']||'','status':_0x409d33,'amount':_0x22890b[_0x275106(0x1b3)]?.[_0x275106(0x167)],'currency':_0x22890b[_0x275106(0x1b3)]?.[_0x275106(0x176)],'failureMessage':_0x188ea9,'additionalInfo':_0x3f7f94};}}exports[a45_0x3b085c(0x1cf)]=RapydService;