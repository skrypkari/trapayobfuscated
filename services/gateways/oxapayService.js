'use strict';function a73_0x3bf3(_0x59bb58,_0x4407d5){_0x59bb58=_0x59bb58-0x143;const _0x187b5e=a73_0x187b();let _0x3bf36b=_0x187b5e[_0x59bb58];return _0x3bf36b;}const a73_0x2b0bd9=a73_0x3bf3;(function(_0x592f30,_0x20ddb9){const _0xd4be88=a73_0x3bf3,_0x3c5bab=_0x592f30();while(!![]){try{const _0x1a9540=parseInt(_0xd4be88(0x178))/0x1*(parseInt(_0xd4be88(0x165))/0x2)+parseInt(_0xd4be88(0x185))/0x3*(parseInt(_0xd4be88(0x148))/0x4)+-parseInt(_0xd4be88(0x153))/0x5+-parseInt(_0xd4be88(0x168))/0x6+-parseInt(_0xd4be88(0x181))/0x7*(parseInt(_0xd4be88(0x172))/0x8)+parseInt(_0xd4be88(0x15c))/0x9*(-parseInt(_0xd4be88(0x161))/0xa)+parseInt(_0xd4be88(0x19b))/0xb;if(_0x1a9540===_0x20ddb9)break;else _0x3c5bab['push'](_0x3c5bab['shift']());}catch(_0x49ea04){_0x3c5bab['push'](_0x3c5bab['shift']());}}}(a73_0x187b,0x48c06));Object[a73_0x2b0bd9(0x18b)](exports,a73_0x2b0bd9(0x18f),{'value':!![]}),exports['oxapayService']=exports['OxaPayService']=void 0x0;const loggerService_1=require('../loggerService');class OxaPayService{constructor(){const _0x4b3bc0=a73_0x2b0bd9;this[_0x4b3bc0(0x184)]=_0x4b3bc0(0x17b),this['apiKey']=process.env.OXAPAY_API_KEY||'WCXQ21-DL5OZP-H3SSHH-4GVAR4',!this[_0x4b3bc0(0x14f)]?console[_0x4b3bc0(0x154)](_0x4b3bc0(0x17a)):console[_0x4b3bc0(0x152)]('üí∞\x20OxaPay\x20service\x20initialized');}async[a73_0x2b0bd9(0x145)](_0xae699f){const _0x220ad9=a73_0x2b0bd9,{orderId:_0x4d2a3a,amount:_0x1a76e7,currency:_0x224f84,payCurrency:_0x500da2,network:_0x430628,description:_0x1566cf,customerEmail:_0x1aeb61,lifetime:_0x54c5f2,feePaidByPayer:_0x21339a,underPaidCoverage:_0x5e8c89}=_0xae699f;if(!this['apiKey'])throw new Error(_0x220ad9(0x15a));const _0x43d3bf={'amount':_0x1a76e7,'currency':_0x224f84[_0x220ad9(0x147)](),'callback_url':_0x220ad9(0x192),'order_id':_0x4d2a3a,'description':_0x1566cf||_0x220ad9(0x151)+_0x4d2a3a};_0x500da2&&(_0x43d3bf[_0x220ad9(0x14b)]=_0x500da2[_0x220ad9(0x147)]());_0x430628&&(_0x43d3bf[_0x220ad9(0x15f)]=_0x430628);_0x1aeb61&&(_0x43d3bf[_0x220ad9(0x169)]=_0x1aeb61);_0x54c5f2!==undefined?_0x43d3bf[_0x220ad9(0x16b)]=_0x54c5f2:_0x43d3bf[_0x220ad9(0x16b)]=0x3c;_0x21339a!==undefined&&(_0x43d3bf[_0x220ad9(0x182)]=_0x21339a);_0x5e8c89!==undefined&&(_0x43d3bf[_0x220ad9(0x17e)]=_0x5e8c89);const _0xdfc36f=Date[_0x220ad9(0x156)]();try{console[_0x220ad9(0x152)]('===\x20OXAPAY\x20API\x20REQUEST\x20==='),console[_0x220ad9(0x152)](_0x220ad9(0x18a),this[_0x220ad9(0x184)]),console['log'](_0x220ad9(0x143),JSON[_0x220ad9(0x18e)](_0x43d3bf,null,0x2)),loggerService_1['loggerService'][_0x220ad9(0x19e)]('oxapay','/payment/white-label',_0x220ad9(0x14e),_0x43d3bf);const _0x1a1380=await fetch(this[_0x220ad9(0x184)],{'method':_0x220ad9(0x14e),'headers':{'Content-Type':'application/json','merchant_api_key':this[_0x220ad9(0x14f)]},'body':JSON[_0x220ad9(0x18e)](_0x43d3bf)}),_0x25ca2a=Date[_0x220ad9(0x156)]()-_0xdfc36f;console[_0x220ad9(0x152)](_0x220ad9(0x166)),console['log'](_0x220ad9(0x180),_0x1a1380[_0x220ad9(0x162)]),console[_0x220ad9(0x152)](_0x220ad9(0x193),_0x1a1380['statusText']),console['log'](_0x220ad9(0x195),_0x25ca2a+'ms');const _0x229fa2=await _0x1a1380[_0x220ad9(0x19a)]();console[_0x220ad9(0x152)](_0x220ad9(0x17f),_0x229fa2);let _0x563384;try{_0x563384=JSON[_0x220ad9(0x17c)](_0x229fa2);}catch(_0x1eac32){console['error'](_0x220ad9(0x155),_0x1eac32),loggerService_1[_0x220ad9(0x159)][_0x220ad9(0x14d)](_0x220ad9(0x16a),_0x220ad9(0x14a),'JSON\x20Parse\x20Error:\x20'+_0x1eac32);throw new Error(_0x220ad9(0x158)+_0x229fa2);}console[_0x220ad9(0x152)](_0x220ad9(0x14c)),console[_0x220ad9(0x152)]('Parsed\x20Result:',JSON[_0x220ad9(0x18e)](_0x563384,null,0x2)),loggerService_1[_0x220ad9(0x159)]['logWhiteDomainResponse'](_0x220ad9(0x16a),_0x220ad9(0x14a),_0x1a1380[_0x220ad9(0x162)],_0x563384,_0x25ca2a);if(_0x563384[_0x220ad9(0x162)]!==0xc8||!_0x563384[_0x220ad9(0x164)]){const _0x5c83f4=_0x563384[_0x220ad9(0x146)]?.[_0x220ad9(0x189)]||_0x563384[_0x220ad9(0x189)]||_0x220ad9(0x18d);console[_0x220ad9(0x146)](_0x220ad9(0x177)),console[_0x220ad9(0x146)](_0x220ad9(0x173),_0x5c83f4),console['error'](_0x220ad9(0x191),_0x563384[_0x220ad9(0x146)]),loggerService_1[_0x220ad9(0x159)][_0x220ad9(0x14d)](_0x220ad9(0x16a),_0x220ad9(0x14a),_0x220ad9(0x17d)+_0x5c83f4);throw new Error(_0x220ad9(0x16d)+_0x5c83f4);}if(!_0x563384[_0x220ad9(0x164)][_0x220ad9(0x16c)]||!_0x563384[_0x220ad9(0x164)][_0x220ad9(0x15e)]){console[_0x220ad9(0x146)](_0x220ad9(0x18c)),console[_0x220ad9(0x146)](_0x220ad9(0x171)),console[_0x220ad9(0x146)](_0x220ad9(0x197),_0x563384[_0x220ad9(0x164)]),loggerService_1['loggerService'][_0x220ad9(0x14d)](_0x220ad9(0x16a),_0x220ad9(0x14a),'Incomplete\x20response:\x20missing\x20track_id\x20or\x20address');throw new Error(_0x220ad9(0x150));}console[_0x220ad9(0x152)](_0x220ad9(0x16e)),console[_0x220ad9(0x152)](_0x220ad9(0x196),_0x563384[_0x220ad9(0x164)]['track_id']),console[_0x220ad9(0x152)]('Address:',_0x563384['data']['address']),console['log'](_0x220ad9(0x199),_0x563384[_0x220ad9(0x164)][_0x220ad9(0x163)],_0x563384[_0x220ad9(0x164)][_0x220ad9(0x14b)]),console['log']('Network:',_0x563384[_0x220ad9(0x164)][_0x220ad9(0x15f)]);const _0x1f90ea='https://app.trapay.uk/payment/'+_0xae699f[_0x220ad9(0x167)];return{'gateway_payment_id':_0x563384[_0x220ad9(0x164)]['track_id'],'payment_url':_0x1f90ea,'track_id':_0x563384[_0x220ad9(0x164)][_0x220ad9(0x16c)],'amount':_0x563384[_0x220ad9(0x164)][_0x220ad9(0x198)],'currency':_0x563384[_0x220ad9(0x164)][_0x220ad9(0x175)],'pay_amount':_0x563384['data']['pay_amount'],'pay_currency':_0x563384[_0x220ad9(0x164)][_0x220ad9(0x14b)],'network':_0x563384[_0x220ad9(0x164)][_0x220ad9(0x15f)],'address':_0x563384[_0x220ad9(0x164)][_0x220ad9(0x15e)],'qr_code':_0x563384['data'][_0x220ad9(0x15b)],'rate':_0x563384[_0x220ad9(0x164)][_0x220ad9(0x16f)],'expired_at':_0x563384[_0x220ad9(0x164)][_0x220ad9(0x183)]};}catch(_0x29b257){console['error'](_0x220ad9(0x149)),console['error'](_0x220ad9(0x170),_0x29b257),loggerService_1[_0x220ad9(0x159)][_0x220ad9(0x14d)](_0x220ad9(0x16a),_0x220ad9(0x14a),_0x29b257 instanceof Error?_0x29b257['message']:String(_0x29b257));throw _0x29b257;}}[a73_0x2b0bd9(0x15d)](_0x405f13){const _0x480704=a73_0x2b0bd9;switch(_0x405f13[_0x480704(0x147)]()){case'new':return _0x480704(0x174);case'waiting':return _0x480704(0x174);case _0x480704(0x188):return'PROCESSING';case _0x480704(0x187):return _0x480704(0x19d);case _0x480704(0x157):return _0x480704(0x19d);case _0x480704(0x144):return _0x480704(0x19d);case _0x480704(0x19c):return _0x480704(0x179);case _0x480704(0x194):return _0x480704(0x179);case _0x480704(0x160):return _0x480704(0x190);default:return'PENDING';}}}function a73_0x187b(){const _0x55b068=['track_id','OxaPay\x20API\x20error:\x20','===\x20OXAPAY\x20SUCCESS\x20===','rate','Error:','Missing\x20track_id\x20or\x20address\x20in\x20response','2915128NwVlqh','Error\x20Message:','PENDING','currency','OxaPayService','===\x20OXAPAY\x20API\x20ERROR\x20===','1ENGDyW','REFUND','‚ö†Ô∏è\x20OXAPAY_API_KEY\x20not\x20found\x20in\x20environment\x20variables','https://api.oxapay.com/v1/payment/white-label','parse','API\x20Error:\x20','under_paid_coverage','Raw\x20Response\x20Body:','Status:','7DbteiL','fee_paid_by_payer','expired_at','apiUrl','3BHMgZh','oxapayService','paid','paying','message','URL:','defineProperty','===\x20OXAPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error\x20from\x20OxaPay\x20API','stringify','__esModule','EXPIRED','Error\x20Details:','https://api.trapay.uk/api/oxapay/callback','Status\x20Text:','refunded','Response\x20Time:','Track\x20ID:','Response\x20data:','amount','Amount:','text','9504451ClcTkS','refunding','PAID','logWhiteDomainRequest','Request\x20Body:','underpaid','createPayment','error','toLowerCase','444856TsShJj','===\x20OXAPAY\x20REQUEST\x20ERROR\x20===','/payment/white-label','pay_currency','===\x20PARSED\x20OXAPAY\x20RESPONSE\x20===','logWhiteDomainError','POST','apiKey','Invalid\x20response\x20from\x20OxaPay\x20API:\x20missing\x20track_id\x20or\x20address','Order\x20#','log','1200055FCWwuD','warn','Failed\x20to\x20parse\x20JSON\x20response:','now','manual_accept','Invalid\x20JSON\x20response\x20from\x20OxaPay\x20API:\x20','loggerService','OxaPay\x20API\x20key\x20is\x20not\x20configured','qr_code','81qMunOJ','getPaymentStatusFromCallback','address','network','expired','329830QTHZzL','status','pay_amount','data','983942ANnrmn','===\x20OXAPAY\x20API\x20RESPONSE\x20===','paymentId','1607922QfDEZT','email','oxapay','lifetime'];a73_0x187b=function(){return _0x55b068;};return a73_0x187b();}exports[a73_0x2b0bd9(0x176)]=OxaPayService,exports[a73_0x2b0bd9(0x186)]=new OxaPayService();