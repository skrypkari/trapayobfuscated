'use strict';function a73_0x2a27(){const _0x4db33f=['data','Request\x20Body:','oxapayService','OxaPayService','refunding','pay_amount','Invalid\x20JSON\x20response\x20from\x20OxaPay\x20API:\x20','Status:','API\x20Error:\x20','Track\x20ID:','Status\x20Text:','‚ö†Ô∏è\x20OXAPAY_API_KEY\x20not\x20found\x20in\x20environment\x20variables','statusText','3370vafgWe','PAID','969IiyIMz','Order\x20#','now','log','pay_currency','URL:','Parsed\x20Result:','logWhiteDomainRequest','===\x20PARSED\x20OXAPAY\x20RESPONSE\x20===','refunded','Address:','PROCESSING','Network:','Missing\x20track_id\x20or\x20address\x20in\x20response','track_id','EXPIRED','Response\x20data:','12560zHDWGJ','error','REFUND','PENDING','oxapay','__esModule','createPayment','network','Response\x20Time:','loggerService','305LhmhbV','waiting','===\x20OXAPAY\x20API\x20REQUEST\x20===','../loggerService','fee_paid_by_payer','manual_accept','status','paymentId','287jCjMws','208872XTkCVY','message','Error\x20Details:','POST','===\x20OXAPAY\x20API\x20ERROR\x20===','stringify','===\x20OXAPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','text','toLowerCase','expired_at','new','https://api.oxapay.com/v1/payment/white-label','paying','/payment/white-label','lifetime','address','===\x20OXAPAY\x20REQUEST\x20ERROR\x20===','expired','162yahtSC','893Waurjv','12918810UMcRCl','paid','logWhiteDomainError','66280JeWWrh','===\x20OXAPAY\x20SUCCESS\x20===','getPaymentStatusFromCallback','OxaPay\x20API\x20error:\x20','apiUrl','WCXQ21-DL5OZP-H3SSHH-4GVAR4','JSON\x20Parse\x20Error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','currency','Unknown\x20error\x20from\x20OxaPay\x20API','10849520HzOyjv'];a73_0x2a27=function(){return _0x4db33f;};return a73_0x2a27();}const a73_0x203497=a73_0xf312;(function(_0x3072f9,_0x29dfc9){const _0x5dd5d5=a73_0xf312,_0x6e6955=_0x3072f9();while(!![]){try{const _0x1de8c6=parseInt(_0x5dd5d5(0xfa))/0x1*(parseInt(_0x5dd5d5(0x116))/0x2)+parseInt(_0x5dd5d5(0x118))/0x3+parseInt(_0x5dd5d5(0xfe))/0x4*(parseInt(_0x5dd5d5(0xde))/0x5)+-parseInt(_0x5dd5d5(0xe7))/0x6*(parseInt(_0x5dd5d5(0xe6))/0x7)+parseInt(_0x5dd5d5(0x129))/0x8*(-parseInt(_0x5dd5d5(0xf9))/0x9)+-parseInt(_0x5dd5d5(0xfb))/0xa+parseInt(_0x5dd5d5(0x108))/0xb;if(_0x1de8c6===_0x29dfc9)break;else _0x6e6955['push'](_0x6e6955['shift']());}catch(_0x451636){_0x6e6955['push'](_0x6e6955['shift']());}}}(a73_0x2a27,0xb83fd));Object['defineProperty'](exports,a73_0x203497(0x12e),{'value':!![]}),exports['oxapayService']=exports['OxaPayService']=void 0x0;const loggerService_1=require(a73_0x203497(0xe1));function a73_0xf312(_0x2f30cc,_0x3f3bc2){_0x2f30cc=_0x2f30cc-0xdb;const _0x2a278b=a73_0x2a27();let _0xf312f6=_0x2a278b[_0x2f30cc];return _0xf312f6;}class OxaPayService{constructor(){const _0x597f30=a73_0x203497;this[_0x597f30(0x102)]=_0x597f30(0xf2),this['apiKey']=process.env.OXAPAY_API_KEY||_0x597f30(0x103),!this['apiKey']?console['warn'](_0x597f30(0x114)):console[_0x597f30(0x11b)]('üí∞\x20OxaPay\x20service\x20initialized');}async[a73_0x203497(0x12f)](_0x3d1157){const _0x589405=a73_0x203497,{orderId:_0x1262e6,amount:_0x536117,currency:_0x1ae76d,payCurrency:_0x7017be,network:_0x58682f,description:_0x3718c0,customerEmail:_0x2d7a64,lifetime:_0x37e398,feePaidByPayer:_0x609fb1,underPaidCoverage:_0x4cfe0b}=_0x3d1157;if(!this['apiKey'])throw new Error('OxaPay\x20API\x20key\x20is\x20not\x20configured');const _0x2551a0={'amount':_0x536117,'currency':_0x1ae76d[_0x589405(0xef)](),'callback_url':'https://api.trapay.uk/api/oxapay/callback','order_id':_0x1262e6,'description':_0x3718c0||_0x589405(0x119)+_0x1262e6};_0x7017be&&(_0x2551a0[_0x589405(0x11c)]=_0x7017be[_0x589405(0xef)]());_0x58682f&&(_0x2551a0[_0x589405(0xdb)]=_0x58682f);_0x2d7a64&&(_0x2551a0['email']=_0x2d7a64);_0x37e398!==undefined?_0x2551a0[_0x589405(0xf5)]=_0x37e398:_0x2551a0[_0x589405(0xf5)]=0x3c;_0x609fb1!==undefined&&(_0x2551a0[_0x589405(0xe2)]=_0x609fb1);_0x4cfe0b!==undefined&&(_0x2551a0['under_paid_coverage']=_0x4cfe0b);const _0x2d2f69=Date[_0x589405(0x11a)]();try{console[_0x589405(0x11b)](_0x589405(0xe0)),console['log'](_0x589405(0x11d),this[_0x589405(0x102)]),console['log'](_0x589405(0x10a),JSON['stringify'](_0x2551a0,null,0x2)),loggerService_1[_0x589405(0xdd)][_0x589405(0x11f)](_0x589405(0x12d),_0x589405(0xf4),_0x589405(0xea),_0x2551a0);const _0x53ad10=await fetch(this['apiUrl'],{'method':_0x589405(0xea),'headers':{'Content-Type':'application/json','merchant_api_key':this['apiKey']},'body':JSON[_0x589405(0xec)](_0x2551a0)}),_0x28d539=Date[_0x589405(0x11a)]()-_0x2d2f69;console[_0x589405(0x11b)]('===\x20OXAPAY\x20API\x20RESPONSE\x20==='),console[_0x589405(0x11b)](_0x589405(0x110),_0x53ad10[_0x589405(0xe4)]),console[_0x589405(0x11b)](_0x589405(0x113),_0x53ad10[_0x589405(0x115)]),console[_0x589405(0x11b)](_0x589405(0xdc),_0x28d539+'ms');const _0x4c2b1f=await _0x53ad10[_0x589405(0xee)]();console[_0x589405(0x11b)]('Raw\x20Response\x20Body:',_0x4c2b1f);let _0x5ccab8;try{_0x5ccab8=JSON['parse'](_0x4c2b1f);}catch(_0x13367b){console[_0x589405(0x12a)](_0x589405(0x105),_0x13367b),loggerService_1[_0x589405(0xdd)][_0x589405(0xfd)](_0x589405(0x12d),_0x589405(0xf4),_0x589405(0x104)+_0x13367b);throw new Error(_0x589405(0x10f)+_0x4c2b1f);}console[_0x589405(0x11b)](_0x589405(0x120)),console[_0x589405(0x11b)](_0x589405(0x11e),JSON['stringify'](_0x5ccab8,null,0x2)),loggerService_1[_0x589405(0xdd)]['logWhiteDomainResponse']('oxapay',_0x589405(0xf4),_0x53ad10[_0x589405(0xe4)],_0x5ccab8,_0x28d539);if(_0x5ccab8['status']!==0xc8||!_0x5ccab8[_0x589405(0x109)]){const _0x6ea52=_0x5ccab8[_0x589405(0x12a)]?.[_0x589405(0xe8)]||_0x5ccab8[_0x589405(0xe8)]||_0x589405(0x107);console[_0x589405(0x12a)](_0x589405(0xeb)),console[_0x589405(0x12a)]('Error\x20Message:',_0x6ea52),console[_0x589405(0x12a)](_0x589405(0xe9),_0x5ccab8[_0x589405(0x12a)]),loggerService_1[_0x589405(0xdd)][_0x589405(0xfd)](_0x589405(0x12d),'/payment/white-label',_0x589405(0x111)+_0x6ea52);throw new Error(_0x589405(0x101)+_0x6ea52);}if(!_0x5ccab8['data'][_0x589405(0x126)]||!_0x5ccab8[_0x589405(0x109)][_0x589405(0xf6)]){console[_0x589405(0x12a)](_0x589405(0xed)),console[_0x589405(0x12a)](_0x589405(0x125)),console[_0x589405(0x12a)](_0x589405(0x128),_0x5ccab8[_0x589405(0x109)]),loggerService_1['loggerService'][_0x589405(0xfd)](_0x589405(0x12d),_0x589405(0xf4),'Incomplete\x20response:\x20missing\x20track_id\x20or\x20address');throw new Error('Invalid\x20response\x20from\x20OxaPay\x20API:\x20missing\x20track_id\x20or\x20address');}console[_0x589405(0x11b)](_0x589405(0xff)),console[_0x589405(0x11b)](_0x589405(0x112),_0x5ccab8[_0x589405(0x109)][_0x589405(0x126)]),console[_0x589405(0x11b)](_0x589405(0x122),_0x5ccab8[_0x589405(0x109)][_0x589405(0xf6)]),console[_0x589405(0x11b)]('Amount:',_0x5ccab8[_0x589405(0x109)][_0x589405(0x10e)],_0x5ccab8[_0x589405(0x109)][_0x589405(0x11c)]),console[_0x589405(0x11b)](_0x589405(0x124),_0x5ccab8[_0x589405(0x109)][_0x589405(0xdb)]);const _0x2fa155='https://app.trapay.uk/payment/'+_0x3d1157[_0x589405(0xe5)];return{'gateway_payment_id':_0x5ccab8[_0x589405(0x109)][_0x589405(0x126)],'payment_url':_0x2fa155,'track_id':_0x5ccab8['data'][_0x589405(0x126)],'amount':_0x5ccab8[_0x589405(0x109)]['amount'],'currency':_0x5ccab8[_0x589405(0x109)][_0x589405(0x106)],'pay_amount':_0x5ccab8[_0x589405(0x109)][_0x589405(0x10e)],'pay_currency':_0x5ccab8[_0x589405(0x109)][_0x589405(0x11c)],'network':_0x5ccab8[_0x589405(0x109)]['network'],'address':_0x5ccab8[_0x589405(0x109)][_0x589405(0xf6)],'qr_code':_0x5ccab8['data']['qr_code'],'rate':_0x5ccab8[_0x589405(0x109)]['rate'],'expired_at':_0x5ccab8[_0x589405(0x109)][_0x589405(0xf0)]};}catch(_0x5d81fa){console[_0x589405(0x12a)](_0x589405(0xf7)),console[_0x589405(0x12a)]('Error:',_0x5d81fa),loggerService_1[_0x589405(0xdd)][_0x589405(0xfd)](_0x589405(0x12d),'/payment/white-label',_0x5d81fa instanceof Error?_0x5d81fa['message']:String(_0x5d81fa));throw _0x5d81fa;}}[a73_0x203497(0x100)](_0x6f5a4a){const _0x580bf6=a73_0x203497;switch(_0x6f5a4a['toLowerCase']()){case _0x580bf6(0xf1):return _0x580bf6(0x12c);case _0x580bf6(0xdf):return _0x580bf6(0x12c);case _0x580bf6(0xf3):return _0x580bf6(0x123);case _0x580bf6(0xfc):return'PAID';case _0x580bf6(0xe3):return _0x580bf6(0x117);case'underpaid':return _0x580bf6(0x117);case _0x580bf6(0x10d):return'REFUND';case _0x580bf6(0x121):return _0x580bf6(0x12b);case _0x580bf6(0xf8):return _0x580bf6(0x127);default:return _0x580bf6(0x12c);}}}exports[a73_0x203497(0x10c)]=OxaPayService,exports[a73_0x203497(0x10b)]=new OxaPayService();