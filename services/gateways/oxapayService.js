'use strict';const a73_0x5e9b07=a73_0x561c;(function(_0x873a27,_0x1f2f21){const _0x39b770=a73_0x561c,_0x5dbfb7=_0x873a27();while(!![]){try{const _0x4aa663=-parseInt(_0x39b770(0x123))/0x1*(parseInt(_0x39b770(0x15b))/0x2)+parseInt(_0x39b770(0x141))/0x3*(-parseInt(_0x39b770(0x12a))/0x4)+-parseInt(_0x39b770(0x114))/0x5+-parseInt(_0x39b770(0x142))/0x6+parseInt(_0x39b770(0x14a))/0x7*(-parseInt(_0x39b770(0x10b))/0x8)+parseInt(_0x39b770(0x129))/0x9*(parseInt(_0x39b770(0x127))/0xa)+parseInt(_0x39b770(0x11f))/0xb;if(_0x4aa663===_0x1f2f21)break;else _0x5dbfb7['push'](_0x5dbfb7['shift']());}catch(_0x5eab90){_0x5dbfb7['push'](_0x5dbfb7['shift']());}}}(a73_0x1543,0x44238));function a73_0x561c(_0x4e9d5a,_0x75fff5){_0x4e9d5a=_0x4e9d5a-0x103;const _0x15433f=a73_0x1543();let _0x561c2b=_0x15433f[_0x4e9d5a];return _0x561c2b;}Object[a73_0x5e9b07(0x153)](exports,a73_0x5e9b07(0x131),{'value':!![]}),exports[a73_0x5e9b07(0x135)]=exports[a73_0x5e9b07(0x12c)]=void 0x0;const loggerService_1=require('../loggerService');function a73_0x1543(){const _0x40c650=['WCXQ21-DL5OZP-H3SSHH-4GVAR4','fee_paid_by_payer','PAID','30kTNmYi','Raw\x20Response\x20Body:','1023714JCkjHt','1793552ODyiGa','warn','OxaPayService','===\x20OXAPAY\x20API\x20REQUEST\x20===','/payment/white-label','Response\x20data:','logWhiteDomainError','__esModule','PENDING','data','paid','oxapayService','stringify','Order\x20#','Network:','pay_currency','Parsed\x20Result:','track_id','===\x20OXAPAY\x20API\x20ERROR\x20===','Response\x20Time:','rate','EXPIRED','apiKey','3qcNQVZ','149448DdzLBt','amount','Status\x20Text:','REFUND','status','Error:','Error\x20Details:','network','119ZDnsFJ','currency','expired','application/json','pay_amount','https://api.oxapay.com/v1/payment/white-label','lifetime','waiting','Failed\x20to\x20parse\x20JSON\x20response:','defineProperty','refunding','Track\x20ID:','===\x20OXAPAY\x20REQUEST\x20ERROR\x20===','JSON\x20Parse\x20Error:\x20','text','logWhiteDomainRequest','oxapay','302026rrxvwH','error','Invalid\x20JSON\x20response\x20from\x20OxaPay\x20API:\x20','Request\x20Body:','statusText','apiUrl','toLowerCase','Amount:','log','POST','147872tKnztq','address','===\x20OXAPAY\x20API\x20RESPONSE\x20===','Missing\x20track_id\x20or\x20address\x20in\x20response','qr_code','API\x20Error:\x20','===\x20PARSED\x20OXAPAY\x20RESPONSE\x20===','getPaymentStatusFromCallback','üí∞\x20OxaPay\x20service\x20initialized','2504785HzwzBW','underpaid','paying','message','now','under_paid_coverage','URL:','‚ö†Ô∏è\x20OXAPAY_API_KEY\x20not\x20found\x20in\x20environment\x20variables','===\x20OXAPAY\x20SUCCESS\x20===','https://app.trapay.uk/payment/','parse','18473158CpNqgf','manual_accept','PROCESSING','loggerService','3iTPoYA'];a73_0x1543=function(){return _0x40c650;};return a73_0x1543();}class OxaPayService{constructor(){const _0x46a119=a73_0x5e9b07;this[_0x46a119(0x106)]=_0x46a119(0x14f),this[_0x46a119(0x140)]=process.env.OXAPAY_API_KEY||_0x46a119(0x124),!this[_0x46a119(0x140)]?console[_0x46a119(0x12b)](_0x46a119(0x11b)):console['log'](_0x46a119(0x113));}async['createPayment'](_0x40d2cb){const _0x11b637=a73_0x5e9b07,{orderId:_0x1e262a,amount:_0x30f1ef,currency:_0x1f81d1,payCurrency:_0x573a2d,network:_0xd42ea8,description:_0x3ad7ee,customerEmail:_0x4ebf3e,lifetime:_0x14113e,feePaidByPayer:_0x3f2327,underPaidCoverage:_0x4c3f99}=_0x40d2cb;if(!this[_0x11b637(0x140)])throw new Error('OxaPay\x20API\x20key\x20is\x20not\x20configured');const _0x342562={'amount':_0x30f1ef,'currency':_0x1f81d1[_0x11b637(0x107)](),'callback_url':'https://api.trapay.uk/api/oxapay/callback','order_id':_0x1e262a,'description':_0x3ad7ee||_0x11b637(0x137)+_0x1e262a};_0x573a2d&&(_0x342562[_0x11b637(0x139)]=_0x573a2d['toLowerCase']());_0xd42ea8&&(_0x342562['network']=_0xd42ea8);_0x4ebf3e&&(_0x342562['email']=_0x4ebf3e);_0x14113e!==undefined?_0x342562[_0x11b637(0x150)]=_0x14113e:_0x342562[_0x11b637(0x150)]=0x3c;_0x3f2327!==undefined&&(_0x342562[_0x11b637(0x125)]=_0x3f2327);_0x4c3f99!==undefined&&(_0x342562[_0x11b637(0x119)]=_0x4c3f99);const _0x240547=Date['now']();try{console[_0x11b637(0x109)](_0x11b637(0x12d)),console['log'](_0x11b637(0x11a),this[_0x11b637(0x106)]),console[_0x11b637(0x109)](_0x11b637(0x104),JSON[_0x11b637(0x136)](_0x342562,null,0x2)),loggerService_1[_0x11b637(0x122)][_0x11b637(0x159)](_0x11b637(0x15a),_0x11b637(0x12e),_0x11b637(0x10a),_0x342562);const _0x4ff509=await fetch(this[_0x11b637(0x106)],{'method':'POST','headers':{'Content-Type':_0x11b637(0x14d),'merchant_api_key':this['apiKey']},'body':JSON[_0x11b637(0x136)](_0x342562)}),_0x304174=Date[_0x11b637(0x118)]()-_0x240547;console[_0x11b637(0x109)](_0x11b637(0x10d)),console['log']('Status:',_0x4ff509[_0x11b637(0x146)]),console[_0x11b637(0x109)](_0x11b637(0x144),_0x4ff509[_0x11b637(0x105)]),console['log'](_0x11b637(0x13d),_0x304174+'ms');const _0x4a40df=await _0x4ff509[_0x11b637(0x158)]();console[_0x11b637(0x109)](_0x11b637(0x128),_0x4a40df);let _0x2e9805;try{_0x2e9805=JSON[_0x11b637(0x11e)](_0x4a40df);}catch(_0x3ec490){console[_0x11b637(0x15c)](_0x11b637(0x152),_0x3ec490),loggerService_1[_0x11b637(0x122)]['logWhiteDomainError'](_0x11b637(0x15a),'/payment/white-label',_0x11b637(0x157)+_0x3ec490);throw new Error(_0x11b637(0x103)+_0x4a40df);}console[_0x11b637(0x109)](_0x11b637(0x111)),console[_0x11b637(0x109)](_0x11b637(0x13a),JSON[_0x11b637(0x136)](_0x2e9805,null,0x2)),loggerService_1[_0x11b637(0x122)]['logWhiteDomainResponse'](_0x11b637(0x15a),_0x11b637(0x12e),_0x4ff509[_0x11b637(0x146)],_0x2e9805,_0x304174);if(_0x2e9805[_0x11b637(0x146)]!==0xc8||!_0x2e9805[_0x11b637(0x133)]){const _0x493fc3=_0x2e9805[_0x11b637(0x15c)]?.[_0x11b637(0x117)]||_0x2e9805[_0x11b637(0x117)]||'Unknown\x20error\x20from\x20OxaPay\x20API';console[_0x11b637(0x15c)](_0x11b637(0x13c)),console[_0x11b637(0x15c)]('Error\x20Message:',_0x493fc3),console[_0x11b637(0x15c)](_0x11b637(0x148),_0x2e9805[_0x11b637(0x15c)]),loggerService_1[_0x11b637(0x122)][_0x11b637(0x130)]('oxapay','/payment/white-label',_0x11b637(0x110)+_0x493fc3);throw new Error('OxaPay\x20API\x20error:\x20'+_0x493fc3);}if(!_0x2e9805[_0x11b637(0x133)][_0x11b637(0x13b)]||!_0x2e9805['data'][_0x11b637(0x10c)]){console[_0x11b637(0x15c)]('===\x20OXAPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x11b637(0x15c)](_0x11b637(0x10e)),console[_0x11b637(0x15c)](_0x11b637(0x12f),_0x2e9805['data']),loggerService_1[_0x11b637(0x122)][_0x11b637(0x130)]('oxapay',_0x11b637(0x12e),'Incomplete\x20response:\x20missing\x20track_id\x20or\x20address');throw new Error('Invalid\x20response\x20from\x20OxaPay\x20API:\x20missing\x20track_id\x20or\x20address');}console[_0x11b637(0x109)](_0x11b637(0x11c)),console[_0x11b637(0x109)](_0x11b637(0x155),_0x2e9805[_0x11b637(0x133)][_0x11b637(0x13b)]),console[_0x11b637(0x109)]('Address:',_0x2e9805[_0x11b637(0x133)]['address']),console[_0x11b637(0x109)](_0x11b637(0x108),_0x2e9805[_0x11b637(0x133)][_0x11b637(0x14e)],_0x2e9805[_0x11b637(0x133)][_0x11b637(0x139)]),console[_0x11b637(0x109)](_0x11b637(0x138),_0x2e9805[_0x11b637(0x133)][_0x11b637(0x149)]);const _0x3a15fc=_0x11b637(0x11d)+_0x40d2cb['paymentId'];return{'gateway_payment_id':_0x2e9805[_0x11b637(0x133)][_0x11b637(0x13b)],'payment_url':_0x3a15fc,'track_id':_0x2e9805[_0x11b637(0x133)]['track_id'],'amount':_0x2e9805[_0x11b637(0x133)][_0x11b637(0x143)],'currency':_0x2e9805[_0x11b637(0x133)][_0x11b637(0x14b)],'pay_amount':_0x2e9805['data'][_0x11b637(0x14e)],'pay_currency':_0x2e9805[_0x11b637(0x133)][_0x11b637(0x139)],'network':_0x2e9805[_0x11b637(0x133)][_0x11b637(0x149)],'address':_0x2e9805[_0x11b637(0x133)][_0x11b637(0x10c)],'qr_code':_0x2e9805['data'][_0x11b637(0x10f)],'rate':_0x2e9805[_0x11b637(0x133)][_0x11b637(0x13e)],'expired_at':_0x2e9805[_0x11b637(0x133)]['expired_at']};}catch(_0xd7b2e0){console['error'](_0x11b637(0x156)),console[_0x11b637(0x15c)](_0x11b637(0x147),_0xd7b2e0),loggerService_1['loggerService'][_0x11b637(0x130)]('oxapay',_0x11b637(0x12e),_0xd7b2e0 instanceof Error?_0xd7b2e0[_0x11b637(0x117)]:String(_0xd7b2e0));throw _0xd7b2e0;}}[a73_0x5e9b07(0x112)](_0x36af2a){const _0x26a902=a73_0x5e9b07;switch(_0x36af2a[_0x26a902(0x107)]()){case'new':return _0x26a902(0x132);case _0x26a902(0x151):return _0x26a902(0x132);case _0x26a902(0x116):return _0x26a902(0x121);case _0x26a902(0x134):return _0x26a902(0x126);case _0x26a902(0x120):return _0x26a902(0x126);case _0x26a902(0x115):return _0x26a902(0x126);case _0x26a902(0x154):return'REFUND';case'refunded':return _0x26a902(0x145);case _0x26a902(0x14c):return _0x26a902(0x13f);default:return _0x26a902(0x132);}}}exports[a73_0x5e9b07(0x12c)]=OxaPayService,exports[a73_0x5e9b07(0x135)]=new OxaPayService();