'use strict';const a65_0x46c3f6=a65_0x16b0;(function(_0x3b1cc5,_0x58dc25){const _0x49ac8e=a65_0x16b0,_0x430b05=_0x3b1cc5();while(!![]){try{const _0x13e01b=-parseInt(_0x49ac8e(0x15a))/0x1+parseInt(_0x49ac8e(0x13d))/0x2+-parseInt(_0x49ac8e(0x168))/0x3*(parseInt(_0x49ac8e(0x132))/0x4)+-parseInt(_0x49ac8e(0x155))/0x5*(-parseInt(_0x49ac8e(0x16d))/0x6)+parseInt(_0x49ac8e(0x12d))/0x7+parseInt(_0x49ac8e(0x160))/0x8*(parseInt(_0x49ac8e(0x13f))/0x9)+-parseInt(_0x49ac8e(0x14c))/0xa;if(_0x13e01b===_0x58dc25)break;else _0x430b05['push'](_0x430b05['shift']());}catch(_0x27ac12){_0x430b05['push'](_0x430b05['shift']());}}}(a65_0x25f7,0xb42bf));Object['defineProperty'](exports,a65_0x46c3f6(0x146),{'value':!![]}),exports[a65_0x46c3f6(0x137)]=exports[a65_0x46c3f6(0x13a)]=void 0x0;const loggerService_1=require(a65_0x46c3f6(0x122));function a65_0x25f7(){const _0xe742fa=['Error\x20Message:','2792768AfNfOQ','refunding','80955VXXOBS','OxaPay\x20API\x20error:\x20','API\x20Error:\x20','createPayment','https://api.oxapay.com/v1/payment/white-label','amount','Failed\x20to\x20parse\x20JSON\x20response:','__esModule','logWhiteDomainRequest','address','apiKey','apiUrl','statusText','11800980SCLWcj','stringify','URL:','Track\x20ID:','fee_paid_by_payer','under_paid_coverage','error','Order\x20#','===\x20OXAPAY\x20API\x20ERROR\x20===','50pjrSRZ','oxapay','lifetime','Status\x20Text:','currency','677347bTHegA','track_id','PENDING','pay_amount','logWhiteDomainError','https://app.trapay.uk/payment/','1120DyLpet','Error:','expired_at','Response\x20Time:','Invalid\x20response\x20from\x20OxaPay\x20API:\x20missing\x20track_id\x20or\x20address','OxaPay\x20API\x20key\x20is\x20not\x20configured','Raw\x20Response\x20Body:','parse','6xzDSOT','getPaymentStatusFromCallback','email','OXAPAY_API_KEY','manual_accept','31734MrrdPo','/payment/white-label','EXPIRED','Invalid\x20JSON\x20response\x20from\x20OxaPay\x20API:\x20','Amount:','REFUND','pay_currency','POST','WCXQ21-DL5OZP-H3SSHH-4GVAR4','Address:','loggerService','Incomplete\x20response:\x20missing\x20track_id\x20or\x20address','Error\x20Details:','underpaid','../loggerService','status','data','üí∞\x20OxaPay\x20service\x20initialized','paymentId','application/json','log','waiting','paid','message','refunded','1534134iBsnGr','new','toLowerCase','paying','JSON\x20Parse\x20Error:\x20','664616GSNqji','PAID','Parsed\x20Result:','env','===\x20OXAPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','oxapayService','===\x20OXAPAY\x20API\x20REQUEST\x20===','expired','OxaPayService','now'];a65_0x25f7=function(){return _0xe742fa;};return a65_0x25f7();}function a65_0x16b0(_0x3d2641,_0x266be9){_0x3d2641=_0x3d2641-0x11a;const _0x25f7c5=a65_0x25f7();let _0x16b01e=_0x25f7c5[_0x3d2641];return _0x16b01e;}class OxaPayService{constructor(){const _0x247ce7=a65_0x46c3f6;this[_0x247ce7(0x14a)]=_0x247ce7(0x143),this['apiKey']=process[_0x247ce7(0x135)][_0x247ce7(0x16b)]||_0x247ce7(0x11c),!this[_0x247ce7(0x149)]?console['warn']('‚ö†Ô∏è\x20OXAPAY_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console['log'](_0x247ce7(0x125));}async[a65_0x46c3f6(0x142)](_0x526c5b){const _0x23a357=a65_0x46c3f6,{orderId:_0x53a79d,amount:_0x15b422,currency:_0x371b1e,payCurrency:_0x391a39,network:_0x33df78,description:_0x27450c,customerEmail:_0x45f3a3,lifetime:_0x1759a0,feePaidByPayer:_0x14c690,underPaidCoverage:_0x497eff}=_0x526c5b;if(!this[_0x23a357(0x149)])throw new Error(_0x23a357(0x165));const _0x39fe05={'amount':_0x15b422,'currency':_0x371b1e[_0x23a357(0x12f)](),'callback_url':'https://api.trapay.uk/api/oxapay/callback','order_id':_0x53a79d,'description':_0x27450c||_0x23a357(0x153)+_0x53a79d};_0x391a39&&(_0x39fe05['pay_currency']=_0x391a39[_0x23a357(0x12f)]());_0x33df78&&(_0x39fe05['network']=_0x33df78);_0x45f3a3&&(_0x39fe05[_0x23a357(0x16a)]=_0x45f3a3);_0x1759a0!==undefined?_0x39fe05[_0x23a357(0x157)]=_0x1759a0:_0x39fe05[_0x23a357(0x157)]=0x3c;_0x14c690!==undefined&&(_0x39fe05[_0x23a357(0x150)]=_0x14c690);_0x497eff!==undefined&&(_0x39fe05[_0x23a357(0x151)]=_0x497eff);const _0x1c0bd2=Date[_0x23a357(0x13b)]();try{console[_0x23a357(0x128)](_0x23a357(0x138)),console[_0x23a357(0x128)](_0x23a357(0x14e),this[_0x23a357(0x14a)]),console[_0x23a357(0x128)]('Request\x20Body:',JSON['stringify'](_0x39fe05,null,0x2)),loggerService_1[_0x23a357(0x11e)][_0x23a357(0x147)](_0x23a357(0x156),_0x23a357(0x16e),_0x23a357(0x11b),_0x39fe05);const _0x5900ee=await fetch(this[_0x23a357(0x14a)],{'method':_0x23a357(0x11b),'headers':{'Content-Type':_0x23a357(0x127),'merchant_api_key':this[_0x23a357(0x149)]},'body':JSON['stringify'](_0x39fe05)}),_0x9d8efb=Date[_0x23a357(0x13b)]()-_0x1c0bd2;console['log']('===\x20OXAPAY\x20API\x20RESPONSE\x20==='),console[_0x23a357(0x128)]('Status:',_0x5900ee[_0x23a357(0x123)]),console[_0x23a357(0x128)](_0x23a357(0x158),_0x5900ee[_0x23a357(0x14b)]),console['log'](_0x23a357(0x163),_0x9d8efb+'ms');const _0x57252e=await _0x5900ee['text']();console[_0x23a357(0x128)](_0x23a357(0x166),_0x57252e);let _0x2304a6;try{_0x2304a6=JSON[_0x23a357(0x167)](_0x57252e);}catch(_0x2a373b){console[_0x23a357(0x152)](_0x23a357(0x145),_0x2a373b),loggerService_1['loggerService'][_0x23a357(0x15e)](_0x23a357(0x156),_0x23a357(0x16e),_0x23a357(0x131)+_0x2a373b);throw new Error(_0x23a357(0x170)+_0x57252e);}console[_0x23a357(0x128)]('===\x20PARSED\x20OXAPAY\x20RESPONSE\x20==='),console[_0x23a357(0x128)](_0x23a357(0x134),JSON[_0x23a357(0x14d)](_0x2304a6,null,0x2)),loggerService_1[_0x23a357(0x11e)]['logWhiteDomainResponse'](_0x23a357(0x156),'/payment/white-label',_0x5900ee['status'],_0x2304a6,_0x9d8efb);if(_0x2304a6['status']!==0xc8||!_0x2304a6['data']){const _0x314ed9=_0x2304a6[_0x23a357(0x152)]?.['message']||_0x2304a6['message']||'Unknown\x20error\x20from\x20OxaPay\x20API';console[_0x23a357(0x152)](_0x23a357(0x154)),console['error'](_0x23a357(0x13c),_0x314ed9),console[_0x23a357(0x152)](_0x23a357(0x120),_0x2304a6[_0x23a357(0x152)]),loggerService_1['loggerService'][_0x23a357(0x15e)]('oxapay',_0x23a357(0x16e),_0x23a357(0x141)+_0x314ed9);throw new Error(_0x23a357(0x140)+_0x314ed9);}if(!_0x2304a6['data'][_0x23a357(0x15b)]||!_0x2304a6[_0x23a357(0x124)][_0x23a357(0x148)]){console[_0x23a357(0x152)](_0x23a357(0x136)),console[_0x23a357(0x152)]('Missing\x20track_id\x20or\x20address\x20in\x20response'),console[_0x23a357(0x152)]('Response\x20data:',_0x2304a6[_0x23a357(0x124)]),loggerService_1['loggerService'][_0x23a357(0x15e)](_0x23a357(0x156),_0x23a357(0x16e),_0x23a357(0x11f));throw new Error(_0x23a357(0x164));}console['log']('===\x20OXAPAY\x20SUCCESS\x20==='),console[_0x23a357(0x128)](_0x23a357(0x14f),_0x2304a6[_0x23a357(0x124)]['track_id']),console[_0x23a357(0x128)](_0x23a357(0x11d),_0x2304a6['data'][_0x23a357(0x148)]),console[_0x23a357(0x128)](_0x23a357(0x171),_0x2304a6[_0x23a357(0x124)][_0x23a357(0x15d)],_0x2304a6[_0x23a357(0x124)][_0x23a357(0x11a)]),console[_0x23a357(0x128)]('Network:',_0x2304a6['data']['network']);const _0x13cfc8=_0x23a357(0x15f)+_0x526c5b[_0x23a357(0x126)];return{'gateway_payment_id':_0x2304a6[_0x23a357(0x124)]['track_id'],'payment_url':_0x13cfc8,'track_id':_0x2304a6[_0x23a357(0x124)]['track_id'],'amount':_0x2304a6['data'][_0x23a357(0x144)],'currency':_0x2304a6[_0x23a357(0x124)][_0x23a357(0x159)],'pay_amount':_0x2304a6[_0x23a357(0x124)][_0x23a357(0x15d)],'pay_currency':_0x2304a6['data'][_0x23a357(0x11a)],'network':_0x2304a6[_0x23a357(0x124)]['network'],'address':_0x2304a6[_0x23a357(0x124)]['address'],'qr_code':_0x2304a6[_0x23a357(0x124)]['qr_code'],'rate':_0x2304a6[_0x23a357(0x124)]['rate'],'expired_at':_0x2304a6[_0x23a357(0x124)][_0x23a357(0x162)]};}catch(_0x1a01bd){console[_0x23a357(0x152)]('===\x20OXAPAY\x20REQUEST\x20ERROR\x20==='),console[_0x23a357(0x152)](_0x23a357(0x161),_0x1a01bd),loggerService_1['loggerService'][_0x23a357(0x15e)](_0x23a357(0x156),_0x23a357(0x16e),_0x1a01bd instanceof Error?_0x1a01bd[_0x23a357(0x12b)]:String(_0x1a01bd));throw _0x1a01bd;}}[a65_0x46c3f6(0x169)](_0x37079e){const _0x29b0ee=a65_0x46c3f6;switch(_0x37079e['toLowerCase']()){case _0x29b0ee(0x12e):return'PENDING';case _0x29b0ee(0x129):return'PENDING';case _0x29b0ee(0x130):return'PROCESSING';case _0x29b0ee(0x12a):return _0x29b0ee(0x133);case _0x29b0ee(0x16c):return _0x29b0ee(0x133);case _0x29b0ee(0x121):return'PAID';case _0x29b0ee(0x13e):return _0x29b0ee(0x172);case _0x29b0ee(0x12c):return'REFUND';case _0x29b0ee(0x139):return _0x29b0ee(0x16f);default:return _0x29b0ee(0x15c);}}}exports[a65_0x46c3f6(0x13a)]=OxaPayService,exports['oxapayService']=new OxaPayService();