'use strict';function a65_0x50f4(_0x382aae,_0x23dacd){_0x382aae=_0x382aae-0xac;const _0x4e5b87=a65_0x4e5b();let _0x50f4b9=_0x4e5b87[_0x382aae];return _0x50f4b9;}function a65_0x4e5b(){const _0x76b7b7=['826170CiJCLS','10jKFfXm','defineProperty','619959AmnWnS','oxapayService','Status:','oxapay','status','https://api.oxapay.com/v1/payment/white-label','OxaPayService','stringify','qr_code','8121609MMMopv','track_id','under_paid_coverage','loggerService','expired_at','8TKjepr','https://app.trapay.uk/payment/','env','Error:','../loggerService','REFUND','error','/payment/white-label','‚ö†Ô∏è\x20OXAPAY_API_KEY\x20not\x20found\x20in\x20environment\x20variables','amount','Response\x20data:','üí∞\x20OxaPay\x20service\x20initialized','statusText','logWhiteDomainResponse','Status\x20Text:','Failed\x20to\x20parse\x20JSON\x20response:','===\x20OXAPAY\x20SUCCESS\x20===','apiUrl','===\x20OXAPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','createPayment','message','log','Order\x20#','rate','Amount:','Request\x20Body:','logWhiteDomainError','apiKey','fee_paid_by_payer','parse','Track\x20ID:','waiting','currency','API\x20Error:\x20','3985377yYVTxn','network','===\x20OXAPAY\x20API\x20RESPONSE\x20===','pay_currency','===\x20OXAPAY\x20REQUEST\x20ERROR\x20===','paid','pay_amount','address','Parsed\x20Result:','new','Error\x20Details:','OxaPay\x20API\x20error:\x20','POST','951xHhoyV','lifetime','12nXLaSN','257551MQGLMv','paying','data','application/json','2572RxjHpG','PENDING','paymentId','Error\x20Message:','Response\x20Time:','now','toLowerCase','email','https://api.trapay.uk/api/oxapay/callback','2878870jEOhdw','PAID','logWhiteDomainRequest','===\x20OXAPAY\x20API\x20ERROR\x20===','Incomplete\x20response:\x20missing\x20track_id\x20or\x20address','JSON\x20Parse\x20Error:\x20','Missing\x20track_id\x20or\x20address\x20in\x20response'];a65_0x4e5b=function(){return _0x76b7b7;};return a65_0x4e5b();}const a65_0x58eeba=a65_0x50f4;(function(_0x540d9d,_0x377c20){const _0x174b34=a65_0x50f4,_0x55a10a=_0x540d9d();while(!![]){try{const _0x330219=parseInt(_0x174b34(0xd2))/0x1+parseInt(_0x174b34(0xcf))/0x2+-parseInt(_0x174b34(0xb8))/0x3*(-parseInt(_0x174b34(0xbf))/0x4)+parseInt(_0x174b34(0xc8))/0x5*(-parseInt(_0x174b34(0xba))/0x6)+-parseInt(_0x174b34(0xbb))/0x7+-parseInt(_0x174b34(0xe0))/0x8*(-parseInt(_0x174b34(0xdb))/0x9)+-parseInt(_0x174b34(0xd0))/0xa*(parseInt(_0x174b34(0x102))/0xb);if(_0x330219===_0x377c20)break;else _0x55a10a['push'](_0x55a10a['shift']());}catch(_0x5bd28c){_0x55a10a['push'](_0x55a10a['shift']());}}}(a65_0x4e5b,0x8fb54));Object[a65_0x58eeba(0xd1)](exports,'__esModule',{'value':!![]}),exports[a65_0x58eeba(0xd3)]=exports[a65_0x58eeba(0xd8)]=void 0x0;const loggerService_1=require(a65_0x58eeba(0xe4));class OxaPayService{constructor(){const _0x1d1179=a65_0x58eeba;this[_0x1d1179(0xf1)]=_0x1d1179(0xd7),this[_0x1d1179(0xfb)]=process[_0x1d1179(0xe2)]['OXAPAY_API_KEY']||'WCXQ21-DL5OZP-H3SSHH-4GVAR4',!this[_0x1d1179(0xfb)]?console['warn'](_0x1d1179(0xe8)):console[_0x1d1179(0xf5)](_0x1d1179(0xeb));}async[a65_0x58eeba(0xf3)](_0xe549f){const _0x5325f9=a65_0x58eeba,{orderId:_0x2330b2,amount:_0x1e719d,currency:_0x56eaa2,payCurrency:_0x37ce58,network:_0x288818,description:_0x3596fb,customerEmail:_0xe50f3c,lifetime:_0xc8d858,feePaidByPayer:_0x305890,underPaidCoverage:_0x15383d}=_0xe549f;if(!this[_0x5325f9(0xfb)])throw new Error('OxaPay\x20API\x20key\x20is\x20not\x20configured');const _0x20a858={'amount':_0x1e719d,'currency':_0x56eaa2[_0x5325f9(0xc5)](),'callback_url':_0x5325f9(0xc7),'order_id':_0x2330b2,'description':_0x3596fb||_0x5325f9(0xf6)+_0x2330b2};_0x37ce58&&(_0x20a858[_0x5325f9(0xae)]=_0x37ce58['toLowerCase']());_0x288818&&(_0x20a858[_0x5325f9(0xac)]=_0x288818);_0xe50f3c&&(_0x20a858[_0x5325f9(0xc6)]=_0xe50f3c);_0xc8d858!==undefined?_0x20a858[_0x5325f9(0xb9)]=_0xc8d858:_0x20a858[_0x5325f9(0xb9)]=0x3c;_0x305890!==undefined&&(_0x20a858[_0x5325f9(0xfc)]=_0x305890);_0x15383d!==undefined&&(_0x20a858[_0x5325f9(0xdd)]=_0x15383d);const _0x401f13=Date[_0x5325f9(0xc4)]();try{console[_0x5325f9(0xf5)]('===\x20OXAPAY\x20API\x20REQUEST\x20==='),console['log']('URL:',this[_0x5325f9(0xf1)]),console[_0x5325f9(0xf5)](_0x5325f9(0xf9),JSON[_0x5325f9(0xd9)](_0x20a858,null,0x2)),loggerService_1['loggerService'][_0x5325f9(0xca)](_0x5325f9(0xd5),_0x5325f9(0xe7),_0x5325f9(0xb7),_0x20a858);const _0x1aa5a7=await fetch(this[_0x5325f9(0xf1)],{'method':_0x5325f9(0xb7),'headers':{'Content-Type':_0x5325f9(0xbe),'merchant_api_key':this[_0x5325f9(0xfb)]},'body':JSON[_0x5325f9(0xd9)](_0x20a858)}),_0x4d1be0=Date[_0x5325f9(0xc4)]()-_0x401f13;console['log'](_0x5325f9(0xad)),console[_0x5325f9(0xf5)](_0x5325f9(0xd4),_0x1aa5a7[_0x5325f9(0xd6)]),console[_0x5325f9(0xf5)](_0x5325f9(0xee),_0x1aa5a7[_0x5325f9(0xec)]),console[_0x5325f9(0xf5)](_0x5325f9(0xc3),_0x4d1be0+'ms');const _0x343675=await _0x1aa5a7['text']();console[_0x5325f9(0xf5)]('Raw\x20Response\x20Body:',_0x343675);let _0x59ef3c;try{_0x59ef3c=JSON[_0x5325f9(0xfd)](_0x343675);}catch(_0x2a15e9){console[_0x5325f9(0xe6)](_0x5325f9(0xef),_0x2a15e9),loggerService_1['loggerService'][_0x5325f9(0xfa)](_0x5325f9(0xd5),_0x5325f9(0xe7),_0x5325f9(0xcd)+_0x2a15e9);throw new Error('Invalid\x20JSON\x20response\x20from\x20OxaPay\x20API:\x20'+_0x343675);}console[_0x5325f9(0xf5)]('===\x20PARSED\x20OXAPAY\x20RESPONSE\x20==='),console[_0x5325f9(0xf5)](_0x5325f9(0xb3),JSON[_0x5325f9(0xd9)](_0x59ef3c,null,0x2)),loggerService_1[_0x5325f9(0xde)][_0x5325f9(0xed)](_0x5325f9(0xd5),_0x5325f9(0xe7),_0x1aa5a7['status'],_0x59ef3c,_0x4d1be0);if(_0x59ef3c['status']!==0xc8||!_0x59ef3c[_0x5325f9(0xbd)]){const _0x1de942=_0x59ef3c[_0x5325f9(0xe6)]?.[_0x5325f9(0xf4)]||_0x59ef3c['message']||'Unknown\x20error\x20from\x20OxaPay\x20API';console[_0x5325f9(0xe6)](_0x5325f9(0xcb)),console[_0x5325f9(0xe6)](_0x5325f9(0xc2),_0x1de942),console[_0x5325f9(0xe6)](_0x5325f9(0xb5),_0x59ef3c['error']),loggerService_1[_0x5325f9(0xde)][_0x5325f9(0xfa)](_0x5325f9(0xd5),'/payment/white-label',_0x5325f9(0x101)+_0x1de942);throw new Error(_0x5325f9(0xb6)+_0x1de942);}if(!_0x59ef3c['data'][_0x5325f9(0xdc)]||!_0x59ef3c[_0x5325f9(0xbd)][_0x5325f9(0xb2)]){console['error'](_0x5325f9(0xf2)),console[_0x5325f9(0xe6)](_0x5325f9(0xce)),console[_0x5325f9(0xe6)](_0x5325f9(0xea),_0x59ef3c[_0x5325f9(0xbd)]),loggerService_1['loggerService']['logWhiteDomainError']('oxapay',_0x5325f9(0xe7),_0x5325f9(0xcc));throw new Error('Invalid\x20response\x20from\x20OxaPay\x20API:\x20missing\x20track_id\x20or\x20address');}console['log'](_0x5325f9(0xf0)),console[_0x5325f9(0xf5)](_0x5325f9(0xfe),_0x59ef3c[_0x5325f9(0xbd)]['track_id']),console[_0x5325f9(0xf5)]('Address:',_0x59ef3c['data']['address']),console[_0x5325f9(0xf5)](_0x5325f9(0xf8),_0x59ef3c[_0x5325f9(0xbd)][_0x5325f9(0xb1)],_0x59ef3c[_0x5325f9(0xbd)][_0x5325f9(0xae)]),console[_0x5325f9(0xf5)]('Network:',_0x59ef3c['data']['network']);const _0x2650cf=_0x5325f9(0xe1)+_0xe549f[_0x5325f9(0xc1)];return{'gateway_payment_id':_0x59ef3c['data']['track_id'],'payment_url':_0x2650cf,'track_id':_0x59ef3c['data']['track_id'],'amount':_0x59ef3c[_0x5325f9(0xbd)][_0x5325f9(0xe9)],'currency':_0x59ef3c['data'][_0x5325f9(0x100)],'pay_amount':_0x59ef3c['data'][_0x5325f9(0xb1)],'pay_currency':_0x59ef3c[_0x5325f9(0xbd)]['pay_currency'],'network':_0x59ef3c[_0x5325f9(0xbd)][_0x5325f9(0xac)],'address':_0x59ef3c[_0x5325f9(0xbd)][_0x5325f9(0xb2)],'qr_code':_0x59ef3c['data'][_0x5325f9(0xda)],'rate':_0x59ef3c['data'][_0x5325f9(0xf7)],'expired_at':_0x59ef3c[_0x5325f9(0xbd)][_0x5325f9(0xdf)]};}catch(_0x47b324){console[_0x5325f9(0xe6)](_0x5325f9(0xaf)),console['error'](_0x5325f9(0xe3),_0x47b324),loggerService_1[_0x5325f9(0xde)][_0x5325f9(0xfa)](_0x5325f9(0xd5),'/payment/white-label',_0x47b324 instanceof Error?_0x47b324['message']:String(_0x47b324));throw _0x47b324;}}['getPaymentStatusFromCallback'](_0x537143){const _0x43f7af=a65_0x58eeba;switch(_0x537143[_0x43f7af(0xc5)]()){case _0x43f7af(0xb4):return _0x43f7af(0xc0);case _0x43f7af(0xff):return _0x43f7af(0xc0);case _0x43f7af(0xbc):return'PROCESSING';case _0x43f7af(0xb0):return _0x43f7af(0xc9);case'manual_accept':return _0x43f7af(0xc9);case'underpaid':return'PAID';case'refunding':return _0x43f7af(0xe5);case'refunded':return _0x43f7af(0xe5);case'expired':return'EXPIRED';default:return _0x43f7af(0xc0);}}}exports['OxaPayService']=OxaPayService,exports[a65_0x58eeba(0xd3)]=new OxaPayService();