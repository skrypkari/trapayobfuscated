'use strict';function a52_0x3951(_0x32c3b4,_0x4fa0f1){_0x32c3b4=_0x32c3b4-0xae;const _0x1f354e=a52_0x1f35();let _0x3951b0=_0x1f354e[_0x32c3b4];return _0x3951b0;}const a52_0x4904f0=a52_0x3951;(function(_0x20cc00,_0x89b0c0){const _0x142c5b=a52_0x3951,_0x4b105b=_0x20cc00();while(!![]){try{const _0x54469b=-parseInt(_0x142c5b(0xc5))/0x1*(-parseInt(_0x142c5b(0x109))/0x2)+-parseInt(_0x142c5b(0xdd))/0x3*(parseInt(_0x142c5b(0xb6))/0x4)+parseInt(_0x142c5b(0x147))/0x5*(parseInt(_0x142c5b(0x107))/0x6)+parseInt(_0x142c5b(0x13c))/0x7+-parseInt(_0x142c5b(0xcb))/0x8+-parseInt(_0x142c5b(0x127))/0x9+-parseInt(_0x142c5b(0x13f))/0xa*(-parseInt(_0x142c5b(0x135))/0xb);if(_0x54469b===_0x89b0c0)break;else _0x4b105b['push'](_0x4b105b['shift']());}catch(_0x3486a0){_0x4b105b['push'](_0x4b105b['shift']());}}}(a52_0x1f35,0x558ee));function a52_0x1f35(){const _0x356bfa=['TUR','VAT','GUY','Customer\x20IP:','AND','JOR','NGA','Invalid\x20JSON\x20response\x20from\x20AmPay:\x20','GRC','Customer:','KOR','ISR','âš ï¸\x20WEBHOOKS\x20TEMPORARILY\x20DISABLED\x20-\x20Always\x20returning\x20PROCESSING\x20status','MNG','System\x20ID:','KHM','6022548lmwATB','Webhook\x20data:','LKA','KEN','EGY','XKX','POST','system_id','MDG','AFG','MKD','convert2LetterTo3LetterCountryCode','LVA','PHL','1636184SdqgIT','tracker_id','Status:','SAU','ðŸ“\x20Logging\x20AmPay\x20payment\x20creation\x20failure...','BEL','JPN','2502682WeWMPf','CHL','QAT','20inEDBM','ðŸ“Š\x20AmPay\x20response\x20data:','GHA','ESP','Tracker\x20ID:','LUX','RUS','COL','2723785CGWKxV','FLK','warn','https://traffer.uk/gateway/ampay/','ARM','CAN','Email:','ZAF','VEN','340bFFklz','Extracted\x20payment\x20ID:\x20','TJK','DNK','CLIENT_MERCHANT_ID','UZB','toUpperCase','CHE','parse','AmPayService','TRAFFER','application/json','client_transaction_id','MNE','PRY','130639BGqDhb','BTN','IND','MUS','MYS','IRN','166760mZuGFX','ALB','ðŸ“¤\x20AmPay\x20request\x20body:','ISL','ðŸ‡¦ðŸ‡²\x20Creating\x20AmPay\x20payment\x20link...','===\x20Processing\x20AmPay\x20webhook\x20===','MMR','SYR','REU','error','TKM','SGP','KGZ','MDV','ECU','PER',',\x20using\x20RUS\x20as\x20fallback','PENDING','19455cIjADR','THA','BRA','Customer\x20Country\x20(2-letter):','Customer\x20Country\x20(3-letter):','apiUrl','TrapayAPI/1.0','SRB','VNM','API_PUBLIC_KEY','HRV','\x20-\x20','ZWE','amount','a5a059aa63392e571341bddc5148a5db66643722e9a6bf16a9395fb690a80288931d5a1180a85a28eb9f6516cf61dfc1bf4e37898f3a35261cd2db88888d3815','URY','object','FRA','HUN','MDA','BGD','MLT','âŒ\x20AmPay\x20health\x20check\x20failed:','ROU','POL','FIN','createPaymentLink','MWI','IDN','BGR','No\x20payment\x20ID\x20found\x20in\x20webhook\x20data','LTU','ITA','LAO','CHN','__esModule','NPL','YEM','ampayService','processWebhook','AUT','âŒ\x20AmPay\x20payment\x20creation\x20failed:','6ryBNZp','stringify','6sdnxZc','IRL','GBR','status','MEX','LIE','Unknown\x20error','SUR','AmPay\x20API\x20error:\x20HTTP\x20','log','NOR','LBN','âš ï¸\x20Unknown\x20country\x20code:\x20','Amount:'];a52_0x1f35=function(){return _0x356bfa;};return a52_0x1f35();}Object['defineProperty'](exports,a52_0x4904f0(0x100),{'value':!![]}),exports[a52_0x4904f0(0x103)]=exports[a52_0x4904f0(0xbf)]=void 0x0;class AmPayService{constructor(){const _0x48e86b=a52_0x4904f0;this[_0x48e86b(0xba)]=_0x48e86b(0xc0),this[_0x48e86b(0xe6)]='58b59ccbc03dcdcfc20d830edfba765dbf9f3531c692533d84b17938e9c40bda',this['API_PRIVATE_KEY']=_0x48e86b(0xeb),this['apiUrl']=_0x48e86b(0xb0),console[_0x48e86b(0x112)]('ðŸ‡¦ðŸ‡²\x20AmPay\x20service\x20initialized\x20with\x20Open\x20Banking\x20AM\x20processing');}['convert2LetterTo3LetterCountryCode'](_0x2d5ea1){const _0x3bacdd=a52_0x4904f0,_0x1b761a={'AD':_0x3bacdd(0x11b),'AL':_0x3bacdd(0xcc),'AT':_0x3bacdd(0x105),'BA':'BIH','BE':_0x3bacdd(0x13a),'BG':_0x3bacdd(0xfa),'BY':'BLR','CH':_0x3bacdd(0xbd),'CY':'CYP','CZ':'CZE','DE':'DEU','DK':_0x3bacdd(0xb9),'EE':'EST','ES':_0x3bacdd(0x142),'FI':_0x3bacdd(0xf6),'FR':_0x3bacdd(0xee),'GB':_0x3bacdd(0x10b),'GE':'GEO','GR':_0x3bacdd(0x11f),'HR':_0x3bacdd(0xe7),'HU':_0x3bacdd(0xef),'IE':_0x3bacdd(0x10a),'IS':_0x3bacdd(0xce),'IT':_0x3bacdd(0xfd),'LI':_0x3bacdd(0x10e),'LT':_0x3bacdd(0xfc),'LU':_0x3bacdd(0x144),'LV':_0x3bacdd(0x133),'MC':'MCO','MD':_0x3bacdd(0xf0),'ME':_0x3bacdd(0xc3),'MK':_0x3bacdd(0x131),'MT':_0x3bacdd(0xf2),'NL':'NLD','NO':_0x3bacdd(0x113),'PL':_0x3bacdd(0xf5),'PT':'PRT','RO':_0x3bacdd(0xf4),'RS':_0x3bacdd(0xe4),'RU':_0x3bacdd(0x145),'SE':'SWE','SI':'SVN','SK':'SVK','SM':'SMR','UA':'UKR','VA':_0x3bacdd(0x118),'XK':_0x3bacdd(0x12c),'AM':_0x3bacdd(0xb1),'AZ':'AZE','KZ':'KAZ','KG':_0x3bacdd(0xd7),'TJ':_0x3bacdd(0xb8),'TM':_0x3bacdd(0xd5),'UZ':_0x3bacdd(0xbb),'US':'USA','CA':_0x3bacdd(0xb2),'AU':'AUS','JP':_0x3bacdd(0x13b),'CN':_0x3bacdd(0xff),'IN':_0x3bacdd(0xc7),'BR':_0x3bacdd(0xdf),'MX':_0x3bacdd(0x10d),'AR':'ARG','CL':_0x3bacdd(0x13d),'PE':_0x3bacdd(0xda),'CO':_0x3bacdd(0x146),'VE':_0x3bacdd(0xb5),'EC':_0x3bacdd(0xd9),'BO':'BOL','PY':_0x3bacdd(0xc4),'UY':_0x3bacdd(0xec),'SR':_0x3bacdd(0x110),'GY':_0x3bacdd(0x119),'FK':_0x3bacdd(0xae),'ZA':_0x3bacdd(0xb4),'EG':_0x3bacdd(0x12b),'NG':_0x3bacdd(0x11d),'KE':_0x3bacdd(0x12a),'GH':_0x3bacdd(0x141),'TZ':'TZA','UG':'UGA','ZW':_0x3bacdd(0xe9),'ZM':'ZMB','MW':_0x3bacdd(0xf8),'MZ':'MOZ','MG':_0x3bacdd(0x12f),'MU':_0x3bacdd(0xc8),'SC':'SYC','RE':_0x3bacdd(0xd3),'TR':_0x3bacdd(0x117),'IR':_0x3bacdd(0xca),'IQ':'IRQ','SA':_0x3bacdd(0x138),'AE':'ARE','KW':'KWT','QA':_0x3bacdd(0x13e),'BH':'BHR','OM':'OMN','YE':_0x3bacdd(0x102),'JO':_0x3bacdd(0x11c),'LB':_0x3bacdd(0x114),'SY':_0x3bacdd(0xd2),'IL':_0x3bacdd(0x122),'PS':'PSE','KR':_0x3bacdd(0x121),'KP':'PRK','TH':_0x3bacdd(0xde),'VN':_0x3bacdd(0xe5),'MY':_0x3bacdd(0xc9),'SG':_0x3bacdd(0xd6),'ID':_0x3bacdd(0xf9),'PH':_0x3bacdd(0x134),'LA':_0x3bacdd(0xfe),'KH':_0x3bacdd(0x126),'MM':_0x3bacdd(0xd1),'BD':_0x3bacdd(0xf1),'LK':_0x3bacdd(0x129),'NP':_0x3bacdd(0x101),'BT':_0x3bacdd(0xc6),'MV':_0x3bacdd(0xd8),'AF':_0x3bacdd(0x130),'PK':'PAK','MN':_0x3bacdd(0x124)},_0x319b23=_0x1b761a[_0x2d5ea1[_0x3bacdd(0xbc)]()];if(!_0x319b23)return console[_0x3bacdd(0xaf)](_0x3bacdd(0x115)+_0x2d5ea1+_0x3bacdd(0xdb)),_0x3bacdd(0x145);return _0x319b23;}async[a52_0x4904f0(0xf7)](_0x1a990a){const _0x34459b=a52_0x4904f0;try{const {orderId:_0x4c6077,amount:_0x11aebe,currency:_0xb4322b,firstName:_0x288448,lastName:_0x14e7d0,email:_0x571411,customerIp:_0xb65789,customerCountry:_0x421420,successUrl:_0x584638,failureUrl:_0x8a3813}=_0x1a990a;console[_0x34459b(0x112)](_0x34459b(0xcf)),console[_0x34459b(0x112)]('Order\x20ID:',_0x4c6077),console[_0x34459b(0x112)](_0x34459b(0x116),_0x11aebe,_0xb4322b),console['log'](_0x34459b(0x120),_0x288448+'\x20'+_0x14e7d0),console[_0x34459b(0x112)](_0x34459b(0xb3),_0x571411),console['log'](_0x34459b(0x11a),_0xb65789),console[_0x34459b(0x112)](_0x34459b(0xe0),_0x421420);const _0x5edbfe=this[_0x34459b(0x132)](_0x421420);console[_0x34459b(0x112)](_0x34459b(0xe1),_0x5edbfe);const _0x1733f1={'sub_method':'GAM','currency':_0xb4322b[_0x34459b(0xbc)](),'amount':_0x11aebe,'callback_url':'https://traffer.uk/gateway/ampay/webhook.php','client_merchant_id':this[_0x34459b(0xba)],'client_transaction_id':_0x4c6077,'transaction_description':_0x4c6077,'customer':{'ip':_0xb65789,'email':_0x571411,'full_name':_0x288448+'\x20'+_0x14e7d0,'country':_0x5edbfe},'success_redirect_url':_0x584638,'error_redirect_url':_0x8a3813};console[_0x34459b(0x112)](_0x34459b(0xcd),JSON['stringify'](_0x1733f1,null,0x2));const _0x53097c=await fetch(this[_0x34459b(0xe2)]+'ampay.php',{'method':_0x34459b(0x12d),'headers':{'Content-Type':_0x34459b(0xc1),'User-Agent':_0x34459b(0xe3)},'body':JSON[_0x34459b(0x108)](_0x1733f1)}),_0x5de351=await _0x53097c['text']();console[_0x34459b(0x112)]('ðŸ“¥\x20AmPay\x20raw\x20response:',_0x5de351);if(!_0x53097c['ok'])throw new Error(_0x34459b(0x111)+_0x53097c[_0x34459b(0x10c)]+_0x34459b(0xe8)+_0x5de351);let _0x575f85;try{_0x575f85=JSON[_0x34459b(0xbe)](_0x5de351);}catch(_0x14ba98){throw new Error(_0x34459b(0x11e)+_0x5de351);}console[_0x34459b(0x112)](_0x34459b(0x140),JSON[_0x34459b(0x108)](_0x575f85,null,0x2));if(!_0x575f85['redirect_url'])throw new Error('AmPay\x20payment\x20creation\x20failed:\x20'+(_0x575f85['error_message']||_0x575f85['message']||_0x34459b(0x10f)));const _0x3ad154=_0x575f85['redirect_url'],_0x3480a9=_0x575f85[_0x34459b(0x12e)],_0x5d19ba=_0x575f85[_0x34459b(0x136)];return console[_0x34459b(0x112)]('âœ…\x20AmPay\x20payment\x20link\x20created\x20successfully'),console[_0x34459b(0x112)]('Payment\x20URL:',_0x3ad154),console[_0x34459b(0x112)](_0x34459b(0x125),_0x3480a9),console[_0x34459b(0x112)](_0x34459b(0x143),_0x5d19ba),console['log'](_0x34459b(0x137),_0x575f85[_0x34459b(0x10c)]),console[_0x34459b(0x112)]('ðŸ“\x20Logging\x20AmPay\x20payment\x20creation\x20event...'),{'gateway_payment_id':_0x3480a9||_0x5d19ba||_0x4c6077,'payment_url':_0x3ad154||'','transaction_id':_0x3480a9};}catch(_0x5d50c9){console[_0x34459b(0xd4)](_0x34459b(0x106),_0x5d50c9),console[_0x34459b(0x112)](_0x34459b(0x139));throw _0x5d50c9;}}async['healthCheck'](){const _0x41eff1=a52_0x4904f0;try{const _0x1b8fda=await fetch(this[_0x41eff1(0xe2)]+'health.php',{'method':'GET','headers':{'Content-Type':_0x41eff1(0xc1),'User-Agent':_0x41eff1(0xe3)}});return _0x1b8fda&&_0x1b8fda[_0x41eff1(0x10c)]===0xc8?!![]:![];}catch(_0x20c3a7){return console[_0x41eff1(0xd4)](_0x41eff1(0xf3),_0x20c3a7),![];}}async[a52_0x4904f0(0x104)](_0x25b83c){const _0x388599=a52_0x4904f0;console[_0x388599(0x112)](_0x388599(0xd0)),console['log'](_0x388599(0x123)),console['log'](_0x388599(0x128),_0x25b83c),console[_0x388599(0x112)]('Webhook\x20data\x20type:',typeof _0x25b83c),console[_0x388599(0x112)]('Available\x20fields:');_0x25b83c&&typeof _0x25b83c===_0x388599(0xed)&&Object['keys'](_0x25b83c)['forEach'](_0x201642=>{console['log']('\x20\x20'+_0x201642+':\x20'+_0x25b83c[_0x201642]+'\x20('+typeof _0x25b83c[_0x201642]+')');});let _0x59a2d1=_0x388599(0xdc);const _0x42366e=_0x25b83c[_0x388599(0xc2)]||_0x25b83c[_0x388599(0x12e)]||_0x25b83c[_0x388599(0x136)]||'';return console['log'](_0x388599(0xb7)+_0x42366e),console[_0x388599(0x112)]('Forced\x20status\x20(webhook\x20disabled):\x20'+_0x59a2d1),!_0x42366e&&(console[_0x388599(0xd4)](_0x388599(0xfb)),console[_0x388599(0xd4)]('Checked\x20fields:\x20client_transaction_id,\x20system_id,\x20tracker_id')),{'paymentId':_0x42366e,'status':_0x59a2d1,'amount':_0x25b83c[_0x388599(0xea)],'currency':_0x25b83c['currency']};}}exports[a52_0x4904f0(0xbf)]=AmPayService,exports[a52_0x4904f0(0x103)]=new AmPayService();