'use strict';function a42_0x9b4e(_0x46540b,_0x297a48){const _0x3445b2=a42_0x3445();return a42_0x9b4e=function(_0x9b4e63,_0x4bcd74){_0x9b4e63=_0x9b4e63-0xa3;let _0x1f71cf=_0x3445b2[_0x9b4e63];return _0x1f71cf;},a42_0x9b4e(_0x46540b,_0x297a48);}const a42_0x2aea2a=a42_0x9b4e;function a42_0x3445(){const _0x234e96=['logWhiteDomainResponse','Failed\x20to\x20verify\x20Noda\x20payment:\x20','done','log','fromEntries','18lbURwX','Processing\x20Noda\x20webhook:','PENDING','https://tesoft.uk/gateway/noda/','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','canceled','text','Noda\x20API\x20error:\x20','created','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Parsed\x20Result:','stack','message','Error\x20Message:','Error\x20message:','QR\x20Code\x20Link:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','expired','Noda\x20payment\x20verification\x20error:','noda','Unknown\x20error','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Response\x20data:','completed','FAILED','Settled','processWebhook','Headers:','22CAQJPr','8708rWXDui','POST','1832485Bjgure','active','Status\x20Code:','Failed\x20to\x20parse\x20JSON\x20response:','GET','(8digits-8digits\x20format\x20for\x20Noda)','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Raw\x20Response\x20Body:','6435060cjqsYO','NodaService','rejected','URL:','expiryDate','Request\x20Body\x20(Direct\x20JSON):','timeout','stringify','qrCodeLink','successful','MerchantPaymentId','PAID','status','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','toUpperCase','pending','shortLinkUrls','loggerService','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Noda\x20webhook\x20signature\x20verification:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','BankId','2023232Cguqit','2191496ozVMwe','verifyPayment','===\x20NODA\x20SERVICE\x20ERROR\x20===','Yes','https://tesoft.uk/gateway/pending.php?id=','Method','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','error','SettlementDate','__esModule','in_progress','Short\x20Link:','Remitter','logWhiteDomainRequest','Error\x20details:','shortLink','402azztOI','EXPIRED','entries','processing','Missing\x20id\x20or\x20shortLink\x20in\x20response','defineProperty','apiUrl','HTTP\x20Status:','Name','Status','644888fEtRQV','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','10448WlOeGp','Payment\x20Link\x20ID:','/payment-links/','/payment-links','now','HTTP\x20error!\x20status:\x20','TesSoft\x20Payment\x20System/1.0','statusText','BankTransactionId','Order\x20ID\x20Used:','1812ajzRXn','currency','Status:','isActive','paid','verifyWebhookSignature','toLowerCase','Currency','statusCode','logWhiteDomainError','application/json','===\x20NODA\x20SUCCESS\x20===','../loggerService','createPaymentLink'];a42_0x3445=function(){return _0x234e96;};return a42_0x3445();}(function(_0x3af8a9,_0x53fe22){const _0x19e52c=a42_0x9b4e,_0x189bd8=_0x3af8a9();while(!![]){try{const _0x38d6ce=parseInt(_0x19e52c(0xc7))/0x1+-parseInt(_0x19e52c(0xc9))/0x2*(-parseInt(_0x19e52c(0xbd))/0x3)+parseInt(_0x19e52c(0xac))/0x4+-parseInt(_0x19e52c(0x107))/0x5+parseInt(_0x19e52c(0xd3))/0x6*(-parseInt(_0x19e52c(0x105))/0x7)+parseInt(_0x19e52c(0xad))/0x8*(parseInt(_0x19e52c(0xe6))/0x9)+parseInt(_0x19e52c(0x10f))/0xa*(-parseInt(_0x19e52c(0x104))/0xb);if(_0x38d6ce===_0x53fe22)break;else _0x189bd8['push'](_0x189bd8['shift']());}catch(_0x942eb4){_0x189bd8['push'](_0x189bd8['shift']());}}}(a42_0x3445,0x5a2ed));Object[a42_0x2aea2a(0xc2)](exports,a42_0x2aea2a(0xb6),{'value':!![]}),exports[a42_0x2aea2a(0x110)]=void 0x0;const loggerService_1=require(a42_0x2aea2a(0xdf));class NodaService{constructor(){const _0x2a70b0=a42_0x2aea2a;this['apiUrl']=_0x2a70b0(0xe9),console[_0x2a70b0(0xe4)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a42_0x2aea2a(0xe0)](_0x4a8a8e){const _0x378502=a42_0x2aea2a,{orderId:_0x27bd92,name:_0x1b9106,paymentDescription:_0x18bf2b,amount:_0x25554d,currency:_0x152700,webhookUrl:_0x3afddb,returnUrl:_0x554f91,expiryDate:_0x6b401e}=_0x4a8a8e,_0x24de35=_0x152700[_0x378502(0xa4)](),_0x5a5aa9='https://tesoft.uk/gateway/noda/webhook/',_0x51ab9f=_0x378502(0xb1)+_0x27bd92,_0x38d00d={'name':_0x1b9106,'paymentDescription':_0x18bf2b,'amount':_0x25554d,'currency':_0x24de35,'paymentId':_0x27bd92,'webhookUrl':_0x5a5aa9,'returnUrl':_0x51ab9f};_0x6b401e&&(_0x38d00d[_0x378502(0x113)]=_0x6b401e);const _0x2ac38c=Date[_0x378502(0xcd)]();try{console[_0x378502(0xe4)](_0x378502(0xc8)),console[_0x378502(0xe4)](_0x378502(0x112),this[_0x378502(0xc3)]),console[_0x378502(0xe4)](_0x378502(0x114),JSON['stringify'](_0x38d00d,null,0x2)),console[_0x378502(0xe4)]('Order\x20ID\x20Format:',_0x27bd92,_0x378502(0x10c)),console['log'](_0x378502(0xa8),_0x51ab9f),loggerService_1[_0x378502(0xa7)][_0x378502(0xba)](_0x378502(0xfb),'/payment-links',_0x378502(0x106),_0x38d00d);const _0x55811b=await fetch(this[_0x378502(0xc3)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x378502(0xdd),'User-Agent':_0x378502(0xcf)},'body':JSON[_0x378502(0x116)](_0x38d00d)}),_0xba1aa6=Date[_0x378502(0xcd)]()-_0x2ac38c;console[_0x378502(0xe4)](_0x378502(0xf1)),console[_0x378502(0xe4)](_0x378502(0xd5),_0x55811b[_0x378502(0x11b)]),console[_0x378502(0xe4)]('Status\x20Text:',_0x55811b[_0x378502(0xd0)]),console[_0x378502(0xe4)](_0x378502(0x103),Object[_0x378502(0xe5)](_0x55811b['headers'][_0x378502(0xbf)]())),console[_0x378502(0xe4)]('Response\x20Time:',_0xba1aa6+'ms');const _0x52c44f=await _0x55811b[_0x378502(0xed)]();console['log'](_0x378502(0x10e),_0x52c44f);if(!_0x55811b['ok']){console[_0x378502(0xb4)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x378502(0xb4)](_0x378502(0xc4),_0x55811b[_0x378502(0x11b)]),console[_0x378502(0xb4)]('Response\x20Body:',_0x52c44f),loggerService_1[_0x378502(0xa7)][_0x378502(0xe1)](_0x378502(0xfb),_0x378502(0xcc),_0x55811b[_0x378502(0x11b)],_0x52c44f,_0xba1aa6),loggerService_1['loggerService'][_0x378502(0xdc)](_0x378502(0xfb),'/payment-links','HTTP\x20'+_0x55811b[_0x378502(0x11b)]+':\x20'+_0x52c44f);if(_0x55811b[_0x378502(0x11b)]===0x190)throw new Error(_0x378502(0xea));else{if(_0x55811b[_0x378502(0x11b)]===0x1f4)throw new Error(_0x378502(0xb3));}throw new Error(_0x378502(0xce)+_0x55811b[_0x378502(0x11b)]+',\x20body:\x20'+_0x52c44f);}let _0x581a52;try{_0x581a52=JSON['parse'](_0x52c44f);}catch(_0x4aca58){console[_0x378502(0xb4)](_0x378502(0x10a),_0x4aca58),loggerService_1[_0x378502(0xa7)][_0x378502(0xdc)](_0x378502(0xfb),'/payment-links','JSON\x20Parse\x20Error:\x20'+_0x4aca58);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x52c44f);}console[_0x378502(0xe4)](_0x378502(0x10d)),console[_0x378502(0xe4)](_0x378502(0xf2),JSON['stringify'](_0x581a52,null,0x2)),loggerService_1[_0x378502(0xa7)][_0x378502(0xe1)](_0x378502(0xfb),_0x378502(0xcc),_0x55811b['status'],_0x581a52,_0xba1aa6);if(_0x581a52[_0x378502(0xb4)]||_0x581a52[_0x378502(0xdb)]){const _0x44b008=_0x581a52[_0x378502(0xf4)]||_0x581a52[_0x378502(0xb4)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x378502(0xb4)](_0x378502(0xeb)),console[_0x378502(0xb4)](_0x378502(0xf5),_0x44b008),console[_0x378502(0xb4)](_0x378502(0x109),_0x581a52[_0x378502(0xdb)]),loggerService_1[_0x378502(0xa7)][_0x378502(0xdc)](_0x378502(0xfb),_0x378502(0xcc),'Business\x20Error:\x20'+_0x44b008);throw new Error(_0x378502(0xee)+_0x44b008);}if(!_0x581a52['id']||!_0x581a52['shortLinkUrls']?.[_0x378502(0xbc)]){console[_0x378502(0xb4)](_0x378502(0xa3)),console[_0x378502(0xb4)](_0x378502(0xc1)),console['error'](_0x378502(0xfe),_0x581a52),loggerService_1[_0x378502(0xa7)][_0x378502(0xdc)](_0x378502(0xfb),_0x378502(0xcc),_0x378502(0xaa));throw new Error(_0x378502(0xf8));}return console[_0x378502(0xe4)](_0x378502(0xde)),console[_0x378502(0xe4)](_0x378502(0xca),_0x581a52['id']),console['log'](_0x378502(0xb8),_0x581a52[_0x378502(0xa6)][_0x378502(0xbc)]),console[_0x378502(0xe4)](_0x378502(0xf7),_0x581a52[_0x378502(0xa6)][_0x378502(0x117)]||'Not\x20provided'),console[_0x378502(0xe4)](_0x378502(0xd2),_0x27bd92,'(8digits-8digits\x20format)'),console[_0x378502(0xe4)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x51ab9f),{'gateway_payment_id':_0x581a52['id'],'payment_url':_0x581a52[_0x378502(0xa6)][_0x378502(0xbc)],'qr_code_url':_0x581a52[_0x378502(0xa6)][_0x378502(0x117)],'expiry_date':_0x581a52['expiryDate']};}catch(_0x3b9341){console['error'](_0x378502(0xaf)),console[_0x378502(0xb4)](_0x378502(0xbb),_0x3b9341),loggerService_1[_0x378502(0xa7)][_0x378502(0xdc)](_0x378502(0xfb),'/payment-links',_0x3b9341);if(_0x3b9341 instanceof Error){console[_0x378502(0xb4)](_0x378502(0xf6),_0x3b9341[_0x378502(0xf4)]),console[_0x378502(0xb4)]('Error\x20stack:',_0x3b9341[_0x378502(0xf3)]);throw new Error(_0x378502(0xfd)+_0x3b9341['message']);}throw new Error(_0x378502(0xf0));}}async[a42_0x2aea2a(0xae)](_0x1e1eda){const _0x49f202=a42_0x2aea2a,_0xe682c1=Date[_0x49f202(0xcd)]();try{loggerService_1[_0x49f202(0xa7)][_0x49f202(0xba)]('noda',_0x49f202(0xcb)+_0x1e1eda,_0x49f202(0x10b),{});const _0x32a375=await fetch(this[_0x49f202(0xc3)]+'/'+_0x1e1eda,{'method':'GET','headers':{'Content-Type':_0x49f202(0xdd),'User-Agent':_0x49f202(0xcf)}}),_0x1be78f=Date['now']()-_0xe682c1;if(!_0x32a375['ok']){const _0x502354=await _0x32a375[_0x49f202(0xed)]();loggerService_1['loggerService'][_0x49f202(0xe1)]('noda','/payment-links/'+_0x1e1eda,_0x32a375[_0x49f202(0x11b)],_0x502354,_0x1be78f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x32a375[_0x49f202(0x11b)]);}const _0x151f5d=await _0x32a375['json']();loggerService_1[_0x49f202(0xa7)][_0x49f202(0xe1)](_0x49f202(0xfb),'/payment-links/'+_0x1e1eda,_0x32a375[_0x49f202(0x11b)],_0x151f5d,_0x1be78f);if(_0x151f5d['error']||_0x151f5d[_0x49f202(0xdb)]){loggerService_1[_0x49f202(0xa7)]['logWhiteDomainError'](_0x49f202(0xfb),_0x49f202(0xcb)+_0x1e1eda,_0x49f202(0xee)+(_0x151f5d[_0x49f202(0xf4)]||_0x151f5d[_0x49f202(0xb4)]||'Unknown\x20error'));throw new Error(_0x49f202(0xee)+(_0x151f5d[_0x49f202(0xf4)]||_0x151f5d[_0x49f202(0xb4)]||'Unknown\x20error'));}let _0x118906=_0x49f202(0xe8);if(_0x151f5d[_0x49f202(0xd6)]===![]){if(_0x151f5d[_0x49f202(0x113)]){const _0x2d75eb=new Date(_0x151f5d[_0x49f202(0x113)]),_0x487515=new Date();_0x2d75eb<_0x487515?_0x118906='EXPIRED':_0x118906='FAILED';}else _0x118906=_0x49f202(0x100);}else _0x118906=_0x49f202(0xe8);return{'status':_0x118906,'amount':_0x151f5d['amount'],'currency':_0x151f5d[_0x49f202(0xd4)],'isActive':_0x151f5d[_0x49f202(0xd6)]};}catch(_0x3fcf4f){console[_0x49f202(0xb4)](_0x49f202(0xfa),_0x3fcf4f),loggerService_1['loggerService']['logWhiteDomainError'](_0x49f202(0xfb),_0x49f202(0xcb)+_0x1e1eda,_0x3fcf4f);throw new Error(_0x49f202(0xe2)+(_0x3fcf4f instanceof Error?_0x3fcf4f[_0x49f202(0xf4)]:_0x49f202(0xfc)));}}async[a42_0x2aea2a(0x102)](_0x473461){const _0x16684a=a42_0x2aea2a;console['log'](_0x16684a(0xe7),_0x473461);let _0x36544f='PENDING';switch(_0x473461[_0x16684a(0xc6)]?.[_0x16684a(0xd9)]()){case _0x16684a(0xe3):case _0x16684a(0xff):case _0x16684a(0xd7):case'success':case _0x16684a(0x118):_0x473461[_0x16684a(0x101)]===_0x16684a(0xb0)?_0x36544f=_0x16684a(0x11a):_0x36544f=_0x16684a(0xe8);break;case'cancelled':case _0x16684a(0xec):case'failed':case _0x16684a(0xb4):case _0x16684a(0x111):_0x36544f='FAILED';break;case _0x16684a(0xf9):case _0x16684a(0x115):_0x36544f=_0x16684a(0xbe);break;case _0x16684a(0xa5):case _0x16684a(0xef):case _0x16684a(0x108):case _0x16684a(0xc0):case _0x16684a(0xb7):default:_0x36544f=_0x16684a(0xe8);break;}return{'paymentId':_0x473461[_0x16684a(0x119)]||_0x473461['PaymentId'],'status':_0x36544f,'amount':_0x473461['Amount'],'currency':_0x473461[_0x16684a(0xda)],'additionalInfo':{'method':_0x473461[_0x16684a(0xb2)],'bankId':_0x473461[_0x16684a(0xab)],'settled':_0x473461[_0x16684a(0x101)],'settlementDate':_0x473461[_0x16684a(0xb5)],'remitterName':_0x473461[_0x16684a(0xb9)]?.[_0x16684a(0xc5)],'remitterIban':_0x473461[_0x16684a(0xb9)]?.['Iban'],'bankTransactionId':_0x473461[_0x16684a(0xd1)]}};}[a42_0x2aea2a(0xd8)](_0xe3ab00,_0x1f4ff6){const _0x39a263=a42_0x2aea2a;return console[_0x39a263(0xe4)](_0x39a263(0xa9),{'receivedSignature':_0x1f4ff6,'paymentId':_0xe3ab00['PaymentId'],'merchantPaymentId':_0xe3ab00['MerchantPaymentId']}),!![];}}exports[a42_0x2aea2a(0x110)]=NodaService;