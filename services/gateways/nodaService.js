'use strict';function a43_0x2167(){const _0x165706=['2ZGfczD','createPaymentLink','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20NODA\x20SERVICE\x20ERROR\x20===','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','noda','FAILED','Currency','Failed\x20to\x20parse\x20JSON\x20response:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Noda\x20API\x20error:\x20','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','12qeKXAp','Order\x20ID\x20Used:','Remitter','status','successful','failed','shortLinkUrls','loggerService','apiUrl','headers','16984fIEeHS','341559UUbmwL','Response\x20Time:','(8digits-8digits\x20format)','error','logWhiteDomainRequest','BankTransactionId','fromEntries','2215157udwGLG','in_progress','3429ACpoEd','3493580Pivngr','application/json','Settled','Name','Business\x20Error:\x20','currency','2199300QXLaza','TesSoft\x20Payment\x20System/1.0','expired','completed','MerchantPaymentId','PENDING','message','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','processWebhook','active','NodaService','Unknown\x20error','88pyjJJh','entries','log','isActive','/payment-links','cancelled','Missing\x20id\x20or\x20shortLink\x20in\x20response','stringify','Headers:','rejected','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','PAID','Order\x20ID\x20Format:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','https://tesoft.uk/gateway/pending.php?id=','107243fArtTo','logWhiteDomainResponse','Yes','156eJUwQx','created','parse','statusText','BankId','shortLink','../loggerService','Response\x20data:','Processing\x20Noda\x20webhook:','Error\x20message:','Unknown\x20error\x20from\x20Noda\x20API','URL:','Response\x20Body:','https://tesoft.uk/gateway/noda/webhook/','Method','now','107345zxbuHy','JSON\x20Parse\x20Error:\x20','QR\x20Code\x20Link:','logWhiteDomainError','GET','HTTP\x20','Not\x20provided','__esModule','canceled','Error\x20stack:','qrCodeLink','verifyPayment',',\x20body:\x20','===\x20NODA\x20SUCCESS\x20===','Noda\x20payment\x20verification\x20error:','Iban','Error\x20Message:','Noda\x20webhook\x20signature\x20verification:','/payment-links/','statusCode','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','text','HTTP\x20error!\x20status:\x20','HTTP\x20Status:','amount','Short\x20Link:','expiryDate','SettlementDate','Error\x20details:','verifyWebhookSignature','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Status:'];a43_0x2167=function(){return _0x165706;};return a43_0x2167();}const a43_0x57aad4=a43_0x313b;(function(_0x50d16b,_0x18e225){const _0xe363b8=a43_0x313b,_0x67f79=_0x50d16b();while(!![]){try{const _0x244270=-parseInt(_0xe363b8(0x171))/0x1*(parseInt(_0xe363b8(0x1a4))/0x2)+parseInt(_0xe363b8(0x1bc))/0x3+parseInt(_0xe363b8(0x174))/0x4*(parseInt(_0xe363b8(0x184))/0x5)+-parseInt(_0xe363b8(0x1b1))/0x6*(-parseInt(_0xe363b8(0x1c3))/0x7)+-parseInt(_0xe363b8(0x1bb))/0x8*(-parseInt(_0xe363b8(0x1c5))/0x9)+-parseInt(_0xe363b8(0x1c6))/0xa+-parseInt(_0xe363b8(0x1d9))/0xb*(parseInt(_0xe363b8(0x1cc))/0xc);if(_0x244270===_0x18e225)break;else _0x67f79['push'](_0x67f79['shift']());}catch(_0x2d628c){_0x67f79['push'](_0x67f79['shift']());}}}(a43_0x2167,0x72c5c));Object['defineProperty'](exports,a43_0x57aad4(0x18b),{'value':!![]}),exports[a43_0x57aad4(0x1d7)]=void 0x0;const loggerService_1=require(a43_0x57aad4(0x17a));class NodaService{constructor(){const _0x19f6ef=a43_0x57aad4;this[_0x19f6ef(0x1b9)]='https://tesoft.uk/gateway/noda/',console[_0x19f6ef(0x1db)](_0x19f6ef(0x1a2));}async[a43_0x57aad4(0x1a5)](_0x108df3){const _0x5b4928=a43_0x57aad4,{orderId:_0x287ac1,name:_0x416b20,paymentDescription:_0x1953f3,amount:_0x1f58ba,currency:_0x181551,webhookUrl:_0xfc59ef,returnUrl:_0x5d21cc,expiryDate:_0x5d1bcf}=_0x108df3,_0x25462e=_0x181551['toUpperCase'](),_0x1babbc=_0x5b4928(0x181),_0x5c52cb=_0x5b4928(0x170)+_0x287ac1,_0x4e7f7d={'name':_0x416b20,'paymentDescription':_0x1953f3,'amount':_0x1f58ba,'currency':_0x25462e,'paymentId':_0x287ac1,'webhookUrl':_0x1babbc,'returnUrl':_0x5c52cb};_0x5d1bcf&&(_0x4e7f7d[_0x5b4928(0x19e)]=_0x5d1bcf);const _0x55c33b=Date[_0x5b4928(0x183)]();try{console['log'](_0x5b4928(0x1d4)),console[_0x5b4928(0x1db)](_0x5b4928(0x17f),this[_0x5b4928(0x1b9)]),console[_0x5b4928(0x1db)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x5b4928(0x169)](_0x4e7f7d,null,0x2)),console['log'](_0x5b4928(0x16e),_0x287ac1,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x5b4928(0x1db)](_0x5b4928(0x1ae),_0x5c52cb),loggerService_1[_0x5b4928(0x1b8)][_0x5b4928(0x1c0)](_0x5b4928(0x1aa),_0x5b4928(0x1dd),'POST',_0x4e7f7d);const _0x5b2cdc=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x5b4928(0x1cd)},'body':JSON[_0x5b4928(0x169)](_0x4e7f7d)}),_0x28a581=Date[_0x5b4928(0x183)]()-_0x55c33b;console[_0x5b4928(0x1db)](_0x5b4928(0x1a8)),console[_0x5b4928(0x1db)](_0x5b4928(0x1a3),_0x5b2cdc[_0x5b4928(0x1b4)]),console[_0x5b4928(0x1db)]('Status\x20Text:',_0x5b2cdc[_0x5b4928(0x177)]),console[_0x5b4928(0x1db)](_0x5b4928(0x16a),Object[_0x5b4928(0x1c2)](_0x5b2cdc[_0x5b4928(0x1ba)][_0x5b4928(0x1da)]())),console['log'](_0x5b4928(0x1bd),_0x28a581+'ms');const _0x402bf0=await _0x5b2cdc[_0x5b4928(0x199)]();console[_0x5b4928(0x1db)]('Raw\x20Response\x20Body:',_0x402bf0);if(!_0x5b2cdc['ok']){console[_0x5b4928(0x1bf)]('===\x20NODA\x20API\x20ERROR\x20==='),console['error'](_0x5b4928(0x19b),_0x5b2cdc[_0x5b4928(0x1b4)]),console[_0x5b4928(0x1bf)](_0x5b4928(0x180),_0x402bf0),loggerService_1[_0x5b4928(0x1b8)]['logWhiteDomainResponse']('noda',_0x5b4928(0x1dd),_0x5b2cdc[_0x5b4928(0x1b4)],_0x402bf0,_0x28a581),loggerService_1[_0x5b4928(0x1b8)][_0x5b4928(0x187)]('noda','/payment-links',_0x5b4928(0x189)+_0x5b2cdc[_0x5b4928(0x1b4)]+':\x20'+_0x402bf0);if(_0x5b2cdc[_0x5b4928(0x1b4)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x5b2cdc['status']===0x1f4)throw new Error(_0x5b4928(0x1d3));}throw new Error(_0x5b4928(0x19a)+_0x5b2cdc[_0x5b4928(0x1b4)]+_0x5b4928(0x190)+_0x402bf0);}let _0x21a968;try{_0x21a968=JSON[_0x5b4928(0x176)](_0x402bf0);}catch(_0x27ac22){console[_0x5b4928(0x1bf)](_0x5b4928(0x1ad),_0x27ac22),loggerService_1[_0x5b4928(0x1b8)]['logWhiteDomainError'](_0x5b4928(0x1aa),_0x5b4928(0x1dd),_0x5b4928(0x185)+_0x27ac22);throw new Error(_0x5b4928(0x1a9)+_0x402bf0);}console['log']('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console['log']('Parsed\x20Result:',JSON[_0x5b4928(0x169)](_0x21a968,null,0x2)),loggerService_1['loggerService'][_0x5b4928(0x172)](_0x5b4928(0x1aa),_0x5b4928(0x1dd),_0x5b2cdc[_0x5b4928(0x1b4)],_0x21a968,_0x28a581);if(_0x21a968[_0x5b4928(0x1bf)]||_0x21a968[_0x5b4928(0x197)]){const _0x2ceec3=_0x21a968[_0x5b4928(0x1d2)]||_0x21a968[_0x5b4928(0x1bf)]||_0x5b4928(0x17e);console[_0x5b4928(0x1bf)](_0x5b4928(0x16c)),console['error'](_0x5b4928(0x194),_0x2ceec3),console[_0x5b4928(0x1bf)]('Status\x20Code:',_0x21a968[_0x5b4928(0x197)]),loggerService_1[_0x5b4928(0x1b8)]['logWhiteDomainError'](_0x5b4928(0x1aa),_0x5b4928(0x1dd),_0x5b4928(0x1ca)+_0x2ceec3);throw new Error(_0x5b4928(0x1af)+_0x2ceec3);}if(!_0x21a968['id']||!_0x21a968[_0x5b4928(0x1b7)]?.[_0x5b4928(0x179)]){console['error'](_0x5b4928(0x1a6)),console[_0x5b4928(0x1bf)](_0x5b4928(0x1df)),console[_0x5b4928(0x1bf)](_0x5b4928(0x17b),_0x21a968),loggerService_1[_0x5b4928(0x1b8)]['logWhiteDomainError'](_0x5b4928(0x1aa),_0x5b4928(0x1dd),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x5b4928(0x1db)](_0x5b4928(0x191)),console[_0x5b4928(0x1db)]('Payment\x20Link\x20ID:',_0x21a968['id']),console[_0x5b4928(0x1db)](_0x5b4928(0x19d),_0x21a968[_0x5b4928(0x1b7)][_0x5b4928(0x179)]),console[_0x5b4928(0x1db)](_0x5b4928(0x186),_0x21a968[_0x5b4928(0x1b7)][_0x5b4928(0x18e)]||_0x5b4928(0x18a)),console[_0x5b4928(0x1db)](_0x5b4928(0x1b2),_0x287ac1,_0x5b4928(0x1be)),console[_0x5b4928(0x1db)](_0x5b4928(0x1b0),_0x5c52cb),{'gateway_payment_id':_0x21a968['id'],'payment_url':_0x21a968[_0x5b4928(0x1b7)][_0x5b4928(0x179)],'qr_code_url':_0x21a968['shortLinkUrls'][_0x5b4928(0x18e)],'expiry_date':_0x21a968[_0x5b4928(0x19e)]};}catch(_0x5f2862){console[_0x5b4928(0x1bf)](_0x5b4928(0x1a7)),console[_0x5b4928(0x1bf)](_0x5b4928(0x1a0),_0x5f2862),loggerService_1[_0x5b4928(0x1b8)][_0x5b4928(0x187)](_0x5b4928(0x1aa),'/payment-links',_0x5f2862);if(_0x5f2862 instanceof Error){console[_0x5b4928(0x1bf)](_0x5b4928(0x17d),_0x5f2862[_0x5b4928(0x1d2)]),console[_0x5b4928(0x1bf)](_0x5b4928(0x18d),_0x5f2862['stack']);throw new Error(_0x5b4928(0x198)+_0x5f2862[_0x5b4928(0x1d2)]);}throw new Error(_0x5b4928(0x16f));}}async[a43_0x57aad4(0x18f)](_0x206583){const _0x2dddfb=a43_0x57aad4,_0x2f38ce=Date['now']();try{loggerService_1[_0x2dddfb(0x1b8)][_0x2dddfb(0x1c0)]('noda','/payment-links/'+_0x206583,_0x2dddfb(0x188),{});const _0x415541=await fetch(this['apiUrl']+'/'+_0x206583,{'method':_0x2dddfb(0x188),'headers':{'Content-Type':_0x2dddfb(0x1c7),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x6d1158=Date[_0x2dddfb(0x183)]()-_0x2f38ce;if(!_0x415541['ok']){const _0x2b34ad=await _0x415541[_0x2dddfb(0x199)]();loggerService_1[_0x2dddfb(0x1b8)][_0x2dddfb(0x172)](_0x2dddfb(0x1aa),_0x2dddfb(0x196)+_0x206583,_0x415541[_0x2dddfb(0x1b4)],_0x2b34ad,_0x6d1158);throw new Error('HTTP\x20error!\x20status:\x20'+_0x415541[_0x2dddfb(0x1b4)]);}const _0xf68dc=await _0x415541['json']();loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0x2dddfb(0x196)+_0x206583,_0x415541[_0x2dddfb(0x1b4)],_0xf68dc,_0x6d1158);if(_0xf68dc['error']||_0xf68dc[_0x2dddfb(0x197)]){loggerService_1[_0x2dddfb(0x1b8)]['logWhiteDomainError'](_0x2dddfb(0x1aa),'/payment-links/'+_0x206583,_0x2dddfb(0x1af)+(_0xf68dc[_0x2dddfb(0x1d2)]||_0xf68dc['error']||_0x2dddfb(0x1d8)));throw new Error(_0x2dddfb(0x1af)+(_0xf68dc[_0x2dddfb(0x1d2)]||_0xf68dc['error']||'Unknown\x20error'));}let _0x1d9c8c=_0x2dddfb(0x1d1);if(_0xf68dc[_0x2dddfb(0x1dc)]===![]){if(_0xf68dc[_0x2dddfb(0x19e)]){const _0x263daf=new Date(_0xf68dc[_0x2dddfb(0x19e)]),_0x59170a=new Date();_0x263daf<_0x59170a?_0x1d9c8c='EXPIRED':_0x1d9c8c=_0x2dddfb(0x1ab);}else _0x1d9c8c=_0x2dddfb(0x1ab);}else _0x1d9c8c='PENDING';return{'status':_0x1d9c8c,'amount':_0xf68dc[_0x2dddfb(0x19c)],'currency':_0xf68dc[_0x2dddfb(0x1cb)],'isActive':_0xf68dc['isActive']};}catch(_0x4edbad){console['error'](_0x2dddfb(0x192),_0x4edbad),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x2dddfb(0x196)+_0x206583,_0x4edbad);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x4edbad instanceof Error?_0x4edbad['message']:_0x2dddfb(0x1d8)));}}async[a43_0x57aad4(0x1d5)](_0x417c8a){const _0x3b5d35=a43_0x57aad4;console[_0x3b5d35(0x1db)](_0x3b5d35(0x17c),_0x417c8a);let _0x405725=_0x3b5d35(0x1d1);switch(_0x417c8a['Status']?.['toLowerCase']()){case'done':case _0x3b5d35(0x1cf):case'paid':case'success':case _0x3b5d35(0x1b5):_0x417c8a['Settled']===_0x3b5d35(0x173)?_0x405725=_0x3b5d35(0x16d):_0x405725=_0x3b5d35(0x1d1);break;case _0x3b5d35(0x1de):case _0x3b5d35(0x18c):case _0x3b5d35(0x1b6):case _0x3b5d35(0x1bf):case _0x3b5d35(0x16b):_0x405725=_0x3b5d35(0x1ab);break;case _0x3b5d35(0x1ce):case'timeout':_0x405725='EXPIRED';break;case'pending':case _0x3b5d35(0x175):case _0x3b5d35(0x1d6):case'processing':case _0x3b5d35(0x1c4):default:_0x405725=_0x3b5d35(0x1d1);break;}return{'paymentId':_0x417c8a[_0x3b5d35(0x1d0)]||_0x417c8a['PaymentId'],'status':_0x405725,'amount':_0x417c8a['Amount'],'currency':_0x417c8a[_0x3b5d35(0x1ac)],'additionalInfo':{'method':_0x417c8a[_0x3b5d35(0x182)],'bankId':_0x417c8a[_0x3b5d35(0x178)],'settled':_0x417c8a[_0x3b5d35(0x1c8)],'settlementDate':_0x417c8a[_0x3b5d35(0x19f)],'remitterName':_0x417c8a['Remitter']?.[_0x3b5d35(0x1c9)],'remitterIban':_0x417c8a[_0x3b5d35(0x1b3)]?.[_0x3b5d35(0x193)],'bankTransactionId':_0x417c8a[_0x3b5d35(0x1c1)]}};}[a43_0x57aad4(0x1a1)](_0x41e47f,_0x482102){const _0x278dec=a43_0x57aad4;return console['log'](_0x278dec(0x195),{'receivedSignature':_0x482102,'paymentId':_0x41e47f['PaymentId'],'merchantPaymentId':_0x41e47f[_0x278dec(0x1d0)]}),!![];}}function a43_0x313b(_0x1cf766,_0x216495){const _0x2167a2=a43_0x2167();return a43_0x313b=function(_0x313bf3,_0x111277){_0x313bf3=_0x313bf3-0x169;let _0x53d4ff=_0x2167a2[_0x313bf3];return _0x53d4ff;},a43_0x313b(_0x1cf766,_0x216495);}exports[a43_0x57aad4(0x1d7)]=NodaService;