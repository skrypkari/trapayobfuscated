'use strict';function a40_0x5df6(_0x74f3f1,_0x100dc0){const _0x173a3c=a40_0x173a();return a40_0x5df6=function(_0x5df6f7,_0x3dc24e){_0x5df6f7=_0x5df6f7-0x151;let _0x3401ba=_0x173a3c[_0x5df6f7];return _0x3401ba;},a40_0x5df6(_0x74f3f1,_0x100dc0);}const a40_0x3e5c96=a40_0x5df6;(function(_0x59b0b5,_0x45be5d){const _0xa77bf5=a40_0x5df6,_0x4539c3=_0x59b0b5();while(!![]){try{const _0x2cae5c=parseInt(_0xa77bf5(0x1b7))/0x1+-parseInt(_0xa77bf5(0x194))/0x2+-parseInt(_0xa77bf5(0x174))/0x3*(-parseInt(_0xa77bf5(0x1a6))/0x4)+-parseInt(_0xa77bf5(0x158))/0x5+-parseInt(_0xa77bf5(0x1c2))/0x6+parseInt(_0xa77bf5(0x18b))/0x7*(parseInt(_0xa77bf5(0x1bd))/0x8)+parseInt(_0xa77bf5(0x170))/0x9;if(_0x2cae5c===_0x45be5d)break;else _0x4539c3['push'](_0x4539c3['shift']());}catch(_0x3db15b){_0x4539c3['push'](_0x4539c3['shift']());}}}(a40_0x173a,0xc5002));function a40_0x173a(){const _0x41bb1b=['successful','323897bvIRzY','Amount','amount',',\x20body:\x20','Noda\x20API\x20error:\x20','expired','Unknown\x20error','../loggerService','(8digits-8digits\x20format)','1212920oqIxLL','HTTP\x20Status:','statusCode','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Status:','Status','FAILED','fromEntries','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','https://tesoft.uk/gateway/success.php?id=','PAID','in_progress','failed','PENDING','Payment\x20Link\x20ID:','Parsed\x20Result:','https://tesoft.uk/gateway/noda/webhook/','4976oiATaK','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Error\x20details:','Order\x20ID\x20Used:','currency','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','shortLink','apiUrl','SettlementDate','createPaymentLink','shortLinkUrls','Name','parse','entries','json','toUpperCase','JSON\x20Parse\x20Error:\x20','225655ywWVYG','verifyPayment','noda','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','loggerService','GET','152wxTDhH','/payment-links','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainRequest','processing','6891756GmAmFn','===\x20NODA\x20SERVICE\x20ERROR\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','created','defineProperty','POST','Failed\x20to\x20parse\x20JSON\x20response:','now','Missing\x20id\x20or\x20shortLink\x20in\x20response','Settled','active','BankId','EXPIRED','7464510YizWCF','expiryDate','log','error','stringify','PaymentId','NodaService','timeout','status','Currency','message','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Status\x20Text:','Noda\x20webhook\x20signature\x20verification:','MerchantPaymentId','Iban','HTTP\x20','HTTP\x20error!\x20status:\x20','cancelled','===\x20NODA\x20SUCCESS\x20===','Short\x20Link:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Response\x20Body:','/payment-links/','17045478zHbmnD','Request\x20Body\x20(Direct\x20JSON):','processWebhook','headers','2547mnrPuw','isActive','statusText','completed','application/json','BankTransactionId','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Noda\x20payment\x20verification\x20error:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','logWhiteDomainResponse','paid','logWhiteDomainError','toLowerCase','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','stack','Unknown\x20error\x20from\x20Noda\x20API','qrCodeLink','Remitter','Yes','pending','Not\x20provided','Response\x20data:'];a40_0x173a=function(){return _0x41bb1b;};return a40_0x173a();}Object[a40_0x3e5c96(0x1c6)](exports,'__esModule',{'value':!![]}),exports[a40_0x3e5c96(0x15e)]=void 0x0;const loggerService_1=require(a40_0x3e5c96(0x192));class NodaService{constructor(){const _0x2d2cee=a40_0x3e5c96;this[_0x2d2cee(0x1ad)]='https://tesoft.uk/gateway/noda/',console[_0x2d2cee(0x15a)](_0x2d2cee(0x19d));}async[a40_0x3e5c96(0x1af)](_0x5e6bb2){const _0x2c05a8=a40_0x3e5c96,{orderId:_0x40e232,name:_0x32b0da,paymentDescription:_0x57cdd3,amount:_0xe33105,currency:_0x4791da,webhookUrl:_0x29299b,returnUrl:_0x2de6c9,expiryDate:_0x8203e2}=_0x5e6bb2,_0x5ba800=_0x4791da[_0x2c05a8(0x1b5)](),_0x50b3f0=_0x2c05a8(0x1a5),_0x472736=_0x2c05a8(0x19e)+_0x40e232,_0x374f5c={'name':_0x32b0da,'paymentDescription':_0x57cdd3,'amount':_0xe33105,'currency':_0x5ba800,'paymentId':_0x40e232,'webhookUrl':_0x50b3f0,'returnUrl':_0x472736};_0x8203e2&&(_0x374f5c[_0x2c05a8(0x159)]=_0x8203e2);const _0xa23e60=Date[_0x2c05a8(0x152)]();try{console[_0x2c05a8(0x15a)](_0x2c05a8(0x181)),console['log']('URL:',this[_0x2c05a8(0x1ad)]),console['log'](_0x2c05a8(0x171),JSON[_0x2c05a8(0x15c)](_0x374f5c,null,0x2)),console[_0x2c05a8(0x15a)]('Order\x20ID\x20Format:',_0x40e232,'(8digits-8digits\x20format\x20for\x20Noda)'),loggerService_1[_0x2c05a8(0x1bb)][_0x2c05a8(0x1c0)](_0x2c05a8(0x1b9),_0x2c05a8(0x1be),_0x2c05a8(0x1c7),_0x374f5c);const _0x1920d3=await fetch(this[_0x2c05a8(0x1ad)],{'method':_0x2c05a8(0x1c7),'headers':{'Content-Type':_0x2c05a8(0x178),'Accept':_0x2c05a8(0x178),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x2c05a8(0x15c)](_0x374f5c)}),_0x5b6ca1=Date[_0x2c05a8(0x152)]()-_0xa23e60;console['log'](_0x2c05a8(0x1bf)),console[_0x2c05a8(0x15a)](_0x2c05a8(0x199),_0x1920d3[_0x2c05a8(0x160)]),console['log'](_0x2c05a8(0x164),_0x1920d3[_0x2c05a8(0x176)]),console[_0x2c05a8(0x15a)]('Headers:',Object[_0x2c05a8(0x19c)](_0x1920d3[_0x2c05a8(0x173)][_0x2c05a8(0x1b3)]())),console['log']('Response\x20Time:',_0x5b6ca1+'ms');const _0x84da1c=await _0x1920d3['text']();console[_0x2c05a8(0x15a)]('Raw\x20Response\x20Body:',_0x84da1c);if(!_0x1920d3['ok']){console[_0x2c05a8(0x15b)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x2c05a8(0x15b)](_0x2c05a8(0x195),_0x1920d3[_0x2c05a8(0x160)]),console[_0x2c05a8(0x15b)](_0x2c05a8(0x16e),_0x84da1c),loggerService_1['loggerService'][_0x2c05a8(0x17d)]('noda',_0x2c05a8(0x1be),_0x1920d3[_0x2c05a8(0x160)],_0x84da1c,_0x5b6ca1),loggerService_1[_0x2c05a8(0x1bb)][_0x2c05a8(0x17f)](_0x2c05a8(0x1b9),'/payment-links',_0x2c05a8(0x168)+_0x1920d3['status']+':\x20'+_0x84da1c);if(_0x1920d3[_0x2c05a8(0x160)]===0x190)throw new Error(_0x2c05a8(0x163));else{if(_0x1920d3[_0x2c05a8(0x160)]===0x1f4)throw new Error(_0x2c05a8(0x17a));}throw new Error(_0x2c05a8(0x169)+_0x1920d3['status']+_0x2c05a8(0x18e)+_0x84da1c);}let _0x26174d;try{_0x26174d=JSON[_0x2c05a8(0x1b2)](_0x84da1c);}catch(_0x554f9d){console[_0x2c05a8(0x15b)](_0x2c05a8(0x151),_0x554f9d),loggerService_1[_0x2c05a8(0x1bb)]['logWhiteDomainError']('noda','/payment-links',_0x2c05a8(0x1b6)+_0x554f9d);throw new Error(_0x2c05a8(0x197)+_0x84da1c);}console[_0x2c05a8(0x15a)](_0x2c05a8(0x17c)),console['log'](_0x2c05a8(0x1a4),JSON[_0x2c05a8(0x15c)](_0x26174d,null,0x2)),loggerService_1[_0x2c05a8(0x1bb)][_0x2c05a8(0x17d)](_0x2c05a8(0x1b9),_0x2c05a8(0x1be),_0x1920d3[_0x2c05a8(0x160)],_0x26174d,_0x5b6ca1);if(_0x26174d[_0x2c05a8(0x15b)]||_0x26174d['statusCode']){const _0x25a56f=_0x26174d[_0x2c05a8(0x162)]||_0x26174d[_0x2c05a8(0x15b)]||_0x2c05a8(0x183);console[_0x2c05a8(0x15b)](_0x2c05a8(0x16d)),console[_0x2c05a8(0x15b)]('Error\x20Message:',_0x25a56f),console[_0x2c05a8(0x15b)]('Status\x20Code:',_0x26174d[_0x2c05a8(0x196)]),loggerService_1[_0x2c05a8(0x1bb)]['logWhiteDomainError']('noda',_0x2c05a8(0x1be),'Business\x20Error:\x20'+_0x25a56f);throw new Error(_0x2c05a8(0x18f)+_0x25a56f);}if(!_0x26174d['id']||!_0x26174d[_0x2c05a8(0x1b0)]?.[_0x2c05a8(0x1ac)]){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x2c05a8(0x153)),console[_0x2c05a8(0x15b)](_0x2c05a8(0x189),_0x26174d),loggerService_1['loggerService'][_0x2c05a8(0x17f)]('noda','/payment-links',_0x2c05a8(0x198));throw new Error(_0x2c05a8(0x1ab));}return console['log'](_0x2c05a8(0x16b)),console[_0x2c05a8(0x15a)](_0x2c05a8(0x1a3),_0x26174d['id']),console[_0x2c05a8(0x15a)](_0x2c05a8(0x16c),_0x26174d[_0x2c05a8(0x1b0)][_0x2c05a8(0x1ac)]),console[_0x2c05a8(0x15a)]('QR\x20Code\x20Link:',_0x26174d[_0x2c05a8(0x1b0)][_0x2c05a8(0x184)]||_0x2c05a8(0x188)),console[_0x2c05a8(0x15a)](_0x2c05a8(0x1a9),_0x40e232,_0x2c05a8(0x193)),{'gateway_payment_id':_0x26174d['id'],'payment_url':_0x26174d[_0x2c05a8(0x1b0)][_0x2c05a8(0x1ac)],'qr_code_url':_0x26174d[_0x2c05a8(0x1b0)][_0x2c05a8(0x184)],'expiry_date':_0x26174d[_0x2c05a8(0x159)]};}catch(_0x5dfee7){console[_0x2c05a8(0x15b)](_0x2c05a8(0x1c3)),console[_0x2c05a8(0x15b)](_0x2c05a8(0x1a8),_0x5dfee7),loggerService_1['loggerService'][_0x2c05a8(0x17f)](_0x2c05a8(0x1b9),_0x2c05a8(0x1be),_0x5dfee7);if(_0x5dfee7 instanceof Error){console[_0x2c05a8(0x15b)]('Error\x20message:',_0x5dfee7[_0x2c05a8(0x162)]),console[_0x2c05a8(0x15b)]('Error\x20stack:',_0x5dfee7[_0x2c05a8(0x182)]);throw new Error(_0x2c05a8(0x1ba)+_0x5dfee7[_0x2c05a8(0x162)]);}throw new Error(_0x2c05a8(0x1c4));}}async[a40_0x3e5c96(0x1b8)](_0x47001e){const _0x1e95f1=a40_0x3e5c96,_0x3e89e1=Date['now']();try{loggerService_1[_0x1e95f1(0x1bb)][_0x1e95f1(0x1c0)]('noda',_0x1e95f1(0x16f)+_0x47001e,'GET',{});const _0x1d1447=await fetch(this[_0x1e95f1(0x1ad)]+'/'+_0x47001e,{'method':_0x1e95f1(0x1bc),'headers':{'Content-Type':_0x1e95f1(0x178),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x4031f5=Date[_0x1e95f1(0x152)]()-_0x3e89e1;if(!_0x1d1447['ok']){const _0x93b30=await _0x1d1447['text']();loggerService_1[_0x1e95f1(0x1bb)][_0x1e95f1(0x17d)](_0x1e95f1(0x1b9),_0x1e95f1(0x16f)+_0x47001e,_0x1d1447['status'],_0x93b30,_0x4031f5);throw new Error(_0x1e95f1(0x169)+_0x1d1447['status']);}const _0x3f7dcb=await _0x1d1447[_0x1e95f1(0x1b4)]();loggerService_1[_0x1e95f1(0x1bb)][_0x1e95f1(0x17d)]('noda',_0x1e95f1(0x16f)+_0x47001e,_0x1d1447[_0x1e95f1(0x160)],_0x3f7dcb,_0x4031f5);if(_0x3f7dcb['error']||_0x3f7dcb[_0x1e95f1(0x196)]){loggerService_1[_0x1e95f1(0x1bb)]['logWhiteDomainError'](_0x1e95f1(0x1b9),_0x1e95f1(0x16f)+_0x47001e,_0x1e95f1(0x18f)+(_0x3f7dcb[_0x1e95f1(0x162)]||_0x3f7dcb[_0x1e95f1(0x15b)]||_0x1e95f1(0x191)));throw new Error(_0x1e95f1(0x18f)+(_0x3f7dcb[_0x1e95f1(0x162)]||_0x3f7dcb['error']||'Unknown\x20error'));}let _0x225832=_0x1e95f1(0x1a2);if(_0x3f7dcb['isActive']===![]){if(_0x3f7dcb[_0x1e95f1(0x159)]){const _0x5229ac=new Date(_0x3f7dcb[_0x1e95f1(0x159)]),_0x29931c=new Date();_0x5229ac<_0x29931c?_0x225832=_0x1e95f1(0x157):_0x225832=_0x1e95f1(0x19b);}else _0x225832=_0x1e95f1(0x19b);}else _0x225832=_0x1e95f1(0x1a2);return{'status':_0x225832,'amount':_0x3f7dcb[_0x1e95f1(0x18d)],'currency':_0x3f7dcb[_0x1e95f1(0x1aa)],'isActive':_0x3f7dcb[_0x1e95f1(0x175)]};}catch(_0x449d1b){console[_0x1e95f1(0x15b)](_0x1e95f1(0x17b),_0x449d1b),loggerService_1[_0x1e95f1(0x1bb)][_0x1e95f1(0x17f)](_0x1e95f1(0x1b9),_0x1e95f1(0x16f)+_0x47001e,_0x449d1b);throw new Error(_0x1e95f1(0x1a7)+(_0x449d1b instanceof Error?_0x449d1b[_0x1e95f1(0x162)]:_0x1e95f1(0x191)));}}async[a40_0x3e5c96(0x172)](_0x156411){const _0x541e03=a40_0x3e5c96;console[_0x541e03(0x15a)]('Processing\x20Noda\x20webhook:',_0x156411);let _0x21ca4e='PENDING';switch(_0x156411[_0x541e03(0x19a)]?.[_0x541e03(0x180)]()){case'done':case _0x541e03(0x177):case _0x541e03(0x17e):case'success':case _0x541e03(0x18a):_0x156411[_0x541e03(0x154)]===_0x541e03(0x186)?_0x21ca4e=_0x541e03(0x19f):_0x21ca4e=_0x541e03(0x1a2);break;case _0x541e03(0x16a):case'canceled':case _0x541e03(0x1a1):case _0x541e03(0x15b):case'rejected':_0x21ca4e=_0x541e03(0x19b);break;case _0x541e03(0x190):case _0x541e03(0x15f):_0x21ca4e=_0x541e03(0x157);break;case _0x541e03(0x187):case _0x541e03(0x1c5):case _0x541e03(0x155):case _0x541e03(0x1c1):case _0x541e03(0x1a0):default:_0x21ca4e=_0x541e03(0x1a2);break;}return{'paymentId':_0x156411[_0x541e03(0x166)]||_0x156411['PaymentId'],'status':_0x21ca4e,'amount':_0x156411[_0x541e03(0x18c)],'currency':_0x156411[_0x541e03(0x161)],'additionalInfo':{'method':_0x156411['Method'],'bankId':_0x156411[_0x541e03(0x156)],'settled':_0x156411['Settled'],'settlementDate':_0x156411[_0x541e03(0x1ae)],'remitterName':_0x156411[_0x541e03(0x185)]?.[_0x541e03(0x1b1)],'remitterIban':_0x156411['Remitter']?.[_0x541e03(0x167)],'bankTransactionId':_0x156411[_0x541e03(0x179)]}};}['verifyWebhookSignature'](_0x435e60,_0x2e4374){const _0x1795f0=a40_0x3e5c96;return console[_0x1795f0(0x15a)](_0x1795f0(0x165),{'receivedSignature':_0x2e4374,'paymentId':_0x435e60[_0x1795f0(0x15d)],'merchantPaymentId':_0x435e60[_0x1795f0(0x166)]}),!![];}}exports[a40_0x3e5c96(0x15e)]=NodaService;