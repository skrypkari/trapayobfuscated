'use strict';const a40_0x30dd94=a40_0x15c0;(function(_0x52f5a7,_0x2104a8){const _0x376d3e=a40_0x15c0,_0x4cda7d=_0x52f5a7();while(!![]){try{const _0xe31354=-parseInt(_0x376d3e(0x1bd))/0x1*(parseInt(_0x376d3e(0x1b5))/0x2)+-parseInt(_0x376d3e(0x1ca))/0x3*(parseInt(_0x376d3e(0x1e9))/0x4)+-parseInt(_0x376d3e(0x1d9))/0x5+-parseInt(_0x376d3e(0x199))/0x6+parseInt(_0x376d3e(0x1b7))/0x7+-parseInt(_0x376d3e(0x1e0))/0x8+parseInt(_0x376d3e(0x1ad))/0x9;if(_0xe31354===_0x2104a8)break;else _0x4cda7d['push'](_0x4cda7d['shift']());}catch(_0x5086c5){_0x4cda7d['push'](_0x4cda7d['shift']());}}}(a40_0x1b46,0x8f73d));function a40_0x15c0(_0x1817ed,_0x19d109){const _0x1b4674=a40_0x1b46();return a40_0x15c0=function(_0x15c0be,_0x2fccd1){_0x15c0be=_0x15c0be-0x189;let _0x1932e6=_0x1b4674[_0x15c0be];return _0x1932e6;},a40_0x15c0(_0x1817ed,_0x19d109);}Object[a40_0x30dd94(0x1f5)](exports,a40_0x30dd94(0x1d5),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a40_0x30dd94(0x1a8));function a40_0x1b46(){const _0x528acd=['NodaService','toUpperCase','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','GET','Noda\x20webhook\x20signature\x20verification:','verifyPayment','Raw\x20Response\x20Body:','Method','(8digits-8digits\x20format\x20for\x20Noda)','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','JSON\x20Parse\x20Error:\x20',',\x20body:\x20','../loggerService','parse','stringify','https://tesoft.uk/gateway/noda/webhook/','BankTransactionId','34658901NNQkvd','statusText','Remitter','failed','toLowerCase','Business\x20Error:\x20','EXPIRED','Response\x20Body:','379606bzgSeA','Unknown\x20error','3570700OLMhSg','Settled','verifyWebhookSignature','QR\x20Code\x20Link:','json','done','4aPTClH','message','Missing\x20id\x20or\x20shortLink\x20in\x20response','currency','https://tesoft.uk/gateway/success.php?id=','qrCodeLink','logWhiteDomainRequest','PaymentId','expiryDate','Status\x20Text:','now','cancelled','timeout','1067658vPyhng','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','HTTP\x20','statusCode','headers','/payment-links/','BankId','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','status','Unknown\x20error\x20from\x20Noda\x20API','createPaymentLink','__esModule','FAILED','Name','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','5071970mIFyYg','isActive','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Currency','Amount','rejected','Error\x20stack:','6383656mNpzMq','apiUrl','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Response\x20data:','===\x20NODA\x20SUCCESS\x20===','POST','in_progress','===\x20NODA\x20API\x20ERROR\x20===','application/json','8qKuNnF','fromEntries','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','logWhiteDomainResponse','HTTP\x20Status:','Noda\x20payment\x20verification\x20error:','shortLinkUrls','https://tesoft.uk/gateway/noda/','Noda\x20API\x20error:\x20','TesSoft\x20Payment\x20System/1.0','processing','logWhiteDomainError','defineProperty','loggerService','Status','MerchantPaymentId','PAID','noda','/payment-links','Yes','Parsed\x20Result:','Headers:','Status\x20Code:','text','HTTP\x20error!\x20status:\x20','Order\x20ID\x20Used:','URL:','processWebhook','Short\x20Link:','PENDING','Payment\x20Link\x20ID:','Failed\x20to\x20parse\x20JSON\x20response:','log','shortLink','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Request\x20Body\x20(Direct\x20JSON):','completed','error','===\x20PARSED\x20NODA\x20RESPONSE\x20===','2941038EJeptz','Error\x20details:','Order\x20ID\x20Format:'];a40_0x1b46=function(){return _0x528acd;};return a40_0x1b46();}class NodaService{constructor(){const _0x156d43=a40_0x30dd94;this[_0x156d43(0x1e1)]=_0x156d43(0x1f0),console[_0x156d43(0x192)](_0x156d43(0x1db));}async[a40_0x30dd94(0x1d4)](_0x37284d){const _0x372116=a40_0x30dd94,{orderId:_0x21b0b1,name:_0x2febd1,paymentDescription:_0x1e037c,amount:_0x4e757d,currency:_0x1b3132,webhookUrl:_0x10109c,returnUrl:_0x2a4629,expiryDate:_0x4c4acb}=_0x37284d,_0x130f86=_0x1b3132[_0x372116(0x19d)](),_0x13e73f=_0x372116(0x1ab),_0xbdec2f=_0x372116(0x1c1)+_0x21b0b1,_0x4059b2={'name':_0x2febd1,'paymentDescription':_0x1e037c,'amount':_0x4e757d,'currency':_0x130f86,'paymentId':_0x21b0b1,'webhookUrl':_0x13e73f,'returnUrl':_0xbdec2f};_0x4c4acb&&(_0x4059b2[_0x372116(0x1c5)]=_0x4c4acb);const _0x6bcd5f=Date[_0x372116(0x1c7)]();try{console['log'](_0x372116(0x19e)),console[_0x372116(0x192)](_0x372116(0x18c),this[_0x372116(0x1e1)]),console[_0x372116(0x192)](_0x372116(0x195),JSON[_0x372116(0x1aa)](_0x4059b2,null,0x2)),console[_0x372116(0x192)](_0x372116(0x19b),_0x21b0b1,_0x372116(0x1a4)),loggerService_1[_0x372116(0x1f6)][_0x372116(0x1c3)](_0x372116(0x1fa),_0x372116(0x1fb),_0x372116(0x1e5),_0x4059b2);const _0x5de787=await fetch(this[_0x372116(0x1e1)],{'method':_0x372116(0x1e5),'headers':{'Content-Type':_0x372116(0x1e8),'Accept':_0x372116(0x1e8),'User-Agent':_0x372116(0x1f2)},'body':JSON['stringify'](_0x4059b2)}),_0x58f840=Date[_0x372116(0x1c7)]()-_0x6bcd5f;console[_0x372116(0x192)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log']('Status:',_0x5de787[_0x372116(0x1d2)]),console['log'](_0x372116(0x1c6),_0x5de787[_0x372116(0x1ae)]),console[_0x372116(0x192)](_0x372116(0x1fe),Object[_0x372116(0x1ea)](_0x5de787[_0x372116(0x1ce)]['entries']())),console['log']('Response\x20Time:',_0x58f840+'ms');const _0x22e7cc=await _0x5de787['text']();console['log'](_0x372116(0x1a2),_0x22e7cc);if(!_0x5de787['ok']){console[_0x372116(0x197)](_0x372116(0x1e7)),console[_0x372116(0x197)](_0x372116(0x1ed),_0x5de787[_0x372116(0x1d2)]),console[_0x372116(0x197)](_0x372116(0x1b4),_0x22e7cc),loggerService_1[_0x372116(0x1f6)]['logWhiteDomainResponse']('noda',_0x372116(0x1fb),_0x5de787['status'],_0x22e7cc,_0x58f840),loggerService_1['loggerService'][_0x372116(0x1f4)](_0x372116(0x1fa),_0x372116(0x1fb),_0x372116(0x1cc)+_0x5de787[_0x372116(0x1d2)]+':\x20'+_0x22e7cc);if(_0x5de787[_0x372116(0x1d2)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x5de787[_0x372116(0x1d2)]===0x1f4)throw new Error(_0x372116(0x1d1));}throw new Error(_0x372116(0x18a)+_0x5de787[_0x372116(0x1d2)]+_0x372116(0x1a7)+_0x22e7cc);}let _0x10a5c2;try{_0x10a5c2=JSON[_0x372116(0x1a9)](_0x22e7cc);}catch(_0x3b1360){console[_0x372116(0x197)](_0x372116(0x191),_0x3b1360),loggerService_1[_0x372116(0x1f6)][_0x372116(0x1f4)]('noda',_0x372116(0x1fb),_0x372116(0x1a6)+_0x3b1360);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x22e7cc);}console[_0x372116(0x192)](_0x372116(0x198)),console[_0x372116(0x192)](_0x372116(0x1fd),JSON['stringify'](_0x10a5c2,null,0x2)),loggerService_1[_0x372116(0x1f6)][_0x372116(0x1ec)]('noda',_0x372116(0x1fb),_0x5de787[_0x372116(0x1d2)],_0x10a5c2,_0x58f840);if(_0x10a5c2[_0x372116(0x197)]||_0x10a5c2['statusCode']){const _0x1c08af=_0x10a5c2[_0x372116(0x1be)]||_0x10a5c2[_0x372116(0x197)]||_0x372116(0x1d3);console[_0x372116(0x197)](_0x372116(0x194)),console[_0x372116(0x197)]('Error\x20Message:',_0x1c08af),console[_0x372116(0x197)](_0x372116(0x1ff),_0x10a5c2[_0x372116(0x1cd)]),loggerService_1['loggerService'][_0x372116(0x1f4)](_0x372116(0x1fa),'/payment-links',_0x372116(0x1b2)+_0x1c08af);throw new Error('Noda\x20API\x20error:\x20'+_0x1c08af);}if(!_0x10a5c2['id']||!_0x10a5c2[_0x372116(0x1ef)]?.[_0x372116(0x193)]){console['error'](_0x372116(0x1a5)),console[_0x372116(0x197)](_0x372116(0x1bf)),console[_0x372116(0x197)](_0x372116(0x1e3),_0x10a5c2),loggerService_1[_0x372116(0x1f6)]['logWhiteDomainError']('noda',_0x372116(0x1fb),_0x372116(0x1e2));throw new Error(_0x372116(0x1d8));}return console[_0x372116(0x192)](_0x372116(0x1e4)),console['log'](_0x372116(0x190),_0x10a5c2['id']),console[_0x372116(0x192)](_0x372116(0x18e),_0x10a5c2[_0x372116(0x1ef)][_0x372116(0x193)]),console[_0x372116(0x192)](_0x372116(0x1ba),_0x10a5c2[_0x372116(0x1ef)][_0x372116(0x1c2)]||'Not\x20provided'),console[_0x372116(0x192)](_0x372116(0x18b),_0x21b0b1,'(8digits-8digits\x20format)'),{'gateway_payment_id':_0x10a5c2['id'],'payment_url':_0x10a5c2[_0x372116(0x1ef)][_0x372116(0x193)],'qr_code_url':_0x10a5c2[_0x372116(0x1ef)][_0x372116(0x1c2)],'expiry_date':_0x10a5c2[_0x372116(0x1c5)]};}catch(_0x4d1543){console[_0x372116(0x197)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x372116(0x197)](_0x372116(0x19a),_0x4d1543),loggerService_1['loggerService'][_0x372116(0x1f4)](_0x372116(0x1fa),_0x372116(0x1fb),_0x4d1543);if(_0x4d1543 instanceof Error){console[_0x372116(0x197)]('Error\x20message:',_0x4d1543[_0x372116(0x1be)]),console['error'](_0x372116(0x1df),_0x4d1543['stack']);throw new Error(_0x372116(0x1cb)+_0x4d1543[_0x372116(0x1be)]);}throw new Error(_0x372116(0x1eb));}}async[a40_0x30dd94(0x1a1)](_0x10d4b9){const _0x4f8bef=a40_0x30dd94,_0x93f34d=Date[_0x4f8bef(0x1c7)]();try{loggerService_1[_0x4f8bef(0x1f6)][_0x4f8bef(0x1c3)](_0x4f8bef(0x1fa),_0x4f8bef(0x1cf)+_0x10d4b9,_0x4f8bef(0x19f),{});const _0xf72202=await fetch(this[_0x4f8bef(0x1e1)]+'/'+_0x10d4b9,{'method':_0x4f8bef(0x19f),'headers':{'Content-Type':_0x4f8bef(0x1e8),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x2951a=Date[_0x4f8bef(0x1c7)]()-_0x93f34d;if(!_0xf72202['ok']){const _0x3698fe=await _0xf72202[_0x4f8bef(0x189)]();loggerService_1[_0x4f8bef(0x1f6)][_0x4f8bef(0x1ec)](_0x4f8bef(0x1fa),_0x4f8bef(0x1cf)+_0x10d4b9,_0xf72202['status'],_0x3698fe,_0x2951a);throw new Error(_0x4f8bef(0x18a)+_0xf72202['status']);}const _0x11ea38=await _0xf72202[_0x4f8bef(0x1bb)]();loggerService_1[_0x4f8bef(0x1f6)]['logWhiteDomainResponse'](_0x4f8bef(0x1fa),'/payment-links/'+_0x10d4b9,_0xf72202['status'],_0x11ea38,_0x2951a);if(_0x11ea38['error']||_0x11ea38['statusCode']){loggerService_1[_0x4f8bef(0x1f6)]['logWhiteDomainError'](_0x4f8bef(0x1fa),'/payment-links/'+_0x10d4b9,_0x4f8bef(0x1f1)+(_0x11ea38[_0x4f8bef(0x1be)]||_0x11ea38['error']||_0x4f8bef(0x1b6)));throw new Error(_0x4f8bef(0x1f1)+(_0x11ea38[_0x4f8bef(0x1be)]||_0x11ea38[_0x4f8bef(0x197)]||_0x4f8bef(0x1b6)));}let _0x4010cd=_0x4f8bef(0x18f);if(_0x11ea38[_0x4f8bef(0x1da)]===![]){if(_0x11ea38[_0x4f8bef(0x1c5)]){const _0x19ecbf=new Date(_0x11ea38['expiryDate']),_0x3fcca4=new Date();_0x19ecbf<_0x3fcca4?_0x4010cd=_0x4f8bef(0x1b3):_0x4010cd=_0x4f8bef(0x1d6);}else _0x4010cd=_0x4f8bef(0x1d6);}else _0x4010cd=_0x4f8bef(0x18f);return{'status':_0x4010cd,'amount':_0x11ea38['amount'],'currency':_0x11ea38[_0x4f8bef(0x1c0)],'isActive':_0x11ea38['isActive']};}catch(_0x33d3b6){console[_0x4f8bef(0x197)](_0x4f8bef(0x1ee),_0x33d3b6),loggerService_1['loggerService']['logWhiteDomainError'](_0x4f8bef(0x1fa),_0x4f8bef(0x1cf)+_0x10d4b9,_0x33d3b6);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x33d3b6 instanceof Error?_0x33d3b6[_0x4f8bef(0x1be)]:_0x4f8bef(0x1b6)));}}async[a40_0x30dd94(0x18d)](_0x4f97b7){const _0x15b7b4=a40_0x30dd94;console[_0x15b7b4(0x192)]('Processing\x20Noda\x20webhook:',_0x4f97b7);let _0xb91ecf=_0x15b7b4(0x18f);switch(_0x4f97b7[_0x15b7b4(0x1f7)]?.[_0x15b7b4(0x1b1)]()){case _0x15b7b4(0x1bc):case _0x15b7b4(0x196):case'paid':case'success':case'successful':_0x4f97b7['Settled']===_0x15b7b4(0x1fc)?_0xb91ecf=_0x15b7b4(0x1f9):_0xb91ecf=_0x15b7b4(0x18f);break;case _0x15b7b4(0x1c8):case'canceled':case _0x15b7b4(0x1b0):case _0x15b7b4(0x197):case _0x15b7b4(0x1de):_0xb91ecf=_0x15b7b4(0x1d6);break;case'expired':case _0x15b7b4(0x1c9):_0xb91ecf=_0x15b7b4(0x1b3);break;case'pending':case'created':case'active':case _0x15b7b4(0x1f3):case _0x15b7b4(0x1e6):default:_0xb91ecf=_0x15b7b4(0x18f);break;}return{'paymentId':_0x4f97b7[_0x15b7b4(0x1f8)]||_0x4f97b7[_0x15b7b4(0x1c4)],'status':_0xb91ecf,'amount':_0x4f97b7[_0x15b7b4(0x1dd)],'currency':_0x4f97b7[_0x15b7b4(0x1dc)],'additionalInfo':{'method':_0x4f97b7[_0x15b7b4(0x1a3)],'bankId':_0x4f97b7[_0x15b7b4(0x1d0)],'settled':_0x4f97b7[_0x15b7b4(0x1b8)],'settlementDate':_0x4f97b7['SettlementDate'],'remitterName':_0x4f97b7[_0x15b7b4(0x1af)]?.[_0x15b7b4(0x1d7)],'remitterIban':_0x4f97b7[_0x15b7b4(0x1af)]?.['Iban'],'bankTransactionId':_0x4f97b7[_0x15b7b4(0x1ac)]}};}[a40_0x30dd94(0x1b9)](_0x471fff,_0x348632){const _0x15e683=a40_0x30dd94;return console[_0x15e683(0x192)](_0x15e683(0x1a0),{'receivedSignature':_0x348632,'paymentId':_0x471fff[_0x15e683(0x1c4)],'merchantPaymentId':_0x471fff['MerchantPaymentId']}),!![];}}exports[a40_0x30dd94(0x19c)]=NodaService;