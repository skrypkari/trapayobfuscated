'use strict';const a48_0xeb8e41=a48_0x2422;(function(_0x3e4c3d,_0x51f176){const _0x3588f5=a48_0x2422,_0x5b06d2=_0x3e4c3d();while(!![]){try{const _0x5a5321=parseInt(_0x3588f5(0x152))/0x1*(-parseInt(_0x3588f5(0x179))/0x2)+-parseInt(_0x3588f5(0x122))/0x3+parseInt(_0x3588f5(0x17b))/0x4+parseInt(_0x3588f5(0x165))/0x5+-parseInt(_0x3588f5(0x128))/0x6*(parseInt(_0x3588f5(0x17a))/0x7)+parseInt(_0x3588f5(0x17f))/0x8*(parseInt(_0x3588f5(0x11c))/0x9)+-parseInt(_0x3588f5(0x166))/0xa*(parseInt(_0x3588f5(0x121))/0xb);if(_0x5a5321===_0x51f176)break;else _0x5b06d2['push'](_0x5b06d2['shift']());}catch(_0x3a5862){_0x5b06d2['push'](_0x5b06d2['shift']());}}}(a48_0x13ee,0xa7171));function a48_0x2422(_0x2e1b16,_0x215fc5){const _0x13ee75=a48_0x13ee();return a48_0x2422=function(_0x2422af,_0x438d3e){_0x2422af=_0x2422af-0x10d;let _0x4ec99b=_0x13ee75[_0x2422af];return _0x4ec99b;},a48_0x2422(_0x2e1b16,_0x215fc5);}Object[a48_0xeb8e41(0x178)](exports,'__esModule',{'value':!![]}),exports['NodaService']=void 0x0;function a48_0x13ee(){const _0x2e6822=['error','Failed\x20to\x20parse\x20JSON\x20response:','===\x20NODA\x20SERVICE\x20ERROR\x20===','NodaService','Currency','GET','failed','Not\x20provided','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','text','logWhiteDomainResponse','json','TesSoft\x20Payment\x20System/1.0','done','3265035QPyTXV','10oYTfJT','status','Remitter','fromEntries','URL:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','pending','Status\x20Code:','Error\x20details:','Iban','Noda\x20API\x20error:\x20','shortLink','EXPIRED','QR\x20Code\x20Link:','logWhiteDomainError','Missing\x20id\x20or\x20shortLink\x20in\x20response','Status\x20Text:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','defineProperty','11386kVWGFs','329GSLSSh','1852140UFkyqq','toUpperCase','Response\x20data:','in_progress','8539016qnJyWD','Response\x20Body:','Response\x20Time:','(8digits-8digits\x20format\x20for\x20Noda)','BankTransactionId','Method','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','loggerService','application/json','created','Request\x20Body\x20(Direct\x20JSON):','logWhiteDomainRequest','HTTP\x20','HTTP\x20error!\x20status:\x20','log','/payment-links','expiryDate','9QZPgwN','===\x20PARSED\x20NODA\x20RESPONSE\x20===','active','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Amount','4772713ilHxHP','2652501omBOXH','stringify','https://tesoft.uk/gateway/noda/','Short\x20Link:','Parsed\x20Result:','noda','20922WMfXYB','isActive','apiUrl','FAILED','Processing\x20Noda\x20webhook:','JSON\x20Parse\x20Error:\x20','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','MerchantPaymentId','Headers:','HTTP\x20Status:','paid',',\x20body:\x20','entries','completed','rejected','qrCodeLink','successful','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','now','Settled','Order\x20ID\x20Used:','parse','Error\x20message:','POST','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Failed\x20to\x20verify\x20Noda\x20payment:\x20','../loggerService','PENDING','/payment-links/','shortLinkUrls','success','Unknown\x20error','PaymentId','Name','message','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','amount','Status:','verifyWebhookSignature','https://tesoft.uk/gateway/pending.php?id=','statusCode','Payment\x20Link\x20ID:','3blJOQT','processing','stack','Raw\x20Response\x20Body:','Status'];a48_0x13ee=function(){return _0x2e6822;};return a48_0x13ee();}const loggerService_1=require(a48_0xeb8e41(0x142));class NodaService{constructor(){const _0x171bc5=a48_0xeb8e41;this['apiUrl']=_0x171bc5(0x124),console[_0x171bc5(0x119)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async['createPaymentLink'](_0x249e0d){const _0x3d55cd=a48_0xeb8e41,{orderId:_0x1cbc82,name:_0x3a9a60,paymentDescription:_0x1ba688,amount:_0x418cba,currency:_0x1f6a5c,webhookUrl:_0x537d67,returnUrl:_0x18a9c5,expiryDate:_0x223d51}=_0x249e0d,_0x1a1c80=_0x1f6a5c[_0x3d55cd(0x17c)](),_0x26a7e6='https://tesoft.uk/gateway/noda/webhook/',_0x12220e=_0x3d55cd(0x14f)+_0x1cbc82,_0x5460fa={'name':_0x3a9a60,'paymentDescription':_0x1ba688,'amount':_0x418cba,'currency':_0x1a1c80,'paymentId':_0x1cbc82,'webhookUrl':_0x26a7e6,'returnUrl':_0x12220e};_0x223d51&&(_0x5460fa[_0x3d55cd(0x11b)]=_0x223d51);const _0x433496=Date[_0x3d55cd(0x13a)]();try{console[_0x3d55cd(0x119)](_0x3d55cd(0x16b)),console['log'](_0x3d55cd(0x16a),this[_0x3d55cd(0x12a)]),console[_0x3d55cd(0x119)](_0x3d55cd(0x115),JSON[_0x3d55cd(0x123)](_0x5460fa,null,0x2)),console[_0x3d55cd(0x119)]('Order\x20ID\x20Format:',_0x1cbc82,_0x3d55cd(0x10e)),console[_0x3d55cd(0x119)](_0x3d55cd(0x177),_0x12220e),loggerService_1[_0x3d55cd(0x112)][_0x3d55cd(0x116)](_0x3d55cd(0x127),_0x3d55cd(0x11a),_0x3d55cd(0x13f),_0x5460fa);const _0x49c78a=await fetch(this[_0x3d55cd(0x12a)],{'method':_0x3d55cd(0x13f),'headers':{'Content-Type':_0x3d55cd(0x113),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x3d55cd(0x123)](_0x5460fa)}),_0x1fbe39=Date['now']()-_0x433496;console[_0x3d55cd(0x119)](_0x3d55cd(0x111)),console[_0x3d55cd(0x119)](_0x3d55cd(0x14d),_0x49c78a[_0x3d55cd(0x167)]),console[_0x3d55cd(0x119)](_0x3d55cd(0x176),_0x49c78a['statusText']),console[_0x3d55cd(0x119)](_0x3d55cd(0x130),Object[_0x3d55cd(0x169)](_0x49c78a['headers'][_0x3d55cd(0x134)]())),console['log'](_0x3d55cd(0x10d),_0x1fbe39+'ms');const _0x7a7442=await _0x49c78a[_0x3d55cd(0x160)]();console[_0x3d55cd(0x119)](_0x3d55cd(0x155),_0x7a7442);if(!_0x49c78a['ok']){console[_0x3d55cd(0x157)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x3d55cd(0x157)](_0x3d55cd(0x131),_0x49c78a[_0x3d55cd(0x167)]),console[_0x3d55cd(0x157)](_0x3d55cd(0x180),_0x7a7442),loggerService_1[_0x3d55cd(0x112)][_0x3d55cd(0x161)](_0x3d55cd(0x127),_0x3d55cd(0x11a),_0x49c78a[_0x3d55cd(0x167)],_0x7a7442,_0x1fbe39),loggerService_1['loggerService'][_0x3d55cd(0x174)]('noda',_0x3d55cd(0x11a),_0x3d55cd(0x117)+_0x49c78a[_0x3d55cd(0x167)]+':\x20'+_0x7a7442);if(_0x49c78a['status']===0x190)throw new Error(_0x3d55cd(0x15f));else{if(_0x49c78a['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x3d55cd(0x118)+_0x49c78a[_0x3d55cd(0x167)]+_0x3d55cd(0x133)+_0x7a7442);}let _0x496412;try{_0x496412=JSON[_0x3d55cd(0x13d)](_0x7a7442);}catch(_0x259525){console[_0x3d55cd(0x157)](_0x3d55cd(0x158),_0x259525),loggerService_1['loggerService'][_0x3d55cd(0x174)]('noda','/payment-links',_0x3d55cd(0x12d)+_0x259525);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x7a7442);}console['log'](_0x3d55cd(0x11d)),console[_0x3d55cd(0x119)](_0x3d55cd(0x126),JSON[_0x3d55cd(0x123)](_0x496412,null,0x2)),loggerService_1['loggerService'][_0x3d55cd(0x161)](_0x3d55cd(0x127),_0x3d55cd(0x11a),_0x49c78a[_0x3d55cd(0x167)],_0x496412,_0x1fbe39);if(_0x496412['error']||_0x496412[_0x3d55cd(0x150)]){const _0x796815=_0x496412['message']||_0x496412[_0x3d55cd(0x157)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x3d55cd(0x157)](_0x3d55cd(0x14b)),console[_0x3d55cd(0x157)]('Error\x20Message:',_0x796815),console[_0x3d55cd(0x157)](_0x3d55cd(0x16d),_0x496412['statusCode']),loggerService_1[_0x3d55cd(0x112)]['logWhiteDomainError'](_0x3d55cd(0x127),'/payment-links','Business\x20Error:\x20'+_0x796815);throw new Error(_0x3d55cd(0x170)+_0x796815);}if(!_0x496412['id']||!_0x496412[_0x3d55cd(0x145)]?.[_0x3d55cd(0x171)]){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3d55cd(0x157)](_0x3d55cd(0x175)),console['error'](_0x3d55cd(0x17d),_0x496412),loggerService_1[_0x3d55cd(0x112)]['logWhiteDomainError'](_0x3d55cd(0x127),'/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x3d55cd(0x12e));}return console[_0x3d55cd(0x119)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x3d55cd(0x119)](_0x3d55cd(0x151),_0x496412['id']),console[_0x3d55cd(0x119)](_0x3d55cd(0x125),_0x496412[_0x3d55cd(0x145)][_0x3d55cd(0x171)]),console[_0x3d55cd(0x119)](_0x3d55cd(0x173),_0x496412[_0x3d55cd(0x145)][_0x3d55cd(0x137)]||_0x3d55cd(0x15e)),console[_0x3d55cd(0x119)](_0x3d55cd(0x13c),_0x1cbc82,'(8digits-8digits\x20format)'),console['log'](_0x3d55cd(0x11f),_0x12220e),{'gateway_payment_id':_0x496412['id'],'payment_url':_0x496412[_0x3d55cd(0x145)][_0x3d55cd(0x171)],'qr_code_url':_0x496412[_0x3d55cd(0x145)]['qrCodeLink'],'expiry_date':_0x496412[_0x3d55cd(0x11b)]};}catch(_0x390167){console[_0x3d55cd(0x157)](_0x3d55cd(0x159)),console[_0x3d55cd(0x157)](_0x3d55cd(0x16e),_0x390167),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x3d55cd(0x11a),_0x390167);if(_0x390167 instanceof Error){console['error'](_0x3d55cd(0x13e),_0x390167[_0x3d55cd(0x14a)]),console[_0x3d55cd(0x157)]('Error\x20stack:',_0x390167[_0x3d55cd(0x154)]);throw new Error(_0x3d55cd(0x139)+_0x390167[_0x3d55cd(0x14a)]);}throw new Error(_0x3d55cd(0x140));}}async['verifyPayment'](_0xd61af5){const _0x9f42ca=a48_0xeb8e41,_0x4a35f1=Date[_0x9f42ca(0x13a)]();try{loggerService_1[_0x9f42ca(0x112)][_0x9f42ca(0x116)](_0x9f42ca(0x127),_0x9f42ca(0x144)+_0xd61af5,_0x9f42ca(0x15c),{});const _0x8e0e5e=await fetch(this['apiUrl']+'/'+_0xd61af5,{'method':_0x9f42ca(0x15c),'headers':{'Content-Type':'application/json','User-Agent':_0x9f42ca(0x163)}}),_0x7d4d2f=Date[_0x9f42ca(0x13a)]()-_0x4a35f1;if(!_0x8e0e5e['ok']){const _0x41d487=await _0x8e0e5e[_0x9f42ca(0x160)]();loggerService_1[_0x9f42ca(0x112)][_0x9f42ca(0x161)](_0x9f42ca(0x127),'/payment-links/'+_0xd61af5,_0x8e0e5e[_0x9f42ca(0x167)],_0x41d487,_0x7d4d2f);throw new Error(_0x9f42ca(0x118)+_0x8e0e5e[_0x9f42ca(0x167)]);}const _0x1316dd=await _0x8e0e5e[_0x9f42ca(0x162)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x9f42ca(0x127),_0x9f42ca(0x144)+_0xd61af5,_0x8e0e5e[_0x9f42ca(0x167)],_0x1316dd,_0x7d4d2f);if(_0x1316dd['error']||_0x1316dd[_0x9f42ca(0x150)]){loggerService_1[_0x9f42ca(0x112)]['logWhiteDomainError'](_0x9f42ca(0x127),'/payment-links/'+_0xd61af5,'Noda\x20API\x20error:\x20'+(_0x1316dd[_0x9f42ca(0x14a)]||_0x1316dd[_0x9f42ca(0x157)]||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x1316dd['message']||_0x1316dd[_0x9f42ca(0x157)]||_0x9f42ca(0x147)));}let _0x2a913e=_0x9f42ca(0x143);if(_0x1316dd[_0x9f42ca(0x129)]===![]){if(_0x1316dd[_0x9f42ca(0x11b)]){const _0x4eed62=new Date(_0x1316dd['expiryDate']),_0x2b1edb=new Date();_0x4eed62<_0x2b1edb?_0x2a913e=_0x9f42ca(0x172):_0x2a913e='FAILED';}else _0x2a913e='FAILED';}else _0x2a913e=_0x9f42ca(0x143);return{'status':_0x2a913e,'amount':_0x1316dd[_0x9f42ca(0x14c)],'currency':_0x1316dd['currency'],'isActive':_0x1316dd[_0x9f42ca(0x129)]};}catch(_0xa6b447){console[_0x9f42ca(0x157)]('Noda\x20payment\x20verification\x20error:',_0xa6b447),loggerService_1[_0x9f42ca(0x112)][_0x9f42ca(0x174)](_0x9f42ca(0x127),_0x9f42ca(0x144)+_0xd61af5,_0xa6b447);throw new Error(_0x9f42ca(0x141)+(_0xa6b447 instanceof Error?_0xa6b447[_0x9f42ca(0x14a)]:_0x9f42ca(0x147)));}}async['processWebhook'](_0x23bb97){const _0x468d5f=a48_0xeb8e41;console[_0x468d5f(0x119)](_0x468d5f(0x12c),_0x23bb97);let _0x5adffe=_0x468d5f(0x143);switch(_0x23bb97[_0x468d5f(0x156)]?.['toLowerCase']()){case _0x468d5f(0x164):case _0x468d5f(0x135):case _0x468d5f(0x132):case _0x468d5f(0x146):case _0x468d5f(0x138):_0x23bb97[_0x468d5f(0x13b)]==='Yes'?_0x5adffe='PAID':_0x5adffe=_0x468d5f(0x143);break;case'cancelled':case'canceled':case _0x468d5f(0x15d):case _0x468d5f(0x157):case _0x468d5f(0x136):_0x5adffe=_0x468d5f(0x12b);break;case'expired':case'timeout':_0x5adffe=_0x468d5f(0x172);break;case _0x468d5f(0x16c):case _0x468d5f(0x114):case _0x468d5f(0x11e):case _0x468d5f(0x153):case _0x468d5f(0x17e):default:_0x5adffe=_0x468d5f(0x143);break;}return{'paymentId':_0x23bb97[_0x468d5f(0x12f)]||_0x23bb97[_0x468d5f(0x148)],'status':_0x5adffe,'amount':_0x23bb97[_0x468d5f(0x120)],'currency':_0x23bb97[_0x468d5f(0x15b)],'additionalInfo':{'method':_0x23bb97[_0x468d5f(0x110)],'bankId':_0x23bb97['BankId'],'settled':_0x23bb97[_0x468d5f(0x13b)],'settlementDate':_0x23bb97['SettlementDate'],'remitterName':_0x23bb97[_0x468d5f(0x168)]?.[_0x468d5f(0x149)],'remitterIban':_0x23bb97['Remitter']?.[_0x468d5f(0x16f)],'bankTransactionId':_0x23bb97[_0x468d5f(0x10f)]}};}[a48_0xeb8e41(0x14e)](_0x33836a,_0x5bd85a){const _0x1d7173=a48_0xeb8e41;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x5bd85a,'paymentId':_0x33836a['PaymentId'],'merchantPaymentId':_0x33836a[_0x1d7173(0x12f)]}),!![];}}exports[a48_0xeb8e41(0x15a)]=NodaService;