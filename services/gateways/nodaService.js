'use strict';const a44_0x2a12ac=a44_0x2d3d;function a44_0x15b2(){const _0x3eb114=['One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','noda','fromEntries','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Failed\x20to\x20verify\x20Noda\x20payment:\x20','NodaService','774396eommtP','../loggerService','shortLink','Failed\x20to\x20parse\x20JSON\x20response:','325330fJGWnT','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','18yvvWVv','Noda\x20webhook\x20signature\x20verification:','(8digits-8digits\x20format)','processWebhook','cancelled','Order\x20ID\x20Used:','===\x20NODA\x20SUCCESS\x20===','logWhiteDomainError','/payment-links','statusCode','GET','Status\x20Text:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Name','Iban','error','expiryDate','Error\x20stack:','FAILED','statusText','defineProperty','message','Unknown\x20error','Noda\x20payment\x20verification\x20error:','102YHRADP','PaymentId','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','SettlementDate','Raw\x20Response\x20Body:','pending','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','failed','Method','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','EXPIRED','Status','apiUrl','65zxrNQS','Settled','Noda\x20API\x20error:\x20','log',',\x20body:\x20','qrCodeLink','Remitter','Status:','createPaymentLink','JSON\x20Parse\x20Error:\x20','paid','16skjosL','629604BEelPG','text','BankId','TesSoft\x20Payment\x20System/1.0','now','in_progress','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','parse','currency','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','logWhiteDomainRequest','Yes','active','processing','HTTP\x20error!\x20status:\x20','https://tesoft.uk/gateway/noda/','77nrhgwo','===\x20NODA\x20API\x20ERROR\x20===','json','Response\x20Time:','Processing\x20Noda\x20webhook:','successful','verifyPayment','Error\x20message:','POST','verifyWebhookSignature','831672SVdGMM','stack','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20Message:','Order\x20ID\x20Format:','shortLinkUrls','Currency','application/json','(8digits-8digits\x20format\x20for\x20Noda)','entries','Error\x20details:','Parsed\x20Result:','Response\x20data:','amount','status','toLowerCase','Missing\x20id\x20or\x20shortLink\x20in\x20response','completed','93284DdWTjs','loggerService','Short\x20Link:','PENDING','PAID','===\x20NODA\x20SERVICE\x20ERROR\x20===','stringify','4538bkDIEL','expired','/payment-links/','QR\x20Code\x20Link:','Request\x20Body\x20(Direct\x20JSON):','__esModule','logWhiteDomainResponse','654890ehsseW','HTTP\x20','rejected','isActive','Amount','headers','Payment\x20Link\x20ID:'];a44_0x15b2=function(){return _0x3eb114;};return a44_0x15b2();}(function(_0x4ad6aa,_0x5801f7){const _0x275266=a44_0x2d3d,_0x4a742c=_0x4ad6aa();while(!![]){try{const _0x41f442=-parseInt(_0x275266(0x9c))/0x1+-parseInt(_0x275266(0x84))/0x2*(parseInt(_0x275266(0xb6))/0x3)+parseInt(_0x275266(0x7d))/0x4*(-parseInt(_0x275266(0xc5))/0x5)+-parseInt(_0x275266(0x9e))/0x6*(-parseInt(_0x275266(0x98))/0x7)+parseInt(_0x275266(0xd0))/0x8*(parseInt(_0x275266(0xeb))/0x9)+parseInt(_0x275266(0x8b))/0xa*(parseInt(_0x275266(0xe1))/0xb)+parseInt(_0x275266(0xd1))/0xc;if(_0x41f442===_0x5801f7)break;else _0x4a742c['push'](_0x4a742c['shift']());}catch(_0x33320f){_0x4a742c['push'](_0x4a742c['shift']());}}}(a44_0x15b2,0x4e995));function a44_0x2d3d(_0x2e0061,_0x221e23){const _0x15b2fa=a44_0x15b2();return a44_0x2d3d=function(_0x2d3da2,_0x3a0f05){_0x2d3da2=_0x2d3da2-0x7b;let _0x556313=_0x15b2fa[_0x2d3da2];return _0x556313;},a44_0x2d3d(_0x2e0061,_0x221e23);}Object[a44_0x2a12ac(0xb2)](exports,a44_0x2a12ac(0x89),{'value':!![]}),exports[a44_0x2a12ac(0x97)]=void 0x0;const loggerService_1=require(a44_0x2a12ac(0x99));class NodaService{constructor(){const _0x2104e8=a44_0x2a12ac;this['apiUrl']=_0x2104e8(0xe0),console[_0x2104e8(0xc8)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a44_0x2a12ac(0xcd)](_0x17de42){const _0x20be4c=a44_0x2a12ac,{orderId:_0x51fc8d,name:_0x4c10e9,paymentDescription:_0x38afef,amount:_0x37cbf2,currency:_0x24aeb3,webhookUrl:_0x3bd4d1,returnUrl:_0xfc5323,expiryDate:_0x128246}=_0x17de42,_0xd5dbc3=_0x24aeb3['toUpperCase'](),_0x4e7f81='https://tesoft.uk/gateway/noda/webhook/',_0x39f294='https://tesoft.uk/gateway/pending.php?id='+_0x51fc8d,_0x3fc4cc={'name':_0x4c10e9,'paymentDescription':_0x38afef,'amount':_0x37cbf2,'currency':_0xd5dbc3,'paymentId':_0x51fc8d,'webhookUrl':_0x4e7f81,'returnUrl':_0x39f294};_0x128246&&(_0x3fc4cc[_0x20be4c(0xae)]=_0x128246);const _0x315336=Date['now']();try{console[_0x20be4c(0xc8)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x20be4c(0xc8)]('URL:',this[_0x20be4c(0xc4)]),console['log'](_0x20be4c(0x88),JSON[_0x20be4c(0x83)](_0x3fc4cc,null,0x2)),console[_0x20be4c(0xc8)](_0x20be4c(0xef),_0x51fc8d,_0x20be4c(0xf3)),console[_0x20be4c(0xc8)](_0x20be4c(0xbd),_0x39f294),loggerService_1['loggerService'][_0x20be4c(0xdb)](_0x20be4c(0x93),_0x20be4c(0xa6),_0x20be4c(0xe9),_0x3fc4cc);const _0x5898db=await fetch(this[_0x20be4c(0xc4)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x20be4c(0xf2),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x3fc4cc)}),_0xa931fb=Date[_0x20be4c(0xd5)]()-_0x315336;console[_0x20be4c(0xc8)](_0x20be4c(0xb8)),console['log'](_0x20be4c(0xcc),_0x5898db[_0x20be4c(0xf9)]),console[_0x20be4c(0xc8)](_0x20be4c(0xa9),_0x5898db[_0x20be4c(0xb1)]),console[_0x20be4c(0xc8)]('Headers:',Object[_0x20be4c(0x94)](_0x5898db[_0x20be4c(0x90)][_0x20be4c(0xf4)]())),console[_0x20be4c(0xc8)](_0x20be4c(0xe4),_0xa931fb+'ms');const _0x4f1f60=await _0x5898db[_0x20be4c(0xd2)]();console[_0x20be4c(0xc8)](_0x20be4c(0xba),_0x4f1f60);if(!_0x5898db['ok']){console['error'](_0x20be4c(0xe2)),console[_0x20be4c(0xad)]('HTTP\x20Status:',_0x5898db[_0x20be4c(0xf9)]),console[_0x20be4c(0xad)]('Response\x20Body:',_0x4f1f60),loggerService_1[_0x20be4c(0x7e)][_0x20be4c(0x8a)](_0x20be4c(0x93),_0x20be4c(0xa6),_0x5898db[_0x20be4c(0xf9)],_0x4f1f60,_0xa931fb),loggerService_1['loggerService'][_0x20be4c(0xa5)]('noda',_0x20be4c(0xa6),_0x20be4c(0x8c)+_0x5898db[_0x20be4c(0xf9)]+':\x20'+_0x4f1f60);if(_0x5898db[_0x20be4c(0xf9)]===0x190)throw new Error(_0x20be4c(0x92));else{if(_0x5898db[_0x20be4c(0xf9)]===0x1f4)throw new Error(_0x20be4c(0x9d));}throw new Error(_0x20be4c(0xdf)+_0x5898db[_0x20be4c(0xf9)]+_0x20be4c(0xc9)+_0x4f1f60);}let _0x52f385;try{_0x52f385=JSON[_0x20be4c(0xd8)](_0x4f1f60);}catch(_0x1d4ffd){console[_0x20be4c(0xad)](_0x20be4c(0x9b),_0x1d4ffd),loggerService_1[_0x20be4c(0x7e)][_0x20be4c(0xa5)]('noda',_0x20be4c(0xa6),_0x20be4c(0xce)+_0x1d4ffd);throw new Error(_0x20be4c(0x95)+_0x4f1f60);}console[_0x20be4c(0xc8)](_0x20be4c(0xc0)),console[_0x20be4c(0xc8)](_0x20be4c(0xf6),JSON[_0x20be4c(0x83)](_0x52f385,null,0x2)),loggerService_1[_0x20be4c(0x7e)][_0x20be4c(0x8a)](_0x20be4c(0x93),'/payment-links',_0x5898db[_0x20be4c(0xf9)],_0x52f385,_0xa931fb);if(_0x52f385['error']||_0x52f385[_0x20be4c(0xa7)]){const _0x52dc01=_0x52f385[_0x20be4c(0xb3)]||_0x52f385[_0x20be4c(0xad)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x20be4c(0xad)](_0x20be4c(0xaa)),console[_0x20be4c(0xad)](_0x20be4c(0xee),_0x52dc01),console[_0x20be4c(0xad)]('Status\x20Code:',_0x52f385[_0x20be4c(0xa7)]),loggerService_1[_0x20be4c(0x7e)]['logWhiteDomainError']('noda',_0x20be4c(0xa6),'Business\x20Error:\x20'+_0x52dc01);throw new Error(_0x20be4c(0xc7)+_0x52dc01);}if(!_0x52f385['id']||!_0x52f385[_0x20be4c(0xf0)]?.[_0x20be4c(0x9a)]){console[_0x20be4c(0xad)](_0x20be4c(0xed)),console[_0x20be4c(0xad)](_0x20be4c(0x7b)),console['error'](_0x20be4c(0xf7),_0x52f385),loggerService_1['loggerService'][_0x20be4c(0xa5)]('noda',_0x20be4c(0xa6),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x20be4c(0xc1));}return console['log'](_0x20be4c(0xa4)),console[_0x20be4c(0xc8)](_0x20be4c(0x91),_0x52f385['id']),console[_0x20be4c(0xc8)](_0x20be4c(0x7f),_0x52f385[_0x20be4c(0xf0)][_0x20be4c(0x9a)]),console[_0x20be4c(0xc8)](_0x20be4c(0x87),_0x52f385['shortLinkUrls'][_0x20be4c(0xca)]||'Not\x20provided'),console[_0x20be4c(0xc8)](_0x20be4c(0xa3),_0x51fc8d,_0x20be4c(0xa0)),console[_0x20be4c(0xc8)](_0x20be4c(0xbc),_0x39f294),{'gateway_payment_id':_0x52f385['id'],'payment_url':_0x52f385[_0x20be4c(0xf0)]['shortLink'],'qr_code_url':_0x52f385[_0x20be4c(0xf0)]['qrCodeLink'],'expiry_date':_0x52f385['expiryDate']};}catch(_0x39fc0e){console[_0x20be4c(0xad)](_0x20be4c(0x82)),console['error'](_0x20be4c(0xf5),_0x39fc0e),loggerService_1['loggerService'][_0x20be4c(0xa5)]('noda',_0x20be4c(0xa6),_0x39fc0e);if(_0x39fc0e instanceof Error){console[_0x20be4c(0xad)](_0x20be4c(0xe8),_0x39fc0e[_0x20be4c(0xb3)]),console['error'](_0x20be4c(0xaf),_0x39fc0e[_0x20be4c(0xec)]);throw new Error(_0x20be4c(0xd7)+_0x39fc0e[_0x20be4c(0xb3)]);}throw new Error(_0x20be4c(0xda));}}async[a44_0x2a12ac(0xe7)](_0x30218f){const _0x34675c=a44_0x2a12ac,_0x574f20=Date[_0x34675c(0xd5)]();try{loggerService_1[_0x34675c(0x7e)][_0x34675c(0xdb)](_0x34675c(0x93),_0x34675c(0x86)+_0x30218f,_0x34675c(0xa8),{});const _0x1f4214=await fetch(this[_0x34675c(0xc4)]+'/'+_0x30218f,{'method':_0x34675c(0xa8),'headers':{'Content-Type':_0x34675c(0xf2),'User-Agent':_0x34675c(0xd4)}}),_0x221061=Date[_0x34675c(0xd5)]()-_0x574f20;if(!_0x1f4214['ok']){const _0x4703a3=await _0x1f4214[_0x34675c(0xd2)]();loggerService_1[_0x34675c(0x7e)][_0x34675c(0x8a)](_0x34675c(0x93),'/payment-links/'+_0x30218f,_0x1f4214[_0x34675c(0xf9)],_0x4703a3,_0x221061);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1f4214[_0x34675c(0xf9)]);}const _0x4675b9=await _0x1f4214[_0x34675c(0xe3)]();loggerService_1[_0x34675c(0x7e)]['logWhiteDomainResponse'](_0x34675c(0x93),_0x34675c(0x86)+_0x30218f,_0x1f4214[_0x34675c(0xf9)],_0x4675b9,_0x221061);if(_0x4675b9['error']||_0x4675b9[_0x34675c(0xa7)]){loggerService_1[_0x34675c(0x7e)][_0x34675c(0xa5)]('noda',_0x34675c(0x86)+_0x30218f,_0x34675c(0xc7)+(_0x4675b9[_0x34675c(0xb3)]||_0x4675b9[_0x34675c(0xad)]||_0x34675c(0xb4)));throw new Error(_0x34675c(0xc7)+(_0x4675b9['message']||_0x4675b9[_0x34675c(0xad)]||_0x34675c(0xb4)));}let _0x2d8219=_0x34675c(0x80);if(_0x4675b9[_0x34675c(0x8e)]===![]){if(_0x4675b9[_0x34675c(0xae)]){const _0x255cea=new Date(_0x4675b9['expiryDate']),_0x4c89c1=new Date();_0x255cea<_0x4c89c1?_0x2d8219=_0x34675c(0xc2):_0x2d8219=_0x34675c(0xb0);}else _0x2d8219=_0x34675c(0xb0);}else _0x2d8219=_0x34675c(0x80);return{'status':_0x2d8219,'amount':_0x4675b9[_0x34675c(0xf8)],'currency':_0x4675b9[_0x34675c(0xd9)],'isActive':_0x4675b9['isActive']};}catch(_0x2767ef){console[_0x34675c(0xad)](_0x34675c(0xb5),_0x2767ef),loggerService_1['loggerService']['logWhiteDomainError'](_0x34675c(0x93),_0x34675c(0x86)+_0x30218f,_0x2767ef);throw new Error(_0x34675c(0x96)+(_0x2767ef instanceof Error?_0x2767ef[_0x34675c(0xb3)]:'Unknown\x20error'));}}async[a44_0x2a12ac(0xa1)](_0x48695a){const _0x160881=a44_0x2a12ac;console['log'](_0x160881(0xe5),_0x48695a);let _0x35b57b='PENDING';switch(_0x48695a[_0x160881(0xc3)]?.[_0x160881(0xfa)]()){case'done':case _0x160881(0x7c):case _0x160881(0xcf):case'success':case _0x160881(0xe6):_0x48695a[_0x160881(0xc6)]===_0x160881(0xdc)?_0x35b57b=_0x160881(0x81):_0x35b57b=_0x160881(0x80);break;case _0x160881(0xa2):case'canceled':case _0x160881(0xbe):case _0x160881(0xad):case _0x160881(0x8d):_0x35b57b=_0x160881(0xb0);break;case _0x160881(0x85):case'timeout':_0x35b57b='EXPIRED';break;case _0x160881(0xbb):case'created':case _0x160881(0xdd):case _0x160881(0xde):case _0x160881(0xd6):default:_0x35b57b=_0x160881(0x80);break;}return{'paymentId':_0x48695a['MerchantPaymentId']||_0x48695a[_0x160881(0xb7)],'status':_0x35b57b,'amount':_0x48695a[_0x160881(0x8f)],'currency':_0x48695a[_0x160881(0xf1)],'additionalInfo':{'method':_0x48695a[_0x160881(0xbf)],'bankId':_0x48695a[_0x160881(0xd3)],'settled':_0x48695a[_0x160881(0xc6)],'settlementDate':_0x48695a[_0x160881(0xb9)],'remitterName':_0x48695a[_0x160881(0xcb)]?.[_0x160881(0xab)],'remitterIban':_0x48695a[_0x160881(0xcb)]?.[_0x160881(0xac)],'bankTransactionId':_0x48695a['BankTransactionId']}};}[a44_0x2a12ac(0xea)](_0x17f198,_0x844d92){const _0x77fd21=a44_0x2a12ac;return console[_0x77fd21(0xc8)](_0x77fd21(0x9f),{'receivedSignature':_0x844d92,'paymentId':_0x17f198[_0x77fd21(0xb7)],'merchantPaymentId':_0x17f198['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;