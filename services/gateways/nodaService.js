'use strict';const a63_0x24316a=a63_0x3dcd;(function(_0x416d14,_0x27d8e6){const _0x3cfb6a=a63_0x3dcd,_0x15d3da=_0x416d14();while(!![]){try{const _0x70caac=-parseInt(_0x3cfb6a(0xcf))/0x1*(parseInt(_0x3cfb6a(0xdf))/0x2)+-parseInt(_0x3cfb6a(0xb7))/0x3+parseInt(_0x3cfb6a(0x78))/0x4*(-parseInt(_0x3cfb6a(0x86))/0x5)+parseInt(_0x3cfb6a(0xa1))/0x6+parseInt(_0x3cfb6a(0x72))/0x7*(-parseInt(_0x3cfb6a(0x8b))/0x8)+parseInt(_0x3cfb6a(0x83))/0x9*(-parseInt(_0x3cfb6a(0x8f))/0xa)+parseInt(_0x3cfb6a(0xb1))/0xb;if(_0x70caac===_0x27d8e6)break;else _0x15d3da['push'](_0x15d3da['shift']());}catch(_0x97642b){_0x15d3da['push'](_0x15d3da['shift']());}}}(a63_0x308a,0x328cd));Object['defineProperty'](exports,a63_0x24316a(0xba),{'value':!![]}),exports[a63_0x24316a(0x9a)]=void 0x0;const loggerService_1=require('../loggerService');function a63_0x308a(){const _0x10e5d5=['logWhiteDomainError','in_progress','Not\x20provided','PaymentId','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','(8digits-8digits\x20format\x20for\x20Noda)','Short\x20Link:','pending','Status','Iban','application/json','shortLinkUrls','Noda\x20API\x20error:\x20','Parsed\x20Result:','139hXXhMk','status','PENDING','Error\x20stack:','Error\x20details:','https://tesoft.uk/gateway/noda/','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','HTTP\x20error!\x20status:\x20','Status\x20Text:','Settled','JSON\x20Parse\x20Error:\x20','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Unknown\x20error','paid','===\x20NODA\x20API\x20ERROR\x20===','logWhiteDomainResponse','4926AHXiRz','verifyPayment','URL:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Error\x20Message:','949298gRUMcN','success','shortLink','GET','Processing\x20Noda\x20webhook:','(8digits-8digits\x20format)','403156WUMNEV','active','SettlementDate','EXPIRED','done','loggerService','failed','POST','message','parse','Method','1071747acEaDt','statusCode','stringify','15ScAQqf','HTTP\x20','https://tesoft.uk/gateway/noda/webhook/','/payment-links/','canceled','24fFpNAf','Raw\x20Response\x20Body:','toLowerCase','Error\x20message:','30DnSGoP','Order\x20ID\x20Used:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','text','timeout','Noda\x20payment\x20verification\x20error:','QR\x20Code\x20Link:','FAILED','Payment\x20System/1.0','BankId','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','NodaService','Response\x20Body:','Amount','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','log','now','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','1285062KWFXGv','Currency','Failed\x20to\x20verify\x20Noda\x20payment:\x20','createPaymentLink','verifyWebhookSignature','Order\x20ID\x20Format:','amount','Missing\x20id\x20or\x20shortLink\x20in\x20response','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','currency','completed','error','===\x20NODA\x20SERVICE\x20ERROR\x20===','/payment-links','Status\x20Code:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','15670512pPpcKk','processing','PAID','statusText','Status:','noda','68703egNFlO','expiryDate','Headers:','__esModule','Remitter','apiUrl','BankTransactionId','HTTP\x20Status:','expired','logWhiteDomainRequest'];a63_0x308a=function(){return _0x10e5d5;};return a63_0x308a();}class NodaService{constructor(){const _0x667874=a63_0x24316a;this['apiUrl']=_0x667874(0xd4),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a63_0x24316a(0xa4)](_0x4ecbab){const _0x16062e=a63_0x24316a,{orderId:_0xe38a99,name:_0x5a079d,paymentDescription:_0x7b49c8,amount:_0x3ffd67,currency:_0x300eb8,webhookUrl:_0x7c372e,returnUrl:_0x58b2d8,expiryDate:_0x2dbaad}=_0x4ecbab,_0x51e0f6=_0x300eb8['toUpperCase'](),_0x53f34f=_0x16062e(0x88),_0x4bd44a='https://tesoft.uk/gateway/pending.php?id='+_0xe38a99,_0x6bf69b={'name':_0x5a079d,'paymentDescription':_0x7b49c8,'amount':_0x3ffd67,'currency':_0x51e0f6,'paymentId':_0xe38a99,'webhookUrl':_0x53f34f,'returnUrl':_0x4bd44a};_0x2dbaad&&(_0x6bf69b[_0x16062e(0xb8)]=_0x2dbaad);const _0x2ce314=Date[_0x16062e(0x9f)]();try{console['log'](_0x16062e(0xa9)),console[_0x16062e(0x9e)](_0x16062e(0x6f),this[_0x16062e(0xbc)]),console[_0x16062e(0x9e)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x16062e(0x85)](_0x6bf69b,null,0x2)),console[_0x16062e(0x9e)](_0x16062e(0xa6),_0xe38a99,_0x16062e(0xc6)),console[_0x16062e(0x9e)](_0x16062e(0xa0),_0x4bd44a),loggerService_1[_0x16062e(0x7d)][_0x16062e(0xc0)](_0x16062e(0xb6),_0x16062e(0xae),_0x16062e(0x7f),_0x6bf69b);const _0x43ed59=await fetch(this[_0x16062e(0xbc)],{'method':_0x16062e(0x7f),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x16062e(0x97)},'body':JSON[_0x16062e(0x85)](_0x6bf69b)}),_0x534242=Date[_0x16062e(0x9f)]()-_0x2ce314;console[_0x16062e(0x9e)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x16062e(0x9e)](_0x16062e(0xb5),_0x43ed59[_0x16062e(0xd0)]),console[_0x16062e(0x9e)](_0x16062e(0xd7),_0x43ed59[_0x16062e(0xb4)]),console[_0x16062e(0x9e)](_0x16062e(0xb9),Object['fromEntries'](_0x43ed59['headers']['entries']())),console['log']('Response\x20Time:',_0x534242+'ms');const _0x51d249=await _0x43ed59[_0x16062e(0x92)]();console['log'](_0x16062e(0x8c),_0x51d249);if(!_0x43ed59['ok']){console[_0x16062e(0xac)](_0x16062e(0xdd)),console['error'](_0x16062e(0xbe),_0x43ed59[_0x16062e(0xd0)]),console[_0x16062e(0xac)](_0x16062e(0x9b),_0x51d249),loggerService_1[_0x16062e(0x7d)][_0x16062e(0xde)]('noda',_0x16062e(0xae),_0x43ed59['status'],_0x51d249,_0x534242),loggerService_1[_0x16062e(0x7d)][_0x16062e(0xc1)](_0x16062e(0xb6),_0x16062e(0xae),_0x16062e(0x87)+_0x43ed59['status']+':\x20'+_0x51d249);if(_0x43ed59[_0x16062e(0xd0)]===0x190)throw new Error(_0x16062e(0x9d));else{if(_0x43ed59[_0x16062e(0xd0)]===0x1f4)throw new Error(_0x16062e(0x99));}throw new Error(_0x16062e(0xd6)+_0x43ed59['status']+',\x20body:\x20'+_0x51d249);}let _0x418f4a;try{_0x418f4a=JSON[_0x16062e(0x81)](_0x51d249);}catch(_0x27468d){console[_0x16062e(0xac)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x27468d),loggerService_1[_0x16062e(0x7d)][_0x16062e(0xc1)](_0x16062e(0xb6),_0x16062e(0xae),_0x16062e(0xd9)+_0x27468d);throw new Error(_0x16062e(0xb0)+_0x51d249);}console[_0x16062e(0x9e)](_0x16062e(0x91)),console['log'](_0x16062e(0xce),JSON['stringify'](_0x418f4a,null,0x2)),loggerService_1[_0x16062e(0x7d)][_0x16062e(0xde)]('noda','/payment-links',_0x43ed59[_0x16062e(0xd0)],_0x418f4a,_0x534242);if(_0x418f4a[_0x16062e(0xac)]||_0x418f4a[_0x16062e(0x84)]){const _0x20f7d7=_0x418f4a['message']||_0x418f4a[_0x16062e(0xac)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x16062e(0xac)](_0x16062e(0xda)),console[_0x16062e(0xac)](_0x16062e(0x71),_0x20f7d7),console[_0x16062e(0xac)](_0x16062e(0xaf),_0x418f4a[_0x16062e(0x84)]),loggerService_1[_0x16062e(0x7d)][_0x16062e(0xc1)](_0x16062e(0xb6),_0x16062e(0xae),'Business\x20Error:\x20'+_0x20f7d7);throw new Error(_0x16062e(0xcd)+_0x20f7d7);}if(!_0x418f4a['id']||!_0x418f4a[_0x16062e(0xcc)]?.['shortLink']){console[_0x16062e(0xac)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x16062e(0xac)](_0x16062e(0xa8)),console[_0x16062e(0xac)]('Response\x20data:',_0x418f4a),loggerService_1[_0x16062e(0x7d)][_0x16062e(0xc1)](_0x16062e(0xb6),_0x16062e(0xae),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x16062e(0xc5));}return console[_0x16062e(0x9e)]('===\x20NODA\x20SUCCESS\x20==='),console['log']('Payment\x20Link\x20ID:',_0x418f4a['id']),console[_0x16062e(0x9e)](_0x16062e(0xc7),_0x418f4a[_0x16062e(0xcc)][_0x16062e(0x74)]),console[_0x16062e(0x9e)](_0x16062e(0x95),_0x418f4a['shortLinkUrls']['qrCodeLink']||_0x16062e(0xc3)),console[_0x16062e(0x9e)](_0x16062e(0x90),_0xe38a99,_0x16062e(0x77)),console['log'](_0x16062e(0xd5),_0x4bd44a),{'gateway_payment_id':_0x418f4a['id'],'payment_url':_0x418f4a['shortLinkUrls'][_0x16062e(0x74)],'qr_code_url':_0x418f4a['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x418f4a[_0x16062e(0xb8)]};}catch(_0x50c81b){console[_0x16062e(0xac)](_0x16062e(0xad)),console['error'](_0x16062e(0xd3),_0x50c81b),loggerService_1[_0x16062e(0x7d)]['logWhiteDomainError'](_0x16062e(0xb6),'/payment-links',_0x50c81b);if(_0x50c81b instanceof Error){console['error'](_0x16062e(0x8e),_0x50c81b['message']),console[_0x16062e(0xac)](_0x16062e(0xd2),_0x50c81b['stack']);throw new Error(_0x16062e(0x70)+_0x50c81b['message']);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a63_0x24316a(0x6e)](_0x33e87e){const _0x18ccb5=a63_0x24316a,_0x535eca=Date['now']();try{loggerService_1[_0x18ccb5(0x7d)][_0x18ccb5(0xc0)](_0x18ccb5(0xb6),_0x18ccb5(0x89)+_0x33e87e,_0x18ccb5(0x75),{});const _0x1e0c2a=await fetch(this[_0x18ccb5(0xbc)]+'/'+_0x33e87e,{'method':_0x18ccb5(0x75),'headers':{'Content-Type':_0x18ccb5(0xcb),'User-Agent':_0x18ccb5(0x97)}}),_0x26972f=Date[_0x18ccb5(0x9f)]()-_0x535eca;if(!_0x1e0c2a['ok']){const _0x543190=await _0x1e0c2a[_0x18ccb5(0x92)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x18ccb5(0xb6),_0x18ccb5(0x89)+_0x33e87e,_0x1e0c2a[_0x18ccb5(0xd0)],_0x543190,_0x26972f);throw new Error(_0x18ccb5(0xd6)+_0x1e0c2a[_0x18ccb5(0xd0)]);}const _0x47ce8b=await _0x1e0c2a['json']();loggerService_1[_0x18ccb5(0x7d)][_0x18ccb5(0xde)](_0x18ccb5(0xb6),_0x18ccb5(0x89)+_0x33e87e,_0x1e0c2a[_0x18ccb5(0xd0)],_0x47ce8b,_0x26972f);if(_0x47ce8b[_0x18ccb5(0xac)]||_0x47ce8b[_0x18ccb5(0x84)]){loggerService_1['loggerService'][_0x18ccb5(0xc1)](_0x18ccb5(0xb6),_0x18ccb5(0x89)+_0x33e87e,'Noda\x20API\x20error:\x20'+(_0x47ce8b[_0x18ccb5(0x80)]||_0x47ce8b[_0x18ccb5(0xac)]||'Unknown\x20error'));throw new Error(_0x18ccb5(0xcd)+(_0x47ce8b[_0x18ccb5(0x80)]||_0x47ce8b[_0x18ccb5(0xac)]||_0x18ccb5(0xdb)));}let _0x42b7b0='PENDING';if(_0x47ce8b['isActive']===![]){if(_0x47ce8b['expiryDate']){const _0x30719d=new Date(_0x47ce8b['expiryDate']),_0x116da3=new Date();_0x30719d<_0x116da3?_0x42b7b0=_0x18ccb5(0x7b):_0x42b7b0='FAILED';}else _0x42b7b0=_0x18ccb5(0x96);}else _0x42b7b0=_0x18ccb5(0xd1);return{'status':_0x42b7b0,'amount':_0x47ce8b[_0x18ccb5(0xa7)],'currency':_0x47ce8b[_0x18ccb5(0xaa)],'isActive':_0x47ce8b['isActive']};}catch(_0x3e7770){console[_0x18ccb5(0xac)](_0x18ccb5(0x94),_0x3e7770),loggerService_1[_0x18ccb5(0x7d)]['logWhiteDomainError'](_0x18ccb5(0xb6),_0x18ccb5(0x89)+_0x33e87e,_0x3e7770);throw new Error(_0x18ccb5(0xa3)+(_0x3e7770 instanceof Error?_0x3e7770['message']:'Unknown\x20error'));}}async['processWebhook'](_0x126a71){const _0x61c5b6=a63_0x24316a;console[_0x61c5b6(0x9e)](_0x61c5b6(0x76),_0x126a71);let _0x31fab4='PENDING';switch(_0x126a71[_0x61c5b6(0xc9)]?.[_0x61c5b6(0x8d)]()){case _0x61c5b6(0x7c):case _0x61c5b6(0xab):case _0x61c5b6(0xdc):case _0x61c5b6(0x73):case'successful':_0x126a71['Settled']==='Yes'?_0x31fab4=_0x61c5b6(0xb3):_0x31fab4=_0x61c5b6(0xd1);break;case'cancelled':case _0x61c5b6(0x8a):case _0x61c5b6(0x7e):case _0x61c5b6(0xac):case'rejected':_0x31fab4=_0x61c5b6(0x96);break;case _0x61c5b6(0xbf):case _0x61c5b6(0x93):_0x31fab4=_0x61c5b6(0x7b);break;case _0x61c5b6(0xc8):case'created':case _0x61c5b6(0x79):case _0x61c5b6(0xb2):case _0x61c5b6(0xc2):default:_0x31fab4=_0x61c5b6(0xd1);break;}return{'paymentId':_0x126a71['MerchantPaymentId']||_0x126a71['PaymentId'],'status':_0x31fab4,'amount':_0x126a71[_0x61c5b6(0x9c)],'currency':_0x126a71[_0x61c5b6(0xa2)],'additionalInfo':{'method':_0x126a71[_0x61c5b6(0x82)],'bankId':_0x126a71[_0x61c5b6(0x98)],'settled':_0x126a71[_0x61c5b6(0xd8)],'settlementDate':_0x126a71[_0x61c5b6(0x7a)],'remitterName':_0x126a71[_0x61c5b6(0xbb)]?.['Name'],'remitterIban':_0x126a71[_0x61c5b6(0xbb)]?.[_0x61c5b6(0xca)],'bankTransactionId':_0x126a71[_0x61c5b6(0xbd)]}};}[a63_0x24316a(0xa5)](_0x54f23c,_0x16e3c6){const _0x5303da=a63_0x24316a;return console[_0x5303da(0x9e)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x16e3c6,'paymentId':_0x54f23c[_0x5303da(0xc4)],'merchantPaymentId':_0x54f23c['MerchantPaymentId']}),!![];}}function a63_0x3dcd(_0x5b9442,_0x3fe77f){_0x5b9442=_0x5b9442-0x6e;const _0x308a10=a63_0x308a();let _0x3dcd16=_0x308a10[_0x5b9442];return _0x3dcd16;}exports['NodaService']=NodaService;