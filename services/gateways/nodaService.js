'use strict';function a44_0x3fc9(_0x91b55b,_0x3aa86b){const _0x49904b=a44_0x4990();return a44_0x3fc9=function(_0x3fc9eb,_0x5ac72a){_0x3fc9eb=_0x3fc9eb-0xb9;let _0x317ebc=_0x49904b[_0x3fc9eb];return _0x317ebc;},a44_0x3fc9(_0x91b55b,_0x3aa86b);}const a44_0x5f041c=a44_0x3fc9;(function(_0x32a795,_0x46e22d){const _0x96f021=a44_0x3fc9,_0x25c6b8=_0x32a795();while(!![]){try{const _0x5795e7=-parseInt(_0x96f021(0xfa))/0x1+parseInt(_0x96f021(0x106))/0x2+-parseInt(_0x96f021(0xe6))/0x3+parseInt(_0x96f021(0x102))/0x4*(-parseInt(_0x96f021(0x11b))/0x5)+parseInt(_0x96f021(0xd3))/0x6*(parseInt(_0x96f021(0x11d))/0x7)+parseInt(_0x96f021(0xd7))/0x8*(parseInt(_0x96f021(0xc7))/0x9)+parseInt(_0x96f021(0x12e))/0xa*(parseInt(_0x96f021(0xbb))/0xb);if(_0x5795e7===_0x46e22d)break;else _0x25c6b8['push'](_0x25c6b8['shift']());}catch(_0x3c3de8){_0x25c6b8['push'](_0x25c6b8['shift']());}}}(a44_0x4990,0xf3ed5));function a44_0x4990(){const _0x79684d=['===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','TesSoft\x20Payment\x20System/1.0','BankId','5395205cZZlcA','logWhiteDomainError','13382096LKoSYR','processing','/payment-links/','expiryDate','isActive','Missing\x20id\x20or\x20shortLink\x20in\x20response','rejected','failed','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','NodaService','JSON\x20Parse\x20Error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20Message:','===\x20NODA\x20SERVICE\x20ERROR\x20===','verifyWebhookSignature','message','shortLinkUrls','350DiHlRH','success','Headers:','pending','logWhiteDomainRequest','stack','toUpperCase','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','json','87681quqjPL','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Error\x20details:','Status:','Order\x20ID\x20Format:','/payment-links','HTTP\x20error!\x20status:\x20','apiUrl','verifyPayment','noda','Response\x20Time:','currency','6219cpVmaU','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','loggerService','EXPIRED','Remitter','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Order\x20ID\x20Used:','PaymentId','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Not\x20provided','error','timeout','6znFivv','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','active','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','14552SDgnNK','HTTP\x20','stringify','Settled','Unknown\x20error','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Failed\x20to\x20verify\x20Noda\x20payment:\x20','(8digits-8digits\x20format\x20for\x20Noda)','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','BankTransactionId','Noda\x20API\x20error:\x20','Response\x20Body:','in_progress','PENDING','created','1133004xUgjFc','https://tesoft.uk/gateway/noda/','===\x20NODA\x20API\x20ERROR\x20===','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','paid','toLowerCase','headers','status','statusCode','MerchantPaymentId','logWhiteDomainResponse','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Noda\x20payment\x20verification\x20error:','shortLink','__esModule','expired','Status\x20Code:','successful','Status','1690261OOUyOo','Status\x20Text:',',\x20body:\x20','Raw\x20Response\x20Body:','../loggerService','processWebhook','Business\x20Error:\x20','POST','4KBkcID','now','text','Short\x20Link:','1396906oKXBpK','entries','cancelled','Payment\x20Link\x20ID:','application/json','done','URL:','Error\x20stack:','(8digits-8digits\x20format)','Currency','HTTP\x20Status:','PAID','===\x20NODA\x20SUCCESS\x20===','GET','Name','FAILED','https://tesoft.uk/gateway/pending.php?id=','log'];a44_0x4990=function(){return _0x79684d;};return a44_0x4990();}Object['defineProperty'](exports,a44_0x5f041c(0xf5),{'value':!![]}),exports[a44_0x5f041c(0x126)]=void 0x0;const loggerService_1=require(a44_0x5f041c(0xfe));class NodaService{constructor(){const _0xf73fe5=a44_0x5f041c;this[_0xf73fe5(0xc2)]=_0xf73fe5(0xe7),console[_0xf73fe5(0x117)](_0xf73fe5(0xdf));}async['createPaymentLink'](_0x292062){const _0x419b53=a44_0x5f041c,{orderId:_0x47aa6c,name:_0x199908,paymentDescription:_0x489d82,amount:_0x55e315,currency:_0x3d7474,webhookUrl:_0x2f1b80,returnUrl:_0x1ededa,expiryDate:_0x488aa2}=_0x292062,_0x515da9=_0x3d7474[_0x419b53(0x134)](),_0x1b4c2a='https://tesoft.uk/gateway/noda/webhook/',_0x2f124d=_0x419b53(0x116)+_0x47aa6c,_0x4a541f={'name':_0x199908,'paymentDescription':_0x489d82,'amount':_0x55e315,'currency':_0x515da9,'paymentId':_0x47aa6c,'webhookUrl':_0x1b4c2a,'returnUrl':_0x2f124d};_0x488aa2&&(_0x4a541f[_0x419b53(0x120)]=_0x488aa2);const _0x576391=Date[_0x419b53(0x103)]();try{console[_0x419b53(0x117)](_0x419b53(0xbc)),console['log'](_0x419b53(0x10c),this[_0x419b53(0xc2)]),console[_0x419b53(0x117)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x419b53(0xd9)](_0x4a541f,null,0x2)),console[_0x419b53(0x117)](_0x419b53(0xbf),_0x47aa6c,_0x419b53(0xde)),console[_0x419b53(0x117)](_0x419b53(0xcf),_0x2f124d),loggerService_1[_0x419b53(0xc9)][_0x419b53(0x132)](_0x419b53(0xc4),'/payment-links','POST',_0x4a541f);const _0x26603b=await fetch(this[_0x419b53(0xc2)],{'method':_0x419b53(0x101),'headers':{'Content-Type':_0x419b53(0x10a),'Accept':_0x419b53(0x10a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x419b53(0xd9)](_0x4a541f)}),_0x2417d9=Date[_0x419b53(0x103)]()-_0x576391;console[_0x419b53(0x117)](_0x419b53(0xcc)),console[_0x419b53(0x117)](_0x419b53(0xbe),_0x26603b[_0x419b53(0xee)]),console['log'](_0x419b53(0xfb),_0x26603b['statusText']),console['log'](_0x419b53(0x130),Object['fromEntries'](_0x26603b[_0x419b53(0xed)][_0x419b53(0x107)]())),console['log'](_0x419b53(0xc5),_0x2417d9+'ms');const _0x27cf00=await _0x26603b['text']();console['log'](_0x419b53(0xfd),_0x27cf00);if(!_0x26603b['ok']){console[_0x419b53(0xd1)](_0x419b53(0xe8)),console[_0x419b53(0xd1)](_0x419b53(0x110),_0x26603b[_0x419b53(0xee)]),console[_0x419b53(0xd1)](_0x419b53(0xe2),_0x27cf00),loggerService_1[_0x419b53(0xc9)][_0x419b53(0xf1)](_0x419b53(0xc4),_0x419b53(0xc0),_0x26603b['status'],_0x27cf00,_0x2417d9),loggerService_1[_0x419b53(0xc9)]['logWhiteDomainError']('noda',_0x419b53(0xc0),_0x419b53(0xd8)+_0x26603b[_0x419b53(0xee)]+':\x20'+_0x27cf00);if(_0x26603b[_0x419b53(0xee)]===0x190)throw new Error(_0x419b53(0xd6));else{if(_0x26603b[_0x419b53(0xee)]===0x1f4)throw new Error(_0x419b53(0xe9));}throw new Error(_0x419b53(0xc1)+_0x26603b[_0x419b53(0xee)]+_0x419b53(0xfc)+_0x27cf00);}let _0x1edd53;try{_0x1edd53=JSON['parse'](_0x27cf00);}catch(_0x2f73f5){console['error'](_0x419b53(0x128),_0x2f73f5),loggerService_1[_0x419b53(0xc9)][_0x419b53(0x11c)]('noda',_0x419b53(0xc0),_0x419b53(0x127)+_0x2f73f5);throw new Error(_0x419b53(0xc8)+_0x27cf00);}console[_0x419b53(0x117)](_0x419b53(0xf2)),console[_0x419b53(0x117)]('Parsed\x20Result:',JSON['stringify'](_0x1edd53,null,0x2)),loggerService_1[_0x419b53(0xc9)][_0x419b53(0xf1)](_0x419b53(0xc4),_0x419b53(0xc0),_0x26603b[_0x419b53(0xee)],_0x1edd53,_0x2417d9);if(_0x1edd53['error']||_0x1edd53[_0x419b53(0xef)]){const _0x82c495=_0x1edd53[_0x419b53(0x12c)]||_0x1edd53['error']||'Unknown\x20error\x20from\x20Noda\x20API';console['error'](_0x419b53(0x125)),console[_0x419b53(0xd1)](_0x419b53(0x129),_0x82c495),console[_0x419b53(0xd1)](_0x419b53(0xf7),_0x1edd53['statusCode']),loggerService_1['loggerService']['logWhiteDomainError'](_0x419b53(0xc4),_0x419b53(0xc0),_0x419b53(0x100)+_0x82c495);throw new Error(_0x419b53(0xe1)+_0x82c495);}if(!_0x1edd53['id']||!_0x1edd53[_0x419b53(0x12d)]?.[_0x419b53(0xf4)]){console['error'](_0x419b53(0x118)),console[_0x419b53(0xd1)](_0x419b53(0x122)),console[_0x419b53(0xd1)]('Response\x20data:',_0x1edd53),loggerService_1['loggerService'][_0x419b53(0x11c)](_0x419b53(0xc4),'/payment-links',_0x419b53(0xdc));throw new Error(_0x419b53(0xea));}return console[_0x419b53(0x117)](_0x419b53(0x112)),console[_0x419b53(0x117)](_0x419b53(0x109),_0x1edd53['id']),console[_0x419b53(0x117)](_0x419b53(0x105),_0x1edd53[_0x419b53(0x12d)][_0x419b53(0xf4)]),console[_0x419b53(0x117)]('QR\x20Code\x20Link:',_0x1edd53[_0x419b53(0x12d)]['qrCodeLink']||_0x419b53(0xd0)),console['log'](_0x419b53(0xcd),_0x47aa6c,_0x419b53(0x10e)),console[_0x419b53(0x117)](_0x419b53(0xb9),_0x2f124d),{'gateway_payment_id':_0x1edd53['id'],'payment_url':_0x1edd53[_0x419b53(0x12d)][_0x419b53(0xf4)],'qr_code_url':_0x1edd53[_0x419b53(0x12d)]['qrCodeLink'],'expiry_date':_0x1edd53['expiryDate']};}catch(_0x2f00fe){console['error'](_0x419b53(0x12a)),console['error'](_0x419b53(0xbd),_0x2f00fe),loggerService_1[_0x419b53(0xc9)][_0x419b53(0x11c)](_0x419b53(0xc4),_0x419b53(0xc0),_0x2f00fe);if(_0x2f00fe instanceof Error){console[_0x419b53(0xd1)]('Error\x20message:',_0x2f00fe[_0x419b53(0x12c)]),console[_0x419b53(0xd1)](_0x419b53(0x10d),_0x2f00fe[_0x419b53(0x133)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x2f00fe[_0x419b53(0x12c)]);}throw new Error(_0x419b53(0xd4));}}async[a44_0x5f041c(0xc3)](_0x4055a0){const _0x3a2500=a44_0x5f041c,_0x4ad986=Date[_0x3a2500(0x103)]();try{loggerService_1['loggerService']['logWhiteDomainRequest'](_0x3a2500(0xc4),_0x3a2500(0x11f)+_0x4055a0,'GET',{});const _0xc0ad5e=await fetch(this[_0x3a2500(0xc2)]+'/'+_0x4055a0,{'method':_0x3a2500(0x113),'headers':{'Content-Type':_0x3a2500(0x10a),'User-Agent':_0x3a2500(0x119)}}),_0x475570=Date['now']()-_0x4ad986;if(!_0xc0ad5e['ok']){const _0x5e5aea=await _0xc0ad5e[_0x3a2500(0x104)]();loggerService_1[_0x3a2500(0xc9)]['logWhiteDomainResponse'](_0x3a2500(0xc4),_0x3a2500(0x11f)+_0x4055a0,_0xc0ad5e[_0x3a2500(0xee)],_0x5e5aea,_0x475570);throw new Error(_0x3a2500(0xc1)+_0xc0ad5e[_0x3a2500(0xee)]);}const _0x425634=await _0xc0ad5e[_0x3a2500(0xba)]();loggerService_1[_0x3a2500(0xc9)]['logWhiteDomainResponse'](_0x3a2500(0xc4),_0x3a2500(0x11f)+_0x4055a0,_0xc0ad5e[_0x3a2500(0xee)],_0x425634,_0x475570);if(_0x425634[_0x3a2500(0xd1)]||_0x425634[_0x3a2500(0xef)]){loggerService_1['loggerService'][_0x3a2500(0x11c)](_0x3a2500(0xc4),_0x3a2500(0x11f)+_0x4055a0,_0x3a2500(0xe1)+(_0x425634[_0x3a2500(0x12c)]||_0x425634['error']||_0x3a2500(0xdb)));throw new Error(_0x3a2500(0xe1)+(_0x425634[_0x3a2500(0x12c)]||_0x425634['error']||_0x3a2500(0xdb)));}let _0x444e9d='PENDING';if(_0x425634[_0x3a2500(0x121)]===![]){if(_0x425634[_0x3a2500(0x120)]){const _0x488735=new Date(_0x425634[_0x3a2500(0x120)]),_0x45e533=new Date();_0x488735<_0x45e533?_0x444e9d=_0x3a2500(0xca):_0x444e9d=_0x3a2500(0x115);}else _0x444e9d=_0x3a2500(0x115);}else _0x444e9d=_0x3a2500(0xe4);return{'status':_0x444e9d,'amount':_0x425634['amount'],'currency':_0x425634[_0x3a2500(0xc6)],'isActive':_0x425634[_0x3a2500(0x121)]};}catch(_0x3f6c2e){console[_0x3a2500(0xd1)](_0x3a2500(0xf3),_0x3f6c2e),loggerService_1[_0x3a2500(0xc9)][_0x3a2500(0x11c)](_0x3a2500(0xc4),_0x3a2500(0x11f)+_0x4055a0,_0x3f6c2e);throw new Error(_0x3a2500(0xdd)+(_0x3f6c2e instanceof Error?_0x3f6c2e[_0x3a2500(0x12c)]:_0x3a2500(0xdb)));}}async[a44_0x5f041c(0xff)](_0x55d01c){const _0x43d138=a44_0x5f041c;console[_0x43d138(0x117)]('Processing\x20Noda\x20webhook:',_0x55d01c);let _0x374da9=_0x43d138(0xe4);switch(_0x55d01c[_0x43d138(0xf9)]?.[_0x43d138(0xec)]()){case _0x43d138(0x10b):case'completed':case _0x43d138(0xeb):case _0x43d138(0x12f):case _0x43d138(0xf8):_0x55d01c[_0x43d138(0xda)]==='Yes'?_0x374da9=_0x43d138(0x111):_0x374da9=_0x43d138(0xe4);break;case _0x43d138(0x108):case'canceled':case _0x43d138(0x124):case'error':case _0x43d138(0x123):_0x374da9=_0x43d138(0x115);break;case _0x43d138(0xf6):case _0x43d138(0xd2):_0x374da9=_0x43d138(0xca);break;case _0x43d138(0x131):case _0x43d138(0xe5):case _0x43d138(0xd5):case _0x43d138(0x11e):case _0x43d138(0xe3):default:_0x374da9=_0x43d138(0xe4);break;}return{'paymentId':_0x55d01c[_0x43d138(0xf0)]||_0x55d01c[_0x43d138(0xce)],'status':_0x374da9,'amount':_0x55d01c['Amount'],'currency':_0x55d01c[_0x43d138(0x10f)],'additionalInfo':{'method':_0x55d01c['Method'],'bankId':_0x55d01c[_0x43d138(0x11a)],'settled':_0x55d01c[_0x43d138(0xda)],'settlementDate':_0x55d01c['SettlementDate'],'remitterName':_0x55d01c['Remitter']?.[_0x43d138(0x114)],'remitterIban':_0x55d01c[_0x43d138(0xcb)]?.['Iban'],'bankTransactionId':_0x55d01c[_0x43d138(0xe0)]}};}[a44_0x5f041c(0x12b)](_0x282142,_0x25ee2f){const _0x5d3e55=a44_0x5f041c;return console[_0x5d3e55(0x117)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x25ee2f,'paymentId':_0x282142[_0x5d3e55(0xce)],'merchantPaymentId':_0x282142['MerchantPaymentId']}),!![];}}exports[a44_0x5f041c(0x126)]=NodaService;