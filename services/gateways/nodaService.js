'use strict';const a43_0x2277c=a43_0x210f;(function(_0x22f246,_0x33236a){const _0x456493=a43_0x210f,_0x14e578=_0x22f246();while(!![]){try{const _0xd66759=parseInt(_0x456493(0xe6))/0x1+parseInt(_0x456493(0xa8))/0x2+-parseInt(_0x456493(0xe3))/0x3+parseInt(_0x456493(0xbf))/0x4*(-parseInt(_0x456493(0xb7))/0x5)+-parseInt(_0x456493(0x9b))/0x6*(-parseInt(_0x456493(0xd3))/0x7)+-parseInt(_0x456493(0xd6))/0x8+parseInt(_0x456493(0xe7))/0x9;if(_0xd66759===_0x33236a)break;else _0x14e578['push'](_0x14e578['shift']());}catch(_0x5414da){_0x14e578['push'](_0x14e578['shift']());}}}(a43_0x967d,0x817df));function a43_0x967d(){const _0x5c3d19=['error','QR\x20Code\x20Link:','currency','Error\x20message:','PaymentId','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20Message:','loggerService','noda','(8digits-8digits\x20format)','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','processWebhook','HTTP\x20','Unknown\x20error\x20from\x20Noda\x20API','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Currency','processing','Error\x20stack:','verifyWebhookSignature','Unknown\x20error','done','isActive','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Remitter','Failed\x20to\x20parse\x20JSON\x20response:','FAILED','NodaService','application/json','expired','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','===\x20NODA\x20SERVICE\x20ERROR\x20===','createPaymentLink','===\x20PARSED\x20NODA\x20RESPONSE\x20===','statusCode',',\x20body:\x20','Error\x20details:','4798110PVwfYs','Short\x20Link:','Not\x20provided','Amount','statusText','Status\x20Text:','Business\x20Error:\x20','logWhiteDomainError','Processing\x20Noda\x20webhook:','shortLink','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Raw\x20Response\x20Body:','Response\x20Time:','1122986BgqxcG','URL:','in_progress','/payment-links','SettlementDate','status','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','log','cancelled','Missing\x20id\x20or\x20shortLink\x20in\x20response','timeout','Headers:','logWhiteDomainResponse','expiryDate','Parsed\x20Result:','120810xFjLGJ','defineProperty','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Yes','verifyPayment','/payment-links/','message','canceled','72Lizguo','text','Settled','toUpperCase','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','apiUrl','Noda\x20API\x20error:\x20','Status:','shortLinkUrls','Name','toLowerCase','TesSoft\x20Payment\x20System/1.0','Request\x20Body\x20(Direct\x20JSON):','paid','https://tesoft.uk/gateway/pending.php?id=','pending','qrCodeLink','logWhiteDomainRequest','now','active','7pKIJzg','POST','Status','3513536ZQqcgK','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','entries','EXPIRED','(8digits-8digits\x20format\x20for\x20Noda)','Order\x20ID\x20Format:','MerchantPaymentId','Iban','rejected','GET','Payment\x20Link\x20ID:','PENDING','stringify','3096795KulTJT','__esModule','HTTP\x20error!\x20status:\x20','470790lZanFQ','5443236balOmY','failed','completed','Order\x20ID\x20Used:','successful'];a43_0x967d=function(){return _0x5c3d19;};return a43_0x967d();}function a43_0x210f(_0x3979e4,_0x44ac5f){const _0x967d35=a43_0x967d();return a43_0x210f=function(_0x210ff6,_0x57e417){_0x210ff6=_0x210ff6-0x7c;let _0x2c3af3=_0x967d35[_0x210ff6];return _0x2c3af3;},a43_0x210f(_0x3979e4,_0x44ac5f);}Object[a43_0x2277c(0xb8)](exports,a43_0x2277c(0xe4),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x2ef570=a43_0x2277c;this['apiUrl']='https://tesoft.uk/gateway/noda/',console['log'](_0x2ef570(0xf1));}async[a43_0x2277c(0x96)](_0x2e639a){const _0x15f146=a43_0x2277c,{orderId:_0x285aa4,name:_0x5f2133,paymentDescription:_0xf168ae,amount:_0x3fe04d,currency:_0x16761c,webhookUrl:_0x1c0eeb,returnUrl:_0x22e305,expiryDate:_0x3c6232}=_0x2e639a,_0x29528e=_0x16761c[_0x15f146(0xc2)](),_0x268e66='https://tesoft.uk/gateway/noda/webhook/',_0x576cfc=_0x15f146(0xcd)+_0x285aa4,_0x3a5e35={'name':_0x5f2133,'paymentDescription':_0xf168ae,'amount':_0x3fe04d,'currency':_0x29528e,'paymentId':_0x285aa4,'webhookUrl':_0x268e66,'returnUrl':_0x576cfc};_0x3c6232&&(_0x3a5e35[_0x15f146(0xb5)]=_0x3c6232);const _0x39b230=Date[_0x15f146(0xd1)]();try{console['log'](_0x15f146(0xa5)),console[_0x15f146(0xaf)](_0x15f146(0xa9),this['apiUrl']),console[_0x15f146(0xaf)](_0x15f146(0xcb),JSON[_0x15f146(0xe2)](_0x3a5e35,null,0x2)),console[_0x15f146(0xaf)](_0x15f146(0xdb),_0x285aa4,_0x15f146(0xda)),console[_0x15f146(0xaf)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x576cfc),loggerService_1['loggerService'][_0x15f146(0xd0)](_0x15f146(0x7e),_0x15f146(0xab),_0x15f146(0xd4),_0x3a5e35);const _0x5e0f95=await fetch(this[_0x15f146(0xc4)],{'method':_0x15f146(0xd4),'headers':{'Content-Type':'application/json','Accept':_0x15f146(0x91),'User-Agent':_0x15f146(0xca)},'body':JSON['stringify'](_0x3a5e35)}),_0x2d86be=Date[_0x15f146(0xd1)]()-_0x39b230;console[_0x15f146(0xaf)](_0x15f146(0x84)),console[_0x15f146(0xaf)](_0x15f146(0xc6),_0x5e0f95[_0x15f146(0xad)]),console[_0x15f146(0xaf)](_0x15f146(0xa0),_0x5e0f95[_0x15f146(0x9f)]),console[_0x15f146(0xaf)](_0x15f146(0xb3),Object['fromEntries'](_0x5e0f95['headers'][_0x15f146(0xd8)]())),console[_0x15f146(0xaf)](_0x15f146(0xa7),_0x2d86be+'ms');const _0x541695=await _0x5e0f95[_0x15f146(0xc0)]();console[_0x15f146(0xaf)](_0x15f146(0xa6),_0x541695);if(!_0x5e0f95['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x5e0f95[_0x15f146(0xad)]),console['error']('Response\x20Body:',_0x541695),loggerService_1['loggerService'][_0x15f146(0xb4)](_0x15f146(0x7e),_0x15f146(0xab),_0x5e0f95[_0x15f146(0xad)],_0x541695,_0x2d86be),loggerService_1[_0x15f146(0x7d)][_0x15f146(0xa2)](_0x15f146(0x7e),'/payment-links',_0x15f146(0x82)+_0x5e0f95[_0x15f146(0xad)]+':\x20'+_0x541695);if(_0x5e0f95[_0x15f146(0xad)]===0x190)throw new Error(_0x15f146(0x80));else{if(_0x5e0f95['status']===0x1f4)throw new Error(_0x15f146(0xc3));}throw new Error(_0x15f146(0xe5)+_0x5e0f95['status']+_0x15f146(0x99)+_0x541695);}let _0x3d31fa;try{_0x3d31fa=JSON['parse'](_0x541695);}catch(_0x1ee659){console[_0x15f146(0xec)](_0x15f146(0x8e),_0x1ee659),loggerService_1[_0x15f146(0x7d)][_0x15f146(0xa2)](_0x15f146(0x7e),_0x15f146(0xab),'JSON\x20Parse\x20Error:\x20'+_0x1ee659);throw new Error(_0x15f146(0x93)+_0x541695);}console[_0x15f146(0xaf)](_0x15f146(0x97)),console['log'](_0x15f146(0xb6),JSON[_0x15f146(0xe2)](_0x3d31fa,null,0x2)),loggerService_1[_0x15f146(0x7d)][_0x15f146(0xb4)](_0x15f146(0x7e),_0x15f146(0xab),_0x5e0f95[_0x15f146(0xad)],_0x3d31fa,_0x2d86be);if(_0x3d31fa[_0x15f146(0xec)]||_0x3d31fa[_0x15f146(0x98)]){const _0x407972=_0x3d31fa[_0x15f146(0xbd)]||_0x3d31fa[_0x15f146(0xec)]||_0x15f146(0x83);console[_0x15f146(0xec)](_0x15f146(0x94)),console[_0x15f146(0xec)](_0x15f146(0x7c),_0x407972),console[_0x15f146(0xec)]('Status\x20Code:',_0x3d31fa[_0x15f146(0x98)]),loggerService_1['loggerService'][_0x15f146(0xa2)]('noda',_0x15f146(0xab),_0x15f146(0xa1)+_0x407972);throw new Error(_0x15f146(0xc5)+_0x407972);}if(!_0x3d31fa['id']||!_0x3d31fa[_0x15f146(0xc7)]?.[_0x15f146(0xa4)]){console[_0x15f146(0xec)](_0x15f146(0xae)),console['error'](_0x15f146(0xb1)),console['error']('Response\x20data:',_0x3d31fa),loggerService_1['loggerService'][_0x15f146(0xa2)](_0x15f146(0x7e),_0x15f146(0xab),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x15f146(0xd7));}return console[_0x15f146(0xaf)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x15f146(0xaf)](_0x15f146(0xe0),_0x3d31fa['id']),console['log'](_0x15f146(0x9c),_0x3d31fa[_0x15f146(0xc7)][_0x15f146(0xa4)]),console[_0x15f146(0xaf)](_0x15f146(0xed),_0x3d31fa['shortLinkUrls'][_0x15f146(0xcf)]||_0x15f146(0x9d)),console[_0x15f146(0xaf)](_0x15f146(0xea),_0x285aa4,_0x15f146(0x7f)),console[_0x15f146(0xaf)](_0x15f146(0x8c),_0x576cfc),{'gateway_payment_id':_0x3d31fa['id'],'payment_url':_0x3d31fa[_0x15f146(0xc7)][_0x15f146(0xa4)],'qr_code_url':_0x3d31fa['shortLinkUrls'][_0x15f146(0xcf)],'expiry_date':_0x3d31fa[_0x15f146(0xb5)]};}catch(_0x5368a1){console[_0x15f146(0xec)](_0x15f146(0x95)),console[_0x15f146(0xec)](_0x15f146(0x9a),_0x5368a1),loggerService_1[_0x15f146(0x7d)][_0x15f146(0xa2)]('noda',_0x15f146(0xab),_0x5368a1);if(_0x5368a1 instanceof Error){console['error'](_0x15f146(0xef),_0x5368a1[_0x15f146(0xbd)]),console[_0x15f146(0xec)](_0x15f146(0x87),_0x5368a1['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x5368a1[_0x15f146(0xbd)]);}throw new Error(_0x15f146(0xb9));}}async[a43_0x2277c(0xbb)](_0x1f28a0){const _0x2e855b=a43_0x2277c,_0x2245da=Date[_0x2e855b(0xd1)]();try{loggerService_1[_0x2e855b(0x7d)][_0x2e855b(0xd0)](_0x2e855b(0x7e),_0x2e855b(0xbc)+_0x1f28a0,_0x2e855b(0xdf),{});const _0x4e1280=await fetch(this['apiUrl']+'/'+_0x1f28a0,{'method':'GET','headers':{'Content-Type':_0x2e855b(0x91),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x45f77b=Date[_0x2e855b(0xd1)]()-_0x2245da;if(!_0x4e1280['ok']){const _0x6ff9b2=await _0x4e1280[_0x2e855b(0xc0)]();loggerService_1[_0x2e855b(0x7d)][_0x2e855b(0xb4)](_0x2e855b(0x7e),'/payment-links/'+_0x1f28a0,_0x4e1280[_0x2e855b(0xad)],_0x6ff9b2,_0x45f77b);throw new Error(_0x2e855b(0xe5)+_0x4e1280[_0x2e855b(0xad)]);}const _0x2f6ffa=await _0x4e1280['json']();loggerService_1[_0x2e855b(0x7d)]['logWhiteDomainResponse'](_0x2e855b(0x7e),_0x2e855b(0xbc)+_0x1f28a0,_0x4e1280[_0x2e855b(0xad)],_0x2f6ffa,_0x45f77b);if(_0x2f6ffa[_0x2e855b(0xec)]||_0x2f6ffa[_0x2e855b(0x98)]){loggerService_1[_0x2e855b(0x7d)][_0x2e855b(0xa2)](_0x2e855b(0x7e),_0x2e855b(0xbc)+_0x1f28a0,'Noda\x20API\x20error:\x20'+(_0x2f6ffa['message']||_0x2f6ffa[_0x2e855b(0xec)]||_0x2e855b(0x89)));throw new Error('Noda\x20API\x20error:\x20'+(_0x2f6ffa[_0x2e855b(0xbd)]||_0x2f6ffa[_0x2e855b(0xec)]||'Unknown\x20error'));}let _0x16b97f=_0x2e855b(0xe1);if(_0x2f6ffa[_0x2e855b(0x8b)]===![]){if(_0x2f6ffa['expiryDate']){const _0x5262e1=new Date(_0x2f6ffa['expiryDate']),_0x1c1484=new Date();_0x5262e1<_0x1c1484?_0x16b97f=_0x2e855b(0xd9):_0x16b97f='FAILED';}else _0x16b97f=_0x2e855b(0x8f);}else _0x16b97f=_0x2e855b(0xe1);return{'status':_0x16b97f,'amount':_0x2f6ffa['amount'],'currency':_0x2f6ffa[_0x2e855b(0xee)],'isActive':_0x2f6ffa['isActive']};}catch(_0x3ef6dd){console['error']('Noda\x20payment\x20verification\x20error:',_0x3ef6dd),loggerService_1['loggerService'][_0x2e855b(0xa2)](_0x2e855b(0x7e),'/payment-links/'+_0x1f28a0,_0x3ef6dd);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x3ef6dd instanceof Error?_0x3ef6dd['message']:_0x2e855b(0x89)));}}async[a43_0x2277c(0x81)](_0x3e6956){const _0x59f638=a43_0x2277c;console[_0x59f638(0xaf)](_0x59f638(0xa3),_0x3e6956);let _0xd7b172=_0x59f638(0xe1);switch(_0x3e6956[_0x59f638(0xd5)]?.[_0x59f638(0xc9)]()){case _0x59f638(0x8a):case _0x59f638(0xe9):case _0x59f638(0xcc):case'success':case _0x59f638(0xeb):_0x3e6956['Settled']===_0x59f638(0xba)?_0xd7b172='PAID':_0xd7b172='PENDING';break;case _0x59f638(0xb0):case _0x59f638(0xbe):case _0x59f638(0xe8):case _0x59f638(0xec):case _0x59f638(0xde):_0xd7b172=_0x59f638(0x8f);break;case _0x59f638(0x92):case _0x59f638(0xb2):_0xd7b172=_0x59f638(0xd9);break;case _0x59f638(0xce):case'created':case _0x59f638(0xd2):case _0x59f638(0x86):case _0x59f638(0xaa):default:_0xd7b172=_0x59f638(0xe1);break;}return{'paymentId':_0x3e6956[_0x59f638(0xdc)]||_0x3e6956[_0x59f638(0xf0)],'status':_0xd7b172,'amount':_0x3e6956[_0x59f638(0x9e)],'currency':_0x3e6956[_0x59f638(0x85)],'additionalInfo':{'method':_0x3e6956['Method'],'bankId':_0x3e6956['BankId'],'settled':_0x3e6956[_0x59f638(0xc1)],'settlementDate':_0x3e6956[_0x59f638(0xac)],'remitterName':_0x3e6956[_0x59f638(0x8d)]?.[_0x59f638(0xc8)],'remitterIban':_0x3e6956[_0x59f638(0x8d)]?.[_0x59f638(0xdd)],'bankTransactionId':_0x3e6956['BankTransactionId']}};}[a43_0x2277c(0x88)](_0x1bfa58,_0x3b0739){const _0x468743=a43_0x2277c;return console[_0x468743(0xaf)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x3b0739,'paymentId':_0x1bfa58['PaymentId'],'merchantPaymentId':_0x1bfa58[_0x468743(0xdc)]}),!![];}}exports[a43_0x2277c(0x90)]=NodaService;