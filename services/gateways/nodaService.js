'use strict';const a43_0x22323c=a43_0x48f2;(function(_0x2cf2a3,_0x30199a){const _0x1d0a39=a43_0x48f2,_0xbc7fe1=_0x2cf2a3();while(!![]){try{const _0x435223=parseInt(_0x1d0a39(0x19a))/0x1+parseInt(_0x1d0a39(0x19f))/0x2+parseInt(_0x1d0a39(0x16d))/0x3*(parseInt(_0x1d0a39(0x164))/0x4)+parseInt(_0x1d0a39(0x196))/0x5+parseInt(_0x1d0a39(0x1ae))/0x6+-parseInt(_0x1d0a39(0x1c5))/0x7+-parseInt(_0x1d0a39(0x18a))/0x8;if(_0x435223===_0x30199a)break;else _0xbc7fe1['push'](_0xbc7fe1['shift']());}catch(_0x4a78a5){_0xbc7fe1['push'](_0xbc7fe1['shift']());}}}(a43_0x56ac,0xe8d59));function a43_0x56ac(){const _0x2f5669=['Status:','rejected','Error\x20message:','Status\x20Text:','../loggerService','Noda\x20API\x20error:\x20','Noda\x20payment\x20verification\x20error:','MerchantPaymentId','52689LVnFrt','toLowerCase','Business\x20Error:\x20','failed','/payment-links','NodaService','error','Method','Not\x20provided','HTTP\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','now','/payment-links/','verifyPayment','Failed\x20to\x20verify\x20Noda\x20payment:\x20','processing','logWhiteDomainError','statusCode','GET','BankTransactionId','verifyWebhookSignature','done','stack','Payment\x20Link\x20ID:','===\x20NODA\x20SUCCESS\x20===','amount','paid','Headers:','19716192qweExH','Yes','PAID','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','completed','Order\x20ID\x20Used:','Unknown\x20error','shortLink','Missing\x20id\x20or\x20shortLink\x20in\x20response','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','application/json','PaymentId','376310aiadwU','text','headers','QR\x20Code\x20Link:','465208OyzqDm','(8digits-8digits\x20format)','Noda\x20webhook\x20signature\x20verification:','stringify','Settled','442060CujTjO','fromEntries','EXPIRED','message','POST','apiUrl','HTTP\x20Status:','Response\x20Body:','in_progress','noda','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20Message:','__esModule','===\x20PARSED\x20NODA\x20RESPONSE\x20===','createPaymentLink','9555432XVIiAJ','success','URL:','===\x20NODA\x20SERVICE\x20ERROR\x20===','Status\x20Code:','log','loggerService','Response\x20Time:','Currency','isActive','Parsed\x20Result:','active','cancelled','FAILED','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','qrCodeLink','Processing\x20Noda\x20webhook:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','PENDING','===\x20NODA\x20API\x20ERROR\x20===','expired','https://tesoft.uk/gateway/noda/','2140411shEvfA','Remitter','entries','Error\x20stack:','successful','Status','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','expiryDate','logWhiteDomainResponse','status','shortLinkUrls','TesSoft\x20Payment\x20System/1.0','Unknown\x20error\x20from\x20Noda\x20API','BankId','Short\x20Link:','https://tesoft.uk/gateway/pending.php?id=','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','timeout','created','JSON\x20Parse\x20Error:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','statusText','Order\x20ID\x20Format:','toUpperCase','312viVbjz'];a43_0x56ac=function(){return _0x2f5669;};return a43_0x56ac();}function a43_0x48f2(_0x526110,_0x4c81e1){const _0x56ac05=a43_0x56ac();return a43_0x48f2=function(_0x48f21f,_0x20e0d2){_0x48f21f=_0x48f21f-0x15f;let _0x245643=_0x56ac05[_0x48f21f];return _0x245643;},a43_0x48f2(_0x526110,_0x4c81e1);}Object['defineProperty'](exports,a43_0x22323c(0x1ab),{'value':!![]}),exports[a43_0x22323c(0x172)]=void 0x0;const loggerService_1=require(a43_0x22323c(0x169));class NodaService{constructor(){const _0x20eb3a=a43_0x22323c;this['apiUrl']=_0x20eb3a(0x1c4),console[_0x20eb3a(0x1b3)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a43_0x22323c(0x1ad)](_0x3b37dd){const _0x41b083=a43_0x22323c,{orderId:_0xe2c970,name:_0x4c14e7,paymentDescription:_0x2e04ce,amount:_0x1e9f85,currency:_0x6e4e5a,webhookUrl:_0x3916ff,returnUrl:_0x14e85b,expiryDate:_0x37817c}=_0x3b37dd,_0x5d33d1=_0x6e4e5a[_0x41b083(0x163)](),_0x430631='https://tesoft.uk/gateway/noda/webhook/',_0x43fa1f=_0x41b083(0x1d4)+_0xe2c970,_0x1a1280={'name':_0x4c14e7,'paymentDescription':_0x2e04ce,'amount':_0x1e9f85,'currency':_0x5d33d1,'paymentId':_0xe2c970,'webhookUrl':_0x430631,'returnUrl':_0x43fa1f};_0x37817c&&(_0x1a1280[_0x41b083(0x1cc)]=_0x37817c);const _0x365c93=Date[_0x41b083(0x179)]();try{console[_0x41b083(0x1b3)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x41b083(0x1b3)](_0x41b083(0x1b0),this[_0x41b083(0x1a4)]),console['log']('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x41b083(0x19d)](_0x1a1280,null,0x2)),console[_0x41b083(0x1b3)](_0x41b083(0x162),_0xe2c970,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x41b083(0x1b3)](_0x41b083(0x1c0),_0x43fa1f),loggerService_1[_0x41b083(0x1b4)]['logWhiteDomainRequest'](_0x41b083(0x1a8),_0x41b083(0x171),_0x41b083(0x1a3),_0x1a1280);const _0x460e3c=await fetch(this[_0x41b083(0x1a4)],{'method':_0x41b083(0x1a3),'headers':{'Content-Type':_0x41b083(0x194),'Accept':_0x41b083(0x194),'User-Agent':_0x41b083(0x1d0)},'body':JSON[_0x41b083(0x19d)](_0x1a1280)}),_0x3c35b8=Date['now']()-_0x365c93;console[_0x41b083(0x1b3)](_0x41b083(0x18d)),console['log'](_0x41b083(0x165),_0x460e3c[_0x41b083(0x1ce)]),console[_0x41b083(0x1b3)](_0x41b083(0x168),_0x460e3c[_0x41b083(0x161)]),console['log'](_0x41b083(0x189),Object[_0x41b083(0x1a0)](_0x460e3c[_0x41b083(0x198)][_0x41b083(0x1c7)]())),console[_0x41b083(0x1b3)](_0x41b083(0x1b5),_0x3c35b8+'ms');const _0x4c9900=await _0x460e3c[_0x41b083(0x197)]();console[_0x41b083(0x1b3)]('Raw\x20Response\x20Body:',_0x4c9900);if(!_0x460e3c['ok']){console[_0x41b083(0x173)](_0x41b083(0x1c2)),console[_0x41b083(0x173)](_0x41b083(0x1a5),_0x460e3c['status']),console[_0x41b083(0x173)](_0x41b083(0x1a6),_0x4c9900),loggerService_1[_0x41b083(0x1b4)][_0x41b083(0x1cd)]('noda',_0x41b083(0x171),_0x460e3c['status'],_0x4c9900,_0x3c35b8),loggerService_1[_0x41b083(0x1b4)][_0x41b083(0x17e)](_0x41b083(0x1a8),_0x41b083(0x171),_0x41b083(0x176)+_0x460e3c[_0x41b083(0x1ce)]+':\x20'+_0x4c9900);if(_0x460e3c[_0x41b083(0x1ce)]===0x190)throw new Error(_0x41b083(0x178));else{if(_0x460e3c[_0x41b083(0x1ce)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x41b083(0x1bd)+_0x460e3c[_0x41b083(0x1ce)]+',\x20body:\x20'+_0x4c9900);}let _0xa76121;try{_0xa76121=JSON['parse'](_0x4c9900);}catch(_0x383f9e){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x383f9e),loggerService_1[_0x41b083(0x1b4)][_0x41b083(0x17e)](_0x41b083(0x1a8),'/payment-links',_0x41b083(0x15f)+_0x383f9e);throw new Error(_0x41b083(0x1d5)+_0x4c9900);}console[_0x41b083(0x1b3)](_0x41b083(0x1ac)),console[_0x41b083(0x1b3)](_0x41b083(0x1b8),JSON[_0x41b083(0x19d)](_0xa76121,null,0x2)),loggerService_1['loggerService'][_0x41b083(0x1cd)]('noda',_0x41b083(0x171),_0x460e3c[_0x41b083(0x1ce)],_0xa76121,_0x3c35b8);if(_0xa76121[_0x41b083(0x173)]||_0xa76121['statusCode']){const _0x1aa6dc=_0xa76121[_0x41b083(0x1a2)]||_0xa76121[_0x41b083(0x173)]||_0x41b083(0x1d1);console[_0x41b083(0x173)](_0x41b083(0x1bc)),console[_0x41b083(0x173)](_0x41b083(0x1aa),_0x1aa6dc),console[_0x41b083(0x173)](_0x41b083(0x1b2),_0xa76121[_0x41b083(0x17f)]),loggerService_1[_0x41b083(0x1b4)][_0x41b083(0x17e)](_0x41b083(0x1a8),'/payment-links',_0x41b083(0x16f)+_0x1aa6dc);throw new Error(_0x41b083(0x16a)+_0x1aa6dc);}if(!_0xa76121['id']||!_0xa76121[_0x41b083(0x1cf)]?.[_0x41b083(0x191)]){console[_0x41b083(0x173)](_0x41b083(0x1a9)),console[_0x41b083(0x173)](_0x41b083(0x192)),console['error']('Response\x20data:',_0xa76121),loggerService_1[_0x41b083(0x1b4)][_0x41b083(0x17e)]('noda',_0x41b083(0x171),_0x41b083(0x160));throw new Error(_0x41b083(0x1cb));}return console[_0x41b083(0x1b3)](_0x41b083(0x186)),console[_0x41b083(0x1b3)](_0x41b083(0x185),_0xa76121['id']),console['log'](_0x41b083(0x1d3),_0xa76121[_0x41b083(0x1cf)][_0x41b083(0x191)]),console[_0x41b083(0x1b3)](_0x41b083(0x199),_0xa76121[_0x41b083(0x1cf)][_0x41b083(0x1be)]||_0x41b083(0x175)),console[_0x41b083(0x1b3)](_0x41b083(0x18f),_0xe2c970,_0x41b083(0x19b)),console['log']('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x43fa1f),{'gateway_payment_id':_0xa76121['id'],'payment_url':_0xa76121['shortLinkUrls']['shortLink'],'qr_code_url':_0xa76121[_0x41b083(0x1cf)][_0x41b083(0x1be)],'expiry_date':_0xa76121['expiryDate']};}catch(_0x457c39){console['error'](_0x41b083(0x1b1)),console[_0x41b083(0x173)]('Error\x20details:',_0x457c39),loggerService_1[_0x41b083(0x1b4)][_0x41b083(0x17e)](_0x41b083(0x1a8),'/payment-links',_0x457c39);if(_0x457c39 instanceof Error){console[_0x41b083(0x173)](_0x41b083(0x167),_0x457c39[_0x41b083(0x1a2)]),console[_0x41b083(0x173)](_0x41b083(0x1c8),_0x457c39[_0x41b083(0x184)]);throw new Error(_0x41b083(0x193)+_0x457c39[_0x41b083(0x1a2)]);}throw new Error(_0x41b083(0x177));}}async[a43_0x22323c(0x17b)](_0x2a5e61){const _0x39dbd1=a43_0x22323c,_0x3e3db6=Date[_0x39dbd1(0x179)]();try{loggerService_1[_0x39dbd1(0x1b4)]['logWhiteDomainRequest']('noda',_0x39dbd1(0x17a)+_0x2a5e61,'GET',{});const _0x354774=await fetch(this[_0x39dbd1(0x1a4)]+'/'+_0x2a5e61,{'method':_0x39dbd1(0x180),'headers':{'Content-Type':_0x39dbd1(0x194),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x43ced4=Date[_0x39dbd1(0x179)]()-_0x3e3db6;if(!_0x354774['ok']){const _0x42664e=await _0x354774[_0x39dbd1(0x197)]();loggerService_1[_0x39dbd1(0x1b4)][_0x39dbd1(0x1cd)](_0x39dbd1(0x1a8),_0x39dbd1(0x17a)+_0x2a5e61,_0x354774[_0x39dbd1(0x1ce)],_0x42664e,_0x43ced4);throw new Error('HTTP\x20error!\x20status:\x20'+_0x354774['status']);}const _0x946d69=await _0x354774['json']();loggerService_1['loggerService'][_0x39dbd1(0x1cd)]('noda',_0x39dbd1(0x17a)+_0x2a5e61,_0x354774[_0x39dbd1(0x1ce)],_0x946d69,_0x43ced4);if(_0x946d69[_0x39dbd1(0x173)]||_0x946d69[_0x39dbd1(0x17f)]){loggerService_1[_0x39dbd1(0x1b4)][_0x39dbd1(0x17e)](_0x39dbd1(0x1a8),_0x39dbd1(0x17a)+_0x2a5e61,'Noda\x20API\x20error:\x20'+(_0x946d69['message']||_0x946d69[_0x39dbd1(0x173)]||_0x39dbd1(0x190)));throw new Error(_0x39dbd1(0x16a)+(_0x946d69[_0x39dbd1(0x1a2)]||_0x946d69[_0x39dbd1(0x173)]||_0x39dbd1(0x190)));}let _0x420163='PENDING';if(_0x946d69['isActive']===![]){if(_0x946d69['expiryDate']){const _0x4ebe3f=new Date(_0x946d69[_0x39dbd1(0x1cc)]),_0x452fb6=new Date();_0x4ebe3f<_0x452fb6?_0x420163=_0x39dbd1(0x1a1):_0x420163=_0x39dbd1(0x1bb);}else _0x420163=_0x39dbd1(0x1bb);}else _0x420163='PENDING';return{'status':_0x420163,'amount':_0x946d69[_0x39dbd1(0x187)],'currency':_0x946d69['currency'],'isActive':_0x946d69[_0x39dbd1(0x1b7)]};}catch(_0x369c7b){console[_0x39dbd1(0x173)](_0x39dbd1(0x16b),_0x369c7b),loggerService_1['loggerService'][_0x39dbd1(0x17e)](_0x39dbd1(0x1a8),'/payment-links/'+_0x2a5e61,_0x369c7b);throw new Error(_0x39dbd1(0x17c)+(_0x369c7b instanceof Error?_0x369c7b[_0x39dbd1(0x1a2)]:'Unknown\x20error'));}}async['processWebhook'](_0x45af60){const _0x571377=a43_0x22323c;console[_0x571377(0x1b3)](_0x571377(0x1bf),_0x45af60);let _0x5c678f=_0x571377(0x1c1);switch(_0x45af60[_0x571377(0x1ca)]?.[_0x571377(0x16e)]()){case _0x571377(0x183):case _0x571377(0x18e):case _0x571377(0x188):case _0x571377(0x1af):case _0x571377(0x1c9):_0x45af60[_0x571377(0x19e)]===_0x571377(0x18b)?_0x5c678f=_0x571377(0x18c):_0x5c678f=_0x571377(0x1c1);break;case _0x571377(0x1ba):case'canceled':case _0x571377(0x170):case _0x571377(0x173):case _0x571377(0x166):_0x5c678f='FAILED';break;case _0x571377(0x1c3):case _0x571377(0x1d6):_0x5c678f=_0x571377(0x1a1);break;case'pending':case _0x571377(0x1d7):case _0x571377(0x1b9):case _0x571377(0x17d):case _0x571377(0x1a7):default:_0x5c678f=_0x571377(0x1c1);break;}return{'paymentId':_0x45af60[_0x571377(0x16c)]||_0x45af60[_0x571377(0x195)],'status':_0x5c678f,'amount':_0x45af60['Amount'],'currency':_0x45af60[_0x571377(0x1b6)],'additionalInfo':{'method':_0x45af60[_0x571377(0x174)],'bankId':_0x45af60[_0x571377(0x1d2)],'settled':_0x45af60[_0x571377(0x19e)],'settlementDate':_0x45af60['SettlementDate'],'remitterName':_0x45af60['Remitter']?.['Name'],'remitterIban':_0x45af60[_0x571377(0x1c6)]?.['Iban'],'bankTransactionId':_0x45af60[_0x571377(0x181)]}};}[a43_0x22323c(0x182)](_0x1ed04c,_0x5517d7){const _0x1c75a0=a43_0x22323c;return console[_0x1c75a0(0x1b3)](_0x1c75a0(0x19c),{'receivedSignature':_0x5517d7,'paymentId':_0x1ed04c[_0x1c75a0(0x195)],'merchantPaymentId':_0x1ed04c['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;