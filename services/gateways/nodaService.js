'use strict';const a43_0xc2cbe6=a43_0x8aed;(function(_0x189332,_0x251e59){const _0x2512ce=a43_0x8aed,_0x5303b5=_0x189332();while(!![]){try{const _0xba2173=parseInt(_0x2512ce(0x151))/0x1+-parseInt(_0x2512ce(0x1af))/0x2+parseInt(_0x2512ce(0x160))/0x3*(parseInt(_0x2512ce(0x154))/0x4)+parseInt(_0x2512ce(0x15d))/0x5*(parseInt(_0x2512ce(0x165))/0x6)+parseInt(_0x2512ce(0x14c))/0x7*(parseInt(_0x2512ce(0x16a))/0x8)+parseInt(_0x2512ce(0x15f))/0x9+-parseInt(_0x2512ce(0x149))/0xa;if(_0xba2173===_0x251e59)break;else _0x5303b5['push'](_0x5303b5['shift']());}catch(_0x2d29f6){_0x5303b5['push'](_0x5303b5['shift']());}}}(a43_0x6c37,0xcc1cf));function a43_0x6c37(){const _0xe7096d=['PENDING',',\x20body:\x20','statusCode','Business\x20Error:\x20','status','created','noda','Request\x20Body\x20(Direct\x20JSON):','Name','https://tesoft.uk/gateway/pending.php?id=','Noda\x20webhook\x20signature\x20verification:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','(8digits-8digits\x20format)','verifyWebhookSignature','TesSoft\x20Payment\x20System/1.0','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','amount','===\x20PARSED\x20NODA\x20RESPONSE\x20===','stack','PaymentId','Order\x20ID\x20Format:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','FAILED','EXPIRED','Status\x20Text:','in_progress','apiUrl','done','2280458RJjgUq','Noda\x20API\x20error:\x20','JSON\x20Parse\x20Error:\x20','Error\x20details:','defineProperty','Payment\x20Link\x20ID:','(8digits-8digits\x20format\x20for\x20Noda)','loggerService','paid','URL:','PAID','Error\x20stack:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','completed','Parsed\x20Result:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','GET','toLowerCase','active','HTTP\x20','message','json','29138520fOVkqt','parse','Remitter','10913945NBQsmf','HTTP\x20Status:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','NodaService','1079398wYHaPZ','Error\x20message:','fromEntries','4IaqYoI','logWhiteDomainRequest','Yes','processing','/payment-links','https://tesoft.uk/gateway/noda/webhook/','POST','timeout','Noda\x20payment\x20verification\x20error:','445eLcwwT','expiryDate','13794795rbLcCr','433035bFkFSt','Unknown\x20error','Method','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','canceled','38730xgFGHN','shortLink','Response\x20data:','application/json','Status\x20Code:','8LmhlkD','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','text','cancelled','shortLinkUrls','isActive','Order\x20ID\x20Used:','QR\x20Code\x20Link:','createPaymentLink','failed','pending','rejected','statusText','log','success','/payment-links/','Error\x20Message:','error','Status','../loggerService','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Headers:','BankId','Response\x20Time:','Response\x20Body:','Settled','headers','currency','now','logWhiteDomainResponse','Processing\x20Noda\x20webhook:','Currency','stringify','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','MerchantPaymentId','HTTP\x20error!\x20status:\x20','logWhiteDomainError','===\x20NODA\x20SERVICE\x20ERROR\x20===','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Not\x20provided'];a43_0x6c37=function(){return _0xe7096d;};return a43_0x6c37();}Object[a43_0xc2cbe6(0x1b3)](exports,'__esModule',{'value':!![]}),exports[a43_0xc2cbe6(0x150)]=void 0x0;const loggerService_1=require(a43_0xc2cbe6(0x17d));class NodaService{constructor(){const _0x51bd01=a43_0xc2cbe6;this['apiUrl']='https://tesoft.uk/gateway/noda/',console[_0x51bd01(0x177)](_0x51bd01(0x142));}async[a43_0xc2cbe6(0x172)](_0x455ae1){const _0x75d8ce=a43_0xc2cbe6,{orderId:_0x3b8bd4,name:_0x53ae84,paymentDescription:_0x1890ca,amount:_0x172f24,currency:_0x452837,webhookUrl:_0x55e875,returnUrl:_0x5160cd,expiryDate:_0x24cb2d}=_0x455ae1,_0x3d5fc5=_0x452837['toUpperCase'](),_0x410656=_0x75d8ce(0x159),_0x533a8c=_0x75d8ce(0x19b)+_0x3b8bd4,_0xc7910a={'name':_0x53ae84,'paymentDescription':_0x1890ca,'amount':_0x172f24,'currency':_0x3d5fc5,'paymentId':_0x3b8bd4,'webhookUrl':_0x410656,'returnUrl':_0x533a8c};_0x24cb2d&&(_0xc7910a['expiryDate']=_0x24cb2d);const _0x43954a=Date[_0x75d8ce(0x186)]();try{console['log'](_0x75d8ce(0x16b)),console['log'](_0x75d8ce(0x1b8),this[_0x75d8ce(0x1ad)]),console[_0x75d8ce(0x177)](_0x75d8ce(0x199),JSON[_0x75d8ce(0x18a)](_0xc7910a,null,0x2)),console[_0x75d8ce(0x177)](_0x75d8ce(0x1a7),_0x3b8bd4,_0x75d8ce(0x1b5)),console['log']('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x533a8c),loggerService_1[_0x75d8ce(0x1b6)][_0x75d8ce(0x155)](_0x75d8ce(0x198),'/payment-links',_0x75d8ce(0x15a),_0xc7910a);const _0xc2c63a=await fetch(this[_0x75d8ce(0x1ad)],{'method':_0x75d8ce(0x15a),'headers':{'Content-Type':_0x75d8ce(0x168),'Accept':_0x75d8ce(0x168),'User-Agent':_0x75d8ce(0x1a0)},'body':JSON[_0x75d8ce(0x18a)](_0xc7910a)}),_0x4583bb=Date[_0x75d8ce(0x186)]()-_0x43954a;console[_0x75d8ce(0x177)](_0x75d8ce(0x19d)),console['log']('Status:',_0xc2c63a['status']),console[_0x75d8ce(0x177)](_0x75d8ce(0x1ab),_0xc2c63a[_0x75d8ce(0x176)]),console['log'](_0x75d8ce(0x17f),Object[_0x75d8ce(0x153)](_0xc2c63a[_0x75d8ce(0x184)]['entries']())),console[_0x75d8ce(0x177)](_0x75d8ce(0x181),_0x4583bb+'ms');const _0x14aae6=await _0xc2c63a[_0x75d8ce(0x16c)]();console['log']('Raw\x20Response\x20Body:',_0x14aae6);if(!_0xc2c63a['ok']){console[_0x75d8ce(0x17b)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x75d8ce(0x17b)](_0x75d8ce(0x14d),_0xc2c63a[_0x75d8ce(0x196)]),console['error'](_0x75d8ce(0x182),_0x14aae6),loggerService_1[_0x75d8ce(0x1b6)][_0x75d8ce(0x187)]('noda',_0x75d8ce(0x158),_0xc2c63a['status'],_0x14aae6,_0x4583bb),loggerService_1[_0x75d8ce(0x1b6)][_0x75d8ce(0x18e)](_0x75d8ce(0x198),_0x75d8ce(0x158),_0x75d8ce(0x146)+_0xc2c63a[_0x75d8ce(0x196)]+':\x20'+_0x14aae6);if(_0xc2c63a[_0x75d8ce(0x196)]===0x190)throw new Error(_0x75d8ce(0x1a8));else{if(_0xc2c63a[_0x75d8ce(0x196)]===0x1f4)throw new Error(_0x75d8ce(0x190));}throw new Error(_0x75d8ce(0x18d)+_0xc2c63a[_0x75d8ce(0x196)]+_0x75d8ce(0x193)+_0x14aae6);}let _0x391ab3;try{_0x391ab3=JSON[_0x75d8ce(0x14a)](_0x14aae6);}catch(_0x5a227b){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x5a227b),loggerService_1['loggerService'][_0x75d8ce(0x18e)](_0x75d8ce(0x198),'/payment-links',_0x75d8ce(0x1b1)+_0x5a227b);throw new Error(_0x75d8ce(0x18b)+_0x14aae6);}console[_0x75d8ce(0x177)](_0x75d8ce(0x1a4)),console[_0x75d8ce(0x177)](_0x75d8ce(0x141),JSON['stringify'](_0x391ab3,null,0x2)),loggerService_1['loggerService'][_0x75d8ce(0x187)](_0x75d8ce(0x198),_0x75d8ce(0x158),_0xc2c63a[_0x75d8ce(0x196)],_0x391ab3,_0x4583bb);if(_0x391ab3[_0x75d8ce(0x17b)]||_0x391ab3[_0x75d8ce(0x194)]){const _0x17e593=_0x391ab3[_0x75d8ce(0x147)]||_0x391ab3[_0x75d8ce(0x17b)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x75d8ce(0x17b)](_0x75d8ce(0x163)),console[_0x75d8ce(0x17b)](_0x75d8ce(0x17a),_0x17e593),console[_0x75d8ce(0x17b)](_0x75d8ce(0x169),_0x391ab3[_0x75d8ce(0x194)]),loggerService_1[_0x75d8ce(0x1b6)][_0x75d8ce(0x18e)]('noda','/payment-links',_0x75d8ce(0x195)+_0x17e593);throw new Error('Noda\x20API\x20error:\x20'+_0x17e593);}if(!_0x391ab3['id']||!_0x391ab3[_0x75d8ce(0x16e)]?.[_0x75d8ce(0x166)]){console[_0x75d8ce(0x17b)](_0x75d8ce(0x1a1)),console[_0x75d8ce(0x17b)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x75d8ce(0x17b)](_0x75d8ce(0x167),_0x391ab3),loggerService_1[_0x75d8ce(0x1b6)][_0x75d8ce(0x18e)]('noda',_0x75d8ce(0x158),_0x75d8ce(0x13f));throw new Error(_0x75d8ce(0x1a2));}return console[_0x75d8ce(0x177)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x75d8ce(0x177)](_0x75d8ce(0x1b4),_0x391ab3['id']),console[_0x75d8ce(0x177)]('Short\x20Link:',_0x391ab3['shortLinkUrls'][_0x75d8ce(0x166)]),console[_0x75d8ce(0x177)](_0x75d8ce(0x171),_0x391ab3[_0x75d8ce(0x16e)]['qrCodeLink']||_0x75d8ce(0x191)),console['log'](_0x75d8ce(0x170),_0x3b8bd4,_0x75d8ce(0x19e)),console[_0x75d8ce(0x177)](_0x75d8ce(0x14e),_0x533a8c),{'gateway_payment_id':_0x391ab3['id'],'payment_url':_0x391ab3[_0x75d8ce(0x16e)][_0x75d8ce(0x166)],'qr_code_url':_0x391ab3[_0x75d8ce(0x16e)]['qrCodeLink'],'expiry_date':_0x391ab3[_0x75d8ce(0x15e)]};}catch(_0x19fbc0){console['error'](_0x75d8ce(0x18f)),console['error'](_0x75d8ce(0x1b2),_0x19fbc0),loggerService_1[_0x75d8ce(0x1b6)][_0x75d8ce(0x18e)]('noda','/payment-links',_0x19fbc0);if(_0x19fbc0 instanceof Error){console[_0x75d8ce(0x17b)](_0x75d8ce(0x152),_0x19fbc0[_0x75d8ce(0x147)]),console[_0x75d8ce(0x17b)](_0x75d8ce(0x13e),_0x19fbc0[_0x75d8ce(0x1a5)]);throw new Error(_0x75d8ce(0x17e)+_0x19fbc0['message']);}throw new Error(_0x75d8ce(0x14f));}}async['verifyPayment'](_0x45cb93){const _0x5eefc8=a43_0xc2cbe6,_0x5d1fd9=Date[_0x5eefc8(0x186)]();try{loggerService_1[_0x5eefc8(0x1b6)][_0x5eefc8(0x155)]('noda',_0x5eefc8(0x179)+_0x45cb93,_0x5eefc8(0x143),{});const _0xb3d5ff=await fetch(this[_0x5eefc8(0x1ad)]+'/'+_0x45cb93,{'method':_0x5eefc8(0x143),'headers':{'Content-Type':'application/json','User-Agent':_0x5eefc8(0x1a0)}}),_0x13ee7b=Date[_0x5eefc8(0x186)]()-_0x5d1fd9;if(!_0xb3d5ff['ok']){const _0x4e9155=await _0xb3d5ff[_0x5eefc8(0x16c)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x5eefc8(0x198),_0x5eefc8(0x179)+_0x45cb93,_0xb3d5ff[_0x5eefc8(0x196)],_0x4e9155,_0x13ee7b);throw new Error('HTTP\x20error!\x20status:\x20'+_0xb3d5ff[_0x5eefc8(0x196)]);}const _0x45ae5c=await _0xb3d5ff[_0x5eefc8(0x148)]();loggerService_1['loggerService'][_0x5eefc8(0x187)](_0x5eefc8(0x198),'/payment-links/'+_0x45cb93,_0xb3d5ff[_0x5eefc8(0x196)],_0x45ae5c,_0x13ee7b);if(_0x45ae5c[_0x5eefc8(0x17b)]||_0x45ae5c[_0x5eefc8(0x194)]){loggerService_1[_0x5eefc8(0x1b6)][_0x5eefc8(0x18e)](_0x5eefc8(0x198),_0x5eefc8(0x179)+_0x45cb93,_0x5eefc8(0x1b0)+(_0x45ae5c[_0x5eefc8(0x147)]||_0x45ae5c[_0x5eefc8(0x17b)]||_0x5eefc8(0x161)));throw new Error(_0x5eefc8(0x1b0)+(_0x45ae5c['message']||_0x45ae5c[_0x5eefc8(0x17b)]||_0x5eefc8(0x161)));}let _0x5617a7=_0x5eefc8(0x192);if(_0x45ae5c['isActive']===![]){if(_0x45ae5c[_0x5eefc8(0x15e)]){const _0x4b7e01=new Date(_0x45ae5c['expiryDate']),_0x25576f=new Date();_0x4b7e01<_0x25576f?_0x5617a7=_0x5eefc8(0x1aa):_0x5617a7=_0x5eefc8(0x1a9);}else _0x5617a7=_0x5eefc8(0x1a9);}else _0x5617a7=_0x5eefc8(0x192);return{'status':_0x5617a7,'amount':_0x45ae5c[_0x5eefc8(0x1a3)],'currency':_0x45ae5c[_0x5eefc8(0x185)],'isActive':_0x45ae5c[_0x5eefc8(0x16f)]};}catch(_0x5218f2){console[_0x5eefc8(0x17b)](_0x5eefc8(0x15c),_0x5218f2),loggerService_1[_0x5eefc8(0x1b6)][_0x5eefc8(0x18e)]('noda',_0x5eefc8(0x179)+_0x45cb93,_0x5218f2);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x5218f2 instanceof Error?_0x5218f2['message']:'Unknown\x20error'));}}async['processWebhook'](_0x325d57){const _0x45f7c4=a43_0xc2cbe6;console['log'](_0x45f7c4(0x188),_0x325d57);let _0x3bff8d=_0x45f7c4(0x192);switch(_0x325d57[_0x45f7c4(0x17c)]?.[_0x45f7c4(0x144)]()){case _0x45f7c4(0x1ae):case _0x45f7c4(0x140):case _0x45f7c4(0x1b7):case _0x45f7c4(0x178):case'successful':_0x325d57[_0x45f7c4(0x183)]===_0x45f7c4(0x156)?_0x3bff8d=_0x45f7c4(0x1b9):_0x3bff8d=_0x45f7c4(0x192);break;case _0x45f7c4(0x16d):case _0x45f7c4(0x164):case _0x45f7c4(0x173):case'error':case _0x45f7c4(0x175):_0x3bff8d=_0x45f7c4(0x1a9);break;case'expired':case _0x45f7c4(0x15b):_0x3bff8d=_0x45f7c4(0x1aa);break;case _0x45f7c4(0x174):case _0x45f7c4(0x197):case _0x45f7c4(0x145):case _0x45f7c4(0x157):case _0x45f7c4(0x1ac):default:_0x3bff8d='PENDING';break;}return{'paymentId':_0x325d57[_0x45f7c4(0x18c)]||_0x325d57['PaymentId'],'status':_0x3bff8d,'amount':_0x325d57['Amount'],'currency':_0x325d57[_0x45f7c4(0x189)],'additionalInfo':{'method':_0x325d57[_0x45f7c4(0x162)],'bankId':_0x325d57[_0x45f7c4(0x180)],'settled':_0x325d57[_0x45f7c4(0x183)],'settlementDate':_0x325d57['SettlementDate'],'remitterName':_0x325d57[_0x45f7c4(0x14b)]?.[_0x45f7c4(0x19a)],'remitterIban':_0x325d57[_0x45f7c4(0x14b)]?.['Iban'],'bankTransactionId':_0x325d57['BankTransactionId']}};}[a43_0xc2cbe6(0x19f)](_0x2ebfe3,_0x21a64e){const _0x5327d2=a43_0xc2cbe6;return console[_0x5327d2(0x177)](_0x5327d2(0x19c),{'receivedSignature':_0x21a64e,'paymentId':_0x2ebfe3[_0x5327d2(0x1a6)],'merchantPaymentId':_0x2ebfe3['MerchantPaymentId']}),!![];}}function a43_0x8aed(_0x552b9c,_0x3c20b5){const _0x6c372d=a43_0x6c37();return a43_0x8aed=function(_0x8aed97,_0x4005d8){_0x8aed97=_0x8aed97-0x13e;let _0x25fecc=_0x6c372d[_0x8aed97];return _0x25fecc;},a43_0x8aed(_0x552b9c,_0x3c20b5);}exports['NodaService']=NodaService;