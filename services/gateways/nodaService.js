'use strict';const a50_0x5e6788=a50_0x16a7;(function(_0x2784cb,_0x2c21bb){const _0x4c90d0=a50_0x16a7,_0xf2f37c=_0x2784cb();while(!![]){try{const _0x1df816=parseInt(_0x4c90d0(0x10f))/0x1*(parseInt(_0x4c90d0(0xa3))/0x2)+-parseInt(_0x4c90d0(0xbd))/0x3*(parseInt(_0x4c90d0(0xee))/0x4)+-parseInt(_0x4c90d0(0xa1))/0x5*(parseInt(_0x4c90d0(0xb2))/0x6)+parseInt(_0x4c90d0(0x103))/0x7+-parseInt(_0x4c90d0(0x10c))/0x8*(parseInt(_0x4c90d0(0xe8))/0x9)+-parseInt(_0x4c90d0(0xb7))/0xa+parseInt(_0x4c90d0(0xa4))/0xb;if(_0x1df816===_0x2c21bb)break;else _0xf2f37c['push'](_0xf2f37c['shift']());}catch(_0x1401cf){_0xf2f37c['push'](_0xf2f37c['shift']());}}}(a50_0x2683,0xf1186));function a50_0x2683(){const _0x18ed99=['===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','active','parse','qrCodeLink','Headers:','MerchantPaymentId','Not\x20provided','PAID','__esModule','createPaymentLink','done','Response\x20data:','/payment-links/','status','Settled','isActive','NodaService','rejected','logWhiteDomainError','EXPIRED','Error\x20details:','HTTP\x20Status:','amount','Iban','Request\x20Body\x20(Direct\x20JSON):','log','processing','shortLinkUrls','Unknown\x20error','153cFKsFt','Method','Raw\x20Response\x20Body:','verifyPayment','Name','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','111660YbXzdu','toLowerCase','stringify','(8digits-8digits\x20format\x20for\x20Noda)','PaymentId','logWhiteDomainResponse','stack','/payment-links','POST','created','Yes','Status\x20Text:','defineProperty','Payment\x20Link\x20ID:','(8digits-8digits\x20format)','cancelled','HTTP\x20error!\x20status:\x20','currency','logWhiteDomainRequest','BankTransactionId','Parsed\x20Result:','9613072yZxtfm','Error\x20message:','verifyWebhookSignature','Noda\x20payment\x20verification\x20error:','statusCode','JSON\x20Parse\x20Error:\x20','in_progress','Status','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','251176TJmEaW','Failed\x20to\x20parse\x20JSON\x20response:','Noda\x20webhook\x20signature\x20verification:','1300qBJiCU','expiryDate','successful','pending','Amount','loggerService','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','GET','https://tesoft.uk/gateway/pending.php?id=','Status\x20Code:','../loggerService','application/json','error','Missing\x20id\x20or\x20shortLink\x20in\x20response','QR\x20Code\x20Link:','315125UjhgVJ','HTTP\x20','638VkhsSp','25300594jHCGsp','apiUrl','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','FAILED','Order\x20ID\x20Used:','now','text','URL:','paid','success','expired','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Order\x20ID\x20Format:','https://tesoft.uk/gateway/noda/webhook/','36xrBORP','Currency','PENDING','shortLink','message','3462350UNjYjS','===\x20NODA\x20API\x20ERROR\x20===','BankId','Processing\x20Noda\x20webhook:',',\x20body:\x20','timeout','198cQwYve','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','TesSoft\x20Payment\x20System/1.0','Noda\x20API\x20error:\x20','failed','canceled','noda','Response\x20Time:','Response\x20Body:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','===\x20NODA\x20SERVICE\x20ERROR\x20===','fromEntries','Remitter'];a50_0x2683=function(){return _0x18ed99;};return a50_0x2683();}Object[a50_0x5e6788(0xfa)](exports,a50_0x5e6788(0xd3),{'value':!![]}),exports[a50_0x5e6788(0xdb)]=void 0x0;const loggerService_1=require(a50_0x5e6788(0x119));function a50_0x16a7(_0x596952,_0x218281){const _0x26838a=a50_0x2683();return a50_0x16a7=function(_0x16a7ee,_0xbcb772){_0x16a7ee=_0x16a7ee-0x9e;let _0x4febd4=_0x26838a[_0x16a7ee];return _0x4febd4;},a50_0x16a7(_0x596952,_0x218281);}class NodaService{constructor(){const _0x54694=a50_0x5e6788;this['apiUrl']='https://tesoft.uk/gateway/noda/',console[_0x54694(0xe4)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a50_0x5e6788(0xd4)](_0x157ac7){const _0x2b00f1=a50_0x5e6788,{orderId:_0x127ca9,name:_0x11d9e6,paymentDescription:_0x2620a8,amount:_0x356c0c,currency:_0x1dccc6,webhookUrl:_0x4a28e6,returnUrl:_0x28cf10,expiryDate:_0x555a85}=_0x157ac7,_0x986d05=_0x1dccc6['toUpperCase'](),_0x2bf9f4=_0x2b00f1(0xb1),_0xaac16e=_0x2b00f1(0x117)+_0x127ca9,_0x477fa4={'name':_0x11d9e6,'paymentDescription':_0x2620a8,'amount':_0x356c0c,'currency':_0x986d05,'paymentId':_0x127ca9,'webhookUrl':_0x2bf9f4,'returnUrl':_0xaac16e};_0x555a85&&(_0x477fa4[_0x2b00f1(0x110)]=_0x555a85);const _0x269cd0=Date[_0x2b00f1(0xa9)]();try{console[_0x2b00f1(0xe4)](_0x2b00f1(0xa6)),console['log'](_0x2b00f1(0xab),this[_0x2b00f1(0xa5)]),console[_0x2b00f1(0xe4)](_0x2b00f1(0xe3),JSON['stringify'](_0x477fa4,null,0x2)),console[_0x2b00f1(0xe4)](_0x2b00f1(0xb0),_0x127ca9,_0x2b00f1(0xf1)),console[_0x2b00f1(0xe4)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0xaac16e),loggerService_1[_0x2b00f1(0x114)]['logWhiteDomainRequest'](_0x2b00f1(0xc3),_0x2b00f1(0xf5),_0x2b00f1(0xf6),_0x477fa4);const _0x227cd1=await fetch(this[_0x2b00f1(0xa5)],{'method':_0x2b00f1(0xf6),'headers':{'Content-Type':_0x2b00f1(0x11a),'Accept':_0x2b00f1(0x11a),'User-Agent':_0x2b00f1(0xbf)},'body':JSON[_0x2b00f1(0xf0)](_0x477fa4)}),_0x2dd97c=Date[_0x2b00f1(0xa9)]()-_0x269cd0;console[_0x2b00f1(0xe4)](_0x2b00f1(0xcb)),console[_0x2b00f1(0xe4)]('Status:',_0x227cd1[_0x2b00f1(0xd8)]),console[_0x2b00f1(0xe4)](_0x2b00f1(0xf9),_0x227cd1['statusText']),console['log'](_0x2b00f1(0xcf),Object[_0x2b00f1(0xc9)](_0x227cd1['headers']['entries']())),console[_0x2b00f1(0xe4)](_0x2b00f1(0xc4),_0x2dd97c+'ms');const _0x29cf93=await _0x227cd1[_0x2b00f1(0xaa)]();console[_0x2b00f1(0xe4)](_0x2b00f1(0xea),_0x29cf93);if(!_0x227cd1['ok']){console[_0x2b00f1(0x9e)](_0x2b00f1(0xb8)),console[_0x2b00f1(0x9e)](_0x2b00f1(0xe0),_0x227cd1[_0x2b00f1(0xd8)]),console[_0x2b00f1(0x9e)](_0x2b00f1(0xc5),_0x29cf93),loggerService_1[_0x2b00f1(0x114)][_0x2b00f1(0xf3)](_0x2b00f1(0xc3),_0x2b00f1(0xf5),_0x227cd1[_0x2b00f1(0xd8)],_0x29cf93,_0x2dd97c),loggerService_1[_0x2b00f1(0x114)][_0x2b00f1(0xdd)](_0x2b00f1(0xc3),_0x2b00f1(0xf5),_0x2b00f1(0xa2)+_0x227cd1[_0x2b00f1(0xd8)]+':\x20'+_0x29cf93);if(_0x227cd1['status']===0x190)throw new Error(_0x2b00f1(0x10b));else{if(_0x227cd1[_0x2b00f1(0xd8)]===0x1f4)throw new Error(_0x2b00f1(0xc7));}throw new Error(_0x2b00f1(0xfe)+_0x227cd1[_0x2b00f1(0xd8)]+_0x2b00f1(0xbb)+_0x29cf93);}let _0x6a2eb5;try{_0x6a2eb5=JSON[_0x2b00f1(0xcd)](_0x29cf93);}catch(_0x1994ff){console[_0x2b00f1(0x9e)](_0x2b00f1(0x10d),_0x1994ff),loggerService_1['loggerService']['logWhiteDomainError'](_0x2b00f1(0xc3),_0x2b00f1(0xf5),_0x2b00f1(0x108)+_0x1994ff);throw new Error(_0x2b00f1(0xc6)+_0x29cf93);}console[_0x2b00f1(0xe4)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x2b00f1(0xe4)](_0x2b00f1(0x102),JSON[_0x2b00f1(0xf0)](_0x6a2eb5,null,0x2)),loggerService_1['loggerService'][_0x2b00f1(0xf3)](_0x2b00f1(0xc3),'/payment-links',_0x227cd1[_0x2b00f1(0xd8)],_0x6a2eb5,_0x2dd97c);if(_0x6a2eb5[_0x2b00f1(0x9e)]||_0x6a2eb5[_0x2b00f1(0x107)]){const _0x263bd0=_0x6a2eb5[_0x2b00f1(0xb6)]||_0x6a2eb5[_0x2b00f1(0x9e)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x2b00f1(0x9e)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x2b00f1(0x9e)]('Error\x20Message:',_0x263bd0),console[_0x2b00f1(0x9e)](_0x2b00f1(0x118),_0x6a2eb5[_0x2b00f1(0x107)]),loggerService_1[_0x2b00f1(0x114)][_0x2b00f1(0xdd)]('noda',_0x2b00f1(0xf5),'Business\x20Error:\x20'+_0x263bd0);throw new Error(_0x2b00f1(0xc0)+_0x263bd0);}if(!_0x6a2eb5['id']||!_0x6a2eb5['shortLinkUrls']?.[_0x2b00f1(0xb5)]){console[_0x2b00f1(0x9e)](_0x2b00f1(0xed)),console[_0x2b00f1(0x9e)](_0x2b00f1(0x9f)),console['error'](_0x2b00f1(0xd6),_0x6a2eb5),loggerService_1['loggerService']['logWhiteDomainError'](_0x2b00f1(0xc3),_0x2b00f1(0xf5),_0x2b00f1(0xbe));throw new Error(_0x2b00f1(0xaf));}return console[_0x2b00f1(0xe4)]('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x2b00f1(0xfb),_0x6a2eb5['id']),console[_0x2b00f1(0xe4)]('Short\x20Link:',_0x6a2eb5[_0x2b00f1(0xe6)]['shortLink']),console[_0x2b00f1(0xe4)](_0x2b00f1(0xa0),_0x6a2eb5[_0x2b00f1(0xe6)][_0x2b00f1(0xce)]||_0x2b00f1(0xd1)),console['log'](_0x2b00f1(0xa8),_0x127ca9,_0x2b00f1(0xfc)),console['log'](_0x2b00f1(0x115),_0xaac16e),{'gateway_payment_id':_0x6a2eb5['id'],'payment_url':_0x6a2eb5[_0x2b00f1(0xe6)]['shortLink'],'qr_code_url':_0x6a2eb5[_0x2b00f1(0xe6)][_0x2b00f1(0xce)],'expiry_date':_0x6a2eb5[_0x2b00f1(0x110)]};}catch(_0x5df498){console['error'](_0x2b00f1(0xc8)),console[_0x2b00f1(0x9e)](_0x2b00f1(0xdf),_0x5df498),loggerService_1[_0x2b00f1(0x114)]['logWhiteDomainError'](_0x2b00f1(0xc3),_0x2b00f1(0xf5),_0x5df498);if(_0x5df498 instanceof Error){console[_0x2b00f1(0x9e)](_0x2b00f1(0x104),_0x5df498[_0x2b00f1(0xb6)]),console[_0x2b00f1(0x9e)]('Error\x20stack:',_0x5df498[_0x2b00f1(0xf4)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x5df498[_0x2b00f1(0xb6)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a50_0x5e6788(0xeb)](_0x1a0e21){const _0x4f73ae=a50_0x5e6788,_0x39dd6f=Date[_0x4f73ae(0xa9)]();try{loggerService_1[_0x4f73ae(0x114)][_0x4f73ae(0x100)](_0x4f73ae(0xc3),_0x4f73ae(0xd7)+_0x1a0e21,_0x4f73ae(0x116),{});const _0x2a68f2=await fetch(this[_0x4f73ae(0xa5)]+'/'+_0x1a0e21,{'method':_0x4f73ae(0x116),'headers':{'Content-Type':'application/json','User-Agent':_0x4f73ae(0xbf)}}),_0x323f1b=Date[_0x4f73ae(0xa9)]()-_0x39dd6f;if(!_0x2a68f2['ok']){const _0x50825d=await _0x2a68f2[_0x4f73ae(0xaa)]();loggerService_1['loggerService'][_0x4f73ae(0xf3)]('noda',_0x4f73ae(0xd7)+_0x1a0e21,_0x2a68f2[_0x4f73ae(0xd8)],_0x50825d,_0x323f1b);throw new Error(_0x4f73ae(0xfe)+_0x2a68f2[_0x4f73ae(0xd8)]);}const _0x630668=await _0x2a68f2['json']();loggerService_1[_0x4f73ae(0x114)]['logWhiteDomainResponse'](_0x4f73ae(0xc3),_0x4f73ae(0xd7)+_0x1a0e21,_0x2a68f2[_0x4f73ae(0xd8)],_0x630668,_0x323f1b);if(_0x630668[_0x4f73ae(0x9e)]||_0x630668[_0x4f73ae(0x107)]){loggerService_1[_0x4f73ae(0x114)][_0x4f73ae(0xdd)]('noda',_0x4f73ae(0xd7)+_0x1a0e21,'Noda\x20API\x20error:\x20'+(_0x630668['message']||_0x630668['error']||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x630668['message']||_0x630668[_0x4f73ae(0x9e)]||_0x4f73ae(0xe7)));}let _0x1087c4=_0x4f73ae(0xb4);if(_0x630668[_0x4f73ae(0xda)]===![]){if(_0x630668[_0x4f73ae(0x110)]){const _0x18d2e0=new Date(_0x630668[_0x4f73ae(0x110)]),_0x5646a0=new Date();_0x18d2e0<_0x5646a0?_0x1087c4=_0x4f73ae(0xde):_0x1087c4='FAILED';}else _0x1087c4=_0x4f73ae(0xa7);}else _0x1087c4=_0x4f73ae(0xb4);return{'status':_0x1087c4,'amount':_0x630668[_0x4f73ae(0xe1)],'currency':_0x630668[_0x4f73ae(0xff)],'isActive':_0x630668[_0x4f73ae(0xda)]};}catch(_0x517b8d){console[_0x4f73ae(0x9e)](_0x4f73ae(0x106),_0x517b8d),loggerService_1[_0x4f73ae(0x114)][_0x4f73ae(0xdd)]('noda','/payment-links/'+_0x1a0e21,_0x517b8d);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x517b8d instanceof Error?_0x517b8d[_0x4f73ae(0xb6)]:'Unknown\x20error'));}}async['processWebhook'](_0x2da55a){const _0x43b000=a50_0x5e6788;console['log'](_0x43b000(0xba),_0x2da55a);let _0x381378=_0x43b000(0xb4);switch(_0x2da55a[_0x43b000(0x10a)]?.[_0x43b000(0xef)]()){case _0x43b000(0xd5):case'completed':case _0x43b000(0xac):case _0x43b000(0xad):case _0x43b000(0x111):_0x2da55a[_0x43b000(0xd9)]===_0x43b000(0xf8)?_0x381378=_0x43b000(0xd2):_0x381378='PENDING';break;case _0x43b000(0xfd):case _0x43b000(0xc2):case _0x43b000(0xc1):case _0x43b000(0x9e):case _0x43b000(0xdc):_0x381378='FAILED';break;case _0x43b000(0xae):case _0x43b000(0xbc):_0x381378=_0x43b000(0xde);break;case _0x43b000(0x112):case _0x43b000(0xf7):case _0x43b000(0xcc):case _0x43b000(0xe5):case _0x43b000(0x109):default:_0x381378=_0x43b000(0xb4);break;}return{'paymentId':_0x2da55a[_0x43b000(0xd0)]||_0x2da55a[_0x43b000(0xf2)],'status':_0x381378,'amount':_0x2da55a[_0x43b000(0x113)],'currency':_0x2da55a[_0x43b000(0xb3)],'additionalInfo':{'method':_0x2da55a[_0x43b000(0xe9)],'bankId':_0x2da55a[_0x43b000(0xb9)],'settled':_0x2da55a[_0x43b000(0xd9)],'settlementDate':_0x2da55a['SettlementDate'],'remitterName':_0x2da55a[_0x43b000(0xca)]?.[_0x43b000(0xec)],'remitterIban':_0x2da55a[_0x43b000(0xca)]?.[_0x43b000(0xe2)],'bankTransactionId':_0x2da55a[_0x43b000(0x101)]}};}[a50_0x5e6788(0x105)](_0x5f5a98,_0xa424c8){const _0x39d2bd=a50_0x5e6788;return console[_0x39d2bd(0xe4)](_0x39d2bd(0x10e),{'receivedSignature':_0xa424c8,'paymentId':_0x5f5a98[_0x39d2bd(0xf2)],'merchantPaymentId':_0x5f5a98[_0x39d2bd(0xd0)]}),!![];}}exports['NodaService']=NodaService;