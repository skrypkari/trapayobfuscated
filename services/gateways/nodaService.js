'use strict';const a43_0x476fcb=a43_0x5dfc;function a43_0x5dfc(_0x4d7738,_0x1367ca){const _0xb0f14e=a43_0xb0f1();return a43_0x5dfc=function(_0x5dfce7,_0x34b4a1){_0x5dfce7=_0x5dfce7-0x1ea;let _0x2fcbc1=_0xb0f14e[_0x5dfce7];return _0x2fcbc1;},a43_0x5dfc(_0x4d7738,_0x1367ca);}(function(_0x507f67,_0x279438){const _0x3cc4f4=a43_0x5dfc,_0x32c7e3=_0x507f67();while(!![]){try{const _0x524621=parseInt(_0x3cc4f4(0x21c))/0x1*(parseInt(_0x3cc4f4(0x1f1))/0x2)+parseInt(_0x3cc4f4(0x23a))/0x3*(-parseInt(_0x3cc4f4(0x208))/0x4)+parseInt(_0x3cc4f4(0x244))/0x5+parseInt(_0x3cc4f4(0x24c))/0x6*(parseInt(_0x3cc4f4(0x1ff))/0x7)+parseInt(_0x3cc4f4(0x241))/0x8*(-parseInt(_0x3cc4f4(0x23b))/0x9)+parseInt(_0x3cc4f4(0x204))/0xa+parseInt(_0x3cc4f4(0x215))/0xb*(parseInt(_0x3cc4f4(0x233))/0xc);if(_0x524621===_0x279438)break;else _0x32c7e3['push'](_0x32c7e3['shift']());}catch(_0x284d54){_0x32c7e3['push'](_0x32c7e3['shift']());}}}(a43_0xb0f1,0x5a2fa));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a43_0x476fcb(0x1f0)]=void 0x0;const loggerService_1=require(a43_0x476fcb(0x203));class NodaService{constructor(){const _0xc662cf=a43_0x476fcb;this['apiUrl']=_0xc662cf(0x22d),console['log'](_0xc662cf(0x249));}async[a43_0x476fcb(0x269)](_0x1137b6){const _0x541d71=a43_0x476fcb,{orderId:_0x39f687,name:_0x5288f8,paymentDescription:_0x14b2da,amount:_0x15501f,currency:_0xdb525a,webhookUrl:_0x4f6fef,returnUrl:_0x92f128,expiryDate:_0x27bb2d}=_0x1137b6,_0x57c4c8=_0xdb525a[_0x541d71(0x1fe)](),_0x313965=_0x541d71(0x209),_0x163bed='https://tesoft.uk/gateway/pending.php?id='+_0x39f687,_0x9c30c1={'name':_0x5288f8,'paymentDescription':_0x14b2da,'amount':_0x15501f,'currency':_0x57c4c8,'paymentId':_0x39f687,'webhookUrl':_0x313965,'returnUrl':_0x163bed};_0x27bb2d&&(_0x9c30c1['expiryDate']=_0x27bb2d);const _0x205212=Date[_0x541d71(0x20d)]();try{console[_0x541d71(0x1f7)](_0x541d71(0x222)),console['log'](_0x541d71(0x205),this[_0x541d71(0x246)]),console[_0x541d71(0x1f7)](_0x541d71(0x22e),JSON[_0x541d71(0x268)](_0x9c30c1,null,0x2)),console[_0x541d71(0x1f7)](_0x541d71(0x20f),_0x39f687,_0x541d71(0x238)),console['log'](_0x541d71(0x254),_0x163bed),loggerService_1[_0x541d71(0x221)][_0x541d71(0x23c)](_0x541d71(0x24a),_0x541d71(0x255),_0x541d71(0x250),_0x9c30c1);const _0x3f1077=await fetch(this[_0x541d71(0x246)],{'method':'POST','headers':{'Content-Type':_0x541d71(0x216),'Accept':_0x541d71(0x216),'User-Agent':_0x541d71(0x24b)},'body':JSON[_0x541d71(0x268)](_0x9c30c1)}),_0x137054=Date[_0x541d71(0x20d)]()-_0x205212;console[_0x541d71(0x1f7)](_0x541d71(0x1ef)),console[_0x541d71(0x1f7)](_0x541d71(0x243),_0x3f1077[_0x541d71(0x1f6)]),console[_0x541d71(0x1f7)](_0x541d71(0x259),_0x3f1077['statusText']),console[_0x541d71(0x1f7)](_0x541d71(0x22f),Object[_0x541d71(0x257)](_0x3f1077[_0x541d71(0x26d)][_0x541d71(0x200)]())),console[_0x541d71(0x1f7)]('Response\x20Time:',_0x137054+'ms');const _0x3d7473=await _0x3f1077[_0x541d71(0x206)]();console[_0x541d71(0x1f7)](_0x541d71(0x258),_0x3d7473);if(!_0x3f1077['ok']){console[_0x541d71(0x23f)](_0x541d71(0x262)),console[_0x541d71(0x23f)](_0x541d71(0x256),_0x3f1077[_0x541d71(0x1f6)]),console[_0x541d71(0x23f)](_0x541d71(0x240),_0x3d7473),loggerService_1[_0x541d71(0x221)][_0x541d71(0x24d)](_0x541d71(0x24a),_0x541d71(0x255),_0x3f1077[_0x541d71(0x1f6)],_0x3d7473,_0x137054),loggerService_1['loggerService'][_0x541d71(0x247)]('noda',_0x541d71(0x255),_0x541d71(0x25f)+_0x3f1077[_0x541d71(0x1f6)]+':\x20'+_0x3d7473);if(_0x3f1077[_0x541d71(0x1f6)]===0x190)throw new Error(_0x541d71(0x21a));else{if(_0x3f1077['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x541d71(0x234)+_0x3f1077['status']+_0x541d71(0x217)+_0x3d7473);}let _0x3540d3;try{_0x3540d3=JSON[_0x541d71(0x1fb)](_0x3d7473);}catch(_0x2ecd57){console['error'](_0x541d71(0x253),_0x2ecd57),loggerService_1[_0x541d71(0x221)][_0x541d71(0x247)](_0x541d71(0x24a),_0x541d71(0x255),_0x541d71(0x230)+_0x2ecd57);throw new Error(_0x541d71(0x22c)+_0x3d7473);}console['log'](_0x541d71(0x226)),console['log'](_0x541d71(0x1f5),JSON[_0x541d71(0x268)](_0x3540d3,null,0x2)),loggerService_1[_0x541d71(0x221)][_0x541d71(0x24d)](_0x541d71(0x24a),_0x541d71(0x255),_0x3f1077[_0x541d71(0x1f6)],_0x3540d3,_0x137054);if(_0x3540d3[_0x541d71(0x23f)]||_0x3540d3['statusCode']){const _0x5b4a2b=_0x3540d3[_0x541d71(0x242)]||_0x3540d3[_0x541d71(0x23f)]||_0x541d71(0x1fa);console[_0x541d71(0x23f)](_0x541d71(0x214)),console[_0x541d71(0x23f)]('Error\x20Message:',_0x5b4a2b),console[_0x541d71(0x23f)](_0x541d71(0x1ee),_0x3540d3[_0x541d71(0x267)]),loggerService_1[_0x541d71(0x221)]['logWhiteDomainError'](_0x541d71(0x24a),'/payment-links',_0x541d71(0x201)+_0x5b4a2b);throw new Error(_0x541d71(0x263)+_0x5b4a2b);}if(!_0x3540d3['id']||!_0x3540d3[_0x541d71(0x1f4)]?.[_0x541d71(0x229)]){console[_0x541d71(0x23f)](_0x541d71(0x1f3)),console['error'](_0x541d71(0x1f9)),console['error'](_0x541d71(0x266),_0x3540d3),loggerService_1[_0x541d71(0x221)][_0x541d71(0x247)]('noda',_0x541d71(0x255),_0x541d71(0x212));throw new Error(_0x541d71(0x25b));}return console['log'](_0x541d71(0x26a)),console[_0x541d71(0x1f7)](_0x541d71(0x248),_0x3540d3['id']),console['log'](_0x541d71(0x227),_0x3540d3[_0x541d71(0x1f4)][_0x541d71(0x229)]),console[_0x541d71(0x1f7)]('QR\x20Code\x20Link:',_0x3540d3['shortLinkUrls'][_0x541d71(0x239)]||_0x541d71(0x1fc)),console['log']('Order\x20ID\x20Used:',_0x39f687,_0x541d71(0x220)),console[_0x541d71(0x1f7)]('✅\x20Return\x20URL\x20configured\x20for\x20pending:',_0x163bed),{'gateway_payment_id':_0x3540d3['id'],'payment_url':_0x3540d3[_0x541d71(0x1f4)]['shortLink'],'qr_code_url':_0x3540d3[_0x541d71(0x1f4)][_0x541d71(0x239)],'expiry_date':_0x3540d3['expiryDate']};}catch(_0x5d6bfb){console[_0x541d71(0x23f)](_0x541d71(0x211)),console['error'](_0x541d71(0x26b),_0x5d6bfb),loggerService_1[_0x541d71(0x221)][_0x541d71(0x247)](_0x541d71(0x24a),_0x541d71(0x255),_0x5d6bfb);if(_0x5d6bfb instanceof Error){console[_0x541d71(0x23f)](_0x541d71(0x236),_0x5d6bfb[_0x541d71(0x242)]),console[_0x541d71(0x23f)](_0x541d71(0x26c),_0x5d6bfb[_0x541d71(0x261)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x5d6bfb[_0x541d71(0x242)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x476fcb(0x21f)](_0x2c84de){const _0x5d388f=a43_0x476fcb,_0x115421=Date[_0x5d388f(0x20d)]();try{loggerService_1[_0x5d388f(0x221)][_0x5d388f(0x23c)](_0x5d388f(0x24a),_0x5d388f(0x218)+_0x2c84de,_0x5d388f(0x23e),{});const _0xa6554f=await fetch(this[_0x5d388f(0x246)]+'/'+_0x2c84de,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x5d388f(0x24b)}}),_0x29493b=Date[_0x5d388f(0x20d)]()-_0x115421;if(!_0xa6554f['ok']){const _0x3a7ecc=await _0xa6554f[_0x5d388f(0x206)]();loggerService_1[_0x5d388f(0x221)][_0x5d388f(0x24d)](_0x5d388f(0x24a),_0x5d388f(0x218)+_0x2c84de,_0xa6554f[_0x5d388f(0x1f6)],_0x3a7ecc,_0x29493b);throw new Error(_0x5d388f(0x234)+_0xa6554f[_0x5d388f(0x1f6)]);}const _0x3ae540=await _0xa6554f['json']();loggerService_1['loggerService'][_0x5d388f(0x24d)](_0x5d388f(0x24a),_0x5d388f(0x218)+_0x2c84de,_0xa6554f[_0x5d388f(0x1f6)],_0x3ae540,_0x29493b);if(_0x3ae540['error']||_0x3ae540[_0x5d388f(0x267)]){loggerService_1[_0x5d388f(0x221)][_0x5d388f(0x247)](_0x5d388f(0x24a),_0x5d388f(0x218)+_0x2c84de,'Noda\x20API\x20error:\x20'+(_0x3ae540[_0x5d388f(0x242)]||_0x3ae540[_0x5d388f(0x23f)]||_0x5d388f(0x21d)));throw new Error(_0x5d388f(0x263)+(_0x3ae540[_0x5d388f(0x242)]||_0x3ae540[_0x5d388f(0x23f)]||_0x5d388f(0x21d)));}let _0x3a8513=_0x5d388f(0x219);if(_0x3ae540['isActive']===![]){if(_0x3ae540[_0x5d388f(0x21b)]){const _0x1a5c67=new Date(_0x3ae540[_0x5d388f(0x21b)]),_0x47691e=new Date();_0x1a5c67<_0x47691e?_0x3a8513=_0x5d388f(0x231):_0x3a8513='FAILED';}else _0x3a8513=_0x5d388f(0x25e);}else _0x3a8513=_0x5d388f(0x219);return{'status':_0x3a8513,'amount':_0x3ae540[_0x5d388f(0x202)],'currency':_0x3ae540[_0x5d388f(0x264)],'isActive':_0x3ae540[_0x5d388f(0x224)]};}catch(_0x332395){console['error']('Noda\x20payment\x20verification\x20error:',_0x332395),loggerService_1['loggerService']['logWhiteDomainError'](_0x5d388f(0x24a),_0x5d388f(0x218)+_0x2c84de,_0x332395);throw new Error(_0x5d388f(0x225)+(_0x332395 instanceof Error?_0x332395['message']:_0x5d388f(0x21d)));}}async[a43_0x476fcb(0x20c)](_0x2bfb91){const _0x544d5d=a43_0x476fcb;console[_0x544d5d(0x1f7)]('Processing\x20Noda\x20webhook:',_0x2bfb91);let _0x2d8836=_0x544d5d(0x219);switch(_0x2bfb91[_0x544d5d(0x237)]?.[_0x544d5d(0x25c)]()){case _0x544d5d(0x23d):case _0x544d5d(0x20e):case _0x544d5d(0x24e):case _0x544d5d(0x1ed):case'successful':_0x2bfb91['Settled']===_0x544d5d(0x22a)?_0x2d8836=_0x544d5d(0x251):_0x2d8836=_0x544d5d(0x219);break;case _0x544d5d(0x1fd):case _0x544d5d(0x1ea):case _0x544d5d(0x260):case _0x544d5d(0x23f):case _0x544d5d(0x232):_0x2d8836=_0x544d5d(0x25e);break;case _0x544d5d(0x1ec):case _0x544d5d(0x1eb):_0x2d8836='EXPIRED';break;case _0x544d5d(0x235):case _0x544d5d(0x25d):case _0x544d5d(0x1f2):case _0x544d5d(0x22b):case _0x544d5d(0x265):default:_0x2d8836=_0x544d5d(0x219);break;}return{'paymentId':_0x2bfb91[_0x544d5d(0x228)]||_0x2bfb91['PaymentId'],'status':_0x2d8836,'amount':_0x2bfb91[_0x544d5d(0x245)],'currency':_0x2bfb91['Currency'],'additionalInfo':{'method':_0x2bfb91[_0x544d5d(0x20b)],'bankId':_0x2bfb91[_0x544d5d(0x213)],'settled':_0x2bfb91[_0x544d5d(0x223)],'settlementDate':_0x2bfb91[_0x544d5d(0x21e)],'remitterName':_0x2bfb91[_0x544d5d(0x252)]?.[_0x544d5d(0x20a)],'remitterIban':_0x2bfb91[_0x544d5d(0x252)]?.[_0x544d5d(0x1f8)],'bankTransactionId':_0x2bfb91[_0x544d5d(0x25a)]}};}[a43_0x476fcb(0x24f)](_0x173d84,_0x4b9508){const _0x1f6555=a43_0x476fcb;return console['log'](_0x1f6555(0x210),{'receivedSignature':_0x4b9508,'paymentId':_0x173d84[_0x1f6555(0x207)],'merchantPaymentId':_0x173d84['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;function a43_0xb0f1(){const _0x35267a=['3FIisgy','9ZnOcMq','logWhiteDomainRequest','done','GET','error','Response\x20Body:','1854264uDswRV','message','Status:','1707970PAVwDe','Amount','apiUrl','logWhiteDomainError','Payment\x20Link\x20ID:','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','noda','TesSoft\x20Payment\x20System/1.0','6sPDHhN','logWhiteDomainResponse','paid','verifyWebhookSignature','POST','PAID','Remitter','Failed\x20to\x20parse\x20JSON\x20response:','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','/payment-links','HTTP\x20Status:','fromEntries','Raw\x20Response\x20Body:','Status\x20Text:','BankTransactionId','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','toLowerCase','created','FAILED','HTTP\x20','failed','stack','===\x20NODA\x20API\x20ERROR\x20===','Noda\x20API\x20error:\x20','currency','in_progress','Response\x20data:','statusCode','stringify','createPaymentLink','===\x20NODA\x20SUCCESS\x20===','Error\x20details:','Error\x20stack:','headers','canceled','timeout','expired','success','Status\x20Code:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','NodaService','2WNbuvQ','active','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','shortLinkUrls','Parsed\x20Result:','status','log','Iban','Missing\x20id\x20or\x20shortLink\x20in\x20response','Unknown\x20error\x20from\x20Noda\x20API','parse','Not\x20provided','cancelled','toUpperCase','52661FEutiF','entries','Business\x20Error:\x20','amount','../loggerService','5102550yiOMBw','URL:','text','PaymentId','2051024NMIPAG','https://tesoft.uk/gateway/noda/webhook/','Name','Method','processWebhook','now','completed','Order\x20ID\x20Format:','Noda\x20webhook\x20signature\x20verification:','===\x20NODA\x20SERVICE\x20ERROR\x20===','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','BankId','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','572MDHRqU','application/json',',\x20body:\x20','/payment-links/','PENDING','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','expiryDate','135697IDlRGX','Unknown\x20error','SettlementDate','verifyPayment','(8digits-8digits\x20format)','loggerService','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Settled','isActive','Failed\x20to\x20verify\x20Noda\x20payment:\x20','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Short\x20Link:','MerchantPaymentId','shortLink','Yes','processing','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','https://tesoft.uk/gateway/noda/','Request\x20Body\x20(Direct\x20JSON):','Headers:','JSON\x20Parse\x20Error:\x20','EXPIRED','rejected','27432qmWWjg','HTTP\x20error!\x20status:\x20','pending','Error\x20message:','Status','(8digits-8digits\x20format\x20for\x20Noda)','qrCodeLink'];a43_0xb0f1=function(){return _0x35267a;};return a43_0xb0f1();}