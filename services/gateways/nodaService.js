'use strict';const a46_0x1cf42e=a46_0x252a;(function(_0x135f17,_0x45af69){const _0x3e2b01=a46_0x252a,_0x1c410f=_0x135f17();while(!![]){try{const _0x4f6c27=parseInt(_0x3e2b01(0xc9))/0x1+-parseInt(_0x3e2b01(0xbe))/0x2*(parseInt(_0x3e2b01(0xba))/0x3)+parseInt(_0x3e2b01(0xd8))/0x4+-parseInt(_0x3e2b01(0xae))/0x5*(-parseInt(_0x3e2b01(0x101))/0x6)+parseInt(_0x3e2b01(0xb3))/0x7+parseInt(_0x3e2b01(0xd4))/0x8+parseInt(_0x3e2b01(0xc4))/0x9*(-parseInt(_0x3e2b01(0xf0))/0xa);if(_0x4f6c27===_0x45af69)break;else _0x1c410f['push'](_0x1c410f['shift']());}catch(_0x1fa1f3){_0x1c410f['push'](_0x1c410f['shift']());}}}(a46_0x4926,0x41dbc));function a46_0x252a(_0x57bc1a,_0x2391a6){const _0x4926a9=a46_0x4926();return a46_0x252a=function(_0x252a11,_0x25931d){_0x252a11=_0x252a11-0x91;let _0x534d9f=_0x4926a9[_0x252a11];return _0x534d9f;},a46_0x252a(_0x57bc1a,_0x2391a6);}function a46_0x4926(){const _0x312b2f=['Amount','PENDING','14nmgvmY','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','BankTransactionId','defineProperty','EXPIRED','qrCodeLink','1935kuzSpX','__esModule','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','stringify','entries','448413TXbxWx','Status\x20Code:','Raw\x20Response\x20Body:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','headers','error','/payment-links/','logWhiteDomainResponse','amount','statusText','parse','2267464wLaMFP','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','text','897628BNtrQp','shortLink','created','Settled','SettlementDate','Status\x20Text:','MerchantPaymentId','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','paid','HTTP\x20error!\x20status:\x20','Order\x20ID\x20Format:','Headers:','currency','Response\x20data:','https://tesoft.uk/gateway/noda/','Unknown\x20error\x20from\x20Noda\x20API','Unknown\x20error',',\x20body:\x20','stack','logWhiteDomainRequest','JSON\x20Parse\x20Error:\x20','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','TesSoft\x20Payment\x20System/1.0','30980TiJbCo','expiryDate','Request\x20Body\x20(Direct\x20JSON):','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Payment\x20Link\x20ID:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','application/json','Error\x20message:','status','QR\x20Code\x20Link:','Parsed\x20Result:','Remitter','log','Yes','NodaService','processWebhook','240xCnqIm','message','Status','HTTP\x20Status:','PaymentId','Business\x20Error:\x20','(8digits-8digits\x20format)','Error\x20stack:','===\x20NODA\x20SUCCESS\x20===','Noda\x20payment\x20verification\x20error:','===\x20NODA\x20API\x20ERROR\x20===','PAID','===\x20NODA\x20SERVICE\x20ERROR\x20===','shortLinkUrls','Response\x20Body:','loggerService','GET','pending','completed','Short\x20Link:','/payment-links','in_progress','https://tesoft.uk/gateway/noda/webhook/','successful','toLowerCase','https://tesoft.uk/gateway/pending.php?id=','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','canceled','Failed\x20to\x20parse\x20JSON\x20response:','noda','logWhiteDomainError','Currency','Error\x20Message:','apiUrl','Status:','createPaymentLink','toUpperCase','Noda\x20API\x20error:\x20','40595ZvuFIm','expired','cancelled','now','isActive','1244334QWjiiM','Response\x20Time:','success','Name','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','BankId','POST','224121zPGPmP','statusCode'];a46_0x4926=function(){return _0x312b2f;};return a46_0x4926();}Object[a46_0x1cf42e(0xc1)](exports,a46_0x1cf42e(0xc5),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x26a8b5=a46_0x1cf42e;this['apiUrl']=_0x26a8b5(0xe7),console[_0x26a8b5(0xfd)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a46_0x1cf42e(0xab)](_0x352abd){const _0x3e2ae8=a46_0x1cf42e,{orderId:_0x2cb4c0,name:_0x267724,paymentDescription:_0x15e897,amount:_0x5b8bb4,currency:_0x484ac6,webhookUrl:_0x8b4cee,returnUrl:_0x311e1b,expiryDate:_0x3080ff}=_0x352abd,_0x5e7355=_0x484ac6[_0x3e2ae8(0xac)](),_0x63cd6f=_0x3e2ae8(0x9e),_0x3ca5f3=_0x3e2ae8(0xa1)+_0x2cb4c0,_0x285249={'name':_0x267724,'paymentDescription':_0x15e897,'amount':_0x5b8bb4,'currency':_0x5e7355,'paymentId':_0x2cb4c0,'webhookUrl':_0x63cd6f,'returnUrl':_0x3ca5f3};_0x3080ff&&(_0x285249[_0x3e2ae8(0xf1)]=_0x3080ff);const _0x32091d=Date['now']();try{console['log'](_0x3e2ae8(0xc6)),console[_0x3e2ae8(0xfd)]('URL:',this[_0x3e2ae8(0xa9)]),console['log'](_0x3e2ae8(0xf2),JSON[_0x3e2ae8(0xc7)](_0x285249,null,0x2)),console[_0x3e2ae8(0xfd)](_0x3e2ae8(0xe3),_0x2cb4c0,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x3e2ae8(0xfd)](_0x3e2ae8(0xe0),_0x3ca5f3),loggerService_1[_0x3e2ae8(0x97)][_0x3e2ae8(0xec)](_0x3e2ae8(0xa5),_0x3e2ae8(0x9c),_0x3e2ae8(0xb9),_0x285249);const _0x4d9ff1=await fetch(this[_0x3e2ae8(0xa9)],{'method':_0x3e2ae8(0xb9),'headers':{'Content-Type':_0x3e2ae8(0xf7),'Accept':'application/json','User-Agent':_0x3e2ae8(0xef)},'body':JSON[_0x3e2ae8(0xc7)](_0x285249)}),_0xed86ae=Date[_0x3e2ae8(0xb1)]()-_0x32091d;console[_0x3e2ae8(0xfd)](_0x3e2ae8(0xb7)),console[_0x3e2ae8(0xfd)](_0x3e2ae8(0xaa),_0x4d9ff1[_0x3e2ae8(0xf9)]),console[_0x3e2ae8(0xfd)](_0x3e2ae8(0xdd),_0x4d9ff1[_0x3e2ae8(0xd2)]),console['log'](_0x3e2ae8(0xe4),Object['fromEntries'](_0x4d9ff1[_0x3e2ae8(0xcd)][_0x3e2ae8(0xc8)]())),console['log'](_0x3e2ae8(0xb4),_0xed86ae+'ms');const _0x4ebff1=await _0x4d9ff1['text']();console[_0x3e2ae8(0xfd)](_0x3e2ae8(0xcb),_0x4ebff1);if(!_0x4d9ff1['ok']){console[_0x3e2ae8(0xce)](_0x3e2ae8(0x92)),console[_0x3e2ae8(0xce)](_0x3e2ae8(0x104),_0x4d9ff1[_0x3e2ae8(0xf9)]),console['error'](_0x3e2ae8(0x96),_0x4ebff1),loggerService_1[_0x3e2ae8(0x97)][_0x3e2ae8(0xd0)](_0x3e2ae8(0xa5),_0x3e2ae8(0x9c),_0x4d9ff1['status'],_0x4ebff1,_0xed86ae),loggerService_1['loggerService'][_0x3e2ae8(0xa6)](_0x3e2ae8(0xa5),_0x3e2ae8(0x9c),'HTTP\x20'+_0x4d9ff1[_0x3e2ae8(0xf9)]+':\x20'+_0x4ebff1);if(_0x4d9ff1[_0x3e2ae8(0xf9)]===0x190)throw new Error(_0x3e2ae8(0xf3));else{if(_0x4d9ff1[_0x3e2ae8(0xf9)]===0x1f4)throw new Error(_0x3e2ae8(0xbf));}throw new Error(_0x3e2ae8(0xe2)+_0x4d9ff1['status']+_0x3e2ae8(0xea)+_0x4ebff1);}let _0x5ee1b5;try{_0x5ee1b5=JSON[_0x3e2ae8(0xd3)](_0x4ebff1);}catch(_0x1190bf){console[_0x3e2ae8(0xce)](_0x3e2ae8(0xa4),_0x1190bf),loggerService_1[_0x3e2ae8(0x97)][_0x3e2ae8(0xa6)](_0x3e2ae8(0xa5),_0x3e2ae8(0x9c),_0x3e2ae8(0xed)+_0x1190bf);throw new Error(_0x3e2ae8(0xd5)+_0x4ebff1);}console['log'](_0x3e2ae8(0xcc)),console['log'](_0x3e2ae8(0xfb),JSON[_0x3e2ae8(0xc7)](_0x5ee1b5,null,0x2)),loggerService_1[_0x3e2ae8(0x97)]['logWhiteDomainResponse'](_0x3e2ae8(0xa5),_0x3e2ae8(0x9c),_0x4d9ff1[_0x3e2ae8(0xf9)],_0x5ee1b5,_0xed86ae);if(_0x5ee1b5[_0x3e2ae8(0xce)]||_0x5ee1b5[_0x3e2ae8(0xbb)]){const _0x1f88b3=_0x5ee1b5[_0x3e2ae8(0x102)]||_0x5ee1b5[_0x3e2ae8(0xce)]||_0x3e2ae8(0xe8);console['error'](_0x3e2ae8(0xee)),console[_0x3e2ae8(0xce)](_0x3e2ae8(0xa8),_0x1f88b3),console[_0x3e2ae8(0xce)](_0x3e2ae8(0xca),_0x5ee1b5['statusCode']),loggerService_1[_0x3e2ae8(0x97)][_0x3e2ae8(0xa6)](_0x3e2ae8(0xa5),_0x3e2ae8(0x9c),_0x3e2ae8(0x106)+_0x1f88b3);throw new Error(_0x3e2ae8(0xad)+_0x1f88b3);}if(!_0x5ee1b5['id']||!_0x5ee1b5[_0x3e2ae8(0x95)]?.['shortLink']){console['error'](_0x3e2ae8(0xf6)),console[_0x3e2ae8(0xce)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console['error'](_0x3e2ae8(0xe6),_0x5ee1b5),loggerService_1[_0x3e2ae8(0x97)][_0x3e2ae8(0xa6)](_0x3e2ae8(0xa5),_0x3e2ae8(0x9c),_0x3e2ae8(0xa2));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x3e2ae8(0xfd)](_0x3e2ae8(0x109)),console['log'](_0x3e2ae8(0xf5),_0x5ee1b5['id']),console[_0x3e2ae8(0xfd)](_0x3e2ae8(0x9b),_0x5ee1b5[_0x3e2ae8(0x95)][_0x3e2ae8(0xd9)]),console[_0x3e2ae8(0xfd)](_0x3e2ae8(0xfa),_0x5ee1b5[_0x3e2ae8(0x95)][_0x3e2ae8(0xc3)]||'Not\x20provided'),console[_0x3e2ae8(0xfd)]('Order\x20ID\x20Used:',_0x2cb4c0,_0x3e2ae8(0x107)),console[_0x3e2ae8(0xfd)](_0x3e2ae8(0xdf),_0x3ca5f3),{'gateway_payment_id':_0x5ee1b5['id'],'payment_url':_0x5ee1b5['shortLinkUrls']['shortLink'],'qr_code_url':_0x5ee1b5[_0x3e2ae8(0x95)][_0x3e2ae8(0xc3)],'expiry_date':_0x5ee1b5[_0x3e2ae8(0xf1)]};}catch(_0x25597b){console[_0x3e2ae8(0xce)](_0x3e2ae8(0x94)),console[_0x3e2ae8(0xce)]('Error\x20details:',_0x25597b),loggerService_1[_0x3e2ae8(0x97)][_0x3e2ae8(0xa6)](_0x3e2ae8(0xa5),_0x3e2ae8(0x9c),_0x25597b);if(_0x25597b instanceof Error){console[_0x3e2ae8(0xce)](_0x3e2ae8(0xf8),_0x25597b[_0x3e2ae8(0x102)]),console['error'](_0x3e2ae8(0x108),_0x25597b[_0x3e2ae8(0xeb)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x25597b[_0x3e2ae8(0x102)]);}throw new Error(_0x3e2ae8(0xd6));}}async['verifyPayment'](_0x1d89b7){const _0x474526=a46_0x1cf42e,_0x2baab3=Date[_0x474526(0xb1)]();try{loggerService_1[_0x474526(0x97)][_0x474526(0xec)](_0x474526(0xa5),_0x474526(0xcf)+_0x1d89b7,'GET',{});const _0x1bc200=await fetch(this[_0x474526(0xa9)]+'/'+_0x1d89b7,{'method':_0x474526(0x98),'headers':{'Content-Type':_0x474526(0xf7),'User-Agent':_0x474526(0xef)}}),_0x4f1ebb=Date['now']()-_0x2baab3;if(!_0x1bc200['ok']){const _0x2a57dc=await _0x1bc200[_0x474526(0xd7)]();loggerService_1[_0x474526(0x97)][_0x474526(0xd0)]('noda',_0x474526(0xcf)+_0x1d89b7,_0x1bc200[_0x474526(0xf9)],_0x2a57dc,_0x4f1ebb);throw new Error(_0x474526(0xe2)+_0x1bc200['status']);}const _0x5606e7=await _0x1bc200['json']();loggerService_1[_0x474526(0x97)][_0x474526(0xd0)](_0x474526(0xa5),'/payment-links/'+_0x1d89b7,_0x1bc200[_0x474526(0xf9)],_0x5606e7,_0x4f1ebb);if(_0x5606e7['error']||_0x5606e7['statusCode']){loggerService_1['loggerService'][_0x474526(0xa6)]('noda',_0x474526(0xcf)+_0x1d89b7,_0x474526(0xad)+(_0x5606e7[_0x474526(0x102)]||_0x5606e7[_0x474526(0xce)]||'Unknown\x20error'));throw new Error(_0x474526(0xad)+(_0x5606e7[_0x474526(0x102)]||_0x5606e7[_0x474526(0xce)]||_0x474526(0xe9)));}let _0x5874c0=_0x474526(0xbd);if(_0x5606e7['isActive']===![]){if(_0x5606e7[_0x474526(0xf1)]){const _0x184739=new Date(_0x5606e7[_0x474526(0xf1)]),_0x580210=new Date();_0x184739<_0x580210?_0x5874c0=_0x474526(0xc2):_0x5874c0='FAILED';}else _0x5874c0='FAILED';}else _0x5874c0=_0x474526(0xbd);return{'status':_0x5874c0,'amount':_0x5606e7[_0x474526(0xd1)],'currency':_0x5606e7[_0x474526(0xe5)],'isActive':_0x5606e7[_0x474526(0xb2)]};}catch(_0x29c9c0){console['error'](_0x474526(0x91),_0x29c9c0),loggerService_1[_0x474526(0x97)]['logWhiteDomainError'](_0x474526(0xa5),'/payment-links/'+_0x1d89b7,_0x29c9c0);throw new Error(_0x474526(0xf4)+(_0x29c9c0 instanceof Error?_0x29c9c0[_0x474526(0x102)]:_0x474526(0xe9)));}}async[a46_0x1cf42e(0x100)](_0x6036e1){const _0x48f475=a46_0x1cf42e;console[_0x48f475(0xfd)]('Processing\x20Noda\x20webhook:',_0x6036e1);let _0x393004=_0x48f475(0xbd);switch(_0x6036e1[_0x48f475(0x103)]?.[_0x48f475(0xa0)]()){case'done':case _0x48f475(0x9a):case _0x48f475(0xe1):case _0x48f475(0xb5):case _0x48f475(0x9f):_0x6036e1[_0x48f475(0xdb)]===_0x48f475(0xfe)?_0x393004=_0x48f475(0x93):_0x393004=_0x48f475(0xbd);break;case _0x48f475(0xb0):case _0x48f475(0xa3):case'failed':case _0x48f475(0xce):case'rejected':_0x393004='FAILED';break;case _0x48f475(0xaf):case'timeout':_0x393004=_0x48f475(0xc2);break;case _0x48f475(0x99):case _0x48f475(0xda):case'active':case'processing':case _0x48f475(0x9d):default:_0x393004=_0x48f475(0xbd);break;}return{'paymentId':_0x6036e1['MerchantPaymentId']||_0x6036e1[_0x48f475(0x105)],'status':_0x393004,'amount':_0x6036e1[_0x48f475(0xbc)],'currency':_0x6036e1[_0x48f475(0xa7)],'additionalInfo':{'method':_0x6036e1['Method'],'bankId':_0x6036e1[_0x48f475(0xb8)],'settled':_0x6036e1[_0x48f475(0xdb)],'settlementDate':_0x6036e1[_0x48f475(0xdc)],'remitterName':_0x6036e1[_0x48f475(0xfc)]?.[_0x48f475(0xb6)],'remitterIban':_0x6036e1['Remitter']?.['Iban'],'bankTransactionId':_0x6036e1[_0x48f475(0xc0)]}};}['verifyWebhookSignature'](_0x3db32c,_0x8004f){const _0x3545e8=a46_0x1cf42e;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x8004f,'paymentId':_0x3db32c[_0x3545e8(0x105)],'merchantPaymentId':_0x3db32c[_0x3545e8(0xde)]}),!![];}}exports[a46_0x1cf42e(0xff)]=NodaService;