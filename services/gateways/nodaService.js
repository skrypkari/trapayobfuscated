'use strict';const a48_0xc85775=a48_0x2cfd;function a48_0x53a6(){const _0x2697a0=['rejected','entries','Response\x20Body:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','2145856YUcsGk','stringify','Headers:','(8digits-8digits\x20format)','Response\x20Time:','Noda\x20webhook\x20signature\x20verification:','HTTP\x20','Payment\x20Link\x20ID:','failed','in_progress','Noda\x20payment\x20verification\x20error:','headers','TesSoft\x20Payment\x20System/1.0','Settled','verifyPayment','(8digits-8digits\x20format\x20for\x20Noda)','EXPIRED','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','loggerService','JSON\x20Parse\x20Error:\x20','shortLink','Response\x20data:','FAILED','URL:','PaymentId','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Unknown\x20error\x20from\x20Noda\x20API','7656870EetKjw','Status','amount','/payment-links/','Failed\x20to\x20verify\x20Noda\x20payment:\x20','https://tesoft.uk/gateway/pending.php?id=','processing','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','expired','isActive','currency','===\x20PARSED\x20NODA\x20RESPONSE\x20===','36YFnGYt','Iban','Yes','apiUrl','===\x20NODA\x20SERVICE\x20ERROR\x20===','Method','PENDING','Short\x20Link:','===\x20NODA\x20SUCCESS\x20===','9qswitO','/payment-links','23290oMklzo','Remitter','noda','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','text','409780TXWvCC','NodaService','4sFFzYt','Processing\x20Noda\x20webhook:','done','message','timeout','status','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','636oCpZGc','logWhiteDomainResponse','pending','fromEntries','Unknown\x20error','error','Error\x20details:','576405FbFlbq','Failed\x20to\x20parse\x20JSON\x20response:','GET','statusCode','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Missing\x20id\x20or\x20shortLink\x20in\x20response','parse','logWhiteDomainError','shortLinkUrls','Order\x20ID\x20Format:','canceled','logWhiteDomainRequest','35134gejUWe','log','created','expiryDate','Name','SettlementDate','Raw\x20Response\x20Body:','Parsed\x20Result:','application/json','createPaymentLink','PAID','HTTP\x20Status:','7GyvMYN','cancelled','../loggerService','https://tesoft.uk/gateway/noda/','https://tesoft.uk/gateway/noda/webhook/','QR\x20Code\x20Link:','Not\x20provided','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink',',\x20body:\x20','qrCodeLink','now','Error\x20stack:','HTTP\x20error!\x20status:\x20','1528569byLmEg','json','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Noda\x20API\x20error:\x20','Currency','===\x20NODA\x20API\x20ERROR\x20===','Status:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','verifyWebhookSignature','MerchantPaymentId','Status\x20Code:','Status\x20Text:','toUpperCase','paid','Error\x20message:','Request\x20Body\x20(Direct\x20JSON):','successful'];a48_0x53a6=function(){return _0x2697a0;};return a48_0x53a6();}(function(_0x1af4a8,_0x4a3c7d){const _0x420fb2=a48_0x2cfd,_0x2e6035=_0x1af4a8();while(!![]){try{const _0x33d2ec=parseInt(_0x420fb2(0x1c5))/0x1+-parseInt(_0x420fb2(0x1c0))/0x2+-parseInt(_0x420fb2(0x1fa))/0x3*(-parseInt(_0x420fb2(0x1c7))/0x4)+parseInt(_0x420fb2(0x1d5))/0x5*(parseInt(_0x420fb2(0x1b5))/0x6)+parseInt(_0x420fb2(0x1ed))/0x7*(-parseInt(_0x420fb2(0x18e))/0x8)+-parseInt(_0x420fb2(0x1be))/0x9*(parseInt(_0x420fb2(0x1a9))/0xa)+parseInt(_0x420fb2(0x1e1))/0xb*(-parseInt(_0x420fb2(0x1ce))/0xc);if(_0x33d2ec===_0x4a3c7d)break;else _0x2e6035['push'](_0x2e6035['shift']());}catch(_0x4bb405){_0x2e6035['push'](_0x2e6035['shift']());}}}(a48_0x53a6,0x60b6f));function a48_0x2cfd(_0x789f26,_0xe56a69){const _0x53a6ae=a48_0x53a6();return a48_0x2cfd=function(_0x2cfd94,_0x320818){_0x2cfd94=_0x2cfd94-0x185;let _0x5dc7a5=_0x53a6ae[_0x2cfd94];return _0x5dc7a5;},a48_0x2cfd(_0x789f26,_0xe56a69);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a48_0xc85775(0x1c6)]=void 0x0;const loggerService_1=require(a48_0xc85775(0x1ef));class NodaService{constructor(){const _0x140475=a48_0xc85775;this[_0x140475(0x1b8)]=_0x140475(0x1f0),console['log'](_0x140475(0x1b0));}async[a48_0xc85775(0x1ea)](_0x372241){const _0x4cf7fb=a48_0xc85775,{orderId:_0x1aaa28,name:_0x109ec2,paymentDescription:_0x43d25f,amount:_0x5ce84e,currency:_0x4222ff,webhookUrl:_0x320d01,returnUrl:_0x84c5f9,expiryDate:_0x2e7145}=_0x372241,_0x2f474c=_0x4222ff[_0x4cf7fb(0x185)](),_0x33a3c9=_0x4cf7fb(0x1f1),_0x108823=_0x4cf7fb(0x1ae)+_0x1aaa28,_0x9c14b6={'name':_0x109ec2,'paymentDescription':_0x43d25f,'amount':_0x5ce84e,'currency':_0x2f474c,'paymentId':_0x1aaa28,'webhookUrl':_0x33a3c9,'returnUrl':_0x108823};_0x2e7145&&(_0x9c14b6[_0x4cf7fb(0x1e4)]=_0x2e7145);const _0x1f2ae8=Date[_0x4cf7fb(0x1f7)]();try{console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x19f)),console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x1a5),this[_0x4cf7fb(0x1b8)]),console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x188),JSON[_0x4cf7fb(0x18f)](_0x9c14b6,null,0x2)),console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x1de),_0x1aaa28,_0x4cf7fb(0x19d)),console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x18d),_0x108823),loggerService_1[_0x4cf7fb(0x1a0)][_0x4cf7fb(0x1e0)]('noda',_0x4cf7fb(0x1bf),'POST',_0x9c14b6);const _0x58240c=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x4cf7fb(0x1e9),'Accept':_0x4cf7fb(0x1e9),'User-Agent':_0x4cf7fb(0x19a)},'body':JSON['stringify'](_0x9c14b6)}),_0x1a6069=Date[_0x4cf7fb(0x1f7)]()-_0x1f2ae8;console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x202)),console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x200),_0x58240c[_0x4cf7fb(0x1cc)]),console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x207),_0x58240c['statusText']),console['log'](_0x4cf7fb(0x190),Object[_0x4cf7fb(0x1d1)](_0x58240c[_0x4cf7fb(0x199)][_0x4cf7fb(0x18b)]())),console['log'](_0x4cf7fb(0x192),_0x1a6069+'ms');const _0x598f06=await _0x58240c[_0x4cf7fb(0x1c4)]();console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x1e7),_0x598f06);if(!_0x58240c['ok']){console[_0x4cf7fb(0x1d3)](_0x4cf7fb(0x1ff)),console[_0x4cf7fb(0x1d3)](_0x4cf7fb(0x1ec),_0x58240c[_0x4cf7fb(0x1cc)]),console['error'](_0x4cf7fb(0x18c),_0x598f06),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4cf7fb(0x1c2),_0x4cf7fb(0x1bf),_0x58240c[_0x4cf7fb(0x1cc)],_0x598f06,_0x1a6069),loggerService_1[_0x4cf7fb(0x1a0)][_0x4cf7fb(0x1dc)](_0x4cf7fb(0x1c2),_0x4cf7fb(0x1bf),_0x4cf7fb(0x194)+_0x58240c[_0x4cf7fb(0x1cc)]+':\x20'+_0x598f06);if(_0x58240c[_0x4cf7fb(0x1cc)]===0x190)throw new Error(_0x4cf7fb(0x203));else{if(_0x58240c[_0x4cf7fb(0x1cc)]===0x1f4)throw new Error(_0x4cf7fb(0x1c3));}throw new Error(_0x4cf7fb(0x1f9)+_0x58240c[_0x4cf7fb(0x1cc)]+_0x4cf7fb(0x1f5)+_0x598f06);}let _0x1641f5;try{_0x1641f5=JSON[_0x4cf7fb(0x1db)](_0x598f06);}catch(_0x1d324c){console[_0x4cf7fb(0x1d3)](_0x4cf7fb(0x1d6),_0x1d324c),loggerService_1[_0x4cf7fb(0x1a0)][_0x4cf7fb(0x1dc)](_0x4cf7fb(0x1c2),'/payment-links',_0x4cf7fb(0x1a1)+_0x1d324c);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x598f06);}console['log'](_0x4cf7fb(0x1b4)),console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x1e8),JSON[_0x4cf7fb(0x18f)](_0x1641f5,null,0x2)),loggerService_1[_0x4cf7fb(0x1a0)][_0x4cf7fb(0x1cf)]('noda',_0x4cf7fb(0x1bf),_0x58240c[_0x4cf7fb(0x1cc)],_0x1641f5,_0x1a6069);if(_0x1641f5[_0x4cf7fb(0x1d3)]||_0x1641f5[_0x4cf7fb(0x1d8)]){const _0x2205ef=_0x1641f5[_0x4cf7fb(0x1ca)]||_0x1641f5[_0x4cf7fb(0x1d3)]||_0x4cf7fb(0x1a8);console[_0x4cf7fb(0x1d3)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x2205ef),console[_0x4cf7fb(0x1d3)](_0x4cf7fb(0x206),_0x1641f5[_0x4cf7fb(0x1d8)]),loggerService_1[_0x4cf7fb(0x1a0)][_0x4cf7fb(0x1dc)]('noda','/payment-links','Business\x20Error:\x20'+_0x2205ef);throw new Error(_0x4cf7fb(0x1fd)+_0x2205ef);}if(!_0x1641f5['id']||!_0x1641f5[_0x4cf7fb(0x1dd)]?.[_0x4cf7fb(0x1a2)]){console[_0x4cf7fb(0x1d3)](_0x4cf7fb(0x201)),console['error'](_0x4cf7fb(0x1da)),console[_0x4cf7fb(0x1d3)](_0x4cf7fb(0x1a3),_0x1641f5),loggerService_1['loggerService'][_0x4cf7fb(0x1dc)](_0x4cf7fb(0x1c2),_0x4cf7fb(0x1bf),_0x4cf7fb(0x1a7));throw new Error(_0x4cf7fb(0x1f4));}return console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x1bd)),console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x195),_0x1641f5['id']),console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x1bc),_0x1641f5[_0x4cf7fb(0x1dd)]['shortLink']),console[_0x4cf7fb(0x1e2)](_0x4cf7fb(0x1f2),_0x1641f5['shortLinkUrls'][_0x4cf7fb(0x1f6)]||_0x4cf7fb(0x1f3)),console[_0x4cf7fb(0x1e2)]('Order\x20ID\x20Used:',_0x1aaa28,_0x4cf7fb(0x191)),console['log'](_0x4cf7fb(0x1d9),_0x108823),{'gateway_payment_id':_0x1641f5['id'],'payment_url':_0x1641f5[_0x4cf7fb(0x1dd)][_0x4cf7fb(0x1a2)],'qr_code_url':_0x1641f5[_0x4cf7fb(0x1dd)][_0x4cf7fb(0x1f6)],'expiry_date':_0x1641f5['expiryDate']};}catch(_0x1ecef7){console[_0x4cf7fb(0x1d3)](_0x4cf7fb(0x1b9)),console[_0x4cf7fb(0x1d3)](_0x4cf7fb(0x1d4),_0x1ecef7),loggerService_1[_0x4cf7fb(0x1a0)][_0x4cf7fb(0x1dc)](_0x4cf7fb(0x1c2),'/payment-links',_0x1ecef7);if(_0x1ecef7 instanceof Error){console[_0x4cf7fb(0x1d3)](_0x4cf7fb(0x187),_0x1ecef7[_0x4cf7fb(0x1ca)]),console[_0x4cf7fb(0x1d3)](_0x4cf7fb(0x1f8),_0x1ecef7['stack']);throw new Error(_0x4cf7fb(0x1fc)+_0x1ecef7[_0x4cf7fb(0x1ca)]);}throw new Error(_0x4cf7fb(0x1cd));}}async[a48_0xc85775(0x19c)](_0x5081e9){const _0x3e7acf=a48_0xc85775,_0x5de812=Date[_0x3e7acf(0x1f7)]();try{loggerService_1[_0x3e7acf(0x1a0)][_0x3e7acf(0x1e0)](_0x3e7acf(0x1c2),_0x3e7acf(0x1ac)+_0x5081e9,_0x3e7acf(0x1d7),{});const _0xd5b240=await fetch(this[_0x3e7acf(0x1b8)]+'/'+_0x5081e9,{'method':_0x3e7acf(0x1d7),'headers':{'Content-Type':_0x3e7acf(0x1e9),'User-Agent':_0x3e7acf(0x19a)}}),_0x27d612=Date[_0x3e7acf(0x1f7)]()-_0x5de812;if(!_0xd5b240['ok']){const _0x54c52b=await _0xd5b240[_0x3e7acf(0x1c4)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3e7acf(0x1c2),_0x3e7acf(0x1ac)+_0x5081e9,_0xd5b240[_0x3e7acf(0x1cc)],_0x54c52b,_0x27d612);throw new Error('HTTP\x20error!\x20status:\x20'+_0xd5b240[_0x3e7acf(0x1cc)]);}const _0x16553d=await _0xd5b240[_0x3e7acf(0x1fb)]();loggerService_1['loggerService'][_0x3e7acf(0x1cf)](_0x3e7acf(0x1c2),_0x3e7acf(0x1ac)+_0x5081e9,_0xd5b240['status'],_0x16553d,_0x27d612);if(_0x16553d['error']||_0x16553d[_0x3e7acf(0x1d8)]){loggerService_1['loggerService'][_0x3e7acf(0x1dc)](_0x3e7acf(0x1c2),_0x3e7acf(0x1ac)+_0x5081e9,_0x3e7acf(0x1fd)+(_0x16553d[_0x3e7acf(0x1ca)]||_0x16553d[_0x3e7acf(0x1d3)]||_0x3e7acf(0x1d2)));throw new Error(_0x3e7acf(0x1fd)+(_0x16553d['message']||_0x16553d[_0x3e7acf(0x1d3)]||'Unknown\x20error'));}let _0x22d973=_0x3e7acf(0x1bb);if(_0x16553d[_0x3e7acf(0x1b2)]===![]){if(_0x16553d[_0x3e7acf(0x1e4)]){const _0x4864f7=new Date(_0x16553d['expiryDate']),_0x5c07c7=new Date();_0x4864f7<_0x5c07c7?_0x22d973=_0x3e7acf(0x19e):_0x22d973=_0x3e7acf(0x1a4);}else _0x22d973=_0x3e7acf(0x1a4);}else _0x22d973=_0x3e7acf(0x1bb);return{'status':_0x22d973,'amount':_0x16553d[_0x3e7acf(0x1ab)],'currency':_0x16553d[_0x3e7acf(0x1b3)],'isActive':_0x16553d[_0x3e7acf(0x1b2)]};}catch(_0x160f80){console['error'](_0x3e7acf(0x198),_0x160f80),loggerService_1[_0x3e7acf(0x1a0)][_0x3e7acf(0x1dc)](_0x3e7acf(0x1c2),'/payment-links/'+_0x5081e9,_0x160f80);throw new Error(_0x3e7acf(0x1ad)+(_0x160f80 instanceof Error?_0x160f80[_0x3e7acf(0x1ca)]:'Unknown\x20error'));}}async['processWebhook'](_0x2c3ff9){const _0x3c919a=a48_0xc85775;console[_0x3c919a(0x1e2)](_0x3c919a(0x1c8),_0x2c3ff9);let _0x36b772=_0x3c919a(0x1bb);switch(_0x2c3ff9[_0x3c919a(0x1aa)]?.['toLowerCase']()){case _0x3c919a(0x1c9):case'completed':case _0x3c919a(0x186):case'success':case _0x3c919a(0x189):_0x2c3ff9[_0x3c919a(0x19b)]===_0x3c919a(0x1b7)?_0x36b772=_0x3c919a(0x1eb):_0x36b772=_0x3c919a(0x1bb);break;case _0x3c919a(0x1ee):case _0x3c919a(0x1df):case _0x3c919a(0x196):case _0x3c919a(0x1d3):case _0x3c919a(0x18a):_0x36b772=_0x3c919a(0x1a4);break;case _0x3c919a(0x1b1):case _0x3c919a(0x1cb):_0x36b772='EXPIRED';break;case _0x3c919a(0x1d0):case _0x3c919a(0x1e3):case'active':case _0x3c919a(0x1af):case _0x3c919a(0x197):default:_0x36b772=_0x3c919a(0x1bb);break;}return{'paymentId':_0x2c3ff9[_0x3c919a(0x205)]||_0x2c3ff9[_0x3c919a(0x1a6)],'status':_0x36b772,'amount':_0x2c3ff9['Amount'],'currency':_0x2c3ff9[_0x3c919a(0x1fe)],'additionalInfo':{'method':_0x2c3ff9[_0x3c919a(0x1ba)],'bankId':_0x2c3ff9['BankId'],'settled':_0x2c3ff9[_0x3c919a(0x19b)],'settlementDate':_0x2c3ff9[_0x3c919a(0x1e6)],'remitterName':_0x2c3ff9[_0x3c919a(0x1c1)]?.[_0x3c919a(0x1e5)],'remitterIban':_0x2c3ff9[_0x3c919a(0x1c1)]?.[_0x3c919a(0x1b6)],'bankTransactionId':_0x2c3ff9['BankTransactionId']}};}[a48_0xc85775(0x204)](_0x10d049,_0x42311b){const _0x5b6570=a48_0xc85775;return console[_0x5b6570(0x1e2)](_0x5b6570(0x193),{'receivedSignature':_0x42311b,'paymentId':_0x10d049[_0x5b6570(0x1a6)],'merchantPaymentId':_0x10d049['MerchantPaymentId']}),!![];}}exports[a48_0xc85775(0x1c6)]=NodaService;