'use strict';const a71_0x2f955c=a71_0x36ab;(function(_0x54b37f,_0x44f3e8){const _0x57307a=a71_0x36ab,_0x2f1d8d=_0x54b37f();while(!![]){try{const _0x2fdd45=parseInt(_0x57307a(0x180))/0x1+parseInt(_0x57307a(0x148))/0x2*(-parseInt(_0x57307a(0x17a))/0x3)+-parseInt(_0x57307a(0x16e))/0x4*(-parseInt(_0x57307a(0x1a0))/0x5)+parseInt(_0x57307a(0x19c))/0x6*(parseInt(_0x57307a(0x19b))/0x7)+-parseInt(_0x57307a(0x15d))/0x8*(parseInt(_0x57307a(0x152))/0x9)+parseInt(_0x57307a(0x14c))/0xa+-parseInt(_0x57307a(0x146))/0xb;if(_0x2fdd45===_0x44f3e8)break;else _0x2f1d8d['push'](_0x2f1d8d['shift']());}catch(_0x4033a2){_0x2f1d8d['push'](_0x2f1d8d['shift']());}}}(a71_0x5529,0xbb9c4));Object[a71_0x2f955c(0x186)](exports,a71_0x2f955c(0x140),{'value':!![]}),exports[a71_0x2f955c(0x161)]=void 0x0;function a71_0x5529(){const _0x35b0d0=['expired','NodaService','fromEntries','Response\x20Body:','MerchantPaymentId','error','cancelled','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','verifyWebhookSignature','Noda\x20API\x20error:\x20','Amount','Raw\x20Response\x20Body:','text','Not\x20provided','36hvppFC','HTTP\x20','Error\x20stack:','apiUrl','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Unknown\x20error\x20from\x20Noda\x20API','done','statusCode','status','currency','PaymentId','425895gcNrAe','===\x20PARSED\x20NODA\x20RESPONSE\x20===','FAILED','json','QR\x20Code\x20Link:','Error\x20details:','878718ygdqMd','Headers:','Processing\x20Noda\x20webhook:','canceled','(8digits-8digits\x20format\x20for\x20Noda)','qrCodeLink','defineProperty','Payment\x20Link\x20ID:','BankId','Failed\x20to\x20verify\x20Noda\x20payment:\x20','in_progress','Payment\x20System/1.0','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Currency','shortLinkUrls','Business\x20Error:\x20','Yes','../loggerService',',\x20body:\x20','PENDING','message','logWhiteDomainResponse','Name','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Parsed\x20Result:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','verifyPayment','119GobWQF','1746DYbAAP','Status:','parse','isActive','675020uVskOE','Response\x20Time:','Status\x20Code:','logWhiteDomainError','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20NODA\x20SERVICE\x20ERROR\x20===','pending','Unknown\x20error','Order\x20ID\x20Format:','Status\x20Text:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Noda\x20webhook\x20signature\x20verification:','===\x20NODA\x20API\x20ERROR\x20===','loggerService','rejected','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','failed','Error\x20message:','GET','https://tesoft.uk/gateway/pending.php?id=','statusText','toLowerCase','https://tesoft.uk/gateway/noda/webhook/','URL:','https://tesoft.uk/gateway/noda/','POST','Missing\x20id\x20or\x20shortLink\x20in\x20response','Status','/payment-links/','processWebhook','headers','/payment-links','log','__esModule','shortLink','Failed\x20to\x20parse\x20JSON\x20response:','PAID','JSON\x20Parse\x20Error:\x20','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','8494563TeaMCV','expiryDate','18GUQtsk','timeout','noda','EXPIRED','9363020xsaJLH','===\x20NODA\x20SUCCESS\x20===','(8digits-8digits\x20format)','stack','Remitter','HTTP\x20Status:','27mWehzV','application/json','entries','logWhiteDomainRequest','stringify','createPaymentLink','successful','Settled','Iban','now','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','577688LcAgqB','HTTP\x20error!\x20status:\x20','Request\x20Body\x20(Direct\x20JSON):'];a71_0x5529=function(){return _0x35b0d0;};return a71_0x5529();}const loggerService_1=require(a71_0x2f955c(0x191));class NodaService{constructor(){const _0x291a6a=a71_0x2f955c;this[_0x291a6a(0x171)]=_0x291a6a(0x1b8),console['log'](_0x291a6a(0x1aa));}async[a71_0x2f955c(0x157)](_0x264f5b){const _0x5ac1e2=a71_0x2f955c,{orderId:_0x4a8ff9,name:_0x3277f2,paymentDescription:_0x199c45,amount:_0xc17d8f,currency:_0x554776,webhookUrl:_0x32668a,returnUrl:_0x4d74d8,expiryDate:_0x2ac2a8}=_0x264f5b,_0x9bba1c=_0x554776['toUpperCase'](),_0x39d99c=_0x5ac1e2(0x1b6),_0x315c9f=_0x5ac1e2(0x1b3)+_0x4a8ff9,_0x28697d={'name':_0x3277f2,'paymentDescription':_0x199c45,'amount':_0xc17d8f,'currency':_0x9bba1c,'paymentId':_0x4a8ff9,'webhookUrl':_0x39d99c,'returnUrl':_0x315c9f};_0x2ac2a8&&(_0x28697d[_0x5ac1e2(0x147)]=_0x2ac2a8);const _0x4c7a9e=Date[_0x5ac1e2(0x15b)]();try{console[_0x5ac1e2(0x13f)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console['log'](_0x5ac1e2(0x1b7),this[_0x5ac1e2(0x171)]),console[_0x5ac1e2(0x13f)](_0x5ac1e2(0x15f),JSON['stringify'](_0x28697d,null,0x2)),console[_0x5ac1e2(0x13f)](_0x5ac1e2(0x1a8),_0x4a8ff9,_0x5ac1e2(0x184)),console[_0x5ac1e2(0x13f)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x315c9f),loggerService_1[_0x5ac1e2(0x1ad)][_0x5ac1e2(0x155)](_0x5ac1e2(0x14a),_0x5ac1e2(0x13e),_0x5ac1e2(0x1b9),_0x28697d);const _0x2e29c5=await fetch(this[_0x5ac1e2(0x171)],{'method':_0x5ac1e2(0x1b9),'headers':{'Content-Type':_0x5ac1e2(0x153),'Accept':_0x5ac1e2(0x153),'User-Agent':_0x5ac1e2(0x18b)},'body':JSON[_0x5ac1e2(0x156)](_0x28697d)}),_0x246fce=Date[_0x5ac1e2(0x15b)]()-_0x4c7a9e;console[_0x5ac1e2(0x13f)](_0x5ac1e2(0x199)),console[_0x5ac1e2(0x13f)](_0x5ac1e2(0x19d),_0x2e29c5['status']),console['log'](_0x5ac1e2(0x1a9),_0x2e29c5[_0x5ac1e2(0x1b4)]),console[_0x5ac1e2(0x13f)](_0x5ac1e2(0x181),Object[_0x5ac1e2(0x162)](_0x2e29c5[_0x5ac1e2(0x13d)][_0x5ac1e2(0x154)]())),console['log'](_0x5ac1e2(0x1a1),_0x246fce+'ms');const _0x269298=await _0x2e29c5[_0x5ac1e2(0x16c)]();console[_0x5ac1e2(0x13f)](_0x5ac1e2(0x16b),_0x269298);if(!_0x2e29c5['ok']){console['error'](_0x5ac1e2(0x1ac)),console[_0x5ac1e2(0x165)](_0x5ac1e2(0x151),_0x2e29c5[_0x5ac1e2(0x177)]),console[_0x5ac1e2(0x165)](_0x5ac1e2(0x163),_0x269298),loggerService_1[_0x5ac1e2(0x1ad)][_0x5ac1e2(0x195)]('noda',_0x5ac1e2(0x13e),_0x2e29c5[_0x5ac1e2(0x177)],_0x269298,_0x246fce),loggerService_1['loggerService'][_0x5ac1e2(0x1a3)]('noda',_0x5ac1e2(0x13e),_0x5ac1e2(0x16f)+_0x2e29c5['status']+':\x20'+_0x269298);if(_0x2e29c5['status']===0x190)throw new Error(_0x5ac1e2(0x1af));else{if(_0x2e29c5[_0x5ac1e2(0x177)]===0x1f4)throw new Error(_0x5ac1e2(0x173));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x2e29c5['status']+_0x5ac1e2(0x192)+_0x269298);}let _0x296c69;try{_0x296c69=JSON[_0x5ac1e2(0x19e)](_0x269298);}catch(_0x40eacd){console[_0x5ac1e2(0x165)](_0x5ac1e2(0x142),_0x40eacd),loggerService_1[_0x5ac1e2(0x1ad)][_0x5ac1e2(0x1a3)]('noda','/payment-links',_0x5ac1e2(0x144)+_0x40eacd);throw new Error(_0x5ac1e2(0x197)+_0x269298);}console['log'](_0x5ac1e2(0x17b)),console[_0x5ac1e2(0x13f)](_0x5ac1e2(0x198),JSON['stringify'](_0x296c69,null,0x2)),loggerService_1[_0x5ac1e2(0x1ad)][_0x5ac1e2(0x195)](_0x5ac1e2(0x14a),_0x5ac1e2(0x13e),_0x2e29c5[_0x5ac1e2(0x177)],_0x296c69,_0x246fce);if(_0x296c69['error']||_0x296c69[_0x5ac1e2(0x176)]){const _0x5b243f=_0x296c69[_0x5ac1e2(0x194)]||_0x296c69[_0x5ac1e2(0x165)]||_0x5ac1e2(0x174);console[_0x5ac1e2(0x165)](_0x5ac1e2(0x18c)),console[_0x5ac1e2(0x165)]('Error\x20Message:',_0x5b243f),console[_0x5ac1e2(0x165)](_0x5ac1e2(0x1a2),_0x296c69[_0x5ac1e2(0x176)]),loggerService_1[_0x5ac1e2(0x1ad)][_0x5ac1e2(0x1a3)](_0x5ac1e2(0x14a),_0x5ac1e2(0x13e),_0x5ac1e2(0x18f)+_0x5b243f);throw new Error('Noda\x20API\x20error:\x20'+_0x5b243f);}if(!_0x296c69['id']||!_0x296c69[_0x5ac1e2(0x18e)]?.['shortLink']){console[_0x5ac1e2(0x165)](_0x5ac1e2(0x1a4)),console[_0x5ac1e2(0x165)](_0x5ac1e2(0x1ba)),console['error']('Response\x20data:',_0x296c69),loggerService_1[_0x5ac1e2(0x1ad)]['logWhiteDomainError'](_0x5ac1e2(0x14a),'/payment-links',_0x5ac1e2(0x172));throw new Error(_0x5ac1e2(0x145));}return console[_0x5ac1e2(0x13f)](_0x5ac1e2(0x14d)),console[_0x5ac1e2(0x13f)](_0x5ac1e2(0x187),_0x296c69['id']),console[_0x5ac1e2(0x13f)]('Short\x20Link:',_0x296c69[_0x5ac1e2(0x18e)][_0x5ac1e2(0x141)]),console[_0x5ac1e2(0x13f)](_0x5ac1e2(0x17e),_0x296c69[_0x5ac1e2(0x18e)][_0x5ac1e2(0x185)]||_0x5ac1e2(0x16d)),console[_0x5ac1e2(0x13f)]('Order\x20ID\x20Used:',_0x4a8ff9,_0x5ac1e2(0x14e)),console[_0x5ac1e2(0x13f)](_0x5ac1e2(0x167),_0x315c9f),{'gateway_payment_id':_0x296c69['id'],'payment_url':_0x296c69[_0x5ac1e2(0x18e)][_0x5ac1e2(0x141)],'qr_code_url':_0x296c69['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x296c69[_0x5ac1e2(0x147)]};}catch(_0x3b6441){console[_0x5ac1e2(0x165)](_0x5ac1e2(0x1a5)),console[_0x5ac1e2(0x165)](_0x5ac1e2(0x17f),_0x3b6441),loggerService_1[_0x5ac1e2(0x1ad)]['logWhiteDomainError'](_0x5ac1e2(0x14a),_0x5ac1e2(0x13e),_0x3b6441);if(_0x3b6441 instanceof Error){console[_0x5ac1e2(0x165)](_0x5ac1e2(0x1b1),_0x3b6441[_0x5ac1e2(0x194)]),console[_0x5ac1e2(0x165)](_0x5ac1e2(0x170),_0x3b6441[_0x5ac1e2(0x14f)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x3b6441['message']);}throw new Error(_0x5ac1e2(0x15c));}}async[a71_0x2f955c(0x19a)](_0x4306d6){const _0xfc71c5=a71_0x2f955c,_0x57cfb0=Date[_0xfc71c5(0x15b)]();try{loggerService_1[_0xfc71c5(0x1ad)]['logWhiteDomainRequest'](_0xfc71c5(0x14a),'/payment-links/'+_0x4306d6,_0xfc71c5(0x1b2),{});const _0x1bb1e6=await fetch(this[_0xfc71c5(0x171)]+'/'+_0x4306d6,{'method':_0xfc71c5(0x1b2),'headers':{'Content-Type':_0xfc71c5(0x153),'User-Agent':'Payment\x20System/1.0'}}),_0x43ce48=Date['now']()-_0x57cfb0;if(!_0x1bb1e6['ok']){const _0x4f4be6=await _0x1bb1e6[_0xfc71c5(0x16c)]();loggerService_1[_0xfc71c5(0x1ad)][_0xfc71c5(0x195)]('noda',_0xfc71c5(0x1bc)+_0x4306d6,_0x1bb1e6['status'],_0x4f4be6,_0x43ce48);throw new Error(_0xfc71c5(0x15e)+_0x1bb1e6['status']);}const _0x33dd64=await _0x1bb1e6[_0xfc71c5(0x17d)]();loggerService_1['loggerService'][_0xfc71c5(0x195)](_0xfc71c5(0x14a),'/payment-links/'+_0x4306d6,_0x1bb1e6[_0xfc71c5(0x177)],_0x33dd64,_0x43ce48);if(_0x33dd64[_0xfc71c5(0x165)]||_0x33dd64['statusCode']){loggerService_1[_0xfc71c5(0x1ad)][_0xfc71c5(0x1a3)](_0xfc71c5(0x14a),'/payment-links/'+_0x4306d6,_0xfc71c5(0x169)+(_0x33dd64[_0xfc71c5(0x194)]||_0x33dd64[_0xfc71c5(0x165)]||_0xfc71c5(0x1a7)));throw new Error(_0xfc71c5(0x169)+(_0x33dd64[_0xfc71c5(0x194)]||_0x33dd64[_0xfc71c5(0x165)]||_0xfc71c5(0x1a7)));}let _0x525ed4=_0xfc71c5(0x193);if(_0x33dd64[_0xfc71c5(0x19f)]===![]){if(_0x33dd64['expiryDate']){const _0x4365d8=new Date(_0x33dd64['expiryDate']),_0x2f9305=new Date();_0x4365d8<_0x2f9305?_0x525ed4=_0xfc71c5(0x14b):_0x525ed4=_0xfc71c5(0x17c);}else _0x525ed4='FAILED';}else _0x525ed4=_0xfc71c5(0x193);return{'status':_0x525ed4,'amount':_0x33dd64['amount'],'currency':_0x33dd64[_0xfc71c5(0x178)],'isActive':_0x33dd64[_0xfc71c5(0x19f)]};}catch(_0x2a17bf){console[_0xfc71c5(0x165)]('Noda\x20payment\x20verification\x20error:',_0x2a17bf),loggerService_1[_0xfc71c5(0x1ad)][_0xfc71c5(0x1a3)](_0xfc71c5(0x14a),_0xfc71c5(0x1bc)+_0x4306d6,_0x2a17bf);throw new Error(_0xfc71c5(0x189)+(_0x2a17bf instanceof Error?_0x2a17bf[_0xfc71c5(0x194)]:_0xfc71c5(0x1a7)));}}async[a71_0x2f955c(0x1bd)](_0x293d5d){const _0x272400=a71_0x2f955c;console[_0x272400(0x13f)](_0x272400(0x182),_0x293d5d);let _0x26cae4='PENDING';switch(_0x293d5d[_0x272400(0x1bb)]?.[_0x272400(0x1b5)]()){case _0x272400(0x175):case'completed':case'paid':case'success':case _0x272400(0x158):_0x293d5d['Settled']===_0x272400(0x190)?_0x26cae4=_0x272400(0x143):_0x26cae4=_0x272400(0x193);break;case _0x272400(0x166):case _0x272400(0x183):case _0x272400(0x1b0):case _0x272400(0x165):case _0x272400(0x1ae):_0x26cae4=_0x272400(0x17c);break;case _0x272400(0x160):case _0x272400(0x149):_0x26cae4='EXPIRED';break;case _0x272400(0x1a6):case'created':case'active':case'processing':case _0x272400(0x18a):default:_0x26cae4=_0x272400(0x193);break;}return{'paymentId':_0x293d5d[_0x272400(0x164)]||_0x293d5d[_0x272400(0x179)],'status':_0x26cae4,'amount':_0x293d5d[_0x272400(0x16a)],'currency':_0x293d5d[_0x272400(0x18d)],'additionalInfo':{'method':_0x293d5d['Method'],'bankId':_0x293d5d[_0x272400(0x188)],'settled':_0x293d5d[_0x272400(0x159)],'settlementDate':_0x293d5d['SettlementDate'],'remitterName':_0x293d5d[_0x272400(0x150)]?.[_0x272400(0x196)],'remitterIban':_0x293d5d[_0x272400(0x150)]?.[_0x272400(0x15a)],'bankTransactionId':_0x293d5d['BankTransactionId']}};}[a71_0x2f955c(0x168)](_0x375685,_0xc97d30){const _0x23e396=a71_0x2f955c;return console[_0x23e396(0x13f)](_0x23e396(0x1ab),{'receivedSignature':_0xc97d30,'paymentId':_0x375685[_0x23e396(0x179)],'merchantPaymentId':_0x375685[_0x23e396(0x164)]}),!![];}}function a71_0x36ab(_0x348535,_0x1e4551){_0x348535=_0x348535-0x13d;const _0x55298e=a71_0x5529();let _0x36abcc=_0x55298e[_0x348535];return _0x36abcc;}exports[a71_0x2f955c(0x161)]=NodaService;