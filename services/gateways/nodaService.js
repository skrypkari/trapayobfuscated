'use strict';const a46_0x304f0a=a46_0x2575;function a46_0x283d(){const _0x2cc6dd=['SettlementDate','Response\x20Time:','Error\x20message:','2OaRHCu','error','HTTP\x20','HTTP\x20error!\x20status:\x20','(8digits-8digits\x20format\x20for\x20Noda)','1694484wegzIV','paid','Status:','TesSoft\x20Payment\x20System/1.0','PaymentId','PAID','json','Remitter','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','verifyWebhookSignature','Noda\x20API\x20error:\x20','(8digits-8digits\x20format)','noda','createPaymentLink','BankId','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','960954CWolHk','cancelled','processWebhook','===\x20NODA\x20SERVICE\x20ERROR\x20===','statusText','shortLink','Order\x20ID\x20Format:','Payment\x20Link\x20ID:','created','Settled','Response\x20data:','completed','17488gVisCx','EXPIRED','FAILED','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','/payment-links/','in_progress','2062564WtdPaE','912479aRDYdD','Unknown\x20error\x20from\x20Noda\x20API','Name','successful','BankTransactionId','Not\x20provided','isActive','NodaService','logWhiteDomainError','Parsed\x20Result:','expired','log','Business\x20Error:\x20','statusCode','status','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','441FffCVa','canceled','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','now','parse','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','processing','12076yyIMmN','Error\x20stack:','application/json','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Failed\x20to\x20parse\x20JSON\x20response:','Yes','active','Unknown\x20error','Failed\x20to\x20verify\x20Noda\x20payment:\x20','===\x20PARSED\x20NODA\x20RESPONSE\x20===','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','../loggerService','Short\x20Link:','pending','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','1145QkKSes','GET',',\x20body:\x20','PENDING','Status\x20Code:','JSON\x20Parse\x20Error:\x20','26651730MzuwhG','message','loggerService','fromEntries','URL:','entries','QR\x20Code\x20Link:','stringify','expiryDate','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','__esModule','Processing\x20Noda\x20webhook:','Missing\x20id\x20or\x20shortLink\x20in\x20response','Status\x20Text:','/payment-links','toUpperCase','https://tesoft.uk/gateway/noda/','text','done','failed','verifyPayment','logWhiteDomainRequest','toLowerCase','qrCodeLink','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20ERROR\x20===','HTTP\x20Status:','logWhiteDomainResponse','rejected','shortLinkUrls','Request\x20Body\x20(Direct\x20JSON):','apiUrl','Amount','MerchantPaymentId'];a46_0x283d=function(){return _0x2cc6dd;};return a46_0x283d();}(function(_0x3c4e4d,_0x297a4b){const _0x28ac9c=a46_0x2575,_0xedaa04=_0x3c4e4d();while(!![]){try{const _0x36b19c=parseInt(_0x28ac9c(0x167))/0x1*(-parseInt(_0x28ac9c(0x13e))/0x2)+-parseInt(_0x28ac9c(0x143))/0x3+parseInt(_0x28ac9c(0x17e))/0x4*(-parseInt(_0x28ac9c(0x18d))/0x5)+parseInt(_0x28ac9c(0x153))/0x6+-parseInt(_0x28ac9c(0x166))/0x7+parseInt(_0x28ac9c(0x15f))/0x8*(parseInt(_0x28ac9c(0x177))/0x9)+parseInt(_0x28ac9c(0x193))/0xa;if(_0x36b19c===_0x297a4b)break;else _0xedaa04['push'](_0xedaa04['shift']());}catch(_0x2405d7){_0xedaa04['push'](_0xedaa04['shift']());}}}(a46_0x283d,0x72890));Object['defineProperty'](exports,a46_0x304f0a(0x19d),{'value':!![]}),exports[a46_0x304f0a(0x16e)]=void 0x0;function a46_0x2575(_0x26c49c,_0x2a28d){const _0x283da6=a46_0x283d();return a46_0x2575=function(_0x2575a6,_0x5bd427){_0x2575a6=_0x2575a6-0x13c;let _0x318584=_0x283da6[_0x2575a6];return _0x318584;},a46_0x2575(_0x26c49c,_0x2a28d);}const loggerService_1=require(a46_0x304f0a(0x189));class NodaService{constructor(){const _0xc7fae7=a46_0x304f0a;this[_0xc7fae7(0x1b2)]=_0xc7fae7(0x1a3),console[_0xc7fae7(0x172)](_0xc7fae7(0x17c));}async[a46_0x304f0a(0x150)](_0x58dc94){const _0x168502=a46_0x304f0a,{orderId:_0x4cab3c,name:_0x5a6ded,paymentDescription:_0x4fe559,amount:_0x48419e,currency:_0x58a571,webhookUrl:_0x339f8a,returnUrl:_0xf9827c,expiryDate:_0x3d94ad}=_0x58dc94,_0x2a1acc=_0x58a571[_0x168502(0x1a2)](),_0x5684a4='https://tesoft.uk/gateway/noda/webhook/',_0x19bf9e='https://tesoft.uk/gateway/pending.php?id='+_0x4cab3c,_0x53fa9f={'name':_0x5a6ded,'paymentDescription':_0x4fe559,'amount':_0x48419e,'currency':_0x2a1acc,'paymentId':_0x4cab3c,'webhookUrl':_0x5684a4,'returnUrl':_0x19bf9e};_0x3d94ad&&(_0x53fa9f[_0x168502(0x19b)]=_0x3d94ad);const _0x26a47d=Date['now']();try{console[_0x168502(0x172)](_0x168502(0x179)),console[_0x168502(0x172)](_0x168502(0x197),this[_0x168502(0x1b2)]),console['log'](_0x168502(0x1b1),JSON[_0x168502(0x19a)](_0x53fa9f,null,0x2)),console[_0x168502(0x172)](_0x168502(0x159),_0x4cab3c,_0x168502(0x142)),console[_0x168502(0x172)](_0x168502(0x163),_0x19bf9e),loggerService_1[_0x168502(0x195)][_0x168502(0x1a8)]('noda','/payment-links','POST',_0x53fa9f);const _0x1b962d=await fetch(this[_0x168502(0x1b2)],{'method':'POST','headers':{'Content-Type':_0x168502(0x180),'Accept':_0x168502(0x180),'User-Agent':_0x168502(0x146)},'body':JSON['stringify'](_0x53fa9f)}),_0x522b4e=Date[_0x168502(0x17a)]()-_0x26a47d;console['log'](_0x168502(0x188)),console[_0x168502(0x172)](_0x168502(0x145),_0x1b962d['status']),console[_0x168502(0x172)](_0x168502(0x1a0),_0x1b962d[_0x168502(0x157)]),console[_0x168502(0x172)]('Headers:',Object[_0x168502(0x196)](_0x1b962d['headers'][_0x168502(0x198)]())),console['log'](_0x168502(0x13c),_0x522b4e+'ms');const _0x1da044=await _0x1b962d[_0x168502(0x1a4)]();console['log']('Raw\x20Response\x20Body:',_0x1da044);if(!_0x1b962d['ok']){console[_0x168502(0x13f)](_0x168502(0x1ac)),console[_0x168502(0x13f)](_0x168502(0x1ad),_0x1b962d['status']),console[_0x168502(0x13f)]('Response\x20Body:',_0x1da044),loggerService_1[_0x168502(0x195)][_0x168502(0x1ae)]('noda',_0x168502(0x1a1),_0x1b962d[_0x168502(0x175)],_0x1da044,_0x522b4e),loggerService_1['loggerService'][_0x168502(0x16f)](_0x168502(0x14f),_0x168502(0x1a1),_0x168502(0x140)+_0x1b962d[_0x168502(0x175)]+':\x20'+_0x1da044);if(_0x1b962d[_0x168502(0x175)]===0x190)throw new Error(_0x168502(0x18c));else{if(_0x1b962d[_0x168502(0x175)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error('HTTP\x20error!\x20status:\x20'+_0x1b962d['status']+_0x168502(0x18f)+_0x1da044);}let _0x322cc6;try{_0x322cc6=JSON[_0x168502(0x17b)](_0x1da044);}catch(_0x1e4090){console[_0x168502(0x13f)](_0x168502(0x182),_0x1e4090),loggerService_1[_0x168502(0x195)]['logWhiteDomainError'](_0x168502(0x14f),'/payment-links',_0x168502(0x192)+_0x1e4090);throw new Error(_0x168502(0x181)+_0x1da044);}console[_0x168502(0x172)](_0x168502(0x187)),console[_0x168502(0x172)](_0x168502(0x170),JSON[_0x168502(0x19a)](_0x322cc6,null,0x2)),loggerService_1['loggerService'][_0x168502(0x1ae)](_0x168502(0x14f),_0x168502(0x1a1),_0x1b962d['status'],_0x322cc6,_0x522b4e);if(_0x322cc6[_0x168502(0x13f)]||_0x322cc6['statusCode']){const _0xb715c1=_0x322cc6[_0x168502(0x194)]||_0x322cc6[_0x168502(0x13f)]||_0x168502(0x168);console[_0x168502(0x13f)](_0x168502(0x19c)),console[_0x168502(0x13f)]('Error\x20Message:',_0xb715c1),console[_0x168502(0x13f)](_0x168502(0x191),_0x322cc6[_0x168502(0x174)]),loggerService_1['loggerService'][_0x168502(0x16f)](_0x168502(0x14f),_0x168502(0x1a1),_0x168502(0x173)+_0xb715c1);throw new Error(_0x168502(0x14d)+_0xb715c1);}if(!_0x322cc6['id']||!_0x322cc6['shortLinkUrls']?.[_0x168502(0x158)]){console['error'](_0x168502(0x14b)),console['error'](_0x168502(0x19f)),console[_0x168502(0x13f)](_0x168502(0x15d),_0x322cc6),loggerService_1[_0x168502(0x195)][_0x168502(0x16f)](_0x168502(0x14f),'/payment-links',_0x168502(0x162));throw new Error(_0x168502(0x1ab));}return console[_0x168502(0x172)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x168502(0x172)](_0x168502(0x15a),_0x322cc6['id']),console[_0x168502(0x172)](_0x168502(0x18a),_0x322cc6['shortLinkUrls'][_0x168502(0x158)]),console[_0x168502(0x172)](_0x168502(0x199),_0x322cc6[_0x168502(0x1b0)][_0x168502(0x1aa)]||_0x168502(0x16c)),console['log']('Order\x20ID\x20Used:',_0x4cab3c,_0x168502(0x14e)),console[_0x168502(0x172)](_0x168502(0x152),_0x19bf9e),{'gateway_payment_id':_0x322cc6['id'],'payment_url':_0x322cc6[_0x168502(0x1b0)]['shortLink'],'qr_code_url':_0x322cc6[_0x168502(0x1b0)][_0x168502(0x1aa)],'expiry_date':_0x322cc6[_0x168502(0x19b)]};}catch(_0x519ad2){console[_0x168502(0x13f)](_0x168502(0x156)),console[_0x168502(0x13f)]('Error\x20details:',_0x519ad2),loggerService_1[_0x168502(0x195)]['logWhiteDomainError'](_0x168502(0x14f),_0x168502(0x1a1),_0x519ad2);if(_0x519ad2 instanceof Error){console[_0x168502(0x13f)](_0x168502(0x13d),_0x519ad2['message']),console['error'](_0x168502(0x17f),_0x519ad2['stack']);throw new Error(_0x168502(0x176)+_0x519ad2[_0x168502(0x194)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a46_0x304f0a(0x1a7)](_0x5f4d45){const _0x162d0f=a46_0x304f0a,_0x5d353f=Date[_0x162d0f(0x17a)]();try{loggerService_1[_0x162d0f(0x195)]['logWhiteDomainRequest']('noda',_0x162d0f(0x164)+_0x5f4d45,_0x162d0f(0x18e),{});const _0x337eb8=await fetch(this[_0x162d0f(0x1b2)]+'/'+_0x5f4d45,{'method':_0x162d0f(0x18e),'headers':{'Content-Type':_0x162d0f(0x180),'User-Agent':_0x162d0f(0x146)}}),_0x59d533=Date[_0x162d0f(0x17a)]()-_0x5d353f;if(!_0x337eb8['ok']){const _0x1706b4=await _0x337eb8[_0x162d0f(0x1a4)]();loggerService_1[_0x162d0f(0x195)][_0x162d0f(0x1ae)](_0x162d0f(0x14f),_0x162d0f(0x164)+_0x5f4d45,_0x337eb8[_0x162d0f(0x175)],_0x1706b4,_0x59d533);throw new Error(_0x162d0f(0x141)+_0x337eb8[_0x162d0f(0x175)]);}const _0x35a407=await _0x337eb8[_0x162d0f(0x149)]();loggerService_1['loggerService'][_0x162d0f(0x1ae)]('noda',_0x162d0f(0x164)+_0x5f4d45,_0x337eb8[_0x162d0f(0x175)],_0x35a407,_0x59d533);if(_0x35a407[_0x162d0f(0x13f)]||_0x35a407[_0x162d0f(0x174)]){loggerService_1[_0x162d0f(0x195)][_0x162d0f(0x16f)](_0x162d0f(0x14f),_0x162d0f(0x164)+_0x5f4d45,_0x162d0f(0x14d)+(_0x35a407[_0x162d0f(0x194)]||_0x35a407['error']||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x35a407[_0x162d0f(0x194)]||_0x35a407[_0x162d0f(0x13f)]||_0x162d0f(0x185)));}let _0x3e0a97=_0x162d0f(0x190);if(_0x35a407[_0x162d0f(0x16d)]===![]){if(_0x35a407[_0x162d0f(0x19b)]){const _0x37667e=new Date(_0x35a407[_0x162d0f(0x19b)]),_0x3b98c4=new Date();_0x37667e<_0x3b98c4?_0x3e0a97=_0x162d0f(0x160):_0x3e0a97=_0x162d0f(0x161);}else _0x3e0a97=_0x162d0f(0x161);}else _0x3e0a97=_0x162d0f(0x190);return{'status':_0x3e0a97,'amount':_0x35a407['amount'],'currency':_0x35a407['currency'],'isActive':_0x35a407['isActive']};}catch(_0x366f87){console[_0x162d0f(0x13f)]('Noda\x20payment\x20verification\x20error:',_0x366f87),loggerService_1[_0x162d0f(0x195)][_0x162d0f(0x16f)](_0x162d0f(0x14f),_0x162d0f(0x164)+_0x5f4d45,_0x366f87);throw new Error(_0x162d0f(0x186)+(_0x366f87 instanceof Error?_0x366f87['message']:_0x162d0f(0x185)));}}async[a46_0x304f0a(0x155)](_0x4f2d50){const _0x3dfd78=a46_0x304f0a;console[_0x3dfd78(0x172)](_0x3dfd78(0x19e),_0x4f2d50);let _0x21af4b='PENDING';switch(_0x4f2d50['Status']?.[_0x3dfd78(0x1a9)]()){case _0x3dfd78(0x1a5):case _0x3dfd78(0x15e):case _0x3dfd78(0x144):case'success':case _0x3dfd78(0x16a):_0x4f2d50[_0x3dfd78(0x15c)]===_0x3dfd78(0x183)?_0x21af4b=_0x3dfd78(0x148):_0x21af4b=_0x3dfd78(0x190);break;case _0x3dfd78(0x154):case _0x3dfd78(0x178):case _0x3dfd78(0x1a6):case'error':case _0x3dfd78(0x1af):_0x21af4b='FAILED';break;case _0x3dfd78(0x171):case'timeout':_0x21af4b='EXPIRED';break;case _0x3dfd78(0x18b):case _0x3dfd78(0x15b):case _0x3dfd78(0x184):case _0x3dfd78(0x17d):case _0x3dfd78(0x165):default:_0x21af4b=_0x3dfd78(0x190);break;}return{'paymentId':_0x4f2d50[_0x3dfd78(0x1b4)]||_0x4f2d50[_0x3dfd78(0x147)],'status':_0x21af4b,'amount':_0x4f2d50[_0x3dfd78(0x1b3)],'currency':_0x4f2d50['Currency'],'additionalInfo':{'method':_0x4f2d50['Method'],'bankId':_0x4f2d50[_0x3dfd78(0x151)],'settled':_0x4f2d50[_0x3dfd78(0x15c)],'settlementDate':_0x4f2d50[_0x3dfd78(0x1b5)],'remitterName':_0x4f2d50[_0x3dfd78(0x14a)]?.[_0x3dfd78(0x169)],'remitterIban':_0x4f2d50[_0x3dfd78(0x14a)]?.['Iban'],'bankTransactionId':_0x4f2d50[_0x3dfd78(0x16b)]}};}[a46_0x304f0a(0x14c)](_0x41c0cb,_0x19bd14){const _0x2b5eae=a46_0x304f0a;return console[_0x2b5eae(0x172)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x19bd14,'paymentId':_0x41c0cb[_0x2b5eae(0x147)],'merchantPaymentId':_0x41c0cb[_0x2b5eae(0x1b4)]}),!![];}}exports[a46_0x304f0a(0x16e)]=NodaService;