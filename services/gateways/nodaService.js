'use strict';const a43_0x38df9f=a43_0x4954;(function(_0x5b2e84,_0x2d5564){const _0x6ebb71=a43_0x4954,_0x5b7c9f=_0x5b2e84();while(!![]){try{const _0x246b63=parseInt(_0x6ebb71(0x155))/0x1+parseInt(_0x6ebb71(0x17a))/0x2+parseInt(_0x6ebb71(0x16b))/0x3+-parseInt(_0x6ebb71(0x12a))/0x4*(parseInt(_0x6ebb71(0x15b))/0x5)+-parseInt(_0x6ebb71(0x127))/0x6*(-parseInt(_0x6ebb71(0x184))/0x7)+parseInt(_0x6ebb71(0x131))/0x8+-parseInt(_0x6ebb71(0x160))/0x9;if(_0x246b63===_0x2d5564)break;else _0x5b7c9f['push'](_0x5b7c9f['shift']());}catch(_0x3ed470){_0x5b7c9f['push'](_0x5b7c9f['shift']());}}}(a43_0x4ef6,0x1a794));Object[a43_0x38df9f(0x146)](exports,a43_0x38df9f(0x15f),{'value':!![]}),exports[a43_0x38df9f(0x13a)]=void 0x0;function a43_0x4954(_0x137cb3,_0x77d35d){const _0x4ef691=a43_0x4ef6();return a43_0x4954=function(_0x4954a3,_0x4cce97){_0x4954a3=_0x4954a3-0x125;let _0x23a69d=_0x4ef691[_0x4954a3];return _0x23a69d;},a43_0x4954(_0x137cb3,_0x77d35d);}const loggerService_1=require(a43_0x38df9f(0x13e));function a43_0x4ef6(){const _0x4ac4c2=['Currency','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Failed\x20to\x20parse\x20JSON\x20response:','FAILED','statusCode','Yes','Amount','===\x20NODA\x20SERVICE\x20ERROR\x20===','===\x20NODA\x20SUCCESS\x20===','84081mnlVaK','HTTP\x20','Failed\x20to\x20verify\x20Noda\x20payment:\x20','noda','TesSoft\x20Payment\x20System/1.0','apiUrl','5XHqqCq','Raw\x20Response\x20Body:','logWhiteDomainResponse','active','__esModule','2646900kaQRMc','POST','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','amount','Business\x20Error:\x20','Response\x20Body:','processing','Unknown\x20error','Error\x20details:','paid','logWhiteDomainRequest','184980aLazHZ','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Payment\x20Link\x20ID:','entries','https://tesoft.uk/gateway/noda/webhook/','timeout','Error\x20stack:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Method',',\x20body:\x20','stack','===\x20NODA\x20API\x20ERROR\x20===','failed','toUpperCase','application/json','431506MGWuPz','Order\x20ID\x20Used:','Missing\x20id\x20or\x20shortLink\x20in\x20response','loggerService','PAID','Unknown\x20error\x20from\x20Noda\x20API','stringify','qrCodeLink','Noda\x20webhook\x20signature\x20verification:','MerchantPaymentId','16870tWskvz','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','https://tesoft.uk/gateway/pending.php?id=','Response\x20data:','pending','created','/payment-links','Status','Error\x20Message:','log','JSON\x20Parse\x20Error:\x20','parse','fromEntries','canceled','expiryDate','text','statusText','currency','shortLinkUrls','Short\x20Link:','Name','completed','now','126cyeLjT','/payment-links/','SettlementDate','754604GFUMWJ','Processing\x20Noda\x20webhook:','PENDING','Remitter','logWhiteDomainError','status','toLowerCase','1432664Opabew','message','https://tesoft.uk/gateway/noda/','PaymentId','Noda\x20API\x20error:\x20','verifyWebhookSignature','in_progress','shortLink','verifyPayment','NodaService','Request\x20Body\x20(Direct\x20JSON):','Iban','expired','../loggerService','isActive','headers','HTTP\x20error!\x20status:\x20','error','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','GET','Response\x20Time:','defineProperty','EXPIRED','Settled','createPaymentLink','success','HTTP\x20Status:'];a43_0x4ef6=function(){return _0x4ac4c2;};return a43_0x4ef6();}class NodaService{constructor(){const _0x501151=a43_0x38df9f;this[_0x501151(0x15a)]=_0x501151(0x133),console[_0x501151(0x18e)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a43_0x38df9f(0x149)](_0x3a6f0e){const _0x1940a5=a43_0x38df9f,{orderId:_0x45352f,name:_0x1551c0,paymentDescription:_0x54588f,amount:_0x57ce85,currency:_0x56f1a8,webhookUrl:_0x3cfc39,returnUrl:_0xfac316,expiryDate:_0x6fe912}=_0x3a6f0e,_0x120adc=_0x56f1a8[_0x1940a5(0x178)](),_0x5da8b1=_0x1940a5(0x16f),_0x2b9a5a=_0x1940a5(0x187)+_0x45352f,_0x5d5dd9={'name':_0x1551c0,'paymentDescription':_0x54588f,'amount':_0x57ce85,'currency':_0x120adc,'paymentId':_0x45352f,'webhookUrl':_0x5da8b1,'returnUrl':_0x2b9a5a};_0x6fe912&&(_0x5d5dd9['expiryDate']=_0x6fe912);const _0x436d89=Date[_0x1940a5(0x126)]();try{console[_0x1940a5(0x18e)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x1940a5(0x18e)]('URL:',this['apiUrl']),console[_0x1940a5(0x18e)](_0x1940a5(0x13b),JSON[_0x1940a5(0x180)](_0x5d5dd9,null,0x2)),console[_0x1940a5(0x18e)]('Order\x20ID\x20Format:',_0x45352f,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x1940a5(0x18e)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x2b9a5a),loggerService_1['loggerService'][_0x1940a5(0x16a)]('noda',_0x1940a5(0x18b),_0x1940a5(0x161),_0x5d5dd9);const _0x19b01f=await fetch(this[_0x1940a5(0x15a)],{'method':'POST','headers':{'Content-Type':_0x1940a5(0x179),'Accept':_0x1940a5(0x179),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1940a5(0x180)](_0x5d5dd9)}),_0x56f48b=Date[_0x1940a5(0x126)]()-_0x436d89;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log']('Status:',_0x19b01f[_0x1940a5(0x12f)]),console[_0x1940a5(0x18e)]('Status\x20Text:',_0x19b01f[_0x1940a5(0x195)]),console[_0x1940a5(0x18e)]('Headers:',Object[_0x1940a5(0x191)](_0x19b01f[_0x1940a5(0x140)][_0x1940a5(0x16e)]())),console[_0x1940a5(0x18e)](_0x1940a5(0x145),_0x56f48b+'ms');const _0x384838=await _0x19b01f[_0x1940a5(0x194)]();console[_0x1940a5(0x18e)](_0x1940a5(0x15c),_0x384838);if(!_0x19b01f['ok']){console['error'](_0x1940a5(0x176)),console[_0x1940a5(0x142)](_0x1940a5(0x14b),_0x19b01f['status']),console[_0x1940a5(0x142)](_0x1940a5(0x165),_0x384838),loggerService_1[_0x1940a5(0x17d)][_0x1940a5(0x15d)](_0x1940a5(0x158),_0x1940a5(0x18b),_0x19b01f['status'],_0x384838,_0x56f48b),loggerService_1[_0x1940a5(0x17d)][_0x1940a5(0x12e)](_0x1940a5(0x158),'/payment-links',_0x1940a5(0x156)+_0x19b01f[_0x1940a5(0x12f)]+':\x20'+_0x384838);if(_0x19b01f[_0x1940a5(0x12f)]===0x190)throw new Error(_0x1940a5(0x185));else{if(_0x19b01f[_0x1940a5(0x12f)]===0x1f4)throw new Error(_0x1940a5(0x16c));}throw new Error(_0x1940a5(0x141)+_0x19b01f[_0x1940a5(0x12f)]+_0x1940a5(0x174)+_0x384838);}let _0x18039d;try{_0x18039d=JSON[_0x1940a5(0x190)](_0x384838);}catch(_0x4477e6){console['error'](_0x1940a5(0x14e),_0x4477e6),loggerService_1[_0x1940a5(0x17d)][_0x1940a5(0x12e)](_0x1940a5(0x158),_0x1940a5(0x18b),_0x1940a5(0x18f)+_0x4477e6);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x384838);}console[_0x1940a5(0x18e)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x1940a5(0x18e)]('Parsed\x20Result:',JSON[_0x1940a5(0x180)](_0x18039d,null,0x2)),loggerService_1[_0x1940a5(0x17d)]['logWhiteDomainResponse'](_0x1940a5(0x158),_0x1940a5(0x18b),_0x19b01f[_0x1940a5(0x12f)],_0x18039d,_0x56f48b);if(_0x18039d[_0x1940a5(0x142)]||_0x18039d[_0x1940a5(0x150)]){const _0x5d8ac3=_0x18039d[_0x1940a5(0x132)]||_0x18039d[_0x1940a5(0x142)]||_0x1940a5(0x17f);console['error']('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x1940a5(0x142)](_0x1940a5(0x18d),_0x5d8ac3),console[_0x1940a5(0x142)]('Status\x20Code:',_0x18039d[_0x1940a5(0x150)]),loggerService_1[_0x1940a5(0x17d)][_0x1940a5(0x12e)](_0x1940a5(0x158),_0x1940a5(0x18b),_0x1940a5(0x164)+_0x5d8ac3);throw new Error(_0x1940a5(0x135)+_0x5d8ac3);}if(!_0x18039d['id']||!_0x18039d[_0x1940a5(0x197)]?.[_0x1940a5(0x138)]){console[_0x1940a5(0x142)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1940a5(0x142)](_0x1940a5(0x17c)),console[_0x1940a5(0x142)](_0x1940a5(0x188),_0x18039d),loggerService_1[_0x1940a5(0x17d)][_0x1940a5(0x12e)](_0x1940a5(0x158),'/payment-links',_0x1940a5(0x143));throw new Error(_0x1940a5(0x186));}return console[_0x1940a5(0x18e)](_0x1940a5(0x154)),console[_0x1940a5(0x18e)](_0x1940a5(0x16d),_0x18039d['id']),console['log'](_0x1940a5(0x198),_0x18039d[_0x1940a5(0x197)][_0x1940a5(0x138)]),console['log']('QR\x20Code\x20Link:',_0x18039d['shortLinkUrls']['qrCodeLink']||'Not\x20provided'),console[_0x1940a5(0x18e)](_0x1940a5(0x17b),_0x45352f,'(8digits-8digits\x20format)'),console['log'](_0x1940a5(0x14d),_0x2b9a5a),{'gateway_payment_id':_0x18039d['id'],'payment_url':_0x18039d['shortLinkUrls'][_0x1940a5(0x138)],'qr_code_url':_0x18039d[_0x1940a5(0x197)][_0x1940a5(0x181)],'expiry_date':_0x18039d[_0x1940a5(0x193)]};}catch(_0x1639fc){console['error'](_0x1940a5(0x153)),console[_0x1940a5(0x142)](_0x1940a5(0x168),_0x1639fc),loggerService_1[_0x1940a5(0x17d)]['logWhiteDomainError'](_0x1940a5(0x158),'/payment-links',_0x1639fc);if(_0x1639fc instanceof Error){console[_0x1940a5(0x142)]('Error\x20message:',_0x1639fc[_0x1940a5(0x132)]),console[_0x1940a5(0x142)](_0x1940a5(0x171),_0x1639fc[_0x1940a5(0x175)]);throw new Error(_0x1940a5(0x172)+_0x1639fc[_0x1940a5(0x132)]);}throw new Error(_0x1940a5(0x162));}}async[a43_0x38df9f(0x139)](_0x5c308a){const _0x209f61=a43_0x38df9f,_0x4f6e2e=Date['now']();try{loggerService_1[_0x209f61(0x17d)][_0x209f61(0x16a)](_0x209f61(0x158),_0x209f61(0x128)+_0x5c308a,_0x209f61(0x144),{});const _0x1e40c1=await fetch(this['apiUrl']+'/'+_0x5c308a,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x209f61(0x159)}}),_0xdef6e1=Date[_0x209f61(0x126)]()-_0x4f6e2e;if(!_0x1e40c1['ok']){const _0x28a1ec=await _0x1e40c1[_0x209f61(0x194)]();loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0x209f61(0x128)+_0x5c308a,_0x1e40c1['status'],_0x28a1ec,_0xdef6e1);throw new Error(_0x209f61(0x141)+_0x1e40c1[_0x209f61(0x12f)]);}const _0x5a521f=await _0x1e40c1['json']();loggerService_1[_0x209f61(0x17d)][_0x209f61(0x15d)]('noda','/payment-links/'+_0x5c308a,_0x1e40c1[_0x209f61(0x12f)],_0x5a521f,_0xdef6e1);if(_0x5a521f[_0x209f61(0x142)]||_0x5a521f[_0x209f61(0x150)]){loggerService_1[_0x209f61(0x17d)][_0x209f61(0x12e)](_0x209f61(0x158),_0x209f61(0x128)+_0x5c308a,_0x209f61(0x135)+(_0x5a521f[_0x209f61(0x132)]||_0x5a521f[_0x209f61(0x142)]||_0x209f61(0x167)));throw new Error('Noda\x20API\x20error:\x20'+(_0x5a521f['message']||_0x5a521f[_0x209f61(0x142)]||_0x209f61(0x167)));}let _0x21aaa8='PENDING';if(_0x5a521f[_0x209f61(0x13f)]===![]){if(_0x5a521f['expiryDate']){const _0xe22107=new Date(_0x5a521f[_0x209f61(0x193)]),_0x5016e8=new Date();_0xe22107<_0x5016e8?_0x21aaa8=_0x209f61(0x147):_0x21aaa8=_0x209f61(0x14f);}else _0x21aaa8=_0x209f61(0x14f);}else _0x21aaa8=_0x209f61(0x12c);return{'status':_0x21aaa8,'amount':_0x5a521f[_0x209f61(0x163)],'currency':_0x5a521f[_0x209f61(0x196)],'isActive':_0x5a521f[_0x209f61(0x13f)]};}catch(_0x4211df){console['error']('Noda\x20payment\x20verification\x20error:',_0x4211df),loggerService_1[_0x209f61(0x17d)]['logWhiteDomainError']('noda',_0x209f61(0x128)+_0x5c308a,_0x4211df);throw new Error(_0x209f61(0x157)+(_0x4211df instanceof Error?_0x4211df[_0x209f61(0x132)]:'Unknown\x20error'));}}async['processWebhook'](_0x2b5676){const _0x4c37a3=a43_0x38df9f;console[_0x4c37a3(0x18e)](_0x4c37a3(0x12b),_0x2b5676);let _0x2da09e='PENDING';switch(_0x2b5676[_0x4c37a3(0x18c)]?.[_0x4c37a3(0x130)]()){case'done':case _0x4c37a3(0x125):case _0x4c37a3(0x169):case _0x4c37a3(0x14a):case'successful':_0x2b5676[_0x4c37a3(0x148)]===_0x4c37a3(0x151)?_0x2da09e=_0x4c37a3(0x17e):_0x2da09e=_0x4c37a3(0x12c);break;case'cancelled':case _0x4c37a3(0x192):case _0x4c37a3(0x177):case _0x4c37a3(0x142):case'rejected':_0x2da09e='FAILED';break;case _0x4c37a3(0x13d):case _0x4c37a3(0x170):_0x2da09e=_0x4c37a3(0x147);break;case _0x4c37a3(0x189):case _0x4c37a3(0x18a):case _0x4c37a3(0x15e):case _0x4c37a3(0x166):case _0x4c37a3(0x137):default:_0x2da09e=_0x4c37a3(0x12c);break;}return{'paymentId':_0x2b5676[_0x4c37a3(0x183)]||_0x2b5676[_0x4c37a3(0x134)],'status':_0x2da09e,'amount':_0x2b5676[_0x4c37a3(0x152)],'currency':_0x2b5676[_0x4c37a3(0x14c)],'additionalInfo':{'method':_0x2b5676[_0x4c37a3(0x173)],'bankId':_0x2b5676['BankId'],'settled':_0x2b5676[_0x4c37a3(0x148)],'settlementDate':_0x2b5676[_0x4c37a3(0x129)],'remitterName':_0x2b5676[_0x4c37a3(0x12d)]?.[_0x4c37a3(0x199)],'remitterIban':_0x2b5676['Remitter']?.[_0x4c37a3(0x13c)],'bankTransactionId':_0x2b5676['BankTransactionId']}};}[a43_0x38df9f(0x136)](_0x2049c6,_0x31ca31){const _0x5e46d2=a43_0x38df9f;return console[_0x5e46d2(0x18e)](_0x5e46d2(0x182),{'receivedSignature':_0x31ca31,'paymentId':_0x2049c6[_0x5e46d2(0x134)],'merchantPaymentId':_0x2049c6[_0x5e46d2(0x183)]}),!![];}}exports[a43_0x38df9f(0x13a)]=NodaService;