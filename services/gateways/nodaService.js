'use strict';function a40_0x80f4(){const _0x13fb59=['fromEntries','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Unknown\x20error','logWhiteDomainResponse','Status\x20Text:','190228oIrOqh','statusText','toLowerCase','toUpperCase','Failed\x20to\x20parse\x20JSON\x20response:','https://tesoft.uk/gateway/noda/webhook/','now','qrCodeLink','text','Name','cancelled','URL:','verifyPayment','isActive','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','EXPIRED',',\x20body:\x20','stringify','expiryDate','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','NodaService','Missing\x20id\x20or\x20shortLink\x20in\x20response','expired','in_progress','apiUrl','Status','https://tesoft.uk/gateway/success.php?id=','Error\x20details:','done','HTTP\x20error!\x20status:\x20','Processing\x20Noda\x20webhook:','parse','/payment-links','JSON\x20Parse\x20Error:\x20','QR\x20Code\x20Link:','success','Failed\x20to\x20verify\x20Noda\x20payment:\x20','23397ojaFsE','active','PaymentId','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','FAILED','Error\x20stack:','MerchantPaymentId','stack','Business\x20Error:\x20','Response\x20data:','shortLink','BankTransactionId','entries','Order\x20ID\x20Used:','rejected','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','processWebhook','application/json','amount','https://tesoft.uk/gateway/noda/','timeout','Yes','===\x20NODA\x20SUCCESS\x20===','Unknown\x20error\x20from\x20Noda\x20API','logWhiteDomainRequest','Error\x20Message:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','statusCode','GET','TesSoft\x20Payment\x20System/1.0','Payment\x20Link\x20ID:','failed','noda','Short\x20Link:','currency','status','Noda\x20API\x20error:\x20','paid','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','32HZAqEO','canceled','620985pxBzBV','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Headers:','HTTP\x20','pending','2996490QYflXG','PAID','completed','log','3147739lVzFaV','===\x20PARSED\x20NODA\x20RESPONSE\x20===','logWhiteDomainError','/payment-links/','Settled','message','POST','(8digits-8digits\x20format)','shortLinkUrls','../loggerService','9127616fDXnAc','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','successful','===\x20NODA\x20SERVICE\x20ERROR\x20===','loggerService','Response\x20Body:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Response\x20Time:','error','verifyWebhookSignature','1826112zkxnEs','Not\x20provided','Noda\x20webhook\x20signature\x20verification:','PENDING','Parsed\x20Result:','Status\x20Code:'];a40_0x80f4=function(){return _0x13fb59;};return a40_0x80f4();}const a40_0x436b1d=a40_0x4851;(function(_0x5cc8be,_0x1f58bc){const _0x323b61=a40_0x4851,_0x29ae74=_0x5cc8be();while(!![]){try{const _0x17b334=-parseInt(_0x323b61(0x1f4))/0x1+parseInt(_0x323b61(0x240))/0x2*(-parseInt(_0x323b61(0x219))/0x3)+-parseInt(_0x323b61(0x1e9))/0x4+-parseInt(_0x323b61(0x242))/0x5+parseInt(_0x323b61(0x247))/0x6+-parseInt(_0x323b61(0x24b))/0x7+parseInt(_0x323b61(0x255))/0x8;if(_0x17b334===_0x1f58bc)break;else _0x29ae74['push'](_0x29ae74['shift']());}catch(_0x34fde1){_0x29ae74['push'](_0x29ae74['shift']());}}}(a40_0x80f4,0x48029));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a40_0x436b1d(0x254));class NodaService{constructor(){const _0x34a09a=a40_0x436b1d;this['apiUrl']=_0x34a09a(0x22c),console[_0x34a09a(0x24a)](_0x34a09a(0x207));}async['createPaymentLink'](_0x48b444){const _0x8e9eb0=a40_0x436b1d,{orderId:_0x94ef53,name:_0x575e49,paymentDescription:_0x5d0dba,amount:_0x456839,currency:_0x3e9d6c,webhookUrl:_0x1bea69,returnUrl:_0x13dfc2,expiryDate:_0x280d58}=_0x48b444,_0x37e118=_0x3e9d6c[_0x8e9eb0(0x1f7)](),_0x5213ab=_0x8e9eb0(0x1f9),_0x15db23=_0x8e9eb0(0x20e)+_0x94ef53,_0x5ef47a={'name':_0x575e49,'paymentDescription':_0x5d0dba,'amount':_0x456839,'currency':_0x37e118,'paymentId':_0x94ef53,'webhookUrl':_0x5213ab,'returnUrl':_0x15db23};_0x280d58&&(_0x5ef47a[_0x8e9eb0(0x206)]=_0x280d58);const _0x39448d=Date['now']();try{console['log'](_0x8e9eb0(0x233)),console[_0x8e9eb0(0x24a)](_0x8e9eb0(0x1ff),this[_0x8e9eb0(0x20c)]),console[_0x8e9eb0(0x24a)]('Request\x20Body\x20(Direct\x20JSON):',JSON['stringify'](_0x5ef47a,null,0x2)),console[_0x8e9eb0(0x24a)]('Order\x20ID\x20Format:',_0x94ef53,'(8digits-8digits\x20format\x20for\x20Noda)'),loggerService_1[_0x8e9eb0(0x259)][_0x8e9eb0(0x231)](_0x8e9eb0(0x239),_0x8e9eb0(0x214),'POST',_0x5ef47a);const _0x3a0242=await fetch(this['apiUrl'],{'method':_0x8e9eb0(0x251),'headers':{'Content-Type':_0x8e9eb0(0x22a),'Accept':_0x8e9eb0(0x22a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x8e9eb0(0x205)](_0x5ef47a)}),_0x1b8aa=Date[_0x8e9eb0(0x1fa)]()-_0x39448d;console[_0x8e9eb0(0x24a)](_0x8e9eb0(0x256)),console['log']('Status:',_0x3a0242['status']),console[_0x8e9eb0(0x24a)](_0x8e9eb0(0x1f3),_0x3a0242[_0x8e9eb0(0x1f5)]),console['log'](_0x8e9eb0(0x244),Object[_0x8e9eb0(0x1ef)](_0x3a0242['headers'][_0x8e9eb0(0x225)]())),console[_0x8e9eb0(0x24a)](_0x8e9eb0(0x1e6),_0x1b8aa+'ms');const _0x27c0ed=await _0x3a0242[_0x8e9eb0(0x1fc)]();console[_0x8e9eb0(0x24a)]('Raw\x20Response\x20Body:',_0x27c0ed);if(!_0x3a0242['ok']){console[_0x8e9eb0(0x1e7)]('===\x20NODA\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x3a0242[_0x8e9eb0(0x23c)]),console[_0x8e9eb0(0x1e7)](_0x8e9eb0(0x1e4),_0x27c0ed),loggerService_1[_0x8e9eb0(0x259)][_0x8e9eb0(0x1f2)]('noda',_0x8e9eb0(0x214),_0x3a0242['status'],_0x27c0ed,_0x1b8aa),loggerService_1[_0x8e9eb0(0x259)]['logWhiteDomainError'](_0x8e9eb0(0x239),_0x8e9eb0(0x214),_0x8e9eb0(0x245)+_0x3a0242['status']+':\x20'+_0x27c0ed);if(_0x3a0242[_0x8e9eb0(0x23c)]===0x190)throw new Error(_0x8e9eb0(0x1f0));else{if(_0x3a0242[_0x8e9eb0(0x23c)]===0x1f4)throw new Error(_0x8e9eb0(0x23f));}throw new Error(_0x8e9eb0(0x211)+_0x3a0242[_0x8e9eb0(0x23c)]+_0x8e9eb0(0x204)+_0x27c0ed);}let _0x4b58c1;try{_0x4b58c1=JSON[_0x8e9eb0(0x213)](_0x27c0ed);}catch(_0x2a5bc0){console[_0x8e9eb0(0x1e7)](_0x8e9eb0(0x1f8),_0x2a5bc0),loggerService_1[_0x8e9eb0(0x259)][_0x8e9eb0(0x24d)]('noda',_0x8e9eb0(0x214),_0x8e9eb0(0x215)+_0x2a5bc0);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x27c0ed);}console[_0x8e9eb0(0x24a)](_0x8e9eb0(0x24c)),console[_0x8e9eb0(0x24a)](_0x8e9eb0(0x1ed),JSON[_0x8e9eb0(0x205)](_0x4b58c1,null,0x2)),loggerService_1[_0x8e9eb0(0x259)][_0x8e9eb0(0x1f2)](_0x8e9eb0(0x239),'/payment-links',_0x3a0242[_0x8e9eb0(0x23c)],_0x4b58c1,_0x1b8aa);if(_0x4b58c1['error']||_0x4b58c1['statusCode']){const _0x28ff1c=_0x4b58c1['message']||_0x4b58c1[_0x8e9eb0(0x1e7)]||_0x8e9eb0(0x230);console[_0x8e9eb0(0x1e7)](_0x8e9eb0(0x1e5)),console[_0x8e9eb0(0x1e7)](_0x8e9eb0(0x232),_0x28ff1c),console['error'](_0x8e9eb0(0x1ee),_0x4b58c1[_0x8e9eb0(0x234)]),loggerService_1[_0x8e9eb0(0x259)][_0x8e9eb0(0x24d)]('noda','/payment-links',_0x8e9eb0(0x221)+_0x28ff1c);throw new Error(_0x8e9eb0(0x23d)+_0x28ff1c);}if(!_0x4b58c1['id']||!_0x4b58c1[_0x8e9eb0(0x253)]?.['shortLink']){console[_0x8e9eb0(0x1e7)](_0x8e9eb0(0x21c)),console[_0x8e9eb0(0x1e7)](_0x8e9eb0(0x209)),console[_0x8e9eb0(0x1e7)](_0x8e9eb0(0x222),_0x4b58c1),loggerService_1[_0x8e9eb0(0x259)][_0x8e9eb0(0x24d)](_0x8e9eb0(0x239),'/payment-links',_0x8e9eb0(0x228));throw new Error(_0x8e9eb0(0x202));}return console[_0x8e9eb0(0x24a)](_0x8e9eb0(0x22f)),console['log'](_0x8e9eb0(0x237),_0x4b58c1['id']),console[_0x8e9eb0(0x24a)](_0x8e9eb0(0x23a),_0x4b58c1[_0x8e9eb0(0x253)][_0x8e9eb0(0x223)]),console[_0x8e9eb0(0x24a)](_0x8e9eb0(0x216),_0x4b58c1['shortLinkUrls'][_0x8e9eb0(0x1fb)]||_0x8e9eb0(0x1ea)),console[_0x8e9eb0(0x24a)](_0x8e9eb0(0x226),_0x94ef53,_0x8e9eb0(0x252)),{'gateway_payment_id':_0x4b58c1['id'],'payment_url':_0x4b58c1[_0x8e9eb0(0x253)]['shortLink'],'qr_code_url':_0x4b58c1[_0x8e9eb0(0x253)][_0x8e9eb0(0x1fb)],'expiry_date':_0x4b58c1[_0x8e9eb0(0x206)]};}catch(_0x52b856){console[_0x8e9eb0(0x1e7)](_0x8e9eb0(0x258)),console[_0x8e9eb0(0x1e7)](_0x8e9eb0(0x20f),_0x52b856),loggerService_1['loggerService'][_0x8e9eb0(0x24d)]('noda',_0x8e9eb0(0x214),_0x52b856);if(_0x52b856 instanceof Error){console[_0x8e9eb0(0x1e7)]('Error\x20message:',_0x52b856['message']),console[_0x8e9eb0(0x1e7)](_0x8e9eb0(0x21e),_0x52b856[_0x8e9eb0(0x220)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x52b856[_0x8e9eb0(0x250)]);}throw new Error(_0x8e9eb0(0x243));}}async[a40_0x436b1d(0x200)](_0x295712){const _0xa37d8f=a40_0x436b1d,_0x23c066=Date[_0xa37d8f(0x1fa)]();try{loggerService_1[_0xa37d8f(0x259)][_0xa37d8f(0x231)](_0xa37d8f(0x239),'/payment-links/'+_0x295712,_0xa37d8f(0x235),{});const _0x1bad20=await fetch(this[_0xa37d8f(0x20c)]+'/'+_0x295712,{'method':_0xa37d8f(0x235),'headers':{'Content-Type':_0xa37d8f(0x22a),'User-Agent':_0xa37d8f(0x236)}}),_0x38e6cd=Date['now']()-_0x23c066;if(!_0x1bad20['ok']){const _0x55b5f7=await _0x1bad20[_0xa37d8f(0x1fc)]();loggerService_1[_0xa37d8f(0x259)]['logWhiteDomainResponse'](_0xa37d8f(0x239),'/payment-links/'+_0x295712,_0x1bad20[_0xa37d8f(0x23c)],_0x55b5f7,_0x38e6cd);throw new Error(_0xa37d8f(0x211)+_0x1bad20[_0xa37d8f(0x23c)]);}const _0x4da482=await _0x1bad20['json']();loggerService_1[_0xa37d8f(0x259)][_0xa37d8f(0x1f2)](_0xa37d8f(0x239),'/payment-links/'+_0x295712,_0x1bad20[_0xa37d8f(0x23c)],_0x4da482,_0x38e6cd);if(_0x4da482[_0xa37d8f(0x1e7)]||_0x4da482['statusCode']){loggerService_1[_0xa37d8f(0x259)][_0xa37d8f(0x24d)](_0xa37d8f(0x239),_0xa37d8f(0x24e)+_0x295712,_0xa37d8f(0x23d)+(_0x4da482[_0xa37d8f(0x250)]||_0x4da482[_0xa37d8f(0x1e7)]||_0xa37d8f(0x1f1)));throw new Error(_0xa37d8f(0x23d)+(_0x4da482[_0xa37d8f(0x250)]||_0x4da482[_0xa37d8f(0x1e7)]||_0xa37d8f(0x1f1)));}let _0x17d7a8=_0xa37d8f(0x1ec);if(_0x4da482[_0xa37d8f(0x201)]===![]){if(_0x4da482[_0xa37d8f(0x206)]){const _0x5b01ba=new Date(_0x4da482[_0xa37d8f(0x206)]),_0x2b409e=new Date();_0x5b01ba<_0x2b409e?_0x17d7a8=_0xa37d8f(0x203):_0x17d7a8=_0xa37d8f(0x21d);}else _0x17d7a8=_0xa37d8f(0x21d);}else _0x17d7a8=_0xa37d8f(0x1ec);return{'status':_0x17d7a8,'amount':_0x4da482[_0xa37d8f(0x22b)],'currency':_0x4da482[_0xa37d8f(0x23b)],'isActive':_0x4da482[_0xa37d8f(0x201)]};}catch(_0xa4bf42){console[_0xa37d8f(0x1e7)]('Noda\x20payment\x20verification\x20error:',_0xa4bf42),loggerService_1[_0xa37d8f(0x259)][_0xa37d8f(0x24d)](_0xa37d8f(0x239),_0xa37d8f(0x24e)+_0x295712,_0xa4bf42);throw new Error(_0xa37d8f(0x218)+(_0xa4bf42 instanceof Error?_0xa4bf42[_0xa37d8f(0x250)]:_0xa37d8f(0x1f1)));}}async[a40_0x436b1d(0x229)](_0x4ef82b){const _0x1401e9=a40_0x436b1d;console[_0x1401e9(0x24a)](_0x1401e9(0x212),_0x4ef82b);let _0x211746=_0x1401e9(0x1ec);switch(_0x4ef82b[_0x1401e9(0x20d)]?.[_0x1401e9(0x1f6)]()){case _0x1401e9(0x210):case _0x1401e9(0x249):case _0x1401e9(0x23e):case _0x1401e9(0x217):case _0x1401e9(0x257):_0x4ef82b['Settled']===_0x1401e9(0x22e)?_0x211746=_0x1401e9(0x248):_0x211746=_0x1401e9(0x1ec);break;case _0x1401e9(0x1fe):case _0x1401e9(0x241):case _0x1401e9(0x238):case _0x1401e9(0x1e7):case _0x1401e9(0x227):_0x211746=_0x1401e9(0x21d);break;case _0x1401e9(0x20a):case _0x1401e9(0x22d):_0x211746=_0x1401e9(0x203);break;case _0x1401e9(0x246):case'created':case _0x1401e9(0x21a):case'processing':case _0x1401e9(0x20b):default:_0x211746=_0x1401e9(0x1ec);break;}return{'paymentId':_0x4ef82b[_0x1401e9(0x21f)]||_0x4ef82b[_0x1401e9(0x21b)],'status':_0x211746,'amount':_0x4ef82b['Amount'],'currency':_0x4ef82b['Currency'],'additionalInfo':{'method':_0x4ef82b['Method'],'bankId':_0x4ef82b['BankId'],'settled':_0x4ef82b[_0x1401e9(0x24f)],'settlementDate':_0x4ef82b['SettlementDate'],'remitterName':_0x4ef82b['Remitter']?.[_0x1401e9(0x1fd)],'remitterIban':_0x4ef82b['Remitter']?.['Iban'],'bankTransactionId':_0x4ef82b[_0x1401e9(0x224)]}};}[a40_0x436b1d(0x1e8)](_0x4ade88,_0x780ff7){const _0x1660a7=a40_0x436b1d;return console[_0x1660a7(0x24a)](_0x1660a7(0x1eb),{'receivedSignature':_0x780ff7,'paymentId':_0x4ade88[_0x1660a7(0x21b)],'merchantPaymentId':_0x4ade88[_0x1660a7(0x21f)]}),!![];}}function a40_0x4851(_0x242e3f,_0x3df955){const _0x80f46f=a40_0x80f4();return a40_0x4851=function(_0x4851a3,_0x50f766){_0x4851a3=_0x4851a3-0x1e4;let _0x9dc04c=_0x80f46f[_0x4851a3];return _0x9dc04c;},a40_0x4851(_0x242e3f,_0x3df955);}exports[a40_0x436b1d(0x208)]=NodaService;