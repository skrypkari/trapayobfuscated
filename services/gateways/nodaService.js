'use strict';const a39_0x1730ba=a39_0x37c1;(function(_0x178e0f,_0x54ab04){const _0x2a4653=a39_0x37c1,_0xdf0674=_0x178e0f();while(!![]){try{const _0x397c39=-parseInt(_0x2a4653(0x1a2))/0x1+parseInt(_0x2a4653(0x197))/0x2+parseInt(_0x2a4653(0x1a9))/0x3*(parseInt(_0x2a4653(0x15a))/0x4)+-parseInt(_0x2a4653(0x165))/0x5+parseInt(_0x2a4653(0x147))/0x6+parseInt(_0x2a4653(0x191))/0x7+parseInt(_0x2a4653(0x196))/0x8;if(_0x397c39===_0x54ab04)break;else _0xdf0674['push'](_0xdf0674['shift']());}catch(_0x586d5d){_0xdf0674['push'](_0xdf0674['shift']());}}}(a39_0x1082,0x8389e));Object[a39_0x1730ba(0x152)](exports,'__esModule',{'value':!![]}),exports[a39_0x1730ba(0x19a)]=void 0x0;function a39_0x37c1(_0x363066,_0x4c38e6){const _0x10828c=a39_0x1082();return a39_0x37c1=function(_0x37c1b5,_0x22c604){_0x37c1b5=_0x37c1b5-0x13c;let _0x2ca6ed=_0x10828c[_0x37c1b5];return _0x2ca6ed;},a39_0x37c1(_0x363066,_0x4c38e6);}const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x1fe77c=a39_0x1730ba;this['apiUrl']=_0x1fe77c(0x153),console['log'](_0x1fe77c(0x1a3));}async['createPaymentLink'](_0x3d9688){const _0x1c589f=a39_0x1730ba,{orderId:_0x5a223b,name:_0x5f5a5c,paymentDescription:_0x50ac21,amount:_0x5a9642,currency:_0x5a3755,webhookUrl:_0x49da3c,returnUrl:_0x33d689,expiryDate:_0x1c6684}=_0x3d9688,_0x2a9726=_0x5a3755['toUpperCase'](),_0xc9f44c=_0x1c589f(0x156),_0x3480e5=_0x1c589f(0x18a)+_0x5a223b,_0x2bdb79={'name':_0x5f5a5c,'paymentDescription':_0x50ac21,'amount':_0x5a9642,'currency':_0x2a9726,'paymentId':_0x5a223b,'webhookUrl':_0xc9f44c,'returnUrl':_0x3480e5};_0x1c6684&&(_0x2bdb79[_0x1c589f(0x144)]=_0x1c6684);const _0x2a9efa=Date[_0x1c589f(0x16a)]();try{console[_0x1c589f(0x142)](_0x1c589f(0x19b)),console[_0x1c589f(0x142)]('URL:',this['apiUrl']),console['log'](_0x1c589f(0x168),JSON['stringify'](_0x2bdb79,null,0x2)),console[_0x1c589f(0x142)](_0x1c589f(0x13d),_0x5a223b,_0x1c589f(0x17c)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x1c589f(0x141),'/payment-links',_0x1c589f(0x160),_0x2bdb79);const _0x2ee535=await fetch(this[_0x1c589f(0x1a4)],{'method':_0x1c589f(0x160),'headers':{'Content-Type':_0x1c589f(0x1a5),'Accept':_0x1c589f(0x1a5),'User-Agent':_0x1c589f(0x15c)},'body':JSON[_0x1c589f(0x14b)](_0x2bdb79)}),_0x33cba5=Date[_0x1c589f(0x16a)]()-_0x2a9efa;console[_0x1c589f(0x142)](_0x1c589f(0x16c)),console[_0x1c589f(0x142)](_0x1c589f(0x16e),_0x2ee535[_0x1c589f(0x166)]),console[_0x1c589f(0x142)](_0x1c589f(0x187),_0x2ee535[_0x1c589f(0x19e)]),console[_0x1c589f(0x142)](_0x1c589f(0x174),Object[_0x1c589f(0x1a1)](_0x2ee535[_0x1c589f(0x177)][_0x1c589f(0x173)]())),console['log'](_0x1c589f(0x149),_0x33cba5+'ms');const _0x497ec0=await _0x2ee535['text']();console[_0x1c589f(0x142)](_0x1c589f(0x1a0),_0x497ec0);if(!_0x2ee535['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x1c589f(0x188)]('HTTP\x20Status:',_0x2ee535[_0x1c589f(0x166)]),console[_0x1c589f(0x188)](_0x1c589f(0x13c),_0x497ec0),loggerService_1['loggerService'][_0x1c589f(0x18d)](_0x1c589f(0x141),_0x1c589f(0x14a),_0x2ee535['status'],_0x497ec0,_0x33cba5),loggerService_1[_0x1c589f(0x19d)][_0x1c589f(0x18f)](_0x1c589f(0x141),'/payment-links','HTTP\x20'+_0x2ee535['status']+':\x20'+_0x497ec0);if(_0x2ee535[_0x1c589f(0x166)]===0x190)throw new Error(_0x1c589f(0x179));else{if(_0x2ee535['status']===0x1f4)throw new Error(_0x1c589f(0x1a6));}throw new Error(_0x1c589f(0x184)+_0x2ee535[_0x1c589f(0x166)]+',\x20body:\x20'+_0x497ec0);}let _0xd863a2;try{_0xd863a2=JSON[_0x1c589f(0x180)](_0x497ec0);}catch(_0x3ce836){console[_0x1c589f(0x188)](_0x1c589f(0x13e),_0x3ce836),loggerService_1[_0x1c589f(0x19d)][_0x1c589f(0x18f)](_0x1c589f(0x141),'/payment-links',_0x1c589f(0x162)+_0x3ce836);throw new Error(_0x1c589f(0x192)+_0x497ec0);}console[_0x1c589f(0x142)](_0x1c589f(0x181)),console['log']('Parsed\x20Result:',JSON['stringify'](_0xd863a2,null,0x2)),loggerService_1[_0x1c589f(0x19d)][_0x1c589f(0x18d)]('noda','/payment-links',_0x2ee535[_0x1c589f(0x166)],_0xd863a2,_0x33cba5);if(_0xd863a2['error']||_0xd863a2['statusCode']){const _0x30a851=_0xd863a2[_0x1c589f(0x176)]||_0xd863a2['error']||_0x1c589f(0x194);console['error'](_0x1c589f(0x1aa)),console[_0x1c589f(0x188)](_0x1c589f(0x195),_0x30a851),console[_0x1c589f(0x188)]('Status\x20Code:',_0xd863a2[_0x1c589f(0x14d)]),loggerService_1[_0x1c589f(0x19d)][_0x1c589f(0x18f)](_0x1c589f(0x141),_0x1c589f(0x14a),_0x1c589f(0x17b)+_0x30a851);throw new Error(_0x1c589f(0x1ad)+_0x30a851);}if(!_0xd863a2['id']||!_0xd863a2[_0x1c589f(0x189)]?.[_0x1c589f(0x163)]){console['error'](_0x1c589f(0x146)),console[_0x1c589f(0x188)](_0x1c589f(0x16d)),console[_0x1c589f(0x188)](_0x1c589f(0x164),_0xd863a2),loggerService_1[_0x1c589f(0x19d)][_0x1c589f(0x18f)](_0x1c589f(0x141),_0x1c589f(0x14a),_0x1c589f(0x178));throw new Error(_0x1c589f(0x161));}return console[_0x1c589f(0x142)](_0x1c589f(0x17a)),console['log'](_0x1c589f(0x145),_0xd863a2['id']),console['log']('Short\x20Link:',_0xd863a2[_0x1c589f(0x189)]['shortLink']),console['log'](_0x1c589f(0x198),_0xd863a2[_0x1c589f(0x189)]['qrCodeLink']||_0x1c589f(0x190)),console['log'](_0x1c589f(0x170),_0x5a223b,_0x1c589f(0x148)),{'gateway_payment_id':_0xd863a2['id'],'payment_url':_0xd863a2[_0x1c589f(0x189)]['shortLink'],'qr_code_url':_0xd863a2[_0x1c589f(0x189)][_0x1c589f(0x158)],'expiry_date':_0xd863a2['expiryDate']};}catch(_0x4d39fb){console[_0x1c589f(0x188)](_0x1c589f(0x183)),console[_0x1c589f(0x188)](_0x1c589f(0x18b),_0x4d39fb),loggerService_1['loggerService'][_0x1c589f(0x18f)](_0x1c589f(0x141),_0x1c589f(0x14a),_0x4d39fb);if(_0x4d39fb instanceof Error){console['error'](_0x1c589f(0x18c),_0x4d39fb['message']),console['error']('Error\x20stack:',_0x4d39fb[_0x1c589f(0x19f)]);throw new Error(_0x1c589f(0x151)+_0x4d39fb[_0x1c589f(0x176)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a39_0x1730ba(0x143)](_0x363f8a){const _0x1daa65=a39_0x1730ba,_0x238e36=Date[_0x1daa65(0x16a)]();try{loggerService_1['loggerService']['logWhiteDomainRequest']('noda','/payment-links/'+_0x363f8a,'GET',{});const _0x303772=await fetch(this[_0x1daa65(0x1a4)]+'/'+_0x363f8a,{'method':_0x1daa65(0x16f),'headers':{'Content-Type':_0x1daa65(0x1a5),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x30ac5f=Date['now']()-_0x238e36;if(!_0x303772['ok']){const _0x352a48=await _0x303772[_0x1daa65(0x157)]();loggerService_1[_0x1daa65(0x19d)][_0x1daa65(0x18d)](_0x1daa65(0x141),_0x1daa65(0x185)+_0x363f8a,_0x303772['status'],_0x352a48,_0x30ac5f);throw new Error(_0x1daa65(0x184)+_0x303772[_0x1daa65(0x166)]);}const _0x55b907=await _0x303772[_0x1daa65(0x150)]();loggerService_1[_0x1daa65(0x19d)][_0x1daa65(0x18d)]('noda','/payment-links/'+_0x363f8a,_0x303772[_0x1daa65(0x166)],_0x55b907,_0x30ac5f);if(_0x55b907['error']||_0x55b907[_0x1daa65(0x14d)]){loggerService_1[_0x1daa65(0x19d)][_0x1daa65(0x18f)](_0x1daa65(0x141),_0x1daa65(0x185)+_0x363f8a,_0x1daa65(0x1ad)+(_0x55b907['message']||_0x55b907[_0x1daa65(0x188)]||'Unknown\x20error'));throw new Error(_0x1daa65(0x1ad)+(_0x55b907[_0x1daa65(0x176)]||_0x55b907['error']||_0x1daa65(0x18e)));}let _0x3f0aad='PENDING';if(_0x55b907[_0x1daa65(0x1ab)]===![]){if(_0x55b907[_0x1daa65(0x144)]){const _0x12f80f=new Date(_0x55b907[_0x1daa65(0x144)]),_0x4880b4=new Date();_0x12f80f<_0x4880b4?_0x3f0aad=_0x1daa65(0x16b):_0x3f0aad=_0x1daa65(0x15d);}else _0x3f0aad=_0x1daa65(0x15d);}else _0x3f0aad=_0x1daa65(0x14c);return{'status':_0x3f0aad,'amount':_0x55b907[_0x1daa65(0x15e)],'currency':_0x55b907['currency'],'isActive':_0x55b907[_0x1daa65(0x1ab)]};}catch(_0x26af99){console[_0x1daa65(0x188)](_0x1daa65(0x175),_0x26af99),loggerService_1[_0x1daa65(0x19d)][_0x1daa65(0x18f)](_0x1daa65(0x141),_0x1daa65(0x185)+_0x363f8a,_0x26af99);throw new Error(_0x1daa65(0x17d)+(_0x26af99 instanceof Error?_0x26af99[_0x1daa65(0x176)]:'Unknown\x20error'));}}async[a39_0x1730ba(0x172)](_0x37b2ea){const _0x158fa2=a39_0x1730ba;console[_0x158fa2(0x142)](_0x158fa2(0x14f),_0x37b2ea);let _0x41e000=_0x158fa2(0x14c);switch(_0x37b2ea['Status']?.['toLowerCase']()){case'done':case _0x158fa2(0x17e):case'paid':case _0x158fa2(0x186):case _0x158fa2(0x14e):_0x37b2ea[_0x158fa2(0x169)]===_0x158fa2(0x199)?_0x41e000=_0x158fa2(0x182):_0x41e000=_0x158fa2(0x14c);break;case _0x158fa2(0x13f):case _0x158fa2(0x1a8):case _0x158fa2(0x17f):case _0x158fa2(0x188):case'rejected':_0x41e000=_0x158fa2(0x15d);break;case'expired':case'timeout':_0x41e000=_0x158fa2(0x16b);break;case'pending':case _0x158fa2(0x155):case _0x158fa2(0x15b):case _0x158fa2(0x193):case'in_progress':default:_0x41e000=_0x158fa2(0x14c);break;}return{'paymentId':_0x37b2ea[_0x158fa2(0x15f)]||_0x37b2ea[_0x158fa2(0x159)],'status':_0x41e000,'amount':_0x37b2ea[_0x158fa2(0x140)],'currency':_0x37b2ea['Currency'],'additionalInfo':{'method':_0x37b2ea[_0x158fa2(0x167)],'bankId':_0x37b2ea[_0x158fa2(0x154)],'settled':_0x37b2ea['Settled'],'settlementDate':_0x37b2ea[_0x158fa2(0x1ac)],'remitterName':_0x37b2ea[_0x158fa2(0x19c)]?.['Name'],'remitterIban':_0x37b2ea[_0x158fa2(0x19c)]?.[_0x158fa2(0x171)],'bankTransactionId':_0x37b2ea[_0x158fa2(0x1a7)]}};}['verifyWebhookSignature'](_0x12174c,_0x309f72){const _0x3ea529=a39_0x1730ba;return console[_0x3ea529(0x142)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x309f72,'paymentId':_0x12174c[_0x3ea529(0x159)],'merchantPaymentId':_0x12174c[_0x3ea529(0x15f)]}),!![];}}function a39_0x1082(){const _0x49d9ef=['Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','processing','Unknown\x20error\x20from\x20Noda\x20API','Error\x20Message:','6856080rTgKsd','14750kApdpp','QR\x20Code\x20Link:','Yes','NodaService','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Remitter','loggerService','statusText','stack','Raw\x20Response\x20Body:','fromEntries','662145TiubXm','ðŸŒ\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','apiUrl','application/json','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','BankTransactionId','canceled','7749tvqHUe','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','isActive','SettlementDate','Noda\x20API\x20error:\x20','Response\x20Body:','Order\x20ID\x20Format:','Failed\x20to\x20parse\x20JSON\x20response:','cancelled','Amount','noda','log','verifyPayment','expiryDate','Payment\x20Link\x20ID:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','2587620ziXSvt','(8digits-8digits\x20format)','Response\x20Time:','/payment-links','stringify','PENDING','statusCode','successful','Processing\x20Noda\x20webhook:','json','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','defineProperty','https://tesoft.uk/gateway/noda/','BankId','created','https://tesoft.uk/gateway/noda/webhook/','text','qrCodeLink','PaymentId','564XLifaF','active','TesSoft\x20Payment\x20System/1.0','FAILED','amount','MerchantPaymentId','POST','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','JSON\x20Parse\x20Error:\x20','shortLink','Response\x20data:','3053760euiWOw','status','Method','Request\x20Body\x20(Direct\x20JSON):','Settled','now','EXPIRED','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Missing\x20id\x20or\x20shortLink\x20in\x20response','Status:','GET','Order\x20ID\x20Used:','Iban','processWebhook','entries','Headers:','Noda\x20payment\x20verification\x20error:','message','headers','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','===\x20NODA\x20SUCCESS\x20===','Business\x20Error:\x20','(8digits-8digits\x20format\x20for\x20Noda)','Failed\x20to\x20verify\x20Noda\x20payment:\x20','completed','failed','parse','===\x20PARSED\x20NODA\x20RESPONSE\x20===','PAID','===\x20NODA\x20SERVICE\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','/payment-links/','success','Status\x20Text:','error','shortLinkUrls','https://tesoft.uk/gateway/success.php?id=','Error\x20details:','Error\x20message:','logWhiteDomainResponse','Unknown\x20error','logWhiteDomainError','Not\x20provided','1062747cAEitY'];a39_0x1082=function(){return _0x49d9ef;};return a39_0x1082();}exports[a39_0x1730ba(0x19a)]=NodaService;