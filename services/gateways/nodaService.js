'use strict';const a42_0x5b562e=a42_0x8eb6;(function(_0x1e5636,_0xced6e7){const _0x3433cc=a42_0x8eb6,_0x23c1f4=_0x1e5636();while(!![]){try{const _0x5cf23b=-parseInt(_0x3433cc(0x169))/0x1*(parseInt(_0x3433cc(0x1c1))/0x2)+-parseInt(_0x3433cc(0x19d))/0x3*(-parseInt(_0x3433cc(0x18e))/0x4)+-parseInt(_0x3433cc(0x196))/0x5*(parseInt(_0x3433cc(0x157))/0x6)+-parseInt(_0x3433cc(0x158))/0x7*(parseInt(_0x3433cc(0x142))/0x8)+parseInt(_0x3433cc(0x180))/0x9*(-parseInt(_0x3433cc(0x143))/0xa)+-parseInt(_0x3433cc(0x16a))/0xb*(parseInt(_0x3433cc(0x1ad))/0xc)+-parseInt(_0x3433cc(0x164))/0xd*(-parseInt(_0x3433cc(0x1a8))/0xe);if(_0x5cf23b===_0xced6e7)break;else _0x23c1f4['push'](_0x23c1f4['shift']());}catch(_0x15c6fc){_0x23c1f4['push'](_0x23c1f4['shift']());}}}(a42_0x19bf,0x34108));Object['defineProperty'](exports,a42_0x5b562e(0x14d),{'value':!![]}),exports[a42_0x5b562e(0x1c6)]=void 0x0;function a42_0x8eb6(_0x433958,_0x36f5c9){const _0x19bf05=a42_0x19bf();return a42_0x8eb6=function(_0x8eb650,_0x115ad0){_0x8eb650=_0x8eb650-0x142;let _0x4f00b9=_0x19bf05[_0x8eb650];return _0x4f00b9;},a42_0x8eb6(_0x433958,_0x36f5c9);}function a42_0x19bf(){const _0x18f259=['Status','Noda\x20payment\x20verification\x20error:','done','isActive','Error\x20message:','15EfDdpU','verifyWebhookSignature','/payment-links','https://tesoft.uk/gateway/noda/','Amount','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','HTTP\x20error!\x20status:\x20','9zrXwBV','text','Remitter','Response\x20Time:','apiUrl','Short\x20Link:','QR\x20Code\x20Link:','canceled','GET','POST','EXPIRED','196VUrvpu','HTTP\x20Status:','active','noda','FAILED','135276MTmDJg','amount','application/json','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Payment\x20Link\x20ID:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','loggerService','BankId','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20',',\x20body:\x20','toLowerCase','created','Failed\x20to\x20verify\x20Noda\x20payment:\x20','logWhiteDomainResponse','createPaymentLink','(8digits-8digits\x20format)','Headers:','(8digits-8digits\x20format\x20for\x20Noda)','fromEntries','expiryDate','866khQQhl','statusCode','Method','logWhiteDomainError','stringify','NodaService','3133352ixxyaT','530bLkMsa','headers','paid','json','===\x20NODA\x20SUCCESS\x20===','Missing\x20id\x20or\x20shortLink\x20in\x20response','Noda\x20webhook\x20signature\x20verification:','Iban','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','qrCodeLink','__esModule','Order\x20ID\x20Format:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','TesSoft\x20Payment\x20System/1.0','processWebhook','/payment-links/','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','status','Status:','Status\x20Text:','736386JggnxT','7iYEWWt','Order\x20ID\x20Used:','https://tesoft.uk/gateway/pending.php?id=','MerchantPaymentId','../loggerService','Settled','Response\x20Body:','shortLink','Request\x20Body\x20(Direct\x20JSON):','cancelled','stack','failed','1030718jmTzxY','logWhiteDomainRequest','processing','Yes','pending','35eXXAEN','187qxfeWp','shortLinkUrls','Error\x20stack:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Failed\x20to\x20parse\x20JSON\x20response:','timeout','currency','PAID','Currency','===\x20NODA\x20API\x20ERROR\x20===','entries','URL:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','PENDING','Noda\x20API\x20error:\x20','PaymentId','successful','BankTransactionId','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Error\x20details:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','error','19287FuXYwe','Unknown\x20error','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','now','log','Unknown\x20error\x20from\x20Noda\x20API','expired','parse','toUpperCase','message','SettlementDate','JSON\x20Parse\x20Error:\x20','Not\x20provided','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','244652nLGgzS','https://tesoft.uk/gateway/noda/webhook/','HTTP\x20'];a42_0x19bf=function(){return _0x18f259;};return a42_0x19bf();}const loggerService_1=require(a42_0x5b562e(0x15c));class NodaService{constructor(){const _0x4eeffc=a42_0x5b562e;this[_0x4eeffc(0x1a1)]=_0x4eeffc(0x199),console[_0x4eeffc(0x184)](_0x4eeffc(0x17e));}async[a42_0x5b562e(0x1bb)](_0x49274a){const _0x10e39d=a42_0x5b562e,{orderId:_0x51928e,name:_0xd177fa,paymentDescription:_0x5acd48,amount:_0x441385,currency:_0x5024b8,webhookUrl:_0x4bde91,returnUrl:_0x4a2a7d,expiryDate:_0x113a3a}=_0x49274a,_0x421923=_0x5024b8[_0x10e39d(0x188)](),_0x4a27f6=_0x10e39d(0x18f),_0x5be281=_0x10e39d(0x15a)+_0x51928e,_0x1b7331={'name':_0xd177fa,'paymentDescription':_0x5acd48,'amount':_0x441385,'currency':_0x421923,'paymentId':_0x51928e,'webhookUrl':_0x4a27f6,'returnUrl':_0x5be281};_0x113a3a&&(_0x1b7331[_0x10e39d(0x1c0)]=_0x113a3a);const _0x13455d=Date[_0x10e39d(0x183)]();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x10e39d(0x184)](_0x10e39d(0x175),this['apiUrl']),console[_0x10e39d(0x184)](_0x10e39d(0x160),JSON['stringify'](_0x1b7331,null,0x2)),console[_0x10e39d(0x184)](_0x10e39d(0x14e),_0x51928e,_0x10e39d(0x1be)),console['log'](_0x10e39d(0x17c),_0x5be281),loggerService_1[_0x10e39d(0x1b3)]['logWhiteDomainRequest'](_0x10e39d(0x1ab),_0x10e39d(0x198),_0x10e39d(0x1a6),_0x1b7331);const _0x2d02d3=await fetch(this[_0x10e39d(0x1a1)],{'method':'POST','headers':{'Content-Type':_0x10e39d(0x1af),'Accept':_0x10e39d(0x1af),'User-Agent':_0x10e39d(0x150)},'body':JSON[_0x10e39d(0x1c5)](_0x1b7331)}),_0x1d8e7b=Date[_0x10e39d(0x183)]()-_0x13455d;console[_0x10e39d(0x184)](_0x10e39d(0x1b2)),console[_0x10e39d(0x184)](_0x10e39d(0x155),_0x2d02d3[_0x10e39d(0x154)]),console[_0x10e39d(0x184)](_0x10e39d(0x156),_0x2d02d3['statusText']),console['log'](_0x10e39d(0x1bd),Object[_0x10e39d(0x1bf)](_0x2d02d3[_0x10e39d(0x144)][_0x10e39d(0x174)]())),console['log'](_0x10e39d(0x1a0),_0x1d8e7b+'ms');const _0x80e350=await _0x2d02d3[_0x10e39d(0x19e)]();console[_0x10e39d(0x184)]('Raw\x20Response\x20Body:',_0x80e350);if(!_0x2d02d3['ok']){console[_0x10e39d(0x17f)](_0x10e39d(0x173)),console[_0x10e39d(0x17f)](_0x10e39d(0x1a9),_0x2d02d3[_0x10e39d(0x154)]),console[_0x10e39d(0x17f)](_0x10e39d(0x15e),_0x80e350),loggerService_1[_0x10e39d(0x1b3)][_0x10e39d(0x1ba)](_0x10e39d(0x1ab),'/payment-links',_0x2d02d3[_0x10e39d(0x154)],_0x80e350,_0x1d8e7b),loggerService_1[_0x10e39d(0x1b3)][_0x10e39d(0x1c4)](_0x10e39d(0x1ab),_0x10e39d(0x198),_0x10e39d(0x190)+_0x2d02d3['status']+':\x20'+_0x80e350);if(_0x2d02d3[_0x10e39d(0x154)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x2d02d3['status']===0x1f4)throw new Error(_0x10e39d(0x153));}throw new Error(_0x10e39d(0x19c)+_0x2d02d3[_0x10e39d(0x154)]+_0x10e39d(0x1b6)+_0x80e350);}let _0x2831db;try{_0x2831db=JSON[_0x10e39d(0x187)](_0x80e350);}catch(_0x535f62){console[_0x10e39d(0x17f)](_0x10e39d(0x16e),_0x535f62),loggerService_1['loggerService'][_0x10e39d(0x1c4)]('noda',_0x10e39d(0x198),_0x10e39d(0x18b)+_0x535f62);throw new Error(_0x10e39d(0x1b0)+_0x80e350);}console['log'](_0x10e39d(0x16d)),console[_0x10e39d(0x184)]('Parsed\x20Result:',JSON[_0x10e39d(0x1c5)](_0x2831db,null,0x2)),loggerService_1[_0x10e39d(0x1b3)][_0x10e39d(0x1ba)](_0x10e39d(0x1ab),_0x10e39d(0x198),_0x2d02d3[_0x10e39d(0x154)],_0x2831db,_0x1d8e7b);if(_0x2831db[_0x10e39d(0x17f)]||_0x2831db['statusCode']){const _0xa8b219=_0x2831db[_0x10e39d(0x189)]||_0x2831db[_0x10e39d(0x17f)]||_0x10e39d(0x185);console[_0x10e39d(0x17f)](_0x10e39d(0x176)),console[_0x10e39d(0x17f)]('Error\x20Message:',_0xa8b219),console[_0x10e39d(0x17f)]('Status\x20Code:',_0x2831db[_0x10e39d(0x1c2)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x10e39d(0x1ab),'/payment-links','Business\x20Error:\x20'+_0xa8b219);throw new Error(_0x10e39d(0x178)+_0xa8b219);}if(!_0x2831db['id']||!_0x2831db[_0x10e39d(0x16b)]?.['shortLink']){console[_0x10e39d(0x17f)](_0x10e39d(0x14b)),console[_0x10e39d(0x17f)](_0x10e39d(0x148)),console[_0x10e39d(0x17f)]('Response\x20data:',_0x2831db),loggerService_1[_0x10e39d(0x1b3)][_0x10e39d(0x1c4)]('noda',_0x10e39d(0x198),_0x10e39d(0x14f));throw new Error(_0x10e39d(0x19b));}return console['log'](_0x10e39d(0x147)),console['log'](_0x10e39d(0x1b1),_0x2831db['id']),console['log'](_0x10e39d(0x1a2),_0x2831db[_0x10e39d(0x16b)][_0x10e39d(0x15f)]),console[_0x10e39d(0x184)](_0x10e39d(0x1a3),_0x2831db[_0x10e39d(0x16b)][_0x10e39d(0x14c)]||_0x10e39d(0x18c)),console['log'](_0x10e39d(0x159),_0x51928e,_0x10e39d(0x1bc)),console[_0x10e39d(0x184)](_0x10e39d(0x18d),_0x5be281),{'gateway_payment_id':_0x2831db['id'],'payment_url':_0x2831db[_0x10e39d(0x16b)][_0x10e39d(0x15f)],'qr_code_url':_0x2831db[_0x10e39d(0x16b)][_0x10e39d(0x14c)],'expiry_date':_0x2831db['expiryDate']};}catch(_0x318277){console[_0x10e39d(0x17f)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x10e39d(0x17f)](_0x10e39d(0x17d),_0x318277),loggerService_1[_0x10e39d(0x1b3)]['logWhiteDomainError'](_0x10e39d(0x1ab),_0x10e39d(0x198),_0x318277);if(_0x318277 instanceof Error){console[_0x10e39d(0x17f)](_0x10e39d(0x195),_0x318277[_0x10e39d(0x189)]),console[_0x10e39d(0x17f)](_0x10e39d(0x16c),_0x318277[_0x10e39d(0x162)]);throw new Error(_0x10e39d(0x1b5)+_0x318277[_0x10e39d(0x189)]);}throw new Error(_0x10e39d(0x182));}}async['verifyPayment'](_0x1a915a){const _0x69b2bf=a42_0x5b562e,_0x10baea=Date[_0x69b2bf(0x183)]();try{loggerService_1[_0x69b2bf(0x1b3)][_0x69b2bf(0x165)]('noda','/payment-links/'+_0x1a915a,_0x69b2bf(0x1a5),{});const _0xd97567=await fetch(this['apiUrl']+'/'+_0x1a915a,{'method':_0x69b2bf(0x1a5),'headers':{'Content-Type':_0x69b2bf(0x1af),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x472702=Date[_0x69b2bf(0x183)]()-_0x10baea;if(!_0xd97567['ok']){const _0x410c06=await _0xd97567['text']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x69b2bf(0x1ab),_0x69b2bf(0x152)+_0x1a915a,_0xd97567[_0x69b2bf(0x154)],_0x410c06,_0x472702);throw new Error(_0x69b2bf(0x19c)+_0xd97567[_0x69b2bf(0x154)]);}const _0x373111=await _0xd97567[_0x69b2bf(0x146)]();loggerService_1[_0x69b2bf(0x1b3)]['logWhiteDomainResponse'](_0x69b2bf(0x1ab),_0x69b2bf(0x152)+_0x1a915a,_0xd97567[_0x69b2bf(0x154)],_0x373111,_0x472702);if(_0x373111['error']||_0x373111['statusCode']){loggerService_1[_0x69b2bf(0x1b3)]['logWhiteDomainError'](_0x69b2bf(0x1ab),_0x69b2bf(0x152)+_0x1a915a,'Noda\x20API\x20error:\x20'+(_0x373111['message']||_0x373111[_0x69b2bf(0x17f)]||_0x69b2bf(0x181)));throw new Error(_0x69b2bf(0x178)+(_0x373111['message']||_0x373111[_0x69b2bf(0x17f)]||_0x69b2bf(0x181)));}let _0xbfa483=_0x69b2bf(0x177);if(_0x373111[_0x69b2bf(0x194)]===![]){if(_0x373111['expiryDate']){const _0x3681ae=new Date(_0x373111[_0x69b2bf(0x1c0)]),_0x497c6c=new Date();_0x3681ae<_0x497c6c?_0xbfa483=_0x69b2bf(0x1a7):_0xbfa483=_0x69b2bf(0x1ac);}else _0xbfa483='FAILED';}else _0xbfa483=_0x69b2bf(0x177);return{'status':_0xbfa483,'amount':_0x373111[_0x69b2bf(0x1ae)],'currency':_0x373111[_0x69b2bf(0x170)],'isActive':_0x373111[_0x69b2bf(0x194)]};}catch(_0x229306){console['error'](_0x69b2bf(0x192),_0x229306),loggerService_1[_0x69b2bf(0x1b3)]['logWhiteDomainError'](_0x69b2bf(0x1ab),_0x69b2bf(0x152)+_0x1a915a,_0x229306);throw new Error(_0x69b2bf(0x1b9)+(_0x229306 instanceof Error?_0x229306['message']:'Unknown\x20error'));}}async[a42_0x5b562e(0x151)](_0x2b0399){const _0x408426=a42_0x5b562e;console[_0x408426(0x184)]('Processing\x20Noda\x20webhook:',_0x2b0399);let _0x1aab4e='PENDING';switch(_0x2b0399[_0x408426(0x191)]?.[_0x408426(0x1b7)]()){case _0x408426(0x193):case'completed':case _0x408426(0x145):case'success':case _0x408426(0x17a):_0x2b0399[_0x408426(0x15d)]===_0x408426(0x167)?_0x1aab4e=_0x408426(0x171):_0x1aab4e='PENDING';break;case _0x408426(0x161):case _0x408426(0x1a4):case _0x408426(0x163):case _0x408426(0x17f):case'rejected':_0x1aab4e=_0x408426(0x1ac);break;case _0x408426(0x186):case _0x408426(0x16f):_0x1aab4e=_0x408426(0x1a7);break;case _0x408426(0x168):case _0x408426(0x1b8):case _0x408426(0x1aa):case _0x408426(0x166):case'in_progress':default:_0x1aab4e=_0x408426(0x177);break;}return{'paymentId':_0x2b0399[_0x408426(0x15b)]||_0x2b0399['PaymentId'],'status':_0x1aab4e,'amount':_0x2b0399[_0x408426(0x19a)],'currency':_0x2b0399[_0x408426(0x172)],'additionalInfo':{'method':_0x2b0399[_0x408426(0x1c3)],'bankId':_0x2b0399[_0x408426(0x1b4)],'settled':_0x2b0399['Settled'],'settlementDate':_0x2b0399[_0x408426(0x18a)],'remitterName':_0x2b0399[_0x408426(0x19f)]?.['Name'],'remitterIban':_0x2b0399[_0x408426(0x19f)]?.[_0x408426(0x14a)],'bankTransactionId':_0x2b0399[_0x408426(0x17b)]}};}[a42_0x5b562e(0x197)](_0x32195e,_0x38d460){const _0x501238=a42_0x5b562e;return console[_0x501238(0x184)](_0x501238(0x149),{'receivedSignature':_0x38d460,'paymentId':_0x32195e[_0x501238(0x179)],'merchantPaymentId':_0x32195e[_0x501238(0x15b)]}),!![];}}exports[a42_0x5b562e(0x1c6)]=NodaService;