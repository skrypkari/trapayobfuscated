'use strict';const a43_0x45db2b=a43_0x52de;(function(_0x1b7a01,_0x3ab9f1){const _0x3528cd=a43_0x52de,_0x1e020a=_0x1b7a01();while(!![]){try{const _0x1675ff=-parseInt(_0x3528cd(0x17a))/0x1+-parseInt(_0x3528cd(0x114))/0x2*(parseInt(_0x3528cd(0x12d))/0x3)+parseInt(_0x3528cd(0x142))/0x4*(parseInt(_0x3528cd(0x123))/0x5)+parseInt(_0x3528cd(0x174))/0x6+parseInt(_0x3528cd(0x149))/0x7*(parseInt(_0x3528cd(0x125))/0x8)+parseInt(_0x3528cd(0x113))/0x9+-parseInt(_0x3528cd(0x130))/0xa*(-parseInt(_0x3528cd(0x141))/0xb);if(_0x1675ff===_0x3ab9f1)break;else _0x1e020a['push'](_0x1e020a['shift']());}catch(_0x2eadc0){_0x1e020a['push'](_0x1e020a['shift']());}}}(a43_0x4fc4,0x5f80b));function a43_0x52de(_0x2672ab,_0x1a0950){const _0x4fc40a=a43_0x4fc4();return a43_0x52de=function(_0x52de59,_0x4ce265){_0x52de59=_0x52de59-0xff;let _0x1aed50=_0x4fc40a[_0x52de59];return _0x1aed50;},a43_0x52de(_0x2672ab,_0x1a0950);}Object[a43_0x45db2b(0x155)](exports,a43_0x45db2b(0x144),{'value':!![]}),exports[a43_0x45db2b(0x177)]=void 0x0;const loggerService_1=require(a43_0x45db2b(0x108));function a43_0x4fc4(){const _0x490055=['status','Noda\x20API\x20error:\x20','PAID','shortLinkUrls','POST','../loggerService','===\x20NODA\x20SUCCESS\x20===','cancelled','logWhiteDomainError','expiryDate','fromEntries','headers','HTTP\x20Status:','parse','Order\x20ID\x20Used:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','4714083aVZPqy','2qLZiCr','Order\x20ID\x20Format:','entries','Unknown\x20error','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','toUpperCase','amount','/payment-links/','Name','/payment-links','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','statusCode','verifyWebhookSignature','Currency','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','124335ZtEIFo','message','8VHOaDG','Noda\x20payment\x20verification\x20error:','Parsed\x20Result:','qrCodeLink','MerchantPaymentId','Amount','stringify','Error\x20Message:','2135121TqlgDq','processing','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','1753730CfKykc','Response\x20Time:','application/json','Method','BankId','Response\x20data:','statusText','success','created','Short\x20Link:','expired','HTTP\x20error!\x20status:\x20','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','SettlementDate','noda','error','11xPPWxW','4TmGCQn','Status\x20Code:','__esModule','in_progress','FAILED','URL:','HTTP\x20','2776403fONVno','Missing\x20id\x20or\x20shortLink\x20in\x20response','json','https://tesoft.uk/gateway/pending.php?id=','logWhiteDomainResponse','JSON\x20Parse\x20Error:\x20','https://tesoft.uk/gateway/noda/webhook/','Status:','currency','===\x20NODA\x20SERVICE\x20ERROR\x20===','TesSoft\x20Payment\x20System/1.0','https://tesoft.uk/gateway/noda/','defineProperty','done','now','Noda\x20webhook\x20signature\x20verification:','loggerService','text','(8digits-8digits\x20format)','isActive','Failed\x20to\x20verify\x20Noda\x20payment:\x20','GET','Request\x20Body\x20(Direct\x20JSON):','Settled','log','active','PaymentId','BankTransactionId','QR\x20Code\x20Link:','Error\x20details:','Remitter','Processing\x20Noda\x20webhook:','apiUrl','Status','shortLink','EXPIRED','===\x20NODA\x20API\x20ERROR\x20===','canceled','createPaymentLink','Failed\x20to\x20parse\x20JSON\x20response:','timeout','pending','Error\x20stack:','2911896PSyYeO','stack','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','NodaService','Headers:','PENDING','503086FvNZKr','rejected','successful','Payment\x20Link\x20ID:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Error\x20message:','processWebhook','Response\x20Body:'];a43_0x4fc4=function(){return _0x490055;};return a43_0x4fc4();}class NodaService{constructor(){const _0x4e0ac1=a43_0x45db2b;this[_0x4e0ac1(0x169)]=_0x4e0ac1(0x154),console[_0x4e0ac1(0x161)](_0x4e0ac1(0x11e));}async[a43_0x45db2b(0x16f)](_0x5a7b7){const _0x9f860c=a43_0x45db2b,{orderId:_0x37049b,name:_0x3e4477,paymentDescription:_0x1d007d,amount:_0x28cc86,currency:_0x55de9d,webhookUrl:_0x2a71ce,returnUrl:_0x3a9a09,expiryDate:_0x32874f}=_0x5a7b7,_0x4a53da=_0x55de9d[_0x9f860c(0x119)](),_0x48456c=_0x9f860c(0x14f),_0x26d658=_0x9f860c(0x14c)+_0x37049b,_0x2a012e={'name':_0x3e4477,'paymentDescription':_0x1d007d,'amount':_0x28cc86,'currency':_0x4a53da,'paymentId':_0x37049b,'webhookUrl':_0x48456c,'returnUrl':_0x26d658};_0x32874f&&(_0x2a012e['expiryDate']=_0x32874f);const _0x1be1e4=Date[_0x9f860c(0x157)]();try{console['log'](_0x9f860c(0x112)),console['log'](_0x9f860c(0x147),this[_0x9f860c(0x169)]),console[_0x9f860c(0x161)](_0x9f860c(0x15f),JSON['stringify'](_0x2a012e,null,0x2)),console['log'](_0x9f860c(0x115),_0x37049b,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x9f860c(0x161)](_0x9f860c(0x12f),_0x26d658),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x9f860c(0x13f),_0x9f860c(0x11d),_0x9f860c(0x107),_0x2a012e);const _0x2d0572=await fetch(this[_0x9f860c(0x169)],{'method':_0x9f860c(0x107),'headers':{'Content-Type':_0x9f860c(0x132),'Accept':'application/json','User-Agent':_0x9f860c(0x153)},'body':JSON['stringify'](_0x2a012e)}),_0x510f39=Date[_0x9f860c(0x157)]()-_0x1be1e4;console[_0x9f860c(0x161)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x9f860c(0x150),_0x2d0572[_0x9f860c(0x103)]),console[_0x9f860c(0x161)]('Status\x20Text:',_0x2d0572[_0x9f860c(0x136)]),console[_0x9f860c(0x161)](_0x9f860c(0x178),Object[_0x9f860c(0x10d)](_0x2d0572[_0x9f860c(0x10e)][_0x9f860c(0x116)]())),console[_0x9f860c(0x161)](_0x9f860c(0x131),_0x510f39+'ms');const _0x2346fa=await _0x2d0572[_0x9f860c(0x15a)]();console[_0x9f860c(0x161)]('Raw\x20Response\x20Body:',_0x2346fa);if(!_0x2d0572['ok']){console[_0x9f860c(0x140)](_0x9f860c(0x16d)),console[_0x9f860c(0x140)](_0x9f860c(0x10f),_0x2d0572[_0x9f860c(0x103)]),console[_0x9f860c(0x140)](_0x9f860c(0x102),_0x2346fa),loggerService_1[_0x9f860c(0x159)]['logWhiteDomainResponse']('noda','/payment-links',_0x2d0572['status'],_0x2346fa,_0x510f39),loggerService_1[_0x9f860c(0x159)][_0x9f860c(0x10b)](_0x9f860c(0x13f),_0x9f860c(0x11d),_0x9f860c(0x148)+_0x2d0572['status']+':\x20'+_0x2346fa);if(_0x2d0572[_0x9f860c(0x103)]===0x190)throw new Error(_0x9f860c(0x13c));else{if(_0x2d0572[_0x9f860c(0x103)]===0x1f4)throw new Error(_0x9f860c(0x118));}throw new Error(_0x9f860c(0x13b)+_0x2d0572['status']+',\x20body:\x20'+_0x2346fa);}let _0x5ce330;try{_0x5ce330=JSON[_0x9f860c(0x110)](_0x2346fa);}catch(_0x2b7948){console['error'](_0x9f860c(0x170),_0x2b7948),loggerService_1[_0x9f860c(0x159)][_0x9f860c(0x10b)](_0x9f860c(0x13f),_0x9f860c(0x11d),_0x9f860c(0x14e)+_0x2b7948);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x2346fa);}console['log']('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x9f860c(0x161)](_0x9f860c(0x127),JSON[_0x9f860c(0x12b)](_0x5ce330,null,0x2)),loggerService_1[_0x9f860c(0x159)]['logWhiteDomainResponse'](_0x9f860c(0x13f),_0x9f860c(0x11d),_0x2d0572[_0x9f860c(0x103)],_0x5ce330,_0x510f39);if(_0x5ce330[_0x9f860c(0x140)]||_0x5ce330[_0x9f860c(0x11f)]){const _0x29d66d=_0x5ce330[_0x9f860c(0x124)]||_0x5ce330['error']||'Unknown\x20error\x20from\x20Noda\x20API';console['error'](_0x9f860c(0xff)),console[_0x9f860c(0x140)](_0x9f860c(0x12c),_0x29d66d),console[_0x9f860c(0x140)](_0x9f860c(0x143),_0x5ce330[_0x9f860c(0x11f)]),loggerService_1[_0x9f860c(0x159)][_0x9f860c(0x10b)](_0x9f860c(0x13f),_0x9f860c(0x11d),'Business\x20Error:\x20'+_0x29d66d);throw new Error(_0x9f860c(0x104)+_0x29d66d);}if(!_0x5ce330['id']||!_0x5ce330[_0x9f860c(0x106)]?.[_0x9f860c(0x16b)]){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x9f860c(0x140)](_0x9f860c(0x14a)),console['error'](_0x9f860c(0x135),_0x5ce330),loggerService_1[_0x9f860c(0x159)][_0x9f860c(0x10b)]('noda',_0x9f860c(0x11d),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x9f860c(0x176));}return console[_0x9f860c(0x161)](_0x9f860c(0x109)),console[_0x9f860c(0x161)](_0x9f860c(0x17d),_0x5ce330['id']),console['log'](_0x9f860c(0x139),_0x5ce330[_0x9f860c(0x106)][_0x9f860c(0x16b)]),console[_0x9f860c(0x161)](_0x9f860c(0x165),_0x5ce330[_0x9f860c(0x106)][_0x9f860c(0x128)]||'Not\x20provided'),console[_0x9f860c(0x161)](_0x9f860c(0x111),_0x37049b,_0x9f860c(0x15b)),console[_0x9f860c(0x161)](_0x9f860c(0x122),_0x26d658),{'gateway_payment_id':_0x5ce330['id'],'payment_url':_0x5ce330[_0x9f860c(0x106)][_0x9f860c(0x16b)],'qr_code_url':_0x5ce330['shortLinkUrls'][_0x9f860c(0x128)],'expiry_date':_0x5ce330[_0x9f860c(0x10c)]};}catch(_0x347338){console[_0x9f860c(0x140)](_0x9f860c(0x152)),console[_0x9f860c(0x140)](_0x9f860c(0x166),_0x347338),loggerService_1[_0x9f860c(0x159)]['logWhiteDomainError']('noda',_0x9f860c(0x11d),_0x347338);if(_0x347338 instanceof Error){console['error'](_0x9f860c(0x100),_0x347338[_0x9f860c(0x124)]),console['error'](_0x9f860c(0x173),_0x347338[_0x9f860c(0x175)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x347338[_0x9f860c(0x124)]);}throw new Error(_0x9f860c(0x13d));}}async['verifyPayment'](_0x43fad2){const _0x1c4ae5=a43_0x45db2b,_0xef0ca2=Date['now']();try{loggerService_1[_0x1c4ae5(0x159)]['logWhiteDomainRequest'](_0x1c4ae5(0x13f),'/payment-links/'+_0x43fad2,_0x1c4ae5(0x15e),{});const _0x5163fc=await fetch(this[_0x1c4ae5(0x169)]+'/'+_0x43fad2,{'method':_0x1c4ae5(0x15e),'headers':{'Content-Type':_0x1c4ae5(0x132),'User-Agent':_0x1c4ae5(0x153)}}),_0x5c9abc=Date['now']()-_0xef0ca2;if(!_0x5163fc['ok']){const _0x4248c4=await _0x5163fc[_0x1c4ae5(0x15a)]();loggerService_1[_0x1c4ae5(0x159)][_0x1c4ae5(0x14d)](_0x1c4ae5(0x13f),_0x1c4ae5(0x11b)+_0x43fad2,_0x5163fc[_0x1c4ae5(0x103)],_0x4248c4,_0x5c9abc);throw new Error(_0x1c4ae5(0x13b)+_0x5163fc[_0x1c4ae5(0x103)]);}const _0x354060=await _0x5163fc[_0x1c4ae5(0x14b)]();loggerService_1[_0x1c4ae5(0x159)][_0x1c4ae5(0x14d)]('noda',_0x1c4ae5(0x11b)+_0x43fad2,_0x5163fc['status'],_0x354060,_0x5c9abc);if(_0x354060['error']||_0x354060[_0x1c4ae5(0x11f)]){loggerService_1[_0x1c4ae5(0x159)][_0x1c4ae5(0x10b)](_0x1c4ae5(0x13f),_0x1c4ae5(0x11b)+_0x43fad2,_0x1c4ae5(0x104)+(_0x354060[_0x1c4ae5(0x124)]||_0x354060['error']||_0x1c4ae5(0x117)));throw new Error(_0x1c4ae5(0x104)+(_0x354060[_0x1c4ae5(0x124)]||_0x354060[_0x1c4ae5(0x140)]||'Unknown\x20error'));}let _0x31fab5='PENDING';if(_0x354060[_0x1c4ae5(0x15c)]===![]){if(_0x354060[_0x1c4ae5(0x10c)]){const _0x4c46f5=new Date(_0x354060[_0x1c4ae5(0x10c)]),_0x350986=new Date();_0x4c46f5<_0x350986?_0x31fab5=_0x1c4ae5(0x16c):_0x31fab5=_0x1c4ae5(0x146);}else _0x31fab5=_0x1c4ae5(0x146);}else _0x31fab5=_0x1c4ae5(0x179);return{'status':_0x31fab5,'amount':_0x354060[_0x1c4ae5(0x11a)],'currency':_0x354060[_0x1c4ae5(0x151)],'isActive':_0x354060[_0x1c4ae5(0x15c)]};}catch(_0x173819){console[_0x1c4ae5(0x140)](_0x1c4ae5(0x126),_0x173819),loggerService_1[_0x1c4ae5(0x159)][_0x1c4ae5(0x10b)](_0x1c4ae5(0x13f),_0x1c4ae5(0x11b)+_0x43fad2,_0x173819);throw new Error(_0x1c4ae5(0x15d)+(_0x173819 instanceof Error?_0x173819[_0x1c4ae5(0x124)]:'Unknown\x20error'));}}async[a43_0x45db2b(0x101)](_0x7e3966){const _0x70f659=a43_0x45db2b;console[_0x70f659(0x161)](_0x70f659(0x168),_0x7e3966);let _0x367bec=_0x70f659(0x179);switch(_0x7e3966[_0x70f659(0x16a)]?.['toLowerCase']()){case _0x70f659(0x156):case'completed':case'paid':case _0x70f659(0x137):case _0x70f659(0x17c):_0x7e3966[_0x70f659(0x160)]==='Yes'?_0x367bec=_0x70f659(0x105):_0x367bec=_0x70f659(0x179);break;case _0x70f659(0x10a):case _0x70f659(0x16e):case'failed':case'error':case _0x70f659(0x17b):_0x367bec='FAILED';break;case _0x70f659(0x13a):case _0x70f659(0x171):_0x367bec=_0x70f659(0x16c);break;case _0x70f659(0x172):case _0x70f659(0x138):case _0x70f659(0x162):case _0x70f659(0x12e):case _0x70f659(0x145):default:_0x367bec=_0x70f659(0x179);break;}return{'paymentId':_0x7e3966[_0x70f659(0x129)]||_0x7e3966[_0x70f659(0x163)],'status':_0x367bec,'amount':_0x7e3966[_0x70f659(0x12a)],'currency':_0x7e3966[_0x70f659(0x121)],'additionalInfo':{'method':_0x7e3966[_0x70f659(0x133)],'bankId':_0x7e3966[_0x70f659(0x134)],'settled':_0x7e3966[_0x70f659(0x160)],'settlementDate':_0x7e3966[_0x70f659(0x13e)],'remitterName':_0x7e3966[_0x70f659(0x167)]?.[_0x70f659(0x11c)],'remitterIban':_0x7e3966['Remitter']?.['Iban'],'bankTransactionId':_0x7e3966[_0x70f659(0x164)]}};}[a43_0x45db2b(0x120)](_0x750167,_0x62232f){const _0x2f6d66=a43_0x45db2b;return console[_0x2f6d66(0x161)](_0x2f6d66(0x158),{'receivedSignature':_0x62232f,'paymentId':_0x750167[_0x2f6d66(0x163)],'merchantPaymentId':_0x750167[_0x2f6d66(0x129)]}),!![];}}exports[a43_0x45db2b(0x177)]=NodaService;