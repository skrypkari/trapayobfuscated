'use strict';const a63_0x379e56=a63_0x3d63;(function(_0x30f0b2,_0x2101d0){const _0x4fce27=a63_0x3d63,_0x29ad57=_0x30f0b2();while(!![]){try{const _0x18cb92=-parseInt(_0x4fce27(0x1e6))/0x1+parseInt(_0x4fce27(0x1e5))/0x2+-parseInt(_0x4fce27(0x1cd))/0x3*(parseInt(_0x4fce27(0x211))/0x4)+parseInt(_0x4fce27(0x1e9))/0x5*(-parseInt(_0x4fce27(0x202))/0x6)+parseInt(_0x4fce27(0x210))/0x7*(-parseInt(_0x4fce27(0x1fa))/0x8)+parseInt(_0x4fce27(0x1f2))/0x9*(parseInt(_0x4fce27(0x1c6))/0xa)+parseInt(_0x4fce27(0x1e1))/0xb;if(_0x18cb92===_0x2101d0)break;else _0x29ad57['push'](_0x29ad57['shift']());}catch(_0x18f034){_0x29ad57['push'](_0x29ad57['shift']());}}}(a63_0x29cb,0x6f79d));function a63_0x3d63(_0x875102,_0x36f218){_0x875102=_0x875102-0x197;const _0x29cb98=a63_0x29cb();let _0x3d63aa=_0x29cb98[_0x875102];return _0x3d63aa;}Object[a63_0x379e56(0x1d9)](exports,a63_0x379e56(0x1f1),{'value':!![]}),exports[a63_0x379e56(0x204)]=void 0x0;function a63_0x29cb(){const _0x235308=['Unknown\x20error\x20from\x20Noda\x20API','PAID','defineProperty','Amount','Response\x20Body:','===\x20NODA\x20SUCCESS\x20===','Yes','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','toLowerCase','EXPIRED','28372751JGcrOx','Response\x20Time:','application/json','SettlementDate','543490yzYGGU','374502NlLuxk','Short\x20Link:','expired','175835WmJDcJ','https://tesoft.uk/gateway/pending.php?id=','URL:','Order\x20ID\x20Format:','HTTP\x20','Headers:','active','PENDING','__esModule','18WpSJim','/payment-links/','Status\x20Text:','log','Unknown\x20error','https://tesoft.uk/gateway/noda/webhook/','pending','(8digits-8digits\x20format\x20for\x20Noda)','824TIClSA','Noda\x20payment\x20verification\x20error:','Remitter','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20stack:','Name','status','timeout','78AgTjuE','loggerService','NodaService','noda','cancelled','HTTP\x20error!\x20status:\x20','GET','amount','Failed\x20to\x20parse\x20JSON\x20response:','Business\x20Error:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','/payment-links','===\x20NODA\x20SERVICE\x20ERROR\x20===','stack','60067iIkszQ','3542748yjJDsD','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','verifyWebhookSignature','Response\x20data:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','rejected','Iban','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Request\x20Body\x20(Direct\x20JSON):','json','Processing\x20Noda\x20webhook:','createPaymentLink','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','QR\x20Code\x20Link:','qrCodeLink','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','completed','Method','apiUrl','BankId','error','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','../loggerService','PaymentId','statusCode','Error\x20details:','Status\x20Code:','logWhiteDomainResponse','text','Currency','(8digits-8digits\x20format)','message','Not\x20provided','successful','POST','https://tesoft.uk/gateway/noda/','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','logWhiteDomainError','logWhiteDomainRequest','parse','BankTransactionId','Status','shortLink','canceled','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Order\x20ID\x20Used:','stringify','done','statusText','MerchantPaymentId','1033610rkIBsH','Settled','shortLinkUrls','headers','Payment\x20System/1.0','Missing\x20id\x20or\x20shortLink\x20in\x20response','===\x20NODA\x20API\x20ERROR\x20===','3YqhjER','currency','Failed\x20to\x20verify\x20Noda\x20payment:\x20','HTTP\x20Status:','isActive','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Noda\x20API\x20error:\x20','expiryDate','now','FAILED'];a63_0x29cb=function(){return _0x235308;};return a63_0x29cb();}const loggerService_1=require(a63_0x379e56(0x1aa));class NodaService{constructor(){const _0x2ac0e0=a63_0x379e56;this[_0x2ac0e0(0x1a6)]=_0x2ac0e0(0x1b7),console[_0x2ac0e0(0x1f5)](_0x2ac0e0(0x1c0));}async[a63_0x379e56(0x19f)](_0xa1343f){const _0x1340c4=a63_0x379e56,{orderId:_0x20cf57,name:_0xae7c76,paymentDescription:_0x562479,amount:_0x2d3960,currency:_0x41d4fb,webhookUrl:_0x4bd258,returnUrl:_0x12d2c4,expiryDate:_0x3fb48f}=_0xa1343f,_0x309619=_0x41d4fb['toUpperCase'](),_0x473ac5=_0x1340c4(0x1f7),_0x3b8f65=_0x1340c4(0x1ea)+_0x20cf57,_0x1e0ec1={'name':_0xae7c76,'paymentDescription':_0x562479,'amount':_0x2d3960,'currency':_0x309619,'paymentId':_0x20cf57,'webhookUrl':_0x473ac5,'returnUrl':_0x3b8f65};_0x3fb48f&&(_0x1e0ec1[_0x1340c4(0x1d4)]=_0x3fb48f);const _0x5c495c=Date[_0x1340c4(0x1d5)]();try{console[_0x1340c4(0x1f5)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x1340c4(0x1f5)](_0x1340c4(0x1eb),this[_0x1340c4(0x1a6)]),console[_0x1340c4(0x1f5)](_0x1340c4(0x19c),JSON[_0x1340c4(0x1c2)](_0x1e0ec1,null,0x2)),console[_0x1340c4(0x1f5)](_0x1340c4(0x1ec),_0x20cf57,_0x1340c4(0x1f9)),console['log']('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x3b8f65),loggerService_1[_0x1340c4(0x203)][_0x1340c4(0x1ba)](_0x1340c4(0x205),'/payment-links','POST',_0x1e0ec1);const _0x5bc658=await fetch(this[_0x1340c4(0x1a6)],{'method':_0x1340c4(0x1b6),'headers':{'Content-Type':_0x1340c4(0x1e3),'Accept':_0x1340c4(0x1e3),'User-Agent':_0x1340c4(0x1ca)},'body':JSON[_0x1340c4(0x1c2)](_0x1e0ec1)}),_0x56eaf4=Date[_0x1340c4(0x1d5)]()-_0x5c495c;console[_0x1340c4(0x1f5)](_0x1340c4(0x198)),console[_0x1340c4(0x1f5)]('Status:',_0x5bc658[_0x1340c4(0x200)]),console['log'](_0x1340c4(0x1f4),_0x5bc658[_0x1340c4(0x1c4)]),console[_0x1340c4(0x1f5)](_0x1340c4(0x1ee),Object['fromEntries'](_0x5bc658[_0x1340c4(0x1c9)]['entries']())),console['log'](_0x1340c4(0x1e2),_0x56eaf4+'ms');const _0x33f1fc=await _0x5bc658[_0x1340c4(0x1b0)]();console[_0x1340c4(0x1f5)]('Raw\x20Response\x20Body:',_0x33f1fc);if(!_0x5bc658['ok']){console[_0x1340c4(0x1a8)](_0x1340c4(0x1cc)),console[_0x1340c4(0x1a8)](_0x1340c4(0x1d0),_0x5bc658[_0x1340c4(0x200)]),console[_0x1340c4(0x1a8)](_0x1340c4(0x1db),_0x33f1fc),loggerService_1[_0x1340c4(0x203)][_0x1340c4(0x1af)](_0x1340c4(0x205),_0x1340c4(0x20d),_0x5bc658[_0x1340c4(0x200)],_0x33f1fc,_0x56eaf4),loggerService_1[_0x1340c4(0x203)][_0x1340c4(0x1b9)](_0x1340c4(0x205),_0x1340c4(0x20d),_0x1340c4(0x1ed)+_0x5bc658[_0x1340c4(0x200)]+':\x20'+_0x33f1fc);if(_0x5bc658['status']===0x190)throw new Error(_0x1340c4(0x1de));else{if(_0x5bc658[_0x1340c4(0x200)]===0x1f4)throw new Error(_0x1340c4(0x1d2));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x5bc658[_0x1340c4(0x200)]+',\x20body:\x20'+_0x33f1fc);}let _0x346dc5;try{_0x346dc5=JSON[_0x1340c4(0x1bb)](_0x33f1fc);}catch(_0x140664){console[_0x1340c4(0x1a8)](_0x1340c4(0x20a),_0x140664),loggerService_1[_0x1340c4(0x203)][_0x1340c4(0x1b9)](_0x1340c4(0x205),_0x1340c4(0x20d),'JSON\x20Parse\x20Error:\x20'+_0x140664);throw new Error(_0x1340c4(0x1a3)+_0x33f1fc);}console[_0x1340c4(0x1f5)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x1340c4(0x1f5)]('Parsed\x20Result:',JSON[_0x1340c4(0x1c2)](_0x346dc5,null,0x2)),loggerService_1['loggerService'][_0x1340c4(0x1af)](_0x1340c4(0x205),_0x1340c4(0x20d),_0x5bc658[_0x1340c4(0x200)],_0x346dc5,_0x56eaf4);if(_0x346dc5['error']||_0x346dc5[_0x1340c4(0x1ac)]){const _0x3dbab5=_0x346dc5[_0x1340c4(0x1b3)]||_0x346dc5[_0x1340c4(0x1a8)]||_0x1340c4(0x1d7);console['error'](_0x1340c4(0x1a0)),console[_0x1340c4(0x1a8)]('Error\x20Message:',_0x3dbab5),console['error'](_0x1340c4(0x1ae),_0x346dc5[_0x1340c4(0x1ac)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x1340c4(0x205),_0x1340c4(0x20d),_0x1340c4(0x20b)+_0x3dbab5);throw new Error('Noda\x20API\x20error:\x20'+_0x3dbab5);}if(!_0x346dc5['id']||!_0x346dc5[_0x1340c4(0x1c8)]?.[_0x1340c4(0x1be)]){console[_0x1340c4(0x1a8)](_0x1340c4(0x1fd)),console[_0x1340c4(0x1a8)](_0x1340c4(0x1cb)),console['error'](_0x1340c4(0x197),_0x346dc5),loggerService_1[_0x1340c4(0x203)][_0x1340c4(0x1b9)](_0x1340c4(0x205),'/payment-links',_0x1340c4(0x19b));throw new Error(_0x1340c4(0x212));}return console[_0x1340c4(0x1f5)](_0x1340c4(0x1dc)),console[_0x1340c4(0x1f5)]('Payment\x20Link\x20ID:',_0x346dc5['id']),console[_0x1340c4(0x1f5)](_0x1340c4(0x1e7),_0x346dc5[_0x1340c4(0x1c8)][_0x1340c4(0x1be)]),console[_0x1340c4(0x1f5)](_0x1340c4(0x1a1),_0x346dc5[_0x1340c4(0x1c8)][_0x1340c4(0x1a2)]||_0x1340c4(0x1b4)),console[_0x1340c4(0x1f5)](_0x1340c4(0x1c1),_0x20cf57,_0x1340c4(0x1b2)),console['log'](_0x1340c4(0x1a9),_0x3b8f65),{'gateway_payment_id':_0x346dc5['id'],'payment_url':_0x346dc5['shortLinkUrls']['shortLink'],'qr_code_url':_0x346dc5[_0x1340c4(0x1c8)][_0x1340c4(0x1a2)],'expiry_date':_0x346dc5[_0x1340c4(0x1d4)]};}catch(_0x456e51){console[_0x1340c4(0x1a8)](_0x1340c4(0x20e)),console[_0x1340c4(0x1a8)](_0x1340c4(0x1ad),_0x456e51),loggerService_1['loggerService']['logWhiteDomainError'](_0x1340c4(0x205),_0x1340c4(0x20d),_0x456e51);if(_0x456e51 instanceof Error){console[_0x1340c4(0x1a8)]('Error\x20message:',_0x456e51[_0x1340c4(0x1b3)]),console[_0x1340c4(0x1a8)](_0x1340c4(0x1fe),_0x456e51[_0x1340c4(0x20f)]);throw new Error(_0x1340c4(0x20c)+_0x456e51[_0x1340c4(0x1b3)]);}throw new Error(_0x1340c4(0x1b8));}}async['verifyPayment'](_0xabf935){const _0x16427b=a63_0x379e56,_0x2735e3=Date[_0x16427b(0x1d5)]();try{loggerService_1['loggerService']['logWhiteDomainRequest'](_0x16427b(0x205),_0x16427b(0x1f3)+_0xabf935,_0x16427b(0x208),{});const _0x11af00=await fetch(this[_0x16427b(0x1a6)]+'/'+_0xabf935,{'method':_0x16427b(0x208),'headers':{'Content-Type':_0x16427b(0x1e3),'User-Agent':_0x16427b(0x1ca)}}),_0xbb7dbe=Date[_0x16427b(0x1d5)]()-_0x2735e3;if(!_0x11af00['ok']){const _0x23886a=await _0x11af00[_0x16427b(0x1b0)]();loggerService_1[_0x16427b(0x203)][_0x16427b(0x1af)]('noda',_0x16427b(0x1f3)+_0xabf935,_0x11af00['status'],_0x23886a,_0xbb7dbe);throw new Error(_0x16427b(0x207)+_0x11af00[_0x16427b(0x200)]);}const _0x363ce1=await _0x11af00[_0x16427b(0x19d)]();loggerService_1['loggerService'][_0x16427b(0x1af)](_0x16427b(0x205),_0x16427b(0x1f3)+_0xabf935,_0x11af00['status'],_0x363ce1,_0xbb7dbe);if(_0x363ce1[_0x16427b(0x1a8)]||_0x363ce1[_0x16427b(0x1ac)]){loggerService_1['loggerService'][_0x16427b(0x1b9)]('noda',_0x16427b(0x1f3)+_0xabf935,_0x16427b(0x1d3)+(_0x363ce1[_0x16427b(0x1b3)]||_0x363ce1[_0x16427b(0x1a8)]||_0x16427b(0x1f6)));throw new Error('Noda\x20API\x20error:\x20'+(_0x363ce1[_0x16427b(0x1b3)]||_0x363ce1[_0x16427b(0x1a8)]||_0x16427b(0x1f6)));}let _0x35ac7e=_0x16427b(0x1f0);if(_0x363ce1[_0x16427b(0x1d1)]===![]){if(_0x363ce1['expiryDate']){const _0x43ff7c=new Date(_0x363ce1[_0x16427b(0x1d4)]),_0xa657d4=new Date();_0x43ff7c<_0xa657d4?_0x35ac7e=_0x16427b(0x1e0):_0x35ac7e='FAILED';}else _0x35ac7e=_0x16427b(0x1d6);}else _0x35ac7e=_0x16427b(0x1f0);return{'status':_0x35ac7e,'amount':_0x363ce1[_0x16427b(0x209)],'currency':_0x363ce1[_0x16427b(0x1ce)],'isActive':_0x363ce1[_0x16427b(0x1d1)]};}catch(_0x23738b){console[_0x16427b(0x1a8)](_0x16427b(0x1fb),_0x23738b),loggerService_1[_0x16427b(0x203)][_0x16427b(0x1b9)]('noda',_0x16427b(0x1f3)+_0xabf935,_0x23738b);throw new Error(_0x16427b(0x1cf)+(_0x23738b instanceof Error?_0x23738b[_0x16427b(0x1b3)]:'Unknown\x20error'));}}async['processWebhook'](_0x4f7497){const _0x1c6b9d=a63_0x379e56;console[_0x1c6b9d(0x1f5)](_0x1c6b9d(0x19e),_0x4f7497);let _0x5d9a5b=_0x1c6b9d(0x1f0);switch(_0x4f7497[_0x1c6b9d(0x1bd)]?.[_0x1c6b9d(0x1df)]()){case _0x1c6b9d(0x1c3):case _0x1c6b9d(0x1a4):case'paid':case'success':case _0x1c6b9d(0x1b5):_0x4f7497[_0x1c6b9d(0x1c7)]===_0x1c6b9d(0x1dd)?_0x5d9a5b=_0x1c6b9d(0x1d8):_0x5d9a5b=_0x1c6b9d(0x1f0);break;case _0x1c6b9d(0x206):case _0x1c6b9d(0x1bf):case'failed':case'error':case _0x1c6b9d(0x199):_0x5d9a5b=_0x1c6b9d(0x1d6);break;case _0x1c6b9d(0x1e8):case _0x1c6b9d(0x201):_0x5d9a5b=_0x1c6b9d(0x1e0);break;case _0x1c6b9d(0x1f8):case'created':case _0x1c6b9d(0x1ef):case'processing':case'in_progress':default:_0x5d9a5b='PENDING';break;}return{'paymentId':_0x4f7497[_0x1c6b9d(0x1c5)]||_0x4f7497['PaymentId'],'status':_0x5d9a5b,'amount':_0x4f7497[_0x1c6b9d(0x1da)],'currency':_0x4f7497[_0x1c6b9d(0x1b1)],'additionalInfo':{'method':_0x4f7497[_0x1c6b9d(0x1a5)],'bankId':_0x4f7497[_0x1c6b9d(0x1a7)],'settled':_0x4f7497[_0x1c6b9d(0x1c7)],'settlementDate':_0x4f7497[_0x1c6b9d(0x1e4)],'remitterName':_0x4f7497['Remitter']?.[_0x1c6b9d(0x1ff)],'remitterIban':_0x4f7497[_0x1c6b9d(0x1fc)]?.[_0x1c6b9d(0x19a)],'bankTransactionId':_0x4f7497[_0x1c6b9d(0x1bc)]}};}[a63_0x379e56(0x213)](_0x321a3c,_0x41fb61){const _0x77a9bb=a63_0x379e56;return console[_0x77a9bb(0x1f5)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x41fb61,'paymentId':_0x321a3c[_0x77a9bb(0x1ab)],'merchantPaymentId':_0x321a3c['MerchantPaymentId']}),!![];}}exports[a63_0x379e56(0x204)]=NodaService;