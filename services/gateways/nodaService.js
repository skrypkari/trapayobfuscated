'use strict';function a40_0x14f4(_0x4f60c2,_0x16af6d){const _0x3b89e3=a40_0x3b89();return a40_0x14f4=function(_0x14f475,_0x32aacf){_0x14f475=_0x14f475-0x1d1;let _0x130618=_0x3b89e3[_0x14f475];return _0x130618;},a40_0x14f4(_0x4f60c2,_0x16af6d);}const a40_0x40acec=a40_0x14f4;function a40_0x3b89(){const _0x442204=['Iban','fromEntries','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Error\x20Message:','(8digits-8digits\x20format)','Currency','Payment\x20Link\x20ID:','headers','NodaService','===\x20NODA\x20SERVICE\x20ERROR\x20===','PAID','toLowerCase','PaymentId','noda','Headers:','PENDING','BankTransactionId','stack','completed','(8digits-8digits\x20format\x20for\x20Noda)','626781czYqQx','pending','===\x20NODA\x20API\x20ERROR\x20===','timeout','log','verifyPayment','paid','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','apiUrl','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','QR\x20Code\x20Link:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Error\x20message:','error','logWhiteDomainRequest','===\x20NODA\x20SUCCESS\x20===','Status\x20Text:','status','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','840678mKNIrN','Status:','HTTP\x20error!\x20status:\x20','../loggerService','failed','TesSoft\x20Payment\x20System/1.0','Order\x20ID\x20Format:','Error\x20stack:','8nUxwfn','Remitter','EXPIRED','Missing\x20id\x20or\x20shortLink\x20in\x20response','FAILED','Response\x20Time:','2SrsGsx','Method','Settled','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','statusCode','isActive','message','created','3847625llHlvi','Status\x20Code:','amount','qrCodeLink','stringify','POST','parse','Failed\x20to\x20parse\x20JSON\x20response:','https://tesoft.uk/gateway/success.php?id=','processing','HTTP\x20','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','active','application/json','now','Short\x20Link:','text','3885763pvyZyn','HTTP\x20Status:','Name','in_progress','loggerService','3NOcOZf','JSON\x20Parse\x20Error:\x20','shortLinkUrls','MerchantPaymentId','expiryDate',',\x20body:\x20','Unknown\x20error','toUpperCase','processWebhook','logWhiteDomainError','logWhiteDomainResponse','successful','shortLink','Yes','Status','done','json','5620473PDVMxG','Noda\x20API\x20error:\x20','Response\x20data:','Noda\x20webhook\x20signature\x20verification:','success','SettlementDate','Request\x20Body\x20(Direct\x20JSON):','378376CpWsQr','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','19100310hpLJnR','URL:','/payment-links','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','/payment-links/'];a40_0x3b89=function(){return _0x442204;};return a40_0x3b89();}(function(_0x2bc72f,_0x4e5517){const _0x55e459=a40_0x14f4,_0x5dba3b=_0x2bc72f();while(!![]){try{const _0x544118=parseInt(_0x55e459(0x22c))/0x1*(-parseInt(_0x55e459(0x1db))/0x2)+parseInt(_0x55e459(0x1f9))/0x3*(parseInt(_0x55e459(0x211))/0x4)+-parseInt(_0x55e459(0x1e3))/0x5+-parseInt(_0x55e459(0x23f))/0x6+-parseInt(_0x55e459(0x1f4))/0x7*(-parseInt(_0x55e459(0x1d5))/0x8)+-parseInt(_0x55e459(0x20a))/0x9+parseInt(_0x55e459(0x213))/0xa;if(_0x544118===_0x4e5517)break;else _0x5dba3b['push'](_0x5dba3b['shift']());}catch(_0x4d5148){_0x5dba3b['push'](_0x5dba3b['shift']());}}}(a40_0x3b89,0x615e2));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a40_0x40acec(0x220)]=void 0x0;const loggerService_1=require(a40_0x40acec(0x242));class NodaService{constructor(){const _0x292257=a40_0x40acec;this[_0x292257(0x234)]='https://tesoft.uk/gateway/noda/',console['log'](_0x292257(0x23e));}async['createPaymentLink'](_0x3a0500){const _0x8dcab7=a40_0x40acec,{orderId:_0x1cc2a6,name:_0x5cad23,paymentDescription:_0x316bd4,amount:_0xbc9a98,currency:_0x311996,webhookUrl:_0x3ebe31,returnUrl:_0x1fd3c3,expiryDate:_0x287c97}=_0x3a0500,_0x44e290=_0x311996[_0x8dcab7(0x200)](),_0x1c1214='https://tesoft.uk/gateway/noda/webhook/',_0x4352d3=_0x8dcab7(0x1eb)+_0x1cc2a6,_0x380a6c={'name':_0x5cad23,'paymentDescription':_0x316bd4,'amount':_0xbc9a98,'currency':_0x44e290,'paymentId':_0x1cc2a6,'webhookUrl':_0x1c1214,'returnUrl':_0x4352d3};_0x287c97&&(_0x380a6c['expiryDate']=_0x287c97);const _0x32a0ee=Date[_0x8dcab7(0x1f1)]();try{console[_0x8dcab7(0x230)](_0x8dcab7(0x1de)),console[_0x8dcab7(0x230)](_0x8dcab7(0x214),this['apiUrl']),console[_0x8dcab7(0x230)](_0x8dcab7(0x210),JSON[_0x8dcab7(0x1e7)](_0x380a6c,null,0x2)),console[_0x8dcab7(0x230)](_0x8dcab7(0x1d3),_0x1cc2a6,_0x8dcab7(0x22b)),loggerService_1[_0x8dcab7(0x1f8)][_0x8dcab7(0x23a)](_0x8dcab7(0x225),_0x8dcab7(0x215),'POST',_0x380a6c);const _0x5a3aed=await fetch(this[_0x8dcab7(0x234)],{'method':_0x8dcab7(0x1e8),'headers':{'Content-Type':_0x8dcab7(0x1f0),'Accept':'application/json','User-Agent':_0x8dcab7(0x1d2)},'body':JSON[_0x8dcab7(0x1e7)](_0x380a6c)}),_0x166c77=Date['now']()-_0x32a0ee;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x8dcab7(0x230)](_0x8dcab7(0x240),_0x5a3aed[_0x8dcab7(0x23d)]),console[_0x8dcab7(0x230)](_0x8dcab7(0x23c),_0x5a3aed['statusText']),console['log'](_0x8dcab7(0x226),Object[_0x8dcab7(0x219)](_0x5a3aed[_0x8dcab7(0x21f)]['entries']())),console[_0x8dcab7(0x230)](_0x8dcab7(0x1da),_0x166c77+'ms');const _0x883d65=await _0x5a3aed[_0x8dcab7(0x1f3)]();console[_0x8dcab7(0x230)]('Raw\x20Response\x20Body:',_0x883d65);if(!_0x5a3aed['ok']){console['error'](_0x8dcab7(0x22e)),console[_0x8dcab7(0x239)](_0x8dcab7(0x1f5),_0x5a3aed[_0x8dcab7(0x23d)]),console[_0x8dcab7(0x239)]('Response\x20Body:',_0x883d65),loggerService_1[_0x8dcab7(0x1f8)]['logWhiteDomainResponse'](_0x8dcab7(0x225),'/payment-links',_0x5a3aed[_0x8dcab7(0x23d)],_0x883d65,_0x166c77),loggerService_1[_0x8dcab7(0x1f8)][_0x8dcab7(0x202)](_0x8dcab7(0x225),'/payment-links',_0x8dcab7(0x1ed)+_0x5a3aed['status']+':\x20'+_0x883d65);if(_0x5a3aed[_0x8dcab7(0x23d)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x5a3aed[_0x8dcab7(0x23d)]===0x1f4)throw new Error(_0x8dcab7(0x233));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x5a3aed[_0x8dcab7(0x23d)]+_0x8dcab7(0x1fe)+_0x883d65);}let _0x58ce6b;try{_0x58ce6b=JSON[_0x8dcab7(0x1e9)](_0x883d65);}catch(_0xefdd58){console[_0x8dcab7(0x239)](_0x8dcab7(0x1ea),_0xefdd58),loggerService_1[_0x8dcab7(0x1f8)][_0x8dcab7(0x202)](_0x8dcab7(0x225),_0x8dcab7(0x215),_0x8dcab7(0x1fa)+_0xefdd58);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x883d65);}console[_0x8dcab7(0x230)](_0x8dcab7(0x237)),console['log']('Parsed\x20Result:',JSON['stringify'](_0x58ce6b,null,0x2)),loggerService_1[_0x8dcab7(0x1f8)][_0x8dcab7(0x203)](_0x8dcab7(0x225),'/payment-links',_0x5a3aed['status'],_0x58ce6b,_0x166c77);if(_0x58ce6b['error']||_0x58ce6b[_0x8dcab7(0x1df)]){const _0x1d6f7d=_0x58ce6b[_0x8dcab7(0x1e1)]||_0x58ce6b[_0x8dcab7(0x239)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x8dcab7(0x239)](_0x8dcab7(0x1ee)),console[_0x8dcab7(0x239)](_0x8dcab7(0x21b),_0x1d6f7d),console[_0x8dcab7(0x239)](_0x8dcab7(0x1e4),_0x58ce6b[_0x8dcab7(0x1df)]),loggerService_1[_0x8dcab7(0x1f8)][_0x8dcab7(0x202)](_0x8dcab7(0x225),'/payment-links','Business\x20Error:\x20'+_0x1d6f7d);throw new Error(_0x8dcab7(0x20b)+_0x1d6f7d);}if(!_0x58ce6b['id']||!_0x58ce6b[_0x8dcab7(0x1fb)]?.[_0x8dcab7(0x205)]){console[_0x8dcab7(0x239)](_0x8dcab7(0x216)),console[_0x8dcab7(0x239)](_0x8dcab7(0x1d8)),console['error'](_0x8dcab7(0x20c),_0x58ce6b),loggerService_1[_0x8dcab7(0x1f8)][_0x8dcab7(0x202)](_0x8dcab7(0x225),_0x8dcab7(0x215),_0x8dcab7(0x21a));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x8dcab7(0x230)](_0x8dcab7(0x23b)),console['log'](_0x8dcab7(0x21e),_0x58ce6b['id']),console['log'](_0x8dcab7(0x1f2),_0x58ce6b['shortLinkUrls']['shortLink']),console[_0x8dcab7(0x230)](_0x8dcab7(0x236),_0x58ce6b[_0x8dcab7(0x1fb)][_0x8dcab7(0x1e6)]||'Not\x20provided'),console[_0x8dcab7(0x230)]('Order\x20ID\x20Used:',_0x1cc2a6,_0x8dcab7(0x21c)),{'gateway_payment_id':_0x58ce6b['id'],'payment_url':_0x58ce6b[_0x8dcab7(0x1fb)][_0x8dcab7(0x205)],'qr_code_url':_0x58ce6b[_0x8dcab7(0x1fb)]['qrCodeLink'],'expiry_date':_0x58ce6b[_0x8dcab7(0x1fd)]};}catch(_0x365e36){console[_0x8dcab7(0x239)](_0x8dcab7(0x221)),console[_0x8dcab7(0x239)]('Error\x20details:',_0x365e36),loggerService_1[_0x8dcab7(0x1f8)]['logWhiteDomainError'](_0x8dcab7(0x225),_0x8dcab7(0x215),_0x365e36);if(_0x365e36 instanceof Error){console['error'](_0x8dcab7(0x238),_0x365e36[_0x8dcab7(0x1e1)]),console[_0x8dcab7(0x239)](_0x8dcab7(0x1d4),_0x365e36[_0x8dcab7(0x229)]);throw new Error(_0x8dcab7(0x235)+_0x365e36[_0x8dcab7(0x1e1)]);}throw new Error(_0x8dcab7(0x212));}}async[a40_0x40acec(0x231)](_0x5c5179){const _0x312fd4=a40_0x40acec,_0x12a4d9=Date[_0x312fd4(0x1f1)]();try{loggerService_1['loggerService'][_0x312fd4(0x23a)]('noda',_0x312fd4(0x217)+_0x5c5179,'GET',{});const _0x48611f=await fetch(this[_0x312fd4(0x234)]+'/'+_0x5c5179,{'method':'GET','headers':{'Content-Type':_0x312fd4(0x1f0),'User-Agent':_0x312fd4(0x1d2)}}),_0x2778c5=Date[_0x312fd4(0x1f1)]()-_0x12a4d9;if(!_0x48611f['ok']){const _0x19b647=await _0x48611f[_0x312fd4(0x1f3)]();loggerService_1[_0x312fd4(0x1f8)][_0x312fd4(0x203)]('noda',_0x312fd4(0x217)+_0x5c5179,_0x48611f['status'],_0x19b647,_0x2778c5);throw new Error(_0x312fd4(0x241)+_0x48611f[_0x312fd4(0x23d)]);}const _0x140799=await _0x48611f[_0x312fd4(0x209)]();loggerService_1[_0x312fd4(0x1f8)]['logWhiteDomainResponse'](_0x312fd4(0x225),_0x312fd4(0x217)+_0x5c5179,_0x48611f[_0x312fd4(0x23d)],_0x140799,_0x2778c5);if(_0x140799[_0x312fd4(0x239)]||_0x140799[_0x312fd4(0x1df)]){loggerService_1[_0x312fd4(0x1f8)][_0x312fd4(0x202)](_0x312fd4(0x225),'/payment-links/'+_0x5c5179,_0x312fd4(0x20b)+(_0x140799[_0x312fd4(0x1e1)]||_0x140799[_0x312fd4(0x239)]||'Unknown\x20error'));throw new Error(_0x312fd4(0x20b)+(_0x140799[_0x312fd4(0x1e1)]||_0x140799[_0x312fd4(0x239)]||_0x312fd4(0x1ff)));}let _0x3e1c56=_0x312fd4(0x227);if(_0x140799[_0x312fd4(0x1e0)]===![]){if(_0x140799['expiryDate']){const _0x366588=new Date(_0x140799[_0x312fd4(0x1fd)]),_0x10ab5b=new Date();_0x366588<_0x10ab5b?_0x3e1c56='EXPIRED':_0x3e1c56=_0x312fd4(0x1d9);}else _0x3e1c56=_0x312fd4(0x1d9);}else _0x3e1c56=_0x312fd4(0x227);return{'status':_0x3e1c56,'amount':_0x140799[_0x312fd4(0x1e5)],'currency':_0x140799['currency'],'isActive':_0x140799[_0x312fd4(0x1e0)]};}catch(_0xd59b0c){console[_0x312fd4(0x239)]('Noda\x20payment\x20verification\x20error:',_0xd59b0c),loggerService_1[_0x312fd4(0x1f8)][_0x312fd4(0x202)](_0x312fd4(0x225),'/payment-links/'+_0x5c5179,_0xd59b0c);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0xd59b0c instanceof Error?_0xd59b0c[_0x312fd4(0x1e1)]:_0x312fd4(0x1ff)));}}async[a40_0x40acec(0x201)](_0x3df00e){const _0x1057fb=a40_0x40acec;console['log']('Processing\x20Noda\x20webhook:',_0x3df00e);let _0x5c2f83=_0x1057fb(0x227);switch(_0x3df00e[_0x1057fb(0x207)]?.[_0x1057fb(0x223)]()){case _0x1057fb(0x208):case _0x1057fb(0x22a):case _0x1057fb(0x232):case _0x1057fb(0x20e):case _0x1057fb(0x204):_0x3df00e[_0x1057fb(0x1dd)]===_0x1057fb(0x206)?_0x5c2f83=_0x1057fb(0x222):_0x5c2f83='PENDING';break;case'cancelled':case'canceled':case _0x1057fb(0x1d1):case _0x1057fb(0x239):case'rejected':_0x5c2f83=_0x1057fb(0x1d9);break;case'expired':case _0x1057fb(0x22f):_0x5c2f83=_0x1057fb(0x1d7);break;case _0x1057fb(0x22d):case _0x1057fb(0x1e2):case _0x1057fb(0x1ef):case _0x1057fb(0x1ec):case _0x1057fb(0x1f7):default:_0x5c2f83='PENDING';break;}return{'paymentId':_0x3df00e[_0x1057fb(0x1fc)]||_0x3df00e[_0x1057fb(0x224)],'status':_0x5c2f83,'amount':_0x3df00e['Amount'],'currency':_0x3df00e[_0x1057fb(0x21d)],'additionalInfo':{'method':_0x3df00e[_0x1057fb(0x1dc)],'bankId':_0x3df00e['BankId'],'settled':_0x3df00e[_0x1057fb(0x1dd)],'settlementDate':_0x3df00e[_0x1057fb(0x20f)],'remitterName':_0x3df00e[_0x1057fb(0x1d6)]?.[_0x1057fb(0x1f6)],'remitterIban':_0x3df00e[_0x1057fb(0x1d6)]?.[_0x1057fb(0x218)],'bankTransactionId':_0x3df00e[_0x1057fb(0x228)]}};}['verifyWebhookSignature'](_0xef2bec,_0xa2cb98){const _0x678a04=a40_0x40acec;return console['log'](_0x678a04(0x20d),{'receivedSignature':_0xa2cb98,'paymentId':_0xef2bec['PaymentId'],'merchantPaymentId':_0xef2bec[_0x678a04(0x1fc)]}),!![];}}exports[a40_0x40acec(0x220)]=NodaService;