'use strict';function a43_0x5656(_0x4ab9db,_0x128c47){const _0x412f84=a43_0x412f();return a43_0x5656=function(_0x5656d7,_0x45976c){_0x5656d7=_0x5656d7-0xab;let _0x5456b0=_0x412f84[_0x5656d7];return _0x5456b0;},a43_0x5656(_0x4ab9db,_0x128c47);}const a43_0x4adf20=a43_0x5656;(function(_0x42692f,_0x4ddd49){const _0x1b57a8=a43_0x5656,_0x120c03=_0x42692f();while(!![]){try{const _0x8de873=-parseInt(_0x1b57a8(0xc3))/0x1*(-parseInt(_0x1b57a8(0xfe))/0x2)+parseInt(_0x1b57a8(0xb4))/0x3+parseInt(_0x1b57a8(0x119))/0x4+parseInt(_0x1b57a8(0xda))/0x5+-parseInt(_0x1b57a8(0xb6))/0x6+parseInt(_0x1b57a8(0xbc))/0x7*(parseInt(_0x1b57a8(0xaf))/0x8)+-parseInt(_0x1b57a8(0xba))/0x9;if(_0x8de873===_0x4ddd49)break;else _0x120c03['push'](_0x120c03['shift']());}catch(_0x337186){_0x120c03['push'](_0x120c03['shift']());}}}(a43_0x412f,0x9d83f));function a43_0x412f(){const _0xcab34=['expired','===\x20NODA\x20API\x20ERROR\x20===','statusCode','Settled','Request\x20Body\x20(Direct\x20JSON):','amount','NodaService','Payment\x20Link\x20ID:','Order\x20ID\x20Format:','Noda\x20API\x20error:\x20','Response\x20Body:','verifyWebhookSignature','canceled','log','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Unknown\x20error\x20from\x20Noda\x20API','BankId','expiryDate','Failed\x20to\x20parse\x20JSON\x20response:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Short\x20Link:','16NJdKIK','logWhiteDomainRequest','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Response\x20data:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Remitter','PaymentId','apiUrl','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Status\x20Text:','defineProperty','HTTP\x20Status:','(8digits-8digits\x20format)','rejected','QR\x20Code\x20Link:','created','stringify','now','Order\x20ID\x20Used:','TesSoft\x20Payment\x20System/1.0','Name','Error\x20Message:','/payment-links/','Currency','pending','isActive','Response\x20Time:','998344VzkdvH','toLowerCase','statusText','Error\x20details:','https://tesoft.uk/gateway/pending.php?id=','timeout','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Processing\x20Noda\x20webhook:','processing','application/json','POST','completed','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','successful','91576ppVAtw','loggerService','https://tesoft.uk/gateway/noda/','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Raw\x20Response\x20Body:','3236235qcJYeh','Noda\x20webhook\x20signature\x20verification:','3512718myyppk','done','qrCodeLink','verifyPayment','11462544evHlJS','shortLink','483oudfgC','Iban','Headers:','Noda\x20payment\x20verification\x20error:','logWhiteDomainError','../loggerService','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','25861mnmIHt','Method','Unknown\x20error','Status:','shortLinkUrls','GET','failed','logWhiteDomainResponse','===\x20NODA\x20SERVICE\x20ERROR\x20===','Amount','json','message','Status\x20Code:','headers','PENDING','noda','===\x20NODA\x20SUCCESS\x20===','active','success','MerchantPaymentId','currency','FAILED','Error\x20message:','895950fdUBUp','processWebhook','Failed\x20to\x20verify\x20Noda\x20payment:\x20','https://tesoft.uk/gateway/noda/webhook/','status','/payment-links','EXPIRED','Status','error','text','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Parsed\x20Result:','HTTP\x20error!\x20status:\x20','SettlementDate','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value'];a43_0x412f=function(){return _0xcab34;};return a43_0x412f();}Object[a43_0x4adf20(0x108)](exports,'__esModule',{'value':!![]}),exports[a43_0x4adf20(0xef)]=void 0x0;const loggerService_1=require(a43_0x4adf20(0xc1));class NodaService{constructor(){const _0x1a38ef=a43_0x4adf20;this[_0x1a38ef(0x105)]=_0x1a38ef(0xb1),console[_0x1a38ef(0xf6)](_0x1a38ef(0xfc));}async['createPaymentLink'](_0x1b608f){const _0x479783=a43_0x4adf20,{orderId:_0x1c1101,name:_0x40cec6,paymentDescription:_0x1d45e1,amount:_0x3b5bcb,currency:_0x137abe,webhookUrl:_0x1941bf,returnUrl:_0x538fd7,expiryDate:_0xdc159d}=_0x1b608f,_0x1dc979=_0x137abe['toUpperCase'](),_0x5bf53a=_0x479783(0xdd),_0x4f44dd=_0x479783(0x11d)+_0x1c1101,_0x5ea2dc={'name':_0x40cec6,'paymentDescription':_0x1d45e1,'amount':_0x3b5bcb,'currency':_0x1dc979,'paymentId':_0x1c1101,'webhookUrl':_0x5bf53a,'returnUrl':_0x4f44dd};_0xdc159d&&(_0x5ea2dc['expiryDate']=_0xdc159d);const _0x2bdb33=Date[_0x479783(0x10f)]();try{console[_0x479783(0xf6)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x479783(0xf6)]('URL:',this[_0x479783(0x105)]),console[_0x479783(0xf6)](_0x479783(0xed),JSON[_0x479783(0x10e)](_0x5ea2dc,null,0x2)),console[_0x479783(0xf6)](_0x479783(0xf1),_0x1c1101,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x479783(0xf6)](_0x479783(0x11f),_0x4f44dd),loggerService_1[_0x479783(0xb0)][_0x479783(0xff)](_0x479783(0xd2),'/payment-links',_0x479783(0xab),_0x5ea2dc);const _0xfe42d7=await fetch(this[_0x479783(0x105)],{'method':_0x479783(0xab),'headers':{'Content-Type':_0x479783(0x122),'Accept':_0x479783(0x122),'User-Agent':_0x479783(0x111)},'body':JSON[_0x479783(0x10e)](_0x5ea2dc)}),_0x48f092=Date[_0x479783(0x10f)]()-_0x2bdb33;console[_0x479783(0xf6)](_0x479783(0xc2)),console[_0x479783(0xf6)](_0x479783(0xc6),_0xfe42d7['status']),console['log'](_0x479783(0x107),_0xfe42d7[_0x479783(0x11b)]),console['log'](_0x479783(0xbe),Object['fromEntries'](_0xfe42d7[_0x479783(0xd0)]['entries']())),console[_0x479783(0xf6)](_0x479783(0x118),_0x48f092+'ms');const _0x23af39=await _0xfe42d7[_0x479783(0xe3)]();console[_0x479783(0xf6)](_0x479783(0xb3),_0x23af39);if(!_0xfe42d7['ok']){console[_0x479783(0xe2)](_0x479783(0xea)),console[_0x479783(0xe2)](_0x479783(0x109),_0xfe42d7[_0x479783(0xde)]),console[_0x479783(0xe2)](_0x479783(0xf3),_0x23af39),loggerService_1['loggerService'][_0x479783(0xca)](_0x479783(0xd2),_0x479783(0xdf),_0xfe42d7[_0x479783(0xde)],_0x23af39,_0x48f092),loggerService_1['loggerService'][_0x479783(0xc0)](_0x479783(0xd2),_0x479783(0xdf),'HTTP\x20'+_0xfe42d7['status']+':\x20'+_0x23af39);if(_0xfe42d7[_0x479783(0xde)]===0x190)throw new Error(_0x479783(0xe8));else{if(_0xfe42d7[_0x479783(0xde)]===0x1f4)throw new Error(_0x479783(0xf7));}throw new Error('HTTP\x20error!\x20status:\x20'+_0xfe42d7[_0x479783(0xde)]+',\x20body:\x20'+_0x23af39);}let _0x4156f1;try{_0x4156f1=JSON['parse'](_0x23af39);}catch(_0x176e48){console['error'](_0x479783(0xfb),_0x176e48),loggerService_1['loggerService'][_0x479783(0xc0)](_0x479783(0xd2),_0x479783(0xdf),'JSON\x20Parse\x20Error:\x20'+_0x176e48);throw new Error(_0x479783(0x102)+_0x23af39);}console[_0x479783(0xf6)](_0x479783(0xe4)),console[_0x479783(0xf6)](_0x479783(0xe5),JSON[_0x479783(0x10e)](_0x4156f1,null,0x2)),loggerService_1[_0x479783(0xb0)][_0x479783(0xca)](_0x479783(0xd2),'/payment-links',_0xfe42d7['status'],_0x4156f1,_0x48f092);if(_0x4156f1[_0x479783(0xe2)]||_0x4156f1[_0x479783(0xeb)]){const _0x2e8fc9=_0x4156f1['message']||_0x4156f1['error']||_0x479783(0xf8);console[_0x479783(0xe2)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x479783(0x113),_0x2e8fc9),console[_0x479783(0xe2)](_0x479783(0xcf),_0x4156f1[_0x479783(0xeb)]),loggerService_1['loggerService'][_0x479783(0xc0)](_0x479783(0xd2),'/payment-links','Business\x20Error:\x20'+_0x2e8fc9);throw new Error('Noda\x20API\x20error:\x20'+_0x2e8fc9);}if(!_0x4156f1['id']||!_0x4156f1[_0x479783(0xc7)]?.['shortLink']){console[_0x479783(0xe2)](_0x479783(0xad)),console['error']('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console['error'](_0x479783(0x101),_0x4156f1),loggerService_1[_0x479783(0xb0)]['logWhiteDomainError']('noda',_0x479783(0xdf),_0x479783(0xb2));throw new Error(_0x479783(0x106));}return console[_0x479783(0xf6)](_0x479783(0xd3)),console['log'](_0x479783(0xf0),_0x4156f1['id']),console[_0x479783(0xf6)](_0x479783(0xfd),_0x4156f1[_0x479783(0xc7)][_0x479783(0xbb)]),console[_0x479783(0xf6)](_0x479783(0x10c),_0x4156f1[_0x479783(0xc7)][_0x479783(0xb8)]||'Not\x20provided'),console[_0x479783(0xf6)](_0x479783(0x110),_0x1c1101,_0x479783(0x10a)),console[_0x479783(0xf6)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x4f44dd),{'gateway_payment_id':_0x4156f1['id'],'payment_url':_0x4156f1[_0x479783(0xc7)][_0x479783(0xbb)],'qr_code_url':_0x4156f1[_0x479783(0xc7)][_0x479783(0xb8)],'expiry_date':_0x4156f1[_0x479783(0xfa)]};}catch(_0xd26059){console[_0x479783(0xe2)](_0x479783(0xcb)),console['error'](_0x479783(0x11c),_0xd26059),loggerService_1[_0x479783(0xb0)][_0x479783(0xc0)](_0x479783(0xd2),_0x479783(0xdf),_0xd26059);if(_0xd26059 instanceof Error){console[_0x479783(0xe2)](_0x479783(0xd9),_0xd26059[_0x479783(0xce)]),console[_0x479783(0xe2)]('Error\x20stack:',_0xd26059['stack']);throw new Error(_0x479783(0x100)+_0xd26059['message']);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x4adf20(0xb9)](_0xae8904){const _0x1aa72b=a43_0x4adf20,_0xea2efd=Date[_0x1aa72b(0x10f)]();try{loggerService_1[_0x1aa72b(0xb0)][_0x1aa72b(0xff)](_0x1aa72b(0xd2),'/payment-links/'+_0xae8904,'GET',{});const _0x14fb9c=await fetch(this['apiUrl']+'/'+_0xae8904,{'method':_0x1aa72b(0xc8),'headers':{'Content-Type':'application/json','User-Agent':_0x1aa72b(0x111)}}),_0x4e03bb=Date[_0x1aa72b(0x10f)]()-_0xea2efd;if(!_0x14fb9c['ok']){const _0x52846d=await _0x14fb9c[_0x1aa72b(0xe3)]();loggerService_1['loggerService'][_0x1aa72b(0xca)](_0x1aa72b(0xd2),_0x1aa72b(0x114)+_0xae8904,_0x14fb9c[_0x1aa72b(0xde)],_0x52846d,_0x4e03bb);throw new Error(_0x1aa72b(0xe6)+_0x14fb9c[_0x1aa72b(0xde)]);}const _0x576998=await _0x14fb9c[_0x1aa72b(0xcd)]();loggerService_1[_0x1aa72b(0xb0)]['logWhiteDomainResponse'](_0x1aa72b(0xd2),_0x1aa72b(0x114)+_0xae8904,_0x14fb9c[_0x1aa72b(0xde)],_0x576998,_0x4e03bb);if(_0x576998[_0x1aa72b(0xe2)]||_0x576998[_0x1aa72b(0xeb)]){loggerService_1['loggerService'][_0x1aa72b(0xc0)](_0x1aa72b(0xd2),'/payment-links/'+_0xae8904,_0x1aa72b(0xf2)+(_0x576998[_0x1aa72b(0xce)]||_0x576998[_0x1aa72b(0xe2)]||_0x1aa72b(0xc5)));throw new Error(_0x1aa72b(0xf2)+(_0x576998[_0x1aa72b(0xce)]||_0x576998[_0x1aa72b(0xe2)]||'Unknown\x20error'));}let _0x2c3329=_0x1aa72b(0xd1);if(_0x576998['isActive']===![]){if(_0x576998[_0x1aa72b(0xfa)]){const _0xe257c=new Date(_0x576998[_0x1aa72b(0xfa)]),_0x4b1519=new Date();_0xe257c<_0x4b1519?_0x2c3329=_0x1aa72b(0xe0):_0x2c3329='FAILED';}else _0x2c3329=_0x1aa72b(0xd8);}else _0x2c3329=_0x1aa72b(0xd1);return{'status':_0x2c3329,'amount':_0x576998[_0x1aa72b(0xee)],'currency':_0x576998[_0x1aa72b(0xd7)],'isActive':_0x576998[_0x1aa72b(0x117)]};}catch(_0x34912e){console['error'](_0x1aa72b(0xbf),_0x34912e),loggerService_1['loggerService'][_0x1aa72b(0xc0)](_0x1aa72b(0xd2),'/payment-links/'+_0xae8904,_0x34912e);throw new Error(_0x1aa72b(0xdc)+(_0x34912e instanceof Error?_0x34912e['message']:_0x1aa72b(0xc5)));}}async[a43_0x4adf20(0xdb)](_0x226996){const _0x1c826f=a43_0x4adf20;console['log'](_0x1c826f(0x120),_0x226996);let _0xb7884b='PENDING';switch(_0x226996[_0x1c826f(0xe1)]?.[_0x1c826f(0x11a)]()){case _0x1c826f(0xb7):case _0x1c826f(0xac):case'paid':case _0x1c826f(0xd5):case _0x1c826f(0xae):_0x226996[_0x1c826f(0xec)]==='Yes'?_0xb7884b='PAID':_0xb7884b=_0x1c826f(0xd1);break;case'cancelled':case _0x1c826f(0xf5):case _0x1c826f(0xc9):case _0x1c826f(0xe2):case _0x1c826f(0x10b):_0xb7884b=_0x1c826f(0xd8);break;case _0x1c826f(0xe9):case _0x1c826f(0x11e):_0xb7884b=_0x1c826f(0xe0);break;case _0x1c826f(0x116):case _0x1c826f(0x10d):case _0x1c826f(0xd4):case _0x1c826f(0x121):case'in_progress':default:_0xb7884b='PENDING';break;}return{'paymentId':_0x226996[_0x1c826f(0xd6)]||_0x226996[_0x1c826f(0x104)],'status':_0xb7884b,'amount':_0x226996[_0x1c826f(0xcc)],'currency':_0x226996[_0x1c826f(0x115)],'additionalInfo':{'method':_0x226996[_0x1c826f(0xc4)],'bankId':_0x226996[_0x1c826f(0xf9)],'settled':_0x226996[_0x1c826f(0xec)],'settlementDate':_0x226996[_0x1c826f(0xe7)],'remitterName':_0x226996[_0x1c826f(0x103)]?.[_0x1c826f(0x112)],'remitterIban':_0x226996[_0x1c826f(0x103)]?.[_0x1c826f(0xbd)],'bankTransactionId':_0x226996['BankTransactionId']}};}[a43_0x4adf20(0xf4)](_0x381d99,_0x1394f7){const _0x1f012a=a43_0x4adf20;return console[_0x1f012a(0xf6)](_0x1f012a(0xb5),{'receivedSignature':_0x1394f7,'paymentId':_0x381d99[_0x1f012a(0x104)],'merchantPaymentId':_0x381d99[_0x1f012a(0xd6)]}),!![];}}exports[a43_0x4adf20(0xef)]=NodaService;