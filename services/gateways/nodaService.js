'use strict';const a40_0x2bc9f1=a40_0x53ee;(function(_0x29c38c,_0x1f72e1){const _0x416680=a40_0x53ee,_0x26ff6f=_0x29c38c();while(!![]){try{const _0x324e40=parseInt(_0x416680(0xbd))/0x1+parseInt(_0x416680(0xd5))/0x2+parseInt(_0x416680(0x10e))/0x3+parseInt(_0x416680(0xbf))/0x4+-parseInt(_0x416680(0xde))/0x5+-parseInt(_0x416680(0xb4))/0x6*(parseInt(_0x416680(0xd1))/0x7)+-parseInt(_0x416680(0xd0))/0x8*(parseInt(_0x416680(0x105))/0x9);if(_0x324e40===_0x1f72e1)break;else _0x26ff6f['push'](_0x26ff6f['shift']());}catch(_0x3614dd){_0x26ff6f['push'](_0x26ff6f['shift']());}}}(a40_0x132e,0x39553));function a40_0x132e(){const _0x2822b6=['entries','URL:','327258aFMJuk','stringify','Missing\x20id\x20or\x20shortLink\x20in\x20response','message','now','statusCode','PAID','Short\x20Link:','completed','shortLink','defineProperty','Error\x20Message:','isActive','Settled','Error\x20message:','PaymentId','BankTransactionId','https://tesoft.uk/gateway/noda/','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','json','Amount','Business\x20Error:\x20','logWhiteDomainResponse','Parsed\x20Result:','TesSoft\x20Payment\x20System/1.0','HTTP\x20Status:','apiUrl','stack','Currency','currency','https://tesoft.uk/gateway/noda/webhook/','===\x20PARSED\x20NODA\x20RESPONSE\x20===','status','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Response\x20Body:','6ilcOVA','toLowerCase','Iban','FAILED','Response\x20Time:',',\x20body:\x20','success','MerchantPaymentId','amount','443154mkutUl','successful','1815284aigCuM','expired','JSON\x20Parse\x20Error:\x20','PENDING','headers','BankId','Request\x20Body\x20(Direct\x20JSON):','/payment-links/','Noda\x20payment\x20verification\x20error:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','expiryDate','processWebhook','Remitter','timeout','done','/payment-links','pending','3368ythqnc','1382514uCUCbc','fromEntries','error','verifyWebhookSignature','537158nrStMu','shortLinkUrls','Error\x20details:','active','Headers:','Status\x20Code:','SettlementDate','(8digits-8digits\x20format)','Unknown\x20error','858250BKNNjd','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','statusText','Processing\x20Noda\x20webhook:','paid','NodaService','verifyPayment','HTTP\x20','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Payment\x20Link\x20ID:','processing','created','Raw\x20Response\x20Body:','canceled','loggerService','createPaymentLink','qrCodeLink','logWhiteDomainRequest','Error\x20stack:','Method','Status:','noda','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','===\x20NODA\x20SUCCESS\x20===','toUpperCase','Order\x20ID\x20Format:','===\x20NODA\x20SERVICE\x20ERROR\x20===','in_progress','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Yes','logWhiteDomainError','application/json','GET','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Noda\x20API\x20error:\x20','EXPIRED','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Failed\x20to\x20parse\x20JSON\x20response:','https://tesoft.uk/gateway/success.php?id=','14337nhydnJ','Status\x20Text:','Order\x20ID\x20Used:','POST','HTTP\x20error!\x20status:\x20','(8digits-8digits\x20format\x20for\x20Noda)','log'];a40_0x132e=function(){return _0x2822b6;};return a40_0x132e();}Object[a40_0x2bc9f1(0x118)](exports,'__esModule',{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x56df72=a40_0x2bc9f1;this['apiUrl']=_0x56df72(0xa2),console[_0x56df72(0x10b)](_0x56df72(0xc8));}async[a40_0x2bc9f1(0xed)](_0x31435a){const _0x1a1a67=a40_0x2bc9f1,{orderId:_0x2845fd,name:_0x37c084,paymentDescription:_0x14fb19,amount:_0x461c89,currency:_0x1a0a35,webhookUrl:_0x2e2b7f,returnUrl:_0xc9b4,expiryDate:_0x509ab0}=_0x31435a,_0x81e6fe=_0x1a0a35[_0x1a1a67(0xf6)](),_0xf7130d=_0x1a1a67(0xaf),_0x3c63f6=_0x1a1a67(0x104)+_0x2845fd,_0x2cd532={'name':_0x37c084,'paymentDescription':_0x14fb19,'amount':_0x461c89,'currency':_0x81e6fe,'paymentId':_0x2845fd,'webhookUrl':_0xf7130d,'returnUrl':_0x3c63f6};_0x509ab0&&(_0x2cd532[_0x1a1a67(0xc9)]=_0x509ab0);const _0x2e34e4=Date[_0x1a1a67(0x112)]();try{console[_0x1a1a67(0x10b)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x1a1a67(0x10b)](_0x1a1a67(0x10d),this[_0x1a1a67(0xab)]),console['log'](_0x1a1a67(0xc5),JSON[_0x1a1a67(0x10f)](_0x2cd532,null,0x2)),console[_0x1a1a67(0x10b)](_0x1a1a67(0xf7),_0x2845fd,_0x1a1a67(0x10a)),loggerService_1['loggerService'][_0x1a1a67(0xef)](_0x1a1a67(0xf3),_0x1a1a67(0xce),_0x1a1a67(0x108),_0x2cd532);const _0x37cd96=await fetch(this[_0x1a1a67(0xab)],{'method':_0x1a1a67(0x108),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x1a1a67(0xa9)},'body':JSON[_0x1a1a67(0x10f)](_0x2cd532)}),_0x478daa=Date[_0x1a1a67(0x112)]()-_0x2e34e4;console[_0x1a1a67(0x10b)](_0x1a1a67(0xdf)),console['log'](_0x1a1a67(0xf2),_0x37cd96[_0x1a1a67(0xb1)]),console[_0x1a1a67(0x10b)](_0x1a1a67(0x106),_0x37cd96[_0x1a1a67(0xe0)]),console['log'](_0x1a1a67(0xd9),Object[_0x1a1a67(0xd2)](_0x37cd96[_0x1a1a67(0xc3)][_0x1a1a67(0x10c)]())),console[_0x1a1a67(0x10b)](_0x1a1a67(0xb8),_0x478daa+'ms');const _0x2c4351=await _0x37cd96['text']();console[_0x1a1a67(0x10b)](_0x1a1a67(0xea),_0x2c4351);if(!_0x37cd96['ok']){console[_0x1a1a67(0xd3)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x1a1a67(0xd3)](_0x1a1a67(0xaa),_0x37cd96[_0x1a1a67(0xb1)]),console[_0x1a1a67(0xd3)](_0x1a1a67(0xb3),_0x2c4351),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1a1a67(0xf3),_0x1a1a67(0xce),_0x37cd96[_0x1a1a67(0xb1)],_0x2c4351,_0x478daa),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x1a1a67(0xce),_0x1a1a67(0xe5)+_0x37cd96[_0x1a1a67(0xb1)]+':\x20'+_0x2c4351);if(_0x37cd96[_0x1a1a67(0xb1)]===0x190)throw new Error(_0x1a1a67(0xf4));else{if(_0x37cd96['status']===0x1f4)throw new Error(_0x1a1a67(0xe6));}throw new Error(_0x1a1a67(0x109)+_0x37cd96['status']+_0x1a1a67(0xb9)+_0x2c4351);}let _0x40f965;try{_0x40f965=JSON['parse'](_0x2c4351);}catch(_0x5c8064){console[_0x1a1a67(0xd3)](_0x1a1a67(0x103),_0x5c8064),loggerService_1[_0x1a1a67(0xec)][_0x1a1a67(0xfc)](_0x1a1a67(0xf3),'/payment-links',_0x1a1a67(0xc1)+_0x5c8064);throw new Error(_0x1a1a67(0xb2)+_0x2c4351);}console['log'](_0x1a1a67(0xb0)),console[_0x1a1a67(0x10b)](_0x1a1a67(0xa8),JSON[_0x1a1a67(0x10f)](_0x40f965,null,0x2)),loggerService_1['loggerService'][_0x1a1a67(0xa7)]('noda',_0x1a1a67(0xce),_0x37cd96[_0x1a1a67(0xb1)],_0x40f965,_0x478daa);if(_0x40f965[_0x1a1a67(0xd3)]||_0x40f965['statusCode']){const _0x4149fa=_0x40f965['message']||_0x40f965[_0x1a1a67(0xd3)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x1a1a67(0xd3)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x1a1a67(0xd3)](_0x1a1a67(0x119),_0x4149fa),console['error'](_0x1a1a67(0xda),_0x40f965[_0x1a1a67(0x113)]),loggerService_1[_0x1a1a67(0xec)][_0x1a1a67(0xfc)](_0x1a1a67(0xf3),_0x1a1a67(0xce),_0x1a1a67(0xa6)+_0x4149fa);throw new Error(_0x1a1a67(0x100)+_0x4149fa);}if(!_0x40f965['id']||!_0x40f965[_0x1a1a67(0xd6)]?.[_0x1a1a67(0x117)]){console[_0x1a1a67(0xd3)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1a1a67(0xd3)](_0x1a1a67(0x110)),console[_0x1a1a67(0xd3)]('Response\x20data:',_0x40f965),loggerService_1[_0x1a1a67(0xec)]['logWhiteDomainError'](_0x1a1a67(0xf3),'/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x1a1a67(0xfa));}return console[_0x1a1a67(0x10b)](_0x1a1a67(0xf5)),console[_0x1a1a67(0x10b)](_0x1a1a67(0xe7),_0x40f965['id']),console[_0x1a1a67(0x10b)](_0x1a1a67(0x115),_0x40f965[_0x1a1a67(0xd6)][_0x1a1a67(0x117)]),console[_0x1a1a67(0x10b)]('QR\x20Code\x20Link:',_0x40f965['shortLinkUrls'][_0x1a1a67(0xee)]||'Not\x20provided'),console[_0x1a1a67(0x10b)](_0x1a1a67(0x107),_0x2845fd,_0x1a1a67(0xdc)),{'gateway_payment_id':_0x40f965['id'],'payment_url':_0x40f965[_0x1a1a67(0xd6)][_0x1a1a67(0x117)],'qr_code_url':_0x40f965[_0x1a1a67(0xd6)][_0x1a1a67(0xee)],'expiry_date':_0x40f965[_0x1a1a67(0xc9)]};}catch(_0x25b831){console[_0x1a1a67(0xd3)](_0x1a1a67(0xf8)),console[_0x1a1a67(0xd3)](_0x1a1a67(0xd7),_0x25b831),loggerService_1[_0x1a1a67(0xec)][_0x1a1a67(0xfc)](_0x1a1a67(0xf3),_0x1a1a67(0xce),_0x25b831);if(_0x25b831 instanceof Error){console[_0x1a1a67(0xd3)](_0x1a1a67(0x9f),_0x25b831['message']),console[_0x1a1a67(0xd3)](_0x1a1a67(0xf0),_0x25b831[_0x1a1a67(0xac)]);throw new Error(_0x1a1a67(0xa3)+_0x25b831[_0x1a1a67(0x111)]);}throw new Error(_0x1a1a67(0xff));}}async[a40_0x2bc9f1(0xe4)](_0x35cb65){const _0x4c6899=a40_0x2bc9f1,_0x246383=Date[_0x4c6899(0x112)]();try{loggerService_1[_0x4c6899(0xec)][_0x4c6899(0xef)]('noda',_0x4c6899(0xc6)+_0x35cb65,'GET',{});const _0x4ec5ff=await fetch(this[_0x4c6899(0xab)]+'/'+_0x35cb65,{'method':_0x4c6899(0xfe),'headers':{'Content-Type':_0x4c6899(0xfd),'User-Agent':_0x4c6899(0xa9)}}),_0x139ad2=Date[_0x4c6899(0x112)]()-_0x246383;if(!_0x4ec5ff['ok']){const _0x1fb5bc=await _0x4ec5ff['text']();loggerService_1[_0x4c6899(0xec)][_0x4c6899(0xa7)](_0x4c6899(0xf3),'/payment-links/'+_0x35cb65,_0x4ec5ff['status'],_0x1fb5bc,_0x139ad2);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4ec5ff[_0x4c6899(0xb1)]);}const _0x2ee90a=await _0x4ec5ff[_0x4c6899(0xa4)]();loggerService_1[_0x4c6899(0xec)][_0x4c6899(0xa7)]('noda','/payment-links/'+_0x35cb65,_0x4ec5ff['status'],_0x2ee90a,_0x139ad2);if(_0x2ee90a[_0x4c6899(0xd3)]||_0x2ee90a[_0x4c6899(0x113)]){loggerService_1['loggerService'][_0x4c6899(0xfc)](_0x4c6899(0xf3),'/payment-links/'+_0x35cb65,_0x4c6899(0x100)+(_0x2ee90a[_0x4c6899(0x111)]||_0x2ee90a[_0x4c6899(0xd3)]||_0x4c6899(0xdd)));throw new Error(_0x4c6899(0x100)+(_0x2ee90a[_0x4c6899(0x111)]||_0x2ee90a[_0x4c6899(0xd3)]||_0x4c6899(0xdd)));}let _0x167b9f='PENDING';if(_0x2ee90a[_0x4c6899(0x9d)]===![]){if(_0x2ee90a[_0x4c6899(0xc9)]){const _0x58166a=new Date(_0x2ee90a['expiryDate']),_0x54d0e0=new Date();_0x58166a<_0x54d0e0?_0x167b9f='EXPIRED':_0x167b9f='FAILED';}else _0x167b9f=_0x4c6899(0xb7);}else _0x167b9f='PENDING';return{'status':_0x167b9f,'amount':_0x2ee90a[_0x4c6899(0xbc)],'currency':_0x2ee90a[_0x4c6899(0xae)],'isActive':_0x2ee90a['isActive']};}catch(_0x511c00){console['error'](_0x4c6899(0xc7),_0x511c00),loggerService_1[_0x4c6899(0xec)]['logWhiteDomainError'](_0x4c6899(0xf3),'/payment-links/'+_0x35cb65,_0x511c00);throw new Error(_0x4c6899(0x102)+(_0x511c00 instanceof Error?_0x511c00[_0x4c6899(0x111)]:_0x4c6899(0xdd)));}}async[a40_0x2bc9f1(0xca)](_0x5e0a3a){const _0x5618cd=a40_0x2bc9f1;console[_0x5618cd(0x10b)](_0x5618cd(0xe1),_0x5e0a3a);let _0xef9834=_0x5618cd(0xc2);switch(_0x5e0a3a['Status']?.[_0x5618cd(0xb5)]()){case _0x5618cd(0xcd):case _0x5618cd(0x116):case _0x5618cd(0xe2):case _0x5618cd(0xba):case _0x5618cd(0xbe):_0x5e0a3a[_0x5618cd(0x9e)]===_0x5618cd(0xfb)?_0xef9834=_0x5618cd(0x114):_0xef9834=_0x5618cd(0xc2);break;case'cancelled':case _0x5618cd(0xeb):case'failed':case _0x5618cd(0xd3):case'rejected':_0xef9834=_0x5618cd(0xb7);break;case _0x5618cd(0xc0):case _0x5618cd(0xcc):_0xef9834=_0x5618cd(0x101);break;case _0x5618cd(0xcf):case _0x5618cd(0xe9):case _0x5618cd(0xd8):case _0x5618cd(0xe8):case _0x5618cd(0xf9):default:_0xef9834=_0x5618cd(0xc2);break;}return{'paymentId':_0x5e0a3a[_0x5618cd(0xbb)]||_0x5e0a3a[_0x5618cd(0xa0)],'status':_0xef9834,'amount':_0x5e0a3a[_0x5618cd(0xa5)],'currency':_0x5e0a3a[_0x5618cd(0xad)],'additionalInfo':{'method':_0x5e0a3a[_0x5618cd(0xf1)],'bankId':_0x5e0a3a[_0x5618cd(0xc4)],'settled':_0x5e0a3a[_0x5618cd(0x9e)],'settlementDate':_0x5e0a3a[_0x5618cd(0xdb)],'remitterName':_0x5e0a3a[_0x5618cd(0xcb)]?.['Name'],'remitterIban':_0x5e0a3a[_0x5618cd(0xcb)]?.[_0x5618cd(0xb6)],'bankTransactionId':_0x5e0a3a[_0x5618cd(0xa1)]}};}[a40_0x2bc9f1(0xd4)](_0x54a26c,_0x387651){const _0x475e48=a40_0x2bc9f1;return console[_0x475e48(0x10b)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x387651,'paymentId':_0x54a26c[_0x475e48(0xa0)],'merchantPaymentId':_0x54a26c[_0x475e48(0xbb)]}),!![];}}function a40_0x53ee(_0x24604a,_0x359510){const _0x132ec4=a40_0x132e();return a40_0x53ee=function(_0x53ee3c,_0x37495e){_0x53ee3c=_0x53ee3c-0x9d;let _0x4b6f96=_0x132ec4[_0x53ee3c];return _0x4b6f96;},a40_0x53ee(_0x24604a,_0x359510);}exports[a40_0x2bc9f1(0xe3)]=NodaService;