'use strict';const a40_0x1e8fe1=a40_0x2b00;(function(_0x47182d,_0x1c1fce){const _0x41b65d=a40_0x2b00,_0x8dd653=_0x47182d();while(!![]){try{const _0x540f0c=-parseInt(_0x41b65d(0x1cf))/0x1*(-parseInt(_0x41b65d(0x1a7))/0x2)+-parseInt(_0x41b65d(0x19d))/0x3*(parseInt(_0x41b65d(0x1dd))/0x4)+-parseInt(_0x41b65d(0x1ef))/0x5*(parseInt(_0x41b65d(0x20d))/0x6)+parseInt(_0x41b65d(0x1ea))/0x7+parseInt(_0x41b65d(0x1a5))/0x8*(-parseInt(_0x41b65d(0x1ac))/0x9)+-parseInt(_0x41b65d(0x1b0))/0xa*(-parseInt(_0x41b65d(0x207))/0xb)+-parseInt(_0x41b65d(0x1e2))/0xc*(-parseInt(_0x41b65d(0x20c))/0xd);if(_0x540f0c===_0x1c1fce)break;else _0x8dd653['push'](_0x8dd653['shift']());}catch(_0x362d44){_0x8dd653['push'](_0x8dd653['shift']());}}}(a40_0x1fa4,0x46ac8));function a40_0x1fa4(){const _0x30250e=['loggerService','TesSoft\x20Payment\x20System/1.0','logWhiteDomainResponse','success','HTTP\x20error!\x20status:\x20','/payment-links','Noda\x20webhook\x20signature\x20verification:','1244110bZeYdO','text','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','shortLinkUrls','Yes','2770MlnEcB','Noda\x20payment\x20verification\x20error:','Error\x20message:','EXPIRED','now','log','fromEntries','Currency',',\x20body:\x20','Amount','verifyPayment','application/json','PENDING','PaymentId','Order\x20ID\x20Format:','done','NodaService','Noda\x20API\x20error:\x20','apiUrl','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Headers:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','PAID','cancelled','410773WsQfGA','https://tesoft.uk/gateway/noda/','HTTP\x20Status:','(8digits-8digits\x20format\x20for\x20Noda)','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','6535204zJNDVC','5766VGhMLR','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','toUpperCase','amount','toLowerCase','defineProperty','Error\x20details:','created','shortLink','Status:','42Dmhcih','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','error','/payment-links/','Error\x20stack:','logWhiteDomainRequest','Unknown\x20error','failed','33416IXZJga','Request\x20Body\x20(Direct\x20JSON):','613308RjXNIG','isActive','logWhiteDomainError','GET','Settled','1152gFhIqD','qrCodeLink','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Status\x20Code:','20ajixjk','timeout','Remitter','noda','MerchantPaymentId','Missing\x20id\x20or\x20shortLink\x20in\x20response','Processing\x20Noda\x20webhook:','Name','createPaymentLink','message','Iban','status','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','completed','Response\x20data:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','POST','Not\x20provided','BankTransactionId','active','Unknown\x20error\x20from\x20Noda\x20API','HTTP\x20','Failed\x20to\x20verify\x20Noda\x20payment:\x20','__esModule','URL:','paid','../loggerService','Response\x20Time:','stringify','JSON\x20Parse\x20Error:\x20','Status','1nXFrtS','SettlementDate','parse','expired','https://tesoft.uk/gateway/pending.php?id=','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','FAILED','Order\x20ID\x20Used:','https://tesoft.uk/gateway/noda/webhook/','statusCode','expiryDate','headers','rejected','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','59416qEOMCV','verifyWebhookSignature','successful','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Raw\x20Response\x20Body:','24obbjue'];a40_0x1fa4=function(){return _0x30250e;};return a40_0x1fa4();}function a40_0x2b00(_0x4485da,_0x24c611){const _0x1fa494=a40_0x1fa4();return a40_0x2b00=function(_0x2b0099,_0x514f01){_0x2b0099=_0x2b0099-0x198;let _0x574a51=_0x1fa494[_0x2b0099];return _0x574a51;},a40_0x2b00(_0x4485da,_0x24c611);}Object[a40_0x1e8fe1(0x198)](exports,a40_0x1e8fe1(0x1c7),{'value':!![]}),exports[a40_0x1e8fe1(0x1ff)]=void 0x0;const loggerService_1=require(a40_0x1e8fe1(0x1ca));class NodaService{constructor(){const _0x4c519f=a40_0x1e8fe1;this['apiUrl']=_0x4c519f(0x208),console[_0x4c519f(0x1f4)](_0x4c519f(0x1bf));}async[a40_0x1e8fe1(0x1b8)](_0x381c2f){const _0x296d40=a40_0x1e8fe1,{orderId:_0x364804,name:_0x3a3bbf,paymentDescription:_0x2c5b41,amount:_0x59757f,currency:_0x3e228a,webhookUrl:_0x105009,returnUrl:_0xda2406,expiryDate:_0x93c1f0}=_0x381c2f,_0x6f3b6f=_0x3e228a[_0x296d40(0x20f)](),_0x5621bd=_0x296d40(0x1d7),_0x2b226f=_0x296d40(0x1d3)+_0x364804,_0x401be3={'name':_0x3a3bbf,'paymentDescription':_0x2c5b41,'amount':_0x59757f,'currency':_0x6f3b6f,'paymentId':_0x364804,'webhookUrl':_0x5621bd,'returnUrl':_0x2b226f};_0x93c1f0&&(_0x401be3[_0x296d40(0x1d9)]=_0x93c1f0);const _0x3ba363=Date['now']();try{console[_0x296d40(0x1f4)](_0x296d40(0x1dc)),console['log'](_0x296d40(0x1c8),this[_0x296d40(0x201)]),console[_0x296d40(0x1f4)](_0x296d40(0x1a6),JSON[_0x296d40(0x1cc)](_0x401be3,null,0x2)),console['log'](_0x296d40(0x1fd),_0x364804,_0x296d40(0x20a)),console['log']('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x2b226f),loggerService_1[_0x296d40(0x1e3)][_0x296d40(0x1a2)](_0x296d40(0x1b3),'/payment-links','POST',_0x401be3);const _0xcfec6b=await fetch(this[_0x296d40(0x201)],{'method':_0x296d40(0x1c0),'headers':{'Content-Type':_0x296d40(0x1fa),'Accept':_0x296d40(0x1fa),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x296d40(0x1cc)](_0x401be3)}),_0x3ff5bb=Date['now']()-_0x3ba363;console[_0x296d40(0x1f4)](_0x296d40(0x1bc)),console[_0x296d40(0x1f4)](_0x296d40(0x19c),_0xcfec6b[_0x296d40(0x1bb)]),console['log']('Status\x20Text:',_0xcfec6b['statusText']),console[_0x296d40(0x1f4)](_0x296d40(0x203),Object[_0x296d40(0x1f5)](_0xcfec6b[_0x296d40(0x1da)]['entries']())),console['log'](_0x296d40(0x1cb),_0x3ff5bb+'ms');const _0x371a96=await _0xcfec6b['text']();console['log'](_0x296d40(0x1e1),_0x371a96);if(!_0xcfec6b['ok']){console[_0x296d40(0x19f)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x296d40(0x19f)](_0x296d40(0x209),_0xcfec6b['status']),console[_0x296d40(0x19f)]('Response\x20Body:',_0x371a96),loggerService_1[_0x296d40(0x1e3)][_0x296d40(0x1e5)]('noda',_0x296d40(0x1e8),_0xcfec6b[_0x296d40(0x1bb)],_0x371a96,_0x3ff5bb),loggerService_1[_0x296d40(0x1e3)][_0x296d40(0x1a9)](_0x296d40(0x1b3),'/payment-links',_0x296d40(0x1c5)+_0xcfec6b[_0x296d40(0x1bb)]+':\x20'+_0x371a96);if(_0xcfec6b['status']===0x190)throw new Error(_0x296d40(0x1d4));else{if(_0xcfec6b[_0x296d40(0x1bb)]===0x1f4)throw new Error(_0x296d40(0x1ae));}throw new Error(_0x296d40(0x1e7)+_0xcfec6b[_0x296d40(0x1bb)]+_0x296d40(0x1f7)+_0x371a96);}let _0x5c2d1c;try{_0x5c2d1c=JSON[_0x296d40(0x1d1)](_0x371a96);}catch(_0x39fa37){console[_0x296d40(0x19f)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x39fa37),loggerService_1[_0x296d40(0x1e3)][_0x296d40(0x1a9)](_0x296d40(0x1b3),_0x296d40(0x1e8),_0x296d40(0x1cd)+_0x39fa37);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x371a96);}console[_0x296d40(0x1f4)](_0x296d40(0x202)),console['log']('Parsed\x20Result:',JSON[_0x296d40(0x1cc)](_0x5c2d1c,null,0x2)),loggerService_1[_0x296d40(0x1e3)][_0x296d40(0x1e5)](_0x296d40(0x1b3),_0x296d40(0x1e8),_0xcfec6b[_0x296d40(0x1bb)],_0x5c2d1c,_0x3ff5bb);if(_0x5c2d1c[_0x296d40(0x19f)]||_0x5c2d1c[_0x296d40(0x1d8)]){const _0x3cef13=_0x5c2d1c[_0x296d40(0x1b9)]||_0x5c2d1c[_0x296d40(0x19f)]||_0x296d40(0x1c4);console[_0x296d40(0x19f)](_0x296d40(0x1e0)),console[_0x296d40(0x19f)]('Error\x20Message:',_0x3cef13),console[_0x296d40(0x19f)](_0x296d40(0x1af),_0x5c2d1c['statusCode']),loggerService_1[_0x296d40(0x1e3)][_0x296d40(0x1a9)](_0x296d40(0x1b3),'/payment-links','Business\x20Error:\x20'+_0x3cef13);throw new Error('Noda\x20API\x20error:\x20'+_0x3cef13);}if(!_0x5c2d1c['id']||!_0x5c2d1c[_0x296d40(0x1ed)]?.['shortLink']){console[_0x296d40(0x19f)](_0x296d40(0x20b)),console[_0x296d40(0x19f)](_0x296d40(0x1b5)),console[_0x296d40(0x19f)](_0x296d40(0x1be),_0x5c2d1c),loggerService_1[_0x296d40(0x1e3)]['logWhiteDomainError'](_0x296d40(0x1b3),_0x296d40(0x1e8),_0x296d40(0x20e));throw new Error(_0x296d40(0x1ec));}return console[_0x296d40(0x1f4)]('===\x20NODA\x20SUCCESS\x20==='),console['log']('Payment\x20Link\x20ID:',_0x5c2d1c['id']),console[_0x296d40(0x1f4)]('Short\x20Link:',_0x5c2d1c[_0x296d40(0x1ed)][_0x296d40(0x19b)]),console[_0x296d40(0x1f4)]('QR\x20Code\x20Link:',_0x5c2d1c[_0x296d40(0x1ed)]['qrCodeLink']||_0x296d40(0x1c1)),console[_0x296d40(0x1f4)](_0x296d40(0x1d6),_0x364804,'(8digits-8digits\x20format)'),console[_0x296d40(0x1f4)](_0x296d40(0x204),_0x2b226f),{'gateway_payment_id':_0x5c2d1c['id'],'payment_url':_0x5c2d1c[_0x296d40(0x1ed)]['shortLink'],'qr_code_url':_0x5c2d1c[_0x296d40(0x1ed)][_0x296d40(0x1ad)],'expiry_date':_0x5c2d1c['expiryDate']};}catch(_0x3c4100){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x296d40(0x19f)](_0x296d40(0x199),_0x3c4100),loggerService_1[_0x296d40(0x1e3)][_0x296d40(0x1a9)]('noda',_0x296d40(0x1e8),_0x3c4100);if(_0x3c4100 instanceof Error){console[_0x296d40(0x19f)](_0x296d40(0x1f1),_0x3c4100[_0x296d40(0x1b9)]),console['error'](_0x296d40(0x1a1),_0x3c4100['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x3c4100[_0x296d40(0x1b9)]);}throw new Error(_0x296d40(0x19e));}}async[a40_0x1e8fe1(0x1f9)](_0x1d396a){const _0x12dda7=a40_0x1e8fe1,_0x355f75=Date[_0x12dda7(0x1f3)]();try{loggerService_1['loggerService'][_0x12dda7(0x1a2)](_0x12dda7(0x1b3),_0x12dda7(0x1a0)+_0x1d396a,_0x12dda7(0x1aa),{});const _0x18d5f2=await fetch(this[_0x12dda7(0x201)]+'/'+_0x1d396a,{'method':_0x12dda7(0x1aa),'headers':{'Content-Type':_0x12dda7(0x1fa),'User-Agent':_0x12dda7(0x1e4)}}),_0x144b4a=Date[_0x12dda7(0x1f3)]()-_0x355f75;if(!_0x18d5f2['ok']){const _0x1c4f40=await _0x18d5f2[_0x12dda7(0x1eb)]();loggerService_1['loggerService'][_0x12dda7(0x1e5)](_0x12dda7(0x1b3),_0x12dda7(0x1a0)+_0x1d396a,_0x18d5f2[_0x12dda7(0x1bb)],_0x1c4f40,_0x144b4a);throw new Error(_0x12dda7(0x1e7)+_0x18d5f2[_0x12dda7(0x1bb)]);}const _0x47d675=await _0x18d5f2['json']();loggerService_1[_0x12dda7(0x1e3)]['logWhiteDomainResponse']('noda',_0x12dda7(0x1a0)+_0x1d396a,_0x18d5f2['status'],_0x47d675,_0x144b4a);if(_0x47d675[_0x12dda7(0x19f)]||_0x47d675[_0x12dda7(0x1d8)]){loggerService_1['loggerService'][_0x12dda7(0x1a9)](_0x12dda7(0x1b3),_0x12dda7(0x1a0)+_0x1d396a,_0x12dda7(0x200)+(_0x47d675[_0x12dda7(0x1b9)]||_0x47d675['error']||_0x12dda7(0x1a3)));throw new Error(_0x12dda7(0x200)+(_0x47d675[_0x12dda7(0x1b9)]||_0x47d675['error']||_0x12dda7(0x1a3)));}let _0x247bda=_0x12dda7(0x1fb);if(_0x47d675['isActive']===![]){if(_0x47d675[_0x12dda7(0x1d9)]){const _0x5ae126=new Date(_0x47d675['expiryDate']),_0x130cb0=new Date();_0x5ae126<_0x130cb0?_0x247bda=_0x12dda7(0x1f2):_0x247bda=_0x12dda7(0x1d5);}else _0x247bda='FAILED';}else _0x247bda=_0x12dda7(0x1fb);return{'status':_0x247bda,'amount':_0x47d675[_0x12dda7(0x210)],'currency':_0x47d675['currency'],'isActive':_0x47d675[_0x12dda7(0x1a8)]};}catch(_0x465c1f){console[_0x12dda7(0x19f)](_0x12dda7(0x1f0),_0x465c1f),loggerService_1[_0x12dda7(0x1e3)][_0x12dda7(0x1a9)](_0x12dda7(0x1b3),_0x12dda7(0x1a0)+_0x1d396a,_0x465c1f);throw new Error(_0x12dda7(0x1c6)+(_0x465c1f instanceof Error?_0x465c1f['message']:_0x12dda7(0x1a3)));}}async['processWebhook'](_0x5e354a){const _0x3da181=a40_0x1e8fe1;console[_0x3da181(0x1f4)](_0x3da181(0x1b6),_0x5e354a);let _0x23bf49=_0x3da181(0x1fb);switch(_0x5e354a[_0x3da181(0x1ce)]?.[_0x3da181(0x211)]()){case _0x3da181(0x1fe):case _0x3da181(0x1bd):case _0x3da181(0x1c9):case _0x3da181(0x1e6):case _0x3da181(0x1df):_0x5e354a[_0x3da181(0x1ab)]===_0x3da181(0x1ee)?_0x23bf49=_0x3da181(0x205):_0x23bf49=_0x3da181(0x1fb);break;case _0x3da181(0x206):case'canceled':case _0x3da181(0x1a4):case _0x3da181(0x19f):case _0x3da181(0x1db):_0x23bf49='FAILED';break;case _0x3da181(0x1d2):case _0x3da181(0x1b1):_0x23bf49=_0x3da181(0x1f2);break;case'pending':case _0x3da181(0x19a):case _0x3da181(0x1c3):case'processing':case'in_progress':default:_0x23bf49=_0x3da181(0x1fb);break;}return{'paymentId':_0x5e354a['MerchantPaymentId']||_0x5e354a[_0x3da181(0x1fc)],'status':_0x23bf49,'amount':_0x5e354a[_0x3da181(0x1f8)],'currency':_0x5e354a[_0x3da181(0x1f6)],'additionalInfo':{'method':_0x5e354a['Method'],'bankId':_0x5e354a['BankId'],'settled':_0x5e354a[_0x3da181(0x1ab)],'settlementDate':_0x5e354a[_0x3da181(0x1d0)],'remitterName':_0x5e354a['Remitter']?.[_0x3da181(0x1b7)],'remitterIban':_0x5e354a[_0x3da181(0x1b2)]?.[_0x3da181(0x1ba)],'bankTransactionId':_0x5e354a[_0x3da181(0x1c2)]}};}[a40_0x1e8fe1(0x1de)](_0xe3c9d0,_0x1f493f){const _0x21e509=a40_0x1e8fe1;return console[_0x21e509(0x1f4)](_0x21e509(0x1e9),{'receivedSignature':_0x1f493f,'paymentId':_0xe3c9d0[_0x21e509(0x1fc)],'merchantPaymentId':_0xe3c9d0[_0x21e509(0x1b4)]}),!![];}}exports[a40_0x1e8fe1(0x1ff)]=NodaService;