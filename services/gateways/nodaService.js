'use strict';const a53_0x2a6345=a53_0x22d8;(function(_0x489b1a,_0x2e0cf4){const _0x32a24a=a53_0x22d8,_0x8cf6f8=_0x489b1a();while(!![]){try{const _0x16988f=-parseInt(_0x32a24a(0x1d0))/0x1*(parseInt(_0x32a24a(0x1a5))/0x2)+parseInt(_0x32a24a(0x202))/0x3+parseInt(_0x32a24a(0x1e6))/0x4+parseInt(_0x32a24a(0x1b2))/0x5+-parseInt(_0x32a24a(0x1ac))/0x6*(-parseInt(_0x32a24a(0x19d))/0x7)+-parseInt(_0x32a24a(0x1f2))/0x8*(parseInt(_0x32a24a(0x1dc))/0x9)+-parseInt(_0x32a24a(0x1d3))/0xa;if(_0x16988f===_0x2e0cf4)break;else _0x8cf6f8['push'](_0x8cf6f8['shift']());}catch(_0x5afed7){_0x8cf6f8['push'](_0x8cf6f8['shift']());}}}(a53_0x4f54,0xe581b));Object['defineProperty'](exports,a53_0x2a6345(0x1a7),{'value':!![]}),exports[a53_0x2a6345(0x1cf)]=void 0x0;const loggerService_1=require(a53_0x2a6345(0x1bc));function a53_0x4f54(){const _0x3fc698=['toLowerCase','verifyWebhookSignature','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Headers:','8FHGknz','/payment-links','Status\x20Text:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Noda\x20webhook\x20signature\x20verification:','Name','status','BankTransactionId','statusCode','https://tesoft.uk/gateway/pending.php?id=','isActive','active','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Unknown\x20error\x20from\x20Noda\x20API','5463225CvqBCQ','parse','cancelled','Payment\x20Link\x20ID:','stack','apiUrl','in_progress','Order\x20ID\x20Format:','log','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Iban','loggerService','Yes','QR\x20Code\x20Link:','28yxyZPo','/payment-links/','HTTP\x20Status:','json','Request\x20Body\x20(Direct\x20JSON):','stringify','Method','Settled','6ERNHuK','failed','__esModule','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Remitter','POST','551850dwlSLr','processing','HTTP\x20','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PENDING','Amount','7424785BlaRVO','https://tesoft.uk/gateway/noda/','PaymentId','text','application/json','BankId','successful','===\x20NODA\x20SUCCESS\x20===','expiryDate','MerchantPaymentId','../loggerService','noda','headers','Error\x20Message:','Noda\x20payment\x20verification\x20error:','now','PAID','shortLink','expired','processWebhook','Error\x20message:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','verifyPayment','message','Order\x20ID\x20Used:','HTTP\x20error!\x20status:\x20','FAILED','Noda\x20API\x20error:\x20',',\x20body:\x20','NodaService','349362AbdLhc','Parsed\x20Result:','toUpperCase','16381560afLXtG','qrCodeLink','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','amount','paid','Error\x20stack:','fromEntries','(8digits-8digits\x20format\x20for\x20Noda)','Payment\x20System/1.0','991647lDPjef','Status','Business\x20Error:\x20','error','shortLinkUrls','Status:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Not\x20provided','Unknown\x20error','Currency','250208jZdWHO','logWhiteDomainError','Response\x20Body:','URL:','logWhiteDomainRequest','logWhiteDomainResponse','Short\x20Link:','===\x20PARSED\x20NODA\x20RESPONSE\x20==='];a53_0x4f54=function(){return _0x3fc698;};return a53_0x4f54();}function a53_0x22d8(_0x4bbff6,_0x793337){const _0x4f547d=a53_0x4f54();return a53_0x22d8=function(_0x22d863,_0x12bfd6){_0x22d863=_0x22d863-0x192;let _0x5bcf06=_0x4f547d[_0x22d863];return _0x5bcf06;},a53_0x22d8(_0x4bbff6,_0x793337);}class NodaService{constructor(){const _0x197c57=a53_0x2a6345;this['apiUrl']=_0x197c57(0x1b3),console['log'](_0x197c57(0x200));}async['createPaymentLink'](_0x5aad09){const _0xd2cdc3=a53_0x2a6345,{orderId:_0x42ce9d,name:_0x1d2fbb,paymentDescription:_0xf14908,amount:_0x7ecc49,currency:_0x3964ca,webhookUrl:_0x15df7d,returnUrl:_0x458dc8,expiryDate:_0x1eda2b}=_0x5aad09,_0x32a8b6=_0x3964ca[_0xd2cdc3(0x1d2)](),_0x2b464f='https://tesoft.uk/gateway/noda/webhook/',_0x1d971d=_0xd2cdc3(0x1fd)+_0x42ce9d,_0x4f0698={'name':_0x1d2fbb,'paymentDescription':_0xf14908,'amount':_0x7ecc49,'currency':_0x32a8b6,'paymentId':_0x42ce9d,'webhookUrl':_0x2b464f,'returnUrl':_0x1d971d};_0x1eda2b&&(_0x4f0698[_0xd2cdc3(0x1ba)]=_0x1eda2b);const _0x54346e=Date['now']();try{console[_0xd2cdc3(0x197)](_0xd2cdc3(0x198)),console[_0xd2cdc3(0x197)](_0xd2cdc3(0x1e9),this[_0xd2cdc3(0x194)]),console[_0xd2cdc3(0x197)](_0xd2cdc3(0x1a1),JSON[_0xd2cdc3(0x1a2)](_0x4f0698,null,0x2)),console[_0xd2cdc3(0x197)](_0xd2cdc3(0x196),_0x42ce9d,_0xd2cdc3(0x1da)),console[_0xd2cdc3(0x197)](_0xd2cdc3(0x1c7),_0x1d971d),loggerService_1['loggerService'][_0xd2cdc3(0x1ea)](_0xd2cdc3(0x1bd),_0xd2cdc3(0x1f3),_0xd2cdc3(0x1ab),_0x4f0698);const _0xce7982=await fetch(this[_0xd2cdc3(0x194)],{'method':_0xd2cdc3(0x1ab),'headers':{'Content-Type':_0xd2cdc3(0x1b6),'Accept':_0xd2cdc3(0x1b6),'User-Agent':_0xd2cdc3(0x1db)},'body':JSON[_0xd2cdc3(0x1a2)](_0x4f0698)}),_0x263078=Date['now']()-_0x54346e;console[_0xd2cdc3(0x197)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0xd2cdc3(0x1e1),_0xce7982['status']),console['log'](_0xd2cdc3(0x1f4),_0xce7982['statusText']),console['log'](_0xd2cdc3(0x1f1),Object[_0xd2cdc3(0x1d9)](_0xce7982[_0xd2cdc3(0x1be)]['entries']())),console[_0xd2cdc3(0x197)]('Response\x20Time:',_0x263078+'ms');const _0x5ad8e8=await _0xce7982[_0xd2cdc3(0x1b5)]();console[_0xd2cdc3(0x197)]('Raw\x20Response\x20Body:',_0x5ad8e8);if(!_0xce7982['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console['error'](_0xd2cdc3(0x19f),_0xce7982[_0xd2cdc3(0x1fa)]),console[_0xd2cdc3(0x1df)](_0xd2cdc3(0x1e8),_0x5ad8e8),loggerService_1[_0xd2cdc3(0x19a)][_0xd2cdc3(0x1eb)]('noda',_0xd2cdc3(0x1f3),_0xce7982[_0xd2cdc3(0x1fa)],_0x5ad8e8,_0x263078),loggerService_1[_0xd2cdc3(0x19a)][_0xd2cdc3(0x1e7)]('noda',_0xd2cdc3(0x1f3),_0xd2cdc3(0x1ae)+_0xce7982[_0xd2cdc3(0x1fa)]+':\x20'+_0x5ad8e8);if(_0xce7982['status']===0x190)throw new Error(_0xd2cdc3(0x1f0));else{if(_0xce7982[_0xd2cdc3(0x1fa)]===0x1f4)throw new Error(_0xd2cdc3(0x1f5));}throw new Error(_0xd2cdc3(0x1cb)+_0xce7982['status']+_0xd2cdc3(0x1ce)+_0x5ad8e8);}let _0x37210f;try{_0x37210f=JSON[_0xd2cdc3(0x203)](_0x5ad8e8);}catch(_0x394861){console[_0xd2cdc3(0x1df)](_0xd2cdc3(0x1a8),_0x394861),loggerService_1[_0xd2cdc3(0x19a)][_0xd2cdc3(0x1e7)](_0xd2cdc3(0x1bd),_0xd2cdc3(0x1f3),'JSON\x20Parse\x20Error:\x20'+_0x394861);throw new Error(_0xd2cdc3(0x1f6)+_0x5ad8e8);}console[_0xd2cdc3(0x197)](_0xd2cdc3(0x1ed)),console[_0xd2cdc3(0x197)](_0xd2cdc3(0x1d1),JSON[_0xd2cdc3(0x1a2)](_0x37210f,null,0x2)),loggerService_1[_0xd2cdc3(0x19a)][_0xd2cdc3(0x1eb)](_0xd2cdc3(0x1bd),_0xd2cdc3(0x1f3),_0xce7982[_0xd2cdc3(0x1fa)],_0x37210f,_0x263078);if(_0x37210f[_0xd2cdc3(0x1df)]||_0x37210f['statusCode']){const _0x43c955=_0x37210f[_0xd2cdc3(0x1c9)]||_0x37210f[_0xd2cdc3(0x1df)]||_0xd2cdc3(0x201);console[_0xd2cdc3(0x1df)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0xd2cdc3(0x1df)](_0xd2cdc3(0x1bf),_0x43c955),console['error']('Status\x20Code:',_0x37210f[_0xd2cdc3(0x1fc)]),loggerService_1[_0xd2cdc3(0x19a)][_0xd2cdc3(0x1e7)](_0xd2cdc3(0x1bd),_0xd2cdc3(0x1f3),_0xd2cdc3(0x1de)+_0x43c955);throw new Error('Noda\x20API\x20error:\x20'+_0x43c955);}if(!_0x37210f['id']||!_0x37210f['shortLinkUrls']?.[_0xd2cdc3(0x1c3)]){console[_0xd2cdc3(0x1df)](_0xd2cdc3(0x1af)),console[_0xd2cdc3(0x1df)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0xd2cdc3(0x1df)]('Response\x20data:',_0x37210f),loggerService_1[_0xd2cdc3(0x19a)][_0xd2cdc3(0x1e7)](_0xd2cdc3(0x1bd),'/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0xd2cdc3(0x1d5));}return console[_0xd2cdc3(0x197)](_0xd2cdc3(0x1b9)),console[_0xd2cdc3(0x197)](_0xd2cdc3(0x192),_0x37210f['id']),console[_0xd2cdc3(0x197)](_0xd2cdc3(0x1ec),_0x37210f[_0xd2cdc3(0x1e0)]['shortLink']),console[_0xd2cdc3(0x197)](_0xd2cdc3(0x19c),_0x37210f[_0xd2cdc3(0x1e0)][_0xd2cdc3(0x1d4)]||_0xd2cdc3(0x1e3)),console[_0xd2cdc3(0x197)](_0xd2cdc3(0x1ca),_0x42ce9d,'(8digits-8digits\x20format)'),console[_0xd2cdc3(0x197)](_0xd2cdc3(0x1f7),_0x1d971d),{'gateway_payment_id':_0x37210f['id'],'payment_url':_0x37210f[_0xd2cdc3(0x1e0)][_0xd2cdc3(0x1c3)],'qr_code_url':_0x37210f[_0xd2cdc3(0x1e0)][_0xd2cdc3(0x1d4)],'expiry_date':_0x37210f['expiryDate']};}catch(_0x136149){console[_0xd2cdc3(0x1df)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0xd2cdc3(0x1df)]('Error\x20details:',_0x136149),loggerService_1['loggerService'][_0xd2cdc3(0x1e7)](_0xd2cdc3(0x1bd),_0xd2cdc3(0x1f3),_0x136149);if(_0x136149 instanceof Error){console[_0xd2cdc3(0x1df)](_0xd2cdc3(0x1c6),_0x136149[_0xd2cdc3(0x1c9)]),console['error'](_0xd2cdc3(0x1d8),_0x136149[_0xd2cdc3(0x193)]);throw new Error(_0xd2cdc3(0x1e2)+_0x136149[_0xd2cdc3(0x1c9)]);}throw new Error(_0xd2cdc3(0x1a9));}}async[a53_0x2a6345(0x1c8)](_0x519e2f){const _0x3411cf=a53_0x2a6345,_0x566bfb=Date[_0x3411cf(0x1c1)]();try{loggerService_1[_0x3411cf(0x19a)][_0x3411cf(0x1ea)](_0x3411cf(0x1bd),_0x3411cf(0x19e)+_0x519e2f,'GET',{});const _0x55d84e=await fetch(this[_0x3411cf(0x194)]+'/'+_0x519e2f,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x3411cf(0x1db)}}),_0x1c00a3=Date['now']()-_0x566bfb;if(!_0x55d84e['ok']){const _0x181e77=await _0x55d84e[_0x3411cf(0x1b5)]();loggerService_1[_0x3411cf(0x19a)][_0x3411cf(0x1eb)]('noda',_0x3411cf(0x19e)+_0x519e2f,_0x55d84e[_0x3411cf(0x1fa)],_0x181e77,_0x1c00a3);throw new Error(_0x3411cf(0x1cb)+_0x55d84e[_0x3411cf(0x1fa)]);}const _0x3bf726=await _0x55d84e[_0x3411cf(0x1a0)]();loggerService_1['loggerService'][_0x3411cf(0x1eb)](_0x3411cf(0x1bd),_0x3411cf(0x19e)+_0x519e2f,_0x55d84e['status'],_0x3bf726,_0x1c00a3);if(_0x3bf726[_0x3411cf(0x1df)]||_0x3bf726['statusCode']){loggerService_1['loggerService'][_0x3411cf(0x1e7)](_0x3411cf(0x1bd),_0x3411cf(0x19e)+_0x519e2f,_0x3411cf(0x1cd)+(_0x3bf726['message']||_0x3bf726[_0x3411cf(0x1df)]||_0x3411cf(0x1e4)));throw new Error(_0x3411cf(0x1cd)+(_0x3bf726[_0x3411cf(0x1c9)]||_0x3bf726[_0x3411cf(0x1df)]||_0x3411cf(0x1e4)));}let _0x14563e=_0x3411cf(0x1b0);if(_0x3bf726[_0x3411cf(0x1fe)]===![]){if(_0x3bf726[_0x3411cf(0x1ba)]){const _0x344a6f=new Date(_0x3bf726[_0x3411cf(0x1ba)]),_0x1874b1=new Date();_0x344a6f<_0x1874b1?_0x14563e='EXPIRED':_0x14563e='FAILED';}else _0x14563e=_0x3411cf(0x1cc);}else _0x14563e='PENDING';return{'status':_0x14563e,'amount':_0x3bf726[_0x3411cf(0x1d6)],'currency':_0x3bf726['currency'],'isActive':_0x3bf726[_0x3411cf(0x1fe)]};}catch(_0x593d09){console[_0x3411cf(0x1df)](_0x3411cf(0x1c0),_0x593d09),loggerService_1[_0x3411cf(0x19a)][_0x3411cf(0x1e7)](_0x3411cf(0x1bd),'/payment-links/'+_0x519e2f,_0x593d09);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x593d09 instanceof Error?_0x593d09[_0x3411cf(0x1c9)]:_0x3411cf(0x1e4)));}}async[a53_0x2a6345(0x1c5)](_0x3d92c6){const _0xc27cab=a53_0x2a6345;console[_0xc27cab(0x197)]('Processing\x20Noda\x20webhook:',_0x3d92c6);let _0x4963b0=_0xc27cab(0x1b0);switch(_0x3d92c6[_0xc27cab(0x1dd)]?.[_0xc27cab(0x1ee)]()){case'done':case'completed':case _0xc27cab(0x1d7):case'success':case _0xc27cab(0x1b8):_0x3d92c6[_0xc27cab(0x1a4)]===_0xc27cab(0x19b)?_0x4963b0=_0xc27cab(0x1c2):_0x4963b0=_0xc27cab(0x1b0);break;case _0xc27cab(0x204):case'canceled':case _0xc27cab(0x1a6):case _0xc27cab(0x1df):case'rejected':_0x4963b0=_0xc27cab(0x1cc);break;case _0xc27cab(0x1c4):case'timeout':_0x4963b0='EXPIRED';break;case'pending':case'created':case _0xc27cab(0x1ff):case _0xc27cab(0x1ad):case _0xc27cab(0x195):default:_0x4963b0=_0xc27cab(0x1b0);break;}return{'paymentId':_0x3d92c6[_0xc27cab(0x1bb)]||_0x3d92c6[_0xc27cab(0x1b4)],'status':_0x4963b0,'amount':_0x3d92c6[_0xc27cab(0x1b1)],'currency':_0x3d92c6[_0xc27cab(0x1e5)],'additionalInfo':{'method':_0x3d92c6[_0xc27cab(0x1a3)],'bankId':_0x3d92c6[_0xc27cab(0x1b7)],'settled':_0x3d92c6[_0xc27cab(0x1a4)],'settlementDate':_0x3d92c6['SettlementDate'],'remitterName':_0x3d92c6[_0xc27cab(0x1aa)]?.[_0xc27cab(0x1f9)],'remitterIban':_0x3d92c6[_0xc27cab(0x1aa)]?.[_0xc27cab(0x199)],'bankTransactionId':_0x3d92c6[_0xc27cab(0x1fb)]}};}[a53_0x2a6345(0x1ef)](_0x2032e0,_0x2487ee){const _0x4af7e2=a53_0x2a6345;return console['log'](_0x4af7e2(0x1f8),{'receivedSignature':_0x2487ee,'paymentId':_0x2032e0[_0x4af7e2(0x1b4)],'merchantPaymentId':_0x2032e0[_0x4af7e2(0x1bb)]}),!![];}}exports[a53_0x2a6345(0x1cf)]=NodaService;