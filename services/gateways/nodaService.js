'use strict';const a46_0x58063a=a46_0x123e;function a46_0x123e(_0x345dc7,_0x33b013){const _0x17645f=a46_0x1764();return a46_0x123e=function(_0x123e75,_0x296f1a){_0x123e75=_0x123e75-0x1a3;let _0x1a9ac3=_0x17645f[_0x123e75];return _0x1a9ac3;},a46_0x123e(_0x345dc7,_0x33b013);}(function(_0x53df94,_0x3942b9){const _0x263bd8=a46_0x123e,_0xcc51ba=_0x53df94();while(!![]){try{const _0x3ad645=-parseInt(_0x263bd8(0x1c0))/0x1+-parseInt(_0x263bd8(0x208))/0x2*(-parseInt(_0x263bd8(0x1e3))/0x3)+parseInt(_0x263bd8(0x1fd))/0x4+-parseInt(_0x263bd8(0x1b0))/0x5*(-parseInt(_0x263bd8(0x207))/0x6)+parseInt(_0x263bd8(0x1ae))/0x7+-parseInt(_0x263bd8(0x1cd))/0x8+-parseInt(_0x263bd8(0x1d6))/0x9;if(_0x3ad645===_0x3942b9)break;else _0xcc51ba['push'](_0xcc51ba['shift']());}catch(_0x26f5e3){_0xcc51ba['push'](_0xcc51ba['shift']());}}}(a46_0x1764,0x9802d));Object[a46_0x58063a(0x1c1)](exports,a46_0x58063a(0x1a7),{'value':!![]}),exports[a46_0x58063a(0x1b9)]=void 0x0;const loggerService_1=require(a46_0x58063a(0x1cc));class NodaService{constructor(){this['apiUrl']='https://tesoft.uk/gateway/noda/',console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a46_0x58063a(0x20b)](_0x55f86b){const _0x115329=a46_0x58063a,{orderId:_0x3c45df,name:_0x3866b0,paymentDescription:_0x33af50,amount:_0x7ca937,currency:_0x9f47a3,webhookUrl:_0x1804bc,returnUrl:_0x4e77d7,expiryDate:_0x1c1aec}=_0x55f86b,_0x197517=_0x9f47a3['toUpperCase'](),_0x5ae394=_0x115329(0x1fe),_0x4d4745=_0x115329(0x205)+_0x3c45df,_0xed607={'name':_0x3866b0,'paymentDescription':_0x33af50,'amount':_0x7ca937,'currency':_0x197517,'paymentId':_0x3c45df,'webhookUrl':_0x5ae394,'returnUrl':_0x4d4745};_0x1c1aec&&(_0xed607[_0x115329(0x1bc)]=_0x1c1aec);const _0x3b95ef=Date[_0x115329(0x1d8)]();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x115329(0x1a4)]('URL:',this[_0x115329(0x1f7)]),console['log']('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x115329(0x210)](_0xed607,null,0x2)),console[_0x115329(0x1a4)](_0x115329(0x1ca),_0x3c45df,_0x115329(0x1b4)),console['log'](_0x115329(0x1fc),_0x4d4745),loggerService_1[_0x115329(0x1f1)][_0x115329(0x1c3)]('noda',_0x115329(0x1ec),_0x115329(0x1e9),_0xed607);const _0x479240=await fetch(this[_0x115329(0x1f7)],{'method':_0x115329(0x1e9),'headers':{'Content-Type':_0x115329(0x1d7),'Accept':_0x115329(0x1d7),'User-Agent':_0x115329(0x1f4)},'body':JSON[_0x115329(0x210)](_0xed607)}),_0x51a547=Date[_0x115329(0x1d8)]()-_0x3b95ef;console[_0x115329(0x1a4)](_0x115329(0x1c7)),console[_0x115329(0x1a4)]('Status:',_0x479240[_0x115329(0x1a9)]),console['log'](_0x115329(0x1b5),_0x479240[_0x115329(0x1b8)]),console[_0x115329(0x1a4)]('Headers:',Object[_0x115329(0x1e6)](_0x479240['headers'][_0x115329(0x1bb)]())),console['log'](_0x115329(0x1db),_0x51a547+'ms');const _0x3055df=await _0x479240['text']();console['log'](_0x115329(0x1b6),_0x3055df);if(!_0x479240['ok']){console['error'](_0x115329(0x1bf)),console[_0x115329(0x1e0)](_0x115329(0x1c6),_0x479240[_0x115329(0x1a9)]),console[_0x115329(0x1e0)]('Response\x20Body:',_0x3055df),loggerService_1['loggerService'][_0x115329(0x1ce)](_0x115329(0x204),'/payment-links',_0x479240[_0x115329(0x1a9)],_0x3055df,_0x51a547),loggerService_1[_0x115329(0x1f1)][_0x115329(0x202)](_0x115329(0x204),_0x115329(0x1ec),_0x115329(0x1ed)+_0x479240[_0x115329(0x1a9)]+':\x20'+_0x3055df);if(_0x479240[_0x115329(0x1a9)]===0x190)throw new Error(_0x115329(0x1ab));else{if(_0x479240[_0x115329(0x1a9)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x115329(0x1eb)+_0x479240['status']+',\x20body:\x20'+_0x3055df);}let _0x40d0af;try{_0x40d0af=JSON[_0x115329(0x1c5)](_0x3055df);}catch(_0x184b9c){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x184b9c),loggerService_1[_0x115329(0x1f1)][_0x115329(0x202)](_0x115329(0x204),_0x115329(0x1ec),_0x115329(0x1de)+_0x184b9c);throw new Error(_0x115329(0x203)+_0x3055df);}console[_0x115329(0x1a4)](_0x115329(0x1b7)),console[_0x115329(0x1a4)]('Parsed\x20Result:',JSON['stringify'](_0x40d0af,null,0x2)),loggerService_1[_0x115329(0x1f1)]['logWhiteDomainResponse'](_0x115329(0x204),_0x115329(0x1ec),_0x479240[_0x115329(0x1a9)],_0x40d0af,_0x51a547);if(_0x40d0af[_0x115329(0x1e0)]||_0x40d0af['statusCode']){const _0x3cad86=_0x40d0af[_0x115329(0x1f5)]||_0x40d0af['error']||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x115329(0x1e0)](_0x115329(0x1ef)),console['error'](_0x115329(0x20f),_0x3cad86),console[_0x115329(0x1e0)]('Status\x20Code:',_0x40d0af[_0x115329(0x200)]),loggerService_1['loggerService'][_0x115329(0x202)](_0x115329(0x204),_0x115329(0x1ec),_0x115329(0x1b1)+_0x3cad86);throw new Error(_0x115329(0x1f3)+_0x3cad86);}if(!_0x40d0af['id']||!_0x40d0af[_0x115329(0x20e)]?.[_0x115329(0x1e1)]){console[_0x115329(0x1e0)](_0x115329(0x20d)),console['error'](_0x115329(0x1d5)),console[_0x115329(0x1e0)](_0x115329(0x1be),_0x40d0af),loggerService_1[_0x115329(0x1f1)][_0x115329(0x202)](_0x115329(0x204),_0x115329(0x1ec),_0x115329(0x1da));throw new Error(_0x115329(0x20c));}return console[_0x115329(0x1a4)]('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x115329(0x201),_0x40d0af['id']),console['log'](_0x115329(0x1aa),_0x40d0af[_0x115329(0x20e)][_0x115329(0x1e1)]),console['log'](_0x115329(0x1ff),_0x40d0af['shortLinkUrls'][_0x115329(0x1ad)]||'Not\x20provided'),console[_0x115329(0x1a4)]('Order\x20ID\x20Used:',_0x3c45df,'(8digits-8digits\x20format)'),console[_0x115329(0x1a4)](_0x115329(0x20a),_0x4d4745),{'gateway_payment_id':_0x40d0af['id'],'payment_url':_0x40d0af[_0x115329(0x20e)][_0x115329(0x1e1)],'qr_code_url':_0x40d0af[_0x115329(0x20e)][_0x115329(0x1ad)],'expiry_date':_0x40d0af[_0x115329(0x1bc)]};}catch(_0x557d3e){console[_0x115329(0x1e0)](_0x115329(0x1a8)),console[_0x115329(0x1e0)](_0x115329(0x1f8),_0x557d3e),loggerService_1['loggerService'][_0x115329(0x202)](_0x115329(0x204),_0x115329(0x1ec),_0x557d3e);if(_0x557d3e instanceof Error){console['error']('Error\x20message:',_0x557d3e[_0x115329(0x1f5)]),console[_0x115329(0x1e0)](_0x115329(0x1ea),_0x557d3e[_0x115329(0x1e5)]);throw new Error(_0x115329(0x1b2)+_0x557d3e[_0x115329(0x1f5)]);}throw new Error(_0x115329(0x1f6));}}async[a46_0x58063a(0x1d0)](_0x19711b){const _0x2cf7c3=a46_0x58063a,_0xba84ef=Date['now']();try{loggerService_1[_0x2cf7c3(0x1f1)][_0x2cf7c3(0x1c3)](_0x2cf7c3(0x204),_0x2cf7c3(0x1f9)+_0x19711b,_0x2cf7c3(0x1d9),{});const _0x48a455=await fetch(this[_0x2cf7c3(0x1f7)]+'/'+_0x19711b,{'method':_0x2cf7c3(0x1d9),'headers':{'Content-Type':_0x2cf7c3(0x1d7),'User-Agent':_0x2cf7c3(0x1f4)}}),_0x42b394=Date[_0x2cf7c3(0x1d8)]()-_0xba84ef;if(!_0x48a455['ok']){const _0xc44fb7=await _0x48a455['text']();loggerService_1['loggerService'][_0x2cf7c3(0x1ce)](_0x2cf7c3(0x204),_0x2cf7c3(0x1f9)+_0x19711b,_0x48a455[_0x2cf7c3(0x1a9)],_0xc44fb7,_0x42b394);throw new Error(_0x2cf7c3(0x1eb)+_0x48a455[_0x2cf7c3(0x1a9)]);}const _0x381ab8=await _0x48a455[_0x2cf7c3(0x1d1)]();loggerService_1[_0x2cf7c3(0x1f1)]['logWhiteDomainResponse'](_0x2cf7c3(0x204),'/payment-links/'+_0x19711b,_0x48a455[_0x2cf7c3(0x1a9)],_0x381ab8,_0x42b394);if(_0x381ab8[_0x2cf7c3(0x1e0)]||_0x381ab8[_0x2cf7c3(0x200)]){loggerService_1[_0x2cf7c3(0x1f1)][_0x2cf7c3(0x202)](_0x2cf7c3(0x204),'/payment-links/'+_0x19711b,'Noda\x20API\x20error:\x20'+(_0x381ab8[_0x2cf7c3(0x1f5)]||_0x381ab8[_0x2cf7c3(0x1e0)]||'Unknown\x20error'));throw new Error(_0x2cf7c3(0x1f3)+(_0x381ab8[_0x2cf7c3(0x1f5)]||_0x381ab8[_0x2cf7c3(0x1e0)]||_0x2cf7c3(0x1cb)));}let _0x4c1cf5=_0x2cf7c3(0x1e8);if(_0x381ab8[_0x2cf7c3(0x1d4)]===![]){if(_0x381ab8['expiryDate']){const _0x2ef23c=new Date(_0x381ab8[_0x2cf7c3(0x1bc)]),_0x5846be=new Date();_0x2ef23c<_0x5846be?_0x4c1cf5=_0x2cf7c3(0x1c4):_0x4c1cf5=_0x2cf7c3(0x1cf);}else _0x4c1cf5='FAILED';}else _0x4c1cf5=_0x2cf7c3(0x1e8);return{'status':_0x4c1cf5,'amount':_0x381ab8[_0x2cf7c3(0x1ac)],'currency':_0x381ab8[_0x2cf7c3(0x1dd)],'isActive':_0x381ab8[_0x2cf7c3(0x1d4)]};}catch(_0x8f9787){console[_0x2cf7c3(0x1e0)](_0x2cf7c3(0x1fb),_0x8f9787),loggerService_1[_0x2cf7c3(0x1f1)][_0x2cf7c3(0x202)]('noda',_0x2cf7c3(0x1f9)+_0x19711b,_0x8f9787);throw new Error(_0x2cf7c3(0x1bd)+(_0x8f9787 instanceof Error?_0x8f9787['message']:_0x2cf7c3(0x1cb)));}}async['processWebhook'](_0x39f2e0){const _0x11a365=a46_0x58063a;console[_0x11a365(0x1a4)](_0x11a365(0x1dc),_0x39f2e0);let _0x31bec7=_0x11a365(0x1e8);switch(_0x39f2e0[_0x11a365(0x1a6)]?.[_0x11a365(0x1af)]()){case'done':case'completed':case _0x11a365(0x1f0):case'success':case _0x11a365(0x1c9):_0x39f2e0[_0x11a365(0x1ba)]===_0x11a365(0x1df)?_0x31bec7=_0x11a365(0x1d2):_0x31bec7=_0x11a365(0x1e8);break;case'cancelled':case'canceled':case'failed':case _0x11a365(0x1e0):case'rejected':_0x31bec7=_0x11a365(0x1cf);break;case'expired':case'timeout':_0x31bec7=_0x11a365(0x1c4);break;case'pending':case _0x11a365(0x1b3):case _0x11a365(0x1d3):case _0x11a365(0x1a3):case _0x11a365(0x209):default:_0x31bec7=_0x11a365(0x1e8);break;}return{'paymentId':_0x39f2e0[_0x11a365(0x1f2)]||_0x39f2e0['PaymentId'],'status':_0x31bec7,'amount':_0x39f2e0[_0x11a365(0x206)],'currency':_0x39f2e0[_0x11a365(0x1c2)],'additionalInfo':{'method':_0x39f2e0['Method'],'bankId':_0x39f2e0[_0x11a365(0x1fa)],'settled':_0x39f2e0[_0x11a365(0x1ba)],'settlementDate':_0x39f2e0[_0x11a365(0x1ee)],'remitterName':_0x39f2e0[_0x11a365(0x1e4)]?.[_0x11a365(0x1c8)],'remitterIban':_0x39f2e0['Remitter']?.['Iban'],'bankTransactionId':_0x39f2e0[_0x11a365(0x1a5)]}};}[a46_0x58063a(0x1e2)](_0x18e9d7,_0x441ac3){const _0x14d001=a46_0x58063a;return console[_0x14d001(0x1a4)](_0x14d001(0x1e7),{'receivedSignature':_0x441ac3,'paymentId':_0x18e9d7['PaymentId'],'merchantPaymentId':_0x18e9d7[_0x14d001(0x1f2)]}),!![];}}exports[a46_0x58063a(0x1b9)]=NodaService;function a46_0x1764(){const _0x392970=['Yes','error','shortLink','verifyWebhookSignature','103449mptJBH','Remitter','stack','fromEntries','Noda\x20webhook\x20signature\x20verification:','PENDING','POST','Error\x20stack:','HTTP\x20error!\x20status:\x20','/payment-links','HTTP\x20','SettlementDate','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','paid','loggerService','MerchantPaymentId','Noda\x20API\x20error:\x20','TesSoft\x20Payment\x20System/1.0','message','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','apiUrl','Error\x20details:','/payment-links/','BankId','Noda\x20payment\x20verification\x20error:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','3215184UilHDO','https://tesoft.uk/gateway/noda/webhook/','QR\x20Code\x20Link:','statusCode','Payment\x20Link\x20ID:','logWhiteDomainError','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','noda','https://tesoft.uk/gateway/pending.php?id=','Amount','51666aHjGHl','48pfkHIw','in_progress','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','createPaymentLink','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','shortLinkUrls','Error\x20Message:','stringify','processing','log','BankTransactionId','Status','__esModule','===\x20NODA\x20SERVICE\x20ERROR\x20===','status','Short\x20Link:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','amount','qrCodeLink','5394480EWDYPc','toLowerCase','615uAkBBi','Business\x20Error:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','created','(8digits-8digits\x20format\x20for\x20Noda)','Status\x20Text:','Raw\x20Response\x20Body:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','statusText','NodaService','Settled','entries','expiryDate','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Response\x20data:','===\x20NODA\x20API\x20ERROR\x20===','886104wcxaUz','defineProperty','Currency','logWhiteDomainRequest','EXPIRED','parse','HTTP\x20Status:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Name','successful','Order\x20ID\x20Format:','Unknown\x20error','../loggerService','1131104bRAYGB','logWhiteDomainResponse','FAILED','verifyPayment','json','PAID','active','isActive','Missing\x20id\x20or\x20shortLink\x20in\x20response','16299468LVbjBT','application/json','now','GET','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Response\x20Time:','Processing\x20Noda\x20webhook:','currency','JSON\x20Parse\x20Error:\x20'];a46_0x1764=function(){return _0x392970;};return a46_0x1764();}