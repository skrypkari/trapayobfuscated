'use strict';const a43_0x5b332b=a43_0xe3b6;(function(_0x89ccb,_0x3c83de){const _0x52b892=a43_0xe3b6,_0x31f029=_0x89ccb();while(!![]){try{const _0x16f157=-parseInt(_0x52b892(0xc2))/0x1*(-parseInt(_0x52b892(0xb7))/0x2)+parseInt(_0x52b892(0xfd))/0x3*(-parseInt(_0x52b892(0xf4))/0x4)+-parseInt(_0x52b892(0xcf))/0x5*(-parseInt(_0x52b892(0xcc))/0x6)+parseInt(_0x52b892(0x104))/0x7*(parseInt(_0x52b892(0xde))/0x8)+parseInt(_0x52b892(0xc5))/0x9+parseInt(_0x52b892(0xdc))/0xa+-parseInt(_0x52b892(0xd3))/0xb;if(_0x16f157===_0x3c83de)break;else _0x31f029['push'](_0x31f029['shift']());}catch(_0x291fa0){_0x31f029['push'](_0x31f029['shift']());}}}(a43_0x26dd,0x58df6));function a43_0x26dd(){const _0x356a92=['fromEntries','noda','Amount','Error\x20Message:','MerchantPaymentId','pending','status','log','SettlementDate','loggerService','successful','===\x20NODA\x20API\x20ERROR\x20===','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','20wvejHx','Yes','toLowerCase','HTTP\x20Status:','FAILED','now','__esModule','(8digits-8digits\x20format)','expiryDate','421833JLttvE','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','apiUrl','cancelled','stringify','amount','(8digits-8digits\x20format\x20for\x20Noda)','714gLxKuH','statusCode','Noda\x20API\x20error:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Response\x20Body:','application/json','Failed\x20to\x20parse\x20JSON\x20response:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','defineProperty','stack','Parsed\x20Result:','/payment-links','URL:','HTTP\x20','Method','Business\x20Error:\x20','https://tesoft.uk/gateway/noda/','text','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Error\x20message:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','logWhiteDomainResponse','done','verifyWebhookSignature','headers','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Name',',\x20body:\x20','error','Not\x20provided','https://tesoft.uk/gateway/noda/webhook/','NodaService','isActive','PENDING','https://tesoft.uk/gateway/pending.php?id=','Noda\x20payment\x20verification\x20error:','Status','active','rejected','Error\x20details:','shortLink','===\x20NODA\x20SERVICE\x20ERROR\x20===','===\x20PARSED\x20NODA\x20RESPONSE\x20===','statusText','shortLinkUrls','30870ZokYfv','Unknown\x20error','Error\x20stack:','json','processWebhook','EXPIRED','Headers:','created','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','qrCodeLink','21gJIGxl','GET','toUpperCase','4554603jpHpXy','in_progress','success','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Processing\x20Noda\x20webhook:','message','/payment-links/','138BSjMop','currency','POST','65245uZzmrd','Payment\x20Link\x20ID:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','TesSoft\x20Payment\x20System/1.0','9565743ZNcZzW','entries','Remitter','parse','logWhiteDomainError','===\x20NODA\x20SUCCESS\x20===','Response\x20data:','PaymentId','Settled','6534630BHXkSa','Order\x20ID\x20Used:','11992aWVRAR','createPaymentLink','completed','BankTransactionId','QR\x20Code\x20Link:','PAID','processing','logWhiteDomainRequest','BankId'];a43_0x26dd=function(){return _0x356a92;};return a43_0x26dd();}Object[a43_0x5b332b(0x10c)](exports,a43_0x5b332b(0xfa),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require('../loggerService');function a43_0xe3b6(_0x209329,_0xe74f63){const _0x26ddc2=a43_0x26dd();return a43_0xe3b6=function(_0xe3b6e2,_0x549ba7){_0xe3b6e2=_0xe3b6e2-0xb5;let _0x1de3d8=_0x26ddc2[_0xe3b6e2];return _0x1de3d8;},a43_0xe3b6(_0x209329,_0xe74f63);}class NodaService{constructor(){const _0x46c806=a43_0x5b332b;this[_0x46c806(0xff)]=_0x46c806(0x114),console[_0x46c806(0xee)](_0x46c806(0xf3));}async[a43_0x5b332b(0xdf)](_0x444f82){const _0x1af275=a43_0x5b332b,{orderId:_0x5d7d6a,name:_0x223514,paymentDescription:_0x4580fd,amount:_0x1e02ca,currency:_0x287a23,webhookUrl:_0x4f3d24,returnUrl:_0x1754cc,expiryDate:_0x32cf0b}=_0x444f82,_0x24f721=_0x287a23[_0x1af275(0xc4)](),_0x1603a3=_0x1af275(0x122),_0x5e879f=_0x1af275(0x126)+_0x5d7d6a,_0x24f9f7={'name':_0x223514,'paymentDescription':_0x4580fd,'amount':_0x1e02ca,'currency':_0x24f721,'paymentId':_0x5d7d6a,'webhookUrl':_0x1603a3,'returnUrl':_0x5e879f};_0x32cf0b&&(_0x24f9f7[_0x1af275(0xfc)]=_0x32cf0b);const _0x465445=Date[_0x1af275(0xf9)]();try{console[_0x1af275(0xee)](_0x1af275(0xd1)),console[_0x1af275(0xee)](_0x1af275(0x110),this[_0x1af275(0xff)]),console[_0x1af275(0xee)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x1af275(0x101)](_0x24f9f7,null,0x2)),console[_0x1af275(0xee)]('Order\x20ID\x20Format:',_0x5d7d6a,_0x1af275(0x103)),console['log'](_0x1af275(0x118),_0x5e879f),loggerService_1[_0x1af275(0xf0)][_0x1af275(0xe5)]('noda',_0x1af275(0x10f),_0x1af275(0xce),_0x24f9f7);const _0x1a014f=await fetch(this['apiUrl'],{'method':_0x1af275(0xce),'headers':{'Content-Type':'application/json','Accept':_0x1af275(0x109),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x24f9f7)}),_0x5c8ee0=Date[_0x1af275(0xf9)]()-_0x465445;console[_0x1af275(0xee)](_0x1af275(0xbf)),console[_0x1af275(0xee)]('Status:',_0x1a014f[_0x1af275(0xed)]),console['log']('Status\x20Text:',_0x1a014f[_0x1af275(0xb5)]),console['log'](_0x1af275(0xbd),Object[_0x1af275(0xe7)](_0x1a014f[_0x1af275(0x11c)][_0x1af275(0xd4)]())),console[_0x1af275(0xee)]('Response\x20Time:',_0x5c8ee0+'ms');const _0x5f225e=await _0x1a014f['text']();console[_0x1af275(0xee)]('Raw\x20Response\x20Body:',_0x5f225e);if(!_0x1a014f['ok']){console[_0x1af275(0x120)](_0x1af275(0xf2)),console['error'](_0x1af275(0xf7),_0x1a014f[_0x1af275(0xed)]),console[_0x1af275(0x120)](_0x1af275(0x108),_0x5f225e),loggerService_1[_0x1af275(0xf0)][_0x1af275(0x119)](_0x1af275(0xe8),_0x1af275(0x10f),_0x1a014f[_0x1af275(0xed)],_0x5f225e,_0x5c8ee0),loggerService_1[_0x1af275(0xf0)][_0x1af275(0xd7)](_0x1af275(0xe8),'/payment-links',_0x1af275(0x111)+_0x1a014f[_0x1af275(0xed)]+':\x20'+_0x5f225e);if(_0x1a014f['status']===0x190)throw new Error(_0x1af275(0x10b));else{if(_0x1a014f[_0x1af275(0xed)]===0x1f4)throw new Error(_0x1af275(0xfe));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x1a014f['status']+_0x1af275(0x11f)+_0x5f225e);}let _0x581380;try{_0x581380=JSON[_0x1af275(0xd6)](_0x5f225e);}catch(_0x56a667){console[_0x1af275(0x120)](_0x1af275(0x10a),_0x56a667),loggerService_1['loggerService']['logWhiteDomainError'](_0x1af275(0xe8),_0x1af275(0x10f),'JSON\x20Parse\x20Error:\x20'+_0x56a667);throw new Error(_0x1af275(0x116)+_0x5f225e);}console['log'](_0x1af275(0x12e)),console[_0x1af275(0xee)](_0x1af275(0x10e),JSON[_0x1af275(0x101)](_0x581380,null,0x2)),loggerService_1['loggerService'][_0x1af275(0x119)](_0x1af275(0xe8),_0x1af275(0x10f),_0x1a014f[_0x1af275(0xed)],_0x581380,_0x5c8ee0);if(_0x581380[_0x1af275(0x120)]||_0x581380[_0x1af275(0x105)]){const _0x14015d=_0x581380[_0x1af275(0xca)]||_0x581380['error']||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x1af275(0x120)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x1af275(0x120)](_0x1af275(0xea),_0x14015d),console[_0x1af275(0x120)]('Status\x20Code:',_0x581380['statusCode']),loggerService_1[_0x1af275(0xf0)][_0x1af275(0xd7)](_0x1af275(0xe8),_0x1af275(0x10f),_0x1af275(0x113)+_0x14015d);throw new Error(_0x1af275(0x106)+_0x14015d);}if(!_0x581380['id']||!_0x581380[_0x1af275(0xb6)]?.[_0x1af275(0x12c)]){console['error'](_0x1af275(0xc8)),console[_0x1af275(0x120)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x1af275(0x120)](_0x1af275(0xd9),_0x581380),loggerService_1[_0x1af275(0xf0)][_0x1af275(0xd7)](_0x1af275(0xe8),_0x1af275(0x10f),_0x1af275(0x107));throw new Error(_0x1af275(0x11d));}return console[_0x1af275(0xee)](_0x1af275(0xd8)),console['log'](_0x1af275(0xd0),_0x581380['id']),console[_0x1af275(0xee)]('Short\x20Link:',_0x581380[_0x1af275(0xb6)][_0x1af275(0x12c)]),console[_0x1af275(0xee)](_0x1af275(0xe2),_0x581380[_0x1af275(0xb6)]['qrCodeLink']||_0x1af275(0x121)),console[_0x1af275(0xee)](_0x1af275(0xdd),_0x5d7d6a,_0x1af275(0xfb)),console['log']('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x5e879f),{'gateway_payment_id':_0x581380['id'],'payment_url':_0x581380[_0x1af275(0xb6)][_0x1af275(0x12c)],'qr_code_url':_0x581380[_0x1af275(0xb6)][_0x1af275(0xc1)],'expiry_date':_0x581380[_0x1af275(0xfc)]};}catch(_0x24d398){console[_0x1af275(0x120)](_0x1af275(0x12d)),console[_0x1af275(0x120)](_0x1af275(0x12b),_0x24d398),loggerService_1[_0x1af275(0xf0)]['logWhiteDomainError'](_0x1af275(0xe8),_0x1af275(0x10f),_0x24d398);if(_0x24d398 instanceof Error){console[_0x1af275(0x120)](_0x1af275(0x117),_0x24d398[_0x1af275(0xca)]),console['error'](_0x1af275(0xb9),_0x24d398[_0x1af275(0x10d)]);throw new Error(_0x1af275(0xc0)+_0x24d398[_0x1af275(0xca)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x3e9b7d){const _0x2ad4eb=a43_0x5b332b,_0x38b34a=Date[_0x2ad4eb(0xf9)]();try{loggerService_1[_0x2ad4eb(0xf0)][_0x2ad4eb(0xe5)](_0x2ad4eb(0xe8),_0x2ad4eb(0xcb)+_0x3e9b7d,'GET',{});const _0x188e8e=await fetch(this[_0x2ad4eb(0xff)]+'/'+_0x3e9b7d,{'method':_0x2ad4eb(0xc3),'headers':{'Content-Type':_0x2ad4eb(0x109),'User-Agent':_0x2ad4eb(0xd2)}}),_0x3a849e=Date[_0x2ad4eb(0xf9)]()-_0x38b34a;if(!_0x188e8e['ok']){const _0xc5bc1f=await _0x188e8e[_0x2ad4eb(0x115)]();loggerService_1[_0x2ad4eb(0xf0)][_0x2ad4eb(0x119)](_0x2ad4eb(0xe8),'/payment-links/'+_0x3e9b7d,_0x188e8e[_0x2ad4eb(0xed)],_0xc5bc1f,_0x3a849e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x188e8e[_0x2ad4eb(0xed)]);}const _0x31b0ba=await _0x188e8e[_0x2ad4eb(0xba)]();loggerService_1[_0x2ad4eb(0xf0)][_0x2ad4eb(0x119)](_0x2ad4eb(0xe8),'/payment-links/'+_0x3e9b7d,_0x188e8e['status'],_0x31b0ba,_0x3a849e);if(_0x31b0ba[_0x2ad4eb(0x120)]||_0x31b0ba[_0x2ad4eb(0x105)]){loggerService_1[_0x2ad4eb(0xf0)][_0x2ad4eb(0xd7)](_0x2ad4eb(0xe8),_0x2ad4eb(0xcb)+_0x3e9b7d,'Noda\x20API\x20error:\x20'+(_0x31b0ba[_0x2ad4eb(0xca)]||_0x31b0ba[_0x2ad4eb(0x120)]||_0x2ad4eb(0xb8)));throw new Error(_0x2ad4eb(0x106)+(_0x31b0ba['message']||_0x31b0ba['error']||_0x2ad4eb(0xb8)));}let _0x4918e6=_0x2ad4eb(0x125);if(_0x31b0ba[_0x2ad4eb(0x124)]===![]){if(_0x31b0ba[_0x2ad4eb(0xfc)]){const _0xadb5ea=new Date(_0x31b0ba[_0x2ad4eb(0xfc)]),_0x18ccd7=new Date();_0xadb5ea<_0x18ccd7?_0x4918e6='EXPIRED':_0x4918e6=_0x2ad4eb(0xf8);}else _0x4918e6=_0x2ad4eb(0xf8);}else _0x4918e6=_0x2ad4eb(0x125);return{'status':_0x4918e6,'amount':_0x31b0ba[_0x2ad4eb(0x102)],'currency':_0x31b0ba[_0x2ad4eb(0xcd)],'isActive':_0x31b0ba['isActive']};}catch(_0x5b1e6b){console[_0x2ad4eb(0x120)](_0x2ad4eb(0x127),_0x5b1e6b),loggerService_1[_0x2ad4eb(0xf0)][_0x2ad4eb(0xd7)](_0x2ad4eb(0xe8),'/payment-links/'+_0x3e9b7d,_0x5b1e6b);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x5b1e6b instanceof Error?_0x5b1e6b[_0x2ad4eb(0xca)]:'Unknown\x20error'));}}async[a43_0x5b332b(0xbb)](_0x41b3db){const _0x57cbe3=a43_0x5b332b;console[_0x57cbe3(0xee)](_0x57cbe3(0xc9),_0x41b3db);let _0x49a64d=_0x57cbe3(0x125);switch(_0x41b3db[_0x57cbe3(0x128)]?.[_0x57cbe3(0xf6)]()){case _0x57cbe3(0x11a):case _0x57cbe3(0xe0):case'paid':case _0x57cbe3(0xc7):case _0x57cbe3(0xf1):_0x41b3db[_0x57cbe3(0xdb)]===_0x57cbe3(0xf5)?_0x49a64d=_0x57cbe3(0xe3):_0x49a64d='PENDING';break;case _0x57cbe3(0x100):case'canceled':case'failed':case _0x57cbe3(0x120):case _0x57cbe3(0x12a):_0x49a64d=_0x57cbe3(0xf8);break;case'expired':case'timeout':_0x49a64d=_0x57cbe3(0xbc);break;case _0x57cbe3(0xec):case _0x57cbe3(0xbe):case _0x57cbe3(0x129):case _0x57cbe3(0xe4):case _0x57cbe3(0xc6):default:_0x49a64d=_0x57cbe3(0x125);break;}return{'paymentId':_0x41b3db[_0x57cbe3(0xeb)]||_0x41b3db[_0x57cbe3(0xda)],'status':_0x49a64d,'amount':_0x41b3db[_0x57cbe3(0xe9)],'currency':_0x41b3db['Currency'],'additionalInfo':{'method':_0x41b3db[_0x57cbe3(0x112)],'bankId':_0x41b3db[_0x57cbe3(0xe6)],'settled':_0x41b3db[_0x57cbe3(0xdb)],'settlementDate':_0x41b3db[_0x57cbe3(0xef)],'remitterName':_0x41b3db[_0x57cbe3(0xd5)]?.[_0x57cbe3(0x11e)],'remitterIban':_0x41b3db[_0x57cbe3(0xd5)]?.['Iban'],'bankTransactionId':_0x41b3db[_0x57cbe3(0xe1)]}};}[a43_0x5b332b(0x11b)](_0x1b46ae,_0x185f03){const _0x4a5d87=a43_0x5b332b;return console[_0x4a5d87(0xee)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x185f03,'paymentId':_0x1b46ae[_0x4a5d87(0xda)],'merchantPaymentId':_0x1b46ae[_0x4a5d87(0xeb)]}),!![];}}exports[a43_0x5b332b(0x123)]=NodaService;