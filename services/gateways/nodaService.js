'use strict';const a46_0x257f01=a46_0x4532;(function(_0x1d5135,_0x1af679){const _0x3ec157=a46_0x4532,_0x4379f8=_0x1d5135();while(!![]){try{const _0x50dae9=parseInt(_0x3ec157(0x1f3))/0x1*(parseInt(_0x3ec157(0x22a))/0x2)+parseInt(_0x3ec157(0x1ec))/0x3*(parseInt(_0x3ec157(0x246))/0x4)+-parseInt(_0x3ec157(0x224))/0x5+-parseInt(_0x3ec157(0x241))/0x6+-parseInt(_0x3ec157(0x23b))/0x7+parseInt(_0x3ec157(0x20b))/0x8*(parseInt(_0x3ec157(0x231))/0x9)+parseInt(_0x3ec157(0x226))/0xa;if(_0x50dae9===_0x1af679)break;else _0x4379f8['push'](_0x4379f8['shift']());}catch(_0x372587){_0x4379f8['push'](_0x4379f8['shift']());}}}(a46_0xa4b3,0x979ca));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a46_0x257f01(0x236));function a46_0x4532(_0x2186fd,_0x413d53){const _0xa4b3af=a46_0xa4b3();return a46_0x4532=function(_0x453213,_0x1c9644){_0x453213=_0x453213-0x1da;let _0x35b12a=_0xa4b3af[_0x453213];return _0x35b12a;},a46_0x4532(_0x2186fd,_0x413d53);}function a46_0xa4b3(){const _0x146230=['cancelled','failed','Short\x20Link:','shortLinkUrls','Headers:','79965QUabYT','/payment-links','expiryDate','/payment-links/','logWhiteDomainResponse','../loggerService','BankTransactionId','GET','successful','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','1018836SCiCbm','paid','SettlementDate','noda','===\x20NODA\x20SUCCESS\x20===','Failed\x20to\x20parse\x20JSON\x20response:','3523908oZcUfP','fromEntries','Currency',',\x20body:\x20','Error\x20details:','380GMdBHE','===\x20NODA\x20SERVICE\x20ERROR\x20===','HTTP\x20Status:','text','POST','HTTP\x20','toLowerCase','processWebhook','amount','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','statusCode','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','https://tesoft.uk/gateway/noda/webhook/','EXPIRED','logWhiteDomainError','Response\x20Time:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','createPaymentLink','URL:','verifyWebhookSignature','Error\x20stack:','Remitter','message','success','Raw\x20Response\x20Body:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','34761mlyrRw','verifyPayment','https://tesoft.uk/gateway/noda/','Iban','done','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','1kLyLZY','===\x20NODA\x20API\x20ERROR\x20===','Unknown\x20error','toUpperCase','PaymentId','FAILED','PENDING','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Noda\x20API\x20error:\x20','headers','(8digits-8digits\x20format\x20for\x20Noda)','Parsed\x20Result:','Response\x20data:','apiUrl','JSON\x20Parse\x20Error:\x20','log','Amount','Noda\x20webhook\x20signature\x20verification:','application/json','timeout','shortLink','TesSoft\x20Payment\x20System/1.0','status','NodaService','632RBRfQc','rejected','Payment\x20Link\x20ID:','Response\x20Body:','Processing\x20Noda\x20webhook:','BankId','HTTP\x20error!\x20status:\x20','qrCodeLink','stringify','isActive','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Order\x20ID\x20Format:','QR\x20Code\x20Link:','Request\x20Body\x20(Direct\x20JSON):','logWhiteDomainRequest','Status','Error\x20Message:','MerchantPaymentId','Name','error','canceled','now','Order\x20ID\x20Used:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','5608845FYmYvx','loggerService','4664180TAWNFJ','in_progress','Status\x20Text:','https://tesoft.uk/gateway/pending.php?id=','413078HkUTVu','Settled'];a46_0xa4b3=function(){return _0x146230;};return a46_0xa4b3();}class NodaService{constructor(){const _0x1e1ed8=a46_0x257f01;this[_0x1e1ed8(0x200)]=_0x1e1ed8(0x1ee),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a46_0x257f01(0x1e3)](_0x5c7ca7){const _0x6d0286=a46_0x257f01,{orderId:_0x43cb31,name:_0x6df715,paymentDescription:_0xf2f4ea,amount:_0x47ebed,currency:_0x207ce0,webhookUrl:_0x10e670,returnUrl:_0x372c48,expiryDate:_0x222c3f}=_0x5c7ca7,_0x22352f=_0x207ce0[_0x6d0286(0x1f6)](),_0x44f80c=_0x6d0286(0x1de),_0x3ba113=_0x6d0286(0x229)+_0x43cb31,_0x4869f8={'name':_0x6df715,'paymentDescription':_0xf2f4ea,'amount':_0x47ebed,'currency':_0x22352f,'paymentId':_0x43cb31,'webhookUrl':_0x44f80c,'returnUrl':_0x3ba113};_0x222c3f&&(_0x4869f8[_0x6d0286(0x233)]=_0x222c3f);const _0x249112=Date[_0x6d0286(0x221)]();try{console[_0x6d0286(0x202)](_0x6d0286(0x1db)),console['log'](_0x6d0286(0x1e4),this[_0x6d0286(0x200)]),console[_0x6d0286(0x202)](_0x6d0286(0x219),JSON[_0x6d0286(0x213)](_0x4869f8,null,0x2)),console['log'](_0x6d0286(0x217),_0x43cb31,_0x6d0286(0x1fd)),console[_0x6d0286(0x202)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x3ba113),loggerService_1[_0x6d0286(0x225)][_0x6d0286(0x21a)]('noda',_0x6d0286(0x232),_0x6d0286(0x24a),_0x4869f8);const _0x5d8f4f=await fetch(this[_0x6d0286(0x200)],{'method':'POST','headers':{'Content-Type':_0x6d0286(0x205),'Accept':'application/json','User-Agent':_0x6d0286(0x208)},'body':JSON['stringify'](_0x4869f8)}),_0x3bae0c=Date[_0x6d0286(0x221)]()-_0x249112;console[_0x6d0286(0x202)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x6d0286(0x202)]('Status:',_0x5d8f4f['status']),console['log'](_0x6d0286(0x228),_0x5d8f4f['statusText']),console['log'](_0x6d0286(0x230),Object[_0x6d0286(0x242)](_0x5d8f4f[_0x6d0286(0x1fc)]['entries']())),console[_0x6d0286(0x202)](_0x6d0286(0x1e1),_0x3bae0c+'ms');const _0x47b0ee=await _0x5d8f4f[_0x6d0286(0x249)]();console[_0x6d0286(0x202)](_0x6d0286(0x1ea),_0x47b0ee);if(!_0x5d8f4f['ok']){console['error'](_0x6d0286(0x1f4)),console[_0x6d0286(0x21f)](_0x6d0286(0x248),_0x5d8f4f[_0x6d0286(0x209)]),console[_0x6d0286(0x21f)](_0x6d0286(0x20e),_0x47b0ee),loggerService_1['loggerService'][_0x6d0286(0x235)](_0x6d0286(0x23e),_0x6d0286(0x232),_0x5d8f4f[_0x6d0286(0x209)],_0x47b0ee,_0x3bae0c),loggerService_1[_0x6d0286(0x225)][_0x6d0286(0x1e0)](_0x6d0286(0x23e),_0x6d0286(0x232),_0x6d0286(0x24b)+_0x5d8f4f['status']+':\x20'+_0x47b0ee);if(_0x5d8f4f[_0x6d0286(0x209)]===0x190)throw new Error(_0x6d0286(0x1f1));else{if(_0x5d8f4f[_0x6d0286(0x209)]===0x1f4)throw new Error(_0x6d0286(0x23a));}throw new Error(_0x6d0286(0x211)+_0x5d8f4f[_0x6d0286(0x209)]+_0x6d0286(0x244)+_0x47b0ee);}let _0x1e4d35;try{_0x1e4d35=JSON['parse'](_0x47b0ee);}catch(_0x1b547d){console[_0x6d0286(0x21f)](_0x6d0286(0x240),_0x1b547d),loggerService_1['loggerService'][_0x6d0286(0x1e0)](_0x6d0286(0x23e),_0x6d0286(0x232),_0x6d0286(0x201)+_0x1b547d);throw new Error(_0x6d0286(0x1e2)+_0x47b0ee);}console[_0x6d0286(0x202)](_0x6d0286(0x1eb)),console[_0x6d0286(0x202)](_0x6d0286(0x1fe),JSON[_0x6d0286(0x213)](_0x1e4d35,null,0x2)),loggerService_1['loggerService'][_0x6d0286(0x235)]('noda',_0x6d0286(0x232),_0x5d8f4f['status'],_0x1e4d35,_0x3bae0c);if(_0x1e4d35[_0x6d0286(0x21f)]||_0x1e4d35[_0x6d0286(0x1dc)]){const _0x548d08=_0x1e4d35[_0x6d0286(0x1e8)]||_0x1e4d35[_0x6d0286(0x21f)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x6d0286(0x21f)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x6d0286(0x21f)](_0x6d0286(0x21c),_0x548d08),console['error']('Status\x20Code:',_0x1e4d35[_0x6d0286(0x1dc)]),loggerService_1[_0x6d0286(0x225)][_0x6d0286(0x1e0)]('noda','/payment-links','Business\x20Error:\x20'+_0x548d08);throw new Error(_0x6d0286(0x1fb)+_0x548d08);}if(!_0x1e4d35['id']||!_0x1e4d35[_0x6d0286(0x22f)]?.[_0x6d0286(0x207)]){console[_0x6d0286(0x21f)](_0x6d0286(0x1f2)),console[_0x6d0286(0x21f)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x6d0286(0x21f)](_0x6d0286(0x1ff),_0x1e4d35),loggerService_1['loggerService'][_0x6d0286(0x1e0)](_0x6d0286(0x23e),_0x6d0286(0x232),_0x6d0286(0x1fa));throw new Error(_0x6d0286(0x215));}return console[_0x6d0286(0x202)](_0x6d0286(0x23f)),console[_0x6d0286(0x202)](_0x6d0286(0x20d),_0x1e4d35['id']),console[_0x6d0286(0x202)](_0x6d0286(0x22e),_0x1e4d35[_0x6d0286(0x22f)][_0x6d0286(0x207)]),console[_0x6d0286(0x202)](_0x6d0286(0x218),_0x1e4d35['shortLinkUrls'][_0x6d0286(0x212)]||'Not\x20provided'),console[_0x6d0286(0x202)](_0x6d0286(0x222),_0x43cb31,'(8digits-8digits\x20format)'),console[_0x6d0286(0x202)](_0x6d0286(0x223),_0x3ba113),{'gateway_payment_id':_0x1e4d35['id'],'payment_url':_0x1e4d35['shortLinkUrls'][_0x6d0286(0x207)],'qr_code_url':_0x1e4d35[_0x6d0286(0x22f)][_0x6d0286(0x212)],'expiry_date':_0x1e4d35[_0x6d0286(0x233)]};}catch(_0x1776ad){console[_0x6d0286(0x21f)](_0x6d0286(0x247)),console['error'](_0x6d0286(0x245),_0x1776ad),loggerService_1[_0x6d0286(0x225)][_0x6d0286(0x1e0)]('noda','/payment-links',_0x1776ad);if(_0x1776ad instanceof Error){console['error']('Error\x20message:',_0x1776ad['message']),console['error'](_0x6d0286(0x1e6),_0x1776ad['stack']);throw new Error(_0x6d0286(0x1dd)+_0x1776ad['message']);}throw new Error(_0x6d0286(0x216));}}async[a46_0x257f01(0x1ed)](_0x58bfb7){const _0x55cafb=a46_0x257f01,_0x511000=Date[_0x55cafb(0x221)]();try{loggerService_1[_0x55cafb(0x225)][_0x55cafb(0x21a)](_0x55cafb(0x23e),_0x55cafb(0x234)+_0x58bfb7,_0x55cafb(0x238),{});const _0xd48652=await fetch(this[_0x55cafb(0x200)]+'/'+_0x58bfb7,{'method':_0x55cafb(0x238),'headers':{'Content-Type':'application/json','User-Agent':_0x55cafb(0x208)}}),_0x14f151=Date['now']()-_0x511000;if(!_0xd48652['ok']){const _0x2550de=await _0xd48652[_0x55cafb(0x249)]();loggerService_1[_0x55cafb(0x225)][_0x55cafb(0x235)](_0x55cafb(0x23e),_0x55cafb(0x234)+_0x58bfb7,_0xd48652['status'],_0x2550de,_0x14f151);throw new Error(_0x55cafb(0x211)+_0xd48652[_0x55cafb(0x209)]);}const _0x58462a=await _0xd48652['json']();loggerService_1[_0x55cafb(0x225)][_0x55cafb(0x235)](_0x55cafb(0x23e),'/payment-links/'+_0x58bfb7,_0xd48652['status'],_0x58462a,_0x14f151);if(_0x58462a[_0x55cafb(0x21f)]||_0x58462a[_0x55cafb(0x1dc)]){loggerService_1['loggerService'][_0x55cafb(0x1e0)](_0x55cafb(0x23e),'/payment-links/'+_0x58bfb7,_0x55cafb(0x1fb)+(_0x58462a[_0x55cafb(0x1e8)]||_0x58462a[_0x55cafb(0x21f)]||_0x55cafb(0x1f5)));throw new Error('Noda\x20API\x20error:\x20'+(_0x58462a[_0x55cafb(0x1e8)]||_0x58462a['error']||_0x55cafb(0x1f5)));}let _0x5bbbba='PENDING';if(_0x58462a[_0x55cafb(0x214)]===![]){if(_0x58462a[_0x55cafb(0x233)]){const _0x400a2f=new Date(_0x58462a[_0x55cafb(0x233)]),_0x50a439=new Date();_0x400a2f<_0x50a439?_0x5bbbba=_0x55cafb(0x1df):_0x5bbbba=_0x55cafb(0x1f8);}else _0x5bbbba=_0x55cafb(0x1f8);}else _0x5bbbba='PENDING';return{'status':_0x5bbbba,'amount':_0x58462a[_0x55cafb(0x1da)],'currency':_0x58462a['currency'],'isActive':_0x58462a['isActive']};}catch(_0x4465c9){console[_0x55cafb(0x21f)]('Noda\x20payment\x20verification\x20error:',_0x4465c9),loggerService_1['loggerService'][_0x55cafb(0x1e0)](_0x55cafb(0x23e),_0x55cafb(0x234)+_0x58bfb7,_0x4465c9);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x4465c9 instanceof Error?_0x4465c9['message']:'Unknown\x20error'));}}async[a46_0x257f01(0x24d)](_0x3f8ad){const _0x2a0e44=a46_0x257f01;console[_0x2a0e44(0x202)](_0x2a0e44(0x20f),_0x3f8ad);let _0x1545ea=_0x2a0e44(0x1f9);switch(_0x3f8ad[_0x2a0e44(0x21b)]?.[_0x2a0e44(0x24c)]()){case _0x2a0e44(0x1f0):case'completed':case _0x2a0e44(0x23c):case _0x2a0e44(0x1e9):case _0x2a0e44(0x239):_0x3f8ad[_0x2a0e44(0x22b)]==='Yes'?_0x1545ea='PAID':_0x1545ea=_0x2a0e44(0x1f9);break;case _0x2a0e44(0x22c):case _0x2a0e44(0x220):case _0x2a0e44(0x22d):case'error':case _0x2a0e44(0x20c):_0x1545ea=_0x2a0e44(0x1f8);break;case'expired':case _0x2a0e44(0x206):_0x1545ea=_0x2a0e44(0x1df);break;case'pending':case'created':case'active':case'processing':case _0x2a0e44(0x227):default:_0x1545ea=_0x2a0e44(0x1f9);break;}return{'paymentId':_0x3f8ad['MerchantPaymentId']||_0x3f8ad[_0x2a0e44(0x1f7)],'status':_0x1545ea,'amount':_0x3f8ad[_0x2a0e44(0x203)],'currency':_0x3f8ad[_0x2a0e44(0x243)],'additionalInfo':{'method':_0x3f8ad['Method'],'bankId':_0x3f8ad[_0x2a0e44(0x210)],'settled':_0x3f8ad[_0x2a0e44(0x22b)],'settlementDate':_0x3f8ad[_0x2a0e44(0x23d)],'remitterName':_0x3f8ad[_0x2a0e44(0x1e7)]?.[_0x2a0e44(0x21e)],'remitterIban':_0x3f8ad[_0x2a0e44(0x1e7)]?.[_0x2a0e44(0x1ef)],'bankTransactionId':_0x3f8ad[_0x2a0e44(0x237)]}};}[a46_0x257f01(0x1e5)](_0x504027,_0x3908a4){const _0x35d7dc=a46_0x257f01;return console[_0x35d7dc(0x202)](_0x35d7dc(0x204),{'receivedSignature':_0x3908a4,'paymentId':_0x504027['PaymentId'],'merchantPaymentId':_0x504027[_0x35d7dc(0x21d)]}),!![];}}exports[a46_0x257f01(0x20a)]=NodaService;