'use strict';function a43_0x2f4b(_0x24c663,_0x4ec4b2){const _0x60a675=a43_0x60a6();return a43_0x2f4b=function(_0x2f4b49,_0x24e12f){_0x2f4b49=_0x2f4b49-0x70;let _0x37a05b=_0x60a675[_0x2f4b49];return _0x37a05b;},a43_0x2f4b(_0x24c663,_0x4ec4b2);}const a43_0x158e08=a43_0x2f4b;(function(_0x256c40,_0x49ce12){const _0x379605=a43_0x2f4b,_0x1688b1=_0x256c40();while(!![]){try{const _0x4d202c=parseInt(_0x379605(0xbf))/0x1+-parseInt(_0x379605(0xcf))/0x2*(parseInt(_0x379605(0x9e))/0x3)+parseInt(_0x379605(0xa1))/0x4*(parseInt(_0x379605(0xaf))/0x5)+parseInt(_0x379605(0x8a))/0x6+-parseInt(_0x379605(0x8c))/0x7*(parseInt(_0x379605(0xd1))/0x8)+parseInt(_0x379605(0x78))/0x9+-parseInt(_0x379605(0xb0))/0xa;if(_0x4d202c===_0x49ce12)break;else _0x1688b1['push'](_0x1688b1['shift']());}catch(_0x5b632c){_0x1688b1['push'](_0x1688b1['shift']());}}}(a43_0x60a6,0x24925));function a43_0x60a6(){const _0xd72cb4=['GET','created','stringify','../loggerService','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PENDING','TesSoft\x20Payment\x20System/1.0','shortLinkUrls','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Iban','toLowerCase','===\x20NODA\x20SERVICE\x20ERROR\x20===','28097tNYkqr','paid','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Method','/payment-links/','NodaService','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','https://tesoft.uk/gateway/noda/','application/json','===\x20NODA\x20API\x20ERROR\x20===','now','text','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','in_progress','BankId','Error\x20stack:','2uKszUF','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','200MekEwT','URL:','loggerService','statusText','Short\x20Link:','rejected','failed','statusCode','MerchantPaymentId','Failed\x20to\x20parse\x20JSON\x20response:','processing','POST','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','amount','(8digits-8digits\x20format\x20for\x20Noda)','Missing\x20id\x20or\x20shortLink\x20in\x20response','logWhiteDomainResponse','Yes','Unknown\x20error','noda','cancelled','/payment-links','createPaymentLink','EXPIRED','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','expiryDate','892251saeJnH','qrCodeLink','stack','Noda\x20API\x20error:\x20','SettlementDate','json','Parsed\x20Result:','timeout','canceled','fromEntries','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','verifyWebhookSignature','Error\x20message:','currency','pending','status','successful','Error\x20Message:','886758BGeeoY','isActive','41741QPgQOf','Name','Raw\x20Response\x20Body:','PaymentId','apiUrl','logWhiteDomainError','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Response\x20data:','Currency','processWebhook','parse','log','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','FAILED','shortLink','Not\x20provided','logWhiteDomainRequest','error','523917UiSdid','Remitter','Noda\x20webhook\x20signature\x20verification:','1000nfGuwp','Noda\x20payment\x20verification\x20error:',',\x20body:\x20','Processing\x20Noda\x20webhook:','https://tesoft.uk/gateway/noda/webhook/','Response\x20Body:','Response\x20Time:','active','(8digits-8digits\x20format)','BankTransactionId','message','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Payment\x20Link\x20ID:','4535DSaNTm','282680MdkWBd','===\x20PARSED\x20NODA\x20RESPONSE\x20===','done'];a43_0x60a6=function(){return _0xd72cb4;};return a43_0x60a6();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a43_0x158e08(0xc4)]=void 0x0;const loggerService_1=require(a43_0x158e08(0xb6));class NodaService{constructor(){const _0x590327=a43_0x158e08;this['apiUrl']=_0x590327(0xc6),console[_0x590327(0x97)](_0x590327(0xd0));}async[a43_0x158e08(0x74)](_0x178f2a){const _0x4dda4d=a43_0x158e08,{orderId:_0x1c86d9,name:_0xda4bdb,paymentDescription:_0xfc58c7,amount:_0x3cf239,currency:_0x3a8c63,webhookUrl:_0x5eeec0,returnUrl:_0x3445aa,expiryDate:_0x3ea7a5}=_0x178f2a,_0x15c6d9=_0x3a8c63['toUpperCase'](),_0x33224e=_0x4dda4d(0xa5),_0x12987b='https://tesoft.uk/gateway/pending.php?id='+_0x1c86d9,_0x334083={'name':_0xda4bdb,'paymentDescription':_0xfc58c7,'amount':_0x3cf239,'currency':_0x15c6d9,'paymentId':_0x1c86d9,'webhookUrl':_0x33224e,'returnUrl':_0x12987b};_0x3ea7a5&&(_0x334083[_0x4dda4d(0x77)]=_0x3ea7a5);const _0x534079=Date[_0x4dda4d(0xc9)]();try{console[_0x4dda4d(0x97)](_0x4dda4d(0xdd)),console[_0x4dda4d(0x97)](_0x4dda4d(0xd2),this[_0x4dda4d(0x90)]),console[_0x4dda4d(0x97)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x4dda4d(0xb5)](_0x334083,null,0x2)),console[_0x4dda4d(0x97)]('Order\x20ID\x20Format:',_0x1c86d9,_0x4dda4d(0xdf)),console[_0x4dda4d(0x97)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x12987b),loggerService_1[_0x4dda4d(0xd3)][_0x4dda4d(0x9c)](_0x4dda4d(0x71),_0x4dda4d(0x73),_0x4dda4d(0xdc),_0x334083);const _0xbc415c=await fetch(this['apiUrl'],{'method':_0x4dda4d(0xdc),'headers':{'Content-Type':_0x4dda4d(0xc7),'Accept':_0x4dda4d(0xc7),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x4dda4d(0xb5)](_0x334083)}),_0x4f452c=Date['now']()-_0x534079;console[_0x4dda4d(0x97)](_0x4dda4d(0x76)),console[_0x4dda4d(0x97)]('Status:',_0xbc415c[_0x4dda4d(0x87)]),console[_0x4dda4d(0x97)]('Status\x20Text:',_0xbc415c[_0x4dda4d(0xd4)]),console[_0x4dda4d(0x97)]('Headers:',Object[_0x4dda4d(0x81)](_0xbc415c['headers']['entries']())),console[_0x4dda4d(0x97)](_0x4dda4d(0xa7),_0x4f452c+'ms');const _0x445038=await _0xbc415c[_0x4dda4d(0xca)]();console['log'](_0x4dda4d(0x8e),_0x445038);if(!_0xbc415c['ok']){console[_0x4dda4d(0x9d)](_0x4dda4d(0xc8)),console[_0x4dda4d(0x9d)]('HTTP\x20Status:',_0xbc415c[_0x4dda4d(0x87)]),console[_0x4dda4d(0x9d)](_0x4dda4d(0xa6),_0x445038),loggerService_1[_0x4dda4d(0xd3)]['logWhiteDomainResponse'](_0x4dda4d(0x71),_0x4dda4d(0x73),_0xbc415c[_0x4dda4d(0x87)],_0x445038,_0x4f452c),loggerService_1[_0x4dda4d(0xd3)][_0x4dda4d(0x91)]('noda',_0x4dda4d(0x73),'HTTP\x20'+_0xbc415c[_0x4dda4d(0x87)]+':\x20'+_0x445038);if(_0xbc415c[_0x4dda4d(0x87)]===0x190)throw new Error(_0x4dda4d(0xc1));else{if(_0xbc415c[_0x4dda4d(0x87)]===0x1f4)throw new Error(_0x4dda4d(0xcb));}throw new Error('HTTP\x20error!\x20status:\x20'+_0xbc415c[_0x4dda4d(0x87)]+_0x4dda4d(0xa3)+_0x445038);}let _0x1a42dd;try{_0x1a42dd=JSON[_0x4dda4d(0x96)](_0x445038);}catch(_0x58cb21){console[_0x4dda4d(0x9d)](_0x4dda4d(0xda),_0x58cb21),loggerService_1[_0x4dda4d(0xd3)][_0x4dda4d(0x91)](_0x4dda4d(0x71),_0x4dda4d(0x73),'JSON\x20Parse\x20Error:\x20'+_0x58cb21);throw new Error(_0x4dda4d(0xbb)+_0x445038);}console[_0x4dda4d(0x97)](_0x4dda4d(0xb1)),console[_0x4dda4d(0x97)](_0x4dda4d(0x7e),JSON['stringify'](_0x1a42dd,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4dda4d(0x71),'/payment-links',_0xbc415c[_0x4dda4d(0x87)],_0x1a42dd,_0x4f452c);if(_0x1a42dd['error']||_0x1a42dd[_0x4dda4d(0xd8)]){const _0x46a8c2=_0x1a42dd[_0x4dda4d(0xab)]||_0x1a42dd['error']||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x4dda4d(0x9d)](_0x4dda4d(0x82)),console[_0x4dda4d(0x9d)](_0x4dda4d(0x89),_0x46a8c2),console[_0x4dda4d(0x9d)]('Status\x20Code:',_0x1a42dd[_0x4dda4d(0xd8)]),loggerService_1['loggerService'][_0x4dda4d(0x91)](_0x4dda4d(0x71),'/payment-links','Business\x20Error:\x20'+_0x46a8c2);throw new Error(_0x4dda4d(0x7b)+_0x46a8c2);}if(!_0x1a42dd['id']||!_0x1a42dd['shortLinkUrls']?.['shortLink']){console[_0x4dda4d(0x9d)](_0x4dda4d(0xb7)),console[_0x4dda4d(0x9d)](_0x4dda4d(0xe0)),console['error'](_0x4dda4d(0x93),_0x1a42dd),loggerService_1[_0x4dda4d(0xd3)][_0x4dda4d(0x91)](_0x4dda4d(0x71),_0x4dda4d(0x73),_0x4dda4d(0xad));throw new Error(_0x4dda4d(0x98));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console[_0x4dda4d(0x97)](_0x4dda4d(0xae),_0x1a42dd['id']),console[_0x4dda4d(0x97)](_0x4dda4d(0xd5),_0x1a42dd[_0x4dda4d(0xba)][_0x4dda4d(0x9a)]),console[_0x4dda4d(0x97)]('QR\x20Code\x20Link:',_0x1a42dd[_0x4dda4d(0xba)][_0x4dda4d(0x79)]||_0x4dda4d(0x9b)),console[_0x4dda4d(0x97)]('Order\x20ID\x20Used:',_0x1c86d9,_0x4dda4d(0xa9)),console[_0x4dda4d(0x97)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x12987b),{'gateway_payment_id':_0x1a42dd['id'],'payment_url':_0x1a42dd[_0x4dda4d(0xba)][_0x4dda4d(0x9a)],'qr_code_url':_0x1a42dd[_0x4dda4d(0xba)]['qrCodeLink'],'expiry_date':_0x1a42dd[_0x4dda4d(0x77)]};}catch(_0x360dc2){console[_0x4dda4d(0x9d)](_0x4dda4d(0xbe)),console['error']('Error\x20details:',_0x360dc2),loggerService_1[_0x4dda4d(0xd3)][_0x4dda4d(0x91)](_0x4dda4d(0x71),_0x4dda4d(0x73),_0x360dc2);if(_0x360dc2 instanceof Error){console[_0x4dda4d(0x9d)](_0x4dda4d(0x84),_0x360dc2[_0x4dda4d(0xab)]),console[_0x4dda4d(0x9d)](_0x4dda4d(0xce),_0x360dc2[_0x4dda4d(0x7a)]);throw new Error(_0x4dda4d(0xac)+_0x360dc2[_0x4dda4d(0xab)]);}throw new Error(_0x4dda4d(0xc5));}}async['verifyPayment'](_0x9e9317){const _0x545b80=a43_0x158e08,_0x2c4a83=Date[_0x545b80(0xc9)]();try{loggerService_1[_0x545b80(0xd3)][_0x545b80(0x9c)]('noda',_0x545b80(0xc3)+_0x9e9317,_0x545b80(0xb3),{});const _0x28de1b=await fetch(this[_0x545b80(0x90)]+'/'+_0x9e9317,{'method':_0x545b80(0xb3),'headers':{'Content-Type':_0x545b80(0xc7),'User-Agent':_0x545b80(0xb9)}}),_0x50801a=Date[_0x545b80(0xc9)]()-_0x2c4a83;if(!_0x28de1b['ok']){const _0x4ef87c=await _0x28de1b['text']();loggerService_1[_0x545b80(0xd3)][_0x545b80(0xe1)]('noda',_0x545b80(0xc3)+_0x9e9317,_0x28de1b[_0x545b80(0x87)],_0x4ef87c,_0x50801a);throw new Error('HTTP\x20error!\x20status:\x20'+_0x28de1b['status']);}const _0x39cbed=await _0x28de1b[_0x545b80(0x7d)]();loggerService_1[_0x545b80(0xd3)][_0x545b80(0xe1)]('noda',_0x545b80(0xc3)+_0x9e9317,_0x28de1b[_0x545b80(0x87)],_0x39cbed,_0x50801a);if(_0x39cbed[_0x545b80(0x9d)]||_0x39cbed['statusCode']){loggerService_1[_0x545b80(0xd3)][_0x545b80(0x91)](_0x545b80(0x71),_0x545b80(0xc3)+_0x9e9317,_0x545b80(0x7b)+(_0x39cbed[_0x545b80(0xab)]||_0x39cbed[_0x545b80(0x9d)]||_0x545b80(0x70)));throw new Error('Noda\x20API\x20error:\x20'+(_0x39cbed[_0x545b80(0xab)]||_0x39cbed[_0x545b80(0x9d)]||'Unknown\x20error'));}let _0x25b7b5='PENDING';if(_0x39cbed[_0x545b80(0x8b)]===![]){if(_0x39cbed[_0x545b80(0x77)]){const _0x12a2ce=new Date(_0x39cbed[_0x545b80(0x77)]),_0x40fcbf=new Date();_0x12a2ce<_0x40fcbf?_0x25b7b5=_0x545b80(0x75):_0x25b7b5=_0x545b80(0x99);}else _0x25b7b5='FAILED';}else _0x25b7b5='PENDING';return{'status':_0x25b7b5,'amount':_0x39cbed[_0x545b80(0xde)],'currency':_0x39cbed[_0x545b80(0x85)],'isActive':_0x39cbed[_0x545b80(0x8b)]};}catch(_0x24aa10){console['error'](_0x545b80(0xa2),_0x24aa10),loggerService_1['loggerService'][_0x545b80(0x91)](_0x545b80(0x71),'/payment-links/'+_0x9e9317,_0x24aa10);throw new Error(_0x545b80(0x92)+(_0x24aa10 instanceof Error?_0x24aa10[_0x545b80(0xab)]:_0x545b80(0x70)));}}async[a43_0x158e08(0x95)](_0x3fa7c7){const _0x36cdb1=a43_0x158e08;console[_0x36cdb1(0x97)](_0x36cdb1(0xa4),_0x3fa7c7);let _0x36c1b9=_0x36cdb1(0xb8);switch(_0x3fa7c7['Status']?.[_0x36cdb1(0xbd)]()){case _0x36cdb1(0xb2):case'completed':case _0x36cdb1(0xc0):case'success':case _0x36cdb1(0x88):_0x3fa7c7['Settled']===_0x36cdb1(0xe2)?_0x36c1b9='PAID':_0x36c1b9=_0x36cdb1(0xb8);break;case _0x36cdb1(0x72):case _0x36cdb1(0x80):case _0x36cdb1(0xd7):case _0x36cdb1(0x9d):case _0x36cdb1(0xd6):_0x36c1b9=_0x36cdb1(0x99);break;case'expired':case _0x36cdb1(0x7f):_0x36c1b9=_0x36cdb1(0x75);break;case _0x36cdb1(0x86):case _0x36cdb1(0xb4):case _0x36cdb1(0xa8):case _0x36cdb1(0xdb):case _0x36cdb1(0xcc):default:_0x36c1b9=_0x36cdb1(0xb8);break;}return{'paymentId':_0x3fa7c7[_0x36cdb1(0xd9)]||_0x3fa7c7['PaymentId'],'status':_0x36c1b9,'amount':_0x3fa7c7['Amount'],'currency':_0x3fa7c7[_0x36cdb1(0x94)],'additionalInfo':{'method':_0x3fa7c7[_0x36cdb1(0xc2)],'bankId':_0x3fa7c7[_0x36cdb1(0xcd)],'settled':_0x3fa7c7['Settled'],'settlementDate':_0x3fa7c7[_0x36cdb1(0x7c)],'remitterName':_0x3fa7c7[_0x36cdb1(0x9f)]?.[_0x36cdb1(0x8d)],'remitterIban':_0x3fa7c7[_0x36cdb1(0x9f)]?.[_0x36cdb1(0xbc)],'bankTransactionId':_0x3fa7c7[_0x36cdb1(0xaa)]}};}[a43_0x158e08(0x83)](_0x55d811,_0x5bbb07){const _0x58fdd9=a43_0x158e08;return console[_0x58fdd9(0x97)](_0x58fdd9(0xa0),{'receivedSignature':_0x5bbb07,'paymentId':_0x55d811[_0x58fdd9(0x8f)],'merchantPaymentId':_0x55d811[_0x58fdd9(0xd9)]}),!![];}}exports[a43_0x158e08(0xc4)]=NodaService;