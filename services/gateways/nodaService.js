'use strict';function a40_0x481b(_0x56a9a2,_0x3ca2b7){const _0xd49934=a40_0xd499();return a40_0x481b=function(_0x481b97,_0x16fc76){_0x481b97=_0x481b97-0xc8;let _0x31df42=_0xd49934[_0x481b97];return _0x31df42;},a40_0x481b(_0x56a9a2,_0x3ca2b7);}const a40_0x242b03=a40_0x481b;function a40_0xd499(){const _0x40a063=['cancelled','expired','now','Response\x20Body:','BankTransactionId','application/json','Name','Iban','qrCodeLink','HTTP\x20','defineProperty','stack','rejected','error','Status\x20Code:','created','currency','11novuXy','GET','status','/payment-links','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Order\x20ID\x20Used:','active','EXPIRED','HTTP\x20error!\x20status:\x20','17426430LHKgRK','Not\x20provided','5TxBSva','Error\x20stack:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','logWhiteDomainResponse','Error\x20message:','2OLcRaG','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','7915884owOWzD','Method','successful','Unknown\x20error','createPaymentLink','Short\x20Link:','isActive','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','PaymentId','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Failed\x20to\x20parse\x20JSON\x20response:','https://tesoft.uk/gateway/noda/webhook/','JSON\x20Parse\x20Error:\x20','processing','loggerService','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','TesSoft\x20Payment\x20System/1.0','13617835njRoDl','Settled','noda','PENDING','Payment\x20Link\x20ID:','amount','BankId','2431208bIaufU','NodaService','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','expiryDate','Status\x20Text:','===\x20NODA\x20API\x20ERROR\x20===','parse','FAILED','logWhiteDomainRequest','Error\x20details:','completed','shortLink','shortLinkUrls','MerchantPaymentId','verifyPayment','Status:','45BtrfFo','https://tesoft.uk/gateway/noda/','(8digits-8digits\x20format\x20for\x20Noda)','(8digits-8digits\x20format)','failed','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','toLowerCase','===\x20NODA\x20SERVICE\x20ERROR\x20===','Raw\x20Response\x20Body:','Headers:','140996FNgzSP','634084BKgnNK','statusText','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','entries','Currency',',\x20body:\x20','PAID','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Response\x20data:','60uCtasR','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','stringify','Unknown\x20error\x20from\x20Noda\x20API','canceled','pending','https://tesoft.uk/gateway/pending.php?id=','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','done','Request\x20Body\x20(Direct\x20JSON):','message','Noda\x20API\x20error:\x20','POST','log','Yes','timeout','/payment-links/','Error\x20Message:','statusCode','866748AVPvyu','Response\x20Time:','text','logWhiteDomainError','Remitter','apiUrl'];a40_0xd499=function(){return _0x40a063;};return a40_0xd499();}(function(_0x1240be,_0x58cc2b){const _0x59f907=a40_0x481b,_0x37fdab=_0x1240be();while(!![]){try{const _0x1ee6e5=-parseInt(_0x59f907(0xe1))/0x1*(parseInt(_0x59f907(0x116))/0x2)+-parseInt(_0x59f907(0x120))/0x3*(-parseInt(_0x59f907(0x115))/0x4)+parseInt(_0x59f907(0xdc))/0x5*(-parseInt(_0x59f907(0x133))/0x6)+parseInt(_0x59f907(0xf4))/0x7+parseInt(_0x59f907(0xfb))/0x8*(parseInt(_0x59f907(0x10b))/0x9)+-parseInt(_0x59f907(0xda))/0xa+-parseInt(_0x59f907(0xd1))/0xb*(parseInt(_0x59f907(0xe3))/0xc);if(_0x1ee6e5===_0x58cc2b)break;else _0x37fdab['push'](_0x37fdab['shift']());}catch(_0x4a231f){_0x37fdab['push'](_0x37fdab['shift']());}}}(a40_0xd499,0xf1778));Object[a40_0x242b03(0xca)](exports,'__esModule',{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x1a22a0=a40_0x242b03;this[_0x1a22a0(0x138)]=_0x1a22a0(0x10c),console[_0x1a22a0(0x12d)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a40_0x242b03(0xe7)](_0x5810f4){const _0x27f42b=a40_0x242b03,{orderId:_0x4547c0,name:_0x2e3478,paymentDescription:_0x4b9915,amount:_0x5d3eea,currency:_0x1edd54,webhookUrl:_0x1d4bb3,returnUrl:_0x46a16b,expiryDate:_0x586444}=_0x5810f4,_0x2241bc=_0x1edd54['toUpperCase'](),_0xc212de=_0x27f42b(0xee),_0x47a51a=_0x27f42b(0x126)+_0x4547c0,_0x598c7f={'name':_0x2e3478,'paymentDescription':_0x4b9915,'amount':_0x5d3eea,'currency':_0x2241bc,'paymentId':_0x4547c0,'webhookUrl':_0xc212de,'returnUrl':_0x47a51a};_0x586444&&(_0x598c7f[_0x27f42b(0xfe)]=_0x586444);const _0x5b48a4=Date['now']();try{console[_0x27f42b(0x12d)](_0x27f42b(0x110)),console[_0x27f42b(0x12d)]('URL:',this[_0x27f42b(0x138)]),console['log'](_0x27f42b(0x129),JSON[_0x27f42b(0x122)](_0x598c7f,null,0x2)),console[_0x27f42b(0x12d)]('Order\x20ID\x20Format:',_0x4547c0,_0x27f42b(0x10d)),console[_0x27f42b(0x12d)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x47a51a),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x27f42b(0xf6),'/payment-links','POST',_0x598c7f);const _0x18a67c=await fetch(this[_0x27f42b(0x138)],{'method':_0x27f42b(0x12c),'headers':{'Content-Type':_0x27f42b(0x13e),'Accept':_0x27f42b(0x13e),'User-Agent':_0x27f42b(0xf3)},'body':JSON[_0x27f42b(0x122)](_0x598c7f)}),_0x3f5d23=Date[_0x27f42b(0x13b)]()-_0x5b48a4;console[_0x27f42b(0x12d)](_0x27f42b(0xec)),console['log'](_0x27f42b(0x10a),_0x18a67c['status']),console['log'](_0x27f42b(0xff),_0x18a67c[_0x27f42b(0x117)]),console[_0x27f42b(0x12d)](_0x27f42b(0x114),Object['fromEntries'](_0x18a67c['headers'][_0x27f42b(0x11a)]())),console[_0x27f42b(0x12d)](_0x27f42b(0x134),_0x3f5d23+'ms');const _0x731719=await _0x18a67c[_0x27f42b(0x135)]();console[_0x27f42b(0x12d)](_0x27f42b(0x113),_0x731719);if(!_0x18a67c['ok']){console[_0x27f42b(0xcd)](_0x27f42b(0x100)),console['error']('HTTP\x20Status:',_0x18a67c[_0x27f42b(0xd3)]),console[_0x27f42b(0xcd)](_0x27f42b(0x13c),_0x731719),loggerService_1[_0x27f42b(0xf1)][_0x27f42b(0xdf)]('noda',_0x27f42b(0xd4),_0x18a67c[_0x27f42b(0xd3)],_0x731719,_0x3f5d23),loggerService_1[_0x27f42b(0xf1)][_0x27f42b(0x136)](_0x27f42b(0xf6),_0x27f42b(0xd4),_0x27f42b(0xc9)+_0x18a67c[_0x27f42b(0xd3)]+':\x20'+_0x731719);if(_0x18a67c[_0x27f42b(0xd3)]===0x190)throw new Error(_0x27f42b(0xf2));else{if(_0x18a67c[_0x27f42b(0xd3)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x27f42b(0xd9)+_0x18a67c['status']+_0x27f42b(0x11c)+_0x731719);}let _0x395147;try{_0x395147=JSON[_0x27f42b(0x101)](_0x731719);}catch(_0xe288cf){console[_0x27f42b(0xcd)](_0x27f42b(0xed),_0xe288cf),loggerService_1[_0x27f42b(0xf1)][_0x27f42b(0x136)](_0x27f42b(0xf6),_0x27f42b(0xd4),_0x27f42b(0xef)+_0xe288cf);throw new Error(_0x27f42b(0x118)+_0x731719);}console[_0x27f42b(0x12d)](_0x27f42b(0xd5)),console[_0x27f42b(0x12d)]('Parsed\x20Result:',JSON[_0x27f42b(0x122)](_0x395147,null,0x2)),loggerService_1[_0x27f42b(0xf1)][_0x27f42b(0xdf)]('noda','/payment-links',_0x18a67c[_0x27f42b(0xd3)],_0x395147,_0x3f5d23);if(_0x395147[_0x27f42b(0xcd)]||_0x395147[_0x27f42b(0x132)]){const _0x54eeaa=_0x395147[_0x27f42b(0x12a)]||_0x395147[_0x27f42b(0xcd)]||_0x27f42b(0x123);console['error'](_0x27f42b(0x121)),console[_0x27f42b(0xcd)](_0x27f42b(0x131),_0x54eeaa),console[_0x27f42b(0xcd)](_0x27f42b(0xce),_0x395147[_0x27f42b(0x132)]),loggerService_1[_0x27f42b(0xf1)]['logWhiteDomainError']('noda',_0x27f42b(0xd4),'Business\x20Error:\x20'+_0x54eeaa);throw new Error(_0x27f42b(0x12b)+_0x54eeaa);}if(!_0x395147['id']||!_0x395147[_0x27f42b(0x107)]?.[_0x27f42b(0x106)]){console[_0x27f42b(0xcd)](_0x27f42b(0x11e)),console[_0x27f42b(0xcd)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x27f42b(0xcd)](_0x27f42b(0x11f),_0x395147),loggerService_1[_0x27f42b(0xf1)][_0x27f42b(0x136)](_0x27f42b(0xf6),'/payment-links',_0x27f42b(0x127));throw new Error(_0x27f42b(0xfd));}return console[_0x27f42b(0x12d)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x27f42b(0x12d)](_0x27f42b(0xf8),_0x395147['id']),console[_0x27f42b(0x12d)](_0x27f42b(0xe8),_0x395147[_0x27f42b(0x107)][_0x27f42b(0x106)]),console[_0x27f42b(0x12d)]('QR\x20Code\x20Link:',_0x395147[_0x27f42b(0x107)]['qrCodeLink']||_0x27f42b(0xdb)),console[_0x27f42b(0x12d)](_0x27f42b(0xd6),_0x4547c0,_0x27f42b(0x10e)),console['log'](_0x27f42b(0xe2),_0x47a51a),{'gateway_payment_id':_0x395147['id'],'payment_url':_0x395147['shortLinkUrls'][_0x27f42b(0x106)],'qr_code_url':_0x395147[_0x27f42b(0x107)][_0x27f42b(0xc8)],'expiry_date':_0x395147[_0x27f42b(0xfe)]};}catch(_0x363a35){console[_0x27f42b(0xcd)](_0x27f42b(0x112)),console['error'](_0x27f42b(0x104),_0x363a35),loggerService_1[_0x27f42b(0xf1)][_0x27f42b(0x136)](_0x27f42b(0xf6),'/payment-links',_0x363a35);if(_0x363a35 instanceof Error){console[_0x27f42b(0xcd)](_0x27f42b(0xe0),_0x363a35[_0x27f42b(0x12a)]),console[_0x27f42b(0xcd)](_0x27f42b(0xdd),_0x363a35[_0x27f42b(0xcb)]);throw new Error(_0x27f42b(0xea)+_0x363a35['message']);}throw new Error(_0x27f42b(0x119));}}async[a40_0x242b03(0x109)](_0x350552){const _0x44eae2=a40_0x242b03,_0x42e1e9=Date[_0x44eae2(0x13b)]();try{loggerService_1[_0x44eae2(0xf1)][_0x44eae2(0x103)](_0x44eae2(0xf6),'/payment-links/'+_0x350552,_0x44eae2(0xd2),{});const _0x2022a7=await fetch(this['apiUrl']+'/'+_0x350552,{'method':_0x44eae2(0xd2),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x39f27b=Date[_0x44eae2(0x13b)]()-_0x42e1e9;if(!_0x2022a7['ok']){const _0xbe15f4=await _0x2022a7[_0x44eae2(0x135)]();loggerService_1[_0x44eae2(0xf1)]['logWhiteDomainResponse'](_0x44eae2(0xf6),'/payment-links/'+_0x350552,_0x2022a7[_0x44eae2(0xd3)],_0xbe15f4,_0x39f27b);throw new Error(_0x44eae2(0xd9)+_0x2022a7[_0x44eae2(0xd3)]);}const _0x37db92=await _0x2022a7['json']();loggerService_1[_0x44eae2(0xf1)]['logWhiteDomainResponse'](_0x44eae2(0xf6),_0x44eae2(0x130)+_0x350552,_0x2022a7['status'],_0x37db92,_0x39f27b);if(_0x37db92[_0x44eae2(0xcd)]||_0x37db92['statusCode']){loggerService_1[_0x44eae2(0xf1)][_0x44eae2(0x136)](_0x44eae2(0xf6),_0x44eae2(0x130)+_0x350552,_0x44eae2(0x12b)+(_0x37db92['message']||_0x37db92[_0x44eae2(0xcd)]||_0x44eae2(0xe6)));throw new Error(_0x44eae2(0x12b)+(_0x37db92[_0x44eae2(0x12a)]||_0x37db92['error']||_0x44eae2(0xe6)));}let _0x3a3dde=_0x44eae2(0xf7);if(_0x37db92[_0x44eae2(0xe9)]===![]){if(_0x37db92[_0x44eae2(0xfe)]){const _0x317aa4=new Date(_0x37db92[_0x44eae2(0xfe)]),_0x6efd99=new Date();_0x317aa4<_0x6efd99?_0x3a3dde=_0x44eae2(0xd8):_0x3a3dde=_0x44eae2(0x102);}else _0x3a3dde=_0x44eae2(0x102);}else _0x3a3dde=_0x44eae2(0xf7);return{'status':_0x3a3dde,'amount':_0x37db92[_0x44eae2(0xf9)],'currency':_0x37db92[_0x44eae2(0xd0)],'isActive':_0x37db92[_0x44eae2(0xe9)]};}catch(_0x1be563){console[_0x44eae2(0xcd)]('Noda\x20payment\x20verification\x20error:',_0x1be563),loggerService_1['loggerService']['logWhiteDomainError'](_0x44eae2(0xf6),_0x44eae2(0x130)+_0x350552,_0x1be563);throw new Error(_0x44eae2(0xde)+(_0x1be563 instanceof Error?_0x1be563[_0x44eae2(0x12a)]:'Unknown\x20error'));}}async['processWebhook'](_0x4f830a){const _0x4e25dd=a40_0x242b03;console['log']('Processing\x20Noda\x20webhook:',_0x4f830a);let _0x3d971c=_0x4e25dd(0xf7);switch(_0x4f830a['Status']?.[_0x4e25dd(0x111)]()){case _0x4e25dd(0x128):case _0x4e25dd(0x105):case'paid':case'success':case _0x4e25dd(0xe5):_0x4f830a[_0x4e25dd(0xf5)]===_0x4e25dd(0x12e)?_0x3d971c=_0x4e25dd(0x11d):_0x3d971c=_0x4e25dd(0xf7);break;case _0x4e25dd(0x139):case _0x4e25dd(0x124):case _0x4e25dd(0x10f):case _0x4e25dd(0xcd):case _0x4e25dd(0xcc):_0x3d971c=_0x4e25dd(0x102);break;case _0x4e25dd(0x13a):case _0x4e25dd(0x12f):_0x3d971c=_0x4e25dd(0xd8);break;case _0x4e25dd(0x125):case _0x4e25dd(0xcf):case _0x4e25dd(0xd7):case _0x4e25dd(0xf0):case'in_progress':default:_0x3d971c=_0x4e25dd(0xf7);break;}return{'paymentId':_0x4f830a[_0x4e25dd(0x108)]||_0x4f830a[_0x4e25dd(0xeb)],'status':_0x3d971c,'amount':_0x4f830a['Amount'],'currency':_0x4f830a[_0x4e25dd(0x11b)],'additionalInfo':{'method':_0x4f830a[_0x4e25dd(0xe4)],'bankId':_0x4f830a[_0x4e25dd(0xfa)],'settled':_0x4f830a[_0x4e25dd(0xf5)],'settlementDate':_0x4f830a['SettlementDate'],'remitterName':_0x4f830a[_0x4e25dd(0x137)]?.[_0x4e25dd(0x13f)],'remitterIban':_0x4f830a[_0x4e25dd(0x137)]?.[_0x4e25dd(0x140)],'bankTransactionId':_0x4f830a[_0x4e25dd(0x13d)]}};}['verifyWebhookSignature'](_0x4032d4,_0x38e9fa){const _0x5e158e=a40_0x242b03;return console[_0x5e158e(0x12d)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x38e9fa,'paymentId':_0x4032d4[_0x5e158e(0xeb)],'merchantPaymentId':_0x4032d4[_0x5e158e(0x108)]}),!![];}}exports[a40_0x242b03(0xfc)]=NodaService;