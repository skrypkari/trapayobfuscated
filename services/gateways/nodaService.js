'use strict';const a43_0x4d24a0=a43_0x3158;(function(_0x3ea999,_0x4f8111){const _0x54fd8c=a43_0x3158,_0x52bc88=_0x3ea999();while(!![]){try{const _0x4fd633=-parseInt(_0x54fd8c(0x106))/0x1+parseInt(_0x54fd8c(0x105))/0x2+-parseInt(_0x54fd8c(0x136))/0x3*(-parseInt(_0x54fd8c(0x110))/0x4)+parseInt(_0x54fd8c(0x114))/0x5*(parseInt(_0x54fd8c(0xd6))/0x6)+-parseInt(_0x54fd8c(0x12a))/0x7+-parseInt(_0x54fd8c(0x123))/0x8+-parseInt(_0x54fd8c(0x121))/0x9*(-parseInt(_0x54fd8c(0xcc))/0xa);if(_0x4fd633===_0x4f8111)break;else _0x52bc88['push'](_0x52bc88['shift']());}catch(_0x36d46a){_0x52bc88['push'](_0x52bc88['shift']());}}}(a43_0x5b82,0x8ea78));Object['defineProperty'](exports,a43_0x4d24a0(0xdf),{'value':!![]}),exports['NodaService']=void 0x0;function a43_0x5b82(){const _0x23289b=['noda','Iban','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','https://tesoft.uk/gateway/noda/webhook/','Error\x20message:','headers','Status\x20Text:','status','Raw\x20Response\x20Body:','qrCodeLink','20ghRLBe','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20SUCCESS\x20===','expiryDate','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','isActive','Error\x20stack:','JSON\x20Parse\x20Error:\x20','statusCode','createPaymentLink','27474OLOedV','logWhiteDomainResponse','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PENDING','Missing\x20id\x20or\x20shortLink\x20in\x20response','Amount','completed','successful','Business\x20Error:\x20','__esModule','Noda\x20API\x20error:\x20','stringify','Failed\x20to\x20parse\x20JSON\x20response:','EXPIRED','amount','TesSoft\x20Payment\x20System/1.0','Response\x20Body:','Error\x20details:','Remitter','done','/payment-links','paid','https://tesoft.uk/gateway/pending.php?id=','Response\x20Time:','shortLinkUrls','Settled','text','Yes','apiUrl','processing','HTTP\x20Status:','application/json','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Noda\x20payment\x20verification\x20error:','../loggerService','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','log','error','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','in_progress','Payment\x20Link\x20ID:','Currency','Error\x20Message:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','loggerService','currency','1971098WSQVHK','686047TTzBjP','/payment-links/','toLowerCase','https://tesoft.uk/gateway/noda/','Name','Unknown\x20error','logWhiteDomainRequest','shortLink','FAILED','cancelled','436AToDic','PaymentId','parse','(8digits-8digits\x20format\x20for\x20Noda)','785sqMYuT','HTTP\x20','Status','toUpperCase','MerchantPaymentId','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','HTTP\x20error!\x20status:\x20','now','BankId','Failed\x20to\x20verify\x20Noda\x20payment:\x20','QR\x20Code\x20Link:','Method','Request\x20Body\x20(Direct\x20JSON):','884151QmalKX','created','3955952vzkjdW','failed','Order\x20ID\x20Used:','statusText','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','===\x20NODA\x20API\x20ERROR\x20===','Not\x20provided','5197871ZDzOuU','json',',\x20body:\x20','timeout','message','===\x20PARSED\x20NODA\x20RESPONSE\x20===','PAID','POST','Headers:','logWhiteDomainError','stack','verifyWebhookSignature','16692modghA','active'];a43_0x5b82=function(){return _0x23289b;};return a43_0x5b82();}function a43_0x3158(_0x404500,_0x38a9bf){const _0x5b8297=a43_0x5b82();return a43_0x3158=function(_0x3158bf,_0x12c29f){_0x3158bf=_0x3158bf-0xc9;let _0x36548c=_0x5b8297[_0x3158bf];return _0x36548c;},a43_0x3158(_0x404500,_0x38a9bf);}const loggerService_1=require(a43_0x4d24a0(0xf8));class NodaService{constructor(){const _0x7afede=a43_0x4d24a0;this[_0x7afede(0xf2)]=_0x7afede(0x109),console[_0x7afede(0xfb)](_0x7afede(0xd8));}async[a43_0x4d24a0(0xd5)](_0x11e7e2){const _0x4fda3e=a43_0x4d24a0,{orderId:_0xd69772,name:_0x5e676a,paymentDescription:_0x2f870c,amount:_0x3b2d8e,currency:_0x2f951b,webhookUrl:_0x316966,returnUrl:_0x4f4046,expiryDate:_0x248c23}=_0x11e7e2,_0xf5647f=_0x2f951b[_0x4fda3e(0x117)](),_0x6c78d8=_0x4fda3e(0x13b),_0x57c578=_0x4fda3e(0xec)+_0xd69772,_0x48a4fd={'name':_0x5e676a,'paymentDescription':_0x2f870c,'amount':_0x3b2d8e,'currency':_0xf5647f,'paymentId':_0xd69772,'webhookUrl':_0x6c78d8,'returnUrl':_0x57c578};_0x248c23&&(_0x48a4fd[_0x4fda3e(0xcf)]=_0x248c23);const _0x13e54f=Date[_0x4fda3e(0x11b)]();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x4fda3e(0xfb)]('URL:',this[_0x4fda3e(0xf2)]),console[_0x4fda3e(0xfb)](_0x4fda3e(0x120),JSON['stringify'](_0x48a4fd,null,0x2)),console[_0x4fda3e(0xfb)]('Order\x20ID\x20Format:',_0xd69772,_0x4fda3e(0x113)),console[_0x4fda3e(0xfb)](_0x4fda3e(0x13a),_0x57c578),loggerService_1[_0x4fda3e(0x103)][_0x4fda3e(0x10c)](_0x4fda3e(0x138),_0x4fda3e(0xea),_0x4fda3e(0x131),_0x48a4fd);const _0xcb4ebc=await fetch(this[_0x4fda3e(0xf2)],{'method':'POST','headers':{'Content-Type':_0x4fda3e(0xf5),'Accept':_0x4fda3e(0xf5),'User-Agent':_0x4fda3e(0xe5)},'body':JSON[_0x4fda3e(0xe1)](_0x48a4fd)}),_0x178ab4=Date[_0x4fda3e(0x11b)]()-_0x13e54f;console[_0x4fda3e(0xfb)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x4fda3e(0xfb)]('Status:',_0xcb4ebc[_0x4fda3e(0xc9)]),console[_0x4fda3e(0xfb)](_0x4fda3e(0x13e),_0xcb4ebc[_0x4fda3e(0x126)]),console[_0x4fda3e(0xfb)](_0x4fda3e(0x132),Object['fromEntries'](_0xcb4ebc[_0x4fda3e(0x13d)]['entries']())),console[_0x4fda3e(0xfb)](_0x4fda3e(0xed),_0x178ab4+'ms');const _0x2a76eb=await _0xcb4ebc[_0x4fda3e(0xf0)]();console[_0x4fda3e(0xfb)](_0x4fda3e(0xca),_0x2a76eb);if(!_0xcb4ebc['ok']){console[_0x4fda3e(0xfc)](_0x4fda3e(0x128)),console[_0x4fda3e(0xfc)](_0x4fda3e(0xf4),_0xcb4ebc[_0x4fda3e(0xc9)]),console['error'](_0x4fda3e(0xe6),_0x2a76eb),loggerService_1[_0x4fda3e(0x103)][_0x4fda3e(0xd7)](_0x4fda3e(0x138),_0x4fda3e(0xea),_0xcb4ebc[_0x4fda3e(0xc9)],_0x2a76eb,_0x178ab4),loggerService_1['loggerService'][_0x4fda3e(0x133)](_0x4fda3e(0x138),'/payment-links',_0x4fda3e(0x115)+_0xcb4ebc[_0x4fda3e(0xc9)]+':\x20'+_0x2a76eb);if(_0xcb4ebc[_0x4fda3e(0xc9)]===0x190)throw new Error(_0x4fda3e(0x102));else{if(_0xcb4ebc[_0x4fda3e(0xc9)]===0x1f4)throw new Error(_0x4fda3e(0xfa));}throw new Error(_0x4fda3e(0x11a)+_0xcb4ebc['status']+_0x4fda3e(0x12c)+_0x2a76eb);}let _0x41d4c1;try{_0x41d4c1=JSON[_0x4fda3e(0x112)](_0x2a76eb);}catch(_0x4d3d06){console[_0x4fda3e(0xfc)](_0x4fda3e(0xe2),_0x4d3d06),loggerService_1[_0x4fda3e(0x103)][_0x4fda3e(0x133)]('noda',_0x4fda3e(0xea),_0x4fda3e(0xd3)+_0x4d3d06);throw new Error(_0x4fda3e(0xfd)+_0x2a76eb);}console[_0x4fda3e(0xfb)](_0x4fda3e(0x12f)),console[_0x4fda3e(0xfb)]('Parsed\x20Result:',JSON[_0x4fda3e(0xe1)](_0x41d4c1,null,0x2)),loggerService_1['loggerService'][_0x4fda3e(0xd7)]('noda',_0x4fda3e(0xea),_0xcb4ebc[_0x4fda3e(0xc9)],_0x41d4c1,_0x178ab4);if(_0x41d4c1[_0x4fda3e(0xfc)]||_0x41d4c1[_0x4fda3e(0xd4)]){const _0x3006e6=_0x41d4c1[_0x4fda3e(0x12e)]||_0x41d4c1[_0x4fda3e(0xfc)]||'Unknown\x20error\x20from\x20Noda\x20API';console['error']('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x4fda3e(0xfc)](_0x4fda3e(0x101),_0x3006e6),console[_0x4fda3e(0xfc)]('Status\x20Code:',_0x41d4c1['statusCode']),loggerService_1[_0x4fda3e(0x103)][_0x4fda3e(0x133)]('noda','/payment-links',_0x4fda3e(0xde)+_0x3006e6);throw new Error('Noda\x20API\x20error:\x20'+_0x3006e6);}if(!_0x41d4c1['id']||!_0x41d4c1['shortLinkUrls']?.[_0x4fda3e(0x10d)]){console[_0x4fda3e(0xfc)](_0x4fda3e(0xf9)),console[_0x4fda3e(0xfc)](_0x4fda3e(0xda)),console[_0x4fda3e(0xfc)]('Response\x20data:',_0x41d4c1),loggerService_1[_0x4fda3e(0x103)][_0x4fda3e(0x133)](_0x4fda3e(0x138),'/payment-links',_0x4fda3e(0xf6));throw new Error(_0x4fda3e(0xcd));}return console[_0x4fda3e(0xfb)](_0x4fda3e(0xce)),console[_0x4fda3e(0xfb)](_0x4fda3e(0xff),_0x41d4c1['id']),console['log']('Short\x20Link:',_0x41d4c1[_0x4fda3e(0xee)][_0x4fda3e(0x10d)]),console[_0x4fda3e(0xfb)](_0x4fda3e(0x11e),_0x41d4c1[_0x4fda3e(0xee)][_0x4fda3e(0xcb)]||_0x4fda3e(0x129)),console[_0x4fda3e(0xfb)](_0x4fda3e(0x125),_0xd69772,'(8digits-8digits\x20format)'),console[_0x4fda3e(0xfb)](_0x4fda3e(0x119),_0x57c578),{'gateway_payment_id':_0x41d4c1['id'],'payment_url':_0x41d4c1[_0x4fda3e(0xee)]['shortLink'],'qr_code_url':_0x41d4c1[_0x4fda3e(0xee)]['qrCodeLink'],'expiry_date':_0x41d4c1[_0x4fda3e(0xcf)]};}catch(_0x37f02d){console[_0x4fda3e(0xfc)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x4fda3e(0xfc)](_0x4fda3e(0xe7),_0x37f02d),loggerService_1[_0x4fda3e(0x103)][_0x4fda3e(0x133)]('noda',_0x4fda3e(0xea),_0x37f02d);if(_0x37f02d instanceof Error){console[_0x4fda3e(0xfc)](_0x4fda3e(0x13c),_0x37f02d[_0x4fda3e(0x12e)]),console[_0x4fda3e(0xfc)](_0x4fda3e(0xd2),_0x37f02d[_0x4fda3e(0x134)]);throw new Error(_0x4fda3e(0xd0)+_0x37f02d[_0x4fda3e(0x12e)]);}throw new Error(_0x4fda3e(0x127));}}async['verifyPayment'](_0x384a20){const _0x122739=a43_0x4d24a0,_0x1f981e=Date[_0x122739(0x11b)]();try{loggerService_1[_0x122739(0x103)][_0x122739(0x10c)](_0x122739(0x138),'/payment-links/'+_0x384a20,'GET',{});const _0x2cce32=await fetch(this['apiUrl']+'/'+_0x384a20,{'method':'GET','headers':{'Content-Type':_0x122739(0xf5),'User-Agent':_0x122739(0xe5)}}),_0x31955c=Date[_0x122739(0x11b)]()-_0x1f981e;if(!_0x2cce32['ok']){const _0xd2963c=await _0x2cce32['text']();loggerService_1[_0x122739(0x103)][_0x122739(0xd7)](_0x122739(0x138),_0x122739(0x107)+_0x384a20,_0x2cce32[_0x122739(0xc9)],_0xd2963c,_0x31955c);throw new Error(_0x122739(0x11a)+_0x2cce32[_0x122739(0xc9)]);}const _0x5e15ee=await _0x2cce32[_0x122739(0x12b)]();loggerService_1[_0x122739(0x103)][_0x122739(0xd7)]('noda',_0x122739(0x107)+_0x384a20,_0x2cce32[_0x122739(0xc9)],_0x5e15ee,_0x31955c);if(_0x5e15ee[_0x122739(0xfc)]||_0x5e15ee[_0x122739(0xd4)]){loggerService_1[_0x122739(0x103)][_0x122739(0x133)](_0x122739(0x138),'/payment-links/'+_0x384a20,'Noda\x20API\x20error:\x20'+(_0x5e15ee[_0x122739(0x12e)]||_0x5e15ee[_0x122739(0xfc)]||_0x122739(0x10b)));throw new Error(_0x122739(0xe0)+(_0x5e15ee[_0x122739(0x12e)]||_0x5e15ee[_0x122739(0xfc)]||_0x122739(0x10b)));}let _0x1f3585=_0x122739(0xd9);if(_0x5e15ee['isActive']===![]){if(_0x5e15ee[_0x122739(0xcf)]){const _0x566b15=new Date(_0x5e15ee['expiryDate']),_0x358b63=new Date();_0x566b15<_0x358b63?_0x1f3585=_0x122739(0xe3):_0x1f3585=_0x122739(0x10e);}else _0x1f3585=_0x122739(0x10e);}else _0x1f3585='PENDING';return{'status':_0x1f3585,'amount':_0x5e15ee[_0x122739(0xe4)],'currency':_0x5e15ee[_0x122739(0x104)],'isActive':_0x5e15ee[_0x122739(0xd1)]};}catch(_0x431345){console[_0x122739(0xfc)](_0x122739(0xf7),_0x431345),loggerService_1['loggerService'][_0x122739(0x133)](_0x122739(0x138),'/payment-links/'+_0x384a20,_0x431345);throw new Error(_0x122739(0x11d)+(_0x431345 instanceof Error?_0x431345['message']:_0x122739(0x10b)));}}async['processWebhook'](_0x30a320){const _0x35e674=a43_0x4d24a0;console[_0x35e674(0xfb)]('Processing\x20Noda\x20webhook:',_0x30a320);let _0x3345a2=_0x35e674(0xd9);switch(_0x30a320[_0x35e674(0x116)]?.[_0x35e674(0x108)]()){case _0x35e674(0xe9):case _0x35e674(0xdc):case _0x35e674(0xeb):case'success':case _0x35e674(0xdd):_0x30a320[_0x35e674(0xef)]===_0x35e674(0xf1)?_0x3345a2=_0x35e674(0x130):_0x3345a2=_0x35e674(0xd9);break;case _0x35e674(0x10f):case'canceled':case _0x35e674(0x124):case _0x35e674(0xfc):case'rejected':_0x3345a2=_0x35e674(0x10e);break;case'expired':case _0x35e674(0x12d):_0x3345a2=_0x35e674(0xe3);break;case'pending':case _0x35e674(0x122):case _0x35e674(0x137):case _0x35e674(0xf3):case _0x35e674(0xfe):default:_0x3345a2='PENDING';break;}return{'paymentId':_0x30a320['MerchantPaymentId']||_0x30a320[_0x35e674(0x111)],'status':_0x3345a2,'amount':_0x30a320[_0x35e674(0xdb)],'currency':_0x30a320[_0x35e674(0x100)],'additionalInfo':{'method':_0x30a320[_0x35e674(0x11f)],'bankId':_0x30a320[_0x35e674(0x11c)],'settled':_0x30a320[_0x35e674(0xef)],'settlementDate':_0x30a320['SettlementDate'],'remitterName':_0x30a320[_0x35e674(0xe8)]?.[_0x35e674(0x10a)],'remitterIban':_0x30a320['Remitter']?.[_0x35e674(0x139)],'bankTransactionId':_0x30a320['BankTransactionId']}};}[a43_0x4d24a0(0x135)](_0x245015,_0x53c595){const _0xb21ace=a43_0x4d24a0;return console[_0xb21ace(0xfb)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x53c595,'paymentId':_0x245015[_0xb21ace(0x111)],'merchantPaymentId':_0x245015[_0xb21ace(0x118)]}),!![];}}exports['NodaService']=NodaService;