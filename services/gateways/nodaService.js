'use strict';const a47_0x3f831b=a47_0x1d7c;(function(_0x1dc5c7,_0x3a03e8){const _0x42bf74=a47_0x1d7c,_0x1850a7=_0x1dc5c7();while(!![]){try{const _0x4ee0db=-parseInt(_0x42bf74(0x218))/0x1+parseInt(_0x42bf74(0x1d9))/0x2+-parseInt(_0x42bf74(0x1dc))/0x3+-parseInt(_0x42bf74(0x21a))/0x4*(-parseInt(_0x42bf74(0x1db))/0x5)+parseInt(_0x42bf74(0x1fc))/0x6*(-parseInt(_0x42bf74(0x1ae))/0x7)+parseInt(_0x42bf74(0x1a8))/0x8+parseInt(_0x42bf74(0x207))/0x9;if(_0x4ee0db===_0x3a03e8)break;else _0x1850a7['push'](_0x1850a7['shift']());}catch(_0x405bd6){_0x1850a7['push'](_0x1850a7['shift']());}}}(a47_0x1c4e,0x7111e));Object[a47_0x3f831b(0x1cb)](exports,'__esModule',{'value':!![]}),exports[a47_0x3f831b(0x1c9)]=void 0x0;function a47_0x1c4e(){const _0x409ad5=['PaymentId','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Remitter','Settled','Unknown\x20error','URL:','Headers:','completed','processing','GET','application/json','../loggerService','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','207884IbUSCe','currency','1275SViUrv','1084590WrebJI','statusText','/payment-links','PENDING','success','===\x20NODA\x20SERVICE\x20ERROR\x20===','Noda\x20API\x20error:\x20','Status:','Parsed\x20Result:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','parse','verifyPayment','Response\x20Time:','HTTP\x20','BankId','logWhiteDomainResponse','Error\x20stack:','stack','JSON\x20Parse\x20Error:\x20','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','entries','error','Error\x20message:','https://tesoft.uk/gateway/noda/','Error\x20details:','Not\x20provided','Status\x20Text:','BankTransactionId','EXPIRED','Error\x20Message:','verifyWebhookSignature','HTTP\x20Status:','6QjUUHm','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','fromEntries','apiUrl','stringify','noda','Business\x20Error:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Currency','expired','failed','7112916rRUOjB','MerchantPaymentId','expiryDate','Response\x20Body:','loggerService','logWhiteDomainRequest','Request\x20Body\x20(Direct\x20JSON):','FAILED','in_progress','timeout','Processing\x20Noda\x20webhook:','now','amount','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','logWhiteDomainError','===\x20NODA\x20SUCCESS\x20===','HTTP\x20error!\x20status:\x20','82008KoyrFY','paid','5308nbMEST','===\x20NODA\x20API\x20ERROR\x20===','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Response\x20data:','shortLink','Amount','PAID','processWebhook','Unknown\x20error\x20from\x20Noda\x20API','json','1048856vImYHK','Missing\x20id\x20or\x20shortLink\x20in\x20response','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Payment\x20Link\x20ID:','Status','3199602pOFmLK','log','statusCode','shortLinkUrls','qrCodeLink','===\x20PARSED\x20NODA\x20RESPONSE\x20===','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','message','done','createPaymentLink','rejected','canceled','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','isActive','created','Order\x20ID\x20Format:','Order\x20ID\x20Used:','toUpperCase','Iban','/payment-links/','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Status\x20Code:','TesSoft\x20Payment\x20System/1.0','(8digits-8digits\x20format)','status','Raw\x20Response\x20Body:','NodaService','https://tesoft.uk/gateway/pending.php?id=','defineProperty'];a47_0x1c4e=function(){return _0x409ad5;};return a47_0x1c4e();}const loggerService_1=require(a47_0x3f831b(0x1d7));class NodaService{constructor(){const _0x3d9840=a47_0x3f831b;this[_0x3d9840(0x1ff)]=_0x3d9840(0x1f3),console[_0x3d9840(0x1af)](_0x3d9840(0x1d8));}async[a47_0x3f831b(0x1b7)](_0xa819ea){const _0x2d484e=a47_0x3f831b,{orderId:_0x4a906d,name:_0x4095fb,paymentDescription:_0x9bedc0,amount:_0x1701cb,currency:_0x12344c,webhookUrl:_0x34e910,returnUrl:_0x2d00cf,expiryDate:_0x4189d8}=_0xa819ea,_0x59b74a=_0x12344c[_0x2d484e(0x1c0)](),_0x19a2f8='https://tesoft.uk/gateway/noda/webhook/',_0x4b64e3=_0x2d484e(0x1ca)+_0x4a906d,_0x4366de={'name':_0x4095fb,'paymentDescription':_0x9bedc0,'amount':_0x1701cb,'currency':_0x59b74a,'paymentId':_0x4a906d,'webhookUrl':_0x19a2f8,'returnUrl':_0x4b64e3};_0x4189d8&&(_0x4366de['expiryDate']=_0x4189d8);const _0x4a3bcd=Date[_0x2d484e(0x212)]();try{console[_0x2d484e(0x1af)](_0x2d484e(0x1ba)),console[_0x2d484e(0x1af)](_0x2d484e(0x1d1),this[_0x2d484e(0x1ff)]),console[_0x2d484e(0x1af)](_0x2d484e(0x20d),JSON[_0x2d484e(0x200)](_0x4366de,null,0x2)),console['log'](_0x2d484e(0x1be),_0x4a906d,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x2d484e(0x1af)](_0x2d484e(0x1e5),_0x4b64e3),loggerService_1['loggerService'][_0x2d484e(0x20c)]('noda',_0x2d484e(0x1de),'POST',_0x4366de);const _0x4471d7=await fetch(this[_0x2d484e(0x1ff)],{'method':'POST','headers':{'Content-Type':_0x2d484e(0x1d6),'Accept':_0x2d484e(0x1d6),'User-Agent':_0x2d484e(0x1c5)},'body':JSON[_0x2d484e(0x200)](_0x4366de)}),_0x231716=Date[_0x2d484e(0x212)]()-_0x4a3bcd;console[_0x2d484e(0x1af)](_0x2d484e(0x1b4)),console[_0x2d484e(0x1af)](_0x2d484e(0x1e3),_0x4471d7[_0x2d484e(0x1c7)]),console[_0x2d484e(0x1af)](_0x2d484e(0x1f6),_0x4471d7[_0x2d484e(0x1dd)]),console[_0x2d484e(0x1af)](_0x2d484e(0x1d2),Object[_0x2d484e(0x1fe)](_0x4471d7['headers'][_0x2d484e(0x1f0)]())),console[_0x2d484e(0x1af)](_0x2d484e(0x1e8),_0x231716+'ms');const _0xf6e425=await _0x4471d7['text']();console[_0x2d484e(0x1af)](_0x2d484e(0x1c8),_0xf6e425);if(!_0x4471d7['ok']){console[_0x2d484e(0x1f1)](_0x2d484e(0x21b)),console[_0x2d484e(0x1f1)](_0x2d484e(0x1fb),_0x4471d7[_0x2d484e(0x1c7)]),console[_0x2d484e(0x1f1)](_0x2d484e(0x20a),_0xf6e425),loggerService_1[_0x2d484e(0x20b)][_0x2d484e(0x1eb)](_0x2d484e(0x201),_0x2d484e(0x1de),_0x4471d7['status'],_0xf6e425,_0x231716),loggerService_1[_0x2d484e(0x20b)][_0x2d484e(0x215)](_0x2d484e(0x201),_0x2d484e(0x1de),_0x2d484e(0x1e9)+_0x4471d7[_0x2d484e(0x1c7)]+':\x20'+_0xf6e425);if(_0x4471d7[_0x2d484e(0x1c7)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x4471d7[_0x2d484e(0x1c7)]===0x1f4)throw new Error(_0x2d484e(0x214));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x4471d7[_0x2d484e(0x1c7)]+',\x20body:\x20'+_0xf6e425);}let _0x125698;try{_0x125698=JSON[_0x2d484e(0x1e6)](_0xf6e425);}catch(_0x49c18c){console[_0x2d484e(0x1f1)](_0x2d484e(0x1aa),_0x49c18c),loggerService_1[_0x2d484e(0x20b)][_0x2d484e(0x215)]('noda','/payment-links',_0x2d484e(0x1ee)+_0x49c18c);throw new Error(_0x2d484e(0x1ab)+_0xf6e425);}console[_0x2d484e(0x1af)](_0x2d484e(0x1b3)),console[_0x2d484e(0x1af)](_0x2d484e(0x1e4),JSON[_0x2d484e(0x200)](_0x125698,null,0x2)),loggerService_1[_0x2d484e(0x20b)][_0x2d484e(0x1eb)](_0x2d484e(0x201),_0x2d484e(0x1de),_0x4471d7[_0x2d484e(0x1c7)],_0x125698,_0x231716);if(_0x125698[_0x2d484e(0x1f1)]||_0x125698[_0x2d484e(0x1b0)]){const _0x1c5d63=_0x125698[_0x2d484e(0x1b5)]||_0x125698[_0x2d484e(0x1f1)]||_0x2d484e(0x1a6);console['error'](_0x2d484e(0x21c)),console[_0x2d484e(0x1f1)](_0x2d484e(0x1f9),_0x1c5d63),console['error'](_0x2d484e(0x1c4),_0x125698[_0x2d484e(0x1b0)]),loggerService_1[_0x2d484e(0x20b)][_0x2d484e(0x215)](_0x2d484e(0x201),'/payment-links',_0x2d484e(0x202)+_0x1c5d63);throw new Error('Noda\x20API\x20error:\x20'+_0x1c5d63);}if(!_0x125698['id']||!_0x125698['shortLinkUrls']?.['shortLink']){console[_0x2d484e(0x1f1)](_0x2d484e(0x1bb)),console['error'](_0x2d484e(0x1a9)),console[_0x2d484e(0x1f1)](_0x2d484e(0x21d),_0x125698),loggerService_1['loggerService']['logWhiteDomainError'](_0x2d484e(0x201),_0x2d484e(0x1de),_0x2d484e(0x1c3));throw new Error(_0x2d484e(0x1cd));}return console[_0x2d484e(0x1af)](_0x2d484e(0x216)),console[_0x2d484e(0x1af)](_0x2d484e(0x1ac),_0x125698['id']),console[_0x2d484e(0x1af)]('Short\x20Link:',_0x125698[_0x2d484e(0x1b1)]['shortLink']),console[_0x2d484e(0x1af)]('QR\x20Code\x20Link:',_0x125698[_0x2d484e(0x1b1)][_0x2d484e(0x1b2)]||_0x2d484e(0x1f5)),console[_0x2d484e(0x1af)](_0x2d484e(0x1bf),_0x4a906d,_0x2d484e(0x1c6)),console['log'](_0x2d484e(0x1ef),_0x4b64e3),{'gateway_payment_id':_0x125698['id'],'payment_url':_0x125698['shortLinkUrls'][_0x2d484e(0x1a2)],'qr_code_url':_0x125698[_0x2d484e(0x1b1)][_0x2d484e(0x1b2)],'expiry_date':_0x125698['expiryDate']};}catch(_0x4e849f){console[_0x2d484e(0x1f1)](_0x2d484e(0x1e1)),console[_0x2d484e(0x1f1)](_0x2d484e(0x1f4),_0x4e849f),loggerService_1[_0x2d484e(0x20b)][_0x2d484e(0x215)](_0x2d484e(0x201),_0x2d484e(0x1de),_0x4e849f);if(_0x4e849f instanceof Error){console[_0x2d484e(0x1f1)](_0x2d484e(0x1f2),_0x4e849f[_0x2d484e(0x1b5)]),console[_0x2d484e(0x1f1)](_0x2d484e(0x1ec),_0x4e849f[_0x2d484e(0x1ed)]);throw new Error(_0x2d484e(0x203)+_0x4e849f[_0x2d484e(0x1b5)]);}throw new Error(_0x2d484e(0x1fd));}}async[a47_0x3f831b(0x1e7)](_0x39ef52){const _0x39aacc=a47_0x3f831b,_0x131889=Date[_0x39aacc(0x212)]();try{loggerService_1['loggerService']['logWhiteDomainRequest'](_0x39aacc(0x201),_0x39aacc(0x1c2)+_0x39ef52,_0x39aacc(0x1d5),{});const _0x110937=await fetch(this[_0x39aacc(0x1ff)]+'/'+_0x39ef52,{'method':_0x39aacc(0x1d5),'headers':{'Content-Type':_0x39aacc(0x1d6),'User-Agent':_0x39aacc(0x1c5)}}),_0x3dbc38=Date['now']()-_0x131889;if(!_0x110937['ok']){const _0x20a648=await _0x110937['text']();loggerService_1[_0x39aacc(0x20b)][_0x39aacc(0x1eb)](_0x39aacc(0x201),'/payment-links/'+_0x39ef52,_0x110937[_0x39aacc(0x1c7)],_0x20a648,_0x3dbc38);throw new Error(_0x39aacc(0x217)+_0x110937[_0x39aacc(0x1c7)]);}const _0x40ab19=await _0x110937[_0x39aacc(0x1a7)]();loggerService_1[_0x39aacc(0x20b)][_0x39aacc(0x1eb)](_0x39aacc(0x201),_0x39aacc(0x1c2)+_0x39ef52,_0x110937[_0x39aacc(0x1c7)],_0x40ab19,_0x3dbc38);if(_0x40ab19[_0x39aacc(0x1f1)]||_0x40ab19['statusCode']){loggerService_1['loggerService'][_0x39aacc(0x215)]('noda',_0x39aacc(0x1c2)+_0x39ef52,_0x39aacc(0x1e2)+(_0x40ab19[_0x39aacc(0x1b5)]||_0x40ab19[_0x39aacc(0x1f1)]||_0x39aacc(0x1d0)));throw new Error(_0x39aacc(0x1e2)+(_0x40ab19['message']||_0x40ab19['error']||_0x39aacc(0x1d0)));}let _0x2a1b1d=_0x39aacc(0x1df);if(_0x40ab19[_0x39aacc(0x1bc)]===![]){if(_0x40ab19[_0x39aacc(0x209)]){const _0x11a1c4=new Date(_0x40ab19['expiryDate']),_0x3d5dbc=new Date();_0x11a1c4<_0x3d5dbc?_0x2a1b1d=_0x39aacc(0x1f8):_0x2a1b1d=_0x39aacc(0x20e);}else _0x2a1b1d=_0x39aacc(0x20e);}else _0x2a1b1d='PENDING';return{'status':_0x2a1b1d,'amount':_0x40ab19[_0x39aacc(0x213)],'currency':_0x40ab19[_0x39aacc(0x1da)],'isActive':_0x40ab19[_0x39aacc(0x1bc)]};}catch(_0x418e9c){console[_0x39aacc(0x1f1)]('Noda\x20payment\x20verification\x20error:',_0x418e9c),loggerService_1['loggerService'][_0x39aacc(0x215)]('noda',_0x39aacc(0x1c2)+_0x39ef52,_0x418e9c);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x418e9c instanceof Error?_0x418e9c[_0x39aacc(0x1b5)]:_0x39aacc(0x1d0)));}}async[a47_0x3f831b(0x1a5)](_0x417a1c){const _0x1fa4a0=a47_0x3f831b;console[_0x1fa4a0(0x1af)](_0x1fa4a0(0x211),_0x417a1c);let _0x2a7c56=_0x1fa4a0(0x1df);switch(_0x417a1c[_0x1fa4a0(0x1ad)]?.['toLowerCase']()){case _0x1fa4a0(0x1b6):case _0x1fa4a0(0x1d3):case _0x1fa4a0(0x219):case _0x1fa4a0(0x1e0):case'successful':_0x417a1c[_0x1fa4a0(0x1cf)]==='Yes'?_0x2a7c56=_0x1fa4a0(0x1a4):_0x2a7c56=_0x1fa4a0(0x1df);break;case'cancelled':case _0x1fa4a0(0x1b9):case _0x1fa4a0(0x206):case _0x1fa4a0(0x1f1):case _0x1fa4a0(0x1b8):_0x2a7c56=_0x1fa4a0(0x20e);break;case _0x1fa4a0(0x205):case _0x1fa4a0(0x210):_0x2a7c56=_0x1fa4a0(0x1f8);break;case'pending':case _0x1fa4a0(0x1bd):case'active':case _0x1fa4a0(0x1d4):case _0x1fa4a0(0x20f):default:_0x2a7c56=_0x1fa4a0(0x1df);break;}return{'paymentId':_0x417a1c[_0x1fa4a0(0x208)]||_0x417a1c[_0x1fa4a0(0x1cc)],'status':_0x2a7c56,'amount':_0x417a1c[_0x1fa4a0(0x1a3)],'currency':_0x417a1c[_0x1fa4a0(0x204)],'additionalInfo':{'method':_0x417a1c['Method'],'bankId':_0x417a1c[_0x1fa4a0(0x1ea)],'settled':_0x417a1c[_0x1fa4a0(0x1cf)],'settlementDate':_0x417a1c['SettlementDate'],'remitterName':_0x417a1c[_0x1fa4a0(0x1ce)]?.['Name'],'remitterIban':_0x417a1c[_0x1fa4a0(0x1ce)]?.[_0x1fa4a0(0x1c1)],'bankTransactionId':_0x417a1c[_0x1fa4a0(0x1f7)]}};}[a47_0x3f831b(0x1fa)](_0x2319f1,_0xec78a3){const _0x33843b=a47_0x3f831b;return console[_0x33843b(0x1af)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0xec78a3,'paymentId':_0x2319f1[_0x33843b(0x1cc)],'merchantPaymentId':_0x2319f1['MerchantPaymentId']}),!![];}}function a47_0x1d7c(_0x43ec8b,_0x2b81af){const _0x1c4e93=a47_0x1c4e();return a47_0x1d7c=function(_0x1d7cd9,_0x404ef7){_0x1d7cd9=_0x1d7cd9-0x1a2;let _0x2c62c4=_0x1c4e93[_0x1d7cd9];return _0x2c62c4;},a47_0x1d7c(_0x43ec8b,_0x2b81af);}exports['NodaService']=NodaService;