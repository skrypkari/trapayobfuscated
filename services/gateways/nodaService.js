'use strict';const a43_0x53c765=a43_0x3c76;function a43_0x3c76(_0x56edab,_0x459204){const _0x86216d=a43_0x8621();return a43_0x3c76=function(_0x3c76a5,_0x4006d6){_0x3c76a5=_0x3c76a5-0x1df;let _0x51f5ed=_0x86216d[_0x3c76a5];return _0x51f5ed;},a43_0x3c76(_0x56edab,_0x459204);}(function(_0x5729a1,_0x1c0b2e){const _0x44eb60=a43_0x3c76,_0x1ec324=_0x5729a1();while(!![]){try{const _0x3eb4d3=-parseInt(_0x44eb60(0x1f6))/0x1+parseInt(_0x44eb60(0x231))/0x2*(parseInt(_0x44eb60(0x1df))/0x3)+-parseInt(_0x44eb60(0x1f7))/0x4+-parseInt(_0x44eb60(0x1e3))/0x5*(-parseInt(_0x44eb60(0x23d))/0x6)+-parseInt(_0x44eb60(0x23b))/0x7*(parseInt(_0x44eb60(0x228))/0x8)+parseInt(_0x44eb60(0x22b))/0x9*(-parseInt(_0x44eb60(0x22d))/0xa)+parseInt(_0x44eb60(0x21c))/0xb;if(_0x3eb4d3===_0x1c0b2e)break;else _0x1ec324['push'](_0x1ec324['shift']());}catch(_0x165f88){_0x1ec324['push'](_0x1ec324['shift']());}}}(a43_0x8621,0x5222b));function a43_0x8621(){const _0x29da92=['All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Settled','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','205vVePdI','Yes','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','HTTP\x20error!\x20status:\x20','canceled','successful','expiryDate','processing','Remitter','PENDING','pending','in_progress','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','currency','(8digits-8digits\x20format\x20for\x20Noda)','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','HTTP\x20Status:','expired','Headers:','434689xtZNaJ','675044zlxowW','Status\x20Text:','/payment-links/','paid','failed','Short\x20Link:','logWhiteDomainError','isActive','logWhiteDomainRequest','Response\x20data:','Amount','../loggerService','NodaService','logWhiteDomainResponse','BankTransactionId','done','Order\x20ID\x20Used:','PAID','statusText','Status\x20Code:','status','GET','success','Noda\x20API\x20error:\x20','FAILED','log','qrCodeLink','json','Response\x20Time:','text','Unknown\x20error','Failed\x20to\x20verify\x20Noda\x20payment:\x20','PaymentId','POST','completed','https://tesoft.uk/gateway/noda/webhook/','JSON\x20Parse\x20Error:\x20','4964102Myllkn','Error\x20stack:','rejected','Currency','Status','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','apiUrl','EXPIRED','URL:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','noda','176xRYQqC','Name','loggerService','9hAhcbK','Noda\x20webhook\x20signature\x20verification:','1118960HoZoyj','timeout','toLowerCase','QR\x20Code\x20Link:','35252nwYnYj','Order\x20ID\x20Format:','Processing\x20Noda\x20webhook:','===\x20NODA\x20API\x20ERROR\x20===','HTTP\x20','(8digits-8digits\x20format)','application/json','headers','entries','statusCode','34356KFlqKv','https://tesoft.uk/gateway/noda/','15978HDOvbH','Noda\x20payment\x20verification\x20error:','stringify','created','message','Request\x20Body\x20(Direct\x20JSON):','Missing\x20id\x20or\x20shortLink\x20in\x20response','Unknown\x20error\x20from\x20Noda\x20API','error','Status:','active','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','BankId',',\x20body:\x20','shortLinkUrls','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','shortLink','Method','Iban','Response\x20Body:','now','/payment-links','102LMSYjL'];a43_0x8621=function(){return _0x29da92;};return a43_0x8621();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a43_0x53c765(0x202));class NodaService{constructor(){const _0x4062b6=a43_0x53c765;this['apiUrl']=_0x4062b6(0x23c),console[_0x4062b6(0x210)](_0x4062b6(0x24c));}async['createPaymentLink'](_0x5dc11c){const _0xa3bd42=a43_0x53c765,{orderId:_0x3505bb,name:_0x1ca349,paymentDescription:_0x3a00dc,amount:_0x5b0b64,currency:_0x103d22,webhookUrl:_0x5e9738,returnUrl:_0x41759b,expiryDate:_0x1e0093}=_0x5dc11c,_0x3a1d6c=_0x103d22['toUpperCase'](),_0x4f6e15=_0xa3bd42(0x21a),_0x58ca8e='https://tesoft.uk/gateway/pending.php?id='+_0x3505bb,_0x552092={'name':_0x1ca349,'paymentDescription':_0x3a00dc,'amount':_0x5b0b64,'currency':_0x3a1d6c,'paymentId':_0x3505bb,'webhookUrl':_0x4f6e15,'returnUrl':_0x58ca8e};_0x1e0093&&(_0x552092[_0xa3bd42(0x1e9)]=_0x1e0093);const _0x5f462d=Date['now']();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0xa3bd42(0x210)](_0xa3bd42(0x225),this[_0xa3bd42(0x223)]),console['log'](_0xa3bd42(0x242),JSON[_0xa3bd42(0x23f)](_0x552092,null,0x2)),console['log'](_0xa3bd42(0x232),_0x3505bb,_0xa3bd42(0x1f1)),console[_0xa3bd42(0x210)](_0xa3bd42(0x221),_0x58ca8e),loggerService_1[_0xa3bd42(0x22a)][_0xa3bd42(0x1ff)](_0xa3bd42(0x227),_0xa3bd42(0x252),_0xa3bd42(0x218),_0x552092);const _0x21195e=await fetch(this[_0xa3bd42(0x223)],{'method':_0xa3bd42(0x218),'headers':{'Content-Type':_0xa3bd42(0x237),'Accept':_0xa3bd42(0x237),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0xa3bd42(0x23f)](_0x552092)}),_0x3a4eb8=Date[_0xa3bd42(0x251)]()-_0x5f462d;console[_0xa3bd42(0x210)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0xa3bd42(0x210)](_0xa3bd42(0x246),_0x21195e[_0xa3bd42(0x20b)]),console['log'](_0xa3bd42(0x1f8),_0x21195e[_0xa3bd42(0x209)]),console[_0xa3bd42(0x210)](_0xa3bd42(0x1f5),Object['fromEntries'](_0x21195e[_0xa3bd42(0x238)][_0xa3bd42(0x239)]())),console['log'](_0xa3bd42(0x213),_0x3a4eb8+'ms');const _0x494c32=await _0x21195e[_0xa3bd42(0x214)]();console[_0xa3bd42(0x210)]('Raw\x20Response\x20Body:',_0x494c32);if(!_0x21195e['ok']){console['error'](_0xa3bd42(0x234)),console[_0xa3bd42(0x245)](_0xa3bd42(0x1f3),_0x21195e[_0xa3bd42(0x20b)]),console['error'](_0xa3bd42(0x250),_0x494c32),loggerService_1[_0xa3bd42(0x22a)]['logWhiteDomainResponse'](_0xa3bd42(0x227),_0xa3bd42(0x252),_0x21195e[_0xa3bd42(0x20b)],_0x494c32,_0x3a4eb8),loggerService_1['loggerService'][_0xa3bd42(0x1fd)](_0xa3bd42(0x227),_0xa3bd42(0x252),_0xa3bd42(0x235)+_0x21195e[_0xa3bd42(0x20b)]+':\x20'+_0x494c32);if(_0x21195e[_0xa3bd42(0x20b)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x21195e[_0xa3bd42(0x20b)]===0x1f4)throw new Error(_0xa3bd42(0x1e0));}throw new Error(_0xa3bd42(0x1e6)+_0x21195e[_0xa3bd42(0x20b)]+_0xa3bd42(0x24a)+_0x494c32);}let _0x9bbcae;try{_0x9bbcae=JSON['parse'](_0x494c32);}catch(_0x2acede){console[_0xa3bd42(0x245)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x2acede),loggerService_1['loggerService']['logWhiteDomainError'](_0xa3bd42(0x227),_0xa3bd42(0x252),_0xa3bd42(0x21b)+_0x2acede);throw new Error(_0xa3bd42(0x1ef)+_0x494c32);}console[_0xa3bd42(0x210)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0xa3bd42(0x210)]('Parsed\x20Result:',JSON[_0xa3bd42(0x23f)](_0x9bbcae,null,0x2)),loggerService_1[_0xa3bd42(0x22a)]['logWhiteDomainResponse'](_0xa3bd42(0x227),_0xa3bd42(0x252),_0x21195e['status'],_0x9bbcae,_0x3a4eb8);if(_0x9bbcae['error']||_0x9bbcae['statusCode']){const _0x29e71e=_0x9bbcae[_0xa3bd42(0x241)]||_0x9bbcae[_0xa3bd42(0x245)]||_0xa3bd42(0x244);console[_0xa3bd42(0x245)](_0xa3bd42(0x226)),console['error']('Error\x20Message:',_0x29e71e),console['error'](_0xa3bd42(0x20a),_0x9bbcae[_0xa3bd42(0x23a)]),loggerService_1[_0xa3bd42(0x22a)][_0xa3bd42(0x1fd)](_0xa3bd42(0x227),_0xa3bd42(0x252),'Business\x20Error:\x20'+_0x29e71e);throw new Error(_0xa3bd42(0x20e)+_0x29e71e);}if(!_0x9bbcae['id']||!_0x9bbcae[_0xa3bd42(0x24b)]?.['shortLink']){console[_0xa3bd42(0x245)](_0xa3bd42(0x1e2)),console[_0xa3bd42(0x245)](_0xa3bd42(0x243)),console[_0xa3bd42(0x245)](_0xa3bd42(0x200),_0x9bbcae),loggerService_1[_0xa3bd42(0x22a)][_0xa3bd42(0x1fd)]('noda','/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0xa3bd42(0x1f2));}return console[_0xa3bd42(0x210)]('===\x20NODA\x20SUCCESS\x20==='),console[_0xa3bd42(0x210)]('Payment\x20Link\x20ID:',_0x9bbcae['id']),console[_0xa3bd42(0x210)](_0xa3bd42(0x1fc),_0x9bbcae['shortLinkUrls'][_0xa3bd42(0x24d)]),console[_0xa3bd42(0x210)](_0xa3bd42(0x230),_0x9bbcae[_0xa3bd42(0x24b)]['qrCodeLink']||'Not\x20provided'),console['log'](_0xa3bd42(0x207),_0x3505bb,_0xa3bd42(0x236)),console[_0xa3bd42(0x210)](_0xa3bd42(0x248),_0x58ca8e),{'gateway_payment_id':_0x9bbcae['id'],'payment_url':_0x9bbcae['shortLinkUrls'][_0xa3bd42(0x24d)],'qr_code_url':_0x9bbcae[_0xa3bd42(0x24b)][_0xa3bd42(0x211)],'expiry_date':_0x9bbcae['expiryDate']};}catch(_0xae42ca){console[_0xa3bd42(0x245)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0xa3bd42(0x245)]('Error\x20details:',_0xae42ca),loggerService_1[_0xa3bd42(0x22a)][_0xa3bd42(0x1fd)](_0xa3bd42(0x227),_0xa3bd42(0x252),_0xae42ca);if(_0xae42ca instanceof Error){console[_0xa3bd42(0x245)]('Error\x20message:',_0xae42ca[_0xa3bd42(0x241)]),console['error'](_0xa3bd42(0x21d),_0xae42ca['stack']);throw new Error(_0xa3bd42(0x1e5)+_0xae42ca[_0xa3bd42(0x241)]);}throw new Error(_0xa3bd42(0x222));}}async['verifyPayment'](_0x1e0b0f){const _0x227895=a43_0x53c765,_0x59cb9f=Date[_0x227895(0x251)]();try{loggerService_1[_0x227895(0x22a)][_0x227895(0x1ff)](_0x227895(0x227),_0x227895(0x1f9)+_0x1e0b0f,_0x227895(0x20c),{});const _0x32e94c=await fetch(this['apiUrl']+'/'+_0x1e0b0f,{'method':_0x227895(0x20c),'headers':{'Content-Type':_0x227895(0x237),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x482744=Date[_0x227895(0x251)]()-_0x59cb9f;if(!_0x32e94c['ok']){const _0x56cc83=await _0x32e94c['text']();loggerService_1[_0x227895(0x22a)][_0x227895(0x204)](_0x227895(0x227),_0x227895(0x1f9)+_0x1e0b0f,_0x32e94c['status'],_0x56cc83,_0x482744);throw new Error(_0x227895(0x1e6)+_0x32e94c[_0x227895(0x20b)]);}const _0x346309=await _0x32e94c[_0x227895(0x212)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x227895(0x227),_0x227895(0x1f9)+_0x1e0b0f,_0x32e94c['status'],_0x346309,_0x482744);if(_0x346309[_0x227895(0x245)]||_0x346309[_0x227895(0x23a)]){loggerService_1[_0x227895(0x22a)]['logWhiteDomainError'](_0x227895(0x227),_0x227895(0x1f9)+_0x1e0b0f,'Noda\x20API\x20error:\x20'+(_0x346309['message']||_0x346309[_0x227895(0x245)]||'Unknown\x20error'));throw new Error(_0x227895(0x20e)+(_0x346309[_0x227895(0x241)]||_0x346309[_0x227895(0x245)]||_0x227895(0x215)));}let _0x1046ee=_0x227895(0x1ec);if(_0x346309[_0x227895(0x1fe)]===![]){if(_0x346309[_0x227895(0x1e9)]){const _0x2c4865=new Date(_0x346309['expiryDate']),_0x4aae81=new Date();_0x2c4865<_0x4aae81?_0x1046ee=_0x227895(0x224):_0x1046ee='FAILED';}else _0x1046ee=_0x227895(0x20f);}else _0x1046ee=_0x227895(0x1ec);return{'status':_0x1046ee,'amount':_0x346309['amount'],'currency':_0x346309[_0x227895(0x1f0)],'isActive':_0x346309[_0x227895(0x1fe)]};}catch(_0x1db861){console[_0x227895(0x245)](_0x227895(0x23e),_0x1db861),loggerService_1['loggerService'][_0x227895(0x1fd)]('noda',_0x227895(0x1f9)+_0x1e0b0f,_0x1db861);throw new Error(_0x227895(0x216)+(_0x1db861 instanceof Error?_0x1db861[_0x227895(0x241)]:'Unknown\x20error'));}}async['processWebhook'](_0x4a90fc){const _0x2ba488=a43_0x53c765;console[_0x2ba488(0x210)](_0x2ba488(0x233),_0x4a90fc);let _0x1e0041=_0x2ba488(0x1ec);switch(_0x4a90fc[_0x2ba488(0x220)]?.[_0x2ba488(0x22f)]()){case _0x2ba488(0x206):case _0x2ba488(0x219):case _0x2ba488(0x1fa):case _0x2ba488(0x20d):case _0x2ba488(0x1e8):_0x4a90fc[_0x2ba488(0x1e1)]===_0x2ba488(0x1e4)?_0x1e0041=_0x2ba488(0x208):_0x1e0041=_0x2ba488(0x1ec);break;case'cancelled':case _0x2ba488(0x1e7):case _0x2ba488(0x1fb):case'error':case _0x2ba488(0x21e):_0x1e0041=_0x2ba488(0x20f);break;case _0x2ba488(0x1f4):case _0x2ba488(0x22e):_0x1e0041=_0x2ba488(0x224);break;case _0x2ba488(0x1ed):case _0x2ba488(0x240):case _0x2ba488(0x247):case _0x2ba488(0x1ea):case _0x2ba488(0x1ee):default:_0x1e0041=_0x2ba488(0x1ec);break;}return{'paymentId':_0x4a90fc['MerchantPaymentId']||_0x4a90fc[_0x2ba488(0x217)],'status':_0x1e0041,'amount':_0x4a90fc[_0x2ba488(0x201)],'currency':_0x4a90fc[_0x2ba488(0x21f)],'additionalInfo':{'method':_0x4a90fc[_0x2ba488(0x24e)],'bankId':_0x4a90fc[_0x2ba488(0x249)],'settled':_0x4a90fc[_0x2ba488(0x1e1)],'settlementDate':_0x4a90fc['SettlementDate'],'remitterName':_0x4a90fc[_0x2ba488(0x1eb)]?.[_0x2ba488(0x229)],'remitterIban':_0x4a90fc[_0x2ba488(0x1eb)]?.[_0x2ba488(0x24f)],'bankTransactionId':_0x4a90fc[_0x2ba488(0x205)]}};}['verifyWebhookSignature'](_0x52415e,_0x576928){const _0x3d4168=a43_0x53c765;return console[_0x3d4168(0x210)](_0x3d4168(0x22c),{'receivedSignature':_0x576928,'paymentId':_0x52415e[_0x3d4168(0x217)],'merchantPaymentId':_0x52415e['MerchantPaymentId']}),!![];}}exports[a43_0x53c765(0x203)]=NodaService;