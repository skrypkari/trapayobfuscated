'use strict';const a40_0xa8270d=a40_0x4893;(function(_0x5db8e0,_0x1ef2fc){const _0x591707=a40_0x4893,_0x2affe7=_0x5db8e0();while(!![]){try{const _0x1dc728=parseInt(_0x591707(0x1fc))/0x1+parseInt(_0x591707(0x1a4))/0x2*(parseInt(_0x591707(0x1a3))/0x3)+-parseInt(_0x591707(0x1c3))/0x4*(parseInt(_0x591707(0x1f0))/0x5)+parseInt(_0x591707(0x1bc))/0x6*(-parseInt(_0x591707(0x1b5))/0x7)+-parseInt(_0x591707(0x1ec))/0x8*(-parseInt(_0x591707(0x1f2))/0x9)+parseInt(_0x591707(0x19f))/0xa+-parseInt(_0x591707(0x1f8))/0xb*(-parseInt(_0x591707(0x1ab))/0xc);if(_0x1dc728===_0x1ef2fc)break;else _0x2affe7['push'](_0x2affe7['shift']());}catch(_0x51c5c4){_0x2affe7['push'](_0x2affe7['shift']());}}}(a40_0xb72a,0x53193));function a40_0xb72a(){const _0x4431e1=['NodaService','187QqaZgk','Status:','HTTP\x20error!\x20status:\x20','Status','19375QOfnoS','Order\x20ID\x20Format:','qrCodeLink','defineProperty','loggerService','Iban','timeout','__esModule','parse','PaymentId','Parsed\x20Result:','Error\x20details:','Error\x20Message:','/payment-links','BankId','Missing\x20id\x20or\x20shortLink\x20in\x20response','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Order\x20ID\x20Used:','createPaymentLink','Noda\x20API\x20error:\x20','toUpperCase','PENDING','Response\x20Body:','Name','shortLinkUrls','apiUrl','created','Yes','noda','Headers:','completed','/payment-links/','6316530SrHUjH','Currency','Processing\x20Noda\x20webhook:','verifyWebhookSignature','12EHjkab','13582tQVOSQ','https://tesoft.uk/gateway/noda/','Unknown\x20error\x20from\x20Noda\x20API','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','toLowerCase','now','Settled','138636SRmrhy','done','processWebhook','active','message','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Short\x20Link:','text','===\x20NODA\x20API\x20ERROR\x20===','shortLink','981379QijCEH','in_progress','HTTP\x20Status:','statusText','Response\x20Time:','processing','Error\x20stack:','24FXjXkF','Business\x20Error:\x20','Amount','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','statusCode','status','application/json','1964jyUxwS','Status\x20Text:','pending','expiryDate','===\x20NODA\x20SUCCESS\x20===','https://tesoft.uk/gateway/pending.php?id=','Failed\x20to\x20parse\x20JSON\x20response:','BankTransactionId','Remitter','MerchantPaymentId','logWhiteDomainRequest','canceled','Response\x20data:','fromEntries','rejected','../loggerService','Unknown\x20error','logWhiteDomainError','Method','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','GET','POST','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','FAILED','TesSoft\x20Payment\x20System/1.0','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Raw\x20Response\x20Body:','error','isActive','Noda\x20payment\x20verification\x20error:','stack','Status\x20Code:','EXPIRED','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','(8digits-8digits\x20format\x20for\x20Noda)','Noda\x20webhook\x20signature\x20verification:','logWhiteDomainResponse','amount','paid','expired','stringify','176SOZHEP','log','verifyPayment','cancelled','6450gDJzks','===\x20NODA\x20SERVICE\x20ERROR\x20===','269982MooLHT','URL:','headers','QR\x20Code\x20Link:','HTTP\x20'];a40_0xb72a=function(){return _0x4431e1;};return a40_0xb72a();}function a40_0x4893(_0x5186c6,_0x24005a){const _0xb72a94=a40_0xb72a();return a40_0x4893=function(_0x48938f,_0x227263){_0x48938f=_0x48938f-0x198;let _0x1dec5d=_0xb72a94[_0x48938f];return _0x1dec5d;},a40_0x4893(_0x5186c6,_0x24005a);}Object[a40_0xa8270d(0x1ff)](exports,a40_0xa8270d(0x203),{'value':!![]}),exports[a40_0xa8270d(0x1f7)]=void 0x0;const loggerService_1=require(a40_0xa8270d(0x1d2));class NodaService{constructor(){const _0x384201=a40_0xa8270d;this[_0x384201(0x198)]=_0x384201(0x1a5),console[_0x384201(0x1ed)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a40_0xa8270d(0x20e)](_0x4962bd){const _0x20b919=a40_0xa8270d,{orderId:_0xce1e79,name:_0x3ed882,paymentDescription:_0x4c681b,amount:_0x14fdea,currency:_0x373577,webhookUrl:_0x589451,returnUrl:_0x1c277f,expiryDate:_0x25a1fb}=_0x4962bd,_0x25d95c=_0x373577[_0x20b919(0x210)](),_0x849dd2='https://tesoft.uk/gateway/noda/webhook/',_0x4cfd85=_0x20b919(0x1c8)+_0xce1e79,_0x3a56df={'name':_0x3ed882,'paymentDescription':_0x4c681b,'amount':_0x14fdea,'currency':_0x25d95c,'paymentId':_0xce1e79,'webhookUrl':_0x849dd2,'returnUrl':_0x4cfd85};_0x25a1fb&&(_0x3a56df[_0x20b919(0x1c6)]=_0x25a1fb);const _0xacaee3=Date[_0x20b919(0x1a9)]();try{console['log'](_0x20b919(0x1e4)),console[_0x20b919(0x1ed)](_0x20b919(0x1f3),this[_0x20b919(0x198)]),console[_0x20b919(0x1ed)]('Request\x20Body\x20(Direct\x20JSON):',JSON['stringify'](_0x3a56df,null,0x2)),console[_0x20b919(0x1ed)](_0x20b919(0x1fd),_0xce1e79,_0x20b919(0x1e5)),console[_0x20b919(0x1ed)](_0x20b919(0x1dc),_0x4cfd85),loggerService_1[_0x20b919(0x200)]['logWhiteDomainRequest'](_0x20b919(0x19b),_0x20b919(0x209),_0x20b919(0x1d8),_0x3a56df);const _0x43fff5=await fetch(this['apiUrl'],{'method':_0x20b919(0x1d8),'headers':{'Content-Type':_0x20b919(0x1c2),'Accept':_0x20b919(0x1c2),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x20b919(0x1eb)](_0x3a56df)}),_0x8c8641=Date[_0x20b919(0x1a9)]()-_0xacaee3;console[_0x20b919(0x1ed)](_0x20b919(0x1d9)),console[_0x20b919(0x1ed)](_0x20b919(0x1f9),_0x43fff5[_0x20b919(0x1c1)]),console['log'](_0x20b919(0x1c4),_0x43fff5[_0x20b919(0x1b8)]),console[_0x20b919(0x1ed)](_0x20b919(0x19c),Object[_0x20b919(0x1d0)](_0x43fff5[_0x20b919(0x1f4)]['entries']())),console[_0x20b919(0x1ed)](_0x20b919(0x1b9),_0x8c8641+'ms');const _0x4a9b88=await _0x43fff5[_0x20b919(0x1b2)]();console['log'](_0x20b919(0x1dd),_0x4a9b88);if(!_0x43fff5['ok']){console[_0x20b919(0x1de)](_0x20b919(0x1b3)),console['error'](_0x20b919(0x1b7),_0x43fff5['status']),console[_0x20b919(0x1de)](_0x20b919(0x212),_0x4a9b88),loggerService_1[_0x20b919(0x200)][_0x20b919(0x1e7)](_0x20b919(0x19b),_0x20b919(0x209),_0x43fff5[_0x20b919(0x1c1)],_0x4a9b88,_0x8c8641),loggerService_1[_0x20b919(0x200)][_0x20b919(0x1d4)]('noda','/payment-links',_0x20b919(0x1f6)+_0x43fff5[_0x20b919(0x1c1)]+':\x20'+_0x4a9b88);if(_0x43fff5[_0x20b919(0x1c1)]===0x190)throw new Error(_0x20b919(0x1a7));else{if(_0x43fff5['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error('HTTP\x20error!\x20status:\x20'+_0x43fff5[_0x20b919(0x1c1)]+',\x20body:\x20'+_0x4a9b88);}let _0x40623b;try{_0x40623b=JSON[_0x20b919(0x204)](_0x4a9b88);}catch(_0x5187fa){console[_0x20b919(0x1de)](_0x20b919(0x1c9),_0x5187fa),loggerService_1[_0x20b919(0x200)][_0x20b919(0x1d4)](_0x20b919(0x19b),'/payment-links','JSON\x20Parse\x20Error:\x20'+_0x5187fa);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x4a9b88);}console[_0x20b919(0x1ed)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console['log'](_0x20b919(0x206),JSON['stringify'](_0x40623b,null,0x2)),loggerService_1[_0x20b919(0x200)][_0x20b919(0x1e7)](_0x20b919(0x19b),_0x20b919(0x209),_0x43fff5['status'],_0x40623b,_0x8c8641);if(_0x40623b[_0x20b919(0x1de)]||_0x40623b[_0x20b919(0x1c0)]){const _0xb0afe5=_0x40623b['message']||_0x40623b[_0x20b919(0x1de)]||_0x20b919(0x1a6);console['error'](_0x20b919(0x20c)),console[_0x20b919(0x1de)](_0x20b919(0x208),_0xb0afe5),console[_0x20b919(0x1de)](_0x20b919(0x1e2),_0x40623b[_0x20b919(0x1c0)]),loggerService_1['loggerService'][_0x20b919(0x1d4)](_0x20b919(0x19b),'/payment-links',_0x20b919(0x1bd)+_0xb0afe5);throw new Error(_0x20b919(0x20f)+_0xb0afe5);}if(!_0x40623b['id']||!_0x40623b[_0x20b919(0x214)]?.[_0x20b919(0x1b4)]){console[_0x20b919(0x1de)](_0x20b919(0x1bf)),console[_0x20b919(0x1de)](_0x20b919(0x20b)),console[_0x20b919(0x1de)](_0x20b919(0x1cf),_0x40623b),loggerService_1[_0x20b919(0x200)][_0x20b919(0x1d4)](_0x20b919(0x19b),_0x20b919(0x209),_0x20b919(0x1b0));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x20b919(0x1ed)](_0x20b919(0x1c7)),console[_0x20b919(0x1ed)]('Payment\x20Link\x20ID:',_0x40623b['id']),console[_0x20b919(0x1ed)](_0x20b919(0x1b1),_0x40623b[_0x20b919(0x214)]['shortLink']),console[_0x20b919(0x1ed)](_0x20b919(0x1f5),_0x40623b[_0x20b919(0x214)][_0x20b919(0x1fe)]||'Not\x20provided'),console[_0x20b919(0x1ed)](_0x20b919(0x20d),_0xce1e79,'(8digits-8digits\x20format)'),console[_0x20b919(0x1ed)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x4cfd85),{'gateway_payment_id':_0x40623b['id'],'payment_url':_0x40623b[_0x20b919(0x214)]['shortLink'],'qr_code_url':_0x40623b[_0x20b919(0x214)][_0x20b919(0x1fe)],'expiry_date':_0x40623b[_0x20b919(0x1c6)]};}catch(_0x5ab11a){console[_0x20b919(0x1de)](_0x20b919(0x1f1)),console['error'](_0x20b919(0x207),_0x5ab11a),loggerService_1[_0x20b919(0x200)][_0x20b919(0x1d4)](_0x20b919(0x19b),_0x20b919(0x209),_0x5ab11a);if(_0x5ab11a instanceof Error){console[_0x20b919(0x1de)]('Error\x20message:',_0x5ab11a[_0x20b919(0x1af)]),console['error'](_0x20b919(0x1bb),_0x5ab11a[_0x20b919(0x1e1)]);throw new Error(_0x20b919(0x1d6)+_0x5ab11a['message']);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0xa8270d(0x1ee)](_0x2ef419){const _0x39c304=a40_0xa8270d,_0x21a463=Date[_0x39c304(0x1a9)]();try{loggerService_1['loggerService'][_0x39c304(0x1cd)](_0x39c304(0x19b),_0x39c304(0x19e)+_0x2ef419,_0x39c304(0x1d7),{});const _0x543409=await fetch(this['apiUrl']+'/'+_0x2ef419,{'method':_0x39c304(0x1d7),'headers':{'Content-Type':_0x39c304(0x1c2),'User-Agent':_0x39c304(0x1db)}}),_0x25939b=Date[_0x39c304(0x1a9)]()-_0x21a463;if(!_0x543409['ok']){const _0x5d9c04=await _0x543409[_0x39c304(0x1b2)]();loggerService_1[_0x39c304(0x200)][_0x39c304(0x1e7)]('noda',_0x39c304(0x19e)+_0x2ef419,_0x543409[_0x39c304(0x1c1)],_0x5d9c04,_0x25939b);throw new Error(_0x39c304(0x1fa)+_0x543409[_0x39c304(0x1c1)]);}const _0x55081c=await _0x543409['json']();loggerService_1[_0x39c304(0x200)][_0x39c304(0x1e7)](_0x39c304(0x19b),_0x39c304(0x19e)+_0x2ef419,_0x543409[_0x39c304(0x1c1)],_0x55081c,_0x25939b);if(_0x55081c[_0x39c304(0x1de)]||_0x55081c['statusCode']){loggerService_1[_0x39c304(0x200)]['logWhiteDomainError'](_0x39c304(0x19b),'/payment-links/'+_0x2ef419,_0x39c304(0x20f)+(_0x55081c[_0x39c304(0x1af)]||_0x55081c[_0x39c304(0x1de)]||_0x39c304(0x1d3)));throw new Error(_0x39c304(0x20f)+(_0x55081c[_0x39c304(0x1af)]||_0x55081c['error']||_0x39c304(0x1d3)));}let _0x548ae7=_0x39c304(0x211);if(_0x55081c[_0x39c304(0x1df)]===![]){if(_0x55081c[_0x39c304(0x1c6)]){const _0x28fb17=new Date(_0x55081c[_0x39c304(0x1c6)]),_0x5b7364=new Date();_0x28fb17<_0x5b7364?_0x548ae7=_0x39c304(0x1e3):_0x548ae7=_0x39c304(0x1da);}else _0x548ae7='FAILED';}else _0x548ae7='PENDING';return{'status':_0x548ae7,'amount':_0x55081c[_0x39c304(0x1e8)],'currency':_0x55081c['currency'],'isActive':_0x55081c['isActive']};}catch(_0x5affdf){console[_0x39c304(0x1de)](_0x39c304(0x1e0),_0x5affdf),loggerService_1[_0x39c304(0x200)][_0x39c304(0x1d4)](_0x39c304(0x19b),_0x39c304(0x19e)+_0x2ef419,_0x5affdf);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x5affdf instanceof Error?_0x5affdf[_0x39c304(0x1af)]:_0x39c304(0x1d3)));}}async[a40_0xa8270d(0x1ad)](_0x3f3838){const _0x29a9c2=a40_0xa8270d;console['log'](_0x29a9c2(0x1a1),_0x3f3838);let _0xfea6b9='PENDING';switch(_0x3f3838[_0x29a9c2(0x1fb)]?.[_0x29a9c2(0x1a8)]()){case _0x29a9c2(0x1ac):case _0x29a9c2(0x19d):case _0x29a9c2(0x1e9):case'success':case'successful':_0x3f3838[_0x29a9c2(0x1aa)]===_0x29a9c2(0x19a)?_0xfea6b9='PAID':_0xfea6b9=_0x29a9c2(0x211);break;case _0x29a9c2(0x1ef):case _0x29a9c2(0x1ce):case'failed':case'error':case _0x29a9c2(0x1d1):_0xfea6b9='FAILED';break;case _0x29a9c2(0x1ea):case _0x29a9c2(0x202):_0xfea6b9=_0x29a9c2(0x1e3);break;case _0x29a9c2(0x1c5):case _0x29a9c2(0x199):case _0x29a9c2(0x1ae):case _0x29a9c2(0x1ba):case _0x29a9c2(0x1b6):default:_0xfea6b9=_0x29a9c2(0x211);break;}return{'paymentId':_0x3f3838['MerchantPaymentId']||_0x3f3838[_0x29a9c2(0x205)],'status':_0xfea6b9,'amount':_0x3f3838[_0x29a9c2(0x1be)],'currency':_0x3f3838[_0x29a9c2(0x1a0)],'additionalInfo':{'method':_0x3f3838[_0x29a9c2(0x1d5)],'bankId':_0x3f3838[_0x29a9c2(0x20a)],'settled':_0x3f3838[_0x29a9c2(0x1aa)],'settlementDate':_0x3f3838['SettlementDate'],'remitterName':_0x3f3838['Remitter']?.[_0x29a9c2(0x213)],'remitterIban':_0x3f3838[_0x29a9c2(0x1cb)]?.[_0x29a9c2(0x201)],'bankTransactionId':_0x3f3838[_0x29a9c2(0x1ca)]}};}[a40_0xa8270d(0x1a2)](_0xe8d368,_0x233cc7){const _0x59a79b=a40_0xa8270d;return console[_0x59a79b(0x1ed)](_0x59a79b(0x1e6),{'receivedSignature':_0x233cc7,'paymentId':_0xe8d368[_0x59a79b(0x205)],'merchantPaymentId':_0xe8d368[_0x59a79b(0x1cc)]}),!![];}}exports['NodaService']=NodaService;