'use strict';const a46_0x2e3605=a46_0x2064;function a46_0x5e9e(){const _0xc1e658=['Noda\x20payment\x20verification\x20error:','SettlementDate','Parsed\x20Result:','280864uFqgPt','Processing\x20Noda\x20webhook:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','PAID','POST','pending','Remitter','FAILED','Order\x20ID\x20Format:','in_progress','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','9490833gZqyet','text','toLowerCase','GET','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Amount','Unknown\x20error\x20from\x20Noda\x20API','logWhiteDomainRequest','Noda\x20webhook\x20signature\x20verification:','Order\x20ID\x20Used:','statusCode','apiUrl','statusText','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','__esModule','now','shortLink','Raw\x20Response\x20Body:','application/json','defineProperty','Error\x20Message:','Error\x20details:','37709XiVenC','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Not\x20provided','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Response\x20data:','done','toUpperCase','loggerService','entries','fromEntries','/payment-links','../loggerService','Error\x20message:','PENDING','Request\x20Body\x20(Direct\x20JSON):','Headers:','1635132OHTYTG','1825180BOwkhH','680VapVIa','logWhiteDomainResponse','745862Elkkgy','noda','stack','logWhiteDomainError','Iban','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Unknown\x20error','===\x20NODA\x20SERVICE\x20ERROR\x20===','MerchantPaymentId','HTTP\x20error!\x20status:\x20','Error\x20stack:','URL:','Business\x20Error:\x20','EXPIRED','currency','HTTP\x20','Failed\x20to\x20parse\x20JSON\x20response:','error','expiryDate','stringify','Method','3tuCtnF','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','BankId','status','parse','Settled','Name','186532eEkHSt','(8digits-8digits\x20format)','BankTransactionId','json','processWebhook','isActive','PaymentId','/payment-links/','created','expired','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','active','https://tesoft.uk/gateway/noda/webhook/','qrCodeLink','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Noda\x20API\x20error:\x20','QR\x20Code\x20Link:','log','Missing\x20id\x20or\x20shortLink\x20in\x20response','Status','verifyWebhookSignature','(8digits-8digits\x20format\x20for\x20Noda)','message','JSON\x20Parse\x20Error:\x20','processing','verifyPayment','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Payment\x20Link\x20ID:','Status\x20Text:','TesSoft\x20Payment\x20System/1.0','shortLinkUrls','HTTP\x20Status:','success','cancelled','timeout','NodaService','Currency'];a46_0x5e9e=function(){return _0xc1e658;};return a46_0x5e9e();}(function(_0x43d289,_0x4df7cd){const _0xfb837f=a46_0x2064,_0x306bff=_0x43d289();while(!![]){try{const _0x6fe7cb=parseInt(_0xfb837f(0x1a6))/0x1+parseInt(_0xfb837f(0x1c3))/0x2*(parseInt(_0xfb837f(0x1bc))/0x3)+parseInt(_0xfb837f(0x16f))/0x4+parseInt(_0xfb837f(0x1a3))/0x5+-parseInt(_0xfb837f(0x1a2))/0x6+-parseInt(_0xfb837f(0x192))/0x7*(-parseInt(_0xfb837f(0x1a4))/0x8)+-parseInt(_0xfb837f(0x17c))/0x9;if(_0x6fe7cb===_0x4df7cd)break;else _0x306bff['push'](_0x306bff['shift']());}catch(_0x15a803){_0x306bff['push'](_0x306bff['shift']());}}}(a46_0x5e9e,0x62ee0));Object[a46_0x2e3605(0x18f)](exports,a46_0x2e3605(0x18a),{'value':!![]}),exports[a46_0x2e3605(0x16a)]=void 0x0;const loggerService_1=require(a46_0x2e3605(0x19d));function a46_0x2064(_0x18742a,_0x116dd4){const _0x5e9e53=a46_0x5e9e();return a46_0x2064=function(_0x2064b6,_0x3193c0){_0x2064b6=_0x2064b6-0x15e;let _0x3bf7e1=_0x5e9e53[_0x2064b6];return _0x3bf7e1;},a46_0x2064(_0x18742a,_0x116dd4);}class NodaService{constructor(){const _0x1d0f03=a46_0x2e3605;this[_0x1d0f03(0x187)]='https://tesoft.uk/gateway/noda/',console['log'](_0x1d0f03(0x180));}async['createPaymentLink'](_0xbe9793){const _0x16e039=a46_0x2e3605,{orderId:_0x1a70f0,name:_0x2fda5e,paymentDescription:_0x531e61,amount:_0x51439d,currency:_0x5905d6,webhookUrl:_0x2e694c,returnUrl:_0x5eedb7,expiryDate:_0x31a350}=_0xbe9793,_0x3652d9=_0x5905d6[_0x16e039(0x198)](),_0x303f7d=_0x16e039(0x1cf),_0x1117da='https://tesoft.uk/gateway/pending.php?id='+_0x1a70f0,_0x296991={'name':_0x2fda5e,'paymentDescription':_0x531e61,'amount':_0x51439d,'currency':_0x3652d9,'paymentId':_0x1a70f0,'webhookUrl':_0x303f7d,'returnUrl':_0x1117da};_0x31a350&&(_0x296991[_0x16e039(0x1b9)]=_0x31a350);const _0x39524=Date[_0x16e039(0x18b)]();try{console[_0x16e039(0x1d4)](_0x16e039(0x1ab)),console['log'](_0x16e039(0x1b2),this['apiUrl']),console[_0x16e039(0x1d4)](_0x16e039(0x1a0),JSON['stringify'](_0x296991,null,0x2)),console[_0x16e039(0x1d4)](_0x16e039(0x179),_0x1a70f0,_0x16e039(0x1d8)),console[_0x16e039(0x1d4)](_0x16e039(0x172),_0x1117da),loggerService_1[_0x16e039(0x199)][_0x16e039(0x183)](_0x16e039(0x1a7),_0x16e039(0x19c),_0x16e039(0x175),_0x296991);const _0x588f56=await fetch(this[_0x16e039(0x187)],{'method':_0x16e039(0x175),'headers':{'Content-Type':_0x16e039(0x18e),'Accept':_0x16e039(0x18e),'User-Agent':_0x16e039(0x164)},'body':JSON['stringify'](_0x296991)}),_0x12a092=Date['now']()-_0x39524;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x16e039(0x1d4)]('Status:',_0x588f56[_0x16e039(0x1bf)]),console[_0x16e039(0x1d4)](_0x16e039(0x163),_0x588f56[_0x16e039(0x188)]),console[_0x16e039(0x1d4)](_0x16e039(0x1a1),Object[_0x16e039(0x19b)](_0x588f56['headers'][_0x16e039(0x19a)]())),console['log']('Response\x20Time:',_0x12a092+'ms');const _0xfd685f=await _0x588f56[_0x16e039(0x17d)]();console[_0x16e039(0x1d4)](_0x16e039(0x18d),_0xfd685f);if(!_0x588f56['ok']){console[_0x16e039(0x1b8)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x16e039(0x1b8)](_0x16e039(0x166),_0x588f56['status']),console['error']('Response\x20Body:',_0xfd685f),loggerService_1[_0x16e039(0x199)][_0x16e039(0x1a5)](_0x16e039(0x1a7),_0x16e039(0x19c),_0x588f56[_0x16e039(0x1bf)],_0xfd685f,_0x12a092),loggerService_1['loggerService'][_0x16e039(0x1a9)]('noda','/payment-links',_0x16e039(0x1b6)+_0x588f56[_0x16e039(0x1bf)]+':\x20'+_0xfd685f);if(_0x588f56[_0x16e039(0x1bf)]===0x190)throw new Error(_0x16e039(0x1ac));else{if(_0x588f56[_0x16e039(0x1bf)]===0x1f4)throw new Error(_0x16e039(0x193));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x588f56[_0x16e039(0x1bf)]+',\x20body:\x20'+_0xfd685f);}let _0x2787de;try{_0x2787de=JSON[_0x16e039(0x1c0)](_0xfd685f);}catch(_0x192780){console[_0x16e039(0x1b8)](_0x16e039(0x1b7),_0x192780),loggerService_1[_0x16e039(0x199)][_0x16e039(0x1a9)](_0x16e039(0x1a7),_0x16e039(0x19c),_0x16e039(0x15e)+_0x192780);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0xfd685f);}console[_0x16e039(0x1d4)](_0x16e039(0x173)),console['log'](_0x16e039(0x16e),JSON[_0x16e039(0x1ba)](_0x2787de,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0x16e039(0x19c),_0x588f56[_0x16e039(0x1bf)],_0x2787de,_0x12a092);if(_0x2787de[_0x16e039(0x1b8)]||_0x2787de[_0x16e039(0x186)]){const _0x1946f0=_0x2787de['message']||_0x2787de[_0x16e039(0x1b8)]||_0x16e039(0x182);console[_0x16e039(0x1b8)](_0x16e039(0x1d1)),console['error'](_0x16e039(0x190),_0x1946f0),console[_0x16e039(0x1b8)]('Status\x20Code:',_0x2787de['statusCode']),loggerService_1[_0x16e039(0x199)][_0x16e039(0x1a9)](_0x16e039(0x1a7),'/payment-links',_0x16e039(0x1b3)+_0x1946f0);throw new Error(_0x16e039(0x1d2)+_0x1946f0);}if(!_0x2787de['id']||!_0x2787de[_0x16e039(0x165)]?.[_0x16e039(0x18c)]){console[_0x16e039(0x1b8)](_0x16e039(0x17b)),console[_0x16e039(0x1b8)](_0x16e039(0x1d5)),console[_0x16e039(0x1b8)](_0x16e039(0x196),_0x2787de),loggerService_1[_0x16e039(0x199)][_0x16e039(0x1a9)](_0x16e039(0x1a7),_0x16e039(0x19c),_0x16e039(0x195));throw new Error(_0x16e039(0x1cd));}return console[_0x16e039(0x1d4)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x16e039(0x1d4)](_0x16e039(0x162),_0x2787de['id']),console[_0x16e039(0x1d4)]('Short\x20Link:',_0x2787de[_0x16e039(0x165)][_0x16e039(0x18c)]),console[_0x16e039(0x1d4)](_0x16e039(0x1d3),_0x2787de[_0x16e039(0x165)]['qrCodeLink']||_0x16e039(0x194)),console[_0x16e039(0x1d4)](_0x16e039(0x185),_0x1a70f0,_0x16e039(0x1c4)),console[_0x16e039(0x1d4)](_0x16e039(0x171),_0x1117da),{'gateway_payment_id':_0x2787de['id'],'payment_url':_0x2787de['shortLinkUrls'][_0x16e039(0x18c)],'qr_code_url':_0x2787de[_0x16e039(0x165)][_0x16e039(0x1d0)],'expiry_date':_0x2787de['expiryDate']};}catch(_0x2b49c3){console[_0x16e039(0x1b8)](_0x16e039(0x1ae)),console[_0x16e039(0x1b8)](_0x16e039(0x191),_0x2b49c3),loggerService_1[_0x16e039(0x199)][_0x16e039(0x1a9)](_0x16e039(0x1a7),_0x16e039(0x19c),_0x2b49c3);if(_0x2b49c3 instanceof Error){console[_0x16e039(0x1b8)](_0x16e039(0x19e),_0x2b49c3['message']),console['error'](_0x16e039(0x1b1),_0x2b49c3[_0x16e039(0x1a8)]);throw new Error(_0x16e039(0x1bd)+_0x2b49c3[_0x16e039(0x1d9)]);}throw new Error(_0x16e039(0x189));}}async[a46_0x2e3605(0x160)](_0x537069){const _0x4a4b97=a46_0x2e3605,_0x511ea8=Date[_0x4a4b97(0x18b)]();try{loggerService_1[_0x4a4b97(0x199)]['logWhiteDomainRequest']('noda',_0x4a4b97(0x1ca)+_0x537069,'GET',{});const _0x528623=await fetch(this['apiUrl']+'/'+_0x537069,{'method':_0x4a4b97(0x17f),'headers':{'Content-Type':'application/json','User-Agent':_0x4a4b97(0x164)}}),_0x253755=Date[_0x4a4b97(0x18b)]()-_0x511ea8;if(!_0x528623['ok']){const _0x224f72=await _0x528623[_0x4a4b97(0x17d)]();loggerService_1[_0x4a4b97(0x199)][_0x4a4b97(0x1a5)](_0x4a4b97(0x1a7),_0x4a4b97(0x1ca)+_0x537069,_0x528623['status'],_0x224f72,_0x253755);throw new Error(_0x4a4b97(0x1b0)+_0x528623[_0x4a4b97(0x1bf)]);}const _0x4db95f=await _0x528623[_0x4a4b97(0x1c6)]();loggerService_1[_0x4a4b97(0x199)][_0x4a4b97(0x1a5)]('noda',_0x4a4b97(0x1ca)+_0x537069,_0x528623[_0x4a4b97(0x1bf)],_0x4db95f,_0x253755);if(_0x4db95f['error']||_0x4db95f[_0x4a4b97(0x186)]){loggerService_1[_0x4a4b97(0x199)][_0x4a4b97(0x1a9)](_0x4a4b97(0x1a7),_0x4a4b97(0x1ca)+_0x537069,_0x4a4b97(0x1d2)+(_0x4db95f[_0x4a4b97(0x1d9)]||_0x4db95f[_0x4a4b97(0x1b8)]||_0x4a4b97(0x1ad)));throw new Error(_0x4a4b97(0x1d2)+(_0x4db95f[_0x4a4b97(0x1d9)]||_0x4db95f[_0x4a4b97(0x1b8)]||'Unknown\x20error'));}let _0x1eb4f5=_0x4a4b97(0x19f);if(_0x4db95f[_0x4a4b97(0x1c8)]===![]){if(_0x4db95f[_0x4a4b97(0x1b9)]){const _0x3703fd=new Date(_0x4db95f['expiryDate']),_0x4eca71=new Date();_0x3703fd<_0x4eca71?_0x1eb4f5=_0x4a4b97(0x1b4):_0x1eb4f5=_0x4a4b97(0x178);}else _0x1eb4f5='FAILED';}else _0x1eb4f5=_0x4a4b97(0x19f);return{'status':_0x1eb4f5,'amount':_0x4db95f['amount'],'currency':_0x4db95f[_0x4a4b97(0x1b5)],'isActive':_0x4db95f['isActive']};}catch(_0x34387f){console[_0x4a4b97(0x1b8)](_0x4a4b97(0x16c),_0x34387f),loggerService_1[_0x4a4b97(0x199)][_0x4a4b97(0x1a9)](_0x4a4b97(0x1a7),'/payment-links/'+_0x537069,_0x34387f);throw new Error(_0x4a4b97(0x161)+(_0x34387f instanceof Error?_0x34387f[_0x4a4b97(0x1d9)]:_0x4a4b97(0x1ad)));}}async[a46_0x2e3605(0x1c7)](_0x139a31){const _0x503802=a46_0x2e3605;console['log'](_0x503802(0x170),_0x139a31);let _0x57ebb1=_0x503802(0x19f);switch(_0x139a31[_0x503802(0x1d6)]?.[_0x503802(0x17e)]()){case _0x503802(0x197):case'completed':case'paid':case _0x503802(0x167):case'successful':_0x139a31[_0x503802(0x1c1)]==='Yes'?_0x57ebb1=_0x503802(0x174):_0x57ebb1=_0x503802(0x19f);break;case _0x503802(0x168):case'canceled':case'failed':case _0x503802(0x1b8):case'rejected':_0x57ebb1=_0x503802(0x178);break;case _0x503802(0x1cc):case _0x503802(0x169):_0x57ebb1=_0x503802(0x1b4);break;case _0x503802(0x176):case _0x503802(0x1cb):case _0x503802(0x1ce):case _0x503802(0x15f):case _0x503802(0x17a):default:_0x57ebb1=_0x503802(0x19f);break;}return{'paymentId':_0x139a31[_0x503802(0x1af)]||_0x139a31[_0x503802(0x1c9)],'status':_0x57ebb1,'amount':_0x139a31[_0x503802(0x181)],'currency':_0x139a31[_0x503802(0x16b)],'additionalInfo':{'method':_0x139a31[_0x503802(0x1bb)],'bankId':_0x139a31[_0x503802(0x1be)],'settled':_0x139a31[_0x503802(0x1c1)],'settlementDate':_0x139a31[_0x503802(0x16d)],'remitterName':_0x139a31[_0x503802(0x177)]?.[_0x503802(0x1c2)],'remitterIban':_0x139a31[_0x503802(0x177)]?.[_0x503802(0x1aa)],'bankTransactionId':_0x139a31[_0x503802(0x1c5)]}};}[a46_0x2e3605(0x1d7)](_0x2f2e32,_0x875fe0){const _0x177ef0=a46_0x2e3605;return console[_0x177ef0(0x1d4)](_0x177ef0(0x184),{'receivedSignature':_0x875fe0,'paymentId':_0x2f2e32[_0x177ef0(0x1c9)],'merchantPaymentId':_0x2f2e32[_0x177ef0(0x1af)]}),!![];}}exports['NodaService']=NodaService;