'use strict';function a46_0x4844(_0x19ee83,_0x580591){const _0x33969d=a46_0x3396();return a46_0x4844=function(_0x484451,_0x2dc014){_0x484451=_0x484451-0x1dc;let _0x56c495=_0x33969d[_0x484451];return _0x56c495;},a46_0x4844(_0x19ee83,_0x580591);}const a46_0x37f170=a46_0x4844;(function(_0x325224,_0x449f68){const _0x131e24=a46_0x4844,_0x21ecc0=_0x325224();while(!![]){try{const _0x36fd4f=-parseInt(_0x131e24(0x214))/0x1*(-parseInt(_0x131e24(0x1f6))/0x2)+-parseInt(_0x131e24(0x211))/0x3+parseInt(_0x131e24(0x249))/0x4*(-parseInt(_0x131e24(0x22b))/0x5)+parseInt(_0x131e24(0x1fc))/0x6+parseInt(_0x131e24(0x20d))/0x7*(-parseInt(_0x131e24(0x23f))/0x8)+parseInt(_0x131e24(0x1ec))/0x9*(-parseInt(_0x131e24(0x257))/0xa)+-parseInt(_0x131e24(0x203))/0xb*(-parseInt(_0x131e24(0x24e))/0xc);if(_0x36fd4f===_0x449f68)break;else _0x21ecc0['push'](_0x21ecc0['shift']());}catch(_0x586780){_0x21ecc0['push'](_0x21ecc0['shift']());}}}(a46_0x3396,0xb6769));function a46_0x3396(){const _0x43c10b=['completed','createPaymentLink','Noda\x20API\x20error:\x20','Order\x20ID\x20Format:','Failed\x20to\x20parse\x20JSON\x20response:','2syMBWk','logWhiteDomainError','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','POST','Request\x20Body\x20(Direct\x20JSON):',',\x20body:\x20','2210556NHBzzK','fromEntries','HTTP\x20','cancelled','amount','Noda\x20webhook\x20signature\x20verification:','successful','4694569gkIbFZ','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','HTTP\x20Status:','statusCode','active','json','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','text','processWebhook','status','7kopirS','processing','Method','application/json','4006233KishOv','Status','===\x20NODA\x20API\x20ERROR\x20===','823946KgcILb','paid','PENDING','Parsed\x20Result:','done','timeout','PAID','Error\x20stack:','stack','QR\x20Code\x20Link:','toUpperCase','now','verifyWebhookSignature','MerchantPaymentId','isActive','Response\x20Time:','stringify','https://tesoft.uk/gateway/noda/webhook/','BankTransactionId','SettlementDate','error','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','../loggerService','555025CYbJJO','Processing\x20Noda\x20webhook:','EXPIRED','PaymentId','GET','URL:','shortLink','Status:','logWhiteDomainRequest','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','qrCodeLink','in_progress','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Noda\x20payment\x20verification\x20error:','headers','toLowerCase','Short\x20Link:','verifyPayment','===\x20NODA\x20SERVICE\x20ERROR\x20===','Unknown\x20error','5250360cFHfNZ','Error\x20details:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','apiUrl','FAILED','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','/payment-links/','loggerService','message','entries','4uFTxZv','rejected','Yes','Currency','Response\x20data:','60gBncWY','Amount','canceled','/payment-links','Headers:','(8digits-8digits\x20format)','created','expiryDate','https://tesoft.uk/gateway/pending.php?id=','1587290ihDHsa','Response\x20Body:','Payment\x20Link\x20ID:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','statusText','Order\x20ID\x20Used:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Remitter','https://tesoft.uk/gateway/noda/','Error\x20message:','NodaService','JSON\x20Parse\x20Error:\x20','parse','HTTP\x20error!\x20status:\x20','Status\x20Code:','__esModule','Settled','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Iban','logWhiteDomainResponse','TesSoft\x20Payment\x20System/1.0','log','Name','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','noda','27OEhlnX','defineProperty','currency','shortLinkUrls','===\x20NODA\x20SUCCESS\x20==='];a46_0x3396=function(){return _0x43c10b;};return a46_0x3396();}Object[a46_0x37f170(0x1ed)](exports,a46_0x37f170(0x1e2),{'value':!![]}),exports[a46_0x37f170(0x1dd)]=void 0x0;const loggerService_1=require(a46_0x37f170(0x22a));class NodaService{constructor(){const _0x49a89a=a46_0x37f170;this[_0x49a89a(0x242)]=_0x49a89a(0x25f),console[_0x49a89a(0x1e8)](_0x49a89a(0x25d));}async[a46_0x37f170(0x1f2)](_0x344ac8){const _0x54c6f9=a46_0x37f170,{orderId:_0x4668fc,name:_0x1b47cc,paymentDescription:_0x282fd6,amount:_0x3b6dfa,currency:_0x5b4182,webhookUrl:_0xb703d1,returnUrl:_0x1eddcb,expiryDate:_0x58aa91}=_0x344ac8,_0x2860c2=_0x5b4182[_0x54c6f9(0x21e)](),_0x54fe3d=_0x54c6f9(0x225),_0x19ffd7=_0x54c6f9(0x256)+_0x4668fc,_0x1ce3cc={'name':_0x1b47cc,'paymentDescription':_0x282fd6,'amount':_0x3b6dfa,'currency':_0x2860c2,'paymentId':_0x4668fc,'webhookUrl':_0x54fe3d,'returnUrl':_0x19ffd7};_0x58aa91&&(_0x1ce3cc[_0x54c6f9(0x255)]=_0x58aa91);const _0x13d534=Date[_0x54c6f9(0x21f)]();try{console[_0x54c6f9(0x1e8)](_0x54c6f9(0x244)),console['log'](_0x54c6f9(0x230),this[_0x54c6f9(0x242)]),console[_0x54c6f9(0x1e8)](_0x54c6f9(0x1fa),JSON['stringify'](_0x1ce3cc,null,0x2)),console[_0x54c6f9(0x1e8)](_0x54c6f9(0x1f4),_0x4668fc,'(8digits-8digits\x20format\x20for\x20Noda)'),console['log']('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x19ffd7),loggerService_1[_0x54c6f9(0x246)][_0x54c6f9(0x233)](_0x54c6f9(0x1eb),_0x54c6f9(0x251),_0x54c6f9(0x1f9),_0x1ce3cc);const _0x1461be=await fetch(this['apiUrl'],{'method':_0x54c6f9(0x1f9),'headers':{'Content-Type':_0x54c6f9(0x210),'Accept':_0x54c6f9(0x210),'User-Agent':_0x54c6f9(0x1e7)},'body':JSON[_0x54c6f9(0x224)](_0x1ce3cc)}),_0x5c192=Date[_0x54c6f9(0x21f)]()-_0x13d534;console[_0x54c6f9(0x1e8)](_0x54c6f9(0x204)),console['log'](_0x54c6f9(0x232),_0x1461be[_0x54c6f9(0x20c)]),console[_0x54c6f9(0x1e8)]('Status\x20Text:',_0x1461be[_0x54c6f9(0x25b)]),console['log'](_0x54c6f9(0x252),Object[_0x54c6f9(0x1fd)](_0x1461be[_0x54c6f9(0x239)][_0x54c6f9(0x248)]())),console[_0x54c6f9(0x1e8)](_0x54c6f9(0x223),_0x5c192+'ms');const _0x36fb44=await _0x1461be[_0x54c6f9(0x20a)]();console[_0x54c6f9(0x1e8)]('Raw\x20Response\x20Body:',_0x36fb44);if(!_0x1461be['ok']){console[_0x54c6f9(0x228)](_0x54c6f9(0x213)),console[_0x54c6f9(0x228)](_0x54c6f9(0x205),_0x1461be['status']),console[_0x54c6f9(0x228)](_0x54c6f9(0x258),_0x36fb44),loggerService_1[_0x54c6f9(0x246)][_0x54c6f9(0x1e6)]('noda','/payment-links',_0x1461be[_0x54c6f9(0x20c)],_0x36fb44,_0x5c192),loggerService_1[_0x54c6f9(0x246)][_0x54c6f9(0x1f7)](_0x54c6f9(0x1eb),_0x54c6f9(0x251),_0x54c6f9(0x1fe)+_0x1461be[_0x54c6f9(0x20c)]+':\x20'+_0x36fb44);if(_0x1461be[_0x54c6f9(0x20c)]===0x190)throw new Error(_0x54c6f9(0x237));else{if(_0x1461be[_0x54c6f9(0x20c)]===0x1f4)throw new Error(_0x54c6f9(0x209));}throw new Error(_0x54c6f9(0x1e0)+_0x1461be[_0x54c6f9(0x20c)]+_0x54c6f9(0x1fb)+_0x36fb44);}let _0x1f7f39;try{_0x1f7f39=JSON[_0x54c6f9(0x1df)](_0x36fb44);}catch(_0x895f3f){console[_0x54c6f9(0x228)](_0x54c6f9(0x1f5),_0x895f3f),loggerService_1['loggerService']['logWhiteDomainError'](_0x54c6f9(0x1eb),_0x54c6f9(0x251),_0x54c6f9(0x1de)+_0x895f3f);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x36fb44);}console['log'](_0x54c6f9(0x25a)),console[_0x54c6f9(0x1e8)](_0x54c6f9(0x217),JSON[_0x54c6f9(0x224)](_0x1f7f39,null,0x2)),loggerService_1[_0x54c6f9(0x246)]['logWhiteDomainResponse']('noda',_0x54c6f9(0x251),_0x1461be[_0x54c6f9(0x20c)],_0x1f7f39,_0x5c192);if(_0x1f7f39[_0x54c6f9(0x228)]||_0x1f7f39[_0x54c6f9(0x206)]){const _0x589591=_0x1f7f39[_0x54c6f9(0x247)]||_0x1f7f39[_0x54c6f9(0x228)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x54c6f9(0x228)](_0x54c6f9(0x1ea)),console[_0x54c6f9(0x228)]('Error\x20Message:',_0x589591),console[_0x54c6f9(0x228)](_0x54c6f9(0x1e1),_0x1f7f39['statusCode']),loggerService_1[_0x54c6f9(0x246)][_0x54c6f9(0x1f7)](_0x54c6f9(0x1eb),_0x54c6f9(0x251),'Business\x20Error:\x20'+_0x589591);throw new Error(_0x54c6f9(0x1f3)+_0x589591);}if(!_0x1f7f39['id']||!_0x1f7f39['shortLinkUrls']?.[_0x54c6f9(0x231)]){console[_0x54c6f9(0x228)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x54c6f9(0x228)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x54c6f9(0x228)](_0x54c6f9(0x24d),_0x1f7f39),loggerService_1[_0x54c6f9(0x246)][_0x54c6f9(0x1f7)](_0x54c6f9(0x1eb),_0x54c6f9(0x251),_0x54c6f9(0x241));throw new Error(_0x54c6f9(0x229));}return console[_0x54c6f9(0x1e8)](_0x54c6f9(0x1f0)),console[_0x54c6f9(0x1e8)](_0x54c6f9(0x259),_0x1f7f39['id']),console['log'](_0x54c6f9(0x23b),_0x1f7f39[_0x54c6f9(0x1ef)]['shortLink']),console[_0x54c6f9(0x1e8)](_0x54c6f9(0x21d),_0x1f7f39[_0x54c6f9(0x1ef)][_0x54c6f9(0x235)]||'Not\x20provided'),console['log'](_0x54c6f9(0x25c),_0x4668fc,_0x54c6f9(0x253)),console[_0x54c6f9(0x1e8)](_0x54c6f9(0x1f8),_0x19ffd7),{'gateway_payment_id':_0x1f7f39['id'],'payment_url':_0x1f7f39['shortLinkUrls'][_0x54c6f9(0x231)],'qr_code_url':_0x1f7f39[_0x54c6f9(0x1ef)][_0x54c6f9(0x235)],'expiry_date':_0x1f7f39['expiryDate']};}catch(_0x4a1dac){console['error'](_0x54c6f9(0x23d)),console['error'](_0x54c6f9(0x240),_0x4a1dac),loggerService_1[_0x54c6f9(0x246)][_0x54c6f9(0x1f7)](_0x54c6f9(0x1eb),_0x54c6f9(0x251),_0x4a1dac);if(_0x4a1dac instanceof Error){console[_0x54c6f9(0x228)](_0x54c6f9(0x1dc),_0x4a1dac[_0x54c6f9(0x247)]),console['error'](_0x54c6f9(0x21b),_0x4a1dac[_0x54c6f9(0x21c)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x4a1dac[_0x54c6f9(0x247)]);}throw new Error(_0x54c6f9(0x234));}}async[a46_0x37f170(0x23c)](_0x778f8f){const _0xa1c01d=a46_0x37f170,_0x494eee=Date[_0xa1c01d(0x21f)]();try{loggerService_1[_0xa1c01d(0x246)]['logWhiteDomainRequest'](_0xa1c01d(0x1eb),_0xa1c01d(0x245)+_0x778f8f,_0xa1c01d(0x22f),{});const _0x359c28=await fetch(this[_0xa1c01d(0x242)]+'/'+_0x778f8f,{'method':_0xa1c01d(0x22f),'headers':{'Content-Type':'application/json','User-Agent':_0xa1c01d(0x1e7)}}),_0x302b29=Date[_0xa1c01d(0x21f)]()-_0x494eee;if(!_0x359c28['ok']){const _0x7549b8=await _0x359c28[_0xa1c01d(0x20a)]();loggerService_1[_0xa1c01d(0x246)][_0xa1c01d(0x1e6)](_0xa1c01d(0x1eb),_0xa1c01d(0x245)+_0x778f8f,_0x359c28[_0xa1c01d(0x20c)],_0x7549b8,_0x302b29);throw new Error('HTTP\x20error!\x20status:\x20'+_0x359c28[_0xa1c01d(0x20c)]);}const _0x38fc82=await _0x359c28[_0xa1c01d(0x208)]();loggerService_1[_0xa1c01d(0x246)]['logWhiteDomainResponse'](_0xa1c01d(0x1eb),'/payment-links/'+_0x778f8f,_0x359c28[_0xa1c01d(0x20c)],_0x38fc82,_0x302b29);if(_0x38fc82[_0xa1c01d(0x228)]||_0x38fc82['statusCode']){loggerService_1[_0xa1c01d(0x246)]['logWhiteDomainError'](_0xa1c01d(0x1eb),_0xa1c01d(0x245)+_0x778f8f,_0xa1c01d(0x1f3)+(_0x38fc82[_0xa1c01d(0x247)]||_0x38fc82[_0xa1c01d(0x228)]||_0xa1c01d(0x23e)));throw new Error(_0xa1c01d(0x1f3)+(_0x38fc82['message']||_0x38fc82[_0xa1c01d(0x228)]||_0xa1c01d(0x23e)));}let _0x5ab87d=_0xa1c01d(0x216);if(_0x38fc82[_0xa1c01d(0x222)]===![]){if(_0x38fc82[_0xa1c01d(0x255)]){const _0x4a06a6=new Date(_0x38fc82['expiryDate']),_0x3f7ba2=new Date();_0x4a06a6<_0x3f7ba2?_0x5ab87d=_0xa1c01d(0x22d):_0x5ab87d=_0xa1c01d(0x243);}else _0x5ab87d=_0xa1c01d(0x243);}else _0x5ab87d=_0xa1c01d(0x216);return{'status':_0x5ab87d,'amount':_0x38fc82[_0xa1c01d(0x200)],'currency':_0x38fc82[_0xa1c01d(0x1ee)],'isActive':_0x38fc82[_0xa1c01d(0x222)]};}catch(_0x26c287){console[_0xa1c01d(0x228)](_0xa1c01d(0x238),_0x26c287),loggerService_1[_0xa1c01d(0x246)][_0xa1c01d(0x1f7)]('noda',_0xa1c01d(0x245)+_0x778f8f,_0x26c287);throw new Error(_0xa1c01d(0x1e4)+(_0x26c287 instanceof Error?_0x26c287[_0xa1c01d(0x247)]:_0xa1c01d(0x23e)));}}async[a46_0x37f170(0x20b)](_0x1695a3){const _0x5b8962=a46_0x37f170;console[_0x5b8962(0x1e8)](_0x5b8962(0x22c),_0x1695a3);let _0x4fe32a=_0x5b8962(0x216);switch(_0x1695a3[_0x5b8962(0x212)]?.[_0x5b8962(0x23a)]()){case _0x5b8962(0x218):case _0x5b8962(0x1f1):case _0x5b8962(0x215):case'success':case _0x5b8962(0x202):_0x1695a3[_0x5b8962(0x1e3)]===_0x5b8962(0x24b)?_0x4fe32a=_0x5b8962(0x21a):_0x4fe32a=_0x5b8962(0x216);break;case _0x5b8962(0x1ff):case _0x5b8962(0x250):case'failed':case _0x5b8962(0x228):case _0x5b8962(0x24a):_0x4fe32a=_0x5b8962(0x243);break;case'expired':case _0x5b8962(0x219):_0x4fe32a='EXPIRED';break;case'pending':case _0x5b8962(0x254):case _0x5b8962(0x207):case _0x5b8962(0x20e):case _0x5b8962(0x236):default:_0x4fe32a=_0x5b8962(0x216);break;}return{'paymentId':_0x1695a3[_0x5b8962(0x221)]||_0x1695a3[_0x5b8962(0x22e)],'status':_0x4fe32a,'amount':_0x1695a3[_0x5b8962(0x24f)],'currency':_0x1695a3[_0x5b8962(0x24c)],'additionalInfo':{'method':_0x1695a3[_0x5b8962(0x20f)],'bankId':_0x1695a3['BankId'],'settled':_0x1695a3[_0x5b8962(0x1e3)],'settlementDate':_0x1695a3[_0x5b8962(0x227)],'remitterName':_0x1695a3['Remitter']?.[_0x5b8962(0x1e9)],'remitterIban':_0x1695a3[_0x5b8962(0x25e)]?.[_0x5b8962(0x1e5)],'bankTransactionId':_0x1695a3[_0x5b8962(0x226)]}};}[a46_0x37f170(0x220)](_0x5e74ae,_0x14411b){const _0x1718ab=a46_0x37f170;return console[_0x1718ab(0x1e8)](_0x1718ab(0x201),{'receivedSignature':_0x14411b,'paymentId':_0x5e74ae[_0x1718ab(0x22e)],'merchantPaymentId':_0x5e74ae['MerchantPaymentId']}),!![];}}exports[a46_0x37f170(0x1dd)]=NodaService;