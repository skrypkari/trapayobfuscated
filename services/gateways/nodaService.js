'use strict';const a43_0x593cf2=a43_0x5571;function a43_0x5571(_0x93d4a,_0x41605e){const _0x9deba2=a43_0x9deb();return a43_0x5571=function(_0x5571bd,_0x693c3){_0x5571bd=_0x5571bd-0x16a;let _0x521ef0=_0x9deba2[_0x5571bd];return _0x521ef0;},a43_0x5571(_0x93d4a,_0x41605e);}(function(_0x1c5138,_0xdc3f87){const _0x4de13a=a43_0x5571,_0x536c34=_0x1c5138();while(!![]){try{const _0x348860=-parseInt(_0x4de13a(0x185))/0x1*(parseInt(_0x4de13a(0x1e0))/0x2)+parseInt(_0x4de13a(0x1e3))/0x3*(-parseInt(_0x4de13a(0x1d5))/0x4)+parseInt(_0x4de13a(0x1da))/0x5+parseInt(_0x4de13a(0x1a0))/0x6*(-parseInt(_0x4de13a(0x1cb))/0x7)+parseInt(_0x4de13a(0x1b3))/0x8*(parseInt(_0x4de13a(0x1dd))/0x9)+parseInt(_0x4de13a(0x176))/0xa+-parseInt(_0x4de13a(0x16b))/0xb;if(_0x348860===_0xdc3f87)break;else _0x536c34['push'](_0x536c34['shift']());}catch(_0xdf0a4a){_0x536c34['push'](_0x536c34['shift']());}}}(a43_0x9deb,0xd85dc));Object[a43_0x593cf2(0x1e1)](exports,a43_0x593cf2(0x1ae),{'value':!![]}),exports[a43_0x593cf2(0x1d3)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x32e12f=a43_0x593cf2;this[_0x32e12f(0x1b4)]=_0x32e12f(0x190),console[_0x32e12f(0x1d9)](_0x32e12f(0x1b9));}async[a43_0x593cf2(0x1a8)](_0x2f744f){const _0x40ac5e=a43_0x593cf2,{orderId:_0xe13dbf,name:_0xb59f31,paymentDescription:_0x579d9a,amount:_0x31ebcd,currency:_0x12dad0,webhookUrl:_0x567566,returnUrl:_0x214021,expiryDate:_0x110f10}=_0x2f744f,_0x712824=_0x12dad0[_0x40ac5e(0x199)](),_0x53181c=_0x40ac5e(0x18e),_0xa84de=_0x40ac5e(0x1bc)+_0xe13dbf,_0x16860b={'name':_0xb59f31,'paymentDescription':_0x579d9a,'amount':_0x31ebcd,'currency':_0x712824,'paymentId':_0xe13dbf,'webhookUrl':_0x53181c,'returnUrl':_0xa84de};_0x110f10&&(_0x16860b[_0x40ac5e(0x1d7)]=_0x110f10);const _0x2969f9=Date[_0x40ac5e(0x183)]();try{console[_0x40ac5e(0x1d9)](_0x40ac5e(0x170)),console[_0x40ac5e(0x1d9)](_0x40ac5e(0x192),this[_0x40ac5e(0x1b4)]),console['log'](_0x40ac5e(0x175),JSON[_0x40ac5e(0x1ac)](_0x16860b,null,0x2)),console[_0x40ac5e(0x1d9)](_0x40ac5e(0x178),_0xe13dbf,_0x40ac5e(0x19a)),console[_0x40ac5e(0x1d9)]('✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:',_0xa84de),loggerService_1[_0x40ac5e(0x180)][_0x40ac5e(0x1a9)](_0x40ac5e(0x1a4),_0x40ac5e(0x173),_0x40ac5e(0x1b7),_0x16860b);const _0x10ee19=await fetch(this[_0x40ac5e(0x1b4)],{'method':_0x40ac5e(0x1b7),'headers':{'Content-Type':_0x40ac5e(0x182),'Accept':_0x40ac5e(0x182),'User-Agent':_0x40ac5e(0x1c8)},'body':JSON['stringify'](_0x16860b)}),_0x161fc7=Date['now']()-_0x2969f9;console[_0x40ac5e(0x1d9)](_0x40ac5e(0x1c5)),console[_0x40ac5e(0x1d9)](_0x40ac5e(0x1e4),_0x10ee19['status']),console['log']('Status\x20Text:',_0x10ee19[_0x40ac5e(0x17d)]),console['log']('Headers:',Object[_0x40ac5e(0x1dc)](_0x10ee19[_0x40ac5e(0x196)][_0x40ac5e(0x1b1)]())),console[_0x40ac5e(0x1d9)](_0x40ac5e(0x181),_0x161fc7+'ms');const _0x303aeb=await _0x10ee19[_0x40ac5e(0x195)]();console[_0x40ac5e(0x1d9)](_0x40ac5e(0x1db),_0x303aeb);if(!_0x10ee19['ok']){console[_0x40ac5e(0x186)](_0x40ac5e(0x1c4)),console['error'](_0x40ac5e(0x19f),_0x10ee19[_0x40ac5e(0x1bf)]),console[_0x40ac5e(0x186)]('Response\x20Body:',_0x303aeb),loggerService_1['loggerService'][_0x40ac5e(0x1e7)](_0x40ac5e(0x1a4),_0x40ac5e(0x173),_0x10ee19[_0x40ac5e(0x1bf)],_0x303aeb,_0x161fc7),loggerService_1[_0x40ac5e(0x180)][_0x40ac5e(0x1b6)](_0x40ac5e(0x1a4),_0x40ac5e(0x173),'HTTP\x20'+_0x10ee19[_0x40ac5e(0x1bf)]+':\x20'+_0x303aeb);if(_0x10ee19[_0x40ac5e(0x1bf)]===0x190)throw new Error(_0x40ac5e(0x1c1));else{if(_0x10ee19[_0x40ac5e(0x1bf)]===0x1f4)throw new Error(_0x40ac5e(0x1d6));}throw new Error(_0x40ac5e(0x16a)+_0x10ee19['status']+_0x40ac5e(0x1cf)+_0x303aeb);}let _0x3f9647;try{_0x3f9647=JSON[_0x40ac5e(0x197)](_0x303aeb);}catch(_0x5115cc){console[_0x40ac5e(0x186)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5115cc),loggerService_1['loggerService'][_0x40ac5e(0x1b6)](_0x40ac5e(0x1a4),'/payment-links',_0x40ac5e(0x1b5)+_0x5115cc);throw new Error(_0x40ac5e(0x1bd)+_0x303aeb);}console['log']('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x40ac5e(0x1d9)]('Parsed\x20Result:',JSON[_0x40ac5e(0x1ac)](_0x3f9647,null,0x2)),loggerService_1[_0x40ac5e(0x180)][_0x40ac5e(0x1e7)](_0x40ac5e(0x1a4),_0x40ac5e(0x173),_0x10ee19['status'],_0x3f9647,_0x161fc7);if(_0x3f9647[_0x40ac5e(0x186)]||_0x3f9647[_0x40ac5e(0x1d0)]){const _0x3f6597=_0x3f9647[_0x40ac5e(0x1e2)]||_0x3f9647['error']||_0x40ac5e(0x18d);console[_0x40ac5e(0x186)](_0x40ac5e(0x189)),console[_0x40ac5e(0x186)](_0x40ac5e(0x1c3),_0x3f6597),console[_0x40ac5e(0x186)](_0x40ac5e(0x1c0),_0x3f9647['statusCode']),loggerService_1[_0x40ac5e(0x180)][_0x40ac5e(0x1b6)](_0x40ac5e(0x1a4),'/payment-links',_0x40ac5e(0x1af)+_0x3f6597);throw new Error(_0x40ac5e(0x1d4)+_0x3f6597);}if(!_0x3f9647['id']||!_0x3f9647[_0x40ac5e(0x16c)]?.['shortLink']){console[_0x40ac5e(0x186)](_0x40ac5e(0x16e)),console['error']('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x40ac5e(0x186)](_0x40ac5e(0x193),_0x3f9647),loggerService_1[_0x40ac5e(0x180)][_0x40ac5e(0x1b6)](_0x40ac5e(0x1a4),_0x40ac5e(0x173),_0x40ac5e(0x179));throw new Error(_0x40ac5e(0x1e5));}return console[_0x40ac5e(0x1d9)](_0x40ac5e(0x1a6)),console['log'](_0x40ac5e(0x184),_0x3f9647['id']),console[_0x40ac5e(0x1d9)]('Short\x20Link:',_0x3f9647['shortLinkUrls'][_0x40ac5e(0x18c)]),console['log'](_0x40ac5e(0x1cc),_0x3f9647[_0x40ac5e(0x16c)][_0x40ac5e(0x1e6)]||_0x40ac5e(0x17f)),console['log'](_0x40ac5e(0x1c6),_0xe13dbf,_0x40ac5e(0x1ba)),console[_0x40ac5e(0x1d9)](_0x40ac5e(0x17c),_0xa84de),{'gateway_payment_id':_0x3f9647['id'],'payment_url':_0x3f9647[_0x40ac5e(0x16c)][_0x40ac5e(0x18c)],'qr_code_url':_0x3f9647[_0x40ac5e(0x16c)][_0x40ac5e(0x1e6)],'expiry_date':_0x3f9647[_0x40ac5e(0x1d7)]};}catch(_0x3d8beb){console[_0x40ac5e(0x186)](_0x40ac5e(0x19d)),console[_0x40ac5e(0x186)]('Error\x20details:',_0x3d8beb),loggerService_1[_0x40ac5e(0x180)]['logWhiteDomainError']('noda',_0x40ac5e(0x173),_0x3d8beb);if(_0x3d8beb instanceof Error){console[_0x40ac5e(0x186)](_0x40ac5e(0x1a1),_0x3d8beb[_0x40ac5e(0x1e2)]),console['error'](_0x40ac5e(0x1df),_0x3d8beb['stack']);throw new Error(_0x40ac5e(0x1e8)+_0x3d8beb[_0x40ac5e(0x1e2)]);}throw new Error(_0x40ac5e(0x18b));}}async[a43_0x593cf2(0x1b0)](_0xeee492){const _0x4e8434=a43_0x593cf2,_0x4256e0=Date[_0x4e8434(0x183)]();try{loggerService_1[_0x4e8434(0x180)][_0x4e8434(0x1a9)]('noda',_0x4e8434(0x1ca)+_0xeee492,'GET',{});const _0x2a0102=await fetch(this[_0x4e8434(0x1b4)]+'/'+_0xeee492,{'method':_0x4e8434(0x1ce),'headers':{'Content-Type':_0x4e8434(0x182),'User-Agent':_0x4e8434(0x1c8)}}),_0x4d24fe=Date[_0x4e8434(0x183)]()-_0x4256e0;if(!_0x2a0102['ok']){const _0x5ea78e=await _0x2a0102[_0x4e8434(0x195)]();loggerService_1['loggerService'][_0x4e8434(0x1e7)]('noda','/payment-links/'+_0xeee492,_0x2a0102[_0x4e8434(0x1bf)],_0x5ea78e,_0x4d24fe);throw new Error(_0x4e8434(0x16a)+_0x2a0102[_0x4e8434(0x1bf)]);}const _0x5bc01a=await _0x2a0102[_0x4e8434(0x1b2)]();loggerService_1[_0x4e8434(0x180)]['logWhiteDomainResponse'](_0x4e8434(0x1a4),'/payment-links/'+_0xeee492,_0x2a0102[_0x4e8434(0x1bf)],_0x5bc01a,_0x4d24fe);if(_0x5bc01a[_0x4e8434(0x186)]||_0x5bc01a['statusCode']){loggerService_1[_0x4e8434(0x180)][_0x4e8434(0x1b6)](_0x4e8434(0x1a4),_0x4e8434(0x1ca)+_0xeee492,_0x4e8434(0x1d4)+(_0x5bc01a[_0x4e8434(0x1e2)]||_0x5bc01a[_0x4e8434(0x186)]||_0x4e8434(0x1cd)));throw new Error(_0x4e8434(0x1d4)+(_0x5bc01a['message']||_0x5bc01a['error']||_0x4e8434(0x1cd)));}let _0x269eae=_0x4e8434(0x17a);if(_0x5bc01a[_0x4e8434(0x174)]===![]){if(_0x5bc01a[_0x4e8434(0x1d7)]){const _0x123a78=new Date(_0x5bc01a[_0x4e8434(0x1d7)]),_0x28ee34=new Date();_0x123a78<_0x28ee34?_0x269eae=_0x4e8434(0x1c7):_0x269eae=_0x4e8434(0x177);}else _0x269eae=_0x4e8434(0x177);}else _0x269eae='PENDING';return{'status':_0x269eae,'amount':_0x5bc01a[_0x4e8434(0x19e)],'currency':_0x5bc01a[_0x4e8434(0x18a)],'isActive':_0x5bc01a[_0x4e8434(0x174)]};}catch(_0x1064e7){console[_0x4e8434(0x186)](_0x4e8434(0x1ad),_0x1064e7),loggerService_1[_0x4e8434(0x180)][_0x4e8434(0x1b6)](_0x4e8434(0x1a4),_0x4e8434(0x1ca)+_0xeee492,_0x1064e7);throw new Error(_0x4e8434(0x1b8)+(_0x1064e7 instanceof Error?_0x1064e7[_0x4e8434(0x1e2)]:_0x4e8434(0x1cd)));}}async[a43_0x593cf2(0x17b)](_0x5ac41b){const _0x59368a=a43_0x593cf2;console[_0x59368a(0x1d9)](_0x59368a(0x16d),_0x5ac41b);let _0x1d2bad=_0x59368a(0x17a);switch(_0x5ac41b[_0x59368a(0x17e)]?.[_0x59368a(0x194)]()){case _0x59368a(0x16f):case _0x59368a(0x19c):case'paid':case'success':case _0x59368a(0x1d1):_0x5ac41b['Settled']===_0x59368a(0x1a2)?_0x1d2bad=_0x59368a(0x172):_0x1d2bad=_0x59368a(0x17a);break;case'cancelled':case _0x59368a(0x1d2):case'failed':case'error':case _0x59368a(0x1ab):_0x1d2bad=_0x59368a(0x177);break;case _0x59368a(0x1a5):case _0x59368a(0x1c2):_0x1d2bad=_0x59368a(0x1c7);break;case _0x59368a(0x1aa):case _0x59368a(0x19b):case _0x59368a(0x188):case _0x59368a(0x1a3):case'in_progress':default:_0x1d2bad=_0x59368a(0x17a);break;}return{'paymentId':_0x5ac41b[_0x59368a(0x1c9)]||_0x5ac41b[_0x59368a(0x1de)],'status':_0x1d2bad,'amount':_0x5ac41b['Amount'],'currency':_0x5ac41b[_0x59368a(0x1d8)],'additionalInfo':{'method':_0x5ac41b[_0x59368a(0x187)],'bankId':_0x5ac41b[_0x59368a(0x1bb)],'settled':_0x5ac41b[_0x59368a(0x171)],'settlementDate':_0x5ac41b[_0x59368a(0x18f)],'remitterName':_0x5ac41b[_0x59368a(0x198)]?.['Name'],'remitterIban':_0x5ac41b[_0x59368a(0x198)]?.[_0x59368a(0x1a7)],'bankTransactionId':_0x5ac41b[_0x59368a(0x1be)]}};}[a43_0x593cf2(0x191)](_0x45ef4f,_0x3bddab){const _0x464efb=a43_0x593cf2;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x3bddab,'paymentId':_0x45ef4f['PaymentId'],'merchantPaymentId':_0x45ef4f[_0x464efb(0x1c9)]}),!![];}}exports[a43_0x593cf2(0x1d3)]=NodaService;function a43_0x9deb(){const _0x13fdc5=['verifyWebhookSignature','URL:','Response\x20data:','toLowerCase','text','headers','parse','Remitter','toUpperCase','(8digits-8digits\x20format\x20for\x20Noda)','created','completed','===\x20NODA\x20SERVICE\x20ERROR\x20===','amount','HTTP\x20Status:','18FOFlfm','Error\x20message:','Yes','processing','noda','expired','===\x20NODA\x20SUCCESS\x20===','Iban','createPaymentLink','logWhiteDomainRequest','pending','rejected','stringify','Noda\x20payment\x20verification\x20error:','__esModule','Business\x20Error:\x20','verifyPayment','entries','json','80xGcUMB','apiUrl','JSON\x20Parse\x20Error:\x20','logWhiteDomainError','POST','Failed\x20to\x20verify\x20Noda\x20payment:\x20','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','(8digits-8digits\x20format)','BankId','https://tesoft.uk/gateway/pending.php?id=','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','BankTransactionId','status','Status\x20Code:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','timeout','Error\x20Message:','===\x20NODA\x20API\x20ERROR\x20===','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Order\x20ID\x20Used:','EXPIRED','TesSoft\x20Payment\x20System/1.0','MerchantPaymentId','/payment-links/','215201eeaoIX','QR\x20Code\x20Link:','Unknown\x20error','GET',',\x20body:\x20','statusCode','successful','canceled','NodaService','Noda\x20API\x20error:\x20','1288656XJjZuc','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','expiryDate','Currency','log','3727245wZbijV','Raw\x20Response\x20Body:','fromEntries','584460QlVBGk','PaymentId','Error\x20stack:','10EDkGKt','defineProperty','message','3yegBKk','Status:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','qrCodeLink','logWhiteDomainResponse','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','HTTP\x20error!\x20status:\x20','16157933xffDkq','shortLinkUrls','Processing\x20Noda\x20webhook:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','done','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Settled','PAID','/payment-links','isActive','Request\x20Body\x20(Direct\x20JSON):','16436830lELxbo','FAILED','Order\x20ID\x20Format:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','PENDING','processWebhook','✅\x20Return\x20URL\x20configured\x20for\x20pending:','statusText','Status','Not\x20provided','loggerService','Response\x20Time:','application/json','now','Payment\x20Link\x20ID:','53800GGWpoV','error','Method','active','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','currency','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','shortLink','Unknown\x20error\x20from\x20Noda\x20API','https://tesoft.uk/gateway/noda/webhook/','SettlementDate','https://tesoft.uk/gateway/noda/'];a43_0x9deb=function(){return _0x13fdc5;};return a43_0x9deb();}