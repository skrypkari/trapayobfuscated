'use strict';const a43_0x186924=a43_0x3f30;(function(_0x5b1814,_0x9b3656){const _0x5aaed6=a43_0x3f30,_0x5c247f=_0x5b1814();while(!![]){try{const _0x137ce7=-parseInt(_0x5aaed6(0xdd))/0x1*(parseInt(_0x5aaed6(0xb6))/0x2)+-parseInt(_0x5aaed6(0xc6))/0x3*(-parseInt(_0x5aaed6(0x99))/0x4)+parseInt(_0x5aaed6(0xd8))/0x5*(-parseInt(_0x5aaed6(0xad))/0x6)+parseInt(_0x5aaed6(0x112))/0x7+-parseInt(_0x5aaed6(0xaa))/0x8*(parseInt(_0x5aaed6(0xf4))/0x9)+parseInt(_0x5aaed6(0xa8))/0xa*(-parseInt(_0x5aaed6(0xba))/0xb)+parseInt(_0x5aaed6(0x102))/0xc;if(_0x137ce7===_0x9b3656)break;else _0x5c247f['push'](_0x5c247f['shift']());}catch(_0x1efd60){_0x5c247f['push'](_0x5c247f['shift']());}}}(a43_0x26dc,0x36537));Object[a43_0x186924(0xed)](exports,a43_0x186924(0xd2),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a43_0x186924(0xfd));function a43_0x26dc(){const _0x9f2916=['JSON\x20Parse\x20Error:\x20','statusCode','expired','Noda\x20webhook\x20signature\x20verification:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Raw\x20Response\x20Body:','amount','FAILED','timeout','102MYsrQG','https://tesoft.uk/gateway/noda/webhook/','qrCodeLink','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','===\x20NODA\x20SUCCESS\x20===','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','URL:','shortLinkUrls','Remitter','Response\x20Body:','parse','toUpperCase','__esModule','expiryDate','https://tesoft.uk/gateway/noda/','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Failed\x20to\x20parse\x20JSON\x20response:','QR\x20Code\x20Link:','1752435PGWrCp','BankTransactionId','error','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','completed','41587cgGZDl','cancelled','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Status\x20Text:','Noda\x20payment\x20verification\x20error:','===\x20NODA\x20SERVICE\x20ERROR\x20===','Parsed\x20Result:','MerchantPaymentId','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','GET','Business\x20Error:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Order\x20ID\x20Format:','/payment-links/','defineProperty','logWhiteDomainResponse','Response\x20data:','application/json','logWhiteDomainError','toLowerCase','status','3840363aXsMEa','stringify','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Settled','(8digits-8digits\x20format)','shortLink','Short\x20Link:','Currency','successful','../loggerService','PaymentId','Status','TesSoft\x20Payment\x20System/1.0','created','14168412SQNpss','Payment\x20Link\x20ID:','EXPIRED','isActive','Headers:','HTTP\x20error!\x20status:\x20','Status:','verifyWebhookSignature','===\x20PARSED\x20NODA\x20RESPONSE\x20===','loggerService','apiUrl','Error\x20details:','entries','Noda\x20API\x20error:\x20','pending','Name','1297023izvoqD','rejected','Response\x20Time:','processing','logWhiteDomainRequest','13264izpEaC','Iban','now','Missing\x20id\x20or\x20shortLink\x20in\x20response','active','fromEntries','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','/payment-links','Error\x20stack:','stack','Yes','Unknown\x20error','Processing\x20Noda\x20webhook:','message','statusText','451810UKxglb','Unknown\x20error\x20from\x20Noda\x20API','8MjOHan','headers','PENDING','6tOxbMi','noda','https://tesoft.uk/gateway/pending.php?id=','Request\x20Body\x20(Direct\x20JSON):','NodaService','HTTP\x20Status:','verifyPayment','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','in_progress','10ucHwoF','Error\x20Message:','done','log','66JAOptZ','Error\x20message:','POST'];a43_0x26dc=function(){return _0x9f2916;};return a43_0x26dc();}class NodaService{constructor(){const _0x422819=a43_0x186924;this['apiUrl']=_0x422819(0xd4),console[_0x422819(0xb9)](_0x422819(0xd5));}async['createPaymentLink'](_0x522438){const _0x2b97f7=a43_0x186924,{orderId:_0xeae76d,name:_0x3ea172,paymentDescription:_0x2eb5ef,amount:_0x5cdefd,currency:_0x527a59,webhookUrl:_0xb21b0a,returnUrl:_0xad160e,expiryDate:_0x3eb266}=_0x522438,_0x22d0f1=_0x527a59[_0x2b97f7(0xd1)](),_0x5e472a=_0x2b97f7(0xc7),_0x31f733=_0x2b97f7(0xaf)+_0xeae76d,_0x945fb3={'name':_0x3ea172,'paymentDescription':_0x2eb5ef,'amount':_0x5cdefd,'currency':_0x22d0f1,'paymentId':_0xeae76d,'webhookUrl':_0x5e472a,'returnUrl':_0x31f733};_0x3eb266&&(_0x945fb3['expiryDate']=_0x3eb266);const _0x256a93=Date[_0x2b97f7(0x9b)]();try{console[_0x2b97f7(0xb9)](_0x2b97f7(0xcb)),console[_0x2b97f7(0xb9)](_0x2b97f7(0xcc),this[_0x2b97f7(0x10c)]),console[_0x2b97f7(0xb9)](_0x2b97f7(0xb0),JSON[_0x2b97f7(0xf5)](_0x945fb3,null,0x2)),console[_0x2b97f7(0xb9)](_0x2b97f7(0xeb),_0xeae76d,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x2b97f7(0xb9)](_0x2b97f7(0xc1),_0x31f733),loggerService_1[_0x2b97f7(0x10b)]['logWhiteDomainRequest'](_0x2b97f7(0xae),_0x2b97f7(0xa0),'POST',_0x945fb3);const _0x36283a=await fetch(this[_0x2b97f7(0x10c)],{'method':_0x2b97f7(0xbc),'headers':{'Content-Type':'application/json','Accept':_0x2b97f7(0xf0),'User-Agent':_0x2b97f7(0x100)},'body':JSON[_0x2b97f7(0xf5)](_0x945fb3)}),_0x793f9=Date[_0x2b97f7(0x9b)]()-_0x256a93;console[_0x2b97f7(0xb9)](_0x2b97f7(0xdf)),console['log'](_0x2b97f7(0x108),_0x36283a[_0x2b97f7(0xf3)]),console[_0x2b97f7(0xb9)](_0x2b97f7(0xe1),_0x36283a[_0x2b97f7(0xa7)]),console[_0x2b97f7(0xb9)](_0x2b97f7(0x106),Object[_0x2b97f7(0x9e)](_0x36283a[_0x2b97f7(0xab)][_0x2b97f7(0x10e)]())),console[_0x2b97f7(0xb9)](_0x2b97f7(0x114),_0x793f9+'ms');const _0x4e7bd6=await _0x36283a['text']();console[_0x2b97f7(0xb9)](_0x2b97f7(0xc2),_0x4e7bd6);if(!_0x36283a['ok']){console[_0x2b97f7(0xda)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x2b97f7(0xda)](_0x2b97f7(0xb2),_0x36283a['status']),console['error'](_0x2b97f7(0xcf),_0x4e7bd6),loggerService_1[_0x2b97f7(0x10b)][_0x2b97f7(0xee)]('noda',_0x2b97f7(0xa0),_0x36283a['status'],_0x4e7bd6,_0x793f9),loggerService_1[_0x2b97f7(0x10b)][_0x2b97f7(0xf1)](_0x2b97f7(0xae),'/payment-links','HTTP\x20'+_0x36283a[_0x2b97f7(0xf3)]+':\x20'+_0x4e7bd6);if(_0x36283a[_0x2b97f7(0xf3)]===0x190)throw new Error(_0x2b97f7(0xe7));else{if(_0x36283a[_0x2b97f7(0xf3)]===0x1f4)throw new Error(_0x2b97f7(0xdb));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x36283a[_0x2b97f7(0xf3)]+',\x20body:\x20'+_0x4e7bd6);}let _0x9e5dff;try{_0x9e5dff=JSON[_0x2b97f7(0xd0)](_0x4e7bd6);}catch(_0x10cb0f){console[_0x2b97f7(0xda)](_0x2b97f7(0xd6),_0x10cb0f),loggerService_1[_0x2b97f7(0x10b)][_0x2b97f7(0xf1)](_0x2b97f7(0xae),_0x2b97f7(0xa0),_0x2b97f7(0xbd)+_0x10cb0f);throw new Error(_0x2b97f7(0xf6)+_0x4e7bd6);}console['log'](_0x2b97f7(0x10a)),console['log'](_0x2b97f7(0xe4),JSON[_0x2b97f7(0xf5)](_0x9e5dff,null,0x2)),loggerService_1['loggerService'][_0x2b97f7(0xee)](_0x2b97f7(0xae),'/payment-links',_0x36283a[_0x2b97f7(0xf3)],_0x9e5dff,_0x793f9);if(_0x9e5dff[_0x2b97f7(0xda)]||_0x9e5dff[_0x2b97f7(0xbe)]){const _0x2234af=_0x9e5dff[_0x2b97f7(0xa6)]||_0x9e5dff['error']||_0x2b97f7(0xa9);console[_0x2b97f7(0xda)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x2b97f7(0xda)](_0x2b97f7(0xb7),_0x2234af),console[_0x2b97f7(0xda)]('Status\x20Code:',_0x9e5dff[_0x2b97f7(0xbe)]),loggerService_1[_0x2b97f7(0x10b)][_0x2b97f7(0xf1)](_0x2b97f7(0xae),_0x2b97f7(0xa0),_0x2b97f7(0xe9)+_0x2234af);throw new Error(_0x2b97f7(0x10f)+_0x2234af);}if(!_0x9e5dff['id']||!_0x9e5dff[_0x2b97f7(0xcd)]?.[_0x2b97f7(0xf9)]){console[_0x2b97f7(0xda)](_0x2b97f7(0xe6)),console[_0x2b97f7(0xda)](_0x2b97f7(0x9c)),console[_0x2b97f7(0xda)](_0x2b97f7(0xef),_0x9e5dff),loggerService_1[_0x2b97f7(0x10b)][_0x2b97f7(0xf1)](_0x2b97f7(0xae),'/payment-links',_0x2b97f7(0xb4));throw new Error(_0x2b97f7(0x9f));}return console[_0x2b97f7(0xb9)](_0x2b97f7(0xca)),console['log'](_0x2b97f7(0x103),_0x9e5dff['id']),console[_0x2b97f7(0xb9)](_0x2b97f7(0xfa),_0x9e5dff[_0x2b97f7(0xcd)][_0x2b97f7(0xf9)]),console[_0x2b97f7(0xb9)](_0x2b97f7(0xd7),_0x9e5dff['shortLinkUrls'][_0x2b97f7(0xc8)]||'Not\x20provided'),console[_0x2b97f7(0xb9)]('Order\x20ID\x20Used:',_0xeae76d,_0x2b97f7(0xf8)),console[_0x2b97f7(0xb9)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x31f733),{'gateway_payment_id':_0x9e5dff['id'],'payment_url':_0x9e5dff[_0x2b97f7(0xcd)][_0x2b97f7(0xf9)],'qr_code_url':_0x9e5dff['shortLinkUrls'][_0x2b97f7(0xc8)],'expiry_date':_0x9e5dff['expiryDate']};}catch(_0x363aba){console[_0x2b97f7(0xda)](_0x2b97f7(0xe3)),console[_0x2b97f7(0xda)](_0x2b97f7(0x10d),_0x363aba),loggerService_1[_0x2b97f7(0x10b)][_0x2b97f7(0xf1)]('noda',_0x2b97f7(0xa0),_0x363aba);if(_0x363aba instanceof Error){console['error'](_0x2b97f7(0xbb),_0x363aba['message']),console[_0x2b97f7(0xda)](_0x2b97f7(0xa1),_0x363aba[_0x2b97f7(0xa2)]);throw new Error(_0x2b97f7(0xc9)+_0x363aba[_0x2b97f7(0xa6)]);}throw new Error(_0x2b97f7(0xea));}}async[a43_0x186924(0xb3)](_0x3bccdf){const _0x27c503=a43_0x186924,_0x500d9c=Date[_0x27c503(0x9b)]();try{loggerService_1['loggerService'][_0x27c503(0x98)](_0x27c503(0xae),_0x27c503(0xec)+_0x3bccdf,_0x27c503(0xe8),{});const _0x34d24f=await fetch(this['apiUrl']+'/'+_0x3bccdf,{'method':_0x27c503(0xe8),'headers':{'Content-Type':_0x27c503(0xf0),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x39768c=Date[_0x27c503(0x9b)]()-_0x500d9c;if(!_0x34d24f['ok']){const _0x59fe9a=await _0x34d24f['text']();loggerService_1['loggerService'][_0x27c503(0xee)]('noda',_0x27c503(0xec)+_0x3bccdf,_0x34d24f['status'],_0x59fe9a,_0x39768c);throw new Error(_0x27c503(0x107)+_0x34d24f[_0x27c503(0xf3)]);}const _0x371f84=await _0x34d24f['json']();loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0x27c503(0xec)+_0x3bccdf,_0x34d24f[_0x27c503(0xf3)],_0x371f84,_0x39768c);if(_0x371f84['error']||_0x371f84[_0x27c503(0xbe)]){loggerService_1['loggerService'][_0x27c503(0xf1)](_0x27c503(0xae),_0x27c503(0xec)+_0x3bccdf,_0x27c503(0x10f)+(_0x371f84[_0x27c503(0xa6)]||_0x371f84[_0x27c503(0xda)]||_0x27c503(0xa4)));throw new Error('Noda\x20API\x20error:\x20'+(_0x371f84[_0x27c503(0xa6)]||_0x371f84[_0x27c503(0xda)]||_0x27c503(0xa4)));}let _0x4a7052='PENDING';if(_0x371f84[_0x27c503(0x105)]===![]){if(_0x371f84[_0x27c503(0xd3)]){const _0x190731=new Date(_0x371f84[_0x27c503(0xd3)]),_0x552dec=new Date();_0x190731<_0x552dec?_0x4a7052='EXPIRED':_0x4a7052='FAILED';}else _0x4a7052='FAILED';}else _0x4a7052=_0x27c503(0xac);return{'status':_0x4a7052,'amount':_0x371f84[_0x27c503(0xc3)],'currency':_0x371f84['currency'],'isActive':_0x371f84[_0x27c503(0x105)]};}catch(_0x166b32){console[_0x27c503(0xda)](_0x27c503(0xe2),_0x166b32),loggerService_1[_0x27c503(0x10b)]['logWhiteDomainError'](_0x27c503(0xae),_0x27c503(0xec)+_0x3bccdf,_0x166b32);throw new Error(_0x27c503(0xe0)+(_0x166b32 instanceof Error?_0x166b32[_0x27c503(0xa6)]:'Unknown\x20error'));}}async['processWebhook'](_0x3c8865){const _0x5f5caf=a43_0x186924;console[_0x5f5caf(0xb9)](_0x5f5caf(0xa5),_0x3c8865);let _0x24e1f4='PENDING';switch(_0x3c8865[_0x5f5caf(0xff)]?.[_0x5f5caf(0xf2)]()){case _0x5f5caf(0xb8):case _0x5f5caf(0xdc):case'paid':case'success':case _0x5f5caf(0xfc):_0x3c8865[_0x5f5caf(0xf7)]===_0x5f5caf(0xa3)?_0x24e1f4='PAID':_0x24e1f4=_0x5f5caf(0xac);break;case _0x5f5caf(0xde):case'canceled':case'failed':case _0x5f5caf(0xda):case _0x5f5caf(0x113):_0x24e1f4=_0x5f5caf(0xc4);break;case _0x5f5caf(0xbf):case _0x5f5caf(0xc5):_0x24e1f4=_0x5f5caf(0x104);break;case _0x5f5caf(0x110):case _0x5f5caf(0x101):case _0x5f5caf(0x9d):case _0x5f5caf(0x97):case _0x5f5caf(0xb5):default:_0x24e1f4=_0x5f5caf(0xac);break;}return{'paymentId':_0x3c8865[_0x5f5caf(0xe5)]||_0x3c8865[_0x5f5caf(0xfe)],'status':_0x24e1f4,'amount':_0x3c8865['Amount'],'currency':_0x3c8865[_0x5f5caf(0xfb)],'additionalInfo':{'method':_0x3c8865['Method'],'bankId':_0x3c8865['BankId'],'settled':_0x3c8865['Settled'],'settlementDate':_0x3c8865['SettlementDate'],'remitterName':_0x3c8865[_0x5f5caf(0xce)]?.[_0x5f5caf(0x111)],'remitterIban':_0x3c8865['Remitter']?.[_0x5f5caf(0x9a)],'bankTransactionId':_0x3c8865[_0x5f5caf(0xd9)]}};}[a43_0x186924(0x109)](_0x50013e,_0x21b92c){const _0x136225=a43_0x186924;return console[_0x136225(0xb9)](_0x136225(0xc0),{'receivedSignature':_0x21b92c,'paymentId':_0x50013e[_0x136225(0xfe)],'merchantPaymentId':_0x50013e[_0x136225(0xe5)]}),!![];}}function a43_0x3f30(_0x5e3b5e,_0xa71da7){const _0x26dca1=a43_0x26dc();return a43_0x3f30=function(_0x3f30bd,_0x493f71){_0x3f30bd=_0x3f30bd-0x97;let _0x36405c=_0x26dca1[_0x3f30bd];return _0x36405c;},a43_0x3f30(_0x5e3b5e,_0xa71da7);}exports[a43_0x186924(0xb1)]=NodaService;