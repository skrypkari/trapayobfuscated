'use strict';function a48_0x31fc(){const _0x2882e2=['noda','299344xJvdRf','2601684dFZuFu','FAILED','Business\x20Error:\x20','Response\x20Time:','stringify','statusCode','Noda\x20payment\x20verification\x20error:','Order\x20ID\x20Format:','https://tesoft.uk/gateway/noda/webhook/','toUpperCase','/payment-links','Parsed\x20Result:','defineProperty','Remitter','NodaService','8upGpzc','QR\x20Code\x20Link:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','shortLink','amount','Error\x20details:','stack','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','9OuPTaq','10OjIxzZ','Method','Yes','Unknown\x20error\x20from\x20Noda\x20API','Missing\x20id\x20or\x20shortLink\x20in\x20response','application/json','URL:','completed','GET','(8digits-8digits\x20format)','===\x20PARSED\x20NODA\x20RESPONSE\x20===','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','EXPIRED','verifyPayment','Short\x20Link:','MerchantPaymentId','message','headers','expired','successful','Status:','Error\x20message:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Error\x20stack:','Currency','JSON\x20Parse\x20Error:\x20','apiUrl','Error\x20Message:','PENDING','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','524310kwpKAX','Raw\x20Response\x20Body:','fromEntries','Response\x20data:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Name','BankId','status','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','success','shortLinkUrls','Noda\x20webhook\x20signature\x20verification:','statusText','Failed\x20to\x20parse\x20JSON\x20response:','Unknown\x20error','logWhiteDomainResponse','Status\x20Text:','Iban','logWhiteDomainRequest','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','paid','Settled','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','logWhiteDomainError','processing','12663vwWCFN','canceled','log','POST','createPaymentLink',',\x20body:\x20','Not\x20provided','https://tesoft.uk/gateway/pending.php?id=','expiryDate','Request\x20Body\x20(Direct\x20JSON):','HTTP\x20Status:','/payment-links/','Headers:','Response\x20Body:','8939290ZKhaQZ','pending','===\x20NODA\x20SUCCESS\x20===','isActive','8196419acVjyT','text','Payment\x20Link\x20ID:','created','qrCodeLink','TesSoft\x20Payment\x20System/1.0','loggerService','PaymentId','HTTP\x20error!\x20status:\x20','296515pdHPIw','processWebhook','cancelled','===\x20NODA\x20SERVICE\x20ERROR\x20===','in_progress','https://tesoft.uk/gateway/noda/','../loggerService','parse','now','timeout','Processing\x20Noda\x20webhook:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','toLowerCase','Status\x20Code:','failed','error','PAID','Noda\x20API\x20error:\x20'];a48_0x31fc=function(){return _0x2882e2;};return a48_0x31fc();}function a48_0x1abe(_0x533cb4,_0x17f0d6){const _0x31fcf4=a48_0x31fc();return a48_0x1abe=function(_0x1abe2b,_0x588a10){_0x1abe2b=_0x1abe2b-0x105;let _0x4bf06c=_0x31fcf4[_0x1abe2b];return _0x4bf06c;},a48_0x1abe(_0x533cb4,_0x17f0d6);}const a48_0x3b249a=a48_0x1abe;(function(_0x269904,_0x1a1eeb){const _0x38bca5=a48_0x1abe,_0x42bb06=_0x269904();while(!![]){try{const _0x31f02c=-parseInt(_0x38bca5(0x17f))/0x1+parseInt(_0x38bca5(0x113))/0x2+-parseInt(_0x38bca5(0x164))/0x3+parseInt(_0x38bca5(0x114))/0x4+parseInt(_0x38bca5(0x12c))/0x5*(-parseInt(_0x38bca5(0x14b))/0x6)+parseInt(_0x38bca5(0x176))/0x7*(parseInt(_0x38bca5(0x123))/0x8)+-parseInt(_0x38bca5(0x12b))/0x9*(parseInt(_0x38bca5(0x172))/0xa);if(_0x31f02c===_0x1a1eeb)break;else _0x42bb06['push'](_0x42bb06['shift']());}catch(_0x4cb698){_0x42bb06['push'](_0x42bb06['shift']());}}}(a48_0x31fc,0x92de7));Object[a48_0x3b249a(0x120)](exports,'__esModule',{'value':!![]}),exports[a48_0x3b249a(0x122)]=void 0x0;const loggerService_1=require(a48_0x3b249a(0x106));class NodaService{constructor(){const _0x4faf45=a48_0x3b249a;this['apiUrl']=_0x4faf45(0x105),console[_0x4faf45(0x166)](_0x4faf45(0x125));}async[a48_0x3b249a(0x168)](_0x5c5299){const _0x390e3b=a48_0x3b249a,{orderId:_0x2cb6d5,name:_0x55c3e0,paymentDescription:_0x4b1386,amount:_0x3116e1,currency:_0x509257,webhookUrl:_0x10f4f3,returnUrl:_0x1544a8,expiryDate:_0x21488f}=_0x5c5299,_0x3e8b76=_0x509257[_0x390e3b(0x11d)](),_0x16e307=_0x390e3b(0x11c),_0x1719aa=_0x390e3b(0x16b)+_0x2cb6d5,_0x4b8587={'name':_0x55c3e0,'paymentDescription':_0x4b1386,'amount':_0x3116e1,'currency':_0x3e8b76,'paymentId':_0x2cb6d5,'webhookUrl':_0x16e307,'returnUrl':_0x1719aa};_0x21488f&&(_0x4b8587[_0x390e3b(0x16c)]=_0x21488f);const _0x1913b8=Date['now']();try{console[_0x390e3b(0x166)](_0x390e3b(0x142)),console['log'](_0x390e3b(0x132),this['apiUrl']),console['log'](_0x390e3b(0x16d),JSON[_0x390e3b(0x118)](_0x4b8587,null,0x2)),console[_0x390e3b(0x166)](_0x390e3b(0x11b),_0x2cb6d5,'(8digits-8digits\x20format\x20for\x20Noda)'),console['log']('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x1719aa),loggerService_1['loggerService'][_0x390e3b(0x15d)](_0x390e3b(0x112),_0x390e3b(0x11e),'POST',_0x4b8587);const _0x2d68c4=await fetch(this[_0x390e3b(0x146)],{'method':_0x390e3b(0x167),'headers':{'Content-Type':_0x390e3b(0x131),'Accept':_0x390e3b(0x131),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x390e3b(0x118)](_0x4b8587)}),_0x26ac07=Date[_0x390e3b(0x108)]()-_0x1913b8;console[_0x390e3b(0x166)](_0x390e3b(0x137)),console['log'](_0x390e3b(0x140),_0x2d68c4[_0x390e3b(0x152)]),console['log'](_0x390e3b(0x15b),_0x2d68c4[_0x390e3b(0x157)]),console[_0x390e3b(0x166)](_0x390e3b(0x170),Object[_0x390e3b(0x14d)](_0x2d68c4[_0x390e3b(0x13d)]['entries']())),console[_0x390e3b(0x166)](_0x390e3b(0x117),_0x26ac07+'ms');const _0x2cbbd4=await _0x2d68c4[_0x390e3b(0x177)]();console[_0x390e3b(0x166)](_0x390e3b(0x14c),_0x2cbbd4);if(!_0x2d68c4['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x390e3b(0x10f)](_0x390e3b(0x16e),_0x2d68c4[_0x390e3b(0x152)]),console[_0x390e3b(0x10f)](_0x390e3b(0x171),_0x2cbbd4),loggerService_1[_0x390e3b(0x17c)][_0x390e3b(0x15a)](_0x390e3b(0x112),_0x390e3b(0x11e),_0x2d68c4[_0x390e3b(0x152)],_0x2cbbd4,_0x26ac07),loggerService_1[_0x390e3b(0x17c)][_0x390e3b(0x162)](_0x390e3b(0x112),_0x390e3b(0x11e),'HTTP\x20'+_0x2d68c4[_0x390e3b(0x152)]+':\x20'+_0x2cbbd4);if(_0x2d68c4[_0x390e3b(0x152)]===0x190)throw new Error(_0x390e3b(0x14a));else{if(_0x2d68c4[_0x390e3b(0x152)]===0x1f4)throw new Error(_0x390e3b(0x10b));}throw new Error(_0x390e3b(0x17e)+_0x2d68c4[_0x390e3b(0x152)]+_0x390e3b(0x169)+_0x2cbbd4);}let _0x4eaedb;try{_0x4eaedb=JSON[_0x390e3b(0x107)](_0x2cbbd4);}catch(_0x350166){console[_0x390e3b(0x10f)](_0x390e3b(0x158),_0x350166),loggerService_1[_0x390e3b(0x17c)][_0x390e3b(0x162)](_0x390e3b(0x112),'/payment-links',_0x390e3b(0x145)+_0x350166);throw new Error(_0x390e3b(0x149)+_0x2cbbd4);}console[_0x390e3b(0x166)](_0x390e3b(0x136)),console[_0x390e3b(0x166)](_0x390e3b(0x11f),JSON[_0x390e3b(0x118)](_0x4eaedb,null,0x2)),loggerService_1[_0x390e3b(0x17c)][_0x390e3b(0x15a)]('noda',_0x390e3b(0x11e),_0x2d68c4[_0x390e3b(0x152)],_0x4eaedb,_0x26ac07);if(_0x4eaedb[_0x390e3b(0x10f)]||_0x4eaedb[_0x390e3b(0x119)]){const _0x30f5d9=_0x4eaedb[_0x390e3b(0x13c)]||_0x4eaedb[_0x390e3b(0x10f)]||_0x390e3b(0x12f);console[_0x390e3b(0x10f)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x390e3b(0x10f)](_0x390e3b(0x147),_0x30f5d9),console['error'](_0x390e3b(0x10d),_0x4eaedb[_0x390e3b(0x119)]),loggerService_1[_0x390e3b(0x17c)][_0x390e3b(0x162)](_0x390e3b(0x112),_0x390e3b(0x11e),_0x390e3b(0x116)+_0x30f5d9);throw new Error('Noda\x20API\x20error:\x20'+_0x30f5d9);}if(!_0x4eaedb['id']||!_0x4eaedb['shortLinkUrls']?.[_0x390e3b(0x126)]){console[_0x390e3b(0x10f)](_0x390e3b(0x153)),console[_0x390e3b(0x10f)](_0x390e3b(0x130)),console[_0x390e3b(0x10f)](_0x390e3b(0x14e),_0x4eaedb),loggerService_1[_0x390e3b(0x17c)]['logWhiteDomainError'](_0x390e3b(0x112),_0x390e3b(0x11e),_0x390e3b(0x161));throw new Error(_0x390e3b(0x12a));}return console[_0x390e3b(0x166)](_0x390e3b(0x174)),console['log'](_0x390e3b(0x178),_0x4eaedb['id']),console[_0x390e3b(0x166)](_0x390e3b(0x13a),_0x4eaedb[_0x390e3b(0x155)][_0x390e3b(0x126)]),console['log'](_0x390e3b(0x124),_0x4eaedb[_0x390e3b(0x155)][_0x390e3b(0x17a)]||_0x390e3b(0x16a)),console[_0x390e3b(0x166)]('Order\x20ID\x20Used:',_0x2cb6d5,_0x390e3b(0x135)),console['log'](_0x390e3b(0x15e),_0x1719aa),{'gateway_payment_id':_0x4eaedb['id'],'payment_url':_0x4eaedb['shortLinkUrls'][_0x390e3b(0x126)],'qr_code_url':_0x4eaedb[_0x390e3b(0x155)][_0x390e3b(0x17a)],'expiry_date':_0x4eaedb['expiryDate']};}catch(_0x2ac153){console['error'](_0x390e3b(0x182)),console['error'](_0x390e3b(0x128),_0x2ac153),loggerService_1[_0x390e3b(0x17c)][_0x390e3b(0x162)]('noda',_0x390e3b(0x11e),_0x2ac153);if(_0x2ac153 instanceof Error){console['error'](_0x390e3b(0x141),_0x2ac153[_0x390e3b(0x13c)]),console[_0x390e3b(0x10f)](_0x390e3b(0x143),_0x2ac153[_0x390e3b(0x129)]);throw new Error(_0x390e3b(0x14f)+_0x2ac153[_0x390e3b(0x13c)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a48_0x3b249a(0x139)](_0x473a0d){const _0x568901=a48_0x3b249a,_0x1e62a7=Date[_0x568901(0x108)]();try{loggerService_1[_0x568901(0x17c)][_0x568901(0x15d)](_0x568901(0x112),'/payment-links/'+_0x473a0d,_0x568901(0x134),{});const _0x427861=await fetch(this[_0x568901(0x146)]+'/'+_0x473a0d,{'method':'GET','headers':{'Content-Type':_0x568901(0x131),'User-Agent':_0x568901(0x17b)}}),_0x26b722=Date['now']()-_0x1e62a7;if(!_0x427861['ok']){const _0x5b6d3e=await _0x427861[_0x568901(0x177)]();loggerService_1[_0x568901(0x17c)][_0x568901(0x15a)](_0x568901(0x112),'/payment-links/'+_0x473a0d,_0x427861[_0x568901(0x152)],_0x5b6d3e,_0x26b722);throw new Error(_0x568901(0x17e)+_0x427861[_0x568901(0x152)]);}const _0x1cd7bc=await _0x427861['json']();loggerService_1[_0x568901(0x17c)][_0x568901(0x15a)]('noda',_0x568901(0x16f)+_0x473a0d,_0x427861[_0x568901(0x152)],_0x1cd7bc,_0x26b722);if(_0x1cd7bc[_0x568901(0x10f)]||_0x1cd7bc[_0x568901(0x119)]){loggerService_1[_0x568901(0x17c)]['logWhiteDomainError'](_0x568901(0x112),_0x568901(0x16f)+_0x473a0d,_0x568901(0x111)+(_0x1cd7bc[_0x568901(0x13c)]||_0x1cd7bc['error']||'Unknown\x20error'));throw new Error(_0x568901(0x111)+(_0x1cd7bc[_0x568901(0x13c)]||_0x1cd7bc[_0x568901(0x10f)]||_0x568901(0x159)));}let _0x33f5ec=_0x568901(0x148);if(_0x1cd7bc[_0x568901(0x175)]===![]){if(_0x1cd7bc[_0x568901(0x16c)]){const _0x1f8962=new Date(_0x1cd7bc['expiryDate']),_0x89ce91=new Date();_0x1f8962<_0x89ce91?_0x33f5ec=_0x568901(0x138):_0x33f5ec='FAILED';}else _0x33f5ec=_0x568901(0x115);}else _0x33f5ec=_0x568901(0x148);return{'status':_0x33f5ec,'amount':_0x1cd7bc[_0x568901(0x127)],'currency':_0x1cd7bc['currency'],'isActive':_0x1cd7bc[_0x568901(0x175)]};}catch(_0x4f231b){console[_0x568901(0x10f)](_0x568901(0x11a),_0x4f231b),loggerService_1['loggerService']['logWhiteDomainError'](_0x568901(0x112),_0x568901(0x16f)+_0x473a0d,_0x4f231b);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x4f231b instanceof Error?_0x4f231b[_0x568901(0x13c)]:_0x568901(0x159)));}}async[a48_0x3b249a(0x180)](_0x1c795f){const _0x1b0bdf=a48_0x3b249a;console[_0x1b0bdf(0x166)](_0x1b0bdf(0x10a),_0x1c795f);let _0x31811c=_0x1b0bdf(0x148);switch(_0x1c795f['Status']?.[_0x1b0bdf(0x10c)]()){case'done':case _0x1b0bdf(0x133):case _0x1b0bdf(0x15f):case _0x1b0bdf(0x154):case _0x1b0bdf(0x13f):_0x1c795f[_0x1b0bdf(0x160)]===_0x1b0bdf(0x12e)?_0x31811c=_0x1b0bdf(0x110):_0x31811c=_0x1b0bdf(0x148);break;case _0x1b0bdf(0x181):case _0x1b0bdf(0x165):case _0x1b0bdf(0x10e):case'error':case'rejected':_0x31811c='FAILED';break;case _0x1b0bdf(0x13e):case _0x1b0bdf(0x109):_0x31811c=_0x1b0bdf(0x138);break;case _0x1b0bdf(0x173):case _0x1b0bdf(0x179):case'active':case _0x1b0bdf(0x163):case _0x1b0bdf(0x183):default:_0x31811c=_0x1b0bdf(0x148);break;}return{'paymentId':_0x1c795f[_0x1b0bdf(0x13b)]||_0x1c795f[_0x1b0bdf(0x17d)],'status':_0x31811c,'amount':_0x1c795f['Amount'],'currency':_0x1c795f[_0x1b0bdf(0x144)],'additionalInfo':{'method':_0x1c795f[_0x1b0bdf(0x12d)],'bankId':_0x1c795f[_0x1b0bdf(0x151)],'settled':_0x1c795f[_0x1b0bdf(0x160)],'settlementDate':_0x1c795f['SettlementDate'],'remitterName':_0x1c795f[_0x1b0bdf(0x121)]?.[_0x1b0bdf(0x150)],'remitterIban':_0x1c795f[_0x1b0bdf(0x121)]?.[_0x1b0bdf(0x15c)],'bankTransactionId':_0x1c795f['BankTransactionId']}};}['verifyWebhookSignature'](_0x4a44b9,_0x285a0a){const _0xfd6e45=a48_0x3b249a;return console[_0xfd6e45(0x166)](_0xfd6e45(0x156),{'receivedSignature':_0x285a0a,'paymentId':_0x4a44b9[_0xfd6e45(0x17d)],'merchantPaymentId':_0x4a44b9['MerchantPaymentId']}),!![];}}exports[a48_0x3b249a(0x122)]=NodaService;