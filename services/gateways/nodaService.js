'use strict';const a50_0x5c9860=a50_0x2c87;(function(_0x1a4b69,_0x6a2e82){const _0xb3ef19=a50_0x2c87,_0x1fc890=_0x1a4b69();while(!![]){try{const _0x4ea9ec=parseInt(_0xb3ef19(0xe3))/0x1+-parseInt(_0xb3ef19(0xf0))/0x2*(-parseInt(_0xb3ef19(0x12b))/0x3)+parseInt(_0xb3ef19(0xdb))/0x4*(-parseInt(_0xb3ef19(0x10f))/0x5)+parseInt(_0xb3ef19(0x129))/0x6*(-parseInt(_0xb3ef19(0x124))/0x7)+-parseInt(_0xb3ef19(0xe8))/0x8*(-parseInt(_0xb3ef19(0xde))/0x9)+-parseInt(_0xb3ef19(0xc8))/0xa+parseInt(_0xb3ef19(0x12d))/0xb;if(_0x4ea9ec===_0x6a2e82)break;else _0x1fc890['push'](_0x1fc890['shift']());}catch(_0x4d9780){_0x1fc890['push'](_0x1fc890['shift']());}}}(a50_0x5dd7,0x731ce));function a50_0x2c87(_0x60d909,_0x341e77){const _0x5dd763=a50_0x5dd7();return a50_0x2c87=function(_0x2c87a3,_0x61043d){_0x2c87a3=_0x2c87a3-0xbe;let _0x3c7c6a=_0x5dd763[_0x2c87a3];return _0x3c7c6a;},a50_0x2c87(_0x60d909,_0x341e77);}Object[a50_0x5c9860(0x100)](exports,a50_0x5c9860(0xcf),{'value':!![]}),exports[a50_0x5c9860(0x10a)]=void 0x0;const loggerService_1=require(a50_0x5c9860(0xca));class NodaService{constructor(){const _0x44e1c2=a50_0x5c9860;this[_0x44e1c2(0x120)]=_0x44e1c2(0x127),console[_0x44e1c2(0x11d)](_0x44e1c2(0x109));}async['createPaymentLink'](_0x1b2d7e){const _0x283431=a50_0x5c9860,{orderId:_0x2692ce,name:_0x5f405a,paymentDescription:_0x3e8d1c,amount:_0x32903d,currency:_0x461ced,webhookUrl:_0x2208a0,returnUrl:_0x9258e7,expiryDate:_0x3859bf}=_0x1b2d7e,_0x46c847=_0x461ced[_0x283431(0x117)](),_0xb848c8='https://tesoft.uk/gateway/noda/webhook/',_0x3dcc26=_0x283431(0xe4)+_0x2692ce,_0x49e160={'name':_0x5f405a,'paymentDescription':_0x3e8d1c,'amount':_0x32903d,'currency':_0x46c847,'paymentId':_0x2692ce,'webhookUrl':_0xb848c8,'returnUrl':_0x3dcc26};_0x3859bf&&(_0x49e160['expiryDate']=_0x3859bf);const _0x4f44f9=Date[_0x283431(0xe9)]();try{console['log'](_0x283431(0xbf)),console[_0x283431(0x11d)]('URL:',this[_0x283431(0x120)]),console['log'](_0x283431(0x103),JSON[_0x283431(0x113)](_0x49e160,null,0x2)),console['log'](_0x283431(0xd2),_0x2692ce,'(8digits-8digits\x20format\x20for\x20Noda)'),console['log'](_0x283431(0x10b),_0x3dcc26),loggerService_1[_0x283431(0xfc)][_0x283431(0xe0)](_0x283431(0x130),_0x283431(0xf6),_0x283431(0xee),_0x49e160);const _0x18d176=await fetch(this[_0x283431(0x120)],{'method':_0x283431(0xee),'headers':{'Content-Type':_0x283431(0x11c),'Accept':_0x283431(0x11c),'User-Agent':_0x283431(0x12f)},'body':JSON[_0x283431(0x113)](_0x49e160)}),_0x169c52=Date['now']()-_0x4f44f9;console[_0x283431(0x11d)](_0x283431(0x104)),console['log'](_0x283431(0xdf),_0x18d176['status']),console[_0x283431(0x11d)](_0x283431(0x102),_0x18d176['statusText']),console[_0x283431(0x11d)](_0x283431(0x106),Object['fromEntries'](_0x18d176[_0x283431(0xd7)][_0x283431(0xd9)]())),console[_0x283431(0x11d)](_0x283431(0xea),_0x169c52+'ms');const _0x290a46=await _0x18d176[_0x283431(0x11f)]();console[_0x283431(0x11d)](_0x283431(0xeb),_0x290a46);if(!_0x18d176['ok']){console[_0x283431(0x115)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x283431(0x115)]('HTTP\x20Status:',_0x18d176[_0x283431(0xf9)]),console[_0x283431(0x115)](_0x283431(0x12e),_0x290a46),loggerService_1[_0x283431(0xfc)][_0x283431(0xfe)](_0x283431(0x130),_0x283431(0xf6),_0x18d176[_0x283431(0xf9)],_0x290a46,_0x169c52),loggerService_1['loggerService'][_0x283431(0x114)](_0x283431(0x130),_0x283431(0xf6),_0x283431(0x119)+_0x18d176[_0x283431(0xf9)]+':\x20'+_0x290a46);if(_0x18d176[_0x283431(0xf9)]===0x190)throw new Error(_0x283431(0xed));else{if(_0x18d176['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x283431(0xc2)+_0x18d176[_0x283431(0xf9)]+',\x20body:\x20'+_0x290a46);}let _0x27c88b;try{_0x27c88b=JSON['parse'](_0x290a46);}catch(_0x12f520){console[_0x283431(0x115)](_0x283431(0x126),_0x12f520),loggerService_1['loggerService'][_0x283431(0x114)]('noda','/payment-links',_0x283431(0x10e)+_0x12f520);throw new Error(_0x283431(0x131)+_0x290a46);}console[_0x283431(0x11d)](_0x283431(0x121)),console[_0x283431(0x11d)]('Parsed\x20Result:',JSON[_0x283431(0x113)](_0x27c88b,null,0x2)),loggerService_1[_0x283431(0xfc)]['logWhiteDomainResponse'](_0x283431(0x130),_0x283431(0xf6),_0x18d176[_0x283431(0xf9)],_0x27c88b,_0x169c52);if(_0x27c88b[_0x283431(0x115)]||_0x27c88b[_0x283431(0xce)]){const _0x3389ef=_0x27c88b['message']||_0x27c88b[_0x283431(0x115)]||'Unknown\x20error\x20from\x20Noda\x20API';console['error'](_0x283431(0xd0)),console[_0x283431(0x115)](_0x283431(0x12a),_0x3389ef),console[_0x283431(0x115)]('Status\x20Code:',_0x27c88b[_0x283431(0xce)]),loggerService_1[_0x283431(0xfc)][_0x283431(0x114)]('noda',_0x283431(0xf6),_0x283431(0xcb)+_0x3389ef);throw new Error('Noda\x20API\x20error:\x20'+_0x3389ef);}if(!_0x27c88b['id']||!_0x27c88b[_0x283431(0xe2)]?.[_0x283431(0xc9)]){console[_0x283431(0x115)](_0x283431(0x110)),console[_0x283431(0x115)](_0x283431(0xc6)),console[_0x283431(0x115)](_0x283431(0x11a),_0x27c88b),loggerService_1[_0x283431(0xfc)][_0x283431(0x114)](_0x283431(0x130),_0x283431(0xf6),_0x283431(0xdc));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console[_0x283431(0x11d)](_0x283431(0xe6),_0x27c88b['id']),console[_0x283431(0x11d)](_0x283431(0x135),_0x27c88b['shortLinkUrls']['shortLink']),console[_0x283431(0x11d)](_0x283431(0x11b),_0x27c88b['shortLinkUrls'][_0x283431(0x105)]||'Not\x20provided'),console[_0x283431(0x11d)](_0x283431(0xc7),_0x2692ce,_0x283431(0xf7)),console[_0x283431(0x11d)](_0x283431(0xc5),_0x3dcc26),{'gateway_payment_id':_0x27c88b['id'],'payment_url':_0x27c88b[_0x283431(0xe2)][_0x283431(0xc9)],'qr_code_url':_0x27c88b[_0x283431(0xe2)][_0x283431(0x105)],'expiry_date':_0x27c88b['expiryDate']};}catch(_0x210d2e){console[_0x283431(0x115)](_0x283431(0xec)),console[_0x283431(0x115)]('Error\x20details:',_0x210d2e),loggerService_1[_0x283431(0xfc)][_0x283431(0x114)](_0x283431(0x130),_0x283431(0xf6),_0x210d2e);if(_0x210d2e instanceof Error){console[_0x283431(0x115)](_0x283431(0xcc),_0x210d2e['message']),console[_0x283431(0x115)]('Error\x20stack:',_0x210d2e[_0x283431(0xf5)]);throw new Error(_0x283431(0xd4)+_0x210d2e[_0x283431(0x125)]);}throw new Error(_0x283431(0xe1));}}async[a50_0x5c9860(0xf2)](_0x2d8f55){const _0x4c9c03=a50_0x5c9860,_0x1c034f=Date[_0x4c9c03(0xe9)]();try{loggerService_1[_0x4c9c03(0xfc)][_0x4c9c03(0xe0)]('noda','/payment-links/'+_0x2d8f55,_0x4c9c03(0xfb),{});const _0x163b2c=await fetch(this['apiUrl']+'/'+_0x2d8f55,{'method':_0x4c9c03(0xfb),'headers':{'Content-Type':_0x4c9c03(0x11c),'User-Agent':_0x4c9c03(0x12f)}}),_0x25ea11=Date[_0x4c9c03(0xe9)]()-_0x1c034f;if(!_0x163b2c['ok']){const _0x4bda90=await _0x163b2c['text']();loggerService_1['loggerService'][_0x4c9c03(0xfe)](_0x4c9c03(0x130),_0x4c9c03(0x133)+_0x2d8f55,_0x163b2c['status'],_0x4bda90,_0x25ea11);throw new Error(_0x4c9c03(0xc2)+_0x163b2c[_0x4c9c03(0xf9)]);}const _0xa48caf=await _0x163b2c[_0x4c9c03(0xda)]();loggerService_1[_0x4c9c03(0xfc)][_0x4c9c03(0xfe)](_0x4c9c03(0x130),'/payment-links/'+_0x2d8f55,_0x163b2c[_0x4c9c03(0xf9)],_0xa48caf,_0x25ea11);if(_0xa48caf[_0x4c9c03(0x115)]||_0xa48caf[_0x4c9c03(0xce)]){loggerService_1['loggerService'][_0x4c9c03(0x114)](_0x4c9c03(0x130),_0x4c9c03(0x133)+_0x2d8f55,_0x4c9c03(0xd6)+(_0xa48caf['message']||_0xa48caf[_0x4c9c03(0x115)]||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0xa48caf[_0x4c9c03(0x125)]||_0xa48caf[_0x4c9c03(0x115)]||'Unknown\x20error'));}let _0x3fde3c='PENDING';if(_0xa48caf[_0x4c9c03(0x122)]===![]){if(_0xa48caf[_0x4c9c03(0xfd)]){const _0x5e947c=new Date(_0xa48caf['expiryDate']),_0x3c646e=new Date();_0x5e947c<_0x3c646e?_0x3fde3c='EXPIRED':_0x3fde3c='FAILED';}else _0x3fde3c=_0x4c9c03(0x128);}else _0x3fde3c=_0x4c9c03(0x112);return{'status':_0x3fde3c,'amount':_0xa48caf[_0x4c9c03(0x107)],'currency':_0xa48caf['currency'],'isActive':_0xa48caf[_0x4c9c03(0x122)]};}catch(_0x26bf67){console[_0x4c9c03(0x115)](_0x4c9c03(0xdd),_0x26bf67),loggerService_1[_0x4c9c03(0xfc)][_0x4c9c03(0x114)]('noda',_0x4c9c03(0x133)+_0x2d8f55,_0x26bf67);throw new Error(_0x4c9c03(0x10d)+(_0x26bf67 instanceof Error?_0x26bf67[_0x4c9c03(0x125)]:_0x4c9c03(0xd5)));}}async['processWebhook'](_0x3f2dc9){const _0xac5ebc=a50_0x5c9860;console[_0xac5ebc(0x11d)](_0xac5ebc(0x10c),_0x3f2dc9);let _0x2132a0=_0xac5ebc(0x112);switch(_0x3f2dc9[_0xac5ebc(0x118)]?.['toLowerCase']()){case _0xac5ebc(0xbe):case'completed':case _0xac5ebc(0xd1):case _0xac5ebc(0xe5):case _0xac5ebc(0xc4):_0x3f2dc9['Settled']==='Yes'?_0x2132a0=_0xac5ebc(0x111):_0x2132a0=_0xac5ebc(0x112);break;case _0xac5ebc(0xd3):case'canceled':case _0xac5ebc(0xf4):case _0xac5ebc(0x115):case _0xac5ebc(0xcd):_0x2132a0=_0xac5ebc(0x128);break;case _0xac5ebc(0x12c):case _0xac5ebc(0xef):_0x2132a0=_0xac5ebc(0xfa);break;case _0xac5ebc(0x123):case _0xac5ebc(0xf3):case _0xac5ebc(0xd8):case _0xac5ebc(0x116):case'in_progress':default:_0x2132a0=_0xac5ebc(0x112);break;}return{'paymentId':_0x3f2dc9['MerchantPaymentId']||_0x3f2dc9['PaymentId'],'status':_0x2132a0,'amount':_0x3f2dc9['Amount'],'currency':_0x3f2dc9[_0xac5ebc(0xc1)],'additionalInfo':{'method':_0x3f2dc9[_0xac5ebc(0x11e)],'bankId':_0x3f2dc9[_0xac5ebc(0x108)],'settled':_0x3f2dc9[_0xac5ebc(0xe7)],'settlementDate':_0x3f2dc9[_0xac5ebc(0xf8)],'remitterName':_0x3f2dc9[_0xac5ebc(0xff)]?.['Name'],'remitterIban':_0x3f2dc9[_0xac5ebc(0xff)]?.[_0xac5ebc(0x101)],'bankTransactionId':_0x3f2dc9[_0xac5ebc(0xc3)]}};}[a50_0x5c9860(0xc0)](_0x355249,_0x1ce201){const _0x161736=a50_0x5c9860;return console[_0x161736(0x11d)](_0x161736(0x134),{'receivedSignature':_0x1ce201,'paymentId':_0x355249[_0x161736(0x132)],'merchantPaymentId':_0x355249[_0x161736(0xf1)]}),!![];}}exports[a50_0x5c9860(0x10a)]=NodaService;function a50_0x5dd7(){const _0x2f20ab=['2508910jJtyFr','shortLink','../loggerService','Business\x20Error:\x20','Error\x20message:','rejected','statusCode','__esModule','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','paid','Order\x20ID\x20Format:','cancelled','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Unknown\x20error','Noda\x20API\x20error:\x20','headers','active','entries','json','3104020ViXXcc','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Noda\x20payment\x20verification\x20error:','144CPcqmK','Status:','logWhiteDomainRequest','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','shortLinkUrls','180860GeQVkG','https://tesoft.uk/gateway/pending.php?id=','success','Payment\x20Link\x20ID:','Settled','199064TUqtpG','now','Response\x20Time:','Raw\x20Response\x20Body:','===\x20NODA\x20SERVICE\x20ERROR\x20===','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','POST','timeout','3234cShAPL','MerchantPaymentId','verifyPayment','created','failed','stack','/payment-links','(8digits-8digits\x20format)','SettlementDate','status','EXPIRED','GET','loggerService','expiryDate','logWhiteDomainResponse','Remitter','defineProperty','Iban','Status\x20Text:','Request\x20Body\x20(Direct\x20JSON):','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','qrCodeLink','Headers:','amount','BankId','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','NodaService','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','Processing\x20Noda\x20webhook:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','JSON\x20Parse\x20Error:\x20','5faydNj','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PAID','PENDING','stringify','logWhiteDomainError','error','processing','toUpperCase','Status','HTTP\x20','Response\x20data:','QR\x20Code\x20Link:','application/json','log','Method','text','apiUrl','===\x20PARSED\x20NODA\x20RESPONSE\x20===','isActive','pending','35TvZdno','message','Failed\x20to\x20parse\x20JSON\x20response:','https://tesoft.uk/gateway/noda/','FAILED','232938gSWqMl','Error\x20Message:','201Pwvnie','expired','11057046auUMtq','Response\x20Body:','Payment\x20System/1.0','noda','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','PaymentId','/payment-links/','Noda\x20webhook\x20signature\x20verification:','Short\x20Link:','done','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','verifyWebhookSignature','Currency','HTTP\x20error!\x20status:\x20','BankTransactionId','successful','✅\x20Return\x20URL\x20configured\x20for\x20pending:','Missing\x20id\x20or\x20shortLink\x20in\x20response','Order\x20ID\x20Used:'];a50_0x5dd7=function(){return _0x2f20ab;};return a50_0x5dd7();}