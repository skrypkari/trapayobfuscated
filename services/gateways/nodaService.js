'use strict';const a40_0x2278bd=a40_0x1a31;(function(_0x3c9b9d,_0x10f757){const _0x34006b=a40_0x1a31,_0x5ace5c=_0x3c9b9d();while(!![]){try{const _0x1e3094=parseInt(_0x34006b(0x17d))/0x1*(-parseInt(_0x34006b(0x109))/0x2)+-parseInt(_0x34006b(0x169))/0x3*(-parseInt(_0x34006b(0x11f))/0x4)+-parseInt(_0x34006b(0x133))/0x5*(-parseInt(_0x34006b(0x132))/0x6)+-parseInt(_0x34006b(0x156))/0x7*(parseInt(_0x34006b(0x146))/0x8)+-parseInt(_0x34006b(0x121))/0x9+parseInt(_0x34006b(0x14f))/0xa+parseInt(_0x34006b(0x12a))/0xb*(parseInt(_0x34006b(0x115))/0xc);if(_0x1e3094===_0x10f757)break;else _0x5ace5c['push'](_0x5ace5c['shift']());}catch(_0x4fab55){_0x5ace5c['push'](_0x5ace5c['shift']());}}}(a40_0x5817,0xc390e));function a40_0x1a31(_0x17da9b,_0x5ce0fd){const _0x581727=a40_0x5817();return a40_0x1a31=function(_0x1a311d,_0x1f7c76){_0x1a311d=_0x1a311d-0x102;let _0x1f3128=_0x581727[_0x1a311d];return _0x1f3128;},a40_0x1a31(_0x17da9b,_0x5ce0fd);}Object[a40_0x2278bd(0x108)](exports,a40_0x2278bd(0x177),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x1ca56b=a40_0x2278bd;this['apiUrl']=_0x1ca56b(0x144),console['log'](_0x1ca56b(0x160));}async['createPaymentLink'](_0x42a7c5){const _0x2034bd=a40_0x2278bd,{orderId:_0x31e38d,name:_0xaa939d,paymentDescription:_0x5bf72e,amount:_0x2cbbeb,currency:_0x29f981,webhookUrl:_0x4528f2,returnUrl:_0x21df53,expiryDate:_0x9c7e08}=_0x42a7c5,_0x4b3b58=_0x29f981['toUpperCase'](),_0x4b9929=_0x2034bd(0x175),_0x4b66d6=_0x2034bd(0x157)+_0x31e38d,_0x549adc={'name':_0xaa939d,'paymentDescription':_0x5bf72e,'amount':_0x2cbbeb,'currency':_0x4b3b58,'paymentId':_0x31e38d,'webhookUrl':_0x4b9929,'returnUrl':_0x4b66d6};_0x9c7e08&&(_0x549adc[_0x2034bd(0x154)]=_0x9c7e08);const _0x409385=Date[_0x2034bd(0x111)]();try{console[_0x2034bd(0x147)](_0x2034bd(0x112)),console[_0x2034bd(0x147)](_0x2034bd(0x176),this[_0x2034bd(0x13d)]),console[_0x2034bd(0x147)](_0x2034bd(0x120),JSON[_0x2034bd(0x163)](_0x549adc,null,0x2)),console[_0x2034bd(0x147)](_0x2034bd(0x11d),_0x31e38d,_0x2034bd(0x145)),console['log']('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x4b66d6),loggerService_1[_0x2034bd(0x13f)]['logWhiteDomainRequest'](_0x2034bd(0x161),_0x2034bd(0x118),_0x2034bd(0x135),_0x549adc);const _0x1bc0fb=await fetch(this['apiUrl'],{'method':_0x2034bd(0x135),'headers':{'Content-Type':_0x2034bd(0x162),'Accept':_0x2034bd(0x162),'User-Agent':_0x2034bd(0x114)},'body':JSON[_0x2034bd(0x163)](_0x549adc)}),_0x57d123=Date['now']()-_0x409385;console[_0x2034bd(0x147)](_0x2034bd(0x171)),console[_0x2034bd(0x147)](_0x2034bd(0x103),_0x1bc0fb['status']),console[_0x2034bd(0x147)](_0x2034bd(0x179),_0x1bc0fb[_0x2034bd(0x10f)]),console[_0x2034bd(0x147)](_0x2034bd(0x130),Object[_0x2034bd(0x15a)](_0x1bc0fb[_0x2034bd(0x164)][_0x2034bd(0x149)]())),console['log']('Response\x20Time:',_0x57d123+'ms');const _0x14c8bb=await _0x1bc0fb[_0x2034bd(0x13a)]();console['log'](_0x2034bd(0x105),_0x14c8bb);if(!_0x1bc0fb['ok']){console['error'](_0x2034bd(0x141)),console[_0x2034bd(0x14b)](_0x2034bd(0x151),_0x1bc0fb[_0x2034bd(0x152)]),console[_0x2034bd(0x14b)]('Response\x20Body:',_0x14c8bb),loggerService_1[_0x2034bd(0x13f)][_0x2034bd(0x16e)](_0x2034bd(0x161),_0x2034bd(0x118),_0x1bc0fb['status'],_0x14c8bb,_0x57d123),loggerService_1[_0x2034bd(0x13f)][_0x2034bd(0x178)](_0x2034bd(0x161),_0x2034bd(0x118),_0x2034bd(0x12b)+_0x1bc0fb[_0x2034bd(0x152)]+':\x20'+_0x14c8bb);if(_0x1bc0fb[_0x2034bd(0x152)]===0x190)throw new Error(_0x2034bd(0x11c));else{if(_0x1bc0fb[_0x2034bd(0x152)]===0x1f4)throw new Error(_0x2034bd(0x14d));}throw new Error(_0x2034bd(0x102)+_0x1bc0fb[_0x2034bd(0x152)]+_0x2034bd(0x15e)+_0x14c8bb);}let _0x6066dc;try{_0x6066dc=JSON[_0x2034bd(0x165)](_0x14c8bb);}catch(_0x226aa2){console[_0x2034bd(0x14b)](_0x2034bd(0x170),_0x226aa2),loggerService_1[_0x2034bd(0x13f)][_0x2034bd(0x178)](_0x2034bd(0x161),_0x2034bd(0x118),'JSON\x20Parse\x20Error:\x20'+_0x226aa2);throw new Error(_0x2034bd(0x140)+_0x14c8bb);}console[_0x2034bd(0x147)](_0x2034bd(0x125)),console[_0x2034bd(0x147)](_0x2034bd(0x11e),JSON[_0x2034bd(0x163)](_0x6066dc,null,0x2)),loggerService_1['loggerService'][_0x2034bd(0x16e)](_0x2034bd(0x161),_0x2034bd(0x118),_0x1bc0fb['status'],_0x6066dc,_0x57d123);if(_0x6066dc[_0x2034bd(0x14b)]||_0x6066dc[_0x2034bd(0x16a)]){const _0x4fdf29=_0x6066dc[_0x2034bd(0x13e)]||_0x6066dc['error']||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x2034bd(0x14b)](_0x2034bd(0x10e)),console['error']('Error\x20Message:',_0x4fdf29),console['error'](_0x2034bd(0x148),_0x6066dc[_0x2034bd(0x16a)]),loggerService_1[_0x2034bd(0x13f)][_0x2034bd(0x178)](_0x2034bd(0x161),'/payment-links',_0x2034bd(0x15f)+_0x4fdf29);throw new Error('Noda\x20API\x20error:\x20'+_0x4fdf29);}if(!_0x6066dc['id']||!_0x6066dc[_0x2034bd(0x159)]?.['shortLink']){console['error'](_0x2034bd(0x13b)),console[_0x2034bd(0x14b)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x2034bd(0x14b)](_0x2034bd(0x142),_0x6066dc),loggerService_1[_0x2034bd(0x13f)][_0x2034bd(0x178)](_0x2034bd(0x161),_0x2034bd(0x118),_0x2034bd(0x131));throw new Error(_0x2034bd(0x10d));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console[_0x2034bd(0x147)](_0x2034bd(0x16c),_0x6066dc['id']),console[_0x2034bd(0x147)]('Short\x20Link:',_0x6066dc[_0x2034bd(0x159)]['shortLink']),console[_0x2034bd(0x147)](_0x2034bd(0x16d),_0x6066dc[_0x2034bd(0x159)][_0x2034bd(0x12c)]||_0x2034bd(0x123)),console['log'](_0x2034bd(0x17b),_0x31e38d,_0x2034bd(0x127)),console[_0x2034bd(0x147)](_0x2034bd(0x124),_0x4b66d6),{'gateway_payment_id':_0x6066dc['id'],'payment_url':_0x6066dc[_0x2034bd(0x159)][_0x2034bd(0x106)],'qr_code_url':_0x6066dc[_0x2034bd(0x159)][_0x2034bd(0x12c)],'expiry_date':_0x6066dc[_0x2034bd(0x154)]};}catch(_0x16252b){console[_0x2034bd(0x14b)](_0x2034bd(0x15d)),console[_0x2034bd(0x14b)]('Error\x20details:',_0x16252b),loggerService_1['loggerService'][_0x2034bd(0x178)](_0x2034bd(0x161),_0x2034bd(0x118),_0x16252b);if(_0x16252b instanceof Error){console[_0x2034bd(0x14b)](_0x2034bd(0x158),_0x16252b['message']),console['error'](_0x2034bd(0x173),_0x16252b[_0x2034bd(0x117)]);throw new Error(_0x2034bd(0x166)+_0x16252b['message']);}throw new Error(_0x2034bd(0x129));}}async['verifyPayment'](_0xd40517){const _0x3b501c=a40_0x2278bd,_0x3b3f9c=Date[_0x3b501c(0x111)]();try{loggerService_1[_0x3b501c(0x13f)][_0x3b501c(0x12f)]('noda',_0x3b501c(0x174)+_0xd40517,_0x3b501c(0x153),{});const _0x3a5d5e=await fetch(this[_0x3b501c(0x13d)]+'/'+_0xd40517,{'method':'GET','headers':{'Content-Type':_0x3b501c(0x162),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x38aa93=Date[_0x3b501c(0x111)]()-_0x3b3f9c;if(!_0x3a5d5e['ok']){const _0x43b9c8=await _0x3a5d5e['text']();loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0x3b501c(0x174)+_0xd40517,_0x3a5d5e[_0x3b501c(0x152)],_0x43b9c8,_0x38aa93);throw new Error(_0x3b501c(0x102)+_0x3a5d5e[_0x3b501c(0x152)]);}const _0x1ac15d=await _0x3a5d5e['json']();loggerService_1[_0x3b501c(0x13f)]['logWhiteDomainResponse'](_0x3b501c(0x161),_0x3b501c(0x174)+_0xd40517,_0x3a5d5e[_0x3b501c(0x152)],_0x1ac15d,_0x38aa93);if(_0x1ac15d[_0x3b501c(0x14b)]||_0x1ac15d['statusCode']){loggerService_1[_0x3b501c(0x13f)]['logWhiteDomainError'](_0x3b501c(0x161),_0x3b501c(0x174)+_0xd40517,_0x3b501c(0x16f)+(_0x1ac15d['message']||_0x1ac15d[_0x3b501c(0x14b)]||'Unknown\x20error'));throw new Error(_0x3b501c(0x16f)+(_0x1ac15d[_0x3b501c(0x13e)]||_0x1ac15d[_0x3b501c(0x14b)]||_0x3b501c(0x134)));}let _0x475e76='PENDING';if(_0x1ac15d['isActive']===![]){if(_0x1ac15d[_0x3b501c(0x154)]){const _0x45adbe=new Date(_0x1ac15d[_0x3b501c(0x154)]),_0x4fc8f7=new Date();_0x45adbe<_0x4fc8f7?_0x475e76=_0x3b501c(0x14c):_0x475e76=_0x3b501c(0x150);}else _0x475e76='FAILED';}else _0x475e76=_0x3b501c(0x104);return{'status':_0x475e76,'amount':_0x1ac15d[_0x3b501c(0x122)],'currency':_0x1ac15d['currency'],'isActive':_0x1ac15d[_0x3b501c(0x107)]};}catch(_0x4b814d){console[_0x3b501c(0x14b)](_0x3b501c(0x10a),_0x4b814d),loggerService_1[_0x3b501c(0x13f)][_0x3b501c(0x178)]('noda','/payment-links/'+_0xd40517,_0x4b814d);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x4b814d instanceof Error?_0x4b814d[_0x3b501c(0x13e)]:_0x3b501c(0x134)));}}async['processWebhook'](_0x430c91){const _0x362037=a40_0x2278bd;console[_0x362037(0x147)](_0x362037(0x137),_0x430c91);let _0x156dd8=_0x362037(0x104);switch(_0x430c91[_0x362037(0x128)]?.[_0x362037(0x14a)]()){case _0x362037(0x138):case _0x362037(0x168):case'paid':case _0x362037(0x13c):case _0x362037(0x10c):_0x430c91[_0x362037(0x110)]==='Yes'?_0x156dd8=_0x362037(0x12e):_0x156dd8=_0x362037(0x104);break;case _0x362037(0x11b):case _0x362037(0x136):case'failed':case _0x362037(0x14b):case _0x362037(0x119):_0x156dd8=_0x362037(0x150);break;case _0x362037(0x11a):case _0x362037(0x143):_0x156dd8='EXPIRED';break;case _0x362037(0x113):case'created':case'active':case _0x362037(0x139):case _0x362037(0x16b):default:_0x156dd8=_0x362037(0x104);break;}return{'paymentId':_0x430c91[_0x362037(0x116)]||_0x430c91[_0x362037(0x172)],'status':_0x156dd8,'amount':_0x430c91[_0x362037(0x155)],'currency':_0x430c91[_0x362037(0x14e)],'additionalInfo':{'method':_0x430c91['Method'],'bankId':_0x430c91[_0x362037(0x17a)],'settled':_0x430c91[_0x362037(0x110)],'settlementDate':_0x430c91[_0x362037(0x15c)],'remitterName':_0x430c91[_0x362037(0x17c)]?.[_0x362037(0x126)],'remitterIban':_0x430c91[_0x362037(0x17c)]?.[_0x362037(0x15b)],'bankTransactionId':_0x430c91[_0x362037(0x167)]}};}[a40_0x2278bd(0x12d)](_0x4f9f0d,_0x10aaf9){const _0x1eddd8=a40_0x2278bd;return console[_0x1eddd8(0x147)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x10aaf9,'paymentId':_0x4f9f0d[_0x1eddd8(0x172)],'merchantPaymentId':_0x4f9f0d['MerchantPaymentId']}),!![];}}exports[a40_0x2278bd(0x10b)]=NodaService;function a40_0x5817(){const _0x298a62=['405kzYQlJ','HTTP\x20error!\x20status:\x20','Status:','PENDING','Raw\x20Response\x20Body:','shortLink','isActive','defineProperty','4926xVlDDV','Noda\x20payment\x20verification\x20error:','NodaService','successful','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','statusText','Settled','now','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','pending','TesSoft\x20Payment\x20System/1.0','1126788YaGwDR','MerchantPaymentId','stack','/payment-links','rejected','expired','cancelled','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Order\x20ID\x20Format:','Parsed\x20Result:','5064mUkbzg','Request\x20Body\x20(Direct\x20JSON):','10287513icsLme','amount','Not\x20provided','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Name','(8digits-8digits\x20format)','Status','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','231dKjtpq','HTTP\x20','qrCodeLink','verifyWebhookSignature','PAID','logWhiteDomainRequest','Headers:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','64254gPdYbn','525hfdmDq','Unknown\x20error','POST','canceled','Processing\x20Noda\x20webhook:','done','processing','text','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','success','apiUrl','message','loggerService','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','===\x20NODA\x20API\x20ERROR\x20===','Response\x20data:','timeout','https://tesoft.uk/gateway/noda/','(8digits-8digits\x20format\x20for\x20Noda)','128008lOXYAh','log','Status\x20Code:','entries','toLowerCase','error','EXPIRED','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Currency','3743750eUbZdV','FAILED','HTTP\x20Status:','status','GET','expiryDate','Amount','273tPIYDt','https://tesoft.uk/gateway/pending.php?id=','Error\x20message:','shortLinkUrls','fromEntries','Iban','SettlementDate','===\x20NODA\x20SERVICE\x20ERROR\x20===',',\x20body:\x20','Business\x20Error:\x20','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','noda','application/json','stringify','headers','parse','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','BankTransactionId','completed','225NkiDav','statusCode','in_progress','Payment\x20Link\x20ID:','QR\x20Code\x20Link:','logWhiteDomainResponse','Noda\x20API\x20error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','PaymentId','Error\x20stack:','/payment-links/','https://tesoft.uk/gateway/noda/webhook/','URL:','__esModule','logWhiteDomainError','Status\x20Text:','BankId','Order\x20ID\x20Used:','Remitter'];a40_0x5817=function(){return _0x298a62;};return a40_0x5817();}