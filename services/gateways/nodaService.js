'use strict';function a50_0x4190(_0x23c9d4,_0x5f0a36){const _0x5f0483=a50_0x5f04();return a50_0x4190=function(_0x4190c0,_0x2373fc){_0x4190c0=_0x4190c0-0x142;let _0x1b8e39=_0x5f0483[_0x4190c0];return _0x1b8e39;},a50_0x4190(_0x23c9d4,_0x5f0a36);}const a50_0x32da7f=a50_0x4190;(function(_0x51988b,_0x2a4661){const _0x50a76f=a50_0x4190,_0xd959d8=_0x51988b();while(!![]){try{const _0x440a90=-parseInt(_0x50a76f(0x18b))/0x1*(parseInt(_0x50a76f(0x191))/0x2)+-parseInt(_0x50a76f(0x163))/0x3+parseInt(_0x50a76f(0x181))/0x4+parseInt(_0x50a76f(0x1a2))/0x5+parseInt(_0x50a76f(0x1a9))/0x6*(parseInt(_0x50a76f(0x171))/0x7)+-parseInt(_0x50a76f(0x186))/0x8*(parseInt(_0x50a76f(0x176))/0x9)+parseInt(_0x50a76f(0x1af))/0xa;if(_0x440a90===_0x2a4661)break;else _0xd959d8['push'](_0xd959d8['shift']());}catch(_0x4ab065){_0xd959d8['push'](_0xd959d8['shift']());}}}(a50_0x5f04,0xe2040));Object[a50_0x32da7f(0x1a6)](exports,a50_0x32da7f(0x1ba),{'value':!![]}),exports[a50_0x32da7f(0x146)]=void 0x0;const loggerService_1=require(a50_0x32da7f(0x1b1));class NodaService{constructor(){const _0x59ac78=a50_0x32da7f;this[_0x59ac78(0x149)]=_0x59ac78(0x17f),console['log'](_0x59ac78(0x1a7));}async['createPaymentLink'](_0x170da8){const _0x2630a7=a50_0x32da7f,{orderId:_0x31d40b,name:_0x177576,paymentDescription:_0x34cc0b,amount:_0x10eec7,currency:_0x4dadf6,webhookUrl:_0x424cc8,returnUrl:_0x582842,expiryDate:_0x725157}=_0x170da8,_0x4ffdc8=_0x4dadf6[_0x2630a7(0x17a)](),_0x86c80e=_0x2630a7(0x196),_0x33a82a=_0x2630a7(0x173)+_0x31d40b,_0x12465c={'name':_0x177576,'paymentDescription':_0x34cc0b,'amount':_0x10eec7,'currency':_0x4ffdc8,'paymentId':_0x31d40b,'webhookUrl':_0x86c80e,'returnUrl':_0x33a82a};_0x725157&&(_0x12465c['expiryDate']=_0x725157);const _0x272766=Date[_0x2630a7(0x164)]();try{console[_0x2630a7(0x1a8)](_0x2630a7(0x1b3)),console[_0x2630a7(0x1a8)](_0x2630a7(0x151),this[_0x2630a7(0x149)]),console['log'](_0x2630a7(0x15e),JSON['stringify'](_0x12465c,null,0x2)),console[_0x2630a7(0x1a8)](_0x2630a7(0x1bc),_0x31d40b,_0x2630a7(0x14d)),console['log'](_0x2630a7(0x142),_0x33a82a),loggerService_1[_0x2630a7(0x1bd)][_0x2630a7(0x183)](_0x2630a7(0x158),_0x2630a7(0x1b7),_0x2630a7(0x1b0),_0x12465c);const _0x113edc=await fetch(this[_0x2630a7(0x149)],{'method':_0x2630a7(0x1b0),'headers':{'Content-Type':_0x2630a7(0x19f),'Accept':_0x2630a7(0x19f),'User-Agent':_0x2630a7(0x157)},'body':JSON[_0x2630a7(0x1b4)](_0x12465c)}),_0x38214c=Date[_0x2630a7(0x164)]()-_0x272766;console[_0x2630a7(0x1a8)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x2630a7(0x1a8)](_0x2630a7(0x14f),_0x113edc[_0x2630a7(0x1ae)]),console[_0x2630a7(0x1a8)](_0x2630a7(0x161),_0x113edc[_0x2630a7(0x188)]),console[_0x2630a7(0x1a8)]('Headers:',Object[_0x2630a7(0x15a)](_0x113edc[_0x2630a7(0x14c)][_0x2630a7(0x159)]())),console[_0x2630a7(0x1a8)](_0x2630a7(0x195),_0x38214c+'ms');const _0xd7024d=await _0x113edc[_0x2630a7(0x15f)]();console[_0x2630a7(0x1a8)](_0x2630a7(0x1b9),_0xd7024d);if(!_0x113edc['ok']){console[_0x2630a7(0x198)](_0x2630a7(0x156)),console[_0x2630a7(0x198)](_0x2630a7(0x162),_0x113edc[_0x2630a7(0x1ae)]),console[_0x2630a7(0x198)](_0x2630a7(0x19e),_0xd7024d),loggerService_1[_0x2630a7(0x1bd)][_0x2630a7(0x194)](_0x2630a7(0x158),_0x2630a7(0x1b7),_0x113edc[_0x2630a7(0x1ae)],_0xd7024d,_0x38214c),loggerService_1[_0x2630a7(0x1bd)][_0x2630a7(0x1ad)](_0x2630a7(0x158),'/payment-links',_0x2630a7(0x19c)+_0x113edc['status']+':\x20'+_0xd7024d);if(_0x113edc[_0x2630a7(0x1ae)]===0x190)throw new Error(_0x2630a7(0x16d));else{if(_0x113edc[_0x2630a7(0x1ae)]===0x1f4)throw new Error(_0x2630a7(0x15b));}throw new Error(_0x2630a7(0x18f)+_0x113edc[_0x2630a7(0x1ae)]+_0x2630a7(0x17c)+_0xd7024d);}let _0x4d105e;try{_0x4d105e=JSON['parse'](_0xd7024d);}catch(_0x129ed4){console[_0x2630a7(0x198)](_0x2630a7(0x1b2),_0x129ed4),loggerService_1['loggerService'][_0x2630a7(0x1ad)](_0x2630a7(0x158),_0x2630a7(0x1b7),_0x2630a7(0x19d)+_0x129ed4);throw new Error(_0x2630a7(0x178)+_0xd7024d);}console[_0x2630a7(0x1a8)](_0x2630a7(0x154)),console[_0x2630a7(0x1a8)](_0x2630a7(0x1a3),JSON[_0x2630a7(0x1b4)](_0x4d105e,null,0x2)),loggerService_1[_0x2630a7(0x1bd)]['logWhiteDomainResponse'](_0x2630a7(0x158),_0x2630a7(0x1b7),_0x113edc[_0x2630a7(0x1ae)],_0x4d105e,_0x38214c);if(_0x4d105e[_0x2630a7(0x198)]||_0x4d105e['statusCode']){const _0x291d44=_0x4d105e['message']||_0x4d105e[_0x2630a7(0x198)]||_0x2630a7(0x1b6);console[_0x2630a7(0x198)](_0x2630a7(0x16c)),console[_0x2630a7(0x198)](_0x2630a7(0x1b5),_0x291d44),console['error'](_0x2630a7(0x145),_0x4d105e[_0x2630a7(0x18a)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x2630a7(0x158),'/payment-links',_0x2630a7(0x1b8)+_0x291d44);throw new Error(_0x2630a7(0x187)+_0x291d44);}if(!_0x4d105e['id']||!_0x4d105e['shortLinkUrls']?.[_0x2630a7(0x16b)]){console[_0x2630a7(0x198)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2630a7(0x198)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x2630a7(0x198)]('Response\x20data:',_0x4d105e),loggerService_1[_0x2630a7(0x1bd)][_0x2630a7(0x1ad)](_0x2630a7(0x158),_0x2630a7(0x1b7),_0x2630a7(0x169));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x2630a7(0x1a8)](_0x2630a7(0x197)),console['log'](_0x2630a7(0x14e),_0x4d105e['id']),console[_0x2630a7(0x1a8)](_0x2630a7(0x144),_0x4d105e[_0x2630a7(0x172)]['shortLink']),console[_0x2630a7(0x1a8)](_0x2630a7(0x174),_0x4d105e[_0x2630a7(0x172)]['qrCodeLink']||_0x2630a7(0x182)),console[_0x2630a7(0x1a8)](_0x2630a7(0x166),_0x31d40b,_0x2630a7(0x155)),console[_0x2630a7(0x1a8)](_0x2630a7(0x16a),_0x33a82a),{'gateway_payment_id':_0x4d105e['id'],'payment_url':_0x4d105e[_0x2630a7(0x172)][_0x2630a7(0x16b)],'qr_code_url':_0x4d105e[_0x2630a7(0x172)][_0x2630a7(0x190)],'expiry_date':_0x4d105e[_0x2630a7(0x1ac)]};}catch(_0x26f5fd){console[_0x2630a7(0x198)](_0x2630a7(0x1a0)),console[_0x2630a7(0x198)]('Error\x20details:',_0x26f5fd),loggerService_1[_0x2630a7(0x1bd)][_0x2630a7(0x1ad)]('noda',_0x2630a7(0x1b7),_0x26f5fd);if(_0x26f5fd instanceof Error){console[_0x2630a7(0x198)]('Error\x20message:',_0x26f5fd[_0x2630a7(0x153)]),console['error']('Error\x20stack:',_0x26f5fd[_0x2630a7(0x18e)]);throw new Error(_0x2630a7(0x19b)+_0x26f5fd[_0x2630a7(0x153)]);}throw new Error(_0x2630a7(0x199));}}async[a50_0x32da7f(0x167)](_0x17eff5){const _0x55161e=a50_0x32da7f,_0x504c04=Date[_0x55161e(0x164)]();try{loggerService_1[_0x55161e(0x1bd)]['logWhiteDomainRequest']('noda',_0x55161e(0x193)+_0x17eff5,'GET',{});const _0x433620=await fetch(this[_0x55161e(0x149)]+'/'+_0x17eff5,{'method':_0x55161e(0x179),'headers':{'Content-Type':_0x55161e(0x19f),'User-Agent':_0x55161e(0x157)}}),_0x2748d2=Date[_0x55161e(0x164)]()-_0x504c04;if(!_0x433620['ok']){const _0x16c325=await _0x433620['text']();loggerService_1['loggerService'][_0x55161e(0x194)](_0x55161e(0x158),_0x55161e(0x193)+_0x17eff5,_0x433620['status'],_0x16c325,_0x2748d2);throw new Error(_0x55161e(0x18f)+_0x433620[_0x55161e(0x1ae)]);}const _0x3324c1=await _0x433620[_0x55161e(0x17b)]();loggerService_1[_0x55161e(0x1bd)][_0x55161e(0x194)](_0x55161e(0x158),_0x55161e(0x193)+_0x17eff5,_0x433620[_0x55161e(0x1ae)],_0x3324c1,_0x2748d2);if(_0x3324c1[_0x55161e(0x198)]||_0x3324c1[_0x55161e(0x18a)]){loggerService_1[_0x55161e(0x1bd)]['logWhiteDomainError']('noda','/payment-links/'+_0x17eff5,'Noda\x20API\x20error:\x20'+(_0x3324c1['message']||_0x3324c1[_0x55161e(0x198)]||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x3324c1[_0x55161e(0x153)]||_0x3324c1[_0x55161e(0x198)]||_0x55161e(0x165)));}let _0x189d48=_0x55161e(0x177);if(_0x3324c1[_0x55161e(0x15d)]===![]){if(_0x3324c1[_0x55161e(0x1ac)]){const _0x4d6050=new Date(_0x3324c1['expiryDate']),_0x3a7e0c=new Date();_0x4d6050<_0x3a7e0c?_0x189d48=_0x55161e(0x189):_0x189d48=_0x55161e(0x168);}else _0x189d48=_0x55161e(0x168);}else _0x189d48=_0x55161e(0x177);return{'status':_0x189d48,'amount':_0x3324c1['amount'],'currency':_0x3324c1[_0x55161e(0x14a)],'isActive':_0x3324c1[_0x55161e(0x15d)]};}catch(_0x46137e){console['error']('Noda\x20payment\x20verification\x20error:',_0x46137e),loggerService_1['loggerService'][_0x55161e(0x1ad)](_0x55161e(0x158),_0x55161e(0x193)+_0x17eff5,_0x46137e);throw new Error(_0x55161e(0x170)+(_0x46137e instanceof Error?_0x46137e[_0x55161e(0x153)]:_0x55161e(0x165)));}}async[a50_0x32da7f(0x175)](_0x35f672){const _0xaefbee=a50_0x32da7f;console[_0xaefbee(0x1a8)](_0xaefbee(0x1a5),_0x35f672);let _0x586ab6=_0xaefbee(0x177);switch(_0x35f672[_0xaefbee(0x14b)]?.[_0xaefbee(0x18d)]()){case'done':case _0xaefbee(0x16e):case _0xaefbee(0x1a4):case _0xaefbee(0x17e):case'successful':_0x35f672[_0xaefbee(0x15c)]===_0xaefbee(0x150)?_0x586ab6='PAID':_0x586ab6='PENDING';break;case'cancelled':case _0xaefbee(0x16f):case _0xaefbee(0x1ab):case _0xaefbee(0x198):case _0xaefbee(0x160):_0x586ab6=_0xaefbee(0x168);break;case _0xaefbee(0x1bb):case _0xaefbee(0x180):_0x586ab6='EXPIRED';break;case _0xaefbee(0x192):case _0xaefbee(0x1be):case'active':case _0xaefbee(0x185):case'in_progress':default:_0x586ab6=_0xaefbee(0x177);break;}return{'paymentId':_0x35f672[_0xaefbee(0x18c)]||_0x35f672[_0xaefbee(0x143)],'status':_0x586ab6,'amount':_0x35f672[_0xaefbee(0x1aa)],'currency':_0x35f672[_0xaefbee(0x184)],'additionalInfo':{'method':_0x35f672[_0xaefbee(0x147)],'bankId':_0x35f672['BankId'],'settled':_0x35f672[_0xaefbee(0x15c)],'settlementDate':_0x35f672[_0xaefbee(0x152)],'remitterName':_0x35f672[_0xaefbee(0x19a)]?.[_0xaefbee(0x1a1)],'remitterIban':_0x35f672[_0xaefbee(0x19a)]?.['Iban'],'bankTransactionId':_0x35f672['BankTransactionId']}};}[a50_0x32da7f(0x148)](_0x5c4680,_0x178f17){const _0x56448c=a50_0x32da7f;return console[_0x56448c(0x1a8)](_0x56448c(0x17d),{'receivedSignature':_0x178f17,'paymentId':_0x5c4680[_0x56448c(0x143)],'merchantPaymentId':_0x5c4680[_0x56448c(0x18c)]}),!![];}}function a50_0x5f04(){const _0x874bdf=['created','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','PaymentId','Short\x20Link:','Status\x20Code:','NodaService','Method','verifyWebhookSignature','apiUrl','currency','Status','headers','(8digits-8digits\x20format\x20for\x20Noda)','Payment\x20Link\x20ID:','Status:','Yes','URL:','SettlementDate','message','===\x20PARSED\x20NODA\x20RESPONSE\x20===','(8digits-8digits\x20format)','===\x20NODA\x20API\x20ERROR\x20===','TesSoft\x20Payment\x20System/1.0','noda','entries','fromEntries','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Settled','isActive','Request\x20Body\x20(Direct\x20JSON):','text','rejected','Status\x20Text:','HTTP\x20Status:','5145687pcXlhS','now','Unknown\x20error','Order\x20ID\x20Used:','verifyPayment','FAILED','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','✅\x20Return\x20URL\x20configured\x20for\x20pending:','shortLink','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','completed','canceled','Failed\x20to\x20verify\x20Noda\x20payment:\x20','133HBDkIa','shortLinkUrls','https://tesoft.uk/gateway/pending.php?id=','QR\x20Code\x20Link:','processWebhook','15579zqAIqu','PENDING','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','GET','toUpperCase','json',',\x20body:\x20','Noda\x20webhook\x20signature\x20verification:','success','https://tesoft.uk/gateway/noda/','timeout','2698216yqynts','Not\x20provided','logWhiteDomainRequest','Currency','processing','24frDGqM','Noda\x20API\x20error:\x20','statusText','EXPIRED','statusCode','211rfDGRQ','MerchantPaymentId','toLowerCase','stack','HTTP\x20error!\x20status:\x20','qrCodeLink','3222ScVRxD','pending','/payment-links/','logWhiteDomainResponse','Response\x20Time:','https://tesoft.uk/gateway/noda/webhook/','===\x20NODA\x20SUCCESS\x20===','error','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Remitter','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','HTTP\x20','JSON\x20Parse\x20Error:\x20','Response\x20Body:','application/json','===\x20NODA\x20SERVICE\x20ERROR\x20===','Name','5631650niCghP','Parsed\x20Result:','paid','Processing\x20Noda\x20webhook:','defineProperty','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','log','25860TQkWos','Amount','failed','expiryDate','logWhiteDomainError','status','11033290mytBtj','POST','../loggerService','Failed\x20to\x20parse\x20JSON\x20response:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','stringify','Error\x20Message:','Unknown\x20error\x20from\x20Noda\x20API','/payment-links','Business\x20Error:\x20','Raw\x20Response\x20Body:','__esModule','expired','Order\x20ID\x20Format:','loggerService'];a50_0x5f04=function(){return _0x874bdf;};return a50_0x5f04();}exports[a50_0x32da7f(0x146)]=NodaService;