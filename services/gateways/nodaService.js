'use strict';const a63_0x4338ce=a63_0x3ef9;(function(_0x10f153,_0x488de1){const _0x148581=a63_0x3ef9,_0x238997=_0x10f153();while(!![]){try{const _0x2e281b=parseInt(_0x148581(0x13e))/0x1+-parseInt(_0x148581(0x16d))/0x2*(-parseInt(_0x148581(0x167))/0x3)+parseInt(_0x148581(0x170))/0x4*(parseInt(_0x148581(0x130))/0x5)+-parseInt(_0x148581(0x17d))/0x6*(parseInt(_0x148581(0x14e))/0x7)+-parseInt(_0x148581(0x188))/0x8*(parseInt(_0x148581(0x15a))/0x9)+parseInt(_0x148581(0x172))/0xa+parseInt(_0x148581(0x191))/0xb;if(_0x2e281b===_0x488de1)break;else _0x238997['push'](_0x238997['shift']());}catch(_0x5eee81){_0x238997['push'](_0x238997['shift']());}}}(a63_0x5261,0x4bf45));function a63_0x3ef9(_0x2043e3,_0x5dd7bd){_0x2043e3=_0x2043e3-0x118;const _0x5261fb=a63_0x5261();let _0x3ef91a=_0x5261fb[_0x2043e3];return _0x3ef91a;}function a63_0x5261(){const _0x2c71a8=['Settled','__esModule','expired','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','active','PAID','Order\x20ID\x20Used:','Response\x20Time:','https://tesoft.uk/gateway/noda/webhook/','Status\x20Code:','3834xDZvOm','Currency','failed','Short\x20Link:','stack','parse','Noda\x20webhook\x20signature\x20verification:','HTTP\x20Status:','qrCodeLink','apiUrl','Yes','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','PaymentId','644199biiUZD','BankId','status','defineProperty','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Unknown\x20error','4mvuJdO','Noda\x20API\x20error:\x20','toUpperCase','628PGbtTW','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','697020gceIRT','Method','statusCode','Order\x20ID\x20Format:','expiryDate','logWhiteDomainError','processWebhook','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Raw\x20Response\x20Body:','text','POST','822WrEPuJ','Missing\x20id\x20or\x20shortLink\x20in\x20response','Error\x20message:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20details:','verifyPayment','in_progress','NodaService','Noda\x20payment\x20verification\x20error:','rejected','loggerService','11464TpxTVj','HTTP\x20error!\x20status:\x20','HTTP\x20',',\x20body:\x20','logWhiteDomainResponse','Status\x20Text:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','isActive','paid','5265722olKMtz','toLowerCase','Response\x20Body:','Payment\x20Link\x20ID:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Response\x20data:','https://tesoft.uk/gateway/pending.php?id=','MerchantPaymentId','/payment-links/','URL:','Status:','(8digits-8digits\x20format\x20for\x20Noda)','Request\x20Body\x20(Direct\x20JSON):','Headers:','Error\x20stack:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','===\x20NODA\x20SERVICE\x20ERROR\x20===','Not\x20provided','successful','headers','error','done','Unknown\x20error\x20from\x20Noda\x20API','shortLink','message','9385ohczQR','json','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','../loggerService','GET','log','/payment-links','QR\x20Code\x20Link:','Error\x20Message:','Business\x20Error:\x20','noda','application/json','Payment\x20System/1.0','177965CpEBUl','EXPIRED','stringify','PENDING','verifyWebhookSignature','SettlementDate','Processing\x20Noda\x20webhook:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Parsed\x20Result:','shortLinkUrls','completed','FAILED','success','Remitter','now','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','27027aFadco','JSON\x20Parse\x20Error:\x20'];a63_0x5261=function(){return _0x2c71a8;};return a63_0x5261();}Object[a63_0x4338ce(0x16a)](exports,a63_0x4338ce(0x151),{'value':!![]}),exports[a63_0x4338ce(0x184)]=void 0x0;const loggerService_1=require(a63_0x4338ce(0x134));class NodaService{constructor(){const _0x1e1eab=a63_0x4338ce;this['apiUrl']='https://tesoft.uk/gateway/noda/',console[_0x1e1eab(0x136)](_0x1e1eab(0x133));}async['createPaymentLink'](_0x51ff41){const _0x406fcf=a63_0x4338ce,{orderId:_0xd7ba64,name:_0x342764,paymentDescription:_0x495beb,amount:_0x5ae1db,currency:_0x197c2d,webhookUrl:_0x468bc9,returnUrl:_0x185ee1,expiryDate:_0x4215ce}=_0x51ff41,_0x233cc4=_0x197c2d[_0x406fcf(0x16f)](),_0x556ed7=_0x406fcf(0x158),_0x2658fc=_0x406fcf(0x11d)+_0xd7ba64,_0x95e93f={'name':_0x342764,'paymentDescription':_0x495beb,'amount':_0x5ae1db,'currency':_0x233cc4,'paymentId':_0xd7ba64,'webhookUrl':_0x556ed7,'returnUrl':_0x2658fc};_0x4215ce&&(_0x95e93f['expiryDate']=_0x4215ce);const _0x31f614=Date[_0x406fcf(0x14c)]();try{console[_0x406fcf(0x136)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x406fcf(0x136)](_0x406fcf(0x120),this[_0x406fcf(0x163)]),console['log'](_0x406fcf(0x123),JSON[_0x406fcf(0x140)](_0x95e93f,null,0x2)),console[_0x406fcf(0x136)](_0x406fcf(0x175),_0xd7ba64,_0x406fcf(0x122)),console['log']('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x2658fc),loggerService_1[_0x406fcf(0x187)]['logWhiteDomainRequest']('noda',_0x406fcf(0x137),_0x406fcf(0x17c),_0x95e93f);const _0x292cf0=await fetch(this[_0x406fcf(0x163)],{'method':_0x406fcf(0x17c),'headers':{'Content-Type':_0x406fcf(0x13c),'Accept':_0x406fcf(0x13c),'User-Agent':_0x406fcf(0x13d)},'body':JSON[_0x406fcf(0x140)](_0x95e93f)}),_0x5edeb2=Date[_0x406fcf(0x14c)]()-_0x31f614;console['log'](_0x406fcf(0x153)),console[_0x406fcf(0x136)](_0x406fcf(0x121),_0x292cf0[_0x406fcf(0x169)]),console[_0x406fcf(0x136)](_0x406fcf(0x18d),_0x292cf0['statusText']),console['log'](_0x406fcf(0x124),Object['fromEntries'](_0x292cf0[_0x406fcf(0x12a)]['entries']())),console[_0x406fcf(0x136)](_0x406fcf(0x157),_0x5edeb2+'ms');const _0x4546c7=await _0x292cf0[_0x406fcf(0x17b)]();console[_0x406fcf(0x136)](_0x406fcf(0x17a),_0x4546c7);if(!_0x292cf0['ok']){console[_0x406fcf(0x12b)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x406fcf(0x12b)](_0x406fcf(0x161),_0x292cf0[_0x406fcf(0x169)]),console[_0x406fcf(0x12b)](_0x406fcf(0x119),_0x4546c7),loggerService_1[_0x406fcf(0x187)][_0x406fcf(0x18c)](_0x406fcf(0x13b),_0x406fcf(0x137),_0x292cf0[_0x406fcf(0x169)],_0x4546c7,_0x5edeb2),loggerService_1['loggerService'][_0x406fcf(0x177)]('noda',_0x406fcf(0x137),_0x406fcf(0x18a)+_0x292cf0[_0x406fcf(0x169)]+':\x20'+_0x4546c7);if(_0x292cf0[_0x406fcf(0x169)]===0x190)throw new Error(_0x406fcf(0x165));else{if(_0x292cf0['status']===0x1f4)throw new Error(_0x406fcf(0x16b));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x292cf0[_0x406fcf(0x169)]+_0x406fcf(0x18b)+_0x4546c7);}let _0x3f74fc;try{_0x3f74fc=JSON[_0x406fcf(0x15f)](_0x4546c7);}catch(_0xbaab59){console[_0x406fcf(0x12b)]('Failed\x20to\x20parse\x20JSON\x20response:',_0xbaab59),loggerService_1[_0x406fcf(0x187)][_0x406fcf(0x177)](_0x406fcf(0x13b),'/payment-links',_0x406fcf(0x14f)+_0xbaab59);throw new Error(_0x406fcf(0x132)+_0x4546c7);}console[_0x406fcf(0x136)](_0x406fcf(0x179)),console[_0x406fcf(0x136)](_0x406fcf(0x146),JSON[_0x406fcf(0x140)](_0x3f74fc,null,0x2)),loggerService_1[_0x406fcf(0x187)][_0x406fcf(0x18c)]('noda',_0x406fcf(0x137),_0x292cf0[_0x406fcf(0x169)],_0x3f74fc,_0x5edeb2);if(_0x3f74fc[_0x406fcf(0x12b)]||_0x3f74fc[_0x406fcf(0x174)]){const _0x27fffc=_0x3f74fc[_0x406fcf(0x12f)]||_0x3f74fc[_0x406fcf(0x12b)]||_0x406fcf(0x12d);console['error'](_0x406fcf(0x171)),console[_0x406fcf(0x12b)](_0x406fcf(0x139),_0x27fffc),console[_0x406fcf(0x12b)](_0x406fcf(0x159),_0x3f74fc[_0x406fcf(0x174)]),loggerService_1[_0x406fcf(0x187)]['logWhiteDomainError'](_0x406fcf(0x13b),'/payment-links',_0x406fcf(0x13a)+_0x27fffc);throw new Error(_0x406fcf(0x16e)+_0x27fffc);}if(!_0x3f74fc['id']||!_0x3f74fc['shortLinkUrls']?.[_0x406fcf(0x12e)]){console[_0x406fcf(0x12b)](_0x406fcf(0x180)),console[_0x406fcf(0x12b)](_0x406fcf(0x17e)),console['error'](_0x406fcf(0x11c),_0x3f74fc),loggerService_1[_0x406fcf(0x187)][_0x406fcf(0x177)](_0x406fcf(0x13b),'/payment-links',_0x406fcf(0x145));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x406fcf(0x136)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x406fcf(0x136)](_0x406fcf(0x11a),_0x3f74fc['id']),console[_0x406fcf(0x136)](_0x406fcf(0x15d),_0x3f74fc['shortLinkUrls'][_0x406fcf(0x12e)]),console['log'](_0x406fcf(0x138),_0x3f74fc[_0x406fcf(0x147)][_0x406fcf(0x162)]||_0x406fcf(0x128)),console[_0x406fcf(0x136)](_0x406fcf(0x156),_0xd7ba64,'(8digits-8digits\x20format)'),console['log'](_0x406fcf(0x126),_0x2658fc),{'gateway_payment_id':_0x3f74fc['id'],'payment_url':_0x3f74fc[_0x406fcf(0x147)][_0x406fcf(0x12e)],'qr_code_url':_0x3f74fc['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x3f74fc[_0x406fcf(0x176)]};}catch(_0x4010b3){console['error'](_0x406fcf(0x127)),console[_0x406fcf(0x12b)](_0x406fcf(0x181),_0x4010b3),loggerService_1[_0x406fcf(0x187)][_0x406fcf(0x177)](_0x406fcf(0x13b),'/payment-links',_0x4010b3);if(_0x4010b3 instanceof Error){console[_0x406fcf(0x12b)](_0x406fcf(0x17f),_0x4010b3[_0x406fcf(0x12f)]),console[_0x406fcf(0x12b)](_0x406fcf(0x125),_0x4010b3[_0x406fcf(0x15e)]);throw new Error(_0x406fcf(0x18e)+_0x4010b3[_0x406fcf(0x12f)]);}throw new Error(_0x406fcf(0x14d));}}async[a63_0x4338ce(0x182)](_0x8f23a8){const _0x34a75b=a63_0x4338ce,_0xb5a9dc=Date['now']();try{loggerService_1[_0x34a75b(0x187)]['logWhiteDomainRequest']('noda',_0x34a75b(0x11f)+_0x8f23a8,'GET',{});const _0x48a1d9=await fetch(this[_0x34a75b(0x163)]+'/'+_0x8f23a8,{'method':_0x34a75b(0x135),'headers':{'Content-Type':_0x34a75b(0x13c),'User-Agent':_0x34a75b(0x13d)}}),_0x3e315f=Date[_0x34a75b(0x14c)]()-_0xb5a9dc;if(!_0x48a1d9['ok']){const _0xe66f18=await _0x48a1d9[_0x34a75b(0x17b)]();loggerService_1['loggerService'][_0x34a75b(0x18c)](_0x34a75b(0x13b),_0x34a75b(0x11f)+_0x8f23a8,_0x48a1d9[_0x34a75b(0x169)],_0xe66f18,_0x3e315f);throw new Error(_0x34a75b(0x189)+_0x48a1d9[_0x34a75b(0x169)]);}const _0x5903c1=await _0x48a1d9[_0x34a75b(0x131)]();loggerService_1['loggerService'][_0x34a75b(0x18c)]('noda',_0x34a75b(0x11f)+_0x8f23a8,_0x48a1d9[_0x34a75b(0x169)],_0x5903c1,_0x3e315f);if(_0x5903c1[_0x34a75b(0x12b)]||_0x5903c1['statusCode']){loggerService_1['loggerService'][_0x34a75b(0x177)](_0x34a75b(0x13b),'/payment-links/'+_0x8f23a8,_0x34a75b(0x16e)+(_0x5903c1[_0x34a75b(0x12f)]||_0x5903c1[_0x34a75b(0x12b)]||_0x34a75b(0x16c)));throw new Error(_0x34a75b(0x16e)+(_0x5903c1[_0x34a75b(0x12f)]||_0x5903c1[_0x34a75b(0x12b)]||_0x34a75b(0x16c)));}let _0x149af2=_0x34a75b(0x141);if(_0x5903c1[_0x34a75b(0x18f)]===![]){if(_0x5903c1[_0x34a75b(0x176)]){const _0xfaec4e=new Date(_0x5903c1[_0x34a75b(0x176)]),_0x2590d5=new Date();_0xfaec4e<_0x2590d5?_0x149af2=_0x34a75b(0x13f):_0x149af2=_0x34a75b(0x149);}else _0x149af2=_0x34a75b(0x149);}else _0x149af2=_0x34a75b(0x141);return{'status':_0x149af2,'amount':_0x5903c1['amount'],'currency':_0x5903c1['currency'],'isActive':_0x5903c1['isActive']};}catch(_0x39e4bb){console['error'](_0x34a75b(0x185),_0x39e4bb),loggerService_1[_0x34a75b(0x187)][_0x34a75b(0x177)]('noda',_0x34a75b(0x11f)+_0x8f23a8,_0x39e4bb);throw new Error(_0x34a75b(0x11b)+(_0x39e4bb instanceof Error?_0x39e4bb[_0x34a75b(0x12f)]:_0x34a75b(0x16c)));}}async[a63_0x4338ce(0x178)](_0x1d245a){const _0x29fe84=a63_0x4338ce;console[_0x29fe84(0x136)](_0x29fe84(0x144),_0x1d245a);let _0x123ced='PENDING';switch(_0x1d245a['Status']?.[_0x29fe84(0x118)]()){case _0x29fe84(0x12c):case _0x29fe84(0x148):case _0x29fe84(0x190):case _0x29fe84(0x14a):case _0x29fe84(0x129):_0x1d245a[_0x29fe84(0x150)]===_0x29fe84(0x164)?_0x123ced=_0x29fe84(0x155):_0x123ced=_0x29fe84(0x141);break;case'cancelled':case'canceled':case _0x29fe84(0x15c):case'error':case _0x29fe84(0x186):_0x123ced=_0x29fe84(0x149);break;case _0x29fe84(0x152):case'timeout':_0x123ced=_0x29fe84(0x13f);break;case'pending':case'created':case _0x29fe84(0x154):case'processing':case _0x29fe84(0x183):default:_0x123ced=_0x29fe84(0x141);break;}return{'paymentId':_0x1d245a[_0x29fe84(0x11e)]||_0x1d245a[_0x29fe84(0x166)],'status':_0x123ced,'amount':_0x1d245a['Amount'],'currency':_0x1d245a[_0x29fe84(0x15b)],'additionalInfo':{'method':_0x1d245a[_0x29fe84(0x173)],'bankId':_0x1d245a[_0x29fe84(0x168)],'settled':_0x1d245a[_0x29fe84(0x150)],'settlementDate':_0x1d245a[_0x29fe84(0x143)],'remitterName':_0x1d245a[_0x29fe84(0x14b)]?.['Name'],'remitterIban':_0x1d245a['Remitter']?.['Iban'],'bankTransactionId':_0x1d245a['BankTransactionId']}};}[a63_0x4338ce(0x142)](_0x1392ce,_0x496938){const _0x2d0011=a63_0x4338ce;return console[_0x2d0011(0x136)](_0x2d0011(0x160),{'receivedSignature':_0x496938,'paymentId':_0x1392ce[_0x2d0011(0x166)],'merchantPaymentId':_0x1392ce[_0x2d0011(0x11e)]}),!![];}}exports[a63_0x4338ce(0x184)]=NodaService;