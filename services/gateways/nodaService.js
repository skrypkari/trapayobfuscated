'use strict';const a46_0x5c98ef=a46_0x167c;(function(_0x231423,_0x19f93a){const _0x272841=a46_0x167c,_0x51eb71=_0x231423();while(!![]){try{const _0x2e5f1b=parseInt(_0x272841(0x13c))/0x1*(parseInt(_0x272841(0xf5))/0x2)+parseInt(_0x272841(0x159))/0x3*(parseInt(_0x272841(0x11b))/0x4)+-parseInt(_0x272841(0x158))/0x5+parseInt(_0x272841(0x160))/0x6*(parseInt(_0x272841(0x137))/0x7)+-parseInt(_0x272841(0x165))/0x8*(-parseInt(_0x272841(0x15a))/0x9)+parseInt(_0x272841(0x138))/0xa+-parseInt(_0x272841(0x153))/0xb;if(_0x2e5f1b===_0x19f93a)break;else _0x51eb71['push'](_0x51eb71['shift']());}catch(_0x323c55){_0x51eb71['push'](_0x51eb71['shift']());}}}(a46_0x323c,0x8fac3));function a46_0x323c(){const _0x34c693=['28oGtssJ','Not\x20provided','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','defineProperty','completed','timeout','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','BankTransactionId','successful','https://tesoft.uk/gateway/noda/','Error\x20details:','log','done','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','logWhiteDomainRequest','apiUrl','HTTP\x20error!\x20status:\x20','status','canceled','JSON\x20Parse\x20Error:\x20','(8digits-8digits\x20format)','success','processWebhook','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','toUpperCase','1474508dINdBF','10822970drmNDU','expired','Response\x20Time:','Unknown\x20error\x20from\x20Noda\x20API','261133VmbluY','HTTP\x20','expiryDate','json','Order\x20ID\x20Used:','Settled','__esModule','Response\x20Body:','verifyWebhookSignature','application/json','Short\x20Link:','PaymentId','loggerService','currency','Noda\x20payment\x20verification\x20error:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Unknown\x20error','Payment\x20Link\x20ID:','logWhiteDomainResponse','Failed\x20to\x20parse\x20JSON\x20response:','Status','TesSoft\x20Payment\x20System/1.0','URL:','14693481CPHjsR','pending','===\x20NODA\x20SERVICE\x20ERROR\x20===','Business\x20Error:\x20','noda','4991400LJNfDF','107313hsQqdT','27PdhCwt','Processing\x20Noda\x20webhook:','Error\x20stack:','qrCodeLink','https://tesoft.uk/gateway/pending.php?id=','MerchantPaymentId','30VMDWZx','Iban','NodaService','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','734632KtQFhu','FAILED','logWhiteDomainError','EXPIRED','in_progress','created','Method','https://tesoft.uk/gateway/noda/webhook/','entries','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','message','Name','POST','cancelled','Order\x20ID\x20Format:','Error\x20message:','2abdgRU','BankId','PAID','../loggerService','Raw\x20Response\x20Body:','stack','===\x20NODA\x20SUCCESS\x20===','GET','statusCode','amount','active','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','shortLinkUrls','error','/payment-links/','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PENDING','isActive','Request\x20Body\x20(Direct\x20JSON):','Noda\x20webhook\x20signature\x20verification:','Currency','parse',',\x20body:\x20','Noda\x20API\x20error:\x20','Headers:','Status\x20Text:','paid','Amount','text','headers','Parsed\x20Result:','stringify','===\x20NODA\x20API\x20ERROR\x20===','processing','shortLink','/payment-links','HTTP\x20Status:','now'];a46_0x323c=function(){return _0x34c693;};return a46_0x323c();}Object[a46_0x5c98ef(0x11e)](exports,a46_0x5c98ef(0x142),{'value':!![]}),exports[a46_0x5c98ef(0x162)]=void 0x0;const loggerService_1=require(a46_0x5c98ef(0xf8));function a46_0x167c(_0x27fbb7,_0x3e1871){const _0x323c71=a46_0x323c();return a46_0x167c=function(_0x167cde,_0x5c694f){_0x167cde=_0x167cde-0xef;let _0x177dbe=_0x323c71[_0x167cde];return _0x177dbe;},a46_0x167c(_0x27fbb7,_0x3e1871);}class NodaService{constructor(){const _0x2a34bc=a46_0x5c98ef;this[_0x2a34bc(0x12d)]=_0x2a34bc(0x127),console[_0x2a34bc(0x129)](_0x2a34bc(0x104));}async['createPaymentLink'](_0x251660){const _0xfb8d87=a46_0x5c98ef,{orderId:_0x4a22af,name:_0x479b4a,paymentDescription:_0x399d9c,amount:_0x2c5544,currency:_0x3611e2,webhookUrl:_0x71ef97,returnUrl:_0x4ad330,expiryDate:_0x165a7d}=_0x251660,_0xd169b7=_0x3611e2[_0xfb8d87(0x136)](),_0x54d99c=_0xfb8d87(0x16c),_0xc046ed=_0xfb8d87(0x15e)+_0x4a22af,_0x17447b={'name':_0x479b4a,'paymentDescription':_0x399d9c,'amount':_0x2c5544,'currency':_0xd169b7,'paymentId':_0x4a22af,'webhookUrl':_0x54d99c,'returnUrl':_0xc046ed};_0x165a7d&&(_0x17447b[_0xfb8d87(0x13e)]=_0x165a7d);const _0x4adf14=Date[_0xfb8d87(0x11a)]();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console['log'](_0xfb8d87(0x152),this[_0xfb8d87(0x12d)]),console['log'](_0xfb8d87(0x107),JSON[_0xfb8d87(0x114)](_0x17447b,null,0x2)),console[_0xfb8d87(0x129)](_0xfb8d87(0xf3),_0x4a22af,'(8digits-8digits\x20format\x20for\x20Noda)'),console['log'](_0xfb8d87(0x16e),_0xc046ed),loggerService_1[_0xfb8d87(0x148)]['logWhiteDomainRequest'](_0xfb8d87(0x157),_0xfb8d87(0x118),_0xfb8d87(0xf1),_0x17447b);const _0x17fe4d=await fetch(this[_0xfb8d87(0x12d)],{'method':_0xfb8d87(0xf1),'headers':{'Content-Type':_0xfb8d87(0x145),'Accept':_0xfb8d87(0x145),'User-Agent':_0xfb8d87(0x151)},'body':JSON['stringify'](_0x17447b)}),_0x5cc7e4=Date[_0xfb8d87(0x11a)]()-_0x4adf14;console['log'](_0xfb8d87(0x135)),console[_0xfb8d87(0x129)]('Status:',_0x17fe4d[_0xfb8d87(0x12f)]),console[_0xfb8d87(0x129)](_0xfb8d87(0x10e),_0x17fe4d['statusText']),console['log'](_0xfb8d87(0x10d),Object['fromEntries'](_0x17fe4d[_0xfb8d87(0x112)][_0xfb8d87(0x16d)]())),console['log'](_0xfb8d87(0x13a),_0x5cc7e4+'ms');const _0x145b90=await _0x17fe4d[_0xfb8d87(0x111)]();console[_0xfb8d87(0x129)](_0xfb8d87(0xf9),_0x145b90);if(!_0x17fe4d['ok']){console[_0xfb8d87(0x102)](_0xfb8d87(0x115)),console['error'](_0xfb8d87(0x119),_0x17fe4d[_0xfb8d87(0x12f)]),console['error'](_0xfb8d87(0x143),_0x145b90),loggerService_1['loggerService'][_0xfb8d87(0x14e)]('noda',_0xfb8d87(0x118),_0x17fe4d[_0xfb8d87(0x12f)],_0x145b90,_0x5cc7e4),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0xfb8d87(0x118),_0xfb8d87(0x13d)+_0x17fe4d['status']+':\x20'+_0x145b90);if(_0x17fe4d['status']===0x190)throw new Error(_0xfb8d87(0x11d));else{if(_0x17fe4d[_0xfb8d87(0x12f)]===0x1f4)throw new Error(_0xfb8d87(0x123));}throw new Error(_0xfb8d87(0x12e)+_0x17fe4d[_0xfb8d87(0x12f)]+_0xfb8d87(0x10b)+_0x145b90);}let _0x163327;try{_0x163327=JSON[_0xfb8d87(0x10a)](_0x145b90);}catch(_0x18b987){console[_0xfb8d87(0x102)](_0xfb8d87(0x14f),_0x18b987),loggerService_1[_0xfb8d87(0x148)]['logWhiteDomainError'](_0xfb8d87(0x157),_0xfb8d87(0x118),_0xfb8d87(0x131)+_0x18b987);throw new Error(_0xfb8d87(0x164)+_0x145b90);}console['log']('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0xfb8d87(0x129)](_0xfb8d87(0x113),JSON[_0xfb8d87(0x114)](_0x163327,null,0x2)),loggerService_1[_0xfb8d87(0x148)][_0xfb8d87(0x14e)](_0xfb8d87(0x157),_0xfb8d87(0x118),_0x17fe4d[_0xfb8d87(0x12f)],_0x163327,_0x5cc7e4);if(_0x163327[_0xfb8d87(0x102)]||_0x163327[_0xfb8d87(0xfd)]){const _0xc26327=_0x163327['message']||_0x163327[_0xfb8d87(0x102)]||_0xfb8d87(0x13b);console[_0xfb8d87(0x102)](_0xfb8d87(0x163)),console[_0xfb8d87(0x102)]('Error\x20Message:',_0xc26327),console[_0xfb8d87(0x102)]('Status\x20Code:',_0x163327['statusCode']),loggerService_1[_0xfb8d87(0x148)]['logWhiteDomainError']('noda',_0xfb8d87(0x118),_0xfb8d87(0x156)+_0xc26327);throw new Error(_0xfb8d87(0x10c)+_0xc26327);}if(!_0x163327['id']||!_0x163327[_0xfb8d87(0x101)]?.[_0xfb8d87(0x117)]){console['error'](_0xfb8d87(0x124)),console[_0xfb8d87(0x102)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console['error']('Response\x20data:',_0x163327),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0xfb8d87(0x118),_0xfb8d87(0x12b));throw new Error(_0xfb8d87(0x122));}return console[_0xfb8d87(0x129)](_0xfb8d87(0xfb)),console[_0xfb8d87(0x129)](_0xfb8d87(0x14d),_0x163327['id']),console[_0xfb8d87(0x129)](_0xfb8d87(0x146),_0x163327[_0xfb8d87(0x101)][_0xfb8d87(0x117)]),console[_0xfb8d87(0x129)]('QR\x20Code\x20Link:',_0x163327['shortLinkUrls'][_0xfb8d87(0x15d)]||_0xfb8d87(0x11c)),console[_0xfb8d87(0x129)](_0xfb8d87(0x140),_0x4a22af,_0xfb8d87(0x132)),console['log']('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0xc046ed),{'gateway_payment_id':_0x163327['id'],'payment_url':_0x163327['shortLinkUrls']['shortLink'],'qr_code_url':_0x163327[_0xfb8d87(0x101)][_0xfb8d87(0x15d)],'expiry_date':_0x163327['expiryDate']};}catch(_0xb6a345){console[_0xfb8d87(0x102)](_0xfb8d87(0x155)),console['error'](_0xfb8d87(0x128),_0xb6a345),loggerService_1[_0xfb8d87(0x148)]['logWhiteDomainError'](_0xfb8d87(0x157),'/payment-links',_0xb6a345);if(_0xb6a345 instanceof Error){console[_0xfb8d87(0x102)](_0xfb8d87(0xf4),_0xb6a345['message']),console[_0xfb8d87(0x102)](_0xfb8d87(0x15c),_0xb6a345[_0xfb8d87(0xfa)]);throw new Error(_0xfb8d87(0x121)+_0xb6a345[_0xfb8d87(0xef)]);}throw new Error(_0xfb8d87(0x100));}}async['verifyPayment'](_0x16af94){const _0x201d04=a46_0x5c98ef,_0x2aa16d=Date['now']();try{loggerService_1[_0x201d04(0x148)][_0x201d04(0x12c)]('noda','/payment-links/'+_0x16af94,_0x201d04(0xfc),{});const _0x306c6a=await fetch(this[_0x201d04(0x12d)]+'/'+_0x16af94,{'method':_0x201d04(0xfc),'headers':{'Content-Type':_0x201d04(0x145),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x23124e=Date[_0x201d04(0x11a)]()-_0x2aa16d;if(!_0x306c6a['ok']){const _0x2945cc=await _0x306c6a[_0x201d04(0x111)]();loggerService_1['loggerService'][_0x201d04(0x14e)](_0x201d04(0x157),_0x201d04(0x103)+_0x16af94,_0x306c6a[_0x201d04(0x12f)],_0x2945cc,_0x23124e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x306c6a[_0x201d04(0x12f)]);}const _0x3c1580=await _0x306c6a[_0x201d04(0x13f)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x201d04(0x157),_0x201d04(0x103)+_0x16af94,_0x306c6a[_0x201d04(0x12f)],_0x3c1580,_0x23124e);if(_0x3c1580[_0x201d04(0x102)]||_0x3c1580[_0x201d04(0xfd)]){loggerService_1[_0x201d04(0x148)][_0x201d04(0x167)]('noda',_0x201d04(0x103)+_0x16af94,_0x201d04(0x10c)+(_0x3c1580[_0x201d04(0xef)]||_0x3c1580[_0x201d04(0x102)]||_0x201d04(0x14c)));throw new Error(_0x201d04(0x10c)+(_0x3c1580['message']||_0x3c1580['error']||_0x201d04(0x14c)));}let _0x1bc836=_0x201d04(0x105);if(_0x3c1580[_0x201d04(0x106)]===![]){if(_0x3c1580[_0x201d04(0x13e)]){const _0x2fb39a=new Date(_0x3c1580[_0x201d04(0x13e)]),_0x4ba94a=new Date();_0x2fb39a<_0x4ba94a?_0x1bc836=_0x201d04(0x168):_0x1bc836=_0x201d04(0x166);}else _0x1bc836=_0x201d04(0x166);}else _0x1bc836=_0x201d04(0x105);return{'status':_0x1bc836,'amount':_0x3c1580[_0x201d04(0xfe)],'currency':_0x3c1580[_0x201d04(0x149)],'isActive':_0x3c1580['isActive']};}catch(_0x121c53){console['error'](_0x201d04(0x14a),_0x121c53),loggerService_1['loggerService'][_0x201d04(0x167)]('noda',_0x201d04(0x103)+_0x16af94,_0x121c53);throw new Error(_0x201d04(0x14b)+(_0x121c53 instanceof Error?_0x121c53[_0x201d04(0xef)]:_0x201d04(0x14c)));}}async[a46_0x5c98ef(0x134)](_0x1285d0){const _0x127dd5=a46_0x5c98ef;console['log'](_0x127dd5(0x15b),_0x1285d0);let _0x13edaf=_0x127dd5(0x105);switch(_0x1285d0[_0x127dd5(0x150)]?.['toLowerCase']()){case _0x127dd5(0x12a):case _0x127dd5(0x11f):case _0x127dd5(0x10f):case _0x127dd5(0x133):case _0x127dd5(0x126):_0x1285d0[_0x127dd5(0x141)]==='Yes'?_0x13edaf=_0x127dd5(0xf7):_0x13edaf='PENDING';break;case _0x127dd5(0xf2):case _0x127dd5(0x130):case'failed':case _0x127dd5(0x102):case'rejected':_0x13edaf=_0x127dd5(0x166);break;case _0x127dd5(0x139):case _0x127dd5(0x120):_0x13edaf=_0x127dd5(0x168);break;case _0x127dd5(0x154):case _0x127dd5(0x16a):case _0x127dd5(0xff):case _0x127dd5(0x116):case _0x127dd5(0x169):default:_0x13edaf=_0x127dd5(0x105);break;}return{'paymentId':_0x1285d0[_0x127dd5(0x15f)]||_0x1285d0[_0x127dd5(0x147)],'status':_0x13edaf,'amount':_0x1285d0[_0x127dd5(0x110)],'currency':_0x1285d0[_0x127dd5(0x109)],'additionalInfo':{'method':_0x1285d0[_0x127dd5(0x16b)],'bankId':_0x1285d0[_0x127dd5(0xf6)],'settled':_0x1285d0[_0x127dd5(0x141)],'settlementDate':_0x1285d0['SettlementDate'],'remitterName':_0x1285d0['Remitter']?.[_0x127dd5(0xf0)],'remitterIban':_0x1285d0['Remitter']?.[_0x127dd5(0x161)],'bankTransactionId':_0x1285d0[_0x127dd5(0x125)]}};}[a46_0x5c98ef(0x144)](_0x13d43a,_0x232e07){const _0x607d3d=a46_0x5c98ef;return console[_0x607d3d(0x129)](_0x607d3d(0x108),{'receivedSignature':_0x232e07,'paymentId':_0x13d43a[_0x607d3d(0x147)],'merchantPaymentId':_0x13d43a[_0x607d3d(0x15f)]}),!![];}}exports[a46_0x5c98ef(0x162)]=NodaService;