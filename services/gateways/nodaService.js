'use strict';const a40_0x29be44=a40_0x5cc0;function a40_0x3d81(){const _0x1545bb=['qrCodeLink','cancelled','491394gQuBYs','processWebhook','BankId','log','Status\x20Text:','Yes','done','/payment-links','logWhiteDomainError','json','Currency','__esModule','loggerService','isActive','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Unknown\x20error\x20from\x20Noda\x20API','PaymentId','../loggerService','message','PENDING','Response\x20Body:','Order\x20ID\x20Used:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Noda\x20API\x20error:\x20','POST','Method','headers','application/json','Amount','statusText','Status','verifyWebhookSignature','HTTP\x20Status:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','URL:','Payment\x20Link\x20ID:','in_progress','https://tesoft.uk/gateway/noda/','Unknown\x20error','now','Parsed\x20Result:','Not\x20provided','/payment-links/','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Response\x20data:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','291196nRcqfg','success','Error\x20stack:','Short\x20Link:','NodaService','logWhiteDomainRequest','paid','1072nKSVuZ','logWhiteDomainResponse','(8digits-8digits\x20format\x20for\x20Noda)','Processing\x20Noda\x20webhook:','Status:','rejected','toLowerCase','amount','text','timeout','Iban','1214185KDcgDU','statusCode','FAILED','defineProperty','Noda\x20webhook\x20signature\x20verification:','Remitter','verifyPayment','error','TesSoft\x20Payment\x20System/1.0','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','12096sWFlpJ','PAID','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','stringify','toUpperCase','===\x20NODA\x20API\x20ERROR\x20===','===\x20PARSED\x20NODA\x20RESPONSE\x20===','EXPIRED','Response\x20Time:','202715VuYHhg','Order\x20ID\x20Format:','created','956732zWekPM','parse','Headers:','expired','currency','BankTransactionId','HTTP\x20error!\x20status:\x20','HTTP\x20','Request\x20Body\x20(Direct\x20JSON):','shortLinkUrls','Error\x20details:','Settled','JSON\x20Parse\x20Error:\x20','expiryDate','218595hQKwzI','Raw\x20Response\x20Body:','===\x20NODA\x20SERVICE\x20ERROR\x20===','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','apiUrl','Business\x20Error:\x20','https://tesoft.uk/gateway/success.php?id=','stack','noda','completed','Name','shortLink',',\x20body:\x20','canceled','78CKHgwe','Failed\x20to\x20parse\x20JSON\x20response:','status','GET','MerchantPaymentId'];a40_0x3d81=function(){return _0x1545bb;};return a40_0x3d81();}(function(_0x170a92,_0x3cde1b){const _0x1d9ad3=a40_0x5cc0,_0x45eb74=_0x170a92();while(!![]){try{const _0x6368a8=parseInt(_0x1d9ad3(0x147))/0x1+parseInt(_0x1d9ad3(0x19d))/0x2+-parseInt(_0x1d9ad3(0x132))/0x3+-parseInt(_0x1d9ad3(0x175))/0x4+parseInt(_0x1d9ad3(0x19a))/0x5*(-parseInt(_0x1d9ad3(0x140))/0x6)+parseInt(_0x1d9ad3(0x187))/0x7+parseInt(_0x1d9ad3(0x17c))/0x8*(-parseInt(_0x1d9ad3(0x191))/0x9);if(_0x6368a8===_0x3cde1b)break;else _0x45eb74['push'](_0x45eb74['shift']());}catch(_0x507d06){_0x45eb74['push'](_0x45eb74['shift']());}}}(a40_0x3d81,0x46e5c));Object[a40_0x29be44(0x18a)](exports,a40_0x29be44(0x152),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a40_0x29be44(0x158));class NodaService{constructor(){const _0x321d44=a40_0x29be44;this[_0x321d44(0x136)]=_0x321d44(0x16c),console['log'](_0x321d44(0x135));}async['createPaymentLink'](_0x20389d){const _0x240b75=a40_0x29be44,{orderId:_0x42ea0a,name:_0x49904a,paymentDescription:_0x10915d,amount:_0x239680,currency:_0x36dcc2,webhookUrl:_0x1c10a6,returnUrl:_0x23d9c5,expiryDate:_0x355344}=_0x20389d,_0x22af49=_0x36dcc2[_0x240b75(0x195)](),_0x20b222='https://tesoft.uk/gateway/noda/webhook/',_0x1112ef=_0x240b75(0x138)+_0x42ea0a,_0x10b73d={'name':_0x49904a,'paymentDescription':_0x10915d,'amount':_0x239680,'currency':_0x22af49,'paymentId':_0x42ea0a,'webhookUrl':_0x20b222,'returnUrl':_0x1112ef};_0x355344&&(_0x10b73d[_0x240b75(0x131)]=_0x355344);const _0x28edb6=Date[_0x240b75(0x16e)]();try{console[_0x240b75(0x14a)](_0x240b75(0x174)),console[_0x240b75(0x14a)](_0x240b75(0x169),this[_0x240b75(0x136)]),console['log'](_0x240b75(0x1a5),JSON['stringify'](_0x10b73d,null,0x2)),console['log'](_0x240b75(0x19b),_0x42ea0a,_0x240b75(0x17e)),loggerService_1[_0x240b75(0x153)][_0x240b75(0x17a)](_0x240b75(0x13a),_0x240b75(0x14e),_0x240b75(0x15f),_0x10b73d);const _0x14f7b0=await fetch(this[_0x240b75(0x136)],{'method':_0x240b75(0x15f),'headers':{'Content-Type':'application/json','Accept':_0x240b75(0x162),'User-Agent':_0x240b75(0x18f)},'body':JSON['stringify'](_0x10b73d)}),_0x44f7a8=Date['now']()-_0x28edb6;console['log'](_0x240b75(0x168)),console[_0x240b75(0x14a)](_0x240b75(0x180),_0x14f7b0[_0x240b75(0x142)]),console['log'](_0x240b75(0x14b),_0x14f7b0[_0x240b75(0x164)]),console['log'](_0x240b75(0x19f),Object['fromEntries'](_0x14f7b0[_0x240b75(0x161)]['entries']())),console[_0x240b75(0x14a)](_0x240b75(0x199),_0x44f7a8+'ms');const _0x226725=await _0x14f7b0[_0x240b75(0x184)]();console[_0x240b75(0x14a)](_0x240b75(0x133),_0x226725);if(!_0x14f7b0['ok']){console[_0x240b75(0x18e)](_0x240b75(0x196)),console['error'](_0x240b75(0x167),_0x14f7b0[_0x240b75(0x142)]),console[_0x240b75(0x18e)](_0x240b75(0x15b),_0x226725),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x240b75(0x13a),_0x240b75(0x14e),_0x14f7b0['status'],_0x226725,_0x44f7a8),loggerService_1['loggerService'][_0x240b75(0x14f)]('noda','/payment-links',_0x240b75(0x1a4)+_0x14f7b0[_0x240b75(0x142)]+':\x20'+_0x226725);if(_0x14f7b0['status']===0x190)throw new Error(_0x240b75(0x172));else{if(_0x14f7b0['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x240b75(0x1a3)+_0x14f7b0['status']+_0x240b75(0x13e)+_0x226725);}let _0x1d5123;try{_0x1d5123=JSON[_0x240b75(0x19e)](_0x226725);}catch(_0x54bc1e){console['error'](_0x240b75(0x141),_0x54bc1e),loggerService_1['loggerService'][_0x240b75(0x14f)](_0x240b75(0x13a),_0x240b75(0x14e),_0x240b75(0x130)+_0x54bc1e);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x226725);}console[_0x240b75(0x14a)](_0x240b75(0x197)),console[_0x240b75(0x14a)](_0x240b75(0x16f),JSON[_0x240b75(0x194)](_0x1d5123,null,0x2)),loggerService_1['loggerService'][_0x240b75(0x17d)]('noda',_0x240b75(0x14e),_0x14f7b0[_0x240b75(0x142)],_0x1d5123,_0x44f7a8);if(_0x1d5123['error']||_0x1d5123[_0x240b75(0x188)]){const _0x2e61d2=_0x1d5123['message']||_0x1d5123[_0x240b75(0x18e)]||_0x240b75(0x156);console[_0x240b75(0x18e)](_0x240b75(0x155)),console[_0x240b75(0x18e)]('Error\x20Message:',_0x2e61d2),console[_0x240b75(0x18e)]('Status\x20Code:',_0x1d5123[_0x240b75(0x188)]),loggerService_1[_0x240b75(0x153)][_0x240b75(0x14f)](_0x240b75(0x13a),_0x240b75(0x14e),_0x240b75(0x137)+_0x2e61d2);throw new Error(_0x240b75(0x15e)+_0x2e61d2);}if(!_0x1d5123['id']||!_0x1d5123[_0x240b75(0x1a6)]?.[_0x240b75(0x13d)]){console[_0x240b75(0x18e)](_0x240b75(0x15d)),console[_0x240b75(0x18e)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x240b75(0x18e)](_0x240b75(0x173),_0x1d5123),loggerService_1['loggerService'][_0x240b75(0x14f)](_0x240b75(0x13a),'/payment-links',_0x240b75(0x193));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x240b75(0x14a)]('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x240b75(0x16a),_0x1d5123['id']),console['log'](_0x240b75(0x178),_0x1d5123[_0x240b75(0x1a6)][_0x240b75(0x13d)]),console[_0x240b75(0x14a)]('QR\x20Code\x20Link:',_0x1d5123['shortLinkUrls'][_0x240b75(0x145)]||_0x240b75(0x170)),console[_0x240b75(0x14a)](_0x240b75(0x15c),_0x42ea0a,'(8digits-8digits\x20format)'),{'gateway_payment_id':_0x1d5123['id'],'payment_url':_0x1d5123['shortLinkUrls'][_0x240b75(0x13d)],'qr_code_url':_0x1d5123[_0x240b75(0x1a6)]['qrCodeLink'],'expiry_date':_0x1d5123[_0x240b75(0x131)]};}catch(_0x185df8){console['error'](_0x240b75(0x134)),console[_0x240b75(0x18e)](_0x240b75(0x1a7),_0x185df8),loggerService_1[_0x240b75(0x153)][_0x240b75(0x14f)](_0x240b75(0x13a),_0x240b75(0x14e),_0x185df8);if(_0x185df8 instanceof Error){console[_0x240b75(0x18e)]('Error\x20message:',_0x185df8[_0x240b75(0x159)]),console['error'](_0x240b75(0x177),_0x185df8[_0x240b75(0x139)]);throw new Error(_0x240b75(0x190)+_0x185df8[_0x240b75(0x159)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x29be44(0x18d)](_0x178062){const _0x1d8b94=a40_0x29be44,_0x6255f7=Date[_0x1d8b94(0x16e)]();try{loggerService_1['loggerService'][_0x1d8b94(0x17a)](_0x1d8b94(0x13a),'/payment-links/'+_0x178062,_0x1d8b94(0x143),{});const _0x3a8251=await fetch(this[_0x1d8b94(0x136)]+'/'+_0x178062,{'method':_0x1d8b94(0x143),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x901c15=Date[_0x1d8b94(0x16e)]()-_0x6255f7;if(!_0x3a8251['ok']){const _0x576812=await _0x3a8251['text']();loggerService_1[_0x1d8b94(0x153)]['logWhiteDomainResponse'](_0x1d8b94(0x13a),_0x1d8b94(0x171)+_0x178062,_0x3a8251[_0x1d8b94(0x142)],_0x576812,_0x901c15);throw new Error(_0x1d8b94(0x1a3)+_0x3a8251[_0x1d8b94(0x142)]);}const _0x17dde9=await _0x3a8251[_0x1d8b94(0x150)]();loggerService_1[_0x1d8b94(0x153)]['logWhiteDomainResponse'](_0x1d8b94(0x13a),_0x1d8b94(0x171)+_0x178062,_0x3a8251[_0x1d8b94(0x142)],_0x17dde9,_0x901c15);if(_0x17dde9[_0x1d8b94(0x18e)]||_0x17dde9[_0x1d8b94(0x188)]){loggerService_1[_0x1d8b94(0x153)][_0x1d8b94(0x14f)](_0x1d8b94(0x13a),'/payment-links/'+_0x178062,_0x1d8b94(0x15e)+(_0x17dde9[_0x1d8b94(0x159)]||_0x17dde9[_0x1d8b94(0x18e)]||_0x1d8b94(0x16d)));throw new Error(_0x1d8b94(0x15e)+(_0x17dde9['message']||_0x17dde9[_0x1d8b94(0x18e)]||_0x1d8b94(0x16d)));}let _0x3119a2='PENDING';if(_0x17dde9[_0x1d8b94(0x154)]===![]){if(_0x17dde9[_0x1d8b94(0x131)]){const _0x1ca427=new Date(_0x17dde9[_0x1d8b94(0x131)]),_0x499b3a=new Date();_0x1ca427<_0x499b3a?_0x3119a2=_0x1d8b94(0x198):_0x3119a2=_0x1d8b94(0x189);}else _0x3119a2=_0x1d8b94(0x189);}else _0x3119a2=_0x1d8b94(0x15a);return{'status':_0x3119a2,'amount':_0x17dde9[_0x1d8b94(0x183)],'currency':_0x17dde9[_0x1d8b94(0x1a1)],'isActive':_0x17dde9['isActive']};}catch(_0x3c4a76){console['error']('Noda\x20payment\x20verification\x20error:',_0x3c4a76),loggerService_1[_0x1d8b94(0x153)][_0x1d8b94(0x14f)](_0x1d8b94(0x13a),_0x1d8b94(0x171)+_0x178062,_0x3c4a76);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x3c4a76 instanceof Error?_0x3c4a76[_0x1d8b94(0x159)]:'Unknown\x20error'));}}async[a40_0x29be44(0x148)](_0x12e159){const _0x3ab631=a40_0x29be44;console[_0x3ab631(0x14a)](_0x3ab631(0x17f),_0x12e159);let _0x254957=_0x3ab631(0x15a);switch(_0x12e159[_0x3ab631(0x165)]?.[_0x3ab631(0x182)]()){case _0x3ab631(0x14d):case _0x3ab631(0x13b):case _0x3ab631(0x17b):case _0x3ab631(0x176):case'successful':_0x12e159[_0x3ab631(0x1a8)]===_0x3ab631(0x14c)?_0x254957=_0x3ab631(0x192):_0x254957=_0x3ab631(0x15a);break;case _0x3ab631(0x146):case _0x3ab631(0x13f):case'failed':case _0x3ab631(0x18e):case _0x3ab631(0x181):_0x254957='FAILED';break;case _0x3ab631(0x1a0):case _0x3ab631(0x185):_0x254957=_0x3ab631(0x198);break;case'pending':case _0x3ab631(0x19c):case'active':case'processing':case _0x3ab631(0x16b):default:_0x254957=_0x3ab631(0x15a);break;}return{'paymentId':_0x12e159[_0x3ab631(0x144)]||_0x12e159[_0x3ab631(0x157)],'status':_0x254957,'amount':_0x12e159[_0x3ab631(0x163)],'currency':_0x12e159[_0x3ab631(0x151)],'additionalInfo':{'method':_0x12e159[_0x3ab631(0x160)],'bankId':_0x12e159[_0x3ab631(0x149)],'settled':_0x12e159['Settled'],'settlementDate':_0x12e159['SettlementDate'],'remitterName':_0x12e159[_0x3ab631(0x18c)]?.[_0x3ab631(0x13c)],'remitterIban':_0x12e159[_0x3ab631(0x18c)]?.[_0x3ab631(0x186)],'bankTransactionId':_0x12e159[_0x3ab631(0x1a2)]}};}[a40_0x29be44(0x166)](_0x46f71b,_0x54ec16){const _0x13500e=a40_0x29be44;return console[_0x13500e(0x14a)](_0x13500e(0x18b),{'receivedSignature':_0x54ec16,'paymentId':_0x46f71b['PaymentId'],'merchantPaymentId':_0x46f71b[_0x13500e(0x144)]}),!![];}}function a40_0x5cc0(_0x2237c3,_0xd168ac){const _0x3d8169=a40_0x3d81();return a40_0x5cc0=function(_0x5cc05e,_0x2d3cd4){_0x5cc05e=_0x5cc05e-0x130;let _0x162507=_0x3d8169[_0x5cc05e];return _0x162507;},a40_0x5cc0(_0x2237c3,_0xd168ac);}exports[a40_0x29be44(0x179)]=NodaService;