'use strict';const a60_0x1bdf26=a60_0x5bcb;(function(_0x4f0c4f,_0x578afc){const _0x5028d5=a60_0x5bcb,_0x3ab329=_0x4f0c4f();while(!![]){try{const _0x5ab23c=parseInt(_0x5028d5(0x127))/0x1+-parseInt(_0x5028d5(0xe5))/0x2*(-parseInt(_0x5028d5(0xd8))/0x3)+-parseInt(_0x5028d5(0x11e))/0x4*(-parseInt(_0x5028d5(0x111))/0x5)+-parseInt(_0x5028d5(0xcf))/0x6*(parseInt(_0x5028d5(0x107))/0x7)+-parseInt(_0x5028d5(0xc5))/0x8+parseInt(_0x5028d5(0xfa))/0x9+-parseInt(_0x5028d5(0x117))/0xa;if(_0x5ab23c===_0x578afc)break;else _0x3ab329['push'](_0x3ab329['shift']());}catch(_0x59c058){_0x3ab329['push'](_0x3ab329['shift']());}}}(a60_0x4f89,0x5c9b9));Object[a60_0x1bdf26(0xd4)](exports,'__esModule',{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a60_0x1bdf26(0x110));class NodaService{constructor(){const _0x4c4b86=a60_0x1bdf26;this[_0x4c4b86(0x10f)]=_0x4c4b86(0xed),console[_0x4c4b86(0x112)](_0x4c4b86(0xfc));}async[a60_0x1bdf26(0xf6)](_0x25f309){const _0x5c5f5e=a60_0x1bdf26,{orderId:_0x1bbb92,name:_0x4ec9f5,paymentDescription:_0x5746b1,amount:_0x2655c9,currency:_0x1d6825,webhookUrl:_0x5bdd3d,returnUrl:_0x52d313,expiryDate:_0x1a2d6c}=_0x25f309,_0x145011=_0x1d6825['toUpperCase'](),_0x16bd4b='https://tesoft.uk/gateway/noda/webhook/',_0x46e1eb=_0x5c5f5e(0xcc)+_0x1bbb92,_0x47828d={'name':_0x4ec9f5,'paymentDescription':_0x5746b1,'amount':_0x2655c9,'currency':_0x145011,'paymentId':_0x1bbb92,'webhookUrl':_0x16bd4b,'returnUrl':_0x46e1eb};_0x1a2d6c&&(_0x47828d['expiryDate']=_0x1a2d6c);const _0x5a3921=Date[_0x5c5f5e(0xdc)]();try{console[_0x5c5f5e(0x112)](_0x5c5f5e(0x11b)),console['log'](_0x5c5f5e(0xd7),this[_0x5c5f5e(0x10f)]),console['log'](_0x5c5f5e(0x101),JSON[_0x5c5f5e(0xf7)](_0x47828d,null,0x2)),console[_0x5c5f5e(0x112)](_0x5c5f5e(0xbe),_0x1bbb92,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x5c5f5e(0x112)](_0x5c5f5e(0x11f),_0x46e1eb),loggerService_1[_0x5c5f5e(0xe8)][_0x5c5f5e(0xde)](_0x5c5f5e(0xc7),_0x5c5f5e(0x10e),'POST',_0x47828d);const _0x1cf5fa=await fetch(this[_0x5c5f5e(0x10f)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x5c5f5e(0xf2),'User-Agent':_0x5c5f5e(0xdf)},'body':JSON[_0x5c5f5e(0xf7)](_0x47828d)}),_0x5efce7=Date[_0x5c5f5e(0xdc)]()-_0x5a3921;console[_0x5c5f5e(0x112)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x5c5f5e(0x112)](_0x5c5f5e(0x128),_0x1cf5fa[_0x5c5f5e(0x10b)]),console[_0x5c5f5e(0x112)](_0x5c5f5e(0x11d),_0x1cf5fa['statusText']),console[_0x5c5f5e(0x112)](_0x5c5f5e(0x114),Object[_0x5c5f5e(0xbf)](_0x1cf5fa[_0x5c5f5e(0xff)][_0x5c5f5e(0x11c)]())),console[_0x5c5f5e(0x112)]('Response\x20Time:',_0x5efce7+'ms');const _0x358c56=await _0x1cf5fa[_0x5c5f5e(0xb9)]();console[_0x5c5f5e(0x112)](_0x5c5f5e(0xe7),_0x358c56);if(!_0x1cf5fa['ok']){console['error'](_0x5c5f5e(0x105)),console[_0x5c5f5e(0xc4)]('HTTP\x20Status:',_0x1cf5fa['status']),console[_0x5c5f5e(0xc4)](_0x5c5f5e(0xd3),_0x358c56),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x5c5f5e(0xc7),'/payment-links',_0x1cf5fa[_0x5c5f5e(0x10b)],_0x358c56,_0x5efce7),loggerService_1[_0x5c5f5e(0xe8)][_0x5c5f5e(0x126)]('noda',_0x5c5f5e(0x10e),'HTTP\x20'+_0x1cf5fa[_0x5c5f5e(0x10b)]+':\x20'+_0x358c56);if(_0x1cf5fa['status']===0x190)throw new Error(_0x5c5f5e(0xec));else{if(_0x1cf5fa[_0x5c5f5e(0x10b)]===0x1f4)throw new Error(_0x5c5f5e(0xd2));}throw new Error(_0x5c5f5e(0xe3)+_0x1cf5fa['status']+_0x5c5f5e(0xdd)+_0x358c56);}let _0x11f162;try{_0x11f162=JSON['parse'](_0x358c56);}catch(_0x4cf2ca){console[_0x5c5f5e(0xc4)](_0x5c5f5e(0xe4),_0x4cf2ca),loggerService_1[_0x5c5f5e(0xe8)]['logWhiteDomainError']('noda',_0x5c5f5e(0x10e),_0x5c5f5e(0x10a)+_0x4cf2ca);throw new Error(_0x5c5f5e(0x10c)+_0x358c56);}console[_0x5c5f5e(0x112)](_0x5c5f5e(0xfd)),console[_0x5c5f5e(0x112)](_0x5c5f5e(0x104),JSON['stringify'](_0x11f162,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x5c5f5e(0xc7),_0x5c5f5e(0x10e),_0x1cf5fa[_0x5c5f5e(0x10b)],_0x11f162,_0x5efce7);if(_0x11f162[_0x5c5f5e(0xc4)]||_0x11f162[_0x5c5f5e(0x100)]){const _0x10300c=_0x11f162['message']||_0x11f162[_0x5c5f5e(0xc4)]||_0x5c5f5e(0xdb);console[_0x5c5f5e(0xc4)](_0x5c5f5e(0x121)),console[_0x5c5f5e(0xc4)](_0x5c5f5e(0x120),_0x10300c),console['error'](_0x5c5f5e(0xf3),_0x11f162[_0x5c5f5e(0x100)]),loggerService_1[_0x5c5f5e(0xe8)][_0x5c5f5e(0x126)](_0x5c5f5e(0xc7),'/payment-links',_0x5c5f5e(0xcb)+_0x10300c);throw new Error(_0x5c5f5e(0xc3)+_0x10300c);}if(!_0x11f162['id']||!_0x11f162[_0x5c5f5e(0x115)]?.['shortLink']){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x5c5f5e(0xc4)](_0x5c5f5e(0x123)),console['error'](_0x5c5f5e(0xf4),_0x11f162),loggerService_1[_0x5c5f5e(0xe8)][_0x5c5f5e(0x126)](_0x5c5f5e(0xc7),_0x5c5f5e(0x10e),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x5c5f5e(0x112)](_0x5c5f5e(0x106)),console['log'](_0x5c5f5e(0xc2),_0x11f162['id']),console[_0x5c5f5e(0x112)]('Short\x20Link:',_0x11f162[_0x5c5f5e(0x115)][_0x5c5f5e(0xb5)]),console['log'](_0x5c5f5e(0xbc),_0x11f162[_0x5c5f5e(0x115)][_0x5c5f5e(0xf8)]||_0x5c5f5e(0xce)),console[_0x5c5f5e(0x112)](_0x5c5f5e(0xfe),_0x1bbb92,_0x5c5f5e(0xb7)),console['log'](_0x5c5f5e(0xb0),_0x46e1eb),{'gateway_payment_id':_0x11f162['id'],'payment_url':_0x11f162['shortLinkUrls']['shortLink'],'qr_code_url':_0x11f162[_0x5c5f5e(0x115)][_0x5c5f5e(0xf8)],'expiry_date':_0x11f162[_0x5c5f5e(0x116)]};}catch(_0xf9a131){console[_0x5c5f5e(0xc4)](_0x5c5f5e(0x109)),console['error'](_0x5c5f5e(0xea),_0xf9a131),loggerService_1[_0x5c5f5e(0xe8)][_0x5c5f5e(0x126)](_0x5c5f5e(0xc7),'/payment-links',_0xf9a131);if(_0xf9a131 instanceof Error){console[_0x5c5f5e(0xc4)](_0x5c5f5e(0x108),_0xf9a131[_0x5c5f5e(0x118)]),console[_0x5c5f5e(0xc4)](_0x5c5f5e(0xc0),_0xf9a131['stack']);throw new Error(_0x5c5f5e(0xe9)+_0xf9a131['message']);}throw new Error(_0x5c5f5e(0xba));}}async[a60_0x1bdf26(0xf9)](_0x25be91){const _0x40a44d=a60_0x1bdf26,_0x45f91b=Date[_0x40a44d(0xdc)]();try{loggerService_1[_0x40a44d(0xe8)][_0x40a44d(0xde)](_0x40a44d(0xc7),'/payment-links/'+_0x25be91,_0x40a44d(0xd6),{});const _0x440760=await fetch(this['apiUrl']+'/'+_0x25be91,{'method':_0x40a44d(0xd6),'headers':{'Content-Type':'application/json','User-Agent':_0x40a44d(0xdf)}}),_0x2c381b=Date['now']()-_0x45f91b;if(!_0x440760['ok']){const _0x1e8c75=await _0x440760[_0x40a44d(0xb9)]();loggerService_1[_0x40a44d(0xe8)][_0x40a44d(0xc9)](_0x40a44d(0xc7),_0x40a44d(0xeb)+_0x25be91,_0x440760[_0x40a44d(0x10b)],_0x1e8c75,_0x2c381b);throw new Error(_0x40a44d(0xe3)+_0x440760['status']);}const _0x581dd8=await _0x440760[_0x40a44d(0xda)]();loggerService_1[_0x40a44d(0xe8)][_0x40a44d(0xc9)](_0x40a44d(0xc7),_0x40a44d(0xeb)+_0x25be91,_0x440760['status'],_0x581dd8,_0x2c381b);if(_0x581dd8[_0x40a44d(0xc4)]||_0x581dd8[_0x40a44d(0x100)]){loggerService_1[_0x40a44d(0xe8)][_0x40a44d(0x126)](_0x40a44d(0xc7),_0x40a44d(0xeb)+_0x25be91,_0x40a44d(0xc3)+(_0x581dd8[_0x40a44d(0x118)]||_0x581dd8['error']||_0x40a44d(0xb4)));throw new Error('Noda\x20API\x20error:\x20'+(_0x581dd8[_0x40a44d(0x118)]||_0x581dd8[_0x40a44d(0xc4)]||_0x40a44d(0xb4)));}let _0x2c69aa=_0x40a44d(0xfb);if(_0x581dd8[_0x40a44d(0x122)]===![]){if(_0x581dd8[_0x40a44d(0x116)]){const _0x476c8f=new Date(_0x581dd8[_0x40a44d(0x116)]),_0x350abe=new Date();_0x476c8f<_0x350abe?_0x2c69aa=_0x40a44d(0xef):_0x2c69aa=_0x40a44d(0xca);}else _0x2c69aa=_0x40a44d(0xca);}else _0x2c69aa=_0x40a44d(0xfb);return{'status':_0x2c69aa,'amount':_0x581dd8[_0x40a44d(0xbd)],'currency':_0x581dd8[_0x40a44d(0xee)],'isActive':_0x581dd8[_0x40a44d(0x122)]};}catch(_0x2ec817){console[_0x40a44d(0xc4)](_0x40a44d(0xb6),_0x2ec817),loggerService_1[_0x40a44d(0xe8)]['logWhiteDomainError'](_0x40a44d(0xc7),_0x40a44d(0xeb)+_0x25be91,_0x2ec817);throw new Error(_0x40a44d(0x125)+(_0x2ec817 instanceof Error?_0x2ec817['message']:'Unknown\x20error'));}}async[a60_0x1bdf26(0x124)](_0xf195a7){const _0x446f73=a60_0x1bdf26;console[_0x446f73(0x112)](_0x446f73(0xd1),_0xf195a7);let _0x315513='PENDING';switch(_0xf195a7[_0x446f73(0xb1)]?.[_0x446f73(0xb2)]()){case _0x446f73(0xf0):case _0x446f73(0x129):case _0x446f73(0xc8):case _0x446f73(0xc1):case _0x446f73(0xd0):_0xf195a7[_0x446f73(0x11a)]===_0x446f73(0xf1)?_0x315513=_0x446f73(0xe1):_0x315513=_0x446f73(0xfb);break;case'cancelled':case _0x446f73(0xf5):case'failed':case _0x446f73(0xc4):case _0x446f73(0xe2):_0x315513=_0x446f73(0xca);break;case _0x446f73(0xd5):case _0x446f73(0xe0):_0x315513='EXPIRED';break;case'pending':case _0x446f73(0xcd):case _0x446f73(0x113):case _0x446f73(0xb8):case _0x446f73(0x119):default:_0x315513=_0x446f73(0xfb);break;}return{'paymentId':_0xf195a7['MerchantPaymentId']||_0xf195a7[_0x446f73(0x103)],'status':_0x315513,'amount':_0xf195a7[_0x446f73(0x102)],'currency':_0xf195a7['Currency'],'additionalInfo':{'method':_0xf195a7['Method'],'bankId':_0xf195a7[_0x446f73(0xd9)],'settled':_0xf195a7['Settled'],'settlementDate':_0xf195a7['SettlementDate'],'remitterName':_0xf195a7[_0x446f73(0xbb)]?.['Name'],'remitterIban':_0xf195a7['Remitter']?.[_0x446f73(0x12a)],'bankTransactionId':_0xf195a7[_0x446f73(0x10d)]}};}[a60_0x1bdf26(0xb3)](_0x558f5d,_0x2b9971){const _0x5ae222=a60_0x1bdf26;return console[_0x5ae222(0x112)](_0x5ae222(0xe6),{'receivedSignature':_0x2b9971,'paymentId':_0x558f5d[_0x5ae222(0x103)],'merchantPaymentId':_0x558f5d['MerchantPaymentId']}),!![];}}function a60_0x5bcb(_0x23aba0,_0x4f7e65){_0x23aba0=_0x23aba0-0xb0;const _0x4f89f1=a60_0x4f89();let _0x5bcbfb=_0x4f89f1[_0x23aba0];return _0x5bcbfb;}exports[a60_0x1bdf26(0xc6)]=NodaService;function a60_0x4f89(){const _0x5dc0f7=['Processing\x20Noda\x20webhook:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Response\x20Body:','defineProperty','expired','GET','URL:','6lBldLd','BankId','json','Unknown\x20error\x20from\x20Noda\x20API','now',',\x20body:\x20','logWhiteDomainRequest','Payment\x20System/1.0','timeout','PAID','rejected','HTTP\x20error!\x20status:\x20','Failed\x20to\x20parse\x20JSON\x20response:','584838leCnHr','Noda\x20webhook\x20signature\x20verification:','Raw\x20Response\x20Body:','loggerService','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Error\x20details:','/payment-links/','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','https://tesoft.uk/gateway/noda/','currency','EXPIRED','done','Yes','application/json','Status\x20Code:','Response\x20data:','canceled','createPaymentLink','stringify','qrCodeLink','verifyPayment','5023665CkryWt','PENDING','ðŸŒ\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Order\x20ID\x20Used:','headers','statusCode','Request\x20Body\x20(Direct\x20JSON):','Amount','PaymentId','Parsed\x20Result:','===\x20NODA\x20API\x20ERROR\x20===','===\x20NODA\x20SUCCESS\x20===','256081JeCPaw','Error\x20message:','===\x20NODA\x20SERVICE\x20ERROR\x20===','JSON\x20Parse\x20Error:\x20','status','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','BankTransactionId','/payment-links','apiUrl','../loggerService','5yNbUGv','log','active','Headers:','shortLinkUrls','expiryDate','14759010DnJgyT','message','in_progress','Settled','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','entries','Status\x20Text:','2936396wAopFt','âœ…\x20ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž:\x20Return\x20URL\x20uses\x20pending.php:','Error\x20Message:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','isActive','Missing\x20id\x20or\x20shortLink\x20in\x20response','processWebhook','Failed\x20to\x20verify\x20Noda\x20payment:\x20','logWhiteDomainError','145796AoiNfV','Status:','completed','Iban','âœ…\x20Return\x20URL\x20configured\x20for\x20pending:','Status','toLowerCase','verifyWebhookSignature','Unknown\x20error','shortLink','Noda\x20payment\x20verification\x20error:','(8digits-8digits\x20format)','processing','text','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Remitter','QR\x20Code\x20Link:','amount','Order\x20ID\x20Format:','fromEntries','Error\x20stack:','success','Payment\x20Link\x20ID:','Noda\x20API\x20error:\x20','error','1048904nOqNqR','NodaService','noda','paid','logWhiteDomainResponse','FAILED','Business\x20Error:\x20','https://tesoft.uk/gateway/pending.php?id=','created','Not\x20provided','6wcDeRO','successful'];a60_0x4f89=function(){return _0x5dc0f7;};return a60_0x4f89();}