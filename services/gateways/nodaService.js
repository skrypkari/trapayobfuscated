'use strict';const a44_0x427f01=a44_0x4ca6;(function(_0x1f1497,_0x5475ae){const _0x41090c=a44_0x4ca6,_0x3e7e58=_0x1f1497();while(!![]){try{const _0x5e402=parseInt(_0x41090c(0x156))/0x1*(-parseInt(_0x41090c(0x19a))/0x2)+parseInt(_0x41090c(0x181))/0x3+-parseInt(_0x41090c(0x170))/0x4*(parseInt(_0x41090c(0x173))/0x5)+-parseInt(_0x41090c(0x1b9))/0x6*(parseInt(_0x41090c(0x150))/0x7)+parseInt(_0x41090c(0x172))/0x8*(-parseInt(_0x41090c(0x1a1))/0x9)+-parseInt(_0x41090c(0x17f))/0xa*(-parseInt(_0x41090c(0x160))/0xb)+-parseInt(_0x41090c(0x166))/0xc*(-parseInt(_0x41090c(0x17e))/0xd);if(_0x5e402===_0x5475ae)break;else _0x3e7e58['push'](_0x3e7e58['shift']());}catch(_0x4e7b01){_0x3e7e58['push'](_0x3e7e58['shift']());}}}(a44_0x3a18,0x383d4));function a44_0x3a18(){const _0x4295a7=['shortLinkUrls','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','rejected','Settled','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','172uSvOoD','timeout','8TdWvCE','33835HSpVjh','https://tesoft.uk/gateway/pending.php?id=','cancelled','qrCodeLink','Currency','message','URL:','entries','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','canceled','Processing\x20Noda\x20webhook:','26bVHkLz','2918310OsGGMh','https://tesoft.uk/gateway/noda/','861204zWNLuB','in_progress','processWebhook','status','HTTP\x20','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','HTTP\x20error!\x20status:\x20','application/json','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Method','Order\x20ID\x20Used:','expiryDate','(8digits-8digits\x20format\x20for\x20Noda)','Order\x20ID\x20Format:','text','Iban','logWhiteDomainError','Missing\x20id\x20or\x20shortLink\x20in\x20response','===\x20NODA\x20SUCCESS\x20===','Failed\x20to\x20verify\x20Noda\x20payment:\x20','loggerService','Error\x20message:','completed','log','13786Cyodmy','noda','paid','PENDING','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','POST','MerchantPaymentId','1879749qBFdLR','Amount','created','verifyWebhookSignature','FAILED','NodaService','apiUrl','defineProperty','shortLink','statusCode','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Headers:','processing','Not\x20provided','active','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','toUpperCase','fromEntries','TesSoft\x20Payment\x20System/1.0','Response\x20Time:','Status\x20Text:','Payment\x20Link\x20ID:','error','now','6mDpDAl','__esModule','PAID','isActive','Noda\x20payment\x20verification\x20error:','currency','Request\x20Body\x20(Direct\x20JSON):','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','/payment-links','JSON\x20Parse\x20Error:\x20','Unknown\x20error\x20from\x20Noda\x20API','Remitter','expired','Noda\x20API\x20error:\x20','Status','PaymentId',',\x20body:\x20','Status\x20Code:','Short\x20Link:','2756747FjXpvl','https://tesoft.uk/gateway/noda/webhook/','SettlementDate','stringify','QR\x20Code\x20Link:','Response\x20Body:','52NEqRJM','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','===\x20NODA\x20API\x20ERROR\x20===','parse','Status:','GET','Parsed\x20Result:','Error\x20Message:','statusText','logWhiteDomainResponse','11WiWZjl','BankId','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','EXPIRED','Unknown\x20error','/payment-links/','5421336Ftgcwh','failed','pending','Yes','Error\x20details:'];a44_0x3a18=function(){return _0x4295a7;};return a44_0x3a18();}function a44_0x4ca6(_0x4297c0,_0x492c5e){const _0x3a18b8=a44_0x3a18();return a44_0x4ca6=function(_0x4ca67c,_0x126825){_0x4ca67c=_0x4ca67c-0x14b;let _0xcc32f0=_0x3a18b8[_0x4ca67c];return _0xcc32f0;},a44_0x4ca6(_0x4297c0,_0x492c5e);}Object[a44_0x427f01(0x1a8)](exports,a44_0x427f01(0x1ba),{'value':!![]}),exports[a44_0x427f01(0x1a6)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x4b38a8=a44_0x427f01;this[_0x4b38a8(0x1a7)]=_0x4b38a8(0x180),console[_0x4b38a8(0x199)](_0x4b38a8(0x17b));}async['createPaymentLink'](_0x129302){const _0x44a182=a44_0x427f01,{orderId:_0x2d098a,name:_0x39183a,paymentDescription:_0x225e47,amount:_0x283f11,currency:_0x587b8,webhookUrl:_0x1923aa,returnUrl:_0x56dab2,expiryDate:_0x61b064}=_0x129302,_0x39ba3b=_0x587b8[_0x44a182(0x1b1)](),_0x390f25=_0x44a182(0x151),_0x2369fd=_0x44a182(0x174)+_0x2d098a,_0x368302={'name':_0x39183a,'paymentDescription':_0x225e47,'amount':_0x283f11,'currency':_0x39ba3b,'paymentId':_0x2d098a,'webhookUrl':_0x390f25,'returnUrl':_0x2369fd};_0x61b064&&(_0x368302[_0x44a182(0x18d)]=_0x61b064);const _0xd75da7=Date[_0x44a182(0x1b8)]();try{console[_0x44a182(0x199)](_0x44a182(0x162)),console[_0x44a182(0x199)](_0x44a182(0x179),this[_0x44a182(0x1a7)]),console[_0x44a182(0x199)](_0x44a182(0x1bf),JSON[_0x44a182(0x153)](_0x368302,null,0x2)),console[_0x44a182(0x199)](_0x44a182(0x18f),_0x2d098a,_0x44a182(0x18e)),console[_0x44a182(0x199)](_0x44a182(0x186),_0x2369fd),loggerService_1[_0x44a182(0x196)]['logWhiteDomainRequest'](_0x44a182(0x19b),_0x44a182(0x1c1),'POST',_0x368302);const _0x53fc01=await fetch(this[_0x44a182(0x1a7)],{'method':_0x44a182(0x19f),'headers':{'Content-Type':_0x44a182(0x188),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x44a182(0x153)](_0x368302)}),_0x467fa5=Date[_0x44a182(0x1b8)]()-_0xd75da7;console[_0x44a182(0x199)](_0x44a182(0x16c)),console['log'](_0x44a182(0x15a),_0x53fc01[_0x44a182(0x184)]),console[_0x44a182(0x199)](_0x44a182(0x1b5),_0x53fc01[_0x44a182(0x15e)]),console[_0x44a182(0x199)](_0x44a182(0x1ac),Object[_0x44a182(0x1b2)](_0x53fc01['headers'][_0x44a182(0x17a)]())),console[_0x44a182(0x199)](_0x44a182(0x1b4),_0x467fa5+'ms');const _0x4c1e10=await _0x53fc01[_0x44a182(0x190)]();console['log']('Raw\x20Response\x20Body:',_0x4c1e10);if(!_0x53fc01['ok']){console['error'](_0x44a182(0x158)),console[_0x44a182(0x1b7)]('HTTP\x20Status:',_0x53fc01[_0x44a182(0x184)]),console['error'](_0x44a182(0x155),_0x4c1e10),loggerService_1[_0x44a182(0x196)][_0x44a182(0x15f)](_0x44a182(0x19b),_0x44a182(0x1c1),_0x53fc01['status'],_0x4c1e10,_0x467fa5),loggerService_1[_0x44a182(0x196)][_0x44a182(0x192)](_0x44a182(0x19b),_0x44a182(0x1c1),_0x44a182(0x185)+_0x53fc01['status']+':\x20'+_0x4c1e10);if(_0x53fc01[_0x44a182(0x184)]===0x190)throw new Error(_0x44a182(0x1ab));else{if(_0x53fc01[_0x44a182(0x184)]===0x1f4)throw new Error(_0x44a182(0x189));}throw new Error(_0x44a182(0x187)+_0x53fc01[_0x44a182(0x184)]+_0x44a182(0x14d)+_0x4c1e10);}let _0x2857a7;try{_0x2857a7=JSON[_0x44a182(0x159)](_0x4c1e10);}catch(_0x3fba6d){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x3fba6d),loggerService_1[_0x44a182(0x196)][_0x44a182(0x192)](_0x44a182(0x19b),_0x44a182(0x1c1),_0x44a182(0x1c2)+_0x3fba6d);throw new Error(_0x44a182(0x157)+_0x4c1e10);}console[_0x44a182(0x199)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x44a182(0x199)](_0x44a182(0x15c),JSON[_0x44a182(0x153)](_0x2857a7,null,0x2)),loggerService_1[_0x44a182(0x196)][_0x44a182(0x15f)](_0x44a182(0x19b),_0x44a182(0x1c1),_0x53fc01[_0x44a182(0x184)],_0x2857a7,_0x467fa5);if(_0x2857a7[_0x44a182(0x1b7)]||_0x2857a7['statusCode']){const _0x56eb2e=_0x2857a7[_0x44a182(0x178)]||_0x2857a7[_0x44a182(0x1b7)]||_0x44a182(0x1c3);console[_0x44a182(0x1b7)](_0x44a182(0x16f)),console[_0x44a182(0x1b7)](_0x44a182(0x15d),_0x56eb2e),console[_0x44a182(0x1b7)](_0x44a182(0x14e),_0x2857a7[_0x44a182(0x1aa)]),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x44a182(0x1c1),'Business\x20Error:\x20'+_0x56eb2e);throw new Error('Noda\x20API\x20error:\x20'+_0x56eb2e);}if(!_0x2857a7['id']||!_0x2857a7[_0x44a182(0x16b)]?.[_0x44a182(0x1a9)]){console[_0x44a182(0x1b7)](_0x44a182(0x1b0)),console[_0x44a182(0x1b7)](_0x44a182(0x193)),console['error']('Response\x20data:',_0x2857a7),loggerService_1[_0x44a182(0x196)][_0x44a182(0x192)](_0x44a182(0x19b),_0x44a182(0x1c1),_0x44a182(0x1c0));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x44a182(0x199)](_0x44a182(0x194)),console['log'](_0x44a182(0x1b6),_0x2857a7['id']),console[_0x44a182(0x199)](_0x44a182(0x14f),_0x2857a7[_0x44a182(0x16b)][_0x44a182(0x1a9)]),console[_0x44a182(0x199)](_0x44a182(0x154),_0x2857a7[_0x44a182(0x16b)][_0x44a182(0x176)]||_0x44a182(0x1ae)),console[_0x44a182(0x199)](_0x44a182(0x18c),_0x2d098a,'(8digits-8digits\x20format)'),console[_0x44a182(0x199)](_0x44a182(0x19e),_0x2369fd),{'gateway_payment_id':_0x2857a7['id'],'payment_url':_0x2857a7[_0x44a182(0x16b)][_0x44a182(0x1a9)],'qr_code_url':_0x2857a7[_0x44a182(0x16b)][_0x44a182(0x176)],'expiry_date':_0x2857a7[_0x44a182(0x18d)]};}catch(_0x4e6a73){console[_0x44a182(0x1b7)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x44a182(0x1b7)](_0x44a182(0x16a),_0x4e6a73),loggerService_1[_0x44a182(0x196)][_0x44a182(0x192)]('noda','/payment-links',_0x4e6a73);if(_0x4e6a73 instanceof Error){console[_0x44a182(0x1b7)](_0x44a182(0x197),_0x4e6a73[_0x44a182(0x178)]),console[_0x44a182(0x1b7)]('Error\x20stack:',_0x4e6a73['stack']);throw new Error(_0x44a182(0x18a)+_0x4e6a73[_0x44a182(0x178)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x370121){const _0x20bb33=a44_0x427f01,_0x49e9fb=Date[_0x20bb33(0x1b8)]();try{loggerService_1[_0x20bb33(0x196)]['logWhiteDomainRequest'](_0x20bb33(0x19b),'/payment-links/'+_0x370121,_0x20bb33(0x15b),{});const _0x4b6271=await fetch(this[_0x20bb33(0x1a7)]+'/'+_0x370121,{'method':'GET','headers':{'Content-Type':_0x20bb33(0x188),'User-Agent':_0x20bb33(0x1b3)}}),_0xfa45fe=Date[_0x20bb33(0x1b8)]()-_0x49e9fb;if(!_0x4b6271['ok']){const _0x24bb43=await _0x4b6271[_0x20bb33(0x190)]();loggerService_1['loggerService'][_0x20bb33(0x15f)](_0x20bb33(0x19b),_0x20bb33(0x165)+_0x370121,_0x4b6271[_0x20bb33(0x184)],_0x24bb43,_0xfa45fe);throw new Error(_0x20bb33(0x187)+_0x4b6271[_0x20bb33(0x184)]);}const _0x5605cc=await _0x4b6271['json']();loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0x20bb33(0x165)+_0x370121,_0x4b6271[_0x20bb33(0x184)],_0x5605cc,_0xfa45fe);if(_0x5605cc[_0x20bb33(0x1b7)]||_0x5605cc[_0x20bb33(0x1aa)]){loggerService_1[_0x20bb33(0x196)][_0x20bb33(0x192)](_0x20bb33(0x19b),_0x20bb33(0x165)+_0x370121,_0x20bb33(0x1c6)+(_0x5605cc[_0x20bb33(0x178)]||_0x5605cc[_0x20bb33(0x1b7)]||_0x20bb33(0x164)));throw new Error(_0x20bb33(0x1c6)+(_0x5605cc[_0x20bb33(0x178)]||_0x5605cc[_0x20bb33(0x1b7)]||_0x20bb33(0x164)));}let _0x3b60ba=_0x20bb33(0x19d);if(_0x5605cc[_0x20bb33(0x1bc)]===![]){if(_0x5605cc[_0x20bb33(0x18d)]){const _0x120725=new Date(_0x5605cc[_0x20bb33(0x18d)]),_0x5ad34b=new Date();_0x120725<_0x5ad34b?_0x3b60ba=_0x20bb33(0x163):_0x3b60ba='FAILED';}else _0x3b60ba='FAILED';}else _0x3b60ba=_0x20bb33(0x19d);return{'status':_0x3b60ba,'amount':_0x5605cc['amount'],'currency':_0x5605cc[_0x20bb33(0x1be)],'isActive':_0x5605cc[_0x20bb33(0x1bc)]};}catch(_0x131056){console[_0x20bb33(0x1b7)](_0x20bb33(0x1bd),_0x131056),loggerService_1['loggerService'][_0x20bb33(0x192)](_0x20bb33(0x19b),_0x20bb33(0x165)+_0x370121,_0x131056);throw new Error(_0x20bb33(0x195)+(_0x131056 instanceof Error?_0x131056[_0x20bb33(0x178)]:_0x20bb33(0x164)));}}async[a44_0x427f01(0x183)](_0x1e9047){const _0x3d812c=a44_0x427f01;console['log'](_0x3d812c(0x17d),_0x1e9047);let _0x45caa2='PENDING';switch(_0x1e9047[_0x3d812c(0x14b)]?.['toLowerCase']()){case'done':case _0x3d812c(0x198):case _0x3d812c(0x19c):case'success':case'successful':_0x1e9047[_0x3d812c(0x16e)]===_0x3d812c(0x169)?_0x45caa2=_0x3d812c(0x1bb):_0x45caa2=_0x3d812c(0x19d);break;case _0x3d812c(0x175):case _0x3d812c(0x17c):case _0x3d812c(0x167):case _0x3d812c(0x1b7):case _0x3d812c(0x16d):_0x45caa2=_0x3d812c(0x1a5);break;case _0x3d812c(0x1c5):case _0x3d812c(0x171):_0x45caa2=_0x3d812c(0x163);break;case _0x3d812c(0x168):case _0x3d812c(0x1a3):case _0x3d812c(0x1af):case _0x3d812c(0x1ad):case _0x3d812c(0x182):default:_0x45caa2=_0x3d812c(0x19d);break;}return{'paymentId':_0x1e9047[_0x3d812c(0x1a0)]||_0x1e9047[_0x3d812c(0x14c)],'status':_0x45caa2,'amount':_0x1e9047[_0x3d812c(0x1a2)],'currency':_0x1e9047[_0x3d812c(0x177)],'additionalInfo':{'method':_0x1e9047[_0x3d812c(0x18b)],'bankId':_0x1e9047[_0x3d812c(0x161)],'settled':_0x1e9047[_0x3d812c(0x16e)],'settlementDate':_0x1e9047[_0x3d812c(0x152)],'remitterName':_0x1e9047[_0x3d812c(0x1c4)]?.['Name'],'remitterIban':_0x1e9047[_0x3d812c(0x1c4)]?.[_0x3d812c(0x191)],'bankTransactionId':_0x1e9047['BankTransactionId']}};}[a44_0x427f01(0x1a4)](_0x33dbf7,_0x1fbbe5){const _0x3b0a5b=a44_0x427f01;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x1fbbe5,'paymentId':_0x33dbf7['PaymentId'],'merchantPaymentId':_0x33dbf7[_0x3b0a5b(0x1a0)]}),!![];}}exports[a44_0x427f01(0x1a6)]=NodaService;