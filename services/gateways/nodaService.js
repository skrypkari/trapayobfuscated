'use strict';const a60_0x188e4a=a60_0x28f6;(function(_0x317580,_0xff71be){const _0x6e49bc=a60_0x28f6,_0x19a894=_0x317580();while(!![]){try{const _0x40d00f=parseInt(_0x6e49bc(0xdc))/0x1+-parseInt(_0x6e49bc(0xe1))/0x2+-parseInt(_0x6e49bc(0xf3))/0x3+parseInt(_0x6e49bc(0xb7))/0x4+-parseInt(_0x6e49bc(0x83))/0x5+-parseInt(_0x6e49bc(0x90))/0x6*(parseInt(_0x6e49bc(0x9e))/0x7)+-parseInt(_0x6e49bc(0xdd))/0x8*(-parseInt(_0x6e49bc(0xcd))/0x9);if(_0x40d00f===_0xff71be)break;else _0x19a894['push'](_0x19a894['shift']());}catch(_0x1f70ff){_0x19a894['push'](_0x19a894['shift']());}}}(a60_0x48d9,0xf070b));function a60_0x48d9(){const _0x184692=['===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20NODA\x20SERVICE\x20ERROR\x20===','shortLink','Payment\x20System/1.0','Status\x20Code:','defineProperty','JSON\x20Parse\x20Error:\x20','noda','HTTP\x20Status:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','580909WuSont','currency','entries','error','amount','toUpperCase','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Not\x20provided','stringify','failed','logWhiteDomainError','Raw\x20Response\x20Body:','HTTP\x20error!\x20status:\x20','URL:','pending','parse','statusText','qrCodeLink','Status\x20Text:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Processing\x20Noda\x20webhook:','HTTP\x20','POST','Noda\x20API\x20error:\x20','apiUrl','6212240nJovyR','Response\x20Body:','===\x20NODA\x20SUCCESS\x20===','/payment-links','Headers:','log','text','Noda\x20payment\x20verification\x20error:','EXPIRED','completed','https://tesoft.uk/gateway/noda/webhook/','__esModule','FAILED','logWhiteDomainResponse','PAID','Name','done','Error\x20Message:','created','BankTransactionId','QR\x20Code\x20Link:','Remitter','27vuPAXE','application/json','verifyWebhookSignature','createPaymentLink','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','/payment-links/','PaymentId','GET','statusCode','in_progress','Yes','Order\x20ID\x20Format:','PENDING','Failed\x20to\x20parse\x20JSON\x20response:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','1159053hpBUMZ','7955616pGxRef','../loggerService','processing','Missing\x20id\x20or\x20shortLink\x20in\x20response','354348NfQEHV','success','expired','json','Request\x20Body\x20(Direct\x20JSON):','Iban','Settled','now','Response\x20data:','Short\x20Link:','processWebhook','canceled','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Unknown\x20error\x20from\x20Noda\x20API','message','expiryDate','Error\x20message:','MerchantPaymentId','5759751hggQvx','(8digits-8digits\x20format)','Business\x20Error:\x20','shortLinkUrls','active','Order\x20ID\x20Used:','8088455qSNQvq','Error\x20details:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Unknown\x20error','status','isActive','logWhiteDomainRequest','Noda\x20webhook\x20signature\x20verification:','Method','toLowerCase','verifyPayment','loggerService','https://tesoft.uk/gateway/pending.php?id=','72cWzcrz','Response\x20Time:','BankId','Error\x20stack:'];a60_0x48d9=function(){return _0x184692;};return a60_0x48d9();}Object[a60_0x188e4a(0x99)](exports,a60_0x188e4a(0xc2),{'value':!![]}),exports['NodaService']=void 0x0;function a60_0x28f6(_0x4a8143,_0x4d48e0){_0x4a8143=_0x4a8143-0x83;const _0x48d930=a60_0x48d9();let _0x28f6c6=_0x48d930[_0x4a8143];return _0x28f6c6;}const loggerService_1=require(a60_0x188e4a(0xde));class NodaService{constructor(){const _0x23570f=a60_0x188e4a;this['apiUrl']='https://tesoft.uk/gateway/noda/',console[_0x23570f(0xbc)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a60_0x188e4a(0xd0)](_0x1131a5){const _0x23c7a4=a60_0x188e4a,{orderId:_0x38f948,name:_0x55a5f6,paymentDescription:_0x318f68,amount:_0x1c55c7,currency:_0x1ebfce,webhookUrl:_0x59b468,returnUrl:_0x1bc4e9,expiryDate:_0x295c3f}=_0x1131a5,_0x4cf4a7=_0x1ebfce[_0x23c7a4(0xa3)](),_0x7e76f8=_0x23c7a4(0xc1),_0xef6cd4=_0x23c7a4(0x8f)+_0x38f948,_0x2337a4={'name':_0x55a5f6,'paymentDescription':_0x318f68,'amount':_0x1c55c7,'currency':_0x4cf4a7,'paymentId':_0x38f948,'webhookUrl':_0x7e76f8,'returnUrl':_0xef6cd4};_0x295c3f&&(_0x2337a4[_0x23c7a4(0xf0)]=_0x295c3f);const _0x36b9cc=Date[_0x23c7a4(0xe8)]();try{console[_0x23c7a4(0xbc)](_0x23c7a4(0xa4)),console[_0x23c7a4(0xbc)](_0x23c7a4(0xab),this[_0x23c7a4(0xb6)]),console[_0x23c7a4(0xbc)](_0x23c7a4(0xe5),JSON[_0x23c7a4(0xa6)](_0x2337a4,null,0x2)),console['log'](_0x23c7a4(0xd8),_0x38f948,'(8digits-8digits\x20format\x20for\x20Noda)'),console['log'](_0x23c7a4(0xdb),_0xef6cd4),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x23c7a4(0x9b),_0x23c7a4(0xba),'POST',_0x2337a4);const _0xbf6d95=await fetch(this[_0x23c7a4(0xb6)],{'method':_0x23c7a4(0xb4),'headers':{'Content-Type':'application/json','Accept':_0x23c7a4(0xce),'User-Agent':_0x23c7a4(0x97)},'body':JSON[_0x23c7a4(0xa6)](_0x2337a4)}),_0x30eb6f=Date[_0x23c7a4(0xe8)]()-_0x36b9cc;console[_0x23c7a4(0xbc)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x23c7a4(0xbc)]('Status:',_0xbf6d95['status']),console[_0x23c7a4(0xbc)](_0x23c7a4(0xb0),_0xbf6d95[_0x23c7a4(0xae)]),console[_0x23c7a4(0xbc)](_0x23c7a4(0xbb),Object['fromEntries'](_0xbf6d95['headers'][_0x23c7a4(0xa0)]())),console[_0x23c7a4(0xbc)](_0x23c7a4(0x91),_0x30eb6f+'ms');const _0x34beea=await _0xbf6d95[_0x23c7a4(0xbd)]();console[_0x23c7a4(0xbc)](_0x23c7a4(0xa9),_0x34beea);if(!_0xbf6d95['ok']){console[_0x23c7a4(0xa1)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x23c7a4(0xa1)](_0x23c7a4(0x9c),_0xbf6d95[_0x23c7a4(0x87)]),console[_0x23c7a4(0xa1)](_0x23c7a4(0xb8),_0x34beea),loggerService_1[_0x23c7a4(0x8e)][_0x23c7a4(0xc4)]('noda','/payment-links',_0xbf6d95['status'],_0x34beea,_0x30eb6f),loggerService_1['loggerService'][_0x23c7a4(0xa8)](_0x23c7a4(0x9b),_0x23c7a4(0xba),_0x23c7a4(0xb3)+_0xbf6d95[_0x23c7a4(0x87)]+':\x20'+_0x34beea);if(_0xbf6d95[_0x23c7a4(0x87)]===0x190)throw new Error(_0x23c7a4(0xed));else{if(_0xbf6d95[_0x23c7a4(0x87)]===0x1f4)throw new Error(_0x23c7a4(0xb1));}throw new Error(_0x23c7a4(0xaa)+_0xbf6d95['status']+',\x20body:\x20'+_0x34beea);}let _0x31f7ae;try{_0x31f7ae=JSON[_0x23c7a4(0xad)](_0x34beea);}catch(_0x2420bd){console[_0x23c7a4(0xa1)](_0x23c7a4(0xda),_0x2420bd),loggerService_1['loggerService'][_0x23c7a4(0xa8)](_0x23c7a4(0x9b),_0x23c7a4(0xba),_0x23c7a4(0x9a)+_0x2420bd);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x34beea);}console['log'](_0x23c7a4(0x9d)),console[_0x23c7a4(0xbc)]('Parsed\x20Result:',JSON[_0x23c7a4(0xa6)](_0x31f7ae,null,0x2)),loggerService_1[_0x23c7a4(0x8e)]['logWhiteDomainResponse'](_0x23c7a4(0x9b),'/payment-links',_0xbf6d95['status'],_0x31f7ae,_0x30eb6f);if(_0x31f7ae[_0x23c7a4(0xa1)]||_0x31f7ae[_0x23c7a4(0xd5)]){const _0x1e3eb7=_0x31f7ae['message']||_0x31f7ae[_0x23c7a4(0xa1)]||_0x23c7a4(0xee);console[_0x23c7a4(0xa1)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x23c7a4(0xc8),_0x1e3eb7),console['error'](_0x23c7a4(0x98),_0x31f7ae[_0x23c7a4(0xd5)]),loggerService_1[_0x23c7a4(0x8e)][_0x23c7a4(0xa8)](_0x23c7a4(0x9b),_0x23c7a4(0xba),_0x23c7a4(0xf5)+_0x1e3eb7);throw new Error(_0x23c7a4(0xb5)+_0x1e3eb7);}if(!_0x31f7ae['id']||!_0x31f7ae[_0x23c7a4(0xf6)]?.[_0x23c7a4(0x96)]){console[_0x23c7a4(0xa1)](_0x23c7a4(0x94)),console['error'](_0x23c7a4(0xe0)),console['error'](_0x23c7a4(0xe9),_0x31f7ae),loggerService_1[_0x23c7a4(0x8e)]['logWhiteDomainError'](_0x23c7a4(0x9b),_0x23c7a4(0xba),_0x23c7a4(0xd1));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x23c7a4(0xbc)](_0x23c7a4(0xb9)),console[_0x23c7a4(0xbc)]('Payment\x20Link\x20ID:',_0x31f7ae['id']),console[_0x23c7a4(0xbc)](_0x23c7a4(0xea),_0x31f7ae[_0x23c7a4(0xf6)][_0x23c7a4(0x96)]),console[_0x23c7a4(0xbc)](_0x23c7a4(0xcb),_0x31f7ae[_0x23c7a4(0xf6)][_0x23c7a4(0xaf)]||_0x23c7a4(0xa5)),console[_0x23c7a4(0xbc)](_0x23c7a4(0xf8),_0x38f948,_0x23c7a4(0xf4)),console['log']('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0xef6cd4),{'gateway_payment_id':_0x31f7ae['id'],'payment_url':_0x31f7ae[_0x23c7a4(0xf6)][_0x23c7a4(0x96)],'qr_code_url':_0x31f7ae[_0x23c7a4(0xf6)]['qrCodeLink'],'expiry_date':_0x31f7ae[_0x23c7a4(0xf0)]};}catch(_0x1bf4b1){console[_0x23c7a4(0xa1)](_0x23c7a4(0x95)),console['error'](_0x23c7a4(0x84),_0x1bf4b1),loggerService_1[_0x23c7a4(0x8e)][_0x23c7a4(0xa8)](_0x23c7a4(0x9b),_0x23c7a4(0xba),_0x1bf4b1);if(_0x1bf4b1 instanceof Error){console[_0x23c7a4(0xa1)](_0x23c7a4(0xf1),_0x1bf4b1[_0x23c7a4(0xef)]),console[_0x23c7a4(0xa1)](_0x23c7a4(0x93),_0x1bf4b1['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x1bf4b1['message']);}throw new Error(_0x23c7a4(0x85));}}async[a60_0x188e4a(0x8d)](_0x27c422){const _0x4987e5=a60_0x188e4a,_0x4a1501=Date['now']();try{loggerService_1[_0x4987e5(0x8e)][_0x4987e5(0x89)](_0x4987e5(0x9b),_0x4987e5(0xd2)+_0x27c422,'GET',{});const _0x2f6959=await fetch(this[_0x4987e5(0xb6)]+'/'+_0x27c422,{'method':_0x4987e5(0xd4),'headers':{'Content-Type':_0x4987e5(0xce),'User-Agent':_0x4987e5(0x97)}}),_0x1083fe=Date[_0x4987e5(0xe8)]()-_0x4a1501;if(!_0x2f6959['ok']){const _0x585f98=await _0x2f6959[_0x4987e5(0xbd)]();loggerService_1[_0x4987e5(0x8e)][_0x4987e5(0xc4)](_0x4987e5(0x9b),_0x4987e5(0xd2)+_0x27c422,_0x2f6959[_0x4987e5(0x87)],_0x585f98,_0x1083fe);throw new Error(_0x4987e5(0xaa)+_0x2f6959['status']);}const _0x39fc2f=await _0x2f6959[_0x4987e5(0xe4)]();loggerService_1[_0x4987e5(0x8e)][_0x4987e5(0xc4)]('noda','/payment-links/'+_0x27c422,_0x2f6959[_0x4987e5(0x87)],_0x39fc2f,_0x1083fe);if(_0x39fc2f['error']||_0x39fc2f[_0x4987e5(0xd5)]){loggerService_1[_0x4987e5(0x8e)][_0x4987e5(0xa8)]('noda',_0x4987e5(0xd2)+_0x27c422,_0x4987e5(0xb5)+(_0x39fc2f[_0x4987e5(0xef)]||_0x39fc2f['error']||_0x4987e5(0x86)));throw new Error(_0x4987e5(0xb5)+(_0x39fc2f[_0x4987e5(0xef)]||_0x39fc2f[_0x4987e5(0xa1)]||_0x4987e5(0x86)));}let _0x18b1f3=_0x4987e5(0xd9);if(_0x39fc2f[_0x4987e5(0x88)]===![]){if(_0x39fc2f['expiryDate']){const _0x2b2e30=new Date(_0x39fc2f[_0x4987e5(0xf0)]),_0x3a8da9=new Date();_0x2b2e30<_0x3a8da9?_0x18b1f3=_0x4987e5(0xbf):_0x18b1f3='FAILED';}else _0x18b1f3='FAILED';}else _0x18b1f3='PENDING';return{'status':_0x18b1f3,'amount':_0x39fc2f[_0x4987e5(0xa2)],'currency':_0x39fc2f[_0x4987e5(0x9f)],'isActive':_0x39fc2f['isActive']};}catch(_0x38d42f){console[_0x4987e5(0xa1)](_0x4987e5(0xbe),_0x38d42f),loggerService_1[_0x4987e5(0x8e)][_0x4987e5(0xa8)](_0x4987e5(0x9b),_0x4987e5(0xd2)+_0x27c422,_0x38d42f);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x38d42f instanceof Error?_0x38d42f['message']:_0x4987e5(0x86)));}}async[a60_0x188e4a(0xeb)](_0x552547){const _0x326372=a60_0x188e4a;console['log'](_0x326372(0xb2),_0x552547);let _0x12ef93='PENDING';switch(_0x552547['Status']?.[_0x326372(0x8c)]()){case _0x326372(0xc7):case _0x326372(0xc0):case'paid':case _0x326372(0xe2):case'successful':_0x552547['Settled']===_0x326372(0xd7)?_0x12ef93=_0x326372(0xc5):_0x12ef93=_0x326372(0xd9);break;case'cancelled':case _0x326372(0xec):case _0x326372(0xa7):case _0x326372(0xa1):case'rejected':_0x12ef93=_0x326372(0xc3);break;case _0x326372(0xe3):case'timeout':_0x12ef93=_0x326372(0xbf);break;case _0x326372(0xac):case _0x326372(0xc9):case _0x326372(0xf7):case _0x326372(0xdf):case _0x326372(0xd6):default:_0x12ef93=_0x326372(0xd9);break;}return{'paymentId':_0x552547[_0x326372(0xf2)]||_0x552547[_0x326372(0xd3)],'status':_0x12ef93,'amount':_0x552547['Amount'],'currency':_0x552547['Currency'],'additionalInfo':{'method':_0x552547[_0x326372(0x8b)],'bankId':_0x552547[_0x326372(0x92)],'settled':_0x552547[_0x326372(0xe7)],'settlementDate':_0x552547['SettlementDate'],'remitterName':_0x552547['Remitter']?.[_0x326372(0xc6)],'remitterIban':_0x552547[_0x326372(0xcc)]?.[_0x326372(0xe6)],'bankTransactionId':_0x552547[_0x326372(0xca)]}};}[a60_0x188e4a(0xcf)](_0x57ae48,_0x243cb4){const _0x42faa6=a60_0x188e4a;return console['log'](_0x42faa6(0x8a),{'receivedSignature':_0x243cb4,'paymentId':_0x57ae48[_0x42faa6(0xd3)],'merchantPaymentId':_0x57ae48['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;