'use strict';const a40_0x589133=a40_0xf588;(function(_0x1732ac,_0x196f4b){const _0x75d31a=a40_0xf588,_0x1c975f=_0x1732ac();while(!![]){try{const _0x545c91=parseInt(_0x75d31a(0x13e))/0x1*(-parseInt(_0x75d31a(0x155))/0x2)+parseInt(_0x75d31a(0x147))/0x3+-parseInt(_0x75d31a(0x13d))/0x4+-parseInt(_0x75d31a(0x13c))/0x5+parseInt(_0x75d31a(0x148))/0x6*(-parseInt(_0x75d31a(0x16d))/0x7)+-parseInt(_0x75d31a(0x128))/0x8*(parseInt(_0x75d31a(0x135))/0x9)+parseInt(_0x75d31a(0x177))/0xa;if(_0x545c91===_0x196f4b)break;else _0x1c975f['push'](_0x1c975f['shift']());}catch(_0x552d29){_0x1c975f['push'](_0x1c975f['shift']());}}}(a40_0x50dc,0xbab41));function a40_0xf588(_0x446f2c,_0x50f75a){const _0x50dc23=a40_0x50dc();return a40_0xf588=function(_0xf588f3,_0x2b5d8c){_0xf588f3=_0xf588f3-0x100;let _0xb59c1c=_0x50dc23[_0xf588f3];return _0xb59c1c;},a40_0xf588(_0x446f2c,_0x50f75a);}Object[a40_0x589133(0x179)](exports,a40_0x589133(0x137),{'value':!![]}),exports[a40_0x589133(0x13f)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x258c6e=a40_0x589133;this['apiUrl']=_0x258c6e(0x131),console['log'](_0x258c6e(0x16b));}async[a40_0x589133(0x14c)](_0x23817c){const _0x365ad6=a40_0x589133,{orderId:_0xfec6e6,name:_0x1cd452,paymentDescription:_0x5cc24f,amount:_0x317905,currency:_0xed228c,webhookUrl:_0x7f0190,returnUrl:_0x1da467,expiryDate:_0x4d41e7}=_0x23817c,_0x38e45b=_0xed228c[_0x365ad6(0x110)](),_0x4a29b1=_0x365ad6(0x156),_0x17b593=_0x365ad6(0x111)+_0xfec6e6,_0x48f7e1={'name':_0x1cd452,'paymentDescription':_0x5cc24f,'amount':_0x317905,'currency':_0x38e45b,'paymentId':_0xfec6e6,'webhookUrl':_0x4a29b1,'returnUrl':_0x17b593};_0x4d41e7&&(_0x48f7e1[_0x365ad6(0x15b)]=_0x4d41e7);const _0x54f6a5=Date['now']();try{console[_0x365ad6(0x167)](_0x365ad6(0x119)),console[_0x365ad6(0x167)]('URL:',this[_0x365ad6(0x16a)]),console[_0x365ad6(0x167)](_0x365ad6(0x151),JSON[_0x365ad6(0x161)](_0x48f7e1,null,0x2)),console[_0x365ad6(0x167)](_0x365ad6(0x123),_0xfec6e6,_0x365ad6(0x142)),loggerService_1['loggerService'][_0x365ad6(0x14b)](_0x365ad6(0x130),_0x365ad6(0x120),_0x365ad6(0x178),_0x48f7e1);const _0x730607=await fetch(this['apiUrl'],{'method':_0x365ad6(0x178),'headers':{'Content-Type':_0x365ad6(0x10a),'Accept':_0x365ad6(0x10a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x365ad6(0x161)](_0x48f7e1)}),_0x44f1f0=Date[_0x365ad6(0x168)]()-_0x54f6a5;console[_0x365ad6(0x167)](_0x365ad6(0x158)),console[_0x365ad6(0x167)](_0x365ad6(0x11f),_0x730607[_0x365ad6(0x172)]),console[_0x365ad6(0x167)](_0x365ad6(0x140),_0x730607['statusText']),console['log'](_0x365ad6(0x100),Object[_0x365ad6(0x138)](_0x730607[_0x365ad6(0x106)]['entries']())),console[_0x365ad6(0x167)](_0x365ad6(0x11d),_0x44f1f0+'ms');const _0x55dd61=await _0x730607[_0x365ad6(0x16c)]();console[_0x365ad6(0x167)](_0x365ad6(0x160),_0x55dd61);if(!_0x730607['ok']){console[_0x365ad6(0x125)]('===\x20NODA\x20API\x20ERROR\x20==='),console['error'](_0x365ad6(0x13a),_0x730607[_0x365ad6(0x172)]),console[_0x365ad6(0x125)](_0x365ad6(0x11e),_0x55dd61),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x365ad6(0x130),'/payment-links',_0x730607[_0x365ad6(0x172)],_0x55dd61,_0x44f1f0),loggerService_1['loggerService']['logWhiteDomainError'](_0x365ad6(0x130),'/payment-links','HTTP\x20'+_0x730607[_0x365ad6(0x172)]+':\x20'+_0x55dd61);if(_0x730607[_0x365ad6(0x172)]===0x190)throw new Error(_0x365ad6(0x152));else{if(_0x730607[_0x365ad6(0x172)]===0x1f4)throw new Error(_0x365ad6(0x10e));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x730607['status']+_0x365ad6(0x12a)+_0x55dd61);}let _0x2d46f0;try{_0x2d46f0=JSON[_0x365ad6(0x154)](_0x55dd61);}catch(_0x301cf7){console[_0x365ad6(0x125)](_0x365ad6(0x163),_0x301cf7),loggerService_1[_0x365ad6(0x118)][_0x365ad6(0x12e)](_0x365ad6(0x130),_0x365ad6(0x120),'JSON\x20Parse\x20Error:\x20'+_0x301cf7);throw new Error(_0x365ad6(0x12f)+_0x55dd61);}console[_0x365ad6(0x167)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x365ad6(0x167)](_0x365ad6(0x124),JSON[_0x365ad6(0x161)](_0x2d46f0,null,0x2)),loggerService_1[_0x365ad6(0x118)]['logWhiteDomainResponse']('noda',_0x365ad6(0x120),_0x730607['status'],_0x2d46f0,_0x44f1f0);if(_0x2d46f0[_0x365ad6(0x125)]||_0x2d46f0[_0x365ad6(0x136)]){const _0x4c270b=_0x2d46f0['message']||_0x2d46f0[_0x365ad6(0x125)]||_0x365ad6(0x15a);console[_0x365ad6(0x125)](_0x365ad6(0x165)),console[_0x365ad6(0x125)](_0x365ad6(0x103),_0x4c270b),console['error'](_0x365ad6(0x145),_0x2d46f0[_0x365ad6(0x136)]),loggerService_1[_0x365ad6(0x118)]['logWhiteDomainError'](_0x365ad6(0x130),_0x365ad6(0x120),'Business\x20Error:\x20'+_0x4c270b);throw new Error(_0x365ad6(0x115)+_0x4c270b);}if(!_0x2d46f0['id']||!_0x2d46f0[_0x365ad6(0x170)]?.['shortLink']){console[_0x365ad6(0x125)](_0x365ad6(0x10f)),console[_0x365ad6(0x125)](_0x365ad6(0x169)),console[_0x365ad6(0x125)](_0x365ad6(0x107),_0x2d46f0),loggerService_1[_0x365ad6(0x118)][_0x365ad6(0x12e)](_0x365ad6(0x130),'/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x365ad6(0x139));}return console['log'](_0x365ad6(0x108)),console['log'](_0x365ad6(0x11b),_0x2d46f0['id']),console[_0x365ad6(0x167)]('Short\x20Link:',_0x2d46f0[_0x365ad6(0x170)][_0x365ad6(0x10d)]),console['log'](_0x365ad6(0x13b),_0x2d46f0[_0x365ad6(0x170)][_0x365ad6(0x10b)]||_0x365ad6(0x144)),console[_0x365ad6(0x167)](_0x365ad6(0x174),_0xfec6e6,_0x365ad6(0x104)),{'gateway_payment_id':_0x2d46f0['id'],'payment_url':_0x2d46f0[_0x365ad6(0x170)][_0x365ad6(0x10d)],'qr_code_url':_0x2d46f0[_0x365ad6(0x170)][_0x365ad6(0x10b)],'expiry_date':_0x2d46f0[_0x365ad6(0x15b)]};}catch(_0x5eb5ca){console[_0x365ad6(0x125)](_0x365ad6(0x143)),console['error'](_0x365ad6(0x112),_0x5eb5ca),loggerService_1[_0x365ad6(0x118)][_0x365ad6(0x12e)](_0x365ad6(0x130),_0x365ad6(0x120),_0x5eb5ca);if(_0x5eb5ca instanceof Error){console[_0x365ad6(0x125)]('Error\x20message:',_0x5eb5ca[_0x365ad6(0x134)]),console['error'](_0x365ad6(0x126),_0x5eb5ca[_0x365ad6(0x157)]);throw new Error(_0x365ad6(0x141)+_0x5eb5ca[_0x365ad6(0x134)]);}throw new Error(_0x365ad6(0x166));}}async[a40_0x589133(0x105)](_0x39844c){const _0x4f039a=a40_0x589133,_0x1fd559=Date[_0x4f039a(0x168)]();try{loggerService_1[_0x4f039a(0x118)][_0x4f039a(0x14b)]('noda',_0x4f039a(0x11a)+_0x39844c,_0x4f039a(0x117),{});const _0x456a76=await fetch(this['apiUrl']+'/'+_0x39844c,{'method':'GET','headers':{'Content-Type':_0x4f039a(0x10a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x43c52a=Date[_0x4f039a(0x168)]()-_0x1fd559;if(!_0x456a76['ok']){const _0x39acd0=await _0x456a76[_0x4f039a(0x16c)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4f039a(0x130),_0x4f039a(0x11a)+_0x39844c,_0x456a76['status'],_0x39acd0,_0x43c52a);throw new Error('HTTP\x20error!\x20status:\x20'+_0x456a76[_0x4f039a(0x172)]);}const _0x3fa3d1=await _0x456a76[_0x4f039a(0x14d)]();loggerService_1[_0x4f039a(0x118)][_0x4f039a(0x114)](_0x4f039a(0x130),'/payment-links/'+_0x39844c,_0x456a76['status'],_0x3fa3d1,_0x43c52a);if(_0x3fa3d1[_0x4f039a(0x125)]||_0x3fa3d1[_0x4f039a(0x136)]){loggerService_1[_0x4f039a(0x118)]['logWhiteDomainError']('noda','/payment-links/'+_0x39844c,_0x4f039a(0x115)+(_0x3fa3d1[_0x4f039a(0x134)]||_0x3fa3d1['error']||_0x4f039a(0x171)));throw new Error(_0x4f039a(0x115)+(_0x3fa3d1[_0x4f039a(0x134)]||_0x3fa3d1[_0x4f039a(0x125)]||_0x4f039a(0x171)));}let _0x7ead3c=_0x4f039a(0x15c);if(_0x3fa3d1['isActive']===![]){if(_0x3fa3d1[_0x4f039a(0x15b)]){const _0x39bef2=new Date(_0x3fa3d1[_0x4f039a(0x15b)]),_0xc3d37d=new Date();_0x39bef2<_0xc3d37d?_0x7ead3c=_0x4f039a(0x149):_0x7ead3c='FAILED';}else _0x7ead3c='FAILED';}else _0x7ead3c=_0x4f039a(0x15c);return{'status':_0x7ead3c,'amount':_0x3fa3d1[_0x4f039a(0x146)],'currency':_0x3fa3d1[_0x4f039a(0x153)],'isActive':_0x3fa3d1[_0x4f039a(0x127)]};}catch(_0x4472fc){console[_0x4f039a(0x125)](_0x4f039a(0x150),_0x4472fc),loggerService_1[_0x4f039a(0x118)][_0x4f039a(0x12e)]('noda',_0x4f039a(0x11a)+_0x39844c,_0x4472fc);throw new Error(_0x4f039a(0x15f)+(_0x4472fc instanceof Error?_0x4472fc[_0x4f039a(0x134)]:_0x4f039a(0x171)));}}async[a40_0x589133(0x159)](_0x36d5af){const _0x56e02e=a40_0x589133;console['log'](_0x56e02e(0x16f),_0x36d5af);let _0x9b61cc=_0x56e02e(0x15c);switch(_0x36d5af[_0x56e02e(0x101)]?.[_0x56e02e(0x102)]()){case _0x56e02e(0x122):case _0x56e02e(0x116):case'paid':case _0x56e02e(0x109):case _0x56e02e(0x113):_0x36d5af['Settled']===_0x56e02e(0x12d)?_0x9b61cc=_0x56e02e(0x15e):_0x9b61cc=_0x56e02e(0x15c);break;case _0x56e02e(0x129):case _0x56e02e(0x16e):case'failed':case _0x56e02e(0x125):case _0x56e02e(0x164):_0x9b61cc=_0x56e02e(0x14f);break;case _0x56e02e(0x175):case _0x56e02e(0x11c):_0x9b61cc=_0x56e02e(0x149);break;case'pending':case _0x56e02e(0x133):case _0x56e02e(0x173):case'processing':case'in_progress':default:_0x9b61cc='PENDING';break;}return{'paymentId':_0x36d5af[_0x56e02e(0x132)]||_0x36d5af[_0x56e02e(0x176)],'status':_0x9b61cc,'amount':_0x36d5af['Amount'],'currency':_0x36d5af[_0x56e02e(0x15d)],'additionalInfo':{'method':_0x36d5af[_0x56e02e(0x12c)],'bankId':_0x36d5af[_0x56e02e(0x14e)],'settled':_0x36d5af['Settled'],'settlementDate':_0x36d5af[_0x56e02e(0x12b)],'remitterName':_0x36d5af['Remitter']?.[_0x56e02e(0x10c)],'remitterIban':_0x36d5af[_0x56e02e(0x121)]?.[_0x56e02e(0x14a)],'bankTransactionId':_0x36d5af[_0x56e02e(0x162)]}};}['verifyWebhookSignature'](_0x5478fb,_0x5143b2){return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x5143b2,'paymentId':_0x5478fb['PaymentId'],'merchantPaymentId':_0x5478fb['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;function a40_0x50dc(){const _0x4fba66=['fromEntries','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','HTTP\x20Status:','QR\x20Code\x20Link:','4715775orNtqC','196436KpWjLs','174653vqQFaD','NodaService','Status\x20Text:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','(8digits-8digits\x20format\x20for\x20Noda)','===\x20NODA\x20SERVICE\x20ERROR\x20===','Not\x20provided','Status\x20Code:','amount','1664799TTNhoH','322398ayRCDN','EXPIRED','Iban','logWhiteDomainRequest','createPaymentLink','json','BankId','FAILED','Noda\x20payment\x20verification\x20error:','Request\x20Body\x20(Direct\x20JSON):','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','currency','parse','6xKXDmt','https://tesoft.uk/gateway/noda/webhook/','stack','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','processWebhook','Unknown\x20error\x20from\x20Noda\x20API','expiryDate','PENDING','Currency','PAID','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Raw\x20Response\x20Body:','stringify','BankTransactionId','Failed\x20to\x20parse\x20JSON\x20response:','rejected','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','log','now','Missing\x20id\x20or\x20shortLink\x20in\x20response','apiUrl','ðŸŒ\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','text','119AEyRkJ','canceled','Processing\x20Noda\x20webhook:','shortLinkUrls','Unknown\x20error','status','active','Order\x20ID\x20Used:','expired','PaymentId','27944800hzFHWl','POST','defineProperty','Headers:','Status','toLowerCase','Error\x20Message:','(8digits-8digits\x20format)','verifyPayment','headers','Response\x20data:','===\x20NODA\x20SUCCESS\x20===','success','application/json','qrCodeLink','Name','shortLink','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','toUpperCase','https://tesoft.uk/gateway/success.php?id=','Error\x20details:','successful','logWhiteDomainResponse','Noda\x20API\x20error:\x20','completed','GET','loggerService','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','/payment-links/','Payment\x20Link\x20ID:','timeout','Response\x20Time:','Response\x20Body:','Status:','/payment-links','Remitter','done','Order\x20ID\x20Format:','Parsed\x20Result:','error','Error\x20stack:','isActive','64vmWYFd','cancelled',',\x20body:\x20','SettlementDate','Method','Yes','logWhiteDomainError','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','noda','https://tesoft.uk/gateway/noda/','MerchantPaymentId','created','message','174366MBTill','statusCode','__esModule'];a40_0x50dc=function(){return _0x4fba66;};return a40_0x50dc();}