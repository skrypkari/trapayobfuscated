'use strict';function a43_0x35e2(_0x392541,_0x5171c0){const _0x13d162=a43_0x13d1();return a43_0x35e2=function(_0x35e226,_0x25f96b){_0x35e226=_0x35e226-0x10a;let _0x5d8fc6=_0x13d162[_0x35e226];return _0x5d8fc6;},a43_0x35e2(_0x392541,_0x5171c0);}const a43_0x312a44=a43_0x35e2;(function(_0x3f0cfd,_0x109763){const _0x31072d=a43_0x35e2,_0x4ecc3b=_0x3f0cfd();while(!![]){try{const _0x61c814=-parseInt(_0x31072d(0x140))/0x1+parseInt(_0x31072d(0x171))/0x2+parseInt(_0x31072d(0x123))/0x3+-parseInt(_0x31072d(0x177))/0x4*(parseInt(_0x31072d(0x155))/0x5)+-parseInt(_0x31072d(0x16b))/0x6+-parseInt(_0x31072d(0x11a))/0x7*(parseInt(_0x31072d(0x17b))/0x8)+parseInt(_0x31072d(0x10e))/0x9*(parseInt(_0x31072d(0x124))/0xa);if(_0x61c814===_0x109763)break;else _0x4ecc3b['push'](_0x4ecc3b['shift']());}catch(_0x3dd430){_0x4ecc3b['push'](_0x4ecc3b['shift']());}}}(a43_0x13d1,0x5d861));Object[a43_0x312a44(0x13c)](exports,a43_0x312a44(0x112),{'value':!![]}),exports['NodaService']=void 0x0;function a43_0x13d1(){const _0x252b9e=['parse','message','EXPIRED','PENDING','timeout','Noda\x20webhook\x20signature\x20verification:','done','45OaSEEM','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Missing\x20id\x20or\x20shortLink\x20in\x20response','Iban','__esModule','PaymentId','error','Settled','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Failed\x20to\x20verify\x20Noda\x20payment:\x20','active','status','7qxouKA','Name','BankId','Status:','pending','===\x20NODA\x20API\x20ERROR\x20===','Parsed\x20Result:','amount','stringify','994248JhdBRv','3113320mCRRRp','isActive','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','../loggerService','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','failed','Remitter','logWhiteDomainResponse','application/json','Error\x20stack:','logWhiteDomainRequest','successful','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','QR\x20Code\x20Link:','verifyWebhookSignature','===\x20PARSED\x20NODA\x20RESPONSE\x20===','HTTP\x20error!\x20status:\x20','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','log','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','apiUrl','https://tesoft.uk/gateway/noda/','logWhiteDomainError','defineProperty','Method','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','SettlementDate','518240yAoEFZ','Error\x20Message:','shortLinkUrls','shortLink','===\x20NODA\x20SUCCESS\x20===','FAILED','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Short\x20Link:','Payment\x20Link\x20ID:','Response\x20data:','currency','Yes','Request\x20Body\x20(Direct\x20JSON):','(8digits-8digits\x20format)','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','headers','Status\x20Text:','/payment-links','Processing\x20Noda\x20webhook:','statusCode','NodaService','565565muKeGY','rejected','in_progress','qrCodeLink','now','Order\x20ID\x20Used:','Response\x20Time:','BankTransactionId','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Business\x20Error:\x20','(8digits-8digits\x20format\x20for\x20Noda)','https://tesoft.uk/gateway/noda/webhook/','===\x20NODA\x20SERVICE\x20ERROR\x20===','Noda\x20API\x20error:\x20','MerchantPaymentId','TesSoft\x20Payment\x20System/1.0','POST','/payment-links/','Unknown\x20error\x20from\x20Noda\x20API','PAID',',\x20body:\x20','created','3066552OhxtTq','Status\x20Code:','canceled','Response\x20Body:','text','statusText','634866JKYBbG','completed','loggerService','expiryDate','Raw\x20Response\x20Body:','Unknown\x20error','20LDUewo','Headers:','expired','toLowerCase','1820312gdYBRT','URL:','processWebhook','noda'];a43_0x13d1=function(){return _0x252b9e;};return a43_0x13d1();}const loggerService_1=require(a43_0x312a44(0x127));class NodaService{constructor(){const _0x393011=a43_0x312a44;this[_0x393011(0x139)]=_0x393011(0x13a),console[_0x393011(0x137)](_0x393011(0x10f));}async['createPaymentLink'](_0x535a6b){const _0x213f0b=a43_0x312a44,{orderId:_0x2078c0,name:_0xb98b9d,paymentDescription:_0x4c92d3,amount:_0x15266a,currency:_0x27b67c,webhookUrl:_0x1cb734,returnUrl:_0x267118,expiryDate:_0x5c3291}=_0x535a6b,_0x37d743=_0x27b67c['toUpperCase'](),_0x17a0cd=_0x213f0b(0x160),_0x4ea590='https://tesoft.uk/gateway/pending.php?id='+_0x2078c0,_0xc278b0={'name':_0xb98b9d,'paymentDescription':_0x4c92d3,'amount':_0x15266a,'currency':_0x37d743,'paymentId':_0x2078c0,'webhookUrl':_0x17a0cd,'returnUrl':_0x4ea590};_0x5c3291&&(_0xc278b0[_0x213f0b(0x174)]=_0x5c3291);const _0x25f089=Date[_0x213f0b(0x159)]();try{console[_0x213f0b(0x137)](_0x213f0b(0x138)),console[_0x213f0b(0x137)](_0x213f0b(0x17c),this['apiUrl']),console[_0x213f0b(0x137)](_0x213f0b(0x14c),JSON[_0x213f0b(0x122)](_0xc278b0,null,0x2)),console[_0x213f0b(0x137)]('Order\x20ID\x20Format:',_0x2078c0,_0x213f0b(0x15f)),console['log'](_0x213f0b(0x135),_0x4ea590),loggerService_1['loggerService'][_0x213f0b(0x12e)](_0x213f0b(0x17e),'/payment-links',_0x213f0b(0x165),_0xc278b0);const _0x19f135=await fetch(this[_0x213f0b(0x139)],{'method':_0x213f0b(0x165),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x213f0b(0x164)},'body':JSON[_0x213f0b(0x122)](_0xc278b0)}),_0x91d84=Date['now']()-_0x25f089;console[_0x213f0b(0x137)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x213f0b(0x137)](_0x213f0b(0x11d),_0x19f135[_0x213f0b(0x119)]),console[_0x213f0b(0x137)](_0x213f0b(0x150),_0x19f135[_0x213f0b(0x170)]),console[_0x213f0b(0x137)](_0x213f0b(0x178),Object['fromEntries'](_0x19f135[_0x213f0b(0x14f)]['entries']())),console[_0x213f0b(0x137)](_0x213f0b(0x15b),_0x91d84+'ms');const _0x3ae38b=await _0x19f135[_0x213f0b(0x16f)]();console[_0x213f0b(0x137)](_0x213f0b(0x175),_0x3ae38b);if(!_0x19f135['ok']){console['error'](_0x213f0b(0x11f)),console[_0x213f0b(0x114)]('HTTP\x20Status:',_0x19f135[_0x213f0b(0x119)]),console[_0x213f0b(0x114)](_0x213f0b(0x16e),_0x3ae38b),loggerService_1[_0x213f0b(0x173)][_0x213f0b(0x12b)](_0x213f0b(0x17e),_0x213f0b(0x151),_0x19f135[_0x213f0b(0x119)],_0x3ae38b,_0x91d84),loggerService_1[_0x213f0b(0x173)][_0x213f0b(0x13b)]('noda',_0x213f0b(0x151),'HTTP\x20'+_0x19f135[_0x213f0b(0x119)]+':\x20'+_0x3ae38b);if(_0x19f135['status']===0x190)throw new Error(_0x213f0b(0x116));else{if(_0x19f135[_0x213f0b(0x119)]===0x1f4)throw new Error(_0x213f0b(0x14e));}throw new Error(_0x213f0b(0x134)+_0x19f135[_0x213f0b(0x119)]+_0x213f0b(0x169)+_0x3ae38b);}let _0x264ae1;try{_0x264ae1=JSON[_0x213f0b(0x17f)](_0x3ae38b);}catch(_0x404825){console[_0x213f0b(0x114)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x404825),loggerService_1[_0x213f0b(0x173)]['logWhiteDomainError'](_0x213f0b(0x17e),_0x213f0b(0x151),'JSON\x20Parse\x20Error:\x20'+_0x404825);throw new Error(_0x213f0b(0x126)+_0x3ae38b);}console['log'](_0x213f0b(0x133)),console['log'](_0x213f0b(0x120),JSON[_0x213f0b(0x122)](_0x264ae1,null,0x2)),loggerService_1[_0x213f0b(0x173)][_0x213f0b(0x12b)](_0x213f0b(0x17e),_0x213f0b(0x151),_0x19f135[_0x213f0b(0x119)],_0x264ae1,_0x91d84);if(_0x264ae1[_0x213f0b(0x114)]||_0x264ae1['statusCode']){const _0x40b5d2=_0x264ae1[_0x213f0b(0x180)]||_0x264ae1['error']||_0x213f0b(0x167);console[_0x213f0b(0x114)](_0x213f0b(0x130)),console[_0x213f0b(0x114)](_0x213f0b(0x141),_0x40b5d2),console[_0x213f0b(0x114)](_0x213f0b(0x16c),_0x264ae1[_0x213f0b(0x153)]),loggerService_1[_0x213f0b(0x173)]['logWhiteDomainError'](_0x213f0b(0x17e),_0x213f0b(0x151),_0x213f0b(0x15e)+_0x40b5d2);throw new Error(_0x213f0b(0x162)+_0x40b5d2);}if(!_0x264ae1['id']||!_0x264ae1['shortLinkUrls']?.[_0x213f0b(0x143)]){console[_0x213f0b(0x114)](_0x213f0b(0x15d)),console[_0x213f0b(0x114)](_0x213f0b(0x110)),console[_0x213f0b(0x114)](_0x213f0b(0x149),_0x264ae1),loggerService_1[_0x213f0b(0x173)][_0x213f0b(0x13b)](_0x213f0b(0x17e),_0x213f0b(0x151),_0x213f0b(0x13e));throw new Error(_0x213f0b(0x136));}return console[_0x213f0b(0x137)](_0x213f0b(0x144)),console[_0x213f0b(0x137)](_0x213f0b(0x148),_0x264ae1['id']),console[_0x213f0b(0x137)](_0x213f0b(0x147),_0x264ae1[_0x213f0b(0x142)]['shortLink']),console[_0x213f0b(0x137)](_0x213f0b(0x131),_0x264ae1[_0x213f0b(0x142)]['qrCodeLink']||'Not\x20provided'),console[_0x213f0b(0x137)](_0x213f0b(0x15a),_0x2078c0,_0x213f0b(0x14d)),console[_0x213f0b(0x137)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x4ea590),{'gateway_payment_id':_0x264ae1['id'],'payment_url':_0x264ae1[_0x213f0b(0x142)][_0x213f0b(0x143)],'qr_code_url':_0x264ae1[_0x213f0b(0x142)][_0x213f0b(0x158)],'expiry_date':_0x264ae1[_0x213f0b(0x174)]};}catch(_0x4df008){console[_0x213f0b(0x114)](_0x213f0b(0x161)),console['error']('Error\x20details:',_0x4df008),loggerService_1['loggerService'][_0x213f0b(0x13b)](_0x213f0b(0x17e),_0x213f0b(0x151),_0x4df008);if(_0x4df008 instanceof Error){console[_0x213f0b(0x114)]('Error\x20message:',_0x4df008[_0x213f0b(0x180)]),console[_0x213f0b(0x114)](_0x213f0b(0x12d),_0x4df008['stack']);throw new Error(_0x213f0b(0x128)+_0x4df008[_0x213f0b(0x180)]);}throw new Error(_0x213f0b(0x146));}}async['verifyPayment'](_0x4cff07){const _0x127e68=a43_0x312a44,_0x3470e9=Date[_0x127e68(0x159)]();try{loggerService_1[_0x127e68(0x173)]['logWhiteDomainRequest'](_0x127e68(0x17e),_0x127e68(0x166)+_0x4cff07,'GET',{});const _0x4144f3=await fetch(this[_0x127e68(0x139)]+'/'+_0x4cff07,{'method':'GET','headers':{'Content-Type':_0x127e68(0x12c),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x3b0e09=Date[_0x127e68(0x159)]()-_0x3470e9;if(!_0x4144f3['ok']){const _0xda54c8=await _0x4144f3['text']();loggerService_1[_0x127e68(0x173)][_0x127e68(0x12b)](_0x127e68(0x17e),_0x127e68(0x166)+_0x4cff07,_0x4144f3[_0x127e68(0x119)],_0xda54c8,_0x3b0e09);throw new Error(_0x127e68(0x134)+_0x4144f3[_0x127e68(0x119)]);}const _0x18c6e4=await _0x4144f3['json']();loggerService_1['loggerService'][_0x127e68(0x12b)](_0x127e68(0x17e),_0x127e68(0x166)+_0x4cff07,_0x4144f3[_0x127e68(0x119)],_0x18c6e4,_0x3b0e09);if(_0x18c6e4[_0x127e68(0x114)]||_0x18c6e4[_0x127e68(0x153)]){loggerService_1[_0x127e68(0x173)][_0x127e68(0x13b)](_0x127e68(0x17e),_0x127e68(0x166)+_0x4cff07,_0x127e68(0x162)+(_0x18c6e4[_0x127e68(0x180)]||_0x18c6e4[_0x127e68(0x114)]||'Unknown\x20error'));throw new Error(_0x127e68(0x162)+(_0x18c6e4[_0x127e68(0x180)]||_0x18c6e4[_0x127e68(0x114)]||_0x127e68(0x176)));}let _0x260b48=_0x127e68(0x10a);if(_0x18c6e4[_0x127e68(0x125)]===![]){if(_0x18c6e4[_0x127e68(0x174)]){const _0x1578c5=new Date(_0x18c6e4['expiryDate']),_0x3f2b91=new Date();_0x1578c5<_0x3f2b91?_0x260b48='EXPIRED':_0x260b48=_0x127e68(0x145);}else _0x260b48='FAILED';}else _0x260b48=_0x127e68(0x10a);return{'status':_0x260b48,'amount':_0x18c6e4[_0x127e68(0x121)],'currency':_0x18c6e4[_0x127e68(0x14a)],'isActive':_0x18c6e4[_0x127e68(0x125)]};}catch(_0x160d02){console['error']('Noda\x20payment\x20verification\x20error:',_0x160d02),loggerService_1[_0x127e68(0x173)]['logWhiteDomainError'](_0x127e68(0x17e),_0x127e68(0x166)+_0x4cff07,_0x160d02);throw new Error(_0x127e68(0x117)+(_0x160d02 instanceof Error?_0x160d02[_0x127e68(0x180)]:'Unknown\x20error'));}}async[a43_0x312a44(0x17d)](_0x6e59ae){const _0xdebae6=a43_0x312a44;console[_0xdebae6(0x137)](_0xdebae6(0x152),_0x6e59ae);let _0x2415d9='PENDING';switch(_0x6e59ae['Status']?.[_0xdebae6(0x17a)]()){case _0xdebae6(0x10d):case _0xdebae6(0x172):case'paid':case'success':case _0xdebae6(0x12f):_0x6e59ae['Settled']===_0xdebae6(0x14b)?_0x2415d9=_0xdebae6(0x168):_0x2415d9=_0xdebae6(0x10a);break;case'cancelled':case _0xdebae6(0x16d):case _0xdebae6(0x129):case _0xdebae6(0x114):case _0xdebae6(0x156):_0x2415d9=_0xdebae6(0x145);break;case _0xdebae6(0x179):case _0xdebae6(0x10b):_0x2415d9=_0xdebae6(0x181);break;case _0xdebae6(0x11e):case _0xdebae6(0x16a):case _0xdebae6(0x118):case'processing':case _0xdebae6(0x157):default:_0x2415d9=_0xdebae6(0x10a);break;}return{'paymentId':_0x6e59ae[_0xdebae6(0x163)]||_0x6e59ae[_0xdebae6(0x113)],'status':_0x2415d9,'amount':_0x6e59ae['Amount'],'currency':_0x6e59ae['Currency'],'additionalInfo':{'method':_0x6e59ae[_0xdebae6(0x13d)],'bankId':_0x6e59ae[_0xdebae6(0x11c)],'settled':_0x6e59ae[_0xdebae6(0x115)],'settlementDate':_0x6e59ae[_0xdebae6(0x13f)],'remitterName':_0x6e59ae[_0xdebae6(0x12a)]?.[_0xdebae6(0x11b)],'remitterIban':_0x6e59ae[_0xdebae6(0x12a)]?.[_0xdebae6(0x111)],'bankTransactionId':_0x6e59ae[_0xdebae6(0x15c)]}};}[a43_0x312a44(0x132)](_0x12cc69,_0x388693){const _0x148371=a43_0x312a44;return console[_0x148371(0x137)](_0x148371(0x10c),{'receivedSignature':_0x388693,'paymentId':_0x12cc69[_0x148371(0x113)],'merchantPaymentId':_0x12cc69['MerchantPaymentId']}),!![];}}exports[a43_0x312a44(0x154)]=NodaService;