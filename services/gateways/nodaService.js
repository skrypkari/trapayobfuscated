'use strict';const a43_0x3ee353=a43_0x55da;(function(_0x398661,_0x1d7e67){const _0x2b9c99=a43_0x55da,_0x3d77fd=_0x398661();while(!![]){try{const _0x4cce93=-parseInt(_0x2b9c99(0x1eb))/0x1+parseInt(_0x2b9c99(0x1cc))/0x2*(parseInt(_0x2b9c99(0x1e7))/0x3)+-parseInt(_0x2b9c99(0x182))/0x4+-parseInt(_0x2b9c99(0x1cf))/0x5*(-parseInt(_0x2b9c99(0x1a5))/0x6)+-parseInt(_0x2b9c99(0x192))/0x7*(-parseInt(_0x2b9c99(0x1ab))/0x8)+-parseInt(_0x2b9c99(0x1d3))/0x9*(parseInt(_0x2b9c99(0x1bd))/0xa)+-parseInt(_0x2b9c99(0x1c3))/0xb;if(_0x4cce93===_0x1d7e67)break;else _0x3d77fd['push'](_0x3d77fd['shift']());}catch(_0x2704e0){_0x3d77fd['push'](_0x3d77fd['shift']());}}}(a43_0x329e,0x5102e));Object[a43_0x3ee353(0x1cd)](exports,a43_0x3ee353(0x197),{'value':!![]}),exports['NodaService']=void 0x0;function a43_0x55da(_0xb2955e,_0x413d2b){const _0x329e6b=a43_0x329e();return a43_0x55da=function(_0x55da59,_0x3fa1a6){_0x55da59=_0x55da59-0x17c;let _0x518215=_0x329e6b[_0x55da59];return _0x518215;},a43_0x55da(_0xb2955e,_0x413d2b);}function a43_0x329e(){const _0x266f17=['stack','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Noda\x20payment\x20verification\x20error:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','__esModule','shortLink','done','Noda\x20webhook\x20signature\x20verification:','headers','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','success','failed','statusCode','===\x20NODA\x20SERVICE\x20ERROR\x20===','log','now','isActive','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','198rRGdCB','(8digits-8digits\x20format)','Noda\x20API\x20error:\x20','TesSoft\x20Payment\x20System/1.0','error','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','5672SNCQPL','parse','FAILED','application/json','verifyPayment','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','GET','Failed\x20to\x20parse\x20JSON\x20response:','Unknown\x20error','logWhiteDomainRequest','currency','Name','https://tesoft.uk/gateway/pending.php?id=','Status\x20Text:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','HTTP\x20','Unknown\x20error\x20from\x20Noda\x20API','statusText','380gDqrkg','active','Business\x20Error:\x20','pending','POST','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','6285191SQaZMf','NodaService','json','HTTP\x20error!\x20status:\x20','Error\x20details:','/payment-links','Parsed\x20Result:','PENDING','Remitter','14xeTdTT','defineProperty','Response\x20Time:','100380ixnAcz','/payment-links/','Status:','MerchantPaymentId','23553Cgxzsj','Request\x20Body\x20(Direct\x20JSON):','logWhiteDomainResponse','canceled','Order\x20ID\x20Used:','EXPIRED','Status\x20Code:','logWhiteDomainError','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','qrCodeLink','status','toLowerCase','shortLinkUrls','===\x20PARSED\x20NODA\x20RESPONSE\x20===','HTTP\x20Status:','message','processWebhook','Response\x20data:','Settled','loggerService','105177cpSbGR','Currency','https://tesoft.uk/gateway/noda/webhook/','Not\x20provided','513715FCeIlO','PAID','URL:','Yes','PaymentId','Failed\x20to\x20verify\x20Noda\x20payment:\x20','text','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','verifyWebhookSignature','processing','amount','Short\x20Link:','Error\x20Message:','created','50564WerEWh','stringify','expiryDate','Processing\x20Noda\x20webhook:','Error\x20message:','fromEntries','Missing\x20id\x20or\x20shortLink\x20in\x20response','Status','BankTransactionId','apiUrl','Payment\x20Link\x20ID:','BankId','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','QR\x20Code\x20Link:','noda','JSON\x20Parse\x20Error:\x20','6132ebkCbx'];a43_0x329e=function(){return _0x266f17;};return a43_0x329e();}const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x3be79f=a43_0x3ee353;this['apiUrl']='https://tesoft.uk/gateway/noda/',console[_0x3be79f(0x1a1)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async['createPaymentLink'](_0x7a204c){const _0x1244d5=a43_0x3ee353,{orderId:_0x4546d0,name:_0x3240e3,paymentDescription:_0x2ac429,amount:_0x166f4e,currency:_0x52dad1,webhookUrl:_0x2b028c,returnUrl:_0x5c7a5c,expiryDate:_0x2575cb}=_0x7a204c,_0x4fe1c5=_0x52dad1['toUpperCase'](),_0x4882c2=_0x1244d5(0x1e9),_0x21f76d=_0x1244d5(0x1b7)+_0x4546d0,_0x258291={'name':_0x3240e3,'paymentDescription':_0x2ac429,'amount':_0x166f4e,'currency':_0x4fe1c5,'paymentId':_0x4546d0,'webhookUrl':_0x4882c2,'returnUrl':_0x21f76d};_0x2575cb&&(_0x258291[_0x1244d5(0x184)]=_0x2575cb);const _0x4befd8=Date[_0x1244d5(0x1a2)]();try{console['log'](_0x1244d5(0x1f2)),console[_0x1244d5(0x1a1)](_0x1244d5(0x1ed),this[_0x1244d5(0x18b)]),console[_0x1244d5(0x1a1)](_0x1244d5(0x1d4),JSON['stringify'](_0x258291,null,0x2)),console[_0x1244d5(0x1a1)]('Order\x20ID\x20Format:',_0x4546d0,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x1244d5(0x1a1)](_0x1244d5(0x1c2),_0x21f76d),loggerService_1[_0x1244d5(0x1e6)][_0x1244d5(0x1b4)](_0x1244d5(0x190),_0x1244d5(0x1c8),_0x1244d5(0x1c1),_0x258291);const _0x36aa2e=await fetch(this[_0x1244d5(0x18b)],{'method':'POST','headers':{'Content-Type':_0x1244d5(0x1ae),'Accept':_0x1244d5(0x1ae),'User-Agent':_0x1244d5(0x1a8)},'body':JSON['stringify'](_0x258291)}),_0xfa616=Date['now']()-_0x4befd8;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x1244d5(0x1a1)](_0x1244d5(0x1d1),_0x36aa2e['status']),console[_0x1244d5(0x1a1)](_0x1244d5(0x1b8),_0x36aa2e[_0x1244d5(0x1bc)]),console[_0x1244d5(0x1a1)]('Headers:',Object[_0x1244d5(0x187)](_0x36aa2e[_0x1244d5(0x19b)]['entries']())),console[_0x1244d5(0x1a1)](_0x1244d5(0x1ce),_0xfa616+'ms');const _0x2f9f84=await _0x36aa2e[_0x1244d5(0x1f1)]();console[_0x1244d5(0x1a1)]('Raw\x20Response\x20Body:',_0x2f9f84);if(!_0x36aa2e['ok']){console[_0x1244d5(0x1a9)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x1244d5(0x1a9)](_0x1244d5(0x1e1),_0x36aa2e[_0x1244d5(0x1dd)]),console[_0x1244d5(0x1a9)]('Response\x20Body:',_0x2f9f84),loggerService_1['loggerService'][_0x1244d5(0x1d5)](_0x1244d5(0x190),_0x1244d5(0x1c8),_0x36aa2e[_0x1244d5(0x1dd)],_0x2f9f84,_0xfa616),loggerService_1[_0x1244d5(0x1e6)][_0x1244d5(0x1da)](_0x1244d5(0x190),'/payment-links',_0x1244d5(0x1ba)+_0x36aa2e[_0x1244d5(0x1dd)]+':\x20'+_0x2f9f84);if(_0x36aa2e[_0x1244d5(0x1dd)]===0x190)throw new Error(_0x1244d5(0x1aa));else{if(_0x36aa2e[_0x1244d5(0x1dd)]===0x1f4)throw new Error(_0x1244d5(0x1b0));}throw new Error(_0x1244d5(0x1c6)+_0x36aa2e['status']+',\x20body:\x20'+_0x2f9f84);}let _0x53bcf7;try{_0x53bcf7=JSON[_0x1244d5(0x1ac)](_0x2f9f84);}catch(_0x5f3410){console[_0x1244d5(0x1a9)](_0x1244d5(0x1b2),_0x5f3410),loggerService_1[_0x1244d5(0x1e6)][_0x1244d5(0x1da)](_0x1244d5(0x190),'/payment-links',_0x1244d5(0x191)+_0x5f3410);throw new Error(_0x1244d5(0x194)+_0x2f9f84);}console[_0x1244d5(0x1a1)](_0x1244d5(0x1e0)),console['log'](_0x1244d5(0x1c9),JSON[_0x1244d5(0x183)](_0x53bcf7,null,0x2)),loggerService_1[_0x1244d5(0x1e6)][_0x1244d5(0x1d5)](_0x1244d5(0x190),'/payment-links',_0x36aa2e['status'],_0x53bcf7,_0xfa616);if(_0x53bcf7[_0x1244d5(0x1a9)]||_0x53bcf7[_0x1244d5(0x19f)]){const _0x5d3ad9=_0x53bcf7[_0x1244d5(0x1e2)]||_0x53bcf7['error']||_0x1244d5(0x1bb);console[_0x1244d5(0x1a9)](_0x1244d5(0x1a4)),console[_0x1244d5(0x1a9)](_0x1244d5(0x180),_0x5d3ad9),console[_0x1244d5(0x1a9)](_0x1244d5(0x1d9),_0x53bcf7[_0x1244d5(0x19f)]),loggerService_1[_0x1244d5(0x1e6)]['logWhiteDomainError'](_0x1244d5(0x190),'/payment-links',_0x1244d5(0x1bf)+_0x5d3ad9);throw new Error(_0x1244d5(0x1a7)+_0x5d3ad9);}if(!_0x53bcf7['id']||!_0x53bcf7[_0x1244d5(0x1df)]?.['shortLink']){console[_0x1244d5(0x1a9)](_0x1244d5(0x1db)),console[_0x1244d5(0x1a9)](_0x1244d5(0x188)),console[_0x1244d5(0x1a9)](_0x1244d5(0x1e4),_0x53bcf7),loggerService_1[_0x1244d5(0x1e6)][_0x1244d5(0x1da)](_0x1244d5(0x190),_0x1244d5(0x1c8),_0x1244d5(0x18e));throw new Error(_0x1244d5(0x196));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console[_0x1244d5(0x1a1)](_0x1244d5(0x18c),_0x53bcf7['id']),console[_0x1244d5(0x1a1)](_0x1244d5(0x17f),_0x53bcf7[_0x1244d5(0x1df)][_0x1244d5(0x198)]),console[_0x1244d5(0x1a1)](_0x1244d5(0x18f),_0x53bcf7[_0x1244d5(0x1df)][_0x1244d5(0x1dc)]||_0x1244d5(0x1ea)),console[_0x1244d5(0x1a1)](_0x1244d5(0x1d7),_0x4546d0,_0x1244d5(0x1a6)),console[_0x1244d5(0x1a1)](_0x1244d5(0x19c),_0x21f76d),{'gateway_payment_id':_0x53bcf7['id'],'payment_url':_0x53bcf7[_0x1244d5(0x1df)][_0x1244d5(0x198)],'qr_code_url':_0x53bcf7[_0x1244d5(0x1df)][_0x1244d5(0x1dc)],'expiry_date':_0x53bcf7['expiryDate']};}catch(_0xcad22b){console[_0x1244d5(0x1a9)](_0x1244d5(0x1a0)),console['error'](_0x1244d5(0x1c7),_0xcad22b),loggerService_1[_0x1244d5(0x1e6)][_0x1244d5(0x1da)](_0x1244d5(0x190),_0x1244d5(0x1c8),_0xcad22b);if(_0xcad22b instanceof Error){console['error'](_0x1244d5(0x186),_0xcad22b[_0x1244d5(0x1e2)]),console[_0x1244d5(0x1a9)]('Error\x20stack:',_0xcad22b[_0x1244d5(0x193)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0xcad22b[_0x1244d5(0x1e2)]);}throw new Error(_0x1244d5(0x1b9));}}async[a43_0x3ee353(0x1af)](_0x4dce1c){const _0x44e5ef=a43_0x3ee353,_0x301e05=Date[_0x44e5ef(0x1a2)]();try{loggerService_1[_0x44e5ef(0x1e6)][_0x44e5ef(0x1b4)](_0x44e5ef(0x190),_0x44e5ef(0x1d0)+_0x4dce1c,_0x44e5ef(0x1b1),{});const _0x23e85f=await fetch(this[_0x44e5ef(0x18b)]+'/'+_0x4dce1c,{'method':_0x44e5ef(0x1b1),'headers':{'Content-Type':'application/json','User-Agent':_0x44e5ef(0x1a8)}}),_0x8bef20=Date[_0x44e5ef(0x1a2)]()-_0x301e05;if(!_0x23e85f['ok']){const _0x5e2146=await _0x23e85f[_0x44e5ef(0x1f1)]();loggerService_1[_0x44e5ef(0x1e6)][_0x44e5ef(0x1d5)](_0x44e5ef(0x190),_0x44e5ef(0x1d0)+_0x4dce1c,_0x23e85f[_0x44e5ef(0x1dd)],_0x5e2146,_0x8bef20);throw new Error('HTTP\x20error!\x20status:\x20'+_0x23e85f['status']);}const _0x3144e7=await _0x23e85f[_0x44e5ef(0x1c5)]();loggerService_1[_0x44e5ef(0x1e6)][_0x44e5ef(0x1d5)]('noda',_0x44e5ef(0x1d0)+_0x4dce1c,_0x23e85f['status'],_0x3144e7,_0x8bef20);if(_0x3144e7[_0x44e5ef(0x1a9)]||_0x3144e7[_0x44e5ef(0x19f)]){loggerService_1['loggerService'][_0x44e5ef(0x1da)](_0x44e5ef(0x190),'/payment-links/'+_0x4dce1c,_0x44e5ef(0x1a7)+(_0x3144e7[_0x44e5ef(0x1e2)]||_0x3144e7['error']||_0x44e5ef(0x1b3)));throw new Error(_0x44e5ef(0x1a7)+(_0x3144e7[_0x44e5ef(0x1e2)]||_0x3144e7[_0x44e5ef(0x1a9)]||'Unknown\x20error'));}let _0x5451eb=_0x44e5ef(0x1ca);if(_0x3144e7[_0x44e5ef(0x1a3)]===![]){if(_0x3144e7[_0x44e5ef(0x184)]){const _0x5ab528=new Date(_0x3144e7[_0x44e5ef(0x184)]),_0x5353b1=new Date();_0x5ab528<_0x5353b1?_0x5451eb='EXPIRED':_0x5451eb=_0x44e5ef(0x1ad);}else _0x5451eb=_0x44e5ef(0x1ad);}else _0x5451eb=_0x44e5ef(0x1ca);return{'status':_0x5451eb,'amount':_0x3144e7[_0x44e5ef(0x17e)],'currency':_0x3144e7[_0x44e5ef(0x1b5)],'isActive':_0x3144e7[_0x44e5ef(0x1a3)]};}catch(_0x1c4cfe){console['error'](_0x44e5ef(0x195),_0x1c4cfe),loggerService_1['loggerService'][_0x44e5ef(0x1da)](_0x44e5ef(0x190),'/payment-links/'+_0x4dce1c,_0x1c4cfe);throw new Error(_0x44e5ef(0x1f0)+(_0x1c4cfe instanceof Error?_0x1c4cfe['message']:_0x44e5ef(0x1b3)));}}async[a43_0x3ee353(0x1e3)](_0xd87e21){const _0x4c4168=a43_0x3ee353;console['log'](_0x4c4168(0x185),_0xd87e21);let _0x20c9d1=_0x4c4168(0x1ca);switch(_0xd87e21[_0x4c4168(0x189)]?.[_0x4c4168(0x1de)]()){case _0x4c4168(0x199):case'completed':case'paid':case _0x4c4168(0x19d):case'successful':_0xd87e21['Settled']===_0x4c4168(0x1ee)?_0x20c9d1=_0x4c4168(0x1ec):_0x20c9d1='PENDING';break;case'cancelled':case _0x4c4168(0x1d6):case _0x4c4168(0x19e):case _0x4c4168(0x1a9):case'rejected':_0x20c9d1=_0x4c4168(0x1ad);break;case'expired':case'timeout':_0x20c9d1=_0x4c4168(0x1d8);break;case _0x4c4168(0x1c0):case _0x4c4168(0x181):case _0x4c4168(0x1be):case _0x4c4168(0x17d):case'in_progress':default:_0x20c9d1=_0x4c4168(0x1ca);break;}return{'paymentId':_0xd87e21[_0x4c4168(0x1d2)]||_0xd87e21[_0x4c4168(0x1ef)],'status':_0x20c9d1,'amount':_0xd87e21['Amount'],'currency':_0xd87e21[_0x4c4168(0x1e8)],'additionalInfo':{'method':_0xd87e21['Method'],'bankId':_0xd87e21[_0x4c4168(0x18d)],'settled':_0xd87e21[_0x4c4168(0x1e5)],'settlementDate':_0xd87e21['SettlementDate'],'remitterName':_0xd87e21[_0x4c4168(0x1cb)]?.[_0x4c4168(0x1b6)],'remitterIban':_0xd87e21[_0x4c4168(0x1cb)]?.['Iban'],'bankTransactionId':_0xd87e21[_0x4c4168(0x18a)]}};}[a43_0x3ee353(0x17c)](_0x1ca292,_0x3574ad){const _0x1a7cd0=a43_0x3ee353;return console[_0x1a7cd0(0x1a1)](_0x1a7cd0(0x19a),{'receivedSignature':_0x3574ad,'paymentId':_0x1ca292[_0x1a7cd0(0x1ef)],'merchantPaymentId':_0x1ca292[_0x1a7cd0(0x1d2)]}),!![];}}exports[a43_0x3ee353(0x1c4)]=NodaService;