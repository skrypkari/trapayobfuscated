'use strict';function a67_0x50c2(){const _0x2fa564=['shortLink','Failed\x20to\x20verify\x20Noda\x20payment:\x20','===\x20NODA\x20API\x20ERROR\x20===','Parsed\x20Result:','defineProperty','33834qvhzsu','loggerService','80gsQTDH','Unknown\x20error\x20from\x20Noda\x20API','Settled','active','Currency','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','1312091RwzEDA','Unknown\x20error','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','cancelled','failed','Status\x20Text:','Remitter','headers','statusText','Processing\x20Noda\x20webhook:','canceled','toUpperCase','Name','application/json','expired','message','Amount','statusCode','qrCodeLink','Request\x20Body\x20(Direct\x20JSON):','Status','316TKnDWe','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Iban',',\x20body:\x20','POST','/payment-links/','(8digits-8digits\x20format)','successful','NodaService','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','amount','Response\x20data:','Error\x20Message:','Payment\x20System/1.0','log','Failed\x20to\x20parse\x20JSON\x20response:','json','Error\x20stack:','Method','https://tesoft.uk/gateway/noda/webhook/','8eLTdam','===\x20PARSED\x20NODA\x20RESPONSE\x20===','createPaymentLink','rejected','logWhiteDomainError','Business\x20Error:\x20','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','entries','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Noda\x20payment\x20verification\x20error:','__esModule','expiryDate','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','PENDING','Order\x20ID\x20Format:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','SettlementDate','===\x20NODA\x20SUCCESS\x20===','Missing\x20id\x20or\x20shortLink\x20in\x20response','3574781svxgiK','Yes','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','1820926IBtRmm','error','verifyWebhookSignature','logWhiteDomainRequest','(8digits-8digits\x20format\x20for\x20Noda)','stringify','PAID','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Headers:','Order\x20ID\x20Used:','HTTP\x20Status:','isActive','3778875yQLCJG','Payment\x20Link\x20ID:','Response\x20Body:','pending','created','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainResponse','GET','processWebhook','BankTransactionId','completed','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','HTTP\x20','Response\x20Time:','currency','noda','shortLinkUrls','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','8681346UYcjof','Status:','toLowerCase','Status\x20Code:','Noda\x20API\x20error:\x20','text','FAILED','status','EXPIRED','Not\x20provided','success','paid','HTTP\x20error!\x20status:\x20','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','/payment-links','fromEntries','997725CatEMU','apiUrl','now'];a67_0x50c2=function(){return _0x2fa564;};return a67_0x50c2();}const a67_0x49733c=a67_0x5097;function a67_0x5097(_0xbb43f8,_0x23bd6e){_0xbb43f8=_0xbb43f8-0x11f;const _0x50c204=a67_0x50c2();let _0x509756=_0x50c204[_0xbb43f8];return _0x509756;}(function(_0x1fa364,_0xe81725){const _0x23e5d1=a67_0x5097,_0x5a7cb3=_0x1fa364();while(!![]){try{const _0x599d7b=-parseInt(_0x23e5d1(0x15b))/0x1+parseInt(_0x23e5d1(0x19a))/0x2+-parseInt(_0x23e5d1(0x153))/0x3*(parseInt(_0x23e5d1(0x170))/0x4)+-parseInt(_0x23e5d1(0x14b))/0x5+-parseInt(_0x23e5d1(0x13b))/0x6+parseInt(_0x23e5d1(0x197))/0x7*(parseInt(_0x23e5d1(0x184))/0x8)+parseInt(_0x23e5d1(0x129))/0x9*(parseInt(_0x23e5d1(0x155))/0xa);if(_0x599d7b===_0xe81725)break;else _0x5a7cb3['push'](_0x5a7cb3['shift']());}catch(_0x3d9401){_0x5a7cb3['push'](_0x5a7cb3['shift']());}}}(a67_0x50c2,0xe3361));Object[a67_0x49733c(0x152)](exports,a67_0x49733c(0x18e),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x1445f4=a67_0x49733c;this[_0x1445f4(0x14c)]='https://tesoft.uk/gateway/noda/',console[_0x1445f4(0x17e)](_0x1445f4(0x134));}async[a67_0x49733c(0x186)](_0x2ca10b){const _0x554556=a67_0x49733c,{orderId:_0x35236e,name:_0x5a5028,paymentDescription:_0x4938a0,amount:_0x5f3736,currency:_0x2d87ed,webhookUrl:_0x130c2d,returnUrl:_0x17dc95,expiryDate:_0x2d9a4f}=_0x2ca10b,_0x5c0545=_0x2d87ed[_0x554556(0x166)](),_0x30c0b9=_0x554556(0x183),_0x4f8c32='https://tesoft.uk/gateway/pending.php?id='+_0x35236e,_0x4d8719={'name':_0x5a5028,'paymentDescription':_0x4938a0,'amount':_0x5f3736,'currency':_0x5c0545,'paymentId':_0x35236e,'webhookUrl':_0x30c0b9,'returnUrl':_0x4f8c32};_0x2d9a4f&&(_0x4d8719[_0x554556(0x18f)]=_0x2d9a4f);const _0x2d39fe=Date[_0x554556(0x14d)]();try{console[_0x554556(0x17e)](_0x554556(0x179)),console[_0x554556(0x17e)]('URL:',this[_0x554556(0x14c)]),console[_0x554556(0x17e)](_0x554556(0x16e),JSON[_0x554556(0x122)](_0x4d8719,null,0x2)),console[_0x554556(0x17e)](_0x554556(0x192),_0x35236e,_0x554556(0x121)),console[_0x554556(0x17e)](_0x554556(0x199),_0x4f8c32),loggerService_1[_0x554556(0x154)][_0x554556(0x120)](_0x554556(0x138),'/payment-links',_0x554556(0x174),_0x4d8719);const _0x434073=await fetch(this[_0x554556(0x14c)],{'method':_0x554556(0x174),'headers':{'Content-Type':_0x554556(0x168),'Accept':_0x554556(0x168),'User-Agent':_0x554556(0x17d)},'body':JSON['stringify'](_0x4d8719)}),_0x571e4d=Date[_0x554556(0x14d)]()-_0x2d39fe;console[_0x554556(0x17e)](_0x554556(0x148)),console[_0x554556(0x17e)](_0x554556(0x13c),_0x434073[_0x554556(0x142)]),console[_0x554556(0x17e)](_0x554556(0x160),_0x434073[_0x554556(0x163)]),console['log'](_0x554556(0x125),Object[_0x554556(0x14a)](_0x434073[_0x554556(0x162)][_0x554556(0x18b)]())),console['log'](_0x554556(0x136),_0x571e4d+'ms');const _0xdd2c46=await _0x434073[_0x554556(0x140)]();console[_0x554556(0x17e)]('Raw\x20Response\x20Body:',_0xdd2c46);if(!_0x434073['ok']){console[_0x554556(0x19b)](_0x554556(0x150)),console[_0x554556(0x19b)](_0x554556(0x127),_0x434073[_0x554556(0x142)]),console[_0x554556(0x19b)](_0x554556(0x12b),_0xdd2c46),loggerService_1['loggerService'][_0x554556(0x12f)]('noda',_0x554556(0x149),_0x434073[_0x554556(0x142)],_0xdd2c46,_0x571e4d),loggerService_1[_0x554556(0x154)][_0x554556(0x188)](_0x554556(0x138),_0x554556(0x149),_0x554556(0x135)+_0x434073[_0x554556(0x142)]+':\x20'+_0xdd2c46);if(_0x434073[_0x554556(0x142)]===0x190)throw new Error(_0x554556(0x193));else{if(_0x434073['status']===0x1f4)throw new Error(_0x554556(0x171));}throw new Error(_0x554556(0x147)+_0x434073['status']+_0x554556(0x173)+_0xdd2c46);}let _0x56aaa4;try{_0x56aaa4=JSON['parse'](_0xdd2c46);}catch(_0x341590){console[_0x554556(0x19b)](_0x554556(0x17f),_0x341590),loggerService_1[_0x554556(0x154)]['logWhiteDomainError']('noda','/payment-links','JSON\x20Parse\x20Error:\x20'+_0x341590);throw new Error(_0x554556(0x18c)+_0xdd2c46);}console['log'](_0x554556(0x185)),console[_0x554556(0x17e)](_0x554556(0x151),JSON[_0x554556(0x122)](_0x56aaa4,null,0x2)),loggerService_1[_0x554556(0x154)][_0x554556(0x12f)](_0x554556(0x138),_0x554556(0x149),_0x434073[_0x554556(0x142)],_0x56aaa4,_0x571e4d);if(_0x56aaa4['error']||_0x56aaa4[_0x554556(0x16c)]){const _0x379f73=_0x56aaa4['message']||_0x56aaa4[_0x554556(0x19b)]||_0x554556(0x156);console['error'](_0x554556(0x13a)),console[_0x554556(0x19b)](_0x554556(0x17c),_0x379f73),console['error'](_0x554556(0x13e),_0x56aaa4['statusCode']),loggerService_1[_0x554556(0x154)][_0x554556(0x188)](_0x554556(0x138),_0x554556(0x149),_0x554556(0x189)+_0x379f73);throw new Error(_0x554556(0x13f)+_0x379f73);}if(!_0x56aaa4['id']||!_0x56aaa4[_0x554556(0x139)]?.[_0x554556(0x14e)]){console[_0x554556(0x19b)](_0x554556(0x12e)),console[_0x554556(0x19b)](_0x554556(0x196)),console[_0x554556(0x19b)](_0x554556(0x17b),_0x56aaa4),loggerService_1['loggerService'][_0x554556(0x188)](_0x554556(0x138),_0x554556(0x149),_0x554556(0x15d));throw new Error(_0x554556(0x124));}return console['log'](_0x554556(0x195)),console[_0x554556(0x17e)](_0x554556(0x12a),_0x56aaa4['id']),console[_0x554556(0x17e)]('Short\x20Link:',_0x56aaa4['shortLinkUrls'][_0x554556(0x14e)]),console[_0x554556(0x17e)]('QR\x20Code\x20Link:',_0x56aaa4['shortLinkUrls'][_0x554556(0x16d)]||_0x554556(0x144)),console[_0x554556(0x17e)](_0x554556(0x126),_0x35236e,_0x554556(0x176)),console['log'](_0x554556(0x18a),_0x4f8c32),{'gateway_payment_id':_0x56aaa4['id'],'payment_url':_0x56aaa4[_0x554556(0x139)]['shortLink'],'qr_code_url':_0x56aaa4['shortLinkUrls'][_0x554556(0x16d)],'expiry_date':_0x56aaa4[_0x554556(0x18f)]};}catch(_0xefc24f){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x554556(0x19b)]('Error\x20details:',_0xefc24f),loggerService_1[_0x554556(0x154)]['logWhiteDomainError'](_0x554556(0x138),_0x554556(0x149),_0xefc24f);if(_0xefc24f instanceof Error){console[_0x554556(0x19b)]('Error\x20message:',_0xefc24f['message']),console[_0x554556(0x19b)](_0x554556(0x181),_0xefc24f['stack']);throw new Error(_0x554556(0x190)+_0xefc24f['message']);}throw new Error(_0x554556(0x15a));}}async['verifyPayment'](_0x4c887b){const _0x4f2624=a67_0x49733c,_0x301951=Date[_0x4f2624(0x14d)]();try{loggerService_1[_0x4f2624(0x154)]['logWhiteDomainRequest'](_0x4f2624(0x138),'/payment-links/'+_0x4c887b,_0x4f2624(0x130),{});const _0x1cf4ea=await fetch(this['apiUrl']+'/'+_0x4c887b,{'method':'GET','headers':{'Content-Type':_0x4f2624(0x168),'User-Agent':_0x4f2624(0x17d)}}),_0x1b675d=Date[_0x4f2624(0x14d)]()-_0x301951;if(!_0x1cf4ea['ok']){const _0xd2134f=await _0x1cf4ea[_0x4f2624(0x140)]();loggerService_1[_0x4f2624(0x154)]['logWhiteDomainResponse']('noda','/payment-links/'+_0x4c887b,_0x1cf4ea[_0x4f2624(0x142)],_0xd2134f,_0x1b675d);throw new Error(_0x4f2624(0x147)+_0x1cf4ea['status']);}const _0x591792=await _0x1cf4ea[_0x4f2624(0x180)]();loggerService_1[_0x4f2624(0x154)][_0x4f2624(0x12f)](_0x4f2624(0x138),_0x4f2624(0x175)+_0x4c887b,_0x1cf4ea[_0x4f2624(0x142)],_0x591792,_0x1b675d);if(_0x591792[_0x4f2624(0x19b)]||_0x591792[_0x4f2624(0x16c)]){loggerService_1[_0x4f2624(0x154)][_0x4f2624(0x188)](_0x4f2624(0x138),'/payment-links/'+_0x4c887b,_0x4f2624(0x13f)+(_0x591792[_0x4f2624(0x16a)]||_0x591792['error']||_0x4f2624(0x15c)));throw new Error('Noda\x20API\x20error:\x20'+(_0x591792[_0x4f2624(0x16a)]||_0x591792['error']||_0x4f2624(0x15c)));}let _0x117fc0='PENDING';if(_0x591792['isActive']===![]){if(_0x591792['expiryDate']){const _0x3d39e1=new Date(_0x591792[_0x4f2624(0x18f)]),_0x3c744e=new Date();_0x3d39e1<_0x3c744e?_0x117fc0=_0x4f2624(0x143):_0x117fc0=_0x4f2624(0x141);}else _0x117fc0='FAILED';}else _0x117fc0=_0x4f2624(0x191);return{'status':_0x117fc0,'amount':_0x591792[_0x4f2624(0x17a)],'currency':_0x591792[_0x4f2624(0x137)],'isActive':_0x591792[_0x4f2624(0x128)]};}catch(_0x49124e){console[_0x4f2624(0x19b)](_0x4f2624(0x18d),_0x49124e),loggerService_1[_0x4f2624(0x154)]['logWhiteDomainError'](_0x4f2624(0x138),_0x4f2624(0x175)+_0x4c887b,_0x49124e);throw new Error(_0x4f2624(0x14f)+(_0x49124e instanceof Error?_0x49124e[_0x4f2624(0x16a)]:_0x4f2624(0x15c)));}}async[a67_0x49733c(0x131)](_0x20ab72){const _0x2affce=a67_0x49733c;console[_0x2affce(0x17e)](_0x2affce(0x164),_0x20ab72);let _0x3707af=_0x2affce(0x191);switch(_0x20ab72[_0x2affce(0x16f)]?.[_0x2affce(0x13d)]()){case'done':case _0x2affce(0x133):case _0x2affce(0x146):case _0x2affce(0x145):case _0x2affce(0x177):_0x20ab72[_0x2affce(0x157)]===_0x2affce(0x198)?_0x3707af=_0x2affce(0x123):_0x3707af=_0x2affce(0x191);break;case _0x2affce(0x15e):case _0x2affce(0x165):case _0x2affce(0x15f):case _0x2affce(0x19b):case _0x2affce(0x187):_0x3707af=_0x2affce(0x141);break;case _0x2affce(0x169):case'timeout':_0x3707af=_0x2affce(0x143);break;case _0x2affce(0x12c):case _0x2affce(0x12d):case _0x2affce(0x158):case'processing':case'in_progress':default:_0x3707af=_0x2affce(0x191);break;}return{'paymentId':_0x20ab72['MerchantPaymentId']||_0x20ab72['PaymentId'],'status':_0x3707af,'amount':_0x20ab72[_0x2affce(0x16b)],'currency':_0x20ab72[_0x2affce(0x159)],'additionalInfo':{'method':_0x20ab72[_0x2affce(0x182)],'bankId':_0x20ab72['BankId'],'settled':_0x20ab72[_0x2affce(0x157)],'settlementDate':_0x20ab72[_0x2affce(0x194)],'remitterName':_0x20ab72[_0x2affce(0x161)]?.[_0x2affce(0x167)],'remitterIban':_0x20ab72[_0x2affce(0x161)]?.[_0x2affce(0x172)],'bankTransactionId':_0x20ab72[_0x2affce(0x132)]}};}[a67_0x49733c(0x11f)](_0x3faf5b,_0x59f13a){return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x59f13a,'paymentId':_0x3faf5b['PaymentId'],'merchantPaymentId':_0x3faf5b['MerchantPaymentId']}),!![];}}exports[a67_0x49733c(0x178)]=NodaService;