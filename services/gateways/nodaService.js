'use strict';const a44_0x3c9715=a44_0x41e7;function a44_0x3dea(){const _0x470d69=['8729100rzcebL','Raw\x20Response\x20Body:','fromEntries','Error\x20stack:','246824NpTlvN','Headers:','Failed\x20to\x20parse\x20JSON\x20response:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','createPaymentLink','https://tesoft.uk/gateway/pending.php?id=','===\x20NODA\x20SUCCESS\x20===','text','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainError','Failed\x20to\x20verify\x20Noda\x20payment:\x20','isActive','PaymentId','paid','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','stringify','Not\x20provided','Response\x20Time:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Noda\x20API\x20error:\x20','GET','loggerService','/payment-links','statusText','now','message','logWhiteDomainRequest','Error\x20details:','https://tesoft.uk/gateway/noda/','HTTP\x20Status:','HTTP\x20','MerchantPaymentId','expiryDate','log','toLowerCase','timeout','Order\x20ID\x20Format:','Settled','logWhiteDomainResponse','===\x20NODA\x20API\x20ERROR\x20===','Remitter','statusCode','BankTransactionId','pending','FAILED','canceled','POST','EXPIRED','parse','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','success','Method','in_progress','Request\x20Body\x20(Direct\x20JSON):','Noda\x20webhook\x20signature\x20verification:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Response\x20data:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','BankId','Noda\x20payment\x20verification\x20error:','expired','Iban','Name','3013710tSMDpf','amount','1523284IVOqEz','8682ruUMGn','successful','Status:','toUpperCase','processWebhook','shortLinkUrls','2427072rHZfHC','Payment\x20Link\x20ID:','verifyWebhookSignature','active','4882990HbWYVc','../loggerService','Amount','status','completed','Error\x20message:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','shortLink','Short\x20Link:','Status\x20Code:','currency','===\x20NODA\x20SERVICE\x20ERROR\x20===','SettlementDate','Status\x20Text:','json','Error\x20Message:','rejected','1198rblJEJ','application/json','defineProperty','(8digits-8digits\x20format\x20for\x20Noda)','HTTP\x20error!\x20status:\x20','Business\x20Error:\x20','noda','error','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','qrCodeLink','PENDING','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Unknown\x20error','NodaService','1305aOgcsC','failed','PAID','apiUrl','Unknown\x20error\x20from\x20Noda\x20API','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','JSON\x20Parse\x20Error:\x20','(8digits-8digits\x20format)','/payment-links/',',\x20body:\x20','headers','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'];a44_0x3dea=function(){return _0x470d69;};return a44_0x3dea();}(function(_0x2ba4da,_0x3e6ba4){const _0x24eb3c=a44_0x41e7,_0x5b78d9=_0x2ba4da();while(!![]){try{const _0x2bfb01=parseInt(_0x24eb3c(0x18a))/0x1+-parseInt(_0x24eb3c(0x1a6))/0x2*(-parseInt(_0x24eb3c(0x18b))/0x3)+-parseInt(_0x24eb3c(0x191))/0x4+parseInt(_0x24eb3c(0x188))/0x5+parseInt(_0x24eb3c(0x145))/0x6+parseInt(_0x24eb3c(0x195))/0x7+-parseInt(_0x24eb3c(0x149))/0x8*(parseInt(_0x24eb3c(0x1b4))/0x9);if(_0x2bfb01===_0x3e6ba4)break;else _0x5b78d9['push'](_0x5b78d9['shift']());}catch(_0x26d5c2){_0x5b78d9['push'](_0x5b78d9['shift']());}}}(a44_0x3dea,0xe36ab));Object[a44_0x3c9715(0x1a8)](exports,'__esModule',{'value':!![]}),exports[a44_0x3c9715(0x1b3)]=void 0x0;const loggerService_1=require(a44_0x3c9715(0x196));class NodaService{constructor(){const _0x59074a=a44_0x3c9715;this[_0x59074a(0x1b7)]=_0x59074a(0x165),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a44_0x3c9715(0x14d)](_0x3fa5a4){const _0x1a0101=a44_0x3c9715,{orderId:_0x5327c7,name:_0xd87b4,paymentDescription:_0x2830c6,amount:_0x3effa4,currency:_0x59fcac,webhookUrl:_0x21d34f,returnUrl:_0x3fc680,expiryDate:_0x763c6f}=_0x3fa5a4,_0x4e87b6=_0x59fcac[_0x1a0101(0x18e)](),_0x114a8e='https://tesoft.uk/gateway/noda/webhook/',_0x10b66e=_0x1a0101(0x14e)+_0x5327c7,_0x25534f={'name':_0xd87b4,'paymentDescription':_0x2830c6,'amount':_0x3effa4,'currency':_0x4e87b6,'paymentId':_0x5327c7,'webhookUrl':_0x114a8e,'returnUrl':_0x10b66e};_0x763c6f&&(_0x25534f[_0x1a0101(0x169)]=_0x763c6f);const _0x57d3ed=Date[_0x1a0101(0x161)]();try{console[_0x1a0101(0x16a)](_0x1a0101(0x1b9)),console[_0x1a0101(0x16a)]('URL:',this[_0x1a0101(0x1b7)]),console['log'](_0x1a0101(0x17e),JSON[_0x1a0101(0x158)](_0x25534f,null,0x2)),console[_0x1a0101(0x16a)](_0x1a0101(0x16d),_0x5327c7,_0x1a0101(0x1a9)),console[_0x1a0101(0x16a)](_0x1a0101(0x1b1),_0x10b66e),loggerService_1[_0x1a0101(0x15e)]['logWhiteDomainRequest'](_0x1a0101(0x1ac),_0x1a0101(0x15f),_0x1a0101(0x177),_0x25534f);const _0x42837f=await fetch(this[_0x1a0101(0x1b7)],{'method':'POST','headers':{'Content-Type':_0x1a0101(0x1a7),'Accept':_0x1a0101(0x1a7),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1a0101(0x158)](_0x25534f)}),_0x190deb=Date[_0x1a0101(0x161)]()-_0x57d3ed;console[_0x1a0101(0x16a)](_0x1a0101(0x151)),console[_0x1a0101(0x16a)](_0x1a0101(0x18d),_0x42837f[_0x1a0101(0x198)]),console['log'](_0x1a0101(0x1a2),_0x42837f[_0x1a0101(0x160)]),console['log'](_0x1a0101(0x14a),Object[_0x1a0101(0x147)](_0x42837f[_0x1a0101(0x143)]['entries']())),console[_0x1a0101(0x16a)](_0x1a0101(0x15a),_0x190deb+'ms');const _0x2127a8=await _0x42837f[_0x1a0101(0x150)]();console[_0x1a0101(0x16a)](_0x1a0101(0x146),_0x2127a8);if(!_0x42837f['ok']){console[_0x1a0101(0x1ad)](_0x1a0101(0x170)),console[_0x1a0101(0x1ad)](_0x1a0101(0x166),_0x42837f[_0x1a0101(0x198)]),console[_0x1a0101(0x1ad)]('Response\x20Body:',_0x2127a8),loggerService_1['loggerService'][_0x1a0101(0x16f)]('noda',_0x1a0101(0x15f),_0x42837f['status'],_0x2127a8,_0x190deb),loggerService_1[_0x1a0101(0x15e)][_0x1a0101(0x152)](_0x1a0101(0x1ac),_0x1a0101(0x15f),_0x1a0101(0x167)+_0x42837f[_0x1a0101(0x198)]+':\x20'+_0x2127a8);if(_0x42837f[_0x1a0101(0x198)]===0x190)throw new Error(_0x1a0101(0x14c));else{if(_0x42837f['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x1a0101(0x1aa)+_0x42837f[_0x1a0101(0x198)]+_0x1a0101(0x1bd)+_0x2127a8);}let _0x3d4132;try{_0x3d4132=JSON[_0x1a0101(0x179)](_0x2127a8);}catch(_0x1cb90b){console[_0x1a0101(0x1ad)](_0x1a0101(0x14b),_0x1cb90b),loggerService_1['loggerService'][_0x1a0101(0x152)](_0x1a0101(0x1ac),_0x1a0101(0x15f),_0x1a0101(0x1ba)+_0x1cb90b);throw new Error(_0x1a0101(0x157)+_0x2127a8);}console[_0x1a0101(0x16a)](_0x1a0101(0x182)),console[_0x1a0101(0x16a)]('Parsed\x20Result:',JSON[_0x1a0101(0x158)](_0x3d4132,null,0x2)),loggerService_1[_0x1a0101(0x15e)][_0x1a0101(0x16f)](_0x1a0101(0x1ac),_0x1a0101(0x15f),_0x42837f[_0x1a0101(0x198)],_0x3d4132,_0x190deb);if(_0x3d4132[_0x1a0101(0x1ad)]||_0x3d4132[_0x1a0101(0x172)]){const _0x148561=_0x3d4132['message']||_0x3d4132['error']||_0x1a0101(0x1b8);console[_0x1a0101(0x1ad)](_0x1a0101(0x19b)),console[_0x1a0101(0x1ad)](_0x1a0101(0x1a4),_0x148561),console[_0x1a0101(0x1ad)](_0x1a0101(0x19e),_0x3d4132[_0x1a0101(0x172)]),loggerService_1[_0x1a0101(0x15e)][_0x1a0101(0x152)]('noda',_0x1a0101(0x15f),_0x1a0101(0x1ab)+_0x148561);throw new Error(_0x1a0101(0x15c)+_0x148561);}if(!_0x3d4132['id']||!_0x3d4132['shortLinkUrls']?.[_0x1a0101(0x19c)]){console['error'](_0x1a0101(0x17a)),console[_0x1a0101(0x1ad)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x1a0101(0x1ad)](_0x1a0101(0x181),_0x3d4132),loggerService_1['loggerService']['logWhiteDomainError'](_0x1a0101(0x1ac),_0x1a0101(0x15f),_0x1a0101(0x1ae));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x1a0101(0x16a)](_0x1a0101(0x14f)),console[_0x1a0101(0x16a)](_0x1a0101(0x192),_0x3d4132['id']),console[_0x1a0101(0x16a)](_0x1a0101(0x19d),_0x3d4132[_0x1a0101(0x190)]['shortLink']),console[_0x1a0101(0x16a)]('QR\x20Code\x20Link:',_0x3d4132['shortLinkUrls'][_0x1a0101(0x1af)]||_0x1a0101(0x159)),console[_0x1a0101(0x16a)]('Order\x20ID\x20Used:',_0x5327c7,_0x1a0101(0x1bb)),console[_0x1a0101(0x16a)](_0x1a0101(0x15b),_0x10b66e),{'gateway_payment_id':_0x3d4132['id'],'payment_url':_0x3d4132[_0x1a0101(0x190)][_0x1a0101(0x19c)],'qr_code_url':_0x3d4132[_0x1a0101(0x190)][_0x1a0101(0x1af)],'expiry_date':_0x3d4132[_0x1a0101(0x169)]};}catch(_0x26c069){console[_0x1a0101(0x1ad)](_0x1a0101(0x1a0)),console[_0x1a0101(0x1ad)](_0x1a0101(0x164),_0x26c069),loggerService_1[_0x1a0101(0x15e)][_0x1a0101(0x152)](_0x1a0101(0x1ac),_0x1a0101(0x15f),_0x26c069);if(_0x26c069 instanceof Error){console[_0x1a0101(0x1ad)](_0x1a0101(0x19a),_0x26c069[_0x1a0101(0x162)]),console[_0x1a0101(0x1ad)](_0x1a0101(0x148),_0x26c069['stack']);throw new Error(_0x1a0101(0x144)+_0x26c069[_0x1a0101(0x162)]);}throw new Error(_0x1a0101(0x180));}}async['verifyPayment'](_0x507aaa){const _0xc3a561=a44_0x3c9715,_0x4c971b=Date[_0xc3a561(0x161)]();try{loggerService_1[_0xc3a561(0x15e)][_0xc3a561(0x163)]('noda',_0xc3a561(0x1bc)+_0x507aaa,_0xc3a561(0x15d),{});const _0x241c43=await fetch(this['apiUrl']+'/'+_0x507aaa,{'method':'GET','headers':{'Content-Type':_0xc3a561(0x1a7),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x421db4=Date[_0xc3a561(0x161)]()-_0x4c971b;if(!_0x241c43['ok']){const _0x20e79e=await _0x241c43['text']();loggerService_1[_0xc3a561(0x15e)]['logWhiteDomainResponse'](_0xc3a561(0x1ac),_0xc3a561(0x1bc)+_0x507aaa,_0x241c43[_0xc3a561(0x198)],_0x20e79e,_0x421db4);throw new Error('HTTP\x20error!\x20status:\x20'+_0x241c43[_0xc3a561(0x198)]);}const _0x387bb1=await _0x241c43[_0xc3a561(0x1a3)]();loggerService_1[_0xc3a561(0x15e)]['logWhiteDomainResponse'](_0xc3a561(0x1ac),'/payment-links/'+_0x507aaa,_0x241c43[_0xc3a561(0x198)],_0x387bb1,_0x421db4);if(_0x387bb1[_0xc3a561(0x1ad)]||_0x387bb1[_0xc3a561(0x172)]){loggerService_1['loggerService'][_0xc3a561(0x152)](_0xc3a561(0x1ac),_0xc3a561(0x1bc)+_0x507aaa,_0xc3a561(0x15c)+(_0x387bb1['message']||_0x387bb1[_0xc3a561(0x1ad)]||'Unknown\x20error'));throw new Error(_0xc3a561(0x15c)+(_0x387bb1[_0xc3a561(0x162)]||_0x387bb1[_0xc3a561(0x1ad)]||_0xc3a561(0x1b2)));}let _0x27f38a=_0xc3a561(0x1b0);if(_0x387bb1[_0xc3a561(0x154)]===![]){if(_0x387bb1['expiryDate']){const _0x586474=new Date(_0x387bb1[_0xc3a561(0x169)]),_0x9ddbe=new Date();_0x586474<_0x9ddbe?_0x27f38a=_0xc3a561(0x178):_0x27f38a=_0xc3a561(0x175);}else _0x27f38a=_0xc3a561(0x175);}else _0x27f38a=_0xc3a561(0x1b0);return{'status':_0x27f38a,'amount':_0x387bb1[_0xc3a561(0x189)],'currency':_0x387bb1[_0xc3a561(0x19f)],'isActive':_0x387bb1[_0xc3a561(0x154)]};}catch(_0x22e07e){console['error'](_0xc3a561(0x184),_0x22e07e),loggerService_1[_0xc3a561(0x15e)][_0xc3a561(0x152)](_0xc3a561(0x1ac),'/payment-links/'+_0x507aaa,_0x22e07e);throw new Error(_0xc3a561(0x153)+(_0x22e07e instanceof Error?_0x22e07e[_0xc3a561(0x162)]:_0xc3a561(0x1b2)));}}async[a44_0x3c9715(0x18f)](_0x593b0d){const _0x18ab6b=a44_0x3c9715;console['log']('Processing\x20Noda\x20webhook:',_0x593b0d);let _0x1f595c='PENDING';switch(_0x593b0d['Status']?.[_0x18ab6b(0x16b)]()){case'done':case _0x18ab6b(0x199):case _0x18ab6b(0x156):case _0x18ab6b(0x17b):case _0x18ab6b(0x18c):_0x593b0d[_0x18ab6b(0x16e)]==='Yes'?_0x1f595c=_0x18ab6b(0x1b6):_0x1f595c=_0x18ab6b(0x1b0);break;case'cancelled':case _0x18ab6b(0x176):case _0x18ab6b(0x1b5):case _0x18ab6b(0x1ad):case _0x18ab6b(0x1a5):_0x1f595c=_0x18ab6b(0x175);break;case _0x18ab6b(0x185):case _0x18ab6b(0x16c):_0x1f595c=_0x18ab6b(0x178);break;case _0x18ab6b(0x174):case'created':case _0x18ab6b(0x194):case'processing':case _0x18ab6b(0x17d):default:_0x1f595c=_0x18ab6b(0x1b0);break;}return{'paymentId':_0x593b0d[_0x18ab6b(0x168)]||_0x593b0d[_0x18ab6b(0x155)],'status':_0x1f595c,'amount':_0x593b0d[_0x18ab6b(0x197)],'currency':_0x593b0d['Currency'],'additionalInfo':{'method':_0x593b0d[_0x18ab6b(0x17c)],'bankId':_0x593b0d[_0x18ab6b(0x183)],'settled':_0x593b0d['Settled'],'settlementDate':_0x593b0d[_0x18ab6b(0x1a1)],'remitterName':_0x593b0d[_0x18ab6b(0x171)]?.[_0x18ab6b(0x187)],'remitterIban':_0x593b0d[_0x18ab6b(0x171)]?.[_0x18ab6b(0x186)],'bankTransactionId':_0x593b0d[_0x18ab6b(0x173)]}};}[a44_0x3c9715(0x193)](_0x58b347,_0x2170e4){const _0x25bc12=a44_0x3c9715;return console[_0x25bc12(0x16a)](_0x25bc12(0x17f),{'receivedSignature':_0x2170e4,'paymentId':_0x58b347[_0x25bc12(0x155)],'merchantPaymentId':_0x58b347[_0x25bc12(0x168)]}),!![];}}function a44_0x41e7(_0x34991b,_0x2f8b17){const _0x3deaf8=a44_0x3dea();return a44_0x41e7=function(_0x41e79c,_0x1c5310){_0x41e79c=_0x41e79c-0x143;let _0x253319=_0x3deaf8[_0x41e79c];return _0x253319;},a44_0x41e7(_0x34991b,_0x2f8b17);}exports[a44_0x3c9715(0x1b3)]=NodaService;