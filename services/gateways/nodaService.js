'use strict';const a40_0x27b4b1=a40_0x3a8c;(function(_0x17fff0,_0x1f66e5){const _0x4d434d=a40_0x3a8c,_0x5ed393=_0x17fff0();while(!![]){try{const _0x2d11a6=-parseInt(_0x4d434d(0x190))/0x1*(parseInt(_0x4d434d(0x17b))/0x2)+parseInt(_0x4d434d(0x15b))/0x3*(parseInt(_0x4d434d(0x145))/0x4)+parseInt(_0x4d434d(0x14a))/0x5+parseInt(_0x4d434d(0x18f))/0x6*(-parseInt(_0x4d434d(0x191))/0x7)+-parseInt(_0x4d434d(0x13e))/0x8+parseInt(_0x4d434d(0x18c))/0x9+parseInt(_0x4d434d(0x174))/0xa;if(_0x2d11a6===_0x1f66e5)break;else _0x5ed393['push'](_0x5ed393['shift']());}catch(_0xc04b90){_0x5ed393['push'](_0x5ed393['shift']());}}}(a40_0x46d2,0x93b8a));function a40_0x3a8c(_0x3c0387,_0x12c607){const _0x46d2b0=a40_0x46d2();return a40_0x3a8c=function(_0x3a8cc7,_0x4ce288){_0x3a8cc7=_0x3a8cc7-0x13b;let _0x3858a6=_0x46d2b0[_0x3a8cc7];return _0x3858a6;},a40_0x3a8c(_0x3c0387,_0x12c607);}Object[a40_0x27b4b1(0x150)](exports,a40_0x27b4b1(0x1a6),{'value':!![]}),exports[a40_0x27b4b1(0x1a5)]=void 0x0;function a40_0x46d2(){const _0x37e081=['message','qrCodeLink','Raw\x20Response\x20Body:','Processing\x20Noda\x20webhook:','Order\x20ID\x20Format:','MerchantPaymentId','Error\x20Message:','Request\x20Body\x20(Direct\x20JSON):','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20details:','in_progress','POST','(8digits-8digits\x20format\x20for\x20Noda)','9661120OAljJU','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','stack','Remitter','HTTP\x20error!\x20status:\x20','TesSoft\x20Payment\x20System/1.0','Status\x20Text:','256LzFpNU','Missing\x20id\x20or\x20shortLink\x20in\x20response','entries','SettlementDate','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','2461915OZClsR','logWhiteDomainRequest','log','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','===\x20NODA\x20SERVICE\x20ERROR\x20===','shortLinkUrls','defineProperty','Status','Name','PAID','JSON\x20Parse\x20Error:\x20','Business\x20Error:\x20','done','loggerService','Response\x20Time:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','amount','4317INcwtK','(8digits-8digits\x20format)','paid','apiUrl','Error\x20message:','===\x20NODA\x20API\x20ERROR\x20===','https://tesoft.uk/gateway/success.php?id=','Parsed\x20Result:','application/json','../loggerService','toLowerCase','Unknown\x20error\x20from\x20Noda\x20API','completed','QR\x20Code\x20Link:','created','Response\x20data:','Failed\x20to\x20parse\x20JSON\x20response:','PENDING','error','text','BankTransactionId','Unknown\x20error','processing','Currency','logWhiteDomainResponse','21868860LvMBLD','URL:','pending','stringify','rejected','status','===\x20NODA\x20SUCCESS\x20===','4FYotsK','Noda\x20API\x20error:\x20','verifyPayment','/payment-links/','Amount','Method','Yes','/payment-links','statusCode','FAILED',',\x20body:\x20','statusText','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','fromEntries','EXPIRED','expiryDate','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','8803323HkiFaN','canceled','shortLink','138jZcEXe','391517wMafar','351148HVeuUn','Payment\x20Link\x20ID:','isActive','parse','Error\x20stack:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Response\x20Body:','currency','Headers:','noda','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Status\x20Code:','https://tesoft.uk/gateway/noda/webhook/','toUpperCase','Settled','logWhiteDomainError','HTTP\x20Status:','GET','json','now','NodaService','__esModule','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid'];a40_0x46d2=function(){return _0x37e081;};return a40_0x46d2();}const loggerService_1=require(a40_0x27b4b1(0x164));class NodaService{constructor(){const _0xf819bf=a40_0x27b4b1;this[_0xf819bf(0x15e)]='https://tesoft.uk/gateway/noda/',console['log'](_0xf819bf(0x13f));}async['createPaymentLink'](_0x1df876){const _0x384ff6=a40_0x27b4b1,{orderId:_0x1a40db,name:_0x3766cd,paymentDescription:_0x58e6ae,amount:_0x28a4f1,currency:_0xac2138,webhookUrl:_0x857882,returnUrl:_0xe91a94,expiryDate:_0x4b711c}=_0x1df876,_0x20ddc9=_0xac2138[_0x384ff6(0x19e)](),_0x41faf6=_0x384ff6(0x19d),_0x2e422d=_0x384ff6(0x161)+_0x1a40db,_0x183388={'name':_0x3766cd,'paymentDescription':_0x58e6ae,'amount':_0x28a4f1,'currency':_0x20ddc9,'paymentId':_0x1a40db,'webhookUrl':_0x41faf6,'returnUrl':_0x2e422d};_0x4b711c&&(_0x183388[_0x384ff6(0x18a)]=_0x4b711c);const _0x3a97f7=Date['now']();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x384ff6(0x14c)](_0x384ff6(0x175),this['apiUrl']),console[_0x384ff6(0x14c)](_0x384ff6(0x1af),JSON[_0x384ff6(0x177)](_0x183388,null,0x2)),console['log'](_0x384ff6(0x1ac),_0x1a40db,_0x384ff6(0x13d)),loggerService_1['loggerService'][_0x384ff6(0x14b)]('noda',_0x384ff6(0x182),_0x384ff6(0x13c),_0x183388);const _0x269306=await fetch(this[_0x384ff6(0x15e)],{'method':_0x384ff6(0x13c),'headers':{'Content-Type':_0x384ff6(0x163),'Accept':_0x384ff6(0x163),'User-Agent':_0x384ff6(0x143)},'body':JSON[_0x384ff6(0x177)](_0x183388)}),_0x1ae3be=Date[_0x384ff6(0x1a4)]()-_0x3a97f7;console[_0x384ff6(0x14c)](_0x384ff6(0x1b0)),console[_0x384ff6(0x14c)]('Status:',_0x269306[_0x384ff6(0x179)]),console[_0x384ff6(0x14c)](_0x384ff6(0x144),_0x269306[_0x384ff6(0x186)]),console['log'](_0x384ff6(0x199),Object[_0x384ff6(0x188)](_0x269306['headers'][_0x384ff6(0x147)]())),console['log'](_0x384ff6(0x158),_0x1ae3be+'ms');const _0x2b2e9a=await _0x269306[_0x384ff6(0x16e)]();console[_0x384ff6(0x14c)](_0x384ff6(0x1aa),_0x2b2e9a);if(!_0x269306['ok']){console[_0x384ff6(0x16d)](_0x384ff6(0x160)),console[_0x384ff6(0x16d)](_0x384ff6(0x1a1),_0x269306['status']),console[_0x384ff6(0x16d)](_0x384ff6(0x197),_0x2b2e9a),loggerService_1[_0x384ff6(0x157)][_0x384ff6(0x173)](_0x384ff6(0x19a),_0x384ff6(0x182),_0x269306[_0x384ff6(0x179)],_0x2b2e9a,_0x1ae3be),loggerService_1[_0x384ff6(0x157)][_0x384ff6(0x1a0)](_0x384ff6(0x19a),_0x384ff6(0x182),'HTTP\x20'+_0x269306['status']+':\x20'+_0x2b2e9a);if(_0x269306['status']===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x269306['status']===0x1f4)throw new Error(_0x384ff6(0x1a7));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x269306[_0x384ff6(0x179)]+_0x384ff6(0x185)+_0x2b2e9a);}let _0x568f3b;try{_0x568f3b=JSON[_0x384ff6(0x194)](_0x2b2e9a);}catch(_0x4a0355){console[_0x384ff6(0x16d)](_0x384ff6(0x16b),_0x4a0355),loggerService_1[_0x384ff6(0x157)][_0x384ff6(0x1a0)](_0x384ff6(0x19a),'/payment-links',_0x384ff6(0x154)+_0x4a0355);throw new Error(_0x384ff6(0x14d)+_0x2b2e9a);}console[_0x384ff6(0x14c)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x384ff6(0x14c)](_0x384ff6(0x162),JSON['stringify'](_0x568f3b,null,0x2)),loggerService_1[_0x384ff6(0x157)]['logWhiteDomainResponse'](_0x384ff6(0x19a),_0x384ff6(0x182),_0x269306[_0x384ff6(0x179)],_0x568f3b,_0x1ae3be);if(_0x568f3b[_0x384ff6(0x16d)]||_0x568f3b[_0x384ff6(0x183)]){const _0x2ad356=_0x568f3b['message']||_0x568f3b[_0x384ff6(0x16d)]||_0x384ff6(0x166);console[_0x384ff6(0x16d)](_0x384ff6(0x159)),console[_0x384ff6(0x16d)](_0x384ff6(0x1ae),_0x2ad356),console[_0x384ff6(0x16d)](_0x384ff6(0x19c),_0x568f3b[_0x384ff6(0x183)]),loggerService_1[_0x384ff6(0x157)][_0x384ff6(0x1a0)](_0x384ff6(0x19a),_0x384ff6(0x182),_0x384ff6(0x155)+_0x2ad356);throw new Error(_0x384ff6(0x17c)+_0x2ad356);}if(!_0x568f3b['id']||!_0x568f3b[_0x384ff6(0x14f)]?.[_0x384ff6(0x18e)]){console[_0x384ff6(0x16d)](_0x384ff6(0x149)),console['error'](_0x384ff6(0x146)),console[_0x384ff6(0x16d)](_0x384ff6(0x16a),_0x568f3b),loggerService_1['loggerService'][_0x384ff6(0x1a0)]('noda',_0x384ff6(0x182),_0x384ff6(0x19b));throw new Error(_0x384ff6(0x196));}return console[_0x384ff6(0x14c)](_0x384ff6(0x17a)),console[_0x384ff6(0x14c)](_0x384ff6(0x192),_0x568f3b['id']),console[_0x384ff6(0x14c)]('Short\x20Link:',_0x568f3b[_0x384ff6(0x14f)][_0x384ff6(0x18e)]),console[_0x384ff6(0x14c)](_0x384ff6(0x168),_0x568f3b['shortLinkUrls'][_0x384ff6(0x1a9)]||'Not\x20provided'),console['log']('Order\x20ID\x20Used:',_0x1a40db,_0x384ff6(0x15c)),{'gateway_payment_id':_0x568f3b['id'],'payment_url':_0x568f3b[_0x384ff6(0x14f)][_0x384ff6(0x18e)],'qr_code_url':_0x568f3b['shortLinkUrls'][_0x384ff6(0x1a9)],'expiry_date':_0x568f3b[_0x384ff6(0x18a)]};}catch(_0x424eea){console[_0x384ff6(0x16d)](_0x384ff6(0x14e)),console[_0x384ff6(0x16d)](_0x384ff6(0x1b1),_0x424eea),loggerService_1[_0x384ff6(0x157)]['logWhiteDomainError']('noda','/payment-links',_0x424eea);if(_0x424eea instanceof Error){console[_0x384ff6(0x16d)](_0x384ff6(0x15f),_0x424eea[_0x384ff6(0x1a8)]),console[_0x384ff6(0x16d)](_0x384ff6(0x195),_0x424eea[_0x384ff6(0x140)]);throw new Error(_0x384ff6(0x18b)+_0x424eea[_0x384ff6(0x1a8)]);}throw new Error(_0x384ff6(0x187));}}async[a40_0x27b4b1(0x17d)](_0x20720f){const _0x22aa91=a40_0x27b4b1,_0x5ca731=Date['now']();try{loggerService_1[_0x22aa91(0x157)]['logWhiteDomainRequest']('noda',_0x22aa91(0x17e)+_0x20720f,'GET',{});const _0x274079=await fetch(this[_0x22aa91(0x15e)]+'/'+_0x20720f,{'method':_0x22aa91(0x1a2),'headers':{'Content-Type':'application/json','User-Agent':_0x22aa91(0x143)}}),_0x264350=Date[_0x22aa91(0x1a4)]()-_0x5ca731;if(!_0x274079['ok']){const _0x47fa70=await _0x274079[_0x22aa91(0x16e)]();loggerService_1[_0x22aa91(0x157)]['logWhiteDomainResponse'](_0x22aa91(0x19a),_0x22aa91(0x17e)+_0x20720f,_0x274079[_0x22aa91(0x179)],_0x47fa70,_0x264350);throw new Error(_0x22aa91(0x142)+_0x274079[_0x22aa91(0x179)]);}const _0x33233e=await _0x274079[_0x22aa91(0x1a3)]();loggerService_1[_0x22aa91(0x157)][_0x22aa91(0x173)]('noda',_0x22aa91(0x17e)+_0x20720f,_0x274079[_0x22aa91(0x179)],_0x33233e,_0x264350);if(_0x33233e[_0x22aa91(0x16d)]||_0x33233e[_0x22aa91(0x183)]){loggerService_1[_0x22aa91(0x157)][_0x22aa91(0x1a0)](_0x22aa91(0x19a),_0x22aa91(0x17e)+_0x20720f,'Noda\x20API\x20error:\x20'+(_0x33233e[_0x22aa91(0x1a8)]||_0x33233e[_0x22aa91(0x16d)]||_0x22aa91(0x170)));throw new Error(_0x22aa91(0x17c)+(_0x33233e['message']||_0x33233e[_0x22aa91(0x16d)]||_0x22aa91(0x170)));}let _0x4183f1='PENDING';if(_0x33233e[_0x22aa91(0x193)]===![]){if(_0x33233e[_0x22aa91(0x18a)]){const _0x3e6d01=new Date(_0x33233e[_0x22aa91(0x18a)]),_0x5e73e4=new Date();_0x3e6d01<_0x5e73e4?_0x4183f1='EXPIRED':_0x4183f1=_0x22aa91(0x184);}else _0x4183f1=_0x22aa91(0x184);}else _0x4183f1=_0x22aa91(0x16c);return{'status':_0x4183f1,'amount':_0x33233e[_0x22aa91(0x15a)],'currency':_0x33233e[_0x22aa91(0x198)],'isActive':_0x33233e[_0x22aa91(0x193)]};}catch(_0x3f2d7d){console[_0x22aa91(0x16d)]('Noda\x20payment\x20verification\x20error:',_0x3f2d7d),loggerService_1[_0x22aa91(0x157)][_0x22aa91(0x1a0)]('noda',_0x22aa91(0x17e)+_0x20720f,_0x3f2d7d);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x3f2d7d instanceof Error?_0x3f2d7d['message']:'Unknown\x20error'));}}async['processWebhook'](_0x28ad8f){const _0x4d6d6a=a40_0x27b4b1;console[_0x4d6d6a(0x14c)](_0x4d6d6a(0x1ab),_0x28ad8f);let _0x43cb5e=_0x4d6d6a(0x16c);switch(_0x28ad8f[_0x4d6d6a(0x151)]?.[_0x4d6d6a(0x165)]()){case _0x4d6d6a(0x156):case _0x4d6d6a(0x167):case _0x4d6d6a(0x15d):case'success':case'successful':_0x28ad8f[_0x4d6d6a(0x19f)]===_0x4d6d6a(0x181)?_0x43cb5e=_0x4d6d6a(0x153):_0x43cb5e=_0x4d6d6a(0x16c);break;case'cancelled':case _0x4d6d6a(0x18d):case'failed':case _0x4d6d6a(0x16d):case _0x4d6d6a(0x178):_0x43cb5e=_0x4d6d6a(0x184);break;case'expired':case'timeout':_0x43cb5e=_0x4d6d6a(0x189);break;case _0x4d6d6a(0x176):case _0x4d6d6a(0x169):case'active':case _0x4d6d6a(0x171):case _0x4d6d6a(0x13b):default:_0x43cb5e=_0x4d6d6a(0x16c);break;}return{'paymentId':_0x28ad8f[_0x4d6d6a(0x1ad)]||_0x28ad8f['PaymentId'],'status':_0x43cb5e,'amount':_0x28ad8f[_0x4d6d6a(0x17f)],'currency':_0x28ad8f[_0x4d6d6a(0x172)],'additionalInfo':{'method':_0x28ad8f[_0x4d6d6a(0x180)],'bankId':_0x28ad8f['BankId'],'settled':_0x28ad8f[_0x4d6d6a(0x19f)],'settlementDate':_0x28ad8f[_0x4d6d6a(0x148)],'remitterName':_0x28ad8f[_0x4d6d6a(0x141)]?.[_0x4d6d6a(0x152)],'remitterIban':_0x28ad8f[_0x4d6d6a(0x141)]?.['Iban'],'bankTransactionId':_0x28ad8f[_0x4d6d6a(0x16f)]}};}['verifyWebhookSignature'](_0x3885dc,_0x18375c){const _0x479176=a40_0x27b4b1;return console[_0x479176(0x14c)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x18375c,'paymentId':_0x3885dc['PaymentId'],'merchantPaymentId':_0x3885dc[_0x479176(0x1ad)]}),!![];}}exports[a40_0x27b4b1(0x1a5)]=NodaService;