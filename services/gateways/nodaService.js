'use strict';const a53_0x2f27ea=a53_0x19bb;(function(_0x54b2fd,_0x38bc4c){const _0x145dc1=a53_0x19bb,_0xfcaa18=_0x54b2fd();while(!![]){try{const _0x5c2d8f=parseInt(_0x145dc1(0x9e))/0x1+-parseInt(_0x145dc1(0x93))/0x2+-parseInt(_0x145dc1(0xcf))/0x3*(-parseInt(_0x145dc1(0x87))/0x4)+-parseInt(_0x145dc1(0xde))/0x5+-parseInt(_0x145dc1(0xa7))/0x6+parseInt(_0x145dc1(0xd9))/0x7*(-parseInt(_0x145dc1(0x8b))/0x8)+parseInt(_0x145dc1(0x81))/0x9;if(_0x5c2d8f===_0x38bc4c)break;else _0xfcaa18['push'](_0xfcaa18['shift']());}catch(_0x387015){_0xfcaa18['push'](_0xfcaa18['shift']());}}}(a53_0x24f2,0xe0cd3));function a53_0x24f2(){const _0x4effb6=['__esModule','statusText','MerchantPaymentId','stack','verifyPayment','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Unknown\x20error\x20from\x20Noda\x20API','BankTransactionId','Payment\x20System/1.0','NodaService','HTTP\x20','Currency','Error\x20stack:','Unknown\x20error','apiUrl','Not\x20provided','entries','json','Missing\x20id\x20or\x20shortLink\x20in\x20response','POST','Method','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','log','/payment-links','FAILED','HTTP\x20error!\x20status:\x20','expired','1137iwLCPA','/payment-links/','status','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','loggerService','application/json','(8digits-8digits\x20format)','noda','Parsed\x20Result:','fromEntries','7wpWSLm','Business\x20Error:\x20','Remitter','processing','Response\x20Time:','356285XshWuP','Noda\x20payment\x20verification\x20error:','Request\x20Body\x20(Direct\x20JSON):','===\x20PARSED\x20NODA\x20RESPONSE\x20===','logWhiteDomainError','shortLinkUrls','Payment\x20Link\x20ID:','Raw\x20Response\x20Body:','Error\x20details:','EXPIRED','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Status','(8digits-8digits\x20format\x20for\x20Noda)','Iban','qrCodeLink','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','pending','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','PaymentId','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Status:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','paid','Yes','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','===\x20NODA\x20SUCCESS\x20===','Short\x20Link:','active','isActive','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Amount','logWhiteDomainResponse','3566673iMrGPu','Error\x20Message:','statusCode','in_progress','done','toLowerCase','18988BuKOMp','failed','JSON\x20Parse\x20Error:\x20','===\x20NODA\x20API\x20ERROR\x20===','5108432FisLCd','logWhiteDomainRequest','timeout','Status\x20Code:','stringify','canceled',',\x20body:\x20','https://tesoft.uk/gateway/noda/','657708vMsBHv','Noda\x20webhook\x20signature\x20verification:','BankId','parse','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','message','QR\x20Code\x20Link:','rejected','Settled','https://tesoft.uk/gateway/noda/webhook/','Name','1395901HyTduU','processWebhook','Noda\x20API\x20error:\x20','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Processing\x20Noda\x20webhook:','HTTP\x20Status:','PAID','headers','PENDING','9791154KRUYon','shortLink','created','Error\x20message:','now','successful','text','Response\x20data:','error','amount','expiryDate','Failed\x20to\x20parse\x20JSON\x20response:','Response\x20Body:'];a53_0x24f2=function(){return _0x4effb6;};return a53_0x24f2();}function a53_0x19bb(_0x1a4bd4,_0x38fbea){const _0x24f2ca=a53_0x24f2();return a53_0x19bb=function(_0x19bbfb,_0x14e038){_0x19bbfb=_0x19bbfb-0x7c;let _0x3a8025=_0x24f2ca[_0x19bbfb];return _0x3a8025;},a53_0x19bb(_0x1a4bd4,_0x38fbea);}Object['defineProperty'](exports,a53_0x2f27ea(0xb4),{'value':!![]}),exports[a53_0x2f27ea(0xbd)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x385b7f=a53_0x2f27ea;this[_0x385b7f(0xc2)]=_0x385b7f(0x92),console[_0x385b7f(0xca)](_0x385b7f(0xb9));}async['createPaymentLink'](_0x51e804){const _0x498a3c=a53_0x2f27ea,{orderId:_0x57ac8f,name:_0x1dc59b,paymentDescription:_0x3c3d8c,amount:_0x377804,currency:_0x25807d,webhookUrl:_0x354ea5,returnUrl:_0x39e0ee,expiryDate:_0x431e47}=_0x51e804,_0x1b0676=_0x25807d['toUpperCase'](),_0x29ec85=_0x498a3c(0x9c),_0x1a0ea4='https://tesoft.uk/gateway/pending.php?id='+_0x57ac8f,_0x123a6d={'name':_0x1dc59b,'paymentDescription':_0x3c3d8c,'amount':_0x377804,'currency':_0x1b0676,'paymentId':_0x57ac8f,'webhookUrl':_0x29ec85,'returnUrl':_0x1a0ea4};_0x431e47&&(_0x123a6d[_0x498a3c(0xb1)]=_0x431e47);const _0x4a94ec=Date[_0x498a3c(0xab)]();try{console['log'](_0x498a3c(0x97)),console[_0x498a3c(0xca)]('URL:',this[_0x498a3c(0xc2)]),console['log'](_0x498a3c(0xe0),JSON[_0x498a3c(0x8f)](_0x123a6d,null,0x2)),console[_0x498a3c(0xca)]('Order\x20ID\x20Format:',_0x57ac8f,_0x498a3c(0xea)),console['log'](_0x498a3c(0xa1),_0x1a0ea4),loggerService_1['loggerService'][_0x498a3c(0x8c)](_0x498a3c(0xd6),_0x498a3c(0xcb),_0x498a3c(0xc7),_0x123a6d);const _0x334e47=await fetch(this[_0x498a3c(0xc2)],{'method':_0x498a3c(0xc7),'headers':{'Content-Type':_0x498a3c(0xd4),'Accept':_0x498a3c(0xd4),'User-Agent':_0x498a3c(0xbc)},'body':JSON['stringify'](_0x123a6d)}),_0xe6d11e=Date[_0x498a3c(0xab)]()-_0x4a94ec;console[_0x498a3c(0xca)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x498a3c(0xf2),_0x334e47['status']),console['log']('Status\x20Text:',_0x334e47[_0x498a3c(0xb5)]),console['log']('Headers:',Object[_0x498a3c(0xd8)](_0x334e47[_0x498a3c(0xa5)][_0x498a3c(0xc4)]())),console[_0x498a3c(0xca)](_0x498a3c(0xdd),_0xe6d11e+'ms');const _0xb65827=await _0x334e47[_0x498a3c(0xad)]();console['log'](_0x498a3c(0xe5),_0xb65827);if(!_0x334e47['ok']){console['error'](_0x498a3c(0x8a)),console['error'](_0x498a3c(0xa3),_0x334e47[_0x498a3c(0xd1)]),console[_0x498a3c(0xaf)](_0x498a3c(0xb3),_0xb65827),loggerService_1[_0x498a3c(0xd3)][_0x498a3c(0x80)](_0x498a3c(0xd6),_0x498a3c(0xcb),_0x334e47[_0x498a3c(0xd1)],_0xb65827,_0xe6d11e),loggerService_1[_0x498a3c(0xd3)][_0x498a3c(0xe2)]('noda',_0x498a3c(0xcb),_0x498a3c(0xbe)+_0x334e47[_0x498a3c(0xd1)]+':\x20'+_0xb65827);if(_0x334e47[_0x498a3c(0xd1)]===0x190)throw new Error(_0x498a3c(0xf6));else{if(_0x334e47[_0x498a3c(0xd1)]===0x1f4)throw new Error(_0x498a3c(0xf3));}throw new Error(_0x498a3c(0xcd)+_0x334e47['status']+_0x498a3c(0x91)+_0xb65827);}let _0x5a1653;try{_0x5a1653=JSON[_0x498a3c(0x96)](_0xb65827);}catch(_0x32feab){console[_0x498a3c(0xaf)](_0x498a3c(0xb2),_0x32feab),loggerService_1[_0x498a3c(0xd3)][_0x498a3c(0xe2)]('noda',_0x498a3c(0xcb),_0x498a3c(0x89)+_0x32feab);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0xb65827);}console['log'](_0x498a3c(0xe1)),console[_0x498a3c(0xca)](_0x498a3c(0xd7),JSON[_0x498a3c(0x8f)](_0x5a1653,null,0x2)),loggerService_1[_0x498a3c(0xd3)][_0x498a3c(0x80)](_0x498a3c(0xd6),_0x498a3c(0xcb),_0x334e47[_0x498a3c(0xd1)],_0x5a1653,_0xe6d11e);if(_0x5a1653['error']||_0x5a1653[_0x498a3c(0x83)]){const _0x379909=_0x5a1653['message']||_0x5a1653['error']||_0x498a3c(0xba);console['error']('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x498a3c(0xaf)](_0x498a3c(0x82),_0x379909),console[_0x498a3c(0xaf)](_0x498a3c(0x8e),_0x5a1653['statusCode']),loggerService_1['loggerService'][_0x498a3c(0xe2)](_0x498a3c(0xd6),'/payment-links',_0x498a3c(0xda)+_0x379909);throw new Error(_0x498a3c(0xa0)+_0x379909);}if(!_0x5a1653['id']||!_0x5a1653[_0x498a3c(0xe3)]?.['shortLink']){console[_0x498a3c(0xaf)](_0x498a3c(0xd2)),console[_0x498a3c(0xaf)](_0x498a3c(0xc6)),console[_0x498a3c(0xaf)](_0x498a3c(0xae),_0x5a1653),loggerService_1[_0x498a3c(0xd3)]['logWhiteDomainError']('noda',_0x498a3c(0xcb),_0x498a3c(0xed));throw new Error(_0x498a3c(0xe8));}return console[_0x498a3c(0xca)](_0x498a3c(0xf7)),console[_0x498a3c(0xca)](_0x498a3c(0xe4),_0x5a1653['id']),console[_0x498a3c(0xca)](_0x498a3c(0xf8),_0x5a1653['shortLinkUrls'][_0x498a3c(0xa8)]),console[_0x498a3c(0xca)](_0x498a3c(0x99),_0x5a1653['shortLinkUrls']['qrCodeLink']||_0x498a3c(0xc3)),console[_0x498a3c(0xca)]('Order\x20ID\x20Used:',_0x57ac8f,_0x498a3c(0xd5)),console[_0x498a3c(0xca)](_0x498a3c(0xef),_0x1a0ea4),{'gateway_payment_id':_0x5a1653['id'],'payment_url':_0x5a1653[_0x498a3c(0xe3)][_0x498a3c(0xa8)],'qr_code_url':_0x5a1653[_0x498a3c(0xe3)][_0x498a3c(0xec)],'expiry_date':_0x5a1653[_0x498a3c(0xb1)]};}catch(_0x220413){console[_0x498a3c(0xaf)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x498a3c(0xaf)](_0x498a3c(0xe6),_0x220413),loggerService_1[_0x498a3c(0xd3)][_0x498a3c(0xe2)](_0x498a3c(0xd6),_0x498a3c(0xcb),_0x220413);if(_0x220413 instanceof Error){console['error'](_0x498a3c(0xaa),_0x220413['message']),console[_0x498a3c(0xaf)](_0x498a3c(0xc0),_0x220413[_0x498a3c(0xb7)]);throw new Error(_0x498a3c(0xc9)+_0x220413[_0x498a3c(0x98)]);}throw new Error(_0x498a3c(0x7e));}}async[a53_0x2f27ea(0xb8)](_0x10d04d){const _0x50f58b=a53_0x2f27ea,_0x27c761=Date[_0x50f58b(0xab)]();try{loggerService_1['loggerService'][_0x50f58b(0x8c)](_0x50f58b(0xd6),_0x50f58b(0xd0)+_0x10d04d,'GET',{});const _0xf350a7=await fetch(this[_0x50f58b(0xc2)]+'/'+_0x10d04d,{'method':'GET','headers':{'Content-Type':_0x50f58b(0xd4),'User-Agent':_0x50f58b(0xbc)}}),_0x1c9f75=Date[_0x50f58b(0xab)]()-_0x27c761;if(!_0xf350a7['ok']){const _0x429b6d=await _0xf350a7['text']();loggerService_1[_0x50f58b(0xd3)]['logWhiteDomainResponse'](_0x50f58b(0xd6),_0x50f58b(0xd0)+_0x10d04d,_0xf350a7['status'],_0x429b6d,_0x1c9f75);throw new Error(_0x50f58b(0xcd)+_0xf350a7[_0x50f58b(0xd1)]);}const _0x1b1530=await _0xf350a7[_0x50f58b(0xc5)]();loggerService_1[_0x50f58b(0xd3)][_0x50f58b(0x80)](_0x50f58b(0xd6),'/payment-links/'+_0x10d04d,_0xf350a7[_0x50f58b(0xd1)],_0x1b1530,_0x1c9f75);if(_0x1b1530[_0x50f58b(0xaf)]||_0x1b1530[_0x50f58b(0x83)]){loggerService_1[_0x50f58b(0xd3)][_0x50f58b(0xe2)](_0x50f58b(0xd6),_0x50f58b(0xd0)+_0x10d04d,_0x50f58b(0xa0)+(_0x1b1530['message']||_0x1b1530[_0x50f58b(0xaf)]||_0x50f58b(0xc1)));throw new Error(_0x50f58b(0xa0)+(_0x1b1530[_0x50f58b(0x98)]||_0x1b1530[_0x50f58b(0xaf)]||_0x50f58b(0xc1)));}let _0x30d9b0=_0x50f58b(0xa6);if(_0x1b1530[_0x50f58b(0x7d)]===![]){if(_0x1b1530[_0x50f58b(0xb1)]){const _0x467799=new Date(_0x1b1530['expiryDate']),_0x3acabb=new Date();_0x467799<_0x3acabb?_0x30d9b0=_0x50f58b(0xe7):_0x30d9b0='FAILED';}else _0x30d9b0=_0x50f58b(0xcc);}else _0x30d9b0='PENDING';return{'status':_0x30d9b0,'amount':_0x1b1530[_0x50f58b(0xb0)],'currency':_0x1b1530['currency'],'isActive':_0x1b1530['isActive']};}catch(_0x5bfb5e){console[_0x50f58b(0xaf)](_0x50f58b(0xdf),_0x5bfb5e),loggerService_1[_0x50f58b(0xd3)][_0x50f58b(0xe2)]('noda',_0x50f58b(0xd0)+_0x10d04d,_0x5bfb5e);throw new Error(_0x50f58b(0xf1)+(_0x5bfb5e instanceof Error?_0x5bfb5e[_0x50f58b(0x98)]:_0x50f58b(0xc1)));}}async[a53_0x2f27ea(0x9f)](_0x3042ea){const _0x3bb104=a53_0x2f27ea;console[_0x3bb104(0xca)](_0x3bb104(0xa2),_0x3042ea);let _0x418de4=_0x3bb104(0xa6);switch(_0x3042ea[_0x3bb104(0xe9)]?.[_0x3bb104(0x86)]()){case _0x3bb104(0x85):case'completed':case _0x3bb104(0xf4):case'success':case _0x3bb104(0xac):_0x3042ea[_0x3bb104(0x9b)]===_0x3bb104(0xf5)?_0x418de4=_0x3bb104(0xa4):_0x418de4=_0x3bb104(0xa6);break;case'cancelled':case _0x3bb104(0x90):case _0x3bb104(0x88):case _0x3bb104(0xaf):case _0x3bb104(0x9a):_0x418de4=_0x3bb104(0xcc);break;case _0x3bb104(0xce):case _0x3bb104(0x8d):_0x418de4='EXPIRED';break;case _0x3bb104(0xee):case _0x3bb104(0xa9):case _0x3bb104(0x7c):case _0x3bb104(0xdc):case _0x3bb104(0x84):default:_0x418de4='PENDING';break;}return{'paymentId':_0x3042ea['MerchantPaymentId']||_0x3042ea['PaymentId'],'status':_0x418de4,'amount':_0x3042ea[_0x3bb104(0x7f)],'currency':_0x3042ea[_0x3bb104(0xbf)],'additionalInfo':{'method':_0x3042ea[_0x3bb104(0xc8)],'bankId':_0x3042ea[_0x3bb104(0x95)],'settled':_0x3042ea['Settled'],'settlementDate':_0x3042ea['SettlementDate'],'remitterName':_0x3042ea[_0x3bb104(0xdb)]?.[_0x3bb104(0x9d)],'remitterIban':_0x3042ea['Remitter']?.[_0x3bb104(0xeb)],'bankTransactionId':_0x3042ea[_0x3bb104(0xbb)]}};}['verifyWebhookSignature'](_0x46a57f,_0xb772ca){const _0x1cdf6b=a53_0x2f27ea;return console[_0x1cdf6b(0xca)](_0x1cdf6b(0x94),{'receivedSignature':_0xb772ca,'paymentId':_0x46a57f[_0x1cdf6b(0xf0)],'merchantPaymentId':_0x46a57f[_0x1cdf6b(0xb6)]}),!![];}}exports[a53_0x2f27ea(0xbd)]=NodaService;