'use strict';const a46_0x1bdd70=a46_0x3a3a;(function(_0x17b8b5,_0x32fe0a){const _0x24d573=a46_0x3a3a,_0xcca125=_0x17b8b5();while(!![]){try{const _0x1606df=-parseInt(_0x24d573(0xc5))/0x1*(parseInt(_0x24d573(0x95))/0x2)+parseInt(_0x24d573(0xaa))/0x3*(parseInt(_0x24d573(0xdd))/0x4)+parseInt(_0x24d573(0xdf))/0x5*(parseInt(_0x24d573(0xd4))/0x6)+-parseInt(_0x24d573(0xc9))/0x7*(-parseInt(_0x24d573(0xe3))/0x8)+parseInt(_0x24d573(0xf3))/0x9+-parseInt(_0x24d573(0x90))/0xa+-parseInt(_0x24d573(0x98))/0xb*(parseInt(_0x24d573(0xde))/0xc);if(_0x1606df===_0x32fe0a)break;else _0xcca125['push'](_0xcca125['shift']());}catch(_0x4409a3){_0xcca125['push'](_0xcca125['shift']());}}}(a46_0x16b6,0xddc48));function a46_0x16b6(){const _0x1447b0=['Business\x20Error:\x20','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','cancelled','Response\x20Body:','failed','stringify','HTTP\x20','NodaService','URL:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Parsed\x20Result:','HTTP\x20error!\x20status:\x20','error','active','amount','/payment-links/','stack','isActive','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Error\x20message:','https://tesoft.uk/gateway/pending.php?id=','Order\x20ID\x20Used:','MerchantPaymentId','Currency','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','230474CvXjig','TesSoft\x20Payment\x20System/1.0','paid','PENDING','6952890zxDWEC','Noda\x20payment\x20verification\x20error:','EXPIRED','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','expired','logWhiteDomainResponse','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','toUpperCase','Error\x20Message:','defineProperty','===\x20PARSED\x20NODA\x20RESPONSE\x20===','6fPpKFI','currency','GET','Unknown\x20error','apiUrl','(8digits-8digits\x20format\x20for\x20Noda)','Iban','logWhiteDomainError','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','6590648DBrfJX','1374456FNdGJE','5607970WssBOF','JSON\x20Parse\x20Error:\x20','verifyWebhookSignature','application/json','8jdTGFI','===\x20NODA\x20SUCCESS\x20===','pending','statusCode','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Settled','Not\x20provided','Error\x20stack:','Name','status','Method','verifyPayment','fromEntries','text','Yes','logWhiteDomainRequest','10225539vBRVxV','entries','noda','https://tesoft.uk/gateway/noda/','BankTransactionId','toLowerCase','loggerService','message','QR\x20Code\x20Link:','completed','../loggerService','shortLink','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','expiryDate','parse','Short\x20Link:','successful','createPaymentLink','now','SettlementDate','success','in_progress','Status:','6659390ftXxPT','Failed\x20to\x20parse\x20JSON\x20response:','/payment-links','log','created','4hFQozP','json','canceled','275QNrbtp','headers',',\x20body:\x20','Status\x20Text:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','POST','shortLinkUrls','timeout','Request\x20Body\x20(Direct\x20JSON):','Payment\x20Link\x20ID:','Noda\x20webhook\x20signature\x20verification:','qrCodeLink','PaymentId','statusText','Order\x20ID\x20Format:','FAILED','Remitter','Response\x20data:','3KcwkkK','Response\x20Time:'];a46_0x16b6=function(){return _0x1447b0;};return a46_0x16b6();}function a46_0x3a3a(_0x4ab573,_0x883176){const _0x16b605=a46_0x16b6();return a46_0x3a3a=function(_0x3a3a40,_0x58a6bb){_0x3a3a40=_0x3a3a40-0x8c;let _0x342d58=_0x16b605[_0x3a3a40];return _0x342d58;},a46_0x3a3a(_0x4ab573,_0x883176);}Object[a46_0x1bdd70(0xd2)](exports,'__esModule',{'value':!![]}),exports[a46_0x1bdd70(0xb3)]=void 0x0;const loggerService_1=require(a46_0x1bdd70(0xfd));class NodaService{constructor(){const _0xaea61f=a46_0x1bdd70;this[_0xaea61f(0xd8)]=_0xaea61f(0xf6),console[_0xaea61f(0x93)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a46_0x1bdd70(0x104)](_0x4c78f1){const _0x4d2d24=a46_0x1bdd70,{orderId:_0x2e18dd,name:_0x3de29b,paymentDescription:_0xfc9fb3,amount:_0x55546c,currency:_0x34bff5,webhookUrl:_0x335505,returnUrl:_0x19d861,expiryDate:_0x2d7f93}=_0x4c78f1,_0x4457a0=_0x34bff5[_0x4d2d24(0xd0)](),_0x39363e='https://tesoft.uk/gateway/noda/webhook/',_0x3eccef=_0x4d2d24(0xc0)+_0x2e18dd,_0x3ce03a={'name':_0x3de29b,'paymentDescription':_0xfc9fb3,'amount':_0x55546c,'currency':_0x4457a0,'paymentId':_0x2e18dd,'webhookUrl':_0x39363e,'returnUrl':_0x3eccef};_0x2d7f93&&(_0x3ce03a[_0x4d2d24(0x100)]=_0x2d7f93);const _0x4b01e7=Date[_0x4d2d24(0x105)]();try{console[_0x4d2d24(0x93)](_0x4d2d24(0xff)),console[_0x4d2d24(0x93)](_0x4d2d24(0xb4),this[_0x4d2d24(0xd8)]),console['log'](_0x4d2d24(0xa0),JSON[_0x4d2d24(0xb1)](_0x3ce03a,null,0x2)),console[_0x4d2d24(0x93)](_0x4d2d24(0xa6),_0x2e18dd,_0x4d2d24(0xd9)),console[_0x4d2d24(0x93)](_0x4d2d24(0xcf),_0x3eccef),loggerService_1[_0x4d2d24(0xf9)][_0x4d2d24(0xf2)](_0x4d2d24(0xf5),_0x4d2d24(0x92),'POST',_0x3ce03a);const _0xd453c7=await fetch(this[_0x4d2d24(0xd8)],{'method':_0x4d2d24(0x9d),'headers':{'Content-Type':_0x4d2d24(0xe2),'Accept':_0x4d2d24(0xe2),'User-Agent':_0x4d2d24(0xc6)},'body':JSON[_0x4d2d24(0xb1)](_0x3ce03a)}),_0x4fd5de=Date[_0x4d2d24(0x105)]()-_0x4b01e7;console[_0x4d2d24(0x93)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x4d2d24(0x93)](_0x4d2d24(0x8f),_0xd453c7[_0x4d2d24(0xec)]),console[_0x4d2d24(0x93)](_0x4d2d24(0x9b),_0xd453c7[_0x4d2d24(0xa5)]),console[_0x4d2d24(0x93)]('Headers:',Object[_0x4d2d24(0xef)](_0xd453c7[_0x4d2d24(0x99)][_0x4d2d24(0xf4)]())),console[_0x4d2d24(0x93)](_0x4d2d24(0xab),_0x4fd5de+'ms');const _0xdac142=await _0xd453c7[_0x4d2d24(0xf0)]();console[_0x4d2d24(0x93)]('Raw\x20Response\x20Body:',_0xdac142);if(!_0xd453c7['ok']){console[_0x4d2d24(0xb8)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x4d2d24(0xb8)]('HTTP\x20Status:',_0xd453c7['status']),console[_0x4d2d24(0xb8)](_0x4d2d24(0xaf),_0xdac142),loggerService_1[_0x4d2d24(0xf9)][_0x4d2d24(0xce)](_0x4d2d24(0xf5),_0x4d2d24(0x92),_0xd453c7['status'],_0xdac142,_0x4fd5de),loggerService_1[_0x4d2d24(0xf9)]['logWhiteDomainError'](_0x4d2d24(0xf5),_0x4d2d24(0x92),_0x4d2d24(0xb2)+_0xd453c7[_0x4d2d24(0xec)]+':\x20'+_0xdac142);if(_0xd453c7[_0x4d2d24(0xec)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0xd453c7['status']===0x1f4)throw new Error(_0x4d2d24(0xcc));}throw new Error(_0x4d2d24(0xb7)+_0xd453c7[_0x4d2d24(0xec)]+_0x4d2d24(0x9a)+_0xdac142);}let _0x463fcf;try{_0x463fcf=JSON[_0x4d2d24(0x101)](_0xdac142);}catch(_0x4108eb){console[_0x4d2d24(0xb8)](_0x4d2d24(0x91),_0x4108eb),loggerService_1[_0x4d2d24(0xf9)][_0x4d2d24(0xdb)]('noda',_0x4d2d24(0x92),_0x4d2d24(0xe0)+_0x4108eb);throw new Error(_0x4d2d24(0xbe)+_0xdac142);}console[_0x4d2d24(0x93)](_0x4d2d24(0xd3)),console['log'](_0x4d2d24(0xb6),JSON[_0x4d2d24(0xb1)](_0x463fcf,null,0x2)),loggerService_1[_0x4d2d24(0xf9)]['logWhiteDomainResponse']('noda',_0x4d2d24(0x92),_0xd453c7['status'],_0x463fcf,_0x4fd5de);if(_0x463fcf[_0x4d2d24(0xb8)]||_0x463fcf['statusCode']){const _0x54f2c1=_0x463fcf[_0x4d2d24(0xfa)]||_0x463fcf[_0x4d2d24(0xb8)]||'Unknown\x20error\x20from\x20Noda\x20API';console['error'](_0x4d2d24(0xad)),console[_0x4d2d24(0xb8)](_0x4d2d24(0xd1),_0x54f2c1),console['error']('Status\x20Code:',_0x463fcf[_0x4d2d24(0xe6)]),loggerService_1[_0x4d2d24(0xf9)]['logWhiteDomainError'](_0x4d2d24(0xf5),'/payment-links',_0x4d2d24(0xac)+_0x54f2c1);throw new Error('Noda\x20API\x20error:\x20'+_0x54f2c1);}if(!_0x463fcf['id']||!_0x463fcf['shortLinkUrls']?.[_0x4d2d24(0xfe)]){console['error'](_0x4d2d24(0xc4)),console[_0x4d2d24(0xb8)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x4d2d24(0xb8)](_0x4d2d24(0xa9),_0x463fcf),loggerService_1[_0x4d2d24(0xf9)][_0x4d2d24(0xdb)](_0x4d2d24(0xf5),_0x4d2d24(0x92),_0x4d2d24(0x9c));throw new Error(_0x4d2d24(0xb5));}return console['log'](_0x4d2d24(0xe4)),console[_0x4d2d24(0x93)](_0x4d2d24(0xa1),_0x463fcf['id']),console[_0x4d2d24(0x93)](_0x4d2d24(0x102),_0x463fcf['shortLinkUrls'][_0x4d2d24(0xfe)]),console[_0x4d2d24(0x93)](_0x4d2d24(0xfb),_0x463fcf[_0x4d2d24(0x9e)]['qrCodeLink']||_0x4d2d24(0xe9)),console[_0x4d2d24(0x93)](_0x4d2d24(0xc1),_0x2e18dd,'(8digits-8digits\x20format)'),console[_0x4d2d24(0x93)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x3eccef),{'gateway_payment_id':_0x463fcf['id'],'payment_url':_0x463fcf[_0x4d2d24(0x9e)][_0x4d2d24(0xfe)],'qr_code_url':_0x463fcf[_0x4d2d24(0x9e)][_0x4d2d24(0xa3)],'expiry_date':_0x463fcf['expiryDate']};}catch(_0x22df9e){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x4d2d24(0xb8)]('Error\x20details:',_0x22df9e),loggerService_1['loggerService'][_0x4d2d24(0xdb)]('noda','/payment-links',_0x22df9e);if(_0x22df9e instanceof Error){console[_0x4d2d24(0xb8)](_0x4d2d24(0xbf),_0x22df9e[_0x4d2d24(0xfa)]),console[_0x4d2d24(0xb8)](_0x4d2d24(0xea),_0x22df9e[_0x4d2d24(0xbc)]);throw new Error(_0x4d2d24(0xdc)+_0x22df9e[_0x4d2d24(0xfa)]);}throw new Error(_0x4d2d24(0xe7));}}async[a46_0x1bdd70(0xee)](_0x1e8904){const _0x3d639b=a46_0x1bdd70,_0x47ecb5=Date[_0x3d639b(0x105)]();try{loggerService_1['loggerService'][_0x3d639b(0xf2)]('noda',_0x3d639b(0xbb)+_0x1e8904,_0x3d639b(0xd6),{});const _0x4502df=await fetch(this['apiUrl']+'/'+_0x1e8904,{'method':_0x3d639b(0xd6),'headers':{'Content-Type':_0x3d639b(0xe2),'User-Agent':_0x3d639b(0xc6)}}),_0x12ad0b=Date['now']()-_0x47ecb5;if(!_0x4502df['ok']){const _0x449730=await _0x4502df[_0x3d639b(0xf0)]();loggerService_1[_0x3d639b(0xf9)][_0x3d639b(0xce)](_0x3d639b(0xf5),_0x3d639b(0xbb)+_0x1e8904,_0x4502df['status'],_0x449730,_0x12ad0b);throw new Error(_0x3d639b(0xb7)+_0x4502df[_0x3d639b(0xec)]);}const _0x5626fd=await _0x4502df[_0x3d639b(0x96)]();loggerService_1['loggerService'][_0x3d639b(0xce)](_0x3d639b(0xf5),_0x3d639b(0xbb)+_0x1e8904,_0x4502df['status'],_0x5626fd,_0x12ad0b);if(_0x5626fd[_0x3d639b(0xb8)]||_0x5626fd[_0x3d639b(0xe6)]){loggerService_1['loggerService'][_0x3d639b(0xdb)](_0x3d639b(0xf5),_0x3d639b(0xbb)+_0x1e8904,'Noda\x20API\x20error:\x20'+(_0x5626fd['message']||_0x5626fd[_0x3d639b(0xb8)]||_0x3d639b(0xd7)));throw new Error('Noda\x20API\x20error:\x20'+(_0x5626fd['message']||_0x5626fd['error']||_0x3d639b(0xd7)));}let _0x51814b=_0x3d639b(0xc8);if(_0x5626fd[_0x3d639b(0xbd)]===![]){if(_0x5626fd[_0x3d639b(0x100)]){const _0x3fcfef=new Date(_0x5626fd[_0x3d639b(0x100)]),_0x594293=new Date();_0x3fcfef<_0x594293?_0x51814b=_0x3d639b(0xcb):_0x51814b='FAILED';}else _0x51814b='FAILED';}else _0x51814b=_0x3d639b(0xc8);return{'status':_0x51814b,'amount':_0x5626fd[_0x3d639b(0xba)],'currency':_0x5626fd[_0x3d639b(0xd5)],'isActive':_0x5626fd[_0x3d639b(0xbd)]};}catch(_0xe0b916){console[_0x3d639b(0xb8)](_0x3d639b(0xca),_0xe0b916),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x3d639b(0xbb)+_0x1e8904,_0xe0b916);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0xe0b916 instanceof Error?_0xe0b916['message']:_0x3d639b(0xd7)));}}async['processWebhook'](_0x3be58f){const _0x107fab=a46_0x1bdd70;console[_0x107fab(0x93)]('Processing\x20Noda\x20webhook:',_0x3be58f);let _0x4b515f='PENDING';switch(_0x3be58f['Status']?.[_0x107fab(0xf8)]()){case'done':case _0x107fab(0xfc):case _0x107fab(0xc7):case _0x107fab(0x8d):case _0x107fab(0x103):_0x3be58f[_0x107fab(0xe8)]===_0x107fab(0xf1)?_0x4b515f='PAID':_0x4b515f=_0x107fab(0xc8);break;case _0x107fab(0xae):case _0x107fab(0x97):case _0x107fab(0xb0):case _0x107fab(0xb8):case'rejected':_0x4b515f=_0x107fab(0xa7);break;case _0x107fab(0xcd):case _0x107fab(0x9f):_0x4b515f=_0x107fab(0xcb);break;case _0x107fab(0xe5):case _0x107fab(0x94):case _0x107fab(0xb9):case'processing':case _0x107fab(0x8e):default:_0x4b515f=_0x107fab(0xc8);break;}return{'paymentId':_0x3be58f[_0x107fab(0xc2)]||_0x3be58f[_0x107fab(0xa4)],'status':_0x4b515f,'amount':_0x3be58f['Amount'],'currency':_0x3be58f[_0x107fab(0xc3)],'additionalInfo':{'method':_0x3be58f[_0x107fab(0xed)],'bankId':_0x3be58f['BankId'],'settled':_0x3be58f[_0x107fab(0xe8)],'settlementDate':_0x3be58f[_0x107fab(0x8c)],'remitterName':_0x3be58f[_0x107fab(0xa8)]?.[_0x107fab(0xeb)],'remitterIban':_0x3be58f['Remitter']?.[_0x107fab(0xda)],'bankTransactionId':_0x3be58f[_0x107fab(0xf7)]}};}[a46_0x1bdd70(0xe1)](_0xefe8ff,_0x4cec75){const _0x4f3b8e=a46_0x1bdd70;return console[_0x4f3b8e(0x93)](_0x4f3b8e(0xa2),{'receivedSignature':_0x4cec75,'paymentId':_0xefe8ff[_0x4f3b8e(0xa4)],'merchantPaymentId':_0xefe8ff['MerchantPaymentId']}),!![];}}exports[a46_0x1bdd70(0xb3)]=NodaService;