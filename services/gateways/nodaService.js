'use strict';function a40_0x492b(_0x30b50b,_0x2ee76a){const _0x1a4528=a40_0x1a45();return a40_0x492b=function(_0x492bfa,_0x350989){_0x492bfa=_0x492bfa-0x139;let _0x46d78a=_0x1a4528[_0x492bfa];return _0x46d78a;},a40_0x492b(_0x30b50b,_0x2ee76a);}const a40_0x360af0=a40_0x492b;(function(_0x308f07,_0x48bd9b){const _0x4bd9e2=a40_0x492b,_0x47ae5a=_0x308f07();while(!![]){try{const _0x59dc8e=-parseInt(_0x4bd9e2(0x19e))/0x1*(-parseInt(_0x4bd9e2(0x155))/0x2)+-parseInt(_0x4bd9e2(0x153))/0x3+parseInt(_0x4bd9e2(0x1a3))/0x4*(-parseInt(_0x4bd9e2(0x19f))/0x5)+-parseInt(_0x4bd9e2(0x18f))/0x6*(-parseInt(_0x4bd9e2(0x192))/0x7)+parseInt(_0x4bd9e2(0x179))/0x8*(-parseInt(_0x4bd9e2(0x183))/0x9)+parseInt(_0x4bd9e2(0x18d))/0xa+parseInt(_0x4bd9e2(0x157))/0xb;if(_0x59dc8e===_0x48bd9b)break;else _0x47ae5a['push'](_0x47ae5a['shift']());}catch(_0x4f97af){_0x47ae5a['push'](_0x47ae5a['shift']());}}}(a40_0x1a45,0xa54a0));function a40_0x1a45(){const _0x46bf7c=['(8digits-8digits\x20format)','rejected','Error\x20details:','shortLink','PAID','HTTP\x20','EXPIRED','statusCode','Response\x20data:','PaymentId','GET','currency','now','entries','Noda\x20webhook\x20signature\x20verification:','Amount','/payment-links','URL:','Remitter','1208clUlwO','logWhiteDomainError','PENDING','/payment-links/','isActive','Not\x20provided','Name','expired','created','===\x20NODA\x20API\x20ERROR\x20===','53577wjGLHo','createPaymentLink','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','application/json','Short\x20Link:','BankId','status','Failed\x20to\x20verify\x20Noda\x20payment:\x20','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Status\x20Text:','6752480jTCJPV','in_progress','644754ACmbpf','qrCodeLink','error','35VysTCG','Parsed\x20Result:','Payment\x20Link\x20ID:','FAILED','text','Error\x20stack:','Failed\x20to\x20parse\x20JSON\x20response:','loggerService','toUpperCase','logWhiteDomainRequest','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','HTTP\x20Status:','139561DfBvOv','245gfPzHk','HTTP\x20error!\x20status:\x20','Yes','Response\x20Body:','96988svGDmJ','(8digits-8digits\x20format\x20for\x20Noda)','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','paid',',\x20body:\x20','log','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Unknown\x20error','Business\x20Error:\x20','failed','../loggerService','Iban','Error\x20Message:','message','BankTransactionId','headers','success','Status:','Settled','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','processWebhook','shortLinkUrls','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','https://tesoft.uk/gateway/noda/webhook/','fromEntries','https://tesoft.uk/gateway/noda/','parse','Missing\x20id\x20or\x20shortLink\x20in\x20response','Processing\x20Noda\x20webhook:','Method','noda','stack','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Headers:','defineProperty','QR\x20Code\x20Link:','https://tesoft.uk/gateway/success.php?id=','Raw\x20Response\x20Body:','canceled','statusText','361755cWWkuf','stringify','4vvCyAz','expiryDate','15322450QJLKdb','Noda\x20API\x20error:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','verifyWebhookSignature','Currency','pending','processing','Error\x20message:','MerchantPaymentId','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','logWhiteDomainResponse','TesSoft\x20Payment\x20System/1.0','apiUrl','json','POST'];a40_0x1a45=function(){return _0x46bf7c;};return a40_0x1a45();}Object[a40_0x360af0(0x14d)](exports,'__esModule',{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a40_0x360af0(0x1ad));class NodaService{constructor(){const _0x17e68a=a40_0x360af0;this[_0x17e68a(0x163)]=_0x17e68a(0x144),console[_0x17e68a(0x1a8)](_0x17e68a(0x185));}async[a40_0x360af0(0x184)](_0x30db02){const _0x1347b1=a40_0x360af0,{orderId:_0x33edd2,name:_0x330acd,paymentDescription:_0x281c0d,amount:_0x40fc0b,currency:_0x19e7d6,webhookUrl:_0x4394e0,returnUrl:_0x463513,expiryDate:_0x1e1b20}=_0x30db02,_0x53211a=_0x19e7d6[_0x1347b1(0x19a)](),_0x374c3e=_0x1347b1(0x142),_0x5adb69=_0x1347b1(0x14f)+_0x33edd2,_0x43ce35={'name':_0x330acd,'paymentDescription':_0x281c0d,'amount':_0x40fc0b,'currency':_0x53211a,'paymentId':_0x33edd2,'webhookUrl':_0x374c3e,'returnUrl':_0x5adb69};_0x1e1b20&&(_0x43ce35[_0x1347b1(0x156)]=_0x1e1b20);const _0x42c7b7=Date[_0x1347b1(0x172)]();try{console[_0x1347b1(0x1a8)](_0x1347b1(0x1a9)),console[_0x1347b1(0x1a8)](_0x1347b1(0x177),this[_0x1347b1(0x163)]),console['log']('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x1347b1(0x154)](_0x43ce35,null,0x2)),console[_0x1347b1(0x1a8)]('Order\x20ID\x20Format:',_0x33edd2,_0x1347b1(0x1a4)),loggerService_1['loggerService'][_0x1347b1(0x19b)](_0x1347b1(0x149),_0x1347b1(0x176),_0x1347b1(0x165),_0x43ce35);const _0x54bba2=await fetch(this[_0x1347b1(0x163)],{'method':_0x1347b1(0x165),'headers':{'Content-Type':_0x1347b1(0x186),'Accept':_0x1347b1(0x186),'User-Agent':_0x1347b1(0x162)},'body':JSON[_0x1347b1(0x154)](_0x43ce35)}),_0x3c896b=Date[_0x1347b1(0x172)]()-_0x42c7b7;console[_0x1347b1(0x1a8)](_0x1347b1(0x19c)),console[_0x1347b1(0x1a8)](_0x1347b1(0x13c),_0x54bba2[_0x1347b1(0x189)]),console[_0x1347b1(0x1a8)](_0x1347b1(0x18c),_0x54bba2[_0x1347b1(0x152)]),console[_0x1347b1(0x1a8)](_0x1347b1(0x14c),Object[_0x1347b1(0x143)](_0x54bba2[_0x1347b1(0x13a)][_0x1347b1(0x173)]())),console[_0x1347b1(0x1a8)]('Response\x20Time:',_0x3c896b+'ms');const _0x1746ac=await _0x54bba2[_0x1347b1(0x196)]();console[_0x1347b1(0x1a8)](_0x1347b1(0x150),_0x1746ac);if(!_0x54bba2['ok']){console[_0x1347b1(0x191)](_0x1347b1(0x182)),console[_0x1347b1(0x191)](_0x1347b1(0x19d),_0x54bba2[_0x1347b1(0x189)]),console[_0x1347b1(0x191)](_0x1347b1(0x1a2),_0x1746ac),loggerService_1['loggerService'][_0x1347b1(0x161)](_0x1347b1(0x149),'/payment-links',_0x54bba2[_0x1347b1(0x189)],_0x1746ac,_0x3c896b),loggerService_1[_0x1347b1(0x199)][_0x1347b1(0x17a)](_0x1347b1(0x149),_0x1347b1(0x176),_0x1347b1(0x16b)+_0x54bba2[_0x1347b1(0x189)]+':\x20'+_0x1746ac);if(_0x54bba2[_0x1347b1(0x189)]===0x190)throw new Error(_0x1347b1(0x18b));else{if(_0x54bba2['status']===0x1f4)throw new Error(_0x1347b1(0x141));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x54bba2[_0x1347b1(0x189)]+_0x1347b1(0x1a7)+_0x1746ac);}let _0x1f84cf;try{_0x1f84cf=JSON[_0x1347b1(0x145)](_0x1746ac);}catch(_0x3b26dd){console[_0x1347b1(0x191)](_0x1347b1(0x198),_0x3b26dd),loggerService_1[_0x1347b1(0x199)][_0x1347b1(0x17a)](_0x1347b1(0x149),_0x1347b1(0x176),'JSON\x20Parse\x20Error:\x20'+_0x3b26dd);throw new Error(_0x1347b1(0x160)+_0x1746ac);}console[_0x1347b1(0x1a8)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x1347b1(0x1a8)](_0x1347b1(0x193),JSON[_0x1347b1(0x154)](_0x1f84cf,null,0x2)),loggerService_1['loggerService'][_0x1347b1(0x161)]('noda',_0x1347b1(0x176),_0x54bba2[_0x1347b1(0x189)],_0x1f84cf,_0x3c896b);if(_0x1f84cf['error']||_0x1f84cf[_0x1347b1(0x16d)]){const _0x44f3e6=_0x1f84cf[_0x1347b1(0x1b0)]||_0x1f84cf[_0x1347b1(0x191)]||'Unknown\x20error\x20from\x20Noda\x20API';console['error'](_0x1347b1(0x13e)),console[_0x1347b1(0x191)](_0x1347b1(0x1af),_0x44f3e6),console['error']('Status\x20Code:',_0x1f84cf[_0x1347b1(0x16d)]),loggerService_1[_0x1347b1(0x199)][_0x1347b1(0x17a)]('noda',_0x1347b1(0x176),_0x1347b1(0x1ab)+_0x44f3e6);throw new Error(_0x1347b1(0x158)+_0x44f3e6);}if(!_0x1f84cf['id']||!_0x1f84cf[_0x1347b1(0x140)]?.[_0x1347b1(0x169)]){console['error'](_0x1347b1(0x1a5)),console[_0x1347b1(0x191)](_0x1347b1(0x146)),console[_0x1347b1(0x191)](_0x1347b1(0x16e),_0x1f84cf),loggerService_1[_0x1347b1(0x199)][_0x1347b1(0x17a)](_0x1347b1(0x149),_0x1347b1(0x176),_0x1347b1(0x159));throw new Error(_0x1347b1(0x14b));}return console[_0x1347b1(0x1a8)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x1347b1(0x1a8)](_0x1347b1(0x194),_0x1f84cf['id']),console['log'](_0x1347b1(0x187),_0x1f84cf[_0x1347b1(0x140)][_0x1347b1(0x169)]),console['log'](_0x1347b1(0x14e),_0x1f84cf[_0x1347b1(0x140)][_0x1347b1(0x190)]||_0x1347b1(0x17e)),console[_0x1347b1(0x1a8)]('Order\x20ID\x20Used:',_0x33edd2,_0x1347b1(0x166)),{'gateway_payment_id':_0x1f84cf['id'],'payment_url':_0x1f84cf[_0x1347b1(0x140)][_0x1347b1(0x169)],'qr_code_url':_0x1f84cf[_0x1347b1(0x140)][_0x1347b1(0x190)],'expiry_date':_0x1f84cf['expiryDate']};}catch(_0x48f953){console[_0x1347b1(0x191)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x1347b1(0x191)](_0x1347b1(0x168),_0x48f953),loggerService_1[_0x1347b1(0x199)][_0x1347b1(0x17a)](_0x1347b1(0x149),_0x1347b1(0x176),_0x48f953);if(_0x48f953 instanceof Error){console[_0x1347b1(0x191)](_0x1347b1(0x15e),_0x48f953[_0x1347b1(0x1b0)]),console[_0x1347b1(0x191)](_0x1347b1(0x197),_0x48f953[_0x1347b1(0x14a)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x48f953[_0x1347b1(0x1b0)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x3f6777){const _0x290e7b=a40_0x360af0,_0x5f237e=Date[_0x290e7b(0x172)]();try{loggerService_1[_0x290e7b(0x199)][_0x290e7b(0x19b)](_0x290e7b(0x149),'/payment-links/'+_0x3f6777,_0x290e7b(0x170),{});const _0x1afc41=await fetch(this[_0x290e7b(0x163)]+'/'+_0x3f6777,{'method':'GET','headers':{'Content-Type':_0x290e7b(0x186),'User-Agent':_0x290e7b(0x162)}}),_0x313b50=Date[_0x290e7b(0x172)]()-_0x5f237e;if(!_0x1afc41['ok']){const _0x1e0946=await _0x1afc41[_0x290e7b(0x196)]();loggerService_1[_0x290e7b(0x199)]['logWhiteDomainResponse'](_0x290e7b(0x149),_0x290e7b(0x17c)+_0x3f6777,_0x1afc41['status'],_0x1e0946,_0x313b50);throw new Error(_0x290e7b(0x1a0)+_0x1afc41[_0x290e7b(0x189)]);}const _0xe0d6d2=await _0x1afc41[_0x290e7b(0x164)]();loggerService_1[_0x290e7b(0x199)]['logWhiteDomainResponse']('noda',_0x290e7b(0x17c)+_0x3f6777,_0x1afc41['status'],_0xe0d6d2,_0x313b50);if(_0xe0d6d2[_0x290e7b(0x191)]||_0xe0d6d2[_0x290e7b(0x16d)]){loggerService_1[_0x290e7b(0x199)][_0x290e7b(0x17a)](_0x290e7b(0x149),_0x290e7b(0x17c)+_0x3f6777,'Noda\x20API\x20error:\x20'+(_0xe0d6d2['message']||_0xe0d6d2[_0x290e7b(0x191)]||'Unknown\x20error'));throw new Error(_0x290e7b(0x158)+(_0xe0d6d2[_0x290e7b(0x1b0)]||_0xe0d6d2[_0x290e7b(0x191)]||_0x290e7b(0x1aa)));}let _0x4679d8=_0x290e7b(0x17b);if(_0xe0d6d2[_0x290e7b(0x17d)]===![]){if(_0xe0d6d2['expiryDate']){const _0x4edadb=new Date(_0xe0d6d2[_0x290e7b(0x156)]),_0x4359d7=new Date();_0x4edadb<_0x4359d7?_0x4679d8=_0x290e7b(0x16c):_0x4679d8=_0x290e7b(0x195);}else _0x4679d8='FAILED';}else _0x4679d8='PENDING';return{'status':_0x4679d8,'amount':_0xe0d6d2['amount'],'currency':_0xe0d6d2[_0x290e7b(0x171)],'isActive':_0xe0d6d2[_0x290e7b(0x17d)]};}catch(_0x373415){console[_0x290e7b(0x191)]('Noda\x20payment\x20verification\x20error:',_0x373415),loggerService_1[_0x290e7b(0x199)][_0x290e7b(0x17a)](_0x290e7b(0x149),_0x290e7b(0x17c)+_0x3f6777,_0x373415);throw new Error(_0x290e7b(0x18a)+(_0x373415 instanceof Error?_0x373415[_0x290e7b(0x1b0)]:_0x290e7b(0x1aa)));}}async[a40_0x360af0(0x13f)](_0x37aeb2){const _0x2e1be0=a40_0x360af0;console[_0x2e1be0(0x1a8)](_0x2e1be0(0x147),_0x37aeb2);let _0x23405f=_0x2e1be0(0x17b);switch(_0x37aeb2['Status']?.['toLowerCase']()){case'done':case'completed':case _0x2e1be0(0x1a6):case _0x2e1be0(0x13b):case'successful':_0x37aeb2[_0x2e1be0(0x13d)]===_0x2e1be0(0x1a1)?_0x23405f=_0x2e1be0(0x16a):_0x23405f='PENDING';break;case'cancelled':case _0x2e1be0(0x151):case _0x2e1be0(0x1ac):case'error':case _0x2e1be0(0x167):_0x23405f=_0x2e1be0(0x195);break;case _0x2e1be0(0x180):case'timeout':_0x23405f=_0x2e1be0(0x16c);break;case _0x2e1be0(0x15c):case _0x2e1be0(0x181):case'active':case _0x2e1be0(0x15d):case _0x2e1be0(0x18e):default:_0x23405f=_0x2e1be0(0x17b);break;}return{'paymentId':_0x37aeb2[_0x2e1be0(0x15f)]||_0x37aeb2[_0x2e1be0(0x16f)],'status':_0x23405f,'amount':_0x37aeb2[_0x2e1be0(0x175)],'currency':_0x37aeb2[_0x2e1be0(0x15b)],'additionalInfo':{'method':_0x37aeb2[_0x2e1be0(0x148)],'bankId':_0x37aeb2[_0x2e1be0(0x188)],'settled':_0x37aeb2[_0x2e1be0(0x13d)],'settlementDate':_0x37aeb2['SettlementDate'],'remitterName':_0x37aeb2[_0x2e1be0(0x178)]?.[_0x2e1be0(0x17f)],'remitterIban':_0x37aeb2[_0x2e1be0(0x178)]?.[_0x2e1be0(0x1ae)],'bankTransactionId':_0x37aeb2[_0x2e1be0(0x139)]}};}[a40_0x360af0(0x15a)](_0x2e0691,_0x5eea31){const _0x44b915=a40_0x360af0;return console['log'](_0x44b915(0x174),{'receivedSignature':_0x5eea31,'paymentId':_0x2e0691['PaymentId'],'merchantPaymentId':_0x2e0691[_0x44b915(0x15f)]}),!![];}}exports['NodaService']=NodaService;