'use strict';const a43_0xa37494=a43_0x22fa;(function(_0x387018,_0x2464b6){const _0x51f3dc=a43_0x22fa,_0x58b021=_0x387018();while(!![]){try{const _0x1512fc=-parseInt(_0x51f3dc(0x1ea))/0x1*(parseInt(_0x51f3dc(0x1e6))/0x2)+-parseInt(_0x51f3dc(0x1df))/0x3*(parseInt(_0x51f3dc(0x1d5))/0x4)+-parseInt(_0x51f3dc(0x1e3))/0x5*(-parseInt(_0x51f3dc(0x1f9))/0x6)+parseInt(_0x51f3dc(0x18f))/0x7+parseInt(_0x51f3dc(0x1aa))/0x8*(-parseInt(_0x51f3dc(0x19f))/0x9)+parseInt(_0x51f3dc(0x1a6))/0xa*(parseInt(_0x51f3dc(0x1da))/0xb)+parseInt(_0x51f3dc(0x1a0))/0xc*(parseInt(_0x51f3dc(0x1ca))/0xd);if(_0x1512fc===_0x2464b6)break;else _0x58b021['push'](_0x58b021['shift']());}catch(_0x37750b){_0x58b021['push'](_0x58b021['shift']());}}}(a43_0x5d5f,0xe4313));function a43_0x5d5f(){const _0x239ae1=['/payment-links','12522034QVyZDj','status','Failed\x20to\x20verify\x20Noda\x20payment:\x20','stack','Business\x20Error:\x20','successful','Remitter','Response\x20Body:','(8digits-8digits\x20format\x20for\x20Noda)','statusText','verifyWebhookSignature','created','Missing\x20id\x20or\x20shortLink\x20in\x20response','Error\x20message:','MerchantPaymentId','TesSoft\x20Payment\x20System/1.0','423haDmif','2547948Puszan','Settled','canceled','EXPIRED','cancelled','entries','21170rvkwcd','Parsed\x20Result:','GET','loggerService','218024UsswcX','Processing\x20Noda\x20webhook:','headers','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','https://tesoft.uk/gateway/noda/webhook/','Currency','Name','logWhiteDomainResponse','NodaService','defineProperty','PaymentId','statusCode','POST','Iban','HTTP\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','error','SettlementDate','paid','logWhiteDomainRequest','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20NODA\x20API\x20ERROR\x20===','Noda\x20payment\x20verification\x20error:','expiryDate','application/json','amount','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Noda\x20API\x20error:\x20','rejected','Request\x20Body\x20(Direct\x20JSON):','(8digits-8digits\x20format)','JSON\x20Parse\x20Error:\x20','169xuHoEn','shortLink','processing','pending','createPaymentLink','Status:','qrCodeLink','Unknown\x20error','text','URL:','Raw\x20Response\x20Body:','3478180ORHqnx','https://tesoft.uk/gateway/noda/','/payment-links/','json','Amount','154GdoxbH','message','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Order\x20ID\x20Format:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','6fqCTDe','shortLinkUrls','success','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','327165GmPmoo','https://tesoft.uk/gateway/pending.php?id=','toLowerCase','9286QlLJMG','Response\x20Time:','Response\x20data:','Payment\x20Link\x20ID:','374uCGdEU','===\x20NODA\x20SUCCESS\x20===',',\x20body:\x20','in_progress','toUpperCase','Short\x20Link:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','QR\x20Code\x20Link:','FAILED','done','now','Yes','noda','apiUrl','102wLYQgq','log','Noda\x20webhook\x20signature\x20verification:','failed','Error\x20details:','logWhiteDomainError','active','stringify','PENDING','Order\x20ID\x20Used:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','timeout','parse','PAID'];a43_0x5d5f=function(){return _0x239ae1;};return a43_0x5d5f();}function a43_0x22fa(_0x512b54,_0x45184f){const _0x5d5f05=a43_0x5d5f();return a43_0x22fa=function(_0x22facf,_0x5b6f67){_0x22facf=_0x22facf-0x183;let _0x15c8da=_0x5d5f05[_0x22facf];return _0x15c8da;},a43_0x22fa(_0x512b54,_0x45184f);}Object[a43_0xa37494(0x1b3)](exports,'__esModule',{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x18ac58=a43_0xa37494;this[_0x18ac58(0x1f8)]=_0x18ac58(0x1d6),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a43_0xa37494(0x1ce)](_0x49c7d6){const _0x44e2ba=a43_0xa37494,{orderId:_0x4a8788,name:_0xc79102,paymentDescription:_0x7eb94b,amount:_0x592bad,currency:_0x8f7e68,webhookUrl:_0x4c5924,returnUrl:_0x2ebda5,expiryDate:_0xa5d640}=_0x49c7d6,_0x5a4a80=_0x8f7e68[_0x44e2ba(0x1ee)](),_0x21196d=_0x44e2ba(0x1ae),_0x4e6af5=_0x44e2ba(0x1e4)+_0x4a8788,_0x5dd158={'name':_0xc79102,'paymentDescription':_0x7eb94b,'amount':_0x592bad,'currency':_0x5a4a80,'paymentId':_0x4a8788,'webhookUrl':_0x21196d,'returnUrl':_0x4e6af5};_0xa5d640&&(_0x5dd158[_0x44e2ba(0x1c1)]=_0xa5d640);const _0x53f1c8=Date[_0x44e2ba(0x1f5)]();try{console[_0x44e2ba(0x1fa)](_0x44e2ba(0x1de)),console[_0x44e2ba(0x1fa)](_0x44e2ba(0x1d3),this[_0x44e2ba(0x1f8)]),console[_0x44e2ba(0x1fa)](_0x44e2ba(0x1c7),JSON[_0x44e2ba(0x187)](_0x5dd158,null,0x2)),console[_0x44e2ba(0x1fa)](_0x44e2ba(0x1dd),_0x4a8788,_0x44e2ba(0x197)),console[_0x44e2ba(0x1fa)](_0x44e2ba(0x18a),_0x4e6af5),loggerService_1[_0x44e2ba(0x1a9)][_0x44e2ba(0x1bd)](_0x44e2ba(0x1f7),_0x44e2ba(0x18e),_0x44e2ba(0x1b6),_0x5dd158);const _0x1d69a3=await fetch(this['apiUrl'],{'method':_0x44e2ba(0x1b6),'headers':{'Content-Type':_0x44e2ba(0x1c2),'Accept':_0x44e2ba(0x1c2),'User-Agent':_0x44e2ba(0x19e)},'body':JSON[_0x44e2ba(0x187)](_0x5dd158)}),_0x19f64a=Date[_0x44e2ba(0x1f5)]()-_0x53f1c8;console[_0x44e2ba(0x1fa)](_0x44e2ba(0x1c4)),console[_0x44e2ba(0x1fa)](_0x44e2ba(0x1cf),_0x1d69a3['status']),console[_0x44e2ba(0x1fa)]('Status\x20Text:',_0x1d69a3[_0x44e2ba(0x198)]),console[_0x44e2ba(0x1fa)]('Headers:',Object['fromEntries'](_0x1d69a3[_0x44e2ba(0x1ac)][_0x44e2ba(0x1a5)]())),console[_0x44e2ba(0x1fa)](_0x44e2ba(0x1e7),_0x19f64a+'ms');const _0x4a8286=await _0x1d69a3[_0x44e2ba(0x1d2)]();console['log'](_0x44e2ba(0x1d4),_0x4a8286);if(!_0x1d69a3['ok']){console[_0x44e2ba(0x1ba)](_0x44e2ba(0x1bf)),console[_0x44e2ba(0x1ba)]('HTTP\x20Status:',_0x1d69a3['status']),console[_0x44e2ba(0x1ba)](_0x44e2ba(0x196),_0x4a8286),loggerService_1[_0x44e2ba(0x1a9)]['logWhiteDomainResponse'](_0x44e2ba(0x1f7),_0x44e2ba(0x18e),_0x1d69a3['status'],_0x4a8286,_0x19f64a),loggerService_1['loggerService'][_0x44e2ba(0x185)](_0x44e2ba(0x1f7),_0x44e2ba(0x18e),_0x44e2ba(0x1b8)+_0x1d69a3[_0x44e2ba(0x190)]+':\x20'+_0x4a8286);if(_0x1d69a3[_0x44e2ba(0x190)]===0x190)throw new Error(_0x44e2ba(0x1ad));else{if(_0x1d69a3[_0x44e2ba(0x190)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error('HTTP\x20error!\x20status:\x20'+_0x1d69a3[_0x44e2ba(0x190)]+_0x44e2ba(0x1ec)+_0x4a8286);}let _0x37da6e;try{_0x37da6e=JSON[_0x44e2ba(0x18c)](_0x4a8286);}catch(_0x46553a){console[_0x44e2ba(0x1ba)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x46553a),loggerService_1[_0x44e2ba(0x1a9)][_0x44e2ba(0x185)]('noda','/payment-links',_0x44e2ba(0x1c9)+_0x46553a);throw new Error(_0x44e2ba(0x1e2)+_0x4a8286);}console['log']('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x44e2ba(0x1fa)](_0x44e2ba(0x1a7),JSON[_0x44e2ba(0x187)](_0x37da6e,null,0x2)),loggerService_1[_0x44e2ba(0x1a9)]['logWhiteDomainResponse'](_0x44e2ba(0x1f7),_0x44e2ba(0x18e),_0x1d69a3[_0x44e2ba(0x190)],_0x37da6e,_0x19f64a);if(_0x37da6e[_0x44e2ba(0x1ba)]||_0x37da6e['statusCode']){const _0x54fd2b=_0x37da6e[_0x44e2ba(0x1db)]||_0x37da6e[_0x44e2ba(0x1ba)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x44e2ba(0x1ba)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x54fd2b),console[_0x44e2ba(0x1ba)]('Status\x20Code:',_0x37da6e[_0x44e2ba(0x1b5)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x44e2ba(0x1f7),_0x44e2ba(0x18e),_0x44e2ba(0x193)+_0x54fd2b);throw new Error('Noda\x20API\x20error:\x20'+_0x54fd2b);}if(!_0x37da6e['id']||!_0x37da6e[_0x44e2ba(0x1e0)]?.[_0x44e2ba(0x1cb)]){console['error'](_0x44e2ba(0x1be)),console[_0x44e2ba(0x1ba)](_0x44e2ba(0x19b)),console[_0x44e2ba(0x1ba)](_0x44e2ba(0x1e8),_0x37da6e),loggerService_1[_0x44e2ba(0x1a9)]['logWhiteDomainError'](_0x44e2ba(0x1f7),_0x44e2ba(0x18e),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x44e2ba(0x1f1));}return console[_0x44e2ba(0x1fa)](_0x44e2ba(0x1eb)),console[_0x44e2ba(0x1fa)](_0x44e2ba(0x1e9),_0x37da6e['id']),console['log'](_0x44e2ba(0x1ef),_0x37da6e[_0x44e2ba(0x1e0)]['shortLink']),console['log'](_0x44e2ba(0x1f2),_0x37da6e[_0x44e2ba(0x1e0)][_0x44e2ba(0x1d0)]||'Not\x20provided'),console[_0x44e2ba(0x1fa)](_0x44e2ba(0x189),_0x4a8788,_0x44e2ba(0x1c8)),console[_0x44e2ba(0x1fa)](_0x44e2ba(0x1f0),_0x4e6af5),{'gateway_payment_id':_0x37da6e['id'],'payment_url':_0x37da6e['shortLinkUrls'][_0x44e2ba(0x1cb)],'qr_code_url':_0x37da6e[_0x44e2ba(0x1e0)]['qrCodeLink'],'expiry_date':_0x37da6e['expiryDate']};}catch(_0x54435c){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console['error'](_0x44e2ba(0x184),_0x54435c),loggerService_1[_0x44e2ba(0x1a9)][_0x44e2ba(0x185)](_0x44e2ba(0x1f7),_0x44e2ba(0x18e),_0x54435c);if(_0x54435c instanceof Error){console[_0x44e2ba(0x1ba)](_0x44e2ba(0x19c),_0x54435c['message']),console[_0x44e2ba(0x1ba)]('Error\x20stack:',_0x54435c[_0x44e2ba(0x192)]);throw new Error(_0x44e2ba(0x1dc)+_0x54435c[_0x44e2ba(0x1db)]);}throw new Error(_0x44e2ba(0x1b9));}}async['verifyPayment'](_0x4848e3){const _0x221f5b=a43_0xa37494,_0x2c6e08=Date[_0x221f5b(0x1f5)]();try{loggerService_1[_0x221f5b(0x1a9)][_0x221f5b(0x1bd)]('noda',_0x221f5b(0x1d7)+_0x4848e3,_0x221f5b(0x1a8),{});const _0xa34c48=await fetch(this[_0x221f5b(0x1f8)]+'/'+_0x4848e3,{'method':_0x221f5b(0x1a8),'headers':{'Content-Type':_0x221f5b(0x1c2),'User-Agent':_0x221f5b(0x19e)}}),_0x38bd8b=Date[_0x221f5b(0x1f5)]()-_0x2c6e08;if(!_0xa34c48['ok']){const _0x5e9f09=await _0xa34c48['text']();loggerService_1['loggerService'][_0x221f5b(0x1b1)]('noda',_0x221f5b(0x1d7)+_0x4848e3,_0xa34c48[_0x221f5b(0x190)],_0x5e9f09,_0x38bd8b);throw new Error('HTTP\x20error!\x20status:\x20'+_0xa34c48[_0x221f5b(0x190)]);}const _0xe12750=await _0xa34c48[_0x221f5b(0x1d8)]();loggerService_1[_0x221f5b(0x1a9)][_0x221f5b(0x1b1)](_0x221f5b(0x1f7),_0x221f5b(0x1d7)+_0x4848e3,_0xa34c48[_0x221f5b(0x190)],_0xe12750,_0x38bd8b);if(_0xe12750[_0x221f5b(0x1ba)]||_0xe12750[_0x221f5b(0x1b5)]){loggerService_1[_0x221f5b(0x1a9)]['logWhiteDomainError'](_0x221f5b(0x1f7),_0x221f5b(0x1d7)+_0x4848e3,_0x221f5b(0x1c5)+(_0xe12750[_0x221f5b(0x1db)]||_0xe12750[_0x221f5b(0x1ba)]||_0x221f5b(0x1d1)));throw new Error(_0x221f5b(0x1c5)+(_0xe12750[_0x221f5b(0x1db)]||_0xe12750[_0x221f5b(0x1ba)]||'Unknown\x20error'));}let _0x2889ac=_0x221f5b(0x188);if(_0xe12750['isActive']===![]){if(_0xe12750[_0x221f5b(0x1c1)]){const _0xf534f5=new Date(_0xe12750[_0x221f5b(0x1c1)]),_0x27556c=new Date();_0xf534f5<_0x27556c?_0x2889ac=_0x221f5b(0x1a3):_0x2889ac='FAILED';}else _0x2889ac=_0x221f5b(0x1f3);}else _0x2889ac=_0x221f5b(0x188);return{'status':_0x2889ac,'amount':_0xe12750[_0x221f5b(0x1c3)],'currency':_0xe12750['currency'],'isActive':_0xe12750['isActive']};}catch(_0xdfe14){console[_0x221f5b(0x1ba)](_0x221f5b(0x1c0),_0xdfe14),loggerService_1['loggerService'][_0x221f5b(0x185)](_0x221f5b(0x1f7),_0x221f5b(0x1d7)+_0x4848e3,_0xdfe14);throw new Error(_0x221f5b(0x191)+(_0xdfe14 instanceof Error?_0xdfe14[_0x221f5b(0x1db)]:_0x221f5b(0x1d1)));}}async['processWebhook'](_0x21c71e){const _0x39b4da=a43_0xa37494;console[_0x39b4da(0x1fa)](_0x39b4da(0x1ab),_0x21c71e);let _0xcdce72='PENDING';switch(_0x21c71e['Status']?.[_0x39b4da(0x1e5)]()){case _0x39b4da(0x1f4):case'completed':case _0x39b4da(0x1bc):case _0x39b4da(0x1e1):case _0x39b4da(0x194):_0x21c71e[_0x39b4da(0x1a1)]===_0x39b4da(0x1f6)?_0xcdce72=_0x39b4da(0x18d):_0xcdce72='PENDING';break;case _0x39b4da(0x1a4):case _0x39b4da(0x1a2):case _0x39b4da(0x183):case _0x39b4da(0x1ba):case _0x39b4da(0x1c6):_0xcdce72=_0x39b4da(0x1f3);break;case'expired':case _0x39b4da(0x18b):_0xcdce72=_0x39b4da(0x1a3);break;case _0x39b4da(0x1cd):case _0x39b4da(0x19a):case _0x39b4da(0x186):case _0x39b4da(0x1cc):case _0x39b4da(0x1ed):default:_0xcdce72='PENDING';break;}return{'paymentId':_0x21c71e['MerchantPaymentId']||_0x21c71e[_0x39b4da(0x1b4)],'status':_0xcdce72,'amount':_0x21c71e[_0x39b4da(0x1d9)],'currency':_0x21c71e[_0x39b4da(0x1af)],'additionalInfo':{'method':_0x21c71e['Method'],'bankId':_0x21c71e['BankId'],'settled':_0x21c71e[_0x39b4da(0x1a1)],'settlementDate':_0x21c71e[_0x39b4da(0x1bb)],'remitterName':_0x21c71e[_0x39b4da(0x195)]?.[_0x39b4da(0x1b0)],'remitterIban':_0x21c71e[_0x39b4da(0x195)]?.[_0x39b4da(0x1b7)],'bankTransactionId':_0x21c71e['BankTransactionId']}};}[a43_0xa37494(0x199)](_0x38477e,_0x26fa3e){const _0x515167=a43_0xa37494;return console[_0x515167(0x1fa)](_0x515167(0x1fb),{'receivedSignature':_0x26fa3e,'paymentId':_0x38477e[_0x515167(0x1b4)],'merchantPaymentId':_0x38477e[_0x515167(0x19d)]}),!![];}}exports[a43_0xa37494(0x1b2)]=NodaService;