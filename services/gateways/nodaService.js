'use strict';const a43_0x13fa8d=a43_0x2384;(function(_0xe1f8fe,_0x33f4f0){const _0x1f98ba=a43_0x2384,_0x37f3c1=_0xe1f8fe();while(!![]){try{const _0x5b8fd1=parseInt(_0x1f98ba(0x1eb))/0x1+parseInt(_0x1f98ba(0x1fe))/0x2+-parseInt(_0x1f98ba(0x1a8))/0x3*(parseInt(_0x1f98ba(0x1a1))/0x4)+parseInt(_0x1f98ba(0x1a2))/0x5*(parseInt(_0x1f98ba(0x1f3))/0x6)+-parseInt(_0x1f98ba(0x20a))/0x7*(parseInt(_0x1f98ba(0x1b8))/0x8)+parseInt(_0x1f98ba(0x1db))/0x9+parseInt(_0x1f98ba(0x1f1))/0xa*(-parseInt(_0x1f98ba(0x1ae))/0xb);if(_0x5b8fd1===_0x33f4f0)break;else _0x37f3c1['push'](_0x37f3c1['shift']());}catch(_0x5952bd){_0x37f3c1['push'](_0x37f3c1['shift']());}}}(a43_0x3825,0x91a17));function a43_0x2384(_0x4f350e,_0x1f8252){const _0x38253d=a43_0x3825();return a43_0x2384=function(_0x23847f,_0x2fb49b){_0x23847f=_0x23847f-0x1a0;let _0x574318=_0x38253d[_0x23847f];return _0x574318;},a43_0x2384(_0x4f350e,_0x1f8252);}Object[a43_0x13fa8d(0x1ca)](exports,a43_0x13fa8d(0x1b7),{'value':!![]}),exports[a43_0x13fa8d(0x1c3)]=void 0x0;const loggerService_1=require(a43_0x13fa8d(0x211));function a43_0x3825(){const _0x525955=['9417537fEGuTe','statusCode','Yes','fromEntries','Name','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Failed\x20to\x20parse\x20JSON\x20response:','Parsed\x20Result:',',\x20body:\x20','paid','created','Not\x20provided','https://tesoft.uk/gateway/noda/webhook/','logWhiteDomainRequest','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Processing\x20Noda\x20webhook:','905334aWcBen','logWhiteDomainResponse','(8digits-8digits\x20format)','BankId','json','===\x20NODA\x20API\x20ERROR\x20===','13770pmFfnX','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','689340SLUzrS','shortLink','EXPIRED','HTTP\x20Status:','Method','log','HTTP\x20error!\x20status:\x20','toLowerCase','successful','expiryDate','Noda\x20webhook\x20signature\x20verification:','1551032LInlga','shortLinkUrls','loggerService','BankTransactionId','PAID','GET','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','isActive','cancelled','FAILED','===\x20PARSED\x20NODA\x20RESPONSE\x20===','toUpperCase','595847mUFbUX','processWebhook','Payment\x20Link\x20ID:','Error\x20message:','active','Remitter','in_progress','../loggerService','now','canceled','stack','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','/payment-links','https://tesoft.uk/gateway/noda/','qrCodeLink','Raw\x20Response\x20Body:','Noda\x20API\x20error:\x20','message','Status','188zBFTGR','10BbWBRy','Noda\x20payment\x20verification\x20error:','QR\x20Code\x20Link:','MerchantPaymentId','done','Error\x20Message:','62412dfZnHU','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','pending','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','parse','application/json','4246RSKMjY','statusText','PENDING','Currency','Order\x20ID\x20Used:','Response\x20Body:','JSON\x20Parse\x20Error:\x20','createPaymentLink','error','__esModule','80nrQCJA','headers','Status\x20Code:','success','Order\x20ID\x20Format:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','completed','status','HTTP\x20','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','PaymentId','NodaService','logWhiteDomainError','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','failed','Status\x20Text:','processing','Headers:','defineProperty','expired','/payment-links/','Iban','noda','verifyPayment','apiUrl','Unknown\x20error','Unknown\x20error\x20from\x20Noda\x20API','Status:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','stringify','entries','text','TesSoft\x20Payment\x20System/1.0','POST'];a43_0x3825=function(){return _0x525955;};return a43_0x3825();}class NodaService{constructor(){const _0x22d42f=a43_0x13fa8d;this[_0x22d42f(0x1d0)]=_0x22d42f(0x217),console['log'](_0x22d42f(0x1d4));}async[a43_0x13fa8d(0x1b5)](_0x1cdb30){const _0x3059f9=a43_0x13fa8d,{orderId:_0x5209c7,name:_0x4bde0f,paymentDescription:_0x17eed7,amount:_0xa49bf0,currency:_0x57e43f,webhookUrl:_0x5a5321,returnUrl:_0x20c23e,expiryDate:_0x11de4e}=_0x1cdb30,_0x1c952b=_0x57e43f[_0x3059f9(0x209)](),_0x223002=_0x3059f9(0x1e7),_0x4ab28c='https://tesoft.uk/gateway/pending.php?id='+_0x5209c7,_0x555097={'name':_0x4bde0f,'paymentDescription':_0x17eed7,'amount':_0xa49bf0,'currency':_0x1c952b,'paymentId':_0x5209c7,'webhookUrl':_0x223002,'returnUrl':_0x4ab28c};_0x11de4e&&(_0x555097[_0x3059f9(0x1fc)]=_0x11de4e);const _0x596bc0=Date[_0x3059f9(0x212)]();try{console[_0x3059f9(0x1f8)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x3059f9(0x1f8)]('URL:',this['apiUrl']),console['log']('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x3059f9(0x1d6)](_0x555097,null,0x2)),console[_0x3059f9(0x1f8)](_0x3059f9(0x1bc),_0x5209c7,'(8digits-8digits\x20format\x20for\x20Noda)'),console['log']('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x4ab28c),loggerService_1[_0x3059f9(0x200)][_0x3059f9(0x1e8)](_0x3059f9(0x1ce),_0x3059f9(0x216),'POST',_0x555097);const _0x25795e=await fetch(this['apiUrl'],{'method':_0x3059f9(0x1da),'headers':{'Content-Type':_0x3059f9(0x1ad),'Accept':_0x3059f9(0x1ad),'User-Agent':_0x3059f9(0x1d9)},'body':JSON[_0x3059f9(0x1d6)](_0x555097)}),_0x46d23=Date[_0x3059f9(0x212)]()-_0x596bc0;console['log'](_0x3059f9(0x1c5)),console[_0x3059f9(0x1f8)](_0x3059f9(0x1d3),_0x25795e[_0x3059f9(0x1bf)]),console['log'](_0x3059f9(0x1c7),_0x25795e[_0x3059f9(0x1af)]),console[_0x3059f9(0x1f8)](_0x3059f9(0x1c9),Object[_0x3059f9(0x1de)](_0x25795e[_0x3059f9(0x1b9)][_0x3059f9(0x1d7)]())),console[_0x3059f9(0x1f8)]('Response\x20Time:',_0x46d23+'ms');const _0x54dae7=await _0x25795e[_0x3059f9(0x1d8)]();console[_0x3059f9(0x1f8)](_0x3059f9(0x219),_0x54dae7);if(!_0x25795e['ok']){console[_0x3059f9(0x1b6)](_0x3059f9(0x1f0)),console[_0x3059f9(0x1b6)](_0x3059f9(0x1f6),_0x25795e[_0x3059f9(0x1bf)]),console[_0x3059f9(0x1b6)](_0x3059f9(0x1b3),_0x54dae7),loggerService_1[_0x3059f9(0x200)]['logWhiteDomainResponse'](_0x3059f9(0x1ce),_0x3059f9(0x216),_0x25795e[_0x3059f9(0x1bf)],_0x54dae7,_0x46d23),loggerService_1['loggerService']['logWhiteDomainError'](_0x3059f9(0x1ce),_0x3059f9(0x216),_0x3059f9(0x1c0)+_0x25795e['status']+':\x20'+_0x54dae7);if(_0x25795e[_0x3059f9(0x1bf)]===0x190)throw new Error(_0x3059f9(0x215));else{if(_0x25795e[_0x3059f9(0x1bf)]===0x1f4)throw new Error(_0x3059f9(0x1e9));}throw new Error(_0x3059f9(0x1f9)+_0x25795e[_0x3059f9(0x1bf)]+_0x3059f9(0x1e3)+_0x54dae7);}let _0x41960d;try{_0x41960d=JSON[_0x3059f9(0x1ac)](_0x54dae7);}catch(_0x3680a8){console['error'](_0x3059f9(0x1e1),_0x3680a8),loggerService_1[_0x3059f9(0x200)][_0x3059f9(0x1c4)](_0x3059f9(0x1ce),_0x3059f9(0x216),_0x3059f9(0x1b4)+_0x3680a8);throw new Error(_0x3059f9(0x204)+_0x54dae7);}console['log'](_0x3059f9(0x208)),console[_0x3059f9(0x1f8)](_0x3059f9(0x1e2),JSON[_0x3059f9(0x1d6)](_0x41960d,null,0x2)),loggerService_1[_0x3059f9(0x200)]['logWhiteDomainResponse'](_0x3059f9(0x1ce),_0x3059f9(0x216),_0x25795e[_0x3059f9(0x1bf)],_0x41960d,_0x46d23);if(_0x41960d[_0x3059f9(0x1b6)]||_0x41960d[_0x3059f9(0x1dc)]){const _0x4f81a9=_0x41960d['message']||_0x41960d[_0x3059f9(0x1b6)]||_0x3059f9(0x1d2);console[_0x3059f9(0x1b6)](_0x3059f9(0x1f2)),console['error'](_0x3059f9(0x1a7),_0x4f81a9),console['error'](_0x3059f9(0x1ba),_0x41960d['statusCode']),loggerService_1[_0x3059f9(0x200)][_0x3059f9(0x1c4)]('noda','/payment-links','Business\x20Error:\x20'+_0x4f81a9);throw new Error(_0x3059f9(0x21a)+_0x4f81a9);}if(!_0x41960d['id']||!_0x41960d['shortLinkUrls']?.[_0x3059f9(0x1f4)]){console[_0x3059f9(0x1b6)](_0x3059f9(0x1a9)),console[_0x3059f9(0x1b6)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x3059f9(0x1b6)]('Response\x20data:',_0x41960d),loggerService_1['loggerService'][_0x3059f9(0x1c4)](_0x3059f9(0x1ce),'/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x3059f9(0x1c1));}return console[_0x3059f9(0x1f8)]('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x3059f9(0x20c),_0x41960d['id']),console[_0x3059f9(0x1f8)]('Short\x20Link:',_0x41960d[_0x3059f9(0x1ff)]['shortLink']),console[_0x3059f9(0x1f8)](_0x3059f9(0x1a4),_0x41960d[_0x3059f9(0x1ff)][_0x3059f9(0x218)]||_0x3059f9(0x1e6)),console[_0x3059f9(0x1f8)](_0x3059f9(0x1b2),_0x5209c7,_0x3059f9(0x1ed)),console[_0x3059f9(0x1f8)](_0x3059f9(0x1ab),_0x4ab28c),{'gateway_payment_id':_0x41960d['id'],'payment_url':_0x41960d[_0x3059f9(0x1ff)][_0x3059f9(0x1f4)],'qr_code_url':_0x41960d['shortLinkUrls'][_0x3059f9(0x218)],'expiry_date':_0x41960d[_0x3059f9(0x1fc)]};}catch(_0x1c0d13){console[_0x3059f9(0x1b6)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x3059f9(0x1b6)]('Error\x20details:',_0x1c0d13),loggerService_1[_0x3059f9(0x200)][_0x3059f9(0x1c4)]('noda',_0x3059f9(0x216),_0x1c0d13);if(_0x1c0d13 instanceof Error){console['error'](_0x3059f9(0x20d),_0x1c0d13[_0x3059f9(0x21b)]),console[_0x3059f9(0x1b6)]('Error\x20stack:',_0x1c0d13[_0x3059f9(0x214)]);throw new Error(_0x3059f9(0x1e0)+_0x1c0d13[_0x3059f9(0x21b)]);}throw new Error(_0x3059f9(0x1d5));}}async[a43_0x13fa8d(0x1cf)](_0x7db280){const _0x385e5b=a43_0x13fa8d,_0x515e98=Date['now']();try{loggerService_1['loggerService'][_0x385e5b(0x1e8)](_0x385e5b(0x1ce),_0x385e5b(0x1cc)+_0x7db280,_0x385e5b(0x203),{});const _0x2f5dee=await fetch(this[_0x385e5b(0x1d0)]+'/'+_0x7db280,{'method':_0x385e5b(0x203),'headers':{'Content-Type':_0x385e5b(0x1ad),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x5b15e2=Date[_0x385e5b(0x212)]()-_0x515e98;if(!_0x2f5dee['ok']){const _0x769783=await _0x2f5dee[_0x385e5b(0x1d8)]();loggerService_1['loggerService'][_0x385e5b(0x1ec)]('noda',_0x385e5b(0x1cc)+_0x7db280,_0x2f5dee[_0x385e5b(0x1bf)],_0x769783,_0x5b15e2);throw new Error(_0x385e5b(0x1f9)+_0x2f5dee[_0x385e5b(0x1bf)]);}const _0x566325=await _0x2f5dee[_0x385e5b(0x1ef)]();loggerService_1[_0x385e5b(0x200)]['logWhiteDomainResponse'](_0x385e5b(0x1ce),_0x385e5b(0x1cc)+_0x7db280,_0x2f5dee[_0x385e5b(0x1bf)],_0x566325,_0x5b15e2);if(_0x566325[_0x385e5b(0x1b6)]||_0x566325[_0x385e5b(0x1dc)]){loggerService_1['loggerService'][_0x385e5b(0x1c4)](_0x385e5b(0x1ce),'/payment-links/'+_0x7db280,_0x385e5b(0x21a)+(_0x566325[_0x385e5b(0x21b)]||_0x566325[_0x385e5b(0x1b6)]||_0x385e5b(0x1d1)));throw new Error(_0x385e5b(0x21a)+(_0x566325[_0x385e5b(0x21b)]||_0x566325[_0x385e5b(0x1b6)]||'Unknown\x20error'));}let _0x3113ab=_0x385e5b(0x1b0);if(_0x566325[_0x385e5b(0x205)]===![]){if(_0x566325[_0x385e5b(0x1fc)]){const _0x38f5a1=new Date(_0x566325[_0x385e5b(0x1fc)]),_0x56472a=new Date();_0x38f5a1<_0x56472a?_0x3113ab=_0x385e5b(0x1f5):_0x3113ab=_0x385e5b(0x207);}else _0x3113ab=_0x385e5b(0x207);}else _0x3113ab=_0x385e5b(0x1b0);return{'status':_0x3113ab,'amount':_0x566325['amount'],'currency':_0x566325['currency'],'isActive':_0x566325[_0x385e5b(0x205)]};}catch(_0x13c63a){console[_0x385e5b(0x1b6)](_0x385e5b(0x1a3),_0x13c63a),loggerService_1[_0x385e5b(0x200)][_0x385e5b(0x1c4)]('noda',_0x385e5b(0x1cc)+_0x7db280,_0x13c63a);throw new Error(_0x385e5b(0x1bd)+(_0x13c63a instanceof Error?_0x13c63a[_0x385e5b(0x21b)]:_0x385e5b(0x1d1)));}}async[a43_0x13fa8d(0x20b)](_0x37683d){const _0x4d1195=a43_0x13fa8d;console[_0x4d1195(0x1f8)](_0x4d1195(0x1ea),_0x37683d);let _0x1baf23=_0x4d1195(0x1b0);switch(_0x37683d[_0x4d1195(0x1a0)]?.[_0x4d1195(0x1fa)]()){case _0x4d1195(0x1a6):case _0x4d1195(0x1be):case _0x4d1195(0x1e4):case _0x4d1195(0x1bb):case _0x4d1195(0x1fb):_0x37683d['Settled']===_0x4d1195(0x1dd)?_0x1baf23=_0x4d1195(0x202):_0x1baf23='PENDING';break;case _0x4d1195(0x206):case _0x4d1195(0x213):case _0x4d1195(0x1c6):case _0x4d1195(0x1b6):case'rejected':_0x1baf23=_0x4d1195(0x207);break;case _0x4d1195(0x1cb):case'timeout':_0x1baf23=_0x4d1195(0x1f5);break;case _0x4d1195(0x1aa):case _0x4d1195(0x1e5):case _0x4d1195(0x20e):case _0x4d1195(0x1c8):case _0x4d1195(0x210):default:_0x1baf23=_0x4d1195(0x1b0);break;}return{'paymentId':_0x37683d['MerchantPaymentId']||_0x37683d[_0x4d1195(0x1c2)],'status':_0x1baf23,'amount':_0x37683d['Amount'],'currency':_0x37683d[_0x4d1195(0x1b1)],'additionalInfo':{'method':_0x37683d[_0x4d1195(0x1f7)],'bankId':_0x37683d[_0x4d1195(0x1ee)],'settled':_0x37683d['Settled'],'settlementDate':_0x37683d['SettlementDate'],'remitterName':_0x37683d['Remitter']?.[_0x4d1195(0x1df)],'remitterIban':_0x37683d[_0x4d1195(0x20f)]?.[_0x4d1195(0x1cd)],'bankTransactionId':_0x37683d[_0x4d1195(0x201)]}};}['verifyWebhookSignature'](_0x9506cf,_0x146f0e){const _0x15cfe0=a43_0x13fa8d;return console['log'](_0x15cfe0(0x1fd),{'receivedSignature':_0x146f0e,'paymentId':_0x9506cf['PaymentId'],'merchantPaymentId':_0x9506cf[_0x15cfe0(0x1a5)]}),!![];}}exports[a43_0x13fa8d(0x1c3)]=NodaService;