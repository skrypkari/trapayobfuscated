'use strict';const a46_0x401da1=a46_0x445e;(function(_0x53b91e,_0x3207c3){const _0x9c2436=a46_0x445e,_0x26ed51=_0x53b91e();while(!![]){try{const _0x4271b6=parseInt(_0x9c2436(0x132))/0x1*(-parseInt(_0x9c2436(0x15e))/0x2)+-parseInt(_0x9c2436(0x157))/0x3*(parseInt(_0x9c2436(0x154))/0x4)+-parseInt(_0x9c2436(0xfd))/0x5*(-parseInt(_0x9c2436(0x144))/0x6)+parseInt(_0x9c2436(0x113))/0x7*(parseInt(_0x9c2436(0x16e))/0x8)+parseInt(_0x9c2436(0x142))/0x9*(-parseInt(_0x9c2436(0x14e))/0xa)+parseInt(_0x9c2436(0x102))/0xb*(-parseInt(_0x9c2436(0x150))/0xc)+parseInt(_0x9c2436(0x11f))/0xd;if(_0x4271b6===_0x3207c3)break;else _0x26ed51['push'](_0x26ed51['shift']());}catch(_0x18feff){_0x26ed51['push'](_0x26ed51['shift']());}}}(a46_0x5624,0xaa750));function a46_0x5624(){const _0x5694a3=['Currency','shortLink','TesSoft\x20Payment\x20System/1.0','Short\x20Link:','log','Noda\x20webhook\x20signature\x20verification:','Error\x20stack:','Parsed\x20Result:','Response\x20Body:','statusCode','logWhiteDomainRequest','581LVzNsg','Method','../loggerService','Failed\x20to\x20verify\x20Noda\x20payment:\x20','BankTransactionId','noda','shortLinkUrls','Missing\x20id\x20or\x20shortLink\x20in\x20response','created','loggerService','stringify','success','32510101kuwFVZ','defineProperty','Unknown\x20error\x20from\x20Noda\x20API','logWhiteDomainError','/payment-links','isActive','===\x20NODA\x20API\x20ERROR\x20===','Name','rejected','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','logWhiteDomainResponse','now','cancelled','json','amount','entries','Settled','Failed\x20to\x20parse\x20JSON\x20response:','https://tesoft.uk/gateway/noda/','951277dkpzVo','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error','error','HTTP\x20error!\x20status:\x20','qrCodeLink','parse','===\x20NODA\x20SUCCESS\x20===','application/json','__esModule','Response\x20data:','toLowerCase','apiUrl','expired','Payment\x20Link\x20ID:','PAID','252xAOXWM','successful','9840yGnlzs','Noda\x20payment\x20verification\x20error:','Error\x20details:','HTTP\x20Status:','stack','Order\x20ID\x20Used:','text','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Business\x20Error:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','184970ewSbMa','JSON\x20Parse\x20Error:\x20','49476KtGUer','message','===\x20NODA\x20SERVICE\x20ERROR\x20===','FAILED','56tcIZHG','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','BankId','271836FVxskT','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Remitter','Status\x20Code:','Iban','headers','NodaService','2UPrQSr','Error\x20Message:','Yes','HTTP\x20','canceled','active','GET','expiryDate','Status','toUpperCase','Status\x20Text:','paid','Order\x20ID\x20Format:','pending','Amount','MerchantPaymentId','56152Stujuv','fromEntries','(8digits-8digits\x20format\x20for\x20Noda)','Response\x20Time:','in_progress','status','SettlementDate','PENDING','https://tesoft.uk/gateway/noda/webhook/','URL:','Noda\x20API\x20error:\x20','QR\x20Code\x20Link:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Headers:','2420kLbtaM','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','PaymentId','verifyPayment','done','1177SFmgzr','(8digits-8digits\x20format)','/payment-links/','EXPIRED','Raw\x20Response\x20Body:','Not\x20provided'];a46_0x5624=function(){return _0x5694a3;};return a46_0x5624();}Object[a46_0x401da1(0x120)](exports,a46_0x401da1(0x13b),{'value':!![]}),exports[a46_0x401da1(0x15d)]=void 0x0;const loggerService_1=require(a46_0x401da1(0x115));class NodaService{constructor(){const _0x43f7c3=a46_0x401da1;this[_0x43f7c3(0x13e)]=_0x43f7c3(0x131),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async['createPaymentLink'](_0x15f7d9){const _0x4d5202=a46_0x401da1,{orderId:_0x3c37cc,name:_0x4b3dbf,paymentDescription:_0x9fad82,amount:_0x2f9dd9,currency:_0x3352dc,webhookUrl:_0x520287,returnUrl:_0x4cf0db,expiryDate:_0x3205d5}=_0x15f7d9,_0x4e6172=_0x3352dc[_0x4d5202(0x167)](),_0x219713=_0x4d5202(0x176),_0xc362dc='https://tesoft.uk/gateway/pending.php?id='+_0x3c37cc,_0xd3a12a={'name':_0x4b3dbf,'paymentDescription':_0x9fad82,'amount':_0x2f9dd9,'currency':_0x4e6172,'paymentId':_0x3c37cc,'webhookUrl':_0x219713,'returnUrl':_0xc362dc};_0x3205d5&&(_0xd3a12a['expiryDate']=_0x3205d5);const _0x46f36d=Date[_0x4d5202(0x12a)]();try{console[_0x4d5202(0x10c)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x4d5202(0x10c)](_0x4d5202(0x177),this['apiUrl']),console[_0x4d5202(0x10c)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x4d5202(0x11d)](_0xd3a12a,null,0x2)),console['log'](_0x4d5202(0x16a),_0x3c37cc,_0x4d5202(0x170)),console[_0x4d5202(0x10c)](_0x4d5202(0x158),_0xc362dc),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x4d5202(0x118),'/payment-links','POST',_0xd3a12a);const _0x5621a6=await fetch(this[_0x4d5202(0x13e)],{'method':'POST','headers':{'Content-Type':_0x4d5202(0x13a),'Accept':'application/json','User-Agent':_0x4d5202(0x10a)},'body':JSON[_0x4d5202(0x11d)](_0xd3a12a)}),_0x5e8615=Date[_0x4d5202(0x12a)]()-_0x46f36d;console['log'](_0x4d5202(0xfe)),console[_0x4d5202(0x10c)]('Status:',_0x5621a6['status']),console[_0x4d5202(0x10c)](_0x4d5202(0x168),_0x5621a6['statusText']),console[_0x4d5202(0x10c)](_0x4d5202(0xfc),Object[_0x4d5202(0x16f)](_0x5621a6[_0x4d5202(0x15c)][_0x4d5202(0x12e)]())),console[_0x4d5202(0x10c)](_0x4d5202(0x171),_0x5e8615+'ms');const _0x548a92=await _0x5621a6[_0x4d5202(0x14a)]();console['log'](_0x4d5202(0x106),_0x548a92);if(!_0x5621a6['ok']){console[_0x4d5202(0x135)](_0x4d5202(0x125)),console[_0x4d5202(0x135)](_0x4d5202(0x147),_0x5621a6['status']),console[_0x4d5202(0x135)](_0x4d5202(0x110),_0x548a92),loggerService_1[_0x4d5202(0x11c)][_0x4d5202(0x129)](_0x4d5202(0x118),_0x4d5202(0x123),_0x5621a6[_0x4d5202(0x173)],_0x548a92,_0x5e8615),loggerService_1[_0x4d5202(0x11c)][_0x4d5202(0x122)](_0x4d5202(0x118),_0x4d5202(0x123),_0x4d5202(0x161)+_0x5621a6[_0x4d5202(0x173)]+':\x20'+_0x548a92);if(_0x5621a6[_0x4d5202(0x173)]===0x190)throw new Error(_0x4d5202(0x128));else{if(_0x5621a6[_0x4d5202(0x173)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x4d5202(0x136)+_0x5621a6['status']+',\x20body:\x20'+_0x548a92);}let _0x5e865b;try{_0x5e865b=JSON[_0x4d5202(0x138)](_0x548a92);}catch(_0x25ea52){console[_0x4d5202(0x135)](_0x4d5202(0x130),_0x25ea52),loggerService_1[_0x4d5202(0x11c)][_0x4d5202(0x122)](_0x4d5202(0x118),_0x4d5202(0x123),_0x4d5202(0x14f)+_0x25ea52);throw new Error(_0x4d5202(0xfb)+_0x548a92);}console[_0x4d5202(0x10c)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console['log'](_0x4d5202(0x10f),JSON[_0x4d5202(0x11d)](_0x5e865b,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4d5202(0x118),_0x4d5202(0x123),_0x5621a6[_0x4d5202(0x173)],_0x5e865b,_0x5e8615);if(_0x5e865b[_0x4d5202(0x135)]||_0x5e865b[_0x4d5202(0x111)]){const _0x28049e=_0x5e865b['message']||_0x5e865b[_0x4d5202(0x135)]||_0x4d5202(0x121);console[_0x4d5202(0x135)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x4d5202(0x135)](_0x4d5202(0x15f),_0x28049e),console['error'](_0x4d5202(0x15a),_0x5e865b['statusCode']),loggerService_1['loggerService'][_0x4d5202(0x122)]('noda',_0x4d5202(0x123),_0x4d5202(0x14c)+_0x28049e);throw new Error(_0x4d5202(0x178)+_0x28049e);}if(!_0x5e865b['id']||!_0x5e865b['shortLinkUrls']?.['shortLink']){console['error'](_0x4d5202(0x133)),console['error'](_0x4d5202(0x11a)),console[_0x4d5202(0x135)](_0x4d5202(0x13c),_0x5e865b),loggerService_1[_0x4d5202(0x11c)][_0x4d5202(0x122)](_0x4d5202(0x118),_0x4d5202(0x123),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x4d5202(0x10c)](_0x4d5202(0x139)),console[_0x4d5202(0x10c)](_0x4d5202(0x140),_0x5e865b['id']),console[_0x4d5202(0x10c)](_0x4d5202(0x10b),_0x5e865b[_0x4d5202(0x119)][_0x4d5202(0x109)]),console[_0x4d5202(0x10c)](_0x4d5202(0x179),_0x5e865b[_0x4d5202(0x119)][_0x4d5202(0x137)]||_0x4d5202(0x107)),console[_0x4d5202(0x10c)](_0x4d5202(0x149),_0x3c37cc,_0x4d5202(0x103)),console[_0x4d5202(0x10c)](_0x4d5202(0x14b),_0xc362dc),{'gateway_payment_id':_0x5e865b['id'],'payment_url':_0x5e865b['shortLinkUrls']['shortLink'],'qr_code_url':_0x5e865b[_0x4d5202(0x119)][_0x4d5202(0x137)],'expiry_date':_0x5e865b[_0x4d5202(0x165)]};}catch(_0x15cc7e){console[_0x4d5202(0x135)](_0x4d5202(0x152)),console[_0x4d5202(0x135)](_0x4d5202(0x146),_0x15cc7e),loggerService_1[_0x4d5202(0x11c)][_0x4d5202(0x122)](_0x4d5202(0x118),_0x4d5202(0x123),_0x15cc7e);if(_0x15cc7e instanceof Error){console[_0x4d5202(0x135)]('Error\x20message:',_0x15cc7e[_0x4d5202(0x151)]),console[_0x4d5202(0x135)](_0x4d5202(0x10e),_0x15cc7e[_0x4d5202(0x148)]);throw new Error(_0x4d5202(0x14d)+_0x15cc7e['message']);}throw new Error(_0x4d5202(0x155));}}async[a46_0x401da1(0x100)](_0x10a786){const _0x480996=a46_0x401da1,_0x37b04a=Date[_0x480996(0x12a)]();try{loggerService_1[_0x480996(0x11c)][_0x480996(0x112)](_0x480996(0x118),'/payment-links/'+_0x10a786,_0x480996(0x164),{});const _0x1d7bed=await fetch(this[_0x480996(0x13e)]+'/'+_0x10a786,{'method':'GET','headers':{'Content-Type':_0x480996(0x13a),'User-Agent':_0x480996(0x10a)}}),_0x5b5938=Date[_0x480996(0x12a)]()-_0x37b04a;if(!_0x1d7bed['ok']){const _0x8bd918=await _0x1d7bed[_0x480996(0x14a)]();loggerService_1[_0x480996(0x11c)][_0x480996(0x129)]('noda',_0x480996(0x104)+_0x10a786,_0x1d7bed[_0x480996(0x173)],_0x8bd918,_0x5b5938);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1d7bed[_0x480996(0x173)]);}const _0x524f67=await _0x1d7bed[_0x480996(0x12c)]();loggerService_1[_0x480996(0x11c)][_0x480996(0x129)](_0x480996(0x118),_0x480996(0x104)+_0x10a786,_0x1d7bed['status'],_0x524f67,_0x5b5938);if(_0x524f67['error']||_0x524f67[_0x480996(0x111)]){loggerService_1['loggerService'][_0x480996(0x122)]('noda','/payment-links/'+_0x10a786,_0x480996(0x178)+(_0x524f67[_0x480996(0x151)]||_0x524f67['error']||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x524f67[_0x480996(0x151)]||_0x524f67['error']||_0x480996(0x134)));}let _0x3bf600='PENDING';if(_0x524f67[_0x480996(0x124)]===![]){if(_0x524f67[_0x480996(0x165)]){const _0xb344ed=new Date(_0x524f67[_0x480996(0x165)]),_0x9a7837=new Date();_0xb344ed<_0x9a7837?_0x3bf600=_0x480996(0x105):_0x3bf600=_0x480996(0x153);}else _0x3bf600=_0x480996(0x153);}else _0x3bf600='PENDING';return{'status':_0x3bf600,'amount':_0x524f67[_0x480996(0x12d)],'currency':_0x524f67['currency'],'isActive':_0x524f67[_0x480996(0x124)]};}catch(_0x2e64aa){console[_0x480996(0x135)](_0x480996(0x145),_0x2e64aa),loggerService_1['loggerService'][_0x480996(0x122)](_0x480996(0x118),_0x480996(0x104)+_0x10a786,_0x2e64aa);throw new Error(_0x480996(0x116)+(_0x2e64aa instanceof Error?_0x2e64aa[_0x480996(0x151)]:_0x480996(0x134)));}}async['processWebhook'](_0x757c3e){const _0x299ac4=a46_0x401da1;console[_0x299ac4(0x10c)]('Processing\x20Noda\x20webhook:',_0x757c3e);let _0x195ea0=_0x299ac4(0x175);switch(_0x757c3e[_0x299ac4(0x166)]?.[_0x299ac4(0x13d)]()){case _0x299ac4(0x101):case'completed':case _0x299ac4(0x169):case _0x299ac4(0x11e):case _0x299ac4(0x143):_0x757c3e[_0x299ac4(0x12f)]===_0x299ac4(0x160)?_0x195ea0=_0x299ac4(0x141):_0x195ea0=_0x299ac4(0x175);break;case _0x299ac4(0x12b):case _0x299ac4(0x162):case'failed':case'error':case _0x299ac4(0x127):_0x195ea0=_0x299ac4(0x153);break;case _0x299ac4(0x13f):case'timeout':_0x195ea0='EXPIRED';break;case _0x299ac4(0x16b):case _0x299ac4(0x11b):case _0x299ac4(0x163):case'processing':case _0x299ac4(0x172):default:_0x195ea0=_0x299ac4(0x175);break;}return{'paymentId':_0x757c3e[_0x299ac4(0x16d)]||_0x757c3e[_0x299ac4(0xff)],'status':_0x195ea0,'amount':_0x757c3e[_0x299ac4(0x16c)],'currency':_0x757c3e[_0x299ac4(0x108)],'additionalInfo':{'method':_0x757c3e[_0x299ac4(0x114)],'bankId':_0x757c3e[_0x299ac4(0x156)],'settled':_0x757c3e[_0x299ac4(0x12f)],'settlementDate':_0x757c3e[_0x299ac4(0x174)],'remitterName':_0x757c3e[_0x299ac4(0x159)]?.[_0x299ac4(0x126)],'remitterIban':_0x757c3e[_0x299ac4(0x159)]?.[_0x299ac4(0x15b)],'bankTransactionId':_0x757c3e[_0x299ac4(0x117)]}};}['verifyWebhookSignature'](_0x448f69,_0xcaadfe){const _0x3bbc22=a46_0x401da1;return console[_0x3bbc22(0x10c)](_0x3bbc22(0x10d),{'receivedSignature':_0xcaadfe,'paymentId':_0x448f69[_0x3bbc22(0xff)],'merchantPaymentId':_0x448f69[_0x3bbc22(0x16d)]}),!![];}}function a46_0x445e(_0x465ae7,_0x1ec6f7){const _0x56247f=a46_0x5624();return a46_0x445e=function(_0x445e85,_0x56fcb4){_0x445e85=_0x445e85-0xfb;let _0x2848a2=_0x56247f[_0x445e85];return _0x2848a2;},a46_0x445e(_0x465ae7,_0x1ec6f7);}exports[a46_0x401da1(0x15d)]=NodaService;