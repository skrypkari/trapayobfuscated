'use strict';const a71_0x5d32f0=a71_0x1eb7;(function(_0x5b0d36,_0x8d29a9){const _0x66222f=a71_0x1eb7,_0x4e1db5=_0x5b0d36();while(!![]){try{const _0x3acf2f=parseInt(_0x66222f(0x1b9))/0x1+parseInt(_0x66222f(0x1b3))/0x2+-parseInt(_0x66222f(0x1d5))/0x3+-parseInt(_0x66222f(0x209))/0x4+-parseInt(_0x66222f(0x1c7))/0x5*(parseInt(_0x66222f(0x214))/0x6)+parseInt(_0x66222f(0x1ba))/0x7+parseInt(_0x66222f(0x21a))/0x8;if(_0x3acf2f===_0x8d29a9)break;else _0x4e1db5['push'](_0x4e1db5['shift']());}catch(_0x328c3e){_0x4e1db5['push'](_0x4e1db5['shift']());}}}(a71_0x15c5,0xc399d));function a71_0x15c5(){const _0x5cd029=['HTTP\x20','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','statusCode','===\x20NODA\x20SUCCESS\x20===','102246fNCMps','shortLinkUrls','shortLink','rejected','HTTP\x20error!\x20status:\x20','paid','3047144wyecBS','pending','Remitter','EXPIRED','Order\x20ID\x20Format:','Yes','QR\x20Code\x20Link:','Unknown\x20error','Iban','MerchantPaymentId','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','failed','Noda\x20payment\x20verification\x20error:','Processing\x20Noda\x20webhook:','defineProperty','qrCodeLink','SettlementDate','Method','https://tesoft.uk/gateway/noda/webhook/','Payment\x20Link\x20ID:','1335402IOElcD','toLowerCase','Not\x20provided','verifyPayment','PENDING','text','658987BPKOTi','7725851ixeiwq','Order\x20ID\x20Used:','https://tesoft.uk/gateway/pending.php?id=','Response\x20Time:','done','Status:','Settled','stringify','Error\x20message:','createPaymentLink','__esModule','URL:','message','240sIZqOd','error','expiryDate','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Name','application/json','GET','logWhiteDomainRequest','loggerService','apiUrl','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','isActive','Business\x20Error:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','158889YFCPPj','success','Noda\x20API\x20error:\x20','verifyWebhookSignature','successful','active','in_progress','canceled','Currency','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','HTTP\x20Status:','(8digits-8digits\x20format\x20for\x20Noda)','PaymentId','NodaService','Short\x20Link:','PAID','noda','/payment-links/','POST','Error\x20details:','toUpperCase','cancelled','Payment\x20System/1.0','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','JSON\x20Parse\x20Error:\x20','currency','completed','now','FAILED','../loggerService',',\x20body:\x20','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Status','https://tesoft.uk/gateway/noda/','Unknown\x20error\x20from\x20Noda\x20API','Raw\x20Response\x20Body:','status','Status\x20Text:','(8digits-8digits\x20format)','/payment-links','Request\x20Body\x20(Direct\x20JSON):','logWhiteDomainError','Failed\x20to\x20verify\x20Noda\x20payment:\x20','BankTransactionId','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Missing\x20id\x20or\x20shortLink\x20in\x20response','logWhiteDomainResponse','BankId','Noda\x20webhook\x20signature\x20verification:','===\x20NODA\x20SERVICE\x20ERROR\x20===','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','4556648WLOygy','expired','Amount','processWebhook','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','log','Parsed\x20Result:'];a71_0x15c5=function(){return _0x5cd029;};return a71_0x15c5();}Object[a71_0x5d32f0(0x1ad)](exports,a71_0x5d32f0(0x1c4),{'value':!![]}),exports[a71_0x5d32f0(0x1e2)]=void 0x0;const loggerService_1=require(a71_0x5d32f0(0x1f2));function a71_0x1eb7(_0xdb082c,_0x3ec7fc){_0xdb082c=_0xdb082c-0x1a6;const _0x15c5ff=a71_0x15c5();let _0x1eb70c=_0x15c5ff[_0xdb082c];return _0x1eb70c;}class NodaService{constructor(){const _0x198f24=a71_0x5d32f0;this[_0x198f24(0x1d0)]=_0x198f24(0x1f7),console[_0x198f24(0x20e)](_0x198f24(0x1f5));}async[a71_0x5d32f0(0x1c3)](_0x2e98d8){const _0x5a96e1=a71_0x5d32f0,{orderId:_0x876bb1,name:_0x5ac450,paymentDescription:_0x3a1025,amount:_0x11884e,currency:_0xe1ddb0,webhookUrl:_0x250b93,returnUrl:_0x381cfd,expiryDate:_0x10995e}=_0x2e98d8,_0x52b943=_0xe1ddb0[_0x5a96e1(0x1e9)](),_0x2dedb0=_0x5a96e1(0x1b1),_0x502cc1=_0x5a96e1(0x1bc)+_0x876bb1,_0x2d7509={'name':_0x5ac450,'paymentDescription':_0x3a1025,'amount':_0x11884e,'currency':_0x52b943,'paymentId':_0x876bb1,'webhookUrl':_0x2dedb0,'returnUrl':_0x502cc1};_0x10995e&&(_0x2d7509[_0x5a96e1(0x1c9)]=_0x10995e);const _0x46e1a2=Date[_0x5a96e1(0x1f0)]();try{console[_0x5a96e1(0x20e)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console['log'](_0x5a96e1(0x1c5),this[_0x5a96e1(0x1d0)]),console[_0x5a96e1(0x20e)](_0x5a96e1(0x1fe),JSON['stringify'](_0x2d7509,null,0x2)),console[_0x5a96e1(0x20e)](_0x5a96e1(0x21e),_0x876bb1,_0x5a96e1(0x1e0)),console['log'](_0x5a96e1(0x1a9),_0x502cc1),loggerService_1['loggerService'][_0x5a96e1(0x1ce)](_0x5a96e1(0x1e5),_0x5a96e1(0x1fd),_0x5a96e1(0x1e7),_0x2d7509);const _0x47bb3d=await fetch(this['apiUrl'],{'method':_0x5a96e1(0x1e7),'headers':{'Content-Type':'application/json','Accept':_0x5a96e1(0x1cc),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x5a96e1(0x1c1)](_0x2d7509)}),_0x546c21=Date[_0x5a96e1(0x1f0)]()-_0x46e1a2;console[_0x5a96e1(0x20e)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x5a96e1(0x20e)](_0x5a96e1(0x1bf),_0x47bb3d[_0x5a96e1(0x1fa)]),console['log'](_0x5a96e1(0x1fb),_0x47bb3d['statusText']),console['log']('Headers:',Object['fromEntries'](_0x47bb3d['headers']['entries']())),console[_0x5a96e1(0x20e)](_0x5a96e1(0x1bd),_0x546c21+'ms');const _0x4b417f=await _0x47bb3d[_0x5a96e1(0x1b8)]();console['log'](_0x5a96e1(0x1f9),_0x4b417f);if(!_0x47bb3d['ok']){console[_0x5a96e1(0x1c8)]('===\x20NODA\x20API\x20ERROR\x20==='),console['error'](_0x5a96e1(0x1df),_0x47bb3d[_0x5a96e1(0x1fa)]),console[_0x5a96e1(0x1c8)]('Response\x20Body:',_0x4b417f),loggerService_1[_0x5a96e1(0x1cf)]['logWhiteDomainResponse'](_0x5a96e1(0x1e5),_0x5a96e1(0x1fd),_0x47bb3d[_0x5a96e1(0x1fa)],_0x4b417f,_0x546c21),loggerService_1['loggerService'][_0x5a96e1(0x1ff)]('noda',_0x5a96e1(0x1fd),_0x5a96e1(0x210)+_0x47bb3d[_0x5a96e1(0x1fa)]+':\x20'+_0x4b417f);if(_0x47bb3d[_0x5a96e1(0x1fa)]===0x190)throw new Error(_0x5a96e1(0x211));else{if(_0x47bb3d['status']===0x1f4)throw new Error(_0x5a96e1(0x20d));}throw new Error(_0x5a96e1(0x218)+_0x47bb3d['status']+_0x5a96e1(0x1f3)+_0x4b417f);}let _0x281d4e;try{_0x281d4e=JSON['parse'](_0x4b417f);}catch(_0x2b8198){console[_0x5a96e1(0x1c8)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x2b8198),loggerService_1[_0x5a96e1(0x1cf)][_0x5a96e1(0x1ff)](_0x5a96e1(0x1e5),_0x5a96e1(0x1fd),_0x5a96e1(0x1ed)+_0x2b8198);throw new Error(_0x5a96e1(0x1de)+_0x4b417f);}console[_0x5a96e1(0x20e)](_0x5a96e1(0x1ca)),console[_0x5a96e1(0x20e)](_0x5a96e1(0x20f),JSON['stringify'](_0x281d4e,null,0x2)),loggerService_1['loggerService'][_0x5a96e1(0x204)](_0x5a96e1(0x1e5),'/payment-links',_0x47bb3d[_0x5a96e1(0x1fa)],_0x281d4e,_0x546c21);if(_0x281d4e[_0x5a96e1(0x1c8)]||_0x281d4e['statusCode']){const _0xe22846=_0x281d4e[_0x5a96e1(0x1c6)]||_0x281d4e[_0x5a96e1(0x1c8)]||_0x5a96e1(0x1f8);console[_0x5a96e1(0x1c8)](_0x5a96e1(0x202)),console[_0x5a96e1(0x1c8)]('Error\x20Message:',_0xe22846),console[_0x5a96e1(0x1c8)]('Status\x20Code:',_0x281d4e[_0x5a96e1(0x212)]),loggerService_1[_0x5a96e1(0x1cf)][_0x5a96e1(0x1ff)](_0x5a96e1(0x1e5),'/payment-links',_0x5a96e1(0x1d3)+_0xe22846);throw new Error(_0x5a96e1(0x1d7)+_0xe22846);}if(!_0x281d4e['id']||!_0x281d4e[_0x5a96e1(0x215)]?.[_0x5a96e1(0x216)]){console[_0x5a96e1(0x1c8)](_0x5a96e1(0x1d1)),console[_0x5a96e1(0x1c8)](_0x5a96e1(0x203)),console['error']('Response\x20data:',_0x281d4e),loggerService_1[_0x5a96e1(0x1cf)][_0x5a96e1(0x1ff)]('noda','/payment-links',_0x5a96e1(0x1ec));throw new Error(_0x5a96e1(0x208));}return console[_0x5a96e1(0x20e)](_0x5a96e1(0x213)),console[_0x5a96e1(0x20e)](_0x5a96e1(0x1b2),_0x281d4e['id']),console[_0x5a96e1(0x20e)](_0x5a96e1(0x1e3),_0x281d4e[_0x5a96e1(0x215)]['shortLink']),console['log'](_0x5a96e1(0x220),_0x281d4e['shortLinkUrls']['qrCodeLink']||_0x5a96e1(0x1b5)),console[_0x5a96e1(0x20e)](_0x5a96e1(0x1bb),_0x876bb1,_0x5a96e1(0x1fc)),console['log'](_0x5a96e1(0x1f4),_0x502cc1),{'gateway_payment_id':_0x281d4e['id'],'payment_url':_0x281d4e[_0x5a96e1(0x215)]['shortLink'],'qr_code_url':_0x281d4e[_0x5a96e1(0x215)][_0x5a96e1(0x1ae)],'expiry_date':_0x281d4e[_0x5a96e1(0x1c9)]};}catch(_0x26ed7b){console[_0x5a96e1(0x1c8)](_0x5a96e1(0x207)),console[_0x5a96e1(0x1c8)](_0x5a96e1(0x1e8),_0x26ed7b),loggerService_1[_0x5a96e1(0x1cf)][_0x5a96e1(0x1ff)](_0x5a96e1(0x1e5),'/payment-links',_0x26ed7b);if(_0x26ed7b instanceof Error){console[_0x5a96e1(0x1c8)](_0x5a96e1(0x1c2),_0x26ed7b['message']),console[_0x5a96e1(0x1c8)]('Error\x20stack:',_0x26ed7b['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x26ed7b[_0x5a96e1(0x1c6)]);}throw new Error(_0x5a96e1(0x1d4));}}async[a71_0x5d32f0(0x1b6)](_0x5b51b6){const _0x3253f0=a71_0x5d32f0,_0x1b1b97=Date['now']();try{loggerService_1[_0x3253f0(0x1cf)]['logWhiteDomainRequest']('noda',_0x3253f0(0x1e6)+_0x5b51b6,_0x3253f0(0x1cd),{});const _0x3f3437=await fetch(this['apiUrl']+'/'+_0x5b51b6,{'method':'GET','headers':{'Content-Type':_0x3253f0(0x1cc),'User-Agent':_0x3253f0(0x1eb)}}),_0x545703=Date[_0x3253f0(0x1f0)]()-_0x1b1b97;if(!_0x3f3437['ok']){const _0x238b0e=await _0x3f3437[_0x3253f0(0x1b8)]();loggerService_1[_0x3253f0(0x1cf)]['logWhiteDomainResponse']('noda',_0x3253f0(0x1e6)+_0x5b51b6,_0x3f3437[_0x3253f0(0x1fa)],_0x238b0e,_0x545703);throw new Error(_0x3253f0(0x218)+_0x3f3437[_0x3253f0(0x1fa)]);}const _0x5d3406=await _0x3f3437['json']();loggerService_1[_0x3253f0(0x1cf)][_0x3253f0(0x204)](_0x3253f0(0x1e5),_0x3253f0(0x1e6)+_0x5b51b6,_0x3f3437[_0x3253f0(0x1fa)],_0x5d3406,_0x545703);if(_0x5d3406[_0x3253f0(0x1c8)]||_0x5d3406['statusCode']){loggerService_1[_0x3253f0(0x1cf)]['logWhiteDomainError']('noda',_0x3253f0(0x1e6)+_0x5b51b6,_0x3253f0(0x1d7)+(_0x5d3406[_0x3253f0(0x1c6)]||_0x5d3406[_0x3253f0(0x1c8)]||_0x3253f0(0x1a6)));throw new Error('Noda\x20API\x20error:\x20'+(_0x5d3406['message']||_0x5d3406[_0x3253f0(0x1c8)]||_0x3253f0(0x1a6)));}let _0x4a649e=_0x3253f0(0x1b7);if(_0x5d3406[_0x3253f0(0x1d2)]===![]){if(_0x5d3406[_0x3253f0(0x1c9)]){const _0x7ea61f=new Date(_0x5d3406[_0x3253f0(0x1c9)]),_0x32d053=new Date();_0x7ea61f<_0x32d053?_0x4a649e=_0x3253f0(0x21d):_0x4a649e=_0x3253f0(0x1f1);}else _0x4a649e=_0x3253f0(0x1f1);}else _0x4a649e=_0x3253f0(0x1b7);return{'status':_0x4a649e,'amount':_0x5d3406['amount'],'currency':_0x5d3406[_0x3253f0(0x1ee)],'isActive':_0x5d3406['isActive']};}catch(_0x121b00){console[_0x3253f0(0x1c8)](_0x3253f0(0x1ab),_0x121b00),loggerService_1['loggerService']['logWhiteDomainError'](_0x3253f0(0x1e5),_0x3253f0(0x1e6)+_0x5b51b6,_0x121b00);throw new Error(_0x3253f0(0x200)+(_0x121b00 instanceof Error?_0x121b00['message']:_0x3253f0(0x1a6)));}}async[a71_0x5d32f0(0x20c)](_0x4788e2){const _0x1a7424=a71_0x5d32f0;console[_0x1a7424(0x20e)](_0x1a7424(0x1ac),_0x4788e2);let _0x11ba48='PENDING';switch(_0x4788e2[_0x1a7424(0x1f6)]?.[_0x1a7424(0x1b4)]()){case _0x1a7424(0x1be):case _0x1a7424(0x1ef):case _0x1a7424(0x219):case _0x1a7424(0x1d6):case _0x1a7424(0x1d9):_0x4788e2[_0x1a7424(0x1c0)]===_0x1a7424(0x21f)?_0x11ba48=_0x1a7424(0x1e4):_0x11ba48=_0x1a7424(0x1b7);break;case _0x1a7424(0x1ea):case _0x1a7424(0x1dc):case _0x1a7424(0x1aa):case _0x1a7424(0x1c8):case _0x1a7424(0x217):_0x11ba48=_0x1a7424(0x1f1);break;case _0x1a7424(0x20a):case'timeout':_0x11ba48=_0x1a7424(0x21d);break;case _0x1a7424(0x21b):case'created':case _0x1a7424(0x1da):case'processing':case _0x1a7424(0x1db):default:_0x11ba48=_0x1a7424(0x1b7);break;}return{'paymentId':_0x4788e2['MerchantPaymentId']||_0x4788e2['PaymentId'],'status':_0x11ba48,'amount':_0x4788e2[_0x1a7424(0x20b)],'currency':_0x4788e2[_0x1a7424(0x1dd)],'additionalInfo':{'method':_0x4788e2[_0x1a7424(0x1b0)],'bankId':_0x4788e2[_0x1a7424(0x205)],'settled':_0x4788e2[_0x1a7424(0x1c0)],'settlementDate':_0x4788e2[_0x1a7424(0x1af)],'remitterName':_0x4788e2[_0x1a7424(0x21c)]?.[_0x1a7424(0x1cb)],'remitterIban':_0x4788e2[_0x1a7424(0x21c)]?.[_0x1a7424(0x1a7)],'bankTransactionId':_0x4788e2[_0x1a7424(0x201)]}};}[a71_0x5d32f0(0x1d8)](_0x48fcee,_0xb3a640){const _0x4f37ec=a71_0x5d32f0;return console[_0x4f37ec(0x20e)](_0x4f37ec(0x206),{'receivedSignature':_0xb3a640,'paymentId':_0x48fcee[_0x4f37ec(0x1e1)],'merchantPaymentId':_0x48fcee[_0x4f37ec(0x1a8)]}),!![];}}exports[a71_0x5d32f0(0x1e2)]=NodaService;