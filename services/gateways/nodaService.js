'use strict';const a40_0xf4166b=a40_0x4188;(function(_0x59c204,_0x7144fa){const _0x2add07=a40_0x4188,_0x49ddb8=_0x59c204();while(!![]){try{const _0x22e1cb=-parseInt(_0x2add07(0x12e))/0x1+-parseInt(_0x2add07(0xe8))/0x2+parseInt(_0x2add07(0xd6))/0x3+parseInt(_0x2add07(0x131))/0x4*(parseInt(_0x2add07(0xf9))/0x5)+parseInt(_0x2add07(0xfd))/0x6+-parseInt(_0x2add07(0x115))/0x7+-parseInt(_0x2add07(0xe6))/0x8*(-parseInt(_0x2add07(0xeb))/0x9);if(_0x22e1cb===_0x7144fa)break;else _0x49ddb8['push'](_0x49ddb8['shift']());}catch(_0x2a559b){_0x49ddb8['push'](_0x49ddb8['shift']());}}}(a40_0x5ddf,0xc52c7));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a40_0xf4166b(0xed)]=void 0x0;function a40_0x4188(_0xf01547,_0x95f7a0){const _0x5ddf07=a40_0x5ddf();return a40_0x4188=function(_0x418814,_0x14ef33){_0x418814=_0x418814-0xbd;let _0x4df9ce=_0x5ddf07[_0x418814];return _0x4df9ce;},a40_0x4188(_0xf01547,_0x95f7a0);}const loggerService_1=require(a40_0xf4166b(0x116));class NodaService{constructor(){const _0x5b0351=a40_0xf4166b;this[_0x5b0351(0xd0)]='https://tesoft.uk/gateway/noda/',console[_0x5b0351(0xc6)](_0x5b0351(0xf2));}async[a40_0xf4166b(0x10c)](_0x4f8433){const _0x3da6ec=a40_0xf4166b,{orderId:_0x1de32e,name:_0x3336ba,paymentDescription:_0x25d515,amount:_0x51f787,currency:_0x3cccf7,webhookUrl:_0x1bc458,returnUrl:_0x42edc2,expiryDate:_0x2df7dc}=_0x4f8433,_0x966693=_0x3cccf7['toUpperCase'](),_0x16ad63=_0x3da6ec(0x110),_0x41b626='https://tesoft.uk/gateway/success.php?id='+_0x1de32e,_0x4f166e={'name':_0x3336ba,'paymentDescription':_0x25d515,'amount':_0x51f787,'currency':_0x966693,'paymentId':_0x1de32e,'webhookUrl':_0x16ad63,'returnUrl':_0x41b626};_0x2df7dc&&(_0x4f166e[_0x3da6ec(0x120)]=_0x2df7dc);const _0x5efac7=Date['now']();try{console[_0x3da6ec(0xc6)](_0x3da6ec(0xe4)),console[_0x3da6ec(0xc6)](_0x3da6ec(0xc0),this['apiUrl']),console[_0x3da6ec(0xc6)](_0x3da6ec(0x12a),JSON[_0x3da6ec(0x124)](_0x4f166e,null,0x2)),console[_0x3da6ec(0xc6)](_0x3da6ec(0xcf),_0x1de32e,'(8digits-8digits\x20format\x20for\x20Noda)'),loggerService_1['loggerService'][_0x3da6ec(0xdd)](_0x3da6ec(0xd2),'/payment-links',_0x3da6ec(0x11e),_0x4f166e);const _0x44d546=await fetch(this[_0x3da6ec(0xd0)],{'method':_0x3da6ec(0x11e),'headers':{'Content-Type':'application/json','Accept':_0x3da6ec(0x133),'User-Agent':_0x3da6ec(0xfe)},'body':JSON['stringify'](_0x4f166e)}),_0x22812a=Date[_0x3da6ec(0xdf)]()-_0x5efac7;console['log'](_0x3da6ec(0xd7)),console[_0x3da6ec(0xc6)]('Status:',_0x44d546['status']),console['log'](_0x3da6ec(0xc7),_0x44d546[_0x3da6ec(0x105)]),console[_0x3da6ec(0xc6)]('Headers:',Object[_0x3da6ec(0xe7)](_0x44d546['headers'][_0x3da6ec(0xda)]())),console[_0x3da6ec(0xc6)](_0x3da6ec(0x11d),_0x22812a+'ms');const _0x31f103=await _0x44d546[_0x3da6ec(0xfb)]();console[_0x3da6ec(0xc6)](_0x3da6ec(0xd5),_0x31f103);if(!_0x44d546['ok']){console['error'](_0x3da6ec(0x100)),console[_0x3da6ec(0x10e)](_0x3da6ec(0xea),_0x44d546[_0x3da6ec(0xe5)]),console[_0x3da6ec(0x10e)](_0x3da6ec(0x11b),_0x31f103),loggerService_1[_0x3da6ec(0x132)][_0x3da6ec(0x106)](_0x3da6ec(0xd2),_0x3da6ec(0xf5),_0x44d546[_0x3da6ec(0xe5)],_0x31f103,_0x22812a),loggerService_1[_0x3da6ec(0x132)][_0x3da6ec(0x126)](_0x3da6ec(0xd2),_0x3da6ec(0xf5),_0x3da6ec(0xc9)+_0x44d546[_0x3da6ec(0xe5)]+':\x20'+_0x31f103);if(_0x44d546[_0x3da6ec(0xe5)]===0x190)throw new Error(_0x3da6ec(0x121));else{if(_0x44d546['status']===0x1f4)throw new Error(_0x3da6ec(0xff));}throw new Error(_0x3da6ec(0xf8)+_0x44d546[_0x3da6ec(0xe5)]+_0x3da6ec(0x12c)+_0x31f103);}let _0x2cce9c;try{_0x2cce9c=JSON[_0x3da6ec(0xf7)](_0x31f103);}catch(_0x184640){console['error'](_0x3da6ec(0x101),_0x184640),loggerService_1['loggerService'][_0x3da6ec(0x126)](_0x3da6ec(0xd2),_0x3da6ec(0xf5),_0x3da6ec(0x102)+_0x184640);throw new Error(_0x3da6ec(0xd8)+_0x31f103);}console['log'](_0x3da6ec(0x111)),console['log'](_0x3da6ec(0x119),JSON[_0x3da6ec(0x124)](_0x2cce9c,null,0x2)),loggerService_1['loggerService'][_0x3da6ec(0x106)](_0x3da6ec(0xd2),_0x3da6ec(0xf5),_0x44d546[_0x3da6ec(0xe5)],_0x2cce9c,_0x22812a);if(_0x2cce9c['error']||_0x2cce9c[_0x3da6ec(0x125)]){const _0x34d5ef=_0x2cce9c[_0x3da6ec(0xee)]||_0x2cce9c['error']||_0x3da6ec(0xf0);console['error'](_0x3da6ec(0xde)),console[_0x3da6ec(0x10e)](_0x3da6ec(0x114),_0x34d5ef),console[_0x3da6ec(0x10e)](_0x3da6ec(0xe0),_0x2cce9c['statusCode']),loggerService_1[_0x3da6ec(0x132)][_0x3da6ec(0x126)](_0x3da6ec(0xd2),'/payment-links',_0x3da6ec(0xce)+_0x34d5ef);throw new Error('Noda\x20API\x20error:\x20'+_0x34d5ef);}if(!_0x2cce9c['id']||!_0x2cce9c[_0x3da6ec(0xc3)]?.[_0x3da6ec(0xfc)]){console[_0x3da6ec(0x10e)](_0x3da6ec(0xdc)),console['error'](_0x3da6ec(0x122)),console['error'](_0x3da6ec(0x130),_0x2cce9c),loggerService_1[_0x3da6ec(0x132)][_0x3da6ec(0x126)]('noda','/payment-links',_0x3da6ec(0xe2));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x3da6ec(0xc6)](_0x3da6ec(0x129)),console[_0x3da6ec(0xc6)](_0x3da6ec(0x11a),_0x2cce9c['id']),console['log'](_0x3da6ec(0xbd),_0x2cce9c[_0x3da6ec(0xc3)][_0x3da6ec(0xfc)]),console[_0x3da6ec(0xc6)]('QR\x20Code\x20Link:',_0x2cce9c['shortLinkUrls'][_0x3da6ec(0xd1)]||_0x3da6ec(0x11c)),console[_0x3da6ec(0xc6)](_0x3da6ec(0x10b),_0x1de32e,_0x3da6ec(0x107)),{'gateway_payment_id':_0x2cce9c['id'],'payment_url':_0x2cce9c[_0x3da6ec(0xc3)][_0x3da6ec(0xfc)],'qr_code_url':_0x2cce9c[_0x3da6ec(0xc3)]['qrCodeLink'],'expiry_date':_0x2cce9c[_0x3da6ec(0x120)]};}catch(_0x422d3e){console[_0x3da6ec(0x10e)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x3da6ec(0x10e)](_0x3da6ec(0xe1),_0x422d3e),loggerService_1[_0x3da6ec(0x132)][_0x3da6ec(0x126)](_0x3da6ec(0xd2),_0x3da6ec(0xf5),_0x422d3e);if(_0x422d3e instanceof Error){console[_0x3da6ec(0x10e)]('Error\x20message:',_0x422d3e[_0x3da6ec(0xee)]),console['error'](_0x3da6ec(0xf3),_0x422d3e[_0x3da6ec(0x12f)]);throw new Error(_0x3da6ec(0x127)+_0x422d3e[_0x3da6ec(0xee)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0xf4166b(0x10a)](_0xdd952a){const _0x282a7d=a40_0xf4166b,_0x4f8d3d=Date['now']();try{loggerService_1[_0x282a7d(0x132)][_0x282a7d(0xdd)](_0x282a7d(0xd2),_0x282a7d(0x112)+_0xdd952a,_0x282a7d(0xec),{});const _0x36548b=await fetch(this['apiUrl']+'/'+_0xdd952a,{'method':_0x282a7d(0xec),'headers':{'Content-Type':_0x282a7d(0x133),'User-Agent':_0x282a7d(0xfe)}}),_0x2857ad=Date[_0x282a7d(0xdf)]()-_0x4f8d3d;if(!_0x36548b['ok']){const _0xedc076=await _0x36548b[_0x282a7d(0xfb)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x282a7d(0xd2),_0x282a7d(0x112)+_0xdd952a,_0x36548b['status'],_0xedc076,_0x2857ad);throw new Error(_0x282a7d(0xf8)+_0x36548b[_0x282a7d(0xe5)]);}const _0x3996af=await _0x36548b[_0x282a7d(0xf6)]();loggerService_1['loggerService'][_0x282a7d(0x106)](_0x282a7d(0xd2),_0x282a7d(0x112)+_0xdd952a,_0x36548b['status'],_0x3996af,_0x2857ad);if(_0x3996af[_0x282a7d(0x10e)]||_0x3996af[_0x282a7d(0x125)]){loggerService_1[_0x282a7d(0x132)]['logWhiteDomainError'](_0x282a7d(0xd2),_0x282a7d(0x112)+_0xdd952a,_0x282a7d(0xe9)+(_0x3996af['message']||_0x3996af['error']||_0x282a7d(0xd3)));throw new Error(_0x282a7d(0xe9)+(_0x3996af[_0x282a7d(0xee)]||_0x3996af[_0x282a7d(0x10e)]||_0x282a7d(0xd3)));}let _0x3be34f=_0x282a7d(0xd9);if(_0x3996af[_0x282a7d(0xcb)]===![]){if(_0x3996af[_0x282a7d(0x120)]){const _0x4084c2=new Date(_0x3996af[_0x282a7d(0x120)]),_0x2df5e9=new Date();_0x4084c2<_0x2df5e9?_0x3be34f=_0x282a7d(0xcd):_0x3be34f=_0x282a7d(0x10f);}else _0x3be34f=_0x282a7d(0x10f);}else _0x3be34f=_0x282a7d(0xd9);return{'status':_0x3be34f,'amount':_0x3996af[_0x282a7d(0xf1)],'currency':_0x3996af[_0x282a7d(0x123)],'isActive':_0x3996af[_0x282a7d(0xcb)]};}catch(_0xb44cb9){console[_0x282a7d(0x10e)](_0x282a7d(0xc4),_0xb44cb9),loggerService_1['loggerService'][_0x282a7d(0x126)](_0x282a7d(0xd2),'/payment-links/'+_0xdd952a,_0xb44cb9);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0xb44cb9 instanceof Error?_0xb44cb9[_0x282a7d(0xee)]:_0x282a7d(0xd3)));}}async[a40_0xf4166b(0x128)](_0x188786){const _0x580037=a40_0xf4166b;console['log'](_0x580037(0xc2),_0x188786);let _0x5c9dd2='PENDING';switch(_0x188786['Status']?.['toLowerCase']()){case _0x580037(0x10d):case'completed':case _0x580037(0xdb):case _0x580037(0xc8):case _0x580037(0xe3):_0x188786[_0x580037(0xfa)]==='Yes'?_0x5c9dd2=_0x580037(0xbf):_0x5c9dd2=_0x580037(0xd9);break;case'cancelled':case _0x580037(0xc1):case _0x580037(0xd4):case _0x580037(0x10e):case _0x580037(0xf4):_0x5c9dd2=_0x580037(0x10f);break;case'expired':case'timeout':_0x5c9dd2=_0x580037(0xcd);break;case _0x580037(0x12d):case _0x580037(0xc5):case'active':case _0x580037(0xbe):case _0x580037(0x113):default:_0x5c9dd2=_0x580037(0xd9);break;}return{'paymentId':_0x188786[_0x580037(0xef)]||_0x188786[_0x580037(0x117)],'status':_0x5c9dd2,'amount':_0x188786[_0x580037(0xca)],'currency':_0x188786[_0x580037(0x109)],'additionalInfo':{'method':_0x188786[_0x580037(0x12b)],'bankId':_0x188786[_0x580037(0x104)],'settled':_0x188786[_0x580037(0xfa)],'settlementDate':_0x188786[_0x580037(0x108)],'remitterName':_0x188786[_0x580037(0xcc)]?.[_0x580037(0x118)],'remitterIban':_0x188786[_0x580037(0xcc)]?.['Iban'],'bankTransactionId':_0x188786[_0x580037(0x11f)]}};}[a40_0xf4166b(0x103)](_0x21d418,_0x1b8e6b){const _0x4bff29=a40_0xf4166b;return console[_0x4bff29(0xc6)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x1b8e6b,'paymentId':_0x21d418[_0x4bff29(0x117)],'merchantPaymentId':_0x21d418['MerchantPaymentId']}),!![];}}exports[a40_0xf4166b(0xed)]=NodaService;function a40_0x5ddf(){const _0x23359c=['Request\x20Body\x20(Direct\x20JSON):','Method',',\x20body:\x20','pending','279772pxKRbB','stack','Response\x20data:','4tFOyyn','loggerService','application/json','Short\x20Link:','processing','PAID','URL:','canceled','Processing\x20Noda\x20webhook:','shortLinkUrls','Noda\x20payment\x20verification\x20error:','created','log','Status\x20Text:','success','HTTP\x20','Amount','isActive','Remitter','EXPIRED','Business\x20Error:\x20','Order\x20ID\x20Format:','apiUrl','qrCodeLink','noda','Unknown\x20error','failed','Raw\x20Response\x20Body:','3224082iXSprV','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','PENDING','entries','paid','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainRequest','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','now','Status\x20Code:','Error\x20details:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','successful','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','status','8794392NuhElR','fromEntries','2103476zSdMwm','Noda\x20API\x20error:\x20','HTTP\x20Status:','9oZPCmQ','GET','NodaService','message','MerchantPaymentId','Unknown\x20error\x20from\x20Noda\x20API','amount','ðŸŒ\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20stack:','rejected','/payment-links','json','parse','HTTP\x20error!\x20status:\x20','577625wWDRJK','Settled','text','shortLink','4099512FPEdNy','TesSoft\x20Payment\x20System/1.0','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','===\x20NODA\x20API\x20ERROR\x20===','Failed\x20to\x20parse\x20JSON\x20response:','JSON\x20Parse\x20Error:\x20','verifyWebhookSignature','BankId','statusText','logWhiteDomainResponse','(8digits-8digits\x20format)','SettlementDate','Currency','verifyPayment','Order\x20ID\x20Used:','createPaymentLink','done','error','FAILED','https://tesoft.uk/gateway/noda/webhook/','===\x20PARSED\x20NODA\x20RESPONSE\x20===','/payment-links/','in_progress','Error\x20Message:','5835459BCJvcb','../loggerService','PaymentId','Name','Parsed\x20Result:','Payment\x20Link\x20ID:','Response\x20Body:','Not\x20provided','Response\x20Time:','POST','BankTransactionId','expiryDate','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Missing\x20id\x20or\x20shortLink\x20in\x20response','currency','stringify','statusCode','logWhiteDomainError','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','processWebhook','===\x20NODA\x20SUCCESS\x20==='];a40_0x5ddf=function(){return _0x23359c;};return a40_0x5ddf();}