'use strict';const a40_0x4abe63=a40_0xed2d;(function(_0x4e7f5b,_0x106c7a){const _0x405366=a40_0xed2d,_0x1e5462=_0x4e7f5b();while(!![]){try{const _0x3ef429=parseInt(_0x405366(0x10c))/0x1*(-parseInt(_0x405366(0x134))/0x2)+-parseInt(_0x405366(0x11b))/0x3+-parseInt(_0x405366(0xc2))/0x4+parseInt(_0x405366(0x126))/0x5+parseInt(_0x405366(0x135))/0x6+parseInt(_0x405366(0x13b))/0x7+-parseInt(_0x405366(0xdf))/0x8*(-parseInt(_0x405366(0x133))/0x9);if(_0x3ef429===_0x106c7a)break;else _0x1e5462['push'](_0x1e5462['shift']());}catch(_0x376787){_0x1e5462['push'](_0x1e5462['shift']());}}}(a40_0x56d0,0x9f205));Object[a40_0x4abe63(0xc8)](exports,a40_0x4abe63(0xf2),{'value':!![]}),exports[a40_0x4abe63(0xe4)]=void 0x0;function a40_0xed2d(_0x475e5f,_0x52b47c){const _0x56d0a9=a40_0x56d0();return a40_0xed2d=function(_0xed2d18,_0xcd0036){_0xed2d18=_0xed2d18-0xc0;let _0x268923=_0x56d0a9[_0xed2d18];return _0x268923;},a40_0xed2d(_0x475e5f,_0x52b47c);}const loggerService_1=require(a40_0x4abe63(0xf1));class NodaService{constructor(){const _0x3e920b=a40_0x4abe63;this[_0x3e920b(0x12a)]=_0x3e920b(0xce),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a40_0x4abe63(0xfc)](_0x5f4215){const _0x518521=a40_0x4abe63,{orderId:_0xc74216,name:_0x129a1c,paymentDescription:_0x402c91,amount:_0x32f90d,currency:_0xf3d66c,webhookUrl:_0x13a2c7,returnUrl:_0x30943a,expiryDate:_0x31a6af}=_0x5f4215,_0x5da94b=_0xf3d66c[_0x518521(0xff)](),_0x3643f3=_0x518521(0xd3),_0x4d7d3b=_0x518521(0xd2)+_0xc74216,_0x26571b={'name':_0x129a1c,'paymentDescription':_0x402c91,'amount':_0x32f90d,'currency':_0x5da94b,'paymentId':_0xc74216,'webhookUrl':_0x3643f3,'returnUrl':_0x4d7d3b};_0x31a6af&&(_0x26571b[_0x518521(0x103)]=_0x31a6af);const _0x53df3b=Date[_0x518521(0xdb)]();try{console[_0x518521(0xfd)](_0x518521(0x118)),console[_0x518521(0xfd)](_0x518521(0xfe),this[_0x518521(0x12a)]),console[_0x518521(0xfd)](_0x518521(0xc6),JSON['stringify'](_0x26571b,null,0x2)),console[_0x518521(0xfd)]('Order\x20ID\x20Format:',_0xc74216,_0x518521(0xfb)),loggerService_1[_0x518521(0x12f)][_0x518521(0xd0)](_0x518521(0x107),_0x518521(0xe0),_0x518521(0x11e),_0x26571b);const _0x13180e=await fetch(this[_0x518521(0x12a)],{'method':'POST','headers':{'Content-Type':_0x518521(0x105),'Accept':_0x518521(0x105),'User-Agent':_0x518521(0xd4)},'body':JSON[_0x518521(0x124)](_0x26571b)}),_0x5d0284=Date['now']()-_0x53df3b;console[_0x518521(0xfd)](_0x518521(0xf4)),console[_0x518521(0xfd)](_0x518521(0x10b),_0x13180e[_0x518521(0x12b)]),console[_0x518521(0xfd)](_0x518521(0xd9),_0x13180e['statusText']),console['log'](_0x518521(0xf3),Object[_0x518521(0xcd)](_0x13180e[_0x518521(0xc1)][_0x518521(0xcf)]())),console[_0x518521(0xfd)](_0x518521(0xee),_0x5d0284+'ms');const _0x5886b9=await _0x13180e[_0x518521(0xc3)]();console[_0x518521(0xfd)](_0x518521(0xf5),_0x5886b9);if(!_0x13180e['ok']){console['error'](_0x518521(0x119)),console[_0x518521(0xf8)](_0x518521(0x114),_0x13180e[_0x518521(0x12b)]),console['error'](_0x518521(0x10d),_0x5886b9),loggerService_1[_0x518521(0x12f)][_0x518521(0x101)](_0x518521(0x107),_0x518521(0xe0),_0x13180e[_0x518521(0x12b)],_0x5886b9,_0x5d0284),loggerService_1[_0x518521(0x12f)][_0x518521(0x108)]('noda',_0x518521(0xe0),_0x518521(0x115)+_0x13180e[_0x518521(0x12b)]+':\x20'+_0x5886b9);if(_0x13180e[_0x518521(0x12b)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x13180e[_0x518521(0x12b)]===0x1f4)throw new Error(_0x518521(0xd1));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x13180e[_0x518521(0x12b)]+_0x518521(0xde)+_0x5886b9);}let _0x595ad1;try{_0x595ad1=JSON['parse'](_0x5886b9);}catch(_0x470b7c){console[_0x518521(0xf8)](_0x518521(0x111),_0x470b7c),loggerService_1[_0x518521(0x12f)][_0x518521(0x108)](_0x518521(0x107),_0x518521(0xe0),'JSON\x20Parse\x20Error:\x20'+_0x470b7c);throw new Error(_0x518521(0x117)+_0x5886b9);}console['log'](_0x518521(0xdc)),console[_0x518521(0xfd)](_0x518521(0xea),JSON[_0x518521(0x124)](_0x595ad1,null,0x2)),loggerService_1[_0x518521(0x12f)][_0x518521(0x101)]('noda','/payment-links',_0x13180e[_0x518521(0x12b)],_0x595ad1,_0x5d0284);if(_0x595ad1[_0x518521(0xf8)]||_0x595ad1[_0x518521(0x139)]){const _0x5b251a=_0x595ad1['message']||_0x595ad1[_0x518521(0xf8)]||_0x518521(0x128);console[_0x518521(0xf8)](_0x518521(0xec)),console[_0x518521(0xf8)](_0x518521(0x109),_0x5b251a),console['error'](_0x518521(0xda),_0x595ad1[_0x518521(0x139)]),loggerService_1[_0x518521(0x12f)][_0x518521(0x108)]('noda','/payment-links',_0x518521(0xe1)+_0x5b251a);throw new Error(_0x518521(0xd7)+_0x5b251a);}if(!_0x595ad1['id']||!_0x595ad1[_0x518521(0x121)]?.[_0x518521(0x11c)]){console[_0x518521(0xf8)](_0x518521(0xc5)),console['error'](_0x518521(0x120)),console[_0x518521(0xf8)]('Response\x20data:',_0x595ad1),loggerService_1[_0x518521(0x12f)][_0x518521(0x108)](_0x518521(0x107),_0x518521(0xe0),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x518521(0x12e));}return console[_0x518521(0xfd)](_0x518521(0x100)),console[_0x518521(0xfd)](_0x518521(0xe7),_0x595ad1['id']),console[_0x518521(0xfd)]('Short\x20Link:',_0x595ad1['shortLinkUrls']['shortLink']),console['log'](_0x518521(0xe9),_0x595ad1[_0x518521(0x121)][_0x518521(0xca)]||'Not\x20provided'),console['log'](_0x518521(0x112),_0xc74216,_0x518521(0x13a)),{'gateway_payment_id':_0x595ad1['id'],'payment_url':_0x595ad1[_0x518521(0x121)][_0x518521(0x11c)],'qr_code_url':_0x595ad1[_0x518521(0x121)][_0x518521(0xca)],'expiry_date':_0x595ad1['expiryDate']};}catch(_0x1341dc){console['error'](_0x518521(0xc7)),console[_0x518521(0xf8)](_0x518521(0xe3),_0x1341dc),loggerService_1[_0x518521(0x12f)][_0x518521(0x108)]('noda',_0x518521(0xe0),_0x1341dc);if(_0x1341dc instanceof Error){console[_0x518521(0xf8)]('Error\x20message:',_0x1341dc['message']),console['error'](_0x518521(0x136),_0x1341dc[_0x518521(0xd8)]);throw new Error(_0x518521(0x11a)+_0x1341dc[_0x518521(0x131)]);}throw new Error(_0x518521(0x137));}}async[a40_0x4abe63(0xf0)](_0x4b738f){const _0x5a0848=a40_0x4abe63,_0xd8ee95=Date[_0x5a0848(0xdb)]();try{loggerService_1['loggerService'][_0x5a0848(0xd0)](_0x5a0848(0x107),_0x5a0848(0x102)+_0x4b738f,'GET',{});const _0x2d56ff=await fetch(this['apiUrl']+'/'+_0x4b738f,{'method':'GET','headers':{'Content-Type':_0x5a0848(0x105),'User-Agent':_0x5a0848(0xd4)}}),_0x4578c1=Date['now']()-_0xd8ee95;if(!_0x2d56ff['ok']){const _0x3b39dd=await _0x2d56ff[_0x5a0848(0xc3)]();loggerService_1[_0x5a0848(0x12f)][_0x5a0848(0x101)](_0x5a0848(0x107),_0x5a0848(0x102)+_0x4b738f,_0x2d56ff[_0x5a0848(0x12b)],_0x3b39dd,_0x4578c1);throw new Error(_0x5a0848(0x129)+_0x2d56ff['status']);}const _0x2af590=await _0x2d56ff[_0x5a0848(0x10e)]();loggerService_1[_0x5a0848(0x12f)]['logWhiteDomainResponse'](_0x5a0848(0x107),_0x5a0848(0x102)+_0x4b738f,_0x2d56ff['status'],_0x2af590,_0x4578c1);if(_0x2af590[_0x5a0848(0xf8)]||_0x2af590[_0x5a0848(0x139)]){loggerService_1[_0x5a0848(0x12f)][_0x5a0848(0x108)](_0x5a0848(0x107),'/payment-links/'+_0x4b738f,_0x5a0848(0xd7)+(_0x2af590[_0x5a0848(0x131)]||_0x2af590['error']||_0x5a0848(0xe2)));throw new Error(_0x5a0848(0xd7)+(_0x2af590[_0x5a0848(0x131)]||_0x2af590['error']||_0x5a0848(0xe2)));}let _0x91e916=_0x5a0848(0x127);if(_0x2af590[_0x5a0848(0x106)]===![]){if(_0x2af590[_0x5a0848(0x103)]){const _0x4da875=new Date(_0x2af590['expiryDate']),_0x1b32d7=new Date();_0x4da875<_0x1b32d7?_0x91e916=_0x5a0848(0xe8):_0x91e916=_0x5a0848(0x11d);}else _0x91e916=_0x5a0848(0x11d);}else _0x91e916='PENDING';return{'status':_0x91e916,'amount':_0x2af590['amount'],'currency':_0x2af590[_0x5a0848(0xe6)],'isActive':_0x2af590['isActive']};}catch(_0x1579e7){console[_0x5a0848(0xf8)]('Noda\x20payment\x20verification\x20error:',_0x1579e7),loggerService_1[_0x5a0848(0x12f)][_0x5a0848(0x108)]('noda',_0x5a0848(0x102)+_0x4b738f,_0x1579e7);throw new Error(_0x5a0848(0x113)+(_0x1579e7 instanceof Error?_0x1579e7[_0x5a0848(0x131)]:'Unknown\x20error'));}}async[a40_0x4abe63(0x130)](_0x456948){const _0x2c71b2=a40_0x4abe63;console['log'](_0x2c71b2(0x12c),_0x456948);let _0x2ea807='PENDING';switch(_0x456948[_0x2c71b2(0xf7)]?.['toLowerCase']()){case _0x2c71b2(0x11f):case _0x2c71b2(0xef):case'paid':case _0x2c71b2(0x138):case'successful':_0x456948[_0x2c71b2(0x10a)]==='Yes'?_0x2ea807=_0x2c71b2(0xfa):_0x2ea807='PENDING';break;case _0x2c71b2(0x10f):case _0x2c71b2(0x122):case _0x2c71b2(0x104):case _0x2c71b2(0xf8):case _0x2c71b2(0xe5):_0x2ea807=_0x2c71b2(0x11d);break;case _0x2c71b2(0x110):case _0x2c71b2(0xc4):_0x2ea807=_0x2c71b2(0xe8);break;case _0x2c71b2(0x116):case _0x2c71b2(0x12d):case _0x2c71b2(0xcc):case _0x2c71b2(0xeb):case _0x2c71b2(0xc0):default:_0x2ea807=_0x2c71b2(0x127);break;}return{'paymentId':_0x456948[_0x2c71b2(0x123)]||_0x456948[_0x2c71b2(0xd5)],'status':_0x2ea807,'amount':_0x456948[_0x2c71b2(0x125)],'currency':_0x456948[_0x2c71b2(0x132)],'additionalInfo':{'method':_0x456948[_0x2c71b2(0xed)],'bankId':_0x456948[_0x2c71b2(0xcb)],'settled':_0x456948[_0x2c71b2(0x10a)],'settlementDate':_0x456948['SettlementDate'],'remitterName':_0x456948[_0x2c71b2(0xf9)]?.[_0x2c71b2(0xdd)],'remitterIban':_0x456948[_0x2c71b2(0xf9)]?.[_0x2c71b2(0xd6)],'bankTransactionId':_0x456948[_0x2c71b2(0xf6)]}};}['verifyWebhookSignature'](_0x196f37,_0x3e250c){const _0x380fa9=a40_0x4abe63;return console[_0x380fa9(0xfd)](_0x380fa9(0xc9),{'receivedSignature':_0x3e250c,'paymentId':_0x196f37['PaymentId'],'merchantPaymentId':_0x196f37[_0x380fa9(0x123)]}),!![];}}exports[a40_0x4abe63(0xe4)]=NodaService;function a40_0x56d0(){const _0x172702=['verifyPayment','../loggerService','__esModule','Headers:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Raw\x20Response\x20Body:','BankTransactionId','Status','error','Remitter','PAID','(8digits-8digits\x20format\x20for\x20Noda)','createPaymentLink','log','URL:','toUpperCase','===\x20NODA\x20SUCCESS\x20===','logWhiteDomainResponse','/payment-links/','expiryDate','failed','application/json','isActive','noda','logWhiteDomainError','Error\x20Message:','Settled','Status:','2abKbxY','Response\x20Body:','json','cancelled','expired','Failed\x20to\x20parse\x20JSON\x20response:','Order\x20ID\x20Used:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','HTTP\x20Status:','HTTP\x20','pending','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','===\x20NODA\x20API\x20ERROR\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','1105128glwXgf','shortLink','FAILED','POST','done','Missing\x20id\x20or\x20shortLink\x20in\x20response','shortLinkUrls','canceled','MerchantPaymentId','stringify','Amount','2474035TnupQX','PENDING','Unknown\x20error\x20from\x20Noda\x20API','HTTP\x20error!\x20status:\x20','apiUrl','status','Processing\x20Noda\x20webhook:','created','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','loggerService','processWebhook','message','Currency','1864665AcSbOa','27694BYvGAu','1417062UwKRTC','Error\x20stack:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','success','statusCode','(8digits-8digits\x20format)','7876071NREWKN','in_progress','headers','4890624apFfna','text','timeout','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Request\x20Body\x20(Direct\x20JSON):','===\x20NODA\x20SERVICE\x20ERROR\x20===','defineProperty','Noda\x20webhook\x20signature\x20verification:','qrCodeLink','BankId','active','fromEntries','https://tesoft.uk/gateway/noda/','entries','logWhiteDomainRequest','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','https://tesoft.uk/gateway/success.php?id=','https://tesoft.uk/gateway/noda/webhook/','TesSoft\x20Payment\x20System/1.0','PaymentId','Iban','Noda\x20API\x20error:\x20','stack','Status\x20Text:','Status\x20Code:','now','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Name',',\x20body:\x20','16bXDyCH','/payment-links','Business\x20Error:\x20','Unknown\x20error','Error\x20details:','NodaService','rejected','currency','Payment\x20Link\x20ID:','EXPIRED','QR\x20Code\x20Link:','Parsed\x20Result:','processing','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Method','Response\x20Time:','completed'];a40_0x56d0=function(){return _0x172702;};return a40_0x56d0();}