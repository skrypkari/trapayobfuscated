'use strict';const a40_0xa1bffe=a40_0x2a67;(function(_0x123fb3,_0x3e06b1){const _0x4ad834=a40_0x2a67,_0x11c52c=_0x123fb3();while(!![]){try{const _0x2b01c2=-parseInt(_0x4ad834(0x1be))/0x1+parseInt(_0x4ad834(0x195))/0x2+-parseInt(_0x4ad834(0x1a8))/0x3+-parseInt(_0x4ad834(0x1df))/0x4+parseInt(_0x4ad834(0x1c6))/0x5+-parseInt(_0x4ad834(0x1a9))/0x6*(parseInt(_0x4ad834(0x17a))/0x7)+parseInt(_0x4ad834(0x1dd))/0x8;if(_0x2b01c2===_0x3e06b1)break;else _0x11c52c['push'](_0x11c52c['shift']());}catch(_0x29e1ad){_0x11c52c['push'](_0x11c52c['shift']());}}}(a40_0x4fed,0xc03ef));Object[a40_0xa1bffe(0x1b5)](exports,a40_0xa1bffe(0x1a4),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a40_0xa1bffe(0x1aa));function a40_0x4fed(){const _0x263e03=['===\x20NODA\x20SUCCESS\x20===','BankTransactionId','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','json','message','shortLink','defineProperty','verifyPayment','Settled','Failed\x20to\x20verify\x20Noda\x20payment:\x20','stringify','https://tesoft.uk/gateway/success.php?id=','canceled','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','185163NiamiN','Failed\x20to\x20parse\x20JSON\x20response:','Request\x20Body\x20(Direct\x20JSON):','log','logWhiteDomainError','Response\x20Time:','shortLinkUrls','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','720985FAWAoo','logWhiteDomainResponse','NodaService','Name','statusText','Business\x20Error:\x20','/payment-links','Status','Unknown\x20error\x20from\x20Noda\x20API','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','currency','entries','created','in_progress','rejected','Unknown\x20error','isActive','BankId','SettlementDate','pending','active','Iban','Error\x20Message:','13112208KMcqOM','toUpperCase','3078448MQbrab','Processing\x20Noda\x20webhook:','Remitter','PaymentId','done','Short\x20Link:','Amount','noda','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','success','apiUrl','URL:','PENDING','Noda\x20payment\x20verification\x20error:','https://tesoft.uk/gateway/noda/webhook/','completed','PAID','EXPIRED','Payment\x20Link\x20ID:','819sZuvEK','cancelled','Headers:','(8digits-8digits\x20format)','Error\x20message:','text','status','QR\x20Code\x20Link:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','JSON\x20Parse\x20Error:\x20','Status:','amount','failed','Status\x20Text:','Noda\x20API\x20error:\x20','logWhiteDomainRequest','===\x20NODA\x20SERVICE\x20ERROR\x20===','stack','===\x20NODA\x20API\x20ERROR\x20===','loggerService','toLowerCase','POST','fromEntries','paid','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','HTTP\x20','error','1189274NEHzWG','Method','Response\x20data:','Raw\x20Response\x20Body:',',\x20body:\x20','FAILED','expiryDate','Currency','Noda\x20webhook\x20signature\x20verification:','Error\x20details:','statusCode','createPaymentLink','https://tesoft.uk/gateway/noda/','successful','HTTP\x20error!\x20status:\x20','__esModule','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','headers','Order\x20ID\x20Used:','3816qTXzgt','32532mYvrIa','../loggerService','GET','/payment-links/','now'];a40_0x4fed=function(){return _0x263e03;};return a40_0x4fed();}function a40_0x2a67(_0x1206ff,_0x5d7aab){const _0x4fed18=a40_0x4fed();return a40_0x2a67=function(_0x2a6760,_0x558886){_0x2a6760=_0x2a6760-0x169;let _0x1eb507=_0x4fed18[_0x2a6760];return _0x1eb507;},a40_0x2a67(_0x1206ff,_0x5d7aab);}class NodaService{constructor(){const _0x1ba647=a40_0xa1bffe;this[_0x1ba647(0x171)]=_0x1ba647(0x1a1),console['log'](_0x1ba647(0x1bd));}async[a40_0xa1bffe(0x1a0)](_0x403b1a){const _0x18f228=a40_0xa1bffe,{orderId:_0x3a9281,name:_0x46430e,paymentDescription:_0x2728de,amount:_0x344379,currency:_0x36f0d0,webhookUrl:_0x2f6433,returnUrl:_0x4bce40,expiryDate:_0x5c07a9}=_0x403b1a,_0x34743c=_0x36f0d0[_0x18f228(0x1de)](),_0x2bd7f7=_0x18f228(0x175),_0x1bb47c=_0x18f228(0x1ba)+_0x3a9281,_0xe21b64={'name':_0x46430e,'paymentDescription':_0x2728de,'amount':_0x344379,'currency':_0x34743c,'paymentId':_0x3a9281,'webhookUrl':_0x2bd7f7,'returnUrl':_0x1bb47c};_0x5c07a9&&(_0xe21b64[_0x18f228(0x19b)]=_0x5c07a9);const _0x4409fd=Date['now']();try{console[_0x18f228(0x1c1)](_0x18f228(0x1cf)),console[_0x18f228(0x1c1)](_0x18f228(0x172),this['apiUrl']),console[_0x18f228(0x1c1)](_0x18f228(0x1c0),JSON[_0x18f228(0x1b9)](_0xe21b64,null,0x2)),console[_0x18f228(0x1c1)]('Order\x20ID\x20Format:',_0x3a9281,'(8digits-8digits\x20format\x20for\x20Noda)'),loggerService_1[_0x18f228(0x18d)][_0x18f228(0x189)](_0x18f228(0x16e),_0x18f228(0x1cc),'POST',_0xe21b64);const _0x3e07da=await fetch(this[_0x18f228(0x171)],{'method':_0x18f228(0x18f),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0xe21b64)}),_0x324288=Date[_0x18f228(0x1ad)]()-_0x4409fd;console[_0x18f228(0x1c1)](_0x18f228(0x192)),console[_0x18f228(0x1c1)](_0x18f228(0x184),_0x3e07da[_0x18f228(0x180)]),console[_0x18f228(0x1c1)](_0x18f228(0x187),_0x3e07da[_0x18f228(0x1ca)]),console[_0x18f228(0x1c1)](_0x18f228(0x17c),Object[_0x18f228(0x190)](_0x3e07da[_0x18f228(0x1a6)][_0x18f228(0x1d1)]())),console[_0x18f228(0x1c1)](_0x18f228(0x1c3),_0x324288+'ms');const _0x8fac69=await _0x3e07da['text']();console[_0x18f228(0x1c1)](_0x18f228(0x198),_0x8fac69);if(!_0x3e07da['ok']){console['error'](_0x18f228(0x18c)),console['error']('HTTP\x20Status:',_0x3e07da[_0x18f228(0x180)]),console[_0x18f228(0x194)]('Response\x20Body:',_0x8fac69),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x18f228(0x16e),_0x18f228(0x1cc),_0x3e07da['status'],_0x8fac69,_0x324288),loggerService_1[_0x18f228(0x18d)][_0x18f228(0x1c2)](_0x18f228(0x16e),_0x18f228(0x1cc),_0x18f228(0x193)+_0x3e07da[_0x18f228(0x180)]+':\x20'+_0x8fac69);if(_0x3e07da[_0x18f228(0x180)]===0x190)throw new Error(_0x18f228(0x1b0));else{if(_0x3e07da['status']===0x1f4)throw new Error(_0x18f228(0x182));}throw new Error(_0x18f228(0x1a3)+_0x3e07da[_0x18f228(0x180)]+_0x18f228(0x199)+_0x8fac69);}let _0x43031b;try{_0x43031b=JSON['parse'](_0x8fac69);}catch(_0x57ed36){console[_0x18f228(0x194)](_0x18f228(0x1bf),_0x57ed36),loggerService_1[_0x18f228(0x18d)][_0x18f228(0x1c2)](_0x18f228(0x16e),_0x18f228(0x1cc),_0x18f228(0x183)+_0x57ed36);throw new Error(_0x18f228(0x1b1)+_0x8fac69);}console['log']('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x18f228(0x1c1)]('Parsed\x20Result:',JSON[_0x18f228(0x1b9)](_0x43031b,null,0x2)),loggerService_1[_0x18f228(0x18d)]['logWhiteDomainResponse']('noda',_0x18f228(0x1cc),_0x3e07da['status'],_0x43031b,_0x324288);if(_0x43031b[_0x18f228(0x194)]||_0x43031b[_0x18f228(0x19f)]){const _0x5731dc=_0x43031b['message']||_0x43031b[_0x18f228(0x194)]||_0x18f228(0x1ce);console['error'](_0x18f228(0x1a5)),console[_0x18f228(0x194)](_0x18f228(0x1dc),_0x5731dc),console['error']('Status\x20Code:',_0x43031b[_0x18f228(0x19f)]),loggerService_1[_0x18f228(0x18d)][_0x18f228(0x1c2)](_0x18f228(0x16e),_0x18f228(0x1cc),_0x18f228(0x1cb)+_0x5731dc);throw new Error('Noda\x20API\x20error:\x20'+_0x5731dc);}if(!_0x43031b['id']||!_0x43031b[_0x18f228(0x1c4)]?.[_0x18f228(0x1b4)]){console[_0x18f228(0x194)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x18f228(0x194)](_0x18f228(0x197),_0x43031b),loggerService_1[_0x18f228(0x18d)][_0x18f228(0x1c2)]('noda',_0x18f228(0x1cc),_0x18f228(0x1bc));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x18f228(0x1c1)](_0x18f228(0x1ae)),console[_0x18f228(0x1c1)](_0x18f228(0x179),_0x43031b['id']),console['log'](_0x18f228(0x16c),_0x43031b[_0x18f228(0x1c4)][_0x18f228(0x1b4)]),console[_0x18f228(0x1c1)](_0x18f228(0x181),_0x43031b[_0x18f228(0x1c4)]['qrCodeLink']||'Not\x20provided'),console[_0x18f228(0x1c1)](_0x18f228(0x1a7),_0x3a9281,_0x18f228(0x17d)),{'gateway_payment_id':_0x43031b['id'],'payment_url':_0x43031b[_0x18f228(0x1c4)][_0x18f228(0x1b4)],'qr_code_url':_0x43031b[_0x18f228(0x1c4)]['qrCodeLink'],'expiry_date':_0x43031b[_0x18f228(0x19b)]};}catch(_0x405be7){console[_0x18f228(0x194)](_0x18f228(0x18a)),console[_0x18f228(0x194)](_0x18f228(0x19e),_0x405be7),loggerService_1[_0x18f228(0x18d)][_0x18f228(0x1c2)]('noda',_0x18f228(0x1cc),_0x405be7);if(_0x405be7 instanceof Error){console[_0x18f228(0x194)](_0x18f228(0x17e),_0x405be7[_0x18f228(0x1b3)]),console[_0x18f228(0x194)]('Error\x20stack:',_0x405be7[_0x18f228(0x18b)]);throw new Error(_0x18f228(0x16f)+_0x405be7['message']);}throw new Error(_0x18f228(0x1c5));}}async[a40_0xa1bffe(0x1b6)](_0x40448e){const _0x5b1619=a40_0xa1bffe,_0xf7df4d=Date[_0x5b1619(0x1ad)]();try{loggerService_1[_0x5b1619(0x18d)][_0x5b1619(0x189)]('noda','/payment-links/'+_0x40448e,_0x5b1619(0x1ab),{});const _0x247780=await fetch(this[_0x5b1619(0x171)]+'/'+_0x40448e,{'method':_0x5b1619(0x1ab),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x860010=Date[_0x5b1619(0x1ad)]()-_0xf7df4d;if(!_0x247780['ok']){const _0x460f57=await _0x247780[_0x5b1619(0x17f)]();loggerService_1[_0x5b1619(0x18d)][_0x5b1619(0x1c7)](_0x5b1619(0x16e),_0x5b1619(0x1ac)+_0x40448e,_0x247780[_0x5b1619(0x180)],_0x460f57,_0x860010);throw new Error('HTTP\x20error!\x20status:\x20'+_0x247780[_0x5b1619(0x180)]);}const _0xe6a3ae=await _0x247780[_0x5b1619(0x1b2)]();loggerService_1['loggerService'][_0x5b1619(0x1c7)]('noda',_0x5b1619(0x1ac)+_0x40448e,_0x247780[_0x5b1619(0x180)],_0xe6a3ae,_0x860010);if(_0xe6a3ae['error']||_0xe6a3ae[_0x5b1619(0x19f)]){loggerService_1[_0x5b1619(0x18d)][_0x5b1619(0x1c2)](_0x5b1619(0x16e),_0x5b1619(0x1ac)+_0x40448e,'Noda\x20API\x20error:\x20'+(_0xe6a3ae[_0x5b1619(0x1b3)]||_0xe6a3ae['error']||'Unknown\x20error'));throw new Error(_0x5b1619(0x188)+(_0xe6a3ae[_0x5b1619(0x1b3)]||_0xe6a3ae[_0x5b1619(0x194)]||'Unknown\x20error'));}let _0x2fcf77=_0x5b1619(0x173);if(_0xe6a3ae[_0x5b1619(0x1d6)]===![]){if(_0xe6a3ae[_0x5b1619(0x19b)]){const _0x32488a=new Date(_0xe6a3ae[_0x5b1619(0x19b)]),_0x53a3f4=new Date();_0x32488a<_0x53a3f4?_0x2fcf77='EXPIRED':_0x2fcf77=_0x5b1619(0x19a);}else _0x2fcf77=_0x5b1619(0x19a);}else _0x2fcf77=_0x5b1619(0x173);return{'status':_0x2fcf77,'amount':_0xe6a3ae[_0x5b1619(0x185)],'currency':_0xe6a3ae[_0x5b1619(0x1d0)],'isActive':_0xe6a3ae[_0x5b1619(0x1d6)]};}catch(_0x1c41ca){console[_0x5b1619(0x194)](_0x5b1619(0x174),_0x1c41ca),loggerService_1[_0x5b1619(0x18d)]['logWhiteDomainError'](_0x5b1619(0x16e),_0x5b1619(0x1ac)+_0x40448e,_0x1c41ca);throw new Error(_0x5b1619(0x1b8)+(_0x1c41ca instanceof Error?_0x1c41ca[_0x5b1619(0x1b3)]:_0x5b1619(0x1d5)));}}async['processWebhook'](_0x156a38){const _0x1073cb=a40_0xa1bffe;console['log'](_0x1073cb(0x1e0),_0x156a38);let _0x11a53f=_0x1073cb(0x173);switch(_0x156a38[_0x1073cb(0x1cd)]?.[_0x1073cb(0x18e)]()){case _0x1073cb(0x16b):case _0x1073cb(0x176):case _0x1073cb(0x191):case _0x1073cb(0x170):case _0x1073cb(0x1a2):_0x156a38[_0x1073cb(0x1b7)]==='Yes'?_0x11a53f=_0x1073cb(0x177):_0x11a53f=_0x1073cb(0x173);break;case _0x1073cb(0x17b):case _0x1073cb(0x1bb):case _0x1073cb(0x186):case _0x1073cb(0x194):case _0x1073cb(0x1d4):_0x11a53f=_0x1073cb(0x19a);break;case'expired':case'timeout':_0x11a53f=_0x1073cb(0x178);break;case _0x1073cb(0x1d9):case _0x1073cb(0x1d2):case _0x1073cb(0x1da):case'processing':case _0x1073cb(0x1d3):default:_0x11a53f=_0x1073cb(0x173);break;}return{'paymentId':_0x156a38['MerchantPaymentId']||_0x156a38[_0x1073cb(0x16a)],'status':_0x11a53f,'amount':_0x156a38[_0x1073cb(0x16d)],'currency':_0x156a38[_0x1073cb(0x19c)],'additionalInfo':{'method':_0x156a38[_0x1073cb(0x196)],'bankId':_0x156a38[_0x1073cb(0x1d7)],'settled':_0x156a38['Settled'],'settlementDate':_0x156a38[_0x1073cb(0x1d8)],'remitterName':_0x156a38['Remitter']?.[_0x1073cb(0x1c9)],'remitterIban':_0x156a38[_0x1073cb(0x169)]?.[_0x1073cb(0x1db)],'bankTransactionId':_0x156a38[_0x1073cb(0x1af)]}};}['verifyWebhookSignature'](_0x125c4d,_0x2cabfe){const _0x455843=a40_0xa1bffe;return console['log'](_0x455843(0x19d),{'receivedSignature':_0x2cabfe,'paymentId':_0x125c4d['PaymentId'],'merchantPaymentId':_0x125c4d['MerchantPaymentId']}),!![];}}exports[a40_0xa1bffe(0x1c8)]=NodaService;