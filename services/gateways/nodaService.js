'use strict';const a71_0x36fbb6=a71_0x25af;function a71_0x572b(){const _0xba15ab=['stringify','cancelled','logWhiteDomainResponse','Headers:','verifyPayment','/payment-links','fromEntries','Response\x20Body:','failed','Request\x20Body\x20(Direct\x20JSON):','Payment\x20System/1.0','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','apiUrl','log','statusCode','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','408QBgHNS','json','URL:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Noda\x20API\x20error:\x20','Status','Unknown\x20error','../loggerService','processWebhook','FAILED','verifyWebhookSignature','https://tesoft.uk/gateway/noda/webhook/','Short\x20Link:','Settled','Currency','done','Noda\x20payment\x20verification\x20error:','Parsed\x20Result:','HTTP\x20error!\x20status:\x20','Failed\x20to\x20verify\x20Noda\x20payment:\x20','completed','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','POST','currency','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Unknown\x20error\x20from\x20Noda\x20API','234304wNRcyV','HTTP\x20Status:','processing','Remitter','in_progress','shortLinkUrls','Order\x20ID\x20Used:','315YRPSFl','Payment\x20Link\x20ID:','now','status','toLowerCase','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','(8digits-8digits\x20format)','Status\x20Code:','__esModule','logWhiteDomainError','35375153nkSrcs','noda','===\x20NODA\x20SUCCESS\x20===','MerchantPaymentId','Status\x20Text:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','489810AeMEXh','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Method','SettlementDate','47257gZDPts','Name','application/json','isActive','Iban','qrCodeLink','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','paid','loggerService','canceled','PENDING','expiryDate','text','successful','error','Missing\x20id\x20or\x20shortLink\x20in\x20response','https://tesoft.uk/gateway/noda/','message','EXPIRED','Processing\x20Noda\x20webhook:','expired','/payment-links/','10qzEqrB','1642886cjqTnW','BankId','(8digits-8digits\x20format\x20for\x20Noda)','===\x20NODA\x20API\x20ERROR\x20===','pending','Error\x20stack:','35799vlsZvm','statusText','124lVubJI','shortLink','parse','https://tesoft.uk/gateway/pending.php?id=','NodaService','Response\x20Time:','Error\x20Message:','Failed\x20to\x20parse\x20JSON\x20response:','3916205XaqoAi','Order\x20ID\x20Format:','stack','BankTransactionId','PAID','Noda\x20webhook\x20signature\x20verification:','rejected','headers'];a71_0x572b=function(){return _0xba15ab;};return a71_0x572b();}(function(_0x3e07a9,_0x549a6f){const _0x41ddde=a71_0x25af,_0x35ff38=_0x3e07a9();while(!![]){try{const _0x4f5e84=-parseInt(_0x41ddde(0xae))/0x1+parseInt(_0x41ddde(0x93))/0x2+parseInt(_0x41ddde(0xb4))/0x3*(parseInt(_0x41ddde(0xb6))/0x4)+-parseInt(_0x41ddde(0xbe))/0x5+parseInt(_0x41ddde(0xd6))/0x6*(parseInt(_0x41ddde(0x97))/0x7)+-parseInt(_0x41ddde(0xf1))/0x8*(parseInt(_0x41ddde(0x82))/0x9)+-parseInt(_0x41ddde(0xad))/0xa*(-parseInt(_0x41ddde(0x8d))/0xb);if(_0x4f5e84===_0x549a6f)break;else _0x35ff38['push'](_0x35ff38['shift']());}catch(_0x3d23cc){_0x35ff38['push'](_0x35ff38['shift']());}}}(a71_0x572b,0xccbd4));function a71_0x25af(_0x71d361,_0x505d77){_0x71d361=_0x71d361-0x82;const _0x572b0e=a71_0x572b();let _0x25afb0=_0x572b0e[_0x71d361];return _0x25afb0;}Object['defineProperty'](exports,a71_0x36fbb6(0x8b),{'value':!![]}),exports[a71_0x36fbb6(0xba)]=void 0x0;const loggerService_1=require(a71_0x36fbb6(0xde));class NodaService{constructor(){const _0x5261ae=a71_0x36fbb6;this['apiUrl']=_0x5261ae(0xa7),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async['createPaymentLink'](_0x11ea8e){const _0x578666=a71_0x36fbb6,{orderId:_0x3b26d9,name:_0x442f27,paymentDescription:_0x2e8a86,amount:_0x204484,currency:_0x1684b2,webhookUrl:_0x4036ec,returnUrl:_0x1c8d5d,expiryDate:_0x2f3d7d}=_0x11ea8e,_0x32792f=_0x1684b2['toUpperCase'](),_0x52f7f6=_0x578666(0xe2),_0x2483fa=_0x578666(0xb9)+_0x3b26d9,_0x529fc0={'name':_0x442f27,'paymentDescription':_0x2e8a86,'amount':_0x204484,'currency':_0x32792f,'paymentId':_0x3b26d9,'webhookUrl':_0x52f7f6,'returnUrl':_0x2483fa};_0x2f3d7d&&(_0x529fc0['expiryDate']=_0x2f3d7d);const _0x3b59be=Date[_0x578666(0x84)]();try{console[_0x578666(0xd3)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x578666(0xd3)](_0x578666(0xd8),this[_0x578666(0xd2)]),console[_0x578666(0xd3)](_0x578666(0xcf),JSON['stringify'](_0x529fc0,null,0x2)),console['log'](_0x578666(0xbf),_0x3b26d9,_0x578666(0xb0)),console[_0x578666(0xd3)](_0x578666(0x94),_0x2483fa),loggerService_1[_0x578666(0x9f)]['logWhiteDomainRequest']('noda','/payment-links',_0x578666(0xed),_0x529fc0);const _0x10c09d=await fetch(this['apiUrl'],{'method':_0x578666(0xed),'headers':{'Content-Type':_0x578666(0x99),'Accept':_0x578666(0x99),'User-Agent':_0x578666(0xd0)},'body':JSON[_0x578666(0xc6)](_0x529fc0)}),_0x3cde86=Date[_0x578666(0x84)]()-_0x3b59be;console[_0x578666(0xd3)](_0x578666(0x88)),console[_0x578666(0xd3)]('Status:',_0x10c09d[_0x578666(0x85)]),console[_0x578666(0xd3)](_0x578666(0x91),_0x10c09d[_0x578666(0xb5)]),console[_0x578666(0xd3)](_0x578666(0xc9),Object[_0x578666(0xcc)](_0x10c09d[_0x578666(0xc5)]['entries']())),console[_0x578666(0xd3)](_0x578666(0xbb),_0x3cde86+'ms');const _0x23f4f1=await _0x10c09d[_0x578666(0xa3)]();console[_0x578666(0xd3)]('Raw\x20Response\x20Body:',_0x23f4f1);if(!_0x10c09d['ok']){console[_0x578666(0xa5)](_0x578666(0xb1)),console[_0x578666(0xa5)](_0x578666(0xf2),_0x10c09d[_0x578666(0x85)]),console[_0x578666(0xa5)](_0x578666(0xcd),_0x23f4f1),loggerService_1[_0x578666(0x9f)][_0x578666(0xc8)](_0x578666(0x8e),_0x578666(0xcb),_0x10c09d[_0x578666(0x85)],_0x23f4f1,_0x3cde86),loggerService_1[_0x578666(0x9f)][_0x578666(0x8c)](_0x578666(0x8e),'/payment-links','HTTP\x20'+_0x10c09d['status']+':\x20'+_0x23f4f1);if(_0x10c09d[_0x578666(0x85)]===0x190)throw new Error(_0x578666(0xda));else{if(_0x10c09d[_0x578666(0x85)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x578666(0xe9)+_0x10c09d[_0x578666(0x85)]+',\x20body:\x20'+_0x23f4f1);}let _0x5dbdf6;try{_0x5dbdf6=JSON[_0x578666(0xb8)](_0x23f4f1);}catch(_0x5cda33){console[_0x578666(0xa5)](_0x578666(0xbd),_0x5cda33),loggerService_1[_0x578666(0x9f)][_0x578666(0x8c)](_0x578666(0x8e),_0x578666(0xcb),'JSON\x20Parse\x20Error:\x20'+_0x5cda33);throw new Error(_0x578666(0x9d)+_0x23f4f1);}console['log'](_0x578666(0xef)),console[_0x578666(0xd3)](_0x578666(0xe8),JSON[_0x578666(0xc6)](_0x5dbdf6,null,0x2)),loggerService_1[_0x578666(0x9f)][_0x578666(0xc8)](_0x578666(0x8e),_0x578666(0xcb),_0x10c09d[_0x578666(0x85)],_0x5dbdf6,_0x3cde86);if(_0x5dbdf6['error']||_0x5dbdf6[_0x578666(0xd4)]){const _0x299dbd=_0x5dbdf6[_0x578666(0xa8)]||_0x5dbdf6['error']||_0x578666(0xf0);console[_0x578666(0xa5)](_0x578666(0xd1)),console[_0x578666(0xa5)](_0x578666(0xbc),_0x299dbd),console['error'](_0x578666(0x8a),_0x5dbdf6[_0x578666(0xd4)]),loggerService_1[_0x578666(0x9f)][_0x578666(0x8c)](_0x578666(0x8e),_0x578666(0xcb),'Business\x20Error:\x20'+_0x299dbd);throw new Error(_0x578666(0xdb)+_0x299dbd);}if(!_0x5dbdf6['id']||!_0x5dbdf6['shortLinkUrls']?.[_0x578666(0xb7)]){console[_0x578666(0xa5)](_0x578666(0x92)),console[_0x578666(0xa5)](_0x578666(0xa6)),console[_0x578666(0xa5)]('Response\x20data:',_0x5dbdf6),loggerService_1[_0x578666(0x9f)][_0x578666(0x8c)](_0x578666(0x8e),_0x578666(0xcb),_0x578666(0xd9));throw new Error(_0x578666(0x87));}return console['log'](_0x578666(0x8f)),console[_0x578666(0xd3)](_0x578666(0x83),_0x5dbdf6['id']),console[_0x578666(0xd3)](_0x578666(0xe3),_0x5dbdf6[_0x578666(0xf6)][_0x578666(0xb7)]),console[_0x578666(0xd3)]('QR\x20Code\x20Link:',_0x5dbdf6[_0x578666(0xf6)][_0x578666(0x9c)]||'Not\x20provided'),console[_0x578666(0xd3)](_0x578666(0xf7),_0x3b26d9,_0x578666(0x89)),console['log'](_0x578666(0xec),_0x2483fa),{'gateway_payment_id':_0x5dbdf6['id'],'payment_url':_0x5dbdf6[_0x578666(0xf6)]['shortLink'],'qr_code_url':_0x5dbdf6['shortLinkUrls'][_0x578666(0x9c)],'expiry_date':_0x5dbdf6[_0x578666(0xa2)]};}catch(_0x54eb12){console[_0x578666(0xa5)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x578666(0xa5)]('Error\x20details:',_0x54eb12),loggerService_1[_0x578666(0x9f)][_0x578666(0x8c)]('noda',_0x578666(0xcb),_0x54eb12);if(_0x54eb12 instanceof Error){console[_0x578666(0xa5)]('Error\x20message:',_0x54eb12[_0x578666(0xa8)]),console[_0x578666(0xa5)](_0x578666(0xb3),_0x54eb12[_0x578666(0xc0)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x54eb12[_0x578666(0xa8)]);}throw new Error(_0x578666(0xd5));}}async[a71_0x36fbb6(0xca)](_0x429931){const _0x4ed364=a71_0x36fbb6,_0x17b250=Date[_0x4ed364(0x84)]();try{loggerService_1[_0x4ed364(0x9f)]['logWhiteDomainRequest']('noda','/payment-links/'+_0x429931,'GET',{});const _0x43b71b=await fetch(this[_0x4ed364(0xd2)]+'/'+_0x429931,{'method':'GET','headers':{'Content-Type':_0x4ed364(0x99),'User-Agent':_0x4ed364(0xd0)}}),_0x540bec=Date['now']()-_0x17b250;if(!_0x43b71b['ok']){const _0x3edeba=await _0x43b71b['text']();loggerService_1[_0x4ed364(0x9f)][_0x4ed364(0xc8)](_0x4ed364(0x8e),_0x4ed364(0xac)+_0x429931,_0x43b71b[_0x4ed364(0x85)],_0x3edeba,_0x540bec);throw new Error('HTTP\x20error!\x20status:\x20'+_0x43b71b[_0x4ed364(0x85)]);}const _0x53eae4=await _0x43b71b[_0x4ed364(0xd7)]();loggerService_1['loggerService'][_0x4ed364(0xc8)](_0x4ed364(0x8e),_0x4ed364(0xac)+_0x429931,_0x43b71b['status'],_0x53eae4,_0x540bec);if(_0x53eae4[_0x4ed364(0xa5)]||_0x53eae4[_0x4ed364(0xd4)]){loggerService_1['loggerService'][_0x4ed364(0x8c)](_0x4ed364(0x8e),'/payment-links/'+_0x429931,'Noda\x20API\x20error:\x20'+(_0x53eae4['message']||_0x53eae4[_0x4ed364(0xa5)]||'Unknown\x20error'));throw new Error(_0x4ed364(0xdb)+(_0x53eae4[_0x4ed364(0xa8)]||_0x53eae4['error']||_0x4ed364(0xdd)));}let _0xde74f7=_0x4ed364(0xa1);if(_0x53eae4[_0x4ed364(0x9a)]===![]){if(_0x53eae4['expiryDate']){const _0x17d4a5=new Date(_0x53eae4[_0x4ed364(0xa2)]),_0x42a155=new Date();_0x17d4a5<_0x42a155?_0xde74f7=_0x4ed364(0xa9):_0xde74f7=_0x4ed364(0xe0);}else _0xde74f7=_0x4ed364(0xe0);}else _0xde74f7='PENDING';return{'status':_0xde74f7,'amount':_0x53eae4['amount'],'currency':_0x53eae4[_0x4ed364(0xee)],'isActive':_0x53eae4['isActive']};}catch(_0x258f73){console[_0x4ed364(0xa5)](_0x4ed364(0xe7),_0x258f73),loggerService_1[_0x4ed364(0x9f)][_0x4ed364(0x8c)](_0x4ed364(0x8e),_0x4ed364(0xac)+_0x429931,_0x258f73);throw new Error(_0x4ed364(0xea)+(_0x258f73 instanceof Error?_0x258f73[_0x4ed364(0xa8)]:_0x4ed364(0xdd)));}}async[a71_0x36fbb6(0xdf)](_0x5b2015){const _0x395511=a71_0x36fbb6;console[_0x395511(0xd3)](_0x395511(0xaa),_0x5b2015);let _0xebdea0='PENDING';switch(_0x5b2015[_0x395511(0xdc)]?.[_0x395511(0x86)]()){case _0x395511(0xe6):case _0x395511(0xeb):case _0x395511(0x9e):case'success':case _0x395511(0xa4):_0x5b2015[_0x395511(0xe4)]==='Yes'?_0xebdea0=_0x395511(0xc2):_0xebdea0=_0x395511(0xa1);break;case _0x395511(0xc7):case _0x395511(0xa0):case _0x395511(0xce):case _0x395511(0xa5):case _0x395511(0xc4):_0xebdea0='FAILED';break;case _0x395511(0xab):case'timeout':_0xebdea0=_0x395511(0xa9);break;case _0x395511(0xb2):case'created':case'active':case _0x395511(0xf3):case _0x395511(0xf5):default:_0xebdea0='PENDING';break;}return{'paymentId':_0x5b2015['MerchantPaymentId']||_0x5b2015['PaymentId'],'status':_0xebdea0,'amount':_0x5b2015['Amount'],'currency':_0x5b2015[_0x395511(0xe5)],'additionalInfo':{'method':_0x5b2015[_0x395511(0x95)],'bankId':_0x5b2015[_0x395511(0xaf)],'settled':_0x5b2015[_0x395511(0xe4)],'settlementDate':_0x5b2015[_0x395511(0x96)],'remitterName':_0x5b2015[_0x395511(0xf4)]?.[_0x395511(0x98)],'remitterIban':_0x5b2015['Remitter']?.[_0x395511(0x9b)],'bankTransactionId':_0x5b2015[_0x395511(0xc1)]}};}[a71_0x36fbb6(0xe1)](_0x591551,_0x280e68){const _0x1c12a8=a71_0x36fbb6;return console[_0x1c12a8(0xd3)](_0x1c12a8(0xc3),{'receivedSignature':_0x280e68,'paymentId':_0x591551['PaymentId'],'merchantPaymentId':_0x591551[_0x1c12a8(0x90)]}),!![];}}exports[a71_0x36fbb6(0xba)]=NodaService;