'use strict';const a40_0x39bcf0=a40_0x2127;(function(_0x11ea2c,_0x152a36){const _0x286b24=a40_0x2127,_0x4259a8=_0x11ea2c();while(!![]){try{const _0x50d2f0=parseInt(_0x286b24(0x1bd))/0x1*(-parseInt(_0x286b24(0x1ce))/0x2)+parseInt(_0x286b24(0x1c8))/0x3*(-parseInt(_0x286b24(0x1b8))/0x4)+-parseInt(_0x286b24(0x1cf))/0x5+parseInt(_0x286b24(0x1e7))/0x6+parseInt(_0x286b24(0x1af))/0x7*(parseInt(_0x286b24(0x1f9))/0x8)+-parseInt(_0x286b24(0x1bf))/0x9*(parseInt(_0x286b24(0x1eb))/0xa)+parseInt(_0x286b24(0x1e0))/0xb;if(_0x50d2f0===_0x152a36)break;else _0x4259a8['push'](_0x4259a8['shift']());}catch(_0x34276b){_0x4259a8['push'](_0x4259a8['shift']());}}}(a40_0x59b5,0xc0dff));function a40_0x59b5(){const _0x1f2e23=['Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','shortLinkUrls','headers','createPaymentLink','now','NodaService','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','noda','QR\x20Code\x20Link:','https://tesoft.uk/gateway/noda/webhook/','32525042FWDPzC','Payment\x20Link\x20ID:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','MerchantPaymentId','JSON\x20Parse\x20Error:\x20','processing','(8digits-8digits\x20format\x20for\x20Noda)','4813632uNKjxh','statusCode','status','POST','410SfxrXj','Status','canceled','Processing\x20Noda\x20webhook:','logWhiteDomainError','https://tesoft.uk/gateway/noda/','qrCodeLink','expired','FAILED','Currency','TesSoft\x20Payment\x20System/1.0','Missing\x20id\x20or\x20shortLink\x20in\x20response','loggerService','(8digits-8digits\x20format)','63208oJJtPD','rejected','logWhiteDomainResponse','json','statusText','Iban','Settled','PENDING','message','Unknown\x20error','PAID','application/json','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Response\x20Time:','Failed\x20to\x20parse\x20JSON\x20response:','Response\x20data:','expiryDate','paid','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','apiUrl','Status:','Business\x20Error:\x20','done','Request\x20Body\x20(Direct\x20JSON):','Parsed\x20Result:','../loggerService','BankTransactionId','GET','in_progress','HTTP\x20error!\x20status:\x20','Order\x20ID\x20Format:','PaymentId','Noda\x20API\x20error:\x20','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','verifyWebhookSignature','parse','stack','SettlementDate','Error\x20stack:','logWhiteDomainRequest','fromEntries','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Status\x20Text:','Unknown\x20error\x20from\x20Noda\x20API','/payment-links/','Error\x20Message:','toUpperCase','pending','text','Response\x20Body:','stringify','203RWrapT','amount','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','===\x20NODA\x20SERVICE\x20ERROR\x20===','cancelled','Failed\x20to\x20verify\x20Noda\x20payment:\x20','success','isActive','Status\x20Code:','3996ymQHtQ','__esModule','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','BankId','===\x20NODA\x20API\x20ERROR\x20===','1pMeEwh','EXPIRED','249111MDZjuz','===\x20NODA\x20SUCCESS\x20===','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','active','successful','processWebhook','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Error\x20message:','Headers:','114tnAbwZ','timeout','failed','entries','shortLink','/payment-links','1939552lzOpBs','5278155EbBdqE','log','created','currency','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','error','Amount'];a40_0x59b5=function(){return _0x1f2e23;};return a40_0x59b5();}Object['defineProperty'](exports,a40_0x39bcf0(0x1b9),{'value':!![]}),exports[a40_0x39bcf0(0x1db)]=void 0x0;const loggerService_1=require(a40_0x39bcf0(0x212));function a40_0x2127(_0x588d6f,_0x479d21){const _0x59b579=a40_0x59b5();return a40_0x2127=function(_0x2127b7,_0x4a9827){_0x2127b7=_0x2127b7-0x1aa;let _0x165c35=_0x59b579[_0x2127b7];return _0x165c35;},a40_0x2127(_0x588d6f,_0x479d21);}class NodaService{constructor(){const _0xfa1149=a40_0x39bcf0;this[_0xfa1149(0x20c)]=_0xfa1149(0x1f0),console[_0xfa1149(0x1d0)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a40_0x39bcf0(0x1d9)](_0x3ed955){const _0xc872c3=a40_0x39bcf0,{orderId:_0x398a2e,name:_0x51e46a,paymentDescription:_0x220366,amount:_0x3d2ada,currency:_0x1f6207,webhookUrl:_0x182d48,returnUrl:_0x526146,expiryDate:_0x115626}=_0x3ed955,_0x10859f=_0x1f6207[_0xc872c3(0x1aa)](),_0x6bc270=_0xc872c3(0x1df),_0x2c523d='https://tesoft.uk/gateway/pending.php?id='+_0x398a2e,_0x336d8c={'name':_0x51e46a,'paymentDescription':_0x220366,'amount':_0x3d2ada,'currency':_0x10859f,'paymentId':_0x398a2e,'webhookUrl':_0x6bc270,'returnUrl':_0x2c523d};_0x115626&&(_0x336d8c[_0xc872c3(0x209)]=_0x115626);const _0x256572=Date[_0xc872c3(0x1da)]();try{console[_0xc872c3(0x1d0)](_0xc872c3(0x205)),console[_0xc872c3(0x1d0)]('URL:',this[_0xc872c3(0x20c)]),console[_0xc872c3(0x1d0)](_0xc872c3(0x210),JSON[_0xc872c3(0x1ae)](_0x336d8c,null,0x2)),console['log'](_0xc872c3(0x217),_0x398a2e,_0xc872c3(0x1e6)),console[_0xc872c3(0x1d0)](_0xc872c3(0x1c5),_0x2c523d),loggerService_1[_0xc872c3(0x1f7)][_0xc872c3(0x220)](_0xc872c3(0x1dd),'/payment-links','POST',_0x336d8c);const _0x1d2417=await fetch(this[_0xc872c3(0x20c)],{'method':_0xc872c3(0x1ea),'headers':{'Content-Type':_0xc872c3(0x204),'Accept':_0xc872c3(0x204),'User-Agent':_0xc872c3(0x1f5)},'body':JSON['stringify'](_0x336d8c)}),_0x751fdb=Date[_0xc872c3(0x1da)]()-_0x256572;console['log'](_0xc872c3(0x20b)),console[_0xc872c3(0x1d0)](_0xc872c3(0x20d),_0x1d2417[_0xc872c3(0x1e9)]),console[_0xc872c3(0x1d0)](_0xc872c3(0x223),_0x1d2417[_0xc872c3(0x1fd)]),console['log'](_0xc872c3(0x1c7),Object[_0xc872c3(0x221)](_0x1d2417[_0xc872c3(0x1d8)][_0xc872c3(0x1cb)]())),console[_0xc872c3(0x1d0)](_0xc872c3(0x206),_0x751fdb+'ms');const _0x2d8e96=await _0x1d2417[_0xc872c3(0x1ac)]();console[_0xc872c3(0x1d0)]('Raw\x20Response\x20Body:',_0x2d8e96);if(!_0x1d2417['ok']){console['error'](_0xc872c3(0x1bc)),console[_0xc872c3(0x1d4)]('HTTP\x20Status:',_0x1d2417[_0xc872c3(0x1e9)]),console['error'](_0xc872c3(0x1ad),_0x2d8e96),loggerService_1[_0xc872c3(0x1f7)]['logWhiteDomainResponse'](_0xc872c3(0x1dd),_0xc872c3(0x1cd),_0x1d2417[_0xc872c3(0x1e9)],_0x2d8e96,_0x751fdb),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0xc872c3(0x1cd),'HTTP\x20'+_0x1d2417[_0xc872c3(0x1e9)]+':\x20'+_0x2d8e96);if(_0x1d2417[_0xc872c3(0x1e9)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x1d2417[_0xc872c3(0x1e9)]===0x1f4)throw new Error(_0xc872c3(0x1e2));}throw new Error(_0xc872c3(0x216)+_0x1d2417[_0xc872c3(0x1e9)]+',\x20body:\x20'+_0x2d8e96);}let _0x4cf735;try{_0x4cf735=JSON[_0xc872c3(0x21c)](_0x2d8e96);}catch(_0x31a092){console[_0xc872c3(0x1d4)](_0xc872c3(0x207),_0x31a092),loggerService_1[_0xc872c3(0x1f7)][_0xc872c3(0x1ef)](_0xc872c3(0x1dd),'/payment-links',_0xc872c3(0x1e4)+_0x31a092);throw new Error(_0xc872c3(0x1d6)+_0x2d8e96);}console[_0xc872c3(0x1d0)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0xc872c3(0x1d0)](_0xc872c3(0x211),JSON[_0xc872c3(0x1ae)](_0x4cf735,null,0x2)),loggerService_1[_0xc872c3(0x1f7)][_0xc872c3(0x1fb)](_0xc872c3(0x1dd),_0xc872c3(0x1cd),_0x1d2417['status'],_0x4cf735,_0x751fdb);if(_0x4cf735[_0xc872c3(0x1d4)]||_0x4cf735[_0xc872c3(0x1e8)]){const _0x57cfd9=_0x4cf735[_0xc872c3(0x201)]||_0x4cf735[_0xc872c3(0x1d4)]||_0xc872c3(0x224);console[_0xc872c3(0x1d4)](_0xc872c3(0x1dc)),console[_0xc872c3(0x1d4)](_0xc872c3(0x226),_0x57cfd9),console['error'](_0xc872c3(0x1b7),_0x4cf735[_0xc872c3(0x1e8)]),loggerService_1[_0xc872c3(0x1f7)][_0xc872c3(0x1ef)](_0xc872c3(0x1dd),_0xc872c3(0x1cd),_0xc872c3(0x20e)+_0x57cfd9);throw new Error('Noda\x20API\x20error:\x20'+_0x57cfd9);}if(!_0x4cf735['id']||!_0x4cf735[_0xc872c3(0x1d7)]?.[_0xc872c3(0x1cc)]){console[_0xc872c3(0x1d4)](_0xc872c3(0x21a)),console['error'](_0xc872c3(0x1f6)),console[_0xc872c3(0x1d4)](_0xc872c3(0x208),_0x4cf735),loggerService_1['loggerService'][_0xc872c3(0x1ef)](_0xc872c3(0x1dd),_0xc872c3(0x1cd),_0xc872c3(0x1c1));throw new Error(_0xc872c3(0x1ba));}return console[_0xc872c3(0x1d0)](_0xc872c3(0x1c0)),console[_0xc872c3(0x1d0)](_0xc872c3(0x1e1),_0x4cf735['id']),console[_0xc872c3(0x1d0)]('Short\x20Link:',_0x4cf735[_0xc872c3(0x1d7)]['shortLink']),console[_0xc872c3(0x1d0)](_0xc872c3(0x1de),_0x4cf735[_0xc872c3(0x1d7)]['qrCodeLink']||'Not\x20provided'),console[_0xc872c3(0x1d0)]('Order\x20ID\x20Used:',_0x398a2e,_0xc872c3(0x1f8)),console[_0xc872c3(0x1d0)](_0xc872c3(0x222),_0x2c523d),{'gateway_payment_id':_0x4cf735['id'],'payment_url':_0x4cf735[_0xc872c3(0x1d7)][_0xc872c3(0x1cc)],'qr_code_url':_0x4cf735[_0xc872c3(0x1d7)][_0xc872c3(0x1f1)],'expiry_date':_0x4cf735[_0xc872c3(0x209)]};}catch(_0x1e6520){console[_0xc872c3(0x1d4)](_0xc872c3(0x1b2)),console['error']('Error\x20details:',_0x1e6520),loggerService_1[_0xc872c3(0x1f7)][_0xc872c3(0x1ef)](_0xc872c3(0x1dd),_0xc872c3(0x1cd),_0x1e6520);if(_0x1e6520 instanceof Error){console['error'](_0xc872c3(0x1c6),_0x1e6520[_0xc872c3(0x201)]),console['error'](_0xc872c3(0x21f),_0x1e6520[_0xc872c3(0x21d)]);throw new Error(_0xc872c3(0x1d3)+_0x1e6520['message']);}throw new Error(_0xc872c3(0x1b1));}}async['verifyPayment'](_0x54b2ea){const _0x22ca69=a40_0x39bcf0,_0x2d96f=Date[_0x22ca69(0x1da)]();try{loggerService_1[_0x22ca69(0x1f7)][_0x22ca69(0x220)](_0x22ca69(0x1dd),'/payment-links/'+_0x54b2ea,_0x22ca69(0x214),{});const _0x220f75=await fetch(this[_0x22ca69(0x20c)]+'/'+_0x54b2ea,{'method':_0x22ca69(0x214),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x592fda=Date[_0x22ca69(0x1da)]()-_0x2d96f;if(!_0x220f75['ok']){const _0x5481f7=await _0x220f75[_0x22ca69(0x1ac)]();loggerService_1[_0x22ca69(0x1f7)][_0x22ca69(0x1fb)](_0x22ca69(0x1dd),_0x22ca69(0x225)+_0x54b2ea,_0x220f75[_0x22ca69(0x1e9)],_0x5481f7,_0x592fda);throw new Error('HTTP\x20error!\x20status:\x20'+_0x220f75[_0x22ca69(0x1e9)]);}const _0x2484b4=await _0x220f75[_0x22ca69(0x1fc)]();loggerService_1[_0x22ca69(0x1f7)][_0x22ca69(0x1fb)](_0x22ca69(0x1dd),_0x22ca69(0x225)+_0x54b2ea,_0x220f75[_0x22ca69(0x1e9)],_0x2484b4,_0x592fda);if(_0x2484b4[_0x22ca69(0x1d4)]||_0x2484b4[_0x22ca69(0x1e8)]){loggerService_1['loggerService'][_0x22ca69(0x1ef)](_0x22ca69(0x1dd),_0x22ca69(0x225)+_0x54b2ea,_0x22ca69(0x219)+(_0x2484b4[_0x22ca69(0x201)]||_0x2484b4[_0x22ca69(0x1d4)]||_0x22ca69(0x202)));throw new Error(_0x22ca69(0x219)+(_0x2484b4['message']||_0x2484b4[_0x22ca69(0x1d4)]||_0x22ca69(0x202)));}let _0x21b616=_0x22ca69(0x200);if(_0x2484b4[_0x22ca69(0x1b6)]===![]){if(_0x2484b4[_0x22ca69(0x209)]){const _0xb97549=new Date(_0x2484b4['expiryDate']),_0x1e5ee5=new Date();_0xb97549<_0x1e5ee5?_0x21b616='EXPIRED':_0x21b616=_0x22ca69(0x1f3);}else _0x21b616=_0x22ca69(0x1f3);}else _0x21b616=_0x22ca69(0x200);return{'status':_0x21b616,'amount':_0x2484b4[_0x22ca69(0x1b0)],'currency':_0x2484b4[_0x22ca69(0x1d2)],'isActive':_0x2484b4[_0x22ca69(0x1b6)]};}catch(_0x22691c){console[_0x22ca69(0x1d4)]('Noda\x20payment\x20verification\x20error:',_0x22691c),loggerService_1[_0x22ca69(0x1f7)][_0x22ca69(0x1ef)](_0x22ca69(0x1dd),'/payment-links/'+_0x54b2ea,_0x22691c);throw new Error(_0x22ca69(0x1b4)+(_0x22691c instanceof Error?_0x22691c[_0x22ca69(0x201)]:'Unknown\x20error'));}}async[a40_0x39bcf0(0x1c4)](_0x1e557d){const _0x47cfc4=a40_0x39bcf0;console[_0x47cfc4(0x1d0)](_0x47cfc4(0x1ee),_0x1e557d);let _0x4dbd10='PENDING';switch(_0x1e557d[_0x47cfc4(0x1ec)]?.['toLowerCase']()){case _0x47cfc4(0x20f):case'completed':case _0x47cfc4(0x20a):case _0x47cfc4(0x1b5):case _0x47cfc4(0x1c3):_0x1e557d['Settled']==='Yes'?_0x4dbd10=_0x47cfc4(0x203):_0x4dbd10=_0x47cfc4(0x200);break;case _0x47cfc4(0x1b3):case _0x47cfc4(0x1ed):case _0x47cfc4(0x1ca):case _0x47cfc4(0x1d4):case _0x47cfc4(0x1fa):_0x4dbd10=_0x47cfc4(0x1f3);break;case _0x47cfc4(0x1f2):case _0x47cfc4(0x1c9):_0x4dbd10=_0x47cfc4(0x1be);break;case _0x47cfc4(0x1ab):case _0x47cfc4(0x1d1):case _0x47cfc4(0x1c2):case _0x47cfc4(0x1e5):case _0x47cfc4(0x215):default:_0x4dbd10='PENDING';break;}return{'paymentId':_0x1e557d[_0x47cfc4(0x1e3)]||_0x1e557d[_0x47cfc4(0x218)],'status':_0x4dbd10,'amount':_0x1e557d[_0x47cfc4(0x1d5)],'currency':_0x1e557d[_0x47cfc4(0x1f4)],'additionalInfo':{'method':_0x1e557d['Method'],'bankId':_0x1e557d[_0x47cfc4(0x1bb)],'settled':_0x1e557d[_0x47cfc4(0x1ff)],'settlementDate':_0x1e557d[_0x47cfc4(0x21e)],'remitterName':_0x1e557d['Remitter']?.['Name'],'remitterIban':_0x1e557d['Remitter']?.[_0x47cfc4(0x1fe)],'bankTransactionId':_0x1e557d[_0x47cfc4(0x213)]}};}[a40_0x39bcf0(0x21b)](_0x2ce0f0,_0x3b100b){const _0x4c6de9=a40_0x39bcf0;return console[_0x4c6de9(0x1d0)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x3b100b,'paymentId':_0x2ce0f0['PaymentId'],'merchantPaymentId':_0x2ce0f0['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;