'use strict';const a43_0x5c6007=a43_0x4545;(function(_0x2bd904,_0x56e7d2){const _0x336f84=a43_0x4545,_0x2d292f=_0x2bd904();while(!![]){try{const _0x16e348=parseInt(_0x336f84(0x1ae))/0x1*(parseInt(_0x336f84(0x1f5))/0x2)+parseInt(_0x336f84(0x1f4))/0x3+-parseInt(_0x336f84(0x209))/0x4+parseInt(_0x336f84(0x1e7))/0x5*(-parseInt(_0x336f84(0x1cb))/0x6)+-parseInt(_0x336f84(0x1c4))/0x7+-parseInt(_0x336f84(0x1e6))/0x8*(parseInt(_0x336f84(0x215))/0x9)+parseInt(_0x336f84(0x1c9))/0xa;if(_0x16e348===_0x56e7d2)break;else _0x2d292f['push'](_0x2d292f['shift']());}catch(_0x3eddb2){_0x2d292f['push'](_0x2d292f['shift']());}}}(a43_0x1d5b,0x48c88));Object[a43_0x5c6007(0x1c2)](exports,a43_0x5c6007(0x1b1),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a43_0x5c6007(0x213));class NodaService{constructor(){const _0x5c3f56=a43_0x5c6007;this[_0x5c3f56(0x1f9)]='https://tesoft.uk/gateway/noda/',console['log'](_0x5c3f56(0x1dc));}async[a43_0x5c6007(0x1b7)](_0x2116fb){const _0x11e561=a43_0x5c6007,{orderId:_0x1af559,name:_0x250426,paymentDescription:_0x460a82,amount:_0x29a630,currency:_0x134328,webhookUrl:_0x1f2dfd,returnUrl:_0x32481a,expiryDate:_0x47d38e}=_0x2116fb,_0x1001bc=_0x134328[_0x11e561(0x1ba)](),_0x5a536a='https://tesoft.uk/gateway/noda/webhook/',_0x1bad8c=_0x11e561(0x1b9)+_0x1af559,_0x15ee5d={'name':_0x250426,'paymentDescription':_0x460a82,'amount':_0x29a630,'currency':_0x1001bc,'paymentId':_0x1af559,'webhookUrl':_0x5a536a,'returnUrl':_0x1bad8c};_0x47d38e&&(_0x15ee5d[_0x11e561(0x211)]=_0x47d38e);const _0x14ce15=Date[_0x11e561(0x1b4)]();try{console[_0x11e561(0x212)](_0x11e561(0x204)),console[_0x11e561(0x212)]('URL:',this['apiUrl']),console[_0x11e561(0x212)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x11e561(0x1c8)](_0x15ee5d,null,0x2)),console['log'](_0x11e561(0x202),_0x1af559,_0x11e561(0x1ca)),console[_0x11e561(0x212)](_0x11e561(0x200),_0x1bad8c),loggerService_1[_0x11e561(0x1d5)]['logWhiteDomainRequest'](_0x11e561(0x1ef),'/payment-links',_0x11e561(0x1f0),_0x15ee5d);const _0x2473f3=await fetch(this[_0x11e561(0x1f9)],{'method':_0x11e561(0x1f0),'headers':{'Content-Type':_0x11e561(0x1ab),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x15ee5d)}),_0x3dd2d0=Date[_0x11e561(0x1b4)]()-_0x14ce15;console['log'](_0x11e561(0x20a)),console[_0x11e561(0x212)](_0x11e561(0x1e2),_0x2473f3[_0x11e561(0x1dd)]),console[_0x11e561(0x212)](_0x11e561(0x1db),_0x2473f3[_0x11e561(0x1ff)]),console[_0x11e561(0x212)]('Headers:',Object[_0x11e561(0x205)](_0x2473f3['headers'][_0x11e561(0x1a8)]())),console['log'](_0x11e561(0x1ed),_0x3dd2d0+'ms');const _0x137dec=await _0x2473f3['text']();console['log'](_0x11e561(0x1eb),_0x137dec);if(!_0x2473f3['ok']){console[_0x11e561(0x1de)](_0x11e561(0x1fd)),console[_0x11e561(0x1de)](_0x11e561(0x1bc),_0x2473f3[_0x11e561(0x1dd)]),console['error'](_0x11e561(0x1d3),_0x137dec),loggerService_1[_0x11e561(0x1d5)][_0x11e561(0x1f1)](_0x11e561(0x1ef),'/payment-links',_0x2473f3[_0x11e561(0x1dd)],_0x137dec,_0x3dd2d0),loggerService_1[_0x11e561(0x1d5)]['logWhiteDomainError'](_0x11e561(0x1ef),_0x11e561(0x1b8),'HTTP\x20'+_0x2473f3[_0x11e561(0x1dd)]+':\x20'+_0x137dec);if(_0x2473f3[_0x11e561(0x1dd)]===0x190)throw new Error(_0x11e561(0x1c0));else{if(_0x2473f3[_0x11e561(0x1dd)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error('HTTP\x20error!\x20status:\x20'+_0x2473f3[_0x11e561(0x1dd)]+_0x11e561(0x1d1)+_0x137dec);}let _0xa48d9f;try{_0xa48d9f=JSON[_0x11e561(0x1fb)](_0x137dec);}catch(_0x3402d3){console['error'](_0x11e561(0x1d9),_0x3402d3),loggerService_1[_0x11e561(0x1d5)]['logWhiteDomainError']('noda',_0x11e561(0x1b8),'JSON\x20Parse\x20Error:\x20'+_0x3402d3);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x137dec);}console[_0x11e561(0x212)](_0x11e561(0x1cd)),console['log'](_0x11e561(0x20f),JSON[_0x11e561(0x1c8)](_0xa48d9f,null,0x2)),loggerService_1[_0x11e561(0x1d5)][_0x11e561(0x1f1)](_0x11e561(0x1ef),_0x11e561(0x1b8),_0x2473f3[_0x11e561(0x1dd)],_0xa48d9f,_0x3dd2d0);if(_0xa48d9f['error']||_0xa48d9f['statusCode']){const _0x38e182=_0xa48d9f[_0x11e561(0x1ad)]||_0xa48d9f[_0x11e561(0x1de)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x11e561(0x1de)](_0x11e561(0x203)),console[_0x11e561(0x1de)](_0x11e561(0x20d),_0x38e182),console[_0x11e561(0x1de)](_0x11e561(0x1c1),_0xa48d9f[_0x11e561(0x1c5)]),loggerService_1[_0x11e561(0x1d5)][_0x11e561(0x1bb)](_0x11e561(0x1ef),'/payment-links',_0x11e561(0x1ea)+_0x38e182);throw new Error(_0x11e561(0x216)+_0x38e182);}if(!_0xa48d9f['id']||!_0xa48d9f[_0x11e561(0x1fe)]?.['shortLink']){console[_0x11e561(0x1de)](_0x11e561(0x1d8)),console[_0x11e561(0x1de)](_0x11e561(0x1e8)),console['error'](_0x11e561(0x1b0),_0xa48d9f),loggerService_1[_0x11e561(0x1d5)][_0x11e561(0x1bb)](_0x11e561(0x1ef),_0x11e561(0x1b8),_0x11e561(0x1a9));throw new Error(_0x11e561(0x1b3));}return console[_0x11e561(0x212)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x11e561(0x212)]('Payment\x20Link\x20ID:',_0xa48d9f['id']),console[_0x11e561(0x212)](_0x11e561(0x1aa),_0xa48d9f[_0x11e561(0x1fe)][_0x11e561(0x1fa)]),console[_0x11e561(0x212)]('QR\x20Code\x20Link:',_0xa48d9f[_0x11e561(0x1fe)][_0x11e561(0x1f6)]||_0x11e561(0x1b6)),console[_0x11e561(0x212)]('Order\x20ID\x20Used:',_0x1af559,'(8digits-8digits\x20format)'),console[_0x11e561(0x212)](_0x11e561(0x1ac),_0x1bad8c),{'gateway_payment_id':_0xa48d9f['id'],'payment_url':_0xa48d9f['shortLinkUrls'][_0x11e561(0x1fa)],'qr_code_url':_0xa48d9f[_0x11e561(0x1fe)][_0x11e561(0x1f6)],'expiry_date':_0xa48d9f[_0x11e561(0x211)]};}catch(_0x9afbb4){console[_0x11e561(0x1de)](_0x11e561(0x214)),console['error'](_0x11e561(0x1af),_0x9afbb4),loggerService_1[_0x11e561(0x1d5)]['logWhiteDomainError']('noda',_0x11e561(0x1b8),_0x9afbb4);if(_0x9afbb4 instanceof Error){console[_0x11e561(0x1de)]('Error\x20message:',_0x9afbb4[_0x11e561(0x1ad)]),console[_0x11e561(0x1de)]('Error\x20stack:',_0x9afbb4[_0x11e561(0x1f8)]);throw new Error(_0x11e561(0x1f3)+_0x9afbb4[_0x11e561(0x1ad)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x5c6007(0x1d7)](_0x521937){const _0x2e95f2=a43_0x5c6007,_0x2df496=Date[_0x2e95f2(0x1b4)]();try{loggerService_1[_0x2e95f2(0x1d5)][_0x2e95f2(0x1ec)](_0x2e95f2(0x1ef),'/payment-links/'+_0x521937,_0x2e95f2(0x1bd),{});const _0x4abb3e=await fetch(this[_0x2e95f2(0x1f9)]+'/'+_0x521937,{'method':_0x2e95f2(0x1bd),'headers':{'Content-Type':_0x2e95f2(0x1ab),'User-Agent':_0x2e95f2(0x1e1)}}),_0xc0e2b0=Date['now']()-_0x2df496;if(!_0x4abb3e['ok']){const _0x106f15=await _0x4abb3e[_0x2e95f2(0x1c6)]();loggerService_1['loggerService'][_0x2e95f2(0x1f1)](_0x2e95f2(0x1ef),_0x2e95f2(0x1fc)+_0x521937,_0x4abb3e[_0x2e95f2(0x1dd)],_0x106f15,_0xc0e2b0);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4abb3e['status']);}const _0x296c2a=await _0x4abb3e['json']();loggerService_1[_0x2e95f2(0x1d5)][_0x2e95f2(0x1f1)](_0x2e95f2(0x1ef),'/payment-links/'+_0x521937,_0x4abb3e[_0x2e95f2(0x1dd)],_0x296c2a,_0xc0e2b0);if(_0x296c2a['error']||_0x296c2a[_0x2e95f2(0x1c5)]){loggerService_1[_0x2e95f2(0x1d5)][_0x2e95f2(0x1bb)](_0x2e95f2(0x1ef),_0x2e95f2(0x1fc)+_0x521937,'Noda\x20API\x20error:\x20'+(_0x296c2a[_0x2e95f2(0x1ad)]||_0x296c2a['error']||_0x2e95f2(0x206)));throw new Error('Noda\x20API\x20error:\x20'+(_0x296c2a[_0x2e95f2(0x1ad)]||_0x296c2a[_0x2e95f2(0x1de)]||_0x2e95f2(0x206)));}let _0xb920ec=_0x2e95f2(0x1f2);if(_0x296c2a[_0x2e95f2(0x1be)]===![]){if(_0x296c2a[_0x2e95f2(0x211)]){const _0x37d88e=new Date(_0x296c2a[_0x2e95f2(0x211)]),_0x43fda6=new Date();_0x37d88e<_0x43fda6?_0xb920ec='EXPIRED':_0xb920ec=_0x2e95f2(0x1ce);}else _0xb920ec=_0x2e95f2(0x1ce);}else _0xb920ec=_0x2e95f2(0x1f2);return{'status':_0xb920ec,'amount':_0x296c2a[_0x2e95f2(0x1d0)],'currency':_0x296c2a['currency'],'isActive':_0x296c2a['isActive']};}catch(_0x271839){console[_0x2e95f2(0x1de)]('Noda\x20payment\x20verification\x20error:',_0x271839),loggerService_1[_0x2e95f2(0x1d5)][_0x2e95f2(0x1bb)](_0x2e95f2(0x1ef),'/payment-links/'+_0x521937,_0x271839);throw new Error(_0x2e95f2(0x1ee)+(_0x271839 instanceof Error?_0x271839[_0x2e95f2(0x1ad)]:'Unknown\x20error'));}}async['processWebhook'](_0x109e71){const _0x330b9b=a43_0x5c6007;console[_0x330b9b(0x212)]('Processing\x20Noda\x20webhook:',_0x109e71);let _0x14049b=_0x330b9b(0x1f2);switch(_0x109e71[_0x330b9b(0x20e)]?.[_0x330b9b(0x1d2)]()){case'done':case'completed':case'paid':case _0x330b9b(0x1c3):case _0x330b9b(0x1e9):_0x109e71[_0x330b9b(0x1cc)]===_0x330b9b(0x1df)?_0x14049b=_0x330b9b(0x1bf):_0x14049b='PENDING';break;case _0x330b9b(0x1d6):case'canceled':case _0x330b9b(0x1e0):case _0x330b9b(0x1de):case _0x330b9b(0x1f7):_0x14049b='FAILED';break;case _0x330b9b(0x208):case'timeout':_0x14049b='EXPIRED';break;case _0x330b9b(0x20b):case _0x330b9b(0x1a7):case _0x330b9b(0x210):case'processing':case _0x330b9b(0x1e4):default:_0x14049b=_0x330b9b(0x1f2);break;}return{'paymentId':_0x109e71[_0x330b9b(0x207)]||_0x109e71[_0x330b9b(0x1e5)],'status':_0x14049b,'amount':_0x109e71[_0x330b9b(0x1cf)],'currency':_0x109e71['Currency'],'additionalInfo':{'method':_0x109e71[_0x330b9b(0x1b2)],'bankId':_0x109e71[_0x330b9b(0x1e3)],'settled':_0x109e71['Settled'],'settlementDate':_0x109e71['SettlementDate'],'remitterName':_0x109e71['Remitter']?.[_0x330b9b(0x1c7)],'remitterIban':_0x109e71[_0x330b9b(0x20c)]?.[_0x330b9b(0x201)],'bankTransactionId':_0x109e71[_0x330b9b(0x1b5)]}};}['verifyWebhookSignature'](_0x32a7cd,_0x1528b1){const _0xa2e7e5=a43_0x5c6007;return console[_0xa2e7e5(0x212)](_0xa2e7e5(0x1d4),{'receivedSignature':_0x1528b1,'paymentId':_0x32a7cd[_0xa2e7e5(0x1e5)],'merchantPaymentId':_0x32a7cd[_0xa2e7e5(0x207)]}),!![];}}function a43_0x1d5b(){const _0x3955c4=['12Flwdlv','Settled','===\x20PARSED\x20NODA\x20RESPONSE\x20===','FAILED','Amount','amount',',\x20body:\x20','toLowerCase','Response\x20Body:','Noda\x20webhook\x20signature\x20verification:','loggerService','cancelled','verifyPayment','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20parse\x20JSON\x20response:','NodaService','Status\x20Text:','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','status','error','Yes','failed','TesSoft\x20Payment\x20System/1.0','Status:','BankId','in_progress','PaymentId','72BAIZff','101805UBeTfa','Missing\x20id\x20or\x20shortLink\x20in\x20response','successful','Business\x20Error:\x20','Raw\x20Response\x20Body:','logWhiteDomainRequest','Response\x20Time:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','noda','POST','logWhiteDomainResponse','PENDING','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','1235046bUoUdd','2IKODfy','qrCodeLink','rejected','stack','apiUrl','shortLink','parse','/payment-links/','===\x20NODA\x20API\x20ERROR\x20===','shortLinkUrls','statusText','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','Iban','Order\x20ID\x20Format:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','fromEntries','Unknown\x20error','MerchantPaymentId','expired','894760zTyknB','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','pending','Remitter','Error\x20Message:','Status','Parsed\x20Result:','active','expiryDate','log','../loggerService','===\x20NODA\x20SERVICE\x20ERROR\x20===','392508UuvGsM','Noda\x20API\x20error:\x20','created','entries','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Short\x20Link:','application/json','✅\x20Return\x20URL\x20configured\x20for\x20pending:','message','201004OObiec','Error\x20details:','Response\x20data:','__esModule','Method','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','now','BankTransactionId','Not\x20provided','createPaymentLink','/payment-links','https://tesoft.uk/gateway/pending.php?id=','toUpperCase','logWhiteDomainError','HTTP\x20Status:','GET','isActive','PAID','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Status\x20Code:','defineProperty','success','3064481DPhGwd','statusCode','text','Name','stringify','7801370DqHSIJ','(8digits-8digits\x20format\x20for\x20Noda)'];a43_0x1d5b=function(){return _0x3955c4;};return a43_0x1d5b();}function a43_0x4545(_0x30d1dc,_0x405bee){const _0x1d5ba4=a43_0x1d5b();return a43_0x4545=function(_0x454582,_0x4c69e6){_0x454582=_0x454582-0x1a7;let _0x460f65=_0x1d5ba4[_0x454582];return _0x460f65;},a43_0x4545(_0x30d1dc,_0x405bee);}exports[a43_0x5c6007(0x1da)]=NodaService;