'use strict';const a40_0xc89002=a40_0x529e;(function(_0x20f07d,_0x22a168){const _0x1d27bb=a40_0x529e,_0xb490be=_0x20f07d();while(!![]){try{const _0x167c9b=-parseInt(_0x1d27bb(0x121))/0x1*(parseInt(_0x1d27bb(0x122))/0x2)+parseInt(_0x1d27bb(0x13e))/0x3*(-parseInt(_0x1d27bb(0xd9))/0x4)+parseInt(_0x1d27bb(0x108))/0x5+parseInt(_0x1d27bb(0xe3))/0x6*(parseInt(_0x1d27bb(0x12c))/0x7)+-parseInt(_0x1d27bb(0xef))/0x8+-parseInt(_0x1d27bb(0x11b))/0x9+parseInt(_0x1d27bb(0xf1))/0xa*(parseInt(_0x1d27bb(0xe1))/0xb);if(_0x167c9b===_0x22a168)break;else _0xb490be['push'](_0xb490be['shift']());}catch(_0xd9e1b4){_0xb490be['push'](_0xb490be['shift']());}}}(a40_0x58a8,0x5fdce));function a40_0x529e(_0x4e053e,_0x123dff){const _0x58a859=a40_0x58a8();return a40_0x529e=function(_0x529e66,_0x5d6f53){_0x529e66=_0x529e66-0xcb;let _0x21f5e2=_0x58a859[_0x529e66];return _0x21f5e2;},a40_0x529e(_0x4e053e,_0x123dff);}Object[a40_0xc89002(0x116)](exports,a40_0xc89002(0xee),{'value':!![]}),exports[a40_0xc89002(0xf2)]=void 0x0;const loggerService_1=require(a40_0xc89002(0x126));class NodaService{constructor(){const _0x46da0b=a40_0xc89002;this[_0x46da0b(0x110)]='https://tesoft.uk/gateway/noda/',console[_0x46da0b(0xf7)](_0x46da0b(0x133));}async[a40_0xc89002(0x13d)](_0x3d2361){const _0x1b34ba=a40_0xc89002,{orderId:_0x4c4d46,name:_0x5227be,paymentDescription:_0xffc0a5,amount:_0x213fdf,currency:_0x371ed3,webhookUrl:_0x451a52,returnUrl:_0x2e2b14,expiryDate:_0x19f2f5}=_0x3d2361,_0x1c08a5=_0x371ed3[_0x1b34ba(0x140)](),_0xb2eb95='https://tesoft.uk/gateway/noda/webhook/',_0x50cae2='https://tesoft.uk/gateway/success.php?id='+_0x4c4d46,_0x1d1a14={'name':_0x5227be,'paymentDescription':_0xffc0a5,'amount':_0x213fdf,'currency':_0x1c08a5,'paymentId':_0x4c4d46,'webhookUrl':_0xb2eb95,'returnUrl':_0x50cae2};_0x19f2f5&&(_0x1d1a14[_0x1b34ba(0x13c)]=_0x19f2f5);const _0x571dba=Date[_0x1b34ba(0xf9)]();try{console[_0x1b34ba(0xf7)](_0x1b34ba(0x113)),console[_0x1b34ba(0xf7)](_0x1b34ba(0x101),this['apiUrl']),console['log'](_0x1b34ba(0xe2),JSON[_0x1b34ba(0xcf)](_0x1d1a14,null,0x2)),console['log'](_0x1b34ba(0x138),_0x4c4d46,'(8digits-8digits\x20format\x20for\x20Noda)'),loggerService_1['loggerService'][_0x1b34ba(0xdb)](_0x1b34ba(0x10d),_0x1b34ba(0xeb),_0x1b34ba(0x13a),_0x1d1a14);const _0x6c604e=await fetch(this['apiUrl'],{'method':_0x1b34ba(0x13a),'headers':{'Content-Type':_0x1b34ba(0x13b),'Accept':_0x1b34ba(0x13b),'User-Agent':_0x1b34ba(0xf0)},'body':JSON[_0x1b34ba(0xcf)](_0x1d1a14)}),_0x1c51bd=Date[_0x1b34ba(0xf9)]()-_0x571dba;console[_0x1b34ba(0xf7)](_0x1b34ba(0x104)),console['log'](_0x1b34ba(0x139),_0x6c604e['status']),console[_0x1b34ba(0xf7)](_0x1b34ba(0xf4),_0x6c604e[_0x1b34ba(0x137)]),console[_0x1b34ba(0xf7)]('Headers:',Object['fromEntries'](_0x6c604e[_0x1b34ba(0x131)][_0x1b34ba(0xd5)]())),console['log']('Response\x20Time:',_0x1c51bd+'ms');const _0xebe463=await _0x6c604e[_0x1b34ba(0x135)]();console[_0x1b34ba(0xf7)](_0x1b34ba(0xf3),_0xebe463);if(!_0x6c604e['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x1b34ba(0xd0)](_0x1b34ba(0x129),_0x6c604e[_0x1b34ba(0xdd)]),console['error'](_0x1b34ba(0xe4),_0xebe463),loggerService_1[_0x1b34ba(0xe0)][_0x1b34ba(0x128)](_0x1b34ba(0x10d),'/payment-links',_0x6c604e[_0x1b34ba(0xdd)],_0xebe463,_0x1c51bd),loggerService_1[_0x1b34ba(0xe0)][_0x1b34ba(0xd3)](_0x1b34ba(0x10d),'/payment-links',_0x1b34ba(0x111)+_0x6c604e[_0x1b34ba(0xdd)]+':\x20'+_0xebe463);if(_0x6c604e[_0x1b34ba(0xdd)]===0x190)throw new Error(_0x1b34ba(0x102));else{if(_0x6c604e['status']===0x1f4)throw new Error(_0x1b34ba(0x10f));}throw new Error(_0x1b34ba(0x10e)+_0x6c604e[_0x1b34ba(0xdd)]+_0x1b34ba(0x11e)+_0xebe463);}let _0x287e08;try{_0x287e08=JSON['parse'](_0xebe463);}catch(_0x260313){console['error'](_0x1b34ba(0xfa),_0x260313),loggerService_1[_0x1b34ba(0xe0)][_0x1b34ba(0xd3)](_0x1b34ba(0x10d),_0x1b34ba(0xeb),'JSON\x20Parse\x20Error:\x20'+_0x260313);throw new Error(_0x1b34ba(0xe8)+_0xebe463);}console['log'](_0x1b34ba(0x114)),console['log'](_0x1b34ba(0x123),JSON[_0x1b34ba(0xcf)](_0x287e08,null,0x2)),loggerService_1[_0x1b34ba(0xe0)][_0x1b34ba(0x128)](_0x1b34ba(0x10d),_0x1b34ba(0xeb),_0x6c604e['status'],_0x287e08,_0x1c51bd);if(_0x287e08[_0x1b34ba(0xd0)]||_0x287e08['statusCode']){const _0x5cd89e=_0x287e08[_0x1b34ba(0xea)]||_0x287e08[_0x1b34ba(0xd0)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x1b34ba(0xd0)](_0x1b34ba(0xd4)),console[_0x1b34ba(0xd0)](_0x1b34ba(0xe7),_0x5cd89e),console[_0x1b34ba(0xd0)](_0x1b34ba(0x117),_0x287e08[_0x1b34ba(0x11f)]),loggerService_1[_0x1b34ba(0xe0)][_0x1b34ba(0xd3)](_0x1b34ba(0x10d),_0x1b34ba(0xeb),_0x1b34ba(0xd2)+_0x5cd89e);throw new Error('Noda\x20API\x20error:\x20'+_0x5cd89e);}if(!_0x287e08['id']||!_0x287e08[_0x1b34ba(0x130)]?.[_0x1b34ba(0x119)]){console[_0x1b34ba(0xd0)](_0x1b34ba(0xda)),console[_0x1b34ba(0xd0)](_0x1b34ba(0xcc)),console[_0x1b34ba(0xd0)](_0x1b34ba(0xd8),_0x287e08),loggerService_1[_0x1b34ba(0xe0)]['logWhiteDomainError']('noda',_0x1b34ba(0xeb),_0x1b34ba(0x13f));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x1b34ba(0xf7)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x1b34ba(0xf7)](_0x1b34ba(0x100),_0x287e08['id']),console[_0x1b34ba(0xf7)](_0x1b34ba(0x10b),_0x287e08[_0x1b34ba(0x130)][_0x1b34ba(0x119)]),console[_0x1b34ba(0xf7)]('QR\x20Code\x20Link:',_0x287e08['shortLinkUrls']['qrCodeLink']||_0x1b34ba(0x106)),console[_0x1b34ba(0xf7)](_0x1b34ba(0x11a),_0x4c4d46,'(8digits-8digits\x20format)'),{'gateway_payment_id':_0x287e08['id'],'payment_url':_0x287e08['shortLinkUrls'][_0x1b34ba(0x119)],'qr_code_url':_0x287e08[_0x1b34ba(0x130)]['qrCodeLink'],'expiry_date':_0x287e08[_0x1b34ba(0x13c)]};}catch(_0x1cdb44){console[_0x1b34ba(0xd0)](_0x1b34ba(0x125)),console['error'](_0x1b34ba(0x134),_0x1cdb44),loggerService_1['loggerService'][_0x1b34ba(0xd3)](_0x1b34ba(0x10d),'/payment-links',_0x1cdb44);if(_0x1cdb44 instanceof Error){console[_0x1b34ba(0xd0)](_0x1b34ba(0xcd),_0x1cdb44['message']),console[_0x1b34ba(0xd0)](_0x1b34ba(0x11d),_0x1cdb44['stack']);throw new Error(_0x1b34ba(0xec)+_0x1cdb44[_0x1b34ba(0xea)]);}throw new Error(_0x1b34ba(0x10c));}}async[a40_0xc89002(0x141)](_0x5cd10c){const _0x102b32=a40_0xc89002,_0x2a59e7=Date[_0x102b32(0xf9)]();try{loggerService_1[_0x102b32(0xe0)][_0x102b32(0xdb)](_0x102b32(0x10d),'/payment-links/'+_0x5cd10c,_0x102b32(0xdc),{});const _0x1703fe=await fetch(this[_0x102b32(0x110)]+'/'+_0x5cd10c,{'method':_0x102b32(0xdc),'headers':{'Content-Type':_0x102b32(0x13b),'User-Agent':_0x102b32(0xf0)}}),_0x2b2062=Date[_0x102b32(0xf9)]()-_0x2a59e7;if(!_0x1703fe['ok']){const _0x57de69=await _0x1703fe[_0x102b32(0x135)]();loggerService_1[_0x102b32(0xe0)]['logWhiteDomainResponse']('noda',_0x102b32(0xf8)+_0x5cd10c,_0x1703fe['status'],_0x57de69,_0x2b2062);throw new Error(_0x102b32(0x10e)+_0x1703fe[_0x102b32(0xdd)]);}const _0x119f47=await _0x1703fe[_0x102b32(0x127)]();loggerService_1[_0x102b32(0xe0)][_0x102b32(0x128)]('noda','/payment-links/'+_0x5cd10c,_0x1703fe['status'],_0x119f47,_0x2b2062);if(_0x119f47[_0x102b32(0xd0)]||_0x119f47[_0x102b32(0x11f)]){loggerService_1['loggerService'][_0x102b32(0xd3)](_0x102b32(0x10d),_0x102b32(0xf8)+_0x5cd10c,_0x102b32(0x12d)+(_0x119f47[_0x102b32(0xea)]||_0x119f47['error']||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x119f47[_0x102b32(0xea)]||_0x119f47[_0x102b32(0xd0)]||_0x102b32(0x12f)));}let _0x5a380f='PENDING';if(_0x119f47[_0x102b32(0x109)]===![]){if(_0x119f47[_0x102b32(0x13c)]){const _0x482cbb=new Date(_0x119f47[_0x102b32(0x13c)]),_0x755b08=new Date();_0x482cbb<_0x755b08?_0x5a380f=_0x102b32(0xf5):_0x5a380f=_0x102b32(0x12a);}else _0x5a380f=_0x102b32(0x12a);}else _0x5a380f=_0x102b32(0xe9);return{'status':_0x5a380f,'amount':_0x119f47['amount'],'currency':_0x119f47[_0x102b32(0xd7)],'isActive':_0x119f47['isActive']};}catch(_0x4dbfce){console['error'](_0x102b32(0xcb),_0x4dbfce),loggerService_1['loggerService'][_0x102b32(0xd3)](_0x102b32(0x10d),'/payment-links/'+_0x5cd10c,_0x4dbfce);throw new Error(_0x102b32(0xe6)+(_0x4dbfce instanceof Error?_0x4dbfce[_0x102b32(0xea)]:_0x102b32(0x12f)));}}async[a40_0xc89002(0x124)](_0x1a399c){const _0x2ded34=a40_0xc89002;console[_0x2ded34(0xf7)](_0x2ded34(0x107),_0x1a399c);let _0x160b02=_0x2ded34(0xe9);switch(_0x1a399c[_0x2ded34(0xfc)]?.[_0x2ded34(0xdf)]()){case _0x2ded34(0xed):case _0x2ded34(0xd1):case'paid':case _0x2ded34(0xf6):case'successful':_0x1a399c[_0x2ded34(0xce)]===_0x2ded34(0xfe)?_0x160b02='PAID':_0x160b02=_0x2ded34(0xe9);break;case _0x2ded34(0xe5):case _0x2ded34(0x115):case'failed':case _0x2ded34(0xd0):case'rejected':_0x160b02=_0x2ded34(0x12a);break;case _0x2ded34(0x118):case _0x2ded34(0x112):_0x160b02=_0x2ded34(0xf5);break;case _0x2ded34(0xff):case _0x2ded34(0x11c):case _0x2ded34(0xde):case _0x2ded34(0x10a):case _0x2ded34(0x120):default:_0x160b02=_0x2ded34(0xe9);break;}return{'paymentId':_0x1a399c[_0x2ded34(0x132)]||_0x1a399c[_0x2ded34(0x103)],'status':_0x160b02,'amount':_0x1a399c[_0x2ded34(0x12b)],'currency':_0x1a399c['Currency'],'additionalInfo':{'method':_0x1a399c[_0x2ded34(0xfb)],'bankId':_0x1a399c[_0x2ded34(0x136)],'settled':_0x1a399c[_0x2ded34(0xce)],'settlementDate':_0x1a399c[_0x2ded34(0x12e)],'remitterName':_0x1a399c[_0x2ded34(0xd6)]?.[_0x2ded34(0x105)],'remitterIban':_0x1a399c[_0x2ded34(0xd6)]?.['Iban'],'bankTransactionId':_0x1a399c[_0x2ded34(0xfd)]}};}['verifyWebhookSignature'](_0x4fa268,_0x21832b){const _0x159cdb=a40_0xc89002;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x21832b,'paymentId':_0x4fa268['PaymentId'],'merchantPaymentId':_0x4fa268[_0x159cdb(0x132)]}),!![];}}function a40_0x58a8(){const _0xe716be=['isActive','processing','Short\x20Link:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','noda','HTTP\x20error!\x20status:\x20','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','apiUrl','HTTP\x20','timeout','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','===\x20PARSED\x20NODA\x20RESPONSE\x20===','canceled','defineProperty','Status\x20Code:','expired','shortLink','Order\x20ID\x20Used:','2912850kCLRxK','created','Error\x20stack:',',\x20body:\x20','statusCode','in_progress','317wZrsWK','2866mvUUOn','Parsed\x20Result:','processWebhook','===\x20NODA\x20SERVICE\x20ERROR\x20===','../loggerService','json','logWhiteDomainResponse','HTTP\x20Status:','FAILED','Amount','7VOYpWr','Noda\x20API\x20error:\x20','SettlementDate','Unknown\x20error','shortLinkUrls','headers','MerchantPaymentId','ðŸŒ\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20details:','text','BankId','statusText','Order\x20ID\x20Format:','Status:','POST','application/json','expiryDate','createPaymentLink','294042nDWsea','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','toUpperCase','verifyPayment','Noda\x20payment\x20verification\x20error:','Missing\x20id\x20or\x20shortLink\x20in\x20response','Error\x20message:','Settled','stringify','error','completed','Business\x20Error:\x20','logWhiteDomainError','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','entries','Remitter','currency','Response\x20data:','12RntPrE','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainRequest','GET','status','active','toLowerCase','loggerService','660bWTXaw','Request\x20Body\x20(Direct\x20JSON):','4045422XGnpay','Response\x20Body:','cancelled','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Error\x20Message:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','PENDING','message','/payment-links','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','done','__esModule','1634808JXKcDX','TesSoft\x20Payment\x20System/1.0','116770AdiXPL','NodaService','Raw\x20Response\x20Body:','Status\x20Text:','EXPIRED','success','log','/payment-links/','now','Failed\x20to\x20parse\x20JSON\x20response:','Method','Status','BankTransactionId','Yes','pending','Payment\x20Link\x20ID:','URL:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','PaymentId','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Name','Not\x20provided','Processing\x20Noda\x20webhook:','1470505dQePSM'];a40_0x58a8=function(){return _0xe716be;};return a40_0x58a8();}exports['NodaService']=NodaService;