'use strict';const a48_0x571b4c=a48_0x5835;(function(_0x2701b9,_0x449f77){const _0x289377=a48_0x5835,_0x479f9b=_0x2701b9();while(!![]){try{const _0x5db065=-parseInt(_0x289377(0x1e4))/0x1+parseInt(_0x289377(0x19a))/0x2*(-parseInt(_0x289377(0x1e5))/0x3)+-parseInt(_0x289377(0x19c))/0x4*(parseInt(_0x289377(0x188))/0x5)+parseInt(_0x289377(0x18c))/0x6*(parseInt(_0x289377(0x1db))/0x7)+parseInt(_0x289377(0x1a9))/0x8+parseInt(_0x289377(0x1ce))/0x9*(parseInt(_0x289377(0x1c4))/0xa)+-parseInt(_0x289377(0x1af))/0xb;if(_0x5db065===_0x449f77)break;else _0x479f9b['push'](_0x479f9b['shift']());}catch(_0x1af43a){_0x479f9b['push'](_0x479f9b['shift']());}}}(a48_0x54fa,0x860b6));function a48_0x5835(_0x5f2e00,_0x5ca248){const _0x54fa8e=a48_0x54fa();return a48_0x5835=function(_0x58355b,_0x472c51){_0x58355b=_0x58355b-0x183;let _0x2b9096=_0x54fa8e[_0x58355b];return _0x2b9096;},a48_0x5835(_0x5f2e00,_0x5ca248);}function a48_0x54fa(){const _0x6b0e6f=['Currency','successful','expired','150dvHpNY','/payment-links','JSON\x20Parse\x20Error:\x20','Noda\x20payment\x20verification\x20error:','logWhiteDomainResponse','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','BankTransactionId','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Status\x20Code:','shortLinkUrls','334548yOZoMt','Response\x20Body:','https://tesoft.uk/gateway/noda/webhook/','application/json','in_progress','BankId','TesSoft\x20Payment\x20System/1.0','HTTP\x20Status:','PaymentId','EXPIRED','paid','Amount','QR\x20Code\x20Link:','203eGCuNk','https://tesoft.uk/gateway/noda/','processing','GET','(8digits-8digits\x20format)','defineProperty','canceled','Business\x20Error:\x20','Method','1507haDTkH','4926AyrhWV','Processing\x20Noda\x20webhook:','currency','loggerService','verifyPayment','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','(8digits-8digits\x20format\x20for\x20Noda)','Status','Status\x20Text:','https://tesoft.uk/gateway/pending.php?id=','success','PENDING','apiUrl','MerchantPaymentId','Noda\x20webhook\x20signature\x20verification:','Order\x20ID\x20Format:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','json','Remitter','active','done','Yes','pending','expiryDate','noda','===\x20NODA\x20SUCCESS\x20===','now','completed','FAILED','amount','../loggerService','timeout','entries','error','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','1211665tPKRPs','NodaService','Missing\x20id\x20or\x20shortLink\x20in\x20response','toLowerCase','161004qMhGYw','Noda\x20API\x20error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Status:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','POST',',\x20body:\x20','qrCodeLink','created','Error\x20Message:','stringify','Request\x20Body\x20(Direct\x20JSON):','status','674ecdvAt','Order\x20ID\x20Used:','8zsvcyN','statusCode','/payment-links/','isActive','text','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Error\x20message:','Parsed\x20Result:','===\x20NODA\x20API\x20ERROR\x20===','Payment\x20Link\x20ID:','Short\x20Link:','message','cancelled','4508816jsSyjz','logWhiteDomainError','fromEntries','processWebhook','statusText','Iban','3418745TgOOVi','log','__esModule','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','HTTP\x20error!\x20status:\x20','failed','toUpperCase','shortLink','Error\x20stack:','URL:','stack','Unknown\x20error','PAID','createPaymentLink','Settled','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','logWhiteDomainRequest','Name'];a48_0x54fa=function(){return _0x6b0e6f;};return a48_0x54fa();}Object[a48_0x571b4c(0x1e0)](exports,a48_0x571b4c(0x1b1),{'value':!![]}),exports[a48_0x571b4c(0x189)]=void 0x0;const loggerService_1=require(a48_0x571b4c(0x183));class NodaService{constructor(){const _0x3596c6=a48_0x571b4c;this[_0x3596c6(0x1f1)]=_0x3596c6(0x1dc),console[_0x3596c6(0x1b0)](_0x3596c6(0x191));}async[a48_0x571b4c(0x1bc)](_0x2d4058){const _0x203a31=a48_0x571b4c,{orderId:_0x7854a0,name:_0x3eff65,paymentDescription:_0x137106,amount:_0x257181,currency:_0x1dbf35,webhookUrl:_0x33ddde,returnUrl:_0x3a9d48,expiryDate:_0x5ef086}=_0x2d4058,_0x5e54a0=_0x1dbf35[_0x203a31(0x1b5)](),_0x14eb0e=_0x203a31(0x1d0),_0x3d580b=_0x203a31(0x1ee)+_0x7854a0,_0x12eeac={'name':_0x3eff65,'paymentDescription':_0x137106,'amount':_0x257181,'currency':_0x5e54a0,'paymentId':_0x7854a0,'webhookUrl':_0x14eb0e,'returnUrl':_0x3d580b};_0x5ef086&&(_0x12eeac[_0x203a31(0x1fd)]=_0x5ef086);const _0xb335c5=Date[_0x203a31(0x200)]();try{console['log'](_0x203a31(0x1b2)),console[_0x203a31(0x1b0)](_0x203a31(0x1b8),this[_0x203a31(0x1f1)]),console[_0x203a31(0x1b0)](_0x203a31(0x198),JSON['stringify'](_0x12eeac,null,0x2)),console[_0x203a31(0x1b0)](_0x203a31(0x1f4),_0x7854a0,_0x203a31(0x1eb)),console[_0x203a31(0x1b0)](_0x203a31(0x1c9),_0x3d580b),loggerService_1['loggerService'][_0x203a31(0x1bf)](_0x203a31(0x1fe),_0x203a31(0x1c5),_0x203a31(0x192),_0x12eeac);const _0x61afee=await fetch(this['apiUrl'],{'method':_0x203a31(0x192),'headers':{'Content-Type':_0x203a31(0x1d1),'Accept':_0x203a31(0x1d1),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x203a31(0x197)](_0x12eeac)}),_0x3ab3c5=Date[_0x203a31(0x200)]()-_0xb335c5;console[_0x203a31(0x1b0)](_0x203a31(0x187)),console[_0x203a31(0x1b0)](_0x203a31(0x190),_0x61afee[_0x203a31(0x199)]),console[_0x203a31(0x1b0)](_0x203a31(0x1ed),_0x61afee[_0x203a31(0x1ad)]),console['log']('Headers:',Object[_0x203a31(0x1ab)](_0x61afee['headers'][_0x203a31(0x185)]())),console['log']('Response\x20Time:',_0x3ab3c5+'ms');const _0x3e15b0=await _0x61afee[_0x203a31(0x1a0)]();console[_0x203a31(0x1b0)]('Raw\x20Response\x20Body:',_0x3e15b0);if(!_0x61afee['ok']){console[_0x203a31(0x186)](_0x203a31(0x1a4)),console[_0x203a31(0x186)](_0x203a31(0x1d5),_0x61afee[_0x203a31(0x199)]),console[_0x203a31(0x186)](_0x203a31(0x1cf),_0x3e15b0),loggerService_1[_0x203a31(0x1e8)][_0x203a31(0x1c8)]('noda',_0x203a31(0x1c5),_0x61afee[_0x203a31(0x199)],_0x3e15b0,_0x3ab3c5),loggerService_1[_0x203a31(0x1e8)][_0x203a31(0x1aa)]('noda',_0x203a31(0x1c5),'HTTP\x20'+_0x61afee[_0x203a31(0x199)]+':\x20'+_0x3e15b0);if(_0x61afee[_0x203a31(0x199)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x61afee[_0x203a31(0x199)]===0x1f4)throw new Error(_0x203a31(0x1be));}throw new Error(_0x203a31(0x1b3)+_0x61afee[_0x203a31(0x199)]+_0x203a31(0x193)+_0x3e15b0);}let _0x4dc6f3;try{_0x4dc6f3=JSON['parse'](_0x3e15b0);}catch(_0x4504fa){console[_0x203a31(0x186)](_0x203a31(0x18e),_0x4504fa),loggerService_1['loggerService'][_0x203a31(0x1aa)]('noda',_0x203a31(0x1c5),_0x203a31(0x1c6)+_0x4504fa);throw new Error(_0x203a31(0x18f)+_0x3e15b0);}console[_0x203a31(0x1b0)](_0x203a31(0x1f5)),console['log'](_0x203a31(0x1a3),JSON[_0x203a31(0x197)](_0x4dc6f3,null,0x2)),loggerService_1[_0x203a31(0x1e8)][_0x203a31(0x1c8)](_0x203a31(0x1fe),_0x203a31(0x1c5),_0x61afee['status'],_0x4dc6f3,_0x3ab3c5);if(_0x4dc6f3[_0x203a31(0x186)]||_0x4dc6f3[_0x203a31(0x19d)]){const _0x879d18=_0x4dc6f3['message']||_0x4dc6f3[_0x203a31(0x186)]||'Unknown\x20error\x20from\x20Noda\x20API';console['error'](_0x203a31(0x1ea)),console[_0x203a31(0x186)](_0x203a31(0x196),_0x879d18),console[_0x203a31(0x186)](_0x203a31(0x1cc),_0x4dc6f3[_0x203a31(0x19d)]),loggerService_1[_0x203a31(0x1e8)][_0x203a31(0x1aa)](_0x203a31(0x1fe),_0x203a31(0x1c5),_0x203a31(0x1e2)+_0x879d18);throw new Error(_0x203a31(0x18d)+_0x879d18);}if(!_0x4dc6f3['id']||!_0x4dc6f3[_0x203a31(0x1cd)]?.[_0x203a31(0x1b6)]){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x203a31(0x186)](_0x203a31(0x18a)),console[_0x203a31(0x186)]('Response\x20data:',_0x4dc6f3),loggerService_1['loggerService'][_0x203a31(0x1aa)]('noda',_0x203a31(0x1c5),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x203a31(0x1cb));}return console[_0x203a31(0x1b0)](_0x203a31(0x1ff)),console[_0x203a31(0x1b0)](_0x203a31(0x1a5),_0x4dc6f3['id']),console[_0x203a31(0x1b0)](_0x203a31(0x1a6),_0x4dc6f3[_0x203a31(0x1cd)][_0x203a31(0x1b6)]),console[_0x203a31(0x1b0)](_0x203a31(0x1da),_0x4dc6f3[_0x203a31(0x1cd)][_0x203a31(0x194)]||'Not\x20provided'),console['log'](_0x203a31(0x19b),_0x7854a0,_0x203a31(0x1df)),console[_0x203a31(0x1b0)](_0x203a31(0x1f6),_0x3d580b),{'gateway_payment_id':_0x4dc6f3['id'],'payment_url':_0x4dc6f3[_0x203a31(0x1cd)][_0x203a31(0x1b6)],'qr_code_url':_0x4dc6f3[_0x203a31(0x1cd)][_0x203a31(0x194)],'expiry_date':_0x4dc6f3['expiryDate']};}catch(_0x3834a2){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x203a31(0x186)]('Error\x20details:',_0x3834a2),loggerService_1[_0x203a31(0x1e8)]['logWhiteDomainError'](_0x203a31(0x1fe),_0x203a31(0x1c5),_0x3834a2);if(_0x3834a2 instanceof Error){console['error'](_0x203a31(0x1a2),_0x3834a2['message']),console[_0x203a31(0x186)](_0x203a31(0x1b7),_0x3834a2[_0x203a31(0x1b9)]);throw new Error(_0x203a31(0x1a1)+_0x3834a2[_0x203a31(0x1a7)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a48_0x571b4c(0x1e9)](_0x30e6a8){const _0x44ad2f=a48_0x571b4c,_0x1fca70=Date[_0x44ad2f(0x200)]();try{loggerService_1[_0x44ad2f(0x1e8)]['logWhiteDomainRequest']('noda',_0x44ad2f(0x19e)+_0x30e6a8,_0x44ad2f(0x1de),{});const _0x6e12f1=await fetch(this[_0x44ad2f(0x1f1)]+'/'+_0x30e6a8,{'method':_0x44ad2f(0x1de),'headers':{'Content-Type':_0x44ad2f(0x1d1),'User-Agent':_0x44ad2f(0x1d4)}}),_0x4f649b=Date[_0x44ad2f(0x200)]()-_0x1fca70;if(!_0x6e12f1['ok']){const _0x529b28=await _0x6e12f1[_0x44ad2f(0x1a0)]();loggerService_1['loggerService'][_0x44ad2f(0x1c8)]('noda',_0x44ad2f(0x19e)+_0x30e6a8,_0x6e12f1[_0x44ad2f(0x199)],_0x529b28,_0x4f649b);throw new Error(_0x44ad2f(0x1b3)+_0x6e12f1[_0x44ad2f(0x199)]);}const _0x285000=await _0x6e12f1[_0x44ad2f(0x1f7)]();loggerService_1[_0x44ad2f(0x1e8)][_0x44ad2f(0x1c8)]('noda',_0x44ad2f(0x19e)+_0x30e6a8,_0x6e12f1[_0x44ad2f(0x199)],_0x285000,_0x4f649b);if(_0x285000[_0x44ad2f(0x186)]||_0x285000[_0x44ad2f(0x19d)]){loggerService_1[_0x44ad2f(0x1e8)][_0x44ad2f(0x1aa)]('noda',_0x44ad2f(0x19e)+_0x30e6a8,'Noda\x20API\x20error:\x20'+(_0x285000[_0x44ad2f(0x1a7)]||_0x285000[_0x44ad2f(0x186)]||_0x44ad2f(0x1ba)));throw new Error(_0x44ad2f(0x18d)+(_0x285000[_0x44ad2f(0x1a7)]||_0x285000['error']||_0x44ad2f(0x1ba)));}let _0x5e42a9=_0x44ad2f(0x1f0);if(_0x285000[_0x44ad2f(0x19f)]===![]){if(_0x285000['expiryDate']){const _0x3dfa6d=new Date(_0x285000[_0x44ad2f(0x1fd)]),_0x4d28e3=new Date();_0x3dfa6d<_0x4d28e3?_0x5e42a9=_0x44ad2f(0x1d7):_0x5e42a9=_0x44ad2f(0x202);}else _0x5e42a9=_0x44ad2f(0x202);}else _0x5e42a9=_0x44ad2f(0x1f0);return{'status':_0x5e42a9,'amount':_0x285000[_0x44ad2f(0x203)],'currency':_0x285000[_0x44ad2f(0x1e7)],'isActive':_0x285000[_0x44ad2f(0x19f)]};}catch(_0xb19088){console[_0x44ad2f(0x186)](_0x44ad2f(0x1c7),_0xb19088),loggerService_1[_0x44ad2f(0x1e8)][_0x44ad2f(0x1aa)](_0x44ad2f(0x1fe),_0x44ad2f(0x19e)+_0x30e6a8,_0xb19088);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0xb19088 instanceof Error?_0xb19088[_0x44ad2f(0x1a7)]:'Unknown\x20error'));}}async[a48_0x571b4c(0x1ac)](_0x35cefd){const _0x523ecd=a48_0x571b4c;console[_0x523ecd(0x1b0)](_0x523ecd(0x1e6),_0x35cefd);let _0x3502fd=_0x523ecd(0x1f0);switch(_0x35cefd[_0x523ecd(0x1ec)]?.[_0x523ecd(0x18b)]()){case _0x523ecd(0x1fa):case _0x523ecd(0x201):case _0x523ecd(0x1d8):case _0x523ecd(0x1ef):case _0x523ecd(0x1c2):_0x35cefd['Settled']===_0x523ecd(0x1fb)?_0x3502fd=_0x523ecd(0x1bb):_0x3502fd=_0x523ecd(0x1f0);break;case _0x523ecd(0x1a8):case _0x523ecd(0x1e1):case _0x523ecd(0x1b4):case _0x523ecd(0x186):case'rejected':_0x3502fd=_0x523ecd(0x202);break;case _0x523ecd(0x1c3):case _0x523ecd(0x184):_0x3502fd=_0x523ecd(0x1d7);break;case _0x523ecd(0x1fc):case _0x523ecd(0x195):case _0x523ecd(0x1f9):case _0x523ecd(0x1dd):case _0x523ecd(0x1d2):default:_0x3502fd='PENDING';break;}return{'paymentId':_0x35cefd['MerchantPaymentId']||_0x35cefd[_0x523ecd(0x1d6)],'status':_0x3502fd,'amount':_0x35cefd[_0x523ecd(0x1d9)],'currency':_0x35cefd[_0x523ecd(0x1c1)],'additionalInfo':{'method':_0x35cefd[_0x523ecd(0x1e3)],'bankId':_0x35cefd[_0x523ecd(0x1d3)],'settled':_0x35cefd[_0x523ecd(0x1bd)],'settlementDate':_0x35cefd['SettlementDate'],'remitterName':_0x35cefd[_0x523ecd(0x1f8)]?.[_0x523ecd(0x1c0)],'remitterIban':_0x35cefd[_0x523ecd(0x1f8)]?.[_0x523ecd(0x1ae)],'bankTransactionId':_0x35cefd[_0x523ecd(0x1ca)]}};}['verifyWebhookSignature'](_0x4ad833,_0x3de1f6){const _0x59c857=a48_0x571b4c;return console[_0x59c857(0x1b0)](_0x59c857(0x1f3),{'receivedSignature':_0x3de1f6,'paymentId':_0x4ad833[_0x59c857(0x1d6)],'merchantPaymentId':_0x4ad833[_0x59c857(0x1f2)]}),!![];}}exports[a48_0x571b4c(0x189)]=NodaService;