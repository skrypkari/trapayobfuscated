'use strict';function a39_0x4ff7(){const _0x2c6f9d=['===\x20PARSED\x20NODA\x20RESPONSE\x20===','apiUrl','POST','1976xKOyAK','6209lPetNO','SettlementDate','logWhiteDomainResponse','HTTP\x20','noda','loggerService','Response\x20data:','Failed\x20to\x20parse\x20JSON\x20response:','557422EAxsBW','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','logWhiteDomainRequest','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','defineProperty','EXPIRED','Noda\x20API\x20error:\x20','created','parse','application/json','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','shortLink','expired','GET','cancelled','statusText','https://tesoft.uk/gateway/success.php?id=','Response\x20Time:','HTTP\x20Status:','Status:','../loggerService','timeout','NodaService','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','FAILED','PaymentId','statusCode','Yes','text','status','fromEntries','Raw\x20Response\x20Body:','===\x20NODA\x20SUCCESS\x20===','done','===\x20NODA\x20SERVICE\x20ERROR\x20===','now','/payment-links/','paid','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','headers','toLowerCase','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Noda\x20webhook\x20signature\x20verification:','createPaymentLink','canceled','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Error\x20message:','failed','shortLinkUrls','Status\x20Text:','pending','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','PENDING','BankTransactionId','completed','Short\x20Link:','URL:','197736tTAfLu','isActive','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Headers:','message','JSON\x20Parse\x20Error:\x20','stringify','https://tesoft.uk/gateway/noda/webhook/','Currency','2290030CkLtxk','69PXifLO','Error\x20Message:','expiryDate','(8digits-8digits\x20format)','Payment\x20Link\x20ID:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','qrCodeLink','Method','MerchantPaymentId','Settled','processing','Error\x20details:','Business\x20Error:\x20','PAID','processWebhook','1021235Kgqgfv','in_progress','BankId','Missing\x20id\x20or\x20shortLink\x20in\x20response','amount','(8digits-8digits\x20format\x20for\x20Noda)','/payment-links','successful','Not\x20provided','log','Response\x20Body:','Name','7987308Qrsgum','rejected','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','logWhiteDomainError','Unknown\x20error','verifyPayment',',\x20body:\x20','HTTP\x20error!\x20status:\x20','TesSoft\x20Payment\x20System/1.0','Order\x20ID\x20Used:','error','468UDRQrf','===\x20NODA\x20API\x20ERROR\x20===','Status','currency','entries','330240Fzfqjw'];a39_0x4ff7=function(){return _0x2c6f9d;};return a39_0x4ff7();}function a39_0x56f9(_0x624c6f,_0xb57fd0){const _0x4ff772=a39_0x4ff7();return a39_0x56f9=function(_0x56f920,_0x4a4f74){_0x56f920=_0x56f920-0x15c;let _0x2fff30=_0x4ff772[_0x56f920];return _0x2fff30;},a39_0x56f9(_0x624c6f,_0xb57fd0);}const a39_0x96808a=a39_0x56f9;(function(_0x149b05,_0x1b41ff){const _0x123de1=a39_0x56f9,_0x5190b9=_0x149b05();while(!![]){try{const _0x51b332=parseInt(_0x123de1(0x1be))/0x1+-parseInt(_0x123de1(0x16c))/0x2+parseInt(_0x123de1(0x1af))/0x3*(-parseInt(_0x123de1(0x1a5))/0x4)+parseInt(_0x123de1(0x1ae))/0x5+-parseInt(_0x123de1(0x1ca))/0x6+-parseInt(_0x123de1(0x164))/0x7*(-parseInt(_0x123de1(0x163))/0x8)+-parseInt(_0x123de1(0x1d5))/0x9*(-parseInt(_0x123de1(0x15f))/0xa);if(_0x51b332===_0x1b41ff)break;else _0x5190b9['push'](_0x5190b9['shift']());}catch(_0x5d8427){_0x5190b9['push'](_0x5190b9['shift']());}}}(a39_0x4ff7,0xa33fb));Object[a39_0x96808a(0x170)](exports,'__esModule',{'value':!![]}),exports[a39_0x96808a(0x182)]=void 0x0;const loggerService_1=require(a39_0x96808a(0x180));class NodaService{constructor(){const _0x8e4844=a39_0x96808a;this[_0x8e4844(0x161)]='https://tesoft.uk/gateway/noda/',console[_0x8e4844(0x1c7)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a39_0x96808a(0x197)](_0x393923){const _0x53e25c=a39_0x96808a,{orderId:_0x4dc24f,name:_0x3bfcb3,paymentDescription:_0x5645d3,amount:_0x556f33,currency:_0x2d2627,webhookUrl:_0x68c8fb,returnUrl:_0x39b683,expiryDate:_0x3159d0}=_0x393923,_0x6fdf48=_0x2d2627['toUpperCase'](),_0x32c81b=_0x53e25c(0x1ac),_0x9e3a5b=_0x53e25c(0x17c)+_0x4dc24f,_0x5c8482={'name':_0x3bfcb3,'paymentDescription':_0x5645d3,'amount':_0x556f33,'currency':_0x6fdf48,'paymentId':_0x4dc24f,'webhookUrl':_0x32c81b,'returnUrl':_0x9e3a5b};_0x3159d0&&(_0x5c8482[_0x53e25c(0x1b1)]=_0x3159d0);const _0x1d2690=Date['now']();try{console[_0x53e25c(0x1c7)](_0x53e25c(0x1b4)),console[_0x53e25c(0x1c7)](_0x53e25c(0x1a4),this[_0x53e25c(0x161)]),console[_0x53e25c(0x1c7)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x53e25c(0x1ab)](_0x5c8482,null,0x2)),console[_0x53e25c(0x1c7)]('Order\x20ID\x20Format:',_0x4dc24f,_0x53e25c(0x1c3)),loggerService_1['loggerService'][_0x53e25c(0x16e)]('noda',_0x53e25c(0x1c4),_0x53e25c(0x162),_0x5c8482);const _0x4df3c9=await fetch(this[_0x53e25c(0x161)],{'method':_0x53e25c(0x162),'headers':{'Content-Type':_0x53e25c(0x175),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x53e25c(0x1ab)](_0x5c8482)}),_0x502097=Date['now']()-_0x1d2690;console[_0x53e25c(0x1c7)](_0x53e25c(0x183)),console[_0x53e25c(0x1c7)](_0x53e25c(0x17f),_0x4df3c9[_0x53e25c(0x189)]),console[_0x53e25c(0x1c7)](_0x53e25c(0x19d),_0x4df3c9[_0x53e25c(0x17b)]),console[_0x53e25c(0x1c7)](_0x53e25c(0x1a8),Object[_0x53e25c(0x18a)](_0x4df3c9[_0x53e25c(0x193)][_0x53e25c(0x15e)]())),console[_0x53e25c(0x1c7)](_0x53e25c(0x17d),_0x502097+'ms');const _0x1dbad3=await _0x4df3c9[_0x53e25c(0x188)]();console[_0x53e25c(0x1c7)](_0x53e25c(0x18b),_0x1dbad3);if(!_0x4df3c9['ok']){console[_0x53e25c(0x1d4)](_0x53e25c(0x1d6)),console[_0x53e25c(0x1d4)](_0x53e25c(0x17e),_0x4df3c9[_0x53e25c(0x189)]),console['error'](_0x53e25c(0x1c8),_0x1dbad3),loggerService_1[_0x53e25c(0x169)][_0x53e25c(0x166)](_0x53e25c(0x168),'/payment-links',_0x4df3c9['status'],_0x1dbad3,_0x502097),loggerService_1['loggerService'][_0x53e25c(0x1cd)](_0x53e25c(0x168),_0x53e25c(0x1c4),_0x53e25c(0x167)+_0x4df3c9[_0x53e25c(0x189)]+':\x20'+_0x1dbad3);if(_0x4df3c9[_0x53e25c(0x189)]===0x190)throw new Error(_0x53e25c(0x1cc));else{if(_0x4df3c9['status']===0x1f4)throw new Error(_0x53e25c(0x195));}throw new Error(_0x53e25c(0x1d1)+_0x4df3c9[_0x53e25c(0x189)]+_0x53e25c(0x1d0)+_0x1dbad3);}let _0x3b356b;try{_0x3b356b=JSON[_0x53e25c(0x174)](_0x1dbad3);}catch(_0x40161d){console[_0x53e25c(0x1d4)](_0x53e25c(0x16b),_0x40161d),loggerService_1['loggerService'][_0x53e25c(0x1cd)]('noda',_0x53e25c(0x1c4),_0x53e25c(0x1aa)+_0x40161d);throw new Error(_0x53e25c(0x16d)+_0x1dbad3);}console[_0x53e25c(0x1c7)](_0x53e25c(0x160)),console[_0x53e25c(0x1c7)]('Parsed\x20Result:',JSON['stringify'](_0x3b356b,null,0x2)),loggerService_1[_0x53e25c(0x169)][_0x53e25c(0x166)]('noda',_0x53e25c(0x1c4),_0x4df3c9['status'],_0x3b356b,_0x502097);if(_0x3b356b[_0x53e25c(0x1d4)]||_0x3b356b[_0x53e25c(0x186)]){const _0xcc6947=_0x3b356b['message']||_0x3b356b[_0x53e25c(0x1d4)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x53e25c(0x1d4)](_0x53e25c(0x176)),console[_0x53e25c(0x1d4)](_0x53e25c(0x1b0),_0xcc6947),console[_0x53e25c(0x1d4)]('Status\x20Code:',_0x3b356b[_0x53e25c(0x186)]),loggerService_1[_0x53e25c(0x169)]['logWhiteDomainError']('noda',_0x53e25c(0x1c4),_0x53e25c(0x1bb)+_0xcc6947);throw new Error('Noda\x20API\x20error:\x20'+_0xcc6947);}if(!_0x3b356b['id']||!_0x3b356b[_0x53e25c(0x19c)]?.[_0x53e25c(0x177)]){console[_0x53e25c(0x1d4)](_0x53e25c(0x192)),console[_0x53e25c(0x1d4)](_0x53e25c(0x1c1)),console[_0x53e25c(0x1d4)](_0x53e25c(0x16a),_0x3b356b),loggerService_1[_0x53e25c(0x169)][_0x53e25c(0x1cd)]('noda',_0x53e25c(0x1c4),_0x53e25c(0x19f));throw new Error(_0x53e25c(0x1a7));}return console[_0x53e25c(0x1c7)](_0x53e25c(0x18c)),console[_0x53e25c(0x1c7)](_0x53e25c(0x1b3),_0x3b356b['id']),console[_0x53e25c(0x1c7)](_0x53e25c(0x1a3),_0x3b356b[_0x53e25c(0x19c)][_0x53e25c(0x177)]),console[_0x53e25c(0x1c7)]('QR\x20Code\x20Link:',_0x3b356b[_0x53e25c(0x19c)]['qrCodeLink']||_0x53e25c(0x1c6)),console[_0x53e25c(0x1c7)](_0x53e25c(0x1d3),_0x4dc24f,_0x53e25c(0x1b2)),{'gateway_payment_id':_0x3b356b['id'],'payment_url':_0x3b356b[_0x53e25c(0x19c)][_0x53e25c(0x177)],'qr_code_url':_0x3b356b[_0x53e25c(0x19c)][_0x53e25c(0x1b5)],'expiry_date':_0x3b356b[_0x53e25c(0x1b1)]};}catch(_0x3bcc24){console['error'](_0x53e25c(0x18e)),console['error'](_0x53e25c(0x1ba),_0x3bcc24),loggerService_1[_0x53e25c(0x169)]['logWhiteDomainError']('noda','/payment-links',_0x3bcc24);if(_0x3bcc24 instanceof Error){console[_0x53e25c(0x1d4)](_0x53e25c(0x19a),_0x3bcc24[_0x53e25c(0x1a9)]),console['error']('Error\x20stack:',_0x3bcc24['stack']);throw new Error(_0x53e25c(0x16f)+_0x3bcc24[_0x53e25c(0x1a9)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a39_0x96808a(0x1cf)](_0xda415a){const _0x13787d=a39_0x96808a,_0x384824=Date[_0x13787d(0x18f)]();try{loggerService_1[_0x13787d(0x169)][_0x13787d(0x16e)](_0x13787d(0x168),_0x13787d(0x190)+_0xda415a,_0x13787d(0x179),{});const _0x28bedd=await fetch(this[_0x13787d(0x161)]+'/'+_0xda415a,{'method':_0x13787d(0x179),'headers':{'Content-Type':'application/json','User-Agent':_0x13787d(0x1d2)}}),_0x5cc81b=Date[_0x13787d(0x18f)]()-_0x384824;if(!_0x28bedd['ok']){const _0x2f0cf7=await _0x28bedd[_0x13787d(0x188)]();loggerService_1[_0x13787d(0x169)]['logWhiteDomainResponse'](_0x13787d(0x168),_0x13787d(0x190)+_0xda415a,_0x28bedd['status'],_0x2f0cf7,_0x5cc81b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x28bedd[_0x13787d(0x189)]);}const _0xa89d79=await _0x28bedd['json']();loggerService_1[_0x13787d(0x169)][_0x13787d(0x166)](_0x13787d(0x168),_0x13787d(0x190)+_0xda415a,_0x28bedd[_0x13787d(0x189)],_0xa89d79,_0x5cc81b);if(_0xa89d79[_0x13787d(0x1d4)]||_0xa89d79[_0x13787d(0x186)]){loggerService_1[_0x13787d(0x169)][_0x13787d(0x1cd)](_0x13787d(0x168),_0x13787d(0x190)+_0xda415a,_0x13787d(0x172)+(_0xa89d79[_0x13787d(0x1a9)]||_0xa89d79[_0x13787d(0x1d4)]||_0x13787d(0x1ce)));throw new Error(_0x13787d(0x172)+(_0xa89d79[_0x13787d(0x1a9)]||_0xa89d79['error']||_0x13787d(0x1ce)));}let _0x19817a='PENDING';if(_0xa89d79[_0x13787d(0x1a6)]===![]){if(_0xa89d79['expiryDate']){const _0x83f16b=new Date(_0xa89d79[_0x13787d(0x1b1)]),_0x1c02d5=new Date();_0x83f16b<_0x1c02d5?_0x19817a=_0x13787d(0x171):_0x19817a=_0x13787d(0x184);}else _0x19817a=_0x13787d(0x184);}else _0x19817a=_0x13787d(0x1a0);return{'status':_0x19817a,'amount':_0xa89d79[_0x13787d(0x1c2)],'currency':_0xa89d79[_0x13787d(0x15d)],'isActive':_0xa89d79[_0x13787d(0x1a6)]};}catch(_0x9f63a9){console[_0x13787d(0x1d4)]('Noda\x20payment\x20verification\x20error:',_0x9f63a9),loggerService_1[_0x13787d(0x169)][_0x13787d(0x1cd)]('noda',_0x13787d(0x190)+_0xda415a,_0x9f63a9);throw new Error(_0x13787d(0x199)+(_0x9f63a9 instanceof Error?_0x9f63a9['message']:_0x13787d(0x1ce)));}}async[a39_0x96808a(0x1bd)](_0x472141){const _0x50147b=a39_0x96808a;console[_0x50147b(0x1c7)]('Processing\x20Noda\x20webhook:',_0x472141);let _0x25a0a4=_0x50147b(0x1a0);switch(_0x472141[_0x50147b(0x15c)]?.[_0x50147b(0x194)]()){case _0x50147b(0x18d):case _0x50147b(0x1a2):case _0x50147b(0x191):case'success':case _0x50147b(0x1c5):_0x472141[_0x50147b(0x1b8)]===_0x50147b(0x187)?_0x25a0a4=_0x50147b(0x1bc):_0x25a0a4=_0x50147b(0x1a0);break;case _0x50147b(0x17a):case _0x50147b(0x198):case _0x50147b(0x19b):case _0x50147b(0x1d4):case _0x50147b(0x1cb):_0x25a0a4=_0x50147b(0x184);break;case _0x50147b(0x178):case _0x50147b(0x181):_0x25a0a4=_0x50147b(0x171);break;case _0x50147b(0x19e):case _0x50147b(0x173):case'active':case _0x50147b(0x1b9):case _0x50147b(0x1bf):default:_0x25a0a4=_0x50147b(0x1a0);break;}return{'paymentId':_0x472141[_0x50147b(0x1b7)]||_0x472141['PaymentId'],'status':_0x25a0a4,'amount':_0x472141['Amount'],'currency':_0x472141[_0x50147b(0x1ad)],'additionalInfo':{'method':_0x472141[_0x50147b(0x1b6)],'bankId':_0x472141[_0x50147b(0x1c0)],'settled':_0x472141['Settled'],'settlementDate':_0x472141[_0x50147b(0x165)],'remitterName':_0x472141['Remitter']?.[_0x50147b(0x1c9)],'remitterIban':_0x472141['Remitter']?.['Iban'],'bankTransactionId':_0x472141[_0x50147b(0x1a1)]}};}['verifyWebhookSignature'](_0x4bfa81,_0x13ce12){const _0xda71d0=a39_0x96808a;return console[_0xda71d0(0x1c7)](_0xda71d0(0x196),{'receivedSignature':_0x13ce12,'paymentId':_0x4bfa81[_0xda71d0(0x185)],'merchantPaymentId':_0x4bfa81[_0xda71d0(0x1b7)]}),!![];}}exports[a39_0x96808a(0x182)]=NodaService;