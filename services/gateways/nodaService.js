'use strict';const a46_0x3241fd=a46_0x2688;function a46_0x4291(){const _0x2530d0=['message','===\x20NODA\x20SUCCESS\x20===','Business\x20Error:\x20','Yes','Response\x20data:','54753tDwckl','defineProperty','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','createPaymentLink','currency','63324DasiLR','application/json','failed','Unknown\x20error','Headers:','verifyWebhookSignature','processing','expired','processWebhook','Noda\x20API\x20error:\x20','headers','36DUiXXh','apiUrl','(8digits-8digits\x20format\x20for\x20Noda)','https://tesoft.uk/gateway/noda/','Error\x20stack:','parse','260YAhjkQ','entries','HTTP\x20','stringify','log','toLowerCase','PaymentId','isActive','statusCode','https://tesoft.uk/gateway/pending.php?id=','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Remitter','===\x20NODA\x20SERVICE\x20ERROR\x20===','Missing\x20id\x20or\x20shortLink\x20in\x20response','noda','loggerService','58399WEgJLz','Status','1043586gsFzTK','shortLink','text','shortLinkUrls','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Unknown\x20error\x20from\x20Noda\x20API','HTTP\x20Status:','1066giDdAd','json','paid','PAID','TesSoft\x20Payment\x20System/1.0','logWhiteDomainRequest','SettlementDate','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','JSON\x20Parse\x20Error:\x20','status','Raw\x20Response\x20Body:','error','Amount','32ETiEHE','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Processing\x20Noda\x20webhook:','Short\x20Link:','expiryDate','Error\x20Message:','/payment-links/','statusText','timeout','logWhiteDomainResponse','339354tWUnTv','Parsed\x20Result:','FAILED','active','1522YkgGRw','48PSMlNP','Status\x20Text:','PENDING','Error\x20details:','Response\x20Body:','logWhiteDomainError','now','URL:','verifyPayment','cancelled','629790jioHCr','pending','GET','Settled','/payment-links','BankId','Not\x20provided','NodaService','qrCodeLink','__esModule','https://tesoft.uk/gateway/noda/webhook/','HTTP\x20error!\x20status:\x20','Error\x20message:','Noda\x20payment\x20verification\x20error:','EXPIRED','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','QR\x20Code\x20Link:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','POST','success','MerchantPaymentId','7ZslsmV','Name'];a46_0x4291=function(){return _0x2530d0;};return a46_0x4291();}(function(_0x39f389,_0x3b8e7f){const _0x5ee745=a46_0x2688,_0x2d5e98=_0x39f389();while(!![]){try{const _0x2a6580=parseInt(_0x5ee745(0xb5))/0x1*(parseInt(_0x5ee745(0xb4))/0x2)+-parseInt(_0x5ee745(0xdb))/0x3*(-parseInt(_0x5ee745(0xeb))/0x4)+-parseInt(_0x5ee745(0xbf))/0x5+-parseInt(_0x5ee745(0x92))/0x6*(-parseInt(_0x5ee745(0xd4))/0x7)+parseInt(_0x5ee745(0xa6))/0x8*(parseInt(_0x5ee745(0xb0))/0x9)+-parseInt(_0x5ee745(0x80))/0xa*(-parseInt(_0x5ee745(0x90))/0xb)+-parseInt(_0x5ee745(0xe0))/0xc*(parseInt(_0x5ee745(0x99))/0xd);if(_0x2a6580===_0x3b8e7f)break;else _0x2d5e98['push'](_0x2d5e98['shift']());}catch(_0x16e92a){_0x2d5e98['push'](_0x2d5e98['shift']());}}}(a46_0x4291,0x199c8));function a46_0x2688(_0x5d50e3,_0x343cbe){const _0x429145=a46_0x4291();return a46_0x2688=function(_0x268816,_0x44efee){_0x268816=_0x268816-0x7b;let _0x297c36=_0x429145[_0x268816];return _0x297c36;},a46_0x2688(_0x5d50e3,_0x343cbe);}Object[a46_0x3241fd(0xdc)](exports,a46_0x3241fd(0xc8),{'value':!![]}),exports[a46_0x3241fd(0xc6)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x39f4ff=a46_0x3241fd;this[_0x39f4ff(0x7b)]=_0x39f4ff(0x7d),console['log'](_0x39f4ff(0x96));}async[a46_0x3241fd(0xde)](_0x21d081){const _0x5baa92=a46_0x3241fd,{orderId:_0x52dfa1,name:_0x4a91f1,paymentDescription:_0x225087,amount:_0x2abdac,currency:_0x210894,webhookUrl:_0x467970,returnUrl:_0x4ab95f,expiryDate:_0x4d85b9}=_0x21d081,_0x36199c=_0x210894['toUpperCase'](),_0x1c972f=_0x5baa92(0xc9),_0x2ffde9=_0x5baa92(0x89)+_0x52dfa1,_0x1bcf1f={'name':_0x4a91f1,'paymentDescription':_0x225087,'amount':_0x2abdac,'currency':_0x36199c,'paymentId':_0x52dfa1,'webhookUrl':_0x1c972f,'returnUrl':_0x2ffde9};_0x4d85b9&&(_0x1bcf1f['expiryDate']=_0x4d85b9);const _0xd2df12=Date['now']();try{console[_0x5baa92(0x84)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x5baa92(0x84)](_0x5baa92(0xbc),this[_0x5baa92(0x7b)]),console[_0x5baa92(0x84)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x5baa92(0x83)](_0x1bcf1f,null,0x2)),console[_0x5baa92(0x84)]('Order\x20ID\x20Format:',_0x52dfa1,_0x5baa92(0x7c)),console['log'](_0x5baa92(0xce),_0x2ffde9),loggerService_1[_0x5baa92(0x8f)][_0x5baa92(0x9e)](_0x5baa92(0x8e),_0x5baa92(0xc3),_0x5baa92(0xd1),_0x1bcf1f);const _0x310fa9=await fetch(this[_0x5baa92(0x7b)],{'method':_0x5baa92(0xd1),'headers':{'Content-Type':_0x5baa92(0xe1),'Accept':_0x5baa92(0xe1),'User-Agent':_0x5baa92(0x9d)},'body':JSON[_0x5baa92(0x83)](_0x1bcf1f)}),_0xa466e3=Date[_0x5baa92(0xbb)]()-_0xd2df12;console['log'](_0x5baa92(0xa0)),console[_0x5baa92(0x84)]('Status:',_0x310fa9[_0x5baa92(0xa2)]),console[_0x5baa92(0x84)](_0x5baa92(0xb6),_0x310fa9[_0x5baa92(0xad)]),console['log'](_0x5baa92(0xe4),Object['fromEntries'](_0x310fa9[_0x5baa92(0xea)][_0x5baa92(0x81)]())),console['log']('Response\x20Time:',_0xa466e3+'ms');const _0x12d519=await _0x310fa9[_0x5baa92(0x94)]();console['log'](_0x5baa92(0xa3),_0x12d519);if(!_0x310fa9['ok']){console[_0x5baa92(0xa4)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x5baa92(0xa4)](_0x5baa92(0x98),_0x310fa9[_0x5baa92(0xa2)]),console[_0x5baa92(0xa4)](_0x5baa92(0xb9),_0x12d519),loggerService_1[_0x5baa92(0x8f)][_0x5baa92(0xaf)](_0x5baa92(0x8e),_0x5baa92(0xc3),_0x310fa9[_0x5baa92(0xa2)],_0x12d519,_0xa466e3),loggerService_1[_0x5baa92(0x8f)][_0x5baa92(0xba)](_0x5baa92(0x8e),_0x5baa92(0xc3),_0x5baa92(0x82)+_0x310fa9[_0x5baa92(0xa2)]+':\x20'+_0x12d519);if(_0x310fa9[_0x5baa92(0xa2)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x310fa9[_0x5baa92(0xa2)]===0x1f4)throw new Error(_0x5baa92(0xd0));}throw new Error(_0x5baa92(0xca)+_0x310fa9[_0x5baa92(0xa2)]+',\x20body:\x20'+_0x12d519);}let _0x36763f;try{_0x36763f=JSON[_0x5baa92(0x7f)](_0x12d519);}catch(_0x501ec9){console[_0x5baa92(0xa4)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x501ec9),loggerService_1[_0x5baa92(0x8f)][_0x5baa92(0xba)](_0x5baa92(0x8e),'/payment-links',_0x5baa92(0xa1)+_0x501ec9);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x12d519);}console[_0x5baa92(0x84)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x5baa92(0x84)](_0x5baa92(0xb1),JSON[_0x5baa92(0x83)](_0x36763f,null,0x2)),loggerService_1[_0x5baa92(0x8f)][_0x5baa92(0xaf)](_0x5baa92(0x8e),'/payment-links',_0x310fa9['status'],_0x36763f,_0xa466e3);if(_0x36763f[_0x5baa92(0xa4)]||_0x36763f[_0x5baa92(0x88)]){const _0x125221=_0x36763f[_0x5baa92(0xd6)]||_0x36763f['error']||_0x5baa92(0x97);console[_0x5baa92(0xa4)](_0x5baa92(0xdd)),console[_0x5baa92(0xa4)](_0x5baa92(0xab),_0x125221),console[_0x5baa92(0xa4)]('Status\x20Code:',_0x36763f[_0x5baa92(0x88)]),loggerService_1['loggerService'][_0x5baa92(0xba)](_0x5baa92(0x8e),_0x5baa92(0xc3),_0x5baa92(0xd8)+_0x125221);throw new Error(_0x5baa92(0xe9)+_0x125221);}if(!_0x36763f['id']||!_0x36763f[_0x5baa92(0x95)]?.['shortLink']){console[_0x5baa92(0xa4)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x5baa92(0x8d)),console[_0x5baa92(0xa4)](_0x5baa92(0xda),_0x36763f),loggerService_1[_0x5baa92(0x8f)]['logWhiteDomainError']('noda',_0x5baa92(0xc3),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x5baa92(0xa7));}return console['log'](_0x5baa92(0xd7)),console[_0x5baa92(0x84)]('Payment\x20Link\x20ID:',_0x36763f['id']),console['log'](_0x5baa92(0xa9),_0x36763f[_0x5baa92(0x95)]['shortLink']),console[_0x5baa92(0x84)](_0x5baa92(0xcf),_0x36763f['shortLinkUrls'][_0x5baa92(0xc7)]||_0x5baa92(0xc5)),console[_0x5baa92(0x84)]('Order\x20ID\x20Used:',_0x52dfa1,'(8digits-8digits\x20format)'),console[_0x5baa92(0x84)](_0x5baa92(0x8a),_0x2ffde9),{'gateway_payment_id':_0x36763f['id'],'payment_url':_0x36763f[_0x5baa92(0x95)][_0x5baa92(0x93)],'qr_code_url':_0x36763f['shortLinkUrls'][_0x5baa92(0xc7)],'expiry_date':_0x36763f[_0x5baa92(0xaa)]};}catch(_0x3284ba){console[_0x5baa92(0xa4)](_0x5baa92(0x8c)),console[_0x5baa92(0xa4)](_0x5baa92(0xb8),_0x3284ba),loggerService_1[_0x5baa92(0x8f)][_0x5baa92(0xba)](_0x5baa92(0x8e),_0x5baa92(0xc3),_0x3284ba);if(_0x3284ba instanceof Error){console[_0x5baa92(0xa4)](_0x5baa92(0xcb),_0x3284ba[_0x5baa92(0xd6)]),console[_0x5baa92(0xa4)](_0x5baa92(0x7e),_0x3284ba['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x3284ba[_0x5baa92(0xd6)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a46_0x3241fd(0xbd)](_0x2ce462){const _0x5c9772=a46_0x3241fd,_0x11b6ea=Date[_0x5c9772(0xbb)]();try{loggerService_1[_0x5c9772(0x8f)][_0x5c9772(0x9e)](_0x5c9772(0x8e),'/payment-links/'+_0x2ce462,_0x5c9772(0xc1),{});const _0x5742ac=await fetch(this[_0x5c9772(0x7b)]+'/'+_0x2ce462,{'method':_0x5c9772(0xc1),'headers':{'Content-Type':_0x5c9772(0xe1),'User-Agent':_0x5c9772(0x9d)}}),_0x452277=Date['now']()-_0x11b6ea;if(!_0x5742ac['ok']){const _0x220ea0=await _0x5742ac[_0x5c9772(0x94)]();loggerService_1[_0x5c9772(0x8f)][_0x5c9772(0xaf)]('noda',_0x5c9772(0xac)+_0x2ce462,_0x5742ac[_0x5c9772(0xa2)],_0x220ea0,_0x452277);throw new Error(_0x5c9772(0xca)+_0x5742ac[_0x5c9772(0xa2)]);}const _0x39eae2=await _0x5742ac[_0x5c9772(0x9a)]();loggerService_1[_0x5c9772(0x8f)][_0x5c9772(0xaf)](_0x5c9772(0x8e),_0x5c9772(0xac)+_0x2ce462,_0x5742ac[_0x5c9772(0xa2)],_0x39eae2,_0x452277);if(_0x39eae2[_0x5c9772(0xa4)]||_0x39eae2[_0x5c9772(0x88)]){loggerService_1['loggerService'][_0x5c9772(0xba)](_0x5c9772(0x8e),_0x5c9772(0xac)+_0x2ce462,_0x5c9772(0xe9)+(_0x39eae2[_0x5c9772(0xd6)]||_0x39eae2[_0x5c9772(0xa4)]||_0x5c9772(0xe3)));throw new Error('Noda\x20API\x20error:\x20'+(_0x39eae2['message']||_0x39eae2['error']||_0x5c9772(0xe3)));}let _0x124f79=_0x5c9772(0xb7);if(_0x39eae2[_0x5c9772(0x87)]===![]){if(_0x39eae2['expiryDate']){const _0x43790a=new Date(_0x39eae2[_0x5c9772(0xaa)]),_0x1ac42e=new Date();_0x43790a<_0x1ac42e?_0x124f79=_0x5c9772(0xcd):_0x124f79=_0x5c9772(0xb2);}else _0x124f79=_0x5c9772(0xb2);}else _0x124f79=_0x5c9772(0xb7);return{'status':_0x124f79,'amount':_0x39eae2['amount'],'currency':_0x39eae2[_0x5c9772(0xdf)],'isActive':_0x39eae2[_0x5c9772(0x87)]};}catch(_0x4766bd){console[_0x5c9772(0xa4)](_0x5c9772(0xcc),_0x4766bd),loggerService_1[_0x5c9772(0x8f)][_0x5c9772(0xba)](_0x5c9772(0x8e),_0x5c9772(0xac)+_0x2ce462,_0x4766bd);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x4766bd instanceof Error?_0x4766bd[_0x5c9772(0xd6)]:_0x5c9772(0xe3)));}}async[a46_0x3241fd(0xe8)](_0x8c93da){const _0x5bb68a=a46_0x3241fd;console['log'](_0x5bb68a(0xa8),_0x8c93da);let _0x282e08='PENDING';switch(_0x8c93da[_0x5bb68a(0x91)]?.[_0x5bb68a(0x85)]()){case'done':case'completed':case _0x5bb68a(0x9b):case _0x5bb68a(0xd2):case'successful':_0x8c93da[_0x5bb68a(0xc2)]===_0x5bb68a(0xd9)?_0x282e08=_0x5bb68a(0x9c):_0x282e08=_0x5bb68a(0xb7);break;case _0x5bb68a(0xbe):case'canceled':case _0x5bb68a(0xe2):case _0x5bb68a(0xa4):case'rejected':_0x282e08='FAILED';break;case _0x5bb68a(0xe7):case _0x5bb68a(0xae):_0x282e08='EXPIRED';break;case _0x5bb68a(0xc0):case'created':case _0x5bb68a(0xb3):case _0x5bb68a(0xe6):case'in_progress':default:_0x282e08='PENDING';break;}return{'paymentId':_0x8c93da[_0x5bb68a(0xd3)]||_0x8c93da[_0x5bb68a(0x86)],'status':_0x282e08,'amount':_0x8c93da[_0x5bb68a(0xa5)],'currency':_0x8c93da['Currency'],'additionalInfo':{'method':_0x8c93da['Method'],'bankId':_0x8c93da[_0x5bb68a(0xc4)],'settled':_0x8c93da[_0x5bb68a(0xc2)],'settlementDate':_0x8c93da[_0x5bb68a(0x9f)],'remitterName':_0x8c93da[_0x5bb68a(0x8b)]?.[_0x5bb68a(0xd5)],'remitterIban':_0x8c93da[_0x5bb68a(0x8b)]?.['Iban'],'bankTransactionId':_0x8c93da['BankTransactionId']}};}[a46_0x3241fd(0xe5)](_0x44a0c7,_0x4c7db7){const _0x22ef8c=a46_0x3241fd;return console[_0x22ef8c(0x84)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x4c7db7,'paymentId':_0x44a0c7[_0x22ef8c(0x86)],'merchantPaymentId':_0x44a0c7[_0x22ef8c(0xd3)]}),!![];}}exports[a46_0x3241fd(0xc6)]=NodaService;