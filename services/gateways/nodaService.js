'use strict';const a65_0x52776f=a65_0x334c;function a65_0x334c(_0x644c80,_0x29279a){_0x644c80=_0x644c80-0x115;const _0x280af9=a65_0x280a();let _0x334c3d=_0x280af9[_0x644c80];return _0x334c3d;}(function(_0xe13f36,_0x3976ac){const _0x2f0536=a65_0x334c,_0x1e490c=_0xe13f36();while(!![]){try{const _0x46ffc1=parseInt(_0x2f0536(0x183))/0x1+-parseInt(_0x2f0536(0x177))/0x2*(parseInt(_0x2f0536(0x174))/0x3)+-parseInt(_0x2f0536(0x163))/0x4*(parseInt(_0x2f0536(0x118))/0x5)+parseInt(_0x2f0536(0x15d))/0x6*(-parseInt(_0x2f0536(0x12e))/0x7)+-parseInt(_0x2f0536(0x172))/0x8+-parseInt(_0x2f0536(0x145))/0x9*(-parseInt(_0x2f0536(0x158))/0xa)+parseInt(_0x2f0536(0x124))/0xb;if(_0x46ffc1===_0x3976ac)break;else _0x1e490c['push'](_0x1e490c['shift']());}catch(_0x1ff2a8){_0x1e490c['push'](_0x1e490c['shift']());}}}(a65_0x280a,0x1bae0));function a65_0x280a(){const _0x278c73=['NodaService','completed','QR\x20Code\x20Link:','BankTransactionId','application/json','error','qrCodeLink','/payment-links','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','BankId','Method','PaymentId','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','10CVRzXl','Response\x20Body:','GET','HTTP\x20','message','198eoXAgL','logWhiteDomainResponse','Error\x20stack:','isActive','currency','shortLink','370232jSosOK','canceled','../loggerService','Status:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','pending','logWhiteDomainRequest','Remitter','Business\x20Error:\x20','timeout','status','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','stringify','log','fromEntries','1087408ThAQiY','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','444TGWuLt','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Unknown\x20error\x20from\x20Noda\x20API','2458RVFEQl','Error\x20Message:','Not\x20provided','Status\x20Code:','Noda\x20payment\x20verification\x20error:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Status','amount','active','https://tesoft.uk/gateway/noda/','headers','Noda\x20API\x20error:\x20','180064dAgwGA','success','expiryDate','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','rejected','(8digits-8digits\x20format\x20for\x20Noda)','Short\x20Link:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','FAILED','/payment-links/','shortLinkUrls','in_progress','defineProperty','toUpperCase','loggerService','Name','10RWetam','Parsed\x20Result:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','entries','URL:','paid','noda','Missing\x20id\x20or\x20shortLink\x20in\x20response','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','expired','cancelled','Processing\x20Noda\x20webhook:','3852772GKvPxu','parse','successful','apiUrl','done','POST','statusCode','text','Payment\x20System/1.0','Noda\x20webhook\x20signature\x20verification:','16765yJcOwB','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','HTTP\x20error!\x20status:\x20','Payment\x20Link\x20ID:','MerchantPaymentId','processing','toLowerCase','logWhiteDomainError','PAID','EXPIRED','SettlementDate','Currency','now','created','Response\x20Time:','https://tesoft.uk/gateway/noda/webhook/','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Yes','Unknown\x20error','===\x20NODA\x20SUCCESS\x20===','PENDING','1485261BxMLFV','===\x20NODA\x20SERVICE\x20ERROR\x20===','Order\x20ID\x20Format:','Status\x20Text:','Response\x20data:','Order\x20ID\x20Used:'];a65_0x280a=function(){return _0x278c73;};return a65_0x280a();}Object[a65_0x52776f(0x18f)](exports,'__esModule',{'value':!![]}),exports[a65_0x52776f(0x14b)]=void 0x0;const loggerService_1=require(a65_0x52776f(0x165));class NodaService{constructor(){const _0x2b070a=a65_0x52776f;this['apiUrl']=_0x2b070a(0x180),console[_0x2b070a(0x170)](_0x2b070a(0x167));}async['createPaymentLink'](_0xc46959){const _0x1924d0=a65_0x52776f,{orderId:_0x467613,name:_0x168f63,paymentDescription:_0x1a3c25,amount:_0x3cdf07,currency:_0x522a84,webhookUrl:_0x228dc3,returnUrl:_0x5ae280,expiryDate:_0x54fb66}=_0xc46959,_0x385d77=_0x522a84[_0x1924d0(0x115)](),_0x123473=_0x1924d0(0x13f),_0x2371c1='https://tesoft.uk/gateway/pending.php?id='+_0x467613,_0x31594d={'name':_0x168f63,'paymentDescription':_0x1a3c25,'amount':_0x3cdf07,'currency':_0x385d77,'paymentId':_0x467613,'webhookUrl':_0x123473,'returnUrl':_0x2371c1};_0x54fb66&&(_0x31594d['expiryDate']=_0x54fb66);const _0x5c640c=Date[_0x1924d0(0x13c)]();try{console[_0x1924d0(0x170)](_0x1924d0(0x157)),console[_0x1924d0(0x170)](_0x1924d0(0x11c),this[_0x1924d0(0x127)]),console[_0x1924d0(0x170)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x1924d0(0x16f)](_0x31594d,null,0x2)),console['log'](_0x1924d0(0x147),_0x467613,_0x1924d0(0x188)),console[_0x1924d0(0x170)](_0x1924d0(0x140),_0x2371c1),loggerService_1[_0x1924d0(0x116)]['logWhiteDomainRequest'](_0x1924d0(0x11e),_0x1924d0(0x152),_0x1924d0(0x129),_0x31594d);const _0x246f2c=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x1924d0(0x14f),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x1924d0(0x16f)](_0x31594d)}),_0xdc3c62=Date['now']()-_0x5c640c;console[_0x1924d0(0x170)](_0x1924d0(0x120)),console[_0x1924d0(0x170)](_0x1924d0(0x166),_0x246f2c['status']),console[_0x1924d0(0x170)](_0x1924d0(0x148),_0x246f2c['statusText']),console[_0x1924d0(0x170)]('Headers:',Object[_0x1924d0(0x171)](_0x246f2c[_0x1924d0(0x181)][_0x1924d0(0x11b)]())),console[_0x1924d0(0x170)](_0x1924d0(0x13e),_0xdc3c62+'ms');const _0x310707=await _0x246f2c[_0x1924d0(0x12b)]();console[_0x1924d0(0x170)]('Raw\x20Response\x20Body:',_0x310707);if(!_0x246f2c['ok']){console[_0x1924d0(0x150)]('===\x20NODA\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x246f2c[_0x1924d0(0x16d)]),console['error'](_0x1924d0(0x159),_0x310707),loggerService_1[_0x1924d0(0x116)][_0x1924d0(0x15e)](_0x1924d0(0x11e),_0x1924d0(0x152),_0x246f2c[_0x1924d0(0x16d)],_0x310707,_0xdc3c62),loggerService_1[_0x1924d0(0x116)]['logWhiteDomainError']('noda',_0x1924d0(0x152),_0x1924d0(0x15b)+_0x246f2c[_0x1924d0(0x16d)]+':\x20'+_0x310707);if(_0x246f2c[_0x1924d0(0x16d)]===0x190)throw new Error(_0x1924d0(0x12f));else{if(_0x246f2c['status']===0x1f4)throw new Error(_0x1924d0(0x173));}throw new Error(_0x1924d0(0x132)+_0x246f2c[_0x1924d0(0x16d)]+',\x20body:\x20'+_0x310707);}let _0x3522e1;try{_0x3522e1=JSON[_0x1924d0(0x125)](_0x310707);}catch(_0x3bafab){console[_0x1924d0(0x150)](_0x1924d0(0x130),_0x3bafab),loggerService_1[_0x1924d0(0x116)][_0x1924d0(0x137)](_0x1924d0(0x11e),_0x1924d0(0x152),'JSON\x20Parse\x20Error:\x20'+_0x3bafab);throw new Error(_0x1924d0(0x11a)+_0x310707);}console['log']('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x1924d0(0x170)](_0x1924d0(0x119),JSON[_0x1924d0(0x16f)](_0x3522e1,null,0x2)),loggerService_1[_0x1924d0(0x116)]['logWhiteDomainResponse']('noda','/payment-links',_0x246f2c[_0x1924d0(0x16d)],_0x3522e1,_0xdc3c62);if(_0x3522e1[_0x1924d0(0x150)]||_0x3522e1[_0x1924d0(0x12a)]){const _0x46d302=_0x3522e1[_0x1924d0(0x15c)]||_0x3522e1['error']||_0x1924d0(0x176);console[_0x1924d0(0x150)](_0x1924d0(0x186)),console[_0x1924d0(0x150)](_0x1924d0(0x178),_0x46d302),console[_0x1924d0(0x150)](_0x1924d0(0x17a),_0x3522e1[_0x1924d0(0x12a)]),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x1924d0(0x152),_0x1924d0(0x16b)+_0x46d302);throw new Error('Noda\x20API\x20error:\x20'+_0x46d302);}if(!_0x3522e1['id']||!_0x3522e1['shortLinkUrls']?.[_0x1924d0(0x162)]){console['error'](_0x1924d0(0x18a)),console[_0x1924d0(0x150)](_0x1924d0(0x11f)),console['error'](_0x1924d0(0x149),_0x3522e1),loggerService_1[_0x1924d0(0x116)][_0x1924d0(0x137)](_0x1924d0(0x11e),_0x1924d0(0x152),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x1924d0(0x16e));}return console['log'](_0x1924d0(0x143)),console[_0x1924d0(0x170)](_0x1924d0(0x133),_0x3522e1['id']),console[_0x1924d0(0x170)](_0x1924d0(0x189),_0x3522e1[_0x1924d0(0x18d)]['shortLink']),console[_0x1924d0(0x170)](_0x1924d0(0x14d),_0x3522e1[_0x1924d0(0x18d)][_0x1924d0(0x151)]||_0x1924d0(0x179)),console['log'](_0x1924d0(0x14a),_0x467613,'(8digits-8digits\x20format)'),console['log'](_0x1924d0(0x17c),_0x2371c1),{'gateway_payment_id':_0x3522e1['id'],'payment_url':_0x3522e1[_0x1924d0(0x18d)]['shortLink'],'qr_code_url':_0x3522e1['shortLinkUrls'][_0x1924d0(0x151)],'expiry_date':_0x3522e1[_0x1924d0(0x185)]};}catch(_0x499277){console[_0x1924d0(0x150)](_0x1924d0(0x146)),console[_0x1924d0(0x150)]('Error\x20details:',_0x499277),loggerService_1[_0x1924d0(0x116)][_0x1924d0(0x137)](_0x1924d0(0x11e),_0x1924d0(0x152),_0x499277);if(_0x499277 instanceof Error){console[_0x1924d0(0x150)]('Error\x20message:',_0x499277[_0x1924d0(0x15c)]),console[_0x1924d0(0x150)](_0x1924d0(0x15f),_0x499277['stack']);throw new Error(_0x1924d0(0x131)+_0x499277[_0x1924d0(0x15c)]);}throw new Error(_0x1924d0(0x153));}}async['verifyPayment'](_0x34bd02){const _0x418b55=a65_0x52776f,_0x53ec3c=Date['now']();try{loggerService_1[_0x418b55(0x116)][_0x418b55(0x169)](_0x418b55(0x11e),_0x418b55(0x18c)+_0x34bd02,_0x418b55(0x15a),{});const _0x23cac8=await fetch(this['apiUrl']+'/'+_0x34bd02,{'method':_0x418b55(0x15a),'headers':{'Content-Type':_0x418b55(0x14f),'User-Agent':_0x418b55(0x12c)}}),_0x2588b0=Date[_0x418b55(0x13c)]()-_0x53ec3c;if(!_0x23cac8['ok']){const _0x26c030=await _0x23cac8[_0x418b55(0x12b)]();loggerService_1[_0x418b55(0x116)][_0x418b55(0x15e)](_0x418b55(0x11e),'/payment-links/'+_0x34bd02,_0x23cac8[_0x418b55(0x16d)],_0x26c030,_0x2588b0);throw new Error(_0x418b55(0x132)+_0x23cac8['status']);}const _0x3c1955=await _0x23cac8['json']();loggerService_1['loggerService'][_0x418b55(0x15e)](_0x418b55(0x11e),_0x418b55(0x18c)+_0x34bd02,_0x23cac8[_0x418b55(0x16d)],_0x3c1955,_0x2588b0);if(_0x3c1955['error']||_0x3c1955[_0x418b55(0x12a)]){loggerService_1[_0x418b55(0x116)][_0x418b55(0x137)](_0x418b55(0x11e),_0x418b55(0x18c)+_0x34bd02,_0x418b55(0x182)+(_0x3c1955[_0x418b55(0x15c)]||_0x3c1955[_0x418b55(0x150)]||_0x418b55(0x142)));throw new Error(_0x418b55(0x182)+(_0x3c1955[_0x418b55(0x15c)]||_0x3c1955[_0x418b55(0x150)]||_0x418b55(0x142)));}let _0x4c097c=_0x418b55(0x144);if(_0x3c1955[_0x418b55(0x160)]===![]){if(_0x3c1955['expiryDate']){const _0x3301aa=new Date(_0x3c1955[_0x418b55(0x185)]),_0x3831d4=new Date();_0x3301aa<_0x3831d4?_0x4c097c=_0x418b55(0x139):_0x4c097c=_0x418b55(0x18b);}else _0x4c097c='FAILED';}else _0x4c097c=_0x418b55(0x144);return{'status':_0x4c097c,'amount':_0x3c1955[_0x418b55(0x17e)],'currency':_0x3c1955[_0x418b55(0x161)],'isActive':_0x3c1955['isActive']};}catch(_0x1769c9){console[_0x418b55(0x150)](_0x418b55(0x17b),_0x1769c9),loggerService_1[_0x418b55(0x116)]['logWhiteDomainError']('noda','/payment-links/'+_0x34bd02,_0x1769c9);throw new Error(_0x418b55(0x175)+(_0x1769c9 instanceof Error?_0x1769c9[_0x418b55(0x15c)]:_0x418b55(0x142)));}}async['processWebhook'](_0x4d3e4d){const _0x143281=a65_0x52776f;console[_0x143281(0x170)](_0x143281(0x123),_0x4d3e4d);let _0x4a7c11=_0x143281(0x144);switch(_0x4d3e4d[_0x143281(0x17d)]?.[_0x143281(0x136)]()){case _0x143281(0x128):case _0x143281(0x14c):case _0x143281(0x11d):case _0x143281(0x184):case _0x143281(0x126):_0x4d3e4d['Settled']===_0x143281(0x141)?_0x4a7c11=_0x143281(0x138):_0x4a7c11=_0x143281(0x144);break;case _0x143281(0x122):case _0x143281(0x164):case'failed':case'error':case _0x143281(0x187):_0x4a7c11=_0x143281(0x18b);break;case _0x143281(0x121):case _0x143281(0x16c):_0x4a7c11='EXPIRED';break;case _0x143281(0x168):case _0x143281(0x13d):case _0x143281(0x17f):case _0x143281(0x135):case _0x143281(0x18e):default:_0x4a7c11=_0x143281(0x144);break;}return{'paymentId':_0x4d3e4d[_0x143281(0x134)]||_0x4d3e4d[_0x143281(0x156)],'status':_0x4a7c11,'amount':_0x4d3e4d['Amount'],'currency':_0x4d3e4d[_0x143281(0x13b)],'additionalInfo':{'method':_0x4d3e4d[_0x143281(0x155)],'bankId':_0x4d3e4d[_0x143281(0x154)],'settled':_0x4d3e4d['Settled'],'settlementDate':_0x4d3e4d[_0x143281(0x13a)],'remitterName':_0x4d3e4d[_0x143281(0x16a)]?.[_0x143281(0x117)],'remitterIban':_0x4d3e4d[_0x143281(0x16a)]?.['Iban'],'bankTransactionId':_0x4d3e4d[_0x143281(0x14e)]}};}['verifyWebhookSignature'](_0x5ed633,_0x31a9b2){const _0x203686=a65_0x52776f;return console[_0x203686(0x170)](_0x203686(0x12d),{'receivedSignature':_0x31a9b2,'paymentId':_0x5ed633['PaymentId'],'merchantPaymentId':_0x5ed633[_0x203686(0x134)]}),!![];}}exports[a65_0x52776f(0x14b)]=NodaService;