'use strict';const a48_0x56c2ce=a48_0x100e;(function(_0x23eca3,_0x30137d){const _0x1ad07c=a48_0x100e,_0x4862db=_0x23eca3();while(!![]){try{const _0x53d4fc=parseInt(_0x1ad07c(0x17e))/0x1+parseInt(_0x1ad07c(0x165))/0x2*(-parseInt(_0x1ad07c(0x17a))/0x3)+parseInt(_0x1ad07c(0x12b))/0x4*(parseInt(_0x1ad07c(0x149))/0x5)+parseInt(_0x1ad07c(0x126))/0x6*(-parseInt(_0x1ad07c(0x185))/0x7)+parseInt(_0x1ad07c(0x125))/0x8*(-parseInt(_0x1ad07c(0x18e))/0x9)+parseInt(_0x1ad07c(0x183))/0xa+-parseInt(_0x1ad07c(0x15a))/0xb*(parseInt(_0x1ad07c(0x175))/0xc);if(_0x53d4fc===_0x30137d)break;else _0x4862db['push'](_0x4862db['shift']());}catch(_0x148ec3){_0x4862db['push'](_0x4862db['shift']());}}}(a48_0xbdce,0xabeea));function a48_0x100e(_0x3fff78,_0x3dca87){const _0xbdce95=a48_0xbdce();return a48_0x100e=function(_0x100ef6,_0x287d18){_0x100ef6=_0x100ef6-0x11c;let _0x3edf19=_0xbdce95[_0x100ef6];return _0x3edf19;},a48_0x100e(_0x3fff78,_0x3dca87);}Object[a48_0x56c2ce(0x151)](exports,a48_0x56c2ce(0x147),{'value':!![]}),exports[a48_0x56c2ce(0x16f)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x17ce1f=a48_0x56c2ce;this['apiUrl']=_0x17ce1f(0x153),console['log'](_0x17ce1f(0x198));}async[a48_0x56c2ce(0x129)](_0x5a6c36){const _0x1bba60=a48_0x56c2ce,{orderId:_0x555e98,name:_0x2195a1,paymentDescription:_0x27013b,amount:_0xcb59d4,currency:_0x48d88f,webhookUrl:_0x33a3de,returnUrl:_0x3d01f2,expiryDate:_0x5d98eb}=_0x5a6c36,_0x1550d4=_0x48d88f[_0x1bba60(0x167)](),_0x473968=_0x1bba60(0x15e),_0x5ea90b=_0x1bba60(0x141)+_0x555e98,_0x38a10f={'name':_0x2195a1,'paymentDescription':_0x27013b,'amount':_0xcb59d4,'currency':_0x1550d4,'paymentId':_0x555e98,'webhookUrl':_0x473968,'returnUrl':_0x5ea90b};_0x5d98eb&&(_0x38a10f[_0x1bba60(0x135)]=_0x5d98eb);const _0x240dd9=Date[_0x1bba60(0x139)]();try{console[_0x1bba60(0x127)](_0x1bba60(0x18b)),console['log']('URL:',this[_0x1bba60(0x134)]),console[_0x1bba60(0x127)](_0x1bba60(0x19c),JSON[_0x1bba60(0x17b)](_0x38a10f,null,0x2)),console[_0x1bba60(0x127)](_0x1bba60(0x17c),_0x555e98,_0x1bba60(0x123)),console[_0x1bba60(0x127)]('✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:',_0x5ea90b),loggerService_1[_0x1bba60(0x18c)][_0x1bba60(0x15f)]('noda',_0x1bba60(0x14f),_0x1bba60(0x14b),_0x38a10f);const _0x584967=await fetch(this[_0x1bba60(0x134)],{'method':_0x1bba60(0x14b),'headers':{'Content-Type':_0x1bba60(0x131),'Accept':'application/json','User-Agent':_0x1bba60(0x14c)},'body':JSON[_0x1bba60(0x17b)](_0x38a10f)}),_0x2cb74c=Date[_0x1bba60(0x139)]()-_0x240dd9;console['log'](_0x1bba60(0x13a)),console[_0x1bba60(0x127)](_0x1bba60(0x177),_0x584967[_0x1bba60(0x176)]),console[_0x1bba60(0x127)](_0x1bba60(0x189),_0x584967[_0x1bba60(0x12c)]),console['log'](_0x1bba60(0x163),Object['fromEntries'](_0x584967[_0x1bba60(0x181)]['entries']())),console[_0x1bba60(0x127)](_0x1bba60(0x11c),_0x2cb74c+'ms');const _0xb27323=await _0x584967[_0x1bba60(0x16b)]();console[_0x1bba60(0x127)](_0x1bba60(0x157),_0xb27323);if(!_0x584967['ok']){console[_0x1bba60(0x138)](_0x1bba60(0x197)),console['error'](_0x1bba60(0x19a),_0x584967['status']),console[_0x1bba60(0x138)](_0x1bba60(0x192),_0xb27323),loggerService_1[_0x1bba60(0x18c)]['logWhiteDomainResponse'](_0x1bba60(0x18a),_0x1bba60(0x14f),_0x584967[_0x1bba60(0x176)],_0xb27323,_0x2cb74c),loggerService_1[_0x1bba60(0x18c)][_0x1bba60(0x162)]('noda',_0x1bba60(0x14f),_0x1bba60(0x195)+_0x584967['status']+':\x20'+_0xb27323);if(_0x584967[_0x1bba60(0x176)]===0x190)throw new Error(_0x1bba60(0x148));else{if(_0x584967[_0x1bba60(0x176)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x1bba60(0x12e)+_0x584967['status']+_0x1bba60(0x166)+_0xb27323);}let _0x3d00d2;try{_0x3d00d2=JSON[_0x1bba60(0x12d)](_0xb27323);}catch(_0x34472b){console[_0x1bba60(0x138)](_0x1bba60(0x15d),_0x34472b),loggerService_1['loggerService'][_0x1bba60(0x162)](_0x1bba60(0x18a),_0x1bba60(0x14f),_0x1bba60(0x16a)+_0x34472b);throw new Error(_0x1bba60(0x19b)+_0xb27323);}console['log'](_0x1bba60(0x14e)),console[_0x1bba60(0x127)](_0x1bba60(0x180),JSON[_0x1bba60(0x17b)](_0x3d00d2,null,0x2)),loggerService_1[_0x1bba60(0x18c)][_0x1bba60(0x124)](_0x1bba60(0x18a),_0x1bba60(0x14f),_0x584967['status'],_0x3d00d2,_0x2cb74c);if(_0x3d00d2[_0x1bba60(0x138)]||_0x3d00d2[_0x1bba60(0x122)]){const _0x39e587=_0x3d00d2[_0x1bba60(0x171)]||_0x3d00d2[_0x1bba60(0x138)]||_0x1bba60(0x120);console['error'](_0x1bba60(0x12f)),console[_0x1bba60(0x138)]('Error\x20Message:',_0x39e587),console[_0x1bba60(0x138)](_0x1bba60(0x16c),_0x3d00d2[_0x1bba60(0x122)]),loggerService_1[_0x1bba60(0x18c)]['logWhiteDomainError'](_0x1bba60(0x18a),_0x1bba60(0x14f),_0x1bba60(0x152)+_0x39e587);throw new Error(_0x1bba60(0x160)+_0x39e587);}if(!_0x3d00d2['id']||!_0x3d00d2[_0x1bba60(0x146)]?.[_0x1bba60(0x154)]){console[_0x1bba60(0x138)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1bba60(0x138)](_0x1bba60(0x144)),console[_0x1bba60(0x138)](_0x1bba60(0x16e),_0x3d00d2),loggerService_1['loggerService'][_0x1bba60(0x162)](_0x1bba60(0x18a),_0x1bba60(0x14f),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x1bba60(0x186));}return console['log'](_0x1bba60(0x187)),console['log']('Payment\x20Link\x20ID:',_0x3d00d2['id']),console[_0x1bba60(0x127)]('Short\x20Link:',_0x3d00d2['shortLinkUrls'][_0x1bba60(0x154)]),console[_0x1bba60(0x127)](_0x1bba60(0x193),_0x3d00d2['shortLinkUrls'][_0x1bba60(0x169)]||_0x1bba60(0x143)),console['log']('Order\x20ID\x20Used:',_0x555e98,_0x1bba60(0x11f)),console[_0x1bba60(0x127)](_0x1bba60(0x132),_0x5ea90b),{'gateway_payment_id':_0x3d00d2['id'],'payment_url':_0x3d00d2['shortLinkUrls'][_0x1bba60(0x154)],'qr_code_url':_0x3d00d2['shortLinkUrls'][_0x1bba60(0x169)],'expiry_date':_0x3d00d2['expiryDate']};}catch(_0x527b5a){console['error'](_0x1bba60(0x13d)),console['error'](_0x1bba60(0x15b),_0x527b5a),loggerService_1['loggerService']['logWhiteDomainError']('noda','/payment-links',_0x527b5a);if(_0x527b5a instanceof Error){console[_0x1bba60(0x138)](_0x1bba60(0x161),_0x527b5a[_0x1bba60(0x171)]),console[_0x1bba60(0x138)](_0x1bba60(0x121),_0x527b5a[_0x1bba60(0x173)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x527b5a[_0x1bba60(0x171)]);}throw new Error(_0x1bba60(0x136));}}async[a48_0x56c2ce(0x14d)](_0x268d65){const _0x59db=a48_0x56c2ce,_0x243c34=Date[_0x59db(0x139)]();try{loggerService_1[_0x59db(0x18c)][_0x59db(0x15f)](_0x59db(0x18a),_0x59db(0x14a)+_0x268d65,'GET',{});const _0x1b64bc=await fetch(this[_0x59db(0x134)]+'/'+_0x268d65,{'method':_0x59db(0x174),'headers':{'Content-Type':_0x59db(0x131),'User-Agent':_0x59db(0x14c)}}),_0x45b905=Date['now']()-_0x243c34;if(!_0x1b64bc['ok']){const _0x5d4e8f=await _0x1b64bc[_0x59db(0x16b)]();loggerService_1[_0x59db(0x18c)]['logWhiteDomainResponse'](_0x59db(0x18a),_0x59db(0x14a)+_0x268d65,_0x1b64bc['status'],_0x5d4e8f,_0x45b905);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1b64bc[_0x59db(0x176)]);}const _0x524038=await _0x1b64bc[_0x59db(0x170)]();loggerService_1[_0x59db(0x18c)]['logWhiteDomainResponse'](_0x59db(0x18a),_0x59db(0x14a)+_0x268d65,_0x1b64bc[_0x59db(0x176)],_0x524038,_0x45b905);if(_0x524038[_0x59db(0x138)]||_0x524038[_0x59db(0x122)]){loggerService_1['loggerService'][_0x59db(0x162)](_0x59db(0x18a),_0x59db(0x14a)+_0x268d65,_0x59db(0x160)+(_0x524038[_0x59db(0x171)]||_0x524038['error']||_0x59db(0x156)));throw new Error(_0x59db(0x160)+(_0x524038[_0x59db(0x171)]||_0x524038['error']||_0x59db(0x156)));}let _0x3aa940=_0x59db(0x164);if(_0x524038[_0x59db(0x184)]===![]){if(_0x524038[_0x59db(0x135)]){const _0x5f090e=new Date(_0x524038[_0x59db(0x135)]),_0x4bb55a=new Date();_0x5f090e<_0x4bb55a?_0x3aa940=_0x59db(0x18f):_0x3aa940=_0x59db(0x13f);}else _0x3aa940='FAILED';}else _0x3aa940=_0x59db(0x164);return{'status':_0x3aa940,'amount':_0x524038['amount'],'currency':_0x524038['currency'],'isActive':_0x524038[_0x59db(0x184)]};}catch(_0x3e7f5e){console['error'](_0x59db(0x194),_0x3e7f5e),loggerService_1[_0x59db(0x18c)][_0x59db(0x162)](_0x59db(0x18a),_0x59db(0x14a)+_0x268d65,_0x3e7f5e);throw new Error(_0x59db(0x133)+(_0x3e7f5e instanceof Error?_0x3e7f5e[_0x59db(0x171)]:_0x59db(0x156)));}}async[a48_0x56c2ce(0x18d)](_0x1533cf){const _0x34b934=a48_0x56c2ce;console['log'](_0x34b934(0x172),_0x1533cf);let _0x2f4743=_0x34b934(0x164);switch(_0x1533cf[_0x34b934(0x13b)]?.[_0x34b934(0x12a)]()){case _0x34b934(0x17f):case _0x34b934(0x15c):case _0x34b934(0x17d):case _0x34b934(0x140):case _0x34b934(0x128):_0x1533cf['Settled']===_0x34b934(0x168)?_0x2f4743=_0x34b934(0x137):_0x2f4743=_0x34b934(0x164);break;case _0x34b934(0x159):case _0x34b934(0x11d):case _0x34b934(0x190):case _0x34b934(0x138):case'rejected':_0x2f4743='FAILED';break;case _0x34b934(0x13e):case _0x34b934(0x142):_0x2f4743='EXPIRED';break;case _0x34b934(0x196):case'created':case'active':case _0x34b934(0x179):case _0x34b934(0x13c):default:_0x2f4743=_0x34b934(0x164);break;}return{'paymentId':_0x1533cf['MerchantPaymentId']||_0x1533cf[_0x34b934(0x188)],'status':_0x2f4743,'amount':_0x1533cf[_0x34b934(0x191)],'currency':_0x1533cf[_0x34b934(0x199)],'additionalInfo':{'method':_0x1533cf[_0x34b934(0x16d)],'bankId':_0x1533cf[_0x34b934(0x130)],'settled':_0x1533cf[_0x34b934(0x178)],'settlementDate':_0x1533cf[_0x34b934(0x182)],'remitterName':_0x1533cf[_0x34b934(0x145)]?.['Name'],'remitterIban':_0x1533cf[_0x34b934(0x145)]?.[_0x34b934(0x150)],'bankTransactionId':_0x1533cf[_0x34b934(0x155)]}};}[a48_0x56c2ce(0x158)](_0xf9ad90,_0x1fe8ac){const _0x15d25a=a48_0x56c2ce;return console[_0x15d25a(0x127)](_0x15d25a(0x11e),{'receivedSignature':_0x1fe8ac,'paymentId':_0xf9ad90[_0x15d25a(0x188)],'merchantPaymentId':_0xf9ad90['MerchantPaymentId']}),!![];}}exports[a48_0x56c2ce(0x16f)]=NodaService;function a48_0xbdce(){const _0xde3f27=['Processing\x20Noda\x20webhook:','stack','GET','4884348rWUhiy','status','Status:','Settled','processing','138QPqsWS','stringify','Order\x20ID\x20Format:','paid','1329123YPzrsJ','done','Parsed\x20Result:','headers','SettlementDate','6851570fEhAiQ','isActive','2271073GXmOcJ','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20SUCCESS\x20===','PaymentId','Status\x20Text:','noda','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','loggerService','processWebhook','173133hVSYba','EXPIRED','failed','Amount','Response\x20Body:','QR\x20Code\x20Link:','Noda\x20payment\x20verification\x20error:','HTTP\x20','pending','===\x20NODA\x20API\x20ERROR\x20===','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Currency','HTTP\x20Status:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Request\x20Body\x20(Direct\x20JSON):','Response\x20Time:','canceled','Noda\x20webhook\x20signature\x20verification:','(8digits-8digits\x20format)','Unknown\x20error\x20from\x20Noda\x20API','Error\x20stack:','statusCode','(8digits-8digits\x20format\x20for\x20Noda)','logWhiteDomainResponse','88STIGID','18oTuEVL','log','successful','createPaymentLink','toLowerCase','3353476zgfevj','statusText','parse','HTTP\x20error!\x20status:\x20','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','BankId','application/json','✅\x20Return\x20URL\x20configured\x20for\x20pending:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','apiUrl','expiryDate','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','PAID','error','now','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status','in_progress','===\x20NODA\x20SERVICE\x20ERROR\x20===','expired','FAILED','success','https://tesoft.uk/gateway/pending.php?id=','timeout','Not\x20provided','Missing\x20id\x20or\x20shortLink\x20in\x20response','Remitter','shortLinkUrls','__esModule','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','5FizaQP','/payment-links/','POST','TesSoft\x20Payment\x20System/1.0','verifyPayment','===\x20PARSED\x20NODA\x20RESPONSE\x20===','/payment-links','Iban','defineProperty','Business\x20Error:\x20','https://tesoft.uk/gateway/noda/','shortLink','BankTransactionId','Unknown\x20error','Raw\x20Response\x20Body:','verifyWebhookSignature','cancelled','11RLRVLB','Error\x20details:','completed','Failed\x20to\x20parse\x20JSON\x20response:','https://tesoft.uk/gateway/noda/webhook/','logWhiteDomainRequest','Noda\x20API\x20error:\x20','Error\x20message:','logWhiteDomainError','Headers:','PENDING','24194jfSbGE',',\x20body:\x20','toUpperCase','Yes','qrCodeLink','JSON\x20Parse\x20Error:\x20','text','Status\x20Code:','Method','Response\x20data:','NodaService','json','message'];a48_0xbdce=function(){return _0xde3f27;};return a48_0xbdce();}