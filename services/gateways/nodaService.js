'use strict';const a60_0x376781=a60_0xa4ba;(function(_0x112acd,_0x1d8464){const _0x14efad=a60_0xa4ba,_0x35e9fb=_0x112acd();while(!![]){try{const _0x29f4da=parseInt(_0x14efad(0x1f1))/0x1*(parseInt(_0x14efad(0x211))/0x2)+parseInt(_0x14efad(0x1ae))/0x3+-parseInt(_0x14efad(0x201))/0x4*(-parseInt(_0x14efad(0x1c7))/0x5)+-parseInt(_0x14efad(0x1ef))/0x6+parseInt(_0x14efad(0x1dc))/0x7*(-parseInt(_0x14efad(0x1ec))/0x8)+parseInt(_0x14efad(0x1eb))/0x9*(parseInt(_0x14efad(0x1f7))/0xa)+-parseInt(_0x14efad(0x1b8))/0xb;if(_0x29f4da===_0x1d8464)break;else _0x35e9fb['push'](_0x35e9fb['shift']());}catch(_0x35bb1e){_0x35e9fb['push'](_0x35e9fb['shift']());}}}(a60_0x2878,0xde577));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a60_0x376781(0x216)]=void 0x0;function a60_0xa4ba(_0x4858e1,_0x1c956a){_0x4858e1=_0x4858e1-0x1ad;const _0x28781c=a60_0x2878();let _0xa4ba6e=_0x28781c[_0x4858e1];return _0xa4ba6e;}const loggerService_1=require(a60_0x376781(0x203));function a60_0x2878(){const _0x56e362=['parse','Unknown\x20error\x20from\x20Noda\x20API','active','toLowerCase','verifyWebhookSignature','MerchantPaymentId','statusText','11076901GyLYJO','PENDING','Missing\x20id\x20or\x20shortLink\x20in\x20response','Raw\x20Response\x20Body:','shortLink','Status:','noda','Order\x20ID\x20Format:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Settled','URL:','expired','statusCode','Not\x20provided','status','20GBbUIG','json','Status\x20Text:','paid','text','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','completed','isActive','fromEntries','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','toUpperCase','QR\x20Code\x20Link:','JSON\x20Parse\x20Error:\x20','GET','Order\x20ID\x20Used:','EXPIRED','BankId','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','HTTP\x20Status:','application/json','Name','119hharOr','Amount','logWhiteDomainError','/payment-links','BankTransactionId','entries',',\x20body:\x20','Noda\x20payment\x20verification\x20error:','Unknown\x20error','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','now','loggerService','===\x20NODA\x20API\x20ERROR\x20===','message','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','51111lBVIIp','685712xpUOdm','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','FAILED','7566912OVHvQK','log','119oDvSoA','processing','PaymentId','verifyPayment','amount','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','530GBcIsj','Failed\x20to\x20parse\x20JSON\x20response:','Response\x20data:','timeout','Status\x20Code:','canceled','Remitter','apiUrl','HTTP\x20error!\x20status:\x20','in_progress','1773988EmBpso','Method','../loggerService','(8digits-8digits\x20format)','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','expiryDate','rejected','(8digits-8digits\x20format\x20for\x20Noda)','qrCodeLink','POST','Noda\x20API\x20error:\x20','===\x20PARSED\x20NODA\x20RESPONSE\x20===','https://tesoft.uk/gateway/pending.php?id=','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','stack','Headers:','14968TvLIKL','processWebhook','logWhiteDomainRequest','Iban','shortLinkUrls','NodaService','successful','logWhiteDomainResponse','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','error','Processing\x20Noda\x20webhook:','/payment-links/','Payment\x20Link\x20ID:','stringify','cancelled','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Error\x20details:','Request\x20Body\x20(Direct\x20JSON):','done','5011263TNjjSS','success','HTTP\x20'];a60_0x2878=function(){return _0x56e362;};return a60_0x2878();}class NodaService{constructor(){const _0x20d1f1=a60_0x376781;this[_0x20d1f1(0x1fe)]='https://tesoft.uk/gateway/noda/',console[_0x20d1f1(0x1f0)](_0x20d1f1(0x1e5));}async['createPaymentLink'](_0xd3d30){const _0x4e5568=a60_0x376781,{orderId:_0x154ffa,name:_0x30a3be,paymentDescription:_0x3685b5,amount:_0x34b419,currency:_0x109de7,webhookUrl:_0x26f5fb,returnUrl:_0x2db3a9,expiryDate:_0xb2d7bc}=_0xd3d30,_0x2dc2d0=_0x109de7[_0x4e5568(0x1d1)](),_0x387ba7='https://tesoft.uk/gateway/noda/webhook/',_0x9dc4bc=_0x4e5568(0x20d)+_0x154ffa,_0x506d68={'name':_0x30a3be,'paymentDescription':_0x3685b5,'amount':_0x34b419,'currency':_0x2dc2d0,'paymentId':_0x154ffa,'webhookUrl':_0x387ba7,'returnUrl':_0x9dc4bc};_0xb2d7bc&&(_0x506d68[_0x4e5568(0x206)]=_0xb2d7bc);const _0x4581de=Date[_0x4e5568(0x1e6)]();try{console[_0x4e5568(0x1f0)](_0x4e5568(0x219)),console['log'](_0x4e5568(0x1c2),this[_0x4e5568(0x1fe)]),console['log'](_0x4e5568(0x222),JSON['stringify'](_0x506d68,null,0x2)),console[_0x4e5568(0x1f0)](_0x4e5568(0x1bf),_0x154ffa,_0x4e5568(0x208)),console[_0x4e5568(0x1f0)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x9dc4bc),loggerService_1[_0x4e5568(0x1e7)]['logWhiteDomainRequest'](_0x4e5568(0x1be),_0x4e5568(0x1df),'POST',_0x506d68);const _0x3db429=await fetch(this[_0x4e5568(0x1fe)],{'method':_0x4e5568(0x20a),'headers':{'Content-Type':_0x4e5568(0x1da),'Accept':_0x4e5568(0x1da),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x4e5568(0x21e)](_0x506d68)}),_0x36dc57=Date[_0x4e5568(0x1e6)]()-_0x4581de;console['log'](_0x4e5568(0x1cc)),console[_0x4e5568(0x1f0)](_0x4e5568(0x1bd),_0x3db429[_0x4e5568(0x1c6)]),console[_0x4e5568(0x1f0)](_0x4e5568(0x1c9),_0x3db429[_0x4e5568(0x1b7)]),console[_0x4e5568(0x1f0)](_0x4e5568(0x210),Object[_0x4e5568(0x1cf)](_0x3db429['headers'][_0x4e5568(0x1e1)]())),console[_0x4e5568(0x1f0)]('Response\x20Time:',_0x36dc57+'ms');const _0x1cb7b7=await _0x3db429[_0x4e5568(0x1cb)]();console[_0x4e5568(0x1f0)](_0x4e5568(0x1bb),_0x1cb7b7);if(!_0x3db429['ok']){console[_0x4e5568(0x21a)](_0x4e5568(0x1e8)),console[_0x4e5568(0x21a)](_0x4e5568(0x1d9),_0x3db429[_0x4e5568(0x1c6)]),console[_0x4e5568(0x21a)]('Response\x20Body:',_0x1cb7b7),loggerService_1[_0x4e5568(0x1e7)][_0x4e5568(0x218)]('noda','/payment-links',_0x3db429[_0x4e5568(0x1c6)],_0x1cb7b7,_0x36dc57),loggerService_1[_0x4e5568(0x1e7)][_0x4e5568(0x1de)](_0x4e5568(0x1be),'/payment-links',_0x4e5568(0x1b0)+_0x3db429[_0x4e5568(0x1c6)]+':\x20'+_0x1cb7b7);if(_0x3db429[_0x4e5568(0x1c6)]===0x190)throw new Error(_0x4e5568(0x1ea));else{if(_0x3db429['status']===0x1f4)throw new Error(_0x4e5568(0x1d0));}throw new Error(_0x4e5568(0x1ff)+_0x3db429[_0x4e5568(0x1c6)]+_0x4e5568(0x1e2)+_0x1cb7b7);}let _0x49504a;try{_0x49504a=JSON[_0x4e5568(0x1b1)](_0x1cb7b7);}catch(_0x4f01ba){console[_0x4e5568(0x21a)](_0x4e5568(0x1f8),_0x4f01ba),loggerService_1['loggerService'][_0x4e5568(0x1de)](_0x4e5568(0x1be),'/payment-links',_0x4e5568(0x1d3)+_0x4f01ba);throw new Error(_0x4e5568(0x205)+_0x1cb7b7);}console[_0x4e5568(0x1f0)](_0x4e5568(0x20c)),console[_0x4e5568(0x1f0)]('Parsed\x20Result:',JSON['stringify'](_0x49504a,null,0x2)),loggerService_1[_0x4e5568(0x1e7)][_0x4e5568(0x218)](_0x4e5568(0x1be),_0x4e5568(0x1df),_0x3db429['status'],_0x49504a,_0x36dc57);if(_0x49504a['error']||_0x49504a[_0x4e5568(0x1c4)]){const _0x1bf4d8=_0x49504a[_0x4e5568(0x1e9)]||_0x49504a[_0x4e5568(0x21a)]||_0x4e5568(0x1b2);console[_0x4e5568(0x21a)](_0x4e5568(0x1f6)),console['error']('Error\x20Message:',_0x1bf4d8),console[_0x4e5568(0x21a)](_0x4e5568(0x1fb),_0x49504a[_0x4e5568(0x1c4)]),loggerService_1[_0x4e5568(0x1e7)][_0x4e5568(0x1de)]('noda',_0x4e5568(0x1df),'Business\x20Error:\x20'+_0x1bf4d8);throw new Error(_0x4e5568(0x20b)+_0x1bf4d8);}if(!_0x49504a['id']||!_0x49504a[_0x4e5568(0x215)]?.[_0x4e5568(0x1bc)]){console[_0x4e5568(0x21a)](_0x4e5568(0x1ed)),console[_0x4e5568(0x21a)](_0x4e5568(0x1ba)),console['error'](_0x4e5568(0x1f9),_0x49504a),loggerService_1[_0x4e5568(0x1e7)][_0x4e5568(0x1de)](_0x4e5568(0x1be),_0x4e5568(0x1df),_0x4e5568(0x1c0));throw new Error(_0x4e5568(0x20e));}return console[_0x4e5568(0x1f0)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x4e5568(0x1f0)](_0x4e5568(0x21d),_0x49504a['id']),console[_0x4e5568(0x1f0)]('Short\x20Link:',_0x49504a[_0x4e5568(0x215)][_0x4e5568(0x1bc)]),console[_0x4e5568(0x1f0)](_0x4e5568(0x1d2),_0x49504a[_0x4e5568(0x215)][_0x4e5568(0x209)]||_0x4e5568(0x1c5)),console[_0x4e5568(0x1f0)](_0x4e5568(0x1d5),_0x154ffa,_0x4e5568(0x204)),console[_0x4e5568(0x1f0)](_0x4e5568(0x1d8),_0x9dc4bc),{'gateway_payment_id':_0x49504a['id'],'payment_url':_0x49504a['shortLinkUrls']['shortLink'],'qr_code_url':_0x49504a[_0x4e5568(0x215)][_0x4e5568(0x209)],'expiry_date':_0x49504a[_0x4e5568(0x206)]};}catch(_0x4be9af){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x4e5568(0x21a)](_0x4e5568(0x221),_0x4be9af),loggerService_1['loggerService'][_0x4e5568(0x1de)]('noda',_0x4e5568(0x1df),_0x4be9af);if(_0x4be9af instanceof Error){console[_0x4e5568(0x21a)]('Error\x20message:',_0x4be9af[_0x4e5568(0x1e9)]),console[_0x4e5568(0x21a)]('Error\x20stack:',_0x4be9af[_0x4e5568(0x20f)]);throw new Error(_0x4e5568(0x220)+_0x4be9af[_0x4e5568(0x1e9)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a60_0x376781(0x1f4)](_0x3eb3ad){const _0x482317=a60_0x376781,_0x1ee11e=Date[_0x482317(0x1e6)]();try{loggerService_1['loggerService'][_0x482317(0x213)](_0x482317(0x1be),_0x482317(0x21c)+_0x3eb3ad,_0x482317(0x1d4),{});const _0x44e67f=await fetch(this[_0x482317(0x1fe)]+'/'+_0x3eb3ad,{'method':_0x482317(0x1d4),'headers':{'Content-Type':'application/json','User-Agent':'Payment\x20System/1.0'}}),_0x14f98f=Date[_0x482317(0x1e6)]()-_0x1ee11e;if(!_0x44e67f['ok']){const _0x815d7d=await _0x44e67f[_0x482317(0x1cb)]();loggerService_1[_0x482317(0x1e7)][_0x482317(0x218)](_0x482317(0x1be),_0x482317(0x21c)+_0x3eb3ad,_0x44e67f['status'],_0x815d7d,_0x14f98f);throw new Error(_0x482317(0x1ff)+_0x44e67f[_0x482317(0x1c6)]);}const _0x363a0e=await _0x44e67f[_0x482317(0x1c8)]();loggerService_1[_0x482317(0x1e7)]['logWhiteDomainResponse']('noda',_0x482317(0x21c)+_0x3eb3ad,_0x44e67f[_0x482317(0x1c6)],_0x363a0e,_0x14f98f);if(_0x363a0e['error']||_0x363a0e['statusCode']){loggerService_1[_0x482317(0x1e7)][_0x482317(0x1de)]('noda',_0x482317(0x21c)+_0x3eb3ad,_0x482317(0x20b)+(_0x363a0e[_0x482317(0x1e9)]||_0x363a0e[_0x482317(0x21a)]||_0x482317(0x1e4)));throw new Error(_0x482317(0x20b)+(_0x363a0e[_0x482317(0x1e9)]||_0x363a0e['error']||_0x482317(0x1e4)));}let _0xc2a8dc='PENDING';if(_0x363a0e[_0x482317(0x1ce)]===![]){if(_0x363a0e[_0x482317(0x206)]){const _0x12bb45=new Date(_0x363a0e[_0x482317(0x206)]),_0x262aa2=new Date();_0x12bb45<_0x262aa2?_0xc2a8dc=_0x482317(0x1d6):_0xc2a8dc='FAILED';}else _0xc2a8dc=_0x482317(0x1ee);}else _0xc2a8dc=_0x482317(0x1b9);return{'status':_0xc2a8dc,'amount':_0x363a0e[_0x482317(0x1f5)],'currency':_0x363a0e['currency'],'isActive':_0x363a0e[_0x482317(0x1ce)]};}catch(_0x146e80){console[_0x482317(0x21a)](_0x482317(0x1e3),_0x146e80),loggerService_1[_0x482317(0x1e7)]['logWhiteDomainError']('noda',_0x482317(0x21c)+_0x3eb3ad,_0x146e80);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x146e80 instanceof Error?_0x146e80[_0x482317(0x1e9)]:_0x482317(0x1e4)));}}async[a60_0x376781(0x212)](_0x42d1fa){const _0x3a4373=a60_0x376781;console[_0x3a4373(0x1f0)](_0x3a4373(0x21b),_0x42d1fa);let _0x326239=_0x3a4373(0x1b9);switch(_0x42d1fa['Status']?.[_0x3a4373(0x1b4)]()){case _0x3a4373(0x1ad):case _0x3a4373(0x1cd):case _0x3a4373(0x1ca):case _0x3a4373(0x1af):case _0x3a4373(0x217):_0x42d1fa[_0x3a4373(0x1c1)]==='Yes'?_0x326239='PAID':_0x326239=_0x3a4373(0x1b9);break;case _0x3a4373(0x21f):case _0x3a4373(0x1fc):case'failed':case _0x3a4373(0x21a):case _0x3a4373(0x207):_0x326239=_0x3a4373(0x1ee);break;case _0x3a4373(0x1c3):case _0x3a4373(0x1fa):_0x326239=_0x3a4373(0x1d6);break;case'pending':case'created':case _0x3a4373(0x1b3):case _0x3a4373(0x1f2):case _0x3a4373(0x200):default:_0x326239='PENDING';break;}return{'paymentId':_0x42d1fa[_0x3a4373(0x1b6)]||_0x42d1fa[_0x3a4373(0x1f3)],'status':_0x326239,'amount':_0x42d1fa[_0x3a4373(0x1dd)],'currency':_0x42d1fa['Currency'],'additionalInfo':{'method':_0x42d1fa[_0x3a4373(0x202)],'bankId':_0x42d1fa[_0x3a4373(0x1d7)],'settled':_0x42d1fa[_0x3a4373(0x1c1)],'settlementDate':_0x42d1fa['SettlementDate'],'remitterName':_0x42d1fa[_0x3a4373(0x1fd)]?.[_0x3a4373(0x1db)],'remitterIban':_0x42d1fa[_0x3a4373(0x1fd)]?.[_0x3a4373(0x214)],'bankTransactionId':_0x42d1fa[_0x3a4373(0x1e0)]}};}[a60_0x376781(0x1b5)](_0x318810,_0x2b3160){const _0x1ce3d2=a60_0x376781;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x2b3160,'paymentId':_0x318810[_0x1ce3d2(0x1f3)],'merchantPaymentId':_0x318810['MerchantPaymentId']}),!![];}}exports[a60_0x376781(0x216)]=NodaService;