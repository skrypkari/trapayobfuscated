'use strict';const a44_0x245401=a44_0x38ab;(function(_0x3cd0c9,_0x2a79ea){const _0x57a7e9=a44_0x38ab,_0xd74d0f=_0x3cd0c9();while(!![]){try{const _0x365969=parseInt(_0x57a7e9(0x1ef))/0x1*(parseInt(_0x57a7e9(0x1f3))/0x2)+parseInt(_0x57a7e9(0x24d))/0x3*(-parseInt(_0x57a7e9(0x250))/0x4)+-parseInt(_0x57a7e9(0x228))/0x5+-parseInt(_0x57a7e9(0x1eb))/0x6*(-parseInt(_0x57a7e9(0x216))/0x7)+parseInt(_0x57a7e9(0x210))/0x8*(parseInt(_0x57a7e9(0x22f))/0x9)+-parseInt(_0x57a7e9(0x226))/0xa*(-parseInt(_0x57a7e9(0x22b))/0xb)+-parseInt(_0x57a7e9(0x213))/0xc;if(_0x365969===_0x2a79ea)break;else _0xd74d0f['push'](_0xd74d0f['shift']());}catch(_0x65f4d3){_0xd74d0f['push'](_0xd74d0f['shift']());}}}(a44_0x35cf,0x21a44));Object[a44_0x245401(0x265)](exports,a44_0x245401(0x241),{'value':!![]}),exports[a44_0x245401(0x246)]=void 0x0;const loggerService_1=require(a44_0x245401(0x21e));class NodaService{constructor(){const _0x2691a4=a44_0x245401;this[_0x2691a4(0x25c)]=_0x2691a4(0x236),console[_0x2691a4(0x239)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a44_0x245401(0x256)](_0x2120ee){const _0x391dbd=a44_0x245401,{orderId:_0x26b1bb,name:_0x4cf98f,paymentDescription:_0x20e502,amount:_0x4428fa,currency:_0x433486,webhookUrl:_0x1fbafd,returnUrl:_0x359d39,expiryDate:_0xf03a7}=_0x2120ee,_0x445aca=_0x433486[_0x391dbd(0x240)](),_0xd75566='https://tesoft.uk/gateway/noda/webhook/',_0x1df7e8=_0x391dbd(0x202)+_0x26b1bb,_0x358b1b={'name':_0x4cf98f,'paymentDescription':_0x20e502,'amount':_0x4428fa,'currency':_0x445aca,'paymentId':_0x26b1bb,'webhookUrl':_0xd75566,'returnUrl':_0x1df7e8};_0xf03a7&&(_0x358b1b[_0x391dbd(0x1ee)]=_0xf03a7);const _0x2b343d=Date['now']();try{console[_0x391dbd(0x239)](_0x391dbd(0x260)),console['log'](_0x391dbd(0x1f6),this[_0x391dbd(0x25c)]),console[_0x391dbd(0x239)](_0x391dbd(0x23c),JSON[_0x391dbd(0x25e)](_0x358b1b,null,0x2)),console[_0x391dbd(0x239)](_0x391dbd(0x23e),_0x26b1bb,_0x391dbd(0x209)),console[_0x391dbd(0x239)](_0x391dbd(0x24a),_0x1df7e8),loggerService_1[_0x391dbd(0x22d)][_0x391dbd(0x237)](_0x391dbd(0x1ea),_0x391dbd(0x25b),_0x391dbd(0x238),_0x358b1b);const _0xec2bcd=await fetch(this[_0x391dbd(0x25c)],{'method':_0x391dbd(0x238),'headers':{'Content-Type':_0x391dbd(0x203),'Accept':'application/json','User-Agent':_0x391dbd(0x1ed)},'body':JSON[_0x391dbd(0x25e)](_0x358b1b)}),_0x2f138c=Date['now']()-_0x2b343d;console['log'](_0x391dbd(0x229)),console[_0x391dbd(0x239)](_0x391dbd(0x20a),_0xec2bcd[_0x391dbd(0x23d)]),console[_0x391dbd(0x239)](_0x391dbd(0x23a),_0xec2bcd[_0x391dbd(0x1fe)]),console[_0x391dbd(0x239)](_0x391dbd(0x211),Object[_0x391dbd(0x223)](_0xec2bcd[_0x391dbd(0x21d)][_0x391dbd(0x24f)]())),console[_0x391dbd(0x239)](_0x391dbd(0x247),_0x2f138c+'ms');const _0x4ca2e4=await _0xec2bcd[_0x391dbd(0x1ff)]();console[_0x391dbd(0x239)]('Raw\x20Response\x20Body:',_0x4ca2e4);if(!_0xec2bcd['ok']){console[_0x391dbd(0x1f4)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x391dbd(0x1f4)](_0x391dbd(0x22e),_0xec2bcd[_0x391dbd(0x23d)]),console[_0x391dbd(0x1f4)](_0x391dbd(0x1ec),_0x4ca2e4),loggerService_1[_0x391dbd(0x22d)][_0x391dbd(0x217)](_0x391dbd(0x1ea),_0x391dbd(0x25b),_0xec2bcd[_0x391dbd(0x23d)],_0x4ca2e4,_0x2f138c),loggerService_1[_0x391dbd(0x22d)][_0x391dbd(0x215)]('noda',_0x391dbd(0x25b),'HTTP\x20'+_0xec2bcd[_0x391dbd(0x23d)]+':\x20'+_0x4ca2e4);if(_0xec2bcd[_0x391dbd(0x23d)]===0x190)throw new Error(_0x391dbd(0x21b));else{if(_0xec2bcd[_0x391dbd(0x23d)]===0x1f4)throw new Error(_0x391dbd(0x253));}throw new Error(_0x391dbd(0x220)+_0xec2bcd['status']+_0x391dbd(0x233)+_0x4ca2e4);}let _0x18d8ad;try{_0x18d8ad=JSON['parse'](_0x4ca2e4);}catch(_0x2fdd6a){console[_0x391dbd(0x1f4)](_0x391dbd(0x23b),_0x2fdd6a),loggerService_1[_0x391dbd(0x22d)]['logWhiteDomainError']('noda',_0x391dbd(0x25b),_0x391dbd(0x21f)+_0x2fdd6a);throw new Error(_0x391dbd(0x1fd)+_0x4ca2e4);}console[_0x391dbd(0x239)](_0x391dbd(0x263)),console[_0x391dbd(0x239)](_0x391dbd(0x204),JSON[_0x391dbd(0x25e)](_0x18d8ad,null,0x2)),loggerService_1[_0x391dbd(0x22d)][_0x391dbd(0x217)](_0x391dbd(0x1ea),_0x391dbd(0x25b),_0xec2bcd[_0x391dbd(0x23d)],_0x18d8ad,_0x2f138c);if(_0x18d8ad[_0x391dbd(0x1f4)]||_0x18d8ad[_0x391dbd(0x264)]){const _0x1925d1=_0x18d8ad[_0x391dbd(0x219)]||_0x18d8ad[_0x391dbd(0x1f4)]||'Unknown\x20error\x20from\x20Noda\x20API';console['error'](_0x391dbd(0x1fb)),console['error'](_0x391dbd(0x254),_0x1925d1),console['error'](_0x391dbd(0x218),_0x18d8ad['statusCode']),loggerService_1[_0x391dbd(0x22d)][_0x391dbd(0x215)](_0x391dbd(0x1ea),_0x391dbd(0x25b),_0x391dbd(0x214)+_0x1925d1);throw new Error(_0x391dbd(0x262)+_0x1925d1);}if(!_0x18d8ad['id']||!_0x18d8ad[_0x391dbd(0x257)]?.[_0x391dbd(0x242)]){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x391dbd(0x1f4)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x391dbd(0x1f4)](_0x391dbd(0x20f),_0x18d8ad),loggerService_1[_0x391dbd(0x22d)][_0x391dbd(0x215)](_0x391dbd(0x1ea),_0x391dbd(0x25b),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x391dbd(0x239)](_0x391dbd(0x20e)),console[_0x391dbd(0x239)](_0x391dbd(0x232),_0x18d8ad['id']),console[_0x391dbd(0x239)](_0x391dbd(0x24b),_0x18d8ad[_0x391dbd(0x257)]['shortLink']),console[_0x391dbd(0x239)]('QR\x20Code\x20Link:',_0x18d8ad[_0x391dbd(0x257)]['qrCodeLink']||_0x391dbd(0x1f9)),console[_0x391dbd(0x239)](_0x391dbd(0x1f7),_0x26b1bb,_0x391dbd(0x25a)),console[_0x391dbd(0x239)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x1df7e8),{'gateway_payment_id':_0x18d8ad['id'],'payment_url':_0x18d8ad[_0x391dbd(0x257)][_0x391dbd(0x242)],'qr_code_url':_0x18d8ad[_0x391dbd(0x257)][_0x391dbd(0x251)],'expiry_date':_0x18d8ad[_0x391dbd(0x1ee)]};}catch(_0x27e666){console[_0x391dbd(0x1f4)](_0x391dbd(0x20c)),console[_0x391dbd(0x1f4)](_0x391dbd(0x224),_0x27e666),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x391dbd(0x25b),_0x27e666);if(_0x27e666 instanceof Error){console[_0x391dbd(0x1f4)]('Error\x20message:',_0x27e666[_0x391dbd(0x219)]),console[_0x391dbd(0x1f4)](_0x391dbd(0x1f1),_0x27e666[_0x391dbd(0x200)]);throw new Error(_0x391dbd(0x25f)+_0x27e666[_0x391dbd(0x219)]);}throw new Error(_0x391dbd(0x24c));}}async[a44_0x245401(0x243)](_0x3c11c6){const _0x4a178f=a44_0x245401,_0x209d49=Date[_0x4a178f(0x221)]();try{loggerService_1[_0x4a178f(0x22d)][_0x4a178f(0x237)](_0x4a178f(0x1ea),_0x4a178f(0x1f2)+_0x3c11c6,'GET',{});const _0x188fb2=await fetch(this[_0x4a178f(0x25c)]+'/'+_0x3c11c6,{'method':_0x4a178f(0x268),'headers':{'Content-Type':_0x4a178f(0x203),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x37fc66=Date['now']()-_0x209d49;if(!_0x188fb2['ok']){const _0x5df9b6=await _0x188fb2['text']();loggerService_1[_0x4a178f(0x22d)][_0x4a178f(0x217)]('noda',_0x4a178f(0x1f2)+_0x3c11c6,_0x188fb2['status'],_0x5df9b6,_0x37fc66);throw new Error(_0x4a178f(0x220)+_0x188fb2[_0x4a178f(0x23d)]);}const _0x209031=await _0x188fb2[_0x4a178f(0x24e)]();loggerService_1[_0x4a178f(0x22d)][_0x4a178f(0x217)](_0x4a178f(0x1ea),_0x4a178f(0x1f2)+_0x3c11c6,_0x188fb2[_0x4a178f(0x23d)],_0x209031,_0x37fc66);if(_0x209031[_0x4a178f(0x1f4)]||_0x209031['statusCode']){loggerService_1[_0x4a178f(0x22d)][_0x4a178f(0x215)](_0x4a178f(0x1ea),'/payment-links/'+_0x3c11c6,_0x4a178f(0x262)+(_0x209031[_0x4a178f(0x219)]||_0x209031[_0x4a178f(0x1f4)]||_0x4a178f(0x20b)));throw new Error(_0x4a178f(0x262)+(_0x209031['message']||_0x209031['error']||_0x4a178f(0x20b)));}let _0x7fff1d=_0x4a178f(0x1fc);if(_0x209031['isActive']===![]){if(_0x209031[_0x4a178f(0x1ee)]){const _0xd5403c=new Date(_0x209031[_0x4a178f(0x1ee)]),_0x30fff5=new Date();_0xd5403c<_0x30fff5?_0x7fff1d=_0x4a178f(0x227):_0x7fff1d=_0x4a178f(0x205);}else _0x7fff1d='FAILED';}else _0x7fff1d='PENDING';return{'status':_0x7fff1d,'amount':_0x209031[_0x4a178f(0x20d)],'currency':_0x209031['currency'],'isActive':_0x209031[_0x4a178f(0x249)]};}catch(_0x4e03e2){console[_0x4a178f(0x1f4)](_0x4a178f(0x21a),_0x4e03e2),loggerService_1[_0x4a178f(0x22d)][_0x4a178f(0x215)](_0x4a178f(0x1ea),_0x4a178f(0x1f2)+_0x3c11c6,_0x4e03e2);throw new Error(_0x4a178f(0x22c)+(_0x4e03e2 instanceof Error?_0x4e03e2['message']:_0x4a178f(0x20b)));}}async[a44_0x245401(0x1f8)](_0x22b26b){const _0x1e7e59=a44_0x245401;console[_0x1e7e59(0x239)]('Processing\x20Noda\x20webhook:',_0x22b26b);let _0x46252b=_0x1e7e59(0x1fc);switch(_0x22b26b[_0x1e7e59(0x225)]?.[_0x1e7e59(0x258)]()){case _0x1e7e59(0x259):case _0x1e7e59(0x25d):case'paid':case _0x1e7e59(0x1f0):case _0x1e7e59(0x201):_0x22b26b[_0x1e7e59(0x266)]===_0x1e7e59(0x255)?_0x46252b=_0x1e7e59(0x234):_0x46252b='PENDING';break;case'cancelled':case _0x1e7e59(0x208):case _0x1e7e59(0x244):case _0x1e7e59(0x1f4):case _0x1e7e59(0x222):_0x46252b=_0x1e7e59(0x205);break;case _0x1e7e59(0x231):case _0x1e7e59(0x248):_0x46252b=_0x1e7e59(0x227);break;case _0x1e7e59(0x21c):case'created':case _0x1e7e59(0x212):case _0x1e7e59(0x235):case _0x1e7e59(0x261):default:_0x46252b=_0x1e7e59(0x1fc);break;}return{'paymentId':_0x22b26b[_0x1e7e59(0x245)]||_0x22b26b['PaymentId'],'status':_0x46252b,'amount':_0x22b26b[_0x1e7e59(0x1f5)],'currency':_0x22b26b[_0x1e7e59(0x1fa)],'additionalInfo':{'method':_0x22b26b[_0x1e7e59(0x230)],'bankId':_0x22b26b[_0x1e7e59(0x22a)],'settled':_0x22b26b[_0x1e7e59(0x266)],'settlementDate':_0x22b26b['SettlementDate'],'remitterName':_0x22b26b[_0x1e7e59(0x252)]?.[_0x1e7e59(0x206)],'remitterIban':_0x22b26b[_0x1e7e59(0x252)]?.[_0x1e7e59(0x23f)],'bankTransactionId':_0x22b26b[_0x1e7e59(0x207)]}};}[a44_0x245401(0x267)](_0x3c6005,_0x2c3a63){const _0x486edb=a44_0x245401;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x2c3a63,'paymentId':_0x3c6005['PaymentId'],'merchantPaymentId':_0x3c6005[_0x486edb(0x245)]}),!![];}}function a44_0x38ab(_0x589db0,_0x8ee7d9){const _0x35cf6b=a44_0x35cf();return a44_0x38ab=function(_0x38abf0,_0x59e6f7){_0x38abf0=_0x38abf0-0x1ea;let _0x584759=_0x35cf6b[_0x38abf0];return _0x584759;},a44_0x38ab(_0x589db0,_0x8ee7d9);}exports[a44_0x245401(0x246)]=NodaService;function a44_0x35cf(){const _0x5aa943=['/payment-links/','43874tulBAf','error','Amount','URL:','Order\x20ID\x20Used:','processWebhook','Not\x20provided','Currency','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','PENDING','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','statusText','text','stack','successful','https://tesoft.uk/gateway/pending.php?id=','application/json','Parsed\x20Result:','FAILED','Name','BankTransactionId','canceled','(8digits-8digits\x20format\x20for\x20Noda)','Status:','Unknown\x20error','===\x20NODA\x20SERVICE\x20ERROR\x20===','amount','===\x20NODA\x20SUCCESS\x20===','Response\x20data:','184nOljxW','Headers:','active','3383028hkmnHL','Business\x20Error:\x20','logWhiteDomainError','5362LFSybC','logWhiteDomainResponse','Status\x20Code:','message','Noda\x20payment\x20verification\x20error:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','pending','headers','../loggerService','JSON\x20Parse\x20Error:\x20','HTTP\x20error!\x20status:\x20','now','rejected','fromEntries','Error\x20details:','Status','10izJjrQ','EXPIRED','297265ufjiJy','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','BankId','23639PPMdYo','Failed\x20to\x20verify\x20Noda\x20payment:\x20','loggerService','HTTP\x20Status:','94626DkLNgm','Method','expired','Payment\x20Link\x20ID:',',\x20body:\x20','PAID','processing','https://tesoft.uk/gateway/noda/','logWhiteDomainRequest','POST','log','Status\x20Text:','Failed\x20to\x20parse\x20JSON\x20response:','Request\x20Body\x20(Direct\x20JSON):','status','Order\x20ID\x20Format:','Iban','toUpperCase','__esModule','shortLink','verifyPayment','failed','MerchantPaymentId','NodaService','Response\x20Time:','timeout','isActive','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Short\x20Link:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','6rJdLEA','json','entries','531568WydOvQ','qrCodeLink','Remitter','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Error\x20Message:','Yes','createPaymentLink','shortLinkUrls','toLowerCase','done','(8digits-8digits\x20format)','/payment-links','apiUrl','completed','stringify','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','in_progress','Noda\x20API\x20error:\x20','===\x20PARSED\x20NODA\x20RESPONSE\x20===','statusCode','defineProperty','Settled','verifyWebhookSignature','GET','noda','2034vOTcLs','Response\x20Body:','TesSoft\x20Payment\x20System/1.0','expiryDate','11SoKNuk','success','Error\x20stack:'];a44_0x35cf=function(){return _0x5aa943;};return a44_0x35cf();}