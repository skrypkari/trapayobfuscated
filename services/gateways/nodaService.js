'use strict';const a51_0x1766ac=a51_0x2261;function a51_0x1a97(){const _0x32d896=['(8digits-8digits\x20format)','Unknown\x20error\x20from\x20Noda\x20API','Iban','HTTP\x20error!\x20status:\x20','FAILED','currency','Response\x20Time:','42GVRWHg','540844ZcTzJl','PENDING','text','Method','rejected','headers','JSON\x20Parse\x20Error:\x20','1343015ZJRdYn','json','690fjnTRk','Headers:','pending','Business\x20Error:\x20','status','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','MerchantPaymentId','Processing\x20Noda\x20webhook:','cancelled','EXPIRED','../loggerService','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','paid','Settled','logWhiteDomainRequest','/payment-links/','Order\x20ID\x20Format:','entries','done','1211bMSlEn','BankId','verifyPayment','defineProperty','success','Status\x20Code:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Status:','Error\x20details:','992hjKnea','Short\x20Link:','expiryDate','Response\x20Body:','processWebhook','Payment\x20System/1.0','===\x20NODA\x20SERVICE\x20ERROR\x20===','Response\x20data:','application/json',',\x20body:\x20','stringify','noda','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','statusText','Failed\x20to\x20verify\x20Noda\x20payment:\x20','5099625IlmAEm','Unknown\x20error','Remitter','Failed\x20to\x20parse\x20JSON\x20response:','240757WDFfDh','Error\x20stack:','isActive','1150482IzejNv','===\x20NODA\x20API\x20ERROR\x20===','3gQUxFg','Noda\x20webhook\x20signature\x20verification:','in_progress','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Noda\x20payment\x20verification\x20error:','PAID','/payment-links','shortLink','Noda\x20API\x20error:\x20','loggerService','BankTransactionId','__esModule','SettlementDate','fromEntries','apiUrl','stack','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','statusCode','Parsed\x20Result:','Raw\x20Response\x20Body:','Error\x20Message:','37982qITFlr','logWhiteDomainError','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','(8digits-8digits\x20format\x20for\x20Noda)','https://tesoft.uk/gateway/noda/webhook/','Yes','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','GET','message','error','completed','shortLinkUrls','processing','toLowerCase','NodaService','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','POST','now','Error\x20message:','URL:','logWhiteDomainResponse','createPaymentLink','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','log'];a51_0x1a97=function(){return _0x32d896;};return a51_0x1a97();}(function(_0x49651f,_0x3de0fd){const _0x183d07=a51_0x2261,_0x1adbd9=_0x49651f();while(!![]){try{const _0x37336b=-parseInt(_0x183d07(0x112))/0x1*(-parseInt(_0x183d07(0x167))/0x2)+-parseInt(_0x183d07(0x133))/0x3*(-parseInt(_0x183d07(0x168))/0x4)+-parseInt(_0x183d07(0x16f))/0x5+parseInt(_0x183d07(0x131))/0x6+parseInt(_0x183d07(0x148))/0x7*(-parseInt(_0x183d07(0x11b))/0x8)+-parseInt(_0x183d07(0x12a))/0x9+parseInt(_0x183d07(0x171))/0xa*(parseInt(_0x183d07(0x12e))/0xb);if(_0x37336b===_0x3de0fd)break;else _0x1adbd9['push'](_0x1adbd9['shift']());}catch(_0x1a5f25){_0x1adbd9['push'](_0x1adbd9['shift']());}}}(a51_0x1a97,0x568ec));Object[a51_0x1766ac(0x115)](exports,a51_0x1766ac(0x13e),{'value':!![]}),exports[a51_0x1766ac(0x156)]=void 0x0;function a51_0x2261(_0xf4a487,_0x34f573){const _0x1a97d5=a51_0x1a97();return a51_0x2261=function(_0x22617b,_0x4ac162){_0x22617b=_0x22617b-0x102;let _0x525b4c=_0x1a97d5[_0x22617b];return _0x525b4c;},a51_0x2261(_0xf4a487,_0x34f573);}const loggerService_1=require(a51_0x1766ac(0x109));class NodaService{constructor(){const _0x1b6287=a51_0x1766ac;this['apiUrl']='https://tesoft.uk/gateway/noda/',console[_0x1b6287(0x15f)](_0x1b6287(0x104));}async[a51_0x1766ac(0x15d)](_0x3f0198){const _0x530dc4=a51_0x1766ac,{orderId:_0x1c84c4,name:_0x21e4c6,paymentDescription:_0x4c38fb,amount:_0x480210,currency:_0x175998,webhookUrl:_0xab17f3,returnUrl:_0x3fcb3b,expiryDate:_0x538e4b}=_0x3f0198,_0x40e777=_0x175998['toUpperCase'](),_0x836b65=_0x530dc4(0x14c),_0x386634='https://tesoft.uk/gateway/pending.php?id='+_0x1c84c4,_0x42d488={'name':_0x21e4c6,'paymentDescription':_0x4c38fb,'amount':_0x480210,'currency':_0x40e777,'paymentId':_0x1c84c4,'webhookUrl':_0x836b65,'returnUrl':_0x386634};_0x538e4b&&(_0x42d488[_0x530dc4(0x11d)]=_0x538e4b);const _0x1e13f0=Date[_0x530dc4(0x159)]();try{console['log'](_0x530dc4(0x143)),console[_0x530dc4(0x15f)](_0x530dc4(0x15b),this[_0x530dc4(0x141)]),console[_0x530dc4(0x15f)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x530dc4(0x125)](_0x42d488,null,0x2)),console['log'](_0x530dc4(0x10f),_0x1c84c4,_0x530dc4(0x14b)),console['log'](_0x530dc4(0x14a),_0x386634),loggerService_1[_0x530dc4(0x13c)]['logWhiteDomainRequest']('noda','/payment-links',_0x530dc4(0x158),_0x42d488);const _0x987dd0=await fetch(this['apiUrl'],{'method':_0x530dc4(0x158),'headers':{'Content-Type':_0x530dc4(0x123),'Accept':_0x530dc4(0x123),'User-Agent':_0x530dc4(0x120)},'body':JSON[_0x530dc4(0x125)](_0x42d488)}),_0x5a44b6=Date[_0x530dc4(0x159)]()-_0x1e13f0;console[_0x530dc4(0x15f)](_0x530dc4(0x10a)),console['log'](_0x530dc4(0x119),_0x987dd0[_0x530dc4(0x103)]),console[_0x530dc4(0x15f)]('Status\x20Text:',_0x987dd0[_0x530dc4(0x128)]),console['log'](_0x530dc4(0x172),Object[_0x530dc4(0x140)](_0x987dd0[_0x530dc4(0x16d)][_0x530dc4(0x110)]())),console['log'](_0x530dc4(0x166),_0x5a44b6+'ms');const _0xaf58c1=await _0x987dd0[_0x530dc4(0x16a)]();console[_0x530dc4(0x15f)](_0x530dc4(0x146),_0xaf58c1);if(!_0x987dd0['ok']){console[_0x530dc4(0x151)](_0x530dc4(0x132)),console[_0x530dc4(0x151)]('HTTP\x20Status:',_0x987dd0[_0x530dc4(0x103)]),console[_0x530dc4(0x151)](_0x530dc4(0x11e),_0xaf58c1),loggerService_1[_0x530dc4(0x13c)][_0x530dc4(0x15c)](_0x530dc4(0x126),_0x530dc4(0x139),_0x987dd0['status'],_0xaf58c1,_0x5a44b6),loggerService_1[_0x530dc4(0x13c)]['logWhiteDomainError'](_0x530dc4(0x126),_0x530dc4(0x139),'HTTP\x20'+_0x987dd0[_0x530dc4(0x103)]+':\x20'+_0xaf58c1);if(_0x987dd0['status']===0x190)throw new Error(_0x530dc4(0x157));else{if(_0x987dd0[_0x530dc4(0x103)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x530dc4(0x163)+_0x987dd0[_0x530dc4(0x103)]+_0x530dc4(0x124)+_0xaf58c1);}let _0x51af56;try{_0x51af56=JSON['parse'](_0xaf58c1);}catch(_0x38ae9a){console[_0x530dc4(0x151)](_0x530dc4(0x12d),_0x38ae9a),loggerService_1[_0x530dc4(0x13c)]['logWhiteDomainError'](_0x530dc4(0x126),_0x530dc4(0x139),_0x530dc4(0x16e)+_0x38ae9a);throw new Error(_0x530dc4(0x15e)+_0xaf58c1);}console[_0x530dc4(0x15f)](_0x530dc4(0x118)),console[_0x530dc4(0x15f)](_0x530dc4(0x145),JSON[_0x530dc4(0x125)](_0x51af56,null,0x2)),loggerService_1[_0x530dc4(0x13c)]['logWhiteDomainResponse'](_0x530dc4(0x126),_0x530dc4(0x139),_0x987dd0[_0x530dc4(0x103)],_0x51af56,_0x5a44b6);if(_0x51af56[_0x530dc4(0x151)]||_0x51af56[_0x530dc4(0x144)]){const _0xac5b57=_0x51af56[_0x530dc4(0x150)]||_0x51af56[_0x530dc4(0x151)]||_0x530dc4(0x161);console['error'](_0x530dc4(0x136)),console['error'](_0x530dc4(0x147),_0xac5b57),console[_0x530dc4(0x151)](_0x530dc4(0x117),_0x51af56[_0x530dc4(0x144)]),loggerService_1['loggerService'][_0x530dc4(0x149)](_0x530dc4(0x126),_0x530dc4(0x139),_0x530dc4(0x102)+_0xac5b57);throw new Error(_0x530dc4(0x13b)+_0xac5b57);}if(!_0x51af56['id']||!_0x51af56[_0x530dc4(0x153)]?.[_0x530dc4(0x13a)]){console[_0x530dc4(0x151)](_0x530dc4(0x127)),console[_0x530dc4(0x151)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x530dc4(0x151)](_0x530dc4(0x122),_0x51af56),loggerService_1['loggerService'][_0x530dc4(0x149)]('noda',_0x530dc4(0x139),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x530dc4(0x14e));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console['log']('Payment\x20Link\x20ID:',_0x51af56['id']),console[_0x530dc4(0x15f)](_0x530dc4(0x11c),_0x51af56[_0x530dc4(0x153)][_0x530dc4(0x13a)]),console[_0x530dc4(0x15f)]('QR\x20Code\x20Link:',_0x51af56[_0x530dc4(0x153)]['qrCodeLink']||'Not\x20provided'),console[_0x530dc4(0x15f)]('Order\x20ID\x20Used:',_0x1c84c4,_0x530dc4(0x160)),console[_0x530dc4(0x15f)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x386634),{'gateway_payment_id':_0x51af56['id'],'payment_url':_0x51af56['shortLinkUrls'][_0x530dc4(0x13a)],'qr_code_url':_0x51af56[_0x530dc4(0x153)]['qrCodeLink'],'expiry_date':_0x51af56[_0x530dc4(0x11d)]};}catch(_0x2b4554){console[_0x530dc4(0x151)](_0x530dc4(0x121)),console[_0x530dc4(0x151)](_0x530dc4(0x11a),_0x2b4554),loggerService_1[_0x530dc4(0x13c)][_0x530dc4(0x149)]('noda',_0x530dc4(0x139),_0x2b4554);if(_0x2b4554 instanceof Error){console[_0x530dc4(0x151)](_0x530dc4(0x15a),_0x2b4554['message']),console[_0x530dc4(0x151)](_0x530dc4(0x12f),_0x2b4554[_0x530dc4(0x142)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x2b4554[_0x530dc4(0x150)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a51_0x1766ac(0x114)](_0x1c6dd3){const _0x34c029=a51_0x1766ac,_0x278484=Date[_0x34c029(0x159)]();try{loggerService_1[_0x34c029(0x13c)][_0x34c029(0x10d)](_0x34c029(0x126),'/payment-links/'+_0x1c6dd3,'GET',{});const _0x3b9e3c=await fetch(this[_0x34c029(0x141)]+'/'+_0x1c6dd3,{'method':_0x34c029(0x14f),'headers':{'Content-Type':_0x34c029(0x123),'User-Agent':_0x34c029(0x120)}}),_0x3ed590=Date[_0x34c029(0x159)]()-_0x278484;if(!_0x3b9e3c['ok']){const _0xf733b8=await _0x3b9e3c[_0x34c029(0x16a)]();loggerService_1[_0x34c029(0x13c)][_0x34c029(0x15c)](_0x34c029(0x126),_0x34c029(0x10e)+_0x1c6dd3,_0x3b9e3c['status'],_0xf733b8,_0x3ed590);throw new Error(_0x34c029(0x163)+_0x3b9e3c[_0x34c029(0x103)]);}const _0x4cf01a=await _0x3b9e3c[_0x34c029(0x170)]();loggerService_1[_0x34c029(0x13c)][_0x34c029(0x15c)](_0x34c029(0x126),_0x34c029(0x10e)+_0x1c6dd3,_0x3b9e3c[_0x34c029(0x103)],_0x4cf01a,_0x3ed590);if(_0x4cf01a['error']||_0x4cf01a[_0x34c029(0x144)]){loggerService_1[_0x34c029(0x13c)][_0x34c029(0x149)](_0x34c029(0x126),'/payment-links/'+_0x1c6dd3,_0x34c029(0x13b)+(_0x4cf01a[_0x34c029(0x150)]||_0x4cf01a[_0x34c029(0x151)]||'Unknown\x20error'));throw new Error(_0x34c029(0x13b)+(_0x4cf01a[_0x34c029(0x150)]||_0x4cf01a[_0x34c029(0x151)]||_0x34c029(0x12b)));}let _0x3ccd6f=_0x34c029(0x169);if(_0x4cf01a['isActive']===![]){if(_0x4cf01a['expiryDate']){const _0x471cb6=new Date(_0x4cf01a['expiryDate']),_0x5e21ca=new Date();_0x471cb6<_0x5e21ca?_0x3ccd6f=_0x34c029(0x108):_0x3ccd6f=_0x34c029(0x164);}else _0x3ccd6f='FAILED';}else _0x3ccd6f=_0x34c029(0x169);return{'status':_0x3ccd6f,'amount':_0x4cf01a['amount'],'currency':_0x4cf01a[_0x34c029(0x165)],'isActive':_0x4cf01a[_0x34c029(0x130)]};}catch(_0x435057){console[_0x34c029(0x151)](_0x34c029(0x137),_0x435057),loggerService_1[_0x34c029(0x13c)][_0x34c029(0x149)](_0x34c029(0x126),_0x34c029(0x10e)+_0x1c6dd3,_0x435057);throw new Error(_0x34c029(0x129)+(_0x435057 instanceof Error?_0x435057[_0x34c029(0x150)]:_0x34c029(0x12b)));}}async[a51_0x1766ac(0x11f)](_0x4576c3){const _0x4c862d=a51_0x1766ac;console[_0x4c862d(0x15f)](_0x4c862d(0x106),_0x4576c3);let _0x367d67=_0x4c862d(0x169);switch(_0x4576c3['Status']?.[_0x4c862d(0x155)]()){case _0x4c862d(0x111):case _0x4c862d(0x152):case _0x4c862d(0x10b):case _0x4c862d(0x116):case'successful':_0x4576c3[_0x4c862d(0x10c)]===_0x4c862d(0x14d)?_0x367d67=_0x4c862d(0x138):_0x367d67=_0x4c862d(0x169);break;case _0x4c862d(0x107):case'canceled':case'failed':case'error':case _0x4c862d(0x16c):_0x367d67=_0x4c862d(0x164);break;case'expired':case'timeout':_0x367d67='EXPIRED';break;case _0x4c862d(0x173):case'created':case'active':case _0x4c862d(0x154):case _0x4c862d(0x135):default:_0x367d67='PENDING';break;}return{'paymentId':_0x4576c3[_0x4c862d(0x105)]||_0x4576c3['PaymentId'],'status':_0x367d67,'amount':_0x4576c3['Amount'],'currency':_0x4576c3['Currency'],'additionalInfo':{'method':_0x4576c3[_0x4c862d(0x16b)],'bankId':_0x4576c3[_0x4c862d(0x113)],'settled':_0x4576c3[_0x4c862d(0x10c)],'settlementDate':_0x4576c3[_0x4c862d(0x13f)],'remitterName':_0x4576c3[_0x4c862d(0x12c)]?.['Name'],'remitterIban':_0x4576c3[_0x4c862d(0x12c)]?.[_0x4c862d(0x162)],'bankTransactionId':_0x4576c3[_0x4c862d(0x13d)]}};}['verifyWebhookSignature'](_0x4ad449,_0x381564){const _0x312ab3=a51_0x1766ac;return console['log'](_0x312ab3(0x134),{'receivedSignature':_0x381564,'paymentId':_0x4ad449['PaymentId'],'merchantPaymentId':_0x4ad449[_0x312ab3(0x105)]}),!![];}}exports[a51_0x1766ac(0x156)]=NodaService;