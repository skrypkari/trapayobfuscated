'use strict';const a44_0x511c8c=a44_0x59d2;(function(_0x5f3d81,_0x14947e){const _0x1ffa13=a44_0x59d2,_0x231d23=_0x5f3d81();while(!![]){try{const _0x1a62bb=parseInt(_0x1ffa13(0xf6))/0x1*(parseInt(_0x1ffa13(0xba))/0x2)+parseInt(_0x1ffa13(0xde))/0x3*(parseInt(_0x1ffa13(0xe8))/0x4)+parseInt(_0x1ffa13(0xcf))/0x5*(-parseInt(_0x1ffa13(0x92))/0x6)+parseInt(_0x1ffa13(0x9d))/0x7+-parseInt(_0x1ffa13(0x7c))/0x8+-parseInt(_0x1ffa13(0xd9))/0x9*(parseInt(_0x1ffa13(0xe5))/0xa)+parseInt(_0x1ffa13(0x9b))/0xb;if(_0x1a62bb===_0x14947e)break;else _0x231d23['push'](_0x231d23['shift']());}catch(_0xff1181){_0x231d23['push'](_0x231d23['shift']());}}}(a44_0x281f,0x9d286));function a44_0x281f(){const _0x4adaf6=['Error\x20message:','Method','__esModule','processWebhook','/payment-links/','statusCode','3033ERLERP','(8digits-8digits\x20format)','defineProperty','Status\x20Code:','timeout','1965753RxDURZ','in_progress','message','log','Noda\x20webhook\x20signature\x20verification:','apiUrl','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','32420eLsTfu','stringify','EXPIRED','4QwWzce','Response\x20Time:','NodaService','Headers:','Unknown\x20error\x20from\x20Noda\x20API','JSON\x20Parse\x20Error:\x20','parse','logWhiteDomainRequest','stack','rejected','PENDING','Order\x20ID\x20Format:','successful','entries','3191inANTX','Status\x20Text:','PAID','3048144cxSndY','active','amount','Noda\x20payment\x20verification\x20error:','MerchantPaymentId','Response\x20Body:','https://tesoft.uk/gateway/noda/','TesSoft\x20Payment\x20System/1.0','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Response\x20data:','status','Processing\x20Noda\x20webhook:','Error\x20details:','Error\x20stack:','Unknown\x20error','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','(8digits-8digits\x20format\x20for\x20Noda)','Status:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Settled','currency','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','190506vEqqAQ','loggerService','Order\x20ID\x20Used:','shortLinkUrls','PaymentId','Amount','===\x20NODA\x20SUCCESS\x20===','failed','Currency','4611002UywyJx','Status','8846971KygqXl','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Iban','canceled','Payment\x20Link\x20ID:','/payment-links','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','logWhiteDomainResponse','logWhiteDomainError','Raw\x20Response\x20Body:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','toUpperCase','https://tesoft.uk/gateway/noda/webhook/','HTTP\x20error!\x20status:\x20','completed','paid','verifyWebhookSignature','shortLink','application/json','fromEntries','===\x20NODA\x20SERVICE\x20ERROR\x20===','noda','Yes','https://tesoft.uk/gateway/pending.php?id=','QR\x20Code\x20Link:','FAILED','processing','Remitter','558nSbQqk','Parsed\x20Result:','GET','now','expiryDate','Missing\x20id\x20or\x20shortLink\x20in\x20response','statusText','Noda\x20API\x20error:\x20','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20',',\x20body:\x20','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Business\x20Error:\x20','qrCodeLink','headers','verifyPayment','isActive','BankTransactionId','done','BankId','HTTP\x20','===\x20PARSED\x20NODA\x20RESPONSE\x20===','175GttGrm','pending','error','Error\x20Message:'];a44_0x281f=function(){return _0x4adaf6;};return a44_0x281f();}Object[a44_0x511c8c(0xdb)](exports,a44_0x511c8c(0xd5),{'value':!![]}),exports[a44_0x511c8c(0xea)]=void 0x0;const loggerService_1=require('../loggerService');function a44_0x59d2(_0x6792e3,_0x4a6bee){const _0x281f07=a44_0x281f();return a44_0x59d2=function(_0x59d25b,_0x2a4dea){_0x59d25b=_0x59d25b-0x7c;let _0x19caa8=_0x281f07[_0x59d25b];return _0x19caa8;},a44_0x59d2(_0x6792e3,_0x4a6bee);}class NodaService{constructor(){const _0x2b0bcd=a44_0x511c8c;this[_0x2b0bcd(0xe3)]=_0x2b0bcd(0x82),console[_0x2b0bcd(0xe1)](_0x2b0bcd(0xa8));}async['createPaymentLink'](_0x45e860){const _0x544dec=a44_0x511c8c,{orderId:_0x784e47,name:_0x125ee1,paymentDescription:_0x1952ee,amount:_0x3df937,currency:_0x4de8e7,webhookUrl:_0x22e125,returnUrl:_0x100122,expiryDate:_0x5a3d70}=_0x45e860,_0x3214b5=_0x4de8e7[_0x544dec(0xa9)](),_0x3ca15d=_0x544dec(0xaa),_0x56b885=_0x544dec(0xb5)+_0x784e47,_0x4348d2={'name':_0x125ee1,'paymentDescription':_0x1952ee,'amount':_0x3df937,'currency':_0x3214b5,'paymentId':_0x784e47,'webhookUrl':_0x3ca15d,'returnUrl':_0x56b885};_0x5a3d70&&(_0x4348d2[_0x544dec(0xbe)]=_0x5a3d70);const _0x313838=Date[_0x544dec(0xbd)]();try{console[_0x544dec(0xe1)](_0x544dec(0xe4)),console[_0x544dec(0xe1)]('URL:',this['apiUrl']),console[_0x544dec(0xe1)]('Request\x20Body\x20(Direct\x20JSON):',JSON['stringify'](_0x4348d2,null,0x2)),console['log'](_0x544dec(0xf3),_0x784e47,_0x544dec(0x8c)),console[_0x544dec(0xe1)](_0x544dec(0x8b),_0x56b885),loggerService_1[_0x544dec(0x93)][_0x544dec(0xef)]('noda',_0x544dec(0xa2),'POST',_0x4348d2);const _0x15fb6a=await fetch(this[_0x544dec(0xe3)],{'method':'POST','headers':{'Content-Type':_0x544dec(0xb0),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x544dec(0xe6)](_0x4348d2)}),_0x4ab375=Date[_0x544dec(0xbd)]()-_0x313838;console[_0x544dec(0xe1)](_0x544dec(0x9e)),console[_0x544dec(0xe1)](_0x544dec(0x8d),_0x15fb6a[_0x544dec(0x86)]),console[_0x544dec(0xe1)](_0x544dec(0xf7),_0x15fb6a[_0x544dec(0xc0)]),console[_0x544dec(0xe1)](_0x544dec(0xeb),Object[_0x544dec(0xb1)](_0x15fb6a[_0x544dec(0xc7)][_0x544dec(0xf5)]())),console[_0x544dec(0xe1)](_0x544dec(0xe9),_0x4ab375+'ms');const _0x452137=await _0x15fb6a['text']();console[_0x544dec(0xe1)](_0x544dec(0xa6),_0x452137);if(!_0x15fb6a['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x544dec(0xd1)]('HTTP\x20Status:',_0x15fb6a[_0x544dec(0x86)]),console[_0x544dec(0xd1)](_0x544dec(0x81),_0x452137),loggerService_1[_0x544dec(0x93)][_0x544dec(0xa4)](_0x544dec(0xb3),'/payment-links',_0x15fb6a[_0x544dec(0x86)],_0x452137,_0x4ab375),loggerService_1['loggerService'][_0x544dec(0xa5)](_0x544dec(0xb3),_0x544dec(0xa2),_0x544dec(0xcd)+_0x15fb6a['status']+':\x20'+_0x452137);if(_0x15fb6a[_0x544dec(0x86)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x15fb6a['status']===0x1f4)throw new Error(_0x544dec(0x84));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x15fb6a[_0x544dec(0x86)]+_0x544dec(0xc3)+_0x452137);}let _0x4424e2;try{_0x4424e2=JSON[_0x544dec(0xee)](_0x452137);}catch(_0x478e2a){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x478e2a),loggerService_1['loggerService'][_0x544dec(0xa5)]('noda',_0x544dec(0xa2),_0x544dec(0xed)+_0x478e2a);throw new Error(_0x544dec(0xc2)+_0x452137);}console[_0x544dec(0xe1)](_0x544dec(0xce)),console[_0x544dec(0xe1)](_0x544dec(0xbb),JSON['stringify'](_0x4424e2,null,0x2)),loggerService_1[_0x544dec(0x93)][_0x544dec(0xa4)](_0x544dec(0xb3),_0x544dec(0xa2),_0x15fb6a['status'],_0x4424e2,_0x4ab375);if(_0x4424e2[_0x544dec(0xd1)]||_0x4424e2['statusCode']){const _0x2209c6=_0x4424e2[_0x544dec(0xe0)]||_0x4424e2['error']||_0x544dec(0xec);console[_0x544dec(0xd1)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x544dec(0xd1)](_0x544dec(0xd2),_0x2209c6),console[_0x544dec(0xd1)](_0x544dec(0xdc),_0x4424e2[_0x544dec(0xd8)]),loggerService_1['loggerService'][_0x544dec(0xa5)](_0x544dec(0xb3),'/payment-links',_0x544dec(0xc5)+_0x2209c6);throw new Error('Noda\x20API\x20error:\x20'+_0x2209c6);}if(!_0x4424e2['id']||!_0x4424e2[_0x544dec(0x95)]?.[_0x544dec(0xaf)]){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x544dec(0xd1)](_0x544dec(0xbf)),console[_0x544dec(0xd1)](_0x544dec(0x85),_0x4424e2),loggerService_1[_0x544dec(0x93)][_0x544dec(0xa5)]('noda',_0x544dec(0xa2),_0x544dec(0x8e));throw new Error(_0x544dec(0x91));}return console['log'](_0x544dec(0x98)),console[_0x544dec(0xe1)](_0x544dec(0xa1),_0x4424e2['id']),console[_0x544dec(0xe1)]('Short\x20Link:',_0x4424e2[_0x544dec(0x95)][_0x544dec(0xaf)]),console[_0x544dec(0xe1)](_0x544dec(0xb6),_0x4424e2[_0x544dec(0x95)][_0x544dec(0xc6)]||'Not\x20provided'),console[_0x544dec(0xe1)](_0x544dec(0x94),_0x784e47,_0x544dec(0xda)),console[_0x544dec(0xe1)](_0x544dec(0xc4),_0x56b885),{'gateway_payment_id':_0x4424e2['id'],'payment_url':_0x4424e2[_0x544dec(0x95)][_0x544dec(0xaf)],'qr_code_url':_0x4424e2[_0x544dec(0x95)][_0x544dec(0xc6)],'expiry_date':_0x4424e2[_0x544dec(0xbe)]};}catch(_0x5f3a80){console[_0x544dec(0xd1)](_0x544dec(0xb2)),console[_0x544dec(0xd1)](_0x544dec(0x88),_0x5f3a80),loggerService_1[_0x544dec(0x93)][_0x544dec(0xa5)]('noda',_0x544dec(0xa2),_0x5f3a80);if(_0x5f3a80 instanceof Error){console[_0x544dec(0xd1)](_0x544dec(0xd3),_0x5f3a80['message']),console[_0x544dec(0xd1)](_0x544dec(0x89),_0x5f3a80[_0x544dec(0xf0)]);throw new Error(_0x544dec(0xa3)+_0x5f3a80[_0x544dec(0xe0)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a44_0x511c8c(0xc8)](_0x40936c){const _0x364a39=a44_0x511c8c,_0x443533=Date[_0x364a39(0xbd)]();try{loggerService_1[_0x364a39(0x93)][_0x364a39(0xef)](_0x364a39(0xb3),_0x364a39(0xd7)+_0x40936c,'GET',{});const _0x3d433d=await fetch(this[_0x364a39(0xe3)]+'/'+_0x40936c,{'method':_0x364a39(0xbc),'headers':{'Content-Type':_0x364a39(0xb0),'User-Agent':_0x364a39(0x83)}}),_0x568139=Date[_0x364a39(0xbd)]()-_0x443533;if(!_0x3d433d['ok']){const _0x528785=await _0x3d433d['text']();loggerService_1[_0x364a39(0x93)][_0x364a39(0xa4)](_0x364a39(0xb3),_0x364a39(0xd7)+_0x40936c,_0x3d433d['status'],_0x528785,_0x568139);throw new Error(_0x364a39(0xab)+_0x3d433d['status']);}const _0x527ff9=await _0x3d433d['json']();loggerService_1[_0x364a39(0x93)][_0x364a39(0xa4)]('noda',_0x364a39(0xd7)+_0x40936c,_0x3d433d['status'],_0x527ff9,_0x568139);if(_0x527ff9[_0x364a39(0xd1)]||_0x527ff9['statusCode']){loggerService_1[_0x364a39(0x93)][_0x364a39(0xa5)](_0x364a39(0xb3),_0x364a39(0xd7)+_0x40936c,_0x364a39(0xc1)+(_0x527ff9['message']||_0x527ff9[_0x364a39(0xd1)]||_0x364a39(0x8a)));throw new Error('Noda\x20API\x20error:\x20'+(_0x527ff9[_0x364a39(0xe0)]||_0x527ff9[_0x364a39(0xd1)]||_0x364a39(0x8a)));}let _0x3dd6d1=_0x364a39(0xf2);if(_0x527ff9['isActive']===![]){if(_0x527ff9[_0x364a39(0xbe)]){const _0x5a4cfc=new Date(_0x527ff9['expiryDate']),_0x52500c=new Date();_0x5a4cfc<_0x52500c?_0x3dd6d1='EXPIRED':_0x3dd6d1='FAILED';}else _0x3dd6d1='FAILED';}else _0x3dd6d1='PENDING';return{'status':_0x3dd6d1,'amount':_0x527ff9[_0x364a39(0x7e)],'currency':_0x527ff9[_0x364a39(0x90)],'isActive':_0x527ff9[_0x364a39(0xc9)]};}catch(_0x5c2884){console[_0x364a39(0xd1)](_0x364a39(0x7f),_0x5c2884),loggerService_1[_0x364a39(0x93)]['logWhiteDomainError'](_0x364a39(0xb3),'/payment-links/'+_0x40936c,_0x5c2884);throw new Error(_0x364a39(0xa7)+(_0x5c2884 instanceof Error?_0x5c2884[_0x364a39(0xe0)]:_0x364a39(0x8a)));}}async[a44_0x511c8c(0xd6)](_0x312f5b){const _0x4de380=a44_0x511c8c;console[_0x4de380(0xe1)](_0x4de380(0x87),_0x312f5b);let _0x312d6c=_0x4de380(0xf2);switch(_0x312f5b[_0x4de380(0x9c)]?.['toLowerCase']()){case _0x4de380(0xcb):case _0x4de380(0xac):case _0x4de380(0xad):case'success':case _0x4de380(0xf4):_0x312f5b[_0x4de380(0x8f)]===_0x4de380(0xb4)?_0x312d6c=_0x4de380(0xf8):_0x312d6c=_0x4de380(0xf2);break;case'cancelled':case _0x4de380(0xa0):case _0x4de380(0x99):case _0x4de380(0xd1):case _0x4de380(0xf1):_0x312d6c=_0x4de380(0xb7);break;case'expired':case _0x4de380(0xdd):_0x312d6c=_0x4de380(0xe7);break;case _0x4de380(0xd0):case'created':case _0x4de380(0x7d):case _0x4de380(0xb8):case _0x4de380(0xdf):default:_0x312d6c=_0x4de380(0xf2);break;}return{'paymentId':_0x312f5b[_0x4de380(0x80)]||_0x312f5b[_0x4de380(0x96)],'status':_0x312d6c,'amount':_0x312f5b[_0x4de380(0x97)],'currency':_0x312f5b[_0x4de380(0x9a)],'additionalInfo':{'method':_0x312f5b[_0x4de380(0xd4)],'bankId':_0x312f5b[_0x4de380(0xcc)],'settled':_0x312f5b['Settled'],'settlementDate':_0x312f5b['SettlementDate'],'remitterName':_0x312f5b[_0x4de380(0xb9)]?.['Name'],'remitterIban':_0x312f5b[_0x4de380(0xb9)]?.[_0x4de380(0x9f)],'bankTransactionId':_0x312f5b[_0x4de380(0xca)]}};}[a44_0x511c8c(0xae)](_0x3a9cfc,_0x3062b5){const _0x5b9521=a44_0x511c8c;return console[_0x5b9521(0xe1)](_0x5b9521(0xe2),{'receivedSignature':_0x3062b5,'paymentId':_0x3a9cfc[_0x5b9521(0x96)],'merchantPaymentId':_0x3a9cfc[_0x5b9521(0x80)]}),!![];}}exports[a44_0x511c8c(0xea)]=NodaService;