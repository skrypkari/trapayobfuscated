'use strict';function a71_0x2b86(_0x26ec5a,_0x320af6){_0x26ec5a=_0x26ec5a-0x168;const _0xea2eb4=a71_0xea2e();let _0x2b86c2=_0xea2eb4[_0x26ec5a];return _0x2b86c2;}const a71_0x4c7aaf=a71_0x2b86;(function(_0x3dd59e,_0x2f496b){const _0x3f5743=a71_0x2b86,_0x1877e7=_0x3dd59e();while(!![]){try{const _0xb0cca2=-parseInt(_0x3f5743(0x1a5))/0x1*(parseInt(_0x3f5743(0x1c0))/0x2)+parseInt(_0x3f5743(0x18a))/0x3*(-parseInt(_0x3f5743(0x180))/0x4)+-parseInt(_0x3f5743(0x197))/0x5*(parseInt(_0x3f5743(0x192))/0x6)+-parseInt(_0x3f5743(0x1a2))/0x7*(parseInt(_0x3f5743(0x19d))/0x8)+parseInt(_0x3f5743(0x17b))/0x9*(parseInt(_0x3f5743(0x177))/0xa)+parseInt(_0x3f5743(0x198))/0xb+-parseInt(_0x3f5743(0x183))/0xc*(-parseInt(_0x3f5743(0x19e))/0xd);if(_0xb0cca2===_0x2f496b)break;else _0x1877e7['push'](_0x1877e7['shift']());}catch(_0x2ac629){_0x1877e7['push'](_0x1877e7['shift']());}}}(a71_0xea2e,0x6973a));Object[a71_0x4c7aaf(0x172)](exports,a71_0x4c7aaf(0x17a),{'value':!![]}),exports[a71_0x4c7aaf(0x1a0)]=void 0x0;function a71_0xea2e(){const _0x20e32e=['GET','parse','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','90612AZJRDv','headers','message','Method','PAID','185CBwjUA','6890356jLsdez','HTTP\x20','createPaymentLink','text','log','2056816QXPbvt','2172911lInOtB','pending','NodaService','shortLinkUrls','14HzpVvJ','https://tesoft.uk/gateway/noda/','PaymentId','4UdiEYn','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','successful','done','shortLink','Payment\x20System/1.0','===\x20NODA\x20SUCCESS\x20===','loggerService','BankTransactionId','verifyWebhookSignature','statusCode','Missing\x20id\x20or\x20shortLink\x20in\x20response','expiryDate','Status\x20Code:','Name','Request\x20Body\x20(Direct\x20JSON):','Payment\x20Link\x20ID:','Status','noda','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20Message:','Noda\x20API\x20error:\x20','Error\x20stack:','JSON\x20Parse\x20Error:\x20','FAILED','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','/payment-links/','58768fUeIbe','HTTP\x20error!\x20status:\x20','EXPIRED','Status\x20Text:','(8digits-8digits\x20format\x20for\x20Noda)','amount','statusText','apiUrl','isActive','SettlementDate','failed','cancelled','Status:','processWebhook','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Not\x20provided','stringify','POST','https://tesoft.uk/gateway/pending.php?id=','completed','BankId','Processing\x20Noda\x20webhook:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','logWhiteDomainResponse','verifyPayment','Parsed\x20Result:','===\x20NODA\x20API\x20ERROR\x20===','Currency','Order\x20ID\x20Format:','Order\x20ID\x20Used:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Amount','in_progress','Error\x20message:','Remitter','active','Headers:','logWhiteDomainRequest',',\x20body:\x20','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','MerchantPaymentId','success','defineProperty','toLowerCase','Unknown\x20error','error','timeout','1550VPWpyy','qrCodeLink','/payment-links','__esModule','34038lPWtCy','PENDING','canceled','status','===\x20NODA\x20SERVICE\x20ERROR\x20===','4MLZKIl','logWhiteDomainError','paid','84Bdyxzh','Yes','Response\x20data:','Noda\x20webhook\x20signature\x20verification:','Settled','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','(8digits-8digits\x20format)','2280573ozXFSv','application/json','QR\x20Code\x20Link:','entries','now'];a71_0xea2e=function(){return _0x20e32e;};return a71_0xea2e();}const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x3e8f20=a71_0x4c7aaf;this[_0x3e8f20(0x1c7)]=_0x3e8f20(0x1a3),console[_0x3e8f20(0x19c)](_0x3e8f20(0x1ce));}async[a71_0x4c7aaf(0x19a)](_0x40e5e6){const _0x3f1f3f=a71_0x4c7aaf,{orderId:_0x5a7744,name:_0x2614f7,paymentDescription:_0x2b2387,amount:_0x143407,currency:_0x2e407a,webhookUrl:_0x25e86b,returnUrl:_0x47c809,expiryDate:_0x4da9c7}=_0x40e5e6,_0x3f063b=_0x2e407a['toUpperCase'](),_0x1b56f7='https://tesoft.uk/gateway/noda/webhook/',_0x5bb274=_0x3f1f3f(0x1d2)+_0x5a7744,_0x2be394={'name':_0x2614f7,'paymentDescription':_0x2b2387,'amount':_0x143407,'currency':_0x3f063b,'paymentId':_0x5a7744,'webhookUrl':_0x1b56f7,'returnUrl':_0x5bb274};_0x4da9c7&&(_0x2be394['expiryDate']=_0x4da9c7);const _0x13f001=Date[_0x3f1f3f(0x18e)]();try{console[_0x3f1f3f(0x19c)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console['log']('URL:',this[_0x3f1f3f(0x1c7)]),console[_0x3f1f3f(0x19c)](_0x3f1f3f(0x1b4),JSON['stringify'](_0x2be394,null,0x2)),console[_0x3f1f3f(0x19c)](_0x3f1f3f(0x1dc),_0x5a7744,_0x3f1f3f(0x1c4)),console[_0x3f1f3f(0x19c)](_0x3f1f3f(0x191),_0x5bb274),loggerService_1[_0x3f1f3f(0x1ac)]['logWhiteDomainRequest']('noda','/payment-links','POST',_0x2be394);const _0x2ff0e4=await fetch(this[_0x3f1f3f(0x1c7)],{'method':_0x3f1f3f(0x1d1),'headers':{'Content-Type':_0x3f1f3f(0x18b),'Accept':_0x3f1f3f(0x18b),'User-Agent':_0x3f1f3f(0x1aa)},'body':JSON[_0x3f1f3f(0x1d0)](_0x2be394)}),_0x22fbb2=Date['now']()-_0x13f001;console[_0x3f1f3f(0x19c)](_0x3f1f3f(0x188)),console[_0x3f1f3f(0x19c)](_0x3f1f3f(0x1cc),_0x2ff0e4[_0x3f1f3f(0x17e)]),console['log'](_0x3f1f3f(0x1c3),_0x2ff0e4[_0x3f1f3f(0x1c6)]),console[_0x3f1f3f(0x19c)](_0x3f1f3f(0x16c),Object['fromEntries'](_0x2ff0e4[_0x3f1f3f(0x193)][_0x3f1f3f(0x18d)]())),console[_0x3f1f3f(0x19c)]('Response\x20Time:',_0x22fbb2+'ms');const _0xf85497=await _0x2ff0e4[_0x3f1f3f(0x19b)]();console[_0x3f1f3f(0x19c)]('Raw\x20Response\x20Body:',_0xf85497);if(!_0x2ff0e4['ok']){console[_0x3f1f3f(0x175)](_0x3f1f3f(0x1da)),console[_0x3f1f3f(0x175)]('HTTP\x20Status:',_0x2ff0e4[_0x3f1f3f(0x17e)]),console[_0x3f1f3f(0x175)]('Response\x20Body:',_0xf85497),loggerService_1['loggerService'][_0x3f1f3f(0x1d7)](_0x3f1f3f(0x1b7),_0x3f1f3f(0x179),_0x2ff0e4[_0x3f1f3f(0x17e)],_0xf85497,_0x22fbb2),loggerService_1['loggerService']['logWhiteDomainError'](_0x3f1f3f(0x1b7),_0x3f1f3f(0x179),_0x3f1f3f(0x199)+_0x2ff0e4[_0x3f1f3f(0x17e)]+':\x20'+_0xf85497);if(_0x2ff0e4[_0x3f1f3f(0x17e)]===0x190)throw new Error(_0x3f1f3f(0x1de));else{if(_0x2ff0e4[_0x3f1f3f(0x17e)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x3f1f3f(0x1c1)+_0x2ff0e4[_0x3f1f3f(0x17e)]+_0x3f1f3f(0x16e)+_0xf85497);}let _0x50bcfe;try{_0x50bcfe=JSON[_0x3f1f3f(0x190)](_0xf85497);}catch(_0x535dbb){console[_0x3f1f3f(0x175)](_0x3f1f3f(0x1b8),_0x535dbb),loggerService_1[_0x3f1f3f(0x1ac)][_0x3f1f3f(0x181)](_0x3f1f3f(0x1b7),'/payment-links',_0x3f1f3f(0x1bc)+_0x535dbb);throw new Error(_0x3f1f3f(0x1be)+_0xf85497);}console[_0x3f1f3f(0x19c)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x3f1f3f(0x19c)](_0x3f1f3f(0x1d9),JSON['stringify'](_0x50bcfe,null,0x2)),loggerService_1[_0x3f1f3f(0x1ac)][_0x3f1f3f(0x1d7)](_0x3f1f3f(0x1b7),_0x3f1f3f(0x179),_0x2ff0e4['status'],_0x50bcfe,_0x22fbb2);if(_0x50bcfe[_0x3f1f3f(0x175)]||_0x50bcfe['statusCode']){const _0x22f942=_0x50bcfe[_0x3f1f3f(0x194)]||_0x50bcfe[_0x3f1f3f(0x175)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x3f1f3f(0x175)](_0x3f1f3f(0x1a6)),console[_0x3f1f3f(0x175)](_0x3f1f3f(0x1b9),_0x22f942),console['error'](_0x3f1f3f(0x1b2),_0x50bcfe['statusCode']),loggerService_1['loggerService'][_0x3f1f3f(0x181)](_0x3f1f3f(0x1b7),_0x3f1f3f(0x179),'Business\x20Error:\x20'+_0x22f942);throw new Error(_0x3f1f3f(0x1ba)+_0x22f942);}if(!_0x50bcfe['id']||!_0x50bcfe[_0x3f1f3f(0x1a1)]?.[_0x3f1f3f(0x1a9)]){console[_0x3f1f3f(0x175)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3f1f3f(0x175)](_0x3f1f3f(0x1b0)),console['error'](_0x3f1f3f(0x185),_0x50bcfe),loggerService_1['loggerService'][_0x3f1f3f(0x181)](_0x3f1f3f(0x1b7),_0x3f1f3f(0x179),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x3f1f3f(0x16f));}return console['log'](_0x3f1f3f(0x1ab)),console['log'](_0x3f1f3f(0x1b5),_0x50bcfe['id']),console[_0x3f1f3f(0x19c)]('Short\x20Link:',_0x50bcfe[_0x3f1f3f(0x1a1)]['shortLink']),console[_0x3f1f3f(0x19c)](_0x3f1f3f(0x18c),_0x50bcfe[_0x3f1f3f(0x1a1)][_0x3f1f3f(0x178)]||_0x3f1f3f(0x1cf)),console[_0x3f1f3f(0x19c)](_0x3f1f3f(0x1dd),_0x5a7744,_0x3f1f3f(0x189)),console['log']('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x5bb274),{'gateway_payment_id':_0x50bcfe['id'],'payment_url':_0x50bcfe[_0x3f1f3f(0x1a1)][_0x3f1f3f(0x1a9)],'qr_code_url':_0x50bcfe['shortLinkUrls'][_0x3f1f3f(0x178)],'expiry_date':_0x50bcfe[_0x3f1f3f(0x1b1)]};}catch(_0x2184ce){console[_0x3f1f3f(0x175)](_0x3f1f3f(0x17f)),console[_0x3f1f3f(0x175)]('Error\x20details:',_0x2184ce),loggerService_1[_0x3f1f3f(0x1ac)][_0x3f1f3f(0x181)](_0x3f1f3f(0x1b7),_0x3f1f3f(0x179),_0x2184ce);if(_0x2184ce instanceof Error){console[_0x3f1f3f(0x175)](_0x3f1f3f(0x169),_0x2184ce[_0x3f1f3f(0x194)]),console[_0x3f1f3f(0x175)](_0x3f1f3f(0x1bb),_0x2184ce['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x2184ce[_0x3f1f3f(0x194)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a71_0x4c7aaf(0x1d8)](_0x18d738){const _0x171225=a71_0x4c7aaf,_0x154fa1=Date[_0x171225(0x18e)]();try{loggerService_1['loggerService'][_0x171225(0x16d)](_0x171225(0x1b7),_0x171225(0x1bf)+_0x18d738,_0x171225(0x18f),{});const _0x18f1b7=await fetch(this[_0x171225(0x1c7)]+'/'+_0x18d738,{'method':_0x171225(0x18f),'headers':{'Content-Type':_0x171225(0x18b),'User-Agent':_0x171225(0x1aa)}}),_0x28879d=Date[_0x171225(0x18e)]()-_0x154fa1;if(!_0x18f1b7['ok']){const _0x3d9ba7=await _0x18f1b7[_0x171225(0x19b)]();loggerService_1[_0x171225(0x1ac)][_0x171225(0x1d7)](_0x171225(0x1b7),_0x171225(0x1bf)+_0x18d738,_0x18f1b7[_0x171225(0x17e)],_0x3d9ba7,_0x28879d);throw new Error(_0x171225(0x1c1)+_0x18f1b7[_0x171225(0x17e)]);}const _0x5b4dba=await _0x18f1b7['json']();loggerService_1['loggerService'][_0x171225(0x1d7)]('noda',_0x171225(0x1bf)+_0x18d738,_0x18f1b7[_0x171225(0x17e)],_0x5b4dba,_0x28879d);if(_0x5b4dba[_0x171225(0x175)]||_0x5b4dba[_0x171225(0x1af)]){loggerService_1[_0x171225(0x1ac)][_0x171225(0x181)](_0x171225(0x1b7),_0x171225(0x1bf)+_0x18d738,'Noda\x20API\x20error:\x20'+(_0x5b4dba[_0x171225(0x194)]||_0x5b4dba[_0x171225(0x175)]||'Unknown\x20error'));throw new Error(_0x171225(0x1ba)+(_0x5b4dba[_0x171225(0x194)]||_0x5b4dba[_0x171225(0x175)]||_0x171225(0x174)));}let _0x2e8790=_0x171225(0x17c);if(_0x5b4dba[_0x171225(0x1c8)]===![]){if(_0x5b4dba['expiryDate']){const _0x1c211b=new Date(_0x5b4dba[_0x171225(0x1b1)]),_0x47b651=new Date();_0x1c211b<_0x47b651?_0x2e8790=_0x171225(0x1c2):_0x2e8790=_0x171225(0x1bd);}else _0x2e8790=_0x171225(0x1bd);}else _0x2e8790=_0x171225(0x17c);return{'status':_0x2e8790,'amount':_0x5b4dba[_0x171225(0x1c5)],'currency':_0x5b4dba['currency'],'isActive':_0x5b4dba['isActive']};}catch(_0x375c54){console['error']('Noda\x20payment\x20verification\x20error:',_0x375c54),loggerService_1[_0x171225(0x1ac)]['logWhiteDomainError'](_0x171225(0x1b7),_0x171225(0x1bf)+_0x18d738,_0x375c54);throw new Error(_0x171225(0x1d6)+(_0x375c54 instanceof Error?_0x375c54[_0x171225(0x194)]:_0x171225(0x174)));}}async[a71_0x4c7aaf(0x1cd)](_0x2bda7e){const _0x4e6371=a71_0x4c7aaf;console[_0x4e6371(0x19c)](_0x4e6371(0x1d5),_0x2bda7e);let _0x350cec='PENDING';switch(_0x2bda7e[_0x4e6371(0x1b6)]?.[_0x4e6371(0x173)]()){case _0x4e6371(0x1a8):case _0x4e6371(0x1d3):case _0x4e6371(0x182):case _0x4e6371(0x171):case _0x4e6371(0x1a7):_0x2bda7e[_0x4e6371(0x187)]===_0x4e6371(0x184)?_0x350cec=_0x4e6371(0x196):_0x350cec='PENDING';break;case _0x4e6371(0x1cb):case _0x4e6371(0x17d):case _0x4e6371(0x1ca):case _0x4e6371(0x175):case'rejected':_0x350cec=_0x4e6371(0x1bd);break;case'expired':case _0x4e6371(0x176):_0x350cec=_0x4e6371(0x1c2);break;case _0x4e6371(0x19f):case'created':case _0x4e6371(0x16b):case'processing':case _0x4e6371(0x168):default:_0x350cec='PENDING';break;}return{'paymentId':_0x2bda7e[_0x4e6371(0x170)]||_0x2bda7e[_0x4e6371(0x1a4)],'status':_0x350cec,'amount':_0x2bda7e[_0x4e6371(0x1df)],'currency':_0x2bda7e[_0x4e6371(0x1db)],'additionalInfo':{'method':_0x2bda7e[_0x4e6371(0x195)],'bankId':_0x2bda7e[_0x4e6371(0x1d4)],'settled':_0x2bda7e[_0x4e6371(0x187)],'settlementDate':_0x2bda7e[_0x4e6371(0x1c9)],'remitterName':_0x2bda7e['Remitter']?.[_0x4e6371(0x1b3)],'remitterIban':_0x2bda7e[_0x4e6371(0x16a)]?.['Iban'],'bankTransactionId':_0x2bda7e[_0x4e6371(0x1ad)]}};}[a71_0x4c7aaf(0x1ae)](_0x27d6f2,_0x4a8956){const _0x3ad0ce=a71_0x4c7aaf;return console[_0x3ad0ce(0x19c)](_0x3ad0ce(0x186),{'receivedSignature':_0x4a8956,'paymentId':_0x27d6f2['PaymentId'],'merchantPaymentId':_0x27d6f2[_0x3ad0ce(0x170)]}),!![];}}exports['NodaService']=NodaService;