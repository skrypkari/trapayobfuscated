'use strict';const a44_0x172e05=a44_0xa5f4;function a44_0x922f(){const _0x218af0=['(8digits-8digits\x20format\x20for\x20Noda)','Missing\x20id\x20or\x20shortLink\x20in\x20response','statusText','===\x20NODA\x20SUCCESS\x20===','logWhiteDomainRequest','Yes',',\x20body:\x20','created','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','json','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','logWhiteDomainResponse','JSON\x20Parse\x20Error:\x20','expiryDate','noda','1831622ruUozh','Noda\x20payment\x20verification\x20error:','4739iUjQnG','PENDING','NodaService','1550448jAcMCk','EXPIRED','fromEntries','TesSoft\x20Payment\x20System/1.0','headers','Response\x20Time:','/payment-links/','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','paid','https://tesoft.uk/gateway/pending.php?id=','(8digits-8digits\x20format)','BankTransactionId','log','completed','logWhiteDomainError','Request\x20Body\x20(Direct\x20JSON):','now','Payment\x20Link\x20ID:','Processing\x20Noda\x20webhook:','processing','QR\x20Code\x20Link:','POST','MerchantPaymentId','Settled','===\x20PARSED\x20NODA\x20RESPONSE\x20===','===\x20NODA\x20SERVICE\x20ERROR\x20===','Parsed\x20Result:','HTTP\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Remitter','done','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','amount','parse','Noda\x20API\x20error:\x20','Error\x20Message:','Order\x20ID\x20Format:','PAID','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','/payment-links','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','in_progress','status','active','timeout','Status\x20Code:','Status','19064AUdXdl','PaymentId','shortLinkUrls','FAILED','stringify','Noda\x20webhook\x20signature\x20verification:','GET','1293558XBWYIB','Method','1870165ZjLVSb','text','Status\x20Text:','Raw\x20Response\x20Body:','Short\x20Link:','isActive','4IJjHde','Status:','apiUrl','Response\x20Body:','HTTP\x20error!\x20status:\x20','rejected','shortLink','SettlementDate','loggerService','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Unknown\x20error','Response\x20data:','message','Failed\x20to\x20parse\x20JSON\x20response:','Unknown\x20error\x20from\x20Noda\x20API','130sHgFxJ','Currency','canceled','verifyPayment','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','currency','Error\x20details:','Iban','qrCodeLink','error','Error\x20stack:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','processWebhook','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','1647160ZQwjoW','URL:','25WldBua','createPaymentLink','application/json','stack','3901083dQiInA','Name','../loggerService','statusCode','toUpperCase'];a44_0x922f=function(){return _0x218af0;};return a44_0x922f();}(function(_0x23708b,_0x2b7658){const _0x3d8ad4=a44_0xa5f4,_0xc920d2=_0x23708b();while(!![]){try{const _0x38aaa7=parseInt(_0x3d8ad4(0x143))/0x1+-parseInt(_0x3d8ad4(0x15d))/0x2+parseInt(_0x3d8ad4(0x149))/0x3*(-parseInt(_0x3d8ad4(0x126))/0x4)+parseInt(_0x3d8ad4(0x145))/0x5*(parseInt(_0x3d8ad4(0x11e))/0x6)+-parseInt(_0x3d8ad4(0x15f))/0x7*(parseInt(_0x3d8ad4(0x117))/0x8)+-parseInt(_0x3d8ad4(0x162))/0x9+parseInt(_0x3d8ad4(0x135))/0xa*(parseInt(_0x3d8ad4(0x120))/0xb);if(_0x38aaa7===_0x2b7658)break;else _0xc920d2['push'](_0xc920d2['shift']());}catch(_0x459e5c){_0xc920d2['push'](_0xc920d2['shift']());}}}(a44_0x922f,0xe3ed1));function a44_0xa5f4(_0xbe6072,_0x419d27){const _0x922f0c=a44_0x922f();return a44_0xa5f4=function(_0xa5f445,_0x512125){_0xa5f445=_0xa5f445-0xf9;let _0x43aa6b=_0x922f0c[_0xa5f445];return _0x43aa6b;},a44_0xa5f4(_0xbe6072,_0x419d27);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a44_0x172e05(0x14b));class NodaService{constructor(){const _0x37c118=a44_0x172e05;this[_0x37c118(0x128)]='https://tesoft.uk/gateway/noda/',console[_0x37c118(0x16e)](_0x37c118(0x12f));}async[a44_0x172e05(0x146)](_0x136fcc){const _0x56d707=a44_0x172e05,{orderId:_0x3cd3bd,name:_0x1dbdb0,paymentDescription:_0x539ada,amount:_0x565e8f,currency:_0x1834ab,webhookUrl:_0x604860,returnUrl:_0x3a2324,expiryDate:_0x1c18f1}=_0x136fcc,_0x6daecd=_0x1834ab[_0x56d707(0x14d)](),_0x13d0f5='https://tesoft.uk/gateway/noda/webhook/',_0x3d7ced=_0x56d707(0x16b)+_0x3cd3bd,_0x18c865={'name':_0x1dbdb0,'paymentDescription':_0x539ada,'amount':_0x565e8f,'currency':_0x6daecd,'paymentId':_0x3cd3bd,'webhookUrl':_0x13d0f5,'returnUrl':_0x3d7ced};_0x1c18f1&&(_0x18c865['expiryDate']=_0x1c18f1);const _0x4f8c19=Date['now']();try{console[_0x56d707(0x16e)](_0x56d707(0x110)),console[_0x56d707(0x16e)](_0x56d707(0x144),this['apiUrl']),console['log'](_0x56d707(0x171),JSON[_0x56d707(0x11b)](_0x18c865,null,0x2)),console[_0x56d707(0x16e)](_0x56d707(0x10c),_0x3cd3bd,_0x56d707(0x14e)),console['log'](_0x56d707(0x169),_0x3d7ced),loggerService_1[_0x56d707(0x12e)][_0x56d707(0x152)](_0x56d707(0x15c),_0x56d707(0x10f),'POST',_0x18c865);const _0x3577c1=await fetch(this[_0x56d707(0x128)],{'method':_0x56d707(0xfc),'headers':{'Content-Type':_0x56d707(0x147),'Accept':_0x56d707(0x147),'User-Agent':_0x56d707(0x165)},'body':JSON[_0x56d707(0x11b)](_0x18c865)}),_0xff2531=Date[_0x56d707(0x172)]()-_0x4f8c19;console['log'](_0x56d707(0x140)),console[_0x56d707(0x16e)](_0x56d707(0x127),_0x3577c1['status']),console[_0x56d707(0x16e)](_0x56d707(0x122),_0x3577c1[_0x56d707(0x150)]),console['log']('Headers:',Object[_0x56d707(0x164)](_0x3577c1[_0x56d707(0x166)]['entries']())),console['log'](_0x56d707(0x167),_0xff2531+'ms');const _0x30a119=await _0x3577c1[_0x56d707(0x121)]();console['log'](_0x56d707(0x123),_0x30a119);if(!_0x3577c1['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x56d707(0x13e)]('HTTP\x20Status:',_0x3577c1[_0x56d707(0x112)]),console[_0x56d707(0x13e)](_0x56d707(0x129),_0x30a119),loggerService_1[_0x56d707(0x12e)][_0x56d707(0x159)](_0x56d707(0x15c),'/payment-links',_0x3577c1[_0x56d707(0x112)],_0x30a119,_0xff2531),loggerService_1['loggerService'][_0x56d707(0x170)](_0x56d707(0x15c),'/payment-links',_0x56d707(0x102)+_0x3577c1[_0x56d707(0x112)]+':\x20'+_0x30a119);if(_0x3577c1[_0x56d707(0x112)]===0x190)throw new Error(_0x56d707(0x142));else{if(_0x3577c1['status']===0x1f4)throw new Error(_0x56d707(0x10e));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x3577c1['status']+_0x56d707(0x154)+_0x30a119);}let _0x3bc566;try{_0x3bc566=JSON[_0x56d707(0x109)](_0x30a119);}catch(_0x2dbb09){console[_0x56d707(0x13e)](_0x56d707(0x133),_0x2dbb09),loggerService_1[_0x56d707(0x12e)]['logWhiteDomainError'](_0x56d707(0x15c),_0x56d707(0x10f),_0x56d707(0x15a)+_0x2dbb09);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x30a119);}console[_0x56d707(0x16e)](_0x56d707(0xff)),console[_0x56d707(0x16e)](_0x56d707(0x101),JSON['stringify'](_0x3bc566,null,0x2)),loggerService_1[_0x56d707(0x12e)][_0x56d707(0x159)](_0x56d707(0x15c),'/payment-links',_0x3577c1['status'],_0x3bc566,_0xff2531);if(_0x3bc566[_0x56d707(0x13e)]||_0x3bc566[_0x56d707(0x14c)]){const _0x5ee943=_0x3bc566['message']||_0x3bc566[_0x56d707(0x13e)]||_0x56d707(0x134);console[_0x56d707(0x13e)](_0x56d707(0x107)),console[_0x56d707(0x13e)](_0x56d707(0x10b),_0x5ee943),console[_0x56d707(0x13e)](_0x56d707(0x115),_0x3bc566[_0x56d707(0x14c)]),loggerService_1[_0x56d707(0x12e)][_0x56d707(0x170)](_0x56d707(0x15c),'/payment-links','Business\x20Error:\x20'+_0x5ee943);throw new Error(_0x56d707(0x10a)+_0x5ee943);}if(!_0x3bc566['id']||!_0x3bc566[_0x56d707(0x119)]?.[_0x56d707(0x12c)]){console[_0x56d707(0x13e)](_0x56d707(0x156)),console['error'](_0x56d707(0x14f)),console[_0x56d707(0x13e)](_0x56d707(0x131),_0x3bc566),loggerService_1['loggerService']['logWhiteDomainError'](_0x56d707(0x15c),_0x56d707(0x10f),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x56d707(0x158));}return console[_0x56d707(0x16e)](_0x56d707(0x151)),console['log'](_0x56d707(0x173),_0x3bc566['id']),console['log'](_0x56d707(0x124),_0x3bc566[_0x56d707(0x119)][_0x56d707(0x12c)]),console[_0x56d707(0x16e)](_0x56d707(0xfb),_0x3bc566[_0x56d707(0x119)][_0x56d707(0x13d)]||'Not\x20provided'),console[_0x56d707(0x16e)]('Order\x20ID\x20Used:',_0x3cd3bd,_0x56d707(0x16c)),console[_0x56d707(0x16e)](_0x56d707(0x139),_0x3d7ced),{'gateway_payment_id':_0x3bc566['id'],'payment_url':_0x3bc566[_0x56d707(0x119)]['shortLink'],'qr_code_url':_0x3bc566[_0x56d707(0x119)][_0x56d707(0x13d)],'expiry_date':_0x3bc566[_0x56d707(0x15b)]};}catch(_0x26eca3){console[_0x56d707(0x13e)](_0x56d707(0x100)),console[_0x56d707(0x13e)](_0x56d707(0x13b),_0x26eca3),loggerService_1[_0x56d707(0x12e)][_0x56d707(0x170)](_0x56d707(0x15c),_0x56d707(0x10f),_0x26eca3);if(_0x26eca3 instanceof Error){console[_0x56d707(0x13e)]('Error\x20message:',_0x26eca3[_0x56d707(0x132)]),console[_0x56d707(0x13e)](_0x56d707(0x13f),_0x26eca3[_0x56d707(0x148)]);throw new Error(_0x56d707(0x103)+_0x26eca3[_0x56d707(0x132)]);}throw new Error(_0x56d707(0x104));}}async[a44_0x172e05(0x138)](_0x5159ea){const _0x21370a=a44_0x172e05,_0x18d327=Date[_0x21370a(0x172)]();try{loggerService_1[_0x21370a(0x12e)]['logWhiteDomainRequest'](_0x21370a(0x15c),_0x21370a(0x168)+_0x5159ea,_0x21370a(0x11d),{});const _0x2d9641=await fetch(this[_0x21370a(0x128)]+'/'+_0x5159ea,{'method':_0x21370a(0x11d),'headers':{'Content-Type':_0x21370a(0x147),'User-Agent':_0x21370a(0x165)}}),_0xf5eb20=Date[_0x21370a(0x172)]()-_0x18d327;if(!_0x2d9641['ok']){const _0x288f85=await _0x2d9641[_0x21370a(0x121)]();loggerService_1[_0x21370a(0x12e)]['logWhiteDomainResponse'](_0x21370a(0x15c),_0x21370a(0x168)+_0x5159ea,_0x2d9641[_0x21370a(0x112)],_0x288f85,_0xf5eb20);throw new Error(_0x21370a(0x12a)+_0x2d9641[_0x21370a(0x112)]);}const _0x447279=await _0x2d9641[_0x21370a(0x157)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x21370a(0x15c),_0x21370a(0x168)+_0x5159ea,_0x2d9641[_0x21370a(0x112)],_0x447279,_0xf5eb20);if(_0x447279[_0x21370a(0x13e)]||_0x447279['statusCode']){loggerService_1[_0x21370a(0x12e)][_0x21370a(0x170)](_0x21370a(0x15c),_0x21370a(0x168)+_0x5159ea,_0x21370a(0x10a)+(_0x447279[_0x21370a(0x132)]||_0x447279[_0x21370a(0x13e)]||_0x21370a(0x130)));throw new Error('Noda\x20API\x20error:\x20'+(_0x447279['message']||_0x447279[_0x21370a(0x13e)]||'Unknown\x20error'));}let _0x4237f8='PENDING';if(_0x447279['isActive']===![]){if(_0x447279[_0x21370a(0x15b)]){const _0x4ec4de=new Date(_0x447279['expiryDate']),_0x2080b3=new Date();_0x4ec4de<_0x2080b3?_0x4237f8='EXPIRED':_0x4237f8=_0x21370a(0x11a);}else _0x4237f8=_0x21370a(0x11a);}else _0x4237f8=_0x21370a(0x160);return{'status':_0x4237f8,'amount':_0x447279[_0x21370a(0x108)],'currency':_0x447279[_0x21370a(0x13a)],'isActive':_0x447279[_0x21370a(0x125)]};}catch(_0x1f394d){console[_0x21370a(0x13e)](_0x21370a(0x15e),_0x1f394d),loggerService_1[_0x21370a(0x12e)]['logWhiteDomainError'](_0x21370a(0x15c),_0x21370a(0x168)+_0x5159ea,_0x1f394d);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x1f394d instanceof Error?_0x1f394d[_0x21370a(0x132)]:_0x21370a(0x130)));}}async[a44_0x172e05(0x141)](_0x105c64){const _0x30f70b=a44_0x172e05;console[_0x30f70b(0x16e)](_0x30f70b(0xf9),_0x105c64);let _0x3157e0=_0x30f70b(0x160);switch(_0x105c64[_0x30f70b(0x116)]?.['toLowerCase']()){case _0x30f70b(0x106):case _0x30f70b(0x16f):case _0x30f70b(0x16a):case'success':case'successful':_0x105c64['Settled']===_0x30f70b(0x153)?_0x3157e0=_0x30f70b(0x10d):_0x3157e0=_0x30f70b(0x160);break;case'cancelled':case _0x30f70b(0x137):case'failed':case'error':case _0x30f70b(0x12b):_0x3157e0=_0x30f70b(0x11a);break;case'expired':case _0x30f70b(0x114):_0x3157e0=_0x30f70b(0x163);break;case'pending':case _0x30f70b(0x155):case _0x30f70b(0x113):case _0x30f70b(0xfa):case _0x30f70b(0x111):default:_0x3157e0=_0x30f70b(0x160);break;}return{'paymentId':_0x105c64[_0x30f70b(0xfd)]||_0x105c64[_0x30f70b(0x118)],'status':_0x3157e0,'amount':_0x105c64['Amount'],'currency':_0x105c64[_0x30f70b(0x136)],'additionalInfo':{'method':_0x105c64[_0x30f70b(0x11f)],'bankId':_0x105c64['BankId'],'settled':_0x105c64[_0x30f70b(0xfe)],'settlementDate':_0x105c64[_0x30f70b(0x12d)],'remitterName':_0x105c64[_0x30f70b(0x105)]?.[_0x30f70b(0x14a)],'remitterIban':_0x105c64[_0x30f70b(0x105)]?.[_0x30f70b(0x13c)],'bankTransactionId':_0x105c64[_0x30f70b(0x16d)]}};}['verifyWebhookSignature'](_0x4cf897,_0x5ed1de){const _0x4aca7f=a44_0x172e05;return console[_0x4aca7f(0x16e)](_0x4aca7f(0x11c),{'receivedSignature':_0x5ed1de,'paymentId':_0x4cf897[_0x4aca7f(0x118)],'merchantPaymentId':_0x4cf897[_0x4aca7f(0xfd)]}),!![];}}exports[a44_0x172e05(0x161)]=NodaService;