'use strict';const a43_0x365a97=a43_0x5346;(function(_0x1f1beb,_0x4b99e2){const _0x503952=a43_0x5346,_0x3412ab=_0x1f1beb();while(!![]){try{const _0x1bb28b=parseInt(_0x503952(0x1db))/0x1+parseInt(_0x503952(0x24c))/0x2*(parseInt(_0x503952(0x225))/0x3)+-parseInt(_0x503952(0x1df))/0x4+parseInt(_0x503952(0x1ee))/0x5*(-parseInt(_0x503952(0x1de))/0x6)+-parseInt(_0x503952(0x229))/0x7+-parseInt(_0x503952(0x20d))/0x8*(-parseInt(_0x503952(0x224))/0x9)+parseInt(_0x503952(0x24b))/0xa*(parseInt(_0x503952(0x235))/0xb);if(_0x1bb28b===_0x4b99e2)break;else _0x3412ab['push'](_0x3412ab['shift']());}catch(_0x32c64a){_0x3412ab['push'](_0x3412ab['shift']());}}}(a43_0x3986,0x3c0d4));Object['defineProperty'](exports,a43_0x365a97(0x20a),{'value':!![]}),exports[a43_0x365a97(0x205)]=void 0x0;const loggerService_1=require(a43_0x365a97(0x204));class NodaService{constructor(){const _0x23b21b=a43_0x365a97;this[_0x23b21b(0x20e)]=_0x23b21b(0x218),console[_0x23b21b(0x1f8)](_0x23b21b(0x223));}async[a43_0x365a97(0x252)](_0x4a4f40){const _0x127c7e=a43_0x365a97,{orderId:_0x56a437,name:_0x1c5f45,paymentDescription:_0x5b1865,amount:_0x42dcac,currency:_0x5ae75f,webhookUrl:_0xc9b6c5,returnUrl:_0x50a043,expiryDate:_0x584e16}=_0x4a4f40,_0x3b5012=_0x5ae75f['toUpperCase'](),_0x3f5ad8=_0x127c7e(0x1d9),_0x4b2eb2=_0x127c7e(0x246)+_0x56a437,_0x19b8e0={'name':_0x1c5f45,'paymentDescription':_0x5b1865,'amount':_0x42dcac,'currency':_0x3b5012,'paymentId':_0x56a437,'webhookUrl':_0x3f5ad8,'returnUrl':_0x4b2eb2};_0x584e16&&(_0x19b8e0['expiryDate']=_0x584e16);const _0x1b8b1f=Date[_0x127c7e(0x1e6)]();try{console[_0x127c7e(0x1f8)](_0x127c7e(0x21f)),console[_0x127c7e(0x1f8)]('URL:',this[_0x127c7e(0x20e)]),console[_0x127c7e(0x1f8)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x127c7e(0x22e)](_0x19b8e0,null,0x2)),console['log'](_0x127c7e(0x212),_0x56a437,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x127c7e(0x1f8)](_0x127c7e(0x206),_0x4b2eb2),loggerService_1[_0x127c7e(0x1fa)]['logWhiteDomainRequest'](_0x127c7e(0x210),_0x127c7e(0x217),_0x127c7e(0x1fd),_0x19b8e0);const _0x2a9f04=await fetch(this[_0x127c7e(0x20e)],{'method':_0x127c7e(0x1fd),'headers':{'Content-Type':'application/json','Accept':_0x127c7e(0x21d),'User-Agent':_0x127c7e(0x202)},'body':JSON[_0x127c7e(0x22e)](_0x19b8e0)}),_0x4c88a8=Date[_0x127c7e(0x1e6)]()-_0x1b8b1f;console[_0x127c7e(0x1f8)](_0x127c7e(0x220)),console[_0x127c7e(0x1f8)](_0x127c7e(0x24d),_0x2a9f04[_0x127c7e(0x1fe)]),console['log'](_0x127c7e(0x247),_0x2a9f04[_0x127c7e(0x244)]),console[_0x127c7e(0x1f8)]('Headers:',Object['fromEntries'](_0x2a9f04[_0x127c7e(0x23e)][_0x127c7e(0x203)]())),console['log'](_0x127c7e(0x240),_0x4c88a8+'ms');const _0x2e9721=await _0x2a9f04[_0x127c7e(0x1ef)]();console[_0x127c7e(0x1f8)](_0x127c7e(0x22d),_0x2e9721);if(!_0x2a9f04['ok']){console[_0x127c7e(0x248)](_0x127c7e(0x237)),console['error']('HTTP\x20Status:',_0x2a9f04['status']),console['error']('Response\x20Body:',_0x2e9721),loggerService_1['loggerService'][_0x127c7e(0x21a)](_0x127c7e(0x210),_0x127c7e(0x217),_0x2a9f04[_0x127c7e(0x1fe)],_0x2e9721,_0x4c88a8),loggerService_1[_0x127c7e(0x1fa)][_0x127c7e(0x1e9)](_0x127c7e(0x210),'/payment-links',_0x127c7e(0x22a)+_0x2a9f04[_0x127c7e(0x1fe)]+':\x20'+_0x2e9721);if(_0x2a9f04[_0x127c7e(0x1fe)]===0x190)throw new Error(_0x127c7e(0x1f7));else{if(_0x2a9f04[_0x127c7e(0x1fe)]===0x1f4)throw new Error(_0x127c7e(0x238));}throw new Error(_0x127c7e(0x208)+_0x2a9f04[_0x127c7e(0x1fe)]+_0x127c7e(0x243)+_0x2e9721);}let _0xffabae;try{_0xffabae=JSON[_0x127c7e(0x236)](_0x2e9721);}catch(_0x259710){console[_0x127c7e(0x248)](_0x127c7e(0x201),_0x259710),loggerService_1['loggerService']['logWhiteDomainError'](_0x127c7e(0x210),_0x127c7e(0x217),_0x127c7e(0x20f)+_0x259710);throw new Error(_0x127c7e(0x1fc)+_0x2e9721);}console[_0x127c7e(0x1f8)](_0x127c7e(0x1f3)),console[_0x127c7e(0x1f8)](_0x127c7e(0x250),JSON[_0x127c7e(0x22e)](_0xffabae,null,0x2)),loggerService_1[_0x127c7e(0x1fa)][_0x127c7e(0x21a)](_0x127c7e(0x210),_0x127c7e(0x217),_0x2a9f04[_0x127c7e(0x1fe)],_0xffabae,_0x4c88a8);if(_0xffabae['error']||_0xffabae[_0x127c7e(0x232)]){const _0x43660e=_0xffabae[_0x127c7e(0x1f0)]||_0xffabae[_0x127c7e(0x248)]||_0x127c7e(0x251);console[_0x127c7e(0x248)](_0x127c7e(0x215)),console[_0x127c7e(0x248)](_0x127c7e(0x1fb),_0x43660e),console[_0x127c7e(0x248)]('Status\x20Code:',_0xffabae[_0x127c7e(0x232)]),loggerService_1[_0x127c7e(0x1fa)][_0x127c7e(0x1e9)](_0x127c7e(0x210),_0x127c7e(0x217),_0x127c7e(0x214)+_0x43660e);throw new Error(_0x127c7e(0x24a)+_0x43660e);}if(!_0xffabae['id']||!_0xffabae[_0x127c7e(0x1e0)]?.[_0x127c7e(0x219)]){console[_0x127c7e(0x248)](_0x127c7e(0x20c)),console[_0x127c7e(0x248)](_0x127c7e(0x23a)),console[_0x127c7e(0x248)](_0x127c7e(0x1e8),_0xffabae),loggerService_1[_0x127c7e(0x1fa)][_0x127c7e(0x1e9)](_0x127c7e(0x210),_0x127c7e(0x217),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x127c7e(0x253));}return console[_0x127c7e(0x1f8)]('===\x20NODA\x20SUCCESS\x20==='),console['log']('Payment\x20Link\x20ID:',_0xffabae['id']),console[_0x127c7e(0x1f8)](_0x127c7e(0x1dc),_0xffabae['shortLinkUrls'][_0x127c7e(0x219)]),console[_0x127c7e(0x1f8)](_0x127c7e(0x1e7),_0xffabae[_0x127c7e(0x1e0)][_0x127c7e(0x22b)]||'Not\x20provided'),console[_0x127c7e(0x1f8)](_0x127c7e(0x227),_0x56a437,_0x127c7e(0x1e3)),console[_0x127c7e(0x1f8)]('✅\x20Return\x20URL\x20configured\x20for\x20pending:',_0x4b2eb2),{'gateway_payment_id':_0xffabae['id'],'payment_url':_0xffabae['shortLinkUrls'][_0x127c7e(0x219)],'qr_code_url':_0xffabae[_0x127c7e(0x1e0)][_0x127c7e(0x22b)],'expiry_date':_0xffabae[_0x127c7e(0x1f2)]};}catch(_0x279214){console[_0x127c7e(0x248)](_0x127c7e(0x20b)),console[_0x127c7e(0x248)](_0x127c7e(0x1f9),_0x279214),loggerService_1[_0x127c7e(0x1fa)]['logWhiteDomainError'](_0x127c7e(0x210),_0x127c7e(0x217),_0x279214);if(_0x279214 instanceof Error){console[_0x127c7e(0x248)](_0x127c7e(0x245),_0x279214[_0x127c7e(0x1f0)]),console[_0x127c7e(0x248)](_0x127c7e(0x254),_0x279214[_0x127c7e(0x1ff)]);throw new Error(_0x127c7e(0x1e2)+_0x279214[_0x127c7e(0x1f0)]);}throw new Error(_0x127c7e(0x1dd));}}async[a43_0x365a97(0x234)](_0x4d59fb){const _0x39f8e0=a43_0x365a97,_0x190de1=Date[_0x39f8e0(0x1e6)]();try{loggerService_1['loggerService'][_0x39f8e0(0x1ed)](_0x39f8e0(0x210),_0x39f8e0(0x23d)+_0x4d59fb,_0x39f8e0(0x1f1),{});const _0x28d554=await fetch(this[_0x39f8e0(0x20e)]+'/'+_0x4d59fb,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x39f8e0(0x202)}}),_0x3d9166=Date[_0x39f8e0(0x1e6)]()-_0x190de1;if(!_0x28d554['ok']){const _0x5cad94=await _0x28d554['text']();loggerService_1['loggerService'][_0x39f8e0(0x21a)](_0x39f8e0(0x210),_0x39f8e0(0x23d)+_0x4d59fb,_0x28d554[_0x39f8e0(0x1fe)],_0x5cad94,_0x3d9166);throw new Error('HTTP\x20error!\x20status:\x20'+_0x28d554['status']);}const _0x4a4344=await _0x28d554[_0x39f8e0(0x233)]();loggerService_1[_0x39f8e0(0x1fa)][_0x39f8e0(0x21a)](_0x39f8e0(0x210),_0x39f8e0(0x23d)+_0x4d59fb,_0x28d554[_0x39f8e0(0x1fe)],_0x4a4344,_0x3d9166);if(_0x4a4344[_0x39f8e0(0x248)]||_0x4a4344[_0x39f8e0(0x232)]){loggerService_1[_0x39f8e0(0x1fa)][_0x39f8e0(0x1e9)](_0x39f8e0(0x210),_0x39f8e0(0x23d)+_0x4d59fb,_0x39f8e0(0x24a)+(_0x4a4344[_0x39f8e0(0x1f0)]||_0x4a4344[_0x39f8e0(0x248)]||'Unknown\x20error'));throw new Error(_0x39f8e0(0x24a)+(_0x4a4344[_0x39f8e0(0x1f0)]||_0x4a4344[_0x39f8e0(0x248)]||_0x39f8e0(0x1eb)));}let _0x1f02de=_0x39f8e0(0x1ec);if(_0x4a4344['isActive']===![]){if(_0x4a4344[_0x39f8e0(0x1f2)]){const _0x1afe2b=new Date(_0x4a4344[_0x39f8e0(0x1f2)]),_0x15a20f=new Date();_0x1afe2b<_0x15a20f?_0x1f02de='EXPIRED':_0x1f02de='FAILED';}else _0x1f02de=_0x39f8e0(0x1f6);}else _0x1f02de=_0x39f8e0(0x1ec);return{'status':_0x1f02de,'amount':_0x4a4344['amount'],'currency':_0x4a4344[_0x39f8e0(0x239)],'isActive':_0x4a4344[_0x39f8e0(0x22c)]};}catch(_0x464863){console[_0x39f8e0(0x248)](_0x39f8e0(0x22f),_0x464863),loggerService_1[_0x39f8e0(0x1fa)]['logWhiteDomainError'](_0x39f8e0(0x210),'/payment-links/'+_0x4d59fb,_0x464863);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x464863 instanceof Error?_0x464863[_0x39f8e0(0x1f0)]:_0x39f8e0(0x1eb)));}}async['processWebhook'](_0x58afa6){const _0x32b9ea=a43_0x365a97;console[_0x32b9ea(0x1f8)]('Processing\x20Noda\x20webhook:',_0x58afa6);let _0xc5f170=_0x32b9ea(0x1ec);switch(_0x58afa6['Status']?.[_0x32b9ea(0x211)]()){case _0x32b9ea(0x207):case _0x32b9ea(0x24f):case'paid':case'success':case _0x32b9ea(0x222):_0x58afa6[_0x32b9ea(0x249)]===_0x32b9ea(0x24e)?_0xc5f170=_0x32b9ea(0x209):_0xc5f170=_0x32b9ea(0x1ec);break;case _0x32b9ea(0x221):case _0x32b9ea(0x242):case _0x32b9ea(0x231):case'error':case _0x32b9ea(0x23c):_0xc5f170=_0x32b9ea(0x1f6);break;case _0x32b9ea(0x213):case _0x32b9ea(0x1e4):_0xc5f170=_0x32b9ea(0x21b);break;case _0x32b9ea(0x21e):case _0x32b9ea(0x1f5):case _0x32b9ea(0x1e1):case _0x32b9ea(0x1ea):case _0x32b9ea(0x1f4):default:_0xc5f170='PENDING';break;}return{'paymentId':_0x58afa6[_0x32b9ea(0x216)]||_0x58afa6['PaymentId'],'status':_0xc5f170,'amount':_0x58afa6[_0x32b9ea(0x200)],'currency':_0x58afa6[_0x32b9ea(0x23b)],'additionalInfo':{'method':_0x58afa6[_0x32b9ea(0x241)],'bankId':_0x58afa6['BankId'],'settled':_0x58afa6[_0x32b9ea(0x249)],'settlementDate':_0x58afa6[_0x32b9ea(0x1e5)],'remitterName':_0x58afa6[_0x32b9ea(0x23f)]?.[_0x32b9ea(0x21c)],'remitterIban':_0x58afa6[_0x32b9ea(0x23f)]?.[_0x32b9ea(0x226)],'bankTransactionId':_0x58afa6[_0x32b9ea(0x230)]}};}['verifyWebhookSignature'](_0x166169,_0x581ce5){const _0x4ab977=a43_0x365a97;return console[_0x4ab977(0x1f8)](_0x4ab977(0x1da),{'receivedSignature':_0x581ce5,'paymentId':_0x166169[_0x4ab977(0x228)],'merchantPaymentId':_0x166169[_0x4ab977(0x216)]}),!![];}}function a43_0x5346(_0x217282,_0x250c80){const _0x3986f9=a43_0x3986();return a43_0x5346=function(_0x534630,_0x518775){_0x534630=_0x534630-0x1d9;let _0x24a3d0=_0x3986f9[_0x534630];return _0x24a3d0;},a43_0x5346(_0x217282,_0x250c80);}function a43_0x3986(){const _0x3e7713=['Parsed\x20Result:','Unknown\x20error\x20from\x20Noda\x20API','createPaymentLink','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Error\x20stack:','https://tesoft.uk/gateway/noda/webhook/','Noda\x20webhook\x20signature\x20verification:','122192ZdwHYX','Short\x20Link:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','102594dVUyhV','1842660TBihNs','shortLinkUrls','active','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','(8digits-8digits\x20format)','timeout','SettlementDate','now','QR\x20Code\x20Link:','Response\x20data:','logWhiteDomainError','processing','Unknown\x20error','PENDING','logWhiteDomainRequest','115lmZWcK','text','message','GET','expiryDate','===\x20PARSED\x20NODA\x20RESPONSE\x20===','in_progress','created','FAILED','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','log','Error\x20details:','loggerService','Error\x20Message:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','POST','status','stack','Amount','Failed\x20to\x20parse\x20JSON\x20response:','TesSoft\x20Payment\x20System/1.0','entries','../loggerService','NodaService','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','done','HTTP\x20error!\x20status:\x20','PAID','__esModule','===\x20NODA\x20SERVICE\x20ERROR\x20===','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','752016pYDQFQ','apiUrl','JSON\x20Parse\x20Error:\x20','noda','toLowerCase','Order\x20ID\x20Format:','expired','Business\x20Error:\x20','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','MerchantPaymentId','/payment-links','https://tesoft.uk/gateway/noda/','shortLink','logWhiteDomainResponse','EXPIRED','Name','application/json','pending','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','cancelled','successful','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','27wEsDDf','3QetZiz','Iban','Order\x20ID\x20Used:','PaymentId','2386524OVxdHI','HTTP\x20','qrCodeLink','isActive','Raw\x20Response\x20Body:','stringify','Noda\x20payment\x20verification\x20error:','BankTransactionId','failed','statusCode','json','verifyPayment','495kuFUPo','parse','===\x20NODA\x20API\x20ERROR\x20===','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','currency','Missing\x20id\x20or\x20shortLink\x20in\x20response','Currency','rejected','/payment-links/','headers','Remitter','Response\x20Time:','Method','canceled',',\x20body:\x20','statusText','Error\x20message:','https://tesoft.uk/gateway/pending.php?id=','Status\x20Text:','error','Settled','Noda\x20API\x20error:\x20','200150jHucFZ','271946gcXOYF','Status:','Yes','completed'];a43_0x3986=function(){return _0x3e7713;};return a43_0x3986();}exports[a43_0x365a97(0x205)]=NodaService;