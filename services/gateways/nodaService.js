'use strict';function a44_0x445c(_0x32b9c1,_0x20c52d){const _0x291e2a=a44_0x291e();return a44_0x445c=function(_0x445cf1,_0x38a4ba){_0x445cf1=_0x445cf1-0x169;let _0x55b727=_0x291e2a[_0x445cf1];return _0x55b727;},a44_0x445c(_0x32b9c1,_0x20c52d);}const a44_0x503205=a44_0x445c;(function(_0xb6b51,_0x26257d){const _0xb10cc4=a44_0x445c,_0x235d1b=_0xb6b51();while(!![]){try{const _0x1e9c47=-parseInt(_0xb10cc4(0x1c2))/0x1+parseInt(_0xb10cc4(0x1aa))/0x2*(-parseInt(_0xb10cc4(0x1cf))/0x3)+parseInt(_0xb10cc4(0x1de))/0x4*(-parseInt(_0xb10cc4(0x1c5))/0x5)+-parseInt(_0xb10cc4(0x17e))/0x6+parseInt(_0xb10cc4(0x193))/0x7*(-parseInt(_0xb10cc4(0x172))/0x8)+-parseInt(_0xb10cc4(0x1d9))/0x9+parseInt(_0xb10cc4(0x194))/0xa*(parseInt(_0xb10cc4(0x1ca))/0xb);if(_0x1e9c47===_0x26257d)break;else _0x235d1b['push'](_0x235d1b['shift']());}catch(_0x458e14){_0x235d1b['push'](_0x235d1b['shift']());}}}(a44_0x291e,0x21b1a));Object[a44_0x503205(0x1e5)](exports,'__esModule',{'value':!![]}),exports[a44_0x503205(0x192)]=void 0x0;const loggerService_1=require(a44_0x503205(0x188));class NodaService{constructor(){const _0x4fe55f=a44_0x503205;this[_0x4fe55f(0x1b0)]=_0x4fe55f(0x1b1),console[_0x4fe55f(0x19a)](_0x4fe55f(0x19b));}async['createPaymentLink'](_0x35131b){const _0x40ba84=a44_0x503205,{orderId:_0x327af8,name:_0x2295df,paymentDescription:_0x28666a,amount:_0x191f2d,currency:_0xc9aafc,webhookUrl:_0x18d35f,returnUrl:_0x12ccdd,expiryDate:_0x6b8f0a}=_0x35131b,_0x29cad5=_0xc9aafc[_0x40ba84(0x1c1)](),_0x30b5e5='https://tesoft.uk/gateway/noda/webhook/',_0x228234=_0x40ba84(0x17f)+_0x327af8,_0x51acab={'name':_0x2295df,'paymentDescription':_0x28666a,'amount':_0x191f2d,'currency':_0x29cad5,'paymentId':_0x327af8,'webhookUrl':_0x30b5e5,'returnUrl':_0x228234};_0x6b8f0a&&(_0x51acab[_0x40ba84(0x176)]=_0x6b8f0a);const _0x363979=Date['now']();try{console['log'](_0x40ba84(0x189)),console[_0x40ba84(0x19a)](_0x40ba84(0x1e8),this['apiUrl']),console[_0x40ba84(0x19a)](_0x40ba84(0x1bc),JSON[_0x40ba84(0x1b2)](_0x51acab,null,0x2)),console['log']('Order\x20ID\x20Format:',_0x327af8,_0x40ba84(0x177)),console[_0x40ba84(0x19a)](_0x40ba84(0x17c),_0x228234),loggerService_1['loggerService'][_0x40ba84(0x1a6)](_0x40ba84(0x171),_0x40ba84(0x1d2),_0x40ba84(0x181),_0x51acab);const _0x3af780=await fetch(this[_0x40ba84(0x1b0)],{'method':_0x40ba84(0x181),'headers':{'Content-Type':_0x40ba84(0x1b6),'Accept':_0x40ba84(0x1b6),'User-Agent':_0x40ba84(0x198)},'body':JSON['stringify'](_0x51acab)}),_0x4433a5=Date['now']()-_0x363979;console[_0x40ba84(0x19a)](_0x40ba84(0x1c8)),console['log'](_0x40ba84(0x1ba),_0x3af780[_0x40ba84(0x1cd)]),console[_0x40ba84(0x19a)](_0x40ba84(0x1db),_0x3af780[_0x40ba84(0x180)]),console[_0x40ba84(0x19a)](_0x40ba84(0x1c9),Object[_0x40ba84(0x16f)](_0x3af780['headers'][_0x40ba84(0x1e3)]())),console[_0x40ba84(0x19a)](_0x40ba84(0x1ac),_0x4433a5+'ms');const _0x3bec9c=await _0x3af780[_0x40ba84(0x1e1)]();console['log'](_0x40ba84(0x1d7),_0x3bec9c);if(!_0x3af780['ok']){console[_0x40ba84(0x18d)](_0x40ba84(0x1a8)),console[_0x40ba84(0x18d)](_0x40ba84(0x1af),_0x3af780[_0x40ba84(0x1cd)]),console['error'](_0x40ba84(0x197),_0x3bec9c),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x40ba84(0x171),_0x40ba84(0x1d2),_0x3af780['status'],_0x3bec9c,_0x4433a5),loggerService_1[_0x40ba84(0x187)][_0x40ba84(0x182)](_0x40ba84(0x171),_0x40ba84(0x1d2),_0x40ba84(0x1b4)+_0x3af780[_0x40ba84(0x1cd)]+':\x20'+_0x3bec9c);if(_0x3af780[_0x40ba84(0x1cd)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x3af780[_0x40ba84(0x1cd)]===0x1f4)throw new Error(_0x40ba84(0x17a));}throw new Error(_0x40ba84(0x175)+_0x3af780[_0x40ba84(0x1cd)]+_0x40ba84(0x199)+_0x3bec9c);}let _0x8a61d6;try{_0x8a61d6=JSON[_0x40ba84(0x1a9)](_0x3bec9c);}catch(_0x681bf3){console[_0x40ba84(0x18d)](_0x40ba84(0x1b8),_0x681bf3),loggerService_1[_0x40ba84(0x187)]['logWhiteDomainError'](_0x40ba84(0x171),_0x40ba84(0x1d2),'JSON\x20Parse\x20Error:\x20'+_0x681bf3);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x3bec9c);}console[_0x40ba84(0x19a)](_0x40ba84(0x1c6)),console[_0x40ba84(0x19a)](_0x40ba84(0x1e0),JSON[_0x40ba84(0x1b2)](_0x8a61d6,null,0x2)),loggerService_1[_0x40ba84(0x187)]['logWhiteDomainResponse'](_0x40ba84(0x171),_0x40ba84(0x1d2),_0x3af780[_0x40ba84(0x1cd)],_0x8a61d6,_0x4433a5);if(_0x8a61d6['error']||_0x8a61d6['statusCode']){const _0x530d80=_0x8a61d6[_0x40ba84(0x1a0)]||_0x8a61d6[_0x40ba84(0x18d)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x40ba84(0x18d)](_0x40ba84(0x1c7)),console['error']('Error\x20Message:',_0x530d80),console[_0x40ba84(0x18d)](_0x40ba84(0x1a4),_0x8a61d6[_0x40ba84(0x18c)]),loggerService_1[_0x40ba84(0x187)][_0x40ba84(0x182)](_0x40ba84(0x171),_0x40ba84(0x1d2),_0x40ba84(0x1df)+_0x530d80);throw new Error(_0x40ba84(0x170)+_0x530d80);}if(!_0x8a61d6['id']||!_0x8a61d6[_0x40ba84(0x196)]?.['shortLink']){console[_0x40ba84(0x18d)](_0x40ba84(0x1b7)),console[_0x40ba84(0x18d)](_0x40ba84(0x1dd)),console[_0x40ba84(0x18d)](_0x40ba84(0x1ae),_0x8a61d6),loggerService_1[_0x40ba84(0x187)][_0x40ba84(0x182)](_0x40ba84(0x171),_0x40ba84(0x1d2),_0x40ba84(0x1e2));throw new Error(_0x40ba84(0x1ce));}return console[_0x40ba84(0x19a)](_0x40ba84(0x16d)),console[_0x40ba84(0x19a)](_0x40ba84(0x1a2),_0x8a61d6['id']),console[_0x40ba84(0x19a)]('Short\x20Link:',_0x8a61d6[_0x40ba84(0x196)][_0x40ba84(0x1c4)]),console[_0x40ba84(0x19a)](_0x40ba84(0x183),_0x8a61d6[_0x40ba84(0x196)][_0x40ba84(0x1bd)]||_0x40ba84(0x16c)),console['log']('Order\x20ID\x20Used:',_0x327af8,_0x40ba84(0x1d5)),console[_0x40ba84(0x19a)](_0x40ba84(0x19d),_0x228234),{'gateway_payment_id':_0x8a61d6['id'],'payment_url':_0x8a61d6[_0x40ba84(0x196)][_0x40ba84(0x1c4)],'qr_code_url':_0x8a61d6[_0x40ba84(0x196)][_0x40ba84(0x1bd)],'expiry_date':_0x8a61d6[_0x40ba84(0x176)]};}catch(_0x4e264d){console['error'](_0x40ba84(0x18f)),console[_0x40ba84(0x18d)](_0x40ba84(0x1be),_0x4e264d),loggerService_1['loggerService'][_0x40ba84(0x182)](_0x40ba84(0x171),_0x40ba84(0x1d2),_0x4e264d);if(_0x4e264d instanceof Error){console[_0x40ba84(0x18d)]('Error\x20message:',_0x4e264d[_0x40ba84(0x1a0)]),console[_0x40ba84(0x18d)]('Error\x20stack:',_0x4e264d[_0x40ba84(0x1da)]);throw new Error(_0x40ba84(0x16a)+_0x4e264d[_0x40ba84(0x1a0)]);}throw new Error(_0x40ba84(0x179));}}async[a44_0x503205(0x1d1)](_0x405d2f){const _0x10ec41=a44_0x503205,_0x25443e=Date['now']();try{loggerService_1[_0x10ec41(0x187)][_0x10ec41(0x1a6)](_0x10ec41(0x171),_0x10ec41(0x1ad)+_0x405d2f,_0x10ec41(0x1ab),{});const _0x3a054a=await fetch(this[_0x10ec41(0x1b0)]+'/'+_0x405d2f,{'method':_0x10ec41(0x1ab),'headers':{'Content-Type':_0x10ec41(0x1b6),'User-Agent':_0x10ec41(0x198)}}),_0x5a1764=Date[_0x10ec41(0x18a)]()-_0x25443e;if(!_0x3a054a['ok']){const _0xd4b055=await _0x3a054a[_0x10ec41(0x1e1)]();loggerService_1[_0x10ec41(0x187)][_0x10ec41(0x1e7)]('noda',_0x10ec41(0x1ad)+_0x405d2f,_0x3a054a[_0x10ec41(0x1cd)],_0xd4b055,_0x5a1764);throw new Error(_0x10ec41(0x175)+_0x3a054a[_0x10ec41(0x1cd)]);}const _0xd65ff8=await _0x3a054a[_0x10ec41(0x173)]();loggerService_1[_0x10ec41(0x187)]['logWhiteDomainResponse']('noda','/payment-links/'+_0x405d2f,_0x3a054a[_0x10ec41(0x1cd)],_0xd65ff8,_0x5a1764);if(_0xd65ff8[_0x10ec41(0x18d)]||_0xd65ff8[_0x10ec41(0x18c)]){loggerService_1['loggerService'][_0x10ec41(0x182)]('noda','/payment-links/'+_0x405d2f,_0x10ec41(0x170)+(_0xd65ff8[_0x10ec41(0x1a0)]||_0xd65ff8[_0x10ec41(0x18d)]||_0x10ec41(0x184)));throw new Error(_0x10ec41(0x170)+(_0xd65ff8[_0x10ec41(0x1a0)]||_0xd65ff8[_0x10ec41(0x18d)]||_0x10ec41(0x184)));}let _0x1e27bc=_0x10ec41(0x195);if(_0xd65ff8['isActive']===![]){if(_0xd65ff8[_0x10ec41(0x176)]){const _0x489a6a=new Date(_0xd65ff8[_0x10ec41(0x176)]),_0x309d70=new Date();_0x489a6a<_0x309d70?_0x1e27bc=_0x10ec41(0x1bb):_0x1e27bc=_0x10ec41(0x19e);}else _0x1e27bc=_0x10ec41(0x19e);}else _0x1e27bc=_0x10ec41(0x195);return{'status':_0x1e27bc,'amount':_0xd65ff8[_0x10ec41(0x19c)],'currency':_0xd65ff8[_0x10ec41(0x1a5)],'isActive':_0xd65ff8['isActive']};}catch(_0x382a38){console['error'](_0x10ec41(0x1b9),_0x382a38),loggerService_1[_0x10ec41(0x187)][_0x10ec41(0x182)]('noda','/payment-links/'+_0x405d2f,_0x382a38);throw new Error(_0x10ec41(0x19f)+(_0x382a38 instanceof Error?_0x382a38[_0x10ec41(0x1a0)]:_0x10ec41(0x184)));}}async[a44_0x503205(0x1e6)](_0x1456b2){const _0x29c0fb=a44_0x503205;console[_0x29c0fb(0x19a)](_0x29c0fb(0x1a1),_0x1456b2);let _0x2f5ba4=_0x29c0fb(0x195);switch(_0x1456b2[_0x29c0fb(0x17d)]?.['toLowerCase']()){case _0x29c0fb(0x1b5):case _0x29c0fb(0x1a3):case'paid':case _0x29c0fb(0x18b):case _0x29c0fb(0x1c3):_0x1456b2[_0x29c0fb(0x17b)]===_0x29c0fb(0x169)?_0x2f5ba4=_0x29c0fb(0x1d8):_0x2f5ba4=_0x29c0fb(0x195);break;case _0x29c0fb(0x1cb):case _0x29c0fb(0x1d6):case _0x29c0fb(0x1b3):case _0x29c0fb(0x18d):case'rejected':_0x2f5ba4=_0x29c0fb(0x19e);break;case _0x29c0fb(0x16b):case _0x29c0fb(0x1d4):_0x2f5ba4=_0x29c0fb(0x1bb);break;case _0x29c0fb(0x174):case _0x29c0fb(0x191):case _0x29c0fb(0x186):case _0x29c0fb(0x1cc):case _0x29c0fb(0x18e):default:_0x2f5ba4=_0x29c0fb(0x195);break;}return{'paymentId':_0x1456b2[_0x29c0fb(0x1d0)]||_0x1456b2['PaymentId'],'status':_0x2f5ba4,'amount':_0x1456b2[_0x29c0fb(0x1e4)],'currency':_0x1456b2[_0x29c0fb(0x1c0)],'additionalInfo':{'method':_0x1456b2[_0x29c0fb(0x1a7)],'bankId':_0x1456b2[_0x29c0fb(0x190)],'settled':_0x1456b2[_0x29c0fb(0x17b)],'settlementDate':_0x1456b2['SettlementDate'],'remitterName':_0x1456b2[_0x29c0fb(0x16e)]?.[_0x29c0fb(0x1dc)],'remitterIban':_0x1456b2[_0x29c0fb(0x16e)]?.[_0x29c0fb(0x1bf)],'bankTransactionId':_0x1456b2[_0x29c0fb(0x1d3)]}};}[a44_0x503205(0x178)](_0x331c44,_0x4465b3){const _0x4901f1=a44_0x503205;return console[_0x4901f1(0x19a)](_0x4901f1(0x185),{'receivedSignature':_0x4465b3,'paymentId':_0x331c44['PaymentId'],'merchantPaymentId':_0x331c44[_0x4901f1(0x1d0)]}),!![];}}function a44_0x291e(){const _0x177dfb=['stringify','failed','HTTP\x20','done','application/json','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20parse\x20JSON\x20response:','Noda\x20payment\x20verification\x20error:','Status:','EXPIRED','Request\x20Body\x20(Direct\x20JSON):','qrCodeLink','Error\x20details:','Iban','Currency','toUpperCase','92851JKufFD','successful','shortLink','135LjHpDe','===\x20PARSED\x20NODA\x20RESPONSE\x20===','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Headers:','20471KmdsYv','cancelled','processing','status','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','200559oAnHzY','MerchantPaymentId','verifyPayment','/payment-links','BankTransactionId','timeout','(8digits-8digits\x20format)','canceled','Raw\x20Response\x20Body:','PAID','1483587gGHKBR','stack','Status\x20Text:','Name','Missing\x20id\x20or\x20shortLink\x20in\x20response','28532AmPsTw','Business\x20Error:\x20','Parsed\x20Result:','text','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','entries','Amount','defineProperty','processWebhook','logWhiteDomainResponse','URL:','Yes','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','expired','Not\x20provided','===\x20NODA\x20SUCCESS\x20===','Remitter','fromEntries','Noda\x20API\x20error:\x20','noda','14904jQypWj','json','pending','HTTP\x20error!\x20status:\x20','expiryDate','(8digits-8digits\x20format\x20for\x20Noda)','verifyWebhookSignature','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Settled','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','Status','1564176RWvygI','https://tesoft.uk/gateway/pending.php?id=','statusText','POST','logWhiteDomainError','QR\x20Code\x20Link:','Unknown\x20error','Noda\x20webhook\x20signature\x20verification:','active','loggerService','../loggerService','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','now','success','statusCode','error','in_progress','===\x20NODA\x20SERVICE\x20ERROR\x20===','BankId','created','NodaService','189hfEKai','5910zNGfvP','PENDING','shortLinkUrls','Response\x20Body:','TesSoft\x20Payment\x20System/1.0',',\x20body:\x20','log','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','amount','✅\x20Return\x20URL\x20configured\x20for\x20pending:','FAILED','Failed\x20to\x20verify\x20Noda\x20payment:\x20','message','Processing\x20Noda\x20webhook:','Payment\x20Link\x20ID:','completed','Status\x20Code:','currency','logWhiteDomainRequest','Method','===\x20NODA\x20API\x20ERROR\x20===','parse','6urnLle','GET','Response\x20Time:','/payment-links/','Response\x20data:','HTTP\x20Status:','apiUrl','https://tesoft.uk/gateway/noda/'];a44_0x291e=function(){return _0x177dfb;};return a44_0x291e();}exports[a44_0x503205(0x192)]=NodaService;