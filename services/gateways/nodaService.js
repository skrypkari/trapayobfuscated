'use strict';function a43_0x48e8(_0x11c1be,_0x347dfa){const _0x21b7d8=a43_0x21b7();return a43_0x48e8=function(_0x48e856,_0x41e899){_0x48e856=_0x48e856-0x1cd;let _0x127976=_0x21b7d8[_0x48e856];return _0x127976;},a43_0x48e8(_0x11c1be,_0x347dfa);}const a43_0x4d343c=a43_0x48e8;(function(_0x2b0032,_0x541d17){const _0x15dbc3=a43_0x48e8,_0x46c7c8=_0x2b0032();while(!![]){try{const _0x26f836=-parseInt(_0x15dbc3(0x212))/0x1+-parseInt(_0x15dbc3(0x1d9))/0x2*(-parseInt(_0x15dbc3(0x213))/0x3)+-parseInt(_0x15dbc3(0x1f7))/0x4*(parseInt(_0x15dbc3(0x1dd))/0x5)+parseInt(_0x15dbc3(0x243))/0x6+-parseInt(_0x15dbc3(0x1e0))/0x7*(parseInt(_0x15dbc3(0x216))/0x8)+parseInt(_0x15dbc3(0x1d1))/0x9+parseInt(_0x15dbc3(0x200))/0xa;if(_0x26f836===_0x541d17)break;else _0x46c7c8['push'](_0x46c7c8['shift']());}catch(_0x2724df){_0x46c7c8['push'](_0x46c7c8['shift']());}}}(a43_0x21b7,0xf18e0));Object[a43_0x4d343c(0x21f)](exports,a43_0x4d343c(0x1d3),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require('../loggerService');function a43_0x21b7(){const _0x35d128=['(8digits-8digits\x20format\x20for\x20Noda)','Order\x20ID\x20Format:','pending','application/json','stack','https://tesoft.uk/gateway/pending.php?id=','Error\x20details:','noda','Amount','Status\x20Text:','1510566nCiVqf','createPaymentLink','Yes','successful','isActive','4431906mkWLSv','Unknown\x20error\x20from\x20Noda\x20API','__esModule','Response\x20Body:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','expiryDate','error','Raw\x20Response\x20Body:','2dHdleD','Processing\x20Noda\x20webhook:','HTTP\x20','cancelled','889235ecTTOi','canceled','headers','81914dVvPMO','logWhiteDomainRequest','Response\x20data:','shortLink','status','message','PaymentId','POST','entries','statusCode','Noda\x20API\x20error:\x20','Request\x20Body\x20(Direct\x20JSON):','TesSoft\x20Payment\x20System/1.0','BankTransactionId','Status','verifyPayment','in_progress','amount','https://tesoft.uk/gateway/noda/','URL:','Short\x20Link:','Error\x20Message:','failed','12gbyMMR','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Status\x20Code:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Settled','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',',\x20body:\x20','toUpperCase','now','6216890cACmjN','MerchantPaymentId','Parsed\x20Result:','Unknown\x20error','apiUrl','currency','done','paid','PENDING','Name','log','PAID','/payment-links','/payment-links/','BankId','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','qrCodeLink','loggerService','1718821hftXRy','5803188eUjqUE','success','JSON\x20Parse\x20Error:\x20','40cfIeYc','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','active','Noda\x20payment\x20verification\x20error:','===\x20NODA\x20SERVICE\x20ERROR\x20===','logWhiteDomainError','FAILED','Not\x20provided','Headers:','defineProperty','created','Error\x20stack:','Payment\x20Link\x20ID:','logWhiteDomainResponse','timeout','Business\x20Error:\x20','Iban','HTTP\x20error!\x20status:\x20','===\x20NODA\x20SUCCESS\x20===','EXPIRED','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','QR\x20Code\x20Link:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','NodaService','Currency','statusText','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','processing','Remitter','shortLinkUrls','Order\x20ID\x20Used:','(8digits-8digits\x20format)','SettlementDate','GET','stringify'];a43_0x21b7=function(){return _0x35d128;};return a43_0x21b7();}class NodaService{constructor(){const _0x1dbb8d=a43_0x4d343c;this[_0x1dbb8d(0x204)]=_0x1dbb8d(0x1f2),console[_0x1dbb8d(0x20a)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a43_0x4d343c(0x1cd)](_0x415ada){const _0x112cd=a43_0x4d343c,{orderId:_0x377298,name:_0x30476a,paymentDescription:_0xeb7094,amount:_0x18752b,currency:_0x45e64b,webhookUrl:_0x5e18ba,returnUrl:_0x3f73d7,expiryDate:_0x453638}=_0x415ada,_0x473f7a=_0x45e64b[_0x112cd(0x1fe)](),_0x5523a1='https://tesoft.uk/gateway/noda/webhook/',_0x102697=_0x112cd(0x23e)+_0x377298,_0x21735e={'name':_0x30476a,'paymentDescription':_0xeb7094,'amount':_0x18752b,'currency':_0x473f7a,'paymentId':_0x377298,'webhookUrl':_0x5523a1,'returnUrl':_0x102697};_0x453638&&(_0x21735e['expiryDate']=_0x453638);const _0x1bd982=Date['now']();try{console['log'](_0x112cd(0x1f8)),console[_0x112cd(0x20a)](_0x112cd(0x1f3),this[_0x112cd(0x204)]),console[_0x112cd(0x20a)](_0x112cd(0x1eb),JSON[_0x112cd(0x238)](_0x21735e,null,0x2)),console[_0x112cd(0x20a)](_0x112cd(0x23a),_0x377298,_0x112cd(0x239)),console[_0x112cd(0x20a)](_0x112cd(0x22c),_0x102697),loggerService_1[_0x112cd(0x211)][_0x112cd(0x1e1)](_0x112cd(0x240),_0x112cd(0x20c),'POST',_0x21735e);const _0x4a8416=await fetch(this[_0x112cd(0x204)],{'method':_0x112cd(0x1e7),'headers':{'Content-Type':_0x112cd(0x23c),'Accept':_0x112cd(0x23c),'User-Agent':_0x112cd(0x1ec)},'body':JSON[_0x112cd(0x238)](_0x21735e)}),_0x423bdb=Date[_0x112cd(0x1ff)]()-_0x1bd982;console[_0x112cd(0x20a)](_0x112cd(0x22a)),console[_0x112cd(0x20a)]('Status:',_0x4a8416[_0x112cd(0x1e4)]),console[_0x112cd(0x20a)](_0x112cd(0x242),_0x4a8416[_0x112cd(0x22f)]),console[_0x112cd(0x20a)](_0x112cd(0x21e),Object['fromEntries'](_0x4a8416[_0x112cd(0x1df)][_0x112cd(0x1e8)]())),console[_0x112cd(0x20a)]('Response\x20Time:',_0x423bdb+'ms');const _0x4b18b2=await _0x4a8416['text']();console['log'](_0x112cd(0x1d8),_0x4b18b2);if(!_0x4a8416['ok']){console[_0x112cd(0x1d7)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x112cd(0x1d7)]('HTTP\x20Status:',_0x4a8416['status']),console['error'](_0x112cd(0x1d4),_0x4b18b2),loggerService_1[_0x112cd(0x211)][_0x112cd(0x223)](_0x112cd(0x240),'/payment-links',_0x4a8416[_0x112cd(0x1e4)],_0x4b18b2,_0x423bdb),loggerService_1['loggerService']['logWhiteDomainError'](_0x112cd(0x240),_0x112cd(0x20c),_0x112cd(0x1db)+_0x4a8416[_0x112cd(0x1e4)]+':\x20'+_0x4b18b2);if(_0x4a8416[_0x112cd(0x1e4)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x4a8416[_0x112cd(0x1e4)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x112cd(0x227)+_0x4a8416[_0x112cd(0x1e4)]+_0x112cd(0x1fd)+_0x4b18b2);}let _0x3038a3;try{_0x3038a3=JSON['parse'](_0x4b18b2);}catch(_0x466666){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x466666),loggerService_1[_0x112cd(0x211)][_0x112cd(0x21b)](_0x112cd(0x240),'/payment-links',_0x112cd(0x215)+_0x466666);throw new Error(_0x112cd(0x230)+_0x4b18b2);}console[_0x112cd(0x20a)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x112cd(0x20a)](_0x112cd(0x202),JSON[_0x112cd(0x238)](_0x3038a3,null,0x2)),loggerService_1[_0x112cd(0x211)][_0x112cd(0x223)]('noda',_0x112cd(0x20c),_0x4a8416[_0x112cd(0x1e4)],_0x3038a3,_0x423bdb);if(_0x3038a3[_0x112cd(0x1d7)]||_0x3038a3[_0x112cd(0x1e9)]){const _0x240767=_0x3038a3[_0x112cd(0x1e5)]||_0x3038a3[_0x112cd(0x1d7)]||_0x112cd(0x1d2);console[_0x112cd(0x1d7)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x112cd(0x1d7)](_0x112cd(0x1f5),_0x240767),console[_0x112cd(0x1d7)](_0x112cd(0x1f9),_0x3038a3['statusCode']),loggerService_1['loggerService'][_0x112cd(0x21b)]('noda','/payment-links',_0x112cd(0x225)+_0x240767);throw new Error(_0x112cd(0x1ea)+_0x240767);}if(!_0x3038a3['id']||!_0x3038a3[_0x112cd(0x233)]?.[_0x112cd(0x1e3)]){console[_0x112cd(0x1d7)](_0x112cd(0x217)),console[_0x112cd(0x1d7)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console['error'](_0x112cd(0x1e2),_0x3038a3),loggerService_1['loggerService'][_0x112cd(0x21b)](_0x112cd(0x240),_0x112cd(0x20c),_0x112cd(0x20f));throw new Error(_0x112cd(0x1d5));}return console[_0x112cd(0x20a)](_0x112cd(0x228)),console[_0x112cd(0x20a)](_0x112cd(0x222),_0x3038a3['id']),console['log'](_0x112cd(0x1f4),_0x3038a3[_0x112cd(0x233)]['shortLink']),console['log'](_0x112cd(0x22b),_0x3038a3[_0x112cd(0x233)][_0x112cd(0x210)]||_0x112cd(0x21d)),console['log'](_0x112cd(0x234),_0x377298,_0x112cd(0x235)),console[_0x112cd(0x20a)](_0x112cd(0x1fc),_0x102697),{'gateway_payment_id':_0x3038a3['id'],'payment_url':_0x3038a3['shortLinkUrls'][_0x112cd(0x1e3)],'qr_code_url':_0x3038a3[_0x112cd(0x233)][_0x112cd(0x210)],'expiry_date':_0x3038a3['expiryDate']};}catch(_0x343a56){console[_0x112cd(0x1d7)](_0x112cd(0x21a)),console['error'](_0x112cd(0x23f),_0x343a56),loggerService_1[_0x112cd(0x211)][_0x112cd(0x21b)](_0x112cd(0x240),_0x112cd(0x20c),_0x343a56);if(_0x343a56 instanceof Error){console[_0x112cd(0x1d7)]('Error\x20message:',_0x343a56[_0x112cd(0x1e5)]),console[_0x112cd(0x1d7)](_0x112cd(0x221),_0x343a56[_0x112cd(0x23d)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x343a56[_0x112cd(0x1e5)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x4d343c(0x1ef)](_0x6714a){const _0x326f07=a43_0x4d343c,_0x434bda=Date[_0x326f07(0x1ff)]();try{loggerService_1['loggerService'][_0x326f07(0x1e1)](_0x326f07(0x240),_0x326f07(0x20d)+_0x6714a,_0x326f07(0x237),{});const _0x2236ea=await fetch(this['apiUrl']+'/'+_0x6714a,{'method':_0x326f07(0x237),'headers':{'Content-Type':_0x326f07(0x23c),'User-Agent':_0x326f07(0x1ec)}}),_0x16b817=Date['now']()-_0x434bda;if(!_0x2236ea['ok']){const _0x22384d=await _0x2236ea['text']();loggerService_1[_0x326f07(0x211)]['logWhiteDomainResponse'](_0x326f07(0x240),_0x326f07(0x20d)+_0x6714a,_0x2236ea[_0x326f07(0x1e4)],_0x22384d,_0x16b817);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2236ea[_0x326f07(0x1e4)]);}const _0x518867=await _0x2236ea['json']();loggerService_1[_0x326f07(0x211)][_0x326f07(0x223)](_0x326f07(0x240),_0x326f07(0x20d)+_0x6714a,_0x2236ea['status'],_0x518867,_0x16b817);if(_0x518867[_0x326f07(0x1d7)]||_0x518867[_0x326f07(0x1e9)]){loggerService_1[_0x326f07(0x211)][_0x326f07(0x21b)](_0x326f07(0x240),_0x326f07(0x20d)+_0x6714a,_0x326f07(0x1ea)+(_0x518867[_0x326f07(0x1e5)]||_0x518867[_0x326f07(0x1d7)]||'Unknown\x20error'));throw new Error(_0x326f07(0x1ea)+(_0x518867[_0x326f07(0x1e5)]||_0x518867[_0x326f07(0x1d7)]||_0x326f07(0x203)));}let _0x30cc52=_0x326f07(0x208);if(_0x518867['isActive']===![]){if(_0x518867[_0x326f07(0x1d6)]){const _0x252447=new Date(_0x518867[_0x326f07(0x1d6)]),_0x401a5=new Date();_0x252447<_0x401a5?_0x30cc52=_0x326f07(0x229):_0x30cc52=_0x326f07(0x21c);}else _0x30cc52=_0x326f07(0x21c);}else _0x30cc52=_0x326f07(0x208);return{'status':_0x30cc52,'amount':_0x518867[_0x326f07(0x1f1)],'currency':_0x518867[_0x326f07(0x205)],'isActive':_0x518867[_0x326f07(0x1d0)]};}catch(_0x2be997){console[_0x326f07(0x1d7)](_0x326f07(0x219),_0x2be997),loggerService_1[_0x326f07(0x211)][_0x326f07(0x21b)](_0x326f07(0x240),_0x326f07(0x20d)+_0x6714a,_0x2be997);throw new Error(_0x326f07(0x1fa)+(_0x2be997 instanceof Error?_0x2be997['message']:_0x326f07(0x203)));}}async['processWebhook'](_0x1a9460){const _0x1051a5=a43_0x4d343c;console[_0x1051a5(0x20a)](_0x1051a5(0x1da),_0x1a9460);let _0x447e9e='PENDING';switch(_0x1a9460[_0x1051a5(0x1ee)]?.['toLowerCase']()){case _0x1051a5(0x206):case'completed':case _0x1051a5(0x207):case _0x1051a5(0x214):case _0x1051a5(0x1cf):_0x1a9460[_0x1051a5(0x1fb)]===_0x1051a5(0x1ce)?_0x447e9e=_0x1051a5(0x20b):_0x447e9e=_0x1051a5(0x208);break;case _0x1051a5(0x1dc):case _0x1051a5(0x1de):case _0x1051a5(0x1f6):case'error':case'rejected':_0x447e9e=_0x1051a5(0x21c);break;case'expired':case _0x1051a5(0x224):_0x447e9e=_0x1051a5(0x229);break;case _0x1051a5(0x23b):case _0x1051a5(0x220):case _0x1051a5(0x218):case _0x1051a5(0x231):case _0x1051a5(0x1f0):default:_0x447e9e=_0x1051a5(0x208);break;}return{'paymentId':_0x1a9460[_0x1051a5(0x201)]||_0x1a9460['PaymentId'],'status':_0x447e9e,'amount':_0x1a9460[_0x1051a5(0x241)],'currency':_0x1a9460[_0x1051a5(0x22e)],'additionalInfo':{'method':_0x1a9460['Method'],'bankId':_0x1a9460[_0x1051a5(0x20e)],'settled':_0x1a9460['Settled'],'settlementDate':_0x1a9460[_0x1051a5(0x236)],'remitterName':_0x1a9460[_0x1051a5(0x232)]?.[_0x1051a5(0x209)],'remitterIban':_0x1a9460['Remitter']?.[_0x1051a5(0x226)],'bankTransactionId':_0x1a9460[_0x1051a5(0x1ed)]}};}['verifyWebhookSignature'](_0x5b8baf,_0xef1dd){const _0x11e365=a43_0x4d343c;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0xef1dd,'paymentId':_0x5b8baf[_0x11e365(0x1e6)],'merchantPaymentId':_0x5b8baf[_0x11e365(0x201)]}),!![];}}exports[a43_0x4d343c(0x22d)]=NodaService;