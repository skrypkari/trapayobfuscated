'use strict';function a53_0x2885(){const _0xea9827=[',\x20body:\x20','shortLinkUrls','pending','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','/payment-links','Error\x20Message:','amount','Name','1777683WwQjjd','===\x20NODA\x20SUCCESS\x20===','text','toUpperCase','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','logWhiteDomainRequest','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','logWhiteDomainError','Amount','50YBICwo','failed','verifyPayment','qrCodeLink','(8digits-8digits\x20format\x20for\x20Noda)','Missing\x20id\x20or\x20shortLink\x20in\x20response','paid','Error\x20stack:','application/json','Error\x20details:','error','noda','createPaymentLink','PaymentId','verifyWebhookSignature','QR\x20Code\x20Link:','successful','GET','20610gBfVlZ','BankTransactionId','Noda\x20API\x20error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','HTTP\x20error!\x20status:\x20','success','FAILED','20aKJiIY','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','7Ttukqg','https://tesoft.uk/gateway/noda/','PAID','stringify','expiryDate','119aPesip','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PENDING','done','now','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Status:','loggerService','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','rejected','POST','Request\x20Body\x20(Direct\x20JSON):','5043296KeuZXK','720531geCrrg','Currency','Business\x20Error:\x20','Response\x20Time:','Payment\x20Link\x20ID:','processing','Status','EXPIRED','Parsed\x20Result:','logWhiteDomainResponse','statusCode','Settled','/payment-links/','Method','https://tesoft.uk/gateway/noda/webhook/','NodaService','JSON\x20Parse\x20Error:\x20','parse','apiUrl','Failed\x20to\x20verify\x20Noda\x20payment:\x20','currency','created','shortLink','Short\x20Link:','Unknown\x20error\x20from\x20Noda\x20API','canceled','Status\x20Text:','entries','82032NBiVoJ','Not\x20provided','defineProperty','(8digits-8digits\x20format)','isActive','timeout','log','active','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Noda\x20payment\x20verification\x20error:','fromEntries','Processing\x20Noda\x20webhook:','message','Unknown\x20error','expired','===\x20NODA\x20API\x20ERROR\x20===','in_progress','https://tesoft.uk/gateway/pending.php?id=','===\x20NODA\x20SERVICE\x20ERROR\x20===','HTTP\x20Status:','Error\x20message:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Payment\x20System/1.0','__esModule','completed','BankId','Headers:','MerchantPaymentId','status','Noda\x20webhook\x20signature\x20verification:','Remitter','114385GOxWnv','2588520kFKGKI','Order\x20ID\x20Used:'];a53_0x2885=function(){return _0xea9827;};return a53_0x2885();}const a53_0x300333=a53_0x1134;(function(_0x5149d7,_0x2d0abd){const _0x1dc00c=a53_0x1134,_0x3e000f=_0x5149d7();while(!![]){try{const _0x392391=parseInt(_0x1dc00c(0x21b))/0x1*(parseInt(_0x1dc00c(0x249))/0x2)+-parseInt(_0x1dc00c(0x1f6))/0x3+parseInt(_0x1dc00c(0x219))/0x4*(parseInt(_0x1dc00c(0x1eb))/0x5)+parseInt(_0x1dc00c(0x212))/0x6*(parseInt(_0x1dc00c(0x220))/0x7)+parseInt(_0x1dc00c(0x22c))/0x8+parseInt(_0x1dc00c(0x22d))/0x9*(-parseInt(_0x1dc00c(0x200))/0xa)+parseInt(_0x1dc00c(0x1ec))/0xb;if(_0x392391===_0x2d0abd)break;else _0x3e000f['push'](_0x3e000f['shift']());}catch(_0x29a985){_0x3e000f['push'](_0x3e000f['shift']());}}}(a53_0x2885,0x513e0));Object[a53_0x300333(0x24b)](exports,a53_0x300333(0x260),{'value':!![]}),exports[a53_0x300333(0x23c)]=void 0x0;function a53_0x1134(_0x65cd70,_0x305ff3){const _0x288518=a53_0x2885();return a53_0x1134=function(_0x1134f8,_0x41e32f){_0x1134f8=_0x1134f8-0x1ea;let _0x339db2=_0x288518[_0x1134f8];return _0x339db2;},a53_0x1134(_0x65cd70,_0x305ff3);}const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x41ef2c=a53_0x300333;this[_0x41ef2c(0x23f)]=_0x41ef2c(0x21c),console[_0x41ef2c(0x24f)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a53_0x300333(0x20c)](_0xce40c4){const _0x29443b=a53_0x300333,{orderId:_0x25eb00,name:_0xc1700c,paymentDescription:_0x396a70,amount:_0x458c74,currency:_0x1cfc4d,webhookUrl:_0x108d43,returnUrl:_0x4aca1f,expiryDate:_0x378030}=_0xce40c4,_0x1280ab=_0x1cfc4d[_0x29443b(0x1f9)](),_0x3e2314=_0x29443b(0x23b),_0x4b1fbd=_0x29443b(0x25a)+_0x25eb00,_0x53f874={'name':_0xc1700c,'paymentDescription':_0x396a70,'amount':_0x458c74,'currency':_0x1280ab,'paymentId':_0x25eb00,'webhookUrl':_0x3e2314,'returnUrl':_0x4b1fbd};_0x378030&&(_0x53f874[_0x29443b(0x21f)]=_0x378030);const _0x494cec=Date[_0x29443b(0x224)]();try{console[_0x29443b(0x24f)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x29443b(0x24f)]('URL:',this[_0x29443b(0x23f)]),console[_0x29443b(0x24f)](_0x29443b(0x22b),JSON[_0x29443b(0x21e)](_0x53f874,null,0x2)),console[_0x29443b(0x24f)]('Order\x20ID\x20Format:',_0x25eb00,_0x29443b(0x204)),console[_0x29443b(0x24f)](_0x29443b(0x1fd),_0x4b1fbd),loggerService_1['loggerService'][_0x29443b(0x1fc)](_0x29443b(0x20b),_0x29443b(0x1f2),_0x29443b(0x22a),_0x53f874);const _0x21947c=await fetch(this['apiUrl'],{'method':_0x29443b(0x22a),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x29443b(0x25f)},'body':JSON[_0x29443b(0x21e)](_0x53f874)}),_0x43d129=Date[_0x29443b(0x224)]()-_0x494cec;console['log'](_0x29443b(0x251)),console[_0x29443b(0x24f)](_0x29443b(0x226),_0x21947c[_0x29443b(0x265)]),console[_0x29443b(0x24f)](_0x29443b(0x247),_0x21947c['statusText']),console['log'](_0x29443b(0x263),Object[_0x29443b(0x253)](_0x21947c['headers'][_0x29443b(0x248)]())),console['log'](_0x29443b(0x230),_0x43d129+'ms');const _0x1e73f4=await _0x21947c[_0x29443b(0x1f8)]();console[_0x29443b(0x24f)]('Raw\x20Response\x20Body:',_0x1e73f4);if(!_0x21947c['ok']){console['error'](_0x29443b(0x258)),console[_0x29443b(0x20a)](_0x29443b(0x25c),_0x21947c[_0x29443b(0x265)]),console[_0x29443b(0x20a)]('Response\x20Body:',_0x1e73f4),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x29443b(0x20b),_0x29443b(0x1f2),_0x21947c[_0x29443b(0x265)],_0x1e73f4,_0x43d129),loggerService_1[_0x29443b(0x227)][_0x29443b(0x1fe)]('noda',_0x29443b(0x1f2),'HTTP\x20'+_0x21947c['status']+':\x20'+_0x1e73f4);if(_0x21947c[_0x29443b(0x265)]===0x190)throw new Error(_0x29443b(0x1fb));else{if(_0x21947c['status']===0x1f4)throw new Error(_0x29443b(0x1fa));}throw new Error(_0x29443b(0x216)+_0x21947c[_0x29443b(0x265)]+_0x29443b(0x1ee)+_0x1e73f4);}let _0x1411ce;try{_0x1411ce=JSON[_0x29443b(0x23e)](_0x1e73f4);}catch(_0x3ffe7b){console[_0x29443b(0x20a)](_0x29443b(0x215),_0x3ffe7b),loggerService_1[_0x29443b(0x227)]['logWhiteDomainError'](_0x29443b(0x20b),'/payment-links',_0x29443b(0x23d)+_0x3ffe7b);throw new Error(_0x29443b(0x21a)+_0x1e73f4);}console['log'](_0x29443b(0x25e)),console[_0x29443b(0x24f)](_0x29443b(0x235),JSON['stringify'](_0x1411ce,null,0x2)),loggerService_1[_0x29443b(0x227)]['logWhiteDomainResponse'](_0x29443b(0x20b),_0x29443b(0x1f2),_0x21947c[_0x29443b(0x265)],_0x1411ce,_0x43d129);if(_0x1411ce[_0x29443b(0x20a)]||_0x1411ce['statusCode']){const _0x5d1134=_0x1411ce[_0x29443b(0x255)]||_0x1411ce[_0x29443b(0x20a)]||_0x29443b(0x245);console[_0x29443b(0x20a)](_0x29443b(0x228)),console[_0x29443b(0x20a)](_0x29443b(0x1f3),_0x5d1134),console[_0x29443b(0x20a)]('Status\x20Code:',_0x1411ce[_0x29443b(0x237)]),loggerService_1[_0x29443b(0x227)]['logWhiteDomainError'](_0x29443b(0x20b),_0x29443b(0x1f2),_0x29443b(0x22f)+_0x5d1134);throw new Error('Noda\x20API\x20error:\x20'+_0x5d1134);}if(!_0x1411ce['id']||!_0x1411ce['shortLinkUrls']?.['shortLink']){console[_0x29443b(0x20a)](_0x29443b(0x221)),console[_0x29443b(0x20a)](_0x29443b(0x205)),console[_0x29443b(0x20a)]('Response\x20data:',_0x1411ce),loggerService_1['loggerService'][_0x29443b(0x1fe)]('noda',_0x29443b(0x1f2),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x29443b(0x24f)](_0x29443b(0x1f7)),console[_0x29443b(0x24f)](_0x29443b(0x231),_0x1411ce['id']),console[_0x29443b(0x24f)](_0x29443b(0x244),_0x1411ce['shortLinkUrls'][_0x29443b(0x243)]),console[_0x29443b(0x24f)](_0x29443b(0x20f),_0x1411ce[_0x29443b(0x1ef)][_0x29443b(0x203)]||_0x29443b(0x24a)),console[_0x29443b(0x24f)](_0x29443b(0x1ed),_0x25eb00,_0x29443b(0x24c)),console[_0x29443b(0x24f)](_0x29443b(0x225),_0x4b1fbd),{'gateway_payment_id':_0x1411ce['id'],'payment_url':_0x1411ce[_0x29443b(0x1ef)][_0x29443b(0x243)],'qr_code_url':_0x1411ce[_0x29443b(0x1ef)][_0x29443b(0x203)],'expiry_date':_0x1411ce[_0x29443b(0x21f)]};}catch(_0x506c82){console[_0x29443b(0x20a)](_0x29443b(0x25b)),console[_0x29443b(0x20a)](_0x29443b(0x209),_0x506c82),loggerService_1[_0x29443b(0x227)][_0x29443b(0x1fe)](_0x29443b(0x20b),_0x29443b(0x1f2),_0x506c82);if(_0x506c82 instanceof Error){console[_0x29443b(0x20a)](_0x29443b(0x25d),_0x506c82[_0x29443b(0x255)]),console[_0x29443b(0x20a)](_0x29443b(0x207),_0x506c82['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x506c82['message']);}throw new Error(_0x29443b(0x1f1));}}async[a53_0x300333(0x202)](_0xd843fb){const _0x4793e4=a53_0x300333,_0x14239b=Date[_0x4793e4(0x224)]();try{loggerService_1['loggerService'][_0x4793e4(0x1fc)](_0x4793e4(0x20b),'/payment-links/'+_0xd843fb,_0x4793e4(0x211),{});const _0x39b5d6=await fetch(this[_0x4793e4(0x23f)]+'/'+_0xd843fb,{'method':_0x4793e4(0x211),'headers':{'Content-Type':_0x4793e4(0x208),'User-Agent':_0x4793e4(0x25f)}}),_0x551c65=Date['now']()-_0x14239b;if(!_0x39b5d6['ok']){const _0x3805bf=await _0x39b5d6[_0x4793e4(0x1f8)]();loggerService_1[_0x4793e4(0x227)][_0x4793e4(0x236)]('noda',_0x4793e4(0x239)+_0xd843fb,_0x39b5d6['status'],_0x3805bf,_0x551c65);throw new Error(_0x4793e4(0x216)+_0x39b5d6['status']);}const _0xeb331a=await _0x39b5d6['json']();loggerService_1[_0x4793e4(0x227)][_0x4793e4(0x236)](_0x4793e4(0x20b),_0x4793e4(0x239)+_0xd843fb,_0x39b5d6['status'],_0xeb331a,_0x551c65);if(_0xeb331a[_0x4793e4(0x20a)]||_0xeb331a[_0x4793e4(0x237)]){loggerService_1[_0x4793e4(0x227)][_0x4793e4(0x1fe)]('noda',_0x4793e4(0x239)+_0xd843fb,_0x4793e4(0x214)+(_0xeb331a[_0x4793e4(0x255)]||_0xeb331a['error']||_0x4793e4(0x256)));throw new Error(_0x4793e4(0x214)+(_0xeb331a['message']||_0xeb331a[_0x4793e4(0x20a)]||'Unknown\x20error'));}let _0x3a0247=_0x4793e4(0x222);if(_0xeb331a[_0x4793e4(0x24d)]===![]){if(_0xeb331a['expiryDate']){const _0x156964=new Date(_0xeb331a[_0x4793e4(0x21f)]),_0x361d66=new Date();_0x156964<_0x361d66?_0x3a0247=_0x4793e4(0x234):_0x3a0247=_0x4793e4(0x218);}else _0x3a0247=_0x4793e4(0x218);}else _0x3a0247='PENDING';return{'status':_0x3a0247,'amount':_0xeb331a[_0x4793e4(0x1f4)],'currency':_0xeb331a[_0x4793e4(0x241)],'isActive':_0xeb331a[_0x4793e4(0x24d)]};}catch(_0x4af556){console[_0x4793e4(0x20a)](_0x4793e4(0x252),_0x4af556),loggerService_1[_0x4793e4(0x227)][_0x4793e4(0x1fe)](_0x4793e4(0x20b),_0x4793e4(0x239)+_0xd843fb,_0x4af556);throw new Error(_0x4793e4(0x240)+(_0x4af556 instanceof Error?_0x4af556[_0x4793e4(0x255)]:'Unknown\x20error'));}}async['processWebhook'](_0x116aac){const _0x5eadb4=a53_0x300333;console['log'](_0x5eadb4(0x254),_0x116aac);let _0x471382='PENDING';switch(_0x116aac[_0x5eadb4(0x233)]?.['toLowerCase']()){case _0x5eadb4(0x223):case _0x5eadb4(0x261):case _0x5eadb4(0x206):case _0x5eadb4(0x217):case _0x5eadb4(0x210):_0x116aac[_0x5eadb4(0x238)]==='Yes'?_0x471382=_0x5eadb4(0x21d):_0x471382=_0x5eadb4(0x222);break;case'cancelled':case _0x5eadb4(0x246):case _0x5eadb4(0x201):case _0x5eadb4(0x20a):case _0x5eadb4(0x229):_0x471382=_0x5eadb4(0x218);break;case _0x5eadb4(0x257):case _0x5eadb4(0x24e):_0x471382=_0x5eadb4(0x234);break;case _0x5eadb4(0x1f0):case _0x5eadb4(0x242):case _0x5eadb4(0x250):case _0x5eadb4(0x232):case _0x5eadb4(0x259):default:_0x471382=_0x5eadb4(0x222);break;}return{'paymentId':_0x116aac['MerchantPaymentId']||_0x116aac[_0x5eadb4(0x20d)],'status':_0x471382,'amount':_0x116aac[_0x5eadb4(0x1ff)],'currency':_0x116aac[_0x5eadb4(0x22e)],'additionalInfo':{'method':_0x116aac[_0x5eadb4(0x23a)],'bankId':_0x116aac[_0x5eadb4(0x262)],'settled':_0x116aac[_0x5eadb4(0x238)],'settlementDate':_0x116aac['SettlementDate'],'remitterName':_0x116aac[_0x5eadb4(0x1ea)]?.[_0x5eadb4(0x1f5)],'remitterIban':_0x116aac[_0x5eadb4(0x1ea)]?.['Iban'],'bankTransactionId':_0x116aac[_0x5eadb4(0x213)]}};}[a53_0x300333(0x20e)](_0x1ec4d6,_0x10c87a){const _0x1ef3a6=a53_0x300333;return console[_0x1ef3a6(0x24f)](_0x1ef3a6(0x266),{'receivedSignature':_0x10c87a,'paymentId':_0x1ec4d6[_0x1ef3a6(0x20d)],'merchantPaymentId':_0x1ec4d6[_0x1ef3a6(0x264)]}),!![];}}exports[a53_0x300333(0x23c)]=NodaService;