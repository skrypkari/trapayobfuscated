'use strict';const a43_0x1e4fe1=a43_0x2242;function a43_0x2242(_0x7e9dba,_0x520329){const _0x210115=a43_0x2101();return a43_0x2242=function(_0x2242e2,_0x78370a){_0x2242e2=_0x2242e2-0x72;let _0x3677b8=_0x210115[_0x2242e2];return _0x3677b8;},a43_0x2242(_0x7e9dba,_0x520329);}(function(_0x290b23,_0x53a2e3){const _0x2ce739=a43_0x2242,_0xaca9b8=_0x290b23();while(!![]){try{const _0x2b5f06=-parseInt(_0x2ce739(0x7d))/0x1*(-parseInt(_0x2ce739(0x85))/0x2)+-parseInt(_0x2ce739(0xbb))/0x3*(-parseInt(_0x2ce739(0xb1))/0x4)+-parseInt(_0x2ce739(0xd6))/0x5+parseInt(_0x2ce739(0xeb))/0x6*(-parseInt(_0x2ce739(0xed))/0x7)+-parseInt(_0x2ce739(0x96))/0x8*(parseInt(_0x2ce739(0xe3))/0x9)+-parseInt(_0x2ce739(0xa0))/0xa*(-parseInt(_0x2ce739(0x89))/0xb)+parseInt(_0x2ce739(0x92))/0xc;if(_0x2b5f06===_0x53a2e3)break;else _0xaca9b8['push'](_0xaca9b8['shift']());}catch(_0x580e23){_0xaca9b8['push'](_0xaca9b8['shift']());}}}(a43_0x2101,0x40538));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a43_0x1e4fe1(0x82)]=void 0x0;const loggerService_1=require(a43_0x1e4fe1(0x75));class NodaService{constructor(){const _0x56f555=a43_0x1e4fe1;this[_0x56f555(0x72)]=_0x56f555(0x9f),console[_0x56f555(0xd3)](_0x56f555(0x79));}async['createPaymentLink'](_0x3ea661){const _0x21ea52=a43_0x1e4fe1,{orderId:_0x16096d,name:_0x34b483,paymentDescription:_0x5ce90b,amount:_0x1d9968,currency:_0x3de9cf,webhookUrl:_0x47a27d,returnUrl:_0x4a2462,expiryDate:_0x3cd11b}=_0x3ea661,_0x2fa649=_0x3de9cf[_0x21ea52(0xec)](),_0x182b74='https://tesoft.uk/gateway/noda/webhook/',_0x4e2895='https://tesoft.uk/gateway/pending.php?id='+_0x16096d,_0x39a29b={'name':_0x34b483,'paymentDescription':_0x5ce90b,'amount':_0x1d9968,'currency':_0x2fa649,'paymentId':_0x16096d,'webhookUrl':_0x182b74,'returnUrl':_0x4e2895};_0x3cd11b&&(_0x39a29b['expiryDate']=_0x3cd11b);const _0x39d362=Date['now']();try{console[_0x21ea52(0xd3)](_0x21ea52(0xd1)),console[_0x21ea52(0xd3)](_0x21ea52(0xe5),this['apiUrl']),console[_0x21ea52(0xd3)](_0x21ea52(0x9d),JSON['stringify'](_0x39a29b,null,0x2)),console['log'](_0x21ea52(0xe7),_0x16096d,_0x21ea52(0x78)),console['log'](_0x21ea52(0xee),_0x4e2895),loggerService_1[_0x21ea52(0xe1)]['logWhiteDomainRequest'](_0x21ea52(0xbd),'/payment-links','POST',_0x39a29b);const _0x3ad248=await fetch(this[_0x21ea52(0x72)],{'method':_0x21ea52(0x80),'headers':{'Content-Type':_0x21ea52(0x7a),'Accept':'application/json','User-Agent':_0x21ea52(0x76)},'body':JSON[_0x21ea52(0xcc)](_0x39a29b)}),_0x49e9f8=Date[_0x21ea52(0xa7)]()-_0x39d362;console[_0x21ea52(0xd3)](_0x21ea52(0x7f)),console[_0x21ea52(0xd3)](_0x21ea52(0xb4),_0x3ad248[_0x21ea52(0xc7)]),console[_0x21ea52(0xd3)](_0x21ea52(0xbf),_0x3ad248[_0x21ea52(0xb6)]),console[_0x21ea52(0xd3)]('Headers:',Object[_0x21ea52(0xde)](_0x3ad248[_0x21ea52(0x8c)][_0x21ea52(0x81)]())),console[_0x21ea52(0xd3)](_0x21ea52(0x91),_0x49e9f8+'ms');const _0x4b076e=await _0x3ad248[_0x21ea52(0xa8)]();console['log'](_0x21ea52(0xa1),_0x4b076e);if(!_0x3ad248['ok']){console['error'](_0x21ea52(0x97)),console[_0x21ea52(0xa5)]('HTTP\x20Status:',_0x3ad248[_0x21ea52(0xc7)]),console['error'](_0x21ea52(0xdf),_0x4b076e),loggerService_1['loggerService'][_0x21ea52(0xb0)]('noda',_0x21ea52(0xe6),_0x3ad248[_0x21ea52(0xc7)],_0x4b076e,_0x49e9f8),loggerService_1[_0x21ea52(0xe1)][_0x21ea52(0xd2)](_0x21ea52(0xbd),_0x21ea52(0xe6),'HTTP\x20'+_0x3ad248['status']+':\x20'+_0x4b076e);if(_0x3ad248[_0x21ea52(0xc7)]===0x190)throw new Error(_0x21ea52(0xcf));else{if(_0x3ad248[_0x21ea52(0xc7)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x21ea52(0x9a)+_0x3ad248[_0x21ea52(0xc7)]+_0x21ea52(0x88)+_0x4b076e);}let _0xbda2cd;try{_0xbda2cd=JSON[_0x21ea52(0xba)](_0x4b076e);}catch(_0x4c6e44){console[_0x21ea52(0xa5)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x4c6e44),loggerService_1[_0x21ea52(0xe1)][_0x21ea52(0xd2)](_0x21ea52(0xbd),_0x21ea52(0xe6),_0x21ea52(0x86)+_0x4c6e44);throw new Error(_0x21ea52(0xb7)+_0x4b076e);}console[_0x21ea52(0xd3)](_0x21ea52(0xcd)),console['log'](_0x21ea52(0x7b),JSON[_0x21ea52(0xcc)](_0xbda2cd,null,0x2)),loggerService_1[_0x21ea52(0xe1)][_0x21ea52(0xb0)]('noda','/payment-links',_0x3ad248[_0x21ea52(0xc7)],_0xbda2cd,_0x49e9f8);if(_0xbda2cd[_0x21ea52(0xa5)]||_0xbda2cd[_0x21ea52(0xab)]){const _0x5c2269=_0xbda2cd['message']||_0xbda2cd[_0x21ea52(0xa5)]||_0x21ea52(0xd0);console[_0x21ea52(0xa5)](_0x21ea52(0xaf)),console[_0x21ea52(0xa5)]('Error\x20Message:',_0x5c2269),console['error'](_0x21ea52(0x73),_0xbda2cd[_0x21ea52(0xab)]),loggerService_1[_0x21ea52(0xe1)][_0x21ea52(0xd2)](_0x21ea52(0xbd),'/payment-links',_0x21ea52(0xe0)+_0x5c2269);throw new Error(_0x21ea52(0xc6)+_0x5c2269);}if(!_0xbda2cd['id']||!_0xbda2cd['shortLinkUrls']?.[_0x21ea52(0xc0)]){console[_0x21ea52(0xa5)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x21ea52(0x77)),console[_0x21ea52(0xa5)](_0x21ea52(0xc3),_0xbda2cd),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x21ea52(0xe6),_0x21ea52(0x8e));throw new Error(_0x21ea52(0xa9));}return console['log'](_0x21ea52(0xe9)),console[_0x21ea52(0xd3)]('Payment\x20Link\x20ID:',_0xbda2cd['id']),console[_0x21ea52(0xd3)](_0x21ea52(0xb8),_0xbda2cd['shortLinkUrls'][_0x21ea52(0xc0)]),console[_0x21ea52(0xd3)](_0x21ea52(0xb3),_0xbda2cd['shortLinkUrls'][_0x21ea52(0x83)]||_0x21ea52(0xe8)),console['log']('Order\x20ID\x20Used:',_0x16096d,_0x21ea52(0x8b)),console[_0x21ea52(0xd3)](_0x21ea52(0x84),_0x4e2895),{'gateway_payment_id':_0xbda2cd['id'],'payment_url':_0xbda2cd[_0x21ea52(0x7e)][_0x21ea52(0xc0)],'qr_code_url':_0xbda2cd[_0x21ea52(0x7e)][_0x21ea52(0x83)],'expiry_date':_0xbda2cd[_0x21ea52(0xa6)]};}catch(_0x410edc){console[_0x21ea52(0xa5)](_0x21ea52(0x8f)),console['error'](_0x21ea52(0x7c),_0x410edc),loggerService_1[_0x21ea52(0xe1)][_0x21ea52(0xd2)]('noda',_0x21ea52(0xe6),_0x410edc);if(_0x410edc instanceof Error){console[_0x21ea52(0xa5)](_0x21ea52(0x95),_0x410edc[_0x21ea52(0xc8)]),console['error'](_0x21ea52(0xae),_0x410edc[_0x21ea52(0xd4)]);throw new Error(_0x21ea52(0x74)+_0x410edc[_0x21ea52(0xc8)]);}throw new Error(_0x21ea52(0xdb));}}async['verifyPayment'](_0x167511){const _0x197f46=a43_0x1e4fe1,_0x2ac63b=Date['now']();try{loggerService_1[_0x197f46(0xe1)][_0x197f46(0x8d)]('noda',_0x197f46(0xb2)+_0x167511,_0x197f46(0x98),{});const _0x5413cb=await fetch(this[_0x197f46(0x72)]+'/'+_0x167511,{'method':'GET','headers':{'Content-Type':_0x197f46(0x7a),'User-Agent':_0x197f46(0x76)}}),_0x3f087d=Date[_0x197f46(0xa7)]()-_0x2ac63b;if(!_0x5413cb['ok']){const _0x2f6a7e=await _0x5413cb['text']();loggerService_1[_0x197f46(0xe1)]['logWhiteDomainResponse'](_0x197f46(0xbd),_0x197f46(0xb2)+_0x167511,_0x5413cb[_0x197f46(0xc7)],_0x2f6a7e,_0x3f087d);throw new Error(_0x197f46(0x9a)+_0x5413cb[_0x197f46(0xc7)]);}const _0x3e0a51=await _0x5413cb['json']();loggerService_1['loggerService'][_0x197f46(0xb0)](_0x197f46(0xbd),_0x197f46(0xb2)+_0x167511,_0x5413cb[_0x197f46(0xc7)],_0x3e0a51,_0x3f087d);if(_0x3e0a51['error']||_0x3e0a51[_0x197f46(0xab)]){loggerService_1[_0x197f46(0xe1)]['logWhiteDomainError'](_0x197f46(0xbd),'/payment-links/'+_0x167511,_0x197f46(0xc6)+(_0x3e0a51['message']||_0x3e0a51[_0x197f46(0xa5)]||_0x197f46(0xc2)));throw new Error('Noda\x20API\x20error:\x20'+(_0x3e0a51[_0x197f46(0xc8)]||_0x3e0a51[_0x197f46(0xa5)]||_0x197f46(0xc2)));}let _0x2a1550=_0x197f46(0xca);if(_0x3e0a51[_0x197f46(0x9b)]===![]){if(_0x3e0a51['expiryDate']){const _0x563bb6=new Date(_0x3e0a51[_0x197f46(0xa6)]),_0x1824dc=new Date();_0x563bb6<_0x1824dc?_0x2a1550=_0x197f46(0xbe):_0x2a1550=_0x197f46(0xdd);}else _0x2a1550=_0x197f46(0xdd);}else _0x2a1550=_0x197f46(0xca);return{'status':_0x2a1550,'amount':_0x3e0a51[_0x197f46(0xad)],'currency':_0x3e0a51[_0x197f46(0xd7)],'isActive':_0x3e0a51[_0x197f46(0x9b)]};}catch(_0x17dc54){console[_0x197f46(0xa5)]('Noda\x20payment\x20verification\x20error:',_0x17dc54),loggerService_1[_0x197f46(0xe1)][_0x197f46(0xd2)](_0x197f46(0xbd),_0x197f46(0xb2)+_0x167511,_0x17dc54);throw new Error(_0x197f46(0xea)+(_0x17dc54 instanceof Error?_0x17dc54[_0x197f46(0xc8)]:'Unknown\x20error'));}}async[a43_0x1e4fe1(0xc1)](_0x2d2904){const _0x41340f=a43_0x1e4fe1;console[_0x41340f(0xd3)](_0x41340f(0xa4),_0x2d2904);let _0xcde857='PENDING';switch(_0x2d2904[_0x41340f(0xb5)]?.[_0x41340f(0xe2)]()){case _0x41340f(0x90):case'completed':case _0x41340f(0x9c):case _0x41340f(0xc4):case _0x41340f(0xcb):_0x2d2904[_0x41340f(0x9e)]===_0x41340f(0xb9)?_0xcde857=_0x41340f(0xda):_0xcde857='PENDING';break;case'cancelled':case'canceled':case'failed':case _0x41340f(0xa5):case _0x41340f(0xc5):_0xcde857=_0x41340f(0xdd);break;case'expired':case _0x41340f(0x99):_0xcde857=_0x41340f(0xbe);break;case _0x41340f(0xe4):case _0x41340f(0x87):case _0x41340f(0xce):case _0x41340f(0xa2):case _0x41340f(0xac):default:_0xcde857=_0x41340f(0xca);break;}return{'paymentId':_0x2d2904[_0x41340f(0xbc)]||_0x2d2904[_0x41340f(0xdc)],'status':_0xcde857,'amount':_0x2d2904[_0x41340f(0xc9)],'currency':_0x2d2904[_0x41340f(0x94)],'additionalInfo':{'method':_0x2d2904[_0x41340f(0x8a)],'bankId':_0x2d2904[_0x41340f(0xaa)],'settled':_0x2d2904[_0x41340f(0x9e)],'settlementDate':_0x2d2904[_0x41340f(0xd5)],'remitterName':_0x2d2904[_0x41340f(0xd8)]?.['Name'],'remitterIban':_0x2d2904[_0x41340f(0xd8)]?.[_0x41340f(0xa3)],'bankTransactionId':_0x2d2904[_0x41340f(0xd9)]}};}['verifyWebhookSignature'](_0x485e82,_0x36290c){const _0x42c729=a43_0x1e4fe1;return console[_0x42c729(0xd3)](_0x42c729(0x93),{'receivedSignature':_0x36290c,'paymentId':_0x485e82[_0x42c729(0xdc)],'merchantPaymentId':_0x485e82['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;function a43_0x2101(){const _0x351c29=['Status\x20Code:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','../loggerService','TesSoft\x20Payment\x20System/1.0','Missing\x20id\x20or\x20shortLink\x20in\x20response','(8digits-8digits\x20format\x20for\x20Noda)','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','application/json','Parsed\x20Result:','Error\x20details:','18422sUVDtJ','shortLinkUrls','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','POST','entries','NodaService','qrCodeLink','✅\x20Return\x20URL\x20configured\x20for\x20pending:','6MtDXLX','JSON\x20Parse\x20Error:\x20','created',',\x20body:\x20','671puXJod','Method','(8digits-8digits\x20format)','headers','logWhiteDomainRequest','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20SERVICE\x20ERROR\x20===','done','Response\x20Time:','3504648hBtzKK','Noda\x20webhook\x20signature\x20verification:','Currency','Error\x20message:','620168fqJYqS','===\x20NODA\x20API\x20ERROR\x20===','GET','timeout','HTTP\x20error!\x20status:\x20','isActive','paid','Request\x20Body\x20(Direct\x20JSON):','Settled','https://tesoft.uk/gateway/noda/','69820CscIzy','Raw\x20Response\x20Body:','processing','Iban','Processing\x20Noda\x20webhook:','error','expiryDate','now','text','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','BankId','statusCode','in_progress','amount','Error\x20stack:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','logWhiteDomainResponse','5000tICdOz','/payment-links/','QR\x20Code\x20Link:','Status:','Status','statusText','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Short\x20Link:','Yes','parse','1095lWGjLO','MerchantPaymentId','noda','EXPIRED','Status\x20Text:','shortLink','processWebhook','Unknown\x20error','Response\x20data:','success','rejected','Noda\x20API\x20error:\x20','status','message','Amount','PENDING','successful','stringify','===\x20PARSED\x20NODA\x20RESPONSE\x20===','active','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Unknown\x20error\x20from\x20Noda\x20API','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','logWhiteDomainError','log','stack','SettlementDate','1397500MTEBcc','currency','Remitter','BankTransactionId','PAID','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','PaymentId','FAILED','fromEntries','Response\x20Body:','Business\x20Error:\x20','loggerService','toLowerCase','54wapVSF','pending','URL:','/payment-links','Order\x20ID\x20Format:','Not\x20provided','===\x20NODA\x20SUCCESS\x20===','Failed\x20to\x20verify\x20Noda\x20payment:\x20','1812FKgnaC','toUpperCase','5131bSKojl','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','apiUrl'];a43_0x2101=function(){return _0x351c29;};return a43_0x2101();}