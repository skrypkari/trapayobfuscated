'use strict';function a60_0x3a06(_0x1e81b6,_0x589637){_0x1e81b6=_0x1e81b6-0x19a;const _0x5ac2db=a60_0x5ac2();let _0x3a0680=_0x5ac2db[_0x1e81b6];return _0x3a0680;}const a60_0x5de134=a60_0x3a06;(function(_0x514bac,_0x474ec3){const _0x4a42d4=a60_0x3a06,_0x1db735=_0x514bac();while(!![]){try{const _0x236fb0=-parseInt(_0x4a42d4(0x213))/0x1*(parseInt(_0x4a42d4(0x1ab))/0x2)+parseInt(_0x4a42d4(0x1a0))/0x3*(-parseInt(_0x4a42d4(0x1c2))/0x4)+parseInt(_0x4a42d4(0x1c6))/0x5*(-parseInt(_0x4a42d4(0x1f3))/0x6)+parseInt(_0x4a42d4(0x1b5))/0x7+parseInt(_0x4a42d4(0x1f8))/0x8*(parseInt(_0x4a42d4(0x214))/0x9)+parseInt(_0x4a42d4(0x1b6))/0xa*(-parseInt(_0x4a42d4(0x212))/0xb)+parseInt(_0x4a42d4(0x1b8))/0xc;if(_0x236fb0===_0x474ec3)break;else _0x1db735['push'](_0x1db735['shift']());}catch(_0x39e577){_0x1db735['push'](_0x1db735['shift']());}}}(a60_0x5ac2,0x830a0));function a60_0x5ac2(){const _0x58434c=['status','isActive','JSON\x20Parse\x20Error:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','headers','Failed\x20to\x20verify\x20Noda\x20payment:\x20','toLowerCase','Settled','MerchantPaymentId','===\x20NODA\x20SERVICE\x20ERROR\x20===','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','stringify','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Processing\x20Noda\x20webhook:','apiUrl','https://tesoft.uk/gateway/pending.php?id=','logWhiteDomainRequest','Method','Unknown\x20error\x20from\x20Noda\x20API','Status\x20Code:',',\x20body:\x20','GET','processing','canceled','URL:','24CyrvbA','POST','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20','message','8OLbDZE','entries','statusCode','logWhiteDomainResponse','Noda\x20API\x20error:\x20','verifyPayment','rejected','EXPIRED','in_progress','parse','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','statusText','loggerService','Error\x20Message:','FAILED','Unknown\x20error','verifyWebhookSignature','successful','expiryDate','Payment\x20System/1.0','Response\x20Body:','expired','NodaService','processWebhook','success','Missing\x20id\x20or\x20shortLink\x20in\x20response','11irKhUq','381BdzFjV','4695183IRMIFo','error','Noda\x20webhook\x20signature\x20verification:','Noda\x20payment\x20verification\x20error:','currency','done','/payment-links','12rmVYYH','toUpperCase','QR\x20Code\x20Link:','Order\x20ID\x20Used:','Error\x20message:','defineProperty','===\x20PARSED\x20NODA\x20RESPONSE\x20===','completed','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','HTTP\x20Status:','shortLink','3438CFXoGz','shortLinkUrls','noda','created','text','logWhiteDomainError','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Error\x20details:','Order\x20ID\x20Format:','application/json','3566885vIHlID','7782610MWLfUY','PENDING','22402152AXrcij','pending','/payment-links/','(8digits-8digits\x20format)','now','fromEntries','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','https://tesoft.uk/gateway/noda/','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Payment\x20Link\x20ID:','715532hhChQp','===\x20NODA\x20API\x20ERROR\x20===','amount','Iban','265775AJxBtv','HTTP\x20error!\x20status:\x20','Status:','Response\x20data:','Status\x20Text:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','__esModule','Remitter','Request\x20Body\x20(Direct\x20JSON):','log','paid','Short\x20Link:','createPaymentLink','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','BankTransactionId','qrCodeLink','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Amount','PAID'];a60_0x5ac2=function(){return _0x58434c;};return a60_0x5ac2();}Object[a60_0x5de134(0x1a5)](exports,a60_0x5de134(0x1cd),{'value':!![]}),exports[a60_0x5de134(0x20e)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x26bfbe=a60_0x5de134;this[_0x26bfbe(0x1e8)]=_0x26bfbe(0x1bf),console[_0x26bfbe(0x1d0)](_0x26bfbe(0x1e6));}async[a60_0x5de134(0x1d3)](_0x422bd9){const _0x5825ac=a60_0x5de134,{orderId:_0x58381b,name:_0x32bc79,paymentDescription:_0x444579,amount:_0x434acd,currency:_0x2e9ba0,webhookUrl:_0x17c2a6,returnUrl:_0x230c8e,expiryDate:_0x1ae780}=_0x422bd9,_0x1c63af=_0x2e9ba0[_0x5825ac(0x1a1)](),_0x259c37='https://tesoft.uk/gateway/noda/webhook/',_0x44b3b3=_0x5825ac(0x1e9)+_0x58381b,_0x42e770={'name':_0x32bc79,'paymentDescription':_0x444579,'amount':_0x434acd,'currency':_0x1c63af,'paymentId':_0x58381b,'webhookUrl':_0x259c37,'returnUrl':_0x44b3b3};_0x1ae780&&(_0x42e770[_0x5825ac(0x20a)]=_0x1ae780);const _0x3f6584=Date[_0x5825ac(0x1bc)]();try{console[_0x5825ac(0x1d0)](_0x5825ac(0x1e4)),console['log'](_0x5825ac(0x1f2),this[_0x5825ac(0x1e8)]),console['log'](_0x5825ac(0x1cf),JSON[_0x5825ac(0x1e5)](_0x42e770,null,0x2)),console[_0x5825ac(0x1d0)](_0x5825ac(0x1b3),_0x58381b,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x5825ac(0x1d0)](_0x5825ac(0x1cb),_0x44b3b3),loggerService_1[_0x5825ac(0x204)][_0x5825ac(0x1ea)](_0x5825ac(0x1ad),'/payment-links',_0x5825ac(0x1f4),_0x42e770);const _0x21e69c=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x5825ac(0x1b4),'Accept':_0x5825ac(0x1b4),'User-Agent':'Payment\x20System/1.0'},'body':JSON['stringify'](_0x42e770)}),_0x52b426=Date['now']()-_0x3f6584;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x5825ac(0x1d0)](_0x5825ac(0x1c8),_0x21e69c[_0x5825ac(0x1da)]),console[_0x5825ac(0x1d0)](_0x5825ac(0x1ca),_0x21e69c[_0x5825ac(0x203)]),console['log']('Headers:',Object[_0x5825ac(0x1bd)](_0x21e69c[_0x5825ac(0x1de)][_0x5825ac(0x1f9)]())),console[_0x5825ac(0x1d0)]('Response\x20Time:',_0x52b426+'ms');const _0x820a87=await _0x21e69c['text']();console[_0x5825ac(0x1d0)]('Raw\x20Response\x20Body:',_0x820a87);if(!_0x21e69c['ok']){console[_0x5825ac(0x19a)](_0x5825ac(0x1c3)),console[_0x5825ac(0x19a)](_0x5825ac(0x1a9),_0x21e69c[_0x5825ac(0x1da)]),console[_0x5825ac(0x19a)](_0x5825ac(0x20c),_0x820a87),loggerService_1['loggerService'][_0x5825ac(0x1fb)](_0x5825ac(0x1ad),'/payment-links',_0x21e69c[_0x5825ac(0x1da)],_0x820a87,_0x52b426),loggerService_1[_0x5825ac(0x204)][_0x5825ac(0x1b0)]('noda',_0x5825ac(0x19f),_0x5825ac(0x1f6)+_0x21e69c[_0x5825ac(0x1da)]+':\x20'+_0x820a87);if(_0x21e69c['status']===0x190)throw new Error(_0x5825ac(0x1a8));else{if(_0x21e69c[_0x5825ac(0x1da)]===0x1f4)throw new Error(_0x5825ac(0x1d7));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x21e69c['status']+_0x5825ac(0x1ee)+_0x820a87);}let _0x55d0f5;try{_0x55d0f5=JSON[_0x5825ac(0x201)](_0x820a87);}catch(_0x528aa7){console[_0x5825ac(0x19a)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x528aa7),loggerService_1[_0x5825ac(0x204)]['logWhiteDomainError'](_0x5825ac(0x1ad),_0x5825ac(0x19f),_0x5825ac(0x1dc)+_0x528aa7);throw new Error(_0x5825ac(0x1d4)+_0x820a87);}console['log'](_0x5825ac(0x1a6)),console[_0x5825ac(0x1d0)]('Parsed\x20Result:',JSON['stringify'](_0x55d0f5,null,0x2)),loggerService_1[_0x5825ac(0x204)][_0x5825ac(0x1fb)](_0x5825ac(0x1ad),'/payment-links',_0x21e69c[_0x5825ac(0x1da)],_0x55d0f5,_0x52b426);if(_0x55d0f5['error']||_0x55d0f5[_0x5825ac(0x1fa)]){const _0x53041b=_0x55d0f5[_0x5825ac(0x1f7)]||_0x55d0f5['error']||_0x5825ac(0x1ec);console[_0x5825ac(0x19a)](_0x5825ac(0x1c0)),console[_0x5825ac(0x19a)](_0x5825ac(0x205),_0x53041b),console[_0x5825ac(0x19a)](_0x5825ac(0x1ed),_0x55d0f5[_0x5825ac(0x1fa)]),loggerService_1[_0x5825ac(0x204)]['logWhiteDomainError'](_0x5825ac(0x1ad),_0x5825ac(0x19f),'Business\x20Error:\x20'+_0x53041b);throw new Error(_0x5825ac(0x1fc)+_0x53041b);}if(!_0x55d0f5['id']||!_0x55d0f5[_0x5825ac(0x1ac)]?.[_0x5825ac(0x1aa)]){console[_0x5825ac(0x19a)](_0x5825ac(0x1f5)),console[_0x5825ac(0x19a)](_0x5825ac(0x211)),console[_0x5825ac(0x19a)](_0x5825ac(0x1c9),_0x55d0f5),loggerService_1[_0x5825ac(0x204)][_0x5825ac(0x1b0)](_0x5825ac(0x1ad),_0x5825ac(0x19f),_0x5825ac(0x1dd));throw new Error(_0x5825ac(0x1b1));}return console[_0x5825ac(0x1d0)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x5825ac(0x1d0)](_0x5825ac(0x1c1),_0x55d0f5['id']),console[_0x5825ac(0x1d0)](_0x5825ac(0x1d2),_0x55d0f5[_0x5825ac(0x1ac)]['shortLink']),console[_0x5825ac(0x1d0)](_0x5825ac(0x1a2),_0x55d0f5[_0x5825ac(0x1ac)][_0x5825ac(0x1d6)]||'Not\x20provided'),console[_0x5825ac(0x1d0)](_0x5825ac(0x1a3),_0x58381b,_0x5825ac(0x1bb)),console[_0x5825ac(0x1d0)](_0x5825ac(0x1cc),_0x44b3b3),{'gateway_payment_id':_0x55d0f5['id'],'payment_url':_0x55d0f5[_0x5825ac(0x1ac)][_0x5825ac(0x1aa)],'qr_code_url':_0x55d0f5[_0x5825ac(0x1ac)][_0x5825ac(0x1d6)],'expiry_date':_0x55d0f5[_0x5825ac(0x20a)]};}catch(_0x1b111b){console[_0x5825ac(0x19a)](_0x5825ac(0x1e3)),console['error'](_0x5825ac(0x1b2),_0x1b111b),loggerService_1['loggerService'][_0x5825ac(0x1b0)](_0x5825ac(0x1ad),_0x5825ac(0x19f),_0x1b111b);if(_0x1b111b instanceof Error){console[_0x5825ac(0x19a)](_0x5825ac(0x1a4),_0x1b111b[_0x5825ac(0x1f7)]),console['error']('Error\x20stack:',_0x1b111b['stack']);throw new Error(_0x5825ac(0x1be)+_0x1b111b[_0x5825ac(0x1f7)]);}throw new Error(_0x5825ac(0x202));}}async[a60_0x5de134(0x1fd)](_0x3d766d){const _0x310913=a60_0x5de134,_0x5ee165=Date['now']();try{loggerService_1[_0x310913(0x204)]['logWhiteDomainRequest']('noda','/payment-links/'+_0x3d766d,_0x310913(0x1ef),{});const _0x279116=await fetch(this[_0x310913(0x1e8)]+'/'+_0x3d766d,{'method':_0x310913(0x1ef),'headers':{'Content-Type':_0x310913(0x1b4),'User-Agent':_0x310913(0x20b)}}),_0x52bba3=Date[_0x310913(0x1bc)]()-_0x5ee165;if(!_0x279116['ok']){const _0x591647=await _0x279116[_0x310913(0x1af)]();loggerService_1[_0x310913(0x204)][_0x310913(0x1fb)](_0x310913(0x1ad),_0x310913(0x1ba)+_0x3d766d,_0x279116[_0x310913(0x1da)],_0x591647,_0x52bba3);throw new Error(_0x310913(0x1c7)+_0x279116[_0x310913(0x1da)]);}const _0x2f1a92=await _0x279116['json']();loggerService_1['loggerService']['logWhiteDomainResponse']('noda','/payment-links/'+_0x3d766d,_0x279116[_0x310913(0x1da)],_0x2f1a92,_0x52bba3);if(_0x2f1a92[_0x310913(0x19a)]||_0x2f1a92[_0x310913(0x1fa)]){loggerService_1[_0x310913(0x204)]['logWhiteDomainError'](_0x310913(0x1ad),_0x310913(0x1ba)+_0x3d766d,_0x310913(0x1fc)+(_0x2f1a92['message']||_0x2f1a92[_0x310913(0x19a)]||_0x310913(0x207)));throw new Error(_0x310913(0x1fc)+(_0x2f1a92[_0x310913(0x1f7)]||_0x2f1a92[_0x310913(0x19a)]||'Unknown\x20error'));}let _0x5744ea=_0x310913(0x1b7);if(_0x2f1a92[_0x310913(0x1db)]===![]){if(_0x2f1a92[_0x310913(0x20a)]){const _0x231397=new Date(_0x2f1a92[_0x310913(0x20a)]),_0xe6c586=new Date();_0x231397<_0xe6c586?_0x5744ea=_0x310913(0x1ff):_0x5744ea=_0x310913(0x206);}else _0x5744ea='FAILED';}else _0x5744ea=_0x310913(0x1b7);return{'status':_0x5744ea,'amount':_0x2f1a92[_0x310913(0x1c4)],'currency':_0x2f1a92[_0x310913(0x19d)],'isActive':_0x2f1a92['isActive']};}catch(_0x3c00da){console[_0x310913(0x19a)](_0x310913(0x19c),_0x3c00da),loggerService_1[_0x310913(0x204)][_0x310913(0x1b0)](_0x310913(0x1ad),_0x310913(0x1ba)+_0x3d766d,_0x3c00da);throw new Error(_0x310913(0x1df)+(_0x3c00da instanceof Error?_0x3c00da[_0x310913(0x1f7)]:_0x310913(0x207)));}}async[a60_0x5de134(0x20f)](_0x259a69){const _0x388831=a60_0x5de134;console[_0x388831(0x1d0)](_0x388831(0x1e7),_0x259a69);let _0xfb52b1=_0x388831(0x1b7);switch(_0x259a69['Status']?.[_0x388831(0x1e0)]()){case _0x388831(0x19e):case _0x388831(0x1a7):case _0x388831(0x1d1):case _0x388831(0x210):case _0x388831(0x209):_0x259a69[_0x388831(0x1e1)]==='Yes'?_0xfb52b1=_0x388831(0x1d9):_0xfb52b1=_0x388831(0x1b7);break;case'cancelled':case _0x388831(0x1f1):case'failed':case _0x388831(0x19a):case _0x388831(0x1fe):_0xfb52b1=_0x388831(0x206);break;case _0x388831(0x20d):case'timeout':_0xfb52b1=_0x388831(0x1ff);break;case _0x388831(0x1b9):case _0x388831(0x1ae):case'active':case _0x388831(0x1f0):case _0x388831(0x200):default:_0xfb52b1='PENDING';break;}return{'paymentId':_0x259a69[_0x388831(0x1e2)]||_0x259a69['PaymentId'],'status':_0xfb52b1,'amount':_0x259a69[_0x388831(0x1d8)],'currency':_0x259a69['Currency'],'additionalInfo':{'method':_0x259a69[_0x388831(0x1eb)],'bankId':_0x259a69['BankId'],'settled':_0x259a69[_0x388831(0x1e1)],'settlementDate':_0x259a69['SettlementDate'],'remitterName':_0x259a69['Remitter']?.['Name'],'remitterIban':_0x259a69[_0x388831(0x1ce)]?.[_0x388831(0x1c5)],'bankTransactionId':_0x259a69[_0x388831(0x1d5)]}};}[a60_0x5de134(0x208)](_0x3435ce,_0x14c6ce){const _0x2a1865=a60_0x5de134;return console[_0x2a1865(0x1d0)](_0x2a1865(0x19b),{'receivedSignature':_0x14c6ce,'paymentId':_0x3435ce['PaymentId'],'merchantPaymentId':_0x3435ce['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;