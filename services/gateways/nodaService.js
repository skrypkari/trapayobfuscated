'use strict';const a46_0x41b57c=a46_0x325f;(function(_0x4ef9cb,_0x10854e){const _0x4856fd=a46_0x325f,_0x731d4c=_0x4ef9cb();while(!![]){try{const _0x2832ee=-parseInt(_0x4856fd(0x21a))/0x1*(-parseInt(_0x4856fd(0x21d))/0x2)+-parseInt(_0x4856fd(0x219))/0x3*(parseInt(_0x4856fd(0x221))/0x4)+parseInt(_0x4856fd(0x1c9))/0x5*(-parseInt(_0x4856fd(0x1ee))/0x6)+-parseInt(_0x4856fd(0x1f5))/0x7+-parseInt(_0x4856fd(0x205))/0x8*(-parseInt(_0x4856fd(0x22f))/0x9)+-parseInt(_0x4856fd(0x1c1))/0xa+parseInt(_0x4856fd(0x224))/0xb;if(_0x2832ee===_0x10854e)break;else _0x731d4c['push'](_0x731d4c['shift']());}catch(_0x5d90d4){_0x731d4c['push'](_0x731d4c['shift']());}}}(a46_0x5bb4,0x9a17b));function a46_0x5bb4(){const _0x63502c=['logWhiteDomainError','===\x20NODA\x20API\x20ERROR\x20===','processWebhook','8689580jTKRHc','Missing\x20id\x20or\x20shortLink\x20in\x20response','BankTransactionId','/payment-links/','Remitter','canceled','Noda\x20webhook\x20signature\x20verification:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','5046285oVbbyO','Order\x20ID\x20Used:','application/json','statusText','paid','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','GET','cancelled','../loggerService','rejected','Yes','Name','text','done','URL:','shortLink','created','Parsed\x20Result:','Business\x20Error:\x20','statusCode','Not\x20provided','qrCodeLink','POST','Response\x20Time:','TesSoft\x20Payment\x20System/1.0','BankId','Order\x20ID\x20Format:','/payment-links','fromEntries','stringify','amount','Settled','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','SettlementDate','Unknown\x20error','Amount','entries','6nIXPWL','HTTP\x20','JSON\x20Parse\x20Error:\x20','__esModule','in_progress','expiryDate','failed','2808043DVoLjV','message','apiUrl','now','Unknown\x20error\x20from\x20Noda\x20API','logWhiteDomainResponse','verifyWebhookSignature','defineProperty','noda','===\x20NODA\x20SERVICE\x20ERROR\x20===','Payment\x20Link\x20ID:','NodaService','log','Currency','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Method','1292120ENSWmk','(8digits-8digits\x20format\x20for\x20Noda)','parse','timeout','PAID','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','logWhiteDomainRequest','Error\x20details:','https://tesoft.uk/gateway/pending.php?id=','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','toUpperCase','Status\x20Code:','Status:','Headers:','PENDING','processing','status','loggerService','FAILED','successful','6672XfSwxE','2ZKbnBK','Iban','PaymentId','334188tVBgeh','verifyPayment','error','isActive','2264wREXOb','Short\x20Link:','Request\x20Body\x20(Direct\x20JSON):','40409688xvvwsE','HTTP\x20error!\x20status:\x20','completed','===\x20PARSED\x20NODA\x20RESPONSE\x20===','createPaymentLink','success','pending','Error\x20stack:','MerchantPaymentId','shortLinkUrls','json','9SlakGo','Status\x20Text:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Noda\x20payment\x20verification\x20error:','Noda\x20API\x20error:\x20','QR\x20Code\x20Link:','HTTP\x20Status:'];a46_0x5bb4=function(){return _0x63502c;};return a46_0x5bb4();}Object[a46_0x41b57c(0x1fc)](exports,a46_0x41b57c(0x1f1),{'value':!![]}),exports[a46_0x41b57c(0x200)]=void 0x0;const loggerService_1=require(a46_0x41b57c(0x1d1));function a46_0x325f(_0x542d72,_0x198591){const _0x5bb4b1=a46_0x5bb4();return a46_0x325f=function(_0x325fde,_0x225943){_0x325fde=_0x325fde-0x1bf;let _0x157a2e=_0x5bb4b1[_0x325fde];return _0x157a2e;},a46_0x325f(_0x542d72,_0x198591);}class NodaService{constructor(){const _0x25093f=a46_0x41b57c;this[_0x25093f(0x1f7)]='https://tesoft.uk/gateway/noda/',console[_0x25093f(0x201)](_0x25093f(0x203));}async[a46_0x41b57c(0x228)](_0x146159){const _0x5d1094=a46_0x41b57c,{orderId:_0xe30e70,name:_0x12e904,paymentDescription:_0x2d025a,amount:_0x190200,currency:_0x50e175,webhookUrl:_0x33eea0,returnUrl:_0x5130eb,expiryDate:_0x3f72ec}=_0x146159,_0x6c3343=_0x50e175[_0x5d1094(0x20f)](),_0x5919df='https://tesoft.uk/gateway/noda/webhook/',_0x5e0a31=_0x5d1094(0x20d)+_0xe30e70,_0x396e2f={'name':_0x12e904,'paymentDescription':_0x2d025a,'amount':_0x190200,'currency':_0x6c3343,'paymentId':_0xe30e70,'webhookUrl':_0x5919df,'returnUrl':_0x5e0a31};_0x3f72ec&&(_0x396e2f[_0x5d1094(0x1f3)]=_0x3f72ec);const _0x158c32=Date[_0x5d1094(0x1f8)]();try{console[_0x5d1094(0x201)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x5d1094(0x201)](_0x5d1094(0x1d7),this['apiUrl']),console[_0x5d1094(0x201)](_0x5d1094(0x223),JSON[_0x5d1094(0x1e6)](_0x396e2f,null,0x2)),console['log'](_0x5d1094(0x1e3),_0xe30e70,_0x5d1094(0x206)),console[_0x5d1094(0x201)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x5e0a31),loggerService_1[_0x5d1094(0x216)]['logWhiteDomainRequest'](_0x5d1094(0x1fd),'/payment-links',_0x5d1094(0x1df),_0x396e2f);const _0x31d89b=await fetch(this[_0x5d1094(0x1f7)],{'method':_0x5d1094(0x1df),'headers':{'Content-Type':_0x5d1094(0x1cb),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x5d1094(0x1e6)](_0x396e2f)}),_0x53d8d6=Date[_0x5d1094(0x1f8)]()-_0x158c32;console[_0x5d1094(0x201)](_0x5d1094(0x1ce)),console['log'](_0x5d1094(0x211),_0x31d89b[_0x5d1094(0x215)]),console[_0x5d1094(0x201)](_0x5d1094(0x230),_0x31d89b[_0x5d1094(0x1cc)]),console['log'](_0x5d1094(0x212),Object[_0x5d1094(0x1e5)](_0x31d89b['headers'][_0x5d1094(0x1ed)]())),console[_0x5d1094(0x201)](_0x5d1094(0x1e0),_0x53d8d6+'ms');const _0x433c03=await _0x31d89b[_0x5d1094(0x1d5)]();console[_0x5d1094(0x201)]('Raw\x20Response\x20Body:',_0x433c03);if(!_0x31d89b['ok']){console['error'](_0x5d1094(0x1bf)),console[_0x5d1094(0x21f)](_0x5d1094(0x235),_0x31d89b[_0x5d1094(0x215)]),console['error']('Response\x20Body:',_0x433c03),loggerService_1['loggerService'][_0x5d1094(0x1fa)](_0x5d1094(0x1fd),'/payment-links',_0x31d89b['status'],_0x433c03,_0x53d8d6),loggerService_1[_0x5d1094(0x216)]['logWhiteDomainError'](_0x5d1094(0x1fd),'/payment-links',_0x5d1094(0x1ef)+_0x31d89b[_0x5d1094(0x215)]+':\x20'+_0x433c03);if(_0x31d89b[_0x5d1094(0x215)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x31d89b[_0x5d1094(0x215)]===0x1f4)throw new Error(_0x5d1094(0x1e9));}throw new Error(_0x5d1094(0x225)+_0x31d89b[_0x5d1094(0x215)]+',\x20body:\x20'+_0x433c03);}let _0x120d7b;try{_0x120d7b=JSON[_0x5d1094(0x207)](_0x433c03);}catch(_0x338fce){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x338fce),loggerService_1[_0x5d1094(0x216)][_0x5d1094(0x236)]('noda',_0x5d1094(0x1e4),_0x5d1094(0x1f0)+_0x338fce);throw new Error(_0x5d1094(0x20a)+_0x433c03);}console[_0x5d1094(0x201)](_0x5d1094(0x227)),console[_0x5d1094(0x201)](_0x5d1094(0x1da),JSON[_0x5d1094(0x1e6)](_0x120d7b,null,0x2)),loggerService_1[_0x5d1094(0x216)]['logWhiteDomainResponse']('noda','/payment-links',_0x31d89b[_0x5d1094(0x215)],_0x120d7b,_0x53d8d6);if(_0x120d7b[_0x5d1094(0x21f)]||_0x120d7b[_0x5d1094(0x1dc)]){const _0x1c8089=_0x120d7b[_0x5d1094(0x1f6)]||_0x120d7b[_0x5d1094(0x21f)]||_0x5d1094(0x1f9);console[_0x5d1094(0x21f)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x5d1094(0x21f)]('Error\x20Message:',_0x1c8089),console[_0x5d1094(0x21f)](_0x5d1094(0x210),_0x120d7b['statusCode']),loggerService_1[_0x5d1094(0x216)][_0x5d1094(0x236)](_0x5d1094(0x1fd),_0x5d1094(0x1e4),_0x5d1094(0x1db)+_0x1c8089);throw new Error('Noda\x20API\x20error:\x20'+_0x1c8089);}if(!_0x120d7b['id']||!_0x120d7b['shortLinkUrls']?.['shortLink']){console[_0x5d1094(0x21f)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x5d1094(0x1c2)),console[_0x5d1094(0x21f)]('Response\x20data:',_0x120d7b),loggerService_1['loggerService'][_0x5d1094(0x236)](_0x5d1094(0x1fd),_0x5d1094(0x1e4),_0x5d1094(0x1c8));throw new Error(_0x5d1094(0x231));}return console[_0x5d1094(0x201)]('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x5d1094(0x1ff),_0x120d7b['id']),console[_0x5d1094(0x201)](_0x5d1094(0x222),_0x120d7b[_0x5d1094(0x22d)]['shortLink']),console['log'](_0x5d1094(0x234),_0x120d7b[_0x5d1094(0x22d)][_0x5d1094(0x1de)]||_0x5d1094(0x1dd)),console[_0x5d1094(0x201)](_0x5d1094(0x1ca),_0xe30e70,'(8digits-8digits\x20format)'),console[_0x5d1094(0x201)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x5e0a31),{'gateway_payment_id':_0x120d7b['id'],'payment_url':_0x120d7b[_0x5d1094(0x22d)][_0x5d1094(0x1d8)],'qr_code_url':_0x120d7b['shortLinkUrls'][_0x5d1094(0x1de)],'expiry_date':_0x120d7b['expiryDate']};}catch(_0x234a62){console[_0x5d1094(0x21f)](_0x5d1094(0x1fe)),console[_0x5d1094(0x21f)](_0x5d1094(0x20c),_0x234a62),loggerService_1[_0x5d1094(0x216)][_0x5d1094(0x236)](_0x5d1094(0x1fd),_0x5d1094(0x1e4),_0x234a62);if(_0x234a62 instanceof Error){console[_0x5d1094(0x21f)]('Error\x20message:',_0x234a62[_0x5d1094(0x1f6)]),console['error'](_0x5d1094(0x22b),_0x234a62['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x234a62['message']);}throw new Error(_0x5d1094(0x20e));}}async[a46_0x41b57c(0x21e)](_0x3d7b38){const _0x90a7b8=a46_0x41b57c,_0x143252=Date['now']();try{loggerService_1[_0x90a7b8(0x216)][_0x90a7b8(0x20b)](_0x90a7b8(0x1fd),_0x90a7b8(0x1c4)+_0x3d7b38,_0x90a7b8(0x1cf),{});const _0x1f4d0b=await fetch(this[_0x90a7b8(0x1f7)]+'/'+_0x3d7b38,{'method':_0x90a7b8(0x1cf),'headers':{'Content-Type':_0x90a7b8(0x1cb),'User-Agent':_0x90a7b8(0x1e1)}}),_0x227c2a=Date[_0x90a7b8(0x1f8)]()-_0x143252;if(!_0x1f4d0b['ok']){const _0x2aa465=await _0x1f4d0b['text']();loggerService_1[_0x90a7b8(0x216)][_0x90a7b8(0x1fa)](_0x90a7b8(0x1fd),'/payment-links/'+_0x3d7b38,_0x1f4d0b[_0x90a7b8(0x215)],_0x2aa465,_0x227c2a);throw new Error(_0x90a7b8(0x225)+_0x1f4d0b[_0x90a7b8(0x215)]);}const _0x476361=await _0x1f4d0b[_0x90a7b8(0x22e)]();loggerService_1[_0x90a7b8(0x216)][_0x90a7b8(0x1fa)](_0x90a7b8(0x1fd),'/payment-links/'+_0x3d7b38,_0x1f4d0b[_0x90a7b8(0x215)],_0x476361,_0x227c2a);if(_0x476361[_0x90a7b8(0x21f)]||_0x476361[_0x90a7b8(0x1dc)]){loggerService_1[_0x90a7b8(0x216)][_0x90a7b8(0x236)](_0x90a7b8(0x1fd),_0x90a7b8(0x1c4)+_0x3d7b38,_0x90a7b8(0x233)+(_0x476361[_0x90a7b8(0x1f6)]||_0x476361[_0x90a7b8(0x21f)]||_0x90a7b8(0x1eb)));throw new Error(_0x90a7b8(0x233)+(_0x476361[_0x90a7b8(0x1f6)]||_0x476361[_0x90a7b8(0x21f)]||'Unknown\x20error'));}let _0x305cd9=_0x90a7b8(0x213);if(_0x476361[_0x90a7b8(0x220)]===![]){if(_0x476361[_0x90a7b8(0x1f3)]){const _0x52fcca=new Date(_0x476361[_0x90a7b8(0x1f3)]),_0xcd8f14=new Date();_0x52fcca<_0xcd8f14?_0x305cd9='EXPIRED':_0x305cd9=_0x90a7b8(0x217);}else _0x305cd9=_0x90a7b8(0x217);}else _0x305cd9=_0x90a7b8(0x213);return{'status':_0x305cd9,'amount':_0x476361[_0x90a7b8(0x1e7)],'currency':_0x476361['currency'],'isActive':_0x476361[_0x90a7b8(0x220)]};}catch(_0x328804){console[_0x90a7b8(0x21f)](_0x90a7b8(0x232),_0x328804),loggerService_1['loggerService'][_0x90a7b8(0x236)](_0x90a7b8(0x1fd),_0x90a7b8(0x1c4)+_0x3d7b38,_0x328804);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x328804 instanceof Error?_0x328804[_0x90a7b8(0x1f6)]:_0x90a7b8(0x1eb)));}}async[a46_0x41b57c(0x1c0)](_0x5c4aac){const _0x1ff7d1=a46_0x41b57c;console['log']('Processing\x20Noda\x20webhook:',_0x5c4aac);let _0x2d8aa5='PENDING';switch(_0x5c4aac['Status']?.['toLowerCase']()){case _0x1ff7d1(0x1d6):case _0x1ff7d1(0x226):case _0x1ff7d1(0x1cd):case _0x1ff7d1(0x229):case _0x1ff7d1(0x218):_0x5c4aac[_0x1ff7d1(0x1e8)]===_0x1ff7d1(0x1d3)?_0x2d8aa5=_0x1ff7d1(0x209):_0x2d8aa5=_0x1ff7d1(0x213);break;case _0x1ff7d1(0x1d0):case _0x1ff7d1(0x1c6):case _0x1ff7d1(0x1f4):case _0x1ff7d1(0x21f):case _0x1ff7d1(0x1d2):_0x2d8aa5=_0x1ff7d1(0x217);break;case'expired':case _0x1ff7d1(0x208):_0x2d8aa5='EXPIRED';break;case _0x1ff7d1(0x22a):case _0x1ff7d1(0x1d9):case'active':case _0x1ff7d1(0x214):case _0x1ff7d1(0x1f2):default:_0x2d8aa5='PENDING';break;}return{'paymentId':_0x5c4aac[_0x1ff7d1(0x22c)]||_0x5c4aac['PaymentId'],'status':_0x2d8aa5,'amount':_0x5c4aac[_0x1ff7d1(0x1ec)],'currency':_0x5c4aac[_0x1ff7d1(0x202)],'additionalInfo':{'method':_0x5c4aac[_0x1ff7d1(0x204)],'bankId':_0x5c4aac[_0x1ff7d1(0x1e2)],'settled':_0x5c4aac[_0x1ff7d1(0x1e8)],'settlementDate':_0x5c4aac[_0x1ff7d1(0x1ea)],'remitterName':_0x5c4aac[_0x1ff7d1(0x1c5)]?.[_0x1ff7d1(0x1d4)],'remitterIban':_0x5c4aac['Remitter']?.[_0x1ff7d1(0x21b)],'bankTransactionId':_0x5c4aac[_0x1ff7d1(0x1c3)]}};}[a46_0x41b57c(0x1fb)](_0x13fb9c,_0x45bce3){const _0x131c82=a46_0x41b57c;return console[_0x131c82(0x201)](_0x131c82(0x1c7),{'receivedSignature':_0x45bce3,'paymentId':_0x13fb9c[_0x131c82(0x21c)],'merchantPaymentId':_0x13fb9c[_0x131c82(0x22c)]}),!![];}}exports[a46_0x41b57c(0x200)]=NodaService;