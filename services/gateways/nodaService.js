'use strict';const a48_0x52f578=a48_0x1aaf;function a48_0x1aaf(_0x11dd0b,_0x531bbb){const _0x5c04f7=a48_0x5c04();return a48_0x1aaf=function(_0x1aaff3,_0x1412f1){_0x1aaff3=_0x1aaff3-0x123;let _0x344ba4=_0x5c04f7[_0x1aaff3];return _0x344ba4;},a48_0x1aaf(_0x11dd0b,_0x531bbb);}(function(_0x1d4249,_0x45f3c0){const _0x5bf9f9=a48_0x1aaf,_0x2da111=_0x1d4249();while(!![]){try{const _0x1ddbe8=parseInt(_0x5bf9f9(0x190))/0x1+-parseInt(_0x5bf9f9(0x124))/0x2+parseInt(_0x5bf9f9(0x127))/0x3+parseInt(_0x5bf9f9(0x18b))/0x4+-parseInt(_0x5bf9f9(0x12f))/0x5+parseInt(_0x5bf9f9(0x184))/0x6*(-parseInt(_0x5bf9f9(0x14f))/0x7)+-parseInt(_0x5bf9f9(0x17f))/0x8*(-parseInt(_0x5bf9f9(0x136))/0x9);if(_0x1ddbe8===_0x45f3c0)break;else _0x2da111['push'](_0x2da111['shift']());}catch(_0xd5c9a2){_0x2da111['push'](_0x2da111['shift']());}}}(a48_0x5c04,0xbae7f));Object['defineProperty'](exports,a48_0x52f578(0x134),{'value':!![]}),exports[a48_0x52f578(0x163)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x11e094=a48_0x52f578;this['apiUrl']=_0x11e094(0x135),console['log'](_0x11e094(0x12e));}async[a48_0x52f578(0x185)](_0x3fe905){const _0x489b33=a48_0x52f578,{orderId:_0x42a189,name:_0x3b75b7,paymentDescription:_0x583a25,amount:_0x17044b,currency:_0x2efcdc,webhookUrl:_0x4317c3,returnUrl:_0x363985,expiryDate:_0x2dd108}=_0x3fe905,_0x2f0eed=_0x2efcdc['toUpperCase'](),_0x287ab6='https://tesoft.uk/gateway/noda/webhook/',_0x3204a4=_0x489b33(0x153)+_0x42a189,_0x1d1d29={'name':_0x3b75b7,'paymentDescription':_0x583a25,'amount':_0x17044b,'currency':_0x2f0eed,'paymentId':_0x42a189,'webhookUrl':_0x287ab6,'returnUrl':_0x3204a4};_0x2dd108&&(_0x1d1d29['expiryDate']=_0x2dd108);const _0x16ae4e=Date[_0x489b33(0x194)]();try{console[_0x489b33(0x139)](_0x489b33(0x133)),console[_0x489b33(0x139)](_0x489b33(0x12c),this[_0x489b33(0x126)]),console[_0x489b33(0x139)](_0x489b33(0x154),JSON[_0x489b33(0x12b)](_0x1d1d29,null,0x2)),console[_0x489b33(0x139)](_0x489b33(0x15d),_0x42a189,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x489b33(0x139)](_0x489b33(0x152),_0x3204a4),loggerService_1[_0x489b33(0x130)][_0x489b33(0x18a)](_0x489b33(0x17d),'/payment-links',_0x489b33(0x193),_0x1d1d29);const _0x13c4e0=await fetch(this[_0x489b33(0x126)],{'method':_0x489b33(0x193),'headers':{'Content-Type':'application/json','Accept':_0x489b33(0x131),'User-Agent':_0x489b33(0x12d)},'body':JSON['stringify'](_0x1d1d29)}),_0x213a4c=Date[_0x489b33(0x194)]()-_0x16ae4e;console[_0x489b33(0x139)](_0x489b33(0x164)),console[_0x489b33(0x139)]('Status:',_0x13c4e0[_0x489b33(0x182)]),console[_0x489b33(0x139)](_0x489b33(0x138),_0x13c4e0['statusText']),console[_0x489b33(0x139)](_0x489b33(0x15f),Object[_0x489b33(0x18e)](_0x13c4e0[_0x489b33(0x128)][_0x489b33(0x13d)]())),console[_0x489b33(0x139)](_0x489b33(0x14b),_0x213a4c+'ms');const _0xd7e9c4=await _0x13c4e0[_0x489b33(0x170)]();console[_0x489b33(0x139)]('Raw\x20Response\x20Body:',_0xd7e9c4);if(!_0x13c4e0['ok']){console[_0x489b33(0x13a)](_0x489b33(0x188)),console[_0x489b33(0x13a)]('HTTP\x20Status:',_0x13c4e0[_0x489b33(0x182)]),console[_0x489b33(0x13a)]('Response\x20Body:',_0xd7e9c4),loggerService_1[_0x489b33(0x130)][_0x489b33(0x166)](_0x489b33(0x17d),_0x489b33(0x171),_0x13c4e0['status'],_0xd7e9c4,_0x213a4c),loggerService_1[_0x489b33(0x130)][_0x489b33(0x14a)](_0x489b33(0x17d),_0x489b33(0x171),_0x489b33(0x17c)+_0x13c4e0[_0x489b33(0x182)]+':\x20'+_0xd7e9c4);if(_0x13c4e0[_0x489b33(0x182)]===0x190)throw new Error(_0x489b33(0x13b));else{if(_0x13c4e0['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x489b33(0x150)+_0x13c4e0[_0x489b33(0x182)]+',\x20body:\x20'+_0xd7e9c4);}let _0x536045;try{_0x536045=JSON['parse'](_0xd7e9c4);}catch(_0x4be4bc){console['error'](_0x489b33(0x176),_0x4be4bc),loggerService_1['loggerService']['logWhiteDomainError'](_0x489b33(0x17d),'/payment-links',_0x489b33(0x156)+_0x4be4bc);throw new Error(_0x489b33(0x147)+_0xd7e9c4);}console[_0x489b33(0x139)](_0x489b33(0x160)),console[_0x489b33(0x139)](_0x489b33(0x137),JSON[_0x489b33(0x12b)](_0x536045,null,0x2)),loggerService_1[_0x489b33(0x130)][_0x489b33(0x166)](_0x489b33(0x17d),_0x489b33(0x171),_0x13c4e0[_0x489b33(0x182)],_0x536045,_0x213a4c);if(_0x536045['error']||_0x536045[_0x489b33(0x178)]){const _0x15d963=_0x536045[_0x489b33(0x16d)]||_0x536045[_0x489b33(0x13a)]||_0x489b33(0x13c);console[_0x489b33(0x13a)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x489b33(0x13a)](_0x489b33(0x197),_0x15d963),console[_0x489b33(0x13a)](_0x489b33(0x143),_0x536045['statusCode']),loggerService_1[_0x489b33(0x130)]['logWhiteDomainError'](_0x489b33(0x17d),_0x489b33(0x171),_0x489b33(0x141)+_0x15d963);throw new Error(_0x489b33(0x174)+_0x15d963);}if(!_0x536045['id']||!_0x536045[_0x489b33(0x18d)]?.['shortLink']){console[_0x489b33(0x13a)](_0x489b33(0x168)),console[_0x489b33(0x13a)](_0x489b33(0x16c)),console['error'](_0x489b33(0x151),_0x536045),loggerService_1[_0x489b33(0x130)][_0x489b33(0x14a)](_0x489b33(0x17d),_0x489b33(0x171),_0x489b33(0x18f));throw new Error(_0x489b33(0x196));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console[_0x489b33(0x139)](_0x489b33(0x132),_0x536045['id']),console[_0x489b33(0x139)](_0x489b33(0x18c),_0x536045['shortLinkUrls'][_0x489b33(0x12a)]),console['log'](_0x489b33(0x125),_0x536045[_0x489b33(0x18d)][_0x489b33(0x13e)]||_0x489b33(0x189)),console[_0x489b33(0x139)](_0x489b33(0x167),_0x42a189,_0x489b33(0x15e)),console['log']('✅\x20Return\x20URL\x20configured\x20for\x20pending:',_0x3204a4),{'gateway_payment_id':_0x536045['id'],'payment_url':_0x536045[_0x489b33(0x18d)][_0x489b33(0x12a)],'qr_code_url':_0x536045[_0x489b33(0x18d)][_0x489b33(0x13e)],'expiry_date':_0x536045[_0x489b33(0x173)]};}catch(_0xefba8){console[_0x489b33(0x13a)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x489b33(0x13a)]('Error\x20details:',_0xefba8),loggerService_1[_0x489b33(0x130)][_0x489b33(0x14a)](_0x489b33(0x17d),_0x489b33(0x171),_0xefba8);if(_0xefba8 instanceof Error){console[_0x489b33(0x13a)]('Error\x20message:',_0xefba8[_0x489b33(0x16d)]),console['error'](_0x489b33(0x17b),_0xefba8['stack']);throw new Error(_0x489b33(0x191)+_0xefba8[_0x489b33(0x16d)]);}throw new Error(_0x489b33(0x192));}}async[a48_0x52f578(0x17e)](_0x29e4d3){const _0x5a1e15=a48_0x52f578,_0x3df8e6=Date[_0x5a1e15(0x194)]();try{loggerService_1[_0x5a1e15(0x130)][_0x5a1e15(0x18a)]('noda','/payment-links/'+_0x29e4d3,_0x5a1e15(0x175),{});const _0x3d6421=await fetch(this[_0x5a1e15(0x126)]+'/'+_0x29e4d3,{'method':_0x5a1e15(0x175),'headers':{'Content-Type':_0x5a1e15(0x131),'User-Agent':_0x5a1e15(0x12d)}}),_0x13f601=Date['now']()-_0x3df8e6;if(!_0x3d6421['ok']){const _0x55d33a=await _0x3d6421[_0x5a1e15(0x170)]();loggerService_1[_0x5a1e15(0x130)][_0x5a1e15(0x166)]('noda','/payment-links/'+_0x29e4d3,_0x3d6421['status'],_0x55d33a,_0x13f601);throw new Error(_0x5a1e15(0x150)+_0x3d6421[_0x5a1e15(0x182)]);}const _0x2d65bf=await _0x3d6421[_0x5a1e15(0x187)]();loggerService_1['loggerService'][_0x5a1e15(0x166)](_0x5a1e15(0x17d),_0x5a1e15(0x155)+_0x29e4d3,_0x3d6421[_0x5a1e15(0x182)],_0x2d65bf,_0x13f601);if(_0x2d65bf[_0x5a1e15(0x13a)]||_0x2d65bf[_0x5a1e15(0x178)]){loggerService_1[_0x5a1e15(0x130)][_0x5a1e15(0x14a)]('noda','/payment-links/'+_0x29e4d3,_0x5a1e15(0x174)+(_0x2d65bf[_0x5a1e15(0x16d)]||_0x2d65bf[_0x5a1e15(0x13a)]||_0x5a1e15(0x148)));throw new Error('Noda\x20API\x20error:\x20'+(_0x2d65bf[_0x5a1e15(0x16d)]||_0x2d65bf[_0x5a1e15(0x13a)]||_0x5a1e15(0x148)));}let _0x92fb0c=_0x5a1e15(0x14c);if(_0x2d65bf[_0x5a1e15(0x159)]===![]){if(_0x2d65bf[_0x5a1e15(0x173)]){const _0x373dcb=new Date(_0x2d65bf[_0x5a1e15(0x173)]),_0xca698e=new Date();_0x373dcb<_0xca698e?_0x92fb0c=_0x5a1e15(0x165):_0x92fb0c=_0x5a1e15(0x183);}else _0x92fb0c=_0x5a1e15(0x183);}else _0x92fb0c='PENDING';return{'status':_0x92fb0c,'amount':_0x2d65bf[_0x5a1e15(0x15b)],'currency':_0x2d65bf['currency'],'isActive':_0x2d65bf[_0x5a1e15(0x159)]};}catch(_0x28bb95){console[_0x5a1e15(0x13a)]('Noda\x20payment\x20verification\x20error:',_0x28bb95),loggerService_1[_0x5a1e15(0x130)][_0x5a1e15(0x14a)](_0x5a1e15(0x17d),_0x5a1e15(0x155)+_0x29e4d3,_0x28bb95);throw new Error(_0x5a1e15(0x157)+(_0x28bb95 instanceof Error?_0x28bb95['message']:_0x5a1e15(0x148)));}}async[a48_0x52f578(0x14e)](_0x1b89e4){const _0x21f32b=a48_0x52f578;console['log'](_0x21f32b(0x172),_0x1b89e4);let _0x1d504d='PENDING';switch(_0x1b89e4[_0x21f32b(0x16f)]?.[_0x21f32b(0x16e)]()){case _0x21f32b(0x16b):case _0x21f32b(0x146):case _0x21f32b(0x15c):case'success':case _0x21f32b(0x14d):_0x1b89e4[_0x21f32b(0x15a)]===_0x21f32b(0x123)?_0x1d504d=_0x21f32b(0x140):_0x1d504d=_0x21f32b(0x14c);break;case _0x21f32b(0x144):case _0x21f32b(0x142):case _0x21f32b(0x180):case'error':case'rejected':_0x1d504d=_0x21f32b(0x183);break;case _0x21f32b(0x162):case'timeout':_0x1d504d=_0x21f32b(0x165);break;case _0x21f32b(0x161):case _0x21f32b(0x145):case _0x21f32b(0x181):case'processing':case _0x21f32b(0x17a):default:_0x1d504d=_0x21f32b(0x14c);break;}return{'paymentId':_0x1b89e4[_0x21f32b(0x13f)]||_0x1b89e4['PaymentId'],'status':_0x1d504d,'amount':_0x1b89e4[_0x21f32b(0x158)],'currency':_0x1b89e4[_0x21f32b(0x129)],'additionalInfo':{'method':_0x1b89e4[_0x21f32b(0x149)],'bankId':_0x1b89e4[_0x21f32b(0x16a)],'settled':_0x1b89e4[_0x21f32b(0x15a)],'settlementDate':_0x1b89e4['SettlementDate'],'remitterName':_0x1b89e4[_0x21f32b(0x169)]?.['Name'],'remitterIban':_0x1b89e4[_0x21f32b(0x169)]?.[_0x21f32b(0x195)],'bankTransactionId':_0x1b89e4['BankTransactionId']}};}[a48_0x52f578(0x179)](_0x1187b7,_0x189797){const _0x554cbb=a48_0x52f578;return console['log'](_0x554cbb(0x186),{'receivedSignature':_0x189797,'paymentId':_0x1187b7[_0x554cbb(0x177)],'merchantPaymentId':_0x1187b7[_0x554cbb(0x13f)]}),!![];}}function a48_0x5c04(){const _0x2fe7cc=['loggerService','application/json','Payment\x20Link\x20ID:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','__esModule','https://tesoft.uk/gateway/noda/','9Hlwuca','Parsed\x20Result:','Status\x20Text:','log','error','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Unknown\x20error\x20from\x20Noda\x20API','entries','qrCodeLink','MerchantPaymentId','PAID','Business\x20Error:\x20','canceled','Status\x20Code:','cancelled','created','completed','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Unknown\x20error','Method','logWhiteDomainError','Response\x20Time:','PENDING','successful','processWebhook','357fjUYof','HTTP\x20error!\x20status:\x20','Response\x20data:','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','https://tesoft.uk/gateway/pending.php?id=','Request\x20Body\x20(Direct\x20JSON):','/payment-links/','JSON\x20Parse\x20Error:\x20','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Amount','isActive','Settled','amount','paid','Order\x20ID\x20Format:','(8digits-8digits\x20format)','Headers:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','pending','expired','NodaService','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','EXPIRED','logWhiteDomainResponse','Order\x20ID\x20Used:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Remitter','BankId','done','Missing\x20id\x20or\x20shortLink\x20in\x20response','message','toLowerCase','Status','text','/payment-links','Processing\x20Noda\x20webhook:','expiryDate','Noda\x20API\x20error:\x20','GET','Failed\x20to\x20parse\x20JSON\x20response:','PaymentId','statusCode','verifyWebhookSignature','in_progress','Error\x20stack:','HTTP\x20','noda','verifyPayment','15761288JDZFDK','failed','active','status','FAILED','84498Umlrjv','createPaymentLink','Noda\x20webhook\x20signature\x20verification:','json','===\x20NODA\x20API\x20ERROR\x20===','Not\x20provided','logWhiteDomainRequest','1146980JeuQgu','Short\x20Link:','shortLinkUrls','fromEntries','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','185089GwRVag','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','POST','now','Iban','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Error\x20Message:','Yes','1692674wsTcIt','QR\x20Code\x20Link:','apiUrl','848799OMptfU','headers','Currency','shortLink','stringify','URL:','TesSoft\x20Payment\x20System/1.0','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','1973955OBGEhT'];a48_0x5c04=function(){return _0x2fe7cc;};return a48_0x5c04();}exports[a48_0x52f578(0x163)]=NodaService;