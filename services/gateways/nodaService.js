'use strict';const a50_0x328e93=a50_0x44fc;(function(_0x27735a,_0x4c6e7b){const _0x42d433=a50_0x44fc,_0x5914b6=_0x27735a();while(!![]){try{const _0x18b86a=parseInt(_0x42d433(0x132))/0x1+parseInt(_0x42d433(0x12c))/0x2+parseInt(_0x42d433(0x118))/0x3*(parseInt(_0x42d433(0xf7))/0x4)+-parseInt(_0x42d433(0x116))/0x5+parseInt(_0x42d433(0x136))/0x6*(-parseInt(_0x42d433(0x12b))/0x7)+-parseInt(_0x42d433(0x12d))/0x8*(parseInt(_0x42d433(0x143))/0x9)+parseInt(_0x42d433(0x130))/0xa;if(_0x18b86a===_0x4c6e7b)break;else _0x5914b6['push'](_0x5914b6['shift']());}catch(_0x434d9a){_0x5914b6['push'](_0x5914b6['shift']());}}}(a50_0x2b7e,0x66fab));function a50_0x2b7e(){const _0x4ae75a=['===\x20PARSED\x20NODA\x20RESPONSE\x20===','Request\x20Body\x20(Direct\x20JSON):','PENDING','TesSoft\x20Payment\x20System/1.0','3732273HZUpJV','Amount','isActive','===\x20NODA\x20API\x20ERROR\x20===','Business\x20Error:\x20','log','stack','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Order\x20ID\x20Format:','Noda\x20API\x20error:\x20','PaymentId','headers','===\x20NODA\x20SERVICE\x20ERROR\x20===','createPaymentLink','HTTP\x20','Error\x20stack:','https://tesoft.uk/gateway/noda/webhook/','Error\x20Message:','Iban','Not\x20provided','active','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','done','../loggerService','expiryDate','QR\x20Code\x20Link:','failed','(8digits-8digits\x20format)','logWhiteDomainRequest','Headers:','Name','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','(8digits-8digits\x20format\x20for\x20Noda)','Short\x20Link:','https://tesoft.uk/gateway/pending.php?id=','Payment\x20Link\x20ID:','expired','pending','stringify','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Remitter','defineProperty','BankId','text','POST','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','PAID','473864VIUHqu','Settled','rejected','completed','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','status','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Currency','Method','apiUrl','verifyPayment','loggerService','/payment-links','logWhiteDomainError','in_progress','BankTransactionId','json','Missing\x20id\x20or\x20shortLink\x20in\x20response','Response\x20data:','noda','EXPIRED','now','Unknown\x20error','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','statusText','HTTP\x20error!\x20status:\x20',',\x20body:\x20','qrCodeLink','verifyWebhookSignature','currency','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','2508835HyRCBE','/payment-links/','15BvNspG','Noda\x20payment\x20verification\x20error:','Error\x20details:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','URL:','FAILED','shortLinkUrls','error','NodaService','processing','shortLink','entries','canceled','Status\x20Code:','created','logWhiteDomainResponse','SettlementDate','processWebhook','GET','558173eiPXoj','1214630QriFFV','16gcXIPx','===\x20NODA\x20SUCCESS\x20===','toLowerCase','2840910kvrURq','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','667923mZxCvC','application/json','message','statusCode','30CjyGjE','MerchantPaymentId','Status\x20Text:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Parsed\x20Result:','Error\x20message:','Status','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','parse'];a50_0x2b7e=function(){return _0x4ae75a;};return a50_0x2b7e();}function a50_0x44fc(_0x4d6356,_0x52c19d){const _0x2b7ed3=a50_0x2b7e();return a50_0x44fc=function(_0x44fc8f,_0xaa1a06){_0x44fc8f=_0x44fc8f-0xca;let _0x5a0581=_0x2b7ed3[_0x44fc8f];return _0x5a0581;},a50_0x44fc(_0x4d6356,_0x52c19d);}Object[a50_0x328e93(0xf1)](exports,'__esModule',{'value':!![]}),exports[a50_0x328e93(0x120)]=void 0x0;const loggerService_1=require(a50_0x328e93(0xdf));class NodaService{constructor(){const _0xd8ed37=a50_0x328e93;this[_0xd8ed37(0x100)]='https://tesoft.uk/gateway/noda/',console[_0xd8ed37(0xcd)](_0xd8ed37(0xfd));}async[a50_0x328e93(0xd5)](_0x302eef){const _0x1946a7=a50_0x328e93,{orderId:_0x2db843,name:_0x12ba66,paymentDescription:_0x68091b,amount:_0x12dbce,currency:_0x2f4239,webhookUrl:_0x696f7b,returnUrl:_0x32a59b,expiryDate:_0x99707f}=_0x302eef,_0x155d7d=_0x2f4239['toUpperCase'](),_0x1f0a3a=_0x1946a7(0xd8),_0x1ee500=_0x1946a7(0xea)+_0x2db843,_0x99b1e8={'name':_0x12ba66,'paymentDescription':_0x68091b,'amount':_0x12dbce,'currency':_0x155d7d,'paymentId':_0x2db843,'webhookUrl':_0x1f0a3a,'returnUrl':_0x1ee500};_0x99707f&&(_0x99b1e8[_0x1946a7(0xe0)]=_0x99707f);const _0x3cef43=Date['now']();try{console[_0x1946a7(0xcd)](_0x1946a7(0x115)),console[_0x1946a7(0xcd)](_0x1946a7(0x11c),this[_0x1946a7(0x100)]),console[_0x1946a7(0xcd)](_0x1946a7(0x140),JSON['stringify'](_0x99b1e8,null,0x2)),console['log'](_0x1946a7(0xd0),_0x2db843,_0x1946a7(0xe8)),console[_0x1946a7(0xcd)](_0x1946a7(0xcf),_0x1ee500),loggerService_1[_0x1946a7(0x102)]['logWhiteDomainRequest'](_0x1946a7(0x10a),_0x1946a7(0x103),_0x1946a7(0xf4),_0x99b1e8);const _0x2689ff=await fetch(this[_0x1946a7(0x100)],{'method':_0x1946a7(0xf4),'headers':{'Content-Type':_0x1946a7(0x133),'Accept':_0x1946a7(0x133),'User-Agent':_0x1946a7(0x142)},'body':JSON[_0x1946a7(0xee)](_0x99b1e8)}),_0x2fcc5f=Date[_0x1946a7(0x10c)]()-_0x3cef43;console[_0x1946a7(0xcd)](_0x1946a7(0xdd)),console[_0x1946a7(0xcd)]('Status:',_0x2689ff[_0x1946a7(0xfc)]),console[_0x1946a7(0xcd)](_0x1946a7(0x138),_0x2689ff[_0x1946a7(0x10f)]),console[_0x1946a7(0xcd)](_0x1946a7(0xe5),Object['fromEntries'](_0x2689ff[_0x1946a7(0xd3)][_0x1946a7(0x123)]())),console[_0x1946a7(0xcd)]('Response\x20Time:',_0x2fcc5f+'ms');const _0x587040=await _0x2689ff[_0x1946a7(0xf3)]();console[_0x1946a7(0xcd)]('Raw\x20Response\x20Body:',_0x587040);if(!_0x2689ff['ok']){console[_0x1946a7(0x11f)](_0x1946a7(0xcb)),console[_0x1946a7(0x11f)]('HTTP\x20Status:',_0x2689ff[_0x1946a7(0xfc)]),console['error']('Response\x20Body:',_0x587040),loggerService_1[_0x1946a7(0x102)]['logWhiteDomainResponse'](_0x1946a7(0x10a),_0x1946a7(0x103),_0x2689ff['status'],_0x587040,_0x2fcc5f),loggerService_1[_0x1946a7(0x102)][_0x1946a7(0x104)]('noda',_0x1946a7(0x103),_0x1946a7(0xd6)+_0x2689ff[_0x1946a7(0xfc)]+':\x20'+_0x587040);if(_0x2689ff[_0x1946a7(0xfc)]===0x190)throw new Error(_0x1946a7(0xef));else{if(_0x2689ff[_0x1946a7(0xfc)]===0x1f4)throw new Error(_0x1946a7(0x131));}throw new Error(_0x1946a7(0x110)+_0x2689ff[_0x1946a7(0xfc)]+_0x1946a7(0x111)+_0x587040);}let _0x5e560b;try{_0x5e560b=JSON[_0x1946a7(0x13e)](_0x587040);}catch(_0x14b844){console[_0x1946a7(0x11f)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x14b844),loggerService_1[_0x1946a7(0x102)][_0x1946a7(0x104)](_0x1946a7(0x10a),'/payment-links','JSON\x20Parse\x20Error:\x20'+_0x14b844);throw new Error(_0x1946a7(0x11b)+_0x587040);}console['log'](_0x1946a7(0x13f)),console[_0x1946a7(0xcd)](_0x1946a7(0x13a),JSON[_0x1946a7(0xee)](_0x5e560b,null,0x2)),loggerService_1[_0x1946a7(0x102)][_0x1946a7(0x127)](_0x1946a7(0x10a),_0x1946a7(0x103),_0x2689ff[_0x1946a7(0xfc)],_0x5e560b,_0x2fcc5f);if(_0x5e560b[_0x1946a7(0x11f)]||_0x5e560b[_0x1946a7(0x135)]){const _0xf140bc=_0x5e560b[_0x1946a7(0x134)]||_0x5e560b[_0x1946a7(0x11f)]||'Unknown\x20error\x20from\x20Noda\x20API';console['error']('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x1946a7(0xd9),_0xf140bc),console['error'](_0x1946a7(0x125),_0x5e560b['statusCode']),loggerService_1[_0x1946a7(0x102)][_0x1946a7(0x104)](_0x1946a7(0x10a),_0x1946a7(0x103),_0x1946a7(0xcc)+_0xf140bc);throw new Error(_0x1946a7(0xd1)+_0xf140bc);}if(!_0x5e560b['id']||!_0x5e560b[_0x1946a7(0x11e)]?.['shortLink']){console[_0x1946a7(0x11f)](_0x1946a7(0x13d)),console[_0x1946a7(0x11f)](_0x1946a7(0x108)),console[_0x1946a7(0x11f)](_0x1946a7(0x109),_0x5e560b),loggerService_1['loggerService'][_0x1946a7(0x104)](_0x1946a7(0x10a),_0x1946a7(0x103),_0x1946a7(0xf5));throw new Error(_0x1946a7(0xe7));}return console['log'](_0x1946a7(0x12e)),console[_0x1946a7(0xcd)](_0x1946a7(0xeb),_0x5e560b['id']),console['log'](_0x1946a7(0xe9),_0x5e560b['shortLinkUrls'][_0x1946a7(0x122)]),console[_0x1946a7(0xcd)](_0x1946a7(0xe1),_0x5e560b['shortLinkUrls'][_0x1946a7(0x112)]||_0x1946a7(0xdb)),console['log']('Order\x20ID\x20Used:',_0x2db843,_0x1946a7(0xe3)),console[_0x1946a7(0xcd)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x1ee500),{'gateway_payment_id':_0x5e560b['id'],'payment_url':_0x5e560b['shortLinkUrls'][_0x1946a7(0x122)],'qr_code_url':_0x5e560b['shortLinkUrls'][_0x1946a7(0x112)],'expiry_date':_0x5e560b[_0x1946a7(0xe0)]};}catch(_0x1e8ac3){console[_0x1946a7(0x11f)](_0x1946a7(0xd4)),console[_0x1946a7(0x11f)](_0x1946a7(0x11a),_0x1e8ac3),loggerService_1[_0x1946a7(0x102)][_0x1946a7(0x104)](_0x1946a7(0x10a),_0x1946a7(0x103),_0x1e8ac3);if(_0x1e8ac3 instanceof Error){console[_0x1946a7(0x11f)](_0x1946a7(0x13b),_0x1e8ac3[_0x1946a7(0x134)]),console[_0x1946a7(0x11f)](_0x1946a7(0xd7),_0x1e8ac3[_0x1946a7(0xce)]);throw new Error(_0x1946a7(0x10e)+_0x1e8ac3[_0x1946a7(0x134)]);}throw new Error(_0x1946a7(0xfb));}}async[a50_0x328e93(0x101)](_0x498293){const _0x252f93=a50_0x328e93,_0x2b495c=Date['now']();try{loggerService_1[_0x252f93(0x102)][_0x252f93(0xe4)]('noda','/payment-links/'+_0x498293,_0x252f93(0x12a),{});const _0x1b40bf=await fetch(this[_0x252f93(0x100)]+'/'+_0x498293,{'method':_0x252f93(0x12a),'headers':{'Content-Type':_0x252f93(0x133),'User-Agent':_0x252f93(0x142)}}),_0x5dbfc9=Date[_0x252f93(0x10c)]()-_0x2b495c;if(!_0x1b40bf['ok']){const _0x20b6e7=await _0x1b40bf['text']();loggerService_1[_0x252f93(0x102)][_0x252f93(0x127)](_0x252f93(0x10a),_0x252f93(0x117)+_0x498293,_0x1b40bf[_0x252f93(0xfc)],_0x20b6e7,_0x5dbfc9);throw new Error(_0x252f93(0x110)+_0x1b40bf['status']);}const _0x55c4aa=await _0x1b40bf[_0x252f93(0x107)]();loggerService_1[_0x252f93(0x102)][_0x252f93(0x127)](_0x252f93(0x10a),'/payment-links/'+_0x498293,_0x1b40bf['status'],_0x55c4aa,_0x5dbfc9);if(_0x55c4aa[_0x252f93(0x11f)]||_0x55c4aa[_0x252f93(0x135)]){loggerService_1[_0x252f93(0x102)][_0x252f93(0x104)]('noda',_0x252f93(0x117)+_0x498293,'Noda\x20API\x20error:\x20'+(_0x55c4aa[_0x252f93(0x134)]||_0x55c4aa[_0x252f93(0x11f)]||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x55c4aa[_0x252f93(0x134)]||_0x55c4aa[_0x252f93(0x11f)]||_0x252f93(0x10d)));}let _0x114287=_0x252f93(0x141);if(_0x55c4aa[_0x252f93(0xca)]===![]){if(_0x55c4aa[_0x252f93(0xe0)]){const _0x33e141=new Date(_0x55c4aa[_0x252f93(0xe0)]),_0x5aeb24=new Date();_0x33e141<_0x5aeb24?_0x114287=_0x252f93(0x10b):_0x114287=_0x252f93(0x11d);}else _0x114287=_0x252f93(0x11d);}else _0x114287=_0x252f93(0x141);return{'status':_0x114287,'amount':_0x55c4aa['amount'],'currency':_0x55c4aa[_0x252f93(0x114)],'isActive':_0x55c4aa['isActive']};}catch(_0x330abd){console[_0x252f93(0x11f)](_0x252f93(0x119),_0x330abd),loggerService_1[_0x252f93(0x102)][_0x252f93(0x104)]('noda',_0x252f93(0x117)+_0x498293,_0x330abd);throw new Error(_0x252f93(0x139)+(_0x330abd instanceof Error?_0x330abd[_0x252f93(0x134)]:_0x252f93(0x10d)));}}async[a50_0x328e93(0x129)](_0x563ab8){const _0x55f16f=a50_0x328e93;console[_0x55f16f(0xcd)]('Processing\x20Noda\x20webhook:',_0x563ab8);let _0x36f7ad=_0x55f16f(0x141);switch(_0x563ab8[_0x55f16f(0x13c)]?.[_0x55f16f(0x12f)]()){case _0x55f16f(0xde):case _0x55f16f(0xfa):case'paid':case'success':case'successful':_0x563ab8['Settled']==='Yes'?_0x36f7ad=_0x55f16f(0xf6):_0x36f7ad=_0x55f16f(0x141);break;case'cancelled':case _0x55f16f(0x124):case _0x55f16f(0xe2):case _0x55f16f(0x11f):case _0x55f16f(0xf9):_0x36f7ad=_0x55f16f(0x11d);break;case _0x55f16f(0xec):case'timeout':_0x36f7ad=_0x55f16f(0x10b);break;case _0x55f16f(0xed):case _0x55f16f(0x126):case _0x55f16f(0xdc):case _0x55f16f(0x121):case _0x55f16f(0x105):default:_0x36f7ad=_0x55f16f(0x141);break;}return{'paymentId':_0x563ab8[_0x55f16f(0x137)]||_0x563ab8[_0x55f16f(0xd2)],'status':_0x36f7ad,'amount':_0x563ab8[_0x55f16f(0x144)],'currency':_0x563ab8[_0x55f16f(0xfe)],'additionalInfo':{'method':_0x563ab8[_0x55f16f(0xff)],'bankId':_0x563ab8[_0x55f16f(0xf2)],'settled':_0x563ab8[_0x55f16f(0xf8)],'settlementDate':_0x563ab8[_0x55f16f(0x128)],'remitterName':_0x563ab8[_0x55f16f(0xf0)]?.[_0x55f16f(0xe6)],'remitterIban':_0x563ab8[_0x55f16f(0xf0)]?.[_0x55f16f(0xda)],'bankTransactionId':_0x563ab8[_0x55f16f(0x106)]}};}[a50_0x328e93(0x113)](_0x102081,_0x3ee484){const _0xdf026=a50_0x328e93;return console[_0xdf026(0xcd)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x3ee484,'paymentId':_0x102081['PaymentId'],'merchantPaymentId':_0x102081[_0xdf026(0x137)]}),!![];}}exports[a50_0x328e93(0x120)]=NodaService;