'use strict';const a43_0x36c68b=a43_0xe631;function a43_0xe631(_0x26590c,_0x3f4f83){const _0x4535b0=a43_0x4535();return a43_0xe631=function(_0xe631f,_0x2f21bb){_0xe631f=_0xe631f-0x1bd;let _0x49a5b2=_0x4535b0[_0xe631f];return _0x49a5b2;},a43_0xe631(_0x26590c,_0x3f4f83);}(function(_0x183897,_0x7c52ae){const _0x5cb3d2=a43_0xe631,_0x5787ea=_0x183897();while(!![]){try{const _0x19708e=parseInt(_0x5cb3d2(0x1e1))/0x1*(parseInt(_0x5cb3d2(0x20c))/0x2)+parseInt(_0x5cb3d2(0x1ee))/0x3+parseInt(_0x5cb3d2(0x206))/0x4+-parseInt(_0x5cb3d2(0x202))/0x5*(-parseInt(_0x5cb3d2(0x1d5))/0x6)+-parseInt(_0x5cb3d2(0x232))/0x7+parseInt(_0x5cb3d2(0x208))/0x8+-parseInt(_0x5cb3d2(0x1e2))/0x9*(parseInt(_0x5cb3d2(0x1e5))/0xa);if(_0x19708e===_0x7c52ae)break;else _0x5787ea['push'](_0x5787ea['shift']());}catch(_0x1e41e6){_0x5787ea['push'](_0x5787ea['shift']());}}}(a43_0x4535,0x6be27));Object[a43_0x36c68b(0x228)](exports,a43_0x36c68b(0x224),{'value':!![]}),exports[a43_0x36c68b(0x1f9)]=void 0x0;const loggerService_1=require(a43_0x36c68b(0x22e));class NodaService{constructor(){const _0x4f5d73=a43_0x36c68b;this['apiUrl']='https://tesoft.uk/gateway/noda/',console['log'](_0x4f5d73(0x1c9));}async[a43_0x36c68b(0x1cd)](_0x525648){const _0x255a32=a43_0x36c68b,{orderId:_0x7b3335,name:_0x4eb20d,paymentDescription:_0xae326a,amount:_0x4d1f19,currency:_0x1102e4,webhookUrl:_0x42f826,returnUrl:_0x475f8d,expiryDate:_0x20970f}=_0x525648,_0x5a1af=_0x1102e4[_0x255a32(0x20d)](),_0x3425c7=_0x255a32(0x200),_0x416cab=_0x255a32(0x1c2)+_0x7b3335,_0x51e517={'name':_0x4eb20d,'paymentDescription':_0xae326a,'amount':_0x4d1f19,'currency':_0x5a1af,'paymentId':_0x7b3335,'webhookUrl':_0x3425c7,'returnUrl':_0x416cab};_0x20970f&&(_0x51e517[_0x255a32(0x204)]=_0x20970f);const _0x2135c3=Date[_0x255a32(0x22b)]();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console['log'](_0x255a32(0x210),this[_0x255a32(0x1e6)]),console[_0x255a32(0x1d3)](_0x255a32(0x1d1),JSON['stringify'](_0x51e517,null,0x2)),console[_0x255a32(0x1d3)](_0x255a32(0x229),_0x7b3335,_0x255a32(0x1c6)),console[_0x255a32(0x1d3)](_0x255a32(0x216),_0x416cab),loggerService_1['loggerService'][_0x255a32(0x1d6)](_0x255a32(0x21c),_0x255a32(0x20b),_0x255a32(0x1eb),_0x51e517);const _0x3394a2=await fetch(this[_0x255a32(0x1e6)],{'method':_0x255a32(0x1eb),'headers':{'Content-Type':_0x255a32(0x1dd),'Accept':_0x255a32(0x1dd),'User-Agent':_0x255a32(0x223)},'body':JSON['stringify'](_0x51e517)}),_0x5432e5=Date[_0x255a32(0x22b)]()-_0x2135c3;console['log'](_0x255a32(0x1f5)),console['log'](_0x255a32(0x20a),_0x3394a2[_0x255a32(0x222)]),console[_0x255a32(0x1d3)]('Status\x20Text:',_0x3394a2[_0x255a32(0x218)]),console[_0x255a32(0x1d3)](_0x255a32(0x1e3),Object['fromEntries'](_0x3394a2['headers'][_0x255a32(0x1f2)]())),console[_0x255a32(0x1d3)](_0x255a32(0x22d),_0x5432e5+'ms');const _0x32492e=await _0x3394a2[_0x255a32(0x214)]();console[_0x255a32(0x1d3)]('Raw\x20Response\x20Body:',_0x32492e);if(!_0x3394a2['ok']){console[_0x255a32(0x1d8)](_0x255a32(0x230)),console['error']('HTTP\x20Status:',_0x3394a2[_0x255a32(0x222)]),console[_0x255a32(0x1d8)](_0x255a32(0x1f0),_0x32492e),loggerService_1['loggerService'][_0x255a32(0x217)](_0x255a32(0x21c),_0x255a32(0x20b),_0x3394a2[_0x255a32(0x222)],_0x32492e,_0x5432e5),loggerService_1[_0x255a32(0x1c1)]['logWhiteDomainError'](_0x255a32(0x21c),_0x255a32(0x20b),'HTTP\x20'+_0x3394a2[_0x255a32(0x222)]+':\x20'+_0x32492e);if(_0x3394a2[_0x255a32(0x222)]===0x190)throw new Error(_0x255a32(0x21e));else{if(_0x3394a2[_0x255a32(0x222)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x255a32(0x1cb)+_0x3394a2[_0x255a32(0x222)]+_0x255a32(0x1d0)+_0x32492e);}let _0x2c675a;try{_0x2c675a=JSON['parse'](_0x32492e);}catch(_0x5d13a2){console['error'](_0x255a32(0x1fa),_0x5d13a2),loggerService_1[_0x255a32(0x1c1)][_0x255a32(0x1c4)](_0x255a32(0x21c),_0x255a32(0x20b),_0x255a32(0x1f4)+_0x5d13a2);throw new Error(_0x255a32(0x1d9)+_0x32492e);}console[_0x255a32(0x1d3)](_0x255a32(0x1c3)),console[_0x255a32(0x1d3)]('Parsed\x20Result:',JSON[_0x255a32(0x1da)](_0x2c675a,null,0x2)),loggerService_1[_0x255a32(0x1c1)]['logWhiteDomainResponse'](_0x255a32(0x21c),'/payment-links',_0x3394a2[_0x255a32(0x222)],_0x2c675a,_0x5432e5);if(_0x2c675a[_0x255a32(0x1d8)]||_0x2c675a['statusCode']){const _0x89628a=_0x2c675a[_0x255a32(0x215)]||_0x2c675a[_0x255a32(0x1d8)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x255a32(0x1d8)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x255a32(0x1d8)](_0x255a32(0x1ca),_0x89628a),console[_0x255a32(0x1d8)](_0x255a32(0x1d2),_0x2c675a[_0x255a32(0x1fb)]),loggerService_1['loggerService'][_0x255a32(0x1c4)](_0x255a32(0x21c),_0x255a32(0x20b),_0x255a32(0x21d)+_0x89628a);throw new Error(_0x255a32(0x1ea)+_0x89628a);}if(!_0x2c675a['id']||!_0x2c675a[_0x255a32(0x1cf)]?.[_0x255a32(0x226)]){console['error'](_0x255a32(0x205)),console[_0x255a32(0x1d8)](_0x255a32(0x213)),console[_0x255a32(0x1d8)](_0x255a32(0x1bf),_0x2c675a),loggerService_1[_0x255a32(0x1c1)][_0x255a32(0x1c4)](_0x255a32(0x21c),'/payment-links',_0x255a32(0x1ff));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x255a32(0x1d3)](_0x255a32(0x1f6)),console[_0x255a32(0x1d3)]('Payment\x20Link\x20ID:',_0x2c675a['id']),console[_0x255a32(0x1d3)](_0x255a32(0x234),_0x2c675a[_0x255a32(0x1cf)][_0x255a32(0x226)]),console[_0x255a32(0x1d3)](_0x255a32(0x1db),_0x2c675a[_0x255a32(0x1cf)][_0x255a32(0x1c0)]||'Not\x20provided'),console[_0x255a32(0x1d3)]('Order\x20ID\x20Used:',_0x7b3335,_0x255a32(0x1c8)),console[_0x255a32(0x1d3)]('✅\x20Return\x20URL\x20configured\x20for\x20pending:',_0x416cab),{'gateway_payment_id':_0x2c675a['id'],'payment_url':_0x2c675a[_0x255a32(0x1cf)]['shortLink'],'qr_code_url':_0x2c675a[_0x255a32(0x1cf)][_0x255a32(0x1c0)],'expiry_date':_0x2c675a[_0x255a32(0x204)]};}catch(_0x454e0d){console['error'](_0x255a32(0x22c)),console[_0x255a32(0x1d8)](_0x255a32(0x1be),_0x454e0d),loggerService_1['loggerService'][_0x255a32(0x1c4)](_0x255a32(0x21c),_0x255a32(0x20b),_0x454e0d);if(_0x454e0d instanceof Error){console[_0x255a32(0x1d8)](_0x255a32(0x1e9),_0x454e0d[_0x255a32(0x215)]),console[_0x255a32(0x1d8)]('Error\x20stack:',_0x454e0d[_0x255a32(0x209)]);throw new Error(_0x255a32(0x231)+_0x454e0d[_0x255a32(0x215)]);}throw new Error(_0x255a32(0x233));}}async[a43_0x36c68b(0x1de)](_0x45d013){const _0x2c9589=a43_0x36c68b,_0x4387ba=Date[_0x2c9589(0x22b)]();try{loggerService_1[_0x2c9589(0x1c1)][_0x2c9589(0x1d6)](_0x2c9589(0x21c),_0x2c9589(0x1e0)+_0x45d013,_0x2c9589(0x1dc),{});const _0x53a0ac=await fetch(this['apiUrl']+'/'+_0x45d013,{'method':_0x2c9589(0x1dc),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x39bde8=Date[_0x2c9589(0x22b)]()-_0x4387ba;if(!_0x53a0ac['ok']){const _0x47a2e5=await _0x53a0ac[_0x2c9589(0x214)]();loggerService_1[_0x2c9589(0x1c1)][_0x2c9589(0x217)](_0x2c9589(0x21c),_0x2c9589(0x1e0)+_0x45d013,_0x53a0ac[_0x2c9589(0x222)],_0x47a2e5,_0x39bde8);throw new Error(_0x2c9589(0x1cb)+_0x53a0ac[_0x2c9589(0x222)]);}const _0xfc352=await _0x53a0ac['json']();loggerService_1[_0x2c9589(0x1c1)][_0x2c9589(0x217)]('noda',_0x2c9589(0x1e0)+_0x45d013,_0x53a0ac[_0x2c9589(0x222)],_0xfc352,_0x39bde8);if(_0xfc352['error']||_0xfc352[_0x2c9589(0x1fb)]){loggerService_1[_0x2c9589(0x1c1)][_0x2c9589(0x1c4)](_0x2c9589(0x21c),_0x2c9589(0x1e0)+_0x45d013,_0x2c9589(0x1ea)+(_0xfc352[_0x2c9589(0x215)]||_0xfc352['error']||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0xfc352[_0x2c9589(0x215)]||_0xfc352[_0x2c9589(0x1d8)]||'Unknown\x20error'));}let _0x35cd61=_0x2c9589(0x1f8);if(_0xfc352['isActive']===![]){if(_0xfc352[_0x2c9589(0x204)]){const _0x1815f7=new Date(_0xfc352[_0x2c9589(0x204)]),_0x52ed72=new Date();_0x1815f7<_0x52ed72?_0x35cd61='EXPIRED':_0x35cd61='FAILED';}else _0x35cd61=_0x2c9589(0x219);}else _0x35cd61=_0x2c9589(0x1f8);return{'status':_0x35cd61,'amount':_0xfc352[_0x2c9589(0x1cc)],'currency':_0xfc352[_0x2c9589(0x235)],'isActive':_0xfc352[_0x2c9589(0x1ed)]};}catch(_0x7905b9){console[_0x2c9589(0x1d8)](_0x2c9589(0x201),_0x7905b9),loggerService_1[_0x2c9589(0x1c1)]['logWhiteDomainError'](_0x2c9589(0x21c),_0x2c9589(0x1e0)+_0x45d013,_0x7905b9);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x7905b9 instanceof Error?_0x7905b9['message']:_0x2c9589(0x227)));}}async[a43_0x36c68b(0x22f)](_0x9acf7f){const _0x13be35=a43_0x36c68b;console['log']('Processing\x20Noda\x20webhook:',_0x9acf7f);let _0x3398bf=_0x13be35(0x1f8);switch(_0x9acf7f[_0x13be35(0x1c5)]?.[_0x13be35(0x203)]()){case _0x13be35(0x1fc):case _0x13be35(0x22a):case _0x13be35(0x1e7):case _0x13be35(0x1fe):case _0x13be35(0x1ec):_0x9acf7f['Settled']===_0x13be35(0x20e)?_0x3398bf=_0x13be35(0x1f7):_0x3398bf=_0x13be35(0x1f8);break;case _0x13be35(0x225):case _0x13be35(0x21a):case _0x13be35(0x1bd):case _0x13be35(0x1d8):case _0x13be35(0x1e8):_0x3398bf=_0x13be35(0x219);break;case _0x13be35(0x1e4):case'timeout':_0x3398bf=_0x13be35(0x1ce);break;case _0x13be35(0x20f):case _0x13be35(0x1f1):case _0x13be35(0x21b):case _0x13be35(0x1c7):case _0x13be35(0x1fd):default:_0x3398bf=_0x13be35(0x1f8);break;}return{'paymentId':_0x9acf7f['MerchantPaymentId']||_0x9acf7f[_0x13be35(0x1d7)],'status':_0x3398bf,'amount':_0x9acf7f['Amount'],'currency':_0x9acf7f[_0x13be35(0x207)],'additionalInfo':{'method':_0x9acf7f[_0x13be35(0x212)],'bankId':_0x9acf7f[_0x13be35(0x1d4)],'settled':_0x9acf7f[_0x13be35(0x21f)],'settlementDate':_0x9acf7f['SettlementDate'],'remitterName':_0x9acf7f['Remitter']?.[_0x13be35(0x1f3)],'remitterIban':_0x9acf7f[_0x13be35(0x220)]?.[_0x13be35(0x1ef)],'bankTransactionId':_0x9acf7f[_0x13be35(0x211)]}};}['verifyWebhookSignature'](_0x2cb2ae,_0x55e6f6){const _0x2c4415=a43_0x36c68b;return console[_0x2c4415(0x1d3)](_0x2c4415(0x1df),{'receivedSignature':_0x55e6f6,'paymentId':_0x2cb2ae[_0x2c4415(0x1d7)],'merchantPaymentId':_0x2cb2ae[_0x2c4415(0x221)]}),!![];}}function a43_0x4535(){const _0x1d490c=['BankId','24714pbutEF','logWhiteDomainRequest','PaymentId','error','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','stringify','QR\x20Code\x20Link:','GET','application/json','verifyPayment','Noda\x20webhook\x20signature\x20verification:','/payment-links/','46559ifmUks','34758RjNMOK','Headers:','expired','1310ViROet','apiUrl','paid','rejected','Error\x20message:','Noda\x20API\x20error:\x20','POST','successful','isActive','405528PlBYna','Iban','Response\x20Body:','created','entries','Name','JSON\x20Parse\x20Error:\x20','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20NODA\x20SUCCESS\x20===','PAID','PENDING','NodaService','Failed\x20to\x20parse\x20JSON\x20response:','statusCode','done','in_progress','success','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','https://tesoft.uk/gateway/noda/webhook/','Noda\x20payment\x20verification\x20error:','220OhUfwl','toLowerCase','expiryDate','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','1048044iHwpZK','Currency','2151312uoYPms','stack','Status:','/payment-links','34oZrgQj','toUpperCase','Yes','pending','URL:','BankTransactionId','Method','Missing\x20id\x20or\x20shortLink\x20in\x20response','text','message','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','logWhiteDomainResponse','statusText','FAILED','canceled','active','noda','Business\x20Error:\x20','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Settled','Remitter','MerchantPaymentId','status','TesSoft\x20Payment\x20System/1.0','__esModule','cancelled','shortLink','Unknown\x20error','defineProperty','Order\x20ID\x20Format:','completed','now','===\x20NODA\x20SERVICE\x20ERROR\x20===','Response\x20Time:','../loggerService','processWebhook','===\x20NODA\x20API\x20ERROR\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','4837161xfcAVW','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Short\x20Link:','currency','failed','Error\x20details:','Response\x20data:','qrCodeLink','loggerService','https://tesoft.uk/gateway/pending.php?id=','===\x20PARSED\x20NODA\x20RESPONSE\x20===','logWhiteDomainError','Status','(8digits-8digits\x20format\x20for\x20Noda)','processing','(8digits-8digits\x20format)','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20Message:','HTTP\x20error!\x20status:\x20','amount','createPaymentLink','EXPIRED','shortLinkUrls',',\x20body:\x20','Request\x20Body\x20(Direct\x20JSON):','Status\x20Code:','log'];a43_0x4535=function(){return _0x1d490c;};return a43_0x4535();}exports[a43_0x36c68b(0x1f9)]=NodaService;