'use strict';const a51_0x439889=a51_0x294e;(function(_0x4b1de8,_0xdf6475){const _0x419ba9=a51_0x294e,_0x2f519f=_0x4b1de8();while(!![]){try{const _0x51f22f=parseInt(_0x419ba9(0x168))/0x1*(parseInt(_0x419ba9(0x164))/0x2)+-parseInt(_0x419ba9(0x1a4))/0x3*(-parseInt(_0x419ba9(0x185))/0x4)+-parseInt(_0x419ba9(0x17c))/0x5*(-parseInt(_0x419ba9(0x169))/0x6)+-parseInt(_0x419ba9(0x1c3))/0x7+parseInt(_0x419ba9(0x157))/0x8+-parseInt(_0x419ba9(0x182))/0x9*(-parseInt(_0x419ba9(0x177))/0xa)+-parseInt(_0x419ba9(0x1bf))/0xb;if(_0x51f22f===_0xdf6475)break;else _0x2f519f['push'](_0x2f519f['shift']());}catch(_0x3c10be){_0x2f519f['push'](_0x2f519f['shift']());}}}(a51_0x2db1,0x675ff));Object[a51_0x439889(0x1b7)](exports,a51_0x439889(0x172),{'value':!![]}),exports[a51_0x439889(0x16b)]=void 0x0;const loggerService_1=require(a51_0x439889(0x17e));function a51_0x294e(_0x377454,_0x1b365a){const _0x2db1c1=a51_0x2db1();return a51_0x294e=function(_0x294eb3,_0x584551){_0x294eb3=_0x294eb3-0x14e;let _0x467636=_0x2db1c1[_0x294eb3];return _0x467636;},a51_0x294e(_0x377454,_0x1b365a);}function a51_0x2db1(){const _0x3b492=['shortLinkUrls','8CezMui','loggerService','created','failed','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Currency','now','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Noda\x20payment\x20verification\x20error:','===\x20NODA\x20SERVICE\x20ERROR\x20===','MerchantPaymentId','createPaymentLink','Noda\x20API\x20error:\x20','Status\x20Text:','BankId','GET','error','pending','Method','logWhiteDomainError','parse','expired','entries','canceled','verifyPayment','Noda\x20webhook\x20signature\x20verification:','Business\x20Error:\x20','===\x20NODA\x20API\x20ERROR\x20===','BankTransactionId','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Response\x20Time:','211590RlSXnv','Name','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','FAILED','headers','Error\x20stack:','apiUrl','JSON\x20Parse\x20Error:\x20','qrCodeLink','logWhiteDomainResponse','done','Raw\x20Response\x20Body:','isActive','application/json','Unknown\x20error','URL:','https://tesoft.uk/gateway/noda/','Yes','stringify','defineProperty','message','paid','json','expiryDate','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','stack','(8digits-8digits\x20format\x20for\x20Noda)','9809602GpQvSG','Status','verifyWebhookSignature','logWhiteDomainRequest','2970688CqqFNM','completed','Status:','/payment-links/','noda','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','HTTP\x20','Unknown\x20error\x20from\x20Noda\x20API','Parsed\x20Result:',',\x20body:\x20','5522912gXJeir','successful','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','https://tesoft.uk/gateway/noda/webhook/','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','SettlementDate','Headers:','log','https://tesoft.uk/gateway/pending.php?id=','statusText','timeout','Response\x20data:','cancelled','2404talyWW','HTTP\x20error!\x20status:\x20','Remitter','rejected','43ynePVH','4626zWaMgv','Error\x20details:','NodaService','HTTP\x20Status:','toLowerCase','Order\x20ID\x20Format:','currency','Short\x20Link:','Settled','__esModule','Response\x20Body:','text','EXPIRED','status','2443730NNCsLI','PaymentId','Failed\x20to\x20parse\x20JSON\x20response:','/payment-links','Failed\x20to\x20verify\x20Noda\x20payment:\x20','800SYeUPg','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','../loggerService','===\x20NODA\x20SUCCESS\x20===','statusCode','PENDING','27qfTEJT','amount'];a51_0x2db1=function(){return _0x3b492;};return a51_0x2db1();}class NodaService{constructor(){const _0x3b0b2f=a51_0x439889;this[_0x3b0b2f(0x1aa)]=_0x3b0b2f(0x1b4),console['log'](_0x3b0b2f(0x1a6));}async[a51_0x439889(0x190)](_0x1120b0){const _0x3d0ff3=a51_0x439889,{orderId:_0x1a8658,name:_0x2bd0d9,paymentDescription:_0x34d16e,amount:_0x38c034,currency:_0x49e12b,webhookUrl:_0x265f3b,returnUrl:_0x48a0b4,expiryDate:_0x25ea6f}=_0x1120b0,_0x1c34ed=_0x49e12b['toUpperCase'](),_0x340cd2=_0x3d0ff3(0x15a),_0x21261e=_0x3d0ff3(0x15f)+_0x1a8658,_0xd4db66={'name':_0x2bd0d9,'paymentDescription':_0x34d16e,'amount':_0x38c034,'currency':_0x1c34ed,'paymentId':_0x1a8658,'webhookUrl':_0x340cd2,'returnUrl':_0x21261e};_0x25ea6f&&(_0xd4db66[_0x3d0ff3(0x1bb)]=_0x25ea6f);const _0x1550e5=Date[_0x3d0ff3(0x18b)]();try{console[_0x3d0ff3(0x15e)](_0x3d0ff3(0x18c)),console[_0x3d0ff3(0x15e)](_0x3d0ff3(0x1b3),this[_0x3d0ff3(0x1aa)]),console[_0x3d0ff3(0x15e)]('Request\x20Body\x20(Direct\x20JSON):',JSON['stringify'](_0xd4db66,null,0x2)),console[_0x3d0ff3(0x15e)](_0x3d0ff3(0x16e),_0x1a8658,_0x3d0ff3(0x1be)),console[_0x3d0ff3(0x15e)](_0x3d0ff3(0x17d),_0x21261e),loggerService_1[_0x3d0ff3(0x186)][_0x3d0ff3(0x1c2)](_0x3d0ff3(0x151),_0x3d0ff3(0x17a),'POST',_0xd4db66);const _0x42650a=await fetch(this[_0x3d0ff3(0x1aa)],{'method':'POST','headers':{'Content-Type':_0x3d0ff3(0x1b1),'Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON['stringify'](_0xd4db66)}),_0x483a99=Date[_0x3d0ff3(0x18b)]()-_0x1550e5;console[_0x3d0ff3(0x15e)](_0x3d0ff3(0x15b)),console[_0x3d0ff3(0x15e)](_0x3d0ff3(0x14f),_0x42650a['status']),console[_0x3d0ff3(0x15e)](_0x3d0ff3(0x192),_0x42650a[_0x3d0ff3(0x160)]),console[_0x3d0ff3(0x15e)](_0x3d0ff3(0x15d),Object['fromEntries'](_0x42650a[_0x3d0ff3(0x1a8)][_0x3d0ff3(0x19b)]())),console[_0x3d0ff3(0x15e)](_0x3d0ff3(0x1a3),_0x483a99+'ms');const _0x4aedd8=await _0x42650a[_0x3d0ff3(0x174)]();console[_0x3d0ff3(0x15e)](_0x3d0ff3(0x1af),_0x4aedd8);if(!_0x42650a['ok']){console[_0x3d0ff3(0x195)](_0x3d0ff3(0x1a0)),console['error'](_0x3d0ff3(0x16c),_0x42650a['status']),console[_0x3d0ff3(0x195)](_0x3d0ff3(0x173),_0x4aedd8),loggerService_1[_0x3d0ff3(0x186)][_0x3d0ff3(0x1ad)](_0x3d0ff3(0x151),'/payment-links',_0x42650a[_0x3d0ff3(0x176)],_0x4aedd8,_0x483a99),loggerService_1[_0x3d0ff3(0x186)]['logWhiteDomainError'](_0x3d0ff3(0x151),_0x3d0ff3(0x17a),_0x3d0ff3(0x153)+_0x42650a[_0x3d0ff3(0x176)]+':\x20'+_0x4aedd8);if(_0x42650a[_0x3d0ff3(0x176)]===0x190)throw new Error(_0x3d0ff3(0x1bc));else{if(_0x42650a['status']===0x1f4)throw new Error(_0x3d0ff3(0x189));}throw new Error(_0x3d0ff3(0x165)+_0x42650a[_0x3d0ff3(0x176)]+_0x3d0ff3(0x156)+_0x4aedd8);}let _0x5e9776;try{_0x5e9776=JSON[_0x3d0ff3(0x199)](_0x4aedd8);}catch(_0x1931bc){console[_0x3d0ff3(0x195)](_0x3d0ff3(0x179),_0x1931bc),loggerService_1[_0x3d0ff3(0x186)]['logWhiteDomainError'](_0x3d0ff3(0x151),_0x3d0ff3(0x17a),_0x3d0ff3(0x1ab)+_0x1931bc);throw new Error(_0x3d0ff3(0x152)+_0x4aedd8);}console[_0x3d0ff3(0x15e)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x3d0ff3(0x15e)](_0x3d0ff3(0x155),JSON[_0x3d0ff3(0x1b6)](_0x5e9776,null,0x2)),loggerService_1['loggerService'][_0x3d0ff3(0x1ad)](_0x3d0ff3(0x151),_0x3d0ff3(0x17a),_0x42650a[_0x3d0ff3(0x176)],_0x5e9776,_0x483a99);if(_0x5e9776['error']||_0x5e9776['statusCode']){const _0x444bb2=_0x5e9776[_0x3d0ff3(0x1b8)]||_0x5e9776[_0x3d0ff3(0x195)]||_0x3d0ff3(0x154);console[_0x3d0ff3(0x195)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x3d0ff3(0x195)]('Error\x20Message:',_0x444bb2),console['error']('Status\x20Code:',_0x5e9776[_0x3d0ff3(0x180)]),loggerService_1[_0x3d0ff3(0x186)]['logWhiteDomainError'](_0x3d0ff3(0x151),_0x3d0ff3(0x17a),_0x3d0ff3(0x19f)+_0x444bb2);throw new Error(_0x3d0ff3(0x191)+_0x444bb2);}if(!_0x5e9776['id']||!_0x5e9776[_0x3d0ff3(0x184)]?.['shortLink']){console[_0x3d0ff3(0x195)](_0x3d0ff3(0x159)),console[_0x3d0ff3(0x195)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x3d0ff3(0x195)](_0x3d0ff3(0x162),_0x5e9776),loggerService_1[_0x3d0ff3(0x186)]['logWhiteDomainError'](_0x3d0ff3(0x151),_0x3d0ff3(0x17a),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x3d0ff3(0x1a2));}return console[_0x3d0ff3(0x15e)](_0x3d0ff3(0x17f)),console['log']('Payment\x20Link\x20ID:',_0x5e9776['id']),console[_0x3d0ff3(0x15e)](_0x3d0ff3(0x170),_0x5e9776['shortLinkUrls']['shortLink']),console[_0x3d0ff3(0x15e)]('QR\x20Code\x20Link:',_0x5e9776[_0x3d0ff3(0x184)][_0x3d0ff3(0x1ac)]||'Not\x20provided'),console['log']('Order\x20ID\x20Used:',_0x1a8658,'(8digits-8digits\x20format)'),console['log']('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x21261e),{'gateway_payment_id':_0x5e9776['id'],'payment_url':_0x5e9776[_0x3d0ff3(0x184)]['shortLink'],'qr_code_url':_0x5e9776[_0x3d0ff3(0x184)][_0x3d0ff3(0x1ac)],'expiry_date':_0x5e9776['expiryDate']};}catch(_0x115a8c){console[_0x3d0ff3(0x195)](_0x3d0ff3(0x18e)),console[_0x3d0ff3(0x195)](_0x3d0ff3(0x16a),_0x115a8c),loggerService_1['loggerService'][_0x3d0ff3(0x198)]('noda',_0x3d0ff3(0x17a),_0x115a8c);if(_0x115a8c instanceof Error){console[_0x3d0ff3(0x195)]('Error\x20message:',_0x115a8c[_0x3d0ff3(0x1b8)]),console[_0x3d0ff3(0x195)](_0x3d0ff3(0x1a9),_0x115a8c[_0x3d0ff3(0x1bd)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x115a8c[_0x3d0ff3(0x1b8)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a51_0x439889(0x19d)](_0x4876df){const _0x166f03=a51_0x439889,_0x35ecf9=Date[_0x166f03(0x18b)]();try{loggerService_1[_0x166f03(0x186)][_0x166f03(0x1c2)]('noda',_0x166f03(0x150)+_0x4876df,_0x166f03(0x194),{});const _0x4da926=await fetch(this[_0x166f03(0x1aa)]+'/'+_0x4876df,{'method':_0x166f03(0x194),'headers':{'Content-Type':_0x166f03(0x1b1),'User-Agent':'Payment\x20System/1.0'}}),_0x1e208c=Date['now']()-_0x35ecf9;if(!_0x4da926['ok']){const _0x5b5069=await _0x4da926[_0x166f03(0x174)]();loggerService_1[_0x166f03(0x186)][_0x166f03(0x1ad)]('noda',_0x166f03(0x150)+_0x4876df,_0x4da926[_0x166f03(0x176)],_0x5b5069,_0x1e208c);throw new Error(_0x166f03(0x165)+_0x4da926[_0x166f03(0x176)]);}const _0x2da0d8=await _0x4da926[_0x166f03(0x1ba)]();loggerService_1[_0x166f03(0x186)]['logWhiteDomainResponse']('noda',_0x166f03(0x150)+_0x4876df,_0x4da926[_0x166f03(0x176)],_0x2da0d8,_0x1e208c);if(_0x2da0d8[_0x166f03(0x195)]||_0x2da0d8['statusCode']){loggerService_1[_0x166f03(0x186)]['logWhiteDomainError']('noda',_0x166f03(0x150)+_0x4876df,_0x166f03(0x191)+(_0x2da0d8[_0x166f03(0x1b8)]||_0x2da0d8['error']||_0x166f03(0x1b2)));throw new Error(_0x166f03(0x191)+(_0x2da0d8[_0x166f03(0x1b8)]||_0x2da0d8['error']||_0x166f03(0x1b2)));}let _0x2c570e=_0x166f03(0x181);if(_0x2da0d8['isActive']===![]){if(_0x2da0d8[_0x166f03(0x1bb)]){const _0x170782=new Date(_0x2da0d8[_0x166f03(0x1bb)]),_0x23074b=new Date();_0x170782<_0x23074b?_0x2c570e=_0x166f03(0x175):_0x2c570e=_0x166f03(0x1a7);}else _0x2c570e=_0x166f03(0x1a7);}else _0x2c570e=_0x166f03(0x181);return{'status':_0x2c570e,'amount':_0x2da0d8[_0x166f03(0x183)],'currency':_0x2da0d8[_0x166f03(0x16f)],'isActive':_0x2da0d8[_0x166f03(0x1b0)]};}catch(_0x5d9a3d){console[_0x166f03(0x195)](_0x166f03(0x18d),_0x5d9a3d),loggerService_1[_0x166f03(0x186)]['logWhiteDomainError'](_0x166f03(0x151),_0x166f03(0x150)+_0x4876df,_0x5d9a3d);throw new Error(_0x166f03(0x17b)+(_0x5d9a3d instanceof Error?_0x5d9a3d[_0x166f03(0x1b8)]:'Unknown\x20error'));}}async['processWebhook'](_0x54a1ef){const _0x5e2233=a51_0x439889;console['log']('Processing\x20Noda\x20webhook:',_0x54a1ef);let _0x13fe62=_0x5e2233(0x181);switch(_0x54a1ef[_0x5e2233(0x1c0)]?.[_0x5e2233(0x16d)]()){case _0x5e2233(0x1ae):case _0x5e2233(0x14e):case _0x5e2233(0x1b9):case'success':case _0x5e2233(0x158):_0x54a1ef[_0x5e2233(0x171)]===_0x5e2233(0x1b5)?_0x13fe62='PAID':_0x13fe62='PENDING';break;case _0x5e2233(0x163):case _0x5e2233(0x19c):case _0x5e2233(0x188):case _0x5e2233(0x195):case _0x5e2233(0x167):_0x13fe62=_0x5e2233(0x1a7);break;case _0x5e2233(0x19a):case _0x5e2233(0x161):_0x13fe62='EXPIRED';break;case _0x5e2233(0x196):case _0x5e2233(0x187):case'active':case'processing':case'in_progress':default:_0x13fe62=_0x5e2233(0x181);break;}return{'paymentId':_0x54a1ef[_0x5e2233(0x18f)]||_0x54a1ef[_0x5e2233(0x178)],'status':_0x13fe62,'amount':_0x54a1ef['Amount'],'currency':_0x54a1ef[_0x5e2233(0x18a)],'additionalInfo':{'method':_0x54a1ef[_0x5e2233(0x197)],'bankId':_0x54a1ef[_0x5e2233(0x193)],'settled':_0x54a1ef['Settled'],'settlementDate':_0x54a1ef[_0x5e2233(0x15c)],'remitterName':_0x54a1ef[_0x5e2233(0x166)]?.[_0x5e2233(0x1a5)],'remitterIban':_0x54a1ef[_0x5e2233(0x166)]?.['Iban'],'bankTransactionId':_0x54a1ef[_0x5e2233(0x1a1)]}};}[a51_0x439889(0x1c1)](_0x2f02df,_0x189bc1){const _0x5e9139=a51_0x439889;return console[_0x5e9139(0x15e)](_0x5e9139(0x19e),{'receivedSignature':_0x189bc1,'paymentId':_0x2f02df['PaymentId'],'merchantPaymentId':_0x2f02df[_0x5e9139(0x18f)]}),!![];}}exports[a51_0x439889(0x16b)]=NodaService;