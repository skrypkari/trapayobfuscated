'use strict';function a53_0xeaff(){const _0x2edd67=['shortLinkUrls','Name','failed','apiUrl','POST','6705UnplhX','active','successful',',\x20body:\x20','370478RcrpQm','currency','EXPIRED','85dtSPpX','https://tesoft.uk/gateway/noda/webhook/','canceled','634302lRqqmh','shortLink','amount','message','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','PaymentId','Status\x20Text:','processing','error','toUpperCase','Payment\x20System/1.0','Status:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','180OCTBdp','completed','Remitter','34396xkJjJC','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','SettlementDate','Noda\x20API\x20error:\x20','text','Error\x20details:','now','logWhiteDomainRequest','verifyPayment','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','9gKtiYz','statusText','(8digits-8digits\x20format)','1930467AdrxHK','Response\x20Time:','HTTP\x20error!\x20status:\x20','Status\x20Code:','log','Noda\x20webhook\x20signature\x20verification:','logWhiteDomainError','HTTP\x20','application/json','2032XoZwxg','===\x20NODA\x20API\x20ERROR\x20===','defineProperty','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','__esModule','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Noda\x20payment\x20verification\x20error:','Headers:','Order\x20ID\x20Used:','qrCodeLink','Response\x20Body:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','BankTransactionId','Iban','in_progress','https://tesoft.uk/gateway/pending.php?id=','json','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','NodaService','stringify','61848bgMTef','Failed\x20to\x20parse\x20JSON\x20response:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Parsed\x20Result:','Raw\x20Response\x20Body:','===\x20NODA\x20SERVICE\x20ERROR\x20===','BankId','created','HTTP\x20Status:','isActive','Response\x20data:','status','processWebhook','===\x20NODA\x20SUCCESS\x20===','rejected','Unknown\x20error','verifyWebhookSignature','stack','/payment-links','URL:','Business\x20Error:\x20','FAILED','logWhiteDomainResponse','Request\x20Body\x20(Direct\x20JSON):','Not\x20provided','headers','expiryDate','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','GET','paid','/payment-links/','success','noda','Short\x20Link:','370744NlpEIv','loggerService','entries','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','expired','Method','Settled','Unknown\x20error\x20from\x20Noda\x20API','PENDING','Error\x20stack:','(8digits-8digits\x20format\x20for\x20Noda)'];a53_0xeaff=function(){return _0x2edd67;};return a53_0xeaff();}const a53_0x3435f5=a53_0x51df;(function(_0x5cfab2,_0x1c2ad9){const _0xdd9236=a53_0x51df,_0x36a659=_0x5cfab2();while(!![]){try{const _0x1940af=parseInt(_0xdd9236(0x106))/0x1+-parseInt(_0xdd9236(0xd0))/0x2*(-parseInt(_0xdd9236(0x126))/0x3)+-parseInt(_0xdd9236(0x11c))/0x4*(parseInt(_0xdd9236(0x109))/0x5)+parseInt(_0xdd9236(0x10c))/0x6+parseInt(_0xdd9236(0x129))/0x7+-parseInt(_0xdd9236(0xbc))/0x8*(-parseInt(_0xdd9236(0x102))/0x9)+parseInt(_0xdd9236(0x119))/0xa*(-parseInt(_0xdd9236(0xf2))/0xb);if(_0x1940af===_0x1c2ad9)break;else _0x36a659['push'](_0x36a659['shift']());}catch(_0x3e3a5e){_0x36a659['push'](_0x36a659['shift']());}}}(a53_0xeaff,0x44a23));Object[a53_0x3435f5(0xbe)](exports,a53_0x3435f5(0xc0),{'value':!![]}),exports[a53_0x3435f5(0xce)]=void 0x0;function a53_0x51df(_0x27070b,_0x2ac903){const _0xeaff01=a53_0xeaff();return a53_0x51df=function(_0x51df19,_0x34be36){_0x51df19=_0x51df19-0xbb;let _0x2ba280=_0xeaff01[_0x51df19];return _0x2ba280;},a53_0x51df(_0x27070b,_0x2ac903);}const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x8596e9=a53_0x3435f5;this[_0x8596e9(0x100)]='https://tesoft.uk/gateway/noda/',console[_0x8596e9(0x12d)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async['createPaymentLink'](_0x26eb5d){const _0x5d11dd=a53_0x3435f5,{orderId:_0x529637,name:_0x1342d7,paymentDescription:_0x2fc44b,amount:_0x2c6c85,currency:_0x89e301,webhookUrl:_0x4c5b4e,returnUrl:_0x260eec,expiryDate:_0x105c2f}=_0x26eb5d,_0x95fcbe=_0x89e301[_0x5d11dd(0x115)](),_0x2f920e=_0x5d11dd(0x10a),_0x6128d8=_0x5d11dd(0xcb)+_0x529637,_0x511786={'name':_0x1342d7,'paymentDescription':_0x2fc44b,'amount':_0x2c6c85,'currency':_0x95fcbe,'paymentId':_0x529637,'webhookUrl':_0x2f920e,'returnUrl':_0x6128d8};_0x105c2f&&(_0x511786['expiryDate']=_0x105c2f);const _0x3aeae1=Date[_0x5d11dd(0x122)]();try{console[_0x5d11dd(0x12d)](_0x5d11dd(0xc7)),console[_0x5d11dd(0x12d)](_0x5d11dd(0xe3),this['apiUrl']),console[_0x5d11dd(0x12d)](_0x5d11dd(0xe7),JSON['stringify'](_0x511786,null,0x2)),console[_0x5d11dd(0x12d)]('Order\x20ID\x20Format:',_0x529637,_0x5d11dd(0xfc)),console['log'](_0x5d11dd(0xeb),_0x6128d8),loggerService_1['loggerService'][_0x5d11dd(0x123)](_0x5d11dd(0xf0),'/payment-links','POST',_0x511786);const _0xf4141d=await fetch(this[_0x5d11dd(0x100)],{'method':_0x5d11dd(0x101),'headers':{'Content-Type':_0x5d11dd(0xbb),'Accept':_0x5d11dd(0xbb),'User-Agent':_0x5d11dd(0x116)},'body':JSON[_0x5d11dd(0xcf)](_0x511786)}),_0x15c78b=Date[_0x5d11dd(0x122)]()-_0x3aeae1;console['log'](_0x5d11dd(0xd2)),console[_0x5d11dd(0x12d)](_0x5d11dd(0x117),_0xf4141d[_0x5d11dd(0xdb)]),console[_0x5d11dd(0x12d)](_0x5d11dd(0x112),_0xf4141d[_0x5d11dd(0x127)]),console[_0x5d11dd(0x12d)](_0x5d11dd(0xc3),Object['fromEntries'](_0xf4141d[_0x5d11dd(0xe9)][_0x5d11dd(0xf4)]())),console['log'](_0x5d11dd(0x12a),_0x15c78b+'ms');const _0x475251=await _0xf4141d[_0x5d11dd(0x120)]();console['log'](_0x5d11dd(0xd4),_0x475251);if(!_0xf4141d['ok']){console['error'](_0x5d11dd(0xbd)),console['error'](_0x5d11dd(0xd8),_0xf4141d[_0x5d11dd(0xdb)]),console[_0x5d11dd(0x114)](_0x5d11dd(0xc6),_0x475251),loggerService_1[_0x5d11dd(0xf3)][_0x5d11dd(0xe6)](_0x5d11dd(0xf0),_0x5d11dd(0xe2),_0xf4141d['status'],_0x475251,_0x15c78b),loggerService_1[_0x5d11dd(0xf3)][_0x5d11dd(0x12f)](_0x5d11dd(0xf0),_0x5d11dd(0xe2),_0x5d11dd(0x130)+_0xf4141d[_0x5d11dd(0xdb)]+':\x20'+_0x475251);if(_0xf4141d[_0x5d11dd(0xdb)]===0x190)throw new Error(_0x5d11dd(0x11d));else{if(_0xf4141d[_0x5d11dd(0xdb)]===0x1f4)throw new Error(_0x5d11dd(0x118));}throw new Error(_0x5d11dd(0x12b)+_0xf4141d[_0x5d11dd(0xdb)]+_0x5d11dd(0x105)+_0x475251);}let _0x49ce0e;try{_0x49ce0e=JSON['parse'](_0x475251);}catch(_0x4f21e0){console['error'](_0x5d11dd(0xd1),_0x4f21e0),loggerService_1['loggerService'][_0x5d11dd(0x12f)](_0x5d11dd(0xf0),_0x5d11dd(0xe2),'JSON\x20Parse\x20Error:\x20'+_0x4f21e0);throw new Error(_0x5d11dd(0xcd)+_0x475251);}console[_0x5d11dd(0x12d)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console['log'](_0x5d11dd(0xd3),JSON['stringify'](_0x49ce0e,null,0x2)),loggerService_1[_0x5d11dd(0xf3)]['logWhiteDomainResponse'](_0x5d11dd(0xf0),_0x5d11dd(0xe2),_0xf4141d['status'],_0x49ce0e,_0x15c78b);if(_0x49ce0e[_0x5d11dd(0x114)]||_0x49ce0e['statusCode']){const _0x40fc73=_0x49ce0e['message']||_0x49ce0e[_0x5d11dd(0x114)]||_0x5d11dd(0xf9);console['error']('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x5d11dd(0x114)]('Error\x20Message:',_0x40fc73),console[_0x5d11dd(0x114)](_0x5d11dd(0x12c),_0x49ce0e['statusCode']),loggerService_1[_0x5d11dd(0xf3)]['logWhiteDomainError'](_0x5d11dd(0xf0),_0x5d11dd(0xe2),_0x5d11dd(0xe4)+_0x40fc73);throw new Error(_0x5d11dd(0x11f)+_0x40fc73);}if(!_0x49ce0e['id']||!_0x49ce0e[_0x5d11dd(0xfd)]?.[_0x5d11dd(0x10d)]){console[_0x5d11dd(0x114)](_0x5d11dd(0xf5)),console[_0x5d11dd(0x114)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x5d11dd(0x114)](_0x5d11dd(0xda),_0x49ce0e),loggerService_1[_0x5d11dd(0xf3)][_0x5d11dd(0x12f)](_0x5d11dd(0xf0),_0x5d11dd(0xe2),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x5d11dd(0xbf));}return console[_0x5d11dd(0x12d)](_0x5d11dd(0xdd)),console[_0x5d11dd(0x12d)]('Payment\x20Link\x20ID:',_0x49ce0e['id']),console['log'](_0x5d11dd(0xf1),_0x49ce0e[_0x5d11dd(0xfd)][_0x5d11dd(0x10d)]),console[_0x5d11dd(0x12d)]('QR\x20Code\x20Link:',_0x49ce0e[_0x5d11dd(0xfd)]['qrCodeLink']||_0x5d11dd(0xe8)),console['log'](_0x5d11dd(0xc4),_0x529637,_0x5d11dd(0x128)),console[_0x5d11dd(0x12d)](_0x5d11dd(0xc1),_0x6128d8),{'gateway_payment_id':_0x49ce0e['id'],'payment_url':_0x49ce0e[_0x5d11dd(0xfd)][_0x5d11dd(0x10d)],'qr_code_url':_0x49ce0e['shortLinkUrls'][_0x5d11dd(0xc5)],'expiry_date':_0x49ce0e[_0x5d11dd(0xea)]};}catch(_0xc62cc7){console[_0x5d11dd(0x114)](_0x5d11dd(0xd5)),console['error'](_0x5d11dd(0x121),_0xc62cc7),loggerService_1[_0x5d11dd(0xf3)][_0x5d11dd(0x12f)]('noda',_0x5d11dd(0xe2),_0xc62cc7);if(_0xc62cc7 instanceof Error){console[_0x5d11dd(0x114)]('Error\x20message:',_0xc62cc7[_0x5d11dd(0x10f)]),console[_0x5d11dd(0x114)](_0x5d11dd(0xfb),_0xc62cc7[_0x5d11dd(0xe1)]);throw new Error(_0x5d11dd(0x125)+_0xc62cc7[_0x5d11dd(0x10f)]);}throw new Error(_0x5d11dd(0x110));}}async[a53_0x3435f5(0x124)](_0x3d3ec2){const _0x57c156=a53_0x3435f5,_0x558a8b=Date[_0x57c156(0x122)]();try{loggerService_1['loggerService']['logWhiteDomainRequest']('noda',_0x57c156(0xee)+_0x3d3ec2,_0x57c156(0xec),{});const _0x3901dd=await fetch(this['apiUrl']+'/'+_0x3d3ec2,{'method':_0x57c156(0xec),'headers':{'Content-Type':_0x57c156(0xbb),'User-Agent':_0x57c156(0x116)}}),_0x416610=Date[_0x57c156(0x122)]()-_0x558a8b;if(!_0x3901dd['ok']){const _0xf57b2=await _0x3901dd[_0x57c156(0x120)]();loggerService_1[_0x57c156(0xf3)][_0x57c156(0xe6)]('noda','/payment-links/'+_0x3d3ec2,_0x3901dd[_0x57c156(0xdb)],_0xf57b2,_0x416610);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3901dd[_0x57c156(0xdb)]);}const _0x34b033=await _0x3901dd[_0x57c156(0xcc)]();loggerService_1[_0x57c156(0xf3)][_0x57c156(0xe6)](_0x57c156(0xf0),_0x57c156(0xee)+_0x3d3ec2,_0x3901dd[_0x57c156(0xdb)],_0x34b033,_0x416610);if(_0x34b033[_0x57c156(0x114)]||_0x34b033['statusCode']){loggerService_1[_0x57c156(0xf3)][_0x57c156(0x12f)](_0x57c156(0xf0),_0x57c156(0xee)+_0x3d3ec2,'Noda\x20API\x20error:\x20'+(_0x34b033[_0x57c156(0x10f)]||_0x34b033[_0x57c156(0x114)]||'Unknown\x20error'));throw new Error(_0x57c156(0x11f)+(_0x34b033[_0x57c156(0x10f)]||_0x34b033[_0x57c156(0x114)]||'Unknown\x20error'));}let _0x28bd21='PENDING';if(_0x34b033[_0x57c156(0xd9)]===![]){if(_0x34b033[_0x57c156(0xea)]){const _0x19fde6=new Date(_0x34b033['expiryDate']),_0x28c4a5=new Date();_0x19fde6<_0x28c4a5?_0x28bd21=_0x57c156(0x108):_0x28bd21='FAILED';}else _0x28bd21=_0x57c156(0xe5);}else _0x28bd21=_0x57c156(0xfa);return{'status':_0x28bd21,'amount':_0x34b033[_0x57c156(0x10e)],'currency':_0x34b033[_0x57c156(0x107)],'isActive':_0x34b033[_0x57c156(0xd9)]};}catch(_0x4f5b78){console[_0x57c156(0x114)](_0x57c156(0xc2),_0x4f5b78),loggerService_1[_0x57c156(0xf3)][_0x57c156(0x12f)](_0x57c156(0xf0),_0x57c156(0xee)+_0x3d3ec2,_0x4f5b78);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x4f5b78 instanceof Error?_0x4f5b78[_0x57c156(0x10f)]:_0x57c156(0xdf)));}}async[a53_0x3435f5(0xdc)](_0x29c581){const _0xc5e225=a53_0x3435f5;console[_0xc5e225(0x12d)]('Processing\x20Noda\x20webhook:',_0x29c581);let _0x499a2b=_0xc5e225(0xfa);switch(_0x29c581['Status']?.['toLowerCase']()){case'done':case _0xc5e225(0x11a):case _0xc5e225(0xed):case _0xc5e225(0xef):case _0xc5e225(0x104):_0x29c581[_0xc5e225(0xf8)]==='Yes'?_0x499a2b='PAID':_0x499a2b=_0xc5e225(0xfa);break;case'cancelled':case _0xc5e225(0x10b):case _0xc5e225(0xff):case _0xc5e225(0x114):case _0xc5e225(0xde):_0x499a2b=_0xc5e225(0xe5);break;case _0xc5e225(0xf6):case'timeout':_0x499a2b=_0xc5e225(0x108);break;case'pending':case _0xc5e225(0xd7):case _0xc5e225(0x103):case _0xc5e225(0x113):case _0xc5e225(0xca):default:_0x499a2b=_0xc5e225(0xfa);break;}return{'paymentId':_0x29c581['MerchantPaymentId']||_0x29c581['PaymentId'],'status':_0x499a2b,'amount':_0x29c581['Amount'],'currency':_0x29c581['Currency'],'additionalInfo':{'method':_0x29c581[_0xc5e225(0xf7)],'bankId':_0x29c581[_0xc5e225(0xd6)],'settled':_0x29c581[_0xc5e225(0xf8)],'settlementDate':_0x29c581[_0xc5e225(0x11e)],'remitterName':_0x29c581[_0xc5e225(0x11b)]?.[_0xc5e225(0xfe)],'remitterIban':_0x29c581[_0xc5e225(0x11b)]?.[_0xc5e225(0xc9)],'bankTransactionId':_0x29c581[_0xc5e225(0xc8)]}};}[a53_0x3435f5(0xe0)](_0x5b8e9a,_0x2b8c89){const _0xc58c7a=a53_0x3435f5;return console[_0xc58c7a(0x12d)](_0xc58c7a(0x12e),{'receivedSignature':_0x2b8c89,'paymentId':_0x5b8e9a[_0xc58c7a(0x111)],'merchantPaymentId':_0x5b8e9a['MerchantPaymentId']}),!![];}}exports[a53_0x3435f5(0xce)]=NodaService;