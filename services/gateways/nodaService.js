'use strict';const a43_0x34c667=a43_0x5cc7;(function(_0x15288e,_0x484b69){const _0x10b48b=a43_0x5cc7,_0x31f11a=_0x15288e();while(!![]){try{const _0x33d17a=-parseInt(_0x10b48b(0x98))/0x1*(parseInt(_0x10b48b(0x9b))/0x2)+parseInt(_0x10b48b(0xe9))/0x3*(parseInt(_0x10b48b(0xcd))/0x4)+-parseInt(_0x10b48b(0xe4))/0x5+-parseInt(_0x10b48b(0xb2))/0x6+parseInt(_0x10b48b(0xc8))/0x7+parseInt(_0x10b48b(0xf1))/0x8*(-parseInt(_0x10b48b(0xaa))/0x9)+parseInt(_0x10b48b(0x94))/0xa;if(_0x33d17a===_0x484b69)break;else _0x31f11a['push'](_0x31f11a['shift']());}catch(_0x572e0a){_0x31f11a['push'](_0x31f11a['shift']());}}}(a43_0x5a3c,0xd4284));function a43_0x5a3c(){const _0x547bb5=['done','https://tesoft.uk/gateway/noda/','GET','===\x20NODA\x20SERVICE\x20ERROR\x20===','expiryDate','toUpperCase','5949264ihYnmQ','BankTransactionId','HTTP\x20Status:','application/json','Error\x20stack:','verifyPayment','/payment-links/','Missing\x20id\x20or\x20shortLink\x20in\x20response','Headers:','/payment-links','../loggerService','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','headers','Raw\x20Response\x20Body:','Response\x20data:','active','created','Error\x20details:','timeout','Unknown\x20error','loggerService','https://tesoft.uk/gateway/pending.php?id=','https://tesoft.uk/gateway/noda/webhook/','Short\x20Link:','BankId','message','isActive','stringify','logWhiteDomainError','Parsed\x20Result:','31327490XXCDcG','apiUrl','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','NodaService','4066luwtxO','Yes','Failed\x20to\x20verify\x20Noda\x20payment:\x20','334YxJexI','PaymentId','log','Remitter','Order\x20ID\x20Used:','defineProperty','pending','TesSoft\x20Payment\x20System/1.0','createPaymentLink','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Noda\x20API\x20error:\x20','Error\x20Message:','Settled','Error\x20message:','FAILED','9WGVdmo','Name','Response\x20Time:','Iban','===\x20NODA\x20SUCCESS\x20===','Noda\x20payment\x20verification\x20error:','Noda\x20webhook\x20signature\x20verification:','PENDING','2742432cmwEHu','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','logWhiteDomainRequest','URL:','===\x20NODA\x20API\x20ERROR\x20===','amount','entries','verifyWebhookSignature','processWebhook','failed','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Status','JSON\x20Parse\x20Error:\x20','SettlementDate','Status\x20Text:','stack','successful','now','paid','cancelled','status','5460343oiVKcI','text','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Unknown\x20error\x20from\x20Noda\x20API','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','1525872XZDWJz','Payment\x20Link\x20ID:','qrCodeLink','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','error','json','in_progress','shortLink','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','shortLinkUrls','MerchantPaymentId','noda','__esModule','completed','logWhiteDomainResponse','POST','(8digits-8digits\x20format)','Processing\x20Noda\x20webhook:',',\x20body:\x20','toLowerCase','QR\x20Code\x20Link:','Request\x20Body\x20(Direct\x20JSON):','statusCode','7727590ooJyJB','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Response\x20Body:','HTTP\x20error!\x20status:\x20','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','3DtyUhu','parse'];a43_0x5a3c=function(){return _0x547bb5;};return a43_0x5a3c();}Object[a43_0x34c667(0xa0)](exports,a43_0x34c667(0xd9),{'value':!![]}),exports[a43_0x34c667(0x97)]=void 0x0;function a43_0x5cc7(_0x5a21bc,_0x4c11c0){const _0x5a3cd6=a43_0x5a3c();return a43_0x5cc7=function(_0x5cc776,_0x1b43cf){_0x5cc776=_0x5cc776-0x86;let _0x53e3c0=_0x5a3cd6[_0x5cc776];return _0x53e3c0;},a43_0x5cc7(_0x5a21bc,_0x4c11c0);}const loggerService_1=require(a43_0x34c667(0xfb));class NodaService{constructor(){const _0x4fc8c7=a43_0x34c667;this[_0x4fc8c7(0x95)]=_0x4fc8c7(0xec),console[_0x4fc8c7(0x9d)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a43_0x34c667(0xa3)](_0x4d7e94){const _0xe48f7b=a43_0x34c667,{orderId:_0xcaa551,name:_0x44ee44,paymentDescription:_0x351505,amount:_0x2789d0,currency:_0x1ae9a9,webhookUrl:_0x19ad78,returnUrl:_0x5a7887,expiryDate:_0x1a89d7}=_0x4d7e94,_0x357cc1=_0x1ae9a9[_0xe48f7b(0xf0)](),_0x555ec4=_0xe48f7b(0x8c),_0x247ed3=_0xe48f7b(0x8b)+_0xcaa551,_0x1010a7={'name':_0x44ee44,'paymentDescription':_0x351505,'amount':_0x2789d0,'currency':_0x357cc1,'paymentId':_0xcaa551,'webhookUrl':_0x555ec4,'returnUrl':_0x247ed3};_0x1a89d7&&(_0x1010a7[_0xe48f7b(0xef)]=_0x1a89d7);const _0x3b3370=Date[_0xe48f7b(0xc4)]();try{console[_0xe48f7b(0x9d)](_0xe48f7b(0xbd)),console[_0xe48f7b(0x9d)](_0xe48f7b(0xb6),this[_0xe48f7b(0x95)]),console[_0xe48f7b(0x9d)](_0xe48f7b(0xe2),JSON[_0xe48f7b(0x91)](_0x1010a7,null,0x2)),console[_0xe48f7b(0x9d)]('Order\x20ID\x20Format:',_0xcaa551,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0xe48f7b(0x9d)](_0xe48f7b(0xa4),_0x247ed3),loggerService_1[_0xe48f7b(0x8a)][_0xe48f7b(0xb5)](_0xe48f7b(0xd8),_0xe48f7b(0xfa),_0xe48f7b(0xdc),_0x1010a7);const _0x46a03a=await fetch(this[_0xe48f7b(0x95)],{'method':_0xe48f7b(0xdc),'headers':{'Content-Type':_0xe48f7b(0xf4),'Accept':'application/json','User-Agent':_0xe48f7b(0xa2)},'body':JSON[_0xe48f7b(0x91)](_0x1010a7)}),_0x3d85af=Date['now']()-_0x3b3370;console['log'](_0xe48f7b(0xd5)),console[_0xe48f7b(0x9d)]('Status:',_0x46a03a[_0xe48f7b(0xc7)]),console[_0xe48f7b(0x9d)](_0xe48f7b(0xc1),_0x46a03a['statusText']),console[_0xe48f7b(0x9d)](_0xe48f7b(0xf9),Object['fromEntries'](_0x46a03a[_0xe48f7b(0xfd)][_0xe48f7b(0xb9)]())),console[_0xe48f7b(0x9d)](_0xe48f7b(0xac),_0x3d85af+'ms');const _0x569857=await _0x46a03a[_0xe48f7b(0xc9)]();console[_0xe48f7b(0x9d)](_0xe48f7b(0xfe),_0x569857);if(!_0x46a03a['ok']){console['error'](_0xe48f7b(0xb7)),console[_0xe48f7b(0xd1)](_0xe48f7b(0xf3),_0x46a03a['status']),console['error'](_0xe48f7b(0xe6),_0x569857),loggerService_1[_0xe48f7b(0x8a)]['logWhiteDomainResponse'](_0xe48f7b(0xd8),_0xe48f7b(0xfa),_0x46a03a[_0xe48f7b(0xc7)],_0x569857,_0x3d85af),loggerService_1[_0xe48f7b(0x8a)][_0xe48f7b(0x92)](_0xe48f7b(0xd8),_0xe48f7b(0xfa),'HTTP\x20'+_0x46a03a[_0xe48f7b(0xc7)]+':\x20'+_0x569857);if(_0x46a03a[_0xe48f7b(0xc7)]===0x190)throw new Error(_0xe48f7b(0xfc));else{if(_0x46a03a[_0xe48f7b(0xc7)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0xe48f7b(0xe7)+_0x46a03a['status']+_0xe48f7b(0xdf)+_0x569857);}let _0x2466f9;try{_0x2466f9=JSON[_0xe48f7b(0xea)](_0x569857);}catch(_0x15a170){console['error'](_0xe48f7b(0xb3),_0x15a170),loggerService_1[_0xe48f7b(0x8a)][_0xe48f7b(0x92)](_0xe48f7b(0xd8),_0xe48f7b(0xfa),_0xe48f7b(0xbf)+_0x15a170);throw new Error(_0xe48f7b(0xca)+_0x569857);}console[_0xe48f7b(0x9d)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0xe48f7b(0x9d)](_0xe48f7b(0x93),JSON[_0xe48f7b(0x91)](_0x2466f9,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0xe48f7b(0xd8),'/payment-links',_0x46a03a[_0xe48f7b(0xc7)],_0x2466f9,_0x3d85af);if(_0x2466f9[_0xe48f7b(0xd1)]||_0x2466f9[_0xe48f7b(0xe3)]){const _0x452224=_0x2466f9[_0xe48f7b(0x8f)]||_0x2466f9[_0xe48f7b(0xd1)]||_0xe48f7b(0xcb);console[_0xe48f7b(0xd1)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0xe48f7b(0xa6),_0x452224),console[_0xe48f7b(0xd1)]('Status\x20Code:',_0x2466f9[_0xe48f7b(0xe3)]),loggerService_1[_0xe48f7b(0x8a)][_0xe48f7b(0x92)](_0xe48f7b(0xd8),_0xe48f7b(0xfa),'Business\x20Error:\x20'+_0x452224);throw new Error(_0xe48f7b(0xa5)+_0x452224);}if(!_0x2466f9['id']||!_0x2466f9[_0xe48f7b(0xd6)]?.['shortLink']){console[_0xe48f7b(0xd1)](_0xe48f7b(0x96)),console[_0xe48f7b(0xd1)](_0xe48f7b(0xf8)),console['error'](_0xe48f7b(0xff),_0x2466f9),loggerService_1[_0xe48f7b(0x8a)][_0xe48f7b(0x92)](_0xe48f7b(0xd8),_0xe48f7b(0xfa),_0xe48f7b(0xd0));throw new Error(_0xe48f7b(0xe5));}return console[_0xe48f7b(0x9d)](_0xe48f7b(0xae)),console[_0xe48f7b(0x9d)](_0xe48f7b(0xce),_0x2466f9['id']),console[_0xe48f7b(0x9d)](_0xe48f7b(0x8d),_0x2466f9[_0xe48f7b(0xd6)][_0xe48f7b(0xd4)]),console[_0xe48f7b(0x9d)](_0xe48f7b(0xe1),_0x2466f9['shortLinkUrls']['qrCodeLink']||'Not\x20provided'),console['log'](_0xe48f7b(0x9f),_0xcaa551,_0xe48f7b(0xdd)),console[_0xe48f7b(0x9d)](_0xe48f7b(0xe8),_0x247ed3),{'gateway_payment_id':_0x2466f9['id'],'payment_url':_0x2466f9['shortLinkUrls'][_0xe48f7b(0xd4)],'qr_code_url':_0x2466f9['shortLinkUrls'][_0xe48f7b(0xcf)],'expiry_date':_0x2466f9['expiryDate']};}catch(_0x3fc5b4){console[_0xe48f7b(0xd1)](_0xe48f7b(0xee)),console[_0xe48f7b(0xd1)](_0xe48f7b(0x87),_0x3fc5b4),loggerService_1[_0xe48f7b(0x8a)]['logWhiteDomainError'](_0xe48f7b(0xd8),'/payment-links',_0x3fc5b4);if(_0x3fc5b4 instanceof Error){console[_0xe48f7b(0xd1)](_0xe48f7b(0xa8),_0x3fc5b4[_0xe48f7b(0x8f)]),console['error'](_0xe48f7b(0xf5),_0x3fc5b4[_0xe48f7b(0xc2)]);throw new Error(_0xe48f7b(0xcc)+_0x3fc5b4['message']);}throw new Error(_0xe48f7b(0xb4));}}async[a43_0x34c667(0xf6)](_0x4e7baf){const _0x5a11c9=a43_0x34c667,_0x136977=Date[_0x5a11c9(0xc4)]();try{loggerService_1[_0x5a11c9(0x8a)][_0x5a11c9(0xb5)](_0x5a11c9(0xd8),_0x5a11c9(0xf7)+_0x4e7baf,_0x5a11c9(0xed),{});const _0x338d79=await fetch(this[_0x5a11c9(0x95)]+'/'+_0x4e7baf,{'method':'GET','headers':{'Content-Type':_0x5a11c9(0xf4),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x274ad6=Date[_0x5a11c9(0xc4)]()-_0x136977;if(!_0x338d79['ok']){const _0x265475=await _0x338d79[_0x5a11c9(0xc9)]();loggerService_1['loggerService'][_0x5a11c9(0xdb)]('noda',_0x5a11c9(0xf7)+_0x4e7baf,_0x338d79['status'],_0x265475,_0x274ad6);throw new Error(_0x5a11c9(0xe7)+_0x338d79[_0x5a11c9(0xc7)]);}const _0x9c42da=await _0x338d79[_0x5a11c9(0xd2)]();loggerService_1['loggerService'][_0x5a11c9(0xdb)](_0x5a11c9(0xd8),_0x5a11c9(0xf7)+_0x4e7baf,_0x338d79[_0x5a11c9(0xc7)],_0x9c42da,_0x274ad6);if(_0x9c42da[_0x5a11c9(0xd1)]||_0x9c42da[_0x5a11c9(0xe3)]){loggerService_1['loggerService'][_0x5a11c9(0x92)]('noda',_0x5a11c9(0xf7)+_0x4e7baf,_0x5a11c9(0xa5)+(_0x9c42da[_0x5a11c9(0x8f)]||_0x9c42da[_0x5a11c9(0xd1)]||_0x5a11c9(0x89)));throw new Error(_0x5a11c9(0xa5)+(_0x9c42da[_0x5a11c9(0x8f)]||_0x9c42da[_0x5a11c9(0xd1)]||_0x5a11c9(0x89)));}let _0x11aa29=_0x5a11c9(0xb1);if(_0x9c42da['isActive']===![]){if(_0x9c42da[_0x5a11c9(0xef)]){const _0x466f7b=new Date(_0x9c42da[_0x5a11c9(0xef)]),_0x27fff9=new Date();_0x466f7b<_0x27fff9?_0x11aa29='EXPIRED':_0x11aa29=_0x5a11c9(0xa9);}else _0x11aa29=_0x5a11c9(0xa9);}else _0x11aa29='PENDING';return{'status':_0x11aa29,'amount':_0x9c42da[_0x5a11c9(0xb8)],'currency':_0x9c42da['currency'],'isActive':_0x9c42da[_0x5a11c9(0x90)]};}catch(_0x64e0f0){console['error'](_0x5a11c9(0xaf),_0x64e0f0),loggerService_1[_0x5a11c9(0x8a)][_0x5a11c9(0x92)]('noda',_0x5a11c9(0xf7)+_0x4e7baf,_0x64e0f0);throw new Error(_0x5a11c9(0x9a)+(_0x64e0f0 instanceof Error?_0x64e0f0[_0x5a11c9(0x8f)]:_0x5a11c9(0x89)));}}async[a43_0x34c667(0xbb)](_0x36acd2){const _0x1a4be3=a43_0x34c667;console['log'](_0x1a4be3(0xde),_0x36acd2);let _0x3b2083=_0x1a4be3(0xb1);switch(_0x36acd2[_0x1a4be3(0xbe)]?.[_0x1a4be3(0xe0)]()){case _0x1a4be3(0xeb):case _0x1a4be3(0xda):case _0x1a4be3(0xc5):case'success':case _0x1a4be3(0xc3):_0x36acd2['Settled']===_0x1a4be3(0x99)?_0x3b2083='PAID':_0x3b2083=_0x1a4be3(0xb1);break;case _0x1a4be3(0xc6):case'canceled':case _0x1a4be3(0xbc):case'error':case'rejected':_0x3b2083='FAILED';break;case'expired':case _0x1a4be3(0x88):_0x3b2083='EXPIRED';break;case _0x1a4be3(0xa1):case _0x1a4be3(0x86):case _0x1a4be3(0x100):case'processing':case _0x1a4be3(0xd3):default:_0x3b2083=_0x1a4be3(0xb1);break;}return{'paymentId':_0x36acd2[_0x1a4be3(0xd7)]||_0x36acd2['PaymentId'],'status':_0x3b2083,'amount':_0x36acd2['Amount'],'currency':_0x36acd2['Currency'],'additionalInfo':{'method':_0x36acd2['Method'],'bankId':_0x36acd2[_0x1a4be3(0x8e)],'settled':_0x36acd2[_0x1a4be3(0xa7)],'settlementDate':_0x36acd2[_0x1a4be3(0xc0)],'remitterName':_0x36acd2[_0x1a4be3(0x9e)]?.[_0x1a4be3(0xab)],'remitterIban':_0x36acd2[_0x1a4be3(0x9e)]?.[_0x1a4be3(0xad)],'bankTransactionId':_0x36acd2[_0x1a4be3(0xf2)]}};}[a43_0x34c667(0xba)](_0x4b7834,_0x4f8696){const _0x4fa657=a43_0x34c667;return console[_0x4fa657(0x9d)](_0x4fa657(0xb0),{'receivedSignature':_0x4f8696,'paymentId':_0x4b7834[_0x4fa657(0x9c)],'merchantPaymentId':_0x4b7834[_0x4fa657(0xd7)]}),!![];}}exports[a43_0x34c667(0x97)]=NodaService;