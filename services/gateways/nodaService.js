'use strict';const a48_0x10602e=a48_0x27ef;function a48_0x27ef(_0x506f2f,_0x4c25e8){const _0x26ee4d=a48_0x26ee();return a48_0x27ef=function(_0x27efa6,_0x813a84){_0x27efa6=_0x27efa6-0x19b;let _0x3815d6=_0x26ee4d[_0x27efa6];return _0x3815d6;},a48_0x27ef(_0x506f2f,_0x4c25e8);}(function(_0x549e02,_0x4f529f){const _0x1605a2=a48_0x27ef,_0xe1811b=_0x549e02();while(!![]){try{const _0x1d1bce=-parseInt(_0x1605a2(0x19d))/0x1+parseInt(_0x1605a2(0x1bf))/0x2*(parseInt(_0x1605a2(0x1cd))/0x3)+parseInt(_0x1605a2(0x1a0))/0x4+-parseInt(_0x1605a2(0x1d2))/0x5+-parseInt(_0x1605a2(0x1ce))/0x6+-parseInt(_0x1605a2(0x1b9))/0x7+parseInt(_0x1605a2(0x1d5))/0x8*(parseInt(_0x1605a2(0x20c))/0x9);if(_0x1d1bce===_0x4f529f)break;else _0xe1811b['push'](_0xe1811b['shift']());}catch(_0x2dc617){_0xe1811b['push'](_0xe1811b['shift']());}}}(a48_0x26ee,0xce36d));Object[a48_0x10602e(0x1c1)](exports,'__esModule',{'value':!![]}),exports[a48_0x10602e(0x1ea)]=void 0x0;const loggerService_1=require(a48_0x10602e(0x204));function a48_0x26ee(){const _0x55780d=['EXPIRED','Short\x20Link:','Order\x20ID\x20Format:','1137UwUjWY','8328648NXfdvK','https://tesoft.uk/gateway/pending.php?id=','isActive','QR\x20Code\x20Link:','7413400EWeUSj','toLowerCase','pending','451928VJUkeR','===\x20NODA\x20SUCCESS\x20===','logWhiteDomainRequest','Status','Remitter','status','Currency','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','error','paid','Settled','logWhiteDomainError','Noda\x20webhook\x20signature\x20verification:','stringify','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','shortLink','amount','NodaService','application/json','failed','now','noda','verifyWebhookSignature','Business\x20Error:\x20','Status\x20Text:','entries','successful','message','stack','Status\x20Code:','Error\x20stack:','PaymentId','active','apiUrl','POST','in_progress','text','loggerService','GET','currency','Headers:','Missing\x20id\x20or\x20shortLink\x20in\x20response','PENDING','../loggerService','===\x20NODA\x20API\x20ERROR\x20===','Noda\x20payment\x20verification\x20error:','Name','Error\x20message:','Error\x20Message:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','success','603mzYgnc','createPaymentLink','PAID','Unknown\x20error\x20from\x20Noda\x20API','Raw\x20Response\x20Body:','===\x20NODA\x20SERVICE\x20ERROR\x20===','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','canceled','1678680KhsEdK','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','done','5614968qFFYdZ','URL:',',\x20body:\x20','/payment-links/','TesSoft\x20Payment\x20System/1.0','SettlementDate','fromEntries','completed','BankId','https://tesoft.uk/gateway/noda/webhook/','log','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','BankTransactionId','toUpperCase','expired','Amount','shortLinkUrls','JSON\x20Parse\x20Error:\x20','statusText','FAILED','Response\x20data:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','verifyPayment','headers','Not\x20provided','1246462qulEev','HTTP\x20error!\x20status:\x20','created','/payment-links','Response\x20Body:','(8digits-8digits\x20format)','2024tLfMcH','Noda\x20API\x20error:\x20','defineProperty','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Order\x20ID\x20Used:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','qrCodeLink','expiryDate','statusCode','logWhiteDomainResponse','https://tesoft.uk/gateway/noda/'];a48_0x26ee=function(){return _0x55780d;};return a48_0x26ee();}class NodaService{constructor(){const _0x16935d=a48_0x10602e;this['apiUrl']=_0x16935d(0x1c9),console[_0x16935d(0x1aa)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a48_0x10602e(0x20d)](_0x29cf97){const _0x387313=a48_0x10602e,{orderId:_0x4a3e27,name:_0x59a954,paymentDescription:_0x871ab8,amount:_0x3e430a,currency:_0x1a4c1a,webhookUrl:_0xcc58a2,returnUrl:_0x23872e,expiryDate:_0x3ccf80}=_0x29cf97,_0x42eec5=_0x1a4c1a[_0x387313(0x1ad)](),_0x30e45d=_0x387313(0x1a9),_0x41283d=_0x387313(0x1cf)+_0x4a3e27,_0x46a6fd={'name':_0x59a954,'paymentDescription':_0x871ab8,'amount':_0x3e430a,'currency':_0x42eec5,'paymentId':_0x4a3e27,'webhookUrl':_0x30e45d,'returnUrl':_0x41283d};_0x3ccf80&&(_0x46a6fd['expiryDate']=_0x3ccf80);const _0x2cedfb=Date[_0x387313(0x1ed)]();try{console['log'](_0x387313(0x1c2)),console[_0x387313(0x1aa)](_0x387313(0x1a1),this['apiUrl']),console[_0x387313(0x1aa)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x387313(0x1e6)](_0x46a6fd,null,0x2)),console[_0x387313(0x1aa)](_0x387313(0x1cc),_0x4a3e27,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x387313(0x1aa)](_0x387313(0x1b5),_0x41283d),loggerService_1[_0x387313(0x1fe)]['logWhiteDomainRequest'](_0x387313(0x1ee),_0x387313(0x1bc),_0x387313(0x1fb),_0x46a6fd);const _0x5a9d4a=await fetch(this[_0x387313(0x1fa)],{'method':_0x387313(0x1fb),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x387313(0x1a4)},'body':JSON[_0x387313(0x1e6)](_0x46a6fd)}),_0x25c520=Date[_0x387313(0x1ed)]()-_0x2cedfb;console[_0x387313(0x1aa)](_0x387313(0x19b)),console[_0x387313(0x1aa)]('Status:',_0x5a9d4a[_0x387313(0x1da)]),console['log'](_0x387313(0x1f1),_0x5a9d4a[_0x387313(0x1b2)]),console[_0x387313(0x1aa)](_0x387313(0x201),Object[_0x387313(0x1a6)](_0x5a9d4a[_0x387313(0x1b7)][_0x387313(0x1f2)]())),console[_0x387313(0x1aa)]('Response\x20Time:',_0x25c520+'ms');const _0x1535c2=await _0x5a9d4a['text']();console['log'](_0x387313(0x210),_0x1535c2);if(!_0x5a9d4a['ok']){console['error'](_0x387313(0x205)),console['error']('HTTP\x20Status:',_0x5a9d4a[_0x387313(0x1da)]),console[_0x387313(0x1e1)](_0x387313(0x1bd),_0x1535c2),loggerService_1[_0x387313(0x1fe)][_0x387313(0x1c8)]('noda',_0x387313(0x1bc),_0x5a9d4a[_0x387313(0x1da)],_0x1535c2,_0x25c520),loggerService_1['loggerService'][_0x387313(0x1e4)](_0x387313(0x1ee),_0x387313(0x1bc),'HTTP\x20'+_0x5a9d4a[_0x387313(0x1da)]+':\x20'+_0x1535c2);if(_0x5a9d4a['status']===0x190)throw new Error(_0x387313(0x20a));else{if(_0x5a9d4a[_0x387313(0x1da)]===0x1f4)throw new Error(_0x387313(0x1ab));}throw new Error(_0x387313(0x1ba)+_0x5a9d4a[_0x387313(0x1da)]+_0x387313(0x1a2)+_0x1535c2);}let _0x1422b5;try{_0x1422b5=JSON['parse'](_0x1535c2);}catch(_0x43b555){console[_0x387313(0x1e1)](_0x387313(0x1df),_0x43b555),loggerService_1[_0x387313(0x1fe)][_0x387313(0x1e4)](_0x387313(0x1ee),_0x387313(0x1bc),_0x387313(0x1b1)+_0x43b555);throw new Error(_0x387313(0x19e)+_0x1535c2);}console['log'](_0x387313(0x1de)),console[_0x387313(0x1aa)]('Parsed\x20Result:',JSON[_0x387313(0x1e6)](_0x1422b5,null,0x2)),loggerService_1[_0x387313(0x1fe)]['logWhiteDomainResponse']('noda','/payment-links',_0x5a9d4a[_0x387313(0x1da)],_0x1422b5,_0x25c520);if(_0x1422b5['error']||_0x1422b5[_0x387313(0x1c7)]){const _0x159b3c=_0x1422b5[_0x387313(0x1f4)]||_0x1422b5['error']||_0x387313(0x20f);console[_0x387313(0x1e1)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x387313(0x209),_0x159b3c),console[_0x387313(0x1e1)](_0x387313(0x1f6),_0x1422b5[_0x387313(0x1c7)]),loggerService_1[_0x387313(0x1fe)][_0x387313(0x1e4)](_0x387313(0x1ee),'/payment-links',_0x387313(0x1f0)+_0x159b3c);throw new Error(_0x387313(0x1c0)+_0x159b3c);}if(!_0x1422b5['id']||!_0x1422b5[_0x387313(0x1b0)]?.[_0x387313(0x1e8)]){console[_0x387313(0x1e1)](_0x387313(0x1dc)),console[_0x387313(0x1e1)](_0x387313(0x202)),console[_0x387313(0x1e1)](_0x387313(0x1b4),_0x1422b5),loggerService_1[_0x387313(0x1fe)][_0x387313(0x1e4)](_0x387313(0x1ee),_0x387313(0x1bc),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x387313(0x1aa)](_0x387313(0x1d6)),console[_0x387313(0x1aa)]('Payment\x20Link\x20ID:',_0x1422b5['id']),console[_0x387313(0x1aa)](_0x387313(0x1cb),_0x1422b5[_0x387313(0x1b0)][_0x387313(0x1e8)]),console[_0x387313(0x1aa)](_0x387313(0x1d1),_0x1422b5[_0x387313(0x1b0)][_0x387313(0x1c5)]||_0x387313(0x1b8)),console[_0x387313(0x1aa)](_0x387313(0x1c3),_0x4a3e27,_0x387313(0x1be)),console['log'](_0x387313(0x1e7),_0x41283d),{'gateway_payment_id':_0x1422b5['id'],'payment_url':_0x1422b5[_0x387313(0x1b0)][_0x387313(0x1e8)],'qr_code_url':_0x1422b5['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x1422b5[_0x387313(0x1c6)]};}catch(_0x239677){console['error'](_0x387313(0x211)),console[_0x387313(0x1e1)]('Error\x20details:',_0x239677),loggerService_1[_0x387313(0x1fe)][_0x387313(0x1e4)](_0x387313(0x1ee),'/payment-links',_0x239677);if(_0x239677 instanceof Error){console[_0x387313(0x1e1)](_0x387313(0x208),_0x239677[_0x387313(0x1f4)]),console['error'](_0x387313(0x1f7),_0x239677[_0x387313(0x1f5)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x239677[_0x387313(0x1f4)]);}throw new Error(_0x387313(0x1c4));}}async[a48_0x10602e(0x1b6)](_0x2c67ef){const _0x360b97=a48_0x10602e,_0x52ab58=Date['now']();try{loggerService_1[_0x360b97(0x1fe)][_0x360b97(0x1d7)](_0x360b97(0x1ee),_0x360b97(0x1a3)+_0x2c67ef,'GET',{});const _0x4ab60c=await fetch(this[_0x360b97(0x1fa)]+'/'+_0x2c67ef,{'method':_0x360b97(0x1ff),'headers':{'Content-Type':_0x360b97(0x1eb),'User-Agent':_0x360b97(0x1a4)}}),_0x16afdc=Date['now']()-_0x52ab58;if(!_0x4ab60c['ok']){const _0x426ea9=await _0x4ab60c[_0x360b97(0x1fd)]();loggerService_1[_0x360b97(0x1fe)][_0x360b97(0x1c8)]('noda','/payment-links/'+_0x2c67ef,_0x4ab60c['status'],_0x426ea9,_0x16afdc);throw new Error(_0x360b97(0x1ba)+_0x4ab60c[_0x360b97(0x1da)]);}const _0x427172=await _0x4ab60c['json']();loggerService_1[_0x360b97(0x1fe)][_0x360b97(0x1c8)](_0x360b97(0x1ee),'/payment-links/'+_0x2c67ef,_0x4ab60c[_0x360b97(0x1da)],_0x427172,_0x16afdc);if(_0x427172['error']||_0x427172[_0x360b97(0x1c7)]){loggerService_1[_0x360b97(0x1fe)][_0x360b97(0x1e4)]('noda',_0x360b97(0x1a3)+_0x2c67ef,_0x360b97(0x1c0)+(_0x427172[_0x360b97(0x1f4)]||_0x427172[_0x360b97(0x1e1)]||'Unknown\x20error'));throw new Error(_0x360b97(0x1c0)+(_0x427172[_0x360b97(0x1f4)]||_0x427172[_0x360b97(0x1e1)]||_0x360b97(0x1dd)));}let _0x5a9a21=_0x360b97(0x203);if(_0x427172[_0x360b97(0x1d0)]===![]){if(_0x427172[_0x360b97(0x1c6)]){const _0x4e65c0=new Date(_0x427172['expiryDate']),_0x1ba516=new Date();_0x4e65c0<_0x1ba516?_0x5a9a21=_0x360b97(0x1ca):_0x5a9a21=_0x360b97(0x1b3);}else _0x5a9a21=_0x360b97(0x1b3);}else _0x5a9a21=_0x360b97(0x203);return{'status':_0x5a9a21,'amount':_0x427172[_0x360b97(0x1e9)],'currency':_0x427172[_0x360b97(0x200)],'isActive':_0x427172['isActive']};}catch(_0x35fe7f){console['error'](_0x360b97(0x206),_0x35fe7f),loggerService_1[_0x360b97(0x1fe)][_0x360b97(0x1e4)](_0x360b97(0x1ee),_0x360b97(0x1a3)+_0x2c67ef,_0x35fe7f);throw new Error(_0x360b97(0x1e0)+(_0x35fe7f instanceof Error?_0x35fe7f['message']:_0x360b97(0x1dd)));}}async['processWebhook'](_0x10147b){const _0xe03b08=a48_0x10602e;console[_0xe03b08(0x1aa)]('Processing\x20Noda\x20webhook:',_0x10147b);let _0x17a4b1=_0xe03b08(0x203);switch(_0x10147b[_0xe03b08(0x1d8)]?.[_0xe03b08(0x1d3)]()){case _0xe03b08(0x19f):case _0xe03b08(0x1a7):case _0xe03b08(0x1e2):case _0xe03b08(0x20b):case _0xe03b08(0x1f3):_0x10147b[_0xe03b08(0x1e3)]==='Yes'?_0x17a4b1=_0xe03b08(0x20e):_0x17a4b1=_0xe03b08(0x203);break;case'cancelled':case _0xe03b08(0x19c):case _0xe03b08(0x1ec):case'error':case'rejected':_0x17a4b1=_0xe03b08(0x1b3);break;case _0xe03b08(0x1ae):case'timeout':_0x17a4b1=_0xe03b08(0x1ca);break;case _0xe03b08(0x1d4):case _0xe03b08(0x1bb):case _0xe03b08(0x1f9):case'processing':case _0xe03b08(0x1fc):default:_0x17a4b1=_0xe03b08(0x203);break;}return{'paymentId':_0x10147b['MerchantPaymentId']||_0x10147b[_0xe03b08(0x1f8)],'status':_0x17a4b1,'amount':_0x10147b[_0xe03b08(0x1af)],'currency':_0x10147b[_0xe03b08(0x1db)],'additionalInfo':{'method':_0x10147b['Method'],'bankId':_0x10147b[_0xe03b08(0x1a8)],'settled':_0x10147b[_0xe03b08(0x1e3)],'settlementDate':_0x10147b[_0xe03b08(0x1a5)],'remitterName':_0x10147b[_0xe03b08(0x1d9)]?.[_0xe03b08(0x207)],'remitterIban':_0x10147b['Remitter']?.['Iban'],'bankTransactionId':_0x10147b[_0xe03b08(0x1ac)]}};}[a48_0x10602e(0x1ef)](_0x54f6bb,_0x19e99b){const _0x448f5b=a48_0x10602e;return console[_0x448f5b(0x1aa)](_0x448f5b(0x1e5),{'receivedSignature':_0x19e99b,'paymentId':_0x54f6bb[_0x448f5b(0x1f8)],'merchantPaymentId':_0x54f6bb['MerchantPaymentId']}),!![];}}exports[a48_0x10602e(0x1ea)]=NodaService;