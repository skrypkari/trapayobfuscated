'use strict';const a67_0x5a7773=a67_0x59db;(function(_0x3ff0b8,_0x19b953){const _0x4de336=a67_0x59db,_0x45390f=_0x3ff0b8();while(!![]){try{const _0x321ea2=-parseInt(_0x4de336(0x6d))/0x1+parseInt(_0x4de336(0xd1))/0x2+-parseInt(_0x4de336(0x79))/0x3*(-parseInt(_0x4de336(0xe2))/0x4)+parseInt(_0x4de336(0xc4))/0x5*(parseInt(_0x4de336(0xc0))/0x6)+-parseInt(_0x4de336(0x7b))/0x7*(-parseInt(_0x4de336(0x78))/0x8)+-parseInt(_0x4de336(0xa2))/0x9*(-parseInt(_0x4de336(0x8b))/0xa)+-parseInt(_0x4de336(0x75))/0xb;if(_0x321ea2===_0x19b953)break;else _0x45390f['push'](_0x45390f['shift']());}catch(_0xfb83ff){_0x45390f['push'](_0x45390f['shift']());}}}(a67_0x1cb3,0x7eef5));function a67_0x1cb3(){const _0x821f24=['shortLinkUrls','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','GET','apiUrl','message','cancelled','log','Response\x20Body:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Status\x20Code:','SettlementDate','headers','Status','Headers:','60024IScaLw','toUpperCase','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','https://tesoft.uk/gateway/noda/','490dQiepG','in_progress','Parsed\x20Result:','logWhiteDomainResponse','===\x20NODA\x20SERVICE\x20ERROR\x20===','===\x20NODA\x20SUCCESS\x20===','https://tesoft.uk/gateway/noda/webhook/','failed','Noda\x20payment\x20verification\x20error:','Missing\x20id\x20or\x20shortLink\x20in\x20response','Processing\x20Noda\x20webhook:','defineProperty','stringify','489800JNzXMq','processing','FAILED','Name','Error\x20Message:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','error','Unknown\x20error\x20from\x20Noda\x20API','currency','Error\x20message:','text','Not\x20provided','HTTP\x20error!\x20status:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20ERROR\x20===','status','now','1837292zhLmqM','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','active','157511WOZHCM','verifyPayment','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Status:','URL:','Status\x20Text:','/payment-links/','24040203TpjgOQ','json','/payment-links','776EeOcKw','3tuUmQM','PAID','48965bMYrHv','BankId','Payment\x20Link\x20ID:','expiryDate','verifyWebhookSignature','PENDING','PaymentId','Order\x20ID\x20Used:','HTTP\x20Status:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','noda','JSON\x20Parse\x20Error:\x20','created','Noda\x20webhook\x20signature\x20verification:','POST','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','79330SqgWnq','BankTransactionId','statusText','Noda\x20API\x20error:\x20','statusCode','Business\x20Error:\x20','Error\x20stack:','paid','EXPIRED','Payment\x20System/1.0','Order\x20ID\x20Format:','Remitter','toLowerCase','qrCodeLink','Error\x20details:','logWhiteDomainError','completed','loggerService','../loggerService','Response\x20data:','parse',',\x20body:\x20','NodaService','567uBkUoX','Currency','success','Raw\x20Response\x20Body:','isActive','logWhiteDomainRequest','createPaymentLink','Method','HTTP\x20','Unknown\x20error','shortLink','MerchantPaymentId','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','successful','entries','expired'];a67_0x1cb3=function(){return _0x821f24;};return a67_0x1cb3();}Object[a67_0x5a7773(0xcf)](exports,'__esModule',{'value':!![]}),exports[a67_0x5a7773(0xa1)]=void 0x0;function a67_0x59db(_0x29aed0,_0x33cada){_0x29aed0=_0x29aed0-0x6d;const _0x1cb35c=a67_0x1cb3();let _0x59dbef=_0x1cb35c[_0x29aed0];return _0x59dbef;}const loggerService_1=require(a67_0x5a7773(0x9d));class NodaService{constructor(){const _0xf9926=a67_0x5a7773;this[_0xf9926(0xb5)]=_0xf9926(0xc3),console['log'](_0xf9926(0x70));}async[a67_0x5a7773(0xa8)](_0x8e2725){const _0x4811c2=a67_0x5a7773,{orderId:_0x12d0de,name:_0xa7a39e,paymentDescription:_0x3c167c,amount:_0x40cfe3,currency:_0x1fff97,webhookUrl:_0x1aeaad,returnUrl:_0x1f7631,expiryDate:_0x1c5027}=_0x8e2725,_0x2ed10d=_0x1fff97[_0x4811c2(0xc1)](),_0x364e02=_0x4811c2(0xca),_0x125336='https://tesoft.uk/gateway/pending.php?id='+_0x12d0de,_0x13ef05={'name':_0xa7a39e,'paymentDescription':_0x3c167c,'amount':_0x40cfe3,'currency':_0x2ed10d,'paymentId':_0x12d0de,'webhookUrl':_0x364e02,'returnUrl':_0x125336};_0x1c5027&&(_0x13ef05[_0x4811c2(0x7e)]=_0x1c5027);const _0x5b8646=Date[_0x4811c2(0xe1)]();try{console['log'](_0x4811c2(0xae)),console['log'](_0x4811c2(0x72),this[_0x4811c2(0xb5)]),console[_0x4811c2(0xb8)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x4811c2(0xd0)](_0x13ef05,null,0x2)),console[_0x4811c2(0xb8)](_0x4811c2(0x95),_0x12d0de,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x4811c2(0xb8)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x125336),loggerService_1['loggerService'][_0x4811c2(0xa7)](_0x4811c2(0x85),_0x4811c2(0x77),_0x4811c2(0x89),_0x13ef05);const _0x20d88c=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x4811c2(0x94)},'body':JSON[_0x4811c2(0xd0)](_0x13ef05)}),_0x4ec5d4=Date[_0x4811c2(0xe1)]()-_0x5b8646;console[_0x4811c2(0xb8)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x4811c2(0xb8)](_0x4811c2(0x71),_0x20d88c[_0x4811c2(0xe0)]),console[_0x4811c2(0xb8)](_0x4811c2(0x73),_0x20d88c[_0x4811c2(0x8d)]),console[_0x4811c2(0xb8)](_0x4811c2(0xbf),Object['fromEntries'](_0x20d88c[_0x4811c2(0xbd)][_0x4811c2(0xb0)]())),console[_0x4811c2(0xb8)]('Response\x20Time:',_0x4ec5d4+'ms');const _0x2b86eb=await _0x20d88c[_0x4811c2(0xdb)]();console[_0x4811c2(0xb8)](_0x4811c2(0xa5),_0x2b86eb);if(!_0x20d88c['ok']){console['error'](_0x4811c2(0xdf)),console[_0x4811c2(0xd7)](_0x4811c2(0x83),_0x20d88c['status']),console[_0x4811c2(0xd7)](_0x4811c2(0xb9),_0x2b86eb),loggerService_1[_0x4811c2(0x9c)]['logWhiteDomainResponse'](_0x4811c2(0x85),'/payment-links',_0x20d88c['status'],_0x2b86eb,_0x4ec5d4),loggerService_1[_0x4811c2(0x9c)]['logWhiteDomainError'](_0x4811c2(0x85),'/payment-links',_0x4811c2(0xaa)+_0x20d88c[_0x4811c2(0xe0)]+':\x20'+_0x2b86eb);if(_0x20d88c['status']===0x190)throw new Error(_0x4811c2(0x6f));else{if(_0x20d88c[_0x4811c2(0xe0)]===0x1f4)throw new Error(_0x4811c2(0xd6));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x20d88c[_0x4811c2(0xe0)]+_0x4811c2(0xa0)+_0x2b86eb);}let _0x3ea5d7;try{_0x3ea5d7=JSON[_0x4811c2(0x9f)](_0x2b86eb);}catch(_0x380a74){console[_0x4811c2(0xd7)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x380a74),loggerService_1[_0x4811c2(0x9c)][_0x4811c2(0x9a)](_0x4811c2(0x85),_0x4811c2(0x77),_0x4811c2(0x86)+_0x380a74);throw new Error(_0x4811c2(0x8a)+_0x2b86eb);}console[_0x4811c2(0xb8)](_0x4811c2(0x84)),console[_0x4811c2(0xb8)](_0x4811c2(0xc6),JSON['stringify'](_0x3ea5d7,null,0x2)),loggerService_1['loggerService'][_0x4811c2(0xc7)](_0x4811c2(0x85),_0x4811c2(0x77),_0x20d88c[_0x4811c2(0xe0)],_0x3ea5d7,_0x4ec5d4);if(_0x3ea5d7['error']||_0x3ea5d7[_0x4811c2(0x8f)]){const _0x3447b6=_0x3ea5d7[_0x4811c2(0xb6)]||_0x3ea5d7['error']||_0x4811c2(0xd8);console[_0x4811c2(0xd7)](_0x4811c2(0xba)),console[_0x4811c2(0xd7)](_0x4811c2(0xd5),_0x3447b6),console[_0x4811c2(0xd7)](_0x4811c2(0xbb),_0x3ea5d7[_0x4811c2(0x8f)]),loggerService_1[_0x4811c2(0x9c)][_0x4811c2(0x9a)](_0x4811c2(0x85),'/payment-links',_0x4811c2(0x90)+_0x3447b6);throw new Error(_0x4811c2(0x8e)+_0x3447b6);}if(!_0x3ea5d7['id']||!_0x3ea5d7[_0x4811c2(0xb2)]?.[_0x4811c2(0xac)]){console[_0x4811c2(0xd7)](_0x4811c2(0xc2)),console[_0x4811c2(0xd7)](_0x4811c2(0xcd)),console[_0x4811c2(0xd7)](_0x4811c2(0x9e),_0x3ea5d7),loggerService_1[_0x4811c2(0x9c)][_0x4811c2(0x9a)](_0x4811c2(0x85),_0x4811c2(0x77),_0x4811c2(0xde));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console['log'](_0x4811c2(0xc9)),console['log'](_0x4811c2(0x7d),_0x3ea5d7['id']),console[_0x4811c2(0xb8)]('Short\x20Link:',_0x3ea5d7[_0x4811c2(0xb2)][_0x4811c2(0xac)]),console[_0x4811c2(0xb8)]('QR\x20Code\x20Link:',_0x3ea5d7['shortLinkUrls'][_0x4811c2(0x98)]||_0x4811c2(0xdc)),console[_0x4811c2(0xb8)](_0x4811c2(0x82),_0x12d0de,'(8digits-8digits\x20format)'),console[_0x4811c2(0xb8)](_0x4811c2(0xe3),_0x125336),{'gateway_payment_id':_0x3ea5d7['id'],'payment_url':_0x3ea5d7[_0x4811c2(0xb2)][_0x4811c2(0xac)],'qr_code_url':_0x3ea5d7['shortLinkUrls'][_0x4811c2(0x98)],'expiry_date':_0x3ea5d7['expiryDate']};}catch(_0x1263b2){console[_0x4811c2(0xd7)](_0x4811c2(0xc8)),console[_0x4811c2(0xd7)](_0x4811c2(0x99),_0x1263b2),loggerService_1['loggerService'][_0x4811c2(0x9a)](_0x4811c2(0x85),_0x4811c2(0x77),_0x1263b2);if(_0x1263b2 instanceof Error){console['error'](_0x4811c2(0xda),_0x1263b2['message']),console[_0x4811c2(0xd7)](_0x4811c2(0x91),_0x1263b2['stack']);throw new Error(_0x4811c2(0xb3)+_0x1263b2[_0x4811c2(0xb6)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a67_0x5a7773(0x6e)](_0xe40560){const _0xb1cbfd=a67_0x5a7773,_0x49396a=Date[_0xb1cbfd(0xe1)]();try{loggerService_1[_0xb1cbfd(0x9c)][_0xb1cbfd(0xa7)]('noda',_0xb1cbfd(0x74)+_0xe40560,_0xb1cbfd(0xb4),{});const _0xeaa04a=await fetch(this['apiUrl']+'/'+_0xe40560,{'method':_0xb1cbfd(0xb4),'headers':{'Content-Type':'application/json','User-Agent':'Payment\x20System/1.0'}}),_0x4a3572=Date[_0xb1cbfd(0xe1)]()-_0x49396a;if(!_0xeaa04a['ok']){const _0x26b509=await _0xeaa04a[_0xb1cbfd(0xdb)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0xb1cbfd(0x85),_0xb1cbfd(0x74)+_0xe40560,_0xeaa04a['status'],_0x26b509,_0x4a3572);throw new Error(_0xb1cbfd(0xdd)+_0xeaa04a['status']);}const _0x33d25f=await _0xeaa04a[_0xb1cbfd(0x76)]();loggerService_1['loggerService'][_0xb1cbfd(0xc7)](_0xb1cbfd(0x85),_0xb1cbfd(0x74)+_0xe40560,_0xeaa04a[_0xb1cbfd(0xe0)],_0x33d25f,_0x4a3572);if(_0x33d25f[_0xb1cbfd(0xd7)]||_0x33d25f[_0xb1cbfd(0x8f)]){loggerService_1[_0xb1cbfd(0x9c)][_0xb1cbfd(0x9a)](_0xb1cbfd(0x85),_0xb1cbfd(0x74)+_0xe40560,'Noda\x20API\x20error:\x20'+(_0x33d25f[_0xb1cbfd(0xb6)]||_0x33d25f[_0xb1cbfd(0xd7)]||_0xb1cbfd(0xab)));throw new Error('Noda\x20API\x20error:\x20'+(_0x33d25f[_0xb1cbfd(0xb6)]||_0x33d25f['error']||_0xb1cbfd(0xab)));}let _0x3f2e33=_0xb1cbfd(0x80);if(_0x33d25f[_0xb1cbfd(0xa6)]===![]){if(_0x33d25f[_0xb1cbfd(0x7e)]){const _0x15bfed=new Date(_0x33d25f[_0xb1cbfd(0x7e)]),_0x48831c=new Date();_0x15bfed<_0x48831c?_0x3f2e33=_0xb1cbfd(0x93):_0x3f2e33=_0xb1cbfd(0xd3);}else _0x3f2e33=_0xb1cbfd(0xd3);}else _0x3f2e33='PENDING';return{'status':_0x3f2e33,'amount':_0x33d25f['amount'],'currency':_0x33d25f[_0xb1cbfd(0xd9)],'isActive':_0x33d25f[_0xb1cbfd(0xa6)]};}catch(_0x5adea9){console[_0xb1cbfd(0xd7)](_0xb1cbfd(0xcc),_0x5adea9),loggerService_1['loggerService'][_0xb1cbfd(0x9a)](_0xb1cbfd(0x85),_0xb1cbfd(0x74)+_0xe40560,_0x5adea9);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x5adea9 instanceof Error?_0x5adea9[_0xb1cbfd(0xb6)]:'Unknown\x20error'));}}async['processWebhook'](_0x57063a){const _0xd691ac=a67_0x5a7773;console[_0xd691ac(0xb8)](_0xd691ac(0xce),_0x57063a);let _0xccf54c=_0xd691ac(0x80);switch(_0x57063a[_0xd691ac(0xbe)]?.[_0xd691ac(0x97)]()){case'done':case _0xd691ac(0x9b):case _0xd691ac(0x92):case _0xd691ac(0xa4):case _0xd691ac(0xaf):_0x57063a['Settled']==='Yes'?_0xccf54c=_0xd691ac(0x7a):_0xccf54c=_0xd691ac(0x80);break;case _0xd691ac(0xb7):case'canceled':case _0xd691ac(0xcb):case _0xd691ac(0xd7):case'rejected':_0xccf54c=_0xd691ac(0xd3);break;case _0xd691ac(0xb1):case'timeout':_0xccf54c=_0xd691ac(0x93);break;case'pending':case _0xd691ac(0x87):case _0xd691ac(0xe4):case _0xd691ac(0xd2):case _0xd691ac(0xc5):default:_0xccf54c='PENDING';break;}return{'paymentId':_0x57063a[_0xd691ac(0xad)]||_0x57063a[_0xd691ac(0x81)],'status':_0xccf54c,'amount':_0x57063a['Amount'],'currency':_0x57063a[_0xd691ac(0xa3)],'additionalInfo':{'method':_0x57063a[_0xd691ac(0xa9)],'bankId':_0x57063a[_0xd691ac(0x7c)],'settled':_0x57063a['Settled'],'settlementDate':_0x57063a[_0xd691ac(0xbc)],'remitterName':_0x57063a[_0xd691ac(0x96)]?.[_0xd691ac(0xd4)],'remitterIban':_0x57063a[_0xd691ac(0x96)]?.['Iban'],'bankTransactionId':_0x57063a[_0xd691ac(0x8c)]}};}[a67_0x5a7773(0x7f)](_0x18ed82,_0x54d149){const _0x3c227d=a67_0x5a7773;return console[_0x3c227d(0xb8)](_0x3c227d(0x88),{'receivedSignature':_0x54d149,'paymentId':_0x18ed82[_0x3c227d(0x81)],'merchantPaymentId':_0x18ed82['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;