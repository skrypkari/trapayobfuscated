'use strict';const a40_0xbb77e2=a40_0x26f0;function a40_0x26f0(_0x2988e7,_0x7fcce){const _0xd778b=a40_0xd778();return a40_0x26f0=function(_0x26f00f,_0xaa40a4){_0x26f00f=_0x26f00f-0x85;let _0x19b57c=_0xd778b[_0x26f00f];return _0x19b57c;},a40_0x26f0(_0x2988e7,_0x7fcce);}(function(_0x4fef89,_0x4f38cf){const _0x46c49b=a40_0x26f0,_0x8e2ac8=_0x4fef89();while(!![]){try{const _0x51cd4a=parseInt(_0x46c49b(0xeb))/0x1+parseInt(_0x46c49b(0xec))/0x2*(parseInt(_0x46c49b(0xba))/0x3)+-parseInt(_0x46c49b(0xaf))/0x4+-parseInt(_0x46c49b(0xc0))/0x5*(parseInt(_0x46c49b(0xfb))/0x6)+parseInt(_0x46c49b(0xd9))/0x7*(-parseInt(_0x46c49b(0x8b))/0x8)+-parseInt(_0x46c49b(0xd4))/0x9+parseInt(_0x46c49b(0xac))/0xa*(parseInt(_0x46c49b(0x89))/0xb);if(_0x51cd4a===_0x4f38cf)break;else _0x8e2ac8['push'](_0x8e2ac8['shift']());}catch(_0x468cb7){_0x8e2ac8['push'](_0x8e2ac8['shift']());}}}(a40_0xd778,0x79076));Object['defineProperty'](exports,a40_0xbb77e2(0xdd),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a40_0xbb77e2(0xf8));function a40_0xd778(){const _0x41dec3=['All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','stack','toUpperCase','in_progress','Processing\x20Noda\x20webhook:','===\x20NODA\x20API\x20ERROR\x20===','noda','Unknown\x20error\x20from\x20Noda\x20API','POST','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Failed\x20to\x20parse\x20JSON\x20response:','Business\x20Error:\x20','Order\x20ID\x20Format:','now','BankId','shortLinkUrls','successful','stringify','Status\x20Code:','===\x20NODA\x20SUCCESS\x20===','EXPIRED','active','Raw\x20Response\x20Body:','rejected','currency','Name','error','QR\x20Code\x20Link:','Noda\x20payment\x20verification\x20error:','isActive','19209930pKUaML','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Response\x20Time:','2378424vuevOx','PAID','Noda\x20webhook\x20signature\x20verification:','(8digits-8digits\x20format)','PaymentId','logWhiteDomainRequest','/payment-links','cancelled','shortLink','HTTP\x20','Error\x20stack:','3OlESkA','text','qrCodeLink','statusCode','Status\x20Text:','Remitter','2014795yEWOyw','HTTP\x20error!\x20status:\x20','entries','Request\x20Body\x20(Direct\x20JSON):','GET','processWebhook','status','pending','URL:','Response\x20data:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Short\x20Link:','fromEntries','logWhiteDomainError','Order\x20ID\x20Used:','Not\x20provided','MerchantPaymentId','timeout','amount','Settled','1763937hqLyNq','https://tesoft.uk/gateway/noda/','Currency','FAILED','json','21TJTcpL','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','success','log','__esModule','parse','Unknown\x20error','apiUrl','logWhiteDomainResponse','application/json','toLowerCase','Status:','HTTP\x20Status:','loggerService','Headers:','TesSoft\x20Payment\x20System/1.0','expiryDate','message','538011bmtxGd','1100358UJWbPh','Noda\x20API\x20error:\x20','Status','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','BankTransactionId','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','canceled','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','completed','Payment\x20Link\x20ID:','/payment-links/','https://tesoft.uk/gateway/success.php?id=','../loggerService','PENDING','done','12oHGgEY','Amount','Method','Error\x20Message:',',\x20body:\x20','expired','failed','11MrxrmR','Parsed\x20Result:','2445152VXngek','verifyPayment','Missing\x20id\x20or\x20shortLink\x20in\x20response'];a40_0xd778=function(){return _0x41dec3;};return a40_0xd778();}class NodaService{constructor(){const _0x5b2e80=a40_0xbb77e2;this[_0x5b2e80(0xe0)]=_0x5b2e80(0xd5),console[_0x5b2e80(0xdc)](_0x5b2e80(0xda));}async['createPaymentLink'](_0x1dc332){const _0xc661dd=a40_0xbb77e2,{orderId:_0x490b9c,name:_0x176861,paymentDescription:_0x516cf8,amount:_0x1c8f33,currency:_0xf2fa91,webhookUrl:_0x2f2c67,returnUrl:_0x28cf93,expiryDate:_0x2d6db0}=_0x1dc332,_0x10cfaa=_0xf2fa91[_0xc661dd(0x90)](),_0x22e483='https://tesoft.uk/gateway/noda/webhook/',_0x2270fa=_0xc661dd(0xf7)+_0x490b9c,_0xab7cde={'name':_0x176861,'paymentDescription':_0x516cf8,'amount':_0x1c8f33,'currency':_0x10cfaa,'paymentId':_0x490b9c,'webhookUrl':_0x22e483,'returnUrl':_0x2270fa};_0x2d6db0&&(_0xab7cde['expiryDate']=_0x2d6db0);const _0x1fbf78=Date[_0xc661dd(0x9b)]();try{console['log'](_0xc661dd(0xf3)),console[_0xc661dd(0xdc)](_0xc661dd(0xc8),this[_0xc661dd(0xe0)]),console[_0xc661dd(0xdc)](_0xc661dd(0xc3),JSON[_0xc661dd(0x9f)](_0xab7cde,null,0x2)),console[_0xc661dd(0xdc)](_0xc661dd(0x9a),_0x490b9c,'(8digits-8digits\x20format\x20for\x20Noda)'),loggerService_1[_0xc661dd(0xe6)]['logWhiteDomainRequest'](_0xc661dd(0x94),_0xc661dd(0xb5),_0xc661dd(0x96),_0xab7cde);const _0x651a99=await fetch(this[_0xc661dd(0xe0)],{'method':_0xc661dd(0x96),'headers':{'Content-Type':'application/json','Accept':_0xc661dd(0xe2),'User-Agent':_0xc661dd(0xe8)},'body':JSON[_0xc661dd(0x9f)](_0xab7cde)}),_0x1b81d3=Date[_0xc661dd(0x9b)]()-_0x1fbf78;console[_0xc661dd(0xdc)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0xc661dd(0xe4),_0x651a99[_0xc661dd(0xc6)]),console['log'](_0xc661dd(0xbe),_0x651a99['statusText']),console[_0xc661dd(0xdc)](_0xc661dd(0xe7),Object[_0xc661dd(0xcc)](_0x651a99['headers'][_0xc661dd(0xc2)]())),console[_0xc661dd(0xdc)](_0xc661dd(0xae),_0x1b81d3+'ms');const _0x348f33=await _0x651a99[_0xc661dd(0xbb)]();console[_0xc661dd(0xdc)](_0xc661dd(0xa4),_0x348f33);if(!_0x651a99['ok']){console[_0xc661dd(0xa8)](_0xc661dd(0x93)),console[_0xc661dd(0xa8)](_0xc661dd(0xe5),_0x651a99[_0xc661dd(0xc6)]),console[_0xc661dd(0xa8)]('Response\x20Body:',_0x348f33),loggerService_1[_0xc661dd(0xe6)]['logWhiteDomainResponse'](_0xc661dd(0x94),_0xc661dd(0xb5),_0x651a99[_0xc661dd(0xc6)],_0x348f33,_0x1b81d3),loggerService_1['loggerService']['logWhiteDomainError'](_0xc661dd(0x94),_0xc661dd(0xb5),_0xc661dd(0xb8)+_0x651a99[_0xc661dd(0xc6)]+':\x20'+_0x348f33);if(_0x651a99[_0xc661dd(0xc6)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x651a99[_0xc661dd(0xc6)]===0x1f4)throw new Error(_0xc661dd(0x8e));}throw new Error(_0xc661dd(0xc1)+_0x651a99['status']+_0xc661dd(0x86)+_0x348f33);}let _0x3e027c;try{_0x3e027c=JSON[_0xc661dd(0xde)](_0x348f33);}catch(_0x43c140){console[_0xc661dd(0xa8)](_0xc661dd(0x98),_0x43c140),loggerService_1[_0xc661dd(0xe6)][_0xc661dd(0xcd)]('noda',_0xc661dd(0xb5),'JSON\x20Parse\x20Error:\x20'+_0x43c140);throw new Error(_0xc661dd(0xf1)+_0x348f33);}console[_0xc661dd(0xdc)](_0xc661dd(0xca)),console[_0xc661dd(0xdc)](_0xc661dd(0x8a),JSON['stringify'](_0x3e027c,null,0x2)),loggerService_1[_0xc661dd(0xe6)]['logWhiteDomainResponse'](_0xc661dd(0x94),_0xc661dd(0xb5),_0x651a99[_0xc661dd(0xc6)],_0x3e027c,_0x1b81d3);if(_0x3e027c['error']||_0x3e027c[_0xc661dd(0xbd)]){const _0x49f9f4=_0x3e027c[_0xc661dd(0xea)]||_0x3e027c[_0xc661dd(0xa8)]||_0xc661dd(0x95);console[_0xc661dd(0xa8)](_0xc661dd(0xef)),console[_0xc661dd(0xa8)](_0xc661dd(0x85),_0x49f9f4),console[_0xc661dd(0xa8)](_0xc661dd(0xa0),_0x3e027c[_0xc661dd(0xbd)]),loggerService_1[_0xc661dd(0xe6)][_0xc661dd(0xcd)](_0xc661dd(0x94),_0xc661dd(0xb5),_0xc661dd(0x99)+_0x49f9f4);throw new Error(_0xc661dd(0xed)+_0x49f9f4);}if(!_0x3e027c['id']||!_0x3e027c['shortLinkUrls']?.[_0xc661dd(0xb7)]){console[_0xc661dd(0xa8)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0xc661dd(0xa8)](_0xc661dd(0x8d)),console['error'](_0xc661dd(0xc9),_0x3e027c),loggerService_1[_0xc661dd(0xe6)][_0xc661dd(0xcd)]('noda','/payment-links',_0xc661dd(0xad));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0xc661dd(0xdc)](_0xc661dd(0xa1)),console[_0xc661dd(0xdc)](_0xc661dd(0xf5),_0x3e027c['id']),console['log'](_0xc661dd(0xcb),_0x3e027c['shortLinkUrls']['shortLink']),console['log'](_0xc661dd(0xa9),_0x3e027c[_0xc661dd(0x9d)][_0xc661dd(0xbc)]||_0xc661dd(0xcf)),console[_0xc661dd(0xdc)](_0xc661dd(0xce),_0x490b9c,_0xc661dd(0xb2)),{'gateway_payment_id':_0x3e027c['id'],'payment_url':_0x3e027c[_0xc661dd(0x9d)][_0xc661dd(0xb7)],'qr_code_url':_0x3e027c['shortLinkUrls'][_0xc661dd(0xbc)],'expiry_date':_0x3e027c['expiryDate']};}catch(_0xe6b376){console[_0xc661dd(0xa8)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0xc661dd(0xa8)]('Error\x20details:',_0xe6b376),loggerService_1[_0xc661dd(0xe6)][_0xc661dd(0xcd)](_0xc661dd(0x94),_0xc661dd(0xb5),_0xe6b376);if(_0xe6b376 instanceof Error){console['error']('Error\x20message:',_0xe6b376['message']),console[_0xc661dd(0xa8)](_0xc661dd(0xb9),_0xe6b376[_0xc661dd(0x8f)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0xe6b376['message']);}throw new Error(_0xc661dd(0x97));}}async[a40_0xbb77e2(0x8c)](_0x4e66a7){const _0x32c44f=a40_0xbb77e2,_0x14ac0f=Date['now']();try{loggerService_1[_0x32c44f(0xe6)][_0x32c44f(0xb4)]('noda',_0x32c44f(0xf6)+_0x4e66a7,_0x32c44f(0xc4),{});const _0x446945=await fetch(this['apiUrl']+'/'+_0x4e66a7,{'method':_0x32c44f(0xc4),'headers':{'Content-Type':_0x32c44f(0xe2),'User-Agent':_0x32c44f(0xe8)}}),_0x252d26=Date['now']()-_0x14ac0f;if(!_0x446945['ok']){const _0x794dbf=await _0x446945['text']();loggerService_1[_0x32c44f(0xe6)][_0x32c44f(0xe1)]('noda','/payment-links/'+_0x4e66a7,_0x446945[_0x32c44f(0xc6)],_0x794dbf,_0x252d26);throw new Error(_0x32c44f(0xc1)+_0x446945[_0x32c44f(0xc6)]);}const _0x1f9a7d=await _0x446945[_0x32c44f(0xd8)]();loggerService_1['loggerService'][_0x32c44f(0xe1)](_0x32c44f(0x94),_0x32c44f(0xf6)+_0x4e66a7,_0x446945[_0x32c44f(0xc6)],_0x1f9a7d,_0x252d26);if(_0x1f9a7d[_0x32c44f(0xa8)]||_0x1f9a7d[_0x32c44f(0xbd)]){loggerService_1[_0x32c44f(0xe6)][_0x32c44f(0xcd)](_0x32c44f(0x94),'/payment-links/'+_0x4e66a7,_0x32c44f(0xed)+(_0x1f9a7d[_0x32c44f(0xea)]||_0x1f9a7d['error']||_0x32c44f(0xdf)));throw new Error(_0x32c44f(0xed)+(_0x1f9a7d[_0x32c44f(0xea)]||_0x1f9a7d[_0x32c44f(0xa8)]||_0x32c44f(0xdf)));}let _0x3326d9='PENDING';if(_0x1f9a7d[_0x32c44f(0xab)]===![]){if(_0x1f9a7d[_0x32c44f(0xe9)]){const _0x48b7dc=new Date(_0x1f9a7d[_0x32c44f(0xe9)]),_0x316183=new Date();_0x48b7dc<_0x316183?_0x3326d9=_0x32c44f(0xa2):_0x3326d9='FAILED';}else _0x3326d9=_0x32c44f(0xd7);}else _0x3326d9='PENDING';return{'status':_0x3326d9,'amount':_0x1f9a7d[_0x32c44f(0xd2)],'currency':_0x1f9a7d[_0x32c44f(0xa6)],'isActive':_0x1f9a7d['isActive']};}catch(_0x37d248){console['error'](_0x32c44f(0xaa),_0x37d248),loggerService_1[_0x32c44f(0xe6)][_0x32c44f(0xcd)]('noda',_0x32c44f(0xf6)+_0x4e66a7,_0x37d248);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x37d248 instanceof Error?_0x37d248[_0x32c44f(0xea)]:'Unknown\x20error'));}}async[a40_0xbb77e2(0xc5)](_0xb786f5){const _0x2be40a=a40_0xbb77e2;console[_0x2be40a(0xdc)](_0x2be40a(0x92),_0xb786f5);let _0xa8f02c=_0x2be40a(0xf9);switch(_0xb786f5[_0x2be40a(0xee)]?.[_0x2be40a(0xe3)]()){case _0x2be40a(0xfa):case _0x2be40a(0xf4):case'paid':case _0x2be40a(0xdb):case _0x2be40a(0x9e):_0xb786f5[_0x2be40a(0xd3)]==='Yes'?_0xa8f02c=_0x2be40a(0xb0):_0xa8f02c=_0x2be40a(0xf9);break;case _0x2be40a(0xb6):case _0x2be40a(0xf2):case _0x2be40a(0x88):case _0x2be40a(0xa8):case _0x2be40a(0xa5):_0xa8f02c=_0x2be40a(0xd7);break;case _0x2be40a(0x87):case _0x2be40a(0xd1):_0xa8f02c=_0x2be40a(0xa2);break;case _0x2be40a(0xc7):case'created':case _0x2be40a(0xa3):case'processing':case _0x2be40a(0x91):default:_0xa8f02c=_0x2be40a(0xf9);break;}return{'paymentId':_0xb786f5[_0x2be40a(0xd0)]||_0xb786f5[_0x2be40a(0xb3)],'status':_0xa8f02c,'amount':_0xb786f5[_0x2be40a(0xfc)],'currency':_0xb786f5[_0x2be40a(0xd6)],'additionalInfo':{'method':_0xb786f5[_0x2be40a(0xfd)],'bankId':_0xb786f5[_0x2be40a(0x9c)],'settled':_0xb786f5['Settled'],'settlementDate':_0xb786f5['SettlementDate'],'remitterName':_0xb786f5[_0x2be40a(0xbf)]?.[_0x2be40a(0xa7)],'remitterIban':_0xb786f5[_0x2be40a(0xbf)]?.['Iban'],'bankTransactionId':_0xb786f5[_0x2be40a(0xf0)]}};}['verifyWebhookSignature'](_0x127543,_0x388ba2){const _0x3aee9d=a40_0xbb77e2;return console[_0x3aee9d(0xdc)](_0x3aee9d(0xb1),{'receivedSignature':_0x388ba2,'paymentId':_0x127543[_0x3aee9d(0xb3)],'merchantPaymentId':_0x127543['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;