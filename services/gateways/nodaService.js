'use strict';const a46_0x26a9d4=a46_0x4612;(function(_0x179c84,_0x290a40){const _0x1ecc1d=a46_0x4612,_0x13917c=_0x179c84();while(!![]){try{const _0x66de78=parseInt(_0x1ecc1d(0x14d))/0x1*(-parseInt(_0x1ecc1d(0x12c))/0x2)+parseInt(_0x1ecc1d(0x152))/0x3+-parseInt(_0x1ecc1d(0xf7))/0x4*(parseInt(_0x1ecc1d(0x106))/0x5)+parseInt(_0x1ecc1d(0x11f))/0x6*(parseInt(_0x1ecc1d(0x14a))/0x7)+-parseInt(_0x1ecc1d(0x126))/0x8+parseInt(_0x1ecc1d(0x158))/0x9+parseInt(_0x1ecc1d(0x15a))/0xa*(-parseInt(_0x1ecc1d(0x15e))/0xb);if(_0x66de78===_0x290a40)break;else _0x13917c['push'](_0x13917c['shift']());}catch(_0x165e96){_0x13917c['push'](_0x13917c['shift']());}}}(a46_0x3eb0,0xd8616));function a46_0x3eb0(){const _0x377f77=['Short\x20Link:','Failed\x20to\x20parse\x20JSON\x20response:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','https://tesoft.uk/gateway/pending.php?id=','verifyWebhookSignature','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','verifyPayment','error','qrCodeLink','Unknown\x20error','NodaService','Amount','Error\x20stack:','Remitter','Noda\x20payment\x20verification\x20error:','4iJifcb','/payment-links/','isActive',',\x20body:\x20','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','amount','toUpperCase','success','MerchantPaymentId','expiryDate','created','Unknown\x20error\x20from\x20Noda\x20API','Name','message','rejected','2625130lYvuZs','URL:','application/json','EXPIRED','===\x20PARSED\x20NODA\x20RESPONSE\x20===','shortLink','pending','Settled','Parsed\x20Result:','text','Request\x20Body\x20(Direct\x20JSON):','headers','BankTransactionId','Payment\x20Link\x20ID:','logWhiteDomainResponse','now','QR\x20Code\x20Link:','Order\x20ID\x20Used:','PaymentId','HTTP\x20Status:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','statusText','Error\x20details:','apiUrl','defineProperty','246RKqbhp','fromEntries','PENDING','active','===\x20NODA\x20SUCCESS\x20===','expired','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','8224112TQBIoZ','shortLinkUrls','stack','in_progress','Missing\x20id\x20or\x20shortLink\x20in\x20response','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','2708JfVZSE','toLowerCase','Processing\x20Noda\x20webhook:','/payment-links','statusCode','TesSoft\x20Payment\x20System/1.0','Response\x20Body:','Error\x20Message:','done','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','timeout','successful','Failed\x20to\x20verify\x20Noda\x20payment:\x20','JSON\x20Parse\x20Error:\x20','Noda\x20API\x20error:\x20','PAID','json','Error\x20message:','noda','createPaymentLink','Response\x20data:','===\x20NODA\x20API\x20ERROR\x20===','Iban','currency','logWhiteDomainError','status','../loggerService','loggerService','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Headers:','273679fYMSvc','stringify','GET','1159nSeyDu','(8digits-8digits\x20format\x20for\x20Noda)','FAILED','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','2269947UxEcDY','logWhiteDomainRequest','Response\x20Time:','parse','cancelled','POST','15592383xyYMkJ','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','834930DTBcyv','Status\x20Code:','log','Noda\x20webhook\x20signature\x20verification:','11AIygNP','failed','Raw\x20Response\x20Body:','Yes','SettlementDate','HTTP\x20error!\x20status:\x20','Status'];a46_0x3eb0=function(){return _0x377f77;};return a46_0x3eb0();}Object[a46_0x26a9d4(0x11e)](exports,'__esModule',{'value':!![]}),exports[a46_0x26a9d4(0xf2)]=void 0x0;const loggerService_1=require(a46_0x26a9d4(0x146));class NodaService{constructor(){const _0x261e54=a46_0x26a9d4;this[_0x261e54(0x11d)]='https://tesoft.uk/gateway/noda/',console[_0x261e54(0x15c)](_0x261e54(0x125));}async[a46_0x26a9d4(0x13f)](_0xd7f03b){const _0x542361=a46_0x26a9d4,{orderId:_0x882b06,name:_0x3e4428,paymentDescription:_0xea38ac,amount:_0xfcd05f,currency:_0x559b3f,webhookUrl:_0x2b38e4,returnUrl:_0x3ed93d,expiryDate:_0x5978cf}=_0xd7f03b,_0x40df66=_0x559b3f[_0x542361(0xfd)](),_0x14914d='https://tesoft.uk/gateway/noda/webhook/',_0x434bb2=_0x542361(0xeb)+_0x882b06,_0x21b85c={'name':_0x3e4428,'paymentDescription':_0xea38ac,'amount':_0xfcd05f,'currency':_0x40df66,'paymentId':_0x882b06,'webhookUrl':_0x14914d,'returnUrl':_0x434bb2};_0x5978cf&&(_0x21b85c[_0x542361(0x100)]=_0x5978cf);const _0x2a7a6d=Date[_0x542361(0x115)]();try{console[_0x542361(0x15c)](_0x542361(0xea)),console[_0x542361(0x15c)](_0x542361(0x107),this[_0x542361(0x11d)]),console[_0x542361(0x15c)](_0x542361(0x110),JSON[_0x542361(0x14b)](_0x21b85c,null,0x2)),console[_0x542361(0x15c)]('Order\x20ID\x20Format:',_0x882b06,_0x542361(0x14e)),console['log'](_0x542361(0xfb),_0x434bb2),loggerService_1['loggerService'][_0x542361(0x153)]('noda',_0x542361(0x12f),_0x542361(0x157),_0x21b85c);const _0x52390a=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x542361(0x131)},'body':JSON[_0x542361(0x14b)](_0x21b85c)}),_0x4b8b98=Date['now']()-_0x2a7a6d;console[_0x542361(0x15c)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x542361(0x15c)]('Status:',_0x52390a[_0x542361(0x145)]),console[_0x542361(0x15c)]('Status\x20Text:',_0x52390a[_0x542361(0x11b)]),console[_0x542361(0x15c)](_0x542361(0x149),Object[_0x542361(0x120)](_0x52390a[_0x542361(0x111)]['entries']())),console[_0x542361(0x15c)](_0x542361(0x154),_0x4b8b98+'ms');const _0x3014ad=await _0x52390a[_0x542361(0x10f)]();console[_0x542361(0x15c)](_0x542361(0x160),_0x3014ad);if(!_0x52390a['ok']){console[_0x542361(0xef)](_0x542361(0x141)),console[_0x542361(0xef)](_0x542361(0x119),_0x52390a[_0x542361(0x145)]),console['error'](_0x542361(0x132),_0x3014ad),loggerService_1[_0x542361(0x147)][_0x542361(0x114)](_0x542361(0x13e),_0x542361(0x12f),_0x52390a[_0x542361(0x145)],_0x3014ad,_0x4b8b98),loggerService_1[_0x542361(0x147)][_0x542361(0x144)](_0x542361(0x13e),_0x542361(0x12f),'HTTP\x20'+_0x52390a['status']+':\x20'+_0x3014ad);if(_0x52390a[_0x542361(0x145)]===0x190)throw new Error(_0x542361(0x159));else{if(_0x52390a['status']===0x1f4)throw new Error(_0x542361(0x151));}throw new Error(_0x542361(0x163)+_0x52390a[_0x542361(0x145)]+_0x542361(0xfa)+_0x3014ad);}let _0xd3dfc1;try{_0xd3dfc1=JSON[_0x542361(0x155)](_0x3014ad);}catch(_0x31e64b){console[_0x542361(0xef)](_0x542361(0xe9),_0x31e64b),loggerService_1[_0x542361(0x147)][_0x542361(0x144)](_0x542361(0x13e),_0x542361(0x12f),_0x542361(0x139)+_0x31e64b);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x3014ad);}console[_0x542361(0x15c)](_0x542361(0x10a)),console[_0x542361(0x15c)](_0x542361(0x10e),JSON[_0x542361(0x14b)](_0xd3dfc1,null,0x2)),loggerService_1[_0x542361(0x147)][_0x542361(0x114)]('noda',_0x542361(0x12f),_0x52390a['status'],_0xd3dfc1,_0x4b8b98);if(_0xd3dfc1[_0x542361(0xef)]||_0xd3dfc1[_0x542361(0x130)]){const _0xa91839=_0xd3dfc1['message']||_0xd3dfc1[_0x542361(0xef)]||_0x542361(0x102);console[_0x542361(0xef)](_0x542361(0x12b)),console[_0x542361(0xef)](_0x542361(0x133),_0xa91839),console['error'](_0x542361(0x15b),_0xd3dfc1[_0x542361(0x130)]),loggerService_1['loggerService'][_0x542361(0x144)](_0x542361(0x13e),_0x542361(0x12f),'Business\x20Error:\x20'+_0xa91839);throw new Error(_0x542361(0x13a)+_0xa91839);}if(!_0xd3dfc1['id']||!_0xd3dfc1[_0x542361(0x127)]?.['shortLink']){console[_0x542361(0xef)](_0x542361(0x11a)),console[_0x542361(0xef)](_0x542361(0x12a)),console['error'](_0x542361(0x140),_0xd3dfc1),loggerService_1[_0x542361(0x147)][_0x542361(0x144)](_0x542361(0x13e),_0x542361(0x12f),_0x542361(0x148));throw new Error(_0x542361(0xed));}return console[_0x542361(0x15c)](_0x542361(0x123)),console[_0x542361(0x15c)](_0x542361(0x113),_0xd3dfc1['id']),console[_0x542361(0x15c)](_0x542361(0xe8),_0xd3dfc1[_0x542361(0x127)][_0x542361(0x10b)]),console['log'](_0x542361(0x116),_0xd3dfc1['shortLinkUrls'][_0x542361(0xf0)]||'Not\x20provided'),console[_0x542361(0x15c)](_0x542361(0x117),_0x882b06,'(8digits-8digits\x20format)'),console[_0x542361(0x15c)](_0x542361(0x135),_0x434bb2),{'gateway_payment_id':_0xd3dfc1['id'],'payment_url':_0xd3dfc1[_0x542361(0x127)]['shortLink'],'qr_code_url':_0xd3dfc1['shortLinkUrls'][_0x542361(0xf0)],'expiry_date':_0xd3dfc1['expiryDate']};}catch(_0x49c164){console[_0x542361(0xef)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x542361(0xef)](_0x542361(0x11c),_0x49c164),loggerService_1['loggerService'][_0x542361(0x144)](_0x542361(0x13e),_0x542361(0x12f),_0x49c164);if(_0x49c164 instanceof Error){console[_0x542361(0xef)](_0x542361(0x13d),_0x49c164['message']),console['error'](_0x542361(0xf4),_0x49c164[_0x542361(0x128)]);throw new Error(_0x542361(0x150)+_0x49c164['message']);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a46_0x26a9d4(0xee)](_0x36258e){const _0x1f7970=a46_0x26a9d4,_0x38ae52=Date[_0x1f7970(0x115)]();try{loggerService_1[_0x1f7970(0x147)][_0x1f7970(0x153)](_0x1f7970(0x13e),'/payment-links/'+_0x36258e,_0x1f7970(0x14c),{});const _0x34c8ab=await fetch(this[_0x1f7970(0x11d)]+'/'+_0x36258e,{'method':_0x1f7970(0x14c),'headers':{'Content-Type':_0x1f7970(0x108),'User-Agent':_0x1f7970(0x131)}}),_0x587a3b=Date[_0x1f7970(0x115)]()-_0x38ae52;if(!_0x34c8ab['ok']){const _0xfbfdc2=await _0x34c8ab[_0x1f7970(0x10f)]();loggerService_1[_0x1f7970(0x147)][_0x1f7970(0x114)]('noda','/payment-links/'+_0x36258e,_0x34c8ab['status'],_0xfbfdc2,_0x587a3b);throw new Error(_0x1f7970(0x163)+_0x34c8ab[_0x1f7970(0x145)]);}const _0x2b7356=await _0x34c8ab[_0x1f7970(0x13c)]();loggerService_1[_0x1f7970(0x147)][_0x1f7970(0x114)](_0x1f7970(0x13e),'/payment-links/'+_0x36258e,_0x34c8ab[_0x1f7970(0x145)],_0x2b7356,_0x587a3b);if(_0x2b7356[_0x1f7970(0xef)]||_0x2b7356['statusCode']){loggerService_1[_0x1f7970(0x147)][_0x1f7970(0x144)]('noda','/payment-links/'+_0x36258e,_0x1f7970(0x13a)+(_0x2b7356[_0x1f7970(0x104)]||_0x2b7356['error']||'Unknown\x20error'));throw new Error(_0x1f7970(0x13a)+(_0x2b7356[_0x1f7970(0x104)]||_0x2b7356[_0x1f7970(0xef)]||_0x1f7970(0xf1)));}let _0x368419=_0x1f7970(0x121);if(_0x2b7356[_0x1f7970(0xf9)]===![]){if(_0x2b7356['expiryDate']){const _0x568476=new Date(_0x2b7356[_0x1f7970(0x100)]),_0x6eee09=new Date();_0x568476<_0x6eee09?_0x368419=_0x1f7970(0x109):_0x368419=_0x1f7970(0x14f);}else _0x368419='FAILED';}else _0x368419=_0x1f7970(0x121);return{'status':_0x368419,'amount':_0x2b7356[_0x1f7970(0xfc)],'currency':_0x2b7356[_0x1f7970(0x143)],'isActive':_0x2b7356[_0x1f7970(0xf9)]};}catch(_0x33e3e0){console['error'](_0x1f7970(0xf6),_0x33e3e0),loggerService_1[_0x1f7970(0x147)][_0x1f7970(0x144)](_0x1f7970(0x13e),_0x1f7970(0xf8)+_0x36258e,_0x33e3e0);throw new Error(_0x1f7970(0x138)+(_0x33e3e0 instanceof Error?_0x33e3e0[_0x1f7970(0x104)]:'Unknown\x20error'));}}async['processWebhook'](_0x588cbd){const _0x50b87d=a46_0x26a9d4;console[_0x50b87d(0x15c)](_0x50b87d(0x12e),_0x588cbd);let _0x30a21d='PENDING';switch(_0x588cbd[_0x50b87d(0x164)]?.[_0x50b87d(0x12d)]()){case _0x50b87d(0x134):case'completed':case'paid':case _0x50b87d(0xfe):case _0x50b87d(0x137):_0x588cbd[_0x50b87d(0x10d)]===_0x50b87d(0x161)?_0x30a21d=_0x50b87d(0x13b):_0x30a21d='PENDING';break;case _0x50b87d(0x156):case'canceled':case _0x50b87d(0x15f):case _0x50b87d(0xef):case _0x50b87d(0x105):_0x30a21d=_0x50b87d(0x14f);break;case _0x50b87d(0x124):case _0x50b87d(0x136):_0x30a21d='EXPIRED';break;case _0x50b87d(0x10c):case _0x50b87d(0x101):case _0x50b87d(0x122):case'processing':case _0x50b87d(0x129):default:_0x30a21d=_0x50b87d(0x121);break;}return{'paymentId':_0x588cbd[_0x50b87d(0xff)]||_0x588cbd[_0x50b87d(0x118)],'status':_0x30a21d,'amount':_0x588cbd[_0x50b87d(0xf3)],'currency':_0x588cbd['Currency'],'additionalInfo':{'method':_0x588cbd['Method'],'bankId':_0x588cbd['BankId'],'settled':_0x588cbd['Settled'],'settlementDate':_0x588cbd[_0x50b87d(0x162)],'remitterName':_0x588cbd[_0x50b87d(0xf5)]?.[_0x50b87d(0x103)],'remitterIban':_0x588cbd[_0x50b87d(0xf5)]?.[_0x50b87d(0x142)],'bankTransactionId':_0x588cbd[_0x50b87d(0x112)]}};}[a46_0x26a9d4(0xec)](_0x25fc96,_0x5c87c1){const _0x8abbec=a46_0x26a9d4;return console[_0x8abbec(0x15c)](_0x8abbec(0x15d),{'receivedSignature':_0x5c87c1,'paymentId':_0x25fc96[_0x8abbec(0x118)],'merchantPaymentId':_0x25fc96[_0x8abbec(0xff)]}),!![];}}function a46_0x4612(_0x448870,_0x46c0c7){const _0x3eb09e=a46_0x3eb0();return a46_0x4612=function(_0x46127b,_0x40d246){_0x46127b=_0x46127b-0xe8;let _0x1a3d91=_0x3eb09e[_0x46127b];return _0x1a3d91;},a46_0x4612(_0x448870,_0x46c0c7);}exports[a46_0x26a9d4(0xf2)]=NodaService;