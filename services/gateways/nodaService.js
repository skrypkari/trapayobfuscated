'use strict';const a40_0x124225=a40_0x3808;(function(_0x3be597,_0x30800e){const _0x1da7d1=a40_0x3808,_0x4f633c=_0x3be597();while(!![]){try{const _0x1a3adb=-parseInt(_0x1da7d1(0x1b3))/0x1+-parseInt(_0x1da7d1(0x1a8))/0x2*(parseInt(_0x1da7d1(0x1d8))/0x3)+parseInt(_0x1da7d1(0x1a4))/0x4+-parseInt(_0x1da7d1(0x1f1))/0x5+-parseInt(_0x1da7d1(0x1da))/0x6+-parseInt(_0x1da7d1(0x1a9))/0x7*(-parseInt(_0x1da7d1(0x217))/0x8)+parseInt(_0x1da7d1(0x208))/0x9;if(_0x1a3adb===_0x30800e)break;else _0x4f633c['push'](_0x4f633c['shift']());}catch(_0x381b98){_0x4f633c['push'](_0x4f633c['shift']());}}}(a40_0xb8cd,0x711b6));function a40_0xb8cd(){const _0x416119=['Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','(8digits-8digits\x20format)','entries','GET','statusCode','Unknown\x20error','PaymentId','https://tesoft.uk/gateway/noda/webhook/','loggerService','parse','/payment-links/','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','https://tesoft.uk/gateway/success.php?id=','PENDING','statusText','logWhiteDomainResponse','log','Noda\x20payment\x20verification\x20error:','Noda\x20API\x20error:\x20','completed','FAILED','13054815OeJRrH','noda','shortLinkUrls','Parsed\x20Result:','Noda\x20webhook\x20signature\x20verification:','logWhiteDomainRequest','processing','message','QR\x20Code\x20Link:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20NODA\x20API\x20ERROR\x20===','BankId','Error\x20details:','Payment\x20Link\x20ID:','Status\x20Code:','4768ttXbLp','Request\x20Body\x20(Direct\x20JSON):','currency','expired','Processing\x20Noda\x20webhook:','153236taurNn','HTTP\x20error!\x20status:\x20','Status:','Response\x20Body:','155110odEoRa','6440MsVIkt','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20NODA\x20SERVICE\x20ERROR\x20===','POST','Name',',\x20body:\x20','BankTransactionId','done','../loggerService','URL:','681574VBJdys','logWhiteDomainError','Amount','expiryDate','shortLink','Settled','Iban','===\x20NODA\x20SUCCESS\x20===','(8digits-8digits\x20format\x20for\x20Noda)','__esModule','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','status','HTTP\x20Status:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Failed\x20to\x20parse\x20JSON\x20response:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','paid','===\x20PARSED\x20NODA\x20RESPONSE\x20===','HTTP\x20','Error\x20stack:','apiUrl','Yes','Response\x20data:','toLowerCase','error','pending','canceled','TesSoft\x20Payment\x20System/1.0','PAID','active','Currency','Response\x20Time:','text','Error\x20Message:','Raw\x20Response\x20Body:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','SettlementDate','3uCMhHg','qrCodeLink','4098078LUmcaf','application/json','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','EXPIRED','now','isActive','json','Status\x20Text:','Order\x20ID\x20Used:','created','verifyWebhookSignature','Status','Order\x20ID\x20Format:','Unknown\x20error\x20from\x20Noda\x20API','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','stringify','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Method','NodaService','JSON\x20Parse\x20Error:\x20','/payment-links','toUpperCase','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','658680wcIIfG','defineProperty'];a40_0xb8cd=function(){return _0x416119;};return a40_0xb8cd();}function a40_0x3808(_0x1d23b9,_0x2b2eb9){const _0xb8cd18=a40_0xb8cd();return a40_0x3808=function(_0x38080d,_0xa89434){_0x38080d=_0x38080d-0x1a1;let _0x46d465=_0xb8cd18[_0x38080d];return _0x46d465;},a40_0x3808(_0x1d23b9,_0x2b2eb9);}Object[a40_0x124225(0x1f2)](exports,a40_0x124225(0x1bc),{'value':!![]}),exports[a40_0x124225(0x1ec)]=void 0x0;const loggerService_1=require(a40_0x124225(0x1b1));class NodaService{constructor(){const _0x4a1e52=a40_0x124225;this[_0x4a1e52(0x1c7)]='https://tesoft.uk/gateway/noda/',console['log'](_0x4a1e52(0x1aa));}async['createPaymentLink'](_0x3e2006){const _0x5a7b74=a40_0x124225,{orderId:_0xfbe91d,name:_0x50b69b,paymentDescription:_0x4c2cec,amount:_0x449c5b,currency:_0x31ec12,webhookUrl:_0x88420e,returnUrl:_0xfab35c,expiryDate:_0x3b80c4}=_0x3e2006,_0x29e0e4=_0x31ec12[_0x5a7b74(0x1ef)](),_0x249a8e=_0x5a7b74(0x1fa),_0xfd0b87=_0x5a7b74(0x1ff)+_0xfbe91d,_0x535e02={'name':_0x50b69b,'paymentDescription':_0x4c2cec,'amount':_0x449c5b,'currency':_0x29e0e4,'paymentId':_0xfbe91d,'webhookUrl':_0x249a8e,'returnUrl':_0xfd0b87};_0x3b80c4&&(_0x535e02[_0x5a7b74(0x1b6)]=_0x3b80c4);const _0x3d4a9a=Date[_0x5a7b74(0x1de)]();try{console[_0x5a7b74(0x203)](_0x5a7b74(0x1dc)),console['log'](_0x5a7b74(0x1b2),this['apiUrl']),console[_0x5a7b74(0x203)](_0x5a7b74(0x218),JSON[_0x5a7b74(0x1e9)](_0x535e02,null,0x2)),console['log'](_0x5a7b74(0x1e6),_0xfbe91d,_0x5a7b74(0x1bb)),loggerService_1[_0x5a7b74(0x1fb)][_0x5a7b74(0x20d)](_0x5a7b74(0x209),'/payment-links',_0x5a7b74(0x1ac),_0x535e02);const _0x1d9896=await fetch(this[_0x5a7b74(0x1c7)],{'method':_0x5a7b74(0x1ac),'headers':{'Content-Type':'application/json','Accept':_0x5a7b74(0x1db),'User-Agent':_0x5a7b74(0x1ce)},'body':JSON[_0x5a7b74(0x1e9)](_0x535e02)}),_0x16e05b=Date['now']()-_0x3d4a9a;console[_0x5a7b74(0x203)](_0x5a7b74(0x1e8)),console['log'](_0x5a7b74(0x1a6),_0x1d9896[_0x5a7b74(0x1be)]),console[_0x5a7b74(0x203)](_0x5a7b74(0x1e1),_0x1d9896[_0x5a7b74(0x201)]),console[_0x5a7b74(0x203)]('Headers:',Object['fromEntries'](_0x1d9896['headers'][_0x5a7b74(0x1f5)]())),console['log'](_0x5a7b74(0x1d2),_0x16e05b+'ms');const _0x477dcd=await _0x1d9896['text']();console[_0x5a7b74(0x203)](_0x5a7b74(0x1d5),_0x477dcd);if(!_0x1d9896['ok']){console[_0x5a7b74(0x1cb)](_0x5a7b74(0x212)),console['error'](_0x5a7b74(0x1bf),_0x1d9896['status']),console[_0x5a7b74(0x1cb)](_0x5a7b74(0x1a7),_0x477dcd),loggerService_1[_0x5a7b74(0x1fb)]['logWhiteDomainResponse'](_0x5a7b74(0x209),_0x5a7b74(0x1ee),_0x1d9896['status'],_0x477dcd,_0x16e05b),loggerService_1['loggerService']['logWhiteDomainError'](_0x5a7b74(0x209),'/payment-links',_0x5a7b74(0x1c5)+_0x1d9896[_0x5a7b74(0x1be)]+':\x20'+_0x477dcd);if(_0x1d9896[_0x5a7b74(0x1be)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x1d9896[_0x5a7b74(0x1be)]===0x1f4)throw new Error(_0x5a7b74(0x1c2));}throw new Error(_0x5a7b74(0x1a5)+_0x1d9896[_0x5a7b74(0x1be)]+_0x5a7b74(0x1ae)+_0x477dcd);}let _0x48cafa;try{_0x48cafa=JSON[_0x5a7b74(0x1fc)](_0x477dcd);}catch(_0x4ae34e){console[_0x5a7b74(0x1cb)](_0x5a7b74(0x1c1),_0x4ae34e),loggerService_1[_0x5a7b74(0x1fb)][_0x5a7b74(0x1b4)]('noda','/payment-links',_0x5a7b74(0x1ed)+_0x4ae34e);throw new Error(_0x5a7b74(0x1c0)+_0x477dcd);}console[_0x5a7b74(0x203)](_0x5a7b74(0x1c4)),console['log'](_0x5a7b74(0x20b),JSON['stringify'](_0x48cafa,null,0x2)),loggerService_1[_0x5a7b74(0x1fb)][_0x5a7b74(0x202)]('noda',_0x5a7b74(0x1ee),_0x1d9896[_0x5a7b74(0x1be)],_0x48cafa,_0x16e05b);if(_0x48cafa['error']||_0x48cafa[_0x5a7b74(0x1f7)]){const _0x160070=_0x48cafa[_0x5a7b74(0x20f)]||_0x48cafa[_0x5a7b74(0x1cb)]||_0x5a7b74(0x1e7);console[_0x5a7b74(0x1cb)](_0x5a7b74(0x1bd)),console[_0x5a7b74(0x1cb)](_0x5a7b74(0x1d4),_0x160070),console[_0x5a7b74(0x1cb)](_0x5a7b74(0x216),_0x48cafa['statusCode']),loggerService_1['loggerService'][_0x5a7b74(0x1b4)]('noda',_0x5a7b74(0x1ee),'Business\x20Error:\x20'+_0x160070);throw new Error(_0x5a7b74(0x205)+_0x160070);}if(!_0x48cafa['id']||!_0x48cafa[_0x5a7b74(0x20a)]?.['shortLink']){console[_0x5a7b74(0x1cb)](_0x5a7b74(0x211)),console[_0x5a7b74(0x1cb)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console['error'](_0x5a7b74(0x1c9),_0x48cafa),loggerService_1['loggerService'][_0x5a7b74(0x1b4)](_0x5a7b74(0x209),'/payment-links',_0x5a7b74(0x1d6));throw new Error(_0x5a7b74(0x1f0));}return console['log'](_0x5a7b74(0x1ba)),console[_0x5a7b74(0x203)](_0x5a7b74(0x215),_0x48cafa['id']),console['log']('Short\x20Link:',_0x48cafa['shortLinkUrls'][_0x5a7b74(0x1b7)]),console[_0x5a7b74(0x203)](_0x5a7b74(0x210),_0x48cafa[_0x5a7b74(0x20a)][_0x5a7b74(0x1d9)]||'Not\x20provided'),console['log'](_0x5a7b74(0x1e2),_0xfbe91d,_0x5a7b74(0x1f4)),{'gateway_payment_id':_0x48cafa['id'],'payment_url':_0x48cafa[_0x5a7b74(0x20a)][_0x5a7b74(0x1b7)],'qr_code_url':_0x48cafa[_0x5a7b74(0x20a)][_0x5a7b74(0x1d9)],'expiry_date':_0x48cafa[_0x5a7b74(0x1b6)]};}catch(_0x549c2b){console[_0x5a7b74(0x1cb)](_0x5a7b74(0x1ab)),console[_0x5a7b74(0x1cb)](_0x5a7b74(0x214),_0x549c2b),loggerService_1[_0x5a7b74(0x1fb)]['logWhiteDomainError'](_0x5a7b74(0x209),_0x5a7b74(0x1ee),_0x549c2b);if(_0x549c2b instanceof Error){console[_0x5a7b74(0x1cb)]('Error\x20message:',_0x549c2b[_0x5a7b74(0x20f)]),console['error'](_0x5a7b74(0x1c6),_0x549c2b['stack']);throw new Error(_0x5a7b74(0x1fe)+_0x549c2b[_0x5a7b74(0x20f)]);}throw new Error(_0x5a7b74(0x1f3));}}async['verifyPayment'](_0xbd540e){const _0x99f303=a40_0x124225,_0x528785=Date[_0x99f303(0x1de)]();try{loggerService_1[_0x99f303(0x1fb)][_0x99f303(0x20d)]('noda','/payment-links/'+_0xbd540e,_0x99f303(0x1f6),{});const _0xc7c05c=await fetch(this[_0x99f303(0x1c7)]+'/'+_0xbd540e,{'method':_0x99f303(0x1f6),'headers':{'Content-Type':_0x99f303(0x1db),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x4f46be=Date['now']()-_0x528785;if(!_0xc7c05c['ok']){const _0x1a3070=await _0xc7c05c[_0x99f303(0x1d3)]();loggerService_1[_0x99f303(0x1fb)]['logWhiteDomainResponse'](_0x99f303(0x209),_0x99f303(0x1fd)+_0xbd540e,_0xc7c05c[_0x99f303(0x1be)],_0x1a3070,_0x4f46be);throw new Error(_0x99f303(0x1a5)+_0xc7c05c[_0x99f303(0x1be)]);}const _0x1af872=await _0xc7c05c[_0x99f303(0x1e0)]();loggerService_1[_0x99f303(0x1fb)][_0x99f303(0x202)](_0x99f303(0x209),_0x99f303(0x1fd)+_0xbd540e,_0xc7c05c[_0x99f303(0x1be)],_0x1af872,_0x4f46be);if(_0x1af872[_0x99f303(0x1cb)]||_0x1af872[_0x99f303(0x1f7)]){loggerService_1['loggerService'][_0x99f303(0x1b4)](_0x99f303(0x209),_0x99f303(0x1fd)+_0xbd540e,_0x99f303(0x205)+(_0x1af872[_0x99f303(0x20f)]||_0x1af872[_0x99f303(0x1cb)]||'Unknown\x20error'));throw new Error(_0x99f303(0x205)+(_0x1af872['message']||_0x1af872[_0x99f303(0x1cb)]||_0x99f303(0x1f8)));}let _0x755c88=_0x99f303(0x200);if(_0x1af872['isActive']===![]){if(_0x1af872[_0x99f303(0x1b6)]){const _0x2e5703=new Date(_0x1af872[_0x99f303(0x1b6)]),_0x54950e=new Date();_0x2e5703<_0x54950e?_0x755c88='EXPIRED':_0x755c88='FAILED';}else _0x755c88=_0x99f303(0x207);}else _0x755c88=_0x99f303(0x200);return{'status':_0x755c88,'amount':_0x1af872['amount'],'currency':_0x1af872[_0x99f303(0x1a1)],'isActive':_0x1af872[_0x99f303(0x1df)]};}catch(_0x5698e7){console['error'](_0x99f303(0x204),_0x5698e7),loggerService_1['loggerService'][_0x99f303(0x1b4)]('noda',_0x99f303(0x1fd)+_0xbd540e,_0x5698e7);throw new Error(_0x99f303(0x1ea)+(_0x5698e7 instanceof Error?_0x5698e7[_0x99f303(0x20f)]:_0x99f303(0x1f8)));}}async['processWebhook'](_0x90b1c5){const _0x1e9e53=a40_0x124225;console[_0x1e9e53(0x203)](_0x1e9e53(0x1a3),_0x90b1c5);let _0x4833c6='PENDING';switch(_0x90b1c5[_0x1e9e53(0x1e5)]?.[_0x1e9e53(0x1ca)]()){case _0x1e9e53(0x1b0):case _0x1e9e53(0x206):case _0x1e9e53(0x1c3):case'success':case'successful':_0x90b1c5[_0x1e9e53(0x1b8)]===_0x1e9e53(0x1c8)?_0x4833c6=_0x1e9e53(0x1cf):_0x4833c6=_0x1e9e53(0x200);break;case'cancelled':case _0x1e9e53(0x1cd):case'failed':case _0x1e9e53(0x1cb):case'rejected':_0x4833c6=_0x1e9e53(0x207);break;case _0x1e9e53(0x1a2):case'timeout':_0x4833c6=_0x1e9e53(0x1dd);break;case _0x1e9e53(0x1cc):case _0x1e9e53(0x1e3):case _0x1e9e53(0x1d0):case _0x1e9e53(0x20e):case'in_progress':default:_0x4833c6='PENDING';break;}return{'paymentId':_0x90b1c5['MerchantPaymentId']||_0x90b1c5['PaymentId'],'status':_0x4833c6,'amount':_0x90b1c5[_0x1e9e53(0x1b5)],'currency':_0x90b1c5[_0x1e9e53(0x1d1)],'additionalInfo':{'method':_0x90b1c5[_0x1e9e53(0x1eb)],'bankId':_0x90b1c5[_0x1e9e53(0x213)],'settled':_0x90b1c5['Settled'],'settlementDate':_0x90b1c5[_0x1e9e53(0x1d7)],'remitterName':_0x90b1c5['Remitter']?.[_0x1e9e53(0x1ad)],'remitterIban':_0x90b1c5['Remitter']?.[_0x1e9e53(0x1b9)],'bankTransactionId':_0x90b1c5[_0x1e9e53(0x1af)]}};}[a40_0x124225(0x1e4)](_0x1475ce,_0x293355){const _0x214984=a40_0x124225;return console[_0x214984(0x203)](_0x214984(0x20c),{'receivedSignature':_0x293355,'paymentId':_0x1475ce[_0x214984(0x1f9)],'merchantPaymentId':_0x1475ce['MerchantPaymentId']}),!![];}}exports[a40_0x124225(0x1ec)]=NodaService;