'use strict';function a53_0x3c3f(){const _0xefd1fd=['Noda\x20API\x20error:\x20','HTTP\x20error!\x20status:\x20','fromEntries','Unknown\x20error\x20from\x20Noda\x20API','9AtjHDT','active','Status:','processWebhook','in_progress','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainError','12448719RoAgOi','cancelled','json','Noda\x20webhook\x20signature\x20verification:','Yes','log','Short\x20Link:','isActive','Status','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','PAID','/payment-links/','Order\x20ID\x20Format:','Order\x20ID\x20Used:','EXPIRED','Error\x20Message:','MerchantPaymentId','/payment-links','amount','expired','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','apiUrl','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Response\x20Body:','10qPkaKq','FAILED','Currency','138190QgBRWe','verifyWebhookSignature','stringify','1kyDplO','QR\x20Code\x20Link:','7352845WYbTjo','PENDING','Status\x20Code:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Settled','headers','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','URL:','5486144FZXnZj','shortLink','POST','done','../loggerService','Noda\x20payment\x20verification\x20error:','Headers:','Response\x20data:','GET','Not\x20provided','326156OxmPwQ','currency','===\x20NODA\x20API\x20ERROR\x20===','stack','success','pending','entries','expiryDate','https://tesoft.uk/gateway/noda/webhook/','verifyPayment','text','Error\x20message:','toUpperCase','Parsed\x20Result:','Unknown\x20error','logWhiteDomainResponse','message','BankId','status','Status\x20Text:','parse','===\x20PARSED\x20NODA\x20RESPONSE\x20===','(8digits-8digits\x20format)','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20NODA\x20SUCCESS\x20===','Iban','noda','Error\x20details:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','processing','application/json','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Remitter','https://tesoft.uk/gateway/noda/','error','PaymentId','failed','JSON\x20Parse\x20Error:\x20','logWhiteDomainRequest','Payment\x20System/1.0','defineProperty','statusCode','Request\x20Body\x20(Direct\x20JSON):','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','NodaService','Amount','now','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','qrCodeLink','Processing\x20Noda\x20webhook:','1714812OgqZZu','loggerService','successful','canceled','shortLinkUrls','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','created','BankTransactionId',',\x20body:\x20','createPaymentLink','7TTTslz','__esModule','paid','6589121avGanP'];a53_0x3c3f=function(){return _0xefd1fd;};return a53_0x3c3f();}const a53_0x54c705=a53_0x114d;(function(_0x5db1b0,_0x446ca1){const _0xe6ed1c=a53_0x114d,_0x126f35=_0x5db1b0();while(!![]){try{const _0x1dcc0c=-parseInt(_0xe6ed1c(0x15d))/0x1*(-parseInt(_0xe6ed1c(0x15a))/0x2)+-parseInt(_0xe6ed1c(0x1b6))/0x3*(parseInt(_0xe6ed1c(0x172))/0x4)+parseInt(_0xe6ed1c(0x15f))/0x5+-parseInt(_0xe6ed1c(0x1a4))/0x6+parseInt(_0xe6ed1c(0x1ae))/0x7*(parseInt(_0xe6ed1c(0x168))/0x8)+-parseInt(_0xe6ed1c(0x1bd))/0x9*(parseInt(_0xe6ed1c(0x1d5))/0xa)+parseInt(_0xe6ed1c(0x1b1))/0xb;if(_0x1dcc0c===_0x446ca1)break;else _0x126f35['push'](_0x126f35['shift']());}catch(_0x4a357){_0x126f35['push'](_0x126f35['shift']());}}}(a53_0x3c3f,0xde5f1));Object[a53_0x54c705(0x19a)](exports,a53_0x54c705(0x1af),{'value':!![]}),exports[a53_0x54c705(0x19e)]=void 0x0;function a53_0x114d(_0x3a3987,_0x34188c){const _0x3c3f6e=a53_0x3c3f();return a53_0x114d=function(_0x114dff,_0x967e75){_0x114dff=_0x114dff-0x158;let _0x4c8ebc=_0x3c3f6e[_0x114dff];return _0x4c8ebc;},a53_0x114d(_0x3a3987,_0x34188c);}const loggerService_1=require(a53_0x54c705(0x16c));class NodaService{constructor(){const _0x35fadd=a53_0x54c705;this[_0x35fadd(0x1d2)]=_0x35fadd(0x193),console['log'](_0x35fadd(0x189));}async[a53_0x54c705(0x1ad)](_0x4e5975){const _0x8f5bb2=a53_0x54c705,{orderId:_0x42f945,name:_0x157a15,paymentDescription:_0x4124b4,amount:_0x32e93b,currency:_0x1d7a85,webhookUrl:_0x30795c,returnUrl:_0x8a45a8,expiryDate:_0x39e0b}=_0x4e5975,_0x519740=_0x1d7a85[_0x8f5bb2(0x17e)](),_0x28a6b5=_0x8f5bb2(0x17a),_0x513684='https://tesoft.uk/gateway/pending.php?id='+_0x42f945,_0x3a2ceb={'name':_0x157a15,'paymentDescription':_0x4124b4,'amount':_0x32e93b,'currency':_0x519740,'paymentId':_0x42f945,'webhookUrl':_0x28a6b5,'returnUrl':_0x513684};_0x39e0b&&(_0x3a2ceb['expiryDate']=_0x39e0b);const _0x1c7926=Date[_0x8f5bb2(0x1a0)]();try{console[_0x8f5bb2(0x1c2)](_0x8f5bb2(0x1a1)),console[_0x8f5bb2(0x1c2)](_0x8f5bb2(0x167),this[_0x8f5bb2(0x1d2)]),console[_0x8f5bb2(0x1c2)](_0x8f5bb2(0x19c),JSON[_0x8f5bb2(0x15c)](_0x3a2ceb,null,0x2)),console[_0x8f5bb2(0x1c2)](_0x8f5bb2(0x1c9),_0x42f945,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x8f5bb2(0x1c2)](_0x8f5bb2(0x19d),_0x513684),loggerService_1[_0x8f5bb2(0x1a5)][_0x8f5bb2(0x198)](_0x8f5bb2(0x18c),_0x8f5bb2(0x1ce),_0x8f5bb2(0x16a),_0x3a2ceb);const _0x374cfb=await fetch(this[_0x8f5bb2(0x1d2)],{'method':_0x8f5bb2(0x16a),'headers':{'Content-Type':_0x8f5bb2(0x190),'Accept':'application/json','User-Agent':_0x8f5bb2(0x199)},'body':JSON[_0x8f5bb2(0x15c)](_0x3a2ceb)}),_0xdb77df=Date[_0x8f5bb2(0x1a0)]()-_0x1c7926;console['log'](_0x8f5bb2(0x1d3)),console[_0x8f5bb2(0x1c2)](_0x8f5bb2(0x1b8),_0x374cfb[_0x8f5bb2(0x184)]),console['log'](_0x8f5bb2(0x185),_0x374cfb['statusText']),console[_0x8f5bb2(0x1c2)](_0x8f5bb2(0x16e),Object[_0x8f5bb2(0x1b4)](_0x374cfb[_0x8f5bb2(0x164)][_0x8f5bb2(0x178)]())),console[_0x8f5bb2(0x1c2)]('Response\x20Time:',_0xdb77df+'ms');const _0x896f15=await _0x374cfb[_0x8f5bb2(0x17c)]();console['log']('Raw\x20Response\x20Body:',_0x896f15);if(!_0x374cfb['ok']){console[_0x8f5bb2(0x194)](_0x8f5bb2(0x174)),console[_0x8f5bb2(0x194)]('HTTP\x20Status:',_0x374cfb[_0x8f5bb2(0x184)]),console[_0x8f5bb2(0x194)](_0x8f5bb2(0x1d4),_0x896f15),loggerService_1[_0x8f5bb2(0x1a5)][_0x8f5bb2(0x181)](_0x8f5bb2(0x18c),'/payment-links',_0x374cfb['status'],_0x896f15,_0xdb77df),loggerService_1[_0x8f5bb2(0x1a5)][_0x8f5bb2(0x1bc)](_0x8f5bb2(0x18c),_0x8f5bb2(0x1ce),'HTTP\x20'+_0x374cfb[_0x8f5bb2(0x184)]+':\x20'+_0x896f15);if(_0x374cfb[_0x8f5bb2(0x184)]===0x190)throw new Error(_0x8f5bb2(0x18e));else{if(_0x374cfb[_0x8f5bb2(0x184)]===0x1f4)throw new Error(_0x8f5bb2(0x1c6));}throw new Error(_0x8f5bb2(0x1b3)+_0x374cfb[_0x8f5bb2(0x184)]+_0x8f5bb2(0x1ac)+_0x896f15);}let _0x48f4ba;try{_0x48f4ba=JSON[_0x8f5bb2(0x186)](_0x896f15);}catch(_0x429ab8){console[_0x8f5bb2(0x194)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x429ab8),loggerService_1[_0x8f5bb2(0x1a5)]['logWhiteDomainError'](_0x8f5bb2(0x18c),_0x8f5bb2(0x1ce),_0x8f5bb2(0x197)+_0x429ab8);throw new Error(_0x8f5bb2(0x165)+_0x896f15);}console[_0x8f5bb2(0x1c2)](_0x8f5bb2(0x187)),console['log'](_0x8f5bb2(0x17f),JSON[_0x8f5bb2(0x15c)](_0x48f4ba,null,0x2)),loggerService_1[_0x8f5bb2(0x1a5)][_0x8f5bb2(0x181)](_0x8f5bb2(0x18c),'/payment-links',_0x374cfb[_0x8f5bb2(0x184)],_0x48f4ba,_0xdb77df);if(_0x48f4ba[_0x8f5bb2(0x194)]||_0x48f4ba[_0x8f5bb2(0x19b)]){const _0x10a874=_0x48f4ba[_0x8f5bb2(0x182)]||_0x48f4ba[_0x8f5bb2(0x194)]||_0x8f5bb2(0x1b5);console[_0x8f5bb2(0x194)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x8f5bb2(0x194)](_0x8f5bb2(0x1cc),_0x10a874),console[_0x8f5bb2(0x194)](_0x8f5bb2(0x161),_0x48f4ba['statusCode']),loggerService_1[_0x8f5bb2(0x1a5)][_0x8f5bb2(0x1bc)]('noda',_0x8f5bb2(0x1ce),'Business\x20Error:\x20'+_0x10a874);throw new Error(_0x8f5bb2(0x1b2)+_0x10a874);}if(!_0x48f4ba['id']||!_0x48f4ba['shortLinkUrls']?.[_0x8f5bb2(0x169)]){console[_0x8f5bb2(0x194)](_0x8f5bb2(0x1bb)),console['error']('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x8f5bb2(0x194)](_0x8f5bb2(0x16f),_0x48f4ba),loggerService_1[_0x8f5bb2(0x1a5)][_0x8f5bb2(0x1bc)](_0x8f5bb2(0x18c),_0x8f5bb2(0x1ce),_0x8f5bb2(0x191));throw new Error(_0x8f5bb2(0x166));}return console[_0x8f5bb2(0x1c2)](_0x8f5bb2(0x18a)),console['log']('Payment\x20Link\x20ID:',_0x48f4ba['id']),console['log'](_0x8f5bb2(0x1c3),_0x48f4ba[_0x8f5bb2(0x1a8)][_0x8f5bb2(0x169)]),console['log'](_0x8f5bb2(0x15e),_0x48f4ba[_0x8f5bb2(0x1a8)][_0x8f5bb2(0x1a2)]||_0x8f5bb2(0x171)),console[_0x8f5bb2(0x1c2)](_0x8f5bb2(0x1ca),_0x42f945,_0x8f5bb2(0x188)),console[_0x8f5bb2(0x1c2)](_0x8f5bb2(0x1a9),_0x513684),{'gateway_payment_id':_0x48f4ba['id'],'payment_url':_0x48f4ba[_0x8f5bb2(0x1a8)]['shortLink'],'qr_code_url':_0x48f4ba[_0x8f5bb2(0x1a8)][_0x8f5bb2(0x1a2)],'expiry_date':_0x48f4ba[_0x8f5bb2(0x179)]};}catch(_0x1e98bc){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x8f5bb2(0x194)](_0x8f5bb2(0x18d),_0x1e98bc),loggerService_1[_0x8f5bb2(0x1a5)][_0x8f5bb2(0x1bc)]('noda',_0x8f5bb2(0x1ce),_0x1e98bc);if(_0x1e98bc instanceof Error){console[_0x8f5bb2(0x194)](_0x8f5bb2(0x17d),_0x1e98bc[_0x8f5bb2(0x182)]),console['error']('Error\x20stack:',_0x1e98bc[_0x8f5bb2(0x175)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x1e98bc[_0x8f5bb2(0x182)]);}throw new Error(_0x8f5bb2(0x1d1));}}async[a53_0x54c705(0x17b)](_0xf82e98){const _0x52c5ae=a53_0x54c705,_0x57e11e=Date[_0x52c5ae(0x1a0)]();try{loggerService_1[_0x52c5ae(0x1a5)]['logWhiteDomainRequest']('noda','/payment-links/'+_0xf82e98,_0x52c5ae(0x170),{});const _0x25d3ef=await fetch(this['apiUrl']+'/'+_0xf82e98,{'method':_0x52c5ae(0x170),'headers':{'Content-Type':_0x52c5ae(0x190),'User-Agent':_0x52c5ae(0x199)}}),_0x73596f=Date[_0x52c5ae(0x1a0)]()-_0x57e11e;if(!_0x25d3ef['ok']){const _0x474f5a=await _0x25d3ef['text']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x52c5ae(0x18c),_0x52c5ae(0x1c8)+_0xf82e98,_0x25d3ef[_0x52c5ae(0x184)],_0x474f5a,_0x73596f);throw new Error(_0x52c5ae(0x1b3)+_0x25d3ef[_0x52c5ae(0x184)]);}const _0x26a22e=await _0x25d3ef[_0x52c5ae(0x1bf)]();loggerService_1[_0x52c5ae(0x1a5)][_0x52c5ae(0x181)](_0x52c5ae(0x18c),_0x52c5ae(0x1c8)+_0xf82e98,_0x25d3ef['status'],_0x26a22e,_0x73596f);if(_0x26a22e['error']||_0x26a22e['statusCode']){loggerService_1[_0x52c5ae(0x1a5)][_0x52c5ae(0x1bc)](_0x52c5ae(0x18c),_0x52c5ae(0x1c8)+_0xf82e98,_0x52c5ae(0x1b2)+(_0x26a22e[_0x52c5ae(0x182)]||_0x26a22e[_0x52c5ae(0x194)]||_0x52c5ae(0x180)));throw new Error(_0x52c5ae(0x1b2)+(_0x26a22e[_0x52c5ae(0x182)]||_0x26a22e[_0x52c5ae(0x194)]||_0x52c5ae(0x180)));}let _0x399c0a=_0x52c5ae(0x160);if(_0x26a22e[_0x52c5ae(0x1c4)]===![]){if(_0x26a22e[_0x52c5ae(0x179)]){const _0x136fb7=new Date(_0x26a22e['expiryDate']),_0xcd71c8=new Date();_0x136fb7<_0xcd71c8?_0x399c0a='EXPIRED':_0x399c0a=_0x52c5ae(0x158);}else _0x399c0a=_0x52c5ae(0x158);}else _0x399c0a=_0x52c5ae(0x160);return{'status':_0x399c0a,'amount':_0x26a22e[_0x52c5ae(0x1cf)],'currency':_0x26a22e[_0x52c5ae(0x173)],'isActive':_0x26a22e[_0x52c5ae(0x1c4)]};}catch(_0x5bfe99){console[_0x52c5ae(0x194)](_0x52c5ae(0x16d),_0x5bfe99),loggerService_1[_0x52c5ae(0x1a5)][_0x52c5ae(0x1bc)](_0x52c5ae(0x18c),_0x52c5ae(0x1c8)+_0xf82e98,_0x5bfe99);throw new Error(_0x52c5ae(0x162)+(_0x5bfe99 instanceof Error?_0x5bfe99[_0x52c5ae(0x182)]:'Unknown\x20error'));}}async[a53_0x54c705(0x1b9)](_0x280007){const _0x1e2702=a53_0x54c705;console[_0x1e2702(0x1c2)](_0x1e2702(0x1a3),_0x280007);let _0x1499e5=_0x1e2702(0x160);switch(_0x280007[_0x1e2702(0x1c5)]?.['toLowerCase']()){case _0x1e2702(0x16b):case'completed':case _0x1e2702(0x1b0):case _0x1e2702(0x176):case _0x1e2702(0x1a6):_0x280007[_0x1e2702(0x163)]===_0x1e2702(0x1c1)?_0x1499e5=_0x1e2702(0x1c7):_0x1499e5=_0x1e2702(0x160);break;case _0x1e2702(0x1be):case _0x1e2702(0x1a7):case _0x1e2702(0x196):case _0x1e2702(0x194):case'rejected':_0x1499e5=_0x1e2702(0x158);break;case _0x1e2702(0x1d0):case'timeout':_0x1499e5=_0x1e2702(0x1cb);break;case _0x1e2702(0x177):case _0x1e2702(0x1aa):case _0x1e2702(0x1b7):case _0x1e2702(0x18f):case _0x1e2702(0x1ba):default:_0x1499e5='PENDING';break;}return{'paymentId':_0x280007[_0x1e2702(0x1cd)]||_0x280007[_0x1e2702(0x195)],'status':_0x1499e5,'amount':_0x280007[_0x1e2702(0x19f)],'currency':_0x280007[_0x1e2702(0x159)],'additionalInfo':{'method':_0x280007['Method'],'bankId':_0x280007[_0x1e2702(0x183)],'settled':_0x280007[_0x1e2702(0x163)],'settlementDate':_0x280007['SettlementDate'],'remitterName':_0x280007[_0x1e2702(0x192)]?.['Name'],'remitterIban':_0x280007['Remitter']?.[_0x1e2702(0x18b)],'bankTransactionId':_0x280007[_0x1e2702(0x1ab)]}};}[a53_0x54c705(0x15b)](_0x3edca5,_0x393737){const _0x55c924=a53_0x54c705;return console[_0x55c924(0x1c2)](_0x55c924(0x1c0),{'receivedSignature':_0x393737,'paymentId':_0x3edca5['PaymentId'],'merchantPaymentId':_0x3edca5[_0x55c924(0x1cd)]}),!![];}}exports['NodaService']=NodaService;