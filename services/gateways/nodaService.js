'use strict';const a53_0x239b74=a53_0x5dec;(function(_0x59b5c7,_0x1a80a4){const _0x4cf082=a53_0x5dec,_0x40efe5=_0x59b5c7();while(!![]){try{const _0x43dae5=parseInt(_0x4cf082(0x114))/0x1+-parseInt(_0x4cf082(0x12d))/0x2+-parseInt(_0x4cf082(0xfc))/0x3+parseInt(_0x4cf082(0x137))/0x4*(parseInt(_0x4cf082(0x14f))/0x5)+-parseInt(_0x4cf082(0x149))/0x6*(-parseInt(_0x4cf082(0x12b))/0x7)+parseInt(_0x4cf082(0x146))/0x8+-parseInt(_0x4cf082(0x129))/0x9*(-parseInt(_0x4cf082(0x127))/0xa);if(_0x43dae5===_0x1a80a4)break;else _0x40efe5['push'](_0x40efe5['shift']());}catch(_0x1c090){_0x40efe5['push'](_0x40efe5['shift']());}}}(a53_0x172b,0x373e3));function a53_0x172b(){const _0xc4d299=['===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','apiUrl','now','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','BankId','PaymentId','Yes','Settled','POST',',\x20body:\x20','Missing\x20id\x20or\x20shortLink\x20in\x20response','entries','stack','completed','263650gSQXqY','GET','18WLqPMD','Unknown\x20error\x20from\x20Noda\x20API','21wIitQO','created','41778Ltemcg','SettlementDate','/payment-links','expiryDate','createPaymentLink','HTTP\x20error!\x20status:\x20','Amount','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','active','stringify','133748pRQSwQ','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Payment\x20System/1.0','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','logWhiteDomainRequest','Remitter','Request\x20Body\x20(Direct\x20JSON):','Name','loggerService','shortLinkUrls','Payment\x20Link\x20ID:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Status','../loggerService','status','868504vuFuhw','Iban','canceled','166206alDeZD','application/json','MerchantPaymentId','cancelled','expired','PENDING','5AczFMZ','processing','Order\x20ID\x20Used:','Status\x20Code:','noda','fromEntries','(8digits-8digits\x20format\x20for\x20Noda)','/payment-links/','failed','Error\x20Message:','https://tesoft.uk/gateway/noda/webhook/','Method','Response\x20data:','verifyPayment','https://tesoft.uk/gateway/pending.php?id=','headers','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','processWebhook','FAILED','logWhiteDomainError','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','NodaService','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Business\x20Error:\x20','message','statusCode','Response\x20Body:','Currency','Raw\x20Response\x20Body:','Noda\x20payment\x20verification\x20error:','__esModule','rejected','statusText','Status\x20Text:','logWhiteDomainResponse','===\x20NODA\x20SERVICE\x20ERROR\x20===','===\x20NODA\x20SUCCESS\x20===','241386lbwlmD','pending','Processing\x20Noda\x20webhook:','Parsed\x20Result:','Headers:','HTTP\x20Status:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','timeout','Status:','Noda\x20webhook\x20signature\x20verification:','text','Failed\x20to\x20parse\x20JSON\x20response:','parse','done','error','Noda\x20API\x20error:\x20','in_progress','log','(8digits-8digits\x20format)','shortLink','qrCodeLink','https://tesoft.uk/gateway/noda/','toLowerCase','amount','49793JgourK','Response\x20Time:','Unknown\x20error','paid','EXPIRED'];a53_0x172b=function(){return _0xc4d299;};return a53_0x172b();}Object['defineProperty'](exports,a53_0x239b74(0xf5),{'value':!![]}),exports[a53_0x239b74(0x164)]=void 0x0;const loggerService_1=require(a53_0x239b74(0x144));function a53_0x5dec(_0x3cbb3b,_0x4f4712){const _0x172bc7=a53_0x172b();return a53_0x5dec=function(_0x5deccd,_0x43e651){_0x5deccd=_0x5deccd-0xf0;let _0x9311f6=_0x172bc7[_0x5deccd];return _0x9311f6;},a53_0x5dec(_0x3cbb3b,_0x4f4712);}class NodaService{constructor(){const _0x58b69b=a53_0x239b74;this[_0x58b69b(0x11a)]=_0x58b69b(0x111),console[_0x58b69b(0x10d)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a53_0x239b74(0x131)](_0x3d1a52){const _0x45b6dd=a53_0x239b74,{orderId:_0x5aea96,name:_0x12c63d,paymentDescription:_0x407824,amount:_0x55adfa,currency:_0x49cb24,webhookUrl:_0x1b2f74,returnUrl:_0x45b48a,expiryDate:_0x5a1031}=_0x3d1a52,_0x173b2a=_0x49cb24['toUpperCase'](),_0x4ecf48=_0x45b6dd(0x159),_0x30b08d=_0x45b6dd(0x15d)+_0x5aea96,_0xee920a={'name':_0x12c63d,'paymentDescription':_0x407824,'amount':_0x55adfa,'currency':_0x173b2a,'paymentId':_0x5aea96,'webhookUrl':_0x4ecf48,'returnUrl':_0x30b08d};_0x5a1031&&(_0xee920a[_0x45b6dd(0x130)]=_0x5a1031);const _0x42a919=Date[_0x45b6dd(0x11b)]();try{console[_0x45b6dd(0x10d)](_0x45b6dd(0x119)),console['log']('URL:',this[_0x45b6dd(0x11a)]),console[_0x45b6dd(0x10d)](_0x45b6dd(0x13d),JSON[_0x45b6dd(0x136)](_0xee920a,null,0x2)),console[_0x45b6dd(0x10d)]('Order\x20ID\x20Format:',_0x5aea96,_0x45b6dd(0x155)),console[_0x45b6dd(0x10d)](_0x45b6dd(0x13a),_0x30b08d),loggerService_1['loggerService'][_0x45b6dd(0x13b)](_0x45b6dd(0x153),'/payment-links','POST',_0xee920a);const _0xe65e81=await fetch(this[_0x45b6dd(0x11a)],{'method':_0x45b6dd(0x121),'headers':{'Content-Type':_0x45b6dd(0x14a),'Accept':_0x45b6dd(0x14a),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x45b6dd(0x136)](_0xee920a)}),_0xb9e26d=Date['now']()-_0x42a919;console[_0x45b6dd(0x10d)](_0x45b6dd(0x163)),console['log'](_0x45b6dd(0x104),_0xe65e81[_0x45b6dd(0x145)]),console['log'](_0x45b6dd(0xf8),_0xe65e81[_0x45b6dd(0xf7)]),console['log'](_0x45b6dd(0x100),Object[_0x45b6dd(0x154)](_0xe65e81[_0x45b6dd(0x15e)][_0x45b6dd(0x124)]())),console['log'](_0x45b6dd(0x115),_0xb9e26d+'ms');const _0x43a51c=await _0xe65e81[_0x45b6dd(0x106)]();console[_0x45b6dd(0x10d)](_0x45b6dd(0xf3),_0x43a51c);if(!_0xe65e81['ok']){console[_0x45b6dd(0x10a)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x45b6dd(0x10a)](_0x45b6dd(0x101),_0xe65e81[_0x45b6dd(0x145)]),console[_0x45b6dd(0x10a)](_0x45b6dd(0xf1),_0x43a51c),loggerService_1[_0x45b6dd(0x13f)][_0x45b6dd(0xf9)]('noda',_0x45b6dd(0x12f),_0xe65e81['status'],_0x43a51c,_0xb9e26d),loggerService_1[_0x45b6dd(0x13f)][_0x45b6dd(0x162)]('noda',_0x45b6dd(0x12f),'HTTP\x20'+_0xe65e81[_0x45b6dd(0x145)]+':\x20'+_0x43a51c);if(_0xe65e81['status']===0x190)throw new Error(_0x45b6dd(0x142));else{if(_0xe65e81[_0x45b6dd(0x145)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x45b6dd(0x132)+_0xe65e81[_0x45b6dd(0x145)]+_0x45b6dd(0x122)+_0x43a51c);}let _0x58f6a9;try{_0x58f6a9=JSON[_0x45b6dd(0x108)](_0x43a51c);}catch(_0x27d97a){console[_0x45b6dd(0x10a)](_0x45b6dd(0x107),_0x27d97a),loggerService_1[_0x45b6dd(0x13f)][_0x45b6dd(0x162)]('noda',_0x45b6dd(0x12f),'JSON\x20Parse\x20Error:\x20'+_0x27d97a);throw new Error(_0x45b6dd(0x15f)+_0x43a51c);}console[_0x45b6dd(0x10d)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x45b6dd(0x10d)](_0x45b6dd(0xff),JSON[_0x45b6dd(0x136)](_0x58f6a9,null,0x2)),loggerService_1[_0x45b6dd(0x13f)]['logWhiteDomainResponse'](_0x45b6dd(0x153),'/payment-links',_0xe65e81['status'],_0x58f6a9,_0xb9e26d);if(_0x58f6a9[_0x45b6dd(0x10a)]||_0x58f6a9[_0x45b6dd(0xf0)]){const _0x5893b3=_0x58f6a9[_0x45b6dd(0x167)]||_0x58f6a9[_0x45b6dd(0x10a)]||_0x45b6dd(0x12a);console[_0x45b6dd(0x10a)](_0x45b6dd(0x165)),console[_0x45b6dd(0x10a)](_0x45b6dd(0x158),_0x5893b3),console[_0x45b6dd(0x10a)](_0x45b6dd(0x152),_0x58f6a9[_0x45b6dd(0xf0)]),loggerService_1[_0x45b6dd(0x13f)][_0x45b6dd(0x162)](_0x45b6dd(0x153),_0x45b6dd(0x12f),_0x45b6dd(0x166)+_0x5893b3);throw new Error('Noda\x20API\x20error:\x20'+_0x5893b3);}if(!_0x58f6a9['id']||!_0x58f6a9[_0x45b6dd(0x140)]?.['shortLink']){console[_0x45b6dd(0x10a)](_0x45b6dd(0x102)),console[_0x45b6dd(0x10a)](_0x45b6dd(0x123)),console['error'](_0x45b6dd(0x15b),_0x58f6a9),loggerService_1[_0x45b6dd(0x13f)][_0x45b6dd(0x162)]('noda',_0x45b6dd(0x12f),_0x45b6dd(0x138));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console['log'](_0x45b6dd(0xfb)),console[_0x45b6dd(0x10d)](_0x45b6dd(0x141),_0x58f6a9['id']),console[_0x45b6dd(0x10d)]('Short\x20Link:',_0x58f6a9[_0x45b6dd(0x140)][_0x45b6dd(0x10f)]),console['log']('QR\x20Code\x20Link:',_0x58f6a9['shortLinkUrls'][_0x45b6dd(0x110)]||'Not\x20provided'),console[_0x45b6dd(0x10d)](_0x45b6dd(0x151),_0x5aea96,_0x45b6dd(0x10e)),console[_0x45b6dd(0x10d)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x30b08d),{'gateway_payment_id':_0x58f6a9['id'],'payment_url':_0x58f6a9[_0x45b6dd(0x140)][_0x45b6dd(0x10f)],'qr_code_url':_0x58f6a9['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x58f6a9[_0x45b6dd(0x130)]};}catch(_0x53f767){console[_0x45b6dd(0x10a)](_0x45b6dd(0xfa)),console[_0x45b6dd(0x10a)]('Error\x20details:',_0x53f767),loggerService_1[_0x45b6dd(0x13f)][_0x45b6dd(0x162)](_0x45b6dd(0x153),_0x45b6dd(0x12f),_0x53f767);if(_0x53f767 instanceof Error){console['error']('Error\x20message:',_0x53f767['message']),console[_0x45b6dd(0x10a)]('Error\x20stack:',_0x53f767[_0x45b6dd(0x125)]);throw new Error(_0x45b6dd(0x134)+_0x53f767[_0x45b6dd(0x167)]);}throw new Error(_0x45b6dd(0x11c));}}async[a53_0x239b74(0x15c)](_0x2e8aa7){const _0x370c3c=a53_0x239b74,_0x123575=Date['now']();try{loggerService_1[_0x370c3c(0x13f)][_0x370c3c(0x13b)]('noda',_0x370c3c(0x156)+_0x2e8aa7,'GET',{});const _0x34757e=await fetch(this[_0x370c3c(0x11a)]+'/'+_0x2e8aa7,{'method':_0x370c3c(0x128),'headers':{'Content-Type':'application/json','User-Agent':_0x370c3c(0x139)}}),_0x562b02=Date[_0x370c3c(0x11b)]()-_0x123575;if(!_0x34757e['ok']){const _0x393934=await _0x34757e[_0x370c3c(0x106)]();loggerService_1['loggerService'][_0x370c3c(0xf9)]('noda',_0x370c3c(0x156)+_0x2e8aa7,_0x34757e['status'],_0x393934,_0x562b02);throw new Error(_0x370c3c(0x132)+_0x34757e['status']);}const _0x451d05=await _0x34757e['json']();loggerService_1[_0x370c3c(0x13f)][_0x370c3c(0xf9)](_0x370c3c(0x153),'/payment-links/'+_0x2e8aa7,_0x34757e[_0x370c3c(0x145)],_0x451d05,_0x562b02);if(_0x451d05['error']||_0x451d05[_0x370c3c(0xf0)]){loggerService_1[_0x370c3c(0x13f)]['logWhiteDomainError'](_0x370c3c(0x153),_0x370c3c(0x156)+_0x2e8aa7,_0x370c3c(0x10b)+(_0x451d05['message']||_0x451d05[_0x370c3c(0x10a)]||'Unknown\x20error'));throw new Error(_0x370c3c(0x10b)+(_0x451d05[_0x370c3c(0x167)]||_0x451d05[_0x370c3c(0x10a)]||_0x370c3c(0x116)));}let _0x3b32c6=_0x370c3c(0x14e);if(_0x451d05['isActive']===![]){if(_0x451d05[_0x370c3c(0x130)]){const _0x107486=new Date(_0x451d05[_0x370c3c(0x130)]),_0x1b1d8b=new Date();_0x107486<_0x1b1d8b?_0x3b32c6=_0x370c3c(0x118):_0x3b32c6=_0x370c3c(0x161);}else _0x3b32c6='FAILED';}else _0x3b32c6=_0x370c3c(0x14e);return{'status':_0x3b32c6,'amount':_0x451d05[_0x370c3c(0x113)],'currency':_0x451d05['currency'],'isActive':_0x451d05['isActive']};}catch(_0x42e0fe){console[_0x370c3c(0x10a)](_0x370c3c(0xf4),_0x42e0fe),loggerService_1[_0x370c3c(0x13f)]['logWhiteDomainError']('noda',_0x370c3c(0x156)+_0x2e8aa7,_0x42e0fe);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x42e0fe instanceof Error?_0x42e0fe[_0x370c3c(0x167)]:_0x370c3c(0x116)));}}async[a53_0x239b74(0x160)](_0x5adaeb){const _0x2b27da=a53_0x239b74;console[_0x2b27da(0x10d)](_0x2b27da(0xfe),_0x5adaeb);let _0x54fd89='PENDING';switch(_0x5adaeb[_0x2b27da(0x143)]?.[_0x2b27da(0x112)]()){case _0x2b27da(0x109):case _0x2b27da(0x126):case _0x2b27da(0x117):case'success':case'successful':_0x5adaeb[_0x2b27da(0x120)]===_0x2b27da(0x11f)?_0x54fd89='PAID':_0x54fd89='PENDING';break;case _0x2b27da(0x14c):case _0x2b27da(0x148):case _0x2b27da(0x157):case _0x2b27da(0x10a):case _0x2b27da(0xf6):_0x54fd89='FAILED';break;case _0x2b27da(0x14d):case _0x2b27da(0x103):_0x54fd89='EXPIRED';break;case _0x2b27da(0xfd):case _0x2b27da(0x12c):case _0x2b27da(0x135):case _0x2b27da(0x150):case _0x2b27da(0x10c):default:_0x54fd89='PENDING';break;}return{'paymentId':_0x5adaeb[_0x2b27da(0x14b)]||_0x5adaeb['PaymentId'],'status':_0x54fd89,'amount':_0x5adaeb[_0x2b27da(0x133)],'currency':_0x5adaeb[_0x2b27da(0xf2)],'additionalInfo':{'method':_0x5adaeb[_0x2b27da(0x15a)],'bankId':_0x5adaeb[_0x2b27da(0x11d)],'settled':_0x5adaeb[_0x2b27da(0x120)],'settlementDate':_0x5adaeb[_0x2b27da(0x12e)],'remitterName':_0x5adaeb[_0x2b27da(0x13c)]?.[_0x2b27da(0x13e)],'remitterIban':_0x5adaeb['Remitter']?.[_0x2b27da(0x147)],'bankTransactionId':_0x5adaeb['BankTransactionId']}};}['verifyWebhookSignature'](_0x3be824,_0x259a77){const _0x2215c5=a53_0x239b74;return console[_0x2215c5(0x10d)](_0x2215c5(0x105),{'receivedSignature':_0x259a77,'paymentId':_0x3be824[_0x2215c5(0x11e)],'merchantPaymentId':_0x3be824[_0x2215c5(0x14b)]}),!![];}}exports[a53_0x239b74(0x164)]=NodaService;