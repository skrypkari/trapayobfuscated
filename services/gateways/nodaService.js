'use strict';function a43_0x5118(_0x1e6566,_0x25515e){const _0x1c2ae8=a43_0x1c2a();return a43_0x5118=function(_0x51189d,_0x53429f){_0x51189d=_0x51189d-0xa4;let _0x2cd742=_0x1c2ae8[_0x51189d];return _0x2cd742;},a43_0x5118(_0x1e6566,_0x25515e);}const a43_0x40a87e=a43_0x5118;function a43_0x1c2a(){const _0xccbf67=['headers','expiryDate','Short\x20Link:','timeout','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Failed\x20to\x20parse\x20JSON\x20response:','Status','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','defineProperty','MerchantPaymentId','Error\x20Message:','1480088JaDUex','Response\x20data:','done','toUpperCase','362700vgeIpK','statusCode','Response\x20Body:','logWhiteDomainResponse',',\x20body:\x20','qrCodeLink','EXPIRED','toLowerCase','Status:','https://tesoft.uk/gateway/pending.php?id=','PaymentId','/payment-links/','===\x20NODA\x20API\x20ERROR\x20===','1448160mFVBfh','190935IQHrbV','Payment\x20Link\x20ID:','cancelled','Settled','createPaymentLink','pending','successful','processing','Headers:','loggerService','canceled','completed','shortLink','/payment-links','paid','expired','===\x20PARSED\x20NODA\x20RESPONSE\x20===','URL:','Not\x20provided','Method','stringify','12jZdfHj','logWhiteDomainRequest','HTTP\x20error!\x20status:\x20','created','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','logWhiteDomainError','statusText','entries','Error\x20stack:','PENDING','Name','Missing\x20id\x20or\x20shortLink\x20in\x20response','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Noda\x20API\x20error:\x20','shortLinkUrls','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Iban','verifyWebhookSignature','currency','noda','FAILED','620525atkhjO','JSON\x20Parse\x20Error:\x20','../loggerService','(8digits-8digits\x20format)','QR\x20Code\x20Link:','Noda\x20payment\x20verification\x20error:','amount','POST','HTTP\x20Status:','Order\x20ID\x20Format:','Amount','Status\x20Text:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','text','parse','Status\x20Code:','Unknown\x20error','isActive','NodaService','https://tesoft.uk/gateway/noda/webhook/','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','in_progress','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Order\x20ID\x20Used:','7564CzkLiS','message','verifyPayment','error','(8digits-8digits\x20format\x20for\x20Noda)','https://tesoft.uk/gateway/noda/','Response\x20Time:','BankId','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','active','GET','BankTransactionId','status','551532HGyfMu','===\x20NODA\x20SERVICE\x20ERROR\x20===','Failed\x20to\x20verify\x20Noda\x20payment:\x20','success','log','Parsed\x20Result:','Business\x20Error:\x20','application/json','now','TesSoft\x20Payment\x20System/1.0','fromEntries','Error\x20message:','apiUrl','HTTP\x20','62cgcTDW','Noda\x20webhook\x20signature\x20verification:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink'];a43_0x1c2a=function(){return _0xccbf67;};return a43_0x1c2a();}(function(_0x1973e7,_0x1d051a){const _0x328f5f=a43_0x5118,_0xbee608=_0x1973e7();while(!![]){try{const _0x2d17b2=-parseInt(_0x328f5f(0xee))/0x1*(parseInt(_0x328f5f(0x10a))/0x2)+parseInt(_0x328f5f(0xfc))/0x3+parseInt(_0x328f5f(0xc1))/0x4*(parseInt(_0x328f5f(0xd6))/0x5)+-parseInt(_0x328f5f(0x11c))/0x6+parseInt(_0x328f5f(0xab))/0x7+-parseInt(_0x328f5f(0x118))/0x8+parseInt(_0x328f5f(0xac))/0x9;if(_0x2d17b2===_0x1d051a)break;else _0xbee608['push'](_0xbee608['shift']());}catch(_0x10c11d){_0xbee608['push'](_0xbee608['shift']());}}}(a43_0x1c2a,0x4a4b5));Object[a43_0x40a87e(0x115)](exports,'__esModule',{'value':!![]}),exports[a43_0x40a87e(0xe8)]=void 0x0;const loggerService_1=require(a43_0x40a87e(0xd8));class NodaService{constructor(){const _0x5ae78d=a43_0x40a87e;this[_0x5ae78d(0x108)]=_0x5ae78d(0xf3),console[_0x5ae78d(0x100)](_0x5ae78d(0xf6));}async[a43_0x40a87e(0xb0)](_0x100e85){const _0x39e105=a43_0x40a87e,{orderId:_0x125654,name:_0x9866ac,paymentDescription:_0xc1a996,amount:_0xac016c,currency:_0x25d907,webhookUrl:_0x45c898,returnUrl:_0x480634,expiryDate:_0x3ec1e0}=_0x100e85,_0x11014a=_0x25d907[_0x39e105(0x11b)](),_0x22d292=_0x39e105(0xe9),_0x381d09=_0x39e105(0xa7)+_0x125654,_0x4e0238={'name':_0x9866ac,'paymentDescription':_0xc1a996,'amount':_0xac016c,'currency':_0x11014a,'paymentId':_0x125654,'webhookUrl':_0x22d292,'returnUrl':_0x381d09};_0x3ec1e0&&(_0x4e0238[_0x39e105(0x10e)]=_0x3ec1e0);const _0x2dac6c=Date[_0x39e105(0x104)]();try{console[_0x39e105(0x100)](_0x39e105(0xe2)),console['log'](_0x39e105(0xbd),this[_0x39e105(0x108)]),console[_0x39e105(0x100)]('Request\x20Body\x20(Direct\x20JSON):',JSON['stringify'](_0x4e0238,null,0x2)),console['log'](_0x39e105(0xdf),_0x125654,_0x39e105(0xf2)),console[_0x39e105(0x100)](_0x39e105(0xec),_0x381d09),loggerService_1[_0x39e105(0xb5)][_0x39e105(0xc2)](_0x39e105(0xd4),_0x39e105(0xb9),_0x39e105(0xdd),_0x4e0238);const _0x340a19=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x39e105(0x103),'Accept':'application/json','User-Agent':_0x39e105(0x105)},'body':JSON[_0x39e105(0xc0)](_0x4e0238)}),_0x4c97ce=Date[_0x39e105(0x104)]()-_0x2dac6c;console[_0x39e105(0x100)](_0x39e105(0x111)),console[_0x39e105(0x100)](_0x39e105(0xa6),_0x340a19[_0x39e105(0xfb)]),console[_0x39e105(0x100)](_0x39e105(0xe1),_0x340a19[_0x39e105(0xc7)]),console[_0x39e105(0x100)](_0x39e105(0xb4),Object[_0x39e105(0x106)](_0x340a19[_0x39e105(0x10d)][_0x39e105(0xc8)]())),console[_0x39e105(0x100)](_0x39e105(0xf4),_0x4c97ce+'ms');const _0x313cbd=await _0x340a19[_0x39e105(0xe3)]();console[_0x39e105(0x100)]('Raw\x20Response\x20Body:',_0x313cbd);if(!_0x340a19['ok']){console[_0x39e105(0xf1)](_0x39e105(0xaa)),console['error'](_0x39e105(0xde),_0x340a19['status']),console[_0x39e105(0xf1)](_0x39e105(0x11e),_0x313cbd),loggerService_1['loggerService'][_0x39e105(0x11f)](_0x39e105(0xd4),_0x39e105(0xb9),_0x340a19['status'],_0x313cbd,_0x4c97ce),loggerService_1['loggerService'][_0x39e105(0xc6)](_0x39e105(0xd4),_0x39e105(0xb9),_0x39e105(0x109)+_0x340a19[_0x39e105(0xfb)]+':\x20'+_0x313cbd);if(_0x340a19[_0x39e105(0xfb)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x340a19['status']===0x1f4)throw new Error(_0x39e105(0xd0));}throw new Error(_0x39e105(0xc3)+_0x340a19['status']+_0x39e105(0x120)+_0x313cbd);}let _0x5dc5f3;try{_0x5dc5f3=JSON[_0x39e105(0xe4)](_0x313cbd);}catch(_0x5672ea){console['error'](_0x39e105(0x112),_0x5672ea),loggerService_1['loggerService'][_0x39e105(0xc6)](_0x39e105(0xd4),_0x39e105(0xb9),_0x39e105(0xd7)+_0x5672ea);throw new Error(_0x39e105(0xcd)+_0x313cbd);}console[_0x39e105(0x100)](_0x39e105(0xbc)),console[_0x39e105(0x100)](_0x39e105(0x101),JSON[_0x39e105(0xc0)](_0x5dc5f3,null,0x2)),loggerService_1[_0x39e105(0xb5)][_0x39e105(0x11f)](_0x39e105(0xd4),_0x39e105(0xb9),_0x340a19[_0x39e105(0xfb)],_0x5dc5f3,_0x4c97ce);if(_0x5dc5f3['error']||_0x5dc5f3['statusCode']){const _0x4defcf=_0x5dc5f3[_0x39e105(0xef)]||_0x5dc5f3[_0x39e105(0xf1)]||'Unknown\x20error\x20from\x20Noda\x20API';console['error']('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x39e105(0x117),_0x4defcf),console[_0x39e105(0xf1)](_0x39e105(0xe5),_0x5dc5f3[_0x39e105(0x11d)]),loggerService_1[_0x39e105(0xb5)][_0x39e105(0xc6)](_0x39e105(0xd4),_0x39e105(0xb9),_0x39e105(0x102)+_0x4defcf);throw new Error(_0x39e105(0xce)+_0x4defcf);}if(!_0x5dc5f3['id']||!_0x5dc5f3[_0x39e105(0xcf)]?.[_0x39e105(0xb8)]){console[_0x39e105(0xf1)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x39e105(0xf1)](_0x39e105(0xcc)),console[_0x39e105(0xf1)](_0x39e105(0x119),_0x5dc5f3),loggerService_1[_0x39e105(0xb5)]['logWhiteDomainError'](_0x39e105(0xd4),_0x39e105(0xb9),_0x39e105(0xf7));throw new Error(_0x39e105(0x10c));}return console[_0x39e105(0x100)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x39e105(0x100)](_0x39e105(0xad),_0x5dc5f3['id']),console[_0x39e105(0x100)](_0x39e105(0x10f),_0x5dc5f3[_0x39e105(0xcf)]['shortLink']),console[_0x39e105(0x100)](_0x39e105(0xda),_0x5dc5f3[_0x39e105(0xcf)][_0x39e105(0x121)]||_0x39e105(0xbe)),console[_0x39e105(0x100)](_0x39e105(0xed),_0x125654,_0x39e105(0xd9)),console[_0x39e105(0x100)](_0x39e105(0xc5),_0x381d09),{'gateway_payment_id':_0x5dc5f3['id'],'payment_url':_0x5dc5f3['shortLinkUrls'][_0x39e105(0xb8)],'qr_code_url':_0x5dc5f3[_0x39e105(0xcf)][_0x39e105(0x121)],'expiry_date':_0x5dc5f3['expiryDate']};}catch(_0x4d4baf){console['error'](_0x39e105(0xfd)),console['error']('Error\x20details:',_0x4d4baf),loggerService_1[_0x39e105(0xb5)]['logWhiteDomainError'](_0x39e105(0xd4),_0x39e105(0xb9),_0x4d4baf);if(_0x4d4baf instanceof Error){console[_0x39e105(0xf1)](_0x39e105(0x107),_0x4d4baf[_0x39e105(0xef)]),console[_0x39e105(0xf1)](_0x39e105(0xc9),_0x4d4baf['stack']);throw new Error(_0x39e105(0xea)+_0x4d4baf[_0x39e105(0xef)]);}throw new Error(_0x39e105(0x114));}}async[a43_0x40a87e(0xf0)](_0x3c9e3a){const _0x36e2eb=a43_0x40a87e,_0x20ce17=Date[_0x36e2eb(0x104)]();try{loggerService_1[_0x36e2eb(0xb5)][_0x36e2eb(0xc2)](_0x36e2eb(0xd4),_0x36e2eb(0xa9)+_0x3c9e3a,_0x36e2eb(0xf9),{});const _0xeebe50=await fetch(this['apiUrl']+'/'+_0x3c9e3a,{'method':_0x36e2eb(0xf9),'headers':{'Content-Type':_0x36e2eb(0x103),'User-Agent':_0x36e2eb(0x105)}}),_0x2dbef0=Date[_0x36e2eb(0x104)]()-_0x20ce17;if(!_0xeebe50['ok']){const _0x5378a6=await _0xeebe50[_0x36e2eb(0xe3)]();loggerService_1[_0x36e2eb(0xb5)][_0x36e2eb(0x11f)](_0x36e2eb(0xd4),_0x36e2eb(0xa9)+_0x3c9e3a,_0xeebe50[_0x36e2eb(0xfb)],_0x5378a6,_0x2dbef0);throw new Error(_0x36e2eb(0xc3)+_0xeebe50[_0x36e2eb(0xfb)]);}const _0x3415fc=await _0xeebe50['json']();loggerService_1[_0x36e2eb(0xb5)][_0x36e2eb(0x11f)](_0x36e2eb(0xd4),_0x36e2eb(0xa9)+_0x3c9e3a,_0xeebe50[_0x36e2eb(0xfb)],_0x3415fc,_0x2dbef0);if(_0x3415fc[_0x36e2eb(0xf1)]||_0x3415fc['statusCode']){loggerService_1[_0x36e2eb(0xb5)][_0x36e2eb(0xc6)](_0x36e2eb(0xd4),_0x36e2eb(0xa9)+_0x3c9e3a,_0x36e2eb(0xce)+(_0x3415fc[_0x36e2eb(0xef)]||_0x3415fc[_0x36e2eb(0xf1)]||_0x36e2eb(0xe6)));throw new Error(_0x36e2eb(0xce)+(_0x3415fc['message']||_0x3415fc[_0x36e2eb(0xf1)]||'Unknown\x20error'));}let _0x3829e9=_0x36e2eb(0xca);if(_0x3415fc[_0x36e2eb(0xe7)]===![]){if(_0x3415fc[_0x36e2eb(0x10e)]){const _0x11f258=new Date(_0x3415fc['expiryDate']),_0x2b0bce=new Date();_0x11f258<_0x2b0bce?_0x3829e9=_0x36e2eb(0xa4):_0x3829e9=_0x36e2eb(0xd5);}else _0x3829e9=_0x36e2eb(0xd5);}else _0x3829e9=_0x36e2eb(0xca);return{'status':_0x3829e9,'amount':_0x3415fc[_0x36e2eb(0xdc)],'currency':_0x3415fc[_0x36e2eb(0xd3)],'isActive':_0x3415fc['isActive']};}catch(_0x2b458a){console[_0x36e2eb(0xf1)](_0x36e2eb(0xdb),_0x2b458a),loggerService_1[_0x36e2eb(0xb5)][_0x36e2eb(0xc6)](_0x36e2eb(0xd4),_0x36e2eb(0xa9)+_0x3c9e3a,_0x2b458a);throw new Error(_0x36e2eb(0xfe)+(_0x2b458a instanceof Error?_0x2b458a[_0x36e2eb(0xef)]:_0x36e2eb(0xe6)));}}async['processWebhook'](_0x5d7cd4){const _0x4f97e2=a43_0x40a87e;console[_0x4f97e2(0x100)]('Processing\x20Noda\x20webhook:',_0x5d7cd4);let _0x1f7207='PENDING';switch(_0x5d7cd4[_0x4f97e2(0x113)]?.[_0x4f97e2(0xa5)]()){case _0x4f97e2(0x11a):case _0x4f97e2(0xb7):case _0x4f97e2(0xba):case _0x4f97e2(0xff):case _0x4f97e2(0xb2):_0x5d7cd4[_0x4f97e2(0xaf)]==='Yes'?_0x1f7207='PAID':_0x1f7207=_0x4f97e2(0xca);break;case _0x4f97e2(0xae):case _0x4f97e2(0xb6):case'failed':case _0x4f97e2(0xf1):case'rejected':_0x1f7207='FAILED';break;case _0x4f97e2(0xbb):case _0x4f97e2(0x110):_0x1f7207=_0x4f97e2(0xa4);break;case _0x4f97e2(0xb1):case _0x4f97e2(0xc4):case _0x4f97e2(0xf8):case _0x4f97e2(0xb3):case _0x4f97e2(0xeb):default:_0x1f7207=_0x4f97e2(0xca);break;}return{'paymentId':_0x5d7cd4[_0x4f97e2(0x116)]||_0x5d7cd4['PaymentId'],'status':_0x1f7207,'amount':_0x5d7cd4[_0x4f97e2(0xe0)],'currency':_0x5d7cd4['Currency'],'additionalInfo':{'method':_0x5d7cd4[_0x4f97e2(0xbf)],'bankId':_0x5d7cd4[_0x4f97e2(0xf5)],'settled':_0x5d7cd4['Settled'],'settlementDate':_0x5d7cd4['SettlementDate'],'remitterName':_0x5d7cd4['Remitter']?.[_0x4f97e2(0xcb)],'remitterIban':_0x5d7cd4['Remitter']?.[_0x4f97e2(0xd1)],'bankTransactionId':_0x5d7cd4[_0x4f97e2(0xfa)]}};}[a43_0x40a87e(0xd2)](_0x2cf5d1,_0x5cc0ba){const _0x30104e=a43_0x40a87e;return console[_0x30104e(0x100)](_0x30104e(0x10b),{'receivedSignature':_0x5cc0ba,'paymentId':_0x2cf5d1[_0x30104e(0xa8)],'merchantPaymentId':_0x2cf5d1[_0x30104e(0x116)]}),!![];}}exports[a43_0x40a87e(0xe8)]=NodaService;