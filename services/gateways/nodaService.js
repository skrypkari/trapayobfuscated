'use strict';const a43_0x18d7f7=a43_0x1ed8;function a43_0x3dc5(){const _0x5229e8=['canceled','Missing\x20id\x20or\x20shortLink\x20in\x20response','HTTP\x20error!\x20status:\x20','1921230qsbSMF','verifyWebhookSignature','POST','createPaymentLink','verifyPayment','3859821EArFks','logWhiteDomainRequest','21sabAgg','984826gMXKBu','BankTransactionId','application/json','currency','rejected','success','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','created','198988IYywgO','headers','HTTP\x20','expiryDate','Status\x20Text:','active','TesSoft\x20Payment\x20System/1.0','now','Currency','Error\x20stack:','Noda\x20API\x20error:\x20','EXPIRED','Remitter','https://tesoft.uk/gateway/pending.php?id=','status','Response\x20Body:','===\x20NODA\x20API\x20ERROR\x20===','627370fntvRj','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Failed\x20to\x20verify\x20Noda\x20payment:\x20','PaymentId','Raw\x20Response\x20Body:','Unknown\x20error\x20from\x20Noda\x20API','Not\x20provided','===\x20NODA\x20SERVICE\x20ERROR\x20===','error','Yes','defineProperty','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','log','/payment-links/','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','qrCodeLink','in_progress','parse','expired','Method','PAID','QR\x20Code\x20Link:','Unknown\x20error','MerchantPaymentId','Name','failed','paid','Error\x20Message:','successful','FAILED','noda','Status\x20Code:','PENDING','statusText','/payment-links','pending','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Settled','toLowerCase','Response\x20Time:','text','Processing\x20Noda\x20webhook:','isActive','Iban','stringify','URL:','NodaService','(8digits-8digits\x20format)','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','8142lHcJAY','shortLinkUrls','logWhiteDomainResponse','Order\x20ID\x20Format:','Failed\x20to\x20parse\x20JSON\x20response:','__esModule','json','amount','Noda\x20webhook\x20signature\x20verification:','timeout','statusCode','shortLink','fromEntries','completed','logWhiteDomainError','GET','Noda\x20payment\x20verification\x20error:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Error\x20message:','https://tesoft.uk/gateway/noda/webhook/','message','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Status:','Headers:','391643BQMImr','apiUrl','Business\x20Error:\x20','cancelled','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','413jUQPWl','entries','processWebhook','8MPNlUd','loggerService','HTTP\x20Status:','SettlementDate'];a43_0x3dc5=function(){return _0x5229e8;};return a43_0x3dc5();}(function(_0x5d0557,_0x22b013){const _0x49f472=a43_0x1ed8,_0x234342=_0x5d0557();while(!![]){try{const _0x420ecf=-parseInt(_0x49f472(0xba))/0x1+parseInt(_0x49f472(0xd1))/0x2+-parseInt(_0x49f472(0xd0))/0x3*(-parseInt(_0x49f472(0xd9))/0x4)+parseInt(_0x49f472(0xea))/0x5+-parseInt(_0x49f472(0x11c))/0x6*(parseInt(_0x49f472(0xbf))/0x7)+-parseInt(_0x49f472(0xc2))/0x8*(parseInt(_0x49f472(0xce))/0x9)+parseInt(_0x49f472(0xc9))/0xa;if(_0x420ecf===_0x22b013)break;else _0x234342['push'](_0x234342['shift']());}catch(_0x37a49c){_0x234342['push'](_0x234342['shift']());}}}(a43_0x3dc5,0x3ee80));Object[a43_0x18d7f7(0xf4)](exports,a43_0x18d7f7(0xa7),{'value':!![]}),exports[a43_0x18d7f7(0x119)]=void 0x0;const loggerService_1=require('../loggerService');function a43_0x1ed8(_0x567714,_0x447d23){const _0x3dc53e=a43_0x3dc5();return a43_0x1ed8=function(_0x1ed8d1,_0x19638e){_0x1ed8d1=_0x1ed8d1-0xa7;let _0xc5318c=_0x3dc53e[_0x1ed8d1];return _0xc5318c;},a43_0x1ed8(_0x567714,_0x447d23);}class NodaService{constructor(){const _0x43f1b5=a43_0x18d7f7;this[_0x43f1b5(0xbb)]='https://tesoft.uk/gateway/noda/',console[_0x43f1b5(0xf7)](_0x43f1b5(0xb7));}async[a43_0x18d7f7(0xcc)](_0x1dd45c){const _0x34a728=a43_0x18d7f7,{orderId:_0x3c645d,name:_0x39e86b,paymentDescription:_0x4f9889,amount:_0xa1c7be,currency:_0x3046d2,webhookUrl:_0x1dddac,returnUrl:_0x28ba2b,expiryDate:_0x17713f}=_0x1dd45c,_0x115ce9=_0x3046d2['toUpperCase'](),_0x34fcd5=_0x34a728(0xb5),_0x4ad595=_0x34a728(0xe6)+_0x3c645d,_0x1d7809={'name':_0x39e86b,'paymentDescription':_0x4f9889,'amount':_0xa1c7be,'currency':_0x115ce9,'paymentId':_0x3c645d,'webhookUrl':_0x34fcd5,'returnUrl':_0x4ad595};_0x17713f&&(_0x1d7809[_0x34a728(0xdc)]=_0x17713f);const _0x1c8006=Date['now']();try{console['log'](_0x34a728(0xf6)),console[_0x34a728(0xf7)](_0x34a728(0x118),this[_0x34a728(0xbb)]),console['log']('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x34a728(0x117)](_0x1d7809,null,0x2)),console[_0x34a728(0xf7)](_0x34a728(0x11f),_0x3c645d,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x34a728(0xf7)](_0x34a728(0x11b),_0x4ad595),loggerService_1[_0x34a728(0xc3)][_0x34a728(0xcf)](_0x34a728(0x109),_0x34a728(0x10d),'POST',_0x1d7809);const _0x26566f=await fetch(this[_0x34a728(0xbb)],{'method':_0x34a728(0xcb),'headers':{'Content-Type':_0x34a728(0xd3),'Accept':_0x34a728(0xd3),'User-Agent':_0x34a728(0xdf)},'body':JSON['stringify'](_0x1d7809)}),_0x5c615d=Date[_0x34a728(0xe0)]()-_0x1c8006;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x34a728(0xf7)](_0x34a728(0xb8),_0x26566f[_0x34a728(0xe7)]),console[_0x34a728(0xf7)](_0x34a728(0xdd),_0x26566f[_0x34a728(0x10c)]),console[_0x34a728(0xf7)](_0x34a728(0xb9),Object[_0x34a728(0xae)](_0x26566f[_0x34a728(0xda)][_0x34a728(0xc0)]())),console[_0x34a728(0xf7)](_0x34a728(0x112),_0x5c615d+'ms');const _0x4002b8=await _0x26566f[_0x34a728(0x113)]();console['log'](_0x34a728(0xee),_0x4002b8);if(!_0x26566f['ok']){console[_0x34a728(0xf2)](_0x34a728(0xe9)),console['error'](_0x34a728(0xc4),_0x26566f[_0x34a728(0xe7)]),console[_0x34a728(0xf2)](_0x34a728(0xe8),_0x4002b8),loggerService_1[_0x34a728(0xc3)]['logWhiteDomainResponse'](_0x34a728(0x109),_0x34a728(0x10d),_0x26566f['status'],_0x4002b8,_0x5c615d),loggerService_1[_0x34a728(0xc3)]['logWhiteDomainError']('noda',_0x34a728(0x10d),_0x34a728(0xdb)+_0x26566f[_0x34a728(0xe7)]+':\x20'+_0x4002b8);if(_0x26566f[_0x34a728(0xe7)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x26566f[_0x34a728(0xe7)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x34a728(0xc8)+_0x26566f[_0x34a728(0xe7)]+',\x20body:\x20'+_0x4002b8);}let _0x447ba8;try{_0x447ba8=JSON[_0x34a728(0xfc)](_0x4002b8);}catch(_0x2b8d82){console[_0x34a728(0xf2)](_0x34a728(0x120),_0x2b8d82),loggerService_1[_0x34a728(0xc3)][_0x34a728(0xb0)](_0x34a728(0x109),'/payment-links','JSON\x20Parse\x20Error:\x20'+_0x2b8d82);throw new Error(_0x34a728(0x10f)+_0x4002b8);}console[_0x34a728(0xf7)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x34a728(0xf7)]('Parsed\x20Result:',JSON['stringify'](_0x447ba8,null,0x2)),loggerService_1[_0x34a728(0xc3)][_0x34a728(0x11e)]('noda','/payment-links',_0x26566f[_0x34a728(0xe7)],_0x447ba8,_0x5c615d);if(_0x447ba8[_0x34a728(0xf2)]||_0x447ba8[_0x34a728(0xac)]){const _0x55e844=_0x447ba8[_0x34a728(0xb6)]||_0x447ba8[_0x34a728(0xf2)]||_0x34a728(0xef);console[_0x34a728(0xf2)](_0x34a728(0xf5)),console[_0x34a728(0xf2)](_0x34a728(0x106),_0x55e844),console[_0x34a728(0xf2)](_0x34a728(0x10a),_0x447ba8[_0x34a728(0xac)]),loggerService_1[_0x34a728(0xc3)][_0x34a728(0xb0)](_0x34a728(0x109),_0x34a728(0x10d),_0x34a728(0xbc)+_0x55e844);throw new Error(_0x34a728(0xe3)+_0x55e844);}if(!_0x447ba8['id']||!_0x447ba8[_0x34a728(0x11d)]?.[_0x34a728(0xad)]){console[_0x34a728(0xf2)](_0x34a728(0xd7)),console[_0x34a728(0xf2)](_0x34a728(0xc7)),console[_0x34a728(0xf2)]('Response\x20data:',_0x447ba8),loggerService_1[_0x34a728(0xc3)][_0x34a728(0xb0)](_0x34a728(0x109),_0x34a728(0x10d),_0x34a728(0xbe));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console[_0x34a728(0xf7)]('Payment\x20Link\x20ID:',_0x447ba8['id']),console[_0x34a728(0xf7)]('Short\x20Link:',_0x447ba8[_0x34a728(0x11d)][_0x34a728(0xad)]),console[_0x34a728(0xf7)](_0x34a728(0x100),_0x447ba8[_0x34a728(0x11d)][_0x34a728(0xfa)]||_0x34a728(0xf0)),console[_0x34a728(0xf7)]('Order\x20ID\x20Used:',_0x3c645d,_0x34a728(0x11a)),console[_0x34a728(0xf7)](_0x34a728(0xb3),_0x4ad595),{'gateway_payment_id':_0x447ba8['id'],'payment_url':_0x447ba8['shortLinkUrls'][_0x34a728(0xad)],'qr_code_url':_0x447ba8[_0x34a728(0x11d)]['qrCodeLink'],'expiry_date':_0x447ba8[_0x34a728(0xdc)]};}catch(_0x29b976){console[_0x34a728(0xf2)](_0x34a728(0xf1)),console['error']('Error\x20details:',_0x29b976),loggerService_1['loggerService']['logWhiteDomainError'](_0x34a728(0x109),_0x34a728(0x10d),_0x29b976);if(_0x29b976 instanceof Error){console['error'](_0x34a728(0xb4),_0x29b976['message']),console[_0x34a728(0xf2)](_0x34a728(0xe2),_0x29b976['stack']);throw new Error(_0x34a728(0xf9)+_0x29b976[_0x34a728(0xb6)]);}throw new Error(_0x34a728(0xeb));}}async[a43_0x18d7f7(0xcd)](_0x3ae7a4){const _0x37be36=a43_0x18d7f7,_0x4b642a=Date[_0x37be36(0xe0)]();try{loggerService_1[_0x37be36(0xc3)][_0x37be36(0xcf)](_0x37be36(0x109),_0x37be36(0xf8)+_0x3ae7a4,'GET',{});const _0x279376=await fetch(this['apiUrl']+'/'+_0x3ae7a4,{'method':_0x37be36(0xb1),'headers':{'Content-Type':_0x37be36(0xd3),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x14a2b1=Date[_0x37be36(0xe0)]()-_0x4b642a;if(!_0x279376['ok']){const _0x17d5a2=await _0x279376[_0x37be36(0x113)]();loggerService_1[_0x37be36(0xc3)][_0x37be36(0x11e)]('noda',_0x37be36(0xf8)+_0x3ae7a4,_0x279376[_0x37be36(0xe7)],_0x17d5a2,_0x14a2b1);throw new Error(_0x37be36(0xc8)+_0x279376[_0x37be36(0xe7)]);}const _0x5e0ef9=await _0x279376[_0x37be36(0xa8)]();loggerService_1[_0x37be36(0xc3)][_0x37be36(0x11e)](_0x37be36(0x109),'/payment-links/'+_0x3ae7a4,_0x279376[_0x37be36(0xe7)],_0x5e0ef9,_0x14a2b1);if(_0x5e0ef9[_0x37be36(0xf2)]||_0x5e0ef9[_0x37be36(0xac)]){loggerService_1[_0x37be36(0xc3)][_0x37be36(0xb0)](_0x37be36(0x109),_0x37be36(0xf8)+_0x3ae7a4,_0x37be36(0xe3)+(_0x5e0ef9[_0x37be36(0xb6)]||_0x5e0ef9[_0x37be36(0xf2)]||'Unknown\x20error'));throw new Error(_0x37be36(0xe3)+(_0x5e0ef9[_0x37be36(0xb6)]||_0x5e0ef9[_0x37be36(0xf2)]||_0x37be36(0x101)));}let _0x5a909c='PENDING';if(_0x5e0ef9[_0x37be36(0x115)]===![]){if(_0x5e0ef9[_0x37be36(0xdc)]){const _0x34040a=new Date(_0x5e0ef9['expiryDate']),_0x4e3501=new Date();_0x34040a<_0x4e3501?_0x5a909c=_0x37be36(0xe4):_0x5a909c=_0x37be36(0x108);}else _0x5a909c='FAILED';}else _0x5a909c=_0x37be36(0x10b);return{'status':_0x5a909c,'amount':_0x5e0ef9[_0x37be36(0xa9)],'currency':_0x5e0ef9[_0x37be36(0xd4)],'isActive':_0x5e0ef9[_0x37be36(0x115)]};}catch(_0x56aa81){console[_0x37be36(0xf2)](_0x37be36(0xb2),_0x56aa81),loggerService_1[_0x37be36(0xc3)]['logWhiteDomainError'](_0x37be36(0x109),_0x37be36(0xf8)+_0x3ae7a4,_0x56aa81);throw new Error(_0x37be36(0xec)+(_0x56aa81 instanceof Error?_0x56aa81['message']:_0x37be36(0x101)));}}async[a43_0x18d7f7(0xc1)](_0x5f4aff){const _0x1927d0=a43_0x18d7f7;console[_0x1927d0(0xf7)](_0x1927d0(0x114),_0x5f4aff);let _0xdb45cc='PENDING';switch(_0x5f4aff['Status']?.[_0x1927d0(0x111)]()){case'done':case _0x1927d0(0xaf):case _0x1927d0(0x105):case _0x1927d0(0xd6):case _0x1927d0(0x107):_0x5f4aff[_0x1927d0(0x110)]===_0x1927d0(0xf3)?_0xdb45cc=_0x1927d0(0xff):_0xdb45cc='PENDING';break;case _0x1927d0(0xbd):case _0x1927d0(0xc6):case _0x1927d0(0x104):case'error':case _0x1927d0(0xd5):_0xdb45cc=_0x1927d0(0x108);break;case _0x1927d0(0xfd):case _0x1927d0(0xab):_0xdb45cc=_0x1927d0(0xe4);break;case _0x1927d0(0x10e):case _0x1927d0(0xd8):case _0x1927d0(0xde):case'processing':case _0x1927d0(0xfb):default:_0xdb45cc=_0x1927d0(0x10b);break;}return{'paymentId':_0x5f4aff[_0x1927d0(0x102)]||_0x5f4aff[_0x1927d0(0xed)],'status':_0xdb45cc,'amount':_0x5f4aff['Amount'],'currency':_0x5f4aff[_0x1927d0(0xe1)],'additionalInfo':{'method':_0x5f4aff[_0x1927d0(0xfe)],'bankId':_0x5f4aff['BankId'],'settled':_0x5f4aff[_0x1927d0(0x110)],'settlementDate':_0x5f4aff[_0x1927d0(0xc5)],'remitterName':_0x5f4aff[_0x1927d0(0xe5)]?.[_0x1927d0(0x103)],'remitterIban':_0x5f4aff['Remitter']?.[_0x1927d0(0x116)],'bankTransactionId':_0x5f4aff[_0x1927d0(0xd2)]}};}[a43_0x18d7f7(0xca)](_0xfd2077,_0x152b7e){const _0x375341=a43_0x18d7f7;return console['log'](_0x375341(0xaa),{'receivedSignature':_0x152b7e,'paymentId':_0xfd2077[_0x375341(0xed)],'merchantPaymentId':_0xfd2077['MerchantPaymentId']}),!![];}}exports[a43_0x18d7f7(0x119)]=NodaService;