'use strict';const a53_0x35a537=a53_0x2f06;(function(_0x2e147e,_0x2070ab){const _0x8536f8=a53_0x2f06,_0x4a0862=_0x2e147e();while(!![]){try{const _0xb6c791=parseInt(_0x8536f8(0x131))/0x1*(parseInt(_0x8536f8(0xd5))/0x2)+-parseInt(_0x8536f8(0xc6))/0x3+parseInt(_0x8536f8(0xe7))/0x4*(-parseInt(_0x8536f8(0xd7))/0x5)+parseInt(_0x8536f8(0xdb))/0x6*(parseInt(_0x8536f8(0x105))/0x7)+-parseInt(_0x8536f8(0xe5))/0x8*(parseInt(_0x8536f8(0x135))/0x9)+-parseInt(_0x8536f8(0xd9))/0xa*(parseInt(_0x8536f8(0xe0))/0xb)+parseInt(_0x8536f8(0x12f))/0xc*(parseInt(_0x8536f8(0xd2))/0xd);if(_0xb6c791===_0x2070ab)break;else _0x4a0862['push'](_0x4a0862['shift']());}catch(_0x5d2758){_0x4a0862['push'](_0x4a0862['shift']());}}}(a53_0x38d0,0x34bed));function a53_0x38d0(){const _0x6277d=['message','done','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','829665jccRfU','HTTP\x20Status:','shortLinkUrls','MerchantPaymentId','HTTP\x20error!\x20status:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','active','noda','Settled','rejected','shortLink','paid','496301LrQxFb','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','createPaymentLink','314zJRBVY','EXPIRED','1150OZVGGc','Payment\x20Link\x20ID:','140ipZlSS','Noda\x20API\x20error:\x20','60fQwUZB','PENDING','QR\x20Code\x20Link:','fromEntries','FAILED','258170cPJHPh','BankId','status','HTTP\x20','logWhiteDomainError','8bfgmny','Unknown\x20error\x20from\x20Noda\x20API','344avOIqe','Remitter','successful','Noda\x20payment\x20verification\x20error:','Noda\x20webhook\x20signature\x20verification:','text','__esModule','https://tesoft.uk/gateway/pending.php?id=','Parsed\x20Result:','expiryDate','completed','logWhiteDomainResponse','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Request\x20Body\x20(Direct\x20JSON):','../loggerService','cancelled','isActive','NodaService','(8digits-8digits\x20format)','Response\x20Body:','Processing\x20Noda\x20webhook:','headers','PAID','success','Not\x20provided','Order\x20ID\x20Format:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Currency','timeout','currency','128653XsDvXF','Missing\x20id\x20or\x20shortLink\x20in\x20response','Failed\x20to\x20parse\x20JSON\x20response:','SettlementDate','Order\x20ID\x20Used:','stack','Business\x20Error:\x20','error','Method','Payment\x20System/1.0','application/json','in_progress','now','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','verifyPayment','https://tesoft.uk/gateway/noda/','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','stringify','statusCode','Error\x20message:','Error\x20stack:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','/payment-links','logWhiteDomainRequest','log','URL:','pending','===\x20NODA\x20SERVICE\x20ERROR\x20===','defineProperty','Status\x20Code:','statusText','toLowerCase','loggerService','apiUrl','/payment-links/','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Unknown\x20error','(8digits-8digits\x20format\x20for\x20Noda)','Iban','GET','entries','Error\x20Message:','108nvredB','processWebhook','2707fBxmar','Response\x20data:','BankTransactionId','json','1002798IkTAyl','toUpperCase','POST','PaymentId','canceled','Yes','qrCodeLink'];a53_0x38d0=function(){return _0x6277d;};return a53_0x38d0();}Object[a53_0x35a537(0x121)](exports,a53_0x35a537(0xed),{'value':!![]}),exports[a53_0x35a537(0xf8)]=void 0x0;const loggerService_1=require(a53_0x35a537(0xf5));class NodaService{constructor(){const _0x2ead01=a53_0x35a537;this[_0x2ead01(0x126)]=_0x2ead01(0x114),console['log'](_0x2ead01(0x128));}async[a53_0x35a537(0xd4)](_0x318c52){const _0x26cf65=a53_0x35a537,{orderId:_0x2b90a0,name:_0x2eab26,paymentDescription:_0x59f787,amount:_0xd3c372,currency:_0x5d0aeb,webhookUrl:_0x585872,returnUrl:_0x368939,expiryDate:_0x4998db}=_0x318c52,_0x26baa7=_0x5d0aeb[_0x26cf65(0x136)](),_0x4d2249='https://tesoft.uk/gateway/noda/webhook/',_0x47cd75=_0x26cf65(0xee)+_0x2b90a0,_0x148194={'name':_0x2eab26,'paymentDescription':_0x59f787,'amount':_0xd3c372,'currency':_0x26baa7,'paymentId':_0x2b90a0,'webhookUrl':_0x4d2249,'returnUrl':_0x47cd75};_0x4998db&&(_0x148194[_0x26cf65(0xf0)]=_0x4998db);const _0x19c84b=Date[_0x26cf65(0x111)]();try{console[_0x26cf65(0x11d)](_0x26cf65(0xd3)),console[_0x26cf65(0x11d)](_0x26cf65(0x11e),this[_0x26cf65(0x126)]),console[_0x26cf65(0x11d)](_0x26cf65(0xf4),JSON[_0x26cf65(0x116)](_0x148194,null,0x2)),console[_0x26cf65(0x11d)](_0x26cf65(0x100),_0x2b90a0,_0x26cf65(0x12a)),console[_0x26cf65(0x11d)](_0x26cf65(0xf3),_0x47cd75),loggerService_1[_0x26cf65(0x125)][_0x26cf65(0x11c)](_0x26cf65(0xcd),_0x26cf65(0x11b),_0x26cf65(0x137),_0x148194);const _0x2a2ec8=await fetch(this[_0x26cf65(0x126)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x26cf65(0x10f),'User-Agent':_0x26cf65(0x10e)},'body':JSON[_0x26cf65(0x116)](_0x148194)}),_0x3680ef=Date[_0x26cf65(0x111)]()-_0x19c84b;console[_0x26cf65(0x11d)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x26cf65(0x11d)]('Status:',_0x2a2ec8[_0x26cf65(0xe2)]),console['log']('Status\x20Text:',_0x2a2ec8[_0x26cf65(0x123)]),console[_0x26cf65(0x11d)]('Headers:',Object[_0x26cf65(0xde)](_0x2a2ec8[_0x26cf65(0xfc)][_0x26cf65(0x12d)]())),console[_0x26cf65(0x11d)]('Response\x20Time:',_0x3680ef+'ms');const _0x4fbb6e=await _0x2a2ec8[_0x26cf65(0xec)]();console[_0x26cf65(0x11d)]('Raw\x20Response\x20Body:',_0x4fbb6e);if(!_0x2a2ec8['ok']){console[_0x26cf65(0x10c)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x26cf65(0x10c)](_0x26cf65(0xc7),_0x2a2ec8['status']),console[_0x26cf65(0x10c)](_0x26cf65(0xfa),_0x4fbb6e),loggerService_1[_0x26cf65(0x125)][_0x26cf65(0xf2)](_0x26cf65(0xcd),_0x26cf65(0x11b),_0x2a2ec8[_0x26cf65(0xe2)],_0x4fbb6e,_0x3680ef),loggerService_1[_0x26cf65(0x125)]['logWhiteDomainError'](_0x26cf65(0xcd),'/payment-links',_0x26cf65(0xe3)+_0x2a2ec8[_0x26cf65(0xe2)]+':\x20'+_0x4fbb6e);if(_0x2a2ec8['status']===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x2a2ec8[_0x26cf65(0xe2)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x26cf65(0xca)+_0x2a2ec8[_0x26cf65(0xe2)]+',\x20body:\x20'+_0x4fbb6e);}let _0x38c457;try{_0x38c457=JSON['parse'](_0x4fbb6e);}catch(_0x10da61){console[_0x26cf65(0x10c)](_0x26cf65(0x107),_0x10da61),loggerService_1[_0x26cf65(0x125)][_0x26cf65(0xe4)](_0x26cf65(0xcd),'/payment-links','JSON\x20Parse\x20Error:\x20'+_0x10da61);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x4fbb6e);}console['log']('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x26cf65(0x11d)](_0x26cf65(0xef),JSON[_0x26cf65(0x116)](_0x38c457,null,0x2)),loggerService_1[_0x26cf65(0x125)][_0x26cf65(0xf2)]('noda',_0x26cf65(0x11b),_0x2a2ec8[_0x26cf65(0xe2)],_0x38c457,_0x3680ef);if(_0x38c457[_0x26cf65(0x10c)]||_0x38c457[_0x26cf65(0x117)]){const _0x30f709=_0x38c457[_0x26cf65(0x13c)]||_0x38c457[_0x26cf65(0x10c)]||_0x26cf65(0xe6);console[_0x26cf65(0x10c)](_0x26cf65(0x112)),console[_0x26cf65(0x10c)](_0x26cf65(0x12e),_0x30f709),console['error'](_0x26cf65(0x122),_0x38c457[_0x26cf65(0x117)]),loggerService_1[_0x26cf65(0x125)][_0x26cf65(0xe4)](_0x26cf65(0xcd),'/payment-links',_0x26cf65(0x10b)+_0x30f709);throw new Error(_0x26cf65(0xda)+_0x30f709);}if(!_0x38c457['id']||!_0x38c457['shortLinkUrls']?.[_0x26cf65(0xd0)]){console[_0x26cf65(0x10c)](_0x26cf65(0x11a)),console[_0x26cf65(0x10c)](_0x26cf65(0x106)),console[_0x26cf65(0x10c)](_0x26cf65(0x132),_0x38c457),loggerService_1['loggerService']['logWhiteDomainError'](_0x26cf65(0xcd),'/payment-links',_0x26cf65(0x115));throw new Error(_0x26cf65(0xc5));}return console[_0x26cf65(0x11d)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x26cf65(0x11d)](_0x26cf65(0xd8),_0x38c457['id']),console[_0x26cf65(0x11d)]('Short\x20Link:',_0x38c457['shortLinkUrls'][_0x26cf65(0xd0)]),console[_0x26cf65(0x11d)](_0x26cf65(0xdd),_0x38c457[_0x26cf65(0xc8)]['qrCodeLink']||_0x26cf65(0xff)),console[_0x26cf65(0x11d)](_0x26cf65(0x109),_0x2b90a0,_0x26cf65(0xf9)),console[_0x26cf65(0x11d)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x47cd75),{'gateway_payment_id':_0x38c457['id'],'payment_url':_0x38c457[_0x26cf65(0xc8)][_0x26cf65(0xd0)],'qr_code_url':_0x38c457[_0x26cf65(0xc8)][_0x26cf65(0x13b)],'expiry_date':_0x38c457[_0x26cf65(0xf0)]};}catch(_0x10e68e){console[_0x26cf65(0x10c)](_0x26cf65(0x120)),console['error']('Error\x20details:',_0x10e68e),loggerService_1[_0x26cf65(0x125)][_0x26cf65(0xe4)](_0x26cf65(0xcd),'/payment-links',_0x10e68e);if(_0x10e68e instanceof Error){console['error'](_0x26cf65(0x118),_0x10e68e[_0x26cf65(0x13c)]),console[_0x26cf65(0x10c)](_0x26cf65(0x119),_0x10e68e[_0x26cf65(0x10a)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x10e68e[_0x26cf65(0x13c)]);}throw new Error(_0x26cf65(0xcb));}}async[a53_0x35a537(0x113)](_0x1fc5ee){const _0x3159d8=a53_0x35a537,_0x279d7d=Date[_0x3159d8(0x111)]();try{loggerService_1[_0x3159d8(0x125)][_0x3159d8(0x11c)](_0x3159d8(0xcd),'/payment-links/'+_0x1fc5ee,'GET',{});const _0x13960c=await fetch(this[_0x3159d8(0x126)]+'/'+_0x1fc5ee,{'method':_0x3159d8(0x12c),'headers':{'Content-Type':_0x3159d8(0x10f),'User-Agent':_0x3159d8(0x10e)}}),_0x3961e7=Date[_0x3159d8(0x111)]()-_0x279d7d;if(!_0x13960c['ok']){const _0x2676eb=await _0x13960c[_0x3159d8(0xec)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3159d8(0xcd),'/payment-links/'+_0x1fc5ee,_0x13960c['status'],_0x2676eb,_0x3961e7);throw new Error(_0x3159d8(0xca)+_0x13960c['status']);}const _0x4c7b87=await _0x13960c[_0x3159d8(0x134)]();loggerService_1['loggerService'][_0x3159d8(0xf2)](_0x3159d8(0xcd),_0x3159d8(0x127)+_0x1fc5ee,_0x13960c[_0x3159d8(0xe2)],_0x4c7b87,_0x3961e7);if(_0x4c7b87[_0x3159d8(0x10c)]||_0x4c7b87[_0x3159d8(0x117)]){loggerService_1['loggerService'][_0x3159d8(0xe4)](_0x3159d8(0xcd),'/payment-links/'+_0x1fc5ee,'Noda\x20API\x20error:\x20'+(_0x4c7b87[_0x3159d8(0x13c)]||_0x4c7b87[_0x3159d8(0x10c)]||_0x3159d8(0x129)));throw new Error(_0x3159d8(0xda)+(_0x4c7b87[_0x3159d8(0x13c)]||_0x4c7b87[_0x3159d8(0x10c)]||_0x3159d8(0x129)));}let _0x4ce394=_0x3159d8(0xdc);if(_0x4c7b87[_0x3159d8(0xf7)]===![]){if(_0x4c7b87[_0x3159d8(0xf0)]){const _0x716aad=new Date(_0x4c7b87[_0x3159d8(0xf0)]),_0x53a44e=new Date();_0x716aad<_0x53a44e?_0x4ce394=_0x3159d8(0xd6):_0x4ce394=_0x3159d8(0xdf);}else _0x4ce394=_0x3159d8(0xdf);}else _0x4ce394=_0x3159d8(0xdc);return{'status':_0x4ce394,'amount':_0x4c7b87['amount'],'currency':_0x4c7b87[_0x3159d8(0x104)],'isActive':_0x4c7b87[_0x3159d8(0xf7)]};}catch(_0x5abfb){console[_0x3159d8(0x10c)](_0x3159d8(0xea),_0x5abfb),loggerService_1['loggerService'][_0x3159d8(0xe4)](_0x3159d8(0xcd),_0x3159d8(0x127)+_0x1fc5ee,_0x5abfb);throw new Error(_0x3159d8(0x101)+(_0x5abfb instanceof Error?_0x5abfb[_0x3159d8(0x13c)]:_0x3159d8(0x129)));}}async[a53_0x35a537(0x130)](_0x420dbe){const _0x3113c7=a53_0x35a537;console[_0x3113c7(0x11d)](_0x3113c7(0xfb),_0x420dbe);let _0x3aca84=_0x3113c7(0xdc);switch(_0x420dbe['Status']?.[_0x3113c7(0x124)]()){case _0x3113c7(0xc4):case _0x3113c7(0xf1):case _0x3113c7(0xd1):case _0x3113c7(0xfe):case _0x3113c7(0xe9):_0x420dbe[_0x3113c7(0xce)]===_0x3113c7(0x13a)?_0x3aca84=_0x3113c7(0xfd):_0x3aca84=_0x3113c7(0xdc);break;case _0x3113c7(0xf6):case _0x3113c7(0x139):case'failed':case _0x3113c7(0x10c):case _0x3113c7(0xcf):_0x3aca84=_0x3113c7(0xdf);break;case'expired':case _0x3113c7(0x103):_0x3aca84=_0x3113c7(0xd6);break;case _0x3113c7(0x11f):case'created':case _0x3113c7(0xcc):case'processing':case _0x3113c7(0x110):default:_0x3aca84=_0x3113c7(0xdc);break;}return{'paymentId':_0x420dbe[_0x3113c7(0xc9)]||_0x420dbe[_0x3113c7(0x138)],'status':_0x3aca84,'amount':_0x420dbe['Amount'],'currency':_0x420dbe[_0x3113c7(0x102)],'additionalInfo':{'method':_0x420dbe[_0x3113c7(0x10d)],'bankId':_0x420dbe[_0x3113c7(0xe1)],'settled':_0x420dbe['Settled'],'settlementDate':_0x420dbe[_0x3113c7(0x108)],'remitterName':_0x420dbe[_0x3113c7(0xe8)]?.['Name'],'remitterIban':_0x420dbe[_0x3113c7(0xe8)]?.[_0x3113c7(0x12b)],'bankTransactionId':_0x420dbe[_0x3113c7(0x133)]}};}['verifyWebhookSignature'](_0x560f6e,_0x1fa8fa){const _0x340a04=a53_0x35a537;return console['log'](_0x340a04(0xeb),{'receivedSignature':_0x1fa8fa,'paymentId':_0x560f6e[_0x340a04(0x138)],'merchantPaymentId':_0x560f6e['MerchantPaymentId']}),!![];}}function a53_0x2f06(_0x3933b0,_0x3ea3d6){const _0x38d03d=a53_0x38d0();return a53_0x2f06=function(_0x2f0687,_0x8e2907){_0x2f0687=_0x2f0687-0xc4;let _0x5925e1=_0x38d03d[_0x2f0687];return _0x5925e1;},a53_0x2f06(_0x3933b0,_0x3ea3d6);}exports['NodaService']=NodaService;