'use strict';function a47_0x4764(){const _0x51ebda=['json','Failed\x20to\x20parse\x20JSON\x20response:','Name','https://tesoft.uk/gateway/noda/webhook/','headers','1040630MQgaCl','timeout','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','logWhiteDomainResponse','active','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Headers:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Payment\x20Link\x20ID:','cancelled','qrCodeLink','../loggerService',',\x20body:\x20','shortLink','Error\x20stack:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','203jyauKH','processing','statusText','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','https://tesoft.uk/gateway/pending.php?id=','SettlementDate','URL:','Unknown\x20error\x20from\x20Noda\x20API','paid','failed','verifyWebhookSignature','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','currency','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','noda','Response\x20data:','parse','rejected','Unknown\x20error','logWhiteDomainRequest','NodaService','Failed\x20to\x20verify\x20Noda\x20payment:\x20','(8digits-8digits\x20format)','now','Not\x20provided','JSON\x20Parse\x20Error:\x20','pending','expired','1831112QhmlKa','done','Processing\x20Noda\x20webhook:','defineProperty','processWebhook','HTTP\x20error!\x20status:\x20','shortLinkUrls','Status:','canceled','PaymentId','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Remitter','stringify','https://tesoft.uk/gateway/noda/','2674964cQNPkk','Business\x20Error:\x20','Settled','message','MerchantPaymentId','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','FAILED','/payment-links','toLowerCase','isActive','successful','text','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','QR\x20Code\x20Link:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','completed','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','statusCode','apiUrl','Order\x20ID\x20Format:','15QnTzma','__esModule','Response\x20Body:','GET','Missing\x20id\x20or\x20shortLink\x20in\x20response','===\x20NODA\x20SERVICE\x20ERROR\x20===','expiryDate','===\x20NODA\x20API\x20ERROR\x20===','error','Raw\x20Response\x20Body:','loggerService','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','POST','Status','Yes','PAID','application/json','fromEntries','log','Response\x20Time:','Status\x20Text:','Noda\x20API\x20error:\x20','entries','37388190DEnSyU','Request\x20Body\x20(Direct\x20JSON):','55452SdVfpY','EXPIRED','amount','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','status','createPaymentLink','stack','HTTP\x20','27IBVAAr','1342612usGTsq','toUpperCase','logWhiteDomainError','Short\x20Link:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','PENDING','1948245WQrCfX','/payment-links/','verifyPayment','Noda\x20payment\x20verification\x20error:'];a47_0x4764=function(){return _0x51ebda;};return a47_0x4764();}function a47_0x65c0(_0x21e520,_0x43e5ef){const _0x476478=a47_0x4764();return a47_0x65c0=function(_0x65c0a1,_0x3f8614){_0x65c0a1=_0x65c0a1-0x102;let _0x335b32=_0x476478[_0x65c0a1];return _0x335b32;},a47_0x65c0(_0x21e520,_0x43e5ef);}const a47_0x1151b8=a47_0x65c0;(function(_0x20ec8c,_0x13cf51){const _0x3eb614=a47_0x65c0,_0x21e046=_0x20ec8c();while(!![]){try{const _0x5ffd60=parseInt(_0x3eb614(0x112))/0x1+parseInt(_0x3eb614(0x14c))/0x2+parseInt(_0x3eb614(0x109))/0x3+parseInt(_0x3eb614(0x103))/0x4*(parseInt(_0x3eb614(0x160))/0x5)+parseInt(_0x3eb614(0x179))/0x6*(-parseInt(_0x3eb614(0x122))/0x7)+parseInt(_0x3eb614(0x13e))/0x8*(parseInt(_0x3eb614(0x102))/0x9)+-parseInt(_0x3eb614(0x177))/0xa;if(_0x5ffd60===_0x13cf51)break;else _0x21e046['push'](_0x21e046['shift']());}catch(_0x33a82d){_0x21e046['push'](_0x21e046['shift']());}}}(a47_0x4764,0xae64c));Object[a47_0x1151b8(0x141)](exports,a47_0x1151b8(0x161),{'value':!![]}),exports[a47_0x1151b8(0x136)]=void 0x0;const loggerService_1=require(a47_0x1151b8(0x11d));class NodaService{constructor(){const _0x254a2c=a47_0x1151b8;this['apiUrl']=_0x254a2c(0x14b),console['log'](_0x254a2c(0x117));}async[a47_0x1151b8(0x17e)](_0x48ed2e){const _0x454b34=a47_0x1151b8,{orderId:_0x47efb0,name:_0x3ac418,paymentDescription:_0x3ec0c6,amount:_0x3614b4,currency:_0x39f265,webhookUrl:_0x4cdf55,returnUrl:_0x31efcb,expiryDate:_0x3e89b6}=_0x48ed2e,_0x58b07c=_0x39f265[_0x454b34(0x104)](),_0x5732e0=_0x454b34(0x110),_0x4afa14=_0x454b34(0x126)+_0x47efb0,_0x28d23d={'name':_0x3ac418,'paymentDescription':_0x3ec0c6,'amount':_0x3614b4,'currency':_0x58b07c,'paymentId':_0x47efb0,'webhookUrl':_0x5732e0,'returnUrl':_0x4afa14};_0x3e89b6&&(_0x28d23d[_0x454b34(0x166)]=_0x3e89b6);const _0x552dfd=Date[_0x454b34(0x139)]();try{console[_0x454b34(0x172)](_0x454b34(0x114)),console[_0x454b34(0x172)](_0x454b34(0x128),this[_0x454b34(0x15e)]),console[_0x454b34(0x172)](_0x454b34(0x178),JSON[_0x454b34(0x14a)](_0x28d23d,null,0x2)),console['log'](_0x454b34(0x15f),_0x47efb0,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x454b34(0x172)](_0x454b34(0x125),_0x4afa14),loggerService_1[_0x454b34(0x16a)][_0x454b34(0x135)](_0x454b34(0x130),_0x454b34(0x153),_0x454b34(0x16c),_0x28d23d);const _0x51e0ec=await fetch(this[_0x454b34(0x15e)],{'method':_0x454b34(0x16c),'headers':{'Content-Type':_0x454b34(0x170),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x28d23d)}),_0xf498c2=Date[_0x454b34(0x139)]()-_0x552dfd;console[_0x454b34(0x172)](_0x454b34(0x119)),console[_0x454b34(0x172)](_0x454b34(0x145),_0x51e0ec['status']),console['log'](_0x454b34(0x174),_0x51e0ec[_0x454b34(0x124)]),console[_0x454b34(0x172)](_0x454b34(0x118),Object[_0x454b34(0x171)](_0x51e0ec[_0x454b34(0x111)][_0x454b34(0x176)]())),console['log'](_0x454b34(0x173),_0xf498c2+'ms');const _0x33e980=await _0x51e0ec[_0x454b34(0x157)]();console[_0x454b34(0x172)](_0x454b34(0x169),_0x33e980);if(!_0x51e0ec['ok']){console[_0x454b34(0x168)](_0x454b34(0x167)),console['error']('HTTP\x20Status:',_0x51e0ec[_0x454b34(0x17d)]),console['error'](_0x454b34(0x162),_0x33e980),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x454b34(0x130),_0x454b34(0x153),_0x51e0ec['status'],_0x33e980,_0xf498c2),loggerService_1[_0x454b34(0x16a)][_0x454b34(0x105)](_0x454b34(0x130),'/payment-links',_0x454b34(0x180)+_0x51e0ec['status']+':\x20'+_0x33e980);if(_0x51e0ec[_0x454b34(0x17d)]===0x190)throw new Error(_0x454b34(0x12d));else{if(_0x51e0ec['status']===0x1f4)throw new Error(_0x454b34(0x16b));}throw new Error(_0x454b34(0x143)+_0x51e0ec['status']+_0x454b34(0x11e)+_0x33e980);}let _0x169776;try{_0x169776=JSON[_0x454b34(0x132)](_0x33e980);}catch(_0x407f91){console['error'](_0x454b34(0x10e),_0x407f91),loggerService_1[_0x454b34(0x16a)]['logWhiteDomainError']('noda',_0x454b34(0x153),_0x454b34(0x13b)+_0x407f91);throw new Error(_0x454b34(0x151)+_0x33e980);}console[_0x454b34(0x172)](_0x454b34(0x148)),console['log']('Parsed\x20Result:',JSON[_0x454b34(0x14a)](_0x169776,null,0x2)),loggerService_1[_0x454b34(0x16a)][_0x454b34(0x115)](_0x454b34(0x130),_0x454b34(0x153),_0x51e0ec[_0x454b34(0x17d)],_0x169776,_0xf498c2);if(_0x169776['error']||_0x169776['statusCode']){const _0x10baf1=_0x169776[_0x454b34(0x14f)]||_0x169776['error']||_0x454b34(0x129);console['error'](_0x454b34(0x121)),console[_0x454b34(0x168)]('Error\x20Message:',_0x10baf1),console[_0x454b34(0x168)]('Status\x20Code:',_0x169776[_0x454b34(0x15d)]),loggerService_1[_0x454b34(0x16a)]['logWhiteDomainError'](_0x454b34(0x130),_0x454b34(0x153),_0x454b34(0x14d)+_0x10baf1);throw new Error('Noda\x20API\x20error:\x20'+_0x10baf1);}if(!_0x169776['id']||!_0x169776[_0x454b34(0x144)]?.[_0x454b34(0x11f)]){console[_0x454b34(0x168)](_0x454b34(0x17c)),console[_0x454b34(0x168)](_0x454b34(0x164)),console['error'](_0x454b34(0x131),_0x169776),loggerService_1[_0x454b34(0x16a)]['logWhiteDomainError'](_0x454b34(0x130),_0x454b34(0x153),_0x454b34(0x12f));throw new Error(_0x454b34(0x158));}return console[_0x454b34(0x172)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x454b34(0x172)](_0x454b34(0x11a),_0x169776['id']),console['log'](_0x454b34(0x106),_0x169776[_0x454b34(0x144)]['shortLink']),console[_0x454b34(0x172)](_0x454b34(0x159),_0x169776[_0x454b34(0x144)][_0x454b34(0x11c)]||_0x454b34(0x13a)),console[_0x454b34(0x172)]('Order\x20ID\x20Used:',_0x47efb0,_0x454b34(0x138)),console[_0x454b34(0x172)](_0x454b34(0x107),_0x4afa14),{'gateway_payment_id':_0x169776['id'],'payment_url':_0x169776[_0x454b34(0x144)][_0x454b34(0x11f)],'qr_code_url':_0x169776[_0x454b34(0x144)][_0x454b34(0x11c)],'expiry_date':_0x169776['expiryDate']};}catch(_0xc88b8b){console['error'](_0x454b34(0x165)),console[_0x454b34(0x168)]('Error\x20details:',_0xc88b8b),loggerService_1[_0x454b34(0x16a)][_0x454b34(0x105)](_0x454b34(0x130),_0x454b34(0x153),_0xc88b8b);if(_0xc88b8b instanceof Error){console[_0x454b34(0x168)]('Error\x20message:',_0xc88b8b[_0x454b34(0x14f)]),console[_0x454b34(0x168)](_0x454b34(0x120),_0xc88b8b[_0x454b34(0x17f)]);throw new Error(_0x454b34(0x15c)+_0xc88b8b['message']);}throw new Error(_0x454b34(0x15a));}}async[a47_0x1151b8(0x10b)](_0x2ec279){const _0xcbda7a=a47_0x1151b8,_0x11c0ed=Date['now']();try{loggerService_1['loggerService']['logWhiteDomainRequest'](_0xcbda7a(0x130),_0xcbda7a(0x10a)+_0x2ec279,_0xcbda7a(0x163),{});const _0x151418=await fetch(this['apiUrl']+'/'+_0x2ec279,{'method':_0xcbda7a(0x163),'headers':{'Content-Type':_0xcbda7a(0x170),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x27e037=Date[_0xcbda7a(0x139)]()-_0x11c0ed;if(!_0x151418['ok']){const _0x42d353=await _0x151418[_0xcbda7a(0x157)]();loggerService_1[_0xcbda7a(0x16a)]['logWhiteDomainResponse']('noda',_0xcbda7a(0x10a)+_0x2ec279,_0x151418['status'],_0x42d353,_0x27e037);throw new Error(_0xcbda7a(0x143)+_0x151418[_0xcbda7a(0x17d)]);}const _0x10c572=await _0x151418[_0xcbda7a(0x10d)]();loggerService_1[_0xcbda7a(0x16a)][_0xcbda7a(0x115)](_0xcbda7a(0x130),'/payment-links/'+_0x2ec279,_0x151418[_0xcbda7a(0x17d)],_0x10c572,_0x27e037);if(_0x10c572[_0xcbda7a(0x168)]||_0x10c572[_0xcbda7a(0x15d)]){loggerService_1['loggerService'][_0xcbda7a(0x105)]('noda','/payment-links/'+_0x2ec279,_0xcbda7a(0x175)+(_0x10c572[_0xcbda7a(0x14f)]||_0x10c572[_0xcbda7a(0x168)]||'Unknown\x20error'));throw new Error(_0xcbda7a(0x175)+(_0x10c572['message']||_0x10c572[_0xcbda7a(0x168)]||_0xcbda7a(0x134)));}let _0x164328=_0xcbda7a(0x108);if(_0x10c572[_0xcbda7a(0x155)]===![]){if(_0x10c572['expiryDate']){const _0x36f130=new Date(_0x10c572['expiryDate']),_0x5a186a=new Date();_0x36f130<_0x5a186a?_0x164328=_0xcbda7a(0x17a):_0x164328='FAILED';}else _0x164328=_0xcbda7a(0x152);}else _0x164328=_0xcbda7a(0x108);return{'status':_0x164328,'amount':_0x10c572[_0xcbda7a(0x17b)],'currency':_0x10c572[_0xcbda7a(0x12e)],'isActive':_0x10c572[_0xcbda7a(0x155)]};}catch(_0x1738c9){console[_0xcbda7a(0x168)](_0xcbda7a(0x10c),_0x1738c9),loggerService_1['loggerService'][_0xcbda7a(0x105)](_0xcbda7a(0x130),_0xcbda7a(0x10a)+_0x2ec279,_0x1738c9);throw new Error(_0xcbda7a(0x137)+(_0x1738c9 instanceof Error?_0x1738c9['message']:'Unknown\x20error'));}}async[a47_0x1151b8(0x142)](_0x3ebc65){const _0x47357b=a47_0x1151b8;console[_0x47357b(0x172)](_0x47357b(0x140),_0x3ebc65);let _0x19e2f9='PENDING';switch(_0x3ebc65[_0x47357b(0x16d)]?.[_0x47357b(0x154)]()){case _0x47357b(0x13f):case _0x47357b(0x15b):case _0x47357b(0x12a):case'success':case _0x47357b(0x156):_0x3ebc65[_0x47357b(0x14e)]===_0x47357b(0x16e)?_0x19e2f9=_0x47357b(0x16f):_0x19e2f9='PENDING';break;case _0x47357b(0x11b):case _0x47357b(0x146):case _0x47357b(0x12b):case _0x47357b(0x168):case _0x47357b(0x133):_0x19e2f9='FAILED';break;case _0x47357b(0x13d):case _0x47357b(0x113):_0x19e2f9=_0x47357b(0x17a);break;case _0x47357b(0x13c):case'created':case _0x47357b(0x116):case _0x47357b(0x123):case'in_progress':default:_0x19e2f9='PENDING';break;}return{'paymentId':_0x3ebc65[_0x47357b(0x150)]||_0x3ebc65['PaymentId'],'status':_0x19e2f9,'amount':_0x3ebc65['Amount'],'currency':_0x3ebc65['Currency'],'additionalInfo':{'method':_0x3ebc65['Method'],'bankId':_0x3ebc65['BankId'],'settled':_0x3ebc65[_0x47357b(0x14e)],'settlementDate':_0x3ebc65[_0x47357b(0x127)],'remitterName':_0x3ebc65[_0x47357b(0x149)]?.[_0x47357b(0x10f)],'remitterIban':_0x3ebc65[_0x47357b(0x149)]?.['Iban'],'bankTransactionId':_0x3ebc65['BankTransactionId']}};}[a47_0x1151b8(0x12c)](_0x432b86,_0x36a3b9){const _0x3791bd=a47_0x1151b8;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x36a3b9,'paymentId':_0x432b86[_0x3791bd(0x147)],'merchantPaymentId':_0x432b86[_0x3791bd(0x150)]}),!![];}}exports[a47_0x1151b8(0x136)]=NodaService;