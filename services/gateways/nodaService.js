'use strict';const a40_0x3a975b=a40_0x31d8;(function(_0x4fd6e1,_0x51699f){const _0x493e1a=a40_0x31d8,_0x45f972=_0x4fd6e1();while(!![]){try{const _0x38df5a=parseInt(_0x493e1a(0x219))/0x1+parseInt(_0x493e1a(0x202))/0x2*(parseInt(_0x493e1a(0x209))/0x3)+parseInt(_0x493e1a(0x226))/0x4+-parseInt(_0x493e1a(0x22e))/0x5+parseInt(_0x493e1a(0x1e0))/0x6+parseInt(_0x493e1a(0x1cc))/0x7*(parseInt(_0x493e1a(0x1ff))/0x8)+-parseInt(_0x493e1a(0x1db))/0x9*(parseInt(_0x493e1a(0x228))/0xa);if(_0x38df5a===_0x51699f)break;else _0x45f972['push'](_0x45f972['shift']());}catch(_0x2917b3){_0x45f972['push'](_0x45f972['shift']());}}}(a40_0xd0f5,0x99598));Object[a40_0x3a975b(0x1f7)](exports,a40_0x3a975b(0x1fe),{'value':!![]}),exports[a40_0x3a975b(0x220)]=void 0x0;function a40_0xd0f5(){const _0x15fb08=['createPaymentLink','EXPIRED','headers','84jxbjmA','PENDING','Not\x20provided','log','verifyPayment','shortLink','Status\x20Text:','loggerService','Error\x20message:','Response\x20Time:','json','(8digits-8digits\x20format\x20for\x20Noda)','timeout','Iban','isActive','270dCqiRI','PAID','MerchantPaymentId','Noda\x20payment\x20verification\x20error:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','896736EAyWMV','Yes','error','Error\x20stack:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','JSON\x20Parse\x20Error:\x20','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Method','/payment-links/','failed','fromEntries','created','statusText','entries','/payment-links','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Raw\x20Response\x20Body:','expired','Failed\x20to\x20parse\x20JSON\x20response:','HTTP\x20Status:','parse','defineProperty','Order\x20ID\x20Used:','currency','qrCodeLink','POST','logWhiteDomainResponse','logWhiteDomainError','__esModule','300224eirMKL','expiryDate','processWebhook','64754dmLmLr','Status','text','successful','FAILED',',\x20body:\x20','rejected','3cvvxjG','(8digits-8digits\x20format)','Short\x20Link:','SettlementDate','Settled','HTTP\x20','cancelled','Missing\x20id\x20or\x20shortLink\x20in\x20response','done','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Unknown\x20error\x20from\x20Noda\x20API','HTTP\x20error!\x20status:\x20','PaymentId','https://tesoft.uk/gateway/pending.php?id=','toUpperCase','toLowerCase','1036448WNdkie','message','Request\x20Body\x20(Direct\x20JSON):','stringify','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','BankId','https://tesoft.uk/gateway/noda/','NodaService','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','statusCode','shortLinkUrls','Error\x20details:','TesSoft\x20Payment\x20System/1.0','777532NdeJBH','apiUrl','370190qzRVfv','status','logWhiteDomainRequest','now','canceled','application/json','621550tqjEKI','completed','pending','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','in_progress','noda','Unknown\x20error','Business\x20Error:\x20','Status\x20Code:','===\x20NODA\x20API\x20ERROR\x20===','Headers:','paid','Remitter','processing','https://tesoft.uk/gateway/noda/webhook/','../loggerService','Noda\x20API\x20error:\x20','active','Failed\x20to\x20verify\x20Noda\x20payment:\x20'];a40_0xd0f5=function(){return _0x15fb08;};return a40_0xd0f5();}const loggerService_1=require(a40_0x3a975b(0x1c5));function a40_0x31d8(_0x3c8f6c,_0x520186){const _0xd0f5b6=a40_0xd0f5();return a40_0x31d8=function(_0x31d88f,_0x464ce3){_0x31d88f=_0x31d88f-0x1bd;let _0x480591=_0xd0f5b6[_0x31d88f];return _0x480591;},a40_0x31d8(_0x3c8f6c,_0x520186);}class NodaService{constructor(){const _0x2f29b1=a40_0x3a975b;this[_0x2f29b1(0x227)]=_0x2f29b1(0x21f),console[_0x2f29b1(0x1cf)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a40_0x3a975b(0x1c9)](_0xd3601e){const _0x33dfe1=a40_0x3a975b,{orderId:_0x1375df,name:_0x441dec,paymentDescription:_0x402802,amount:_0x6be430,currency:_0x24b322,webhookUrl:_0xb208ab,returnUrl:_0x45b296,expiryDate:_0x2a440a}=_0xd3601e,_0x53c9d6=_0x24b322[_0x33dfe1(0x217)](),_0x2e5809=_0x33dfe1(0x1c4),_0x1fb885=_0x33dfe1(0x216)+_0x1375df,_0x5c5c61={'name':_0x441dec,'paymentDescription':_0x402802,'amount':_0x6be430,'currency':_0x53c9d6,'paymentId':_0x1375df,'webhookUrl':_0x2e5809,'returnUrl':_0x1fb885};_0x2a440a&&(_0x5c5c61[_0x33dfe1(0x200)]=_0x2a440a);const _0xe2dbeb=Date['now']();try{console['log'](_0x33dfe1(0x1e5)),console[_0x33dfe1(0x1cf)]('URL:',this[_0x33dfe1(0x227)]),console['log'](_0x33dfe1(0x21b),JSON[_0x33dfe1(0x21c)](_0x5c5c61,null,0x2)),console[_0x33dfe1(0x1cf)]('Order\x20ID\x20Format:',_0x1375df,_0x33dfe1(0x1d7)),console[_0x33dfe1(0x1cf)](_0x33dfe1(0x212),_0x1fb885),loggerService_1[_0x33dfe1(0x1d3)]['logWhiteDomainRequest'](_0x33dfe1(0x233),'/payment-links',_0x33dfe1(0x1fb),_0x5c5c61);const _0x56f666=await fetch(this[_0x33dfe1(0x227)],{'method':'POST','headers':{'Content-Type':_0x33dfe1(0x22d),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x33dfe1(0x21c)](_0x5c5c61)}),_0x252c98=Date['now']()-_0xe2dbeb;console[_0x33dfe1(0x1cf)](_0x33dfe1(0x1e4)),console[_0x33dfe1(0x1cf)]('Status:',_0x56f666['status']),console[_0x33dfe1(0x1cf)](_0x33dfe1(0x1d2),_0x56f666[_0x33dfe1(0x1ed)]),console[_0x33dfe1(0x1cf)](_0x33dfe1(0x1c0),Object[_0x33dfe1(0x1eb)](_0x56f666[_0x33dfe1(0x1cb)][_0x33dfe1(0x1ee)]())),console['log'](_0x33dfe1(0x1d5),_0x252c98+'ms');const _0x30759a=await _0x56f666[_0x33dfe1(0x204)]();console[_0x33dfe1(0x1cf)](_0x33dfe1(0x1f2),_0x30759a);if(!_0x56f666['ok']){console['error'](_0x33dfe1(0x1bf)),console['error'](_0x33dfe1(0x1f5),_0x56f666['status']),console[_0x33dfe1(0x1e2)]('Response\x20Body:',_0x30759a),loggerService_1[_0x33dfe1(0x1d3)][_0x33dfe1(0x1fc)](_0x33dfe1(0x233),_0x33dfe1(0x1ef),_0x56f666[_0x33dfe1(0x229)],_0x30759a,_0x252c98),loggerService_1[_0x33dfe1(0x1d3)][_0x33dfe1(0x1fd)]('noda',_0x33dfe1(0x1ef),_0x33dfe1(0x20e)+_0x56f666[_0x33dfe1(0x229)]+':\x20'+_0x30759a);if(_0x56f666[_0x33dfe1(0x229)]===0x190)throw new Error(_0x33dfe1(0x21d));else{if(_0x56f666[_0x33dfe1(0x229)]===0x1f4)throw new Error(_0x33dfe1(0x1f0));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x56f666[_0x33dfe1(0x229)]+_0x33dfe1(0x207)+_0x30759a);}let _0x92ec24;try{_0x92ec24=JSON[_0x33dfe1(0x1f6)](_0x30759a);}catch(_0xb8a0d2){console[_0x33dfe1(0x1e2)](_0x33dfe1(0x1f4),_0xb8a0d2),loggerService_1[_0x33dfe1(0x1d3)][_0x33dfe1(0x1fd)](_0x33dfe1(0x233),_0x33dfe1(0x1ef),_0x33dfe1(0x1e6)+_0xb8a0d2);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x30759a);}console[_0x33dfe1(0x1cf)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x33dfe1(0x1cf)]('Parsed\x20Result:',JSON[_0x33dfe1(0x21c)](_0x92ec24,null,0x2)),loggerService_1['loggerService'][_0x33dfe1(0x1fc)]('noda',_0x33dfe1(0x1ef),_0x56f666[_0x33dfe1(0x229)],_0x92ec24,_0x252c98);if(_0x92ec24[_0x33dfe1(0x1e2)]||_0x92ec24[_0x33dfe1(0x222)]){const _0x3210e7=_0x92ec24['message']||_0x92ec24[_0x33dfe1(0x1e2)]||_0x33dfe1(0x213);console[_0x33dfe1(0x1e2)](_0x33dfe1(0x1df)),console[_0x33dfe1(0x1e2)]('Error\x20Message:',_0x3210e7),console[_0x33dfe1(0x1e2)](_0x33dfe1(0x1be),_0x92ec24[_0x33dfe1(0x222)]),loggerService_1[_0x33dfe1(0x1d3)]['logWhiteDomainError'](_0x33dfe1(0x233),'/payment-links',_0x33dfe1(0x1bd)+_0x3210e7);throw new Error(_0x33dfe1(0x1c6)+_0x3210e7);}if(!_0x92ec24['id']||!_0x92ec24[_0x33dfe1(0x223)]?.[_0x33dfe1(0x1d1)]){console[_0x33dfe1(0x1e2)](_0x33dfe1(0x1f1)),console['error'](_0x33dfe1(0x210)),console['error']('Response\x20data:',_0x92ec24),loggerService_1[_0x33dfe1(0x1d3)][_0x33dfe1(0x1fd)](_0x33dfe1(0x233),_0x33dfe1(0x1ef),_0x33dfe1(0x221));throw new Error(_0x33dfe1(0x1e7));}return console[_0x33dfe1(0x1cf)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x33dfe1(0x1cf)]('Payment\x20Link\x20ID:',_0x92ec24['id']),console[_0x33dfe1(0x1cf)](_0x33dfe1(0x20b),_0x92ec24[_0x33dfe1(0x223)][_0x33dfe1(0x1d1)]),console[_0x33dfe1(0x1cf)]('QR\x20Code\x20Link:',_0x92ec24['shortLinkUrls']['qrCodeLink']||_0x33dfe1(0x1ce)),console['log'](_0x33dfe1(0x1f8),_0x1375df,_0x33dfe1(0x20a)),console[_0x33dfe1(0x1cf)](_0x33dfe1(0x231),_0x1fb885),{'gateway_payment_id':_0x92ec24['id'],'payment_url':_0x92ec24[_0x33dfe1(0x223)][_0x33dfe1(0x1d1)],'qr_code_url':_0x92ec24[_0x33dfe1(0x223)][_0x33dfe1(0x1fa)],'expiry_date':_0x92ec24['expiryDate']};}catch(_0x1e57dc){console[_0x33dfe1(0x1e2)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x33dfe1(0x1e2)](_0x33dfe1(0x224),_0x1e57dc),loggerService_1['loggerService'][_0x33dfe1(0x1fd)]('noda','/payment-links',_0x1e57dc);if(_0x1e57dc instanceof Error){console[_0x33dfe1(0x1e2)](_0x33dfe1(0x1d4),_0x1e57dc[_0x33dfe1(0x21a)]),console['error'](_0x33dfe1(0x1e3),_0x1e57dc['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x1e57dc[_0x33dfe1(0x21a)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x3a975b(0x1d0)](_0x3fdecb){const _0x20442b=a40_0x3a975b,_0x4a8994=Date[_0x20442b(0x22b)]();try{loggerService_1[_0x20442b(0x1d3)][_0x20442b(0x22a)](_0x20442b(0x233),'/payment-links/'+_0x3fdecb,'GET',{});const _0x28d028=await fetch(this[_0x20442b(0x227)]+'/'+_0x3fdecb,{'method':'GET','headers':{'Content-Type':_0x20442b(0x22d),'User-Agent':_0x20442b(0x225)}}),_0x368a08=Date[_0x20442b(0x22b)]()-_0x4a8994;if(!_0x28d028['ok']){const _0x3d7cad=await _0x28d028[_0x20442b(0x204)]();loggerService_1[_0x20442b(0x1d3)][_0x20442b(0x1fc)](_0x20442b(0x233),'/payment-links/'+_0x3fdecb,_0x28d028['status'],_0x3d7cad,_0x368a08);throw new Error(_0x20442b(0x214)+_0x28d028[_0x20442b(0x229)]);}const _0x206f56=await _0x28d028[_0x20442b(0x1d6)]();loggerService_1[_0x20442b(0x1d3)][_0x20442b(0x1fc)](_0x20442b(0x233),_0x20442b(0x1e9)+_0x3fdecb,_0x28d028[_0x20442b(0x229)],_0x206f56,_0x368a08);if(_0x206f56[_0x20442b(0x1e2)]||_0x206f56[_0x20442b(0x222)]){loggerService_1[_0x20442b(0x1d3)]['logWhiteDomainError'](_0x20442b(0x233),_0x20442b(0x1e9)+_0x3fdecb,_0x20442b(0x1c6)+(_0x206f56[_0x20442b(0x21a)]||_0x206f56[_0x20442b(0x1e2)]||_0x20442b(0x234)));throw new Error(_0x20442b(0x1c6)+(_0x206f56[_0x20442b(0x21a)]||_0x206f56[_0x20442b(0x1e2)]||'Unknown\x20error'));}let _0xe1fc2b=_0x20442b(0x1cd);if(_0x206f56[_0x20442b(0x1da)]===![]){if(_0x206f56[_0x20442b(0x200)]){const _0x2bbd42=new Date(_0x206f56[_0x20442b(0x200)]),_0x3d6962=new Date();_0x2bbd42<_0x3d6962?_0xe1fc2b=_0x20442b(0x1ca):_0xe1fc2b=_0x20442b(0x206);}else _0xe1fc2b=_0x20442b(0x206);}else _0xe1fc2b=_0x20442b(0x1cd);return{'status':_0xe1fc2b,'amount':_0x206f56['amount'],'currency':_0x206f56[_0x20442b(0x1f9)],'isActive':_0x206f56[_0x20442b(0x1da)]};}catch(_0xdad7b5){console[_0x20442b(0x1e2)](_0x20442b(0x1de),_0xdad7b5),loggerService_1[_0x20442b(0x1d3)][_0x20442b(0x1fd)](_0x20442b(0x233),_0x20442b(0x1e9)+_0x3fdecb,_0xdad7b5);throw new Error(_0x20442b(0x1c8)+(_0xdad7b5 instanceof Error?_0xdad7b5[_0x20442b(0x21a)]:_0x20442b(0x234)));}}async[a40_0x3a975b(0x201)](_0x5e17ff){const _0x294e39=a40_0x3a975b;console[_0x294e39(0x1cf)]('Processing\x20Noda\x20webhook:',_0x5e17ff);let _0x4ee111=_0x294e39(0x1cd);switch(_0x5e17ff[_0x294e39(0x203)]?.[_0x294e39(0x218)]()){case _0x294e39(0x211):case _0x294e39(0x22f):case _0x294e39(0x1c1):case'success':case _0x294e39(0x205):_0x5e17ff[_0x294e39(0x20d)]===_0x294e39(0x1e1)?_0x4ee111=_0x294e39(0x1dc):_0x4ee111=_0x294e39(0x1cd);break;case _0x294e39(0x20f):case _0x294e39(0x22c):case _0x294e39(0x1ea):case _0x294e39(0x1e2):case _0x294e39(0x208):_0x4ee111='FAILED';break;case _0x294e39(0x1f3):case _0x294e39(0x1d8):_0x4ee111=_0x294e39(0x1ca);break;case _0x294e39(0x230):case _0x294e39(0x1ec):case _0x294e39(0x1c7):case _0x294e39(0x1c3):case _0x294e39(0x232):default:_0x4ee111=_0x294e39(0x1cd);break;}return{'paymentId':_0x5e17ff[_0x294e39(0x1dd)]||_0x5e17ff[_0x294e39(0x215)],'status':_0x4ee111,'amount':_0x5e17ff['Amount'],'currency':_0x5e17ff['Currency'],'additionalInfo':{'method':_0x5e17ff[_0x294e39(0x1e8)],'bankId':_0x5e17ff[_0x294e39(0x21e)],'settled':_0x5e17ff['Settled'],'settlementDate':_0x5e17ff[_0x294e39(0x20c)],'remitterName':_0x5e17ff['Remitter']?.['Name'],'remitterIban':_0x5e17ff[_0x294e39(0x1c2)]?.[_0x294e39(0x1d9)],'bankTransactionId':_0x5e17ff['BankTransactionId']}};}['verifyWebhookSignature'](_0x7e86fc,_0x315597){const _0x2a1c92=a40_0x3a975b;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x315597,'paymentId':_0x7e86fc['PaymentId'],'merchantPaymentId':_0x7e86fc[_0x2a1c92(0x1dd)]}),!![];}}exports[a40_0x3a975b(0x220)]=NodaService;