'use strict';const a43_0x5dac62=a43_0x117a;(function(_0x4e37fb,_0x5a09ac){const _0x5b837c=a43_0x117a,_0x1257fb=_0x4e37fb();while(!![]){try{const _0x222ee6=parseInt(_0x5b837c(0x190))/0x1*(-parseInt(_0x5b837c(0x1bd))/0x2)+-parseInt(_0x5b837c(0x1b0))/0x3*(-parseInt(_0x5b837c(0x1d6))/0x4)+parseInt(_0x5b837c(0x1a7))/0x5+parseInt(_0x5b837c(0x19e))/0x6+-parseInt(_0x5b837c(0x1bb))/0x7+-parseInt(_0x5b837c(0x1bc))/0x8*(parseInt(_0x5b837c(0x1be))/0x9)+parseInt(_0x5b837c(0x183))/0xa;if(_0x222ee6===_0x5a09ac)break;else _0x1257fb['push'](_0x1257fb['shift']());}catch(_0x475af3){_0x1257fb['push'](_0x1257fb['shift']());}}}(a43_0x8bad,0x37b5c));Object[a43_0x5dac62(0x1b1)](exports,a43_0x5dac62(0x1d8),{'value':!![]}),exports[a43_0x5dac62(0x1da)]=void 0x0;function a43_0x117a(_0xe72f57,_0x15b793){const _0x8badc3=a43_0x8bad();return a43_0x117a=function(_0x117a82,_0x309816){_0x117a82=_0x117a82-0x17b;let _0x1d3cb5=_0x8badc3[_0x117a82];return _0x1d3cb5;},a43_0x117a(_0xe72f57,_0x15b793);}const loggerService_1=require(a43_0x5dac62(0x189));class NodaService{constructor(){const _0xcb426d=a43_0x5dac62;this['apiUrl']=_0xcb426d(0x191),console[_0xcb426d(0x1ba)](_0xcb426d(0x1f0));}async[a43_0x5dac62(0x1e9)](_0x31f90f){const _0x4dce57=a43_0x5dac62,{orderId:_0x3c45d0,name:_0x50b54b,paymentDescription:_0x49f937,amount:_0x3497d2,currency:_0x30e2e9,webhookUrl:_0x13a4fc,returnUrl:_0x22133b,expiryDate:_0x371afa}=_0x31f90f,_0x29503a=_0x30e2e9[_0x4dce57(0x187)](),_0x325e4f=_0x4dce57(0x17b),_0x2d77bd=_0x4dce57(0x1aa)+_0x3c45d0,_0x2630cd={'name':_0x50b54b,'paymentDescription':_0x49f937,'amount':_0x3497d2,'currency':_0x29503a,'paymentId':_0x3c45d0,'webhookUrl':_0x325e4f,'returnUrl':_0x2d77bd};_0x371afa&&(_0x2630cd[_0x4dce57(0x1d2)]=_0x371afa);const _0x3eaa4d=Date['now']();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x4dce57(0x1ba)](_0x4dce57(0x1cd),this[_0x4dce57(0x1e1)]),console[_0x4dce57(0x1ba)](_0x4dce57(0x1d5),JSON[_0x4dce57(0x1e4)](_0x2630cd,null,0x2)),console['log'](_0x4dce57(0x1c5),_0x3c45d0,_0x4dce57(0x1a8)),console[_0x4dce57(0x1ba)](_0x4dce57(0x1d0),_0x2d77bd),loggerService_1[_0x4dce57(0x17c)][_0x4dce57(0x1cf)](_0x4dce57(0x1b4),_0x4dce57(0x1ef),_0x4dce57(0x186),_0x2630cd);const _0x533b83=await fetch(this[_0x4dce57(0x1e1)],{'method':_0x4dce57(0x186),'headers':{'Content-Type':_0x4dce57(0x198),'Accept':_0x4dce57(0x198),'User-Agent':_0x4dce57(0x1a6)},'body':JSON[_0x4dce57(0x1e4)](_0x2630cd)}),_0x469e55=Date[_0x4dce57(0x1e6)]()-_0x3eaa4d;console[_0x4dce57(0x1ba)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x4dce57(0x1ba)](_0x4dce57(0x18a),_0x533b83[_0x4dce57(0x1ca)]),console[_0x4dce57(0x1ba)](_0x4dce57(0x18d),_0x533b83[_0x4dce57(0x1dd)]),console[_0x4dce57(0x1ba)](_0x4dce57(0x1ed),Object[_0x4dce57(0x1e0)](_0x533b83['headers']['entries']())),console['log'](_0x4dce57(0x185),_0x469e55+'ms');const _0x3372e5=await _0x533b83[_0x4dce57(0x1e2)]();console[_0x4dce57(0x1ba)](_0x4dce57(0x1ce),_0x3372e5);if(!_0x533b83['ok']){console[_0x4dce57(0x19f)](_0x4dce57(0x1f4)),console[_0x4dce57(0x19f)](_0x4dce57(0x194),_0x533b83[_0x4dce57(0x1ca)]),console[_0x4dce57(0x19f)]('Response\x20Body:',_0x3372e5),loggerService_1[_0x4dce57(0x17c)]['logWhiteDomainResponse']('noda',_0x4dce57(0x1ef),_0x533b83[_0x4dce57(0x1ca)],_0x3372e5,_0x469e55),loggerService_1[_0x4dce57(0x17c)][_0x4dce57(0x1d7)](_0x4dce57(0x1b4),_0x4dce57(0x1ef),'HTTP\x20'+_0x533b83[_0x4dce57(0x1ca)]+':\x20'+_0x3372e5);if(_0x533b83[_0x4dce57(0x1ca)]===0x190)throw new Error(_0x4dce57(0x1c2));else{if(_0x533b83[_0x4dce57(0x1ca)]===0x1f4)throw new Error(_0x4dce57(0x1b6));}throw new Error(_0x4dce57(0x1c4)+_0x533b83[_0x4dce57(0x1ca)]+',\x20body:\x20'+_0x3372e5);}let _0x36a85e;try{_0x36a85e=JSON[_0x4dce57(0x1d3)](_0x3372e5);}catch(_0x42e573){console['error'](_0x4dce57(0x1e8),_0x42e573),loggerService_1[_0x4dce57(0x17c)][_0x4dce57(0x1d7)]('noda',_0x4dce57(0x1ef),_0x4dce57(0x1ee)+_0x42e573);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x3372e5);}console[_0x4dce57(0x1ba)](_0x4dce57(0x1ab)),console['log'](_0x4dce57(0x1dc),JSON['stringify'](_0x36a85e,null,0x2)),loggerService_1['loggerService'][_0x4dce57(0x1e3)](_0x4dce57(0x1b4),_0x4dce57(0x1ef),_0x533b83[_0x4dce57(0x1ca)],_0x36a85e,_0x469e55);if(_0x36a85e[_0x4dce57(0x19f)]||_0x36a85e[_0x4dce57(0x192)]){const _0x1b9464=_0x36a85e[_0x4dce57(0x1e5)]||_0x36a85e[_0x4dce57(0x19f)]||_0x4dce57(0x1d9);console['error'](_0x4dce57(0x1c8)),console['error'](_0x4dce57(0x18b),_0x1b9464),console[_0x4dce57(0x19f)](_0x4dce57(0x1df),_0x36a85e[_0x4dce57(0x192)]),loggerService_1['loggerService'][_0x4dce57(0x1d7)](_0x4dce57(0x1b4),'/payment-links',_0x4dce57(0x1ac)+_0x1b9464);throw new Error('Noda\x20API\x20error:\x20'+_0x1b9464);}if(!_0x36a85e['id']||!_0x36a85e[_0x4dce57(0x19b)]?.[_0x4dce57(0x18e)]){console[_0x4dce57(0x19f)](_0x4dce57(0x1c3)),console[_0x4dce57(0x19f)](_0x4dce57(0x17f)),console[_0x4dce57(0x19f)](_0x4dce57(0x1f1),_0x36a85e),loggerService_1[_0x4dce57(0x17c)][_0x4dce57(0x1d7)](_0x4dce57(0x1b4),_0x4dce57(0x1ef),_0x4dce57(0x193));throw new Error(_0x4dce57(0x181));}return console[_0x4dce57(0x1ba)]('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x4dce57(0x19d),_0x36a85e['id']),console['log']('Short\x20Link:',_0x36a85e[_0x4dce57(0x19b)][_0x4dce57(0x18e)]),console['log'](_0x4dce57(0x1c6),_0x36a85e[_0x4dce57(0x19b)][_0x4dce57(0x1ae)]||_0x4dce57(0x19c)),console[_0x4dce57(0x1ba)](_0x4dce57(0x1a9),_0x3c45d0,'(8digits-8digits\x20format)'),console[_0x4dce57(0x1ba)](_0x4dce57(0x1d1),_0x2d77bd),{'gateway_payment_id':_0x36a85e['id'],'payment_url':_0x36a85e[_0x4dce57(0x19b)][_0x4dce57(0x18e)],'qr_code_url':_0x36a85e[_0x4dce57(0x19b)]['qrCodeLink'],'expiry_date':_0x36a85e[_0x4dce57(0x1d2)]};}catch(_0x4e8236){console[_0x4dce57(0x19f)](_0x4dce57(0x184)),console[_0x4dce57(0x19f)](_0x4dce57(0x1e7),_0x4e8236),loggerService_1['loggerService']['logWhiteDomainError'](_0x4dce57(0x1b4),'/payment-links',_0x4e8236);if(_0x4e8236 instanceof Error){console[_0x4dce57(0x19f)]('Error\x20message:',_0x4e8236['message']),console[_0x4dce57(0x19f)]('Error\x20stack:',_0x4e8236[_0x4dce57(0x1cc)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x4e8236[_0x4dce57(0x1e5)]);}throw new Error(_0x4dce57(0x17e));}}async['verifyPayment'](_0x484257){const _0x33f4bf=a43_0x5dac62,_0x2a021f=Date[_0x33f4bf(0x1e6)]();try{loggerService_1['loggerService'][_0x33f4bf(0x1cf)]('noda',_0x33f4bf(0x1a1)+_0x484257,_0x33f4bf(0x1bf),{});const _0x566476=await fetch(this['apiUrl']+'/'+_0x484257,{'method':'GET','headers':{'Content-Type':_0x33f4bf(0x198),'User-Agent':_0x33f4bf(0x1a6)}}),_0x226877=Date['now']()-_0x2a021f;if(!_0x566476['ok']){const _0x2278e6=await _0x566476[_0x33f4bf(0x1e2)]();loggerService_1[_0x33f4bf(0x17c)][_0x33f4bf(0x1e3)]('noda',_0x33f4bf(0x1a1)+_0x484257,_0x566476['status'],_0x2278e6,_0x226877);throw new Error('HTTP\x20error!\x20status:\x20'+_0x566476['status']);}const _0x574112=await _0x566476['json']();loggerService_1[_0x33f4bf(0x17c)][_0x33f4bf(0x1e3)](_0x33f4bf(0x1b4),_0x33f4bf(0x1a1)+_0x484257,_0x566476[_0x33f4bf(0x1ca)],_0x574112,_0x226877);if(_0x574112[_0x33f4bf(0x19f)]||_0x574112[_0x33f4bf(0x192)]){loggerService_1[_0x33f4bf(0x17c)]['logWhiteDomainError'](_0x33f4bf(0x1b4),_0x33f4bf(0x1a1)+_0x484257,_0x33f4bf(0x18f)+(_0x574112[_0x33f4bf(0x1e5)]||_0x574112[_0x33f4bf(0x19f)]||'Unknown\x20error'));throw new Error(_0x33f4bf(0x18f)+(_0x574112[_0x33f4bf(0x1e5)]||_0x574112[_0x33f4bf(0x19f)]||_0x33f4bf(0x1d4)));}let _0x29a029=_0x33f4bf(0x18c);if(_0x574112[_0x33f4bf(0x1f2)]===![]){if(_0x574112[_0x33f4bf(0x1d2)]){const _0x1879cf=new Date(_0x574112[_0x33f4bf(0x1d2)]),_0x756bba=new Date();_0x1879cf<_0x756bba?_0x29a029=_0x33f4bf(0x1ad):_0x29a029='FAILED';}else _0x29a029='FAILED';}else _0x29a029=_0x33f4bf(0x18c);return{'status':_0x29a029,'amount':_0x574112['amount'],'currency':_0x574112[_0x33f4bf(0x1ec)],'isActive':_0x574112['isActive']};}catch(_0x5dded9){console['error'](_0x33f4bf(0x196),_0x5dded9),loggerService_1[_0x33f4bf(0x17c)][_0x33f4bf(0x1d7)]('noda',_0x33f4bf(0x1a1)+_0x484257,_0x5dded9);throw new Error(_0x33f4bf(0x1ea)+(_0x5dded9 instanceof Error?_0x5dded9[_0x33f4bf(0x1e5)]:_0x33f4bf(0x1d4)));}}async['processWebhook'](_0x6c5b2d){const _0x1adb51=a43_0x5dac62;console[_0x1adb51(0x1ba)](_0x1adb51(0x1a3),_0x6c5b2d);let _0xb4324d='PENDING';switch(_0x6c5b2d[_0x1adb51(0x195)]?.[_0x1adb51(0x182)]()){case _0x1adb51(0x199):case _0x1adb51(0x188):case'paid':case _0x1adb51(0x1a2):case _0x1adb51(0x1b2):_0x6c5b2d[_0x1adb51(0x180)]===_0x1adb51(0x1c9)?_0xb4324d='PAID':_0xb4324d='PENDING';break;case _0x1adb51(0x197):case _0x1adb51(0x1b7):case _0x1adb51(0x1c1):case _0x1adb51(0x19f):case'rejected':_0xb4324d=_0x1adb51(0x1db);break;case _0x1adb51(0x1c7):case'timeout':_0xb4324d=_0x1adb51(0x1ad);break;case _0x1adb51(0x1a0):case'created':case _0x1adb51(0x19a):case _0x1adb51(0x1af):case'in_progress':default:_0xb4324d='PENDING';break;}return{'paymentId':_0x6c5b2d['MerchantPaymentId']||_0x6c5b2d[_0x1adb51(0x1a5)],'status':_0xb4324d,'amount':_0x6c5b2d[_0x1adb51(0x1b8)],'currency':_0x6c5b2d[_0x1adb51(0x1a4)],'additionalInfo':{'method':_0x6c5b2d[_0x1adb51(0x1b9)],'bankId':_0x6c5b2d[_0x1adb51(0x1de)],'settled':_0x6c5b2d[_0x1adb51(0x180)],'settlementDate':_0x6c5b2d[_0x1adb51(0x1b3)],'remitterName':_0x6c5b2d[_0x1adb51(0x1cb)]?.[_0x1adb51(0x17d)],'remitterIban':_0x6c5b2d[_0x1adb51(0x1cb)]?.[_0x1adb51(0x1b5)],'bankTransactionId':_0x6c5b2d[_0x1adb51(0x1f3)]}};}[a43_0x5dac62(0x1c0)](_0x545197,_0x14872e){const _0x445aa3=a43_0x5dac62;return console[_0x445aa3(0x1ba)](_0x445aa3(0x1eb),{'receivedSignature':_0x14872e,'paymentId':_0x545197[_0x445aa3(0x1a5)],'merchantPaymentId':_0x545197['MerchantPaymentId']}),!![];}}exports[a43_0x5dac62(0x1da)]=NodaService;function a43_0x8bad(){const _0x36f16b=['Remitter','stack','URL:','Raw\x20Response\x20Body:','logWhiteDomainRequest','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','✅\x20Return\x20URL\x20configured\x20for\x20pending:','expiryDate','parse','Unknown\x20error','Request\x20Body\x20(Direct\x20JSON):','450172SludxP','logWhiteDomainError','__esModule','Unknown\x20error\x20from\x20Noda\x20API','NodaService','FAILED','Parsed\x20Result:','statusText','BankId','Status\x20Code:','fromEntries','apiUrl','text','logWhiteDomainResponse','stringify','message','now','Error\x20details:','Failed\x20to\x20parse\x20JSON\x20response:','createPaymentLink','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Noda\x20webhook\x20signature\x20verification:','currency','Headers:','JSON\x20Parse\x20Error:\x20','/payment-links','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Response\x20data:','isActive','BankTransactionId','===\x20NODA\x20API\x20ERROR\x20===','https://tesoft.uk/gateway/noda/webhook/','loggerService','Name','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Missing\x20id\x20or\x20shortLink\x20in\x20response','Settled','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','toLowerCase','2240630TtfPHn','===\x20NODA\x20SERVICE\x20ERROR\x20===','Response\x20Time:','POST','toUpperCase','completed','../loggerService','Status:','Error\x20Message:','PENDING','Status\x20Text:','shortLink','Noda\x20API\x20error:\x20','111308IofjSa','https://tesoft.uk/gateway/noda/','statusCode','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','HTTP\x20Status:','Status','Noda\x20payment\x20verification\x20error:','cancelled','application/json','done','active','shortLinkUrls','Not\x20provided','Payment\x20Link\x20ID:','904914sIcOhM','error','pending','/payment-links/','success','Processing\x20Noda\x20webhook:','Currency','PaymentId','TesSoft\x20Payment\x20System/1.0','317385njxhtr','(8digits-8digits\x20format\x20for\x20Noda)','Order\x20ID\x20Used:','https://tesoft.uk/gateway/pending.php?id=','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Business\x20Error:\x20','EXPIRED','qrCodeLink','processing','9bemaka','defineProperty','successful','SettlementDate','noda','Iban','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','canceled','Amount','Method','log','1344441MTBZkE','8OKxPdL','4nBRzuG','1198089wvGPcI','GET','verifyWebhookSignature','failed','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20error!\x20status:\x20','Order\x20ID\x20Format:','QR\x20Code\x20Link:','expired','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Yes','status'];a43_0x8bad=function(){return _0x36f16b;};return a43_0x8bad();}