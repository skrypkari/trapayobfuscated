'use strict';const a44_0x2e3f1a=a44_0x2321;(function(_0x2872fe,_0x1f02ed){const _0x158ba9=a44_0x2321,_0x2bdb35=_0x2872fe();while(!![]){try{const _0x88755=-parseInt(_0x158ba9(0x7a))/0x1+-parseInt(_0x158ba9(0xa3))/0x2*(-parseInt(_0x158ba9(0xdd))/0x3)+parseInt(_0x158ba9(0xcf))/0x4+-parseInt(_0x158ba9(0x9e))/0x5+-parseInt(_0x158ba9(0x83))/0x6+-parseInt(_0x158ba9(0xe6))/0x7*(-parseInt(_0x158ba9(0x8f))/0x8)+parseInt(_0x158ba9(0xd0))/0x9;if(_0x88755===_0x1f02ed)break;else _0x2bdb35['push'](_0x2bdb35['shift']());}catch(_0x3d73c0){_0x2bdb35['push'](_0x2bdb35['shift']());}}}(a44_0x3245,0x72b28));Object[a44_0x2e3f1a(0xad)](exports,a44_0x2e3f1a(0x98),{'value':!![]}),exports[a44_0x2e3f1a(0xb7)]=void 0x0;const loggerService_1=require(a44_0x2e3f1a(0x9b));class NodaService{constructor(){const _0x217d19=a44_0x2e3f1a;this[_0x217d19(0x76)]=_0x217d19(0xb1),console[_0x217d19(0x93)](_0x217d19(0xab));}async[a44_0x2e3f1a(0xdf)](_0x164cc2){const _0x1a0e3b=a44_0x2e3f1a,{orderId:_0x381f3d,name:_0xa3e999,paymentDescription:_0x5459c0,amount:_0x4ef210,currency:_0x118773,webhookUrl:_0x19db7d,returnUrl:_0x4fe529,expiryDate:_0x8b90e6}=_0x164cc2,_0x2c8a72=_0x118773[_0x1a0e3b(0x74)](),_0x227962=_0x1a0e3b(0x8d),_0x14565d='https://tesoft.uk/gateway/pending.php?id='+_0x381f3d,_0x248824={'name':_0xa3e999,'paymentDescription':_0x5459c0,'amount':_0x4ef210,'currency':_0x2c8a72,'paymentId':_0x381f3d,'webhookUrl':_0x227962,'returnUrl':_0x14565d};_0x8b90e6&&(_0x248824[_0x1a0e3b(0x8a)]=_0x8b90e6);const _0x3a3d47=Date[_0x1a0e3b(0xa4)]();try{console[_0x1a0e3b(0x93)](_0x1a0e3b(0xa0)),console[_0x1a0e3b(0x93)](_0x1a0e3b(0x9f),this[_0x1a0e3b(0x76)]),console['log']('Request\x20Body\x20(Direct\x20JSON):',JSON['stringify'](_0x248824,null,0x2)),console['log'](_0x1a0e3b(0xd9),_0x381f3d,_0x1a0e3b(0xd2)),console[_0x1a0e3b(0x93)](_0x1a0e3b(0x84),_0x14565d),loggerService_1['loggerService'][_0x1a0e3b(0xba)]('noda',_0x1a0e3b(0xe4),_0x1a0e3b(0xcc),_0x248824);const _0x1d9ded=await fetch(this[_0x1a0e3b(0x76)],{'method':_0x1a0e3b(0xcc),'headers':{'Content-Type':_0x1a0e3b(0x8c),'Accept':_0x1a0e3b(0x8c),'User-Agent':_0x1a0e3b(0xcb)},'body':JSON[_0x1a0e3b(0x99)](_0x248824)}),_0x23b537=Date[_0x1a0e3b(0xa4)]()-_0x3a3d47;console[_0x1a0e3b(0x93)](_0x1a0e3b(0x81)),console[_0x1a0e3b(0x93)](_0x1a0e3b(0xe0),_0x1d9ded[_0x1a0e3b(0x80)]),console['log'](_0x1a0e3b(0xbe),_0x1d9ded[_0x1a0e3b(0xb6)]),console[_0x1a0e3b(0x93)](_0x1a0e3b(0xc2),Object[_0x1a0e3b(0x75)](_0x1d9ded[_0x1a0e3b(0xae)][_0x1a0e3b(0xc0)]())),console[_0x1a0e3b(0x93)](_0x1a0e3b(0xbf),_0x23b537+'ms');const _0x2018d2=await _0x1d9ded['text']();console[_0x1a0e3b(0x93)]('Raw\x20Response\x20Body:',_0x2018d2);if(!_0x1d9ded['ok']){console[_0x1a0e3b(0xea)](_0x1a0e3b(0xc9)),console['error'](_0x1a0e3b(0xcd),_0x1d9ded[_0x1a0e3b(0x80)]),console[_0x1a0e3b(0xea)](_0x1a0e3b(0xc7),_0x2018d2),loggerService_1[_0x1a0e3b(0xbb)][_0x1a0e3b(0x8b)](_0x1a0e3b(0xd8),_0x1a0e3b(0xe4),_0x1d9ded[_0x1a0e3b(0x80)],_0x2018d2,_0x23b537),loggerService_1[_0x1a0e3b(0xbb)]['logWhiteDomainError'](_0x1a0e3b(0xd8),_0x1a0e3b(0xe4),_0x1a0e3b(0xc4)+_0x1d9ded[_0x1a0e3b(0x80)]+':\x20'+_0x2018d2);if(_0x1d9ded[_0x1a0e3b(0x80)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x1d9ded[_0x1a0e3b(0x80)]===0x1f4)throw new Error(_0x1a0e3b(0xd7));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x1d9ded['status']+_0x1a0e3b(0x82)+_0x2018d2);}let _0x2a31dc;try{_0x2a31dc=JSON[_0x1a0e3b(0xd1)](_0x2018d2);}catch(_0x427e0b){console[_0x1a0e3b(0xea)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x427e0b),loggerService_1[_0x1a0e3b(0xbb)]['logWhiteDomainError'](_0x1a0e3b(0xd8),'/payment-links',_0x1a0e3b(0xaf)+_0x427e0b);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x2018d2);}console[_0x1a0e3b(0x93)](_0x1a0e3b(0xb9)),console[_0x1a0e3b(0x93)](_0x1a0e3b(0xec),JSON[_0x1a0e3b(0x99)](_0x2a31dc,null,0x2)),loggerService_1[_0x1a0e3b(0xbb)][_0x1a0e3b(0x8b)]('noda',_0x1a0e3b(0xe4),_0x1d9ded[_0x1a0e3b(0x80)],_0x2a31dc,_0x23b537);if(_0x2a31dc[_0x1a0e3b(0xea)]||_0x2a31dc[_0x1a0e3b(0x7b)]){const _0x4d7f6b=_0x2a31dc['message']||_0x2a31dc[_0x1a0e3b(0xea)]||'Unknown\x20error\x20from\x20Noda\x20API';console['error']('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x1a0e3b(0xea)]('Error\x20Message:',_0x4d7f6b),console[_0x1a0e3b(0xea)](_0x1a0e3b(0xde),_0x2a31dc[_0x1a0e3b(0x7b)]),loggerService_1[_0x1a0e3b(0xbb)]['logWhiteDomainError'](_0x1a0e3b(0xd8),_0x1a0e3b(0xe4),_0x1a0e3b(0x92)+_0x4d7f6b);throw new Error('Noda\x20API\x20error:\x20'+_0x4d7f6b);}if(!_0x2a31dc['id']||!_0x2a31dc[_0x1a0e3b(0x86)]?.['shortLink']){console['error'](_0x1a0e3b(0x8e)),console['error'](_0x1a0e3b(0xb4)),console['error'](_0x1a0e3b(0x78),_0x2a31dc),loggerService_1[_0x1a0e3b(0xbb)]['logWhiteDomainError'](_0x1a0e3b(0xd8),'/payment-links',_0x1a0e3b(0xb3));throw new Error(_0x1a0e3b(0x79));}return console[_0x1a0e3b(0x93)](_0x1a0e3b(0xe1)),console[_0x1a0e3b(0x93)](_0x1a0e3b(0xda),_0x2a31dc['id']),console[_0x1a0e3b(0x93)]('Short\x20Link:',_0x2a31dc[_0x1a0e3b(0x86)]['shortLink']),console[_0x1a0e3b(0x93)](_0x1a0e3b(0x91),_0x2a31dc[_0x1a0e3b(0x86)][_0x1a0e3b(0xb8)]||'Not\x20provided'),console[_0x1a0e3b(0x93)](_0x1a0e3b(0x87),_0x381f3d,'(8digits-8digits\x20format)'),console[_0x1a0e3b(0x93)]('✅\x20Return\x20URL\x20configured\x20for\x20pending:',_0x14565d),{'gateway_payment_id':_0x2a31dc['id'],'payment_url':_0x2a31dc[_0x1a0e3b(0x86)][_0x1a0e3b(0x85)],'qr_code_url':_0x2a31dc[_0x1a0e3b(0x86)]['qrCodeLink'],'expiry_date':_0x2a31dc['expiryDate']};}catch(_0x272d26){console['error'](_0x1a0e3b(0xe2)),console[_0x1a0e3b(0xea)](_0x1a0e3b(0xa8),_0x272d26),loggerService_1[_0x1a0e3b(0xbb)][_0x1a0e3b(0x9d)](_0x1a0e3b(0xd8),_0x1a0e3b(0xe4),_0x272d26);if(_0x272d26 instanceof Error){console['error'](_0x1a0e3b(0xd3),_0x272d26['message']),console['error']('Error\x20stack:',_0x272d26[_0x1a0e3b(0xeb)]);throw new Error(_0x1a0e3b(0xb5)+_0x272d26['message']);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x46282c){const _0x27b616=a44_0x2e3f1a,_0x1f1917=Date[_0x27b616(0xa4)]();try{loggerService_1[_0x27b616(0xbb)]['logWhiteDomainRequest'](_0x27b616(0xd8),'/payment-links/'+_0x46282c,_0x27b616(0xdb),{});const _0x40308a=await fetch(this[_0x27b616(0x76)]+'/'+_0x46282c,{'method':'GET','headers':{'Content-Type':_0x27b616(0x8c),'User-Agent':_0x27b616(0xcb)}}),_0x2e0572=Date['now']()-_0x1f1917;if(!_0x40308a['ok']){const _0x4137c7=await _0x40308a[_0x27b616(0xca)]();loggerService_1[_0x27b616(0xbb)][_0x27b616(0x8b)](_0x27b616(0xd8),'/payment-links/'+_0x46282c,_0x40308a[_0x27b616(0x80)],_0x4137c7,_0x2e0572);throw new Error(_0x27b616(0xc3)+_0x40308a[_0x27b616(0x80)]);}const _0x7b70b0=await _0x40308a[_0x27b616(0xe5)]();loggerService_1['loggerService'][_0x27b616(0x8b)](_0x27b616(0xd8),_0x27b616(0xe9)+_0x46282c,_0x40308a[_0x27b616(0x80)],_0x7b70b0,_0x2e0572);if(_0x7b70b0['error']||_0x7b70b0['statusCode']){loggerService_1[_0x27b616(0xbb)][_0x27b616(0x9d)](_0x27b616(0xd8),'/payment-links/'+_0x46282c,_0x27b616(0xd5)+(_0x7b70b0[_0x27b616(0x88)]||_0x7b70b0[_0x27b616(0xea)]||_0x27b616(0x9a)));throw new Error(_0x27b616(0xd5)+(_0x7b70b0[_0x27b616(0x88)]||_0x7b70b0[_0x27b616(0xea)]||_0x27b616(0x9a)));}let _0x4be448='PENDING';if(_0x7b70b0[_0x27b616(0xc6)]===![]){if(_0x7b70b0[_0x27b616(0x8a)]){const _0xf43628=new Date(_0x7b70b0['expiryDate']),_0x420896=new Date();_0xf43628<_0x420896?_0x4be448=_0x27b616(0x94):_0x4be448=_0x27b616(0x7c);}else _0x4be448=_0x27b616(0x7c);}else _0x4be448=_0x27b616(0x90);return{'status':_0x4be448,'amount':_0x7b70b0[_0x27b616(0xe8)],'currency':_0x7b70b0[_0x27b616(0x96)],'isActive':_0x7b70b0['isActive']};}catch(_0x369497){console[_0x27b616(0xea)](_0x27b616(0x97),_0x369497),loggerService_1[_0x27b616(0xbb)]['logWhiteDomainError']('noda','/payment-links/'+_0x46282c,_0x369497);throw new Error(_0x27b616(0xe7)+(_0x369497 instanceof Error?_0x369497[_0x27b616(0x88)]:_0x27b616(0x9a)));}}async[a44_0x2e3f1a(0xbc)](_0x2eeb7e){const _0x5e90fd=a44_0x2e3f1a;console['log'](_0x5e90fd(0x9c),_0x2eeb7e);let _0xcafc35='PENDING';switch(_0x2eeb7e[_0x5e90fd(0xc1)]?.[_0x5e90fd(0xa9)]()){case _0x5e90fd(0xac):case _0x5e90fd(0xc5):case'paid':case _0x5e90fd(0xa1):case _0x5e90fd(0x7f):_0x2eeb7e[_0x5e90fd(0xdc)]===_0x5e90fd(0xe3)?_0xcafc35='PAID':_0xcafc35=_0x5e90fd(0x90);break;case _0x5e90fd(0x89):case'canceled':case _0x5e90fd(0xa7):case _0x5e90fd(0xea):case'rejected':_0xcafc35='FAILED';break;case'expired':case'timeout':_0xcafc35=_0x5e90fd(0x94);break;case _0x5e90fd(0xa5):case _0x5e90fd(0xaa):case'active':case _0x5e90fd(0xa6):case _0x5e90fd(0x77):default:_0xcafc35=_0x5e90fd(0x90);break;}return{'paymentId':_0x2eeb7e[_0x5e90fd(0x7d)]||_0x2eeb7e[_0x5e90fd(0xb2)],'status':_0xcafc35,'amount':_0x2eeb7e[_0x5e90fd(0xd4)],'currency':_0x2eeb7e[_0x5e90fd(0xd6)],'additionalInfo':{'method':_0x2eeb7e[_0x5e90fd(0x7e)],'bankId':_0x2eeb7e[_0x5e90fd(0xa2)],'settled':_0x2eeb7e[_0x5e90fd(0xdc)],'settlementDate':_0x2eeb7e[_0x5e90fd(0xc8)],'remitterName':_0x2eeb7e[_0x5e90fd(0x95)]?.['Name'],'remitterIban':_0x2eeb7e[_0x5e90fd(0x95)]?.[_0x5e90fd(0xbd)],'bankTransactionId':_0x2eeb7e[_0x5e90fd(0xce)]}};}[a44_0x2e3f1a(0xb0)](_0x280d2f,_0x3f45c8){const _0x1dcecd=a44_0x2e3f1a;return console[_0x1dcecd(0x93)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x3f45c8,'paymentId':_0x280d2f[_0x1dcecd(0xb2)],'merchantPaymentId':_0x280d2f['MerchantPaymentId']}),!![];}}function a44_0x3245(){const _0x155661=['GET','Settled','21gXACVL','Status\x20Code:','createPaymentLink','Status:','===\x20NODA\x20SUCCESS\x20===','===\x20NODA\x20SERVICE\x20ERROR\x20===','Yes','/payment-links','json','258538xOCtoe','Failed\x20to\x20verify\x20Noda\x20payment:\x20','amount','/payment-links/','error','stack','Parsed\x20Result:','toUpperCase','fromEntries','apiUrl','in_progress','Response\x20data:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','936625PzhxYj','statusCode','FAILED','MerchantPaymentId','Method','successful','status','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===',',\x20body:\x20','4490580jVnfaN','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','shortLink','shortLinkUrls','Order\x20ID\x20Used:','message','cancelled','expiryDate','logWhiteDomainResponse','application/json','https://tesoft.uk/gateway/noda/webhook/','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','32cDulag','PENDING','QR\x20Code\x20Link:','Business\x20Error:\x20','log','EXPIRED','Remitter','currency','Noda\x20payment\x20verification\x20error:','__esModule','stringify','Unknown\x20error','../loggerService','Processing\x20Noda\x20webhook:','logWhiteDomainError','116040QLRitb','URL:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','success','BankId','200794VhABfz','now','pending','processing','failed','Error\x20details:','toLowerCase','created','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','done','defineProperty','headers','JSON\x20Parse\x20Error:\x20','verifyWebhookSignature','https://tesoft.uk/gateway/noda/','PaymentId','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Missing\x20id\x20or\x20shortLink\x20in\x20response','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','statusText','NodaService','qrCodeLink','===\x20PARSED\x20NODA\x20RESPONSE\x20===','logWhiteDomainRequest','loggerService','processWebhook','Iban','Status\x20Text:','Response\x20Time:','entries','Status','Headers:','HTTP\x20error!\x20status:\x20','HTTP\x20','completed','isActive','Response\x20Body:','SettlementDate','===\x20NODA\x20API\x20ERROR\x20===','text','TesSoft\x20Payment\x20System/1.0','POST','HTTP\x20Status:','BankTransactionId','5032SazOzT','11936610xfJiJK','parse','(8digits-8digits\x20format\x20for\x20Noda)','Error\x20message:','Amount','Noda\x20API\x20error:\x20','Currency','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','noda','Order\x20ID\x20Format:','Payment\x20Link\x20ID:'];a44_0x3245=function(){return _0x155661;};return a44_0x3245();}function a44_0x2321(_0x1e9951,_0x478f46){const _0x3245b0=a44_0x3245();return a44_0x2321=function(_0x232168,_0x1353e8){_0x232168=_0x232168-0x74;let _0x1605ca=_0x3245b0[_0x232168];return _0x1605ca;},a44_0x2321(_0x1e9951,_0x478f46);}exports[a44_0x2e3f1a(0xb7)]=NodaService;