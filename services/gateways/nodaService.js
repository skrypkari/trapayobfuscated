'use strict';const a53_0x273791=a53_0x5d36;(function(_0x315d71,_0x45d969){const _0x4965cf=a53_0x5d36,_0x4c7598=_0x315d71();while(!![]){try{const _0x3519cf=parseInt(_0x4965cf(0xc8))/0x1+-parseInt(_0x4965cf(0x10d))/0x2+parseInt(_0x4965cf(0x11d))/0x3+-parseInt(_0x4965cf(0xc0))/0x4+parseInt(_0x4965cf(0xc2))/0x5+parseInt(_0x4965cf(0xbd))/0x6*(parseInt(_0x4965cf(0xd5))/0x7)+-parseInt(_0x4965cf(0xe1))/0x8;if(_0x3519cf===_0x45d969)break;else _0x4c7598['push'](_0x4c7598['shift']());}catch(_0x27ccdd){_0x4c7598['push'](_0x4c7598['shift']());}}}(a53_0x213f,0x66b21));function a53_0x5d36(_0x21388f,_0xce2b0f){const _0x213f1b=a53_0x213f();return a53_0x5d36=function(_0x5d3655,_0x1bc2a1){_0x5d3655=_0x5d3655-0xa7;let _0x3ccb33=_0x213f1b[_0x5d3655];return _0x3ccb33;},a53_0x5d36(_0x21388f,_0xce2b0f);}Object[a53_0x273791(0xb3)](exports,a53_0x273791(0xcd),{'value':!![]}),exports[a53_0x273791(0xbe)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x21156d=a53_0x273791;this[_0x21156d(0x118)]=_0x21156d(0xd3),console[_0x21156d(0x11c)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a53_0x273791(0xa7)](_0x5cde28){const _0x46d287=a53_0x273791,{orderId:_0x4e390e,name:_0x9f91e2,paymentDescription:_0x133c13,amount:_0x31e163,currency:_0x40f672,webhookUrl:_0x3aced7,returnUrl:_0x3bdbac,expiryDate:_0x3d890f}=_0x5cde28,_0x26ce7d=_0x40f672['toUpperCase'](),_0x338598='https://tesoft.uk/gateway/noda/webhook/',_0x308f44=_0x46d287(0x114)+_0x4e390e,_0x398f00={'name':_0x9f91e2,'paymentDescription':_0x133c13,'amount':_0x31e163,'currency':_0x26ce7d,'paymentId':_0x4e390e,'webhookUrl':_0x338598,'returnUrl':_0x308f44};_0x3d890f&&(_0x398f00['expiryDate']=_0x3d890f);const _0x445d2d=Date['now']();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x46d287(0x11c)](_0x46d287(0xf4),this[_0x46d287(0x118)]),console[_0x46d287(0x11c)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x46d287(0xe7)](_0x398f00,null,0x2)),console['log'](_0x46d287(0xfb),_0x4e390e,_0x46d287(0xc7)),console[_0x46d287(0x11c)](_0x46d287(0xe6),_0x308f44),loggerService_1[_0x46d287(0x11b)][_0x46d287(0xf9)](_0x46d287(0xaf),_0x46d287(0xac),'POST',_0x398f00);const _0x3dd04f=await fetch(this[_0x46d287(0x118)],{'method':_0x46d287(0xb8),'headers':{'Content-Type':_0x46d287(0x102),'Accept':_0x46d287(0x102),'User-Agent':_0x46d287(0xca)},'body':JSON[_0x46d287(0xe7)](_0x398f00)}),_0x419331=Date[_0x46d287(0xd9)]()-_0x445d2d;console['log'](_0x46d287(0xd4)),console[_0x46d287(0x11c)](_0x46d287(0x112),_0x3dd04f[_0x46d287(0xb4)]),console['log'](_0x46d287(0x109),_0x3dd04f[_0x46d287(0xb0)]),console[_0x46d287(0x11c)](_0x46d287(0xa9),Object['fromEntries'](_0x3dd04f[_0x46d287(0xdd)][_0x46d287(0x100)]())),console['log'](_0x46d287(0x11a),_0x419331+'ms');const _0x59356f=await _0x3dd04f[_0x46d287(0xab)]();console['log']('Raw\x20Response\x20Body:',_0x59356f);if(!_0x3dd04f['ok']){console[_0x46d287(0xc9)](_0x46d287(0xae)),console[_0x46d287(0xc9)](_0x46d287(0xec),_0x3dd04f[_0x46d287(0xb4)]),console[_0x46d287(0xc9)](_0x46d287(0xad),_0x59356f),loggerService_1[_0x46d287(0x11b)][_0x46d287(0xff)](_0x46d287(0xaf),_0x46d287(0xac),_0x3dd04f[_0x46d287(0xb4)],_0x59356f,_0x419331),loggerService_1[_0x46d287(0x11b)][_0x46d287(0x111)](_0x46d287(0xaf),_0x46d287(0xac),_0x46d287(0xc4)+_0x3dd04f[_0x46d287(0xb4)]+':\x20'+_0x59356f);if(_0x3dd04f[_0x46d287(0xb4)]===0x190)throw new Error(_0x46d287(0xcf));else{if(_0x3dd04f[_0x46d287(0xb4)]===0x1f4)throw new Error(_0x46d287(0xe3));}throw new Error(_0x46d287(0xf3)+_0x3dd04f[_0x46d287(0xb4)]+',\x20body:\x20'+_0x59356f);}let _0x1717fa;try{_0x1717fa=JSON[_0x46d287(0x105)](_0x59356f);}catch(_0x2f2ab1){console[_0x46d287(0xc9)](_0x46d287(0xed),_0x2f2ab1),loggerService_1[_0x46d287(0x11b)][_0x46d287(0x111)](_0x46d287(0xaf),_0x46d287(0xac),'JSON\x20Parse\x20Error:\x20'+_0x2f2ab1);throw new Error(_0x46d287(0x101)+_0x59356f);}console[_0x46d287(0x11c)](_0x46d287(0xfe)),console[_0x46d287(0x11c)](_0x46d287(0xde),JSON[_0x46d287(0xe7)](_0x1717fa,null,0x2)),loggerService_1[_0x46d287(0x11b)][_0x46d287(0xff)](_0x46d287(0xaf),_0x46d287(0xac),_0x3dd04f[_0x46d287(0xb4)],_0x1717fa,_0x419331);if(_0x1717fa[_0x46d287(0xc9)]||_0x1717fa[_0x46d287(0xda)]){const _0x210550=_0x1717fa['message']||_0x1717fa[_0x46d287(0xc9)]||_0x46d287(0xd1);console[_0x46d287(0xc9)](_0x46d287(0xd6)),console['error'](_0x46d287(0xe5),_0x210550),console['error'](_0x46d287(0x103),_0x1717fa['statusCode']),loggerService_1[_0x46d287(0x11b)]['logWhiteDomainError'](_0x46d287(0xaf),_0x46d287(0xac),_0x46d287(0xb7)+_0x210550);throw new Error('Noda\x20API\x20error:\x20'+_0x210550);}if(!_0x1717fa['id']||!_0x1717fa[_0x46d287(0xf0)]?.['shortLink']){console['error'](_0x46d287(0xcc)),console['error']('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x46d287(0xc9)](_0x46d287(0x119),_0x1717fa),loggerService_1[_0x46d287(0x11b)][_0x46d287(0x111)]('noda',_0x46d287(0xac),_0x46d287(0xbc));throw new Error(_0x46d287(0xf6));}return console['log'](_0x46d287(0xc1)),console[_0x46d287(0x11c)]('Payment\x20Link\x20ID:',_0x1717fa['id']),console['log'](_0x46d287(0x106),_0x1717fa[_0x46d287(0xf0)][_0x46d287(0xc6)]),console[_0x46d287(0x11c)](_0x46d287(0xf8),_0x1717fa[_0x46d287(0xf0)]['qrCodeLink']||_0x46d287(0x104)),console[_0x46d287(0x11c)](_0x46d287(0x117),_0x4e390e,'(8digits-8digits\x20format)'),console[_0x46d287(0x11c)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x308f44),{'gateway_payment_id':_0x1717fa['id'],'payment_url':_0x1717fa[_0x46d287(0xf0)]['shortLink'],'qr_code_url':_0x1717fa['shortLinkUrls'][_0x46d287(0xb5)],'expiry_date':_0x1717fa['expiryDate']};}catch(_0x4b84b5){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x46d287(0xc9)]('Error\x20details:',_0x4b84b5),loggerService_1['loggerService'][_0x46d287(0x111)]('noda',_0x46d287(0xac),_0x4b84b5);if(_0x4b84b5 instanceof Error){console[_0x46d287(0xc9)](_0x46d287(0x10f),_0x4b84b5[_0x46d287(0xba)]),console['error'](_0x46d287(0xf7),_0x4b84b5[_0x46d287(0xfd)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x4b84b5['message']);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a53_0x273791(0xef)](_0x51311d){const _0x39ab87=a53_0x273791,_0x2d92f4=Date[_0x39ab87(0xd9)]();try{loggerService_1[_0x39ab87(0x11b)][_0x39ab87(0xf9)]('noda',_0x39ab87(0x10c)+_0x51311d,_0x39ab87(0xc5),{});const _0x3d4828=await fetch(this[_0x39ab87(0x118)]+'/'+_0x51311d,{'method':'GET','headers':{'Content-Type':_0x39ab87(0x102),'User-Agent':_0x39ab87(0xca)}}),_0x304399=Date[_0x39ab87(0xd9)]()-_0x2d92f4;if(!_0x3d4828['ok']){const _0x5e85b5=await _0x3d4828[_0x39ab87(0xab)]();loggerService_1[_0x39ab87(0x11b)]['logWhiteDomainResponse'](_0x39ab87(0xaf),_0x39ab87(0x10c)+_0x51311d,_0x3d4828[_0x39ab87(0xb4)],_0x5e85b5,_0x304399);throw new Error(_0x39ab87(0xf3)+_0x3d4828[_0x39ab87(0xb4)]);}const _0x103695=await _0x3d4828[_0x39ab87(0xb6)]();loggerService_1['loggerService'][_0x39ab87(0xff)](_0x39ab87(0xaf),_0x39ab87(0x10c)+_0x51311d,_0x3d4828[_0x39ab87(0xb4)],_0x103695,_0x304399);if(_0x103695[_0x39ab87(0xc9)]||_0x103695[_0x39ab87(0xda)]){loggerService_1['loggerService']['logWhiteDomainError'](_0x39ab87(0xaf),_0x39ab87(0x10c)+_0x51311d,'Noda\x20API\x20error:\x20'+(_0x103695[_0x39ab87(0xba)]||_0x103695[_0x39ab87(0xc9)]||_0x39ab87(0xfa)));throw new Error(_0x39ab87(0x10e)+(_0x103695[_0x39ab87(0xba)]||_0x103695['error']||'Unknown\x20error'));}let _0x5c78fd=_0x39ab87(0xd2);if(_0x103695[_0x39ab87(0xa8)]===![]){if(_0x103695[_0x39ab87(0x10a)]){const _0x219965=new Date(_0x103695[_0x39ab87(0x10a)]),_0x2d6907=new Date();_0x219965<_0x2d6907?_0x5c78fd=_0x39ab87(0x107):_0x5c78fd='FAILED';}else _0x5c78fd=_0x39ab87(0xe2);}else _0x5c78fd=_0x39ab87(0xd2);return{'status':_0x5c78fd,'amount':_0x103695[_0x39ab87(0x115)],'currency':_0x103695[_0x39ab87(0x10b)],'isActive':_0x103695['isActive']};}catch(_0xe21946){console['error'](_0x39ab87(0xea),_0xe21946),loggerService_1[_0x39ab87(0x11b)]['logWhiteDomainError']('noda','/payment-links/'+_0x51311d,_0xe21946);throw new Error(_0x39ab87(0xf2)+(_0xe21946 instanceof Error?_0xe21946[_0x39ab87(0xba)]:_0x39ab87(0xfa)));}}async[a53_0x273791(0xe0)](_0x234fed){const _0x491504=a53_0x273791;console[_0x491504(0x11c)](_0x491504(0xbb),_0x234fed);let _0x5d7a1a=_0x491504(0xd2);switch(_0x234fed['Status']?.[_0x491504(0xd0)]()){case _0x491504(0xf5):case _0x491504(0xe4):case _0x491504(0xb1):case _0x491504(0xaa):case _0x491504(0xdc):_0x234fed[_0x491504(0xdf)]===_0x491504(0xf1)?_0x5d7a1a='PAID':_0x5d7a1a=_0x491504(0xd2);break;case _0x491504(0xdb):case _0x491504(0xeb):case _0x491504(0xd8):case _0x491504(0xc9):case _0x491504(0x108):_0x5d7a1a=_0x491504(0xe2);break;case _0x491504(0x113):case'timeout':_0x5d7a1a=_0x491504(0x107);break;case _0x491504(0xc3):case'created':case _0x491504(0x110):case'processing':case _0x491504(0xcb):default:_0x5d7a1a=_0x491504(0xd2);break;}return{'paymentId':_0x234fed[_0x491504(0xee)]||_0x234fed['PaymentId'],'status':_0x5d7a1a,'amount':_0x234fed[_0x491504(0xe9)],'currency':_0x234fed['Currency'],'additionalInfo':{'method':_0x234fed['Method'],'bankId':_0x234fed[_0x491504(0xb2)],'settled':_0x234fed[_0x491504(0xdf)],'settlementDate':_0x234fed[_0x491504(0xd7)],'remitterName':_0x234fed['Remitter']?.[_0x491504(0xb9)],'remitterIban':_0x234fed[_0x491504(0xce)]?.[_0x491504(0xe8)],'bankTransactionId':_0x234fed[_0x491504(0xfc)]}};}[a53_0x273791(0x116)](_0x22597a,_0x29530b){const _0x53b455=a53_0x273791;return console[_0x53b455(0x11c)](_0x53b455(0xbf),{'receivedSignature':_0x29530b,'paymentId':_0x22597a['PaymentId'],'merchantPaymentId':_0x22597a['MerchantPaymentId']}),!![];}}function a53_0x213f(){const _0x326f10=['parse','Short\x20Link:','EXPIRED','rejected','Status\x20Text:','expiryDate','currency','/payment-links/','149604CmJfMD','Noda\x20API\x20error:\x20','Error\x20message:','active','logWhiteDomainError','Status:','expired','https://tesoft.uk/gateway/pending.php?id=','amount','verifyWebhookSignature','Order\x20ID\x20Used:','apiUrl','Response\x20data:','Response\x20Time:','loggerService','log','2463060OXzafU','createPaymentLink','isActive','Headers:','success','text','/payment-links','Response\x20Body:','===\x20NODA\x20API\x20ERROR\x20===','noda','statusText','paid','BankId','defineProperty','status','qrCodeLink','json','Business\x20Error:\x20','POST','Name','message','Processing\x20Noda\x20webhook:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','11136dFXVKv','NodaService','Noda\x20webhook\x20signature\x20verification:','2762320ewftXV','===\x20NODA\x20SUCCESS\x20===','2964045IKhSNE','pending','HTTP\x20','GET','shortLink','(8digits-8digits\x20format\x20for\x20Noda)','557219waqKjl','error','Payment\x20System/1.0','in_progress','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','__esModule','Remitter','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','toLowerCase','Unknown\x20error\x20from\x20Noda\x20API','PENDING','https://tesoft.uk/gateway/noda/','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','1449JLSHgI','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','SettlementDate','failed','now','statusCode','cancelled','successful','headers','Parsed\x20Result:','Settled','processWebhook','9353736UKFOvP','FAILED','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','completed','Error\x20Message:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','stringify','Iban','Amount','Noda\x20payment\x20verification\x20error:','canceled','HTTP\x20Status:','Failed\x20to\x20parse\x20JSON\x20response:','MerchantPaymentId','verifyPayment','shortLinkUrls','Yes','Failed\x20to\x20verify\x20Noda\x20payment:\x20','HTTP\x20error!\x20status:\x20','URL:','done','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Error\x20stack:','QR\x20Code\x20Link:','logWhiteDomainRequest','Unknown\x20error','Order\x20ID\x20Format:','BankTransactionId','stack','===\x20PARSED\x20NODA\x20RESPONSE\x20===','logWhiteDomainResponse','entries','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','application/json','Status\x20Code:','Not\x20provided'];a53_0x213f=function(){return _0x326f10;};return a53_0x213f();}exports[a53_0x273791(0xbe)]=NodaService;