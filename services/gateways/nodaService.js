'use strict';const a40_0x20bdbe=a40_0x2265;function a40_0x47ac(){const _0x77959d=['Unknown\x20error\x20from\x20Noda\x20API','failed','85092Ewchjr','Currency','defineProperty','message','Error\x20details:','TesSoft\x20Payment\x20System/1.0','(8digits-8digits\x20format\x20for\x20Noda)','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Short\x20Link:','13419117hbPIjo','Parsed\x20Result:','Noda\x20webhook\x20signature\x20verification:','https://tesoft.uk/gateway/success.php?id=','20YGpiFP','qrCodeLink','(8digits-8digits\x20format)','done','QR\x20Code\x20Link:','Response\x20Time:','loggerService','Not\x20provided','PENDING','6106945zZWrOH','currency','expiryDate','text','HTTP\x20Status:','Status','Noda\x20API\x20error:\x20','GET','verifyWebhookSignature','statusText','===\x20NODA\x20SERVICE\x20ERROR\x20===','in_progress','Error\x20message:','32HAxtFm','apiUrl','Failed\x20to\x20parse\x20JSON\x20response:','NodaService','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','error','status','Response\x20Body:','success','Raw\x20Response\x20Body:','now','stringify','1758780SpGVSM','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Settled','isActive','Iban','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Order\x20ID\x20Used:','logWhiteDomainRequest','Error\x20Message:','application/json','pending','Payment\x20Link\x20ID:','/payment-links','Processing\x20Noda\x20webhook:','Order\x20ID\x20Format:',',\x20body:\x20','rejected','Missing\x20id\x20or\x20shortLink\x20in\x20response','paid','/payment-links/','Name','fromEntries','===\x20NODA\x20API\x20ERROR\x20===','URL:','stack','toUpperCase','SettlementDate','7737792IOjzUe','28214JcQetD','Noda\x20payment\x20verification\x20error:','successful','amount','logWhiteDomainError','Failed\x20to\x20verify\x20Noda\x20payment:\x20','https://tesoft.uk/gateway/noda/webhook/','verifyPayment','===\x20NODA\x20SUCCESS\x20===','processWebhook','Remitter','shortLink','cancelled','../loggerService','Headers:','MerchantPaymentId','===\x20PARSED\x20NODA\x20RESPONSE\x20===','JSON\x20Parse\x20Error:\x20','3742020AyMgbW','log','toLowerCase','noda','PaymentId','BankTransactionId','timeout','HTTP\x20','Status:','Unknown\x20error','PAID','statusCode','Amount','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','logWhiteDomainResponse','entries','Request\x20Body\x20(Direct\x20JSON):','POST','Status\x20Code:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','shortLinkUrls','processing','Business\x20Error:\x20','74hXPOce','Yes','created','Response\x20data:','FAILED'];a40_0x47ac=function(){return _0x77959d;};return a40_0x47ac();}(function(_0x1f5f4f,_0x322ba8){const _0xe6e5ea=a40_0x2265,_0x1746d5=_0x1f5f4f();while(!![]){try{const _0xa677b2=parseInt(_0xe6e5ea(0x118))/0x1*(parseInt(_0xe6e5ea(0xc6))/0x2)+-parseInt(_0xe6e5ea(0xfc))/0x3+parseInt(_0xe6e5ea(0x12a))/0x4+parseInt(_0xe6e5ea(0xe3))/0x5+parseInt(_0xe6e5ea(0x117))/0x6+-parseInt(_0xe6e5ea(0xcd))/0x7*(parseInt(_0xe6e5ea(0xf0))/0x8)+parseInt(_0xe6e5ea(0xd6))/0x9*(-parseInt(_0xe6e5ea(0xda))/0xa);if(_0xa677b2===_0x322ba8)break;else _0x1746d5['push'](_0x1746d5['shift']());}catch(_0xa7d21){_0x1746d5['push'](_0x1746d5['shift']());}}}(a40_0x47ac,0xd543e));Object[a40_0x20bdbe(0xcf)](exports,'__esModule',{'value':!![]}),exports[a40_0x20bdbe(0xf3)]=void 0x0;function a40_0x2265(_0x42e86a,_0x5d2985){const _0x47ac32=a40_0x47ac();return a40_0x2265=function(_0x226593,_0x3bc96a){_0x226593=_0x226593-0xbf;let _0x2694b1=_0x47ac32[_0x226593];return _0x2694b1;},a40_0x2265(_0x42e86a,_0x5d2985);}const loggerService_1=require(a40_0x20bdbe(0x125));class NodaService{constructor(){const _0x29deaa=a40_0x20bdbe;this[_0x29deaa(0xf1)]='https://tesoft.uk/gateway/noda/',console['log'](_0x29deaa(0xf4));}async['createPaymentLink'](_0x13d3f2){const _0x17072a=a40_0x20bdbe,{orderId:_0x4b1626,name:_0x5e4c14,paymentDescription:_0x5ddf4c,amount:_0x2459f2,currency:_0x7a8b72,webhookUrl:_0x40f571,returnUrl:_0x4f982c,expiryDate:_0x588de1}=_0x13d3f2,_0x1c70d4=_0x7a8b72[_0x17072a(0x115)](),_0x587867=_0x17072a(0x11e),_0x2bda67=_0x17072a(0xd9)+_0x4b1626,_0x6d9d01={'name':_0x5e4c14,'paymentDescription':_0x5ddf4c,'amount':_0x2459f2,'currency':_0x1c70d4,'paymentId':_0x4b1626,'webhookUrl':_0x587867,'returnUrl':_0x2bda67};_0x588de1&&(_0x6d9d01['expiryDate']=_0x588de1);const _0x67e25a=Date[_0x17072a(0xfa)]();try{console[_0x17072a(0x12b)](_0x17072a(0xc2)),console['log'](_0x17072a(0x113),this[_0x17072a(0xf1)]),console[_0x17072a(0x12b)](_0x17072a(0xbf),JSON['stringify'](_0x6d9d01,null,0x2)),console[_0x17072a(0x12b)](_0x17072a(0x10a),_0x4b1626,_0x17072a(0xd3)),loggerService_1[_0x17072a(0xe0)][_0x17072a(0x103)](_0x17072a(0x12d),'/payment-links',_0x17072a(0xc0),_0x6d9d01);const _0x4e7f9e=await fetch(this[_0x17072a(0xf1)],{'method':_0x17072a(0xc0),'headers':{'Content-Type':'application/json','Accept':_0x17072a(0x105),'User-Agent':_0x17072a(0xd2)},'body':JSON['stringify'](_0x6d9d01)}),_0x31095a=Date[_0x17072a(0xfa)]()-_0x67e25a;console[_0x17072a(0x12b)](_0x17072a(0xfd)),console['log'](_0x17072a(0x132),_0x4e7f9e[_0x17072a(0xf6)]),console[_0x17072a(0x12b)]('Status\x20Text:',_0x4e7f9e[_0x17072a(0xec)]),console[_0x17072a(0x12b)](_0x17072a(0x126),Object[_0x17072a(0x111)](_0x4e7f9e['headers'][_0x17072a(0x139)]())),console[_0x17072a(0x12b)](_0x17072a(0xdf),_0x31095a+'ms');const _0x446dfc=await _0x4e7f9e[_0x17072a(0xe6)]();console[_0x17072a(0x12b)](_0x17072a(0xf9),_0x446dfc);if(!_0x4e7f9e['ok']){console[_0x17072a(0xf5)](_0x17072a(0x112)),console['error'](_0x17072a(0xe7),_0x4e7f9e[_0x17072a(0xf6)]),console[_0x17072a(0xf5)](_0x17072a(0xf7),_0x446dfc),loggerService_1[_0x17072a(0xe0)][_0x17072a(0x138)]('noda',_0x17072a(0x108),_0x4e7f9e[_0x17072a(0xf6)],_0x446dfc,_0x31095a),loggerService_1[_0x17072a(0xe0)][_0x17072a(0x11c)](_0x17072a(0x12d),_0x17072a(0x108),_0x17072a(0x131)+_0x4e7f9e[_0x17072a(0xf6)]+':\x20'+_0x446dfc);if(_0x4e7f9e[_0x17072a(0xf6)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x4e7f9e[_0x17072a(0xf6)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error('HTTP\x20error!\x20status:\x20'+_0x4e7f9e[_0x17072a(0xf6)]+_0x17072a(0x10b)+_0x446dfc);}let _0x551cff;try{_0x551cff=JSON['parse'](_0x446dfc);}catch(_0x42e53f){console[_0x17072a(0xf5)](_0x17072a(0xf2),_0x42e53f),loggerService_1[_0x17072a(0xe0)][_0x17072a(0x11c)](_0x17072a(0x12d),_0x17072a(0x108),_0x17072a(0x129)+_0x42e53f);throw new Error(_0x17072a(0xd4)+_0x446dfc);}console[_0x17072a(0x12b)](_0x17072a(0x128)),console['log'](_0x17072a(0xd7),JSON[_0x17072a(0xfb)](_0x551cff,null,0x2)),loggerService_1[_0x17072a(0xe0)][_0x17072a(0x138)]('noda','/payment-links',_0x4e7f9e[_0x17072a(0xf6)],_0x551cff,_0x31095a);if(_0x551cff['error']||_0x551cff['statusCode']){const _0x2e1d79=_0x551cff[_0x17072a(0xd0)]||_0x551cff['error']||_0x17072a(0xcb);console[_0x17072a(0xf5)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x17072a(0xf5)](_0x17072a(0x104),_0x2e1d79),console[_0x17072a(0xf5)](_0x17072a(0xc1),_0x551cff[_0x17072a(0x135)]),loggerService_1[_0x17072a(0xe0)]['logWhiteDomainError'](_0x17072a(0x12d),_0x17072a(0x108),_0x17072a(0xc5)+_0x2e1d79);throw new Error(_0x17072a(0xe9)+_0x2e1d79);}if(!_0x551cff['id']||!_0x551cff['shortLinkUrls']?.[_0x17072a(0x123)]){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x17072a(0xf5)](_0x17072a(0x10d)),console[_0x17072a(0xf5)](_0x17072a(0xc9),_0x551cff),loggerService_1['loggerService'][_0x17072a(0x11c)](_0x17072a(0x12d),_0x17072a(0x108),_0x17072a(0x137));throw new Error(_0x17072a(0x101));}return console[_0x17072a(0x12b)](_0x17072a(0x120)),console[_0x17072a(0x12b)](_0x17072a(0x107),_0x551cff['id']),console[_0x17072a(0x12b)](_0x17072a(0xd5),_0x551cff['shortLinkUrls'][_0x17072a(0x123)]),console[_0x17072a(0x12b)](_0x17072a(0xde),_0x551cff[_0x17072a(0xc3)][_0x17072a(0xdb)]||_0x17072a(0xe1)),console[_0x17072a(0x12b)](_0x17072a(0x102),_0x4b1626,_0x17072a(0xdc)),{'gateway_payment_id':_0x551cff['id'],'payment_url':_0x551cff['shortLinkUrls'][_0x17072a(0x123)],'qr_code_url':_0x551cff[_0x17072a(0xc3)]['qrCodeLink'],'expiry_date':_0x551cff[_0x17072a(0xe5)]};}catch(_0x57de75){console['error'](_0x17072a(0xed)),console[_0x17072a(0xf5)](_0x17072a(0xd1),_0x57de75),loggerService_1[_0x17072a(0xe0)][_0x17072a(0x11c)](_0x17072a(0x12d),'/payment-links',_0x57de75);if(_0x57de75 instanceof Error){console[_0x17072a(0xf5)](_0x17072a(0xef),_0x57de75[_0x17072a(0xd0)]),console['error']('Error\x20stack:',_0x57de75[_0x17072a(0x114)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x57de75[_0x17072a(0xd0)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x20bdbe(0x11f)](_0x487be4){const _0x16ff6c=a40_0x20bdbe,_0x16055e=Date[_0x16ff6c(0xfa)]();try{loggerService_1['loggerService'][_0x16ff6c(0x103)](_0x16ff6c(0x12d),_0x16ff6c(0x10f)+_0x487be4,_0x16ff6c(0xea),{});const _0x12d190=await fetch(this[_0x16ff6c(0xf1)]+'/'+_0x487be4,{'method':_0x16ff6c(0xea),'headers':{'Content-Type':_0x16ff6c(0x105),'User-Agent':_0x16ff6c(0xd2)}}),_0x4f9aab=Date[_0x16ff6c(0xfa)]()-_0x16055e;if(!_0x12d190['ok']){const _0x1849f7=await _0x12d190[_0x16ff6c(0xe6)]();loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0x16ff6c(0x10f)+_0x487be4,_0x12d190[_0x16ff6c(0xf6)],_0x1849f7,_0x4f9aab);throw new Error('HTTP\x20error!\x20status:\x20'+_0x12d190[_0x16ff6c(0xf6)]);}const _0x4fc47e=await _0x12d190['json']();loggerService_1['loggerService'][_0x16ff6c(0x138)]('noda',_0x16ff6c(0x10f)+_0x487be4,_0x12d190[_0x16ff6c(0xf6)],_0x4fc47e,_0x4f9aab);if(_0x4fc47e[_0x16ff6c(0xf5)]||_0x4fc47e[_0x16ff6c(0x135)]){loggerService_1['loggerService'][_0x16ff6c(0x11c)](_0x16ff6c(0x12d),'/payment-links/'+_0x487be4,_0x16ff6c(0xe9)+(_0x4fc47e['message']||_0x4fc47e[_0x16ff6c(0xf5)]||_0x16ff6c(0x133)));throw new Error(_0x16ff6c(0xe9)+(_0x4fc47e[_0x16ff6c(0xd0)]||_0x4fc47e[_0x16ff6c(0xf5)]||_0x16ff6c(0x133)));}let _0x7433f8=_0x16ff6c(0xe2);if(_0x4fc47e[_0x16ff6c(0xff)]===![]){if(_0x4fc47e[_0x16ff6c(0xe5)]){const _0x57e86c=new Date(_0x4fc47e[_0x16ff6c(0xe5)]),_0x18ec6d=new Date();_0x57e86c<_0x18ec6d?_0x7433f8='EXPIRED':_0x7433f8=_0x16ff6c(0xca);}else _0x7433f8=_0x16ff6c(0xca);}else _0x7433f8=_0x16ff6c(0xe2);return{'status':_0x7433f8,'amount':_0x4fc47e[_0x16ff6c(0x11b)],'currency':_0x4fc47e[_0x16ff6c(0xe4)],'isActive':_0x4fc47e[_0x16ff6c(0xff)]};}catch(_0x45e4d0){console[_0x16ff6c(0xf5)](_0x16ff6c(0x119),_0x45e4d0),loggerService_1[_0x16ff6c(0xe0)][_0x16ff6c(0x11c)]('noda',_0x16ff6c(0x10f)+_0x487be4,_0x45e4d0);throw new Error(_0x16ff6c(0x11d)+(_0x45e4d0 instanceof Error?_0x45e4d0[_0x16ff6c(0xd0)]:_0x16ff6c(0x133)));}}async[a40_0x20bdbe(0x121)](_0x26a976){const _0x4ea0f1=a40_0x20bdbe;console['log'](_0x4ea0f1(0x109),_0x26a976);let _0x102719=_0x4ea0f1(0xe2);switch(_0x26a976[_0x4ea0f1(0xe8)]?.[_0x4ea0f1(0x12c)]()){case _0x4ea0f1(0xdd):case'completed':case _0x4ea0f1(0x10e):case _0x4ea0f1(0xf8):case _0x4ea0f1(0x11a):_0x26a976[_0x4ea0f1(0xfe)]===_0x4ea0f1(0xc7)?_0x102719=_0x4ea0f1(0x134):_0x102719=_0x4ea0f1(0xe2);break;case _0x4ea0f1(0x124):case'canceled':case _0x4ea0f1(0xcc):case _0x4ea0f1(0xf5):case _0x4ea0f1(0x10c):_0x102719=_0x4ea0f1(0xca);break;case'expired':case _0x4ea0f1(0x130):_0x102719='EXPIRED';break;case _0x4ea0f1(0x106):case _0x4ea0f1(0xc8):case'active':case _0x4ea0f1(0xc4):case _0x4ea0f1(0xee):default:_0x102719='PENDING';break;}return{'paymentId':_0x26a976[_0x4ea0f1(0x127)]||_0x26a976[_0x4ea0f1(0x12e)],'status':_0x102719,'amount':_0x26a976[_0x4ea0f1(0x136)],'currency':_0x26a976[_0x4ea0f1(0xce)],'additionalInfo':{'method':_0x26a976['Method'],'bankId':_0x26a976['BankId'],'settled':_0x26a976[_0x4ea0f1(0xfe)],'settlementDate':_0x26a976[_0x4ea0f1(0x116)],'remitterName':_0x26a976[_0x4ea0f1(0x122)]?.[_0x4ea0f1(0x110)],'remitterIban':_0x26a976['Remitter']?.[_0x4ea0f1(0x100)],'bankTransactionId':_0x26a976[_0x4ea0f1(0x12f)]}};}[a40_0x20bdbe(0xeb)](_0x33e432,_0x557a3b){const _0x2e64e3=a40_0x20bdbe;return console[_0x2e64e3(0x12b)](_0x2e64e3(0xd8),{'receivedSignature':_0x557a3b,'paymentId':_0x33e432['PaymentId'],'merchantPaymentId':_0x33e432[_0x2e64e3(0x127)]}),!![];}}exports[a40_0x20bdbe(0xf3)]=NodaService;