'use strict';function a46_0x1392(){const _0x5f0853=['Business\x20Error:\x20','BankTransactionId','logWhiteDomainRequest','headers','Unknown\x20error','application/json','3264108WeVVlW','MerchantPaymentId','Method','Remitter','14HsTjKQ','logWhiteDomainError','error','amount','Not\x20provided','Failed\x20to\x20parse\x20JSON\x20response:','8798PUWhjb','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','log','failed','expiryDate','text','../loggerService','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Status\x20Text:','createPaymentLink','canceled','now','Processing\x20Noda\x20webhook:','shortLink','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','POST','processWebhook','PENDING','Error\x20message:','/payment-links','Headers:','fromEntries','FAILED','Raw\x20Response\x20Body:','successful','entries','completed','Error\x20Message:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','shortLinkUrls','381EvsvfG','Order\x20ID\x20Format:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','PAID','status','(8digits-8digits\x20format\x20for\x20Noda)','TesSoft\x20Payment\x20System/1.0','10zcUSzI','statusCode','Status','toUpperCase','apiUrl','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Failed\x20to\x20verify\x20Noda\x20payment:\x20','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','NodaService','===\x20NODA\x20SUCCESS\x20===','1109876tosOPv','Status\x20Code:','loggerService','paid','SettlementDate','===\x20NODA\x20API\x20ERROR\x20===','expired','isActive','Payment\x20Link\x20ID:','Unknown\x20error\x20from\x20Noda\x20API','qrCodeLink','HTTP\x20','Amount','Order\x20ID\x20Used:','EXPIRED','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','verifyWebhookSignature','/payment-links/','toLowerCase','active','11434528RWMzlz',',\x20body:\x20','HTTP\x20error!\x20status:\x20','stack','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','stringify','(8digits-8digits\x20format)','Response\x20Body:','logWhiteDomainResponse','pending','GET','Noda\x20API\x20error:\x20','Short\x20Link:','Response\x20Time:','Request\x20Body\x20(Direct\x20JSON):','Settled','URL:','message','7164162XHAsAy','noda','PaymentId','2964288CNPRUn','verifyPayment','Response\x20data:','HTTP\x20Status:','2570275dhEmvb','Name','Error\x20stack:','Status:','in_progress','BankId','https://tesoft.uk/gateway/noda/','Yes','JSON\x20Parse\x20Error:\x20','defineProperty'];a46_0x1392=function(){return _0x5f0853;};return a46_0x1392();}function a46_0x45cd(_0x5e8eac,_0x4b917e){const _0x1392e9=a46_0x1392();return a46_0x45cd=function(_0x45cd04,_0x3c836d){_0x45cd04=_0x45cd04-0x19c;let _0x270a46=_0x1392e9[_0x45cd04];return _0x270a46;},a46_0x45cd(_0x5e8eac,_0x4b917e);}const a46_0x30fb90=a46_0x45cd;(function(_0x59f8c5,_0x455b99){const _0x3c9e05=a46_0x45cd,_0x207fda=_0x59f8c5();while(!![]){try{const _0x2d215c=-parseInt(_0x3c9e05(0x1ca))/0x1+-parseInt(_0x3c9e05(0x211))/0x2*(-parseInt(_0x3c9e05(0x1b9))/0x3)+-parseInt(_0x3c9e05(0x1f3))/0x4+parseInt(_0x3c9e05(0x1f7))/0x5+parseInt(_0x3c9e05(0x207))/0x6*(parseInt(_0x3c9e05(0x20b))/0x7)+parseInt(_0x3c9e05(0x1de))/0x8+parseInt(_0x3c9e05(0x1f0))/0x9*(-parseInt(_0x3c9e05(0x1c0))/0xa);if(_0x2d215c===_0x455b99)break;else _0x207fda['push'](_0x207fda['shift']());}catch(_0x75eee0){_0x207fda['push'](_0x207fda['shift']());}}}(a46_0x1392,0xe640a));Object[a46_0x30fb90(0x200)](exports,'__esModule',{'value':!![]}),exports[a46_0x30fb90(0x1c8)]=void 0x0;const loggerService_1=require(a46_0x30fb90(0x1a1));class NodaService{constructor(){const _0x2583ec=a46_0x30fb90;this[_0x2583ec(0x1c4)]=_0x2583ec(0x1fd),console[_0x2583ec(0x19d)](_0x2583ec(0x1a2));}async[a46_0x30fb90(0x1a4)](_0x290511){const _0x41cf52=a46_0x30fb90,{orderId:_0x487a94,name:_0x338c9a,paymentDescription:_0x2f1a30,amount:_0x3dd87d,currency:_0x57221e,webhookUrl:_0x4cf056,returnUrl:_0x595043,expiryDate:_0x29fce3}=_0x290511,_0x2ea55c=_0x57221e[_0x41cf52(0x1c3)](),_0x12ebf7='https://tesoft.uk/gateway/noda/webhook/',_0x2b9c30='https://tesoft.uk/gateway/pending.php?id='+_0x487a94,_0x3d8806={'name':_0x338c9a,'paymentDescription':_0x2f1a30,'amount':_0x3dd87d,'currency':_0x2ea55c,'paymentId':_0x487a94,'webhookUrl':_0x12ebf7,'returnUrl':_0x2b9c30};_0x29fce3&&(_0x3d8806[_0x41cf52(0x19f)]=_0x29fce3);const _0x489fc7=Date[_0x41cf52(0x1a6)]();try{console[_0x41cf52(0x19d)](_0x41cf52(0x1bb)),console[_0x41cf52(0x19d)](_0x41cf52(0x1ee),this[_0x41cf52(0x1c4)]),console[_0x41cf52(0x19d)](_0x41cf52(0x1ec),JSON[_0x41cf52(0x1e3)](_0x3d8806,null,0x2)),console[_0x41cf52(0x19d)](_0x41cf52(0x1ba),_0x487a94,_0x41cf52(0x1be)),console[_0x41cf52(0x19d)](_0x41cf52(0x1e2),_0x2b9c30),loggerService_1[_0x41cf52(0x1cc)][_0x41cf52(0x203)](_0x41cf52(0x1f1),_0x41cf52(0x1ae),'POST',_0x3d8806);const _0x8faa41=await fetch(this[_0x41cf52(0x1c4)],{'method':_0x41cf52(0x1aa),'headers':{'Content-Type':'application/json','Accept':_0x41cf52(0x206),'User-Agent':_0x41cf52(0x1bf)},'body':JSON[_0x41cf52(0x1e3)](_0x3d8806)}),_0x5bf050=Date[_0x41cf52(0x1a6)]()-_0x489fc7;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x41cf52(0x19d)](_0x41cf52(0x1fa),_0x8faa41[_0x41cf52(0x1bd)]),console['log'](_0x41cf52(0x1a3),_0x8faa41['statusText']),console[_0x41cf52(0x19d)](_0x41cf52(0x1af),Object[_0x41cf52(0x1b0)](_0x8faa41[_0x41cf52(0x204)][_0x41cf52(0x1b4)]())),console['log'](_0x41cf52(0x1eb),_0x5bf050+'ms');const _0x1080f8=await _0x8faa41[_0x41cf52(0x1a0)]();console['log'](_0x41cf52(0x1b2),_0x1080f8);if(!_0x8faa41['ok']){console[_0x41cf52(0x20d)](_0x41cf52(0x1cf)),console[_0x41cf52(0x20d)](_0x41cf52(0x1f6),_0x8faa41[_0x41cf52(0x1bd)]),console[_0x41cf52(0x20d)](_0x41cf52(0x1e5),_0x1080f8),loggerService_1[_0x41cf52(0x1cc)][_0x41cf52(0x1e6)](_0x41cf52(0x1f1),_0x41cf52(0x1ae),_0x8faa41[_0x41cf52(0x1bd)],_0x1080f8,_0x5bf050),loggerService_1[_0x41cf52(0x1cc)][_0x41cf52(0x20c)](_0x41cf52(0x1f1),'/payment-links',_0x41cf52(0x1d5)+_0x8faa41[_0x41cf52(0x1bd)]+':\x20'+_0x1080f8);if(_0x8faa41['status']===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x8faa41['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x41cf52(0x1e0)+_0x8faa41['status']+_0x41cf52(0x1df)+_0x1080f8);}let _0x1afdbe;try{_0x1afdbe=JSON['parse'](_0x1080f8);}catch(_0xbe288c){console['error'](_0x41cf52(0x210),_0xbe288c),loggerService_1['loggerService'][_0x41cf52(0x20c)](_0x41cf52(0x1f1),_0x41cf52(0x1ae),_0x41cf52(0x1ff)+_0xbe288c);throw new Error(_0x41cf52(0x1a9)+_0x1080f8);}console[_0x41cf52(0x19d)](_0x41cf52(0x1c5)),console['log']('Parsed\x20Result:',JSON['stringify'](_0x1afdbe,null,0x2)),loggerService_1[_0x41cf52(0x1cc)][_0x41cf52(0x1e6)]('noda',_0x41cf52(0x1ae),_0x8faa41[_0x41cf52(0x1bd)],_0x1afdbe,_0x5bf050);if(_0x1afdbe[_0x41cf52(0x20d)]||_0x1afdbe[_0x41cf52(0x1c1)]){const _0x58061e=_0x1afdbe[_0x41cf52(0x1ef)]||_0x1afdbe[_0x41cf52(0x20d)]||_0x41cf52(0x1d3);console[_0x41cf52(0x20d)](_0x41cf52(0x1c7)),console[_0x41cf52(0x20d)](_0x41cf52(0x1b6),_0x58061e),console[_0x41cf52(0x20d)](_0x41cf52(0x1cb),_0x1afdbe['statusCode']),loggerService_1[_0x41cf52(0x1cc)]['logWhiteDomainError'](_0x41cf52(0x1f1),_0x41cf52(0x1ae),_0x41cf52(0x201)+_0x58061e);throw new Error(_0x41cf52(0x1e9)+_0x58061e);}if(!_0x1afdbe['id']||!_0x1afdbe[_0x41cf52(0x1b8)]?.['shortLink']){console[_0x41cf52(0x20d)](_0x41cf52(0x1d9)),console[_0x41cf52(0x20d)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x41cf52(0x20d)](_0x41cf52(0x1f5),_0x1afdbe),loggerService_1['loggerService'][_0x41cf52(0x20c)]('noda',_0x41cf52(0x1ae),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x41cf52(0x1b7));}return console[_0x41cf52(0x19d)](_0x41cf52(0x1c9)),console[_0x41cf52(0x19d)](_0x41cf52(0x1d2),_0x1afdbe['id']),console['log'](_0x41cf52(0x1ea),_0x1afdbe[_0x41cf52(0x1b8)][_0x41cf52(0x1a8)]),console[_0x41cf52(0x19d)]('QR\x20Code\x20Link:',_0x1afdbe[_0x41cf52(0x1b8)][_0x41cf52(0x1d4)]||_0x41cf52(0x20f)),console[_0x41cf52(0x19d)](_0x41cf52(0x1d7),_0x487a94,_0x41cf52(0x1e4)),console[_0x41cf52(0x19d)](_0x41cf52(0x19c),_0x2b9c30),{'gateway_payment_id':_0x1afdbe['id'],'payment_url':_0x1afdbe[_0x41cf52(0x1b8)][_0x41cf52(0x1a8)],'qr_code_url':_0x1afdbe[_0x41cf52(0x1b8)][_0x41cf52(0x1d4)],'expiry_date':_0x1afdbe['expiryDate']};}catch(_0x3cec81){console[_0x41cf52(0x20d)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x41cf52(0x20d)]('Error\x20details:',_0x3cec81),loggerService_1[_0x41cf52(0x1cc)][_0x41cf52(0x20c)](_0x41cf52(0x1f1),_0x41cf52(0x1ae),_0x3cec81);if(_0x3cec81 instanceof Error){console[_0x41cf52(0x20d)](_0x41cf52(0x1ad),_0x3cec81[_0x41cf52(0x1ef)]),console[_0x41cf52(0x20d)](_0x41cf52(0x1f9),_0x3cec81[_0x41cf52(0x1e1)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x3cec81[_0x41cf52(0x1ef)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a46_0x30fb90(0x1f4)](_0x38f0a1){const _0x2ee342=a46_0x30fb90,_0x3238b1=Date[_0x2ee342(0x1a6)]();try{loggerService_1[_0x2ee342(0x1cc)][_0x2ee342(0x203)](_0x2ee342(0x1f1),_0x2ee342(0x1db)+_0x38f0a1,_0x2ee342(0x1e8),{});const _0x13d2bb=await fetch(this[_0x2ee342(0x1c4)]+'/'+_0x38f0a1,{'method':_0x2ee342(0x1e8),'headers':{'Content-Type':_0x2ee342(0x206),'User-Agent':_0x2ee342(0x1bf)}}),_0x16156a=Date[_0x2ee342(0x1a6)]()-_0x3238b1;if(!_0x13d2bb['ok']){const _0x1043d9=await _0x13d2bb[_0x2ee342(0x1a0)]();loggerService_1[_0x2ee342(0x1cc)][_0x2ee342(0x1e6)](_0x2ee342(0x1f1),'/payment-links/'+_0x38f0a1,_0x13d2bb['status'],_0x1043d9,_0x16156a);throw new Error(_0x2ee342(0x1e0)+_0x13d2bb[_0x2ee342(0x1bd)]);}const _0x305a7f=await _0x13d2bb['json']();loggerService_1['loggerService'][_0x2ee342(0x1e6)](_0x2ee342(0x1f1),_0x2ee342(0x1db)+_0x38f0a1,_0x13d2bb[_0x2ee342(0x1bd)],_0x305a7f,_0x16156a);if(_0x305a7f[_0x2ee342(0x20d)]||_0x305a7f[_0x2ee342(0x1c1)]){loggerService_1[_0x2ee342(0x1cc)]['logWhiteDomainError']('noda',_0x2ee342(0x1db)+_0x38f0a1,_0x2ee342(0x1e9)+(_0x305a7f[_0x2ee342(0x1ef)]||_0x305a7f[_0x2ee342(0x20d)]||_0x2ee342(0x205)));throw new Error(_0x2ee342(0x1e9)+(_0x305a7f['message']||_0x305a7f[_0x2ee342(0x20d)]||_0x2ee342(0x205)));}let _0x3789c8=_0x2ee342(0x1ac);if(_0x305a7f[_0x2ee342(0x1d1)]===![]){if(_0x305a7f[_0x2ee342(0x19f)]){const _0x2059a6=new Date(_0x305a7f[_0x2ee342(0x19f)]),_0x1822e2=new Date();_0x2059a6<_0x1822e2?_0x3789c8=_0x2ee342(0x1d8):_0x3789c8=_0x2ee342(0x1b1);}else _0x3789c8=_0x2ee342(0x1b1);}else _0x3789c8=_0x2ee342(0x1ac);return{'status':_0x3789c8,'amount':_0x305a7f[_0x2ee342(0x20e)],'currency':_0x305a7f['currency'],'isActive':_0x305a7f[_0x2ee342(0x1d1)]};}catch(_0x4ebb3c){console['error']('Noda\x20payment\x20verification\x20error:',_0x4ebb3c),loggerService_1[_0x2ee342(0x1cc)]['logWhiteDomainError'](_0x2ee342(0x1f1),_0x2ee342(0x1db)+_0x38f0a1,_0x4ebb3c);throw new Error(_0x2ee342(0x1c6)+(_0x4ebb3c instanceof Error?_0x4ebb3c[_0x2ee342(0x1ef)]:_0x2ee342(0x205)));}}async[a46_0x30fb90(0x1ab)](_0x1e6a28){const _0x5609c3=a46_0x30fb90;console[_0x5609c3(0x19d)](_0x5609c3(0x1a7),_0x1e6a28);let _0x43ceba=_0x5609c3(0x1ac);switch(_0x1e6a28[_0x5609c3(0x1c2)]?.[_0x5609c3(0x1dc)]()){case'done':case _0x5609c3(0x1b5):case _0x5609c3(0x1cd):case'success':case _0x5609c3(0x1b3):_0x1e6a28['Settled']===_0x5609c3(0x1fe)?_0x43ceba=_0x5609c3(0x1bc):_0x43ceba=_0x5609c3(0x1ac);break;case'cancelled':case _0x5609c3(0x1a5):case _0x5609c3(0x19e):case _0x5609c3(0x20d):case'rejected':_0x43ceba=_0x5609c3(0x1b1);break;case _0x5609c3(0x1d0):case'timeout':_0x43ceba='EXPIRED';break;case _0x5609c3(0x1e7):case'created':case _0x5609c3(0x1dd):case'processing':case _0x5609c3(0x1fb):default:_0x43ceba='PENDING';break;}return{'paymentId':_0x1e6a28[_0x5609c3(0x208)]||_0x1e6a28[_0x5609c3(0x1f2)],'status':_0x43ceba,'amount':_0x1e6a28[_0x5609c3(0x1d6)],'currency':_0x1e6a28['Currency'],'additionalInfo':{'method':_0x1e6a28[_0x5609c3(0x209)],'bankId':_0x1e6a28[_0x5609c3(0x1fc)],'settled':_0x1e6a28[_0x5609c3(0x1ed)],'settlementDate':_0x1e6a28[_0x5609c3(0x1ce)],'remitterName':_0x1e6a28[_0x5609c3(0x20a)]?.[_0x5609c3(0x1f8)],'remitterIban':_0x1e6a28[_0x5609c3(0x20a)]?.['Iban'],'bankTransactionId':_0x1e6a28[_0x5609c3(0x202)]}};}[a46_0x30fb90(0x1da)](_0x8cade4,_0x565b8c){const _0x5c7551=a46_0x30fb90;return console[_0x5c7551(0x19d)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x565b8c,'paymentId':_0x8cade4['PaymentId'],'merchantPaymentId':_0x8cade4[_0x5c7551(0x208)]}),!![];}}exports['NodaService']=NodaService;