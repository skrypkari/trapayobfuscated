'use strict';const a63_0x109be8=a63_0x2cb7;function a63_0x2b63(){const _0x209610=['expired','defineProperty','FAILED','https://tesoft.uk/gateway/pending.php?id=','BankTransactionId','HTTP\x20error!\x20status:\x20','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Noda\x20payment\x20verification\x20error:','https://tesoft.uk/gateway/noda/webhook/','/payment-links/','headers','in_progress','Error\x20details:','81vDFmyJ','apiUrl','EXPIRED','Method','isActive','351FdulXW','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Headers:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','QR\x20Code\x20Link:','parse','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','success','Response\x20data:','failed','Noda\x20webhook\x20signature\x20verification:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','(8digits-8digits\x20format\x20for\x20Noda)','Status\x20Text:','paid','loggerService','../loggerService','error','Amount','Remitter','Failed\x20to\x20parse\x20JSON\x20response:','3TNEMiO','SettlementDate','1002228SfQuti','Status:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','PaymentId','currency','Iban','now','GET','text','JSON\x20Parse\x20Error:\x20','noda','logWhiteDomainError','Business\x20Error:\x20','1218480jFHjlt','log',',\x20body:\x20','completed','processing','Settled','expiryDate','timeout','NodaService','stack','Unknown\x20error','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','successful','verifyPayment','4bxaPJM','logWhiteDomainResponse','fromEntries','stringify','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','__esModule','722961xoxDFU','6mRjFnd','PENDING','POST','application/json','Processing\x20Noda\x20webhook:','amount','URL:','HTTP\x20Status:','verifyWebhookSignature','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','7116436wKdeqf','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','MerchantPaymentId','pending','shortLinkUrls','Order\x20ID\x20Format:','processWebhook','done','qrCodeLink','https://tesoft.uk/gateway/noda/','json','toUpperCase','rejected','Request\x20Body\x20(Direct\x20JSON):','Short\x20Link:','1199emurOe','Payment\x20Link\x20ID:','message','Currency','Unknown\x20error\x20from\x20Noda\x20API','BankId','1981365RTwNYJ','Payment\x20System/1.0','Error\x20Message:','/payment-links','status','shortLink','Noda\x20API\x20error:\x20','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','logWhiteDomainRequest','Error\x20stack:','statusText','===\x20NODA\x20API\x20ERROR\x20===','Parsed\x20Result:','PAID','Name','29390lEcQqz','Status','2390521KUyYbY','Not\x20provided'];a63_0x2b63=function(){return _0x209610;};return a63_0x2b63();}(function(_0x3bc5ad,_0x5651e6){const _0x3d81e8=a63_0x2cb7,_0x7422a2=_0x3bc5ad();while(!![]){try{const _0x4e132e=-parseInt(_0x3d81e8(0x1b6))/0x1*(-parseInt(_0x3d81e8(0x1b0))/0x2)+parseInt(_0x3d81e8(0x193))/0x3*(-parseInt(_0x3d81e8(0x1c1))/0x4)+parseInt(_0x3d81e8(0x1d6))/0x5+-parseInt(_0x3d81e8(0x1b7))/0x6*(parseInt(_0x3d81e8(0x16a))/0x7)+-parseInt(_0x3d81e8(0x1a2))/0x8*(parseInt(_0x3d81e8(0x179))/0x9)+-parseInt(_0x3d81e8(0x168))/0xa*(-parseInt(_0x3d81e8(0x1d0))/0xb)+parseInt(_0x3d81e8(0x195))/0xc*(parseInt(_0x3d81e8(0x17e))/0xd);if(_0x4e132e===_0x5651e6)break;else _0x7422a2['push'](_0x7422a2['shift']());}catch(_0x2cd069){_0x7422a2['push'](_0x7422a2['shift']());}}}(a63_0x2b63,0xe21cd));Object[a63_0x109be8(0x16d)](exports,a63_0x109be8(0x1b5),{'value':!![]}),exports[a63_0x109be8(0x1aa)]=void 0x0;const loggerService_1=require(a63_0x109be8(0x18e));class NodaService{constructor(){const _0x5cc9f3=a63_0x109be8;this['apiUrl']=_0x5cc9f3(0x1ca),console[_0x5cc9f3(0x1a3)](_0x5cc9f3(0x1ad));}async['createPaymentLink'](_0x4dd931){const _0x1c2da0=a63_0x109be8,{orderId:_0xeea3ff,name:_0x56e52d,paymentDescription:_0x4215a1,amount:_0x28205b,currency:_0xc7b5f3,webhookUrl:_0x43a375,returnUrl:_0x35e062,expiryDate:_0x189165}=_0x4dd931,_0x2d1da2=_0xc7b5f3[_0x1c2da0(0x1cc)](),_0x12e6c2=_0x1c2da0(0x174),_0x1744a8=_0x1c2da0(0x16f)+_0xeea3ff,_0x59d9e0={'name':_0x56e52d,'paymentDescription':_0x4215a1,'amount':_0x28205b,'currency':_0x2d1da2,'paymentId':_0xeea3ff,'webhookUrl':_0x12e6c2,'returnUrl':_0x1744a8};_0x189165&&(_0x59d9e0[_0x1c2da0(0x1a8)]=_0x189165);const _0x27db06=Date[_0x1c2da0(0x19b)]();try{console[_0x1c2da0(0x1a3)](_0x1c2da0(0x160)),console['log'](_0x1c2da0(0x1bd),this[_0x1c2da0(0x17a)]),console[_0x1c2da0(0x1a3)](_0x1c2da0(0x1ce),JSON[_0x1c2da0(0x1b3)](_0x59d9e0,null,0x2)),console['log'](_0x1c2da0(0x1c6),_0xeea3ff,_0x1c2da0(0x18a)),console['log']('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x1744a8),loggerService_1[_0x1c2da0(0x18d)][_0x1c2da0(0x161)](_0x1c2da0(0x19f),_0x1c2da0(0x15c),_0x1c2da0(0x1b9),_0x59d9e0);const _0x5c303e=await fetch(this[_0x1c2da0(0x17a)],{'method':_0x1c2da0(0x1b9),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x1c2da0(0x1d7)},'body':JSON['stringify'](_0x59d9e0)}),_0x5b7c57=Date[_0x1c2da0(0x19b)]()-_0x27db06;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x1c2da0(0x1a3)](_0x1c2da0(0x196),_0x5c303e[_0x1c2da0(0x15d)]),console['log'](_0x1c2da0(0x18b),_0x5c303e[_0x1c2da0(0x163)]),console[_0x1c2da0(0x1a3)](_0x1c2da0(0x180),Object[_0x1c2da0(0x1b2)](_0x5c303e[_0x1c2da0(0x176)]['entries']())),console['log']('Response\x20Time:',_0x5b7c57+'ms');const _0x38c929=await _0x5c303e[_0x1c2da0(0x19d)]();console[_0x1c2da0(0x1a3)]('Raw\x20Response\x20Body:',_0x38c929);if(!_0x5c303e['ok']){console[_0x1c2da0(0x18f)](_0x1c2da0(0x164)),console[_0x1c2da0(0x18f)](_0x1c2da0(0x1be),_0x5c303e[_0x1c2da0(0x15d)]),console['error']('Response\x20Body:',_0x38c929),loggerService_1[_0x1c2da0(0x18d)]['logWhiteDomainResponse'](_0x1c2da0(0x19f),_0x1c2da0(0x15c),_0x5c303e[_0x1c2da0(0x15d)],_0x38c929,_0x5b7c57),loggerService_1['loggerService']['logWhiteDomainError'](_0x1c2da0(0x19f),_0x1c2da0(0x15c),'HTTP\x20'+_0x5c303e[_0x1c2da0(0x15d)]+':\x20'+_0x38c929);if(_0x5c303e[_0x1c2da0(0x15d)]===0x190)throw new Error(_0x1c2da0(0x17f));else{if(_0x5c303e[_0x1c2da0(0x15d)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x1c2da0(0x171)+_0x5c303e[_0x1c2da0(0x15d)]+_0x1c2da0(0x1a4)+_0x38c929);}let _0xdfd0d6;try{_0xdfd0d6=JSON[_0x1c2da0(0x183)](_0x38c929);}catch(_0x325e5f){console['error'](_0x1c2da0(0x192),_0x325e5f),loggerService_1[_0x1c2da0(0x18d)][_0x1c2da0(0x1a0)](_0x1c2da0(0x19f),'/payment-links',_0x1c2da0(0x19e)+_0x325e5f);throw new Error(_0x1c2da0(0x197)+_0x38c929);}console[_0x1c2da0(0x1a3)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x1c2da0(0x1a3)](_0x1c2da0(0x165),JSON[_0x1c2da0(0x1b3)](_0xdfd0d6,null,0x2)),loggerService_1[_0x1c2da0(0x18d)][_0x1c2da0(0x1b1)](_0x1c2da0(0x19f),_0x1c2da0(0x15c),_0x5c303e[_0x1c2da0(0x15d)],_0xdfd0d6,_0x5b7c57);if(_0xdfd0d6[_0x1c2da0(0x18f)]||_0xdfd0d6['statusCode']){const _0x397599=_0xdfd0d6[_0x1c2da0(0x1d2)]||_0xdfd0d6[_0x1c2da0(0x18f)]||_0x1c2da0(0x1d4);console[_0x1c2da0(0x18f)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x1c2da0(0x18f)](_0x1c2da0(0x15b),_0x397599),console['error']('Status\x20Code:',_0xdfd0d6['statusCode']),loggerService_1[_0x1c2da0(0x18d)][_0x1c2da0(0x1a0)]('noda',_0x1c2da0(0x15c),_0x1c2da0(0x1a1)+_0x397599);throw new Error(_0x1c2da0(0x15f)+_0x397599);}if(!_0xdfd0d6['id']||!_0xdfd0d6['shortLinkUrls']?.[_0x1c2da0(0x15e)]){console[_0x1c2da0(0x18f)](_0x1c2da0(0x1b4)),console[_0x1c2da0(0x18f)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x1c2da0(0x18f)](_0x1c2da0(0x186),_0xdfd0d6),loggerService_1['loggerService']['logWhiteDomainError'](_0x1c2da0(0x19f),_0x1c2da0(0x15c),_0x1c2da0(0x1c2));throw new Error(_0x1c2da0(0x172));}return console[_0x1c2da0(0x1a3)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x1c2da0(0x1a3)](_0x1c2da0(0x1d1),_0xdfd0d6['id']),console['log'](_0x1c2da0(0x1cf),_0xdfd0d6[_0x1c2da0(0x1c5)][_0x1c2da0(0x15e)]),console[_0x1c2da0(0x1a3)](_0x1c2da0(0x182),_0xdfd0d6[_0x1c2da0(0x1c5)][_0x1c2da0(0x1c9)]||_0x1c2da0(0x16b)),console[_0x1c2da0(0x1a3)]('Order\x20ID\x20Used:',_0xeea3ff,'(8digits-8digits\x20format)'),console['log'](_0x1c2da0(0x1c0),_0x1744a8),{'gateway_payment_id':_0xdfd0d6['id'],'payment_url':_0xdfd0d6[_0x1c2da0(0x1c5)][_0x1c2da0(0x15e)],'qr_code_url':_0xdfd0d6['shortLinkUrls'][_0x1c2da0(0x1c9)],'expiry_date':_0xdfd0d6['expiryDate']};}catch(_0x4dcf2a){console[_0x1c2da0(0x18f)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console['error'](_0x1c2da0(0x178),_0x4dcf2a),loggerService_1['loggerService'][_0x1c2da0(0x1a0)]('noda',_0x1c2da0(0x15c),_0x4dcf2a);if(_0x4dcf2a instanceof Error){console[_0x1c2da0(0x18f)]('Error\x20message:',_0x4dcf2a[_0x1c2da0(0x1d2)]),console[_0x1c2da0(0x18f)](_0x1c2da0(0x162),_0x4dcf2a[_0x1c2da0(0x1ab)]);throw new Error(_0x1c2da0(0x189)+_0x4dcf2a[_0x1c2da0(0x1d2)]);}throw new Error(_0x1c2da0(0x184));}}async[a63_0x109be8(0x1af)](_0x417d90){const _0x4f3818=a63_0x109be8,_0x19074a=Date[_0x4f3818(0x19b)]();try{loggerService_1[_0x4f3818(0x18d)]['logWhiteDomainRequest'](_0x4f3818(0x19f),'/payment-links/'+_0x417d90,_0x4f3818(0x19c),{});const _0x43b492=await fetch(this[_0x4f3818(0x17a)]+'/'+_0x417d90,{'method':_0x4f3818(0x19c),'headers':{'Content-Type':_0x4f3818(0x1ba),'User-Agent':'Payment\x20System/1.0'}}),_0x2257aa=Date[_0x4f3818(0x19b)]()-_0x19074a;if(!_0x43b492['ok']){const _0x53df53=await _0x43b492[_0x4f3818(0x19d)]();loggerService_1[_0x4f3818(0x18d)][_0x4f3818(0x1b1)]('noda','/payment-links/'+_0x417d90,_0x43b492['status'],_0x53df53,_0x2257aa);throw new Error(_0x4f3818(0x171)+_0x43b492['status']);}const _0x56989c=await _0x43b492[_0x4f3818(0x1cb)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4f3818(0x19f),_0x4f3818(0x175)+_0x417d90,_0x43b492[_0x4f3818(0x15d)],_0x56989c,_0x2257aa);if(_0x56989c[_0x4f3818(0x18f)]||_0x56989c['statusCode']){loggerService_1[_0x4f3818(0x18d)]['logWhiteDomainError'](_0x4f3818(0x19f),_0x4f3818(0x175)+_0x417d90,_0x4f3818(0x15f)+(_0x56989c[_0x4f3818(0x1d2)]||_0x56989c['error']||_0x4f3818(0x1ac)));throw new Error(_0x4f3818(0x15f)+(_0x56989c[_0x4f3818(0x1d2)]||_0x56989c[_0x4f3818(0x18f)]||'Unknown\x20error'));}let _0x2e05d8=_0x4f3818(0x1b8);if(_0x56989c[_0x4f3818(0x17d)]===![]){if(_0x56989c['expiryDate']){const _0x429514=new Date(_0x56989c['expiryDate']),_0xc74839=new Date();_0x429514<_0xc74839?_0x2e05d8='EXPIRED':_0x2e05d8=_0x4f3818(0x16e);}else _0x2e05d8=_0x4f3818(0x16e);}else _0x2e05d8=_0x4f3818(0x1b8);return{'status':_0x2e05d8,'amount':_0x56989c[_0x4f3818(0x1bc)],'currency':_0x56989c[_0x4f3818(0x199)],'isActive':_0x56989c['isActive']};}catch(_0x27cb48){console[_0x4f3818(0x18f)](_0x4f3818(0x173),_0x27cb48),loggerService_1['loggerService'][_0x4f3818(0x1a0)](_0x4f3818(0x19f),_0x4f3818(0x175)+_0x417d90,_0x27cb48);throw new Error(_0x4f3818(0x181)+(_0x27cb48 instanceof Error?_0x27cb48[_0x4f3818(0x1d2)]:_0x4f3818(0x1ac)));}}async[a63_0x109be8(0x1c7)](_0x1979d9){const _0x36387c=a63_0x109be8;console[_0x36387c(0x1a3)](_0x36387c(0x1bb),_0x1979d9);let _0x34437a=_0x36387c(0x1b8);switch(_0x1979d9[_0x36387c(0x169)]?.['toLowerCase']()){case _0x36387c(0x1c8):case _0x36387c(0x1a5):case _0x36387c(0x18c):case _0x36387c(0x185):case _0x36387c(0x1ae):_0x1979d9[_0x36387c(0x1a7)]==='Yes'?_0x34437a=_0x36387c(0x166):_0x34437a=_0x36387c(0x1b8);break;case'cancelled':case'canceled':case _0x36387c(0x187):case _0x36387c(0x18f):case _0x36387c(0x1cd):_0x34437a=_0x36387c(0x16e);break;case _0x36387c(0x16c):case _0x36387c(0x1a9):_0x34437a=_0x36387c(0x17b);break;case _0x36387c(0x1c4):case'created':case'active':case _0x36387c(0x1a6):case _0x36387c(0x177):default:_0x34437a='PENDING';break;}return{'paymentId':_0x1979d9['MerchantPaymentId']||_0x1979d9['PaymentId'],'status':_0x34437a,'amount':_0x1979d9[_0x36387c(0x190)],'currency':_0x1979d9[_0x36387c(0x1d3)],'additionalInfo':{'method':_0x1979d9[_0x36387c(0x17c)],'bankId':_0x1979d9[_0x36387c(0x1d5)],'settled':_0x1979d9[_0x36387c(0x1a7)],'settlementDate':_0x1979d9[_0x36387c(0x194)],'remitterName':_0x1979d9[_0x36387c(0x191)]?.[_0x36387c(0x167)],'remitterIban':_0x1979d9['Remitter']?.[_0x36387c(0x19a)],'bankTransactionId':_0x1979d9[_0x36387c(0x170)]}};}[a63_0x109be8(0x1bf)](_0x2a2f7d,_0xf8879a){const _0x30c323=a63_0x109be8;return console['log'](_0x30c323(0x188),{'receivedSignature':_0xf8879a,'paymentId':_0x2a2f7d[_0x30c323(0x198)],'merchantPaymentId':_0x2a2f7d[_0x30c323(0x1c3)]}),!![];}}function a63_0x2cb7(_0x46b47e,_0x2690bf){_0x46b47e=_0x46b47e-0x15b;const _0x2b6340=a63_0x2b63();let _0x2cb755=_0x2b6340[_0x46b47e];return _0x2cb755;}exports[a63_0x109be8(0x1aa)]=NodaService;