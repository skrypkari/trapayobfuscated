'use strict';const a60_0xf94ca8=a60_0x5b5e;(function(_0x41c9ba,_0x5b51aa){const _0x646d1d=a60_0x5b5e,_0x1a1e38=_0x41c9ba();while(!![]){try{const _0x5b2fb1=-parseInt(_0x646d1d(0x144))/0x1*(-parseInt(_0x646d1d(0x160))/0x2)+-parseInt(_0x646d1d(0x159))/0x3*(-parseInt(_0x646d1d(0x182))/0x4)+-parseInt(_0x646d1d(0x174))/0x5*(parseInt(_0x646d1d(0x119))/0x6)+-parseInt(_0x646d1d(0x14a))/0x7+-parseInt(_0x646d1d(0x167))/0x8+parseInt(_0x646d1d(0x147))/0x9*(-parseInt(_0x646d1d(0x17e))/0xa)+parseInt(_0x646d1d(0x17b))/0xb;if(_0x5b2fb1===_0x5b51aa)break;else _0x1a1e38['push'](_0x1a1e38['shift']());}catch(_0x4cbcf5){_0x1a1e38['push'](_0x1a1e38['shift']());}}}(a60_0x14aa,0x84a6e));Object[a60_0xf94ca8(0x169)](exports,'__esModule',{'value':!![]}),exports[a60_0xf94ca8(0x12e)]=void 0x0;const loggerService_1=require(a60_0xf94ca8(0x128));function a60_0x5b5e(_0x193695,_0x47ae66){_0x193695=_0x193695-0x10d;const _0x14aa85=a60_0x14aa();let _0x5b5e55=_0x14aa85[_0x193695];return _0x5b5e55;}class NodaService{constructor(){const _0x45c997=a60_0xf94ca8;this[_0x45c997(0x123)]=_0x45c997(0x176),console['log'](_0x45c997(0x116));}async[a60_0xf94ca8(0x141)](_0x1dc15b){const _0x2d2ef2=a60_0xf94ca8,{orderId:_0x142f8d,name:_0x3b613a,paymentDescription:_0x193ae6,amount:_0x50dd37,currency:_0x58fd75,webhookUrl:_0x1c22ac,returnUrl:_0x1e17db,expiryDate:_0x38ecfd}=_0x1dc15b,_0xd23aba=_0x58fd75[_0x2d2ef2(0x14d)](),_0x13c0ee=_0x2d2ef2(0x178),_0x24f1a1=_0x2d2ef2(0x15f)+_0x142f8d,_0x1bb091={'name':_0x3b613a,'paymentDescription':_0x193ae6,'amount':_0x50dd37,'currency':_0xd23aba,'paymentId':_0x142f8d,'webhookUrl':_0x13c0ee,'returnUrl':_0x24f1a1};_0x38ecfd&&(_0x1bb091['expiryDate']=_0x38ecfd);const _0x2d11c7=Date[_0x2d2ef2(0x129)]();try{console[_0x2d2ef2(0x12d)](_0x2d2ef2(0x14b)),console[_0x2d2ef2(0x12d)]('URL:',this[_0x2d2ef2(0x123)]),console[_0x2d2ef2(0x12d)](_0x2d2ef2(0x114),JSON['stringify'](_0x1bb091,null,0x2)),console[_0x2d2ef2(0x12d)](_0x2d2ef2(0x149),_0x142f8d,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x2d2ef2(0x12d)](_0x2d2ef2(0x130),_0x24f1a1),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x2d2ef2(0x112),_0x2d2ef2(0x10f),_0x2d2ef2(0x132),_0x1bb091);const _0x342c6f=await fetch(this[_0x2d2ef2(0x123)],{'method':_0x2d2ef2(0x132),'headers':{'Content-Type':'application/json','Accept':_0x2d2ef2(0x135),'User-Agent':_0x2d2ef2(0x125)},'body':JSON[_0x2d2ef2(0x164)](_0x1bb091)}),_0x53c1ef=Date['now']()-_0x2d11c7;console[_0x2d2ef2(0x12d)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x2d2ef2(0x12d)](_0x2d2ef2(0x142),_0x342c6f[_0x2d2ef2(0x118)]),console[_0x2d2ef2(0x12d)]('Status\x20Text:',_0x342c6f[_0x2d2ef2(0x179)]),console[_0x2d2ef2(0x12d)](_0x2d2ef2(0x146),Object[_0x2d2ef2(0x15c)](_0x342c6f['headers']['entries']())),console['log'](_0x2d2ef2(0x172),_0x53c1ef+'ms');const _0x4d73bf=await _0x342c6f[_0x2d2ef2(0x165)]();console[_0x2d2ef2(0x12d)](_0x2d2ef2(0x16e),_0x4d73bf);if(!_0x342c6f['ok']){console['error'](_0x2d2ef2(0x122)),console[_0x2d2ef2(0x145)]('HTTP\x20Status:',_0x342c6f[_0x2d2ef2(0x118)]),console[_0x2d2ef2(0x145)](_0x2d2ef2(0x175),_0x4d73bf),loggerService_1[_0x2d2ef2(0x151)][_0x2d2ef2(0x13c)]('noda','/payment-links',_0x342c6f[_0x2d2ef2(0x118)],_0x4d73bf,_0x53c1ef),loggerService_1[_0x2d2ef2(0x151)]['logWhiteDomainError'](_0x2d2ef2(0x112),_0x2d2ef2(0x10f),_0x2d2ef2(0x11d)+_0x342c6f['status']+':\x20'+_0x4d73bf);if(_0x342c6f[_0x2d2ef2(0x118)]===0x190)throw new Error(_0x2d2ef2(0x143));else{if(_0x342c6f[_0x2d2ef2(0x118)]===0x1f4)throw new Error(_0x2d2ef2(0x138));}throw new Error(_0x2d2ef2(0x16b)+_0x342c6f['status']+_0x2d2ef2(0x17f)+_0x4d73bf);}let _0x49879a;try{_0x49879a=JSON[_0x2d2ef2(0x110)](_0x4d73bf);}catch(_0x5d8565){console['error'](_0x2d2ef2(0x16a),_0x5d8565),loggerService_1['loggerService']['logWhiteDomainError'](_0x2d2ef2(0x112),_0x2d2ef2(0x10f),'JSON\x20Parse\x20Error:\x20'+_0x5d8565);throw new Error(_0x2d2ef2(0x158)+_0x4d73bf);}console[_0x2d2ef2(0x12d)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x2d2ef2(0x12d)](_0x2d2ef2(0x127),JSON[_0x2d2ef2(0x164)](_0x49879a,null,0x2)),loggerService_1['loggerService'][_0x2d2ef2(0x13c)](_0x2d2ef2(0x112),_0x2d2ef2(0x10f),_0x342c6f[_0x2d2ef2(0x118)],_0x49879a,_0x53c1ef);if(_0x49879a['error']||_0x49879a[_0x2d2ef2(0x12a)]){const _0x1d69b9=_0x49879a[_0x2d2ef2(0x163)]||_0x49879a[_0x2d2ef2(0x145)]||_0x2d2ef2(0x117);console[_0x2d2ef2(0x145)](_0x2d2ef2(0x11e)),console[_0x2d2ef2(0x145)](_0x2d2ef2(0x10e),_0x1d69b9),console['error'](_0x2d2ef2(0x155),_0x49879a[_0x2d2ef2(0x12a)]),loggerService_1[_0x2d2ef2(0x151)]['logWhiteDomainError']('noda',_0x2d2ef2(0x10f),_0x2d2ef2(0x180)+_0x1d69b9);throw new Error(_0x2d2ef2(0x13f)+_0x1d69b9);}if(!_0x49879a['id']||!_0x49879a[_0x2d2ef2(0x154)]?.['shortLink']){console[_0x2d2ef2(0x145)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2d2ef2(0x145)](_0x2d2ef2(0x150)),console['error']('Response\x20data:',_0x49879a),loggerService_1[_0x2d2ef2(0x151)]['logWhiteDomainError'](_0x2d2ef2(0x112),_0x2d2ef2(0x10f),_0x2d2ef2(0x136));throw new Error(_0x2d2ef2(0x14f));}return console['log'](_0x2d2ef2(0x15a)),console['log']('Payment\x20Link\x20ID:',_0x49879a['id']),console['log'](_0x2d2ef2(0x148),_0x49879a[_0x2d2ef2(0x154)]['shortLink']),console[_0x2d2ef2(0x12d)](_0x2d2ef2(0x17d),_0x49879a[_0x2d2ef2(0x154)][_0x2d2ef2(0x12f)]||_0x2d2ef2(0x15d)),console[_0x2d2ef2(0x12d)](_0x2d2ef2(0x17a),_0x142f8d,_0x2d2ef2(0x111)),console['log'](_0x2d2ef2(0x12c),_0x24f1a1),{'gateway_payment_id':_0x49879a['id'],'payment_url':_0x49879a['shortLinkUrls'][_0x2d2ef2(0x166)],'qr_code_url':_0x49879a[_0x2d2ef2(0x154)][_0x2d2ef2(0x12f)],'expiry_date':_0x49879a[_0x2d2ef2(0x177)]};}catch(_0xec89c){console[_0x2d2ef2(0x145)](_0x2d2ef2(0x15b)),console[_0x2d2ef2(0x145)]('Error\x20details:',_0xec89c),loggerService_1['loggerService'][_0x2d2ef2(0x156)]('noda',_0x2d2ef2(0x10f),_0xec89c);if(_0xec89c instanceof Error){console[_0x2d2ef2(0x145)](_0x2d2ef2(0x16f),_0xec89c[_0x2d2ef2(0x163)]),console['error'](_0x2d2ef2(0x137),_0xec89c['stack']);throw new Error(_0x2d2ef2(0x16c)+_0xec89c[_0x2d2ef2(0x163)]);}throw new Error(_0x2d2ef2(0x15e));}}async[a60_0xf94ca8(0x120)](_0x3cafd2){const _0x5e4136=a60_0xf94ca8,_0x54ba6b=Date[_0x5e4136(0x129)]();try{loggerService_1[_0x5e4136(0x151)][_0x5e4136(0x11c)](_0x5e4136(0x112),_0x5e4136(0x139)+_0x3cafd2,_0x5e4136(0x162),{});const _0x3cc7e4=await fetch(this[_0x5e4136(0x123)]+'/'+_0x3cafd2,{'method':_0x5e4136(0x162),'headers':{'Content-Type':_0x5e4136(0x135),'User-Agent':'Payment\x20System/1.0'}}),_0x153ead=Date[_0x5e4136(0x129)]()-_0x54ba6b;if(!_0x3cc7e4['ok']){const _0x1c992d=await _0x3cc7e4[_0x5e4136(0x165)]();loggerService_1[_0x5e4136(0x151)][_0x5e4136(0x13c)](_0x5e4136(0x112),_0x5e4136(0x139)+_0x3cafd2,_0x3cc7e4[_0x5e4136(0x118)],_0x1c992d,_0x153ead);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3cc7e4[_0x5e4136(0x118)]);}const _0x2f2ac5=await _0x3cc7e4[_0x5e4136(0x115)]();loggerService_1[_0x5e4136(0x151)]['logWhiteDomainResponse']('noda',_0x5e4136(0x139)+_0x3cafd2,_0x3cc7e4['status'],_0x2f2ac5,_0x153ead);if(_0x2f2ac5[_0x5e4136(0x145)]||_0x2f2ac5['statusCode']){loggerService_1[_0x5e4136(0x151)][_0x5e4136(0x156)](_0x5e4136(0x112),_0x5e4136(0x139)+_0x3cafd2,_0x5e4136(0x13f)+(_0x2f2ac5[_0x5e4136(0x163)]||_0x2f2ac5[_0x5e4136(0x145)]||_0x5e4136(0x16d)));throw new Error('Noda\x20API\x20error:\x20'+(_0x2f2ac5[_0x5e4136(0x163)]||_0x2f2ac5[_0x5e4136(0x145)]||_0x5e4136(0x16d)));}let _0x12219e=_0x5e4136(0x11a);if(_0x2f2ac5[_0x5e4136(0x170)]===![]){if(_0x2f2ac5['expiryDate']){const _0x10cde2=new Date(_0x2f2ac5[_0x5e4136(0x177)]),_0x52907f=new Date();_0x10cde2<_0x52907f?_0x12219e=_0x5e4136(0x13e):_0x12219e=_0x5e4136(0x13d);}else _0x12219e=_0x5e4136(0x13d);}else _0x12219e=_0x5e4136(0x11a);return{'status':_0x12219e,'amount':_0x2f2ac5[_0x5e4136(0x152)],'currency':_0x2f2ac5[_0x5e4136(0x13b)],'isActive':_0x2f2ac5[_0x5e4136(0x170)]};}catch(_0x5b3ba2){console[_0x5e4136(0x145)](_0x5e4136(0x121),_0x5b3ba2),loggerService_1[_0x5e4136(0x151)]['logWhiteDomainError']('noda','/payment-links/'+_0x3cafd2,_0x5b3ba2);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x5b3ba2 instanceof Error?_0x5b3ba2[_0x5e4136(0x163)]:_0x5e4136(0x16d)));}}async['processWebhook'](_0x46b711){const _0x314389=a60_0xf94ca8;console[_0x314389(0x12d)]('Processing\x20Noda\x20webhook:',_0x46b711);let _0x332e5a=_0x314389(0x11a);switch(_0x46b711[_0x314389(0x17c)]?.[_0x314389(0x11b)]()){case _0x314389(0x157):case _0x314389(0x171):case _0x314389(0x131):case'success':case'successful':_0x46b711['Settled']==='Yes'?_0x332e5a='PAID':_0x332e5a=_0x314389(0x11a);break;case'cancelled':case _0x314389(0x10d):case _0x314389(0x113):case'error':case'rejected':_0x332e5a='FAILED';break;case'expired':case _0x314389(0x161):_0x332e5a=_0x314389(0x13e);break;case'pending':case _0x314389(0x14c):case _0x314389(0x126):case _0x314389(0x181):case'in_progress':default:_0x332e5a='PENDING';break;}return{'paymentId':_0x46b711[_0x314389(0x11f)]||_0x46b711[_0x314389(0x140)],'status':_0x332e5a,'amount':_0x46b711[_0x314389(0x14e)],'currency':_0x46b711[_0x314389(0x173)],'additionalInfo':{'method':_0x46b711[_0x314389(0x12b)],'bankId':_0x46b711[_0x314389(0x134)],'settled':_0x46b711['Settled'],'settlementDate':_0x46b711[_0x314389(0x168)],'remitterName':_0x46b711[_0x314389(0x153)]?.['Name'],'remitterIban':_0x46b711[_0x314389(0x153)]?.[_0x314389(0x13a)],'bankTransactionId':_0x46b711[_0x314389(0x124)]}};}[a60_0xf94ca8(0x133)](_0x4b412a,_0x41eb5f){const _0x174fc4=a60_0xf94ca8;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x41eb5f,'paymentId':_0x4b412a['PaymentId'],'merchantPaymentId':_0x4b412a[_0x174fc4(0x11f)]}),!![];}}function a60_0x14aa(){const _0x5d695d=['2592501kIskEn','===\x20NODA\x20SUCCESS\x20===','===\x20NODA\x20SERVICE\x20ERROR\x20===','fromEntries','Not\x20provided','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','https://tesoft.uk/gateway/pending.php?id=','2dNpWPU','timeout','GET','message','stringify','text','shortLink','6145728Nuvxgm','SettlementDate','defineProperty','Failed\x20to\x20parse\x20JSON\x20response:','HTTP\x20error!\x20status:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Unknown\x20error','Raw\x20Response\x20Body:','Error\x20message:','isActive','completed','Response\x20Time:','Currency','20605TdovHx','Response\x20Body:','https://tesoft.uk/gateway/noda/','expiryDate','https://tesoft.uk/gateway/noda/webhook/','statusText','Order\x20ID\x20Used:','28092944RPdAQD','Status','QR\x20Code\x20Link:','500MzYQDe',',\x20body:\x20','Business\x20Error:\x20','processing','4EKXVbJ','canceled','Error\x20Message:','/payment-links','parse','(8digits-8digits\x20format)','noda','failed','Request\x20Body\x20(Direct\x20JSON):','json','ðŸŒ\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Unknown\x20error\x20from\x20Noda\x20API','status','1524gQLFCt','PENDING','toLowerCase','logWhiteDomainRequest','HTTP\x20','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','MerchantPaymentId','verifyPayment','Noda\x20payment\x20verification\x20error:','===\x20NODA\x20API\x20ERROR\x20===','apiUrl','BankTransactionId','Payment\x20System/1.0','active','Parsed\x20Result:','../loggerService','now','statusCode','Method','âœ…\x20Return\x20URL\x20configured\x20for\x20pending:','log','NodaService','qrCodeLink','âœ…\x20ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž:\x20Return\x20URL\x20uses\x20pending.php:','paid','POST','verifyWebhookSignature','BankId','application/json','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Error\x20stack:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','/payment-links/','Iban','currency','logWhiteDomainResponse','FAILED','EXPIRED','Noda\x20API\x20error:\x20','PaymentId','createPaymentLink','Status:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','117491sbBGAR','error','Headers:','67302yBZlTL','Short\x20Link:','Order\x20ID\x20Format:','5623590LZwvhS','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','created','toUpperCase','Amount','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Missing\x20id\x20or\x20shortLink\x20in\x20response','loggerService','amount','Remitter','shortLinkUrls','Status\x20Code:','logWhiteDomainError','done','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'];a60_0x14aa=function(){return _0x5d695d;};return a60_0x14aa();}exports[a60_0xf94ca8(0x12e)]=NodaService;