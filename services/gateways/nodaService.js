'use strict';function a43_0x2a19(_0x3817e3,_0x4cc46e){const _0x45db8d=a43_0x45db();return a43_0x2a19=function(_0x2a19af,_0x874d94){_0x2a19af=_0x2a19af-0x1d0;let _0xfcf18=_0x45db8d[_0x2a19af];return _0xfcf18;},a43_0x2a19(_0x3817e3,_0x4cc46e);}const a43_0x2fae7a=a43_0x2a19;(function(_0x36c15a,_0x378904){const _0x105626=a43_0x2a19,_0x4bca23=_0x36c15a();while(!![]){try{const _0x4a7f62=parseInt(_0x105626(0x1d2))/0x1+-parseInt(_0x105626(0x20a))/0x2+-parseInt(_0x105626(0x1d8))/0x3*(parseInt(_0x105626(0x1e1))/0x4)+parseInt(_0x105626(0x1e3))/0x5+-parseInt(_0x105626(0x1dd))/0x6*(parseInt(_0x105626(0x241))/0x7)+parseInt(_0x105626(0x23b))/0x8+parseInt(_0x105626(0x1d6))/0x9;if(_0x4a7f62===_0x378904)break;else _0x4bca23['push'](_0x4bca23['shift']());}catch(_0x524301){_0x4bca23['push'](_0x4bca23['shift']());}}}(a43_0x45db,0x73890));Object[a43_0x2fae7a(0x205)](exports,'__esModule',{'value':!![]}),exports[a43_0x2fae7a(0x1e7)]=void 0x0;const loggerService_1=require(a43_0x2fae7a(0x23a));class NodaService{constructor(){const _0x3c0ac7=a43_0x2fae7a;this[_0x3c0ac7(0x1f8)]='https://tesoft.uk/gateway/noda/',console[_0x3c0ac7(0x230)](_0x3c0ac7(0x237));}async['createPaymentLink'](_0x5dc7ac){const _0x326a5e=a43_0x2fae7a,{orderId:_0x54df84,name:_0x4d2ddd,paymentDescription:_0x48824f,amount:_0x36b0b1,currency:_0x414833,webhookUrl:_0x1b044f,returnUrl:_0x575a5f,expiryDate:_0x46f3fd}=_0x5dc7ac,_0x498f7a=_0x414833[_0x326a5e(0x1d7)](),_0x3d8e4d=_0x326a5e(0x218),_0x2eb7f5=_0x326a5e(0x249)+_0x54df84,_0x571eed={'name':_0x4d2ddd,'paymentDescription':_0x48824f,'amount':_0x36b0b1,'currency':_0x498f7a,'paymentId':_0x54df84,'webhookUrl':_0x3d8e4d,'returnUrl':_0x2eb7f5};_0x46f3fd&&(_0x571eed['expiryDate']=_0x46f3fd);const _0x33112e=Date[_0x326a5e(0x221)]();try{console[_0x326a5e(0x230)](_0x326a5e(0x1f0)),console[_0x326a5e(0x230)](_0x326a5e(0x234),this['apiUrl']),console[_0x326a5e(0x230)](_0x326a5e(0x240),JSON['stringify'](_0x571eed,null,0x2)),console[_0x326a5e(0x230)](_0x326a5e(0x1fe),_0x54df84,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x326a5e(0x230)](_0x326a5e(0x1f2),_0x2eb7f5),loggerService_1[_0x326a5e(0x1ee)][_0x326a5e(0x213)]('noda',_0x326a5e(0x219),'POST',_0x571eed);const _0x5742af=await fetch(this[_0x326a5e(0x1f8)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x326a5e(0x248),'User-Agent':_0x326a5e(0x20d)},'body':JSON[_0x326a5e(0x244)](_0x571eed)}),_0x1cad66=Date[_0x326a5e(0x221)]()-_0x33112e;console[_0x326a5e(0x230)](_0x326a5e(0x228)),console[_0x326a5e(0x230)](_0x326a5e(0x1f3),_0x5742af[_0x326a5e(0x211)]),console[_0x326a5e(0x230)](_0x326a5e(0x1df),_0x5742af[_0x326a5e(0x1fb)]),console['log'](_0x326a5e(0x22f),Object[_0x326a5e(0x227)](_0x5742af[_0x326a5e(0x22e)][_0x326a5e(0x1f7)]())),console[_0x326a5e(0x230)]('Response\x20Time:',_0x1cad66+'ms');const _0x559825=await _0x5742af[_0x326a5e(0x1eb)]();console['log'](_0x326a5e(0x1ec),_0x559825);if(!_0x5742af['ok']){console[_0x326a5e(0x1e9)](_0x326a5e(0x1f9)),console['error'](_0x326a5e(0x1ef),_0x5742af[_0x326a5e(0x211)]),console[_0x326a5e(0x1e9)](_0x326a5e(0x238),_0x559825),loggerService_1[_0x326a5e(0x1ee)]['logWhiteDomainResponse'](_0x326a5e(0x1e2),_0x326a5e(0x219),_0x5742af[_0x326a5e(0x211)],_0x559825,_0x1cad66),loggerService_1['loggerService'][_0x326a5e(0x21e)](_0x326a5e(0x1e2),_0x326a5e(0x219),'HTTP\x20'+_0x5742af[_0x326a5e(0x211)]+':\x20'+_0x559825);if(_0x5742af[_0x326a5e(0x211)]===0x190)throw new Error(_0x326a5e(0x1fa));else{if(_0x5742af['status']===0x1f4)throw new Error(_0x326a5e(0x229));}throw new Error(_0x326a5e(0x20b)+_0x5742af['status']+_0x326a5e(0x212)+_0x559825);}let _0x22c98c;try{_0x22c98c=JSON['parse'](_0x559825);}catch(_0x2ceb6f){console['error'](_0x326a5e(0x236),_0x2ceb6f),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x326a5e(0x219),_0x326a5e(0x245)+_0x2ceb6f);throw new Error(_0x326a5e(0x209)+_0x559825);}console[_0x326a5e(0x230)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x326a5e(0x230)]('Parsed\x20Result:',JSON[_0x326a5e(0x244)](_0x22c98c,null,0x2)),loggerService_1['loggerService'][_0x326a5e(0x200)](_0x326a5e(0x1e2),_0x326a5e(0x219),_0x5742af[_0x326a5e(0x211)],_0x22c98c,_0x1cad66);if(_0x22c98c[_0x326a5e(0x1e9)]||_0x22c98c[_0x326a5e(0x215)]){const _0x149da9=_0x22c98c[_0x326a5e(0x21d)]||_0x22c98c[_0x326a5e(0x1e9)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x326a5e(0x1e9)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x326a5e(0x1e9)](_0x326a5e(0x243),_0x149da9),console[_0x326a5e(0x1e9)](_0x326a5e(0x21c),_0x22c98c['statusCode']),loggerService_1[_0x326a5e(0x1ee)][_0x326a5e(0x21e)](_0x326a5e(0x1e2),_0x326a5e(0x219),_0x326a5e(0x1f4)+_0x149da9);throw new Error(_0x326a5e(0x22c)+_0x149da9);}if(!_0x22c98c['id']||!_0x22c98c[_0x326a5e(0x1ed)]?.[_0x326a5e(0x1d0)]){console['error'](_0x326a5e(0x1fc)),console[_0x326a5e(0x1e9)](_0x326a5e(0x20c)),console[_0x326a5e(0x1e9)]('Response\x20data:',_0x22c98c),loggerService_1['loggerService'][_0x326a5e(0x21e)](_0x326a5e(0x1e2),_0x326a5e(0x219),_0x326a5e(0x23f));throw new Error(_0x326a5e(0x20e));}return console['log'](_0x326a5e(0x204)),console[_0x326a5e(0x230)]('Payment\x20Link\x20ID:',_0x22c98c['id']),console[_0x326a5e(0x230)](_0x326a5e(0x1db),_0x22c98c[_0x326a5e(0x1ed)][_0x326a5e(0x1d0)]),console['log'](_0x326a5e(0x1d1),_0x22c98c[_0x326a5e(0x1ed)][_0x326a5e(0x1da)]||_0x326a5e(0x208)),console[_0x326a5e(0x230)](_0x326a5e(0x223),_0x54df84,_0x326a5e(0x207)),console[_0x326a5e(0x230)](_0x326a5e(0x23e),_0x2eb7f5),{'gateway_payment_id':_0x22c98c['id'],'payment_url':_0x22c98c[_0x326a5e(0x1ed)][_0x326a5e(0x1d0)],'qr_code_url':_0x22c98c[_0x326a5e(0x1ed)][_0x326a5e(0x1da)],'expiry_date':_0x22c98c[_0x326a5e(0x21b)]};}catch(_0x282b6d){console[_0x326a5e(0x1e9)](_0x326a5e(0x201)),console[_0x326a5e(0x1e9)](_0x326a5e(0x220),_0x282b6d),loggerService_1['loggerService'][_0x326a5e(0x21e)](_0x326a5e(0x1e2),_0x326a5e(0x219),_0x282b6d);if(_0x282b6d instanceof Error){console[_0x326a5e(0x1e9)](_0x326a5e(0x226),_0x282b6d[_0x326a5e(0x21d)]),console['error'](_0x326a5e(0x1e0),_0x282b6d[_0x326a5e(0x1d4)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x282b6d[_0x326a5e(0x21d)]);}throw new Error(_0x326a5e(0x216));}}async[a43_0x2fae7a(0x1e4)](_0x2d15a1){const _0xd8df27=a43_0x2fae7a,_0x3fe69f=Date[_0xd8df27(0x221)]();try{loggerService_1[_0xd8df27(0x1ee)]['logWhiteDomainRequest'](_0xd8df27(0x1e2),_0xd8df27(0x239)+_0x2d15a1,'GET',{});const _0x4501a8=await fetch(this[_0xd8df27(0x1f8)]+'/'+_0x2d15a1,{'method':_0xd8df27(0x1de),'headers':{'Content-Type':'application/json','User-Agent':_0xd8df27(0x20d)}}),_0x3b38aa=Date[_0xd8df27(0x221)]()-_0x3fe69f;if(!_0x4501a8['ok']){const _0x3c0ee7=await _0x4501a8[_0xd8df27(0x1eb)]();loggerService_1[_0xd8df27(0x1ee)][_0xd8df27(0x200)]('noda',_0xd8df27(0x239)+_0x2d15a1,_0x4501a8[_0xd8df27(0x211)],_0x3c0ee7,_0x3b38aa);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4501a8['status']);}const _0x4df958=await _0x4501a8[_0xd8df27(0x202)]();loggerService_1[_0xd8df27(0x1ee)][_0xd8df27(0x200)](_0xd8df27(0x1e2),_0xd8df27(0x239)+_0x2d15a1,_0x4501a8[_0xd8df27(0x211)],_0x4df958,_0x3b38aa);if(_0x4df958[_0xd8df27(0x1e9)]||_0x4df958[_0xd8df27(0x215)]){loggerService_1['loggerService'][_0xd8df27(0x21e)](_0xd8df27(0x1e2),_0xd8df27(0x239)+_0x2d15a1,'Noda\x20API\x20error:\x20'+(_0x4df958['message']||_0x4df958[_0xd8df27(0x1e9)]||'Unknown\x20error'));throw new Error(_0xd8df27(0x22c)+(_0x4df958[_0xd8df27(0x21d)]||_0x4df958['error']||_0xd8df27(0x23d)));}let _0x493c4d='PENDING';if(_0x4df958['isActive']===![]){if(_0x4df958[_0xd8df27(0x21b)]){const _0x385012=new Date(_0x4df958[_0xd8df27(0x21b)]),_0x2133f0=new Date();_0x385012<_0x2133f0?_0x493c4d='EXPIRED':_0x493c4d=_0xd8df27(0x232);}else _0x493c4d='FAILED';}else _0x493c4d=_0xd8df27(0x222);return{'status':_0x493c4d,'amount':_0x4df958[_0xd8df27(0x1fd)],'currency':_0x4df958[_0xd8df27(0x1d5)],'isActive':_0x4df958[_0xd8df27(0x20f)]};}catch(_0x22958e){console['error'](_0xd8df27(0x214),_0x22958e),loggerService_1[_0xd8df27(0x1ee)]['logWhiteDomainError'](_0xd8df27(0x1e2),'/payment-links/'+_0x2d15a1,_0x22958e);throw new Error(_0xd8df27(0x1e5)+(_0x22958e instanceof Error?_0x22958e[_0xd8df27(0x21d)]:'Unknown\x20error'));}}async[a43_0x2fae7a(0x246)](_0x4e7139){const _0x5d3a3b=a43_0x2fae7a;console[_0x5d3a3b(0x230)](_0x5d3a3b(0x225),_0x4e7139);let _0xc86e6d=_0x5d3a3b(0x222);switch(_0x4e7139[_0x5d3a3b(0x1d9)]?.['toLowerCase']()){case _0x5d3a3b(0x235):case _0x5d3a3b(0x242):case'paid':case _0x5d3a3b(0x1ff):case _0x5d3a3b(0x1ea):_0x4e7139[_0x5d3a3b(0x247)]===_0x5d3a3b(0x21a)?_0xc86e6d='PAID':_0xc86e6d='PENDING';break;case'cancelled':case _0x5d3a3b(0x1dc):case _0x5d3a3b(0x233):case _0x5d3a3b(0x1e9):case _0x5d3a3b(0x21f):_0xc86e6d=_0x5d3a3b(0x232);break;case'expired':case _0x5d3a3b(0x217):_0xc86e6d=_0x5d3a3b(0x1f5);break;case _0x5d3a3b(0x22a):case'created':case _0x5d3a3b(0x1d3):case _0x5d3a3b(0x1f1):case _0x5d3a3b(0x1e6):default:_0xc86e6d=_0x5d3a3b(0x222);break;}return{'paymentId':_0x4e7139[_0x5d3a3b(0x231)]||_0x4e7139[_0x5d3a3b(0x22b)],'status':_0xc86e6d,'amount':_0x4e7139['Amount'],'currency':_0x4e7139[_0x5d3a3b(0x224)],'additionalInfo':{'method':_0x4e7139[_0x5d3a3b(0x1f6)],'bankId':_0x4e7139[_0x5d3a3b(0x210)],'settled':_0x4e7139[_0x5d3a3b(0x247)],'settlementDate':_0x4e7139[_0x5d3a3b(0x22d)],'remitterName':_0x4e7139[_0x5d3a3b(0x203)]?.[_0x5d3a3b(0x206)],'remitterIban':_0x4e7139[_0x5d3a3b(0x203)]?.[_0x5d3a3b(0x23c)],'bankTransactionId':_0x4e7139[_0x5d3a3b(0x1e8)]}};}['verifyWebhookSignature'](_0x2995bd,_0x4581e5){const _0x3bbfa9=a43_0x2fae7a;return console[_0x3bbfa9(0x230)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x4581e5,'paymentId':_0x2995bd[_0x3bbfa9(0x22b)],'merchantPaymentId':_0x2995bd[_0x3bbfa9(0x231)]}),!![];}}function a43_0x45db(){const _0x3c5f47=['✅\x20Return\x20URL\x20configured\x20for\x20pending:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Request\x20Body\x20(Direct\x20JSON):','3663989bumLFG','completed','Error\x20Message:','stringify','JSON\x20Parse\x20Error:\x20','processWebhook','Settled','application/json','https://tesoft.uk/gateway/pending.php?id=','shortLink','QR\x20Code\x20Link:','87449DyHKGp','active','stack','currency','7875405WNDFvL','toUpperCase','6ChbKEE','Status','qrCodeLink','Short\x20Link:','canceled','6rVbket','GET','Status\x20Text:','Error\x20stack:','519944fPHcol','noda','2468925aDoYXU','verifyPayment','Failed\x20to\x20verify\x20Noda\x20payment:\x20','in_progress','NodaService','BankTransactionId','error','successful','text','Raw\x20Response\x20Body:','shortLinkUrls','loggerService','HTTP\x20Status:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','processing','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','Status:','Business\x20Error:\x20','EXPIRED','Method','entries','apiUrl','===\x20NODA\x20API\x20ERROR\x20===','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','statusText','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','amount','Order\x20ID\x20Format:','success','logWhiteDomainResponse','===\x20NODA\x20SERVICE\x20ERROR\x20===','json','Remitter','===\x20NODA\x20SUCCESS\x20===','defineProperty','Name','(8digits-8digits\x20format)','Not\x20provided','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','1186822JjziAD','HTTP\x20error!\x20status:\x20','Missing\x20id\x20or\x20shortLink\x20in\x20response','TesSoft\x20Payment\x20System/1.0','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','isActive','BankId','status',',\x20body:\x20','logWhiteDomainRequest','Noda\x20payment\x20verification\x20error:','statusCode','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','timeout','https://tesoft.uk/gateway/noda/webhook/','/payment-links','Yes','expiryDate','Status\x20Code:','message','logWhiteDomainError','rejected','Error\x20details:','now','PENDING','Order\x20ID\x20Used:','Currency','Processing\x20Noda\x20webhook:','Error\x20message:','fromEntries','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','pending','PaymentId','Noda\x20API\x20error:\x20','SettlementDate','headers','Headers:','log','MerchantPaymentId','FAILED','failed','URL:','done','Failed\x20to\x20parse\x20JSON\x20response:','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Response\x20Body:','/payment-links/','../loggerService','3150104NsGUzj','Iban','Unknown\x20error'];a43_0x45db=function(){return _0x3c5f47;};return a43_0x45db();}exports['NodaService']=NodaService;