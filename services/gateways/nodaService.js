'use strict';function a43_0x1680(_0x3bf8b2,_0xafdaf2){const _0x55bd57=a43_0x55bd();return a43_0x1680=function(_0x1680f5,_0x1be4a6){_0x1680f5=_0x1680f5-0x173;let _0x14f3a5=_0x55bd57[_0x1680f5];return _0x14f3a5;},a43_0x1680(_0x3bf8b2,_0xafdaf2);}const a43_0x106afc=a43_0x1680;(function(_0x44ac45,_0x244445){const _0x294d86=a43_0x1680,_0x3314e3=_0x44ac45();while(!![]){try{const _0x2cdb1c=parseInt(_0x294d86(0x17b))/0x1+parseInt(_0x294d86(0x1e4))/0x2+parseInt(_0x294d86(0x1b8))/0x3*(parseInt(_0x294d86(0x1e2))/0x4)+-parseInt(_0x294d86(0x1cd))/0x5*(-parseInt(_0x294d86(0x1b6))/0x6)+-parseInt(_0x294d86(0x196))/0x7*(-parseInt(_0x294d86(0x1eb))/0x8)+parseInt(_0x294d86(0x18f))/0x9*(-parseInt(_0x294d86(0x1c6))/0xa)+-parseInt(_0x294d86(0x1e0))/0xb*(parseInt(_0x294d86(0x192))/0xc);if(_0x2cdb1c===_0x244445)break;else _0x3314e3['push'](_0x3314e3['shift']());}catch(_0x4d6d6d){_0x3314e3['push'](_0x3314e3['shift']());}}}(a43_0x55bd,0xc717a));function a43_0x55bd(){const _0x25180c=['Response\x20Body:','headers','Headers:','statusCode','===\x20NODA\x20SUCCESS\x20===','Status','status','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','1233797CNaHvN','JSON\x20Parse\x20Error:\x20','Amount','noda','now','cancelled','===\x20NODA\x20SERVICE\x20ERROR\x20===','Response\x20data:','json','stack','Payment\x20Link\x20ID:','Noda\x20API\x20error:\x20','logWhiteDomainRequest','in_progress','PENDING','Error\x20stack:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','expired','processWebhook','shortLinkUrls','9UhTvIq','createPaymentLink','apiUrl','40446936lSwoaw','POST','Status:','failed','3325jaZyKm','success','error',',\x20body:\x20','Business\x20Error:\x20','Processing\x20Noda\x20webhook:','application/json','loggerService','https://tesoft.uk/gateway/noda/','Currency','defineProperty','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','logWhiteDomainResponse','MerchantPaymentId','SettlementDate','Name','paid','Parsed\x20Result:','GET','BankTransactionId','Iban','Short\x20Link:','currency','/payment-links/','shortLink','rejected','Error\x20message:','__esModule','created','Yes','entries','Remitter','1384338MjGLVs','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','6EVNIjw','Settled','statusText','successful','Unknown\x20error\x20from\x20Noda\x20API','===\x20NODA\x20API\x20ERROR\x20===','Raw\x20Response\x20Body:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','parse','processing','HTTP\x20Status:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','https://tesoft.uk/gateway/pending.php?id=','isActive','23650CTBaNm','logWhiteDomainError','text','https://tesoft.uk/gateway/noda/webhook/','timeout','(8digits-8digits\x20format)','PaymentId','10Cnjziy','===\x20PARSED\x20NODA\x20RESPONSE\x20===','verifyPayment','../loggerService','(8digits-8digits\x20format\x20for\x20Noda)','pending','Request\x20Body\x20(Direct\x20JSON):','fromEntries','Status\x20Code:','Order\x20ID\x20Format:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','toLowerCase','canceled','expiryDate','FAILED','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','toUpperCase','11yEvQIO','stringify','524472UoNENZ','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','2469742AxsUOe','HTTP\x20error!\x20status:\x20','TesSoft\x20Payment\x20System/1.0','message','Error\x20details:','/payment-links','NodaService','16776HCcRLE','Error\x20Message:','amount','log','Status\x20Text:','Unknown\x20error','HTTP\x20','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','EXPIRED'];a43_0x55bd=function(){return _0x25180c;};return a43_0x55bd();}Object[a43_0x106afc(0x1a0)](exports,a43_0x106afc(0x1b1),{'value':!![]}),exports[a43_0x106afc(0x1ea)]=void 0x0;const loggerService_1=require(a43_0x106afc(0x1d0));class NodaService{constructor(){const _0x25f70c=a43_0x106afc;this[_0x25f70c(0x191)]=_0x25f70c(0x19e),console['log'](_0x25f70c(0x1a1));}async[a43_0x106afc(0x190)](_0x56e0c9){const _0x2bf5a5=a43_0x106afc,{orderId:_0x33e2cc,name:_0x137717,paymentDescription:_0x4854e1,amount:_0x3d2c46,currency:_0x474c9b,webhookUrl:_0x30f26a,returnUrl:_0x2793b7,expiryDate:_0x25db59}=_0x56e0c9,_0xfb8c63=_0x474c9b[_0x2bf5a5(0x1df)](),_0x57fd36=_0x2bf5a5(0x1c9),_0x49ba60=_0x2bf5a5(0x1c4)+_0x33e2cc,_0x57e529={'name':_0x137717,'paymentDescription':_0x4854e1,'amount':_0x3d2c46,'currency':_0xfb8c63,'paymentId':_0x33e2cc,'webhookUrl':_0x57fd36,'returnUrl':_0x49ba60};_0x25db59&&(_0x57e529[_0x2bf5a5(0x1db)]=_0x25db59);const _0x516437=Date[_0x2bf5a5(0x17f)]();try{console[_0x2bf5a5(0x1ee)](_0x2bf5a5(0x1c3)),console[_0x2bf5a5(0x1ee)]('URL:',this[_0x2bf5a5(0x191)]),console['log'](_0x2bf5a5(0x1d3),JSON['stringify'](_0x57e529,null,0x2)),console[_0x2bf5a5(0x1ee)](_0x2bf5a5(0x1d6),_0x33e2cc,_0x2bf5a5(0x1d1)),console[_0x2bf5a5(0x1ee)](_0x2bf5a5(0x18b),_0x49ba60),loggerService_1[_0x2bf5a5(0x19d)][_0x2bf5a5(0x187)]('noda',_0x2bf5a5(0x1e9),_0x2bf5a5(0x193),_0x57e529);const _0x53d241=await fetch(this[_0x2bf5a5(0x191)],{'method':_0x2bf5a5(0x193),'headers':{'Content-Type':'application/json','Accept':_0x2bf5a5(0x19c),'User-Agent':_0x2bf5a5(0x1e6)},'body':JSON[_0x2bf5a5(0x1e1)](_0x57e529)}),_0x4382de=Date['now']()-_0x516437;console[_0x2bf5a5(0x1ee)](_0x2bf5a5(0x1de)),console[_0x2bf5a5(0x1ee)](_0x2bf5a5(0x194),_0x53d241[_0x2bf5a5(0x179)]),console[_0x2bf5a5(0x1ee)](_0x2bf5a5(0x1ef),_0x53d241[_0x2bf5a5(0x1ba)]),console[_0x2bf5a5(0x1ee)](_0x2bf5a5(0x175),Object[_0x2bf5a5(0x1d4)](_0x53d241[_0x2bf5a5(0x174)][_0x2bf5a5(0x1b4)]())),console[_0x2bf5a5(0x1ee)]('Response\x20Time:',_0x4382de+'ms');const _0x1163d5=await _0x53d241[_0x2bf5a5(0x1c8)]();console[_0x2bf5a5(0x1ee)](_0x2bf5a5(0x1be),_0x1163d5);if(!_0x53d241['ok']){console[_0x2bf5a5(0x198)](_0x2bf5a5(0x1bd)),console[_0x2bf5a5(0x198)](_0x2bf5a5(0x1c2),_0x53d241[_0x2bf5a5(0x179)]),console[_0x2bf5a5(0x198)](_0x2bf5a5(0x173),_0x1163d5),loggerService_1[_0x2bf5a5(0x19d)][_0x2bf5a5(0x1a2)](_0x2bf5a5(0x17e),_0x2bf5a5(0x1e9),_0x53d241['status'],_0x1163d5,_0x4382de),loggerService_1['loggerService'][_0x2bf5a5(0x1c7)]('noda',_0x2bf5a5(0x1e9),_0x2bf5a5(0x1f1)+_0x53d241[_0x2bf5a5(0x179)]+':\x20'+_0x1163d5);if(_0x53d241[_0x2bf5a5(0x179)]===0x190)throw new Error(_0x2bf5a5(0x1f2));else{if(_0x53d241['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x2bf5a5(0x1e5)+_0x53d241['status']+_0x2bf5a5(0x199)+_0x1163d5);}let _0x128a1c;try{_0x128a1c=JSON[_0x2bf5a5(0x1c0)](_0x1163d5);}catch(_0x3ad441){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x3ad441),loggerService_1[_0x2bf5a5(0x19d)][_0x2bf5a5(0x1c7)]('noda','/payment-links',_0x2bf5a5(0x17c)+_0x3ad441);throw new Error(_0x2bf5a5(0x1bf)+_0x1163d5);}console['log'](_0x2bf5a5(0x1ce)),console[_0x2bf5a5(0x1ee)](_0x2bf5a5(0x1a7),JSON[_0x2bf5a5(0x1e1)](_0x128a1c,null,0x2)),loggerService_1[_0x2bf5a5(0x19d)]['logWhiteDomainResponse'](_0x2bf5a5(0x17e),_0x2bf5a5(0x1e9),_0x53d241[_0x2bf5a5(0x179)],_0x128a1c,_0x4382de);if(_0x128a1c[_0x2bf5a5(0x198)]||_0x128a1c[_0x2bf5a5(0x176)]){const _0x1dd5b3=_0x128a1c[_0x2bf5a5(0x1e7)]||_0x128a1c['error']||_0x2bf5a5(0x1bc);console['error'](_0x2bf5a5(0x1dd)),console['error'](_0x2bf5a5(0x1ec),_0x1dd5b3),console[_0x2bf5a5(0x198)](_0x2bf5a5(0x1d5),_0x128a1c['statusCode']),loggerService_1[_0x2bf5a5(0x19d)]['logWhiteDomainError'](_0x2bf5a5(0x17e),_0x2bf5a5(0x1e9),_0x2bf5a5(0x19a)+_0x1dd5b3);throw new Error(_0x2bf5a5(0x186)+_0x1dd5b3);}if(!_0x128a1c['id']||!_0x128a1c[_0x2bf5a5(0x18e)]?.['shortLink']){console[_0x2bf5a5(0x198)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2bf5a5(0x198)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console['error'](_0x2bf5a5(0x182),_0x128a1c),loggerService_1['loggerService'][_0x2bf5a5(0x1c7)](_0x2bf5a5(0x17e),'/payment-links',_0x2bf5a5(0x1e3));throw new Error(_0x2bf5a5(0x1d8));}return console[_0x2bf5a5(0x1ee)](_0x2bf5a5(0x177)),console[_0x2bf5a5(0x1ee)](_0x2bf5a5(0x185),_0x128a1c['id']),console['log'](_0x2bf5a5(0x1ab),_0x128a1c[_0x2bf5a5(0x18e)][_0x2bf5a5(0x1ae)]),console[_0x2bf5a5(0x1ee)]('QR\x20Code\x20Link:',_0x128a1c['shortLinkUrls']['qrCodeLink']||'Not\x20provided'),console['log']('Order\x20ID\x20Used:',_0x33e2cc,_0x2bf5a5(0x1cb)),console[_0x2bf5a5(0x1ee)](_0x2bf5a5(0x1b7),_0x49ba60),{'gateway_payment_id':_0x128a1c['id'],'payment_url':_0x128a1c[_0x2bf5a5(0x18e)][_0x2bf5a5(0x1ae)],'qr_code_url':_0x128a1c['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x128a1c['expiryDate']};}catch(_0x1c218d){console[_0x2bf5a5(0x198)](_0x2bf5a5(0x181)),console['error'](_0x2bf5a5(0x1e8),_0x1c218d),loggerService_1[_0x2bf5a5(0x19d)][_0x2bf5a5(0x1c7)](_0x2bf5a5(0x17e),_0x2bf5a5(0x1e9),_0x1c218d);if(_0x1c218d instanceof Error){console[_0x2bf5a5(0x198)](_0x2bf5a5(0x1b0),_0x1c218d[_0x2bf5a5(0x1e7)]),console['error'](_0x2bf5a5(0x18a),_0x1c218d[_0x2bf5a5(0x184)]);throw new Error(_0x2bf5a5(0x17a)+_0x1c218d[_0x2bf5a5(0x1e7)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x106afc(0x1cf)](_0x465ef2){const _0x3e52b1=a43_0x106afc,_0x2482ac=Date[_0x3e52b1(0x17f)]();try{loggerService_1['loggerService'][_0x3e52b1(0x187)](_0x3e52b1(0x17e),_0x3e52b1(0x1ad)+_0x465ef2,'GET',{});const _0x2a27b8=await fetch(this[_0x3e52b1(0x191)]+'/'+_0x465ef2,{'method':_0x3e52b1(0x1a8),'headers':{'Content-Type':_0x3e52b1(0x19c),'User-Agent':_0x3e52b1(0x1e6)}}),_0x46e5f2=Date['now']()-_0x2482ac;if(!_0x2a27b8['ok']){const _0x4a5a88=await _0x2a27b8[_0x3e52b1(0x1c8)]();loggerService_1[_0x3e52b1(0x19d)][_0x3e52b1(0x1a2)](_0x3e52b1(0x17e),_0x3e52b1(0x1ad)+_0x465ef2,_0x2a27b8[_0x3e52b1(0x179)],_0x4a5a88,_0x46e5f2);throw new Error(_0x3e52b1(0x1e5)+_0x2a27b8['status']);}const _0x14f383=await _0x2a27b8[_0x3e52b1(0x183)]();loggerService_1[_0x3e52b1(0x19d)][_0x3e52b1(0x1a2)](_0x3e52b1(0x17e),_0x3e52b1(0x1ad)+_0x465ef2,_0x2a27b8[_0x3e52b1(0x179)],_0x14f383,_0x46e5f2);if(_0x14f383['error']||_0x14f383[_0x3e52b1(0x176)]){loggerService_1[_0x3e52b1(0x19d)][_0x3e52b1(0x1c7)](_0x3e52b1(0x17e),_0x3e52b1(0x1ad)+_0x465ef2,'Noda\x20API\x20error:\x20'+(_0x14f383[_0x3e52b1(0x1e7)]||_0x14f383[_0x3e52b1(0x198)]||_0x3e52b1(0x1f0)));throw new Error(_0x3e52b1(0x186)+(_0x14f383[_0x3e52b1(0x1e7)]||_0x14f383[_0x3e52b1(0x198)]||_0x3e52b1(0x1f0)));}let _0x35771d=_0x3e52b1(0x189);if(_0x14f383[_0x3e52b1(0x1c5)]===![]){if(_0x14f383[_0x3e52b1(0x1db)]){const _0x3489ed=new Date(_0x14f383[_0x3e52b1(0x1db)]),_0x242e42=new Date();_0x3489ed<_0x242e42?_0x35771d='EXPIRED':_0x35771d=_0x3e52b1(0x1dc);}else _0x35771d=_0x3e52b1(0x1dc);}else _0x35771d=_0x3e52b1(0x189);return{'status':_0x35771d,'amount':_0x14f383[_0x3e52b1(0x1ed)],'currency':_0x14f383[_0x3e52b1(0x1ac)],'isActive':_0x14f383[_0x3e52b1(0x1c5)]};}catch(_0x732181){console[_0x3e52b1(0x198)]('Noda\x20payment\x20verification\x20error:',_0x732181),loggerService_1[_0x3e52b1(0x19d)][_0x3e52b1(0x1c7)](_0x3e52b1(0x17e),_0x3e52b1(0x1ad)+_0x465ef2,_0x732181);throw new Error(_0x3e52b1(0x1d7)+(_0x732181 instanceof Error?_0x732181[_0x3e52b1(0x1e7)]:_0x3e52b1(0x1f0)));}}async[a43_0x106afc(0x18d)](_0x293c4f){const _0x4901ac=a43_0x106afc;console[_0x4901ac(0x1ee)](_0x4901ac(0x19b),_0x293c4f);let _0x41e5d2=_0x4901ac(0x189);switch(_0x293c4f[_0x4901ac(0x178)]?.[_0x4901ac(0x1d9)]()){case'done':case'completed':case _0x4901ac(0x1a6):case _0x4901ac(0x197):case _0x4901ac(0x1bb):_0x293c4f[_0x4901ac(0x1b9)]===_0x4901ac(0x1b3)?_0x41e5d2='PAID':_0x41e5d2=_0x4901ac(0x189);break;case _0x4901ac(0x180):case _0x4901ac(0x1da):case _0x4901ac(0x195):case _0x4901ac(0x198):case _0x4901ac(0x1af):_0x41e5d2=_0x4901ac(0x1dc);break;case _0x4901ac(0x18c):case _0x4901ac(0x1ca):_0x41e5d2=_0x4901ac(0x1f3);break;case _0x4901ac(0x1d2):case _0x4901ac(0x1b2):case'active':case _0x4901ac(0x1c1):case _0x4901ac(0x188):default:_0x41e5d2=_0x4901ac(0x189);break;}return{'paymentId':_0x293c4f[_0x4901ac(0x1a3)]||_0x293c4f['PaymentId'],'status':_0x41e5d2,'amount':_0x293c4f[_0x4901ac(0x17d)],'currency':_0x293c4f[_0x4901ac(0x19f)],'additionalInfo':{'method':_0x293c4f['Method'],'bankId':_0x293c4f['BankId'],'settled':_0x293c4f[_0x4901ac(0x1b9)],'settlementDate':_0x293c4f[_0x4901ac(0x1a4)],'remitterName':_0x293c4f[_0x4901ac(0x1b5)]?.[_0x4901ac(0x1a5)],'remitterIban':_0x293c4f[_0x4901ac(0x1b5)]?.[_0x4901ac(0x1aa)],'bankTransactionId':_0x293c4f[_0x4901ac(0x1a9)]}};}['verifyWebhookSignature'](_0x17f337,_0x500d67){const _0x344f66=a43_0x106afc;return console[_0x344f66(0x1ee)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x500d67,'paymentId':_0x17f337[_0x344f66(0x1cc)],'merchantPaymentId':_0x17f337[_0x344f66(0x1a3)]}),!![];}}exports[a43_0x106afc(0x1ea)]=NodaService;