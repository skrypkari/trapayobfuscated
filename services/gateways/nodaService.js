'use strict';const a40_0x439a92=a40_0x1775;(function(_0x5e6376,_0x34343a){const _0x13dee0=a40_0x1775,_0x4febdf=_0x5e6376();while(!![]){try{const _0x5f579b=-parseInt(_0x13dee0(0x132))/0x1*(parseInt(_0x13dee0(0x145))/0x2)+parseInt(_0x13dee0(0x146))/0x3+parseInt(_0x13dee0(0x174))/0x4+parseInt(_0x13dee0(0x130))/0x5*(-parseInt(_0x13dee0(0x14e))/0x6)+-parseInt(_0x13dee0(0x11f))/0x7+-parseInt(_0x13dee0(0x162))/0x8*(-parseInt(_0x13dee0(0x131))/0x9)+-parseInt(_0x13dee0(0x159))/0xa*(-parseInt(_0x13dee0(0x13c))/0xb);if(_0x5f579b===_0x34343a)break;else _0x4febdf['push'](_0x4febdf['shift']());}catch(_0x24e15c){_0x4febdf['push'](_0x4febdf['shift']());}}}(a40_0x5926,0xe33e6));Object[a40_0x439a92(0x16f)](exports,a40_0x439a92(0x188),{'value':!![]}),exports[a40_0x439a92(0x182)]=void 0x0;function a40_0x1775(_0x17e5f7,_0x5625b8){const _0x5926cf=a40_0x5926();return a40_0x1775=function(_0x1775e3,_0x3e7b3a){_0x1775e3=_0x1775e3-0x117;let _0x50713e=_0x5926cf[_0x1775e3];return _0x50713e;},a40_0x1775(_0x17e5f7,_0x5625b8);}const loggerService_1=require('../loggerService');function a40_0x5926(){const _0x54d168=['Order\x20ID\x20Format:','paid','application/json','failed','/payment-links/','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','NodaService','Parsed\x20Result:','Business\x20Error:\x20','FAILED','Failed\x20to\x20parse\x20JSON\x20response:','Unknown\x20error\x20from\x20Noda\x20API','__esModule','URL:','message','Response\x20Time:','amount','Error\x20details:','Short\x20Link:','(8digits-8digits\x20format\x20for\x20Noda)','stack','error','successful','pending','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','logWhiteDomainError','PAID','12615232QAKgfY','MerchantPaymentId','active','HTTP\x20','PENDING','BankId','Failed\x20to\x20verify\x20Noda\x20payment:\x20','statusCode','https://tesoft.uk/gateway/noda/webhook/','BankTransactionId','log','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','expiryDate','expired','toLowerCase','processWebhook','cancelled','712575FJeYPO','42489ysNhFI','5eaVTlL','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','logWhiteDomainResponse','===\x20PARSED\x20NODA\x20RESPONSE\x20===','noda','Noda\x20API\x20error:\x20','now','EXPIRED','shortLinkUrls','HTTP\x20Status:','274439ONmSSJ','TesSoft\x20Payment\x20System/1.0','verifyPayment','stringify','Request\x20Body\x20(Direct\x20JSON):','===\x20NODA\x20SUCCESS\x20===','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','GET','loggerService','197722qtQvYA','5060640PlGVCf','Remitter','verifyWebhookSignature','headers','status','Name','Settled','apiUrl','78QaCcjJ','success','Order\x20ID\x20Used:','Status\x20Code:','(8digits-8digits\x20format)','HTTP\x20error!\x20status:\x20','===\x20NODA\x20SERVICE\x20ERROR\x20===','/payment-links','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Processing\x20Noda\x20webhook:',',\x20body:\x20','960muIFUn','Unknown\x20error','Currency','Error\x20Message:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','createPaymentLink','text','Response\x20data:','PaymentId','824PVlKcz','processing','timeout','Status:','Yes','Missing\x20id\x20or\x20shortLink\x20in\x20response','logWhiteDomainRequest','shortLink','SettlementDate','Error\x20message:','in_progress','parse','currency','defineProperty','completed','toUpperCase','Method','Not\x20provided','2046876WfcOAT','Response\x20Body:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Raw\x20Response\x20Body:','done','Status','POST','https://tesoft.uk/gateway/success.php?id='];a40_0x5926=function(){return _0x54d168;};return a40_0x5926();}class NodaService{constructor(){const _0x559cfb=a40_0x439a92;this[_0x559cfb(0x14d)]='https://tesoft.uk/gateway/noda/',console['log'](_0x559cfb(0x11c));}async[a40_0x439a92(0x15e)](_0x536063){const _0x325850=a40_0x439a92,{orderId:_0xf9acc3,name:_0x4febd2,paymentDescription:_0x41090c,amount:_0x34841a,currency:_0x45499f,webhookUrl:_0x44e75d,returnUrl:_0x2c6e86,expiryDate:_0x657c99}=_0x536063,_0x1860bf=_0x45499f[_0x325850(0x171)](),_0xfeff7c=_0x325850(0x127),_0xce417e=_0x325850(0x17b)+_0xf9acc3,_0x1b458={'name':_0x4febd2,'paymentDescription':_0x41090c,'amount':_0x34841a,'currency':_0x1860bf,'paymentId':_0xf9acc3,'webhookUrl':_0xfeff7c,'returnUrl':_0xce417e};_0x657c99&&(_0x1b458[_0x325850(0x12b)]=_0x657c99);const _0x420111=Date[_0x325850(0x138)]();try{console[_0x325850(0x129)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console['log'](_0x325850(0x189),this[_0x325850(0x14d)]),console[_0x325850(0x129)](_0x325850(0x140),JSON[_0x325850(0x13f)](_0x1b458,null,0x2)),console[_0x325850(0x129)](_0x325850(0x17c),_0xf9acc3,_0x325850(0x117)),loggerService_1[_0x325850(0x144)][_0x325850(0x168)](_0x325850(0x136),'/payment-links',_0x325850(0x17a),_0x1b458);const _0x2c8329=await fetch(this['apiUrl'],{'method':_0x325850(0x17a),'headers':{'Content-Type':'application/json','Accept':_0x325850(0x17e),'User-Agent':_0x325850(0x13d)},'body':JSON['stringify'](_0x1b458)}),_0x2e1a44=Date[_0x325850(0x138)]()-_0x420111;console[_0x325850(0x129)](_0x325850(0x181)),console[_0x325850(0x129)](_0x325850(0x165),_0x2c8329['status']),console[_0x325850(0x129)]('Status\x20Text:',_0x2c8329['statusText']),console[_0x325850(0x129)]('Headers:',Object['fromEntries'](_0x2c8329[_0x325850(0x149)]['entries']())),console['log'](_0x325850(0x18b),_0x2e1a44+'ms');const _0x17cee1=await _0x2c8329[_0x325850(0x15f)]();console[_0x325850(0x129)](_0x325850(0x177),_0x17cee1);if(!_0x2c8329['ok']){console[_0x325850(0x119)]('===\x20NODA\x20API\x20ERROR\x20==='),console['error'](_0x325850(0x13b),_0x2c8329[_0x325850(0x14a)]),console[_0x325850(0x119)](_0x325850(0x175),_0x17cee1),loggerService_1[_0x325850(0x144)][_0x325850(0x134)](_0x325850(0x136),_0x325850(0x155),_0x2c8329[_0x325850(0x14a)],_0x17cee1,_0x2e1a44),loggerService_1[_0x325850(0x144)]['logWhiteDomainError'](_0x325850(0x136),_0x325850(0x155),_0x325850(0x122)+_0x2c8329[_0x325850(0x14a)]+':\x20'+_0x17cee1);if(_0x2c8329['status']===0x190)throw new Error(_0x325850(0x176));else{if(_0x2c8329['status']===0x1f4)throw new Error(_0x325850(0x15d));}throw new Error(_0x325850(0x153)+_0x2c8329[_0x325850(0x14a)]+_0x325850(0x158)+_0x17cee1);}let _0x15c001;try{_0x15c001=JSON[_0x325850(0x16d)](_0x17cee1);}catch(_0x1e32c0){console[_0x325850(0x119)](_0x325850(0x186),_0x1e32c0),loggerService_1[_0x325850(0x144)][_0x325850(0x11d)](_0x325850(0x136),_0x325850(0x155),'JSON\x20Parse\x20Error:\x20'+_0x1e32c0);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x17cee1);}console[_0x325850(0x129)](_0x325850(0x135)),console[_0x325850(0x129)](_0x325850(0x183),JSON[_0x325850(0x13f)](_0x15c001,null,0x2)),loggerService_1[_0x325850(0x144)][_0x325850(0x134)](_0x325850(0x136),'/payment-links',_0x2c8329[_0x325850(0x14a)],_0x15c001,_0x2e1a44);if(_0x15c001[_0x325850(0x119)]||_0x15c001[_0x325850(0x126)]){const _0x510dc6=_0x15c001[_0x325850(0x18a)]||_0x15c001[_0x325850(0x119)]||_0x325850(0x187);console[_0x325850(0x119)](_0x325850(0x142)),console['error'](_0x325850(0x15c),_0x510dc6),console['error'](_0x325850(0x151),_0x15c001[_0x325850(0x126)]),loggerService_1[_0x325850(0x144)][_0x325850(0x11d)](_0x325850(0x136),_0x325850(0x155),_0x325850(0x184)+_0x510dc6);throw new Error('Noda\x20API\x20error:\x20'+_0x510dc6);}if(!_0x15c001['id']||!_0x15c001['shortLinkUrls']?.[_0x325850(0x169)]){console[_0x325850(0x119)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x325850(0x167)),console[_0x325850(0x119)](_0x325850(0x160),_0x15c001),loggerService_1[_0x325850(0x144)][_0x325850(0x11d)]('noda','/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x325850(0x133));}return console[_0x325850(0x129)](_0x325850(0x141)),console['log']('Payment\x20Link\x20ID:',_0x15c001['id']),console[_0x325850(0x129)](_0x325850(0x18e),_0x15c001[_0x325850(0x13a)][_0x325850(0x169)]),console[_0x325850(0x129)]('QR\x20Code\x20Link:',_0x15c001['shortLinkUrls']['qrCodeLink']||_0x325850(0x173)),console[_0x325850(0x129)](_0x325850(0x150),_0xf9acc3,_0x325850(0x152)),{'gateway_payment_id':_0x15c001['id'],'payment_url':_0x15c001[_0x325850(0x13a)][_0x325850(0x169)],'qr_code_url':_0x15c001['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x15c001['expiryDate']};}catch(_0x814eaa){console['error'](_0x325850(0x154)),console[_0x325850(0x119)](_0x325850(0x18d),_0x814eaa),loggerService_1[_0x325850(0x144)][_0x325850(0x11d)](_0x325850(0x136),'/payment-links',_0x814eaa);if(_0x814eaa instanceof Error){console[_0x325850(0x119)](_0x325850(0x16b),_0x814eaa[_0x325850(0x18a)]),console[_0x325850(0x119)]('Error\x20stack:',_0x814eaa[_0x325850(0x118)]);throw new Error(_0x325850(0x12a)+_0x814eaa[_0x325850(0x18a)]);}throw new Error(_0x325850(0x156));}}async[a40_0x439a92(0x13e)](_0x2686a8){const _0x37394e=a40_0x439a92,_0x738bd6=Date[_0x37394e(0x138)]();try{loggerService_1['loggerService']['logWhiteDomainRequest'](_0x37394e(0x136),_0x37394e(0x180)+_0x2686a8,_0x37394e(0x143),{});const _0x3cf2c3=await fetch(this[_0x37394e(0x14d)]+'/'+_0x2686a8,{'method':_0x37394e(0x143),'headers':{'Content-Type':'application/json','User-Agent':_0x37394e(0x13d)}}),_0x112fea=Date[_0x37394e(0x138)]()-_0x738bd6;if(!_0x3cf2c3['ok']){const _0x2e9e4f=await _0x3cf2c3[_0x37394e(0x15f)]();loggerService_1[_0x37394e(0x144)]['logWhiteDomainResponse'](_0x37394e(0x136),'/payment-links/'+_0x2686a8,_0x3cf2c3[_0x37394e(0x14a)],_0x2e9e4f,_0x112fea);throw new Error(_0x37394e(0x153)+_0x3cf2c3[_0x37394e(0x14a)]);}const _0x3d46b=await _0x3cf2c3['json']();loggerService_1[_0x37394e(0x144)][_0x37394e(0x134)](_0x37394e(0x136),_0x37394e(0x180)+_0x2686a8,_0x3cf2c3['status'],_0x3d46b,_0x112fea);if(_0x3d46b[_0x37394e(0x119)]||_0x3d46b[_0x37394e(0x126)]){loggerService_1[_0x37394e(0x144)]['logWhiteDomainError'](_0x37394e(0x136),_0x37394e(0x180)+_0x2686a8,_0x37394e(0x137)+(_0x3d46b[_0x37394e(0x18a)]||_0x3d46b[_0x37394e(0x119)]||_0x37394e(0x15a)));throw new Error(_0x37394e(0x137)+(_0x3d46b[_0x37394e(0x18a)]||_0x3d46b[_0x37394e(0x119)]||_0x37394e(0x15a)));}let _0x4d4117=_0x37394e(0x123);if(_0x3d46b['isActive']===![]){if(_0x3d46b[_0x37394e(0x12b)]){const _0x5c836d=new Date(_0x3d46b[_0x37394e(0x12b)]),_0x32827e=new Date();_0x5c836d<_0x32827e?_0x4d4117=_0x37394e(0x139):_0x4d4117=_0x37394e(0x185);}else _0x4d4117=_0x37394e(0x185);}else _0x4d4117=_0x37394e(0x123);return{'status':_0x4d4117,'amount':_0x3d46b[_0x37394e(0x18c)],'currency':_0x3d46b[_0x37394e(0x16e)],'isActive':_0x3d46b['isActive']};}catch(_0x2445d){console['error']('Noda\x20payment\x20verification\x20error:',_0x2445d),loggerService_1['loggerService'][_0x37394e(0x11d)](_0x37394e(0x136),_0x37394e(0x180)+_0x2686a8,_0x2445d);throw new Error(_0x37394e(0x125)+(_0x2445d instanceof Error?_0x2445d[_0x37394e(0x18a)]:_0x37394e(0x15a)));}}async[a40_0x439a92(0x12e)](_0x4aa332){const _0x537565=a40_0x439a92;console[_0x537565(0x129)](_0x537565(0x157),_0x4aa332);let _0x3a981a='PENDING';switch(_0x4aa332[_0x537565(0x179)]?.[_0x537565(0x12d)]()){case _0x537565(0x178):case _0x537565(0x170):case _0x537565(0x17d):case _0x537565(0x14f):case _0x537565(0x11a):_0x4aa332[_0x537565(0x14c)]===_0x537565(0x166)?_0x3a981a=_0x537565(0x11e):_0x3a981a='PENDING';break;case _0x537565(0x12f):case'canceled':case _0x537565(0x17f):case'error':case'rejected':_0x3a981a='FAILED';break;case _0x537565(0x12c):case _0x537565(0x164):_0x3a981a=_0x537565(0x139);break;case _0x537565(0x11b):case'created':case _0x537565(0x121):case _0x537565(0x163):case _0x537565(0x16c):default:_0x3a981a=_0x537565(0x123);break;}return{'paymentId':_0x4aa332[_0x537565(0x120)]||_0x4aa332[_0x537565(0x161)],'status':_0x3a981a,'amount':_0x4aa332['Amount'],'currency':_0x4aa332[_0x537565(0x15b)],'additionalInfo':{'method':_0x4aa332[_0x537565(0x172)],'bankId':_0x4aa332[_0x537565(0x124)],'settled':_0x4aa332[_0x537565(0x14c)],'settlementDate':_0x4aa332[_0x537565(0x16a)],'remitterName':_0x4aa332[_0x537565(0x147)]?.[_0x537565(0x14b)],'remitterIban':_0x4aa332[_0x537565(0x147)]?.['Iban'],'bankTransactionId':_0x4aa332[_0x537565(0x128)]}};}[a40_0x439a92(0x148)](_0x5c7914,_0x15a57a){const _0x21a7b0=a40_0x439a92;return console[_0x21a7b0(0x129)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x15a57a,'paymentId':_0x5c7914[_0x21a7b0(0x161)],'merchantPaymentId':_0x5c7914[_0x21a7b0(0x120)]}),!![];}}exports[a40_0x439a92(0x182)]=NodaService;