'use strict';const a43_0x3e01ec=a43_0x185b;(function(_0x45448d,_0x3913bf){const _0x1cd194=a43_0x185b,_0x369912=_0x45448d();while(!![]){try{const _0x30d409=-parseInt(_0x1cd194(0xaa))/0x1+-parseInt(_0x1cd194(0x74))/0x2*(parseInt(_0x1cd194(0x94))/0x3)+-parseInt(_0x1cd194(0xb4))/0x4+-parseInt(_0x1cd194(0xbc))/0x5*(parseInt(_0x1cd194(0x72))/0x6)+-parseInt(_0x1cd194(0x7b))/0x7+parseInt(_0x1cd194(0x7d))/0x8+parseInt(_0x1cd194(0xd5))/0x9;if(_0x30d409===_0x3913bf)break;else _0x369912['push'](_0x369912['shift']());}catch(_0x107653){_0x369912['push'](_0x369912['shift']());}}}(a43_0x3ee1,0x9e3c2));function a43_0x185b(_0x274852,_0x45918c){const _0x3ee159=a43_0x3ee1();return a43_0x185b=function(_0x185bde,_0x2a8436){_0x185bde=_0x185bde-0x66;let _0x228c3d=_0x3ee159[_0x185bde];return _0x228c3d;},a43_0x185b(_0x274852,_0x45918c);}Object[a43_0x3e01ec(0xd3)](exports,a43_0x3e01ec(0xbb),{'value':!![]}),exports[a43_0x3e01ec(0x71)]=void 0x0;const loggerService_1=require(a43_0x3e01ec(0x9c));class NodaService{constructor(){const _0x5115c5=a43_0x3e01ec;this[_0x5115c5(0xbd)]=_0x5115c5(0xc3),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async['createPaymentLink'](_0x587679){const _0x3a4655=a43_0x3e01ec,{orderId:_0x593625,name:_0x286d10,paymentDescription:_0x4cf898,amount:_0x41b197,currency:_0x226824,webhookUrl:_0x542675,returnUrl:_0x3c19dc,expiryDate:_0x3dc7e6}=_0x587679,_0x1b4fcf=_0x226824[_0x3a4655(0xab)](),_0x2fe0d2='https://tesoft.uk/gateway/noda/webhook/',_0x199544='https://tesoft.uk/gateway/pending.php?id='+_0x593625,_0x533bec={'name':_0x286d10,'paymentDescription':_0x4cf898,'amount':_0x41b197,'currency':_0x1b4fcf,'paymentId':_0x593625,'webhookUrl':_0x2fe0d2,'returnUrl':_0x199544};_0x3dc7e6&&(_0x533bec['expiryDate']=_0x3dc7e6);const _0x233945=Date[_0x3a4655(0x6a)]();try{console[_0x3a4655(0x92)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x3a4655(0x92)](_0x3a4655(0x9a),this[_0x3a4655(0xbd)]),console[_0x3a4655(0x92)](_0x3a4655(0x90),JSON[_0x3a4655(0xcb)](_0x533bec,null,0x2)),console[_0x3a4655(0x92)]('Order\x20ID\x20Format:',_0x593625,_0x3a4655(0x9d)),console[_0x3a4655(0x92)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x199544),loggerService_1[_0x3a4655(0xd6)][_0x3a4655(0x81)]('noda',_0x3a4655(0xa5),_0x3a4655(0xdd),_0x533bec);const _0x2bbbb7=await fetch(this[_0x3a4655(0xbd)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x3a4655(0x99),'User-Agent':_0x3a4655(0x75)},'body':JSON[_0x3a4655(0xcb)](_0x533bec)}),_0x2130a3=Date[_0x3a4655(0x6a)]()-_0x233945;console[_0x3a4655(0x92)](_0x3a4655(0xb8)),console[_0x3a4655(0x92)](_0x3a4655(0x7e),_0x2bbbb7[_0x3a4655(0xa1)]),console[_0x3a4655(0x92)](_0x3a4655(0xc7),_0x2bbbb7[_0x3a4655(0x9f)]),console['log'](_0x3a4655(0x7f),Object[_0x3a4655(0xcc)](_0x2bbbb7[_0x3a4655(0x77)][_0x3a4655(0xd0)]())),console['log']('Response\x20Time:',_0x2130a3+'ms');const _0x615a86=await _0x2bbbb7['text']();console[_0x3a4655(0x92)](_0x3a4655(0x85),_0x615a86);if(!_0x2bbbb7['ok']){console[_0x3a4655(0x89)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x3a4655(0x89)](_0x3a4655(0x6f),_0x2bbbb7[_0x3a4655(0xa1)]),console['error']('Response\x20Body:',_0x615a86),loggerService_1[_0x3a4655(0xd6)]['logWhiteDomainResponse'](_0x3a4655(0x98),_0x3a4655(0xa5),_0x2bbbb7['status'],_0x615a86,_0x2130a3),loggerService_1[_0x3a4655(0xd6)][_0x3a4655(0xb9)](_0x3a4655(0x98),_0x3a4655(0xa5),_0x3a4655(0xd8)+_0x2bbbb7[_0x3a4655(0xa1)]+':\x20'+_0x615a86);if(_0x2bbbb7[_0x3a4655(0xa1)]===0x190)throw new Error(_0x3a4655(0xd7));else{if(_0x2bbbb7[_0x3a4655(0xa1)]===0x1f4)throw new Error(_0x3a4655(0xa7));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x2bbbb7[_0x3a4655(0xa1)]+_0x3a4655(0xda)+_0x615a86);}let _0x4d1ee0;try{_0x4d1ee0=JSON[_0x3a4655(0x88)](_0x615a86);}catch(_0x427960){console[_0x3a4655(0x89)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x427960),loggerService_1['loggerService']['logWhiteDomainError'](_0x3a4655(0x98),_0x3a4655(0xa5),_0x3a4655(0xae)+_0x427960);throw new Error(_0x3a4655(0x7c)+_0x615a86);}console['log'](_0x3a4655(0x69)),console[_0x3a4655(0x92)](_0x3a4655(0x8b),JSON[_0x3a4655(0xcb)](_0x4d1ee0,null,0x2)),loggerService_1[_0x3a4655(0xd6)][_0x3a4655(0x8a)](_0x3a4655(0x98),_0x3a4655(0xa5),_0x2bbbb7[_0x3a4655(0xa1)],_0x4d1ee0,_0x2130a3);if(_0x4d1ee0[_0x3a4655(0x89)]||_0x4d1ee0[_0x3a4655(0x6d)]){const _0x2acb15=_0x4d1ee0['message']||_0x4d1ee0[_0x3a4655(0x89)]||_0x3a4655(0xba);console[_0x3a4655(0x89)](_0x3a4655(0x73)),console[_0x3a4655(0x89)]('Error\x20Message:',_0x2acb15),console['error'](_0x3a4655(0xa2),_0x4d1ee0['statusCode']),loggerService_1[_0x3a4655(0xd6)][_0x3a4655(0xb9)]('noda',_0x3a4655(0xa5),_0x3a4655(0xb1)+_0x2acb15);throw new Error(_0x3a4655(0x97)+_0x2acb15);}if(!_0x4d1ee0['id']||!_0x4d1ee0[_0x3a4655(0x67)]?.[_0x3a4655(0xd2)]){console[_0x3a4655(0x89)](_0x3a4655(0xad)),console[_0x3a4655(0x89)](_0x3a4655(0xa0)),console[_0x3a4655(0x89)]('Response\x20data:',_0x4d1ee0),loggerService_1['loggerService'][_0x3a4655(0xb9)](_0x3a4655(0x98),'/payment-links',_0x3a4655(0x8c));throw new Error(_0x3a4655(0xd1));}return console[_0x3a4655(0x92)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x3a4655(0x92)](_0x3a4655(0x87),_0x4d1ee0['id']),console[_0x3a4655(0x92)]('Short\x20Link:',_0x4d1ee0[_0x3a4655(0x67)][_0x3a4655(0xd2)]),console[_0x3a4655(0x92)]('QR\x20Code\x20Link:',_0x4d1ee0[_0x3a4655(0x67)][_0x3a4655(0x6c)]||_0x3a4655(0x76)),console[_0x3a4655(0x92)](_0x3a4655(0x9e),_0x593625,_0x3a4655(0x70)),console[_0x3a4655(0x92)](_0x3a4655(0xb6),_0x199544),{'gateway_payment_id':_0x4d1ee0['id'],'payment_url':_0x4d1ee0[_0x3a4655(0x67)][_0x3a4655(0xd2)],'qr_code_url':_0x4d1ee0[_0x3a4655(0x67)][_0x3a4655(0x6c)],'expiry_date':_0x4d1ee0[_0x3a4655(0x8f)]};}catch(_0x1cef2d){console[_0x3a4655(0x89)](_0x3a4655(0xac)),console[_0x3a4655(0x89)](_0x3a4655(0xbf),_0x1cef2d),loggerService_1[_0x3a4655(0xd6)][_0x3a4655(0xb9)](_0x3a4655(0x98),_0x3a4655(0xa5),_0x1cef2d);if(_0x1cef2d instanceof Error){console['error'](_0x3a4655(0x78),_0x1cef2d[_0x3a4655(0xaf)]),console[_0x3a4655(0x89)](_0x3a4655(0x9b),_0x1cef2d[_0x3a4655(0xce)]);throw new Error(_0x3a4655(0xa4)+_0x1cef2d[_0x3a4655(0xaf)]);}throw new Error(_0x3a4655(0xbe));}}async[a43_0x3e01ec(0x8e)](_0x393ab8){const _0x4c6eb7=a43_0x3e01ec,_0x20aba9=Date['now']();try{loggerService_1[_0x4c6eb7(0xd6)]['logWhiteDomainRequest'](_0x4c6eb7(0x98),_0x4c6eb7(0x6b)+_0x393ab8,_0x4c6eb7(0x95),{});const _0x2032f1=await fetch(this[_0x4c6eb7(0xbd)]+'/'+_0x393ab8,{'method':_0x4c6eb7(0x95),'headers':{'Content-Type':_0x4c6eb7(0x99),'User-Agent':_0x4c6eb7(0x75)}}),_0x4d5946=Date[_0x4c6eb7(0x6a)]()-_0x20aba9;if(!_0x2032f1['ok']){const _0x1ea42f=await _0x2032f1[_0x4c6eb7(0xb0)]();loggerService_1[_0x4c6eb7(0xd6)][_0x4c6eb7(0x8a)](_0x4c6eb7(0x98),'/payment-links/'+_0x393ab8,_0x2032f1[_0x4c6eb7(0xa1)],_0x1ea42f,_0x4d5946);throw new Error(_0x4c6eb7(0xa9)+_0x2032f1['status']);}const _0x31fb7b=await _0x2032f1[_0x4c6eb7(0xc9)]();loggerService_1[_0x4c6eb7(0xd6)][_0x4c6eb7(0x8a)](_0x4c6eb7(0x98),_0x4c6eb7(0x6b)+_0x393ab8,_0x2032f1[_0x4c6eb7(0xa1)],_0x31fb7b,_0x4d5946);if(_0x31fb7b['error']||_0x31fb7b[_0x4c6eb7(0x6d)]){loggerService_1[_0x4c6eb7(0xd6)][_0x4c6eb7(0xb9)](_0x4c6eb7(0x98),_0x4c6eb7(0x6b)+_0x393ab8,'Noda\x20API\x20error:\x20'+(_0x31fb7b[_0x4c6eb7(0xaf)]||_0x31fb7b[_0x4c6eb7(0x89)]||_0x4c6eb7(0xd4)));throw new Error(_0x4c6eb7(0x97)+(_0x31fb7b['message']||_0x31fb7b[_0x4c6eb7(0x89)]||_0x4c6eb7(0xd4)));}let _0x5841f5=_0x4c6eb7(0xc1);if(_0x31fb7b['isActive']===![]){if(_0x31fb7b[_0x4c6eb7(0x8f)]){const _0xef79ee=new Date(_0x31fb7b[_0x4c6eb7(0x8f)]),_0x6626a=new Date();_0xef79ee<_0x6626a?_0x5841f5=_0x4c6eb7(0x66):_0x5841f5=_0x4c6eb7(0xa6);}else _0x5841f5=_0x4c6eb7(0xa6);}else _0x5841f5=_0x4c6eb7(0xc1);return{'status':_0x5841f5,'amount':_0x31fb7b[_0x4c6eb7(0x8d)],'currency':_0x31fb7b['currency'],'isActive':_0x31fb7b[_0x4c6eb7(0x82)]};}catch(_0x3d62ca){console['error']('Noda\x20payment\x20verification\x20error:',_0x3d62ca),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x4c6eb7(0x6b)+_0x393ab8,_0x3d62ca);throw new Error(_0x4c6eb7(0xa3)+(_0x3d62ca instanceof Error?_0x3d62ca[_0x4c6eb7(0xaf)]:_0x4c6eb7(0xd4)));}}async[a43_0x3e01ec(0x68)](_0x2d776b){const _0x27001e=a43_0x3e01ec;console[_0x27001e(0x92)](_0x27001e(0xc6),_0x2d776b);let _0x21b565=_0x27001e(0xc1);switch(_0x2d776b[_0x27001e(0xb3)]?.[_0x27001e(0xde)]()){case _0x27001e(0xdb):case _0x27001e(0xc8):case _0x27001e(0xca):case'success':case'successful':_0x2d776b[_0x27001e(0x7a)]==='Yes'?_0x21b565=_0x27001e(0xcf):_0x21b565=_0x27001e(0xc1);break;case _0x27001e(0x6e):case _0x27001e(0xdc):case _0x27001e(0x96):case _0x27001e(0x89):case _0x27001e(0xc0):_0x21b565=_0x27001e(0xa6);break;case _0x27001e(0xb2):case'timeout':_0x21b565=_0x27001e(0x66);break;case _0x27001e(0xa8):case _0x27001e(0xcd):case _0x27001e(0x83):case _0x27001e(0xb7):case _0x27001e(0x80):default:_0x21b565=_0x27001e(0xc1);break;}return{'paymentId':_0x2d776b[_0x27001e(0x86)]||_0x2d776b['PaymentId'],'status':_0x21b565,'amount':_0x2d776b[_0x27001e(0x91)],'currency':_0x2d776b[_0x27001e(0x93)],'additionalInfo':{'method':_0x2d776b[_0x27001e(0x79)],'bankId':_0x2d776b[_0x27001e(0xc2)],'settled':_0x2d776b[_0x27001e(0x7a)],'settlementDate':_0x2d776b['SettlementDate'],'remitterName':_0x2d776b[_0x27001e(0x84)]?.[_0x27001e(0xc4)],'remitterIban':_0x2d776b[_0x27001e(0x84)]?.[_0x27001e(0xd9)],'bankTransactionId':_0x2d776b[_0x27001e(0xb5)]}};}['verifyWebhookSignature'](_0x4a80be,_0x29839b){const _0x2bffbd=a43_0x3e01ec;return console[_0x2bffbd(0x92)](_0x2bffbd(0xc5),{'receivedSignature':_0x29839b,'paymentId':_0x4a80be['PaymentId'],'merchantPaymentId':_0x4a80be[_0x2bffbd(0x86)]}),!![];}}exports['NodaService']=NodaService;function a43_0x3ee1(){const _0x5ade4c=['Error\x20message:','Method','Settled','5754399uDkYbI','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','1275008vhLedr','Status:','Headers:','in_progress','logWhiteDomainRequest','isActive','active','Remitter','Raw\x20Response\x20Body:','MerchantPaymentId','Payment\x20Link\x20ID:','parse','error','logWhiteDomainResponse','Parsed\x20Result:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','amount','verifyPayment','expiryDate','Request\x20Body\x20(Direct\x20JSON):','Amount','log','Currency','174909rZLqql','GET','failed','Noda\x20API\x20error:\x20','noda','application/json','URL:','Error\x20stack:','../loggerService','(8digits-8digits\x20format\x20for\x20Noda)','Order\x20ID\x20Used:','statusText','Missing\x20id\x20or\x20shortLink\x20in\x20response','status','Status\x20Code:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','/payment-links','FAILED','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','pending','HTTP\x20error!\x20status:\x20','1070581LUTeaV','toUpperCase','===\x20NODA\x20SERVICE\x20ERROR\x20===','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','JSON\x20Parse\x20Error:\x20','message','text','Business\x20Error:\x20','expired','Status','3328036xtMTef','BankTransactionId','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','processing','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainError','Unknown\x20error\x20from\x20Noda\x20API','__esModule','10EvUJSN','apiUrl','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Error\x20details:','rejected','PENDING','BankId','https://tesoft.uk/gateway/noda/','Name','Noda\x20webhook\x20signature\x20verification:','Processing\x20Noda\x20webhook:','Status\x20Text:','completed','json','paid','stringify','fromEntries','created','stack','PAID','entries','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','shortLink','defineProperty','Unknown\x20error','36839736YBNIyb','loggerService','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','HTTP\x20','Iban',',\x20body:\x20','done','canceled','POST','toLowerCase','EXPIRED','shortLinkUrls','processWebhook','===\x20PARSED\x20NODA\x20RESPONSE\x20===','now','/payment-links/','qrCodeLink','statusCode','cancelled','HTTP\x20Status:','(8digits-8digits\x20format)','NodaService','365892DVbqIq','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','26EsaCbj','TesSoft\x20Payment\x20System/1.0','Not\x20provided','headers'];a43_0x3ee1=function(){return _0x5ade4c;};return a43_0x3ee1();}