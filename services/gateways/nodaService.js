'use strict';function a43_0x3b1d(_0x57f76b,_0x5a5e75){const _0x3e949c=a43_0x3e94();return a43_0x3b1d=function(_0x3b1dae,_0x587838){_0x3b1dae=_0x3b1dae-0xf0;let _0x6e8d22=_0x3e949c[_0x3b1dae];return _0x6e8d22;},a43_0x3b1d(_0x57f76b,_0x5a5e75);}function a43_0x3e94(){const _0x1a3a6e=['cancelled','/payment-links/','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','BankId','Headers:','PENDING','(8digits-8digits\x20format)','Missing\x20id\x20or\x20shortLink\x20in\x20response','../loggerService','success','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Noda\x20payment\x20verification\x20error:','EXPIRED','Yes','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','URL:','amount','Processing\x20Noda\x20webhook:','rejected','Settled','Error\x20message:','HTTP\x20Status:','headers','expired','statusCode','Name','parse','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','verifyWebhookSignature','entries','message','status','3AINTgp','text','isActive','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Parsed\x20Result:','stack','successful','NodaService','qrCodeLink','Status:','FAILED','QR\x20Code\x20Link:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','in_progress','===\x20NODA\x20SERVICE\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','now','16666BTudCN','12655740getCjD','Unknown\x20error','Amount','1473905QewReo','completed','Business\x20Error:\x20','defineProperty','expiryDate','https://tesoft.uk/gateway/pending.php?id=','Request\x20Body\x20(Direct\x20JSON):','3421136ufdVLN','HTTP\x20error!\x20status:\x20','https://tesoft.uk/gateway/noda/webhook/','Response\x20Time:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','HTTP\x20','===\x20NODA\x20API\x20ERROR\x20===','error','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','logWhiteDomainError','Error\x20Message:','Response\x20data:','verifyPayment','done','1687604iWRftn','shortLinkUrls','/payment-links','Short\x20Link:','(8digits-8digits\x20format\x20for\x20Noda)','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','logWhiteDomainResponse','JSON\x20Parse\x20Error:\x20','Raw\x20Response\x20Body:','https://tesoft.uk/gateway/noda/','2248532fbAHIL','Status\x20Code:','TesSoft\x20Payment\x20System/1.0','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Error\x20stack:','Iban','7dOaWoM','Remitter','log','noda','Currency','PaymentId','shortLink','created','===\x20NODA\x20SUCCESS\x20===','12PEbbzQ','58QbfUEF','canceled','Not\x20provided','timeout','toUpperCase','POST','MerchantPaymentId','Order\x20ID\x20Used:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','GET','3627549qUDtvN','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','active','Noda\x20API\x20error:\x20','Payment\x20Link\x20ID:','processWebhook','SettlementDate','10ARnJif','Status\x20Text:','__esModule','apiUrl','loggerService','stringify'];a43_0x3e94=function(){return _0x1a3a6e;};return a43_0x3e94();}const a43_0x3ccf7b=a43_0x3b1d;(function(_0x405d30,_0x4d8734){const _0x270f99=a43_0x3b1d,_0x2adb3f=_0x405d30();while(!![]){try{const _0x54ca0c=-parseInt(_0x270f99(0x16a))/0x1*(-parseInt(_0x270f99(0x136))/0x2)+parseInt(_0x270f99(0x125))/0x3*(parseInt(_0x270f99(0x14f))/0x4)+-parseInt(_0x270f99(0x13a))/0x5*(parseInt(_0x270f99(0x169))/0x6)+-parseInt(_0x270f99(0x160))/0x7*(parseInt(_0x270f99(0x141))/0x8)+-parseInt(_0x270f99(0xf8))/0x9*(parseInt(_0x270f99(0xff))/0xa)+-parseInt(_0x270f99(0x15a))/0xb+parseInt(_0x270f99(0x137))/0xc;if(_0x54ca0c===_0x4d8734)break;else _0x2adb3f['push'](_0x2adb3f['shift']());}catch(_0x2b27c8){_0x2adb3f['push'](_0x2adb3f['shift']());}}}(a43_0x3e94,0x51d4f));Object[a43_0x3ccf7b(0x13d)](exports,a43_0x3ccf7b(0x101),{'value':!![]}),exports[a43_0x3ccf7b(0x12c)]=void 0x0;const loggerService_1=require(a43_0x3ccf7b(0x10d));class NodaService{constructor(){const _0x49f2f9=a43_0x3ccf7b;this[_0x49f2f9(0x102)]=_0x49f2f9(0x159),console[_0x49f2f9(0x162)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async['createPaymentLink'](_0x4b205b){const _0x4237a8=a43_0x3ccf7b,{orderId:_0x4e0dd5,name:_0x221b97,paymentDescription:_0x47a462,amount:_0x153914,currency:_0x41d9aa,webhookUrl:_0x369a49,returnUrl:_0x5bce94,expiryDate:_0x3aa950}=_0x4b205b,_0x2fcfda=_0x41d9aa[_0x4237a8(0xf2)](),_0x41ed97=_0x4237a8(0x143),_0x199d71=_0x4237a8(0x13f)+_0x4e0dd5,_0x1c9cab={'name':_0x221b97,'paymentDescription':_0x47a462,'amount':_0x153914,'currency':_0x2fcfda,'paymentId':_0x4e0dd5,'webhookUrl':_0x41ed97,'returnUrl':_0x199d71};_0x3aa950&&(_0x1c9cab[_0x4237a8(0x13e)]=_0x3aa950);const _0x4deaff=Date[_0x4237a8(0x135)]();try{console[_0x4237a8(0x162)](_0x4237a8(0x149)),console[_0x4237a8(0x162)](_0x4237a8(0x114),this[_0x4237a8(0x102)]),console['log'](_0x4237a8(0x140),JSON[_0x4237a8(0x104)](_0x1c9cab,null,0x2)),console['log']('Order\x20ID\x20Format:',_0x4e0dd5,_0x4237a8(0x153)),console[_0x4237a8(0x162)](_0x4237a8(0xf9),_0x199d71),loggerService_1[_0x4237a8(0x103)]['logWhiteDomainRequest']('noda','/payment-links',_0x4237a8(0xf3),_0x1c9cab);const _0x3215b1=await fetch(this[_0x4237a8(0x102)],{'method':_0x4237a8(0xf3),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x4237a8(0x15c)},'body':JSON[_0x4237a8(0x104)](_0x1c9cab)}),_0x4edff0=Date[_0x4237a8(0x135)]()-_0x4deaff;console['log'](_0x4237a8(0x131)),console[_0x4237a8(0x162)](_0x4237a8(0x12e),_0x3215b1['status']),console[_0x4237a8(0x162)](_0x4237a8(0x100),_0x3215b1['statusText']),console[_0x4237a8(0x162)](_0x4237a8(0x109),Object['fromEntries'](_0x3215b1[_0x4237a8(0x11b)][_0x4237a8(0x122)]())),console[_0x4237a8(0x162)](_0x4237a8(0x144),_0x4edff0+'ms');const _0x1833e8=await _0x3215b1[_0x4237a8(0x126)]();console[_0x4237a8(0x162)](_0x4237a8(0x158),_0x1833e8);if(!_0x3215b1['ok']){console[_0x4237a8(0x148)](_0x4237a8(0x147)),console[_0x4237a8(0x148)](_0x4237a8(0x11a),_0x3215b1['status']),console[_0x4237a8(0x148)]('Response\x20Body:',_0x1833e8),loggerService_1[_0x4237a8(0x103)][_0x4237a8(0x156)](_0x4237a8(0x163),_0x4237a8(0x151),_0x3215b1[_0x4237a8(0x124)],_0x1833e8,_0x4edff0),loggerService_1[_0x4237a8(0x103)][_0x4237a8(0x14a)](_0x4237a8(0x163),_0x4237a8(0x151),_0x4237a8(0x146)+_0x3215b1['status']+':\x20'+_0x1833e8);if(_0x3215b1[_0x4237a8(0x124)]===0x190)throw new Error(_0x4237a8(0xf6));else{if(_0x3215b1[_0x4237a8(0x124)]===0x1f4)throw new Error(_0x4237a8(0x10f));}throw new Error(_0x4237a8(0x142)+_0x3215b1[_0x4237a8(0x124)]+',\x20body:\x20'+_0x1833e8);}let _0x3542ef;try{_0x3542ef=JSON[_0x4237a8(0x11f)](_0x1833e8);}catch(_0x2a3d33){console[_0x4237a8(0x148)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x2a3d33),loggerService_1[_0x4237a8(0x103)]['logWhiteDomainError'](_0x4237a8(0x163),_0x4237a8(0x151),_0x4237a8(0x157)+_0x2a3d33);throw new Error(_0x4237a8(0x134)+_0x1833e8);}console['log'](_0x4237a8(0x154)),console['log'](_0x4237a8(0x129),JSON['stringify'](_0x3542ef,null,0x2)),loggerService_1[_0x4237a8(0x103)][_0x4237a8(0x156)](_0x4237a8(0x163),_0x4237a8(0x151),_0x3215b1['status'],_0x3542ef,_0x4edff0);if(_0x3542ef['error']||_0x3542ef[_0x4237a8(0x11d)]){const _0xb325b=_0x3542ef['message']||_0x3542ef[_0x4237a8(0x148)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x4237a8(0x148)](_0x4237a8(0x113)),console[_0x4237a8(0x148)](_0x4237a8(0x14b),_0xb325b),console[_0x4237a8(0x148)](_0x4237a8(0x15b),_0x3542ef[_0x4237a8(0x11d)]),loggerService_1[_0x4237a8(0x103)][_0x4237a8(0x14a)]('noda',_0x4237a8(0x151),_0x4237a8(0x13c)+_0xb325b);throw new Error(_0x4237a8(0xfb)+_0xb325b);}if(!_0x3542ef['id']||!_0x3542ef[_0x4237a8(0x150)]?.[_0x4237a8(0x166)]){console[_0x4237a8(0x148)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x4237a8(0x10c)),console[_0x4237a8(0x148)](_0x4237a8(0x14c),_0x3542ef),loggerService_1['loggerService'][_0x4237a8(0x14a)](_0x4237a8(0x163),_0x4237a8(0x151),_0x4237a8(0x155));throw new Error(_0x4237a8(0x15d));}return console[_0x4237a8(0x162)](_0x4237a8(0x168)),console[_0x4237a8(0x162)](_0x4237a8(0xfc),_0x3542ef['id']),console[_0x4237a8(0x162)](_0x4237a8(0x152),_0x3542ef[_0x4237a8(0x150)][_0x4237a8(0x166)]),console['log'](_0x4237a8(0x130),_0x3542ef['shortLinkUrls'][_0x4237a8(0x12d)]||_0x4237a8(0xf0)),console[_0x4237a8(0x162)](_0x4237a8(0xf5),_0x4e0dd5,_0x4237a8(0x10b)),console[_0x4237a8(0x162)](_0x4237a8(0x107),_0x199d71),{'gateway_payment_id':_0x3542ef['id'],'payment_url':_0x3542ef[_0x4237a8(0x150)]['shortLink'],'qr_code_url':_0x3542ef[_0x4237a8(0x150)][_0x4237a8(0x12d)],'expiry_date':_0x3542ef['expiryDate']};}catch(_0x2613b1){console['error'](_0x4237a8(0x133)),console['error']('Error\x20details:',_0x2613b1),loggerService_1[_0x4237a8(0x103)]['logWhiteDomainError'](_0x4237a8(0x163),'/payment-links',_0x2613b1);if(_0x2613b1 instanceof Error){console[_0x4237a8(0x148)](_0x4237a8(0x119),_0x2613b1[_0x4237a8(0x123)]),console['error'](_0x4237a8(0x15e),_0x2613b1[_0x4237a8(0x12a)]);throw new Error(_0x4237a8(0x120)+_0x2613b1[_0x4237a8(0x123)]);}throw new Error(_0x4237a8(0x128));}}async[a43_0x3ccf7b(0x14d)](_0xcfcd37){const _0x8b189c=a43_0x3ccf7b,_0x59931b=Date[_0x8b189c(0x135)]();try{loggerService_1[_0x8b189c(0x103)]['logWhiteDomainRequest'](_0x8b189c(0x163),'/payment-links/'+_0xcfcd37,'GET',{});const _0x477929=await fetch(this[_0x8b189c(0x102)]+'/'+_0xcfcd37,{'method':_0x8b189c(0xf7),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x4469ea=Date[_0x8b189c(0x135)]()-_0x59931b;if(!_0x477929['ok']){const _0x228408=await _0x477929[_0x8b189c(0x126)]();loggerService_1[_0x8b189c(0x103)][_0x8b189c(0x156)](_0x8b189c(0x163),_0x8b189c(0x106)+_0xcfcd37,_0x477929['status'],_0x228408,_0x4469ea);throw new Error(_0x8b189c(0x142)+_0x477929[_0x8b189c(0x124)]);}const _0x3d755a=await _0x477929['json']();loggerService_1[_0x8b189c(0x103)][_0x8b189c(0x156)](_0x8b189c(0x163),'/payment-links/'+_0xcfcd37,_0x477929[_0x8b189c(0x124)],_0x3d755a,_0x4469ea);if(_0x3d755a[_0x8b189c(0x148)]||_0x3d755a[_0x8b189c(0x11d)]){loggerService_1['loggerService'][_0x8b189c(0x14a)](_0x8b189c(0x163),_0x8b189c(0x106)+_0xcfcd37,_0x8b189c(0xfb)+(_0x3d755a[_0x8b189c(0x123)]||_0x3d755a[_0x8b189c(0x148)]||_0x8b189c(0x138)));throw new Error('Noda\x20API\x20error:\x20'+(_0x3d755a[_0x8b189c(0x123)]||_0x3d755a[_0x8b189c(0x148)]||_0x8b189c(0x138)));}let _0x63ede9='PENDING';if(_0x3d755a[_0x8b189c(0x127)]===![]){if(_0x3d755a[_0x8b189c(0x13e)]){const _0x123ad6=new Date(_0x3d755a[_0x8b189c(0x13e)]),_0x49c291=new Date();_0x123ad6<_0x49c291?_0x63ede9=_0x8b189c(0x111):_0x63ede9=_0x8b189c(0x12f);}else _0x63ede9=_0x8b189c(0x12f);}else _0x63ede9=_0x8b189c(0x10a);return{'status':_0x63ede9,'amount':_0x3d755a[_0x8b189c(0x115)],'currency':_0x3d755a['currency'],'isActive':_0x3d755a['isActive']};}catch(_0x4de3f3){console[_0x8b189c(0x148)](_0x8b189c(0x110),_0x4de3f3),loggerService_1['loggerService'][_0x8b189c(0x14a)](_0x8b189c(0x163),_0x8b189c(0x106)+_0xcfcd37,_0x4de3f3);throw new Error(_0x8b189c(0x145)+(_0x4de3f3 instanceof Error?_0x4de3f3[_0x8b189c(0x123)]:'Unknown\x20error'));}}async[a43_0x3ccf7b(0xfd)](_0x25738a){const _0x1b3649=a43_0x3ccf7b;console['log'](_0x1b3649(0x116),_0x25738a);let _0x1383e2=_0x1b3649(0x10a);switch(_0x25738a['Status']?.['toLowerCase']()){case _0x1b3649(0x14e):case _0x1b3649(0x13b):case'paid':case _0x1b3649(0x10e):case _0x1b3649(0x12b):_0x25738a[_0x1b3649(0x118)]===_0x1b3649(0x112)?_0x1383e2='PAID':_0x1383e2=_0x1b3649(0x10a);break;case _0x1b3649(0x105):case _0x1b3649(0x16b):case'failed':case _0x1b3649(0x148):case _0x1b3649(0x117):_0x1383e2=_0x1b3649(0x12f);break;case _0x1b3649(0x11c):case _0x1b3649(0xf1):_0x1383e2=_0x1b3649(0x111);break;case'pending':case _0x1b3649(0x167):case _0x1b3649(0xfa):case'processing':case _0x1b3649(0x132):default:_0x1383e2='PENDING';break;}return{'paymentId':_0x25738a[_0x1b3649(0xf4)]||_0x25738a[_0x1b3649(0x165)],'status':_0x1383e2,'amount':_0x25738a[_0x1b3649(0x139)],'currency':_0x25738a[_0x1b3649(0x164)],'additionalInfo':{'method':_0x25738a['Method'],'bankId':_0x25738a[_0x1b3649(0x108)],'settled':_0x25738a[_0x1b3649(0x118)],'settlementDate':_0x25738a[_0x1b3649(0xfe)],'remitterName':_0x25738a['Remitter']?.[_0x1b3649(0x11e)],'remitterIban':_0x25738a[_0x1b3649(0x161)]?.[_0x1b3649(0x15f)],'bankTransactionId':_0x25738a['BankTransactionId']}};}[a43_0x3ccf7b(0x121)](_0xc0f2e9,_0x4e818f){const _0xf6e4e9=a43_0x3ccf7b;return console[_0xf6e4e9(0x162)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x4e818f,'paymentId':_0xc0f2e9[_0xf6e4e9(0x165)],'merchantPaymentId':_0xc0f2e9[_0xf6e4e9(0xf4)]}),!![];}}exports['NodaService']=NodaService;