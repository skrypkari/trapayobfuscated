'use strict';const a44_0x5c4855=a44_0x47e4;function a44_0x586f(){const _0x19ae4f=['/payment-links/','expiryDate','timeout','Currency','fromEntries','created','__esModule','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','defineProperty','../loggerService','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','processing','610RuYUqM','BankId','Response\x20data:','qrCodeLink','verifyWebhookSignature','https://tesoft.uk/gateway/pending.php?id=','127863TeiNHE','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Status','TesSoft\x20Payment\x20System/1.0','2015450Htcozv','error','https://tesoft.uk/gateway/noda/webhook/','now','logWhiteDomainResponse','Yes','log','Unknown\x20error\x20from\x20Noda\x20API','text','GET','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','EXPIRED','Noda\x20payment\x20verification\x20error:','913ablhZu','verifyPayment','URL:','116836CUrZnT','noda','Order\x20ID\x20Format:','Amount','HTTP\x20Status:','60vjBGTW','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','4606288KcLGxS','Unknown\x20error','processWebhook','amount','parse','Headers:','success','/payment-links','createPaymentLink','stringify','Processing\x20Noda\x20webhook:','Short\x20Link:','status','expired','HTTP\x20error!\x20status:\x20','SettlementDate','FAILED','in_progress','Failed\x20to\x20parse\x20JSON\x20response:','logWhiteDomainRequest','(8digits-8digits\x20format)','Error\x20stack:','application/json','headers','===\x20NODA\x20API\x20ERROR\x20===','https://tesoft.uk/gateway/noda/','QR\x20Code\x20Link:','15034965mTnHGH','486KxAXaC','HTTP\x20','Settled','toLowerCase','apiUrl','PAID','canceled','logWhiteDomainError','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20NODA\x20SERVICE\x20ERROR\x20===','Noda\x20API\x20error:\x20','Response\x20Time:','shortLinkUrls','PENDING','Iban','Parsed\x20Result:','49294GEaYUh','Remitter','cancelled','BankTransactionId','Not\x20provided','NodaService','toUpperCase','statusText','150rkzQYA','JSON\x20Parse\x20Error:\x20','POST','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Raw\x20Response\x20Body:','entries','currency','message','stack','Status\x20Text:','Noda\x20webhook\x20signature\x20verification:','MerchantPaymentId','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Request\x20Body\x20(Direct\x20JSON):','Error\x20Message:','Name','shortLink','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','done','paid','rejected','isActive','failed','statusCode','json','PaymentId','successful','loggerService',',\x20body:\x20','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:'];a44_0x586f=function(){return _0x19ae4f;};return a44_0x586f();}(function(_0xacea1f,_0x3320ce){const _0x486b1d=a44_0x47e4,_0x435f6d=_0xacea1f();while(!![]){try{const _0x892d9c=parseInt(_0x486b1d(0x133))/0x1*(-parseInt(_0x486b1d(0x11c))/0x2)+-parseInt(_0x486b1d(0x13b))/0x3*(parseInt(_0x486b1d(0x136))/0x4)+-parseInt(_0x486b1d(0x126))/0x5+-parseInt(_0x486b1d(0xda))/0x6*(-parseInt(_0x486b1d(0xea))/0x7)+-parseInt(_0x486b1d(0x13d))/0x8+-parseInt(_0x486b1d(0x122))/0x9*(-parseInt(_0x486b1d(0xf2))/0xa)+parseInt(_0x486b1d(0xd9))/0xb;if(_0x892d9c===_0x3320ce)break;else _0x435f6d['push'](_0x435f6d['shift']());}catch(_0x4de06a){_0x435f6d['push'](_0x435f6d['shift']());}}}(a44_0x586f,0x4b641));function a44_0x47e4(_0x34c399,_0x355f47){const _0x586ffb=a44_0x586f();return a44_0x47e4=function(_0x47e468,_0x5e599f){_0x47e468=_0x47e468-0xc3;let _0x41f91c=_0x586ffb[_0x47e468];return _0x41f91c;},a44_0x47e4(_0x34c399,_0x355f47);}Object[a44_0x5c4855(0x118)](exports,a44_0x5c4855(0x116),{'value':!![]}),exports[a44_0x5c4855(0xef)]=void 0x0;const loggerService_1=require(a44_0x5c4855(0x119));class NodaService{constructor(){const _0x4c9f84=a44_0x5c4855;this['apiUrl']=_0x4c9f84(0xd7),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a44_0x5c4855(0xc6)](_0x36e45b){const _0x3ae665=a44_0x5c4855,{orderId:_0x481184,name:_0x1fa74b,paymentDescription:_0x2ea022,amount:_0x28feb5,currency:_0x214838,webhookUrl:_0xbabbad,returnUrl:_0x12117c,expiryDate:_0x37a1e8}=_0x36e45b,_0x3db420=_0x214838[_0x3ae665(0xf0)](),_0x41482c=_0x3ae665(0x128),_0x5c6979=_0x3ae665(0x121)+_0x481184,_0x2dd281={'name':_0x1fa74b,'paymentDescription':_0x2ea022,'amount':_0x28feb5,'currency':_0x3db420,'paymentId':_0x481184,'webhookUrl':_0x41482c,'returnUrl':_0x5c6979};_0x37a1e8&&(_0x2dd281[_0x3ae665(0x111)]=_0x37a1e8);const _0x307bfa=Date['now']();try{console['log'](_0x3ae665(0x13c)),console[_0x3ae665(0x12c)](_0x3ae665(0x135),this[_0x3ae665(0xde)]),console[_0x3ae665(0x12c)](_0x3ae665(0xff),JSON[_0x3ae665(0xc7)](_0x2dd281,null,0x2)),console[_0x3ae665(0x12c)](_0x3ae665(0x138),_0x481184,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x3ae665(0x12c)](_0x3ae665(0x10f),_0x5c6979),loggerService_1[_0x3ae665(0x10d)]['logWhiteDomainRequest'](_0x3ae665(0x137),_0x3ae665(0xc5),_0x3ae665(0xf4),_0x2dd281);const _0x45f3a0=await fetch(this[_0x3ae665(0xde)],{'method':_0x3ae665(0xf4),'headers':{'Content-Type':_0x3ae665(0xd4),'Accept':_0x3ae665(0xd4),'User-Agent':_0x3ae665(0x125)},'body':JSON[_0x3ae665(0xc7)](_0x2dd281)}),_0xbd8aed=Date[_0x3ae665(0x129)]()-_0x307bfa;console[_0x3ae665(0x12c)](_0x3ae665(0x103)),console[_0x3ae665(0x12c)]('Status:',_0x45f3a0[_0x3ae665(0xca)]),console[_0x3ae665(0x12c)](_0x3ae665(0xfb),_0x45f3a0[_0x3ae665(0xf1)]),console[_0x3ae665(0x12c)](_0x3ae665(0xc3),Object[_0x3ae665(0x114)](_0x45f3a0[_0x3ae665(0xd5)][_0x3ae665(0xf7)]())),console['log'](_0x3ae665(0xe5),_0xbd8aed+'ms');const _0x59b07b=await _0x45f3a0[_0x3ae665(0x12e)]();console[_0x3ae665(0x12c)](_0x3ae665(0xf6),_0x59b07b);if(!_0x45f3a0['ok']){console[_0x3ae665(0x127)](_0x3ae665(0xd6)),console['error'](_0x3ae665(0x13a),_0x45f3a0[_0x3ae665(0xca)]),console[_0x3ae665(0x127)]('Response\x20Body:',_0x59b07b),loggerService_1['loggerService'][_0x3ae665(0x12a)](_0x3ae665(0x137),_0x3ae665(0xc5),_0x45f3a0['status'],_0x59b07b,_0xbd8aed),loggerService_1[_0x3ae665(0x10d)][_0x3ae665(0xe1)](_0x3ae665(0x137),_0x3ae665(0xc5),_0x3ae665(0xdb)+_0x45f3a0[_0x3ae665(0xca)]+':\x20'+_0x59b07b);if(_0x45f3a0[_0x3ae665(0xca)]===0x190)throw new Error(_0x3ae665(0xf5));else{if(_0x45f3a0['status']===0x1f4)throw new Error(_0x3ae665(0x11a));}throw new Error(_0x3ae665(0xcc)+_0x45f3a0['status']+_0x3ae665(0x10e)+_0x59b07b);}let _0x179350;try{_0x179350=JSON[_0x3ae665(0x141)](_0x59b07b);}catch(_0x4c2387){console[_0x3ae665(0x127)](_0x3ae665(0xd0),_0x4c2387),loggerService_1[_0x3ae665(0x10d)][_0x3ae665(0xe1)]('noda',_0x3ae665(0xc5),_0x3ae665(0xf3)+_0x4c2387);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x59b07b);}console[_0x3ae665(0x12c)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console['log'](_0x3ae665(0xe9),JSON[_0x3ae665(0xc7)](_0x179350,null,0x2)),loggerService_1[_0x3ae665(0x10d)][_0x3ae665(0x12a)]('noda',_0x3ae665(0xc5),_0x45f3a0[_0x3ae665(0xca)],_0x179350,_0xbd8aed);if(_0x179350[_0x3ae665(0x127)]||_0x179350[_0x3ae665(0x109)]){const _0x4d316c=_0x179350[_0x3ae665(0xf9)]||_0x179350[_0x3ae665(0x127)]||_0x3ae665(0x12d);console['error'](_0x3ae665(0x117)),console[_0x3ae665(0x127)](_0x3ae665(0x100),_0x4d316c),console['error']('Status\x20Code:',_0x179350['statusCode']),loggerService_1[_0x3ae665(0x10d)][_0x3ae665(0xe1)](_0x3ae665(0x137),_0x3ae665(0xc5),'Business\x20Error:\x20'+_0x4d316c);throw new Error(_0x3ae665(0xe4)+_0x4d316c);}if(!_0x179350['id']||!_0x179350[_0x3ae665(0xe6)]?.[_0x3ae665(0x102)]){console['error'](_0x3ae665(0xe2)),console[_0x3ae665(0x127)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x3ae665(0x127)](_0x3ae665(0x11e),_0x179350),loggerService_1['loggerService']['logWhiteDomainError'](_0x3ae665(0x137),_0x3ae665(0xc5),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x3ae665(0xfe));}return console[_0x3ae665(0x12c)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x3ae665(0x12c)]('Payment\x20Link\x20ID:',_0x179350['id']),console[_0x3ae665(0x12c)](_0x3ae665(0xc9),_0x179350[_0x3ae665(0xe6)][_0x3ae665(0x102)]),console[_0x3ae665(0x12c)](_0x3ae665(0xd8),_0x179350[_0x3ae665(0xe6)][_0x3ae665(0x11f)]||_0x3ae665(0xee)),console[_0x3ae665(0x12c)]('Order\x20ID\x20Used:',_0x481184,_0x3ae665(0xd2)),console[_0x3ae665(0x12c)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x5c6979),{'gateway_payment_id':_0x179350['id'],'payment_url':_0x179350[_0x3ae665(0xe6)][_0x3ae665(0x102)],'qr_code_url':_0x179350[_0x3ae665(0xe6)][_0x3ae665(0x11f)],'expiry_date':_0x179350[_0x3ae665(0x111)]};}catch(_0x4a79b4){console[_0x3ae665(0x127)](_0x3ae665(0xe3)),console[_0x3ae665(0x127)]('Error\x20details:',_0x4a79b4),loggerService_1[_0x3ae665(0x10d)]['logWhiteDomainError'](_0x3ae665(0x137),_0x3ae665(0xc5),_0x4a79b4);if(_0x4a79b4 instanceof Error){console[_0x3ae665(0x127)]('Error\x20message:',_0x4a79b4[_0x3ae665(0xf9)]),console['error'](_0x3ae665(0xd3),_0x4a79b4[_0x3ae665(0xfa)]);throw new Error(_0x3ae665(0x130)+_0x4a79b4[_0x3ae665(0xf9)]);}throw new Error(_0x3ae665(0x123));}}async[a44_0x5c4855(0x134)](_0x504f14){const _0x5cdbf0=a44_0x5c4855,_0x5db4c4=Date[_0x5cdbf0(0x129)]();try{loggerService_1['loggerService'][_0x5cdbf0(0xd1)](_0x5cdbf0(0x137),_0x5cdbf0(0x110)+_0x504f14,_0x5cdbf0(0x12f),{});const _0xbcdab7=await fetch(this[_0x5cdbf0(0xde)]+'/'+_0x504f14,{'method':'GET','headers':{'Content-Type':_0x5cdbf0(0xd4),'User-Agent':_0x5cdbf0(0x125)}}),_0x184696=Date[_0x5cdbf0(0x129)]()-_0x5db4c4;if(!_0xbcdab7['ok']){const _0x4ce42c=await _0xbcdab7[_0x5cdbf0(0x12e)]();loggerService_1[_0x5cdbf0(0x10d)]['logWhiteDomainResponse'](_0x5cdbf0(0x137),_0x5cdbf0(0x110)+_0x504f14,_0xbcdab7[_0x5cdbf0(0xca)],_0x4ce42c,_0x184696);throw new Error(_0x5cdbf0(0xcc)+_0xbcdab7[_0x5cdbf0(0xca)]);}const _0x44dafc=await _0xbcdab7[_0x5cdbf0(0x10a)]();loggerService_1['loggerService']['logWhiteDomainResponse']('noda','/payment-links/'+_0x504f14,_0xbcdab7['status'],_0x44dafc,_0x184696);if(_0x44dafc['error']||_0x44dafc[_0x5cdbf0(0x109)]){loggerService_1[_0x5cdbf0(0x10d)]['logWhiteDomainError'](_0x5cdbf0(0x137),'/payment-links/'+_0x504f14,'Noda\x20API\x20error:\x20'+(_0x44dafc[_0x5cdbf0(0xf9)]||_0x44dafc['error']||_0x5cdbf0(0x13e)));throw new Error(_0x5cdbf0(0xe4)+(_0x44dafc['message']||_0x44dafc['error']||_0x5cdbf0(0x13e)));}let _0x597c24=_0x5cdbf0(0xe7);if(_0x44dafc[_0x5cdbf0(0x107)]===![]){if(_0x44dafc['expiryDate']){const _0x359e1d=new Date(_0x44dafc['expiryDate']),_0x30a897=new Date();_0x359e1d<_0x30a897?_0x597c24=_0x5cdbf0(0x131):_0x597c24=_0x5cdbf0(0xce);}else _0x597c24=_0x5cdbf0(0xce);}else _0x597c24=_0x5cdbf0(0xe7);return{'status':_0x597c24,'amount':_0x44dafc[_0x5cdbf0(0x140)],'currency':_0x44dafc[_0x5cdbf0(0xf8)],'isActive':_0x44dafc[_0x5cdbf0(0x107)]};}catch(_0xd9e3ef){console['error'](_0x5cdbf0(0x132),_0xd9e3ef),loggerService_1['loggerService']['logWhiteDomainError'](_0x5cdbf0(0x137),_0x5cdbf0(0x110)+_0x504f14,_0xd9e3ef);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0xd9e3ef instanceof Error?_0xd9e3ef['message']:_0x5cdbf0(0x13e)));}}async[a44_0x5c4855(0x13f)](_0x473f8a){const _0x3ec819=a44_0x5c4855;console[_0x3ec819(0x12c)](_0x3ec819(0xc8),_0x473f8a);let _0x134103=_0x3ec819(0xe7);switch(_0x473f8a[_0x3ec819(0x124)]?.[_0x3ec819(0xdd)]()){case _0x3ec819(0x104):case'completed':case _0x3ec819(0x105):case _0x3ec819(0xc4):case _0x3ec819(0x10c):_0x473f8a[_0x3ec819(0xdc)]===_0x3ec819(0x12b)?_0x134103=_0x3ec819(0xdf):_0x134103=_0x3ec819(0xe7);break;case _0x3ec819(0xec):case _0x3ec819(0xe0):case _0x3ec819(0x108):case'error':case _0x3ec819(0x106):_0x134103=_0x3ec819(0xce);break;case _0x3ec819(0xcb):case _0x3ec819(0x112):_0x134103=_0x3ec819(0x131);break;case'pending':case _0x3ec819(0x115):case'active':case _0x3ec819(0x11b):case _0x3ec819(0xcf):default:_0x134103=_0x3ec819(0xe7);break;}return{'paymentId':_0x473f8a[_0x3ec819(0xfd)]||_0x473f8a[_0x3ec819(0x10b)],'status':_0x134103,'amount':_0x473f8a[_0x3ec819(0x139)],'currency':_0x473f8a[_0x3ec819(0x113)],'additionalInfo':{'method':_0x473f8a['Method'],'bankId':_0x473f8a[_0x3ec819(0x11d)],'settled':_0x473f8a[_0x3ec819(0xdc)],'settlementDate':_0x473f8a[_0x3ec819(0xcd)],'remitterName':_0x473f8a[_0x3ec819(0xeb)]?.[_0x3ec819(0x101)],'remitterIban':_0x473f8a['Remitter']?.[_0x3ec819(0xe8)],'bankTransactionId':_0x473f8a[_0x3ec819(0xed)]}};}[a44_0x5c4855(0x120)](_0x50fbc1,_0xb2bf85){const _0x3f56d0=a44_0x5c4855;return console[_0x3f56d0(0x12c)](_0x3f56d0(0xfc),{'receivedSignature':_0xb2bf85,'paymentId':_0x50fbc1['PaymentId'],'merchantPaymentId':_0x50fbc1[_0x3f56d0(0xfd)]}),!![];}}exports[a44_0x5c4855(0xef)]=NodaService;