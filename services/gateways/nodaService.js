'use strict';function a42_0x3f11(){const _0x4d3e2a=['isActive','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Missing\x20id\x20or\x20shortLink\x20in\x20response','Failed\x20to\x20verify\x20Noda\x20payment:\x20','createPaymentLink','Response\x20Time:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===',',\x20body:\x20','expiryDate','Response\x20data:','===\x20NODA\x20API\x20ERROR\x20===','/payment-links/','now','Error\x20stack:','(8digits-8digits\x20format)','text','qrCodeLink','Response\x20Body:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','3677532xVWpaC','entries','defineProperty','log','timeout','noda','headers','verifyPayment','Not\x20provided','in_progress','Unknown\x20error','Status:','2110257FebSKf','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','4174jCxLUp','2220cHpVIr','Method','created','stack','Raw\x20Response\x20Body:','expired','failed','loggerService','canceled','/payment-links','toLowerCase','../loggerService','TesSoft\x20Payment\x20System/1.0','QR\x20Code\x20Link:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','pending','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Status\x20Text:','14uxXDGs','Name','PENDING','13563XHbpFp','Processing\x20Noda\x20webhook:','Amount','Iban','Headers:','verifyWebhookSignature','apiUrl','statusText','active','Noda\x20API\x20error:\x20','SettlementDate','status','https://tesoft.uk/gateway/noda/','814272ysunuw','Payment\x20Link\x20ID:','amount','stringify','29NZJtQM','paid','rejected','BankTransactionId','error','POST','completed','NodaService','logWhiteDomainResponse','Noda\x20payment\x20verification\x20error:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','GET','Remitter','Currency','HTTP\x20error!\x20status:\x20','shortLink','(8digits-8digits\x20format\x20for\x20Noda)','__esModule','https://tesoft.uk/gateway/noda/webhook/','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','fromEntries','Settled','Parsed\x20Result:','message','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','2534624UKlhEu','Error\x20message:','logWhiteDomainRequest','logWhiteDomainError','EXPIRED','shortLinkUrls','4155GcfnCv','Request\x20Body\x20(Direct\x20JSON):','processing','currency','parse','Short\x20Link:','application/json','URL:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','FAILED','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','PaymentId','Error\x20details:','Failed\x20to\x20parse\x20JSON\x20response:','statusCode','done','Status','https://tesoft.uk/gateway/pending.php?id=','===\x20PARSED\x20NODA\x20RESPONSE\x20===','toUpperCase','10830KrZWvx','json','success','Business\x20Error:\x20'];a42_0x3f11=function(){return _0x4d3e2a;};return a42_0x3f11();}const a42_0x59dd6d=a42_0x1e3f;(function(_0x5601c3,_0xcae7f7){const _0x549656=a42_0x1e3f,_0x300073=_0x5601c3();while(!![]){try{const _0x2affe9=-parseInt(_0x549656(0x115))/0x1*(parseInt(_0x549656(0xee))/0x2)+-parseInt(_0x549656(0xe0))/0x3+parseInt(_0x549656(0xef))/0x4*(parseInt(_0x549656(0xb4))/0x5)+-parseInt(_0x549656(0x111))/0x6*(-parseInt(_0x549656(0x101))/0x7)+-parseInt(_0x549656(0xae))/0x8+parseInt(_0x549656(0xec))/0x9+-parseInt(_0x549656(0xc9))/0xa*(-parseInt(_0x549656(0x104))/0xb);if(_0x2affe9===_0xcae7f7)break;else _0x300073['push'](_0x300073['shift']());}catch(_0x4cbea9){_0x300073['push'](_0x300073['shift']());}}}(a42_0x3f11,0xaab6e));Object[a42_0x59dd6d(0xe2)](exports,a42_0x59dd6d(0xa6),{'value':!![]}),exports[a42_0x59dd6d(0x11c)]=void 0x0;const loggerService_1=require(a42_0x59dd6d(0xfa));function a42_0x1e3f(_0x918a54,_0x2dde1c){const _0x3f1189=a42_0x3f11();return a42_0x1e3f=function(_0x1e3f58,_0x538881){_0x1e3f58=_0x1e3f58-0x9e;let _0x3a7fef=_0x3f1189[_0x1e3f58];return _0x3a7fef;},a42_0x1e3f(_0x918a54,_0x2dde1c);}class NodaService{constructor(){const _0x20b7ba=a42_0x59dd6d;this[_0x20b7ba(0x10a)]=_0x20b7ba(0x110),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a42_0x59dd6d(0xd1)](_0x416aa7){const _0x2eade3=a42_0x59dd6d,{orderId:_0x2fc456,name:_0x49369f,paymentDescription:_0x43e634,amount:_0x5e5edd,currency:_0x37658e,webhookUrl:_0x1b906e,returnUrl:_0x32a2b7,expiryDate:_0x478036}=_0x416aa7,_0x3de176=_0x37658e[_0x2eade3(0xc8)](),_0x4b51f9=_0x2eade3(0xa7),_0x9bc42e=_0x2eade3(0xc6)+_0x2fc456,_0xbbd97e={'name':_0x49369f,'paymentDescription':_0x43e634,'amount':_0x5e5edd,'currency':_0x3de176,'paymentId':_0x2fc456,'webhookUrl':_0x4b51f9,'returnUrl':_0x9bc42e};_0x478036&&(_0xbbd97e[_0x2eade3(0xd5)]=_0x478036);const _0x35ddba=Date['now']();try{console[_0x2eade3(0xe3)](_0x2eade3(0xff)),console['log'](_0x2eade3(0xbb),this[_0x2eade3(0x10a)]),console['log'](_0x2eade3(0xb5),JSON['stringify'](_0xbbd97e,null,0x2)),console[_0x2eade3(0xe3)]('Order\x20ID\x20Format:',_0x2fc456,_0x2eade3(0xa5)),console[_0x2eade3(0xe3)](_0x2eade3(0xad),_0x9bc42e),loggerService_1[_0x2eade3(0xf6)][_0x2eade3(0xb0)](_0x2eade3(0xe5),'/payment-links','POST',_0xbbd97e);const _0x142a76=await fetch(this[_0x2eade3(0x10a)],{'method':_0x2eade3(0x11a),'headers':{'Content-Type':_0x2eade3(0xba),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x2eade3(0x114)](_0xbbd97e)}),_0x4ce739=Date[_0x2eade3(0xd9)]()-_0x35ddba;console[_0x2eade3(0xe3)](_0x2eade3(0xbe)),console[_0x2eade3(0xe3)](_0x2eade3(0xeb),_0x142a76[_0x2eade3(0x10f)]),console[_0x2eade3(0xe3)](_0x2eade3(0x100),_0x142a76[_0x2eade3(0x10b)]),console[_0x2eade3(0xe3)](_0x2eade3(0x108),Object[_0x2eade3(0xa9)](_0x142a76[_0x2eade3(0xe6)][_0x2eade3(0xe1)]())),console[_0x2eade3(0xe3)](_0x2eade3(0xd2),_0x4ce739+'ms');const _0x549452=await _0x142a76['text']();console[_0x2eade3(0xe3)](_0x2eade3(0xf3),_0x549452);if(!_0x142a76['ok']){console[_0x2eade3(0x119)](_0x2eade3(0xd7)),console[_0x2eade3(0x119)]('HTTP\x20Status:',_0x142a76['status']),console[_0x2eade3(0x119)](_0x2eade3(0xde),_0x549452),loggerService_1['loggerService']['logWhiteDomainResponse']('noda','/payment-links',_0x142a76[_0x2eade3(0x10f)],_0x549452,_0x4ce739),loggerService_1['loggerService'][_0x2eade3(0xb1)](_0x2eade3(0xe5),_0x2eade3(0xf8),'HTTP\x20'+_0x142a76['status']+':\x20'+_0x549452);if(_0x142a76[_0x2eade3(0x10f)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x142a76[_0x2eade3(0x10f)]===0x1f4)throw new Error(_0x2eade3(0xce));}throw new Error(_0x2eade3(0xa3)+_0x142a76['status']+_0x2eade3(0xd4)+_0x549452);}let _0x1e4f77;try{_0x1e4f77=JSON[_0x2eade3(0xb8)](_0x549452);}catch(_0x1a0514){console[_0x2eade3(0x119)](_0x2eade3(0xc2),_0x1a0514),loggerService_1[_0x2eade3(0xf6)]['logWhiteDomainError']('noda',_0x2eade3(0xf8),'JSON\x20Parse\x20Error:\x20'+_0x1a0514);throw new Error(_0x2eade3(0xbf)+_0x549452);}console[_0x2eade3(0xe3)](_0x2eade3(0xc7)),console[_0x2eade3(0xe3)](_0x2eade3(0xab),JSON[_0x2eade3(0x114)](_0x1e4f77,null,0x2)),loggerService_1[_0x2eade3(0xf6)][_0x2eade3(0x11d)](_0x2eade3(0xe5),_0x2eade3(0xf8),_0x142a76['status'],_0x1e4f77,_0x4ce739);if(_0x1e4f77[_0x2eade3(0x119)]||_0x1e4f77[_0x2eade3(0xc3)]){const _0x42ace9=_0x1e4f77[_0x2eade3(0xac)]||_0x1e4f77['error']||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x2eade3(0x119)](_0x2eade3(0xd3)),console['error']('Error\x20Message:',_0x42ace9),console[_0x2eade3(0x119)]('Status\x20Code:',_0x1e4f77[_0x2eade3(0xc3)]),loggerService_1['loggerService'][_0x2eade3(0xb1)]('noda',_0x2eade3(0xf8),_0x2eade3(0xcc)+_0x42ace9);throw new Error(_0x2eade3(0x10d)+_0x42ace9);}if(!_0x1e4f77['id']||!_0x1e4f77['shortLinkUrls']?.[_0x2eade3(0xa4)]){console[_0x2eade3(0x119)](_0x2eade3(0xbc)),console['error'](_0x2eade3(0xcf)),console[_0x2eade3(0x119)](_0x2eade3(0xd6),_0x1e4f77),loggerService_1[_0x2eade3(0xf6)]['logWhiteDomainError'](_0x2eade3(0xe5),_0x2eade3(0xf8),_0x2eade3(0xa8));throw new Error(_0x2eade3(0xfd));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console[_0x2eade3(0xe3)](_0x2eade3(0x112),_0x1e4f77['id']),console[_0x2eade3(0xe3)](_0x2eade3(0xb9),_0x1e4f77['shortLinkUrls']['shortLink']),console[_0x2eade3(0xe3)](_0x2eade3(0xfc),_0x1e4f77[_0x2eade3(0xb3)][_0x2eade3(0xdd)]||_0x2eade3(0xe8)),console['log']('Order\x20ID\x20Used:',_0x2fc456,_0x2eade3(0xdb)),console[_0x2eade3(0xe3)](_0x2eade3(0xdf),_0x9bc42e),{'gateway_payment_id':_0x1e4f77['id'],'payment_url':_0x1e4f77[_0x2eade3(0xb3)][_0x2eade3(0xa4)],'qr_code_url':_0x1e4f77[_0x2eade3(0xb3)]['qrCodeLink'],'expiry_date':_0x1e4f77['expiryDate']};}catch(_0x21b8ef){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x2eade3(0x119)](_0x2eade3(0xc1),_0x21b8ef),loggerService_1['loggerService'][_0x2eade3(0xb1)]('noda',_0x2eade3(0xf8),_0x21b8ef);if(_0x21b8ef instanceof Error){console[_0x2eade3(0x119)](_0x2eade3(0xaf),_0x21b8ef[_0x2eade3(0xac)]),console[_0x2eade3(0x119)](_0x2eade3(0xda),_0x21b8ef[_0x2eade3(0xf2)]);throw new Error(_0x2eade3(0xed)+_0x21b8ef[_0x2eade3(0xac)]);}throw new Error(_0x2eade3(0x9f));}}async[a42_0x59dd6d(0xe7)](_0x309330){const _0x3328e7=a42_0x59dd6d,_0x3690f4=Date[_0x3328e7(0xd9)]();try{loggerService_1[_0x3328e7(0xf6)][_0x3328e7(0xb0)](_0x3328e7(0xe5),'/payment-links/'+_0x309330,'GET',{});const _0x11a465=await fetch(this[_0x3328e7(0x10a)]+'/'+_0x309330,{'method':_0x3328e7(0xa0),'headers':{'Content-Type':_0x3328e7(0xba),'User-Agent':_0x3328e7(0xfb)}}),_0x23b1eb=Date[_0x3328e7(0xd9)]()-_0x3690f4;if(!_0x11a465['ok']){const _0x357c2f=await _0x11a465[_0x3328e7(0xdc)]();loggerService_1[_0x3328e7(0xf6)]['logWhiteDomainResponse']('noda',_0x3328e7(0xd8)+_0x309330,_0x11a465['status'],_0x357c2f,_0x23b1eb);throw new Error('HTTP\x20error!\x20status:\x20'+_0x11a465[_0x3328e7(0x10f)]);}const _0x954056=await _0x11a465[_0x3328e7(0xca)]();loggerService_1[_0x3328e7(0xf6)][_0x3328e7(0x11d)](_0x3328e7(0xe5),_0x3328e7(0xd8)+_0x309330,_0x11a465[_0x3328e7(0x10f)],_0x954056,_0x23b1eb);if(_0x954056['error']||_0x954056[_0x3328e7(0xc3)]){loggerService_1['loggerService'][_0x3328e7(0xb1)](_0x3328e7(0xe5),_0x3328e7(0xd8)+_0x309330,_0x3328e7(0x10d)+(_0x954056[_0x3328e7(0xac)]||_0x954056['error']||_0x3328e7(0xea)));throw new Error(_0x3328e7(0x10d)+(_0x954056['message']||_0x954056[_0x3328e7(0x119)]||'Unknown\x20error'));}let _0xd63c06=_0x3328e7(0x103);if(_0x954056[_0x3328e7(0xcd)]===![]){if(_0x954056[_0x3328e7(0xd5)]){const _0x21a530=new Date(_0x954056[_0x3328e7(0xd5)]),_0x249e15=new Date();_0x21a530<_0x249e15?_0xd63c06=_0x3328e7(0xb2):_0xd63c06=_0x3328e7(0xbd);}else _0xd63c06=_0x3328e7(0xbd);}else _0xd63c06=_0x3328e7(0x103);return{'status':_0xd63c06,'amount':_0x954056[_0x3328e7(0x113)],'currency':_0x954056[_0x3328e7(0xb7)],'isActive':_0x954056[_0x3328e7(0xcd)]};}catch(_0x38b62f){console[_0x3328e7(0x119)](_0x3328e7(0x9e),_0x38b62f),loggerService_1[_0x3328e7(0xf6)]['logWhiteDomainError']('noda',_0x3328e7(0xd8)+_0x309330,_0x38b62f);throw new Error(_0x3328e7(0xd0)+(_0x38b62f instanceof Error?_0x38b62f[_0x3328e7(0xac)]:_0x3328e7(0xea)));}}async['processWebhook'](_0x3b7d8c){const _0x56ef6a=a42_0x59dd6d;console[_0x56ef6a(0xe3)](_0x56ef6a(0x105),_0x3b7d8c);let _0x27cf9f=_0x56ef6a(0x103);switch(_0x3b7d8c[_0x56ef6a(0xc5)]?.[_0x56ef6a(0xf9)]()){case _0x56ef6a(0xc4):case _0x56ef6a(0x11b):case _0x56ef6a(0x116):case _0x56ef6a(0xcb):case'successful':_0x3b7d8c[_0x56ef6a(0xaa)]==='Yes'?_0x27cf9f='PAID':_0x27cf9f=_0x56ef6a(0x103);break;case'cancelled':case _0x56ef6a(0xf7):case _0x56ef6a(0xf5):case _0x56ef6a(0x119):case _0x56ef6a(0x117):_0x27cf9f='FAILED';break;case _0x56ef6a(0xf4):case _0x56ef6a(0xe4):_0x27cf9f='EXPIRED';break;case _0x56ef6a(0xfe):case _0x56ef6a(0xf1):case _0x56ef6a(0x10c):case _0x56ef6a(0xb6):case _0x56ef6a(0xe9):default:_0x27cf9f=_0x56ef6a(0x103);break;}return{'paymentId':_0x3b7d8c['MerchantPaymentId']||_0x3b7d8c[_0x56ef6a(0xc0)],'status':_0x27cf9f,'amount':_0x3b7d8c[_0x56ef6a(0x106)],'currency':_0x3b7d8c[_0x56ef6a(0xa2)],'additionalInfo':{'method':_0x3b7d8c[_0x56ef6a(0xf0)],'bankId':_0x3b7d8c['BankId'],'settled':_0x3b7d8c[_0x56ef6a(0xaa)],'settlementDate':_0x3b7d8c[_0x56ef6a(0x10e)],'remitterName':_0x3b7d8c[_0x56ef6a(0xa1)]?.[_0x56ef6a(0x102)],'remitterIban':_0x3b7d8c[_0x56ef6a(0xa1)]?.[_0x56ef6a(0x107)],'bankTransactionId':_0x3b7d8c[_0x56ef6a(0x118)]}};}[a42_0x59dd6d(0x109)](_0x46baed,_0x284eca){const _0x22bb43=a42_0x59dd6d;return console[_0x22bb43(0xe3)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x284eca,'paymentId':_0x46baed[_0x22bb43(0xc0)],'merchantPaymentId':_0x46baed['MerchantPaymentId']}),!![];}}exports[a42_0x59dd6d(0x11c)]=NodaService;