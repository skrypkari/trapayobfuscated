'use strict';const a53_0x250f9c=a53_0x12b5;(function(_0x137cb4,_0x1da9be){const _0xd2ba8=a53_0x12b5,_0x494add=_0x137cb4();while(!![]){try{const _0x16cf44=parseInt(_0xd2ba8(0x1bc))/0x1+parseInt(_0xd2ba8(0x165))/0x2*(parseInt(_0xd2ba8(0x1ab))/0x3)+-parseInt(_0xd2ba8(0x14f))/0x4+-parseInt(_0xd2ba8(0x16b))/0x5+-parseInt(_0xd2ba8(0x174))/0x6+parseInt(_0xd2ba8(0x170))/0x7*(parseInt(_0xd2ba8(0x194))/0x8)+parseInt(_0xd2ba8(0x158))/0x9;if(_0x16cf44===_0x1da9be)break;else _0x494add['push'](_0x494add['shift']());}catch(_0x930af4){_0x494add['push'](_0x494add['shift']());}}}(a53_0x3e64,0x902d9));function a53_0x12b5(_0x8fa4,_0xe1090){const _0x3e64b7=a53_0x3e64();return a53_0x12b5=function(_0x12b59a,_0x59c59f){_0x12b59a=_0x12b59a-0x14f;let _0xd45c85=_0x3e64b7[_0x12b59a];return _0xd45c85;},a53_0x12b5(_0x8fa4,_0xe1090);}Object[a53_0x250f9c(0x192)](exports,a53_0x250f9c(0x16d),{'value':!![]}),exports[a53_0x250f9c(0x191)]=void 0x0;function a53_0x3e64(){const _0x483975=['logWhiteDomainRequest','done','PAID','Response\x20Time:','completed','4739945GbTkch','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','__esModule','expired','Noda\x20API\x20error:\x20','3427837qCZbhm','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','SettlementDate','Method','1506822ZWeThd','in_progress','statusCode','Error\x20stack:','BankTransactionId','cancelled','BankId','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===',',\x20body:\x20','loggerService','active','Response\x20Body:','Headers:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','stringify','text','===\x20NODA\x20API\x20ERROR\x20===','Parsed\x20Result:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Remitter','Amount','PaymentId','(8digits-8digits\x20format\x20for\x20Noda)','EXPIRED','pending','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','https://tesoft.uk/gateway/pending.php?id=','Not\x20provided','/payment-links','NodaService','defineProperty','HTTP\x20Status:','8mnLDMx','status','Error\x20Message:','parse','Yes','verifyWebhookSignature','entries','created','statusText','expiryDate','Status','isActive','createPaymentLink','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','HTTP\x20','Error\x20message:','paid','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Failed\x20to\x20verify\x20Noda\x20payment:\x20','amount','timeout','(8digits-8digits\x20format)','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','3BodmgP','===\x20NODA\x20SERVICE\x20ERROR\x20===','log','../loggerService','Unknown\x20error','application/json','Error\x20details:','Name','Business\x20Error:\x20','QR\x20Code\x20Link:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Status:','error','logWhiteDomainResponse','qrCodeLink','processWebhook','POST','764634dLWlLS','shortLink','verifyPayment','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Iban','apiUrl','FAILED','===\x20PARSED\x20NODA\x20RESPONSE\x20===','GET','Missing\x20id\x20or\x20shortLink\x20in\x20response','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Raw\x20Response\x20Body:','Settled','4495304yYeNgt','noda','logWhiteDomainError','Payment\x20Link\x20ID:','currency','now','Response\x20data:','failed','message','8767377gsfkMI','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','toUpperCase','PENDING','MerchantPaymentId','Currency','successful','Payment\x20System/1.0','HTTP\x20error!\x20status:\x20','Request\x20Body\x20(Direct\x20JSON):','/payment-links/','shortLinkUrls','success','1370054jZvksl'];a53_0x3e64=function(){return _0x483975;};return a53_0x3e64();}const loggerService_1=require(a53_0x250f9c(0x1ae));class NodaService{constructor(){const _0x1a3f9f=a53_0x250f9c;this[_0x1a3f9f(0x1c1)]='https://tesoft.uk/gateway/noda/',console[_0x1a3f9f(0x1ad)](_0x1a3f9f(0x181));}async[a53_0x250f9c(0x1a0)](_0xe32a1a){const _0x189601=a53_0x250f9c,{orderId:_0x4a241c,name:_0x3ba005,paymentDescription:_0x981bdc,amount:_0x1f64a3,currency:_0xdc41be,webhookUrl:_0x5eb2e6,returnUrl:_0x5d8bed,expiryDate:_0x56c3a8}=_0xe32a1a,_0x489947=_0xdc41be[_0x189601(0x15a)](),_0x4ab9ee='https://tesoft.uk/gateway/noda/webhook/',_0x20210b=_0x189601(0x18e)+_0x4a241c,_0x9a42e1={'name':_0x3ba005,'paymentDescription':_0x981bdc,'amount':_0x1f64a3,'currency':_0x489947,'paymentId':_0x4a241c,'webhookUrl':_0x4ab9ee,'returnUrl':_0x20210b};_0x56c3a8&&(_0x9a42e1[_0x189601(0x19d)]=_0x56c3a8);const _0x42ef37=Date[_0x189601(0x154)]();try{console[_0x189601(0x1ad)](_0x189601(0x1bf)),console[_0x189601(0x1ad)]('URL:',this[_0x189601(0x1c1)]),console[_0x189601(0x1ad)](_0x189601(0x161),JSON[_0x189601(0x182)](_0x9a42e1,null,0x2)),console[_0x189601(0x1ad)]('Order\x20ID\x20Format:',_0x4a241c,_0x189601(0x18a)),console['log'](_0x189601(0x16c),_0x20210b),loggerService_1[_0x189601(0x17d)][_0x189601(0x166)]('noda',_0x189601(0x190),_0x189601(0x1bb),_0x9a42e1);const _0x2789c0=await fetch(this[_0x189601(0x1c1)],{'method':'POST','headers':{'Content-Type':_0x189601(0x1b0),'Accept':_0x189601(0x1b0),'User-Agent':_0x189601(0x15f)},'body':JSON[_0x189601(0x182)](_0x9a42e1)}),_0xdbb0a3=Date[_0x189601(0x154)]()-_0x42ef37;console[_0x189601(0x1ad)](_0x189601(0x1a5)),console[_0x189601(0x1ad)](_0x189601(0x1b6),_0x2789c0[_0x189601(0x195)]),console[_0x189601(0x1ad)]('Status\x20Text:',_0x2789c0[_0x189601(0x19c)]),console['log'](_0x189601(0x180),Object['fromEntries'](_0x2789c0['headers'][_0x189601(0x19a)]())),console[_0x189601(0x1ad)](_0x189601(0x169),_0xdbb0a3+'ms');const _0x1bd562=await _0x2789c0['text']();console[_0x189601(0x1ad)](_0x189601(0x1c7),_0x1bd562);if(!_0x2789c0['ok']){console[_0x189601(0x1b7)](_0x189601(0x184)),console[_0x189601(0x1b7)](_0x189601(0x193),_0x2789c0['status']),console[_0x189601(0x1b7)](_0x189601(0x17f),_0x1bd562),loggerService_1['loggerService'][_0x189601(0x1b8)](_0x189601(0x150),_0x189601(0x190),_0x2789c0['status'],_0x1bd562,_0xdbb0a3),loggerService_1[_0x189601(0x17d)]['logWhiteDomainError'](_0x189601(0x150),_0x189601(0x190),_0x189601(0x1a2)+_0x2789c0[_0x189601(0x195)]+':\x20'+_0x1bd562);if(_0x2789c0[_0x189601(0x195)]===0x190)throw new Error(_0x189601(0x171));else{if(_0x2789c0['status']===0x1f4)throw new Error(_0x189601(0x1aa));}throw new Error(_0x189601(0x160)+_0x2789c0[_0x189601(0x195)]+_0x189601(0x17c)+_0x1bd562);}let _0x1d8dae;try{_0x1d8dae=JSON[_0x189601(0x197)](_0x1bd562);}catch(_0x19018f){console[_0x189601(0x1b7)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x19018f),loggerService_1[_0x189601(0x17d)]['logWhiteDomainError'](_0x189601(0x150),_0x189601(0x190),'JSON\x20Parse\x20Error:\x20'+_0x19018f);throw new Error(_0x189601(0x1b5)+_0x1bd562);}console[_0x189601(0x1ad)](_0x189601(0x1c3)),console['log'](_0x189601(0x185),JSON[_0x189601(0x182)](_0x1d8dae,null,0x2)),loggerService_1[_0x189601(0x17d)][_0x189601(0x1b8)](_0x189601(0x150),'/payment-links',_0x2789c0['status'],_0x1d8dae,_0xdbb0a3);if(_0x1d8dae[_0x189601(0x1b7)]||_0x1d8dae['statusCode']){const _0x323498=_0x1d8dae[_0x189601(0x157)]||_0x1d8dae[_0x189601(0x1b7)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x189601(0x1b7)](_0x189601(0x1c6)),console[_0x189601(0x1b7)](_0x189601(0x196),_0x323498),console['error']('Status\x20Code:',_0x1d8dae[_0x189601(0x176)]),loggerService_1[_0x189601(0x17d)][_0x189601(0x151)](_0x189601(0x150),'/payment-links',_0x189601(0x1b3)+_0x323498);throw new Error(_0x189601(0x16f)+_0x323498);}if(!_0x1d8dae['id']||!_0x1d8dae[_0x189601(0x163)]?.[_0x189601(0x1bd)]){console[_0x189601(0x1b7)](_0x189601(0x17b)),console['error'](_0x189601(0x1c5)),console[_0x189601(0x1b7)](_0x189601(0x155),_0x1d8dae),loggerService_1['loggerService'][_0x189601(0x151)](_0x189601(0x150),_0x189601(0x190),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x189601(0x18d));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x189601(0x152),_0x1d8dae['id']),console[_0x189601(0x1ad)]('Short\x20Link:',_0x1d8dae[_0x189601(0x163)][_0x189601(0x1bd)]),console[_0x189601(0x1ad)](_0x189601(0x1b4),_0x1d8dae[_0x189601(0x163)][_0x189601(0x1b9)]||_0x189601(0x18f)),console[_0x189601(0x1ad)]('Order\x20ID\x20Used:',_0x4a241c,_0x189601(0x1a9)),console['log'](_0x189601(0x159),_0x20210b),{'gateway_payment_id':_0x1d8dae['id'],'payment_url':_0x1d8dae['shortLinkUrls'][_0x189601(0x1bd)],'qr_code_url':_0x1d8dae[_0x189601(0x163)]['qrCodeLink'],'expiry_date':_0x1d8dae[_0x189601(0x19d)]};}catch(_0x4df254){console[_0x189601(0x1b7)](_0x189601(0x1ac)),console[_0x189601(0x1b7)](_0x189601(0x1b1),_0x4df254),loggerService_1[_0x189601(0x17d)][_0x189601(0x151)]('noda',_0x189601(0x190),_0x4df254);if(_0x4df254 instanceof Error){console[_0x189601(0x1b7)](_0x189601(0x1a3),_0x4df254['message']),console[_0x189601(0x1b7)](_0x189601(0x177),_0x4df254['stack']);throw new Error(_0x189601(0x1a1)+_0x4df254[_0x189601(0x157)]);}throw new Error(_0x189601(0x186));}}async[a53_0x250f9c(0x1be)](_0x173e72){const _0x4f1871=a53_0x250f9c,_0x47bb38=Date[_0x4f1871(0x154)]();try{loggerService_1['loggerService'][_0x4f1871(0x166)]('noda','/payment-links/'+_0x173e72,_0x4f1871(0x1c4),{});const _0x16635e=await fetch(this[_0x4f1871(0x1c1)]+'/'+_0x173e72,{'method':_0x4f1871(0x1c4),'headers':{'Content-Type':_0x4f1871(0x1b0),'User-Agent':_0x4f1871(0x15f)}}),_0x1a44c7=Date[_0x4f1871(0x154)]()-_0x47bb38;if(!_0x16635e['ok']){const _0x1f9991=await _0x16635e[_0x4f1871(0x183)]();loggerService_1['loggerService'][_0x4f1871(0x1b8)](_0x4f1871(0x150),_0x4f1871(0x162)+_0x173e72,_0x16635e[_0x4f1871(0x195)],_0x1f9991,_0x1a44c7);throw new Error('HTTP\x20error!\x20status:\x20'+_0x16635e[_0x4f1871(0x195)]);}const _0x569fdd=await _0x16635e['json']();loggerService_1[_0x4f1871(0x17d)][_0x4f1871(0x1b8)](_0x4f1871(0x150),'/payment-links/'+_0x173e72,_0x16635e[_0x4f1871(0x195)],_0x569fdd,_0x1a44c7);if(_0x569fdd[_0x4f1871(0x1b7)]||_0x569fdd['statusCode']){loggerService_1[_0x4f1871(0x17d)][_0x4f1871(0x151)](_0x4f1871(0x150),_0x4f1871(0x162)+_0x173e72,_0x4f1871(0x16f)+(_0x569fdd[_0x4f1871(0x157)]||_0x569fdd[_0x4f1871(0x1b7)]||_0x4f1871(0x1af)));throw new Error(_0x4f1871(0x16f)+(_0x569fdd[_0x4f1871(0x157)]||_0x569fdd['error']||_0x4f1871(0x1af)));}let _0x123e83=_0x4f1871(0x15b);if(_0x569fdd['isActive']===![]){if(_0x569fdd['expiryDate']){const _0x4d9bcf=new Date(_0x569fdd[_0x4f1871(0x19d)]),_0x2e8208=new Date();_0x4d9bcf<_0x2e8208?_0x123e83=_0x4f1871(0x18b):_0x123e83='FAILED';}else _0x123e83=_0x4f1871(0x1c2);}else _0x123e83=_0x4f1871(0x15b);return{'status':_0x123e83,'amount':_0x569fdd[_0x4f1871(0x1a7)],'currency':_0x569fdd[_0x4f1871(0x153)],'isActive':_0x569fdd[_0x4f1871(0x19f)]};}catch(_0x45fc25){console[_0x4f1871(0x1b7)]('Noda\x20payment\x20verification\x20error:',_0x45fc25),loggerService_1[_0x4f1871(0x17d)][_0x4f1871(0x151)]('noda',_0x4f1871(0x162)+_0x173e72,_0x45fc25);throw new Error(_0x4f1871(0x1a6)+(_0x45fc25 instanceof Error?_0x45fc25[_0x4f1871(0x157)]:'Unknown\x20error'));}}async[a53_0x250f9c(0x1ba)](_0x4486e1){const _0x3ab5e6=a53_0x250f9c;console[_0x3ab5e6(0x1ad)]('Processing\x20Noda\x20webhook:',_0x4486e1);let _0x4bbd94=_0x3ab5e6(0x15b);switch(_0x4486e1[_0x3ab5e6(0x19e)]?.['toLowerCase']()){case _0x3ab5e6(0x167):case _0x3ab5e6(0x16a):case _0x3ab5e6(0x1a4):case _0x3ab5e6(0x164):case _0x3ab5e6(0x15e):_0x4486e1[_0x3ab5e6(0x1c8)]===_0x3ab5e6(0x198)?_0x4bbd94=_0x3ab5e6(0x168):_0x4bbd94='PENDING';break;case _0x3ab5e6(0x179):case'canceled':case _0x3ab5e6(0x156):case _0x3ab5e6(0x1b7):case'rejected':_0x4bbd94=_0x3ab5e6(0x1c2);break;case _0x3ab5e6(0x16e):case _0x3ab5e6(0x1a8):_0x4bbd94=_0x3ab5e6(0x18b);break;case _0x3ab5e6(0x18c):case _0x3ab5e6(0x19b):case _0x3ab5e6(0x17e):case'processing':case _0x3ab5e6(0x175):default:_0x4bbd94='PENDING';break;}return{'paymentId':_0x4486e1[_0x3ab5e6(0x15c)]||_0x4486e1['PaymentId'],'status':_0x4bbd94,'amount':_0x4486e1[_0x3ab5e6(0x188)],'currency':_0x4486e1[_0x3ab5e6(0x15d)],'additionalInfo':{'method':_0x4486e1[_0x3ab5e6(0x173)],'bankId':_0x4486e1[_0x3ab5e6(0x17a)],'settled':_0x4486e1['Settled'],'settlementDate':_0x4486e1[_0x3ab5e6(0x172)],'remitterName':_0x4486e1[_0x3ab5e6(0x187)]?.[_0x3ab5e6(0x1b2)],'remitterIban':_0x4486e1[_0x3ab5e6(0x187)]?.[_0x3ab5e6(0x1c0)],'bankTransactionId':_0x4486e1[_0x3ab5e6(0x178)]}};}[a53_0x250f9c(0x199)](_0x35ae12,_0xd965bd){const _0x5adeaa=a53_0x250f9c;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0xd965bd,'paymentId':_0x35ae12[_0x5adeaa(0x189)],'merchantPaymentId':_0x35ae12['MerchantPaymentId']}),!![];}}exports[a53_0x250f9c(0x191)]=NodaService;