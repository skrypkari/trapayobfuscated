'use strict';const a51_0x1e477d=a51_0x49d6;(function(_0x21f929,_0x4ea898){const _0x624f87=a51_0x49d6,_0x477496=_0x21f929();while(!![]){try{const _0xefe01e=-parseInt(_0x624f87(0x163))/0x1+-parseInt(_0x624f87(0x117))/0x2+parseInt(_0x624f87(0x119))/0x3*(-parseInt(_0x624f87(0x17d))/0x4)+-parseInt(_0x624f87(0x164))/0x5*(parseInt(_0x624f87(0x136))/0x6)+parseInt(_0x624f87(0x161))/0x7+parseInt(_0x624f87(0x152))/0x8+parseInt(_0x624f87(0x159))/0x9*(parseInt(_0x624f87(0x10b))/0xa);if(_0xefe01e===_0x4ea898)break;else _0x477496['push'](_0x477496['shift']());}catch(_0x198970){_0x477496['push'](_0x477496['shift']());}}}(a51_0x1822,0x9e0af));Object['defineProperty'](exports,a51_0x1e477d(0x176),{'value':!![]}),exports['NodaService']=void 0x0;function a51_0x49d6(_0xf85237,_0x53b15f){const _0x182233=a51_0x1822();return a51_0x49d6=function(_0x49d69b,_0xe7b3b2){_0x49d69b=_0x49d69b-0x10a;let _0x4da2e8=_0x182233[_0x49d69b];return _0x4da2e8;},a51_0x49d6(_0xf85237,_0x53b15f);}const loggerService_1=require(a51_0x1e477d(0x10f));function a51_0x1822(){const _0x579b8f=['POST','../loggerService','entries','shortLinkUrls','active','Noda\x20API\x20error:\x20','timeout','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','loggerService','38310Oxkovm','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','101601kMdJVh','Status','Parsed\x20Result:','Order\x20ID\x20Used:','statusCode','MerchantPaymentId','PAID','logWhiteDomainResponse','Processing\x20Noda\x20webhook:','currency','https://tesoft.uk/gateway/noda/webhook/','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','created','verifyWebhookSignature','Error\x20message:','HTTP\x20Status:','Error\x20Message:','isActive','HTTP\x20','application/json','toUpperCase','createPaymentLink','Currency','text','SettlementDate','stringify','paid','(8digits-8digits\x20format)','Response\x20Time:','114ZmgLVm','fromEntries','Name','===\x20NODA\x20API\x20ERROR\x20===','Amount','Error\x20stack:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','parse','Payment\x20System/1.0','Response\x20Body:','PENDING','Settled','statusText','expired','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','FAILED','processWebhook','Status\x20Code:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','successful','QR\x20Code\x20Link:','pending','logWhiteDomainRequest','message','cancelled','Iban','headers','Status\x20Text:','1315744MWeloh','done','rejected','===\x20NODA\x20SERVICE\x20ERROR\x20===','amount','json','now','9iWsrNC','Noda\x20payment\x20verification\x20error:','logWhiteDomainError','status','BankTransactionId','Response\x20data:','/payment-links','Missing\x20id\x20or\x20shortLink\x20in\x20response','2604868vkozHl','failed','823582qpLVSp','281570qVtchV','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','log','qrCodeLink','(8digits-8digits\x20format\x20for\x20Noda)','Status:','HTTP\x20error!\x20status:\x20','PaymentId','error','Not\x20provided','GET','NodaService','https://tesoft.uk/gateway/pending.php?id=','Short\x20Link:',',\x20body:\x20','shortLink','apiUrl','__esModule','noda','success','Failed\x20to\x20parse\x20JSON\x20response:','expiryDate','/payment-links/','EXPIRED','28DPGfzB','Unknown\x20error','22605230lSZEvV','Remitter','Failed\x20to\x20verify\x20Noda\x20payment:\x20'];a51_0x1822=function(){return _0x579b8f;};return a51_0x1822();}class NodaService{constructor(){const _0x3b83b3=a51_0x1e477d;this[_0x3b83b3(0x175)]='https://tesoft.uk/gateway/noda/',console['log'](_0x3b83b3(0x118));}async[a51_0x1e477d(0x12e)](_0x1a3bdb){const _0x49feb9=a51_0x1e477d,{orderId:_0x5862ba,name:_0x57f5d0,paymentDescription:_0x13f9b7,amount:_0xfe7698,currency:_0x3cf776,webhookUrl:_0x2b6e5f,returnUrl:_0x38a496,expiryDate:_0x11ebe3}=_0x1a3bdb,_0x37f562=_0x3cf776[_0x49feb9(0x12d)](),_0x54cc11=_0x49feb9(0x123),_0x1e585a=_0x49feb9(0x171)+_0x5862ba,_0x187b7a={'name':_0x57f5d0,'paymentDescription':_0x13f9b7,'amount':_0xfe7698,'currency':_0x37f562,'paymentId':_0x5862ba,'webhookUrl':_0x54cc11,'returnUrl':_0x1e585a};_0x11ebe3&&(_0x187b7a[_0x49feb9(0x17a)]=_0x11ebe3);const _0x2468af=Date[_0x49feb9(0x158)]();try{console[_0x49feb9(0x167)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console['log']('URL:',this['apiUrl']),console[_0x49feb9(0x167)]('Request\x20Body\x20(Direct\x20JSON):',JSON['stringify'](_0x187b7a,null,0x2)),console[_0x49feb9(0x167)]('Order\x20ID\x20Format:',_0x5862ba,_0x49feb9(0x169)),console[_0x49feb9(0x167)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x1e585a),loggerService_1[_0x49feb9(0x116)][_0x49feb9(0x14c)](_0x49feb9(0x177),'/payment-links',_0x49feb9(0x10e),_0x187b7a);const _0xdb853a=await fetch(this['apiUrl'],{'method':_0x49feb9(0x10e),'headers':{'Content-Type':_0x49feb9(0x12c),'Accept':_0x49feb9(0x12c),'User-Agent':_0x49feb9(0x13e)},'body':JSON[_0x49feb9(0x132)](_0x187b7a)}),_0x137ae8=Date[_0x49feb9(0x158)]()-_0x2468af;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x49feb9(0x167)](_0x49feb9(0x16a),_0xdb853a[_0x49feb9(0x15c)]),console[_0x49feb9(0x167)](_0x49feb9(0x151),_0xdb853a[_0x49feb9(0x142)]),console[_0x49feb9(0x167)]('Headers:',Object[_0x49feb9(0x137)](_0xdb853a[_0x49feb9(0x150)][_0x49feb9(0x110)]())),console['log'](_0x49feb9(0x135),_0x137ae8+'ms');const _0x1ac0cc=await _0xdb853a[_0x49feb9(0x130)]();console[_0x49feb9(0x167)]('Raw\x20Response\x20Body:',_0x1ac0cc);if(!_0xdb853a['ok']){console['error'](_0x49feb9(0x139)),console[_0x49feb9(0x16d)](_0x49feb9(0x128),_0xdb853a[_0x49feb9(0x15c)]),console[_0x49feb9(0x16d)](_0x49feb9(0x13f),_0x1ac0cc),loggerService_1[_0x49feb9(0x116)][_0x49feb9(0x120)](_0x49feb9(0x177),_0x49feb9(0x15f),_0xdb853a[_0x49feb9(0x15c)],_0x1ac0cc,_0x137ae8),loggerService_1['loggerService']['logWhiteDomainError']('noda','/payment-links',_0x49feb9(0x12b)+_0xdb853a[_0x49feb9(0x15c)]+':\x20'+_0x1ac0cc);if(_0xdb853a['status']===0x190)throw new Error(_0x49feb9(0x144));else{if(_0xdb853a[_0x49feb9(0x15c)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error('HTTP\x20error!\x20status:\x20'+_0xdb853a[_0x49feb9(0x15c)]+_0x49feb9(0x173)+_0x1ac0cc);}let _0x31118b;try{_0x31118b=JSON[_0x49feb9(0x13d)](_0x1ac0cc);}catch(_0xa59402){console['error'](_0x49feb9(0x179),_0xa59402),loggerService_1['loggerService']['logWhiteDomainError'](_0x49feb9(0x177),_0x49feb9(0x15f),'JSON\x20Parse\x20Error:\x20'+_0xa59402);throw new Error(_0x49feb9(0x13c)+_0x1ac0cc);}console['log']('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x49feb9(0x167)](_0x49feb9(0x11b),JSON[_0x49feb9(0x132)](_0x31118b,null,0x2)),loggerService_1[_0x49feb9(0x116)][_0x49feb9(0x120)](_0x49feb9(0x177),_0x49feb9(0x15f),_0xdb853a[_0x49feb9(0x15c)],_0x31118b,_0x137ae8);if(_0x31118b[_0x49feb9(0x16d)]||_0x31118b[_0x49feb9(0x11d)]){const _0xb5841d=_0x31118b[_0x49feb9(0x14d)]||_0x31118b[_0x49feb9(0x16d)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x49feb9(0x16d)](_0x49feb9(0x165)),console[_0x49feb9(0x16d)](_0x49feb9(0x129),_0xb5841d),console[_0x49feb9(0x16d)](_0x49feb9(0x147),_0x31118b[_0x49feb9(0x11d)]),loggerService_1[_0x49feb9(0x116)][_0x49feb9(0x15b)](_0x49feb9(0x177),_0x49feb9(0x15f),'Business\x20Error:\x20'+_0xb5841d);throw new Error(_0x49feb9(0x113)+_0xb5841d);}if(!_0x31118b['id']||!_0x31118b['shortLinkUrls']?.[_0x49feb9(0x174)]){console[_0x49feb9(0x16d)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x49feb9(0x16d)](_0x49feb9(0x160)),console[_0x49feb9(0x16d)](_0x49feb9(0x15e),_0x31118b),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x49feb9(0x15f),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x49feb9(0x115));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console[_0x49feb9(0x167)]('Payment\x20Link\x20ID:',_0x31118b['id']),console[_0x49feb9(0x167)](_0x49feb9(0x172),_0x31118b[_0x49feb9(0x111)][_0x49feb9(0x174)]),console[_0x49feb9(0x167)](_0x49feb9(0x14a),_0x31118b[_0x49feb9(0x111)]['qrCodeLink']||_0x49feb9(0x16e)),console[_0x49feb9(0x167)](_0x49feb9(0x11c),_0x5862ba,_0x49feb9(0x134)),console['log'](_0x49feb9(0x124),_0x1e585a),{'gateway_payment_id':_0x31118b['id'],'payment_url':_0x31118b[_0x49feb9(0x111)][_0x49feb9(0x174)],'qr_code_url':_0x31118b[_0x49feb9(0x111)][_0x49feb9(0x168)],'expiry_date':_0x31118b[_0x49feb9(0x17a)]};}catch(_0x498264){console[_0x49feb9(0x16d)](_0x49feb9(0x155)),console[_0x49feb9(0x16d)]('Error\x20details:',_0x498264),loggerService_1[_0x49feb9(0x116)]['logWhiteDomainError'](_0x49feb9(0x177),_0x49feb9(0x15f),_0x498264);if(_0x498264 instanceof Error){console[_0x49feb9(0x16d)](_0x49feb9(0x127),_0x498264['message']),console[_0x49feb9(0x16d)](_0x49feb9(0x13b),_0x498264['stack']);throw new Error(_0x49feb9(0x148)+_0x498264[_0x49feb9(0x14d)]);}throw new Error(_0x49feb9(0x166));}}async['verifyPayment'](_0x103848){const _0x142d3f=a51_0x1e477d,_0x440466=Date['now']();try{loggerService_1[_0x142d3f(0x116)][_0x142d3f(0x14c)](_0x142d3f(0x177),'/payment-links/'+_0x103848,_0x142d3f(0x16f),{});const _0x27d048=await fetch(this[_0x142d3f(0x175)]+'/'+_0x103848,{'method':_0x142d3f(0x16f),'headers':{'Content-Type':_0x142d3f(0x12c),'User-Agent':'Payment\x20System/1.0'}}),_0x1d3ea2=Date[_0x142d3f(0x158)]()-_0x440466;if(!_0x27d048['ok']){const _0x5321ad=await _0x27d048[_0x142d3f(0x130)]();loggerService_1['loggerService'][_0x142d3f(0x120)](_0x142d3f(0x177),_0x142d3f(0x17b)+_0x103848,_0x27d048['status'],_0x5321ad,_0x1d3ea2);throw new Error(_0x142d3f(0x16b)+_0x27d048[_0x142d3f(0x15c)]);}const _0x4bf05a=await _0x27d048[_0x142d3f(0x157)]();loggerService_1[_0x142d3f(0x116)][_0x142d3f(0x120)]('noda','/payment-links/'+_0x103848,_0x27d048['status'],_0x4bf05a,_0x1d3ea2);if(_0x4bf05a[_0x142d3f(0x16d)]||_0x4bf05a[_0x142d3f(0x11d)]){loggerService_1[_0x142d3f(0x116)][_0x142d3f(0x15b)]('noda',_0x142d3f(0x17b)+_0x103848,_0x142d3f(0x113)+(_0x4bf05a[_0x142d3f(0x14d)]||_0x4bf05a[_0x142d3f(0x16d)]||_0x142d3f(0x10a)));throw new Error(_0x142d3f(0x113)+(_0x4bf05a['message']||_0x4bf05a[_0x142d3f(0x16d)]||'Unknown\x20error'));}let _0x492f82=_0x142d3f(0x140);if(_0x4bf05a[_0x142d3f(0x12a)]===![]){if(_0x4bf05a[_0x142d3f(0x17a)]){const _0x4dc885=new Date(_0x4bf05a[_0x142d3f(0x17a)]),_0x18a3f7=new Date();_0x4dc885<_0x18a3f7?_0x492f82=_0x142d3f(0x17c):_0x492f82=_0x142d3f(0x145);}else _0x492f82='FAILED';}else _0x492f82='PENDING';return{'status':_0x492f82,'amount':_0x4bf05a[_0x142d3f(0x156)],'currency':_0x4bf05a[_0x142d3f(0x122)],'isActive':_0x4bf05a[_0x142d3f(0x12a)]};}catch(_0x10c9dc){console[_0x142d3f(0x16d)](_0x142d3f(0x15a),_0x10c9dc),loggerService_1[_0x142d3f(0x116)]['logWhiteDomainError'](_0x142d3f(0x177),_0x142d3f(0x17b)+_0x103848,_0x10c9dc);throw new Error(_0x142d3f(0x10d)+(_0x10c9dc instanceof Error?_0x10c9dc['message']:_0x142d3f(0x10a)));}}async[a51_0x1e477d(0x146)](_0x77c6b7){const _0x469f1a=a51_0x1e477d;console[_0x469f1a(0x167)](_0x469f1a(0x121),_0x77c6b7);let _0x42a490=_0x469f1a(0x140);switch(_0x77c6b7[_0x469f1a(0x11a)]?.['toLowerCase']()){case _0x469f1a(0x153):case'completed':case _0x469f1a(0x133):case _0x469f1a(0x178):case _0x469f1a(0x149):_0x77c6b7['Settled']==='Yes'?_0x42a490=_0x469f1a(0x11f):_0x42a490=_0x469f1a(0x140);break;case _0x469f1a(0x14e):case'canceled':case _0x469f1a(0x162):case _0x469f1a(0x16d):case _0x469f1a(0x154):_0x42a490=_0x469f1a(0x145);break;case _0x469f1a(0x143):case _0x469f1a(0x114):_0x42a490=_0x469f1a(0x17c);break;case _0x469f1a(0x14b):case _0x469f1a(0x125):case _0x469f1a(0x112):case'processing':case'in_progress':default:_0x42a490=_0x469f1a(0x140);break;}return{'paymentId':_0x77c6b7['MerchantPaymentId']||_0x77c6b7[_0x469f1a(0x16c)],'status':_0x42a490,'amount':_0x77c6b7[_0x469f1a(0x13a)],'currency':_0x77c6b7[_0x469f1a(0x12f)],'additionalInfo':{'method':_0x77c6b7['Method'],'bankId':_0x77c6b7['BankId'],'settled':_0x77c6b7[_0x469f1a(0x141)],'settlementDate':_0x77c6b7[_0x469f1a(0x131)],'remitterName':_0x77c6b7[_0x469f1a(0x10c)]?.[_0x469f1a(0x138)],'remitterIban':_0x77c6b7[_0x469f1a(0x10c)]?.[_0x469f1a(0x14f)],'bankTransactionId':_0x77c6b7[_0x469f1a(0x15d)]}};}[a51_0x1e477d(0x126)](_0x4794aa,_0x215197){const _0x5a9c73=a51_0x1e477d;return console[_0x5a9c73(0x167)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x215197,'paymentId':_0x4794aa['PaymentId'],'merchantPaymentId':_0x4794aa[_0x5a9c73(0x11e)]}),!![];}}exports[a51_0x1e477d(0x170)]=NodaService;