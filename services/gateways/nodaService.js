'use strict';const a43_0xcda7da=a43_0x5573;function a43_0x5573(_0x511a4d,_0x114c30){const _0x240fb5=a43_0x240f();return a43_0x5573=function(_0x557334,_0x1bb232){_0x557334=_0x557334-0x1cb;let _0x548d93=_0x240fb5[_0x557334];return _0x548d93;},a43_0x5573(_0x511a4d,_0x114c30);}(function(_0x49150,_0x27bbd9){const _0x2bfab5=a43_0x5573,_0x1180ad=_0x49150();while(!![]){try{const _0x579c92=parseInt(_0x2bfab5(0x1df))/0x1*(parseInt(_0x2bfab5(0x21c))/0x2)+parseInt(_0x2bfab5(0x1e4))/0x3+-parseInt(_0x2bfab5(0x223))/0x4*(-parseInt(_0x2bfab5(0x239))/0x5)+parseInt(_0x2bfab5(0x1cf))/0x6+parseInt(_0x2bfab5(0x231))/0x7*(-parseInt(_0x2bfab5(0x237))/0x8)+parseInt(_0x2bfab5(0x1da))/0x9*(-parseInt(_0x2bfab5(0x1f1))/0xa)+parseInt(_0x2bfab5(0x20a))/0xb;if(_0x579c92===_0x27bbd9)break;else _0x1180ad['push'](_0x1180ad['shift']());}catch(_0x279c30){_0x1180ad['push'](_0x1180ad['shift']());}}}(a43_0x240f,0x8ba9c));Object[a43_0xcda7da(0x23a)](exports,'__esModule',{'value':!![]}),exports[a43_0xcda7da(0x209)]=void 0x0;const loggerService_1=require('../loggerService');function a43_0x240f(){const _0x16ead8=['447952McVJPW','BankTransactionId','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','MerchantPaymentId','expiryDate','Error\x20Message:','===\x20NODA\x20SERVICE\x20ERROR\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','timeout','fromEntries','Business\x20Error:\x20','logWhiteDomainResponse','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Status','7yrGEJI','TesSoft\x20Payment\x20System/1.0','Noda\x20payment\x20verification\x20error:','createPaymentLink','log','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','5445392lkrKbi','Order\x20ID\x20Used:','5ZmVucm','defineProperty','created','isActive','Order\x20ID\x20Format:','now','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','application/json','===\x20NODA\x20SUCCESS\x20===','headers','URL:','Response\x20Body:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','completed','verifyPayment','5325564VNNAfV','loggerService','amount','Method','Request\x20Body\x20(Direct\x20JSON):','PENDING','cancelled','===\x20NODA\x20API\x20ERROR\x20===','Settled','Remitter','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','9yUTRIE','Short\x20Link:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status:','Unknown\x20error','24449JKypZH','https://tesoft.uk/gateway/noda/webhook/','===\x20PARSED\x20NODA\x20RESPONSE\x20===','entries','toLowerCase','1196148slZFMJ','verifyWebhookSignature','json','noda','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Noda\x20API\x20error:\x20','qrCodeLink','Unknown\x20error\x20from\x20Noda\x20API','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Headers:','currency','Noda\x20webhook\x20signature\x20verification:','JSON\x20Parse\x20Error:\x20','9574760ZvEMnC','HTTP\x20','Payment\x20Link\x20ID:','HTTP\x20Status:','status','Processing\x20Noda\x20webhook:','(8digits-8digits\x20format\x20for\x20Noda)','Currency','BankId','statusCode','HTTP\x20error!\x20status:\x20','apiUrl','logWhiteDomainError','processWebhook','success','processing','Error\x20message:','Missing\x20id\x20or\x20shortLink\x20in\x20response','successful','stringify','active','PAID','text','FAILED','NodaService','6510581oGotWA','expired','Not\x20provided','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','message','/payment-links','Raw\x20Response\x20Body:','Status\x20Code:','/payment-links/','PaymentId','SettlementDate','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Iban','logWhiteDomainRequest','toUpperCase','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Yes','Response\x20Time:','18bbkIju','rejected','error','canceled','failed','GET','shortLink'];a43_0x240f=function(){return _0x16ead8;};return a43_0x240f();}class NodaService{constructor(){const _0xd21c9e=a43_0xcda7da;this[_0xd21c9e(0x1fc)]='https://tesoft.uk/gateway/noda/',console[_0xd21c9e(0x235)](_0xd21c9e(0x20d));}async[a43_0xcda7da(0x234)](_0x245793){const _0x5844ac=a43_0xcda7da,{orderId:_0x59bbee,name:_0x3ef23f,paymentDescription:_0x2bb76b,amount:_0x380eeb,currency:_0xb63cac,webhookUrl:_0x4c52b5,returnUrl:_0x4f4711,expiryDate:_0x298183}=_0x245793,_0x166fa7=_0xb63cac[_0x5844ac(0x218)](),_0x3ebb90=_0x5844ac(0x1e0),_0xca0908='https://tesoft.uk/gateway/pending.php?id='+_0x59bbee,_0x167279={'name':_0x3ef23f,'paymentDescription':_0x2bb76b,'amount':_0x380eeb,'currency':_0x166fa7,'paymentId':_0x59bbee,'webhookUrl':_0x3ebb90,'returnUrl':_0xca0908};_0x298183&&(_0x167279['expiryDate']=_0x298183);const _0x2e3c62=Date['now']();try{console[_0x5844ac(0x235)](_0x5844ac(0x1ec)),console[_0x5844ac(0x235)](_0x5844ac(0x243),this[_0x5844ac(0x1fc)]),console[_0x5844ac(0x235)](_0x5844ac(0x1d3),JSON[_0x5844ac(0x204)](_0x167279,null,0x2)),console[_0x5844ac(0x235)](_0x5844ac(0x23d),_0x59bbee,_0x5844ac(0x1f7)),console[_0x5844ac(0x235)](_0x5844ac(0x1e8),_0xca0908),loggerService_1['loggerService'][_0x5844ac(0x217)]('noda',_0x5844ac(0x20f),'POST',_0x167279);const _0x4b42e5=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x5844ac(0x240),'Accept':_0x5844ac(0x240),'User-Agent':_0x5844ac(0x232)},'body':JSON[_0x5844ac(0x204)](_0x167279)}),_0x14f763=Date[_0x5844ac(0x23e)]()-_0x2e3c62;console[_0x5844ac(0x235)](_0x5844ac(0x219)),console['log'](_0x5844ac(0x1dd),_0x4b42e5[_0x5844ac(0x1f5)]),console[_0x5844ac(0x235)]('Status\x20Text:',_0x4b42e5['statusText']),console[_0x5844ac(0x235)](_0x5844ac(0x1ed),Object[_0x5844ac(0x22c)](_0x4b42e5[_0x5844ac(0x242)][_0x5844ac(0x1e2)]())),console['log'](_0x5844ac(0x21b),_0x14f763+'ms');const _0x40a929=await _0x4b42e5[_0x5844ac(0x207)]();console['log'](_0x5844ac(0x210),_0x40a929);if(!_0x4b42e5['ok']){console[_0x5844ac(0x21e)](_0x5844ac(0x1d6)),console[_0x5844ac(0x21e)](_0x5844ac(0x1f4),_0x4b42e5[_0x5844ac(0x1f5)]),console[_0x5844ac(0x21e)](_0x5844ac(0x1cb),_0x40a929),loggerService_1[_0x5844ac(0x1d0)][_0x5844ac(0x22e)](_0x5844ac(0x1e7),_0x5844ac(0x20f),_0x4b42e5[_0x5844ac(0x1f5)],_0x40a929,_0x14f763),loggerService_1[_0x5844ac(0x1d0)][_0x5844ac(0x1fd)](_0x5844ac(0x1e7),_0x5844ac(0x20f),_0x5844ac(0x1f2)+_0x4b42e5['status']+':\x20'+_0x40a929);if(_0x4b42e5[_0x5844ac(0x1f5)]===0x190)throw new Error(_0x5844ac(0x22f));else{if(_0x4b42e5[_0x5844ac(0x1f5)]===0x1f4)throw new Error(_0x5844ac(0x23f));}throw new Error(_0x5844ac(0x1fb)+_0x4b42e5['status']+',\x20body:\x20'+_0x40a929);}let _0x4fb2a7;try{_0x4fb2a7=JSON['parse'](_0x40a929);}catch(_0x1f3baf){console[_0x5844ac(0x21e)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x1f3baf),loggerService_1['loggerService']['logWhiteDomainError'](_0x5844ac(0x1e7),'/payment-links',_0x5844ac(0x1f0)+_0x1f3baf);throw new Error(_0x5844ac(0x215)+_0x40a929);}console[_0x5844ac(0x235)](_0x5844ac(0x1e1)),console['log']('Parsed\x20Result:',JSON[_0x5844ac(0x204)](_0x4fb2a7,null,0x2)),loggerService_1[_0x5844ac(0x1d0)][_0x5844ac(0x22e)]('noda',_0x5844ac(0x20f),_0x4b42e5[_0x5844ac(0x1f5)],_0x4fb2a7,_0x14f763);if(_0x4fb2a7[_0x5844ac(0x21e)]||_0x4fb2a7['statusCode']){const _0x2f0766=_0x4fb2a7['message']||_0x4fb2a7[_0x5844ac(0x21e)]||_0x5844ac(0x1eb);console[_0x5844ac(0x21e)](_0x5844ac(0x1d9)),console[_0x5844ac(0x21e)](_0x5844ac(0x228),_0x2f0766),console[_0x5844ac(0x21e)](_0x5844ac(0x211),_0x4fb2a7[_0x5844ac(0x1fa)]),loggerService_1[_0x5844ac(0x1d0)][_0x5844ac(0x1fd)](_0x5844ac(0x1e7),_0x5844ac(0x20f),_0x5844ac(0x22d)+_0x2f0766);throw new Error(_0x5844ac(0x1e9)+_0x2f0766);}if(!_0x4fb2a7['id']||!_0x4fb2a7['shortLinkUrls']?.['shortLink']){console[_0x5844ac(0x21e)](_0x5844ac(0x1dc)),console[_0x5844ac(0x21e)](_0x5844ac(0x202)),console[_0x5844ac(0x21e)]('Response\x20data:',_0x4fb2a7),loggerService_1['loggerService'][_0x5844ac(0x1fd)](_0x5844ac(0x1e7),_0x5844ac(0x20f),_0x5844ac(0x236));throw new Error(_0x5844ac(0x225));}return console[_0x5844ac(0x235)](_0x5844ac(0x241)),console[_0x5844ac(0x235)](_0x5844ac(0x1f3),_0x4fb2a7['id']),console[_0x5844ac(0x235)](_0x5844ac(0x1db),_0x4fb2a7['shortLinkUrls'][_0x5844ac(0x222)]),console['log']('QR\x20Code\x20Link:',_0x4fb2a7['shortLinkUrls']['qrCodeLink']||_0x5844ac(0x20c)),console[_0x5844ac(0x235)](_0x5844ac(0x238),_0x59bbee,'(8digits-8digits\x20format)'),console[_0x5844ac(0x235)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0xca0908),{'gateway_payment_id':_0x4fb2a7['id'],'payment_url':_0x4fb2a7['shortLinkUrls']['shortLink'],'qr_code_url':_0x4fb2a7['shortLinkUrls'][_0x5844ac(0x1ea)],'expiry_date':_0x4fb2a7['expiryDate']};}catch(_0x1d5857){console[_0x5844ac(0x21e)](_0x5844ac(0x229)),console[_0x5844ac(0x21e)]('Error\x20details:',_0x1d5857),loggerService_1['loggerService'][_0x5844ac(0x1fd)](_0x5844ac(0x1e7),_0x5844ac(0x20f),_0x1d5857);if(_0x1d5857 instanceof Error){console[_0x5844ac(0x21e)](_0x5844ac(0x201),_0x1d5857[_0x5844ac(0x20e)]),console['error']('Error\x20stack:',_0x1d5857['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x1d5857[_0x5844ac(0x20e)]);}throw new Error(_0x5844ac(0x22a));}}async[a43_0xcda7da(0x1ce)](_0x5a04c8){const _0x3fbaf1=a43_0xcda7da,_0x326b64=Date[_0x3fbaf1(0x23e)]();try{loggerService_1[_0x3fbaf1(0x1d0)][_0x3fbaf1(0x217)]('noda',_0x3fbaf1(0x212)+_0x5a04c8,_0x3fbaf1(0x221),{});const _0x1c180f=await fetch(this['apiUrl']+'/'+_0x5a04c8,{'method':'GET','headers':{'Content-Type':_0x3fbaf1(0x240),'User-Agent':_0x3fbaf1(0x232)}}),_0x532be4=Date[_0x3fbaf1(0x23e)]()-_0x326b64;if(!_0x1c180f['ok']){const _0x566d63=await _0x1c180f[_0x3fbaf1(0x207)]();loggerService_1[_0x3fbaf1(0x1d0)][_0x3fbaf1(0x22e)](_0x3fbaf1(0x1e7),'/payment-links/'+_0x5a04c8,_0x1c180f[_0x3fbaf1(0x1f5)],_0x566d63,_0x532be4);throw new Error(_0x3fbaf1(0x1fb)+_0x1c180f[_0x3fbaf1(0x1f5)]);}const _0x42b9df=await _0x1c180f[_0x3fbaf1(0x1e6)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3fbaf1(0x1e7),_0x3fbaf1(0x212)+_0x5a04c8,_0x1c180f['status'],_0x42b9df,_0x532be4);if(_0x42b9df[_0x3fbaf1(0x21e)]||_0x42b9df[_0x3fbaf1(0x1fa)]){loggerService_1[_0x3fbaf1(0x1d0)][_0x3fbaf1(0x1fd)](_0x3fbaf1(0x1e7),'/payment-links/'+_0x5a04c8,'Noda\x20API\x20error:\x20'+(_0x42b9df[_0x3fbaf1(0x20e)]||_0x42b9df[_0x3fbaf1(0x21e)]||'Unknown\x20error'));throw new Error(_0x3fbaf1(0x1e9)+(_0x42b9df[_0x3fbaf1(0x20e)]||_0x42b9df[_0x3fbaf1(0x21e)]||'Unknown\x20error'));}let _0x1f6f38=_0x3fbaf1(0x1d4);if(_0x42b9df[_0x3fbaf1(0x23c)]===![]){if(_0x42b9df[_0x3fbaf1(0x227)]){const _0x3ab44e=new Date(_0x42b9df['expiryDate']),_0x4b4f9d=new Date();_0x3ab44e<_0x4b4f9d?_0x1f6f38='EXPIRED':_0x1f6f38=_0x3fbaf1(0x208);}else _0x1f6f38=_0x3fbaf1(0x208);}else _0x1f6f38=_0x3fbaf1(0x1d4);return{'status':_0x1f6f38,'amount':_0x42b9df[_0x3fbaf1(0x1d1)],'currency':_0x42b9df[_0x3fbaf1(0x1ee)],'isActive':_0x42b9df['isActive']};}catch(_0x23b50b){console[_0x3fbaf1(0x21e)](_0x3fbaf1(0x233),_0x23b50b),loggerService_1[_0x3fbaf1(0x1d0)]['logWhiteDomainError']('noda',_0x3fbaf1(0x212)+_0x5a04c8,_0x23b50b);throw new Error(_0x3fbaf1(0x1cc)+(_0x23b50b instanceof Error?_0x23b50b[_0x3fbaf1(0x20e)]:_0x3fbaf1(0x1de)));}}async[a43_0xcda7da(0x1fe)](_0x374aa7){const _0x2f78bf=a43_0xcda7da;console[_0x2f78bf(0x235)](_0x2f78bf(0x1f6),_0x374aa7);let _0xc8121f=_0x2f78bf(0x1d4);switch(_0x374aa7[_0x2f78bf(0x230)]?.[_0x2f78bf(0x1e3)]()){case'done':case _0x2f78bf(0x1cd):case'paid':case _0x2f78bf(0x1ff):case _0x2f78bf(0x203):_0x374aa7[_0x2f78bf(0x1d7)]===_0x2f78bf(0x21a)?_0xc8121f=_0x2f78bf(0x206):_0xc8121f=_0x2f78bf(0x1d4);break;case _0x2f78bf(0x1d5):case _0x2f78bf(0x21f):case _0x2f78bf(0x220):case _0x2f78bf(0x21e):case _0x2f78bf(0x21d):_0xc8121f=_0x2f78bf(0x208);break;case _0x2f78bf(0x20b):case _0x2f78bf(0x22b):_0xc8121f='EXPIRED';break;case'pending':case _0x2f78bf(0x23b):case _0x2f78bf(0x205):case _0x2f78bf(0x200):case'in_progress':default:_0xc8121f='PENDING';break;}return{'paymentId':_0x374aa7[_0x2f78bf(0x226)]||_0x374aa7[_0x2f78bf(0x213)],'status':_0xc8121f,'amount':_0x374aa7['Amount'],'currency':_0x374aa7[_0x2f78bf(0x1f8)],'additionalInfo':{'method':_0x374aa7[_0x2f78bf(0x1d2)],'bankId':_0x374aa7[_0x2f78bf(0x1f9)],'settled':_0x374aa7[_0x2f78bf(0x1d7)],'settlementDate':_0x374aa7[_0x2f78bf(0x214)],'remitterName':_0x374aa7[_0x2f78bf(0x1d8)]?.['Name'],'remitterIban':_0x374aa7[_0x2f78bf(0x1d8)]?.[_0x2f78bf(0x216)],'bankTransactionId':_0x374aa7[_0x2f78bf(0x224)]}};}[a43_0xcda7da(0x1e5)](_0x189d49,_0xbfcfd8){const _0x4f86e4=a43_0xcda7da;return console[_0x4f86e4(0x235)](_0x4f86e4(0x1ef),{'receivedSignature':_0xbfcfd8,'paymentId':_0x189d49[_0x4f86e4(0x213)],'merchantPaymentId':_0x189d49['MerchantPaymentId']}),!![];}}exports[a43_0xcda7da(0x209)]=NodaService;