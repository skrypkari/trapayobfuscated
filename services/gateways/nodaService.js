'use strict';function a43_0x172a(_0x427ec1,_0xc6e448){const _0x36ef9e=a43_0x36ef();return a43_0x172a=function(_0x172a8e,_0x3fdac2){_0x172a8e=_0x172a8e-0x8f;let _0x1bb427=_0x36ef9e[_0x172a8e];return _0x1bb427;},a43_0x172a(_0x427ec1,_0xc6e448);}const a43_0x51232f=a43_0x172a;function a43_0x36ef(){const _0x33cf2b=['../loggerService','created','JSON\x20Parse\x20Error:\x20','Payment\x20Link\x20ID:','Noda\x20webhook\x20signature\x20verification:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','HTTP\x20error!\x20status:\x20','Failed\x20to\x20verify\x20Noda\x20payment:\x20','738616REGPxQ','Headers:','Raw\x20Response\x20Body:','currency','in_progress','toUpperCase','amount','66316dADWiq','logWhiteDomainError','error','shortLinkUrls','isActive',',\x20body:\x20','Business\x20Error:\x20','noda','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Status\x20Text:','Noda\x20API\x20error:\x20','NodaService','Name','entries','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','success','expired','processing','===\x20NODA\x20SERVICE\x20ERROR\x20===','verifyPayment','===\x20NODA\x20SUCCESS\x20===','rejected','shortLink','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','completed','TesSoft\x20Payment\x20System/1.0','defineProperty','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','/payment-links/','BankId','===\x20NODA\x20API\x20ERROR\x20===','Error\x20Message:','__esModule','Error\x20message:','FAILED','stringify','Order\x20ID\x20Used:','URL:','loggerService','5020992BUDtXo','3xUxatQ','Missing\x20id\x20or\x20shortLink\x20in\x20response','logWhiteDomainResponse','statusText','HTTP\x20','POST','MerchantPaymentId','apiUrl','GET','EXPIRED','608314TimVZP','Remitter','json','/payment-links','14142kTxteS','Method','Response\x20Body:','1863496PrEZZr','qrCodeLink','(8digits-8digits\x20format\x20for\x20Noda)','timeout','Currency','Amount','failed','expiryDate','1008140OEesdz','PENDING','logWhiteDomainRequest','Not\x20provided','log','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','status','Status\x20Code:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Request\x20Body\x20(Direct\x20JSON):','Status:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','(8digits-8digits\x20format)','Status','statusCode','message','Yes','fromEntries','413SwVEhQ','application/json','https://tesoft.uk/gateway/pending.php?id=','PAID','Error\x20details:','processWebhook','Iban','Parsed\x20Result:','now','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','toLowerCase','Settled','pending','Unknown\x20error','createPaymentLink','paid','BankTransactionId','https://tesoft.uk/gateway/noda/','successful','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','headers','stack','https://tesoft.uk/gateway/noda/webhook/','PaymentId','canceled','active'];a43_0x36ef=function(){return _0x33cf2b;};return a43_0x36ef();}(function(_0x2ae3ce,_0x3db34e){const _0x2a7deb=a43_0x172a,_0x4a12d2=_0x2ae3ce();while(!![]){try{const _0x11b237=-parseInt(_0x2a7deb(0xc8))/0x1+parseInt(_0x2a7deb(0xfc))/0x2*(parseInt(_0x2a7deb(0xf2))/0x3)+parseInt(_0x2a7deb(0xc1))/0x4+parseInt(_0x2a7deb(0x10b))/0x5+-parseInt(_0x2a7deb(0x100))/0x6*(parseInt(_0x2a7deb(0x9f))/0x7)+parseInt(_0x2a7deb(0x103))/0x8+-parseInt(_0x2a7deb(0xf1))/0x9;if(_0x11b237===_0x3db34e)break;else _0x4a12d2['push'](_0x4a12d2['shift']());}catch(_0x36cc10){_0x4a12d2['push'](_0x4a12d2['shift']());}}}(a43_0x36ef,0x2716d));Object[a43_0x51232f(0xe3)](exports,a43_0x51232f(0xea),{'value':!![]}),exports[a43_0x51232f(0xd3)]=void 0x0;const loggerService_1=require(a43_0x51232f(0xb9));class NodaService{constructor(){const _0x84ae55=a43_0x51232f;this[_0x84ae55(0xf9)]=_0x84ae55(0xb0),console['log'](_0x84ae55(0x92));}async[a43_0x51232f(0xad)](_0x1642b6){const _0x4421fc=a43_0x51232f,{orderId:_0x492ece,name:_0x85c63,paymentDescription:_0x245423,amount:_0x50e1cf,currency:_0x52a36c,webhookUrl:_0x3ddf14,returnUrl:_0xf47934,expiryDate:_0x1ad205}=_0x1642b6,_0x4ff264=_0x52a36c[_0x4421fc(0xc6)](),_0x222074=_0x4421fc(0xb5),_0xc84fbc=_0x4421fc(0xa1)+_0x492ece,_0x2486ba={'name':_0x85c63,'paymentDescription':_0x245423,'amount':_0x50e1cf,'currency':_0x4ff264,'paymentId':_0x492ece,'webhookUrl':_0x222074,'returnUrl':_0xc84fbc};_0x1ad205&&(_0x2486ba[_0x4421fc(0x10a)]=_0x1ad205);const _0x1ddd46=Date['now']();try{console[_0x4421fc(0x91)](_0x4421fc(0xe5)),console[_0x4421fc(0x91)](_0x4421fc(0xef),this['apiUrl']),console[_0x4421fc(0x91)](_0x4421fc(0x96),JSON[_0x4421fc(0xed)](_0x2486ba,null,0x2)),console['log']('Order\x20ID\x20Format:',_0x492ece,_0x4421fc(0x105)),console['log'](_0x4421fc(0xd6),_0xc84fbc),loggerService_1[_0x4421fc(0xf0)]['logWhiteDomainRequest']('noda',_0x4421fc(0xff),_0x4421fc(0xf7),_0x2486ba);const _0x4b5dc9=await fetch(this[_0x4421fc(0xf9)],{'method':_0x4421fc(0xf7),'headers':{'Content-Type':_0x4421fc(0xa0),'Accept':_0x4421fc(0xa0),'User-Agent':_0x4421fc(0xe2)},'body':JSON[_0x4421fc(0xed)](_0x2486ba)}),_0x20dde0=Date[_0x4421fc(0xa7)]()-_0x1ddd46;console[_0x4421fc(0x91)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x4421fc(0x91)](_0x4421fc(0x97),_0x4b5dc9[_0x4421fc(0x93)]),console[_0x4421fc(0x91)](_0x4421fc(0xd1),_0x4b5dc9[_0x4421fc(0xf5)]),console[_0x4421fc(0x91)](_0x4421fc(0xc2),Object[_0x4421fc(0x9e)](_0x4b5dc9[_0x4421fc(0xb3)][_0x4421fc(0xd5)]())),console['log']('Response\x20Time:',_0x20dde0+'ms');const _0x56f483=await _0x4b5dc9['text']();console[_0x4421fc(0x91)](_0x4421fc(0xc3),_0x56f483);if(!_0x4b5dc9['ok']){console[_0x4421fc(0xca)](_0x4421fc(0xe8)),console['error']('HTTP\x20Status:',_0x4b5dc9['status']),console[_0x4421fc(0xca)](_0x4421fc(0x102),_0x56f483),loggerService_1[_0x4421fc(0xf0)][_0x4421fc(0xf4)](_0x4421fc(0xcf),'/payment-links',_0x4b5dc9[_0x4421fc(0x93)],_0x56f483,_0x20dde0),loggerService_1[_0x4421fc(0xf0)][_0x4421fc(0xc9)]('noda',_0x4421fc(0xff),_0x4421fc(0xf6)+_0x4b5dc9['status']+':\x20'+_0x56f483);if(_0x4b5dc9[_0x4421fc(0x93)]===0x190)throw new Error(_0x4421fc(0xe4));else{if(_0x4b5dc9[_0x4421fc(0x93)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x4421fc(0xbf)+_0x4b5dc9[_0x4421fc(0x93)]+_0x4421fc(0xcd)+_0x56f483);}let _0x2829a8;try{_0x2829a8=JSON['parse'](_0x56f483);}catch(_0x36af7b){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x36af7b),loggerService_1[_0x4421fc(0xf0)][_0x4421fc(0xc9)](_0x4421fc(0xcf),_0x4421fc(0xff),_0x4421fc(0xbb)+_0x36af7b);throw new Error(_0x4421fc(0xd0)+_0x56f483);}console['log']('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x4421fc(0x91)](_0x4421fc(0xa6),JSON[_0x4421fc(0xed)](_0x2829a8,null,0x2)),loggerService_1[_0x4421fc(0xf0)][_0x4421fc(0xf4)](_0x4421fc(0xcf),_0x4421fc(0xff),_0x4b5dc9['status'],_0x2829a8,_0x20dde0);if(_0x2829a8[_0x4421fc(0xca)]||_0x2829a8[_0x4421fc(0x9b)]){const _0xbcd757=_0x2829a8[_0x4421fc(0x9c)]||_0x2829a8[_0x4421fc(0xca)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x4421fc(0xca)](_0x4421fc(0xe0)),console[_0x4421fc(0xca)](_0x4421fc(0xe9),_0xbcd757),console[_0x4421fc(0xca)](_0x4421fc(0x94),_0x2829a8[_0x4421fc(0x9b)]),loggerService_1[_0x4421fc(0xf0)][_0x4421fc(0xc9)]('noda',_0x4421fc(0xff),_0x4421fc(0xce)+_0xbcd757);throw new Error('Noda\x20API\x20error:\x20'+_0xbcd757);}if(!_0x2829a8['id']||!_0x2829a8['shortLinkUrls']?.['shortLink']){console['error'](_0x4421fc(0xa8)),console[_0x4421fc(0xca)](_0x4421fc(0xf3)),console['error']('Response\x20data:',_0x2829a8),loggerService_1[_0x4421fc(0xf0)][_0x4421fc(0xc9)](_0x4421fc(0xcf),'/payment-links',_0x4421fc(0xdf));throw new Error(_0x4421fc(0xb2));}return console[_0x4421fc(0x91)](_0x4421fc(0xdc)),console[_0x4421fc(0x91)](_0x4421fc(0xbc),_0x2829a8['id']),console[_0x4421fc(0x91)]('Short\x20Link:',_0x2829a8[_0x4421fc(0xcb)][_0x4421fc(0xde)]),console['log']('QR\x20Code\x20Link:',_0x2829a8['shortLinkUrls']['qrCodeLink']||_0x4421fc(0x90)),console['log'](_0x4421fc(0xee),_0x492ece,_0x4421fc(0x99)),console[_0x4421fc(0x91)](_0x4421fc(0x95),_0xc84fbc),{'gateway_payment_id':_0x2829a8['id'],'payment_url':_0x2829a8[_0x4421fc(0xcb)]['shortLink'],'qr_code_url':_0x2829a8[_0x4421fc(0xcb)][_0x4421fc(0x104)],'expiry_date':_0x2829a8[_0x4421fc(0x10a)]};}catch(_0x5af338){console[_0x4421fc(0xca)](_0x4421fc(0xda)),console[_0x4421fc(0xca)](_0x4421fc(0xa3),_0x5af338),loggerService_1['loggerService'][_0x4421fc(0xc9)]('noda','/payment-links',_0x5af338);if(_0x5af338 instanceof Error){console['error'](_0x4421fc(0xeb),_0x5af338[_0x4421fc(0x9c)]),console['error']('Error\x20stack:',_0x5af338[_0x4421fc(0xb4)]);throw new Error(_0x4421fc(0x98)+_0x5af338[_0x4421fc(0x9c)]);}throw new Error(_0x4421fc(0xbe));}}async[a43_0x51232f(0xdb)](_0x26b399){const _0x25127f=a43_0x51232f,_0xb6440b=Date['now']();try{loggerService_1['loggerService'][_0x25127f(0x8f)]('noda',_0x25127f(0xe6)+_0x26b399,_0x25127f(0xfa),{});const _0x39fade=await fetch(this[_0x25127f(0xf9)]+'/'+_0x26b399,{'method':_0x25127f(0xfa),'headers':{'Content-Type':_0x25127f(0xa0),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x482839=Date[_0x25127f(0xa7)]()-_0xb6440b;if(!_0x39fade['ok']){const _0x480af4=await _0x39fade['text']();loggerService_1[_0x25127f(0xf0)][_0x25127f(0xf4)]('noda',_0x25127f(0xe6)+_0x26b399,_0x39fade[_0x25127f(0x93)],_0x480af4,_0x482839);throw new Error('HTTP\x20error!\x20status:\x20'+_0x39fade[_0x25127f(0x93)]);}const _0x4e832d=await _0x39fade[_0x25127f(0xfe)]();loggerService_1[_0x25127f(0xf0)][_0x25127f(0xf4)](_0x25127f(0xcf),_0x25127f(0xe6)+_0x26b399,_0x39fade[_0x25127f(0x93)],_0x4e832d,_0x482839);if(_0x4e832d['error']||_0x4e832d[_0x25127f(0x9b)]){loggerService_1[_0x25127f(0xf0)][_0x25127f(0xc9)]('noda','/payment-links/'+_0x26b399,_0x25127f(0xd2)+(_0x4e832d[_0x25127f(0x9c)]||_0x4e832d[_0x25127f(0xca)]||_0x25127f(0xac)));throw new Error(_0x25127f(0xd2)+(_0x4e832d[_0x25127f(0x9c)]||_0x4e832d[_0x25127f(0xca)]||'Unknown\x20error'));}let _0x236333=_0x25127f(0x10c);if(_0x4e832d['isActive']===![]){if(_0x4e832d[_0x25127f(0x10a)]){const _0x65c266=new Date(_0x4e832d[_0x25127f(0x10a)]),_0x116372=new Date();_0x65c266<_0x116372?_0x236333=_0x25127f(0xfb):_0x236333=_0x25127f(0xec);}else _0x236333=_0x25127f(0xec);}else _0x236333=_0x25127f(0x10c);return{'status':_0x236333,'amount':_0x4e832d[_0x25127f(0xc7)],'currency':_0x4e832d[_0x25127f(0xc4)],'isActive':_0x4e832d[_0x25127f(0xcc)]};}catch(_0x41713e){console[_0x25127f(0xca)]('Noda\x20payment\x20verification\x20error:',_0x41713e),loggerService_1[_0x25127f(0xf0)][_0x25127f(0xc9)]('noda','/payment-links/'+_0x26b399,_0x41713e);throw new Error(_0x25127f(0xc0)+(_0x41713e instanceof Error?_0x41713e[_0x25127f(0x9c)]:_0x25127f(0xac)));}}async[a43_0x51232f(0xa4)](_0x5c182b){const _0x54d874=a43_0x51232f;console['log']('Processing\x20Noda\x20webhook:',_0x5c182b);let _0x1a8e91='PENDING';switch(_0x5c182b[_0x54d874(0x9a)]?.[_0x54d874(0xa9)]()){case'done':case _0x54d874(0xe1):case _0x54d874(0xae):case _0x54d874(0xd7):case _0x54d874(0xb1):_0x5c182b[_0x54d874(0xaa)]===_0x54d874(0x9d)?_0x1a8e91=_0x54d874(0xa2):_0x1a8e91=_0x54d874(0x10c);break;case'cancelled':case _0x54d874(0xb7):case _0x54d874(0x109):case'error':case _0x54d874(0xdd):_0x1a8e91=_0x54d874(0xec);break;case _0x54d874(0xd8):case _0x54d874(0x106):_0x1a8e91=_0x54d874(0xfb);break;case _0x54d874(0xab):case _0x54d874(0xba):case _0x54d874(0xb8):case _0x54d874(0xd9):case _0x54d874(0xc5):default:_0x1a8e91=_0x54d874(0x10c);break;}return{'paymentId':_0x5c182b[_0x54d874(0xf8)]||_0x5c182b[_0x54d874(0xb6)],'status':_0x1a8e91,'amount':_0x5c182b[_0x54d874(0x108)],'currency':_0x5c182b[_0x54d874(0x107)],'additionalInfo':{'method':_0x5c182b[_0x54d874(0x101)],'bankId':_0x5c182b[_0x54d874(0xe7)],'settled':_0x5c182b['Settled'],'settlementDate':_0x5c182b['SettlementDate'],'remitterName':_0x5c182b['Remitter']?.[_0x54d874(0xd4)],'remitterIban':_0x5c182b[_0x54d874(0xfd)]?.[_0x54d874(0xa5)],'bankTransactionId':_0x5c182b[_0x54d874(0xaf)]}};}['verifyWebhookSignature'](_0x2cd1bc,_0xfc0c3d){const _0x2b3637=a43_0x51232f;return console[_0x2b3637(0x91)](_0x2b3637(0xbd),{'receivedSignature':_0xfc0c3d,'paymentId':_0x2cd1bc[_0x2b3637(0xb6)],'merchantPaymentId':_0x2cd1bc[_0x2b3637(0xf8)]}),!![];}}exports['NodaService']=NodaService;