'use strict';const a60_0x10ee39=a60_0x53fe;(function(_0x46c54c,_0x4f127f){const _0x3c10a2=a60_0x53fe,_0x33132a=_0x46c54c();while(!![]){try{const _0x943243=parseInt(_0x3c10a2(0x1e0))/0x1+parseInt(_0x3c10a2(0x1ce))/0x2*(parseInt(_0x3c10a2(0x1fc))/0x3)+parseInt(_0x3c10a2(0x1d5))/0x4*(-parseInt(_0x3c10a2(0x1f8))/0x5)+parseInt(_0x3c10a2(0x1e7))/0x6+-parseInt(_0x3c10a2(0x1c0))/0x7*(parseInt(_0x3c10a2(0x1c2))/0x8)+-parseInt(_0x3c10a2(0x1d2))/0x9+parseInt(_0x3c10a2(0x1de))/0xa*(parseInt(_0x3c10a2(0x1c4))/0xb);if(_0x943243===_0x4f127f)break;else _0x33132a['push'](_0x33132a['shift']());}catch(_0xc103fd){_0x33132a['push'](_0x33132a['shift']());}}}(a60_0xd3a0,0xdaa23));function a60_0x53fe(_0x4a2b79,_0x3194fb){_0x4a2b79=_0x4a2b79-0x1bc;const _0xd3a0a7=a60_0xd3a0();let _0x53fec6=_0xd3a0a7[_0x4a2b79];return _0x53fec6;}Object[a60_0x10ee39(0x21f)](exports,a60_0x10ee39(0x207),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a60_0x10ee39(0x201));class NodaService{constructor(){const _0x3a7721=a60_0x10ee39;this[_0x3a7721(0x1cb)]=_0x3a7721(0x1db),console[_0x3a7721(0x1fb)](_0x3a7721(0x231));}async['createPaymentLink'](_0x3e3f1e){const _0x54e6c1=a60_0x10ee39,{orderId:_0x4204ca,name:_0x2ac776,paymentDescription:_0x595199,amount:_0x4014c0,currency:_0x35656a,webhookUrl:_0x98e95c,returnUrl:_0x33c29b,expiryDate:_0x2fe840}=_0x3e3f1e,_0x1b43c0=_0x35656a['toUpperCase'](),_0x26d797=_0x54e6c1(0x1f3),_0x598b2a=_0x54e6c1(0x1d8)+_0x4204ca,_0x386da6={'name':_0x2ac776,'paymentDescription':_0x595199,'amount':_0x4014c0,'currency':_0x1b43c0,'paymentId':_0x4204ca,'webhookUrl':_0x26d797,'returnUrl':_0x598b2a};_0x2fe840&&(_0x386da6[_0x54e6c1(0x235)]=_0x2fe840);const _0x5a6e1c=Date[_0x54e6c1(0x205)]();try{console['log'](_0x54e6c1(0x1d3)),console[_0x54e6c1(0x1fb)](_0x54e6c1(0x1c3),this[_0x54e6c1(0x1cb)]),console[_0x54e6c1(0x1fb)](_0x54e6c1(0x211),JSON['stringify'](_0x386da6,null,0x2)),console[_0x54e6c1(0x1fb)]('Order\x20ID\x20Format:',_0x4204ca,_0x54e6c1(0x1f0)),console[_0x54e6c1(0x1fb)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x598b2a),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x54e6c1(0x22f),_0x54e6c1(0x233),_0x54e6c1(0x1be),_0x386da6);const _0x588ceb=await fetch(this[_0x54e6c1(0x1cb)],{'method':_0x54e6c1(0x1be),'headers':{'Content-Type':_0x54e6c1(0x21d),'Accept':_0x54e6c1(0x21d),'User-Agent':_0x54e6c1(0x219)},'body':JSON[_0x54e6c1(0x1bd)](_0x386da6)}),_0x48e971=Date['now']()-_0x5a6e1c;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x54e6c1(0x230),_0x588ceb[_0x54e6c1(0x218)]),console[_0x54e6c1(0x1fb)](_0x54e6c1(0x1d7),_0x588ceb[_0x54e6c1(0x1fe)]),console[_0x54e6c1(0x1fb)](_0x54e6c1(0x22b),Object[_0x54e6c1(0x1cd)](_0x588ceb[_0x54e6c1(0x22e)][_0x54e6c1(0x1e2)]())),console[_0x54e6c1(0x1fb)](_0x54e6c1(0x1e8),_0x48e971+'ms');const _0x2d80c6=await _0x588ceb[_0x54e6c1(0x1fa)]();console['log'](_0x54e6c1(0x21b),_0x2d80c6);if(!_0x588ceb['ok']){console[_0x54e6c1(0x1dc)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x54e6c1(0x1dc)](_0x54e6c1(0x1ee),_0x588ceb[_0x54e6c1(0x218)]),console[_0x54e6c1(0x1dc)]('Response\x20Body:',_0x2d80c6),loggerService_1[_0x54e6c1(0x203)]['logWhiteDomainResponse'](_0x54e6c1(0x22f),_0x54e6c1(0x233),_0x588ceb[_0x54e6c1(0x218)],_0x2d80c6,_0x48e971),loggerService_1[_0x54e6c1(0x203)]['logWhiteDomainError'](_0x54e6c1(0x22f),_0x54e6c1(0x233),_0x54e6c1(0x1d1)+_0x588ceb[_0x54e6c1(0x218)]+':\x20'+_0x2d80c6);if(_0x588ceb[_0x54e6c1(0x218)]===0x190)throw new Error(_0x54e6c1(0x206));else{if(_0x588ceb[_0x54e6c1(0x218)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x54e6c1(0x20c)+_0x588ceb[_0x54e6c1(0x218)]+_0x54e6c1(0x1c7)+_0x2d80c6);}let _0x57de62;try{_0x57de62=JSON[_0x54e6c1(0x232)](_0x2d80c6);}catch(_0x968458){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x968458),loggerService_1['loggerService'][_0x54e6c1(0x1f2)](_0x54e6c1(0x22f),_0x54e6c1(0x233),_0x54e6c1(0x208)+_0x968458);throw new Error(_0x54e6c1(0x1e5)+_0x2d80c6);}console[_0x54e6c1(0x1fb)](_0x54e6c1(0x1f4)),console[_0x54e6c1(0x1fb)](_0x54e6c1(0x1da),JSON['stringify'](_0x57de62,null,0x2)),loggerService_1['loggerService'][_0x54e6c1(0x1e1)](_0x54e6c1(0x22f),_0x54e6c1(0x233),_0x588ceb[_0x54e6c1(0x218)],_0x57de62,_0x48e971);if(_0x57de62[_0x54e6c1(0x1dc)]||_0x57de62[_0x54e6c1(0x1c9)]){const _0x386338=_0x57de62[_0x54e6c1(0x209)]||_0x57de62[_0x54e6c1(0x1dc)]||'Unknown\x20error\x20from\x20Noda\x20API';console['error'](_0x54e6c1(0x202)),console[_0x54e6c1(0x1dc)](_0x54e6c1(0x1f5),_0x386338),console[_0x54e6c1(0x1dc)](_0x54e6c1(0x1ec),_0x57de62[_0x54e6c1(0x1c9)]),loggerService_1[_0x54e6c1(0x203)][_0x54e6c1(0x1f2)](_0x54e6c1(0x22f),'/payment-links',_0x54e6c1(0x200)+_0x386338);throw new Error(_0x54e6c1(0x20f)+_0x386338);}if(!_0x57de62['id']||!_0x57de62[_0x54e6c1(0x212)]?.[_0x54e6c1(0x1d0)]){console[_0x54e6c1(0x1dc)](_0x54e6c1(0x20e)),console[_0x54e6c1(0x1dc)](_0x54e6c1(0x1bf)),console[_0x54e6c1(0x1dc)]('Response\x20data:',_0x57de62),loggerService_1[_0x54e6c1(0x203)][_0x54e6c1(0x1f2)]('noda','/payment-links',_0x54e6c1(0x1d6));throw new Error(_0x54e6c1(0x1ca));}return console[_0x54e6c1(0x1fb)](_0x54e6c1(0x20d)),console[_0x54e6c1(0x1fb)](_0x54e6c1(0x214),_0x57de62['id']),console['log'](_0x54e6c1(0x1c5),_0x57de62[_0x54e6c1(0x212)]['shortLink']),console['log'](_0x54e6c1(0x1f1),_0x57de62[_0x54e6c1(0x212)]['qrCodeLink']||_0x54e6c1(0x1e6)),console['log']('Order\x20ID\x20Used:',_0x4204ca,'(8digits-8digits\x20format)'),console[_0x54e6c1(0x1fb)](_0x54e6c1(0x227),_0x598b2a),{'gateway_payment_id':_0x57de62['id'],'payment_url':_0x57de62[_0x54e6c1(0x212)][_0x54e6c1(0x1d0)],'qr_code_url':_0x57de62[_0x54e6c1(0x212)]['qrCodeLink'],'expiry_date':_0x57de62[_0x54e6c1(0x235)]};}catch(_0x2cf49d){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console['error'](_0x54e6c1(0x1df),_0x2cf49d),loggerService_1[_0x54e6c1(0x203)][_0x54e6c1(0x1f2)]('noda',_0x54e6c1(0x233),_0x2cf49d);if(_0x2cf49d instanceof Error){console['error']('Error\x20message:',_0x2cf49d[_0x54e6c1(0x209)]),console[_0x54e6c1(0x1dc)]('Error\x20stack:',_0x2cf49d[_0x54e6c1(0x221)]);throw new Error(_0x54e6c1(0x220)+_0x2cf49d[_0x54e6c1(0x209)]);}throw new Error(_0x54e6c1(0x1f7));}}async[a60_0x10ee39(0x234)](_0x2c59ce){const _0x6fce98=a60_0x10ee39,_0x3de242=Date[_0x6fce98(0x205)]();try{loggerService_1[_0x6fce98(0x203)]['logWhiteDomainRequest'](_0x6fce98(0x22f),'/payment-links/'+_0x2c59ce,'GET',{});const _0x3b2d54=await fetch(this['apiUrl']+'/'+_0x2c59ce,{'method':_0x6fce98(0x1f9),'headers':{'Content-Type':'application/json','User-Agent':'Payment\x20System/1.0'}}),_0x36b04d=Date['now']()-_0x3de242;if(!_0x3b2d54['ok']){const _0x3fe6f7=await _0x3b2d54[_0x6fce98(0x1fa)]();loggerService_1[_0x6fce98(0x203)][_0x6fce98(0x1e1)](_0x6fce98(0x22f),_0x6fce98(0x1d9)+_0x2c59ce,_0x3b2d54[_0x6fce98(0x218)],_0x3fe6f7,_0x36b04d);throw new Error(_0x6fce98(0x20c)+_0x3b2d54[_0x6fce98(0x218)]);}const _0x230dff=await _0x3b2d54[_0x6fce98(0x215)]();loggerService_1[_0x6fce98(0x203)][_0x6fce98(0x1e1)](_0x6fce98(0x22f),_0x6fce98(0x1d9)+_0x2c59ce,_0x3b2d54[_0x6fce98(0x218)],_0x230dff,_0x36b04d);if(_0x230dff[_0x6fce98(0x1dc)]||_0x230dff['statusCode']){loggerService_1[_0x6fce98(0x203)][_0x6fce98(0x1f2)](_0x6fce98(0x22f),_0x6fce98(0x1d9)+_0x2c59ce,_0x6fce98(0x20f)+(_0x230dff[_0x6fce98(0x209)]||_0x230dff[_0x6fce98(0x1dc)]||'Unknown\x20error'));throw new Error(_0x6fce98(0x20f)+(_0x230dff[_0x6fce98(0x209)]||_0x230dff['error']||_0x6fce98(0x1e4)));}let _0x3a6b58=_0x6fce98(0x204);if(_0x230dff[_0x6fce98(0x20b)]===![]){if(_0x230dff[_0x6fce98(0x235)]){const _0x5462ec=new Date(_0x230dff[_0x6fce98(0x235)]),_0x3de317=new Date();_0x5462ec<_0x3de317?_0x3a6b58=_0x6fce98(0x1eb):_0x3a6b58=_0x6fce98(0x1f6);}else _0x3a6b58=_0x6fce98(0x1f6);}else _0x3a6b58='PENDING';return{'status':_0x3a6b58,'amount':_0x230dff[_0x6fce98(0x1c1)],'currency':_0x230dff[_0x6fce98(0x20a)],'isActive':_0x230dff[_0x6fce98(0x20b)]};}catch(_0x3584c2){console['error'](_0x6fce98(0x1c8),_0x3584c2),loggerService_1['loggerService']['logWhiteDomainError'](_0x6fce98(0x22f),'/payment-links/'+_0x2c59ce,_0x3584c2);throw new Error(_0x6fce98(0x1cc)+(_0x3584c2 instanceof Error?_0x3584c2['message']:_0x6fce98(0x1e4)));}}async[a60_0x10ee39(0x1e9)](_0xb18759){const _0x465b95=a60_0x10ee39;console[_0x465b95(0x1fb)](_0x465b95(0x1d4),_0xb18759);let _0x16a2dd=_0x465b95(0x204);switch(_0xb18759[_0x465b95(0x1c6)]?.[_0x465b95(0x1ef)]()){case _0x465b95(0x217):case'completed':case _0x465b95(0x226):case _0x465b95(0x223):case _0x465b95(0x216):_0xb18759[_0x465b95(0x1cf)]==='Yes'?_0x16a2dd=_0x465b95(0x225):_0x16a2dd=_0x465b95(0x204);break;case'cancelled':case'canceled':case _0x465b95(0x228):case _0x465b95(0x1dc):case _0x465b95(0x1e3):_0x16a2dd=_0x465b95(0x1f6);break;case _0x465b95(0x1ed):case _0x465b95(0x210):_0x16a2dd=_0x465b95(0x1eb);break;case'pending':case _0x465b95(0x21a):case _0x465b95(0x22d):case _0x465b95(0x22c):case _0x465b95(0x22a):default:_0x16a2dd=_0x465b95(0x204);break;}return{'paymentId':_0xb18759[_0x465b95(0x1dd)]||_0xb18759[_0x465b95(0x1bc)],'status':_0x16a2dd,'amount':_0xb18759['Amount'],'currency':_0xb18759[_0x465b95(0x1ea)],'additionalInfo':{'method':_0xb18759['Method'],'bankId':_0xb18759['BankId'],'settled':_0xb18759[_0x465b95(0x1cf)],'settlementDate':_0xb18759[_0x465b95(0x21c)],'remitterName':_0xb18759[_0x465b95(0x1ff)]?.[_0x465b95(0x224)],'remitterIban':_0xb18759[_0x465b95(0x1ff)]?.[_0x465b95(0x222)],'bankTransactionId':_0xb18759[_0x465b95(0x1fd)]}};}[a60_0x10ee39(0x213)](_0x1cb47f,_0x2d135d){const _0x54ae6f=a60_0x10ee39;return console[_0x54ae6f(0x1fb)](_0x54ae6f(0x21e),{'receivedSignature':_0x2d135d,'paymentId':_0x1cb47f[_0x54ae6f(0x1bc)],'merchantPaymentId':_0x1cb47f['MerchantPaymentId']}),!![];}}exports[a60_0x10ee39(0x229)]=NodaService;function a60_0xd3a0(){const _0x5585be=['URL:','16133381oZewxq','Short\x20Link:','Status',',\x20body:\x20','Noda\x20payment\x20verification\x20error:','statusCode','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','apiUrl','Failed\x20to\x20verify\x20Noda\x20payment:\x20','fromEntries','3604ncCgxB','Settled','shortLink','HTTP\x20','12435489QLbUqO','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Processing\x20Noda\x20webhook:','24pVQaDz','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Status\x20Text:','https://tesoft.uk/gateway/pending.php?id=','/payment-links/','Parsed\x20Result:','https://tesoft.uk/gateway/noda/','error','MerchantPaymentId','10xFwnKP','Error\x20details:','869642iZOjuX','logWhiteDomainResponse','entries','rejected','Unknown\x20error','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Not\x20provided','2337132XFygsz','Response\x20Time:','processWebhook','Currency','EXPIRED','Status\x20Code:','expired','HTTP\x20Status:','toLowerCase','(8digits-8digits\x20format\x20for\x20Noda)','QR\x20Code\x20Link:','logWhiteDomainError','https://tesoft.uk/gateway/noda/webhook/','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Error\x20Message:','FAILED','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','1436165azQwMh','GET','text','log','2676WKiOCf','BankTransactionId','statusText','Remitter','Business\x20Error:\x20','../loggerService','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','loggerService','PENDING','now','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','__esModule','JSON\x20Parse\x20Error:\x20','message','currency','isActive','HTTP\x20error!\x20status:\x20','===\x20NODA\x20SUCCESS\x20===','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Noda\x20API\x20error:\x20','timeout','Request\x20Body\x20(Direct\x20JSON):','shortLinkUrls','verifyWebhookSignature','Payment\x20Link\x20ID:','json','successful','done','status','Payment\x20System/1.0','created','Raw\x20Response\x20Body:','SettlementDate','application/json','Noda\x20webhook\x20signature\x20verification:','defineProperty','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','stack','Iban','success','Name','PAID','paid','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','failed','NodaService','in_progress','Headers:','processing','active','headers','noda','Status:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','parse','/payment-links','verifyPayment','expiryDate','PaymentId','stringify','POST','Missing\x20id\x20or\x20shortLink\x20in\x20response','441BolLYn','amount','42232wbCbRj'];a60_0xd3a0=function(){return _0x5585be;};return a60_0xd3a0();}