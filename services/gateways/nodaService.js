'use strict';const a44_0x3758bb=a44_0x5a42;(function(_0x2821f5,_0x4857f4){const _0x22a3df=a44_0x5a42,_0x2810d3=_0x2821f5();while(!![]){try{const _0x22c036=-parseInt(_0x22a3df(0x167))/0x1*(-parseInt(_0x22a3df(0x16d))/0x2)+parseInt(_0x22a3df(0x140))/0x3+parseInt(_0x22a3df(0x16b))/0x4+-parseInt(_0x22a3df(0x169))/0x5+-parseInt(_0x22a3df(0x111))/0x6+-parseInt(_0x22a3df(0x15c))/0x7*(-parseInt(_0x22a3df(0x109))/0x8)+-parseInt(_0x22a3df(0x116))/0x9*(parseInt(_0x22a3df(0x127))/0xa);if(_0x22c036===_0x4857f4)break;else _0x2810d3['push'](_0x2810d3['shift']());}catch(_0x50c20){_0x2810d3['push'](_0x2810d3['shift']());}}}(a44_0x45a0,0x99821));function a44_0x45a0(){const _0x4f373b=['Error\x20stack:','shortLink','expired','Unknown\x20error\x20from\x20Noda\x20API','Response\x20data:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Status\x20Code:','error','EXPIRED','6174776MmRupo','Settled','POST','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','expiryDate','processing','logWhiteDomainError','1316496FQmBxy','isActive','Response\x20Body:','application/json','/payment-links','8349660waUlyX','TesSoft\x20Payment\x20System/1.0','headers','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Order\x20ID\x20Format:','Noda\x20webhook\x20signature\x20verification:','__esModule','text','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','shortLinkUrls','Noda\x20API\x20error:\x20','Raw\x20Response\x20Body:','SettlementDate','===\x20NODA\x20SERVICE\x20ERROR\x20===','/payment-links/','created','10YmxliY','HTTP\x20Status:','Status','Not\x20provided','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','pending','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','https://tesoft.uk/gateway/noda/','logWhiteDomainRequest','PENDING','log','PaymentId','successful','completed','Remitter','failed','Missing\x20id\x20or\x20shortLink\x20in\x20response','HTTP\x20error!\x20status:\x20','timeout','Short\x20Link:','currency','FAILED','Amount','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','BankTransactionId','2377497VzIEGo','noda','active','paid','Unknown\x20error','amount','===\x20PARSED\x20NODA\x20RESPONSE\x20===','now','URL:','statusText','../loggerService','cancelled','fromEntries','logWhiteDomainResponse','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','stack','GET','statusCode','Noda\x20payment\x20verification\x20error:','in_progress','Yes','message','verifyWebhookSignature','===\x20NODA\x20API\x20ERROR\x20===','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','MerchantPaymentId','Status\x20Text:','HTTP\x20','7AsjNME','loggerService','Request\x20Body\x20(Direct\x20JSON):','JSON\x20Parse\x20Error:\x20','Headers:','(8digits-8digits\x20format\x20for\x20Noda)',',\x20body:\x20','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','BankId','Status:','NodaService','2RieSvU','qrCodeLink','4193680BZOPtj','success','4059484vyPMmx','apiUrl','35444PvyTuA','stringify','toUpperCase','status','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Error\x20Message:','verifyPayment','Error\x20message:','Name'];a44_0x45a0=function(){return _0x4f373b;};return a44_0x45a0();}Object['defineProperty'](exports,a44_0x3758bb(0x11d),{'value':!![]}),exports['NodaService']=void 0x0;function a44_0x5a42(_0xa26393,_0x1ed9cf){const _0x45a0de=a44_0x45a0();return a44_0x5a42=function(_0x5a4235,_0x61823f){_0x5a4235=_0x5a4235-0x102;let _0x314892=_0x45a0de[_0x5a4235];return _0x314892;},a44_0x5a42(_0xa26393,_0x1ed9cf);}const loggerService_1=require(a44_0x3758bb(0x14a));class NodaService{constructor(){const _0x3f4df4=a44_0x3758bb;this[_0x3f4df4(0x16c)]=_0x3f4df4(0x12e),console[_0x3f4df4(0x131)](_0x3f4df4(0x10c));}async['createPaymentLink'](_0x965d32){const _0x3c6cc9=a44_0x3758bb,{orderId:_0x558f56,name:_0x15abc8,paymentDescription:_0x38c89e,amount:_0x2d78ed,currency:_0x508096,webhookUrl:_0x14b5de,returnUrl:_0x26c85f,expiryDate:_0x141afb}=_0x965d32,_0xc19e17=_0x508096[_0x3c6cc9(0x16f)](),_0x37a092='https://tesoft.uk/gateway/noda/webhook/',_0x11a764='https://tesoft.uk/gateway/pending.php?id='+_0x558f56,_0x271f76={'name':_0x15abc8,'paymentDescription':_0x38c89e,'amount':_0x2d78ed,'currency':_0xc19e17,'paymentId':_0x558f56,'webhookUrl':_0x37a092,'returnUrl':_0x11a764};_0x141afb&&(_0x271f76[_0x3c6cc9(0x10e)]=_0x141afb);const _0x24dbc7=Date[_0x3c6cc9(0x147)]();try{console['log'](_0x3c6cc9(0x12b)),console[_0x3c6cc9(0x131)](_0x3c6cc9(0x148),this[_0x3c6cc9(0x16c)]),console[_0x3c6cc9(0x131)](_0x3c6cc9(0x15e),JSON['stringify'](_0x271f76,null,0x2)),console[_0x3c6cc9(0x131)](_0x3c6cc9(0x11b),_0x558f56,_0x3c6cc9(0x161)),console[_0x3c6cc9(0x131)](_0x3c6cc9(0x10d),_0x11a764),loggerService_1['loggerService'][_0x3c6cc9(0x12f)](_0x3c6cc9(0x141),_0x3c6cc9(0x115),_0x3c6cc9(0x10b),_0x271f76);const _0x552b3c=await fetch(this[_0x3c6cc9(0x16c)],{'method':_0x3c6cc9(0x10b),'headers':{'Content-Type':_0x3c6cc9(0x114),'Accept':_0x3c6cc9(0x114),'User-Agent':_0x3c6cc9(0x117)},'body':JSON[_0x3c6cc9(0x16e)](_0x271f76)}),_0x2134f8=Date[_0x3c6cc9(0x147)]()-_0x24dbc7;console[_0x3c6cc9(0x131)](_0x3c6cc9(0x11f)),console[_0x3c6cc9(0x131)](_0x3c6cc9(0x165),_0x552b3c['status']),console[_0x3c6cc9(0x131)](_0x3c6cc9(0x15a),_0x552b3c[_0x3c6cc9(0x149)]),console['log'](_0x3c6cc9(0x160),Object[_0x3c6cc9(0x14c)](_0x552b3c[_0x3c6cc9(0x118)]['entries']())),console[_0x3c6cc9(0x131)]('Response\x20Time:',_0x2134f8+'ms');const _0x3f1395=await _0x552b3c[_0x3c6cc9(0x11e)]();console[_0x3c6cc9(0x131)](_0x3c6cc9(0x122),_0x3f1395);if(!_0x552b3c['ok']){console[_0x3c6cc9(0x107)](_0x3c6cc9(0x157)),console['error'](_0x3c6cc9(0x128),_0x552b3c['status']),console[_0x3c6cc9(0x107)](_0x3c6cc9(0x113),_0x3f1395),loggerService_1[_0x3c6cc9(0x15d)][_0x3c6cc9(0x14d)](_0x3c6cc9(0x141),_0x3c6cc9(0x115),_0x552b3c[_0x3c6cc9(0x170)],_0x3f1395,_0x2134f8),loggerService_1[_0x3c6cc9(0x15d)]['logWhiteDomainError'](_0x3c6cc9(0x141),_0x3c6cc9(0x115),_0x3c6cc9(0x15b)+_0x552b3c[_0x3c6cc9(0x170)]+':\x20'+_0x3f1395);if(_0x552b3c[_0x3c6cc9(0x170)]===0x190)throw new Error(_0x3c6cc9(0x14e));else{if(_0x552b3c[_0x3c6cc9(0x170)]===0x1f4)throw new Error(_0x3c6cc9(0x158));}throw new Error(_0x3c6cc9(0x138)+_0x552b3c['status']+_0x3c6cc9(0x162)+_0x3f1395);}let _0x25b242;try{_0x25b242=JSON['parse'](_0x3f1395);}catch(_0x4e8e90){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x4e8e90),loggerService_1[_0x3c6cc9(0x15d)][_0x3c6cc9(0x110)](_0x3c6cc9(0x141),_0x3c6cc9(0x115),_0x3c6cc9(0x15f)+_0x4e8e90);throw new Error(_0x3c6cc9(0x171)+_0x3f1395);}console['log'](_0x3c6cc9(0x146)),console[_0x3c6cc9(0x131)]('Parsed\x20Result:',JSON[_0x3c6cc9(0x16e)](_0x25b242,null,0x2)),loggerService_1[_0x3c6cc9(0x15d)][_0x3c6cc9(0x14d)](_0x3c6cc9(0x141),_0x3c6cc9(0x115),_0x552b3c[_0x3c6cc9(0x170)],_0x25b242,_0x2134f8);if(_0x25b242[_0x3c6cc9(0x107)]||_0x25b242[_0x3c6cc9(0x151)]){const _0xdd5332=_0x25b242[_0x3c6cc9(0x155)]||_0x25b242[_0x3c6cc9(0x107)]||_0x3c6cc9(0x103);console[_0x3c6cc9(0x107)](_0x3c6cc9(0x12d)),console[_0x3c6cc9(0x107)](_0x3c6cc9(0x173),_0xdd5332),console[_0x3c6cc9(0x107)](_0x3c6cc9(0x106),_0x25b242[_0x3c6cc9(0x151)]),loggerService_1[_0x3c6cc9(0x15d)]['logWhiteDomainError'](_0x3c6cc9(0x141),_0x3c6cc9(0x115),'Business\x20Error:\x20'+_0xdd5332);throw new Error(_0x3c6cc9(0x121)+_0xdd5332);}if(!_0x25b242['id']||!_0x25b242[_0x3c6cc9(0x120)]?.[_0x3c6cc9(0x178)]){console[_0x3c6cc9(0x107)](_0x3c6cc9(0x163)),console[_0x3c6cc9(0x107)](_0x3c6cc9(0x137)),console[_0x3c6cc9(0x107)](_0x3c6cc9(0x104),_0x25b242),loggerService_1[_0x3c6cc9(0x15d)][_0x3c6cc9(0x110)](_0x3c6cc9(0x141),'/payment-links',_0x3c6cc9(0x119));throw new Error(_0x3c6cc9(0x13e));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console['log']('Payment\x20Link\x20ID:',_0x25b242['id']),console[_0x3c6cc9(0x131)](_0x3c6cc9(0x13a),_0x25b242[_0x3c6cc9(0x120)]['shortLink']),console[_0x3c6cc9(0x131)]('QR\x20Code\x20Link:',_0x25b242[_0x3c6cc9(0x120)][_0x3c6cc9(0x168)]||_0x3c6cc9(0x12a)),console['log']('Order\x20ID\x20Used:',_0x558f56,'(8digits-8digits\x20format)'),console['log'](_0x3c6cc9(0x172),_0x11a764),{'gateway_payment_id':_0x25b242['id'],'payment_url':_0x25b242[_0x3c6cc9(0x120)][_0x3c6cc9(0x178)],'qr_code_url':_0x25b242[_0x3c6cc9(0x120)][_0x3c6cc9(0x168)],'expiry_date':_0x25b242[_0x3c6cc9(0x10e)]};}catch(_0x1f8351){console['error'](_0x3c6cc9(0x124)),console[_0x3c6cc9(0x107)]('Error\x20details:',_0x1f8351),loggerService_1['loggerService'][_0x3c6cc9(0x110)](_0x3c6cc9(0x141),_0x3c6cc9(0x115),_0x1f8351);if(_0x1f8351 instanceof Error){console[_0x3c6cc9(0x107)](_0x3c6cc9(0x175),_0x1f8351[_0x3c6cc9(0x155)]),console[_0x3c6cc9(0x107)](_0x3c6cc9(0x177),_0x1f8351[_0x3c6cc9(0x14f)]);throw new Error(_0x3c6cc9(0x105)+_0x1f8351[_0x3c6cc9(0x155)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a44_0x3758bb(0x174)](_0x4899b7){const _0x354e8a=a44_0x3758bb,_0x11cd14=Date[_0x354e8a(0x147)]();try{loggerService_1['loggerService'][_0x354e8a(0x12f)](_0x354e8a(0x141),_0x354e8a(0x125)+_0x4899b7,_0x354e8a(0x150),{});const _0x9e7ad9=await fetch(this['apiUrl']+'/'+_0x4899b7,{'method':_0x354e8a(0x150),'headers':{'Content-Type':_0x354e8a(0x114),'User-Agent':_0x354e8a(0x117)}}),_0x10131a=Date[_0x354e8a(0x147)]()-_0x11cd14;if(!_0x9e7ad9['ok']){const _0x358c42=await _0x9e7ad9['text']();loggerService_1[_0x354e8a(0x15d)][_0x354e8a(0x14d)](_0x354e8a(0x141),_0x354e8a(0x125)+_0x4899b7,_0x9e7ad9['status'],_0x358c42,_0x10131a);throw new Error(_0x354e8a(0x138)+_0x9e7ad9[_0x354e8a(0x170)]);}const _0x5aaa7f=await _0x9e7ad9['json']();loggerService_1[_0x354e8a(0x15d)][_0x354e8a(0x14d)](_0x354e8a(0x141),'/payment-links/'+_0x4899b7,_0x9e7ad9[_0x354e8a(0x170)],_0x5aaa7f,_0x10131a);if(_0x5aaa7f[_0x354e8a(0x107)]||_0x5aaa7f[_0x354e8a(0x151)]){loggerService_1['loggerService'][_0x354e8a(0x110)](_0x354e8a(0x141),_0x354e8a(0x125)+_0x4899b7,_0x354e8a(0x121)+(_0x5aaa7f[_0x354e8a(0x155)]||_0x5aaa7f[_0x354e8a(0x107)]||_0x354e8a(0x144)));throw new Error('Noda\x20API\x20error:\x20'+(_0x5aaa7f[_0x354e8a(0x155)]||_0x5aaa7f['error']||_0x354e8a(0x144)));}let _0x143693='PENDING';if(_0x5aaa7f[_0x354e8a(0x112)]===![]){if(_0x5aaa7f[_0x354e8a(0x10e)]){const _0x51c9eb=new Date(_0x5aaa7f[_0x354e8a(0x10e)]),_0xb50164=new Date();_0x51c9eb<_0xb50164?_0x143693=_0x354e8a(0x108):_0x143693=_0x354e8a(0x13c);}else _0x143693='FAILED';}else _0x143693=_0x354e8a(0x130);return{'status':_0x143693,'amount':_0x5aaa7f[_0x354e8a(0x145)],'currency':_0x5aaa7f[_0x354e8a(0x13b)],'isActive':_0x5aaa7f[_0x354e8a(0x112)]};}catch(_0xa4d29a){console['error'](_0x354e8a(0x152),_0xa4d29a),loggerService_1[_0x354e8a(0x15d)][_0x354e8a(0x110)](_0x354e8a(0x141),_0x354e8a(0x125)+_0x4899b7,_0xa4d29a);throw new Error(_0x354e8a(0x11a)+(_0xa4d29a instanceof Error?_0xa4d29a[_0x354e8a(0x155)]:_0x354e8a(0x144)));}}async['processWebhook'](_0x2f9456){const _0x4b1a82=a44_0x3758bb;console['log']('Processing\x20Noda\x20webhook:',_0x2f9456);let _0x594e16=_0x4b1a82(0x130);switch(_0x2f9456[_0x4b1a82(0x129)]?.['toLowerCase']()){case'done':case _0x4b1a82(0x134):case _0x4b1a82(0x143):case _0x4b1a82(0x16a):case _0x4b1a82(0x133):_0x2f9456['Settled']===_0x4b1a82(0x154)?_0x594e16='PAID':_0x594e16='PENDING';break;case _0x4b1a82(0x14b):case'canceled':case _0x4b1a82(0x136):case _0x4b1a82(0x107):case'rejected':_0x594e16='FAILED';break;case _0x4b1a82(0x102):case _0x4b1a82(0x139):_0x594e16='EXPIRED';break;case _0x4b1a82(0x12c):case _0x4b1a82(0x126):case _0x4b1a82(0x142):case _0x4b1a82(0x10f):case _0x4b1a82(0x153):default:_0x594e16='PENDING';break;}return{'paymentId':_0x2f9456['MerchantPaymentId']||_0x2f9456[_0x4b1a82(0x132)],'status':_0x594e16,'amount':_0x2f9456[_0x4b1a82(0x13d)],'currency':_0x2f9456['Currency'],'additionalInfo':{'method':_0x2f9456['Method'],'bankId':_0x2f9456[_0x4b1a82(0x164)],'settled':_0x2f9456[_0x4b1a82(0x10a)],'settlementDate':_0x2f9456[_0x4b1a82(0x123)],'remitterName':_0x2f9456['Remitter']?.[_0x4b1a82(0x176)],'remitterIban':_0x2f9456[_0x4b1a82(0x135)]?.['Iban'],'bankTransactionId':_0x2f9456[_0x4b1a82(0x13f)]}};}[a44_0x3758bb(0x156)](_0x1b7fcf,_0xe5b07b){const _0x31b0c5=a44_0x3758bb;return console['log'](_0x31b0c5(0x11c),{'receivedSignature':_0xe5b07b,'paymentId':_0x1b7fcf[_0x31b0c5(0x132)],'merchantPaymentId':_0x1b7fcf[_0x31b0c5(0x159)]}),!![];}}exports[a44_0x3758bb(0x166)]=NodaService;