'use strict';const a53_0x577d29=a53_0x424a;(function(_0x242b91,_0x3fd7f8){const _0x4aa85b=a53_0x424a,_0xdd0e63=_0x242b91();while(!![]){try{const _0x558e02=parseInt(_0x4aa85b(0x1dd))/0x1*(parseInt(_0x4aa85b(0x1ae))/0x2)+parseInt(_0x4aa85b(0x1e1))/0x3*(parseInt(_0x4aa85b(0x184))/0x4)+parseInt(_0x4aa85b(0x172))/0x5+parseInt(_0x4aa85b(0x1aa))/0x6+parseInt(_0x4aa85b(0x188))/0x7*(-parseInt(_0x4aa85b(0x168))/0x8)+-parseInt(_0x4aa85b(0x16b))/0x9*(parseInt(_0x4aa85b(0x1a6))/0xa)+parseInt(_0x4aa85b(0x1c0))/0xb*(parseInt(_0x4aa85b(0x176))/0xc);if(_0x558e02===_0x3fd7f8)break;else _0xdd0e63['push'](_0xdd0e63['shift']());}catch(_0x2ade27){_0xdd0e63['push'](_0xdd0e63['shift']());}}}(a53_0x1726,0x3479f));Object[a53_0x577d29(0x1b8)](exports,a53_0x577d29(0x194),{'value':!![]}),exports[a53_0x577d29(0x1d1)]=void 0x0;const loggerService_1=require(a53_0x577d29(0x1b3));function a53_0x424a(_0x279b3d,_0x4ccb1b){const _0x172675=a53_0x1726();return a53_0x424a=function(_0x424a74,_0x1287d7){_0x424a74=_0x424a74-0x167;let _0x45ec5a=_0x172675[_0x424a74];return _0x45ec5a;},a53_0x424a(_0x279b3d,_0x4ccb1b);}function a53_0x1726(){const _0x3e2112=['shortLink','stringify','log','Response\x20Body:','===\x20NODA\x20API\x20ERROR\x20===','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','1182950dGyfFc','completed','Unknown\x20error\x20from\x20Noda\x20API','loggerService','84dIZFtm','done','EXPIRED','toLowerCase','Noda\x20webhook\x20signature\x20verification:','Settled','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','expired','Yes','BankTransactionId','Processing\x20Noda\x20webhook:','PENDING','Failed\x20to\x20verify\x20Noda\x20payment:\x20','entries','176jJyEQb','shortLinkUrls','statusText','===\x20PARSED\x20NODA\x20RESPONSE\x20===','21nEKGYM','HTTP\x20error!\x20status:\x20','HTTP\x20Status:','created','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20details:','application/json','canceled','URL:',',\x20body:\x20','Iban','in_progress','__esModule','rejected','logWhiteDomainError','https://tesoft.uk/gateway/noda/webhook/','Order\x20ID\x20Used:','Remitter','status','Headers:','===\x20NODA\x20SERVICE\x20ERROR\x20===','/payment-links','Business\x20Error:\x20','(8digits-8digits\x20format\x20for\x20Noda)','FAILED','Unknown\x20error','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','verifyPayment','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20SUCCESS\x20===','1460xKBMtj','pending','now','HTTP\x20','432240fYKghp','Error\x20stack:','Method','Not\x20provided','8IQzMuL','Response\x20Time:','https://tesoft.uk/gateway/pending.php?id=','SettlementDate','Status\x20Text:','../loggerService','qrCodeLink','Name','error','amount','defineProperty','Payment\x20System/1.0','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','/payment-links/','isActive','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','apiUrl','MerchantPaymentId','101420FzCXjg','GET','paid','Status:','Missing\x20id\x20or\x20shortLink\x20in\x20response','json','Request\x20Body\x20(Direct\x20JSON):','PaymentId','logWhiteDomainRequest','currency','Noda\x20API\x20error:\x20','stack','logWhiteDomainResponse','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','toUpperCase','(8digits-8digits\x20format)','verifyWebhookSignature','NodaService','noda','cancelled','statusCode','parse','active','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','headers','fromEntries','Error\x20Message:','Order\x20ID\x20Format:','processing','2738dkaSJE','JSON\x20Parse\x20Error:\x20','successful','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','29076CNPwpm','createPaymentLink','expiryDate','message','794488FIOGfO','Response\x20data:','PAID','18351fxvAAc'];a53_0x1726=function(){return _0x3e2112;};return a53_0x1726();}class NodaService{constructor(){this['apiUrl']='https://tesoft.uk/gateway/noda/',console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a53_0x577d29(0x1e2)](_0x26af66){const _0x16409b=a53_0x577d29,{orderId:_0x5e3bf2,name:_0x23c758,paymentDescription:_0x2de8b4,amount:_0x5a567e,currency:_0x26491a,webhookUrl:_0x43ac93,returnUrl:_0x5c53cd,expiryDate:_0x5103a9}=_0x26af66,_0x3aa48b=_0x26491a[_0x16409b(0x1ce)](),_0x3f6c65=_0x16409b(0x197),_0x11bec3=_0x16409b(0x1b0)+_0x5e3bf2,_0xde6706={'name':_0x23c758,'paymentDescription':_0x2de8b4,'amount':_0x5a567e,'currency':_0x3aa48b,'paymentId':_0x5e3bf2,'webhookUrl':_0x3f6c65,'returnUrl':_0x11bec3};_0x5103a9&&(_0xde6706['expiryDate']=_0x5103a9);const _0x476290=Date[_0x16409b(0x1a8)]();try{console[_0x16409b(0x16e)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x16409b(0x16e)](_0x16409b(0x190),this[_0x16409b(0x1be)]),console[_0x16409b(0x16e)](_0x16409b(0x1c6),JSON[_0x16409b(0x16d)](_0xde6706,null,0x2)),console[_0x16409b(0x16e)](_0x16409b(0x1db),_0x5e3bf2,_0x16409b(0x19f)),console['log'](_0x16409b(0x1cd),_0x11bec3),loggerService_1[_0x16409b(0x175)]['logWhiteDomainRequest'](_0x16409b(0x1d2),'/payment-links','POST',_0xde6706);const _0x167981=await fetch(this[_0x16409b(0x1be)],{'method':'POST','headers':{'Content-Type':_0x16409b(0x18e),'Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x16409b(0x16d)](_0xde6706)}),_0x123100=Date['now']()-_0x476290;console[_0x16409b(0x16e)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x16409b(0x1c3),_0x167981['status']),console[_0x16409b(0x16e)](_0x16409b(0x1b2),_0x167981[_0x16409b(0x186)]),console[_0x16409b(0x16e)](_0x16409b(0x19b),Object[_0x16409b(0x1d9)](_0x167981[_0x16409b(0x1d8)][_0x16409b(0x183)]())),console[_0x16409b(0x16e)](_0x16409b(0x1af),_0x123100+'ms');const _0x4f088b=await _0x167981['text']();console[_0x16409b(0x16e)]('Raw\x20Response\x20Body:',_0x4f088b);if(!_0x167981['ok']){console[_0x16409b(0x1b6)](_0x16409b(0x170)),console[_0x16409b(0x1b6)](_0x16409b(0x18a),_0x167981[_0x16409b(0x19a)]),console['error'](_0x16409b(0x16f),_0x4f088b),loggerService_1['loggerService'][_0x16409b(0x1cc)](_0x16409b(0x1d2),'/payment-links',_0x167981[_0x16409b(0x19a)],_0x4f088b,_0x123100),loggerService_1[_0x16409b(0x175)][_0x16409b(0x196)]('noda',_0x16409b(0x19d),_0x16409b(0x1a9)+_0x167981[_0x16409b(0x19a)]+':\x20'+_0x4f088b);if(_0x167981[_0x16409b(0x19a)]===0x190)throw new Error(_0x16409b(0x171));else{if(_0x167981['status']===0x1f4)throw new Error(_0x16409b(0x1e0));}throw new Error(_0x16409b(0x189)+_0x167981[_0x16409b(0x19a)]+_0x16409b(0x191)+_0x4f088b);}let _0x451e3f;try{_0x451e3f=JSON[_0x16409b(0x1d5)](_0x4f088b);}catch(_0x4d23c1){console[_0x16409b(0x1b6)](_0x16409b(0x18c),_0x4d23c1),loggerService_1['loggerService'][_0x16409b(0x196)](_0x16409b(0x1d2),_0x16409b(0x19d),_0x16409b(0x1de)+_0x4d23c1);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x4f088b);}console[_0x16409b(0x16e)](_0x16409b(0x187)),console['log']('Parsed\x20Result:',JSON[_0x16409b(0x16d)](_0x451e3f,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x16409b(0x1d2),_0x16409b(0x19d),_0x167981[_0x16409b(0x19a)],_0x451e3f,_0x123100);if(_0x451e3f[_0x16409b(0x1b6)]||_0x451e3f[_0x16409b(0x1d4)]){const _0x5b40dd=_0x451e3f[_0x16409b(0x167)]||_0x451e3f[_0x16409b(0x1b6)]||_0x16409b(0x174);console[_0x16409b(0x1b6)](_0x16409b(0x17c)),console[_0x16409b(0x1b6)](_0x16409b(0x1da),_0x5b40dd),console['error']('Status\x20Code:',_0x451e3f[_0x16409b(0x1d4)]),loggerService_1[_0x16409b(0x175)][_0x16409b(0x196)]('noda','/payment-links',_0x16409b(0x19e)+_0x5b40dd);throw new Error(_0x16409b(0x1ca)+_0x5b40dd);}if(!_0x451e3f['id']||!_0x451e3f['shortLinkUrls']?.[_0x16409b(0x16c)]){console['error'](_0x16409b(0x1a2)),console['error'](_0x16409b(0x1c4)),console[_0x16409b(0x1b6)](_0x16409b(0x169),_0x451e3f),loggerService_1[_0x16409b(0x175)][_0x16409b(0x196)](_0x16409b(0x1d2),'/payment-links',_0x16409b(0x1a4));throw new Error(_0x16409b(0x1d7));}return console[_0x16409b(0x16e)](_0x16409b(0x1a5)),console[_0x16409b(0x16e)]('Payment\x20Link\x20ID:',_0x451e3f['id']),console[_0x16409b(0x16e)]('Short\x20Link:',_0x451e3f[_0x16409b(0x185)][_0x16409b(0x16c)]),console['log']('QR\x20Code\x20Link:',_0x451e3f['shortLinkUrls'][_0x16409b(0x1b4)]||_0x16409b(0x1ad)),console[_0x16409b(0x16e)](_0x16409b(0x198),_0x5e3bf2,_0x16409b(0x1cf)),console[_0x16409b(0x16e)](_0x16409b(0x1ba),_0x11bec3),{'gateway_payment_id':_0x451e3f['id'],'payment_url':_0x451e3f[_0x16409b(0x185)][_0x16409b(0x16c)],'qr_code_url':_0x451e3f[_0x16409b(0x185)][_0x16409b(0x1b4)],'expiry_date':_0x451e3f['expiryDate']};}catch(_0x9fd612){console[_0x16409b(0x1b6)](_0x16409b(0x19c)),console['error'](_0x16409b(0x18d),_0x9fd612),loggerService_1[_0x16409b(0x175)]['logWhiteDomainError'](_0x16409b(0x1d2),'/payment-links',_0x9fd612);if(_0x9fd612 instanceof Error){console['error']('Error\x20message:',_0x9fd612[_0x16409b(0x167)]),console[_0x16409b(0x1b6)](_0x16409b(0x1ab),_0x9fd612[_0x16409b(0x1cb)]);throw new Error(_0x16409b(0x1bd)+_0x9fd612[_0x16409b(0x167)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a53_0x577d29(0x1a3)](_0x13a3bd){const _0x42b6c0=a53_0x577d29,_0x33b3ba=Date[_0x42b6c0(0x1a8)]();try{loggerService_1[_0x42b6c0(0x175)][_0x42b6c0(0x1c8)](_0x42b6c0(0x1d2),_0x42b6c0(0x1bb)+_0x13a3bd,'GET',{});const _0x1d33cf=await fetch(this[_0x42b6c0(0x1be)]+'/'+_0x13a3bd,{'method':_0x42b6c0(0x1c1),'headers':{'Content-Type':'application/json','User-Agent':_0x42b6c0(0x1b9)}}),_0x2c8ad5=Date['now']()-_0x33b3ba;if(!_0x1d33cf['ok']){const _0x4fd5cb=await _0x1d33cf['text']();loggerService_1[_0x42b6c0(0x175)]['logWhiteDomainResponse'](_0x42b6c0(0x1d2),'/payment-links/'+_0x13a3bd,_0x1d33cf['status'],_0x4fd5cb,_0x2c8ad5);throw new Error(_0x42b6c0(0x189)+_0x1d33cf[_0x42b6c0(0x19a)]);}const _0x302dcf=await _0x1d33cf[_0x42b6c0(0x1c5)]();loggerService_1[_0x42b6c0(0x175)]['logWhiteDomainResponse'](_0x42b6c0(0x1d2),'/payment-links/'+_0x13a3bd,_0x1d33cf[_0x42b6c0(0x19a)],_0x302dcf,_0x2c8ad5);if(_0x302dcf['error']||_0x302dcf[_0x42b6c0(0x1d4)]){loggerService_1[_0x42b6c0(0x175)][_0x42b6c0(0x196)](_0x42b6c0(0x1d2),_0x42b6c0(0x1bb)+_0x13a3bd,'Noda\x20API\x20error:\x20'+(_0x302dcf[_0x42b6c0(0x167)]||_0x302dcf[_0x42b6c0(0x1b6)]||_0x42b6c0(0x1a1)));throw new Error(_0x42b6c0(0x1ca)+(_0x302dcf[_0x42b6c0(0x167)]||_0x302dcf['error']||_0x42b6c0(0x1a1)));}let _0x167b3c=_0x42b6c0(0x181);if(_0x302dcf['isActive']===![]){if(_0x302dcf[_0x42b6c0(0x1e3)]){const _0x43c20f=new Date(_0x302dcf['expiryDate']),_0x370d87=new Date();_0x43c20f<_0x370d87?_0x167b3c=_0x42b6c0(0x178):_0x167b3c='FAILED';}else _0x167b3c=_0x42b6c0(0x1a0);}else _0x167b3c=_0x42b6c0(0x181);return{'status':_0x167b3c,'amount':_0x302dcf[_0x42b6c0(0x1b7)],'currency':_0x302dcf[_0x42b6c0(0x1c9)],'isActive':_0x302dcf[_0x42b6c0(0x1bc)]};}catch(_0x4084a4){console[_0x42b6c0(0x1b6)]('Noda\x20payment\x20verification\x20error:',_0x4084a4),loggerService_1[_0x42b6c0(0x175)][_0x42b6c0(0x196)](_0x42b6c0(0x1d2),_0x42b6c0(0x1bb)+_0x13a3bd,_0x4084a4);throw new Error(_0x42b6c0(0x182)+(_0x4084a4 instanceof Error?_0x4084a4[_0x42b6c0(0x167)]:_0x42b6c0(0x1a1)));}}async['processWebhook'](_0x155d83){const _0x5268d9=a53_0x577d29;console[_0x5268d9(0x16e)](_0x5268d9(0x180),_0x155d83);let _0x3afa75=_0x5268d9(0x181);switch(_0x155d83['Status']?.[_0x5268d9(0x179)]()){case _0x5268d9(0x177):case _0x5268d9(0x173):case _0x5268d9(0x1c2):case'success':case _0x5268d9(0x1df):_0x155d83[_0x5268d9(0x17b)]===_0x5268d9(0x17e)?_0x3afa75=_0x5268d9(0x16a):_0x3afa75=_0x5268d9(0x181);break;case _0x5268d9(0x1d3):case _0x5268d9(0x18f):case'failed':case _0x5268d9(0x1b6):case _0x5268d9(0x195):_0x3afa75=_0x5268d9(0x1a0);break;case _0x5268d9(0x17d):case'timeout':_0x3afa75=_0x5268d9(0x178);break;case _0x5268d9(0x1a7):case _0x5268d9(0x18b):case _0x5268d9(0x1d6):case _0x5268d9(0x1dc):case _0x5268d9(0x193):default:_0x3afa75=_0x5268d9(0x181);break;}return{'paymentId':_0x155d83['MerchantPaymentId']||_0x155d83[_0x5268d9(0x1c7)],'status':_0x3afa75,'amount':_0x155d83['Amount'],'currency':_0x155d83['Currency'],'additionalInfo':{'method':_0x155d83[_0x5268d9(0x1ac)],'bankId':_0x155d83['BankId'],'settled':_0x155d83[_0x5268d9(0x17b)],'settlementDate':_0x155d83[_0x5268d9(0x1b1)],'remitterName':_0x155d83[_0x5268d9(0x199)]?.[_0x5268d9(0x1b5)],'remitterIban':_0x155d83[_0x5268d9(0x199)]?.[_0x5268d9(0x192)],'bankTransactionId':_0x155d83[_0x5268d9(0x17f)]}};}[a53_0x577d29(0x1d0)](_0x2fe5e0,_0x350e00){const _0x588f03=a53_0x577d29;return console['log'](_0x588f03(0x17a),{'receivedSignature':_0x350e00,'paymentId':_0x2fe5e0['PaymentId'],'merchantPaymentId':_0x2fe5e0[_0x588f03(0x1bf)]}),!![];}}exports[a53_0x577d29(0x1d1)]=NodaService;