'use strict';const a44_0x2e58a3=a44_0x4632;(function(_0x14566a,_0x2a6a09){const _0x3bec56=a44_0x4632,_0x259bb7=_0x14566a();while(!![]){try{const _0x8a7a8c=-parseInt(_0x3bec56(0x1d0))/0x1+parseInt(_0x3bec56(0x19d))/0x2*(parseInt(_0x3bec56(0x1dd))/0x3)+parseInt(_0x3bec56(0x1a2))/0x4*(parseInt(_0x3bec56(0x1ce))/0x5)+-parseInt(_0x3bec56(0x172))/0x6+-parseInt(_0x3bec56(0x182))/0x7*(-parseInt(_0x3bec56(0x186))/0x8)+parseInt(_0x3bec56(0x1bf))/0x9*(parseInt(_0x3bec56(0x1db))/0xa)+-parseInt(_0x3bec56(0x1a9))/0xb;if(_0x8a7a8c===_0x2a6a09)break;else _0x259bb7['push'](_0x259bb7['shift']());}catch(_0x363f3d){_0x259bb7['push'](_0x259bb7['shift']());}}}(a44_0x46c2,0xca9e7));function a44_0x4632(_0x28479a,_0x3db4af){const _0x46c2c7=a44_0x46c2();return a44_0x4632=function(_0x46327d,_0xb7835b){_0x46327d=_0x46327d-0x16c;let _0x26c3da=_0x46c2c7[_0x46327d];return _0x26c3da;},a44_0x4632(_0x28479a,_0x3db4af);}Object[a44_0x2e58a3(0x1a3)](exports,a44_0x2e58a3(0x18e),{'value':!![]}),exports[a44_0x2e58a3(0x1ba)]=void 0x0;const loggerService_1=require(a44_0x2e58a3(0x192));class NodaService{constructor(){const _0x15eca7=a44_0x2e58a3;this[_0x15eca7(0x18b)]='https://tesoft.uk/gateway/noda/',console[_0x15eca7(0x1b0)](_0x15eca7(0x16e));}async['createPaymentLink'](_0x1fa067){const _0x38b010=a44_0x2e58a3,{orderId:_0x80522e,name:_0x486ac3,paymentDescription:_0x3d642d,amount:_0x323f06,currency:_0xac71a,webhookUrl:_0x175092,returnUrl:_0x3c5031,expiryDate:_0x3211b1}=_0x1fa067,_0x465f4a=_0xac71a[_0x38b010(0x1c9)](),_0x3a3fdf='https://tesoft.uk/gateway/noda/webhook/',_0x1116c0=_0x38b010(0x1b3)+_0x80522e,_0x78ddbe={'name':_0x486ac3,'paymentDescription':_0x3d642d,'amount':_0x323f06,'currency':_0x465f4a,'paymentId':_0x80522e,'webhookUrl':_0x3a3fdf,'returnUrl':_0x1116c0};_0x3211b1&&(_0x78ddbe['expiryDate']=_0x3211b1);const _0x35b252=Date[_0x38b010(0x1d4)]();try{console[_0x38b010(0x1b0)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x38b010(0x1b0)]('URL:',this[_0x38b010(0x18b)]),console[_0x38b010(0x1b0)](_0x38b010(0x1ca),JSON['stringify'](_0x78ddbe,null,0x2)),console[_0x38b010(0x1b0)](_0x38b010(0x193),_0x80522e,_0x38b010(0x19a)),console[_0x38b010(0x1b0)]('✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:',_0x1116c0),loggerService_1[_0x38b010(0x1b4)][_0x38b010(0x19c)](_0x38b010(0x1b2),_0x38b010(0x19b),_0x38b010(0x191),_0x78ddbe);const _0x5c3901=await fetch(this[_0x38b010(0x18b)],{'method':_0x38b010(0x191),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x38b010(0x1aa)},'body':JSON[_0x38b010(0x1c1)](_0x78ddbe)}),_0x32e7f0=Date[_0x38b010(0x1d4)]()-_0x35b252;console[_0x38b010(0x1b0)](_0x38b010(0x1d8)),console[_0x38b010(0x1b0)]('Status:',_0x5c3901[_0x38b010(0x1cc)]),console[_0x38b010(0x1b0)](_0x38b010(0x1dc),_0x5c3901[_0x38b010(0x1a5)]),console[_0x38b010(0x1b0)](_0x38b010(0x1a8),Object[_0x38b010(0x1c7)](_0x5c3901[_0x38b010(0x18f)]['entries']())),console[_0x38b010(0x1b0)]('Response\x20Time:',_0x32e7f0+'ms');const _0x245904=await _0x5c3901['text']();console[_0x38b010(0x1b0)](_0x38b010(0x170),_0x245904);if(!_0x5c3901['ok']){console[_0x38b010(0x18c)](_0x38b010(0x1a0)),console[_0x38b010(0x18c)]('HTTP\x20Status:',_0x5c3901[_0x38b010(0x1cc)]),console[_0x38b010(0x18c)](_0x38b010(0x1d7),_0x245904),loggerService_1[_0x38b010(0x1b4)][_0x38b010(0x174)]('noda',_0x38b010(0x19b),_0x5c3901[_0x38b010(0x1cc)],_0x245904,_0x32e7f0),loggerService_1[_0x38b010(0x1b4)][_0x38b010(0x19f)](_0x38b010(0x1b2),'/payment-links','HTTP\x20'+_0x5c3901[_0x38b010(0x1cc)]+':\x20'+_0x245904);if(_0x5c3901[_0x38b010(0x1cc)]===0x190)throw new Error(_0x38b010(0x1c8));else{if(_0x5c3901[_0x38b010(0x1cc)]===0x1f4)throw new Error(_0x38b010(0x1cb));}throw new Error(_0x38b010(0x16c)+_0x5c3901['status']+',\x20body:\x20'+_0x245904);}let _0x1f8d41;try{_0x1f8d41=JSON[_0x38b010(0x17f)](_0x245904);}catch(_0x32e97f){console[_0x38b010(0x18c)](_0x38b010(0x1bb),_0x32e97f),loggerService_1[_0x38b010(0x1b4)]['logWhiteDomainError'](_0x38b010(0x1b2),_0x38b010(0x19b),_0x38b010(0x1df)+_0x32e97f);throw new Error(_0x38b010(0x1a4)+_0x245904);}console[_0x38b010(0x1b0)](_0x38b010(0x1e2)),console[_0x38b010(0x1b0)](_0x38b010(0x16f),JSON[_0x38b010(0x1c1)](_0x1f8d41,null,0x2)),loggerService_1['loggerService'][_0x38b010(0x174)](_0x38b010(0x1b2),_0x38b010(0x19b),_0x5c3901['status'],_0x1f8d41,_0x32e7f0);if(_0x1f8d41['error']||_0x1f8d41['statusCode']){const _0x8eb3bd=_0x1f8d41['message']||_0x1f8d41[_0x38b010(0x18c)]||_0x38b010(0x17e);console['error'](_0x38b010(0x184)),console['error'](_0x38b010(0x17b),_0x8eb3bd),console[_0x38b010(0x18c)]('Status\x20Code:',_0x1f8d41[_0x38b010(0x1b8)]),loggerService_1['loggerService'][_0x38b010(0x19f)](_0x38b010(0x1b2),_0x38b010(0x19b),_0x38b010(0x1bd)+_0x8eb3bd);throw new Error('Noda\x20API\x20error:\x20'+_0x8eb3bd);}if(!_0x1f8d41['id']||!_0x1f8d41[_0x38b010(0x18d)]?.['shortLink']){console[_0x38b010(0x18c)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x38b010(0x18a)),console[_0x38b010(0x18c)](_0x38b010(0x1b5),_0x1f8d41),loggerService_1[_0x38b010(0x1b4)]['logWhiteDomainError']('noda',_0x38b010(0x19b),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x38b010(0x1c0));}return console[_0x38b010(0x1b0)](_0x38b010(0x1a1)),console[_0x38b010(0x1b0)](_0x38b010(0x1d3),_0x1f8d41['id']),console[_0x38b010(0x1b0)](_0x38b010(0x176),_0x1f8d41[_0x38b010(0x18d)][_0x38b010(0x1d2)]),console[_0x38b010(0x1b0)](_0x38b010(0x178),_0x1f8d41['shortLinkUrls'][_0x38b010(0x188)]||_0x38b010(0x175)),console['log'](_0x38b010(0x1ad),_0x80522e,_0x38b010(0x1cd)),console[_0x38b010(0x1b0)](_0x38b010(0x1c4),_0x1116c0),{'gateway_payment_id':_0x1f8d41['id'],'payment_url':_0x1f8d41[_0x38b010(0x18d)][_0x38b010(0x1d2)],'qr_code_url':_0x1f8d41[_0x38b010(0x18d)][_0x38b010(0x188)],'expiry_date':_0x1f8d41[_0x38b010(0x17c)]};}catch(_0xec3c77){console[_0x38b010(0x18c)](_0x38b010(0x1d1)),console[_0x38b010(0x18c)]('Error\x20details:',_0xec3c77),loggerService_1[_0x38b010(0x1b4)][_0x38b010(0x19f)](_0x38b010(0x1b2),'/payment-links',_0xec3c77);if(_0xec3c77 instanceof Error){console[_0x38b010(0x18c)]('Error\x20message:',_0xec3c77[_0x38b010(0x194)]),console[_0x38b010(0x18c)](_0x38b010(0x1cf),_0xec3c77['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0xec3c77[_0x38b010(0x194)]);}throw new Error(_0x38b010(0x199));}}async[a44_0x2e58a3(0x1d9)](_0xdf3bdc){const _0x14096c=a44_0x2e58a3,_0x40b67b=Date['now']();try{loggerService_1[_0x14096c(0x1b4)]['logWhiteDomainRequest'](_0x14096c(0x1b2),'/payment-links/'+_0xdf3bdc,'GET',{});const _0x300c3d=await fetch(this[_0x14096c(0x18b)]+'/'+_0xdf3bdc,{'method':'GET','headers':{'Content-Type':_0x14096c(0x195),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x24eea9=Date[_0x14096c(0x1d4)]()-_0x40b67b;if(!_0x300c3d['ok']){const _0xb0e8e5=await _0x300c3d[_0x14096c(0x1c3)]();loggerService_1[_0x14096c(0x1b4)][_0x14096c(0x174)](_0x14096c(0x1b2),_0x14096c(0x1c6)+_0xdf3bdc,_0x300c3d['status'],_0xb0e8e5,_0x24eea9);throw new Error(_0x14096c(0x16c)+_0x300c3d['status']);}const _0x5186fc=await _0x300c3d['json']();loggerService_1[_0x14096c(0x1b4)][_0x14096c(0x174)](_0x14096c(0x1b2),_0x14096c(0x1c6)+_0xdf3bdc,_0x300c3d[_0x14096c(0x1cc)],_0x5186fc,_0x24eea9);if(_0x5186fc[_0x14096c(0x18c)]||_0x5186fc['statusCode']){loggerService_1[_0x14096c(0x1b4)][_0x14096c(0x19f)](_0x14096c(0x1b2),_0x14096c(0x1c6)+_0xdf3bdc,_0x14096c(0x185)+(_0x5186fc['message']||_0x5186fc['error']||_0x14096c(0x1c5)));throw new Error('Noda\x20API\x20error:\x20'+(_0x5186fc[_0x14096c(0x194)]||_0x5186fc[_0x14096c(0x18c)]||'Unknown\x20error'));}let _0x15e983=_0x14096c(0x198);if(_0x5186fc[_0x14096c(0x1b9)]===![]){if(_0x5186fc[_0x14096c(0x17c)]){const _0x27fbf5=new Date(_0x5186fc[_0x14096c(0x17c)]),_0xe14143=new Date();_0x27fbf5<_0xe14143?_0x15e983=_0x14096c(0x1ab):_0x15e983=_0x14096c(0x16d);}else _0x15e983=_0x14096c(0x16d);}else _0x15e983=_0x14096c(0x198);return{'status':_0x15e983,'amount':_0x5186fc[_0x14096c(0x1e0)],'currency':_0x5186fc['currency'],'isActive':_0x5186fc[_0x14096c(0x1b9)]};}catch(_0x14d64b){console[_0x14096c(0x18c)](_0x14096c(0x1b6),_0x14d64b),loggerService_1['loggerService'][_0x14096c(0x19f)](_0x14096c(0x1b2),_0x14096c(0x1c6)+_0xdf3bdc,_0x14d64b);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x14d64b instanceof Error?_0x14d64b[_0x14096c(0x194)]:_0x14096c(0x1c5)));}}async[a44_0x2e58a3(0x187)](_0xd2796b){const _0x67cea2=a44_0x2e58a3;console[_0x67cea2(0x1b0)](_0x67cea2(0x181),_0xd2796b);let _0x30c369=_0x67cea2(0x198);switch(_0xd2796b[_0x67cea2(0x183)]?.[_0x67cea2(0x1c2)]()){case _0x67cea2(0x17a):case'completed':case _0x67cea2(0x1e3):case _0x67cea2(0x171):case _0x67cea2(0x197):_0xd2796b['Settled']===_0x67cea2(0x196)?_0x30c369=_0x67cea2(0x1e1):_0x30c369=_0x67cea2(0x198);break;case _0x67cea2(0x189):case'canceled':case _0x67cea2(0x1a6):case _0x67cea2(0x18c):case _0x67cea2(0x1a7):_0x30c369='FAILED';break;case _0x67cea2(0x1d6):case _0x67cea2(0x17d):_0x30c369=_0x67cea2(0x1ab);break;case _0x67cea2(0x177):case _0x67cea2(0x1de):case _0x67cea2(0x180):case _0x67cea2(0x1da):case _0x67cea2(0x19e):default:_0x30c369='PENDING';break;}return{'paymentId':_0xd2796b[_0x67cea2(0x1b7)]||_0xd2796b[_0x67cea2(0x179)],'status':_0x30c369,'amount':_0xd2796b['Amount'],'currency':_0xd2796b[_0x67cea2(0x1b1)],'additionalInfo':{'method':_0xd2796b[_0x67cea2(0x1d5)],'bankId':_0xd2796b['BankId'],'settled':_0xd2796b[_0x67cea2(0x1bc)],'settlementDate':_0xd2796b[_0x67cea2(0x1af)],'remitterName':_0xd2796b[_0x67cea2(0x190)]?.[_0x67cea2(0x1be)],'remitterIban':_0xd2796b[_0x67cea2(0x190)]?.['Iban'],'bankTransactionId':_0xd2796b[_0x67cea2(0x1ac)]}};}[a44_0x2e58a3(0x173)](_0x424702,_0x1d273c){const _0x28f724=a44_0x2e58a3;return console[_0x28f724(0x1b0)](_0x28f724(0x1ae),{'receivedSignature':_0x1d273c,'paymentId':_0x424702['PaymentId'],'merchantPaymentId':_0x424702[_0x28f724(0x1b7)]}),!![];}}exports[a44_0x2e58a3(0x1ba)]=NodaService;function a44_0x46c2(){const _0x44495f=['Payment\x20Link\x20ID:','now','Method','expired','Response\x20Body:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','verifyPayment','processing','105680tAmQvh','Status\x20Text:','9DPxKPS','created','JSON\x20Parse\x20Error:\x20','amount','PAID','===\x20PARSED\x20NODA\x20RESPONSE\x20===','paid','HTTP\x20error!\x20status:\x20','FAILED','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Parsed\x20Result:','Raw\x20Response\x20Body:','success','7009506PmdYCF','verifyWebhookSignature','logWhiteDomainResponse','Not\x20provided','Short\x20Link:','pending','QR\x20Code\x20Link:','PaymentId','done','Error\x20Message:','expiryDate','timeout','Unknown\x20error\x20from\x20Noda\x20API','parse','active','Processing\x20Noda\x20webhook:','1022uPhrGc','Status','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Noda\x20API\x20error:\x20','16512fAJPXC','processWebhook','qrCodeLink','cancelled','Missing\x20id\x20or\x20shortLink\x20in\x20response','apiUrl','error','shortLinkUrls','__esModule','headers','Remitter','POST','../loggerService','Order\x20ID\x20Format:','message','application/json','Yes','successful','PENDING','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','(8digits-8digits\x20format\x20for\x20Noda)','/payment-links','logWhiteDomainRequest','1083832ZKVGCh','in_progress','logWhiteDomainError','===\x20NODA\x20API\x20ERROR\x20===','===\x20NODA\x20SUCCESS\x20===','2356076kzulQx','defineProperty','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','statusText','failed','rejected','Headers:','11946627uBFrhv','TesSoft\x20Payment\x20System/1.0','EXPIRED','BankTransactionId','Order\x20ID\x20Used:','Noda\x20webhook\x20signature\x20verification:','SettlementDate','log','Currency','noda','https://tesoft.uk/gateway/pending.php?id=','loggerService','Response\x20data:','Noda\x20payment\x20verification\x20error:','MerchantPaymentId','statusCode','isActive','NodaService','Failed\x20to\x20parse\x20JSON\x20response:','Settled','Business\x20Error:\x20','Name','1359tuadtp','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','stringify','toLowerCase','text','✅\x20Return\x20URL\x20configured\x20for\x20pending:','Unknown\x20error','/payment-links/','fromEntries','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','toUpperCase','Request\x20Body\x20(Direct\x20JSON):','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','status','(8digits-8digits\x20format)','10csJCmy','Error\x20stack:','1616663WmcZpe','===\x20NODA\x20SERVICE\x20ERROR\x20===','shortLink'];a44_0x46c2=function(){return _0x44495f;};return a44_0x46c2();}