'use strict';const a43_0x3a0069=a43_0x2342;function a43_0x5d76(){const _0x15c3b2=['2344jqgYnU','processing','shortLink','Status','Noda\x20API\x20error:\x20','log','Noda\x20webhook\x20signature\x20verification:','headers','expiryDate','verifyWebhookSignature','Iban','successful','stack','Status:','GET','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Headers:','statusCode','Error\x20Message:','/payment-links/','MerchantPaymentId','defineProperty','noda','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','(8digits-8digits\x20format\x20for\x20Noda)','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','statusText','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','currency','logWhiteDomainError','BankTransactionId','Processing\x20Noda\x20webhook:','3099145Muvubk','completed','expired','logWhiteDomainRequest','HTTP\x20','Currency','../loggerService','timeout','Unknown\x20error\x20from\x20Noda\x20API','Payment\x20Link\x20ID:','Amount','PENDING','SettlementDate','PaymentId','createPaymentLink','Raw\x20Response\x20Body:',',\x20body:\x20','toLowerCase','in_progress','done','Settled','paid','2664vozKfc','https://tesoft.uk/gateway/pending.php?id=','success','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Error\x20stack:','POST','failed','shortLinkUrls','1194enJsRs','/payment-links','Remitter','HTTP\x20error!\x20status:\x20','application/json','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','cancelled','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Missing\x20id\x20or\x20shortLink\x20in\x20response','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','PAID','now','458992tPIPVW','created','===\x20PARSED\x20NODA\x20RESPONSE\x20===','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','80DNvrus','===\x20NODA\x20API\x20ERROR\x20===','URL:','message','NodaService','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Status\x20Text:','apiUrl','verifyPayment','QR\x20Code\x20Link:','error','2439613EGNhte','text','42024JaoEPR','json','qrCodeLink','Response\x20Time:','8603ElwidJ','BankId','rejected','Name','active','7888aibOZq','status','Failed\x20to\x20parse\x20JSON\x20response:','__esModule','===\x20NODA\x20SUCCESS\x20===','108TGCvis','Method','entries','Status\x20Code:','===\x20NODA\x20SERVICE\x20ERROR\x20===','Noda\x20payment\x20verification\x20error:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','logWhiteDomainResponse','stringify','Short\x20Link:','loggerService','isActive','FAILED','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Error\x20message:','Request\x20Body\x20(Direct\x20JSON):','amount','Unknown\x20error','TesSoft\x20Payment\x20System/1.0','EXPIRED','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='];a43_0x5d76=function(){return _0x15c3b2;};return a43_0x5d76();}(function(_0x30303e,_0x26fc00){const _0x44b4ca=a43_0x2342,_0xd1ac2=_0x30303e();while(!![]){try{const _0x202192=parseInt(_0x44b4ca(0x222))/0x1+parseInt(_0x44b4ca(0x1c7))/0x2*(-parseInt(_0x44b4ca(0x205))/0x3)+parseInt(_0x44b4ca(0x211))/0x4+-parseInt(_0x44b4ca(0x1e7))/0x5+parseInt(_0x44b4ca(0x1fd))/0x6*(-parseInt(_0x44b4ca(0x226))/0x7)+parseInt(_0x44b4ca(0x22b))/0x8*(parseInt(_0x44b4ca(0x230))/0x9)+-parseInt(_0x44b4ca(0x215))/0xa*(-parseInt(_0x44b4ca(0x220))/0xb);if(_0x202192===_0x26fc00)break;else _0xd1ac2['push'](_0xd1ac2['shift']());}catch(_0x43512c){_0xd1ac2['push'](_0xd1ac2['shift']());}}}(a43_0x5d76,0x4be7b));Object[a43_0x3a0069(0x1dc)](exports,a43_0x3a0069(0x22e),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a43_0x3a0069(0x1ed));function a43_0x2342(_0x4b37e7,_0x1147fa){const _0x5d76c0=a43_0x5d76();return a43_0x2342=function(_0x234253,_0x1266b7){_0x234253=_0x234253-0x1c3;let _0x253cdf=_0x5d76c0[_0x234253];return _0x253cdf;},a43_0x2342(_0x4b37e7,_0x1147fa);}class NodaService{constructor(){const _0x9f283c=a43_0x3a0069;this['apiUrl']='https://tesoft.uk/gateway/noda/',console[_0x9f283c(0x1cc)](_0x9f283c(0x214));}async[a43_0x3a0069(0x1f5)](_0x3d0f48){const _0x17035b=a43_0x3a0069,{orderId:_0x36fdce,name:_0x2ac55d,paymentDescription:_0x24d27f,amount:_0x41a4ae,currency:_0x32034b,webhookUrl:_0x59a1f3,returnUrl:_0x2eb056,expiryDate:_0x2d7794}=_0x3d0f48,_0x382258=_0x32034b['toUpperCase'](),_0x2b7812='https://tesoft.uk/gateway/noda/webhook/',_0x2beaa4=_0x17035b(0x1fe)+_0x36fdce,_0x556ffb={'name':_0x2ac55d,'paymentDescription':_0x24d27f,'amount':_0x41a4ae,'currency':_0x382258,'paymentId':_0x36fdce,'webhookUrl':_0x2b7812,'returnUrl':_0x2beaa4};_0x2d7794&&(_0x556ffb[_0x17035b(0x1cf)]=_0x2d7794);const _0x4ece7c=Date[_0x17035b(0x210)]();try{console[_0x17035b(0x1cc)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x17035b(0x1cc)](_0x17035b(0x217),this[_0x17035b(0x21c)]),console[_0x17035b(0x1cc)](_0x17035b(0x23f),JSON[_0x17035b(0x238)](_0x556ffb,null,0x2)),console[_0x17035b(0x1cc)]('Order\x20ID\x20Format:',_0x36fdce,_0x17035b(0x1df)),console['log'](_0x17035b(0x21a),_0x2beaa4),loggerService_1[_0x17035b(0x23a)]['logWhiteDomainRequest'](_0x17035b(0x1dd),_0x17035b(0x206),_0x17035b(0x202),_0x556ffb);const _0x395fcd=await fetch(this[_0x17035b(0x21c)],{'method':'POST','headers':{'Content-Type':_0x17035b(0x209),'Accept':'application/json','User-Agent':_0x17035b(0x1c4)},'body':JSON['stringify'](_0x556ffb)}),_0x480da1=Date['now']()-_0x4ece7c;console['log'](_0x17035b(0x1de)),console[_0x17035b(0x1cc)](_0x17035b(0x1d4),_0x395fcd[_0x17035b(0x22c)]),console[_0x17035b(0x1cc)](_0x17035b(0x21b),_0x395fcd[_0x17035b(0x1e1)]),console[_0x17035b(0x1cc)](_0x17035b(0x1d7),Object['fromEntries'](_0x395fcd[_0x17035b(0x1ce)][_0x17035b(0x232)]())),console['log'](_0x17035b(0x225),_0x480da1+'ms');const _0x987bf7=await _0x395fcd[_0x17035b(0x221)]();console[_0x17035b(0x1cc)](_0x17035b(0x1f6),_0x987bf7);if(!_0x395fcd['ok']){console[_0x17035b(0x21f)](_0x17035b(0x216)),console[_0x17035b(0x21f)]('HTTP\x20Status:',_0x395fcd['status']),console[_0x17035b(0x21f)]('Response\x20Body:',_0x987bf7),loggerService_1[_0x17035b(0x23a)][_0x17035b(0x237)](_0x17035b(0x1dd),_0x17035b(0x206),_0x395fcd[_0x17035b(0x22c)],_0x987bf7,_0x480da1),loggerService_1[_0x17035b(0x23a)]['logWhiteDomainError'](_0x17035b(0x1dd),'/payment-links',_0x17035b(0x1eb)+_0x395fcd[_0x17035b(0x22c)]+':\x20'+_0x987bf7);if(_0x395fcd['status']===0x190)throw new Error(_0x17035b(0x236));else{if(_0x395fcd[_0x17035b(0x22c)]===0x1f4)throw new Error(_0x17035b(0x23d));}throw new Error(_0x17035b(0x208)+_0x395fcd['status']+_0x17035b(0x1f7)+_0x987bf7);}let _0x59b260;try{_0x59b260=JSON['parse'](_0x987bf7);}catch(_0x14cf84){console[_0x17035b(0x21f)](_0x17035b(0x22d),_0x14cf84),loggerService_1[_0x17035b(0x23a)][_0x17035b(0x1e4)]('noda','/payment-links','JSON\x20Parse\x20Error:\x20'+_0x14cf84);throw new Error(_0x17035b(0x1d6)+_0x987bf7);}console[_0x17035b(0x1cc)](_0x17035b(0x213)),console['log']('Parsed\x20Result:',JSON[_0x17035b(0x238)](_0x59b260,null,0x2)),loggerService_1[_0x17035b(0x23a)][_0x17035b(0x237)](_0x17035b(0x1dd),_0x17035b(0x206),_0x395fcd[_0x17035b(0x22c)],_0x59b260,_0x480da1);if(_0x59b260[_0x17035b(0x21f)]||_0x59b260[_0x17035b(0x1d8)]){const _0x34ba20=_0x59b260[_0x17035b(0x218)]||_0x59b260[_0x17035b(0x21f)]||_0x17035b(0x1ef);console[_0x17035b(0x21f)](_0x17035b(0x20a)),console['error'](_0x17035b(0x1d9),_0x34ba20),console['error'](_0x17035b(0x233),_0x59b260['statusCode']),loggerService_1['loggerService'][_0x17035b(0x1e4)](_0x17035b(0x1dd),_0x17035b(0x206),'Business\x20Error:\x20'+_0x34ba20);throw new Error('Noda\x20API\x20error:\x20'+_0x34ba20);}if(!_0x59b260['id']||!_0x59b260[_0x17035b(0x204)]?.[_0x17035b(0x1c9)]){console[_0x17035b(0x21f)](_0x17035b(0x1c6)),console[_0x17035b(0x21f)](_0x17035b(0x20d)),console[_0x17035b(0x21f)]('Response\x20data:',_0x59b260),loggerService_1[_0x17035b(0x23a)][_0x17035b(0x1e4)](_0x17035b(0x1dd),'/payment-links',_0x17035b(0x1e0));throw new Error(_0x17035b(0x20e));}return console[_0x17035b(0x1cc)](_0x17035b(0x22f)),console[_0x17035b(0x1cc)](_0x17035b(0x1f0),_0x59b260['id']),console[_0x17035b(0x1cc)](_0x17035b(0x239),_0x59b260[_0x17035b(0x204)][_0x17035b(0x1c9)]),console['log'](_0x17035b(0x21e),_0x59b260[_0x17035b(0x204)][_0x17035b(0x224)]||'Not\x20provided'),console[_0x17035b(0x1cc)]('Order\x20ID\x20Used:',_0x36fdce,'(8digits-8digits\x20format)'),console[_0x17035b(0x1cc)](_0x17035b(0x200),_0x2beaa4),{'gateway_payment_id':_0x59b260['id'],'payment_url':_0x59b260[_0x17035b(0x204)][_0x17035b(0x1c9)],'qr_code_url':_0x59b260[_0x17035b(0x204)]['qrCodeLink'],'expiry_date':_0x59b260[_0x17035b(0x1cf)]};}catch(_0x31a409){console['error'](_0x17035b(0x234)),console[_0x17035b(0x21f)]('Error\x20details:',_0x31a409),loggerService_1[_0x17035b(0x23a)][_0x17035b(0x1e4)](_0x17035b(0x1dd),_0x17035b(0x206),_0x31a409);if(_0x31a409 instanceof Error){console['error'](_0x17035b(0x23e),_0x31a409['message']),console['error'](_0x17035b(0x201),_0x31a409[_0x17035b(0x1d3)]);throw new Error(_0x17035b(0x1e2)+_0x31a409[_0x17035b(0x218)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x3a0069(0x21d)](_0xa171c8){const _0x56a4dc=a43_0x3a0069,_0x48bb6f=Date[_0x56a4dc(0x210)]();try{loggerService_1[_0x56a4dc(0x23a)][_0x56a4dc(0x1ea)](_0x56a4dc(0x1dd),_0x56a4dc(0x1da)+_0xa171c8,'GET',{});const _0x242317=await fetch(this[_0x56a4dc(0x21c)]+'/'+_0xa171c8,{'method':_0x56a4dc(0x1d5),'headers':{'Content-Type':_0x56a4dc(0x209),'User-Agent':_0x56a4dc(0x1c4)}}),_0x2ee66b=Date[_0x56a4dc(0x210)]()-_0x48bb6f;if(!_0x242317['ok']){const _0x27814c=await _0x242317[_0x56a4dc(0x221)]();loggerService_1[_0x56a4dc(0x23a)][_0x56a4dc(0x237)]('noda',_0x56a4dc(0x1da)+_0xa171c8,_0x242317['status'],_0x27814c,_0x2ee66b);throw new Error(_0x56a4dc(0x208)+_0x242317[_0x56a4dc(0x22c)]);}const _0x2c15d5=await _0x242317[_0x56a4dc(0x223)]();loggerService_1[_0x56a4dc(0x23a)][_0x56a4dc(0x237)]('noda',_0x56a4dc(0x1da)+_0xa171c8,_0x242317[_0x56a4dc(0x22c)],_0x2c15d5,_0x2ee66b);if(_0x2c15d5[_0x56a4dc(0x21f)]||_0x2c15d5[_0x56a4dc(0x1d8)]){loggerService_1[_0x56a4dc(0x23a)][_0x56a4dc(0x1e4)](_0x56a4dc(0x1dd),_0x56a4dc(0x1da)+_0xa171c8,_0x56a4dc(0x1cb)+(_0x2c15d5[_0x56a4dc(0x218)]||_0x2c15d5[_0x56a4dc(0x21f)]||_0x56a4dc(0x1c3)));throw new Error('Noda\x20API\x20error:\x20'+(_0x2c15d5[_0x56a4dc(0x218)]||_0x2c15d5[_0x56a4dc(0x21f)]||_0x56a4dc(0x1c3)));}let _0x5c996b=_0x56a4dc(0x1f2);if(_0x2c15d5[_0x56a4dc(0x23b)]===![]){if(_0x2c15d5[_0x56a4dc(0x1cf)]){const _0x190ecd=new Date(_0x2c15d5['expiryDate']),_0x3850ae=new Date();_0x190ecd<_0x3850ae?_0x5c996b=_0x56a4dc(0x1c5):_0x5c996b=_0x56a4dc(0x23c);}else _0x5c996b=_0x56a4dc(0x23c);}else _0x5c996b=_0x56a4dc(0x1f2);return{'status':_0x5c996b,'amount':_0x2c15d5[_0x56a4dc(0x240)],'currency':_0x2c15d5[_0x56a4dc(0x1e3)],'isActive':_0x2c15d5[_0x56a4dc(0x23b)]};}catch(_0x3c366f){console[_0x56a4dc(0x21f)](_0x56a4dc(0x235),_0x3c366f),loggerService_1['loggerService'][_0x56a4dc(0x1e4)](_0x56a4dc(0x1dd),_0x56a4dc(0x1da)+_0xa171c8,_0x3c366f);throw new Error(_0x56a4dc(0x20c)+(_0x3c366f instanceof Error?_0x3c366f[_0x56a4dc(0x218)]:_0x56a4dc(0x1c3)));}}async['processWebhook'](_0x3647a9){const _0x3bcb18=a43_0x3a0069;console['log'](_0x3bcb18(0x1e6),_0x3647a9);let _0x2b853e='PENDING';switch(_0x3647a9[_0x3bcb18(0x1ca)]?.[_0x3bcb18(0x1f8)]()){case _0x3bcb18(0x1fa):case _0x3bcb18(0x1e8):case _0x3bcb18(0x1fc):case _0x3bcb18(0x1ff):case _0x3bcb18(0x1d2):_0x3647a9[_0x3bcb18(0x1fb)]==='Yes'?_0x2b853e=_0x3bcb18(0x20f):_0x2b853e=_0x3bcb18(0x1f2);break;case _0x3bcb18(0x20b):case'canceled':case _0x3bcb18(0x203):case'error':case _0x3bcb18(0x228):_0x2b853e=_0x3bcb18(0x23c);break;case _0x3bcb18(0x1e9):case _0x3bcb18(0x1ee):_0x2b853e=_0x3bcb18(0x1c5);break;case'pending':case _0x3bcb18(0x212):case _0x3bcb18(0x22a):case _0x3bcb18(0x1c8):case _0x3bcb18(0x1f9):default:_0x2b853e=_0x3bcb18(0x1f2);break;}return{'paymentId':_0x3647a9[_0x3bcb18(0x1db)]||_0x3647a9[_0x3bcb18(0x1f4)],'status':_0x2b853e,'amount':_0x3647a9[_0x3bcb18(0x1f1)],'currency':_0x3647a9[_0x3bcb18(0x1ec)],'additionalInfo':{'method':_0x3647a9[_0x3bcb18(0x231)],'bankId':_0x3647a9[_0x3bcb18(0x227)],'settled':_0x3647a9[_0x3bcb18(0x1fb)],'settlementDate':_0x3647a9[_0x3bcb18(0x1f3)],'remitterName':_0x3647a9[_0x3bcb18(0x207)]?.[_0x3bcb18(0x229)],'remitterIban':_0x3647a9['Remitter']?.[_0x3bcb18(0x1d1)],'bankTransactionId':_0x3647a9[_0x3bcb18(0x1e5)]}};}[a43_0x3a0069(0x1d0)](_0x41e206,_0x441050){const _0x22d68d=a43_0x3a0069;return console[_0x22d68d(0x1cc)](_0x22d68d(0x1cd),{'receivedSignature':_0x441050,'paymentId':_0x41e206[_0x22d68d(0x1f4)],'merchantPaymentId':_0x41e206[_0x22d68d(0x1db)]}),!![];}}exports[a43_0x3a0069(0x219)]=NodaService;