'use strict';const a53_0x4adaf1=a53_0x4663;(function(_0x311fd3,_0x4853bf){const _0x33bf12=a53_0x4663,_0x49aeb1=_0x311fd3();while(!![]){try{const _0x593b88=parseInt(_0x33bf12(0xed))/0x1+-parseInt(_0x33bf12(0x10b))/0x2+-parseInt(_0x33bf12(0xf6))/0x3*(parseInt(_0x33bf12(0x121))/0x4)+-parseInt(_0x33bf12(0xe4))/0x5*(-parseInt(_0x33bf12(0x144))/0x6)+-parseInt(_0x33bf12(0x112))/0x7*(parseInt(_0x33bf12(0x115))/0x8)+parseInt(_0x33bf12(0x119))/0x9*(parseInt(_0x33bf12(0x150))/0xa)+parseInt(_0x33bf12(0x13a))/0xb;if(_0x593b88===_0x4853bf)break;else _0x49aeb1['push'](_0x49aeb1['shift']());}catch(_0xb7c7aa){_0x49aeb1['push'](_0x49aeb1['shift']());}}}(a53_0x31ee,0xc62b2));function a53_0x4663(_0x47abab,_0x1b91a5){const _0x31ee18=a53_0x31ee();return a53_0x4663=function(_0x4663fd,_0x37b844){_0x4663fd=_0x4663fd-0xe3;let _0x3d9884=_0x31ee18[_0x4663fd];return _0x3d9884;},a53_0x4663(_0x47abab,_0x1b91a5);}Object[a53_0x4adaf1(0x126)](exports,a53_0x4adaf1(0xe9),{'value':!![]}),exports['NodaService']=void 0x0;function a53_0x31ee(){const _0x4c2d82=['Remitter','successful','MerchantPaymentId','414jLmYGQ','https://tesoft.uk/gateway/noda/webhook/','Status:','POST','status','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Payment\x20System/1.0','Name','17828zaSgUY','HTTP\x20','(8digits-8digits\x20format)','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','loggerService','defineProperty','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Response\x20Time:','stringify','now','noda','Error\x20details:','EXPIRED','Raw\x20Response\x20Body:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Short\x20Link:','apiUrl','Request\x20Body\x20(Direct\x20JSON):','Iban','Noda\x20payment\x20verification\x20error:','Noda\x20API\x20error:\x20','shortLink','statusText','NodaService','PAID','8977375eCKBrr','headers','paid','logWhiteDomainResponse','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','pending','Status\x20Code:','Noda\x20webhook\x20signature\x20verification:','statusCode','createPaymentLink','24YAVsXj','completed','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','URL:','expiryDate','Missing\x20id\x20or\x20shortLink\x20in\x20response','SettlementDate','HTTP\x20Status:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Error\x20message:','/payment-links','Settled','54260SACOuz','logWhiteDomainError','HTTP\x20error!\x20status:\x20','BankId','/payment-links/','Response\x20Body:','===\x20NODA\x20SERVICE\x20ERROR\x20===','956315pqjOLE','Failed\x20to\x20verify\x20Noda\x20payment:\x20','logWhiteDomainRequest','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','done','__esModule','failed','../loggerService','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','694389PlKyQO','Parsed\x20Result:','processWebhook','success','GET','PaymentId','Processing\x20Noda\x20webhook:','FAILED','QR\x20Code\x20Link:','423JZPVFc','log','shortLinkUrls','message','in_progress','error','toLowerCase','Unknown\x20error\x20from\x20Noda\x20API','Order\x20ID\x20Used:','qrCodeLink','===\x20NODA\x20API\x20ERROR\x20===','Business\x20Error:\x20','Amount','isActive','verifyPayment','PENDING','json','created','Unknown\x20error','application/json','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','843986ZsFlet','Failed\x20to\x20parse\x20JSON\x20response:','fromEntries','Method',',\x20body:\x20','Currency','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','4641238NgqUMd','(8digits-8digits\x20format\x20for\x20Noda)','https://tesoft.uk/gateway/noda/','8UuqoYG'];a53_0x31ee=function(){return _0x4c2d82;};return a53_0x31ee();}const loggerService_1=require(a53_0x4adaf1(0xeb));class NodaService{constructor(){const _0x505abd=a53_0x4adaf1;this['apiUrl']=_0x505abd(0x114),console[_0x505abd(0xf7)](_0x505abd(0xec));}async[a53_0x4adaf1(0x143)](_0x455db5){const _0x1ef2b9=a53_0x4adaf1,{orderId:_0x50ca2d,name:_0x1b2169,paymentDescription:_0x3eba93,amount:_0x438cb8,currency:_0x45781d,webhookUrl:_0x3be28d,returnUrl:_0x5acf7a,expiryDate:_0xd54d81}=_0x455db5,_0x4342f6=_0x45781d['toUpperCase'](),_0x12cf0c=_0x1ef2b9(0x11a),_0x43e4d2='https://tesoft.uk/gateway/pending.php?id='+_0x50ca2d,_0x471eea={'name':_0x1b2169,'paymentDescription':_0x3eba93,'amount':_0x438cb8,'currency':_0x4342f6,'paymentId':_0x50ca2d,'webhookUrl':_0x12cf0c,'returnUrl':_0x43e4d2};_0xd54d81&&(_0x471eea['expiryDate']=_0xd54d81);const _0xf56f38=Date[_0x1ef2b9(0x12a)]();try{console[_0x1ef2b9(0xf7)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x1ef2b9(0xf7)](_0x1ef2b9(0x147),this[_0x1ef2b9(0x131)]),console['log'](_0x1ef2b9(0x132),JSON[_0x1ef2b9(0x129)](_0x471eea,null,0x2)),console['log']('Order\x20ID\x20Format:',_0x50ca2d,_0x1ef2b9(0x113)),console['log'](_0x1ef2b9(0x124),_0x43e4d2),loggerService_1[_0x1ef2b9(0x125)][_0x1ef2b9(0xe6)](_0x1ef2b9(0x12b),_0x1ef2b9(0x14e),_0x1ef2b9(0x11c),_0x471eea);const _0x556723=await fetch(this[_0x1ef2b9(0x131)],{'method':_0x1ef2b9(0x11c),'headers':{'Content-Type':_0x1ef2b9(0x109),'Accept':_0x1ef2b9(0x109),'User-Agent':_0x1ef2b9(0x11f)},'body':JSON[_0x1ef2b9(0x129)](_0x471eea)}),_0xe814ea=Date['now']()-_0xf56f38;console[_0x1ef2b9(0xf7)](_0x1ef2b9(0x111)),console[_0x1ef2b9(0xf7)](_0x1ef2b9(0x11b),_0x556723['status']),console['log']('Status\x20Text:',_0x556723[_0x1ef2b9(0x137)]),console[_0x1ef2b9(0xf7)]('Headers:',Object[_0x1ef2b9(0x10d)](_0x556723[_0x1ef2b9(0x13b)]['entries']())),console[_0x1ef2b9(0xf7)](_0x1ef2b9(0x128),_0xe814ea+'ms');const _0x4cc402=await _0x556723['text']();console[_0x1ef2b9(0xf7)](_0x1ef2b9(0x12e),_0x4cc402);if(!_0x556723['ok']){console[_0x1ef2b9(0xfb)](_0x1ef2b9(0x100)),console[_0x1ef2b9(0xfb)](_0x1ef2b9(0x14b),_0x556723[_0x1ef2b9(0x11d)]),console[_0x1ef2b9(0xfb)](_0x1ef2b9(0x155),_0x4cc402),loggerService_1[_0x1ef2b9(0x125)]['logWhiteDomainResponse'](_0x1ef2b9(0x12b),_0x1ef2b9(0x14e),_0x556723['status'],_0x4cc402,_0xe814ea),loggerService_1[_0x1ef2b9(0x125)][_0x1ef2b9(0x151)](_0x1ef2b9(0x12b),'/payment-links',_0x1ef2b9(0x122)+_0x556723[_0x1ef2b9(0x11d)]+':\x20'+_0x4cc402);if(_0x556723['status']===0x190)throw new Error(_0x1ef2b9(0x146));else{if(_0x556723[_0x1ef2b9(0x11d)]===0x1f4)throw new Error(_0x1ef2b9(0x12f));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x556723[_0x1ef2b9(0x11d)]+_0x1ef2b9(0x10f)+_0x4cc402);}let _0x15dc77;try{_0x15dc77=JSON['parse'](_0x4cc402);}catch(_0x3af0f4){console[_0x1ef2b9(0xfb)](_0x1ef2b9(0x10c),_0x3af0f4),loggerService_1[_0x1ef2b9(0x125)][_0x1ef2b9(0x151)](_0x1ef2b9(0x12b),_0x1ef2b9(0x14e),'JSON\x20Parse\x20Error:\x20'+_0x3af0f4);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x4cc402);}console[_0x1ef2b9(0xf7)](_0x1ef2b9(0x14c)),console[_0x1ef2b9(0xf7)](_0x1ef2b9(0xee),JSON['stringify'](_0x15dc77,null,0x2)),loggerService_1[_0x1ef2b9(0x125)][_0x1ef2b9(0x13d)](_0x1ef2b9(0x12b),'/payment-links',_0x556723[_0x1ef2b9(0x11d)],_0x15dc77,_0xe814ea);if(_0x15dc77[_0x1ef2b9(0xfb)]||_0x15dc77[_0x1ef2b9(0x142)]){const _0x5db5e0=_0x15dc77[_0x1ef2b9(0xf9)]||_0x15dc77['error']||_0x1ef2b9(0xfd);console['error'](_0x1ef2b9(0xe7)),console[_0x1ef2b9(0xfb)]('Error\x20Message:',_0x5db5e0),console[_0x1ef2b9(0xfb)](_0x1ef2b9(0x140),_0x15dc77[_0x1ef2b9(0x142)]),loggerService_1[_0x1ef2b9(0x125)][_0x1ef2b9(0x151)]('noda','/payment-links',_0x1ef2b9(0x101)+_0x5db5e0);throw new Error('Noda\x20API\x20error:\x20'+_0x5db5e0);}if(!_0x15dc77['id']||!_0x15dc77[_0x1ef2b9(0xf8)]?.['shortLink']){console[_0x1ef2b9(0xfb)](_0x1ef2b9(0x11e)),console[_0x1ef2b9(0xfb)](_0x1ef2b9(0x149)),console['error']('Response\x20data:',_0x15dc77),loggerService_1[_0x1ef2b9(0x125)]['logWhiteDomainError'](_0x1ef2b9(0x12b),_0x1ef2b9(0x14e),_0x1ef2b9(0x13e));throw new Error(_0x1ef2b9(0x127));}return console[_0x1ef2b9(0xf7)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x1ef2b9(0xf7)]('Payment\x20Link\x20ID:',_0x15dc77['id']),console[_0x1ef2b9(0xf7)](_0x1ef2b9(0x130),_0x15dc77[_0x1ef2b9(0xf8)]['shortLink']),console[_0x1ef2b9(0xf7)](_0x1ef2b9(0xf5),_0x15dc77[_0x1ef2b9(0xf8)]['qrCodeLink']||'Not\x20provided'),console[_0x1ef2b9(0xf7)](_0x1ef2b9(0xfe),_0x50ca2d,_0x1ef2b9(0x123)),console[_0x1ef2b9(0xf7)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x43e4d2),{'gateway_payment_id':_0x15dc77['id'],'payment_url':_0x15dc77['shortLinkUrls'][_0x1ef2b9(0x136)],'qr_code_url':_0x15dc77[_0x1ef2b9(0xf8)][_0x1ef2b9(0xff)],'expiry_date':_0x15dc77[_0x1ef2b9(0x148)]};}catch(_0x3ea6eb){console[_0x1ef2b9(0xfb)](_0x1ef2b9(0xe3)),console[_0x1ef2b9(0xfb)](_0x1ef2b9(0x12c),_0x3ea6eb),loggerService_1['loggerService']['logWhiteDomainError'](_0x1ef2b9(0x12b),_0x1ef2b9(0x14e),_0x3ea6eb);if(_0x3ea6eb instanceof Error){console[_0x1ef2b9(0xfb)](_0x1ef2b9(0x14d),_0x3ea6eb[_0x1ef2b9(0xf9)]),console[_0x1ef2b9(0xfb)]('Error\x20stack:',_0x3ea6eb['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x3ea6eb[_0x1ef2b9(0xf9)]);}throw new Error(_0x1ef2b9(0x10a));}}async[a53_0x4adaf1(0x104)](_0x12ea23){const _0x4d1bd0=a53_0x4adaf1,_0x4575d0=Date[_0x4d1bd0(0x12a)]();try{loggerService_1[_0x4d1bd0(0x125)]['logWhiteDomainRequest'](_0x4d1bd0(0x12b),_0x4d1bd0(0x154)+_0x12ea23,_0x4d1bd0(0xf1),{});const _0x168946=await fetch(this[_0x4d1bd0(0x131)]+'/'+_0x12ea23,{'method':_0x4d1bd0(0xf1),'headers':{'Content-Type':_0x4d1bd0(0x109),'User-Agent':'Payment\x20System/1.0'}}),_0x5c2438=Date[_0x4d1bd0(0x12a)]()-_0x4575d0;if(!_0x168946['ok']){const _0x1942d4=await _0x168946['text']();loggerService_1[_0x4d1bd0(0x125)][_0x4d1bd0(0x13d)]('noda',_0x4d1bd0(0x154)+_0x12ea23,_0x168946[_0x4d1bd0(0x11d)],_0x1942d4,_0x5c2438);throw new Error(_0x4d1bd0(0x152)+_0x168946[_0x4d1bd0(0x11d)]);}const _0x6ff8f9=await _0x168946[_0x4d1bd0(0x106)]();loggerService_1['loggerService'][_0x4d1bd0(0x13d)](_0x4d1bd0(0x12b),_0x4d1bd0(0x154)+_0x12ea23,_0x168946[_0x4d1bd0(0x11d)],_0x6ff8f9,_0x5c2438);if(_0x6ff8f9[_0x4d1bd0(0xfb)]||_0x6ff8f9['statusCode']){loggerService_1[_0x4d1bd0(0x125)][_0x4d1bd0(0x151)]('noda',_0x4d1bd0(0x154)+_0x12ea23,_0x4d1bd0(0x135)+(_0x6ff8f9['message']||_0x6ff8f9[_0x4d1bd0(0xfb)]||_0x4d1bd0(0x108)));throw new Error(_0x4d1bd0(0x135)+(_0x6ff8f9[_0x4d1bd0(0xf9)]||_0x6ff8f9[_0x4d1bd0(0xfb)]||_0x4d1bd0(0x108)));}let _0x553bfc=_0x4d1bd0(0x105);if(_0x6ff8f9[_0x4d1bd0(0x103)]===![]){if(_0x6ff8f9['expiryDate']){const _0x323862=new Date(_0x6ff8f9[_0x4d1bd0(0x148)]),_0x413372=new Date();_0x323862<_0x413372?_0x553bfc='EXPIRED':_0x553bfc=_0x4d1bd0(0xf4);}else _0x553bfc='FAILED';}else _0x553bfc=_0x4d1bd0(0x105);return{'status':_0x553bfc,'amount':_0x6ff8f9['amount'],'currency':_0x6ff8f9['currency'],'isActive':_0x6ff8f9[_0x4d1bd0(0x103)]};}catch(_0x3d5ae1){console[_0x4d1bd0(0xfb)](_0x4d1bd0(0x134),_0x3d5ae1),loggerService_1[_0x4d1bd0(0x125)][_0x4d1bd0(0x151)](_0x4d1bd0(0x12b),_0x4d1bd0(0x154)+_0x12ea23,_0x3d5ae1);throw new Error(_0x4d1bd0(0xe5)+(_0x3d5ae1 instanceof Error?_0x3d5ae1[_0x4d1bd0(0xf9)]:_0x4d1bd0(0x108)));}}async[a53_0x4adaf1(0xef)](_0x7fbbc3){const _0x14cfd4=a53_0x4adaf1;console[_0x14cfd4(0xf7)](_0x14cfd4(0xf3),_0x7fbbc3);let _0x349665=_0x14cfd4(0x105);switch(_0x7fbbc3['Status']?.[_0x14cfd4(0xfc)]()){case _0x14cfd4(0xe8):case _0x14cfd4(0x145):case _0x14cfd4(0x13c):case _0x14cfd4(0xf0):case _0x14cfd4(0x117):_0x7fbbc3[_0x14cfd4(0x14f)]==='Yes'?_0x349665=_0x14cfd4(0x139):_0x349665='PENDING';break;case'cancelled':case'canceled':case _0x14cfd4(0xea):case _0x14cfd4(0xfb):case'rejected':_0x349665='FAILED';break;case'expired':case'timeout':_0x349665=_0x14cfd4(0x12d);break;case _0x14cfd4(0x13f):case _0x14cfd4(0x107):case'active':case'processing':case _0x14cfd4(0xfa):default:_0x349665='PENDING';break;}return{'paymentId':_0x7fbbc3[_0x14cfd4(0x118)]||_0x7fbbc3[_0x14cfd4(0xf2)],'status':_0x349665,'amount':_0x7fbbc3[_0x14cfd4(0x102)],'currency':_0x7fbbc3[_0x14cfd4(0x110)],'additionalInfo':{'method':_0x7fbbc3[_0x14cfd4(0x10e)],'bankId':_0x7fbbc3[_0x14cfd4(0x153)],'settled':_0x7fbbc3[_0x14cfd4(0x14f)],'settlementDate':_0x7fbbc3[_0x14cfd4(0x14a)],'remitterName':_0x7fbbc3[_0x14cfd4(0x116)]?.[_0x14cfd4(0x120)],'remitterIban':_0x7fbbc3['Remitter']?.[_0x14cfd4(0x133)],'bankTransactionId':_0x7fbbc3['BankTransactionId']}};}['verifyWebhookSignature'](_0x26f019,_0xc69d9){const _0x5088e0=a53_0x4adaf1;return console['log'](_0x5088e0(0x141),{'receivedSignature':_0xc69d9,'paymentId':_0x26f019[_0x5088e0(0xf2)],'merchantPaymentId':_0x26f019['MerchantPaymentId']}),!![];}}exports[a53_0x4adaf1(0x138)]=NodaService;