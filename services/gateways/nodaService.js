'use strict';function a71_0x30f6(_0x2a6381,_0x317f78){_0x2a6381=_0x2a6381-0x10a;const _0x5b2a49=a71_0x5b2a();let _0x30f611=_0x5b2a49[_0x2a6381];return _0x30f611;}const a71_0x13045d=a71_0x30f6;(function(_0x5d8b54,_0x126bb7){const _0x4d3f6c=a71_0x30f6,_0x268de2=_0x5d8b54();while(!![]){try{const _0x512357=parseInt(_0x4d3f6c(0x179))/0x1+-parseInt(_0x4d3f6c(0x153))/0x2*(parseInt(_0x4d3f6c(0x138))/0x3)+parseInt(_0x4d3f6c(0x16c))/0x4*(parseInt(_0x4d3f6c(0x158))/0x5)+parseInt(_0x4d3f6c(0x13f))/0x6*(parseInt(_0x4d3f6c(0x13d))/0x7)+parseInt(_0x4d3f6c(0x164))/0x8+-parseInt(_0x4d3f6c(0x117))/0x9+-parseInt(_0x4d3f6c(0x152))/0xa;if(_0x512357===_0x126bb7)break;else _0x268de2['push'](_0x268de2['shift']());}catch(_0x4826e7){_0x268de2['push'](_0x268de2['shift']());}}}(a71_0x5b2a,0x29a77));Object[a71_0x13045d(0x175)](exports,a71_0x13045d(0x131),{'value':!![]}),exports[a71_0x13045d(0x112)]=void 0x0;const loggerService_1=require(a71_0x13045d(0x162));class NodaService{constructor(){const _0x310cce=a71_0x13045d;this['apiUrl']=_0x310cce(0x16a),console[_0x310cce(0x11f)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a71_0x13045d(0x174)](_0x36ddbf){const _0x22dd9e=a71_0x13045d,{orderId:_0x18d084,name:_0x1eb37a,paymentDescription:_0x5b05b7,amount:_0x325f06,currency:_0x3bba9e,webhookUrl:_0x3ec16e,returnUrl:_0xe89063,expiryDate:_0x579a04}=_0x36ddbf,_0x2a00cf=_0x3bba9e[_0x22dd9e(0x139)](),_0x34d9c4=_0x22dd9e(0x17b),_0x2ff6ac=_0x22dd9e(0x156)+_0x18d084,_0x329c12={'name':_0x1eb37a,'paymentDescription':_0x5b05b7,'amount':_0x325f06,'currency':_0x2a00cf,'paymentId':_0x18d084,'webhookUrl':_0x34d9c4,'returnUrl':_0x2ff6ac};_0x579a04&&(_0x329c12[_0x22dd9e(0x14c)]=_0x579a04);const _0x54a3f8=Date[_0x22dd9e(0x12e)]();try{console[_0x22dd9e(0x11f)](_0x22dd9e(0x181)),console['log'](_0x22dd9e(0x113),this[_0x22dd9e(0x145)]),console[_0x22dd9e(0x11f)](_0x22dd9e(0x150),JSON['stringify'](_0x329c12,null,0x2)),console['log']('Order\x20ID\x20Format:',_0x18d084,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x22dd9e(0x11f)](_0x22dd9e(0x11c),_0x2ff6ac),loggerService_1[_0x22dd9e(0x146)]['logWhiteDomainRequest']('noda',_0x22dd9e(0x154),_0x22dd9e(0x17c),_0x329c12);const _0x3393a9=await fetch(this['apiUrl'],{'method':_0x22dd9e(0x17c),'headers':{'Content-Type':_0x22dd9e(0x168),'Accept':_0x22dd9e(0x168),'User-Agent':_0x22dd9e(0x10e)},'body':JSON[_0x22dd9e(0x10c)](_0x329c12)}),_0x3ad139=Date[_0x22dd9e(0x12e)]()-_0x54a3f8;console[_0x22dd9e(0x11f)](_0x22dd9e(0x15e)),console[_0x22dd9e(0x11f)]('Status:',_0x3393a9[_0x22dd9e(0x129)]),console[_0x22dd9e(0x11f)](_0x22dd9e(0x130),_0x3393a9[_0x22dd9e(0x115)]),console['log'](_0x22dd9e(0x14e),Object[_0x22dd9e(0x126)](_0x3393a9[_0x22dd9e(0x12f)][_0x22dd9e(0x121)]())),console[_0x22dd9e(0x11f)](_0x22dd9e(0x13c),_0x3ad139+'ms');const _0x3f7b89=await _0x3393a9['text']();console[_0x22dd9e(0x11f)](_0x22dd9e(0x127),_0x3f7b89);if(!_0x3393a9['ok']){console[_0x22dd9e(0x157)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x22dd9e(0x157)](_0x22dd9e(0x123),_0x3393a9[_0x22dd9e(0x129)]),console[_0x22dd9e(0x157)](_0x22dd9e(0x17e),_0x3f7b89),loggerService_1['loggerService'][_0x22dd9e(0x169)](_0x22dd9e(0x176),_0x22dd9e(0x154),_0x3393a9[_0x22dd9e(0x129)],_0x3f7b89,_0x3ad139),loggerService_1[_0x22dd9e(0x146)][_0x22dd9e(0x163)](_0x22dd9e(0x176),_0x22dd9e(0x154),'HTTP\x20'+_0x3393a9[_0x22dd9e(0x129)]+':\x20'+_0x3f7b89);if(_0x3393a9[_0x22dd9e(0x129)]===0x190)throw new Error(_0x22dd9e(0x182));else{if(_0x3393a9[_0x22dd9e(0x129)]===0x1f4)throw new Error(_0x22dd9e(0x12b));}throw new Error(_0x22dd9e(0x142)+_0x3393a9[_0x22dd9e(0x129)]+',\x20body:\x20'+_0x3f7b89);}let _0x64cb8e;try{_0x64cb8e=JSON[_0x22dd9e(0x134)](_0x3f7b89);}catch(_0x538e1c){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x538e1c),loggerService_1[_0x22dd9e(0x146)][_0x22dd9e(0x163)](_0x22dd9e(0x176),_0x22dd9e(0x154),_0x22dd9e(0x15b)+_0x538e1c);throw new Error(_0x22dd9e(0x166)+_0x3f7b89);}console[_0x22dd9e(0x11f)](_0x22dd9e(0x136)),console[_0x22dd9e(0x11f)](_0x22dd9e(0x132),JSON['stringify'](_0x64cb8e,null,0x2)),loggerService_1[_0x22dd9e(0x146)][_0x22dd9e(0x169)](_0x22dd9e(0x176),_0x22dd9e(0x154),_0x3393a9[_0x22dd9e(0x129)],_0x64cb8e,_0x3ad139);if(_0x64cb8e['error']||_0x64cb8e[_0x22dd9e(0x120)]){const _0x1cf3e0=_0x64cb8e['message']||_0x64cb8e[_0x22dd9e(0x157)]||_0x22dd9e(0x159);console[_0x22dd9e(0x157)](_0x22dd9e(0x14d)),console[_0x22dd9e(0x157)](_0x22dd9e(0x170),_0x1cf3e0),console[_0x22dd9e(0x157)]('Status\x20Code:',_0x64cb8e[_0x22dd9e(0x120)]),loggerService_1[_0x22dd9e(0x146)][_0x22dd9e(0x163)](_0x22dd9e(0x176),_0x22dd9e(0x154),_0x22dd9e(0x17d)+_0x1cf3e0);throw new Error(_0x22dd9e(0x11a)+_0x1cf3e0);}if(!_0x64cb8e['id']||!_0x64cb8e[_0x22dd9e(0x167)]?.[_0x22dd9e(0x172)]){console[_0x22dd9e(0x157)](_0x22dd9e(0x16e)),console[_0x22dd9e(0x157)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console['error'](_0x22dd9e(0x165),_0x64cb8e),loggerService_1[_0x22dd9e(0x146)][_0x22dd9e(0x163)](_0x22dd9e(0x176),_0x22dd9e(0x154),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x22dd9e(0x178));}return console[_0x22dd9e(0x11f)](_0x22dd9e(0x119)),console[_0x22dd9e(0x11f)](_0x22dd9e(0x114),_0x64cb8e['id']),console[_0x22dd9e(0x11f)](_0x22dd9e(0x13e),_0x64cb8e[_0x22dd9e(0x167)][_0x22dd9e(0x172)]),console['log']('QR\x20Code\x20Link:',_0x64cb8e[_0x22dd9e(0x167)][_0x22dd9e(0x12a)]||_0x22dd9e(0x135)),console[_0x22dd9e(0x11f)](_0x22dd9e(0x177),_0x18d084,_0x22dd9e(0x116)),console['log'](_0x22dd9e(0x155),_0x2ff6ac),{'gateway_payment_id':_0x64cb8e['id'],'payment_url':_0x64cb8e['shortLinkUrls']['shortLink'],'qr_code_url':_0x64cb8e['shortLinkUrls'][_0x22dd9e(0x12a)],'expiry_date':_0x64cb8e[_0x22dd9e(0x14c)]};}catch(_0x3c51a0){console[_0x22dd9e(0x157)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x22dd9e(0x157)](_0x22dd9e(0x160),_0x3c51a0),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x22dd9e(0x154),_0x3c51a0);if(_0x3c51a0 instanceof Error){console['error'](_0x22dd9e(0x16d),_0x3c51a0[_0x22dd9e(0x173)]),console[_0x22dd9e(0x157)]('Error\x20stack:',_0x3c51a0[_0x22dd9e(0x180)]);throw new Error(_0x22dd9e(0x12c)+_0x3c51a0['message']);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a71_0x13045d(0x133)](_0x5f4f97){const _0x3e7dc7=a71_0x13045d,_0x52ae56=Date['now']();try{loggerService_1[_0x3e7dc7(0x146)][_0x3e7dc7(0x14f)](_0x3e7dc7(0x176),_0x3e7dc7(0x12d)+_0x5f4f97,_0x3e7dc7(0x111),{});const _0x3edb52=await fetch(this['apiUrl']+'/'+_0x5f4f97,{'method':_0x3e7dc7(0x111),'headers':{'Content-Type':_0x3e7dc7(0x168),'User-Agent':_0x3e7dc7(0x10e)}}),_0xf899d9=Date[_0x3e7dc7(0x12e)]()-_0x52ae56;if(!_0x3edb52['ok']){const _0x2d1e89=await _0x3edb52[_0x3e7dc7(0x110)]();loggerService_1['loggerService'][_0x3e7dc7(0x169)](_0x3e7dc7(0x176),_0x3e7dc7(0x12d)+_0x5f4f97,_0x3edb52[_0x3e7dc7(0x129)],_0x2d1e89,_0xf899d9);throw new Error(_0x3e7dc7(0x142)+_0x3edb52['status']);}const _0x41caed=await _0x3edb52['json']();loggerService_1[_0x3e7dc7(0x146)][_0x3e7dc7(0x169)](_0x3e7dc7(0x176),_0x3e7dc7(0x12d)+_0x5f4f97,_0x3edb52[_0x3e7dc7(0x129)],_0x41caed,_0xf899d9);if(_0x41caed[_0x3e7dc7(0x157)]||_0x41caed[_0x3e7dc7(0x120)]){loggerService_1[_0x3e7dc7(0x146)][_0x3e7dc7(0x163)](_0x3e7dc7(0x176),'/payment-links/'+_0x5f4f97,_0x3e7dc7(0x11a)+(_0x41caed[_0x3e7dc7(0x173)]||_0x41caed['error']||_0x3e7dc7(0x144)));throw new Error(_0x3e7dc7(0x11a)+(_0x41caed[_0x3e7dc7(0x173)]||_0x41caed[_0x3e7dc7(0x157)]||_0x3e7dc7(0x144)));}let _0x304d03=_0x3e7dc7(0x171);if(_0x41caed[_0x3e7dc7(0x122)]===![]){if(_0x41caed[_0x3e7dc7(0x14c)]){const _0x25fd63=new Date(_0x41caed[_0x3e7dc7(0x14c)]),_0x4de5e9=new Date();_0x25fd63<_0x4de5e9?_0x304d03=_0x3e7dc7(0x13b):_0x304d03=_0x3e7dc7(0x16b);}else _0x304d03='FAILED';}else _0x304d03=_0x3e7dc7(0x171);return{'status':_0x304d03,'amount':_0x41caed[_0x3e7dc7(0x17a)],'currency':_0x41caed[_0x3e7dc7(0x11b)],'isActive':_0x41caed['isActive']};}catch(_0x18b731){console[_0x3e7dc7(0x157)](_0x3e7dc7(0x16f),_0x18b731),loggerService_1[_0x3e7dc7(0x146)]['logWhiteDomainError']('noda',_0x3e7dc7(0x12d)+_0x5f4f97,_0x18b731);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x18b731 instanceof Error?_0x18b731[_0x3e7dc7(0x173)]:_0x3e7dc7(0x144)));}}async[a71_0x13045d(0x10a)](_0xb2548a){const _0x221dcc=a71_0x13045d;console[_0x221dcc(0x11f)](_0x221dcc(0x15c),_0xb2548a);let _0x5836e9='PENDING';switch(_0xb2548a['Status']?.[_0x221dcc(0x118)]()){case _0x221dcc(0x148):case'completed':case _0x221dcc(0x128):case _0x221dcc(0x161):case _0x221dcc(0x124):_0xb2548a[_0x221dcc(0x15f)]===_0x221dcc(0x140)?_0x5836e9=_0x221dcc(0x11e):_0x5836e9=_0x221dcc(0x171);break;case'cancelled':case'canceled':case _0x221dcc(0x149):case _0x221dcc(0x157):case _0x221dcc(0x10b):_0x5836e9='FAILED';break;case _0x221dcc(0x15d):case _0x221dcc(0x13a):_0x5836e9=_0x221dcc(0x13b);break;case'pending':case _0x221dcc(0x151):case _0x221dcc(0x15a):case'processing':case _0x221dcc(0x10f):default:_0x5836e9='PENDING';break;}return{'paymentId':_0xb2548a[_0x221dcc(0x14a)]||_0xb2548a[_0x221dcc(0x14b)],'status':_0x5836e9,'amount':_0xb2548a['Amount'],'currency':_0xb2548a[_0x221dcc(0x10d)],'additionalInfo':{'method':_0xb2548a['Method'],'bankId':_0xb2548a[_0x221dcc(0x141)],'settled':_0xb2548a['Settled'],'settlementDate':_0xb2548a[_0x221dcc(0x137)],'remitterName':_0xb2548a[_0x221dcc(0x125)]?.[_0x221dcc(0x17f)],'remitterIban':_0xb2548a['Remitter']?.[_0x221dcc(0x183)],'bankTransactionId':_0xb2548a[_0x221dcc(0x143)]}};}[a71_0x13045d(0x147)](_0x5c5660,_0x1add3b){const _0x3547b6=a71_0x13045d;return console[_0x3547b6(0x11f)](_0x3547b6(0x11d),{'receivedSignature':_0x1add3b,'paymentId':_0x5c5660[_0x3547b6(0x14b)],'merchantPaymentId':_0x5c5660['MerchantPaymentId']}),!![];}}exports[a71_0x13045d(0x112)]=NodaService;function a71_0x5b2a(){const _0x4f2cec=['All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','/payment-links/','now','headers','Status\x20Text:','__esModule','Parsed\x20Result:','verifyPayment','parse','Not\x20provided','===\x20PARSED\x20NODA\x20RESPONSE\x20===','SettlementDate','1004061KNvTTI','toUpperCase','timeout','EXPIRED','Response\x20Time:','28UZkHvJ','Short\x20Link:','393282SOdggI','Yes','BankId','HTTP\x20error!\x20status:\x20','BankTransactionId','Unknown\x20error','apiUrl','loggerService','verifyWebhookSignature','done','failed','MerchantPaymentId','PaymentId','expiryDate','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Headers:','logWhiteDomainRequest','Request\x20Body\x20(Direct\x20JSON):','created','2361010DryZIs','2RWDZTl','/payment-links','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','https://tesoft.uk/gateway/pending.php?id=','error','4690UEUXrp','Unknown\x20error\x20from\x20Noda\x20API','active','JSON\x20Parse\x20Error:\x20','Processing\x20Noda\x20webhook:','expired','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Settled','Error\x20details:','success','../loggerService','logWhiteDomainError','1694112KXkynz','Response\x20data:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','shortLinkUrls','application/json','logWhiteDomainResponse','https://tesoft.uk/gateway/noda/','FAILED','116QAwXCc','Error\x20message:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Noda\x20payment\x20verification\x20error:','Error\x20Message:','PENDING','shortLink','message','createPaymentLink','defineProperty','noda','Order\x20ID\x20Used:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','333602IWlTZb','amount','https://tesoft.uk/gateway/noda/webhook/','POST','Business\x20Error:\x20','Response\x20Body:','Name','stack','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Iban','processWebhook','rejected','stringify','Currency','Payment\x20System/1.0','in_progress','text','GET','NodaService','URL:','Payment\x20Link\x20ID:','statusText','(8digits-8digits\x20format)','840177plMGFb','toLowerCase','===\x20NODA\x20SUCCESS\x20===','Noda\x20API\x20error:\x20','currency','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Noda\x20webhook\x20signature\x20verification:','PAID','log','statusCode','entries','isActive','HTTP\x20Status:','successful','Remitter','fromEntries','Raw\x20Response\x20Body:','paid','status','qrCodeLink'];a71_0x5b2a=function(){return _0x4f2cec;};return a71_0x5b2a();}