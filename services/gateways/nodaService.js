'use strict';const a43_0x13584a=a43_0xf337;function a43_0xf337(_0x34e26a,_0x53cf24){const _0x361896=a43_0x3618();return a43_0xf337=function(_0xf337db,_0x35dbd8){_0xf337db=_0xf337db-0x7f;let _0x29c42c=_0x361896[_0xf337db];return _0x29c42c;},a43_0xf337(_0x34e26a,_0x53cf24);}(function(_0x254e3c,_0x2fcf1c){const _0x1bd9c3=a43_0xf337,_0x5cd908=_0x254e3c();while(!![]){try{const _0x229766=-parseInt(_0x1bd9c3(0x95))/0x1*(parseInt(_0x1bd9c3(0xb9))/0x2)+parseInt(_0x1bd9c3(0xc9))/0x3*(parseInt(_0x1bd9c3(0xc4))/0x4)+-parseInt(_0x1bd9c3(0xcb))/0x5+parseInt(_0x1bd9c3(0xc3))/0x6*(-parseInt(_0x1bd9c3(0xca))/0x7)+parseInt(_0x1bd9c3(0xa0))/0x8*(parseInt(_0x1bd9c3(0xe6))/0x9)+-parseInt(_0x1bd9c3(0x94))/0xa*(parseInt(_0x1bd9c3(0xa8))/0xb)+parseInt(_0x1bd9c3(0xe0))/0xc;if(_0x229766===_0x2fcf1c)break;else _0x5cd908['push'](_0x5cd908['shift']());}catch(_0x388091){_0x5cd908['push'](_0x5cd908['shift']());}}}(a43_0x3618,0x55f31));function a43_0x3618(){const _0x420eb1=['1380900wtlxIv','logWhiteDomainError','cancelled','Processing\x20Noda\x20webhook:','statusText','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','error','PENDING','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Failed\x20to\x20verify\x20Noda\x20payment:\x20','failed','Missing\x20id\x20or\x20shortLink\x20in\x20response','Yes','Error\x20details:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','headers','apiUrl','TesSoft\x20Payment\x20System/1.0','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Not\x20provided','Order\x20ID\x20Format:','1855380VEkNon','stack','message','QR\x20Code\x20Link:','Response\x20Body:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','280737rQffJR','isActive','Order\x20ID\x20Used:','Response\x20Time:','paid','verifyPayment','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Error\x20Message:','fromEntries','Noda\x20webhook\x20signature\x20verification:','processing','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20NODA\x20SUCCESS\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','SettlementDate','statusCode','processWebhook','application/json','canceled','Settled','expired','defineProperty','shortLinkUrls','JSON\x20Parse\x20Error:\x20','Request\x20Body\x20(Direct\x20JSON):','PaymentId','Method','created','HTTP\x20','expiryDate','Payment\x20Link\x20ID:','parse','/payment-links','FAILED','(8digits-8digits\x20format)','Business\x20Error:\x20','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Status\x20Code:','BankId','../loggerService','currency','Iban','Status','Unknown\x20error','successful',',\x20body:\x20','Noda\x20payment\x20verification\x20error:','10zDCGUS','3479qxcpMp','Unknown\x20error\x20from\x20Noda\x20API','(8digits-8digits\x20format\x20for\x20Noda)','amount','shortLink','logWhiteDomainResponse','Remitter','MerchantPaymentId','Status\x20Text:','createPaymentLink','Failed\x20to\x20parse\x20JSON\x20response:','8YsKEGi','status','rejected','Error\x20message:','Noda\x20API\x20error:\x20','stringify','completed','EXPIRED','1763113YwhgyL','Amount','https://tesoft.uk/gateway/noda/webhook/','pending','now','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','===\x20NODA\x20API\x20ERROR\x20===','loggerService','qrCodeLink','__esModule','Error\x20stack:','PAID','log','/payment-links/','Name','json','logWhiteDomainRequest','22foIdqx','Raw\x20Response\x20Body:','noda','POST','verifyWebhookSignature','success','NodaService','Short\x20Link:','HTTP\x20error!\x20status:\x20','entries','204KgsluT','2669020EldlRQ','text','URL:','GET','===\x20NODA\x20SERVICE\x20ERROR\x20===','3qHbwfN','5411dxspaK'];a43_0x3618=function(){return _0x420eb1;};return a43_0x3618();}Object[a43_0x13584a(0xfb)](exports,a43_0x13584a(0xb1),{'value':!![]}),exports[a43_0x13584a(0xbf)]=void 0x0;const loggerService_1=require(a43_0x13584a(0x8c));class NodaService{constructor(){const _0x5a2dc3=a43_0x13584a;this[_0x5a2dc3(0xdb)]='https://tesoft.uk/gateway/noda/',console[_0x5a2dc3(0xb4)](_0x5a2dc3(0xf1));}async[a43_0x13584a(0x9e)](_0xbe2782){const _0x15daac=a43_0x13584a,{orderId:_0xfd7455,name:_0xc1c55,paymentDescription:_0x202101,amount:_0x523f7f,currency:_0x2b1004,webhookUrl:_0x39e921,returnUrl:_0x4bd648,expiryDate:_0x300264}=_0xbe2782,_0x542907=_0x2b1004['toUpperCase'](),_0x235782=_0x15daac(0xaa),_0x587113='https://tesoft.uk/gateway/pending.php?id='+_0xfd7455,_0x3f8b40={'name':_0xc1c55,'paymentDescription':_0x202101,'amount':_0x523f7f,'currency':_0x542907,'paymentId':_0xfd7455,'webhookUrl':_0x235782,'returnUrl':_0x587113};_0x300264&&(_0x3f8b40[_0x15daac(0x82)]=_0x300264);const _0x23f96e=Date[_0x15daac(0xac)]();try{console['log'](_0x15daac(0xd0)),console['log'](_0x15daac(0xc6),this[_0x15daac(0xdb)]),console[_0x15daac(0xb4)](_0x15daac(0xfe),JSON[_0x15daac(0xa5)](_0x3f8b40,null,0x2)),console[_0x15daac(0xb4)](_0x15daac(0xdf),_0xfd7455,_0x15daac(0x97)),console[_0x15daac(0xb4)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x587113),loggerService_1[_0x15daac(0xaf)][_0x15daac(0xb8)](_0x15daac(0xbb),'/payment-links',_0x15daac(0xbc),_0x3f8b40);const _0x5ad2e2=await fetch(this[_0x15daac(0xdb)],{'method':_0x15daac(0xbc),'headers':{'Content-Type':_0x15daac(0xf7),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x15daac(0xa5)](_0x3f8b40)}),_0x3a9872=Date[_0x15daac(0xac)]()-_0x23f96e;console[_0x15daac(0xb4)](_0x15daac(0xd3)),console[_0x15daac(0xb4)]('Status:',_0x5ad2e2['status']),console['log'](_0x15daac(0x9d),_0x5ad2e2[_0x15daac(0xcf)]),console[_0x15daac(0xb4)]('Headers:',Object[_0x15daac(0xee)](_0x5ad2e2[_0x15daac(0xda)][_0x15daac(0xc2)]())),console['log'](_0x15daac(0xe9),_0x3a9872+'ms');const _0x48352f=await _0x5ad2e2[_0x15daac(0xc5)]();console['log'](_0x15daac(0xba),_0x48352f);if(!_0x5ad2e2['ok']){console[_0x15daac(0xd1)](_0x15daac(0xae)),console['error']('HTTP\x20Status:',_0x5ad2e2[_0x15daac(0xa1)]),console[_0x15daac(0xd1)](_0x15daac(0xe4),_0x48352f),loggerService_1[_0x15daac(0xaf)]['logWhiteDomainResponse'](_0x15daac(0xbb),_0x15daac(0x85),_0x5ad2e2['status'],_0x48352f,_0x3a9872),loggerService_1['loggerService'][_0x15daac(0xcc)](_0x15daac(0xbb),_0x15daac(0x85),_0x15daac(0x81)+_0x5ad2e2['status']+':\x20'+_0x48352f);if(_0x5ad2e2[_0x15daac(0xa1)]===0x190)throw new Error(_0x15daac(0xe5));else{if(_0x5ad2e2[_0x15daac(0xa1)]===0x1f4)throw new Error(_0x15daac(0xdd));}throw new Error(_0x15daac(0xc1)+_0x5ad2e2[_0x15daac(0xa1)]+_0x15daac(0x92)+_0x48352f);}let _0x4201b6;try{_0x4201b6=JSON[_0x15daac(0x84)](_0x48352f);}catch(_0x57f8de){console['error'](_0x15daac(0x9f),_0x57f8de),loggerService_1['loggerService']['logWhiteDomainError'](_0x15daac(0xbb),_0x15daac(0x85),_0x15daac(0xfd)+_0x57f8de);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x48352f);}console[_0x15daac(0xb4)](_0x15daac(0x89)),console[_0x15daac(0xb4)]('Parsed\x20Result:',JSON[_0x15daac(0xa5)](_0x4201b6,null,0x2)),loggerService_1[_0x15daac(0xaf)]['logWhiteDomainResponse'](_0x15daac(0xbb),_0x15daac(0x85),_0x5ad2e2[_0x15daac(0xa1)],_0x4201b6,_0x3a9872);if(_0x4201b6['error']||_0x4201b6[_0x15daac(0xf5)]){const _0x2ac3f6=_0x4201b6[_0x15daac(0xe2)]||_0x4201b6[_0x15daac(0xd1)]||_0x15daac(0x96);console[_0x15daac(0xd1)](_0x15daac(0xec)),console[_0x15daac(0xd1)](_0x15daac(0xed),_0x2ac3f6),console['error'](_0x15daac(0x8a),_0x4201b6[_0x15daac(0xf5)]),loggerService_1[_0x15daac(0xaf)][_0x15daac(0xcc)]('noda',_0x15daac(0x85),_0x15daac(0x88)+_0x2ac3f6);throw new Error(_0x15daac(0xa4)+_0x2ac3f6);}if(!_0x4201b6['id']||!_0x4201b6[_0x15daac(0xfc)]?.['shortLink']){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x15daac(0xd1)](_0x15daac(0xd6)),console[_0x15daac(0xd1)]('Response\x20data:',_0x4201b6),loggerService_1[_0x15daac(0xaf)]['logWhiteDomainError'](_0x15daac(0xbb),_0x15daac(0x85),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x15daac(0xd9));}return console[_0x15daac(0xb4)](_0x15daac(0xf2)),console[_0x15daac(0xb4)](_0x15daac(0x83),_0x4201b6['id']),console[_0x15daac(0xb4)](_0x15daac(0xc0),_0x4201b6[_0x15daac(0xfc)][_0x15daac(0x99)]),console[_0x15daac(0xb4)](_0x15daac(0xe3),_0x4201b6[_0x15daac(0xfc)][_0x15daac(0xb0)]||_0x15daac(0xde)),console[_0x15daac(0xb4)](_0x15daac(0xe8),_0xfd7455,_0x15daac(0x87)),console['log']('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x587113),{'gateway_payment_id':_0x4201b6['id'],'payment_url':_0x4201b6['shortLinkUrls']['shortLink'],'qr_code_url':_0x4201b6[_0x15daac(0xfc)][_0x15daac(0xb0)],'expiry_date':_0x4201b6[_0x15daac(0x82)]};}catch(_0x3fb1d6){console['error'](_0x15daac(0xc8)),console[_0x15daac(0xd1)](_0x15daac(0xd8),_0x3fb1d6),loggerService_1[_0x15daac(0xaf)]['logWhiteDomainError']('noda',_0x15daac(0x85),_0x3fb1d6);if(_0x3fb1d6 instanceof Error){console[_0x15daac(0xd1)](_0x15daac(0xa3),_0x3fb1d6[_0x15daac(0xe2)]),console[_0x15daac(0xd1)](_0x15daac(0xb2),_0x3fb1d6[_0x15daac(0xe1)]);throw new Error(_0x15daac(0xf3)+_0x3fb1d6[_0x15daac(0xe2)]);}throw new Error(_0x15daac(0xad));}}async[a43_0x13584a(0xeb)](_0x3d1b6e){const _0x553660=a43_0x13584a,_0x4cb644=Date[_0x553660(0xac)]();try{loggerService_1[_0x553660(0xaf)][_0x553660(0xb8)]('noda',_0x553660(0xb5)+_0x3d1b6e,_0x553660(0xc7),{});const _0x65c64f=await fetch(this[_0x553660(0xdb)]+'/'+_0x3d1b6e,{'method':_0x553660(0xc7),'headers':{'Content-Type':_0x553660(0xf7),'User-Agent':_0x553660(0xdc)}}),_0xb0bf86=Date['now']()-_0x4cb644;if(!_0x65c64f['ok']){const _0x25e8a3=await _0x65c64f[_0x553660(0xc5)]();loggerService_1[_0x553660(0xaf)][_0x553660(0x9a)](_0x553660(0xbb),'/payment-links/'+_0x3d1b6e,_0x65c64f[_0x553660(0xa1)],_0x25e8a3,_0xb0bf86);throw new Error(_0x553660(0xc1)+_0x65c64f[_0x553660(0xa1)]);}const _0x46fa17=await _0x65c64f[_0x553660(0xb7)]();loggerService_1[_0x553660(0xaf)][_0x553660(0x9a)](_0x553660(0xbb),_0x553660(0xb5)+_0x3d1b6e,_0x65c64f[_0x553660(0xa1)],_0x46fa17,_0xb0bf86);if(_0x46fa17['error']||_0x46fa17[_0x553660(0xf5)]){loggerService_1[_0x553660(0xaf)]['logWhiteDomainError'](_0x553660(0xbb),_0x553660(0xb5)+_0x3d1b6e,_0x553660(0xa4)+(_0x46fa17[_0x553660(0xe2)]||_0x46fa17[_0x553660(0xd1)]||_0x553660(0x90)));throw new Error(_0x553660(0xa4)+(_0x46fa17[_0x553660(0xe2)]||_0x46fa17[_0x553660(0xd1)]||'Unknown\x20error'));}let _0x5c424e=_0x553660(0xd2);if(_0x46fa17[_0x553660(0xe7)]===![]){if(_0x46fa17[_0x553660(0x82)]){const _0x374adc=new Date(_0x46fa17[_0x553660(0x82)]),_0x4cd23a=new Date();_0x374adc<_0x4cd23a?_0x5c424e='EXPIRED':_0x5c424e=_0x553660(0x86);}else _0x5c424e=_0x553660(0x86);}else _0x5c424e=_0x553660(0xd2);return{'status':_0x5c424e,'amount':_0x46fa17[_0x553660(0x98)],'currency':_0x46fa17[_0x553660(0x8d)],'isActive':_0x46fa17[_0x553660(0xe7)]};}catch(_0x50dea8){console[_0x553660(0xd1)](_0x553660(0x93),_0x50dea8),loggerService_1[_0x553660(0xaf)][_0x553660(0xcc)](_0x553660(0xbb),_0x553660(0xb5)+_0x3d1b6e,_0x50dea8);throw new Error(_0x553660(0xd4)+(_0x50dea8 instanceof Error?_0x50dea8[_0x553660(0xe2)]:_0x553660(0x90)));}}async[a43_0x13584a(0xf6)](_0x18cc41){const _0x1d230e=a43_0x13584a;console[_0x1d230e(0xb4)](_0x1d230e(0xce),_0x18cc41);let _0x2a938e=_0x1d230e(0xd2);switch(_0x18cc41[_0x1d230e(0x8f)]?.['toLowerCase']()){case'done':case _0x1d230e(0xa6):case _0x1d230e(0xea):case _0x1d230e(0xbe):case _0x1d230e(0x91):_0x18cc41[_0x1d230e(0xf9)]===_0x1d230e(0xd7)?_0x2a938e=_0x1d230e(0xb3):_0x2a938e='PENDING';break;case _0x1d230e(0xcd):case _0x1d230e(0xf8):case _0x1d230e(0xd5):case _0x1d230e(0xd1):case _0x1d230e(0xa2):_0x2a938e=_0x1d230e(0x86);break;case _0x1d230e(0xfa):case'timeout':_0x2a938e=_0x1d230e(0xa7);break;case _0x1d230e(0xab):case _0x1d230e(0x80):case'active':case _0x1d230e(0xf0):case'in_progress':default:_0x2a938e='PENDING';break;}return{'paymentId':_0x18cc41[_0x1d230e(0x9c)]||_0x18cc41[_0x1d230e(0xff)],'status':_0x2a938e,'amount':_0x18cc41[_0x1d230e(0xa9)],'currency':_0x18cc41['Currency'],'additionalInfo':{'method':_0x18cc41[_0x1d230e(0x7f)],'bankId':_0x18cc41[_0x1d230e(0x8b)],'settled':_0x18cc41[_0x1d230e(0xf9)],'settlementDate':_0x18cc41[_0x1d230e(0xf4)],'remitterName':_0x18cc41[_0x1d230e(0x9b)]?.[_0x1d230e(0xb6)],'remitterIban':_0x18cc41[_0x1d230e(0x9b)]?.[_0x1d230e(0x8e)],'bankTransactionId':_0x18cc41['BankTransactionId']}};}[a43_0x13584a(0xbd)](_0x3ac3ef,_0x56c212){const _0x13e608=a43_0x13584a;return console[_0x13e608(0xb4)](_0x13e608(0xef),{'receivedSignature':_0x56c212,'paymentId':_0x3ac3ef[_0x13e608(0xff)],'merchantPaymentId':_0x3ac3ef[_0x13e608(0x9c)]}),!![];}}exports['NodaService']=NodaService;