'use strict';const a42_0x2844c0=a42_0x1f31;(function(_0x13b62f,_0x5ad601){const _0x42b860=a42_0x1f31,_0xaaa303=_0x13b62f();while(!![]){try{const _0x1faedd=parseInt(_0x42b860(0xeb))/0x1*(-parseInt(_0x42b860(0xd3))/0x2)+-parseInt(_0x42b860(0xdc))/0x3*(-parseInt(_0x42b860(0xa1))/0x4)+-parseInt(_0x42b860(0x10c))/0x5+-parseInt(_0x42b860(0xf7))/0x6+-parseInt(_0x42b860(0x106))/0x7*(parseInt(_0x42b860(0x9a))/0x8)+parseInt(_0x42b860(0x103))/0x9+parseInt(_0x42b860(0xe6))/0xa;if(_0x1faedd===_0x5ad601)break;else _0xaaa303['push'](_0xaaa303['shift']());}catch(_0x415d0e){_0xaaa303['push'](_0xaaa303['shift']());}}}(a42_0x332a,0xeb178));Object[a42_0x2844c0(0xa3)](exports,a42_0x2844c0(0xdf),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a42_0x2844c0(0xa0));class NodaService{constructor(){const _0x58b8e2=a42_0x2844c0;this[_0x58b8e2(0x105)]=_0x58b8e2(0xed),console['log'](_0x58b8e2(0xf6));}async['createPaymentLink'](_0x3177e7){const _0x29696e=a42_0x2844c0,{orderId:_0x3d1c18,name:_0x3b3595,paymentDescription:_0x53d8d6,amount:_0x5adfe6,currency:_0x2a436f,webhookUrl:_0x3527cb,returnUrl:_0x48bc4e,expiryDate:_0x162d08}=_0x3177e7,_0x161299=_0x2a436f[_0x29696e(0x99)](),_0x378f5e=_0x29696e(0xad),_0x555630=_0x29696e(0xdd)+_0x3d1c18,_0x206b44={'name':_0x3b3595,'paymentDescription':_0x53d8d6,'amount':_0x5adfe6,'currency':_0x161299,'paymentId':_0x3d1c18,'webhookUrl':_0x378f5e,'returnUrl':_0x555630};_0x162d08&&(_0x206b44[_0x29696e(0x109)]=_0x162d08);const _0x23df3b=Date[_0x29696e(0xc6)]();try{console[_0x29696e(0xdb)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x29696e(0xdb)]('URL:',this['apiUrl']),console[_0x29696e(0xdb)](_0x29696e(0xe1),JSON['stringify'](_0x206b44,null,0x2)),console[_0x29696e(0xdb)](_0x29696e(0xac),_0x3d1c18,_0x29696e(0xde)),console[_0x29696e(0xdb)](_0x29696e(0xb1),_0x555630),loggerService_1['loggerService'][_0x29696e(0xfe)](_0x29696e(0xf5),_0x29696e(0xee),'POST',_0x206b44);const _0x10ab39=await fetch(this['apiUrl'],{'method':_0x29696e(0xc9),'headers':{'Content-Type':_0x29696e(0xc2),'Accept':_0x29696e(0xc2),'User-Agent':_0x29696e(0xf3)},'body':JSON[_0x29696e(0xbd)](_0x206b44)}),_0x1629ac=Date['now']()-_0x23df3b;console[_0x29696e(0xdb)](_0x29696e(0xe3)),console['log'](_0x29696e(0xd0),_0x10ab39['status']),console[_0x29696e(0xdb)](_0x29696e(0x100),_0x10ab39[_0x29696e(0xea)]),console[_0x29696e(0xdb)]('Headers:',Object['fromEntries'](_0x10ab39[_0x29696e(0xe9)][_0x29696e(0x9b)]())),console[_0x29696e(0xdb)](_0x29696e(0x9c),_0x1629ac+'ms');const _0x696a6c=await _0x10ab39[_0x29696e(0xa4)]();console[_0x29696e(0xdb)](_0x29696e(0x10e),_0x696a6c);if(!_0x10ab39['ok']){console[_0x29696e(0xe8)](_0x29696e(0xf1)),console['error'](_0x29696e(0xba),_0x10ab39['status']),console[_0x29696e(0xe8)]('Response\x20Body:',_0x696a6c),loggerService_1[_0x29696e(0x9f)]['logWhiteDomainResponse']('noda','/payment-links',_0x10ab39[_0x29696e(0x98)],_0x696a6c,_0x1629ac),loggerService_1[_0x29696e(0x9f)]['logWhiteDomainError']('noda',_0x29696e(0xee),_0x29696e(0xc1)+_0x10ab39[_0x29696e(0x98)]+':\x20'+_0x696a6c);if(_0x10ab39[_0x29696e(0x98)]===0x190)throw new Error(_0x29696e(0x101));else{if(_0x10ab39[_0x29696e(0x98)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x29696e(0xf2)+_0x10ab39[_0x29696e(0x98)]+_0x29696e(0xbf)+_0x696a6c);}let _0x18165a;try{_0x18165a=JSON[_0x29696e(0xd4)](_0x696a6c);}catch(_0x51064e){console[_0x29696e(0xe8)](_0x29696e(0xbe),_0x51064e),loggerService_1[_0x29696e(0x9f)][_0x29696e(0xe4)](_0x29696e(0xf5),'/payment-links',_0x29696e(0xfb)+_0x51064e);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x696a6c);}console[_0x29696e(0xdb)](_0x29696e(0xec)),console['log'](_0x29696e(0xf4),JSON['stringify'](_0x18165a,null,0x2)),loggerService_1[_0x29696e(0x9f)][_0x29696e(0x9d)]('noda',_0x29696e(0xee),_0x10ab39[_0x29696e(0x98)],_0x18165a,_0x1629ac);if(_0x18165a['error']||_0x18165a['statusCode']){const _0x4a52be=_0x18165a[_0x29696e(0xd5)]||_0x18165a[_0x29696e(0xe8)]||_0x29696e(0xb3);console[_0x29696e(0xe8)](_0x29696e(0xbc)),console[_0x29696e(0xe8)]('Error\x20Message:',_0x4a52be),console['error'](_0x29696e(0xb9),_0x18165a[_0x29696e(0xcf)]),loggerService_1[_0x29696e(0x9f)][_0x29696e(0xe4)]('noda',_0x29696e(0xee),_0x29696e(0x9e)+_0x4a52be);throw new Error(_0x29696e(0xb6)+_0x4a52be);}if(!_0x18165a['id']||!_0x18165a[_0x29696e(0xcc)]?.[_0x29696e(0x10b)]){console[_0x29696e(0xe8)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x29696e(0xe8)](_0x29696e(0xc4)),console[_0x29696e(0xe8)](_0x29696e(0xa2),_0x18165a),loggerService_1[_0x29696e(0x9f)]['logWhiteDomainError'](_0x29696e(0xf5),_0x29696e(0xee),_0x29696e(0xfc));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x29696e(0xae),_0x18165a['id']),console['log'](_0x29696e(0xab),_0x18165a[_0x29696e(0xcc)][_0x29696e(0x10b)]),console['log'](_0x29696e(0x104),_0x18165a['shortLinkUrls'][_0x29696e(0xaf)]||_0x29696e(0xc7)),console['log'](_0x29696e(0x102),_0x3d1c18,_0x29696e(0xfa)),console[_0x29696e(0xdb)](_0x29696e(0xd8),_0x555630),{'gateway_payment_id':_0x18165a['id'],'payment_url':_0x18165a[_0x29696e(0xcc)][_0x29696e(0x10b)],'qr_code_url':_0x18165a[_0x29696e(0xcc)][_0x29696e(0xaf)],'expiry_date':_0x18165a[_0x29696e(0x109)]};}catch(_0x140eea){console[_0x29696e(0xe8)](_0x29696e(0xe2)),console[_0x29696e(0xe8)](_0x29696e(0xb8),_0x140eea),loggerService_1[_0x29696e(0x9f)][_0x29696e(0xe4)](_0x29696e(0xf5),'/payment-links',_0x140eea);if(_0x140eea instanceof Error){console[_0x29696e(0xe8)](_0x29696e(0x97),_0x140eea['message']),console['error']('Error\x20stack:',_0x140eea[_0x29696e(0xf0)]);throw new Error(_0x29696e(0xce)+_0x140eea[_0x29696e(0xd5)]);}throw new Error(_0x29696e(0xc5));}}async[a42_0x2844c0(0xc8)](_0x5df266){const _0x2b732f=a42_0x2844c0,_0x385964=Date['now']();try{loggerService_1[_0x2b732f(0x9f)][_0x2b732f(0xfe)](_0x2b732f(0xf5),_0x2b732f(0xa8)+_0x5df266,_0x2b732f(0xd2),{});const _0x397914=await fetch(this['apiUrl']+'/'+_0x5df266,{'method':_0x2b732f(0xd2),'headers':{'Content-Type':_0x2b732f(0xc2),'User-Agent':_0x2b732f(0xf3)}}),_0x2e3346=Date[_0x2b732f(0xc6)]()-_0x385964;if(!_0x397914['ok']){const _0x884422=await _0x397914[_0x2b732f(0xa4)]();loggerService_1[_0x2b732f(0x9f)][_0x2b732f(0x9d)]('noda',_0x2b732f(0xa8)+_0x5df266,_0x397914['status'],_0x884422,_0x2e3346);throw new Error(_0x2b732f(0xf2)+_0x397914[_0x2b732f(0x98)]);}const _0x41d230=await _0x397914[_0x2b732f(0xc0)]();loggerService_1['loggerService'][_0x2b732f(0x9d)](_0x2b732f(0xf5),_0x2b732f(0xa8)+_0x5df266,_0x397914[_0x2b732f(0x98)],_0x41d230,_0x2e3346);if(_0x41d230[_0x2b732f(0xe8)]||_0x41d230[_0x2b732f(0xcf)]){loggerService_1[_0x2b732f(0x9f)]['logWhiteDomainError'](_0x2b732f(0xf5),_0x2b732f(0xa8)+_0x5df266,_0x2b732f(0xb6)+(_0x41d230[_0x2b732f(0xd5)]||_0x41d230[_0x2b732f(0xe8)]||_0x2b732f(0xe0)));throw new Error('Noda\x20API\x20error:\x20'+(_0x41d230[_0x2b732f(0xd5)]||_0x41d230['error']||_0x2b732f(0xe0)));}let _0x7fd0e0=_0x2b732f(0xa6);if(_0x41d230['isActive']===![]){if(_0x41d230['expiryDate']){const _0xebf149=new Date(_0x41d230[_0x2b732f(0x109)]),_0x221e20=new Date();_0xebf149<_0x221e20?_0x7fd0e0=_0x2b732f(0xc3):_0x7fd0e0='FAILED';}else _0x7fd0e0=_0x2b732f(0xd6);}else _0x7fd0e0=_0x2b732f(0xa6);return{'status':_0x7fd0e0,'amount':_0x41d230['amount'],'currency':_0x41d230['currency'],'isActive':_0x41d230[_0x2b732f(0xb2)]};}catch(_0x82416a){console['error'](_0x2b732f(0x110),_0x82416a),loggerService_1['loggerService']['logWhiteDomainError'](_0x2b732f(0xf5),_0x2b732f(0xa8)+_0x5df266,_0x82416a);throw new Error(_0x2b732f(0xca)+(_0x82416a instanceof Error?_0x82416a['message']:_0x2b732f(0xe0)));}}async[a42_0x2844c0(0xb0)](_0x8955cc){const _0x41a325=a42_0x2844c0;console['log'](_0x41a325(0xcb),_0x8955cc);let _0x130caa=_0x41a325(0xa6);switch(_0x8955cc['Status']?.['toLowerCase']()){case _0x41a325(0xe5):case _0x41a325(0x10d):case _0x41a325(0xaa):case _0x41a325(0x10a):case _0x41a325(0x108):_0x8955cc['Settled']===_0x41a325(0xf9)?_0x130caa=_0x41a325(0xe7):_0x130caa=_0x41a325(0xa6);break;case _0x41a325(0xf8):case _0x41a325(0xd1):case'failed':case _0x41a325(0xe8):case _0x41a325(0xcd):_0x130caa=_0x41a325(0xd6);break;case'expired':case _0x41a325(0xa9):_0x130caa=_0x41a325(0xc3);break;case _0x41a325(0xa5):case'created':case _0x41a325(0xb4):case _0x41a325(0xff):case _0x41a325(0xb5):default:_0x130caa='PENDING';break;}return{'paymentId':_0x8955cc['MerchantPaymentId']||_0x8955cc['PaymentId'],'status':_0x130caa,'amount':_0x8955cc['Amount'],'currency':_0x8955cc['Currency'],'additionalInfo':{'method':_0x8955cc[_0x41a325(0xa7)],'bankId':_0x8955cc['BankId'],'settled':_0x8955cc[_0x41a325(0x10f)],'settlementDate':_0x8955cc[_0x41a325(0xfd)],'remitterName':_0x8955cc[_0x41a325(0x107)]?.[_0x41a325(0x96)],'remitterIban':_0x8955cc['Remitter']?.['Iban'],'bankTransactionId':_0x8955cc[_0x41a325(0xda)]}};}[a42_0x2844c0(0xbb)](_0x41a99f,_0x361e0a){const _0x382aa9=a42_0x2844c0;return console['log'](_0x382aa9(0xb7),{'receivedSignature':_0x361e0a,'paymentId':_0x41a99f[_0x382aa9(0xd7)],'merchantPaymentId':_0x41a99f[_0x382aa9(0xd9)]}),!![];}}function a42_0x332a(){const _0x6f39d=['SettlementDate','logWhiteDomainRequest','processing','Status\x20Text:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Order\x20ID\x20Used:','15226002xPAsAM','QR\x20Code\x20Link:','apiUrl','17521oZxDbv','Remitter','successful','expiryDate','success','shortLink','2299665slsFHD','completed','Raw\x20Response\x20Body:','Settled','Noda\x20payment\x20verification\x20error:','Name','Error\x20message:','status','toUpperCase','3320ifyeEM','entries','Response\x20Time:','logWhiteDomainResponse','Business\x20Error:\x20','loggerService','../loggerService','8xgArib','Response\x20data:','defineProperty','text','pending','PENDING','Method','/payment-links/','timeout','paid','Short\x20Link:','Order\x20ID\x20Format:','https://tesoft.uk/gateway/noda/webhook/','Payment\x20Link\x20ID:','qrCodeLink','processWebhook','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','isActive','Unknown\x20error\x20from\x20Noda\x20API','active','in_progress','Noda\x20API\x20error:\x20','Noda\x20webhook\x20signature\x20verification:','Error\x20details:','Status\x20Code:','HTTP\x20Status:','verifyWebhookSignature','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','stringify','Failed\x20to\x20parse\x20JSON\x20response:',',\x20body:\x20','json','HTTP\x20','application/json','EXPIRED','Missing\x20id\x20or\x20shortLink\x20in\x20response','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','now','Not\x20provided','verifyPayment','POST','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Processing\x20Noda\x20webhook:','shortLinkUrls','rejected','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','statusCode','Status:','canceled','GET','22SYKYHI','parse','message','FAILED','PaymentId','✅\x20Return\x20URL\x20configured\x20for\x20pending:','MerchantPaymentId','BankTransactionId','log','397707RttiTI','https://tesoft.uk/gateway/pending.php?id=','(8digits-8digits\x20format\x20for\x20Noda)','__esModule','Unknown\x20error','Request\x20Body\x20(Direct\x20JSON):','===\x20NODA\x20SERVICE\x20ERROR\x20===','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainError','done','34363690ZUqoku','PAID','error','headers','statusText','128003drjxbG','===\x20PARSED\x20NODA\x20RESPONSE\x20===','https://tesoft.uk/gateway/noda/','/payment-links','NodaService','stack','===\x20NODA\x20API\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','TesSoft\x20Payment\x20System/1.0','Parsed\x20Result:','noda','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','9141828dvsxuO','cancelled','Yes','(8digits-8digits\x20format)','JSON\x20Parse\x20Error:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink'];a42_0x332a=function(){return _0x6f39d;};return a42_0x332a();}function a42_0x1f31(_0x56a07e,_0x370e25){const _0x332af0=a42_0x332a();return a42_0x1f31=function(_0x1f31a9,_0x145c75){_0x1f31a9=_0x1f31a9-0x96;let _0x1dee9d=_0x332af0[_0x1f31a9];return _0x1dee9d;},a42_0x1f31(_0x56a07e,_0x370e25);}exports[a42_0x2844c0(0xef)]=NodaService;