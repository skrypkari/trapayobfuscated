'use strict';const a43_0x59f7e3=a43_0x1747;(function(_0x1e349c,_0x51e669){const _0x2d3bb6=a43_0x1747,_0x1a65f5=_0x1e349c();while(!![]){try{const _0x2c9b9b=parseInt(_0x2d3bb6(0x21b))/0x1*(-parseInt(_0x2d3bb6(0x248))/0x2)+-parseInt(_0x2d3bb6(0x227))/0x3+parseInt(_0x2d3bb6(0x24b))/0x4+parseInt(_0x2d3bb6(0x245))/0x5*(parseInt(_0x2d3bb6(0x231))/0x6)+-parseInt(_0x2d3bb6(0x221))/0x7*(-parseInt(_0x2d3bb6(0x21a))/0x8)+parseInt(_0x2d3bb6(0x22d))/0x9*(-parseInt(_0x2d3bb6(0x1e9))/0xa)+-parseInt(_0x2d3bb6(0x1df))/0xb;if(_0x2c9b9b===_0x51e669)break;else _0x1a65f5['push'](_0x1a65f5['shift']());}catch(_0x14cb0f){_0x1a65f5['push'](_0x1a65f5['shift']());}}}(a43_0x3cb4,0x48eea));function a43_0x1747(_0x4ad3bd,_0x199465){const _0x3cb4a7=a43_0x3cb4();return a43_0x1747=function(_0x17471a,_0x24410e){_0x17471a=_0x17471a-0x1d6;let _0x199219=_0x3cb4a7[_0x17471a];return _0x199219;},a43_0x1747(_0x4ad3bd,_0x199465);}Object[a43_0x59f7e3(0x249)](exports,'__esModule',{'value':!![]}),exports[a43_0x59f7e3(0x1ee)]=void 0x0;const loggerService_1=require(a43_0x59f7e3(0x229));function a43_0x3cb4(){const _0x4f5802=['statusText','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Noda\x20API\x20error:\x20','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Status\x20Text:','Iban','URL:','30btlpUv','timeout','paid','toUpperCase','Status\x20Code:','NodaService','GET','status','isActive','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','cancelled','loggerService','failed','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Settled','log','apiUrl','error','entries','POST','active','MerchantPaymentId','expiryDate','rejected','Failed\x20to\x20parse\x20JSON\x20response:','application/json','completed','Response\x20Body:','===\x20NODA\x20API\x20ERROR\x20===','in_progress','Name','done','(8digits-8digits\x20format\x20for\x20Noda)','Processing\x20Noda\x20webhook:','logWhiteDomainResponse','https://tesoft.uk/gateway/noda/webhook/','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','message','Payment\x20Link\x20ID:','FAILED','Business\x20Error:\x20','Unknown\x20error\x20from\x20Noda\x20API','HTTP\x20error!\x20status:\x20','https://tesoft.uk/gateway/pending.php?id=','shortLink','json','/payment-links','stringify','16LPMXhx','16528KhCAtq','noda','(8digits-8digits\x20format)','Order\x20ID\x20Used:','Order\x20ID\x20Format:','text','1384957BWDfgu','toLowerCase','Missing\x20id\x20or\x20shortLink\x20in\x20response','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Not\x20provided','statusCode','894885IJuRdd','qrCodeLink','../loggerService','verifyWebhookSignature','processing','Failed\x20to\x20verify\x20Noda\x20payment:\x20','165438QymRUX','logWhiteDomainRequest','/payment-links/','Status:','2100LeMuua','success','===\x20NODA\x20SERVICE\x20ERROR\x20===','Noda\x20webhook\x20signature\x20verification:','expired','TesSoft\x20Payment\x20System/1.0','Currency','HTTP\x20Status:','Error\x20message:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',',\x20body:\x20','Noda\x20payment\x20verification\x20error:','logWhiteDomainError','Yes','Status','pending','createPaymentLink','PENDING','successful','8065eJXqcH','shortLinkUrls','Headers:','44YKOFdW','defineProperty','Unknown\x20error','955244GLWyfr','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Parsed\x20Result:','EXPIRED','now','HTTP\x20','stack','Request\x20Body\x20(Direct\x20JSON):','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','https://tesoft.uk/gateway/noda/','2016036cwMvhK','Remitter','parse'];a43_0x3cb4=function(){return _0x4f5802;};return a43_0x3cb4();}class NodaService{constructor(){const _0x11db84=a43_0x59f7e3;this[_0x11db84(0x1fa)]=_0x11db84(0x1de),console[_0x11db84(0x1f9)](_0x11db84(0x1e5));}async[a43_0x59f7e3(0x242)](_0xefdf8e){const _0x3e9556=a43_0x59f7e3,{orderId:_0x361695,name:_0x1ba25d,paymentDescription:_0x2768e5,amount:_0x372c3a,currency:_0x1ff8e5,webhookUrl:_0x62acf4,returnUrl:_0x2c7031,expiryDate:_0x504df2}=_0xefdf8e,_0x360fb1=_0x1ff8e5[_0x3e9556(0x1ec)](),_0x5e74c5=_0x3e9556(0x20d),_0x993f00=_0x3e9556(0x215)+_0x361695,_0x44b3ee={'name':_0x1ba25d,'paymentDescription':_0x2768e5,'amount':_0x372c3a,'currency':_0x360fb1,'paymentId':_0x361695,'webhookUrl':_0x5e74c5,'returnUrl':_0x993f00};_0x504df2&&(_0x44b3ee['expiryDate']=_0x504df2);const _0x34d9a4=Date['now']();try{console[_0x3e9556(0x1f9)](_0x3e9556(0x1d6)),console[_0x3e9556(0x1f9)](_0x3e9556(0x1e8),this[_0x3e9556(0x1fa)]),console[_0x3e9556(0x1f9)](_0x3e9556(0x1dc),JSON[_0x3e9556(0x219)](_0x44b3ee,null,0x2)),console['log'](_0x3e9556(0x21f),_0x361695,_0x3e9556(0x20a)),console[_0x3e9556(0x1f9)](_0x3e9556(0x1f2),_0x993f00),loggerService_1[_0x3e9556(0x1f5)][_0x3e9556(0x22e)](_0x3e9556(0x21c),'/payment-links',_0x3e9556(0x1fd),_0x44b3ee);const _0x2bc21a=await fetch(this[_0x3e9556(0x1fa)],{'method':_0x3e9556(0x1fd),'headers':{'Content-Type':_0x3e9556(0x203),'Accept':_0x3e9556(0x203),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x3e9556(0x219)](_0x44b3ee)}),_0x336fed=Date[_0x3e9556(0x1d9)]()-_0x34d9a4;console[_0x3e9556(0x1f9)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x3e9556(0x230),_0x2bc21a[_0x3e9556(0x1f0)]),console['log'](_0x3e9556(0x1e6),_0x2bc21a[_0x3e9556(0x1e2)]),console[_0x3e9556(0x1f9)](_0x3e9556(0x247),Object['fromEntries'](_0x2bc21a['headers'][_0x3e9556(0x1fc)]())),console[_0x3e9556(0x1f9)]('Response\x20Time:',_0x336fed+'ms');const _0x5897c5=await _0x2bc21a[_0x3e9556(0x220)]();console[_0x3e9556(0x1f9)]('Raw\x20Response\x20Body:',_0x5897c5);if(!_0x2bc21a['ok']){console[_0x3e9556(0x1fb)](_0x3e9556(0x206)),console[_0x3e9556(0x1fb)](_0x3e9556(0x238),_0x2bc21a[_0x3e9556(0x1f0)]),console[_0x3e9556(0x1fb)](_0x3e9556(0x205),_0x5897c5),loggerService_1[_0x3e9556(0x1f5)][_0x3e9556(0x20c)](_0x3e9556(0x21c),'/payment-links',_0x2bc21a[_0x3e9556(0x1f0)],_0x5897c5,_0x336fed),loggerService_1[_0x3e9556(0x1f5)][_0x3e9556(0x23e)]('noda','/payment-links',_0x3e9556(0x1da)+_0x2bc21a['status']+':\x20'+_0x5897c5);if(_0x2bc21a[_0x3e9556(0x1f0)]===0x190)throw new Error(_0x3e9556(0x1e3));else{if(_0x2bc21a[_0x3e9556(0x1f0)]===0x1f4)throw new Error(_0x3e9556(0x1dd));}throw new Error(_0x3e9556(0x214)+_0x2bc21a['status']+_0x3e9556(0x23c)+_0x5897c5);}let _0x255417;try{_0x255417=JSON[_0x3e9556(0x1e1)](_0x5897c5);}catch(_0x2014f5){console['error'](_0x3e9556(0x202),_0x2014f5),loggerService_1[_0x3e9556(0x1f5)][_0x3e9556(0x23e)]('noda',_0x3e9556(0x218),'JSON\x20Parse\x20Error:\x20'+_0x2014f5);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x5897c5);}console[_0x3e9556(0x1f9)](_0x3e9556(0x224)),console[_0x3e9556(0x1f9)](_0x3e9556(0x1d7),JSON[_0x3e9556(0x219)](_0x255417,null,0x2)),loggerService_1[_0x3e9556(0x1f5)][_0x3e9556(0x20c)]('noda',_0x3e9556(0x218),_0x2bc21a[_0x3e9556(0x1f0)],_0x255417,_0x336fed);if(_0x255417[_0x3e9556(0x1fb)]||_0x255417[_0x3e9556(0x226)]){const _0x5a8c5d=_0x255417[_0x3e9556(0x20f)]||_0x255417[_0x3e9556(0x1fb)]||_0x3e9556(0x213);console[_0x3e9556(0x1fb)](_0x3e9556(0x23a)),console[_0x3e9556(0x1fb)]('Error\x20Message:',_0x5a8c5d),console[_0x3e9556(0x1fb)](_0x3e9556(0x1ed),_0x255417['statusCode']),loggerService_1['loggerService'][_0x3e9556(0x23e)](_0x3e9556(0x21c),'/payment-links',_0x3e9556(0x212)+_0x5a8c5d);throw new Error('Noda\x20API\x20error:\x20'+_0x5a8c5d);}if(!_0x255417['id']||!_0x255417[_0x3e9556(0x246)]?.[_0x3e9556(0x216)]){console[_0x3e9556(0x1fb)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3e9556(0x1fb)](_0x3e9556(0x223)),console['error']('Response\x20data:',_0x255417),loggerService_1['loggerService'][_0x3e9556(0x23e)]('noda','/payment-links',_0x3e9556(0x1f7));throw new Error(_0x3e9556(0x1f3));}return console[_0x3e9556(0x1f9)]('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x3e9556(0x210),_0x255417['id']),console[_0x3e9556(0x1f9)]('Short\x20Link:',_0x255417[_0x3e9556(0x246)]['shortLink']),console[_0x3e9556(0x1f9)]('QR\x20Code\x20Link:',_0x255417['shortLinkUrls'][_0x3e9556(0x228)]||_0x3e9556(0x225)),console['log'](_0x3e9556(0x21e),_0x361695,_0x3e9556(0x21d)),console[_0x3e9556(0x1f9)](_0x3e9556(0x23b),_0x993f00),{'gateway_payment_id':_0x255417['id'],'payment_url':_0x255417[_0x3e9556(0x246)][_0x3e9556(0x216)],'qr_code_url':_0x255417[_0x3e9556(0x246)][_0x3e9556(0x228)],'expiry_date':_0x255417['expiryDate']};}catch(_0x2b173a){console[_0x3e9556(0x1fb)](_0x3e9556(0x233)),console[_0x3e9556(0x1fb)]('Error\x20details:',_0x2b173a),loggerService_1[_0x3e9556(0x1f5)][_0x3e9556(0x23e)](_0x3e9556(0x21c),'/payment-links',_0x2b173a);if(_0x2b173a instanceof Error){console[_0x3e9556(0x1fb)](_0x3e9556(0x239),_0x2b173a['message']),console[_0x3e9556(0x1fb)]('Error\x20stack:',_0x2b173a[_0x3e9556(0x1db)]);throw new Error(_0x3e9556(0x20e)+_0x2b173a['message']);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x411f1b){const _0x28931b=a43_0x59f7e3,_0x3375af=Date[_0x28931b(0x1d9)]();try{loggerService_1[_0x28931b(0x1f5)][_0x28931b(0x22e)](_0x28931b(0x21c),_0x28931b(0x22f)+_0x411f1b,_0x28931b(0x1ef),{});const _0x40c67f=await fetch(this[_0x28931b(0x1fa)]+'/'+_0x411f1b,{'method':_0x28931b(0x1ef),'headers':{'Content-Type':'application/json','User-Agent':_0x28931b(0x236)}}),_0x22bbb6=Date['now']()-_0x3375af;if(!_0x40c67f['ok']){const _0x4671c7=await _0x40c67f[_0x28931b(0x220)]();loggerService_1[_0x28931b(0x1f5)][_0x28931b(0x20c)](_0x28931b(0x21c),_0x28931b(0x22f)+_0x411f1b,_0x40c67f[_0x28931b(0x1f0)],_0x4671c7,_0x22bbb6);throw new Error(_0x28931b(0x214)+_0x40c67f[_0x28931b(0x1f0)]);}const _0x16720d=await _0x40c67f[_0x28931b(0x217)]();loggerService_1[_0x28931b(0x1f5)][_0x28931b(0x20c)](_0x28931b(0x21c),_0x28931b(0x22f)+_0x411f1b,_0x40c67f[_0x28931b(0x1f0)],_0x16720d,_0x22bbb6);if(_0x16720d[_0x28931b(0x1fb)]||_0x16720d['statusCode']){loggerService_1[_0x28931b(0x1f5)][_0x28931b(0x23e)](_0x28931b(0x21c),_0x28931b(0x22f)+_0x411f1b,_0x28931b(0x1e4)+(_0x16720d[_0x28931b(0x20f)]||_0x16720d[_0x28931b(0x1fb)]||_0x28931b(0x24a)));throw new Error(_0x28931b(0x1e4)+(_0x16720d[_0x28931b(0x20f)]||_0x16720d[_0x28931b(0x1fb)]||_0x28931b(0x24a)));}let _0x52edab='PENDING';if(_0x16720d[_0x28931b(0x1f1)]===![]){if(_0x16720d[_0x28931b(0x200)]){const _0x177961=new Date(_0x16720d[_0x28931b(0x200)]),_0x1217c8=new Date();_0x177961<_0x1217c8?_0x52edab=_0x28931b(0x1d8):_0x52edab=_0x28931b(0x211);}else _0x52edab=_0x28931b(0x211);}else _0x52edab=_0x28931b(0x243);return{'status':_0x52edab,'amount':_0x16720d['amount'],'currency':_0x16720d['currency'],'isActive':_0x16720d[_0x28931b(0x1f1)]};}catch(_0x490224){console[_0x28931b(0x1fb)](_0x28931b(0x23d),_0x490224),loggerService_1[_0x28931b(0x1f5)][_0x28931b(0x23e)]('noda',_0x28931b(0x22f)+_0x411f1b,_0x490224);throw new Error(_0x28931b(0x22c)+(_0x490224 instanceof Error?_0x490224['message']:_0x28931b(0x24a)));}}async['processWebhook'](_0x31b50e){const _0x5bb2eb=a43_0x59f7e3;console[_0x5bb2eb(0x1f9)](_0x5bb2eb(0x20b),_0x31b50e);let _0x38d861=_0x5bb2eb(0x243);switch(_0x31b50e[_0x5bb2eb(0x240)]?.[_0x5bb2eb(0x222)]()){case _0x5bb2eb(0x209):case _0x5bb2eb(0x204):case _0x5bb2eb(0x1eb):case _0x5bb2eb(0x232):case _0x5bb2eb(0x244):_0x31b50e[_0x5bb2eb(0x1f8)]===_0x5bb2eb(0x23f)?_0x38d861='PAID':_0x38d861='PENDING';break;case _0x5bb2eb(0x1f4):case'canceled':case _0x5bb2eb(0x1f6):case _0x5bb2eb(0x1fb):case _0x5bb2eb(0x201):_0x38d861=_0x5bb2eb(0x211);break;case _0x5bb2eb(0x235):case _0x5bb2eb(0x1ea):_0x38d861=_0x5bb2eb(0x1d8);break;case _0x5bb2eb(0x241):case'created':case _0x5bb2eb(0x1fe):case _0x5bb2eb(0x22b):case _0x5bb2eb(0x207):default:_0x38d861=_0x5bb2eb(0x243);break;}return{'paymentId':_0x31b50e['MerchantPaymentId']||_0x31b50e['PaymentId'],'status':_0x38d861,'amount':_0x31b50e['Amount'],'currency':_0x31b50e[_0x5bb2eb(0x237)],'additionalInfo':{'method':_0x31b50e['Method'],'bankId':_0x31b50e['BankId'],'settled':_0x31b50e['Settled'],'settlementDate':_0x31b50e['SettlementDate'],'remitterName':_0x31b50e[_0x5bb2eb(0x1e0)]?.[_0x5bb2eb(0x208)],'remitterIban':_0x31b50e[_0x5bb2eb(0x1e0)]?.[_0x5bb2eb(0x1e7)],'bankTransactionId':_0x31b50e['BankTransactionId']}};}[a43_0x59f7e3(0x22a)](_0x24b7d7,_0x3df66f){const _0x5c2884=a43_0x59f7e3;return console[_0x5c2884(0x1f9)](_0x5c2884(0x234),{'receivedSignature':_0x3df66f,'paymentId':_0x24b7d7['PaymentId'],'merchantPaymentId':_0x24b7d7[_0x5c2884(0x1ff)]}),!![];}}exports['NodaService']=NodaService;