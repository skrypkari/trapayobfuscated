'use strict';const a47_0x4412d0=a47_0x371b;(function(_0x41c428,_0x5afe83){const _0x48f737=a47_0x371b,_0x2d5262=_0x41c428();while(!![]){try{const _0x581490=parseInt(_0x48f737(0x1fe))/0x1*(parseInt(_0x48f737(0x1e1))/0x2)+-parseInt(_0x48f737(0x242))/0x3*(parseInt(_0x48f737(0x215))/0x4)+-parseInt(_0x48f737(0x21b))/0x5+parseInt(_0x48f737(0x1d2))/0x6+parseInt(_0x48f737(0x243))/0x7+parseInt(_0x48f737(0x1da))/0x8+-parseInt(_0x48f737(0x22b))/0x9;if(_0x581490===_0x5afe83)break;else _0x2d5262['push'](_0x2d5262['shift']());}catch(_0x450579){_0x2d5262['push'](_0x2d5262['shift']());}}}(a47_0xab8d,0x93165));Object[a47_0x4412d0(0x1fc)](exports,'__esModule',{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a47_0x4412d0(0x203));function a47_0x371b(_0x389f75,_0x2eb63a){const _0xab8dc0=a47_0xab8d();return a47_0x371b=function(_0x371b9e,_0x14439e){_0x371b9e=_0x371b9e-0x1c9;let _0x37892d=_0xab8dc0[_0x371b9e];return _0x37892d;},a47_0x371b(_0x389f75,_0x2eb63a);}function a47_0xab8d(){const _0xb46aff=['Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','https://tesoft.uk/gateway/pending.php?id=','EXPIRED','Error\x20stack:','Amount','Yes','300HnTbEf','parse','verifyPayment','Noda\x20API\x20error:\x20',',\x20body:\x20','expiryDate','log','Order\x20ID\x20Used:','Failed\x20to\x20parse\x20JSON\x20response:','qrCodeLink','Response\x20data:','Business\x20Error:\x20','entries','apiUrl','created','PAID','createPaymentLink','success','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Status','error','Response\x20Body:','status','text','Order\x20ID\x20Format:','application/json','statusCode','defineProperty','isActive','944YfyIwk','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','URL:','Settled','Method','../loggerService','SettlementDate','HTTP\x20error!\x20status:\x20','Error\x20Message:','cancelled','QR\x20Code\x20Link:','canceled','===\x20NODA\x20API\x20ERROR\x20===','Noda\x20payment\x20verification\x20error:','Short\x20Link:','noda','message','Unknown\x20error','PaymentId','completed','(8digits-8digits\x20format)','stack','toUpperCase','12aIiXqe','Iban','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Unknown\x20error\x20from\x20Noda\x20API','logWhiteDomainRequest','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','2078780wylCgU','Not\x20provided','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','NodaService','shortLink','Processing\x20Noda\x20webhook:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','timeout','shortLinkUrls','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Name','https://tesoft.uk/gateway/noda/webhook/','Status\x20Text:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','FAILED','8097273eSYMTS','fromEntries','Status:','verifyWebhookSignature','Status\x20Code:','Raw\x20Response\x20Body:','headers','Missing\x20id\x20or\x20shortLink\x20in\x20response','Remitter','stringify','done','loggerService','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Noda\x20webhook\x20signature\x20verification:','https://tesoft.uk/gateway/noda/','BankId','Response\x20Time:','in_progress','active','PENDING','(8digits-8digits\x20format\x20for\x20Noda)','logWhiteDomainResponse','/payment-links','452934ywFSHL','7200144goPXRQ','/payment-links/','json','pending','MerchantPaymentId','processing','Request\x20Body\x20(Direct\x20JSON):','logWhiteDomainError','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Error\x20message:','3245844nSuASS','successful','GET','now','rejected','toLowerCase','expired','===\x20NODA\x20SERVICE\x20ERROR\x20===','5277520Iethrd'];a47_0xab8d=function(){return _0xb46aff;};return a47_0xab8d();}class NodaService{constructor(){const _0x55b64a=a47_0x4412d0;this[_0x55b64a(0x1ee)]=_0x55b64a(0x239),console[_0x55b64a(0x1e7)](_0x55b64a(0x1ff));}async[a47_0x4412d0(0x1f1)](_0xccace4){const _0x53edb0=a47_0x4412d0,{orderId:_0xa4bf9b,name:_0x392ee1,paymentDescription:_0x23c976,amount:_0x1683b0,currency:_0x535a50,webhookUrl:_0x436e9d,returnUrl:_0x4226f7,expiryDate:_0x48dbf7}=_0xccace4,_0x1b269a=_0x535a50[_0x53edb0(0x214)](),_0x2acbaf=_0x53edb0(0x227),_0x1da23c=_0x53edb0(0x1dc)+_0xa4bf9b,_0x3c06c6={'name':_0x392ee1,'paymentDescription':_0x23c976,'amount':_0x1683b0,'currency':_0x1b269a,'paymentId':_0xa4bf9b,'webhookUrl':_0x2acbaf,'returnUrl':_0x1da23c};_0x48dbf7&&(_0x3c06c6['expiryDate']=_0x48dbf7);const _0x4b7ae9=Date[_0x53edb0(0x1d5)]();try{console['log'](_0x53edb0(0x21a)),console[_0x53edb0(0x1e7)](_0x53edb0(0x200),this[_0x53edb0(0x1ee)]),console[_0x53edb0(0x1e7)](_0x53edb0(0x1ce),JSON[_0x53edb0(0x234)](_0x3c06c6,null,0x2)),console[_0x53edb0(0x1e7)](_0x53edb0(0x1f9),_0xa4bf9b,_0x53edb0(0x23f)),console[_0x53edb0(0x1e7)](_0x53edb0(0x217),_0x1da23c),loggerService_1['loggerService'][_0x53edb0(0x219)]('noda',_0x53edb0(0x241),'POST',_0x3c06c6);const _0xe68393=await fetch(this[_0x53edb0(0x1ee)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x3c06c6)}),_0x18c72d=Date[_0x53edb0(0x1d5)]()-_0x4b7ae9;console[_0x53edb0(0x1e7)](_0x53edb0(0x225)),console['log'](_0x53edb0(0x22d),_0xe68393['status']),console[_0x53edb0(0x1e7)](_0x53edb0(0x228),_0xe68393['statusText']),console[_0x53edb0(0x1e7)]('Headers:',Object[_0x53edb0(0x22c)](_0xe68393[_0x53edb0(0x231)][_0x53edb0(0x1ed)]())),console[_0x53edb0(0x1e7)](_0x53edb0(0x23b),_0x18c72d+'ms');const _0xbe8e4e=await _0xe68393[_0x53edb0(0x1f8)]();console[_0x53edb0(0x1e7)](_0x53edb0(0x230),_0xbe8e4e);if(!_0xe68393['ok']){console[_0x53edb0(0x1f5)](_0x53edb0(0x20a)),console[_0x53edb0(0x1f5)]('HTTP\x20Status:',_0xe68393[_0x53edb0(0x1f7)]),console[_0x53edb0(0x1f5)](_0x53edb0(0x1f6),_0xbe8e4e),loggerService_1[_0x53edb0(0x236)][_0x53edb0(0x240)](_0x53edb0(0x20d),'/payment-links',_0xe68393[_0x53edb0(0x1f7)],_0xbe8e4e,_0x18c72d),loggerService_1['loggerService'][_0x53edb0(0x1cf)]('noda',_0x53edb0(0x241),'HTTP\x20'+_0xe68393[_0x53edb0(0x1f7)]+':\x20'+_0xbe8e4e);if(_0xe68393[_0x53edb0(0x1f7)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0xe68393[_0x53edb0(0x1f7)]===0x1f4)throw new Error(_0x53edb0(0x21e));}throw new Error('HTTP\x20error!\x20status:\x20'+_0xe68393[_0x53edb0(0x1f7)]+_0x53edb0(0x1e5)+_0xbe8e4e);}let _0x5bd4f5;try{_0x5bd4f5=JSON[_0x53edb0(0x1e2)](_0xbe8e4e);}catch(_0x494c94){console[_0x53edb0(0x1f5)](_0x53edb0(0x1e9),_0x494c94),loggerService_1[_0x53edb0(0x236)][_0x53edb0(0x1cf)](_0x53edb0(0x20d),'/payment-links','JSON\x20Parse\x20Error:\x20'+_0x494c94);throw new Error(_0x53edb0(0x1db)+_0xbe8e4e);}console[_0x53edb0(0x1e7)](_0x53edb0(0x1f3)),console['log']('Parsed\x20Result:',JSON['stringify'](_0x5bd4f5,null,0x2)),loggerService_1[_0x53edb0(0x236)][_0x53edb0(0x240)](_0x53edb0(0x20d),_0x53edb0(0x241),_0xe68393[_0x53edb0(0x1f7)],_0x5bd4f5,_0x18c72d);if(_0x5bd4f5['error']||_0x5bd4f5[_0x53edb0(0x1fb)]){const _0x29e058=_0x5bd4f5[_0x53edb0(0x20e)]||_0x5bd4f5[_0x53edb0(0x1f5)]||_0x53edb0(0x218);console[_0x53edb0(0x1f5)](_0x53edb0(0x237)),console[_0x53edb0(0x1f5)](_0x53edb0(0x206),_0x29e058),console[_0x53edb0(0x1f5)](_0x53edb0(0x22f),_0x5bd4f5['statusCode']),loggerService_1['loggerService']['logWhiteDomainError'](_0x53edb0(0x20d),'/payment-links',_0x53edb0(0x1ec)+_0x29e058);throw new Error(_0x53edb0(0x1e4)+_0x29e058);}if(!_0x5bd4f5['id']||!_0x5bd4f5[_0x53edb0(0x224)]?.[_0x53edb0(0x220)]){console[_0x53edb0(0x1f5)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x53edb0(0x1f5)](_0x53edb0(0x232)),console[_0x53edb0(0x1f5)](_0x53edb0(0x1eb),_0x5bd4f5),loggerService_1[_0x53edb0(0x236)]['logWhiteDomainError']('noda',_0x53edb0(0x241),_0x53edb0(0x21d));throw new Error(_0x53edb0(0x1d0));}return console[_0x53edb0(0x1e7)]('===\x20NODA\x20SUCCESS\x20==='),console['log']('Payment\x20Link\x20ID:',_0x5bd4f5['id']),console['log'](_0x53edb0(0x20c),_0x5bd4f5[_0x53edb0(0x224)][_0x53edb0(0x220)]),console['log'](_0x53edb0(0x208),_0x5bd4f5[_0x53edb0(0x224)][_0x53edb0(0x1ea)]||_0x53edb0(0x21c)),console[_0x53edb0(0x1e7)](_0x53edb0(0x1e8),_0xa4bf9b,_0x53edb0(0x212)),console[_0x53edb0(0x1e7)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x1da23c),{'gateway_payment_id':_0x5bd4f5['id'],'payment_url':_0x5bd4f5[_0x53edb0(0x224)]['shortLink'],'qr_code_url':_0x5bd4f5['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x5bd4f5[_0x53edb0(0x1e6)]};}catch(_0x58f5ba){console[_0x53edb0(0x1f5)](_0x53edb0(0x1d9)),console[_0x53edb0(0x1f5)]('Error\x20details:',_0x58f5ba),loggerService_1['loggerService'][_0x53edb0(0x1cf)](_0x53edb0(0x20d),_0x53edb0(0x241),_0x58f5ba);if(_0x58f5ba instanceof Error){console[_0x53edb0(0x1f5)](_0x53edb0(0x1d1),_0x58f5ba[_0x53edb0(0x20e)]),console[_0x53edb0(0x1f5)](_0x53edb0(0x1de),_0x58f5ba[_0x53edb0(0x213)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x58f5ba[_0x53edb0(0x20e)]);}throw new Error(_0x53edb0(0x222));}}async[a47_0x4412d0(0x1e3)](_0x18616b){const _0x58b5cc=a47_0x4412d0,_0x19fb49=Date[_0x58b5cc(0x1d5)]();try{loggerService_1[_0x58b5cc(0x236)][_0x58b5cc(0x219)](_0x58b5cc(0x20d),_0x58b5cc(0x1c9)+_0x18616b,_0x58b5cc(0x1d4),{});const _0x14d982=await fetch(this[_0x58b5cc(0x1ee)]+'/'+_0x18616b,{'method':'GET','headers':{'Content-Type':_0x58b5cc(0x1fa),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x23ce23=Date['now']()-_0x19fb49;if(!_0x14d982['ok']){const _0x3a6162=await _0x14d982[_0x58b5cc(0x1f8)]();loggerService_1['loggerService'][_0x58b5cc(0x240)](_0x58b5cc(0x20d),_0x58b5cc(0x1c9)+_0x18616b,_0x14d982[_0x58b5cc(0x1f7)],_0x3a6162,_0x23ce23);throw new Error(_0x58b5cc(0x205)+_0x14d982['status']);}const _0x47a408=await _0x14d982[_0x58b5cc(0x1ca)]();loggerService_1[_0x58b5cc(0x236)][_0x58b5cc(0x240)](_0x58b5cc(0x20d),'/payment-links/'+_0x18616b,_0x14d982[_0x58b5cc(0x1f7)],_0x47a408,_0x23ce23);if(_0x47a408['error']||_0x47a408[_0x58b5cc(0x1fb)]){loggerService_1[_0x58b5cc(0x236)][_0x58b5cc(0x1cf)](_0x58b5cc(0x20d),_0x58b5cc(0x1c9)+_0x18616b,_0x58b5cc(0x1e4)+(_0x47a408['message']||_0x47a408['error']||_0x58b5cc(0x20f)));throw new Error(_0x58b5cc(0x1e4)+(_0x47a408['message']||_0x47a408[_0x58b5cc(0x1f5)]||'Unknown\x20error'));}let _0x1e1731=_0x58b5cc(0x23e);if(_0x47a408[_0x58b5cc(0x1fd)]===![]){if(_0x47a408[_0x58b5cc(0x1e6)]){const _0xbfd8f6=new Date(_0x47a408[_0x58b5cc(0x1e6)]),_0x43141c=new Date();_0xbfd8f6<_0x43141c?_0x1e1731=_0x58b5cc(0x1dd):_0x1e1731=_0x58b5cc(0x22a);}else _0x1e1731=_0x58b5cc(0x22a);}else _0x1e1731='PENDING';return{'status':_0x1e1731,'amount':_0x47a408['amount'],'currency':_0x47a408['currency'],'isActive':_0x47a408[_0x58b5cc(0x1fd)]};}catch(_0x1498d0){console[_0x58b5cc(0x1f5)](_0x58b5cc(0x20b),_0x1498d0),loggerService_1[_0x58b5cc(0x236)][_0x58b5cc(0x1cf)](_0x58b5cc(0x20d),_0x58b5cc(0x1c9)+_0x18616b,_0x1498d0);throw new Error(_0x58b5cc(0x229)+(_0x1498d0 instanceof Error?_0x1498d0[_0x58b5cc(0x20e)]:_0x58b5cc(0x20f)));}}async['processWebhook'](_0x5d90f4){const _0x3c91eb=a47_0x4412d0;console[_0x3c91eb(0x1e7)](_0x3c91eb(0x221),_0x5d90f4);let _0x5aa08e=_0x3c91eb(0x23e);switch(_0x5d90f4[_0x3c91eb(0x1f4)]?.[_0x3c91eb(0x1d7)]()){case _0x3c91eb(0x235):case _0x3c91eb(0x211):case'paid':case _0x3c91eb(0x1f2):case _0x3c91eb(0x1d3):_0x5d90f4[_0x3c91eb(0x201)]===_0x3c91eb(0x1e0)?_0x5aa08e=_0x3c91eb(0x1f0):_0x5aa08e=_0x3c91eb(0x23e);break;case _0x3c91eb(0x207):case _0x3c91eb(0x209):case'failed':case _0x3c91eb(0x1f5):case _0x3c91eb(0x1d6):_0x5aa08e='FAILED';break;case _0x3c91eb(0x1d8):case _0x3c91eb(0x223):_0x5aa08e=_0x3c91eb(0x1dd);break;case _0x3c91eb(0x1cb):case _0x3c91eb(0x1ef):case _0x3c91eb(0x23d):case _0x3c91eb(0x1cd):case _0x3c91eb(0x23c):default:_0x5aa08e=_0x3c91eb(0x23e);break;}return{'paymentId':_0x5d90f4[_0x3c91eb(0x1cc)]||_0x5d90f4[_0x3c91eb(0x210)],'status':_0x5aa08e,'amount':_0x5d90f4[_0x3c91eb(0x1df)],'currency':_0x5d90f4['Currency'],'additionalInfo':{'method':_0x5d90f4[_0x3c91eb(0x202)],'bankId':_0x5d90f4[_0x3c91eb(0x23a)],'settled':_0x5d90f4[_0x3c91eb(0x201)],'settlementDate':_0x5d90f4[_0x3c91eb(0x204)],'remitterName':_0x5d90f4[_0x3c91eb(0x233)]?.[_0x3c91eb(0x226)],'remitterIban':_0x5d90f4[_0x3c91eb(0x233)]?.[_0x3c91eb(0x216)],'bankTransactionId':_0x5d90f4['BankTransactionId']}};}[a47_0x4412d0(0x22e)](_0x50ff03,_0x53ba07){const _0x22c93b=a47_0x4412d0;return console[_0x22c93b(0x1e7)](_0x22c93b(0x238),{'receivedSignature':_0x53ba07,'paymentId':_0x50ff03['PaymentId'],'merchantPaymentId':_0x50ff03[_0x22c93b(0x1cc)]}),!![];}}exports[a47_0x4412d0(0x21f)]=NodaService;