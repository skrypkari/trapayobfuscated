'use strict';function a71_0x25ad(){const _0x254d52=['Method','Unknown\x20error','logWhiteDomainError','noda','Noda\x20webhook\x20signature\x20verification:','===\x20NODA\x20API\x20ERROR\x20===','shortLink','text','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','QR\x20Code\x20Link:','Currency','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','12tkXZiH','Unknown\x20error\x20from\x20Noda\x20API','HTTP\x20error!\x20status:\x20','Error\x20Message:','3658DVgrjR','1320AFMNSu','verifyPayment','loggerService','apiUrl','headers','processWebhook','EXPIRED','BankTransactionId','(8digits-8digits\x20format\x20for\x20Noda)','expired','logWhiteDomainResponse','20rVMFSE','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Order\x20ID\x20Used:','Not\x20provided','752NIYigU','1630742IOGyif','failed','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','done','log','rejected','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','isActive','/payment-links','Remitter','expiryDate','===\x20NODA\x20SUCCESS\x20===','BankId','statusCode','Request\x20Body\x20(Direct\x20JSON):','PaymentId','error','createPaymentLink','success','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','https://tesoft.uk/gateway/noda/webhook/','/payment-links/','1291410SCEfTR','Response\x20Body:','timeout','json','logWhiteDomainRequest','67830JvSLXw','URL:','NodaService','Raw\x20Response\x20Body:','227469XJbCOq','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','qrCodeLink','Settled','PENDING','Status:','Missing\x20id\x20or\x20shortLink\x20in\x20response','https://tesoft.uk/gateway/noda/','===\x20NODA\x20SERVICE\x20ERROR\x20===','Short\x20Link:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','message','verifyWebhookSignature','amount','processing','__esModule','Business\x20Error:\x20','Yes','1266nVWiyx','(8digits-8digits\x20format)','defineProperty','application/json','Payment\x20System/1.0','HTTP\x20','34130LuFZzK','Processing\x20Noda\x20webhook:','Noda\x20API\x20error:\x20','Noda\x20payment\x20verification\x20error:','Status\x20Code:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','4030488oiIBvj','Amount','statusText','Status','paid','Status\x20Text:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','cancelled','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','toUpperCase','PAID','parse','active','now','successful','GET','FAILED','shortLinkUrls','stack','created','Name','https://tesoft.uk/gateway/pending.php?id=','status','in_progress','Error\x20stack:','Error\x20details:','../loggerService','POST','completed','stringify'];a71_0x25ad=function(){return _0x254d52;};return a71_0x25ad();}const a71_0x58e96a=a71_0x2b24;(function(_0x512d6d,_0x35e338){const _0x511c45=a71_0x2b24,_0x1f28d8=_0x512d6d();while(!![]){try{const _0x5ebe87=-parseInt(_0x511c45(0x1e7))/0x1+parseInt(_0x511c45(0x1d5))/0x2*(-parseInt(_0x511c45(0x1d1))/0x3)+parseInt(_0x511c45(0x224))/0x4+-parseInt(_0x511c45(0x21e))/0x5*(parseInt(_0x511c45(0x218))/0x6)+parseInt(_0x511c45(0x202))/0x7*(parseInt(_0x511c45(0x1e6))/0x8)+parseInt(_0x511c45(0x1fd))/0x9*(-parseInt(_0x511c45(0x1e1))/0xa)+-parseInt(_0x511c45(0x206))/0xb*(-parseInt(_0x511c45(0x1d6))/0xc);if(_0x5ebe87===_0x35e338)break;else _0x1f28d8['push'](_0x1f28d8['shift']());}catch(_0x17bcb1){_0x1f28d8['push'](_0x1f28d8['shift']());}}}(a71_0x25ad,0xca1c8));Object[a71_0x58e96a(0x21a)](exports,a71_0x58e96a(0x215),{'value':!![]}),exports[a71_0x58e96a(0x204)]=void 0x0;function a71_0x2b24(_0x16e8f4,_0x429d5f){_0x16e8f4=_0x16e8f4-0x1c1;const _0x25ad28=a71_0x25ad();let _0x2b2474=_0x25ad28[_0x16e8f4];return _0x2b2474;}const loggerService_1=require(a71_0x58e96a(0x1c1));class NodaService{constructor(){const _0xf7a895=a71_0x58e96a;this[_0xf7a895(0x1d9)]=_0xf7a895(0x20d),console[_0xf7a895(0x1eb)](_0xf7a895(0x22c));}async[a71_0x58e96a(0x1f8)](_0x3a7b2d){const _0x2159e2=a71_0x58e96a,{orderId:_0x3c15db,name:_0x4c81b0,paymentDescription:_0x1b2e01,amount:_0x237a77,currency:_0x217294,webhookUrl:_0x28e908,returnUrl:_0x46beea,expiryDate:_0x5483cc}=_0x3a7b2d,_0x3621d5=_0x217294[_0x2159e2(0x22d)](),_0x2ba33b=_0x2159e2(0x1fb),_0x59dad4=_0x2159e2(0x239)+_0x3c15db,_0x12b026={'name':_0x4c81b0,'paymentDescription':_0x1b2e01,'amount':_0x237a77,'currency':_0x3621d5,'paymentId':_0x3c15db,'webhookUrl':_0x2ba33b,'returnUrl':_0x59dad4};_0x5483cc&&(_0x12b026[_0x2159e2(0x1f1)]=_0x5483cc);const _0xd23b19=Date['now']();try{console[_0x2159e2(0x1eb)](_0x2159e2(0x223)),console['log'](_0x2159e2(0x203),this[_0x2159e2(0x1d9)]),console[_0x2159e2(0x1eb)](_0x2159e2(0x1f5),JSON[_0x2159e2(0x1c4)](_0x12b026,null,0x2)),console[_0x2159e2(0x1eb)]('Order\x20ID\x20Format:',_0x3c15db,_0x2159e2(0x1de)),console[_0x2159e2(0x1eb)](_0x2159e2(0x1d0),_0x59dad4),loggerService_1[_0x2159e2(0x1d8)][_0x2159e2(0x201)](_0x2159e2(0x1c8),_0x2159e2(0x1ef),'POST',_0x12b026);const _0x5c0335=await fetch(this[_0x2159e2(0x1d9)],{'method':_0x2159e2(0x1c2),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x2159e2(0x21c)},'body':JSON[_0x2159e2(0x1c4)](_0x12b026)}),_0x5adf16=Date[_0x2159e2(0x231)]()-_0xd23b19;console['log'](_0x2159e2(0x1cd)),console[_0x2159e2(0x1eb)](_0x2159e2(0x20b),_0x5c0335[_0x2159e2(0x23a)]),console[_0x2159e2(0x1eb)](_0x2159e2(0x229),_0x5c0335[_0x2159e2(0x226)]),console['log']('Headers:',Object['fromEntries'](_0x5c0335[_0x2159e2(0x1da)]['entries']())),console[_0x2159e2(0x1eb)]('Response\x20Time:',_0x5adf16+'ms');const _0x1d173e=await _0x5c0335[_0x2159e2(0x1cc)]();console[_0x2159e2(0x1eb)](_0x2159e2(0x205),_0x1d173e);if(!_0x5c0335['ok']){console['error'](_0x2159e2(0x1ca)),console[_0x2159e2(0x1f7)]('HTTP\x20Status:',_0x5c0335[_0x2159e2(0x23a)]),console[_0x2159e2(0x1f7)](_0x2159e2(0x1fe),_0x1d173e),loggerService_1[_0x2159e2(0x1d8)][_0x2159e2(0x1e0)](_0x2159e2(0x1c8),_0x2159e2(0x1ef),_0x5c0335[_0x2159e2(0x23a)],_0x1d173e,_0x5adf16),loggerService_1[_0x2159e2(0x1d8)]['logWhiteDomainError'](_0x2159e2(0x1c8),_0x2159e2(0x1ef),_0x2159e2(0x21d)+_0x5c0335[_0x2159e2(0x23a)]+':\x20'+_0x1d173e);if(_0x5c0335[_0x2159e2(0x23a)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x5c0335[_0x2159e2(0x23a)]===0x1f4)throw new Error(_0x2159e2(0x210));}throw new Error(_0x2159e2(0x1d3)+_0x5c0335[_0x2159e2(0x23a)]+',\x20body:\x20'+_0x1d173e);}let _0x4f36ec;try{_0x4f36ec=JSON[_0x2159e2(0x22f)](_0x1d173e);}catch(_0x1d5e6c){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x1d5e6c),loggerService_1[_0x2159e2(0x1d8)]['logWhiteDomainError']('noda',_0x2159e2(0x1ef),'JSON\x20Parse\x20Error:\x20'+_0x1d5e6c);throw new Error(_0x2159e2(0x1e3)+_0x1d173e);}console[_0x2159e2(0x1eb)](_0x2159e2(0x1e2)),console['log']('Parsed\x20Result:',JSON[_0x2159e2(0x1c4)](_0x4f36ec,null,0x2)),loggerService_1[_0x2159e2(0x1d8)]['logWhiteDomainResponse']('noda',_0x2159e2(0x1ef),_0x5c0335['status'],_0x4f36ec,_0x5adf16);if(_0x4f36ec[_0x2159e2(0x1f7)]||_0x4f36ec[_0x2159e2(0x1f4)]){const _0x1437d4=_0x4f36ec[_0x2159e2(0x211)]||_0x4f36ec[_0x2159e2(0x1f7)]||_0x2159e2(0x1d2);console['error'](_0x2159e2(0x1e9)),console[_0x2159e2(0x1f7)](_0x2159e2(0x1d4),_0x1437d4),console[_0x2159e2(0x1f7)](_0x2159e2(0x222),_0x4f36ec[_0x2159e2(0x1f4)]),loggerService_1[_0x2159e2(0x1d8)][_0x2159e2(0x1c7)](_0x2159e2(0x1c8),'/payment-links',_0x2159e2(0x216)+_0x1437d4);throw new Error(_0x2159e2(0x220)+_0x1437d4);}if(!_0x4f36ec['id']||!_0x4f36ec[_0x2159e2(0x235)]?.[_0x2159e2(0x1cb)]){console[_0x2159e2(0x1f7)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2159e2(0x1f7)](_0x2159e2(0x20c)),console[_0x2159e2(0x1f7)]('Response\x20data:',_0x4f36ec),loggerService_1['loggerService'][_0x2159e2(0x1c7)](_0x2159e2(0x1c8),_0x2159e2(0x1ef),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x2159e2(0x1eb)](_0x2159e2(0x1f2)),console[_0x2159e2(0x1eb)]('Payment\x20Link\x20ID:',_0x4f36ec['id']),console[_0x2159e2(0x1eb)](_0x2159e2(0x20f),_0x4f36ec['shortLinkUrls'][_0x2159e2(0x1cb)]),console[_0x2159e2(0x1eb)](_0x2159e2(0x1ce),_0x4f36ec[_0x2159e2(0x235)]['qrCodeLink']||_0x2159e2(0x1e5)),console['log'](_0x2159e2(0x1e4),_0x3c15db,_0x2159e2(0x219)),console[_0x2159e2(0x1eb)](_0x2159e2(0x1ed),_0x59dad4),{'gateway_payment_id':_0x4f36ec['id'],'payment_url':_0x4f36ec[_0x2159e2(0x235)][_0x2159e2(0x1cb)],'qr_code_url':_0x4f36ec[_0x2159e2(0x235)][_0x2159e2(0x208)],'expiry_date':_0x4f36ec[_0x2159e2(0x1f1)]};}catch(_0x5230e2){console['error'](_0x2159e2(0x20e)),console[_0x2159e2(0x1f7)](_0x2159e2(0x23d),_0x5230e2),loggerService_1['loggerService'][_0x2159e2(0x1c7)]('noda',_0x2159e2(0x1ef),_0x5230e2);if(_0x5230e2 instanceof Error){console[_0x2159e2(0x1f7)]('Error\x20message:',_0x5230e2['message']),console[_0x2159e2(0x1f7)](_0x2159e2(0x23c),_0x5230e2[_0x2159e2(0x236)]);throw new Error(_0x2159e2(0x1fa)+_0x5230e2[_0x2159e2(0x211)]);}throw new Error(_0x2159e2(0x207));}}async[a71_0x58e96a(0x1d7)](_0x2fc0a1){const _0xa0f638=a71_0x58e96a,_0x2c2383=Date[_0xa0f638(0x231)]();try{loggerService_1[_0xa0f638(0x1d8)]['logWhiteDomainRequest'](_0xa0f638(0x1c8),_0xa0f638(0x1fc)+_0x2fc0a1,_0xa0f638(0x233),{});const _0x286a22=await fetch(this[_0xa0f638(0x1d9)]+'/'+_0x2fc0a1,{'method':_0xa0f638(0x233),'headers':{'Content-Type':_0xa0f638(0x21b),'User-Agent':_0xa0f638(0x21c)}}),_0x55829c=Date['now']()-_0x2c2383;if(!_0x286a22['ok']){const _0x21224a=await _0x286a22['text']();loggerService_1[_0xa0f638(0x1d8)]['logWhiteDomainResponse']('noda','/payment-links/'+_0x2fc0a1,_0x286a22['status'],_0x21224a,_0x55829c);throw new Error(_0xa0f638(0x1d3)+_0x286a22[_0xa0f638(0x23a)]);}const _0x3d4305=await _0x286a22[_0xa0f638(0x200)]();loggerService_1[_0xa0f638(0x1d8)][_0xa0f638(0x1e0)](_0xa0f638(0x1c8),_0xa0f638(0x1fc)+_0x2fc0a1,_0x286a22[_0xa0f638(0x23a)],_0x3d4305,_0x55829c);if(_0x3d4305['error']||_0x3d4305['statusCode']){loggerService_1[_0xa0f638(0x1d8)][_0xa0f638(0x1c7)](_0xa0f638(0x1c8),_0xa0f638(0x1fc)+_0x2fc0a1,_0xa0f638(0x220)+(_0x3d4305[_0xa0f638(0x211)]||_0x3d4305[_0xa0f638(0x1f7)]||_0xa0f638(0x1c6)));throw new Error('Noda\x20API\x20error:\x20'+(_0x3d4305[_0xa0f638(0x211)]||_0x3d4305[_0xa0f638(0x1f7)]||'Unknown\x20error'));}let _0x8e877e=_0xa0f638(0x20a);if(_0x3d4305[_0xa0f638(0x1ee)]===![]){if(_0x3d4305[_0xa0f638(0x1f1)]){const _0x489f6f=new Date(_0x3d4305[_0xa0f638(0x1f1)]),_0x19c2d9=new Date();_0x489f6f<_0x19c2d9?_0x8e877e=_0xa0f638(0x1dc):_0x8e877e=_0xa0f638(0x234);}else _0x8e877e=_0xa0f638(0x234);}else _0x8e877e=_0xa0f638(0x20a);return{'status':_0x8e877e,'amount':_0x3d4305[_0xa0f638(0x213)],'currency':_0x3d4305['currency'],'isActive':_0x3d4305[_0xa0f638(0x1ee)]};}catch(_0xa78392){console['error'](_0xa0f638(0x221),_0xa78392),loggerService_1[_0xa0f638(0x1d8)][_0xa0f638(0x1c7)](_0xa0f638(0x1c8),_0xa0f638(0x1fc)+_0x2fc0a1,_0xa78392);throw new Error(_0xa0f638(0x22a)+(_0xa78392 instanceof Error?_0xa78392[_0xa0f638(0x211)]:'Unknown\x20error'));}}async[a71_0x58e96a(0x1db)](_0x15d48e){const _0x464083=a71_0x58e96a;console[_0x464083(0x1eb)](_0x464083(0x21f),_0x15d48e);let _0x5f2f92=_0x464083(0x20a);switch(_0x15d48e[_0x464083(0x227)]?.['toLowerCase']()){case _0x464083(0x1ea):case _0x464083(0x1c3):case _0x464083(0x228):case _0x464083(0x1f9):case _0x464083(0x232):_0x15d48e[_0x464083(0x209)]===_0x464083(0x217)?_0x5f2f92=_0x464083(0x22e):_0x5f2f92=_0x464083(0x20a);break;case _0x464083(0x22b):case'canceled':case _0x464083(0x1e8):case _0x464083(0x1f7):case _0x464083(0x1ec):_0x5f2f92='FAILED';break;case _0x464083(0x1df):case _0x464083(0x1ff):_0x5f2f92=_0x464083(0x1dc);break;case'pending':case _0x464083(0x237):case _0x464083(0x230):case _0x464083(0x214):case _0x464083(0x23b):default:_0x5f2f92='PENDING';break;}return{'paymentId':_0x15d48e['MerchantPaymentId']||_0x15d48e[_0x464083(0x1f6)],'status':_0x5f2f92,'amount':_0x15d48e[_0x464083(0x225)],'currency':_0x15d48e[_0x464083(0x1cf)],'additionalInfo':{'method':_0x15d48e[_0x464083(0x1c5)],'bankId':_0x15d48e[_0x464083(0x1f3)],'settled':_0x15d48e['Settled'],'settlementDate':_0x15d48e['SettlementDate'],'remitterName':_0x15d48e[_0x464083(0x1f0)]?.[_0x464083(0x238)],'remitterIban':_0x15d48e['Remitter']?.['Iban'],'bankTransactionId':_0x15d48e[_0x464083(0x1dd)]}};}[a71_0x58e96a(0x212)](_0x14b6be,_0x5043ea){const _0x2e2f2a=a71_0x58e96a;return console[_0x2e2f2a(0x1eb)](_0x2e2f2a(0x1c9),{'receivedSignature':_0x5043ea,'paymentId':_0x14b6be[_0x2e2f2a(0x1f6)],'merchantPaymentId':_0x14b6be['MerchantPaymentId']}),!![];}}exports[a71_0x58e96a(0x204)]=NodaService;