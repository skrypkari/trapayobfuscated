'use strict';const a60_0x359931=a60_0x1791;(function(_0x4bbe65,_0x4e38fa){const _0x1b6fb3=a60_0x1791,_0x514274=_0x4bbe65();while(!![]){try{const _0x67aecb=parseInt(_0x1b6fb3(0x13f))/0x1+-parseInt(_0x1b6fb3(0x167))/0x2*(parseInt(_0x1b6fb3(0x11d))/0x3)+parseInt(_0x1b6fb3(0x122))/0x4*(parseInt(_0x1b6fb3(0x10f))/0x5)+-parseInt(_0x1b6fb3(0x12d))/0x6*(parseInt(_0x1b6fb3(0x153))/0x7)+-parseInt(_0x1b6fb3(0x11a))/0x8*(-parseInt(_0x1b6fb3(0x141))/0x9)+parseInt(_0x1b6fb3(0x133))/0xa+-parseInt(_0x1b6fb3(0xf9))/0xb;if(_0x67aecb===_0x4e38fa)break;else _0x514274['push'](_0x514274['shift']());}catch(_0x543a99){_0x514274['push'](_0x514274['shift']());}}}(a60_0xed65,0x900af));function a60_0x1791(_0x5584d0,_0x5c5ba2){_0x5584d0=_0x5584d0-0xf7;const _0xed6582=a60_0xed65();let _0x179107=_0xed6582[_0x5584d0];return _0x179107;}Object[a60_0x359931(0x13b)](exports,'__esModule',{'value':!![]}),exports[a60_0x359931(0x14e)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x2542fe=a60_0x359931;this[_0x2542fe(0x134)]=_0x2542fe(0x12e),console['log'](_0x2542fe(0x131));}async['createPaymentLink'](_0x38133d){const _0x44e9bb=a60_0x359931,{orderId:_0x1cdaa,name:_0x16f98f,paymentDescription:_0x4bb072,amount:_0x26248c,currency:_0x350723,webhookUrl:_0x2d7d4f,returnUrl:_0x4022ae,expiryDate:_0x22a87b}=_0x38133d,_0x42dee5=_0x350723[_0x44e9bb(0x112)](),_0x623eb8=_0x44e9bb(0x168),_0x137188=_0x44e9bb(0x116)+_0x1cdaa,_0x33b4ae={'name':_0x16f98f,'paymentDescription':_0x4bb072,'amount':_0x26248c,'currency':_0x42dee5,'paymentId':_0x1cdaa,'webhookUrl':_0x623eb8,'returnUrl':_0x137188};_0x22a87b&&(_0x33b4ae[_0x44e9bb(0x121)]=_0x22a87b);const _0x9144b=Date['now']();try{console[_0x44e9bb(0x16a)](_0x44e9bb(0xfb)),console[_0x44e9bb(0x16a)](_0x44e9bb(0x13e),this['apiUrl']),console['log'](_0x44e9bb(0x113),JSON['stringify'](_0x33b4ae,null,0x2)),console[_0x44e9bb(0x16a)](_0x44e9bb(0x166),_0x1cdaa,_0x44e9bb(0x106)),console[_0x44e9bb(0x16a)](_0x44e9bb(0x16d),_0x137188),loggerService_1[_0x44e9bb(0x126)][_0x44e9bb(0x162)]('noda','/payment-links','POST',_0x33b4ae);const _0x453f5b=await fetch(this['apiUrl'],{'method':_0x44e9bb(0x12f),'headers':{'Content-Type':_0x44e9bb(0x12a),'Accept':_0x44e9bb(0x12a),'User-Agent':_0x44e9bb(0x107)},'body':JSON[_0x44e9bb(0x101)](_0x33b4ae)}),_0x53ae46=Date[_0x44e9bb(0x139)]()-_0x9144b;console[_0x44e9bb(0x16a)](_0x44e9bb(0x161)),console[_0x44e9bb(0x16a)](_0x44e9bb(0xff),_0x453f5b[_0x44e9bb(0x15e)]),console['log']('Status\x20Text:',_0x453f5b[_0x44e9bb(0x15f)]),console[_0x44e9bb(0x16a)](_0x44e9bb(0x159),Object[_0x44e9bb(0x104)](_0x453f5b[_0x44e9bb(0x135)][_0x44e9bb(0x123)]())),console[_0x44e9bb(0x16a)](_0x44e9bb(0x128),_0x53ae46+'ms');const _0xded7a2=await _0x453f5b[_0x44e9bb(0x105)]();console['log'](_0x44e9bb(0x150),_0xded7a2);if(!_0x453f5b['ok']){console['error'](_0x44e9bb(0x114)),console['error'](_0x44e9bb(0x14a),_0x453f5b['status']),console[_0x44e9bb(0x155)](_0x44e9bb(0x163),_0xded7a2),loggerService_1[_0x44e9bb(0x126)]['logWhiteDomainResponse'](_0x44e9bb(0x146),'/payment-links',_0x453f5b[_0x44e9bb(0x15e)],_0xded7a2,_0x53ae46),loggerService_1[_0x44e9bb(0x126)][_0x44e9bb(0x117)](_0x44e9bb(0x146),_0x44e9bb(0x120),_0x44e9bb(0x143)+_0x453f5b['status']+':\x20'+_0xded7a2);if(_0x453f5b['status']===0x190)throw new Error(_0x44e9bb(0xfa));else{if(_0x453f5b[_0x44e9bb(0x15e)]===0x1f4)throw new Error(_0x44e9bb(0x15a));}throw new Error(_0x44e9bb(0x127)+_0x453f5b['status']+_0x44e9bb(0x158)+_0xded7a2);}let _0x35d8b3;try{_0x35d8b3=JSON['parse'](_0xded7a2);}catch(_0x5979f1){console[_0x44e9bb(0x155)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5979f1),loggerService_1[_0x44e9bb(0x126)]['logWhiteDomainError'](_0x44e9bb(0x146),'/payment-links','JSON\x20Parse\x20Error:\x20'+_0x5979f1);throw new Error(_0x44e9bb(0x100)+_0xded7a2);}console['log'](_0x44e9bb(0x115)),console[_0x44e9bb(0x16a)]('Parsed\x20Result:',JSON[_0x44e9bb(0x101)](_0x35d8b3,null,0x2)),loggerService_1[_0x44e9bb(0x126)]['logWhiteDomainResponse'](_0x44e9bb(0x146),'/payment-links',_0x453f5b[_0x44e9bb(0x15e)],_0x35d8b3,_0x53ae46);if(_0x35d8b3[_0x44e9bb(0x155)]||_0x35d8b3[_0x44e9bb(0x10a)]){const _0x3dede5=_0x35d8b3[_0x44e9bb(0x157)]||_0x35d8b3['error']||_0x44e9bb(0x108);console['error'](_0x44e9bb(0xf8)),console[_0x44e9bb(0x155)](_0x44e9bb(0x12b),_0x3dede5),console[_0x44e9bb(0x155)](_0x44e9bb(0x11b),_0x35d8b3[_0x44e9bb(0x10a)]),loggerService_1[_0x44e9bb(0x126)]['logWhiteDomainError'](_0x44e9bb(0x146),'/payment-links','Business\x20Error:\x20'+_0x3dede5);throw new Error('Noda\x20API\x20error:\x20'+_0x3dede5);}if(!_0x35d8b3['id']||!_0x35d8b3[_0x44e9bb(0x140)]?.[_0x44e9bb(0x14b)]){console[_0x44e9bb(0x155)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x44e9bb(0x155)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console['error'](_0x44e9bb(0x13c),_0x35d8b3),loggerService_1[_0x44e9bb(0x126)][_0x44e9bb(0x117)](_0x44e9bb(0x146),_0x44e9bb(0x120),_0x44e9bb(0x10e));throw new Error(_0x44e9bb(0x165));}return console[_0x44e9bb(0x16a)](_0x44e9bb(0x137)),console['log'](_0x44e9bb(0x147),_0x35d8b3['id']),console[_0x44e9bb(0x16a)]('Short\x20Link:',_0x35d8b3['shortLinkUrls'][_0x44e9bb(0x14b)]),console[_0x44e9bb(0x16a)](_0x44e9bb(0x16b),_0x35d8b3['shortLinkUrls'][_0x44e9bb(0xfd)]||_0x44e9bb(0x110)),console[_0x44e9bb(0x16a)](_0x44e9bb(0x15b),_0x1cdaa,_0x44e9bb(0x14f)),console[_0x44e9bb(0x16a)]('âœ…\x20Return\x20URL\x20configured\x20for\x20pending:',_0x137188),{'gateway_payment_id':_0x35d8b3['id'],'payment_url':_0x35d8b3[_0x44e9bb(0x140)][_0x44e9bb(0x14b)],'qr_code_url':_0x35d8b3['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x35d8b3['expiryDate']};}catch(_0x2f41b2){console[_0x44e9bb(0x155)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x44e9bb(0x155)](_0x44e9bb(0x13a),_0x2f41b2),loggerService_1[_0x44e9bb(0x126)]['logWhiteDomainError'](_0x44e9bb(0x146),_0x44e9bb(0x120),_0x2f41b2);if(_0x2f41b2 instanceof Error){console[_0x44e9bb(0x155)](_0x44e9bb(0x15d),_0x2f41b2[_0x44e9bb(0x157)]),console['error']('Error\x20stack:',_0x2f41b2[_0x44e9bb(0x109)]);throw new Error(_0x44e9bb(0x154)+_0x2f41b2[_0x44e9bb(0x157)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a60_0x359931(0x138)](_0xb4edd9){const _0x23cc89=a60_0x359931,_0xf6e302=Date[_0x23cc89(0x139)]();try{loggerService_1[_0x23cc89(0x126)][_0x23cc89(0x162)](_0x23cc89(0x146),_0x23cc89(0xfc)+_0xb4edd9,_0x23cc89(0x119),{});const _0x3c8f61=await fetch(this[_0x23cc89(0x134)]+'/'+_0xb4edd9,{'method':_0x23cc89(0x119),'headers':{'Content-Type':_0x23cc89(0x12a),'User-Agent':_0x23cc89(0x107)}}),_0x21148e=Date['now']()-_0xf6e302;if(!_0x3c8f61['ok']){const _0x11fee4=await _0x3c8f61['text']();loggerService_1[_0x23cc89(0x126)]['logWhiteDomainResponse'](_0x23cc89(0x146),_0x23cc89(0xfc)+_0xb4edd9,_0x3c8f61[_0x23cc89(0x15e)],_0x11fee4,_0x21148e);throw new Error(_0x23cc89(0x127)+_0x3c8f61[_0x23cc89(0x15e)]);}const _0x49dbcc=await _0x3c8f61['json']();loggerService_1[_0x23cc89(0x126)][_0x23cc89(0x14c)](_0x23cc89(0x146),_0x23cc89(0xfc)+_0xb4edd9,_0x3c8f61[_0x23cc89(0x15e)],_0x49dbcc,_0x21148e);if(_0x49dbcc['error']||_0x49dbcc[_0x23cc89(0x10a)]){loggerService_1[_0x23cc89(0x126)][_0x23cc89(0x117)](_0x23cc89(0x146),_0x23cc89(0xfc)+_0xb4edd9,_0x23cc89(0x13d)+(_0x49dbcc[_0x23cc89(0x157)]||_0x49dbcc[_0x23cc89(0x155)]||'Unknown\x20error'));throw new Error(_0x23cc89(0x13d)+(_0x49dbcc[_0x23cc89(0x157)]||_0x49dbcc['error']||_0x23cc89(0x15c)));}let _0x4dc748=_0x23cc89(0x10d);if(_0x49dbcc['isActive']===![]){if(_0x49dbcc[_0x23cc89(0x121)]){const _0x3ebb59=new Date(_0x49dbcc['expiryDate']),_0x437722=new Date();_0x3ebb59<_0x437722?_0x4dc748='EXPIRED':_0x4dc748='FAILED';}else _0x4dc748=_0x23cc89(0x11e);}else _0x4dc748='PENDING';return{'status':_0x4dc748,'amount':_0x49dbcc[_0x23cc89(0x10b)],'currency':_0x49dbcc[_0x23cc89(0x144)],'isActive':_0x49dbcc[_0x23cc89(0x16c)]};}catch(_0x21482b){console[_0x23cc89(0x155)](_0x23cc89(0x125),_0x21482b),loggerService_1[_0x23cc89(0x126)][_0x23cc89(0x117)](_0x23cc89(0x146),_0x23cc89(0xfc)+_0xb4edd9,_0x21482b);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x21482b instanceof Error?_0x21482b[_0x23cc89(0x157)]:_0x23cc89(0x15c)));}}async[a60_0x359931(0x145)](_0x38f307){const _0x1ae5da=a60_0x359931;console[_0x1ae5da(0x16a)]('Processing\x20Noda\x20webhook:',_0x38f307);let _0x1fa572=_0x1ae5da(0x10d);switch(_0x38f307[_0x1ae5da(0x103)]?.[_0x1ae5da(0x11c)]()){case _0x1ae5da(0x156):case _0x1ae5da(0xfe):case'paid':case _0x1ae5da(0x11f):case _0x1ae5da(0x130):_0x38f307[_0x1ae5da(0x10c)]===_0x1ae5da(0x149)?_0x1fa572=_0x1ae5da(0x129):_0x1fa572=_0x1ae5da(0x10d);break;case _0x1ae5da(0x132):case _0x1ae5da(0x12c):case'failed':case'error':case _0x1ae5da(0x169):_0x1fa572=_0x1ae5da(0x11e);break;case _0x1ae5da(0x148):case _0x1ae5da(0xf7):_0x1fa572=_0x1ae5da(0x152);break;case'pending':case _0x1ae5da(0x160):case'active':case _0x1ae5da(0x136):case'in_progress':default:_0x1fa572=_0x1ae5da(0x10d);break;}return{'paymentId':_0x38f307[_0x1ae5da(0x118)]||_0x38f307[_0x1ae5da(0x142)],'status':_0x1fa572,'amount':_0x38f307[_0x1ae5da(0x14d)],'currency':_0x38f307['Currency'],'additionalInfo':{'method':_0x38f307[_0x1ae5da(0x164)],'bankId':_0x38f307[_0x1ae5da(0x111)],'settled':_0x38f307[_0x1ae5da(0x10c)],'settlementDate':_0x38f307[_0x1ae5da(0x102)],'remitterName':_0x38f307[_0x1ae5da(0x151)]?.['Name'],'remitterIban':_0x38f307[_0x1ae5da(0x151)]?.[_0x1ae5da(0x124)],'bankTransactionId':_0x38f307['BankTransactionId']}};}['verifyWebhookSignature'](_0x165464,_0x5a675a){const _0x73bb5a=a60_0x359931;return console[_0x73bb5a(0x16a)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x5a675a,'paymentId':_0x165464[_0x73bb5a(0x142)],'merchantPaymentId':_0x165464[_0x73bb5a(0x118)]}),!![];}}exports[a60_0x359931(0x14e)]=NodaService;function a60_0xed65(){const _0x16c396=['Yes','HTTP\x20Status:','shortLink','logWhiteDomainResponse','Amount','NodaService','(8digits-8digits\x20format)','Raw\x20Response\x20Body:','Remitter','EXPIRED','182ujqFlU','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','error','done','message',',\x20body:\x20','Headers:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Order\x20ID\x20Used:','Unknown\x20error','Error\x20message:','status','statusText','created','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainRequest','Response\x20Body:','Method','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Order\x20ID\x20Format:','4JKSScF','https://tesoft.uk/gateway/noda/webhook/','rejected','log','QR\x20Code\x20Link:','isActive','âœ…\x20ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž:\x20Return\x20URL\x20uses\x20pending.php:','timeout','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','8401866KfYtMD','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','/payment-links/','qrCodeLink','completed','Status:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','stringify','SettlementDate','Status','fromEntries','text','(8digits-8digits\x20format\x20for\x20Noda)','Payment\x20System/1.0','Unknown\x20error\x20from\x20Noda\x20API','stack','statusCode','amount','Settled','PENDING','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','1687315rmfvDo','Not\x20provided','BankId','toUpperCase','Request\x20Body\x20(Direct\x20JSON):','===\x20NODA\x20API\x20ERROR\x20===','===\x20PARSED\x20NODA\x20RESPONSE\x20===','https://tesoft.uk/gateway/pending.php?id=','logWhiteDomainError','MerchantPaymentId','GET','112YkQxlk','Status\x20Code:','toLowerCase','1106529GxhGYF','FAILED','success','/payment-links','expiryDate','12DnPfBf','entries','Iban','Noda\x20payment\x20verification\x20error:','loggerService','HTTP\x20error!\x20status:\x20','Response\x20Time:','PAID','application/json','Error\x20Message:','canceled','159096qxuItz','https://tesoft.uk/gateway/noda/','POST','successful','ðŸŒ\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','cancelled','3113740vvzNpx','apiUrl','headers','processing','===\x20NODA\x20SUCCESS\x20===','verifyPayment','now','Error\x20details:','defineProperty','Response\x20data:','Noda\x20API\x20error:\x20','URL:','382322Mtwokz','shortLinkUrls','690957ToHKUi','PaymentId','HTTP\x20','currency','processWebhook','noda','Payment\x20Link\x20ID:','expired'];a60_0xed65=function(){return _0x16c396;};return a60_0xed65();}