'use strict';const a43_0x319aef=a43_0x150a;(function(_0x124105,_0x4315cb){const _0x1c2ec4=a43_0x150a,_0x411446=_0x124105();while(!![]){try{const _0x220339=-parseInt(_0x1c2ec4(0xdc))/0x1*(parseInt(_0x1c2ec4(0x79))/0x2)+parseInt(_0x1c2ec4(0xab))/0x3*(parseInt(_0x1c2ec4(0xa2))/0x4)+parseInt(_0x1c2ec4(0x8b))/0x5*(parseInt(_0x1c2ec4(0x7e))/0x6)+parseInt(_0x1c2ec4(0x7d))/0x7+-parseInt(_0x1c2ec4(0x95))/0x8*(-parseInt(_0x1c2ec4(0xbd))/0x9)+parseInt(_0x1c2ec4(0x97))/0xa+-parseInt(_0x1c2ec4(0xce))/0xb;if(_0x220339===_0x4315cb)break;else _0x411446['push'](_0x411446['shift']());}catch(_0x17049a){_0x411446['push'](_0x411446['shift']());}}}(a43_0x3945,0xcd3aa));function a43_0x150a(_0x296b6b,_0x8d92df){const _0x394509=a43_0x3945();return a43_0x150a=function(_0x150ab1,_0x16e2b6){_0x150ab1=_0x150ab1-0x67;let _0x35497e=_0x394509[_0x150ab1];return _0x35497e;},a43_0x150a(_0x296b6b,_0x8d92df);}Object[a43_0x319aef(0x9b)](exports,a43_0x319aef(0xac),{'value':!![]}),exports[a43_0x319aef(0xc0)]=void 0x0;function a43_0x3945(){const _0x271cd8=['GET','cancelled','Amount','===\x20NODA\x20API\x20ERROR\x20===','JSON\x20Parse\x20Error:\x20','TesSoft\x20Payment\x20System/1.0','createPaymentLink','logWhiteDomainRequest','Business\x20Error:\x20','63pVNnpK','expired','../loggerService','NodaService','Payment\x20Link\x20ID:','Status:','Noda\x20API\x20error:\x20','Iban','EXPIRED','shortLinkUrls','Error\x20details:','Processing\x20Noda\x20webhook:','toLowerCase','Parsed\x20Result:','shortLink','MerchantPaymentId','processing','11922911jsiFCD','error','===\x20NODA\x20SERVICE\x20ERROR\x20===','Status','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','PaymentId','now','in_progress','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','stack','fromEntries','Unknown\x20error','text','1951aWjuIt','amount','canceled','Noda\x20payment\x20verification\x20error:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','done','isActive','Not\x20provided','logWhiteDomainResponse','processWebhook','POST','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Unknown\x20error\x20from\x20Noda\x20API','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','FAILED','Yes','log','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','URL:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','currency','Status\x20Code:','Response\x20Body:','/payment-links/','statusCode','===\x20PARSED\x20NODA\x20RESPONSE\x20===','QR\x20Code\x20Link:','892Lqpegf','logWhiteDomainError','Settled','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','734552BkqaCH','65892nHglDb','headers','(8digits-8digits\x20format)',',\x20body:\x20','SettlementDate','Failed\x20to\x20verify\x20Noda\x20payment:\x20','===\x20NODA\x20SUCCESS\x20===','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','failed','HTTP\x20Status:','successful','Order\x20ID\x20Format:','statusText','515IFbiAp','completed','paid','Failed\x20to\x20parse\x20JSON\x20response:','PENDING','parse','qrCodeLink','rejected','Currency','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','737416ogOaeD','HTTP\x20error!\x20status:\x20','3450820qHyArQ','loggerService','Remitter','BankId','defineProperty','https://tesoft.uk/gateway/noda/webhook/','message','status','stringify','Status\x20Text:','Error\x20stack:','2273048eMWNmC','application/json','active','noda','Headers:','Order\x20ID\x20Used:','/payment-links','HTTP\x20','apiUrl','3fcQiwi','__esModule','verifyWebhookSignature','entries','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','timeout','Method','Response\x20data:','expiryDate'];a43_0x3945=function(){return _0x271cd8;};return a43_0x3945();}const loggerService_1=require(a43_0x319aef(0xbf));class NodaService{constructor(){const _0xcba3d7=a43_0x319aef;this['apiUrl']='https://tesoft.uk/gateway/noda/',console[_0xcba3d7(0x6e)](_0xcba3d7(0xe0));}async[a43_0x319aef(0xba)](_0x49d594){const _0x3f84d3=a43_0x319aef,{orderId:_0x29e8c3,name:_0x4045a4,paymentDescription:_0x3ef006,amount:_0x1c1b34,currency:_0x28497b,webhookUrl:_0x3f066b,returnUrl:_0xfc1f4b,expiryDate:_0x207ac3}=_0x49d594,_0x2c6749=_0x28497b['toUpperCase'](),_0x415502=_0x3f84d3(0x9c),_0x22b346='https://tesoft.uk/gateway/pending.php?id='+_0x29e8c3,_0xf72ab5={'name':_0x4045a4,'paymentDescription':_0x3ef006,'amount':_0x1c1b34,'currency':_0x2c6749,'paymentId':_0x29e8c3,'webhookUrl':_0x415502,'returnUrl':_0x22b346};_0x207ac3&&(_0xf72ab5['expiryDate']=_0x207ac3);const _0xf61f23=Date[_0x3f84d3(0xd5)]();try{console[_0x3f84d3(0x6e)](_0x3f84d3(0x71)),console['log'](_0x3f84d3(0x70),this[_0x3f84d3(0xaa)]),console[_0x3f84d3(0x6e)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x3f84d3(0x9f)](_0xf72ab5,null,0x2)),console[_0x3f84d3(0x6e)](_0x3f84d3(0x89),_0x29e8c3,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x3f84d3(0x6e)](_0x3f84d3(0x69),_0x22b346),loggerService_1['loggerService'][_0x3f84d3(0xbb)](_0x3f84d3(0xa5),_0x3f84d3(0xa8),_0x3f84d3(0x68),_0xf72ab5);const _0x3b41af=await fetch(this['apiUrl'],{'method':_0x3f84d3(0x68),'headers':{'Content-Type':_0x3f84d3(0xa3),'Accept':'application/json','User-Agent':_0x3f84d3(0xb9)},'body':JSON[_0x3f84d3(0x9f)](_0xf72ab5)}),_0x2c8c90=Date[_0x3f84d3(0xd5)]()-_0xf61f23;console[_0x3f84d3(0x6e)](_0x3f84d3(0x7c)),console[_0x3f84d3(0x6e)](_0x3f84d3(0xc2),_0x3b41af[_0x3f84d3(0x9e)]),console['log'](_0x3f84d3(0xa0),_0x3b41af[_0x3f84d3(0x8a)]),console[_0x3f84d3(0x6e)](_0x3f84d3(0xa6),Object[_0x3f84d3(0xd9)](_0x3b41af[_0x3f84d3(0x7f)][_0x3f84d3(0xae)]())),console[_0x3f84d3(0x6e)]('Response\x20Time:',_0x2c8c90+'ms');const _0x3f3d1f=await _0x3b41af[_0x3f84d3(0xdb)]();console['log']('Raw\x20Response\x20Body:',_0x3f3d1f);if(!_0x3b41af['ok']){console[_0x3f84d3(0xcf)](_0x3f84d3(0xb7)),console[_0x3f84d3(0xcf)](_0x3f84d3(0x87),_0x3b41af[_0x3f84d3(0x9e)]),console['error'](_0x3f84d3(0x74),_0x3f3d1f),loggerService_1[_0x3f84d3(0x98)]['logWhiteDomainResponse'](_0x3f84d3(0xa5),_0x3f84d3(0xa8),_0x3b41af[_0x3f84d3(0x9e)],_0x3f3d1f,_0x2c8c90),loggerService_1['loggerService'][_0x3f84d3(0x7a)]('noda',_0x3f84d3(0xa8),_0x3f84d3(0xa9)+_0x3b41af[_0x3f84d3(0x9e)]+':\x20'+_0x3f3d1f);if(_0x3b41af[_0x3f84d3(0x9e)]===0x190)throw new Error(_0x3f84d3(0x94));else{if(_0x3b41af['status']===0x1f4)throw new Error(_0x3f84d3(0x6b));}throw new Error(_0x3f84d3(0x96)+_0x3b41af[_0x3f84d3(0x9e)]+_0x3f84d3(0x81)+_0x3f3d1f);}let _0x15eb42;try{_0x15eb42=JSON[_0x3f84d3(0x90)](_0x3f3d1f);}catch(_0x5edb46){console[_0x3f84d3(0xcf)](_0x3f84d3(0x8e),_0x5edb46),loggerService_1[_0x3f84d3(0x98)][_0x3f84d3(0x7a)](_0x3f84d3(0xa5),_0x3f84d3(0xa8),_0x3f84d3(0xb8)+_0x5edb46);throw new Error(_0x3f84d3(0x6f)+_0x3f3d1f);}console[_0x3f84d3(0x6e)](_0x3f84d3(0x77)),console['log'](_0x3f84d3(0xca),JSON[_0x3f84d3(0x9f)](_0x15eb42,null,0x2)),loggerService_1[_0x3f84d3(0x98)]['logWhiteDomainResponse']('noda',_0x3f84d3(0xa8),_0x3b41af[_0x3f84d3(0x9e)],_0x15eb42,_0x2c8c90);if(_0x15eb42[_0x3f84d3(0xcf)]||_0x15eb42[_0x3f84d3(0x76)]){const _0x588d79=_0x15eb42[_0x3f84d3(0x9d)]||_0x15eb42['error']||_0x3f84d3(0x6a);console[_0x3f84d3(0xcf)](_0x3f84d3(0xd2)),console[_0x3f84d3(0xcf)]('Error\x20Message:',_0x588d79),console[_0x3f84d3(0xcf)](_0x3f84d3(0x73),_0x15eb42[_0x3f84d3(0x76)]),loggerService_1[_0x3f84d3(0x98)][_0x3f84d3(0x7a)](_0x3f84d3(0xa5),_0x3f84d3(0xa8),_0x3f84d3(0xbc)+_0x588d79);throw new Error('Noda\x20API\x20error:\x20'+_0x588d79);}if(!_0x15eb42['id']||!_0x15eb42[_0x3f84d3(0xc6)]?.[_0x3f84d3(0xcb)]){console[_0x3f84d3(0xcf)](_0x3f84d3(0xd7)),console[_0x3f84d3(0xcf)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x3f84d3(0xcf)](_0x3f84d3(0xb2),_0x15eb42),loggerService_1['loggerService'][_0x3f84d3(0x7a)](_0x3f84d3(0xa5),'/payment-links',_0x3f84d3(0x85));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x3f84d3(0x6e)](_0x3f84d3(0x84)),console['log'](_0x3f84d3(0xc1),_0x15eb42['id']),console[_0x3f84d3(0x6e)]('Short\x20Link:',_0x15eb42[_0x3f84d3(0xc6)][_0x3f84d3(0xcb)]),console[_0x3f84d3(0x6e)](_0x3f84d3(0x78),_0x15eb42[_0x3f84d3(0xc6)][_0x3f84d3(0x91)]||_0x3f84d3(0xe3)),console[_0x3f84d3(0x6e)](_0x3f84d3(0xa7),_0x29e8c3,_0x3f84d3(0x80)),console[_0x3f84d3(0x6e)](_0x3f84d3(0xaf),_0x22b346),{'gateway_payment_id':_0x15eb42['id'],'payment_url':_0x15eb42[_0x3f84d3(0xc6)][_0x3f84d3(0xcb)],'qr_code_url':_0x15eb42[_0x3f84d3(0xc6)]['qrCodeLink'],'expiry_date':_0x15eb42['expiryDate']};}catch(_0x576012){console[_0x3f84d3(0xcf)](_0x3f84d3(0xd0)),console[_0x3f84d3(0xcf)](_0x3f84d3(0xc7),_0x576012),loggerService_1[_0x3f84d3(0x98)][_0x3f84d3(0x7a)](_0x3f84d3(0xa5),_0x3f84d3(0xa8),_0x576012);if(_0x576012 instanceof Error){console[_0x3f84d3(0xcf)]('Error\x20message:',_0x576012[_0x3f84d3(0x9d)]),console['error'](_0x3f84d3(0xa1),_0x576012[_0x3f84d3(0xd8)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x576012['message']);}throw new Error(_0x3f84d3(0xd3));}}async['verifyPayment'](_0x3aab27){const _0x3c3fa9=a43_0x319aef,_0x4e1af5=Date[_0x3c3fa9(0xd5)]();try{loggerService_1[_0x3c3fa9(0x98)][_0x3c3fa9(0xbb)](_0x3c3fa9(0xa5),_0x3c3fa9(0x75)+_0x3aab27,_0x3c3fa9(0xb4),{});const _0x2504a1=await fetch(this[_0x3c3fa9(0xaa)]+'/'+_0x3aab27,{'method':'GET','headers':{'Content-Type':_0x3c3fa9(0xa3),'User-Agent':_0x3c3fa9(0xb9)}}),_0xc391e4=Date[_0x3c3fa9(0xd5)]()-_0x4e1af5;if(!_0x2504a1['ok']){const _0x5baa52=await _0x2504a1['text']();loggerService_1[_0x3c3fa9(0x98)][_0x3c3fa9(0xe4)](_0x3c3fa9(0xa5),_0x3c3fa9(0x75)+_0x3aab27,_0x2504a1[_0x3c3fa9(0x9e)],_0x5baa52,_0xc391e4);throw new Error(_0x3c3fa9(0x96)+_0x2504a1[_0x3c3fa9(0x9e)]);}const _0x4475a1=await _0x2504a1['json']();loggerService_1[_0x3c3fa9(0x98)]['logWhiteDomainResponse']('noda','/payment-links/'+_0x3aab27,_0x2504a1[_0x3c3fa9(0x9e)],_0x4475a1,_0xc391e4);if(_0x4475a1[_0x3c3fa9(0xcf)]||_0x4475a1[_0x3c3fa9(0x76)]){loggerService_1[_0x3c3fa9(0x98)][_0x3c3fa9(0x7a)](_0x3c3fa9(0xa5),_0x3c3fa9(0x75)+_0x3aab27,_0x3c3fa9(0xc3)+(_0x4475a1[_0x3c3fa9(0x9d)]||_0x4475a1[_0x3c3fa9(0xcf)]||_0x3c3fa9(0xda)));throw new Error('Noda\x20API\x20error:\x20'+(_0x4475a1[_0x3c3fa9(0x9d)]||_0x4475a1[_0x3c3fa9(0xcf)]||_0x3c3fa9(0xda)));}let _0x176e56=_0x3c3fa9(0x8f);if(_0x4475a1[_0x3c3fa9(0xe2)]===![]){if(_0x4475a1[_0x3c3fa9(0xb3)]){const _0x202d9d=new Date(_0x4475a1['expiryDate']),_0x576f4a=new Date();_0x202d9d<_0x576f4a?_0x176e56=_0x3c3fa9(0xc5):_0x176e56='FAILED';}else _0x176e56='FAILED';}else _0x176e56=_0x3c3fa9(0x8f);return{'status':_0x176e56,'amount':_0x4475a1[_0x3c3fa9(0xdd)],'currency':_0x4475a1[_0x3c3fa9(0x72)],'isActive':_0x4475a1[_0x3c3fa9(0xe2)]};}catch(_0x1d059a){console['error'](_0x3c3fa9(0xdf),_0x1d059a),loggerService_1[_0x3c3fa9(0x98)][_0x3c3fa9(0x7a)](_0x3c3fa9(0xa5),_0x3c3fa9(0x75)+_0x3aab27,_0x1d059a);throw new Error(_0x3c3fa9(0x83)+(_0x1d059a instanceof Error?_0x1d059a[_0x3c3fa9(0x9d)]:_0x3c3fa9(0xda)));}}async[a43_0x319aef(0x67)](_0x452df4){const _0x664cbb=a43_0x319aef;console['log'](_0x664cbb(0xc8),_0x452df4);let _0x45bf2b=_0x664cbb(0x8f);switch(_0x452df4[_0x664cbb(0xd1)]?.[_0x664cbb(0xc9)]()){case _0x664cbb(0xe1):case _0x664cbb(0x8c):case _0x664cbb(0x8d):case'success':case _0x664cbb(0x88):_0x452df4[_0x664cbb(0x7b)]===_0x664cbb(0x6d)?_0x45bf2b='PAID':_0x45bf2b=_0x664cbb(0x8f);break;case _0x664cbb(0xb5):case _0x664cbb(0xde):case _0x664cbb(0x86):case'error':case _0x664cbb(0x92):_0x45bf2b=_0x664cbb(0x6c);break;case _0x664cbb(0xbe):case _0x664cbb(0xb0):_0x45bf2b=_0x664cbb(0xc5);break;case'pending':case'created':case _0x664cbb(0xa4):case _0x664cbb(0xcd):case _0x664cbb(0xd6):default:_0x45bf2b=_0x664cbb(0x8f);break;}return{'paymentId':_0x452df4[_0x664cbb(0xcc)]||_0x452df4[_0x664cbb(0xd4)],'status':_0x45bf2b,'amount':_0x452df4[_0x664cbb(0xb6)],'currency':_0x452df4[_0x664cbb(0x93)],'additionalInfo':{'method':_0x452df4[_0x664cbb(0xb1)],'bankId':_0x452df4[_0x664cbb(0x9a)],'settled':_0x452df4[_0x664cbb(0x7b)],'settlementDate':_0x452df4[_0x664cbb(0x82)],'remitterName':_0x452df4['Remitter']?.['Name'],'remitterIban':_0x452df4[_0x664cbb(0x99)]?.[_0x664cbb(0xc4)],'bankTransactionId':_0x452df4['BankTransactionId']}};}[a43_0x319aef(0xad)](_0x30469d,_0x31203b){const _0x4fbbdf=a43_0x319aef;return console[_0x4fbbdf(0x6e)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x31203b,'paymentId':_0x30469d[_0x4fbbdf(0xd4)],'merchantPaymentId':_0x30469d[_0x4fbbdf(0xcc)]}),!![];}}exports[a43_0x319aef(0xc0)]=NodaService;