'use strict';function a65_0x29ec(){const _0x2cd968=['Error\x20message:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','(8digits-8digits\x20format\x20for\x20Noda)','message','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','168430NUnHRZ','failed','json','Payment\x20System/1.0','now',',\x20body:\x20','qrCodeLink','shortLinkUrls','shortLink','pending','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Settled','verifyWebhookSignature','Request\x20Body\x20(Direct\x20JSON):','success','/payment-links','/payment-links/','GET','Short\x20Link:','logWhiteDomainError','===\x20NODA\x20SUCCESS\x20===','PAID','statusCode','Error\x20Message:','HTTP\x20error!\x20status:\x20','__esModule','HTTP\x20','toUpperCase','Raw\x20Response\x20Body:','Unknown\x20error\x20from\x20Noda\x20API','logWhiteDomainRequest','canceled','59132xOtOpZ','done','Unknown\x20error','Not\x20provided','Status','Currency','completed','2107917XmFWVI','processing','apiUrl','text','headers','Status\x20Code:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','paid','2580hHGtIS','loggerService','===\x20NODA\x20API\x20ERROR\x20===','URL:','logWhiteDomainResponse','stringify','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','currency','rejected','in_progress','Noda\x20payment\x20verification\x20error:','PENDING','HTTP\x20Status:','log','Business\x20Error:\x20','QR\x20Code\x20Link:','EXPIRED','16504792nQlkkU','POST','FAILED','application/json','expiryDate','successful','3540380xgqRYw','../loggerService','===\x20NODA\x20SERVICE\x20ERROR\x20===','isActive','noda','Noda\x20webhook\x20signature\x20verification:','Status\x20Text:','entries','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PaymentId','209602UBBVuJ','Order\x20ID\x20Used:','processWebhook','Method','Payment\x20Link\x20ID:','Noda\x20API\x20error:\x20','Yes','Missing\x20id\x20or\x20shortLink\x20in\x20response','amount','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20parse\x20JSON\x20response:','status','(8digits-8digits\x20format)','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','https://tesoft.uk/gateway/pending.php?id=','MerchantPaymentId','toLowerCase','defineProperty','error','SettlementDate','JSON\x20Parse\x20Error:\x20','https://tesoft.uk/gateway/noda/','fromEntries','BankTransactionId','15302OhrdXS','Error\x20details:','Status:','Parsed\x20Result:'];a65_0x29ec=function(){return _0x2cd968;};return a65_0x29ec();}const a65_0x2947a8=a65_0x2388;(function(_0x2beec4,_0x41331c){const _0x25ad44=a65_0x2388,_0x5399e3=_0x2beec4();while(!![]){try{const _0x560353=parseInt(_0x25ad44(0x176))/0x1+parseInt(_0x25ad44(0x197))/0x2+parseInt(_0x25ad44(0x1bf))/0x3+parseInt(_0x25ad44(0x1b8))/0x4+parseInt(_0x25ad44(0x1df))/0x5+-parseInt(_0x25ad44(0x1c7))/0x6*(-parseInt(_0x25ad44(0x18e))/0x7)+-parseInt(_0x25ad44(0x1d9))/0x8;if(_0x560353===_0x41331c)break;else _0x5399e3['push'](_0x5399e3['shift']());}catch(_0x31ac6f){_0x5399e3['push'](_0x5399e3['shift']());}}}(a65_0x29ec,0x918e4));function a65_0x2388(_0x479c0c,_0x1e51df){_0x479c0c=_0x479c0c-0x16e;const _0x29ec41=a65_0x29ec();let _0x2388c2=_0x29ec41[_0x479c0c];return _0x2388c2;}Object[a65_0x2947a8(0x187)](exports,a65_0x2947a8(0x1b1),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a65_0x2947a8(0x1e0));class NodaService{constructor(){const _0xe2ca86=a65_0x2947a8;this[_0xe2ca86(0x1c1)]=_0xe2ca86(0x18b),console['log'](_0xe2ca86(0x174));}async['createPaymentLink'](_0x22ad55){const _0x49eefa=a65_0x2947a8,{orderId:_0x22ab74,name:_0x560f71,paymentDescription:_0x38478f,amount:_0x654f71,currency:_0x3c5de6,webhookUrl:_0x3a3a26,returnUrl:_0x5ccaba,expiryDate:_0x2b0fce}=_0x22ad55,_0x2f5c56=_0x3c5de6[_0x49eefa(0x1b3)](),_0x13fbaa='https://tesoft.uk/gateway/noda/webhook/',_0x5a7df1=_0x49eefa(0x184)+_0x22ab74,_0x3cde11={'name':_0x560f71,'paymentDescription':_0x38478f,'amount':_0x654f71,'currency':_0x2f5c56,'paymentId':_0x22ab74,'webhookUrl':_0x13fbaa,'returnUrl':_0x5a7df1};_0x2b0fce&&(_0x3cde11[_0x49eefa(0x1dd)]=_0x2b0fce);const _0x46d65f=Date['now']();try{console[_0x49eefa(0x1d5)](_0x49eefa(0x1ce)),console[_0x49eefa(0x1d5)](_0x49eefa(0x1ca),this['apiUrl']),console['log'](_0x49eefa(0x1a5),JSON[_0x49eefa(0x1cc)](_0x3cde11,null,0x2)),console[_0x49eefa(0x1d5)]('Order\x20ID\x20Format:',_0x22ab74,_0x49eefa(0x194)),console['log']('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x5a7df1),loggerService_1['loggerService'][_0x49eefa(0x1b6)](_0x49eefa(0x170),_0x49eefa(0x1a7),_0x49eefa(0x1da),_0x3cde11);const _0x282424=await fetch(this[_0x49eefa(0x1c1)],{'method':_0x49eefa(0x1da),'headers':{'Content-Type':_0x49eefa(0x1dc),'Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x49eefa(0x1cc)](_0x3cde11)}),_0x54fe8b=Date[_0x49eefa(0x19b)]()-_0x46d65f;console[_0x49eefa(0x1d5)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x49eefa(0x1d5)](_0x49eefa(0x190),_0x282424[_0x49eefa(0x181)]),console[_0x49eefa(0x1d5)](_0x49eefa(0x172),_0x282424['statusText']),console[_0x49eefa(0x1d5)]('Headers:',Object[_0x49eefa(0x18c)](_0x282424[_0x49eefa(0x1c3)][_0x49eefa(0x173)]())),console['log']('Response\x20Time:',_0x54fe8b+'ms');const _0x623e21=await _0x282424['text']();console[_0x49eefa(0x1d5)](_0x49eefa(0x1b4),_0x623e21);if(!_0x282424['ok']){console[_0x49eefa(0x188)](_0x49eefa(0x1c9)),console['error'](_0x49eefa(0x1d4),_0x282424[_0x49eefa(0x181)]),console[_0x49eefa(0x188)]('Response\x20Body:',_0x623e21),loggerService_1[_0x49eefa(0x1c8)][_0x49eefa(0x1cb)](_0x49eefa(0x170),_0x49eefa(0x1a7),_0x282424['status'],_0x623e21,_0x54fe8b),loggerService_1[_0x49eefa(0x1c8)][_0x49eefa(0x1ab)](_0x49eefa(0x170),_0x49eefa(0x1a7),_0x49eefa(0x1b2)+_0x282424[_0x49eefa(0x181)]+':\x20'+_0x623e21);if(_0x282424[_0x49eefa(0x181)]===0x190)throw new Error(_0x49eefa(0x196));else{if(_0x282424[_0x49eefa(0x181)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x49eefa(0x1b0)+_0x282424['status']+_0x49eefa(0x19c)+_0x623e21);}let _0x521af5;try{_0x521af5=JSON['parse'](_0x623e21);}catch(_0x2ee7b5){console[_0x49eefa(0x188)](_0x49eefa(0x180),_0x2ee7b5),loggerService_1[_0x49eefa(0x1c8)]['logWhiteDomainError'](_0x49eefa(0x170),_0x49eefa(0x1a7),_0x49eefa(0x18a)+_0x2ee7b5);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x623e21);}console[_0x49eefa(0x1d5)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x49eefa(0x1d5)](_0x49eefa(0x191),JSON['stringify'](_0x521af5,null,0x2)),loggerService_1[_0x49eefa(0x1c8)][_0x49eefa(0x1cb)](_0x49eefa(0x170),'/payment-links',_0x282424[_0x49eefa(0x181)],_0x521af5,_0x54fe8b);if(_0x521af5[_0x49eefa(0x188)]||_0x521af5['statusCode']){const _0x452ccd=_0x521af5[_0x49eefa(0x195)]||_0x521af5[_0x49eefa(0x188)]||_0x49eefa(0x1b5);console[_0x49eefa(0x188)](_0x49eefa(0x193)),console[_0x49eefa(0x188)](_0x49eefa(0x1af),_0x452ccd),console['error'](_0x49eefa(0x1c4),_0x521af5[_0x49eefa(0x1ae)]),loggerService_1[_0x49eefa(0x1c8)]['logWhiteDomainError'](_0x49eefa(0x170),_0x49eefa(0x1a7),_0x49eefa(0x1d6)+_0x452ccd);throw new Error(_0x49eefa(0x17b)+_0x452ccd);}if(!_0x521af5['id']||!_0x521af5[_0x49eefa(0x19e)]?.[_0x49eefa(0x19f)]){console[_0x49eefa(0x188)](_0x49eefa(0x17f)),console[_0x49eefa(0x188)](_0x49eefa(0x17d)),console[_0x49eefa(0x188)]('Response\x20data:',_0x521af5),loggerService_1[_0x49eefa(0x1c8)][_0x49eefa(0x1ab)](_0x49eefa(0x170),_0x49eefa(0x1a7),_0x49eefa(0x1cd));throw new Error(_0x49eefa(0x1c5));}return console['log'](_0x49eefa(0x1ac)),console[_0x49eefa(0x1d5)](_0x49eefa(0x17a),_0x521af5['id']),console['log'](_0x49eefa(0x1aa),_0x521af5[_0x49eefa(0x19e)][_0x49eefa(0x19f)]),console[_0x49eefa(0x1d5)](_0x49eefa(0x1d7),_0x521af5[_0x49eefa(0x19e)][_0x49eefa(0x19d)]||_0x49eefa(0x1bb)),console[_0x49eefa(0x1d5)](_0x49eefa(0x177),_0x22ab74,_0x49eefa(0x182)),console['log'](_0x49eefa(0x1a1),_0x5a7df1),{'gateway_payment_id':_0x521af5['id'],'payment_url':_0x521af5[_0x49eefa(0x19e)][_0x49eefa(0x19f)],'qr_code_url':_0x521af5[_0x49eefa(0x19e)][_0x49eefa(0x19d)],'expiry_date':_0x521af5[_0x49eefa(0x1dd)]};}catch(_0x457b72){console[_0x49eefa(0x188)](_0x49eefa(0x16e)),console[_0x49eefa(0x188)](_0x49eefa(0x18f),_0x457b72),loggerService_1[_0x49eefa(0x1c8)]['logWhiteDomainError']('noda',_0x49eefa(0x1a7),_0x457b72);if(_0x457b72 instanceof Error){console[_0x49eefa(0x188)](_0x49eefa(0x192),_0x457b72[_0x49eefa(0x195)]),console['error']('Error\x20stack:',_0x457b72['stack']);throw new Error(_0x49eefa(0x183)+_0x457b72[_0x49eefa(0x195)]);}throw new Error(_0x49eefa(0x1a2));}}async['verifyPayment'](_0x25b55a){const _0x58e9d2=a65_0x2947a8,_0x26cef9=Date[_0x58e9d2(0x19b)]();try{loggerService_1[_0x58e9d2(0x1c8)][_0x58e9d2(0x1b6)](_0x58e9d2(0x170),_0x58e9d2(0x1a8)+_0x25b55a,_0x58e9d2(0x1a9),{});const _0x36e37e=await fetch(this[_0x58e9d2(0x1c1)]+'/'+_0x25b55a,{'method':_0x58e9d2(0x1a9),'headers':{'Content-Type':_0x58e9d2(0x1dc),'User-Agent':_0x58e9d2(0x19a)}}),_0x334a37=Date['now']()-_0x26cef9;if(!_0x36e37e['ok']){const _0x453a7e=await _0x36e37e[_0x58e9d2(0x1c2)]();loggerService_1[_0x58e9d2(0x1c8)]['logWhiteDomainResponse'](_0x58e9d2(0x170),'/payment-links/'+_0x25b55a,_0x36e37e[_0x58e9d2(0x181)],_0x453a7e,_0x334a37);throw new Error(_0x58e9d2(0x1b0)+_0x36e37e[_0x58e9d2(0x181)]);}const _0x146748=await _0x36e37e[_0x58e9d2(0x199)]();loggerService_1[_0x58e9d2(0x1c8)]['logWhiteDomainResponse'](_0x58e9d2(0x170),_0x58e9d2(0x1a8)+_0x25b55a,_0x36e37e[_0x58e9d2(0x181)],_0x146748,_0x334a37);if(_0x146748[_0x58e9d2(0x188)]||_0x146748[_0x58e9d2(0x1ae)]){loggerService_1[_0x58e9d2(0x1c8)][_0x58e9d2(0x1ab)](_0x58e9d2(0x170),_0x58e9d2(0x1a8)+_0x25b55a,_0x58e9d2(0x17b)+(_0x146748[_0x58e9d2(0x195)]||_0x146748['error']||_0x58e9d2(0x1ba)));throw new Error(_0x58e9d2(0x17b)+(_0x146748[_0x58e9d2(0x195)]||_0x146748[_0x58e9d2(0x188)]||'Unknown\x20error'));}let _0xafb28e=_0x58e9d2(0x1d3);if(_0x146748[_0x58e9d2(0x16f)]===![]){if(_0x146748[_0x58e9d2(0x1dd)]){const _0x4d700a=new Date(_0x146748[_0x58e9d2(0x1dd)]),_0x58d197=new Date();_0x4d700a<_0x58d197?_0xafb28e=_0x58e9d2(0x1d8):_0xafb28e=_0x58e9d2(0x1db);}else _0xafb28e=_0x58e9d2(0x1db);}else _0xafb28e=_0x58e9d2(0x1d3);return{'status':_0xafb28e,'amount':_0x146748[_0x58e9d2(0x17e)],'currency':_0x146748[_0x58e9d2(0x1cf)],'isActive':_0x146748[_0x58e9d2(0x16f)]};}catch(_0xbce316){console[_0x58e9d2(0x188)](_0x58e9d2(0x1d2),_0xbce316),loggerService_1[_0x58e9d2(0x1c8)][_0x58e9d2(0x1ab)](_0x58e9d2(0x170),_0x58e9d2(0x1a8)+_0x25b55a,_0xbce316);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0xbce316 instanceof Error?_0xbce316[_0x58e9d2(0x195)]:'Unknown\x20error'));}}async[a65_0x2947a8(0x178)](_0x57e935){const _0x43c116=a65_0x2947a8;console[_0x43c116(0x1d5)]('Processing\x20Noda\x20webhook:',_0x57e935);let _0x1eac53=_0x43c116(0x1d3);switch(_0x57e935[_0x43c116(0x1bc)]?.[_0x43c116(0x186)]()){case _0x43c116(0x1b9):case _0x43c116(0x1be):case _0x43c116(0x1c6):case _0x43c116(0x1a6):case _0x43c116(0x1de):_0x57e935[_0x43c116(0x1a3)]===_0x43c116(0x17c)?_0x1eac53=_0x43c116(0x1ad):_0x1eac53=_0x43c116(0x1d3);break;case'cancelled':case _0x43c116(0x1b7):case _0x43c116(0x198):case _0x43c116(0x188):case _0x43c116(0x1d0):_0x1eac53=_0x43c116(0x1db);break;case'expired':case'timeout':_0x1eac53='EXPIRED';break;case _0x43c116(0x1a0):case'created':case'active':case _0x43c116(0x1c0):case _0x43c116(0x1d1):default:_0x1eac53=_0x43c116(0x1d3);break;}return{'paymentId':_0x57e935[_0x43c116(0x185)]||_0x57e935[_0x43c116(0x175)],'status':_0x1eac53,'amount':_0x57e935['Amount'],'currency':_0x57e935[_0x43c116(0x1bd)],'additionalInfo':{'method':_0x57e935[_0x43c116(0x179)],'bankId':_0x57e935['BankId'],'settled':_0x57e935[_0x43c116(0x1a3)],'settlementDate':_0x57e935[_0x43c116(0x189)],'remitterName':_0x57e935['Remitter']?.['Name'],'remitterIban':_0x57e935['Remitter']?.['Iban'],'bankTransactionId':_0x57e935[_0x43c116(0x18d)]}};}[a65_0x2947a8(0x1a4)](_0x34fbfc,_0x268ef3){const _0x513dbe=a65_0x2947a8;return console['log'](_0x513dbe(0x171),{'receivedSignature':_0x268ef3,'paymentId':_0x34fbfc['PaymentId'],'merchantPaymentId':_0x34fbfc[_0x513dbe(0x185)]}),!![];}}exports['NodaService']=NodaService;