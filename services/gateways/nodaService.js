'use strict';const a40_0x232aaf=a40_0x2519;function a40_0xfdd6(){const _0x38b8ad=['currency','Order\x20ID\x20Used:','shortLinkUrls','Failed\x20to\x20parse\x20JSON\x20response:','Unknown\x20error','Iban','POST','279088bahsiV','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','222607TvQklr','timeout','Amount','Business\x20Error:\x20','stringify','status','created','amount','PENDING','defineProperty','Status','logWhiteDomainResponse','1324266ahrHCh','Parsed\x20Result:','Error\x20details:','apiUrl','message','log','(8digits-8digits\x20format)','Settled','===\x20NODA\x20SERVICE\x20ERROR\x20===','SettlementDate','entries','QR\x20Code\x20Link:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20',',\x20body:\x20','done','qrCodeLink','toUpperCase','failed','verifyWebhookSignature','logWhiteDomainRequest','pending','createPaymentLink','Missing\x20id\x20or\x20shortLink\x20in\x20response','now','Method','text','application/json','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Yes','processing','HTTP\x20Status:','24wituxo','cancelled','PaymentId','TesSoft\x20Payment\x20System/1.0','Remitter','79219Wgtbox','HTTP\x20error!\x20status:\x20','https://tesoft.uk/gateway/pending.php?id=','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','GET','EXPIRED','Noda\x20payment\x20verification\x20error:','Currency','processWebhook','Processing\x20Noda\x20webhook:','1612585wGWOok','BankId','loggerService','shortLink','paid','Name','active','verifyPayment','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Error\x20stack:','https://tesoft.uk/gateway/noda/webhook/','HTTP\x20','https://tesoft.uk/gateway/noda/','MerchantPaymentId','/payment-links','/payment-links/','success','statusCode','Short\x20Link:','canceled','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','headers','expired','noda','expiryDate','(8digits-8digits\x20format\x20for\x20Noda)','1441494jsXTJr','stack','JSON\x20Parse\x20Error:\x20','Request\x20Body\x20(Direct\x20JSON):','Order\x20ID\x20Format:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Noda\x20webhook\x20signature\x20verification:','error','__esModule','Status\x20Text:','Payment\x20Link\x20ID:','statusText','logWhiteDomainError','178452EdOaol','fromEntries','successful','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Headers:','in_progress','Status\x20Code:','FAILED','===\x20NODA\x20API\x20ERROR\x20==='];a40_0xfdd6=function(){return _0x38b8ad;};return a40_0xfdd6();}(function(_0x48447a,_0x50e239){const _0x237a81=a40_0x2519,_0x57b5be=_0x48447a();while(!![]){try{const _0x3925a5=parseInt(_0x237a81(0x102))/0x1+-parseInt(_0x237a81(0x100))/0x2+-parseInt(_0x237a81(0x10e))/0x3+parseInt(_0x237a81(0xf0))/0x4+parseInt(_0x237a81(0xc8))/0x5+parseInt(_0x237a81(0xe3))/0x6+parseInt(_0x237a81(0xbe))/0x7*(parseInt(_0x237a81(0xb9))/0x8);if(_0x3925a5===_0x50e239)break;else _0x57b5be['push'](_0x57b5be['shift']());}catch(_0x39340d){_0x57b5be['push'](_0x57b5be['shift']());}}}(a40_0xfdd6,0x4515b));Object[a40_0x232aaf(0x10b)](exports,a40_0x232aaf(0xeb),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require('../loggerService');function a40_0x2519(_0x439ccd,_0x5d646e){const _0xfdd640=a40_0xfdd6();return a40_0x2519=function(_0x25190d,_0x1420da){_0x25190d=_0x25190d-0x9b;let _0x1d4d08=_0xfdd640[_0x25190d];return _0x1d4d08;},a40_0x2519(_0x439ccd,_0x5d646e);}class NodaService{constructor(){const _0x2703f8=a40_0x232aaf;this['apiUrl']=_0x2703f8(0xd4),console['log'](_0x2703f8(0xf3));}async[a40_0x232aaf(0xaf)](_0x10059d){const _0x2675e3=a40_0x232aaf,{orderId:_0x5e39d2,name:_0x1af9ea,paymentDescription:_0x11f4d3,amount:_0x458788,currency:_0x1db889,webhookUrl:_0x2a9ea0,returnUrl:_0x59295d,expiryDate:_0x322f68}=_0x10059d,_0x17b3b1=_0x1db889[_0x2675e3(0xaa)](),_0x5ac1b0=_0x2675e3(0xd2),_0x1401e1=_0x2675e3(0xc0)+_0x5e39d2,_0xef31a9={'name':_0x1af9ea,'paymentDescription':_0x11f4d3,'amount':_0x458788,'currency':_0x17b3b1,'paymentId':_0x5e39d2,'webhookUrl':_0x5ac1b0,'returnUrl':_0x1401e1};_0x322f68&&(_0xef31a9[_0x2675e3(0xe1)]=_0x322f68);const _0x3eb745=Date[_0x2675e3(0xb1)]();try{console[_0x2675e3(0x9f)](_0x2675e3(0xdc)),console['log']('URL:',this[_0x2675e3(0x9d)]),console[_0x2675e3(0x9f)](_0x2675e3(0xe6),JSON[_0x2675e3(0x106)](_0xef31a9,null,0x2)),console[_0x2675e3(0x9f)](_0x2675e3(0xe7),_0x5e39d2,_0x2675e3(0xe2)),console[_0x2675e3(0x9f)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x1401e1),loggerService_1[_0x2675e3(0xca)][_0x2675e3(0xad)](_0x2675e3(0xe0),_0x2675e3(0xd6),_0x2675e3(0xff),_0xef31a9);const _0x9d27c5=await fetch(this[_0x2675e3(0x9d)],{'method':_0x2675e3(0xff),'headers':{'Content-Type':_0x2675e3(0xb4),'Accept':'application/json','User-Agent':_0x2675e3(0xbc)},'body':JSON[_0x2675e3(0x106)](_0xef31a9)}),_0x4c1ae2=Date[_0x2675e3(0xb1)]()-_0x3eb745;console[_0x2675e3(0x9f)](_0x2675e3(0xc1)),console[_0x2675e3(0x9f)]('Status:',_0x9d27c5[_0x2675e3(0x107)]),console[_0x2675e3(0x9f)](_0x2675e3(0xec),_0x9d27c5[_0x2675e3(0xee)]),console[_0x2675e3(0x9f)](_0x2675e3(0xf4),Object[_0x2675e3(0xf1)](_0x9d27c5[_0x2675e3(0xde)][_0x2675e3(0xa4)]())),console[_0x2675e3(0x9f)]('Response\x20Time:',_0x4c1ae2+'ms');const _0x19ecd6=await _0x9d27c5[_0x2675e3(0xb3)]();console['log']('Raw\x20Response\x20Body:',_0x19ecd6);if(!_0x9d27c5['ok']){console[_0x2675e3(0xea)](_0x2675e3(0xf8)),console[_0x2675e3(0xea)](_0x2675e3(0xb8),_0x9d27c5[_0x2675e3(0x107)]),console[_0x2675e3(0xea)]('Response\x20Body:',_0x19ecd6),loggerService_1[_0x2675e3(0xca)]['logWhiteDomainResponse'](_0x2675e3(0xe0),_0x2675e3(0xd6),_0x9d27c5[_0x2675e3(0x107)],_0x19ecd6,_0x4c1ae2),loggerService_1[_0x2675e3(0xca)][_0x2675e3(0xef)](_0x2675e3(0xe0),'/payment-links',_0x2675e3(0xd3)+_0x9d27c5[_0x2675e3(0x107)]+':\x20'+_0x19ecd6);if(_0x9d27c5['status']===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x9d27c5[_0x2675e3(0x107)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x2675e3(0xbf)+_0x9d27c5['status']+_0x2675e3(0xa7)+_0x19ecd6);}let _0x1f0f11;try{_0x1f0f11=JSON['parse'](_0x19ecd6);}catch(_0x11022c){console[_0x2675e3(0xea)](_0x2675e3(0xfc),_0x11022c),loggerService_1[_0x2675e3(0xca)][_0x2675e3(0xef)](_0x2675e3(0xe0),_0x2675e3(0xd6),_0x2675e3(0xe5)+_0x11022c);throw new Error(_0x2675e3(0xe8)+_0x19ecd6);}console['log']('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console['log'](_0x2675e3(0x9b),JSON[_0x2675e3(0x106)](_0x1f0f11,null,0x2)),loggerService_1[_0x2675e3(0xca)][_0x2675e3(0x10d)](_0x2675e3(0xe0),'/payment-links',_0x9d27c5[_0x2675e3(0x107)],_0x1f0f11,_0x4c1ae2);if(_0x1f0f11[_0x2675e3(0xea)]||_0x1f0f11[_0x2675e3(0xd9)]){const _0x4b583c=_0x1f0f11[_0x2675e3(0x9e)]||_0x1f0f11[_0x2675e3(0xea)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x2675e3(0xea)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x4b583c),console[_0x2675e3(0xea)](_0x2675e3(0xf6),_0x1f0f11['statusCode']),loggerService_1[_0x2675e3(0xca)][_0x2675e3(0xef)]('noda',_0x2675e3(0xd6),_0x2675e3(0x105)+_0x4b583c);throw new Error('Noda\x20API\x20error:\x20'+_0x4b583c);}if(!_0x1f0f11['id']||!_0x1f0f11['shortLinkUrls']?.[_0x2675e3(0xcb)]){console['error'](_0x2675e3(0xdd)),console[_0x2675e3(0xea)](_0x2675e3(0xb0)),console[_0x2675e3(0xea)]('Response\x20data:',_0x1f0f11),loggerService_1[_0x2675e3(0xca)]['logWhiteDomainError']('noda',_0x2675e3(0xd6),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x2675e3(0xd0));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console[_0x2675e3(0x9f)](_0x2675e3(0xed),_0x1f0f11['id']),console[_0x2675e3(0x9f)](_0x2675e3(0xda),_0x1f0f11[_0x2675e3(0xfb)]['shortLink']),console[_0x2675e3(0x9f)](_0x2675e3(0xa5),_0x1f0f11['shortLinkUrls'][_0x2675e3(0xa9)]||'Not\x20provided'),console[_0x2675e3(0x9f)](_0x2675e3(0xfa),_0x5e39d2,_0x2675e3(0xa0)),console[_0x2675e3(0x9f)](_0x2675e3(0x101),_0x1401e1),{'gateway_payment_id':_0x1f0f11['id'],'payment_url':_0x1f0f11[_0x2675e3(0xfb)][_0x2675e3(0xcb)],'qr_code_url':_0x1f0f11['shortLinkUrls'][_0x2675e3(0xa9)],'expiry_date':_0x1f0f11[_0x2675e3(0xe1)]};}catch(_0x42ae9a){console['error'](_0x2675e3(0xa2)),console['error'](_0x2675e3(0x9c),_0x42ae9a),loggerService_1[_0x2675e3(0xca)]['logWhiteDomainError'](_0x2675e3(0xe0),'/payment-links',_0x42ae9a);if(_0x42ae9a instanceof Error){console[_0x2675e3(0xea)]('Error\x20message:',_0x42ae9a['message']),console['error'](_0x2675e3(0xd1),_0x42ae9a[_0x2675e3(0xe4)]);throw new Error(_0x2675e3(0xa6)+_0x42ae9a['message']);}throw new Error(_0x2675e3(0xb5));}}async[a40_0x232aaf(0xcf)](_0xfcff4d){const _0x1d8e03=a40_0x232aaf,_0x173c52=Date[_0x1d8e03(0xb1)]();try{loggerService_1[_0x1d8e03(0xca)][_0x1d8e03(0xad)]('noda',_0x1d8e03(0xd7)+_0xfcff4d,'GET',{});const _0x31b2d6=await fetch(this[_0x1d8e03(0x9d)]+'/'+_0xfcff4d,{'method':_0x1d8e03(0xc2),'headers':{'Content-Type':_0x1d8e03(0xb4),'User-Agent':_0x1d8e03(0xbc)}}),_0x365a46=Date[_0x1d8e03(0xb1)]()-_0x173c52;if(!_0x31b2d6['ok']){const _0x1a54de=await _0x31b2d6[_0x1d8e03(0xb3)]();loggerService_1[_0x1d8e03(0xca)][_0x1d8e03(0x10d)](_0x1d8e03(0xe0),_0x1d8e03(0xd7)+_0xfcff4d,_0x31b2d6['status'],_0x1a54de,_0x365a46);throw new Error(_0x1d8e03(0xbf)+_0x31b2d6[_0x1d8e03(0x107)]);}const _0x5509aa=await _0x31b2d6['json']();loggerService_1[_0x1d8e03(0xca)][_0x1d8e03(0x10d)](_0x1d8e03(0xe0),_0x1d8e03(0xd7)+_0xfcff4d,_0x31b2d6[_0x1d8e03(0x107)],_0x5509aa,_0x365a46);if(_0x5509aa[_0x1d8e03(0xea)]||_0x5509aa[_0x1d8e03(0xd9)]){loggerService_1['loggerService'][_0x1d8e03(0xef)](_0x1d8e03(0xe0),_0x1d8e03(0xd7)+_0xfcff4d,'Noda\x20API\x20error:\x20'+(_0x5509aa[_0x1d8e03(0x9e)]||_0x5509aa[_0x1d8e03(0xea)]||_0x1d8e03(0xfd)));throw new Error('Noda\x20API\x20error:\x20'+(_0x5509aa['message']||_0x5509aa[_0x1d8e03(0xea)]||_0x1d8e03(0xfd)));}let _0x2b95e4=_0x1d8e03(0x10a);if(_0x5509aa['isActive']===![]){if(_0x5509aa[_0x1d8e03(0xe1)]){const _0x3337be=new Date(_0x5509aa[_0x1d8e03(0xe1)]),_0x1da769=new Date();_0x3337be<_0x1da769?_0x2b95e4=_0x1d8e03(0xc3):_0x2b95e4=_0x1d8e03(0xf7);}else _0x2b95e4=_0x1d8e03(0xf7);}else _0x2b95e4=_0x1d8e03(0x10a);return{'status':_0x2b95e4,'amount':_0x5509aa[_0x1d8e03(0x109)],'currency':_0x5509aa[_0x1d8e03(0xf9)],'isActive':_0x5509aa['isActive']};}catch(_0x5eac1c){console[_0x1d8e03(0xea)](_0x1d8e03(0xc4),_0x5eac1c),loggerService_1[_0x1d8e03(0xca)][_0x1d8e03(0xef)](_0x1d8e03(0xe0),_0x1d8e03(0xd7)+_0xfcff4d,_0x5eac1c);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x5eac1c instanceof Error?_0x5eac1c['message']:_0x1d8e03(0xfd)));}}async[a40_0x232aaf(0xc6)](_0x3b51fd){const _0x544f50=a40_0x232aaf;console[_0x544f50(0x9f)](_0x544f50(0xc7),_0x3b51fd);let _0x10a6f8='PENDING';switch(_0x3b51fd[_0x544f50(0x10c)]?.['toLowerCase']()){case _0x544f50(0xa8):case'completed':case _0x544f50(0xcc):case _0x544f50(0xd8):case _0x544f50(0xf2):_0x3b51fd[_0x544f50(0xa1)]===_0x544f50(0xb6)?_0x10a6f8='PAID':_0x10a6f8=_0x544f50(0x10a);break;case _0x544f50(0xba):case _0x544f50(0xdb):case _0x544f50(0xab):case _0x544f50(0xea):case'rejected':_0x10a6f8='FAILED';break;case _0x544f50(0xdf):case _0x544f50(0x103):_0x10a6f8=_0x544f50(0xc3);break;case _0x544f50(0xae):case _0x544f50(0x108):case _0x544f50(0xce):case _0x544f50(0xb7):case _0x544f50(0xf5):default:_0x10a6f8=_0x544f50(0x10a);break;}return{'paymentId':_0x3b51fd['MerchantPaymentId']||_0x3b51fd[_0x544f50(0xbb)],'status':_0x10a6f8,'amount':_0x3b51fd[_0x544f50(0x104)],'currency':_0x3b51fd[_0x544f50(0xc5)],'additionalInfo':{'method':_0x3b51fd[_0x544f50(0xb2)],'bankId':_0x3b51fd[_0x544f50(0xc9)],'settled':_0x3b51fd['Settled'],'settlementDate':_0x3b51fd[_0x544f50(0xa3)],'remitterName':_0x3b51fd['Remitter']?.[_0x544f50(0xcd)],'remitterIban':_0x3b51fd[_0x544f50(0xbd)]?.[_0x544f50(0xfe)],'bankTransactionId':_0x3b51fd['BankTransactionId']}};}[a40_0x232aaf(0xac)](_0x5ac72e,_0x547090){const _0x43bd56=a40_0x232aaf;return console[_0x43bd56(0x9f)](_0x43bd56(0xe9),{'receivedSignature':_0x547090,'paymentId':_0x5ac72e['PaymentId'],'merchantPaymentId':_0x5ac72e[_0x43bd56(0xd5)]}),!![];}}exports['NodaService']=NodaService;