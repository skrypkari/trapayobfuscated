'use strict';const a71_0x448e89=a71_0x5afb;(function(_0x3ab28e,_0x4766ed){const _0x115ec2=a71_0x5afb,_0x288c12=_0x3ab28e();while(!![]){try{const _0x2effd7=-parseInt(_0x115ec2(0xcc))/0x1+parseInt(_0x115ec2(0x135))/0x2+parseInt(_0x115ec2(0x137))/0x3*(-parseInt(_0x115ec2(0xd6))/0x4)+-parseInt(_0x115ec2(0xe3))/0x5+-parseInt(_0x115ec2(0xdb))/0x6*(parseInt(_0x115ec2(0x11f))/0x7)+parseInt(_0x115ec2(0x100))/0x8+parseInt(_0x115ec2(0x117))/0x9;if(_0x2effd7===_0x4766ed)break;else _0x288c12['push'](_0x288c12['shift']());}catch(_0x4aafb9){_0x288c12['push'](_0x288c12['shift']());}}}(a71_0x3f84,0xb1c92));Object[a71_0x448e89(0x12a)](exports,a71_0x448e89(0xce),{'value':!![]}),exports[a71_0x448e89(0xdf)]=void 0x0;function a71_0x3f84(){const _0x329a4a=['createPaymentLink','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','https://tesoft.uk/gateway/pending.php?id=','Currency','done','HTTP\x20Status:','Failed\x20to\x20parse\x20JSON\x20response:','Business\x20Error:\x20','toUpperCase','Method','PAID','Not\x20provided','===\x20NODA\x20API\x20ERROR\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','JSON\x20Parse\x20Error:\x20','shortLink','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Payment\x20System/1.0','success','HTTP\x20','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','27415872ZYwXhc','timeout','Noda\x20API\x20error:\x20','Settled','HTTP\x20error!\x20status:\x20','Missing\x20id\x20or\x20shortLink\x20in\x20response','pending','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','56GZQkxp','parse','loggerService','expiryDate','PaymentId','shortLinkUrls','SettlementDate','Raw\x20Response\x20Body:','isActive','../loggerService','Noda\x20payment\x20verification\x20error:','defineProperty','statusCode','error','/payment-links','Error\x20message:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','failed','canceled','Status:','Unknown\x20error\x20from\x20Noda\x20API','https://tesoft.uk/gateway/noda/','1237552Uljhcy','Unknown\x20error','3111387yqzIHW','cancelled','qrCodeLink','log','Name','Response\x20Time:','apiUrl','URL:','Status\x20Code:','Status','Order\x20ID\x20Used:','770253DZmrRo','text','__esModule','message','Iban','Status\x20Text:','headers','(8digits-8digits\x20format)','status','===\x20NODA\x20SUCCESS\x20===','4UVCsEn','logWhiteDomainError','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','GET','578472WcDTSF','MerchantPaymentId','verifyPayment','PENDING','NodaService','Response\x20data:','paid','Short\x20Link:','3904480HLlVTA','logWhiteDomainRequest','FAILED','noda','verifyWebhookSignature','Order\x20ID\x20Format:','Response\x20Body:','stack','application/json','QR\x20Code\x20Link:','stringify','POST','BankTransactionId','Error\x20Message:','Parsed\x20Result:','Noda\x20webhook\x20signature\x20verification:','Remitter','amount','EXPIRED','(8digits-8digits\x20format\x20for\x20Noda)','logWhiteDomainResponse','Processing\x20Noda\x20webhook:','processing','/payment-links/','===\x20NODA\x20SERVICE\x20ERROR\x20===','now','completed','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Amount','3382400Phiwdm','entries'];a71_0x3f84=function(){return _0x329a4a;};return a71_0x3f84();}function a71_0x5afb(_0x4dbfe9,_0x5e0c6e){_0x4dbfe9=_0x4dbfe9-0xc6;const _0x3f849c=a71_0x3f84();let _0x5afb52=_0x3f849c[_0x4dbfe9];return _0x5afb52;}const loggerService_1=require(a71_0x448e89(0x128));class NodaService{constructor(){const _0x1f862a=a71_0x448e89;this[_0x1f862a(0xc7)]=_0x1f862a(0x134),console[_0x1f862a(0x13a)](_0x1f862a(0xd8));}async[a71_0x448e89(0x102)](_0x3db263){const _0xef41cc=a71_0x448e89,{orderId:_0xff8df7,name:_0x95e884,paymentDescription:_0x55f60a,amount:_0x47cbb3,currency:_0x55a462,webhookUrl:_0x504c75,returnUrl:_0x1a552f,expiryDate:_0x566e27}=_0x3db263,_0x2905be=_0x55a462[_0xef41cc(0x10a)](),_0x4d0898='https://tesoft.uk/gateway/noda/webhook/',_0x4cee38=_0xef41cc(0x104)+_0xff8df7,_0x4bcd4b={'name':_0x95e884,'paymentDescription':_0x55f60a,'amount':_0x47cbb3,'currency':_0x2905be,'paymentId':_0xff8df7,'webhookUrl':_0x4d0898,'returnUrl':_0x4cee38};_0x566e27&&(_0x4bcd4b[_0xef41cc(0x122)]=_0x566e27);const _0x1410c0=Date[_0xef41cc(0xfc)]();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0xef41cc(0x13a)](_0xef41cc(0xc8),this[_0xef41cc(0xc7)]),console[_0xef41cc(0x13a)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0xef41cc(0xed)](_0x4bcd4b,null,0x2)),console[_0xef41cc(0x13a)](_0xef41cc(0xe8),_0xff8df7,_0xef41cc(0xf6)),console['log'](_0xef41cc(0xd9),_0x4cee38),loggerService_1[_0xef41cc(0x121)][_0xef41cc(0xe4)](_0xef41cc(0xe6),_0xef41cc(0x12d),_0xef41cc(0xee),_0x4bcd4b);const _0x29890f=await fetch(this[_0xef41cc(0xc7)],{'method':_0xef41cc(0xee),'headers':{'Content-Type':_0xef41cc(0xeb),'Accept':_0xef41cc(0xeb),'User-Agent':_0xef41cc(0x113)},'body':JSON[_0xef41cc(0xed)](_0x4bcd4b)}),_0x1a97f0=Date[_0xef41cc(0xfc)]()-_0x1410c0;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0xef41cc(0x13a)](_0xef41cc(0x132),_0x29890f[_0xef41cc(0xd4)]),console['log'](_0xef41cc(0xd1),_0x29890f['statusText']),console[_0xef41cc(0x13a)]('Headers:',Object['fromEntries'](_0x29890f[_0xef41cc(0xd2)][_0xef41cc(0x101)]())),console[_0xef41cc(0x13a)](_0xef41cc(0xc6),_0x1a97f0+'ms');const _0x1bfad9=await _0x29890f[_0xef41cc(0xcd)]();console[_0xef41cc(0x13a)](_0xef41cc(0x126),_0x1bfad9);if(!_0x29890f['ok']){console[_0xef41cc(0x12c)](_0xef41cc(0x10e)),console[_0xef41cc(0x12c)](_0xef41cc(0x107),_0x29890f['status']),console['error'](_0xef41cc(0xe9),_0x1bfad9),loggerService_1[_0xef41cc(0x121)][_0xef41cc(0xf7)]('noda',_0xef41cc(0x12d),_0x29890f[_0xef41cc(0xd4)],_0x1bfad9,_0x1a97f0),loggerService_1[_0xef41cc(0x121)][_0xef41cc(0xd7)](_0xef41cc(0xe6),_0xef41cc(0x12d),_0xef41cc(0x115)+_0x29890f[_0xef41cc(0xd4)]+':\x20'+_0x1bfad9);if(_0x29890f[_0xef41cc(0xd4)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x29890f[_0xef41cc(0xd4)]===0x1f4)throw new Error(_0xef41cc(0x11e));}throw new Error(_0xef41cc(0x11b)+_0x29890f[_0xef41cc(0xd4)]+',\x20body:\x20'+_0x1bfad9);}let _0x2e594d;try{_0x2e594d=JSON[_0xef41cc(0x120)](_0x1bfad9);}catch(_0x17becc){console[_0xef41cc(0x12c)](_0xef41cc(0x108),_0x17becc),loggerService_1[_0xef41cc(0x121)][_0xef41cc(0xd7)](_0xef41cc(0xe6),_0xef41cc(0x12d),_0xef41cc(0x110)+_0x17becc);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x1bfad9);}console[_0xef41cc(0x13a)](_0xef41cc(0xfe)),console[_0xef41cc(0x13a)](_0xef41cc(0xf1),JSON[_0xef41cc(0xed)](_0x2e594d,null,0x2)),loggerService_1[_0xef41cc(0x121)]['logWhiteDomainResponse'](_0xef41cc(0xe6),'/payment-links',_0x29890f['status'],_0x2e594d,_0x1a97f0);if(_0x2e594d[_0xef41cc(0x12c)]||_0x2e594d[_0xef41cc(0x12b)]){const _0x514b52=_0x2e594d['message']||_0x2e594d[_0xef41cc(0x12c)]||_0xef41cc(0x133);console[_0xef41cc(0x12c)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0xef41cc(0xf0),_0x514b52),console[_0xef41cc(0x12c)](_0xef41cc(0xc9),_0x2e594d['statusCode']),loggerService_1[_0xef41cc(0x121)][_0xef41cc(0xd7)](_0xef41cc(0xe6),_0xef41cc(0x12d),_0xef41cc(0x109)+_0x514b52);throw new Error(_0xef41cc(0x119)+_0x514b52);}if(!_0x2e594d['id']||!_0x2e594d[_0xef41cc(0x124)]?.['shortLink']){console[_0xef41cc(0x12c)](_0xef41cc(0x12f)),console[_0xef41cc(0x12c)](_0xef41cc(0x11c)),console[_0xef41cc(0x12c)](_0xef41cc(0xe0),_0x2e594d),loggerService_1[_0xef41cc(0x121)][_0xef41cc(0xd7)]('noda','/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0xef41cc(0x116));}return console[_0xef41cc(0x13a)](_0xef41cc(0xd5)),console[_0xef41cc(0x13a)]('Payment\x20Link\x20ID:',_0x2e594d['id']),console[_0xef41cc(0x13a)](_0xef41cc(0xe2),_0x2e594d[_0xef41cc(0x124)][_0xef41cc(0x111)]),console[_0xef41cc(0x13a)](_0xef41cc(0xec),_0x2e594d[_0xef41cc(0x124)][_0xef41cc(0x139)]||_0xef41cc(0x10d)),console[_0xef41cc(0x13a)](_0xef41cc(0xcb),_0xff8df7,_0xef41cc(0xd3)),console[_0xef41cc(0x13a)](_0xef41cc(0x103),_0x4cee38),{'gateway_payment_id':_0x2e594d['id'],'payment_url':_0x2e594d[_0xef41cc(0x124)][_0xef41cc(0x111)],'qr_code_url':_0x2e594d['shortLinkUrls'][_0xef41cc(0x139)],'expiry_date':_0x2e594d[_0xef41cc(0x122)]};}catch(_0x2bffca){console[_0xef41cc(0x12c)](_0xef41cc(0xfb)),console[_0xef41cc(0x12c)]('Error\x20details:',_0x2bffca),loggerService_1[_0xef41cc(0x121)]['logWhiteDomainError']('noda',_0xef41cc(0x12d),_0x2bffca);if(_0x2bffca instanceof Error){console[_0xef41cc(0x12c)](_0xef41cc(0x12e),_0x2bffca[_0xef41cc(0xcf)]),console[_0xef41cc(0x12c)]('Error\x20stack:',_0x2bffca[_0xef41cc(0xea)]);throw new Error(_0xef41cc(0x10f)+_0x2bffca[_0xef41cc(0xcf)]);}throw new Error(_0xef41cc(0x112));}}async[a71_0x448e89(0xdd)](_0x28fcae){const _0x44ec87=a71_0x448e89,_0x221e59=Date[_0x44ec87(0xfc)]();try{loggerService_1[_0x44ec87(0x121)]['logWhiteDomainRequest'](_0x44ec87(0xe6),_0x44ec87(0xfa)+_0x28fcae,_0x44ec87(0xda),{});const _0x444407=await fetch(this['apiUrl']+'/'+_0x28fcae,{'method':_0x44ec87(0xda),'headers':{'Content-Type':'application/json','User-Agent':_0x44ec87(0x113)}}),_0x21387d=Date[_0x44ec87(0xfc)]()-_0x221e59;if(!_0x444407['ok']){const _0x5ae4ef=await _0x444407[_0x44ec87(0xcd)]();loggerService_1[_0x44ec87(0x121)][_0x44ec87(0xf7)]('noda','/payment-links/'+_0x28fcae,_0x444407['status'],_0x5ae4ef,_0x21387d);throw new Error(_0x44ec87(0x11b)+_0x444407[_0x44ec87(0xd4)]);}const _0x12fc49=await _0x444407['json']();loggerService_1[_0x44ec87(0x121)][_0x44ec87(0xf7)](_0x44ec87(0xe6),_0x44ec87(0xfa)+_0x28fcae,_0x444407[_0x44ec87(0xd4)],_0x12fc49,_0x21387d);if(_0x12fc49['error']||_0x12fc49[_0x44ec87(0x12b)]){loggerService_1['loggerService'][_0x44ec87(0xd7)](_0x44ec87(0xe6),_0x44ec87(0xfa)+_0x28fcae,_0x44ec87(0x119)+(_0x12fc49['message']||_0x12fc49[_0x44ec87(0x12c)]||_0x44ec87(0x136)));throw new Error(_0x44ec87(0x119)+(_0x12fc49[_0x44ec87(0xcf)]||_0x12fc49[_0x44ec87(0x12c)]||_0x44ec87(0x136)));}let _0x1bb1d9=_0x44ec87(0xde);if(_0x12fc49['isActive']===![]){if(_0x12fc49['expiryDate']){const _0x98ebe9=new Date(_0x12fc49[_0x44ec87(0x122)]),_0x56bdf1=new Date();_0x98ebe9<_0x56bdf1?_0x1bb1d9=_0x44ec87(0xf5):_0x1bb1d9='FAILED';}else _0x1bb1d9=_0x44ec87(0xe5);}else _0x1bb1d9=_0x44ec87(0xde);return{'status':_0x1bb1d9,'amount':_0x12fc49[_0x44ec87(0xf4)],'currency':_0x12fc49['currency'],'isActive':_0x12fc49[_0x44ec87(0x127)]};}catch(_0x2b77a6){console['error'](_0x44ec87(0x129),_0x2b77a6),loggerService_1[_0x44ec87(0x121)][_0x44ec87(0xd7)](_0x44ec87(0xe6),_0x44ec87(0xfa)+_0x28fcae,_0x2b77a6);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x2b77a6 instanceof Error?_0x2b77a6['message']:'Unknown\x20error'));}}async['processWebhook'](_0x747751){const _0x2605aa=a71_0x448e89;console[_0x2605aa(0x13a)](_0x2605aa(0xf8),_0x747751);let _0x2c9b14=_0x2605aa(0xde);switch(_0x747751[_0x2605aa(0xca)]?.['toLowerCase']()){case _0x2605aa(0x106):case _0x2605aa(0xfd):case _0x2605aa(0xe1):case _0x2605aa(0x114):case'successful':_0x747751[_0x2605aa(0x11a)]==='Yes'?_0x2c9b14=_0x2605aa(0x10c):_0x2c9b14=_0x2605aa(0xde);break;case _0x2605aa(0x138):case _0x2605aa(0x131):case _0x2605aa(0x130):case _0x2605aa(0x12c):case'rejected':_0x2c9b14=_0x2605aa(0xe5);break;case'expired':case _0x2605aa(0x118):_0x2c9b14=_0x2605aa(0xf5);break;case _0x2605aa(0x11d):case'created':case'active':case _0x2605aa(0xf9):case'in_progress':default:_0x2c9b14=_0x2605aa(0xde);break;}return{'paymentId':_0x747751[_0x2605aa(0xdc)]||_0x747751[_0x2605aa(0x123)],'status':_0x2c9b14,'amount':_0x747751[_0x2605aa(0xff)],'currency':_0x747751[_0x2605aa(0x105)],'additionalInfo':{'method':_0x747751[_0x2605aa(0x10b)],'bankId':_0x747751['BankId'],'settled':_0x747751[_0x2605aa(0x11a)],'settlementDate':_0x747751[_0x2605aa(0x125)],'remitterName':_0x747751[_0x2605aa(0xf3)]?.[_0x2605aa(0x13b)],'remitterIban':_0x747751['Remitter']?.[_0x2605aa(0xd0)],'bankTransactionId':_0x747751[_0x2605aa(0xef)]}};}[a71_0x448e89(0xe7)](_0x47735e,_0x5cf2d7){const _0xde85dd=a71_0x448e89;return console[_0xde85dd(0x13a)](_0xde85dd(0xf2),{'receivedSignature':_0x5cf2d7,'paymentId':_0x47735e['PaymentId'],'merchantPaymentId':_0x47735e[_0xde85dd(0xdc)]}),!![];}}exports[a71_0x448e89(0xdf)]=NodaService;