'use strict';function a39_0xa620(_0x1f566d,_0x4e8a16){const _0x531439=a39_0x5314();return a39_0xa620=function(_0xa620be,_0x3b3106){_0xa620be=_0xa620be-0x86;let _0x2c1704=_0x531439[_0xa620be];return _0x2c1704;},a39_0xa620(_0x1f566d,_0x4e8a16);}const a39_0x4fd4af=a39_0xa620;(function(_0x3226fb,_0x4c9f27){const _0x57d781=a39_0xa620,_0x176e0a=_0x3226fb();while(!![]){try{const _0x43e8a7=-parseInt(_0x57d781(0x9c))/0x1+-parseInt(_0x57d781(0xe9))/0x2*(parseInt(_0x57d781(0xf3))/0x3)+parseInt(_0x57d781(0xfb))/0x4+parseInt(_0x57d781(0xfe))/0x5+-parseInt(_0x57d781(0x95))/0x6+-parseInt(_0x57d781(0xab))/0x7+-parseInt(_0x57d781(0xca))/0x8*(-parseInt(_0x57d781(0xae))/0x9);if(_0x43e8a7===_0x4c9f27)break;else _0x176e0a['push'](_0x176e0a['shift']());}catch(_0x36c7b9){_0x176e0a['push'](_0x176e0a['shift']());}}}(a39_0x5314,0x2b647));function a39_0x5314(){const _0x2349a9=['Status:','in_progress','status','2561432EAIgEi','Processing\x20Noda\x20webhook:','HTTP\x20','timeout','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','POST','Currency','Error\x20Message:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20details:','GET','statusText','Remitter','successful','log','verifyPayment','TesSoft\x20Payment\x20System/1.0','HTTP\x20error!\x20status:\x20','cancelled','now','message','(8digits-8digits\x20format\x20for\x20Noda)','stringify','done','processing','shortLinkUrls','defineProperty','expiryDate','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','14vwgSEa','toUpperCase','PENDING','Noda\x20payment\x20verification\x20error:','NodaService','Settled','https://tesoft.uk/gateway/success.php?id=','failed','Order\x20ID\x20Format:','expired','26511DGTAkd','stack','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','BankId','(8digits-8digits\x20format)','MerchantPaymentId','isActive','noda','942980aaQMAj','Iban','application/json','240280FZwumk','../loggerService','json','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','logWhiteDomainRequest','Status','qrCodeLink','loggerService','processWebhook','BankTransactionId','amount','/payment-links','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','FAILED','URL:','paid','718230XXqtRO','Raw\x20Response\x20Body:','text','logWhiteDomainResponse','verifyWebhookSignature','Name','apiUrl','40188VgPRHb','https://tesoft.uk/gateway/noda/webhook/','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Business\x20Error:\x20','currency','error','Response\x20Body:','Unknown\x20error','https://tesoft.uk/gateway/noda/','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','EXPIRED','success','PaymentId','Payment\x20Link\x20ID:','Parsed\x20Result:','1431451hqkxEg','Noda\x20webhook\x20signature\x20verification:','shortLink','9VObqHj','parse','rejected','createPaymentLink','QR\x20Code\x20Link:','statusCode','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','PAID','__esModule','/payment-links/',',\x20body:\x20','SettlementDate','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error\x20from\x20Noda\x20API','===\x20NODA\x20SERVICE\x20ERROR\x20===','active','logWhiteDomainError','canceled','completed','Response\x20data:','Error\x20message:','Noda\x20API\x20error:\x20','Short\x20Link:','Amount','entries'];a39_0x5314=function(){return _0x2349a9;};return a39_0x5314();}Object[a39_0x4fd4af(0xe5)](exports,a39_0x4fd4af(0xb6),{'value':!![]}),exports[a39_0x4fd4af(0xed)]=void 0x0;const loggerService_1=require(a39_0x4fd4af(0xff));class NodaService{constructor(){const _0x441834=a39_0x4fd4af;this[_0x441834(0x9b)]=_0x441834(0xa4),console[_0x441834(0xd9)](_0x441834(0xd3));}async[a39_0x4fd4af(0xb1)](_0x3cfef0){const _0x5f4edc=a39_0x4fd4af,{orderId:_0x34c1d0,name:_0x24e505,paymentDescription:_0x3376a0,amount:_0x31a76a,currency:_0x2dbfd5,webhookUrl:_0x1260cb,returnUrl:_0x441506,expiryDate:_0x15f011}=_0x3cfef0,_0x313827=_0x2dbfd5[_0x5f4edc(0xea)](),_0x49c93b=_0x5f4edc(0x9d),_0x46eb3a=_0x5f4edc(0xef)+_0x34c1d0,_0x55d092={'name':_0x24e505,'paymentDescription':_0x3376a0,'amount':_0x31a76a,'currency':_0x313827,'paymentId':_0x34c1d0,'webhookUrl':_0x49c93b,'returnUrl':_0x46eb3a};_0x15f011&&(_0x55d092[_0x5f4edc(0xe6)]=_0x15f011);const _0x23bcd7=Date[_0x5f4edc(0xde)]();try{console['log'](_0x5f4edc(0xce)),console['log'](_0x5f4edc(0x93),this[_0x5f4edc(0x9b)]),console[_0x5f4edc(0xd9)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x5f4edc(0xe1)](_0x55d092,null,0x2)),console[_0x5f4edc(0xd9)](_0x5f4edc(0xf1),_0x34c1d0,_0x5f4edc(0xe0)),loggerService_1[_0x5f4edc(0x8b)][_0x5f4edc(0x88)]('noda',_0x5f4edc(0x8f),_0x5f4edc(0xcf),_0x55d092);const _0x2e1ae5=await fetch(this[_0x5f4edc(0x9b)],{'method':'POST','headers':{'Content-Type':_0x5f4edc(0xfd),'Accept':_0x5f4edc(0xfd),'User-Agent':_0x5f4edc(0xdb)},'body':JSON[_0x5f4edc(0xe1)](_0x55d092)}),_0x50d7fd=Date['now']()-_0x23bcd7;console[_0x5f4edc(0xd9)](_0x5f4edc(0xa5)),console['log'](_0x5f4edc(0xc7),_0x2e1ae5[_0x5f4edc(0xc9)]),console[_0x5f4edc(0xd9)]('Status\x20Text:',_0x2e1ae5[_0x5f4edc(0xd6)]),console[_0x5f4edc(0xd9)]('Headers:',Object['fromEntries'](_0x2e1ae5['headers'][_0x5f4edc(0xc6)]())),console[_0x5f4edc(0xd9)]('Response\x20Time:',_0x50d7fd+'ms');const _0x1afda8=await _0x2e1ae5[_0x5f4edc(0x97)]();console[_0x5f4edc(0xd9)](_0x5f4edc(0x96),_0x1afda8);if(!_0x2e1ae5['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x5f4edc(0xa1)]('HTTP\x20Status:',_0x2e1ae5['status']),console[_0x5f4edc(0xa1)](_0x5f4edc(0xa2),_0x1afda8),loggerService_1[_0x5f4edc(0x8b)][_0x5f4edc(0x98)]('noda',_0x5f4edc(0x8f),_0x2e1ae5[_0x5f4edc(0xc9)],_0x1afda8,_0x50d7fd),loggerService_1[_0x5f4edc(0x8b)][_0x5f4edc(0xbe)](_0x5f4edc(0xfa),_0x5f4edc(0x8f),_0x5f4edc(0xcc)+_0x2e1ae5[_0x5f4edc(0xc9)]+':\x20'+_0x1afda8);if(_0x2e1ae5[_0x5f4edc(0xc9)]===0x190)throw new Error(_0x5f4edc(0xb4));else{if(_0x2e1ae5['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error('HTTP\x20error!\x20status:\x20'+_0x2e1ae5[_0x5f4edc(0xc9)]+_0x5f4edc(0xb8)+_0x1afda8);}let _0x2933bf;try{_0x2933bf=JSON[_0x5f4edc(0xaf)](_0x1afda8);}catch(_0x3f7189){console['error'](_0x5f4edc(0xe7),_0x3f7189),loggerService_1[_0x5f4edc(0x8b)][_0x5f4edc(0xbe)]('noda','/payment-links','JSON\x20Parse\x20Error:\x20'+_0x3f7189);throw new Error(_0x5f4edc(0x91)+_0x1afda8);}console['log'](_0x5f4edc(0x90)),console[_0x5f4edc(0xd9)](_0x5f4edc(0xaa),JSON[_0x5f4edc(0xe1)](_0x2933bf,null,0x2)),loggerService_1[_0x5f4edc(0x8b)][_0x5f4edc(0x98)]('noda',_0x5f4edc(0x8f),_0x2e1ae5[_0x5f4edc(0xc9)],_0x2933bf,_0x50d7fd);if(_0x2933bf[_0x5f4edc(0xa1)]||_0x2933bf['statusCode']){const _0x2ad5a=_0x2933bf[_0x5f4edc(0xdf)]||_0x2933bf[_0x5f4edc(0xa1)]||_0x5f4edc(0xbb);console[_0x5f4edc(0xa1)](_0x5f4edc(0xf5)),console['error'](_0x5f4edc(0xd1),_0x2ad5a),console[_0x5f4edc(0xa1)]('Status\x20Code:',_0x2933bf[_0x5f4edc(0xb3)]),loggerService_1[_0x5f4edc(0x8b)][_0x5f4edc(0xbe)](_0x5f4edc(0xfa),_0x5f4edc(0x8f),_0x5f4edc(0x9f)+_0x2ad5a);throw new Error(_0x5f4edc(0xc3)+_0x2ad5a);}if(!_0x2933bf['id']||!_0x2933bf[_0x5f4edc(0xe4)]?.[_0x5f4edc(0xad)]){console['error'](_0x5f4edc(0xba)),console[_0x5f4edc(0xa1)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x5f4edc(0xa1)](_0x5f4edc(0xc1),_0x2933bf),loggerService_1[_0x5f4edc(0x8b)][_0x5f4edc(0xbe)]('noda',_0x5f4edc(0x8f),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x5f4edc(0xd2));}return console[_0x5f4edc(0xd9)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x5f4edc(0xd9)](_0x5f4edc(0xa9),_0x2933bf['id']),console[_0x5f4edc(0xd9)](_0x5f4edc(0xc4),_0x2933bf[_0x5f4edc(0xe4)]['shortLink']),console[_0x5f4edc(0xd9)](_0x5f4edc(0xb2),_0x2933bf['shortLinkUrls'][_0x5f4edc(0x8a)]||'Not\x20provided'),console[_0x5f4edc(0xd9)]('Order\x20ID\x20Used:',_0x34c1d0,_0x5f4edc(0xf7)),{'gateway_payment_id':_0x2933bf['id'],'payment_url':_0x2933bf[_0x5f4edc(0xe4)][_0x5f4edc(0xad)],'qr_code_url':_0x2933bf[_0x5f4edc(0xe4)][_0x5f4edc(0x8a)],'expiry_date':_0x2933bf[_0x5f4edc(0xe6)]};}catch(_0x52e66a){console[_0x5f4edc(0xa1)](_0x5f4edc(0xbc)),console['error'](_0x5f4edc(0xd4),_0x52e66a),loggerService_1['loggerService'][_0x5f4edc(0xbe)](_0x5f4edc(0xfa),_0x5f4edc(0x8f),_0x52e66a);if(_0x52e66a instanceof Error){console[_0x5f4edc(0xa1)](_0x5f4edc(0xc2),_0x52e66a[_0x5f4edc(0xdf)]),console['error']('Error\x20stack:',_0x52e66a[_0x5f4edc(0xf4)]);throw new Error(_0x5f4edc(0x9e)+_0x52e66a[_0x5f4edc(0xdf)]);}throw new Error(_0x5f4edc(0x87));}}async[a39_0x4fd4af(0xda)](_0x196a9a){const _0x46bd37=a39_0x4fd4af,_0x5d25bf=Date['now']();try{loggerService_1['loggerService'][_0x46bd37(0x88)]('noda','/payment-links/'+_0x196a9a,'GET',{});const _0x4ccba0=await fetch(this[_0x46bd37(0x9b)]+'/'+_0x196a9a,{'method':_0x46bd37(0xd5),'headers':{'Content-Type':'application/json','User-Agent':_0x46bd37(0xdb)}}),_0x36e44a=Date['now']()-_0x5d25bf;if(!_0x4ccba0['ok']){const _0x14aae8=await _0x4ccba0[_0x46bd37(0x97)]();loggerService_1[_0x46bd37(0x8b)]['logWhiteDomainResponse'](_0x46bd37(0xfa),_0x46bd37(0xb7)+_0x196a9a,_0x4ccba0[_0x46bd37(0xc9)],_0x14aae8,_0x36e44a);throw new Error(_0x46bd37(0xdc)+_0x4ccba0[_0x46bd37(0xc9)]);}const _0x8a5f37=await _0x4ccba0[_0x46bd37(0x86)]();loggerService_1[_0x46bd37(0x8b)]['logWhiteDomainResponse'](_0x46bd37(0xfa),_0x46bd37(0xb7)+_0x196a9a,_0x4ccba0[_0x46bd37(0xc9)],_0x8a5f37,_0x36e44a);if(_0x8a5f37[_0x46bd37(0xa1)]||_0x8a5f37[_0x46bd37(0xb3)]){loggerService_1[_0x46bd37(0x8b)][_0x46bd37(0xbe)](_0x46bd37(0xfa),'/payment-links/'+_0x196a9a,'Noda\x20API\x20error:\x20'+(_0x8a5f37[_0x46bd37(0xdf)]||_0x8a5f37['error']||_0x46bd37(0xa3)));throw new Error(_0x46bd37(0xc3)+(_0x8a5f37['message']||_0x8a5f37[_0x46bd37(0xa1)]||_0x46bd37(0xa3)));}let _0x2a263d=_0x46bd37(0xeb);if(_0x8a5f37[_0x46bd37(0xf9)]===![]){if(_0x8a5f37[_0x46bd37(0xe6)]){const _0x6bf1f4=new Date(_0x8a5f37[_0x46bd37(0xe6)]),_0x30620c=new Date();_0x6bf1f4<_0x30620c?_0x2a263d=_0x46bd37(0xa6):_0x2a263d=_0x46bd37(0x92);}else _0x2a263d=_0x46bd37(0x92);}else _0x2a263d='PENDING';return{'status':_0x2a263d,'amount':_0x8a5f37[_0x46bd37(0x8e)],'currency':_0x8a5f37[_0x46bd37(0xa0)],'isActive':_0x8a5f37[_0x46bd37(0xf9)]};}catch(_0x30501b){console[_0x46bd37(0xa1)](_0x46bd37(0xec),_0x30501b),loggerService_1[_0x46bd37(0x8b)][_0x46bd37(0xbe)](_0x46bd37(0xfa),'/payment-links/'+_0x196a9a,_0x30501b);throw new Error(_0x46bd37(0xe8)+(_0x30501b instanceof Error?_0x30501b[_0x46bd37(0xdf)]:'Unknown\x20error'));}}async[a39_0x4fd4af(0x8c)](_0x46f781){const _0x38d719=a39_0x4fd4af;console[_0x38d719(0xd9)](_0x38d719(0xcb),_0x46f781);let _0x4b1a64='PENDING';switch(_0x46f781[_0x38d719(0x89)]?.['toLowerCase']()){case _0x38d719(0xe2):case _0x38d719(0xc0):case _0x38d719(0x94):case _0x38d719(0xa7):case _0x38d719(0xd8):_0x46f781[_0x38d719(0xee)]==='Yes'?_0x4b1a64=_0x38d719(0xb5):_0x4b1a64=_0x38d719(0xeb);break;case _0x38d719(0xdd):case _0x38d719(0xbf):case _0x38d719(0xf0):case _0x38d719(0xa1):case _0x38d719(0xb0):_0x4b1a64=_0x38d719(0x92);break;case _0x38d719(0xf2):case _0x38d719(0xcd):_0x4b1a64=_0x38d719(0xa6);break;case'pending':case'created':case _0x38d719(0xbd):case _0x38d719(0xe3):case _0x38d719(0xc8):default:_0x4b1a64=_0x38d719(0xeb);break;}return{'paymentId':_0x46f781[_0x38d719(0xf8)]||_0x46f781[_0x38d719(0xa8)],'status':_0x4b1a64,'amount':_0x46f781[_0x38d719(0xc5)],'currency':_0x46f781[_0x38d719(0xd0)],'additionalInfo':{'method':_0x46f781['Method'],'bankId':_0x46f781[_0x38d719(0xf6)],'settled':_0x46f781[_0x38d719(0xee)],'settlementDate':_0x46f781[_0x38d719(0xb9)],'remitterName':_0x46f781[_0x38d719(0xd7)]?.[_0x38d719(0x9a)],'remitterIban':_0x46f781['Remitter']?.[_0x38d719(0xfc)],'bankTransactionId':_0x46f781[_0x38d719(0x8d)]}};}[a39_0x4fd4af(0x99)](_0x529ae9,_0x5807ef){const _0x41cf57=a39_0x4fd4af;return console[_0x41cf57(0xd9)](_0x41cf57(0xac),{'receivedSignature':_0x5807ef,'paymentId':_0x529ae9['PaymentId'],'merchantPaymentId':_0x529ae9['MerchantPaymentId']}),!![];}}exports[a39_0x4fd4af(0xed)]=NodaService;