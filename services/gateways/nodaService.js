'use strict';const a44_0x130bfc=a44_0x34ff;function a44_0x1c1c(){const _0x439aec=['Status\x20Code:','currency','/payment-links','logWhiteDomainError','Processing\x20Noda\x20webhook:','loggerService','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','https://tesoft.uk/gateway/noda/','===\x20PARSED\x20NODA\x20RESPONSE\x20===','stack','Short\x20Link:','Failed\x20to\x20parse\x20JSON\x20response:','apiUrl','Status','Yes','Response\x20Body:','Not\x20provided','Response\x20data:','Missing\x20id\x20or\x20shortLink\x20in\x20response','isActive','(8digits-8digits\x20format)','expiryDate','SettlementDate','rejected','logWhiteDomainRequest','toLowerCase','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','EXPIRED','MerchantPaymentId','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','GET','log','verifyPayment','Name','5184879XgKcDb','4013130JWnrCx','entries','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','expired','76ZDNfMQ','FAILED','stringify','Currency','BankId','status','Failed\x20to\x20verify\x20Noda\x20payment:\x20','shortLink','TesSoft\x20Payment\x20System/1.0','5328LExZQM','Parsed\x20Result:','Iban','headers','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','3414115imbqeh','in_progress','statusCode','Remitter','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PENDING','noda','qrCodeLink','POST','message','===\x20NODA\x20SUCCESS\x20===','NodaService','processWebhook','Raw\x20Response\x20Body:','Business\x20Error:\x20','text','Noda\x20payment\x20verification\x20error:','PaymentId','/payment-links/','132105msLxgW','Status\x20Text:','9208XkJwmu','__esModule','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','cancelled','===\x20NODA\x20API\x20ERROR\x20===','successful','now','https://tesoft.uk/gateway/noda/webhook/','done','logWhiteDomainResponse','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Headers:','(8digits-8digits\x20format\x20for\x20Noda)','pending','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','json','verifyWebhookSignature','Unknown\x20error','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','BankTransactionId','Settled','shortLinkUrls','Error\x20details:','Error\x20message:','https://tesoft.uk/gateway/pending.php?id=','application/json','error','PAID','522080AyrBcO',',\x20body:\x20','Noda\x20API\x20error:\x20','Order\x20ID\x20Used:','created','statusText','Amount','URL:','1954994GSjrBb','HTTP\x20error!\x20status:\x20','Method','HTTP\x20Status:','Response\x20Time:','parse','HTTP\x20','timeout'];a44_0x1c1c=function(){return _0x439aec;};return a44_0x1c1c();}(function(_0x5cfa95,_0x26ce3c){const _0x59c455=a44_0x34ff,_0x461b7d=_0x5cfa95();while(!![]){try{const _0x3b2811=parseInt(_0x59c455(0xcd))/0x1+parseInt(_0x59c455(0xd5))/0x2+parseInt(_0x59c455(0xae))/0x3*(-parseInt(_0x59c455(0x8c))/0x4)+-parseInt(_0x59c455(0x9a))/0x5+parseInt(_0x59c455(0x88))/0x6+parseInt(_0x59c455(0x87))/0x7+parseInt(_0x59c455(0xb0))/0x8*(-parseInt(_0x59c455(0x95))/0x9);if(_0x3b2811===_0x26ce3c)break;else _0x461b7d['push'](_0x461b7d['shift']());}catch(_0x5a8a04){_0x461b7d['push'](_0x461b7d['shift']());}}}(a44_0x1c1c,0xace99));Object['defineProperty'](exports,a44_0x130bfc(0xb1),{'value':!![]}),exports[a44_0x130bfc(0xa6)]=void 0x0;function a44_0x34ff(_0x4d18cd,_0x342b05){const _0x1c1c17=a44_0x1c1c();return a44_0x34ff=function(_0x34ffd5,_0x1a5f05){_0x34ffd5=_0x34ffd5-0x73;let _0xf7e42b=_0x1c1c17[_0x34ffd5];return _0xf7e42b;},a44_0x34ff(_0x4d18cd,_0x342b05);}const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0xd08830=a44_0x130bfc;this['apiUrl']=_0xd08830(0xe4),console[_0xd08830(0x84)](_0xd08830(0x8a));}async['createPaymentLink'](_0x4da3fd){const _0x1a3b1b=a44_0x130bfc,{orderId:_0x462876,name:_0x2f1c45,paymentDescription:_0x251600,amount:_0x1b3bda,currency:_0xb0d4fb,webhookUrl:_0x33e548,returnUrl:_0x33b254,expiryDate:_0x3214e1}=_0x4da3fd,_0x1d41ef=_0xb0d4fb['toUpperCase'](),_0x30e85c=_0x1a3b1b(0xb8),_0x1d9896=_0x1a3b1b(0xc9)+_0x462876,_0x18f9e9={'name':_0x2f1c45,'paymentDescription':_0x251600,'amount':_0x1b3bda,'currency':_0x1d41ef,'paymentId':_0x462876,'webhookUrl':_0x30e85c,'returnUrl':_0x1d9896};_0x3214e1&&(_0x18f9e9[_0x1a3b1b(0x79)]=_0x3214e1);const _0x2c3a1a=Date[_0x1a3b1b(0xb7)]();try{console['log'](_0x1a3b1b(0xb2)),console[_0x1a3b1b(0x84)](_0x1a3b1b(0xd4),this[_0x1a3b1b(0xe9)]),console['log']('Request\x20Body\x20(Direct\x20JSON):',JSON['stringify'](_0x18f9e9,null,0x2)),console['log']('Order\x20ID\x20Format:',_0x462876,_0x1a3b1b(0xbd)),console[_0x1a3b1b(0x84)](_0x1a3b1b(0x81),_0x1d9896),loggerService_1[_0x1a3b1b(0xe2)][_0x1a3b1b(0x7c)](_0x1a3b1b(0xa1),_0x1a3b1b(0xdf),'POST',_0x18f9e9);const _0x394336=await fetch(this[_0x1a3b1b(0xe9)],{'method':_0x1a3b1b(0xa3),'headers':{'Content-Type':'application/json','Accept':_0x1a3b1b(0xca),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1a3b1b(0x8e)](_0x18f9e9)}),_0xac10fd=Date[_0x1a3b1b(0xb7)]()-_0x2c3a1a;console[_0x1a3b1b(0x84)](_0x1a3b1b(0xbb)),console[_0x1a3b1b(0x84)]('Status:',_0x394336[_0x1a3b1b(0x91)]),console['log'](_0x1a3b1b(0xaf),_0x394336[_0x1a3b1b(0xd2)]),console['log'](_0x1a3b1b(0xbc),Object['fromEntries'](_0x394336[_0x1a3b1b(0x98)][_0x1a3b1b(0x89)]())),console[_0x1a3b1b(0x84)](_0x1a3b1b(0xd9),_0xac10fd+'ms');const _0x524568=await _0x394336[_0x1a3b1b(0xaa)]();console[_0x1a3b1b(0x84)](_0x1a3b1b(0xa8),_0x524568);if(!_0x394336['ok']){console[_0x1a3b1b(0xcb)](_0x1a3b1b(0xb5)),console[_0x1a3b1b(0xcb)](_0x1a3b1b(0xd8),_0x394336[_0x1a3b1b(0x91)]),console[_0x1a3b1b(0xcb)](_0x1a3b1b(0x73),_0x524568),loggerService_1[_0x1a3b1b(0xe2)][_0x1a3b1b(0xba)](_0x1a3b1b(0xa1),_0x1a3b1b(0xdf),_0x394336[_0x1a3b1b(0x91)],_0x524568,_0xac10fd),loggerService_1[_0x1a3b1b(0xe2)][_0x1a3b1b(0xe0)](_0x1a3b1b(0xa1),_0x1a3b1b(0xdf),_0x1a3b1b(0xdb)+_0x394336[_0x1a3b1b(0x91)]+':\x20'+_0x524568);if(_0x394336[_0x1a3b1b(0x91)]===0x190)throw new Error(_0x1a3b1b(0xc3));else{if(_0x394336['status']===0x1f4)throw new Error(_0x1a3b1b(0x99));}throw new Error(_0x1a3b1b(0xd6)+_0x394336['status']+_0x1a3b1b(0xce)+_0x524568);}let _0x1da044;try{_0x1da044=JSON[_0x1a3b1b(0xda)](_0x524568);}catch(_0x257ffc){console[_0x1a3b1b(0xcb)](_0x1a3b1b(0xe8),_0x257ffc),loggerService_1[_0x1a3b1b(0xe2)]['logWhiteDomainError'](_0x1a3b1b(0xa1),_0x1a3b1b(0xdf),'JSON\x20Parse\x20Error:\x20'+_0x257ffc);throw new Error(_0x1a3b1b(0x9e)+_0x524568);}console[_0x1a3b1b(0x84)](_0x1a3b1b(0xe5)),console[_0x1a3b1b(0x84)](_0x1a3b1b(0x96),JSON[_0x1a3b1b(0x8e)](_0x1da044,null,0x2)),loggerService_1[_0x1a3b1b(0xe2)]['logWhiteDomainResponse'](_0x1a3b1b(0xa1),_0x1a3b1b(0xdf),_0x394336[_0x1a3b1b(0x91)],_0x1da044,_0xac10fd);if(_0x1da044[_0x1a3b1b(0xcb)]||_0x1da044['statusCode']){const _0x56fc4f=_0x1da044[_0x1a3b1b(0xa4)]||_0x1da044[_0x1a3b1b(0xcb)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x1a3b1b(0xcb)](_0x1a3b1b(0x7e)),console[_0x1a3b1b(0xcb)]('Error\x20Message:',_0x56fc4f),console[_0x1a3b1b(0xcb)](_0x1a3b1b(0xdd),_0x1da044[_0x1a3b1b(0x9c)]),loggerService_1['loggerService'][_0x1a3b1b(0xe0)](_0x1a3b1b(0xa1),_0x1a3b1b(0xdf),_0x1a3b1b(0xa9)+_0x56fc4f);throw new Error(_0x1a3b1b(0xcf)+_0x56fc4f);}if(!_0x1da044['id']||!_0x1da044[_0x1a3b1b(0xc6)]?.[_0x1a3b1b(0x93)]){console[_0x1a3b1b(0xcb)](_0x1a3b1b(0x9f)),console[_0x1a3b1b(0xcb)](_0x1a3b1b(0x76)),console[_0x1a3b1b(0xcb)](_0x1a3b1b(0x75),_0x1da044),loggerService_1[_0x1a3b1b(0xe2)][_0x1a3b1b(0xe0)](_0x1a3b1b(0xa1),_0x1a3b1b(0xdf),_0x1a3b1b(0xe3));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x1a3b1b(0x84)](_0x1a3b1b(0xa5)),console[_0x1a3b1b(0x84)]('Payment\x20Link\x20ID:',_0x1da044['id']),console[_0x1a3b1b(0x84)](_0x1a3b1b(0xe7),_0x1da044[_0x1a3b1b(0xc6)]['shortLink']),console[_0x1a3b1b(0x84)]('QR\x20Code\x20Link:',_0x1da044[_0x1a3b1b(0xc6)][_0x1a3b1b(0xa2)]||_0x1a3b1b(0x74)),console[_0x1a3b1b(0x84)](_0x1a3b1b(0xd0),_0x462876,_0x1a3b1b(0x78)),console[_0x1a3b1b(0x84)](_0x1a3b1b(0xb3),_0x1d9896),{'gateway_payment_id':_0x1da044['id'],'payment_url':_0x1da044['shortLinkUrls'][_0x1a3b1b(0x93)],'qr_code_url':_0x1da044['shortLinkUrls'][_0x1a3b1b(0xa2)],'expiry_date':_0x1da044[_0x1a3b1b(0x79)]};}catch(_0x5e28a6){console[_0x1a3b1b(0xcb)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x1a3b1b(0xcb)](_0x1a3b1b(0xc7),_0x5e28a6),loggerService_1[_0x1a3b1b(0xe2)][_0x1a3b1b(0xe0)](_0x1a3b1b(0xa1),'/payment-links',_0x5e28a6);if(_0x5e28a6 instanceof Error){console[_0x1a3b1b(0xcb)](_0x1a3b1b(0xc8),_0x5e28a6['message']),console[_0x1a3b1b(0xcb)]('Error\x20stack:',_0x5e28a6[_0x1a3b1b(0xe6)]);throw new Error(_0x1a3b1b(0x82)+_0x5e28a6[_0x1a3b1b(0xa4)]);}throw new Error(_0x1a3b1b(0xbf));}}async[a44_0x130bfc(0x85)](_0x49f83b){const _0x422381=a44_0x130bfc,_0x346579=Date[_0x422381(0xb7)]();try{loggerService_1[_0x422381(0xe2)][_0x422381(0x7c)](_0x422381(0xa1),_0x422381(0xad)+_0x49f83b,_0x422381(0x83),{});const _0x59d8dc=await fetch(this['apiUrl']+'/'+_0x49f83b,{'method':'GET','headers':{'Content-Type':_0x422381(0xca),'User-Agent':_0x422381(0x94)}}),_0x34e994=Date[_0x422381(0xb7)]()-_0x346579;if(!_0x59d8dc['ok']){const _0x98843d=await _0x59d8dc[_0x422381(0xaa)]();loggerService_1[_0x422381(0xe2)][_0x422381(0xba)](_0x422381(0xa1),_0x422381(0xad)+_0x49f83b,_0x59d8dc[_0x422381(0x91)],_0x98843d,_0x34e994);throw new Error(_0x422381(0xd6)+_0x59d8dc[_0x422381(0x91)]);}const _0x2d6102=await _0x59d8dc[_0x422381(0xc0)]();loggerService_1[_0x422381(0xe2)][_0x422381(0xba)](_0x422381(0xa1),_0x422381(0xad)+_0x49f83b,_0x59d8dc[_0x422381(0x91)],_0x2d6102,_0x34e994);if(_0x2d6102[_0x422381(0xcb)]||_0x2d6102['statusCode']){loggerService_1['loggerService'][_0x422381(0xe0)](_0x422381(0xa1),_0x422381(0xad)+_0x49f83b,'Noda\x20API\x20error:\x20'+(_0x2d6102[_0x422381(0xa4)]||_0x2d6102['error']||_0x422381(0xc2)));throw new Error('Noda\x20API\x20error:\x20'+(_0x2d6102[_0x422381(0xa4)]||_0x2d6102[_0x422381(0xcb)]||_0x422381(0xc2)));}let _0x591238=_0x422381(0xa0);if(_0x2d6102[_0x422381(0x77)]===![]){if(_0x2d6102['expiryDate']){const _0x38d395=new Date(_0x2d6102[_0x422381(0x79)]),_0xf8018a=new Date();_0x38d395<_0xf8018a?_0x591238=_0x422381(0x7f):_0x591238=_0x422381(0x8d);}else _0x591238=_0x422381(0x8d);}else _0x591238=_0x422381(0xa0);return{'status':_0x591238,'amount':_0x2d6102['amount'],'currency':_0x2d6102[_0x422381(0xde)],'isActive':_0x2d6102[_0x422381(0x77)]};}catch(_0x4102f6){console[_0x422381(0xcb)](_0x422381(0xab),_0x4102f6),loggerService_1[_0x422381(0xe2)][_0x422381(0xe0)]('noda',_0x422381(0xad)+_0x49f83b,_0x4102f6);throw new Error(_0x422381(0x92)+(_0x4102f6 instanceof Error?_0x4102f6[_0x422381(0xa4)]:_0x422381(0xc2)));}}async[a44_0x130bfc(0xa7)](_0x1f1df6){const _0x17290b=a44_0x130bfc;console[_0x17290b(0x84)](_0x17290b(0xe1),_0x1f1df6);let _0x1046be='PENDING';switch(_0x1f1df6[_0x17290b(0xea)]?.[_0x17290b(0x7d)]()){case _0x17290b(0xb9):case'completed':case'paid':case'success':case _0x17290b(0xb6):_0x1f1df6[_0x17290b(0xc5)]===_0x17290b(0xeb)?_0x1046be=_0x17290b(0xcc):_0x1046be=_0x17290b(0xa0);break;case _0x17290b(0xb4):case'canceled':case'failed':case _0x17290b(0xcb):case _0x17290b(0x7b):_0x1046be=_0x17290b(0x8d);break;case _0x17290b(0x8b):case _0x17290b(0xdc):_0x1046be='EXPIRED';break;case _0x17290b(0xbe):case _0x17290b(0xd1):case'active':case'processing':case _0x17290b(0x9b):default:_0x1046be=_0x17290b(0xa0);break;}return{'paymentId':_0x1f1df6['MerchantPaymentId']||_0x1f1df6[_0x17290b(0xac)],'status':_0x1046be,'amount':_0x1f1df6[_0x17290b(0xd3)],'currency':_0x1f1df6[_0x17290b(0x8f)],'additionalInfo':{'method':_0x1f1df6[_0x17290b(0xd7)],'bankId':_0x1f1df6[_0x17290b(0x90)],'settled':_0x1f1df6[_0x17290b(0xc5)],'settlementDate':_0x1f1df6[_0x17290b(0x7a)],'remitterName':_0x1f1df6[_0x17290b(0x9d)]?.[_0x17290b(0x86)],'remitterIban':_0x1f1df6['Remitter']?.[_0x17290b(0x97)],'bankTransactionId':_0x1f1df6[_0x17290b(0xc4)]}};}[a44_0x130bfc(0xc1)](_0x395b34,_0x2094e5){const _0x1cedaf=a44_0x130bfc;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x2094e5,'paymentId':_0x395b34['PaymentId'],'merchantPaymentId':_0x395b34[_0x1cedaf(0x80)]}),!![];}}exports['NodaService']=NodaService;