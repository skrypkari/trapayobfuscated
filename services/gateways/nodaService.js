'use strict';const a60_0x12006f=a60_0x2e86;(function(_0xe03222,_0x1fbf40){const _0x23c82d=a60_0x2e86,_0x4932f3=_0xe03222();while(!![]){try{const _0x1c8b26=parseInt(_0x23c82d(0x1a2))/0x1+parseInt(_0x23c82d(0x180))/0x2+parseInt(_0x23c82d(0x16b))/0x3*(parseInt(_0x23c82d(0x199))/0x4)+parseInt(_0x23c82d(0x13b))/0x5+parseInt(_0x23c82d(0x185))/0x6+-parseInt(_0x23c82d(0x19b))/0x7*(parseInt(_0x23c82d(0x15d))/0x8)+-parseInt(_0x23c82d(0x17a))/0x9*(parseInt(_0x23c82d(0x1aa))/0xa);if(_0x1c8b26===_0x1fbf40)break;else _0x4932f3['push'](_0x4932f3['shift']());}catch(_0xfe3c1d){_0x4932f3['push'](_0x4932f3['shift']());}}}(a60_0x4a0c,0xa67a5));Object[a60_0x12006f(0x17d)](exports,a60_0x12006f(0x1ae),{'value':!![]}),exports[a60_0x12006f(0x13e)]=void 0x0;function a60_0x2e86(_0x45c9f0,_0x3f9f19){_0x45c9f0=_0x45c9f0-0x137;const _0x4a0c49=a60_0x4a0c();let _0x2e86ee=_0x4a0c49[_0x45c9f0];return _0x2e86ee;}const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x572462=a60_0x12006f;this['apiUrl']=_0x572462(0x16e),console[_0x572462(0x183)](_0x572462(0x1b2));}async['createPaymentLink'](_0x50edd4){const _0x478c6a=a60_0x12006f,{orderId:_0x59cb94,name:_0xe69fc5,paymentDescription:_0x3f8e7a,amount:_0x547714,currency:_0x40ccbc,webhookUrl:_0x398d12,returnUrl:_0x25904c,expiryDate:_0x2904fe}=_0x50edd4,_0x26c170=_0x40ccbc[_0x478c6a(0x15c)](),_0x5b5610=_0x478c6a(0x150),_0x5eca80=_0x478c6a(0x192)+_0x59cb94,_0x249da8={'name':_0xe69fc5,'paymentDescription':_0x3f8e7a,'amount':_0x547714,'currency':_0x26c170,'paymentId':_0x59cb94,'webhookUrl':_0x5b5610,'returnUrl':_0x5eca80};_0x2904fe&&(_0x249da8[_0x478c6a(0x1a1)]=_0x2904fe);const _0x1e127f=Date[_0x478c6a(0x168)]();try{console['log'](_0x478c6a(0x17f)),console[_0x478c6a(0x183)](_0x478c6a(0x188),this[_0x478c6a(0x160)]),console[_0x478c6a(0x183)](_0x478c6a(0x149),JSON[_0x478c6a(0x139)](_0x249da8,null,0x2)),console[_0x478c6a(0x183)](_0x478c6a(0x153),_0x59cb94,_0x478c6a(0x1a0)),console[_0x478c6a(0x183)](_0x478c6a(0x158),_0x5eca80),loggerService_1[_0x478c6a(0x16d)][_0x478c6a(0x165)]('noda',_0x478c6a(0x198),'POST',_0x249da8);const _0x2b5b81=await fetch(this[_0x478c6a(0x160)],{'method':_0x478c6a(0x19e),'headers':{'Content-Type':_0x478c6a(0x191),'Accept':'application/json','User-Agent':_0x478c6a(0x170)},'body':JSON[_0x478c6a(0x139)](_0x249da8)}),_0x11f8ed=Date['now']()-_0x1e127f;console[_0x478c6a(0x183)](_0x478c6a(0x145)),console[_0x478c6a(0x183)](_0x478c6a(0x195),_0x2b5b81[_0x478c6a(0x140)]),console[_0x478c6a(0x183)](_0x478c6a(0x196),_0x2b5b81[_0x478c6a(0x19d)]),console[_0x478c6a(0x183)](_0x478c6a(0x178),Object[_0x478c6a(0x162)](_0x2b5b81['headers'][_0x478c6a(0x15a)]())),console['log'](_0x478c6a(0x175),_0x11f8ed+'ms');const _0x19459a=await _0x2b5b81[_0x478c6a(0x137)]();console[_0x478c6a(0x183)](_0x478c6a(0x14a),_0x19459a);if(!_0x2b5b81['ok']){console[_0x478c6a(0x1ab)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x478c6a(0x1ab)](_0x478c6a(0x17e),_0x2b5b81[_0x478c6a(0x140)]),console[_0x478c6a(0x1ab)]('Response\x20Body:',_0x19459a),loggerService_1['loggerService'][_0x478c6a(0x14b)](_0x478c6a(0x173),_0x478c6a(0x198),_0x2b5b81['status'],_0x19459a,_0x11f8ed),loggerService_1[_0x478c6a(0x16d)][_0x478c6a(0x15e)](_0x478c6a(0x173),_0x478c6a(0x198),_0x478c6a(0x184)+_0x2b5b81[_0x478c6a(0x140)]+':\x20'+_0x19459a);if(_0x2b5b81[_0x478c6a(0x140)]===0x190)throw new Error(_0x478c6a(0x179));else{if(_0x2b5b81[_0x478c6a(0x140)]===0x1f4)throw new Error(_0x478c6a(0x159));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x2b5b81[_0x478c6a(0x140)]+_0x478c6a(0x1b1)+_0x19459a);}let _0x59901f;try{_0x59901f=JSON[_0x478c6a(0x148)](_0x19459a);}catch(_0x8885cb){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x8885cb),loggerService_1['loggerService'][_0x478c6a(0x15e)](_0x478c6a(0x173),_0x478c6a(0x198),'JSON\x20Parse\x20Error:\x20'+_0x8885cb);throw new Error(_0x478c6a(0x14c)+_0x19459a);}console[_0x478c6a(0x183)](_0x478c6a(0x161)),console[_0x478c6a(0x183)](_0x478c6a(0x16c),JSON[_0x478c6a(0x139)](_0x59901f,null,0x2)),loggerService_1[_0x478c6a(0x16d)]['logWhiteDomainResponse']('noda','/payment-links',_0x2b5b81[_0x478c6a(0x140)],_0x59901f,_0x11f8ed);if(_0x59901f[_0x478c6a(0x1ab)]||_0x59901f[_0x478c6a(0x197)]){const _0x48483e=_0x59901f[_0x478c6a(0x18b)]||_0x59901f[_0x478c6a(0x1ab)]||_0x478c6a(0x1ad);console[_0x478c6a(0x1ab)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x48483e),console['error'](_0x478c6a(0x14e),_0x59901f[_0x478c6a(0x197)]),loggerService_1[_0x478c6a(0x16d)][_0x478c6a(0x15e)]('noda',_0x478c6a(0x198),'Business\x20Error:\x20'+_0x48483e);throw new Error(_0x478c6a(0x19f)+_0x48483e);}if(!_0x59901f['id']||!_0x59901f[_0x478c6a(0x141)]?.['shortLink']){console[_0x478c6a(0x1ab)](_0x478c6a(0x166)),console['error'](_0x478c6a(0x169)),console[_0x478c6a(0x1ab)](_0x478c6a(0x13d),_0x59901f),loggerService_1[_0x478c6a(0x16d)][_0x478c6a(0x15e)](_0x478c6a(0x173),_0x478c6a(0x198),_0x478c6a(0x15b));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x478c6a(0x183)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x478c6a(0x183)](_0x478c6a(0x176),_0x59901f['id']),console[_0x478c6a(0x183)](_0x478c6a(0x152),_0x59901f[_0x478c6a(0x141)][_0x478c6a(0x138)]),console[_0x478c6a(0x183)](_0x478c6a(0x156),_0x59901f[_0x478c6a(0x141)][_0x478c6a(0x189)]||'Not\x20provided'),console[_0x478c6a(0x183)]('Order\x20ID\x20Used:',_0x59cb94,_0x478c6a(0x146)),console[_0x478c6a(0x183)](_0x478c6a(0x18d),_0x5eca80),{'gateway_payment_id':_0x59901f['id'],'payment_url':_0x59901f['shortLinkUrls'][_0x478c6a(0x138)],'qr_code_url':_0x59901f[_0x478c6a(0x141)]['qrCodeLink'],'expiry_date':_0x59901f[_0x478c6a(0x1a1)]};}catch(_0x3f102c){console[_0x478c6a(0x1ab)](_0x478c6a(0x1af)),console['error'](_0x478c6a(0x163),_0x3f102c),loggerService_1[_0x478c6a(0x16d)][_0x478c6a(0x15e)](_0x478c6a(0x173),'/payment-links',_0x3f102c);if(_0x3f102c instanceof Error){console[_0x478c6a(0x1ab)](_0x478c6a(0x13f),_0x3f102c['message']),console[_0x478c6a(0x1ab)](_0x478c6a(0x17b),_0x3f102c[_0x478c6a(0x193)]);throw new Error(_0x478c6a(0x18a)+_0x3f102c[_0x478c6a(0x18b)]);}throw new Error(_0x478c6a(0x154));}}async[a60_0x12006f(0x190)](_0x41d9c5){const _0x4a7773=a60_0x12006f,_0x4e4111=Date[_0x4a7773(0x168)]();try{loggerService_1[_0x4a7773(0x16d)][_0x4a7773(0x165)](_0x4a7773(0x173),'/payment-links/'+_0x41d9c5,_0x4a7773(0x174),{});const _0x5a57c9=await fetch(this[_0x4a7773(0x160)]+'/'+_0x41d9c5,{'method':_0x4a7773(0x174),'headers':{'Content-Type':_0x4a7773(0x191),'User-Agent':'Payment\x20System/1.0'}}),_0x476a09=Date[_0x4a7773(0x168)]()-_0x4e4111;if(!_0x5a57c9['ok']){const _0x19d30c=await _0x5a57c9['text']();loggerService_1['loggerService'][_0x4a7773(0x14b)](_0x4a7773(0x173),_0x4a7773(0x1a3)+_0x41d9c5,_0x5a57c9[_0x4a7773(0x140)],_0x19d30c,_0x476a09);throw new Error(_0x4a7773(0x16f)+_0x5a57c9[_0x4a7773(0x140)]);}const _0x1484ec=await _0x5a57c9[_0x4a7773(0x142)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4a7773(0x173),_0x4a7773(0x1a3)+_0x41d9c5,_0x5a57c9[_0x4a7773(0x140)],_0x1484ec,_0x476a09);if(_0x1484ec[_0x4a7773(0x1ab)]||_0x1484ec[_0x4a7773(0x197)]){loggerService_1[_0x4a7773(0x16d)]['logWhiteDomainError'](_0x4a7773(0x173),_0x4a7773(0x1a3)+_0x41d9c5,'Noda\x20API\x20error:\x20'+(_0x1484ec[_0x4a7773(0x18b)]||_0x1484ec[_0x4a7773(0x1ab)]||_0x4a7773(0x15f)));throw new Error(_0x4a7773(0x19f)+(_0x1484ec[_0x4a7773(0x18b)]||_0x1484ec[_0x4a7773(0x1ab)]||_0x4a7773(0x15f)));}let _0x57ec86=_0x4a7773(0x147);if(_0x1484ec[_0x4a7773(0x19a)]===![]){if(_0x1484ec[_0x4a7773(0x1a1)]){const _0x3fae13=new Date(_0x1484ec[_0x4a7773(0x1a1)]),_0x324126=new Date();_0x3fae13<_0x324126?_0x57ec86='EXPIRED':_0x57ec86=_0x4a7773(0x172);}else _0x57ec86=_0x4a7773(0x172);}else _0x57ec86='PENDING';return{'status':_0x57ec86,'amount':_0x1484ec[_0x4a7773(0x18c)],'currency':_0x1484ec[_0x4a7773(0x1a9)],'isActive':_0x1484ec[_0x4a7773(0x19a)]};}catch(_0x29849c){console['error']('Noda\x20payment\x20verification\x20error:',_0x29849c),loggerService_1[_0x4a7773(0x16d)][_0x4a7773(0x15e)]('noda','/payment-links/'+_0x41d9c5,_0x29849c);throw new Error(_0x4a7773(0x1b0)+(_0x29849c instanceof Error?_0x29849c[_0x4a7773(0x18b)]:_0x4a7773(0x15f)));}}async['processWebhook'](_0x1668ef){const _0x189f5f=a60_0x12006f;console[_0x189f5f(0x183)](_0x189f5f(0x157),_0x1668ef);let _0xa50fe6=_0x189f5f(0x147);switch(_0x1668ef[_0x189f5f(0x186)]?.[_0x189f5f(0x14d)]()){case _0x189f5f(0x1a7):case _0x189f5f(0x151):case _0x189f5f(0x13c):case _0x189f5f(0x17c):case _0x189f5f(0x1b3):_0x1668ef[_0x189f5f(0x16a)]===_0x189f5f(0x167)?_0xa50fe6=_0x189f5f(0x1ac):_0xa50fe6=_0x189f5f(0x147);break;case _0x189f5f(0x182):case'canceled':case _0x189f5f(0x19c):case _0x189f5f(0x1ab):case _0x189f5f(0x18f):_0xa50fe6=_0x189f5f(0x172);break;case _0x189f5f(0x144):case _0x189f5f(0x171):_0xa50fe6=_0x189f5f(0x14f);break;case _0x189f5f(0x187):case'created':case _0x189f5f(0x177):case'processing':case _0x189f5f(0x1a6):default:_0xa50fe6=_0x189f5f(0x147);break;}return{'paymentId':_0x1668ef[_0x189f5f(0x155)]||_0x1668ef[_0x189f5f(0x194)],'status':_0xa50fe6,'amount':_0x1668ef['Amount'],'currency':_0x1668ef['Currency'],'additionalInfo':{'method':_0x1668ef[_0x189f5f(0x18e)],'bankId':_0x1668ef[_0x189f5f(0x1a8)],'settled':_0x1668ef[_0x189f5f(0x16a)],'settlementDate':_0x1668ef[_0x189f5f(0x1a5)],'remitterName':_0x1668ef[_0x189f5f(0x1a4)]?.[_0x189f5f(0x13a)],'remitterIban':_0x1668ef[_0x189f5f(0x1a4)]?.[_0x189f5f(0x164)],'bankTransactionId':_0x1668ef[_0x189f5f(0x143)]}};}['verifyWebhookSignature'](_0x5d51d1,_0x54d80e){const _0x2e665b=a60_0x12006f;return console[_0x2e665b(0x183)](_0x2e665b(0x181),{'receivedSignature':_0x54d80e,'paymentId':_0x5d51d1[_0x2e665b(0x194)],'merchantPaymentId':_0x5d51d1[_0x2e665b(0x155)]}),!![];}}exports['NodaService']=NodaService;function a60_0x4a0c(){const _0x45b084=['Noda\x20API\x20error:\x20','(8digits-8digits\x20format\x20for\x20Noda)','expiryDate','1175623bNVLyd','/payment-links/','Remitter','SettlementDate','in_progress','done','BankId','currency','32510DeAJyq','error','PAID','Unknown\x20error\x20from\x20Noda\x20API','__esModule','===\x20NODA\x20SERVICE\x20ERROR\x20===','Failed\x20to\x20verify\x20Noda\x20payment:\x20',',\x20body:\x20','ðŸŒ\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','successful','text','shortLink','stringify','Name','4789325fSBPnj','paid','Response\x20data:','NodaService','Error\x20message:','status','shortLinkUrls','json','BankTransactionId','expired','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','(8digits-8digits\x20format)','PENDING','parse','Request\x20Body\x20(Direct\x20JSON):','Raw\x20Response\x20Body:','logWhiteDomainResponse','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','toLowerCase','Status\x20Code:','EXPIRED','https://tesoft.uk/gateway/noda/webhook/','completed','Short\x20Link:','Order\x20ID\x20Format:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','MerchantPaymentId','QR\x20Code\x20Link:','Processing\x20Noda\x20webhook:','âœ…\x20ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž:\x20Return\x20URL\x20uses\x20pending.php:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','entries','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','toUpperCase','660496CAmbaw','logWhiteDomainError','Unknown\x20error','apiUrl','===\x20PARSED\x20NODA\x20RESPONSE\x20===','fromEntries','Error\x20details:','Iban','logWhiteDomainRequest','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Yes','now','Missing\x20id\x20or\x20shortLink\x20in\x20response','Settled','132zrwkam','Parsed\x20Result:','loggerService','https://tesoft.uk/gateway/noda/','HTTP\x20error!\x20status:\x20','Payment\x20System/1.0','timeout','FAILED','noda','GET','Response\x20Time:','Payment\x20Link\x20ID:','active','Headers:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','10674uJuJKV','Error\x20stack:','success','defineProperty','HTTP\x20Status:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','750496YHmXoo','Noda\x20webhook\x20signature\x20verification:','cancelled','log','HTTP\x20','7678566KegEVK','Status','pending','URL:','qrCodeLink','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','message','amount','âœ…\x20Return\x20URL\x20configured\x20for\x20pending:','Method','rejected','verifyPayment','application/json','https://tesoft.uk/gateway/pending.php?id=','stack','PaymentId','Status:','Status\x20Text:','statusCode','/payment-links','75604wUmigz','isActive','7cyufef','failed','statusText','POST'];a60_0x4a0c=function(){return _0x45b084;};return a60_0x4a0c();}