'use strict';const a71_0x37eabe=a71_0x372f;function a71_0x48c9(){const _0x13e243=['Noda\x20payment\x20verification\x20error:','849364ydORBO','success','Unknown\x20error','===\x20NODA\x20API\x20ERROR\x20===','Noda\x20webhook\x20signature\x20verification:','===\x20NODA\x20SUCCESS\x20===','(8digits-8digits\x20format\x20for\x20Noda)','15851jcOSPr','entries','Error\x20message:','Remitter','Parsed\x20Result:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','logWhiteDomainRequest','expiryDate','noda','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','https://tesoft.uk/gateway/pending.php?id=','Payment\x20System/1.0','Response\x20Time:','Iban','1156544OBCMFM','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','HTTP\x20error!\x20status:\x20','BankId','Raw\x20Response\x20Body:','HTTP\x20Status:','7137351wkWgyG','cancelled','now','successful','currency','6024mwVfCz','amount','55NeVGDZ','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','fromEntries','done','URL:','verifyWebhookSignature','FAILED','Settled','shortLink','isActive','Currency','expired','Missing\x20id\x20or\x20shortLink\x20in\x20response','https://tesoft.uk/gateway/noda/webhook/','Response\x20data:','failed','stack','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','created','347192RlUDDG','Order\x20ID\x20Format:','4224432iBEzHB','statusCode',',\x20body:\x20','pending','Request\x20Body\x20(Direct\x20JSON):','NodaService','toUpperCase','toLowerCase','EXPIRED','json','rejected','Amount','parse','text','/payment-links/','PENDING','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','message','createPaymentLink','processWebhook','timeout','/payment-links','Name','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','QR\x20Code\x20Link:','status','logWhiteDomainResponse','MerchantPaymentId','Failed\x20to\x20parse\x20JSON\x20response:','in_progress','logWhiteDomainError','active','completed','16YKdwHg','log','PaymentId','shortLinkUrls','Method','HTTP\x20','PAID','Response\x20Body:','error','===\x20NODA\x20SERVICE\x20ERROR\x20===','verifyPayment','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','GET','SettlementDate','statusText','qrCodeLink','Short\x20Link:','(8digits-8digits\x20format)','stringify','canceled','apiUrl','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','loggerService','Headers:','Unknown\x20error\x20from\x20Noda\x20API','headers','Business\x20Error:\x20','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Failed\x20to\x20verify\x20Noda\x20payment:\x20','7273SeULoq','Error\x20Message:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','5630aNHDMl','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','../loggerService','Order\x20ID\x20Used:','processing'];a71_0x48c9=function(){return _0x13e243;};return a71_0x48c9();}(function(_0x35bc46,_0x38744c){const _0x53816d=a71_0x372f,_0x10cb5c=_0x35bc46();while(!![]){try{const _0x51fe7f=-parseInt(_0x53816d(0x1ea))/0x1+-parseInt(_0x53816d(0x17f))/0x2+parseInt(_0x53816d(0x1a1))/0x3+parseInt(_0x53816d(0x19f))/0x4*(-parseInt(_0x53816d(0x18c))/0x5)+-parseInt(_0x53816d(0x18a))/0x6*(-parseInt(_0x53816d(0x1df))/0x7)+parseInt(_0x53816d(0x1c2))/0x8*(parseInt(_0x53816d(0x185))/0x9)+parseInt(_0x53816d(0x1e2))/0xa*(-parseInt(_0x53816d(0x1f1))/0xb);if(_0x51fe7f===_0x38744c)break;else _0x10cb5c['push'](_0x10cb5c['shift']());}catch(_0x344650){_0x10cb5c['push'](_0x10cb5c['shift']());}}}(a71_0x48c9,0xcdfa1));function a71_0x372f(_0x3c3bec,_0x23e634){_0x3c3bec=_0x3c3bec-0x179;const _0x48c988=a71_0x48c9();let _0x372fbd=_0x48c988[_0x3c3bec];return _0x372fbd;}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a71_0x37eabe(0x1a6)]=void 0x0;const loggerService_1=require(a71_0x37eabe(0x1e6));class NodaService{constructor(){const _0x4f9e71=a71_0x37eabe;this['apiUrl']='https://tesoft.uk/gateway/noda/',console[_0x4f9e71(0x1c3)](_0x4f9e71(0x1b1));}async[a71_0x37eabe(0x1b3)](_0x21c57d){const _0x5305bb=a71_0x37eabe,{orderId:_0x16ad6d,name:_0x48c965,paymentDescription:_0x24bfe1,amount:_0x5d3e91,currency:_0x4912ce,webhookUrl:_0x5b274e,returnUrl:_0xee8a28,expiryDate:_0x16631e}=_0x21c57d,_0x364c56=_0x4912ce[_0x5305bb(0x1a7)](),_0xcb4771=_0x5305bb(0x199),_0x20fb4d=_0x5305bb(0x17b)+_0x16ad6d,_0x48a69d={'name':_0x48c965,'paymentDescription':_0x24bfe1,'amount':_0x5d3e91,'currency':_0x364c56,'paymentId':_0x16ad6d,'webhookUrl':_0xcb4771,'returnUrl':_0x20fb4d};_0x16631e&&(_0x48a69d[_0x5305bb(0x1f8)]=_0x16631e);const _0x1f01bc=Date['now']();try{console['log'](_0x5305bb(0x1e1)),console[_0x5305bb(0x1c3)](_0x5305bb(0x190),this['apiUrl']),console[_0x5305bb(0x1c3)](_0x5305bb(0x1a5),JSON['stringify'](_0x48a69d,null,0x2)),console[_0x5305bb(0x1c3)](_0x5305bb(0x1a0),_0x16ad6d,_0x5305bb(0x1f0)),console[_0x5305bb(0x1c3)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x20fb4d),loggerService_1[_0x5305bb(0x1d8)][_0x5305bb(0x1f7)](_0x5305bb(0x179),_0x5305bb(0x1b6),'POST',_0x48a69d);const _0x4b9409=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x5305bb(0x17c)},'body':JSON[_0x5305bb(0x1d4)](_0x48a69d)}),_0xd31d64=Date[_0x5305bb(0x187)]()-_0x1f01bc;console[_0x5305bb(0x1c3)](_0x5305bb(0x180)),console[_0x5305bb(0x1c3)]('Status:',_0x4b9409[_0x5305bb(0x1ba)]),console[_0x5305bb(0x1c3)]('Status\x20Text:',_0x4b9409[_0x5305bb(0x1d0)]),console[_0x5305bb(0x1c3)](_0x5305bb(0x1d9),Object[_0x5305bb(0x18e)](_0x4b9409[_0x5305bb(0x1db)][_0x5305bb(0x1f2)]())),console['log'](_0x5305bb(0x17d),_0xd31d64+'ms');const _0x61953e=await _0x4b9409['text']();console[_0x5305bb(0x1c3)](_0x5305bb(0x183),_0x61953e);if(!_0x4b9409['ok']){console[_0x5305bb(0x1ca)](_0x5305bb(0x1ed)),console[_0x5305bb(0x1ca)](_0x5305bb(0x184),_0x4b9409[_0x5305bb(0x1ba)]),console['error'](_0x5305bb(0x1c9),_0x61953e),loggerService_1[_0x5305bb(0x1d8)]['logWhiteDomainResponse']('noda',_0x5305bb(0x1b6),_0x4b9409[_0x5305bb(0x1ba)],_0x61953e,_0xd31d64),loggerService_1[_0x5305bb(0x1d8)][_0x5305bb(0x1bf)](_0x5305bb(0x179),_0x5305bb(0x1b6),_0x5305bb(0x1c7)+_0x4b9409[_0x5305bb(0x1ba)]+':\x20'+_0x61953e);if(_0x4b9409[_0x5305bb(0x1ba)]===0x190)throw new Error(_0x5305bb(0x18d));else{if(_0x4b9409[_0x5305bb(0x1ba)]===0x1f4)throw new Error(_0x5305bb(0x1dd));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x4b9409['status']+_0x5305bb(0x1a3)+_0x61953e);}let _0x30995c;try{_0x30995c=JSON[_0x5305bb(0x1ad)](_0x61953e);}catch(_0x1ec220){console[_0x5305bb(0x1ca)](_0x5305bb(0x1bd),_0x1ec220),loggerService_1[_0x5305bb(0x1d8)]['logWhiteDomainError'](_0x5305bb(0x179),_0x5305bb(0x1b6),'JSON\x20Parse\x20Error:\x20'+_0x1ec220);throw new Error(_0x5305bb(0x17a)+_0x61953e);}console[_0x5305bb(0x1c3)](_0x5305bb(0x1e3)),console[_0x5305bb(0x1c3)](_0x5305bb(0x1f5),JSON[_0x5305bb(0x1d4)](_0x30995c,null,0x2)),loggerService_1[_0x5305bb(0x1d8)][_0x5305bb(0x1bb)](_0x5305bb(0x179),_0x5305bb(0x1b6),_0x4b9409[_0x5305bb(0x1ba)],_0x30995c,_0xd31d64);if(_0x30995c[_0x5305bb(0x1ca)]||_0x30995c[_0x5305bb(0x1a2)]){const _0x498cbb=_0x30995c['message']||_0x30995c[_0x5305bb(0x1ca)]||_0x5305bb(0x1da);console['error'](_0x5305bb(0x1d7)),console[_0x5305bb(0x1ca)](_0x5305bb(0x1e0),_0x498cbb),console['error']('Status\x20Code:',_0x30995c[_0x5305bb(0x1a2)]),loggerService_1['loggerService'][_0x5305bb(0x1bf)]('noda',_0x5305bb(0x1b6),_0x5305bb(0x1dc)+_0x498cbb);throw new Error('Noda\x20API\x20error:\x20'+_0x498cbb);}if(!_0x30995c['id']||!_0x30995c[_0x5305bb(0x1c5)]?.['shortLink']){console[_0x5305bb(0x1ca)](_0x5305bb(0x1cd)),console[_0x5305bb(0x1ca)](_0x5305bb(0x198)),console[_0x5305bb(0x1ca)](_0x5305bb(0x19a),_0x30995c),loggerService_1[_0x5305bb(0x1d8)][_0x5305bb(0x1bf)](_0x5305bb(0x179),_0x5305bb(0x1b6),_0x5305bb(0x1b8));throw new Error(_0x5305bb(0x19d));}return console['log'](_0x5305bb(0x1ef)),console['log']('Payment\x20Link\x20ID:',_0x30995c['id']),console['log'](_0x5305bb(0x1d2),_0x30995c[_0x5305bb(0x1c5)][_0x5305bb(0x194)]),console[_0x5305bb(0x1c3)](_0x5305bb(0x1b9),_0x30995c[_0x5305bb(0x1c5)][_0x5305bb(0x1d1)]||'Not\x20provided'),console['log'](_0x5305bb(0x1e7),_0x16ad6d,_0x5305bb(0x1d3)),console[_0x5305bb(0x1c3)](_0x5305bb(0x1f6),_0x20fb4d),{'gateway_payment_id':_0x30995c['id'],'payment_url':_0x30995c[_0x5305bb(0x1c5)][_0x5305bb(0x194)],'qr_code_url':_0x30995c['shortLinkUrls'][_0x5305bb(0x1d1)],'expiry_date':_0x30995c[_0x5305bb(0x1f8)]};}catch(_0x19fde4){console[_0x5305bb(0x1ca)](_0x5305bb(0x1cb)),console[_0x5305bb(0x1ca)]('Error\x20details:',_0x19fde4),loggerService_1[_0x5305bb(0x1d8)][_0x5305bb(0x1bf)](_0x5305bb(0x179),'/payment-links',_0x19fde4);if(_0x19fde4 instanceof Error){console[_0x5305bb(0x1ca)](_0x5305bb(0x1f3),_0x19fde4[_0x5305bb(0x1b2)]),console[_0x5305bb(0x1ca)]('Error\x20stack:',_0x19fde4[_0x5305bb(0x19c)]);throw new Error(_0x5305bb(0x1e4)+_0x19fde4[_0x5305bb(0x1b2)]);}throw new Error(_0x5305bb(0x1e5));}}async[a71_0x37eabe(0x1cc)](_0x27221b){const _0x40f77b=a71_0x37eabe,_0xed4c29=Date[_0x40f77b(0x187)]();try{loggerService_1[_0x40f77b(0x1d8)][_0x40f77b(0x1f7)](_0x40f77b(0x179),_0x40f77b(0x1af)+_0x27221b,_0x40f77b(0x1ce),{});const _0xb1ad48=await fetch(this[_0x40f77b(0x1d6)]+'/'+_0x27221b,{'method':_0x40f77b(0x1ce),'headers':{'Content-Type':'application/json','User-Agent':_0x40f77b(0x17c)}}),_0x51ba8d=Date[_0x40f77b(0x187)]()-_0xed4c29;if(!_0xb1ad48['ok']){const _0x4e7eb8=await _0xb1ad48[_0x40f77b(0x1ae)]();loggerService_1[_0x40f77b(0x1d8)][_0x40f77b(0x1bb)]('noda',_0x40f77b(0x1af)+_0x27221b,_0xb1ad48[_0x40f77b(0x1ba)],_0x4e7eb8,_0x51ba8d);throw new Error(_0x40f77b(0x181)+_0xb1ad48[_0x40f77b(0x1ba)]);}const _0x280b3f=await _0xb1ad48[_0x40f77b(0x1aa)]();loggerService_1['loggerService'][_0x40f77b(0x1bb)](_0x40f77b(0x179),_0x40f77b(0x1af)+_0x27221b,_0xb1ad48[_0x40f77b(0x1ba)],_0x280b3f,_0x51ba8d);if(_0x280b3f[_0x40f77b(0x1ca)]||_0x280b3f['statusCode']){loggerService_1['loggerService'][_0x40f77b(0x1bf)](_0x40f77b(0x179),_0x40f77b(0x1af)+_0x27221b,'Noda\x20API\x20error:\x20'+(_0x280b3f[_0x40f77b(0x1b2)]||_0x280b3f[_0x40f77b(0x1ca)]||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x280b3f['message']||_0x280b3f[_0x40f77b(0x1ca)]||_0x40f77b(0x1ec)));}let _0x153c7d=_0x40f77b(0x1b0);if(_0x280b3f[_0x40f77b(0x195)]===![]){if(_0x280b3f[_0x40f77b(0x1f8)]){const _0x344495=new Date(_0x280b3f['expiryDate']),_0x818938=new Date();_0x344495<_0x818938?_0x153c7d=_0x40f77b(0x1a9):_0x153c7d=_0x40f77b(0x192);}else _0x153c7d=_0x40f77b(0x192);}else _0x153c7d=_0x40f77b(0x1b0);return{'status':_0x153c7d,'amount':_0x280b3f[_0x40f77b(0x18b)],'currency':_0x280b3f[_0x40f77b(0x189)],'isActive':_0x280b3f[_0x40f77b(0x195)]};}catch(_0x4acce2){console[_0x40f77b(0x1ca)](_0x40f77b(0x1e9),_0x4acce2),loggerService_1[_0x40f77b(0x1d8)][_0x40f77b(0x1bf)](_0x40f77b(0x179),_0x40f77b(0x1af)+_0x27221b,_0x4acce2);throw new Error(_0x40f77b(0x1de)+(_0x4acce2 instanceof Error?_0x4acce2[_0x40f77b(0x1b2)]:_0x40f77b(0x1ec)));}}async[a71_0x37eabe(0x1b4)](_0x340807){const _0x139ee9=a71_0x37eabe;console[_0x139ee9(0x1c3)]('Processing\x20Noda\x20webhook:',_0x340807);let _0xdf6d7b=_0x139ee9(0x1b0);switch(_0x340807['Status']?.[_0x139ee9(0x1a8)]()){case _0x139ee9(0x18f):case _0x139ee9(0x1c1):case'paid':case _0x139ee9(0x1eb):case _0x139ee9(0x188):_0x340807[_0x139ee9(0x193)]==='Yes'?_0xdf6d7b=_0x139ee9(0x1c8):_0xdf6d7b=_0x139ee9(0x1b0);break;case _0x139ee9(0x186):case _0x139ee9(0x1d5):case _0x139ee9(0x19b):case _0x139ee9(0x1ca):case _0x139ee9(0x1ab):_0xdf6d7b=_0x139ee9(0x192);break;case _0x139ee9(0x197):case _0x139ee9(0x1b5):_0xdf6d7b='EXPIRED';break;case _0x139ee9(0x1a4):case _0x139ee9(0x19e):case _0x139ee9(0x1c0):case _0x139ee9(0x1e8):case _0x139ee9(0x1be):default:_0xdf6d7b=_0x139ee9(0x1b0);break;}return{'paymentId':_0x340807[_0x139ee9(0x1bc)]||_0x340807[_0x139ee9(0x1c4)],'status':_0xdf6d7b,'amount':_0x340807[_0x139ee9(0x1ac)],'currency':_0x340807[_0x139ee9(0x196)],'additionalInfo':{'method':_0x340807[_0x139ee9(0x1c6)],'bankId':_0x340807[_0x139ee9(0x182)],'settled':_0x340807['Settled'],'settlementDate':_0x340807[_0x139ee9(0x1cf)],'remitterName':_0x340807[_0x139ee9(0x1f4)]?.[_0x139ee9(0x1b7)],'remitterIban':_0x340807[_0x139ee9(0x1f4)]?.[_0x139ee9(0x17e)],'bankTransactionId':_0x340807['BankTransactionId']}};}[a71_0x37eabe(0x191)](_0x2c66b6,_0x1abdc9){const _0x574ff3=a71_0x37eabe;return console[_0x574ff3(0x1c3)](_0x574ff3(0x1ee),{'receivedSignature':_0x1abdc9,'paymentId':_0x2c66b6[_0x574ff3(0x1c4)],'merchantPaymentId':_0x2c66b6['MerchantPaymentId']}),!![];}}exports[a71_0x37eabe(0x1a6)]=NodaService;