'use strict';const a43_0x1123c4=a43_0x397a;function a43_0x397a(_0x88ce7e,_0x4f747f){const _0x286574=a43_0x2865();return a43_0x397a=function(_0x397a16,_0x371453){_0x397a16=_0x397a16-0x19d;let _0x347fdc=_0x286574[_0x397a16];return _0x347fdc;},a43_0x397a(_0x88ce7e,_0x4f747f);}(function(_0x535394,_0xd15a50){const _0x1d0191=a43_0x397a,_0x4150d0=_0x535394();while(!![]){try{const _0x4ff831=-parseInt(_0x1d0191(0x1c3))/0x1*(-parseInt(_0x1d0191(0x20c))/0x2)+parseInt(_0x1d0191(0x1ce))/0x3+parseInt(_0x1d0191(0x1c6))/0x4+-parseInt(_0x1d0191(0x213))/0x5*(parseInt(_0x1d0191(0x1c7))/0x6)+parseInt(_0x1d0191(0x200))/0x7+parseInt(_0x1d0191(0x207))/0x8*(-parseInt(_0x1d0191(0x1e2))/0x9)+-parseInt(_0x1d0191(0x1fb))/0xa;if(_0x4ff831===_0xd15a50)break;else _0x4150d0['push'](_0x4150d0['shift']());}catch(_0x310380){_0x4150d0['push'](_0x4150d0['shift']());}}}(a43_0x2865,0x1eea7));Object[a43_0x1123c4(0x1a6)](exports,a43_0x1123c4(0x1b1),{'value':!![]}),exports[a43_0x1123c4(0x1f4)]=void 0x0;const loggerService_1=require(a43_0x1123c4(0x1c5));class NodaService{constructor(){const _0x3609e8=a43_0x1123c4;this[_0x3609e8(0x212)]='https://tesoft.uk/gateway/noda/',console[_0x3609e8(0x1a7)](_0x3609e8(0x204));}async[a43_0x1123c4(0x1f2)](_0x47334c){const _0x1b3f54=a43_0x1123c4,{orderId:_0x3e9a94,name:_0x53a78b,paymentDescription:_0x2538f4,amount:_0x118af9,currency:_0x3d2173,webhookUrl:_0x4a02de,returnUrl:_0x2b3476,expiryDate:_0x482b66}=_0x47334c,_0x5d962e=_0x3d2173[_0x1b3f54(0x1da)](),_0x241ad2=_0x1b3f54(0x1c9),_0x51c131=_0x1b3f54(0x206)+_0x3e9a94,_0x1ee412={'name':_0x53a78b,'paymentDescription':_0x2538f4,'amount':_0x118af9,'currency':_0x5d962e,'paymentId':_0x3e9a94,'webhookUrl':_0x241ad2,'returnUrl':_0x51c131};_0x482b66&&(_0x1ee412[_0x1b3f54(0x1c1)]=_0x482b66);const _0x2e3c88=Date['now']();try{console[_0x1b3f54(0x1a7)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x1b3f54(0x1a7)](_0x1b3f54(0x1de),this[_0x1b3f54(0x212)]),console[_0x1b3f54(0x1a7)](_0x1b3f54(0x20f),JSON['stringify'](_0x1ee412,null,0x2)),console[_0x1b3f54(0x1a7)](_0x1b3f54(0x1d8),_0x3e9a94,_0x1b3f54(0x1aa)),console[_0x1b3f54(0x1a7)](_0x1b3f54(0x1e8),_0x51c131),loggerService_1[_0x1b3f54(0x1eb)][_0x1b3f54(0x1fe)]('noda','/payment-links','POST',_0x1ee412);const _0xf5b36f=await fetch(this[_0x1b3f54(0x212)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x1b3f54(0x1f3)},'body':JSON[_0x1b3f54(0x1db)](_0x1ee412)}),_0x3a9c93=Date['now']()-_0x2e3c88;console[_0x1b3f54(0x1a7)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x1b3f54(0x1a7)](_0x1b3f54(0x209),_0xf5b36f[_0x1b3f54(0x1a4)]),console[_0x1b3f54(0x1a7)]('Status\x20Text:',_0xf5b36f[_0x1b3f54(0x19f)]),console[_0x1b3f54(0x1a7)](_0x1b3f54(0x1bb),Object[_0x1b3f54(0x1f5)](_0xf5b36f[_0x1b3f54(0x1e9)][_0x1b3f54(0x1a3)]())),console[_0x1b3f54(0x1a7)](_0x1b3f54(0x1dd),_0x3a9c93+'ms');const _0x19848b=await _0xf5b36f[_0x1b3f54(0x1b0)]();console[_0x1b3f54(0x1a7)](_0x1b3f54(0x1cf),_0x19848b);if(!_0xf5b36f['ok']){console[_0x1b3f54(0x1c2)](_0x1b3f54(0x20d)),console['error'](_0x1b3f54(0x1bf),_0xf5b36f[_0x1b3f54(0x1a4)]),console[_0x1b3f54(0x1c2)](_0x1b3f54(0x1f9),_0x19848b),loggerService_1[_0x1b3f54(0x1eb)][_0x1b3f54(0x1bc)](_0x1b3f54(0x1d2),_0x1b3f54(0x1cd),_0xf5b36f[_0x1b3f54(0x1a4)],_0x19848b,_0x3a9c93),loggerService_1[_0x1b3f54(0x1eb)][_0x1b3f54(0x211)](_0x1b3f54(0x1d2),_0x1b3f54(0x1cd),_0x1b3f54(0x1fa)+_0xf5b36f[_0x1b3f54(0x1a4)]+':\x20'+_0x19848b);if(_0xf5b36f[_0x1b3f54(0x1a4)]===0x190)throw new Error(_0x1b3f54(0x1d0));else{if(_0xf5b36f['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error('HTTP\x20error!\x20status:\x20'+_0xf5b36f[_0x1b3f54(0x1a4)]+_0x1b3f54(0x1ad)+_0x19848b);}let _0x2e0f95;try{_0x2e0f95=JSON[_0x1b3f54(0x208)](_0x19848b);}catch(_0x37c829){console[_0x1b3f54(0x1c2)](_0x1b3f54(0x1ca),_0x37c829),loggerService_1[_0x1b3f54(0x1eb)][_0x1b3f54(0x211)]('noda',_0x1b3f54(0x1cd),_0x1b3f54(0x20a)+_0x37c829);throw new Error(_0x1b3f54(0x214)+_0x19848b);}console[_0x1b3f54(0x1a7)](_0x1b3f54(0x1ed)),console[_0x1b3f54(0x1a7)](_0x1b3f54(0x203),JSON['stringify'](_0x2e0f95,null,0x2)),loggerService_1[_0x1b3f54(0x1eb)]['logWhiteDomainResponse'](_0x1b3f54(0x1d2),_0x1b3f54(0x1cd),_0xf5b36f['status'],_0x2e0f95,_0x3a9c93);if(_0x2e0f95[_0x1b3f54(0x1c2)]||_0x2e0f95[_0x1b3f54(0x20e)]){const _0xc109a7=_0x2e0f95[_0x1b3f54(0x205)]||_0x2e0f95['error']||_0x1b3f54(0x1ab);console['error'](_0x1b3f54(0x1e5)),console[_0x1b3f54(0x1c2)](_0x1b3f54(0x1b8),_0xc109a7),console[_0x1b3f54(0x1c2)](_0x1b3f54(0x1b9),_0x2e0f95['statusCode']),loggerService_1[_0x1b3f54(0x1eb)][_0x1b3f54(0x211)](_0x1b3f54(0x1d2),_0x1b3f54(0x1cd),'Business\x20Error:\x20'+_0xc109a7);throw new Error(_0x1b3f54(0x1e6)+_0xc109a7);}if(!_0x2e0f95['id']||!_0x2e0f95[_0x1b3f54(0x1c0)]?.['shortLink']){console[_0x1b3f54(0x1c2)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x1b3f54(0x1e0)),console[_0x1b3f54(0x1c2)](_0x1b3f54(0x1f1),_0x2e0f95),loggerService_1[_0x1b3f54(0x1eb)][_0x1b3f54(0x211)](_0x1b3f54(0x1d2),'/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x1b3f54(0x19e));}return console[_0x1b3f54(0x1a7)](_0x1b3f54(0x1b7)),console[_0x1b3f54(0x1a7)](_0x1b3f54(0x1f8),_0x2e0f95['id']),console[_0x1b3f54(0x1a7)](_0x1b3f54(0x1cb),_0x2e0f95[_0x1b3f54(0x1c0)][_0x1b3f54(0x1e3)]),console[_0x1b3f54(0x1a7)]('QR\x20Code\x20Link:',_0x2e0f95['shortLinkUrls']['qrCodeLink']||'Not\x20provided'),console[_0x1b3f54(0x1a7)]('Order\x20ID\x20Used:',_0x3e9a94,_0x1b3f54(0x1f7)),console[_0x1b3f54(0x1a7)](_0x1b3f54(0x1ef),_0x51c131),{'gateway_payment_id':_0x2e0f95['id'],'payment_url':_0x2e0f95[_0x1b3f54(0x1c0)][_0x1b3f54(0x1e3)],'qr_code_url':_0x2e0f95[_0x1b3f54(0x1c0)]['qrCodeLink'],'expiry_date':_0x2e0f95[_0x1b3f54(0x1c1)]};}catch(_0x4ee425){console[_0x1b3f54(0x1c2)](_0x1b3f54(0x1e4)),console[_0x1b3f54(0x1c2)](_0x1b3f54(0x1d6),_0x4ee425),loggerService_1[_0x1b3f54(0x1eb)]['logWhiteDomainError'](_0x1b3f54(0x1d2),_0x1b3f54(0x1cd),_0x4ee425);if(_0x4ee425 instanceof Error){console[_0x1b3f54(0x1c2)](_0x1b3f54(0x1ea),_0x4ee425[_0x1b3f54(0x205)]),console[_0x1b3f54(0x1c2)](_0x1b3f54(0x1a0),_0x4ee425[_0x1b3f54(0x1a8)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x4ee425[_0x1b3f54(0x205)]);}throw new Error(_0x1b3f54(0x1a5));}}async[a43_0x1123c4(0x1ae)](_0x415c6e){const _0x26d485=a43_0x1123c4,_0x5732a0=Date[_0x26d485(0x1e1)]();try{loggerService_1[_0x26d485(0x1eb)][_0x26d485(0x1fe)](_0x26d485(0x1d2),_0x26d485(0x1f0)+_0x415c6e,_0x26d485(0x1b2),{});const _0x4176c1=await fetch(this[_0x26d485(0x212)]+'/'+_0x415c6e,{'method':_0x26d485(0x1b2),'headers':{'Content-Type':'application/json','User-Agent':_0x26d485(0x1f3)}}),_0x3c3289=Date[_0x26d485(0x1e1)]()-_0x5732a0;if(!_0x4176c1['ok']){const _0x248424=await _0x4176c1[_0x26d485(0x1b0)]();loggerService_1['loggerService'][_0x26d485(0x1bc)]('noda','/payment-links/'+_0x415c6e,_0x4176c1[_0x26d485(0x1a4)],_0x248424,_0x3c3289);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4176c1['status']);}const _0x336412=await _0x4176c1[_0x26d485(0x1bd)]();loggerService_1[_0x26d485(0x1eb)][_0x26d485(0x1bc)](_0x26d485(0x1d2),_0x26d485(0x1f0)+_0x415c6e,_0x4176c1['status'],_0x336412,_0x3c3289);if(_0x336412[_0x26d485(0x1c2)]||_0x336412[_0x26d485(0x20e)]){loggerService_1[_0x26d485(0x1eb)][_0x26d485(0x211)](_0x26d485(0x1d2),'/payment-links/'+_0x415c6e,_0x26d485(0x1e6)+(_0x336412['message']||_0x336412[_0x26d485(0x1c2)]||_0x26d485(0x1a1)));throw new Error(_0x26d485(0x1e6)+(_0x336412[_0x26d485(0x205)]||_0x336412[_0x26d485(0x1c2)]||_0x26d485(0x1a1)));}let _0x3ff5b8=_0x26d485(0x1ba);if(_0x336412['isActive']===![]){if(_0x336412[_0x26d485(0x1c1)]){const _0x3f434f=new Date(_0x336412[_0x26d485(0x1c1)]),_0xbfea9d=new Date();_0x3f434f<_0xbfea9d?_0x3ff5b8=_0x26d485(0x1fd):_0x3ff5b8=_0x26d485(0x1d7);}else _0x3ff5b8=_0x26d485(0x1d7);}else _0x3ff5b8=_0x26d485(0x1ba);return{'status':_0x3ff5b8,'amount':_0x336412[_0x26d485(0x1ff)],'currency':_0x336412[_0x26d485(0x1d1)],'isActive':_0x336412[_0x26d485(0x1b4)]};}catch(_0x32516d){console['error'](_0x26d485(0x1d4),_0x32516d),loggerService_1[_0x26d485(0x1eb)][_0x26d485(0x211)](_0x26d485(0x1d2),_0x26d485(0x1f0)+_0x415c6e,_0x32516d);throw new Error(_0x26d485(0x202)+(_0x32516d instanceof Error?_0x32516d[_0x26d485(0x205)]:'Unknown\x20error'));}}async[a43_0x1123c4(0x210)](_0x2f6e1e){const _0x47d597=a43_0x1123c4;console['log']('Processing\x20Noda\x20webhook:',_0x2f6e1e);let _0x497684='PENDING';switch(_0x2f6e1e['Status']?.[_0x47d597(0x1be)]()){case'done':case _0x47d597(0x1af):case _0x47d597(0x20b):case _0x47d597(0x19d):case _0x47d597(0x1a9):_0x2f6e1e[_0x47d597(0x1b5)]===_0x47d597(0x1d9)?_0x497684='PAID':_0x497684='PENDING';break;case'cancelled':case _0x47d597(0x1ac):case'failed':case _0x47d597(0x1c2):case _0x47d597(0x1df):_0x497684='FAILED';break;case'expired':case'timeout':_0x497684=_0x47d597(0x1fd);break;case'pending':case _0x47d597(0x1c8):case _0x47d597(0x1cc):case _0x47d597(0x1b3):case _0x47d597(0x1fc):default:_0x497684='PENDING';break;}return{'paymentId':_0x2f6e1e[_0x47d597(0x1b6)]||_0x2f6e1e[_0x47d597(0x1f6)],'status':_0x497684,'amount':_0x2f6e1e['Amount'],'currency':_0x2f6e1e[_0x47d597(0x201)],'additionalInfo':{'method':_0x2f6e1e[_0x47d597(0x1d5)],'bankId':_0x2f6e1e[_0x47d597(0x1dc)],'settled':_0x2f6e1e[_0x47d597(0x1b5)],'settlementDate':_0x2f6e1e[_0x47d597(0x1a2)],'remitterName':_0x2f6e1e['Remitter']?.[_0x47d597(0x1c4)],'remitterIban':_0x2f6e1e[_0x47d597(0x1d3)]?.['Iban'],'bankTransactionId':_0x2f6e1e[_0x47d597(0x1ee)]}};}[a43_0x1123c4(0x1ec)](_0x46730b,_0x4be4d6){const _0x44b2c0=a43_0x1123c4;return console[_0x44b2c0(0x1a7)](_0x44b2c0(0x1e7),{'receivedSignature':_0x4be4d6,'paymentId':_0x46730b[_0x44b2c0(0x1f6)],'merchantPaymentId':_0x46730b['MerchantPaymentId']}),!![];}}function a43_0x2865(){const _0x3f187f=['isActive','Settled','MerchantPaymentId','===\x20NODA\x20SUCCESS\x20===','Error\x20Message:','Status\x20Code:','PENDING','Headers:','logWhiteDomainResponse','json','toLowerCase','HTTP\x20Status:','shortLinkUrls','expiryDate','error','50761eAQnVj','Name','../loggerService','791632ycDgzE','78504XyKUzY','created','https://tesoft.uk/gateway/noda/webhook/','Failed\x20to\x20parse\x20JSON\x20response:','Short\x20Link:','active','/payment-links','258714gfUDld','Raw\x20Response\x20Body:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','currency','noda','Remitter','Noda\x20payment\x20verification\x20error:','Method','Error\x20details:','FAILED','Order\x20ID\x20Format:','Yes','toUpperCase','stringify','BankId','Response\x20Time:','URL:','rejected','Missing\x20id\x20or\x20shortLink\x20in\x20response','now','99xUVjYz','shortLink','===\x20NODA\x20SERVICE\x20ERROR\x20===','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Noda\x20API\x20error:\x20','Noda\x20webhook\x20signature\x20verification:','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','headers','Error\x20message:','loggerService','verifyWebhookSignature','===\x20PARSED\x20NODA\x20RESPONSE\x20===','BankTransactionId','✅\x20Return\x20URL\x20configured\x20for\x20pending:','/payment-links/','Response\x20data:','createPaymentLink','TesSoft\x20Payment\x20System/1.0','NodaService','fromEntries','PaymentId','(8digits-8digits\x20format)','Payment\x20Link\x20ID:','Response\x20Body:','HTTP\x20','1804820OCbNex','in_progress','EXPIRED','logWhiteDomainRequest','amount','995393aoiQUp','Currency','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Parsed\x20Result:','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','message','https://tesoft.uk/gateway/pending.php?id=','104600zjOWPh','parse','Status:','JSON\x20Parse\x20Error:\x20','paid','2BjfENp','===\x20NODA\x20API\x20ERROR\x20===','statusCode','Request\x20Body\x20(Direct\x20JSON):','processWebhook','logWhiteDomainError','apiUrl','10sUNAuc','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','success','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','statusText','Error\x20stack:','Unknown\x20error','SettlementDate','entries','status','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','defineProperty','log','stack','successful','(8digits-8digits\x20format\x20for\x20Noda)','Unknown\x20error\x20from\x20Noda\x20API','canceled',',\x20body:\x20','verifyPayment','completed','text','__esModule','GET','processing'];a43_0x2865=function(){return _0x3f187f;};return a43_0x2865();}exports[a43_0x1123c4(0x1f4)]=NodaService;