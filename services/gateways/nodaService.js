'use strict';function a40_0x42ca(_0x839e77,_0x343ab0){const _0x1c4088=a40_0x1c40();return a40_0x42ca=function(_0x42caad,_0xe226c6){_0x42caad=_0x42caad-0x148;let _0x8d0ef5=_0x1c4088[_0x42caad];return _0x8d0ef5;},a40_0x42ca(_0x839e77,_0x343ab0);}const a40_0x2df3b9=a40_0x42ca;(function(_0x5540f2,_0x7f5050){const _0x247259=a40_0x42ca,_0x130474=_0x5540f2();while(!![]){try{const _0x356f78=parseInt(_0x247259(0x1a0))/0x1*(parseInt(_0x247259(0x1a4))/0x2)+-parseInt(_0x247259(0x164))/0x3*(parseInt(_0x247259(0x18c))/0x4)+parseInt(_0x247259(0x152))/0x5*(-parseInt(_0x247259(0x1a7))/0x6)+parseInt(_0x247259(0x15d))/0x7*(parseInt(_0x247259(0x161))/0x8)+parseInt(_0x247259(0x170))/0x9+-parseInt(_0x247259(0x1b6))/0xa*(parseInt(_0x247259(0x16c))/0xb)+parseInt(_0x247259(0x17b))/0xc*(parseInt(_0x247259(0x1af))/0xd);if(_0x356f78===_0x7f5050)break;else _0x130474['push'](_0x130474['shift']());}catch(_0x57380d){_0x130474['push'](_0x130474['shift']());}}}(a40_0x1c40,0x194ca));Object['defineProperty'](exports,a40_0x2df3b9(0x154),{'value':!![]}),exports[a40_0x2df3b9(0x14f)]=void 0x0;const loggerService_1=require(a40_0x2df3b9(0x165));class NodaService{constructor(){const _0x3875c6=a40_0x2df3b9;this[_0x3875c6(0x194)]=_0x3875c6(0x169),console[_0x3875c6(0x158)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a40_0x2df3b9(0x183)](_0x1a3629){const _0x6fe7fe=a40_0x2df3b9,{orderId:_0x8cbfdf,name:_0xa5d7b9,paymentDescription:_0x4b187a,amount:_0x38f95c,currency:_0x28835b,webhookUrl:_0x116b41,returnUrl:_0x3095ae,expiryDate:_0x11366d}=_0x1a3629,_0xc0a9d4=_0x28835b[_0x6fe7fe(0x18b)](),_0x10ab24=_0x6fe7fe(0x1b2),_0x49eca2=_0x6fe7fe(0x196)+_0x8cbfdf,_0x8ad556={'name':_0xa5d7b9,'paymentDescription':_0x4b187a,'amount':_0x38f95c,'currency':_0xc0a9d4,'paymentId':_0x8cbfdf,'webhookUrl':_0x10ab24,'returnUrl':_0x49eca2};_0x11366d&&(_0x8ad556[_0x6fe7fe(0x18a)]=_0x11366d);const _0x4bb64b=Date[_0x6fe7fe(0x156)]();try{console['log'](_0x6fe7fe(0x17f)),console[_0x6fe7fe(0x158)](_0x6fe7fe(0x19f),this['apiUrl']),console[_0x6fe7fe(0x158)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x6fe7fe(0x191)](_0x8ad556,null,0x2)),console[_0x6fe7fe(0x158)](_0x6fe7fe(0x15f),_0x8cbfdf,_0x6fe7fe(0x19d)),loggerService_1['loggerService'][_0x6fe7fe(0x15a)](_0x6fe7fe(0x18d),_0x6fe7fe(0x172),'POST',_0x8ad556);const _0x1b5e5b=await fetch(this[_0x6fe7fe(0x194)],{'method':_0x6fe7fe(0x1ad),'headers':{'Content-Type':_0x6fe7fe(0x19c),'Accept':'application/json','User-Agent':_0x6fe7fe(0x153)},'body':JSON[_0x6fe7fe(0x191)](_0x8ad556)}),_0x37e5f5=Date['now']()-_0x4bb64b;console['log'](_0x6fe7fe(0x187)),console[_0x6fe7fe(0x158)](_0x6fe7fe(0x19e),_0x1b5e5b[_0x6fe7fe(0x1b8)]),console[_0x6fe7fe(0x158)]('Status\x20Text:',_0x1b5e5b['statusText']),console[_0x6fe7fe(0x158)](_0x6fe7fe(0x1bc),Object[_0x6fe7fe(0x1a9)](_0x1b5e5b[_0x6fe7fe(0x1ab)]['entries']())),console[_0x6fe7fe(0x158)](_0x6fe7fe(0x1b4),_0x37e5f5+'ms');const _0x3ba94d=await _0x1b5e5b['text']();console[_0x6fe7fe(0x158)](_0x6fe7fe(0x1bb),_0x3ba94d);if(!_0x1b5e5b['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x6fe7fe(0x1a5)](_0x6fe7fe(0x1ba),_0x1b5e5b[_0x6fe7fe(0x1b8)]),console[_0x6fe7fe(0x1a5)]('Response\x20Body:',_0x3ba94d),loggerService_1[_0x6fe7fe(0x198)][_0x6fe7fe(0x155)](_0x6fe7fe(0x18d),_0x6fe7fe(0x172),_0x1b5e5b[_0x6fe7fe(0x1b8)],_0x3ba94d,_0x37e5f5),loggerService_1['loggerService'][_0x6fe7fe(0x16f)](_0x6fe7fe(0x18d),'/payment-links','HTTP\x20'+_0x1b5e5b[_0x6fe7fe(0x1b8)]+':\x20'+_0x3ba94d);if(_0x1b5e5b[_0x6fe7fe(0x1b8)]===0x190)throw new Error(_0x6fe7fe(0x180));else{if(_0x1b5e5b[_0x6fe7fe(0x1b8)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x6fe7fe(0x1bf)+_0x1b5e5b['status']+_0x6fe7fe(0x192)+_0x3ba94d);}let _0x2cefb1;try{_0x2cefb1=JSON[_0x6fe7fe(0x185)](_0x3ba94d);}catch(_0x439b67){console['error'](_0x6fe7fe(0x15c),_0x439b67),loggerService_1[_0x6fe7fe(0x198)][_0x6fe7fe(0x16f)](_0x6fe7fe(0x18d),_0x6fe7fe(0x172),_0x6fe7fe(0x175)+_0x439b67);throw new Error(_0x6fe7fe(0x167)+_0x3ba94d);}console[_0x6fe7fe(0x158)](_0x6fe7fe(0x149)),console[_0x6fe7fe(0x158)](_0x6fe7fe(0x173),JSON[_0x6fe7fe(0x191)](_0x2cefb1,null,0x2)),loggerService_1[_0x6fe7fe(0x198)][_0x6fe7fe(0x155)](_0x6fe7fe(0x18d),_0x6fe7fe(0x172),_0x1b5e5b[_0x6fe7fe(0x1b8)],_0x2cefb1,_0x37e5f5);if(_0x2cefb1[_0x6fe7fe(0x1a5)]||_0x2cefb1[_0x6fe7fe(0x16b)]){const _0xde09e4=_0x2cefb1[_0x6fe7fe(0x15b)]||_0x2cefb1[_0x6fe7fe(0x1a5)]||_0x6fe7fe(0x150);console[_0x6fe7fe(0x1a5)](_0x6fe7fe(0x1aa)),console['error'](_0x6fe7fe(0x160),_0xde09e4),console[_0x6fe7fe(0x1a5)](_0x6fe7fe(0x182),_0x2cefb1[_0x6fe7fe(0x16b)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x6fe7fe(0x18d),_0x6fe7fe(0x172),'Business\x20Error:\x20'+_0xde09e4);throw new Error(_0x6fe7fe(0x1a2)+_0xde09e4);}if(!_0x2cefb1['id']||!_0x2cefb1[_0x6fe7fe(0x162)]?.['shortLink']){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x6fe7fe(0x1a5)](_0x6fe7fe(0x1b3)),console['error'](_0x6fe7fe(0x184),_0x2cefb1),loggerService_1[_0x6fe7fe(0x198)][_0x6fe7fe(0x16f)](_0x6fe7fe(0x18d),_0x6fe7fe(0x172),_0x6fe7fe(0x195));throw new Error(_0x6fe7fe(0x16e));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console[_0x6fe7fe(0x158)]('Payment\x20Link\x20ID:',_0x2cefb1['id']),console[_0x6fe7fe(0x158)](_0x6fe7fe(0x1a8),_0x2cefb1[_0x6fe7fe(0x162)][_0x6fe7fe(0x1c0)]),console[_0x6fe7fe(0x158)](_0x6fe7fe(0x18e),_0x2cefb1[_0x6fe7fe(0x162)][_0x6fe7fe(0x148)]||'Not\x20provided'),console[_0x6fe7fe(0x158)](_0x6fe7fe(0x1b9),_0x8cbfdf,'(8digits-8digits\x20format)'),{'gateway_payment_id':_0x2cefb1['id'],'payment_url':_0x2cefb1[_0x6fe7fe(0x162)][_0x6fe7fe(0x1c0)],'qr_code_url':_0x2cefb1[_0x6fe7fe(0x162)][_0x6fe7fe(0x148)],'expiry_date':_0x2cefb1[_0x6fe7fe(0x18a)]};}catch(_0x43c786){console[_0x6fe7fe(0x1a5)](_0x6fe7fe(0x17c)),console[_0x6fe7fe(0x1a5)](_0x6fe7fe(0x186),_0x43c786),loggerService_1[_0x6fe7fe(0x198)][_0x6fe7fe(0x16f)](_0x6fe7fe(0x18d),_0x6fe7fe(0x172),_0x43c786);if(_0x43c786 instanceof Error){console[_0x6fe7fe(0x1a5)](_0x6fe7fe(0x14b),_0x43c786[_0x6fe7fe(0x15b)]),console[_0x6fe7fe(0x1a5)](_0x6fe7fe(0x1be),_0x43c786[_0x6fe7fe(0x1bd)]);throw new Error(_0x6fe7fe(0x14c)+_0x43c786[_0x6fe7fe(0x15b)]);}throw new Error(_0x6fe7fe(0x157));}}async[a40_0x2df3b9(0x19a)](_0x2c37e2){const _0x5d40a8=a40_0x2df3b9,_0xb7cff0=Date['now']();try{loggerService_1[_0x5d40a8(0x198)][_0x5d40a8(0x15a)](_0x5d40a8(0x18d),_0x5d40a8(0x14e)+_0x2c37e2,_0x5d40a8(0x14d),{});const _0x5e8a25=await fetch(this[_0x5d40a8(0x194)]+'/'+_0x2c37e2,{'method':_0x5d40a8(0x14d),'headers':{'Content-Type':_0x5d40a8(0x19c),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x3c8b8f=Date['now']()-_0xb7cff0;if(!_0x5e8a25['ok']){const _0x2b7daa=await _0x5e8a25['text']();loggerService_1[_0x5d40a8(0x198)][_0x5d40a8(0x155)](_0x5d40a8(0x18d),'/payment-links/'+_0x2c37e2,_0x5e8a25[_0x5d40a8(0x1b8)],_0x2b7daa,_0x3c8b8f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5e8a25[_0x5d40a8(0x1b8)]);}const _0x586f76=await _0x5e8a25[_0x5d40a8(0x18f)]();loggerService_1[_0x5d40a8(0x198)][_0x5d40a8(0x155)]('noda',_0x5d40a8(0x14e)+_0x2c37e2,_0x5e8a25[_0x5d40a8(0x1b8)],_0x586f76,_0x3c8b8f);if(_0x586f76['error']||_0x586f76[_0x5d40a8(0x16b)]){loggerService_1[_0x5d40a8(0x198)][_0x5d40a8(0x16f)](_0x5d40a8(0x18d),_0x5d40a8(0x14e)+_0x2c37e2,_0x5d40a8(0x1a2)+(_0x586f76[_0x5d40a8(0x15b)]||_0x586f76['error']||_0x5d40a8(0x179)));throw new Error('Noda\x20API\x20error:\x20'+(_0x586f76[_0x5d40a8(0x15b)]||_0x586f76[_0x5d40a8(0x1a5)]||_0x5d40a8(0x179)));}let _0x575e6e='PENDING';if(_0x586f76[_0x5d40a8(0x1b0)]===![]){if(_0x586f76[_0x5d40a8(0x18a)]){const _0x39f602=new Date(_0x586f76[_0x5d40a8(0x18a)]),_0x246a27=new Date();_0x39f602<_0x246a27?_0x575e6e=_0x5d40a8(0x177):_0x575e6e=_0x5d40a8(0x15e);}else _0x575e6e='FAILED';}else _0x575e6e=_0x5d40a8(0x168);return{'status':_0x575e6e,'amount':_0x586f76[_0x5d40a8(0x151)],'currency':_0x586f76[_0x5d40a8(0x171)],'isActive':_0x586f76[_0x5d40a8(0x1b0)]};}catch(_0x48eede){console[_0x5d40a8(0x1a5)](_0x5d40a8(0x17e),_0x48eede),loggerService_1[_0x5d40a8(0x198)][_0x5d40a8(0x16f)](_0x5d40a8(0x18d),_0x5d40a8(0x14e)+_0x2c37e2,_0x48eede);throw new Error(_0x5d40a8(0x174)+(_0x48eede instanceof Error?_0x48eede[_0x5d40a8(0x15b)]:_0x5d40a8(0x179)));}}async[a40_0x2df3b9(0x188)](_0x2dff0){const _0x4eb50b=a40_0x2df3b9;console['log']('Processing\x20Noda\x20webhook:',_0x2dff0);let _0x1ac94d='PENDING';switch(_0x2dff0[_0x4eb50b(0x1ac)]?.[_0x4eb50b(0x178)]()){case'done':case _0x4eb50b(0x159):case'paid':case _0x4eb50b(0x1b1):case'successful':_0x2dff0[_0x4eb50b(0x1a1)]==='Yes'?_0x1ac94d=_0x4eb50b(0x17a):_0x1ac94d=_0x4eb50b(0x168);break;case _0x4eb50b(0x176):case _0x4eb50b(0x189):case _0x4eb50b(0x193):case _0x4eb50b(0x1a5):case _0x4eb50b(0x181):_0x1ac94d=_0x4eb50b(0x15e);break;case'expired':case _0x4eb50b(0x199):_0x1ac94d=_0x4eb50b(0x177);break;case _0x4eb50b(0x197):case _0x4eb50b(0x190):case _0x4eb50b(0x163):case'processing':case'in_progress':default:_0x1ac94d=_0x4eb50b(0x168);break;}return{'paymentId':_0x2dff0['MerchantPaymentId']||_0x2dff0[_0x4eb50b(0x1b7)],'status':_0x1ac94d,'amount':_0x2dff0[_0x4eb50b(0x1b5)],'currency':_0x2dff0[_0x4eb50b(0x16d)],'additionalInfo':{'method':_0x2dff0[_0x4eb50b(0x19b)],'bankId':_0x2dff0['BankId'],'settled':_0x2dff0['Settled'],'settlementDate':_0x2dff0[_0x4eb50b(0x1a6)],'remitterName':_0x2dff0[_0x4eb50b(0x1ae)]?.[_0x4eb50b(0x166)],'remitterIban':_0x2dff0[_0x4eb50b(0x1ae)]?.[_0x4eb50b(0x1a3)],'bankTransactionId':_0x2dff0[_0x4eb50b(0x14a)]}};}[a40_0x2df3b9(0x17d)](_0x54768b,_0x5ed69e){const _0x4563a0=a40_0x2df3b9;return console[_0x4563a0(0x158)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x5ed69e,'paymentId':_0x54768b[_0x4563a0(0x1b7)],'merchantPaymentId':_0x54768b[_0x4563a0(0x16a)]}),!![];}}exports[a40_0x2df3b9(0x14f)]=NodaService;function a40_0x1c40(){const _0x40ee06=['85bynxvl','TesSoft\x20Payment\x20System/1.0','__esModule','logWhiteDomainResponse','now','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','log','completed','logWhiteDomainRequest','message','Failed\x20to\x20parse\x20JSON\x20response:','1085763xAyGTE','FAILED','Order\x20ID\x20Format:','Error\x20Message:','8cJEKgE','shortLinkUrls','active','6Shnxoe','../loggerService','Name','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','PENDING','https://tesoft.uk/gateway/noda/','MerchantPaymentId','statusCode','2137168zDuGqH','Currency','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','logWhiteDomainError','1079856oYMCml','currency','/payment-links','Parsed\x20Result:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','JSON\x20Parse\x20Error:\x20','cancelled','EXPIRED','toLowerCase','Unknown\x20error','PAID','32388yUyrdq','===\x20NODA\x20SERVICE\x20ERROR\x20===','verifyWebhookSignature','Noda\x20payment\x20verification\x20error:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','rejected','Status\x20Code:','createPaymentLink','Response\x20data:','parse','Error\x20details:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','processWebhook','canceled','expiryDate','toUpperCase','163132NkxUPL','noda','QR\x20Code\x20Link:','json','created','stringify',',\x20body:\x20','failed','apiUrl','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','https://tesoft.uk/gateway/success.php?id=','pending','loggerService','timeout','verifyPayment','Method','application/json','(8digits-8digits\x20format\x20for\x20Noda)','Status:','URL:','95411WWbYAR','Settled','Noda\x20API\x20error:\x20','Iban','2tdVhIZ','error','SettlementDate','61608ZnGELd','Short\x20Link:','fromEntries','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','headers','Status','POST','Remitter','884kMVsNY','isActive','success','https://tesoft.uk/gateway/noda/webhook/','Missing\x20id\x20or\x20shortLink\x20in\x20response','Response\x20Time:','Amount','10ZBjQtx','PaymentId','status','Order\x20ID\x20Used:','HTTP\x20Status:','Raw\x20Response\x20Body:','Headers:','stack','Error\x20stack:','HTTP\x20error!\x20status:\x20','shortLink','qrCodeLink','===\x20PARSED\x20NODA\x20RESPONSE\x20===','BankTransactionId','Error\x20message:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','GET','/payment-links/','NodaService','Unknown\x20error\x20from\x20Noda\x20API','amount'];a40_0x1c40=function(){return _0x40ee06;};return a40_0x1c40();}