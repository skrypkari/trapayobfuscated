'use strict';const a65_0x55d496=a65_0xf1a9;(function(_0x25f6e4,_0x1aabd7){const _0x51b9b8=a65_0xf1a9,_0x5081bb=_0x25f6e4();while(!![]){try{const _0x562405=parseInt(_0x51b9b8(0x1cb))/0x1+-parseInt(_0x51b9b8(0x191))/0x2*(-parseInt(_0x51b9b8(0x1f4))/0x3)+parseInt(_0x51b9b8(0x1b5))/0x4+parseInt(_0x51b9b8(0x1e2))/0x5+parseInt(_0x51b9b8(0x1bb))/0x6*(-parseInt(_0x51b9b8(0x19d))/0x7)+parseInt(_0x51b9b8(0x1de))/0x8+-parseInt(_0x51b9b8(0x1be))/0x9*(parseInt(_0x51b9b8(0x1fb))/0xa);if(_0x562405===_0x1aabd7)break;else _0x5081bb['push'](_0x5081bb['shift']());}catch(_0x26c2ac){_0x5081bb['push'](_0x5081bb['shift']());}}}(a65_0x5047,0x2b947));function a65_0x5047(){const _0x44d075=['‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','shortLink','Error\x20Message:','logWhiteDomainError','NodaService','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','shortLinkUrls','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Raw\x20Response\x20Body:','JSON\x20Parse\x20Error:\x20','Short\x20Link:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status','Amount','qrCodeLink','Status\x20Code:','===\x20NODA\x20SUCCESS\x20===','Name','completed','783824YkcJnX','message','entries','Missing\x20id\x20or\x20shortLink\x20in\x20response','HTTP\x20','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','534xaleCv','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','logWhiteDomainRequest','1594143rUsbAK','Response\x20Body:','Iban','apiUrl','statusCode','Business\x20Error:\x20','Request\x20Body\x20(Direct\x20JSON):','Status\x20Text:','QR\x20Code\x20Link:','now','currency','Error\x20message:','__esModule','224306gNGLzl','statusText','https://tesoft.uk/gateway/pending.php?id=','FAILED','URL:','https://tesoft.uk/gateway/noda/','isActive','rejected','Currency','logWhiteDomainResponse','expired','successful','PaymentId','Order\x20ID\x20Format:','Remitter','done','/payment-links','verifyPayment','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','1611128jlTbWR','Error\x20details:','stringify','expiryDate','223985RicRJz','createPaymentLink','fromEntries','status','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Settled','POST','processWebhook','Failed\x20to\x20verify\x20Noda\x20payment:\x20','active','success','Method','PAID','log','json','processing','Unknown\x20error','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','66396MZEJfO','HTTP\x20Status:','timeout','GET','Yes','paid','(8digits-8digits\x20format)','30qKFzzr','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','toUpperCase','Noda\x20payment\x20verification\x20error:','Payment\x20Link\x20ID:','/payment-links/','EXPIRED','cancelled','noda','application/json','../loggerService',',\x20body:\x20','defineProperty','SettlementDate','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Unknown\x20error\x20from\x20Noda\x20API','text','MerchantPaymentId','loggerService','Failed\x20to\x20parse\x20JSON\x20response:','6HhaPtd','Order\x20ID\x20Used:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','PENDING','parse','failed','HTTP\x20error!\x20status:\x20','error','https://tesoft.uk/gateway/noda/webhook/','Payment\x20System/1.0','BankTransactionId','Headers:','1806efnmlR','pending','canceled','stack','Noda\x20API\x20error:\x20'];a65_0x5047=function(){return _0x44d075;};return a65_0x5047();}Object[a65_0x55d496(0x207)](exports,a65_0x55d496(0x1ca),{'value':!![]}),exports[a65_0x55d496(0x1a6)]=void 0x0;const loggerService_1=require(a65_0x55d496(0x205));class NodaService{constructor(){const _0x3974b3=a65_0x55d496;this[_0x3974b3(0x1c1)]=_0x3974b3(0x1d0),console[_0x3974b3(0x1ef)](_0x3974b3(0x1a7));}async[a65_0x55d496(0x1e3)](_0x30b85f){const _0x1fad8f=a65_0x55d496,{orderId:_0x4ac157,name:_0x578d04,paymentDescription:_0x20f680,amount:_0x291612,currency:_0x3a7b7c,webhookUrl:_0x315754,returnUrl:_0x32fc92,expiryDate:_0x5f4086}=_0x30b85f,_0x9263f2=_0x3a7b7c[_0x1fad8f(0x1fd)](),_0x452a1a=_0x1fad8f(0x199),_0x38a023=_0x1fad8f(0x1cd)+_0x4ac157,_0x59889a={'name':_0x578d04,'paymentDescription':_0x20f680,'amount':_0x291612,'currency':_0x9263f2,'paymentId':_0x4ac157,'webhookUrl':_0x452a1a,'returnUrl':_0x38a023};_0x5f4086&&(_0x59889a[_0x1fad8f(0x1e1)]=_0x5f4086);const _0x3bba23=Date['now']();try{console['log'](_0x1fad8f(0x1f3)),console[_0x1fad8f(0x1ef)](_0x1fad8f(0x1cf),this[_0x1fad8f(0x1c1)]),console['log'](_0x1fad8f(0x1c4),JSON[_0x1fad8f(0x1e0)](_0x59889a,null,0x2)),console[_0x1fad8f(0x1ef)](_0x1fad8f(0x1d8),_0x4ac157,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x1fad8f(0x1ef)](_0x1fad8f(0x1a2),_0x38a023),loggerService_1[_0x1fad8f(0x18f)][_0x1fad8f(0x1bd)]('noda',_0x1fad8f(0x1db),_0x1fad8f(0x1e8),_0x59889a);const _0x1dd8a9=await fetch(this[_0x1fad8f(0x1c1)],{'method':_0x1fad8f(0x1e8),'headers':{'Content-Type':_0x1fad8f(0x204),'Accept':_0x1fad8f(0x204),'User-Agent':_0x1fad8f(0x19a)},'body':JSON[_0x1fad8f(0x1e0)](_0x59889a)}),_0x24b10b=Date[_0x1fad8f(0x1c7)]()-_0x3bba23;console['log'](_0x1fad8f(0x1ad)),console[_0x1fad8f(0x1ef)]('Status:',_0x1dd8a9[_0x1fad8f(0x1e5)]),console[_0x1fad8f(0x1ef)](_0x1fad8f(0x1c5),_0x1dd8a9[_0x1fad8f(0x1cc)]),console[_0x1fad8f(0x1ef)](_0x1fad8f(0x19c),Object[_0x1fad8f(0x1e4)](_0x1dd8a9['headers'][_0x1fad8f(0x1b7)]())),console[_0x1fad8f(0x1ef)]('Response\x20Time:',_0x24b10b+'ms');const _0x24997f=await _0x1dd8a9[_0x1fad8f(0x20b)]();console[_0x1fad8f(0x1ef)](_0x1fad8f(0x1aa),_0x24997f);if(!_0x1dd8a9['ok']){console[_0x1fad8f(0x198)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x1fad8f(0x198)](_0x1fad8f(0x1f5),_0x1dd8a9[_0x1fad8f(0x1e5)]),console[_0x1fad8f(0x198)](_0x1fad8f(0x1bf),_0x24997f),loggerService_1[_0x1fad8f(0x18f)][_0x1fad8f(0x1d4)](_0x1fad8f(0x203),_0x1fad8f(0x1db),_0x1dd8a9[_0x1fad8f(0x1e5)],_0x24997f,_0x24b10b),loggerService_1[_0x1fad8f(0x18f)]['logWhiteDomainError'](_0x1fad8f(0x203),'/payment-links',_0x1fad8f(0x1b9)+_0x1dd8a9[_0x1fad8f(0x1e5)]+':\x20'+_0x24997f);if(_0x1dd8a9[_0x1fad8f(0x1e5)]===0x190)throw new Error(_0x1fad8f(0x1e6));else{if(_0x1dd8a9[_0x1fad8f(0x1e5)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x1fad8f(0x197)+_0x1dd8a9[_0x1fad8f(0x1e5)]+_0x1fad8f(0x206)+_0x24997f);}let _0x1283cc;try{_0x1283cc=JSON[_0x1fad8f(0x195)](_0x24997f);}catch(_0x13e156){console[_0x1fad8f(0x198)](_0x1fad8f(0x190),_0x13e156),loggerService_1[_0x1fad8f(0x18f)][_0x1fad8f(0x1a5)](_0x1fad8f(0x203),_0x1fad8f(0x1db),_0x1fad8f(0x1ab)+_0x13e156);throw new Error(_0x1fad8f(0x1ba)+_0x24997f);}console[_0x1fad8f(0x1ef)](_0x1fad8f(0x193)),console[_0x1fad8f(0x1ef)]('Parsed\x20Result:',JSON[_0x1fad8f(0x1e0)](_0x1283cc,null,0x2)),loggerService_1[_0x1fad8f(0x18f)][_0x1fad8f(0x1d4)]('noda','/payment-links',_0x1dd8a9[_0x1fad8f(0x1e5)],_0x1283cc,_0x24b10b);if(_0x1283cc['error']||_0x1283cc['statusCode']){const _0xa8b0fd=_0x1283cc[_0x1fad8f(0x1b6)]||_0x1283cc[_0x1fad8f(0x198)]||_0x1fad8f(0x20a);console[_0x1fad8f(0x198)](_0x1fad8f(0x1fc)),console[_0x1fad8f(0x198)](_0x1fad8f(0x1a4),_0xa8b0fd),console[_0x1fad8f(0x198)](_0x1fad8f(0x1b1),_0x1283cc[_0x1fad8f(0x1c2)]),loggerService_1[_0x1fad8f(0x18f)]['logWhiteDomainError'](_0x1fad8f(0x203),_0x1fad8f(0x1db),_0x1fad8f(0x1c3)+_0xa8b0fd);throw new Error(_0x1fad8f(0x1a1)+_0xa8b0fd);}if(!_0x1283cc['id']||!_0x1283cc[_0x1fad8f(0x1a8)]?.[_0x1fad8f(0x1a3)]){console[_0x1fad8f(0x198)](_0x1fad8f(0x1dd)),console[_0x1fad8f(0x198)](_0x1fad8f(0x1b8)),console[_0x1fad8f(0x198)]('Response\x20data:',_0x1283cc),loggerService_1[_0x1fad8f(0x18f)][_0x1fad8f(0x1a5)](_0x1fad8f(0x203),'/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x1fad8f(0x1bc));}return console[_0x1fad8f(0x1ef)](_0x1fad8f(0x1b2)),console[_0x1fad8f(0x1ef)](_0x1fad8f(0x1ff),_0x1283cc['id']),console[_0x1fad8f(0x1ef)](_0x1fad8f(0x1ac),_0x1283cc[_0x1fad8f(0x1a8)][_0x1fad8f(0x1a3)]),console[_0x1fad8f(0x1ef)](_0x1fad8f(0x1c6),_0x1283cc[_0x1fad8f(0x1a8)][_0x1fad8f(0x1b0)]||'Not\x20provided'),console[_0x1fad8f(0x1ef)](_0x1fad8f(0x192),_0x4ac157,_0x1fad8f(0x1fa)),console['log'](_0x1fad8f(0x209),_0x38a023),{'gateway_payment_id':_0x1283cc['id'],'payment_url':_0x1283cc[_0x1fad8f(0x1a8)][_0x1fad8f(0x1a3)],'qr_code_url':_0x1283cc[_0x1fad8f(0x1a8)][_0x1fad8f(0x1b0)],'expiry_date':_0x1283cc[_0x1fad8f(0x1e1)]};}catch(_0x1dc872){console[_0x1fad8f(0x198)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x1fad8f(0x198)](_0x1fad8f(0x1df),_0x1dc872),loggerService_1[_0x1fad8f(0x18f)][_0x1fad8f(0x1a5)](_0x1fad8f(0x203),_0x1fad8f(0x1db),_0x1dc872);if(_0x1dc872 instanceof Error){console['error'](_0x1fad8f(0x1c9),_0x1dc872[_0x1fad8f(0x1b6)]),console['error']('Error\x20stack:',_0x1dc872[_0x1fad8f(0x1a0)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x1dc872[_0x1fad8f(0x1b6)]);}throw new Error(_0x1fad8f(0x1a9));}}async[a65_0x55d496(0x1dc)](_0x1312d5){const _0x1f410a=a65_0x55d496,_0x418fcc=Date[_0x1f410a(0x1c7)]();try{loggerService_1[_0x1f410a(0x18f)][_0x1f410a(0x1bd)]('noda','/payment-links/'+_0x1312d5,_0x1f410a(0x1f7),{});const _0x4a1982=await fetch(this['apiUrl']+'/'+_0x1312d5,{'method':_0x1f410a(0x1f7),'headers':{'Content-Type':'application/json','User-Agent':_0x1f410a(0x19a)}}),_0x7df5e7=Date[_0x1f410a(0x1c7)]()-_0x418fcc;if(!_0x4a1982['ok']){const _0x30625a=await _0x4a1982[_0x1f410a(0x20b)]();loggerService_1[_0x1f410a(0x18f)]['logWhiteDomainResponse'](_0x1f410a(0x203),_0x1f410a(0x200)+_0x1312d5,_0x4a1982[_0x1f410a(0x1e5)],_0x30625a,_0x7df5e7);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4a1982['status']);}const _0xd5481f=await _0x4a1982[_0x1f410a(0x1f0)]();loggerService_1[_0x1f410a(0x18f)]['logWhiteDomainResponse'](_0x1f410a(0x203),_0x1f410a(0x200)+_0x1312d5,_0x4a1982[_0x1f410a(0x1e5)],_0xd5481f,_0x7df5e7);if(_0xd5481f[_0x1f410a(0x198)]||_0xd5481f[_0x1f410a(0x1c2)]){loggerService_1[_0x1f410a(0x18f)][_0x1f410a(0x1a5)](_0x1f410a(0x203),_0x1f410a(0x200)+_0x1312d5,_0x1f410a(0x1a1)+(_0xd5481f[_0x1f410a(0x1b6)]||_0xd5481f[_0x1f410a(0x198)]||_0x1f410a(0x1f2)));throw new Error(_0x1f410a(0x1a1)+(_0xd5481f[_0x1f410a(0x1b6)]||_0xd5481f[_0x1f410a(0x198)]||_0x1f410a(0x1f2)));}let _0x2ff07a=_0x1f410a(0x194);if(_0xd5481f['isActive']===![]){if(_0xd5481f[_0x1f410a(0x1e1)]){const _0x1949a9=new Date(_0xd5481f[_0x1f410a(0x1e1)]),_0x57cdf=new Date();_0x1949a9<_0x57cdf?_0x2ff07a=_0x1f410a(0x201):_0x2ff07a='FAILED';}else _0x2ff07a=_0x1f410a(0x1ce);}else _0x2ff07a=_0x1f410a(0x194);return{'status':_0x2ff07a,'amount':_0xd5481f['amount'],'currency':_0xd5481f[_0x1f410a(0x1c8)],'isActive':_0xd5481f[_0x1f410a(0x1d1)]};}catch(_0x13f86a){console[_0x1f410a(0x198)](_0x1f410a(0x1fe),_0x13f86a),loggerService_1[_0x1f410a(0x18f)][_0x1f410a(0x1a5)](_0x1f410a(0x203),_0x1f410a(0x200)+_0x1312d5,_0x13f86a);throw new Error(_0x1f410a(0x1ea)+(_0x13f86a instanceof Error?_0x13f86a[_0x1f410a(0x1b6)]:_0x1f410a(0x1f2)));}}async[a65_0x55d496(0x1e9)](_0x7b7208){const _0x2f5973=a65_0x55d496;console[_0x2f5973(0x1ef)]('Processing\x20Noda\x20webhook:',_0x7b7208);let _0x7bc69d=_0x2f5973(0x194);switch(_0x7b7208[_0x2f5973(0x1ae)]?.['toLowerCase']()){case _0x2f5973(0x1da):case _0x2f5973(0x1b4):case _0x2f5973(0x1f9):case _0x2f5973(0x1ec):case _0x2f5973(0x1d6):_0x7b7208[_0x2f5973(0x1e7)]===_0x2f5973(0x1f8)?_0x7bc69d=_0x2f5973(0x1ee):_0x7bc69d=_0x2f5973(0x194);break;case _0x2f5973(0x202):case _0x2f5973(0x19f):case _0x2f5973(0x196):case _0x2f5973(0x198):case _0x2f5973(0x1d2):_0x7bc69d=_0x2f5973(0x1ce);break;case _0x2f5973(0x1d5):case _0x2f5973(0x1f6):_0x7bc69d=_0x2f5973(0x201);break;case _0x2f5973(0x19e):case'created':case _0x2f5973(0x1eb):case _0x2f5973(0x1f1):case'in_progress':default:_0x7bc69d=_0x2f5973(0x194);break;}return{'paymentId':_0x7b7208[_0x2f5973(0x20c)]||_0x7b7208['PaymentId'],'status':_0x7bc69d,'amount':_0x7b7208[_0x2f5973(0x1af)],'currency':_0x7b7208[_0x2f5973(0x1d3)],'additionalInfo':{'method':_0x7b7208[_0x2f5973(0x1ed)],'bankId':_0x7b7208['BankId'],'settled':_0x7b7208[_0x2f5973(0x1e7)],'settlementDate':_0x7b7208[_0x2f5973(0x208)],'remitterName':_0x7b7208['Remitter']?.[_0x2f5973(0x1b3)],'remitterIban':_0x7b7208[_0x2f5973(0x1d9)]?.[_0x2f5973(0x1c0)],'bankTransactionId':_0x7b7208[_0x2f5973(0x19b)]}};}['verifyWebhookSignature'](_0x52ad1a,_0x5780f1){const _0x33f534=a65_0x55d496;return console[_0x33f534(0x1ef)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x5780f1,'paymentId':_0x52ad1a[_0x33f534(0x1d7)],'merchantPaymentId':_0x52ad1a[_0x33f534(0x20c)]}),!![];}}function a65_0xf1a9(_0x438f3a,_0x3f336a){_0x438f3a=_0x438f3a-0x18f;const _0x5047b2=a65_0x5047();let _0xf1a9f0=_0x5047b2[_0x438f3a];return _0xf1a9f0;}exports['NodaService']=NodaService;