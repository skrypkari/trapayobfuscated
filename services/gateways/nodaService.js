'use strict';const a47_0x4fe368=a47_0x1e02;(function(_0x2e2ea3,_0x456310){const _0x307ae3=a47_0x1e02,_0x1814a9=_0x2e2ea3();while(!![]){try{const _0xfb38e=parseInt(_0x307ae3(0x1ed))/0x1+parseInt(_0x307ae3(0x222))/0x2*(parseInt(_0x307ae3(0x204))/0x3)+-parseInt(_0x307ae3(0x213))/0x4*(-parseInt(_0x307ae3(0x226))/0x5)+parseInt(_0x307ae3(0x240))/0x6+-parseInt(_0x307ae3(0x20a))/0x7*(parseInt(_0x307ae3(0x1f0))/0x8)+parseInt(_0x307ae3(0x209))/0x9*(-parseInt(_0x307ae3(0x24c))/0xa)+parseInt(_0x307ae3(0x205))/0xb*(-parseInt(_0x307ae3(0x206))/0xc);if(_0xfb38e===_0x456310)break;else _0x1814a9['push'](_0x1814a9['shift']());}catch(_0x2b96d1){_0x1814a9['push'](_0x1814a9['shift']());}}}(a47_0x5cf8,0xe6886));Object[a47_0x4fe368(0x25a)](exports,a47_0x4fe368(0x207),{'value':!![]}),exports[a47_0x4fe368(0x232)]=void 0x0;const loggerService_1=require(a47_0x4fe368(0x234));function a47_0x1e02(_0x54e441,_0x3b1bb4){const _0x5cf89f=a47_0x5cf8();return a47_0x1e02=function(_0x1e0202,_0x4233ce){_0x1e0202=_0x1e0202-0x1e0;let _0x957de0=_0x5cf89f[_0x1e0202];return _0x957de0;},a47_0x1e02(_0x54e441,_0x3b1bb4);}class NodaService{constructor(){const _0x27ffe2=a47_0x4fe368;this[_0x27ffe2(0x1ee)]=_0x27ffe2(0x221),console[_0x27ffe2(0x1fa)](_0x27ffe2(0x250));}async['createPaymentLink'](_0x5e6d5d){const _0x556bcb=a47_0x4fe368,{orderId:_0x11ca02,name:_0x20a326,paymentDescription:_0x1efe13,amount:_0x540c8b,currency:_0x443a44,webhookUrl:_0x47b8c3,returnUrl:_0x73ba40,expiryDate:_0x4f0d3b}=_0x5e6d5d,_0x2d38bf=_0x443a44[_0x556bcb(0x23d)](),_0x31696c='https://tesoft.uk/gateway/noda/webhook/',_0x1f4b92=_0x556bcb(0x24f)+_0x11ca02,_0x529997={'name':_0x20a326,'paymentDescription':_0x1efe13,'amount':_0x540c8b,'currency':_0x2d38bf,'paymentId':_0x11ca02,'webhookUrl':_0x31696c,'returnUrl':_0x1f4b92};_0x4f0d3b&&(_0x529997['expiryDate']=_0x4f0d3b);const _0x1547c8=Date[_0x556bcb(0x255)]();try{console[_0x556bcb(0x1fa)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x556bcb(0x1fa)](_0x556bcb(0x228),this[_0x556bcb(0x1ee)]),console[_0x556bcb(0x1fa)](_0x556bcb(0x24e),JSON[_0x556bcb(0x245)](_0x529997,null,0x2)),console[_0x556bcb(0x1fa)](_0x556bcb(0x223),_0x11ca02,_0x556bcb(0x23e)),console[_0x556bcb(0x1fa)](_0x556bcb(0x1f1),_0x1f4b92),loggerService_1['loggerService']['logWhiteDomainRequest']('noda',_0x556bcb(0x258),_0x556bcb(0x1e5),_0x529997);const _0x58bb09=await fetch(this[_0x556bcb(0x1ee)],{'method':_0x556bcb(0x1e5),'headers':{'Content-Type':_0x556bcb(0x1ff),'Accept':_0x556bcb(0x1ff),'User-Agent':_0x556bcb(0x200)},'body':JSON[_0x556bcb(0x245)](_0x529997)}),_0x3efba0=Date[_0x556bcb(0x255)]()-_0x1547c8;console[_0x556bcb(0x1fa)](_0x556bcb(0x1fc)),console[_0x556bcb(0x1fa)](_0x556bcb(0x202),_0x58bb09[_0x556bcb(0x20e)]),console[_0x556bcb(0x1fa)](_0x556bcb(0x1e6),_0x58bb09[_0x556bcb(0x24a)]),console[_0x556bcb(0x1fa)](_0x556bcb(0x23c),Object[_0x556bcb(0x20c)](_0x58bb09[_0x556bcb(0x236)][_0x556bcb(0x25c)]())),console['log'](_0x556bcb(0x235),_0x3efba0+'ms');const _0x530cfd=await _0x58bb09['text']();console[_0x556bcb(0x1fa)]('Raw\x20Response\x20Body:',_0x530cfd);if(!_0x58bb09['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x556bcb(0x227)]('HTTP\x20Status:',_0x58bb09['status']),console[_0x556bcb(0x227)]('Response\x20Body:',_0x530cfd),loggerService_1['loggerService'][_0x556bcb(0x1ef)](_0x556bcb(0x1f4),'/payment-links',_0x58bb09['status'],_0x530cfd,_0x3efba0),loggerService_1[_0x556bcb(0x237)][_0x556bcb(0x20f)](_0x556bcb(0x1f4),_0x556bcb(0x258),_0x556bcb(0x1e8)+_0x58bb09['status']+':\x20'+_0x530cfd);if(_0x58bb09[_0x556bcb(0x20e)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x58bb09['status']===0x1f4)throw new Error(_0x556bcb(0x203));}throw new Error(_0x556bcb(0x21d)+_0x58bb09[_0x556bcb(0x20e)]+_0x556bcb(0x1f7)+_0x530cfd);}let _0x57a13;try{_0x57a13=JSON[_0x556bcb(0x249)](_0x530cfd);}catch(_0x50ca1b){console[_0x556bcb(0x227)](_0x556bcb(0x1f2),_0x50ca1b),loggerService_1[_0x556bcb(0x237)][_0x556bcb(0x20f)]('noda',_0x556bcb(0x258),'JSON\x20Parse\x20Error:\x20'+_0x50ca1b);throw new Error(_0x556bcb(0x252)+_0x530cfd);}console[_0x556bcb(0x1fa)](_0x556bcb(0x238)),console[_0x556bcb(0x1fa)](_0x556bcb(0x214),JSON[_0x556bcb(0x245)](_0x57a13,null,0x2)),loggerService_1[_0x556bcb(0x237)][_0x556bcb(0x1ef)]('noda',_0x556bcb(0x258),_0x58bb09[_0x556bcb(0x20e)],_0x57a13,_0x3efba0);if(_0x57a13[_0x556bcb(0x227)]||_0x57a13[_0x556bcb(0x220)]){const _0x33d672=_0x57a13[_0x556bcb(0x1e3)]||_0x57a13['error']||_0x556bcb(0x23f);console[_0x556bcb(0x227)](_0x556bcb(0x22f)),console[_0x556bcb(0x227)](_0x556bcb(0x233),_0x33d672),console[_0x556bcb(0x227)](_0x556bcb(0x22b),_0x57a13[_0x556bcb(0x220)]),loggerService_1[_0x556bcb(0x237)]['logWhiteDomainError'](_0x556bcb(0x1f4),_0x556bcb(0x258),_0x556bcb(0x22a)+_0x33d672);throw new Error(_0x556bcb(0x24b)+_0x33d672);}if(!_0x57a13['id']||!_0x57a13[_0x556bcb(0x23b)]?.[_0x556bcb(0x259)]){console[_0x556bcb(0x227)](_0x556bcb(0x248)),console['error'](_0x556bcb(0x254)),console['error'](_0x556bcb(0x224),_0x57a13),loggerService_1[_0x556bcb(0x237)][_0x556bcb(0x20f)](_0x556bcb(0x1f4),_0x556bcb(0x258),_0x556bcb(0x1ea));throw new Error(_0x556bcb(0x225));}return console[_0x556bcb(0x1fa)](_0x556bcb(0x256)),console['log']('Payment\x20Link\x20ID:',_0x57a13['id']),console[_0x556bcb(0x1fa)](_0x556bcb(0x1f8),_0x57a13[_0x556bcb(0x23b)][_0x556bcb(0x259)]),console[_0x556bcb(0x1fa)](_0x556bcb(0x201),_0x57a13[_0x556bcb(0x23b)][_0x556bcb(0x253)]||_0x556bcb(0x22e)),console['log'](_0x556bcb(0x219),_0x11ca02,_0x556bcb(0x243)),console[_0x556bcb(0x1fa)]('✅\x20Return\x20URL\x20configured\x20for\x20pending:',_0x1f4b92),{'gateway_payment_id':_0x57a13['id'],'payment_url':_0x57a13[_0x556bcb(0x23b)][_0x556bcb(0x259)],'qr_code_url':_0x57a13[_0x556bcb(0x23b)][_0x556bcb(0x253)],'expiry_date':_0x57a13[_0x556bcb(0x1fe)]};}catch(_0x52281b){console['error'](_0x556bcb(0x208)),console[_0x556bcb(0x227)](_0x556bcb(0x257),_0x52281b),loggerService_1[_0x556bcb(0x237)][_0x556bcb(0x20f)](_0x556bcb(0x1f4),_0x556bcb(0x258),_0x52281b);if(_0x52281b instanceof Error){console[_0x556bcb(0x227)](_0x556bcb(0x25b),_0x52281b[_0x556bcb(0x1e3)]),console['error']('Error\x20stack:',_0x52281b[_0x556bcb(0x242)]);throw new Error(_0x556bcb(0x241)+_0x52281b[_0x556bcb(0x1e3)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0xea4524){const _0x2d1a70=a47_0x4fe368,_0x3d801e=Date[_0x2d1a70(0x255)]();try{loggerService_1['loggerService']['logWhiteDomainRequest'](_0x2d1a70(0x1f4),_0x2d1a70(0x246)+_0xea4524,_0x2d1a70(0x21f),{});const _0x2a343c=await fetch(this[_0x2d1a70(0x1ee)]+'/'+_0xea4524,{'method':_0x2d1a70(0x21f),'headers':{'Content-Type':_0x2d1a70(0x1ff),'User-Agent':_0x2d1a70(0x200)}}),_0x1e0e1f=Date[_0x2d1a70(0x255)]()-_0x3d801e;if(!_0x2a343c['ok']){const _0xe6d3bc=await _0x2a343c[_0x2d1a70(0x1e0)]();loggerService_1[_0x2d1a70(0x237)][_0x2d1a70(0x1ef)](_0x2d1a70(0x1f4),'/payment-links/'+_0xea4524,_0x2a343c[_0x2d1a70(0x20e)],_0xe6d3bc,_0x1e0e1f);throw new Error(_0x2d1a70(0x21d)+_0x2a343c[_0x2d1a70(0x20e)]);}const _0x36ab36=await _0x2a343c[_0x2d1a70(0x1ec)]();loggerService_1[_0x2d1a70(0x237)]['logWhiteDomainResponse']('noda',_0x2d1a70(0x246)+_0xea4524,_0x2a343c[_0x2d1a70(0x20e)],_0x36ab36,_0x1e0e1f);if(_0x36ab36[_0x2d1a70(0x227)]||_0x36ab36[_0x2d1a70(0x220)]){loggerService_1[_0x2d1a70(0x237)][_0x2d1a70(0x20f)](_0x2d1a70(0x1f4),'/payment-links/'+_0xea4524,_0x2d1a70(0x24b)+(_0x36ab36[_0x2d1a70(0x1e3)]||_0x36ab36[_0x2d1a70(0x227)]||_0x2d1a70(0x1eb)));throw new Error(_0x2d1a70(0x24b)+(_0x36ab36[_0x2d1a70(0x1e3)]||_0x36ab36[_0x2d1a70(0x227)]||'Unknown\x20error'));}let _0x40d532=_0x2d1a70(0x1f6);if(_0x36ab36[_0x2d1a70(0x218)]===![]){if(_0x36ab36[_0x2d1a70(0x1fe)]){const _0x29588a=new Date(_0x36ab36[_0x2d1a70(0x1fe)]),_0x3bbe80=new Date();_0x29588a<_0x3bbe80?_0x40d532=_0x2d1a70(0x1e1):_0x40d532='FAILED';}else _0x40d532='FAILED';}else _0x40d532=_0x2d1a70(0x1f6);return{'status':_0x40d532,'amount':_0x36ab36['amount'],'currency':_0x36ab36['currency'],'isActive':_0x36ab36[_0x2d1a70(0x218)]};}catch(_0xfe8804){console['error']('Noda\x20payment\x20verification\x20error:',_0xfe8804),loggerService_1[_0x2d1a70(0x237)][_0x2d1a70(0x20f)](_0x2d1a70(0x1f4),'/payment-links/'+_0xea4524,_0xfe8804);throw new Error(_0x2d1a70(0x231)+(_0xfe8804 instanceof Error?_0xfe8804[_0x2d1a70(0x1e3)]:_0x2d1a70(0x1eb)));}}async[a47_0x4fe368(0x247)](_0x3644de){const _0x595760=a47_0x4fe368;console[_0x595760(0x1fa)]('Processing\x20Noda\x20webhook:',_0x3644de);let _0x2e2965=_0x595760(0x1f6);switch(_0x3644de[_0x595760(0x1e2)]?.['toLowerCase']()){case _0x595760(0x1f3):case _0x595760(0x1fd):case _0x595760(0x23a):case _0x595760(0x215):case'successful':_0x3644de[_0x595760(0x20b)]===_0x595760(0x24d)?_0x2e2965=_0x595760(0x210):_0x2e2965=_0x595760(0x1f6);break;case _0x595760(0x1e7):case _0x595760(0x21c):case _0x595760(0x22d):case _0x595760(0x227):case _0x595760(0x239):_0x2e2965=_0x595760(0x1f9);break;case _0x595760(0x1e9):case _0x595760(0x217):_0x2e2965=_0x595760(0x1e1);break;case _0x595760(0x21a):case _0x595760(0x251):case _0x595760(0x244):case _0x595760(0x1fb):case'in_progress':default:_0x2e2965=_0x595760(0x1f6);break;}return{'paymentId':_0x3644de[_0x595760(0x229)]||_0x3644de[_0x595760(0x20d)],'status':_0x2e2965,'amount':_0x3644de[_0x595760(0x230)],'currency':_0x3644de[_0x595760(0x1f5)],'additionalInfo':{'method':_0x3644de[_0x595760(0x1e4)],'bankId':_0x3644de[_0x595760(0x211)],'settled':_0x3644de[_0x595760(0x20b)],'settlementDate':_0x3644de['SettlementDate'],'remitterName':_0x3644de['Remitter']?.[_0x595760(0x21b)],'remitterIban':_0x3644de[_0x595760(0x21e)]?.[_0x595760(0x22c)],'bankTransactionId':_0x3644de[_0x595760(0x212)]}};}[a47_0x4fe368(0x216)](_0x2f5e29,_0x41808a){const _0x855dfd=a47_0x4fe368;return console[_0x855dfd(0x1fa)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x41808a,'paymentId':_0x2f5e29[_0x855dfd(0x20d)],'merchantPaymentId':_0x2f5e29[_0x855dfd(0x229)]}),!![];}}exports[a47_0x4fe368(0x232)]=NodaService;function a47_0x5cf8(){const _0x15548e=['Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','stack','(8digits-8digits\x20format)','active','stringify','/payment-links/','processWebhook','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','parse','statusText','Noda\x20API\x20error:\x20','90fkNRpL','Yes','Request\x20Body\x20(Direct\x20JSON):','https://tesoft.uk/gateway/pending.php?id=','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','created','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','qrCodeLink','Missing\x20id\x20or\x20shortLink\x20in\x20response','now','===\x20NODA\x20SUCCESS\x20===','Error\x20details:','/payment-links','shortLink','defineProperty','Error\x20message:','entries','text','EXPIRED','Status','message','Method','POST','Status\x20Text:','cancelled','HTTP\x20','expired','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Unknown\x20error','json','99243yLcgwl','apiUrl','logWhiteDomainResponse','10006712FRlzNQ','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','Failed\x20to\x20parse\x20JSON\x20response:','done','noda','Currency','PENDING',',\x20body:\x20','Short\x20Link:','FAILED','log','processing','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','completed','expiryDate','application/json','TesSoft\x20Payment\x20System/1.0','QR\x20Code\x20Link:','Status:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','70737DfixFu','55hmteJM','683520ueYqKI','__esModule','===\x20NODA\x20SERVICE\x20ERROR\x20===','1187568fgZCfW','7EtSIKx','Settled','fromEntries','PaymentId','status','logWhiteDomainError','PAID','BankId','BankTransactionId','1268740iiQbhd','Parsed\x20Result:','success','verifyWebhookSignature','timeout','isActive','Order\x20ID\x20Used:','pending','Name','canceled','HTTP\x20error!\x20status:\x20','Remitter','GET','statusCode','https://tesoft.uk/gateway/noda/','82WpHlaW','Order\x20ID\x20Format:','Response\x20data:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','25zNtApN','error','URL:','MerchantPaymentId','Business\x20Error:\x20','Status\x20Code:','Iban','failed','Not\x20provided','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Amount','Failed\x20to\x20verify\x20Noda\x20payment:\x20','NodaService','Error\x20Message:','../loggerService','Response\x20Time:','headers','loggerService','===\x20PARSED\x20NODA\x20RESPONSE\x20===','rejected','paid','shortLinkUrls','Headers:','toUpperCase','(8digits-8digits\x20format\x20for\x20Noda)','Unknown\x20error\x20from\x20Noda\x20API','6093372fmyIKW'];a47_0x5cf8=function(){return _0x15548e;};return a47_0x5cf8();}