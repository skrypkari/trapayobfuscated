'use strict';const a40_0x5135e0=a40_0x3939;function a40_0x5dc8(){const _0xe00f57=['pending','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','qrCodeLink','Settled','logWhiteDomainResponse','Amount','defineProperty','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Parsed\x20Result:','SettlementDate','verifyPayment','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','now','toLowerCase','PENDING','MerchantPaymentId','https://tesoft.uk/gateway/pending.php?id=','Currency','2376FxRqth','Raw\x20Response\x20Body:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','toUpperCase','Failed\x20to\x20parse\x20JSON\x20response:','849160CYDWGt','shortLinkUrls','log','parse','PAID','Status','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','logWhiteDomainError','PaymentId','272hSaofp','Short\x20Link:','Name','FAILED','URL:','/payment-links','Error\x20Message:','(8digits-8digits\x20format\x20for\x20Noda)','Request\x20Body\x20(Direct\x20JSON):','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','BankTransactionId','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainRequest','EXPIRED','Error\x20stack:','Method','rejected','Payment\x20Link\x20ID:','Noda\x20API\x20error:\x20','paid','isActive','(8digits-8digits\x20format)','Not\x20provided','Status:','created','status','Error\x20details:','77289ArZhVK','/payment-links/','Response\x20Time:','Remitter','Processing\x20Noda\x20webhook:','statusText','error','Iban','in_progress','expiryDate','__esModule','880068POuwsd','HTTP\x20','BankId','Order\x20ID\x20Format:','processing','HTTP\x20Status:','===\x20NODA\x20SERVICE\x20ERROR\x20===','fromEntries','apiUrl','Response\x20Body:','===\x20NODA\x20API\x20ERROR\x20===','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','noda','done','timeout','Noda\x20webhook\x20signature\x20verification:','stack','Noda\x20payment\x20verification\x20error:','Error\x20message:','cancelled','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','application/json','GET','stringify','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Unknown\x20error','currency','QR\x20Code\x20Link:','409802UaFvIl','Yes','successful','statusCode','message','Missing\x20id\x20or\x20shortLink\x20in\x20response','success','headers','HTTP\x20error!\x20status:\x20','6223PEBvfA','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Unknown\x20error\x20from\x20Noda\x20API','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','POST','6834879NnObQG','../loggerService','NodaService','TesSoft\x20Payment\x20System/1.0','loggerService','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Headers:','===\x20NODA\x20SUCCESS\x20===','https://tesoft.uk/gateway/noda/','shortLink','text','1039947zUIMmI'];a40_0x5dc8=function(){return _0xe00f57;};return a40_0x5dc8();}(function(_0x561e54,_0x12ff5a){const _0x452d1d=a40_0x3939,_0x454879=_0x561e54();while(!![]){try{const _0xa86b4c=-parseInt(_0x452d1d(0x140))/0x1+-parseInt(_0x452d1d(0x126))/0x2+-parseInt(_0x452d1d(0xff))/0x3*(-parseInt(_0x452d1d(0xe4))/0x4)+-parseInt(_0x452d1d(0xdb))/0x5+parseInt(_0x452d1d(0x10a))/0x6+-parseInt(_0x452d1d(0x12f))/0x7*(parseInt(_0x452d1d(0xd6))/0x8)+parseInt(_0x452d1d(0x135))/0x9;if(_0xa86b4c===_0x12ff5a)break;else _0x454879['push'](_0x454879['shift']());}catch(_0x1a271e){_0x454879['push'](_0x454879['shift']());}}}(a40_0x5dc8,0xef150));Object[a40_0x5135e0(0xca)](exports,a40_0x5135e0(0x109),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a40_0x5135e0(0x136));class NodaService{constructor(){const _0x1698c9=a40_0x5135e0;this[_0x1698c9(0x112)]=_0x1698c9(0x13d),console[_0x1698c9(0xdd)](_0x1698c9(0x115));}async['createPaymentLink'](_0x4c4107){const _0x379575=a40_0x5135e0,{orderId:_0x3b1d7e,name:_0x10859c,paymentDescription:_0xd04e7e,amount:_0x111ba3,currency:_0x185205,webhookUrl:_0x5e5b2b,returnUrl:_0x52fbc9,expiryDate:_0x40a282}=_0x4c4107,_0x549405=_0x185205[_0x379575(0xd9)](),_0x306ccb='https://tesoft.uk/gateway/noda/webhook/',_0xe956a4=_0x379575(0xd4)+_0x3b1d7e,_0x1966b8={'name':_0x10859c,'paymentDescription':_0xd04e7e,'amount':_0x111ba3,'currency':_0x549405,'paymentId':_0x3b1d7e,'webhookUrl':_0x306ccb,'returnUrl':_0xe956a4};_0x40a282&&(_0x1966b8[_0x379575(0x108)]=_0x40a282);const _0x388e37=Date[_0x379575(0xd0)]();try{console[_0x379575(0xdd)](_0x379575(0xe1)),console['log'](_0x379575(0xe8),this['apiUrl']),console[_0x379575(0xdd)](_0x379575(0xec),JSON[_0x379575(0x121)](_0x1966b8,null,0x2)),console[_0x379575(0xdd)](_0x379575(0x10d),_0x3b1d7e,_0x379575(0xeb)),console[_0x379575(0xdd)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0xe956a4),loggerService_1['loggerService'][_0x379575(0xf0)](_0x379575(0x116),'/payment-links',_0x379575(0x134),_0x1966b8);const _0x20e8e2=await fetch(this['apiUrl'],{'method':_0x379575(0x134),'headers':{'Content-Type':'application/json','Accept':_0x379575(0x11f),'User-Agent':_0x379575(0x138)},'body':JSON['stringify'](_0x1966b8)}),_0x1df018=Date[_0x379575(0xd0)]()-_0x388e37;console[_0x379575(0xdd)](_0x379575(0xef)),console[_0x379575(0xdd)](_0x379575(0xfb),_0x20e8e2[_0x379575(0xfd)]),console[_0x379575(0xdd)]('Status\x20Text:',_0x20e8e2[_0x379575(0x104)]),console[_0x379575(0xdd)](_0x379575(0x13b),Object[_0x379575(0x111)](_0x20e8e2[_0x379575(0x12d)]['entries']())),console[_0x379575(0xdd)](_0x379575(0x101),_0x1df018+'ms');const _0x7b12ab=await _0x20e8e2[_0x379575(0x13f)]();console[_0x379575(0xdd)](_0x379575(0xd7),_0x7b12ab);if(!_0x20e8e2['ok']){console['error'](_0x379575(0x114)),console[_0x379575(0x105)](_0x379575(0x10f),_0x20e8e2[_0x379575(0xfd)]),console[_0x379575(0x105)](_0x379575(0x113),_0x7b12ab),loggerService_1[_0x379575(0x139)]['logWhiteDomainResponse'](_0x379575(0x116),_0x379575(0xe9),_0x20e8e2[_0x379575(0xfd)],_0x7b12ab,_0x1df018),loggerService_1[_0x379575(0x139)][_0x379575(0xe2)]('noda',_0x379575(0xe9),_0x379575(0x10b)+_0x20e8e2[_0x379575(0xfd)]+':\x20'+_0x7b12ab);if(_0x20e8e2[_0x379575(0xfd)]===0x190)throw new Error(_0x379575(0x11e));else{if(_0x20e8e2[_0x379575(0xfd)]===0x1f4)throw new Error(_0x379575(0x122));}throw new Error(_0x379575(0x12e)+_0x20e8e2[_0x379575(0xfd)]+',\x20body:\x20'+_0x7b12ab);}let _0x2a143b;try{_0x2a143b=JSON[_0x379575(0xde)](_0x7b12ab);}catch(_0x401fe9){console[_0x379575(0x105)](_0x379575(0xda),_0x401fe9),loggerService_1['loggerService'][_0x379575(0xe2)](_0x379575(0x116),'/payment-links','JSON\x20Parse\x20Error:\x20'+_0x401fe9);throw new Error(_0x379575(0x133)+_0x7b12ab);}console[_0x379575(0xdd)](_0x379575(0xd8)),console[_0x379575(0xdd)](_0x379575(0xcc),JSON[_0x379575(0x121)](_0x2a143b,null,0x2)),loggerService_1[_0x379575(0x139)][_0x379575(0xc8)](_0x379575(0x116),_0x379575(0xe9),_0x20e8e2['status'],_0x2a143b,_0x1df018);if(_0x2a143b[_0x379575(0x105)]||_0x2a143b[_0x379575(0x129)]){const _0x54d904=_0x2a143b[_0x379575(0x12a)]||_0x2a143b[_0x379575(0x105)]||_0x379575(0x132);console['error'](_0x379575(0xcb)),console[_0x379575(0x105)](_0x379575(0xea),_0x54d904),console[_0x379575(0x105)]('Status\x20Code:',_0x2a143b['statusCode']),loggerService_1[_0x379575(0x139)]['logWhiteDomainError'](_0x379575(0x116),_0x379575(0xe9),'Business\x20Error:\x20'+_0x54d904);throw new Error(_0x379575(0xf6)+_0x54d904);}if(!_0x2a143b['id']||!_0x2a143b[_0x379575(0xdc)]?.[_0x379575(0x13e)]){console[_0x379575(0x105)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x379575(0x105)](_0x379575(0x12b)),console['error']('Response\x20data:',_0x2a143b),loggerService_1[_0x379575(0x139)]['logWhiteDomainError'](_0x379575(0x116),'/payment-links',_0x379575(0xed));throw new Error(_0x379575(0xc5));}return console[_0x379575(0xdd)](_0x379575(0x13c)),console[_0x379575(0xdd)](_0x379575(0xf5),_0x2a143b['id']),console[_0x379575(0xdd)](_0x379575(0xe5),_0x2a143b[_0x379575(0xdc)]['shortLink']),console['log'](_0x379575(0x125),_0x2a143b[_0x379575(0xdc)]['qrCodeLink']||_0x379575(0xfa)),console[_0x379575(0xdd)]('Order\x20ID\x20Used:',_0x3b1d7e,_0x379575(0xf9)),console[_0x379575(0xdd)](_0x379575(0x130),_0xe956a4),{'gateway_payment_id':_0x2a143b['id'],'payment_url':_0x2a143b[_0x379575(0xdc)]['shortLink'],'qr_code_url':_0x2a143b[_0x379575(0xdc)][_0x379575(0xc6)],'expiry_date':_0x2a143b[_0x379575(0x108)]};}catch(_0x19d7e8){console[_0x379575(0x105)](_0x379575(0x110)),console[_0x379575(0x105)](_0x379575(0xfe),_0x19d7e8),loggerService_1[_0x379575(0x139)][_0x379575(0xe2)](_0x379575(0x116),_0x379575(0xe9),_0x19d7e8);if(_0x19d7e8 instanceof Error){console[_0x379575(0x105)](_0x379575(0x11c),_0x19d7e8[_0x379575(0x12a)]),console[_0x379575(0x105)](_0x379575(0xf2),_0x19d7e8[_0x379575(0x11a)]);throw new Error(_0x379575(0xcf)+_0x19d7e8[_0x379575(0x12a)]);}throw new Error(_0x379575(0x13a));}}async[a40_0x5135e0(0xce)](_0x16f7ce){const _0x2f05b1=a40_0x5135e0,_0xbcc935=Date[_0x2f05b1(0xd0)]();try{loggerService_1[_0x2f05b1(0x139)][_0x2f05b1(0xf0)](_0x2f05b1(0x116),'/payment-links/'+_0x16f7ce,_0x2f05b1(0x120),{});const _0x233909=await fetch(this[_0x2f05b1(0x112)]+'/'+_0x16f7ce,{'method':_0x2f05b1(0x120),'headers':{'Content-Type':_0x2f05b1(0x11f),'User-Agent':_0x2f05b1(0x138)}}),_0x138522=Date[_0x2f05b1(0xd0)]()-_0xbcc935;if(!_0x233909['ok']){const _0x438c8c=await _0x233909[_0x2f05b1(0x13f)]();loggerService_1[_0x2f05b1(0x139)][_0x2f05b1(0xc8)](_0x2f05b1(0x116),'/payment-links/'+_0x16f7ce,_0x233909['status'],_0x438c8c,_0x138522);throw new Error('HTTP\x20error!\x20status:\x20'+_0x233909[_0x2f05b1(0xfd)]);}const _0x52037c=await _0x233909['json']();loggerService_1[_0x2f05b1(0x139)][_0x2f05b1(0xc8)](_0x2f05b1(0x116),_0x2f05b1(0x100)+_0x16f7ce,_0x233909[_0x2f05b1(0xfd)],_0x52037c,_0x138522);if(_0x52037c[_0x2f05b1(0x105)]||_0x52037c[_0x2f05b1(0x129)]){loggerService_1[_0x2f05b1(0x139)][_0x2f05b1(0xe2)](_0x2f05b1(0x116),'/payment-links/'+_0x16f7ce,_0x2f05b1(0xf6)+(_0x52037c[_0x2f05b1(0x12a)]||_0x52037c['error']||'Unknown\x20error'));throw new Error(_0x2f05b1(0xf6)+(_0x52037c[_0x2f05b1(0x12a)]||_0x52037c['error']||_0x2f05b1(0x123)));}let _0x40c66e='PENDING';if(_0x52037c[_0x2f05b1(0xf8)]===![]){if(_0x52037c[_0x2f05b1(0x108)]){const _0x2b7d0b=new Date(_0x52037c['expiryDate']),_0x50e967=new Date();_0x2b7d0b<_0x50e967?_0x40c66e=_0x2f05b1(0xf1):_0x40c66e=_0x2f05b1(0xe7);}else _0x40c66e=_0x2f05b1(0xe7);}else _0x40c66e=_0x2f05b1(0xd2);return{'status':_0x40c66e,'amount':_0x52037c['amount'],'currency':_0x52037c[_0x2f05b1(0x124)],'isActive':_0x52037c[_0x2f05b1(0xf8)]};}catch(_0x2fec14){console[_0x2f05b1(0x105)](_0x2f05b1(0x11b),_0x2fec14),loggerService_1[_0x2f05b1(0x139)]['logWhiteDomainError'](_0x2f05b1(0x116),'/payment-links/'+_0x16f7ce,_0x2fec14);throw new Error(_0x2f05b1(0x131)+(_0x2fec14 instanceof Error?_0x2fec14[_0x2f05b1(0x12a)]:'Unknown\x20error'));}}async['processWebhook'](_0x5b7ba1){const _0x1fc960=a40_0x5135e0;console['log'](_0x1fc960(0x103),_0x5b7ba1);let _0x3ffcf6=_0x1fc960(0xd2);switch(_0x5b7ba1[_0x1fc960(0xe0)]?.[_0x1fc960(0xd1)]()){case _0x1fc960(0x117):case'completed':case _0x1fc960(0xf7):case _0x1fc960(0x12c):case _0x1fc960(0x128):_0x5b7ba1[_0x1fc960(0xc7)]===_0x1fc960(0x127)?_0x3ffcf6=_0x1fc960(0xdf):_0x3ffcf6=_0x1fc960(0xd2);break;case _0x1fc960(0x11d):case'canceled':case'failed':case _0x1fc960(0x105):case _0x1fc960(0xf4):_0x3ffcf6='FAILED';break;case'expired':case _0x1fc960(0x118):_0x3ffcf6=_0x1fc960(0xf1);break;case _0x1fc960(0x141):case _0x1fc960(0xfc):case'active':case _0x1fc960(0x10e):case _0x1fc960(0x107):default:_0x3ffcf6=_0x1fc960(0xd2);break;}return{'paymentId':_0x5b7ba1[_0x1fc960(0xd3)]||_0x5b7ba1[_0x1fc960(0xe3)],'status':_0x3ffcf6,'amount':_0x5b7ba1[_0x1fc960(0xc9)],'currency':_0x5b7ba1[_0x1fc960(0xd5)],'additionalInfo':{'method':_0x5b7ba1[_0x1fc960(0xf3)],'bankId':_0x5b7ba1[_0x1fc960(0x10c)],'settled':_0x5b7ba1[_0x1fc960(0xc7)],'settlementDate':_0x5b7ba1[_0x1fc960(0xcd)],'remitterName':_0x5b7ba1[_0x1fc960(0x102)]?.[_0x1fc960(0xe6)],'remitterIban':_0x5b7ba1[_0x1fc960(0x102)]?.[_0x1fc960(0x106)],'bankTransactionId':_0x5b7ba1[_0x1fc960(0xee)]}};}['verifyWebhookSignature'](_0x248d10,_0x516ad0){const _0x229581=a40_0x5135e0;return console[_0x229581(0xdd)](_0x229581(0x119),{'receivedSignature':_0x516ad0,'paymentId':_0x248d10[_0x229581(0xe3)],'merchantPaymentId':_0x248d10[_0x229581(0xd3)]}),!![];}}function a40_0x3939(_0x2e215f,_0x4b13eb){const _0x5dc864=a40_0x5dc8();return a40_0x3939=function(_0x393914,_0x1af7eb){_0x393914=_0x393914-0xc5;let _0x3db4b5=_0x5dc864[_0x393914];return _0x3db4b5;},a40_0x3939(_0x2e215f,_0x4b13eb);}exports[a40_0x5135e0(0x137)]=NodaService;