'use strict';const a43_0x23855f=a43_0x5349;(function(_0x297f5e,_0x51934b){const _0x2d1cc2=a43_0x5349,_0x47adab=_0x297f5e();while(!![]){try{const _0x2cbb6e=parseInt(_0x2d1cc2(0x1a4))/0x1+parseInt(_0x2d1cc2(0x19b))/0x2*(parseInt(_0x2d1cc2(0x190))/0x3)+-parseInt(_0x2d1cc2(0x1f3))/0x4*(parseInt(_0x2d1cc2(0x191))/0x5)+-parseInt(_0x2d1cc2(0x1be))/0x6*(parseInt(_0x2d1cc2(0x1e9))/0x7)+parseInt(_0x2d1cc2(0x1c4))/0x8*(parseInt(_0x2d1cc2(0x18c))/0x9)+-parseInt(_0x2d1cc2(0x18f))/0xa*(-parseInt(_0x2d1cc2(0x1ea))/0xb)+-parseInt(_0x2d1cc2(0x1dd))/0xc;if(_0x2cbb6e===_0x51934b)break;else _0x47adab['push'](_0x47adab['shift']());}catch(_0x17f687){_0x47adab['push'](_0x47adab['shift']());}}}(a43_0x124b,0xd0237));Object[a43_0x23855f(0x1b2)](exports,a43_0x23855f(0x1f5),{'value':!![]}),exports[a43_0x23855f(0x1b5)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x18bd4a=a43_0x23855f;this[_0x18bd4a(0x1a2)]='https://tesoft.uk/gateway/noda/',console[_0x18bd4a(0x187)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a43_0x23855f(0x1c6)](_0x9d1de3){const _0x468c92=a43_0x23855f,{orderId:_0x4823b8,name:_0x4072f7,paymentDescription:_0x431846,amount:_0x3a1a75,currency:_0x83d30,webhookUrl:_0x5a9bb6,returnUrl:_0x58a43e,expiryDate:_0x436fd5}=_0x9d1de3,_0xcf6fe9=_0x83d30['toUpperCase'](),_0x1a509d=_0x468c92(0x193),_0x1f4c26='https://tesoft.uk/gateway/pending.php?id='+_0x4823b8,_0x5982ac={'name':_0x4072f7,'paymentDescription':_0x431846,'amount':_0x3a1a75,'currency':_0xcf6fe9,'paymentId':_0x4823b8,'webhookUrl':_0x1a509d,'returnUrl':_0x1f4c26};_0x436fd5&&(_0x5982ac['expiryDate']=_0x436fd5);const _0x49dbc4=Date[_0x468c92(0x1d3)]();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x468c92(0x187)](_0x468c92(0x1ab),this[_0x468c92(0x1a2)]),console[_0x468c92(0x187)](_0x468c92(0x1ef),JSON[_0x468c92(0x1c2)](_0x5982ac,null,0x2)),console[_0x468c92(0x187)](_0x468c92(0x1e7),_0x4823b8,_0x468c92(0x19d)),console[_0x468c92(0x187)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x1f4c26),loggerService_1[_0x468c92(0x1f7)][_0x468c92(0x1ca)](_0x468c92(0x1f8),'/payment-links','POST',_0x5982ac);const _0x4e340c=await fetch(this[_0x468c92(0x1a2)],{'method':'POST','headers':{'Content-Type':_0x468c92(0x1f0),'Accept':_0x468c92(0x1f0),'User-Agent':_0x468c92(0x1ac)},'body':JSON['stringify'](_0x5982ac)}),_0x520ff1=Date[_0x468c92(0x1d3)]()-_0x49dbc4;console[_0x468c92(0x187)](_0x468c92(0x1ce)),console[_0x468c92(0x187)](_0x468c92(0x1ee),_0x4e340c[_0x468c92(0x1de)]),console['log'](_0x468c92(0x19a),_0x4e340c[_0x468c92(0x1a6)]),console[_0x468c92(0x187)](_0x468c92(0x1f6),Object[_0x468c92(0x1f2)](_0x4e340c[_0x468c92(0x197)]['entries']())),console['log']('Response\x20Time:',_0x520ff1+'ms');const _0x4ff64b=await _0x4e340c[_0x468c92(0x1b4)]();console[_0x468c92(0x187)](_0x468c92(0x1df),_0x4ff64b);if(!_0x4e340c['ok']){console[_0x468c92(0x1e4)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x468c92(0x1e4)](_0x468c92(0x1db),_0x4e340c[_0x468c92(0x1de)]),console[_0x468c92(0x1e4)](_0x468c92(0x1bd),_0x4ff64b),loggerService_1[_0x468c92(0x1f7)][_0x468c92(0x1d9)]('noda',_0x468c92(0x1ad),_0x4e340c[_0x468c92(0x1de)],_0x4ff64b,_0x520ff1),loggerService_1[_0x468c92(0x1f7)][_0x468c92(0x1a0)](_0x468c92(0x1f8),_0x468c92(0x1ad),_0x468c92(0x1b1)+_0x4e340c[_0x468c92(0x1de)]+':\x20'+_0x4ff64b);if(_0x4e340c[_0x468c92(0x1de)]===0x190)throw new Error(_0x468c92(0x1f4));else{if(_0x4e340c[_0x468c92(0x1de)]===0x1f4)throw new Error(_0x468c92(0x19e));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x4e340c[_0x468c92(0x1de)]+_0x468c92(0x192)+_0x4ff64b);}let _0x493ec3;try{_0x493ec3=JSON[_0x468c92(0x1b3)](_0x4ff64b);}catch(_0x5629bc){console[_0x468c92(0x1e4)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5629bc),loggerService_1[_0x468c92(0x1f7)][_0x468c92(0x1a0)](_0x468c92(0x1f8),_0x468c92(0x1ad),_0x468c92(0x188)+_0x5629bc);throw new Error(_0x468c92(0x1cc)+_0x4ff64b);}console[_0x468c92(0x187)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console['log']('Parsed\x20Result:',JSON['stringify'](_0x493ec3,null,0x2)),loggerService_1['loggerService'][_0x468c92(0x1d9)](_0x468c92(0x1f8),_0x468c92(0x1ad),_0x4e340c[_0x468c92(0x1de)],_0x493ec3,_0x520ff1);if(_0x493ec3[_0x468c92(0x1e4)]||_0x493ec3[_0x468c92(0x1ba)]){const _0xbcd438=_0x493ec3[_0x468c92(0x1e6)]||_0x493ec3[_0x468c92(0x1e4)]||_0x468c92(0x1d6);console['error']('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x468c92(0x1e4)]('Error\x20Message:',_0xbcd438),console[_0x468c92(0x1e4)](_0x468c92(0x1b0),_0x493ec3[_0x468c92(0x1ba)]),loggerService_1[_0x468c92(0x1f7)]['logWhiteDomainError'](_0x468c92(0x1f8),_0x468c92(0x1ad),_0x468c92(0x196)+_0xbcd438);throw new Error(_0x468c92(0x18a)+_0xbcd438);}if(!_0x493ec3['id']||!_0x493ec3[_0x468c92(0x18b)]?.[_0x468c92(0x1c7)]){console['error'](_0x468c92(0x1e2)),console['error'](_0x468c92(0x198)),console[_0x468c92(0x1e4)](_0x468c92(0x1a7),_0x493ec3),loggerService_1[_0x468c92(0x1f7)][_0x468c92(0x1a0)](_0x468c92(0x1f8),_0x468c92(0x1ad),_0x468c92(0x1e1));throw new Error(_0x468c92(0x1eb));}return console[_0x468c92(0x187)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x468c92(0x187)]('Payment\x20Link\x20ID:',_0x493ec3['id']),console['log'](_0x468c92(0x1b9),_0x493ec3[_0x468c92(0x18b)]['shortLink']),console[_0x468c92(0x187)](_0x468c92(0x1ae),_0x493ec3['shortLinkUrls'][_0x468c92(0x1bc)]||_0x468c92(0x1d1)),console[_0x468c92(0x187)]('Order\x20ID\x20Used:',_0x4823b8,'(8digits-8digits\x20format)'),console[_0x468c92(0x187)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x1f4c26),{'gateway_payment_id':_0x493ec3['id'],'payment_url':_0x493ec3[_0x468c92(0x18b)][_0x468c92(0x1c7)],'qr_code_url':_0x493ec3[_0x468c92(0x18b)][_0x468c92(0x1bc)],'expiry_date':_0x493ec3['expiryDate']};}catch(_0x4fc8d0){console[_0x468c92(0x1e4)](_0x468c92(0x1e5)),console[_0x468c92(0x1e4)](_0x468c92(0x1b7),_0x4fc8d0),loggerService_1['loggerService'][_0x468c92(0x1a0)](_0x468c92(0x1f8),'/payment-links',_0x4fc8d0);if(_0x4fc8d0 instanceof Error){console[_0x468c92(0x1e4)]('Error\x20message:',_0x4fc8d0[_0x468c92(0x1e6)]),console[_0x468c92(0x1e4)](_0x468c92(0x1cf),_0x4fc8d0[_0x468c92(0x1ec)]);throw new Error(_0x468c92(0x1b6)+_0x4fc8d0[_0x468c92(0x1e6)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x23855f(0x1c9)](_0x4f24c4){const _0x23c88b=a43_0x23855f,_0x17a009=Date['now']();try{loggerService_1[_0x23c88b(0x1f7)]['logWhiteDomainRequest'](_0x23c88b(0x1f8),'/payment-links/'+_0x4f24c4,'GET',{});const _0x4ae284=await fetch(this[_0x23c88b(0x1a2)]+'/'+_0x4f24c4,{'method':_0x23c88b(0x1da),'headers':{'Content-Type':_0x23c88b(0x1f0),'User-Agent':_0x23c88b(0x1ac)}}),_0x391d72=Date[_0x23c88b(0x1d3)]()-_0x17a009;if(!_0x4ae284['ok']){const _0x95fd9d=await _0x4ae284[_0x23c88b(0x1b4)]();loggerService_1['loggerService'][_0x23c88b(0x1d9)](_0x23c88b(0x1f8),'/payment-links/'+_0x4f24c4,_0x4ae284[_0x23c88b(0x1de)],_0x95fd9d,_0x391d72);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4ae284['status']);}const _0x5e1adc=await _0x4ae284['json']();loggerService_1[_0x23c88b(0x1f7)][_0x23c88b(0x1d9)]('noda',_0x23c88b(0x1d0)+_0x4f24c4,_0x4ae284[_0x23c88b(0x1de)],_0x5e1adc,_0x391d72);if(_0x5e1adc[_0x23c88b(0x1e4)]||_0x5e1adc[_0x23c88b(0x1ba)]){loggerService_1[_0x23c88b(0x1f7)][_0x23c88b(0x1a0)](_0x23c88b(0x1f8),_0x23c88b(0x1d0)+_0x4f24c4,_0x23c88b(0x18a)+(_0x5e1adc[_0x23c88b(0x1e6)]||_0x5e1adc[_0x23c88b(0x1e4)]||_0x23c88b(0x1c3)));throw new Error('Noda\x20API\x20error:\x20'+(_0x5e1adc[_0x23c88b(0x1e6)]||_0x5e1adc['error']||_0x23c88b(0x1c3)));}let _0x4b247e='PENDING';if(_0x5e1adc[_0x23c88b(0x1bb)]===![]){if(_0x5e1adc[_0x23c88b(0x1d7)]){const _0x50efa4=new Date(_0x5e1adc[_0x23c88b(0x1d7)]),_0x41fd87=new Date();_0x50efa4<_0x41fd87?_0x4b247e=_0x23c88b(0x1b8):_0x4b247e='FAILED';}else _0x4b247e=_0x23c88b(0x189);}else _0x4b247e=_0x23c88b(0x18e);return{'status':_0x4b247e,'amount':_0x5e1adc[_0x23c88b(0x1e8)],'currency':_0x5e1adc[_0x23c88b(0x194)],'isActive':_0x5e1adc[_0x23c88b(0x1bb)]};}catch(_0x26b2dd){console['error'](_0x23c88b(0x1aa),_0x26b2dd),loggerService_1['loggerService'][_0x23c88b(0x1a0)](_0x23c88b(0x1f8),_0x23c88b(0x1d0)+_0x4f24c4,_0x26b2dd);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x26b2dd instanceof Error?_0x26b2dd[_0x23c88b(0x1e6)]:_0x23c88b(0x1c3)));}}async['processWebhook'](_0x4d2162){const _0x2c882a=a43_0x23855f;console[_0x2c882a(0x187)](_0x2c882a(0x1f9),_0x4d2162);let _0xb91cc2=_0x2c882a(0x18e);switch(_0x4d2162[_0x2c882a(0x1d8)]?.[_0x2c882a(0x18d)]()){case _0x2c882a(0x1c1):case _0x2c882a(0x1dc):case _0x2c882a(0x1af):case _0x2c882a(0x1e3):case _0x2c882a(0x1a8):_0x4d2162[_0x2c882a(0x1a3)]===_0x2c882a(0x19c)?_0xb91cc2='PAID':_0xb91cc2=_0x2c882a(0x18e);break;case'cancelled':case _0x2c882a(0x199):case _0x2c882a(0x1c5):case'error':case'rejected':_0xb91cc2=_0x2c882a(0x189);break;case'expired':case _0x2c882a(0x1c0):_0xb91cc2=_0x2c882a(0x1b8);break;case _0x2c882a(0x1a9):case _0x2c882a(0x1d2):case _0x2c882a(0x19f):case'processing':case _0x2c882a(0x1c8):default:_0xb91cc2=_0x2c882a(0x18e);break;}return{'paymentId':_0x4d2162[_0x2c882a(0x1e0)]||_0x4d2162[_0x2c882a(0x1bf)],'status':_0xb91cc2,'amount':_0x4d2162['Amount'],'currency':_0x4d2162[_0x2c882a(0x1a5)],'additionalInfo':{'method':_0x4d2162[_0x2c882a(0x195)],'bankId':_0x4d2162['BankId'],'settled':_0x4d2162[_0x2c882a(0x1a3)],'settlementDate':_0x4d2162[_0x2c882a(0x1ed)],'remitterName':_0x4d2162[_0x2c882a(0x1d4)]?.[_0x2c882a(0x1d5)],'remitterIban':_0x4d2162[_0x2c882a(0x1d4)]?.[_0x2c882a(0x1f1)],'bankTransactionId':_0x4d2162[_0x2c882a(0x1cd)]}};}[a43_0x23855f(0x1a1)](_0x214925,_0x2f1acd){const _0x4d9e06=a43_0x23855f;return console[_0x4d9e06(0x187)](_0x4d9e06(0x1cb),{'receivedSignature':_0x2f1acd,'paymentId':_0x214925[_0x4d9e06(0x1bf)],'merchantPaymentId':_0x214925[_0x4d9e06(0x1e0)]}),!![];}}function a43_0x5349(_0x47a240,_0x27129e){const _0x124b1a=a43_0x124b();return a43_0x5349=function(_0x53496b,_0x389418){_0x53496b=_0x53496b-0x187;let _0x138b33=_0x124b1a[_0x53496b];return _0x138b33;},a43_0x5349(_0x47a240,_0x27129e);}exports['NodaService']=NodaService;function a43_0x124b(){const _0x18d71f=['fromEntries','840KRGuMX','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','__esModule','Headers:','loggerService','noda','Processing\x20Noda\x20webhook:','log','JSON\x20Parse\x20Error:\x20','FAILED','Noda\x20API\x20error:\x20','shortLinkUrls','9eKdfly','toLowerCase','PENDING','20bNJTVP','1292682DfJRtB','35225pqxwNp',',\x20body:\x20','https://tesoft.uk/gateway/noda/webhook/','currency','Method','Business\x20Error:\x20','headers','Missing\x20id\x20or\x20shortLink\x20in\x20response','canceled','Status\x20Text:','4VMxrVF','Yes','(8digits-8digits\x20format\x20for\x20Noda)','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','active','logWhiteDomainError','verifyWebhookSignature','apiUrl','Settled','294139DuAjOs','Currency','statusText','Response\x20data:','successful','pending','Noda\x20payment\x20verification\x20error:','URL:','TesSoft\x20Payment\x20System/1.0','/payment-links','QR\x20Code\x20Link:','paid','Status\x20Code:','HTTP\x20','defineProperty','parse','text','NodaService','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Error\x20details:','EXPIRED','Short\x20Link:','statusCode','isActive','qrCodeLink','Response\x20Body:','6LebvBL','PaymentId','timeout','done','stringify','Unknown\x20error','3629432WtJCQH','failed','createPaymentLink','shortLink','in_progress','verifyPayment','logWhiteDomainRequest','Noda\x20webhook\x20signature\x20verification:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','BankTransactionId','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20stack:','/payment-links/','Not\x20provided','created','now','Remitter','Name','Unknown\x20error\x20from\x20Noda\x20API','expiryDate','Status','logWhiteDomainResponse','GET','HTTP\x20Status:','completed','1297416aqClOS','status','Raw\x20Response\x20Body:','MerchantPaymentId','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','success','error','===\x20NODA\x20SERVICE\x20ERROR\x20===','message','Order\x20ID\x20Format:','amount','2573599syGUES','6589847AqbtMH','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','stack','SettlementDate','Status:','Request\x20Body\x20(Direct\x20JSON):','application/json','Iban'];a43_0x124b=function(){return _0x18d71f;};return a43_0x124b();}