'use strict';const a51_0x382afe=a51_0x3239;(function(_0x32976e,_0xfcfab7){const _0x73f618=a51_0x3239,_0x2107f8=_0x32976e();while(!![]){try{const _0x2272d2=parseInt(_0x73f618(0x17e))/0x1+parseInt(_0x73f618(0x18c))/0x2*(-parseInt(_0x73f618(0x15a))/0x3)+parseInt(_0x73f618(0x14c))/0x4*(-parseInt(_0x73f618(0x162))/0x5)+parseInt(_0x73f618(0x17f))/0x6*(parseInt(_0x73f618(0x1a3))/0x7)+-parseInt(_0x73f618(0x168))/0x8*(parseInt(_0x73f618(0x182))/0x9)+-parseInt(_0x73f618(0x19a))/0xa+parseInt(_0x73f618(0x193))/0xb;if(_0x2272d2===_0xfcfab7)break;else _0x2107f8['push'](_0x2107f8['shift']());}catch(_0x9f5c17){_0x2107f8['push'](_0x2107f8['shift']());}}}(a51_0x48ef,0x48a27));function a51_0x48ef(){const _0xd96711=['GET','verifyWebhookSignature','1152720dfxCRS','shortLink','NodaService','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Error\x20Message:','Payment\x20Link\x20ID:','toUpperCase','Request\x20Body\x20(Direct\x20JSON):','Raw\x20Response\x20Body:','paid','SettlementDate','Settled','Noda\x20API\x20error:\x20','Error\x20stack:','227907HqUwwP','QR\x20Code\x20Link:','noda','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','PENDING','Noda\x20webhook\x20signature\x20verification:','Response\x20Time:','../loggerService','5aiyhqa','MerchantPaymentId','Error\x20message:','cancelled','timeout','defineProperty','2371288CdgScY','EXPIRED','application/json','Order\x20ID\x20Used:','PAID','BankTransactionId','POST','qrCodeLink','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','pending','(8digits-8digits\x20format\x20for\x20Noda)','successful','loggerService','===\x20NODA\x20SUCCESS\x20===','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Error\x20details:','Name','now','Missing\x20id\x20or\x20shortLink\x20in\x20response','statusCode','PaymentId','entries','376453rFBsuc','642102slZUhR','error','URL:','9MTQWOG','logWhiteDomainResponse','expired','Business\x20Error:\x20','expiryDate','parse','===\x20PARSED\x20NODA\x20RESPONSE\x20===','HTTP\x20Status:','stringify','JSON\x20Parse\x20Error:\x20','14xDdeGX','/payment-links','Status\x20Text:','isActive','Order\x20ID\x20Format:','stack','===\x20NODA\x20API\x20ERROR\x20===','12763322RsqPji','Currency','Iban','Noda\x20payment\x20verification\x20error:','createPaymentLink','FAILED','status','4439210tHgXTB','Not\x20provided','processing','amount','in_progress','Status\x20Code:','Headers:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','rejected','21omsMwq','message','currency','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','headers','Payment\x20System/1.0','/payment-links/','apiUrl','text','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','__esModule','HTTP\x20error!\x20status:\x20','https://tesoft.uk/gateway/noda/','shortLinkUrls','Response\x20Body:','(8digits-8digits\x20format)','Remitter','Yes','Method','Amount','json','https://tesoft.uk/gateway/noda/webhook/','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status','Processing\x20Noda\x20webhook:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20NODA\x20SERVICE\x20ERROR\x20===','BankId','Short\x20Link:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Unknown\x20error',',\x20body:\x20','logWhiteDomainRequest','statusText','verifyPayment','log','processWebhook','logWhiteDomainError','Response\x20data:','Unknown\x20error\x20from\x20Noda\x20API','fromEntries','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','active','Failed\x20to\x20parse\x20JSON\x20response:'];a51_0x48ef=function(){return _0xd96711;};return a51_0x48ef();}function a51_0x3239(_0x5058f5,_0x394eca){const _0x48ef6a=a51_0x48ef();return a51_0x3239=function(_0x3239f7,_0x5bfbf3){_0x3239f7=_0x3239f7-0x12b;let _0x271e34=_0x48ef6a[_0x3239f7];return _0x271e34;},a51_0x3239(_0x5058f5,_0x394eca);}Object[a51_0x382afe(0x167)](exports,a51_0x382afe(0x1ad),{'value':!![]}),exports[a51_0x382afe(0x14e)]=void 0x0;const loggerService_1=require(a51_0x382afe(0x161));class NodaService{constructor(){const _0x47a873=a51_0x382afe;this[_0x47a873(0x1aa)]=_0x47a873(0x1af),console[_0x47a873(0x141)](_0x47a873(0x137));}async[a51_0x382afe(0x197)](_0xd6e8b0){const _0x22faf1=a51_0x382afe,{orderId:_0xb8ade8,name:_0x21e8e8,paymentDescription:_0x464c80,amount:_0x49ff5c,currency:_0x20bdd8,webhookUrl:_0x7875d0,returnUrl:_0x492b1a,expiryDate:_0x30ae50}=_0xd6e8b0,_0x2bb18d=_0x20bdd8[_0x22faf1(0x152)](),_0x24f388=_0x22faf1(0x133),_0x301569='https://tesoft.uk/gateway/pending.php?id='+_0xb8ade8,_0x237518={'name':_0x21e8e8,'paymentDescription':_0x464c80,'amount':_0x49ff5c,'currency':_0x2bb18d,'paymentId':_0xb8ade8,'webhookUrl':_0x24f388,'returnUrl':_0x301569};_0x30ae50&&(_0x237518[_0x22faf1(0x186)]=_0x30ae50);const _0x2311ad=Date[_0x22faf1(0x179)]();try{console['log'](_0x22faf1(0x147)),console[_0x22faf1(0x141)](_0x22faf1(0x181),this['apiUrl']),console[_0x22faf1(0x141)](_0x22faf1(0x153),JSON[_0x22faf1(0x18a)](_0x237518,null,0x2)),console[_0x22faf1(0x141)](_0x22faf1(0x190),_0xb8ade8,_0x22faf1(0x172)),console[_0x22faf1(0x141)](_0x22faf1(0x170),_0x301569),loggerService_1[_0x22faf1(0x174)][_0x22faf1(0x13e)]('noda','/payment-links',_0x22faf1(0x16e),_0x237518);const _0x4efda1=await fetch(this[_0x22faf1(0x1aa)],{'method':'POST','headers':{'Content-Type':_0x22faf1(0x16a),'Accept':_0x22faf1(0x16a),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x22faf1(0x18a)](_0x237518)}),_0x140f93=Date[_0x22faf1(0x179)]()-_0x2311ad;console[_0x22faf1(0x141)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x22faf1(0x141)]('Status:',_0x4efda1['status']),console['log'](_0x22faf1(0x18e),_0x4efda1[_0x22faf1(0x13f)]),console['log'](_0x22faf1(0x1a0),Object[_0x22faf1(0x146)](_0x4efda1[_0x22faf1(0x1a7)][_0x22faf1(0x17d)]())),console['log'](_0x22faf1(0x160),_0x140f93+'ms');const _0x5c5c6b=await _0x4efda1[_0x22faf1(0x1ab)]();console[_0x22faf1(0x141)](_0x22faf1(0x154),_0x5c5c6b);if(!_0x4efda1['ok']){console[_0x22faf1(0x180)](_0x22faf1(0x192)),console[_0x22faf1(0x180)](_0x22faf1(0x189),_0x4efda1['status']),console[_0x22faf1(0x180)](_0x22faf1(0x12c),_0x5c5c6b),loggerService_1[_0x22faf1(0x174)][_0x22faf1(0x183)](_0x22faf1(0x15c),_0x22faf1(0x18d),_0x4efda1['status'],_0x5c5c6b,_0x140f93),loggerService_1[_0x22faf1(0x174)][_0x22faf1(0x143)](_0x22faf1(0x15c),_0x22faf1(0x18d),'HTTP\x20'+_0x4efda1[_0x22faf1(0x199)]+':\x20'+_0x5c5c6b);if(_0x4efda1[_0x22faf1(0x199)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x4efda1[_0x22faf1(0x199)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x22faf1(0x1ae)+_0x4efda1[_0x22faf1(0x199)]+_0x22faf1(0x13d)+_0x5c5c6b);}let _0xa29c7a;try{_0xa29c7a=JSON[_0x22faf1(0x187)](_0x5c5c6b);}catch(_0x2126a5){console[_0x22faf1(0x180)](_0x22faf1(0x149),_0x2126a5),loggerService_1[_0x22faf1(0x174)][_0x22faf1(0x143)](_0x22faf1(0x15c),_0x22faf1(0x18d),_0x22faf1(0x18b)+_0x2126a5);throw new Error(_0x22faf1(0x14f)+_0x5c5c6b);}console['log'](_0x22faf1(0x188)),console['log']('Parsed\x20Result:',JSON['stringify'](_0xa29c7a,null,0x2)),loggerService_1[_0x22faf1(0x174)]['logWhiteDomainResponse'](_0x22faf1(0x15c),'/payment-links',_0x4efda1[_0x22faf1(0x199)],_0xa29c7a,_0x140f93);if(_0xa29c7a[_0x22faf1(0x180)]||_0xa29c7a[_0x22faf1(0x17b)]){const _0x1292d7=_0xa29c7a[_0x22faf1(0x1a4)]||_0xa29c7a[_0x22faf1(0x180)]||_0x22faf1(0x145);console[_0x22faf1(0x180)](_0x22faf1(0x1a6)),console['error'](_0x22faf1(0x150),_0x1292d7),console[_0x22faf1(0x180)](_0x22faf1(0x19f),_0xa29c7a['statusCode']),loggerService_1['loggerService'][_0x22faf1(0x143)](_0x22faf1(0x15c),'/payment-links',_0x22faf1(0x185)+_0x1292d7);throw new Error(_0x22faf1(0x158)+_0x1292d7);}if(!_0xa29c7a['id']||!_0xa29c7a[_0x22faf1(0x12b)]?.['shortLink']){console[_0x22faf1(0x180)](_0x22faf1(0x134)),console[_0x22faf1(0x180)](_0x22faf1(0x17a)),console[_0x22faf1(0x180)](_0x22faf1(0x144),_0xa29c7a),loggerService_1[_0x22faf1(0x174)][_0x22faf1(0x143)](_0x22faf1(0x15c),_0x22faf1(0x18d),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x22faf1(0x1a1));}return console[_0x22faf1(0x141)](_0x22faf1(0x175)),console[_0x22faf1(0x141)](_0x22faf1(0x151),_0xa29c7a['id']),console['log'](_0x22faf1(0x13a),_0xa29c7a[_0x22faf1(0x12b)][_0x22faf1(0x14d)]),console['log'](_0x22faf1(0x15b),_0xa29c7a[_0x22faf1(0x12b)][_0x22faf1(0x16f)]||_0x22faf1(0x19b)),console[_0x22faf1(0x141)](_0x22faf1(0x16b),_0xb8ade8,_0x22faf1(0x12d)),console[_0x22faf1(0x141)](_0x22faf1(0x13b),_0x301569),{'gateway_payment_id':_0xa29c7a['id'],'payment_url':_0xa29c7a[_0x22faf1(0x12b)]['shortLink'],'qr_code_url':_0xa29c7a['shortLinkUrls'][_0x22faf1(0x16f)],'expiry_date':_0xa29c7a[_0x22faf1(0x186)]};}catch(_0x3aa5d1){console[_0x22faf1(0x180)](_0x22faf1(0x138)),console['error'](_0x22faf1(0x177),_0x3aa5d1),loggerService_1[_0x22faf1(0x174)][_0x22faf1(0x143)]('noda','/payment-links',_0x3aa5d1);if(_0x3aa5d1 instanceof Error){console[_0x22faf1(0x180)](_0x22faf1(0x164),_0x3aa5d1[_0x22faf1(0x1a4)]),console[_0x22faf1(0x180)](_0x22faf1(0x159),_0x3aa5d1[_0x22faf1(0x191)]);throw new Error(_0x22faf1(0x1ac)+_0x3aa5d1[_0x22faf1(0x1a4)]);}throw new Error(_0x22faf1(0x15d));}}async[a51_0x382afe(0x140)](_0x1c2482){const _0x57fbca=a51_0x382afe,_0x2efd21=Date[_0x57fbca(0x179)]();try{loggerService_1[_0x57fbca(0x174)][_0x57fbca(0x13e)](_0x57fbca(0x15c),_0x57fbca(0x1a9)+_0x1c2482,_0x57fbca(0x14a),{});const _0x49b152=await fetch(this['apiUrl']+'/'+_0x1c2482,{'method':_0x57fbca(0x14a),'headers':{'Content-Type':_0x57fbca(0x16a),'User-Agent':_0x57fbca(0x1a8)}}),_0x4f6c72=Date[_0x57fbca(0x179)]()-_0x2efd21;if(!_0x49b152['ok']){const _0x3f4d00=await _0x49b152[_0x57fbca(0x1ab)]();loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0x57fbca(0x1a9)+_0x1c2482,_0x49b152[_0x57fbca(0x199)],_0x3f4d00,_0x4f6c72);throw new Error('HTTP\x20error!\x20status:\x20'+_0x49b152[_0x57fbca(0x199)]);}const _0xc6e6d=await _0x49b152[_0x57fbca(0x132)]();loggerService_1[_0x57fbca(0x174)][_0x57fbca(0x183)]('noda',_0x57fbca(0x1a9)+_0x1c2482,_0x49b152['status'],_0xc6e6d,_0x4f6c72);if(_0xc6e6d[_0x57fbca(0x180)]||_0xc6e6d['statusCode']){loggerService_1[_0x57fbca(0x174)][_0x57fbca(0x143)]('noda','/payment-links/'+_0x1c2482,_0x57fbca(0x158)+(_0xc6e6d[_0x57fbca(0x1a4)]||_0xc6e6d[_0x57fbca(0x180)]||'Unknown\x20error'));throw new Error(_0x57fbca(0x158)+(_0xc6e6d[_0x57fbca(0x1a4)]||_0xc6e6d[_0x57fbca(0x180)]||_0x57fbca(0x13c)));}let _0x5232a1=_0x57fbca(0x15e);if(_0xc6e6d[_0x57fbca(0x18f)]===![]){if(_0xc6e6d['expiryDate']){const _0x33c2cf=new Date(_0xc6e6d[_0x57fbca(0x186)]),_0x169c85=new Date();_0x33c2cf<_0x169c85?_0x5232a1=_0x57fbca(0x169):_0x5232a1=_0x57fbca(0x198);}else _0x5232a1=_0x57fbca(0x198);}else _0x5232a1=_0x57fbca(0x15e);return{'status':_0x5232a1,'amount':_0xc6e6d[_0x57fbca(0x19d)],'currency':_0xc6e6d[_0x57fbca(0x1a5)],'isActive':_0xc6e6d[_0x57fbca(0x18f)]};}catch(_0x132a8c){console[_0x57fbca(0x180)](_0x57fbca(0x196),_0x132a8c),loggerService_1[_0x57fbca(0x174)][_0x57fbca(0x143)]('noda',_0x57fbca(0x1a9)+_0x1c2482,_0x132a8c);throw new Error(_0x57fbca(0x176)+(_0x132a8c instanceof Error?_0x132a8c[_0x57fbca(0x1a4)]:_0x57fbca(0x13c)));}}async[a51_0x382afe(0x142)](_0x4f7b07){const _0xdaefbd=a51_0x382afe;console[_0xdaefbd(0x141)](_0xdaefbd(0x136),_0x4f7b07);let _0x4fca8f=_0xdaefbd(0x15e);switch(_0x4f7b07[_0xdaefbd(0x135)]?.['toLowerCase']()){case'done':case'completed':case _0xdaefbd(0x155):case'success':case _0xdaefbd(0x173):_0x4f7b07['Settled']===_0xdaefbd(0x12f)?_0x4fca8f=_0xdaefbd(0x16c):_0x4fca8f=_0xdaefbd(0x15e);break;case _0xdaefbd(0x165):case'canceled':case'failed':case _0xdaefbd(0x180):case _0xdaefbd(0x1a2):_0x4fca8f=_0xdaefbd(0x198);break;case _0xdaefbd(0x184):case _0xdaefbd(0x166):_0x4fca8f='EXPIRED';break;case _0xdaefbd(0x171):case'created':case _0xdaefbd(0x148):case _0xdaefbd(0x19c):case _0xdaefbd(0x19e):default:_0x4fca8f='PENDING';break;}return{'paymentId':_0x4f7b07[_0xdaefbd(0x163)]||_0x4f7b07['PaymentId'],'status':_0x4fca8f,'amount':_0x4f7b07[_0xdaefbd(0x131)],'currency':_0x4f7b07[_0xdaefbd(0x194)],'additionalInfo':{'method':_0x4f7b07[_0xdaefbd(0x130)],'bankId':_0x4f7b07[_0xdaefbd(0x139)],'settled':_0x4f7b07[_0xdaefbd(0x157)],'settlementDate':_0x4f7b07[_0xdaefbd(0x156)],'remitterName':_0x4f7b07['Remitter']?.[_0xdaefbd(0x178)],'remitterIban':_0x4f7b07[_0xdaefbd(0x12e)]?.[_0xdaefbd(0x195)],'bankTransactionId':_0x4f7b07[_0xdaefbd(0x16d)]}};}[a51_0x382afe(0x14b)](_0x2e33e0,_0xfe47cf){const _0x389681=a51_0x382afe;return console[_0x389681(0x141)](_0x389681(0x15f),{'receivedSignature':_0xfe47cf,'paymentId':_0x2e33e0[_0x389681(0x17c)],'merchantPaymentId':_0x2e33e0[_0x389681(0x163)]}),!![];}}exports['NodaService']=NodaService;