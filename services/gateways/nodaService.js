'use strict';const a43_0x19ca77=a43_0xef48;(function(_0x3879f7,_0x18c166){const _0x320277=a43_0xef48,_0x5993e0=_0x3879f7();while(!![]){try{const _0x542fb2=parseInt(_0x320277(0x1c9))/0x1*(parseInt(_0x320277(0x164))/0x2)+parseInt(_0x320277(0x166))/0x3*(parseInt(_0x320277(0x198))/0x4)+parseInt(_0x320277(0x183))/0x5+parseInt(_0x320277(0x169))/0x6*(parseInt(_0x320277(0x1b7))/0x7)+-parseInt(_0x320277(0x1d0))/0x8*(-parseInt(_0x320277(0x1c0))/0x9)+parseInt(_0x320277(0x199))/0xa+-parseInt(_0x320277(0x192))/0xb;if(_0x542fb2===_0x18c166)break;else _0x5993e0['push'](_0x5993e0['shift']());}catch(_0x3f4e39){_0x5993e0['push'](_0x5993e0['shift']());}}}(a43_0x5de7,0xba73f));Object[a43_0x19ca77(0x1b3)](exports,a43_0x19ca77(0x1c4),{'value':!![]}),exports[a43_0x19ca77(0x1b2)]=void 0x0;const loggerService_1=require(a43_0x19ca77(0x17f));class NodaService{constructor(){const _0x4785e0=a43_0x19ca77;this[_0x4785e0(0x1bb)]=_0x4785e0(0x176),console[_0x4785e0(0x181)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a43_0x19ca77(0x1a9)](_0x255e5c){const _0x1d2d19=a43_0x19ca77,{orderId:_0x1dc7ab,name:_0x55b37c,paymentDescription:_0x50f18a,amount:_0x189028,currency:_0x47f166,webhookUrl:_0x38d050,returnUrl:_0x4b4890,expiryDate:_0x353241}=_0x255e5c,_0x4d4769=_0x47f166[_0x1d2d19(0x17b)](),_0x538521='https://tesoft.uk/gateway/noda/webhook/',_0xb24c3=_0x1d2d19(0x1b0)+_0x1dc7ab,_0x5c9b51={'name':_0x55b37c,'paymentDescription':_0x50f18a,'amount':_0x189028,'currency':_0x4d4769,'paymentId':_0x1dc7ab,'webhookUrl':_0x538521,'returnUrl':_0xb24c3};_0x353241&&(_0x5c9b51[_0x1d2d19(0x1c2)]=_0x353241);const _0x4a734b=Date[_0x1d2d19(0x172)]();try{console[_0x1d2d19(0x181)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console['log'](_0x1d2d19(0x187),this[_0x1d2d19(0x1bb)]),console['log'](_0x1d2d19(0x18c),JSON[_0x1d2d19(0x1b9)](_0x5c9b51,null,0x2)),console['log'](_0x1d2d19(0x17c),_0x1dc7ab,_0x1d2d19(0x1d1)),console['log'](_0x1d2d19(0x1be),_0xb24c3),loggerService_1[_0x1d2d19(0x179)][_0x1d2d19(0x193)](_0x1d2d19(0x188),_0x1d2d19(0x1bf),_0x1d2d19(0x17a),_0x5c9b51);const _0x196ea0=await fetch(this[_0x1d2d19(0x1bb)],{'method':_0x1d2d19(0x17a),'headers':{'Content-Type':_0x1d2d19(0x1c5),'Accept':_0x1d2d19(0x1c5),'User-Agent':_0x1d2d19(0x1c8)},'body':JSON['stringify'](_0x5c9b51)}),_0x233984=Date[_0x1d2d19(0x172)]()-_0x4a734b;console[_0x1d2d19(0x181)](_0x1d2d19(0x191)),console['log']('Status:',_0x196ea0['status']),console['log'](_0x1d2d19(0x1bd),_0x196ea0[_0x1d2d19(0x1b6)]),console[_0x1d2d19(0x181)]('Headers:',Object['fromEntries'](_0x196ea0[_0x1d2d19(0x1a0)]['entries']())),console[_0x1d2d19(0x181)]('Response\x20Time:',_0x233984+'ms');const _0x33abd=await _0x196ea0[_0x1d2d19(0x19a)]();console[_0x1d2d19(0x181)]('Raw\x20Response\x20Body:',_0x33abd);if(!_0x196ea0['ok']){console[_0x1d2d19(0x174)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x1d2d19(0x174)]('HTTP\x20Status:',_0x196ea0[_0x1d2d19(0x1d4)]),console[_0x1d2d19(0x174)](_0x1d2d19(0x1a2),_0x33abd),loggerService_1[_0x1d2d19(0x179)][_0x1d2d19(0x1ae)](_0x1d2d19(0x188),_0x1d2d19(0x1bf),_0x196ea0['status'],_0x33abd,_0x233984),loggerService_1[_0x1d2d19(0x179)][_0x1d2d19(0x1a6)](_0x1d2d19(0x188),_0x1d2d19(0x1bf),_0x1d2d19(0x1cd)+_0x196ea0[_0x1d2d19(0x1d4)]+':\x20'+_0x33abd);if(_0x196ea0[_0x1d2d19(0x1d4)]===0x190)throw new Error(_0x1d2d19(0x186));else{if(_0x196ea0['status']===0x1f4)throw new Error(_0x1d2d19(0x197));}throw new Error(_0x1d2d19(0x1cc)+_0x196ea0['status']+',\x20body:\x20'+_0x33abd);}let _0x614ff7;try{_0x614ff7=JSON[_0x1d2d19(0x18e)](_0x33abd);}catch(_0xd7e049){console[_0x1d2d19(0x174)]('Failed\x20to\x20parse\x20JSON\x20response:',_0xd7e049),loggerService_1[_0x1d2d19(0x179)][_0x1d2d19(0x1a6)](_0x1d2d19(0x188),_0x1d2d19(0x1bf),_0x1d2d19(0x1a8)+_0xd7e049);throw new Error(_0x1d2d19(0x178)+_0x33abd);}console[_0x1d2d19(0x181)](_0x1d2d19(0x194)),console['log'](_0x1d2d19(0x1c3),JSON[_0x1d2d19(0x1b9)](_0x614ff7,null,0x2)),loggerService_1[_0x1d2d19(0x179)][_0x1d2d19(0x1ae)](_0x1d2d19(0x188),_0x1d2d19(0x1bf),_0x196ea0[_0x1d2d19(0x1d4)],_0x614ff7,_0x233984);if(_0x614ff7[_0x1d2d19(0x174)]||_0x614ff7[_0x1d2d19(0x1a3)]){const _0x68a634=_0x614ff7['message']||_0x614ff7['error']||_0x1d2d19(0x19e);console[_0x1d2d19(0x174)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x1d2d19(0x174)](_0x1d2d19(0x173),_0x68a634),console['error'](_0x1d2d19(0x1a4),_0x614ff7[_0x1d2d19(0x1a3)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x1d2d19(0x188),_0x1d2d19(0x1bf),'Business\x20Error:\x20'+_0x68a634);throw new Error(_0x1d2d19(0x161)+_0x68a634);}if(!_0x614ff7['id']||!_0x614ff7[_0x1d2d19(0x16c)]?.[_0x1d2d19(0x19c)]){console[_0x1d2d19(0x174)](_0x1d2d19(0x17d)),console['error'](_0x1d2d19(0x1af)),console[_0x1d2d19(0x174)](_0x1d2d19(0x18b),_0x614ff7),loggerService_1[_0x1d2d19(0x179)]['logWhiteDomainError'](_0x1d2d19(0x188),_0x1d2d19(0x1bf),_0x1d2d19(0x1c1));throw new Error(_0x1d2d19(0x185));}return console['log'](_0x1d2d19(0x1a7)),console[_0x1d2d19(0x181)](_0x1d2d19(0x1b4),_0x614ff7['id']),console['log'](_0x1d2d19(0x18d),_0x614ff7['shortLinkUrls'][_0x1d2d19(0x19c)]),console['log']('QR\x20Code\x20Link:',_0x614ff7[_0x1d2d19(0x16c)][_0x1d2d19(0x170)]||_0x1d2d19(0x19b)),console[_0x1d2d19(0x181)](_0x1d2d19(0x17e),_0x1dc7ab,_0x1d2d19(0x1b1)),console[_0x1d2d19(0x181)](_0x1d2d19(0x175),_0xb24c3),{'gateway_payment_id':_0x614ff7['id'],'payment_url':_0x614ff7[_0x1d2d19(0x16c)]['shortLink'],'qr_code_url':_0x614ff7[_0x1d2d19(0x16c)][_0x1d2d19(0x170)],'expiry_date':_0x614ff7[_0x1d2d19(0x1c2)]};}catch(_0x166cd4){console[_0x1d2d19(0x174)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console['error'](_0x1d2d19(0x1d5),_0x166cd4),loggerService_1['loggerService'][_0x1d2d19(0x1a6)](_0x1d2d19(0x188),_0x1d2d19(0x1bf),_0x166cd4);if(_0x166cd4 instanceof Error){console[_0x1d2d19(0x174)](_0x1d2d19(0x195),_0x166cd4[_0x1d2d19(0x16a)]),console[_0x1d2d19(0x174)](_0x1d2d19(0x189),_0x166cd4[_0x1d2d19(0x16b)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x166cd4[_0x1d2d19(0x16a)]);}throw new Error(_0x1d2d19(0x1c6));}}async[a43_0x19ca77(0x196)](_0x424451){const _0x53e3e8=a43_0x19ca77,_0x57a081=Date[_0x53e3e8(0x172)]();try{loggerService_1[_0x53e3e8(0x179)][_0x53e3e8(0x193)](_0x53e3e8(0x188),_0x53e3e8(0x1bc)+_0x424451,_0x53e3e8(0x1b8),{});const _0x2117d6=await fetch(this[_0x53e3e8(0x1bb)]+'/'+_0x424451,{'method':_0x53e3e8(0x1b8),'headers':{'Content-Type':'application/json','User-Agent':_0x53e3e8(0x1c8)}}),_0x3f217c=Date[_0x53e3e8(0x172)]()-_0x57a081;if(!_0x2117d6['ok']){const _0x1ff15f=await _0x2117d6[_0x53e3e8(0x19a)]();loggerService_1['loggerService'][_0x53e3e8(0x1ae)](_0x53e3e8(0x188),_0x53e3e8(0x1bc)+_0x424451,_0x2117d6[_0x53e3e8(0x1d4)],_0x1ff15f,_0x3f217c);throw new Error(_0x53e3e8(0x1cc)+_0x2117d6['status']);}const _0x516f4f=await _0x2117d6['json']();loggerService_1['loggerService'][_0x53e3e8(0x1ae)](_0x53e3e8(0x188),_0x53e3e8(0x1bc)+_0x424451,_0x2117d6[_0x53e3e8(0x1d4)],_0x516f4f,_0x3f217c);if(_0x516f4f[_0x53e3e8(0x174)]||_0x516f4f[_0x53e3e8(0x1a3)]){loggerService_1['loggerService'][_0x53e3e8(0x1a6)](_0x53e3e8(0x188),_0x53e3e8(0x1bc)+_0x424451,'Noda\x20API\x20error:\x20'+(_0x516f4f[_0x53e3e8(0x16a)]||_0x516f4f['error']||_0x53e3e8(0x163)));throw new Error(_0x53e3e8(0x161)+(_0x516f4f['message']||_0x516f4f[_0x53e3e8(0x174)]||'Unknown\x20error'));}let _0x22e984=_0x53e3e8(0x1c7);if(_0x516f4f[_0x53e3e8(0x19f)]===![]){if(_0x516f4f[_0x53e3e8(0x1c2)]){const _0x468d19=new Date(_0x516f4f['expiryDate']),_0x347db1=new Date();_0x468d19<_0x347db1?_0x22e984=_0x53e3e8(0x1cf):_0x22e984=_0x53e3e8(0x1ba);}else _0x22e984=_0x53e3e8(0x1ba);}else _0x22e984='PENDING';return{'status':_0x22e984,'amount':_0x516f4f[_0x53e3e8(0x18f)],'currency':_0x516f4f[_0x53e3e8(0x16d)],'isActive':_0x516f4f[_0x53e3e8(0x19f)]};}catch(_0x5f3b06){console['error'](_0x53e3e8(0x1cb),_0x5f3b06),loggerService_1['loggerService'][_0x53e3e8(0x1a6)](_0x53e3e8(0x188),'/payment-links/'+_0x424451,_0x5f3b06);throw new Error(_0x53e3e8(0x168)+(_0x5f3b06 instanceof Error?_0x5f3b06[_0x53e3e8(0x16a)]:'Unknown\x20error'));}}async['processWebhook'](_0x577e4b){const _0x3cf9cf=a43_0x19ca77;console['log'](_0x3cf9cf(0x1ca),_0x577e4b);let _0x1cba4e='PENDING';switch(_0x577e4b['Status']?.[_0x3cf9cf(0x1ac)]()){case _0x3cf9cf(0x1d2):case _0x3cf9cf(0x1ce):case'paid':case _0x3cf9cf(0x177):case _0x3cf9cf(0x190):_0x577e4b[_0x3cf9cf(0x19d)]===_0x3cf9cf(0x1aa)?_0x1cba4e='PAID':_0x1cba4e=_0x3cf9cf(0x1c7);break;case'cancelled':case _0x3cf9cf(0x1a5):case _0x3cf9cf(0x162):case _0x3cf9cf(0x174):case'rejected':_0x1cba4e=_0x3cf9cf(0x1ba);break;case'expired':case _0x3cf9cf(0x1a1):_0x1cba4e=_0x3cf9cf(0x1cf);break;case'pending':case'created':case _0x3cf9cf(0x180):case _0x3cf9cf(0x182):case'in_progress':default:_0x1cba4e=_0x3cf9cf(0x1c7);break;}return{'paymentId':_0x577e4b['MerchantPaymentId']||_0x577e4b[_0x3cf9cf(0x16f)],'status':_0x1cba4e,'amount':_0x577e4b[_0x3cf9cf(0x184)],'currency':_0x577e4b[_0x3cf9cf(0x165)],'additionalInfo':{'method':_0x577e4b[_0x3cf9cf(0x18a)],'bankId':_0x577e4b[_0x3cf9cf(0x171)],'settled':_0x577e4b[_0x3cf9cf(0x19d)],'settlementDate':_0x577e4b['SettlementDate'],'remitterName':_0x577e4b[_0x3cf9cf(0x16e)]?.['Name'],'remitterIban':_0x577e4b[_0x3cf9cf(0x16e)]?.[_0x3cf9cf(0x1b5)],'bankTransactionId':_0x577e4b[_0x3cf9cf(0x167)]}};}[a43_0x19ca77(0x1ab)](_0x5f139c,_0xaec417){const _0x36c187=a43_0x19ca77;return console['log'](_0x36c187(0x1d3),{'receivedSignature':_0xaec417,'paymentId':_0x5f139c[_0x36c187(0x16f)],'merchantPaymentId':_0x5f139c[_0x36c187(0x1ad)]}),!![];}}function a43_0x5de7(){const _0xdaeed0=['statusText','42aMTWrh','GET','stringify','FAILED','apiUrl','/payment-links/','Status\x20Text:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','/payment-links','9pkelYY','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','expiryDate','Parsed\x20Result:','__esModule','application/json','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','PENDING','TesSoft\x20Payment\x20System/1.0','1467BvaGez','Processing\x20Noda\x20webhook:','Noda\x20payment\x20verification\x20error:','HTTP\x20error!\x20status:\x20','HTTP\x20','completed','EXPIRED','8525672loQudY','(8digits-8digits\x20format\x20for\x20Noda)','done','Noda\x20webhook\x20signature\x20verification:','status','Error\x20details:','Noda\x20API\x20error:\x20','failed','Unknown\x20error','1374qhveEg','Currency','87fpgXUJ','BankTransactionId','Failed\x20to\x20verify\x20Noda\x20payment:\x20','1251786UYnAKa','message','stack','shortLinkUrls','currency','Remitter','PaymentId','qrCodeLink','BankId','now','Error\x20Message:','error','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','https://tesoft.uk/gateway/noda/','success','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','loggerService','POST','toUpperCase','Order\x20ID\x20Format:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Order\x20ID\x20Used:','../loggerService','active','log','processing','5607625kAEeYm','Amount','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','URL:','noda','Error\x20stack:','Method','Response\x20data:','Request\x20Body\x20(Direct\x20JSON):','Short\x20Link:','parse','amount','successful','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','46329404BQZatF','logWhiteDomainRequest','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Error\x20message:','verifyPayment','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','63160UquHmG','707160RRARMj','text','Not\x20provided','shortLink','Settled','Unknown\x20error\x20from\x20Noda\x20API','isActive','headers','timeout','Response\x20Body:','statusCode','Status\x20Code:','canceled','logWhiteDomainError','===\x20NODA\x20SUCCESS\x20===','JSON\x20Parse\x20Error:\x20','createPaymentLink','Yes','verifyWebhookSignature','toLowerCase','MerchantPaymentId','logWhiteDomainResponse','Missing\x20id\x20or\x20shortLink\x20in\x20response','https://tesoft.uk/gateway/pending.php?id=','(8digits-8digits\x20format)','NodaService','defineProperty','Payment\x20Link\x20ID:','Iban'];a43_0x5de7=function(){return _0xdaeed0;};return a43_0x5de7();}function a43_0xef48(_0x38bcb1,_0x5a4042){const _0x5de750=a43_0x5de7();return a43_0xef48=function(_0xef489f,_0x2ceb55){_0xef489f=_0xef489f-0x161;let _0x3be1c4=_0x5de750[_0xef489f];return _0x3be1c4;},a43_0xef48(_0x38bcb1,_0x5a4042);}exports[a43_0x19ca77(0x1b2)]=NodaService;