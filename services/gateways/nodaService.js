'use strict';const a40_0x84881b=a40_0x2bc7;(function(_0x34c497,_0x273b91){const _0xe57a96=a40_0x2bc7,_0x146601=_0x34c497();while(!![]){try{const _0xcebaa8=-parseInt(_0xe57a96(0x1ef))/0x1*(-parseInt(_0xe57a96(0x1e7))/0x2)+parseInt(_0xe57a96(0x1e6))/0x3+parseInt(_0xe57a96(0x216))/0x4+parseInt(_0xe57a96(0x1d6))/0x5+parseInt(_0xe57a96(0x1f5))/0x6*(-parseInt(_0xe57a96(0x1ee))/0x7)+-parseInt(_0xe57a96(0x1e5))/0x8*(parseInt(_0xe57a96(0x1c9))/0x9)+parseInt(_0xe57a96(0x1c7))/0xa*(-parseInt(_0xe57a96(0x224))/0xb);if(_0xcebaa8===_0x273b91)break;else _0x146601['push'](_0x146601['shift']());}catch(_0x2168c9){_0x146601['push'](_0x146601['shift']());}}}(a40_0x594c,0xeb3fb));function a40_0x594c(){const _0x292ebd=['Not\x20provided','loggerService','HTTP\x20error!\x20status:\x20','Status\x20Text:','toUpperCase','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','timeout','Error\x20Message:','Missing\x20id\x20or\x20shortLink\x20in\x20response','application/json','Noda\x20webhook\x20signature\x20verification:',',\x20body:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','verifyPayment','PENDING','failed','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','https://tesoft.uk/gateway/noda/webhook/','FAILED','GET','parse','processWebhook','POST','Failed\x20to\x20parse\x20JSON\x20response:','4185216QikQfP','Response\x20Body:','headers','MerchantPaymentId','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','stringify','JSON\x20Parse\x20Error:\x20','currency','===\x20NODA\x20SERVICE\x20ERROR\x20===','Status','EXPIRED','Amount','Error\x20details:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','2813789nHamLn','Yes','BankId','Settled','json','createPaymentLink','status','shortLink','text','shortLinkUrls','logWhiteDomainResponse','entries','/payment-links/','fromEntries','successful','https://tesoft.uk/gateway/noda/','paid','HTTP\x20Status:','Noda\x20API\x20error:\x20','logWhiteDomainRequest','Response\x20data:','Unknown\x20error','../loggerService','PaymentId','noda','processing','40APQVFJ','qrCodeLink','657BhTrYD','NodaService','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','logWhiteDomainError','statusText','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','expiryDate','QR\x20Code\x20Link:','__esModule','Status\x20Code:','HTTP\x20','message','===\x20NODA\x20API\x20ERROR\x20===','6752465dMWkEd','statusCode','https://tesoft.uk/gateway/success.php?id=','Error\x20message:','Currency','/payment-links','now','created','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','verifyWebhookSignature','Short\x20Link:','BankTransactionId','Status:','in_progress','Error\x20stack:','69144dKjnxL','3376797QqqphE','44cfYzyn','canceled','Name','error','Unknown\x20error\x20from\x20Noda\x20API','Order\x20ID\x20Used:','apiUrl','8873466zcPjxa','16498CiTlJD','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Business\x20Error:\x20','isActive','log','6XSVjEq','Processing\x20Noda\x20webhook:','Payment\x20Link\x20ID:','stack','amount','(8digits-8digits\x20format\x20for\x20Noda)','done','Remitter','(8digits-8digits\x20format)'];a40_0x594c=function(){return _0x292ebd;};return a40_0x594c();}function a40_0x2bc7(_0x35374d,_0x4548bb){const _0x594cfd=a40_0x594c();return a40_0x2bc7=function(_0x2bc734,_0x666170){_0x2bc734=_0x2bc734-0x1be;let _0x1f6f79=_0x594cfd[_0x2bc734];return _0x1f6f79;},a40_0x2bc7(_0x35374d,_0x4548bb);}Object['defineProperty'](exports,a40_0x84881b(0x1d1),{'value':!![]}),exports[a40_0x84881b(0x1ca)]=void 0x0;const loggerService_1=require(a40_0x84881b(0x1c3));class NodaService{constructor(){const _0x50ce6e=a40_0x84881b;this['apiUrl']=_0x50ce6e(0x233),console[_0x50ce6e(0x1f4)](_0x50ce6e(0x21a));}async[a40_0x84881b(0x229)](_0x2f02f0){const _0xf3ad27=a40_0x84881b,{orderId:_0x24ae41,name:_0x24ef7b,paymentDescription:_0x2a75f6,amount:_0x23d3f6,currency:_0x3ae6d7,webhookUrl:_0xbae945,returnUrl:_0x1d5c0b,expiryDate:_0x49f969}=_0x2f02f0,_0x183116=_0x3ae6d7[_0xf3ad27(0x202)](),_0x2d171a=_0xf3ad27(0x20f),_0x4783d4=_0xf3ad27(0x1d8)+_0x24ae41,_0x538406={'name':_0x24ef7b,'paymentDescription':_0x2a75f6,'amount':_0x23d3f6,'currency':_0x183116,'paymentId':_0x24ae41,'webhookUrl':_0x2d171a,'returnUrl':_0x4783d4};_0x49f969&&(_0x538406['expiryDate']=_0x49f969);const _0x5dd11b=Date[_0xf3ad27(0x1dc)]();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0xf3ad27(0x1f4)]('URL:',this[_0xf3ad27(0x1ed)]),console[_0xf3ad27(0x1f4)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0xf3ad27(0x21b)](_0x538406,null,0x2)),console[_0xf3ad27(0x1f4)]('Order\x20ID\x20Format:',_0x24ae41,_0xf3ad27(0x1fa)),loggerService_1[_0xf3ad27(0x1ff)][_0xf3ad27(0x1c0)](_0xf3ad27(0x1c5),_0xf3ad27(0x1db),'POST',_0x538406);const _0x16a33f=await fetch(this[_0xf3ad27(0x1ed)],{'method':_0xf3ad27(0x214),'headers':{'Content-Type':_0xf3ad27(0x207),'Accept':_0xf3ad27(0x207),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0xf3ad27(0x21b)](_0x538406)}),_0xce2a1e=Date[_0xf3ad27(0x1dc)]()-_0x5dd11b;console['log'](_0xf3ad27(0x1ce)),console[_0xf3ad27(0x1f4)](_0xf3ad27(0x1e2),_0x16a33f[_0xf3ad27(0x22a)]),console['log'](_0xf3ad27(0x201),_0x16a33f[_0xf3ad27(0x1cd)]),console['log']('Headers:',Object[_0xf3ad27(0x231)](_0x16a33f[_0xf3ad27(0x218)][_0xf3ad27(0x22f)]())),console[_0xf3ad27(0x1f4)]('Response\x20Time:',_0xce2a1e+'ms');const _0x3b6eb7=await _0x16a33f[_0xf3ad27(0x22c)]();console[_0xf3ad27(0x1f4)]('Raw\x20Response\x20Body:',_0x3b6eb7);if(!_0x16a33f['ok']){console[_0xf3ad27(0x1ea)](_0xf3ad27(0x1d5)),console[_0xf3ad27(0x1ea)](_0xf3ad27(0x1be),_0x16a33f[_0xf3ad27(0x22a)]),console[_0xf3ad27(0x1ea)](_0xf3ad27(0x217),_0x3b6eb7),loggerService_1[_0xf3ad27(0x1ff)][_0xf3ad27(0x22e)](_0xf3ad27(0x1c5),_0xf3ad27(0x1db),_0x16a33f['status'],_0x3b6eb7,_0xce2a1e),loggerService_1[_0xf3ad27(0x1ff)][_0xf3ad27(0x1cc)](_0xf3ad27(0x1c5),_0xf3ad27(0x1db),_0xf3ad27(0x1d3)+_0x16a33f[_0xf3ad27(0x22a)]+':\x20'+_0x3b6eb7);if(_0x16a33f[_0xf3ad27(0x22a)]===0x190)throw new Error(_0xf3ad27(0x1f1));else{if(_0x16a33f[_0xf3ad27(0x22a)]===0x1f4)throw new Error(_0xf3ad27(0x203));}throw new Error(_0xf3ad27(0x200)+_0x16a33f[_0xf3ad27(0x22a)]+_0xf3ad27(0x209)+_0x3b6eb7);}let _0x597b3d;try{_0x597b3d=JSON[_0xf3ad27(0x212)](_0x3b6eb7);}catch(_0x2506ff){console[_0xf3ad27(0x1ea)](_0xf3ad27(0x215),_0x2506ff),loggerService_1[_0xf3ad27(0x1ff)][_0xf3ad27(0x1cc)](_0xf3ad27(0x1c5),_0xf3ad27(0x1db),_0xf3ad27(0x21c)+_0x2506ff);throw new Error(_0xf3ad27(0x1cb)+_0x3b6eb7);}console['log'](_0xf3ad27(0x223)),console['log']('Parsed\x20Result:',JSON[_0xf3ad27(0x21b)](_0x597b3d,null,0x2)),loggerService_1[_0xf3ad27(0x1ff)][_0xf3ad27(0x22e)](_0xf3ad27(0x1c5),'/payment-links',_0x16a33f[_0xf3ad27(0x22a)],_0x597b3d,_0xce2a1e);if(_0x597b3d[_0xf3ad27(0x1ea)]||_0x597b3d['statusCode']){const _0xbbf8a0=_0x597b3d[_0xf3ad27(0x1d4)]||_0x597b3d['error']||_0xf3ad27(0x1eb);console[_0xf3ad27(0x1ea)](_0xf3ad27(0x20e)),console[_0xf3ad27(0x1ea)](_0xf3ad27(0x205),_0xbbf8a0),console[_0xf3ad27(0x1ea)](_0xf3ad27(0x1d2),_0x597b3d[_0xf3ad27(0x1d7)]),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0xf3ad27(0x1db),_0xf3ad27(0x1f2)+_0xbbf8a0);throw new Error(_0xf3ad27(0x1bf)+_0xbbf8a0);}if(!_0x597b3d['id']||!_0x597b3d['shortLinkUrls']?.[_0xf3ad27(0x22b)]){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0xf3ad27(0x1ea)](_0xf3ad27(0x206)),console['error'](_0xf3ad27(0x1c1),_0x597b3d),loggerService_1[_0xf3ad27(0x1ff)][_0xf3ad27(0x1cc)]('noda',_0xf3ad27(0x1db),_0xf3ad27(0x20a));throw new Error(_0xf3ad27(0x1f0));}return console[_0xf3ad27(0x1f4)]('===\x20NODA\x20SUCCESS\x20==='),console[_0xf3ad27(0x1f4)](_0xf3ad27(0x1f7),_0x597b3d['id']),console[_0xf3ad27(0x1f4)](_0xf3ad27(0x1e0),_0x597b3d['shortLinkUrls'][_0xf3ad27(0x22b)]),console[_0xf3ad27(0x1f4)](_0xf3ad27(0x1d0),_0x597b3d[_0xf3ad27(0x22d)][_0xf3ad27(0x1c8)]||_0xf3ad27(0x1fe)),console[_0xf3ad27(0x1f4)](_0xf3ad27(0x1ec),_0x24ae41,_0xf3ad27(0x1fd)),{'gateway_payment_id':_0x597b3d['id'],'payment_url':_0x597b3d[_0xf3ad27(0x22d)][_0xf3ad27(0x22b)],'qr_code_url':_0x597b3d[_0xf3ad27(0x22d)][_0xf3ad27(0x1c8)],'expiry_date':_0x597b3d[_0xf3ad27(0x1cf)]};}catch(_0xfa45ae){console['error'](_0xf3ad27(0x21e)),console[_0xf3ad27(0x1ea)](_0xf3ad27(0x222),_0xfa45ae),loggerService_1['loggerService']['logWhiteDomainError'](_0xf3ad27(0x1c5),_0xf3ad27(0x1db),_0xfa45ae);if(_0xfa45ae instanceof Error){console[_0xf3ad27(0x1ea)](_0xf3ad27(0x1d9),_0xfa45ae[_0xf3ad27(0x1d4)]),console[_0xf3ad27(0x1ea)](_0xf3ad27(0x1e4),_0xfa45ae[_0xf3ad27(0x1f8)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0xfa45ae[_0xf3ad27(0x1d4)]);}throw new Error(_0xf3ad27(0x1de));}}async[a40_0x84881b(0x20b)](_0x3412d4){const _0x5da303=a40_0x84881b,_0x5ce760=Date[_0x5da303(0x1dc)]();try{loggerService_1[_0x5da303(0x1ff)][_0x5da303(0x1c0)]('noda',_0x5da303(0x230)+_0x3412d4,_0x5da303(0x211),{});const _0x3a53ae=await fetch(this[_0x5da303(0x1ed)]+'/'+_0x3412d4,{'method':_0x5da303(0x211),'headers':{'Content-Type':_0x5da303(0x207),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0xcd6aad=Date[_0x5da303(0x1dc)]()-_0x5ce760;if(!_0x3a53ae['ok']){const _0xfaf623=await _0x3a53ae[_0x5da303(0x22c)]();loggerService_1[_0x5da303(0x1ff)][_0x5da303(0x22e)](_0x5da303(0x1c5),_0x5da303(0x230)+_0x3412d4,_0x3a53ae[_0x5da303(0x22a)],_0xfaf623,_0xcd6aad);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3a53ae['status']);}const _0x28b5d3=await _0x3a53ae[_0x5da303(0x228)]();loggerService_1['loggerService'][_0x5da303(0x22e)](_0x5da303(0x1c5),'/payment-links/'+_0x3412d4,_0x3a53ae['status'],_0x28b5d3,_0xcd6aad);if(_0x28b5d3[_0x5da303(0x1ea)]||_0x28b5d3[_0x5da303(0x1d7)]){loggerService_1[_0x5da303(0x1ff)][_0x5da303(0x1cc)](_0x5da303(0x1c5),_0x5da303(0x230)+_0x3412d4,_0x5da303(0x1bf)+(_0x28b5d3[_0x5da303(0x1d4)]||_0x28b5d3[_0x5da303(0x1ea)]||_0x5da303(0x1c2)));throw new Error(_0x5da303(0x1bf)+(_0x28b5d3[_0x5da303(0x1d4)]||_0x28b5d3[_0x5da303(0x1ea)]||_0x5da303(0x1c2)));}let _0x1415d3=_0x5da303(0x20c);if(_0x28b5d3[_0x5da303(0x1f3)]===![]){if(_0x28b5d3[_0x5da303(0x1cf)]){const _0xff2383=new Date(_0x28b5d3['expiryDate']),_0x1bf15a=new Date();_0xff2383<_0x1bf15a?_0x1415d3='EXPIRED':_0x1415d3=_0x5da303(0x210);}else _0x1415d3=_0x5da303(0x210);}else _0x1415d3=_0x5da303(0x20c);return{'status':_0x1415d3,'amount':_0x28b5d3[_0x5da303(0x1f9)],'currency':_0x28b5d3[_0x5da303(0x21d)],'isActive':_0x28b5d3[_0x5da303(0x1f3)]};}catch(_0xed42be){console[_0x5da303(0x1ea)]('Noda\x20payment\x20verification\x20error:',_0xed42be),loggerService_1[_0x5da303(0x1ff)]['logWhiteDomainError'](_0x5da303(0x1c5),'/payment-links/'+_0x3412d4,_0xed42be);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0xed42be instanceof Error?_0xed42be[_0x5da303(0x1d4)]:_0x5da303(0x1c2)));}}async[a40_0x84881b(0x213)](_0x1bd797){const _0x569e2b=a40_0x84881b;console['log'](_0x569e2b(0x1f6),_0x1bd797);let _0x167246=_0x569e2b(0x20c);switch(_0x1bd797[_0x569e2b(0x21f)]?.['toLowerCase']()){case _0x569e2b(0x1fb):case'completed':case _0x569e2b(0x234):case'success':case _0x569e2b(0x232):_0x1bd797[_0x569e2b(0x227)]===_0x569e2b(0x225)?_0x167246='PAID':_0x167246=_0x569e2b(0x20c);break;case'cancelled':case _0x569e2b(0x1e8):case _0x569e2b(0x20d):case _0x569e2b(0x1ea):case'rejected':_0x167246=_0x569e2b(0x210);break;case'expired':case _0x569e2b(0x204):_0x167246=_0x569e2b(0x220);break;case'pending':case _0x569e2b(0x1dd):case'active':case _0x569e2b(0x1c6):case _0x569e2b(0x1e3):default:_0x167246='PENDING';break;}return{'paymentId':_0x1bd797[_0x569e2b(0x219)]||_0x1bd797[_0x569e2b(0x1c4)],'status':_0x167246,'amount':_0x1bd797[_0x569e2b(0x221)],'currency':_0x1bd797[_0x569e2b(0x1da)],'additionalInfo':{'method':_0x1bd797['Method'],'bankId':_0x1bd797[_0x569e2b(0x226)],'settled':_0x1bd797[_0x569e2b(0x227)],'settlementDate':_0x1bd797['SettlementDate'],'remitterName':_0x1bd797[_0x569e2b(0x1fc)]?.[_0x569e2b(0x1e9)],'remitterIban':_0x1bd797[_0x569e2b(0x1fc)]?.['Iban'],'bankTransactionId':_0x1bd797[_0x569e2b(0x1e1)]}};}[a40_0x84881b(0x1df)](_0x516996,_0x3c2fd2){const _0x3376cc=a40_0x84881b;return console['log'](_0x3376cc(0x208),{'receivedSignature':_0x3c2fd2,'paymentId':_0x516996[_0x3376cc(0x1c4)],'merchantPaymentId':_0x516996[_0x3376cc(0x219)]}),!![];}}exports[a40_0x84881b(0x1ca)]=NodaService;