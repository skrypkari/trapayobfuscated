'use strict';function a71_0x1e7a(_0x2afe50,_0x30ea95){_0x2afe50=_0x2afe50-0x11f;const _0x26e31f=a71_0x26e3();let _0x1e7a18=_0x26e31f[_0x2afe50];return _0x1e7a18;}const a71_0x3358a4=a71_0x1e7a;(function(_0x57e9c6,_0xb88b10){const _0x3ca663=a71_0x1e7a,_0x5497ec=_0x57e9c6();while(!![]){try{const _0x3a38f9=-parseInt(_0x3ca663(0x135))/0x1*(parseInt(_0x3ca663(0x176))/0x2)+-parseInt(_0x3ca663(0x159))/0x3+parseInt(_0x3ca663(0x174))/0x4*(parseInt(_0x3ca663(0x16e))/0x5)+-parseInt(_0x3ca663(0x15c))/0x6*(-parseInt(_0x3ca663(0x152))/0x7)+parseInt(_0x3ca663(0x14e))/0x8*(-parseInt(_0x3ca663(0x130))/0x9)+parseInt(_0x3ca663(0x172))/0xa+parseInt(_0x3ca663(0x148))/0xb*(-parseInt(_0x3ca663(0x189))/0xc);if(_0x3a38f9===_0xb88b10)break;else _0x5497ec['push'](_0x5497ec['shift']());}catch(_0x574f63){_0x5497ec['push'](_0x5497ec['shift']());}}}(a71_0x26e3,0x76395));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a71_0x3358a4(0x161)]=void 0x0;const loggerService_1=require(a71_0x3358a4(0x198));class NodaService{constructor(){const _0x15ac89=a71_0x3358a4;this['apiUrl']=_0x15ac89(0x171),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a71_0x3358a4(0x18c)](_0x136760){const _0x3674d1=a71_0x3358a4,{orderId:_0x3f4add,name:_0x2d70b3,paymentDescription:_0x513437,amount:_0x598413,currency:_0x1a17f2,webhookUrl:_0x3a7960,returnUrl:_0x1f0f73,expiryDate:_0x20c23f}=_0x136760,_0x168e99=_0x1a17f2[_0x3674d1(0x181)](),_0x3286ea=_0x3674d1(0x13c),_0x585e4b=_0x3674d1(0x16f)+_0x3f4add,_0x11d803={'name':_0x2d70b3,'paymentDescription':_0x513437,'amount':_0x598413,'currency':_0x168e99,'paymentId':_0x3f4add,'webhookUrl':_0x3286ea,'returnUrl':_0x585e4b};_0x20c23f&&(_0x11d803[_0x3674d1(0x160)]=_0x20c23f);const _0x5113be=Date[_0x3674d1(0x17a)]();try{console[_0x3674d1(0x16d)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x3674d1(0x16d)](_0x3674d1(0x13d),this[_0x3674d1(0x170)]),console[_0x3674d1(0x16d)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x3674d1(0x151)](_0x11d803,null,0x2)),console[_0x3674d1(0x16d)](_0x3674d1(0x122),_0x3f4add,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x3674d1(0x16d)](_0x3674d1(0x173),_0x585e4b),loggerService_1[_0x3674d1(0x150)][_0x3674d1(0x168)](_0x3674d1(0x138),_0x3674d1(0x15d),'POST',_0x11d803);const _0x3ebeba=await fetch(this[_0x3674d1(0x170)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x3674d1(0x13a),'User-Agent':_0x3674d1(0x196)},'body':JSON['stringify'](_0x11d803)}),_0x2d627d=Date[_0x3674d1(0x17a)]()-_0x5113be;console[_0x3674d1(0x16d)](_0x3674d1(0x17e)),console['log'](_0x3674d1(0x17c),_0x3ebeba['status']),console[_0x3674d1(0x16d)](_0x3674d1(0x185),_0x3ebeba[_0x3674d1(0x177)]),console[_0x3674d1(0x16d)](_0x3674d1(0x154),Object['fromEntries'](_0x3ebeba['headers'][_0x3674d1(0x121)]())),console[_0x3674d1(0x16d)](_0x3674d1(0x139),_0x2d627d+'ms');const _0x47bf44=await _0x3ebeba[_0x3674d1(0x16c)]();console[_0x3674d1(0x16d)](_0x3674d1(0x15f),_0x47bf44);if(!_0x3ebeba['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console['error'](_0x3674d1(0x187),_0x3ebeba[_0x3674d1(0x137)]),console[_0x3674d1(0x124)](_0x3674d1(0x15e),_0x47bf44),loggerService_1[_0x3674d1(0x150)][_0x3674d1(0x14d)](_0x3674d1(0x138),_0x3674d1(0x15d),_0x3ebeba[_0x3674d1(0x137)],_0x47bf44,_0x2d627d),loggerService_1[_0x3674d1(0x150)][_0x3674d1(0x15a)]('noda','/payment-links',_0x3674d1(0x184)+_0x3ebeba[_0x3674d1(0x137)]+':\x20'+_0x47bf44);if(_0x3ebeba[_0x3674d1(0x137)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x3ebeba['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x3674d1(0x125)+_0x3ebeba[_0x3674d1(0x137)]+_0x3674d1(0x17d)+_0x47bf44);}let _0x1f2b1c;try{_0x1f2b1c=JSON['parse'](_0x47bf44);}catch(_0x3f7444){console[_0x3674d1(0x124)](_0x3674d1(0x17b),_0x3f7444),loggerService_1[_0x3674d1(0x150)][_0x3674d1(0x15a)]('noda','/payment-links','JSON\x20Parse\x20Error:\x20'+_0x3f7444);throw new Error(_0x3674d1(0x141)+_0x47bf44);}console[_0x3674d1(0x16d)](_0x3674d1(0x193)),console[_0x3674d1(0x16d)]('Parsed\x20Result:',JSON[_0x3674d1(0x151)](_0x1f2b1c,null,0x2)),loggerService_1[_0x3674d1(0x150)]['logWhiteDomainResponse']('noda',_0x3674d1(0x15d),_0x3ebeba[_0x3674d1(0x137)],_0x1f2b1c,_0x2d627d);if(_0x1f2b1c['error']||_0x1f2b1c[_0x3674d1(0x16b)]){const _0x2b8df3=_0x1f2b1c[_0x3674d1(0x126)]||_0x1f2b1c[_0x3674d1(0x124)]||_0x3674d1(0x123);console[_0x3674d1(0x124)](_0x3674d1(0x145)),console[_0x3674d1(0x124)]('Error\x20Message:',_0x2b8df3),console['error'](_0x3674d1(0x197),_0x1f2b1c[_0x3674d1(0x16b)]),loggerService_1[_0x3674d1(0x150)][_0x3674d1(0x15a)](_0x3674d1(0x138),_0x3674d1(0x15d),_0x3674d1(0x186)+_0x2b8df3);throw new Error('Noda\x20API\x20error:\x20'+_0x2b8df3);}if(!_0x1f2b1c['id']||!_0x1f2b1c['shortLinkUrls']?.['shortLink']){console[_0x3674d1(0x124)](_0x3674d1(0x165)),console['error'](_0x3674d1(0x194)),console[_0x3674d1(0x124)](_0x3674d1(0x140),_0x1f2b1c),loggerService_1[_0x3674d1(0x150)]['logWhiteDomainError'](_0x3674d1(0x138),_0x3674d1(0x15d),_0x3674d1(0x12a));throw new Error(_0x3674d1(0x188));}return console[_0x3674d1(0x16d)](_0x3674d1(0x18e)),console[_0x3674d1(0x16d)](_0x3674d1(0x16a),_0x1f2b1c['id']),console[_0x3674d1(0x16d)](_0x3674d1(0x14b),_0x1f2b1c[_0x3674d1(0x142)][_0x3674d1(0x149)]),console[_0x3674d1(0x16d)](_0x3674d1(0x167),_0x1f2b1c[_0x3674d1(0x142)][_0x3674d1(0x11f)]||_0x3674d1(0x13e)),console[_0x3674d1(0x16d)](_0x3674d1(0x12b),_0x3f4add,_0x3674d1(0x144)),console[_0x3674d1(0x16d)](_0x3674d1(0x143),_0x585e4b),{'gateway_payment_id':_0x1f2b1c['id'],'payment_url':_0x1f2b1c['shortLinkUrls']['shortLink'],'qr_code_url':_0x1f2b1c['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x1f2b1c[_0x3674d1(0x160)]};}catch(_0x38694b){console[_0x3674d1(0x124)](_0x3674d1(0x195)),console[_0x3674d1(0x124)](_0x3674d1(0x13f),_0x38694b),loggerService_1[_0x3674d1(0x150)][_0x3674d1(0x15a)](_0x3674d1(0x138),_0x3674d1(0x15d),_0x38694b);if(_0x38694b instanceof Error){console[_0x3674d1(0x124)]('Error\x20message:',_0x38694b[_0x3674d1(0x126)]),console[_0x3674d1(0x124)](_0x3674d1(0x134),_0x38694b[_0x3674d1(0x18a)]);throw new Error(_0x3674d1(0x12c)+_0x38694b[_0x3674d1(0x126)]);}throw new Error(_0x3674d1(0x157));}}async[a71_0x3358a4(0x147)](_0x265aff){const _0x300500=a71_0x3358a4,_0x259e80=Date['now']();try{loggerService_1[_0x300500(0x150)][_0x300500(0x168)](_0x300500(0x138),_0x300500(0x12f)+_0x265aff,'GET',{});const _0x1ba1f8=await fetch(this['apiUrl']+'/'+_0x265aff,{'method':'GET','headers':{'Content-Type':_0x300500(0x13a),'User-Agent':_0x300500(0x196)}}),_0xb19763=Date[_0x300500(0x17a)]()-_0x259e80;if(!_0x1ba1f8['ok']){const _0x3c2c77=await _0x1ba1f8[_0x300500(0x16c)]();loggerService_1[_0x300500(0x150)][_0x300500(0x14d)](_0x300500(0x138),_0x300500(0x12f)+_0x265aff,_0x1ba1f8[_0x300500(0x137)],_0x3c2c77,_0xb19763);throw new Error(_0x300500(0x125)+_0x1ba1f8[_0x300500(0x137)]);}const _0x13f824=await _0x1ba1f8[_0x300500(0x156)]();loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0x300500(0x12f)+_0x265aff,_0x1ba1f8['status'],_0x13f824,_0xb19763);if(_0x13f824[_0x300500(0x124)]||_0x13f824[_0x300500(0x16b)]){loggerService_1['loggerService'][_0x300500(0x15a)](_0x300500(0x138),'/payment-links/'+_0x265aff,_0x300500(0x129)+(_0x13f824[_0x300500(0x126)]||_0x13f824[_0x300500(0x124)]||_0x300500(0x175)));throw new Error(_0x300500(0x129)+(_0x13f824[_0x300500(0x126)]||_0x13f824[_0x300500(0x124)]||'Unknown\x20error'));}let _0x1fc98c=_0x300500(0x133);if(_0x13f824[_0x300500(0x183)]===![]){if(_0x13f824[_0x300500(0x160)]){const _0x13a4f1=new Date(_0x13f824[_0x300500(0x160)]),_0x3b9a0f=new Date();_0x13a4f1<_0x3b9a0f?_0x1fc98c=_0x300500(0x14c):_0x1fc98c=_0x300500(0x120);}else _0x1fc98c=_0x300500(0x120);}else _0x1fc98c=_0x300500(0x133);return{'status':_0x1fc98c,'amount':_0x13f824[_0x300500(0x158)],'currency':_0x13f824['currency'],'isActive':_0x13f824[_0x300500(0x183)]};}catch(_0x2b9b6f){console[_0x300500(0x124)]('Noda\x20payment\x20verification\x20error:',_0x2b9b6f),loggerService_1[_0x300500(0x150)][_0x300500(0x15a)]('noda','/payment-links/'+_0x265aff,_0x2b9b6f);throw new Error(_0x300500(0x13b)+(_0x2b9b6f instanceof Error?_0x2b9b6f[_0x300500(0x126)]:'Unknown\x20error'));}}async[a71_0x3358a4(0x192)](_0x40d176){const _0x3e2b5a=a71_0x3358a4;console['log'](_0x3e2b5a(0x163),_0x40d176);let _0x3cc1bb=_0x3e2b5a(0x133);switch(_0x40d176[_0x3e2b5a(0x17f)]?.[_0x3e2b5a(0x128)]()){case _0x3e2b5a(0x12d):case _0x3e2b5a(0x191):case _0x3e2b5a(0x169):case'success':case _0x3e2b5a(0x199):_0x40d176[_0x3e2b5a(0x179)]==='Yes'?_0x3cc1bb='PAID':_0x3cc1bb='PENDING';break;case _0x3e2b5a(0x164):case _0x3e2b5a(0x190):case'failed':case _0x3e2b5a(0x124):case'rejected':_0x3cc1bb=_0x3e2b5a(0x120);break;case _0x3e2b5a(0x127):case _0x3e2b5a(0x12e):_0x3cc1bb='EXPIRED';break;case _0x3e2b5a(0x15b):case _0x3e2b5a(0x162):case _0x3e2b5a(0x18f):case _0x3e2b5a(0x131):case'in_progress':default:_0x3cc1bb=_0x3e2b5a(0x133);break;}return{'paymentId':_0x40d176['MerchantPaymentId']||_0x40d176['PaymentId'],'status':_0x3cc1bb,'amount':_0x40d176[_0x3e2b5a(0x182)],'currency':_0x40d176[_0x3e2b5a(0x14a)],'additionalInfo':{'method':_0x40d176[_0x3e2b5a(0x178)],'bankId':_0x40d176[_0x3e2b5a(0x180)],'settled':_0x40d176[_0x3e2b5a(0x179)],'settlementDate':_0x40d176[_0x3e2b5a(0x18b)],'remitterName':_0x40d176[_0x3e2b5a(0x153)]?.[_0x3e2b5a(0x146)],'remitterIban':_0x40d176[_0x3e2b5a(0x153)]?.[_0x3e2b5a(0x166)],'bankTransactionId':_0x40d176[_0x3e2b5a(0x14f)]}};}[a71_0x3358a4(0x136)](_0x1aa470,_0x400f32){const _0x2ab139=a71_0x3358a4;return console['log'](_0x2ab139(0x155),{'receivedSignature':_0x400f32,'paymentId':_0x1aa470[_0x2ab139(0x132)],'merchantPaymentId':_0x1aa470[_0x2ab139(0x18d)]}),!![];}}exports[a71_0x3358a4(0x161)]=NodaService;function a71_0x26e3(){const _0x32e87e=['1vthAdg','verifyWebhookSignature','status','noda','Response\x20Time:','application/json','Failed\x20to\x20verify\x20Noda\x20payment:\x20','https://tesoft.uk/gateway/noda/webhook/','URL:','Not\x20provided','Error\x20details:','Response\x20data:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','shortLinkUrls','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','(8digits-8digits\x20format)','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Name','verifyPayment','33mupoxH','shortLink','Currency','Short\x20Link:','EXPIRED','logWhiteDomainResponse','8qfczOV','BankTransactionId','loggerService','stringify','855449BdOddu','Remitter','Headers:','Noda\x20webhook\x20signature\x20verification:','json','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','amount','399642iXXdcv','logWhiteDomainError','pending','30vKCoca','/payment-links','Response\x20Body:','Raw\x20Response\x20Body:','expiryDate','NodaService','created','Processing\x20Noda\x20webhook:','cancelled','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Iban','QR\x20Code\x20Link:','logWhiteDomainRequest','paid','Payment\x20Link\x20ID:','statusCode','text','log','25805GYMkBl','https://tesoft.uk/gateway/pending.php?id=','apiUrl','https://tesoft.uk/gateway/noda/','4411900wlkxep','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','584aGxlJx','Unknown\x20error','1156420HwIXhv','statusText','Method','Settled','now','Failed\x20to\x20parse\x20JSON\x20response:','Status:',',\x20body:\x20','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status','BankId','toUpperCase','Amount','isActive','HTTP\x20','Status\x20Text:','Business\x20Error:\x20','HTTP\x20Status:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','2315556IxqKvX','stack','SettlementDate','createPaymentLink','MerchantPaymentId','===\x20NODA\x20SUCCESS\x20===','active','canceled','completed','processWebhook','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Missing\x20id\x20or\x20shortLink\x20in\x20response','===\x20NODA\x20SERVICE\x20ERROR\x20===','Payment\x20System/1.0','Status\x20Code:','../loggerService','successful','qrCodeLink','FAILED','entries','Order\x20ID\x20Format:','Unknown\x20error\x20from\x20Noda\x20API','error','HTTP\x20error!\x20status:\x20','message','expired','toLowerCase','Noda\x20API\x20error:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Order\x20ID\x20Used:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','done','timeout','/payment-links/','280557rDbARy','processing','PaymentId','PENDING','Error\x20stack:'];a71_0x26e3=function(){return _0x32e87e;};return a71_0x26e3();}