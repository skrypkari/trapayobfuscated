'use strict';const a43_0x4ecdb6=a43_0x350a;(function(_0x1fdca2,_0x4cc32b){const _0x30c006=a43_0x350a,_0x267870=_0x1fdca2();while(!![]){try{const _0x22235e=-parseInt(_0x30c006(0xbc))/0x1*(parseInt(_0x30c006(0xf3))/0x2)+-parseInt(_0x30c006(0xf7))/0x3+-parseInt(_0x30c006(0x106))/0x4*(parseInt(_0x30c006(0xd8))/0x5)+-parseInt(_0x30c006(0xe7))/0x6+-parseInt(_0x30c006(0xc3))/0x7*(parseInt(_0x30c006(0xca))/0x8)+parseInt(_0x30c006(0x115))/0x9+-parseInt(_0x30c006(0xe9))/0xa*(-parseInt(_0x30c006(0x12e))/0xb);if(_0x22235e===_0x4cc32b)break;else _0x267870['push'](_0x267870['shift']());}catch(_0x1df754){_0x267870['push'](_0x267870['shift']());}}}(a43_0xbff8,0x4628c));Object[a43_0x4ecdb6(0xd5)](exports,a43_0x4ecdb6(0x11f),{'value':!![]}),exports[a43_0x4ecdb6(0xd3)]=void 0x0;const loggerService_1=require(a43_0x4ecdb6(0x107));function a43_0x350a(_0x591999,_0x549865){const _0xbff82e=a43_0xbff8();return a43_0x350a=function(_0x350a59,_0x480ae6){_0x350a59=_0x350a59-0xb2;let _0x43c802=_0xbff82e[_0x350a59];return _0x43c802;},a43_0x350a(_0x591999,_0x549865);}function a43_0xbff8(){const _0x10c4fc=['createPaymentLink','14440mupLfK','qrCodeLink','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','logWhiteDomainRequest','Response\x20Body:','Method','Status','TesSoft\x20Payment\x20System/1.0','statusText','QR\x20Code\x20Link:','228gpSUDj','Noda\x20payment\x20verification\x20error:','verifyPayment','===\x20NODA\x20API\x20ERROR\x20===','1366659pVAHmT','Failed\x20to\x20verify\x20Noda\x20payment:\x20','statusCode','Unknown\x20error','processWebhook','text','Order\x20ID\x20Format:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','https://tesoft.uk/gateway/noda/','shortLink','Remitter','Response\x20Time:','failed','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','active','16DiKmLI','../loggerService','/payment-links','Noda\x20API\x20error:\x20','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','logWhiteDomainError','log','HTTP\x20error!\x20status:\x20','paid','headers','created','===\x20NODA\x20SERVICE\x20ERROR\x20===','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','cancelled','BankTransactionId','164304AuqOTb','HTTP\x20','Order\x20ID\x20Used:','Settled','noda','URL:','Status\x20Code:','pending','application/json','stringify','__esModule','Error\x20stack:','toLowerCase','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Parsed\x20Result:','Raw\x20Response\x20Body:','completed','Iban','done','parse','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Status:','FAILED','Request\x20Body\x20(Direct\x20JSON):','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','18106FOtqhP',',\x20body:\x20','apiUrl','fromEntries','loggerService','rejected','status','message','PENDING','===\x20PARSED\x20NODA\x20RESPONSE\x20===','EXPIRED','2202qQcLYP','Yes','Business\x20Error:\x20','Not\x20provided','timeout','Failed\x20to\x20parse\x20JSON\x20response:','stack','7vhaQXy','PaymentId','Missing\x20id\x20or\x20shortLink\x20in\x20response','https://tesoft.uk/gateway/noda/webhook/','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','error','processing','2930384aGPgfS','expiryDate','expired','Noda\x20webhook\x20signature\x20verification:','success','Payment\x20Link\x20ID:','Unknown\x20error\x20from\x20Noda\x20API','MerchantPaymentId','/payment-links/','NodaService','verifyWebhookSignature','defineProperty','https://tesoft.uk/gateway/pending.php?id=','logWhiteDomainResponse','612265BujXjD','now','POST','GET','Short\x20Link:','isActive','Currency','entries','Headers:','BankId','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','HTTP\x20Status:','shortLinkUrls','SettlementDate','3270102oVndwl'];a43_0xbff8=function(){return _0x10c4fc;};return a43_0xbff8();}class NodaService{constructor(){const _0x455cce=a43_0x4ecdb6;this[_0x455cce(0xb3)]=_0x455cce(0xff),console['log'](_0x455cce(0x122));}async[a43_0x4ecdb6(0xe8)](_0x1f93f5){const _0x81018e=a43_0x4ecdb6,{orderId:_0x3eba6e,name:_0x22ba27,paymentDescription:_0x32e64d,amount:_0x27a9ec,currency:_0x1c9f6f,webhookUrl:_0x171078,returnUrl:_0x28b618,expiryDate:_0x39656b}=_0x1f93f5,_0x2657b3=_0x1c9f6f['toUpperCase'](),_0xf828c2=_0x81018e(0xc6),_0x554765=_0x81018e(0xd6)+_0x3eba6e,_0x107403={'name':_0x22ba27,'paymentDescription':_0x32e64d,'amount':_0x27a9ec,'currency':_0x2657b3,'paymentId':_0x3eba6e,'webhookUrl':_0xf828c2,'returnUrl':_0x554765};_0x39656b&&(_0x107403[_0x81018e(0xcb)]=_0x39656b);const _0x28cafc=Date['now']();try{console['log'](_0x81018e(0x104)),console['log'](_0x81018e(0x11a),this[_0x81018e(0xb3)]),console[_0x81018e(0x10c)](_0x81018e(0x12c),JSON[_0x81018e(0x11e)](_0x107403,null,0x2)),console[_0x81018e(0x10c)](_0x81018e(0xfd),_0x3eba6e,'(8digits-8digits\x20format\x20for\x20Noda)'),console['log'](_0x81018e(0xe2),_0x554765),loggerService_1[_0x81018e(0xb5)][_0x81018e(0xec)](_0x81018e(0x119),_0x81018e(0x108),'POST',_0x107403);const _0x29f3b9=await fetch(this[_0x81018e(0xb3)],{'method':_0x81018e(0xda),'headers':{'Content-Type':_0x81018e(0x11d),'Accept':'application/json','User-Agent':_0x81018e(0xf0)},'body':JSON['stringify'](_0x107403)}),_0xba769b=Date['now']()-_0x28cafc;console[_0x81018e(0x10c)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x81018e(0x10c)](_0x81018e(0x12a),_0x29f3b9[_0x81018e(0xb7)]),console[_0x81018e(0x10c)]('Status\x20Text:',_0x29f3b9[_0x81018e(0xf1)]),console[_0x81018e(0x10c)](_0x81018e(0xe0),Object[_0x81018e(0xb4)](_0x29f3b9[_0x81018e(0x10f)][_0x81018e(0xdf)]())),console[_0x81018e(0x10c)](_0x81018e(0x102),_0xba769b+'ms');const _0x22c778=await _0x29f3b9[_0x81018e(0xfc)]();console[_0x81018e(0x10c)](_0x81018e(0x124),_0x22c778);if(!_0x29f3b9['ok']){console[_0x81018e(0xc8)](_0x81018e(0xf6)),console[_0x81018e(0xc8)](_0x81018e(0xe4),_0x29f3b9['status']),console[_0x81018e(0xc8)](_0x81018e(0xed),_0x22c778),loggerService_1[_0x81018e(0xb5)][_0x81018e(0xd7)](_0x81018e(0x119),_0x81018e(0x108),_0x29f3b9[_0x81018e(0xb7)],_0x22c778,_0xba769b),loggerService_1[_0x81018e(0xb5)][_0x81018e(0x10b)]('noda',_0x81018e(0x108),_0x81018e(0x116)+_0x29f3b9['status']+':\x20'+_0x22c778);if(_0x29f3b9[_0x81018e(0xb7)]===0x190)throw new Error(_0x81018e(0x129));else{if(_0x29f3b9[_0x81018e(0xb7)]===0x1f4)throw new Error(_0x81018e(0x10a));}throw new Error(_0x81018e(0x10d)+_0x29f3b9['status']+_0x81018e(0xb2)+_0x22c778);}let _0x3b4fb0;try{_0x3b4fb0=JSON[_0x81018e(0x128)](_0x22c778);}catch(_0x3e5fe1){console[_0x81018e(0xc8)](_0x81018e(0xc1),_0x3e5fe1),loggerService_1[_0x81018e(0xb5)][_0x81018e(0x10b)](_0x81018e(0x119),_0x81018e(0x108),'JSON\x20Parse\x20Error:\x20'+_0x3e5fe1);throw new Error(_0x81018e(0xeb)+_0x22c778);}console[_0x81018e(0x10c)](_0x81018e(0xba)),console[_0x81018e(0x10c)](_0x81018e(0x123),JSON[_0x81018e(0x11e)](_0x3b4fb0,null,0x2)),loggerService_1[_0x81018e(0xb5)][_0x81018e(0xd7)](_0x81018e(0x119),_0x81018e(0x108),_0x29f3b9[_0x81018e(0xb7)],_0x3b4fb0,_0xba769b);if(_0x3b4fb0[_0x81018e(0xc8)]||_0x3b4fb0[_0x81018e(0xf9)]){const _0xd9d93b=_0x3b4fb0[_0x81018e(0xb8)]||_0x3b4fb0[_0x81018e(0xc8)]||_0x81018e(0xd0);console[_0x81018e(0xc8)](_0x81018e(0xc7)),console[_0x81018e(0xc8)]('Error\x20Message:',_0xd9d93b),console[_0x81018e(0xc8)](_0x81018e(0x11b),_0x3b4fb0[_0x81018e(0xf9)]),loggerService_1['loggerService'][_0x81018e(0x10b)](_0x81018e(0x119),_0x81018e(0x108),_0x81018e(0xbe)+_0xd9d93b);throw new Error(_0x81018e(0x109)+_0xd9d93b);}if(!_0x3b4fb0['id']||!_0x3b4fb0[_0x81018e(0xe5)]?.[_0x81018e(0x100)]){console[_0x81018e(0xc8)](_0x81018e(0x112)),console[_0x81018e(0xc8)](_0x81018e(0xc5)),console[_0x81018e(0xc8)]('Response\x20data:',_0x3b4fb0),loggerService_1['loggerService'][_0x81018e(0x10b)](_0x81018e(0x119),_0x81018e(0x108),_0x81018e(0xe3));throw new Error(_0x81018e(0x12d));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console[_0x81018e(0x10c)](_0x81018e(0xcf),_0x3b4fb0['id']),console[_0x81018e(0x10c)](_0x81018e(0xdc),_0x3b4fb0[_0x81018e(0xe5)][_0x81018e(0x100)]),console['log'](_0x81018e(0xf2),_0x3b4fb0[_0x81018e(0xe5)][_0x81018e(0xea)]||_0x81018e(0xbf)),console[_0x81018e(0x10c)](_0x81018e(0x117),_0x3eba6e,'(8digits-8digits\x20format)'),console[_0x81018e(0x10c)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x554765),{'gateway_payment_id':_0x3b4fb0['id'],'payment_url':_0x3b4fb0[_0x81018e(0xe5)][_0x81018e(0x100)],'qr_code_url':_0x3b4fb0[_0x81018e(0xe5)][_0x81018e(0xea)],'expiry_date':_0x3b4fb0[_0x81018e(0xcb)]};}catch(_0x244d5b){console['error'](_0x81018e(0x111)),console[_0x81018e(0xc8)]('Error\x20details:',_0x244d5b),loggerService_1['loggerService'][_0x81018e(0x10b)](_0x81018e(0x119),_0x81018e(0x108),_0x244d5b);if(_0x244d5b instanceof Error){console['error']('Error\x20message:',_0x244d5b[_0x81018e(0xb8)]),console[_0x81018e(0xc8)](_0x81018e(0x120),_0x244d5b[_0x81018e(0xc2)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x244d5b[_0x81018e(0xb8)]);}throw new Error(_0x81018e(0xfe));}}async[a43_0x4ecdb6(0xf5)](_0x190199){const _0x2dcf87=a43_0x4ecdb6,_0x519f3d=Date[_0x2dcf87(0xd9)]();try{loggerService_1[_0x2dcf87(0xb5)][_0x2dcf87(0xec)]('noda',_0x2dcf87(0xd2)+_0x190199,_0x2dcf87(0xdb),{});const _0x23f9fc=await fetch(this['apiUrl']+'/'+_0x190199,{'method':_0x2dcf87(0xdb),'headers':{'Content-Type':_0x2dcf87(0x11d),'User-Agent':_0x2dcf87(0xf0)}}),_0x14658c=Date['now']()-_0x519f3d;if(!_0x23f9fc['ok']){const _0x559451=await _0x23f9fc[_0x2dcf87(0xfc)]();loggerService_1['loggerService'][_0x2dcf87(0xd7)](_0x2dcf87(0x119),_0x2dcf87(0xd2)+_0x190199,_0x23f9fc[_0x2dcf87(0xb7)],_0x559451,_0x14658c);throw new Error('HTTP\x20error!\x20status:\x20'+_0x23f9fc[_0x2dcf87(0xb7)]);}const _0x4350e5=await _0x23f9fc['json']();loggerService_1[_0x2dcf87(0xb5)][_0x2dcf87(0xd7)]('noda',_0x2dcf87(0xd2)+_0x190199,_0x23f9fc[_0x2dcf87(0xb7)],_0x4350e5,_0x14658c);if(_0x4350e5[_0x2dcf87(0xc8)]||_0x4350e5[_0x2dcf87(0xf9)]){loggerService_1[_0x2dcf87(0xb5)][_0x2dcf87(0x10b)]('noda',_0x2dcf87(0xd2)+_0x190199,_0x2dcf87(0x109)+(_0x4350e5[_0x2dcf87(0xb8)]||_0x4350e5[_0x2dcf87(0xc8)]||_0x2dcf87(0xfa)));throw new Error('Noda\x20API\x20error:\x20'+(_0x4350e5[_0x2dcf87(0xb8)]||_0x4350e5[_0x2dcf87(0xc8)]||'Unknown\x20error'));}let _0x7c67ad=_0x2dcf87(0xb9);if(_0x4350e5[_0x2dcf87(0xdd)]===![]){if(_0x4350e5[_0x2dcf87(0xcb)]){const _0x193316=new Date(_0x4350e5[_0x2dcf87(0xcb)]),_0x281233=new Date();_0x193316<_0x281233?_0x7c67ad=_0x2dcf87(0xbb):_0x7c67ad='FAILED';}else _0x7c67ad=_0x2dcf87(0x12b);}else _0x7c67ad=_0x2dcf87(0xb9);return{'status':_0x7c67ad,'amount':_0x4350e5['amount'],'currency':_0x4350e5['currency'],'isActive':_0x4350e5[_0x2dcf87(0xdd)]};}catch(_0x2661ef){console[_0x2dcf87(0xc8)](_0x2dcf87(0xf4),_0x2661ef),loggerService_1[_0x2dcf87(0xb5)][_0x2dcf87(0x10b)]('noda',_0x2dcf87(0xd2)+_0x190199,_0x2661ef);throw new Error(_0x2dcf87(0xf8)+(_0x2661ef instanceof Error?_0x2661ef[_0x2dcf87(0xb8)]:_0x2dcf87(0xfa)));}}async[a43_0x4ecdb6(0xfb)](_0x7fcf44){const _0x3d4c9e=a43_0x4ecdb6;console[_0x3d4c9e(0x10c)]('Processing\x20Noda\x20webhook:',_0x7fcf44);let _0x4e537e=_0x3d4c9e(0xb9);switch(_0x7fcf44[_0x3d4c9e(0xef)]?.[_0x3d4c9e(0x121)]()){case _0x3d4c9e(0x127):case _0x3d4c9e(0x125):case _0x3d4c9e(0x10e):case _0x3d4c9e(0xce):case'successful':_0x7fcf44[_0x3d4c9e(0x118)]===_0x3d4c9e(0xbd)?_0x4e537e='PAID':_0x4e537e=_0x3d4c9e(0xb9);break;case _0x3d4c9e(0x113):case'canceled':case _0x3d4c9e(0x103):case _0x3d4c9e(0xc8):case _0x3d4c9e(0xb6):_0x4e537e=_0x3d4c9e(0x12b);break;case _0x3d4c9e(0xcc):case _0x3d4c9e(0xc0):_0x4e537e=_0x3d4c9e(0xbb);break;case _0x3d4c9e(0x11c):case _0x3d4c9e(0x110):case _0x3d4c9e(0x105):case _0x3d4c9e(0xc9):case'in_progress':default:_0x4e537e=_0x3d4c9e(0xb9);break;}return{'paymentId':_0x7fcf44[_0x3d4c9e(0xd1)]||_0x7fcf44[_0x3d4c9e(0xc4)],'status':_0x4e537e,'amount':_0x7fcf44['Amount'],'currency':_0x7fcf44[_0x3d4c9e(0xde)],'additionalInfo':{'method':_0x7fcf44[_0x3d4c9e(0xee)],'bankId':_0x7fcf44[_0x3d4c9e(0xe1)],'settled':_0x7fcf44[_0x3d4c9e(0x118)],'settlementDate':_0x7fcf44[_0x3d4c9e(0xe6)],'remitterName':_0x7fcf44[_0x3d4c9e(0x101)]?.['Name'],'remitterIban':_0x7fcf44[_0x3d4c9e(0x101)]?.[_0x3d4c9e(0x126)],'bankTransactionId':_0x7fcf44[_0x3d4c9e(0x114)]}};}[a43_0x4ecdb6(0xd4)](_0x55972d,_0x258e51){const _0x2b6c38=a43_0x4ecdb6;return console[_0x2b6c38(0x10c)](_0x2b6c38(0xcd),{'receivedSignature':_0x258e51,'paymentId':_0x55972d[_0x2b6c38(0xc4)],'merchantPaymentId':_0x55972d[_0x2b6c38(0xd1)]}),!![];}}exports[a43_0x4ecdb6(0xd3)]=NodaService;