'use strict';const a43_0x3419f0=a43_0x3c1d;(function(_0x5ec8f2,_0xd8237f){const _0x5686db=a43_0x3c1d,_0x55edda=_0x5ec8f2();while(!![]){try{const _0x3a0c63=parseInt(_0x5686db(0xf1))/0x1*(-parseInt(_0x5686db(0x81))/0x2)+parseInt(_0x5686db(0xe0))/0x3*(-parseInt(_0x5686db(0x96))/0x4)+-parseInt(_0x5686db(0xd6))/0x5*(-parseInt(_0x5686db(0xa0))/0x6)+-parseInt(_0x5686db(0x7c))/0x7*(parseInt(_0x5686db(0xf0))/0x8)+-parseInt(_0x5686db(0xb7))/0x9+-parseInt(_0x5686db(0x95))/0xa+-parseInt(_0x5686db(0xb9))/0xb*(-parseInt(_0x5686db(0xca))/0xc);if(_0x3a0c63===_0xd8237f)break;else _0x55edda['push'](_0x55edda['shift']());}catch(_0x153563){_0x55edda['push'](_0x55edda['shift']());}}}(a43_0x2668,0x8131c));Object[a43_0x3419f0(0xab)](exports,a43_0x3419f0(0xec),{'value':!![]}),exports[a43_0x3419f0(0x7e)]=void 0x0;const loggerService_1=require(a43_0x3419f0(0xc6));function a43_0x2668(){const _0x4a639d=['Status','logWhiteDomainResponse','createPaymentLink','log','BankTransactionId','successful','created','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','isActive','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','__esModule','/payment-links/','HTTP\x20','Parsed\x20Result:','8zzYlcj','11XkFXyC','application/json','toLowerCase','5946276MaQoAx','parse','NodaService','Business\x20Error:\x20','(8digits-8digits\x20format\x20for\x20Noda)','1626hNujnZ','Processing\x20Noda\x20webhook:','JSON\x20Parse\x20Error:\x20','canceled','fromEntries','loggerService','text','status','Unknown\x20error\x20from\x20Noda\x20API','message','/payment-links','Error\x20details:','Payment\x20Link\x20ID:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','error','logWhiteDomainRequest','done','now','Unknown\x20error','toUpperCase','2183980KNtqbY','312404tLezuL','POST','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',',\x20body:\x20','HTTP\x20Status:','Amount','logWhiteDomainError','HTTP\x20error!\x20status:\x20','cancelled','Error\x20message:','342cGhPPH','Remitter','Currency','Error\x20stack:','shortLink','TesSoft\x20Payment\x20System/1.0','Failed\x20to\x20verify\x20Noda\x20payment:\x20','===\x20NODA\x20SERVICE\x20ERROR\x20===','PAID','(8digits-8digits\x20format)','noda','defineProperty','GET','Noda\x20payment\x20verification\x20error:','Response\x20data:','Status:','Noda\x20API\x20error:\x20','in_progress','Missing\x20id\x20or\x20shortLink\x20in\x20response','expired','amount','FAILED','expiryDate','3226014HKtuLf','stack','3858635sgSDMa','active','Failed\x20to\x20parse\x20JSON\x20response:','success','statusText','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','rejected','===\x20PARSED\x20NODA\x20RESPONSE\x20===','pending','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Status\x20Code:','PaymentId','shortLinkUrls','../loggerService','headers','stringify','MerchantPaymentId','72EjmIrP','Noda\x20webhook\x20signature\x20verification:','EXPIRED','Method','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Request\x20Body\x20(Direct\x20JSON):','failed','processing','===\x20NODA\x20SUCCESS\x20===','Raw\x20Response\x20Body:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20NODA\x20API\x20ERROR\x20===','21950PNmyKw','statusCode','URL:','entries','Short\x20Link:','Settled','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','verifyPayment','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','apiUrl','15bmQeSF','PENDING'];a43_0x2668=function(){return _0x4a639d;};return a43_0x2668();}class NodaService{constructor(){const _0x4b065f=a43_0x3419f0;this['apiUrl']='https://tesoft.uk/gateway/noda/',console[_0x4b065f(0xe5)](_0x4b065f(0xce));}async[a43_0x3419f0(0xe4)](_0x55190a){const _0x27a82b=a43_0x3419f0,{orderId:_0x18db38,name:_0x390830,paymentDescription:_0x5299cd,amount:_0x5befd1,currency:_0x302ddb,webhookUrl:_0x15c7a7,returnUrl:_0x1b592d,expiryDate:_0x8aaf48}=_0x55190a,_0x389c19=_0x302ddb[_0x27a82b(0x94)](),_0x5d8238='https://tesoft.uk/gateway/noda/webhook/',_0x3fbc18='https://tesoft.uk/gateway/pending.php?id='+_0x18db38,_0x2cb9dd={'name':_0x390830,'paymentDescription':_0x5299cd,'amount':_0x5befd1,'currency':_0x389c19,'paymentId':_0x18db38,'webhookUrl':_0x5d8238,'returnUrl':_0x3fbc18};_0x8aaf48&&(_0x2cb9dd[_0x27a82b(0xb6)]=_0x8aaf48);const _0x38423b=Date[_0x27a82b(0x92)]();try{console[_0x27a82b(0xe5)](_0x27a82b(0xdc)),console[_0x27a82b(0xe5)](_0x27a82b(0xd8),this['apiUrl']),console[_0x27a82b(0xe5)](_0x27a82b(0xcf),JSON['stringify'](_0x2cb9dd,null,0x2)),console[_0x27a82b(0xe5)]('Order\x20ID\x20Format:',_0x18db38,_0x27a82b(0x80)),console[_0x27a82b(0xe5)](_0x27a82b(0x98),_0x3fbc18),loggerService_1[_0x27a82b(0x86)][_0x27a82b(0x90)]('noda',_0x27a82b(0x8b),_0x27a82b(0x97),_0x2cb9dd);const _0x1cf393=await fetch(this[_0x27a82b(0xdf)],{'method':_0x27a82b(0x97),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x27a82b(0xc8)](_0x2cb9dd)}),_0x65b02f=Date[_0x27a82b(0x92)]()-_0x38423b;console[_0x27a82b(0xe5)](_0x27a82b(0xd4)),console['log'](_0x27a82b(0xaf),_0x1cf393[_0x27a82b(0x88)]),console[_0x27a82b(0xe5)]('Status\x20Text:',_0x1cf393[_0x27a82b(0xbd)]),console[_0x27a82b(0xe5)]('Headers:',Object[_0x27a82b(0x85)](_0x1cf393[_0x27a82b(0xc7)][_0x27a82b(0xd9)]())),console[_0x27a82b(0xe5)]('Response\x20Time:',_0x65b02f+'ms');const _0x40fdd6=await _0x1cf393[_0x27a82b(0x87)]();console[_0x27a82b(0xe5)](_0x27a82b(0xd3),_0x40fdd6);if(!_0x1cf393['ok']){console[_0x27a82b(0x8f)](_0x27a82b(0xd5)),console[_0x27a82b(0x8f)](_0x27a82b(0x9a),_0x1cf393[_0x27a82b(0x88)]),console['error']('Response\x20Body:',_0x40fdd6),loggerService_1['loggerService'][_0x27a82b(0xe3)]('noda',_0x27a82b(0x8b),_0x1cf393[_0x27a82b(0x88)],_0x40fdd6,_0x65b02f),loggerService_1[_0x27a82b(0x86)][_0x27a82b(0x9c)](_0x27a82b(0xaa),'/payment-links',_0x27a82b(0xee)+_0x1cf393[_0x27a82b(0x88)]+':\x20'+_0x40fdd6);if(_0x1cf393['status']===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x1cf393[_0x27a82b(0x88)]===0x1f4)throw new Error(_0x27a82b(0xde));}throw new Error(_0x27a82b(0x9d)+_0x1cf393[_0x27a82b(0x88)]+_0x27a82b(0x99)+_0x40fdd6);}let _0x508f34;try{_0x508f34=JSON[_0x27a82b(0x7d)](_0x40fdd6);}catch(_0x1734bd){console[_0x27a82b(0x8f)](_0x27a82b(0xbb),_0x1734bd),loggerService_1[_0x27a82b(0x86)][_0x27a82b(0x9c)](_0x27a82b(0xaa),'/payment-links',_0x27a82b(0x83)+_0x1734bd);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x40fdd6);}console[_0x27a82b(0xe5)](_0x27a82b(0xc0)),console[_0x27a82b(0xe5)](_0x27a82b(0xef),JSON[_0x27a82b(0xc8)](_0x508f34,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0x27a82b(0x8b),_0x1cf393[_0x27a82b(0x88)],_0x508f34,_0x65b02f);if(_0x508f34[_0x27a82b(0x8f)]||_0x508f34[_0x27a82b(0xd7)]){const _0x3e6249=_0x508f34['message']||_0x508f34['error']||_0x27a82b(0x89);console[_0x27a82b(0x8f)](_0x27a82b(0xeb)),console[_0x27a82b(0x8f)]('Error\x20Message:',_0x3e6249),console[_0x27a82b(0x8f)](_0x27a82b(0xc3),_0x508f34[_0x27a82b(0xd7)]),loggerService_1['loggerService'][_0x27a82b(0x9c)]('noda',_0x27a82b(0x8b),_0x27a82b(0x7f)+_0x3e6249);throw new Error(_0x27a82b(0xb0)+_0x3e6249);}if(!_0x508f34['id']||!_0x508f34['shortLinkUrls']?.[_0x27a82b(0xa4)]){console[_0x27a82b(0x8f)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x27a82b(0x8f)](_0x27a82b(0xb2)),console[_0x27a82b(0x8f)](_0x27a82b(0xae),_0x508f34),loggerService_1[_0x27a82b(0x86)][_0x27a82b(0x9c)](_0x27a82b(0xaa),_0x27a82b(0x8b),_0x27a82b(0x8e));throw new Error(_0x27a82b(0xe9));}return console[_0x27a82b(0xe5)](_0x27a82b(0xd2)),console[_0x27a82b(0xe5)](_0x27a82b(0x8d),_0x508f34['id']),console[_0x27a82b(0xe5)](_0x27a82b(0xda),_0x508f34['shortLinkUrls'][_0x27a82b(0xa4)]),console[_0x27a82b(0xe5)]('QR\x20Code\x20Link:',_0x508f34[_0x27a82b(0xc5)]['qrCodeLink']||'Not\x20provided'),console['log']('Order\x20ID\x20Used:',_0x18db38,_0x27a82b(0xa9)),console['log']('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x3fbc18),{'gateway_payment_id':_0x508f34['id'],'payment_url':_0x508f34['shortLinkUrls'][_0x27a82b(0xa4)],'qr_code_url':_0x508f34[_0x27a82b(0xc5)]['qrCodeLink'],'expiry_date':_0x508f34['expiryDate']};}catch(_0x49803e){console[_0x27a82b(0x8f)](_0x27a82b(0xa7)),console[_0x27a82b(0x8f)](_0x27a82b(0x8c),_0x49803e),loggerService_1[_0x27a82b(0x86)]['logWhiteDomainError']('noda','/payment-links',_0x49803e);if(_0x49803e instanceof Error){console[_0x27a82b(0x8f)](_0x27a82b(0x9f),_0x49803e[_0x27a82b(0x8a)]),console['error'](_0x27a82b(0xa3),_0x49803e[_0x27a82b(0xb8)]);throw new Error(_0x27a82b(0xbe)+_0x49803e[_0x27a82b(0x8a)]);}throw new Error(_0x27a82b(0xc2));}}async[a43_0x3419f0(0xdd)](_0x5a8567){const _0x5a0036=a43_0x3419f0,_0x37bfbb=Date['now']();try{loggerService_1[_0x5a0036(0x86)][_0x5a0036(0x90)](_0x5a0036(0xaa),_0x5a0036(0xed)+_0x5a8567,_0x5a0036(0xac),{});const _0x1c02c7=await fetch(this[_0x5a0036(0xdf)]+'/'+_0x5a8567,{'method':_0x5a0036(0xac),'headers':{'Content-Type':_0x5a0036(0x7a),'User-Agent':_0x5a0036(0xa5)}}),_0x386830=Date[_0x5a0036(0x92)]()-_0x37bfbb;if(!_0x1c02c7['ok']){const _0xec3136=await _0x1c02c7[_0x5a0036(0x87)]();loggerService_1['loggerService'][_0x5a0036(0xe3)](_0x5a0036(0xaa),_0x5a0036(0xed)+_0x5a8567,_0x1c02c7[_0x5a0036(0x88)],_0xec3136,_0x386830);throw new Error(_0x5a0036(0x9d)+_0x1c02c7[_0x5a0036(0x88)]);}const _0x462acf=await _0x1c02c7['json']();loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0x5a0036(0xed)+_0x5a8567,_0x1c02c7[_0x5a0036(0x88)],_0x462acf,_0x386830);if(_0x462acf[_0x5a0036(0x8f)]||_0x462acf['statusCode']){loggerService_1[_0x5a0036(0x86)][_0x5a0036(0x9c)](_0x5a0036(0xaa),_0x5a0036(0xed)+_0x5a8567,'Noda\x20API\x20error:\x20'+(_0x462acf[_0x5a0036(0x8a)]||_0x462acf[_0x5a0036(0x8f)]||_0x5a0036(0x93)));throw new Error(_0x5a0036(0xb0)+(_0x462acf[_0x5a0036(0x8a)]||_0x462acf['error']||_0x5a0036(0x93)));}let _0x51ca12='PENDING';if(_0x462acf[_0x5a0036(0xea)]===![]){if(_0x462acf[_0x5a0036(0xb6)]){const _0xf92dc7=new Date(_0x462acf[_0x5a0036(0xb6)]),_0x9986e0=new Date();_0xf92dc7<_0x9986e0?_0x51ca12=_0x5a0036(0xcc):_0x51ca12='FAILED';}else _0x51ca12=_0x5a0036(0xb5);}else _0x51ca12=_0x5a0036(0xe1);return{'status':_0x51ca12,'amount':_0x462acf[_0x5a0036(0xb4)],'currency':_0x462acf['currency'],'isActive':_0x462acf[_0x5a0036(0xea)]};}catch(_0x29851f){console['error'](_0x5a0036(0xad),_0x29851f),loggerService_1['loggerService'][_0x5a0036(0x9c)]('noda',_0x5a0036(0xed)+_0x5a8567,_0x29851f);throw new Error(_0x5a0036(0xa6)+(_0x29851f instanceof Error?_0x29851f[_0x5a0036(0x8a)]:_0x5a0036(0x93)));}}async['processWebhook'](_0x531215){const _0x3a5f9e=a43_0x3419f0;console[_0x3a5f9e(0xe5)](_0x3a5f9e(0x82),_0x531215);let _0x30c584=_0x3a5f9e(0xe1);switch(_0x531215[_0x3a5f9e(0xe2)]?.[_0x3a5f9e(0x7b)]()){case _0x3a5f9e(0x91):case'completed':case'paid':case _0x3a5f9e(0xbc):case _0x3a5f9e(0xe7):_0x531215[_0x3a5f9e(0xdb)]==='Yes'?_0x30c584=_0x3a5f9e(0xa8):_0x30c584=_0x3a5f9e(0xe1);break;case _0x3a5f9e(0x9e):case _0x3a5f9e(0x84):case _0x3a5f9e(0xd0):case _0x3a5f9e(0x8f):case _0x3a5f9e(0xbf):_0x30c584=_0x3a5f9e(0xb5);break;case _0x3a5f9e(0xb3):case'timeout':_0x30c584=_0x3a5f9e(0xcc);break;case _0x3a5f9e(0xc1):case _0x3a5f9e(0xe8):case _0x3a5f9e(0xba):case _0x3a5f9e(0xd1):case _0x3a5f9e(0xb1):default:_0x30c584='PENDING';break;}return{'paymentId':_0x531215[_0x3a5f9e(0xc9)]||_0x531215[_0x3a5f9e(0xc4)],'status':_0x30c584,'amount':_0x531215[_0x3a5f9e(0x9b)],'currency':_0x531215[_0x3a5f9e(0xa2)],'additionalInfo':{'method':_0x531215[_0x3a5f9e(0xcd)],'bankId':_0x531215['BankId'],'settled':_0x531215[_0x3a5f9e(0xdb)],'settlementDate':_0x531215['SettlementDate'],'remitterName':_0x531215[_0x3a5f9e(0xa1)]?.['Name'],'remitterIban':_0x531215[_0x3a5f9e(0xa1)]?.['Iban'],'bankTransactionId':_0x531215[_0x3a5f9e(0xe6)]}};}['verifyWebhookSignature'](_0x4233c7,_0x5048de){const _0x359c56=a43_0x3419f0;return console['log'](_0x359c56(0xcb),{'receivedSignature':_0x5048de,'paymentId':_0x4233c7['PaymentId'],'merchantPaymentId':_0x4233c7[_0x359c56(0xc9)]}),!![];}}function a43_0x3c1d(_0x43afe7,_0x3facb9){const _0x2668fb=a43_0x2668();return a43_0x3c1d=function(_0x3c1d71,_0x1b845e){_0x3c1d71=_0x3c1d71-0x7a;let _0x385c3c=_0x2668fb[_0x3c1d71];return _0x385c3c;},a43_0x3c1d(_0x43afe7,_0x3facb9);}exports[a43_0x3419f0(0x7e)]=NodaService;