'use strict';function a51_0x4a27(_0x2cba0d,_0x3a672f){const _0xa1a68a=a51_0xa1a6();return a51_0x4a27=function(_0x4a2760,_0x94a529){_0x4a2760=_0x4a2760-0x1d2;let _0x5ad723=_0xa1a68a[_0x4a2760];return _0x5ad723;},a51_0x4a27(_0x2cba0d,_0x3a672f);}const a51_0x3bb4f1=a51_0x4a27;(function(_0x5d17f9,_0x1161bc){const _0x28ae1f=a51_0x4a27,_0x1322ab=_0x5d17f9();while(!![]){try{const _0x335194=parseInt(_0x28ae1f(0x229))/0x1*(parseInt(_0x28ae1f(0x21c))/0x2)+parseInt(_0x28ae1f(0x1f2))/0x3*(-parseInt(_0x28ae1f(0x1df))/0x4)+parseInt(_0x28ae1f(0x21e))/0x5*(-parseInt(_0x28ae1f(0x23e))/0x6)+parseInt(_0x28ae1f(0x219))/0x7+-parseInt(_0x28ae1f(0x213))/0x8+-parseInt(_0x28ae1f(0x1e2))/0x9+-parseInt(_0x28ae1f(0x22d))/0xa*(-parseInt(_0x28ae1f(0x1f4))/0xb);if(_0x335194===_0x1161bc)break;else _0x1322ab['push'](_0x1322ab['shift']());}catch(_0x4b773b){_0x1322ab['push'](_0x1322ab['shift']());}}}(a51_0xa1a6,0x8308f));function a51_0xa1a6(){const _0x34a05c=['apiUrl','message','completed','Error\x20stack:','verifyWebhookSignature','shortLink','12XiQGoW','created','2602149rALQfm','pending','Noda\x20webhook\x20signature\x20verification:','Processing\x20Noda\x20webhook:','qrCodeLink','Noda\x20API\x20error:\x20','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Short\x20Link:','Failed\x20to\x20parse\x20JSON\x20response:','PENDING','cancelled','(8digits-8digits\x20format\x20for\x20Noda)','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','log','application/json','in_progress','POST','verifyPayment','noda','/payment-links','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Settled','error','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','EXPIRED','shortLinkUrls','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','logWhiteDomainError','Status','4840960GKboiq','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','URL:','Parsed\x20Result:','status','FAILED','4800075NFHoFK','HTTP\x20','HTTP\x20Status:','6eaYbpO','logWhiteDomainRequest','1321735vtUdgP','Response\x20data:','Raw\x20Response\x20Body:','now','Status:','BankTransactionId','loggerService','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','expiryDate','Error\x20Message:','Yes','344229qaMDGs','Payment\x20Link\x20ID:','parse','Failed\x20to\x20verify\x20Noda\x20payment:\x20','30JMLpjp','QR\x20Code\x20Link:','timeout','===\x20PARSED\x20NODA\x20RESPONSE\x20===','successful','done','toUpperCase','Amount','success','Business\x20Error:\x20','Unknown\x20error\x20from\x20Noda\x20API','https://tesoft.uk/gateway/noda/','MerchantPaymentId','===\x20NODA\x20SUCCESS\x20===','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','/payment-links/','6TgvhSU','../loggerService','__esModule','logWhiteDomainResponse','json','HTTP\x20error!\x20status:\x20','NodaService','Error\x20message:','isActive','PAID','active','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','(8digits-8digits\x20format)','Error\x20details:','Not\x20provided','entries','paid','Headers:','GET','statusText','Unknown\x20error','===\x20NODA\x20API\x20ERROR\x20===','headers','PaymentId','Currency','===\x20NODA\x20SERVICE\x20ERROR\x20===','statusCode','canceled','312328dtMAtI','Missing\x20id\x20or\x20shortLink\x20in\x20response','Payment\x20System/1.0','6386175taaqtL','stringify','amount','failed','Remitter','Request\x20Body\x20(Direct\x20JSON):','createPaymentLink','processing','Method','text'];a51_0xa1a6=function(){return _0x34a05c;};return a51_0xa1a6();}Object['defineProperty'](exports,a51_0x3bb4f1(0x240),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a51_0x3bb4f1(0x23f));class NodaService{constructor(){const _0xd16436=a51_0x3bb4f1;this['apiUrl']=_0xd16436(0x238),console['log'](_0xd16436(0x20a));}async[a51_0x3bb4f1(0x1e8)](_0x155924){const _0x3a8629=a51_0x3bb4f1,{orderId:_0xfdc87c,name:_0x3e1c9e,paymentDescription:_0x18cacc,amount:_0x2e00a6,currency:_0x4c8b04,webhookUrl:_0x230e11,returnUrl:_0xb93c26,expiryDate:_0x5c1687}=_0x155924,_0x853f4f=_0x4c8b04[_0x3a8629(0x233)](),_0x3e9750='https://tesoft.uk/gateway/noda/webhook/',_0x393036='https://tesoft.uk/gateway/pending.php?id='+_0xfdc87c,_0x4f3b62={'name':_0x3e1c9e,'paymentDescription':_0x18cacc,'amount':_0x2e00a6,'currency':_0x853f4f,'paymentId':_0xfdc87c,'webhookUrl':_0x3e9750,'returnUrl':_0x393036};_0x5c1687&&(_0x4f3b62[_0x3a8629(0x226)]=_0x5c1687);const _0xa0cbbe=Date[_0x3a8629(0x221)]();try{console[_0x3a8629(0x203)](_0x3a8629(0x23b)),console[_0x3a8629(0x203)](_0x3a8629(0x215),this['apiUrl']),console[_0x3a8629(0x203)](_0x3a8629(0x1e7),JSON[_0x3a8629(0x1e3)](_0x4f3b62,null,0x2)),console[_0x3a8629(0x203)]('Order\x20ID\x20Format:',_0xfdc87c,_0x3a8629(0x200)),console['log'](_0x3a8629(0x210),_0x393036),loggerService_1[_0x3a8629(0x224)][_0x3a8629(0x21d)](_0x3a8629(0x208),_0x3a8629(0x209),_0x3a8629(0x206),_0x4f3b62);const _0xca4c4f=await fetch(this[_0x3a8629(0x1ec)],{'method':_0x3a8629(0x206),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x3a8629(0x1e3)](_0x4f3b62)}),_0x4682ea=Date['now']()-_0xa0cbbe;console['log'](_0x3a8629(0x202)),console[_0x3a8629(0x203)](_0x3a8629(0x222),_0xca4c4f[_0x3a8629(0x217)]),console[_0x3a8629(0x203)]('Status\x20Text:',_0xca4c4f[_0x3a8629(0x1d6)]),console[_0x3a8629(0x203)](_0x3a8629(0x1d4),Object['fromEntries'](_0xca4c4f[_0x3a8629(0x1d9)][_0x3a8629(0x1d2)]())),console[_0x3a8629(0x203)]('Response\x20Time:',_0x4682ea+'ms');const _0xc9c041=await _0xca4c4f['text']();console[_0x3a8629(0x203)](_0x3a8629(0x220),_0xc9c041);if(!_0xca4c4f['ok']){console['error'](_0x3a8629(0x1d8)),console[_0x3a8629(0x20c)](_0x3a8629(0x21b),_0xca4c4f[_0x3a8629(0x217)]),console[_0x3a8629(0x20c)]('Response\x20Body:',_0xc9c041),loggerService_1[_0x3a8629(0x224)][_0x3a8629(0x241)](_0x3a8629(0x208),_0x3a8629(0x209),_0xca4c4f['status'],_0xc9c041,_0x4682ea),loggerService_1[_0x3a8629(0x224)][_0x3a8629(0x211)](_0x3a8629(0x208),_0x3a8629(0x209),_0x3a8629(0x21a)+_0xca4c4f[_0x3a8629(0x217)]+':\x20'+_0xc9c041);if(_0xca4c4f[_0x3a8629(0x217)]===0x190)throw new Error(_0x3a8629(0x1fa));else{if(_0xca4c4f['status']===0x1f4)throw new Error(_0x3a8629(0x214));}throw new Error('HTTP\x20error!\x20status:\x20'+_0xca4c4f[_0x3a8629(0x217)]+',\x20body:\x20'+_0xc9c041);}let _0x77d46e;try{_0x77d46e=JSON[_0x3a8629(0x22b)](_0xc9c041);}catch(_0x741260){console[_0x3a8629(0x20c)](_0x3a8629(0x1fd),_0x741260),loggerService_1[_0x3a8629(0x224)]['logWhiteDomainError'](_0x3a8629(0x208),_0x3a8629(0x209),'JSON\x20Parse\x20Error:\x20'+_0x741260);throw new Error(_0x3a8629(0x23c)+_0xc9c041);}console[_0x3a8629(0x203)](_0x3a8629(0x230)),console[_0x3a8629(0x203)](_0x3a8629(0x216),JSON['stringify'](_0x77d46e,null,0x2)),loggerService_1[_0x3a8629(0x224)][_0x3a8629(0x241)](_0x3a8629(0x208),_0x3a8629(0x209),_0xca4c4f[_0x3a8629(0x217)],_0x77d46e,_0x4682ea);if(_0x77d46e['error']||_0x77d46e[_0x3a8629(0x1dd)]){const _0x3a9e26=_0x77d46e['message']||_0x77d46e[_0x3a8629(0x20c)]||_0x3a8629(0x237);console[_0x3a8629(0x20c)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x3a8629(0x20c)](_0x3a8629(0x227),_0x3a9e26),console[_0x3a8629(0x20c)]('Status\x20Code:',_0x77d46e[_0x3a8629(0x1dd)]),loggerService_1[_0x3a8629(0x224)][_0x3a8629(0x211)]('noda',_0x3a8629(0x209),_0x3a8629(0x236)+_0x3a9e26);throw new Error(_0x3a8629(0x1f9)+_0x3a9e26);}if(!_0x77d46e['id']||!_0x77d46e[_0x3a8629(0x20f)]?.['shortLink']){console['error'](_0x3a8629(0x201)),console[_0x3a8629(0x20c)](_0x3a8629(0x1e0)),console[_0x3a8629(0x20c)](_0x3a8629(0x21f),_0x77d46e),loggerService_1[_0x3a8629(0x224)][_0x3a8629(0x211)](_0x3a8629(0x208),_0x3a8629(0x209),_0x3a8629(0x249));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x3a8629(0x203)](_0x3a8629(0x23a)),console['log'](_0x3a8629(0x22a),_0x77d46e['id']),console[_0x3a8629(0x203)](_0x3a8629(0x1fc),_0x77d46e[_0x3a8629(0x20f)]['shortLink']),console[_0x3a8629(0x203)](_0x3a8629(0x22e),_0x77d46e[_0x3a8629(0x20f)][_0x3a8629(0x1f8)]||_0x3a8629(0x24c)),console[_0x3a8629(0x203)]('Order\x20ID\x20Used:',_0xfdc87c,_0x3a8629(0x24a)),console['log'](_0x3a8629(0x225),_0x393036),{'gateway_payment_id':_0x77d46e['id'],'payment_url':_0x77d46e['shortLinkUrls'][_0x3a8629(0x1f1)],'qr_code_url':_0x77d46e[_0x3a8629(0x20f)][_0x3a8629(0x1f8)],'expiry_date':_0x77d46e['expiryDate']};}catch(_0x5f44fa){console[_0x3a8629(0x20c)](_0x3a8629(0x1dc)),console[_0x3a8629(0x20c)](_0x3a8629(0x24b),_0x5f44fa),loggerService_1[_0x3a8629(0x224)]['logWhiteDomainError'](_0x3a8629(0x208),_0x3a8629(0x209),_0x5f44fa);if(_0x5f44fa instanceof Error){console[_0x3a8629(0x20c)](_0x3a8629(0x245),_0x5f44fa['message']),console['error'](_0x3a8629(0x1ef),_0x5f44fa['stack']);throw new Error(_0x3a8629(0x20d)+_0x5f44fa[_0x3a8629(0x1ed)]);}throw new Error(_0x3a8629(0x1fb));}}async[a51_0x3bb4f1(0x207)](_0xa3e521){const _0x534da4=a51_0x3bb4f1,_0x3d1fed=Date[_0x534da4(0x221)]();try{loggerService_1[_0x534da4(0x224)][_0x534da4(0x21d)](_0x534da4(0x208),_0x534da4(0x23d)+_0xa3e521,_0x534da4(0x1d5),{});const _0x5e6c42=await fetch(this['apiUrl']+'/'+_0xa3e521,{'method':_0x534da4(0x1d5),'headers':{'Content-Type':_0x534da4(0x204),'User-Agent':_0x534da4(0x1e1)}}),_0x49aeea=Date[_0x534da4(0x221)]()-_0x3d1fed;if(!_0x5e6c42['ok']){const _0x39cb58=await _0x5e6c42[_0x534da4(0x1eb)]();loggerService_1[_0x534da4(0x224)]['logWhiteDomainResponse']('noda',_0x534da4(0x23d)+_0xa3e521,_0x5e6c42[_0x534da4(0x217)],_0x39cb58,_0x49aeea);throw new Error(_0x534da4(0x243)+_0x5e6c42[_0x534da4(0x217)]);}const _0x492b1d=await _0x5e6c42[_0x534da4(0x242)]();loggerService_1['loggerService'][_0x534da4(0x241)](_0x534da4(0x208),_0x534da4(0x23d)+_0xa3e521,_0x5e6c42['status'],_0x492b1d,_0x49aeea);if(_0x492b1d[_0x534da4(0x20c)]||_0x492b1d[_0x534da4(0x1dd)]){loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x534da4(0x23d)+_0xa3e521,_0x534da4(0x1f9)+(_0x492b1d[_0x534da4(0x1ed)]||_0x492b1d['error']||_0x534da4(0x1d7)));throw new Error(_0x534da4(0x1f9)+(_0x492b1d[_0x534da4(0x1ed)]||_0x492b1d['error']||'Unknown\x20error'));}let _0x5958c9=_0x534da4(0x1fe);if(_0x492b1d[_0x534da4(0x246)]===![]){if(_0x492b1d[_0x534da4(0x226)]){const _0x39380f=new Date(_0x492b1d[_0x534da4(0x226)]),_0x27650a=new Date();_0x39380f<_0x27650a?_0x5958c9='EXPIRED':_0x5958c9='FAILED';}else _0x5958c9=_0x534da4(0x218);}else _0x5958c9=_0x534da4(0x1fe);return{'status':_0x5958c9,'amount':_0x492b1d[_0x534da4(0x1e4)],'currency':_0x492b1d['currency'],'isActive':_0x492b1d[_0x534da4(0x246)]};}catch(_0x24b8fc){console[_0x534da4(0x20c)]('Noda\x20payment\x20verification\x20error:',_0x24b8fc),loggerService_1[_0x534da4(0x224)][_0x534da4(0x211)](_0x534da4(0x208),_0x534da4(0x23d)+_0xa3e521,_0x24b8fc);throw new Error(_0x534da4(0x22c)+(_0x24b8fc instanceof Error?_0x24b8fc[_0x534da4(0x1ed)]:_0x534da4(0x1d7)));}}async['processWebhook'](_0x4bf10a){const _0x1edb4c=a51_0x3bb4f1;console[_0x1edb4c(0x203)](_0x1edb4c(0x1f7),_0x4bf10a);let _0x23f794=_0x1edb4c(0x1fe);switch(_0x4bf10a[_0x1edb4c(0x212)]?.['toLowerCase']()){case _0x1edb4c(0x232):case _0x1edb4c(0x1ee):case _0x1edb4c(0x1d3):case _0x1edb4c(0x235):case _0x1edb4c(0x231):_0x4bf10a[_0x1edb4c(0x20b)]===_0x1edb4c(0x228)?_0x23f794=_0x1edb4c(0x247):_0x23f794=_0x1edb4c(0x1fe);break;case _0x1edb4c(0x1ff):case _0x1edb4c(0x1de):case _0x1edb4c(0x1e5):case _0x1edb4c(0x20c):case'rejected':_0x23f794=_0x1edb4c(0x218);break;case'expired':case _0x1edb4c(0x22f):_0x23f794=_0x1edb4c(0x20e);break;case _0x1edb4c(0x1f5):case _0x1edb4c(0x1f3):case _0x1edb4c(0x248):case _0x1edb4c(0x1e9):case _0x1edb4c(0x205):default:_0x23f794=_0x1edb4c(0x1fe);break;}return{'paymentId':_0x4bf10a[_0x1edb4c(0x239)]||_0x4bf10a['PaymentId'],'status':_0x23f794,'amount':_0x4bf10a[_0x1edb4c(0x234)],'currency':_0x4bf10a[_0x1edb4c(0x1db)],'additionalInfo':{'method':_0x4bf10a[_0x1edb4c(0x1ea)],'bankId':_0x4bf10a['BankId'],'settled':_0x4bf10a[_0x1edb4c(0x20b)],'settlementDate':_0x4bf10a['SettlementDate'],'remitterName':_0x4bf10a[_0x1edb4c(0x1e6)]?.['Name'],'remitterIban':_0x4bf10a[_0x1edb4c(0x1e6)]?.['Iban'],'bankTransactionId':_0x4bf10a[_0x1edb4c(0x223)]}};}[a51_0x3bb4f1(0x1f0)](_0xcb9555,_0x541415){const _0x1024a7=a51_0x3bb4f1;return console[_0x1024a7(0x203)](_0x1024a7(0x1f6),{'receivedSignature':_0x541415,'paymentId':_0xcb9555[_0x1024a7(0x1da)],'merchantPaymentId':_0xcb9555[_0x1024a7(0x239)]}),!![];}}exports[a51_0x3bb4f1(0x244)]=NodaService;