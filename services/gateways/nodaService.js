'use strict';const a44_0x5b603c=a44_0x11b8;(function(_0xe2b517,_0x4c2b8b){const _0xc69a48=a44_0x11b8,_0xc0ec8d=_0xe2b517();while(!![]){try{const _0xfb92b1=parseInt(_0xc69a48(0xb1))/0x1+-parseInt(_0xc69a48(0xf6))/0x2*(parseInt(_0xc69a48(0x8d))/0x3)+parseInt(_0xc69a48(0xff))/0x4*(-parseInt(_0xc69a48(0x92))/0x5)+parseInt(_0xc69a48(0xc8))/0x6+-parseInt(_0xc69a48(0xd3))/0x7*(-parseInt(_0xc69a48(0xae))/0x8)+-parseInt(_0xc69a48(0x8a))/0x9+parseInt(_0xc69a48(0xf4))/0xa;if(_0xfb92b1===_0x4c2b8b)break;else _0xc0ec8d['push'](_0xc0ec8d['shift']());}catch(_0x22424a){_0xc0ec8d['push'](_0xc0ec8d['shift']());}}}(a44_0x5ac4,0x9ff5b));function a44_0x5ac4(){const _0x546b8c=['apiUrl','BankTransactionId','expired','Missing\x20id\x20or\x20shortLink\x20in\x20response','8998260NQRsfz','Raw\x20Response\x20Body:','2XJxDIh','JSON\x20Parse\x20Error:\x20','Order\x20ID\x20Format:','loggerService','/payment-links/','BankId','===\x20NODA\x20SUCCESS\x20===','https://tesoft.uk/gateway/noda/','parse','48lvrFEB','Status','application/json','logWhiteDomainResponse','in_progress',',\x20body:\x20','10563048DsUBba','failed','Yes','981381tIKsun','json','stringify','expiryDate','created','422420ZKvfgd','cancelled','../loggerService','FAILED','Short\x20Link:','PAID','HTTP\x20error!\x20status:\x20','Status:','Error\x20Message:','qrCodeLink','HTTP\x20','statusCode','Unknown\x20error','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Noda\x20API\x20error:\x20','statusText','Processing\x20Noda\x20webhook:','Error\x20details:','success','message','logWhiteDomainError','Currency','===\x20PARSED\x20NODA\x20RESPONSE\x20===','__esModule','Business\x20Error:\x20','shortLinkUrls','Response\x20data:','timeout','8xxSOlP','defineProperty','Noda\x20webhook\x20signature\x20verification:','1191488yKwSgI','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20ERROR\x20===','TesSoft\x20Payment\x20System/1.0','Settled','POST','NodaService','text','Method','(8digits-8digits\x20format)','processWebhook','Headers:','log','amount','URL:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Order\x20ID\x20Used:','Response\x20Time:','noda','Request\x20Body\x20(Direct\x20JSON):','active','Status\x20Text:','HTTP\x20Status:','2948742yGCPIh','toUpperCase','PENDING','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Noda\x20payment\x20verification\x20error:','headers','GET','PaymentId','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','createPaymentLink','4109217dIvfWh','fromEntries','logWhiteDomainRequest','EXPIRED','/payment-links','Error\x20message:','QR\x20Code\x20Link:','rejected','MerchantPaymentId','now','https://tesoft.uk/gateway/pending.php?id=','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','shortLink','Amount','error','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','https://tesoft.uk/gateway/noda/webhook/','currency','processing','Name','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','status','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Parsed\x20Result:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Error\x20stack:','pending','Iban','isActive'];a44_0x5ac4=function(){return _0x546b8c;};return a44_0x5ac4();}Object[a44_0x5b603c(0xaf)](exports,a44_0x5b603c(0xa9),{'value':!![]}),exports[a44_0x5b603c(0xb7)]=void 0x0;function a44_0x11b8(_0x3dc09c,_0x429d3d){const _0x5ac4e3=a44_0x5ac4();return a44_0x11b8=function(_0x11b83e,_0x3121ab){_0x11b83e=_0x11b83e-0x87;let _0x38ce6b=_0x5ac4e3[_0x11b83e];return _0x38ce6b;},a44_0x11b8(_0x3dc09c,_0x429d3d);}const loggerService_1=require(a44_0x5b603c(0x94));class NodaService{constructor(){const _0x218d3e=a44_0x5b603c;this[_0x218d3e(0xf0)]=_0x218d3e(0xfd),console[_0x218d3e(0xbd)](_0x218d3e(0xc0));}async[a44_0x5b603c(0xd2)](_0x1a227){const _0x4420e7=a44_0x5b603c,{orderId:_0x23eb57,name:_0x137489,paymentDescription:_0x3c4e20,amount:_0x4de130,currency:_0xfb652c,webhookUrl:_0x5d2571,returnUrl:_0x34d4d1,expiryDate:_0x1fa8af}=_0x1a227,_0x17e0af=_0xfb652c[_0x4420e7(0xc9)](),_0x1ade66=_0x4420e7(0xe3),_0x46a6e7=_0x4420e7(0xdd)+_0x23eb57,_0x2715b2={'name':_0x137489,'paymentDescription':_0x3c4e20,'amount':_0x4de130,'currency':_0x17e0af,'paymentId':_0x23eb57,'webhookUrl':_0x1ade66,'returnUrl':_0x46a6e7};_0x1fa8af&&(_0x2715b2[_0x4420e7(0x90)]=_0x1fa8af);const _0x2e3e91=Date['now']();try{console[_0x4420e7(0xbd)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console['log'](_0x4420e7(0xbf),this[_0x4420e7(0xf0)]),console[_0x4420e7(0xbd)](_0x4420e7(0xc4),JSON[_0x4420e7(0x8f)](_0x2715b2,null,0x2)),console[_0x4420e7(0xbd)](_0x4420e7(0xf8),_0x23eb57,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x4420e7(0xbd)](_0x4420e7(0xcc),_0x46a6e7),loggerService_1['loggerService'][_0x4420e7(0xd5)](_0x4420e7(0xc3),_0x4420e7(0xd7),_0x4420e7(0xb6),_0x2715b2);const _0x4ae595=await fetch(this['apiUrl'],{'method':_0x4420e7(0xb6),'headers':{'Content-Type':_0x4420e7(0x101),'Accept':_0x4420e7(0x101),'User-Agent':_0x4420e7(0xb4)},'body':JSON[_0x4420e7(0x8f)](_0x2715b2)}),_0x269177=Date[_0x4420e7(0xdc)]()-_0x2e3e91;console[_0x4420e7(0xbd)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x4420e7(0xbd)](_0x4420e7(0x99),_0x4ae595[_0x4420e7(0xe8)]),console[_0x4420e7(0xbd)](_0x4420e7(0xc6),_0x4ae595[_0x4420e7(0xa1)]),console[_0x4420e7(0xbd)](_0x4420e7(0xbc),Object[_0x4420e7(0xd4)](_0x4ae595[_0x4420e7(0xce)]['entries']())),console[_0x4420e7(0xbd)](_0x4420e7(0xc2),_0x269177+'ms');const _0x2048d0=await _0x4ae595[_0x4420e7(0xb8)]();console[_0x4420e7(0xbd)](_0x4420e7(0xf5),_0x2048d0);if(!_0x4ae595['ok']){console[_0x4420e7(0xe1)](_0x4420e7(0xb3)),console[_0x4420e7(0xe1)](_0x4420e7(0xc7),_0x4ae595[_0x4420e7(0xe8)]),console[_0x4420e7(0xe1)]('Response\x20Body:',_0x2048d0),loggerService_1[_0x4420e7(0xf9)][_0x4420e7(0x87)](_0x4420e7(0xc3),_0x4420e7(0xd7),_0x4ae595['status'],_0x2048d0,_0x269177),loggerService_1[_0x4420e7(0xf9)][_0x4420e7(0xa6)](_0x4420e7(0xc3),'/payment-links',_0x4420e7(0x9c)+_0x4ae595[_0x4420e7(0xe8)]+':\x20'+_0x2048d0);if(_0x4ae595[_0x4420e7(0xe8)]===0x190)throw new Error(_0x4420e7(0xeb));else{if(_0x4ae595[_0x4420e7(0xe8)]===0x1f4)throw new Error(_0x4420e7(0xde));}throw new Error(_0x4420e7(0x98)+_0x4ae595[_0x4420e7(0xe8)]+_0x4420e7(0x89)+_0x2048d0);}let _0x56d135;try{_0x56d135=JSON[_0x4420e7(0xfe)](_0x2048d0);}catch(_0x3858a2){console[_0x4420e7(0xe1)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x3858a2),loggerService_1[_0x4420e7(0xf9)][_0x4420e7(0xa6)](_0x4420e7(0xc3),_0x4420e7(0xd7),_0x4420e7(0xf7)+_0x3858a2);throw new Error(_0x4420e7(0xe9)+_0x2048d0);}console[_0x4420e7(0xbd)](_0x4420e7(0xa8)),console['log'](_0x4420e7(0xea),JSON[_0x4420e7(0x8f)](_0x56d135,null,0x2)),loggerService_1[_0x4420e7(0xf9)][_0x4420e7(0x87)](_0x4420e7(0xc3),_0x4420e7(0xd7),_0x4ae595['status'],_0x56d135,_0x269177);if(_0x56d135['error']||_0x56d135['statusCode']){const _0x11b989=_0x56d135[_0x4420e7(0xa5)]||_0x56d135[_0x4420e7(0xe1)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x4420e7(0xe1)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x4420e7(0xe1)](_0x4420e7(0x9a),_0x11b989),console['error']('Status\x20Code:',_0x56d135[_0x4420e7(0x9d)]),loggerService_1[_0x4420e7(0xf9)]['logWhiteDomainError'](_0x4420e7(0xc3),_0x4420e7(0xd7),_0x4420e7(0xaa)+_0x11b989);throw new Error(_0x4420e7(0xa0)+_0x11b989);}if(!_0x56d135['id']||!_0x56d135[_0x4420e7(0xab)]?.['shortLink']){console[_0x4420e7(0xe1)](_0x4420e7(0xe7)),console[_0x4420e7(0xe1)](_0x4420e7(0xf3)),console[_0x4420e7(0xe1)](_0x4420e7(0xac),_0x56d135),loggerService_1[_0x4420e7(0xf9)][_0x4420e7(0xa6)]('noda','/payment-links',_0x4420e7(0xb2));throw new Error(_0x4420e7(0xd1));}return console[_0x4420e7(0xbd)](_0x4420e7(0xfc)),console[_0x4420e7(0xbd)]('Payment\x20Link\x20ID:',_0x56d135['id']),console[_0x4420e7(0xbd)](_0x4420e7(0x96),_0x56d135[_0x4420e7(0xab)][_0x4420e7(0xdf)]),console[_0x4420e7(0xbd)](_0x4420e7(0xd9),_0x56d135[_0x4420e7(0xab)]['qrCodeLink']||'Not\x20provided'),console[_0x4420e7(0xbd)](_0x4420e7(0xc1),_0x23eb57,_0x4420e7(0xba)),console['log'](_0x4420e7(0xcb),_0x46a6e7),{'gateway_payment_id':_0x56d135['id'],'payment_url':_0x56d135[_0x4420e7(0xab)][_0x4420e7(0xdf)],'qr_code_url':_0x56d135[_0x4420e7(0xab)][_0x4420e7(0x9b)],'expiry_date':_0x56d135['expiryDate']};}catch(_0x21ecbb){console[_0x4420e7(0xe1)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console['error'](_0x4420e7(0xa3),_0x21ecbb),loggerService_1[_0x4420e7(0xf9)]['logWhiteDomainError'](_0x4420e7(0xc3),_0x4420e7(0xd7),_0x21ecbb);if(_0x21ecbb instanceof Error){console['error'](_0x4420e7(0xd8),_0x21ecbb[_0x4420e7(0xa5)]),console[_0x4420e7(0xe1)](_0x4420e7(0xec),_0x21ecbb['stack']);throw new Error(_0x4420e7(0x9f)+_0x21ecbb['message']);}throw new Error(_0x4420e7(0xe2));}}async['verifyPayment'](_0x866502){const _0x55b0b9=a44_0x5b603c,_0x2dd6c1=Date[_0x55b0b9(0xdc)]();try{loggerService_1['loggerService'][_0x55b0b9(0xd5)](_0x55b0b9(0xc3),_0x55b0b9(0xfa)+_0x866502,'GET',{});const _0x52ed71=await fetch(this[_0x55b0b9(0xf0)]+'/'+_0x866502,{'method':_0x55b0b9(0xcf),'headers':{'Content-Type':_0x55b0b9(0x101),'User-Agent':_0x55b0b9(0xb4)}}),_0x223907=Date[_0x55b0b9(0xdc)]()-_0x2dd6c1;if(!_0x52ed71['ok']){const _0x2be9fe=await _0x52ed71['text']();loggerService_1[_0x55b0b9(0xf9)][_0x55b0b9(0x87)](_0x55b0b9(0xc3),_0x55b0b9(0xfa)+_0x866502,_0x52ed71[_0x55b0b9(0xe8)],_0x2be9fe,_0x223907);throw new Error(_0x55b0b9(0x98)+_0x52ed71[_0x55b0b9(0xe8)]);}const _0x57f41f=await _0x52ed71[_0x55b0b9(0x8e)]();loggerService_1[_0x55b0b9(0xf9)]['logWhiteDomainResponse']('noda',_0x55b0b9(0xfa)+_0x866502,_0x52ed71[_0x55b0b9(0xe8)],_0x57f41f,_0x223907);if(_0x57f41f['error']||_0x57f41f[_0x55b0b9(0x9d)]){loggerService_1[_0x55b0b9(0xf9)][_0x55b0b9(0xa6)](_0x55b0b9(0xc3),_0x55b0b9(0xfa)+_0x866502,_0x55b0b9(0xa0)+(_0x57f41f['message']||_0x57f41f[_0x55b0b9(0xe1)]||_0x55b0b9(0x9e)));throw new Error(_0x55b0b9(0xa0)+(_0x57f41f['message']||_0x57f41f[_0x55b0b9(0xe1)]||_0x55b0b9(0x9e)));}let _0x333b14=_0x55b0b9(0xca);if(_0x57f41f[_0x55b0b9(0xef)]===![]){if(_0x57f41f['expiryDate']){const _0x4187a0=new Date(_0x57f41f[_0x55b0b9(0x90)]),_0xe28263=new Date();_0x4187a0<_0xe28263?_0x333b14=_0x55b0b9(0xd6):_0x333b14='FAILED';}else _0x333b14=_0x55b0b9(0x95);}else _0x333b14=_0x55b0b9(0xca);return{'status':_0x333b14,'amount':_0x57f41f[_0x55b0b9(0xbe)],'currency':_0x57f41f[_0x55b0b9(0xe4)],'isActive':_0x57f41f['isActive']};}catch(_0x4e0187){console[_0x55b0b9(0xe1)](_0x55b0b9(0xcd),_0x4e0187),loggerService_1[_0x55b0b9(0xf9)]['logWhiteDomainError'](_0x55b0b9(0xc3),_0x55b0b9(0xfa)+_0x866502,_0x4e0187);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x4e0187 instanceof Error?_0x4e0187[_0x55b0b9(0xa5)]:_0x55b0b9(0x9e)));}}async[a44_0x5b603c(0xbb)](_0x5a4477){const _0x212a38=a44_0x5b603c;console[_0x212a38(0xbd)](_0x212a38(0xa2),_0x5a4477);let _0x4c31bf=_0x212a38(0xca);switch(_0x5a4477[_0x212a38(0x100)]?.['toLowerCase']()){case'done':case'completed':case'paid':case _0x212a38(0xa4):case'successful':_0x5a4477[_0x212a38(0xb5)]===_0x212a38(0x8c)?_0x4c31bf=_0x212a38(0x97):_0x4c31bf='PENDING';break;case _0x212a38(0x93):case'canceled':case _0x212a38(0x8b):case'error':case _0x212a38(0xda):_0x4c31bf=_0x212a38(0x95);break;case _0x212a38(0xf2):case _0x212a38(0xad):_0x4c31bf='EXPIRED';break;case _0x212a38(0xed):case _0x212a38(0x91):case _0x212a38(0xc5):case _0x212a38(0xe5):case _0x212a38(0x88):default:_0x4c31bf=_0x212a38(0xca);break;}return{'paymentId':_0x5a4477[_0x212a38(0xdb)]||_0x5a4477[_0x212a38(0xd0)],'status':_0x4c31bf,'amount':_0x5a4477[_0x212a38(0xe0)],'currency':_0x5a4477[_0x212a38(0xa7)],'additionalInfo':{'method':_0x5a4477[_0x212a38(0xb9)],'bankId':_0x5a4477[_0x212a38(0xfb)],'settled':_0x5a4477[_0x212a38(0xb5)],'settlementDate':_0x5a4477['SettlementDate'],'remitterName':_0x5a4477['Remitter']?.[_0x212a38(0xe6)],'remitterIban':_0x5a4477['Remitter']?.[_0x212a38(0xee)],'bankTransactionId':_0x5a4477[_0x212a38(0xf1)]}};}['verifyWebhookSignature'](_0x79c5a7,_0x11afe8){const _0x1429ce=a44_0x5b603c;return console[_0x1429ce(0xbd)](_0x1429ce(0xb0),{'receivedSignature':_0x11afe8,'paymentId':_0x79c5a7[_0x1429ce(0xd0)],'merchantPaymentId':_0x79c5a7[_0x1429ce(0xdb)]}),!![];}}exports[a44_0x5b603c(0xb7)]=NodaService;