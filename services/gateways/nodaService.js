'use strict';const a46_0x459f15=a46_0x483a;function a46_0x483a(_0x45bfa1,_0x7a9011){const _0x101355=a46_0x1013();return a46_0x483a=function(_0x483a0c,_0x1ca4b7){_0x483a0c=_0x483a0c-0x154;let _0x43c020=_0x101355[_0x483a0c];return _0x43c020;},a46_0x483a(_0x45bfa1,_0x7a9011);}(function(_0x26ff32,_0x5166b9){const _0x4990c0=a46_0x483a,_0x2867ab=_0x26ff32();while(!![]){try{const _0x487ac9=-parseInt(_0x4990c0(0x188))/0x1+-parseInt(_0x4990c0(0x160))/0x2*(-parseInt(_0x4990c0(0x1b6))/0x3)+-parseInt(_0x4990c0(0x1a7))/0x4+-parseInt(_0x4990c0(0x19a))/0x5+parseInt(_0x4990c0(0x191))/0x6+parseInt(_0x4990c0(0x196))/0x7+-parseInt(_0x4990c0(0x1c2))/0x8*(-parseInt(_0x4990c0(0x177))/0x9);if(_0x487ac9===_0x5166b9)break;else _0x2867ab['push'](_0x2867ab['shift']());}catch(_0x20a9a9){_0x2867ab['push'](_0x2867ab['shift']());}}}(a46_0x1013,0x84cc3));Object[a46_0x459f15(0x176)](exports,a46_0x459f15(0x1ba),{'value':!![]}),exports[a46_0x459f15(0x1c4)]=void 0x0;function a46_0x1013(){const _0x4e180e=['Currency','Settled','HTTP\x20error!\x20status:\x20','loggerService','stringify','6SfsvvO','Processing\x20Noda\x20webhook:','amount','in_progress','__esModule','text','Noda\x20payment\x20verification\x20error:','processing','../loggerService','Noda\x20webhook\x20signature\x20verification:','Short\x20Link:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','1928tVVuNa','completed','NodaService','Order\x20ID\x20Format:','createPaymentLink','Error\x20Message:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Unknown\x20error','apiUrl','log','Status','verifyWebhookSignature','PENDING','stack','statusText','Remitter','timeout','expiryDate','error','message','/payment-links/','Error\x20message:','571056VhLUWC','Business\x20Error:\x20','===\x20NODA\x20SUCCESS\x20===','Noda\x20API\x20error:\x20','Raw\x20Response\x20Body:','now','expired','qrCodeLink','POST','verifyPayment','headers','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','shortLink','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','URL:','Request\x20Body\x20(Direct\x20JSON):','status','noda','(8digits-8digits\x20format)','pending','successful','Amount','defineProperty','10386gDYZLF','failed','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','entries','cancelled','Headers:',',\x20body:\x20','https://tesoft.uk/gateway/pending.php?id=','Name','PaymentId','===\x20PARSED\x20NODA\x20RESPONSE\x20===','canceled','Response\x20Body:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','toLowerCase','Response\x20data:','Parsed\x20Result:','2702AhuAMS','shortLinkUrls','logWhiteDomainError','Status:','Iban','BankId','Error\x20details:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','(8digits-8digits\x20format\x20for\x20Noda)','2017608rhROAq','logWhiteDomainRequest','isActive','Yes','json','1284080MvATdL','created','Not\x20provided','FAILED','2302690NnZHIe','SettlementDate','Method','active','TesSoft\x20Payment\x20System/1.0','https://tesoft.uk/gateway/noda/webhook/','fromEntries','toUpperCase','QR\x20Code\x20Link:','application/json','logWhiteDomainResponse','MerchantPaymentId','===\x20NODA\x20SERVICE\x20ERROR\x20===','1446796lKbsUG','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','https://tesoft.uk/gateway/noda/','/payment-links','rejected','paid','HTTP\x20Status:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Status\x20Text:'];a46_0x1013=function(){return _0x4e180e;};return a46_0x1013();}const loggerService_1=require(a46_0x459f15(0x1be));class NodaService{constructor(){const _0x1d037f=a46_0x459f15;this[_0x1d037f(0x1cb)]=_0x1d037f(0x1a9),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a46_0x459f15(0x1c6)](_0x3e8afc){const _0x52da50=a46_0x459f15,{orderId:_0x31a839,name:_0x4d2f31,paymentDescription:_0x26ded4,amount:_0x561b11,currency:_0x5c12ca,webhookUrl:_0x157b42,returnUrl:_0x48f834,expiryDate:_0x368381}=_0x3e8afc,_0x19d732=_0x5c12ca[_0x52da50(0x1a1)](),_0x41c389=_0x52da50(0x19f),_0x2f7c5b=_0x52da50(0x17e)+_0x31a839,_0x2a7cbf={'name':_0x4d2f31,'paymentDescription':_0x26ded4,'amount':_0x561b11,'currency':_0x19d732,'paymentId':_0x31a839,'webhookUrl':_0x41c389,'returnUrl':_0x2f7c5b};_0x368381&&(_0x2a7cbf[_0x52da50(0x15b)]=_0x368381);const _0x463ec8=Date[_0x52da50(0x165)]();try{console[_0x52da50(0x1cc)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x52da50(0x1cc)](_0x52da50(0x16e),this[_0x52da50(0x1cb)]),console['log'](_0x52da50(0x16f),JSON[_0x52da50(0x1b5)](_0x2a7cbf,null,0x2)),console[_0x52da50(0x1cc)](_0x52da50(0x1c5),_0x31a839,_0x52da50(0x190)),console[_0x52da50(0x1cc)](_0x52da50(0x1c8),_0x2f7c5b),loggerService_1['loggerService'][_0x52da50(0x192)]('noda',_0x52da50(0x1aa),_0x52da50(0x168),_0x2a7cbf);const _0x36c284=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x52da50(0x1a3),'Accept':_0x52da50(0x1a3),'User-Agent':_0x52da50(0x19e)},'body':JSON[_0x52da50(0x1b5)](_0x2a7cbf)}),_0x1f32e0=Date['now']()-_0x463ec8;console[_0x52da50(0x1cc)](_0x52da50(0x1c9)),console[_0x52da50(0x1cc)](_0x52da50(0x18b),_0x36c284[_0x52da50(0x170)]),console[_0x52da50(0x1cc)](_0x52da50(0x1b0),_0x36c284[_0x52da50(0x158)]),console[_0x52da50(0x1cc)](_0x52da50(0x17c),Object[_0x52da50(0x1a0)](_0x36c284[_0x52da50(0x16a)][_0x52da50(0x17a)]())),console[_0x52da50(0x1cc)]('Response\x20Time:',_0x1f32e0+'ms');const _0x4ca644=await _0x36c284['text']();console['log'](_0x52da50(0x164),_0x4ca644);if(!_0x36c284['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x52da50(0x15c)](_0x52da50(0x1ad),_0x36c284[_0x52da50(0x170)]),console[_0x52da50(0x15c)](_0x52da50(0x183),_0x4ca644),loggerService_1[_0x52da50(0x1b4)][_0x52da50(0x1a4)](_0x52da50(0x171),_0x52da50(0x1aa),_0x36c284[_0x52da50(0x170)],_0x4ca644,_0x1f32e0),loggerService_1[_0x52da50(0x1b4)][_0x52da50(0x18a)](_0x52da50(0x171),_0x52da50(0x1aa),'HTTP\x20'+_0x36c284[_0x52da50(0x170)]+':\x20'+_0x4ca644);if(_0x36c284['status']===0x190)throw new Error(_0x52da50(0x16b));else{if(_0x36c284[_0x52da50(0x170)]===0x1f4)throw new Error(_0x52da50(0x1c1));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x36c284[_0x52da50(0x170)]+_0x52da50(0x17d)+_0x4ca644);}let _0x248439;try{_0x248439=JSON['parse'](_0x4ca644);}catch(_0x4493e4){console[_0x52da50(0x15c)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x4493e4),loggerService_1[_0x52da50(0x1b4)][_0x52da50(0x18a)](_0x52da50(0x171),_0x52da50(0x1aa),'JSON\x20Parse\x20Error:\x20'+_0x4493e4);throw new Error(_0x52da50(0x1af)+_0x4ca644);}console[_0x52da50(0x1cc)](_0x52da50(0x181)),console[_0x52da50(0x1cc)](_0x52da50(0x187),JSON['stringify'](_0x248439,null,0x2)),loggerService_1[_0x52da50(0x1b4)][_0x52da50(0x1a4)](_0x52da50(0x171),'/payment-links',_0x36c284[_0x52da50(0x170)],_0x248439,_0x1f32e0);if(_0x248439[_0x52da50(0x15c)]||_0x248439['statusCode']){const _0x103d33=_0x248439[_0x52da50(0x15d)]||_0x248439[_0x52da50(0x15c)]||'Unknown\x20error\x20from\x20Noda\x20API';console['error'](_0x52da50(0x1ae)),console[_0x52da50(0x15c)](_0x52da50(0x1c7),_0x103d33),console[_0x52da50(0x15c)]('Status\x20Code:',_0x248439['statusCode']),loggerService_1['loggerService']['logWhiteDomainError'](_0x52da50(0x171),_0x52da50(0x1aa),_0x52da50(0x161)+_0x103d33);throw new Error(_0x52da50(0x163)+_0x103d33);}if(!_0x248439['id']||!_0x248439[_0x52da50(0x189)]?.[_0x52da50(0x16c)]){console[_0x52da50(0x15c)](_0x52da50(0x179)),console[_0x52da50(0x15c)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x52da50(0x15c)](_0x52da50(0x186),_0x248439),loggerService_1['loggerService'][_0x52da50(0x18a)]('noda',_0x52da50(0x1aa),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x52da50(0x1a8));}return console[_0x52da50(0x1cc)](_0x52da50(0x162)),console[_0x52da50(0x1cc)]('Payment\x20Link\x20ID:',_0x248439['id']),console[_0x52da50(0x1cc)](_0x52da50(0x1c0),_0x248439['shortLinkUrls'][_0x52da50(0x16c)]),console['log'](_0x52da50(0x1a2),_0x248439[_0x52da50(0x189)]['qrCodeLink']||_0x52da50(0x198)),console['log']('Order\x20ID\x20Used:',_0x31a839,_0x52da50(0x172)),console[_0x52da50(0x1cc)](_0x52da50(0x184),_0x2f7c5b),{'gateway_payment_id':_0x248439['id'],'payment_url':_0x248439[_0x52da50(0x189)][_0x52da50(0x16c)],'qr_code_url':_0x248439['shortLinkUrls'][_0x52da50(0x167)],'expiry_date':_0x248439[_0x52da50(0x15b)]};}catch(_0x8bd41){console['error'](_0x52da50(0x1a6)),console[_0x52da50(0x15c)](_0x52da50(0x18e),_0x8bd41),loggerService_1['loggerService'][_0x52da50(0x18a)](_0x52da50(0x171),_0x52da50(0x1aa),_0x8bd41);if(_0x8bd41 instanceof Error){console[_0x52da50(0x15c)](_0x52da50(0x15f),_0x8bd41['message']),console[_0x52da50(0x15c)]('Error\x20stack:',_0x8bd41[_0x52da50(0x157)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x8bd41[_0x52da50(0x15d)]);}throw new Error(_0x52da50(0x16d));}}async[a46_0x459f15(0x169)](_0x2da41b){const _0x1ed94c=a46_0x459f15,_0x57a5ca=Date[_0x1ed94c(0x165)]();try{loggerService_1[_0x1ed94c(0x1b4)][_0x1ed94c(0x192)](_0x1ed94c(0x171),'/payment-links/'+_0x2da41b,'GET',{});const _0x194936=await fetch(this[_0x1ed94c(0x1cb)]+'/'+_0x2da41b,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x1ed94c(0x19e)}}),_0x555272=Date['now']()-_0x57a5ca;if(!_0x194936['ok']){const _0x3eecc7=await _0x194936[_0x1ed94c(0x1bb)]();loggerService_1[_0x1ed94c(0x1b4)]['logWhiteDomainResponse'](_0x1ed94c(0x171),'/payment-links/'+_0x2da41b,_0x194936[_0x1ed94c(0x170)],_0x3eecc7,_0x555272);throw new Error(_0x1ed94c(0x1b3)+_0x194936[_0x1ed94c(0x170)]);}const _0x4d768c=await _0x194936[_0x1ed94c(0x195)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1ed94c(0x171),_0x1ed94c(0x15e)+_0x2da41b,_0x194936['status'],_0x4d768c,_0x555272);if(_0x4d768c['error']||_0x4d768c['statusCode']){loggerService_1['loggerService'][_0x1ed94c(0x18a)]('noda','/payment-links/'+_0x2da41b,_0x1ed94c(0x163)+(_0x4d768c['message']||_0x4d768c[_0x1ed94c(0x15c)]||_0x1ed94c(0x1ca)));throw new Error(_0x1ed94c(0x163)+(_0x4d768c[_0x1ed94c(0x15d)]||_0x4d768c[_0x1ed94c(0x15c)]||_0x1ed94c(0x1ca)));}let _0x3432d4=_0x1ed94c(0x156);if(_0x4d768c[_0x1ed94c(0x193)]===![]){if(_0x4d768c[_0x1ed94c(0x15b)]){const _0x7c2c13=new Date(_0x4d768c[_0x1ed94c(0x15b)]),_0x2a15a4=new Date();_0x7c2c13<_0x2a15a4?_0x3432d4='EXPIRED':_0x3432d4='FAILED';}else _0x3432d4=_0x1ed94c(0x199);}else _0x3432d4='PENDING';return{'status':_0x3432d4,'amount':_0x4d768c[_0x1ed94c(0x1b8)],'currency':_0x4d768c['currency'],'isActive':_0x4d768c['isActive']};}catch(_0x2bd0bc){console[_0x1ed94c(0x15c)](_0x1ed94c(0x1bc),_0x2bd0bc),loggerService_1['loggerService'][_0x1ed94c(0x18a)](_0x1ed94c(0x171),_0x1ed94c(0x15e)+_0x2da41b,_0x2bd0bc);throw new Error(_0x1ed94c(0x18f)+(_0x2bd0bc instanceof Error?_0x2bd0bc[_0x1ed94c(0x15d)]:'Unknown\x20error'));}}async['processWebhook'](_0x16319e){const _0x1ed075=a46_0x459f15;console[_0x1ed075(0x1cc)](_0x1ed075(0x1b7),_0x16319e);let _0x5f354f=_0x1ed075(0x156);switch(_0x16319e[_0x1ed075(0x154)]?.[_0x1ed075(0x185)]()){case'done':case _0x1ed075(0x1c3):case _0x1ed075(0x1ac):case'success':case _0x1ed075(0x174):_0x16319e[_0x1ed075(0x1b2)]===_0x1ed075(0x194)?_0x5f354f='PAID':_0x5f354f=_0x1ed075(0x156);break;case _0x1ed075(0x17b):case _0x1ed075(0x182):case _0x1ed075(0x178):case _0x1ed075(0x15c):case _0x1ed075(0x1ab):_0x5f354f=_0x1ed075(0x199);break;case _0x1ed075(0x166):case _0x1ed075(0x15a):_0x5f354f='EXPIRED';break;case _0x1ed075(0x173):case _0x1ed075(0x197):case _0x1ed075(0x19d):case _0x1ed075(0x1bd):case _0x1ed075(0x1b9):default:_0x5f354f=_0x1ed075(0x156);break;}return{'paymentId':_0x16319e[_0x1ed075(0x1a5)]||_0x16319e['PaymentId'],'status':_0x5f354f,'amount':_0x16319e[_0x1ed075(0x175)],'currency':_0x16319e[_0x1ed075(0x1b1)],'additionalInfo':{'method':_0x16319e[_0x1ed075(0x19c)],'bankId':_0x16319e[_0x1ed075(0x18d)],'settled':_0x16319e[_0x1ed075(0x1b2)],'settlementDate':_0x16319e[_0x1ed075(0x19b)],'remitterName':_0x16319e[_0x1ed075(0x159)]?.[_0x1ed075(0x17f)],'remitterIban':_0x16319e[_0x1ed075(0x159)]?.[_0x1ed075(0x18c)],'bankTransactionId':_0x16319e['BankTransactionId']}};}[a46_0x459f15(0x155)](_0x5072ab,_0x30f381){const _0x281d7c=a46_0x459f15;return console[_0x281d7c(0x1cc)](_0x281d7c(0x1bf),{'receivedSignature':_0x30f381,'paymentId':_0x5072ab[_0x281d7c(0x180)],'merchantPaymentId':_0x5072ab[_0x281d7c(0x1a5)]}),!![];}}exports[a46_0x459f15(0x1c4)]=NodaService;