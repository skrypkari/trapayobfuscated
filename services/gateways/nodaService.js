'use strict';const a43_0x32ae58=a43_0x5521;function a43_0x4137(){const _0x4dd16f=['headers','Noda\x20payment\x20verification\x20error:','done','(8digits-8digits\x20format\x20for\x20Noda)','/payment-links','statusText','Payment\x20Link\x20ID:','noda','BankTransactionId','Raw\x20Response\x20Body:','HTTP\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','JSON\x20Parse\x20Error:\x20','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','processing','===\x20NODA\x20SERVICE\x20ERROR\x20===','QR\x20Code\x20Link:','Short\x20Link:','logWhiteDomainResponse','1820965AxvQfl','in_progress','Status:','MerchantPaymentId','366rXSfgn','json','parse','text','HTTP\x20error!\x20status:\x20','error','loggerService','Method','1909908TmIRTD','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','1829168MrRlfj','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','toUpperCase','logWhiteDomainRequest','verifyWebhookSignature','Response\x20Time:','stringify','Order\x20ID\x20Format:','statusCode','application/json','/payment-links/','Remitter','Response\x20Body:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','apiUrl','timeout','Iban','__esModule','Missing\x20id\x20or\x20shortLink\x20in\x20response','log','FAILED','TesSoft\x20Payment\x20System/1.0','===\x20NODA\x20SUCCESS\x20===','Parsed\x20Result:','GET','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','isActive','amount','Noda\x20webhook\x20signature\x20verification:','Unknown\x20error\x20from\x20Noda\x20API','NodaService','now','expiryDate','HTTP\x20Status:','PENDING','PAID','15861fGQDxI','status','shortLink','194640rEHUFN','../loggerService','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20stack:','currency','shortLinkUrls','logWhiteDomainError','completed','Currency','SettlementDate','Request\x20Body\x20(Direct\x20JSON):','created','stack','Processing\x20Noda\x20webhook:','PaymentId','message','4UXswqL','Error\x20Message:','Noda\x20API\x20error:\x20','Unknown\x20error','BankId','6425502vDCsSW',',\x20body:\x20','===\x20NODA\x20API\x20ERROR\x20===','Not\x20provided','entries','cancelled','Amount','POST','verifyPayment','801AlBwnH','Status\x20Code:','819600leddJU','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Status\x20Text:','EXPIRED','success','rejected','Response\x20data:','fromEntries','Settled','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Business\x20Error:\x20','qrCodeLink','===\x20PARSED\x20NODA\x20RESPONSE\x20===','pending'];a43_0x4137=function(){return _0x4dd16f;};return a43_0x4137();}(function(_0xfc8291,_0xf2cd15){const _0x5b7770=a43_0x5521,_0x145e35=_0xfc8291();while(!![]){try{const _0x594819=parseInt(_0x5b7770(0x1ed))/0x1+parseInt(_0x5b7770(0x213))/0x2*(-parseInt(_0x5b7770(0x242))/0x3)+-parseInt(_0x5b7770(0x255))/0x4*(parseInt(_0x5b7770(0x20f))/0x5)+-parseInt(_0x5b7770(0x25a))/0x6+parseInt(_0x5b7770(0x21b))/0x7+parseInt(_0x5b7770(0x21d))/0x8+parseInt(_0x5b7770(0x263))/0x9*(parseInt(_0x5b7770(0x245))/0xa);if(_0x594819===_0xf2cd15)break;else _0x145e35['push'](_0x145e35['shift']());}catch(_0xb2c34e){_0x145e35['push'](_0x145e35['shift']());}}}(a43_0x4137,0x9ee03));function a43_0x5521(_0x492727,_0x2b257a){const _0x4137ee=a43_0x4137();return a43_0x5521=function(_0x55211e,_0x48719e){_0x55211e=_0x55211e-0x1ed;let _0x246c24=_0x4137ee[_0x55211e];return _0x246c24;},a43_0x5521(_0x492727,_0x2b257a);}Object['defineProperty'](exports,a43_0x32ae58(0x22f),{'value':!![]}),exports[a43_0x32ae58(0x23c)]=void 0x0;const loggerService_1=require(a43_0x32ae58(0x246));class NodaService{constructor(){const _0x3b80a0=a43_0x32ae58;this[_0x3b80a0(0x22c)]='https://tesoft.uk/gateway/noda/',console[_0x3b80a0(0x231)](_0x3b80a0(0x21c));}async['createPaymentLink'](_0x1d20cf){const _0x1ea77f=a43_0x32ae58,{orderId:_0x2260c9,name:_0x38349f,paymentDescription:_0x45de7a,amount:_0x5e6798,currency:_0x3a7ff1,webhookUrl:_0x9dcb6,returnUrl:_0x1dd8a0,expiryDate:_0x465f77}=_0x1d20cf,_0x47a692=_0x3a7ff1[_0x1ea77f(0x220)](),_0x1ee9c0='https://tesoft.uk/gateway/noda/webhook/',_0x3785e8='https://tesoft.uk/gateway/pending.php?id='+_0x2260c9,_0x13179b={'name':_0x38349f,'paymentDescription':_0x45de7a,'amount':_0x5e6798,'currency':_0x47a692,'paymentId':_0x2260c9,'webhookUrl':_0x1ee9c0,'returnUrl':_0x3785e8};_0x465f77&&(_0x13179b[_0x1ea77f(0x23e)]=_0x465f77);const _0x1b5372=Date[_0x1ea77f(0x23d)]();try{console[_0x1ea77f(0x231)](_0x1ea77f(0x208)),console['log']('URL:',this[_0x1ea77f(0x22c)]),console[_0x1ea77f(0x231)](_0x1ea77f(0x24f),JSON[_0x1ea77f(0x224)](_0x13179b,null,0x2)),console[_0x1ea77f(0x231)](_0x1ea77f(0x225),_0x2260c9,_0x1ea77f(0x1fe)),console[_0x1ea77f(0x231)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x3785e8),loggerService_1['loggerService'][_0x1ea77f(0x221)]('noda',_0x1ea77f(0x1ff),_0x1ea77f(0x261),_0x13179b);const _0x4bb51a=await fetch(this['apiUrl'],{'method':_0x1ea77f(0x261),'headers':{'Content-Type':_0x1ea77f(0x227),'Accept':_0x1ea77f(0x227),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1ea77f(0x224)](_0x13179b)}),_0x399c30=Date['now']()-_0x1b5372;console[_0x1ea77f(0x231)](_0x1ea77f(0x209)),console[_0x1ea77f(0x231)](_0x1ea77f(0x211),_0x4bb51a['status']),console[_0x1ea77f(0x231)](_0x1ea77f(0x1ef),_0x4bb51a[_0x1ea77f(0x200)]),console[_0x1ea77f(0x231)]('Headers:',Object[_0x1ea77f(0x1f4)](_0x4bb51a[_0x1ea77f(0x1fb)][_0x1ea77f(0x25e)]())),console[_0x1ea77f(0x231)](_0x1ea77f(0x223),_0x399c30+'ms');const _0x3062b2=await _0x4bb51a[_0x1ea77f(0x216)]();console[_0x1ea77f(0x231)](_0x1ea77f(0x204),_0x3062b2);if(!_0x4bb51a['ok']){console[_0x1ea77f(0x218)](_0x1ea77f(0x25c)),console[_0x1ea77f(0x218)](_0x1ea77f(0x23f),_0x4bb51a[_0x1ea77f(0x243)]),console[_0x1ea77f(0x218)](_0x1ea77f(0x22a),_0x3062b2),loggerService_1[_0x1ea77f(0x219)][_0x1ea77f(0x20e)](_0x1ea77f(0x202),_0x1ea77f(0x1ff),_0x4bb51a['status'],_0x3062b2,_0x399c30),loggerService_1[_0x1ea77f(0x219)][_0x1ea77f(0x24b)](_0x1ea77f(0x202),'/payment-links',_0x1ea77f(0x205)+_0x4bb51a[_0x1ea77f(0x243)]+':\x20'+_0x3062b2);if(_0x4bb51a[_0x1ea77f(0x243)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x4bb51a['status']===0x1f4)throw new Error(_0x1ea77f(0x21e));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x4bb51a[_0x1ea77f(0x243)]+_0x1ea77f(0x25b)+_0x3062b2);}let _0x25ad84;try{_0x25ad84=JSON[_0x1ea77f(0x215)](_0x3062b2);}catch(_0x336c93){console[_0x1ea77f(0x218)](_0x1ea77f(0x247),_0x336c93),loggerService_1[_0x1ea77f(0x219)]['logWhiteDomainError'](_0x1ea77f(0x202),'/payment-links',_0x1ea77f(0x207)+_0x336c93);throw new Error(_0x1ea77f(0x1f6)+_0x3062b2);}console[_0x1ea77f(0x231)](_0x1ea77f(0x1f9)),console[_0x1ea77f(0x231)](_0x1ea77f(0x235),JSON[_0x1ea77f(0x224)](_0x25ad84,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0x1ea77f(0x1ff),_0x4bb51a[_0x1ea77f(0x243)],_0x25ad84,_0x399c30);if(_0x25ad84[_0x1ea77f(0x218)]||_0x25ad84[_0x1ea77f(0x226)]){const _0x469cf3=_0x25ad84['message']||_0x25ad84['error']||_0x1ea77f(0x23b);console[_0x1ea77f(0x218)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x1ea77f(0x256),_0x469cf3),console[_0x1ea77f(0x218)](_0x1ea77f(0x264),_0x25ad84[_0x1ea77f(0x226)]),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x1ea77f(0x1ff),_0x1ea77f(0x1f7)+_0x469cf3);throw new Error(_0x1ea77f(0x257)+_0x469cf3);}if(!_0x25ad84['id']||!_0x25ad84['shortLinkUrls']?.[_0x1ea77f(0x244)]){console[_0x1ea77f(0x218)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x1ea77f(0x230)),console['error'](_0x1ea77f(0x1f3),_0x25ad84),loggerService_1[_0x1ea77f(0x219)][_0x1ea77f(0x24b)](_0x1ea77f(0x202),_0x1ea77f(0x1ff),_0x1ea77f(0x1ee));throw new Error(_0x1ea77f(0x22b));}return console[_0x1ea77f(0x231)](_0x1ea77f(0x234)),console[_0x1ea77f(0x231)](_0x1ea77f(0x201),_0x25ad84['id']),console[_0x1ea77f(0x231)](_0x1ea77f(0x20d),_0x25ad84[_0x1ea77f(0x24a)][_0x1ea77f(0x244)]),console[_0x1ea77f(0x231)](_0x1ea77f(0x20c),_0x25ad84[_0x1ea77f(0x24a)][_0x1ea77f(0x1f8)]||_0x1ea77f(0x25d)),console[_0x1ea77f(0x231)]('Order\x20ID\x20Used:',_0x2260c9,'(8digits-8digits\x20format)'),console[_0x1ea77f(0x231)](_0x1ea77f(0x237),_0x3785e8),{'gateway_payment_id':_0x25ad84['id'],'payment_url':_0x25ad84[_0x1ea77f(0x24a)][_0x1ea77f(0x244)],'qr_code_url':_0x25ad84[_0x1ea77f(0x24a)]['qrCodeLink'],'expiry_date':_0x25ad84[_0x1ea77f(0x23e)]};}catch(_0x5c2a35){console[_0x1ea77f(0x218)](_0x1ea77f(0x20b)),console[_0x1ea77f(0x218)]('Error\x20details:',_0x5c2a35),loggerService_1[_0x1ea77f(0x219)][_0x1ea77f(0x24b)](_0x1ea77f(0x202),_0x1ea77f(0x1ff),_0x5c2a35);if(_0x5c2a35 instanceof Error){console[_0x1ea77f(0x218)]('Error\x20message:',_0x5c2a35[_0x1ea77f(0x254)]),console[_0x1ea77f(0x218)](_0x1ea77f(0x248),_0x5c2a35[_0x1ea77f(0x251)]);throw new Error(_0x1ea77f(0x21f)+_0x5c2a35[_0x1ea77f(0x254)]);}throw new Error(_0x1ea77f(0x206));}}async[a43_0x32ae58(0x262)](_0x37f538){const _0x4310ad=a43_0x32ae58,_0x5609b1=Date[_0x4310ad(0x23d)]();try{loggerService_1['loggerService'][_0x4310ad(0x221)](_0x4310ad(0x202),_0x4310ad(0x228)+_0x37f538,_0x4310ad(0x236),{});const _0x34a927=await fetch(this[_0x4310ad(0x22c)]+'/'+_0x37f538,{'method':_0x4310ad(0x236),'headers':{'Content-Type':'application/json','User-Agent':_0x4310ad(0x233)}}),_0x3d4f04=Date[_0x4310ad(0x23d)]()-_0x5609b1;if(!_0x34a927['ok']){const _0x504381=await _0x34a927[_0x4310ad(0x216)]();loggerService_1[_0x4310ad(0x219)][_0x4310ad(0x20e)](_0x4310ad(0x202),'/payment-links/'+_0x37f538,_0x34a927[_0x4310ad(0x243)],_0x504381,_0x3d4f04);throw new Error(_0x4310ad(0x217)+_0x34a927[_0x4310ad(0x243)]);}const _0x4ca883=await _0x34a927[_0x4310ad(0x214)]();loggerService_1[_0x4310ad(0x219)]['logWhiteDomainResponse'](_0x4310ad(0x202),_0x4310ad(0x228)+_0x37f538,_0x34a927[_0x4310ad(0x243)],_0x4ca883,_0x3d4f04);if(_0x4ca883[_0x4310ad(0x218)]||_0x4ca883[_0x4310ad(0x226)]){loggerService_1[_0x4310ad(0x219)]['logWhiteDomainError'](_0x4310ad(0x202),_0x4310ad(0x228)+_0x37f538,_0x4310ad(0x257)+(_0x4ca883['message']||_0x4ca883['error']||_0x4310ad(0x258)));throw new Error('Noda\x20API\x20error:\x20'+(_0x4ca883[_0x4310ad(0x254)]||_0x4ca883[_0x4310ad(0x218)]||_0x4310ad(0x258)));}let _0x3e28dc='PENDING';if(_0x4ca883[_0x4310ad(0x238)]===![]){if(_0x4ca883['expiryDate']){const _0x5d057b=new Date(_0x4ca883[_0x4310ad(0x23e)]),_0x47498c=new Date();_0x5d057b<_0x47498c?_0x3e28dc='EXPIRED':_0x3e28dc=_0x4310ad(0x232);}else _0x3e28dc=_0x4310ad(0x232);}else _0x3e28dc='PENDING';return{'status':_0x3e28dc,'amount':_0x4ca883[_0x4310ad(0x239)],'currency':_0x4ca883[_0x4310ad(0x249)],'isActive':_0x4ca883['isActive']};}catch(_0x2a88cd){console['error'](_0x4310ad(0x1fc),_0x2a88cd),loggerService_1[_0x4310ad(0x219)][_0x4310ad(0x24b)](_0x4310ad(0x202),_0x4310ad(0x228)+_0x37f538,_0x2a88cd);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x2a88cd instanceof Error?_0x2a88cd[_0x4310ad(0x254)]:_0x4310ad(0x258)));}}async['processWebhook'](_0x91355f){const _0x511927=a43_0x32ae58;console['log'](_0x511927(0x252),_0x91355f);let _0x498727=_0x511927(0x240);switch(_0x91355f['Status']?.['toLowerCase']()){case _0x511927(0x1fd):case _0x511927(0x24c):case'paid':case _0x511927(0x1f1):case'successful':_0x91355f[_0x511927(0x1f5)]==='Yes'?_0x498727=_0x511927(0x241):_0x498727=_0x511927(0x240);break;case _0x511927(0x25f):case'canceled':case'failed':case'error':case _0x511927(0x1f2):_0x498727=_0x511927(0x232);break;case'expired':case _0x511927(0x22d):_0x498727=_0x511927(0x1f0);break;case _0x511927(0x1fa):case _0x511927(0x250):case'active':case _0x511927(0x20a):case _0x511927(0x210):default:_0x498727='PENDING';break;}return{'paymentId':_0x91355f['MerchantPaymentId']||_0x91355f[_0x511927(0x253)],'status':_0x498727,'amount':_0x91355f[_0x511927(0x260)],'currency':_0x91355f[_0x511927(0x24d)],'additionalInfo':{'method':_0x91355f[_0x511927(0x21a)],'bankId':_0x91355f[_0x511927(0x259)],'settled':_0x91355f[_0x511927(0x1f5)],'settlementDate':_0x91355f[_0x511927(0x24e)],'remitterName':_0x91355f[_0x511927(0x229)]?.['Name'],'remitterIban':_0x91355f[_0x511927(0x229)]?.[_0x511927(0x22e)],'bankTransactionId':_0x91355f[_0x511927(0x203)]}};}[a43_0x32ae58(0x222)](_0x10ba1f,_0x1abeab){const _0x1ee751=a43_0x32ae58;return console['log'](_0x1ee751(0x23a),{'receivedSignature':_0x1abeab,'paymentId':_0x10ba1f['PaymentId'],'merchantPaymentId':_0x10ba1f[_0x1ee751(0x212)]}),!![];}}exports[a43_0x32ae58(0x23c)]=NodaService;