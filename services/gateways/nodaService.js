'use strict';const a43_0x56b86f=a43_0x4cc1;(function(_0x14b37c,_0x3ba249){const _0x1c8db6=a43_0x4cc1,_0x3ed1f1=_0x14b37c();while(!![]){try{const _0x53dac8=-parseInt(_0x1c8db6(0x147))/0x1*(-parseInt(_0x1c8db6(0x12a))/0x2)+-parseInt(_0x1c8db6(0x148))/0x3+-parseInt(_0x1c8db6(0xdd))/0x4+parseInt(_0x1c8db6(0xe2))/0x5*(parseInt(_0x1c8db6(0xd7))/0x6)+parseInt(_0x1c8db6(0x13d))/0x7*(-parseInt(_0x1c8db6(0xeb))/0x8)+parseInt(_0x1c8db6(0xd9))/0x9*(-parseInt(_0x1c8db6(0x132))/0xa)+-parseInt(_0x1c8db6(0xed))/0xb*(-parseInt(_0x1c8db6(0x122))/0xc);if(_0x53dac8===_0x3ba249)break;else _0x3ed1f1['push'](_0x3ed1f1['shift']());}catch(_0x6102e6){_0x3ed1f1['push'](_0x3ed1f1['shift']());}}}(a43_0x45b0,0xa6ede));Object[a43_0x56b86f(0x139)](exports,a43_0x56b86f(0xf6),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a43_0x56b86f(0x13e));function a43_0x45b0(){const _0x4b544b=['Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Status:',',\x20body:\x20','apiUrl','FAILED','6PmrdCs','MerchantPaymentId','223326ZcEsBE','Headers:','TesSoft\x20Payment\x20System/1.0','processWebhook','1751316JbkDYI','Noda\x20API\x20error:\x20','stack','in_progress','toUpperCase','897015MStqrQ','Status','logWhiteDomainRequest','HTTP\x20','statusCode','Currency','Unknown\x20error','POST','===\x20NODA\x20API\x20ERROR\x20===','3790312wiqkfC','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','242VyCePU','Error\x20Message:','Raw\x20Response\x20Body:','statusText','EXPIRED','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status\x20Code:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Name','__esModule','createPaymentLink','BankTransactionId','Not\x20provided','toLowerCase','done','/payment-links','headers','PaymentId','logWhiteDomainError','loggerService','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Noda\x20payment\x20verification\x20error:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','GET','Response\x20Time:','currency','created','now','entries','PAID','Order\x20ID\x20Used:','message','log','stringify','/payment-links/','(8digits-8digits\x20format)','Error\x20message:','NodaService','status','shortLink','Parsed\x20Result:','Status\x20Text:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','PENDING','rejected','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Remitter','Missing\x20id\x20or\x20shortLink\x20in\x20response','Failed\x20to\x20verify\x20Noda\x20payment:\x20','https://tesoft.uk/gateway/noda/webhook/','Business\x20Error:\x20','===\x20PARSED\x20NODA\x20RESPONSE\x20===','1193904OolOxe','timeout','SettlementDate','shortLinkUrls','isActive','Settled','fromEntries','Response\x20data:','9014LPnklP','Unknown\x20error\x20from\x20Noda\x20API','Yes','noda','QR\x20Code\x20Link:','https://tesoft.uk/gateway/pending.php?id=','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','URL:','470XcdVDb','JSON\x20Parse\x20Error:\x20','successful','application/json','completed','text','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','defineProperty','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','failed','cancelled','14feOAsH','../loggerService','===\x20NODA\x20SERVICE\x20ERROR\x20===','expiryDate','qrCodeLink','Failed\x20to\x20parse\x20JSON\x20response:','https://tesoft.uk/gateway/noda/','verifyWebhookSignature','Error\x20details:','expired','225hhwPTO','440685rQTimP','error','Processing\x20Noda\x20webhook:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','logWhiteDomainResponse'];a43_0x45b0=function(){return _0x4b544b;};return a43_0x45b0();}function a43_0x4cc1(_0xff7684,_0x52c41c){const _0x45b0b4=a43_0x45b0();return a43_0x4cc1=function(_0x4cc10f,_0x1a8ed4){_0x4cc10f=_0x4cc10f-0xd5;let _0x2578af=_0x45b0b4[_0x4cc10f];return _0x2578af;},a43_0x4cc1(_0xff7684,_0x52c41c);}class NodaService{constructor(){const _0x5cc8a6=a43_0x56b86f;this[_0x5cc8a6(0xd5)]=_0x5cc8a6(0x143),console['log'](_0x5cc8a6(0xf4));}async[a43_0x56b86f(0xf7)](_0x194bf1){const _0x31b886=a43_0x56b86f,{orderId:_0x27e14a,name:_0x419c3a,paymentDescription:_0x10afe5,amount:_0x5da5db,currency:_0x1423a8,webhookUrl:_0x1a4dd9,returnUrl:_0x39a358,expiryDate:_0x229e35}=_0x194bf1,_0xa7ef66=_0x1423a8[_0x31b886(0xe1)](),_0x2481cb=_0x31b886(0x11f),_0x22daab=_0x31b886(0x12f)+_0x27e14a,_0x4b9479={'name':_0x419c3a,'paymentDescription':_0x10afe5,'amount':_0x5da5db,'currency':_0xa7ef66,'paymentId':_0x27e14a,'webhookUrl':_0x2481cb,'returnUrl':_0x22daab};_0x229e35&&(_0x4b9479['expiryDate']=_0x229e35);const _0x242710=Date['now']();try{console[_0x31b886(0x10e)](_0x31b886(0x101)),console[_0x31b886(0x10e)](_0x31b886(0x131),this[_0x31b886(0xd5)]),console[_0x31b886(0x10e)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x31b886(0x10f)](_0x4b9479,null,0x2)),console[_0x31b886(0x10e)]('Order\x20ID\x20Format:',_0x27e14a,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x31b886(0x10e)](_0x31b886(0x118),_0x22daab),loggerService_1[_0x31b886(0x100)][_0x31b886(0xe4)](_0x31b886(0x12d),_0x31b886(0xfc),'POST',_0x4b9479);const _0x552b99=await fetch(this[_0x31b886(0xd5)],{'method':_0x31b886(0xe9),'headers':{'Content-Type':_0x31b886(0x135),'Accept':_0x31b886(0x135),'User-Agent':_0x31b886(0xdb)},'body':JSON['stringify'](_0x4b9479)}),_0x50250c=Date[_0x31b886(0x109)]()-_0x242710;console[_0x31b886(0x10e)](_0x31b886(0xf2)),console[_0x31b886(0x10e)](_0x31b886(0x14e),_0x552b99['status']),console[_0x31b886(0x10e)](_0x31b886(0x117),_0x552b99[_0x31b886(0xf0)]),console[_0x31b886(0x10e)](_0x31b886(0xda),Object[_0x31b886(0x128)](_0x552b99[_0x31b886(0xfd)][_0x31b886(0x10a)]())),console[_0x31b886(0x10e)](_0x31b886(0x106),_0x50250c+'ms');const _0x4d4846=await _0x552b99[_0x31b886(0x137)]();console[_0x31b886(0x10e)](_0x31b886(0xef),_0x4d4846);if(!_0x552b99['ok']){console[_0x31b886(0x149)](_0x31b886(0xea)),console[_0x31b886(0x149)]('HTTP\x20Status:',_0x552b99[_0x31b886(0x114)]),console[_0x31b886(0x149)]('Response\x20Body:',_0x4d4846),loggerService_1[_0x31b886(0x100)][_0x31b886(0x14c)](_0x31b886(0x12d),'/payment-links',_0x552b99[_0x31b886(0x114)],_0x4d4846,_0x50250c),loggerService_1[_0x31b886(0x100)][_0x31b886(0xff)](_0x31b886(0x12d),_0x31b886(0xfc),_0x31b886(0xe5)+_0x552b99['status']+':\x20'+_0x4d4846);if(_0x552b99[_0x31b886(0x114)]===0x190)throw new Error(_0x31b886(0x14b));else{if(_0x552b99['status']===0x1f4)throw new Error(_0x31b886(0x130));}throw new Error(_0x31b886(0x104)+_0x552b99['status']+_0x31b886(0x14f)+_0x4d4846);}let _0x437add;try{_0x437add=JSON['parse'](_0x4d4846);}catch(_0x684816){console['error'](_0x31b886(0x142),_0x684816),loggerService_1['loggerService'][_0x31b886(0xff)](_0x31b886(0x12d),_0x31b886(0xfc),_0x31b886(0x133)+_0x684816);throw new Error(_0x31b886(0x13a)+_0x4d4846);}console[_0x31b886(0x10e)](_0x31b886(0x121)),console[_0x31b886(0x10e)](_0x31b886(0x116),JSON['stringify'](_0x437add,null,0x2)),loggerService_1[_0x31b886(0x100)]['logWhiteDomainResponse'](_0x31b886(0x12d),_0x31b886(0xfc),_0x552b99[_0x31b886(0x114)],_0x437add,_0x50250c);if(_0x437add[_0x31b886(0x149)]||_0x437add[_0x31b886(0xe6)]){const _0x9303b8=_0x437add[_0x31b886(0x10d)]||_0x437add[_0x31b886(0x149)]||_0x31b886(0x12b);console['error'](_0x31b886(0x103)),console[_0x31b886(0x149)](_0x31b886(0xee),_0x9303b8),console[_0x31b886(0x149)](_0x31b886(0xf3),_0x437add[_0x31b886(0xe6)]),loggerService_1[_0x31b886(0x100)][_0x31b886(0xff)](_0x31b886(0x12d),_0x31b886(0xfc),_0x31b886(0x120)+_0x9303b8);throw new Error(_0x31b886(0xde)+_0x9303b8);}if(!_0x437add['id']||!_0x437add['shortLinkUrls']?.[_0x31b886(0x115)]){console[_0x31b886(0x149)](_0x31b886(0x138)),console['error'](_0x31b886(0x11d)),console[_0x31b886(0x149)](_0x31b886(0x129),_0x437add),loggerService_1[_0x31b886(0x100)][_0x31b886(0xff)]('noda',_0x31b886(0xfc),_0x31b886(0xec));throw new Error(_0x31b886(0x14d));}return console[_0x31b886(0x10e)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x31b886(0x10e)]('Payment\x20Link\x20ID:',_0x437add['id']),console[_0x31b886(0x10e)]('Short\x20Link:',_0x437add[_0x31b886(0x125)][_0x31b886(0x115)]),console['log'](_0x31b886(0x12e),_0x437add[_0x31b886(0x125)][_0x31b886(0x141)]||_0x31b886(0xf9)),console[_0x31b886(0x10e)](_0x31b886(0x10c),_0x27e14a,_0x31b886(0x111)),console[_0x31b886(0x10e)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x22daab),{'gateway_payment_id':_0x437add['id'],'payment_url':_0x437add[_0x31b886(0x125)][_0x31b886(0x115)],'qr_code_url':_0x437add[_0x31b886(0x125)]['qrCodeLink'],'expiry_date':_0x437add[_0x31b886(0x140)]};}catch(_0x3c568a){console[_0x31b886(0x149)](_0x31b886(0x13f)),console[_0x31b886(0x149)](_0x31b886(0x145),_0x3c568a),loggerService_1['loggerService'][_0x31b886(0xff)]('noda','/payment-links',_0x3c568a);if(_0x3c568a instanceof Error){console[_0x31b886(0x149)](_0x31b886(0x112),_0x3c568a[_0x31b886(0x10d)]),console['error']('Error\x20stack:',_0x3c568a[_0x31b886(0xdf)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x3c568a[_0x31b886(0x10d)]);}throw new Error(_0x31b886(0x11b));}}async['verifyPayment'](_0x4f5a11){const _0x27b737=a43_0x56b86f,_0x3b4787=Date[_0x27b737(0x109)]();try{loggerService_1[_0x27b737(0x100)][_0x27b737(0xe4)]('noda',_0x27b737(0x110)+_0x4f5a11,_0x27b737(0x105),{});const _0x55a57a=await fetch(this[_0x27b737(0xd5)]+'/'+_0x4f5a11,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x27b737(0xdb)}}),_0x532dca=Date[_0x27b737(0x109)]()-_0x3b4787;if(!_0x55a57a['ok']){const _0x51717f=await _0x55a57a[_0x27b737(0x137)]();loggerService_1[_0x27b737(0x100)][_0x27b737(0x14c)](_0x27b737(0x12d),_0x27b737(0x110)+_0x4f5a11,_0x55a57a[_0x27b737(0x114)],_0x51717f,_0x532dca);throw new Error('HTTP\x20error!\x20status:\x20'+_0x55a57a['status']);}const _0x1e9978=await _0x55a57a['json']();loggerService_1['loggerService'][_0x27b737(0x14c)](_0x27b737(0x12d),_0x27b737(0x110)+_0x4f5a11,_0x55a57a[_0x27b737(0x114)],_0x1e9978,_0x532dca);if(_0x1e9978[_0x27b737(0x149)]||_0x1e9978[_0x27b737(0xe6)]){loggerService_1[_0x27b737(0x100)]['logWhiteDomainError'](_0x27b737(0x12d),_0x27b737(0x110)+_0x4f5a11,'Noda\x20API\x20error:\x20'+(_0x1e9978[_0x27b737(0x10d)]||_0x1e9978[_0x27b737(0x149)]||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x1e9978['message']||_0x1e9978[_0x27b737(0x149)]||'Unknown\x20error'));}let _0x55bc3d=_0x27b737(0x119);if(_0x1e9978[_0x27b737(0x126)]===![]){if(_0x1e9978[_0x27b737(0x140)]){const _0x5f3999=new Date(_0x1e9978['expiryDate']),_0x1dff38=new Date();_0x5f3999<_0x1dff38?_0x55bc3d=_0x27b737(0xf1):_0x55bc3d='FAILED';}else _0x55bc3d='FAILED';}else _0x55bc3d='PENDING';return{'status':_0x55bc3d,'amount':_0x1e9978['amount'],'currency':_0x1e9978[_0x27b737(0x107)],'isActive':_0x1e9978[_0x27b737(0x126)]};}catch(_0x31f1e1){console[_0x27b737(0x149)](_0x27b737(0x102),_0x31f1e1),loggerService_1[_0x27b737(0x100)][_0x27b737(0xff)]('noda',_0x27b737(0x110)+_0x4f5a11,_0x31f1e1);throw new Error(_0x27b737(0x11e)+(_0x31f1e1 instanceof Error?_0x31f1e1['message']:_0x27b737(0xe8)));}}async[a43_0x56b86f(0xdc)](_0x46f8b5){const _0x4da51b=a43_0x56b86f;console[_0x4da51b(0x10e)](_0x4da51b(0x14a),_0x46f8b5);let _0xc89e9f=_0x4da51b(0x119);switch(_0x46f8b5[_0x4da51b(0xe3)]?.[_0x4da51b(0xfa)]()){case _0x4da51b(0xfb):case _0x4da51b(0x136):case'paid':case'success':case _0x4da51b(0x134):_0x46f8b5[_0x4da51b(0x127)]===_0x4da51b(0x12c)?_0xc89e9f=_0x4da51b(0x10b):_0xc89e9f=_0x4da51b(0x119);break;case _0x4da51b(0x13c):case'canceled':case _0x4da51b(0x13b):case _0x4da51b(0x149):case _0x4da51b(0x11a):_0xc89e9f=_0x4da51b(0xd6);break;case _0x4da51b(0x146):case _0x4da51b(0x123):_0xc89e9f=_0x4da51b(0xf1);break;case'pending':case _0x4da51b(0x108):case'active':case'processing':case _0x4da51b(0xe0):default:_0xc89e9f=_0x4da51b(0x119);break;}return{'paymentId':_0x46f8b5[_0x4da51b(0xd8)]||_0x46f8b5[_0x4da51b(0xfe)],'status':_0xc89e9f,'amount':_0x46f8b5['Amount'],'currency':_0x46f8b5[_0x4da51b(0xe7)],'additionalInfo':{'method':_0x46f8b5['Method'],'bankId':_0x46f8b5['BankId'],'settled':_0x46f8b5[_0x4da51b(0x127)],'settlementDate':_0x46f8b5[_0x4da51b(0x124)],'remitterName':_0x46f8b5[_0x4da51b(0x11c)]?.[_0x4da51b(0xf5)],'remitterIban':_0x46f8b5[_0x4da51b(0x11c)]?.['Iban'],'bankTransactionId':_0x46f8b5[_0x4da51b(0xf8)]}};}[a43_0x56b86f(0x144)](_0x4a6845,_0x2fee63){const _0x10946d=a43_0x56b86f;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x2fee63,'paymentId':_0x4a6845[_0x10946d(0xfe)],'merchantPaymentId':_0x4a6845[_0x10946d(0xd8)]}),!![];}}exports[a43_0x56b86f(0x113)]=NodaService;