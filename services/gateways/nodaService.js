'use strict';const a51_0x392221=a51_0x2e44;(function(_0x38a428,_0x38d5d8){const _0x126860=a51_0x2e44,_0x336ccb=_0x38a428();while(!![]){try{const _0x361595=parseInt(_0x126860(0x207))/0x1+parseInt(_0x126860(0x1b1))/0x2*(-parseInt(_0x126860(0x1f4))/0x3)+-parseInt(_0x126860(0x1cd))/0x4+-parseInt(_0x126860(0x1e1))/0x5*(-parseInt(_0x126860(0x20a))/0x6)+parseInt(_0x126860(0x20f))/0x7+parseInt(_0x126860(0x1cb))/0x8*(-parseInt(_0x126860(0x208))/0x9)+parseInt(_0x126860(0x1dd))/0xa;if(_0x361595===_0x38d5d8)break;else _0x336ccb['push'](_0x336ccb['shift']());}catch(_0x10303a){_0x336ccb['push'](_0x336ccb['shift']());}}}(a51_0x35e0,0x7471a));function a51_0x35e0(){const _0x56d2a3=['amount','Short\x20Link:','Headers:','Error\x20details:','fromEntries','active','Noda\x20API\x20error:\x20','GET','statusCode','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','apiUrl','verifyPayment','loggerService','Payment\x20System/1.0','failed','498680MhLwHB','297882dgypaS','BankId','6hDLhvs','QR\x20Code\x20Link:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','noda','expired','598143kNPMOJ','POST','now','log','qrCodeLink','===\x20NODA\x20SUCCESS\x20===','logWhiteDomainError','===\x20NODA\x20SERVICE\x20ERROR\x20===','Name','Settled','Status\x20Code:','shortLinkUrls','/payment-links','Response\x20data:','__esModule','rejected','Response\x20Time:','(8digits-8digits\x20format)','done','entries','logWhiteDomainRequest','defineProperty','===\x20PARSED\x20NODA\x20RESPONSE\x20===','toUpperCase','in_progress','1504XXTcNv','NodaService','verifyWebhookSignature','Unknown\x20error\x20from\x20Noda\x20API','JSON\x20Parse\x20Error:\x20','https://tesoft.uk/gateway/noda/','PaymentId','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','/payment-links/','cancelled','createPaymentLink','Remitter','HTTP\x20','PENDING','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','currency','Request\x20Body\x20(Direct\x20JSON):','isActive','Error\x20message:','toLowerCase','HTTP\x20error!\x20status:\x20','stringify','Noda\x20payment\x20verification\x20error:','paid','statusText','152IFDZpQ','timeout','1303168FxYzqE','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Amount','Noda\x20webhook\x20signature\x20verification:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Order\x20ID\x20Format:','text','logWhiteDomainResponse','error','MerchantPaymentId','processing','message','status','completed','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Failed\x20to\x20parse\x20JSON\x20response:','6296590PoKYCb','Raw\x20Response\x20Body:','created','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','2965340cbWdkx','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Missing\x20id\x20or\x20shortLink\x20in\x20response','json','Response\x20Body:','application/json','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Error\x20stack:','Parsed\x20Result:','PAID','Unknown\x20error','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20Status:','expiryDate','https://tesoft.uk/gateway/pending.php?id=','===\x20NODA\x20API\x20ERROR\x20===','Error\x20Message:','1497zBRIRc','pending','FAILED','../loggerService'];a51_0x35e0=function(){return _0x56d2a3;};return a51_0x35e0();}Object[a51_0x392221(0x224)](exports,a51_0x392221(0x21d),{'value':!![]}),exports[a51_0x392221(0x1b2)]=void 0x0;const loggerService_1=require(a51_0x392221(0x1f7));function a51_0x2e44(_0x9838cb,_0x30947d){const _0x35e02c=a51_0x35e0();return a51_0x2e44=function(_0x2e4428,_0x3d1176){_0x2e4428=_0x2e4428-0x1ae;let _0x4a9eb2=_0x35e02c[_0x2e4428];return _0x4a9eb2;},a51_0x2e44(_0x9838cb,_0x30947d);}class NodaService{constructor(){const _0x4da6b0=a51_0x392221;this['apiUrl']=_0x4da6b0(0x1b6),console[_0x4da6b0(0x212)](_0x4da6b0(0x1e3));}async[a51_0x392221(0x1bb)](_0x59688e){const _0x58c7d7=a51_0x392221,{orderId:_0x3a2bea,name:_0x5ebe37,paymentDescription:_0x4dcfe7,amount:_0x24026f,currency:_0x66bfbd,webhookUrl:_0x34f175,returnUrl:_0xad22a4,expiryDate:_0x3f72b4}=_0x59688e,_0x2a413f=_0x66bfbd[_0x58c7d7(0x1af)](),_0x16caf2='https://tesoft.uk/gateway/noda/webhook/',_0x546108=_0x58c7d7(0x1f1)+_0x3a2bea,_0x33fbc8={'name':_0x5ebe37,'paymentDescription':_0x4dcfe7,'amount':_0x24026f,'currency':_0x2a413f,'paymentId':_0x3a2bea,'webhookUrl':_0x16caf2,'returnUrl':_0x546108};_0x3f72b4&&(_0x33fbc8[_0x58c7d7(0x1f0)]=_0x3f72b4);const _0xba466b=Date['now']();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x58c7d7(0x212)]('URL:',this['apiUrl']),console['log'](_0x58c7d7(0x1c2),JSON[_0x58c7d7(0x1c7)](_0x33fbc8,null,0x2)),console[_0x58c7d7(0x212)](_0x58c7d7(0x1d2),_0x3a2bea,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x58c7d7(0x212)](_0x58c7d7(0x1e8),_0x546108),loggerService_1[_0x58c7d7(0x204)]['logWhiteDomainRequest']('noda',_0x58c7d7(0x21b),_0x58c7d7(0x210),_0x33fbc8);const _0x21fc53=await fetch(this['apiUrl'],{'method':_0x58c7d7(0x210),'headers':{'Content-Type':'application/json','Accept':_0x58c7d7(0x1e7),'User-Agent':_0x58c7d7(0x205)},'body':JSON[_0x58c7d7(0x1c7)](_0x33fbc8)}),_0xa7a376=Date[_0x58c7d7(0x211)]()-_0xba466b;console[_0x58c7d7(0x212)](_0x58c7d7(0x20c)),console[_0x58c7d7(0x212)]('Status:',_0x21fc53[_0x58c7d7(0x1d9)]),console[_0x58c7d7(0x212)]('Status\x20Text:',_0x21fc53[_0x58c7d7(0x1ca)]),console[_0x58c7d7(0x212)](_0x58c7d7(0x1fa),Object[_0x58c7d7(0x1fc)](_0x21fc53['headers'][_0x58c7d7(0x222)]())),console['log'](_0x58c7d7(0x21f),_0xa7a376+'ms');const _0x40e0fb=await _0x21fc53[_0x58c7d7(0x1d3)]();console[_0x58c7d7(0x212)](_0x58c7d7(0x1de),_0x40e0fb);if(!_0x21fc53['ok']){console[_0x58c7d7(0x1d5)](_0x58c7d7(0x1f2)),console[_0x58c7d7(0x1d5)](_0x58c7d7(0x1ef),_0x21fc53[_0x58c7d7(0x1d9)]),console[_0x58c7d7(0x1d5)](_0x58c7d7(0x1e6),_0x40e0fb),loggerService_1[_0x58c7d7(0x204)][_0x58c7d7(0x1d4)]('noda',_0x58c7d7(0x21b),_0x21fc53[_0x58c7d7(0x1d9)],_0x40e0fb,_0xa7a376),loggerService_1['loggerService']['logWhiteDomainError'](_0x58c7d7(0x20d),'/payment-links',_0x58c7d7(0x1bd)+_0x21fc53[_0x58c7d7(0x1d9)]+':\x20'+_0x40e0fb);if(_0x21fc53[_0x58c7d7(0x1d9)]===0x190)throw new Error(_0x58c7d7(0x1e0));else{if(_0x21fc53[_0x58c7d7(0x1d9)]===0x1f4)throw new Error(_0x58c7d7(0x1c0));}throw new Error(_0x58c7d7(0x1c6)+_0x21fc53[_0x58c7d7(0x1d9)]+',\x20body:\x20'+_0x40e0fb);}let _0x3b2200;try{_0x3b2200=JSON['parse'](_0x40e0fb);}catch(_0x524007){console['error'](_0x58c7d7(0x1dc),_0x524007),loggerService_1[_0x58c7d7(0x204)]['logWhiteDomainError']('noda',_0x58c7d7(0x21b),_0x58c7d7(0x1b5)+_0x524007);throw new Error(_0x58c7d7(0x1ce)+_0x40e0fb);}console[_0x58c7d7(0x212)](_0x58c7d7(0x1ae)),console[_0x58c7d7(0x212)](_0x58c7d7(0x1ea),JSON[_0x58c7d7(0x1c7)](_0x3b2200,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x58c7d7(0x20d),_0x58c7d7(0x21b),_0x21fc53[_0x58c7d7(0x1d9)],_0x3b2200,_0xa7a376);if(_0x3b2200[_0x58c7d7(0x1d5)]||_0x3b2200[_0x58c7d7(0x200)]){const _0x2bda18=_0x3b2200[_0x58c7d7(0x1d8)]||_0x3b2200['error']||_0x58c7d7(0x1b4);console[_0x58c7d7(0x1d5)](_0x58c7d7(0x1ee)),console[_0x58c7d7(0x1d5)](_0x58c7d7(0x1f3),_0x2bda18),console[_0x58c7d7(0x1d5)](_0x58c7d7(0x219),_0x3b2200[_0x58c7d7(0x200)]),loggerService_1[_0x58c7d7(0x204)][_0x58c7d7(0x215)]('noda','/payment-links','Business\x20Error:\x20'+_0x2bda18);throw new Error('Noda\x20API\x20error:\x20'+_0x2bda18);}if(!_0x3b2200['id']||!_0x3b2200[_0x58c7d7(0x21a)]?.['shortLink']){console[_0x58c7d7(0x1d5)](_0x58c7d7(0x1b8)),console[_0x58c7d7(0x1d5)](_0x58c7d7(0x1e4)),console[_0x58c7d7(0x1d5)](_0x58c7d7(0x21c),_0x3b2200),loggerService_1[_0x58c7d7(0x204)][_0x58c7d7(0x215)]('noda',_0x58c7d7(0x21b),_0x58c7d7(0x1bf));throw new Error(_0x58c7d7(0x1ed));}return console[_0x58c7d7(0x212)](_0x58c7d7(0x214)),console[_0x58c7d7(0x212)]('Payment\x20Link\x20ID:',_0x3b2200['id']),console['log'](_0x58c7d7(0x1f9),_0x3b2200[_0x58c7d7(0x21a)]['shortLink']),console[_0x58c7d7(0x212)](_0x58c7d7(0x20b),_0x3b2200['shortLinkUrls'][_0x58c7d7(0x213)]||'Not\x20provided'),console[_0x58c7d7(0x212)]('Order\x20ID\x20Used:',_0x3a2bea,_0x58c7d7(0x220)),console['log'](_0x58c7d7(0x1d1),_0x546108),{'gateway_payment_id':_0x3b2200['id'],'payment_url':_0x3b2200[_0x58c7d7(0x21a)]['shortLink'],'qr_code_url':_0x3b2200[_0x58c7d7(0x21a)][_0x58c7d7(0x213)],'expiry_date':_0x3b2200[_0x58c7d7(0x1f0)]};}catch(_0x412a59){console[_0x58c7d7(0x1d5)](_0x58c7d7(0x216)),console[_0x58c7d7(0x1d5)](_0x58c7d7(0x1fb),_0x412a59),loggerService_1[_0x58c7d7(0x204)][_0x58c7d7(0x215)](_0x58c7d7(0x20d),_0x58c7d7(0x21b),_0x412a59);if(_0x412a59 instanceof Error){console[_0x58c7d7(0x1d5)](_0x58c7d7(0x1c4),_0x412a59['message']),console[_0x58c7d7(0x1d5)](_0x58c7d7(0x1e9),_0x412a59['stack']);throw new Error(_0x58c7d7(0x201)+_0x412a59['message']);}throw new Error(_0x58c7d7(0x1e2));}}async[a51_0x392221(0x203)](_0xfc4a8f){const _0x5ba4b9=a51_0x392221,_0x56bce9=Date[_0x5ba4b9(0x211)]();try{loggerService_1[_0x5ba4b9(0x204)][_0x5ba4b9(0x223)](_0x5ba4b9(0x20d),_0x5ba4b9(0x1b9)+_0xfc4a8f,_0x5ba4b9(0x1ff),{});const _0xc86776=await fetch(this[_0x5ba4b9(0x202)]+'/'+_0xfc4a8f,{'method':_0x5ba4b9(0x1ff),'headers':{'Content-Type':_0x5ba4b9(0x1e7),'User-Agent':_0x5ba4b9(0x205)}}),_0x4f6403=Date[_0x5ba4b9(0x211)]()-_0x56bce9;if(!_0xc86776['ok']){const _0x21a51f=await _0xc86776[_0x5ba4b9(0x1d3)]();loggerService_1[_0x5ba4b9(0x204)][_0x5ba4b9(0x1d4)](_0x5ba4b9(0x20d),'/payment-links/'+_0xfc4a8f,_0xc86776[_0x5ba4b9(0x1d9)],_0x21a51f,_0x4f6403);throw new Error(_0x5ba4b9(0x1c6)+_0xc86776['status']);}const _0x465342=await _0xc86776[_0x5ba4b9(0x1e5)]();loggerService_1[_0x5ba4b9(0x204)][_0x5ba4b9(0x1d4)](_0x5ba4b9(0x20d),_0x5ba4b9(0x1b9)+_0xfc4a8f,_0xc86776[_0x5ba4b9(0x1d9)],_0x465342,_0x4f6403);if(_0x465342[_0x5ba4b9(0x1d5)]||_0x465342[_0x5ba4b9(0x200)]){loggerService_1[_0x5ba4b9(0x204)][_0x5ba4b9(0x215)]('noda','/payment-links/'+_0xfc4a8f,_0x5ba4b9(0x1fe)+(_0x465342[_0x5ba4b9(0x1d8)]||_0x465342[_0x5ba4b9(0x1d5)]||'Unknown\x20error'));throw new Error(_0x5ba4b9(0x1fe)+(_0x465342['message']||_0x465342['error']||_0x5ba4b9(0x1ec)));}let _0x3f9a2a=_0x5ba4b9(0x1be);if(_0x465342[_0x5ba4b9(0x1c3)]===![]){if(_0x465342[_0x5ba4b9(0x1f0)]){const _0x14acc6=new Date(_0x465342['expiryDate']),_0x22fff0=new Date();_0x14acc6<_0x22fff0?_0x3f9a2a='EXPIRED':_0x3f9a2a=_0x5ba4b9(0x1f6);}else _0x3f9a2a=_0x5ba4b9(0x1f6);}else _0x3f9a2a=_0x5ba4b9(0x1be);return{'status':_0x3f9a2a,'amount':_0x465342[_0x5ba4b9(0x1f8)],'currency':_0x465342[_0x5ba4b9(0x1c1)],'isActive':_0x465342[_0x5ba4b9(0x1c3)]};}catch(_0x4cd2cc){console['error'](_0x5ba4b9(0x1c8),_0x4cd2cc),loggerService_1[_0x5ba4b9(0x204)][_0x5ba4b9(0x215)]('noda',_0x5ba4b9(0x1b9)+_0xfc4a8f,_0x4cd2cc);throw new Error(_0x5ba4b9(0x1db)+(_0x4cd2cc instanceof Error?_0x4cd2cc[_0x5ba4b9(0x1d8)]:_0x5ba4b9(0x1ec)));}}async['processWebhook'](_0x3f0604){const _0x28f671=a51_0x392221;console[_0x28f671(0x212)]('Processing\x20Noda\x20webhook:',_0x3f0604);let _0x23f7de=_0x28f671(0x1be);switch(_0x3f0604['Status']?.[_0x28f671(0x1c5)]()){case _0x28f671(0x221):case _0x28f671(0x1da):case _0x28f671(0x1c9):case'success':case'successful':_0x3f0604['Settled']==='Yes'?_0x23f7de=_0x28f671(0x1eb):_0x23f7de='PENDING';break;case _0x28f671(0x1ba):case'canceled':case _0x28f671(0x206):case'error':case _0x28f671(0x21e):_0x23f7de=_0x28f671(0x1f6);break;case _0x28f671(0x20e):case _0x28f671(0x1cc):_0x23f7de='EXPIRED';break;case _0x28f671(0x1f5):case _0x28f671(0x1df):case _0x28f671(0x1fd):case _0x28f671(0x1d7):case _0x28f671(0x1b0):default:_0x23f7de=_0x28f671(0x1be);break;}return{'paymentId':_0x3f0604[_0x28f671(0x1d6)]||_0x3f0604[_0x28f671(0x1b7)],'status':_0x23f7de,'amount':_0x3f0604[_0x28f671(0x1cf)],'currency':_0x3f0604['Currency'],'additionalInfo':{'method':_0x3f0604['Method'],'bankId':_0x3f0604[_0x28f671(0x209)],'settled':_0x3f0604[_0x28f671(0x218)],'settlementDate':_0x3f0604['SettlementDate'],'remitterName':_0x3f0604[_0x28f671(0x1bc)]?.[_0x28f671(0x217)],'remitterIban':_0x3f0604[_0x28f671(0x1bc)]?.['Iban'],'bankTransactionId':_0x3f0604['BankTransactionId']}};}[a51_0x392221(0x1b3)](_0x2a4de1,_0x2c59e1){const _0x549f3f=a51_0x392221;return console['log'](_0x549f3f(0x1d0),{'receivedSignature':_0x2c59e1,'paymentId':_0x2a4de1['PaymentId'],'merchantPaymentId':_0x2a4de1[_0x549f3f(0x1d6)]}),!![];}}exports[a51_0x392221(0x1b2)]=NodaService;