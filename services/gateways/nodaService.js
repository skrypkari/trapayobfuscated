'use strict';const a43_0x3234ec=a43_0x219e;(function(_0x20d3e1,_0x5172d9){const _0x5194d3=a43_0x219e,_0x493b83=_0x20d3e1();while(!![]){try{const _0x332f66=parseInt(_0x5194d3(0x1b9))/0x1+-parseInt(_0x5194d3(0x1f0))/0x2+-parseInt(_0x5194d3(0x1f7))/0x3+parseInt(_0x5194d3(0x1b7))/0x4*(parseInt(_0x5194d3(0x1ea))/0x5)+parseInt(_0x5194d3(0x1db))/0x6+-parseInt(_0x5194d3(0x1e3))/0x7*(-parseInt(_0x5194d3(0x1bc))/0x8)+-parseInt(_0x5194d3(0x18b))/0x9*(parseInt(_0x5194d3(0x1f4))/0xa);if(_0x332f66===_0x5172d9)break;else _0x493b83['push'](_0x493b83['shift']());}catch(_0x2a227f){_0x493b83['push'](_0x493b83['shift']());}}}(a43_0xde4b,0xe4490));Object[a43_0x3234ec(0x1b4)](exports,'__esModule',{'value':!![]}),exports[a43_0x3234ec(0x1eb)]=void 0x0;const loggerService_1=require(a43_0x3234ec(0x1a4));function a43_0xde4b(){const _0xaf9e7a=['../loggerService','status','Noda\x20webhook\x20signature\x20verification:','Not\x20provided','message','Response\x20data:','Parsed\x20Result:','application/json','Status','Payment\x20Link\x20ID:','active','Response\x20Body:','shortLinkUrls','Yes','EXPIRED','FAILED','defineProperty','Headers:','(8digits-8digits\x20format\x20for\x20Noda)','4qytxeY','Response\x20Time:','1214964IfibYW','https://tesoft.uk/gateway/noda/','PENDING','24152vTncJl','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Request\x20Body\x20(Direct\x20JSON):','(8digits-8digits\x20format)','Method','entries','logWhiteDomainRequest','Unknown\x20error','statusCode','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','MerchantPaymentId','json','shortLink','createPaymentLink','timeout','HTTP\x20Status:','headers','Business\x20Error:\x20','now','Remitter','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Missing\x20id\x20or\x20shortLink\x20in\x20response',',\x20body:\x20','created','verifyPayment','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Status\x20Text:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Order\x20ID\x20Used:','Failed\x20to\x20parse\x20JSON\x20response:','fromEntries','1882422qKTWoR','Amount','expiryDate','PaymentId','parse','stack','failed','/payment-links','3703isesIN','success','HTTP\x20','SettlementDate','in_progress','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','verifyWebhookSignature','7199345JFgunb','NodaService','QR\x20Code\x20Link:','/payment-links/','log','noda','1837812SStdsO','loggerService','done','HTTP\x20error!\x20status:\x20','567390URcaPS','Processing\x20Noda\x20webhook:','canceled','2347599kTSNzq','https://tesoft.uk/gateway/noda/webhook/','error','qrCodeLink','Currency','stringify','Status\x20Code:','logWhiteDomainError','GET','toUpperCase','Settled','306ThahTt','apiUrl','isActive','===\x20NODA\x20SUCCESS\x20===','processWebhook','Raw\x20Response\x20Body:','Noda\x20payment\x20verification\x20error:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Error\x20details:','pending','URL:','Short\x20Link:','processing','statusText','TesSoft\x20Payment\x20System/1.0','Order\x20ID\x20Format:','BankTransactionId','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Error\x20message:','rejected','amount','Unknown\x20error\x20from\x20Noda\x20API','text','logWhiteDomainResponse','POST'];a43_0xde4b=function(){return _0xaf9e7a;};return a43_0xde4b();}class NodaService{constructor(){const _0x4797e3=a43_0x3234ec;this[_0x4797e3(0x18c)]=_0x4797e3(0x1ba),console[_0x4797e3(0x1ee)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a43_0x3234ec(0x1c9)](_0x370af9){const _0x3f21c0=a43_0x3234ec,{orderId:_0x561d9e,name:_0x258bd7,paymentDescription:_0x331aaa,amount:_0x2ba9cc,currency:_0xfbeaf6,webhookUrl:_0x53dc08,returnUrl:_0x12e117,expiryDate:_0x1ca559}=_0x370af9,_0x1e35d2=_0xfbeaf6[_0x3f21c0(0x200)](),_0x14f607=_0x3f21c0(0x1f8),_0x4ac234='https://tesoft.uk/gateway/pending.php?id='+_0x561d9e,_0x3968e8={'name':_0x258bd7,'paymentDescription':_0x331aaa,'amount':_0x2ba9cc,'currency':_0x1e35d2,'paymentId':_0x561d9e,'webhookUrl':_0x14f607,'returnUrl':_0x4ac234};_0x1ca559&&(_0x3968e8[_0x3f21c0(0x1dd)]=_0x1ca559);const _0x383984=Date[_0x3f21c0(0x1ce)]();try{console[_0x3f21c0(0x1ee)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x3f21c0(0x1ee)](_0x3f21c0(0x195),this[_0x3f21c0(0x18c)]),console[_0x3f21c0(0x1ee)](_0x3f21c0(0x1be),JSON[_0x3f21c0(0x1fc)](_0x3968e8,null,0x2)),console['log'](_0x3f21c0(0x19a),_0x561d9e,_0x3f21c0(0x1b6)),console[_0x3f21c0(0x1ee)](_0x3f21c0(0x19c),_0x4ac234),loggerService_1[_0x3f21c0(0x1f1)][_0x3f21c0(0x1c2)](_0x3f21c0(0x1ef),_0x3f21c0(0x1e2),_0x3f21c0(0x1a3),_0x3968e8);const _0x31a2bb=await fetch(this['apiUrl'],{'method':_0x3f21c0(0x1a3),'headers':{'Content-Type':_0x3f21c0(0x1ab),'Accept':_0x3f21c0(0x1ab),'User-Agent':_0x3f21c0(0x199)},'body':JSON[_0x3f21c0(0x1fc)](_0x3968e8)}),_0x1b312f=Date[_0x3f21c0(0x1ce)]()-_0x383984;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log']('Status:',_0x31a2bb[_0x3f21c0(0x1a5)]),console[_0x3f21c0(0x1ee)](_0x3f21c0(0x1d6),_0x31a2bb[_0x3f21c0(0x198)]),console[_0x3f21c0(0x1ee)](_0x3f21c0(0x1b5),Object[_0x3f21c0(0x1da)](_0x31a2bb[_0x3f21c0(0x1cc)][_0x3f21c0(0x1c1)]())),console[_0x3f21c0(0x1ee)](_0x3f21c0(0x1b8),_0x1b312f+'ms');const _0xb5dbd8=await _0x31a2bb[_0x3f21c0(0x1a1)]();console[_0x3f21c0(0x1ee)](_0x3f21c0(0x190),_0xb5dbd8);if(!_0x31a2bb['ok']){console[_0x3f21c0(0x1f9)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x3f21c0(0x1f9)](_0x3f21c0(0x1cb),_0x31a2bb['status']),console['error'](_0x3f21c0(0x1af),_0xb5dbd8),loggerService_1[_0x3f21c0(0x1f1)][_0x3f21c0(0x1a2)]('noda',_0x3f21c0(0x1e2),_0x31a2bb[_0x3f21c0(0x1a5)],_0xb5dbd8,_0x1b312f),loggerService_1[_0x3f21c0(0x1f1)][_0x3f21c0(0x1fe)]('noda','/payment-links',_0x3f21c0(0x1e5)+_0x31a2bb['status']+':\x20'+_0xb5dbd8);if(_0x31a2bb[_0x3f21c0(0x1a5)]===0x190)throw new Error(_0x3f21c0(0x1bd));else{if(_0x31a2bb[_0x3f21c0(0x1a5)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x3f21c0(0x1f3)+_0x31a2bb[_0x3f21c0(0x1a5)]+_0x3f21c0(0x1d2)+_0xb5dbd8);}let _0x19fe47;try{_0x19fe47=JSON[_0x3f21c0(0x1df)](_0xb5dbd8);}catch(_0xe4a459){console[_0x3f21c0(0x1f9)](_0x3f21c0(0x1d9),_0xe4a459),loggerService_1[_0x3f21c0(0x1f1)]['logWhiteDomainError'](_0x3f21c0(0x1ef),_0x3f21c0(0x1e2),'JSON\x20Parse\x20Error:\x20'+_0xe4a459);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0xb5dbd8);}console[_0x3f21c0(0x1ee)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x3f21c0(0x1ee)](_0x3f21c0(0x1aa),JSON[_0x3f21c0(0x1fc)](_0x19fe47,null,0x2)),loggerService_1[_0x3f21c0(0x1f1)][_0x3f21c0(0x1a2)](_0x3f21c0(0x1ef),_0x3f21c0(0x1e2),_0x31a2bb[_0x3f21c0(0x1a5)],_0x19fe47,_0x1b312f);if(_0x19fe47[_0x3f21c0(0x1f9)]||_0x19fe47[_0x3f21c0(0x1c4)]){const _0x302226=_0x19fe47[_0x3f21c0(0x1a8)]||_0x19fe47[_0x3f21c0(0x1f9)]||_0x3f21c0(0x1a0);console[_0x3f21c0(0x1f9)](_0x3f21c0(0x1d0)),console[_0x3f21c0(0x1f9)]('Error\x20Message:',_0x302226),console[_0x3f21c0(0x1f9)](_0x3f21c0(0x1fd),_0x19fe47[_0x3f21c0(0x1c4)]),loggerService_1[_0x3f21c0(0x1f1)][_0x3f21c0(0x1fe)]('noda',_0x3f21c0(0x1e2),_0x3f21c0(0x1cd)+_0x302226);throw new Error('Noda\x20API\x20error:\x20'+_0x302226);}if(!_0x19fe47['id']||!_0x19fe47['shortLinkUrls']?.[_0x3f21c0(0x1c8)]){console[_0x3f21c0(0x1f9)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3f21c0(0x1f9)](_0x3f21c0(0x1d1)),console[_0x3f21c0(0x1f9)](_0x3f21c0(0x1a9),_0x19fe47),loggerService_1[_0x3f21c0(0x1f1)][_0x3f21c0(0x1fe)](_0x3f21c0(0x1ef),'/payment-links',_0x3f21c0(0x1e8));throw new Error(_0x3f21c0(0x1d5));}return console['log'](_0x3f21c0(0x18e)),console[_0x3f21c0(0x1ee)](_0x3f21c0(0x1ad),_0x19fe47['id']),console[_0x3f21c0(0x1ee)](_0x3f21c0(0x196),_0x19fe47['shortLinkUrls'][_0x3f21c0(0x1c8)]),console[_0x3f21c0(0x1ee)](_0x3f21c0(0x1ec),_0x19fe47[_0x3f21c0(0x1b0)][_0x3f21c0(0x1fa)]||_0x3f21c0(0x1a7)),console[_0x3f21c0(0x1ee)](_0x3f21c0(0x1d8),_0x561d9e,_0x3f21c0(0x1bf)),console[_0x3f21c0(0x1ee)](_0x3f21c0(0x1c5),_0x4ac234),{'gateway_payment_id':_0x19fe47['id'],'payment_url':_0x19fe47[_0x3f21c0(0x1b0)][_0x3f21c0(0x1c8)],'qr_code_url':_0x19fe47[_0x3f21c0(0x1b0)][_0x3f21c0(0x1fa)],'expiry_date':_0x19fe47[_0x3f21c0(0x1dd)]};}catch(_0xa53faf){console[_0x3f21c0(0x1f9)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x3f21c0(0x1f9)](_0x3f21c0(0x193),_0xa53faf),loggerService_1[_0x3f21c0(0x1f1)]['logWhiteDomainError'](_0x3f21c0(0x1ef),_0x3f21c0(0x1e2),_0xa53faf);if(_0xa53faf instanceof Error){console[_0x3f21c0(0x1f9)](_0x3f21c0(0x19d),_0xa53faf[_0x3f21c0(0x1a8)]),console[_0x3f21c0(0x1f9)]('Error\x20stack:',_0xa53faf[_0x3f21c0(0x1e0)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0xa53faf[_0x3f21c0(0x1a8)]);}throw new Error(_0x3f21c0(0x1d7));}}async[a43_0x3234ec(0x1d4)](_0x201f58){const _0x6d7898=a43_0x3234ec,_0x569640=Date[_0x6d7898(0x1ce)]();try{loggerService_1['loggerService'][_0x6d7898(0x1c2)]('noda',_0x6d7898(0x1ed)+_0x201f58,_0x6d7898(0x1ff),{});const _0x15e65e=await fetch(this[_0x6d7898(0x18c)]+'/'+_0x201f58,{'method':'GET','headers':{'Content-Type':_0x6d7898(0x1ab),'User-Agent':_0x6d7898(0x199)}}),_0x18ad99=Date[_0x6d7898(0x1ce)]()-_0x569640;if(!_0x15e65e['ok']){const _0x52ac8a=await _0x15e65e[_0x6d7898(0x1a1)]();loggerService_1[_0x6d7898(0x1f1)][_0x6d7898(0x1a2)](_0x6d7898(0x1ef),_0x6d7898(0x1ed)+_0x201f58,_0x15e65e['status'],_0x52ac8a,_0x18ad99);throw new Error('HTTP\x20error!\x20status:\x20'+_0x15e65e[_0x6d7898(0x1a5)]);}const _0x388627=await _0x15e65e[_0x6d7898(0x1c7)]();loggerService_1[_0x6d7898(0x1f1)]['logWhiteDomainResponse'](_0x6d7898(0x1ef),'/payment-links/'+_0x201f58,_0x15e65e[_0x6d7898(0x1a5)],_0x388627,_0x18ad99);if(_0x388627[_0x6d7898(0x1f9)]||_0x388627['statusCode']){loggerService_1[_0x6d7898(0x1f1)][_0x6d7898(0x1fe)](_0x6d7898(0x1ef),_0x6d7898(0x1ed)+_0x201f58,'Noda\x20API\x20error:\x20'+(_0x388627[_0x6d7898(0x1a8)]||_0x388627['error']||_0x6d7898(0x1c3)));throw new Error('Noda\x20API\x20error:\x20'+(_0x388627[_0x6d7898(0x1a8)]||_0x388627[_0x6d7898(0x1f9)]||_0x6d7898(0x1c3)));}let _0x50db79=_0x6d7898(0x1bb);if(_0x388627[_0x6d7898(0x18d)]===![]){if(_0x388627[_0x6d7898(0x1dd)]){const _0x5edc26=new Date(_0x388627[_0x6d7898(0x1dd)]),_0x49fe22=new Date();_0x5edc26<_0x49fe22?_0x50db79=_0x6d7898(0x1b2):_0x50db79=_0x6d7898(0x1b3);}else _0x50db79=_0x6d7898(0x1b3);}else _0x50db79=_0x6d7898(0x1bb);return{'status':_0x50db79,'amount':_0x388627[_0x6d7898(0x19f)],'currency':_0x388627['currency'],'isActive':_0x388627[_0x6d7898(0x18d)]};}catch(_0x461109){console['error'](_0x6d7898(0x191),_0x461109),loggerService_1[_0x6d7898(0x1f1)][_0x6d7898(0x1fe)](_0x6d7898(0x1ef),_0x6d7898(0x1ed)+_0x201f58,_0x461109);throw new Error(_0x6d7898(0x192)+(_0x461109 instanceof Error?_0x461109[_0x6d7898(0x1a8)]:'Unknown\x20error'));}}async[a43_0x3234ec(0x18f)](_0x2fd7bc){const _0x11000e=a43_0x3234ec;console['log'](_0x11000e(0x1f5),_0x2fd7bc);let _0x1ed3a7=_0x11000e(0x1bb);switch(_0x2fd7bc[_0x11000e(0x1ac)]?.['toLowerCase']()){case _0x11000e(0x1f2):case'completed':case'paid':case _0x11000e(0x1e4):case'successful':_0x2fd7bc[_0x11000e(0x201)]===_0x11000e(0x1b1)?_0x1ed3a7='PAID':_0x1ed3a7=_0x11000e(0x1bb);break;case'cancelled':case _0x11000e(0x1f6):case _0x11000e(0x1e1):case _0x11000e(0x1f9):case _0x11000e(0x19e):_0x1ed3a7='FAILED';break;case'expired':case _0x11000e(0x1ca):_0x1ed3a7='EXPIRED';break;case _0x11000e(0x194):case _0x11000e(0x1d3):case _0x11000e(0x1ae):case _0x11000e(0x197):case _0x11000e(0x1e7):default:_0x1ed3a7='PENDING';break;}return{'paymentId':_0x2fd7bc['MerchantPaymentId']||_0x2fd7bc[_0x11000e(0x1de)],'status':_0x1ed3a7,'amount':_0x2fd7bc[_0x11000e(0x1dc)],'currency':_0x2fd7bc[_0x11000e(0x1fb)],'additionalInfo':{'method':_0x2fd7bc[_0x11000e(0x1c0)],'bankId':_0x2fd7bc['BankId'],'settled':_0x2fd7bc[_0x11000e(0x201)],'settlementDate':_0x2fd7bc[_0x11000e(0x1e6)],'remitterName':_0x2fd7bc[_0x11000e(0x1cf)]?.['Name'],'remitterIban':_0x2fd7bc['Remitter']?.['Iban'],'bankTransactionId':_0x2fd7bc[_0x11000e(0x19b)]}};}[a43_0x3234ec(0x1e9)](_0x3f1286,_0x478f1b){const _0x352b59=a43_0x3234ec;return console[_0x352b59(0x1ee)](_0x352b59(0x1a6),{'receivedSignature':_0x478f1b,'paymentId':_0x3f1286[_0x352b59(0x1de)],'merchantPaymentId':_0x3f1286[_0x352b59(0x1c6)]}),!![];}}function a43_0x219e(_0x24ca49,_0x4d4081){const _0xde4bc0=a43_0xde4b();return a43_0x219e=function(_0x219e8a,_0x436200){_0x219e8a=_0x219e8a-0x18b;let _0x7443f5=_0xde4bc0[_0x219e8a];return _0x7443f5;},a43_0x219e(_0x24ca49,_0x4d4081);}exports[a43_0x3234ec(0x1eb)]=NodaService;