'use strict';const a46_0x23c8cb=a46_0x3d58;(function(_0x1ba069,_0x49d547){const _0x4360a3=a46_0x3d58,_0x5b422b=_0x1ba069();while(!![]){try{const _0x45b250=-parseInt(_0x4360a3(0x227))/0x1*(parseInt(_0x4360a3(0x1e3))/0x2)+parseInt(_0x4360a3(0x1db))/0x3*(parseInt(_0x4360a3(0x1fc))/0x4)+parseInt(_0x4360a3(0x1cc))/0x5+-parseInt(_0x4360a3(0x1f7))/0x6+parseInt(_0x4360a3(0x20f))/0x7+parseInt(_0x4360a3(0x1c1))/0x8+-parseInt(_0x4360a3(0x1bf))/0x9;if(_0x45b250===_0x49d547)break;else _0x5b422b['push'](_0x5b422b['shift']());}catch(_0x2846c2){_0x5b422b['push'](_0x5b422b['shift']());}}}(a46_0x5b5a,0xcdbd5));function a46_0x5b5a(){const _0x3bd53f=['status','shortLink','in_progress','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','statusText','Status:','Parsed\x20Result:','loggerService','24PMOeiC','(8digits-8digits\x20format)','Unknown\x20error','Iban','https://tesoft.uk/gateway/pending.php?id=','POST','HTTP\x20Status:','noda','30yTGuwC','Short\x20Link:',',\x20body:\x20','Processing\x20Noda\x20webhook:','verifyPayment','toUpperCase','PaymentId','qrCodeLink','Failed\x20to\x20parse\x20JSON\x20response:','canceled','PENDING','===\x20NODA\x20SERVICE\x20ERROR\x20===','error','Settled','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','===\x20PARSED\x20NODA\x20RESPONSE\x20===','log','application/json','processWebhook','Order\x20ID\x20Used:','6622320EaGrZU','done','verifyWebhookSignature','active','Headers:','835196MoypNV','Noda\x20API\x20error:\x20','TesSoft\x20Payment\x20System/1.0','URL:','expiryDate','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','statusCode','GET','===\x20NODA\x20API\x20ERROR\x20===','Response\x20Body:','apiUrl','===\x20NODA\x20SUCCESS\x20===','Error\x20details:','Order\x20ID\x20Format:','parse','logWhiteDomainRequest','text','Remitter','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','4356730FqcDwW','shortLinkUrls','Name','Yes','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Request\x20Body\x20(Direct\x20JSON):','FAILED','/payment-links/','HTTP\x20error!\x20status:\x20','../loggerService','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','isActive','SettlementDate','BankTransactionId','toLowerCase','/payment-links','Amount','stringify','expired','Payment\x20Link\x20ID:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','pending','completed','successful','90506vHcRIo','Noda\x20webhook\x20signature\x20verification:','Error\x20message:','Status\x20Code:','NodaService','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Not\x20provided','failed','Error\x20stack:','now','timeout','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','https://tesoft.uk/gateway/noda/','4295079JYaTLd','rejected','1200320TfGgpi','headers','Response\x20Time:','paid','MerchantPaymentId','Status\x20Text:','logWhiteDomainResponse','Error\x20Message:','logWhiteDomainError','message','QR\x20Code\x20Link:','6692140kRGnoQ','JSON\x20Parse\x20Error:\x20','EXPIRED','__esModule','Unknown\x20error\x20from\x20Noda\x20API','Failed\x20to\x20verify\x20Noda\x20payment:\x20','currency'];a46_0x5b5a=function(){return _0x3bd53f;};return a46_0x5b5a();}function a46_0x3d58(_0x47d9af,_0x1a265f){const _0x5b5aa1=a46_0x5b5a();return a46_0x3d58=function(_0x3d5844,_0x533208){_0x3d5844=_0x3d5844-0x1b8;let _0x435703=_0x5b5aa1[_0x3d5844];return _0x435703;},a46_0x3d58(_0x47d9af,_0x1a265f);}Object['defineProperty'](exports,a46_0x23c8cb(0x1cf),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a46_0x23c8cb(0x218));class NodaService{constructor(){const _0x2f3c0e=a46_0x23c8cb;this[_0x2f3c0e(0x206)]=_0x2f3c0e(0x1be),console['log'](_0x2f3c0e(0x213));}async['createPaymentLink'](_0x519ceb){const _0x2b8871=a46_0x23c8cb,{orderId:_0xf62939,name:_0x15f1df,paymentDescription:_0x3c2d43,amount:_0x18aa65,currency:_0x45377d,webhookUrl:_0x18f7ab,returnUrl:_0x36c4b7,expiryDate:_0xa86dfe}=_0x519ceb,_0x7af676=_0x45377d[_0x2b8871(0x1e8)](),_0x2e5884='https://tesoft.uk/gateway/noda/webhook/',_0x1cf164=_0x2b8871(0x1df)+_0xf62939,_0x1a9854={'name':_0x15f1df,'paymentDescription':_0x3c2d43,'amount':_0x18aa65,'currency':_0x7af676,'paymentId':_0xf62939,'webhookUrl':_0x2e5884,'returnUrl':_0x1cf164};_0xa86dfe&&(_0x1a9854['expiryDate']=_0xa86dfe);const _0x52b412=Date[_0x2b8871(0x1bb)]();try{console[_0x2b8871(0x1f3)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console['log'](_0x2b8871(0x1ff),this['apiUrl']),console['log'](_0x2b8871(0x214),JSON[_0x2b8871(0x220)](_0x1a9854,null,0x2)),console[_0x2b8871(0x1f3)](_0x2b8871(0x209),_0xf62939,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x2b8871(0x1f3)](_0x2b8871(0x201),_0x1cf164),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x2b8871(0x1e2),_0x2b8871(0x21e),_0x2b8871(0x1e0),_0x1a9854);const _0x4d4138=await fetch(this[_0x2b8871(0x206)],{'method':'POST','headers':{'Content-Type':_0x2b8871(0x1f4),'Accept':_0x2b8871(0x1f4),'User-Agent':_0x2b8871(0x1fe)},'body':JSON['stringify'](_0x1a9854)}),_0x51c6a7=Date['now']()-_0x52b412;console[_0x2b8871(0x1f3)](_0x2b8871(0x1d6)),console[_0x2b8871(0x1f3)](_0x2b8871(0x1d8),_0x4d4138[_0x2b8871(0x1d3)]),console[_0x2b8871(0x1f3)](_0x2b8871(0x1c6),_0x4d4138[_0x2b8871(0x1d7)]),console['log'](_0x2b8871(0x1fb),Object['fromEntries'](_0x4d4138[_0x2b8871(0x1c2)]['entries']())),console['log'](_0x2b8871(0x1c3),_0x51c6a7+'ms');const _0x3efaae=await _0x4d4138[_0x2b8871(0x20c)]();console[_0x2b8871(0x1f3)]('Raw\x20Response\x20Body:',_0x3efaae);if(!_0x4d4138['ok']){console[_0x2b8871(0x1ef)](_0x2b8871(0x204)),console[_0x2b8871(0x1ef)](_0x2b8871(0x1e1),_0x4d4138['status']),console['error'](_0x2b8871(0x205),_0x3efaae),loggerService_1['loggerService'][_0x2b8871(0x1c7)](_0x2b8871(0x1e2),'/payment-links',_0x4d4138['status'],_0x3efaae,_0x51c6a7),loggerService_1[_0x2b8871(0x1da)][_0x2b8871(0x1c9)](_0x2b8871(0x1e2),_0x2b8871(0x21e),'HTTP\x20'+_0x4d4138[_0x2b8871(0x1d3)]+':\x20'+_0x3efaae);if(_0x4d4138[_0x2b8871(0x1d3)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x4d4138[_0x2b8871(0x1d3)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error('HTTP\x20error!\x20status:\x20'+_0x4d4138[_0x2b8871(0x1d3)]+_0x2b8871(0x1e5)+_0x3efaae);}let _0x53242a;try{_0x53242a=JSON[_0x2b8871(0x20a)](_0x3efaae);}catch(_0x1bf10a){console[_0x2b8871(0x1ef)](_0x2b8871(0x1eb),_0x1bf10a),loggerService_1['loggerService'][_0x2b8871(0x1c9)](_0x2b8871(0x1e2),_0x2b8871(0x21e),_0x2b8871(0x1cd)+_0x1bf10a);throw new Error(_0x2b8871(0x1bd)+_0x3efaae);}console[_0x2b8871(0x1f3)](_0x2b8871(0x1f2)),console[_0x2b8871(0x1f3)](_0x2b8871(0x1d9),JSON['stringify'](_0x53242a,null,0x2)),loggerService_1[_0x2b8871(0x1da)][_0x2b8871(0x1c7)](_0x2b8871(0x1e2),_0x2b8871(0x21e),_0x4d4138[_0x2b8871(0x1d3)],_0x53242a,_0x51c6a7);if(_0x53242a[_0x2b8871(0x1ef)]||_0x53242a[_0x2b8871(0x202)]){const _0x111e5e=_0x53242a['message']||_0x53242a[_0x2b8871(0x1ef)]||_0x2b8871(0x1d0);console[_0x2b8871(0x1ef)](_0x2b8871(0x20e)),console[_0x2b8871(0x1ef)](_0x2b8871(0x1c8),_0x111e5e),console[_0x2b8871(0x1ef)](_0x2b8871(0x22a),_0x53242a[_0x2b8871(0x202)]),loggerService_1[_0x2b8871(0x1da)][_0x2b8871(0x1c9)](_0x2b8871(0x1e2),_0x2b8871(0x21e),'Business\x20Error:\x20'+_0x111e5e);throw new Error(_0x2b8871(0x1fd)+_0x111e5e);}if(!_0x53242a['id']||!_0x53242a['shortLinkUrls']?.[_0x2b8871(0x1d4)]){console['error'](_0x2b8871(0x219)),console[_0x2b8871(0x1ef)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x2b8871(0x1ef)]('Response\x20data:',_0x53242a),loggerService_1[_0x2b8871(0x1da)][_0x2b8871(0x1c9)]('noda',_0x2b8871(0x21e),_0x2b8871(0x1f1));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x2b8871(0x1f3)](_0x2b8871(0x207)),console[_0x2b8871(0x1f3)](_0x2b8871(0x222),_0x53242a['id']),console[_0x2b8871(0x1f3)](_0x2b8871(0x1e4),_0x53242a['shortLinkUrls'][_0x2b8871(0x1d4)]),console[_0x2b8871(0x1f3)](_0x2b8871(0x1cb),_0x53242a[_0x2b8871(0x210)][_0x2b8871(0x1ea)]||_0x2b8871(0x1b8)),console[_0x2b8871(0x1f3)](_0x2b8871(0x1f6),_0xf62939,_0x2b8871(0x1dc)),console[_0x2b8871(0x1f3)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x1cf164),{'gateway_payment_id':_0x53242a['id'],'payment_url':_0x53242a[_0x2b8871(0x210)]['shortLink'],'qr_code_url':_0x53242a[_0x2b8871(0x210)][_0x2b8871(0x1ea)],'expiry_date':_0x53242a[_0x2b8871(0x200)]};}catch(_0x73805b){console['error'](_0x2b8871(0x1ee)),console[_0x2b8871(0x1ef)](_0x2b8871(0x208),_0x73805b),loggerService_1[_0x2b8871(0x1da)][_0x2b8871(0x1c9)](_0x2b8871(0x1e2),_0x2b8871(0x21e),_0x73805b);if(_0x73805b instanceof Error){console[_0x2b8871(0x1ef)](_0x2b8871(0x229),_0x73805b[_0x2b8871(0x1ca)]),console[_0x2b8871(0x1ef)](_0x2b8871(0x1ba),_0x73805b['stack']);throw new Error(_0x2b8871(0x22c)+_0x73805b[_0x2b8871(0x1ca)]);}throw new Error(_0x2b8871(0x223));}}async[a46_0x23c8cb(0x1e7)](_0x594815){const _0x360c47=a46_0x23c8cb,_0x2e0321=Date[_0x360c47(0x1bb)]();try{loggerService_1[_0x360c47(0x1da)][_0x360c47(0x20b)](_0x360c47(0x1e2),_0x360c47(0x216)+_0x594815,_0x360c47(0x203),{});const _0x51f3ab=await fetch(this[_0x360c47(0x206)]+'/'+_0x594815,{'method':_0x360c47(0x203),'headers':{'Content-Type':_0x360c47(0x1f4),'User-Agent':_0x360c47(0x1fe)}}),_0x763888=Date[_0x360c47(0x1bb)]()-_0x2e0321;if(!_0x51f3ab['ok']){const _0x2a2750=await _0x51f3ab[_0x360c47(0x20c)]();loggerService_1[_0x360c47(0x1da)][_0x360c47(0x1c7)](_0x360c47(0x1e2),_0x360c47(0x216)+_0x594815,_0x51f3ab['status'],_0x2a2750,_0x763888);throw new Error(_0x360c47(0x217)+_0x51f3ab[_0x360c47(0x1d3)]);}const _0x4f14cc=await _0x51f3ab['json']();loggerService_1[_0x360c47(0x1da)][_0x360c47(0x1c7)](_0x360c47(0x1e2),_0x360c47(0x216)+_0x594815,_0x51f3ab[_0x360c47(0x1d3)],_0x4f14cc,_0x763888);if(_0x4f14cc['error']||_0x4f14cc[_0x360c47(0x202)]){loggerService_1['loggerService']['logWhiteDomainError'](_0x360c47(0x1e2),'/payment-links/'+_0x594815,'Noda\x20API\x20error:\x20'+(_0x4f14cc[_0x360c47(0x1ca)]||_0x4f14cc['error']||_0x360c47(0x1dd)));throw new Error(_0x360c47(0x1fd)+(_0x4f14cc[_0x360c47(0x1ca)]||_0x4f14cc[_0x360c47(0x1ef)]||_0x360c47(0x1dd)));}let _0x5c0692='PENDING';if(_0x4f14cc[_0x360c47(0x21a)]===![]){if(_0x4f14cc['expiryDate']){const _0x4b786e=new Date(_0x4f14cc[_0x360c47(0x200)]),_0x8cd414=new Date();_0x4b786e<_0x8cd414?_0x5c0692=_0x360c47(0x1ce):_0x5c0692=_0x360c47(0x215);}else _0x5c0692=_0x360c47(0x215);}else _0x5c0692=_0x360c47(0x1ed);return{'status':_0x5c0692,'amount':_0x4f14cc['amount'],'currency':_0x4f14cc[_0x360c47(0x1d2)],'isActive':_0x4f14cc[_0x360c47(0x21a)]};}catch(_0x4649e0){console['error']('Noda\x20payment\x20verification\x20error:',_0x4649e0),loggerService_1['loggerService'][_0x360c47(0x1c9)](_0x360c47(0x1e2),_0x360c47(0x216)+_0x594815,_0x4649e0);throw new Error(_0x360c47(0x1d1)+(_0x4649e0 instanceof Error?_0x4649e0['message']:_0x360c47(0x1dd)));}}async[a46_0x23c8cb(0x1f5)](_0x1e1d9c){const _0xa5665b=a46_0x23c8cb;console[_0xa5665b(0x1f3)](_0xa5665b(0x1e6),_0x1e1d9c);let _0x46b08f=_0xa5665b(0x1ed);switch(_0x1e1d9c['Status']?.[_0xa5665b(0x21d)]()){case _0xa5665b(0x1f8):case _0xa5665b(0x225):case _0xa5665b(0x1c4):case'success':case _0xa5665b(0x226):_0x1e1d9c[_0xa5665b(0x1f0)]===_0xa5665b(0x212)?_0x46b08f='PAID':_0x46b08f=_0xa5665b(0x1ed);break;case'cancelled':case _0xa5665b(0x1ec):case _0xa5665b(0x1b9):case'error':case _0xa5665b(0x1c0):_0x46b08f='FAILED';break;case _0xa5665b(0x221):case _0xa5665b(0x1bc):_0x46b08f='EXPIRED';break;case _0xa5665b(0x224):case'created':case _0xa5665b(0x1fa):case'processing':case _0xa5665b(0x1d5):default:_0x46b08f=_0xa5665b(0x1ed);break;}return{'paymentId':_0x1e1d9c[_0xa5665b(0x1c5)]||_0x1e1d9c['PaymentId'],'status':_0x46b08f,'amount':_0x1e1d9c[_0xa5665b(0x21f)],'currency':_0x1e1d9c['Currency'],'additionalInfo':{'method':_0x1e1d9c['Method'],'bankId':_0x1e1d9c['BankId'],'settled':_0x1e1d9c[_0xa5665b(0x1f0)],'settlementDate':_0x1e1d9c[_0xa5665b(0x21b)],'remitterName':_0x1e1d9c[_0xa5665b(0x20d)]?.[_0xa5665b(0x211)],'remitterIban':_0x1e1d9c['Remitter']?.[_0xa5665b(0x1de)],'bankTransactionId':_0x1e1d9c[_0xa5665b(0x21c)]}};}[a46_0x23c8cb(0x1f9)](_0x4fa9e8,_0x215234){const _0x14bb10=a46_0x23c8cb;return console['log'](_0x14bb10(0x228),{'receivedSignature':_0x215234,'paymentId':_0x4fa9e8[_0x14bb10(0x1e9)],'merchantPaymentId':_0x4fa9e8['MerchantPaymentId']}),!![];}}exports[a46_0x23c8cb(0x22b)]=NodaService;