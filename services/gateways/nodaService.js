'use strict';const a53_0x34278c=a53_0x24c2;(function(_0x235405,_0x23bd64){const _0xe626fd=a53_0x24c2,_0x530a6e=_0x235405();while(!![]){try{const _0x48d2f3=-parseInt(_0xe626fd(0x1e8))/0x1+-parseInt(_0xe626fd(0x1fa))/0x2*(-parseInt(_0xe626fd(0x21c))/0x3)+-parseInt(_0xe626fd(0x1e5))/0x4*(parseInt(_0xe626fd(0x1fe))/0x5)+-parseInt(_0xe626fd(0x1c3))/0x6+-parseInt(_0xe626fd(0x1b1))/0x7+-parseInt(_0xe626fd(0x1e3))/0x8*(parseInt(_0xe626fd(0x1f1))/0x9)+parseInt(_0xe626fd(0x1b0))/0xa;if(_0x48d2f3===_0x23bd64)break;else _0x530a6e['push'](_0x530a6e['shift']());}catch(_0x55d370){_0x530a6e['push'](_0x530a6e['shift']());}}}(a53_0x2fe0,0x46333));function a53_0x24c2(_0x109c37,_0x39f421){const _0x2fe01d=a53_0x2fe0();return a53_0x24c2=function(_0x24c299,_0x298bb9){_0x24c299=_0x24c299-0x1ad;let _0x3c345d=_0x2fe01d[_0x24c299];return _0x3c345d;},a53_0x24c2(_0x109c37,_0x39f421);}Object[a53_0x34278c(0x1ee)](exports,'__esModule',{'value':!![]}),exports[a53_0x34278c(0x207)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x1d9f7d=a53_0x34278c;this['apiUrl']=_0x1d9f7d(0x1d9),console['log'](_0x1d9f7d(0x1ce));}async['createPaymentLink'](_0x555c05){const _0x18d8f7=a53_0x34278c,{orderId:_0x2eab88,name:_0x242345,paymentDescription:_0xb71bc8,amount:_0x101e6a,currency:_0x5326f8,webhookUrl:_0x519710,returnUrl:_0x3349e1,expiryDate:_0x14fbb7}=_0x555c05,_0x8c8f6e=_0x5326f8[_0x18d8f7(0x1b9)](),_0x300084=_0x18d8f7(0x222),_0x77766d='https://tesoft.uk/gateway/pending.php?id='+_0x2eab88,_0x52c4f1={'name':_0x242345,'paymentDescription':_0xb71bc8,'amount':_0x101e6a,'currency':_0x8c8f6e,'paymentId':_0x2eab88,'webhookUrl':_0x300084,'returnUrl':_0x77766d};_0x14fbb7&&(_0x52c4f1[_0x18d8f7(0x1c6)]=_0x14fbb7);const _0x43069c=Date[_0x18d8f7(0x1d6)]();try{console[_0x18d8f7(0x1f5)](_0x18d8f7(0x20b)),console[_0x18d8f7(0x1f5)](_0x18d8f7(0x20e),this[_0x18d8f7(0x1c8)]),console[_0x18d8f7(0x1f5)](_0x18d8f7(0x220),JSON[_0x18d8f7(0x21a)](_0x52c4f1,null,0x2)),console[_0x18d8f7(0x1f5)]('Order\x20ID\x20Format:',_0x2eab88,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x18d8f7(0x1f5)](_0x18d8f7(0x1ea),_0x77766d),loggerService_1[_0x18d8f7(0x1e2)][_0x18d8f7(0x1d0)](_0x18d8f7(0x203),_0x18d8f7(0x200),'POST',_0x52c4f1);const _0x15d875=await fetch(this[_0x18d8f7(0x1c8)],{'method':_0x18d8f7(0x1de),'headers':{'Content-Type':_0x18d8f7(0x1e4),'Accept':_0x18d8f7(0x1e4),'User-Agent':_0x18d8f7(0x1d5)},'body':JSON[_0x18d8f7(0x21a)](_0x52c4f1)}),_0x392c19=Date[_0x18d8f7(0x1d6)]()-_0x43069c;console[_0x18d8f7(0x1f5)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x18d8f7(0x1f5)](_0x18d8f7(0x221),_0x15d875['status']),console[_0x18d8f7(0x1f5)](_0x18d8f7(0x211),_0x15d875[_0x18d8f7(0x1b7)]),console[_0x18d8f7(0x1f5)](_0x18d8f7(0x1af),Object[_0x18d8f7(0x213)](_0x15d875['headers'][_0x18d8f7(0x1ef)]())),console[_0x18d8f7(0x1f5)](_0x18d8f7(0x201),_0x392c19+'ms');const _0x3e911c=await _0x15d875[_0x18d8f7(0x1ca)]();console[_0x18d8f7(0x1f5)]('Raw\x20Response\x20Body:',_0x3e911c);if(!_0x15d875['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console['error'](_0x18d8f7(0x1bb),_0x15d875[_0x18d8f7(0x202)]),console['error'](_0x18d8f7(0x20a),_0x3e911c),loggerService_1[_0x18d8f7(0x1e2)][_0x18d8f7(0x205)](_0x18d8f7(0x203),_0x18d8f7(0x200),_0x15d875['status'],_0x3e911c,_0x392c19),loggerService_1[_0x18d8f7(0x1e2)][_0x18d8f7(0x1f6)](_0x18d8f7(0x203),_0x18d8f7(0x200),_0x18d8f7(0x210)+_0x15d875[_0x18d8f7(0x202)]+':\x20'+_0x3e911c);if(_0x15d875['status']===0x190)throw new Error(_0x18d8f7(0x21e));else{if(_0x15d875[_0x18d8f7(0x202)]===0x1f4)throw new Error(_0x18d8f7(0x1fc));}throw new Error(_0x18d8f7(0x1d4)+_0x15d875[_0x18d8f7(0x202)]+_0x18d8f7(0x1d8)+_0x3e911c);}let _0x2583f3;try{_0x2583f3=JSON[_0x18d8f7(0x1f3)](_0x3e911c);}catch(_0x2ff8a0){console[_0x18d8f7(0x1d3)](_0x18d8f7(0x1c2),_0x2ff8a0),loggerService_1[_0x18d8f7(0x1e2)][_0x18d8f7(0x1f6)](_0x18d8f7(0x203),_0x18d8f7(0x200),_0x18d8f7(0x1ba)+_0x2ff8a0);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x3e911c);}console[_0x18d8f7(0x1f5)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x18d8f7(0x1f5)](_0x18d8f7(0x1d7),JSON['stringify'](_0x2583f3,null,0x2)),loggerService_1[_0x18d8f7(0x1e2)][_0x18d8f7(0x205)](_0x18d8f7(0x203),'/payment-links',_0x15d875['status'],_0x2583f3,_0x392c19);if(_0x2583f3[_0x18d8f7(0x1d3)]||_0x2583f3['statusCode']){const _0x93063c=_0x2583f3[_0x18d8f7(0x21f)]||_0x2583f3[_0x18d8f7(0x1d3)]||_0x18d8f7(0x206);console[_0x18d8f7(0x1d3)](_0x18d8f7(0x208)),console[_0x18d8f7(0x1d3)](_0x18d8f7(0x1f4),_0x93063c),console[_0x18d8f7(0x1d3)]('Status\x20Code:',_0x2583f3['statusCode']),loggerService_1['loggerService'][_0x18d8f7(0x1f6)](_0x18d8f7(0x203),_0x18d8f7(0x200),_0x18d8f7(0x1dc)+_0x93063c);throw new Error(_0x18d8f7(0x1fb)+_0x93063c);}if(!_0x2583f3['id']||!_0x2583f3[_0x18d8f7(0x1ae)]?.[_0x18d8f7(0x1db)]){console[_0x18d8f7(0x1d3)](_0x18d8f7(0x20c)),console['error'](_0x18d8f7(0x1c1)),console[_0x18d8f7(0x1d3)]('Response\x20data:',_0x2583f3),loggerService_1['loggerService'][_0x18d8f7(0x1f6)](_0x18d8f7(0x203),_0x18d8f7(0x200),_0x18d8f7(0x1f0));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x18d8f7(0x1f5)](_0x18d8f7(0x1b5)),console[_0x18d8f7(0x1f5)](_0x18d8f7(0x1da),_0x2583f3['id']),console[_0x18d8f7(0x1f5)](_0x18d8f7(0x1cf),_0x2583f3[_0x18d8f7(0x1ae)]['shortLink']),console[_0x18d8f7(0x1f5)](_0x18d8f7(0x1bc),_0x2583f3['shortLinkUrls'][_0x18d8f7(0x1ad)]||_0x18d8f7(0x216)),console[_0x18d8f7(0x1f5)]('Order\x20ID\x20Used:',_0x2eab88,_0x18d8f7(0x1d2)),console[_0x18d8f7(0x1f5)](_0x18d8f7(0x215),_0x77766d),{'gateway_payment_id':_0x2583f3['id'],'payment_url':_0x2583f3['shortLinkUrls']['shortLink'],'qr_code_url':_0x2583f3[_0x18d8f7(0x1ae)][_0x18d8f7(0x1ad)],'expiry_date':_0x2583f3[_0x18d8f7(0x1c6)]};}catch(_0x2c59e0){console[_0x18d8f7(0x1d3)](_0x18d8f7(0x217)),console[_0x18d8f7(0x1d3)](_0x18d8f7(0x21d),_0x2c59e0),loggerService_1[_0x18d8f7(0x1e2)][_0x18d8f7(0x1f6)](_0x18d8f7(0x203),'/payment-links',_0x2c59e0);if(_0x2c59e0 instanceof Error){console[_0x18d8f7(0x1d3)](_0x18d8f7(0x1fd),_0x2c59e0[_0x18d8f7(0x21f)]),console[_0x18d8f7(0x1d3)](_0x18d8f7(0x1f8),_0x2c59e0[_0x18d8f7(0x1f2)]);throw new Error(_0x18d8f7(0x1c0)+_0x2c59e0[_0x18d8f7(0x21f)]);}throw new Error(_0x18d8f7(0x20f));}}async[a53_0x34278c(0x214)](_0x6d041d){const _0x3b4cd4=a53_0x34278c,_0x18de53=Date[_0x3b4cd4(0x1d6)]();try{loggerService_1[_0x3b4cd4(0x1e2)][_0x3b4cd4(0x1d0)]('noda',_0x3b4cd4(0x1ff)+_0x6d041d,'GET',{});const _0x364613=await fetch(this[_0x3b4cd4(0x1c8)]+'/'+_0x6d041d,{'method':_0x3b4cd4(0x1e9),'headers':{'Content-Type':_0x3b4cd4(0x1e4),'User-Agent':'Payment\x20System/1.0'}}),_0x4386a8=Date['now']()-_0x18de53;if(!_0x364613['ok']){const _0xb53c1f=await _0x364613['text']();loggerService_1[_0x3b4cd4(0x1e2)][_0x3b4cd4(0x205)]('noda',_0x3b4cd4(0x1ff)+_0x6d041d,_0x364613[_0x3b4cd4(0x202)],_0xb53c1f,_0x4386a8);throw new Error(_0x3b4cd4(0x1d4)+_0x364613[_0x3b4cd4(0x202)]);}const _0x424d91=await _0x364613['json']();loggerService_1[_0x3b4cd4(0x1e2)][_0x3b4cd4(0x205)](_0x3b4cd4(0x203),_0x3b4cd4(0x1ff)+_0x6d041d,_0x364613[_0x3b4cd4(0x202)],_0x424d91,_0x4386a8);if(_0x424d91['error']||_0x424d91['statusCode']){loggerService_1[_0x3b4cd4(0x1e2)][_0x3b4cd4(0x1f6)]('noda',_0x3b4cd4(0x1ff)+_0x6d041d,_0x3b4cd4(0x1fb)+(_0x424d91[_0x3b4cd4(0x21f)]||_0x424d91['error']||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x424d91[_0x3b4cd4(0x21f)]||_0x424d91[_0x3b4cd4(0x1d3)]||_0x3b4cd4(0x1c7)));}let _0x42dc33=_0x3b4cd4(0x1b4);if(_0x424d91[_0x3b4cd4(0x1eb)]===![]){if(_0x424d91[_0x3b4cd4(0x1c6)]){const _0x2ce725=new Date(_0x424d91[_0x3b4cd4(0x1c6)]),_0x34d848=new Date();_0x2ce725<_0x34d848?_0x42dc33=_0x3b4cd4(0x1bf):_0x42dc33=_0x3b4cd4(0x1ec);}else _0x42dc33=_0x3b4cd4(0x1ec);}else _0x42dc33=_0x3b4cd4(0x1b4);return{'status':_0x42dc33,'amount':_0x424d91['amount'],'currency':_0x424d91[_0x3b4cd4(0x1be)],'isActive':_0x424d91['isActive']};}catch(_0x440dd3){console['error'](_0x3b4cd4(0x212),_0x440dd3),loggerService_1[_0x3b4cd4(0x1e2)][_0x3b4cd4(0x1f6)](_0x3b4cd4(0x203),'/payment-links/'+_0x6d041d,_0x440dd3);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x440dd3 instanceof Error?_0x440dd3[_0x3b4cd4(0x21f)]:'Unknown\x20error'));}}async[a53_0x34278c(0x209)](_0x5d2c2d){const _0x1e4436=a53_0x34278c;console['log'](_0x1e4436(0x1c9),_0x5d2c2d);let _0x7ccb9=_0x1e4436(0x1b4);switch(_0x5d2c2d['Status']?.[_0x1e4436(0x1d1)]()){case _0x1e4436(0x1b8):case _0x1e4436(0x1e6):case _0x1e4436(0x204):case _0x1e4436(0x1ed):case'successful':_0x5d2c2d[_0x1e4436(0x1cc)]==='Yes'?_0x7ccb9=_0x1e4436(0x1df):_0x7ccb9=_0x1e4436(0x1b4);break;case _0x1e4436(0x1b3):case _0x1e4436(0x1e0):case _0x1e4436(0x1c5):case _0x1e4436(0x1d3):case'rejected':_0x7ccb9='FAILED';break;case _0x1e4436(0x219):case _0x1e4436(0x1e7):_0x7ccb9=_0x1e4436(0x1bf);break;case _0x1e4436(0x218):case'created':case'active':case _0x1e4436(0x1cb):case _0x1e4436(0x21b):default:_0x7ccb9=_0x1e4436(0x1b4);break;}return{'paymentId':_0x5d2c2d[_0x1e4436(0x1e1)]||_0x5d2c2d[_0x1e4436(0x1dd)],'status':_0x7ccb9,'amount':_0x5d2c2d[_0x1e4436(0x1b6)],'currency':_0x5d2c2d['Currency'],'additionalInfo':{'method':_0x5d2c2d[_0x1e4436(0x1b2)],'bankId':_0x5d2c2d['BankId'],'settled':_0x5d2c2d[_0x1e4436(0x1cc)],'settlementDate':_0x5d2c2d[_0x1e4436(0x1cd)],'remitterName':_0x5d2c2d[_0x1e4436(0x20d)]?.[_0x1e4436(0x1f9)],'remitterIban':_0x5d2c2d[_0x1e4436(0x20d)]?.['Iban'],'bankTransactionId':_0x5d2c2d[_0x1e4436(0x1f7)]}};}[a53_0x34278c(0x1bd)](_0x4ae199,_0xd25aa1){const _0x928096=a53_0x34278c;return console[_0x928096(0x1f5)](_0x928096(0x1c4),{'receivedSignature':_0xd25aa1,'paymentId':_0x4ae199['PaymentId'],'merchantPaymentId':_0x4ae199[_0x928096(0x1e1)]}),!![];}}exports['NodaService']=NodaService;function a53_0x2fe0(){const _0x264e03=['One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','message','Request\x20Body\x20(Direct\x20JSON):','Status:','https://tesoft.uk/gateway/noda/webhook/','qrCodeLink','shortLinkUrls','Headers:','7023250nVEiWa','640570LeuoFl','Method','cancelled','PENDING','===\x20NODA\x20SUCCESS\x20===','Amount','statusText','done','toUpperCase','JSON\x20Parse\x20Error:\x20','HTTP\x20Status:','QR\x20Code\x20Link:','verifyWebhookSignature','currency','EXPIRED','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Missing\x20id\x20or\x20shortLink\x20in\x20response','Failed\x20to\x20parse\x20JSON\x20response:','522624CJcCuH','Noda\x20webhook\x20signature\x20verification:','failed','expiryDate','Unknown\x20error','apiUrl','Processing\x20Noda\x20webhook:','text','processing','Settled','SettlementDate','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Short\x20Link:','logWhiteDomainRequest','toLowerCase','(8digits-8digits\x20format)','error','HTTP\x20error!\x20status:\x20','Payment\x20System/1.0','now','Parsed\x20Result:',',\x20body:\x20','https://tesoft.uk/gateway/noda/','Payment\x20Link\x20ID:','shortLink','Business\x20Error:\x20','PaymentId','POST','PAID','canceled','MerchantPaymentId','loggerService','58640qMSRop','application/json','579484JnhqGd','completed','timeout','94124IjZAXL','GET','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','isActive','FAILED','success','defineProperty','entries','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','576nxMKKx','stack','parse','Error\x20Message:','log','logWhiteDomainError','BankTransactionId','Error\x20stack:','Name','2ofIkop','Noda\x20API\x20error:\x20','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Error\x20message:','5MEcGom','/payment-links/','/payment-links','Response\x20Time:','status','noda','paid','logWhiteDomainResponse','Unknown\x20error\x20from\x20Noda\x20API','NodaService','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','processWebhook','Response\x20Body:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Remitter','URL:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','HTTP\x20','Status\x20Text:','Noda\x20payment\x20verification\x20error:','fromEntries','verifyPayment','✅\x20Return\x20URL\x20configured\x20for\x20pending:','Not\x20provided','===\x20NODA\x20SERVICE\x20ERROR\x20===','pending','expired','stringify','in_progress','1415829nSQGcj','Error\x20details:'];a53_0x2fe0=function(){return _0x264e03;};return a53_0x2fe0();}