'use strict';const a63_0x2e8aa6=a63_0x44ea;function a63_0x3ba6(){const _0x558f9d=['84MItuTx','error','Status\x20Text:','headers','toUpperCase','FAILED','Settled','apiUrl','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','verifyPayment','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','isActive','GET','Not\x20provided','active','4kwYBQr','expiryDate','statusText','pending','===\x20PARSED\x20NODA\x20RESPONSE\x20===','expired','Parsed\x20Result:','rejected','Headers:','PENDING','status','Error\x20Message:','Currency','BankTransactionId','79538EkSvZW','success','Error\x20stack:','shortLinkUrls','Short\x20Link:','Payment\x20Link\x20ID:','HTTP\x20Status:','completed','Noda\x20webhook\x20signature\x20verification:','POST','PaymentId','2156736QnMmBn','Error\x20details:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','QR\x20Code\x20Link:','1400636yGyaWL','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','../loggerService','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Noda\x20payment\x20verification\x20error:','1116642WaiuIu','Status','json','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Yes','logWhiteDomainError','Noda\x20API\x20error:\x20','https://tesoft.uk/gateway/pending.php?id=','HTTP\x20error!\x20status:\x20','logWhiteDomainResponse','===\x20NODA\x20SUCCESS\x20===','log','Iban','Unknown\x20error','URL:','/payment-links','application/json','Remitter','loggerService','Request\x20Body\x20(Direct\x20JSON):','Response\x20data:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Payment\x20System/1.0','cancelled','Order\x20ID\x20Used:','181770BIPpyK','https://tesoft.uk/gateway/noda/','createPaymentLink','10783620JAVwsO','timeout','now','failed','NodaService','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Raw\x20Response\x20Body:','Amount','EXPIRED','148015naHkxG','stack','Unknown\x20error\x20from\x20Noda\x20API','Status\x20Code:','MerchantPaymentId','Status:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','done','Business\x20Error:\x20','BankId','defineProperty','logWhiteDomainRequest','message','qrCodeLink','shortLink','statusCode','Processing\x20Noda\x20webhook:','paid','canceled','currency','https://tesoft.uk/gateway/noda/webhook/','===\x20NODA\x20API\x20ERROR\x20===','/payment-links/','Error\x20message:','HTTP\x20','===\x20NODA\x20SERVICE\x20ERROR\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','stringify','noda','text','(8digits-8digits\x20format)'];a63_0x3ba6=function(){return _0x558f9d;};return a63_0x3ba6();}(function(_0x203c26,_0x126c13){const _0x203035=a63_0x44ea,_0x44463b=_0x203c26();while(!![]){try{const _0x385da6=parseInt(_0x203035(0x162))/0x1*(-parseInt(_0x203035(0xfa))/0x2)+-parseInt(_0x203035(0x10e))/0x3+-parseInt(_0x203035(0x109))/0x4+-parseInt(_0x203035(0x133))/0x5+-parseInt(_0x203035(0x127))/0x6*(parseInt(_0x203035(0x153))/0x7)+parseInt(_0x203035(0x105))/0x8+parseInt(_0x203035(0x12a))/0x9;if(_0x385da6===_0x126c13)break;else _0x44463b['push'](_0x44463b['shift']());}catch(_0x584078){_0x44463b['push'](_0x44463b['shift']());}}}(a63_0x3ba6,0x2f29c));function a63_0x44ea(_0x2308f8,_0x3de746){_0x2308f8=_0x2308f8-0xf6;const _0x3ba6c0=a63_0x3ba6();let _0x44ea73=_0x3ba6c0[_0x2308f8];return _0x44ea73;}Object[a63_0x2e8aa6(0x13d)](exports,'__esModule',{'value':!![]}),exports[a63_0x2e8aa6(0x12e)]=void 0x0;const loggerService_1=require(a63_0x2e8aa6(0x10b));class NodaService{constructor(){const _0x32f6df=a63_0x2e8aa6;this[_0x32f6df(0x15a)]=_0x32f6df(0x128),console[_0x32f6df(0x119)](_0x32f6df(0x12f));}async[a63_0x2e8aa6(0x129)](_0x3c8f4c){const _0x2b95e9=a63_0x2e8aa6,{orderId:_0x5cb04c,name:_0x41add7,paymentDescription:_0x71846e,amount:_0x16127e,currency:_0x292783,webhookUrl:_0x359b04,returnUrl:_0x57043b,expiryDate:_0x39d214}=_0x3c8f4c,_0x2dffd4=_0x292783[_0x2b95e9(0x157)](),_0x4e60c2=_0x2b95e9(0x147),_0x589100=_0x2b95e9(0x115)+_0x5cb04c,_0x1a3d44={'name':_0x41add7,'paymentDescription':_0x71846e,'amount':_0x16127e,'currency':_0x2dffd4,'paymentId':_0x5cb04c,'webhookUrl':_0x4e60c2,'returnUrl':_0x589100};_0x39d214&&(_0x1a3d44[_0x2b95e9(0x163)]=_0x39d214);const _0x162c5b=Date[_0x2b95e9(0x12c)]();try{console[_0x2b95e9(0x119)](_0x2b95e9(0x15d)),console[_0x2b95e9(0x119)](_0x2b95e9(0x11c),this['apiUrl']),console[_0x2b95e9(0x119)](_0x2b95e9(0x121),JSON[_0x2b95e9(0x14f)](_0x1a3d44,null,0x2)),console[_0x2b95e9(0x119)]('Order\x20ID\x20Format:',_0x5cb04c,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x2b95e9(0x119)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x589100),loggerService_1['loggerService'][_0x2b95e9(0x13e)]('noda',_0x2b95e9(0x11d),_0x2b95e9(0x103),_0x1a3d44);const _0x5545a8=await fetch(this[_0x2b95e9(0x15a)],{'method':_0x2b95e9(0x103),'headers':{'Content-Type':_0x2b95e9(0x11e),'Accept':_0x2b95e9(0x11e),'User-Agent':_0x2b95e9(0x124)},'body':JSON[_0x2b95e9(0x14f)](_0x1a3d44)}),_0x5b82a4=Date[_0x2b95e9(0x12c)]()-_0x162c5b;console[_0x2b95e9(0x119)](_0x2b95e9(0x10a)),console[_0x2b95e9(0x119)](_0x2b95e9(0x138),_0x5545a8['status']),console['log'](_0x2b95e9(0x155),_0x5545a8[_0x2b95e9(0x164)]),console[_0x2b95e9(0x119)](_0x2b95e9(0x16a),Object['fromEntries'](_0x5545a8[_0x2b95e9(0x156)]['entries']())),console[_0x2b95e9(0x119)]('Response\x20Time:',_0x5b82a4+'ms');const _0x1da14b=await _0x5545a8['text']();console['log'](_0x2b95e9(0x130),_0x1da14b);if(!_0x5545a8['ok']){console[_0x2b95e9(0x154)](_0x2b95e9(0x148)),console[_0x2b95e9(0x154)](_0x2b95e9(0x100),_0x5545a8['status']),console[_0x2b95e9(0x154)]('Response\x20Body:',_0x1da14b),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2b95e9(0x150),'/payment-links',_0x5545a8[_0x2b95e9(0xf6)],_0x1da14b,_0x5b82a4),loggerService_1[_0x2b95e9(0x120)]['logWhiteDomainError'](_0x2b95e9(0x150),_0x2b95e9(0x11d),_0x2b95e9(0x14b)+_0x5545a8[_0x2b95e9(0xf6)]+':\x20'+_0x1da14b);if(_0x5545a8[_0x2b95e9(0xf6)]===0x190)throw new Error(_0x2b95e9(0x111));else{if(_0x5545a8[_0x2b95e9(0xf6)]===0x1f4)throw new Error(_0x2b95e9(0x139));}throw new Error(_0x2b95e9(0x116)+_0x5545a8['status']+',\x20body:\x20'+_0x1da14b);}let _0x4c6f75;try{_0x4c6f75=JSON['parse'](_0x1da14b);}catch(_0x3d83c7){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x3d83c7),loggerService_1[_0x2b95e9(0x120)]['logWhiteDomainError'](_0x2b95e9(0x150),'/payment-links','JSON\x20Parse\x20Error:\x20'+_0x3d83c7);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x1da14b);}console[_0x2b95e9(0x119)](_0x2b95e9(0x166)),console['log'](_0x2b95e9(0x168),JSON[_0x2b95e9(0x14f)](_0x4c6f75,null,0x2)),loggerService_1['loggerService'][_0x2b95e9(0x117)](_0x2b95e9(0x150),_0x2b95e9(0x11d),_0x5545a8[_0x2b95e9(0xf6)],_0x4c6f75,_0x5b82a4);if(_0x4c6f75[_0x2b95e9(0x154)]||_0x4c6f75[_0x2b95e9(0x142)]){const _0x4cb98e=_0x4c6f75[_0x2b95e9(0x13f)]||_0x4c6f75[_0x2b95e9(0x154)]||_0x2b95e9(0x135);console[_0x2b95e9(0x154)](_0x2b95e9(0x10c)),console[_0x2b95e9(0x154)](_0x2b95e9(0xf7),_0x4cb98e),console[_0x2b95e9(0x154)](_0x2b95e9(0x136),_0x4c6f75[_0x2b95e9(0x142)]),loggerService_1[_0x2b95e9(0x120)][_0x2b95e9(0x113)]('noda',_0x2b95e9(0x11d),_0x2b95e9(0x13b)+_0x4cb98e);throw new Error(_0x2b95e9(0x114)+_0x4cb98e);}if(!_0x4c6f75['id']||!_0x4c6f75[_0x2b95e9(0xfd)]?.['shortLink']){console[_0x2b95e9(0x154)](_0x2b95e9(0x107)),console[_0x2b95e9(0x154)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x2b95e9(0x154)](_0x2b95e9(0x122),_0x4c6f75),loggerService_1['loggerService'][_0x2b95e9(0x113)](_0x2b95e9(0x150),_0x2b95e9(0x11d),_0x2b95e9(0x15b));throw new Error(_0x2b95e9(0x123));}return console['log'](_0x2b95e9(0x118)),console[_0x2b95e9(0x119)](_0x2b95e9(0xff),_0x4c6f75['id']),console['log'](_0x2b95e9(0xfe),_0x4c6f75[_0x2b95e9(0xfd)]['shortLink']),console[_0x2b95e9(0x119)](_0x2b95e9(0x108),_0x4c6f75[_0x2b95e9(0xfd)][_0x2b95e9(0x140)]||_0x2b95e9(0x160)),console[_0x2b95e9(0x119)](_0x2b95e9(0x126),_0x5cb04c,_0x2b95e9(0x152)),console[_0x2b95e9(0x119)](_0x2b95e9(0x14e),_0x589100),{'gateway_payment_id':_0x4c6f75['id'],'payment_url':_0x4c6f75[_0x2b95e9(0xfd)][_0x2b95e9(0x141)],'qr_code_url':_0x4c6f75['shortLinkUrls'][_0x2b95e9(0x140)],'expiry_date':_0x4c6f75['expiryDate']};}catch(_0x416ede){console[_0x2b95e9(0x154)](_0x2b95e9(0x14c)),console['error'](_0x2b95e9(0x106),_0x416ede),loggerService_1[_0x2b95e9(0x120)][_0x2b95e9(0x113)](_0x2b95e9(0x150),_0x2b95e9(0x11d),_0x416ede);if(_0x416ede instanceof Error){console[_0x2b95e9(0x154)](_0x2b95e9(0x14a),_0x416ede[_0x2b95e9(0x13f)]),console['error'](_0x2b95e9(0xfc),_0x416ede[_0x2b95e9(0x134)]);throw new Error(_0x2b95e9(0x14d)+_0x416ede[_0x2b95e9(0x13f)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a63_0x2e8aa6(0x15c)](_0x53e609){const _0x4104ef=a63_0x2e8aa6,_0x412639=Date['now']();try{loggerService_1[_0x4104ef(0x120)]['logWhiteDomainRequest'](_0x4104ef(0x150),_0x4104ef(0x149)+_0x53e609,_0x4104ef(0x15f),{});const _0x4ace59=await fetch(this[_0x4104ef(0x15a)]+'/'+_0x53e609,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x4104ef(0x124)}}),_0x4ecb98=Date[_0x4104ef(0x12c)]()-_0x412639;if(!_0x4ace59['ok']){const _0x3d881e=await _0x4ace59[_0x4104ef(0x151)]();loggerService_1[_0x4104ef(0x120)][_0x4104ef(0x117)](_0x4104ef(0x150),_0x4104ef(0x149)+_0x53e609,_0x4ace59[_0x4104ef(0xf6)],_0x3d881e,_0x4ecb98);throw new Error(_0x4104ef(0x116)+_0x4ace59[_0x4104ef(0xf6)]);}const _0x2e0201=await _0x4ace59[_0x4104ef(0x110)]();loggerService_1[_0x4104ef(0x120)][_0x4104ef(0x117)]('noda',_0x4104ef(0x149)+_0x53e609,_0x4ace59[_0x4104ef(0xf6)],_0x2e0201,_0x4ecb98);if(_0x2e0201[_0x4104ef(0x154)]||_0x2e0201['statusCode']){loggerService_1[_0x4104ef(0x120)][_0x4104ef(0x113)](_0x4104ef(0x150),'/payment-links/'+_0x53e609,_0x4104ef(0x114)+(_0x2e0201[_0x4104ef(0x13f)]||_0x2e0201[_0x4104ef(0x154)]||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x2e0201[_0x4104ef(0x13f)]||_0x2e0201['error']||_0x4104ef(0x11b)));}let _0x84a3fe=_0x4104ef(0x16b);if(_0x2e0201[_0x4104ef(0x15e)]===![]){if(_0x2e0201[_0x4104ef(0x163)]){const _0x222afb=new Date(_0x2e0201[_0x4104ef(0x163)]),_0x48d0a6=new Date();_0x222afb<_0x48d0a6?_0x84a3fe=_0x4104ef(0x132):_0x84a3fe='FAILED';}else _0x84a3fe=_0x4104ef(0x158);}else _0x84a3fe=_0x4104ef(0x16b);return{'status':_0x84a3fe,'amount':_0x2e0201['amount'],'currency':_0x2e0201[_0x4104ef(0x146)],'isActive':_0x2e0201[_0x4104ef(0x15e)]};}catch(_0x1a36a1){console['error'](_0x4104ef(0x10d),_0x1a36a1),loggerService_1[_0x4104ef(0x120)]['logWhiteDomainError'](_0x4104ef(0x150),'/payment-links/'+_0x53e609,_0x1a36a1);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x1a36a1 instanceof Error?_0x1a36a1[_0x4104ef(0x13f)]:_0x4104ef(0x11b)));}}async['processWebhook'](_0x1ecc2a){const _0x330609=a63_0x2e8aa6;console[_0x330609(0x119)](_0x330609(0x143),_0x1ecc2a);let _0x2d7831=_0x330609(0x16b);switch(_0x1ecc2a[_0x330609(0x10f)]?.['toLowerCase']()){case _0x330609(0x13a):case _0x330609(0x101):case _0x330609(0x144):case _0x330609(0xfb):case'successful':_0x1ecc2a['Settled']===_0x330609(0x112)?_0x2d7831='PAID':_0x2d7831=_0x330609(0x16b);break;case _0x330609(0x125):case _0x330609(0x145):case _0x330609(0x12d):case _0x330609(0x154):case _0x330609(0x169):_0x2d7831='FAILED';break;case _0x330609(0x167):case _0x330609(0x12b):_0x2d7831=_0x330609(0x132);break;case _0x330609(0x165):case'created':case _0x330609(0x161):case'processing':case'in_progress':default:_0x2d7831=_0x330609(0x16b);break;}return{'paymentId':_0x1ecc2a[_0x330609(0x137)]||_0x1ecc2a[_0x330609(0x104)],'status':_0x2d7831,'amount':_0x1ecc2a[_0x330609(0x131)],'currency':_0x1ecc2a[_0x330609(0xf8)],'additionalInfo':{'method':_0x1ecc2a['Method'],'bankId':_0x1ecc2a[_0x330609(0x13c)],'settled':_0x1ecc2a[_0x330609(0x159)],'settlementDate':_0x1ecc2a['SettlementDate'],'remitterName':_0x1ecc2a[_0x330609(0x11f)]?.['Name'],'remitterIban':_0x1ecc2a[_0x330609(0x11f)]?.[_0x330609(0x11a)],'bankTransactionId':_0x1ecc2a[_0x330609(0xf9)]}};}['verifyWebhookSignature'](_0x161541,_0xe484e){const _0x305f04=a63_0x2e8aa6;return console[_0x305f04(0x119)](_0x305f04(0x102),{'receivedSignature':_0xe484e,'paymentId':_0x161541[_0x305f04(0x104)],'merchantPaymentId':_0x161541['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;