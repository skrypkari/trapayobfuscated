'use strict';function a44_0x51d7(){const _0x175d0a=['Failed\x20to\x20parse\x20JSON\x20response:','qrCodeLink','logWhiteDomainRequest','4120Mljnwp','shortLinkUrls','Response\x20data:','done','status','../loggerService','now','HTTP\x20','logWhiteDomainError','noda','MerchantPaymentId','shortLink','active','HTTP\x20error!\x20status:\x20','loggerService','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','TesSoft\x20Payment\x20System/1.0','Response\x20Time:','Status:','GET','Raw\x20Response\x20Body:','49948lhFHoe','success','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Order\x20ID\x20Used:','cancelled','(8digits-8digits\x20format)','8546664CwYQtN','Iban','1216071uIksrv','failed','successful','Amount','paid','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','51ILbeDy','timeout','apiUrl','in_progress','Error\x20Message:','text','Missing\x20id\x20or\x20shortLink\x20in\x20response','error','Settled','FAILED','canceled','Remitter','SettlementDate','entries','Unknown\x20error','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Method','POST','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','defineProperty','===\x20NODA\x20API\x20ERROR\x20===','Status\x20Text:','parse','BankId','Not\x20provided','rejected','BankTransactionId','Currency',',\x20body:\x20','PENDING','isActive','Noda\x20payment\x20verification\x20error:','amount','Noda\x20webhook\x20signature\x20verification:','logWhiteDomainResponse','Request\x20Body\x20(Direct\x20JSON):','===\x20PARSED\x20NODA\x20RESPONSE\x20===','PAID','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','pending','currency','1482610CPNanx','/payment-links/','Headers:','Yes','HTTP\x20Status:','Parsed\x20Result:','Unknown\x20error\x20from\x20Noda\x20API','6234054ctupJR','NodaService','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','processing','verifyPayment','Status\x20Code:','Noda\x20API\x20error:\x20','stack','createPaymentLink','EXPIRED','toLowerCase','17361zsdGer','application/json','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','statusText','log','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','PaymentId','https://tesoft.uk/gateway/pending.php?id=','/payment-links','expiryDate','615490nrWMes','processWebhook','Business\x20Error:\x20','message','https://tesoft.uk/gateway/noda/webhook/','created','8hrnAdg','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','===\x20NODA\x20SUCCESS\x20===','Order\x20ID\x20Format:','json','statusCode','QR\x20Code\x20Link:','stringify'];a44_0x51d7=function(){return _0x175d0a;};return a44_0x51d7();}const a44_0x4505a5=a44_0x57aa;function a44_0x57aa(_0x296ac1,_0x3882e4){const _0x51d704=a44_0x51d7();return a44_0x57aa=function(_0x57aa46,_0x5c8002){_0x57aa46=_0x57aa46-0x174;let _0x59b9bc=_0x51d704[_0x57aa46];return _0x59b9bc;},a44_0x57aa(_0x296ac1,_0x3882e4);}(function(_0x2a34de,_0x113502){const _0x14898c=a44_0x57aa,_0x4d83e=_0x2a34de();while(!![]){try{const _0x49d0d7=-parseInt(_0x14898c(0x1bd))/0x1*(-parseInt(_0x14898c(0x1af))/0x2)+parseInt(_0x14898c(0x1b7))/0x3*(parseInt(_0x14898c(0x18f))/0x4)+-parseInt(_0x14898c(0x189))/0x5+parseInt(_0x14898c(0x1ed))/0x6+-parseInt(_0x14898c(0x1b5))/0x7+-parseInt(_0x14898c(0x19a))/0x8*(parseInt(_0x14898c(0x17f))/0x9)+-parseInt(_0x14898c(0x1e6))/0xa;if(_0x49d0d7===_0x113502)break;else _0x4d83e['push'](_0x4d83e['shift']());}catch(_0x31f9f6){_0x4d83e['push'](_0x4d83e['shift']());}}}(a44_0x51d7,0x9bad3));Object[a44_0x4505a5(0x1d0)](exports,'__esModule',{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a44_0x4505a5(0x19f));class NodaService{constructor(){const _0x4154f0=a44_0x4505a5;this[_0x4154f0(0x1bf)]='https://tesoft.uk/gateway/noda/',console[_0x4154f0(0x183)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a44_0x4505a5(0x17c)](_0x39fb58){const _0x4044f0=a44_0x4505a5,{orderId:_0x5d0261,name:_0x4da3ab,paymentDescription:_0x1222fb,amount:_0x331aaf,currency:_0x171b4a,webhookUrl:_0x102976,returnUrl:_0x5e77cb,expiryDate:_0x3b71a5}=_0x39fb58,_0x3667b0=_0x171b4a['toUpperCase'](),_0x48ec03=_0x4044f0(0x18d),_0x394c74=_0x4044f0(0x186)+_0x5d0261,_0x538a46={'name':_0x4da3ab,'paymentDescription':_0x1222fb,'amount':_0x331aaf,'currency':_0x3667b0,'paymentId':_0x5d0261,'webhookUrl':_0x48ec03,'returnUrl':_0x394c74};_0x3b71a5&&(_0x538a46[_0x4044f0(0x188)]=_0x3b71a5);const _0xc0d8d9=Date[_0x4044f0(0x1a0)]();try{console[_0x4044f0(0x183)](_0x4044f0(0x184)),console['log']('URL:',this[_0x4044f0(0x1bf)]),console[_0x4044f0(0x183)](_0x4044f0(0x1e0),JSON['stringify'](_0x538a46,null,0x2)),console['log'](_0x4044f0(0x192),_0x5d0261,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x4044f0(0x183)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x394c74),loggerService_1[_0x4044f0(0x1a8)][_0x4044f0(0x199)](_0x4044f0(0x1a3),_0x4044f0(0x187),_0x4044f0(0x1ce),_0x538a46);const _0xbda260=await fetch(this[_0x4044f0(0x1bf)],{'method':_0x4044f0(0x1ce),'headers':{'Content-Type':_0x4044f0(0x180),'Accept':_0x4044f0(0x180),'User-Agent':_0x4044f0(0x1aa)},'body':JSON[_0x4044f0(0x196)](_0x538a46)}),_0x16bb84=Date[_0x4044f0(0x1a0)]()-_0xc0d8d9;console[_0x4044f0(0x183)](_0x4044f0(0x1cc)),console[_0x4044f0(0x183)](_0x4044f0(0x1ac),_0xbda260[_0x4044f0(0x19e)]),console['log'](_0x4044f0(0x1d2),_0xbda260[_0x4044f0(0x182)]),console[_0x4044f0(0x183)](_0x4044f0(0x1e8),Object['fromEntries'](_0xbda260['headers'][_0x4044f0(0x1ca)]())),console[_0x4044f0(0x183)](_0x4044f0(0x1ab),_0x16bb84+'ms');const _0x38dcbf=await _0xbda260['text']();console[_0x4044f0(0x183)](_0x4044f0(0x1ae),_0x38dcbf);if(!_0xbda260['ok']){console[_0x4044f0(0x1c4)](_0x4044f0(0x1d1)),console[_0x4044f0(0x1c4)](_0x4044f0(0x1ea),_0xbda260['status']),console['error']('Response\x20Body:',_0x38dcbf),loggerService_1[_0x4044f0(0x1a8)][_0x4044f0(0x1df)](_0x4044f0(0x1a3),_0x4044f0(0x187),_0xbda260[_0x4044f0(0x19e)],_0x38dcbf,_0x16bb84),loggerService_1[_0x4044f0(0x1a8)]['logWhiteDomainError'](_0x4044f0(0x1a3),_0x4044f0(0x187),_0x4044f0(0x1a1)+_0xbda260[_0x4044f0(0x19e)]+':\x20'+_0x38dcbf);if(_0xbda260[_0x4044f0(0x19e)]===0x190)throw new Error(_0x4044f0(0x181));else{if(_0xbda260[_0x4044f0(0x19e)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x4044f0(0x1a7)+_0xbda260[_0x4044f0(0x19e)]+_0x4044f0(0x1d9)+_0x38dcbf);}let _0x8e99e0;try{_0x8e99e0=JSON[_0x4044f0(0x1d3)](_0x38dcbf);}catch(_0x9ec429){console[_0x4044f0(0x1c4)](_0x4044f0(0x197),_0x9ec429),loggerService_1[_0x4044f0(0x1a8)]['logWhiteDomainError']('noda',_0x4044f0(0x187),'JSON\x20Parse\x20Error:\x20'+_0x9ec429);throw new Error(_0x4044f0(0x176)+_0x38dcbf);}console['log'](_0x4044f0(0x1e1)),console[_0x4044f0(0x183)](_0x4044f0(0x1eb),JSON[_0x4044f0(0x196)](_0x8e99e0,null,0x2)),loggerService_1['loggerService'][_0x4044f0(0x1df)]('noda',_0x4044f0(0x187),_0xbda260[_0x4044f0(0x19e)],_0x8e99e0,_0x16bb84);if(_0x8e99e0[_0x4044f0(0x1c4)]||_0x8e99e0['statusCode']){const _0x2f00f9=_0x8e99e0['message']||_0x8e99e0[_0x4044f0(0x1c4)]||_0x4044f0(0x1ec);console[_0x4044f0(0x1c4)](_0x4044f0(0x1e3)),console[_0x4044f0(0x1c4)](_0x4044f0(0x1c1),_0x2f00f9),console['error'](_0x4044f0(0x179),_0x8e99e0['statusCode']),loggerService_1[_0x4044f0(0x1a8)][_0x4044f0(0x1a2)]('noda',_0x4044f0(0x187),_0x4044f0(0x18b)+_0x2f00f9);throw new Error(_0x4044f0(0x17a)+_0x2f00f9);}if(!_0x8e99e0['id']||!_0x8e99e0[_0x4044f0(0x19b)]?.[_0x4044f0(0x1a5)]){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4044f0(0x1c4)](_0x4044f0(0x1c3)),console[_0x4044f0(0x1c4)](_0x4044f0(0x19c),_0x8e99e0),loggerService_1['loggerService'][_0x4044f0(0x1a2)](_0x4044f0(0x1a3),_0x4044f0(0x187),_0x4044f0(0x1bc));throw new Error(_0x4044f0(0x1b1));}return console[_0x4044f0(0x183)](_0x4044f0(0x191)),console[_0x4044f0(0x183)]('Payment\x20Link\x20ID:',_0x8e99e0['id']),console[_0x4044f0(0x183)]('Short\x20Link:',_0x8e99e0[_0x4044f0(0x19b)][_0x4044f0(0x1a5)]),console[_0x4044f0(0x183)](_0x4044f0(0x195),_0x8e99e0[_0x4044f0(0x19b)][_0x4044f0(0x198)]||_0x4044f0(0x1d5)),console[_0x4044f0(0x183)](_0x4044f0(0x1b2),_0x5d0261,_0x4044f0(0x1b4)),console['log'](_0x4044f0(0x1cf),_0x394c74),{'gateway_payment_id':_0x8e99e0['id'],'payment_url':_0x8e99e0[_0x4044f0(0x19b)][_0x4044f0(0x1a5)],'qr_code_url':_0x8e99e0[_0x4044f0(0x19b)]['qrCodeLink'],'expiry_date':_0x8e99e0[_0x4044f0(0x188)]};}catch(_0x4d3d47){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x4044f0(0x1c4)]('Error\x20details:',_0x4d3d47),loggerService_1[_0x4044f0(0x1a8)][_0x4044f0(0x1a2)](_0x4044f0(0x1a3),'/payment-links',_0x4d3d47);if(_0x4d3d47 instanceof Error){console[_0x4044f0(0x1c4)]('Error\x20message:',_0x4d3d47['message']),console[_0x4044f0(0x1c4)]('Error\x20stack:',_0x4d3d47[_0x4044f0(0x17b)]);throw new Error(_0x4044f0(0x1a9)+_0x4d3d47[_0x4044f0(0x18c)]);}throw new Error(_0x4044f0(0x190));}}async[a44_0x4505a5(0x178)](_0x3247c9){const _0x14c622=a44_0x4505a5,_0x2d2023=Date[_0x14c622(0x1a0)]();try{loggerService_1[_0x14c622(0x1a8)][_0x14c622(0x199)]('noda',_0x14c622(0x1e7)+_0x3247c9,_0x14c622(0x1ad),{});const _0x4c094e=await fetch(this[_0x14c622(0x1bf)]+'/'+_0x3247c9,{'method':_0x14c622(0x1ad),'headers':{'Content-Type':_0x14c622(0x180),'User-Agent':_0x14c622(0x1aa)}}),_0x203ab3=Date[_0x14c622(0x1a0)]()-_0x2d2023;if(!_0x4c094e['ok']){const _0x274d21=await _0x4c094e[_0x14c622(0x1c2)]();loggerService_1[_0x14c622(0x1a8)]['logWhiteDomainResponse'](_0x14c622(0x1a3),_0x14c622(0x1e7)+_0x3247c9,_0x4c094e[_0x14c622(0x19e)],_0x274d21,_0x203ab3);throw new Error(_0x14c622(0x1a7)+_0x4c094e[_0x14c622(0x19e)]);}const _0x48f971=await _0x4c094e[_0x14c622(0x193)]();loggerService_1[_0x14c622(0x1a8)][_0x14c622(0x1df)](_0x14c622(0x1a3),_0x14c622(0x1e7)+_0x3247c9,_0x4c094e['status'],_0x48f971,_0x203ab3);if(_0x48f971[_0x14c622(0x1c4)]||_0x48f971[_0x14c622(0x194)]){loggerService_1[_0x14c622(0x1a8)]['logWhiteDomainError'](_0x14c622(0x1a3),_0x14c622(0x1e7)+_0x3247c9,_0x14c622(0x17a)+(_0x48f971[_0x14c622(0x18c)]||_0x48f971[_0x14c622(0x1c4)]||_0x14c622(0x1cb)));throw new Error(_0x14c622(0x17a)+(_0x48f971[_0x14c622(0x18c)]||_0x48f971[_0x14c622(0x1c4)]||_0x14c622(0x1cb)));}let _0x75463a=_0x14c622(0x1da);if(_0x48f971['isActive']===![]){if(_0x48f971[_0x14c622(0x188)]){const _0x12ff3a=new Date(_0x48f971['expiryDate']),_0x2f5957=new Date();_0x12ff3a<_0x2f5957?_0x75463a=_0x14c622(0x17d):_0x75463a=_0x14c622(0x1c6);}else _0x75463a='FAILED';}else _0x75463a=_0x14c622(0x1da);return{'status':_0x75463a,'amount':_0x48f971[_0x14c622(0x1dd)],'currency':_0x48f971[_0x14c622(0x1e5)],'isActive':_0x48f971[_0x14c622(0x1db)]};}catch(_0x3de02b){console[_0x14c622(0x1c4)](_0x14c622(0x1dc),_0x3de02b),loggerService_1[_0x14c622(0x1a8)][_0x14c622(0x1a2)](_0x14c622(0x1a3),'/payment-links/'+_0x3247c9,_0x3de02b);throw new Error(_0x14c622(0x175)+(_0x3de02b instanceof Error?_0x3de02b[_0x14c622(0x18c)]:_0x14c622(0x1cb)));}}async[a44_0x4505a5(0x18a)](_0x149bd8){const _0x4d013d=a44_0x4505a5;console['log']('Processing\x20Noda\x20webhook:',_0x149bd8);let _0xe15182=_0x4d013d(0x1da);switch(_0x149bd8['Status']?.[_0x4d013d(0x17e)]()){case _0x4d013d(0x19d):case'completed':case _0x4d013d(0x1bb):case _0x4d013d(0x1b0):case _0x4d013d(0x1b9):_0x149bd8[_0x4d013d(0x1c5)]===_0x4d013d(0x1e9)?_0xe15182=_0x4d013d(0x1e2):_0xe15182='PENDING';break;case _0x4d013d(0x1b3):case _0x4d013d(0x1c7):case _0x4d013d(0x1b8):case _0x4d013d(0x1c4):case _0x4d013d(0x1d6):_0xe15182=_0x4d013d(0x1c6);break;case'expired':case _0x4d013d(0x1be):_0xe15182=_0x4d013d(0x17d);break;case _0x4d013d(0x1e4):case _0x4d013d(0x18e):case _0x4d013d(0x1a6):case _0x4d013d(0x177):case _0x4d013d(0x1c0):default:_0xe15182=_0x4d013d(0x1da);break;}return{'paymentId':_0x149bd8[_0x4d013d(0x1a4)]||_0x149bd8[_0x4d013d(0x185)],'status':_0xe15182,'amount':_0x149bd8[_0x4d013d(0x1ba)],'currency':_0x149bd8[_0x4d013d(0x1d8)],'additionalInfo':{'method':_0x149bd8[_0x4d013d(0x1cd)],'bankId':_0x149bd8[_0x4d013d(0x1d4)],'settled':_0x149bd8[_0x4d013d(0x1c5)],'settlementDate':_0x149bd8[_0x4d013d(0x1c9)],'remitterName':_0x149bd8[_0x4d013d(0x1c8)]?.['Name'],'remitterIban':_0x149bd8[_0x4d013d(0x1c8)]?.[_0x4d013d(0x1b6)],'bankTransactionId':_0x149bd8[_0x4d013d(0x1d7)]}};}['verifyWebhookSignature'](_0x3c621b,_0x1d7bcc){const _0x37b9ff=a44_0x4505a5;return console[_0x37b9ff(0x183)](_0x37b9ff(0x1de),{'receivedSignature':_0x1d7bcc,'paymentId':_0x3c621b[_0x37b9ff(0x185)],'merchantPaymentId':_0x3c621b[_0x37b9ff(0x1a4)]}),!![];}}exports[a44_0x4505a5(0x174)]=NodaService;