'use strict';const a48_0x21bea8=a48_0x5164;(function(_0x40c06c,_0x137f41){const _0x43eba2=a48_0x5164,_0xfc7a04=_0x40c06c();while(!![]){try{const _0x548717=parseInt(_0x43eba2(0xb2))/0x1+parseInt(_0x43eba2(0x9e))/0x2*(-parseInt(_0x43eba2(0xec))/0x3)+parseInt(_0x43eba2(0x92))/0x4+parseInt(_0x43eba2(0xd5))/0x5+-parseInt(_0x43eba2(0xb1))/0x6+-parseInt(_0x43eba2(0xd0))/0x7+-parseInt(_0x43eba2(0xf0))/0x8*(-parseInt(_0x43eba2(0x81))/0x9);if(_0x548717===_0x137f41)break;else _0xfc7a04['push'](_0xfc7a04['shift']());}catch(_0x8f5f9e){_0xfc7a04['push'](_0xfc7a04['shift']());}}}(a48_0x1995,0xaaeeb));function a48_0x5164(_0x3e914d,_0x2732ae){const _0x199540=a48_0x1995();return a48_0x5164=function(_0x5164cb,_0x1f4bc6){_0x5164cb=_0x5164cb-0x81;let _0x3511e4=_0x199540[_0x5164cb];return _0x3511e4;},a48_0x5164(_0x3e914d,_0x2732ae);}Object['defineProperty'](exports,a48_0x21bea8(0xc4),{'value':!![]}),exports['NodaService']=void 0x0;function a48_0x1995(){const _0x425b83=['Not\x20provided','Failed\x20to\x20verify\x20Noda\x20payment:\x20','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20parse\x20JSON\x20response:','logWhiteDomainResponse','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','EXPIRED','QR\x20Code\x20Link:','PAID','Status\x20Text:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','entries','FAILED','NodaService','GET','processWebhook','Status','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','892146HfDAms','1366849QIBFOh','/payment-links/','status','URL:','statusCode','cancelled','now','Payment\x20Link\x20ID:','Amount','/payment-links','expiryDate','stringify','Remitter','currency','toUpperCase','Order\x20ID\x20Used:','shortLink','message','__esModule','Noda\x20payment\x20verification\x20error:','https://tesoft.uk/gateway/noda/webhook/','MerchantPaymentId','TesSoft\x20Payment\x20System/1.0','Request\x20Body\x20(Direct\x20JSON):','Response\x20Body:','application/json','https://tesoft.uk/gateway/pending.php?id=','text','===\x20NODA\x20API\x20ERROR\x20===','Noda\x20API\x20error:\x20','6516013kmDVBK','timeout','fromEntries','Method','apiUrl','839550MDEFLu','Iban','Error\x20stack:','Response\x20Time:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20NODA\x20SERVICE\x20ERROR\x20===','canceled','Yes','active','json','Headers:','BankId','POST','===\x20PARSED\x20NODA\x20RESPONSE\x20===','../loggerService','Response\x20data:','toLowerCase','failed','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','processing','parse','Unknown\x20error','SettlementDate','3969oSgnGa','https://tesoft.uk/gateway/noda/','logWhiteDomainRequest','HTTP\x20','5067848FNjWOE','Short\x20Link:','shortLinkUrls','verifyPayment','createPaymentLink','Noda\x20webhook\x20signature\x20verification:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','9LXTsIM','Unknown\x20error\x20from\x20Noda\x20API','log','isActive','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Currency','noda','Business\x20Error:\x20','===\x20NODA\x20SUCCESS\x20===','HTTP\x20error!\x20status:\x20','qrCodeLink','paid','Settled','PaymentId','Status\x20Code:','in_progress','logWhiteDomainError','377376FTMOkH','(8digits-8digits\x20format)','rejected','loggerService','Raw\x20Response\x20Body:','JSON\x20Parse\x20Error:\x20','success','Error\x20Message:','Processing\x20Noda\x20webhook:','PENDING','verifyWebhookSignature','error','730aGxdnh'];a48_0x1995=function(){return _0x425b83;};return a48_0x1995();}const loggerService_1=require(a48_0x21bea8(0xe3));class NodaService{constructor(){const _0x5d46f9=a48_0x21bea8;this[_0x5d46f9(0xd4)]=_0x5d46f9(0xed),console[_0x5d46f9(0x83)](_0x5d46f9(0xd9));}async[a48_0x21bea8(0xf4)](_0x2fa172){const _0x2dcc80=a48_0x21bea8,{orderId:_0x3bc3f6,name:_0x41d302,paymentDescription:_0x18c839,amount:_0xbfc4f0,currency:_0x858766,webhookUrl:_0x40c79d,returnUrl:_0x1fd602,expiryDate:_0x36e3f1}=_0x2fa172,_0x1a2c30=_0x858766[_0x2dcc80(0xc0)](),_0x5eb507=_0x2dcc80(0xc6),_0x2b27f4=_0x2dcc80(0xcc)+_0x3bc3f6,_0xb829ed={'name':_0x41d302,'paymentDescription':_0x18c839,'amount':_0xbfc4f0,'currency':_0x1a2c30,'paymentId':_0x3bc3f6,'webhookUrl':_0x5eb507,'returnUrl':_0x2b27f4};_0x36e3f1&&(_0xb829ed[_0x2dcc80(0xbc)]=_0x36e3f1);const _0x9196cd=Date[_0x2dcc80(0xb8)]();try{console[_0x2dcc80(0x83)](_0x2dcc80(0xe7)),console['log'](_0x2dcc80(0xb5),this['apiUrl']),console[_0x2dcc80(0x83)](_0x2dcc80(0xc9),JSON[_0x2dcc80(0xbd)](_0xb829ed,null,0x2)),console[_0x2dcc80(0x83)]('Order\x20ID\x20Format:',_0x3bc3f6,'(8digits-8digits\x20format\x20for\x20Noda)'),console['log']('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x2b27f4),loggerService_1[_0x2dcc80(0x95)][_0x2dcc80(0xee)](_0x2dcc80(0x87),_0x2dcc80(0xbb),_0x2dcc80(0xe1),_0xb829ed);const _0xbeefd7=await fetch(this[_0x2dcc80(0xd4)],{'method':'POST','headers':{'Content-Type':_0x2dcc80(0xcb),'Accept':_0x2dcc80(0xcb),'User-Agent':_0x2dcc80(0xc8)},'body':JSON['stringify'](_0xb829ed)}),_0x208479=Date[_0x2dcc80(0xb8)]()-_0x9196cd;console[_0x2dcc80(0x83)](_0x2dcc80(0xb0)),console[_0x2dcc80(0x83)]('Status:',_0xbeefd7[_0x2dcc80(0xb4)]),console[_0x2dcc80(0x83)](_0x2dcc80(0xa8),_0xbeefd7['statusText']),console[_0x2dcc80(0x83)](_0x2dcc80(0xdf),Object[_0x2dcc80(0xd2)](_0xbeefd7['headers'][_0x2dcc80(0xaa)]())),console[_0x2dcc80(0x83)](_0x2dcc80(0xd8),_0x208479+'ms');const _0x45e56b=await _0xbeefd7[_0x2dcc80(0xcd)]();console[_0x2dcc80(0x83)](_0x2dcc80(0x96),_0x45e56b);if(!_0xbeefd7['ok']){console[_0x2dcc80(0x9d)](_0x2dcc80(0xce)),console['error']('HTTP\x20Status:',_0xbeefd7['status']),console[_0x2dcc80(0x9d)](_0x2dcc80(0xca),_0x45e56b),loggerService_1[_0x2dcc80(0x95)][_0x2dcc80(0xa3)](_0x2dcc80(0x87),_0x2dcc80(0xbb),_0xbeefd7[_0x2dcc80(0xb4)],_0x45e56b,_0x208479),loggerService_1[_0x2dcc80(0x95)][_0x2dcc80(0x91)](_0x2dcc80(0x87),'/payment-links',_0x2dcc80(0xef)+_0xbeefd7[_0x2dcc80(0xb4)]+':\x20'+_0x45e56b);if(_0xbeefd7[_0x2dcc80(0xb4)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0xbeefd7['status']===0x1f4)throw new Error(_0x2dcc80(0xa9));}throw new Error(_0x2dcc80(0x8a)+_0xbeefd7['status']+',\x20body:\x20'+_0x45e56b);}let _0x2702dd;try{_0x2702dd=JSON[_0x2dcc80(0xe9)](_0x45e56b);}catch(_0x3ae517){console[_0x2dcc80(0x9d)](_0x2dcc80(0xa2),_0x3ae517),loggerService_1[_0x2dcc80(0x95)][_0x2dcc80(0x91)](_0x2dcc80(0x87),'/payment-links',_0x2dcc80(0x97)+_0x3ae517);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x45e56b);}console[_0x2dcc80(0x83)](_0x2dcc80(0xe2)),console['log']('Parsed\x20Result:',JSON[_0x2dcc80(0xbd)](_0x2702dd,null,0x2)),loggerService_1[_0x2dcc80(0x95)]['logWhiteDomainResponse'](_0x2dcc80(0x87),_0x2dcc80(0xbb),_0xbeefd7[_0x2dcc80(0xb4)],_0x2702dd,_0x208479);if(_0x2702dd[_0x2dcc80(0x9d)]||_0x2702dd[_0x2dcc80(0xb6)]){const _0x2055fa=_0x2702dd[_0x2dcc80(0xc3)]||_0x2702dd['error']||_0x2dcc80(0x82);console[_0x2dcc80(0x9d)](_0x2dcc80(0xa1)),console[_0x2dcc80(0x9d)](_0x2dcc80(0x99),_0x2055fa),console[_0x2dcc80(0x9d)](_0x2dcc80(0x8f),_0x2702dd[_0x2dcc80(0xb6)]),loggerService_1['loggerService'][_0x2dcc80(0x91)](_0x2dcc80(0x87),_0x2dcc80(0xbb),_0x2dcc80(0x88)+_0x2055fa);throw new Error(_0x2dcc80(0xcf)+_0x2055fa);}if(!_0x2702dd['id']||!_0x2702dd[_0x2dcc80(0xf2)]?.[_0x2dcc80(0xc2)]){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x2dcc80(0x9d)](_0x2dcc80(0xe4),_0x2702dd),loggerService_1[_0x2dcc80(0x95)]['logWhiteDomainError'](_0x2dcc80(0x87),_0x2dcc80(0xbb),_0x2dcc80(0xa4));throw new Error(_0x2dcc80(0xf6));}return console[_0x2dcc80(0x83)](_0x2dcc80(0x89)),console[_0x2dcc80(0x83)](_0x2dcc80(0xb9),_0x2702dd['id']),console[_0x2dcc80(0x83)](_0x2dcc80(0xf1),_0x2702dd[_0x2dcc80(0xf2)]['shortLink']),console[_0x2dcc80(0x83)](_0x2dcc80(0xa6),_0x2702dd[_0x2dcc80(0xf2)]['qrCodeLink']||_0x2dcc80(0x9f)),console[_0x2dcc80(0x83)](_0x2dcc80(0xc1),_0x3bc3f6,_0x2dcc80(0x93)),console['log']('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x2b27f4),{'gateway_payment_id':_0x2702dd['id'],'payment_url':_0x2702dd['shortLinkUrls'][_0x2dcc80(0xc2)],'qr_code_url':_0x2702dd[_0x2dcc80(0xf2)][_0x2dcc80(0x8b)],'expiry_date':_0x2702dd['expiryDate']};}catch(_0x13b7d1){console['error'](_0x2dcc80(0xda)),console[_0x2dcc80(0x9d)]('Error\x20details:',_0x13b7d1),loggerService_1[_0x2dcc80(0x95)][_0x2dcc80(0x91)]('noda',_0x2dcc80(0xbb),_0x13b7d1);if(_0x13b7d1 instanceof Error){console[_0x2dcc80(0x9d)]('Error\x20message:',_0x13b7d1[_0x2dcc80(0xc3)]),console[_0x2dcc80(0x9d)](_0x2dcc80(0xd7),_0x13b7d1['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x13b7d1[_0x2dcc80(0xc3)]);}throw new Error(_0x2dcc80(0x85));}}async[a48_0x21bea8(0xf3)](_0x193d49){const _0x64f33=a48_0x21bea8,_0xa366cd=Date['now']();try{loggerService_1[_0x64f33(0x95)]['logWhiteDomainRequest']('noda',_0x64f33(0xb3)+_0x193d49,_0x64f33(0xad),{});const _0x59464b=await fetch(this[_0x64f33(0xd4)]+'/'+_0x193d49,{'method':'GET','headers':{'Content-Type':_0x64f33(0xcb),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x349e35=Date['now']()-_0xa366cd;if(!_0x59464b['ok']){const _0x4bdb15=await _0x59464b[_0x64f33(0xcd)]();loggerService_1[_0x64f33(0x95)][_0x64f33(0xa3)](_0x64f33(0x87),_0x64f33(0xb3)+_0x193d49,_0x59464b[_0x64f33(0xb4)],_0x4bdb15,_0x349e35);throw new Error(_0x64f33(0x8a)+_0x59464b[_0x64f33(0xb4)]);}const _0x16107c=await _0x59464b[_0x64f33(0xde)]();loggerService_1[_0x64f33(0x95)][_0x64f33(0xa3)]('noda',_0x64f33(0xb3)+_0x193d49,_0x59464b['status'],_0x16107c,_0x349e35);if(_0x16107c[_0x64f33(0x9d)]||_0x16107c['statusCode']){loggerService_1[_0x64f33(0x95)][_0x64f33(0x91)]('noda',_0x64f33(0xb3)+_0x193d49,_0x64f33(0xcf)+(_0x16107c[_0x64f33(0xc3)]||_0x16107c['error']||_0x64f33(0xea)));throw new Error(_0x64f33(0xcf)+(_0x16107c[_0x64f33(0xc3)]||_0x16107c['error']||_0x64f33(0xea)));}let _0x496a4a=_0x64f33(0x9b);if(_0x16107c[_0x64f33(0x84)]===![]){if(_0x16107c[_0x64f33(0xbc)]){const _0x5dc587=new Date(_0x16107c[_0x64f33(0xbc)]),_0x5bb6f5=new Date();_0x5dc587<_0x5bb6f5?_0x496a4a=_0x64f33(0xa5):_0x496a4a=_0x64f33(0xab);}else _0x496a4a='FAILED';}else _0x496a4a=_0x64f33(0x9b);return{'status':_0x496a4a,'amount':_0x16107c['amount'],'currency':_0x16107c[_0x64f33(0xbf)],'isActive':_0x16107c[_0x64f33(0x84)]};}catch(_0x305f4a){console[_0x64f33(0x9d)](_0x64f33(0xc5),_0x305f4a),loggerService_1[_0x64f33(0x95)][_0x64f33(0x91)](_0x64f33(0x87),_0x64f33(0xb3)+_0x193d49,_0x305f4a);throw new Error(_0x64f33(0xa0)+(_0x305f4a instanceof Error?_0x305f4a[_0x64f33(0xc3)]:'Unknown\x20error'));}}async[a48_0x21bea8(0xae)](_0x30a34c){const _0xe992c7=a48_0x21bea8;console[_0xe992c7(0x83)](_0xe992c7(0x9a),_0x30a34c);let _0x97ad98=_0xe992c7(0x9b);switch(_0x30a34c[_0xe992c7(0xaf)]?.[_0xe992c7(0xe5)]()){case'done':case'completed':case _0xe992c7(0x8c):case _0xe992c7(0x98):case'successful':_0x30a34c[_0xe992c7(0x8d)]===_0xe992c7(0xdc)?_0x97ad98=_0xe992c7(0xa7):_0x97ad98=_0xe992c7(0x9b);break;case _0xe992c7(0xb7):case _0xe992c7(0xdb):case _0xe992c7(0xe6):case _0xe992c7(0x9d):case _0xe992c7(0x94):_0x97ad98='FAILED';break;case'expired':case _0xe992c7(0xd1):_0x97ad98=_0xe992c7(0xa5);break;case'pending':case'created':case _0xe992c7(0xdd):case _0xe992c7(0xe8):case _0xe992c7(0x90):default:_0x97ad98='PENDING';break;}return{'paymentId':_0x30a34c[_0xe992c7(0xc7)]||_0x30a34c[_0xe992c7(0x8e)],'status':_0x97ad98,'amount':_0x30a34c[_0xe992c7(0xba)],'currency':_0x30a34c[_0xe992c7(0x86)],'additionalInfo':{'method':_0x30a34c[_0xe992c7(0xd3)],'bankId':_0x30a34c[_0xe992c7(0xe0)],'settled':_0x30a34c[_0xe992c7(0x8d)],'settlementDate':_0x30a34c[_0xe992c7(0xeb)],'remitterName':_0x30a34c[_0xe992c7(0xbe)]?.['Name'],'remitterIban':_0x30a34c[_0xe992c7(0xbe)]?.[_0xe992c7(0xd6)],'bankTransactionId':_0x30a34c['BankTransactionId']}};}[a48_0x21bea8(0x9c)](_0x4d0977,_0x2e47c7){const _0x9e2182=a48_0x21bea8;return console['log'](_0x9e2182(0xf5),{'receivedSignature':_0x2e47c7,'paymentId':_0x4d0977[_0x9e2182(0x8e)],'merchantPaymentId':_0x4d0977[_0x9e2182(0xc7)]}),!![];}}exports[a48_0x21bea8(0xac)]=NodaService;