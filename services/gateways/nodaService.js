'use strict';function a48_0x519f(){const _0x29a369=['logWhiteDomainError','status','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Remitter','Name','35eHParH','Noda\x20webhook\x20signature\x20verification:','486996cNVBEr','===\x20PARSED\x20NODA\x20RESPONSE\x20===','currency','completed','Currency','now','Missing\x20id\x20or\x20shortLink\x20in\x20response','cancelled','Error\x20details:','Order\x20ID\x20Format:','16fMoupi','Parsed\x20Result:','4700420pJPZDe','GET','paid','Status','canceled','PENDING','EXPIRED','Headers:','loggerService','===\x20NODA\x20API\x20ERROR\x20===','Unknown\x20error','__esModule','URL:','json','QR\x20Code\x20Link:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','processWebhook','30017664cguQAX','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','application/json','Not\x20provided','toLowerCase','created','/payment-links','successful','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Request\x20Body\x20(Direct\x20JSON):','Method','TesSoft\x20Payment\x20System/1.0','HTTP\x20Status:','qrCodeLink','success','(8digits-8digits\x20format\x20for\x20Noda)','Noda\x20payment\x20verification\x20error:','https://tesoft.uk/gateway/noda/','3079824ibshrI','PAID','shortLink','statusCode','Status\x20Code:','message','326200mTQDrz','Error\x20Message:','failed','isActive','Noda\x20API\x20error:\x20','amount','Unknown\x20error\x20from\x20Noda\x20API','noda','processing','fromEntries','Response\x20Body:','expiryDate','Amount','HTTP\x20error!\x20status:\x20','===\x20NODA\x20SUCCESS\x20===','FAILED','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','stringify','Payment\x20Link\x20ID:','Settled','BankTransactionId','expired','BankId','entries','Response\x20data:','error','logWhiteDomainRequest','toUpperCase','(8digits-8digits\x20format)','NodaService','Iban','apiUrl','pending','verifyWebhookSignature','shortLinkUrls','MerchantPaymentId','Response\x20Time:','done','6634285QDDLuA','53079rzHiTK','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','logWhiteDomainResponse','Raw\x20Response\x20Body:','Order\x20ID\x20Used:','text','PaymentId','createPaymentLink','Error\x20stack:',',\x20body:\x20','log','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Processing\x20Noda\x20webhook:','active','../loggerService','/payment-links/','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','defineProperty','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','stack','headers'];a48_0x519f=function(){return _0x29a369;};return a48_0x519f();}const a48_0x434ae9=a48_0x3702;(function(_0x5d4a13,_0x1e7351){const _0x17c742=a48_0x3702,_0x552a7c=_0x5d4a13();while(!![]){try{const _0xbb20d7=parseInt(_0x17c742(0x1fc))/0x1*(parseInt(_0x17c742(0x1aa))/0x2)+parseInt(_0x17c742(0x1cf))/0x3+parseInt(_0x17c742(0x1ac))/0x4+parseInt(_0x17c742(0x1fb))/0x5+parseInt(_0x17c742(0x1a0))/0x6+-parseInt(_0x17c742(0x19e))/0x7*(-parseInt(_0x17c742(0x1d5))/0x8)+-parseInt(_0x17c742(0x1bd))/0x9;if(_0xbb20d7===_0x1e7351)break;else _0x552a7c['push'](_0x552a7c['shift']());}catch(_0x34c6de){_0x552a7c['push'](_0x552a7c['shift']());}}}(a48_0x519f,0xdc723));Object[a48_0x434ae9(0x195)](exports,a48_0x434ae9(0x1b7),{'value':!![]}),exports[a48_0x434ae9(0x1f2)]=void 0x0;const loggerService_1=require(a48_0x434ae9(0x191));function a48_0x3702(_0x4966f4,_0x2080bd){const _0x519f69=a48_0x519f();return a48_0x3702=function(_0x370291,_0x326d77){_0x370291=_0x370291-0x186;let _0x486ab8=_0x519f69[_0x370291];return _0x486ab8;},a48_0x3702(_0x4966f4,_0x2080bd);}class NodaService{constructor(){const _0x3c0019=a48_0x434ae9;this[_0x3c0019(0x1f4)]=_0x3c0019(0x1ce),console[_0x3c0019(0x18d)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a48_0x434ae9(0x18a)](_0x26feae){const _0x4ae1e1=a48_0x434ae9,{orderId:_0x341deb,name:_0x27a4ad,paymentDescription:_0x5ca061,amount:_0x38b467,currency:_0x3c1213,webhookUrl:_0x508504,returnUrl:_0x3411a0,expiryDate:_0x1494f4}=_0x26feae,_0x4370f6=_0x3c1213[_0x4ae1e1(0x1f0)](),_0x3ce75a='https://tesoft.uk/gateway/noda/webhook/',_0x1e043c='https://tesoft.uk/gateway/pending.php?id='+_0x341deb,_0x3ddf9b={'name':_0x27a4ad,'paymentDescription':_0x5ca061,'amount':_0x38b467,'currency':_0x4370f6,'paymentId':_0x341deb,'webhookUrl':_0x3ce75a,'returnUrl':_0x1e043c};_0x1494f4&&(_0x3ddf9b[_0x4ae1e1(0x1e0)]=_0x1494f4);const _0x29f5d5=Date[_0x4ae1e1(0x1a5)]();try{console[_0x4ae1e1(0x18d)](_0x4ae1e1(0x196)),console[_0x4ae1e1(0x18d)](_0x4ae1e1(0x1b8),this[_0x4ae1e1(0x1f4)]),console[_0x4ae1e1(0x18d)](_0x4ae1e1(0x1c6),JSON[_0x4ae1e1(0x1e6)](_0x3ddf9b,null,0x2)),console['log'](_0x4ae1e1(0x1a9),_0x341deb,_0x4ae1e1(0x1cc)),console['log'](_0x4ae1e1(0x193),_0x1e043c),loggerService_1[_0x4ae1e1(0x1b4)][_0x4ae1e1(0x1ef)](_0x4ae1e1(0x1dc),_0x4ae1e1(0x1c3),'POST',_0x3ddf9b);const _0x4382d6=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x4ae1e1(0x1bf),'Accept':_0x4ae1e1(0x1bf),'User-Agent':_0x4ae1e1(0x1c8)},'body':JSON['stringify'](_0x3ddf9b)}),_0x15e03e=Date[_0x4ae1e1(0x1a5)]()-_0x29f5d5;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x4ae1e1(0x18d)]('Status:',_0x4382d6[_0x4ae1e1(0x19a)]),console[_0x4ae1e1(0x18d)]('Status\x20Text:',_0x4382d6['statusText']),console[_0x4ae1e1(0x18d)](_0x4ae1e1(0x1b3),Object[_0x4ae1e1(0x1de)](_0x4382d6[_0x4ae1e1(0x198)][_0x4ae1e1(0x1ec)]())),console[_0x4ae1e1(0x18d)](_0x4ae1e1(0x1f9),_0x15e03e+'ms');const _0x35aa98=await _0x4382d6[_0x4ae1e1(0x188)]();console[_0x4ae1e1(0x18d)](_0x4ae1e1(0x186),_0x35aa98);if(!_0x4382d6['ok']){console[_0x4ae1e1(0x1ee)](_0x4ae1e1(0x1b5)),console[_0x4ae1e1(0x1ee)](_0x4ae1e1(0x1c9),_0x4382d6[_0x4ae1e1(0x19a)]),console[_0x4ae1e1(0x1ee)](_0x4ae1e1(0x1df),_0x35aa98),loggerService_1[_0x4ae1e1(0x1b4)]['logWhiteDomainResponse']('noda',_0x4ae1e1(0x1c3),_0x4382d6[_0x4ae1e1(0x19a)],_0x35aa98,_0x15e03e),loggerService_1[_0x4ae1e1(0x1b4)][_0x4ae1e1(0x199)]('noda',_0x4ae1e1(0x1c3),'HTTP\x20'+_0x4382d6[_0x4ae1e1(0x19a)]+':\x20'+_0x35aa98);if(_0x4382d6['status']===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x4382d6[_0x4ae1e1(0x19a)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x4ae1e1(0x1e2)+_0x4382d6[_0x4ae1e1(0x19a)]+_0x4ae1e1(0x18c)+_0x35aa98);}let _0x3b6ecc;try{_0x3b6ecc=JSON['parse'](_0x35aa98);}catch(_0x42864c){console[_0x4ae1e1(0x1ee)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x42864c),loggerService_1['loggerService'][_0x4ae1e1(0x199)](_0x4ae1e1(0x1dc),_0x4ae1e1(0x1c3),'JSON\x20Parse\x20Error:\x20'+_0x42864c);throw new Error(_0x4ae1e1(0x1fd)+_0x35aa98);}console[_0x4ae1e1(0x18d)](_0x4ae1e1(0x1a1)),console[_0x4ae1e1(0x18d)](_0x4ae1e1(0x1ab),JSON[_0x4ae1e1(0x1e6)](_0x3b6ecc,null,0x2)),loggerService_1[_0x4ae1e1(0x1b4)][_0x4ae1e1(0x1fe)](_0x4ae1e1(0x1dc),_0x4ae1e1(0x1c3),_0x4382d6[_0x4ae1e1(0x19a)],_0x3b6ecc,_0x15e03e);if(_0x3b6ecc[_0x4ae1e1(0x1ee)]||_0x3b6ecc[_0x4ae1e1(0x1d2)]){const _0x5b1096=_0x3b6ecc['message']||_0x3b6ecc[_0x4ae1e1(0x1ee)]||_0x4ae1e1(0x1db);console[_0x4ae1e1(0x1ee)](_0x4ae1e1(0x1bb)),console[_0x4ae1e1(0x1ee)](_0x4ae1e1(0x1d6),_0x5b1096),console['error'](_0x4ae1e1(0x1d3),_0x3b6ecc[_0x4ae1e1(0x1d2)]),loggerService_1[_0x4ae1e1(0x1b4)][_0x4ae1e1(0x199)](_0x4ae1e1(0x1dc),_0x4ae1e1(0x1c3),'Business\x20Error:\x20'+_0x5b1096);throw new Error(_0x4ae1e1(0x1d9)+_0x5b1096);}if(!_0x3b6ecc['id']||!_0x3b6ecc['shortLinkUrls']?.[_0x4ae1e1(0x1d1)]){console['error'](_0x4ae1e1(0x19b)),console[_0x4ae1e1(0x1ee)](_0x4ae1e1(0x1a6)),console['error'](_0x4ae1e1(0x1ed),_0x3b6ecc),loggerService_1[_0x4ae1e1(0x1b4)][_0x4ae1e1(0x199)]('noda',_0x4ae1e1(0x1c3),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x4ae1e1(0x18e));}return console[_0x4ae1e1(0x18d)](_0x4ae1e1(0x1e3)),console[_0x4ae1e1(0x18d)](_0x4ae1e1(0x1e7),_0x3b6ecc['id']),console[_0x4ae1e1(0x18d)]('Short\x20Link:',_0x3b6ecc[_0x4ae1e1(0x1f7)][_0x4ae1e1(0x1d1)]),console['log'](_0x4ae1e1(0x1ba),_0x3b6ecc['shortLinkUrls'][_0x4ae1e1(0x1ca)]||_0x4ae1e1(0x1c0)),console['log'](_0x4ae1e1(0x187),_0x341deb,_0x4ae1e1(0x1f1)),console[_0x4ae1e1(0x18d)](_0x4ae1e1(0x1be),_0x1e043c),{'gateway_payment_id':_0x3b6ecc['id'],'payment_url':_0x3b6ecc[_0x4ae1e1(0x1f7)]['shortLink'],'qr_code_url':_0x3b6ecc[_0x4ae1e1(0x1f7)][_0x4ae1e1(0x1ca)],'expiry_date':_0x3b6ecc['expiryDate']};}catch(_0x1e3572){console[_0x4ae1e1(0x1ee)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x4ae1e1(0x1ee)](_0x4ae1e1(0x1a8),_0x1e3572),loggerService_1['loggerService'][_0x4ae1e1(0x199)](_0x4ae1e1(0x1dc),_0x4ae1e1(0x1c3),_0x1e3572);if(_0x1e3572 instanceof Error){console[_0x4ae1e1(0x1ee)]('Error\x20message:',_0x1e3572[_0x4ae1e1(0x1d4)]),console['error'](_0x4ae1e1(0x18b),_0x1e3572[_0x4ae1e1(0x197)]);throw new Error(_0x4ae1e1(0x1e5)+_0x1e3572[_0x4ae1e1(0x1d4)]);}throw new Error(_0x4ae1e1(0x1c5));}}async['verifyPayment'](_0x5864c8){const _0x128c6a=a48_0x434ae9,_0x2d38d1=Date[_0x128c6a(0x1a5)]();try{loggerService_1['loggerService'][_0x128c6a(0x1ef)]('noda',_0x128c6a(0x192)+_0x5864c8,_0x128c6a(0x1ad),{});const _0x604f30=await fetch(this[_0x128c6a(0x1f4)]+'/'+_0x5864c8,{'method':_0x128c6a(0x1ad),'headers':{'Content-Type':_0x128c6a(0x1bf),'User-Agent':_0x128c6a(0x1c8)}}),_0x16e6ed=Date[_0x128c6a(0x1a5)]()-_0x2d38d1;if(!_0x604f30['ok']){const _0x3572c1=await _0x604f30[_0x128c6a(0x188)]();loggerService_1[_0x128c6a(0x1b4)][_0x128c6a(0x1fe)]('noda',_0x128c6a(0x192)+_0x5864c8,_0x604f30[_0x128c6a(0x19a)],_0x3572c1,_0x16e6ed);throw new Error('HTTP\x20error!\x20status:\x20'+_0x604f30[_0x128c6a(0x19a)]);}const _0xfd06bd=await _0x604f30[_0x128c6a(0x1b9)]();loggerService_1[_0x128c6a(0x1b4)][_0x128c6a(0x1fe)](_0x128c6a(0x1dc),_0x128c6a(0x192)+_0x5864c8,_0x604f30[_0x128c6a(0x19a)],_0xfd06bd,_0x16e6ed);if(_0xfd06bd['error']||_0xfd06bd[_0x128c6a(0x1d2)]){loggerService_1['loggerService'][_0x128c6a(0x199)](_0x128c6a(0x1dc),'/payment-links/'+_0x5864c8,_0x128c6a(0x1d9)+(_0xfd06bd[_0x128c6a(0x1d4)]||_0xfd06bd['error']||_0x128c6a(0x1b6)));throw new Error('Noda\x20API\x20error:\x20'+(_0xfd06bd[_0x128c6a(0x1d4)]||_0xfd06bd[_0x128c6a(0x1ee)]||'Unknown\x20error'));}let _0x1e36a7=_0x128c6a(0x1b1);if(_0xfd06bd[_0x128c6a(0x1d8)]===![]){if(_0xfd06bd[_0x128c6a(0x1e0)]){const _0x2aa11d=new Date(_0xfd06bd[_0x128c6a(0x1e0)]),_0x67063a=new Date();_0x2aa11d<_0x67063a?_0x1e36a7='EXPIRED':_0x1e36a7=_0x128c6a(0x1e4);}else _0x1e36a7=_0x128c6a(0x1e4);}else _0x1e36a7=_0x128c6a(0x1b1);return{'status':_0x1e36a7,'amount':_0xfd06bd[_0x128c6a(0x1da)],'currency':_0xfd06bd[_0x128c6a(0x1a2)],'isActive':_0xfd06bd['isActive']};}catch(_0x3b0cbc){console[_0x128c6a(0x1ee)](_0x128c6a(0x1cd),_0x3b0cbc),loggerService_1[_0x128c6a(0x1b4)][_0x128c6a(0x199)](_0x128c6a(0x1dc),_0x128c6a(0x192)+_0x5864c8,_0x3b0cbc);throw new Error(_0x128c6a(0x194)+(_0x3b0cbc instanceof Error?_0x3b0cbc[_0x128c6a(0x1d4)]:_0x128c6a(0x1b6)));}}async[a48_0x434ae9(0x1bc)](_0x5e0bbe){const _0x2a4800=a48_0x434ae9;console['log'](_0x2a4800(0x18f),_0x5e0bbe);let _0x14e273='PENDING';switch(_0x5e0bbe[_0x2a4800(0x1af)]?.[_0x2a4800(0x1c1)]()){case _0x2a4800(0x1fa):case _0x2a4800(0x1a3):case _0x2a4800(0x1ae):case _0x2a4800(0x1cb):case _0x2a4800(0x1c4):_0x5e0bbe[_0x2a4800(0x1e8)]==='Yes'?_0x14e273=_0x2a4800(0x1d0):_0x14e273=_0x2a4800(0x1b1);break;case _0x2a4800(0x1a7):case _0x2a4800(0x1b0):case _0x2a4800(0x1d7):case _0x2a4800(0x1ee):case'rejected':_0x14e273='FAILED';break;case _0x2a4800(0x1ea):case'timeout':_0x14e273=_0x2a4800(0x1b2);break;case _0x2a4800(0x1f5):case _0x2a4800(0x1c2):case _0x2a4800(0x190):case _0x2a4800(0x1dd):case'in_progress':default:_0x14e273=_0x2a4800(0x1b1);break;}return{'paymentId':_0x5e0bbe['MerchantPaymentId']||_0x5e0bbe[_0x2a4800(0x189)],'status':_0x14e273,'amount':_0x5e0bbe[_0x2a4800(0x1e1)],'currency':_0x5e0bbe[_0x2a4800(0x1a4)],'additionalInfo':{'method':_0x5e0bbe[_0x2a4800(0x1c7)],'bankId':_0x5e0bbe[_0x2a4800(0x1eb)],'settled':_0x5e0bbe[_0x2a4800(0x1e8)],'settlementDate':_0x5e0bbe['SettlementDate'],'remitterName':_0x5e0bbe[_0x2a4800(0x19c)]?.[_0x2a4800(0x19d)],'remitterIban':_0x5e0bbe['Remitter']?.[_0x2a4800(0x1f3)],'bankTransactionId':_0x5e0bbe[_0x2a4800(0x1e9)]}};}[a48_0x434ae9(0x1f6)](_0x547449,_0x2c2b7b){const _0x1569e4=a48_0x434ae9;return console[_0x1569e4(0x18d)](_0x1569e4(0x19f),{'receivedSignature':_0x2c2b7b,'paymentId':_0x547449[_0x1569e4(0x189)],'merchantPaymentId':_0x547449[_0x1569e4(0x1f8)]}),!![];}}exports['NodaService']=NodaService;