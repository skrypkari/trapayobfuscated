'use strict';const a44_0x62b5db=a44_0x5715;(function(_0x51f3c6,_0x4c4c6a){const _0x1f310e=a44_0x5715,_0x5cf1f1=_0x51f3c6();while(!![]){try{const _0x338a99=parseInt(_0x1f310e(0x1a9))/0x1+parseInt(_0x1f310e(0x1f3))/0x2+parseInt(_0x1f310e(0x1db))/0x3+-parseInt(_0x1f310e(0x1e5))/0x4*(parseInt(_0x1f310e(0x18e))/0x5)+parseInt(_0x1f310e(0x1a5))/0x6+parseInt(_0x1f310e(0x17b))/0x7*(-parseInt(_0x1f310e(0x178))/0x8)+parseInt(_0x1f310e(0x1dd))/0x9*(-parseInt(_0x1f310e(0x1d4))/0xa);if(_0x338a99===_0x4c4c6a)break;else _0x5cf1f1['push'](_0x5cf1f1['shift']());}catch(_0x32df2b){_0x5cf1f1['push'](_0x5cf1f1['shift']());}}}(a44_0x27e4,0x1df8d));Object[a44_0x62b5db(0x177)](exports,a44_0x62b5db(0x1ca),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require('../loggerService');function a44_0x27e4(){const _0x485c00=['Yes','===\x20NODA\x20SUCCESS\x20===','NodaService','expiryDate','(8digits-8digits\x20format)','URL:','success','parse','/payment-links/','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Currency','createPaymentLink','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','stringify','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Raw\x20Response\x20Body:','Status','statusCode','Parsed\x20Result:','logWhiteDomainResponse','apiUrl','__esModule','POST','HTTP\x20error!\x20status:\x20','completed','https://tesoft.uk/gateway/noda/','in_progress','now','Response\x20data:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','created','450sgSoaq','BankTransactionId','JSON\x20Parse\x20Error:\x20','(8digits-8digits\x20format\x20for\x20Noda)','Method','Unknown\x20error\x20from\x20Noda\x20API','failed','286713MWbUFu','/payment-links','59913RICaLD','processing','Not\x20provided','application/json','===\x20NODA\x20SERVICE\x20ERROR\x20===','amount','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','stack','174452SwhIwS','toLowerCase','Response\x20Time:','TesSoft\x20Payment\x20System/1.0','verifyPayment','toUpperCase','Payment\x20Link\x20ID:','Noda\x20payment\x20verification\x20error:','FAILED','error','===\x20NODA\x20API\x20ERROR\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','cancelled','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','392318fxcBKC','qrCodeLink','Short\x20Link:','defineProperty','56TeKEGm','Error\x20message:','Settled','64393hjwVFu','Remitter','message','Headers:','Response\x20Body:','status','Failed\x20to\x20parse\x20JSON\x20response:','PaymentId','canceled','pending','PENDING','BankId','Noda\x20API\x20error:\x20','https://tesoft.uk/gateway/noda/webhook/','noda','expired','done','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20Message:','15gIpQDp','Order\x20ID\x20Format:','MerchantPaymentId','text','GET','Status:','shortLinkUrls','Processing\x20Noda\x20webhook:','loggerService','https://tesoft.uk/gateway/pending.php?id=','Noda\x20webhook\x20signature\x20verification:','Business\x20Error:\x20','EXPIRED','logWhiteDomainError','timeout','isActive','json','shortLink','PAID','log','Order\x20ID\x20Used:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','successful','1315434QUQNvs','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','QR\x20Code\x20Link:','Iban','106593xbgcJT','Request\x20Body\x20(Direct\x20JSON):','entries','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Error\x20details:','logWhiteDomainRequest','Status\x20Code:','currency','Amount','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Unknown\x20error','headers'];a44_0x27e4=function(){return _0x485c00;};return a44_0x27e4();}class NodaService{constructor(){const _0xe582a5=a44_0x62b5db;this[_0xe582a5(0x1c9)]=_0xe582a5(0x1ce),console[_0xe582a5(0x1a1)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a44_0x62b5db(0x1c0)](_0x53409b){const _0x4584ff=a44_0x62b5db,{orderId:_0x10eefe,name:_0x3820d1,paymentDescription:_0x2a39fd,amount:_0x3b7c9c,currency:_0x2b00a2,webhookUrl:_0x1ba16a,returnUrl:_0x2c2f95,expiryDate:_0x1cdcfb}=_0x53409b,_0x259e77=_0x2b00a2[_0x4584ff(0x1ea)](),_0xc4f066=_0x4584ff(0x188),_0x5a9335=_0x4584ff(0x197)+_0x10eefe,_0x2f43d2={'name':_0x3820d1,'paymentDescription':_0x2a39fd,'amount':_0x3b7c9c,'currency':_0x259e77,'paymentId':_0x10eefe,'webhookUrl':_0xc4f066,'returnUrl':_0x5a9335};_0x1cdcfb&&(_0x2f43d2['expiryDate']=_0x1cdcfb);const _0xec7e07=Date[_0x4584ff(0x1d0)]();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x4584ff(0x1a1)](_0x4584ff(0x1ba),this[_0x4584ff(0x1c9)]),console[_0x4584ff(0x1a1)](_0x4584ff(0x1aa),JSON['stringify'](_0x2f43d2,null,0x2)),console[_0x4584ff(0x1a1)](_0x4584ff(0x18f),_0x10eefe,_0x4584ff(0x1d7)),console['log'](_0x4584ff(0x1c1),_0x5a9335),loggerService_1[_0x4584ff(0x196)]['logWhiteDomainRequest'](_0x4584ff(0x189),_0x4584ff(0x1dc),_0x4584ff(0x1cb),_0x2f43d2);const _0x533778=await fetch(this[_0x4584ff(0x1c9)],{'method':'POST','headers':{'Content-Type':_0x4584ff(0x1e0),'Accept':_0x4584ff(0x1e0),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x4584ff(0x1c2)](_0x2f43d2)}),_0x9c3633=Date[_0x4584ff(0x1d0)]()-_0xec7e07;console[_0x4584ff(0x1a1)](_0x4584ff(0x18c)),console[_0x4584ff(0x1a1)](_0x4584ff(0x193),_0x533778[_0x4584ff(0x180)]),console[_0x4584ff(0x1a1)]('Status\x20Text:',_0x533778['statusText']),console[_0x4584ff(0x1a1)](_0x4584ff(0x17e),Object['fromEntries'](_0x533778[_0x4584ff(0x1b4)][_0x4584ff(0x1ab)]())),console[_0x4584ff(0x1a1)](_0x4584ff(0x1e7),_0x9c3633+'ms');const _0x3790f7=await _0x533778[_0x4584ff(0x191)]();console[_0x4584ff(0x1a1)](_0x4584ff(0x1c4),_0x3790f7);if(!_0x533778['ok']){console[_0x4584ff(0x1ee)](_0x4584ff(0x1ef)),console[_0x4584ff(0x1ee)]('HTTP\x20Status:',_0x533778[_0x4584ff(0x180)]),console[_0x4584ff(0x1ee)](_0x4584ff(0x17f),_0x3790f7),loggerService_1['loggerService'][_0x4584ff(0x1c8)](_0x4584ff(0x189),_0x4584ff(0x1dc),_0x533778[_0x4584ff(0x180)],_0x3790f7,_0x9c3633),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x4584ff(0x1dc),'HTTP\x20'+_0x533778[_0x4584ff(0x180)]+':\x20'+_0x3790f7);if(_0x533778[_0x4584ff(0x180)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x533778[_0x4584ff(0x180)]===0x1f4)throw new Error(_0x4584ff(0x1f2));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x533778[_0x4584ff(0x180)]+',\x20body:\x20'+_0x3790f7);}let _0x398ab6;try{_0x398ab6=JSON[_0x4584ff(0x1bc)](_0x3790f7);}catch(_0x5efa07){console[_0x4584ff(0x1ee)](_0x4584ff(0x181),_0x5efa07),loggerService_1[_0x4584ff(0x196)][_0x4584ff(0x19b)]('noda',_0x4584ff(0x1dc),_0x4584ff(0x1d6)+_0x5efa07);throw new Error(_0x4584ff(0x1e3)+_0x3790f7);}console[_0x4584ff(0x1a1)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x4584ff(0x1a1)](_0x4584ff(0x1c7),JSON['stringify'](_0x398ab6,null,0x2)),loggerService_1[_0x4584ff(0x196)]['logWhiteDomainResponse'](_0x4584ff(0x189),_0x4584ff(0x1dc),_0x533778['status'],_0x398ab6,_0x9c3633);if(_0x398ab6['error']||_0x398ab6['statusCode']){const _0xf8760d=_0x398ab6[_0x4584ff(0x17d)]||_0x398ab6[_0x4584ff(0x1ee)]||_0x4584ff(0x1d9);console[_0x4584ff(0x1ee)](_0x4584ff(0x1be)),console[_0x4584ff(0x1ee)](_0x4584ff(0x18d),_0xf8760d),console['error'](_0x4584ff(0x1af),_0x398ab6[_0x4584ff(0x1c6)]),loggerService_1['loggerService'][_0x4584ff(0x19b)](_0x4584ff(0x189),_0x4584ff(0x1dc),_0x4584ff(0x199)+_0xf8760d);throw new Error(_0x4584ff(0x187)+_0xf8760d);}if(!_0x398ab6['id']||!_0x398ab6[_0x4584ff(0x194)]?.[_0x4584ff(0x19f)]){console[_0x4584ff(0x1ee)](_0x4584ff(0x1d2)),console['error']('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x4584ff(0x1ee)](_0x4584ff(0x1d1),_0x398ab6),loggerService_1[_0x4584ff(0x196)][_0x4584ff(0x19b)](_0x4584ff(0x189),_0x4584ff(0x1dc),_0x4584ff(0x1a3));throw new Error(_0x4584ff(0x1b2));}return console[_0x4584ff(0x1a1)](_0x4584ff(0x1b6)),console[_0x4584ff(0x1a1)](_0x4584ff(0x1eb),_0x398ab6['id']),console[_0x4584ff(0x1a1)](_0x4584ff(0x176),_0x398ab6[_0x4584ff(0x194)][_0x4584ff(0x19f)]),console[_0x4584ff(0x1a1)](_0x4584ff(0x1a7),_0x398ab6['shortLinkUrls'][_0x4584ff(0x175)]||_0x4584ff(0x1df)),console[_0x4584ff(0x1a1)](_0x4584ff(0x1a2),_0x10eefe,_0x4584ff(0x1b9)),console[_0x4584ff(0x1a1)](_0x4584ff(0x1c3),_0x5a9335),{'gateway_payment_id':_0x398ab6['id'],'payment_url':_0x398ab6[_0x4584ff(0x194)][_0x4584ff(0x19f)],'qr_code_url':_0x398ab6[_0x4584ff(0x194)][_0x4584ff(0x175)],'expiry_date':_0x398ab6[_0x4584ff(0x1b8)]};}catch(_0x54bb4b){console[_0x4584ff(0x1ee)](_0x4584ff(0x1e1)),console[_0x4584ff(0x1ee)](_0x4584ff(0x1ad),_0x54bb4b),loggerService_1[_0x4584ff(0x196)][_0x4584ff(0x19b)](_0x4584ff(0x189),_0x4584ff(0x1dc),_0x54bb4b);if(_0x54bb4b instanceof Error){console[_0x4584ff(0x1ee)](_0x4584ff(0x179),_0x54bb4b['message']),console[_0x4584ff(0x1ee)]('Error\x20stack:',_0x54bb4b[_0x4584ff(0x1e4)]);throw new Error(_0x4584ff(0x1a6)+_0x54bb4b[_0x4584ff(0x17d)]);}throw new Error(_0x4584ff(0x1f0));}}async[a44_0x62b5db(0x1e9)](_0x48de25){const _0x174191=a44_0x62b5db,_0x1cbac4=Date['now']();try{loggerService_1['loggerService'][_0x174191(0x1ae)]('noda',_0x174191(0x1bd)+_0x48de25,'GET',{});const _0x1c750b=await fetch(this['apiUrl']+'/'+_0x48de25,{'method':_0x174191(0x192),'headers':{'Content-Type':'application/json','User-Agent':_0x174191(0x1e8)}}),_0x36ac88=Date[_0x174191(0x1d0)]()-_0x1cbac4;if(!_0x1c750b['ok']){const _0x58fda5=await _0x1c750b[_0x174191(0x191)]();loggerService_1[_0x174191(0x196)][_0x174191(0x1c8)](_0x174191(0x189),_0x174191(0x1bd)+_0x48de25,_0x1c750b[_0x174191(0x180)],_0x58fda5,_0x36ac88);throw new Error(_0x174191(0x1cc)+_0x1c750b[_0x174191(0x180)]);}const _0x533a7b=await _0x1c750b[_0x174191(0x19e)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x174191(0x189),_0x174191(0x1bd)+_0x48de25,_0x1c750b[_0x174191(0x180)],_0x533a7b,_0x36ac88);if(_0x533a7b['error']||_0x533a7b[_0x174191(0x1c6)]){loggerService_1['loggerService'][_0x174191(0x19b)]('noda',_0x174191(0x1bd)+_0x48de25,_0x174191(0x187)+(_0x533a7b[_0x174191(0x17d)]||_0x533a7b[_0x174191(0x1ee)]||'Unknown\x20error'));throw new Error(_0x174191(0x187)+(_0x533a7b[_0x174191(0x17d)]||_0x533a7b[_0x174191(0x1ee)]||_0x174191(0x1b3)));}let _0x4708c2='PENDING';if(_0x533a7b[_0x174191(0x19d)]===![]){if(_0x533a7b['expiryDate']){const _0x6e6d2f=new Date(_0x533a7b[_0x174191(0x1b8)]),_0x2efbeb=new Date();_0x6e6d2f<_0x2efbeb?_0x4708c2=_0x174191(0x19a):_0x4708c2=_0x174191(0x1ed);}else _0x4708c2='FAILED';}else _0x4708c2='PENDING';return{'status':_0x4708c2,'amount':_0x533a7b[_0x174191(0x1e2)],'currency':_0x533a7b[_0x174191(0x1b0)],'isActive':_0x533a7b[_0x174191(0x19d)]};}catch(_0x1e30ee){console[_0x174191(0x1ee)](_0x174191(0x1ec),_0x1e30ee),loggerService_1[_0x174191(0x196)][_0x174191(0x19b)](_0x174191(0x189),_0x174191(0x1bd)+_0x48de25,_0x1e30ee);throw new Error(_0x174191(0x1ac)+(_0x1e30ee instanceof Error?_0x1e30ee[_0x174191(0x17d)]:_0x174191(0x1b3)));}}async['processWebhook'](_0x4075ae){const _0x4380fc=a44_0x62b5db;console[_0x4380fc(0x1a1)](_0x4380fc(0x195),_0x4075ae);let _0x25a008=_0x4380fc(0x185);switch(_0x4075ae[_0x4380fc(0x1c5)]?.[_0x4380fc(0x1e6)]()){case _0x4380fc(0x18b):case _0x4380fc(0x1cd):case'paid':case _0x4380fc(0x1bb):case _0x4380fc(0x1a4):_0x4075ae['Settled']===_0x4380fc(0x1b5)?_0x25a008=_0x4380fc(0x1a0):_0x25a008=_0x4380fc(0x185);break;case _0x4380fc(0x1f1):case _0x4380fc(0x183):case _0x4380fc(0x1da):case'error':case'rejected':_0x25a008='FAILED';break;case _0x4380fc(0x18a):case _0x4380fc(0x19c):_0x25a008='EXPIRED';break;case _0x4380fc(0x184):case _0x4380fc(0x1d3):case'active':case _0x4380fc(0x1de):case _0x4380fc(0x1cf):default:_0x25a008='PENDING';break;}return{'paymentId':_0x4075ae['MerchantPaymentId']||_0x4075ae[_0x4380fc(0x182)],'status':_0x25a008,'amount':_0x4075ae[_0x4380fc(0x1b1)],'currency':_0x4075ae[_0x4380fc(0x1bf)],'additionalInfo':{'method':_0x4075ae[_0x4380fc(0x1d8)],'bankId':_0x4075ae[_0x4380fc(0x186)],'settled':_0x4075ae[_0x4380fc(0x17a)],'settlementDate':_0x4075ae['SettlementDate'],'remitterName':_0x4075ae[_0x4380fc(0x17c)]?.['Name'],'remitterIban':_0x4075ae[_0x4380fc(0x17c)]?.[_0x4380fc(0x1a8)],'bankTransactionId':_0x4075ae[_0x4380fc(0x1d5)]}};}['verifyWebhookSignature'](_0x1d96f4,_0x11a0d4){const _0x100ed8=a44_0x62b5db;return console[_0x100ed8(0x1a1)](_0x100ed8(0x198),{'receivedSignature':_0x11a0d4,'paymentId':_0x1d96f4[_0x100ed8(0x182)],'merchantPaymentId':_0x1d96f4[_0x100ed8(0x190)]}),!![];}}function a44_0x5715(_0x5361db,_0xc93635){const _0x27e478=a44_0x27e4();return a44_0x5715=function(_0x571582,_0xc4dcf3){_0x571582=_0x571582-0x175;let _0x531efc=_0x27e478[_0x571582];return _0x531efc;},a44_0x5715(_0x5361db,_0xc93635);}exports[a44_0x62b5db(0x1b7)]=NodaService;