'use strict';const a43_0x29659d=a43_0x6c22;(function(_0x312c95,_0x422556){const _0x7e2b91=a43_0x6c22,_0x253d81=_0x312c95();while(!![]){try{const _0x3dea5d=-parseInt(_0x7e2b91(0xc3))/0x1+parseInt(_0x7e2b91(0xc0))/0x2+-parseInt(_0x7e2b91(0xd1))/0x3*(parseInt(_0x7e2b91(0x89))/0x4)+-parseInt(_0x7e2b91(0x87))/0x5+parseInt(_0x7e2b91(0xe3))/0x6+parseInt(_0x7e2b91(0x78))/0x7+-parseInt(_0x7e2b91(0xd8))/0x8;if(_0x3dea5d===_0x422556)break;else _0x253d81['push'](_0x253d81['shift']());}catch(_0x39ad5f){_0x253d81['push'](_0x253d81['shift']());}}}(a43_0x3de7,0x9e3dc));function a43_0x6c22(_0xc1d4ba,_0xe1ade6){const _0x3de786=a43_0x3de7();return a43_0x6c22=function(_0x6c22b6,_0x51a9ff){_0x6c22b6=_0x6c22b6-0x6f;let _0x5ea4eb=_0x3de786[_0x6c22b6];return _0x5ea4eb;},a43_0x6c22(_0xc1d4ba,_0xe1ade6);}Object['defineProperty'](exports,a43_0x29659d(0x83),{'value':!![]}),exports[a43_0x29659d(0xe4)]=void 0x0;const loggerService_1=require(a43_0x29659d(0x8b));function a43_0x3de7(){const _0x30b04c=['‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','log','in_progress','6881988Vjmmvc','NodaService','HTTP\x20Status:','Status\x20Text:','success','Failed\x20to\x20verify\x20Noda\x20payment:\x20','shortLinkUrls','Order\x20ID\x20Format:','created','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','FAILED','successful','Status','stringify','3377829iMjrms','cancelled','Iban','loggerService','statusCode','Error\x20Message:','logWhiteDomainRequest','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','failed','(8digits-8digits\x20format)','amount','__esModule','BankId','SettlementDate','status','2660585pFAvia','===\x20PARSED\x20NODA\x20RESPONSE\x20===','18364friiwe','/payment-links/','../loggerService','Response\x20Time:','Name','toLowerCase','fromEntries','active','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','PAID','/payment-links','HTTP\x20error!\x20status:\x20','paid','Noda\x20API\x20error:\x20','MerchantPaymentId','text','POST','timeout','message','===\x20NODA\x20SERVICE\x20ERROR\x20===','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','URL:','Order\x20ID\x20Used:','Error\x20stack:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','stack','Raw\x20Response\x20Body:','error','Noda\x20payment\x20verification\x20error:','done','now','completed','===\x20NODA\x20API\x20ERROR\x20===','headers','application/json','processing','https://tesoft.uk/gateway/noda/webhook/','TesSoft\x20Payment\x20System/1.0','===\x20NODA\x20SUCCESS\x20===','Error\x20details:','apiUrl','expiryDate','rejected','Settled','Short\x20Link:','json','Not\x20provided','EXPIRED','Error\x20message:','Unknown\x20error','pending','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Currency','entries','createPaymentLink','2527432cYAKeu','BankTransactionId','logWhiteDomainError','348039tiDxgg','Noda\x20webhook\x20signature\x20verification:','Remitter','Response\x20data:','toUpperCase','processWebhook','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Method','Business\x20Error:\x20','QR\x20Code\x20Link:','expired','isActive','noda','Failed\x20to\x20parse\x20JSON\x20response:','216PdGeAt','Parsed\x20Result:','qrCodeLink','verifyWebhookSignature','verifyPayment',',\x20body:\x20','PaymentId','8275176HeJjhl','GET','logWhiteDomainResponse','Processing\x20Noda\x20webhook:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PENDING','parse','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error'];a43_0x3de7=function(){return _0x30b04c;};return a43_0x3de7();}class NodaService{constructor(){const _0x1f2cb1=a43_0x29659d;this[_0x1f2cb1(0xb1)]='https://tesoft.uk/gateway/noda/',console[_0x1f2cb1(0xe1)](_0x1f2cb1(0x9d));}async[a43_0x29659d(0xbf)](_0x2dd92f){const _0x2336e7=a43_0x29659d,{orderId:_0x5716d0,name:_0x549e74,paymentDescription:_0xb9e944,amount:_0x285f4e,currency:_0x3e57e5,webhookUrl:_0x53c61f,returnUrl:_0x50e636,expiryDate:_0x27f73a}=_0x2dd92f,_0xe4bd3=_0x3e57e5[_0x2336e7(0xc7)](),_0x76012d=_0x2336e7(0xad),_0x69e103='https://tesoft.uk/gateway/pending.php?id='+_0x5716d0,_0x17a0a9={'name':_0x549e74,'paymentDescription':_0xb9e944,'amount':_0x285f4e,'currency':_0xe4bd3,'paymentId':_0x5716d0,'webhookUrl':_0x76012d,'returnUrl':_0x69e103};_0x27f73a&&(_0x17a0a9[_0x2336e7(0xb2)]=_0x27f73a);const _0x843662=Date[_0x2336e7(0xa7)]();try{console[_0x2336e7(0xe1)](_0x2336e7(0x91)),console[_0x2336e7(0xe1)](_0x2336e7(0x9e),this[_0x2336e7(0xb1)]),console[_0x2336e7(0xe1)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x2336e7(0x77)](_0x17a0a9,null,0x2)),console[_0x2336e7(0xe1)](_0x2336e7(0x71),_0x5716d0,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x2336e7(0xe1)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x69e103),loggerService_1['loggerService'][_0x2336e7(0x7e)](_0x2336e7(0xcf),_0x2336e7(0x93),_0x2336e7(0x99),_0x17a0a9);const _0x35ea10=await fetch(this[_0x2336e7(0xb1)],{'method':_0x2336e7(0x99),'headers':{'Content-Type':_0x2336e7(0xab),'Accept':_0x2336e7(0xab),'User-Agent':_0x2336e7(0xae)},'body':JSON[_0x2336e7(0x77)](_0x17a0a9)}),_0x1e5848=Date[_0x2336e7(0xa7)]()-_0x843662;console[_0x2336e7(0xe1)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x2336e7(0xe1)]('Status:',_0x35ea10['status']),console[_0x2336e7(0xe1)](_0x2336e7(0xe6),_0x35ea10['statusText']),console['log']('Headers:',Object[_0x2336e7(0x8f)](_0x35ea10[_0x2336e7(0xaa)][_0x2336e7(0xbe)]())),console[_0x2336e7(0xe1)](_0x2336e7(0x8c),_0x1e5848+'ms');const _0x503054=await _0x35ea10[_0x2336e7(0x98)]();console[_0x2336e7(0xe1)](_0x2336e7(0xa3),_0x503054);if(!_0x35ea10['ok']){console['error'](_0x2336e7(0xa9)),console[_0x2336e7(0xa4)](_0x2336e7(0xe5),_0x35ea10['status']),console[_0x2336e7(0xa4)]('Response\x20Body:',_0x503054),loggerService_1[_0x2336e7(0x7b)][_0x2336e7(0xda)](_0x2336e7(0xcf),_0x2336e7(0x93),_0x35ea10[_0x2336e7(0x86)],_0x503054,_0x1e5848),loggerService_1[_0x2336e7(0x7b)][_0x2336e7(0xc2)](_0x2336e7(0xcf),_0x2336e7(0x93),'HTTP\x20'+_0x35ea10[_0x2336e7(0x86)]+':\x20'+_0x503054);if(_0x35ea10[_0x2336e7(0x86)]===0x190)throw new Error(_0x2336e7(0x73));else{if(_0x35ea10[_0x2336e7(0x86)]===0x1f4)throw new Error(_0x2336e7(0xc9));}throw new Error(_0x2336e7(0x94)+_0x35ea10[_0x2336e7(0x86)]+_0x2336e7(0xd6)+_0x503054);}let _0x115c37;try{_0x115c37=JSON[_0x2336e7(0xde)](_0x503054);}catch(_0x2ea39e){console[_0x2336e7(0xa4)](_0x2336e7(0xd0),_0x2ea39e),loggerService_1[_0x2336e7(0x7b)][_0x2336e7(0xc2)](_0x2336e7(0xcf),_0x2336e7(0x93),'JSON\x20Parse\x20Error:\x20'+_0x2ea39e);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x503054);}console['log'](_0x2336e7(0x88)),console[_0x2336e7(0xe1)](_0x2336e7(0xd2),JSON['stringify'](_0x115c37,null,0x2)),loggerService_1['loggerService'][_0x2336e7(0xda)]('noda',_0x2336e7(0x93),_0x35ea10['status'],_0x115c37,_0x1e5848);if(_0x115c37[_0x2336e7(0xa4)]||_0x115c37[_0x2336e7(0x7c)]){const _0x126e29=_0x115c37[_0x2336e7(0x9b)]||_0x115c37['error']||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x2336e7(0xa4)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x2336e7(0x7d),_0x126e29),console['error']('Status\x20Code:',_0x115c37[_0x2336e7(0x7c)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x2336e7(0xcf),_0x2336e7(0x93),_0x2336e7(0xcb)+_0x126e29);throw new Error('Noda\x20API\x20error:\x20'+_0x126e29);}if(!_0x115c37['id']||!_0x115c37[_0x2336e7(0x70)]?.['shortLink']){console[_0x2336e7(0xa4)](_0x2336e7(0xdc)),console[_0x2336e7(0xa4)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console['error'](_0x2336e7(0xc6),_0x115c37),loggerService_1[_0x2336e7(0x7b)]['logWhiteDomainError'](_0x2336e7(0xcf),'/payment-links',_0x2336e7(0x7f));throw new Error(_0x2336e7(0xa1));}return console[_0x2336e7(0xe1)](_0x2336e7(0xaf)),console[_0x2336e7(0xe1)]('Payment\x20Link\x20ID:',_0x115c37['id']),console[_0x2336e7(0xe1)](_0x2336e7(0xb5),_0x115c37[_0x2336e7(0x70)]['shortLink']),console['log'](_0x2336e7(0xcc),_0x115c37[_0x2336e7(0x70)][_0x2336e7(0xd3)]||_0x2336e7(0xb7)),console[_0x2336e7(0xe1)](_0x2336e7(0x9f),_0x5716d0,_0x2336e7(0x81)),console[_0x2336e7(0xe1)](_0x2336e7(0xe0),_0x69e103),{'gateway_payment_id':_0x115c37['id'],'payment_url':_0x115c37[_0x2336e7(0x70)]['shortLink'],'qr_code_url':_0x115c37[_0x2336e7(0x70)][_0x2336e7(0xd3)],'expiry_date':_0x115c37['expiryDate']};}catch(_0x3f5791){console[_0x2336e7(0xa4)](_0x2336e7(0x9c)),console[_0x2336e7(0xa4)](_0x2336e7(0xb0),_0x3f5791),loggerService_1[_0x2336e7(0x7b)][_0x2336e7(0xc2)](_0x2336e7(0xcf),'/payment-links',_0x3f5791);if(_0x3f5791 instanceof Error){console[_0x2336e7(0xa4)](_0x2336e7(0xb9),_0x3f5791[_0x2336e7(0x9b)]),console[_0x2336e7(0xa4)](_0x2336e7(0xa0),_0x3f5791[_0x2336e7(0xa2)]);throw new Error(_0x2336e7(0xbc)+_0x3f5791[_0x2336e7(0x9b)]);}throw new Error(_0x2336e7(0xdf));}}async[a43_0x29659d(0xd5)](_0x1fb884){const _0x22319a=a43_0x29659d,_0x257b34=Date[_0x22319a(0xa7)]();try{loggerService_1[_0x22319a(0x7b)][_0x22319a(0x7e)](_0x22319a(0xcf),_0x22319a(0x8a)+_0x1fb884,_0x22319a(0xd9),{});const _0x32af0c=await fetch(this[_0x22319a(0xb1)]+'/'+_0x1fb884,{'method':_0x22319a(0xd9),'headers':{'Content-Type':_0x22319a(0xab),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x4a2482=Date['now']()-_0x257b34;if(!_0x32af0c['ok']){const _0x44b1bc=await _0x32af0c[_0x22319a(0x98)]();loggerService_1[_0x22319a(0x7b)]['logWhiteDomainResponse'](_0x22319a(0xcf),'/payment-links/'+_0x1fb884,_0x32af0c[_0x22319a(0x86)],_0x44b1bc,_0x4a2482);throw new Error(_0x22319a(0x94)+_0x32af0c['status']);}const _0x3f4d3b=await _0x32af0c[_0x22319a(0xb6)]();loggerService_1['loggerService'][_0x22319a(0xda)](_0x22319a(0xcf),_0x22319a(0x8a)+_0x1fb884,_0x32af0c[_0x22319a(0x86)],_0x3f4d3b,_0x4a2482);if(_0x3f4d3b[_0x22319a(0xa4)]||_0x3f4d3b[_0x22319a(0x7c)]){loggerService_1[_0x22319a(0x7b)][_0x22319a(0xc2)](_0x22319a(0xcf),'/payment-links/'+_0x1fb884,_0x22319a(0x96)+(_0x3f4d3b[_0x22319a(0x9b)]||_0x3f4d3b[_0x22319a(0xa4)]||_0x22319a(0xba)));throw new Error('Noda\x20API\x20error:\x20'+(_0x3f4d3b[_0x22319a(0x9b)]||_0x3f4d3b[_0x22319a(0xa4)]||_0x22319a(0xba)));}let _0x21bf1e=_0x22319a(0xdd);if(_0x3f4d3b[_0x22319a(0xce)]===![]){if(_0x3f4d3b[_0x22319a(0xb2)]){const _0xb9eae4=new Date(_0x3f4d3b[_0x22319a(0xb2)]),_0x1b3b60=new Date();_0xb9eae4<_0x1b3b60?_0x21bf1e=_0x22319a(0xb8):_0x21bf1e=_0x22319a(0x74);}else _0x21bf1e='FAILED';}else _0x21bf1e=_0x22319a(0xdd);return{'status':_0x21bf1e,'amount':_0x3f4d3b[_0x22319a(0x82)],'currency':_0x3f4d3b['currency'],'isActive':_0x3f4d3b[_0x22319a(0xce)]};}catch(_0xc70979){console[_0x22319a(0xa4)](_0x22319a(0xa5),_0xc70979),loggerService_1[_0x22319a(0x7b)][_0x22319a(0xc2)](_0x22319a(0xcf),_0x22319a(0x8a)+_0x1fb884,_0xc70979);throw new Error(_0x22319a(0x6f)+(_0xc70979 instanceof Error?_0xc70979[_0x22319a(0x9b)]:_0x22319a(0xba)));}}async[a43_0x29659d(0xc8)](_0x3b87fe){const _0x573187=a43_0x29659d;console[_0x573187(0xe1)](_0x573187(0xdb),_0x3b87fe);let _0x2ab3e0=_0x573187(0xdd);switch(_0x3b87fe[_0x573187(0x76)]?.[_0x573187(0x8e)]()){case _0x573187(0xa6):case _0x573187(0xa8):case _0x573187(0x95):case _0x573187(0xe7):case _0x573187(0x75):_0x3b87fe[_0x573187(0xb4)]==='Yes'?_0x2ab3e0=_0x573187(0x92):_0x2ab3e0=_0x573187(0xdd);break;case _0x573187(0x79):case'canceled':case _0x573187(0x80):case'error':case _0x573187(0xb3):_0x2ab3e0=_0x573187(0x74);break;case _0x573187(0xcd):case _0x573187(0x9a):_0x2ab3e0=_0x573187(0xb8);break;case _0x573187(0xbb):case _0x573187(0x72):case _0x573187(0x90):case _0x573187(0xac):case _0x573187(0xe2):default:_0x2ab3e0='PENDING';break;}return{'paymentId':_0x3b87fe[_0x573187(0x97)]||_0x3b87fe[_0x573187(0xd7)],'status':_0x2ab3e0,'amount':_0x3b87fe['Amount'],'currency':_0x3b87fe[_0x573187(0xbd)],'additionalInfo':{'method':_0x3b87fe[_0x573187(0xca)],'bankId':_0x3b87fe[_0x573187(0x84)],'settled':_0x3b87fe[_0x573187(0xb4)],'settlementDate':_0x3b87fe[_0x573187(0x85)],'remitterName':_0x3b87fe[_0x573187(0xc5)]?.[_0x573187(0x8d)],'remitterIban':_0x3b87fe[_0x573187(0xc5)]?.[_0x573187(0x7a)],'bankTransactionId':_0x3b87fe[_0x573187(0xc1)]}};}[a43_0x29659d(0xd4)](_0x461747,_0xc53435){const _0x290f30=a43_0x29659d;return console[_0x290f30(0xe1)](_0x290f30(0xc4),{'receivedSignature':_0xc53435,'paymentId':_0x461747[_0x290f30(0xd7)],'merchantPaymentId':_0x461747[_0x290f30(0x97)]}),!![];}}exports['NodaService']=NodaService;