'use strict';function a40_0xb1d7(_0x41c4eb,_0x234f87){const _0x4b53d1=a40_0x4b53();return a40_0xb1d7=function(_0xb1d7ca,_0x1e9c05){_0xb1d7ca=_0xb1d7ca-0x114;let _0x40d8bf=_0x4b53d1[_0xb1d7ca];return _0x40d8bf;},a40_0xb1d7(_0x41c4eb,_0x234f87);}const a40_0x2cc611=a40_0xb1d7;(function(_0x5c5662,_0x711f56){const _0x329ebe=a40_0xb1d7,_0x165d80=_0x5c5662();while(!![]){try{const _0x2a0fe1=parseInt(_0x329ebe(0x161))/0x1*(-parseInt(_0x329ebe(0x125))/0x2)+parseInt(_0x329ebe(0x13b))/0x3*(-parseInt(_0x329ebe(0x158))/0x4)+-parseInt(_0x329ebe(0x138))/0x5+parseInt(_0x329ebe(0x115))/0x6*(-parseInt(_0x329ebe(0x181))/0x7)+-parseInt(_0x329ebe(0x129))/0x8+-parseInt(_0x329ebe(0x12e))/0x9+parseInt(_0x329ebe(0x11b))/0xa;if(_0x2a0fe1===_0x711f56)break;else _0x165d80['push'](_0x165d80['shift']());}catch(_0x41897e){_0x165d80['push'](_0x165d80['shift']());}}}(a40_0x4b53,0xdcd3f));Object['defineProperty'](exports,a40_0x2cc611(0x154),{'value':!![]}),exports[a40_0x2cc611(0x175)]=void 0x0;const loggerService_1=require(a40_0x2cc611(0x188));class NodaService{constructor(){const _0x18b4cf=a40_0x2cc611;this['apiUrl']=_0x18b4cf(0x16a),console[_0x18b4cf(0x182)](_0x18b4cf(0x148));}async[a40_0x2cc611(0x123)](_0x5caaa7){const _0x3da98e=a40_0x2cc611,{orderId:_0x1cbfc3,name:_0x20ff04,paymentDescription:_0x19c364,amount:_0x36fa65,currency:_0x35ce77,webhookUrl:_0x69a57b,returnUrl:_0x1432fa,expiryDate:_0x4b3c4d}=_0x5caaa7,_0x4f74fc=_0x35ce77[_0x3da98e(0x159)](),_0x205550=_0x3da98e(0x13e),_0x3b1ced='https://tesoft.uk/gateway/success.php?id='+_0x1cbfc3,_0x5b88e4={'name':_0x20ff04,'paymentDescription':_0x19c364,'amount':_0x36fa65,'currency':_0x4f74fc,'paymentId':_0x1cbfc3,'webhookUrl':_0x205550,'returnUrl':_0x3b1ced};_0x4b3c4d&&(_0x5b88e4['expiryDate']=_0x4b3c4d);const _0x5606ec=Date[_0x3da98e(0x133)]();try{console[_0x3da98e(0x182)](_0x3da98e(0x14a)),console[_0x3da98e(0x182)](_0x3da98e(0x16e),this[_0x3da98e(0x18f)]),console[_0x3da98e(0x182)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x3da98e(0x17a)](_0x5b88e4,null,0x2)),console[_0x3da98e(0x182)]('Order\x20ID\x20Format:',_0x1cbfc3,_0x3da98e(0x12a)),loggerService_1['loggerService'][_0x3da98e(0x11f)](_0x3da98e(0x160),_0x3da98e(0x17f),_0x3da98e(0x17e),_0x5b88e4);const _0x437ef6=await fetch(this[_0x3da98e(0x18f)],{'method':_0x3da98e(0x17e),'headers':{'Content-Type':_0x3da98e(0x156),'Accept':_0x3da98e(0x156),'User-Agent':_0x3da98e(0x168)},'body':JSON[_0x3da98e(0x17a)](_0x5b88e4)}),_0x2f8e15=Date[_0x3da98e(0x133)]()-_0x5606ec;console[_0x3da98e(0x182)](_0x3da98e(0x114)),console[_0x3da98e(0x182)](_0x3da98e(0x13c),_0x437ef6['status']),console[_0x3da98e(0x182)](_0x3da98e(0x12d),_0x437ef6[_0x3da98e(0x11d)]),console[_0x3da98e(0x182)](_0x3da98e(0x14e),Object[_0x3da98e(0x12f)](_0x437ef6[_0x3da98e(0x142)][_0x3da98e(0x17c)]())),console[_0x3da98e(0x182)]('Response\x20Time:',_0x2f8e15+'ms');const _0x388288=await _0x437ef6['text']();console[_0x3da98e(0x182)](_0x3da98e(0x15a),_0x388288);if(!_0x437ef6['ok']){console['error'](_0x3da98e(0x17d)),console[_0x3da98e(0x173)]('HTTP\x20Status:',_0x437ef6[_0x3da98e(0x136)]),console[_0x3da98e(0x173)]('Response\x20Body:',_0x388288),loggerService_1[_0x3da98e(0x140)][_0x3da98e(0x178)](_0x3da98e(0x160),_0x3da98e(0x17f),_0x437ef6[_0x3da98e(0x136)],_0x388288,_0x2f8e15),loggerService_1[_0x3da98e(0x140)][_0x3da98e(0x163)]('noda',_0x3da98e(0x17f),_0x3da98e(0x124)+_0x437ef6[_0x3da98e(0x136)]+':\x20'+_0x388288);if(_0x437ef6[_0x3da98e(0x136)]===0x190)throw new Error(_0x3da98e(0x147));else{if(_0x437ef6[_0x3da98e(0x136)]===0x1f4)throw new Error(_0x3da98e(0x167));}throw new Error(_0x3da98e(0x186)+_0x437ef6[_0x3da98e(0x136)]+_0x3da98e(0x155)+_0x388288);}let _0x56a7f2;try{_0x56a7f2=JSON[_0x3da98e(0x18d)](_0x388288);}catch(_0x5b6536){console[_0x3da98e(0x173)](_0x3da98e(0x12b),_0x5b6536),loggerService_1[_0x3da98e(0x140)][_0x3da98e(0x163)]('noda',_0x3da98e(0x17f),_0x3da98e(0x14f)+_0x5b6536);throw new Error(_0x3da98e(0x130)+_0x388288);}console[_0x3da98e(0x182)](_0x3da98e(0x15d)),console[_0x3da98e(0x182)](_0x3da98e(0x14b),JSON[_0x3da98e(0x17a)](_0x56a7f2,null,0x2)),loggerService_1[_0x3da98e(0x140)][_0x3da98e(0x178)](_0x3da98e(0x160),_0x3da98e(0x17f),_0x437ef6[_0x3da98e(0x136)],_0x56a7f2,_0x2f8e15);if(_0x56a7f2['error']||_0x56a7f2[_0x3da98e(0x122)]){const _0x111508=_0x56a7f2[_0x3da98e(0x189)]||_0x56a7f2['error']||_0x3da98e(0x15e);console[_0x3da98e(0x173)](_0x3da98e(0x16c)),console['error'](_0x3da98e(0x121),_0x111508),console['error'](_0x3da98e(0x14d),_0x56a7f2[_0x3da98e(0x122)]),loggerService_1[_0x3da98e(0x140)][_0x3da98e(0x163)]('noda',_0x3da98e(0x17f),_0x3da98e(0x190)+_0x111508);throw new Error(_0x3da98e(0x141)+_0x111508);}if(!_0x56a7f2['id']||!_0x56a7f2[_0x3da98e(0x126)]?.[_0x3da98e(0x183)]){console[_0x3da98e(0x173)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x3da98e(0x119)),console['error']('Response\x20data:',_0x56a7f2),loggerService_1[_0x3da98e(0x140)][_0x3da98e(0x163)]('noda',_0x3da98e(0x17f),_0x3da98e(0x151));throw new Error(_0x3da98e(0x13a));}return console[_0x3da98e(0x182)](_0x3da98e(0x11e)),console[_0x3da98e(0x182)](_0x3da98e(0x13d),_0x56a7f2['id']),console['log'](_0x3da98e(0x11c),_0x56a7f2[_0x3da98e(0x126)][_0x3da98e(0x183)]),console[_0x3da98e(0x182)](_0x3da98e(0x143),_0x56a7f2[_0x3da98e(0x126)][_0x3da98e(0x131)]||'Not\x20provided'),console[_0x3da98e(0x182)](_0x3da98e(0x157),_0x1cbfc3,'(8digits-8digits\x20format)'),{'gateway_payment_id':_0x56a7f2['id'],'payment_url':_0x56a7f2['shortLinkUrls'][_0x3da98e(0x183)],'qr_code_url':_0x56a7f2[_0x3da98e(0x126)][_0x3da98e(0x131)],'expiry_date':_0x56a7f2[_0x3da98e(0x169)]};}catch(_0x389b96){console['error'](_0x3da98e(0x118)),console[_0x3da98e(0x173)](_0x3da98e(0x146),_0x389b96),loggerService_1[_0x3da98e(0x140)][_0x3da98e(0x163)](_0x3da98e(0x160),_0x3da98e(0x17f),_0x389b96);if(_0x389b96 instanceof Error){console[_0x3da98e(0x173)](_0x3da98e(0x153),_0x389b96['message']),console[_0x3da98e(0x173)]('Error\x20stack:',_0x389b96['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x389b96[_0x3da98e(0x189)]);}throw new Error(_0x3da98e(0x144));}}async[a40_0x2cc611(0x150)](_0x5ae48a){const _0x1cc25f=a40_0x2cc611,_0xb105b3=Date['now']();try{loggerService_1[_0x1cc25f(0x140)]['logWhiteDomainRequest'](_0x1cc25f(0x160),_0x1cc25f(0x16f)+_0x5ae48a,_0x1cc25f(0x15c),{});const _0x9072e6=await fetch(this[_0x1cc25f(0x18f)]+'/'+_0x5ae48a,{'method':_0x1cc25f(0x15c),'headers':{'Content-Type':_0x1cc25f(0x156),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x2cda1b=Date['now']()-_0xb105b3;if(!_0x9072e6['ok']){const _0x290c40=await _0x9072e6[_0x1cc25f(0x11a)]();loggerService_1[_0x1cc25f(0x140)][_0x1cc25f(0x178)](_0x1cc25f(0x160),_0x1cc25f(0x16f)+_0x5ae48a,_0x9072e6[_0x1cc25f(0x136)],_0x290c40,_0x2cda1b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x9072e6['status']);}const _0x2d3155=await _0x9072e6[_0x1cc25f(0x164)]();loggerService_1['loggerService'][_0x1cc25f(0x178)](_0x1cc25f(0x160),_0x1cc25f(0x16f)+_0x5ae48a,_0x9072e6['status'],_0x2d3155,_0x2cda1b);if(_0x2d3155[_0x1cc25f(0x173)]||_0x2d3155[_0x1cc25f(0x122)]){loggerService_1[_0x1cc25f(0x140)]['logWhiteDomainError'](_0x1cc25f(0x160),_0x1cc25f(0x16f)+_0x5ae48a,_0x1cc25f(0x141)+(_0x2d3155[_0x1cc25f(0x189)]||_0x2d3155[_0x1cc25f(0x173)]||_0x1cc25f(0x18a)));throw new Error('Noda\x20API\x20error:\x20'+(_0x2d3155[_0x1cc25f(0x189)]||_0x2d3155['error']||'Unknown\x20error'));}let _0x10dbec=_0x1cc25f(0x171);if(_0x2d3155['isActive']===![]){if(_0x2d3155[_0x1cc25f(0x169)]){const _0x2ada4a=new Date(_0x2d3155[_0x1cc25f(0x169)]),_0x407678=new Date();_0x2ada4a<_0x407678?_0x10dbec=_0x1cc25f(0x127):_0x10dbec=_0x1cc25f(0x149);}else _0x10dbec=_0x1cc25f(0x149);}else _0x10dbec=_0x1cc25f(0x171);return{'status':_0x10dbec,'amount':_0x2d3155[_0x1cc25f(0x152)],'currency':_0x2d3155[_0x1cc25f(0x17b)],'isActive':_0x2d3155[_0x1cc25f(0x191)]};}catch(_0x158f2f){console[_0x1cc25f(0x173)]('Noda\x20payment\x20verification\x20error:',_0x158f2f),loggerService_1[_0x1cc25f(0x140)][_0x1cc25f(0x163)](_0x1cc25f(0x160),_0x1cc25f(0x16f)+_0x5ae48a,_0x158f2f);throw new Error(_0x1cc25f(0x139)+(_0x158f2f instanceof Error?_0x158f2f[_0x1cc25f(0x189)]:_0x1cc25f(0x18a)));}}async[a40_0x2cc611(0x176)](_0x4e03ab){const _0x20e509=a40_0x2cc611;console[_0x20e509(0x182)]('Processing\x20Noda\x20webhook:',_0x4e03ab);let _0x3e45f0=_0x20e509(0x171);switch(_0x4e03ab['Status']?.[_0x20e509(0x174)]()){case'done':case _0x20e509(0x16b):case _0x20e509(0x120):case _0x20e509(0x137):case _0x20e509(0x177):_0x4e03ab[_0x20e509(0x116)]===_0x20e509(0x16d)?_0x3e45f0=_0x20e509(0x172):_0x3e45f0=_0x20e509(0x171);break;case _0x20e509(0x12c):case _0x20e509(0x165):case _0x20e509(0x187):case _0x20e509(0x173):case _0x20e509(0x128):_0x3e45f0=_0x20e509(0x149);break;case _0x20e509(0x18c):case _0x20e509(0x134):_0x3e45f0=_0x20e509(0x127);break;case _0x20e509(0x14c):case _0x20e509(0x179):case _0x20e509(0x145):case _0x20e509(0x180):case _0x20e509(0x18b):default:_0x3e45f0=_0x20e509(0x171);break;}return{'paymentId':_0x4e03ab['MerchantPaymentId']||_0x4e03ab[_0x20e509(0x15f)],'status':_0x3e45f0,'amount':_0x4e03ab[_0x20e509(0x15b)],'currency':_0x4e03ab[_0x20e509(0x162)],'additionalInfo':{'method':_0x4e03ab[_0x20e509(0x166)],'bankId':_0x4e03ab[_0x20e509(0x185)],'settled':_0x4e03ab['Settled'],'settlementDate':_0x4e03ab['SettlementDate'],'remitterName':_0x4e03ab[_0x20e509(0x170)]?.[_0x20e509(0x184)],'remitterIban':_0x4e03ab['Remitter']?.[_0x20e509(0x132)],'bankTransactionId':_0x4e03ab[_0x20e509(0x117)]}};}[a40_0x2cc611(0x18e)](_0x4075c9,_0x57f9ad){const _0x25c3af=a40_0x2cc611;return console['log'](_0x25c3af(0x13f),{'receivedSignature':_0x57f9ad,'paymentId':_0x4075c9['PaymentId'],'merchantPaymentId':_0x4075c9[_0x25c3af(0x135)]}),!![];}}function a40_0x4b53(){const _0x37f0ba=['parse','verifyWebhookSignature','apiUrl','Business\x20Error:\x20','isActive','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','1817358NahdZS','Settled','BankTransactionId','===\x20NODA\x20SERVICE\x20ERROR\x20===','Missing\x20id\x20or\x20shortLink\x20in\x20response','text','59959710MzqnbA','Short\x20Link:','statusText','===\x20NODA\x20SUCCESS\x20===','logWhiteDomainRequest','paid','Error\x20Message:','statusCode','createPaymentLink','HTTP\x20','285682OIyklp','shortLinkUrls','EXPIRED','rejected','13530832dPTmAE','(8digits-8digits\x20format\x20for\x20Noda)','Failed\x20to\x20parse\x20JSON\x20response:','cancelled','Status\x20Text:','1725147fkHznK','fromEntries','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','qrCodeLink','Iban','now','timeout','MerchantPaymentId','status','success','6729850LRNttr','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','5277FVFlSQ','Status:','Payment\x20Link\x20ID:','https://tesoft.uk/gateway/noda/webhook/','Noda\x20webhook\x20signature\x20verification:','loggerService','Noda\x20API\x20error:\x20','headers','QR\x20Code\x20Link:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','active','Error\x20details:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','FAILED','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Parsed\x20Result:','pending','Status\x20Code:','Headers:','JSON\x20Parse\x20Error:\x20','verifyPayment','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','amount','Error\x20message:','__esModule',',\x20body:\x20','application/json','Order\x20ID\x20Used:','2572RQFrzZ','toUpperCase','Raw\x20Response\x20Body:','Amount','GET','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Unknown\x20error\x20from\x20Noda\x20API','PaymentId','noda','3tDDnoM','Currency','logWhiteDomainError','json','canceled','Method','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','TesSoft\x20Payment\x20System/1.0','expiryDate','https://tesoft.uk/gateway/noda/','completed','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Yes','URL:','/payment-links/','Remitter','PENDING','PAID','error','toLowerCase','NodaService','processWebhook','successful','logWhiteDomainResponse','created','stringify','currency','entries','===\x20NODA\x20API\x20ERROR\x20===','POST','/payment-links','processing','7gifBYH','log','shortLink','Name','BankId','HTTP\x20error!\x20status:\x20','failed','../loggerService','message','Unknown\x20error','in_progress','expired'];a40_0x4b53=function(){return _0x37f0ba;};return a40_0x4b53();}exports[a40_0x2cc611(0x175)]=NodaService;