'use strict';const a40_0x1d88fe=a40_0x5491;(function(_0x416a7d,_0x16d2cf){const _0x4cddec=a40_0x5491,_0x3d2f97=_0x416a7d();while(!![]){try{const _0x4e208e=parseInt(_0x4cddec(0x106))/0x1+parseInt(_0x4cddec(0x134))/0x2*(parseInt(_0x4cddec(0x132))/0x3)+parseInt(_0x4cddec(0x10e))/0x4+parseInt(_0x4cddec(0x126))/0x5*(parseInt(_0x4cddec(0x140))/0x6)+parseInt(_0x4cddec(0x158))/0x7+parseInt(_0x4cddec(0x16c))/0x8+parseInt(_0x4cddec(0x119))/0x9*(-parseInt(_0x4cddec(0x14f))/0xa);if(_0x4e208e===_0x16d2cf)break;else _0x3d2f97['push'](_0x3d2f97['shift']());}catch(_0x134354){_0x3d2f97['push'](_0x3d2f97['shift']());}}}(a40_0x403b,0xa3a48));Object['defineProperty'](exports,a40_0x1d88fe(0x127),{'value':!![]}),exports[a40_0x1d88fe(0x168)]=void 0x0;function a40_0x5491(_0x275275,_0x4a6d75){const _0x403b53=a40_0x403b();return a40_0x5491=function(_0x5491f6,_0x27bfc5){_0x5491f6=_0x5491f6-0x101;let _0x49fa02=_0x403b53[_0x5491f6];return _0x49fa02;},a40_0x5491(_0x275275,_0x4a6d75);}const loggerService_1=require(a40_0x1d88fe(0x15a));class NodaService{constructor(){const _0x8c5809=a40_0x1d88fe;this['apiUrl']=_0x8c5809(0x175),console[_0x8c5809(0x116)](_0x8c5809(0x176));}async[a40_0x1d88fe(0x12d)](_0x461328){const _0xc5d281=a40_0x1d88fe,{orderId:_0x218a4c,name:_0x31208b,paymentDescription:_0x11a3ef,amount:_0x159aa9,currency:_0x59f5cb,webhookUrl:_0x12a655,returnUrl:_0x16a231,expiryDate:_0x13f9b9}=_0x461328,_0x58abc9=_0x59f5cb[_0xc5d281(0x111)](),_0x364f16=_0xc5d281(0x163),_0x2d9eb8='https://tesoft.uk/gateway/success.php?id='+_0x218a4c,_0x58c361={'name':_0x31208b,'paymentDescription':_0x11a3ef,'amount':_0x159aa9,'currency':_0x58abc9,'paymentId':_0x218a4c,'webhookUrl':_0x364f16,'returnUrl':_0x2d9eb8};_0x13f9b9&&(_0x58c361[_0xc5d281(0x138)]=_0x13f9b9);const _0x49cca1=Date[_0xc5d281(0x101)]();try{console[_0xc5d281(0x116)](_0xc5d281(0x152)),console['log'](_0xc5d281(0x154),this[_0xc5d281(0x15c)]),console[_0xc5d281(0x116)](_0xc5d281(0x10b),JSON[_0xc5d281(0x142)](_0x58c361,null,0x2)),console[_0xc5d281(0x116)](_0xc5d281(0x13d),_0x218a4c,_0xc5d281(0x167)),loggerService_1[_0xc5d281(0x136)][_0xc5d281(0x16f)](_0xc5d281(0x113),'/payment-links',_0xc5d281(0x10f),_0x58c361);const _0x2dda39=await fetch(this['apiUrl'],{'method':_0xc5d281(0x10f),'headers':{'Content-Type':_0xc5d281(0x13c),'Accept':_0xc5d281(0x13c),'User-Agent':_0xc5d281(0x10d)},'body':JSON[_0xc5d281(0x142)](_0x58c361)}),_0x496457=Date[_0xc5d281(0x101)]()-_0x49cca1;console[_0xc5d281(0x116)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0xc5d281(0x116)](_0xc5d281(0x120),_0x2dda39[_0xc5d281(0x169)]),console[_0xc5d281(0x116)]('Status\x20Text:',_0x2dda39[_0xc5d281(0x172)]),console[_0xc5d281(0x116)]('Headers:',Object[_0xc5d281(0x12b)](_0x2dda39[_0xc5d281(0x16d)][_0xc5d281(0x159)]())),console[_0xc5d281(0x116)](_0xc5d281(0x105),_0x496457+'ms');const _0x594373=await _0x2dda39[_0xc5d281(0x150)]();console[_0xc5d281(0x116)]('Raw\x20Response\x20Body:',_0x594373);if(!_0x2dda39['ok']){console[_0xc5d281(0x14e)]('===\x20NODA\x20API\x20ERROR\x20==='),console['error'](_0xc5d281(0x108),_0x2dda39[_0xc5d281(0x169)]),console[_0xc5d281(0x14e)]('Response\x20Body:',_0x594373),loggerService_1[_0xc5d281(0x136)]['logWhiteDomainResponse'](_0xc5d281(0x113),'/payment-links',_0x2dda39['status'],_0x594373,_0x496457),loggerService_1['loggerService'][_0xc5d281(0x13f)](_0xc5d281(0x113),_0xc5d281(0x153),_0xc5d281(0x149)+_0x2dda39[_0xc5d281(0x169)]+':\x20'+_0x594373);if(_0x2dda39[_0xc5d281(0x169)]===0x190)throw new Error(_0xc5d281(0x14c));else{if(_0x2dda39[_0xc5d281(0x169)]===0x1f4)throw new Error(_0xc5d281(0x112));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x2dda39[_0xc5d281(0x169)]+_0xc5d281(0x12f)+_0x594373);}let _0x538869;try{_0x538869=JSON[_0xc5d281(0x124)](_0x594373);}catch(_0x47fb9e){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x47fb9e),loggerService_1[_0xc5d281(0x136)][_0xc5d281(0x13f)](_0xc5d281(0x113),_0xc5d281(0x153),_0xc5d281(0x160)+_0x47fb9e);throw new Error(_0xc5d281(0x16b)+_0x594373);}console[_0xc5d281(0x116)](_0xc5d281(0x102)),console['log'](_0xc5d281(0x118),JSON[_0xc5d281(0x142)](_0x538869,null,0x2)),loggerService_1[_0xc5d281(0x136)][_0xc5d281(0x165)](_0xc5d281(0x113),_0xc5d281(0x153),_0x2dda39[_0xc5d281(0x169)],_0x538869,_0x496457);if(_0x538869[_0xc5d281(0x14e)]||_0x538869[_0xc5d281(0x15f)]){const _0x3d0ef0=_0x538869[_0xc5d281(0x15d)]||_0x538869[_0xc5d281(0x14e)]||_0xc5d281(0x133);console[_0xc5d281(0x14e)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0xc5d281(0x110),_0x3d0ef0),console[_0xc5d281(0x14e)](_0xc5d281(0x173),_0x538869[_0xc5d281(0x15f)]),loggerService_1['loggerService'][_0xc5d281(0x13f)](_0xc5d281(0x113),_0xc5d281(0x153),_0xc5d281(0x13e)+_0x3d0ef0);throw new Error(_0xc5d281(0x143)+_0x3d0ef0);}if(!_0x538869['id']||!_0x538869[_0xc5d281(0x11d)]?.[_0xc5d281(0x14b)]){console[_0xc5d281(0x14e)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0xc5d281(0x14e)](_0xc5d281(0x10a)),console['error']('Response\x20data:',_0x538869),loggerService_1[_0xc5d281(0x136)][_0xc5d281(0x13f)](_0xc5d281(0x113),_0xc5d281(0x153),_0xc5d281(0x109));throw new Error(_0xc5d281(0x10c));}return console['log'](_0xc5d281(0x15e)),console[_0xc5d281(0x116)](_0xc5d281(0x129),_0x538869['id']),console[_0xc5d281(0x116)](_0xc5d281(0x131),_0x538869['shortLinkUrls'][_0xc5d281(0x14b)]),console[_0xc5d281(0x116)](_0xc5d281(0x13b),_0x538869['shortLinkUrls'][_0xc5d281(0x13a)]||_0xc5d281(0x117)),console[_0xc5d281(0x116)](_0xc5d281(0x137),_0x218a4c,_0xc5d281(0x170)),{'gateway_payment_id':_0x538869['id'],'payment_url':_0x538869[_0xc5d281(0x11d)]['shortLink'],'qr_code_url':_0x538869[_0xc5d281(0x11d)]['qrCodeLink'],'expiry_date':_0x538869['expiryDate']};}catch(_0xeebd6a){console['error'](_0xc5d281(0x16a)),console[_0xc5d281(0x14e)](_0xc5d281(0x128),_0xeebd6a),loggerService_1[_0xc5d281(0x136)][_0xc5d281(0x13f)](_0xc5d281(0x113),'/payment-links',_0xeebd6a);if(_0xeebd6a instanceof Error){console[_0xc5d281(0x14e)](_0xc5d281(0x174),_0xeebd6a[_0xc5d281(0x15d)]),console[_0xc5d281(0x14e)](_0xc5d281(0x171),_0xeebd6a['stack']);throw new Error(_0xc5d281(0x11b)+_0xeebd6a['message']);}throw new Error(_0xc5d281(0x12a));}}async[a40_0x1d88fe(0x135)](_0x3c9ee4){const _0x30bce9=a40_0x1d88fe,_0xc301eb=Date[_0x30bce9(0x101)]();try{loggerService_1['loggerService'][_0x30bce9(0x16f)](_0x30bce9(0x113),_0x30bce9(0x164)+_0x3c9ee4,'GET',{});const _0x5a42b2=await fetch(this['apiUrl']+'/'+_0x3c9ee4,{'method':_0x30bce9(0x121),'headers':{'Content-Type':_0x30bce9(0x13c),'User-Agent':_0x30bce9(0x10d)}}),_0x26a77d=Date['now']()-_0xc301eb;if(!_0x5a42b2['ok']){const _0x1be98b=await _0x5a42b2[_0x30bce9(0x150)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x30bce9(0x113),_0x30bce9(0x164)+_0x3c9ee4,_0x5a42b2['status'],_0x1be98b,_0x26a77d);throw new Error(_0x30bce9(0x12e)+_0x5a42b2[_0x30bce9(0x169)]);}const _0x3149c1=await _0x5a42b2[_0x30bce9(0x14a)]();loggerService_1[_0x30bce9(0x136)]['logWhiteDomainResponse'](_0x30bce9(0x113),_0x30bce9(0x164)+_0x3c9ee4,_0x5a42b2['status'],_0x3149c1,_0x26a77d);if(_0x3149c1[_0x30bce9(0x14e)]||_0x3149c1['statusCode']){loggerService_1[_0x30bce9(0x136)]['logWhiteDomainError'](_0x30bce9(0x113),'/payment-links/'+_0x3c9ee4,'Noda\x20API\x20error:\x20'+(_0x3149c1['message']||_0x3149c1[_0x30bce9(0x14e)]||_0x30bce9(0x162)));throw new Error(_0x30bce9(0x143)+(_0x3149c1[_0x30bce9(0x15d)]||_0x3149c1[_0x30bce9(0x14e)]||_0x30bce9(0x162)));}let _0x565082=_0x30bce9(0x16e);if(_0x3149c1[_0x30bce9(0x103)]===![]){if(_0x3149c1[_0x30bce9(0x138)]){const _0x245b73=new Date(_0x3149c1[_0x30bce9(0x138)]),_0x530cc8=new Date();_0x245b73<_0x530cc8?_0x565082=_0x30bce9(0x156):_0x565082=_0x30bce9(0x155);}else _0x565082=_0x30bce9(0x155);}else _0x565082=_0x30bce9(0x16e);return{'status':_0x565082,'amount':_0x3149c1['amount'],'currency':_0x3149c1[_0x30bce9(0x107)],'isActive':_0x3149c1[_0x30bce9(0x103)]};}catch(_0x295bfd){console[_0x30bce9(0x14e)](_0x30bce9(0x114),_0x295bfd),loggerService_1[_0x30bce9(0x136)]['logWhiteDomainError'](_0x30bce9(0x113),_0x30bce9(0x164)+_0x3c9ee4,_0x295bfd);throw new Error(_0x30bce9(0x123)+(_0x295bfd instanceof Error?_0x295bfd[_0x30bce9(0x15d)]:_0x30bce9(0x162)));}}async[a40_0x1d88fe(0x115)](_0x922f60){const _0x2407f7=a40_0x1d88fe;console[_0x2407f7(0x116)](_0x2407f7(0x130),_0x922f60);let _0x281b68=_0x2407f7(0x16e);switch(_0x922f60[_0x2407f7(0x147)]?.[_0x2407f7(0x14d)]()){case _0x2407f7(0x11c):case _0x2407f7(0x104):case _0x2407f7(0x166):case'success':case _0x2407f7(0x15b):_0x922f60[_0x2407f7(0x11f)]===_0x2407f7(0x122)?_0x281b68=_0x2407f7(0x146):_0x281b68=_0x2407f7(0x16e);break;case _0x2407f7(0x11e):case'canceled':case _0x2407f7(0x11a):case'error':case'rejected':_0x281b68=_0x2407f7(0x155);break;case _0x2407f7(0x151):case'timeout':_0x281b68=_0x2407f7(0x156);break;case'pending':case'created':case'active':case _0x2407f7(0x161):case'in_progress':default:_0x281b68=_0x2407f7(0x16e);break;}return{'paymentId':_0x922f60['MerchantPaymentId']||_0x922f60[_0x2407f7(0x125)],'status':_0x281b68,'amount':_0x922f60['Amount'],'currency':_0x922f60['Currency'],'additionalInfo':{'method':_0x922f60[_0x2407f7(0x12c)],'bankId':_0x922f60[_0x2407f7(0x157)],'settled':_0x922f60[_0x2407f7(0x11f)],'settlementDate':_0x922f60[_0x2407f7(0x139)],'remitterName':_0x922f60['Remitter']?.[_0x2407f7(0x144)],'remitterIban':_0x922f60[_0x2407f7(0x141)]?.[_0x2407f7(0x145)],'bankTransactionId':_0x922f60[_0x2407f7(0x177)]}};}[a40_0x1d88fe(0x148)](_0x38d6d5,_0x2e3cd0){const _0x339a4b=a40_0x1d88fe;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x2e3cd0,'paymentId':_0x38d6d5[_0x339a4b(0x125)],'merchantPaymentId':_0x38d6d5['MerchantPaymentId']}),!![];}}function a40_0x403b(){const _0x5c19bf=['BankTransactionId','now','===\x20PARSED\x20NODA\x20RESPONSE\x20===','isActive','completed','Response\x20Time:','272051ojfdCb','currency','HTTP\x20Status:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Missing\x20id\x20or\x20shortLink\x20in\x20response','Request\x20Body\x20(Direct\x20JSON):','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','TesSoft\x20Payment\x20System/1.0','1316240ScEcdA','POST','Error\x20Message:','toUpperCase','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','noda','Noda\x20payment\x20verification\x20error:','processWebhook','log','Not\x20provided','Parsed\x20Result:','45pHRziU','failed','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','done','shortLinkUrls','cancelled','Settled','Status:','GET','Yes','Failed\x20to\x20verify\x20Noda\x20payment:\x20','parse','PaymentId','5qrOifA','__esModule','Error\x20details:','Payment\x20Link\x20ID:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','fromEntries','Method','createPaymentLink','HTTP\x20error!\x20status:\x20',',\x20body:\x20','Processing\x20Noda\x20webhook:','Short\x20Link:','12xifqbW','Unknown\x20error\x20from\x20Noda\x20API','384040JyLFBi','verifyPayment','loggerService','Order\x20ID\x20Used:','expiryDate','SettlementDate','qrCodeLink','QR\x20Code\x20Link:','application/json','Order\x20ID\x20Format:','Business\x20Error:\x20','logWhiteDomainError','309102kTDYUD','Remitter','stringify','Noda\x20API\x20error:\x20','Name','Iban','PAID','Status','verifyWebhookSignature','HTTP\x20','json','shortLink','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','toLowerCase','error','2574930xJsoGe','text','expired','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','/payment-links','URL:','FAILED','EXPIRED','BankId','171654cOTJsZ','entries','../loggerService','successful','apiUrl','message','===\x20NODA\x20SUCCESS\x20===','statusCode','JSON\x20Parse\x20Error:\x20','processing','Unknown\x20error','https://tesoft.uk/gateway/noda/webhook/','/payment-links/','logWhiteDomainResponse','paid','(8digits-8digits\x20format\x20for\x20Noda)','NodaService','status','===\x20NODA\x20SERVICE\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','4100120mGcPBs','headers','PENDING','logWhiteDomainRequest','(8digits-8digits\x20format)','Error\x20stack:','statusText','Status\x20Code:','Error\x20message:','https://tesoft.uk/gateway/noda/','ðŸŒ\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'];a40_0x403b=function(){return _0x5c19bf;};return a40_0x403b();}exports[a40_0x1d88fe(0x168)]=NodaService;