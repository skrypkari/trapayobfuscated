'use strict';function a51_0x43a4(_0x3bbdb6,_0x37ab4b){const _0x3a8c1a=a51_0x3a8c();return a51_0x43a4=function(_0x43a44b,_0x35700b){_0x43a44b=_0x43a44b-0x113;let _0x5571d3=_0x3a8c1a[_0x43a44b];return _0x5571d3;},a51_0x43a4(_0x3bbdb6,_0x37ab4b);}const a51_0x124048=a51_0x43a4;(function(_0x176fe6,_0x2d7f4a){const _0x309663=a51_0x43a4,_0x294b46=_0x176fe6();while(!![]){try{const _0x4f433f=-parseInt(_0x309663(0x13a))/0x1*(-parseInt(_0x309663(0x17a))/0x2)+-parseInt(_0x309663(0x131))/0x3+parseInt(_0x309663(0x13c))/0x4*(parseInt(_0x309663(0x137))/0x5)+parseInt(_0x309663(0x124))/0x6+parseInt(_0x309663(0x134))/0x7+-parseInt(_0x309663(0x121))/0x8+-parseInt(_0x309663(0x132))/0x9;if(_0x4f433f===_0x2d7f4a)break;else _0x294b46['push'](_0x294b46['shift']());}catch(_0x2cb0e5){_0x294b46['push'](_0x294b46['shift']());}}}(a51_0x3a8c,0x2b5c1));Object['defineProperty'](exports,a51_0x124048(0x11c),{'value':!![]}),exports['NodaService']=void 0x0;function a51_0x3a8c(){const _0x38d9b7=['Order\x20ID\x20Format:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','QR\x20Code\x20Link:','success','noda','(8digits-8digits\x20format)','Yes','Name','logWhiteDomainResponse','Iban','===\x20NODA\x20SERVICE\x20ERROR\x20===','active','/payment-links','Business\x20Error:\x20','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Payment\x20System/1.0','shortLinkUrls','done','rejected','apiUrl','Remitter','JSON\x20Parse\x20Error:\x20','failed','Headers:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','statusCode','Processing\x20Noda\x20webhook:','expiryDate','Error\x20Message:','createPaymentLink','Unknown\x20error','151534vvGsuk','processing','Payment\x20Link\x20ID:','Status:','Unknown\x20error\x20from\x20Noda\x20API','fromEntries','Response\x20Body:','entries','text','HTTP\x20error!\x20status:\x20','stringify','canceled','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','successful','paid','stack','Status','pending','completed','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','application/json','currency','__esModule','now','amount','/payment-links/','qrCodeLink','2067272tiUMhQ','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','error','2107212fCcyOH','timeout','logWhiteDomainError','log','FAILED','Error\x20details:','Error\x20stack:','statusText','Settled','../loggerService','Raw\x20Response\x20Body:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','POST','669600UfIRqK','418986bIAnxx','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','179935YukNFC','https://tesoft.uk/gateway/noda/webhook/','verifyPayment','25terXMV','EXPIRED','Noda\x20webhook\x20signature\x20verification:','1FFemLB','loggerService','202472eKeOLx','Status\x20Code:','PENDING','GET','in_progress','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','status','HTTP\x20','shortLink','logWhiteDomainRequest','MerchantPaymentId','Not\x20provided','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Order\x20ID\x20Used:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','isActive','(8digits-8digits\x20format\x20for\x20Noda)','verifyWebhookSignature','message','https://tesoft.uk/gateway/pending.php?id=','Method','PAID','json','===\x20NODA\x20API\x20ERROR\x20===','Response\x20Time:','created','Short\x20Link:','Noda\x20API\x20error:\x20','processWebhook','Parsed\x20Result:','BankId'];a51_0x3a8c=function(){return _0x38d9b7;};return a51_0x3a8c();}const loggerService_1=require(a51_0x124048(0x12d));class NodaService{constructor(){const _0x32bea0=a51_0x124048;this[_0x32bea0(0x16e)]='https://tesoft.uk/gateway/noda/',console[_0x32bea0(0x127)](_0x32bea0(0x148));}async[a51_0x124048(0x178)](_0x3cff97){const _0x1ad5c2=a51_0x124048,{orderId:_0x4df71b,name:_0x127a7f,paymentDescription:_0x25ca83,amount:_0x524f5a,currency:_0xd62971,webhookUrl:_0x21d9c5,returnUrl:_0x39b277,expiryDate:_0x236253}=_0x3cff97,_0x4fc782=_0xd62971['toUpperCase'](),_0x63a866=_0x1ad5c2(0x135),_0x318f87=_0x1ad5c2(0x14f)+_0x4df71b,_0x26d462={'name':_0x127a7f,'paymentDescription':_0x25ca83,'amount':_0x524f5a,'currency':_0x4fc782,'paymentId':_0x4df71b,'webhookUrl':_0x63a866,'returnUrl':_0x318f87};_0x236253&&(_0x26d462[_0x1ad5c2(0x176)]=_0x236253);const _0x370b8b=Date[_0x1ad5c2(0x11d)]();try{console[_0x1ad5c2(0x127)](_0x1ad5c2(0x133)),console[_0x1ad5c2(0x127)]('URL:',this[_0x1ad5c2(0x16e)]),console['log']('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x1ad5c2(0x184)](_0x26d462,null,0x2)),console[_0x1ad5c2(0x127)](_0x1ad5c2(0x15b),_0x4df71b,_0x1ad5c2(0x14c)),console[_0x1ad5c2(0x127)](_0x1ad5c2(0x141),_0x318f87),loggerService_1[_0x1ad5c2(0x13b)]['logWhiteDomainRequest'](_0x1ad5c2(0x15f),'/payment-links','POST',_0x26d462);const _0x49835f=await fetch(this[_0x1ad5c2(0x16e)],{'method':_0x1ad5c2(0x130),'headers':{'Content-Type':_0x1ad5c2(0x11a),'Accept':_0x1ad5c2(0x11a),'User-Agent':_0x1ad5c2(0x16a)},'body':JSON['stringify'](_0x26d462)}),_0x2ccd43=Date[_0x1ad5c2(0x11d)]()-_0x370b8b;console[_0x1ad5c2(0x127)](_0x1ad5c2(0x15c)),console[_0x1ad5c2(0x127)](_0x1ad5c2(0x17d),_0x49835f[_0x1ad5c2(0x142)]),console['log']('Status\x20Text:',_0x49835f[_0x1ad5c2(0x12b)]),console[_0x1ad5c2(0x127)](_0x1ad5c2(0x172),Object[_0x1ad5c2(0x17f)](_0x49835f['headers'][_0x1ad5c2(0x181)]())),console['log'](_0x1ad5c2(0x154),_0x2ccd43+'ms');const _0x1014e8=await _0x49835f[_0x1ad5c2(0x182)]();console[_0x1ad5c2(0x127)](_0x1ad5c2(0x12e),_0x1014e8);if(!_0x49835f['ok']){console[_0x1ad5c2(0x123)](_0x1ad5c2(0x153)),console['error']('HTTP\x20Status:',_0x49835f[_0x1ad5c2(0x142)]),console[_0x1ad5c2(0x123)](_0x1ad5c2(0x180),_0x1014e8),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1ad5c2(0x15f),_0x1ad5c2(0x167),_0x49835f['status'],_0x1014e8,_0x2ccd43),loggerService_1[_0x1ad5c2(0x13b)][_0x1ad5c2(0x126)]('noda',_0x1ad5c2(0x167),_0x1ad5c2(0x143)+_0x49835f[_0x1ad5c2(0x142)]+':\x20'+_0x1014e8);if(_0x49835f[_0x1ad5c2(0x142)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x49835f[_0x1ad5c2(0x142)]===0x1f4)throw new Error(_0x1ad5c2(0x122));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x49835f[_0x1ad5c2(0x142)]+',\x20body:\x20'+_0x1014e8);}let _0x2afb1a;try{_0x2afb1a=JSON['parse'](_0x1014e8);}catch(_0x236b33){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x236b33),loggerService_1[_0x1ad5c2(0x13b)]['logWhiteDomainError'](_0x1ad5c2(0x15f),_0x1ad5c2(0x167),_0x1ad5c2(0x170)+_0x236b33);throw new Error(_0x1ad5c2(0x119)+_0x1014e8);}console[_0x1ad5c2(0x127)](_0x1ad5c2(0x169)),console[_0x1ad5c2(0x127)](_0x1ad5c2(0x159),JSON['stringify'](_0x2afb1a,null,0x2)),loggerService_1[_0x1ad5c2(0x13b)][_0x1ad5c2(0x163)](_0x1ad5c2(0x15f),_0x1ad5c2(0x167),_0x49835f[_0x1ad5c2(0x142)],_0x2afb1a,_0x2ccd43);if(_0x2afb1a['error']||_0x2afb1a[_0x1ad5c2(0x174)]){const _0x1ab3aa=_0x2afb1a['message']||_0x2afb1a[_0x1ad5c2(0x123)]||_0x1ad5c2(0x17e);console[_0x1ad5c2(0x123)](_0x1ad5c2(0x186)),console[_0x1ad5c2(0x123)](_0x1ad5c2(0x177),_0x1ab3aa),console['error'](_0x1ad5c2(0x13d),_0x2afb1a['statusCode']),loggerService_1[_0x1ad5c2(0x13b)][_0x1ad5c2(0x126)](_0x1ad5c2(0x15f),_0x1ad5c2(0x167),_0x1ad5c2(0x168)+_0x1ab3aa);throw new Error(_0x1ad5c2(0x157)+_0x1ab3aa);}if(!_0x2afb1a['id']||!_0x2afb1a[_0x1ad5c2(0x16b)]?.['shortLink']){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1ad5c2(0x123)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x1ad5c2(0x123)]('Response\x20data:',_0x2afb1a),loggerService_1['loggerService'][_0x1ad5c2(0x126)](_0x1ad5c2(0x15f),_0x1ad5c2(0x167),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x1ad5c2(0x12f));}return console[_0x1ad5c2(0x127)]('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x1ad5c2(0x17c),_0x2afb1a['id']),console[_0x1ad5c2(0x127)](_0x1ad5c2(0x156),_0x2afb1a[_0x1ad5c2(0x16b)][_0x1ad5c2(0x144)]),console['log'](_0x1ad5c2(0x15d),_0x2afb1a[_0x1ad5c2(0x16b)][_0x1ad5c2(0x120)]||_0x1ad5c2(0x147)),console['log'](_0x1ad5c2(0x149),_0x4df71b,_0x1ad5c2(0x160)),console[_0x1ad5c2(0x127)](_0x1ad5c2(0x14a),_0x318f87),{'gateway_payment_id':_0x2afb1a['id'],'payment_url':_0x2afb1a[_0x1ad5c2(0x16b)][_0x1ad5c2(0x144)],'qr_code_url':_0x2afb1a[_0x1ad5c2(0x16b)][_0x1ad5c2(0x120)],'expiry_date':_0x2afb1a[_0x1ad5c2(0x176)]};}catch(_0x479137){console[_0x1ad5c2(0x123)](_0x1ad5c2(0x165)),console[_0x1ad5c2(0x123)](_0x1ad5c2(0x129),_0x479137),loggerService_1['loggerService'][_0x1ad5c2(0x126)](_0x1ad5c2(0x15f),_0x1ad5c2(0x167),_0x479137);if(_0x479137 instanceof Error){console['error']('Error\x20message:',_0x479137[_0x1ad5c2(0x14e)]),console[_0x1ad5c2(0x123)](_0x1ad5c2(0x12a),_0x479137[_0x1ad5c2(0x115)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x479137[_0x1ad5c2(0x14e)]);}throw new Error(_0x1ad5c2(0x173));}}async[a51_0x124048(0x136)](_0x41394c){const _0x3adfaa=a51_0x124048,_0x238a05=Date[_0x3adfaa(0x11d)]();try{loggerService_1[_0x3adfaa(0x13b)][_0x3adfaa(0x145)](_0x3adfaa(0x15f),'/payment-links/'+_0x41394c,_0x3adfaa(0x13f),{});const _0x1b132a=await fetch(this[_0x3adfaa(0x16e)]+'/'+_0x41394c,{'method':_0x3adfaa(0x13f),'headers':{'Content-Type':_0x3adfaa(0x11a),'User-Agent':'Payment\x20System/1.0'}}),_0x566bd1=Date[_0x3adfaa(0x11d)]()-_0x238a05;if(!_0x1b132a['ok']){const _0xb83215=await _0x1b132a[_0x3adfaa(0x182)]();loggerService_1[_0x3adfaa(0x13b)][_0x3adfaa(0x163)]('noda',_0x3adfaa(0x11f)+_0x41394c,_0x1b132a[_0x3adfaa(0x142)],_0xb83215,_0x566bd1);throw new Error(_0x3adfaa(0x183)+_0x1b132a[_0x3adfaa(0x142)]);}const _0xb1e08d=await _0x1b132a[_0x3adfaa(0x152)]();loggerService_1[_0x3adfaa(0x13b)][_0x3adfaa(0x163)](_0x3adfaa(0x15f),'/payment-links/'+_0x41394c,_0x1b132a[_0x3adfaa(0x142)],_0xb1e08d,_0x566bd1);if(_0xb1e08d[_0x3adfaa(0x123)]||_0xb1e08d[_0x3adfaa(0x174)]){loggerService_1[_0x3adfaa(0x13b)][_0x3adfaa(0x126)](_0x3adfaa(0x15f),_0x3adfaa(0x11f)+_0x41394c,'Noda\x20API\x20error:\x20'+(_0xb1e08d[_0x3adfaa(0x14e)]||_0xb1e08d[_0x3adfaa(0x123)]||_0x3adfaa(0x179)));throw new Error(_0x3adfaa(0x157)+(_0xb1e08d[_0x3adfaa(0x14e)]||_0xb1e08d[_0x3adfaa(0x123)]||_0x3adfaa(0x179)));}let _0x1481f1=_0x3adfaa(0x13e);if(_0xb1e08d[_0x3adfaa(0x14b)]===![]){if(_0xb1e08d[_0x3adfaa(0x176)]){const _0x9ed75a=new Date(_0xb1e08d[_0x3adfaa(0x176)]),_0xbf2f3e=new Date();_0x9ed75a<_0xbf2f3e?_0x1481f1='EXPIRED':_0x1481f1=_0x3adfaa(0x128);}else _0x1481f1=_0x3adfaa(0x128);}else _0x1481f1='PENDING';return{'status':_0x1481f1,'amount':_0xb1e08d[_0x3adfaa(0x11e)],'currency':_0xb1e08d[_0x3adfaa(0x11b)],'isActive':_0xb1e08d['isActive']};}catch(_0x5413bf){console[_0x3adfaa(0x123)]('Noda\x20payment\x20verification\x20error:',_0x5413bf),loggerService_1[_0x3adfaa(0x13b)][_0x3adfaa(0x126)](_0x3adfaa(0x15f),_0x3adfaa(0x11f)+_0x41394c,_0x5413bf);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x5413bf instanceof Error?_0x5413bf[_0x3adfaa(0x14e)]:_0x3adfaa(0x179)));}}async[a51_0x124048(0x158)](_0x44c5ad){const _0x2591f7=a51_0x124048;console[_0x2591f7(0x127)](_0x2591f7(0x175),_0x44c5ad);let _0x4fdf2f=_0x2591f7(0x13e);switch(_0x44c5ad[_0x2591f7(0x116)]?.['toLowerCase']()){case _0x2591f7(0x16c):case _0x2591f7(0x118):case _0x2591f7(0x114):case _0x2591f7(0x15e):case _0x2591f7(0x113):_0x44c5ad[_0x2591f7(0x12c)]===_0x2591f7(0x161)?_0x4fdf2f=_0x2591f7(0x151):_0x4fdf2f=_0x2591f7(0x13e);break;case'cancelled':case _0x2591f7(0x185):case _0x2591f7(0x171):case'error':case _0x2591f7(0x16d):_0x4fdf2f=_0x2591f7(0x128);break;case'expired':case _0x2591f7(0x125):_0x4fdf2f=_0x2591f7(0x138);break;case _0x2591f7(0x117):case _0x2591f7(0x155):case _0x2591f7(0x166):case _0x2591f7(0x17b):case _0x2591f7(0x140):default:_0x4fdf2f=_0x2591f7(0x13e);break;}return{'paymentId':_0x44c5ad[_0x2591f7(0x146)]||_0x44c5ad['PaymentId'],'status':_0x4fdf2f,'amount':_0x44c5ad['Amount'],'currency':_0x44c5ad['Currency'],'additionalInfo':{'method':_0x44c5ad[_0x2591f7(0x150)],'bankId':_0x44c5ad[_0x2591f7(0x15a)],'settled':_0x44c5ad[_0x2591f7(0x12c)],'settlementDate':_0x44c5ad['SettlementDate'],'remitterName':_0x44c5ad[_0x2591f7(0x16f)]?.[_0x2591f7(0x162)],'remitterIban':_0x44c5ad[_0x2591f7(0x16f)]?.[_0x2591f7(0x164)],'bankTransactionId':_0x44c5ad['BankTransactionId']}};}[a51_0x124048(0x14d)](_0x28a415,_0x32545e){const _0x3036a4=a51_0x124048;return console[_0x3036a4(0x127)](_0x3036a4(0x139),{'receivedSignature':_0x32545e,'paymentId':_0x28a415['PaymentId'],'merchantPaymentId':_0x28a415[_0x3036a4(0x146)]}),!![];}}exports['NodaService']=NodaService;