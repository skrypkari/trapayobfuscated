'use strict';const a43_0x12cb0e=a43_0x3244;function a43_0x3244(_0x5d6c44,_0x1edfcb){const _0x38686e=a43_0x3868();return a43_0x3244=function(_0x324482,_0x36b0e1){_0x324482=_0x324482-0x159;let _0x1ce977=_0x38686e[_0x324482];return _0x1ce977;},a43_0x3244(_0x5d6c44,_0x1edfcb);}function a43_0x3868(){const _0x5249a0=['MerchantPaymentId','URL:','64FnCaLk','fromEntries','Business\x20Error:\x20','1038sUzjgY','stringify','Missing\x20id\x20or\x20shortLink\x20in\x20response','logWhiteDomainError','HTTP\x20error!\x20status:\x20','Unknown\x20error','amount','loggerService','SettlementDate','Currency','apiUrl','shortLinkUrls','paid','pending','Error\x20details:','processing','../loggerService','toUpperCase','now',',\x20body:\x20','Failed\x20to\x20parse\x20JSON\x20response:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','done','1311895SULoNn','expiryDate','GET','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Headers:','Name','logWhiteDomainRequest','https://tesoft.uk/gateway/noda/webhook/','shortLink','===\x20NODA\x20API\x20ERROR\x20===','log','application/json','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','isActive','Status:','80864FMhfHf','6722QVHiOS','qrCodeLink','Status','Error\x20Message:','timeout','active','created','parse','currency','Error\x20message:','https://tesoft.uk/gateway/pending.php?id=','/payment-links','Status\x20Text:','5giFULN','status','HTTP\x20Status:','Noda\x20API\x20error:\x20','logWhiteDomainResponse','Raw\x20Response\x20Body:','/payment-links/','PENDING','POST','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','PaymentId','cancelled','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','expired','PAID','Short\x20Link:','verifyPayment','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','verifyWebhookSignature','EXPIRED','3211266dmgezu','Failed\x20to\x20verify\x20Noda\x20payment:\x20','===\x20NODA\x20SUCCESS\x20===','5998869jzNhxr','JSON\x20Parse\x20Error:\x20','Yes','Response\x20data:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','rejected','success','message','processWebhook','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','HTTP\x20','Order\x20ID\x20Format:','Settled','Parsed\x20Result:','Request\x20Body\x20(Direct\x20JSON):','Noda\x20payment\x20verification\x20error:','Processing\x20Noda\x20webhook:','1444644LmNSJf','FAILED','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','completed','Status\x20Code:','https://tesoft.uk/gateway/noda/','(8digits-8digits\x20format)','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','failed','statusCode','error','NodaService','Unknown\x20error\x20from\x20Noda\x20API','createPaymentLink','defineProperty','noda','Response\x20Time:','Error\x20stack:','Remitter','canceled','json','headers','Response\x20Body:','2259510MvCayV'];a43_0x3868=function(){return _0x5249a0;};return a43_0x3868();}(function(_0x5cd9a6,_0x28f667){const _0x5c621f=a43_0x3244,_0x3012e8=_0x5cd9a6();while(!![]){try{const _0x23950c=-parseInt(_0x5c621f(0x18f))/0x1+-parseInt(_0x5c621f(0x1a0))/0x2*(-parseInt(_0x5c621f(0x178))/0x3)+parseInt(_0x5c621f(0x15b))/0x4*(-parseInt(_0x5c621f(0x1ad))/0x5)+parseInt(_0x5c621f(0x1c1))/0x6+-parseInt(_0x5c621f(0x19f))/0x7*(parseInt(_0x5c621f(0x175))/0x8)+parseInt(_0x5c621f(0x1c4))/0x9+parseInt(_0x5c621f(0x172))/0xa;if(_0x23950c===_0x28f667)break;else _0x3012e8['push'](_0x3012e8['shift']());}catch(_0x53c311){_0x3012e8['push'](_0x3012e8['shift']());}}}(a43_0x3868,0xc9731));Object[a43_0x12cb0e(0x169)](exports,'__esModule',{'value':!![]}),exports[a43_0x12cb0e(0x166)]=void 0x0;const loggerService_1=require(a43_0x12cb0e(0x188));class NodaService{constructor(){const _0x4f89c8=a43_0x12cb0e;this[_0x4f89c8(0x182)]=_0x4f89c8(0x160),console[_0x4f89c8(0x19a)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a43_0x12cb0e(0x168)](_0xd578c9){const _0x9316ae=a43_0x12cb0e,{orderId:_0x20636d,name:_0x20514b,paymentDescription:_0x354df7,amount:_0x1e1014,currency:_0x567778,webhookUrl:_0x5d1a49,returnUrl:_0x4734e2,expiryDate:_0x2f75c7}=_0xd578c9,_0x107e4b=_0x567778[_0x9316ae(0x189)](),_0x4df31b=_0x9316ae(0x197),_0x21ccd7=_0x9316ae(0x1aa)+_0x20636d,_0x361c76={'name':_0x20514b,'paymentDescription':_0x354df7,'amount':_0x1e1014,'currency':_0x107e4b,'paymentId':_0x20636d,'webhookUrl':_0x4df31b,'returnUrl':_0x21ccd7};_0x2f75c7&&(_0x361c76[_0x9316ae(0x190)]=_0x2f75c7);const _0x3e900b=Date['now']();try{console[_0x9316ae(0x19a)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x9316ae(0x19a)](_0x9316ae(0x174),this[_0x9316ae(0x182)]),console[_0x9316ae(0x19a)](_0x9316ae(0x1d2),JSON['stringify'](_0x361c76,null,0x2)),console[_0x9316ae(0x19a)](_0x9316ae(0x1cf),_0x20636d,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x9316ae(0x19a)](_0x9316ae(0x192),_0x21ccd7),loggerService_1[_0x9316ae(0x17f)][_0x9316ae(0x196)](_0x9316ae(0x16a),_0x9316ae(0x1ab),_0x9316ae(0x1b5),_0x361c76);const _0x5e70a3=await fetch(this[_0x9316ae(0x182)],{'method':_0x9316ae(0x1b5),'headers':{'Content-Type':_0x9316ae(0x19b),'Accept':_0x9316ae(0x19b),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x361c76)}),_0x4f36d8=Date['now']()-_0x3e900b;console['log'](_0x9316ae(0x1c8)),console['log'](_0x9316ae(0x19e),_0x5e70a3[_0x9316ae(0x1ae)]),console[_0x9316ae(0x19a)](_0x9316ae(0x1ac),_0x5e70a3['statusText']),console[_0x9316ae(0x19a)](_0x9316ae(0x194),Object[_0x9316ae(0x176)](_0x5e70a3[_0x9316ae(0x170)]['entries']())),console[_0x9316ae(0x19a)](_0x9316ae(0x16b),_0x4f36d8+'ms');const _0x2084dd=await _0x5e70a3['text']();console[_0x9316ae(0x19a)](_0x9316ae(0x1b2),_0x2084dd);if(!_0x5e70a3['ok']){console['error'](_0x9316ae(0x199)),console[_0x9316ae(0x165)](_0x9316ae(0x1af),_0x5e70a3[_0x9316ae(0x1ae)]),console[_0x9316ae(0x165)](_0x9316ae(0x171),_0x2084dd),loggerService_1[_0x9316ae(0x17f)][_0x9316ae(0x1b1)](_0x9316ae(0x16a),_0x9316ae(0x1ab),_0x5e70a3[_0x9316ae(0x1ae)],_0x2084dd,_0x4f36d8),loggerService_1[_0x9316ae(0x17f)][_0x9316ae(0x17b)](_0x9316ae(0x16a),_0x9316ae(0x1ab),_0x9316ae(0x1ce)+_0x5e70a3['status']+':\x20'+_0x2084dd);if(_0x5e70a3[_0x9316ae(0x1ae)]===0x190)throw new Error(_0x9316ae(0x19c));else{if(_0x5e70a3[_0x9316ae(0x1ae)]===0x1f4)throw new Error(_0x9316ae(0x18d));}throw new Error(_0x9316ae(0x17c)+_0x5e70a3[_0x9316ae(0x1ae)]+_0x9316ae(0x18b)+_0x2084dd);}let _0x3c981a;try{_0x3c981a=JSON[_0x9316ae(0x1a7)](_0x2084dd);}catch(_0x234b88){console[_0x9316ae(0x165)](_0x9316ae(0x18c),_0x234b88),loggerService_1[_0x9316ae(0x17f)][_0x9316ae(0x17b)](_0x9316ae(0x16a),'/payment-links',_0x9316ae(0x1c5)+_0x234b88);throw new Error(_0x9316ae(0x1b9)+_0x2084dd);}console[_0x9316ae(0x19a)](_0x9316ae(0x193)),console['log'](_0x9316ae(0x1d1),JSON[_0x9316ae(0x179)](_0x3c981a,null,0x2)),loggerService_1[_0x9316ae(0x17f)][_0x9316ae(0x1b1)](_0x9316ae(0x16a),_0x9316ae(0x1ab),_0x5e70a3[_0x9316ae(0x1ae)],_0x3c981a,_0x4f36d8);if(_0x3c981a[_0x9316ae(0x165)]||_0x3c981a[_0x9316ae(0x164)]){const _0x38fbb4=_0x3c981a[_0x9316ae(0x1cb)]||_0x3c981a['error']||_0x9316ae(0x167);console[_0x9316ae(0x165)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x9316ae(0x165)](_0x9316ae(0x1a3),_0x38fbb4),console[_0x9316ae(0x165)](_0x9316ae(0x15f),_0x3c981a['statusCode']),loggerService_1[_0x9316ae(0x17f)]['logWhiteDomainError'](_0x9316ae(0x16a),'/payment-links',_0x9316ae(0x177)+_0x38fbb4);throw new Error(_0x9316ae(0x1b0)+_0x38fbb4);}if(!_0x3c981a['id']||!_0x3c981a['shortLinkUrls']?.[_0x9316ae(0x198)]){console['error'](_0x9316ae(0x162)),console['error'](_0x9316ae(0x17a)),console[_0x9316ae(0x165)](_0x9316ae(0x1c7),_0x3c981a),loggerService_1[_0x9316ae(0x17f)][_0x9316ae(0x17b)](_0x9316ae(0x16a),'/payment-links',_0x9316ae(0x1cd));throw new Error(_0x9316ae(0x1b6));}return console[_0x9316ae(0x19a)](_0x9316ae(0x1c3)),console[_0x9316ae(0x19a)]('Payment\x20Link\x20ID:',_0x3c981a['id']),console[_0x9316ae(0x19a)](_0x9316ae(0x1bc),_0x3c981a['shortLinkUrls'][_0x9316ae(0x198)]),console[_0x9316ae(0x19a)]('QR\x20Code\x20Link:',_0x3c981a[_0x9316ae(0x183)][_0x9316ae(0x1a1)]||'Not\x20provided'),console[_0x9316ae(0x19a)]('Order\x20ID\x20Used:',_0x20636d,_0x9316ae(0x161)),console[_0x9316ae(0x19a)](_0x9316ae(0x1be),_0x21ccd7),{'gateway_payment_id':_0x3c981a['id'],'payment_url':_0x3c981a[_0x9316ae(0x183)][_0x9316ae(0x198)],'qr_code_url':_0x3c981a['shortLinkUrls'][_0x9316ae(0x1a1)],'expiry_date':_0x3c981a[_0x9316ae(0x190)]};}catch(_0x989e73){console[_0x9316ae(0x165)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x9316ae(0x165)](_0x9316ae(0x186),_0x989e73),loggerService_1[_0x9316ae(0x17f)]['logWhiteDomainError'](_0x9316ae(0x16a),'/payment-links',_0x989e73);if(_0x989e73 instanceof Error){console[_0x9316ae(0x165)](_0x9316ae(0x1a9),_0x989e73[_0x9316ae(0x1cb)]),console['error'](_0x9316ae(0x16c),_0x989e73['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x989e73[_0x9316ae(0x1cb)]);}throw new Error(_0x9316ae(0x15d));}}async[a43_0x12cb0e(0x1bd)](_0x49c25e){const _0x21ef08=a43_0x12cb0e,_0x593559=Date[_0x21ef08(0x18a)]();try{loggerService_1['loggerService']['logWhiteDomainRequest'](_0x21ef08(0x16a),_0x21ef08(0x1b3)+_0x49c25e,_0x21ef08(0x191),{});const _0x3beb68=await fetch(this[_0x21ef08(0x182)]+'/'+_0x49c25e,{'method':_0x21ef08(0x191),'headers':{'Content-Type':_0x21ef08(0x19b),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x4a9e6f=Date[_0x21ef08(0x18a)]()-_0x593559;if(!_0x3beb68['ok']){const _0x38454e=await _0x3beb68['text']();loggerService_1[_0x21ef08(0x17f)]['logWhiteDomainResponse'](_0x21ef08(0x16a),_0x21ef08(0x1b3)+_0x49c25e,_0x3beb68[_0x21ef08(0x1ae)],_0x38454e,_0x4a9e6f);throw new Error(_0x21ef08(0x17c)+_0x3beb68[_0x21ef08(0x1ae)]);}const _0x2813d5=await _0x3beb68[_0x21ef08(0x16f)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x21ef08(0x16a),'/payment-links/'+_0x49c25e,_0x3beb68[_0x21ef08(0x1ae)],_0x2813d5,_0x4a9e6f);if(_0x2813d5[_0x21ef08(0x165)]||_0x2813d5[_0x21ef08(0x164)]){loggerService_1[_0x21ef08(0x17f)][_0x21ef08(0x17b)](_0x21ef08(0x16a),_0x21ef08(0x1b3)+_0x49c25e,_0x21ef08(0x1b0)+(_0x2813d5[_0x21ef08(0x1cb)]||_0x2813d5[_0x21ef08(0x165)]||'Unknown\x20error'));throw new Error(_0x21ef08(0x1b0)+(_0x2813d5[_0x21ef08(0x1cb)]||_0x2813d5[_0x21ef08(0x165)]||_0x21ef08(0x17d)));}let _0x8fe5c8='PENDING';if(_0x2813d5['isActive']===![]){if(_0x2813d5[_0x21ef08(0x190)]){const _0x3b846c=new Date(_0x2813d5['expiryDate']),_0x18377c=new Date();_0x3b846c<_0x18377c?_0x8fe5c8=_0x21ef08(0x1c0):_0x8fe5c8=_0x21ef08(0x15c);}else _0x8fe5c8='FAILED';}else _0x8fe5c8=_0x21ef08(0x1b4);return{'status':_0x8fe5c8,'amount':_0x2813d5[_0x21ef08(0x17e)],'currency':_0x2813d5[_0x21ef08(0x1a8)],'isActive':_0x2813d5[_0x21ef08(0x19d)]};}catch(_0x7797e8){console['error'](_0x21ef08(0x159),_0x7797e8),loggerService_1[_0x21ef08(0x17f)]['logWhiteDomainError'](_0x21ef08(0x16a),_0x21ef08(0x1b3)+_0x49c25e,_0x7797e8);throw new Error(_0x21ef08(0x1c2)+(_0x7797e8 instanceof Error?_0x7797e8[_0x21ef08(0x1cb)]:_0x21ef08(0x17d)));}}async[a43_0x12cb0e(0x1cc)](_0x2b2c23){const _0x4e611f=a43_0x12cb0e;console[_0x4e611f(0x19a)](_0x4e611f(0x15a),_0x2b2c23);let _0x4c5955=_0x4e611f(0x1b4);switch(_0x2b2c23[_0x4e611f(0x1a2)]?.['toLowerCase']()){case _0x4e611f(0x18e):case _0x4e611f(0x15e):case _0x4e611f(0x184):case _0x4e611f(0x1ca):case'successful':_0x2b2c23[_0x4e611f(0x1d0)]===_0x4e611f(0x1c6)?_0x4c5955=_0x4e611f(0x1bb):_0x4c5955=_0x4e611f(0x1b4);break;case _0x4e611f(0x1b8):case _0x4e611f(0x16e):case _0x4e611f(0x163):case _0x4e611f(0x165):case _0x4e611f(0x1c9):_0x4c5955='FAILED';break;case _0x4e611f(0x1ba):case _0x4e611f(0x1a4):_0x4c5955=_0x4e611f(0x1c0);break;case _0x4e611f(0x185):case _0x4e611f(0x1a6):case _0x4e611f(0x1a5):case _0x4e611f(0x187):case'in_progress':default:_0x4c5955=_0x4e611f(0x1b4);break;}return{'paymentId':_0x2b2c23[_0x4e611f(0x173)]||_0x2b2c23[_0x4e611f(0x1b7)],'status':_0x4c5955,'amount':_0x2b2c23['Amount'],'currency':_0x2b2c23[_0x4e611f(0x181)],'additionalInfo':{'method':_0x2b2c23['Method'],'bankId':_0x2b2c23['BankId'],'settled':_0x2b2c23[_0x4e611f(0x1d0)],'settlementDate':_0x2b2c23[_0x4e611f(0x180)],'remitterName':_0x2b2c23[_0x4e611f(0x16d)]?.[_0x4e611f(0x195)],'remitterIban':_0x2b2c23[_0x4e611f(0x16d)]?.['Iban'],'bankTransactionId':_0x2b2c23['BankTransactionId']}};}[a43_0x12cb0e(0x1bf)](_0x302e90,_0x18c44f){const _0x417931=a43_0x12cb0e;return console[_0x417931(0x19a)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x18c44f,'paymentId':_0x302e90[_0x417931(0x1b7)],'merchantPaymentId':_0x302e90[_0x417931(0x173)]}),!![];}}exports[a43_0x12cb0e(0x166)]=NodaService;