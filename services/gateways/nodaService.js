'use strict';function a43_0x4282(){const _0x569a09=['amount','MerchantPaymentId','Status\x20Code:','Error\x20Message:','Business\x20Error:\x20','/payment-links','HTTP\x20error!\x20status:\x20','Failed\x20to\x20verify\x20Noda\x20payment:\x20','885700WKQlnK','Response\x20Time:','EXPIRED','https://tesoft.uk/gateway/noda/webhook/','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Short\x20Link:','failed','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','GET','Status:','Missing\x20id\x20or\x20shortLink\x20in\x20response','verifyPayment','Noda\x20API\x20error:\x20','SettlementDate','Failed\x20to\x20parse\x20JSON\x20response:','expiryDate','Order\x20ID\x20Format:','TesSoft\x20Payment\x20System/1.0','Payment\x20Link\x20ID:','toUpperCase','6850rVXGdD',',\x20body:\x20','PENDING','status','BankId','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','(8digits-8digits\x20format)','log','Currency','stringify','12oiXwzz','__esModule','Status','statusText','Name','logWhiteDomainError','stack','Request\x20Body\x20(Direct\x20JSON):','message','PaymentId','(8digits-8digits\x20format\x20for\x20Noda)','4347246NKVQiF','error','shortLink','paid','POST','/payment-links/','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','processWebhook','canceled','expired','cancelled','apiUrl','18702tfIhek','pending','loggerService','20912BLBNpC','qrCodeLink','FAILED','Remitter','Yes','Settled','logWhiteDomainResponse','QR\x20Code\x20Link:','3220udLqsj','URL:','created','===\x20NODA\x20API\x20ERROR\x20===','https://tesoft.uk/gateway/pending.php?id=','verifyWebhookSignature','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Parsed\x20Result:','Status\x20Text:','parse','shortLinkUrls','processing','Response\x20data:','in_progress','noda','Unknown\x20error\x20from\x20Noda\x20API','Not\x20provided','Iban','logWhiteDomainRequest','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','statusCode','Headers:','Noda\x20webhook\x20signature\x20verification:','33514217BiRALA','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','https://tesoft.uk/gateway/noda/','now','8294500hOcDNY','Raw\x20Response\x20Body:','213bkBexG','defineProperty','JSON\x20Parse\x20Error:\x20','1458DSbtWf','timeout','application/json','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','BankTransactionId','Error\x20details:','text','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Amount','Noda\x20payment\x20verification\x20error:','isActive','rejected','Method','done','Unknown\x20error','NodaService','7sjVsBW'];a43_0x4282=function(){return _0x569a09;};return a43_0x4282();}const a43_0x26f17a=a43_0x3133;function a43_0x3133(_0x47de3c,_0x24e43f){const _0x42822c=a43_0x4282();return a43_0x3133=function(_0x31338f,_0x2e4c9b){_0x31338f=_0x31338f-0x9e;let _0x1a34f6=_0x42822c[_0x31338f];return _0x1a34f6;},a43_0x3133(_0x47de3c,_0x24e43f);}(function(_0x5214a3,_0x4ac864){const _0x18e7ca=a43_0x3133,_0x15ab8c=_0x5214a3();while(!![]){try{const _0x407f12=-parseInt(_0x18e7ca(0xd7))/0x1+parseInt(_0x18e7ca(0x10c))/0x2*(-parseInt(_0x18e7ca(0xbb))/0x3)+-parseInt(_0x18e7ca(0x9e))/0x4*(parseInt(_0x18e7ca(0xeb))/0x5)+-parseInt(_0x18e7ca(0x100))/0x6*(-parseInt(_0x18e7ca(0xce))/0x7)+parseInt(_0x18e7ca(0x10f))/0x8*(parseInt(_0x18e7ca(0xbe))/0x9)+-parseInt(_0x18e7ca(0xb9))/0xa+parseInt(_0x18e7ca(0xb5))/0xb*(parseInt(_0x18e7ca(0xf5))/0xc);if(_0x407f12===_0x4ac864)break;else _0x15ab8c['push'](_0x15ab8c['shift']());}catch(_0x4bf50c){_0x15ab8c['push'](_0x15ab8c['shift']());}}}(a43_0x4282,0xae083));Object[a43_0x26f17a(0xbc)](exports,a43_0x26f17a(0xf6),{'value':!![]}),exports[a43_0x26f17a(0xcd)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x315806=a43_0x26f17a;this['apiUrl']=_0x315806(0xb7),console[_0x315806(0xf2)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async['createPaymentLink'](_0x4d43fe){const _0x10bec5=a43_0x26f17a,{orderId:_0xd3fcf2,name:_0x3320dd,paymentDescription:_0x5d9af5,amount:_0x2cc26b,currency:_0x55af06,webhookUrl:_0x5ad410,returnUrl:_0x31c91e,expiryDate:_0x5c6033}=_0x4d43fe,_0xc1c8b=_0x55af06[_0x10bec5(0xea)](),_0x7decdc=_0x10bec5(0xda),_0x23c85f=_0x10bec5(0xa2)+_0xd3fcf2,_0x12684e={'name':_0x3320dd,'paymentDescription':_0x5d9af5,'amount':_0x2cc26b,'currency':_0xc1c8b,'paymentId':_0xd3fcf2,'webhookUrl':_0x7decdc,'returnUrl':_0x23c85f};_0x5c6033&&(_0x12684e[_0x10bec5(0xe6)]=_0x5c6033);const _0x1218d1=Date[_0x10bec5(0xb8)]();try{console[_0x10bec5(0xf2)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console['log'](_0x10bec5(0x9f),this[_0x10bec5(0x10b)]),console[_0x10bec5(0xf2)](_0x10bec5(0xfc),JSON[_0x10bec5(0xf4)](_0x12684e,null,0x2)),console[_0x10bec5(0xf2)](_0x10bec5(0xe7),_0xd3fcf2,_0x10bec5(0xff)),console['log'](_0x10bec5(0xc1),_0x23c85f),loggerService_1[_0x10bec5(0x10e)][_0x10bec5(0xb0)](_0x10bec5(0xac),_0x10bec5(0xd4),'POST',_0x12684e);const _0x583397=await fetch(this['apiUrl'],{'method':_0x10bec5(0x104),'headers':{'Content-Type':_0x10bec5(0xc0),'Accept':'application/json','User-Agent':_0x10bec5(0xe8)},'body':JSON[_0x10bec5(0xf4)](_0x12684e)}),_0x214a74=Date[_0x10bec5(0xb8)]()-_0x1218d1;console['log'](_0x10bec5(0xf0)),console[_0x10bec5(0xf2)](_0x10bec5(0xe0),_0x583397[_0x10bec5(0xee)]),console[_0x10bec5(0xf2)](_0x10bec5(0xa6),_0x583397[_0x10bec5(0xf8)]),console[_0x10bec5(0xf2)](_0x10bec5(0xb3),Object['fromEntries'](_0x583397['headers']['entries']())),console['log'](_0x10bec5(0xd8),_0x214a74+'ms');const _0x11fcd4=await _0x583397[_0x10bec5(0xc4)]();console[_0x10bec5(0xf2)](_0x10bec5(0xba),_0x11fcd4);if(!_0x583397['ok']){console['error'](_0x10bec5(0xa1)),console[_0x10bec5(0x101)]('HTTP\x20Status:',_0x583397['status']),console[_0x10bec5(0x101)]('Response\x20Body:',_0x11fcd4),loggerService_1[_0x10bec5(0x10e)]['logWhiteDomainResponse']('noda',_0x10bec5(0xd4),_0x583397[_0x10bec5(0xee)],_0x11fcd4,_0x214a74),loggerService_1[_0x10bec5(0x10e)][_0x10bec5(0xfa)](_0x10bec5(0xac),_0x10bec5(0xd4),'HTTP\x20'+_0x583397[_0x10bec5(0xee)]+':\x20'+_0x11fcd4);if(_0x583397[_0x10bec5(0xee)]===0x190)throw new Error(_0x10bec5(0xb6));else{if(_0x583397['status']===0x1f4)throw new Error(_0x10bec5(0xb1));}throw new Error(_0x10bec5(0xd5)+_0x583397[_0x10bec5(0xee)]+_0x10bec5(0xec)+_0x11fcd4);}let _0x5c5d2d;try{_0x5c5d2d=JSON[_0x10bec5(0xa7)](_0x11fcd4);}catch(_0x1304d4){console[_0x10bec5(0x101)](_0x10bec5(0xe5),_0x1304d4),loggerService_1['loggerService'][_0x10bec5(0xfa)](_0x10bec5(0xac),'/payment-links',_0x10bec5(0xbd)+_0x1304d4);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x11fcd4);}console['log']('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x10bec5(0xf2)](_0x10bec5(0xa5),JSON[_0x10bec5(0xf4)](_0x5c5d2d,null,0x2)),loggerService_1['loggerService'][_0x10bec5(0x115)](_0x10bec5(0xac),'/payment-links',_0x583397[_0x10bec5(0xee)],_0x5c5d2d,_0x214a74);if(_0x5c5d2d[_0x10bec5(0x101)]||_0x5c5d2d[_0x10bec5(0xb2)]){const _0x1ad109=_0x5c5d2d['message']||_0x5c5d2d[_0x10bec5(0x101)]||_0x10bec5(0xad);console[_0x10bec5(0x101)](_0x10bec5(0xa4)),console['error'](_0x10bec5(0xd2),_0x1ad109),console[_0x10bec5(0x101)](_0x10bec5(0xd1),_0x5c5d2d[_0x10bec5(0xb2)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x10bec5(0xac),_0x10bec5(0xd4),_0x10bec5(0xd3)+_0x1ad109);throw new Error(_0x10bec5(0xe3)+_0x1ad109);}if(!_0x5c5d2d['id']||!_0x5c5d2d[_0x10bec5(0xa8)]?.[_0x10bec5(0x102)]){console[_0x10bec5(0x101)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x10bec5(0x101)](_0x10bec5(0xe1)),console[_0x10bec5(0x101)](_0x10bec5(0xaa),_0x5c5d2d),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x10bec5(0xd4),_0x10bec5(0xde));throw new Error(_0x10bec5(0xdb));}return console[_0x10bec5(0xf2)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x10bec5(0xf2)](_0x10bec5(0xe9),_0x5c5d2d['id']),console[_0x10bec5(0xf2)](_0x10bec5(0xdc),_0x5c5d2d[_0x10bec5(0xa8)][_0x10bec5(0x102)]),console[_0x10bec5(0xf2)](_0x10bec5(0x116),_0x5c5d2d[_0x10bec5(0xa8)][_0x10bec5(0x110)]||_0x10bec5(0xae)),console['log']('Order\x20ID\x20Used:',_0xd3fcf2,_0x10bec5(0xf1)),console[_0x10bec5(0xf2)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x23c85f),{'gateway_payment_id':_0x5c5d2d['id'],'payment_url':_0x5c5d2d[_0x10bec5(0xa8)]['shortLink'],'qr_code_url':_0x5c5d2d[_0x10bec5(0xa8)][_0x10bec5(0x110)],'expiry_date':_0x5c5d2d['expiryDate']};}catch(_0x12a8d8){console[_0x10bec5(0x101)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x10bec5(0x101)](_0x10bec5(0xc3),_0x12a8d8),loggerService_1[_0x10bec5(0x10e)][_0x10bec5(0xfa)]('noda','/payment-links',_0x12a8d8);if(_0x12a8d8 instanceof Error){console['error']('Error\x20message:',_0x12a8d8[_0x10bec5(0xfd)]),console[_0x10bec5(0x101)]('Error\x20stack:',_0x12a8d8[_0x10bec5(0xfb)]);throw new Error(_0x10bec5(0x106)+_0x12a8d8[_0x10bec5(0xfd)]);}throw new Error(_0x10bec5(0xc5));}}async[a43_0x26f17a(0xe2)](_0x1c8969){const _0x13bb61=a43_0x26f17a,_0x31725d=Date[_0x13bb61(0xb8)]();try{loggerService_1[_0x13bb61(0x10e)][_0x13bb61(0xb0)]('noda',_0x13bb61(0x105)+_0x1c8969,'GET',{});const _0x5dbba=await fetch(this[_0x13bb61(0x10b)]+'/'+_0x1c8969,{'method':_0x13bb61(0xdf),'headers':{'Content-Type':_0x13bb61(0xc0),'User-Agent':_0x13bb61(0xe8)}}),_0x23cf36=Date['now']()-_0x31725d;if(!_0x5dbba['ok']){const _0xe01dff=await _0x5dbba[_0x13bb61(0xc4)]();loggerService_1['loggerService'][_0x13bb61(0x115)](_0x13bb61(0xac),_0x13bb61(0x105)+_0x1c8969,_0x5dbba[_0x13bb61(0xee)],_0xe01dff,_0x23cf36);throw new Error(_0x13bb61(0xd5)+_0x5dbba['status']);}const _0x1bab01=await _0x5dbba['json']();loggerService_1[_0x13bb61(0x10e)][_0x13bb61(0x115)](_0x13bb61(0xac),_0x13bb61(0x105)+_0x1c8969,_0x5dbba[_0x13bb61(0xee)],_0x1bab01,_0x23cf36);if(_0x1bab01['error']||_0x1bab01[_0x13bb61(0xb2)]){loggerService_1[_0x13bb61(0x10e)][_0x13bb61(0xfa)](_0x13bb61(0xac),_0x13bb61(0x105)+_0x1c8969,_0x13bb61(0xe3)+(_0x1bab01[_0x13bb61(0xfd)]||_0x1bab01['error']||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x1bab01[_0x13bb61(0xfd)]||_0x1bab01[_0x13bb61(0x101)]||_0x13bb61(0xcc)));}let _0x35edbf=_0x13bb61(0xed);if(_0x1bab01[_0x13bb61(0xc8)]===![]){if(_0x1bab01[_0x13bb61(0xe6)]){const _0x148b55=new Date(_0x1bab01['expiryDate']),_0x94a195=new Date();_0x148b55<_0x94a195?_0x35edbf=_0x13bb61(0xd9):_0x35edbf=_0x13bb61(0x111);}else _0x35edbf=_0x13bb61(0x111);}else _0x35edbf=_0x13bb61(0xed);return{'status':_0x35edbf,'amount':_0x1bab01[_0x13bb61(0xcf)],'currency':_0x1bab01['currency'],'isActive':_0x1bab01[_0x13bb61(0xc8)]};}catch(_0x34816e){console['error'](_0x13bb61(0xc7),_0x34816e),loggerService_1[_0x13bb61(0x10e)]['logWhiteDomainError'](_0x13bb61(0xac),_0x13bb61(0x105)+_0x1c8969,_0x34816e);throw new Error(_0x13bb61(0xd6)+(_0x34816e instanceof Error?_0x34816e[_0x13bb61(0xfd)]:'Unknown\x20error'));}}async[a43_0x26f17a(0x107)](_0x5116c8){const _0x1b0b4b=a43_0x26f17a;console[_0x1b0b4b(0xf2)]('Processing\x20Noda\x20webhook:',_0x5116c8);let _0x4beaaa='PENDING';switch(_0x5116c8[_0x1b0b4b(0xf7)]?.['toLowerCase']()){case _0x1b0b4b(0xcb):case'completed':case _0x1b0b4b(0x103):case'success':case'successful':_0x5116c8['Settled']===_0x1b0b4b(0x113)?_0x4beaaa='PAID':_0x4beaaa=_0x1b0b4b(0xed);break;case _0x1b0b4b(0x10a):case _0x1b0b4b(0x108):case _0x1b0b4b(0xdd):case'error':case _0x1b0b4b(0xc9):_0x4beaaa=_0x1b0b4b(0x111);break;case _0x1b0b4b(0x109):case _0x1b0b4b(0xbf):_0x4beaaa=_0x1b0b4b(0xd9);break;case _0x1b0b4b(0x10d):case _0x1b0b4b(0xa0):case'active':case _0x1b0b4b(0xa9):case _0x1b0b4b(0xab):default:_0x4beaaa=_0x1b0b4b(0xed);break;}return{'paymentId':_0x5116c8[_0x1b0b4b(0xd0)]||_0x5116c8['PaymentId'],'status':_0x4beaaa,'amount':_0x5116c8[_0x1b0b4b(0xc6)],'currency':_0x5116c8[_0x1b0b4b(0xf3)],'additionalInfo':{'method':_0x5116c8[_0x1b0b4b(0xca)],'bankId':_0x5116c8[_0x1b0b4b(0xef)],'settled':_0x5116c8[_0x1b0b4b(0x114)],'settlementDate':_0x5116c8[_0x1b0b4b(0xe4)],'remitterName':_0x5116c8['Remitter']?.[_0x1b0b4b(0xf9)],'remitterIban':_0x5116c8[_0x1b0b4b(0x112)]?.[_0x1b0b4b(0xaf)],'bankTransactionId':_0x5116c8[_0x1b0b4b(0xc2)]}};}[a43_0x26f17a(0xa3)](_0x267e14,_0x3a0ebe){const _0x44f47c=a43_0x26f17a;return console[_0x44f47c(0xf2)](_0x44f47c(0xb4),{'receivedSignature':_0x3a0ebe,'paymentId':_0x267e14[_0x44f47c(0xfe)],'merchantPaymentId':_0x267e14[_0x44f47c(0xd0)]}),!![];}}exports[a43_0x26f17a(0xcd)]=NodaService;