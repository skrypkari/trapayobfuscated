'use strict';const a60_0x594334=a60_0x5f05;function a60_0xdd13(){const _0x4f75ae=['Error\x20message:','fromEntries','Iban','toUpperCase','===\x20PARSED\x20NODA\x20RESPONSE\x20===','active','headers','parse','stack','isActive','Unknown\x20error','canceled','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','/payment-links/','stringify','Order\x20ID\x20Used:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','PaymentId','Not\x20provided','Unknown\x20error\x20from\x20Noda\x20API','Response\x20Body:','qrCodeLink','BankTransactionId','log','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','JSON\x20Parse\x20Error:\x20','533640VVRBRf','apiUrl','BankId','HTTP\x20Status:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','URL:','597504LnmaCO','Settled','defineProperty','logWhiteDomainError','129592JrGQFR','EXPIRED','1388000neuRsZ','completed','toLowerCase','message','statusCode','successful','Status:','error','logWhiteDomainRequest','Payment\x20System/1.0','https://tesoft.uk/gateway/noda/webhook/','Noda\x20payment\x20verification\x20error:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','__esModule','35497XTfWRT','Noda\x20API\x20error:\x20','Response\x20data:','noda','Yes','pending','PENDING','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Response\x20Time:','shortLinkUrls','createPaymentLink','Parsed\x20Result:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','NodaService','Error\x20Message:','===\x20NODA\x20SERVICE\x20ERROR\x20===','FAILED','Amount','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Raw\x20Response\x20Body:','Remitter','HTTP\x20error!\x20status:\x20','verifyWebhookSignature','GET','Status\x20Code:','Status','shortLink','processWebhook','Name','148302xewTCF','(8digits-8digits\x20format\x20for\x20Noda)','5PVwApE','status','application/json','created','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','failed','/payment-links','text','POST','done','rejected','===\x20NODA\x20API\x20ERROR\x20===','logWhiteDomainResponse','MerchantPaymentId','Payment\x20Link\x20ID:','Request\x20Body\x20(Direct\x20JSON):','processing','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','HTTP\x20','Error\x20details:','12VGUtos','(8digits-8digits\x20format)','loggerService','QR\x20Code\x20Link:','timeout','json','../loggerService','in_progress','now','amount','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Noda\x20webhook\x20signature\x20verification:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','2835621mNpAhn','expiryDate','https://tesoft.uk/gateway/pending.php?id='];a60_0xdd13=function(){return _0x4f75ae;};return a60_0xdd13();}(function(_0x5dbed7,_0x36dda8){const _0xdef5ec=a60_0x5f05,_0x574455=_0x5dbed7();while(!![]){try{const _0x44143b=parseInt(_0xdef5ec(0xc7))/0x1+parseInt(_0xdef5ec(0x99))/0x2*(-parseInt(_0xdef5ec(0xdd))/0x3)+-parseInt(_0xdef5ec(0x95))/0x4+parseInt(_0xdef5ec(0xc9))/0x5*(-parseInt(_0xdef5ec(0x8f))/0x6)+parseInt(_0xdef5ec(0xaa))/0x7+parseInt(_0xdef5ec(0x9b))/0x8+parseInt(_0xdef5ec(0xeb))/0x9;if(_0x44143b===_0x36dda8)break;else _0x574455['push'](_0x574455['shift']());}catch(_0x2724e4){_0x574455['push'](_0x574455['shift']());}}}(a60_0xdd13,0x2343a));Object[a60_0x594334(0x97)](exports,a60_0x594334(0xa9),{'value':!![]}),exports[a60_0x594334(0xb7)]=void 0x0;const loggerService_1=require(a60_0x594334(0xe3));function a60_0x5f05(_0x3c9f4c,_0x389e9b){_0x3c9f4c=_0x3c9f4c-0x78;const _0xdd134c=a60_0xdd13();let _0x5f056a=_0xdd134c[_0x3c9f4c];return _0x5f056a;}class NodaService{constructor(){const _0x13bb2b=a60_0x594334;this['apiUrl']='https://tesoft.uk/gateway/noda/',console[_0x13bb2b(0x8c)](_0x13bb2b(0xb1));}async[a60_0x594334(0xb4)](_0x50f3ef){const _0x1a6ef7=a60_0x594334,{orderId:_0x107615,name:_0x4550de,paymentDescription:_0x754d83,amount:_0x2f3543,currency:_0x3df803,webhookUrl:_0x34e18d,returnUrl:_0x31d5a6,expiryDate:_0x524391}=_0x50f3ef,_0x38b9ea=_0x3df803[_0x1a6ef7(0x78)](),_0x4a4d95=_0x1a6ef7(0xa5),_0x4de0db=_0x1a6ef7(0xed)+_0x107615,_0xd689a6={'name':_0x4550de,'paymentDescription':_0x754d83,'amount':_0x2f3543,'currency':_0x38b9ea,'paymentId':_0x107615,'webhookUrl':_0x4a4d95,'returnUrl':_0x4de0db};_0x524391&&(_0xd689a6[_0x1a6ef7(0xec)]=_0x524391);const _0x2a4085=Date['now']();try{console['log'](_0x1a6ef7(0xea)),console[_0x1a6ef7(0x8c)](_0x1a6ef7(0x94),this[_0x1a6ef7(0x90)]),console['log'](_0x1a6ef7(0xd8),JSON[_0x1a6ef7(0x83)](_0xd689a6,null,0x2)),console[_0x1a6ef7(0x8c)]('Order\x20ID\x20Format:',_0x107615,_0x1a6ef7(0xc8)),console[_0x1a6ef7(0x8c)](_0x1a6ef7(0xbc),_0x4de0db),loggerService_1[_0x1a6ef7(0xdf)][_0x1a6ef7(0xa3)](_0x1a6ef7(0xad),'/payment-links',_0x1a6ef7(0xd1),_0xd689a6);const _0x34cdb1=await fetch(this[_0x1a6ef7(0x90)],{'method':'POST','headers':{'Content-Type':_0x1a6ef7(0xcb),'Accept':'application/json','User-Agent':_0x1a6ef7(0xa4)},'body':JSON[_0x1a6ef7(0x83)](_0xd689a6)}),_0x48de73=Date[_0x1a6ef7(0xe5)]()-_0x2a4085;console[_0x1a6ef7(0x8c)](_0x1a6ef7(0x93)),console[_0x1a6ef7(0x8c)](_0x1a6ef7(0xa1),_0x34cdb1[_0x1a6ef7(0xca)]),console['log']('Status\x20Text:',_0x34cdb1['statusText']),console[_0x1a6ef7(0x8c)]('Headers:',Object[_0x1a6ef7(0xef)](_0x34cdb1[_0x1a6ef7(0x7b)]['entries']())),console[_0x1a6ef7(0x8c)](_0x1a6ef7(0xb2),_0x48de73+'ms');const _0xcca134=await _0x34cdb1[_0x1a6ef7(0xd0)]();console['log'](_0x1a6ef7(0xbd),_0xcca134);if(!_0x34cdb1['ok']){console[_0x1a6ef7(0xa2)](_0x1a6ef7(0xd4)),console[_0x1a6ef7(0xa2)](_0x1a6ef7(0x92),_0x34cdb1[_0x1a6ef7(0xca)]),console[_0x1a6ef7(0xa2)](_0x1a6ef7(0x89),_0xcca134),loggerService_1[_0x1a6ef7(0xdf)][_0x1a6ef7(0xd5)](_0x1a6ef7(0xad),_0x1a6ef7(0xcf),_0x34cdb1['status'],_0xcca134,_0x48de73),loggerService_1[_0x1a6ef7(0xdf)][_0x1a6ef7(0x98)]('noda','/payment-links',_0x1a6ef7(0xdb)+_0x34cdb1[_0x1a6ef7(0xca)]+':\x20'+_0xcca134);if(_0x34cdb1[_0x1a6ef7(0xca)]===0x190)throw new Error(_0x1a6ef7(0x85));else{if(_0x34cdb1[_0x1a6ef7(0xca)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x1a6ef7(0xbf)+_0x34cdb1['status']+',\x20body:\x20'+_0xcca134);}let _0x1048aa;try{_0x1048aa=JSON[_0x1a6ef7(0x7c)](_0xcca134);}catch(_0x4d1b20){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x4d1b20),loggerService_1[_0x1a6ef7(0xdf)][_0x1a6ef7(0x98)](_0x1a6ef7(0xad),_0x1a6ef7(0xcf),_0x1a6ef7(0x8e)+_0x4d1b20);throw new Error(_0x1a6ef7(0xe7)+_0xcca134);}console[_0x1a6ef7(0x8c)](_0x1a6ef7(0x79)),console[_0x1a6ef7(0x8c)](_0x1a6ef7(0xb5),JSON[_0x1a6ef7(0x83)](_0x1048aa,null,0x2)),loggerService_1[_0x1a6ef7(0xdf)][_0x1a6ef7(0xd5)]('noda','/payment-links',_0x34cdb1['status'],_0x1048aa,_0x48de73);if(_0x1048aa[_0x1a6ef7(0xa2)]||_0x1048aa[_0x1a6ef7(0x9f)]){const _0x5dd738=_0x1048aa[_0x1a6ef7(0x9e)]||_0x1048aa[_0x1a6ef7(0xa2)]||_0x1a6ef7(0x88);console[_0x1a6ef7(0xa2)](_0x1a6ef7(0x81)),console[_0x1a6ef7(0xa2)](_0x1a6ef7(0xb8),_0x5dd738),console[_0x1a6ef7(0xa2)](_0x1a6ef7(0xc2),_0x1048aa[_0x1a6ef7(0x9f)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x1a6ef7(0xad),_0x1a6ef7(0xcf),'Business\x20Error:\x20'+_0x5dd738);throw new Error(_0x1a6ef7(0xab)+_0x5dd738);}if(!_0x1048aa['id']||!_0x1048aa[_0x1a6ef7(0xb3)]?.[_0x1a6ef7(0xc4)]){console['error'](_0x1a6ef7(0xa7)),console[_0x1a6ef7(0xa2)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x1a6ef7(0xa2)](_0x1a6ef7(0xac),_0x1048aa),loggerService_1[_0x1a6ef7(0xdf)][_0x1a6ef7(0x98)](_0x1a6ef7(0xad),_0x1a6ef7(0xcf),_0x1a6ef7(0x8d));throw new Error(_0x1a6ef7(0xda));}return console[_0x1a6ef7(0x8c)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x1a6ef7(0x8c)](_0x1a6ef7(0xd7),_0x1048aa['id']),console['log']('Short\x20Link:',_0x1048aa[_0x1a6ef7(0xb3)][_0x1a6ef7(0xc4)]),console['log'](_0x1a6ef7(0xe0),_0x1048aa[_0x1a6ef7(0xb3)][_0x1a6ef7(0x8a)]||_0x1a6ef7(0x87)),console[_0x1a6ef7(0x8c)](_0x1a6ef7(0x84),_0x107615,_0x1a6ef7(0xde)),console['log'](_0x1a6ef7(0xa8),_0x4de0db),{'gateway_payment_id':_0x1048aa['id'],'payment_url':_0x1048aa['shortLinkUrls'][_0x1a6ef7(0xc4)],'qr_code_url':_0x1048aa[_0x1a6ef7(0xb3)]['qrCodeLink'],'expiry_date':_0x1048aa['expiryDate']};}catch(_0x132b99){console[_0x1a6ef7(0xa2)](_0x1a6ef7(0xb9)),console[_0x1a6ef7(0xa2)](_0x1a6ef7(0xdc),_0x132b99),loggerService_1[_0x1a6ef7(0xdf)][_0x1a6ef7(0x98)](_0x1a6ef7(0xad),_0x1a6ef7(0xcf),_0x132b99);if(_0x132b99 instanceof Error){console[_0x1a6ef7(0xa2)](_0x1a6ef7(0xee),_0x132b99['message']),console[_0x1a6ef7(0xa2)]('Error\x20stack:',_0x132b99[_0x1a6ef7(0x7d)]);throw new Error(_0x1a6ef7(0xcd)+_0x132b99[_0x1a6ef7(0x9e)]);}throw new Error(_0x1a6ef7(0xb6));}}async['verifyPayment'](_0x54f320){const _0x917876=a60_0x594334,_0x3d21e4=Date[_0x917876(0xe5)]();try{loggerService_1[_0x917876(0xdf)][_0x917876(0xa3)](_0x917876(0xad),_0x917876(0x82)+_0x54f320,_0x917876(0xc1),{});const _0x1a62b5=await fetch(this['apiUrl']+'/'+_0x54f320,{'method':'GET','headers':{'Content-Type':_0x917876(0xcb),'User-Agent':_0x917876(0xa4)}}),_0x5739b3=Date[_0x917876(0xe5)]()-_0x3d21e4;if(!_0x1a62b5['ok']){const _0x747a2=await _0x1a62b5[_0x917876(0xd0)]();loggerService_1[_0x917876(0xdf)]['logWhiteDomainResponse'](_0x917876(0xad),_0x917876(0x82)+_0x54f320,_0x1a62b5[_0x917876(0xca)],_0x747a2,_0x5739b3);throw new Error(_0x917876(0xbf)+_0x1a62b5[_0x917876(0xca)]);}const _0x1ed8e4=await _0x1a62b5[_0x917876(0xe2)]();loggerService_1['loggerService'][_0x917876(0xd5)](_0x917876(0xad),'/payment-links/'+_0x54f320,_0x1a62b5['status'],_0x1ed8e4,_0x5739b3);if(_0x1ed8e4[_0x917876(0xa2)]||_0x1ed8e4['statusCode']){loggerService_1[_0x917876(0xdf)]['logWhiteDomainError'](_0x917876(0xad),_0x917876(0x82)+_0x54f320,_0x917876(0xab)+(_0x1ed8e4[_0x917876(0x9e)]||_0x1ed8e4['error']||'Unknown\x20error'));throw new Error(_0x917876(0xab)+(_0x1ed8e4['message']||_0x1ed8e4[_0x917876(0xa2)]||'Unknown\x20error'));}let _0x49bc22=_0x917876(0xb0);if(_0x1ed8e4['isActive']===![]){if(_0x1ed8e4['expiryDate']){const _0x5cafd5=new Date(_0x1ed8e4[_0x917876(0xec)]),_0x40a8b2=new Date();_0x5cafd5<_0x40a8b2?_0x49bc22=_0x917876(0x9a):_0x49bc22=_0x917876(0xba);}else _0x49bc22='FAILED';}else _0x49bc22='PENDING';return{'status':_0x49bc22,'amount':_0x1ed8e4[_0x917876(0xe6)],'currency':_0x1ed8e4['currency'],'isActive':_0x1ed8e4[_0x917876(0x7e)]};}catch(_0x464777){console['error'](_0x917876(0xa6),_0x464777),loggerService_1[_0x917876(0xdf)][_0x917876(0x98)]('noda',_0x917876(0x82)+_0x54f320,_0x464777);throw new Error(_0x917876(0xe8)+(_0x464777 instanceof Error?_0x464777[_0x917876(0x9e)]:_0x917876(0x7f)));}}async[a60_0x594334(0xc5)](_0x5874a3){const _0x3d0e17=a60_0x594334;console[_0x3d0e17(0x8c)]('Processing\x20Noda\x20webhook:',_0x5874a3);let _0x48de2e=_0x3d0e17(0xb0);switch(_0x5874a3[_0x3d0e17(0xc3)]?.[_0x3d0e17(0x9d)]()){case _0x3d0e17(0xd2):case _0x3d0e17(0x9c):case'paid':case'success':case _0x3d0e17(0xa0):_0x5874a3[_0x3d0e17(0x96)]===_0x3d0e17(0xae)?_0x48de2e='PAID':_0x48de2e=_0x3d0e17(0xb0);break;case'cancelled':case _0x3d0e17(0x80):case _0x3d0e17(0xce):case'error':case _0x3d0e17(0xd3):_0x48de2e=_0x3d0e17(0xba);break;case'expired':case _0x3d0e17(0xe1):_0x48de2e=_0x3d0e17(0x9a);break;case _0x3d0e17(0xaf):case _0x3d0e17(0xcc):case _0x3d0e17(0x7a):case _0x3d0e17(0xd9):case _0x3d0e17(0xe4):default:_0x48de2e='PENDING';break;}return{'paymentId':_0x5874a3['MerchantPaymentId']||_0x5874a3[_0x3d0e17(0x86)],'status':_0x48de2e,'amount':_0x5874a3[_0x3d0e17(0xbb)],'currency':_0x5874a3['Currency'],'additionalInfo':{'method':_0x5874a3['Method'],'bankId':_0x5874a3[_0x3d0e17(0x91)],'settled':_0x5874a3[_0x3d0e17(0x96)],'settlementDate':_0x5874a3['SettlementDate'],'remitterName':_0x5874a3['Remitter']?.[_0x3d0e17(0xc6)],'remitterIban':_0x5874a3[_0x3d0e17(0xbe)]?.[_0x3d0e17(0xf0)],'bankTransactionId':_0x5874a3[_0x3d0e17(0x8b)]}};}[a60_0x594334(0xc0)](_0x5c4cbd,_0x1948bb){const _0x409a27=a60_0x594334;return console[_0x409a27(0x8c)](_0x409a27(0xe9),{'receivedSignature':_0x1948bb,'paymentId':_0x5c4cbd[_0x409a27(0x86)],'merchantPaymentId':_0x5c4cbd[_0x409a27(0xd6)]}),!![];}}exports[a60_0x594334(0xb7)]=NodaService;