'use strict';const a60_0x555b69=a60_0x296a;(function(_0x42f8f8,_0x373fb0){const _0x488a1f=a60_0x296a,_0x348e40=_0x42f8f8();while(!![]){try{const _0xe134bf=-parseInt(_0x488a1f(0xfa))/0x1*(parseInt(_0x488a1f(0x140))/0x2)+-parseInt(_0x488a1f(0x14c))/0x3+-parseInt(_0x488a1f(0x108))/0x4*(-parseInt(_0x488a1f(0x12c))/0x5)+parseInt(_0x488a1f(0xec))/0x6+parseInt(_0x488a1f(0xe5))/0x7+-parseInt(_0x488a1f(0x130))/0x8+parseInt(_0x488a1f(0xf2))/0x9;if(_0xe134bf===_0x373fb0)break;else _0x348e40['push'](_0x348e40['shift']());}catch(_0x3c8f84){_0x348e40['push'](_0x348e40['shift']());}}}(a60_0x1f17,0xdad1d));function a60_0x1f17(){const _0x1b117a=['===\x20NODA\x20SERVICE\x20ERROR\x20===','headers','application/json','/payment-links/','logWhiteDomainResponse','Order\x20ID\x20Format:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','16ybDVKt','toUpperCase','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','now','expiryDate','Not\x20provided','processing','text','logWhiteDomainError','HTTP\x20','/payment-links','PENDING','778518WzbZcp','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','error','json','BankId','active','Response\x20Body:','createPaymentLink','shortLink','GET','PAID','Status\x20Text:','Parsed\x20Result:','canceled','created','5128235KPnzBz','Failed\x20to\x20parse\x20JSON\x20response:','Noda\x20API\x20error:\x20','Payment\x20System/1.0','Noda\x20payment\x20verification\x20error:','PaymentId','Remitter','9032082jTcrPX','BankTransactionId','Status\x20Code:','https://tesoft.uk/gateway/noda/','Short\x20Link:','verifyWebhookSignature','1592577QRlnTE','toLowerCase','===\x20NODA\x20API\x20ERROR\x20===','Raw\x20Response\x20Body:','URL:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Status:','101477ooeKrZ','apiUrl','rejected','Amount','POST','Error\x20stack:','Business\x20Error:\x20','amount','Unknown\x20error\x20from\x20Noda\x20API','HTTP\x20Status:','Order\x20ID\x20Used:','QR\x20Code\x20Link:','verifyPayment','SettlementDate','7232aOAgBe','Error\x20details:','__esModule','processWebhook','Request\x20Body\x20(Direct\x20JSON):','Iban','noda','NodaService','loggerService','failed','cancelled','Noda\x20webhook\x20signature\x20verification:','MerchantPaymentId','logWhiteDomainRequest','HTTP\x20error!\x20status:\x20','(8digits-8digits\x20format\x20for\x20Noda)','Settled','qrCodeLink','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Unknown\x20error','Error\x20Message:','log','Status','stringify','status','Missing\x20id\x20or\x20shortLink\x20in\x20response','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Yes','completed','statusCode','paid','shortLinkUrls','Response\x20data:','Method','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Name','230rPnByp',',\x20body:\x20','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','4243728nlvqDI','FAILED','isActive','https://tesoft.uk/gateway/noda/webhook/','EXPIRED','Error\x20message:','message','fromEntries','Currency'];a60_0x1f17=function(){return _0x1b117a;};return a60_0x1f17();}function a60_0x296a(_0x15c4c1,_0x2df85e){_0x15c4c1=_0x15c4c1-0xdf;const _0x1f17b0=a60_0x1f17();let _0x296a6c=_0x1f17b0[_0x15c4c1];return _0x296a6c;}Object['defineProperty'](exports,a60_0x555b69(0x10a),{'value':!![]}),exports[a60_0x555b69(0x10f)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x22d3f1=a60_0x555b69;this['apiUrl']=_0x22d3f1(0xef),console[_0x22d3f1(0x11d)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a60_0x555b69(0x153)](_0x536b87){const _0x13326d=a60_0x555b69,{orderId:_0x509d26,name:_0x56747f,paymentDescription:_0x45281d,amount:_0x23e824,currency:_0x2fb772,webhookUrl:_0x49fbee,returnUrl:_0x502689,expiryDate:_0x2bb626}=_0x536b87,_0x4f0331=_0x2fb772[_0x13326d(0x141)](),_0x2c0f98=_0x13326d(0x133),_0x48f362='https://tesoft.uk/gateway/pending.php?id='+_0x509d26,_0x218278={'name':_0x56747f,'paymentDescription':_0x45281d,'amount':_0x23e824,'currency':_0x4f0331,'paymentId':_0x509d26,'webhookUrl':_0x2c0f98,'returnUrl':_0x48f362};_0x2bb626&&(_0x218278[_0x13326d(0x144)]=_0x2bb626);const _0x5c98f9=Date[_0x13326d(0x143)]();try{console[_0x13326d(0x11d)](_0x13326d(0x12a)),console[_0x13326d(0x11d)](_0x13326d(0xf6),this[_0x13326d(0xfb)]),console[_0x13326d(0x11d)](_0x13326d(0x10c),JSON[_0x13326d(0x11f)](_0x218278,null,0x2)),console['log'](_0x13326d(0x13e),_0x509d26,_0x13326d(0x117)),console['log'](_0x13326d(0xf7),_0x48f362),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x13326d(0x10e),_0x13326d(0x14a),_0x13326d(0xfe),_0x218278);const _0x26ffb0=await fetch(this[_0x13326d(0xfb)],{'method':_0x13326d(0xfe),'headers':{'Content-Type':_0x13326d(0x13b),'Accept':_0x13326d(0x13b),'User-Agent':_0x13326d(0xe8)},'body':JSON['stringify'](_0x218278)}),_0x200974=Date[_0x13326d(0x143)]()-_0x5c98f9;console[_0x13326d(0x11d)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x13326d(0x11d)](_0x13326d(0xf9),_0x26ffb0[_0x13326d(0x120)]),console[_0x13326d(0x11d)](_0x13326d(0xe1),_0x26ffb0['statusText']),console[_0x13326d(0x11d)]('Headers:',Object[_0x13326d(0x137)](_0x26ffb0[_0x13326d(0x13a)]['entries']())),console[_0x13326d(0x11d)]('Response\x20Time:',_0x200974+'ms');const _0x454f07=await _0x26ffb0[_0x13326d(0x147)]();console[_0x13326d(0x11d)](_0x13326d(0xf5),_0x454f07);if(!_0x26ffb0['ok']){console[_0x13326d(0x14e)](_0x13326d(0xf4)),console[_0x13326d(0x14e)](_0x13326d(0x103),_0x26ffb0[_0x13326d(0x120)]),console[_0x13326d(0x14e)](_0x13326d(0x152),_0x454f07),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x13326d(0x10e),_0x13326d(0x14a),_0x26ffb0['status'],_0x454f07,_0x200974),loggerService_1[_0x13326d(0x110)][_0x13326d(0x148)]('noda','/payment-links',_0x13326d(0x149)+_0x26ffb0[_0x13326d(0x120)]+':\x20'+_0x454f07);if(_0x26ffb0['status']===0x190)throw new Error(_0x13326d(0x13f));else{if(_0x26ffb0[_0x13326d(0x120)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x13326d(0x116)+_0x26ffb0[_0x13326d(0x120)]+_0x13326d(0x12d)+_0x454f07);}let _0x416e2b;try{_0x416e2b=JSON['parse'](_0x454f07);}catch(_0x3af8eb){console[_0x13326d(0x14e)](_0x13326d(0xe6),_0x3af8eb),loggerService_1[_0x13326d(0x110)][_0x13326d(0x148)](_0x13326d(0x10e),_0x13326d(0x14a),'JSON\x20Parse\x20Error:\x20'+_0x3af8eb);throw new Error(_0x13326d(0x11a)+_0x454f07);}console[_0x13326d(0x11d)](_0x13326d(0xf8)),console[_0x13326d(0x11d)](_0x13326d(0xe2),JSON[_0x13326d(0x11f)](_0x416e2b,null,0x2)),loggerService_1[_0x13326d(0x110)][_0x13326d(0x13d)](_0x13326d(0x10e),_0x13326d(0x14a),_0x26ffb0[_0x13326d(0x120)],_0x416e2b,_0x200974);if(_0x416e2b[_0x13326d(0x14e)]||_0x416e2b[_0x13326d(0x125)]){const _0x42f970=_0x416e2b[_0x13326d(0x136)]||_0x416e2b[_0x13326d(0x14e)]||_0x13326d(0x102);console['error'](_0x13326d(0x142)),console[_0x13326d(0x14e)](_0x13326d(0x11c),_0x42f970),console['error'](_0x13326d(0xee),_0x416e2b[_0x13326d(0x125)]),loggerService_1[_0x13326d(0x110)][_0x13326d(0x148)](_0x13326d(0x10e),_0x13326d(0x14a),_0x13326d(0x100)+_0x42f970);throw new Error(_0x13326d(0xe7)+_0x42f970);}if(!_0x416e2b['id']||!_0x416e2b[_0x13326d(0x127)]?.[_0x13326d(0x154)]){console[_0x13326d(0x14e)](_0x13326d(0x12e)),console[_0x13326d(0x14e)](_0x13326d(0x121)),console[_0x13326d(0x14e)](_0x13326d(0x128),_0x416e2b),loggerService_1['loggerService'][_0x13326d(0x148)](_0x13326d(0x10e),_0x13326d(0x14a),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x13326d(0x11d)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x13326d(0x11d)]('Payment\x20Link\x20ID:',_0x416e2b['id']),console[_0x13326d(0x11d)](_0x13326d(0xf0),_0x416e2b['shortLinkUrls'][_0x13326d(0x154)]),console[_0x13326d(0x11d)](_0x13326d(0x105),_0x416e2b[_0x13326d(0x127)]['qrCodeLink']||_0x13326d(0x145)),console[_0x13326d(0x11d)](_0x13326d(0x104),_0x509d26,'(8digits-8digits\x20format)'),console[_0x13326d(0x11d)](_0x13326d(0x122),_0x48f362),{'gateway_payment_id':_0x416e2b['id'],'payment_url':_0x416e2b['shortLinkUrls'][_0x13326d(0x154)],'qr_code_url':_0x416e2b[_0x13326d(0x127)][_0x13326d(0x119)],'expiry_date':_0x416e2b[_0x13326d(0x144)]};}catch(_0x17a85d){console[_0x13326d(0x14e)](_0x13326d(0x139)),console['error'](_0x13326d(0x109),_0x17a85d),loggerService_1[_0x13326d(0x110)][_0x13326d(0x148)]('noda',_0x13326d(0x14a),_0x17a85d);if(_0x17a85d instanceof Error){console[_0x13326d(0x14e)](_0x13326d(0x135),_0x17a85d[_0x13326d(0x136)]),console['error'](_0x13326d(0xff),_0x17a85d['stack']);throw new Error(_0x13326d(0x12f)+_0x17a85d[_0x13326d(0x136)]);}throw new Error(_0x13326d(0x14d));}}async[a60_0x555b69(0x106)](_0x51e7ba){const _0x36e0b3=a60_0x555b69,_0x54641c=Date['now']();try{loggerService_1[_0x36e0b3(0x110)][_0x36e0b3(0x115)]('noda',_0x36e0b3(0x13c)+_0x51e7ba,_0x36e0b3(0xdf),{});const _0x30dd4c=await fetch(this[_0x36e0b3(0xfb)]+'/'+_0x51e7ba,{'method':_0x36e0b3(0xdf),'headers':{'Content-Type':_0x36e0b3(0x13b),'User-Agent':_0x36e0b3(0xe8)}}),_0x378408=Date[_0x36e0b3(0x143)]()-_0x54641c;if(!_0x30dd4c['ok']){const _0x5a6c36=await _0x30dd4c[_0x36e0b3(0x147)]();loggerService_1[_0x36e0b3(0x110)]['logWhiteDomainResponse'](_0x36e0b3(0x10e),'/payment-links/'+_0x51e7ba,_0x30dd4c['status'],_0x5a6c36,_0x378408);throw new Error('HTTP\x20error!\x20status:\x20'+_0x30dd4c[_0x36e0b3(0x120)]);}const _0x1043c7=await _0x30dd4c[_0x36e0b3(0x14f)]();loggerService_1[_0x36e0b3(0x110)]['logWhiteDomainResponse'](_0x36e0b3(0x10e),_0x36e0b3(0x13c)+_0x51e7ba,_0x30dd4c[_0x36e0b3(0x120)],_0x1043c7,_0x378408);if(_0x1043c7[_0x36e0b3(0x14e)]||_0x1043c7[_0x36e0b3(0x125)]){loggerService_1[_0x36e0b3(0x110)][_0x36e0b3(0x148)]('noda',_0x36e0b3(0x13c)+_0x51e7ba,_0x36e0b3(0xe7)+(_0x1043c7[_0x36e0b3(0x136)]||_0x1043c7[_0x36e0b3(0x14e)]||_0x36e0b3(0x11b)));throw new Error('Noda\x20API\x20error:\x20'+(_0x1043c7[_0x36e0b3(0x136)]||_0x1043c7['error']||_0x36e0b3(0x11b)));}let _0x1b4186=_0x36e0b3(0x14b);if(_0x1043c7['isActive']===![]){if(_0x1043c7[_0x36e0b3(0x144)]){const _0x5b52de=new Date(_0x1043c7[_0x36e0b3(0x144)]),_0x330955=new Date();_0x5b52de<_0x330955?_0x1b4186=_0x36e0b3(0x134):_0x1b4186=_0x36e0b3(0x131);}else _0x1b4186=_0x36e0b3(0x131);}else _0x1b4186='PENDING';return{'status':_0x1b4186,'amount':_0x1043c7[_0x36e0b3(0x101)],'currency':_0x1043c7['currency'],'isActive':_0x1043c7[_0x36e0b3(0x132)]};}catch(_0x475b7e){console[_0x36e0b3(0x14e)](_0x36e0b3(0xe9),_0x475b7e),loggerService_1['loggerService'][_0x36e0b3(0x148)](_0x36e0b3(0x10e),_0x36e0b3(0x13c)+_0x51e7ba,_0x475b7e);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x475b7e instanceof Error?_0x475b7e[_0x36e0b3(0x136)]:_0x36e0b3(0x11b)));}}async[a60_0x555b69(0x10b)](_0x544287){const _0x51b5b3=a60_0x555b69;console[_0x51b5b3(0x11d)]('Processing\x20Noda\x20webhook:',_0x544287);let _0x193d99=_0x51b5b3(0x14b);switch(_0x544287[_0x51b5b3(0x11e)]?.[_0x51b5b3(0xf3)]()){case'done':case _0x51b5b3(0x124):case _0x51b5b3(0x126):case'success':case'successful':_0x544287[_0x51b5b3(0x118)]===_0x51b5b3(0x123)?_0x193d99=_0x51b5b3(0xe0):_0x193d99=_0x51b5b3(0x14b);break;case _0x51b5b3(0x112):case _0x51b5b3(0xe3):case _0x51b5b3(0x111):case _0x51b5b3(0x14e):case _0x51b5b3(0xfc):_0x193d99='FAILED';break;case'expired':case'timeout':_0x193d99=_0x51b5b3(0x134);break;case'pending':case _0x51b5b3(0xe4):case _0x51b5b3(0x151):case _0x51b5b3(0x146):case'in_progress':default:_0x193d99=_0x51b5b3(0x14b);break;}return{'paymentId':_0x544287[_0x51b5b3(0x114)]||_0x544287[_0x51b5b3(0xea)],'status':_0x193d99,'amount':_0x544287[_0x51b5b3(0xfd)],'currency':_0x544287[_0x51b5b3(0x138)],'additionalInfo':{'method':_0x544287[_0x51b5b3(0x129)],'bankId':_0x544287[_0x51b5b3(0x150)],'settled':_0x544287[_0x51b5b3(0x118)],'settlementDate':_0x544287[_0x51b5b3(0x107)],'remitterName':_0x544287[_0x51b5b3(0xeb)]?.[_0x51b5b3(0x12b)],'remitterIban':_0x544287['Remitter']?.[_0x51b5b3(0x10d)],'bankTransactionId':_0x544287[_0x51b5b3(0xed)]}};}[a60_0x555b69(0xf1)](_0x46d6cb,_0x447aee){const _0x13f18a=a60_0x555b69;return console['log'](_0x13f18a(0x113),{'receivedSignature':_0x447aee,'paymentId':_0x46d6cb[_0x13f18a(0xea)],'merchantPaymentId':_0x46d6cb[_0x13f18a(0x114)]}),!![];}}exports['NodaService']=NodaService;