'use strict';function a43_0x2dc8(_0x13aa12,_0x536bbf){const _0x230f44=a43_0x230f();return a43_0x2dc8=function(_0x2dc825,_0x4d4921){_0x2dc825=_0x2dc825-0x6a;let _0x5a5493=_0x230f44[_0x2dc825];return _0x5a5493;},a43_0x2dc8(_0x13aa12,_0x536bbf);}const a43_0x3dc412=a43_0x2dc8;(function(_0xc63535,_0x39eb35){const _0x108606=a43_0x2dc8,_0x3d1978=_0xc63535();while(!![]){try{const _0x2dde13=-parseInt(_0x108606(0xa6))/0x1+parseInt(_0x108606(0x99))/0x2+-parseInt(_0x108606(0x85))/0x3*(-parseInt(_0x108606(0x88))/0x4)+parseInt(_0x108606(0x91))/0x5+parseInt(_0x108606(0x9f))/0x6*(-parseInt(_0x108606(0xb3))/0x7)+-parseInt(_0x108606(0x7a))/0x8+-parseInt(_0x108606(0xca))/0x9;if(_0x2dde13===_0x39eb35)break;else _0x3d1978['push'](_0x3d1978['shift']());}catch(_0x14b5cd){_0x3d1978['push'](_0x3d1978['shift']());}}}(a43_0x230f,0xb11de));Object[a43_0x3dc412(0x6a)](exports,a43_0x3dc412(0xcf),{'value':!![]}),exports[a43_0x3dc412(0x95)]=void 0x0;const loggerService_1=require(a43_0x3dc412(0x71));function a43_0x230f(){const _0x10d4e5=['expired','__esModule','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20details:','HTTP\x20error!\x20status:\x20','Amount','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Parsed\x20Result:','Payment\x20Link\x20ID:','BankTransactionId','active','Response\x20Time:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','canceled','TesSoft\x20Payment\x20System/1.0','(8digits-8digits\x20format)','processing','https://tesoft.uk/gateway/noda/','MerchantPaymentId','entries','pending','Response\x20data:','GET','Noda\x20API\x20error:\x20','defineProperty','Status:','isActive','toUpperCase','Error\x20message:','status','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','../loggerService','log','shortLink','Failed\x20to\x20verify\x20Noda\x20payment:\x20','===\x20NODA\x20API\x20ERROR\x20===','Name','json','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Response\x20Body:','4865784WXNfYf','currency','Status\x20Text:','Unknown\x20error\x20from\x20Noda\x20API','successful','/payment-links','HTTP\x20','Iban','Request\x20Body\x20(Direct\x20JSON):','PENDING','noda','2277mlOtvD','apiUrl','stringify','7404ucZuzt','verifyWebhookSignature','statusCode','Remitter','qrCodeLink','Unknown\x20error','HTTP\x20Status:','error','shortLinkUrls','51190DXOfQU','verifyPayment','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainRequest','NodaService','in_progress','QR\x20Code\x20Link:','Noda\x20payment\x20verification\x20error:','2833170lcgYJR','message','created','Error\x20Message:','===\x20NODA\x20SUCCESS\x20===','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','444174KizuOK','Status','Not\x20provided','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Order\x20ID\x20Used:','logWhiteDomainError','Settled','230550KxKZum','processWebhook','JSON\x20Parse\x20Error:\x20','Raw\x20Response\x20Body:','https://tesoft.uk/gateway/pending.php?id=','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Short\x20Link:','expiryDate','https://tesoft.uk/gateway/noda/webhook/','PaymentId','text','rejected','EXPIRED','14zbrfUq','logWhiteDomainResponse','createPaymentLink','Order\x20ID\x20Format:','stack','Status\x20Code:','completed',',\x20body:\x20','===\x20NODA\x20SERVICE\x20ERROR\x20===','done','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','PAID','/payment-links/','application/json','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Business\x20Error:\x20','failed','loggerService','URL:','FAILED','amount','Processing\x20Noda\x20webhook:','10074879TUmLBL','now','statusText','paid'];a43_0x230f=function(){return _0x10d4e5;};return a43_0x230f();}class NodaService{constructor(){const _0x1df051=a43_0x3dc412;this[_0x1df051(0x86)]=_0x1df051(0xdf),console[_0x1df051(0x72)](_0x1df051(0x78));}async[a43_0x3dc412(0xb5)](_0xcf1047){const _0x34dbe5=a43_0x3dc412,{orderId:_0x3b42d1,name:_0x2a4439,paymentDescription:_0x18daf7,amount:_0x5d5ab2,currency:_0x39a2ff,webhookUrl:_0x168ed5,returnUrl:_0x25512a,expiryDate:_0x149db0}=_0xcf1047,_0x13ee0f=_0x39a2ff[_0x34dbe5(0x6d)](),_0xe9e30=_0x34dbe5(0xae),_0x52aa10=_0x34dbe5(0xaa)+_0x3b42d1,_0x4df716={'name':_0x2a4439,'paymentDescription':_0x18daf7,'amount':_0x5d5ab2,'currency':_0x13ee0f,'paymentId':_0x3b42d1,'webhookUrl':_0xe9e30,'returnUrl':_0x52aa10};_0x149db0&&(_0x4df716['expiryDate']=_0x149db0);const _0x24304e=Date[_0x34dbe5(0xcb)]();try{console[_0x34dbe5(0x72)](_0x34dbe5(0xc2)),console['log'](_0x34dbe5(0xc6),this[_0x34dbe5(0x86)]),console['log'](_0x34dbe5(0x82),JSON[_0x34dbe5(0x87)](_0x4df716,null,0x2)),console['log'](_0x34dbe5(0xb6),_0x3b42d1,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x34dbe5(0x72)](_0x34dbe5(0xd4),_0x52aa10),loggerService_1[_0x34dbe5(0xc5)][_0x34dbe5(0x94)](_0x34dbe5(0x84),_0x34dbe5(0x7f),'POST',_0x4df716);const _0x4c9d3d=await fetch(this[_0x34dbe5(0x86)],{'method':'POST','headers':{'Content-Type':_0x34dbe5(0xc1),'Accept':_0x34dbe5(0xc1),'User-Agent':_0x34dbe5(0xdc)},'body':JSON['stringify'](_0x4df716)}),_0x554ee3=Date[_0x34dbe5(0xcb)]()-_0x24304e;console[_0x34dbe5(0x72)](_0x34dbe5(0x93)),console['log'](_0x34dbe5(0x6b),_0x4c9d3d[_0x34dbe5(0x6f)]),console[_0x34dbe5(0x72)](_0x34dbe5(0x7c),_0x4c9d3d[_0x34dbe5(0xcc)]),console[_0x34dbe5(0x72)]('Headers:',Object['fromEntries'](_0x4c9d3d['headers'][_0x34dbe5(0xe1)]())),console[_0x34dbe5(0x72)](_0x34dbe5(0xd9),_0x554ee3+'ms');const _0x9e7ce6=await _0x4c9d3d[_0x34dbe5(0xb0)]();console[_0x34dbe5(0x72)](_0x34dbe5(0xa9),_0x9e7ce6);if(!_0x4c9d3d['ok']){console[_0x34dbe5(0x8f)](_0x34dbe5(0x75)),console[_0x34dbe5(0x8f)](_0x34dbe5(0x8e),_0x4c9d3d['status']),console['error'](_0x34dbe5(0x79),_0x9e7ce6),loggerService_1['loggerService'][_0x34dbe5(0xb4)](_0x34dbe5(0x84),_0x34dbe5(0x7f),_0x4c9d3d['status'],_0x9e7ce6,_0x554ee3),loggerService_1[_0x34dbe5(0xc5)][_0x34dbe5(0xa4)](_0x34dbe5(0x84),_0x34dbe5(0x7f),_0x34dbe5(0x80)+_0x4c9d3d[_0x34dbe5(0x6f)]+':\x20'+_0x9e7ce6);if(_0x4c9d3d['status']===0x190)throw new Error(_0x34dbe5(0x9e));else{if(_0x4c9d3d[_0x34dbe5(0x6f)]===0x1f4)throw new Error(_0x34dbe5(0xda));}throw new Error(_0x34dbe5(0xd2)+_0x4c9d3d[_0x34dbe5(0x6f)]+_0x34dbe5(0xba)+_0x9e7ce6);}let _0x551483;try{_0x551483=JSON['parse'](_0x9e7ce6);}catch(_0xd0bf0){console[_0x34dbe5(0x8f)]('Failed\x20to\x20parse\x20JSON\x20response:',_0xd0bf0),loggerService_1[_0x34dbe5(0xc5)]['logWhiteDomainError'](_0x34dbe5(0x84),_0x34dbe5(0x7f),_0x34dbe5(0xa8)+_0xd0bf0);throw new Error(_0x34dbe5(0xbe)+_0x9e7ce6);}console[_0x34dbe5(0x72)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console['log'](_0x34dbe5(0xd5),JSON[_0x34dbe5(0x87)](_0x551483,null,0x2)),loggerService_1[_0x34dbe5(0xc5)][_0x34dbe5(0xb4)](_0x34dbe5(0x84),_0x34dbe5(0x7f),_0x4c9d3d['status'],_0x551483,_0x554ee3);if(_0x551483['error']||_0x551483[_0x34dbe5(0x8a)]){const _0x55b1bd=_0x551483[_0x34dbe5(0x9a)]||_0x551483[_0x34dbe5(0x8f)]||_0x34dbe5(0x7d);console[_0x34dbe5(0x8f)](_0x34dbe5(0x70)),console[_0x34dbe5(0x8f)](_0x34dbe5(0x9c),_0x55b1bd),console['error'](_0x34dbe5(0xb8),_0x551483[_0x34dbe5(0x8a)]),loggerService_1[_0x34dbe5(0xc5)][_0x34dbe5(0xa4)](_0x34dbe5(0x84),_0x34dbe5(0x7f),_0x34dbe5(0xc3)+_0x55b1bd);throw new Error('Noda\x20API\x20error:\x20'+_0x55b1bd);}if(!_0x551483['id']||!_0x551483[_0x34dbe5(0x90)]?.[_0x34dbe5(0x73)]){console[_0x34dbe5(0x8f)](_0x34dbe5(0xd0)),console['error']('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x34dbe5(0x8f)](_0x34dbe5(0xe3),_0x551483),loggerService_1[_0x34dbe5(0xc5)][_0x34dbe5(0xa4)](_0x34dbe5(0x84),'/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x34dbe5(0xab));}return console[_0x34dbe5(0x72)](_0x34dbe5(0x9d)),console['log'](_0x34dbe5(0xd6),_0x551483['id']),console[_0x34dbe5(0x72)](_0x34dbe5(0xac),_0x551483[_0x34dbe5(0x90)][_0x34dbe5(0x73)]),console[_0x34dbe5(0x72)](_0x34dbe5(0x97),_0x551483[_0x34dbe5(0x90)][_0x34dbe5(0x8c)]||_0x34dbe5(0xa1)),console['log'](_0x34dbe5(0xa3),_0x3b42d1,_0x34dbe5(0xdd)),console['log']('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x52aa10),{'gateway_payment_id':_0x551483['id'],'payment_url':_0x551483[_0x34dbe5(0x90)][_0x34dbe5(0x73)],'qr_code_url':_0x551483['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x551483['expiryDate']};}catch(_0x2b9345){console['error'](_0x34dbe5(0xbb)),console[_0x34dbe5(0x8f)](_0x34dbe5(0xd1),_0x2b9345),loggerService_1[_0x34dbe5(0xc5)][_0x34dbe5(0xa4)](_0x34dbe5(0x84),'/payment-links',_0x2b9345);if(_0x2b9345 instanceof Error){console[_0x34dbe5(0x8f)](_0x34dbe5(0x6e),_0x2b9345[_0x34dbe5(0x9a)]),console['error']('Error\x20stack:',_0x2b9345[_0x34dbe5(0xb7)]);throw new Error(_0x34dbe5(0xbd)+_0x2b9345['message']);}throw new Error(_0x34dbe5(0xa2));}}async[a43_0x3dc412(0x92)](_0x537130){const _0xad8b11=a43_0x3dc412,_0x15db80=Date['now']();try{loggerService_1[_0xad8b11(0xc5)]['logWhiteDomainRequest'](_0xad8b11(0x84),_0xad8b11(0xc0)+_0x537130,_0xad8b11(0xe4),{});const _0x464d10=await fetch(this[_0xad8b11(0x86)]+'/'+_0x537130,{'method':'GET','headers':{'Content-Type':_0xad8b11(0xc1),'User-Agent':_0xad8b11(0xdc)}}),_0x25e6ab=Date[_0xad8b11(0xcb)]()-_0x15db80;if(!_0x464d10['ok']){const _0x26c8b=await _0x464d10[_0xad8b11(0xb0)]();loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0xad8b11(0xc0)+_0x537130,_0x464d10[_0xad8b11(0x6f)],_0x26c8b,_0x25e6ab);throw new Error(_0xad8b11(0xd2)+_0x464d10[_0xad8b11(0x6f)]);}const _0x566911=await _0x464d10[_0xad8b11(0x77)]();loggerService_1[_0xad8b11(0xc5)][_0xad8b11(0xb4)](_0xad8b11(0x84),_0xad8b11(0xc0)+_0x537130,_0x464d10[_0xad8b11(0x6f)],_0x566911,_0x25e6ab);if(_0x566911[_0xad8b11(0x8f)]||_0x566911['statusCode']){loggerService_1[_0xad8b11(0xc5)][_0xad8b11(0xa4)](_0xad8b11(0x84),_0xad8b11(0xc0)+_0x537130,'Noda\x20API\x20error:\x20'+(_0x566911[_0xad8b11(0x9a)]||_0x566911[_0xad8b11(0x8f)]||_0xad8b11(0x8d)));throw new Error(_0xad8b11(0xe5)+(_0x566911[_0xad8b11(0x9a)]||_0x566911['error']||_0xad8b11(0x8d)));}let _0x1ea194='PENDING';if(_0x566911[_0xad8b11(0x6c)]===![]){if(_0x566911[_0xad8b11(0xad)]){const _0x19037c=new Date(_0x566911['expiryDate']),_0x65d635=new Date();_0x19037c<_0x65d635?_0x1ea194=_0xad8b11(0xb2):_0x1ea194=_0xad8b11(0xc7);}else _0x1ea194=_0xad8b11(0xc7);}else _0x1ea194=_0xad8b11(0x83);return{'status':_0x1ea194,'amount':_0x566911[_0xad8b11(0xc8)],'currency':_0x566911[_0xad8b11(0x7b)],'isActive':_0x566911[_0xad8b11(0x6c)]};}catch(_0x659f53){console['error'](_0xad8b11(0x98),_0x659f53),loggerService_1[_0xad8b11(0xc5)]['logWhiteDomainError'](_0xad8b11(0x84),'/payment-links/'+_0x537130,_0x659f53);throw new Error(_0xad8b11(0x74)+(_0x659f53 instanceof Error?_0x659f53[_0xad8b11(0x9a)]:_0xad8b11(0x8d)));}}async[a43_0x3dc412(0xa7)](_0x570fed){const _0x31319a=a43_0x3dc412;console[_0x31319a(0x72)](_0x31319a(0xc9),_0x570fed);let _0x47bf15=_0x31319a(0x83);switch(_0x570fed[_0x31319a(0xa0)]?.['toLowerCase']()){case _0x31319a(0xbc):case _0x31319a(0xb9):case _0x31319a(0xcd):case'success':case _0x31319a(0x7e):_0x570fed['Settled']==='Yes'?_0x47bf15=_0x31319a(0xbf):_0x47bf15=_0x31319a(0x83);break;case'cancelled':case _0x31319a(0xdb):case _0x31319a(0xc4):case _0x31319a(0x8f):case _0x31319a(0xb1):_0x47bf15=_0x31319a(0xc7);break;case _0x31319a(0xce):case'timeout':_0x47bf15='EXPIRED';break;case _0x31319a(0xe2):case _0x31319a(0x9b):case _0x31319a(0xd8):case _0x31319a(0xde):case _0x31319a(0x96):default:_0x47bf15=_0x31319a(0x83);break;}return{'paymentId':_0x570fed[_0x31319a(0xe0)]||_0x570fed['PaymentId'],'status':_0x47bf15,'amount':_0x570fed[_0x31319a(0xd3)],'currency':_0x570fed['Currency'],'additionalInfo':{'method':_0x570fed['Method'],'bankId':_0x570fed['BankId'],'settled':_0x570fed[_0x31319a(0xa5)],'settlementDate':_0x570fed['SettlementDate'],'remitterName':_0x570fed[_0x31319a(0x8b)]?.[_0x31319a(0x76)],'remitterIban':_0x570fed[_0x31319a(0x8b)]?.[_0x31319a(0x81)],'bankTransactionId':_0x570fed[_0x31319a(0xd7)]}};}[a43_0x3dc412(0x89)](_0x434797,_0x667039){const _0x47326b=a43_0x3dc412;return console[_0x47326b(0x72)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x667039,'paymentId':_0x434797[_0x47326b(0xaf)],'merchantPaymentId':_0x434797[_0x47326b(0xe0)]}),!![];}}exports['NodaService']=NodaService;