'use strict';function a48_0x4df6(){const _0x3afa42=['Noda\x20API\x20error:\x20','HTTP\x20error!\x20status:\x20','text','918354OAiIUQ','9812887gpNhub','12eRFOst','qrCodeLink','Not\x20provided','statusText','Error\x20details:','status','HTTP\x20','toUpperCase','https://tesoft.uk/gateway/noda/webhook/','https://tesoft.uk/gateway/pending.php?id=','===\x20NODA\x20API\x20ERROR\x20===','logWhiteDomainResponse','noda','loggerService','Yes','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','/payment-links/','BankId','(8digits-8digits\x20format)','stringify','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','PENDING','message','Headers:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','18807019VtzxOD','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status','Response\x20Time:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','statusCode','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','processing','cancelled','pending','defineProperty','logWhiteDomainRequest','FAILED','Amount','Response\x20Body:','3354270cfdvpM','verifyPayment','Unknown\x20error','Processing\x20Noda\x20webhook:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','POST','success','NodaService','BankTransactionId','1197664jYxCnF','expired','failed','Noda\x20payment\x20verification\x20error:','Noda\x20webhook\x20signature\x20verification:','https://tesoft.uk/gateway/noda/','Settled','Error\x20Message:','logWhiteDomainError','996162AOwSpc','Remitter','headers','toLowerCase','TesSoft\x20Payment\x20System/1.0','processWebhook','===\x20NODA\x20SERVICE\x20ERROR\x20===','shortLink','shortLinkUrls','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','../loggerService','PaymentId','verifyWebhookSignature','1aKXVxw','apiUrl','application/json','successful','PAID','Error\x20stack:','Raw\x20Response\x20Body:','HTTP\x20Status:','rejected','EXPIRED','Missing\x20id\x20or\x20shortLink\x20in\x20response','Order\x20ID\x20Format:','Error\x20message:','active','(8digits-8digits\x20format\x20for\x20Noda)','GET','stack','in_progress','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Payment\x20Link\x20ID:','created','Short\x20Link:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','1053099qOWmws','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','56MZNFKv','now','Status\x20Text:','createPaymentLink','error','MerchantPaymentId','/payment-links','15YqrXkG','Iban','Request\x20Body\x20(Direct\x20JSON):','isActive','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','__esModule','Failed\x20to\x20verify\x20Noda\x20payment:\x20','paid','expiryDate','Business\x20Error:\x20','Status:','SettlementDate','Status\x20Code:','canceled','===\x20NODA\x20SUCCESS\x20===','log','done'];a48_0x4df6=function(){return _0x3afa42;};return a48_0x4df6();}const a48_0x314462=a48_0x6bb1;(function(_0x2a3cde,_0x47725d){const _0x1007ac=a48_0x6bb1,_0x48276b=_0x2a3cde();while(!![]){try{const _0x892694=parseInt(_0x1007ac(0x103))/0x1*(-parseInt(_0x1007ac(0xf6))/0x2)+parseInt(_0x1007ac(0xbb))/0x3*(-parseInt(_0x1007ac(0xed))/0x4)+-parseInt(_0x1007ac(0xa5))/0x5*(-parseInt(_0x1007ac(0xb9))/0x6)+parseInt(_0x1007ac(0xba))/0x7+parseInt(_0x1007ac(0x9e))/0x8*(-parseInt(_0x1007ac(0x9c))/0x9)+-parseInt(_0x1007ac(0xe4))/0xa+parseInt(_0x1007ac(0xd5))/0xb;if(_0x892694===_0x47725d)break;else _0x48276b['push'](_0x48276b['shift']());}catch(_0x4fec97){_0x48276b['push'](_0x48276b['shift']());}}}(a48_0x4df6,0xafe72));Object[a48_0x314462(0xdf)](exports,a48_0x314462(0xaa),{'value':!![]}),exports[a48_0x314462(0xeb)]=void 0x0;function a48_0x6bb1(_0x3fd8c3,_0x43e568){const _0x4df6c1=a48_0x4df6();return a48_0x6bb1=function(_0x6bb1f5,_0x4d43a6){_0x6bb1f5=_0x6bb1f5-0x95;let _0x10619a=_0x4df6c1[_0x6bb1f5];return _0x10619a;},a48_0x6bb1(_0x3fd8c3,_0x43e568);}const loggerService_1=require(a48_0x314462(0x100));class NodaService{constructor(){const _0x10b4d2=a48_0x314462;this[_0x10b4d2(0x104)]=_0x10b4d2(0xf2),console['log'](_0x10b4d2(0xd4));}async[a48_0x314462(0xa1)](_0x44d65c){const _0x5f3df7=a48_0x314462,{orderId:_0x77f817,name:_0xf42a53,paymentDescription:_0x49fdbd,amount:_0x679f4c,currency:_0x2eeab4,webhookUrl:_0x3d0996,returnUrl:_0x5de53f,expiryDate:_0x3a79b8}=_0x44d65c,_0x3112f3=_0x2eeab4[_0x5f3df7(0xc2)](),_0x583dd3=_0x5f3df7(0xc3),_0xf2058f=_0x5f3df7(0xc4)+_0x77f817,_0x110aa5={'name':_0xf42a53,'paymentDescription':_0x49fdbd,'amount':_0x679f4c,'currency':_0x3112f3,'paymentId':_0x77f817,'webhookUrl':_0x583dd3,'returnUrl':_0xf2058f};_0x3a79b8&&(_0x110aa5[_0x5f3df7(0xad)]=_0x3a79b8);const _0x2f5fce=Date[_0x5f3df7(0x9f)]();try{console[_0x5f3df7(0xb4)](_0x5f3df7(0xff)),console[_0x5f3df7(0xb4)]('URL:',this[_0x5f3df7(0x104)]),console['log'](_0x5f3df7(0xa7),JSON[_0x5f3df7(0xcf)](_0x110aa5,null,0x2)),console[_0x5f3df7(0xb4)](_0x5f3df7(0x10e),_0x77f817,_0x5f3df7(0x111)),console[_0x5f3df7(0xb4)](_0x5f3df7(0x9d),_0xf2058f),loggerService_1[_0x5f3df7(0xc8)][_0x5f3df7(0xe0)]('noda','/payment-links',_0x5f3df7(0xe9),_0x110aa5);const _0x4bbbe6=await fetch(this['apiUrl'],{'method':_0x5f3df7(0xe9),'headers':{'Content-Type':'application/json','Accept':_0x5f3df7(0x105),'User-Agent':_0x5f3df7(0xfa)},'body':JSON[_0x5f3df7(0xcf)](_0x110aa5)}),_0x48feef=Date[_0x5f3df7(0x9f)]()-_0x2f5fce;console[_0x5f3df7(0xb4)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x5f3df7(0xb4)](_0x5f3df7(0xaf),_0x4bbbe6[_0x5f3df7(0xc0)]),console[_0x5f3df7(0xb4)](_0x5f3df7(0xa0),_0x4bbbe6[_0x5f3df7(0xbe)]),console['log'](_0x5f3df7(0xd3),Object['fromEntries'](_0x4bbbe6[_0x5f3df7(0xf8)]['entries']())),console[_0x5f3df7(0xb4)](_0x5f3df7(0xd8),_0x48feef+'ms');const _0x1d7978=await _0x4bbbe6[_0x5f3df7(0xb8)]();console[_0x5f3df7(0xb4)](_0x5f3df7(0x109),_0x1d7978);if(!_0x4bbbe6['ok']){console[_0x5f3df7(0xa2)](_0x5f3df7(0xc5)),console[_0x5f3df7(0xa2)](_0x5f3df7(0x10a),_0x4bbbe6[_0x5f3df7(0xc0)]),console[_0x5f3df7(0xa2)](_0x5f3df7(0xe3),_0x1d7978),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x5f3df7(0xc7),_0x5f3df7(0xa4),_0x4bbbe6[_0x5f3df7(0xc0)],_0x1d7978,_0x48feef),loggerService_1[_0x5f3df7(0xc8)]['logWhiteDomainError'](_0x5f3df7(0xc7),_0x5f3df7(0xa4),_0x5f3df7(0xc1)+_0x4bbbe6['status']+':\x20'+_0x1d7978);if(_0x4bbbe6['status']===0x190)throw new Error(_0x5f3df7(0xca));else{if(_0x4bbbe6['status']===0x1f4)throw new Error(_0x5f3df7(0xe8));}throw new Error(_0x5f3df7(0xb7)+_0x4bbbe6[_0x5f3df7(0xc0)]+',\x20body:\x20'+_0x1d7978);}let _0x7b950b;try{_0x7b950b=JSON['parse'](_0x1d7978);}catch(_0x273005){console[_0x5f3df7(0xa2)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x273005),loggerService_1[_0x5f3df7(0xc8)][_0x5f3df7(0xf5)](_0x5f3df7(0xc7),_0x5f3df7(0xa4),'JSON\x20Parse\x20Error:\x20'+_0x273005);throw new Error(_0x5f3df7(0x97)+_0x1d7978);}console[_0x5f3df7(0xb4)](_0x5f3df7(0x9b)),console[_0x5f3df7(0xb4)]('Parsed\x20Result:',JSON[_0x5f3df7(0xcf)](_0x7b950b,null,0x2)),loggerService_1[_0x5f3df7(0xc8)][_0x5f3df7(0xc6)]('noda',_0x5f3df7(0xa4),_0x4bbbe6[_0x5f3df7(0xc0)],_0x7b950b,_0x48feef);if(_0x7b950b['error']||_0x7b950b['statusCode']){const _0x54d4b5=_0x7b950b['message']||_0x7b950b['error']||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x5f3df7(0xa2)](_0x5f3df7(0xcb)),console[_0x5f3df7(0xa2)](_0x5f3df7(0xf4),_0x54d4b5),console[_0x5f3df7(0xa2)](_0x5f3df7(0xb1),_0x7b950b[_0x5f3df7(0xda)]),loggerService_1[_0x5f3df7(0xc8)][_0x5f3df7(0xf5)](_0x5f3df7(0xc7),_0x5f3df7(0xa4),_0x5f3df7(0xae)+_0x54d4b5);throw new Error(_0x5f3df7(0xb6)+_0x54d4b5);}if(!_0x7b950b['id']||!_0x7b950b['shortLinkUrls']?.[_0x5f3df7(0xfd)]){console['error'](_0x5f3df7(0xd6)),console[_0x5f3df7(0xa2)](_0x5f3df7(0x10d)),console[_0x5f3df7(0xa2)]('Response\x20data:',_0x7b950b),loggerService_1['loggerService'][_0x5f3df7(0xf5)](_0x5f3df7(0xc7),_0x5f3df7(0xa4),_0x5f3df7(0xd0));throw new Error(_0x5f3df7(0xd9));}return console[_0x5f3df7(0xb4)](_0x5f3df7(0xb3)),console[_0x5f3df7(0xb4)](_0x5f3df7(0x98),_0x7b950b['id']),console[_0x5f3df7(0xb4)](_0x5f3df7(0x9a),_0x7b950b[_0x5f3df7(0xfe)][_0x5f3df7(0xfd)]),console[_0x5f3df7(0xb4)]('QR\x20Code\x20Link:',_0x7b950b[_0x5f3df7(0xfe)][_0x5f3df7(0xbc)]||_0x5f3df7(0xbd)),console[_0x5f3df7(0xb4)]('Order\x20ID\x20Used:',_0x77f817,_0x5f3df7(0xce)),console['log'](_0x5f3df7(0xdb),_0xf2058f),{'gateway_payment_id':_0x7b950b['id'],'payment_url':_0x7b950b[_0x5f3df7(0xfe)][_0x5f3df7(0xfd)],'qr_code_url':_0x7b950b[_0x5f3df7(0xfe)]['qrCodeLink'],'expiry_date':_0x7b950b['expiryDate']};}catch(_0x1c0fff){console[_0x5f3df7(0xa2)](_0x5f3df7(0xfc)),console[_0x5f3df7(0xa2)](_0x5f3df7(0xbf),_0x1c0fff),loggerService_1[_0x5f3df7(0xc8)][_0x5f3df7(0xf5)](_0x5f3df7(0xc7),_0x5f3df7(0xa4),_0x1c0fff);if(_0x1c0fff instanceof Error){console[_0x5f3df7(0xa2)](_0x5f3df7(0x10f),_0x1c0fff[_0x5f3df7(0xd2)]),console[_0x5f3df7(0xa2)](_0x5f3df7(0x108),_0x1c0fff[_0x5f3df7(0x95)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x1c0fff[_0x5f3df7(0xd2)]);}throw new Error(_0x5f3df7(0xa9));}}async[a48_0x314462(0xe5)](_0x482d58){const _0x2c86b2=a48_0x314462,_0x47aa55=Date['now']();try{loggerService_1[_0x2c86b2(0xc8)][_0x2c86b2(0xe0)]('noda',_0x2c86b2(0xcc)+_0x482d58,_0x2c86b2(0x112),{});const _0x4ec8de=await fetch(this[_0x2c86b2(0x104)]+'/'+_0x482d58,{'method':_0x2c86b2(0x112),'headers':{'Content-Type':_0x2c86b2(0x105),'User-Agent':_0x2c86b2(0xfa)}}),_0x72a576=Date[_0x2c86b2(0x9f)]()-_0x47aa55;if(!_0x4ec8de['ok']){const _0xbf3b46=await _0x4ec8de[_0x2c86b2(0xb8)]();loggerService_1['loggerService'][_0x2c86b2(0xc6)](_0x2c86b2(0xc7),_0x2c86b2(0xcc)+_0x482d58,_0x4ec8de[_0x2c86b2(0xc0)],_0xbf3b46,_0x72a576);throw new Error(_0x2c86b2(0xb7)+_0x4ec8de[_0x2c86b2(0xc0)]);}const _0x40ca8b=await _0x4ec8de['json']();loggerService_1[_0x2c86b2(0xc8)][_0x2c86b2(0xc6)](_0x2c86b2(0xc7),_0x2c86b2(0xcc)+_0x482d58,_0x4ec8de[_0x2c86b2(0xc0)],_0x40ca8b,_0x72a576);if(_0x40ca8b['error']||_0x40ca8b[_0x2c86b2(0xda)]){loggerService_1[_0x2c86b2(0xc8)][_0x2c86b2(0xf5)](_0x2c86b2(0xc7),_0x2c86b2(0xcc)+_0x482d58,_0x2c86b2(0xb6)+(_0x40ca8b['message']||_0x40ca8b[_0x2c86b2(0xa2)]||_0x2c86b2(0xe6)));throw new Error(_0x2c86b2(0xb6)+(_0x40ca8b[_0x2c86b2(0xd2)]||_0x40ca8b['error']||'Unknown\x20error'));}let _0x40c588=_0x2c86b2(0xd1);if(_0x40ca8b[_0x2c86b2(0xa8)]===![]){if(_0x40ca8b[_0x2c86b2(0xad)]){const _0x40188d=new Date(_0x40ca8b[_0x2c86b2(0xad)]),_0x170774=new Date();_0x40188d<_0x170774?_0x40c588='EXPIRED':_0x40c588=_0x2c86b2(0xe1);}else _0x40c588=_0x2c86b2(0xe1);}else _0x40c588=_0x2c86b2(0xd1);return{'status':_0x40c588,'amount':_0x40ca8b['amount'],'currency':_0x40ca8b['currency'],'isActive':_0x40ca8b[_0x2c86b2(0xa8)]};}catch(_0x69522b){console[_0x2c86b2(0xa2)](_0x2c86b2(0xf0),_0x69522b),loggerService_1[_0x2c86b2(0xc8)][_0x2c86b2(0xf5)]('noda','/payment-links/'+_0x482d58,_0x69522b);throw new Error(_0x2c86b2(0xab)+(_0x69522b instanceof Error?_0x69522b['message']:_0x2c86b2(0xe6)));}}async[a48_0x314462(0xfb)](_0x1f4bae){const _0x23853c=a48_0x314462;console[_0x23853c(0xb4)](_0x23853c(0xe7),_0x1f4bae);let _0x3a04fc=_0x23853c(0xd1);switch(_0x1f4bae[_0x23853c(0xd7)]?.[_0x23853c(0xf9)]()){case _0x23853c(0xb5):case'completed':case _0x23853c(0xac):case _0x23853c(0xea):case _0x23853c(0x106):_0x1f4bae['Settled']===_0x23853c(0xc9)?_0x3a04fc=_0x23853c(0x107):_0x3a04fc='PENDING';break;case _0x23853c(0xdd):case _0x23853c(0xb2):case _0x23853c(0xef):case'error':case _0x23853c(0x10b):_0x3a04fc=_0x23853c(0xe1);break;case _0x23853c(0xee):case'timeout':_0x3a04fc=_0x23853c(0x10c);break;case _0x23853c(0xde):case _0x23853c(0x99):case _0x23853c(0x110):case _0x23853c(0xdc):case _0x23853c(0x96):default:_0x3a04fc=_0x23853c(0xd1);break;}return{'paymentId':_0x1f4bae[_0x23853c(0xa3)]||_0x1f4bae[_0x23853c(0x101)],'status':_0x3a04fc,'amount':_0x1f4bae[_0x23853c(0xe2)],'currency':_0x1f4bae['Currency'],'additionalInfo':{'method':_0x1f4bae['Method'],'bankId':_0x1f4bae[_0x23853c(0xcd)],'settled':_0x1f4bae[_0x23853c(0xf3)],'settlementDate':_0x1f4bae[_0x23853c(0xb0)],'remitterName':_0x1f4bae[_0x23853c(0xf7)]?.['Name'],'remitterIban':_0x1f4bae[_0x23853c(0xf7)]?.[_0x23853c(0xa6)],'bankTransactionId':_0x1f4bae[_0x23853c(0xec)]}};}[a48_0x314462(0x102)](_0x1ca8fc,_0x1f3c6e){const _0xac6775=a48_0x314462;return console[_0xac6775(0xb4)](_0xac6775(0xf1),{'receivedSignature':_0x1f3c6e,'paymentId':_0x1ca8fc[_0xac6775(0x101)],'merchantPaymentId':_0x1ca8fc[_0xac6775(0xa3)]}),!![];}}exports['NodaService']=NodaService;