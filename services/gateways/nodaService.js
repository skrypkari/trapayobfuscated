'use strict';function a44_0x30dc(){const _0x24017c=['Request\x20Body\x20(Direct\x20JSON):','Failed\x20to\x20verify\x20Noda\x20payment:\x20','===\x20NODA\x20SUCCESS\x20===','Raw\x20Response\x20Body:','createPaymentLink','1628128wIFLqq','__esModule','successful','Yes','statusText','cancelled','Processing\x20Noda\x20webhook:','JSON\x20Parse\x20Error:\x20','https://tesoft.uk/gateway/noda/','Remitter','verifyWebhookSignature','expired','Status\x20Code:','shortLink','log','HTTP\x20','Response\x20Time:','Response\x20data:','10jyROJh','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','HTTP\x20error!\x20status:\x20','/payment-links/','Status\x20Text:','Failed\x20to\x20parse\x20JSON\x20response:','===\x20NODA\x20API\x20ERROR\x20===','rejected','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Noda\x20webhook\x20signature\x20verification:','failed','paid','Unknown\x20error','qrCodeLink','2CAhIFK','44351844QmrBVD','BankId','HTTP\x20Status:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','stringify','status','logWhiteDomainResponse','267664LvppnX','Noda\x20API\x20error:\x20','1231865qsasgc','Response\x20Body:','Not\x20provided','Error\x20Message:','NodaService','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','TesSoft\x20Payment\x20System/1.0','headers','36hOdVYd','Status','(8digits-8digits\x20format)','Noda\x20payment\x20verification\x20error:','13422951mKHlnc','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','(8digits-8digits\x20format\x20for\x20Noda)','Payment\x20Link\x20ID:','shortLinkUrls','SettlementDate','json','../loggerService','logWhiteDomainError','24FkyNzh','PENDING','Order\x20ID\x20Used:','21jLAsIK','now','GET','parse','fromEntries','/payment-links','application/json','isActive','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','PAID','entries','Method','Business\x20Error:\x20','https://tesoft.uk/gateway/pending.php?id=','apiUrl','loggerService','currency','toUpperCase','EXPIRED','===\x20PARSED\x20NODA\x20RESPONSE\x20===','processing','noda','timeout','active','Settled','13ytucEF','Error\x20stack:','Status:','message','Name','canceled','Missing\x20id\x20or\x20shortLink\x20in\x20response','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','stack','Short\x20Link:','Order\x20ID\x20Format:','===\x20NODA\x20SERVICE\x20ERROR\x20===','BankTransactionId','URL:','73599PqRjme',',\x20body:\x20','11197153jTPTGH','statusCode','expiryDate','error','FAILED','verifyPayment','pending','logWhiteDomainRequest','Parsed\x20Result:','defineProperty','MerchantPaymentId','processWebhook','PaymentId','success','POST','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','done'];a44_0x30dc=function(){return _0x24017c;};return a44_0x30dc();}function a44_0x4a23(_0x325329,_0x1ea4a3){const _0x30dcbf=a44_0x30dc();return a44_0x4a23=function(_0x4a23a0,_0x5cb2ca){_0x4a23a0=_0x4a23a0-0x16d;let _0x244165=_0x30dcbf[_0x4a23a0];return _0x244165;},a44_0x4a23(_0x325329,_0x1ea4a3);}const a44_0x46d4bd=a44_0x4a23;(function(_0x47217c,_0x59094c){const _0x4a7944=a44_0x4a23,_0x3ae923=_0x47217c();while(!![]){try{const _0x471e95=parseInt(_0x4a7944(0x1ac))/0x1*(parseInt(_0x4a7944(0x1e4))/0x2)+parseInt(_0x4a7944(0x175))/0x3*(-parseInt(_0x4a7944(0x1ed))/0x4)+-parseInt(_0x4a7944(0x16d))/0x5*(-parseInt(_0x4a7944(0x182))/0x6)+-parseInt(_0x4a7944(0x185))/0x7*(parseInt(_0x4a7944(0x1c4))/0x8)+parseInt(_0x4a7944(0x179))/0x9*(-parseInt(_0x4a7944(0x1d6))/0xa)+-parseInt(_0x4a7944(0x1ae))/0xb+-parseInt(_0x4a7944(0x1e5))/0xc*(-parseInt(_0x4a7944(0x19e))/0xd);if(_0x471e95===_0x59094c)break;else _0x3ae923['push'](_0x3ae923['shift']());}catch(_0x5305f9){_0x3ae923['push'](_0x3ae923['shift']());}}}(a44_0x30dc,0xcb2b0));Object[a44_0x46d4bd(0x1b7)](exports,a44_0x46d4bd(0x1c5),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a44_0x46d4bd(0x180));class NodaService{constructor(){const _0x2464af=a44_0x46d4bd;this[_0x2464af(0x193)]=_0x2464af(0x1cc),console['log'](_0x2464af(0x17a));}async[a44_0x46d4bd(0x1c3)](_0x37719f){const _0x5a9f66=a44_0x46d4bd,{orderId:_0x149456,name:_0x86219f,paymentDescription:_0x17d9ca,amount:_0x57acaa,currency:_0x193609,webhookUrl:_0x36a6d8,returnUrl:_0x319282,expiryDate:_0x2e655e}=_0x37719f,_0x4cf3cb=_0x193609[_0x5a9f66(0x196)](),_0x36a0a6='https://tesoft.uk/gateway/noda/webhook/',_0x55912d=_0x5a9f66(0x192)+_0x149456,_0x1c522={'name':_0x86219f,'paymentDescription':_0x17d9ca,'amount':_0x57acaa,'currency':_0x4cf3cb,'paymentId':_0x149456,'webhookUrl':_0x36a0a6,'returnUrl':_0x55912d};_0x2e655e&&(_0x1c522[_0x5a9f66(0x1b0)]=_0x2e655e);const _0x5e2f9=Date['now']();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x5a9f66(0x1d2)](_0x5a9f66(0x1ab),this[_0x5a9f66(0x193)]),console[_0x5a9f66(0x1d2)](_0x5a9f66(0x1bf),JSON[_0x5a9f66(0x1ea)](_0x1c522,null,0x2)),console['log'](_0x5a9f66(0x1a8),_0x149456,_0x5a9f66(0x17b)),console['log'](_0x5a9f66(0x1e8),_0x55912d),loggerService_1[_0x5a9f66(0x194)][_0x5a9f66(0x1b5)](_0x5a9f66(0x19a),_0x5a9f66(0x18a),_0x5a9f66(0x1bc),_0x1c522);const _0x3154fc=await fetch(this[_0x5a9f66(0x193)],{'method':_0x5a9f66(0x1bc),'headers':{'Content-Type':_0x5a9f66(0x18b),'Accept':_0x5a9f66(0x18b),'User-Agent':_0x5a9f66(0x173)},'body':JSON[_0x5a9f66(0x1ea)](_0x1c522)}),_0x42a9df=Date[_0x5a9f66(0x186)]()-_0x5e2f9;console[_0x5a9f66(0x1d2)](_0x5a9f66(0x1bd)),console[_0x5a9f66(0x1d2)](_0x5a9f66(0x1a0),_0x3154fc['status']),console['log'](_0x5a9f66(0x1da),_0x3154fc[_0x5a9f66(0x1c8)]),console[_0x5a9f66(0x1d2)]('Headers:',Object[_0x5a9f66(0x189)](_0x3154fc[_0x5a9f66(0x174)][_0x5a9f66(0x18f)]())),console[_0x5a9f66(0x1d2)](_0x5a9f66(0x1d4),_0x42a9df+'ms');const _0x2711a5=await _0x3154fc['text']();console[_0x5a9f66(0x1d2)](_0x5a9f66(0x1c2),_0x2711a5);if(!_0x3154fc['ok']){console['error'](_0x5a9f66(0x1dc)),console[_0x5a9f66(0x1b1)](_0x5a9f66(0x1e7),_0x3154fc['status']),console['error'](_0x5a9f66(0x16e),_0x2711a5),loggerService_1[_0x5a9f66(0x194)]['logWhiteDomainResponse'](_0x5a9f66(0x19a),_0x5a9f66(0x18a),_0x3154fc[_0x5a9f66(0x1eb)],_0x2711a5,_0x42a9df),loggerService_1[_0x5a9f66(0x194)][_0x5a9f66(0x181)]('noda',_0x5a9f66(0x18a),_0x5a9f66(0x1d3)+_0x3154fc[_0x5a9f66(0x1eb)]+':\x20'+_0x2711a5);if(_0x3154fc[_0x5a9f66(0x1eb)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x3154fc[_0x5a9f66(0x1eb)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x5a9f66(0x1d8)+_0x3154fc[_0x5a9f66(0x1eb)]+_0x5a9f66(0x1ad)+_0x2711a5);}let _0x416f60;try{_0x416f60=JSON[_0x5a9f66(0x188)](_0x2711a5);}catch(_0x4a07e2){console[_0x5a9f66(0x1b1)](_0x5a9f66(0x1db),_0x4a07e2),loggerService_1[_0x5a9f66(0x194)][_0x5a9f66(0x181)](_0x5a9f66(0x19a),'/payment-links',_0x5a9f66(0x1cb)+_0x4a07e2);throw new Error(_0x5a9f66(0x1e9)+_0x2711a5);}console[_0x5a9f66(0x1d2)](_0x5a9f66(0x198)),console[_0x5a9f66(0x1d2)](_0x5a9f66(0x1b6),JSON[_0x5a9f66(0x1ea)](_0x416f60,null,0x2)),loggerService_1[_0x5a9f66(0x194)][_0x5a9f66(0x1ec)](_0x5a9f66(0x19a),_0x5a9f66(0x18a),_0x3154fc[_0x5a9f66(0x1eb)],_0x416f60,_0x42a9df);if(_0x416f60[_0x5a9f66(0x1b1)]||_0x416f60[_0x5a9f66(0x1af)]){const _0xa30ef3=_0x416f60[_0x5a9f66(0x1a1)]||_0x416f60['error']||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x5a9f66(0x1b1)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x5a9f66(0x1b1)](_0x5a9f66(0x170),_0xa30ef3),console[_0x5a9f66(0x1b1)](_0x5a9f66(0x1d0),_0x416f60['statusCode']),loggerService_1[_0x5a9f66(0x194)][_0x5a9f66(0x181)](_0x5a9f66(0x19a),_0x5a9f66(0x18a),_0x5a9f66(0x191)+_0xa30ef3);throw new Error('Noda\x20API\x20error:\x20'+_0xa30ef3);}if(!_0x416f60['id']||!_0x416f60['shortLinkUrls']?.[_0x5a9f66(0x1d1)]){console['error']('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x5a9f66(0x1b1)](_0x5a9f66(0x1a4)),console[_0x5a9f66(0x1b1)](_0x5a9f66(0x1d5),_0x416f60),loggerService_1[_0x5a9f66(0x194)][_0x5a9f66(0x181)](_0x5a9f66(0x19a),_0x5a9f66(0x18a),_0x5a9f66(0x172));throw new Error(_0x5a9f66(0x1de));}return console[_0x5a9f66(0x1d2)](_0x5a9f66(0x1c1)),console['log'](_0x5a9f66(0x17c),_0x416f60['id']),console['log'](_0x5a9f66(0x1a7),_0x416f60['shortLinkUrls'][_0x5a9f66(0x1d1)]),console['log']('QR\x20Code\x20Link:',_0x416f60['shortLinkUrls']['qrCodeLink']||_0x5a9f66(0x16f)),console[_0x5a9f66(0x1d2)](_0x5a9f66(0x184),_0x149456,_0x5a9f66(0x177)),console['log'](_0x5a9f66(0x18d),_0x55912d),{'gateway_payment_id':_0x416f60['id'],'payment_url':_0x416f60[_0x5a9f66(0x17d)][_0x5a9f66(0x1d1)],'qr_code_url':_0x416f60['shortLinkUrls'][_0x5a9f66(0x1e3)],'expiry_date':_0x416f60[_0x5a9f66(0x1b0)]};}catch(_0x724b6d){console[_0x5a9f66(0x1b1)](_0x5a9f66(0x1a9)),console[_0x5a9f66(0x1b1)]('Error\x20details:',_0x724b6d),loggerService_1[_0x5a9f66(0x194)][_0x5a9f66(0x181)](_0x5a9f66(0x19a),_0x5a9f66(0x18a),_0x724b6d);if(_0x724b6d instanceof Error){console[_0x5a9f66(0x1b1)]('Error\x20message:',_0x724b6d[_0x5a9f66(0x1a1)]),console[_0x5a9f66(0x1b1)](_0x5a9f66(0x19f),_0x724b6d[_0x5a9f66(0x1a6)]);throw new Error(_0x5a9f66(0x1d7)+_0x724b6d[_0x5a9f66(0x1a1)]);}throw new Error(_0x5a9f66(0x1a5));}}async[a44_0x46d4bd(0x1b3)](_0x35d219){const _0x3e3437=a44_0x46d4bd,_0x40d11a=Date[_0x3e3437(0x186)]();try{loggerService_1[_0x3e3437(0x194)][_0x3e3437(0x1b5)](_0x3e3437(0x19a),_0x3e3437(0x1d9)+_0x35d219,'GET',{});const _0x50cf01=await fetch(this['apiUrl']+'/'+_0x35d219,{'method':_0x3e3437(0x187),'headers':{'Content-Type':_0x3e3437(0x18b),'User-Agent':_0x3e3437(0x173)}}),_0x17a86f=Date[_0x3e3437(0x186)]()-_0x40d11a;if(!_0x50cf01['ok']){const _0xb80c12=await _0x50cf01['text']();loggerService_1[_0x3e3437(0x194)][_0x3e3437(0x1ec)](_0x3e3437(0x19a),'/payment-links/'+_0x35d219,_0x50cf01[_0x3e3437(0x1eb)],_0xb80c12,_0x17a86f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x50cf01[_0x3e3437(0x1eb)]);}const _0x4e860d=await _0x50cf01[_0x3e3437(0x17f)]();loggerService_1[_0x3e3437(0x194)][_0x3e3437(0x1ec)](_0x3e3437(0x19a),'/payment-links/'+_0x35d219,_0x50cf01[_0x3e3437(0x1eb)],_0x4e860d,_0x17a86f);if(_0x4e860d[_0x3e3437(0x1b1)]||_0x4e860d[_0x3e3437(0x1af)]){loggerService_1[_0x3e3437(0x194)][_0x3e3437(0x181)](_0x3e3437(0x19a),_0x3e3437(0x1d9)+_0x35d219,_0x3e3437(0x1ee)+(_0x4e860d['message']||_0x4e860d[_0x3e3437(0x1b1)]||_0x3e3437(0x1e2)));throw new Error(_0x3e3437(0x1ee)+(_0x4e860d[_0x3e3437(0x1a1)]||_0x4e860d[_0x3e3437(0x1b1)]||_0x3e3437(0x1e2)));}let _0x111669=_0x3e3437(0x183);if(_0x4e860d[_0x3e3437(0x18c)]===![]){if(_0x4e860d[_0x3e3437(0x1b0)]){const _0x364c78=new Date(_0x4e860d[_0x3e3437(0x1b0)]),_0x3e25a9=new Date();_0x364c78<_0x3e25a9?_0x111669=_0x3e3437(0x197):_0x111669=_0x3e3437(0x1b2);}else _0x111669=_0x3e3437(0x1b2);}else _0x111669='PENDING';return{'status':_0x111669,'amount':_0x4e860d['amount'],'currency':_0x4e860d[_0x3e3437(0x195)],'isActive':_0x4e860d[_0x3e3437(0x18c)]};}catch(_0x130438){console[_0x3e3437(0x1b1)](_0x3e3437(0x178),_0x130438),loggerService_1['loggerService'][_0x3e3437(0x181)](_0x3e3437(0x19a),_0x3e3437(0x1d9)+_0x35d219,_0x130438);throw new Error(_0x3e3437(0x1c0)+(_0x130438 instanceof Error?_0x130438[_0x3e3437(0x1a1)]:'Unknown\x20error'));}}async[a44_0x46d4bd(0x1b9)](_0x2d8305){const _0x59d429=a44_0x46d4bd;console[_0x59d429(0x1d2)](_0x59d429(0x1ca),_0x2d8305);let _0x93aaf3=_0x59d429(0x183);switch(_0x2d8305[_0x59d429(0x176)]?.['toLowerCase']()){case _0x59d429(0x1be):case'completed':case _0x59d429(0x1e1):case _0x59d429(0x1bb):case _0x59d429(0x1c6):_0x2d8305['Settled']===_0x59d429(0x1c7)?_0x93aaf3=_0x59d429(0x18e):_0x93aaf3=_0x59d429(0x183);break;case _0x59d429(0x1c9):case _0x59d429(0x1a3):case _0x59d429(0x1e0):case'error':case _0x59d429(0x1dd):_0x93aaf3=_0x59d429(0x1b2);break;case _0x59d429(0x1cf):case _0x59d429(0x19b):_0x93aaf3=_0x59d429(0x197);break;case _0x59d429(0x1b4):case'created':case _0x59d429(0x19c):case _0x59d429(0x199):case'in_progress':default:_0x93aaf3=_0x59d429(0x183);break;}return{'paymentId':_0x2d8305[_0x59d429(0x1b8)]||_0x2d8305[_0x59d429(0x1ba)],'status':_0x93aaf3,'amount':_0x2d8305['Amount'],'currency':_0x2d8305['Currency'],'additionalInfo':{'method':_0x2d8305[_0x59d429(0x190)],'bankId':_0x2d8305[_0x59d429(0x1e6)],'settled':_0x2d8305[_0x59d429(0x19d)],'settlementDate':_0x2d8305[_0x59d429(0x17e)],'remitterName':_0x2d8305[_0x59d429(0x1cd)]?.[_0x59d429(0x1a2)],'remitterIban':_0x2d8305['Remitter']?.['Iban'],'bankTransactionId':_0x2d8305[_0x59d429(0x1aa)]}};}[a44_0x46d4bd(0x1ce)](_0xe6f8a2,_0x4324dd){const _0x54020f=a44_0x46d4bd;return console[_0x54020f(0x1d2)](_0x54020f(0x1df),{'receivedSignature':_0x4324dd,'paymentId':_0xe6f8a2[_0x54020f(0x1ba)],'merchantPaymentId':_0xe6f8a2[_0x54020f(0x1b8)]}),!![];}}exports[a44_0x46d4bd(0x171)]=NodaService;