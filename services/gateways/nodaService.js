'use strict';const a53_0x2d569c=a53_0x2f5a;function a53_0x412c(){const _0x426849=['error','Not\x20provided','GET','rejected','Order\x20ID\x20Format:','entries',',\x20body:\x20','HTTP\x20error!\x20status:\x20','Failed\x20to\x20verify\x20Noda\x20payment:\x20','text','now','statusCode','status','currency','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','logWhiteDomainResponse','processWebhook','Payment\x20System/1.0','failed','Currency','Error\x20message:','Name','NodaService','Processing\x20Noda\x20webhook:','(8digits-8digits\x20format)','FAILED','95475TZXPhy','amount','PaymentId','expiryDate','noda','active','Error\x20stack:','Settled','23547216kOcpJA','stringify','Headers:','Yes','verifyPayment','loggerService','Noda\x20webhook\x20signature\x20verification:','PAID','isActive','Method','3522164PvtfAK','application/json','defineProperty','json','(8digits-8digits\x20format\x20for\x20Noda)','Failed\x20to\x20parse\x20JSON\x20response:','BankId','URL:','timeout','24696JwEUxE','processing','PENDING','Response\x20Body:','SettlementDate','https://tesoft.uk/gateway/noda/','216unCdiF','parse','BankTransactionId','===\x20NODA\x20API\x20ERROR\x20===','toLowerCase','/payment-links/','572oeYibI','https://tesoft.uk/gateway/noda/webhook/','Response\x20data:','Unknown\x20error','fromEntries','../loggerService','Status\x20Text:','Response\x20Time:','success','message','created','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','toUpperCase','14755830qhjKik','canceled','1XcNAOH','qrCodeLink','9AWbwIg','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Status\x20Code:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','HTTP\x20','HTTP\x20Status:','10452680ubnRoa','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Remitter','Error\x20details:','/payment-links','successful','Status:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Status','Noda\x20API\x20error:\x20','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','JSON\x20Parse\x20Error:\x20','POST','logWhiteDomainError','done','Amount','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','shortLinkUrls','log','headers','===\x20NODA\x20SUCCESS\x20===','https://tesoft.uk/gateway/pending.php?id=','Raw\x20Response\x20Body:','Error\x20Message:','verifyWebhookSignature','MerchantPaymentId','shortLink','apiUrl','cancelled','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainRequest','6762441VoYjgL'];a53_0x412c=function(){return _0x426849;};return a53_0x412c();}(function(_0x46f383,_0x59b2db){const _0x5ac02d=a53_0x2f5a,_0xb82c63=_0x46f383();while(!![]){try{const _0x433c19=-parseInt(_0x5ac02d(0xba))/0x1*(-parseInt(_0x5ac02d(0x110))/0x2)+parseInt(_0x5ac02d(0x9f))/0x3*(-parseInt(_0x5ac02d(0xab))/0x4)+-parseInt(_0x5ac02d(0xfe))/0x5*(-parseInt(_0x5ac02d(0xa5))/0x6)+-parseInt(_0x5ac02d(0xe3))/0x7+parseInt(_0x5ac02d(0xc3))/0x8+-parseInt(_0x5ac02d(0xbc))/0x9*(-parseInt(_0x5ac02d(0xb8))/0xa)+-parseInt(_0x5ac02d(0x106))/0xb;if(_0x433c19===_0x59b2db)break;else _0xb82c63['push'](_0xb82c63['shift']());}catch(_0x9cbfbc){_0xb82c63['push'](_0xb82c63['shift']());}}}(a53_0x412c,0xe7257));function a53_0x2f5a(_0x17d197,_0x29dbe5){const _0x412c39=a53_0x412c();return a53_0x2f5a=function(_0x2f5a4d,_0x3624b1){_0x2f5a4d=_0x2f5a4d-0x9d;let _0x24e9f3=_0x412c39[_0x2f5a4d];return _0x24e9f3;},a53_0x2f5a(_0x17d197,_0x29dbe5);}Object[a53_0x2d569c(0x112)](exports,'__esModule',{'value':!![]}),exports[a53_0x2d569c(0xfa)]=void 0x0;const loggerService_1=require(a53_0x2d569c(0xb0));class NodaService{constructor(){const _0x5ab6c4=a53_0x2d569c;this[_0x5ab6c4(0xde)]=_0x5ab6c4(0xa4),console[_0x5ab6c4(0xd5)](_0x5ab6c4(0xc0));}async['createPaymentLink'](_0x34ee6c){const _0x5a65a7=a53_0x2d569c,{orderId:_0x5678c0,name:_0x37a39f,paymentDescription:_0x4fcbe1,amount:_0x173ea1,currency:_0x28edad,webhookUrl:_0x170b6d,returnUrl:_0x453d4e,expiryDate:_0x39040c}=_0x34ee6c,_0x3e9ca8=_0x28edad[_0x5a65a7(0xb7)](),_0x247ecd=_0x5a65a7(0xac),_0x351217=_0x5a65a7(0xd8)+_0x5678c0,_0x10faf4={'name':_0x37a39f,'paymentDescription':_0x4fcbe1,'amount':_0x173ea1,'currency':_0x3e9ca8,'paymentId':_0x5678c0,'webhookUrl':_0x247ecd,'returnUrl':_0x351217};_0x39040c&&(_0x10faf4[_0x5a65a7(0x101)]=_0x39040c);const _0x5566bc=Date['now']();try{console['log'](_0x5a65a7(0xbf)),console[_0x5a65a7(0xd5)](_0x5a65a7(0x9d),this[_0x5a65a7(0xde)]),console[_0x5a65a7(0xd5)]('Request\x20Body\x20(Direct\x20JSON):',JSON['stringify'](_0x10faf4,null,0x2)),console[_0x5a65a7(0xd5)](_0x5a65a7(0xe8),_0x5678c0,_0x5a65a7(0x114)),console[_0x5a65a7(0xd5)](_0x5a65a7(0xcd),_0x351217),loggerService_1[_0x5a65a7(0x10b)][_0x5a65a7(0xe2)]('noda',_0x5a65a7(0xc7),_0x5a65a7(0xcf),_0x10faf4);const _0x44da89=await fetch(this['apiUrl'],{'method':_0x5a65a7(0xcf),'headers':{'Content-Type':_0x5a65a7(0x111),'Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x5a65a7(0x107)](_0x10faf4)}),_0xeb8014=Date[_0x5a65a7(0xee)]()-_0x5566bc;console[_0x5a65a7(0xd5)](_0x5a65a7(0xe1)),console[_0x5a65a7(0xd5)](_0x5a65a7(0xc9),_0x44da89['status']),console[_0x5a65a7(0xd5)](_0x5a65a7(0xb1),_0x44da89['statusText']),console['log'](_0x5a65a7(0x108),Object[_0x5a65a7(0xaf)](_0x44da89[_0x5a65a7(0xd6)][_0x5a65a7(0xe9)]())),console['log'](_0x5a65a7(0xb2),_0xeb8014+'ms');const _0x3ab58d=await _0x44da89[_0x5a65a7(0xed)]();console['log'](_0x5a65a7(0xd9),_0x3ab58d);if(!_0x44da89['ok']){console[_0x5a65a7(0xe4)](_0x5a65a7(0xa8)),console[_0x5a65a7(0xe4)](_0x5a65a7(0xc2),_0x44da89['status']),console[_0x5a65a7(0xe4)](_0x5a65a7(0xa2),_0x3ab58d),loggerService_1[_0x5a65a7(0x10b)]['logWhiteDomainResponse']('noda',_0x5a65a7(0xc7),_0x44da89[_0x5a65a7(0xf0)],_0x3ab58d,_0xeb8014),loggerService_1[_0x5a65a7(0x10b)][_0x5a65a7(0xd0)](_0x5a65a7(0x102),_0x5a65a7(0xc7),_0x5a65a7(0xc1)+_0x44da89[_0x5a65a7(0xf0)]+':\x20'+_0x3ab58d);if(_0x44da89[_0x5a65a7(0xf0)]===0x190)throw new Error(_0x5a65a7(0xca));else{if(_0x44da89[_0x5a65a7(0xf0)]===0x1f4)throw new Error(_0x5a65a7(0xe0));}throw new Error(_0x5a65a7(0xeb)+_0x44da89['status']+_0x5a65a7(0xea)+_0x3ab58d);}let _0x48d2e4;try{_0x48d2e4=JSON[_0x5a65a7(0xa6)](_0x3ab58d);}catch(_0x12e1e5){console['error'](_0x5a65a7(0x115),_0x12e1e5),loggerService_1[_0x5a65a7(0x10b)]['logWhiteDomainError'](_0x5a65a7(0x102),'/payment-links',_0x5a65a7(0xce)+_0x12e1e5);throw new Error(_0x5a65a7(0xbd)+_0x3ab58d);}console[_0x5a65a7(0xd5)](_0x5a65a7(0xc4)),console['log']('Parsed\x20Result:',JSON['stringify'](_0x48d2e4,null,0x2)),loggerService_1['loggerService'][_0x5a65a7(0xf3)]('noda',_0x5a65a7(0xc7),_0x44da89[_0x5a65a7(0xf0)],_0x48d2e4,_0xeb8014);if(_0x48d2e4[_0x5a65a7(0xe4)]||_0x48d2e4[_0x5a65a7(0xef)]){const _0x585aae=_0x48d2e4[_0x5a65a7(0xb4)]||_0x48d2e4[_0x5a65a7(0xe4)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x5a65a7(0xe4)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x5a65a7(0xda),_0x585aae),console[_0x5a65a7(0xe4)](_0x5a65a7(0xbe),_0x48d2e4[_0x5a65a7(0xef)]),loggerService_1[_0x5a65a7(0x10b)]['logWhiteDomainError'](_0x5a65a7(0x102),'/payment-links','Business\x20Error:\x20'+_0x585aae);throw new Error(_0x5a65a7(0xcc)+_0x585aae);}if(!_0x48d2e4['id']||!_0x48d2e4['shortLinkUrls']?.[_0x5a65a7(0xdd)]){console[_0x5a65a7(0xe4)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x5a65a7(0xe4)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x5a65a7(0xe4)](_0x5a65a7(0xad),_0x48d2e4),loggerService_1['loggerService']['logWhiteDomainError'](_0x5a65a7(0x102),_0x5a65a7(0xc7),_0x5a65a7(0xf2));throw new Error(_0x5a65a7(0xd3));}return console[_0x5a65a7(0xd5)](_0x5a65a7(0xd7)),console[_0x5a65a7(0xd5)]('Payment\x20Link\x20ID:',_0x48d2e4['id']),console[_0x5a65a7(0xd5)]('Short\x20Link:',_0x48d2e4[_0x5a65a7(0xd4)][_0x5a65a7(0xdd)]),console[_0x5a65a7(0xd5)]('QR\x20Code\x20Link:',_0x48d2e4[_0x5a65a7(0xd4)][_0x5a65a7(0xbb)]||_0x5a65a7(0xe5)),console[_0x5a65a7(0xd5)]('Order\x20ID\x20Used:',_0x5678c0,_0x5a65a7(0xfc)),console[_0x5a65a7(0xd5)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x351217),{'gateway_payment_id':_0x48d2e4['id'],'payment_url':_0x48d2e4[_0x5a65a7(0xd4)]['shortLink'],'qr_code_url':_0x48d2e4[_0x5a65a7(0xd4)][_0x5a65a7(0xbb)],'expiry_date':_0x48d2e4[_0x5a65a7(0x101)]};}catch(_0x42099b){console[_0x5a65a7(0xe4)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x5a65a7(0xe4)](_0x5a65a7(0xc6),_0x42099b),loggerService_1['loggerService'][_0x5a65a7(0xd0)]('noda',_0x5a65a7(0xc7),_0x42099b);if(_0x42099b instanceof Error){console['error'](_0x5a65a7(0xf8),_0x42099b[_0x5a65a7(0xb4)]),console['error'](_0x5a65a7(0x104),_0x42099b['stack']);throw new Error(_0x5a65a7(0xb6)+_0x42099b[_0x5a65a7(0xb4)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a53_0x2d569c(0x10a)](_0x4c3143){const _0x282db7=a53_0x2d569c,_0x14ab27=Date['now']();try{loggerService_1[_0x282db7(0x10b)][_0x282db7(0xe2)]('noda','/payment-links/'+_0x4c3143,'GET',{});const _0x1bcb99=await fetch(this[_0x282db7(0xde)]+'/'+_0x4c3143,{'method':_0x282db7(0xe6),'headers':{'Content-Type':'application/json','User-Agent':_0x282db7(0xf5)}}),_0x239fd6=Date[_0x282db7(0xee)]()-_0x14ab27;if(!_0x1bcb99['ok']){const _0x5bb67a=await _0x1bcb99['text']();loggerService_1[_0x282db7(0x10b)][_0x282db7(0xf3)]('noda',_0x282db7(0xaa)+_0x4c3143,_0x1bcb99[_0x282db7(0xf0)],_0x5bb67a,_0x239fd6);throw new Error(_0x282db7(0xeb)+_0x1bcb99[_0x282db7(0xf0)]);}const _0x188301=await _0x1bcb99[_0x282db7(0x113)]();loggerService_1[_0x282db7(0x10b)][_0x282db7(0xf3)](_0x282db7(0x102),_0x282db7(0xaa)+_0x4c3143,_0x1bcb99[_0x282db7(0xf0)],_0x188301,_0x239fd6);if(_0x188301[_0x282db7(0xe4)]||_0x188301['statusCode']){loggerService_1['loggerService'][_0x282db7(0xd0)](_0x282db7(0x102),_0x282db7(0xaa)+_0x4c3143,_0x282db7(0xcc)+(_0x188301[_0x282db7(0xb4)]||_0x188301[_0x282db7(0xe4)]||_0x282db7(0xae)));throw new Error(_0x282db7(0xcc)+(_0x188301['message']||_0x188301[_0x282db7(0xe4)]||_0x282db7(0xae)));}let _0x12723d=_0x282db7(0xa1);if(_0x188301[_0x282db7(0x10e)]===![]){if(_0x188301[_0x282db7(0x101)]){const _0x55bb61=new Date(_0x188301[_0x282db7(0x101)]),_0x1ebb00=new Date();_0x55bb61<_0x1ebb00?_0x12723d='EXPIRED':_0x12723d='FAILED';}else _0x12723d=_0x282db7(0xfd);}else _0x12723d=_0x282db7(0xa1);return{'status':_0x12723d,'amount':_0x188301[_0x282db7(0xff)],'currency':_0x188301[_0x282db7(0xf1)],'isActive':_0x188301[_0x282db7(0x10e)]};}catch(_0x29cdad){console[_0x282db7(0xe4)]('Noda\x20payment\x20verification\x20error:',_0x29cdad),loggerService_1[_0x282db7(0x10b)]['logWhiteDomainError'](_0x282db7(0x102),_0x282db7(0xaa)+_0x4c3143,_0x29cdad);throw new Error(_0x282db7(0xec)+(_0x29cdad instanceof Error?_0x29cdad['message']:_0x282db7(0xae)));}}async[a53_0x2d569c(0xf4)](_0x3e8d5a){const _0x5751da=a53_0x2d569c;console[_0x5751da(0xd5)](_0x5751da(0xfb),_0x3e8d5a);let _0x55807a=_0x5751da(0xa1);switch(_0x3e8d5a[_0x5751da(0xcb)]?.[_0x5751da(0xa9)]()){case _0x5751da(0xd1):case'completed':case'paid':case _0x5751da(0xb3):case _0x5751da(0xc8):_0x3e8d5a[_0x5751da(0x105)]===_0x5751da(0x109)?_0x55807a=_0x5751da(0x10d):_0x55807a='PENDING';break;case _0x5751da(0xdf):case _0x5751da(0xb9):case _0x5751da(0xf6):case'error':case _0x5751da(0xe7):_0x55807a=_0x5751da(0xfd);break;case'expired':case _0x5751da(0x9e):_0x55807a='EXPIRED';break;case'pending':case _0x5751da(0xb5):case _0x5751da(0x103):case _0x5751da(0xa0):case'in_progress':default:_0x55807a=_0x5751da(0xa1);break;}return{'paymentId':_0x3e8d5a[_0x5751da(0xdc)]||_0x3e8d5a[_0x5751da(0x100)],'status':_0x55807a,'amount':_0x3e8d5a[_0x5751da(0xd2)],'currency':_0x3e8d5a[_0x5751da(0xf7)],'additionalInfo':{'method':_0x3e8d5a[_0x5751da(0x10f)],'bankId':_0x3e8d5a[_0x5751da(0x116)],'settled':_0x3e8d5a[_0x5751da(0x105)],'settlementDate':_0x3e8d5a[_0x5751da(0xa3)],'remitterName':_0x3e8d5a[_0x5751da(0xc5)]?.[_0x5751da(0xf9)],'remitterIban':_0x3e8d5a[_0x5751da(0xc5)]?.['Iban'],'bankTransactionId':_0x3e8d5a[_0x5751da(0xa7)]}};}[a53_0x2d569c(0xdb)](_0x515e3a,_0x1db32b){const _0x5a6cba=a53_0x2d569c;return console['log'](_0x5a6cba(0x10c),{'receivedSignature':_0x1db32b,'paymentId':_0x515e3a[_0x5a6cba(0x100)],'merchantPaymentId':_0x515e3a['MerchantPaymentId']}),!![];}}exports[a53_0x2d569c(0xfa)]=NodaService;