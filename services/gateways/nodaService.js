'use strict';const a47_0x24723e=a47_0x45cb;(function(_0x3ae8dd,_0x304fcc){const _0x598570=a47_0x45cb,_0x566845=_0x3ae8dd();while(!![]){try{const _0x2cbb61=-parseInt(_0x598570(0x18b))/0x1+-parseInt(_0x598570(0x1aa))/0x2+parseInt(_0x598570(0x1b7))/0x3*(-parseInt(_0x598570(0x15e))/0x4)+-parseInt(_0x598570(0x196))/0x5*(parseInt(_0x598570(0x15f))/0x6)+parseInt(_0x598570(0x198))/0x7*(-parseInt(_0x598570(0x1cc))/0x8)+parseInt(_0x598570(0x169))/0x9*(-parseInt(_0x598570(0x191))/0xa)+-parseInt(_0x598570(0x15c))/0xb*(-parseInt(_0x598570(0x158))/0xc);if(_0x2cbb61===_0x304fcc)break;else _0x566845['push'](_0x566845['shift']());}catch(_0x1b1c2d){_0x566845['push'](_0x566845['shift']());}}}(a47_0x4b3f,0x58a93));Object[a47_0x24723e(0x193)](exports,'__esModule',{'value':!![]}),exports[a47_0x24723e(0x18d)]=void 0x0;function a47_0x45cb(_0x343e0e,_0x41483e){const _0x4b3f3c=a47_0x4b3f();return a47_0x45cb=function(_0x45cb1c,_0x28fa58){_0x45cb1c=_0x45cb1c-0x14b;let _0x557449=_0x4b3f3c[_0x45cb1c];return _0x557449;},a47_0x45cb(_0x343e0e,_0x41483e);}const loggerService_1=require(a47_0x24723e(0x154));function a47_0x4b3f(){const _0x5485f0=['successful','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Response\x20data:','Response\x20Body:','https://tesoft.uk/gateway/noda/webhook/','expired','Remitter','Failed\x20to\x20verify\x20Noda\x20payment:\x20','../loggerService','FAILED','Iban','log','31440444FsgIMk','MerchantPaymentId','now','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','11QGapVl','Noda\x20webhook\x20signature\x20verification:','16LnBXLO','1866hzmGPU','text','===\x20NODA\x20API\x20ERROR\x20===',',\x20body:\x20','TesSoft\x20Payment\x20System/1.0','Payment\x20Link\x20ID:','Processing\x20Noda\x20webhook:','PENDING','Yes','application/json','189NiyAOG','apiUrl','Amount','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','statusText','cancelled','completed','success','Short\x20Link:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','toUpperCase','isActive','logWhiteDomainRequest','fromEntries','pending','/payment-links/','message','Unknown\x20error\x20from\x20Noda\x20API','active','JSON\x20Parse\x20Error:\x20','shortLink','toLowerCase','Method','Request\x20Body\x20(Direct\x20JSON):','qrCodeLink','entries','Currency','loggerService','Status:','https://tesoft.uk/gateway/pending.php?id=','Raw\x20Response\x20Body:','Error\x20message:','statusCode','569831XaZhkJ','POST','NodaService','Business\x20Error:\x20','stringify','Failed\x20to\x20parse\x20JSON\x20response:','139540PpewNF','HTTP\x20error!\x20status:\x20','defineProperty','Error\x20Message:','QR\x20Code\x20Link:','5055KthEla','(8digits-8digits\x20format)','24969hrzIBF','error','verifyWebhookSignature','Name','===\x20NODA\x20SERVICE\x20ERROR\x20===','verifyPayment','/payment-links','Status','HTTP\x20','processing','https://tesoft.uk/gateway/noda/','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','in_progress','Settled','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','created','logWhiteDomainResponse','EXPIRED','218308nnIwoY','Not\x20provided','expiryDate','timeout','Noda\x20API\x20error:\x20','URL:','paid','Error\x20stack:','Order\x20ID\x20Format:','GET','status','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','219534CTZPOc','Status\x20Code:','Order\x20ID\x20Used:','(8digits-8digits\x20format\x20for\x20Noda)','===\x20NODA\x20SUCCESS\x20===','stack','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','BankId','json','BankTransactionId','logWhiteDomainError','amount','createPaymentLink','Headers:','shortLinkUrls','headers','parse','noda','Unknown\x20error','rejected','PaymentId','1520mvBsfB'];a47_0x4b3f=function(){return _0x5485f0;};return a47_0x4b3f();}class NodaService{constructor(){const _0x53d577=a47_0x24723e;this[_0x53d577(0x16a)]=_0x53d577(0x1a2),console['log'](_0x53d577(0x16c));}async[a47_0x24723e(0x1c3)](_0x39547a){const _0x4b9abc=a47_0x24723e,{orderId:_0x4576f7,name:_0x10bf9c,paymentDescription:_0x9c416e,amount:_0x3f1ebb,currency:_0x3e408d,webhookUrl:_0xba39d9,returnUrl:_0x6e27ec,expiryDate:_0x232fdf}=_0x39547a,_0x3ec4ba=_0x3e408d[_0x4b9abc(0x174)](),_0x4133c4=_0x4b9abc(0x150),_0x360155=_0x4b9abc(0x187)+_0x4576f7,_0x575bb4={'name':_0x10bf9c,'paymentDescription':_0x9c416e,'amount':_0x3f1ebb,'currency':_0x3ec4ba,'paymentId':_0x4576f7,'webhookUrl':_0x4133c4,'returnUrl':_0x360155};_0x232fdf&&(_0x575bb4['expiryDate']=_0x232fdf);const _0x23c432=Date[_0x4b9abc(0x15a)]();try{console[_0x4b9abc(0x157)](_0x4b9abc(0x1a6)),console[_0x4b9abc(0x157)](_0x4b9abc(0x1af),this['apiUrl']),console[_0x4b9abc(0x157)](_0x4b9abc(0x181),JSON['stringify'](_0x575bb4,null,0x2)),console[_0x4b9abc(0x157)](_0x4b9abc(0x1b2),_0x4576f7,_0x4b9abc(0x1ba)),console[_0x4b9abc(0x157)](_0x4b9abc(0x173),_0x360155),loggerService_1['loggerService'][_0x4b9abc(0x176)](_0x4b9abc(0x1c8),_0x4b9abc(0x19e),_0x4b9abc(0x18c),_0x575bb4);const _0x338e00=await fetch(this[_0x4b9abc(0x16a)],{'method':_0x4b9abc(0x18c),'headers':{'Content-Type':'application/json','Accept':_0x4b9abc(0x168),'User-Agent':_0x4b9abc(0x163)},'body':JSON[_0x4b9abc(0x18f)](_0x575bb4)}),_0x280153=Date[_0x4b9abc(0x15a)]()-_0x23c432;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x4b9abc(0x157)](_0x4b9abc(0x186),_0x338e00[_0x4b9abc(0x1b4)]),console[_0x4b9abc(0x157)]('Status\x20Text:',_0x338e00[_0x4b9abc(0x16d)]),console['log'](_0x4b9abc(0x1c4),Object[_0x4b9abc(0x177)](_0x338e00[_0x4b9abc(0x1c6)][_0x4b9abc(0x183)]())),console[_0x4b9abc(0x157)]('Response\x20Time:',_0x280153+'ms');const _0x5f275d=await _0x338e00[_0x4b9abc(0x160)]();console[_0x4b9abc(0x157)](_0x4b9abc(0x188),_0x5f275d);if(!_0x338e00['ok']){console[_0x4b9abc(0x199)](_0x4b9abc(0x161)),console[_0x4b9abc(0x199)]('HTTP\x20Status:',_0x338e00[_0x4b9abc(0x1b4)]),console[_0x4b9abc(0x199)](_0x4b9abc(0x14f),_0x5f275d),loggerService_1[_0x4b9abc(0x185)][_0x4b9abc(0x1a8)](_0x4b9abc(0x1c8),_0x4b9abc(0x19e),_0x338e00[_0x4b9abc(0x1b4)],_0x5f275d,_0x280153),loggerService_1[_0x4b9abc(0x185)]['logWhiteDomainError'](_0x4b9abc(0x1c8),_0x4b9abc(0x19e),_0x4b9abc(0x1a0)+_0x338e00[_0x4b9abc(0x1b4)]+':\x20'+_0x5f275d);if(_0x338e00[_0x4b9abc(0x1b4)]===0x190)throw new Error(_0x4b9abc(0x172));else{if(_0x338e00[_0x4b9abc(0x1b4)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x4b9abc(0x192)+_0x338e00['status']+_0x4b9abc(0x162)+_0x5f275d);}let _0x4907cb;try{_0x4907cb=JSON[_0x4b9abc(0x1c7)](_0x5f275d);}catch(_0x4758b7){console[_0x4b9abc(0x199)](_0x4b9abc(0x190),_0x4758b7),loggerService_1[_0x4b9abc(0x185)][_0x4b9abc(0x1c1)](_0x4b9abc(0x1c8),_0x4b9abc(0x19e),_0x4b9abc(0x17d)+_0x4758b7);throw new Error(_0x4b9abc(0x15b)+_0x5f275d);}console[_0x4b9abc(0x157)](_0x4b9abc(0x14d)),console[_0x4b9abc(0x157)]('Parsed\x20Result:',JSON[_0x4b9abc(0x18f)](_0x4907cb,null,0x2)),loggerService_1[_0x4b9abc(0x185)][_0x4b9abc(0x1a8)](_0x4b9abc(0x1c8),_0x4b9abc(0x19e),_0x338e00[_0x4b9abc(0x1b4)],_0x4907cb,_0x280153);if(_0x4907cb[_0x4b9abc(0x199)]||_0x4907cb[_0x4b9abc(0x18a)]){const _0x3b5cca=_0x4907cb[_0x4b9abc(0x17a)]||_0x4907cb['error']||_0x4b9abc(0x17b);console['error']('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x4b9abc(0x194),_0x3b5cca),console[_0x4b9abc(0x199)](_0x4b9abc(0x1b8),_0x4907cb[_0x4b9abc(0x18a)]),loggerService_1[_0x4b9abc(0x185)][_0x4b9abc(0x1c1)](_0x4b9abc(0x1c8),_0x4b9abc(0x19e),_0x4b9abc(0x18e)+_0x3b5cca);throw new Error(_0x4b9abc(0x1ae)+_0x3b5cca);}if(!_0x4907cb['id']||!_0x4907cb[_0x4b9abc(0x1c5)]?.[_0x4b9abc(0x17e)]){console['error'](_0x4b9abc(0x1bd)),console[_0x4b9abc(0x199)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x4b9abc(0x199)](_0x4b9abc(0x14e),_0x4907cb),loggerService_1['loggerService'][_0x4b9abc(0x1c1)](_0x4b9abc(0x1c8),'/payment-links',_0x4b9abc(0x1b6));throw new Error(_0x4b9abc(0x1a3));}return console['log'](_0x4b9abc(0x1bb)),console[_0x4b9abc(0x157)](_0x4b9abc(0x164),_0x4907cb['id']),console['log'](_0x4b9abc(0x171),_0x4907cb[_0x4b9abc(0x1c5)][_0x4b9abc(0x17e)]),console['log'](_0x4b9abc(0x195),_0x4907cb[_0x4b9abc(0x1c5)][_0x4b9abc(0x182)]||_0x4b9abc(0x1ab)),console[_0x4b9abc(0x157)](_0x4b9abc(0x1b9),_0x4576f7,_0x4b9abc(0x197)),console[_0x4b9abc(0x157)](_0x4b9abc(0x14c),_0x360155),{'gateway_payment_id':_0x4907cb['id'],'payment_url':_0x4907cb[_0x4b9abc(0x1c5)][_0x4b9abc(0x17e)],'qr_code_url':_0x4907cb[_0x4b9abc(0x1c5)]['qrCodeLink'],'expiry_date':_0x4907cb['expiryDate']};}catch(_0x4e2220){console['error'](_0x4b9abc(0x19c)),console['error']('Error\x20details:',_0x4e2220),loggerService_1[_0x4b9abc(0x185)][_0x4b9abc(0x1c1)]('noda',_0x4b9abc(0x19e),_0x4e2220);if(_0x4e2220 instanceof Error){console['error'](_0x4b9abc(0x189),_0x4e2220[_0x4b9abc(0x17a)]),console[_0x4b9abc(0x199)](_0x4b9abc(0x1b1),_0x4e2220[_0x4b9abc(0x1bc)]);throw new Error(_0x4b9abc(0x1b5)+_0x4e2220['message']);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a47_0x24723e(0x19d)](_0xfb2678){const _0x556f89=a47_0x24723e,_0x1f22a2=Date['now']();try{loggerService_1[_0x556f89(0x185)][_0x556f89(0x176)](_0x556f89(0x1c8),'/payment-links/'+_0xfb2678,'GET',{});const _0x234d10=await fetch(this['apiUrl']+'/'+_0xfb2678,{'method':_0x556f89(0x1b3),'headers':{'Content-Type':_0x556f89(0x168),'User-Agent':_0x556f89(0x163)}}),_0x4f44db=Date['now']()-_0x1f22a2;if(!_0x234d10['ok']){const _0x3359ca=await _0x234d10[_0x556f89(0x160)]();loggerService_1[_0x556f89(0x185)]['logWhiteDomainResponse'](_0x556f89(0x1c8),_0x556f89(0x179)+_0xfb2678,_0x234d10[_0x556f89(0x1b4)],_0x3359ca,_0x4f44db);throw new Error(_0x556f89(0x192)+_0x234d10[_0x556f89(0x1b4)]);}const _0x498feb=await _0x234d10[_0x556f89(0x1bf)]();loggerService_1[_0x556f89(0x185)]['logWhiteDomainResponse'](_0x556f89(0x1c8),_0x556f89(0x179)+_0xfb2678,_0x234d10['status'],_0x498feb,_0x4f44db);if(_0x498feb[_0x556f89(0x199)]||_0x498feb['statusCode']){loggerService_1['loggerService']['logWhiteDomainError'](_0x556f89(0x1c8),_0x556f89(0x179)+_0xfb2678,_0x556f89(0x1ae)+(_0x498feb[_0x556f89(0x17a)]||_0x498feb[_0x556f89(0x199)]||_0x556f89(0x1c9)));throw new Error('Noda\x20API\x20error:\x20'+(_0x498feb[_0x556f89(0x17a)]||_0x498feb[_0x556f89(0x199)]||_0x556f89(0x1c9)));}let _0x114a3b=_0x556f89(0x166);if(_0x498feb[_0x556f89(0x175)]===![]){if(_0x498feb[_0x556f89(0x1ac)]){const _0x39f083=new Date(_0x498feb[_0x556f89(0x1ac)]),_0x3f54a8=new Date();_0x39f083<_0x3f54a8?_0x114a3b=_0x556f89(0x1a9):_0x114a3b=_0x556f89(0x155);}else _0x114a3b=_0x556f89(0x155);}else _0x114a3b=_0x556f89(0x166);return{'status':_0x114a3b,'amount':_0x498feb[_0x556f89(0x1c2)],'currency':_0x498feb['currency'],'isActive':_0x498feb['isActive']};}catch(_0x2a97ae){console[_0x556f89(0x199)]('Noda\x20payment\x20verification\x20error:',_0x2a97ae),loggerService_1[_0x556f89(0x185)]['logWhiteDomainError']('noda',_0x556f89(0x179)+_0xfb2678,_0x2a97ae);throw new Error(_0x556f89(0x153)+(_0x2a97ae instanceof Error?_0x2a97ae[_0x556f89(0x17a)]:_0x556f89(0x1c9)));}}async['processWebhook'](_0x26338b){const _0x3574d4=a47_0x24723e;console['log'](_0x3574d4(0x165),_0x26338b);let _0x40defd=_0x3574d4(0x166);switch(_0x26338b[_0x3574d4(0x19f)]?.[_0x3574d4(0x17f)]()){case'done':case _0x3574d4(0x16f):case _0x3574d4(0x1b0):case _0x3574d4(0x170):case _0x3574d4(0x14b):_0x26338b[_0x3574d4(0x1a5)]===_0x3574d4(0x167)?_0x40defd='PAID':_0x40defd=_0x3574d4(0x166);break;case _0x3574d4(0x16e):case'canceled':case'failed':case _0x3574d4(0x199):case _0x3574d4(0x1ca):_0x40defd='FAILED';break;case _0x3574d4(0x151):case _0x3574d4(0x1ad):_0x40defd=_0x3574d4(0x1a9);break;case _0x3574d4(0x178):case _0x3574d4(0x1a7):case _0x3574d4(0x17c):case _0x3574d4(0x1a1):case _0x3574d4(0x1a4):default:_0x40defd=_0x3574d4(0x166);break;}return{'paymentId':_0x26338b[_0x3574d4(0x159)]||_0x26338b[_0x3574d4(0x1cb)],'status':_0x40defd,'amount':_0x26338b[_0x3574d4(0x16b)],'currency':_0x26338b[_0x3574d4(0x184)],'additionalInfo':{'method':_0x26338b[_0x3574d4(0x180)],'bankId':_0x26338b[_0x3574d4(0x1be)],'settled':_0x26338b['Settled'],'settlementDate':_0x26338b['SettlementDate'],'remitterName':_0x26338b[_0x3574d4(0x152)]?.[_0x3574d4(0x19b)],'remitterIban':_0x26338b['Remitter']?.[_0x3574d4(0x156)],'bankTransactionId':_0x26338b[_0x3574d4(0x1c0)]}};}[a47_0x24723e(0x19a)](_0x9d2190,_0x45f7ec){const _0x4ca520=a47_0x24723e;return console[_0x4ca520(0x157)](_0x4ca520(0x15d),{'receivedSignature':_0x45f7ec,'paymentId':_0x9d2190[_0x4ca520(0x1cb)],'merchantPaymentId':_0x9d2190[_0x4ca520(0x159)]}),!![];}}exports[a47_0x24723e(0x18d)]=NodaService;