'use strict';const a63_0x57587e=a63_0xc3ca;(function(_0x22ee7e,_0x80528d){const _0x2172a6=a63_0xc3ca,_0x14b28f=_0x22ee7e();while(!![]){try{const _0x156448=parseInt(_0x2172a6(0x98))/0x1+parseInt(_0x2172a6(0xb2))/0x2*(-parseInt(_0x2172a6(0xb8))/0x3)+parseInt(_0x2172a6(0xe5))/0x4+parseInt(_0x2172a6(0xce))/0x5*(parseInt(_0x2172a6(0xf2))/0x6)+parseInt(_0x2172a6(0xbd))/0x7+-parseInt(_0x2172a6(0xff))/0x8+-parseInt(_0x2172a6(0xe1))/0x9;if(_0x156448===_0x80528d)break;else _0x14b28f['push'](_0x14b28f['shift']());}catch(_0x155a8d){_0x14b28f['push'](_0x14b28f['shift']());}}}(a63_0x524c,0x3c2ec));Object[a63_0x57587e(0xc2)](exports,a63_0x57587e(0xd0),{'value':!![]}),exports[a63_0x57587e(0xed)]=void 0x0;const loggerService_1=require(a63_0x57587e(0x10a));function a63_0xc3ca(_0x2ee007,_0x10cd4e){_0x2ee007=_0x2ee007-0x95;const _0x524ca0=a63_0x524c();let _0xc3caa1=_0x524ca0[_0x2ee007];return _0xc3caa1;}class NodaService{constructor(){const _0x141893=a63_0x57587e;this[_0x141893(0xa7)]='https://tesoft.uk/gateway/noda/',console[_0x141893(0x10e)](_0x141893(0xe6));}async[a63_0x57587e(0xa0)](_0x48ab01){const _0x5b793c=a63_0x57587e,{orderId:_0x37f685,name:_0x517374,paymentDescription:_0x3da4bf,amount:_0x31ab51,currency:_0x38677f,webhookUrl:_0x39d6bd,returnUrl:_0x44b56c,expiryDate:_0x30a741}=_0x48ab01,_0x495bf1=_0x38677f[_0x5b793c(0xb4)](),_0x27ec55=_0x5b793c(0x97),_0x1a3e1f=_0x5b793c(0xcb)+_0x37f685,_0x107407={'name':_0x517374,'paymentDescription':_0x3da4bf,'amount':_0x31ab51,'currency':_0x495bf1,'paymentId':_0x37f685,'webhookUrl':_0x27ec55,'returnUrl':_0x1a3e1f};_0x30a741&&(_0x107407[_0x5b793c(0xf4)]=_0x30a741);const _0x19c389=Date[_0x5b793c(0x101)]();try{console['log'](_0x5b793c(0x10c)),console[_0x5b793c(0x10e)](_0x5b793c(0xc9),this['apiUrl']),console[_0x5b793c(0x10e)](_0x5b793c(0xef),JSON[_0x5b793c(0xd4)](_0x107407,null,0x2)),console[_0x5b793c(0x10e)]('Order\x20ID\x20Format:',_0x37f685,'(8digits-8digits\x20format\x20for\x20Noda)'),console['log'](_0x5b793c(0x9b),_0x1a3e1f),loggerService_1[_0x5b793c(0xf3)][_0x5b793c(0xe7)](_0x5b793c(0xea),'/payment-links',_0x5b793c(0xec),_0x107407);const _0x14bf3d=await fetch(this[_0x5b793c(0xa7)],{'method':_0x5b793c(0xec),'headers':{'Content-Type':_0x5b793c(0xd6),'Accept':_0x5b793c(0xd6),'User-Agent':_0x5b793c(0x9e)},'body':JSON[_0x5b793c(0xd4)](_0x107407)}),_0x2bfd2a=Date[_0x5b793c(0x101)]()-_0x19c389;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x5b793c(0x10e)](_0x5b793c(0xc6),_0x14bf3d[_0x5b793c(0xb0)]),console[_0x5b793c(0x10e)](_0x5b793c(0xc4),_0x14bf3d[_0x5b793c(0xc7)]),console[_0x5b793c(0x10e)](_0x5b793c(0x106),Object['fromEntries'](_0x14bf3d['headers'][_0x5b793c(0xcf)]())),console[_0x5b793c(0x10e)](_0x5b793c(0xc3),_0x2bfd2a+'ms');const _0x54c277=await _0x14bf3d['text']();console['log'](_0x5b793c(0xda),_0x54c277);if(!_0x14bf3d['ok']){console['error'](_0x5b793c(0xab)),console[_0x5b793c(0xad)]('HTTP\x20Status:',_0x14bf3d['status']),console[_0x5b793c(0xad)](_0x5b793c(0xfc),_0x54c277),loggerService_1[_0x5b793c(0xf3)]['logWhiteDomainResponse']('noda',_0x5b793c(0xb7),_0x14bf3d[_0x5b793c(0xb0)],_0x54c277,_0x2bfd2a),loggerService_1[_0x5b793c(0xf3)]['logWhiteDomainError']('noda','/payment-links',_0x5b793c(0xfa)+_0x14bf3d[_0x5b793c(0xb0)]+':\x20'+_0x54c277);if(_0x14bf3d['status']===0x190)throw new Error(_0x5b793c(0xe3));else{if(_0x14bf3d[_0x5b793c(0xb0)]===0x1f4)throw new Error(_0x5b793c(0xdb));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x14bf3d[_0x5b793c(0xb0)]+',\x20body:\x20'+_0x54c277);}let _0x464cbe;try{_0x464cbe=JSON['parse'](_0x54c277);}catch(_0x2c2a86){console[_0x5b793c(0xad)](_0x5b793c(0xaa),_0x2c2a86),loggerService_1[_0x5b793c(0xf3)][_0x5b793c(0xbb)](_0x5b793c(0xea),_0x5b793c(0xb7),_0x5b793c(0xf6)+_0x2c2a86);throw new Error(_0x5b793c(0xbe)+_0x54c277);}console[_0x5b793c(0x10e)](_0x5b793c(0xcc)),console[_0x5b793c(0x10e)](_0x5b793c(0x107),JSON[_0x5b793c(0xd4)](_0x464cbe,null,0x2)),loggerService_1['loggerService'][_0x5b793c(0xf5)](_0x5b793c(0xea),_0x5b793c(0xb7),_0x14bf3d[_0x5b793c(0xb0)],_0x464cbe,_0x2bfd2a);if(_0x464cbe[_0x5b793c(0xad)]||_0x464cbe[_0x5b793c(0xd9)]){const _0x2ef2e7=_0x464cbe[_0x5b793c(0xa4)]||_0x464cbe[_0x5b793c(0xad)]||_0x5b793c(0x99);console[_0x5b793c(0xad)](_0x5b793c(0xae)),console['error'](_0x5b793c(0x100),_0x2ef2e7),console['error']('Status\x20Code:',_0x464cbe[_0x5b793c(0xd9)]),loggerService_1['loggerService'][_0x5b793c(0xbb)](_0x5b793c(0xea),'/payment-links',_0x5b793c(0xb6)+_0x2ef2e7);throw new Error(_0x5b793c(0x9d)+_0x2ef2e7);}if(!_0x464cbe['id']||!_0x464cbe[_0x5b793c(0xca)]?.[_0x5b793c(0xf1)]){console['error'](_0x5b793c(0x95)),console['error'](_0x5b793c(0x10b)),console['error'](_0x5b793c(0xe9),_0x464cbe),loggerService_1['loggerService']['logWhiteDomainError']('noda','/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x5b793c(0xb5));}return console[_0x5b793c(0x10e)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x5b793c(0x10e)](_0x5b793c(0xdd),_0x464cbe['id']),console[_0x5b793c(0x10e)](_0x5b793c(0xa6),_0x464cbe[_0x5b793c(0xca)]['shortLink']),console[_0x5b793c(0x10e)](_0x5b793c(0xdc),_0x464cbe[_0x5b793c(0xca)][_0x5b793c(0x105)]||_0x5b793c(0xd3)),console['log'](_0x5b793c(0xb1),_0x37f685,_0x5b793c(0x9c)),console['log'](_0x5b793c(0xac),_0x1a3e1f),{'gateway_payment_id':_0x464cbe['id'],'payment_url':_0x464cbe['shortLinkUrls'][_0x5b793c(0xf1)],'qr_code_url':_0x464cbe[_0x5b793c(0xca)][_0x5b793c(0x105)],'expiry_date':_0x464cbe[_0x5b793c(0xf4)]};}catch(_0x10d879){console[_0x5b793c(0xad)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x5b793c(0xad)](_0x5b793c(0xa8),_0x10d879),loggerService_1[_0x5b793c(0xf3)][_0x5b793c(0xbb)]('noda',_0x5b793c(0xb7),_0x10d879);if(_0x10d879 instanceof Error){console['error'](_0x5b793c(0xa5),_0x10d879['message']),console[_0x5b793c(0xad)](_0x5b793c(0x109),_0x10d879[_0x5b793c(0x108)]);throw new Error(_0x5b793c(0xfe)+_0x10d879[_0x5b793c(0xa4)]);}throw new Error(_0x5b793c(0xfd));}}async['verifyPayment'](_0x415809){const _0x12170d=a63_0x57587e,_0xff9762=Date[_0x12170d(0x101)]();try{loggerService_1[_0x12170d(0xf3)][_0x12170d(0xe7)](_0x12170d(0xea),_0x12170d(0xe8)+_0x415809,_0x12170d(0xc1),{});const _0x13eb6b=await fetch(this['apiUrl']+'/'+_0x415809,{'method':_0x12170d(0xc1),'headers':{'Content-Type':_0x12170d(0xd6),'User-Agent':_0x12170d(0x9e)}}),_0x2a344b=Date['now']()-_0xff9762;if(!_0x13eb6b['ok']){const _0xe9fbe0=await _0x13eb6b['text']();loggerService_1[_0x12170d(0xf3)][_0x12170d(0xf5)](_0x12170d(0xea),_0x12170d(0xe8)+_0x415809,_0x13eb6b[_0x12170d(0xb0)],_0xe9fbe0,_0x2a344b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x13eb6b[_0x12170d(0xb0)]);}const _0x5a25e6=await _0x13eb6b[_0x12170d(0x9f)]();loggerService_1[_0x12170d(0xf3)]['logWhiteDomainResponse'](_0x12170d(0xea),_0x12170d(0xe8)+_0x415809,_0x13eb6b[_0x12170d(0xb0)],_0x5a25e6,_0x2a344b);if(_0x5a25e6[_0x12170d(0xad)]||_0x5a25e6[_0x12170d(0xd9)]){loggerService_1[_0x12170d(0xf3)]['logWhiteDomainError'](_0x12170d(0xea),_0x12170d(0xe8)+_0x415809,_0x12170d(0x9d)+(_0x5a25e6[_0x12170d(0xa4)]||_0x5a25e6[_0x12170d(0xad)]||_0x12170d(0xe2)));throw new Error(_0x12170d(0x9d)+(_0x5a25e6[_0x12170d(0xa4)]||_0x5a25e6['error']||_0x12170d(0xe2)));}let _0xc6d35b='PENDING';if(_0x5a25e6[_0x12170d(0x10d)]===![]){if(_0x5a25e6[_0x12170d(0xf4)]){const _0x280600=new Date(_0x5a25e6[_0x12170d(0xf4)]),_0x386828=new Date();_0x280600<_0x386828?_0xc6d35b=_0x12170d(0xd5):_0xc6d35b=_0x12170d(0xf8);}else _0xc6d35b='FAILED';}else _0xc6d35b='PENDING';return{'status':_0xc6d35b,'amount':_0x5a25e6[_0x12170d(0xcd)],'currency':_0x5a25e6[_0x12170d(0x9a)],'isActive':_0x5a25e6[_0x12170d(0x10d)]};}catch(_0x83beec){console['error'](_0x12170d(0xa2),_0x83beec),loggerService_1[_0x12170d(0xf3)][_0x12170d(0xbb)](_0x12170d(0xea),_0x12170d(0xe8)+_0x415809,_0x83beec);throw new Error(_0x12170d(0xf0)+(_0x83beec instanceof Error?_0x83beec['message']:_0x12170d(0xe2)));}}async[a63_0x57587e(0xe4)](_0x1f7042){const _0x3c9950=a63_0x57587e;console[_0x3c9950(0x10e)](_0x3c9950(0xd2),_0x1f7042);let _0x354925=_0x3c9950(0xde);switch(_0x1f7042[_0x3c9950(0x104)]?.['toLowerCase']()){case _0x3c9950(0xfb):case _0x3c9950(0xdf):case'paid':case _0x3c9950(0xd7):case _0x3c9950(0xeb):_0x1f7042['Settled']===_0x3c9950(0xc8)?_0x354925=_0x3c9950(0xbc):_0x354925='PENDING';break;case _0x3c9950(0xc5):case _0x3c9950(0x96):case'failed':case _0x3c9950(0xad):case'rejected':_0x354925=_0x3c9950(0xf8);break;case'expired':case _0x3c9950(0x102):_0x354925=_0x3c9950(0xd5);break;case _0x3c9950(0xa1):case _0x3c9950(0xee):case'active':case _0x3c9950(0xf7):case _0x3c9950(0xb9):default:_0x354925='PENDING';break;}return{'paymentId':_0x1f7042['MerchantPaymentId']||_0x1f7042['PaymentId'],'status':_0x354925,'amount':_0x1f7042[_0x3c9950(0xd8)],'currency':_0x1f7042[_0x3c9950(0xaf)],'additionalInfo':{'method':_0x1f7042[_0x3c9950(0xc0)],'bankId':_0x1f7042['BankId'],'settled':_0x1f7042[_0x3c9950(0xa9)],'settlementDate':_0x1f7042[_0x3c9950(0x103)],'remitterName':_0x1f7042['Remitter']?.[_0x3c9950(0xd1)],'remitterIban':_0x1f7042[_0x3c9950(0xbf)]?.[_0x3c9950(0xf9)],'bankTransactionId':_0x1f7042[_0x3c9950(0xe0)]}};}[a63_0x57587e(0xba)](_0x361e29,_0x3a17fe){const _0x18294a=a63_0x57587e;return console[_0x18294a(0x10e)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x3a17fe,'paymentId':_0x361e29[_0x18294a(0xa3)],'merchantPaymentId':_0x361e29[_0x18294a(0xb3)]}),!![];}}exports[a63_0x57587e(0xed)]=NodaService;function a63_0x524c(){const _0x2fb06c=['Iban','HTTP\x20','done','Response\x20Body:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','2562608etLBwx','Error\x20Message:','now','timeout','SettlementDate','Status','qrCodeLink','Headers:','Parsed\x20Result:','stack','Error\x20stack:','../loggerService','Missing\x20id\x20or\x20shortLink\x20in\x20response','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','isActive','log','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','canceled','https://tesoft.uk/gateway/noda/webhook/','152803voIMIx','Unknown\x20error\x20from\x20Noda\x20API','currency','âœ…\x20ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž:\x20Return\x20URL\x20uses\x20pending.php:','(8digits-8digits\x20format)','Noda\x20API\x20error:\x20','Payment\x20System/1.0','json','createPaymentLink','pending','Noda\x20payment\x20verification\x20error:','PaymentId','message','Error\x20message:','Short\x20Link:','apiUrl','Error\x20details:','Settled','Failed\x20to\x20parse\x20JSON\x20response:','===\x20NODA\x20API\x20ERROR\x20===','âœ…\x20Return\x20URL\x20configured\x20for\x20pending:','error','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Currency','status','Order\x20ID\x20Used:','411906oxegze','MerchantPaymentId','toUpperCase','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Business\x20Error:\x20','/payment-links','3aOrcKL','in_progress','verifyWebhookSignature','logWhiteDomainError','PAID','2245019QzirxM','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Remitter','Method','GET','defineProperty','Response\x20Time:','Status\x20Text:','cancelled','Status:','statusText','Yes','URL:','shortLinkUrls','https://tesoft.uk/gateway/pending.php?id=','===\x20PARSED\x20NODA\x20RESPONSE\x20===','amount','985GtZuTt','entries','__esModule','Name','Processing\x20Noda\x20webhook:','Not\x20provided','stringify','EXPIRED','application/json','success','Amount','statusCode','Raw\x20Response\x20Body:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','QR\x20Code\x20Link:','Payment\x20Link\x20ID:','PENDING','completed','BankTransactionId','35253nLmKms','Unknown\x20error','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','processWebhook','249012FgrOGL','ðŸŒ\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','logWhiteDomainRequest','/payment-links/','Response\x20data:','noda','successful','POST','NodaService','created','Request\x20Body\x20(Direct\x20JSON):','Failed\x20to\x20verify\x20Noda\x20payment:\x20','shortLink','7338CBKHFv','loggerService','expiryDate','logWhiteDomainResponse','JSON\x20Parse\x20Error:\x20','processing','FAILED'];a63_0x524c=function(){return _0x2fb06c;};return a63_0x524c();}