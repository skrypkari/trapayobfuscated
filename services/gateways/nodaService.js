'use strict';function a46_0x16bd(_0x464818,_0x1e75e9){const _0x551439=a46_0x5514();return a46_0x16bd=function(_0x16bd53,_0x5c1a25){_0x16bd53=_0x16bd53-0xb8;let _0x506ec9=_0x551439[_0x16bd53];return _0x506ec9;},a46_0x16bd(_0x464818,_0x1e75e9);}const a46_0x347355=a46_0x16bd;(function(_0x509354,_0x3cce9b){const _0x3d42c7=a46_0x16bd,_0x47d442=_0x509354();while(!![]){try{const _0x2bb1fa=parseInt(_0x3d42c7(0xca))/0x1*(-parseInt(_0x3d42c7(0x110))/0x2)+parseInt(_0x3d42c7(0x113))/0x3*(-parseInt(_0x3d42c7(0x119))/0x4)+-parseInt(_0x3d42c7(0xf0))/0x5+-parseInt(_0x3d42c7(0xec))/0x6*(parseInt(_0x3d42c7(0xef))/0x7)+-parseInt(_0x3d42c7(0x115))/0x8+-parseInt(_0x3d42c7(0xbb))/0x9+parseInt(_0x3d42c7(0xcc))/0xa;if(_0x2bb1fa===_0x3cce9b)break;else _0x47d442['push'](_0x47d442['shift']());}catch(_0x28b388){_0x47d442['push'](_0x47d442['shift']());}}}(a46_0x5514,0x7af83));function a46_0x5514(){const _0x5d0f0b=['4935888zcoNuT','timeout','Settled','HTTP\x20','8gntfxP','expired','log','fromEntries','FAILED','status','defineProperty','EXPIRED','stringify','Failed\x20to\x20verify\x20Noda\x20payment:\x20','message','statusCode','Order\x20ID\x20Format:','Yes','created','Error\x20details:','Short\x20Link:','../loggerService','BankTransactionId','json','JSON\x20Parse\x20Error:\x20','Method','Request\x20Body\x20(Direct\x20JSON):','cancelled','Error\x20message:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Noda\x20payment\x20verification\x20error:','2582001TVgstd','success','Missing\x20id\x20or\x20shortLink\x20in\x20response','logWhiteDomainRequest','in_progress','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Not\x20provided','===\x20NODA\x20API\x20ERROR\x20===','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','PAID','PaymentId','qrCodeLink','===\x20NODA\x20SERVICE\x20ERROR\x20===','Processing\x20Noda\x20webhook:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','7IjRiOE','Headers:','31820580lSxtSu','Raw\x20Response\x20Body:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','logWhiteDomainResponse','Name','expiryDate',',\x20body:\x20','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','stack','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','application/json','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','paid','canceled','Business\x20Error:\x20','completed','POST','Status','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Payment\x20Link\x20ID:','QR\x20Code\x20Link:','/payment-links','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','GET','verifyWebhookSignature','Response\x20Time:','shortLinkUrls','now','Currency','Amount','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Status\x20Code:','954UzOVHm','statusText','noda','16478lMJTiR','3551815ftRrnv','Failed\x20to\x20parse\x20JSON\x20response:','processWebhook','processing','Status:','Remitter','logWhiteDomainError','failed','NodaService','Unknown\x20error','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','HTTP\x20error!\x20status:\x20','loggerService','TesSoft\x20Payment\x20System/1.0','isActive','shortLink','Response\x20Body:','error','(8digits-8digits\x20format\x20for\x20Noda)','HTTP\x20Status:','text','Parsed\x20Result:','Status\x20Text:','pending','(8digits-8digits\x20format)','Error\x20stack:','Noda\x20API\x20error:\x20','apiUrl','parse','PENDING','successful','Response\x20data:','57202EoItEi','entries','Noda\x20webhook\x20signature\x20verification:','734466ufGODv','/payment-links/'];a46_0x5514=function(){return _0x5d0f0b;};return a46_0x5514();}Object[a46_0x347355(0x11f)](exports,'__esModule',{'value':!![]}),exports[a46_0x347355(0xf8)]=void 0x0;const loggerService_1=require(a46_0x347355(0x12a));class NodaService{constructor(){const _0xe9cb0=a46_0x347355;this[_0xe9cb0(0x10b)]='https://tesoft.uk/gateway/noda/',console[_0xe9cb0(0x11b)](_0xe9cb0(0xd5));}async['createPaymentLink'](_0x56cb45){const _0x503f7e=a46_0x347355,{orderId:_0x522caa,name:_0x204b35,paymentDescription:_0x285ff8,amount:_0x21dfc9,currency:_0x4d7f16,webhookUrl:_0x17734f,returnUrl:_0x2b7e90,expiryDate:_0x4d54a7}=_0x56cb45,_0x599ad1=_0x4d7f16['toUpperCase'](),_0x9ceb68='https://tesoft.uk/gateway/noda/webhook/',_0x2a48f8='https://tesoft.uk/gateway/pending.php?id='+_0x522caa,_0x3173aa={'name':_0x204b35,'paymentDescription':_0x285ff8,'amount':_0x21dfc9,'currency':_0x599ad1,'paymentId':_0x522caa,'webhookUrl':_0x9ceb68,'returnUrl':_0x2a48f8};_0x4d54a7&&(_0x3173aa[_0x503f7e(0xd1)]=_0x4d54a7);const _0xaac092=Date[_0x503f7e(0xe7)]();try{console['log'](_0x503f7e(0xc3)),console[_0x503f7e(0x11b)]('URL:',this[_0x503f7e(0x10b)]),console['log'](_0x503f7e(0x12f),JSON[_0x503f7e(0x121)](_0x3173aa,null,0x2)),console[_0x503f7e(0x11b)](_0x503f7e(0x125),_0x522caa,_0x503f7e(0x102)),console['log'](_0x503f7e(0xce),_0x2a48f8),loggerService_1[_0x503f7e(0xfc)][_0x503f7e(0xbe)]('noda','/payment-links',_0x503f7e(0xdc),_0x3173aa);const _0x576fcd=await fetch(this['apiUrl'],{'method':_0x503f7e(0xdc),'headers':{'Content-Type':_0x503f7e(0xd6),'Accept':_0x503f7e(0xd6),'User-Agent':_0x503f7e(0xfd)},'body':JSON[_0x503f7e(0x121)](_0x3173aa)}),_0x12878f=Date[_0x503f7e(0xe7)]()-_0xaac092;console[_0x503f7e(0x11b)](_0x503f7e(0xfa)),console[_0x503f7e(0x11b)](_0x503f7e(0xf4),_0x576fcd[_0x503f7e(0x11e)]),console[_0x503f7e(0x11b)](_0x503f7e(0x106),_0x576fcd[_0x503f7e(0xed)]),console[_0x503f7e(0x11b)](_0x503f7e(0xcb),Object[_0x503f7e(0x11c)](_0x576fcd['headers'][_0x503f7e(0x111)]())),console[_0x503f7e(0x11b)](_0x503f7e(0xe5),_0x12878f+'ms');const _0x5e06d7=await _0x576fcd[_0x503f7e(0x104)]();console['log'](_0x503f7e(0xcd),_0x5e06d7);if(!_0x576fcd['ok']){console['error'](_0x503f7e(0xc2)),console[_0x503f7e(0x101)](_0x503f7e(0x103),_0x576fcd['status']),console[_0x503f7e(0x101)](_0x503f7e(0x100),_0x5e06d7),loggerService_1[_0x503f7e(0xfc)][_0x503f7e(0xcf)](_0x503f7e(0xee),'/payment-links',_0x576fcd[_0x503f7e(0x11e)],_0x5e06d7,_0x12878f),loggerService_1[_0x503f7e(0xfc)][_0x503f7e(0xf6)](_0x503f7e(0xee),'/payment-links',_0x503f7e(0x118)+_0x576fcd[_0x503f7e(0x11e)]+':\x20'+_0x5e06d7);if(_0x576fcd[_0x503f7e(0x11e)]===0x190)throw new Error(_0x503f7e(0xe2));else{if(_0x576fcd['status']===0x1f4)throw new Error(_0x503f7e(0xc0));}throw new Error(_0x503f7e(0xfb)+_0x576fcd[_0x503f7e(0x11e)]+_0x503f7e(0xd2)+_0x5e06d7);}let _0x53a621;try{_0x53a621=JSON[_0x503f7e(0x10c)](_0x5e06d7);}catch(_0x2d1050){console['error'](_0x503f7e(0xf1),_0x2d1050),loggerService_1[_0x503f7e(0xfc)][_0x503f7e(0xf6)](_0x503f7e(0xee),_0x503f7e(0xe1),_0x503f7e(0x12d)+_0x2d1050);throw new Error(_0x503f7e(0xd7)+_0x5e06d7);}console['log'](_0x503f7e(0xea)),console['log'](_0x503f7e(0x105),JSON[_0x503f7e(0x121)](_0x53a621,null,0x2)),loggerService_1[_0x503f7e(0xfc)][_0x503f7e(0xcf)](_0x503f7e(0xee),_0x503f7e(0xe1),_0x576fcd[_0x503f7e(0x11e)],_0x53a621,_0x12878f);if(_0x53a621[_0x503f7e(0x101)]||_0x53a621['statusCode']){const _0x4fa835=_0x53a621[_0x503f7e(0x123)]||_0x53a621[_0x503f7e(0x101)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x503f7e(0x101)](_0x503f7e(0xc9)),console[_0x503f7e(0x101)]('Error\x20Message:',_0x4fa835),console[_0x503f7e(0x101)](_0x503f7e(0xeb),_0x53a621[_0x503f7e(0x124)]),loggerService_1[_0x503f7e(0xfc)][_0x503f7e(0xf6)](_0x503f7e(0xee),'/payment-links',_0x503f7e(0xda)+_0x4fa835);throw new Error(_0x503f7e(0x10a)+_0x4fa835);}if(!_0x53a621['id']||!_0x53a621[_0x503f7e(0xe6)]?.[_0x503f7e(0xff)]){console[_0x503f7e(0x101)](_0x503f7e(0xde)),console[_0x503f7e(0x101)](_0x503f7e(0xbd)),console[_0x503f7e(0x101)](_0x503f7e(0x10f),_0x53a621),loggerService_1[_0x503f7e(0xfc)][_0x503f7e(0xf6)](_0x503f7e(0xee),'/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x503f7e(0xb9));}return console[_0x503f7e(0x11b)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x503f7e(0x11b)](_0x503f7e(0xdf),_0x53a621['id']),console[_0x503f7e(0x11b)](_0x503f7e(0x129),_0x53a621['shortLinkUrls']['shortLink']),console[_0x503f7e(0x11b)](_0x503f7e(0xe0),_0x53a621[_0x503f7e(0xe6)][_0x503f7e(0xc6)]||_0x503f7e(0xc1)),console[_0x503f7e(0x11b)]('Order\x20ID\x20Used:',_0x522caa,_0x503f7e(0x108)),console['log'](_0x503f7e(0xd3),_0x2a48f8),{'gateway_payment_id':_0x53a621['id'],'payment_url':_0x53a621[_0x503f7e(0xe6)][_0x503f7e(0xff)],'qr_code_url':_0x53a621[_0x503f7e(0xe6)][_0x503f7e(0xc6)],'expiry_date':_0x53a621[_0x503f7e(0xd1)]};}catch(_0x1b2ab0){console[_0x503f7e(0x101)](_0x503f7e(0xc7)),console['error'](_0x503f7e(0x128),_0x1b2ab0),loggerService_1[_0x503f7e(0xfc)][_0x503f7e(0xf6)](_0x503f7e(0xee),_0x503f7e(0xe1),_0x1b2ab0);if(_0x1b2ab0 instanceof Error){console[_0x503f7e(0x101)](_0x503f7e(0x131),_0x1b2ab0['message']),console[_0x503f7e(0x101)](_0x503f7e(0x109),_0x1b2ab0[_0x503f7e(0xd4)]);throw new Error(_0x503f7e(0xb8)+_0x1b2ab0[_0x503f7e(0x123)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x4281cc){const _0x1ffe40=a46_0x347355,_0xc3be08=Date[_0x1ffe40(0xe7)]();try{loggerService_1[_0x1ffe40(0xfc)][_0x1ffe40(0xbe)](_0x1ffe40(0xee),'/payment-links/'+_0x4281cc,_0x1ffe40(0xe3),{});const _0x39b022=await fetch(this[_0x1ffe40(0x10b)]+'/'+_0x4281cc,{'method':_0x1ffe40(0xe3),'headers':{'Content-Type':_0x1ffe40(0xd6),'User-Agent':_0x1ffe40(0xfd)}}),_0x10b647=Date[_0x1ffe40(0xe7)]()-_0xc3be08;if(!_0x39b022['ok']){const _0x8ecbc7=await _0x39b022['text']();loggerService_1[_0x1ffe40(0xfc)][_0x1ffe40(0xcf)]('noda',_0x1ffe40(0x114)+_0x4281cc,_0x39b022[_0x1ffe40(0x11e)],_0x8ecbc7,_0x10b647);throw new Error('HTTP\x20error!\x20status:\x20'+_0x39b022[_0x1ffe40(0x11e)]);}const _0x1d2ff3=await _0x39b022[_0x1ffe40(0x12c)]();loggerService_1[_0x1ffe40(0xfc)][_0x1ffe40(0xcf)](_0x1ffe40(0xee),'/payment-links/'+_0x4281cc,_0x39b022[_0x1ffe40(0x11e)],_0x1d2ff3,_0x10b647);if(_0x1d2ff3[_0x1ffe40(0x101)]||_0x1d2ff3[_0x1ffe40(0x124)]){loggerService_1[_0x1ffe40(0xfc)][_0x1ffe40(0xf6)](_0x1ffe40(0xee),_0x1ffe40(0x114)+_0x4281cc,_0x1ffe40(0x10a)+(_0x1d2ff3[_0x1ffe40(0x123)]||_0x1d2ff3[_0x1ffe40(0x101)]||'Unknown\x20error'));throw new Error(_0x1ffe40(0x10a)+(_0x1d2ff3[_0x1ffe40(0x123)]||_0x1d2ff3[_0x1ffe40(0x101)]||_0x1ffe40(0xf9)));}let _0x1d2fe3='PENDING';if(_0x1d2ff3[_0x1ffe40(0xfe)]===![]){if(_0x1d2ff3[_0x1ffe40(0xd1)]){const _0x46f737=new Date(_0x1d2ff3['expiryDate']),_0x337d53=new Date();_0x46f737<_0x337d53?_0x1d2fe3=_0x1ffe40(0x120):_0x1d2fe3='FAILED';}else _0x1d2fe3='FAILED';}else _0x1d2fe3=_0x1ffe40(0x10d);return{'status':_0x1d2fe3,'amount':_0x1d2ff3['amount'],'currency':_0x1d2ff3['currency'],'isActive':_0x1d2ff3[_0x1ffe40(0xfe)]};}catch(_0x53ac25){console[_0x1ffe40(0x101)](_0x1ffe40(0xba),_0x53ac25),loggerService_1[_0x1ffe40(0xfc)][_0x1ffe40(0xf6)](_0x1ffe40(0xee),_0x1ffe40(0x114)+_0x4281cc,_0x53ac25);throw new Error(_0x1ffe40(0x122)+(_0x53ac25 instanceof Error?_0x53ac25['message']:_0x1ffe40(0xf9)));}}async[a46_0x347355(0xf2)](_0x1e99b4){const _0x571a98=a46_0x347355;console[_0x571a98(0x11b)](_0x571a98(0xc8),_0x1e99b4);let _0x46e0bd=_0x571a98(0x10d);switch(_0x1e99b4[_0x571a98(0xdd)]?.['toLowerCase']()){case'done':case _0x571a98(0xdb):case _0x571a98(0xd8):case _0x571a98(0xbc):case _0x571a98(0x10e):_0x1e99b4[_0x571a98(0x117)]===_0x571a98(0x126)?_0x46e0bd=_0x571a98(0xc4):_0x46e0bd=_0x571a98(0x10d);break;case _0x571a98(0x130):case _0x571a98(0xd9):case _0x571a98(0xf7):case'error':case'rejected':_0x46e0bd=_0x571a98(0x11d);break;case _0x571a98(0x11a):case _0x571a98(0x116):_0x46e0bd=_0x571a98(0x120);break;case _0x571a98(0x107):case _0x571a98(0x127):case'active':case _0x571a98(0xf3):case _0x571a98(0xbf):default:_0x46e0bd=_0x571a98(0x10d);break;}return{'paymentId':_0x1e99b4['MerchantPaymentId']||_0x1e99b4['PaymentId'],'status':_0x46e0bd,'amount':_0x1e99b4[_0x571a98(0xe9)],'currency':_0x1e99b4[_0x571a98(0xe8)],'additionalInfo':{'method':_0x1e99b4[_0x571a98(0x12e)],'bankId':_0x1e99b4['BankId'],'settled':_0x1e99b4[_0x571a98(0x117)],'settlementDate':_0x1e99b4['SettlementDate'],'remitterName':_0x1e99b4[_0x571a98(0xf5)]?.[_0x571a98(0xd0)],'remitterIban':_0x1e99b4[_0x571a98(0xf5)]?.['Iban'],'bankTransactionId':_0x1e99b4[_0x571a98(0x12b)]}};}[a46_0x347355(0xe4)](_0x196f1d,_0x49b549){const _0x520357=a46_0x347355;return console['log'](_0x520357(0x112),{'receivedSignature':_0x49b549,'paymentId':_0x196f1d[_0x520357(0xc5)],'merchantPaymentId':_0x196f1d['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;