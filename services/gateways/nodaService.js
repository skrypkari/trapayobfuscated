'use strict';const a40_0x448d56=a40_0xfdcb;(function(_0x3533f5,_0x20f30d){const _0x197c2c=a40_0xfdcb,_0x32f2f9=_0x3533f5();while(!![]){try{const _0xabb048=parseInt(_0x197c2c(0x207))/0x1+-parseInt(_0x197c2c(0x1f9))/0x2+-parseInt(_0x197c2c(0x1ff))/0x3*(-parseInt(_0x197c2c(0x217))/0x4)+parseInt(_0x197c2c(0x20b))/0x5*(parseInt(_0x197c2c(0x1eb))/0x6)+-parseInt(_0x197c2c(0x202))/0x7+-parseInt(_0x197c2c(0x22d))/0x8*(-parseInt(_0x197c2c(0x1f4))/0x9)+-parseInt(_0x197c2c(0x1de))/0xa*(parseInt(_0x197c2c(0x1d5))/0xb);if(_0xabb048===_0x20f30d)break;else _0x32f2f9['push'](_0x32f2f9['shift']());}catch(_0x4738af){_0x32f2f9['push'](_0x32f2f9['shift']());}}}(a40_0x4e22,0xc5a03));function a40_0x4e22(){const _0x5d0050=['apiUrl','cancelled','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Remitter','created','logWhiteDomainResponse','POST','245512YvkfKW','Raw\x20Response\x20Body:','https://tesoft.uk/gateway/success.php?id=','Not\x20provided','now','statusText','Unknown\x20error\x20from\x20Noda\x20API','(8digits-8digits\x20format\x20for\x20Noda)','FAILED','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Failed\x20to\x20parse\x20JSON\x20response:','Business\x20Error:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Noda\x20webhook\x20signature\x20verification:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','log','qrCodeLink','HTTP\x20error!\x20status:\x20','Error\x20stack:','error','TesSoft\x20Payment\x20System/1.0','processing','===\x20PARSED\x20NODA\x20RESPONSE\x20===','toUpperCase','defineProperty','/payment-links/','Response\x20Time:','isActive','Unknown\x20error','/payment-links','JSON\x20Parse\x20Error:\x20','successful','11YrvVoo','application/json','EXPIRED','PaymentId','Parsed\x20Result:','BankId','Processing\x20Noda\x20webhook:','json','pending','17508470oGgKEA','createPaymentLink','===\x20NODA\x20API\x20ERROR\x20===','Headers:','MerchantPaymentId','text','Status\x20Text:','success','Amount','HTTP\x20','Missing\x20id\x20or\x20shortLink\x20in\x20response','Method','logWhiteDomainError','786oBuZMY','statusCode','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','(8digits-8digits\x20format)','Status\x20Code:','Status:','HTTP\x20Status:','shortLinkUrls','NodaService','198Iiwpsn','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','entries','Noda\x20API\x20error:\x20','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','1412330MmqXOe','Response\x20data:','completed','failed','rejected','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','4656MrtuXi','__esModule','Settled','313250vCZEGB','toLowerCase','Error\x20message:','Error\x20details:','https://tesoft.uk/gateway/noda/webhook/','342130EwemyE','processWebhook','active','expiryDate','53435llxMki','Short\x20Link:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Iban','Failed\x20to\x20verify\x20Noda\x20payment:\x20','message','stack','Yes','done','loggerService','headers','SettlementDate','2304GfwSvA','timeout','Payment\x20Link\x20ID:','GET','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','logWhiteDomainRequest','shortLink','status','PENDING','Order\x20ID\x20Format:','verifyPayment','parse','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','noda','===\x20NODA\x20SERVICE\x20ERROR\x20==='];a40_0x4e22=function(){return _0x5d0050;};return a40_0x4e22();}function a40_0xfdcb(_0x2388b4,_0x360031){const _0x4e22af=a40_0x4e22();return a40_0xfdcb=function(_0xfdcb99,_0x36c498){_0xfdcb99=_0xfdcb99-0x1c6;let _0x129df6=_0x4e22af[_0xfdcb99];return _0x129df6;},a40_0xfdcb(_0x2388b4,_0x360031);}Object[a40_0x448d56(0x1cd)](exports,a40_0x448d56(0x200),{'value':!![]}),exports[a40_0x448d56(0x1f3)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x5d19e8=a40_0x448d56;this[_0x5d19e8(0x226)]='https://tesoft.uk/gateway/noda/',console['log'](_0x5d19e8(0x1fe));}async[a40_0x448d56(0x1df)](_0x18de00){const _0x3ec27b=a40_0x448d56,{orderId:_0x53d5ab,name:_0x41e4f6,paymentDescription:_0xdcde86,amount:_0x1eff0a,currency:_0x118c53,webhookUrl:_0x244667,returnUrl:_0x51b524,expiryDate:_0x56702e}=_0x18de00,_0x22f640=_0x118c53[_0x3ec27b(0x1cc)](),_0x4fe104=_0x3ec27b(0x206),_0x21ca16=_0x3ec27b(0x22f)+_0x53d5ab,_0x2cb8f1={'name':_0x41e4f6,'paymentDescription':_0xdcde86,'amount':_0x1eff0a,'currency':_0x22f640,'paymentId':_0x53d5ab,'webhookUrl':_0x4fe104,'returnUrl':_0x21ca16};_0x56702e&&(_0x2cb8f1[_0x3ec27b(0x20a)]=_0x56702e);const _0x901175=Date[_0x3ec27b(0x231)]();try{console[_0x3ec27b(0x23c)](_0x3ec27b(0x223)),console[_0x3ec27b(0x23c)]('URL:',this[_0x3ec27b(0x226)]),console[_0x3ec27b(0x23c)]('Request\x20Body\x20(Direct\x20JSON):',JSON['stringify'](_0x2cb8f1,null,0x2)),console[_0x3ec27b(0x23c)](_0x3ec27b(0x220),_0x53d5ab,_0x3ec27b(0x234)),loggerService_1[_0x3ec27b(0x214)]['logWhiteDomainRequest'](_0x3ec27b(0x224),_0x3ec27b(0x1d2),_0x3ec27b(0x22c),_0x2cb8f1);const _0xbbf5e8=await fetch(this[_0x3ec27b(0x226)],{'method':_0x3ec27b(0x22c),'headers':{'Content-Type':_0x3ec27b(0x1d6),'Accept':_0x3ec27b(0x1d6),'User-Agent':_0x3ec27b(0x1c9)},'body':JSON['stringify'](_0x2cb8f1)}),_0x893c9a=Date[_0x3ec27b(0x231)]()-_0x901175;console[_0x3ec27b(0x23c)](_0x3ec27b(0x228)),console['log'](_0x3ec27b(0x1f0),_0xbbf5e8[_0x3ec27b(0x21e)]),console[_0x3ec27b(0x23c)](_0x3ec27b(0x1e4),_0xbbf5e8[_0x3ec27b(0x232)]),console[_0x3ec27b(0x23c)](_0x3ec27b(0x1e1),Object['fromEntries'](_0xbbf5e8[_0x3ec27b(0x215)][_0x3ec27b(0x1f6)]())),console[_0x3ec27b(0x23c)](_0x3ec27b(0x1cf),_0x893c9a+'ms');const _0x82785b=await _0xbbf5e8[_0x3ec27b(0x1e3)]();console[_0x3ec27b(0x23c)](_0x3ec27b(0x22e),_0x82785b);if(!_0xbbf5e8['ok']){console[_0x3ec27b(0x1c8)](_0x3ec27b(0x1e0)),console[_0x3ec27b(0x1c8)](_0x3ec27b(0x1f1),_0xbbf5e8[_0x3ec27b(0x21e)]),console[_0x3ec27b(0x1c8)]('Response\x20Body:',_0x82785b),loggerService_1[_0x3ec27b(0x214)][_0x3ec27b(0x22b)](_0x3ec27b(0x224),_0x3ec27b(0x1d2),_0xbbf5e8[_0x3ec27b(0x21e)],_0x82785b,_0x893c9a),loggerService_1[_0x3ec27b(0x214)][_0x3ec27b(0x1ea)](_0x3ec27b(0x224),'/payment-links',_0x3ec27b(0x1e7)+_0xbbf5e8[_0x3ec27b(0x21e)]+':\x20'+_0x82785b);if(_0xbbf5e8['status']===0x190)throw new Error(_0x3ec27b(0x1f8));else{if(_0xbbf5e8[_0x3ec27b(0x21e)]===0x1f4)throw new Error(_0x3ec27b(0x20d));}throw new Error(_0x3ec27b(0x1c6)+_0xbbf5e8['status']+',\x20body:\x20'+_0x82785b);}let _0x3da801;try{_0x3da801=JSON[_0x3ec27b(0x222)](_0x82785b);}catch(_0x1aa933){console[_0x3ec27b(0x1c8)](_0x3ec27b(0x237),_0x1aa933),loggerService_1[_0x3ec27b(0x214)][_0x3ec27b(0x1ea)](_0x3ec27b(0x224),_0x3ec27b(0x1d2),_0x3ec27b(0x1d3)+_0x1aa933);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x82785b);}console[_0x3ec27b(0x23c)](_0x3ec27b(0x1cb)),console[_0x3ec27b(0x23c)](_0x3ec27b(0x1d9),JSON['stringify'](_0x3da801,null,0x2)),loggerService_1[_0x3ec27b(0x214)][_0x3ec27b(0x22b)](_0x3ec27b(0x224),'/payment-links',_0xbbf5e8[_0x3ec27b(0x21e)],_0x3da801,_0x893c9a);if(_0x3da801[_0x3ec27b(0x1c8)]||_0x3da801[_0x3ec27b(0x1ec)]){const _0x56f985=_0x3da801['message']||_0x3da801[_0x3ec27b(0x1c8)]||_0x3ec27b(0x233);console['error'](_0x3ec27b(0x1ed)),console['error']('Error\x20Message:',_0x56f985),console[_0x3ec27b(0x1c8)](_0x3ec27b(0x1ef),_0x3da801['statusCode']),loggerService_1['loggerService'][_0x3ec27b(0x1ea)](_0x3ec27b(0x224),_0x3ec27b(0x1d2),_0x3ec27b(0x238)+_0x56f985);throw new Error(_0x3ec27b(0x1f7)+_0x56f985);}if(!_0x3da801['id']||!_0x3da801[_0x3ec27b(0x1f2)]?.['shortLink']){console[_0x3ec27b(0x1c8)](_0x3ec27b(0x1f5)),console[_0x3ec27b(0x1c8)](_0x3ec27b(0x1e8)),console['error'](_0x3ec27b(0x1fa),_0x3da801),loggerService_1['loggerService'][_0x3ec27b(0x1ea)](_0x3ec27b(0x224),'/payment-links',_0x3ec27b(0x239));throw new Error(_0x3ec27b(0x236));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x3ec27b(0x219),_0x3da801['id']),console[_0x3ec27b(0x23c)](_0x3ec27b(0x20c),_0x3da801[_0x3ec27b(0x1f2)][_0x3ec27b(0x21d)]),console[_0x3ec27b(0x23c)]('QR\x20Code\x20Link:',_0x3da801[_0x3ec27b(0x1f2)][_0x3ec27b(0x23d)]||_0x3ec27b(0x230)),console[_0x3ec27b(0x23c)]('Order\x20ID\x20Used:',_0x53d5ab,_0x3ec27b(0x1ee)),{'gateway_payment_id':_0x3da801['id'],'payment_url':_0x3da801[_0x3ec27b(0x1f2)]['shortLink'],'qr_code_url':_0x3da801[_0x3ec27b(0x1f2)][_0x3ec27b(0x23d)],'expiry_date':_0x3da801['expiryDate']};}catch(_0x107ca5){console[_0x3ec27b(0x1c8)](_0x3ec27b(0x225)),console[_0x3ec27b(0x1c8)](_0x3ec27b(0x205),_0x107ca5),loggerService_1[_0x3ec27b(0x214)][_0x3ec27b(0x1ea)](_0x3ec27b(0x224),_0x3ec27b(0x1d2),_0x107ca5);if(_0x107ca5 instanceof Error){console['error'](_0x3ec27b(0x204),_0x107ca5[_0x3ec27b(0x210)]),console[_0x3ec27b(0x1c8)](_0x3ec27b(0x1c7),_0x107ca5[_0x3ec27b(0x211)]);throw new Error(_0x3ec27b(0x21b)+_0x107ca5[_0x3ec27b(0x210)]);}throw new Error(_0x3ec27b(0x23b));}}async[a40_0x448d56(0x221)](_0x582c65){const _0x55a5be=a40_0x448d56,_0x3cfb7b=Date['now']();try{loggerService_1[_0x55a5be(0x214)][_0x55a5be(0x21c)](_0x55a5be(0x224),_0x55a5be(0x1ce)+_0x582c65,_0x55a5be(0x21a),{});const _0x467aee=await fetch(this['apiUrl']+'/'+_0x582c65,{'method':'GET','headers':{'Content-Type':_0x55a5be(0x1d6),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x38cbfa=Date[_0x55a5be(0x231)]()-_0x3cfb7b;if(!_0x467aee['ok']){const _0x26dfae=await _0x467aee[_0x55a5be(0x1e3)]();loggerService_1[_0x55a5be(0x214)][_0x55a5be(0x22b)](_0x55a5be(0x224),'/payment-links/'+_0x582c65,_0x467aee[_0x55a5be(0x21e)],_0x26dfae,_0x38cbfa);throw new Error(_0x55a5be(0x1c6)+_0x467aee[_0x55a5be(0x21e)]);}const _0x5b2c7a=await _0x467aee[_0x55a5be(0x1dc)]();loggerService_1[_0x55a5be(0x214)][_0x55a5be(0x22b)](_0x55a5be(0x224),_0x55a5be(0x1ce)+_0x582c65,_0x467aee[_0x55a5be(0x21e)],_0x5b2c7a,_0x38cbfa);if(_0x5b2c7a[_0x55a5be(0x1c8)]||_0x5b2c7a[_0x55a5be(0x1ec)]){loggerService_1[_0x55a5be(0x214)][_0x55a5be(0x1ea)](_0x55a5be(0x224),'/payment-links/'+_0x582c65,_0x55a5be(0x1f7)+(_0x5b2c7a[_0x55a5be(0x210)]||_0x5b2c7a[_0x55a5be(0x1c8)]||_0x55a5be(0x1d1)));throw new Error(_0x55a5be(0x1f7)+(_0x5b2c7a[_0x55a5be(0x210)]||_0x5b2c7a[_0x55a5be(0x1c8)]||_0x55a5be(0x1d1)));}let _0x230040=_0x55a5be(0x21f);if(_0x5b2c7a['isActive']===![]){if(_0x5b2c7a['expiryDate']){const _0x158721=new Date(_0x5b2c7a[_0x55a5be(0x20a)]),_0x315323=new Date();_0x158721<_0x315323?_0x230040='EXPIRED':_0x230040=_0x55a5be(0x235);}else _0x230040=_0x55a5be(0x235);}else _0x230040=_0x55a5be(0x21f);return{'status':_0x230040,'amount':_0x5b2c7a['amount'],'currency':_0x5b2c7a['currency'],'isActive':_0x5b2c7a[_0x55a5be(0x1d0)]};}catch(_0x2418a8){console[_0x55a5be(0x1c8)]('Noda\x20payment\x20verification\x20error:',_0x2418a8),loggerService_1[_0x55a5be(0x214)][_0x55a5be(0x1ea)]('noda',_0x55a5be(0x1ce)+_0x582c65,_0x2418a8);throw new Error(_0x55a5be(0x20f)+(_0x2418a8 instanceof Error?_0x2418a8[_0x55a5be(0x210)]:_0x55a5be(0x1d1)));}}async[a40_0x448d56(0x208)](_0x421a9b){const _0x22e12e=a40_0x448d56;console[_0x22e12e(0x23c)](_0x22e12e(0x1db),_0x421a9b);let _0x175e57='PENDING';switch(_0x421a9b['Status']?.[_0x22e12e(0x203)]()){case _0x22e12e(0x213):case _0x22e12e(0x1fb):case'paid':case _0x22e12e(0x1e5):case _0x22e12e(0x1d4):_0x421a9b['Settled']===_0x22e12e(0x212)?_0x175e57='PAID':_0x175e57=_0x22e12e(0x21f);break;case _0x22e12e(0x227):case'canceled':case _0x22e12e(0x1fc):case _0x22e12e(0x1c8):case _0x22e12e(0x1fd):_0x175e57=_0x22e12e(0x235);break;case'expired':case _0x22e12e(0x218):_0x175e57=_0x22e12e(0x1d7);break;case _0x22e12e(0x1dd):case _0x22e12e(0x22a):case _0x22e12e(0x209):case _0x22e12e(0x1ca):case'in_progress':default:_0x175e57=_0x22e12e(0x21f);break;}return{'paymentId':_0x421a9b[_0x22e12e(0x1e2)]||_0x421a9b['PaymentId'],'status':_0x175e57,'amount':_0x421a9b[_0x22e12e(0x1e6)],'currency':_0x421a9b['Currency'],'additionalInfo':{'method':_0x421a9b[_0x22e12e(0x1e9)],'bankId':_0x421a9b[_0x22e12e(0x1da)],'settled':_0x421a9b[_0x22e12e(0x201)],'settlementDate':_0x421a9b[_0x22e12e(0x216)],'remitterName':_0x421a9b['Remitter']?.['Name'],'remitterIban':_0x421a9b[_0x22e12e(0x229)]?.[_0x22e12e(0x20e)],'bankTransactionId':_0x421a9b['BankTransactionId']}};}['verifyWebhookSignature'](_0x1c5877,_0x4f7b40){const _0x597977=a40_0x448d56;return console['log'](_0x597977(0x23a),{'receivedSignature':_0x4f7b40,'paymentId':_0x1c5877[_0x597977(0x1d8)],'merchantPaymentId':_0x1c5877[_0x597977(0x1e2)]}),!![];}}exports['NodaService']=NodaService;