'use strict';const a43_0x111d07=a43_0x7634;(function(_0x3d410c,_0x5c9cbc){const _0x22fc6e=a43_0x7634,_0x4ba885=_0x3d410c();while(!![]){try{const _0x26f78d=-parseInt(_0x22fc6e(0x1bd))/0x1*(-parseInt(_0x22fc6e(0x1e4))/0x2)+parseInt(_0x22fc6e(0x20a))/0x3*(-parseInt(_0x22fc6e(0x1ab))/0x4)+parseInt(_0x22fc6e(0x1ce))/0x5+-parseInt(_0x22fc6e(0x1c4))/0x6*(parseInt(_0x22fc6e(0x1aa))/0x7)+parseInt(_0x22fc6e(0x1bb))/0x8+-parseInt(_0x22fc6e(0x1a2))/0x9*(-parseInt(_0x22fc6e(0x202))/0xa)+-parseInt(_0x22fc6e(0x1b2))/0xb;if(_0x26f78d===_0x5c9cbc)break;else _0x4ba885['push'](_0x4ba885['shift']());}catch(_0x173c16){_0x4ba885['push'](_0x4ba885['shift']());}}}(a43_0x32ef,0x4acfa));function a43_0x7634(_0x29bf7f,_0x5103f6){const _0x32efdd=a43_0x32ef();return a43_0x7634=function(_0x763496,_0xc9099a){_0x763496=_0x763496-0x1a1;let _0xa39079=_0x32efdd[_0x763496];return _0xa39079;},a43_0x7634(_0x29bf7f,_0x5103f6);}Object[a43_0x111d07(0x220)](exports,a43_0x111d07(0x1a4),{'value':!![]}),exports[a43_0x111d07(0x1ca)]=void 0x0;const loggerService_1=require(a43_0x111d07(0x1e5));class NodaService{constructor(){const _0x40f8e=a43_0x111d07;this[_0x40f8e(0x1f3)]=_0x40f8e(0x216),console[_0x40f8e(0x211)](_0x40f8e(0x1da));}async[a43_0x111d07(0x213)](_0x3205e3){const _0x472261=a43_0x111d07,{orderId:_0xb1558d,name:_0x355416,paymentDescription:_0x150961,amount:_0x570551,currency:_0x4a90ff,webhookUrl:_0x422b21,returnUrl:_0x15c08f,expiryDate:_0x242b27}=_0x3205e3,_0x2f84f4=_0x4a90ff[_0x472261(0x1df)](),_0x3fe00c=_0x472261(0x201),_0x19b44b=_0x472261(0x208)+_0xb1558d,_0xc1ed83={'name':_0x355416,'paymentDescription':_0x150961,'amount':_0x570551,'currency':_0x2f84f4,'paymentId':_0xb1558d,'webhookUrl':_0x3fe00c,'returnUrl':_0x19b44b};_0x242b27&&(_0xc1ed83[_0x472261(0x1c6)]=_0x242b27);const _0x3d030b=Date[_0x472261(0x1b8)]();try{console[_0x472261(0x211)](_0x472261(0x1c2)),console[_0x472261(0x211)](_0x472261(0x1f1),this[_0x472261(0x1f3)]),console[_0x472261(0x211)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x472261(0x1e2)](_0xc1ed83,null,0x2)),console[_0x472261(0x211)](_0x472261(0x20c),_0xb1558d,_0x472261(0x21e)),console[_0x472261(0x211)](_0x472261(0x1dc),_0x19b44b),loggerService_1[_0x472261(0x1fa)][_0x472261(0x205)](_0x472261(0x1b6),'/payment-links',_0x472261(0x21b),_0xc1ed83);const _0x2c983e=await fetch(this[_0x472261(0x1f3)],{'method':_0x472261(0x21b),'headers':{'Content-Type':_0x472261(0x1cf),'Accept':_0x472261(0x1cf),'User-Agent':_0x472261(0x1ae)},'body':JSON[_0x472261(0x1e2)](_0xc1ed83)}),_0x102955=Date['now']()-_0x3d030b;console[_0x472261(0x211)](_0x472261(0x1ee)),console[_0x472261(0x211)](_0x472261(0x1eb),_0x2c983e[_0x472261(0x1e0)]),console[_0x472261(0x211)](_0x472261(0x1de),_0x2c983e['statusText']),console[_0x472261(0x211)]('Headers:',Object['fromEntries'](_0x2c983e['headers']['entries']())),console['log']('Response\x20Time:',_0x102955+'ms');const _0x35c017=await _0x2c983e['text']();console[_0x472261(0x211)](_0x472261(0x1f6),_0x35c017);if(!_0x2c983e['ok']){console[_0x472261(0x1ad)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x472261(0x1ad)](_0x472261(0x1d5),_0x2c983e['status']),console[_0x472261(0x1ad)](_0x472261(0x1cd),_0x35c017),loggerService_1[_0x472261(0x1fa)][_0x472261(0x1e7)](_0x472261(0x1b6),'/payment-links',_0x2c983e['status'],_0x35c017,_0x102955),loggerService_1[_0x472261(0x1fa)][_0x472261(0x21a)](_0x472261(0x1b6),_0x472261(0x1b3),_0x472261(0x1db)+_0x2c983e[_0x472261(0x1e0)]+':\x20'+_0x35c017);if(_0x2c983e[_0x472261(0x1e0)]===0x190)throw new Error(_0x472261(0x214));else{if(_0x2c983e['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error('HTTP\x20error!\x20status:\x20'+_0x2c983e[_0x472261(0x1e0)]+_0x472261(0x1e8)+_0x35c017);}let _0x1509e0;try{_0x1509e0=JSON[_0x472261(0x1ff)](_0x35c017);}catch(_0x600f71){console[_0x472261(0x1ad)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x600f71),loggerService_1[_0x472261(0x1fa)]['logWhiteDomainError'](_0x472261(0x1b6),_0x472261(0x1b3),'JSON\x20Parse\x20Error:\x20'+_0x600f71);throw new Error(_0x472261(0x1af)+_0x35c017);}console[_0x472261(0x211)](_0x472261(0x20f)),console[_0x472261(0x211)](_0x472261(0x1ba),JSON[_0x472261(0x1e2)](_0x1509e0,null,0x2)),loggerService_1[_0x472261(0x1fa)]['logWhiteDomainResponse'](_0x472261(0x1b6),'/payment-links',_0x2c983e['status'],_0x1509e0,_0x102955);if(_0x1509e0[_0x472261(0x1ad)]||_0x1509e0[_0x472261(0x1d9)]){const _0x34610f=_0x1509e0[_0x472261(0x20b)]||_0x1509e0['error']||_0x472261(0x1ef);console['error'](_0x472261(0x1a8)),console[_0x472261(0x1ad)](_0x472261(0x1ec),_0x34610f),console['error'](_0x472261(0x217),_0x1509e0[_0x472261(0x1d9)]),loggerService_1[_0x472261(0x1fa)][_0x472261(0x21a)](_0x472261(0x1b6),_0x472261(0x1b3),_0x472261(0x1ea)+_0x34610f);throw new Error('Noda\x20API\x20error:\x20'+_0x34610f);}if(!_0x1509e0['id']||!_0x1509e0[_0x472261(0x1be)]?.[_0x472261(0x1e6)]){console[_0x472261(0x1ad)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x472261(0x1ad)](_0x472261(0x200)),console[_0x472261(0x1ad)](_0x472261(0x1fc),_0x1509e0),loggerService_1[_0x472261(0x1fa)]['logWhiteDomainError'](_0x472261(0x1b6),_0x472261(0x1b3),_0x472261(0x1c9));throw new Error(_0x472261(0x207));}return console['log'](_0x472261(0x1c5)),console['log'](_0x472261(0x1dd),_0x1509e0['id']),console[_0x472261(0x211)](_0x472261(0x1f9),_0x1509e0[_0x472261(0x1be)][_0x472261(0x1e6)]),console[_0x472261(0x211)](_0x472261(0x1f2),_0x1509e0[_0x472261(0x1be)]['qrCodeLink']||'Not\x20provided'),console[_0x472261(0x211)]('Order\x20ID\x20Used:',_0xb1558d,_0x472261(0x212)),console[_0x472261(0x211)](_0x472261(0x1d6),_0x19b44b),{'gateway_payment_id':_0x1509e0['id'],'payment_url':_0x1509e0[_0x472261(0x1be)][_0x472261(0x1e6)],'qr_code_url':_0x1509e0[_0x472261(0x1be)][_0x472261(0x219)],'expiry_date':_0x1509e0['expiryDate']};}catch(_0x25fa0c){console['error'](_0x472261(0x1b4)),console[_0x472261(0x1ad)](_0x472261(0x203),_0x25fa0c),loggerService_1['loggerService'][_0x472261(0x21a)](_0x472261(0x1b6),'/payment-links',_0x25fa0c);if(_0x25fa0c instanceof Error){console['error'](_0x472261(0x1e1),_0x25fa0c['message']),console[_0x472261(0x1ad)](_0x472261(0x1b0),_0x25fa0c[_0x472261(0x1c1)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x25fa0c[_0x472261(0x20b)]);}throw new Error(_0x472261(0x1fd));}}async[a43_0x111d07(0x221)](_0x459fcc){const _0x1e210c=a43_0x111d07,_0x5c2125=Date[_0x1e210c(0x1b8)]();try{loggerService_1[_0x1e210c(0x1fa)][_0x1e210c(0x205)]('noda',_0x1e210c(0x1d1)+_0x459fcc,_0x1e210c(0x1bf),{});const _0x5e93cb=await fetch(this[_0x1e210c(0x1f3)]+'/'+_0x459fcc,{'method':_0x1e210c(0x1bf),'headers':{'Content-Type':_0x1e210c(0x1cf),'User-Agent':_0x1e210c(0x1ae)}}),_0x5348cb=Date[_0x1e210c(0x1b8)]()-_0x5c2125;if(!_0x5e93cb['ok']){const _0xf2a78d=await _0x5e93cb[_0x1e210c(0x204)]();loggerService_1[_0x1e210c(0x1fa)]['logWhiteDomainResponse']('noda',_0x1e210c(0x1d1)+_0x459fcc,_0x5e93cb[_0x1e210c(0x1e0)],_0xf2a78d,_0x5348cb);throw new Error(_0x1e210c(0x1f4)+_0x5e93cb[_0x1e210c(0x1e0)]);}const _0x495472=await _0x5e93cb[_0x1e210c(0x1a5)]();loggerService_1[_0x1e210c(0x1fa)]['logWhiteDomainResponse'](_0x1e210c(0x1b6),'/payment-links/'+_0x459fcc,_0x5e93cb['status'],_0x495472,_0x5348cb);if(_0x495472['error']||_0x495472['statusCode']){loggerService_1[_0x1e210c(0x1fa)][_0x1e210c(0x21a)]('noda',_0x1e210c(0x1d1)+_0x459fcc,_0x1e210c(0x1b7)+(_0x495472[_0x1e210c(0x20b)]||_0x495472[_0x1e210c(0x1ad)]||_0x1e210c(0x1a7)));throw new Error(_0x1e210c(0x1b7)+(_0x495472[_0x1e210c(0x20b)]||_0x495472[_0x1e210c(0x1ad)]||_0x1e210c(0x1a7)));}let _0x2e062a='PENDING';if(_0x495472[_0x1e210c(0x1c8)]===![]){if(_0x495472['expiryDate']){const _0x38f78d=new Date(_0x495472[_0x1e210c(0x1c6)]),_0x3e874e=new Date();_0x38f78d<_0x3e874e?_0x2e062a=_0x1e210c(0x1d2):_0x2e062a=_0x1e210c(0x1cb);}else _0x2e062a=_0x1e210c(0x1cb);}else _0x2e062a=_0x1e210c(0x1b5);return{'status':_0x2e062a,'amount':_0x495472[_0x1e210c(0x1f8)],'currency':_0x495472[_0x1e210c(0x20d)],'isActive':_0x495472[_0x1e210c(0x1c8)]};}catch(_0x140fe4){console[_0x1e210c(0x1ad)](_0x1e210c(0x218),_0x140fe4),loggerService_1[_0x1e210c(0x1fa)]['logWhiteDomainError'](_0x1e210c(0x1b6),'/payment-links/'+_0x459fcc,_0x140fe4);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x140fe4 instanceof Error?_0x140fe4[_0x1e210c(0x20b)]:_0x1e210c(0x1a7)));}}async['processWebhook'](_0x2c5c59){const _0x46300b=a43_0x111d07;console[_0x46300b(0x211)](_0x46300b(0x1a3),_0x2c5c59);let _0x4e7c67='PENDING';switch(_0x2c5c59[_0x46300b(0x206)]?.[_0x46300b(0x1a6)]()){case _0x46300b(0x1bc):case _0x46300b(0x20e):case _0x46300b(0x210):case _0x46300b(0x1d4):case _0x46300b(0x1b1):_0x2c5c59[_0x46300b(0x1a1)]===_0x46300b(0x1a9)?_0x4e7c67=_0x46300b(0x21c):_0x4e7c67='PENDING';break;case _0x46300b(0x1f0):case _0x46300b(0x1f7):case'failed':case _0x46300b(0x1ad):case _0x46300b(0x215):_0x4e7c67=_0x46300b(0x1cb);break;case _0x46300b(0x1c7):case _0x46300b(0x1c3):_0x4e7c67=_0x46300b(0x1d2);break;case _0x46300b(0x1ac):case _0x46300b(0x209):case _0x46300b(0x1fe):case _0x46300b(0x1d0):case _0x46300b(0x1cc):default:_0x4e7c67='PENDING';break;}return{'paymentId':_0x2c5c59[_0x46300b(0x1fb)]||_0x2c5c59[_0x46300b(0x1d3)],'status':_0x4e7c67,'amount':_0x2c5c59[_0x46300b(0x21d)],'currency':_0x2c5c59[_0x46300b(0x1e9)],'additionalInfo':{'method':_0x2c5c59[_0x46300b(0x1e3)],'bankId':_0x2c5c59['BankId'],'settled':_0x2c5c59[_0x46300b(0x1a1)],'settlementDate':_0x2c5c59[_0x46300b(0x1c0)],'remitterName':_0x2c5c59['Remitter']?.[_0x46300b(0x1ed)],'remitterIban':_0x2c5c59[_0x46300b(0x1f5)]?.[_0x46300b(0x1d8)],'bankTransactionId':_0x2c5c59[_0x46300b(0x21f)]}};}[a43_0x111d07(0x1b9)](_0x471427,_0x176530){const _0x9ccee3=a43_0x111d07;return console[_0x9ccee3(0x211)](_0x9ccee3(0x1d7),{'receivedSignature':_0x176530,'paymentId':_0x471427['PaymentId'],'merchantPaymentId':_0x471427[_0x9ccee3(0x1fb)]}),!![];}}exports[a43_0x111d07(0x1ca)]=NodaService;function a43_0x32ef(){const _0xeacada=['===\x20NODA\x20SERVICE\x20ERROR\x20===','PENDING','noda','Noda\x20API\x20error:\x20','now','verifyWebhookSignature','Parsed\x20Result:','4232088hJkDQK','done','115wIFwRn','shortLinkUrls','GET','SettlementDate','stack','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','timeout','1624206Abxokd','===\x20NODA\x20SUCCESS\x20===','expiryDate','expired','isActive','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','NodaService','FAILED','in_progress','Response\x20Body:','1722820mxKDKP','application/json','processing','/payment-links/','EXPIRED','PaymentId','success','HTTP\x20Status:','✅\x20Return\x20URL\x20configured\x20for\x20pending:','Noda\x20webhook\x20signature\x20verification:','Iban','statusCode','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','HTTP\x20','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','Payment\x20Link\x20ID:','Status\x20Text:','toUpperCase','status','Error\x20message:','stringify','Method','2390ZquLLk','../loggerService','shortLink','logWhiteDomainResponse',',\x20body:\x20','Currency','Business\x20Error:\x20','Status:','Error\x20Message:','Name','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Unknown\x20error\x20from\x20Noda\x20API','cancelled','URL:','QR\x20Code\x20Link:','apiUrl','HTTP\x20error!\x20status:\x20','Remitter','Raw\x20Response\x20Body:','canceled','amount','Short\x20Link:','loggerService','MerchantPaymentId','Response\x20data:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','active','parse','Missing\x20id\x20or\x20shortLink\x20in\x20response','https://tesoft.uk/gateway/noda/webhook/','18390TRqHtQ','Error\x20details:','text','logWhiteDomainRequest','Status','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','https://tesoft.uk/gateway/pending.php?id=','created','3pvAuyC','message','Order\x20ID\x20Format:','currency','completed','===\x20PARSED\x20NODA\x20RESPONSE\x20===','paid','log','(8digits-8digits\x20format)','createPaymentLink','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','rejected','https://tesoft.uk/gateway/noda/','Status\x20Code:','Noda\x20payment\x20verification\x20error:','qrCodeLink','logWhiteDomainError','POST','PAID','Amount','(8digits-8digits\x20format\x20for\x20Noda)','BankTransactionId','defineProperty','verifyPayment','Settled','1989HAULqw','Processing\x20Noda\x20webhook:','__esModule','json','toLowerCase','Unknown\x20error','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Yes','7gHaHzy','2405464kpWPtu','pending','error','TesSoft\x20Payment\x20System/1.0','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Error\x20stack:','successful','2628186Hmozcj','/payment-links'];a43_0x32ef=function(){return _0xeacada;};return a43_0x32ef();}