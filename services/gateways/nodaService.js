'use strict';const a40_0x3012b3=a40_0x2940;function a40_0xb2cb(){const _0x19eac9=['fromEntries','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Iban','SettlementDate','isActive','successful',',\x20body:\x20','25GIcdOP','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','https://tesoft.uk/gateway/noda/','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','18073AytVeJ','443681nBlNir','Order\x20ID\x20Format:','in_progress','created','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','text','Payment\x20Link\x20ID:','Status','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','PENDING','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Error\x20stack:','Parsed\x20Result:','message','paid','application/json','shortLink','(8digits-8digits\x20format\x20for\x20Noda)','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','pending','===\x20NODA\x20SUCCESS\x20===','../loggerService','cancelled','Unknown\x20error','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Currency','noda','shortLinkUrls','done','810dIsSQF','Response\x20data:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','logWhiteDomainError','BankTransactionId','GET','46203IAaIPN','log','json','URL:','QR\x20Code\x20Link:','/payment-links','toUpperCase','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Noda\x20webhook\x20signature\x20verification:','defineProperty','Order\x20ID\x20Used:','loggerService','Headers:','===\x20NODA\x20SERVICE\x20ERROR\x20===','timeout','logWhiteDomainRequest','PAID','headers','currency','Business\x20Error:\x20','failed','stringify','Status\x20Text:','17504aoARwV','1287468RkoNye','verifyPayment','statusCode','Yes','FAILED','103336sGXNiV','processWebhook','BankId','HTTP\x20','Amount','Error\x20Message:','expired','now','canceled','PaymentId','1722969OPbDyI','Failed\x20to\x20parse\x20JSON\x20response:','Noda\x20payment\x20verification\x20error:','NodaService','8xyfDPH','qrCodeLink','error','Response\x20Body:','completed','TesSoft\x20Payment\x20System/1.0','Short\x20Link:','Method','expiryDate','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','amount','https://tesoft.uk/gateway/noda/webhook/','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','active','apiUrl','/payment-links/','===\x20NODA\x20API\x20ERROR\x20===','Error\x20details:','logWhiteDomainResponse','Remitter','processing','Unknown\x20error\x20from\x20Noda\x20API','HTTP\x20error!\x20status:\x20','Status:','24vKpAzC','status','HTTP\x20Status:','Response\x20Time:','22NUBvsz','MerchantPaymentId','POST','Noda\x20API\x20error:\x20','Not\x20provided'];a40_0xb2cb=function(){return _0x19eac9;};return a40_0xb2cb();}function a40_0x2940(_0x4e9812,_0x253597){const _0xb2cbe9=a40_0xb2cb();return a40_0x2940=function(_0x29407c,_0xa43e27){_0x29407c=_0x29407c-0x1d5;let _0xd65454=_0xb2cbe9[_0x29407c];return _0xd65454;},a40_0x2940(_0x4e9812,_0x253597);}(function(_0x3042ac,_0x433b6e){const _0x44256d=a40_0x2940,_0x443301=_0x3042ac();while(!![]){try{const _0x5edea2=-parseInt(_0x44256d(0x1d9))/0x1*(parseInt(_0x44256d(0x209))/0x2)+-parseInt(_0x44256d(0x23d))/0x3+parseInt(_0x44256d(0x1df))/0x4*(-parseInt(_0x44256d(0x215))/0x5)+-parseInt(_0x44256d(0x205))/0x6*(-parseInt(_0x44256d(0x21a))/0x7)+-parseInt(_0x44256d(0x1ed))/0x8*(-parseInt(_0x44256d(0x1e9))/0x9)+-parseInt(_0x44256d(0x237))/0xa*(-parseInt(_0x44256d(0x219))/0xb)+-parseInt(_0x44256d(0x1da))/0xc;if(_0x5edea2===_0x433b6e)break;else _0x443301['push'](_0x443301['shift']());}catch(_0x37917f){_0x443301['push'](_0x443301['shift']());}}}(a40_0xb2cb,0x20a14));Object[a40_0x3012b3(0x246)](exports,'__esModule',{'value':!![]}),exports[a40_0x3012b3(0x1ec)]=void 0x0;const loggerService_1=require(a40_0x3012b3(0x22f));class NodaService{constructor(){const _0x454d1d=a40_0x3012b3;this[_0x454d1d(0x1fb)]=_0x454d1d(0x217),console[_0x454d1d(0x23e)](_0x454d1d(0x1f9));}async['createPaymentLink'](_0x27f2f8){const _0x380122=a40_0x3012b3,{orderId:_0x50b013,name:_0x5d4257,paymentDescription:_0x2d1b44,amount:_0xe90b63,currency:_0xd05b63,webhookUrl:_0x2f9442,returnUrl:_0x18a89d,expiryDate:_0x193243}=_0x27f2f8,_0x737f91=_0xd05b63[_0x380122(0x243)](),_0x49e115=_0x380122(0x1f8),_0x6833d='https://tesoft.uk/gateway/pending.php?id='+_0x50b013,_0x315ca6={'name':_0x5d4257,'paymentDescription':_0x2d1b44,'amount':_0xe90b63,'currency':_0x737f91,'paymentId':_0x50b013,'webhookUrl':_0x49e115,'returnUrl':_0x6833d};_0x193243&&(_0x315ca6[_0x380122(0x1f5)]=_0x193243);const _0x4fbdab=Date[_0x380122(0x1e6)]();try{console[_0x380122(0x23e)](_0x380122(0x21e)),console[_0x380122(0x23e)](_0x380122(0x240),this[_0x380122(0x1fb)]),console[_0x380122(0x23e)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x380122(0x1d7)](_0x315ca6,null,0x2)),console[_0x380122(0x23e)](_0x380122(0x21b),_0x50b013,_0x380122(0x22b)),console[_0x380122(0x23e)](_0x380122(0x232),_0x6833d),loggerService_1[_0x380122(0x248)]['logWhiteDomainRequest']('noda',_0x380122(0x242),_0x380122(0x20b),_0x315ca6);const _0xad2977=await fetch(this['apiUrl'],{'method':_0x380122(0x20b),'headers':{'Content-Type':'application/json','Accept':_0x380122(0x229),'User-Agent':_0x380122(0x1f2)},'body':JSON[_0x380122(0x1d7)](_0x315ca6)}),_0x40af7d=Date[_0x380122(0x1e6)]()-_0x4fbdab;console[_0x380122(0x23e)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x380122(0x204),_0xad2977[_0x380122(0x206)]),console[_0x380122(0x23e)](_0x380122(0x1d8),_0xad2977['statusText']),console[_0x380122(0x23e)](_0x380122(0x249),Object[_0x380122(0x20e)](_0xad2977[_0x380122(0x24e)]['entries']())),console[_0x380122(0x23e)](_0x380122(0x208),_0x40af7d+'ms');const _0x32ba9a=await _0xad2977[_0x380122(0x21f)]();console[_0x380122(0x23e)]('Raw\x20Response\x20Body:',_0x32ba9a);if(!_0xad2977['ok']){console[_0x380122(0x1ef)](_0x380122(0x1fd)),console['error'](_0x380122(0x207),_0xad2977[_0x380122(0x206)]),console['error'](_0x380122(0x1f0),_0x32ba9a),loggerService_1[_0x380122(0x248)][_0x380122(0x1ff)](_0x380122(0x234),'/payment-links',_0xad2977[_0x380122(0x206)],_0x32ba9a,_0x40af7d),loggerService_1[_0x380122(0x248)][_0x380122(0x23a)]('noda','/payment-links',_0x380122(0x1e2)+_0xad2977[_0x380122(0x206)]+':\x20'+_0x32ba9a);if(_0xad2977[_0x380122(0x206)]===0x190)throw new Error(_0x380122(0x224));else{if(_0xad2977[_0x380122(0x206)]===0x1f4)throw new Error(_0x380122(0x22c));}throw new Error(_0x380122(0x203)+_0xad2977[_0x380122(0x206)]+_0x380122(0x214)+_0x32ba9a);}let _0x440b98;try{_0x440b98=JSON['parse'](_0x32ba9a);}catch(_0x2db2c0){console[_0x380122(0x1ef)](_0x380122(0x1ea),_0x2db2c0),loggerService_1['loggerService']['logWhiteDomainError'](_0x380122(0x234),_0x380122(0x242),'JSON\x20Parse\x20Error:\x20'+_0x2db2c0);throw new Error(_0x380122(0x222)+_0x32ba9a);}console['log'](_0x380122(0x239)),console[_0x380122(0x23e)](_0x380122(0x226),JSON[_0x380122(0x1d7)](_0x440b98,null,0x2)),loggerService_1[_0x380122(0x248)]['logWhiteDomainResponse']('noda',_0x380122(0x242),_0xad2977[_0x380122(0x206)],_0x440b98,_0x40af7d);if(_0x440b98[_0x380122(0x1ef)]||_0x440b98[_0x380122(0x1dc)]){const _0xde4437=_0x440b98[_0x380122(0x227)]||_0x440b98[_0x380122(0x1ef)]||_0x380122(0x202);console[_0x380122(0x1ef)](_0x380122(0x244)),console[_0x380122(0x1ef)](_0x380122(0x1e4),_0xde4437),console[_0x380122(0x1ef)]('Status\x20Code:',_0x440b98[_0x380122(0x1dc)]),loggerService_1[_0x380122(0x248)]['logWhiteDomainError'](_0x380122(0x234),_0x380122(0x242),_0x380122(0x1d5)+_0xde4437);throw new Error('Noda\x20API\x20error:\x20'+_0xde4437);}if(!_0x440b98['id']||!_0x440b98[_0x380122(0x235)]?.[_0x380122(0x22a)]){console[_0x380122(0x1ef)](_0x380122(0x1f6)),console['error']('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x380122(0x1ef)](_0x380122(0x238),_0x440b98),loggerService_1[_0x380122(0x248)][_0x380122(0x23a)](_0x380122(0x234),_0x380122(0x242),_0x380122(0x218));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console['log'](_0x380122(0x22e)),console[_0x380122(0x23e)](_0x380122(0x220),_0x440b98['id']),console[_0x380122(0x23e)](_0x380122(0x1f3),_0x440b98[_0x380122(0x235)][_0x380122(0x22a)]),console[_0x380122(0x23e)](_0x380122(0x241),_0x440b98[_0x380122(0x235)]['qrCodeLink']||_0x380122(0x20d)),console[_0x380122(0x23e)](_0x380122(0x247),_0x50b013,'(8digits-8digits\x20format)'),console[_0x380122(0x23e)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x6833d),{'gateway_payment_id':_0x440b98['id'],'payment_url':_0x440b98[_0x380122(0x235)][_0x380122(0x22a)],'qr_code_url':_0x440b98[_0x380122(0x235)][_0x380122(0x1ee)],'expiry_date':_0x440b98[_0x380122(0x1f5)]};}catch(_0x2c624d){console[_0x380122(0x1ef)](_0x380122(0x24a)),console['error'](_0x380122(0x1fe),_0x2c624d),loggerService_1[_0x380122(0x248)][_0x380122(0x23a)]('noda','/payment-links',_0x2c624d);if(_0x2c624d instanceof Error){console[_0x380122(0x1ef)]('Error\x20message:',_0x2c624d[_0x380122(0x227)]),console['error'](_0x380122(0x225),_0x2c624d['stack']);throw new Error(_0x380122(0x216)+_0x2c624d[_0x380122(0x227)]);}throw new Error(_0x380122(0x20f));}}async[a40_0x3012b3(0x1db)](_0x127a8b){const _0x104007=a40_0x3012b3,_0x288769=Date[_0x104007(0x1e6)]();try{loggerService_1[_0x104007(0x248)][_0x104007(0x24c)]('noda','/payment-links/'+_0x127a8b,_0x104007(0x23c),{});const _0x1e2428=await fetch(this[_0x104007(0x1fb)]+'/'+_0x127a8b,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x104007(0x1f2)}}),_0x9cd25e=Date[_0x104007(0x1e6)]()-_0x288769;if(!_0x1e2428['ok']){const _0x59df0c=await _0x1e2428[_0x104007(0x21f)]();loggerService_1[_0x104007(0x248)][_0x104007(0x1ff)](_0x104007(0x234),_0x104007(0x1fc)+_0x127a8b,_0x1e2428[_0x104007(0x206)],_0x59df0c,_0x9cd25e);throw new Error(_0x104007(0x203)+_0x1e2428[_0x104007(0x206)]);}const _0x1a353d=await _0x1e2428[_0x104007(0x23f)]();loggerService_1[_0x104007(0x248)][_0x104007(0x1ff)]('noda',_0x104007(0x1fc)+_0x127a8b,_0x1e2428['status'],_0x1a353d,_0x9cd25e);if(_0x1a353d[_0x104007(0x1ef)]||_0x1a353d[_0x104007(0x1dc)]){loggerService_1[_0x104007(0x248)]['logWhiteDomainError'](_0x104007(0x234),_0x104007(0x1fc)+_0x127a8b,_0x104007(0x20c)+(_0x1a353d['message']||_0x1a353d[_0x104007(0x1ef)]||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x1a353d[_0x104007(0x227)]||_0x1a353d[_0x104007(0x1ef)]||'Unknown\x20error'));}let _0x9c5cc4=_0x104007(0x223);if(_0x1a353d[_0x104007(0x212)]===![]){if(_0x1a353d[_0x104007(0x1f5)]){const _0x50c095=new Date(_0x1a353d[_0x104007(0x1f5)]),_0x3b8ce1=new Date();_0x50c095<_0x3b8ce1?_0x9c5cc4='EXPIRED':_0x9c5cc4=_0x104007(0x1de);}else _0x9c5cc4=_0x104007(0x1de);}else _0x9c5cc4='PENDING';return{'status':_0x9c5cc4,'amount':_0x1a353d[_0x104007(0x1f7)],'currency':_0x1a353d[_0x104007(0x24f)],'isActive':_0x1a353d[_0x104007(0x212)]};}catch(_0x3f31b5){console[_0x104007(0x1ef)](_0x104007(0x1eb),_0x3f31b5),loggerService_1[_0x104007(0x248)]['logWhiteDomainError'](_0x104007(0x234),_0x104007(0x1fc)+_0x127a8b,_0x3f31b5);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x3f31b5 instanceof Error?_0x3f31b5[_0x104007(0x227)]:_0x104007(0x231)));}}async[a40_0x3012b3(0x1e0)](_0x327f7d){const _0x5633b6=a40_0x3012b3;console[_0x5633b6(0x23e)]('Processing\x20Noda\x20webhook:',_0x327f7d);let _0x2d803b='PENDING';switch(_0x327f7d[_0x5633b6(0x221)]?.['toLowerCase']()){case _0x5633b6(0x236):case _0x5633b6(0x1f1):case _0x5633b6(0x228):case'success':case _0x5633b6(0x213):_0x327f7d['Settled']===_0x5633b6(0x1dd)?_0x2d803b=_0x5633b6(0x24d):_0x2d803b=_0x5633b6(0x223);break;case _0x5633b6(0x230):case _0x5633b6(0x1e7):case _0x5633b6(0x1d6):case'error':case'rejected':_0x2d803b='FAILED';break;case _0x5633b6(0x1e5):case _0x5633b6(0x24b):_0x2d803b='EXPIRED';break;case _0x5633b6(0x22d):case _0x5633b6(0x21d):case _0x5633b6(0x1fa):case _0x5633b6(0x201):case _0x5633b6(0x21c):default:_0x2d803b=_0x5633b6(0x223);break;}return{'paymentId':_0x327f7d['MerchantPaymentId']||_0x327f7d['PaymentId'],'status':_0x2d803b,'amount':_0x327f7d[_0x5633b6(0x1e3)],'currency':_0x327f7d[_0x5633b6(0x233)],'additionalInfo':{'method':_0x327f7d[_0x5633b6(0x1f4)],'bankId':_0x327f7d[_0x5633b6(0x1e1)],'settled':_0x327f7d['Settled'],'settlementDate':_0x327f7d[_0x5633b6(0x211)],'remitterName':_0x327f7d[_0x5633b6(0x200)]?.['Name'],'remitterIban':_0x327f7d[_0x5633b6(0x200)]?.[_0x5633b6(0x210)],'bankTransactionId':_0x327f7d[_0x5633b6(0x23b)]}};}['verifyWebhookSignature'](_0x2129ee,_0x54000a){const _0x5012bd=a40_0x3012b3;return console[_0x5012bd(0x23e)](_0x5012bd(0x245),{'receivedSignature':_0x54000a,'paymentId':_0x2129ee[_0x5012bd(0x1e8)],'merchantPaymentId':_0x2129ee[_0x5012bd(0x20a)]}),!![];}}exports[a40_0x3012b3(0x1ec)]=NodaService;