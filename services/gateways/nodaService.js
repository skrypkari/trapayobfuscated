'use strict';function a44_0x5896(_0x23b5c3,_0x5af623){const _0x400915=a44_0x4009();return a44_0x5896=function(_0x5896f4,_0x18cab7){_0x5896f4=_0x5896f4-0x172;let _0x9a9708=_0x400915[_0x5896f4];return _0x9a9708;},a44_0x5896(_0x23b5c3,_0x5af623);}const a44_0x228f7f=a44_0x5896;(function(_0x31e961,_0x2cb9b3){const _0x13c7fb=a44_0x5896,_0x11d04c=_0x31e961();while(!![]){try{const _0x10f2e0=-parseInt(_0x13c7fb(0x1d7))/0x1+parseInt(_0x13c7fb(0x1d6))/0x2*(-parseInt(_0x13c7fb(0x1c4))/0x3)+parseInt(_0x13c7fb(0x1ba))/0x4+parseInt(_0x13c7fb(0x180))/0x5+parseInt(_0x13c7fb(0x196))/0x6*(parseInt(_0x13c7fb(0x18e))/0x7)+-parseInt(_0x13c7fb(0x1ce))/0x8*(-parseInt(_0x13c7fb(0x19f))/0x9)+-parseInt(_0x13c7fb(0x1bc))/0xa*(-parseInt(_0x13c7fb(0x1cf))/0xb);if(_0x10f2e0===_0x2cb9b3)break;else _0x11d04c['push'](_0x11d04c['shift']());}catch(_0x32dff7){_0x11d04c['push'](_0x11d04c['shift']());}}}(a44_0x4009,0xc03da));Object[a44_0x228f7f(0x1de)](exports,a44_0x228f7f(0x1a5),{'value':!![]}),exports[a44_0x228f7f(0x1a0)]=void 0x0;function a44_0x4009(){const _0x4fdc91=['Missing\x20id\x20or\x20shortLink\x20in\x20response','Short\x20Link:','expired','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainError','defineProperty','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','text','https://tesoft.uk/gateway/noda/','https://tesoft.uk/gateway/pending.php?id=','Raw\x20Response\x20Body:','Error\x20message:','apiUrl','Parsed\x20Result:','Response\x20data:','Name','statusText','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Request\x20Body\x20(Direct\x20JSON):','POST','verifyWebhookSignature','Method','Error\x20Message:','BankId','application/json','GET','log','verifyPayment','in_progress','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','3329770iUujJt','Processing\x20Noda\x20webhook:','qrCodeLink','done','logWhiteDomainRequest','entries','processing','loggerService','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Status\x20Code:','shortLink','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Remitter','stack','21CQhbyT','Not\x20provided','(8digits-8digits\x20format\x20for\x20Noda)','active','Business\x20Error:\x20','Payment\x20Link\x20ID:','success','cancelled','164502lSnYDW','amount','expiryDate','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Failed\x20to\x20parse\x20JSON\x20response:',',\x20body:\x20','Iban','error','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','243nwiDFB','NodaService','shortLinkUrls','message','/payment-links','currency','__esModule','Settled','Status:','Yes','EXPIRED','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','MerchantPaymentId','Order\x20ID\x20Used:','failed','(8digits-8digits\x20format)','TesSoft\x20Payment\x20System/1.0','noda','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','isActive','Noda\x20API\x20error:\x20','status','===\x20NODA\x20SUCCESS\x20===','logWhiteDomainResponse','Unknown\x20error\x20from\x20Noda\x20API','now','Error\x20stack:','5266072XoVggz','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','30abZTyr','Headers:','Amount','Unknown\x20error','stringify','Response\x20Body:','timeout','createPaymentLink','78615WAzqAq','===\x20NODA\x20API\x20ERROR\x20===','successful','QR\x20Code\x20Link:','JSON\x20Parse\x20Error:\x20','https://tesoft.uk/gateway/noda/webhook/','completed','toLowerCase','/payment-links/','FAILED','7064dHgOnQ','4770161XZfqYx','rejected','PENDING','paid','URL:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','toUpperCase','116XrUCCg','1082209wLFvZG','HTTP\x20error!\x20status:\x20'];a44_0x4009=function(){return _0x4fdc91;};return a44_0x4009();}const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x53f4cb=a44_0x228f7f;this[_0x53f4cb(0x1e5)]=_0x53f4cb(0x1e1),console[_0x53f4cb(0x17b)](_0x53f4cb(0x1bb));}async[a44_0x228f7f(0x1c3)](_0x5c6532){const _0x3f5e27=a44_0x228f7f,{orderId:_0x503b39,name:_0x2397d9,paymentDescription:_0x499be6,amount:_0xc27778,currency:_0x1935af,webhookUrl:_0x5209c6,returnUrl:_0x31bb98,expiryDate:_0x492c2d}=_0x5c6532,_0x44d187=_0x1935af[_0x3f5e27(0x1d5)](),_0x272ab7=_0x3f5e27(0x1c9),_0x914219=_0x3f5e27(0x1e2)+_0x503b39,_0x4dbd36={'name':_0x2397d9,'paymentDescription':_0x499be6,'amount':_0xc27778,'currency':_0x44d187,'paymentId':_0x503b39,'webhookUrl':_0x272ab7,'returnUrl':_0x914219};_0x492c2d&&(_0x4dbd36[_0x3f5e27(0x198)]=_0x492c2d);const _0x2154a3=Date[_0x3f5e27(0x1b8)]();try{console[_0x3f5e27(0x17b)](_0x3f5e27(0x1d4)),console[_0x3f5e27(0x17b)](_0x3f5e27(0x1d3),this['apiUrl']),console[_0x3f5e27(0x17b)](_0x3f5e27(0x173),JSON['stringify'](_0x4dbd36,null,0x2)),console[_0x3f5e27(0x17b)]('Order\x20ID\x20Format:',_0x503b39,_0x3f5e27(0x190)),console[_0x3f5e27(0x17b)](_0x3f5e27(0x17e),_0x914219),loggerService_1['loggerService'][_0x3f5e27(0x184)](_0x3f5e27(0x1b0),_0x3f5e27(0x1a3),_0x3f5e27(0x174),_0x4dbd36);const _0x352e82=await fetch(this[_0x3f5e27(0x1e5)],{'method':_0x3f5e27(0x174),'headers':{'Content-Type':_0x3f5e27(0x179),'Accept':_0x3f5e27(0x179),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x3f5e27(0x1c0)](_0x4dbd36)}),_0xd160b0=Date[_0x3f5e27(0x1b8)]()-_0x2154a3;console['log'](_0x3f5e27(0x1dc)),console[_0x3f5e27(0x17b)](_0x3f5e27(0x1a7),_0x352e82[_0x3f5e27(0x1b4)]),console[_0x3f5e27(0x17b)]('Status\x20Text:',_0x352e82[_0x3f5e27(0x1e9)]),console[_0x3f5e27(0x17b)](_0x3f5e27(0x1bd),Object['fromEntries'](_0x352e82['headers'][_0x3f5e27(0x185)]())),console['log']('Response\x20Time:',_0xd160b0+'ms');const _0x3d3716=await _0x352e82[_0x3f5e27(0x1e0)]();console[_0x3f5e27(0x17b)](_0x3f5e27(0x1e3),_0x3d3716);if(!_0x352e82['ok']){console[_0x3f5e27(0x19d)](_0x3f5e27(0x1c5)),console['error']('HTTP\x20Status:',_0x352e82[_0x3f5e27(0x1b4)]),console['error'](_0x3f5e27(0x1c1),_0x3d3716),loggerService_1['loggerService'][_0x3f5e27(0x1b6)]('noda',_0x3f5e27(0x1a3),_0x352e82['status'],_0x3d3716,_0xd160b0),loggerService_1[_0x3f5e27(0x187)][_0x3f5e27(0x1dd)](_0x3f5e27(0x1b0),_0x3f5e27(0x1a3),'HTTP\x20'+_0x352e82[_0x3f5e27(0x1b4)]+':\x20'+_0x3d3716);if(_0x352e82[_0x3f5e27(0x1b4)]===0x190)throw new Error(_0x3f5e27(0x19e));else{if(_0x352e82[_0x3f5e27(0x1b4)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x3f5e27(0x1d8)+_0x352e82[_0x3f5e27(0x1b4)]+_0x3f5e27(0x19b)+_0x3d3716);}let _0x4ad5ec;try{_0x4ad5ec=JSON['parse'](_0x3d3716);}catch(_0x1b5da0){console[_0x3f5e27(0x19d)](_0x3f5e27(0x19a),_0x1b5da0),loggerService_1[_0x3f5e27(0x187)]['logWhiteDomainError']('noda',_0x3f5e27(0x1a3),_0x3f5e27(0x1c8)+_0x1b5da0);throw new Error(_0x3f5e27(0x17f)+_0x3d3716);}console[_0x3f5e27(0x17b)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x3f5e27(0x17b)](_0x3f5e27(0x1e6),JSON[_0x3f5e27(0x1c0)](_0x4ad5ec,null,0x2)),loggerService_1['loggerService'][_0x3f5e27(0x1b6)]('noda','/payment-links',_0x352e82[_0x3f5e27(0x1b4)],_0x4ad5ec,_0xd160b0);if(_0x4ad5ec[_0x3f5e27(0x19d)]||_0x4ad5ec['statusCode']){const _0x1e7b15=_0x4ad5ec[_0x3f5e27(0x1a2)]||_0x4ad5ec[_0x3f5e27(0x19d)]||_0x3f5e27(0x1b7);console[_0x3f5e27(0x19d)](_0x3f5e27(0x172)),console[_0x3f5e27(0x19d)](_0x3f5e27(0x177),_0x1e7b15),console[_0x3f5e27(0x19d)](_0x3f5e27(0x189),_0x4ad5ec['statusCode']),loggerService_1[_0x3f5e27(0x187)][_0x3f5e27(0x1dd)](_0x3f5e27(0x1b0),_0x3f5e27(0x1a3),_0x3f5e27(0x192)+_0x1e7b15);throw new Error(_0x3f5e27(0x1b3)+_0x1e7b15);}if(!_0x4ad5ec['id']||!_0x4ad5ec[_0x3f5e27(0x1a1)]?.[_0x3f5e27(0x18a)]){console[_0x3f5e27(0x19d)](_0x3f5e27(0x1b1)),console[_0x3f5e27(0x19d)](_0x3f5e27(0x1d9)),console[_0x3f5e27(0x19d)](_0x3f5e27(0x1e7),_0x4ad5ec),loggerService_1['loggerService'][_0x3f5e27(0x1dd)](_0x3f5e27(0x1b0),'/payment-links',_0x3f5e27(0x1df));throw new Error(_0x3f5e27(0x1aa));}return console[_0x3f5e27(0x17b)](_0x3f5e27(0x1b5)),console[_0x3f5e27(0x17b)](_0x3f5e27(0x193),_0x4ad5ec['id']),console[_0x3f5e27(0x17b)](_0x3f5e27(0x1da),_0x4ad5ec['shortLinkUrls'][_0x3f5e27(0x18a)]),console[_0x3f5e27(0x17b)](_0x3f5e27(0x1c7),_0x4ad5ec['shortLinkUrls']['qrCodeLink']||_0x3f5e27(0x18f)),console[_0x3f5e27(0x17b)](_0x3f5e27(0x1ac),_0x503b39,_0x3f5e27(0x1ae)),console[_0x3f5e27(0x17b)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x914219),{'gateway_payment_id':_0x4ad5ec['id'],'payment_url':_0x4ad5ec[_0x3f5e27(0x1a1)][_0x3f5e27(0x18a)],'qr_code_url':_0x4ad5ec[_0x3f5e27(0x1a1)][_0x3f5e27(0x182)],'expiry_date':_0x4ad5ec[_0x3f5e27(0x198)]};}catch(_0x199d38){console[_0x3f5e27(0x19d)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x3f5e27(0x19d)]('Error\x20details:',_0x199d38),loggerService_1[_0x3f5e27(0x187)]['logWhiteDomainError'](_0x3f5e27(0x1b0),_0x3f5e27(0x1a3),_0x199d38);if(_0x199d38 instanceof Error){console['error'](_0x3f5e27(0x1e4),_0x199d38['message']),console[_0x3f5e27(0x19d)](_0x3f5e27(0x1b9),_0x199d38[_0x3f5e27(0x18d)]);throw new Error(_0x3f5e27(0x18b)+_0x199d38[_0x3f5e27(0x1a2)]);}throw new Error(_0x3f5e27(0x188));}}async[a44_0x228f7f(0x17c)](_0x17cc1f){const _0x4c7f8a=a44_0x228f7f,_0x1efe06=Date[_0x4c7f8a(0x1b8)]();try{loggerService_1[_0x4c7f8a(0x187)][_0x4c7f8a(0x184)](_0x4c7f8a(0x1b0),_0x4c7f8a(0x1cc)+_0x17cc1f,_0x4c7f8a(0x17a),{});const _0x3f7cdb=await fetch(this['apiUrl']+'/'+_0x17cc1f,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x4c7f8a(0x1af)}}),_0x1e4b11=Date['now']()-_0x1efe06;if(!_0x3f7cdb['ok']){const _0x84a7cb=await _0x3f7cdb[_0x4c7f8a(0x1e0)]();loggerService_1[_0x4c7f8a(0x187)][_0x4c7f8a(0x1b6)]('noda',_0x4c7f8a(0x1cc)+_0x17cc1f,_0x3f7cdb[_0x4c7f8a(0x1b4)],_0x84a7cb,_0x1e4b11);throw new Error(_0x4c7f8a(0x1d8)+_0x3f7cdb[_0x4c7f8a(0x1b4)]);}const _0x1a0281=await _0x3f7cdb['json']();loggerService_1['loggerService'][_0x4c7f8a(0x1b6)](_0x4c7f8a(0x1b0),_0x4c7f8a(0x1cc)+_0x17cc1f,_0x3f7cdb[_0x4c7f8a(0x1b4)],_0x1a0281,_0x1e4b11);if(_0x1a0281[_0x4c7f8a(0x19d)]||_0x1a0281['statusCode']){loggerService_1['loggerService'][_0x4c7f8a(0x1dd)](_0x4c7f8a(0x1b0),_0x4c7f8a(0x1cc)+_0x17cc1f,'Noda\x20API\x20error:\x20'+(_0x1a0281['message']||_0x1a0281[_0x4c7f8a(0x19d)]||_0x4c7f8a(0x1bf)));throw new Error(_0x4c7f8a(0x1b3)+(_0x1a0281[_0x4c7f8a(0x1a2)]||_0x1a0281['error']||_0x4c7f8a(0x1bf)));}let _0x27bcab=_0x4c7f8a(0x1d1);if(_0x1a0281['isActive']===![]){if(_0x1a0281[_0x4c7f8a(0x198)]){const _0x1cbf65=new Date(_0x1a0281[_0x4c7f8a(0x198)]),_0x536f37=new Date();_0x1cbf65<_0x536f37?_0x27bcab='EXPIRED':_0x27bcab=_0x4c7f8a(0x1cd);}else _0x27bcab=_0x4c7f8a(0x1cd);}else _0x27bcab=_0x4c7f8a(0x1d1);return{'status':_0x27bcab,'amount':_0x1a0281[_0x4c7f8a(0x197)],'currency':_0x1a0281[_0x4c7f8a(0x1a4)],'isActive':_0x1a0281[_0x4c7f8a(0x1b2)]};}catch(_0x185c29){console[_0x4c7f8a(0x19d)]('Noda\x20payment\x20verification\x20error:',_0x185c29),loggerService_1[_0x4c7f8a(0x187)]['logWhiteDomainError']('noda',_0x4c7f8a(0x1cc)+_0x17cc1f,_0x185c29);throw new Error(_0x4c7f8a(0x199)+(_0x185c29 instanceof Error?_0x185c29[_0x4c7f8a(0x1a2)]:_0x4c7f8a(0x1bf)));}}async['processWebhook'](_0x3e11aa){const _0x12075d=a44_0x228f7f;console[_0x12075d(0x17b)](_0x12075d(0x181),_0x3e11aa);let _0x4e0892='PENDING';switch(_0x3e11aa['Status']?.[_0x12075d(0x1cb)]()){case _0x12075d(0x183):case _0x12075d(0x1ca):case _0x12075d(0x1d2):case _0x12075d(0x194):case _0x12075d(0x1c6):_0x3e11aa[_0x12075d(0x1a6)]===_0x12075d(0x1a8)?_0x4e0892='PAID':_0x4e0892=_0x12075d(0x1d1);break;case _0x12075d(0x195):case'canceled':case _0x12075d(0x1ad):case _0x12075d(0x19d):case _0x12075d(0x1d0):_0x4e0892=_0x12075d(0x1cd);break;case _0x12075d(0x1db):case _0x12075d(0x1c2):_0x4e0892=_0x12075d(0x1a9);break;case'pending':case'created':case _0x12075d(0x191):case _0x12075d(0x186):case _0x12075d(0x17d):default:_0x4e0892=_0x12075d(0x1d1);break;}return{'paymentId':_0x3e11aa[_0x12075d(0x1ab)]||_0x3e11aa['PaymentId'],'status':_0x4e0892,'amount':_0x3e11aa[_0x12075d(0x1be)],'currency':_0x3e11aa['Currency'],'additionalInfo':{'method':_0x3e11aa[_0x12075d(0x176)],'bankId':_0x3e11aa[_0x12075d(0x178)],'settled':_0x3e11aa[_0x12075d(0x1a6)],'settlementDate':_0x3e11aa['SettlementDate'],'remitterName':_0x3e11aa[_0x12075d(0x18c)]?.[_0x12075d(0x1e8)],'remitterIban':_0x3e11aa[_0x12075d(0x18c)]?.[_0x12075d(0x19c)],'bankTransactionId':_0x3e11aa['BankTransactionId']}};}[a44_0x228f7f(0x175)](_0x22523d,_0x40f809){const _0x387562=a44_0x228f7f;return console[_0x387562(0x17b)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x40f809,'paymentId':_0x22523d['PaymentId'],'merchantPaymentId':_0x22523d[_0x387562(0x1ab)]}),!![];}}exports['NodaService']=NodaService;