'use strict';function a63_0x1fd7(_0x19195a,_0x51297a){_0x19195a=_0x19195a-0x70;const _0x2a1de3=a63_0x2a1d();let _0x1fd748=_0x2a1de3[_0x19195a];return _0x1fd748;}const a63_0x20752b=a63_0x1fd7;(function(_0x2c112b,_0x495f7b){const _0x47edcd=a63_0x1fd7,_0xdc4555=_0x2c112b();while(!![]){try{const _0x86249e=parseInt(_0x47edcd(0x91))/0x1+parseInt(_0x47edcd(0xdb))/0x2*(-parseInt(_0x47edcd(0xaf))/0x3)+parseInt(_0x47edcd(0x8c))/0x4+-parseInt(_0x47edcd(0xd2))/0x5*(-parseInt(_0x47edcd(0xcf))/0x6)+parseInt(_0x47edcd(0xa6))/0x7+parseInt(_0x47edcd(0x75))/0x8*(-parseInt(_0x47edcd(0xb0))/0x9)+-parseInt(_0x47edcd(0x7a))/0xa*(parseInt(_0x47edcd(0xe2))/0xb);if(_0x86249e===_0x495f7b)break;else _0xdc4555['push'](_0xdc4555['shift']());}catch(_0x23cb3a){_0xdc4555['push'](_0xdc4555['shift']());}}}(a63_0x2a1d,0xeaf72));function a63_0x2a1d(){const _0x4f3b4e=['Name','795064IBLYPx','URL:','shortLink','noda','error','469501NIgXkO','Failed\x20to\x20parse\x20JSON\x20response:','Yes','successful','Error\x20stack:','status','stringify','NodaService','Order\x20ID\x20Format:','Error\x20details:','logWhiteDomainError','timeout','Parsed\x20Result:','HTTP\x20error!\x20status:\x20','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','HTTP\x20','loggerService','Status\x20Code:','active','Status:','verifyWebhookSignature','747705PcyTfe','logWhiteDomainRequest','Iban','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Not\x20provided','createPaymentLink','Currency','expiryDate','failed','3ExuyPn','1251MIysCu','Missing\x20id\x20or\x20shortLink\x20in\x20response','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','text','apiUrl','Short\x20Link:','Noda\x20webhook\x20signature\x20verification:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','expired','Settled','(8digits-8digits\x20format)','rejected','headers','BankTransactionId','Processing\x20Noda\x20webhook:','toUpperCase','Error\x20Message:','SettlementDate','success','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','shortLinkUrls','Error\x20message:','(8digits-8digits\x20format\x20for\x20Noda)','/payment-links','log','Method','EXPIRED','Headers:','toLowerCase','FAILED','canceled','11046918EEXdht','message','Raw\x20Response\x20Body:','5SDitLZ','json','stack','POST','Remitter','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','https://tesoft.uk/gateway/noda/webhook/','currency','__esModule','728194SvPtlP','Response\x20Body:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','paid','Unknown\x20error','MerchantPaymentId','275QIGskq','Status','parse','/payment-links/','Noda\x20API\x20error:\x20','amount','processWebhook','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','now','Order\x20ID\x20Used:','verifyPayment','Response\x20data:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','statusText','Unknown\x20error\x20from\x20Noda\x20API','entries','19640lLpZyz','isActive','processing','application/json','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','379390JvCIRF','===\x20NODA\x20SUCCESS\x20===','Payment\x20System/1.0','../loggerService','JSON\x20Parse\x20Error:\x20','statusCode','done','PAID','PaymentId','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===',',\x20body:\x20','https://tesoft.uk/gateway/pending.php?id=','logWhiteDomainResponse','PENDING','Payment\x20Link\x20ID:','created'];a63_0x2a1d=function(){return _0x4f3b4e;};return a63_0x2a1d();}Object['defineProperty'](exports,a63_0x20752b(0xda),{'value':!![]}),exports[a63_0x20752b(0x98)]=void 0x0;const loggerService_1=require(a63_0x20752b(0x7d));class NodaService{constructor(){const _0x3a8618=a63_0x20752b;this[_0x3a8618(0xb4)]='https://tesoft.uk/gateway/noda/',console[_0x3a8618(0xc8)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a63_0x20752b(0xab)](_0x54d424){const _0x1322d7=a63_0x20752b,{orderId:_0x428967,name:_0x341831,paymentDescription:_0x7c157e,amount:_0x25a17f,currency:_0x5b95da,webhookUrl:_0xf365c0,returnUrl:_0x1f8546,expiryDate:_0x53dd97}=_0x54d424,_0x4a40e3=_0x5b95da[_0x1322d7(0xbf)](),_0x24e8f5=_0x1322d7(0xd8),_0x1fdf58=_0x1322d7(0x86)+_0x428967,_0x262da4={'name':_0x341831,'paymentDescription':_0x7c157e,'amount':_0x25a17f,'currency':_0x4a40e3,'paymentId':_0x428967,'webhookUrl':_0x24e8f5,'returnUrl':_0x1fdf58};_0x53dd97&&(_0x262da4[_0x1322d7(0xad)]=_0x53dd97);const _0x5410ba=Date[_0x1322d7(0xea)]();try{console[_0x1322d7(0xc8)](_0x1322d7(0x84)),console['log'](_0x1322d7(0x8d),this[_0x1322d7(0xb4)]),console['log']('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x1322d7(0x97)](_0x262da4,null,0x2)),console['log'](_0x1322d7(0x99),_0x428967,_0x1322d7(0xc6)),console['log'](_0x1322d7(0xb2),_0x1fdf58),loggerService_1[_0x1322d7(0xa1)][_0x1322d7(0xa7)]('noda',_0x1322d7(0xc7),'POST',_0x262da4);const _0x5cbe8b=await fetch(this[_0x1322d7(0xb4)],{'method':_0x1322d7(0xd5),'headers':{'Content-Type':_0x1322d7(0x78),'Accept':'application/json','User-Agent':_0x1322d7(0x7c)},'body':JSON[_0x1322d7(0x97)](_0x262da4)}),_0x27dd95=Date[_0x1322d7(0xea)]()-_0x5410ba;console[_0x1322d7(0xc8)](_0x1322d7(0xb7)),console[_0x1322d7(0xc8)](_0x1322d7(0xa4),_0x5cbe8b['status']),console[_0x1322d7(0xc8)]('Status\x20Text:',_0x5cbe8b[_0x1322d7(0x72)]),console['log'](_0x1322d7(0xcb),Object['fromEntries'](_0x5cbe8b[_0x1322d7(0xbc)][_0x1322d7(0x74)]())),console['log']('Response\x20Time:',_0x27dd95+'ms');const _0x4ac355=await _0x5cbe8b[_0x1322d7(0xb3)]();console[_0x1322d7(0xc8)](_0x1322d7(0xd1),_0x4ac355);if(!_0x5cbe8b['ok']){console[_0x1322d7(0x90)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x1322d7(0x90)]('HTTP\x20Status:',_0x5cbe8b[_0x1322d7(0x96)]),console[_0x1322d7(0x90)](_0x1322d7(0xdc),_0x4ac355),loggerService_1['loggerService'][_0x1322d7(0x87)](_0x1322d7(0x8f),'/payment-links',_0x5cbe8b['status'],_0x4ac355,_0x27dd95),loggerService_1['loggerService'][_0x1322d7(0x9b)](_0x1322d7(0x8f),_0x1322d7(0xc7),_0x1322d7(0xa0)+_0x5cbe8b[_0x1322d7(0x96)]+':\x20'+_0x4ac355);if(_0x5cbe8b[_0x1322d7(0x96)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x5cbe8b[_0x1322d7(0x96)]===0x1f4)throw new Error(_0x1322d7(0xe9));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x5cbe8b[_0x1322d7(0x96)]+_0x1322d7(0x85)+_0x4ac355);}let _0x217f26;try{_0x217f26=JSON[_0x1322d7(0xe4)](_0x4ac355);}catch(_0x2b87d8){console[_0x1322d7(0x90)](_0x1322d7(0x92),_0x2b87d8),loggerService_1[_0x1322d7(0xa1)][_0x1322d7(0x9b)](_0x1322d7(0x8f),_0x1322d7(0xc7),_0x1322d7(0x7e)+_0x2b87d8);throw new Error(_0x1322d7(0x9f)+_0x4ac355);}console[_0x1322d7(0xc8)](_0x1322d7(0x71)),console[_0x1322d7(0xc8)](_0x1322d7(0x9d),JSON[_0x1322d7(0x97)](_0x217f26,null,0x2)),loggerService_1[_0x1322d7(0xa1)][_0x1322d7(0x87)](_0x1322d7(0x8f),'/payment-links',_0x5cbe8b[_0x1322d7(0x96)],_0x217f26,_0x27dd95);if(_0x217f26['error']||_0x217f26[_0x1322d7(0x7f)]){const _0x2470e1=_0x217f26[_0x1322d7(0xd0)]||_0x217f26[_0x1322d7(0x90)]||_0x1322d7(0x73);console[_0x1322d7(0x90)](_0x1322d7(0xde)),console['error'](_0x1322d7(0xc0),_0x2470e1),console[_0x1322d7(0x90)](_0x1322d7(0xa2),_0x217f26[_0x1322d7(0x7f)]),loggerService_1[_0x1322d7(0xa1)][_0x1322d7(0x9b)](_0x1322d7(0x8f),_0x1322d7(0xc7),'Business\x20Error:\x20'+_0x2470e1);throw new Error(_0x1322d7(0xe6)+_0x2470e1);}if(!_0x217f26['id']||!_0x217f26['shortLinkUrls']?.[_0x1322d7(0x8e)]){console[_0x1322d7(0x90)](_0x1322d7(0x83)),console[_0x1322d7(0x90)](_0x1322d7(0xb1)),console[_0x1322d7(0x90)](_0x1322d7(0x70),_0x217f26),loggerService_1[_0x1322d7(0xa1)][_0x1322d7(0x9b)](_0x1322d7(0x8f),_0x1322d7(0xc7),_0x1322d7(0x79));throw new Error(_0x1322d7(0xdd));}return console[_0x1322d7(0xc8)](_0x1322d7(0x7b)),console['log'](_0x1322d7(0x89),_0x217f26['id']),console[_0x1322d7(0xc8)](_0x1322d7(0xb5),_0x217f26[_0x1322d7(0xc4)][_0x1322d7(0x8e)]),console[_0x1322d7(0xc8)]('QR\x20Code\x20Link:',_0x217f26[_0x1322d7(0xc4)]['qrCodeLink']||_0x1322d7(0xaa)),console[_0x1322d7(0xc8)](_0x1322d7(0xeb),_0x428967,_0x1322d7(0xba)),console[_0x1322d7(0xc8)](_0x1322d7(0xc3),_0x1fdf58),{'gateway_payment_id':_0x217f26['id'],'payment_url':_0x217f26['shortLinkUrls'][_0x1322d7(0x8e)],'qr_code_url':_0x217f26[_0x1322d7(0xc4)]['qrCodeLink'],'expiry_date':_0x217f26[_0x1322d7(0xad)]};}catch(_0x54ea0e){console[_0x1322d7(0x90)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x1322d7(0x90)](_0x1322d7(0x9a),_0x54ea0e),loggerService_1[_0x1322d7(0xa1)][_0x1322d7(0x9b)]('noda','/payment-links',_0x54ea0e);if(_0x54ea0e instanceof Error){console[_0x1322d7(0x90)](_0x1322d7(0xc5),_0x54ea0e[_0x1322d7(0xd0)]),console[_0x1322d7(0x90)](_0x1322d7(0x95),_0x54ea0e[_0x1322d7(0xd4)]);throw new Error(_0x1322d7(0xd7)+_0x54ea0e[_0x1322d7(0xd0)]);}throw new Error(_0x1322d7(0xa9));}}async[a63_0x20752b(0xec)](_0x201f88){const _0x142246=a63_0x20752b,_0xf0c5d7=Date[_0x142246(0xea)]();try{loggerService_1['loggerService'][_0x142246(0xa7)](_0x142246(0x8f),'/payment-links/'+_0x201f88,'GET',{});const _0x1e5279=await fetch(this[_0x142246(0xb4)]+'/'+_0x201f88,{'method':'GET','headers':{'Content-Type':_0x142246(0x78),'User-Agent':_0x142246(0x7c)}}),_0x7177b8=Date['now']()-_0xf0c5d7;if(!_0x1e5279['ok']){const _0x22db07=await _0x1e5279[_0x142246(0xb3)]();loggerService_1['loggerService'][_0x142246(0x87)](_0x142246(0x8f),_0x142246(0xe5)+_0x201f88,_0x1e5279['status'],_0x22db07,_0x7177b8);throw new Error(_0x142246(0x9e)+_0x1e5279[_0x142246(0x96)]);}const _0x59a793=await _0x1e5279[_0x142246(0xd3)]();loggerService_1[_0x142246(0xa1)]['logWhiteDomainResponse']('noda',_0x142246(0xe5)+_0x201f88,_0x1e5279[_0x142246(0x96)],_0x59a793,_0x7177b8);if(_0x59a793['error']||_0x59a793['statusCode']){loggerService_1['loggerService'][_0x142246(0x9b)](_0x142246(0x8f),_0x142246(0xe5)+_0x201f88,_0x142246(0xe6)+(_0x59a793[_0x142246(0xd0)]||_0x59a793[_0x142246(0x90)]||_0x142246(0xe0)));throw new Error(_0x142246(0xe6)+(_0x59a793['message']||_0x59a793[_0x142246(0x90)]||_0x142246(0xe0)));}let _0x588696=_0x142246(0x88);if(_0x59a793[_0x142246(0x76)]===![]){if(_0x59a793[_0x142246(0xad)]){const _0x59d748=new Date(_0x59a793[_0x142246(0xad)]),_0x342b06=new Date();_0x59d748<_0x342b06?_0x588696=_0x142246(0xca):_0x588696=_0x142246(0xcd);}else _0x588696=_0x142246(0xcd);}else _0x588696=_0x142246(0x88);return{'status':_0x588696,'amount':_0x59a793[_0x142246(0xe7)],'currency':_0x59a793[_0x142246(0xd9)],'isActive':_0x59a793[_0x142246(0x76)]};}catch(_0x13952c){console['error']('Noda\x20payment\x20verification\x20error:',_0x13952c),loggerService_1[_0x142246(0xa1)]['logWhiteDomainError'](_0x142246(0x8f),_0x142246(0xe5)+_0x201f88,_0x13952c);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x13952c instanceof Error?_0x13952c[_0x142246(0xd0)]:_0x142246(0xe0)));}}async[a63_0x20752b(0xe8)](_0x14a08d){const _0x320354=a63_0x20752b;console[_0x320354(0xc8)](_0x320354(0xbe),_0x14a08d);let _0x58f934=_0x320354(0x88);switch(_0x14a08d[_0x320354(0xe3)]?.[_0x320354(0xcc)]()){case _0x320354(0x80):case'completed':case _0x320354(0xdf):case _0x320354(0xc2):case _0x320354(0x94):_0x14a08d[_0x320354(0xb9)]===_0x320354(0x93)?_0x58f934=_0x320354(0x81):_0x58f934=_0x320354(0x88);break;case'cancelled':case _0x320354(0xce):case _0x320354(0xae):case _0x320354(0x90):case _0x320354(0xbb):_0x58f934='FAILED';break;case _0x320354(0xb8):case _0x320354(0x9c):_0x58f934=_0x320354(0xca);break;case'pending':case _0x320354(0x8a):case _0x320354(0xa3):case _0x320354(0x77):case'in_progress':default:_0x58f934=_0x320354(0x88);break;}return{'paymentId':_0x14a08d[_0x320354(0xe1)]||_0x14a08d[_0x320354(0x82)],'status':_0x58f934,'amount':_0x14a08d['Amount'],'currency':_0x14a08d[_0x320354(0xac)],'additionalInfo':{'method':_0x14a08d[_0x320354(0xc9)],'bankId':_0x14a08d['BankId'],'settled':_0x14a08d[_0x320354(0xb9)],'settlementDate':_0x14a08d[_0x320354(0xc1)],'remitterName':_0x14a08d['Remitter']?.[_0x320354(0x8b)],'remitterIban':_0x14a08d[_0x320354(0xd6)]?.[_0x320354(0xa8)],'bankTransactionId':_0x14a08d[_0x320354(0xbd)]}};}[a63_0x20752b(0xa5)](_0x3d3ef6,_0xfb13a7){const _0x32fd5c=a63_0x20752b;return console['log'](_0x32fd5c(0xb6),{'receivedSignature':_0xfb13a7,'paymentId':_0x3d3ef6[_0x32fd5c(0x82)],'merchantPaymentId':_0x3d3ef6['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;