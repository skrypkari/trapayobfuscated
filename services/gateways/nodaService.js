'use strict';function a44_0x2bd2(){const _0x33c976=[',\x20body:\x20','238962kzEWMg','Noda\x20webhook\x20signature\x20verification:','entries','Order\x20ID\x20Used:','Method','TesSoft\x20Payment\x20System/1.0','apiUrl','stack','3567716jnjIHw','Noda\x20API\x20error:\x20','Raw\x20Response\x20Body:','Missing\x20id\x20or\x20shortLink\x20in\x20response','toUpperCase','===\x20NODA\x20SUCCESS\x20===','pending','PENDING','Unknown\x20error','2853oedlSm','GET','33970KzIpMe','Headers:','===\x20NODA\x20API\x20ERROR\x20===','expiryDate','BankTransactionId','json','Status:','defineProperty','now','FAILED','HTTP\x20error!\x20status:\x20','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','created','https://tesoft.uk/gateway/pending.php?id=','5jaYfLe','Status\x20Text:','statusText','in_progress','HTTP\x20','loggerService','Request\x20Body\x20(Direct\x20JSON):','MerchantPaymentId','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Processing\x20Noda\x20webhook:','2572857oMgzvs','shortLink','isActive','statusCode','timeout','logWhiteDomainResponse','Iban','PAID','Failed\x20to\x20verify\x20Noda\x20payment:\x20','BankId','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','https://tesoft.uk/gateway/noda/webhook/','Short\x20Link:','1719McWYIZ','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','../loggerService','text','done','/payment-links','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','NodaService','successful','122dLIbmN','noda','Payment\x20Link\x20ID:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Unknown\x20error\x20from\x20Noda\x20API','expired','log','PaymentId','Response\x20Time:','__esModule','stringify','Error\x20details:','740652QKXuwA','error','processWebhook','Status','qrCodeLink','URL:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Error\x20message:','POST','message','https://tesoft.uk/gateway/noda/','Remitter','Currency','Failed\x20to\x20parse\x20JSON\x20response:','JSON\x20Parse\x20Error:\x20','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','amount','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','completed','Noda\x20payment\x20verification\x20error:','verifyWebhookSignature','Error\x20Message:','active','application/json','verifyPayment','/payment-links/','Business\x20Error:\x20','shortLinkUrls','cancelled','Parsed\x20Result:','failed','logWhiteDomainError','success','HTTP\x20Status:','createPaymentLink','2854368CsmQjO','paid','status','EXPIRED','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='];a44_0x2bd2=function(){return _0x33c976;};return a44_0x2bd2();}function a44_0x5405(_0x2eea1c,_0x34914e){const _0x2bd2d9=a44_0x2bd2();return a44_0x5405=function(_0x5405c3,_0x134290){_0x5405c3=_0x5405c3-0xe2;let _0x4e1829=_0x2bd2d9[_0x5405c3];return _0x4e1829;},a44_0x5405(_0x2eea1c,_0x34914e);}const a44_0x10e821=a44_0x5405;(function(_0x4deaf3,_0x48501b){const _0x50e580=a44_0x5405,_0x2e9cba=_0x4deaf3();while(!![]){try{const _0x1ac74f=parseInt(_0x50e580(0x123))/0x1+parseInt(_0x50e580(0xed))/0x2*(-parseInt(_0x50e580(0xe4))/0x3)+-parseInt(_0x50e580(0x12b))/0x4+-parseInt(_0x50e580(0x144))/0x5*(-parseInt(_0x50e580(0xfa))/0x6)+parseInt(_0x50e580(0x14e))/0x7+-parseInt(_0x50e580(0x11d))/0x8+parseInt(_0x50e580(0x134))/0x9*(parseInt(_0x50e580(0x136))/0xa);if(_0x1ac74f===_0x48501b)break;else _0x2e9cba['push'](_0x2e9cba['shift']());}catch(_0x243937){_0x2e9cba['push'](_0x2e9cba['shift']());}}}(a44_0x2bd2,0x7fb76));Object[a44_0x10e821(0x13d)](exports,a44_0x10e821(0xf7),{'value':!![]}),exports[a44_0x10e821(0xeb)]=void 0x0;const loggerService_1=require(a44_0x10e821(0xe6));class NodaService{constructor(){const _0x5272e8=a44_0x10e821;this[_0x5272e8(0x129)]=_0x5272e8(0x104),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a44_0x10e821(0x11c)](_0x4b4496){const _0x174c00=a44_0x10e821,{orderId:_0x3d9aa5,name:_0x153366,paymentDescription:_0x3c524e,amount:_0x3e8c9c,currency:_0x2b0614,webhookUrl:_0x498176,returnUrl:_0x60de94,expiryDate:_0x28d5ce}=_0x4b4496,_0x162316=_0x2b0614[_0x174c00(0x12f)](),_0x1f1896=_0x174c00(0xe2),_0x492443=_0x174c00(0x143)+_0x3d9aa5,_0x2218a6={'name':_0x153366,'paymentDescription':_0x3c524e,'amount':_0x3e8c9c,'currency':_0x162316,'paymentId':_0x3d9aa5,'webhookUrl':_0x1f1896,'returnUrl':_0x492443};_0x28d5ce&&(_0x2218a6['expiryDate']=_0x28d5ce);const _0x2d28b0=Date[_0x174c00(0x13e)]();try{console[_0x174c00(0xf4)](_0x174c00(0x10b)),console[_0x174c00(0xf4)](_0x174c00(0xff),this[_0x174c00(0x129)]),console[_0x174c00(0xf4)](_0x174c00(0x14a),JSON[_0x174c00(0xf8)](_0x2218a6,null,0x2)),console[_0x174c00(0xf4)]('Order\x20ID\x20Format:',_0x3d9aa5,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x174c00(0xf4)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x492443),loggerService_1[_0x174c00(0x149)]['logWhiteDomainRequest']('noda',_0x174c00(0xe9),_0x174c00(0x102),_0x2218a6);const _0x43d2f1=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x174c00(0x128)},'body':JSON['stringify'](_0x2218a6)}),_0x3de306=Date[_0x174c00(0x13e)]()-_0x2d28b0;console[_0x174c00(0xf4)](_0x174c00(0x121)),console[_0x174c00(0xf4)](_0x174c00(0x13c),_0x43d2f1[_0x174c00(0x11f)]),console[_0x174c00(0xf4)](_0x174c00(0x145),_0x43d2f1[_0x174c00(0x146)]),console[_0x174c00(0xf4)](_0x174c00(0x137),Object['fromEntries'](_0x43d2f1['headers'][_0x174c00(0x125)]())),console[_0x174c00(0xf4)](_0x174c00(0xf6),_0x3de306+'ms');const _0x47b9bc=await _0x43d2f1['text']();console[_0x174c00(0xf4)](_0x174c00(0x12d),_0x47b9bc);if(!_0x43d2f1['ok']){console['error'](_0x174c00(0x138)),console['error'](_0x174c00(0x11b),_0x43d2f1[_0x174c00(0x11f)]),console[_0x174c00(0xfb)]('Response\x20Body:',_0x47b9bc),loggerService_1[_0x174c00(0x149)][_0x174c00(0x153)](_0x174c00(0xee),_0x174c00(0xe9),_0x43d2f1['status'],_0x47b9bc,_0x3de306),loggerService_1[_0x174c00(0x149)][_0x174c00(0x119)]('noda','/payment-links',_0x174c00(0x148)+_0x43d2f1['status']+':\x20'+_0x47b9bc);if(_0x43d2f1[_0x174c00(0x11f)]===0x190)throw new Error(_0x174c00(0x109));else{if(_0x43d2f1['status']===0x1f4)throw new Error(_0x174c00(0xf0));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x43d2f1[_0x174c00(0x11f)]+_0x174c00(0x122)+_0x47b9bc);}let _0x135a3b;try{_0x135a3b=JSON['parse'](_0x47b9bc);}catch(_0x6d7559){console['error'](_0x174c00(0x107),_0x6d7559),loggerService_1[_0x174c00(0x149)]['logWhiteDomainError']('noda','/payment-links',_0x174c00(0x108)+_0x6d7559);throw new Error(_0x174c00(0xea)+_0x47b9bc);}console[_0x174c00(0xf4)](_0x174c00(0x14c)),console['log'](_0x174c00(0x117),JSON['stringify'](_0x135a3b,null,0x2)),loggerService_1[_0x174c00(0x149)]['logWhiteDomainResponse'](_0x174c00(0xee),_0x174c00(0xe9),_0x43d2f1[_0x174c00(0x11f)],_0x135a3b,_0x3de306);if(_0x135a3b[_0x174c00(0xfb)]||_0x135a3b['statusCode']){const _0xbae45b=_0x135a3b['message']||_0x135a3b[_0x174c00(0xfb)]||_0x174c00(0xf2);console['error'](_0x174c00(0x141)),console[_0x174c00(0xfb)](_0x174c00(0x10f),_0xbae45b),console[_0x174c00(0xfb)]('Status\x20Code:',_0x135a3b[_0x174c00(0x151)]),loggerService_1[_0x174c00(0x149)][_0x174c00(0x119)](_0x174c00(0xee),_0x174c00(0xe9),_0x174c00(0x114)+_0xbae45b);throw new Error(_0x174c00(0x12c)+_0xbae45b);}if(!_0x135a3b['id']||!_0x135a3b[_0x174c00(0x115)]?.[_0x174c00(0x14f)]){console[_0x174c00(0xfb)](_0x174c00(0x158)),console['error'](_0x174c00(0x12e)),console[_0x174c00(0xfb)]('Response\x20data:',_0x135a3b),loggerService_1[_0x174c00(0x149)]['logWhiteDomainError'](_0x174c00(0xee),_0x174c00(0xe9),_0x174c00(0x100));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x174c00(0xf4)](_0x174c00(0x130)),console['log'](_0x174c00(0xef),_0x135a3b['id']),console[_0x174c00(0xf4)](_0x174c00(0xe3),_0x135a3b['shortLinkUrls'][_0x174c00(0x14f)]),console[_0x174c00(0xf4)]('QR\x20Code\x20Link:',_0x135a3b['shortLinkUrls'][_0x174c00(0xfe)]||'Not\x20provided'),console['log'](_0x174c00(0x126),_0x3d9aa5,'(8digits-8digits\x20format)'),console[_0x174c00(0xf4)](_0x174c00(0xf1),_0x492443),{'gateway_payment_id':_0x135a3b['id'],'payment_url':_0x135a3b[_0x174c00(0x115)][_0x174c00(0x14f)],'qr_code_url':_0x135a3b[_0x174c00(0x115)]['qrCodeLink'],'expiry_date':_0x135a3b[_0x174c00(0x139)]};}catch(_0x462a05){console[_0x174c00(0xfb)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x174c00(0xfb)](_0x174c00(0xf9),_0x462a05),loggerService_1[_0x174c00(0x149)][_0x174c00(0x119)](_0x174c00(0xee),'/payment-links',_0x462a05);if(_0x462a05 instanceof Error){console[_0x174c00(0xfb)](_0x174c00(0x101),_0x462a05['message']),console['error']('Error\x20stack:',_0x462a05[_0x174c00(0x12a)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x462a05[_0x174c00(0x103)]);}throw new Error(_0x174c00(0xe5));}}async[a44_0x10e821(0x112)](_0x18960e){const _0x50ea29=a44_0x10e821,_0x3f55f6=Date[_0x50ea29(0x13e)]();try{loggerService_1[_0x50ea29(0x149)]['logWhiteDomainRequest'](_0x50ea29(0xee),_0x50ea29(0x113)+_0x18960e,_0x50ea29(0x135),{});const _0x8c4bc8=await fetch(this['apiUrl']+'/'+_0x18960e,{'method':_0x50ea29(0x135),'headers':{'Content-Type':_0x50ea29(0x111),'User-Agent':_0x50ea29(0x128)}}),_0xadb638=Date[_0x50ea29(0x13e)]()-_0x3f55f6;if(!_0x8c4bc8['ok']){const _0x1ed66e=await _0x8c4bc8[_0x50ea29(0xe7)]();loggerService_1[_0x50ea29(0x149)][_0x50ea29(0x153)]('noda','/payment-links/'+_0x18960e,_0x8c4bc8[_0x50ea29(0x11f)],_0x1ed66e,_0xadb638);throw new Error(_0x50ea29(0x140)+_0x8c4bc8[_0x50ea29(0x11f)]);}const _0x10e679=await _0x8c4bc8[_0x50ea29(0x13b)]();loggerService_1[_0x50ea29(0x149)][_0x50ea29(0x153)](_0x50ea29(0xee),_0x50ea29(0x113)+_0x18960e,_0x8c4bc8[_0x50ea29(0x11f)],_0x10e679,_0xadb638);if(_0x10e679[_0x50ea29(0xfb)]||_0x10e679[_0x50ea29(0x151)]){loggerService_1[_0x50ea29(0x149)][_0x50ea29(0x119)](_0x50ea29(0xee),_0x50ea29(0x113)+_0x18960e,'Noda\x20API\x20error:\x20'+(_0x10e679[_0x50ea29(0x103)]||_0x10e679[_0x50ea29(0xfb)]||'Unknown\x20error'));throw new Error(_0x50ea29(0x12c)+(_0x10e679['message']||_0x10e679['error']||'Unknown\x20error'));}let _0x291bf7='PENDING';if(_0x10e679[_0x50ea29(0x150)]===![]){if(_0x10e679[_0x50ea29(0x139)]){const _0x5b2658=new Date(_0x10e679[_0x50ea29(0x139)]),_0x3dadb7=new Date();_0x5b2658<_0x3dadb7?_0x291bf7=_0x50ea29(0x120):_0x291bf7=_0x50ea29(0x13f);}else _0x291bf7=_0x50ea29(0x13f);}else _0x291bf7=_0x50ea29(0x132);return{'status':_0x291bf7,'amount':_0x10e679[_0x50ea29(0x10a)],'currency':_0x10e679['currency'],'isActive':_0x10e679[_0x50ea29(0x150)]};}catch(_0x3fc351){console[_0x50ea29(0xfb)](_0x50ea29(0x10d),_0x3fc351),loggerService_1[_0x50ea29(0x149)]['logWhiteDomainError'](_0x50ea29(0xee),_0x50ea29(0x113)+_0x18960e,_0x3fc351);throw new Error(_0x50ea29(0x156)+(_0x3fc351 instanceof Error?_0x3fc351[_0x50ea29(0x103)]:_0x50ea29(0x133)));}}async[a44_0x10e821(0xfc)](_0x331a57){const _0x127c66=a44_0x10e821;console['log'](_0x127c66(0x14d),_0x331a57);let _0x58b844=_0x127c66(0x132);switch(_0x331a57[_0x127c66(0xfd)]?.['toLowerCase']()){case _0x127c66(0xe8):case _0x127c66(0x10c):case _0x127c66(0x11e):case _0x127c66(0x11a):case _0x127c66(0xec):_0x331a57['Settled']==='Yes'?_0x58b844=_0x127c66(0x155):_0x58b844=_0x127c66(0x132);break;case _0x127c66(0x116):case'canceled':case _0x127c66(0x118):case _0x127c66(0xfb):case'rejected':_0x58b844=_0x127c66(0x13f);break;case _0x127c66(0xf3):case _0x127c66(0x152):_0x58b844=_0x127c66(0x120);break;case _0x127c66(0x131):case _0x127c66(0x142):case _0x127c66(0x110):case'processing':case _0x127c66(0x147):default:_0x58b844=_0x127c66(0x132);break;}return{'paymentId':_0x331a57[_0x127c66(0x14b)]||_0x331a57[_0x127c66(0xf5)],'status':_0x58b844,'amount':_0x331a57['Amount'],'currency':_0x331a57[_0x127c66(0x106)],'additionalInfo':{'method':_0x331a57[_0x127c66(0x127)],'bankId':_0x331a57[_0x127c66(0x157)],'settled':_0x331a57['Settled'],'settlementDate':_0x331a57['SettlementDate'],'remitterName':_0x331a57[_0x127c66(0x105)]?.['Name'],'remitterIban':_0x331a57[_0x127c66(0x105)]?.[_0x127c66(0x154)],'bankTransactionId':_0x331a57[_0x127c66(0x13a)]}};}[a44_0x10e821(0x10e)](_0x482140,_0x4be851){const _0x5b021c=a44_0x10e821;return console[_0x5b021c(0xf4)](_0x5b021c(0x124),{'receivedSignature':_0x4be851,'paymentId':_0x482140[_0x5b021c(0xf5)],'merchantPaymentId':_0x482140[_0x5b021c(0x14b)]}),!![];}}exports[a44_0x10e821(0xeb)]=NodaService;