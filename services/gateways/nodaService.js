'use strict';const a51_0x262a01=a51_0x9b49;(function(_0xdcbbc1,_0x2b6fe8){const _0x359667=a51_0x9b49,_0xd755ae=_0xdcbbc1();while(!![]){try{const _0x44e27a=-parseInt(_0x359667(0xd2))/0x1*(-parseInt(_0x359667(0x95))/0x2)+parseInt(_0x359667(0xf2))/0x3*(-parseInt(_0x359667(0xfa))/0x4)+-parseInt(_0x359667(0x91))/0x5+parseInt(_0x359667(0xad))/0x6*(parseInt(_0x359667(0xfc))/0x7)+parseInt(_0x359667(0xe2))/0x8+parseInt(_0x359667(0xda))/0x9*(-parseInt(_0x359667(0x97))/0xa)+-parseInt(_0x359667(0x9a))/0xb*(-parseInt(_0x359667(0xe4))/0xc);if(_0x44e27a===_0x2b6fe8)break;else _0xd755ae['push'](_0xd755ae['shift']());}catch(_0x48c59c){_0xd755ae['push'](_0xd755ae['shift']());}}}(a51_0x19e5,0x22436));function a51_0x19e5(){const _0x14a915=['Payment\x20Link\x20ID:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Unknown\x20error\x20from\x20Noda\x20API','currency','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','JSON\x20Parse\x20Error:\x20','message','text','fromEntries','Business\x20Error:\x20','PAID','defineProperty',',\x20body:\x20','93240PTSLBn','toUpperCase','statusCode','rejected','10FMvJRO','Unknown\x20error','8990ljHekz','Order\x20ID\x20Format:','Short\x20Link:','946mgWtkh','Status','FAILED','paid','expiryDate','../loggerService','stack','(8digits-8digits\x20format)','Order\x20ID\x20Used:','__esModule','/payment-links/','noda','logWhiteDomainError','createPaymentLink','HTTP\x20','Failed\x20to\x20parse\x20JSON\x20response:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Payment\x20System/1.0','(8digits-8digits\x20format\x20for\x20Noda)','2562aamQSU','SettlementDate','BankId','Currency','loggerService','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Error\x20message:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','verifyWebhookSignature','error','failed','Error\x20Message:','active','Not\x20provided','Settled','successful','/payment-links','created','application/json','QR\x20Code\x20Link:','PaymentId','Request\x20Body\x20(Direct\x20JSON):','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','https://tesoft.uk/gateway/noda/webhook/','https://tesoft.uk/gateway/noda/','headers','GET','NodaService','Status:','success','HTTP\x20error!\x20status:\x20','qrCodeLink','now','Noda\x20webhook\x20signature\x20verification:','BankTransactionId','logWhiteDomainResponse','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','43891dBQTEo','isActive','EXPIRED','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Response\x20data:','processing','PENDING','stringify','2529uCijQL','Status\x20Code:','timeout','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','completed','shortLinkUrls','MerchantPaymentId','canceled','1324664IjIbin','logWhiteDomainRequest','13896XtNnws','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','cancelled','done','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','json','Raw\x20Response\x20Body:','status','HTTP\x20Status:','Parsed\x20Result:','log','expired','POST','===\x20NODA\x20API\x20ERROR\x20===','47397uxiQRX','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','apiUrl','Noda\x20payment\x20verification\x20error:','entries','shortLink','Error\x20stack:','Status\x20Text:','52gtrYyF','toLowerCase','2170ZhSUrc','Noda\x20API\x20error:\x20'];a51_0x19e5=function(){return _0x14a915;};return a51_0x19e5();}Object[a51_0x262a01(0x8f)](exports,a51_0x262a01(0xa3),{'value':!![]}),exports[a51_0x262a01(0xc8)]=void 0x0;const loggerService_1=require(a51_0x262a01(0x9f));function a51_0x9b49(_0x4d8905,_0x2b5841){const _0x19e533=a51_0x19e5();return a51_0x9b49=function(_0x9b497a,_0x558cd2){_0x9b497a=_0x9b497a-0x8f;let _0xf7db40=_0x19e533[_0x9b497a];return _0xf7db40;},a51_0x9b49(_0x4d8905,_0x2b5841);}class NodaService{constructor(){const _0x5b5bca=a51_0x262a01;this[_0x5b5bca(0xf4)]=_0x5b5bca(0xc5),console[_0x5b5bca(0xee)](_0x5b5bca(0xd5));}async[a51_0x262a01(0xa7)](_0x18ebe0){const _0x45dfa7=a51_0x262a01,{orderId:_0x593f0d,name:_0x2ce657,paymentDescription:_0x289518,amount:_0x20364f,currency:_0x58982f,webhookUrl:_0x17b19c,returnUrl:_0x36af7a,expiryDate:_0x417b31}=_0x18ebe0,_0x2ca0a5=_0x58982f[_0x45dfa7(0x92)](),_0x1dda75=_0x45dfa7(0xc4),_0x1eeaad='https://tesoft.uk/gateway/pending.php?id='+_0x593f0d,_0xb2ebbd={'name':_0x2ce657,'paymentDescription':_0x289518,'amount':_0x20364f,'currency':_0x2ca0a5,'paymentId':_0x593f0d,'webhookUrl':_0x1dda75,'returnUrl':_0x1eeaad};_0x417b31&&(_0xb2ebbd['expiryDate']=_0x417b31);const _0x3a6c6e=Date[_0x45dfa7(0xcd)]();try{console[_0x45dfa7(0xee)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x45dfa7(0xee)]('URL:',this[_0x45dfa7(0xf4)]),console['log'](_0x45dfa7(0xc2),JSON[_0x45dfa7(0xd9)](_0xb2ebbd,null,0x2)),console['log'](_0x45dfa7(0x98),_0x593f0d,_0x45dfa7(0xac)),console[_0x45dfa7(0xee)](_0x45dfa7(0xe8),_0x1eeaad),loggerService_1[_0x45dfa7(0xb1)]['logWhiteDomainRequest']('noda',_0x45dfa7(0xbd),_0x45dfa7(0xf0),_0xb2ebbd);const _0xd6d8c8=await fetch(this[_0x45dfa7(0xf4)],{'method':_0x45dfa7(0xf0),'headers':{'Content-Type':_0x45dfa7(0xbf),'Accept':'application/json','User-Agent':_0x45dfa7(0xab)},'body':JSON['stringify'](_0xb2ebbd)}),_0x4edcd9=Date[_0x45dfa7(0xcd)]()-_0x3a6c6e;console[_0x45dfa7(0xee)](_0x45dfa7(0xb4)),console[_0x45dfa7(0xee)](_0x45dfa7(0xc9),_0xd6d8c8[_0x45dfa7(0xeb)]),console[_0x45dfa7(0xee)](_0x45dfa7(0xf9),_0xd6d8c8['statusText']),console[_0x45dfa7(0xee)]('Headers:',Object[_0x45dfa7(0x106)](_0xd6d8c8[_0x45dfa7(0xc6)][_0x45dfa7(0xf6)]())),console[_0x45dfa7(0xee)]('Response\x20Time:',_0x4edcd9+'ms');const _0x4afcd2=await _0xd6d8c8[_0x45dfa7(0x105)]();console['log'](_0x45dfa7(0xea),_0x4afcd2);if(!_0xd6d8c8['ok']){console['error'](_0x45dfa7(0xf1)),console['error'](_0x45dfa7(0xec),_0xd6d8c8[_0x45dfa7(0xeb)]),console[_0x45dfa7(0xb6)]('Response\x20Body:',_0x4afcd2),loggerService_1[_0x45dfa7(0xb1)][_0x45dfa7(0xd0)]('noda','/payment-links',_0xd6d8c8[_0x45dfa7(0xeb)],_0x4afcd2,_0x4edcd9),loggerService_1[_0x45dfa7(0xb1)][_0x45dfa7(0xa6)]('noda',_0x45dfa7(0xbd),_0x45dfa7(0xa8)+_0xd6d8c8[_0x45dfa7(0xeb)]+':\x20'+_0x4afcd2);if(_0xd6d8c8[_0x45dfa7(0xeb)]===0x190)throw new Error(_0x45dfa7(0x102));else{if(_0xd6d8c8[_0x45dfa7(0xeb)]===0x1f4)throw new Error(_0x45dfa7(0xc3));}throw new Error(_0x45dfa7(0xcb)+_0xd6d8c8['status']+_0x45dfa7(0x90)+_0x4afcd2);}let _0xfa8ab5;try{_0xfa8ab5=JSON['parse'](_0x4afcd2);}catch(_0x38048b){console['error'](_0x45dfa7(0xa9),_0x38048b),loggerService_1[_0x45dfa7(0xb1)][_0x45dfa7(0xa6)](_0x45dfa7(0xa5),'/payment-links',_0x45dfa7(0x103)+_0x38048b);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x4afcd2);}console[_0x45dfa7(0xee)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console['log'](_0x45dfa7(0xed),JSON[_0x45dfa7(0xd9)](_0xfa8ab5,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x45dfa7(0xa5),_0x45dfa7(0xbd),_0xd6d8c8[_0x45dfa7(0xeb)],_0xfa8ab5,_0x4edcd9);if(_0xfa8ab5['error']||_0xfa8ab5['statusCode']){const _0x1178c3=_0xfa8ab5[_0x45dfa7(0x104)]||_0xfa8ab5[_0x45dfa7(0xb6)]||_0x45dfa7(0x100);console[_0x45dfa7(0xb6)](_0x45dfa7(0xaa)),console[_0x45dfa7(0xb6)](_0x45dfa7(0xb8),_0x1178c3),console[_0x45dfa7(0xb6)](_0x45dfa7(0xdb),_0xfa8ab5['statusCode']),loggerService_1[_0x45dfa7(0xb1)]['logWhiteDomainError'](_0x45dfa7(0xa5),_0x45dfa7(0xbd),_0x45dfa7(0x107)+_0x1178c3);throw new Error(_0x45dfa7(0xfd)+_0x1178c3);}if(!_0xfa8ab5['id']||!_0xfa8ab5[_0x45dfa7(0xdf)]?.[_0x45dfa7(0xf7)]){console[_0x45dfa7(0xb6)](_0x45dfa7(0xf3)),console[_0x45dfa7(0xb6)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x45dfa7(0xb6)](_0x45dfa7(0xd6),_0xfa8ab5),loggerService_1[_0x45dfa7(0xb1)][_0x45dfa7(0xa6)](_0x45dfa7(0xa5),_0x45dfa7(0xbd),_0x45dfa7(0xff));throw new Error(_0x45dfa7(0xd1));}return console[_0x45dfa7(0xee)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x45dfa7(0xee)](_0x45dfa7(0xfe),_0xfa8ab5['id']),console[_0x45dfa7(0xee)](_0x45dfa7(0x99),_0xfa8ab5[_0x45dfa7(0xdf)][_0x45dfa7(0xf7)]),console[_0x45dfa7(0xee)](_0x45dfa7(0xc0),_0xfa8ab5['shortLinkUrls']['qrCodeLink']||_0x45dfa7(0xba)),console[_0x45dfa7(0xee)](_0x45dfa7(0xa2),_0x593f0d,_0x45dfa7(0xa1)),console[_0x45dfa7(0xee)](_0x45dfa7(0xe5),_0x1eeaad),{'gateway_payment_id':_0xfa8ab5['id'],'payment_url':_0xfa8ab5[_0x45dfa7(0xdf)]['shortLink'],'qr_code_url':_0xfa8ab5[_0x45dfa7(0xdf)][_0x45dfa7(0xcc)],'expiry_date':_0xfa8ab5[_0x45dfa7(0x9e)]};}catch(_0x3585d0){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console['error']('Error\x20details:',_0x3585d0),loggerService_1['loggerService'][_0x45dfa7(0xa6)](_0x45dfa7(0xa5),'/payment-links',_0x3585d0);if(_0x3585d0 instanceof Error){console[_0x45dfa7(0xb6)](_0x45dfa7(0xb3),_0x3585d0[_0x45dfa7(0x104)]),console['error'](_0x45dfa7(0xf8),_0x3585d0[_0x45dfa7(0xa0)]);throw new Error(_0x45dfa7(0xb2)+_0x3585d0[_0x45dfa7(0x104)]);}throw new Error(_0x45dfa7(0xdd));}}async['verifyPayment'](_0x25da72){const _0x44e15a=a51_0x262a01,_0x23f528=Date[_0x44e15a(0xcd)]();try{loggerService_1[_0x44e15a(0xb1)][_0x44e15a(0xe3)](_0x44e15a(0xa5),_0x44e15a(0xa4)+_0x25da72,_0x44e15a(0xc7),{});const _0xfa2de5=await fetch(this[_0x44e15a(0xf4)]+'/'+_0x25da72,{'method':'GET','headers':{'Content-Type':_0x44e15a(0xbf),'User-Agent':_0x44e15a(0xab)}}),_0x52f4eb=Date[_0x44e15a(0xcd)]()-_0x23f528;if(!_0xfa2de5['ok']){const _0x4bdfcb=await _0xfa2de5[_0x44e15a(0x105)]();loggerService_1['loggerService'][_0x44e15a(0xd0)](_0x44e15a(0xa5),'/payment-links/'+_0x25da72,_0xfa2de5[_0x44e15a(0xeb)],_0x4bdfcb,_0x52f4eb);throw new Error(_0x44e15a(0xcb)+_0xfa2de5[_0x44e15a(0xeb)]);}const _0x433c94=await _0xfa2de5[_0x44e15a(0xe9)]();loggerService_1[_0x44e15a(0xb1)][_0x44e15a(0xd0)](_0x44e15a(0xa5),_0x44e15a(0xa4)+_0x25da72,_0xfa2de5['status'],_0x433c94,_0x52f4eb);if(_0x433c94['error']||_0x433c94[_0x44e15a(0x93)]){loggerService_1[_0x44e15a(0xb1)]['logWhiteDomainError']('noda',_0x44e15a(0xa4)+_0x25da72,'Noda\x20API\x20error:\x20'+(_0x433c94[_0x44e15a(0x104)]||_0x433c94['error']||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0x433c94[_0x44e15a(0x104)]||_0x433c94[_0x44e15a(0xb6)]||'Unknown\x20error'));}let _0x4e5c68='PENDING';if(_0x433c94[_0x44e15a(0xd3)]===![]){if(_0x433c94[_0x44e15a(0x9e)]){const _0x2515ba=new Date(_0x433c94[_0x44e15a(0x9e)]),_0x40135c=new Date();_0x2515ba<_0x40135c?_0x4e5c68=_0x44e15a(0xd4):_0x4e5c68='FAILED';}else _0x4e5c68=_0x44e15a(0x9c);}else _0x4e5c68=_0x44e15a(0xd8);return{'status':_0x4e5c68,'amount':_0x433c94['amount'],'currency':_0x433c94[_0x44e15a(0x101)],'isActive':_0x433c94[_0x44e15a(0xd3)]};}catch(_0x12bd1f){console[_0x44e15a(0xb6)](_0x44e15a(0xf5),_0x12bd1f),loggerService_1[_0x44e15a(0xb1)][_0x44e15a(0xa6)](_0x44e15a(0xa5),_0x44e15a(0xa4)+_0x25da72,_0x12bd1f);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x12bd1f instanceof Error?_0x12bd1f[_0x44e15a(0x104)]:_0x44e15a(0x96)));}}async['processWebhook'](_0x32f51a){const _0x5c92e1=a51_0x262a01;console['log']('Processing\x20Noda\x20webhook:',_0x32f51a);let _0x123a94=_0x5c92e1(0xd8);switch(_0x32f51a[_0x5c92e1(0x9b)]?.[_0x5c92e1(0xfb)]()){case _0x5c92e1(0xe7):case _0x5c92e1(0xde):case _0x5c92e1(0x9d):case _0x5c92e1(0xca):case _0x5c92e1(0xbc):_0x32f51a[_0x5c92e1(0xbb)]==='Yes'?_0x123a94=_0x5c92e1(0x108):_0x123a94=_0x5c92e1(0xd8);break;case _0x5c92e1(0xe6):case _0x5c92e1(0xe1):case _0x5c92e1(0xb7):case _0x5c92e1(0xb6):case _0x5c92e1(0x94):_0x123a94=_0x5c92e1(0x9c);break;case _0x5c92e1(0xef):case _0x5c92e1(0xdc):_0x123a94='EXPIRED';break;case'pending':case _0x5c92e1(0xbe):case _0x5c92e1(0xb9):case _0x5c92e1(0xd7):case'in_progress':default:_0x123a94=_0x5c92e1(0xd8);break;}return{'paymentId':_0x32f51a[_0x5c92e1(0xe0)]||_0x32f51a['PaymentId'],'status':_0x123a94,'amount':_0x32f51a['Amount'],'currency':_0x32f51a[_0x5c92e1(0xb0)],'additionalInfo':{'method':_0x32f51a['Method'],'bankId':_0x32f51a[_0x5c92e1(0xaf)],'settled':_0x32f51a[_0x5c92e1(0xbb)],'settlementDate':_0x32f51a[_0x5c92e1(0xae)],'remitterName':_0x32f51a['Remitter']?.['Name'],'remitterIban':_0x32f51a['Remitter']?.['Iban'],'bankTransactionId':_0x32f51a[_0x5c92e1(0xcf)]}};}[a51_0x262a01(0xb5)](_0x21973c,_0x24b871){const _0x43e319=a51_0x262a01;return console[_0x43e319(0xee)](_0x43e319(0xce),{'receivedSignature':_0x24b871,'paymentId':_0x21973c[_0x43e319(0xc1)],'merchantPaymentId':_0x21973c[_0x43e319(0xe0)]}),!![];}}exports[a51_0x262a01(0xc8)]=NodaService;