'use strict';const a48_0x2ffc58=a48_0x1a11;(function(_0x1f6a9f,_0x3a5ae9){const _0x11a49b=a48_0x1a11,_0x5e20a9=_0x1f6a9f();while(!![]){try{const _0x285879=parseInt(_0x11a49b(0x12b))/0x1*(parseInt(_0x11a49b(0x119))/0x2)+-parseInt(_0x11a49b(0x127))/0x3+parseInt(_0x11a49b(0x164))/0x4+parseInt(_0x11a49b(0x11e))/0x5*(-parseInt(_0x11a49b(0x176))/0x6)+-parseInt(_0x11a49b(0x113))/0x7+parseInt(_0x11a49b(0x149))/0x8+parseInt(_0x11a49b(0x13d))/0x9;if(_0x285879===_0x3a5ae9)break;else _0x5e20a9['push'](_0x5e20a9['shift']());}catch(_0x2ddcf8){_0x5e20a9['push'](_0x5e20a9['shift']());}}}(a48_0x21d4,0xa2198));function a48_0x21d4(){const _0x3c1546=['createPaymentLink','Parsed\x20Result:','entries','PaymentId','isActive','Amount','failed','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','loggerService','(8digits-8digits\x20format)','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','https://tesoft.uk/gateway/noda/','Unknown\x20error','qrCodeLink','pending','HTTP\x20Status:','logWhiteDomainResponse','toUpperCase','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Error\x20Message:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','/payment-links','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','8151136AASKpk','URL:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','noda','statusCode','Response\x20Body:','746740bCObAs','toLowerCase','now','MerchantPaymentId','log','395VIsvjT','Business\x20Error:\x20','Settled','TesSoft\x20Payment\x20System/1.0','Noda\x20API\x20error:\x20','QR\x20Code\x20Link:','PENDING','GET','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','458208ovkJQu','Name','POST','/payment-links/','3sTXDRO','Payment\x20Link\x20ID:','paid','===\x20NODA\x20SUCCESS\x20===','Response\x20data:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Raw\x20Response\x20Body:','done','Method','NodaService','expiryDate','Status\x20Code:','https://tesoft.uk/gateway/noda/webhook/','created','Noda\x20webhook\x20signature\x20verification:','application/json','(8digits-8digits\x20format\x20for\x20Noda)','success','4910589YmaRGW','message','Processing\x20Noda\x20webhook:','apiUrl','Short\x20Link:','currency','SettlementDate','Headers:','shortLink','Error\x20details:','Error\x20stack:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','5362048cwspUc','logWhiteDomainError','../loggerService','error','Iban','expired','canceled','===\x20PARSED\x20NODA\x20RESPONSE\x20===','__esModule','fromEntries','successful','shortLinkUrls','Status:','===\x20NODA\x20API\x20ERROR\x20===','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','amount',',\x20body:\x20','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Status\x20Text:','text','cancelled','status','stack','active','Request\x20Body\x20(Direct\x20JSON):','statusText','logWhiteDomainRequest','636524dWPctq','stringify','https://tesoft.uk/gateway/pending.php?id=','Not\x20provided','Response\x20Time:','Remitter','Noda\x20payment\x20verification\x20error:','in_progress','parse','===\x20NODA\x20SERVICE\x20ERROR\x20===','Missing\x20id\x20or\x20shortLink\x20in\x20response','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','HTTP\x20error!\x20status:\x20','EXPIRED','Failed\x20to\x20parse\x20JSON\x20response:','verifyPayment','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','processWebhook','39036vxPnoi','rejected','FAILED','Order\x20ID\x20Format:'];a48_0x21d4=function(){return _0x3c1546;};return a48_0x21d4();}Object['defineProperty'](exports,a48_0x2ffc58(0x151),{'value':!![]}),exports[a48_0x2ffc58(0x134)]=void 0x0;function a48_0x1a11(_0x62a019,_0x5c8342){const _0x21d420=a48_0x21d4();return a48_0x1a11=function(_0x1a11af,_0x12ada4){_0x1a11af=_0x1a11af-0xfd;let _0x4d2096=_0x21d420[_0x1a11af];return _0x4d2096;},a48_0x1a11(_0x62a019,_0x5c8342);}const loggerService_1=require(a48_0x2ffc58(0x14b));class NodaService{constructor(){const _0x3f5f98=a48_0x2ffc58;this['apiUrl']=_0x3f5f98(0x107),console[_0x3f5f98(0x11d)](_0x3f5f98(0x110));}async[a48_0x2ffc58(0x17a)](_0x430475){const _0x12306f=a48_0x2ffc58,{orderId:_0x36c73b,name:_0x323e6b,paymentDescription:_0x50ddb5,amount:_0x2b8780,currency:_0x3ba995,webhookUrl:_0x2e46b3,returnUrl:_0x39860e,expiryDate:_0x4f746c}=_0x430475,_0x36e52d=_0x3ba995[_0x12306f(0x10d)](),_0x55bc76=_0x12306f(0x137),_0x59746a=_0x12306f(0x166)+_0x36c73b,_0x80cb55={'name':_0x323e6b,'paymentDescription':_0x50ddb5,'amount':_0x2b8780,'currency':_0x36e52d,'paymentId':_0x36c73b,'webhookUrl':_0x55bc76,'returnUrl':_0x59746a};_0x4f746c&&(_0x80cb55[_0x12306f(0x135)]=_0x4f746c);const _0x28e34c=Date[_0x12306f(0x11b)]();try{console[_0x12306f(0x11d)](_0x12306f(0x10e)),console[_0x12306f(0x11d)](_0x12306f(0x114),this[_0x12306f(0x140)]),console[_0x12306f(0x11d)](_0x12306f(0x161),JSON[_0x12306f(0x165)](_0x80cb55,null,0x2)),console[_0x12306f(0x11d)](_0x12306f(0x179),_0x36c73b,_0x12306f(0x13b)),console[_0x12306f(0x11d)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x59746a),loggerService_1['loggerService'][_0x12306f(0x163)](_0x12306f(0x116),_0x12306f(0x111),'POST',_0x80cb55);const _0x11bdd5=await fetch(this[_0x12306f(0x140)],{'method':_0x12306f(0x129),'headers':{'Content-Type':_0x12306f(0x13a),'Accept':_0x12306f(0x13a),'User-Agent':_0x12306f(0x121)},'body':JSON['stringify'](_0x80cb55)}),_0x3b0374=Date[_0x12306f(0x11b)]()-_0x28e34c;console[_0x12306f(0x11d)](_0x12306f(0x174)),console[_0x12306f(0x11d)](_0x12306f(0x155),_0x11bdd5[_0x12306f(0x15e)]),console[_0x12306f(0x11d)](_0x12306f(0x15b),_0x11bdd5[_0x12306f(0x162)]),console[_0x12306f(0x11d)](_0x12306f(0x144),Object[_0x12306f(0x152)](_0x11bdd5['headers'][_0x12306f(0xfe)]())),console[_0x12306f(0x11d)](_0x12306f(0x168),_0x3b0374+'ms');const _0x5209dd=await _0x11bdd5[_0x12306f(0x15c)]();console['log'](_0x12306f(0x131),_0x5209dd);if(!_0x11bdd5['ok']){console[_0x12306f(0x14c)](_0x12306f(0x156)),console[_0x12306f(0x14c)](_0x12306f(0x10b),_0x11bdd5[_0x12306f(0x15e)]),console['error'](_0x12306f(0x118),_0x5209dd),loggerService_1['loggerService'][_0x12306f(0x10c)](_0x12306f(0x116),'/payment-links',_0x11bdd5[_0x12306f(0x15e)],_0x5209dd,_0x3b0374),loggerService_1[_0x12306f(0x104)]['logWhiteDomainError'](_0x12306f(0x116),_0x12306f(0x111),'HTTP\x20'+_0x11bdd5[_0x12306f(0x15e)]+':\x20'+_0x5209dd);if(_0x11bdd5[_0x12306f(0x15e)]===0x190)throw new Error(_0x12306f(0x148));else{if(_0x11bdd5['status']===0x1f4)throw new Error(_0x12306f(0x115));}throw new Error(_0x12306f(0x170)+_0x11bdd5[_0x12306f(0x15e)]+_0x12306f(0x159)+_0x5209dd);}let _0x5f4822;try{_0x5f4822=JSON[_0x12306f(0x16c)](_0x5209dd);}catch(_0x55b41f){console[_0x12306f(0x14c)](_0x12306f(0x172),_0x55b41f),loggerService_1[_0x12306f(0x104)][_0x12306f(0x14a)](_0x12306f(0x116),_0x12306f(0x111),'JSON\x20Parse\x20Error:\x20'+_0x55b41f);throw new Error(_0x12306f(0x16f)+_0x5209dd);}console[_0x12306f(0x11d)](_0x12306f(0x150)),console['log'](_0x12306f(0xfd),JSON[_0x12306f(0x165)](_0x5f4822,null,0x2)),loggerService_1[_0x12306f(0x104)][_0x12306f(0x10c)](_0x12306f(0x116),'/payment-links',_0x11bdd5[_0x12306f(0x15e)],_0x5f4822,_0x3b0374);if(_0x5f4822['error']||_0x5f4822[_0x12306f(0x117)]){const _0x1b6029=_0x5f4822[_0x12306f(0x13e)]||_0x5f4822[_0x12306f(0x14c)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x12306f(0x14c)](_0x12306f(0x15a)),console[_0x12306f(0x14c)](_0x12306f(0x10f),_0x1b6029),console[_0x12306f(0x14c)](_0x12306f(0x136),_0x5f4822[_0x12306f(0x117)]),loggerService_1[_0x12306f(0x104)][_0x12306f(0x14a)](_0x12306f(0x116),_0x12306f(0x111),_0x12306f(0x11f)+_0x1b6029);throw new Error(_0x12306f(0x122)+_0x1b6029);}if(!_0x5f4822['id']||!_0x5f4822[_0x12306f(0x154)]?.['shortLink']){console[_0x12306f(0x14c)](_0x12306f(0x106)),console[_0x12306f(0x14c)](_0x12306f(0x16e)),console['error'](_0x12306f(0x12f),_0x5f4822),loggerService_1[_0x12306f(0x104)]['logWhiteDomainError'](_0x12306f(0x116),'/payment-links',_0x12306f(0x157));throw new Error(_0x12306f(0x103));}return console[_0x12306f(0x11d)](_0x12306f(0x12e)),console[_0x12306f(0x11d)](_0x12306f(0x12c),_0x5f4822['id']),console[_0x12306f(0x11d)](_0x12306f(0x141),_0x5f4822['shortLinkUrls'][_0x12306f(0x145)]),console['log'](_0x12306f(0x123),_0x5f4822[_0x12306f(0x154)][_0x12306f(0x109)]||_0x12306f(0x167)),console[_0x12306f(0x11d)]('Order\x20ID\x20Used:',_0x36c73b,_0x12306f(0x105)),console[_0x12306f(0x11d)](_0x12306f(0x130),_0x59746a),{'gateway_payment_id':_0x5f4822['id'],'payment_url':_0x5f4822['shortLinkUrls'][_0x12306f(0x145)],'qr_code_url':_0x5f4822['shortLinkUrls'][_0x12306f(0x109)],'expiry_date':_0x5f4822[_0x12306f(0x135)]};}catch(_0x2703b5){console[_0x12306f(0x14c)](_0x12306f(0x16d)),console[_0x12306f(0x14c)](_0x12306f(0x146),_0x2703b5),loggerService_1[_0x12306f(0x104)][_0x12306f(0x14a)]('noda','/payment-links',_0x2703b5);if(_0x2703b5 instanceof Error){console['error']('Error\x20message:',_0x2703b5[_0x12306f(0x13e)]),console[_0x12306f(0x14c)](_0x12306f(0x147),_0x2703b5[_0x12306f(0x15f)]);throw new Error(_0x12306f(0x112)+_0x2703b5[_0x12306f(0x13e)]);}throw new Error(_0x12306f(0x126));}}async[a48_0x2ffc58(0x173)](_0x5f3b2c){const _0x342a4b=a48_0x2ffc58,_0x4c6ed1=Date[_0x342a4b(0x11b)]();try{loggerService_1[_0x342a4b(0x104)][_0x342a4b(0x163)](_0x342a4b(0x116),_0x342a4b(0x12a)+_0x5f3b2c,_0x342a4b(0x125),{});const _0x3da052=await fetch(this[_0x342a4b(0x140)]+'/'+_0x5f3b2c,{'method':_0x342a4b(0x125),'headers':{'Content-Type':'application/json','User-Agent':_0x342a4b(0x121)}}),_0x8ffd9b=Date[_0x342a4b(0x11b)]()-_0x4c6ed1;if(!_0x3da052['ok']){const _0x5caa36=await _0x3da052[_0x342a4b(0x15c)]();loggerService_1[_0x342a4b(0x104)][_0x342a4b(0x10c)](_0x342a4b(0x116),'/payment-links/'+_0x5f3b2c,_0x3da052[_0x342a4b(0x15e)],_0x5caa36,_0x8ffd9b);throw new Error(_0x342a4b(0x170)+_0x3da052[_0x342a4b(0x15e)]);}const _0x131566=await _0x3da052['json']();loggerService_1[_0x342a4b(0x104)][_0x342a4b(0x10c)]('noda',_0x342a4b(0x12a)+_0x5f3b2c,_0x3da052[_0x342a4b(0x15e)],_0x131566,_0x8ffd9b);if(_0x131566['error']||_0x131566[_0x342a4b(0x117)]){loggerService_1['loggerService'][_0x342a4b(0x14a)](_0x342a4b(0x116),_0x342a4b(0x12a)+_0x5f3b2c,_0x342a4b(0x122)+(_0x131566[_0x342a4b(0x13e)]||_0x131566['error']||'Unknown\x20error'));throw new Error(_0x342a4b(0x122)+(_0x131566[_0x342a4b(0x13e)]||_0x131566['error']||'Unknown\x20error'));}let _0x14498e=_0x342a4b(0x124);if(_0x131566[_0x342a4b(0x100)]===![]){if(_0x131566[_0x342a4b(0x135)]){const _0x506245=new Date(_0x131566[_0x342a4b(0x135)]),_0x16c3ce=new Date();_0x506245<_0x16c3ce?_0x14498e='EXPIRED':_0x14498e=_0x342a4b(0x178);}else _0x14498e=_0x342a4b(0x178);}else _0x14498e=_0x342a4b(0x124);return{'status':_0x14498e,'amount':_0x131566[_0x342a4b(0x158)],'currency':_0x131566[_0x342a4b(0x142)],'isActive':_0x131566[_0x342a4b(0x100)]};}catch(_0x4e8a3a){console['error'](_0x342a4b(0x16a),_0x4e8a3a),loggerService_1[_0x342a4b(0x104)]['logWhiteDomainError'](_0x342a4b(0x116),_0x342a4b(0x12a)+_0x5f3b2c,_0x4e8a3a);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x4e8a3a instanceof Error?_0x4e8a3a['message']:_0x342a4b(0x108)));}}async[a48_0x2ffc58(0x175)](_0x103c11){const _0x15b688=a48_0x2ffc58;console[_0x15b688(0x11d)](_0x15b688(0x13f),_0x103c11);let _0x230004=_0x15b688(0x124);switch(_0x103c11['Status']?.[_0x15b688(0x11a)]()){case _0x15b688(0x132):case'completed':case _0x15b688(0x12d):case _0x15b688(0x13c):case _0x15b688(0x153):_0x103c11[_0x15b688(0x120)]==='Yes'?_0x230004='PAID':_0x230004=_0x15b688(0x124);break;case _0x15b688(0x15d):case _0x15b688(0x14f):case _0x15b688(0x102):case'error':case _0x15b688(0x177):_0x230004=_0x15b688(0x178);break;case _0x15b688(0x14e):case'timeout':_0x230004=_0x15b688(0x171);break;case _0x15b688(0x10a):case _0x15b688(0x138):case _0x15b688(0x160):case'processing':case _0x15b688(0x16b):default:_0x230004=_0x15b688(0x124);break;}return{'paymentId':_0x103c11[_0x15b688(0x11c)]||_0x103c11[_0x15b688(0xff)],'status':_0x230004,'amount':_0x103c11[_0x15b688(0x101)],'currency':_0x103c11['Currency'],'additionalInfo':{'method':_0x103c11[_0x15b688(0x133)],'bankId':_0x103c11['BankId'],'settled':_0x103c11[_0x15b688(0x120)],'settlementDate':_0x103c11[_0x15b688(0x143)],'remitterName':_0x103c11['Remitter']?.[_0x15b688(0x128)],'remitterIban':_0x103c11[_0x15b688(0x169)]?.[_0x15b688(0x14d)],'bankTransactionId':_0x103c11['BankTransactionId']}};}['verifyWebhookSignature'](_0x31c334,_0x33da0f){const _0x4dfe5e=a48_0x2ffc58;return console[_0x4dfe5e(0x11d)](_0x4dfe5e(0x139),{'receivedSignature':_0x33da0f,'paymentId':_0x31c334['PaymentId'],'merchantPaymentId':_0x31c334[_0x4dfe5e(0x11c)]}),!![];}}exports[a48_0x2ffc58(0x134)]=NodaService;