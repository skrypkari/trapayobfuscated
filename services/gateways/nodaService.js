'use strict';const a44_0x24d88a=a44_0x4e1f;(function(_0x412de3,_0x286add){const _0x2c2fa4=a44_0x4e1f,_0x2f4621=_0x412de3();while(!![]){try{const _0x2d4688=-parseInt(_0x2c2fa4(0xaa))/0x1+-parseInt(_0x2c2fa4(0xd7))/0x2*(-parseInt(_0x2c2fa4(0xdf))/0x3)+parseInt(_0x2c2fa4(0x80))/0x4*(-parseInt(_0x2c2fa4(0xda))/0x5)+parseInt(_0x2c2fa4(0xac))/0x6*(-parseInt(_0x2c2fa4(0xed))/0x7)+parseInt(_0x2c2fa4(0xbc))/0x8+-parseInt(_0x2c2fa4(0x7f))/0x9*(-parseInt(_0x2c2fa4(0xe3))/0xa)+parseInt(_0x2c2fa4(0x8b))/0xb*(parseInt(_0x2c2fa4(0xec))/0xc);if(_0x2d4688===_0x286add)break;else _0x2f4621['push'](_0x2f4621['shift']());}catch(_0x244eb1){_0x2f4621['push'](_0x2f4621['shift']());}}}(a44_0x6c15,0x6e4b4));Object[a44_0x24d88a(0x9a)](exports,'__esModule',{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a44_0x24d88a(0xc3));function a44_0x6c15(){const _0x6d61d2=['GET','logWhiteDomainResponse','3504IQPliL','7dPdAvA','Noda\x20webhook\x20signature\x20verification:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','isActive','SettlementDate','PAID','Unknown\x20error\x20from\x20Noda\x20API','/payment-links','verifyWebhookSignature','JSON\x20Parse\x20Error:\x20','(8digits-8digits\x20format)','BankId','Amount','text','6795dHWVox','76OHOnYB','Error\x20message:','Iban','completed','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','headers','done','expired','loggerService','Settled','created','14157UFDBoQ','toLowerCase','log','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','toUpperCase','in_progress','Error\x20details:','createPaymentLink','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20NODA\x20API\x20ERROR\x20===','Failed\x20to\x20parse\x20JSON\x20response:','status','fromEntries','Unknown\x20error','defineProperty','processing','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Error\x20stack:','qrCodeLink','Headers:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','application/json','Status\x20Code:','Request\x20Body\x20(Direct\x20JSON):','message','amount','Status\x20Text:','statusCode','noda','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','145016ZXqWjw','Response\x20Time:','4257462FfEdGU','PaymentId','error','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Error\x20Message:','POST','URL:','PENDING','stringify','HTTP\x20error!\x20status:\x20','shortLinkUrls','Noda\x20API\x20error:\x20','/payment-links/','Remitter','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','active','82208JkwHIW','Payment\x20Link\x20ID:','Status:','Status','expiryDate','Business\x20Error:\x20','statusText','../loggerService','logWhiteDomainRequest','Failed\x20to\x20verify\x20Noda\x20payment:\x20','TesSoft\x20Payment\x20System/1.0','Processing\x20Noda\x20webhook:','HTTP\x20','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','failed','json','Method','(8digits-8digits\x20format\x20for\x20Noda)','apiUrl','processWebhook','rejected','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Noda\x20payment\x20verification\x20error:','pending','timeout','BankTransactionId','Response\x20data:','283782dorBvr','Order\x20ID\x20Used:','now','5145sGhOZW','entries','cancelled','Currency','logWhiteDomainError','9ugmskl','successful','Raw\x20Response\x20Body:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','6810eJSosB','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','EXPIRED','FAILED','shortLink','stack','Response\x20Body:'];a44_0x6c15=function(){return _0x6d61d2;};return a44_0x6c15();}class NodaService{constructor(){const _0x34eaa8=a44_0x24d88a;this[_0x34eaa8(0xce)]='https://tesoft.uk/gateway/noda/',console['log'](_0x34eaa8(0x8f));}async[a44_0x24d88a(0x93)](_0xb21919){const _0x466e10=a44_0x24d88a,{orderId:_0xf83d49,name:_0x140d22,paymentDescription:_0x52f5f1,amount:_0x173be6,currency:_0x6d596c,webhookUrl:_0x5adede,returnUrl:_0x3a21ed,expiryDate:_0x346b74}=_0xb21919,_0x318040=_0x6d596c[_0x466e10(0x90)](),_0x134f08='https://tesoft.uk/gateway/noda/webhook/',_0x5afe79='https://tesoft.uk/gateway/pending.php?id='+_0xf83d49,_0x36e600={'name':_0x140d22,'paymentDescription':_0x52f5f1,'amount':_0x173be6,'currency':_0x318040,'paymentId':_0xf83d49,'webhookUrl':_0x134f08,'returnUrl':_0x5afe79};_0x346b74&&(_0x36e600[_0x466e10(0xc0)]=_0x346b74);const _0x12bc7f=Date[_0x466e10(0xd9)]();try{console['log'](_0x466e10(0xe4)),console[_0x466e10(0x8d)](_0x466e10(0xb2),this[_0x466e10(0xce)]),console[_0x466e10(0x8d)](_0x466e10(0xa3),JSON['stringify'](_0x36e600,null,0x2)),console['log']('Order\x20ID\x20Format:',_0xf83d49,_0x466e10(0xcd)),console[_0x466e10(0x8d)](_0x466e10(0xef),_0x5afe79),loggerService_1[_0x466e10(0x88)]['logWhiteDomainRequest'](_0x466e10(0xa8),_0x466e10(0x78),_0x466e10(0xb1),_0x36e600);const _0x1b75de=await fetch(this[_0x466e10(0xce)],{'method':_0x466e10(0xb1),'headers':{'Content-Type':_0x466e10(0xa1),'Accept':_0x466e10(0xa1),'User-Agent':_0x466e10(0xc6)},'body':JSON[_0x466e10(0xb4)](_0x36e600)}),_0x4fc883=Date[_0x466e10(0xd9)]()-_0x12bc7f;console[_0x466e10(0x8d)](_0x466e10(0xe2)),console[_0x466e10(0x8d)](_0x466e10(0xbe),_0x1b75de[_0x466e10(0x97)]),console[_0x466e10(0x8d)](_0x466e10(0xa6),_0x1b75de[_0x466e10(0xc2)]),console['log'](_0x466e10(0x9f),Object[_0x466e10(0x98)](_0x1b75de[_0x466e10(0x85)][_0x466e10(0xdb)]())),console[_0x466e10(0x8d)](_0x466e10(0xab),_0x4fc883+'ms');const _0x1a6582=await _0x1b75de[_0x466e10(0x7e)]();console[_0x466e10(0x8d)](_0x466e10(0xe1),_0x1a6582);if(!_0x1b75de['ok']){console[_0x466e10(0xae)](_0x466e10(0x95)),console[_0x466e10(0xae)]('HTTP\x20Status:',_0x1b75de['status']),console[_0x466e10(0xae)](_0x466e10(0xe9),_0x1a6582),loggerService_1[_0x466e10(0x88)][_0x466e10(0xeb)]('noda','/payment-links',_0x1b75de[_0x466e10(0x97)],_0x1a6582,_0x4fc883),loggerService_1[_0x466e10(0x88)][_0x466e10(0xde)](_0x466e10(0xa8),_0x466e10(0x78),_0x466e10(0xc8)+_0x1b75de['status']+':\x20'+_0x1a6582);if(_0x1b75de[_0x466e10(0x97)]===0x190)throw new Error(_0x466e10(0x8e));else{if(_0x1b75de[_0x466e10(0x97)]===0x1f4)throw new Error(_0x466e10(0xd1));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x1b75de['status']+',\x20body:\x20'+_0x1a6582);}let _0x384d61;try{_0x384d61=JSON['parse'](_0x1a6582);}catch(_0x181b2e){console[_0x466e10(0xae)](_0x466e10(0x96),_0x181b2e),loggerService_1[_0x466e10(0x88)][_0x466e10(0xde)](_0x466e10(0xa8),_0x466e10(0x78),_0x466e10(0x7a)+_0x181b2e);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x1a6582);}console[_0x466e10(0x8d)](_0x466e10(0xaf)),console[_0x466e10(0x8d)]('Parsed\x20Result:',JSON[_0x466e10(0xb4)](_0x384d61,null,0x2)),loggerService_1[_0x466e10(0x88)][_0x466e10(0xeb)]('noda',_0x466e10(0x78),_0x1b75de[_0x466e10(0x97)],_0x384d61,_0x4fc883);if(_0x384d61['error']||_0x384d61[_0x466e10(0xa7)]){const _0x432d44=_0x384d61['message']||_0x384d61[_0x466e10(0xae)]||_0x466e10(0xf3);console[_0x466e10(0xae)](_0x466e10(0xba)),console[_0x466e10(0xae)](_0x466e10(0xb0),_0x432d44),console['error'](_0x466e10(0xa2),_0x384d61['statusCode']),loggerService_1[_0x466e10(0x88)]['logWhiteDomainError'](_0x466e10(0xa8),_0x466e10(0x78),_0x466e10(0xc1)+_0x432d44);throw new Error('Noda\x20API\x20error:\x20'+_0x432d44);}if(!_0x384d61['id']||!_0x384d61[_0x466e10(0xb6)]?.['shortLink']){console[_0x466e10(0xae)](_0x466e10(0x94)),console[_0x466e10(0xae)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x466e10(0xae)](_0x466e10(0xd6),_0x384d61),loggerService_1[_0x466e10(0x88)]['logWhiteDomainError'](_0x466e10(0xa8),'/payment-links',_0x466e10(0xa9));throw new Error(_0x466e10(0xc9));}return console[_0x466e10(0x8d)]('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x466e10(0xbd),_0x384d61['id']),console[_0x466e10(0x8d)]('Short\x20Link:',_0x384d61[_0x466e10(0xb6)][_0x466e10(0xe7)]),console[_0x466e10(0x8d)]('QR\x20Code\x20Link:',_0x384d61[_0x466e10(0xb6)]['qrCodeLink']||'Not\x20provided'),console[_0x466e10(0x8d)](_0x466e10(0xd8),_0xf83d49,_0x466e10(0x7b)),console['log'](_0x466e10(0xa0),_0x5afe79),{'gateway_payment_id':_0x384d61['id'],'payment_url':_0x384d61[_0x466e10(0xb6)]['shortLink'],'qr_code_url':_0x384d61[_0x466e10(0xb6)][_0x466e10(0x9e)],'expiry_date':_0x384d61[_0x466e10(0xc0)]};}catch(_0x4f781b){console[_0x466e10(0xae)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x466e10(0xae)](_0x466e10(0x92),_0x4f781b),loggerService_1[_0x466e10(0x88)][_0x466e10(0xde)](_0x466e10(0xa8),_0x466e10(0x78),_0x4f781b);if(_0x4f781b instanceof Error){console[_0x466e10(0xae)](_0x466e10(0x81),_0x4f781b['message']),console['error'](_0x466e10(0x9d),_0x4f781b[_0x466e10(0xe8)]);throw new Error(_0x466e10(0x84)+_0x4f781b[_0x466e10(0xa4)]);}throw new Error(_0x466e10(0x9c));}}async['verifyPayment'](_0x63e368){const _0x252ee1=a44_0x24d88a,_0x336115=Date[_0x252ee1(0xd9)]();try{loggerService_1[_0x252ee1(0x88)][_0x252ee1(0xc4)](_0x252ee1(0xa8),_0x252ee1(0xb8)+_0x63e368,'GET',{});const _0x69dd00=await fetch(this[_0x252ee1(0xce)]+'/'+_0x63e368,{'method':_0x252ee1(0xea),'headers':{'Content-Type':_0x252ee1(0xa1),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x55ba3b=Date[_0x252ee1(0xd9)]()-_0x336115;if(!_0x69dd00['ok']){const _0x2fa3ba=await _0x69dd00[_0x252ee1(0x7e)]();loggerService_1['loggerService']['logWhiteDomainResponse']('noda','/payment-links/'+_0x63e368,_0x69dd00[_0x252ee1(0x97)],_0x2fa3ba,_0x55ba3b);throw new Error(_0x252ee1(0xb5)+_0x69dd00[_0x252ee1(0x97)]);}const _0x15efa2=await _0x69dd00[_0x252ee1(0xcb)]();loggerService_1[_0x252ee1(0x88)][_0x252ee1(0xeb)]('noda',_0x252ee1(0xb8)+_0x63e368,_0x69dd00[_0x252ee1(0x97)],_0x15efa2,_0x55ba3b);if(_0x15efa2[_0x252ee1(0xae)]||_0x15efa2[_0x252ee1(0xa7)]){loggerService_1[_0x252ee1(0x88)]['logWhiteDomainError']('noda',_0x252ee1(0xb8)+_0x63e368,_0x252ee1(0xb7)+(_0x15efa2[_0x252ee1(0xa4)]||_0x15efa2[_0x252ee1(0xae)]||_0x252ee1(0x99)));throw new Error(_0x252ee1(0xb7)+(_0x15efa2['message']||_0x15efa2[_0x252ee1(0xae)]||_0x252ee1(0x99)));}let _0x300a40=_0x252ee1(0xb3);if(_0x15efa2[_0x252ee1(0xf0)]===![]){if(_0x15efa2['expiryDate']){const _0x5b4ac7=new Date(_0x15efa2[_0x252ee1(0xc0)]),_0x9e7c8=new Date();_0x5b4ac7<_0x9e7c8?_0x300a40=_0x252ee1(0xe5):_0x300a40=_0x252ee1(0xe6);}else _0x300a40=_0x252ee1(0xe6);}else _0x300a40=_0x252ee1(0xb3);return{'status':_0x300a40,'amount':_0x15efa2[_0x252ee1(0xa5)],'currency':_0x15efa2['currency'],'isActive':_0x15efa2[_0x252ee1(0xf0)]};}catch(_0x8d797){console['error'](_0x252ee1(0xd2),_0x8d797),loggerService_1['loggerService'][_0x252ee1(0xde)](_0x252ee1(0xa8),_0x252ee1(0xb8)+_0x63e368,_0x8d797);throw new Error(_0x252ee1(0xc5)+(_0x8d797 instanceof Error?_0x8d797['message']:_0x252ee1(0x99)));}}async[a44_0x24d88a(0xcf)](_0x198a6f){const _0x4c24b9=a44_0x24d88a;console['log'](_0x4c24b9(0xc7),_0x198a6f);let _0x55c646=_0x4c24b9(0xb3);switch(_0x198a6f[_0x4c24b9(0xbf)]?.[_0x4c24b9(0x8c)]()){case _0x4c24b9(0x86):case _0x4c24b9(0x83):case'paid':case'success':case _0x4c24b9(0xe0):_0x198a6f[_0x4c24b9(0x89)]==='Yes'?_0x55c646=_0x4c24b9(0xf2):_0x55c646='PENDING';break;case _0x4c24b9(0xdc):case'canceled':case _0x4c24b9(0xca):case'error':case _0x4c24b9(0xd0):_0x55c646=_0x4c24b9(0xe6);break;case _0x4c24b9(0x87):case _0x4c24b9(0xd4):_0x55c646='EXPIRED';break;case _0x4c24b9(0xd3):case _0x4c24b9(0x8a):case _0x4c24b9(0xbb):case _0x4c24b9(0x9b):case _0x4c24b9(0x91):default:_0x55c646=_0x4c24b9(0xb3);break;}return{'paymentId':_0x198a6f['MerchantPaymentId']||_0x198a6f['PaymentId'],'status':_0x55c646,'amount':_0x198a6f[_0x4c24b9(0x7d)],'currency':_0x198a6f[_0x4c24b9(0xdd)],'additionalInfo':{'method':_0x198a6f[_0x4c24b9(0xcc)],'bankId':_0x198a6f[_0x4c24b9(0x7c)],'settled':_0x198a6f[_0x4c24b9(0x89)],'settlementDate':_0x198a6f[_0x4c24b9(0xf1)],'remitterName':_0x198a6f['Remitter']?.['Name'],'remitterIban':_0x198a6f[_0x4c24b9(0xb9)]?.[_0x4c24b9(0x82)],'bankTransactionId':_0x198a6f[_0x4c24b9(0xd5)]}};}[a44_0x24d88a(0x79)](_0x2f338a,_0x517d78){const _0x179f97=a44_0x24d88a;return console[_0x179f97(0x8d)](_0x179f97(0xee),{'receivedSignature':_0x517d78,'paymentId':_0x2f338a[_0x179f97(0xad)],'merchantPaymentId':_0x2f338a['MerchantPaymentId']}),!![];}}function a44_0x4e1f(_0x5354b9,_0x300217){const _0x6c15da=a44_0x6c15();return a44_0x4e1f=function(_0x4e1fdb,_0x384e72){_0x4e1fdb=_0x4e1fdb-0x78;let _0x463e37=_0x6c15da[_0x4e1fdb];return _0x463e37;},a44_0x4e1f(_0x5354b9,_0x300217);}exports['NodaService']=NodaService;