'use strict';const a48_0x39632e=a48_0x50ca;function a48_0x5167(){const _0x257417=['2358fQwhTf','(8digits-8digits\x20format\x20for\x20Noda)','processing','message','https://tesoft.uk/gateway/noda/','JSON\x20Parse\x20Error:\x20','Order\x20ID\x20Format:','Remitter','Currency','json','stringify','Noda\x20webhook\x20signature\x20verification:','Response\x20Body:','10osLmfG','===\x20NODA\x20SUCCESS\x20===','verifyWebhookSignature','rejected','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','active','BankId','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','failed','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','status','toUpperCase','BankTransactionId','application/json','Unknown\x20error\x20from\x20Noda\x20API','===\x20NODA\x20SERVICE\x20ERROR\x20===','20892751Lcawtd','QR\x20Code\x20Link:','GET','shortLink','isActive','statusText','525IQIBMY','PaymentId','paid','apiUrl','noda','Status\x20Code:','Short\x20Link:','Name','Iban','Method','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','PAID','../loggerService','Parsed\x20Result:','now','POST','stack','Settled','Error\x20Message:','Payment\x20Link\x20ID:','Order\x20ID\x20Used:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','loggerService','qrCodeLink','defineProperty','Raw\x20Response\x20Body:','Unknown\x20error','Noda\x20API\x20error:\x20','fromEntries','text','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Amount','error','Not\x20provided','(8digits-8digits\x20format)','toLowerCase','2265vdCUXJ','EXPIRED','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','pending','7218918IGwdFP','PENDING','logWhiteDomainError','shortLinkUrls','30404976kdfGlQ','log','Error\x20message:','Failed\x20to\x20parse\x20JSON\x20response:','canceled','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Noda\x20payment\x20verification\x20error:','MerchantPaymentId','logWhiteDomainResponse','Missing\x20id\x20or\x20shortLink\x20in\x20response','NodaService','23040DWtVlE','FAILED','cancelled','32SFQwRd','25240rnBtju','Error\x20details:','logWhiteDomainRequest','TesSoft\x20Payment\x20System/1.0','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Status','entries','createPaymentLink','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','successful','Yes','7068FFZYAX','96537ACpuZN','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','HTTP\x20','currency','HTTP\x20Status:','https://tesoft.uk/gateway/noda/webhook/','HTTP\x20error!\x20status:\x20','URL:','/payment-links/','timeout','success','amount','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status:','Status\x20Text:','Business\x20Error:\x20','/payment-links','expiryDate','completed','statusCode','in_progress',',\x20body:\x20'];a48_0x5167=function(){return _0x257417;};return a48_0x5167();}(function(_0x1ff37e,_0x35dc42){const _0x1bd734=a48_0x50ca,_0x46f9e8=_0x1ff37e();while(!![]){try{const _0x265ed4=parseInt(_0x1bd734(0x108))/0x1*(parseInt(_0x1bd734(0xfb))/0x2)+parseInt(_0x1bd734(0xe5))/0x3*(parseInt(_0x1bd734(0x107))/0x4)+parseInt(_0x1bd734(0xf8))/0x5*(-parseInt(_0x1bd734(0x11e))/0x6)+parseInt(_0x1bd734(0x141))/0x7*(-parseInt(_0x1bd734(0xfc))/0x8)+parseInt(_0x1bd734(0xe9))/0x9+parseInt(_0x1bd734(0x12b))/0xa*(parseInt(_0x1bd734(0x13b))/0xb)+-parseInt(_0x1bd734(0xed))/0xc;if(_0x265ed4===_0x35dc42)break;else _0x46f9e8['push'](_0x46f9e8['shift']());}catch(_0x3fe619){_0x46f9e8['push'](_0x46f9e8['shift']());}}}(a48_0x5167,0xf3d93));function a48_0x50ca(_0x50b4ee,_0x5a01e5){const _0x516763=a48_0x5167();return a48_0x50ca=function(_0x50caa0,_0x3a5c22){_0x50caa0=_0x50caa0-0xd5;let _0x463401=_0x516763[_0x50caa0];return _0x463401;},a48_0x50ca(_0x50b4ee,_0x5a01e5);}Object[a48_0x39632e(0xd9)](exports,'__esModule',{'value':!![]}),exports[a48_0x39632e(0xf7)]=void 0x0;const loggerService_1=require(a48_0x39632e(0x14d));class NodaService{constructor(){const _0x4204c3=a48_0x39632e;this[_0x4204c3(0x144)]=_0x4204c3(0x122),console['log'](_0x4204c3(0x134));}async[a48_0x39632e(0x103)](_0x53ce2e){const _0x2c13d9=a48_0x39632e,{orderId:_0x111091,name:_0x205826,paymentDescription:_0x3a8a9d,amount:_0x27e001,currency:_0x107166,webhookUrl:_0x45997a,returnUrl:_0x47585d,expiryDate:_0x4bf755}=_0x53ce2e,_0x1ec93a=_0x107166[_0x2c13d9(0x136)](),_0x567065=_0x2c13d9(0x10d),_0x57631a='https://tesoft.uk/gateway/pending.php?id='+_0x111091,_0x2f3383={'name':_0x205826,'paymentDescription':_0x3a8a9d,'amount':_0x27e001,'currency':_0x1ec93a,'paymentId':_0x111091,'webhookUrl':_0x567065,'returnUrl':_0x57631a};_0x4bf755&&(_0x2f3383[_0x2c13d9(0x119)]=_0x4bf755);const _0x3585ab=Date[_0x2c13d9(0x14f)]();try{console[_0x2c13d9(0xee)](_0x2c13d9(0xd6)),console[_0x2c13d9(0xee)](_0x2c13d9(0x10f),this[_0x2c13d9(0x144)]),console[_0x2c13d9(0xee)]('Request\x20Body\x20(Direct\x20JSON):',JSON['stringify'](_0x2f3383,null,0x2)),console[_0x2c13d9(0xee)](_0x2c13d9(0x124),_0x111091,_0x2c13d9(0x11f)),console[_0x2c13d9(0xee)](_0x2c13d9(0x14b),_0x57631a),loggerService_1[_0x2c13d9(0xd7)][_0x2c13d9(0xfe)](_0x2c13d9(0x145),_0x2c13d9(0x118),_0x2c13d9(0x150),_0x2f3383);const _0x457514=await fetch(this[_0x2c13d9(0x144)],{'method':_0x2c13d9(0x150),'headers':{'Content-Type':'application/json','Accept':_0x2c13d9(0x138),'User-Agent':_0x2c13d9(0xff)},'body':JSON[_0x2c13d9(0x128)](_0x2f3383)}),_0x430d3b=Date[_0x2c13d9(0x14f)]()-_0x3585ab;console[_0x2c13d9(0xee)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x2c13d9(0xee)](_0x2c13d9(0x115),_0x457514[_0x2c13d9(0x135)]),console[_0x2c13d9(0xee)](_0x2c13d9(0x116),_0x457514[_0x2c13d9(0x140)]),console[_0x2c13d9(0xee)]('Headers:',Object[_0x2c13d9(0xdd)](_0x457514['headers'][_0x2c13d9(0x102)]())),console[_0x2c13d9(0xee)]('Response\x20Time:',_0x430d3b+'ms');const _0x19c3bf=await _0x457514[_0x2c13d9(0xde)]();console['log'](_0x2c13d9(0xda),_0x19c3bf);if(!_0x457514['ok']){console['error']('===\x20NODA\x20API\x20ERROR\x20==='),console['error'](_0x2c13d9(0x10c),_0x457514[_0x2c13d9(0x135)]),console[_0x2c13d9(0xe1)](_0x2c13d9(0x12a),_0x19c3bf),loggerService_1[_0x2c13d9(0xd7)][_0x2c13d9(0xf5)](_0x2c13d9(0x145),_0x2c13d9(0x118),_0x457514[_0x2c13d9(0x135)],_0x19c3bf,_0x430d3b),loggerService_1['loggerService'][_0x2c13d9(0xeb)](_0x2c13d9(0x145),_0x2c13d9(0x118),_0x2c13d9(0x10a)+_0x457514['status']+':\x20'+_0x19c3bf);if(_0x457514[_0x2c13d9(0x135)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x457514[_0x2c13d9(0x135)]===0x1f4)throw new Error(_0x2c13d9(0xe7));}throw new Error(_0x2c13d9(0x10e)+_0x457514[_0x2c13d9(0x135)]+_0x2c13d9(0x11d)+_0x19c3bf);}let _0x14bcba;try{_0x14bcba=JSON['parse'](_0x19c3bf);}catch(_0x13561c){console[_0x2c13d9(0xe1)](_0x2c13d9(0xf0),_0x13561c),loggerService_1[_0x2c13d9(0xd7)][_0x2c13d9(0xeb)](_0x2c13d9(0x145),_0x2c13d9(0x118),_0x2c13d9(0x123)+_0x13561c);throw new Error(_0x2c13d9(0x100)+_0x19c3bf);}console['log'](_0x2c13d9(0xf2)),console['log'](_0x2c13d9(0x14e),JSON['stringify'](_0x14bcba,null,0x2)),loggerService_1[_0x2c13d9(0xd7)][_0x2c13d9(0xf5)](_0x2c13d9(0x145),_0x2c13d9(0x118),_0x457514[_0x2c13d9(0x135)],_0x14bcba,_0x430d3b);if(_0x14bcba[_0x2c13d9(0xe1)]||_0x14bcba['statusCode']){const _0x6412bb=_0x14bcba[_0x2c13d9(0x121)]||_0x14bcba[_0x2c13d9(0xe1)]||_0x2c13d9(0x139);console['error'](_0x2c13d9(0x132)),console[_0x2c13d9(0xe1)](_0x2c13d9(0x153),_0x6412bb),console[_0x2c13d9(0xe1)](_0x2c13d9(0x146),_0x14bcba[_0x2c13d9(0x11b)]),loggerService_1[_0x2c13d9(0xd7)][_0x2c13d9(0xeb)](_0x2c13d9(0x145),'/payment-links',_0x2c13d9(0x117)+_0x6412bb);throw new Error('Noda\x20API\x20error:\x20'+_0x6412bb);}if(!_0x14bcba['id']||!_0x14bcba[_0x2c13d9(0xec)]?.[_0x2c13d9(0x13e)]){console['error'](_0x2c13d9(0x114)),console[_0x2c13d9(0xe1)](_0x2c13d9(0xf6)),console[_0x2c13d9(0xe1)]('Response\x20data:',_0x14bcba),loggerService_1[_0x2c13d9(0xd7)][_0x2c13d9(0xeb)](_0x2c13d9(0x145),_0x2c13d9(0x118),_0x2c13d9(0x104));throw new Error(_0x2c13d9(0xd5));}return console['log'](_0x2c13d9(0x12c)),console[_0x2c13d9(0xee)](_0x2c13d9(0x154),_0x14bcba['id']),console[_0x2c13d9(0xee)](_0x2c13d9(0x147),_0x14bcba[_0x2c13d9(0xec)][_0x2c13d9(0x13e)]),console['log'](_0x2c13d9(0x13c),_0x14bcba[_0x2c13d9(0xec)][_0x2c13d9(0xd8)]||_0x2c13d9(0xe2)),console[_0x2c13d9(0xee)](_0x2c13d9(0x155),_0x111091,_0x2c13d9(0xe3)),console[_0x2c13d9(0xee)](_0x2c13d9(0x109),_0x57631a),{'gateway_payment_id':_0x14bcba['id'],'payment_url':_0x14bcba[_0x2c13d9(0xec)][_0x2c13d9(0x13e)],'qr_code_url':_0x14bcba[_0x2c13d9(0xec)][_0x2c13d9(0xd8)],'expiry_date':_0x14bcba[_0x2c13d9(0x119)]};}catch(_0x22725a){console[_0x2c13d9(0xe1)](_0x2c13d9(0x13a)),console[_0x2c13d9(0xe1)](_0x2c13d9(0xfd),_0x22725a),loggerService_1['loggerService']['logWhiteDomainError'](_0x2c13d9(0x145),_0x2c13d9(0x118),_0x22725a);if(_0x22725a instanceof Error){console[_0x2c13d9(0xe1)](_0x2c13d9(0xef),_0x22725a[_0x2c13d9(0x121)]),console['error']('Error\x20stack:',_0x22725a[_0x2c13d9(0x151)]);throw new Error(_0x2c13d9(0x12f)+_0x22725a[_0x2c13d9(0x121)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x5c2ceb){const _0x59ca2c=a48_0x39632e,_0x343fe7=Date[_0x59ca2c(0x14f)]();try{loggerService_1['loggerService'][_0x59ca2c(0xfe)]('noda',_0x59ca2c(0x110)+_0x5c2ceb,_0x59ca2c(0x13d),{});const _0x301e8a=await fetch(this[_0x59ca2c(0x144)]+'/'+_0x5c2ceb,{'method':_0x59ca2c(0x13d),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x474dba=Date[_0x59ca2c(0x14f)]()-_0x343fe7;if(!_0x301e8a['ok']){const _0x261cb0=await _0x301e8a[_0x59ca2c(0xde)]();loggerService_1['loggerService'][_0x59ca2c(0xf5)](_0x59ca2c(0x145),_0x59ca2c(0x110)+_0x5c2ceb,_0x301e8a[_0x59ca2c(0x135)],_0x261cb0,_0x474dba);throw new Error('HTTP\x20error!\x20status:\x20'+_0x301e8a[_0x59ca2c(0x135)]);}const _0x139eba=await _0x301e8a[_0x59ca2c(0x127)]();loggerService_1[_0x59ca2c(0xd7)]['logWhiteDomainResponse']('noda',_0x59ca2c(0x110)+_0x5c2ceb,_0x301e8a[_0x59ca2c(0x135)],_0x139eba,_0x474dba);if(_0x139eba[_0x59ca2c(0xe1)]||_0x139eba['statusCode']){loggerService_1[_0x59ca2c(0xd7)][_0x59ca2c(0xeb)](_0x59ca2c(0x145),_0x59ca2c(0x110)+_0x5c2ceb,'Noda\x20API\x20error:\x20'+(_0x139eba[_0x59ca2c(0x121)]||_0x139eba['error']||_0x59ca2c(0xdb)));throw new Error(_0x59ca2c(0xdc)+(_0x139eba[_0x59ca2c(0x121)]||_0x139eba[_0x59ca2c(0xe1)]||'Unknown\x20error'));}let _0x444fb3=_0x59ca2c(0xea);if(_0x139eba[_0x59ca2c(0x13f)]===![]){if(_0x139eba[_0x59ca2c(0x119)]){const _0x617161=new Date(_0x139eba[_0x59ca2c(0x119)]),_0x238c10=new Date();_0x617161<_0x238c10?_0x444fb3=_0x59ca2c(0xe6):_0x444fb3='FAILED';}else _0x444fb3=_0x59ca2c(0xf9);}else _0x444fb3=_0x59ca2c(0xea);return{'status':_0x444fb3,'amount':_0x139eba[_0x59ca2c(0x113)],'currency':_0x139eba[_0x59ca2c(0x10b)],'isActive':_0x139eba['isActive']};}catch(_0x3f79cc){console[_0x59ca2c(0xe1)](_0x59ca2c(0xf3),_0x3f79cc),loggerService_1['loggerService']['logWhiteDomainError'](_0x59ca2c(0x145),'/payment-links/'+_0x5c2ceb,_0x3f79cc);throw new Error(_0x59ca2c(0xdf)+(_0x3f79cc instanceof Error?_0x3f79cc[_0x59ca2c(0x121)]:_0x59ca2c(0xdb)));}}async['processWebhook'](_0x5f8fae){const _0x3b0251=a48_0x39632e;console[_0x3b0251(0xee)]('Processing\x20Noda\x20webhook:',_0x5f8fae);let _0x21952d='PENDING';switch(_0x5f8fae[_0x3b0251(0x101)]?.[_0x3b0251(0xe4)]()){case'done':case _0x3b0251(0x11a):case _0x3b0251(0x143):case _0x3b0251(0x112):case _0x3b0251(0x105):_0x5f8fae[_0x3b0251(0x152)]===_0x3b0251(0x106)?_0x21952d=_0x3b0251(0x14c):_0x21952d=_0x3b0251(0xea);break;case _0x3b0251(0xfa):case _0x3b0251(0xf1):case _0x3b0251(0x133):case _0x3b0251(0xe1):case _0x3b0251(0x12e):_0x21952d='FAILED';break;case'expired':case _0x3b0251(0x111):_0x21952d=_0x3b0251(0xe6);break;case _0x3b0251(0xe8):case'created':case _0x3b0251(0x130):case _0x3b0251(0x120):case _0x3b0251(0x11c):default:_0x21952d=_0x3b0251(0xea);break;}return{'paymentId':_0x5f8fae[_0x3b0251(0xf4)]||_0x5f8fae['PaymentId'],'status':_0x21952d,'amount':_0x5f8fae[_0x3b0251(0xe0)],'currency':_0x5f8fae[_0x3b0251(0x126)],'additionalInfo':{'method':_0x5f8fae[_0x3b0251(0x14a)],'bankId':_0x5f8fae[_0x3b0251(0x131)],'settled':_0x5f8fae[_0x3b0251(0x152)],'settlementDate':_0x5f8fae['SettlementDate'],'remitterName':_0x5f8fae[_0x3b0251(0x125)]?.[_0x3b0251(0x148)],'remitterIban':_0x5f8fae['Remitter']?.[_0x3b0251(0x149)],'bankTransactionId':_0x5f8fae[_0x3b0251(0x137)]}};}[a48_0x39632e(0x12d)](_0xdb984b,_0x2870f1){const _0x46b24c=a48_0x39632e;return console[_0x46b24c(0xee)](_0x46b24c(0x129),{'receivedSignature':_0x2870f1,'paymentId':_0xdb984b[_0x46b24c(0x142)],'merchantPaymentId':_0xdb984b['MerchantPaymentId']}),!![];}}exports['NodaService']=NodaService;