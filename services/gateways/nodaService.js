'use strict';const a44_0x1d39a3=a44_0x4a5e;(function(_0x4fc7e0,_0x2bcf51){const _0x5a246e=a44_0x4a5e,_0x28abe1=_0x4fc7e0();while(!![]){try{const _0x50dcbd=-parseInt(_0x5a246e(0x266))/0x1+-parseInt(_0x5a246e(0x22a))/0x2+parseInt(_0x5a246e(0x25d))/0x3*(parseInt(_0x5a246e(0x220))/0x4)+parseInt(_0x5a246e(0x201))/0x5*(parseInt(_0x5a246e(0x227))/0x6)+parseInt(_0x5a246e(0x1f5))/0x7+parseInt(_0x5a246e(0x25e))/0x8*(-parseInt(_0x5a246e(0x1fe))/0x9)+-parseInt(_0x5a246e(0x235))/0xa*(-parseInt(_0x5a246e(0x269))/0xb);if(_0x50dcbd===_0x2bcf51)break;else _0x28abe1['push'](_0x28abe1['shift']());}catch(_0x5a96ad){_0x28abe1['push'](_0x28abe1['shift']());}}}(a44_0x1dca,0x36d2e));function a44_0x1dca(){const _0x43a7ca=['Request\x20Body\x20(Direct\x20JSON):','PENDING','https://tesoft.uk/gateway/pending.php?id=','Business\x20Error:\x20','Noda\x20API\x20error:\x20','https://tesoft.uk/gateway/noda/','entries','HTTP\x20error!\x20status:\x20','Headers:','created','Status:','FAILED','Remitter','qrCodeLink','text','PaymentId','logWhiteDomainError','Order\x20ID\x20Used:','1563UGelgc','136DKThJH','EXPIRED','HTTP\x20','Iban','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','completed','Currency','414146FqKCoH','Name','stack','5644012iVrwZv','GET','done','Short\x20Link:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','apiUrl','in_progress','NodaService','1939735glqNak','timeout','SettlementDate','Payment\x20Link\x20ID:','URL:','successful',',\x20body:\x20','isActive','shortLink','185931CLefLQ','Missing\x20id\x20or\x20shortLink\x20in\x20response','===\x20PARSED\x20NODA\x20RESPONSE\x20===','415160rZlSbb','__esModule','noda','Error\x20message:','logWhiteDomainResponse','https://tesoft.uk/gateway/noda/webhook/','Method','Order\x20ID\x20Format:','paid','fromEntries','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','headers','toLowerCase','createPaymentLink','BankId','processing','now','expiryDate','statusText','pending','Unknown\x20error\x20from\x20Noda\x20API','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','json','Raw\x20Response\x20Body:','Processing\x20Noda\x20webhook:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','expired','Failed\x20to\x20parse\x20JSON\x20response:','1204PIyLvT','/payment-links','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','status','PAID','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','logWhiteDomainRequest','12bkKlki','message','rejected','246350TQgcfk','QR\x20Code\x20Link:','Settled','TesSoft\x20Payment\x20System/1.0','verifyPayment','failed','loggerService','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','application/json','../loggerService','processWebhook','10qBXZrm','MerchantPaymentId','===\x20NODA\x20API\x20ERROR\x20===','Status\x20Text:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Response\x20Time:','Error\x20Message:','Response\x20Body:','(8digits-8digits\x20format\x20for\x20Noda)','===\x20NODA\x20SERVICE\x20ERROR\x20===','shortLinkUrls','/payment-links/','Status','log','POST','stringify','statusCode','error','currency','Status\x20Code:','Yes','Unknown\x20error'];a44_0x1dca=function(){return _0x43a7ca;};return a44_0x1dca();}Object['defineProperty'](exports,a44_0x1d39a3(0x202),{'value':!![]}),exports[a44_0x1d39a3(0x1f4)]=void 0x0;const loggerService_1=require(a44_0x1d39a3(0x233));function a44_0x4a5e(_0xf46c56,_0x15e1d2){const _0x1dcaf0=a44_0x1dca();return a44_0x4a5e=function(_0x4a5eb9,_0x4fe00a){_0x4a5eb9=_0x4a5eb9-0x1f4;let _0x2ad368=_0x1dcaf0[_0x4a5eb9];return _0x2ad368;},a44_0x4a5e(_0xf46c56,_0x15e1d2);}class NodaService{constructor(){const _0x142ac2=a44_0x1d39a3;this[_0x142ac2(0x26e)]=_0x142ac2(0x250),console[_0x142ac2(0x242)](_0x142ac2(0x21a));}async[a44_0x1d39a3(0x20e)](_0x4985e7){const _0x3cf6a5=a44_0x1d39a3,{orderId:_0x1c4126,name:_0x497b07,paymentDescription:_0x368ec3,amount:_0x18646f,currency:_0x5d69e1,webhookUrl:_0x554ec5,returnUrl:_0x5939fc,expiryDate:_0xd46573}=_0x4985e7,_0x1786b3=_0x5d69e1['toUpperCase'](),_0x106e87=_0x3cf6a5(0x206),_0x1a9379=_0x3cf6a5(0x24d)+_0x1c4126,_0x1c8b8a={'name':_0x497b07,'paymentDescription':_0x368ec3,'amount':_0x18646f,'currency':_0x1786b3,'paymentId':_0x1c4126,'webhookUrl':_0x106e87,'returnUrl':_0x1a9379};_0xd46573&&(_0x1c8b8a[_0x3cf6a5(0x212)]=_0xd46573);const _0x1f1928=Date[_0x3cf6a5(0x211)]();try{console[_0x3cf6a5(0x242)](_0x3cf6a5(0x263)),console[_0x3cf6a5(0x242)](_0x3cf6a5(0x1f9),this['apiUrl']),console['log'](_0x3cf6a5(0x24b),JSON['stringify'](_0x1c8b8a,null,0x2)),console[_0x3cf6a5(0x242)](_0x3cf6a5(0x208),_0x1c4126,_0x3cf6a5(0x23d)),console['log'](_0x3cf6a5(0x21c),_0x1a9379),loggerService_1[_0x3cf6a5(0x230)][_0x3cf6a5(0x226)](_0x3cf6a5(0x203),_0x3cf6a5(0x221),_0x3cf6a5(0x243),_0x1c8b8a);const _0x24c850=await fetch(this['apiUrl'],{'method':_0x3cf6a5(0x243),'headers':{'Content-Type':'application/json','Accept':_0x3cf6a5(0x232),'User-Agent':_0x3cf6a5(0x22d)},'body':JSON[_0x3cf6a5(0x244)](_0x1c8b8a)}),_0x21c809=Date[_0x3cf6a5(0x211)]()-_0x1f1928;console[_0x3cf6a5(0x242)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x3cf6a5(0x242)](_0x3cf6a5(0x255),_0x24c850[_0x3cf6a5(0x223)]),console[_0x3cf6a5(0x242)](_0x3cf6a5(0x238),_0x24c850[_0x3cf6a5(0x213)]),console[_0x3cf6a5(0x242)](_0x3cf6a5(0x253),Object[_0x3cf6a5(0x20a)](_0x24c850[_0x3cf6a5(0x20c)][_0x3cf6a5(0x251)]())),console[_0x3cf6a5(0x242)](_0x3cf6a5(0x23a),_0x21c809+'ms');const _0x5f894c=await _0x24c850[_0x3cf6a5(0x259)]();console[_0x3cf6a5(0x242)](_0x3cf6a5(0x218),_0x5f894c);if(!_0x24c850['ok']){console[_0x3cf6a5(0x246)](_0x3cf6a5(0x237)),console[_0x3cf6a5(0x246)]('HTTP\x20Status:',_0x24c850['status']),console[_0x3cf6a5(0x246)](_0x3cf6a5(0x23c),_0x5f894c),loggerService_1[_0x3cf6a5(0x230)][_0x3cf6a5(0x205)](_0x3cf6a5(0x203),_0x3cf6a5(0x221),_0x24c850['status'],_0x5f894c,_0x21c809),loggerService_1[_0x3cf6a5(0x230)][_0x3cf6a5(0x25b)]('noda',_0x3cf6a5(0x221),_0x3cf6a5(0x260)+_0x24c850[_0x3cf6a5(0x223)]+':\x20'+_0x5f894c);if(_0x24c850[_0x3cf6a5(0x223)]===0x190)throw new Error(_0x3cf6a5(0x239));else{if(_0x24c850['status']===0x1f4)throw new Error(_0x3cf6a5(0x262));}throw new Error(_0x3cf6a5(0x252)+_0x24c850[_0x3cf6a5(0x223)]+_0x3cf6a5(0x1fb)+_0x5f894c);}let _0xb26c1b;try{_0xb26c1b=JSON['parse'](_0x5f894c);}catch(_0x4f4287){console[_0x3cf6a5(0x246)](_0x3cf6a5(0x21f),_0x4f4287),loggerService_1[_0x3cf6a5(0x230)][_0x3cf6a5(0x25b)](_0x3cf6a5(0x203),_0x3cf6a5(0x221),'JSON\x20Parse\x20Error:\x20'+_0x4f4287);throw new Error(_0x3cf6a5(0x222)+_0x5f894c);}console[_0x3cf6a5(0x242)](_0x3cf6a5(0x200)),console[_0x3cf6a5(0x242)]('Parsed\x20Result:',JSON[_0x3cf6a5(0x244)](_0xb26c1b,null,0x2)),loggerService_1[_0x3cf6a5(0x230)][_0x3cf6a5(0x205)](_0x3cf6a5(0x203),'/payment-links',_0x24c850[_0x3cf6a5(0x223)],_0xb26c1b,_0x21c809);if(_0xb26c1b[_0x3cf6a5(0x246)]||_0xb26c1b[_0x3cf6a5(0x245)]){const _0x114e9b=_0xb26c1b[_0x3cf6a5(0x228)]||_0xb26c1b[_0x3cf6a5(0x246)]||_0x3cf6a5(0x215);console[_0x3cf6a5(0x246)](_0x3cf6a5(0x21d)),console['error'](_0x3cf6a5(0x23b),_0x114e9b),console[_0x3cf6a5(0x246)](_0x3cf6a5(0x248),_0xb26c1b[_0x3cf6a5(0x245)]),loggerService_1[_0x3cf6a5(0x230)]['logWhiteDomainError'](_0x3cf6a5(0x203),'/payment-links',_0x3cf6a5(0x24e)+_0x114e9b);throw new Error(_0x3cf6a5(0x24f)+_0x114e9b);}if(!_0xb26c1b['id']||!_0xb26c1b['shortLinkUrls']?.[_0x3cf6a5(0x1fd)]){console[_0x3cf6a5(0x246)](_0x3cf6a5(0x26d)),console[_0x3cf6a5(0x246)](_0x3cf6a5(0x1ff)),console['error']('Response\x20data:',_0xb26c1b),loggerService_1[_0x3cf6a5(0x230)][_0x3cf6a5(0x25b)](_0x3cf6a5(0x203),_0x3cf6a5(0x221),_0x3cf6a5(0x231));throw new Error(_0x3cf6a5(0x21b));}return console[_0x3cf6a5(0x242)]('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x3cf6a5(0x1f8),_0xb26c1b['id']),console['log'](_0x3cf6a5(0x26c),_0xb26c1b[_0x3cf6a5(0x23f)][_0x3cf6a5(0x1fd)]),console[_0x3cf6a5(0x242)](_0x3cf6a5(0x22b),_0xb26c1b[_0x3cf6a5(0x23f)][_0x3cf6a5(0x258)]||'Not\x20provided'),console[_0x3cf6a5(0x242)](_0x3cf6a5(0x25c),_0x1c4126,'(8digits-8digits\x20format)'),console[_0x3cf6a5(0x242)](_0x3cf6a5(0x225),_0x1a9379),{'gateway_payment_id':_0xb26c1b['id'],'payment_url':_0xb26c1b[_0x3cf6a5(0x23f)][_0x3cf6a5(0x1fd)],'qr_code_url':_0xb26c1b[_0x3cf6a5(0x23f)][_0x3cf6a5(0x258)],'expiry_date':_0xb26c1b[_0x3cf6a5(0x212)]};}catch(_0x5ab32b){console[_0x3cf6a5(0x246)](_0x3cf6a5(0x23e)),console[_0x3cf6a5(0x246)]('Error\x20details:',_0x5ab32b),loggerService_1[_0x3cf6a5(0x230)][_0x3cf6a5(0x25b)](_0x3cf6a5(0x203),_0x3cf6a5(0x221),_0x5ab32b);if(_0x5ab32b instanceof Error){console[_0x3cf6a5(0x246)](_0x3cf6a5(0x204),_0x5ab32b['message']),console[_0x3cf6a5(0x246)]('Error\x20stack:',_0x5ab32b[_0x3cf6a5(0x268)]);throw new Error(_0x3cf6a5(0x216)+_0x5ab32b[_0x3cf6a5(0x228)]);}throw new Error(_0x3cf6a5(0x20b));}}async[a44_0x1d39a3(0x22e)](_0x13ee20){const _0x31da12=a44_0x1d39a3,_0x5d542a=Date['now']();try{loggerService_1['loggerService']['logWhiteDomainRequest']('noda','/payment-links/'+_0x13ee20,_0x31da12(0x26a),{});const _0x4f112b=await fetch(this[_0x31da12(0x26e)]+'/'+_0x13ee20,{'method':_0x31da12(0x26a),'headers':{'Content-Type':_0x31da12(0x232),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x42cf62=Date['now']()-_0x5d542a;if(!_0x4f112b['ok']){const _0x506104=await _0x4f112b[_0x31da12(0x259)]();loggerService_1['loggerService'][_0x31da12(0x205)](_0x31da12(0x203),'/payment-links/'+_0x13ee20,_0x4f112b['status'],_0x506104,_0x42cf62);throw new Error(_0x31da12(0x252)+_0x4f112b[_0x31da12(0x223)]);}const _0xedfe56=await _0x4f112b[_0x31da12(0x217)]();loggerService_1['loggerService'][_0x31da12(0x205)](_0x31da12(0x203),_0x31da12(0x240)+_0x13ee20,_0x4f112b[_0x31da12(0x223)],_0xedfe56,_0x42cf62);if(_0xedfe56[_0x31da12(0x246)]||_0xedfe56['statusCode']){loggerService_1[_0x31da12(0x230)][_0x31da12(0x25b)]('noda',_0x31da12(0x240)+_0x13ee20,_0x31da12(0x24f)+(_0xedfe56[_0x31da12(0x228)]||_0xedfe56[_0x31da12(0x246)]||'Unknown\x20error'));throw new Error('Noda\x20API\x20error:\x20'+(_0xedfe56['message']||_0xedfe56[_0x31da12(0x246)]||_0x31da12(0x24a)));}let _0x1f37dc=_0x31da12(0x24c);if(_0xedfe56[_0x31da12(0x1fc)]===![]){if(_0xedfe56[_0x31da12(0x212)]){const _0x211393=new Date(_0xedfe56[_0x31da12(0x212)]),_0x249530=new Date();_0x211393<_0x249530?_0x1f37dc=_0x31da12(0x25f):_0x1f37dc='FAILED';}else _0x1f37dc=_0x31da12(0x256);}else _0x1f37dc=_0x31da12(0x24c);return{'status':_0x1f37dc,'amount':_0xedfe56['amount'],'currency':_0xedfe56[_0x31da12(0x247)],'isActive':_0xedfe56[_0x31da12(0x1fc)]};}catch(_0x4d7f39){console[_0x31da12(0x246)]('Noda\x20payment\x20verification\x20error:',_0x4d7f39),loggerService_1['loggerService'][_0x31da12(0x25b)](_0x31da12(0x203),_0x31da12(0x240)+_0x13ee20,_0x4d7f39);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x4d7f39 instanceof Error?_0x4d7f39[_0x31da12(0x228)]:'Unknown\x20error'));}}async[a44_0x1d39a3(0x234)](_0x308a8c){const _0x2de705=a44_0x1d39a3;console[_0x2de705(0x242)](_0x2de705(0x219),_0x308a8c);let _0x2e4fea=_0x2de705(0x24c);switch(_0x308a8c[_0x2de705(0x241)]?.[_0x2de705(0x20d)]()){case _0x2de705(0x26b):case _0x2de705(0x264):case _0x2de705(0x209):case'success':case _0x2de705(0x1fa):_0x308a8c[_0x2de705(0x22c)]===_0x2de705(0x249)?_0x2e4fea=_0x2de705(0x224):_0x2e4fea=_0x2de705(0x24c);break;case'cancelled':case'canceled':case _0x2de705(0x22f):case _0x2de705(0x246):case _0x2de705(0x229):_0x2e4fea=_0x2de705(0x256);break;case _0x2de705(0x21e):case _0x2de705(0x1f6):_0x2e4fea=_0x2de705(0x25f);break;case _0x2de705(0x214):case _0x2de705(0x254):case'active':case _0x2de705(0x210):case _0x2de705(0x26f):default:_0x2e4fea=_0x2de705(0x24c);break;}return{'paymentId':_0x308a8c[_0x2de705(0x236)]||_0x308a8c[_0x2de705(0x25a)],'status':_0x2e4fea,'amount':_0x308a8c['Amount'],'currency':_0x308a8c[_0x2de705(0x265)],'additionalInfo':{'method':_0x308a8c[_0x2de705(0x207)],'bankId':_0x308a8c[_0x2de705(0x20f)],'settled':_0x308a8c[_0x2de705(0x22c)],'settlementDate':_0x308a8c[_0x2de705(0x1f7)],'remitterName':_0x308a8c[_0x2de705(0x257)]?.[_0x2de705(0x267)],'remitterIban':_0x308a8c['Remitter']?.[_0x2de705(0x261)],'bankTransactionId':_0x308a8c['BankTransactionId']}};}['verifyWebhookSignature'](_0x1c45b6,_0x3b2791){const _0x499b9f=a44_0x1d39a3;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x3b2791,'paymentId':_0x1c45b6[_0x499b9f(0x25a)],'merchantPaymentId':_0x1c45b6['MerchantPaymentId']}),!![];}}exports[a44_0x1d39a3(0x1f4)]=NodaService;