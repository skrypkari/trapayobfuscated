'use strict';const a44_0x7da45f=a44_0x2e2c;(function(_0x5d925a,_0x4282f1){const _0x4d188d=a44_0x2e2c,_0xa6dc4d=_0x5d925a();while(!![]){try{const _0x24de22=-parseInt(_0x4d188d(0x131))/0x1*(-parseInt(_0x4d188d(0x103))/0x2)+parseInt(_0x4d188d(0x116))/0x3+parseInt(_0x4d188d(0x129))/0x4*(-parseInt(_0x4d188d(0x146))/0x5)+-parseInt(_0x4d188d(0x16b))/0x6*(parseInt(_0x4d188d(0x13a))/0x7)+-parseInt(_0x4d188d(0x10f))/0x8*(-parseInt(_0x4d188d(0x115))/0x9)+parseInt(_0x4d188d(0x12e))/0xa*(parseInt(_0x4d188d(0x167))/0xb)+-parseInt(_0x4d188d(0x156))/0xc*(parseInt(_0x4d188d(0x12a))/0xd);if(_0x24de22===_0x4282f1)break;else _0xa6dc4d['push'](_0xa6dc4d['shift']());}catch(_0x1f7bad){_0xa6dc4d['push'](_0xa6dc4d['shift']());}}}(a44_0x4349,0x96980));Object[a44_0x7da45f(0x100)](exports,a44_0x7da45f(0x166),{'value':!![]}),exports['NodaService']=void 0x0;function a44_0x4349(){const _0x44bca2=['failed','shortLink','Settled','processing','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','HTTP\x20Status:','MerchantPaymentId','PENDING','verifyWebhookSignature','12CPHxGU','cancelled','stringify','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Method','Status\x20Text:','noda','currency','BankTransactionId','created','toUpperCase','statusText','qrCodeLink','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','error','pending','__esModule','33561qpMVZD','processWebhook','isActive','QR\x20Code\x20Link:','3270oaahFl','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','logWhiteDomainResponse','successful','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','/payment-links/','timeout','Response\x20Body:','Status:','HTTP\x20error!\x20status:\x20','Noda\x20API\x20error:\x20','defineProperty','Payment\x20Link\x20ID:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','410mekLQc','message','Processing\x20Noda\x20webhook:','Response\x20Time:','Short\x20Link:','loggerService','Remitter','log','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Noda\x20payment\x20verification\x20error:','Noda\x20webhook\x20signature\x20verification:','Unknown\x20error','4222408HNGfsw','===\x20NODA\x20SERVICE\x20ERROR\x20===','apiUrl','Request\x20Body\x20(Direct\x20JSON):','logWhiteDomainRequest','FAILED','18kNveeS','244668SITVON','Parsed\x20Result:','Error\x20Message:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','toLowerCase','now','POST',',\x20body:\x20','Failed\x20to\x20parse\x20JSON\x20response:','Status\x20Code:','application/json','done','Status','HTTP\x20','canceled','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Error\x20message:','paid','421436qfguks','1608165EfqHlL','logWhiteDomainError','verifyPayment','URL:','310YBndsw','===\x20NODA\x20API\x20ERROR\x20===','https://tesoft.uk/gateway/noda/webhook/','2873NeiJih','Currency','TesSoft\x20Payment\x20System/1.0','expiryDate','/payment-links','Failed\x20to\x20verify\x20Noda\x20payment:\x20','BankId','Order\x20ID\x20Format:','Iban','9814KWPjaS','JSON\x20Parse\x20Error:\x20','GET','Missing\x20id\x20or\x20shortLink\x20in\x20response','EXPIRED','PaymentId','statusCode','===\x20NODA\x20SUCCESS\x20===','Not\x20provided','text','stack','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','15uZfqom','status','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','createPaymentLink','https://tesoft.uk/gateway/noda/','shortLinkUrls'];a44_0x4349=function(){return _0x44bca2;};return a44_0x4349();}function a44_0x2e2c(_0x2d29cf,_0x2c2aa5){const _0x43490b=a44_0x4349();return a44_0x2e2c=function(_0x2e2c25,_0x34b473){_0x2e2c25=_0x2e2c25-0xf7;let _0x46eabd=_0x43490b[_0x2e2c25];return _0x46eabd;},a44_0x2e2c(_0x2d29cf,_0x2c2aa5);}const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x4c5089=a44_0x7da45f;this[_0x4c5089(0x111)]=_0x4c5089(0x14b),console[_0x4c5089(0x10a)](_0x4c5089(0x149));}async[a44_0x7da45f(0x14a)](_0x83c2d1){const _0x126fa4=a44_0x7da45f,{orderId:_0x6dcba1,name:_0x271586,paymentDescription:_0x3deea7,amount:_0x3c73ea,currency:_0x580217,webhookUrl:_0x1a3dff,returnUrl:_0xabacd1,expiryDate:_0x5001e2}=_0x83c2d1,_0x38085a=_0x580217[_0x126fa4(0x160)](),_0x4e0df0=_0x126fa4(0x130),_0x4a0628='https://tesoft.uk/gateway/pending.php?id='+_0x6dcba1,_0x494d2b={'name':_0x271586,'paymentDescription':_0x3deea7,'amount':_0x3c73ea,'currency':_0x38085a,'paymentId':_0x6dcba1,'webhookUrl':_0x4e0df0,'returnUrl':_0x4a0628};_0x5001e2&&(_0x494d2b['expiryDate']=_0x5001e2);const _0x5e2518=Date[_0x126fa4(0x11c)]();try{console[_0x126fa4(0x10a)](_0x126fa4(0x145)),console[_0x126fa4(0x10a)](_0x126fa4(0x12d),this[_0x126fa4(0x111)]),console[_0x126fa4(0x10a)](_0x126fa4(0x112),JSON['stringify'](_0x494d2b,null,0x2)),console[_0x126fa4(0x10a)](_0x126fa4(0x138),_0x6dcba1,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x126fa4(0x10a)](_0x126fa4(0x16c),_0x4a0628),loggerService_1['loggerService']['logWhiteDomainRequest']('noda','/payment-links',_0x126fa4(0x11d),_0x494d2b);const _0x442a31=await fetch(this[_0x126fa4(0x111)],{'method':_0x126fa4(0x11d),'headers':{'Content-Type':_0x126fa4(0x121),'Accept':'application/json','User-Agent':_0x126fa4(0x133)},'body':JSON['stringify'](_0x494d2b)}),_0x27279b=Date['now']()-_0x5e2518;console[_0x126fa4(0x10a)](_0x126fa4(0x148)),console[_0x126fa4(0x10a)](_0x126fa4(0xfd),_0x442a31[_0x126fa4(0x147)]),console[_0x126fa4(0x10a)](_0x126fa4(0x15b),_0x442a31[_0x126fa4(0x161)]),console[_0x126fa4(0x10a)]('Headers:',Object['fromEntries'](_0x442a31['headers']['entries']())),console[_0x126fa4(0x10a)](_0x126fa4(0x106),_0x27279b+'ms');const _0x5d103a=await _0x442a31['text']();console['log']('Raw\x20Response\x20Body:',_0x5d103a);if(!_0x442a31['ok']){console[_0x126fa4(0x164)](_0x126fa4(0x12f)),console['error'](_0x126fa4(0x152),_0x442a31[_0x126fa4(0x147)]),console[_0x126fa4(0x164)](_0x126fa4(0xfc),_0x5d103a),loggerService_1[_0x126fa4(0x108)]['logWhiteDomainResponse']('noda',_0x126fa4(0x135),_0x442a31[_0x126fa4(0x147)],_0x5d103a,_0x27279b),loggerService_1['loggerService'][_0x126fa4(0x12b)]('noda',_0x126fa4(0x135),_0x126fa4(0x124)+_0x442a31[_0x126fa4(0x147)]+':\x20'+_0x5d103a);if(_0x442a31[_0x126fa4(0x147)]===0x190)throw new Error(_0x126fa4(0x163));else{if(_0x442a31[_0x126fa4(0x147)]===0x1f4)throw new Error(_0x126fa4(0x11a));}throw new Error(_0x126fa4(0xfe)+_0x442a31['status']+_0x126fa4(0x11e)+_0x5d103a);}let _0x445078;try{_0x445078=JSON['parse'](_0x5d103a);}catch(_0x2cb4b0){console[_0x126fa4(0x164)](_0x126fa4(0x11f),_0x2cb4b0),loggerService_1['loggerService'][_0x126fa4(0x12b)](_0x126fa4(0x15c),_0x126fa4(0x135),_0x126fa4(0x13b)+_0x2cb4b0);throw new Error(_0x126fa4(0x102)+_0x5d103a);}console[_0x126fa4(0x10a)](_0x126fa4(0x126)),console[_0x126fa4(0x10a)](_0x126fa4(0x117),JSON[_0x126fa4(0x158)](_0x445078,null,0x2)),loggerService_1[_0x126fa4(0x108)][_0x126fa4(0xf7)]('noda',_0x126fa4(0x135),_0x442a31[_0x126fa4(0x147)],_0x445078,_0x27279b);if(_0x445078[_0x126fa4(0x164)]||_0x445078['statusCode']){const _0x197b99=_0x445078[_0x126fa4(0x104)]||_0x445078[_0x126fa4(0x164)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x126fa4(0x164)](_0x126fa4(0x159)),console[_0x126fa4(0x164)](_0x126fa4(0x118),_0x197b99),console[_0x126fa4(0x164)](_0x126fa4(0x120),_0x445078[_0x126fa4(0x140)]),loggerService_1[_0x126fa4(0x108)][_0x126fa4(0x12b)](_0x126fa4(0x15c),'/payment-links','Business\x20Error:\x20'+_0x197b99);throw new Error(_0x126fa4(0xff)+_0x197b99);}if(!_0x445078['id']||!_0x445078[_0x126fa4(0x14c)]?.[_0x126fa4(0x14e)]){console['error'](_0x126fa4(0x10b)),console[_0x126fa4(0x164)](_0x126fa4(0x13d)),console[_0x126fa4(0x164)]('Response\x20data:',_0x445078),loggerService_1[_0x126fa4(0x108)][_0x126fa4(0x12b)](_0x126fa4(0x15c),'/payment-links',_0x126fa4(0x119));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x126fa4(0x10a)](_0x126fa4(0x141)),console[_0x126fa4(0x10a)](_0x126fa4(0x101),_0x445078['id']),console[_0x126fa4(0x10a)](_0x126fa4(0x107),_0x445078['shortLinkUrls']['shortLink']),console['log'](_0x126fa4(0x16a),_0x445078[_0x126fa4(0x14c)][_0x126fa4(0x162)]||_0x126fa4(0x142)),console[_0x126fa4(0x10a)]('Order\x20ID\x20Used:',_0x6dcba1,'(8digits-8digits\x20format)'),console[_0x126fa4(0x10a)](_0x126fa4(0xf9),_0x4a0628),{'gateway_payment_id':_0x445078['id'],'payment_url':_0x445078[_0x126fa4(0x14c)][_0x126fa4(0x14e)],'qr_code_url':_0x445078[_0x126fa4(0x14c)][_0x126fa4(0x162)],'expiry_date':_0x445078[_0x126fa4(0x134)]};}catch(_0x2f886a){console['error'](_0x126fa4(0x110)),console[_0x126fa4(0x164)]('Error\x20details:',_0x2f886a),loggerService_1[_0x126fa4(0x108)]['logWhiteDomainError'](_0x126fa4(0x15c),_0x126fa4(0x135),_0x2f886a);if(_0x2f886a instanceof Error){console[_0x126fa4(0x164)](_0x126fa4(0x127),_0x2f886a[_0x126fa4(0x104)]),console[_0x126fa4(0x164)]('Error\x20stack:',_0x2f886a[_0x126fa4(0x144)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x2f886a['message']);}throw new Error(_0x126fa4(0x151));}}async[a44_0x7da45f(0x12c)](_0x47be7e){const _0x3ae83e=a44_0x7da45f,_0x13bb57=Date['now']();try{loggerService_1[_0x3ae83e(0x108)][_0x3ae83e(0x113)]('noda',_0x3ae83e(0xfa)+_0x47be7e,_0x3ae83e(0x13c),{});const _0x308310=await fetch(this[_0x3ae83e(0x111)]+'/'+_0x47be7e,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x3ae83e(0x133)}}),_0x40a34e=Date[_0x3ae83e(0x11c)]()-_0x13bb57;if(!_0x308310['ok']){const _0x29e295=await _0x308310[_0x3ae83e(0x143)]();loggerService_1['loggerService'][_0x3ae83e(0xf7)](_0x3ae83e(0x15c),_0x3ae83e(0xfa)+_0x47be7e,_0x308310[_0x3ae83e(0x147)],_0x29e295,_0x40a34e);throw new Error(_0x3ae83e(0xfe)+_0x308310[_0x3ae83e(0x147)]);}const _0x2d4cec=await _0x308310['json']();loggerService_1[_0x3ae83e(0x108)]['logWhiteDomainResponse'](_0x3ae83e(0x15c),_0x3ae83e(0xfa)+_0x47be7e,_0x308310[_0x3ae83e(0x147)],_0x2d4cec,_0x40a34e);if(_0x2d4cec[_0x3ae83e(0x164)]||_0x2d4cec[_0x3ae83e(0x140)]){loggerService_1[_0x3ae83e(0x108)]['logWhiteDomainError'](_0x3ae83e(0x15c),_0x3ae83e(0xfa)+_0x47be7e,_0x3ae83e(0xff)+(_0x2d4cec[_0x3ae83e(0x104)]||_0x2d4cec[_0x3ae83e(0x164)]||'Unknown\x20error'));throw new Error(_0x3ae83e(0xff)+(_0x2d4cec[_0x3ae83e(0x104)]||_0x2d4cec[_0x3ae83e(0x164)]||_0x3ae83e(0x10e)));}let _0xb5df7a=_0x3ae83e(0x154);if(_0x2d4cec['isActive']===![]){if(_0x2d4cec[_0x3ae83e(0x134)]){const _0x1b01c7=new Date(_0x2d4cec['expiryDate']),_0xe7470c=new Date();_0x1b01c7<_0xe7470c?_0xb5df7a=_0x3ae83e(0x13e):_0xb5df7a=_0x3ae83e(0x114);}else _0xb5df7a=_0x3ae83e(0x114);}else _0xb5df7a=_0x3ae83e(0x154);return{'status':_0xb5df7a,'amount':_0x2d4cec['amount'],'currency':_0x2d4cec[_0x3ae83e(0x15d)],'isActive':_0x2d4cec[_0x3ae83e(0x169)]};}catch(_0x2f5a35){console[_0x3ae83e(0x164)](_0x3ae83e(0x10c),_0x2f5a35),loggerService_1[_0x3ae83e(0x108)]['logWhiteDomainError'](_0x3ae83e(0x15c),'/payment-links/'+_0x47be7e,_0x2f5a35);throw new Error(_0x3ae83e(0x136)+(_0x2f5a35 instanceof Error?_0x2f5a35[_0x3ae83e(0x104)]:_0x3ae83e(0x10e)));}}async[a44_0x7da45f(0x168)](_0x3c2b11){const _0x58b296=a44_0x7da45f;console[_0x58b296(0x10a)](_0x58b296(0x105),_0x3c2b11);let _0x28189a='PENDING';switch(_0x3c2b11[_0x58b296(0x123)]?.[_0x58b296(0x11b)]()){case _0x58b296(0x122):case'completed':case _0x58b296(0x128):case'success':case _0x58b296(0xf8):_0x3c2b11['Settled']==='Yes'?_0x28189a='PAID':_0x28189a=_0x58b296(0x154);break;case _0x58b296(0x157):case _0x58b296(0x125):case _0x58b296(0x14d):case _0x58b296(0x164):case'rejected':_0x28189a='FAILED';break;case'expired':case _0x58b296(0xfb):_0x28189a=_0x58b296(0x13e);break;case _0x58b296(0x165):case _0x58b296(0x15f):case'active':case _0x58b296(0x150):case'in_progress':default:_0x28189a=_0x58b296(0x154);break;}return{'paymentId':_0x3c2b11['MerchantPaymentId']||_0x3c2b11[_0x58b296(0x13f)],'status':_0x28189a,'amount':_0x3c2b11['Amount'],'currency':_0x3c2b11[_0x58b296(0x132)],'additionalInfo':{'method':_0x3c2b11[_0x58b296(0x15a)],'bankId':_0x3c2b11[_0x58b296(0x137)],'settled':_0x3c2b11[_0x58b296(0x14f)],'settlementDate':_0x3c2b11['SettlementDate'],'remitterName':_0x3c2b11[_0x58b296(0x109)]?.['Name'],'remitterIban':_0x3c2b11[_0x58b296(0x109)]?.[_0x58b296(0x139)],'bankTransactionId':_0x3c2b11[_0x58b296(0x15e)]}};}[a44_0x7da45f(0x155)](_0xe5dcc4,_0x3b603c){const _0x1ea947=a44_0x7da45f;return console[_0x1ea947(0x10a)](_0x1ea947(0x10d),{'receivedSignature':_0x3b603c,'paymentId':_0xe5dcc4['PaymentId'],'merchantPaymentId':_0xe5dcc4[_0x1ea947(0x153)]}),!![];}}exports['NodaService']=NodaService;