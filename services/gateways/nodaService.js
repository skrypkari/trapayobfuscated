'use strict';const a71_0x52c2e7=a71_0x3b16;(function(_0x454958,_0x383300){const _0x52d5e0=a71_0x3b16,_0x30ada7=_0x454958();while(!![]){try{const _0x5df145=-parseInt(_0x52d5e0(0x25c))/0x1*(parseInt(_0x52d5e0(0x257))/0x2)+-parseInt(_0x52d5e0(0x224))/0x3*(-parseInt(_0x52d5e0(0x24e))/0x4)+-parseInt(_0x52d5e0(0x1ee))/0x5*(-parseInt(_0x52d5e0(0x215))/0x6)+-parseInt(_0x52d5e0(0x24c))/0x7*(-parseInt(_0x52d5e0(0x1f5))/0x8)+parseInt(_0x52d5e0(0x20b))/0x9+parseInt(_0x52d5e0(0x252))/0xa+-parseInt(_0x52d5e0(0x256))/0xb;if(_0x5df145===_0x383300)break;else _0x30ada7['push'](_0x30ada7['shift']());}catch(_0x3d02a2){_0x30ada7['push'](_0x30ada7['shift']());}}}(a71_0x3a99,0x8f7b8));function a71_0x3b16(_0x58aa34,_0x42844c){_0x58aa34=_0x58aa34-0x1ed;const _0x3a9984=a71_0x3a99();let _0x3b1660=_0x3a9984[_0x58aa34];return _0x3b1660;}Object[a71_0x52c2e7(0x209)](exports,a71_0x52c2e7(0x203),{'value':!![]}),exports[a71_0x52c2e7(0x230)]=void 0x0;function a71_0x3a99(){const _0x3715a0=['Status\x20Text:','Remitter','Method','URL:','verifyWebhookSignature','json','expiryDate','Payment\x20System/1.0','active','Response\x20Body:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Noda\x20webhook\x20signature\x20verification:','HTTP\x20','noda','===\x20NODA\x20SUCCESS\x20===','../loggerService','Amount','Error\x20stack:','Status\x20Code:','message','Currency','text','SettlementDate','GET','644IlSSlt','https://tesoft.uk/gateway/pending.php?id=','12QJAAMg','/payment-links','BankId','(8digits-8digits\x20format)','3935540jNhwHR','FAILED','apiUrl','Processing\x20Noda\x20webhook:','18300744SBNfhs','24wabdNo','Unknown\x20error','===\x20PARSED\x20NODA\x20RESPONSE\x20===','canceled','Name','6242uRKnbI','isActive','Business\x20Error:\x20','MerchantPaymentId','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Not\x20provided','Status','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status:','PAID','55xtJEXs','Missing\x20id\x20or\x20shortLink\x20in\x20response','log','loggerService','application/json','now','Request\x20Body\x20(Direct\x20JSON):','50008lqOsJD','PaymentId','cancelled','logWhiteDomainResponse','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy',',\x20body:\x20','Response\x20Time:','parse','verifyPayment','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Noda\x20API\x20error:\x20','logWhiteDomainError','statusCode','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','__esModule','status','QR\x20Code\x20Link:','error','toUpperCase','PENDING','defineProperty','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','7925796IaxOmT','Order\x20ID\x20Format:','shortLinkUrls','entries','/payment-links/','timeout','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Settled','JSON\x20Parse\x20Error:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','121530dGYzNf','done','(8digits-8digits\x20format\x20for\x20Noda)','POST','logWhiteDomainRequest','Raw\x20Response\x20Body:','Response\x20data:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Failed\x20to\x20parse\x20JSON\x20response:','createPaymentLink','Parsed\x20Result:','Payment\x20Link\x20ID:','statusText','headers','paid','254217OYcFjb','fromEntries','success','EXPIRED','HTTP\x20error!\x20status:\x20','Iban','https://tesoft.uk/gateway/noda/','Headers:','processing','Unknown\x20error\x20from\x20Noda\x20API','Yes','shortLink','NodaService','Order\x20ID\x20Used:','pending','qrCodeLink'];a71_0x3a99=function(){return _0x3715a0;};return a71_0x3a99();}const loggerService_1=require(a71_0x52c2e7(0x243));class NodaService{constructor(){const _0x253ae2=a71_0x52c2e7;this[_0x253ae2(0x254)]=_0x253ae2(0x22a),console[_0x253ae2(0x1f0)](_0x253ae2(0x1f9));}async[a71_0x52c2e7(0x21e)](_0x389e44){const _0x9efcd7=a71_0x52c2e7,{orderId:_0x1f4a22,name:_0x1ae109,paymentDescription:_0x461a70,amount:_0x299544,currency:_0x31a34d,webhookUrl:_0x48b908,returnUrl:_0x47db31,expiryDate:_0x3f17cb}=_0x389e44,_0x3eb5cd=_0x31a34d[_0x9efcd7(0x207)](),_0x23b9d3='https://tesoft.uk/gateway/noda/webhook/',_0x5a5c16=_0x9efcd7(0x24d)+_0x1f4a22,_0x39f42f={'name':_0x1ae109,'paymentDescription':_0x461a70,'amount':_0x299544,'currency':_0x3eb5cd,'paymentId':_0x1f4a22,'webhookUrl':_0x23b9d3,'returnUrl':_0x5a5c16};_0x3f17cb&&(_0x39f42f[_0x9efcd7(0x23a)]=_0x3f17cb);const _0x5c112b=Date['now']();try{console[_0x9efcd7(0x1f0)](_0x9efcd7(0x20a)),console[_0x9efcd7(0x1f0)](_0x9efcd7(0x237),this['apiUrl']),console[_0x9efcd7(0x1f0)](_0x9efcd7(0x1f4),JSON['stringify'](_0x39f42f,null,0x2)),console['log'](_0x9efcd7(0x20c),_0x1f4a22,_0x9efcd7(0x217)),console[_0x9efcd7(0x1f0)](_0x9efcd7(0x211),_0x5a5c16),loggerService_1[_0x9efcd7(0x1f1)][_0x9efcd7(0x219)](_0x9efcd7(0x241),_0x9efcd7(0x24f),_0x9efcd7(0x218),_0x39f42f);const _0x2ccd9b=await fetch(this[_0x9efcd7(0x254)],{'method':_0x9efcd7(0x218),'headers':{'Content-Type':_0x9efcd7(0x1f2),'Accept':'application/json','User-Agent':_0x9efcd7(0x23b)},'body':JSON['stringify'](_0x39f42f)}),_0x3ff5c9=Date['now']()-_0x5c112b;console[_0x9efcd7(0x1f0)](_0x9efcd7(0x263)),console[_0x9efcd7(0x1f0)](_0x9efcd7(0x264),_0x2ccd9b[_0x9efcd7(0x204)]),console['log'](_0x9efcd7(0x234),_0x2ccd9b[_0x9efcd7(0x221)]),console[_0x9efcd7(0x1f0)](_0x9efcd7(0x22b),Object[_0x9efcd7(0x225)](_0x2ccd9b[_0x9efcd7(0x222)][_0x9efcd7(0x20e)]())),console[_0x9efcd7(0x1f0)](_0x9efcd7(0x1fb),_0x3ff5c9+'ms');const _0x445d46=await _0x2ccd9b[_0x9efcd7(0x249)]();console[_0x9efcd7(0x1f0)](_0x9efcd7(0x21a),_0x445d46);if(!_0x2ccd9b['ok']){console[_0x9efcd7(0x206)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x9efcd7(0x206)]('HTTP\x20Status:',_0x2ccd9b['status']),console['error'](_0x9efcd7(0x23d),_0x445d46),loggerService_1[_0x9efcd7(0x1f1)][_0x9efcd7(0x1f8)](_0x9efcd7(0x241),'/payment-links',_0x2ccd9b['status'],_0x445d46,_0x3ff5c9),loggerService_1[_0x9efcd7(0x1f1)][_0x9efcd7(0x200)](_0x9efcd7(0x241),_0x9efcd7(0x24f),_0x9efcd7(0x240)+_0x2ccd9b[_0x9efcd7(0x204)]+':\x20'+_0x445d46);if(_0x2ccd9b[_0x9efcd7(0x204)]===0x190)throw new Error(_0x9efcd7(0x21c));else{if(_0x2ccd9b[_0x9efcd7(0x204)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x9efcd7(0x228)+_0x2ccd9b[_0x9efcd7(0x204)]+_0x9efcd7(0x1fa)+_0x445d46);}let _0x4d8ec3;try{_0x4d8ec3=JSON[_0x9efcd7(0x1fc)](_0x445d46);}catch(_0x17ca38){console[_0x9efcd7(0x206)](_0x9efcd7(0x21d),_0x17ca38),loggerService_1[_0x9efcd7(0x1f1)][_0x9efcd7(0x200)](_0x9efcd7(0x241),'/payment-links',_0x9efcd7(0x213)+_0x17ca38);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x445d46);}console[_0x9efcd7(0x1f0)](_0x9efcd7(0x259)),console[_0x9efcd7(0x1f0)](_0x9efcd7(0x21f),JSON['stringify'](_0x4d8ec3,null,0x2)),loggerService_1['loggerService'][_0x9efcd7(0x1f8)](_0x9efcd7(0x241),_0x9efcd7(0x24f),_0x2ccd9b[_0x9efcd7(0x204)],_0x4d8ec3,_0x3ff5c9);if(_0x4d8ec3[_0x9efcd7(0x206)]||_0x4d8ec3[_0x9efcd7(0x201)]){const _0x1ff61b=_0x4d8ec3[_0x9efcd7(0x247)]||_0x4d8ec3[_0x9efcd7(0x206)]||_0x9efcd7(0x22d);console['error'](_0x9efcd7(0x260)),console[_0x9efcd7(0x206)]('Error\x20Message:',_0x1ff61b),console[_0x9efcd7(0x206)](_0x9efcd7(0x246),_0x4d8ec3[_0x9efcd7(0x201)]),loggerService_1[_0x9efcd7(0x1f1)][_0x9efcd7(0x200)](_0x9efcd7(0x241),_0x9efcd7(0x24f),_0x9efcd7(0x25e)+_0x1ff61b);throw new Error(_0x9efcd7(0x1ff)+_0x1ff61b);}if(!_0x4d8ec3['id']||!_0x4d8ec3[_0x9efcd7(0x20d)]?.[_0x9efcd7(0x22f)]){console[_0x9efcd7(0x206)](_0x9efcd7(0x23e)),console[_0x9efcd7(0x206)](_0x9efcd7(0x1ef)),console[_0x9efcd7(0x206)](_0x9efcd7(0x21b),_0x4d8ec3),loggerService_1[_0x9efcd7(0x1f1)][_0x9efcd7(0x200)]('noda',_0x9efcd7(0x24f),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x9efcd7(0x202));}return console[_0x9efcd7(0x1f0)](_0x9efcd7(0x242)),console[_0x9efcd7(0x1f0)](_0x9efcd7(0x220),_0x4d8ec3['id']),console[_0x9efcd7(0x1f0)]('Short\x20Link:',_0x4d8ec3[_0x9efcd7(0x20d)][_0x9efcd7(0x22f)]),console[_0x9efcd7(0x1f0)](_0x9efcd7(0x205),_0x4d8ec3[_0x9efcd7(0x20d)][_0x9efcd7(0x233)]||_0x9efcd7(0x261)),console[_0x9efcd7(0x1f0)](_0x9efcd7(0x231),_0x1f4a22,_0x9efcd7(0x251)),console[_0x9efcd7(0x1f0)](_0x9efcd7(0x1fe),_0x5a5c16),{'gateway_payment_id':_0x4d8ec3['id'],'payment_url':_0x4d8ec3[_0x9efcd7(0x20d)][_0x9efcd7(0x22f)],'qr_code_url':_0x4d8ec3['shortLinkUrls'][_0x9efcd7(0x233)],'expiry_date':_0x4d8ec3[_0x9efcd7(0x23a)]};}catch(_0x1676a4){console[_0x9efcd7(0x206)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x9efcd7(0x206)]('Error\x20details:',_0x1676a4),loggerService_1[_0x9efcd7(0x1f1)][_0x9efcd7(0x200)]('noda',_0x9efcd7(0x24f),_0x1676a4);if(_0x1676a4 instanceof Error){console['error']('Error\x20message:',_0x1676a4[_0x9efcd7(0x247)]),console[_0x9efcd7(0x206)](_0x9efcd7(0x245),_0x1676a4['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x1676a4['message']);}throw new Error(_0x9efcd7(0x214));}}async[a71_0x52c2e7(0x1fd)](_0x341252){const _0x36da0f=a71_0x52c2e7,_0x70577e=Date[_0x36da0f(0x1f3)]();try{loggerService_1[_0x36da0f(0x1f1)][_0x36da0f(0x219)]('noda','/payment-links/'+_0x341252,'GET',{});const _0xb1c149=await fetch(this['apiUrl']+'/'+_0x341252,{'method':_0x36da0f(0x24b),'headers':{'Content-Type':_0x36da0f(0x1f2),'User-Agent':'Payment\x20System/1.0'}}),_0xc3fe63=Date['now']()-_0x70577e;if(!_0xb1c149['ok']){const _0x1b4f8a=await _0xb1c149[_0x36da0f(0x249)]();loggerService_1['loggerService'][_0x36da0f(0x1f8)]('noda',_0x36da0f(0x20f)+_0x341252,_0xb1c149[_0x36da0f(0x204)],_0x1b4f8a,_0xc3fe63);throw new Error(_0x36da0f(0x228)+_0xb1c149[_0x36da0f(0x204)]);}const _0x2b3d27=await _0xb1c149[_0x36da0f(0x239)]();loggerService_1[_0x36da0f(0x1f1)][_0x36da0f(0x1f8)](_0x36da0f(0x241),'/payment-links/'+_0x341252,_0xb1c149['status'],_0x2b3d27,_0xc3fe63);if(_0x2b3d27[_0x36da0f(0x206)]||_0x2b3d27[_0x36da0f(0x201)]){loggerService_1[_0x36da0f(0x1f1)][_0x36da0f(0x200)]('noda',_0x36da0f(0x20f)+_0x341252,_0x36da0f(0x1ff)+(_0x2b3d27[_0x36da0f(0x247)]||_0x2b3d27[_0x36da0f(0x206)]||_0x36da0f(0x258)));throw new Error(_0x36da0f(0x1ff)+(_0x2b3d27['message']||_0x2b3d27[_0x36da0f(0x206)]||_0x36da0f(0x258)));}let _0x3157ca=_0x36da0f(0x208);if(_0x2b3d27['isActive']===![]){if(_0x2b3d27[_0x36da0f(0x23a)]){const _0x55b44a=new Date(_0x2b3d27[_0x36da0f(0x23a)]),_0x4a5274=new Date();_0x55b44a<_0x4a5274?_0x3157ca=_0x36da0f(0x227):_0x3157ca=_0x36da0f(0x253);}else _0x3157ca=_0x36da0f(0x253);}else _0x3157ca=_0x36da0f(0x208);return{'status':_0x3157ca,'amount':_0x2b3d27['amount'],'currency':_0x2b3d27['currency'],'isActive':_0x2b3d27[_0x36da0f(0x25d)]};}catch(_0x5e2a0c){console[_0x36da0f(0x206)]('Noda\x20payment\x20verification\x20error:',_0x5e2a0c),loggerService_1[_0x36da0f(0x1f1)][_0x36da0f(0x200)](_0x36da0f(0x241),_0x36da0f(0x20f)+_0x341252,_0x5e2a0c);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x5e2a0c instanceof Error?_0x5e2a0c['message']:'Unknown\x20error'));}}async['processWebhook'](_0x207529){const _0x255799=a71_0x52c2e7;console['log'](_0x255799(0x255),_0x207529);let _0x326e39=_0x255799(0x208);switch(_0x207529[_0x255799(0x262)]?.['toLowerCase']()){case _0x255799(0x216):case'completed':case _0x255799(0x223):case _0x255799(0x226):case'successful':_0x207529[_0x255799(0x212)]===_0x255799(0x22e)?_0x326e39=_0x255799(0x1ed):_0x326e39=_0x255799(0x208);break;case _0x255799(0x1f7):case _0x255799(0x25a):case'failed':case'error':case'rejected':_0x326e39=_0x255799(0x253);break;case'expired':case _0x255799(0x210):_0x326e39=_0x255799(0x227);break;case _0x255799(0x232):case'created':case _0x255799(0x23c):case _0x255799(0x22c):case'in_progress':default:_0x326e39=_0x255799(0x208);break;}return{'paymentId':_0x207529[_0x255799(0x25f)]||_0x207529[_0x255799(0x1f6)],'status':_0x326e39,'amount':_0x207529[_0x255799(0x244)],'currency':_0x207529[_0x255799(0x248)],'additionalInfo':{'method':_0x207529[_0x255799(0x236)],'bankId':_0x207529[_0x255799(0x250)],'settled':_0x207529[_0x255799(0x212)],'settlementDate':_0x207529[_0x255799(0x24a)],'remitterName':_0x207529[_0x255799(0x235)]?.[_0x255799(0x25b)],'remitterIban':_0x207529[_0x255799(0x235)]?.[_0x255799(0x229)],'bankTransactionId':_0x207529['BankTransactionId']}};}[a71_0x52c2e7(0x238)](_0x3f8a35,_0xe2f7e5){const _0x51f3cb=a71_0x52c2e7;return console[_0x51f3cb(0x1f0)](_0x51f3cb(0x23f),{'receivedSignature':_0xe2f7e5,'paymentId':_0x3f8a35[_0x51f3cb(0x1f6)],'merchantPaymentId':_0x3f8a35[_0x51f3cb(0x25f)]}),!![];}}exports[a71_0x52c2e7(0x230)]=NodaService;