'use strict';function a50_0x4ae6(_0x2ae2dc,_0x5c1031){const _0xbe46b6=a50_0xbe46();return a50_0x4ae6=function(_0x4ae6dd,_0x1cc1da){_0x4ae6dd=_0x4ae6dd-0xb0;let _0x10e98d=_0xbe46b6[_0x4ae6dd];return _0x10e98d;},a50_0x4ae6(_0x2ae2dc,_0x5c1031);}const a50_0x1aa908=a50_0x4ae6;(function(_0x1610fe,_0x2ad0e2){const _0x1e8b34=a50_0x4ae6,_0x445316=_0x1610fe();while(!![]){try{const _0x25f863=-parseInt(_0x1e8b34(0xec))/0x1+parseInt(_0x1e8b34(0x11a))/0x2*(-parseInt(_0x1e8b34(0xe5))/0x3)+parseInt(_0x1e8b34(0xda))/0x4+-parseInt(_0x1e8b34(0x10c))/0x5*(parseInt(_0x1e8b34(0x122))/0x6)+parseInt(_0x1e8b34(0x126))/0x7*(-parseInt(_0x1e8b34(0xd3))/0x8)+parseInt(_0x1e8b34(0x106))/0x9+parseInt(_0x1e8b34(0xcc))/0xa;if(_0x25f863===_0x2ad0e2)break;else _0x445316['push'](_0x445316['shift']());}catch(_0x53552d){_0x445316['push'](_0x445316['shift']());}}}(a50_0xbe46,0xdcf11));Object[a50_0x1aa908(0xb3)](exports,a50_0x1aa908(0x10f),{'value':!![]}),exports[a50_0x1aa908(0x101)]=void 0x0;const loggerService_1=require(a50_0x1aa908(0xf1));class NodaService{constructor(){const _0x3cb63e=a50_0x1aa908;this['apiUrl']=_0x3cb63e(0x125),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a50_0x1aa908(0xb8)](_0x11fe42){const _0x461b70=a50_0x1aa908,{orderId:_0x30a86f,name:_0x49ceef,paymentDescription:_0x3a73e8,amount:_0x1299a1,currency:_0x1a93d9,webhookUrl:_0x19d973,returnUrl:_0x9b1faa,expiryDate:_0x490769}=_0x11fe42,_0x201ad4=_0x1a93d9[_0x461b70(0xe0)](),_0x5c0b4c='https://tesoft.uk/gateway/noda/webhook/',_0x41b2e1=_0x461b70(0xbb)+_0x30a86f,_0x495ea3={'name':_0x49ceef,'paymentDescription':_0x3a73e8,'amount':_0x1299a1,'currency':_0x201ad4,'paymentId':_0x30a86f,'webhookUrl':_0x5c0b4c,'returnUrl':_0x41b2e1};_0x490769&&(_0x495ea3['expiryDate']=_0x490769);const _0x36de84=Date[_0x461b70(0xf5)]();try{console[_0x461b70(0xf7)](_0x461b70(0xc6)),console[_0x461b70(0xf7)](_0x461b70(0xbc),this[_0x461b70(0xdc)]),console[_0x461b70(0xf7)](_0x461b70(0xbf),JSON[_0x461b70(0x11d)](_0x495ea3,null,0x2)),console[_0x461b70(0xf7)](_0x461b70(0x111),_0x30a86f,_0x461b70(0x104)),console['log'](_0x461b70(0x103),_0x41b2e1),loggerService_1[_0x461b70(0xff)][_0x461b70(0xe2)](_0x461b70(0x11b),_0x461b70(0xc2),_0x461b70(0xc8),_0x495ea3);const _0x528e88=await fetch(this[_0x461b70(0xdc)],{'method':_0x461b70(0xc8),'headers':{'Content-Type':'application/json','Accept':_0x461b70(0x118),'User-Agent':_0x461b70(0xb4)},'body':JSON[_0x461b70(0x11d)](_0x495ea3)}),_0x2d684e=Date[_0x461b70(0xf5)]()-_0x36de84;console[_0x461b70(0xf7)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x461b70(0xf7)](_0x461b70(0xf3),_0x528e88[_0x461b70(0x116)]),console[_0x461b70(0xf7)](_0x461b70(0x107),_0x528e88[_0x461b70(0xf9)]),console['log'](_0x461b70(0xdf),Object[_0x461b70(0xdd)](_0x528e88[_0x461b70(0xe8)][_0x461b70(0xe4)]())),console[_0x461b70(0xf7)](_0x461b70(0xca),_0x2d684e+'ms');const _0x3ddc8b=await _0x528e88[_0x461b70(0xf2)]();console[_0x461b70(0xf7)](_0x461b70(0xde),_0x3ddc8b);if(!_0x528e88['ok']){console[_0x461b70(0xd1)]('===\x20NODA\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x528e88[_0x461b70(0x116)]),console['error']('Response\x20Body:',_0x3ddc8b),loggerService_1[_0x461b70(0xff)]['logWhiteDomainResponse'](_0x461b70(0x11b),'/payment-links',_0x528e88[_0x461b70(0x116)],_0x3ddc8b,_0x2d684e),loggerService_1['loggerService'][_0x461b70(0xfd)](_0x461b70(0x11b),'/payment-links',_0x461b70(0xc3)+_0x528e88[_0x461b70(0x116)]+':\x20'+_0x3ddc8b);if(_0x528e88[_0x461b70(0x116)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x528e88[_0x461b70(0x116)]===0x1f4)throw new Error(_0x461b70(0x11c));}throw new Error(_0x461b70(0xe7)+_0x528e88['status']+_0x461b70(0xd0)+_0x3ddc8b);}let _0x5a931b;try{_0x5a931b=JSON['parse'](_0x3ddc8b);}catch(_0x5604e6){console[_0x461b70(0xd1)](_0x461b70(0xd5),_0x5604e6),loggerService_1['loggerService'][_0x461b70(0xfd)](_0x461b70(0x11b),_0x461b70(0xc2),_0x461b70(0xcf)+_0x5604e6);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x3ddc8b);}console['log'](_0x461b70(0x121)),console[_0x461b70(0xf7)]('Parsed\x20Result:',JSON['stringify'](_0x5a931b,null,0x2)),loggerService_1['loggerService'][_0x461b70(0xb0)](_0x461b70(0x11b),_0x461b70(0xc2),_0x528e88['status'],_0x5a931b,_0x2d684e);if(_0x5a931b[_0x461b70(0xd1)]||_0x5a931b[_0x461b70(0xfe)]){const _0x134ac6=_0x5a931b['message']||_0x5a931b[_0x461b70(0xd1)]||_0x461b70(0xb9);console[_0x461b70(0xd1)](_0x461b70(0xce)),console[_0x461b70(0xd1)](_0x461b70(0x108),_0x134ac6),console[_0x461b70(0xd1)](_0x461b70(0xc7),_0x5a931b['statusCode']),loggerService_1[_0x461b70(0xff)][_0x461b70(0xfd)](_0x461b70(0x11b),_0x461b70(0xc2),'Business\x20Error:\x20'+_0x134ac6);throw new Error(_0x461b70(0x10b)+_0x134ac6);}if(!_0x5a931b['id']||!_0x5a931b[_0x461b70(0xed)]?.[_0x461b70(0xcd)]){console[_0x461b70(0xd1)](_0x461b70(0xf0)),console['error'](_0x461b70(0xfb)),console[_0x461b70(0xd1)](_0x461b70(0xe6),_0x5a931b),loggerService_1[_0x461b70(0xff)][_0x461b70(0xfd)](_0x461b70(0x11b),_0x461b70(0xc2),_0x461b70(0xdb));throw new Error(_0x461b70(0xe9));}return console[_0x461b70(0xf7)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x461b70(0xf7)]('Payment\x20Link\x20ID:',_0x5a931b['id']),console[_0x461b70(0xf7)]('Short\x20Link:',_0x5a931b[_0x461b70(0xed)]['shortLink']),console[_0x461b70(0xf7)]('QR\x20Code\x20Link:',_0x5a931b['shortLinkUrls'][_0x461b70(0x123)]||'Not\x20provided'),console['log'](_0x461b70(0xbd),_0x30a86f,_0x461b70(0xfa)),console['log'](_0x461b70(0x112),_0x41b2e1),{'gateway_payment_id':_0x5a931b['id'],'payment_url':_0x5a931b['shortLinkUrls'][_0x461b70(0xcd)],'qr_code_url':_0x5a931b[_0x461b70(0xed)]['qrCodeLink'],'expiry_date':_0x5a931b[_0x461b70(0xba)]};}catch(_0x5c01c4){console[_0x461b70(0xd1)](_0x461b70(0xb1)),console[_0x461b70(0xd1)](_0x461b70(0xd7),_0x5c01c4),loggerService_1[_0x461b70(0xff)][_0x461b70(0xfd)](_0x461b70(0x11b),_0x461b70(0xc2),_0x5c01c4);if(_0x5c01c4 instanceof Error){console['error'](_0x461b70(0x115),_0x5c01c4['message']),console[_0x461b70(0xd1)](_0x461b70(0xf4),_0x5c01c4[_0x461b70(0x114)]);throw new Error(_0x461b70(0x120)+_0x5c01c4['message']);}throw new Error(_0x461b70(0xd4));}}async[a50_0x1aa908(0xc0)](_0x255a69){const _0x3ed1b0=a50_0x1aa908,_0x5290b8=Date[_0x3ed1b0(0xf5)]();try{loggerService_1[_0x3ed1b0(0xff)][_0x3ed1b0(0xe2)](_0x3ed1b0(0x11b),_0x3ed1b0(0xc9)+_0x255a69,_0x3ed1b0(0x109),{});const _0x1311b9=await fetch(this[_0x3ed1b0(0xdc)]+'/'+_0x255a69,{'method':_0x3ed1b0(0x109),'headers':{'Content-Type':'application/json','User-Agent':_0x3ed1b0(0xb4)}}),_0x1a4b8c=Date[_0x3ed1b0(0xf5)]()-_0x5290b8;if(!_0x1311b9['ok']){const _0x2dada1=await _0x1311b9[_0x3ed1b0(0xf2)]();loggerService_1[_0x3ed1b0(0xff)][_0x3ed1b0(0xb0)](_0x3ed1b0(0x11b),_0x3ed1b0(0xc9)+_0x255a69,_0x1311b9['status'],_0x2dada1,_0x1a4b8c);throw new Error(_0x3ed1b0(0xe7)+_0x1311b9[_0x3ed1b0(0x116)]);}const _0x3ab439=await _0x1311b9[_0x3ed1b0(0x11f)]();loggerService_1['loggerService'][_0x3ed1b0(0xb0)](_0x3ed1b0(0x11b),'/payment-links/'+_0x255a69,_0x1311b9['status'],_0x3ab439,_0x1a4b8c);if(_0x3ab439[_0x3ed1b0(0xd1)]||_0x3ab439[_0x3ed1b0(0xfe)]){loggerService_1[_0x3ed1b0(0xff)][_0x3ed1b0(0xfd)](_0x3ed1b0(0x11b),_0x3ed1b0(0xc9)+_0x255a69,_0x3ed1b0(0x10b)+(_0x3ab439[_0x3ed1b0(0xeb)]||_0x3ab439['error']||_0x3ed1b0(0xb2)));throw new Error(_0x3ed1b0(0x10b)+(_0x3ab439[_0x3ed1b0(0xeb)]||_0x3ab439[_0x3ed1b0(0xd1)]||_0x3ed1b0(0xb2)));}let _0x1d5322=_0x3ed1b0(0x110);if(_0x3ab439[_0x3ed1b0(0x124)]===![]){if(_0x3ab439['expiryDate']){const _0x68df87=new Date(_0x3ab439['expiryDate']),_0x13833d=new Date();_0x68df87<_0x13833d?_0x1d5322=_0x3ed1b0(0xf6):_0x1d5322='FAILED';}else _0x1d5322=_0x3ed1b0(0xe1);}else _0x1d5322=_0x3ed1b0(0x110);return{'status':_0x1d5322,'amount':_0x3ab439[_0x3ed1b0(0xef)],'currency':_0x3ab439['currency'],'isActive':_0x3ab439[_0x3ed1b0(0x124)]};}catch(_0x2aa193){console['error'](_0x3ed1b0(0xe3),_0x2aa193),loggerService_1[_0x3ed1b0(0xff)][_0x3ed1b0(0xfd)](_0x3ed1b0(0x11b),'/payment-links/'+_0x255a69,_0x2aa193);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x2aa193 instanceof Error?_0x2aa193['message']:_0x3ed1b0(0xb2)));}}async[a50_0x1aa908(0xc5)](_0x5ccf12){const _0x1ec9e3=a50_0x1aa908;console[_0x1ec9e3(0xf7)](_0x1ec9e3(0xea),_0x5ccf12);let _0x385638=_0x1ec9e3(0x110);switch(_0x5ccf12['Status']?.['toLowerCase']()){case _0x1ec9e3(0x11e):case'completed':case _0x1ec9e3(0xbe):case'success':case _0x1ec9e3(0xb5):_0x5ccf12[_0x1ec9e3(0x117)]===_0x1ec9e3(0x10e)?_0x385638=_0x1ec9e3(0x10d):_0x385638=_0x1ec9e3(0x110);break;case _0x1ec9e3(0xd8):case _0x1ec9e3(0x100):case'failed':case _0x1ec9e3(0xd1):case _0x1ec9e3(0xc4):_0x385638='FAILED';break;case'expired':case _0x1ec9e3(0x127):_0x385638=_0x1ec9e3(0xf6);break;case _0x1ec9e3(0xd2):case _0x1ec9e3(0x105):case _0x1ec9e3(0xee):case _0x1ec9e3(0xd9):case _0x1ec9e3(0x10a):default:_0x385638=_0x1ec9e3(0x110);break;}return{'paymentId':_0x5ccf12[_0x1ec9e3(0xfc)]||_0x5ccf12[_0x1ec9e3(0xc1)],'status':_0x385638,'amount':_0x5ccf12[_0x1ec9e3(0x113)],'currency':_0x5ccf12[_0x1ec9e3(0xb6)],'additionalInfo':{'method':_0x5ccf12[_0x1ec9e3(0x102)],'bankId':_0x5ccf12[_0x1ec9e3(0xf8)],'settled':_0x5ccf12[_0x1ec9e3(0x117)],'settlementDate':_0x5ccf12['SettlementDate'],'remitterName':_0x5ccf12['Remitter']?.['Name'],'remitterIban':_0x5ccf12[_0x1ec9e3(0x119)]?.[_0x1ec9e3(0xb7)],'bankTransactionId':_0x5ccf12[_0x1ec9e3(0xd6)]}};}['verifyWebhookSignature'](_0x49841e,_0xbc89f8){const _0x50876b=a50_0x1aa908;return console['log'](_0x50876b(0xcb),{'receivedSignature':_0xbc89f8,'paymentId':_0x49841e[_0x50876b(0xc1)],'merchantPaymentId':_0x49841e[_0x50876b(0xfc)]}),!![];}}exports['NodaService']=NodaService;function a50_0xbe46(){const _0x4ea12e=['verifyPayment','PaymentId','/payment-links','HTTP\x20','rejected','processWebhook','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Status\x20Code:','POST','/payment-links/','Response\x20Time:','Noda\x20webhook\x20signature\x20verification:','37352580raUJWX','shortLink','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','JSON\x20Parse\x20Error:\x20',',\x20body:\x20','error','pending','704AAbGsN','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Failed\x20to\x20parse\x20JSON\x20response:','BankTransactionId','Error\x20details:','cancelled','processing','4752280IxWzOV','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','apiUrl','fromEntries','Raw\x20Response\x20Body:','Headers:','toUpperCase','FAILED','logWhiteDomainRequest','Noda\x20payment\x20verification\x20error:','entries','846177iLOpSa','Response\x20data:','HTTP\x20error!\x20status:\x20','headers','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Processing\x20Noda\x20webhook:','message','1203451MSGlLA','shortLinkUrls','active','amount','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','../loggerService','text','Status:','Error\x20stack:','now','EXPIRED','log','BankId','statusText','(8digits-8digits\x20format)','Missing\x20id\x20or\x20shortLink\x20in\x20response','MerchantPaymentId','logWhiteDomainError','statusCode','loggerService','canceled','NodaService','Method','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','(8digits-8digits\x20format\x20for\x20Noda)','created','6407379IpGIYf','Status\x20Text:','Error\x20Message:','GET','in_progress','Noda\x20API\x20error:\x20','15kSBGyG','PAID','Yes','__esModule','PENDING','Order\x20ID\x20Format:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Amount','stack','Error\x20message:','status','Settled','application/json','Remitter','8ijXUCv','noda','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','stringify','done','json','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','===\x20PARSED\x20NODA\x20RESPONSE\x20===','1656822HVZXXH','qrCodeLink','isActive','https://tesoft.uk/gateway/noda/','124901ghfaxG','timeout','logWhiteDomainResponse','===\x20NODA\x20SERVICE\x20ERROR\x20===','Unknown\x20error','defineProperty','TesSoft\x20Payment\x20System/1.0','successful','Currency','Iban','createPaymentLink','Unknown\x20error\x20from\x20Noda\x20API','expiryDate','https://tesoft.uk/gateway/pending.php?id=','URL:','Order\x20ID\x20Used:','paid','Request\x20Body\x20(Direct\x20JSON):'];a50_0xbe46=function(){return _0x4ea12e;};return a50_0xbe46();}