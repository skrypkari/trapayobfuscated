'use strict';function a60_0x2b5e(_0x4a66a1,_0xa0b95c){_0x4a66a1=_0x4a66a1-0x157;const _0x259b0d=a60_0x259b();let _0x2b5e73=_0x259b0d[_0x4a66a1];return _0x2b5e73;}const a60_0xd8dd4d=a60_0x2b5e;(function(_0x368192,_0x4be05b){const _0xe068d=a60_0x2b5e,_0x4414dd=_0x368192();while(!![]){try{const _0xb97f36=parseInt(_0xe068d(0x180))/0x1*(-parseInt(_0xe068d(0x175))/0x2)+parseInt(_0xe068d(0x15e))/0x3+-parseInt(_0xe068d(0x161))/0x4*(-parseInt(_0xe068d(0x166))/0x5)+parseInt(_0xe068d(0x185))/0x6+-parseInt(_0xe068d(0x1cc))/0x7*(-parseInt(_0xe068d(0x199))/0x8)+-parseInt(_0xe068d(0x1c9))/0x9*(-parseInt(_0xe068d(0x191))/0xa)+-parseInt(_0xe068d(0x1bd))/0xb;if(_0xb97f36===_0x4be05b)break;else _0x4414dd['push'](_0x4414dd['shift']());}catch(_0x3d7513){_0x4414dd['push'](_0x4414dd['shift']());}}}(a60_0x259b,0xeb5f7));Object[a60_0xd8dd4d(0x1a2)](exports,'__esModule',{'value':!![]}),exports[a60_0xd8dd4d(0x18f)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x4d7cb4=a60_0xd8dd4d;this[_0x4d7cb4(0x1cd)]=_0x4d7cb4(0x19b),console[_0x4d7cb4(0x172)](_0x4d7cb4(0x1b6));}async[a60_0xd8dd4d(0x168)](_0x28d49b){const _0xb9a81d=a60_0xd8dd4d,{orderId:_0x4d8eeb,name:_0x3408d3,paymentDescription:_0x2aac73,amount:_0x2e9837,currency:_0x3b2fda,webhookUrl:_0x8f7222,returnUrl:_0x61e548,expiryDate:_0x28c0ca}=_0x28d49b,_0x20fabc=_0x3b2fda[_0xb9a81d(0x1c3)](),_0x57f2cf='https://tesoft.uk/gateway/noda/webhook/',_0x872296=_0xb9a81d(0x192)+_0x4d8eeb,_0x330532={'name':_0x3408d3,'paymentDescription':_0x2aac73,'amount':_0x2e9837,'currency':_0x20fabc,'paymentId':_0x4d8eeb,'webhookUrl':_0x57f2cf,'returnUrl':_0x872296};_0x28c0ca&&(_0x330532['expiryDate']=_0x28c0ca);const _0x2cf39e=Date['now']();try{console[_0xb9a81d(0x172)](_0xb9a81d(0x15c)),console['log']('URL:',this[_0xb9a81d(0x1cd)]),console['log'](_0xb9a81d(0x1b9),JSON['stringify'](_0x330532,null,0x2)),console[_0xb9a81d(0x172)]('Order\x20ID\x20Format:',_0x4d8eeb,'(8digits-8digits\x20format\x20for\x20Noda)'),console['log'](_0xb9a81d(0x1a7),_0x872296),loggerService_1[_0xb9a81d(0x163)]['logWhiteDomainRequest'](_0xb9a81d(0x173),_0xb9a81d(0x1ab),_0xb9a81d(0x18e),_0x330532);const _0x413869=await fetch(this['apiUrl'],{'method':_0xb9a81d(0x18e),'headers':{'Content-Type':'application/json','Accept':_0xb9a81d(0x187),'User-Agent':'Payment\x20System/1.0'},'body':JSON['stringify'](_0x330532)}),_0x4bee4=Date[_0xb9a81d(0x170)]()-_0x2cf39e;console[_0xb9a81d(0x172)](_0xb9a81d(0x1af)),console[_0xb9a81d(0x172)](_0xb9a81d(0x1a9),_0x413869['status']),console['log'](_0xb9a81d(0x15d),_0x413869[_0xb9a81d(0x1c5)]),console[_0xb9a81d(0x172)](_0xb9a81d(0x1b7),Object[_0xb9a81d(0x174)](_0x413869[_0xb9a81d(0x1c0)]['entries']())),console[_0xb9a81d(0x172)](_0xb9a81d(0x159),_0x4bee4+'ms');const _0x2a2f0f=await _0x413869['text']();console[_0xb9a81d(0x172)](_0xb9a81d(0x164),_0x2a2f0f);if(!_0x413869['ok']){console[_0xb9a81d(0x1cf)](_0xb9a81d(0x1a8)),console[_0xb9a81d(0x1cf)](_0xb9a81d(0x1b8),_0x413869[_0xb9a81d(0x16d)]),console[_0xb9a81d(0x1cf)](_0xb9a81d(0x17e),_0x2a2f0f),loggerService_1['loggerService'][_0xb9a81d(0x16f)](_0xb9a81d(0x173),'/payment-links',_0x413869['status'],_0x2a2f0f,_0x4bee4),loggerService_1[_0xb9a81d(0x163)][_0xb9a81d(0x16c)](_0xb9a81d(0x173),_0xb9a81d(0x1ab),_0xb9a81d(0x188)+_0x413869[_0xb9a81d(0x16d)]+':\x20'+_0x2a2f0f);if(_0x413869[_0xb9a81d(0x16d)]===0x190)throw new Error(_0xb9a81d(0x15b));else{if(_0x413869['status']===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error('HTTP\x20error!\x20status:\x20'+_0x413869[_0xb9a81d(0x16d)]+',\x20body:\x20'+_0x2a2f0f);}let _0x63b6ea;try{_0x63b6ea=JSON[_0xb9a81d(0x194)](_0x2a2f0f);}catch(_0x505109){console[_0xb9a81d(0x1cf)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x505109),loggerService_1[_0xb9a81d(0x163)][_0xb9a81d(0x16c)](_0xb9a81d(0x173),'/payment-links',_0xb9a81d(0x19d)+_0x505109);throw new Error(_0xb9a81d(0x196)+_0x2a2f0f);}console[_0xb9a81d(0x172)](_0xb9a81d(0x18b)),console[_0xb9a81d(0x172)](_0xb9a81d(0x17d),JSON[_0xb9a81d(0x178)](_0x63b6ea,null,0x2)),loggerService_1[_0xb9a81d(0x163)][_0xb9a81d(0x16f)](_0xb9a81d(0x173),_0xb9a81d(0x1ab),_0x413869[_0xb9a81d(0x16d)],_0x63b6ea,_0x4bee4);if(_0x63b6ea['error']||_0x63b6ea[_0xb9a81d(0x183)]){const _0xf12ae5=_0x63b6ea[_0xb9a81d(0x15a)]||_0x63b6ea[_0xb9a81d(0x1cf)]||_0xb9a81d(0x18d);console[_0xb9a81d(0x1cf)](_0xb9a81d(0x16b)),console[_0xb9a81d(0x1cf)](_0xb9a81d(0x1bc),_0xf12ae5),console[_0xb9a81d(0x1cf)](_0xb9a81d(0x19a),_0x63b6ea['statusCode']),loggerService_1[_0xb9a81d(0x163)][_0xb9a81d(0x16c)](_0xb9a81d(0x173),_0xb9a81d(0x1ab),_0xb9a81d(0x1ae)+_0xf12ae5);throw new Error(_0xb9a81d(0x1c6)+_0xf12ae5);}if(!_0x63b6ea['id']||!_0x63b6ea[_0xb9a81d(0x1b4)]?.[_0xb9a81d(0x158)]){console[_0xb9a81d(0x1cf)](_0xb9a81d(0x177)),console['error']('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console['error'](_0xb9a81d(0x160),_0x63b6ea),loggerService_1['loggerService'][_0xb9a81d(0x16c)](_0xb9a81d(0x173),'/payment-links',_0xb9a81d(0x1d0));throw new Error(_0xb9a81d(0x1a5));}return console[_0xb9a81d(0x172)](_0xb9a81d(0x182)),console[_0xb9a81d(0x172)](_0xb9a81d(0x1b2),_0x63b6ea['id']),console[_0xb9a81d(0x172)](_0xb9a81d(0x186),_0x63b6ea[_0xb9a81d(0x1b4)]['shortLink']),console['log']('QR\x20Code\x20Link:',_0x63b6ea[_0xb9a81d(0x1b4)][_0xb9a81d(0x19c)]||_0xb9a81d(0x195)),console[_0xb9a81d(0x172)](_0xb9a81d(0x198),_0x4d8eeb,_0xb9a81d(0x165)),console[_0xb9a81d(0x172)](_0xb9a81d(0x179),_0x872296),{'gateway_payment_id':_0x63b6ea['id'],'payment_url':_0x63b6ea[_0xb9a81d(0x1b4)][_0xb9a81d(0x158)],'qr_code_url':_0x63b6ea[_0xb9a81d(0x1b4)][_0xb9a81d(0x19c)],'expiry_date':_0x63b6ea[_0xb9a81d(0x1c8)]};}catch(_0x3ca5e4){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0xb9a81d(0x1cf)](_0xb9a81d(0x1c2),_0x3ca5e4),loggerService_1[_0xb9a81d(0x163)]['logWhiteDomainError'](_0xb9a81d(0x173),_0xb9a81d(0x1ab),_0x3ca5e4);if(_0x3ca5e4 instanceof Error){console[_0xb9a81d(0x1cf)](_0xb9a81d(0x17b),_0x3ca5e4['message']),console[_0xb9a81d(0x1cf)](_0xb9a81d(0x169),_0x3ca5e4['stack']);throw new Error(_0xb9a81d(0x1c4)+_0x3ca5e4[_0xb9a81d(0x15a)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x80309b){const _0x4245b2=a60_0xd8dd4d,_0x200501=Date['now']();try{loggerService_1[_0x4245b2(0x163)][_0x4245b2(0x1ba)](_0x4245b2(0x173),'/payment-links/'+_0x80309b,_0x4245b2(0x193),{});const _0xa9923d=await fetch(this['apiUrl']+'/'+_0x80309b,{'method':_0x4245b2(0x193),'headers':{'Content-Type':_0x4245b2(0x187),'User-Agent':_0x4245b2(0x167)}}),_0x32e8de=Date['now']()-_0x200501;if(!_0xa9923d['ok']){const _0x4f272b=await _0xa9923d[_0x4245b2(0x184)]();loggerService_1[_0x4245b2(0x163)][_0x4245b2(0x16f)](_0x4245b2(0x173),'/payment-links/'+_0x80309b,_0xa9923d[_0x4245b2(0x16d)],_0x4f272b,_0x32e8de);throw new Error(_0x4245b2(0x1b5)+_0xa9923d[_0x4245b2(0x16d)]);}const _0x24d11d=await _0xa9923d['json']();loggerService_1['loggerService'][_0x4245b2(0x16f)]('noda',_0x4245b2(0x17f)+_0x80309b,_0xa9923d[_0x4245b2(0x16d)],_0x24d11d,_0x32e8de);if(_0x24d11d['error']||_0x24d11d['statusCode']){loggerService_1['loggerService'][_0x4245b2(0x16c)](_0x4245b2(0x173),_0x4245b2(0x17f)+_0x80309b,_0x4245b2(0x1c6)+(_0x24d11d[_0x4245b2(0x15a)]||_0x24d11d[_0x4245b2(0x1cf)]||_0x4245b2(0x1ca)));throw new Error(_0x4245b2(0x1c6)+(_0x24d11d[_0x4245b2(0x15a)]||_0x24d11d[_0x4245b2(0x1cf)]||'Unknown\x20error'));}let _0x44b59f=_0x4245b2(0x1b0);if(_0x24d11d['isActive']===![]){if(_0x24d11d[_0x4245b2(0x1c8)]){const _0x1723f9=new Date(_0x24d11d[_0x4245b2(0x1c8)]),_0x51f0db=new Date();_0x1723f9<_0x51f0db?_0x44b59f='EXPIRED':_0x44b59f=_0x4245b2(0x19e);}else _0x44b59f=_0x4245b2(0x19e);}else _0x44b59f=_0x4245b2(0x1b0);return{'status':_0x44b59f,'amount':_0x24d11d[_0x4245b2(0x181)],'currency':_0x24d11d[_0x4245b2(0x197)],'isActive':_0x24d11d[_0x4245b2(0x1aa)]};}catch(_0x2d2385){console[_0x4245b2(0x1cf)](_0x4245b2(0x18c),_0x2d2385),loggerService_1[_0x4245b2(0x163)][_0x4245b2(0x16c)](_0x4245b2(0x173),'/payment-links/'+_0x80309b,_0x2d2385);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x2d2385 instanceof Error?_0x2d2385[_0x4245b2(0x15a)]:_0x4245b2(0x1ca)));}}async[a60_0xd8dd4d(0x176)](_0x5c084e){const _0x15d74b=a60_0xd8dd4d;console[_0x15d74b(0x172)](_0x15d74b(0x1a4),_0x5c084e);let _0xd7f1f1=_0x15d74b(0x1b0);switch(_0x5c084e[_0x15d74b(0x16a)]?.[_0x15d74b(0x1c7)]()){case'done':case'completed':case'paid':case _0x15d74b(0x1bb):case _0x15d74b(0x157):_0x5c084e[_0x15d74b(0x1b1)]===_0x15d74b(0x19f)?_0xd7f1f1=_0x15d74b(0x171):_0xd7f1f1='PENDING';break;case _0x15d74b(0x16e):case _0x15d74b(0x1a1):case _0x15d74b(0x1d1):case _0x15d74b(0x1cf):case _0x15d74b(0x17c):_0xd7f1f1=_0x15d74b(0x19e);break;case _0x15d74b(0x190):case'timeout':_0xd7f1f1=_0x15d74b(0x189);break;case _0x15d74b(0x17a):case _0x15d74b(0x1be):case'active':case'processing':case _0x15d74b(0x162):default:_0xd7f1f1=_0x15d74b(0x1b0);break;}return{'paymentId':_0x5c084e[_0x15d74b(0x1ce)]||_0x5c084e['PaymentId'],'status':_0xd7f1f1,'amount':_0x5c084e[_0x15d74b(0x1ad)],'currency':_0x5c084e[_0x15d74b(0x1c1)],'additionalInfo':{'method':_0x5c084e[_0x15d74b(0x15f)],'bankId':_0x5c084e['BankId'],'settled':_0x5c084e[_0x15d74b(0x1b1)],'settlementDate':_0x5c084e[_0x15d74b(0x1a3)],'remitterName':_0x5c084e[_0x15d74b(0x1a0)]?.[_0x15d74b(0x1b3)],'remitterIban':_0x5c084e[_0x15d74b(0x1a0)]?.[_0x15d74b(0x1bf)],'bankTransactionId':_0x5c084e[_0x15d74b(0x1cb)]}};}[a60_0xd8dd4d(0x18a)](_0x120121,_0x49178e){const _0x30871d=a60_0xd8dd4d;return console['log'](_0x30871d(0x1a6),{'receivedSignature':_0x49178e,'paymentId':_0x120121[_0x30871d(0x1ac)],'merchantPaymentId':_0x120121[_0x30871d(0x1ce)]}),!![];}}function a60_0x259b(){const _0x1ce826=['38745FDZsAk','Unknown\x20error','BankTransactionId','11179lOoURH','apiUrl','MerchantPaymentId','error','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','failed','successful','shortLink','Response\x20Time:','message','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Status\x20Text:','774150vOeZEE','Method','Response\x20data:','32MoVnMt','in_progress','loggerService','Raw\x20Response\x20Body:','(8digits-8digits\x20format)','1091725AkFLYF','Payment\x20System/1.0','createPaymentLink','Error\x20stack:','Status','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','logWhiteDomainError','status','cancelled','logWhiteDomainResponse','now','PAID','log','noda','fromEntries','18zoVFFp','processWebhook','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','stringify','âœ…\x20Return\x20URL\x20configured\x20for\x20pending:','pending','Error\x20message:','rejected','Parsed\x20Result:','Response\x20Body:','/payment-links/','211522gCyBdi','amount','===\x20NODA\x20SUCCESS\x20===','statusCode','text','10682664wEMJgU','Short\x20Link:','application/json','HTTP\x20','EXPIRED','verifyWebhookSignature','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Noda\x20payment\x20verification\x20error:','Unknown\x20error\x20from\x20Noda\x20API','POST','NodaService','expired','4440zPcxgM','https://tesoft.uk/gateway/pending.php?id=','GET','parse','Not\x20provided','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','currency','Order\x20ID\x20Used:','2984IrEZHe','Status\x20Code:','https://tesoft.uk/gateway/noda/','qrCodeLink','JSON\x20Parse\x20Error:\x20','FAILED','Yes','Remitter','canceled','defineProperty','SettlementDate','Processing\x20Noda\x20webhook:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Noda\x20webhook\x20signature\x20verification:','âœ…\x20ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž:\x20Return\x20URL\x20uses\x20pending.php:','===\x20NODA\x20API\x20ERROR\x20===','Status:','isActive','/payment-links','PaymentId','Amount','Business\x20Error:\x20','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','PENDING','Settled','Payment\x20Link\x20ID:','Name','shortLinkUrls','HTTP\x20error!\x20status:\x20','ðŸŒ\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Headers:','HTTP\x20Status:','Request\x20Body\x20(Direct\x20JSON):','logWhiteDomainRequest','success','Error\x20Message:','37670270QJWtIE','created','Iban','headers','Currency','Error\x20details:','toUpperCase','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','statusText','Noda\x20API\x20error:\x20','toLowerCase','expiryDate'];a60_0x259b=function(){return _0x1ce826;};return a60_0x259b();}exports[a60_0xd8dd4d(0x18f)]=NodaService;