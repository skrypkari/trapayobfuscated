'use strict';const a44_0x428ab0=a44_0x2f1f;(function(_0x3d75c9,_0x464c01){const _0x5def6b=a44_0x2f1f,_0x1ada76=_0x3d75c9();while(!![]){try{const _0x1e59fd=-parseInt(_0x5def6b(0x114))/0x1+parseInt(_0x5def6b(0xbd))/0x2*(parseInt(_0x5def6b(0xd1))/0x3)+-parseInt(_0x5def6b(0xac))/0x4+parseInt(_0x5def6b(0xfa))/0x5*(parseInt(_0x5def6b(0xca))/0x6)+parseInt(_0x5def6b(0x111))/0x7+-parseInt(_0x5def6b(0xa4))/0x8*(-parseInt(_0x5def6b(0xc8))/0x9)+-parseInt(_0x5def6b(0xe2))/0xa;if(_0x1e59fd===_0x464c01)break;else _0x1ada76['push'](_0x1ada76['shift']());}catch(_0x555c47){_0x1ada76['push'](_0x1ada76['shift']());}}}(a44_0x3a03,0xddef6));Object[a44_0x428ab0(0x101)](exports,'__esModule',{'value':!![]}),exports[a44_0x428ab0(0xa7)]=void 0x0;function a44_0x3a03(){const _0x2d6e17=['/payment-links/','FAILED','===\x20NODA\x20API\x20ERROR\x20===','statusText','Error\x20message:','Not\x20provided','message','logWhiteDomainError','Response\x20data:','Short\x20Link:','11726960KTGNsE','Response\x20Body:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','https://tesoft.uk/gateway/noda/','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','BankId','qrCodeLink','apiUrl','expiryDate','URL:','Order\x20ID\x20Format:','failed','Raw\x20Response\x20Body:','log','Noda\x20webhook\x20signature\x20verification:','amount','SettlementDate','Failed\x20to\x20parse\x20JSON\x20response:','(8digits-8digits\x20format\x20for\x20Noda)','headers','Error\x20details:','Status:','error','HTTP\x20Status:','10DuRASx','Status\x20Text:','(8digits-8digits\x20format)','verifyWebhookSignature','===\x20NODA\x20SUCCESS\x20===','Status','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','defineProperty','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Processing\x20Noda\x20webhook:','parse','stringify','in_progress','toUpperCase','status','created','Unknown\x20error','success','Currency','active','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','fromEntries','2699389oSQIoF','Amount','Status\x20Code:','1413242OPTrjR','Order\x20ID\x20Used:','POST','Parsed\x20Result:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','now','PaymentId','noda','entries','32oyKrsX','Error\x20Message:','shortLink','NodaService','done','Missing\x20id\x20or\x20shortLink\x20in\x20response','json','processing','2474336FvQGrk','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','successful','paid','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','QR\x20Code\x20Link:','isActive',',\x20body:\x20','Iban','canceled','verifyPayment','statusCode','toLowerCase','PAID','Business\x20Error:\x20','expired','1166794iPeLpR','/payment-links','===\x20NODA\x20SERVICE\x20ERROR\x20===','Error\x20stack:','text','logWhiteDomainResponse','application/json','MerchantPaymentId','Noda\x20API\x20error:\x20','loggerService','PENDING','3173481dIbYBW','JSON\x20Parse\x20Error:\x20','1701942riqmFo','TesSoft\x20Payment\x20System/1.0','Remitter','rejected','GET','Settled','Response\x20Time:','9lhRCet','logWhiteDomainRequest','Payment\x20Link\x20ID:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','https://tesoft.uk/gateway/pending.php?id=','HTTP\x20error!\x20status:\x20','shortLinkUrls'];a44_0x3a03=function(){return _0x2d6e17;};return a44_0x3a03();}function a44_0x2f1f(_0x572433,_0x2477c5){const _0x3a0369=a44_0x3a03();return a44_0x2f1f=function(_0x2f1f3d,_0xe6fffa){_0x2f1f3d=_0x2f1f3d-0x9e;let _0xb2d45e=_0x3a0369[_0x2f1f3d];return _0xb2d45e;},a44_0x2f1f(_0x572433,_0x2477c5);}const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x2e9ada=a44_0x428ab0;this[_0x2e9ada(0xe9)]=_0x2e9ada(0xe5),console['log'](_0x2e9ada(0x100));}async['createPaymentLink'](_0x3a965e){const _0x4d7af2=a44_0x428ab0,{orderId:_0x47aa33,name:_0x428d95,paymentDescription:_0x58d632,amount:_0x5c7418,currency:_0x515b8c,webhookUrl:_0x5b3abb,returnUrl:_0x12132a,expiryDate:_0x47da78}=_0x3a965e,_0x716287=_0x515b8c[_0x4d7af2(0x107)](),_0x3c6422='https://tesoft.uk/gateway/noda/webhook/',_0x13c324=_0x4d7af2(0xd5)+_0x47aa33,_0x25bd37={'name':_0x428d95,'paymentDescription':_0x58d632,'amount':_0x5c7418,'currency':_0x716287,'paymentId':_0x47aa33,'webhookUrl':_0x3c6422,'returnUrl':_0x13c324};_0x47da78&&(_0x25bd37['expiryDate']=_0x47da78);const _0x20ec0f=Date[_0x4d7af2(0xa0)]();try{console[_0x4d7af2(0xef)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x4d7af2(0xef)](_0x4d7af2(0xeb),this[_0x4d7af2(0xe9)]),console['log']('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x4d7af2(0x105)](_0x25bd37,null,0x2)),console[_0x4d7af2(0xef)](_0x4d7af2(0xec),_0x47aa33,_0x4d7af2(0xf4)),console['log'](_0x4d7af2(0xb1),_0x13c324),loggerService_1['loggerService'][_0x4d7af2(0xd2)](_0x4d7af2(0xa2),_0x4d7af2(0xbe),_0x4d7af2(0x116),_0x25bd37);const _0x3bdba0=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x4d7af2(0xc3),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x25bd37)}),_0x5f1ea5=Date[_0x4d7af2(0xa0)]()-_0x20ec0f;console[_0x4d7af2(0xef)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x4d7af2(0xef)](_0x4d7af2(0xf7),_0x3bdba0['status']),console[_0x4d7af2(0xef)](_0x4d7af2(0xfb),_0x3bdba0[_0x4d7af2(0xdb)]),console['log']('Headers:',Object[_0x4d7af2(0x110)](_0x3bdba0[_0x4d7af2(0xf5)][_0x4d7af2(0xa3)]())),console['log'](_0x4d7af2(0xd0),_0x5f1ea5+'ms');const _0x948536=await _0x3bdba0[_0x4d7af2(0xc1)]();console['log'](_0x4d7af2(0xee),_0x948536);if(!_0x3bdba0['ok']){console[_0x4d7af2(0xf8)](_0x4d7af2(0xda)),console[_0x4d7af2(0xf8)](_0x4d7af2(0xf9),_0x3bdba0[_0x4d7af2(0x108)]),console[_0x4d7af2(0xf8)](_0x4d7af2(0xe3),_0x948536),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4d7af2(0xa2),'/payment-links',_0x3bdba0[_0x4d7af2(0x108)],_0x948536,_0x5f1ea5),loggerService_1[_0x4d7af2(0xc6)][_0x4d7af2(0xdf)]('noda','/payment-links','HTTP\x20'+_0x3bdba0[_0x4d7af2(0x108)]+':\x20'+_0x948536);if(_0x3bdba0[_0x4d7af2(0x108)]===0x190)throw new Error(_0x4d7af2(0x9f));else{if(_0x3bdba0[_0x4d7af2(0x108)]===0x1f4)throw new Error(_0x4d7af2(0xd4));}throw new Error(_0x4d7af2(0xd6)+_0x3bdba0[_0x4d7af2(0x108)]+_0x4d7af2(0xb4)+_0x948536);}let _0x5e3654;try{_0x5e3654=JSON[_0x4d7af2(0x104)](_0x948536);}catch(_0x3252b6){console[_0x4d7af2(0xf8)](_0x4d7af2(0xf3),_0x3252b6),loggerService_1[_0x4d7af2(0xc6)][_0x4d7af2(0xdf)](_0x4d7af2(0xa2),_0x4d7af2(0xbe),_0x4d7af2(0xc9)+_0x3252b6);throw new Error(_0x4d7af2(0xe4)+_0x948536);}console[_0x4d7af2(0xef)](_0x4d7af2(0x102)),console['log'](_0x4d7af2(0x9e),JSON['stringify'](_0x5e3654,null,0x2)),loggerService_1[_0x4d7af2(0xc6)][_0x4d7af2(0xc2)](_0x4d7af2(0xa2),'/payment-links',_0x3bdba0['status'],_0x5e3654,_0x5f1ea5);if(_0x5e3654[_0x4d7af2(0xf8)]||_0x5e3654['statusCode']){const _0x4224b4=_0x5e3654[_0x4d7af2(0xde)]||_0x5e3654[_0x4d7af2(0xf8)]||'Unknown\x20error\x20from\x20Noda\x20API';console[_0x4d7af2(0xf8)](_0x4d7af2(0x10f)),console[_0x4d7af2(0xf8)](_0x4d7af2(0xa5),_0x4224b4),console[_0x4d7af2(0xf8)](_0x4d7af2(0x113),_0x5e3654[_0x4d7af2(0xb8)]),loggerService_1[_0x4d7af2(0xc6)][_0x4d7af2(0xdf)](_0x4d7af2(0xa2),_0x4d7af2(0xbe),_0x4d7af2(0xbb)+_0x4224b4);throw new Error(_0x4d7af2(0xc5)+_0x4224b4);}if(!_0x5e3654['id']||!_0x5e3654[_0x4d7af2(0xd7)]?.[_0x4d7af2(0xa6)]){console[_0x4d7af2(0xf8)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4d7af2(0xf8)](_0x4d7af2(0xa9)),console['error'](_0x4d7af2(0xe0),_0x5e3654),loggerService_1[_0x4d7af2(0xc6)][_0x4d7af2(0xdf)](_0x4d7af2(0xa2),_0x4d7af2(0xbe),_0x4d7af2(0x10e));throw new Error(_0x4d7af2(0xe6));}return console[_0x4d7af2(0xef)](_0x4d7af2(0xfe)),console[_0x4d7af2(0xef)](_0x4d7af2(0xd3),_0x5e3654['id']),console[_0x4d7af2(0xef)](_0x4d7af2(0xe1),_0x5e3654['shortLinkUrls'][_0x4d7af2(0xa6)]),console['log'](_0x4d7af2(0xb2),_0x5e3654[_0x4d7af2(0xd7)][_0x4d7af2(0xe8)]||_0x4d7af2(0xdd)),console[_0x4d7af2(0xef)](_0x4d7af2(0x115),_0x47aa33,_0x4d7af2(0xfc)),console[_0x4d7af2(0xef)](_0x4d7af2(0xb0),_0x13c324),{'gateway_payment_id':_0x5e3654['id'],'payment_url':_0x5e3654['shortLinkUrls'][_0x4d7af2(0xa6)],'qr_code_url':_0x5e3654[_0x4d7af2(0xd7)]['qrCodeLink'],'expiry_date':_0x5e3654[_0x4d7af2(0xea)]};}catch(_0x2178a1){console['error'](_0x4d7af2(0xbf)),console[_0x4d7af2(0xf8)](_0x4d7af2(0xf6),_0x2178a1),loggerService_1[_0x4d7af2(0xc6)][_0x4d7af2(0xdf)](_0x4d7af2(0xa2),_0x4d7af2(0xbe),_0x2178a1);if(_0x2178a1 instanceof Error){console[_0x4d7af2(0xf8)](_0x4d7af2(0xdc),_0x2178a1['message']),console['error'](_0x4d7af2(0xc0),_0x2178a1['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x2178a1[_0x4d7af2(0xde)]);}throw new Error(_0x4d7af2(0xad));}}async[a44_0x428ab0(0xb7)](_0x3d5189){const _0x34dc40=a44_0x428ab0,_0x47eb5d=Date[_0x34dc40(0xa0)]();try{loggerService_1['loggerService'][_0x34dc40(0xd2)]('noda',_0x34dc40(0xd8)+_0x3d5189,'GET',{});const _0x3ad2d9=await fetch(this[_0x34dc40(0xe9)]+'/'+_0x3d5189,{'method':_0x34dc40(0xce),'headers':{'Content-Type':_0x34dc40(0xc3),'User-Agent':_0x34dc40(0xcb)}}),_0x5d7a10=Date[_0x34dc40(0xa0)]()-_0x47eb5d;if(!_0x3ad2d9['ok']){const _0x1af8ae=await _0x3ad2d9[_0x34dc40(0xc1)]();loggerService_1[_0x34dc40(0xc6)][_0x34dc40(0xc2)](_0x34dc40(0xa2),_0x34dc40(0xd8)+_0x3d5189,_0x3ad2d9[_0x34dc40(0x108)],_0x1af8ae,_0x5d7a10);throw new Error(_0x34dc40(0xd6)+_0x3ad2d9[_0x34dc40(0x108)]);}const _0x561c4a=await _0x3ad2d9[_0x34dc40(0xaa)]();loggerService_1[_0x34dc40(0xc6)]['logWhiteDomainResponse']('noda',_0x34dc40(0xd8)+_0x3d5189,_0x3ad2d9[_0x34dc40(0x108)],_0x561c4a,_0x5d7a10);if(_0x561c4a['error']||_0x561c4a[_0x34dc40(0xb8)]){loggerService_1['loggerService'][_0x34dc40(0xdf)]('noda','/payment-links/'+_0x3d5189,_0x34dc40(0xc5)+(_0x561c4a['message']||_0x561c4a[_0x34dc40(0xf8)]||_0x34dc40(0x10a)));throw new Error(_0x34dc40(0xc5)+(_0x561c4a[_0x34dc40(0xde)]||_0x561c4a[_0x34dc40(0xf8)]||_0x34dc40(0x10a)));}let _0x25484c=_0x34dc40(0xc7);if(_0x561c4a[_0x34dc40(0xb3)]===![]){if(_0x561c4a[_0x34dc40(0xea)]){const _0x53ab1d=new Date(_0x561c4a['expiryDate']),_0x56d003=new Date();_0x53ab1d<_0x56d003?_0x25484c='EXPIRED':_0x25484c=_0x34dc40(0xd9);}else _0x25484c='FAILED';}else _0x25484c=_0x34dc40(0xc7);return{'status':_0x25484c,'amount':_0x561c4a[_0x34dc40(0xf1)],'currency':_0x561c4a['currency'],'isActive':_0x561c4a[_0x34dc40(0xb3)]};}catch(_0x3ad452){console[_0x34dc40(0xf8)]('Noda\x20payment\x20verification\x20error:',_0x3ad452),loggerService_1[_0x34dc40(0xc6)][_0x34dc40(0xdf)](_0x34dc40(0xa2),'/payment-links/'+_0x3d5189,_0x3ad452);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x3ad452 instanceof Error?_0x3ad452[_0x34dc40(0xde)]:'Unknown\x20error'));}}async['processWebhook'](_0x4f63a1){const _0xbf4291=a44_0x428ab0;console[_0xbf4291(0xef)](_0xbf4291(0x103),_0x4f63a1);let _0xb9a8a6='PENDING';switch(_0x4f63a1[_0xbf4291(0xff)]?.[_0xbf4291(0xb9)]()){case _0xbf4291(0xa8):case'completed':case _0xbf4291(0xaf):case _0xbf4291(0x10b):case _0xbf4291(0xae):_0x4f63a1[_0xbf4291(0xcf)]==='Yes'?_0xb9a8a6=_0xbf4291(0xba):_0xb9a8a6=_0xbf4291(0xc7);break;case'cancelled':case _0xbf4291(0xb6):case _0xbf4291(0xed):case'error':case _0xbf4291(0xcd):_0xb9a8a6=_0xbf4291(0xd9);break;case _0xbf4291(0xbc):case'timeout':_0xb9a8a6='EXPIRED';break;case'pending':case _0xbf4291(0x109):case _0xbf4291(0x10d):case _0xbf4291(0xab):case _0xbf4291(0x106):default:_0xb9a8a6=_0xbf4291(0xc7);break;}return{'paymentId':_0x4f63a1[_0xbf4291(0xc4)]||_0x4f63a1[_0xbf4291(0xa1)],'status':_0xb9a8a6,'amount':_0x4f63a1[_0xbf4291(0x112)],'currency':_0x4f63a1[_0xbf4291(0x10c)],'additionalInfo':{'method':_0x4f63a1['Method'],'bankId':_0x4f63a1[_0xbf4291(0xe7)],'settled':_0x4f63a1[_0xbf4291(0xcf)],'settlementDate':_0x4f63a1[_0xbf4291(0xf2)],'remitterName':_0x4f63a1[_0xbf4291(0xcc)]?.['Name'],'remitterIban':_0x4f63a1[_0xbf4291(0xcc)]?.[_0xbf4291(0xb5)],'bankTransactionId':_0x4f63a1['BankTransactionId']}};}[a44_0x428ab0(0xfd)](_0xdc0588,_0x531368){const _0x141cdd=a44_0x428ab0;return console[_0x141cdd(0xef)](_0x141cdd(0xf0),{'receivedSignature':_0x531368,'paymentId':_0xdc0588[_0x141cdd(0xa1)],'merchantPaymentId':_0xdc0588[_0x141cdd(0xc4)]}),!![];}}exports['NodaService']=NodaService;