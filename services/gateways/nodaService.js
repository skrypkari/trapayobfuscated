'use strict';function a50_0x30d9(_0xc98a0c,_0x554e53){const _0x7f8353=a50_0x7f83();return a50_0x30d9=function(_0x30d954,_0x4a6d12){_0x30d954=_0x30d954-0x89;let _0x4afaa9=_0x7f8353[_0x30d954];return _0x4afaa9;},a50_0x30d9(_0xc98a0c,_0x554e53);}const a50_0x41bfd6=a50_0x30d9;(function(_0x53a950,_0x25a334){const _0x5f1dcc=a50_0x30d9,_0xd050f1=_0x53a950();while(!![]){try{const _0x3be6de=-parseInt(_0x5f1dcc(0xe3))/0x1*(-parseInt(_0x5f1dcc(0x93))/0x2)+-parseInt(_0x5f1dcc(0xa1))/0x3*(parseInt(_0x5f1dcc(0xd1))/0x4)+-parseInt(_0x5f1dcc(0xdc))/0x5*(parseInt(_0x5f1dcc(0xba))/0x6)+-parseInt(_0x5f1dcc(0xa5))/0x7+parseInt(_0x5f1dcc(0xd5))/0x8+-parseInt(_0x5f1dcc(0xf4))/0x9*(parseInt(_0x5f1dcc(0x9f))/0xa)+-parseInt(_0x5f1dcc(0x8e))/0xb*(-parseInt(_0x5f1dcc(0x90))/0xc);if(_0x3be6de===_0x25a334)break;else _0xd050f1['push'](_0xd050f1['shift']());}catch(_0x127d84){_0xd050f1['push'](_0xd050f1['shift']());}}}(a50_0x7f83,0xb5d01));Object[a50_0x41bfd6(0x9c)](exports,a50_0x41bfd6(0xf2),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require('../loggerService');function a50_0x7f83(){const _0x184308=['PENDING','headers','amount','5DZhhGU','Order\x20ID\x20Used:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','cancelled','Request\x20Body\x20(Direct\x20JSON):','Error\x20Message:','status','95827goQxDq','message','Response\x20data:','Yes','/payment-links','rejected','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Name','Error\x20stack:','HTTP\x20error!\x20status:\x20','https://tesoft.uk/gateway/noda/webhook/','Unknown\x20error','text','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','successful','__esModule','entries','12450123HNTfVf','Headers:','shortLink','statusCode','verifyPayment','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','GET','Response\x20Body:','processing','POST','paid','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','processWebhook','NodaService','(8digits-8digits\x20format)','error','SettlementDate','PaymentId','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','canceled','Status\x20Text:','Method','loggerService','stack','JSON\x20Parse\x20Error:\x20','MerchantPaymentId','shortLinkUrls','HTTP\x20','Short\x20Link:','in_progress','77eResTy','===\x20PARSED\x20NODA\x20RESPONSE\x20===','5794572hjoLLw','completed','expired','2bUJUME','Status:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Failed\x20to\x20verify\x20Noda\x20payment:\x20','BankId','https://tesoft.uk/gateway/noda/','Settled','created','Missing\x20id\x20or\x20shortLink\x20in\x20response','defineProperty','Remitter','noda','10GWlpYY','pending','1494KpzASk','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','(8digits-8digits\x20format\x20for\x20Noda)','logWhiteDomainError','240009WEcILi','===\x20NODA\x20SUCCESS\x20===','HTTP\x20Status:','currency','isActive','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Status\x20Code:','parse','Error\x20message:','Unknown\x20error\x20from\x20Noda\x20API','logWhiteDomainRequest','Noda\x20webhook\x20signature\x20verification:','BankTransactionId','EXPIRED','Noda\x20payment\x20verification\x20error:','toLowerCase','statusText','QR\x20Code\x20Link:','stringify','createPaymentLink','logWhiteDomainResponse','8283666twdNMp','fromEntries','Response\x20Time:','done','URL:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','now','qrCodeLink','Amount','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','/payment-links/','success','Processing\x20Noda\x20webhook:','Parsed\x20Result:','Failed\x20to\x20parse\x20JSON\x20response:','Order\x20ID\x20Format:','application/json','failed','apiUrl','log','expiryDate','Noda\x20API\x20error:\x20','FAILED','1684TSPSYY','===\x20NODA\x20API\x20ERROR\x20===','active','Error\x20details:','2212912bCTZKS','===\x20NODA\x20SERVICE\x20ERROR\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','timeout'];a50_0x7f83=function(){return _0x184308;};return a50_0x7f83();}class NodaService{constructor(){const _0x1e385c=a50_0x41bfd6;this[_0x1e385c(0xcc)]=_0x1e385c(0x98),console[_0x1e385c(0xcd)](_0x1e385c(0xbf));}async[a50_0x41bfd6(0xb8)](_0xc20d79){const _0x36b403=a50_0x41bfd6,{orderId:_0x2266ad,name:_0x26c51e,paymentDescription:_0x118be7,amount:_0x5399a9,currency:_0x329735,webhookUrl:_0x2339c9,returnUrl:_0x367931,expiryDate:_0x5cd279}=_0xc20d79,_0xe33f50=_0x329735['toUpperCase'](),_0x4759f0=_0x36b403(0xed),_0x4e2f3a='https://tesoft.uk/gateway/pending.php?id='+_0x2266ad,_0x583354={'name':_0x26c51e,'paymentDescription':_0x118be7,'amount':_0x5399a9,'currency':_0xe33f50,'paymentId':_0x2266ad,'webhookUrl':_0x4759f0,'returnUrl':_0x4e2f3a};_0x5cd279&&(_0x583354[_0x36b403(0xce)]=_0x5cd279);const _0x3011d0=Date[_0x36b403(0xc0)]();try{console['log'](_0x36b403(0xaa)),console[_0x36b403(0xcd)](_0x36b403(0xbe),this['apiUrl']),console['log'](_0x36b403(0xe0),JSON[_0x36b403(0xb7)](_0x583354,null,0x2)),console[_0x36b403(0xcd)](_0x36b403(0xc9),_0x2266ad,_0x36b403(0xa3)),console[_0x36b403(0xcd)](_0x36b403(0xde),_0x4e2f3a),loggerService_1[_0x36b403(0x10a)][_0x36b403(0xaf)]('noda',_0x36b403(0xe7),_0x36b403(0xfd),_0x583354);const _0x52527c=await fetch(this['apiUrl'],{'method':_0x36b403(0xfd),'headers':{'Content-Type':_0x36b403(0xca),'Accept':_0x36b403(0xca),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x36b403(0xb7)](_0x583354)}),_0x394dc8=Date[_0x36b403(0xc0)]()-_0x3011d0;console[_0x36b403(0xcd)](_0x36b403(0xf9)),console[_0x36b403(0xcd)](_0x36b403(0x94),_0x52527c[_0x36b403(0xe2)]),console[_0x36b403(0xcd)](_0x36b403(0x108),_0x52527c[_0x36b403(0xb5)]),console[_0x36b403(0xcd)](_0x36b403(0xf5),Object[_0x36b403(0xbb)](_0x52527c[_0x36b403(0xda)][_0x36b403(0xf3)]())),console[_0x36b403(0xcd)](_0x36b403(0xbc),_0x394dc8+'ms');const _0x55454d=await _0x52527c[_0x36b403(0xef)]();console[_0x36b403(0xcd)]('Raw\x20Response\x20Body:',_0x55454d);if(!_0x52527c['ok']){console['error'](_0x36b403(0xd2)),console[_0x36b403(0x103)](_0x36b403(0xa7),_0x52527c[_0x36b403(0xe2)]),console[_0x36b403(0x103)](_0x36b403(0xfb),_0x55454d),loggerService_1[_0x36b403(0x10a)][_0x36b403(0xb9)]('noda',_0x36b403(0xe7),_0x52527c['status'],_0x55454d,_0x394dc8),loggerService_1[_0x36b403(0x10a)][_0x36b403(0xa4)]('noda',_0x36b403(0xe7),_0x36b403(0x8b)+_0x52527c[_0x36b403(0xe2)]+':\x20'+_0x55454d);if(_0x52527c['status']===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x52527c[_0x36b403(0xe2)]===0x1f4)throw new Error(_0x36b403(0x95));}throw new Error(_0x36b403(0xec)+_0x52527c['status']+',\x20body:\x20'+_0x55454d);}let _0x3dc2b3;try{_0x3dc2b3=JSON[_0x36b403(0xac)](_0x55454d);}catch(_0x4180dd){console[_0x36b403(0x103)](_0x36b403(0xc8),_0x4180dd),loggerService_1[_0x36b403(0x10a)]['logWhiteDomainError'](_0x36b403(0x9e),'/payment-links',_0x36b403(0x10c)+_0x4180dd);throw new Error(_0x36b403(0xff)+_0x55454d);}console[_0x36b403(0xcd)](_0x36b403(0x8f)),console[_0x36b403(0xcd)](_0x36b403(0xc7),JSON['stringify'](_0x3dc2b3,null,0x2)),loggerService_1[_0x36b403(0x10a)]['logWhiteDomainResponse'](_0x36b403(0x9e),_0x36b403(0xe7),_0x52527c[_0x36b403(0xe2)],_0x3dc2b3,_0x394dc8);if(_0x3dc2b3['error']||_0x3dc2b3[_0x36b403(0xf7)]){const _0x15e7e3=_0x3dc2b3[_0x36b403(0xe4)]||_0x3dc2b3[_0x36b403(0x103)]||_0x36b403(0xae);console[_0x36b403(0x103)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x36b403(0x103)](_0x36b403(0xe1),_0x15e7e3),console[_0x36b403(0x103)](_0x36b403(0xab),_0x3dc2b3[_0x36b403(0xf7)]),loggerService_1[_0x36b403(0x10a)][_0x36b403(0xa4)](_0x36b403(0x9e),_0x36b403(0xe7),'Business\x20Error:\x20'+_0x15e7e3);throw new Error(_0x36b403(0xcf)+_0x15e7e3);}if(!_0x3dc2b3['id']||!_0x3dc2b3[_0x36b403(0x8a)]?.[_0x36b403(0xf6)]){console['error'](_0x36b403(0xe9)),console[_0x36b403(0x103)](_0x36b403(0x9b)),console[_0x36b403(0x103)](_0x36b403(0xe5),_0x3dc2b3),loggerService_1[_0x36b403(0x10a)][_0x36b403(0xa4)](_0x36b403(0x9e),_0x36b403(0xe7),_0x36b403(0x106));throw new Error(_0x36b403(0xa2));}return console[_0x36b403(0xcd)](_0x36b403(0xa6)),console[_0x36b403(0xcd)]('Payment\x20Link\x20ID:',_0x3dc2b3['id']),console[_0x36b403(0xcd)](_0x36b403(0x8c),_0x3dc2b3['shortLinkUrls']['shortLink']),console[_0x36b403(0xcd)](_0x36b403(0xb6),_0x3dc2b3[_0x36b403(0x8a)][_0x36b403(0xc1)]||'Not\x20provided'),console[_0x36b403(0xcd)](_0x36b403(0xdd),_0x2266ad,_0x36b403(0x102)),console[_0x36b403(0xcd)](_0x36b403(0xc3),_0x4e2f3a),{'gateway_payment_id':_0x3dc2b3['id'],'payment_url':_0x3dc2b3[_0x36b403(0x8a)][_0x36b403(0xf6)],'qr_code_url':_0x3dc2b3['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x3dc2b3[_0x36b403(0xce)]};}catch(_0x4ec683){console['error'](_0x36b403(0xd6)),console[_0x36b403(0x103)](_0x36b403(0xd4),_0x4ec683),loggerService_1[_0x36b403(0x10a)][_0x36b403(0xa4)]('noda',_0x36b403(0xe7),_0x4ec683);if(_0x4ec683 instanceof Error){console[_0x36b403(0x103)](_0x36b403(0xad),_0x4ec683[_0x36b403(0xe4)]),console['error'](_0x36b403(0xeb),_0x4ec683[_0x36b403(0x10b)]);throw new Error(_0x36b403(0xd7)+_0x4ec683[_0x36b403(0xe4)]);}throw new Error(_0x36b403(0xf0));}}async[a50_0x41bfd6(0xf8)](_0x8fbf4a){const _0x4831b3=a50_0x41bfd6,_0x58beca=Date[_0x4831b3(0xc0)]();try{loggerService_1[_0x4831b3(0x10a)][_0x4831b3(0xaf)](_0x4831b3(0x9e),_0x4831b3(0xc4)+_0x8fbf4a,'GET',{});const _0x44684c=await fetch(this[_0x4831b3(0xcc)]+'/'+_0x8fbf4a,{'method':_0x4831b3(0xfa),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x34db3a=Date[_0x4831b3(0xc0)]()-_0x58beca;if(!_0x44684c['ok']){const _0x2388c9=await _0x44684c[_0x4831b3(0xef)]();loggerService_1[_0x4831b3(0x10a)][_0x4831b3(0xb9)]('noda',_0x4831b3(0xc4)+_0x8fbf4a,_0x44684c['status'],_0x2388c9,_0x34db3a);throw new Error(_0x4831b3(0xec)+_0x44684c['status']);}const _0x47fe67=await _0x44684c['json']();loggerService_1[_0x4831b3(0x10a)][_0x4831b3(0xb9)](_0x4831b3(0x9e),'/payment-links/'+_0x8fbf4a,_0x44684c[_0x4831b3(0xe2)],_0x47fe67,_0x34db3a);if(_0x47fe67[_0x4831b3(0x103)]||_0x47fe67[_0x4831b3(0xf7)]){loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x4831b3(0xc4)+_0x8fbf4a,_0x4831b3(0xcf)+(_0x47fe67['message']||_0x47fe67[_0x4831b3(0x103)]||_0x4831b3(0xee)));throw new Error('Noda\x20API\x20error:\x20'+(_0x47fe67[_0x4831b3(0xe4)]||_0x47fe67[_0x4831b3(0x103)]||_0x4831b3(0xee)));}let _0x4d512e=_0x4831b3(0xd9);if(_0x47fe67[_0x4831b3(0xa9)]===![]){if(_0x47fe67[_0x4831b3(0xce)]){const _0x13cdb2=new Date(_0x47fe67[_0x4831b3(0xce)]),_0x4a1727=new Date();_0x13cdb2<_0x4a1727?_0x4d512e=_0x4831b3(0xb2):_0x4d512e='FAILED';}else _0x4d512e=_0x4831b3(0xd0);}else _0x4d512e='PENDING';return{'status':_0x4d512e,'amount':_0x47fe67[_0x4831b3(0xdb)],'currency':_0x47fe67[_0x4831b3(0xa8)],'isActive':_0x47fe67[_0x4831b3(0xa9)]};}catch(_0xb4a635){console[_0x4831b3(0x103)](_0x4831b3(0xb3),_0xb4a635),loggerService_1[_0x4831b3(0x10a)][_0x4831b3(0xa4)](_0x4831b3(0x9e),_0x4831b3(0xc4)+_0x8fbf4a,_0xb4a635);throw new Error(_0x4831b3(0x96)+(_0xb4a635 instanceof Error?_0xb4a635['message']:_0x4831b3(0xee)));}}async[a50_0x41bfd6(0x100)](_0xeca542){const _0x5a17e2=a50_0x41bfd6;console['log'](_0x5a17e2(0xc6),_0xeca542);let _0x171c7e=_0x5a17e2(0xd9);switch(_0xeca542['Status']?.[_0x5a17e2(0xb4)]()){case _0x5a17e2(0xbd):case _0x5a17e2(0x91):case _0x5a17e2(0xfe):case _0x5a17e2(0xc5):case _0x5a17e2(0xf1):_0xeca542[_0x5a17e2(0x99)]===_0x5a17e2(0xe6)?_0x171c7e='PAID':_0x171c7e='PENDING';break;case _0x5a17e2(0xdf):case _0x5a17e2(0x107):case _0x5a17e2(0xcb):case _0x5a17e2(0x103):case _0x5a17e2(0xe8):_0x171c7e=_0x5a17e2(0xd0);break;case _0x5a17e2(0x92):case _0x5a17e2(0xd8):_0x171c7e=_0x5a17e2(0xb2);break;case _0x5a17e2(0xa0):case _0x5a17e2(0x9a):case _0x5a17e2(0xd3):case _0x5a17e2(0xfc):case _0x5a17e2(0x8d):default:_0x171c7e='PENDING';break;}return{'paymentId':_0xeca542[_0x5a17e2(0x89)]||_0xeca542[_0x5a17e2(0x105)],'status':_0x171c7e,'amount':_0xeca542[_0x5a17e2(0xc2)],'currency':_0xeca542['Currency'],'additionalInfo':{'method':_0xeca542[_0x5a17e2(0x109)],'bankId':_0xeca542[_0x5a17e2(0x97)],'settled':_0xeca542[_0x5a17e2(0x99)],'settlementDate':_0xeca542[_0x5a17e2(0x104)],'remitterName':_0xeca542[_0x5a17e2(0x9d)]?.[_0x5a17e2(0xea)],'remitterIban':_0xeca542[_0x5a17e2(0x9d)]?.['Iban'],'bankTransactionId':_0xeca542[_0x5a17e2(0xb1)]}};}['verifyWebhookSignature'](_0x2fdd52,_0x3cc170){const _0x54976a=a50_0x41bfd6;return console[_0x54976a(0xcd)](_0x54976a(0xb0),{'receivedSignature':_0x3cc170,'paymentId':_0x2fdd52[_0x54976a(0x105)],'merchantPaymentId':_0x2fdd52[_0x54976a(0x89)]}),!![];}}exports[a50_0x41bfd6(0x101)]=NodaService;