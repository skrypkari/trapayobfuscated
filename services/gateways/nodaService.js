'use strict';const a53_0x4efadc=a53_0x18d6;(function(_0x5952c4,_0x27a251){const _0x17821e=a53_0x18d6,_0x50557d=_0x5952c4();while(!![]){try{const _0x306656=parseInt(_0x17821e(0x15a))/0x1*(parseInt(_0x17821e(0x1a3))/0x2)+parseInt(_0x17821e(0x171))/0x3*(-parseInt(_0x17821e(0x190))/0x4)+parseInt(_0x17821e(0x15e))/0x5*(-parseInt(_0x17821e(0x17c))/0x6)+parseInt(_0x17821e(0x1a8))/0x7*(parseInt(_0x17821e(0x153))/0x8)+parseInt(_0x17821e(0x19b))/0x9+parseInt(_0x17821e(0x16a))/0xa*(-parseInt(_0x17821e(0x15b))/0xb)+-parseInt(_0x17821e(0x160))/0xc*(-parseInt(_0x17821e(0x1ae))/0xd);if(_0x306656===_0x27a251)break;else _0x50557d['push'](_0x50557d['shift']());}catch(_0x45f696){_0x50557d['push'](_0x50557d['shift']());}}}(a53_0x1953,0xdafb4));function a53_0x1953(){const _0x180129=['Headers:','__esModule','Iban','Amount',',\x20body:\x20','text','Remitter','qrCodeLink','verifyPayment','1766592yCDMfe','===\x20NODA\x20SERVICE\x20ERROR\x20===','stack','Request\x20Body\x20(Direct\x20JSON):','BankId','/payment-links/','https://tesoft.uk/gateway/noda/','Currency','17878YFevZf','Payment\x20Link\x20ID:','active','noda','toLowerCase','279139iEDjGe','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','https://tesoft.uk/gateway/noda/webhook/','loggerService','logWhiteDomainResponse','URL:','13fZebGR','shortLinkUrls','amount','FAILED','message','Response\x20Time:','POST','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','paid','(8digits-8digits\x20format)','Order\x20ID\x20Used:','Status:','JSON\x20Parse\x20Error:\x20','/payment-links','Status','expiryDate','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Processing\x20Noda\x20webhook:','Error\x20Message:','GET','processing','https://tesoft.uk/gateway/pending.php?id=','expired','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','success','json','statusCode','Response\x20Body:','Not\x20provided','NodaService','Order\x20ID\x20Format:','entries','256cEuMDM','cancelled','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Yes','logWhiteDomainRequest','EXPIRED','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','189ZioRaQ','346291NnZBIK','===\x20NODA\x20API\x20ERROR\x20===','Noda\x20API\x20error:\x20','6769565WtmDYg','Missing\x20id\x20or\x20shortLink\x20in\x20response','9892056JPUAIO','MerchantPaymentId','error','HTTP\x20Status:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','defineProperty','Error\x20message:','createPaymentLink','Short\x20Link:','Settled','430ZhIzLn','in_progress','logWhiteDomainError','Business\x20Error:\x20','SettlementDate','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Noda\x20payment\x20verification\x20error:','3lhFtIC','isActive','headers','Raw\x20Response\x20Body:','../loggerService','PaymentId','Error\x20stack:','shortLink','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','log','6uuuKYH','toUpperCase','apiUrl','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','BankTransactionId','Parsed\x20Result:','Method','Status\x20Code:','Unknown\x20error\x20from\x20Noda\x20API','stringify','status','(8digits-8digits\x20format\x20for\x20Noda)','application/json','HTTP\x20error!\x20status:\x20','now','Payment\x20System/1.0','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','PENDING','parse','successful','1526468yNuTkX','Unknown\x20error'];a53_0x1953=function(){return _0x180129;};return a53_0x1953();}Object[a53_0x4efadc(0x165)](exports,a53_0x4efadc(0x193),{'value':!![]}),exports[a53_0x4efadc(0x150)]=void 0x0;const loggerService_1=require(a53_0x4efadc(0x175));function a53_0x18d6(_0xf67e8f,_0x42b993){const _0x195358=a53_0x1953();return a53_0x18d6=function(_0x18d644,_0x2551c0){_0x18d644=_0x18d644-0x134;let _0x11e6c6=_0x195358[_0x18d644];return _0x11e6c6;},a53_0x18d6(_0xf67e8f,_0x42b993);}class NodaService{constructor(){const _0x603add=a53_0x4efadc;this[_0x603add(0x17e)]=_0x603add(0x1a1),console[_0x603add(0x17b)](_0x603add(0x159));}async[a53_0x4efadc(0x167)](_0x38feb9){const _0x16c80d=a53_0x4efadc,{orderId:_0x1813d5,name:_0x48441a,paymentDescription:_0x1f5ace,amount:_0x18496b,currency:_0x5917d0,webhookUrl:_0x486efa,returnUrl:_0x1d500a,expiryDate:_0x50765a}=_0x38feb9,_0x475dda=_0x5917d0[_0x16c80d(0x17d)](),_0x3e1741=_0x16c80d(0x1aa),_0x771dde=_0x16c80d(0x148)+_0x1813d5,_0x5cf90d={'name':_0x48441a,'paymentDescription':_0x1f5ace,'amount':_0x18496b,'currency':_0x475dda,'paymentId':_0x1813d5,'webhookUrl':_0x3e1741,'returnUrl':_0x771dde};_0x50765a&&(_0x5cf90d[_0x16c80d(0x142)]=_0x50765a);const _0x214fc7=Date[_0x16c80d(0x18a)]();try{console[_0x16c80d(0x17b)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x16c80d(0x17b)](_0x16c80d(0x1ad),this[_0x16c80d(0x17e)]),console['log'](_0x16c80d(0x19e),JSON[_0x16c80d(0x185)](_0x5cf90d,null,0x2)),console[_0x16c80d(0x17b)](_0x16c80d(0x151),_0x1813d5,_0x16c80d(0x187)),console[_0x16c80d(0x17b)](_0x16c80d(0x17a),_0x771dde),loggerService_1['loggerService'][_0x16c80d(0x157)]('noda',_0x16c80d(0x140),_0x16c80d(0x139),_0x5cf90d);const _0x59c584=await fetch(this['apiUrl'],{'method':_0x16c80d(0x139),'headers':{'Content-Type':_0x16c80d(0x188),'Accept':'application/json','User-Agent':_0x16c80d(0x18b)},'body':JSON['stringify'](_0x5cf90d)}),_0x1c6498=Date[_0x16c80d(0x18a)]()-_0x214fc7;console[_0x16c80d(0x17b)](_0x16c80d(0x18c)),console[_0x16c80d(0x17b)](_0x16c80d(0x13e),_0x59c584[_0x16c80d(0x186)]),console[_0x16c80d(0x17b)]('Status\x20Text:',_0x59c584['statusText']),console[_0x16c80d(0x17b)](_0x16c80d(0x192),Object['fromEntries'](_0x59c584[_0x16c80d(0x173)][_0x16c80d(0x152)]())),console[_0x16c80d(0x17b)](_0x16c80d(0x138),_0x1c6498+'ms');const _0xf9aefb=await _0x59c584[_0x16c80d(0x197)]();console[_0x16c80d(0x17b)](_0x16c80d(0x174),_0xf9aefb);if(!_0x59c584['ok']){console[_0x16c80d(0x162)](_0x16c80d(0x15c)),console[_0x16c80d(0x162)](_0x16c80d(0x163),_0x59c584[_0x16c80d(0x186)]),console[_0x16c80d(0x162)](_0x16c80d(0x14e),_0xf9aefb),loggerService_1[_0x16c80d(0x1ab)][_0x16c80d(0x1ac)](_0x16c80d(0x1a6),_0x16c80d(0x140),_0x59c584[_0x16c80d(0x186)],_0xf9aefb,_0x1c6498),loggerService_1[_0x16c80d(0x1ab)][_0x16c80d(0x16c)](_0x16c80d(0x1a6),_0x16c80d(0x140),'HTTP\x20'+_0x59c584[_0x16c80d(0x186)]+':\x20'+_0xf9aefb);if(_0x59c584['status']===0x190)throw new Error(_0x16c80d(0x17f));else{if(_0x59c584[_0x16c80d(0x186)]===0x1f4)throw new Error(_0x16c80d(0x143));}throw new Error(_0x16c80d(0x189)+_0x59c584[_0x16c80d(0x186)]+_0x16c80d(0x196)+_0xf9aefb);}let _0x3e365c;try{_0x3e365c=JSON[_0x16c80d(0x18e)](_0xf9aefb);}catch(_0x290a73){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x290a73),loggerService_1[_0x16c80d(0x1ab)][_0x16c80d(0x16c)](_0x16c80d(0x1a6),_0x16c80d(0x140),_0x16c80d(0x13f)+_0x290a73);throw new Error(_0x16c80d(0x179)+_0xf9aefb);}console[_0x16c80d(0x17b)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console['log'](_0x16c80d(0x181),JSON[_0x16c80d(0x185)](_0x3e365c,null,0x2)),loggerService_1[_0x16c80d(0x1ab)][_0x16c80d(0x1ac)](_0x16c80d(0x1a6),'/payment-links',_0x59c584['status'],_0x3e365c,_0x1c6498);if(_0x3e365c[_0x16c80d(0x162)]||_0x3e365c[_0x16c80d(0x14d)]){const _0x2fc7b8=_0x3e365c['message']||_0x3e365c[_0x16c80d(0x162)]||_0x16c80d(0x184);console[_0x16c80d(0x162)](_0x16c80d(0x16f)),console[_0x16c80d(0x162)](_0x16c80d(0x145),_0x2fc7b8),console['error'](_0x16c80d(0x183),_0x3e365c[_0x16c80d(0x14d)]),loggerService_1[_0x16c80d(0x1ab)][_0x16c80d(0x16c)](_0x16c80d(0x1a6),_0x16c80d(0x140),_0x16c80d(0x16d)+_0x2fc7b8);throw new Error(_0x16c80d(0x15d)+_0x2fc7b8);}if(!_0x3e365c['id']||!_0x3e365c['shortLinkUrls']?.[_0x16c80d(0x178)]){console[_0x16c80d(0x162)](_0x16c80d(0x1a9)),console[_0x16c80d(0x162)](_0x16c80d(0x15f)),console['error']('Response\x20data:',_0x3e365c),loggerService_1['loggerService'][_0x16c80d(0x16c)]('noda',_0x16c80d(0x140),_0x16c80d(0x14a));throw new Error(_0x16c80d(0x13a));}return console[_0x16c80d(0x17b)]('===\x20NODA\x20SUCCESS\x20==='),console['log'](_0x16c80d(0x1a4),_0x3e365c['id']),console[_0x16c80d(0x17b)](_0x16c80d(0x168),_0x3e365c[_0x16c80d(0x134)][_0x16c80d(0x178)]),console[_0x16c80d(0x17b)]('QR\x20Code\x20Link:',_0x3e365c[_0x16c80d(0x134)][_0x16c80d(0x199)]||_0x16c80d(0x14f)),console[_0x16c80d(0x17b)](_0x16c80d(0x13d),_0x1813d5,_0x16c80d(0x13c)),console[_0x16c80d(0x17b)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x771dde),{'gateway_payment_id':_0x3e365c['id'],'payment_url':_0x3e365c[_0x16c80d(0x134)][_0x16c80d(0x178)],'qr_code_url':_0x3e365c[_0x16c80d(0x134)][_0x16c80d(0x199)],'expiry_date':_0x3e365c[_0x16c80d(0x142)]};}catch(_0x4b99fc){console[_0x16c80d(0x162)](_0x16c80d(0x19c)),console[_0x16c80d(0x162)]('Error\x20details:',_0x4b99fc),loggerService_1[_0x16c80d(0x1ab)][_0x16c80d(0x16c)]('noda',_0x16c80d(0x140),_0x4b99fc);if(_0x4b99fc instanceof Error){console[_0x16c80d(0x162)](_0x16c80d(0x166),_0x4b99fc['message']),console[_0x16c80d(0x162)](_0x16c80d(0x177),_0x4b99fc[_0x16c80d(0x19d)]);throw new Error(_0x16c80d(0x164)+_0x4b99fc['message']);}throw new Error(_0x16c80d(0x155));}}async[a53_0x4efadc(0x19a)](_0xc4abab){const _0x242fd2=a53_0x4efadc,_0x133bf4=Date[_0x242fd2(0x18a)]();try{loggerService_1[_0x242fd2(0x1ab)][_0x242fd2(0x157)](_0x242fd2(0x1a6),'/payment-links/'+_0xc4abab,_0x242fd2(0x146),{});const _0xe67e18=await fetch(this[_0x242fd2(0x17e)]+'/'+_0xc4abab,{'method':_0x242fd2(0x146),'headers':{'Content-Type':_0x242fd2(0x188),'User-Agent':_0x242fd2(0x18b)}}),_0x114871=Date[_0x242fd2(0x18a)]()-_0x133bf4;if(!_0xe67e18['ok']){const _0x109e39=await _0xe67e18['text']();loggerService_1[_0x242fd2(0x1ab)][_0x242fd2(0x1ac)](_0x242fd2(0x1a6),_0x242fd2(0x1a0)+_0xc4abab,_0xe67e18[_0x242fd2(0x186)],_0x109e39,_0x114871);throw new Error('HTTP\x20error!\x20status:\x20'+_0xe67e18[_0x242fd2(0x186)]);}const _0x37ab89=await _0xe67e18[_0x242fd2(0x14c)]();loggerService_1['loggerService'][_0x242fd2(0x1ac)](_0x242fd2(0x1a6),_0x242fd2(0x1a0)+_0xc4abab,_0xe67e18['status'],_0x37ab89,_0x114871);if(_0x37ab89['error']||_0x37ab89[_0x242fd2(0x14d)]){loggerService_1['loggerService'][_0x242fd2(0x16c)](_0x242fd2(0x1a6),_0x242fd2(0x1a0)+_0xc4abab,'Noda\x20API\x20error:\x20'+(_0x37ab89[_0x242fd2(0x137)]||_0x37ab89[_0x242fd2(0x162)]||_0x242fd2(0x191)));throw new Error('Noda\x20API\x20error:\x20'+(_0x37ab89[_0x242fd2(0x137)]||_0x37ab89[_0x242fd2(0x162)]||_0x242fd2(0x191)));}let _0x3ac028='PENDING';if(_0x37ab89[_0x242fd2(0x172)]===![]){if(_0x37ab89[_0x242fd2(0x142)]){const _0x67ed1a=new Date(_0x37ab89[_0x242fd2(0x142)]),_0x2f7f59=new Date();_0x67ed1a<_0x2f7f59?_0x3ac028=_0x242fd2(0x158):_0x3ac028='FAILED';}else _0x3ac028=_0x242fd2(0x136);}else _0x3ac028=_0x242fd2(0x18d);return{'status':_0x3ac028,'amount':_0x37ab89[_0x242fd2(0x135)],'currency':_0x37ab89['currency'],'isActive':_0x37ab89[_0x242fd2(0x172)]};}catch(_0x406d14){console[_0x242fd2(0x162)](_0x242fd2(0x170),_0x406d14),loggerService_1['loggerService']['logWhiteDomainError'](_0x242fd2(0x1a6),_0x242fd2(0x1a0)+_0xc4abab,_0x406d14);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x406d14 instanceof Error?_0x406d14[_0x242fd2(0x137)]:_0x242fd2(0x191)));}}async['processWebhook'](_0x5abb6b){const _0x772446=a53_0x4efadc;console[_0x772446(0x17b)](_0x772446(0x144),_0x5abb6b);let _0x39a6ff='PENDING';switch(_0x5abb6b[_0x772446(0x141)]?.[_0x772446(0x1a7)]()){case'done':case'completed':case _0x772446(0x13b):case _0x772446(0x14b):case _0x772446(0x18f):_0x5abb6b[_0x772446(0x169)]===_0x772446(0x156)?_0x39a6ff='PAID':_0x39a6ff=_0x772446(0x18d);break;case _0x772446(0x154):case'canceled':case'failed':case _0x772446(0x162):case'rejected':_0x39a6ff='FAILED';break;case _0x772446(0x149):case'timeout':_0x39a6ff='EXPIRED';break;case'pending':case'created':case _0x772446(0x1a5):case _0x772446(0x147):case _0x772446(0x16b):default:_0x39a6ff=_0x772446(0x18d);break;}return{'paymentId':_0x5abb6b[_0x772446(0x161)]||_0x5abb6b[_0x772446(0x176)],'status':_0x39a6ff,'amount':_0x5abb6b[_0x772446(0x195)],'currency':_0x5abb6b[_0x772446(0x1a2)],'additionalInfo':{'method':_0x5abb6b[_0x772446(0x182)],'bankId':_0x5abb6b[_0x772446(0x19f)],'settled':_0x5abb6b[_0x772446(0x169)],'settlementDate':_0x5abb6b[_0x772446(0x16e)],'remitterName':_0x5abb6b['Remitter']?.['Name'],'remitterIban':_0x5abb6b[_0x772446(0x198)]?.[_0x772446(0x194)],'bankTransactionId':_0x5abb6b[_0x772446(0x180)]}};}['verifyWebhookSignature'](_0x52ea04,_0xe0c515){const _0x3c66e8=a53_0x4efadc;return console[_0x3c66e8(0x17b)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0xe0c515,'paymentId':_0x52ea04[_0x3c66e8(0x176)],'merchantPaymentId':_0x52ea04[_0x3c66e8(0x161)]}),!![];}}exports[a53_0x4efadc(0x150)]=NodaService;