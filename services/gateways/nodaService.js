'use strict';function a71_0x2e0c(_0x479b09,_0x42824a){_0x479b09=_0x479b09-0x1a8;const _0x5ad112=a71_0x5ad1();let _0x2e0ccd=_0x5ad112[_0x479b09];return _0x2e0ccd;}const a71_0x508fdf=a71_0x2e0c;function a71_0x5ad1(){const _0x3bac26=['1031610ZQraCQ','Noda\x20webhook\x20signature\x20verification:','message','expired','fromEntries','===\x20NODA\x20SUCCESS\x20===','done','json','Response\x20Body:','toUpperCase','failed','POST','error','JSON\x20Parse\x20Error:\x20','Amount','290130BLejyO','Noda\x20API\x20error:\x20','headers','Business\x20Error:\x20','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','parse','HTTP\x20Status:','56682wNLvbA','24GrWFtd','Noda\x20payment\x20verification\x20error:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','83815iNmaEC','Order\x20ID\x20Format:','apiUrl','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','PaymentId','PENDING','createPaymentLink','verifyPayment','Method','log','SettlementDate','Status:','processWebhook','logWhiteDomainError','6070950CwiKBY','Payment\x20System/1.0','/payment-links/','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20ERROR\x20===','GET','PAID','https://tesoft.uk/gateway/noda/','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Headers:','statusCode','Response\x20data:','application/json','verifyWebhookSignature','__esModule','active','rejected','MerchantPaymentId','text','Short\x20Link:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','noda','Failed\x20to\x20verify\x20Noda\x20payment:\x20','completed','59635YdCzhb','isActive','expiryDate','NodaService','Processing\x20Noda\x20webhook:','HTTP\x20','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','stringify','Unknown\x20error','qrCodeLink','892346MIBpye','defineProperty','shortLink','Settled','Request\x20Body\x20(Direct\x20JSON):','URL:','toLowerCase','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Iban','pending','Unknown\x20error\x20from\x20Noda\x20API','Missing\x20id\x20or\x20shortLink\x20in\x20response','Raw\x20Response\x20Body:','Response\x20Time:','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','cancelled','36zBlnfV','===\x20NODA\x20SERVICE\x20ERROR\x20===','logWhiteDomainResponse','===\x20PARSED\x20NODA\x20RESPONSE\x20===','status','statusText','success','BankTransactionId','Name','../loggerService','Parsed\x20Result:','/payment-links','timeout','shortLinkUrls','now','Remitter','(8digits-8digits\x20format)','created','processing','Payment\x20Link\x20ID:','entries','QR\x20Code\x20Link:','loggerService','(8digits-8digits\x20format\x20for\x20Noda)','HTTP\x20error!\x20status:\x20','Failed\x20to\x20parse\x20JSON\x20response:','FAILED','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Currency','Order\x20ID\x20Used:','amount','logWhiteDomainRequest','in_progress','paid','Status\x20Text:','Error\x20Message:','successful'];a71_0x5ad1=function(){return _0x3bac26;};return a71_0x5ad1();}(function(_0x3e1980,_0xa65a7){const _0x37abc8=a71_0x2e0c,_0x325d80=_0x3e1980();while(!![]){try{const _0x4cb753=-parseInt(_0x37abc8(0x1f6))/0x1+parseInt(_0x37abc8(0x1c5))/0x2+-parseInt(_0x37abc8(0x1b6))/0x3+parseInt(_0x37abc8(0x211))/0x4*(parseInt(_0x37abc8(0x1d0))/0x5)+parseInt(_0x37abc8(0x1cc))/0x6+-parseInt(_0x37abc8(0x200))/0x7*(parseInt(_0x37abc8(0x1cd))/0x8)+parseInt(_0x37abc8(0x1de))/0x9;if(_0x4cb753===_0xa65a7)break;else _0x325d80['push'](_0x325d80['shift']());}catch(_0x5b876f){_0x325d80['push'](_0x325d80['shift']());}}}(a71_0x5ad1,0x2f5c6));Object[a71_0x508fdf(0x201)](exports,a71_0x508fdf(0x1ec),{'value':!![]}),exports[a71_0x508fdf(0x1f9)]=void 0x0;const loggerService_1=require(a71_0x508fdf(0x21a));class NodaService{constructor(){const _0x4061b6=a71_0x508fdf;this['apiUrl']=_0x4061b6(0x1e5),console['log'](_0x4061b6(0x1fc));}async[a71_0x508fdf(0x1d6)](_0x209664){const _0x711a7a=a71_0x508fdf,{orderId:_0x564377,name:_0x4e1a3a,paymentDescription:_0x4fbf02,amount:_0x41adc9,currency:_0x116256,webhookUrl:_0x225651,returnUrl:_0x3ec761,expiryDate:_0x200b10}=_0x209664,_0x42142e=_0x116256[_0x711a7a(0x1bf)](),_0x51e5a8='https://tesoft.uk/gateway/noda/webhook/',_0x430d2c='https://tesoft.uk/gateway/pending.php?id='+_0x564377,_0x4f5354={'name':_0x4e1a3a,'paymentDescription':_0x4fbf02,'amount':_0x41adc9,'currency':_0x42142e,'paymentId':_0x564377,'webhookUrl':_0x51e5a8,'returnUrl':_0x430d2c};_0x200b10&&(_0x4f5354[_0x711a7a(0x1f8)]=_0x200b10);const _0x58fcf9=Date[_0x711a7a(0x21f)]();try{console[_0x711a7a(0x1d9)](_0x711a7a(0x1ac)),console[_0x711a7a(0x1d9)](_0x711a7a(0x205),this[_0x711a7a(0x1d2)]),console[_0x711a7a(0x1d9)](_0x711a7a(0x204),JSON[_0x711a7a(0x1fd)](_0x4f5354,null,0x2)),console['log'](_0x711a7a(0x1d1),_0x564377,_0x711a7a(0x1a8)),console[_0x711a7a(0x1d9)](_0x711a7a(0x208),_0x430d2c),loggerService_1['loggerService'][_0x711a7a(0x1b0)](_0x711a7a(0x1f3),_0x711a7a(0x21c),'POST',_0x4f5354);const _0x41ea72=await fetch(this['apiUrl'],{'method':_0x711a7a(0x1c1),'headers':{'Content-Type':_0x711a7a(0x1ea),'Accept':_0x711a7a(0x1ea),'User-Agent':_0x711a7a(0x1df)},'body':JSON[_0x711a7a(0x1fd)](_0x4f5354)}),_0xb1b729=Date[_0x711a7a(0x21f)]()-_0x58fcf9;console[_0x711a7a(0x1d9)](_0x711a7a(0x1e6)),console[_0x711a7a(0x1d9)](_0x711a7a(0x1db),_0x41ea72[_0x711a7a(0x215)]),console[_0x711a7a(0x1d9)](_0x711a7a(0x1b3),_0x41ea72[_0x711a7a(0x216)]),console[_0x711a7a(0x1d9)](_0x711a7a(0x1e7),Object[_0x711a7a(0x1ba)](_0x41ea72[_0x711a7a(0x1c7)][_0x711a7a(0x225)]())),console['log'](_0x711a7a(0x20e),_0xb1b729+'ms');const _0x29c258=await _0x41ea72[_0x711a7a(0x1f0)]();console[_0x711a7a(0x1d9)](_0x711a7a(0x20d),_0x29c258);if(!_0x41ea72['ok']){console[_0x711a7a(0x1c2)](_0x711a7a(0x1e2)),console[_0x711a7a(0x1c2)](_0x711a7a(0x1cb),_0x41ea72[_0x711a7a(0x215)]),console[_0x711a7a(0x1c2)](_0x711a7a(0x1be),_0x29c258),loggerService_1[_0x711a7a(0x227)][_0x711a7a(0x213)](_0x711a7a(0x1f3),_0x711a7a(0x21c),_0x41ea72[_0x711a7a(0x215)],_0x29c258,_0xb1b729),loggerService_1['loggerService'][_0x711a7a(0x1dd)](_0x711a7a(0x1f3),_0x711a7a(0x21c),_0x711a7a(0x1fb)+_0x41ea72[_0x711a7a(0x215)]+':\x20'+_0x29c258);if(_0x41ea72[_0x711a7a(0x215)]===0x190)throw new Error(_0x711a7a(0x1c9));else{if(_0x41ea72[_0x711a7a(0x215)]===0x1f4)throw new Error(_0x711a7a(0x1cf));}throw new Error(_0x711a7a(0x1a9)+_0x41ea72[_0x711a7a(0x215)]+',\x20body:\x20'+_0x29c258);}let _0x5ab8f0;try{_0x5ab8f0=JSON[_0x711a7a(0x1ca)](_0x29c258);}catch(_0x5af084){console['error'](_0x711a7a(0x1aa),_0x5af084),loggerService_1[_0x711a7a(0x227)][_0x711a7a(0x1dd)](_0x711a7a(0x1f3),_0x711a7a(0x21c),_0x711a7a(0x1c3)+_0x5af084);throw new Error(_0x711a7a(0x1d3)+_0x29c258);}console['log'](_0x711a7a(0x214)),console[_0x711a7a(0x1d9)](_0x711a7a(0x21b),JSON['stringify'](_0x5ab8f0,null,0x2)),loggerService_1[_0x711a7a(0x227)][_0x711a7a(0x213)]('noda','/payment-links',_0x41ea72['status'],_0x5ab8f0,_0xb1b729);if(_0x5ab8f0[_0x711a7a(0x1c2)]||_0x5ab8f0[_0x711a7a(0x1e8)]){const _0xa8e30b=_0x5ab8f0[_0x711a7a(0x1b8)]||_0x5ab8f0[_0x711a7a(0x1c2)]||_0x711a7a(0x20b);console[_0x711a7a(0x1c2)](_0x711a7a(0x20f)),console['error'](_0x711a7a(0x1b4),_0xa8e30b),console['error']('Status\x20Code:',_0x5ab8f0[_0x711a7a(0x1e8)]),loggerService_1['loggerService'][_0x711a7a(0x1dd)](_0x711a7a(0x1f3),_0x711a7a(0x21c),_0x711a7a(0x1c8)+_0xa8e30b);throw new Error(_0x711a7a(0x1c6)+_0xa8e30b);}if(!_0x5ab8f0['id']||!_0x5ab8f0[_0x711a7a(0x21e)]?.[_0x711a7a(0x202)]){console[_0x711a7a(0x1c2)](_0x711a7a(0x207)),console[_0x711a7a(0x1c2)](_0x711a7a(0x20c)),console['error'](_0x711a7a(0x1e9),_0x5ab8f0),loggerService_1[_0x711a7a(0x227)][_0x711a7a(0x1dd)](_0x711a7a(0x1f3),_0x711a7a(0x21c),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x711a7a(0x1e1));}return console[_0x711a7a(0x1d9)](_0x711a7a(0x1bb)),console[_0x711a7a(0x1d9)](_0x711a7a(0x224),_0x5ab8f0['id']),console[_0x711a7a(0x1d9)](_0x711a7a(0x1f1),_0x5ab8f0[_0x711a7a(0x21e)]['shortLink']),console[_0x711a7a(0x1d9)](_0x711a7a(0x226),_0x5ab8f0[_0x711a7a(0x21e)][_0x711a7a(0x1ff)]||'Not\x20provided'),console[_0x711a7a(0x1d9)](_0x711a7a(0x1ae),_0x564377,_0x711a7a(0x221)),console[_0x711a7a(0x1d9)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x430d2c),{'gateway_payment_id':_0x5ab8f0['id'],'payment_url':_0x5ab8f0['shortLinkUrls']['shortLink'],'qr_code_url':_0x5ab8f0['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x5ab8f0[_0x711a7a(0x1f8)]};}catch(_0x31af7e){console[_0x711a7a(0x1c2)](_0x711a7a(0x212)),console[_0x711a7a(0x1c2)]('Error\x20details:',_0x31af7e),loggerService_1[_0x711a7a(0x227)][_0x711a7a(0x1dd)]('noda',_0x711a7a(0x21c),_0x31af7e);if(_0x31af7e instanceof Error){console[_0x711a7a(0x1c2)]('Error\x20message:',_0x31af7e[_0x711a7a(0x1b8)]),console[_0x711a7a(0x1c2)]('Error\x20stack:',_0x31af7e['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x31af7e[_0x711a7a(0x1b8)]);}throw new Error(_0x711a7a(0x1f2));}}async[a71_0x508fdf(0x1d7)](_0x1a8b94){const _0x24bdbb=a71_0x508fdf,_0x14ac56=Date[_0x24bdbb(0x21f)]();try{loggerService_1[_0x24bdbb(0x227)][_0x24bdbb(0x1b0)](_0x24bdbb(0x1f3),_0x24bdbb(0x1e0)+_0x1a8b94,_0x24bdbb(0x1e3),{});const _0x517191=await fetch(this['apiUrl']+'/'+_0x1a8b94,{'method':_0x24bdbb(0x1e3),'headers':{'Content-Type':_0x24bdbb(0x1ea),'User-Agent':_0x24bdbb(0x1df)}}),_0x2ea0ae=Date[_0x24bdbb(0x21f)]()-_0x14ac56;if(!_0x517191['ok']){const _0x33e272=await _0x517191[_0x24bdbb(0x1f0)]();loggerService_1[_0x24bdbb(0x227)][_0x24bdbb(0x213)]('noda',_0x24bdbb(0x1e0)+_0x1a8b94,_0x517191[_0x24bdbb(0x215)],_0x33e272,_0x2ea0ae);throw new Error(_0x24bdbb(0x1a9)+_0x517191['status']);}const _0x17d677=await _0x517191[_0x24bdbb(0x1bd)]();loggerService_1[_0x24bdbb(0x227)][_0x24bdbb(0x213)](_0x24bdbb(0x1f3),'/payment-links/'+_0x1a8b94,_0x517191[_0x24bdbb(0x215)],_0x17d677,_0x2ea0ae);if(_0x17d677[_0x24bdbb(0x1c2)]||_0x17d677['statusCode']){loggerService_1[_0x24bdbb(0x227)][_0x24bdbb(0x1dd)]('noda',_0x24bdbb(0x1e0)+_0x1a8b94,'Noda\x20API\x20error:\x20'+(_0x17d677[_0x24bdbb(0x1b8)]||_0x17d677[_0x24bdbb(0x1c2)]||_0x24bdbb(0x1fe)));throw new Error(_0x24bdbb(0x1c6)+(_0x17d677[_0x24bdbb(0x1b8)]||_0x17d677[_0x24bdbb(0x1c2)]||_0x24bdbb(0x1fe)));}let _0x3aa586=_0x24bdbb(0x1d5);if(_0x17d677['isActive']===![]){if(_0x17d677[_0x24bdbb(0x1f8)]){const _0x313d0a=new Date(_0x17d677[_0x24bdbb(0x1f8)]),_0x425c9e=new Date();_0x313d0a<_0x425c9e?_0x3aa586='EXPIRED':_0x3aa586=_0x24bdbb(0x1ab);}else _0x3aa586=_0x24bdbb(0x1ab);}else _0x3aa586=_0x24bdbb(0x1d5);return{'status':_0x3aa586,'amount':_0x17d677[_0x24bdbb(0x1af)],'currency':_0x17d677['currency'],'isActive':_0x17d677[_0x24bdbb(0x1f7)]};}catch(_0x2a2d5d){console['error'](_0x24bdbb(0x1ce),_0x2a2d5d),loggerService_1[_0x24bdbb(0x227)][_0x24bdbb(0x1dd)](_0x24bdbb(0x1f3),_0x24bdbb(0x1e0)+_0x1a8b94,_0x2a2d5d);throw new Error(_0x24bdbb(0x1f4)+(_0x2a2d5d instanceof Error?_0x2a2d5d['message']:_0x24bdbb(0x1fe)));}}async[a71_0x508fdf(0x1dc)](_0x5099ce){const _0x3a14f9=a71_0x508fdf;console[_0x3a14f9(0x1d9)](_0x3a14f9(0x1fa),_0x5099ce);let _0x155cbe=_0x3a14f9(0x1d5);switch(_0x5099ce['Status']?.[_0x3a14f9(0x206)]()){case _0x3a14f9(0x1bc):case _0x3a14f9(0x1f5):case _0x3a14f9(0x1b2):case _0x3a14f9(0x217):case _0x3a14f9(0x1b5):_0x5099ce[_0x3a14f9(0x203)]==='Yes'?_0x155cbe=_0x3a14f9(0x1e4):_0x155cbe=_0x3a14f9(0x1d5);break;case _0x3a14f9(0x210):case'canceled':case _0x3a14f9(0x1c0):case _0x3a14f9(0x1c2):case _0x3a14f9(0x1ee):_0x155cbe=_0x3a14f9(0x1ab);break;case _0x3a14f9(0x1b9):case _0x3a14f9(0x21d):_0x155cbe='EXPIRED';break;case _0x3a14f9(0x20a):case _0x3a14f9(0x222):case _0x3a14f9(0x1ed):case _0x3a14f9(0x223):case _0x3a14f9(0x1b1):default:_0x155cbe='PENDING';break;}return{'paymentId':_0x5099ce[_0x3a14f9(0x1ef)]||_0x5099ce[_0x3a14f9(0x1d4)],'status':_0x155cbe,'amount':_0x5099ce[_0x3a14f9(0x1c4)],'currency':_0x5099ce[_0x3a14f9(0x1ad)],'additionalInfo':{'method':_0x5099ce[_0x3a14f9(0x1d8)],'bankId':_0x5099ce['BankId'],'settled':_0x5099ce[_0x3a14f9(0x203)],'settlementDate':_0x5099ce[_0x3a14f9(0x1da)],'remitterName':_0x5099ce[_0x3a14f9(0x220)]?.[_0x3a14f9(0x219)],'remitterIban':_0x5099ce[_0x3a14f9(0x220)]?.[_0x3a14f9(0x209)],'bankTransactionId':_0x5099ce[_0x3a14f9(0x218)]}};}[a71_0x508fdf(0x1eb)](_0x40514d,_0xa42182){const _0x4ca32e=a71_0x508fdf;return console[_0x4ca32e(0x1d9)](_0x4ca32e(0x1b7),{'receivedSignature':_0xa42182,'paymentId':_0x40514d[_0x4ca32e(0x1d4)],'merchantPaymentId':_0x40514d[_0x4ca32e(0x1ef)]}),!![];}}exports[a71_0x508fdf(0x1f9)]=NodaService;