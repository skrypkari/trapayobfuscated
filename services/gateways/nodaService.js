'use strict';const a40_0x261c5c=a40_0x29f0;function a40_0x4eb1(){const _0x4efb3c=['logWhiteDomainResponse','apiUrl','Remitter','now','expiryDate','Payment\x20Link\x20ID:','3892HktYCh','Error\x20message:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Short\x20Link:','Error\x20stack:','status','MerchantPaymentId','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Order\x20ID\x20Used:','stack','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Failed\x20to\x20verify\x20Noda\x20payment:\x20','shortLinkUrls','25846bSZrAm','toLowerCase','TesSoft\x20Payment\x20System/1.0','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','text','SettlementDate','===\x20NODA\x20SUCCESS\x20===','timeout','Not\x20provided','toUpperCase','pending','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','log','Error\x20details:','Status','processWebhook','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','noda','fromEntries','/payment-links/','paid','BankTransactionId','logWhiteDomainError','===\x20NODA\x20API\x20ERROR\x20===','Iban','logWhiteDomainRequest','Unknown\x20error','Unknown\x20error\x20from\x20Noda\x20API','Method','(8digits-8digits\x20format)','https://tesoft.uk/gateway/noda/','expired','===\x20NODA\x20SERVICE\x20ERROR\x20===','application/json','Settled','162081sXwcKU','EXPIRED','cancelled','qrCodeLink','Status\x20Text:','failed','Missing\x20id\x20or\x20shortLink\x20in\x20response','Response\x20Body:','error','done','Processing\x20Noda\x20webhook:','created','statusCode','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Order\x20ID\x20Format:','defineProperty','517212ENuvwK','QR\x20Code\x20Link:','GET','HTTP\x20error!\x20status:\x20','currency','message','356585EAxYfE','createPaymentLink','__esModule','json','Response\x20data:','entries','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Error\x20Message:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Currency','NodaService','isActive','headers','1355GUoZla','../loggerService',',\x20body:\x20','5054462yGKcqg','Response\x20Time:','canceled','Status\x20Code:','Name','rejected','POST','processing','https://tesoft.uk/gateway/success.php?id=','PAID','PENDING','PaymentId','6qzWsKV','Noda\x20API\x20error:\x20','URL:','/payment-links','Business\x20Error:\x20','BankId','parse','stringify','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','active','loggerService','FAILED','shortLink','939280pqJlzr'];a40_0x4eb1=function(){return _0x4efb3c;};return a40_0x4eb1();}function a40_0x29f0(_0x3dbaaa,_0x36cfc9){const _0x4eb1ec=a40_0x4eb1();return a40_0x29f0=function(_0x29f0d5,_0x4042b1){_0x29f0d5=_0x29f0d5-0x1bc;let _0x3b5a50=_0x4eb1ec[_0x29f0d5];return _0x3b5a50;},a40_0x29f0(_0x3dbaaa,_0x36cfc9);}(function(_0x5577d5,_0x516356){const _0xf7325a=a40_0x29f0,_0x481e4c=_0x5577d5();while(!![]){try{const _0x2c8e8b=parseInt(_0xf7325a(0x1f7))/0x1+parseInt(_0xf7325a(0x1be))/0x2*(-parseInt(_0xf7325a(0x213))/0x3)+-parseInt(_0xf7325a(0x227))/0x4*(parseInt(_0xf7325a(0x204))/0x5)+-parseInt(_0xf7325a(0x1f1))/0x6+parseInt(_0xf7325a(0x207))/0x7+parseInt(_0xf7325a(0x220))/0x8+-parseInt(_0xf7325a(0x1e1))/0x9;if(_0x2c8e8b===_0x516356)break;else _0x481e4c['push'](_0x481e4c['shift']());}catch(_0x593933){_0x481e4c['push'](_0x481e4c['shift']());}}}(a40_0x4eb1,0xc3e11));Object[a40_0x261c5c(0x1f0)](exports,a40_0x261c5c(0x1f9),{'value':!![]}),exports[a40_0x261c5c(0x201)]=void 0x0;const loggerService_1=require(a40_0x261c5c(0x205));class NodaService{constructor(){const _0x410512=a40_0x261c5c;this['apiUrl']=_0x410512(0x1dc),console[_0x410512(0x1ca)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a40_0x261c5c(0x1f8)](_0x5a44a4){const _0x46e866=a40_0x261c5c,{orderId:_0x190f0a,name:_0x40c1a0,paymentDescription:_0x444b4f,amount:_0x4c1680,currency:_0x46e9ac,webhookUrl:_0x696cf5,returnUrl:_0x16e0be,expiryDate:_0xbb75df}=_0x5a44a4,_0x1479dd=_0x46e9ac[_0x46e866(0x1c7)](),_0xc14a5c='https://tesoft.uk/gateway/noda/webhook/',_0x206595=_0x46e866(0x20f)+_0x190f0a,_0x1ad9a3={'name':_0x40c1a0,'paymentDescription':_0x444b4f,'amount':_0x4c1680,'currency':_0x1479dd,'paymentId':_0x190f0a,'webhookUrl':_0xc14a5c,'returnUrl':_0x206595};_0xbb75df&&(_0x1ad9a3[_0x46e866(0x225)]=_0xbb75df);const _0x48f9f5=Date['now']();try{console['log']('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console[_0x46e866(0x1ca)](_0x46e866(0x215),this[_0x46e866(0x222)]),console[_0x46e866(0x1ca)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x46e866(0x21a)](_0x1ad9a3,null,0x2)),console[_0x46e866(0x1ca)](_0x46e866(0x1ef),_0x190f0a,'(8digits-8digits\x20format\x20for\x20Noda)'),loggerService_1['loggerService'][_0x46e866(0x1d7)](_0x46e866(0x1cf),_0x46e866(0x216),_0x46e866(0x20d),_0x1ad9a3);const _0x29b612=await fetch(this['apiUrl'],{'method':_0x46e866(0x20d),'headers':{'Content-Type':'application/json','Accept':_0x46e866(0x1df),'User-Agent':_0x46e866(0x1c0)},'body':JSON[_0x46e866(0x21a)](_0x1ad9a3)}),_0x4cff70=Date['now']()-_0x48f9f5;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x46e866(0x1ca)]('Status:',_0x29b612[_0x46e866(0x22c)]),console[_0x46e866(0x1ca)](_0x46e866(0x1e5),_0x29b612['statusText']),console[_0x46e866(0x1ca)]('Headers:',Object[_0x46e866(0x1d0)](_0x29b612[_0x46e866(0x203)][_0x46e866(0x1fc)]())),console[_0x46e866(0x1ca)](_0x46e866(0x208),_0x4cff70+'ms');const _0x1a4f87=await _0x29b612[_0x46e866(0x1c2)]();console['log']('Raw\x20Response\x20Body:',_0x1a4f87);if(!_0x29b612['ok']){console['error'](_0x46e866(0x1d5)),console['error']('HTTP\x20Status:',_0x29b612[_0x46e866(0x22c)]),console[_0x46e866(0x1e9)](_0x46e866(0x1e8),_0x1a4f87),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x46e866(0x1cf),_0x46e866(0x216),_0x29b612[_0x46e866(0x22c)],_0x1a4f87,_0x4cff70),loggerService_1[_0x46e866(0x21d)][_0x46e866(0x1d4)]('noda',_0x46e866(0x216),'HTTP\x20'+_0x29b612[_0x46e866(0x22c)]+':\x20'+_0x1a4f87);if(_0x29b612[_0x46e866(0x22c)]===0x190)throw new Error(_0x46e866(0x231));else{if(_0x29b612['status']===0x1f4)throw new Error(_0x46e866(0x22e));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x29b612[_0x46e866(0x22c)]+_0x46e866(0x206)+_0x1a4f87);}let _0x3403b6;try{_0x3403b6=JSON[_0x46e866(0x219)](_0x1a4f87);}catch(_0x1b8bfc){console[_0x46e866(0x1e9)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x1b8bfc),loggerService_1[_0x46e866(0x21d)]['logWhiteDomainError'](_0x46e866(0x1cf),'/payment-links','JSON\x20Parse\x20Error:\x20'+_0x1b8bfc);throw new Error(_0x46e866(0x229)+_0x1a4f87);}console[_0x46e866(0x1ca)](_0x46e866(0x1fd)),console[_0x46e866(0x1ca)]('Parsed\x20Result:',JSON[_0x46e866(0x21a)](_0x3403b6,null,0x2)),loggerService_1['loggerService'][_0x46e866(0x221)](_0x46e866(0x1cf),'/payment-links',_0x29b612[_0x46e866(0x22c)],_0x3403b6,_0x4cff70);if(_0x3403b6['error']||_0x3403b6[_0x46e866(0x1ed)]){const _0x40a524=_0x3403b6[_0x46e866(0x1f6)]||_0x3403b6[_0x46e866(0x1e9)]||_0x46e866(0x1d9);console[_0x46e866(0x1e9)](_0x46e866(0x1c9)),console[_0x46e866(0x1e9)](_0x46e866(0x1fe),_0x40a524),console[_0x46e866(0x1e9)](_0x46e866(0x20a),_0x3403b6['statusCode']),loggerService_1['loggerService']['logWhiteDomainError'](_0x46e866(0x1cf),_0x46e866(0x216),_0x46e866(0x217)+_0x40a524);throw new Error(_0x46e866(0x214)+_0x40a524);}if(!_0x3403b6['id']||!_0x3403b6[_0x46e866(0x1bd)]?.[_0x46e866(0x21f)]){console[_0x46e866(0x1e9)](_0x46e866(0x1c1)),console[_0x46e866(0x1e9)](_0x46e866(0x1e7)),console['error'](_0x46e866(0x1fb),_0x3403b6),loggerService_1[_0x46e866(0x21d)]['logWhiteDomainError']('noda','/payment-links',_0x46e866(0x1ce));throw new Error(_0x46e866(0x21b));}return console['log'](_0x46e866(0x1c4)),console[_0x46e866(0x1ca)](_0x46e866(0x226),_0x3403b6['id']),console['log'](_0x46e866(0x22a),_0x3403b6[_0x46e866(0x1bd)][_0x46e866(0x21f)]),console[_0x46e866(0x1ca)](_0x46e866(0x1f2),_0x3403b6['shortLinkUrls'][_0x46e866(0x1e4)]||_0x46e866(0x1c6)),console['log'](_0x46e866(0x22f),_0x190f0a,_0x46e866(0x1db)),{'gateway_payment_id':_0x3403b6['id'],'payment_url':_0x3403b6[_0x46e866(0x1bd)]['shortLink'],'qr_code_url':_0x3403b6[_0x46e866(0x1bd)][_0x46e866(0x1e4)],'expiry_date':_0x3403b6[_0x46e866(0x225)]};}catch(_0x58fefa){console[_0x46e866(0x1e9)](_0x46e866(0x1de)),console[_0x46e866(0x1e9)](_0x46e866(0x1cb),_0x58fefa),loggerService_1[_0x46e866(0x21d)][_0x46e866(0x1d4)](_0x46e866(0x1cf),'/payment-links',_0x58fefa);if(_0x58fefa instanceof Error){console[_0x46e866(0x1e9)](_0x46e866(0x228),_0x58fefa[_0x46e866(0x1f6)]),console[_0x46e866(0x1e9)](_0x46e866(0x22b),_0x58fefa[_0x46e866(0x230)]);throw new Error(_0x46e866(0x1ff)+_0x58fefa[_0x46e866(0x1f6)]);}throw new Error(_0x46e866(0x1ee));}}async['verifyPayment'](_0x1003e1){const _0x1ca6de=a40_0x261c5c,_0x5952df=Date[_0x1ca6de(0x224)]();try{loggerService_1['loggerService'][_0x1ca6de(0x1d7)](_0x1ca6de(0x1cf),_0x1ca6de(0x1d1)+_0x1003e1,_0x1ca6de(0x1f3),{});const _0x365ffa=await fetch(this[_0x1ca6de(0x222)]+'/'+_0x1003e1,{'method':_0x1ca6de(0x1f3),'headers':{'Content-Type':_0x1ca6de(0x1df),'User-Agent':_0x1ca6de(0x1c0)}}),_0x3d326e=Date[_0x1ca6de(0x224)]()-_0x5952df;if(!_0x365ffa['ok']){const _0x27a7fb=await _0x365ffa[_0x1ca6de(0x1c2)]();loggerService_1[_0x1ca6de(0x21d)][_0x1ca6de(0x221)](_0x1ca6de(0x1cf),_0x1ca6de(0x1d1)+_0x1003e1,_0x365ffa[_0x1ca6de(0x22c)],_0x27a7fb,_0x3d326e);throw new Error(_0x1ca6de(0x1f4)+_0x365ffa[_0x1ca6de(0x22c)]);}const _0x1b9ce5=await _0x365ffa[_0x1ca6de(0x1fa)]();loggerService_1['loggerService'][_0x1ca6de(0x221)](_0x1ca6de(0x1cf),_0x1ca6de(0x1d1)+_0x1003e1,_0x365ffa[_0x1ca6de(0x22c)],_0x1b9ce5,_0x3d326e);if(_0x1b9ce5[_0x1ca6de(0x1e9)]||_0x1b9ce5[_0x1ca6de(0x1ed)]){loggerService_1[_0x1ca6de(0x21d)]['logWhiteDomainError'](_0x1ca6de(0x1cf),_0x1ca6de(0x1d1)+_0x1003e1,'Noda\x20API\x20error:\x20'+(_0x1b9ce5[_0x1ca6de(0x1f6)]||_0x1b9ce5[_0x1ca6de(0x1e9)]||_0x1ca6de(0x1d8)));throw new Error(_0x1ca6de(0x214)+(_0x1b9ce5[_0x1ca6de(0x1f6)]||_0x1b9ce5['error']||_0x1ca6de(0x1d8)));}let _0xbce6cb=_0x1ca6de(0x211);if(_0x1b9ce5[_0x1ca6de(0x202)]===![]){if(_0x1b9ce5[_0x1ca6de(0x225)]){const _0x1c014e=new Date(_0x1b9ce5[_0x1ca6de(0x225)]),_0x10e6f9=new Date();_0x1c014e<_0x10e6f9?_0xbce6cb=_0x1ca6de(0x1e2):_0xbce6cb=_0x1ca6de(0x21e);}else _0xbce6cb='FAILED';}else _0xbce6cb=_0x1ca6de(0x211);return{'status':_0xbce6cb,'amount':_0x1b9ce5['amount'],'currency':_0x1b9ce5[_0x1ca6de(0x1f5)],'isActive':_0x1b9ce5[_0x1ca6de(0x202)]};}catch(_0x184988){console[_0x1ca6de(0x1e9)]('Noda\x20payment\x20verification\x20error:',_0x184988),loggerService_1[_0x1ca6de(0x21d)]['logWhiteDomainError'](_0x1ca6de(0x1cf),'/payment-links/'+_0x1003e1,_0x184988);throw new Error(_0x1ca6de(0x1bc)+(_0x184988 instanceof Error?_0x184988[_0x1ca6de(0x1f6)]:'Unknown\x20error'));}}async[a40_0x261c5c(0x1cd)](_0x4ff6e9){const _0x421ad2=a40_0x261c5c;console['log'](_0x421ad2(0x1eb),_0x4ff6e9);let _0x2483f3=_0x421ad2(0x211);switch(_0x4ff6e9[_0x421ad2(0x1cc)]?.[_0x421ad2(0x1bf)]()){case _0x421ad2(0x1ea):case'completed':case _0x421ad2(0x1d2):case'success':case'successful':_0x4ff6e9[_0x421ad2(0x1e0)]==='Yes'?_0x2483f3=_0x421ad2(0x210):_0x2483f3=_0x421ad2(0x211);break;case _0x421ad2(0x1e3):case _0x421ad2(0x209):case _0x421ad2(0x1e6):case _0x421ad2(0x1e9):case _0x421ad2(0x20c):_0x2483f3=_0x421ad2(0x21e);break;case _0x421ad2(0x1dd):case _0x421ad2(0x1c5):_0x2483f3=_0x421ad2(0x1e2);break;case _0x421ad2(0x1c8):case _0x421ad2(0x1ec):case _0x421ad2(0x21c):case _0x421ad2(0x20e):case'in_progress':default:_0x2483f3=_0x421ad2(0x211);break;}return{'paymentId':_0x4ff6e9[_0x421ad2(0x22d)]||_0x4ff6e9[_0x421ad2(0x212)],'status':_0x2483f3,'amount':_0x4ff6e9['Amount'],'currency':_0x4ff6e9[_0x421ad2(0x200)],'additionalInfo':{'method':_0x4ff6e9[_0x421ad2(0x1da)],'bankId':_0x4ff6e9[_0x421ad2(0x218)],'settled':_0x4ff6e9[_0x421ad2(0x1e0)],'settlementDate':_0x4ff6e9[_0x421ad2(0x1c3)],'remitterName':_0x4ff6e9[_0x421ad2(0x223)]?.[_0x421ad2(0x20b)],'remitterIban':_0x4ff6e9[_0x421ad2(0x223)]?.[_0x421ad2(0x1d6)],'bankTransactionId':_0x4ff6e9[_0x421ad2(0x1d3)]}};}['verifyWebhookSignature'](_0x5313db,_0x46d9a5){const _0x33ec78=a40_0x261c5c;return console[_0x33ec78(0x1ca)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x46d9a5,'paymentId':_0x5313db[_0x33ec78(0x212)],'merchantPaymentId':_0x5313db[_0x33ec78(0x22d)]}),!![];}}exports['NodaService']=NodaService;