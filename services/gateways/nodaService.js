'use strict';const a43_0x386341=a43_0x296f;(function(_0xdc698,_0x23c452){const _0x1374f5=a43_0x296f,_0x597798=_0xdc698();while(!![]){try{const _0x8bd994=parseInt(_0x1374f5(0x191))/0x1+parseInt(_0x1374f5(0x14f))/0x2*(parseInt(_0x1374f5(0x18a))/0x3)+-parseInt(_0x1374f5(0x164))/0x4+-parseInt(_0x1374f5(0x162))/0x5+parseInt(_0x1374f5(0x172))/0x6*(-parseInt(_0x1374f5(0x169))/0x7)+-parseInt(_0x1374f5(0x14e))/0x8*(-parseInt(_0x1374f5(0x134))/0x9)+parseInt(_0x1374f5(0x150))/0xa;if(_0x8bd994===_0x23c452)break;else _0x597798['push'](_0x597798['shift']());}catch(_0xfe4396){_0x597798['push'](_0x597798['shift']());}}}(a43_0x4d9a,0xbbf34));function a43_0x296f(_0x1f9cd8,_0x347404){const _0x4d9ad4=a43_0x4d9a();return a43_0x296f=function(_0x296f5f,_0x449b03){_0x296f5f=_0x296f5f-0x130;let _0x2a938d=_0x4d9ad4[_0x296f5f];return _0x2a938d;},a43_0x296f(_0x1f9cd8,_0x347404);}Object[a43_0x386341(0x186)](exports,'__esModule',{'value':!![]}),exports[a43_0x386341(0x19f)]=void 0x0;const loggerService_1=require(a43_0x386341(0x14c));function a43_0x4d9a(){const _0x115a0e=['Short\x20Link:','toLowerCase','Status:','Missing\x20id\x20or\x20shortLink\x20in\x20response','stack','now','Remitter','Parsed\x20Result:','apiUrl','logWhiteDomainError','qrCodeLink','QR\x20Code\x20Link:','HTTP\x20Status:','NodaService','===\x20NODA\x20SERVICE\x20ERROR\x20===','BankTransactionId','in_progress','Response\x20data:','logWhiteDomainResponse','stringify','16857yHbGGE','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','verifyPayment','Unknown\x20error','noda','status','parse','Status\x20Text:','Noda\x20API\x20error:\x20','SettlementDate','Status','done','timeout','processing','/payment-links','Currency','Business\x20Error:\x20','createPaymentLink','error','TesSoft\x20Payment\x20System/1.0','Error\x20stack:','PaymentId','Noda\x20payment\x20verification\x20error:','EXPIRED','../loggerService','Settled','1320NnxrTG','2KFBwpU','15209840jfZMeF','shortLinkUrls','pending','BankId','POST','expiryDate','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','processWebhook','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Error\x20message:','Name','FAILED','Failed\x20to\x20verify\x20Noda\x20payment:\x20','HTTP\x20','/payment-links/','message','(8digits-8digits\x20format\x20for\x20Noda)','isActive','5395110jNPgoF','fromEntries','1607088XSKWxo','MerchantPaymentId','Iban','Unknown\x20error\x20from\x20Noda\x20API','PENDING','42nMwpWu','Request\x20Body\x20(Direct\x20JSON):','https://tesoft.uk/gateway/noda/webhook/','GET','Method','HTTP\x20error!\x20status:\x20','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Yes','Response\x20Body:','1132818YTCmrK','Not\x20provided','Order\x20ID\x20Used:','created','text','statusText','Processing\x20Noda\x20webhook:','application/json','completed','logWhiteDomainRequest','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20',',\x20body:\x20','canceled','failed','amount','log','Headers:','currency','paid','https://tesoft.uk/gateway/pending.php?id=','defineProperty','Payment\x20Link\x20ID:','cancelled','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','1003785NwoCLr','headers','loggerService','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Amount','===\x20NODA\x20API\x20ERROR\x20===','statusCode','1218832VVXagF'];a43_0x4d9a=function(){return _0x115a0e;};return a43_0x4d9a();}class NodaService{constructor(){const _0x50fd40=a43_0x386341;this[_0x50fd40(0x19a)]='https://tesoft.uk/gateway/noda/',console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a43_0x386341(0x145)](_0x9cfe6f){const _0x501a36=a43_0x386341,{orderId:_0x1c9d05,name:_0x8afb80,paymentDescription:_0x40c26a,amount:_0x5c08b0,currency:_0x480136,webhookUrl:_0x51c269,returnUrl:_0x230a16,expiryDate:_0x4e7c5f}=_0x9cfe6f,_0x45868d=_0x480136['toUpperCase'](),_0x589b1c=_0x501a36(0x16b),_0x595db5=_0x501a36(0x185)+_0x1c9d05,_0x2d4cdd={'name':_0x8afb80,'paymentDescription':_0x40c26a,'amount':_0x5c08b0,'currency':_0x45868d,'paymentId':_0x1c9d05,'webhookUrl':_0x589b1c,'returnUrl':_0x595db5};_0x4e7c5f&&(_0x2d4cdd[_0x501a36(0x155)]=_0x4e7c5f);const _0x1384fc=Date[_0x501a36(0x197)]();try{console['log'](_0x501a36(0x16f)),console[_0x501a36(0x181)]('URL:',this[_0x501a36(0x19a)]),console[_0x501a36(0x181)](_0x501a36(0x16a),JSON[_0x501a36(0x133)](_0x2d4cdd,null,0x2)),console['log']('Order\x20ID\x20Format:',_0x1c9d05,_0x501a36(0x160)),console['log']('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x595db5),loggerService_1[_0x501a36(0x18c)][_0x501a36(0x17b)](_0x501a36(0x138),_0x501a36(0x142),_0x501a36(0x154),_0x2d4cdd);const _0x3408b8=await fetch(this[_0x501a36(0x19a)],{'method':_0x501a36(0x154),'headers':{'Content-Type':_0x501a36(0x179),'Accept':'application/json','User-Agent':_0x501a36(0x147)},'body':JSON[_0x501a36(0x133)](_0x2d4cdd)}),_0x2eb845=Date['now']()-_0x1384fc;console[_0x501a36(0x181)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x501a36(0x181)](_0x501a36(0x194),_0x3408b8[_0x501a36(0x139)]),console[_0x501a36(0x181)](_0x501a36(0x13b),_0x3408b8[_0x501a36(0x177)]),console[_0x501a36(0x181)](_0x501a36(0x182),Object[_0x501a36(0x163)](_0x3408b8[_0x501a36(0x18b)]['entries']())),console[_0x501a36(0x181)]('Response\x20Time:',_0x2eb845+'ms');const _0x19bb88=await _0x3408b8[_0x501a36(0x176)]();console[_0x501a36(0x181)]('Raw\x20Response\x20Body:',_0x19bb88);if(!_0x3408b8['ok']){console[_0x501a36(0x146)](_0x501a36(0x18f)),console[_0x501a36(0x146)](_0x501a36(0x19e),_0x3408b8[_0x501a36(0x139)]),console[_0x501a36(0x146)](_0x501a36(0x171),_0x19bb88),loggerService_1[_0x501a36(0x18c)][_0x501a36(0x132)](_0x501a36(0x138),_0x501a36(0x142),_0x3408b8[_0x501a36(0x139)],_0x19bb88,_0x2eb845),loggerService_1[_0x501a36(0x18c)][_0x501a36(0x19b)](_0x501a36(0x138),'/payment-links',_0x501a36(0x15d)+_0x3408b8[_0x501a36(0x139)]+':\x20'+_0x19bb88);if(_0x3408b8[_0x501a36(0x139)]===0x190)throw new Error(_0x501a36(0x156));else{if(_0x3408b8[_0x501a36(0x139)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error('HTTP\x20error!\x20status:\x20'+_0x3408b8[_0x501a36(0x139)]+_0x501a36(0x17d)+_0x19bb88);}let _0x38aa57;try{_0x38aa57=JSON[_0x501a36(0x13a)](_0x19bb88);}catch(_0x3f5960){console[_0x501a36(0x146)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x3f5960),loggerService_1[_0x501a36(0x18c)][_0x501a36(0x19b)]('noda','/payment-links','JSON\x20Parse\x20Error:\x20'+_0x3f5960);throw new Error(_0x501a36(0x189)+_0x19bb88);}console['log'](_0x501a36(0x18d)),console[_0x501a36(0x181)](_0x501a36(0x199),JSON[_0x501a36(0x133)](_0x38aa57,null,0x2)),loggerService_1[_0x501a36(0x18c)]['logWhiteDomainResponse']('noda',_0x501a36(0x142),_0x3408b8[_0x501a36(0x139)],_0x38aa57,_0x2eb845);if(_0x38aa57['error']||_0x38aa57[_0x501a36(0x190)]){const _0x143188=_0x38aa57[_0x501a36(0x15f)]||_0x38aa57['error']||_0x501a36(0x167);console[_0x501a36(0x146)](_0x501a36(0x135)),console[_0x501a36(0x146)]('Error\x20Message:',_0x143188),console[_0x501a36(0x146)]('Status\x20Code:',_0x38aa57[_0x501a36(0x190)]),loggerService_1[_0x501a36(0x18c)][_0x501a36(0x19b)](_0x501a36(0x138),_0x501a36(0x142),_0x501a36(0x144)+_0x143188);throw new Error(_0x501a36(0x13c)+_0x143188);}if(!_0x38aa57['id']||!_0x38aa57[_0x501a36(0x151)]?.['shortLink']){console[_0x501a36(0x146)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x501a36(0x195)),console[_0x501a36(0x146)](_0x501a36(0x131),_0x38aa57),loggerService_1[_0x501a36(0x18c)]['logWhiteDomainError'](_0x501a36(0x138),_0x501a36(0x142),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x501a36(0x158));}return console[_0x501a36(0x181)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x501a36(0x181)](_0x501a36(0x187),_0x38aa57['id']),console[_0x501a36(0x181)](_0x501a36(0x192),_0x38aa57[_0x501a36(0x151)]['shortLink']),console[_0x501a36(0x181)](_0x501a36(0x19d),_0x38aa57[_0x501a36(0x151)][_0x501a36(0x19c)]||_0x501a36(0x173)),console[_0x501a36(0x181)](_0x501a36(0x174),_0x1c9d05,'(8digits-8digits\x20format)'),console[_0x501a36(0x181)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x595db5),{'gateway_payment_id':_0x38aa57['id'],'payment_url':_0x38aa57[_0x501a36(0x151)]['shortLink'],'qr_code_url':_0x38aa57['shortLinkUrls'][_0x501a36(0x19c)],'expiry_date':_0x38aa57[_0x501a36(0x155)]};}catch(_0x1348e7){console['error'](_0x501a36(0x1a0)),console[_0x501a36(0x146)]('Error\x20details:',_0x1348e7),loggerService_1[_0x501a36(0x18c)][_0x501a36(0x19b)](_0x501a36(0x138),_0x501a36(0x142),_0x1348e7);if(_0x1348e7 instanceof Error){console[_0x501a36(0x146)](_0x501a36(0x159),_0x1348e7[_0x501a36(0x15f)]),console['error'](_0x501a36(0x148),_0x1348e7[_0x501a36(0x196)]);throw new Error(_0x501a36(0x17c)+_0x1348e7[_0x501a36(0x15f)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x386341(0x136)](_0x23fe12){const _0x18c285=a43_0x386341,_0x540e8f=Date['now']();try{loggerService_1[_0x18c285(0x18c)][_0x18c285(0x17b)](_0x18c285(0x138),'/payment-links/'+_0x23fe12,'GET',{});const _0x560666=await fetch(this[_0x18c285(0x19a)]+'/'+_0x23fe12,{'method':_0x18c285(0x16c),'headers':{'Content-Type':_0x18c285(0x179),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x108211=Date[_0x18c285(0x197)]()-_0x540e8f;if(!_0x560666['ok']){const _0x383fbc=await _0x560666[_0x18c285(0x176)]();loggerService_1[_0x18c285(0x18c)][_0x18c285(0x132)](_0x18c285(0x138),_0x18c285(0x15e)+_0x23fe12,_0x560666[_0x18c285(0x139)],_0x383fbc,_0x108211);throw new Error(_0x18c285(0x16e)+_0x560666[_0x18c285(0x139)]);}const _0x5c5d9c=await _0x560666['json']();loggerService_1[_0x18c285(0x18c)]['logWhiteDomainResponse']('noda',_0x18c285(0x15e)+_0x23fe12,_0x560666[_0x18c285(0x139)],_0x5c5d9c,_0x108211);if(_0x5c5d9c[_0x18c285(0x146)]||_0x5c5d9c['statusCode']){loggerService_1['loggerService'][_0x18c285(0x19b)](_0x18c285(0x138),_0x18c285(0x15e)+_0x23fe12,_0x18c285(0x13c)+(_0x5c5d9c[_0x18c285(0x15f)]||_0x5c5d9c['error']||_0x18c285(0x137)));throw new Error('Noda\x20API\x20error:\x20'+(_0x5c5d9c[_0x18c285(0x15f)]||_0x5c5d9c[_0x18c285(0x146)]||_0x18c285(0x137)));}let _0x219159=_0x18c285(0x168);if(_0x5c5d9c[_0x18c285(0x161)]===![]){if(_0x5c5d9c[_0x18c285(0x155)]){const _0x8f8bfb=new Date(_0x5c5d9c[_0x18c285(0x155)]),_0x5b6c64=new Date();_0x8f8bfb<_0x5b6c64?_0x219159=_0x18c285(0x14b):_0x219159='FAILED';}else _0x219159='FAILED';}else _0x219159=_0x18c285(0x168);return{'status':_0x219159,'amount':_0x5c5d9c[_0x18c285(0x180)],'currency':_0x5c5d9c[_0x18c285(0x183)],'isActive':_0x5c5d9c[_0x18c285(0x161)]};}catch(_0x50831c){console[_0x18c285(0x146)](_0x18c285(0x14a),_0x50831c),loggerService_1[_0x18c285(0x18c)]['logWhiteDomainError'](_0x18c285(0x138),_0x18c285(0x15e)+_0x23fe12,_0x50831c);throw new Error(_0x18c285(0x15c)+(_0x50831c instanceof Error?_0x50831c['message']:_0x18c285(0x137)));}}async[a43_0x386341(0x157)](_0x909500){const _0x45df3a=a43_0x386341;console[_0x45df3a(0x181)](_0x45df3a(0x178),_0x909500);let _0x537cf8=_0x45df3a(0x168);switch(_0x909500[_0x45df3a(0x13e)]?.[_0x45df3a(0x193)]()){case _0x45df3a(0x13f):case _0x45df3a(0x17a):case _0x45df3a(0x184):case'success':case'successful':_0x909500[_0x45df3a(0x14d)]===_0x45df3a(0x170)?_0x537cf8='PAID':_0x537cf8=_0x45df3a(0x168);break;case _0x45df3a(0x188):case _0x45df3a(0x17e):case _0x45df3a(0x17f):case _0x45df3a(0x146):case'rejected':_0x537cf8=_0x45df3a(0x15b);break;case'expired':case _0x45df3a(0x140):_0x537cf8=_0x45df3a(0x14b);break;case _0x45df3a(0x152):case _0x45df3a(0x175):case'active':case _0x45df3a(0x141):case _0x45df3a(0x130):default:_0x537cf8='PENDING';break;}return{'paymentId':_0x909500[_0x45df3a(0x165)]||_0x909500[_0x45df3a(0x149)],'status':_0x537cf8,'amount':_0x909500[_0x45df3a(0x18e)],'currency':_0x909500[_0x45df3a(0x143)],'additionalInfo':{'method':_0x909500[_0x45df3a(0x16d)],'bankId':_0x909500[_0x45df3a(0x153)],'settled':_0x909500[_0x45df3a(0x14d)],'settlementDate':_0x909500[_0x45df3a(0x13d)],'remitterName':_0x909500[_0x45df3a(0x198)]?.[_0x45df3a(0x15a)],'remitterIban':_0x909500[_0x45df3a(0x198)]?.[_0x45df3a(0x166)],'bankTransactionId':_0x909500[_0x45df3a(0x1a1)]}};}['verifyWebhookSignature'](_0x20c69f,_0xaffbee){const _0xf500c2=a43_0x386341;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0xaffbee,'paymentId':_0x20c69f[_0xf500c2(0x149)],'merchantPaymentId':_0x20c69f[_0xf500c2(0x165)]}),!![];}}exports['NodaService']=NodaService;