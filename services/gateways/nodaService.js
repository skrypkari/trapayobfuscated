'use strict';const a53_0x16025e=a53_0x5f58;(function(_0x5d1dcf,_0x37103e){const _0x4783e2=a53_0x5f58,_0x34eded=_0x5d1dcf();while(!![]){try{const _0x4ee927=parseInt(_0x4783e2(0xf4))/0x1*(-parseInt(_0x4783e2(0x140))/0x2)+parseInt(_0x4783e2(0x154))/0x3+-parseInt(_0x4783e2(0x14e))/0x4*(-parseInt(_0x4783e2(0x109))/0x5)+parseInt(_0x4783e2(0x11d))/0x6+-parseInt(_0x4783e2(0x125))/0x7+parseInt(_0x4783e2(0x134))/0x8+parseInt(_0x4783e2(0x139))/0x9*(parseInt(_0x4783e2(0x14f))/0xa);if(_0x4ee927===_0x37103e)break;else _0x34eded['push'](_0x34eded['shift']());}catch(_0x312fc3){_0x34eded['push'](_0x34eded['shift']());}}}(a53_0x4ff0,0x82e39));Object[a53_0x16025e(0x129)](exports,a53_0x16025e(0xe6),{'value':!![]}),exports[a53_0x16025e(0x108)]=void 0x0;function a53_0x5f58(_0x4c8b22,_0x380ab5){const _0x4ff0ad=a53_0x4ff0();return a53_0x5f58=function(_0x5f58dd,_0x71cdce){_0x5f58dd=_0x5f58dd-0xe2;let _0x1fb57b=_0x4ff0ad[_0x5f58dd];return _0x1fb57b;},a53_0x5f58(_0x4c8b22,_0x380ab5);}const loggerService_1=require(a53_0x16025e(0x110));class NodaService{constructor(){const _0x2dcbe9=a53_0x16025e;this['apiUrl']=_0x2dcbe9(0xe2),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async['createPaymentLink'](_0x490f78){const _0x4a7963=a53_0x16025e,{orderId:_0x1eb2f6,name:_0x485934,paymentDescription:_0x396cb3,amount:_0x12ab94,currency:_0x33b5e1,webhookUrl:_0x4d3280,returnUrl:_0x274665,expiryDate:_0x17c9e6}=_0x490f78,_0x2f6b33=_0x33b5e1[_0x4a7963(0x13e)](),_0x2e8997=_0x4a7963(0x11a),_0x5c02af=_0x4a7963(0x118)+_0x1eb2f6,_0x4b66d7={'name':_0x485934,'paymentDescription':_0x396cb3,'amount':_0x12ab94,'currency':_0x2f6b33,'paymentId':_0x1eb2f6,'webhookUrl':_0x2e8997,'returnUrl':_0x5c02af};_0x17c9e6&&(_0x4b66d7[_0x4a7963(0xe3)]=_0x17c9e6);const _0x1a3919=Date['now']();try{console[_0x4a7963(0x14a)](_0x4a7963(0x124)),console[_0x4a7963(0x14a)](_0x4a7963(0x10b),this['apiUrl']),console[_0x4a7963(0x14a)](_0x4a7963(0x137),JSON['stringify'](_0x4b66d7,null,0x2)),console['log'](_0x4a7963(0x12e),_0x1eb2f6,_0x4a7963(0xf3)),console[_0x4a7963(0x14a)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x5c02af),loggerService_1['loggerService'][_0x4a7963(0x10f)]('noda',_0x4a7963(0x120),_0x4a7963(0x10e),_0x4b66d7);const _0x2024dc=await fetch(this['apiUrl'],{'method':_0x4a7963(0x10e),'headers':{'Content-Type':_0x4a7963(0xfc),'Accept':_0x4a7963(0xfc),'User-Agent':_0x4a7963(0x153)},'body':JSON['stringify'](_0x4b66d7)}),_0x7a83f1=Date[_0x4a7963(0x14b)]()-_0x1a3919;console['log'](_0x4a7963(0x13b)),console['log'](_0x4a7963(0x136),_0x2024dc[_0x4a7963(0x12f)]),console[_0x4a7963(0x14a)](_0x4a7963(0x112),_0x2024dc[_0x4a7963(0xf7)]),console[_0x4a7963(0x14a)](_0x4a7963(0xfb),Object[_0x4a7963(0xf9)](_0x2024dc['headers'][_0x4a7963(0x144)]())),console['log']('Response\x20Time:',_0x7a83f1+'ms');const _0x111038=await _0x2024dc['text']();console[_0x4a7963(0x14a)](_0x4a7963(0xec),_0x111038);if(!_0x2024dc['ok']){console[_0x4a7963(0xed)](_0x4a7963(0x156)),console[_0x4a7963(0xed)](_0x4a7963(0x13c),_0x2024dc[_0x4a7963(0x12f)]),console[_0x4a7963(0xed)]('Response\x20Body:',_0x111038),loggerService_1[_0x4a7963(0x145)]['logWhiteDomainResponse'](_0x4a7963(0x123),'/payment-links',_0x2024dc[_0x4a7963(0x12f)],_0x111038,_0x7a83f1),loggerService_1['loggerService'][_0x4a7963(0xf8)](_0x4a7963(0x123),_0x4a7963(0x120),_0x4a7963(0xe9)+_0x2024dc[_0x4a7963(0x12f)]+':\x20'+_0x111038);if(_0x2024dc[_0x4a7963(0x12f)]===0x190)throw new Error(_0x4a7963(0x14c));else{if(_0x2024dc[_0x4a7963(0x12f)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x4a7963(0x107)+_0x2024dc[_0x4a7963(0x12f)]+_0x4a7963(0x11e)+_0x111038);}let _0x7b84b1;try{_0x7b84b1=JSON[_0x4a7963(0x121)](_0x111038);}catch(_0x11d017){console[_0x4a7963(0xed)](_0x4a7963(0x12a),_0x11d017),loggerService_1[_0x4a7963(0x145)][_0x4a7963(0xf8)]('noda',_0x4a7963(0x120),_0x4a7963(0x10a)+_0x11d017);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x111038);}console[_0x4a7963(0x14a)](_0x4a7963(0x126)),console[_0x4a7963(0x14a)](_0x4a7963(0x10d),JSON['stringify'](_0x7b84b1,null,0x2)),loggerService_1['loggerService'][_0x4a7963(0xeb)](_0x4a7963(0x123),_0x4a7963(0x120),_0x2024dc['status'],_0x7b84b1,_0x7a83f1);if(_0x7b84b1[_0x4a7963(0xed)]||_0x7b84b1[_0x4a7963(0xfe)]){const _0x5b5b17=_0x7b84b1['message']||_0x7b84b1[_0x4a7963(0xed)]||_0x4a7963(0xe8);console[_0x4a7963(0xed)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x4a7963(0xed)](_0x4a7963(0x155),_0x5b5b17),console['error']('Status\x20Code:',_0x7b84b1['statusCode']),loggerService_1[_0x4a7963(0x145)][_0x4a7963(0xf8)](_0x4a7963(0x123),'/payment-links',_0x4a7963(0xf5)+_0x5b5b17);throw new Error(_0x4a7963(0x14d)+_0x5b5b17);}if(!_0x7b84b1['id']||!_0x7b84b1[_0x4a7963(0x142)]?.[_0x4a7963(0x11c)]){console[_0x4a7963(0xed)](_0x4a7963(0x116)),console[_0x4a7963(0xed)](_0x4a7963(0x12c)),console['error']('Response\x20data:',_0x7b84b1),loggerService_1[_0x4a7963(0x145)]['logWhiteDomainError']('noda',_0x4a7963(0x120),_0x4a7963(0x13a));throw new Error(_0x4a7963(0x117));}return console[_0x4a7963(0x14a)](_0x4a7963(0x13d)),console[_0x4a7963(0x14a)]('Payment\x20Link\x20ID:',_0x7b84b1['id']),console[_0x4a7963(0x14a)](_0x4a7963(0x146),_0x7b84b1[_0x4a7963(0x142)][_0x4a7963(0x11c)]),console[_0x4a7963(0x14a)](_0x4a7963(0x143),_0x7b84b1[_0x4a7963(0x142)][_0x4a7963(0x132)]||_0x4a7963(0x119)),console[_0x4a7963(0x14a)]('Order\x20ID\x20Used:',_0x1eb2f6,_0x4a7963(0x101)),console['log'](_0x4a7963(0x149),_0x5c02af),{'gateway_payment_id':_0x7b84b1['id'],'payment_url':_0x7b84b1[_0x4a7963(0x142)][_0x4a7963(0x11c)],'qr_code_url':_0x7b84b1[_0x4a7963(0x142)][_0x4a7963(0x132)],'expiry_date':_0x7b84b1[_0x4a7963(0xe3)]};}catch(_0x3e79f2){console[_0x4a7963(0xed)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x4a7963(0xed)](_0x4a7963(0x12d),_0x3e79f2),loggerService_1[_0x4a7963(0x145)]['logWhiteDomainError']('noda','/payment-links',_0x3e79f2);if(_0x3e79f2 instanceof Error){console[_0x4a7963(0xed)]('Error\x20message:',_0x3e79f2[_0x4a7963(0x105)]),console[_0x4a7963(0xed)]('Error\x20stack:',_0x3e79f2['stack']);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x3e79f2[_0x4a7963(0x105)]);}throw new Error(_0x4a7963(0xe4));}}async[a53_0x16025e(0x12b)](_0x54e58e){const _0x2b401c=a53_0x16025e,_0x38abf3=Date['now']();try{loggerService_1[_0x2b401c(0x145)]['logWhiteDomainRequest'](_0x2b401c(0x123),_0x2b401c(0x141)+_0x54e58e,_0x2b401c(0xfd),{});const _0x34ea63=await fetch(this['apiUrl']+'/'+_0x54e58e,{'method':'GET','headers':{'Content-Type':_0x2b401c(0xfc),'User-Agent':'Payment\x20System/1.0'}}),_0x25f384=Date[_0x2b401c(0x14b)]()-_0x38abf3;if(!_0x34ea63['ok']){const _0x52dc1=await _0x34ea63[_0x2b401c(0xf1)]();loggerService_1[_0x2b401c(0x145)]['logWhiteDomainResponse'](_0x2b401c(0x123),_0x2b401c(0x141)+_0x54e58e,_0x34ea63['status'],_0x52dc1,_0x25f384);throw new Error(_0x2b401c(0x107)+_0x34ea63[_0x2b401c(0x12f)]);}const _0x95e7d0=await _0x34ea63['json']();loggerService_1[_0x2b401c(0x145)][_0x2b401c(0xeb)](_0x2b401c(0x123),_0x2b401c(0x141)+_0x54e58e,_0x34ea63['status'],_0x95e7d0,_0x25f384);if(_0x95e7d0[_0x2b401c(0xed)]||_0x95e7d0['statusCode']){loggerService_1[_0x2b401c(0x145)]['logWhiteDomainError'](_0x2b401c(0x123),_0x2b401c(0x141)+_0x54e58e,_0x2b401c(0x14d)+(_0x95e7d0[_0x2b401c(0x105)]||_0x95e7d0['error']||_0x2b401c(0x113)));throw new Error('Noda\x20API\x20error:\x20'+(_0x95e7d0['message']||_0x95e7d0[_0x2b401c(0xed)]||_0x2b401c(0x113)));}let _0x12b8c2=_0x2b401c(0xff);if(_0x95e7d0[_0x2b401c(0x11f)]===![]){if(_0x95e7d0[_0x2b401c(0xe3)]){const _0x3fc1db=new Date(_0x95e7d0[_0x2b401c(0xe3)]),_0x3a9d22=new Date();_0x3fc1db<_0x3a9d22?_0x12b8c2=_0x2b401c(0x148):_0x12b8c2=_0x2b401c(0x13f);}else _0x12b8c2=_0x2b401c(0x13f);}else _0x12b8c2=_0x2b401c(0xff);return{'status':_0x12b8c2,'amount':_0x95e7d0[_0x2b401c(0x127)],'currency':_0x95e7d0[_0x2b401c(0xfa)],'isActive':_0x95e7d0[_0x2b401c(0x11f)]};}catch(_0x215a44){console[_0x2b401c(0xed)]('Noda\x20payment\x20verification\x20error:',_0x215a44),loggerService_1[_0x2b401c(0x145)][_0x2b401c(0xf8)](_0x2b401c(0x123),'/payment-links/'+_0x54e58e,_0x215a44);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x215a44 instanceof Error?_0x215a44['message']:_0x2b401c(0x113)));}}async[a53_0x16025e(0x150)](_0x5bf829){const _0x44b7f9=a53_0x16025e;console['log'](_0x44b7f9(0xef),_0x5bf829);let _0x4c2541=_0x44b7f9(0xff);switch(_0x5bf829[_0x44b7f9(0x133)]?.[_0x44b7f9(0x102)]()){case _0x44b7f9(0xee):case _0x44b7f9(0x122):case'paid':case _0x44b7f9(0x130):case _0x44b7f9(0x106):_0x5bf829['Settled']==='Yes'?_0x4c2541='PAID':_0x4c2541=_0x44b7f9(0xff);break;case'cancelled':case _0x44b7f9(0x152):case _0x44b7f9(0x115):case _0x44b7f9(0xed):case _0x44b7f9(0x128):_0x4c2541=_0x44b7f9(0x13f);break;case _0x44b7f9(0xe5):case'timeout':_0x4c2541=_0x44b7f9(0x148);break;case _0x44b7f9(0x114):case _0x44b7f9(0xe7):case _0x44b7f9(0x131):case _0x44b7f9(0x138):case _0x44b7f9(0x151):default:_0x4c2541='PENDING';break;}return{'paymentId':_0x5bf829[_0x44b7f9(0x103)]||_0x5bf829[_0x44b7f9(0xf0)],'status':_0x4c2541,'amount':_0x5bf829[_0x44b7f9(0xf2)],'currency':_0x5bf829[_0x44b7f9(0xf6)],'additionalInfo':{'method':_0x5bf829['Method'],'bankId':_0x5bf829[_0x44b7f9(0x100)],'settled':_0x5bf829[_0x44b7f9(0x10c)],'settlementDate':_0x5bf829['SettlementDate'],'remitterName':_0x5bf829['Remitter']?.[_0x44b7f9(0x135)],'remitterIban':_0x5bf829[_0x44b7f9(0xea)]?.[_0x44b7f9(0x111)],'bankTransactionId':_0x5bf829[_0x44b7f9(0x11b)]}};}[a53_0x16025e(0x147)](_0x2df214,_0x2d7015){const _0x22f4ad=a53_0x16025e;return console[_0x22f4ad(0x14a)](_0x22f4ad(0x104),{'receivedSignature':_0x2d7015,'paymentId':_0x2df214[_0x22f4ad(0xf0)],'merchantPaymentId':_0x2df214[_0x22f4ad(0x103)]}),!![];}}exports[a53_0x16025e(0x108)]=NodaService;function a53_0x4ff0(){const _0x1d189c=['/payment-links','parse','completed','noda','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','5807214GYvujt','===\x20PARSED\x20NODA\x20RESPONSE\x20===','amount','rejected','defineProperty','Failed\x20to\x20parse\x20JSON\x20response:','verifyPayment','Missing\x20id\x20or\x20shortLink\x20in\x20response','Error\x20details:','Order\x20ID\x20Format:','status','success','active','qrCodeLink','Status','3195000PwNxlY','Name','Status:','Request\x20Body\x20(Direct\x20JSON):','processing','39789YwHqAf','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','HTTP\x20Status:','===\x20NODA\x20SUCCESS\x20===','toUpperCase','FAILED','2082344gvbJcA','/payment-links/','shortLinkUrls','QR\x20Code\x20Link:','entries','loggerService','Short\x20Link:','verifyWebhookSignature','EXPIRED','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','log','now','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Noda\x20API\x20error:\x20','20CnmSvG','850tnWutb','processWebhook','in_progress','canceled','Payment\x20System/1.0','3021138KsYRFe','Error\x20Message:','===\x20NODA\x20API\x20ERROR\x20===','https://tesoft.uk/gateway/noda/','expiryDate','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','expired','__esModule','created','Unknown\x20error\x20from\x20Noda\x20API','HTTP\x20','Remitter','logWhiteDomainResponse','Raw\x20Response\x20Body:','error','done','Processing\x20Noda\x20webhook:','PaymentId','text','Amount','(8digits-8digits\x20format\x20for\x20Noda)','1UjlLds','Business\x20Error:\x20','Currency','statusText','logWhiteDomainError','fromEntries','currency','Headers:','application/json','GET','statusCode','PENDING','BankId','(8digits-8digits\x20format)','toLowerCase','MerchantPaymentId','Noda\x20webhook\x20signature\x20verification:','message','successful','HTTP\x20error!\x20status:\x20','NodaService','133865ohkISQ','JSON\x20Parse\x20Error:\x20','URL:','Settled','Parsed\x20Result:','POST','logWhiteDomainRequest','../loggerService','Iban','Status\x20Text:','Unknown\x20error','pending','failed','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','https://tesoft.uk/gateway/pending.php?id=','Not\x20provided','https://tesoft.uk/gateway/noda/webhook/','BankTransactionId','shortLink','2944944cSEEpa',',\x20body:\x20','isActive'];a53_0x4ff0=function(){return _0x1d189c;};return a53_0x4ff0();}