'use strict';const a53_0x42b00b=a53_0x72a8;function a53_0x72a8(_0x9dce88,_0x58a85d){const _0x64b054=a53_0x64b0();return a53_0x72a8=function(_0x72a809,_0x16f87e){_0x72a809=_0x72a809-0x1ac;let _0x48f3b0=_0x64b054[_0x72a809];return _0x48f3b0;},a53_0x72a8(_0x9dce88,_0x58a85d);}(function(_0xd0e617,_0x4bcf8b){const _0x218a76=a53_0x72a8,_0x2fd79a=_0xd0e617();while(!![]){try{const _0x499619=-parseInt(_0x218a76(0x1ca))/0x1+parseInt(_0x218a76(0x1b2))/0x2*(-parseInt(_0x218a76(0x1da))/0x3)+parseInt(_0x218a76(0x1f1))/0x4*(-parseInt(_0x218a76(0x1bb))/0x5)+parseInt(_0x218a76(0x1e9))/0x6*(-parseInt(_0x218a76(0x1ba))/0x7)+parseInt(_0x218a76(0x1fe))/0x8+-parseInt(_0x218a76(0x1c0))/0x9*(-parseInt(_0x218a76(0x21d))/0xa)+parseInt(_0x218a76(0x223))/0xb;if(_0x499619===_0x4bcf8b)break;else _0x2fd79a['push'](_0x2fd79a['shift']());}catch(_0x5663a6){_0x2fd79a['push'](_0x2fd79a['shift']());}}}(a53_0x64b0,0x879ca));function a53_0x64b0(){const _0x4d9447=['isActive','currency','11389hrMkmV','5ldkHmf','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20NODA\x20API\x20ERROR\x20===','__esModule','defineProperty','9FoRdQW','Status:','logWhiteDomainResponse','Error\x20details:',',\x20body:\x20','verifyPayment','Not\x20provided','JSON\x20Parse\x20Error:\x20','message','Payment\x20System/1.0','909694UgyDkI','apiUrl','Response\x20Time:','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','https://tesoft.uk/gateway/noda/','POST','application/json','Remitter','Missing\x20id\x20or\x20shortLink\x20in\x20response','successful','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','stringify','fromEntries','BankTransactionId','Order\x20ID\x20Format:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','6YlSfye','https://tesoft.uk/gateway/noda/webhook/','processWebhook','shortLinkUrls','error','paid','../loggerService','FAILED','failed','HTTP\x20error!\x20status:\x20','Name','success','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Error\x20Message:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','3126bXrKaj','noda','(8digits-8digits\x20format)','timeout','/payment-links','Business\x20Error:\x20','Noda\x20payment\x20verification\x20error:','Unknown\x20error','141104DCGhxC','Noda\x20API\x20error:\x20','Amount','Order\x20ID\x20Used:','processing','completed','pending','Raw\x20Response\x20Body:','Currency','/payment-links/','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','statusCode','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','3433776OBnyDn','logWhiteDomainError','Yes','URL:','Headers:','Unknown\x20error\x20from\x20Noda\x20API','in_progress','expired','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Response\x20data:','status','shortLink','Parsed\x20Result:','qrCodeLink','parse','Error\x20message:','Status','Method','loggerService','stack','PENDING','QR\x20Code\x20Link:','Payment\x20Link\x20ID:','MerchantPaymentId','EXPIRED','now','entries','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','statusText','verifyWebhookSignature','Status\x20Text:','7646300wzpUta','===\x20NODA\x20SERVICE\x20ERROR\x20===','PaymentId','active','===\x20NODA\x20SUCCESS\x20===','logWhiteDomainRequest','24625689ZLRdfd','BankId','NodaService','log','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','canceled','done','Error\x20stack:','Noda\x20webhook\x20signature\x20verification:','rejected','1084448XCgdLW','expiryDate','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Settled','amount','text'];a53_0x64b0=function(){return _0x4d9447;};return a53_0x64b0();}Object[a53_0x42b00b(0x1bf)](exports,a53_0x42b00b(0x1be),{'value':!![]}),exports[a53_0x42b00b(0x225)]=void 0x0;const loggerService_1=require(a53_0x42b00b(0x1e0));class NodaService{constructor(){const _0x266101=a53_0x42b00b;this[_0x266101(0x1cb)]=_0x266101(0x1ce),console[_0x266101(0x226)](_0x266101(0x1bc));}async['createPaymentLink'](_0x2c6c1d){const _0x12aaf5=a53_0x42b00b,{orderId:_0x561cd3,name:_0x24cb47,paymentDescription:_0x7fcc2d,amount:_0x489c32,currency:_0x5df69e,webhookUrl:_0x508a4a,returnUrl:_0x4276b7,expiryDate:_0x3202bd}=_0x2c6c1d,_0x4ac46b=_0x5df69e['toUpperCase'](),_0x4edf70=_0x12aaf5(0x1db),_0x40d2ea='https://tesoft.uk/gateway/pending.php?id='+_0x561cd3,_0x27577a={'name':_0x24cb47,'paymentDescription':_0x7fcc2d,'amount':_0x489c32,'currency':_0x4ac46b,'paymentId':_0x561cd3,'webhookUrl':_0x4edf70,'returnUrl':_0x40d2ea};_0x3202bd&&(_0x27577a[_0x12aaf5(0x1b3)]=_0x3202bd);const _0x2c1d1e=Date[_0x12aaf5(0x217)]();try{console['log'](_0x12aaf5(0x1fd)),console[_0x12aaf5(0x226)](_0x12aaf5(0x201),this[_0x12aaf5(0x1cb)]),console[_0x12aaf5(0x226)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x12aaf5(0x1d5)](_0x27577a,null,0x2)),console[_0x12aaf5(0x226)](_0x12aaf5(0x1d8),_0x561cd3,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x12aaf5(0x226)](_0x12aaf5(0x1cd),_0x40d2ea),loggerService_1['loggerService'][_0x12aaf5(0x222)]('noda',_0x12aaf5(0x1ed),_0x12aaf5(0x1cf),_0x27577a);const _0x2e4ec7=await fetch(this['apiUrl'],{'method':_0x12aaf5(0x1cf),'headers':{'Content-Type':_0x12aaf5(0x1d0),'Accept':_0x12aaf5(0x1d0),'User-Agent':_0x12aaf5(0x1c9)},'body':JSON[_0x12aaf5(0x1d5)](_0x27577a)}),_0x2c24ea=Date[_0x12aaf5(0x217)]()-_0x2c1d1e;console[_0x12aaf5(0x226)](_0x12aaf5(0x1e8)),console[_0x12aaf5(0x226)](_0x12aaf5(0x1c1),_0x2e4ec7['status']),console[_0x12aaf5(0x226)](_0x12aaf5(0x21c),_0x2e4ec7[_0x12aaf5(0x21a)]),console[_0x12aaf5(0x226)](_0x12aaf5(0x202),Object[_0x12aaf5(0x1d6)](_0x2e4ec7['headers'][_0x12aaf5(0x218)]())),console[_0x12aaf5(0x226)](_0x12aaf5(0x1cc),_0x2c24ea+'ms');const _0x4f8894=await _0x2e4ec7[_0x12aaf5(0x1b7)]();console[_0x12aaf5(0x226)](_0x12aaf5(0x1f8),_0x4f8894);if(!_0x2e4ec7['ok']){console[_0x12aaf5(0x1de)](_0x12aaf5(0x1bd)),console[_0x12aaf5(0x1de)]('HTTP\x20Status:',_0x2e4ec7['status']),console[_0x12aaf5(0x1de)]('Response\x20Body:',_0x4f8894),loggerService_1[_0x12aaf5(0x210)][_0x12aaf5(0x1c2)](_0x12aaf5(0x1ea),'/payment-links',_0x2e4ec7[_0x12aaf5(0x208)],_0x4f8894,_0x2c24ea),loggerService_1[_0x12aaf5(0x210)]['logWhiteDomainError'](_0x12aaf5(0x1ea),_0x12aaf5(0x1ed),'HTTP\x20'+_0x2e4ec7[_0x12aaf5(0x208)]+':\x20'+_0x4f8894);if(_0x2e4ec7[_0x12aaf5(0x208)]===0x190)throw new Error(_0x12aaf5(0x1d9));else{if(_0x2e4ec7[_0x12aaf5(0x208)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x12aaf5(0x1e3)+_0x2e4ec7[_0x12aaf5(0x208)]+_0x12aaf5(0x1c4)+_0x4f8894);}let _0x46b868;try{_0x46b868=JSON[_0x12aaf5(0x20c)](_0x4f8894);}catch(_0x2bcf80){console[_0x12aaf5(0x1de)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x2bcf80),loggerService_1[_0x12aaf5(0x210)][_0x12aaf5(0x1ff)]('noda',_0x12aaf5(0x1ed),_0x12aaf5(0x1c7)+_0x2bcf80);throw new Error(_0x12aaf5(0x1ac)+_0x4f8894);}console[_0x12aaf5(0x226)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x12aaf5(0x226)](_0x12aaf5(0x20a),JSON[_0x12aaf5(0x1d5)](_0x46b868,null,0x2)),loggerService_1[_0x12aaf5(0x210)][_0x12aaf5(0x1c2)](_0x12aaf5(0x1ea),'/payment-links',_0x2e4ec7[_0x12aaf5(0x208)],_0x46b868,_0x2c24ea);if(_0x46b868[_0x12aaf5(0x1de)]||_0x46b868[_0x12aaf5(0x1fc)]){const _0xd6aa5b=_0x46b868[_0x12aaf5(0x1c8)]||_0x46b868[_0x12aaf5(0x1de)]||_0x12aaf5(0x203);console[_0x12aaf5(0x1de)](_0x12aaf5(0x219)),console[_0x12aaf5(0x1de)](_0x12aaf5(0x1e7),_0xd6aa5b),console['error']('Status\x20Code:',_0x46b868[_0x12aaf5(0x1fc)]),loggerService_1[_0x12aaf5(0x210)][_0x12aaf5(0x1ff)]('noda',_0x12aaf5(0x1ed),_0x12aaf5(0x1ee)+_0xd6aa5b);throw new Error(_0x12aaf5(0x1f2)+_0xd6aa5b);}if(!_0x46b868['id']||!_0x46b868[_0x12aaf5(0x1dd)]?.[_0x12aaf5(0x209)]){console['error'](_0x12aaf5(0x1d4)),console[_0x12aaf5(0x1de)](_0x12aaf5(0x1d2)),console['error'](_0x12aaf5(0x207),_0x46b868),loggerService_1[_0x12aaf5(0x210)][_0x12aaf5(0x1ff)]('noda',_0x12aaf5(0x1ed),_0x12aaf5(0x1b4));throw new Error(_0x12aaf5(0x1e6));}return console[_0x12aaf5(0x226)](_0x12aaf5(0x221)),console[_0x12aaf5(0x226)](_0x12aaf5(0x214),_0x46b868['id']),console[_0x12aaf5(0x226)]('Short\x20Link:',_0x46b868[_0x12aaf5(0x1dd)]['shortLink']),console[_0x12aaf5(0x226)](_0x12aaf5(0x213),_0x46b868[_0x12aaf5(0x1dd)][_0x12aaf5(0x20b)]||_0x12aaf5(0x1c6)),console[_0x12aaf5(0x226)](_0x12aaf5(0x1f4),_0x561cd3,_0x12aaf5(0x1eb)),console[_0x12aaf5(0x226)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x40d2ea),{'gateway_payment_id':_0x46b868['id'],'payment_url':_0x46b868[_0x12aaf5(0x1dd)][_0x12aaf5(0x209)],'qr_code_url':_0x46b868[_0x12aaf5(0x1dd)][_0x12aaf5(0x20b)],'expiry_date':_0x46b868[_0x12aaf5(0x1b3)]};}catch(_0x139351){console[_0x12aaf5(0x1de)](_0x12aaf5(0x21e)),console['error'](_0x12aaf5(0x1c3),_0x139351),loggerService_1[_0x12aaf5(0x210)][_0x12aaf5(0x1ff)](_0x12aaf5(0x1ea),'/payment-links',_0x139351);if(_0x139351 instanceof Error){console[_0x12aaf5(0x1de)](_0x12aaf5(0x20d),_0x139351[_0x12aaf5(0x1c8)]),console[_0x12aaf5(0x1de)](_0x12aaf5(0x1af),_0x139351[_0x12aaf5(0x211)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x139351[_0x12aaf5(0x1c8)]);}throw new Error(_0x12aaf5(0x1fb));}}async[a53_0x42b00b(0x1c5)](_0x1aecb9){const _0x18ae05=a53_0x42b00b,_0x56ce7c=Date[_0x18ae05(0x217)]();try{loggerService_1['loggerService'][_0x18ae05(0x222)](_0x18ae05(0x1ea),_0x18ae05(0x1fa)+_0x1aecb9,'GET',{});const _0x3dcfc1=await fetch(this[_0x18ae05(0x1cb)]+'/'+_0x1aecb9,{'method':'GET','headers':{'Content-Type':_0x18ae05(0x1d0),'User-Agent':_0x18ae05(0x1c9)}}),_0x5d9aa1=Date[_0x18ae05(0x217)]()-_0x56ce7c;if(!_0x3dcfc1['ok']){const _0x2bf940=await _0x3dcfc1['text']();loggerService_1[_0x18ae05(0x210)]['logWhiteDomainResponse'](_0x18ae05(0x1ea),_0x18ae05(0x1fa)+_0x1aecb9,_0x3dcfc1['status'],_0x2bf940,_0x5d9aa1);throw new Error(_0x18ae05(0x1e3)+_0x3dcfc1[_0x18ae05(0x208)]);}const _0x200cbd=await _0x3dcfc1['json']();loggerService_1[_0x18ae05(0x210)][_0x18ae05(0x1c2)](_0x18ae05(0x1ea),_0x18ae05(0x1fa)+_0x1aecb9,_0x3dcfc1[_0x18ae05(0x208)],_0x200cbd,_0x5d9aa1);if(_0x200cbd['error']||_0x200cbd[_0x18ae05(0x1fc)]){loggerService_1['loggerService'][_0x18ae05(0x1ff)](_0x18ae05(0x1ea),'/payment-links/'+_0x1aecb9,_0x18ae05(0x1f2)+(_0x200cbd[_0x18ae05(0x1c8)]||_0x200cbd[_0x18ae05(0x1de)]||_0x18ae05(0x1f0)));throw new Error(_0x18ae05(0x1f2)+(_0x200cbd[_0x18ae05(0x1c8)]||_0x200cbd[_0x18ae05(0x1de)]||'Unknown\x20error'));}let _0x11aefa=_0x18ae05(0x212);if(_0x200cbd[_0x18ae05(0x1b8)]===![]){if(_0x200cbd['expiryDate']){const _0x38e30f=new Date(_0x200cbd[_0x18ae05(0x1b3)]),_0x528a02=new Date();_0x38e30f<_0x528a02?_0x11aefa=_0x18ae05(0x216):_0x11aefa=_0x18ae05(0x1e1);}else _0x11aefa=_0x18ae05(0x1e1);}else _0x11aefa=_0x18ae05(0x212);return{'status':_0x11aefa,'amount':_0x200cbd[_0x18ae05(0x1b6)],'currency':_0x200cbd[_0x18ae05(0x1b9)],'isActive':_0x200cbd['isActive']};}catch(_0x4f354c){console['error'](_0x18ae05(0x1ef),_0x4f354c),loggerService_1['loggerService'][_0x18ae05(0x1ff)](_0x18ae05(0x1ea),_0x18ae05(0x1fa)+_0x1aecb9,_0x4f354c);throw new Error(_0x18ae05(0x206)+(_0x4f354c instanceof Error?_0x4f354c['message']:_0x18ae05(0x1f0)));}}async[a53_0x42b00b(0x1dc)](_0x1ba7c9){const _0x15e45c=a53_0x42b00b;console[_0x15e45c(0x226)]('Processing\x20Noda\x20webhook:',_0x1ba7c9);let _0x306795=_0x15e45c(0x212);switch(_0x1ba7c9[_0x15e45c(0x20e)]?.['toLowerCase']()){case _0x15e45c(0x1ae):case _0x15e45c(0x1f6):case _0x15e45c(0x1df):case _0x15e45c(0x1e5):case _0x15e45c(0x1d3):_0x1ba7c9[_0x15e45c(0x1b5)]===_0x15e45c(0x200)?_0x306795='PAID':_0x306795=_0x15e45c(0x212);break;case'cancelled':case _0x15e45c(0x1ad):case _0x15e45c(0x1e2):case _0x15e45c(0x1de):case _0x15e45c(0x1b1):_0x306795=_0x15e45c(0x1e1);break;case _0x15e45c(0x205):case _0x15e45c(0x1ec):_0x306795=_0x15e45c(0x216);break;case _0x15e45c(0x1f7):case'created':case _0x15e45c(0x220):case _0x15e45c(0x1f5):case _0x15e45c(0x204):default:_0x306795=_0x15e45c(0x212);break;}return{'paymentId':_0x1ba7c9[_0x15e45c(0x215)]||_0x1ba7c9[_0x15e45c(0x21f)],'status':_0x306795,'amount':_0x1ba7c9[_0x15e45c(0x1f3)],'currency':_0x1ba7c9[_0x15e45c(0x1f9)],'additionalInfo':{'method':_0x1ba7c9[_0x15e45c(0x20f)],'bankId':_0x1ba7c9[_0x15e45c(0x224)],'settled':_0x1ba7c9[_0x15e45c(0x1b5)],'settlementDate':_0x1ba7c9['SettlementDate'],'remitterName':_0x1ba7c9[_0x15e45c(0x1d1)]?.[_0x15e45c(0x1e4)],'remitterIban':_0x1ba7c9[_0x15e45c(0x1d1)]?.['Iban'],'bankTransactionId':_0x1ba7c9[_0x15e45c(0x1d7)]}};}[a53_0x42b00b(0x21b)](_0x208f5f,_0x330085){const _0x442136=a53_0x42b00b;return console[_0x442136(0x226)](_0x442136(0x1b0),{'receivedSignature':_0x330085,'paymentId':_0x208f5f[_0x442136(0x21f)],'merchantPaymentId':_0x208f5f['MerchantPaymentId']}),!![];}}exports[a53_0x42b00b(0x225)]=NodaService;