'use strict';const a44_0x58834d=a44_0x1197;function a44_0x2fa7(){const _0x18fb90=['Order\x20ID\x20Used:','noda','Noda\x20payment\x20verification\x20error:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','application/json','toUpperCase','Method','TesSoft\x20Payment\x20System/1.0','status','1688afbrAR','POST','Headers:','Response\x20Time:','PENDING','SettlementDate','completed','timeout','pending','Status:','defineProperty','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','JSON\x20Parse\x20Error:\x20','failed','Error\x20details:','logWhiteDomainResponse','Error\x20message:','expiryDate','entries','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','327306UxUXqz','Yes','/payment-links','shortLinkUrls','PaymentId','log','stack','active','shortLink','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Business\x20Error:\x20','Remitter','expired','Status\x20Text:','logWhiteDomainError','FAILED','10zSFFBD','HTTP\x20','PAID','2573945ptuMtg','Processing\x20Noda\x20webhook:','Request\x20Body\x20(Direct\x20JSON):','Not\x20provided','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','processing','490jXBght','4026693FkWxRm','GET','/payment-links/','Iban','headers','Noda\x20API\x20error:\x20','===\x20NODA\x20API\x20ERROR\x20===','Error\x20stack:','paid','fromEntries','successful','Settled','text','===\x20NODA\x20SUCCESS\x20===','loggerService','logWhiteDomainRequest','statusCode','amount','MerchantPaymentId','now','apiUrl','stringify','canceled','Status','isActive','parse','9181UrAWpG','Error\x20Message:','__esModule','Unknown\x20error','Missing\x20id\x20or\x20shortLink\x20in\x20response','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','35056pPPUUk','../loggerService','toLowerCase','Order\x20ID\x20Format:','statusText','148761squfyJ','BankTransactionId','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Raw\x20Response\x20Body:','rejected','qrCodeLink','Short\x20Link:','processWebhook','Name','Response\x20Body:','Amount','HTTP\x20Status:','https://tesoft.uk/gateway/pending.php?id=','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','6464358DGqwvK','(8digits-8digits\x20format)','Currency','===\x20PARSED\x20NODA\x20RESPONSE\x20===','cancelled','error','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Noda\x20webhook\x20signature\x20verification:','===\x20NODA\x20SERVICE\x20ERROR\x20===','Unknown\x20error\x20from\x20Noda\x20API','done','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status\x20Code:','BankId','message','QR\x20Code\x20Link:','NodaService','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','EXPIRED','Parsed\x20Result:','8PKrKqF'];a44_0x2fa7=function(){return _0x18fb90;};return a44_0x2fa7();}function a44_0x1197(_0x58b3cd,_0x47e2f3){const _0x2fa7d2=a44_0x2fa7();return a44_0x1197=function(_0x11979d,_0x492a0e){_0x11979d=_0x11979d-0xec;let _0x268ced=_0x2fa7d2[_0x11979d];return _0x268ced;},a44_0x1197(_0x58b3cd,_0x47e2f3);}(function(_0x38f58f,_0x16b9db){const _0x3fce3c=a44_0x1197,_0x3a3ea0=_0x38f58f();while(!![]){try{const _0x128105=parseInt(_0x3fce3c(0x117))/0x1*(-parseInt(_0x3fce3c(0xf2))/0x2)+parseInt(_0x3fce3c(0x162))/0x3+parseInt(_0x3fce3c(0x144))/0x4*(parseInt(_0x3fce3c(0xf5))/0x5)+-parseInt(_0x3fce3c(0x130))/0x6+-parseInt(_0x3fce3c(0x11d))/0x7*(-parseInt(_0x3fce3c(0x14e))/0x8)+parseInt(_0x3fce3c(0x122))/0x9*(-parseInt(_0x3fce3c(0xfc))/0xa)+parseInt(_0x3fce3c(0xfd))/0xb;if(_0x128105===_0x16b9db)break;else _0x3a3ea0['push'](_0x3a3ea0['shift']());}catch(_0x1bcc9b){_0x3a3ea0['push'](_0x3a3ea0['shift']());}}}(a44_0x2fa7,0x995f4));Object[a44_0x58834d(0x158)](exports,a44_0x58834d(0x119),{'value':!![]}),exports[a44_0x58834d(0x140)]=void 0x0;const loggerService_1=require(a44_0x58834d(0x11e));class NodaService{constructor(){const _0x275d81=a44_0x58834d;this[_0x275d81(0x111)]='https://tesoft.uk/gateway/noda/',console[_0x275d81(0x167)](_0x275d81(0x141));}async['createPaymentLink'](_0x319778){const _0x513e75=a44_0x58834d,{orderId:_0x26376e,name:_0x5535ec,paymentDescription:_0x490d3a,amount:_0x33ab,currency:_0x5dec98,webhookUrl:_0x24ed71,returnUrl:_0x316c0f,expiryDate:_0x1bb0f2}=_0x319778,_0x395401=_0x5dec98[_0x513e75(0x14a)](),_0x4b6ad4='https://tesoft.uk/gateway/noda/webhook/',_0x3885b3=_0x513e75(0x12e)+_0x26376e,_0xc8d80d={'name':_0x5535ec,'paymentDescription':_0x490d3a,'amount':_0x33ab,'currency':_0x395401,'paymentId':_0x26376e,'webhookUrl':_0x4b6ad4,'returnUrl':_0x3885b3};_0x1bb0f2&&(_0xc8d80d[_0x513e75(0x15f)]=_0x1bb0f2);const _0x1e6287=Date[_0x513e75(0x110)]();try{console[_0x513e75(0x167)]('===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20==='),console['log']('URL:',this['apiUrl']),console[_0x513e75(0x167)](_0x513e75(0xf7),JSON[_0x513e75(0x112)](_0xc8d80d,null,0x2)),console[_0x513e75(0x167)](_0x513e75(0x120),_0x26376e,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x513e75(0x167)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x3885b3),loggerService_1['loggerService'][_0x513e75(0x10c)]('noda',_0x513e75(0x164),_0x513e75(0x14f),_0xc8d80d);const _0x4460ca=await fetch(this[_0x513e75(0x111)],{'method':_0x513e75(0x14f),'headers':{'Content-Type':_0x513e75(0x149),'Accept':'application/json','User-Agent':_0x513e75(0x14c)},'body':JSON[_0x513e75(0x112)](_0xc8d80d)}),_0x316f1a=Date[_0x513e75(0x110)]()-_0x1e6287;console[_0x513e75(0x167)](_0x513e75(0x13b)),console[_0x513e75(0x167)](_0x513e75(0x157),_0x4460ca[_0x513e75(0x14d)]),console['log'](_0x513e75(0xef),_0x4460ca[_0x513e75(0x121)]),console[_0x513e75(0x167)](_0x513e75(0x150),Object[_0x513e75(0x106)](_0x4460ca[_0x513e75(0x101)][_0x513e75(0x160)]())),console[_0x513e75(0x167)](_0x513e75(0x151),_0x316f1a+'ms');const _0x3d2378=await _0x4460ca[_0x513e75(0x109)]();console['log'](_0x513e75(0x125),_0x3d2378);if(!_0x4460ca['ok']){console[_0x513e75(0x135)](_0x513e75(0x103)),console[_0x513e75(0x135)](_0x513e75(0x12d),_0x4460ca[_0x513e75(0x14d)]),console[_0x513e75(0x135)](_0x513e75(0x12b),_0x3d2378),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x513e75(0x146),_0x513e75(0x164),_0x4460ca['status'],_0x3d2378,_0x316f1a),loggerService_1[_0x513e75(0x10b)][_0x513e75(0xf0)](_0x513e75(0x146),'/payment-links',_0x513e75(0xf3)+_0x4460ca[_0x513e75(0x14d)]+':\x20'+_0x3d2378);if(_0x4460ca[_0x513e75(0x14d)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x4460ca[_0x513e75(0x14d)]===0x1f4)throw new Error(_0x513e75(0x161));}throw new Error(_0x513e75(0xfa)+_0x4460ca[_0x513e75(0x14d)]+',\x20body:\x20'+_0x3d2378);}let _0x1efd9c;try{_0x1efd9c=JSON[_0x513e75(0x116)](_0x3d2378);}catch(_0x5d238a){console[_0x513e75(0x135)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5d238a),loggerService_1['loggerService'][_0x513e75(0xf0)](_0x513e75(0x146),'/payment-links',_0x513e75(0x15a)+_0x5d238a);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x3d2378);}console[_0x513e75(0x167)](_0x513e75(0x133)),console[_0x513e75(0x167)](_0x513e75(0x143),JSON['stringify'](_0x1efd9c,null,0x2)),loggerService_1[_0x513e75(0x10b)][_0x513e75(0x15d)](_0x513e75(0x146),_0x513e75(0x164),_0x4460ca[_0x513e75(0x14d)],_0x1efd9c,_0x316f1a);if(_0x1efd9c[_0x513e75(0x135)]||_0x1efd9c[_0x513e75(0x10d)]){const _0x28d807=_0x1efd9c[_0x513e75(0x13e)]||_0x1efd9c[_0x513e75(0x135)]||_0x513e75(0x139);console['error'](_0x513e75(0xf9)),console[_0x513e75(0x135)](_0x513e75(0x118),_0x28d807),console['error'](_0x513e75(0x13c),_0x1efd9c[_0x513e75(0x10d)]),loggerService_1[_0x513e75(0x10b)][_0x513e75(0xf0)](_0x513e75(0x146),'/payment-links',_0x513e75(0xec)+_0x28d807);throw new Error(_0x513e75(0x102)+_0x28d807);}if(!_0x1efd9c['id']||!_0x1efd9c[_0x513e75(0x165)]?.[_0x513e75(0x16a)]){console['error'](_0x513e75(0x136)),console[_0x513e75(0x135)](_0x513e75(0x11b)),console[_0x513e75(0x135)]('Response\x20data:',_0x1efd9c),loggerService_1['loggerService'][_0x513e75(0xf0)](_0x513e75(0x146),_0x513e75(0x164),_0x513e75(0x159));throw new Error(_0x513e75(0x12f));}return console[_0x513e75(0x167)](_0x513e75(0x10a)),console[_0x513e75(0x167)]('Payment\x20Link\x20ID:',_0x1efd9c['id']),console[_0x513e75(0x167)](_0x513e75(0x128),_0x1efd9c[_0x513e75(0x165)][_0x513e75(0x16a)]),console[_0x513e75(0x167)](_0x513e75(0x13f),_0x1efd9c[_0x513e75(0x165)][_0x513e75(0x127)]||_0x513e75(0xf8)),console[_0x513e75(0x167)](_0x513e75(0x145),_0x26376e,_0x513e75(0x131)),console[_0x513e75(0x167)](_0x513e75(0x148),_0x3885b3),{'gateway_payment_id':_0x1efd9c['id'],'payment_url':_0x1efd9c[_0x513e75(0x165)][_0x513e75(0x16a)],'qr_code_url':_0x1efd9c['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x1efd9c[_0x513e75(0x15f)]};}catch(_0x4658f7){console[_0x513e75(0x135)](_0x513e75(0x138)),console['error'](_0x513e75(0x15c),_0x4658f7),loggerService_1[_0x513e75(0x10b)][_0x513e75(0xf0)](_0x513e75(0x146),_0x513e75(0x164),_0x4658f7);if(_0x4658f7 instanceof Error){console[_0x513e75(0x135)](_0x513e75(0x15e),_0x4658f7['message']),console[_0x513e75(0x135)](_0x513e75(0x104),_0x4658f7[_0x513e75(0x168)]);throw new Error(_0x513e75(0x11c)+_0x4658f7['message']);}throw new Error(_0x513e75(0x16b));}}async['verifyPayment'](_0x118a53){const _0x15e4f3=a44_0x58834d,_0x4475fb=Date['now']();try{loggerService_1[_0x15e4f3(0x10b)]['logWhiteDomainRequest'](_0x15e4f3(0x146),'/payment-links/'+_0x118a53,_0x15e4f3(0xfe),{});const _0x28771d=await fetch(this['apiUrl']+'/'+_0x118a53,{'method':'GET','headers':{'Content-Type':_0x15e4f3(0x149),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x1504dc=Date['now']()-_0x4475fb;if(!_0x28771d['ok']){const _0x297909=await _0x28771d[_0x15e4f3(0x109)]();loggerService_1[_0x15e4f3(0x10b)]['logWhiteDomainResponse']('noda',_0x15e4f3(0xff)+_0x118a53,_0x28771d[_0x15e4f3(0x14d)],_0x297909,_0x1504dc);throw new Error(_0x15e4f3(0xfa)+_0x28771d[_0x15e4f3(0x14d)]);}const _0xfa8919=await _0x28771d['json']();loggerService_1['loggerService'][_0x15e4f3(0x15d)]('noda','/payment-links/'+_0x118a53,_0x28771d[_0x15e4f3(0x14d)],_0xfa8919,_0x1504dc);if(_0xfa8919['error']||_0xfa8919['statusCode']){loggerService_1[_0x15e4f3(0x10b)][_0x15e4f3(0xf0)](_0x15e4f3(0x146),'/payment-links/'+_0x118a53,_0x15e4f3(0x102)+(_0xfa8919[_0x15e4f3(0x13e)]||_0xfa8919[_0x15e4f3(0x135)]||_0x15e4f3(0x11a)));throw new Error(_0x15e4f3(0x102)+(_0xfa8919[_0x15e4f3(0x13e)]||_0xfa8919[_0x15e4f3(0x135)]||'Unknown\x20error'));}let _0x37d61d='PENDING';if(_0xfa8919[_0x15e4f3(0x115)]===![]){if(_0xfa8919['expiryDate']){const _0x32c759=new Date(_0xfa8919['expiryDate']),_0x251a9f=new Date();_0x32c759<_0x251a9f?_0x37d61d=_0x15e4f3(0x142):_0x37d61d='FAILED';}else _0x37d61d=_0x15e4f3(0xf1);}else _0x37d61d=_0x15e4f3(0x152);return{'status':_0x37d61d,'amount':_0xfa8919[_0x15e4f3(0x10e)],'currency':_0xfa8919['currency'],'isActive':_0xfa8919[_0x15e4f3(0x115)]};}catch(_0xb75e24){console[_0x15e4f3(0x135)](_0x15e4f3(0x147),_0xb75e24),loggerService_1[_0x15e4f3(0x10b)][_0x15e4f3(0xf0)](_0x15e4f3(0x146),_0x15e4f3(0xff)+_0x118a53,_0xb75e24);throw new Error(_0x15e4f3(0x124)+(_0xb75e24 instanceof Error?_0xb75e24[_0x15e4f3(0x13e)]:'Unknown\x20error'));}}async[a44_0x58834d(0x129)](_0x1e3f2a){const _0x1fbccd=a44_0x58834d;console[_0x1fbccd(0x167)](_0x1fbccd(0xf6),_0x1e3f2a);let _0x1e609b='PENDING';switch(_0x1e3f2a[_0x1fbccd(0x114)]?.[_0x1fbccd(0x11f)]()){case _0x1fbccd(0x13a):case _0x1fbccd(0x154):case _0x1fbccd(0x105):case'success':case _0x1fbccd(0x107):_0x1e3f2a['Settled']===_0x1fbccd(0x163)?_0x1e609b=_0x1fbccd(0xf4):_0x1e609b=_0x1fbccd(0x152);break;case _0x1fbccd(0x134):case _0x1fbccd(0x113):case _0x1fbccd(0x15b):case _0x1fbccd(0x135):case _0x1fbccd(0x126):_0x1e609b='FAILED';break;case _0x1fbccd(0xee):case _0x1fbccd(0x155):_0x1e609b=_0x1fbccd(0x142);break;case _0x1fbccd(0x156):case'created':case _0x1fbccd(0x169):case _0x1fbccd(0xfb):case'in_progress':default:_0x1e609b='PENDING';break;}return{'paymentId':_0x1e3f2a[_0x1fbccd(0x10f)]||_0x1e3f2a[_0x1fbccd(0x166)],'status':_0x1e609b,'amount':_0x1e3f2a[_0x1fbccd(0x12c)],'currency':_0x1e3f2a[_0x1fbccd(0x132)],'additionalInfo':{'method':_0x1e3f2a[_0x1fbccd(0x14b)],'bankId':_0x1e3f2a[_0x1fbccd(0x13d)],'settled':_0x1e3f2a[_0x1fbccd(0x108)],'settlementDate':_0x1e3f2a[_0x1fbccd(0x153)],'remitterName':_0x1e3f2a[_0x1fbccd(0xed)]?.[_0x1fbccd(0x12a)],'remitterIban':_0x1e3f2a[_0x1fbccd(0xed)]?.[_0x1fbccd(0x100)],'bankTransactionId':_0x1e3f2a[_0x1fbccd(0x123)]}};}['verifyWebhookSignature'](_0x5e2899,_0x839739){const _0x5639eb=a44_0x58834d;return console[_0x5639eb(0x167)](_0x5639eb(0x137),{'receivedSignature':_0x839739,'paymentId':_0x5e2899[_0x5639eb(0x166)],'merchantPaymentId':_0x5e2899['MerchantPaymentId']}),!![];}}exports[a44_0x58834d(0x140)]=NodaService;