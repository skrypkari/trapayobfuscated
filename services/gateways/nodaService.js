'use strict';const a40_0x14516c=a40_0x214b;function a40_0x57dd(){const _0x85f90b=['Error\x20message:','success','Status','loggerService','BankId','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','in_progress','isActive','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','GET','processing','paid','https://tesoft.uk/gateway/noda/webhook/','canceled','error','logWhiteDomainError','Unknown\x20error\x20from\x20Noda\x20API','Settled','Short\x20Link:','===\x20NODA\x20SUCCESS\x20===','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','message','Error\x20stack:','noda','2647175TkAnmQ','Missing\x20id\x20or\x20shortLink\x20in\x20response','Currency','SettlementDate','logWhiteDomainResponse','Payment\x20Link\x20ID:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Noda\x20payment\x20verification\x20error:','/payment-links','Name','Order\x20ID\x20Used:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Amount','application/json','PENDING','statusText','done','Headers:','POST','status','text','headers','entries','timeout','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Raw\x20Response\x20Body:','MerchantPaymentId','verifyWebhookSignature','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Error\x20Message:','currency','7nmclBw','36632rHKVRB','apiUrl','URL:','BankTransactionId','Error\x20details:','9jzgARH','successful','NodaService','175084rSatsE','statusCode','expiryDate','Method','json','stack','FAILED','HTTP\x20error!\x20status:\x20','failed','qrCodeLink','15DJaOEu','===\x20NODA\x20API\x20ERROR\x20===','(8digits-8digits\x20format)','pending','logWhiteDomainRequest','Status\x20Code:',',\x20body:\x20','https://tesoft.uk/gateway/success.php?id=','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','517726fgVhkH','Parsed\x20Result:','Not\x20provided','Unknown\x20error','shortLink','amount','now','(8digits-8digits\x20format\x20for\x20Noda)','QR\x20Code\x20Link:','completed','verifyPayment','Remitter','7446260KqJggz','Response\x20Body:','processWebhook','shortLinkUrls','TesSoft\x20Payment\x20System/1.0','PaymentId','stringify','cancelled','Noda\x20API\x20error:\x20','525630GlFxQG','Processing\x20Noda\x20webhook:','active','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','/payment-links/','fromEntries','__esModule','EXPIRED','log','3749292dxNwnW','===\x20PARSED\x20NODA\x20RESPONSE\x20==='];a40_0x57dd=function(){return _0x85f90b;};return a40_0x57dd();}(function(_0x3d4e28,_0x405717){const _0x3bb444=a40_0x214b,_0x41158a=_0x3d4e28();while(!![]){try{const _0x5b11dd=-parseInt(_0x3bb444(0xfa))/0x1+parseInt(_0x3bb444(0x10f))/0x2+-parseInt(_0x3bb444(0xf1))/0x3*(parseInt(_0x3bb444(0xe7))/0x4)+-parseInt(_0x3bb444(0xbf))/0x5+parseInt(_0x3bb444(0x118))/0x6*(parseInt(_0x3bb444(0xde))/0x7)+parseInt(_0x3bb444(0xdf))/0x8*(parseInt(_0x3bb444(0xe4))/0x9)+parseInt(_0x3bb444(0x106))/0xa;if(_0x5b11dd===_0x405717)break;else _0x41158a['push'](_0x41158a['shift']());}catch(_0x1f6fdb){_0x41158a['push'](_0x41158a['shift']());}}}(a40_0x57dd,0x5a8c6));function a40_0x214b(_0x38eb87,_0x2f9c14){const _0x57dd7a=a40_0x57dd();return a40_0x214b=function(_0x214b30,_0x31736f){_0x214b30=_0x214b30-0xa6;let _0x354c3f=_0x57dd7a[_0x214b30];return _0x354c3f;},a40_0x214b(_0x38eb87,_0x2f9c14);}Object['defineProperty'](exports,a40_0x14516c(0x115),{'value':!![]}),exports[a40_0x14516c(0xe6)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x2b55e9=a40_0x14516c;this[_0x2b55e9(0xe0)]='https://tesoft.uk/gateway/noda/',console['log'](_0x2b55e9(0xab));}async['createPaymentLink'](_0x1bba64){const _0x2aa75a=a40_0x14516c,{orderId:_0x2e8b08,name:_0x3a9ded,paymentDescription:_0x58139c,amount:_0xa4aeb6,currency:_0x73e107,webhookUrl:_0x4d7281,returnUrl:_0x470934,expiryDate:_0x408440}=_0x1bba64,_0x16e2b4=_0x73e107['toUpperCase'](),_0x5b930e=_0x2aa75a(0xb3),_0x25dd4c=_0x2aa75a(0xf8)+_0x2e8b08,_0x32a4b1={'name':_0x3a9ded,'paymentDescription':_0x58139c,'amount':_0xa4aeb6,'currency':_0x16e2b4,'paymentId':_0x2e8b08,'webhookUrl':_0x5b930e,'returnUrl':_0x25dd4c};_0x408440&&(_0x32a4b1[_0x2aa75a(0xe9)]=_0x408440);const _0x577359=Date[_0x2aa75a(0x100)]();try{console[_0x2aa75a(0x117)](_0x2aa75a(0xf9)),console[_0x2aa75a(0x117)](_0x2aa75a(0xe1),this[_0x2aa75a(0xe0)]),console[_0x2aa75a(0x117)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x2aa75a(0x10c)](_0x32a4b1,null,0x2)),console['log']('Order\x20ID\x20Format:',_0x2e8b08,_0x2aa75a(0x101)),loggerService_1[_0x2aa75a(0xa9)][_0x2aa75a(0xf5)](_0x2aa75a(0xbe),_0x2aa75a(0xc7),_0x2aa75a(0xd1),_0x32a4b1);const _0x1e86f0=await fetch(this['apiUrl'],{'method':_0x2aa75a(0xd1),'headers':{'Content-Type':'application/json','Accept':_0x2aa75a(0xcc),'User-Agent':_0x2aa75a(0x10a)},'body':JSON[_0x2aa75a(0x10c)](_0x32a4b1)}),_0x4abf32=Date[_0x2aa75a(0x100)]()-_0x577359;console[_0x2aa75a(0x117)](_0x2aa75a(0xca)),console[_0x2aa75a(0x117)]('Status:',_0x1e86f0[_0x2aa75a(0xd2)]),console[_0x2aa75a(0x117)]('Status\x20Text:',_0x1e86f0[_0x2aa75a(0xce)]),console['log'](_0x2aa75a(0xd0),Object[_0x2aa75a(0x114)](_0x1e86f0[_0x2aa75a(0xd4)][_0x2aa75a(0xd5)]())),console['log']('Response\x20Time:',_0x4abf32+'ms');const _0x4c5f6=await _0x1e86f0[_0x2aa75a(0xd3)]();console[_0x2aa75a(0x117)](_0x2aa75a(0xd8),_0x4c5f6);if(!_0x1e86f0['ok']){console[_0x2aa75a(0xb5)](_0x2aa75a(0xf2)),console[_0x2aa75a(0xb5)]('HTTP\x20Status:',_0x1e86f0[_0x2aa75a(0xd2)]),console[_0x2aa75a(0xb5)](_0x2aa75a(0x107),_0x4c5f6),loggerService_1[_0x2aa75a(0xa9)]['logWhiteDomainResponse']('noda',_0x2aa75a(0xc7),_0x1e86f0['status'],_0x4c5f6,_0x4abf32),loggerService_1[_0x2aa75a(0xa9)][_0x2aa75a(0xb6)]('noda',_0x2aa75a(0xc7),'HTTP\x20'+_0x1e86f0['status']+':\x20'+_0x4c5f6);if(_0x1e86f0[_0x2aa75a(0xd2)]===0x190)throw new Error(_0x2aa75a(0xbb));else{if(_0x1e86f0[_0x2aa75a(0xd2)]===0x1f4)throw new Error(_0x2aa75a(0xd7));}throw new Error(_0x2aa75a(0xee)+_0x1e86f0[_0x2aa75a(0xd2)]+_0x2aa75a(0xf7)+_0x4c5f6);}let _0x8cb427;try{_0x8cb427=JSON['parse'](_0x4c5f6);}catch(_0x59f7c8){console[_0x2aa75a(0xb5)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x59f7c8),loggerService_1[_0x2aa75a(0xa9)][_0x2aa75a(0xb6)](_0x2aa75a(0xbe),'/payment-links','JSON\x20Parse\x20Error:\x20'+_0x59f7c8);throw new Error(_0x2aa75a(0xc5)+_0x4c5f6);}console[_0x2aa75a(0x117)](_0x2aa75a(0x119)),console[_0x2aa75a(0x117)](_0x2aa75a(0xfb),JSON[_0x2aa75a(0x10c)](_0x8cb427,null,0x2)),loggerService_1['loggerService'][_0x2aa75a(0xc3)](_0x2aa75a(0xbe),_0x2aa75a(0xc7),_0x1e86f0[_0x2aa75a(0xd2)],_0x8cb427,_0x4abf32);if(_0x8cb427[_0x2aa75a(0xb5)]||_0x8cb427['statusCode']){const _0x2cf42c=_0x8cb427['message']||_0x8cb427[_0x2aa75a(0xb5)]||_0x2aa75a(0xb7);console[_0x2aa75a(0xb5)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x2aa75a(0xb5)](_0x2aa75a(0xdc),_0x2cf42c),console[_0x2aa75a(0xb5)](_0x2aa75a(0xf6),_0x8cb427['statusCode']),loggerService_1[_0x2aa75a(0xa9)][_0x2aa75a(0xb6)](_0x2aa75a(0xbe),_0x2aa75a(0xc7),'Business\x20Error:\x20'+_0x2cf42c);throw new Error(_0x2aa75a(0x10e)+_0x2cf42c);}if(!_0x8cb427['id']||!_0x8cb427['shortLinkUrls']?.[_0x2aa75a(0xfe)]){console[_0x2aa75a(0xb5)](_0x2aa75a(0x112)),console[_0x2aa75a(0xb5)](_0x2aa75a(0xc0)),console[_0x2aa75a(0xb5)]('Response\x20data:',_0x8cb427),loggerService_1[_0x2aa75a(0xa9)][_0x2aa75a(0xb6)](_0x2aa75a(0xbe),'/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x2aa75a(0xae));}return console[_0x2aa75a(0x117)](_0x2aa75a(0xba)),console[_0x2aa75a(0x117)](_0x2aa75a(0xc4),_0x8cb427['id']),console[_0x2aa75a(0x117)](_0x2aa75a(0xb9),_0x8cb427[_0x2aa75a(0x109)][_0x2aa75a(0xfe)]),console[_0x2aa75a(0x117)](_0x2aa75a(0x102),_0x8cb427[_0x2aa75a(0x109)][_0x2aa75a(0xf0)]||_0x2aa75a(0xfc)),console[_0x2aa75a(0x117)](_0x2aa75a(0xc9),_0x2e8b08,_0x2aa75a(0xf3)),{'gateway_payment_id':_0x8cb427['id'],'payment_url':_0x8cb427['shortLinkUrls'][_0x2aa75a(0xfe)],'qr_code_url':_0x8cb427[_0x2aa75a(0x109)][_0x2aa75a(0xf0)],'expiry_date':_0x8cb427[_0x2aa75a(0xe9)]};}catch(_0x1f64f0){console[_0x2aa75a(0xb5)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x2aa75a(0xb5)](_0x2aa75a(0xe3),_0x1f64f0),loggerService_1[_0x2aa75a(0xa9)][_0x2aa75a(0xb6)](_0x2aa75a(0xbe),'/payment-links',_0x1f64f0);if(_0x1f64f0 instanceof Error){console[_0x2aa75a(0xb5)](_0x2aa75a(0xa6),_0x1f64f0[_0x2aa75a(0xbc)]),console['error'](_0x2aa75a(0xbd),_0x1f64f0[_0x2aa75a(0xec)]);throw new Error(_0x2aa75a(0xaf)+_0x1f64f0[_0x2aa75a(0xbc)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x14516c(0x104)](_0xf0c176){const _0x47e4c6=a40_0x14516c,_0xb0ed7c=Date[_0x47e4c6(0x100)]();try{loggerService_1[_0x47e4c6(0xa9)]['logWhiteDomainRequest'](_0x47e4c6(0xbe),_0x47e4c6(0x113)+_0xf0c176,'GET',{});const _0x5784c7=await fetch(this[_0x47e4c6(0xe0)]+'/'+_0xf0c176,{'method':_0x47e4c6(0xb0),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x3108dd=Date['now']()-_0xb0ed7c;if(!_0x5784c7['ok']){const _0x58955d=await _0x5784c7[_0x47e4c6(0xd3)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x47e4c6(0xbe),'/payment-links/'+_0xf0c176,_0x5784c7['status'],_0x58955d,_0x3108dd);throw new Error(_0x47e4c6(0xee)+_0x5784c7[_0x47e4c6(0xd2)]);}const _0x146a2b=await _0x5784c7[_0x47e4c6(0xeb)]();loggerService_1[_0x47e4c6(0xa9)][_0x47e4c6(0xc3)](_0x47e4c6(0xbe),'/payment-links/'+_0xf0c176,_0x5784c7[_0x47e4c6(0xd2)],_0x146a2b,_0x3108dd);if(_0x146a2b['error']||_0x146a2b[_0x47e4c6(0xe8)]){loggerService_1[_0x47e4c6(0xa9)][_0x47e4c6(0xb6)]('noda',_0x47e4c6(0x113)+_0xf0c176,_0x47e4c6(0x10e)+(_0x146a2b[_0x47e4c6(0xbc)]||_0x146a2b[_0x47e4c6(0xb5)]||_0x47e4c6(0xfd)));throw new Error(_0x47e4c6(0x10e)+(_0x146a2b[_0x47e4c6(0xbc)]||_0x146a2b[_0x47e4c6(0xb5)]||_0x47e4c6(0xfd)));}let _0x1bc167='PENDING';if(_0x146a2b[_0x47e4c6(0xad)]===![]){if(_0x146a2b[_0x47e4c6(0xe9)]){const _0x2d5ed7=new Date(_0x146a2b[_0x47e4c6(0xe9)]),_0x44b86a=new Date();_0x2d5ed7<_0x44b86a?_0x1bc167=_0x47e4c6(0x116):_0x1bc167=_0x47e4c6(0xed);}else _0x1bc167=_0x47e4c6(0xed);}else _0x1bc167='PENDING';return{'status':_0x1bc167,'amount':_0x146a2b[_0x47e4c6(0xff)],'currency':_0x146a2b[_0x47e4c6(0xdd)],'isActive':_0x146a2b[_0x47e4c6(0xad)]};}catch(_0x44ea6e){console[_0x47e4c6(0xb5)](_0x47e4c6(0xc6),_0x44ea6e),loggerService_1[_0x47e4c6(0xa9)][_0x47e4c6(0xb6)](_0x47e4c6(0xbe),_0x47e4c6(0x113)+_0xf0c176,_0x44ea6e);throw new Error(_0x47e4c6(0xdb)+(_0x44ea6e instanceof Error?_0x44ea6e[_0x47e4c6(0xbc)]:_0x47e4c6(0xfd)));}}async[a40_0x14516c(0x108)](_0x107a1d){const _0x31c2c9=a40_0x14516c;console['log'](_0x31c2c9(0x110),_0x107a1d);let _0x236f38=_0x31c2c9(0xcd);switch(_0x107a1d[_0x31c2c9(0xa8)]?.['toLowerCase']()){case _0x31c2c9(0xcf):case _0x31c2c9(0x103):case _0x31c2c9(0xb2):case _0x31c2c9(0xa7):case _0x31c2c9(0xe5):_0x107a1d['Settled']==='Yes'?_0x236f38='PAID':_0x236f38=_0x31c2c9(0xcd);break;case _0x31c2c9(0x10d):case _0x31c2c9(0xb4):case _0x31c2c9(0xef):case _0x31c2c9(0xb5):case'rejected':_0x236f38=_0x31c2c9(0xed);break;case'expired':case _0x31c2c9(0xd6):_0x236f38=_0x31c2c9(0x116);break;case _0x31c2c9(0xf4):case'created':case _0x31c2c9(0x111):case _0x31c2c9(0xb1):case _0x31c2c9(0xac):default:_0x236f38=_0x31c2c9(0xcd);break;}return{'paymentId':_0x107a1d[_0x31c2c9(0xd9)]||_0x107a1d[_0x31c2c9(0x10b)],'status':_0x236f38,'amount':_0x107a1d[_0x31c2c9(0xcb)],'currency':_0x107a1d[_0x31c2c9(0xc1)],'additionalInfo':{'method':_0x107a1d[_0x31c2c9(0xea)],'bankId':_0x107a1d[_0x31c2c9(0xaa)],'settled':_0x107a1d[_0x31c2c9(0xb8)],'settlementDate':_0x107a1d[_0x31c2c9(0xc2)],'remitterName':_0x107a1d[_0x31c2c9(0x105)]?.[_0x31c2c9(0xc8)],'remitterIban':_0x107a1d[_0x31c2c9(0x105)]?.['Iban'],'bankTransactionId':_0x107a1d[_0x31c2c9(0xe2)]}};}[a40_0x14516c(0xda)](_0x5d2943,_0x323051){const _0xaae71=a40_0x14516c;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x323051,'paymentId':_0x5d2943[_0xaae71(0x10b)],'merchantPaymentId':_0x5d2943[_0xaae71(0xd9)]}),!![];}}exports['NodaService']=NodaService;