'use strict';const a43_0x164e61=a43_0x5efc;(function(_0x38a6ae,_0x29916f){const _0x1aea5f=a43_0x5efc,_0x1eb5da=_0x38a6ae();while(!![]){try{const _0x473281=-parseInt(_0x1aea5f(0x1e6))/0x1*(parseInt(_0x1aea5f(0x1c8))/0x2)+-parseInt(_0x1aea5f(0x1ab))/0x3+parseInt(_0x1aea5f(0x17d))/0x4+parseInt(_0x1aea5f(0x193))/0x5+-parseInt(_0x1aea5f(0x1a8))/0x6+-parseInt(_0x1aea5f(0x189))/0x7*(-parseInt(_0x1aea5f(0x18d))/0x8)+parseInt(_0x1aea5f(0x1c1))/0x9;if(_0x473281===_0x29916f)break;else _0x1eb5da['push'](_0x1eb5da['shift']());}catch(_0x11329b){_0x1eb5da['push'](_0x1eb5da['shift']());}}}(a43_0x102b,0x9e44c));Object[a43_0x164e61(0x194)](exports,a43_0x164e61(0x1c9),{'value':!![]}),exports[a43_0x164e61(0x18e)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x36ebc1=a43_0x164e61;this[_0x36ebc1(0x1bc)]=_0x36ebc1(0x179),console[_0x36ebc1(0x191)](_0x36ebc1(0x1c5));}async['createPaymentLink'](_0x55628f){const _0x47b397=a43_0x164e61,{orderId:_0xd88009,name:_0x3eea1a,paymentDescription:_0x1c8b61,amount:_0x40949a,currency:_0x49a94a,webhookUrl:_0xcea1d1,returnUrl:_0x1d48ed,expiryDate:_0x22cdc7}=_0x55628f,_0x3773d8=_0x49a94a[_0x47b397(0x18b)](),_0xba9640=_0x47b397(0x1d1),_0x22b808=_0x47b397(0x1da)+_0xd88009,_0x23f80e={'name':_0x3eea1a,'paymentDescription':_0x1c8b61,'amount':_0x40949a,'currency':_0x3773d8,'paymentId':_0xd88009,'webhookUrl':_0xba9640,'returnUrl':_0x22b808};_0x22cdc7&&(_0x23f80e[_0x47b397(0x1dc)]=_0x22cdc7);const _0x4872bb=Date[_0x47b397(0x1ad)]();try{console[_0x47b397(0x191)](_0x47b397(0x197)),console[_0x47b397(0x191)](_0x47b397(0x195),this[_0x47b397(0x1bc)]),console[_0x47b397(0x191)]('Request\x20Body\x20(Direct\x20JSON):',JSON['stringify'](_0x23f80e,null,0x2)),console[_0x47b397(0x191)]('Order\x20ID\x20Format:',_0xd88009,_0x47b397(0x1de)),console[_0x47b397(0x191)](_0x47b397(0x17f),_0x22b808),loggerService_1[_0x47b397(0x1ce)][_0x47b397(0x1a4)](_0x47b397(0x1b7),'/payment-links','POST',_0x23f80e);const _0x2562ff=await fetch(this[_0x47b397(0x1bc)],{'method':_0x47b397(0x1c6),'headers':{'Content-Type':_0x47b397(0x1d4),'Accept':_0x47b397(0x1d4),'User-Agent':_0x47b397(0x1bb)},'body':JSON[_0x47b397(0x1c4)](_0x23f80e)}),_0x3ec7a7=Date[_0x47b397(0x1ad)]()-_0x4872bb;console['log'](_0x47b397(0x174)),console[_0x47b397(0x191)](_0x47b397(0x1e4),_0x2562ff[_0x47b397(0x1e0)]),console[_0x47b397(0x191)](_0x47b397(0x1eb),_0x2562ff[_0x47b397(0x1e2)]),console[_0x47b397(0x191)]('Headers:',Object[_0x47b397(0x1bf)](_0x2562ff[_0x47b397(0x19e)][_0x47b397(0x1af)]())),console[_0x47b397(0x191)](_0x47b397(0x196),_0x3ec7a7+'ms');const _0x151753=await _0x2562ff['text']();console[_0x47b397(0x191)]('Raw\x20Response\x20Body:',_0x151753);if(!_0x2562ff['ok']){console[_0x47b397(0x190)](_0x47b397(0x18c)),console[_0x47b397(0x190)]('HTTP\x20Status:',_0x2562ff[_0x47b397(0x1e0)]),console[_0x47b397(0x190)]('Response\x20Body:',_0x151753),loggerService_1[_0x47b397(0x1ce)][_0x47b397(0x1b1)]('noda',_0x47b397(0x1cf),_0x2562ff['status'],_0x151753,_0x3ec7a7),loggerService_1[_0x47b397(0x1ce)][_0x47b397(0x172)](_0x47b397(0x1b7),'/payment-links','HTTP\x20'+_0x2562ff[_0x47b397(0x1e0)]+':\x20'+_0x151753);if(_0x2562ff[_0x47b397(0x1e0)]===0x190)throw new Error(_0x47b397(0x1ae));else{if(_0x2562ff[_0x47b397(0x1e0)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x47b397(0x1b0)+_0x2562ff[_0x47b397(0x1e0)]+_0x47b397(0x1d0)+_0x151753);}let _0x3d3797;try{_0x3d3797=JSON[_0x47b397(0x175)](_0x151753);}catch(_0x336fe7){console[_0x47b397(0x190)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x336fe7),loggerService_1[_0x47b397(0x1ce)][_0x47b397(0x172)](_0x47b397(0x1b7),_0x47b397(0x1cf),_0x47b397(0x1d6)+_0x336fe7);throw new Error(_0x47b397(0x1a0)+_0x151753);}console['log'](_0x47b397(0x182)),console[_0x47b397(0x191)](_0x47b397(0x176),JSON['stringify'](_0x3d3797,null,0x2)),loggerService_1[_0x47b397(0x1ce)][_0x47b397(0x1b1)]('noda','/payment-links',_0x2562ff['status'],_0x3d3797,_0x3ec7a7);if(_0x3d3797['error']||_0x3d3797[_0x47b397(0x1db)]){const _0x582208=_0x3d3797['message']||_0x3d3797['error']||'Unknown\x20error\x20from\x20Noda\x20API';console['error']('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x47b397(0x184),_0x582208),console[_0x47b397(0x190)](_0x47b397(0x1a3),_0x3d3797[_0x47b397(0x1db)]),loggerService_1[_0x47b397(0x1ce)][_0x47b397(0x172)]('noda','/payment-links',_0x47b397(0x1ba)+_0x582208);throw new Error(_0x47b397(0x1e5)+_0x582208);}if(!_0x3d3797['id']||!_0x3d3797[_0x47b397(0x1b2)]?.[_0x47b397(0x199)]){console[_0x47b397(0x190)](_0x47b397(0x192)),console[_0x47b397(0x190)](_0x47b397(0x1be)),console[_0x47b397(0x190)](_0x47b397(0x1cd),_0x3d3797),loggerService_1[_0x47b397(0x1ce)][_0x47b397(0x172)](_0x47b397(0x1b7),_0x47b397(0x1cf),_0x47b397(0x1ea));throw new Error(_0x47b397(0x1b8));}return console[_0x47b397(0x191)](_0x47b397(0x1a6)),console[_0x47b397(0x191)](_0x47b397(0x1a9),_0x3d3797['id']),console[_0x47b397(0x191)](_0x47b397(0x181),_0x3d3797[_0x47b397(0x1b2)][_0x47b397(0x199)]),console[_0x47b397(0x191)](_0x47b397(0x178),_0x3d3797[_0x47b397(0x1b2)]['qrCodeLink']||_0x47b397(0x1e3)),console['log'](_0x47b397(0x1a7),_0xd88009,_0x47b397(0x1c3)),console['log']('✅\x20Return\x20URL\x20configured\x20for\x20pending:',_0x22b808),{'gateway_payment_id':_0x3d3797['id'],'payment_url':_0x3d3797[_0x47b397(0x1b2)][_0x47b397(0x199)],'qr_code_url':_0x3d3797[_0x47b397(0x1b2)][_0x47b397(0x1b9)],'expiry_date':_0x3d3797[_0x47b397(0x1dc)]};}catch(_0x382471){console['error'](_0x47b397(0x17b)),console[_0x47b397(0x190)]('Error\x20details:',_0x382471),loggerService_1['loggerService']['logWhiteDomainError'](_0x47b397(0x1b7),_0x47b397(0x1cf),_0x382471);if(_0x382471 instanceof Error){console[_0x47b397(0x190)](_0x47b397(0x183),_0x382471[_0x47b397(0x17a)]),console[_0x47b397(0x190)](_0x47b397(0x19a),_0x382471[_0x47b397(0x1e9)]);throw new Error(_0x47b397(0x1b3)+_0x382471[_0x47b397(0x17a)]);}throw new Error(_0x47b397(0x1e8));}}async[a43_0x164e61(0x19d)](_0x362793){const _0x1710cf=a43_0x164e61,_0x3eb094=Date['now']();try{loggerService_1['loggerService'][_0x1710cf(0x1a4)](_0x1710cf(0x1b7),_0x1710cf(0x187)+_0x362793,_0x1710cf(0x1b5),{});const _0x42b6e1=await fetch(this[_0x1710cf(0x1bc)]+'/'+_0x362793,{'method':_0x1710cf(0x1b5),'headers':{'Content-Type':_0x1710cf(0x1d4),'User-Agent':_0x1710cf(0x1bb)}}),_0x3fd445=Date[_0x1710cf(0x1ad)]()-_0x3eb094;if(!_0x42b6e1['ok']){const _0x4c6f80=await _0x42b6e1['text']();loggerService_1[_0x1710cf(0x1ce)][_0x1710cf(0x1b1)]('noda','/payment-links/'+_0x362793,_0x42b6e1['status'],_0x4c6f80,_0x3fd445);throw new Error(_0x1710cf(0x1b0)+_0x42b6e1[_0x1710cf(0x1e0)]);}const _0x5e8652=await _0x42b6e1[_0x1710cf(0x1a2)]();loggerService_1['loggerService'][_0x1710cf(0x1b1)](_0x1710cf(0x1b7),_0x1710cf(0x187)+_0x362793,_0x42b6e1['status'],_0x5e8652,_0x3fd445);if(_0x5e8652[_0x1710cf(0x190)]||_0x5e8652[_0x1710cf(0x1db)]){loggerService_1[_0x1710cf(0x1ce)][_0x1710cf(0x172)](_0x1710cf(0x1b7),_0x1710cf(0x187)+_0x362793,_0x1710cf(0x1e5)+(_0x5e8652[_0x1710cf(0x17a)]||_0x5e8652[_0x1710cf(0x190)]||_0x1710cf(0x19c)));throw new Error(_0x1710cf(0x1e5)+(_0x5e8652[_0x1710cf(0x17a)]||_0x5e8652[_0x1710cf(0x190)]||_0x1710cf(0x19c)));}let _0x27da45=_0x1710cf(0x1d7);if(_0x5e8652[_0x1710cf(0x1d3)]===![]){if(_0x5e8652[_0x1710cf(0x1dc)]){const _0x3b8401=new Date(_0x5e8652[_0x1710cf(0x1dc)]),_0x3a4a2c=new Date();_0x3b8401<_0x3a4a2c?_0x27da45=_0x1710cf(0x198):_0x27da45='FAILED';}else _0x27da45=_0x1710cf(0x19b);}else _0x27da45=_0x1710cf(0x1d7);return{'status':_0x27da45,'amount':_0x5e8652[_0x1710cf(0x1c2)],'currency':_0x5e8652['currency'],'isActive':_0x5e8652[_0x1710cf(0x1d3)]};}catch(_0x3dab6a){console[_0x1710cf(0x190)](_0x1710cf(0x1b4),_0x3dab6a),loggerService_1['loggerService'][_0x1710cf(0x172)](_0x1710cf(0x1b7),_0x1710cf(0x187)+_0x362793,_0x3dab6a);throw new Error(_0x1710cf(0x180)+(_0x3dab6a instanceof Error?_0x3dab6a[_0x1710cf(0x17a)]:_0x1710cf(0x19c)));}}async[a43_0x164e61(0x1e1)](_0x58ae88){const _0x59d91c=a43_0x164e61;console[_0x59d91c(0x191)](_0x59d91c(0x1bd),_0x58ae88);let _0x4d6273=_0x59d91c(0x1d7);switch(_0x58ae88[_0x59d91c(0x17e)]?.[_0x59d91c(0x1ac)]()){case _0x59d91c(0x18f):case _0x59d91c(0x1ca):case _0x59d91c(0x1c0):case _0x59d91c(0x19f):case'successful':_0x58ae88[_0x59d91c(0x1d2)]===_0x59d91c(0x186)?_0x4d6273=_0x59d91c(0x17c):_0x4d6273=_0x59d91c(0x1d7);break;case _0x59d91c(0x1c7):case _0x59d91c(0x188):case _0x59d91c(0x1dd):case _0x59d91c(0x190):case _0x59d91c(0x1d8):_0x4d6273=_0x59d91c(0x19b);break;case _0x59d91c(0x177):case'timeout':_0x4d6273=_0x59d91c(0x198);break;case'pending':case _0x59d91c(0x1cc):case _0x59d91c(0x1b6):case _0x59d91c(0x1a5):case'in_progress':default:_0x4d6273=_0x59d91c(0x1d7);break;}return{'paymentId':_0x58ae88[_0x59d91c(0x18a)]||_0x58ae88[_0x59d91c(0x1d9)],'status':_0x4d6273,'amount':_0x58ae88[_0x59d91c(0x1aa)],'currency':_0x58ae88['Currency'],'additionalInfo':{'method':_0x58ae88[_0x59d91c(0x1df)],'bankId':_0x58ae88[_0x59d91c(0x1cb)],'settled':_0x58ae88['Settled'],'settlementDate':_0x58ae88[_0x59d91c(0x1e7)],'remitterName':_0x58ae88[_0x59d91c(0x1d5)]?.['Name'],'remitterIban':_0x58ae88[_0x59d91c(0x1d5)]?.[_0x59d91c(0x185)],'bankTransactionId':_0x58ae88[_0x59d91c(0x173)]}};}[a43_0x164e61(0x1a1)](_0x105d03,_0x2cbb92){const _0x397f66=a43_0x164e61;return console[_0x397f66(0x191)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x2cbb92,'paymentId':_0x105d03[_0x397f66(0x1d9)],'merchantPaymentId':_0x105d03[_0x397f66(0x18a)]}),!![];}}function a43_0x5efc(_0x370be3,_0xf8fb87){const _0x102b93=a43_0x102b();return a43_0x5efc=function(_0x5efc27,_0x3036e8){_0x5efc27=_0x5efc27-0x172;let _0xdc291=_0x102b93[_0x5efc27];return _0xdc291;},a43_0x5efc(_0x370be3,_0xf8fb87);}function a43_0x102b(){const _0x486f62=['__esModule','completed','BankId','created','Response\x20data:','loggerService','/payment-links',',\x20body:\x20','https://tesoft.uk/gateway/noda/webhook/','Settled','isActive','application/json','Remitter','JSON\x20Parse\x20Error:\x20','PENDING','rejected','PaymentId','https://tesoft.uk/gateway/pending.php?id=','statusCode','expiryDate','failed','(8digits-8digits\x20format\x20for\x20Noda)','Method','status','processWebhook','statusText','Not\x20provided','Status:','Noda\x20API\x20error:\x20','62996GBIiyu','SettlementDate','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','stack','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Status\x20Text:','logWhiteDomainError','BankTransactionId','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','parse','Parsed\x20Result:','expired','QR\x20Code\x20Link:','https://tesoft.uk/gateway/noda/','message','===\x20NODA\x20SERVICE\x20ERROR\x20===','PAID','2149080VVqwQh','Status','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Short\x20Link:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Error\x20message:','Error\x20Message:','Iban','Yes','/payment-links/','canceled','517867BHVdcn','MerchantPaymentId','toUpperCase','===\x20NODA\x20API\x20ERROR\x20===','56TRNuZv','NodaService','done','error','log','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','4435150LcuCuj','defineProperty','URL:','Response\x20Time:','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','EXPIRED','shortLink','Error\x20stack:','FAILED','Unknown\x20error','verifyPayment','headers','success','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','verifyWebhookSignature','json','Status\x20Code:','logWhiteDomainRequest','processing','===\x20NODA\x20SUCCESS\x20===','Order\x20ID\x20Used:','1125870XJldia','Payment\x20Link\x20ID:','Amount','1443615cLqpjj','toLowerCase','now','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','entries','HTTP\x20error!\x20status:\x20','logWhiteDomainResponse','shortLinkUrls','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Noda\x20payment\x20verification\x20error:','GET','active','noda','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','qrCodeLink','Business\x20Error:\x20','TesSoft\x20Payment\x20System/1.0','apiUrl','Processing\x20Noda\x20webhook:','Missing\x20id\x20or\x20shortLink\x20in\x20response','fromEntries','paid','2879019oXlctj','amount','(8digits-8digits\x20format)','stringify','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','POST','cancelled','30SvVitj'];a43_0x102b=function(){return _0x486f62;};return a43_0x102b();}exports[a43_0x164e61(0x18e)]=NodaService;