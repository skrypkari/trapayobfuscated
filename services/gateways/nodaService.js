'use strict';const a42_0x29abd7=a42_0x4578;function a42_0x4578(_0x4b2c18,_0x41f529){const _0x43c142=a42_0x43c1();return a42_0x4578=function(_0x4578a5,_0x2ee668){_0x4578a5=_0x4578a5-0x1a2;let _0x3f890c=_0x43c142[_0x4578a5];return _0x3f890c;},a42_0x4578(_0x4b2c18,_0x41f529);}(function(_0x3a6c53,_0x2c4030){const _0x18bb52=a42_0x4578,_0x164147=_0x3a6c53();while(!![]){try{const _0x58335b=-parseInt(_0x18bb52(0x1ec))/0x1*(parseInt(_0x18bb52(0x1d4))/0x2)+parseInt(_0x18bb52(0x1ac))/0x3+parseInt(_0x18bb52(0x1cb))/0x4*(parseInt(_0x18bb52(0x1f7))/0x5)+parseInt(_0x18bb52(0x1f6))/0x6+-parseInt(_0x18bb52(0x1bc))/0x7*(parseInt(_0x18bb52(0x1b9))/0x8)+parseInt(_0x18bb52(0x1f3))/0x9*(parseInt(_0x18bb52(0x1f8))/0xa)+parseInt(_0x18bb52(0x219))/0xb;if(_0x58335b===_0x2c4030)break;else _0x164147['push'](_0x164147['shift']());}catch(_0x593dc8){_0x164147['push'](_0x164147['shift']());}}}(a42_0x43c1,0x3493d));Object[a42_0x29abd7(0x1b5)](exports,a42_0x29abd7(0x1e7),{'value':!![]}),exports[a42_0x29abd7(0x20d)]=void 0x0;const loggerService_1=require(a42_0x29abd7(0x1a9));function a42_0x43c1(){const _0x2a5499=['===\x20NODA\x20SUCCESS\x20===','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','EXPIRED','Status\x20Text:','Iban','67448HBwIHi','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','PENDING','Response\x20Time:','Error\x20stack:','HTTP\x20Status:','https://tesoft.uk/gateway/noda/','/payment-links','processing','QR\x20Code\x20Link:','Business\x20Error:\x20','TesSoft\x20Payment\x20System/1.0','shortLinkUrls','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','BankTransactionId','application/json','Currency','verifyWebhookSignature','statusText','__esModule','Yes','expired','qrCodeLink','Short\x20Link:','12faJxFK','loggerService','timeout','statusCode','rejected','successful','logWhiteDomainRequest','9ufAbnU','Order\x20ID\x20Format:','shortLink','259992viNUHK','20QKnJGq','213540albPGO','success','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Unknown\x20error','Response\x20Body:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','Failed\x20to\x20parse\x20JSON\x20response:','===\x20PARSED\x20NODA\x20RESPONSE\x20===','message','expiryDate','status','toLowerCase','logWhiteDomainResponse','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Noda\x20API\x20error:\x20','completed','apiUrl','canceled','parse','/payment-links/','Payment\x20Link\x20ID:','NodaService','FAILED','currency','Noda\x20webhook\x20signature\x20verification:','URL:','Status','active','noda','Remitter','Name','https://tesoft.uk/gateway/pending.php?id=','HTTP\x20','1663629GoWFhC','Status:','fromEntries','stringify',',\x20body:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Unknown\x20error\x20from\x20Noda\x20API','logWhiteDomainError','in_progress','toUpperCase','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','PAID','../loggerService','isActive','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','268437dFOBEJ','Error\x20message:','===\x20NODA\x20API\x20ERROR\x20===','processWebhook','paid','POST','Failed\x20to\x20verify\x20Noda\x20payment:\x20','(8digits-8digits\x20format\x20for\x20Noda)','cancelled','defineProperty','json','headers','JSON\x20Parse\x20Error:\x20','2056VgPGiq','Processing\x20Noda\x20webhook:','MerchantPaymentId','2877KtWjWv','Noda\x20payment\x20verification\x20error:','Error\x20details:','BankId','done','text','PaymentId','Method','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','log','Settled','stack','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Headers:','error','420268UEjEkV','now','entries','GET'];a42_0x43c1=function(){return _0x2a5499;};return a42_0x43c1();}class NodaService{constructor(){const _0x4af5d6=a42_0x29abd7;this[_0x4af5d6(0x208)]=_0x4af5d6(0x1da),console[_0x4af5d6(0x1c5)]('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async['createPaymentLink'](_0x413442){const _0x400fd9=a42_0x29abd7,{orderId:_0x2e0b10,name:_0x3a94d5,paymentDescription:_0x27e9f3,amount:_0x25879a,currency:_0x2908fb,webhookUrl:_0x3c7347,returnUrl:_0x41751a,expiryDate:_0x15b4c8}=_0x413442,_0x225d9a=_0x2908fb[_0x400fd9(0x1a6)](),_0x2906b1='https://tesoft.uk/gateway/noda/webhook/',_0x4333ed=_0x400fd9(0x217)+_0x2e0b10,_0x4864fc={'name':_0x3a94d5,'paymentDescription':_0x27e9f3,'amount':_0x25879a,'currency':_0x225d9a,'paymentId':_0x2e0b10,'webhookUrl':_0x2906b1,'returnUrl':_0x4333ed};_0x15b4c8&&(_0x4864fc['expiryDate']=_0x15b4c8);const _0x3bd625=Date[_0x400fd9(0x1cc)]();try{console[_0x400fd9(0x1c5)](_0x400fd9(0x1d0)),console[_0x400fd9(0x1c5)](_0x400fd9(0x211),this[_0x400fd9(0x208)]),console[_0x400fd9(0x1c5)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x400fd9(0x21c)](_0x4864fc,null,0x2)),console['log'](_0x400fd9(0x1f4),_0x2e0b10,_0x400fd9(0x1b3)),console[_0x400fd9(0x1c5)](_0x400fd9(0x1d5),_0x4333ed),loggerService_1['loggerService'][_0x400fd9(0x1f2)]('noda',_0x400fd9(0x1db),_0x400fd9(0x1b1),_0x4864fc);const _0x502a9a=await fetch(this['apiUrl'],{'method':_0x400fd9(0x1b1),'headers':{'Content-Type':_0x400fd9(0x1e3),'Accept':_0x400fd9(0x1e3),'User-Agent':_0x400fd9(0x1df)},'body':JSON[_0x400fd9(0x21c)](_0x4864fc)}),_0x554b6f=Date[_0x400fd9(0x1cc)]()-_0x3bd625;console[_0x400fd9(0x1c5)](_0x400fd9(0x1fa)),console['log'](_0x400fd9(0x21a),_0x502a9a[_0x400fd9(0x202)]),console[_0x400fd9(0x1c5)](_0x400fd9(0x1d2),_0x502a9a[_0x400fd9(0x1e6)]),console[_0x400fd9(0x1c5)](_0x400fd9(0x1c9),Object[_0x400fd9(0x21b)](_0x502a9a[_0x400fd9(0x1b7)][_0x400fd9(0x1cd)]())),console[_0x400fd9(0x1c5)](_0x400fd9(0x1d7),_0x554b6f+'ms');const _0x72fee1=await _0x502a9a['text']();console[_0x400fd9(0x1c5)]('Raw\x20Response\x20Body:',_0x72fee1);if(!_0x502a9a['ok']){console[_0x400fd9(0x1ca)](_0x400fd9(0x1ae)),console[_0x400fd9(0x1ca)](_0x400fd9(0x1d9),_0x502a9a[_0x400fd9(0x202)]),console[_0x400fd9(0x1ca)](_0x400fd9(0x1fc),_0x72fee1),loggerService_1[_0x400fd9(0x1ed)][_0x400fd9(0x204)]('noda',_0x400fd9(0x1db),_0x502a9a[_0x400fd9(0x202)],_0x72fee1,_0x554b6f),loggerService_1['loggerService'][_0x400fd9(0x1a4)](_0x400fd9(0x214),_0x400fd9(0x1db),_0x400fd9(0x218)+_0x502a9a[_0x400fd9(0x202)]+':\x20'+_0x72fee1);if(_0x502a9a[_0x400fd9(0x202)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x502a9a[_0x400fd9(0x202)]===0x1f4)throw new Error(_0x400fd9(0x1ab));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x502a9a[_0x400fd9(0x202)]+_0x400fd9(0x21d)+_0x72fee1);}let _0x34d8b8;try{_0x34d8b8=JSON[_0x400fd9(0x20a)](_0x72fee1);}catch(_0x3ea5a0){console[_0x400fd9(0x1ca)](_0x400fd9(0x1fe),_0x3ea5a0),loggerService_1[_0x400fd9(0x1ed)]['logWhiteDomainError'](_0x400fd9(0x214),'/payment-links',_0x400fd9(0x1b8)+_0x3ea5a0);throw new Error(_0x400fd9(0x1c4)+_0x72fee1);}console[_0x400fd9(0x1c5)](_0x400fd9(0x1ff)),console[_0x400fd9(0x1c5)]('Parsed\x20Result:',JSON[_0x400fd9(0x21c)](_0x34d8b8,null,0x2)),loggerService_1['loggerService'][_0x400fd9(0x204)](_0x400fd9(0x214),'/payment-links',_0x502a9a[_0x400fd9(0x202)],_0x34d8b8,_0x554b6f);if(_0x34d8b8[_0x400fd9(0x1ca)]||_0x34d8b8[_0x400fd9(0x1ef)]){const _0x4562ec=_0x34d8b8[_0x400fd9(0x200)]||_0x34d8b8[_0x400fd9(0x1ca)]||_0x400fd9(0x1a3);console[_0x400fd9(0x1ca)](_0x400fd9(0x1c8)),console['error']('Error\x20Message:',_0x4562ec),console['error']('Status\x20Code:',_0x34d8b8[_0x400fd9(0x1ef)]),loggerService_1[_0x400fd9(0x1ed)][_0x400fd9(0x1a4)]('noda',_0x400fd9(0x1db),_0x400fd9(0x1de)+_0x4562ec);throw new Error(_0x400fd9(0x206)+_0x4562ec);}if(!_0x34d8b8['id']||!_0x34d8b8[_0x400fd9(0x1e0)]?.['shortLink']){console['error'](_0x400fd9(0x1e1)),console[_0x400fd9(0x1ca)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x400fd9(0x1ca)]('Response\x20data:',_0x34d8b8),loggerService_1[_0x400fd9(0x1ed)][_0x400fd9(0x1a4)](_0x400fd9(0x214),_0x400fd9(0x1db),_0x400fd9(0x1a2));throw new Error(_0x400fd9(0x1a7));}return console[_0x400fd9(0x1c5)](_0x400fd9(0x1cf)),console[_0x400fd9(0x1c5)](_0x400fd9(0x20c),_0x34d8b8['id']),console['log'](_0x400fd9(0x1eb),_0x34d8b8[_0x400fd9(0x1e0)][_0x400fd9(0x1f5)]),console[_0x400fd9(0x1c5)](_0x400fd9(0x1dd),_0x34d8b8[_0x400fd9(0x1e0)][_0x400fd9(0x1ea)]||'Not\x20provided'),console['log']('Order\x20ID\x20Used:',_0x2e0b10,'(8digits-8digits\x20format)'),console['log']('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x4333ed),{'gateway_payment_id':_0x34d8b8['id'],'payment_url':_0x34d8b8[_0x400fd9(0x1e0)][_0x400fd9(0x1f5)],'qr_code_url':_0x34d8b8['shortLinkUrls'][_0x400fd9(0x1ea)],'expiry_date':_0x34d8b8[_0x400fd9(0x201)]};}catch(_0x3e04c0){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console['error'](_0x400fd9(0x1be),_0x3e04c0),loggerService_1[_0x400fd9(0x1ed)]['logWhiteDomainError']('noda','/payment-links',_0x3e04c0);if(_0x3e04c0 instanceof Error){console[_0x400fd9(0x1ca)](_0x400fd9(0x1ad),_0x3e04c0[_0x400fd9(0x200)]),console[_0x400fd9(0x1ca)](_0x400fd9(0x1d8),_0x3e04c0[_0x400fd9(0x1c7)]);throw new Error(_0x400fd9(0x205)+_0x3e04c0['message']);}throw new Error(_0x400fd9(0x1fd));}}async['verifyPayment'](_0x5f9408){const _0x47e952=a42_0x29abd7,_0x35e8e2=Date[_0x47e952(0x1cc)]();try{loggerService_1['loggerService']['logWhiteDomainRequest'](_0x47e952(0x214),_0x47e952(0x20b)+_0x5f9408,_0x47e952(0x1ce),{});const _0x313986=await fetch(this[_0x47e952(0x208)]+'/'+_0x5f9408,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':_0x47e952(0x1df)}}),_0x290f42=Date[_0x47e952(0x1cc)]()-_0x35e8e2;if(!_0x313986['ok']){const _0x24a5eb=await _0x313986[_0x47e952(0x1c1)]();loggerService_1[_0x47e952(0x1ed)][_0x47e952(0x204)](_0x47e952(0x214),_0x47e952(0x20b)+_0x5f9408,_0x313986[_0x47e952(0x202)],_0x24a5eb,_0x290f42);throw new Error('HTTP\x20error!\x20status:\x20'+_0x313986[_0x47e952(0x202)]);}const _0x4ed835=await _0x313986[_0x47e952(0x1b6)]();loggerService_1[_0x47e952(0x1ed)][_0x47e952(0x204)](_0x47e952(0x214),_0x47e952(0x20b)+_0x5f9408,_0x313986[_0x47e952(0x202)],_0x4ed835,_0x290f42);if(_0x4ed835[_0x47e952(0x1ca)]||_0x4ed835[_0x47e952(0x1ef)]){loggerService_1[_0x47e952(0x1ed)][_0x47e952(0x1a4)](_0x47e952(0x214),_0x47e952(0x20b)+_0x5f9408,'Noda\x20API\x20error:\x20'+(_0x4ed835[_0x47e952(0x200)]||_0x4ed835[_0x47e952(0x1ca)]||_0x47e952(0x1fb)));throw new Error('Noda\x20API\x20error:\x20'+(_0x4ed835['message']||_0x4ed835[_0x47e952(0x1ca)]||_0x47e952(0x1fb)));}let _0x2a10e2='PENDING';if(_0x4ed835[_0x47e952(0x1aa)]===![]){if(_0x4ed835[_0x47e952(0x201)]){const _0x4bc336=new Date(_0x4ed835['expiryDate']),_0x28bbc2=new Date();_0x4bc336<_0x28bbc2?_0x2a10e2=_0x47e952(0x1d1):_0x2a10e2=_0x47e952(0x20e);}else _0x2a10e2='FAILED';}else _0x2a10e2='PENDING';return{'status':_0x2a10e2,'amount':_0x4ed835['amount'],'currency':_0x4ed835[_0x47e952(0x20f)],'isActive':_0x4ed835[_0x47e952(0x1aa)]};}catch(_0x39eee8){console[_0x47e952(0x1ca)](_0x47e952(0x1bd),_0x39eee8),loggerService_1['loggerService']['logWhiteDomainError'](_0x47e952(0x214),_0x47e952(0x20b)+_0x5f9408,_0x39eee8);throw new Error(_0x47e952(0x1b2)+(_0x39eee8 instanceof Error?_0x39eee8[_0x47e952(0x200)]:'Unknown\x20error'));}}async[a42_0x29abd7(0x1af)](_0x13eb28){const _0x56180c=a42_0x29abd7;console['log'](_0x56180c(0x1ba),_0x13eb28);let _0x73fe01=_0x56180c(0x1d6);switch(_0x13eb28[_0x56180c(0x212)]?.[_0x56180c(0x203)]()){case _0x56180c(0x1c0):case _0x56180c(0x207):case _0x56180c(0x1b0):case _0x56180c(0x1f9):case _0x56180c(0x1f1):_0x13eb28[_0x56180c(0x1c6)]===_0x56180c(0x1e8)?_0x73fe01=_0x56180c(0x1a8):_0x73fe01=_0x56180c(0x1d6);break;case _0x56180c(0x1b4):case _0x56180c(0x209):case'failed':case _0x56180c(0x1ca):case _0x56180c(0x1f0):_0x73fe01='FAILED';break;case _0x56180c(0x1e9):case _0x56180c(0x1ee):_0x73fe01='EXPIRED';break;case'pending':case'created':case _0x56180c(0x213):case _0x56180c(0x1dc):case _0x56180c(0x1a5):default:_0x73fe01='PENDING';break;}return{'paymentId':_0x13eb28[_0x56180c(0x1bb)]||_0x13eb28[_0x56180c(0x1c2)],'status':_0x73fe01,'amount':_0x13eb28['Amount'],'currency':_0x13eb28[_0x56180c(0x1e4)],'additionalInfo':{'method':_0x13eb28[_0x56180c(0x1c3)],'bankId':_0x13eb28[_0x56180c(0x1bf)],'settled':_0x13eb28['Settled'],'settlementDate':_0x13eb28['SettlementDate'],'remitterName':_0x13eb28[_0x56180c(0x215)]?.[_0x56180c(0x216)],'remitterIban':_0x13eb28[_0x56180c(0x215)]?.[_0x56180c(0x1d3)],'bankTransactionId':_0x13eb28[_0x56180c(0x1e2)]}};}[a42_0x29abd7(0x1e5)](_0x52842c,_0x475105){const _0x563f6f=a42_0x29abd7;return console[_0x563f6f(0x1c5)](_0x563f6f(0x210),{'receivedSignature':_0x475105,'paymentId':_0x52842c[_0x563f6f(0x1c2)],'merchantPaymentId':_0x52842c[_0x563f6f(0x1bb)]}),!![];}}exports[a42_0x29abd7(0x20d)]=NodaService;