'use strict';const a43_0x57430a=a43_0x5167;(function(_0x4e512a,_0x2170da){const _0x2f9bea=a43_0x5167,_0xa75865=_0x4e512a();while(!![]){try{const _0x11ece0=-parseInt(_0x2f9bea(0x1ad))/0x1+-parseInt(_0x2f9bea(0x15f))/0x2+-parseInt(_0x2f9bea(0x185))/0x3+-parseInt(_0x2f9bea(0x190))/0x4+parseInt(_0x2f9bea(0x195))/0x5+-parseInt(_0x2f9bea(0x17e))/0x6+-parseInt(_0x2f9bea(0x17d))/0x7*(-parseInt(_0x2f9bea(0x19e))/0x8);if(_0x11ece0===_0x2170da)break;else _0xa75865['push'](_0xa75865['shift']());}catch(_0x4ce798){_0xa75865['push'](_0xa75865['shift']());}}}(a43_0x201d,0x25f12));Object[a43_0x57430a(0x15d)](exports,a43_0x57430a(0x167),{'value':!![]}),exports[a43_0x57430a(0x16b)]=void 0x0;function a43_0x5167(_0x3afc79,_0x5805a4){const _0x201d25=a43_0x201d();return a43_0x5167=function(_0x51676a,_0x43554f){_0x51676a=_0x51676a-0x13d;let _0x2121b7=_0x201d25[_0x51676a];return _0x2121b7;},a43_0x5167(_0x3afc79,_0x5805a4);}const loggerService_1=require(a43_0x57430a(0x155));class NodaService{constructor(){const _0x1ab9f7=a43_0x57430a;this[_0x1ab9f7(0x146)]=_0x1ab9f7(0x19d),console[_0x1ab9f7(0x163)](_0x1ab9f7(0x16e));}async[a43_0x57430a(0x1a5)](_0x496a5b){const _0x3c0240=a43_0x57430a,{orderId:_0x365516,name:_0x207745,paymentDescription:_0x4e56eb,amount:_0x3f23d9,currency:_0x282058,webhookUrl:_0x30b103,returnUrl:_0x44b245,expiryDate:_0x117a0a}=_0x496a5b,_0x2d42c3=_0x282058[_0x3c0240(0x168)](),_0x19cd58=_0x3c0240(0x152),_0x3d12e4=_0x3c0240(0x142)+_0x365516,_0x1eef9a={'name':_0x207745,'paymentDescription':_0x4e56eb,'amount':_0x3f23d9,'currency':_0x2d42c3,'paymentId':_0x365516,'webhookUrl':_0x19cd58,'returnUrl':_0x3d12e4};_0x117a0a&&(_0x1eef9a['expiryDate']=_0x117a0a);const _0x25947b=Date[_0x3c0240(0x17a)]();try{console['log'](_0x3c0240(0x1a3)),console[_0x3c0240(0x163)]('URL:',this[_0x3c0240(0x146)]),console[_0x3c0240(0x163)](_0x3c0240(0x160),JSON[_0x3c0240(0x1a0)](_0x1eef9a,null,0x2)),console[_0x3c0240(0x163)](_0x3c0240(0x154),_0x365516,_0x3c0240(0x143)),console[_0x3c0240(0x163)]('✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:',_0x3d12e4),loggerService_1['loggerService'][_0x3c0240(0x14e)](_0x3c0240(0x14c),'/payment-links','POST',_0x1eef9a);const _0xeda490=await fetch(this[_0x3c0240(0x146)],{'method':_0x3c0240(0x169),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x3c0240(0x147)},'body':JSON[_0x3c0240(0x1a0)](_0x1eef9a)}),_0x2e2f2b=Date[_0x3c0240(0x17a)]()-_0x25947b;console['log'](_0x3c0240(0x141)),console[_0x3c0240(0x163)](_0x3c0240(0x191),_0xeda490[_0x3c0240(0x14f)]),console[_0x3c0240(0x163)](_0x3c0240(0x164),_0xeda490[_0x3c0240(0x13e)]),console[_0x3c0240(0x163)](_0x3c0240(0x188),Object[_0x3c0240(0x179)](_0xeda490['headers'][_0x3c0240(0x18c)]())),console[_0x3c0240(0x163)]('Response\x20Time:',_0x2e2f2b+'ms');const _0x30abe8=await _0xeda490[_0x3c0240(0x148)]();console['log'](_0x3c0240(0x1b0),_0x30abe8);if(!_0xeda490['ok']){console[_0x3c0240(0x17c)](_0x3c0240(0x15e)),console['error'](_0x3c0240(0x19a),_0xeda490[_0x3c0240(0x14f)]),console[_0x3c0240(0x17c)](_0x3c0240(0x1a7),_0x30abe8),loggerService_1[_0x3c0240(0x18f)][_0x3c0240(0x18a)]('noda',_0x3c0240(0x180),_0xeda490['status'],_0x30abe8,_0x2e2f2b),loggerService_1[_0x3c0240(0x18f)][_0x3c0240(0x16d)]('noda',_0x3c0240(0x180),_0x3c0240(0x157)+_0xeda490[_0x3c0240(0x14f)]+':\x20'+_0x30abe8);if(_0xeda490[_0x3c0240(0x14f)]===0x190)throw new Error(_0x3c0240(0x15a));else{if(_0xeda490[_0x3c0240(0x14f)]===0x1f4)throw new Error(_0x3c0240(0x18d));}throw new Error(_0x3c0240(0x13f)+_0xeda490['status']+',\x20body:\x20'+_0x30abe8);}let _0x19cb26;try{_0x19cb26=JSON[_0x3c0240(0x187)](_0x30abe8);}catch(_0x4fee5f){console[_0x3c0240(0x17c)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x4fee5f),loggerService_1['loggerService'][_0x3c0240(0x16d)](_0x3c0240(0x14c),_0x3c0240(0x180),_0x3c0240(0x198)+_0x4fee5f);throw new Error(_0x3c0240(0x184)+_0x30abe8);}console[_0x3c0240(0x163)](_0x3c0240(0x17b)),console[_0x3c0240(0x163)]('Parsed\x20Result:',JSON[_0x3c0240(0x1a0)](_0x19cb26,null,0x2)),loggerService_1[_0x3c0240(0x18f)][_0x3c0240(0x18a)](_0x3c0240(0x14c),_0x3c0240(0x180),_0xeda490['status'],_0x19cb26,_0x2e2f2b);if(_0x19cb26[_0x3c0240(0x17c)]||_0x19cb26[_0x3c0240(0x1aa)]){const _0x80098d=_0x19cb26[_0x3c0240(0x18b)]||_0x19cb26[_0x3c0240(0x17c)]||_0x3c0240(0x171);console[_0x3c0240(0x17c)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x3c0240(0x1ac),_0x80098d),console[_0x3c0240(0x17c)](_0x3c0240(0x16a),_0x19cb26[_0x3c0240(0x1aa)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x3c0240(0x14c),_0x3c0240(0x180),_0x3c0240(0x182)+_0x80098d);throw new Error('Noda\x20API\x20error:\x20'+_0x80098d);}if(!_0x19cb26['id']||!_0x19cb26[_0x3c0240(0x1a6)]?.[_0x3c0240(0x194)]){console[_0x3c0240(0x17c)](_0x3c0240(0x1af)),console[_0x3c0240(0x17c)](_0x3c0240(0x197)),console[_0x3c0240(0x17c)](_0x3c0240(0x172),_0x19cb26),loggerService_1['loggerService']['logWhiteDomainError'](_0x3c0240(0x14c),_0x3c0240(0x180),_0x3c0240(0x144));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console[_0x3c0240(0x163)]('Payment\x20Link\x20ID:',_0x19cb26['id']),console[_0x3c0240(0x163)](_0x3c0240(0x1b1),_0x19cb26[_0x3c0240(0x1a6)][_0x3c0240(0x194)]),console[_0x3c0240(0x163)](_0x3c0240(0x196),_0x19cb26[_0x3c0240(0x1a6)][_0x3c0240(0x14a)]||_0x3c0240(0x17f)),console[_0x3c0240(0x163)](_0x3c0240(0x150),_0x365516,_0x3c0240(0x140)),console[_0x3c0240(0x163)](_0x3c0240(0x173),_0x3d12e4),{'gateway_payment_id':_0x19cb26['id'],'payment_url':_0x19cb26['shortLinkUrls']['shortLink'],'qr_code_url':_0x19cb26[_0x3c0240(0x1a6)][_0x3c0240(0x14a)],'expiry_date':_0x19cb26[_0x3c0240(0x18e)]};}catch(_0x53c99a){console[_0x3c0240(0x17c)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x3c0240(0x17c)](_0x3c0240(0x16f),_0x53c99a),loggerService_1['loggerService'][_0x3c0240(0x16d)](_0x3c0240(0x14c),_0x3c0240(0x180),_0x53c99a);if(_0x53c99a instanceof Error){console[_0x3c0240(0x17c)]('Error\x20message:',_0x53c99a[_0x3c0240(0x18b)]),console[_0x3c0240(0x17c)](_0x3c0240(0x1a1),_0x53c99a[_0x3c0240(0x175)]);throw new Error(_0x3c0240(0x159)+_0x53c99a['message']);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x57430a(0x1ab)](_0x545cf9){const _0x46be56=a43_0x57430a,_0x4d3d99=Date[_0x46be56(0x17a)]();try{loggerService_1[_0x46be56(0x18f)]['logWhiteDomainRequest']('noda',_0x46be56(0x1a4)+_0x545cf9,'GET',{});const _0x1073e7=await fetch(this[_0x46be56(0x146)]+'/'+_0x545cf9,{'method':_0x46be56(0x162),'headers':{'Content-Type':_0x46be56(0x193),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x439945=Date[_0x46be56(0x17a)]()-_0x4d3d99;if(!_0x1073e7['ok']){const _0x130c86=await _0x1073e7[_0x46be56(0x148)]();loggerService_1['loggerService'][_0x46be56(0x18a)](_0x46be56(0x14c),_0x46be56(0x1a4)+_0x545cf9,_0x1073e7[_0x46be56(0x14f)],_0x130c86,_0x439945);throw new Error(_0x46be56(0x13f)+_0x1073e7['status']);}const _0x35a7b4=await _0x1073e7[_0x46be56(0x170)]();loggerService_1[_0x46be56(0x18f)][_0x46be56(0x18a)](_0x46be56(0x14c),_0x46be56(0x1a4)+_0x545cf9,_0x1073e7[_0x46be56(0x14f)],_0x35a7b4,_0x439945);if(_0x35a7b4['error']||_0x35a7b4[_0x46be56(0x1aa)]){loggerService_1[_0x46be56(0x18f)][_0x46be56(0x16d)](_0x46be56(0x14c),_0x46be56(0x1a4)+_0x545cf9,_0x46be56(0x14d)+(_0x35a7b4[_0x46be56(0x18b)]||_0x35a7b4[_0x46be56(0x17c)]||'Unknown\x20error'));throw new Error(_0x46be56(0x14d)+(_0x35a7b4[_0x46be56(0x18b)]||_0x35a7b4['error']||_0x46be56(0x156)));}let _0x159225=_0x46be56(0x149);if(_0x35a7b4[_0x46be56(0x19c)]===![]){if(_0x35a7b4[_0x46be56(0x18e)]){const _0x5bc1ca=new Date(_0x35a7b4[_0x46be56(0x18e)]),_0x1ef734=new Date();_0x5bc1ca<_0x1ef734?_0x159225=_0x46be56(0x199):_0x159225='FAILED';}else _0x159225=_0x46be56(0x189);}else _0x159225='PENDING';return{'status':_0x159225,'amount':_0x35a7b4['amount'],'currency':_0x35a7b4[_0x46be56(0x145)],'isActive':_0x35a7b4[_0x46be56(0x19c)]};}catch(_0x2ad8b2){console[_0x46be56(0x17c)](_0x46be56(0x177),_0x2ad8b2),loggerService_1[_0x46be56(0x18f)][_0x46be56(0x16d)](_0x46be56(0x14c),_0x46be56(0x1a4)+_0x545cf9,_0x2ad8b2);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x2ad8b2 instanceof Error?_0x2ad8b2[_0x46be56(0x18b)]:_0x46be56(0x156)));}}async[a43_0x57430a(0x1a9)](_0x48a5a6){const _0x5ee37f=a43_0x57430a;console[_0x5ee37f(0x163)]('Processing\x20Noda\x20webhook:',_0x48a5a6);let _0x4af6ee=_0x5ee37f(0x149);switch(_0x48a5a6['Status']?.['toLowerCase']()){case _0x5ee37f(0x153):case _0x5ee37f(0x192):case'paid':case _0x5ee37f(0x186):case _0x5ee37f(0x16c):_0x48a5a6[_0x5ee37f(0x1ae)]===_0x5ee37f(0x181)?_0x4af6ee='PAID':_0x4af6ee='PENDING';break;case'cancelled':case _0x5ee37f(0x19f):case _0x5ee37f(0x1a8):case _0x5ee37f(0x17c):case _0x5ee37f(0x15b):_0x4af6ee=_0x5ee37f(0x189);break;case _0x5ee37f(0x174):case _0x5ee37f(0x178):_0x4af6ee='EXPIRED';break;case _0x5ee37f(0x13d):case _0x5ee37f(0x151):case'active':case'processing':case _0x5ee37f(0x161):default:_0x4af6ee=_0x5ee37f(0x149);break;}return{'paymentId':_0x48a5a6['MerchantPaymentId']||_0x48a5a6[_0x5ee37f(0x1a2)],'status':_0x4af6ee,'amount':_0x48a5a6['Amount'],'currency':_0x48a5a6[_0x5ee37f(0x14b)],'additionalInfo':{'method':_0x48a5a6[_0x5ee37f(0x166)],'bankId':_0x48a5a6['BankId'],'settled':_0x48a5a6['Settled'],'settlementDate':_0x48a5a6[_0x5ee37f(0x176)],'remitterName':_0x48a5a6[_0x5ee37f(0x165)]?.[_0x5ee37f(0x15c)],'remitterIban':_0x48a5a6[_0x5ee37f(0x165)]?.[_0x5ee37f(0x158)],'bankTransactionId':_0x48a5a6[_0x5ee37f(0x19b)]}};}['verifyWebhookSignature'](_0x596625,_0x8b58a1){const _0x162322=a43_0x57430a;return console[_0x162322(0x163)](_0x162322(0x183),{'receivedSignature':_0x8b58a1,'paymentId':_0x596625[_0x162322(0x1a2)],'merchantPaymentId':_0x596625['MerchantPaymentId']}),!![];}}function a43_0x201d(){const _0x272423=['All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','expiryDate','loggerService','627668pKFClp','Status:','completed','application/json','shortLink','172100QGihmW','QR\x20Code\x20Link:','Missing\x20id\x20or\x20shortLink\x20in\x20response','JSON\x20Parse\x20Error:\x20','EXPIRED','HTTP\x20Status:','BankTransactionId','isActive','https://tesoft.uk/gateway/noda/','1304xdgEdL','canceled','stringify','Error\x20stack:','PaymentId','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','/payment-links/','createPaymentLink','shortLinkUrls','Response\x20Body:','failed','processWebhook','statusCode','verifyPayment','Error\x20Message:','204192lCrxFX','Settled','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Raw\x20Response\x20Body:','Short\x20Link:','pending','statusText','HTTP\x20error!\x20status:\x20','(8digits-8digits\x20format)','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','https://tesoft.uk/gateway/pending.php?id=','(8digits-8digits\x20format\x20for\x20Noda)','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','currency','apiUrl','TesSoft\x20Payment\x20System/1.0','text','PENDING','qrCodeLink','Currency','noda','Noda\x20API\x20error:\x20','logWhiteDomainRequest','status','Order\x20ID\x20Used:','created','https://tesoft.uk/gateway/noda/webhook/','done','Order\x20ID\x20Format:','../loggerService','Unknown\x20error','HTTP\x20','Iban','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','rejected','Name','defineProperty','===\x20NODA\x20API\x20ERROR\x20===','134588XMlPcc','Request\x20Body\x20(Direct\x20JSON):','in_progress','GET','log','Status\x20Text:','Remitter','Method','__esModule','toUpperCase','POST','Status\x20Code:','NodaService','successful','logWhiteDomainError','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20details:','json','Unknown\x20error\x20from\x20Noda\x20API','Response\x20data:','✅\x20Return\x20URL\x20configured\x20for\x20pending:','expired','stack','SettlementDate','Noda\x20payment\x20verification\x20error:','timeout','fromEntries','now','===\x20PARSED\x20NODA\x20RESPONSE\x20===','error','30989iTXIXF','498174oTVuiF','Not\x20provided','/payment-links','Yes','Business\x20Error:\x20','Noda\x20webhook\x20signature\x20verification:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','267537DLQeYA','success','parse','Headers:','FAILED','logWhiteDomainResponse','message','entries'];a43_0x201d=function(){return _0x272423;};return a43_0x201d();}exports[a43_0x57430a(0x16b)]=NodaService;