'use strict';const a42_0x18f997=a42_0x43f7;function a42_0x5800(){const _0x181fb7=['../loggerService','PAID','Request\x20Body\x20(Direct\x20JSON):','Status:','expired','HTTP\x20Status:','Processing\x20Noda\x20webhook:','Noda\x20payment\x20verification\x20error:','EXPIRED','rejected','Response\x20Time:','/payment-links','application/json','statusText','toLowerCase','parse','expiryDate','Error\x20Message:','status','verifyWebhookSignature','===\x20NODA\x20API\x20ERROR\x20===','Order\x20ID\x20Used:','GET','Unknown\x20error\x20from\x20Noda\x20API','paid','Settled','amount','Amount','log','JSON\x20Parse\x20Error:\x20','Yes','Headers:','in_progress','===\x20PARSED\x20NODA\x20RESPONSE\x20===','508545ZGvhTh','logWhiteDomainRequest','(8digits-8digits\x20format\x20for\x20Noda)','created','canceled','logWhiteDomainResponse','PENDING','timeout','https://tesoft.uk/gateway/pending.php?id=','2380455EFqVRF','stringify','https://tesoft.uk/gateway/noda/webhook/','Noda\x20API\x20error:\x20','successful','processing','Failed\x20to\x20verify\x20Noda\x20payment:\x20','isActive','text','===\x20NODA\x20SERVICE\x20ERROR\x20===','MerchantPaymentId','Response\x20data:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Failed\x20to\x20parse\x20JSON\x20response:','now','Status\x20Code:','Unknown\x20error','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','(8digits-8digits\x20format)','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Raw\x20Response\x20Body:','apiUrl','446155orKEjM','createPaymentLink','currency','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink',',\x20body:\x20','/payment-links/','Method','shortLink','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','error','TesSoft\x20Payment\x20System/1.0','Status\x20Text:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','success','logWhiteDomainError','QR\x20Code\x20Link:','statusCode','HTTP\x20','fromEntries','1734498rKQppM','Remitter','__esModule','pending','headers','message','shortLinkUrls','SettlementDate','Not\x20provided','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','defineProperty','cancelled','toUpperCase','365850eyCdja','Error\x20message:','https://tesoft.uk/gateway/noda/','URL:','entries','FAILED','loggerService','Response\x20Body:','Iban','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','12pzddsZ','qrCodeLink','NodaService','PaymentId','2044520LOpLqv','stack','json','223844RvcxhQ','done','Noda\x20webhook\x20signature\x20verification:','BankId','noda','Parsed\x20Result:','processWebhook','Order\x20ID\x20Format:','Short\x20Link:','active'];a42_0x5800=function(){return _0x181fb7;};return a42_0x5800();}(function(_0x28a571,_0x11b3c3){const _0x2f7bbe=a42_0x43f7,_0x53b113=_0x28a571();while(!![]){try{const _0x272113=parseInt(_0x2f7bbe(0x25c))/0x1+-parseInt(_0x2f7bbe(0x24b))/0x2+parseInt(_0x2f7bbe(0x20b))/0x3+-parseInt(_0x2f7bbe(0x255))/0x4*(-parseInt(_0x2f7bbe(0x22a))/0x5)+parseInt(_0x2f7bbe(0x23e))/0x6+-parseInt(_0x2f7bbe(0x214))/0x7+-parseInt(_0x2f7bbe(0x259))/0x8;if(_0x272113===_0x11b3c3)break;else _0x53b113['push'](_0x53b113['shift']());}catch(_0x451f91){_0x53b113['push'](_0x53b113['shift']());}}}(a42_0x5800,0x29e3c));Object[a42_0x18f997(0x248)](exports,a42_0x18f997(0x240),{'value':!![]}),exports[a42_0x18f997(0x257)]=void 0x0;const loggerService_1=require(a42_0x18f997(0x1e9));function a42_0x43f7(_0x413410,_0x18e878){const _0x580011=a42_0x5800();return a42_0x43f7=function(_0x43f752,_0x19b706){_0x43f752=_0x43f752-0x1e3;let _0x1874eb=_0x580011[_0x43f752];return _0x1874eb;},a42_0x43f7(_0x413410,_0x18e878);}class NodaService{constructor(){const _0x38d443=a42_0x18f997;this[_0x38d443(0x229)]=_0x38d443(0x24d),console[_0x38d443(0x205)](_0x38d443(0x237));}async[a42_0x18f997(0x22b)](_0x57798b){const _0x1ce236=a42_0x18f997,{orderId:_0x1422e8,name:_0x51e7c6,paymentDescription:_0x20ed2a,amount:_0x10edaa,currency:_0x133813,webhookUrl:_0x40239b,returnUrl:_0x16a720,expiryDate:_0x5d2eb}=_0x57798b,_0x40248f=_0x133813[_0x1ce236(0x24a)](),_0x10ee3a=_0x1ce236(0x216),_0x336009=_0x1ce236(0x213)+_0x1422e8,_0x3755ee={'name':_0x51e7c6,'paymentDescription':_0x20ed2a,'amount':_0x10edaa,'currency':_0x40248f,'paymentId':_0x1422e8,'webhookUrl':_0x10ee3a,'returnUrl':_0x336009};_0x5d2eb&&(_0x3755ee[_0x1ce236(0x1f9)]=_0x5d2eb);const _0x26ef33=Date[_0x1ce236(0x222)]();try{console[_0x1ce236(0x205)](_0x1ce236(0x254)),console[_0x1ce236(0x205)](_0x1ce236(0x24e),this[_0x1ce236(0x229)]),console['log'](_0x1ce236(0x1eb),JSON[_0x1ce236(0x215)](_0x3755ee,null,0x2)),console['log'](_0x1ce236(0x1e6),_0x1422e8,_0x1ce236(0x20d)),console[_0x1ce236(0x205)](_0x1ce236(0x227),_0x336009),loggerService_1['loggerService'][_0x1ce236(0x20c)]('noda',_0x1ce236(0x1f4),'POST',_0x3755ee);const _0x19d9db=await fetch(this[_0x1ce236(0x229)],{'method':'POST','headers':{'Content-Type':_0x1ce236(0x1f5),'Accept':_0x1ce236(0x1f5),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1ce236(0x215)](_0x3755ee)}),_0x3be51b=Date[_0x1ce236(0x222)]()-_0x26ef33;console[_0x1ce236(0x205)](_0x1ce236(0x232)),console[_0x1ce236(0x205)](_0x1ce236(0x1ec),_0x19d9db[_0x1ce236(0x1fb)]),console[_0x1ce236(0x205)](_0x1ce236(0x236),_0x19d9db[_0x1ce236(0x1f6)]),console[_0x1ce236(0x205)](_0x1ce236(0x208),Object[_0x1ce236(0x23d)](_0x19d9db[_0x1ce236(0x242)][_0x1ce236(0x24f)]())),console[_0x1ce236(0x205)](_0x1ce236(0x1f3),_0x3be51b+'ms');const _0x1d7405=await _0x19d9db['text']();console[_0x1ce236(0x205)](_0x1ce236(0x228),_0x1d7405);if(!_0x19d9db['ok']){console['error'](_0x1ce236(0x1fd)),console[_0x1ce236(0x234)](_0x1ce236(0x1ee),_0x19d9db[_0x1ce236(0x1fb)]),console[_0x1ce236(0x234)](_0x1ce236(0x252),_0x1d7405),loggerService_1[_0x1ce236(0x251)][_0x1ce236(0x210)](_0x1ce236(0x1e3),_0x1ce236(0x1f4),_0x19d9db[_0x1ce236(0x1fb)],_0x1d7405,_0x3be51b),loggerService_1[_0x1ce236(0x251)][_0x1ce236(0x239)](_0x1ce236(0x1e3),_0x1ce236(0x1f4),_0x1ce236(0x23c)+_0x19d9db['status']+':\x20'+_0x1d7405);if(_0x19d9db['status']===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x19d9db['status']===0x1f4)throw new Error(_0x1ce236(0x247));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x19d9db['status']+_0x1ce236(0x22e)+_0x1d7405);}let _0xb77ab6;try{_0xb77ab6=JSON[_0x1ce236(0x1f8)](_0x1d7405);}catch(_0x52b28d){console['error'](_0x1ce236(0x221),_0x52b28d),loggerService_1['loggerService'][_0x1ce236(0x239)]('noda',_0x1ce236(0x1f4),_0x1ce236(0x206)+_0x52b28d);throw new Error(_0x1ce236(0x220)+_0x1d7405);}console[_0x1ce236(0x205)](_0x1ce236(0x20a)),console['log'](_0x1ce236(0x1e4),JSON['stringify'](_0xb77ab6,null,0x2)),loggerService_1[_0x1ce236(0x251)][_0x1ce236(0x210)](_0x1ce236(0x1e3),_0x1ce236(0x1f4),_0x19d9db[_0x1ce236(0x1fb)],_0xb77ab6,_0x3be51b);if(_0xb77ab6[_0x1ce236(0x234)]||_0xb77ab6['statusCode']){const _0x5e844d=_0xb77ab6['message']||_0xb77ab6[_0x1ce236(0x234)]||_0x1ce236(0x200);console[_0x1ce236(0x234)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x1ce236(0x234)](_0x1ce236(0x1fa),_0x5e844d),console['error'](_0x1ce236(0x223),_0xb77ab6[_0x1ce236(0x23b)]),loggerService_1[_0x1ce236(0x251)][_0x1ce236(0x239)](_0x1ce236(0x1e3),'/payment-links','Business\x20Error:\x20'+_0x5e844d);throw new Error(_0x1ce236(0x217)+_0x5e844d);}if(!_0xb77ab6['id']||!_0xb77ab6[_0x1ce236(0x244)]?.['shortLink']){console[_0x1ce236(0x234)](_0x1ce236(0x225)),console[_0x1ce236(0x234)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x1ce236(0x234)](_0x1ce236(0x21f),_0xb77ab6),loggerService_1[_0x1ce236(0x251)][_0x1ce236(0x239)](_0x1ce236(0x1e3),_0x1ce236(0x1f4),_0x1ce236(0x22d));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x1ce236(0x205)]('===\x20NODA\x20SUCCESS\x20==='),console['log']('Payment\x20Link\x20ID:',_0xb77ab6['id']),console[_0x1ce236(0x205)](_0x1ce236(0x1e7),_0xb77ab6[_0x1ce236(0x244)]['shortLink']),console['log'](_0x1ce236(0x23a),_0xb77ab6[_0x1ce236(0x244)]['qrCodeLink']||_0x1ce236(0x246)),console[_0x1ce236(0x205)](_0x1ce236(0x1fe),_0x1422e8,_0x1ce236(0x226)),console[_0x1ce236(0x205)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x336009),{'gateway_payment_id':_0xb77ab6['id'],'payment_url':_0xb77ab6[_0x1ce236(0x244)][_0x1ce236(0x231)],'qr_code_url':_0xb77ab6[_0x1ce236(0x244)][_0x1ce236(0x256)],'expiry_date':_0xb77ab6['expiryDate']};}catch(_0x2179d2){console[_0x1ce236(0x234)](_0x1ce236(0x21d)),console[_0x1ce236(0x234)]('Error\x20details:',_0x2179d2),loggerService_1['loggerService'][_0x1ce236(0x239)](_0x1ce236(0x1e3),_0x1ce236(0x1f4),_0x2179d2);if(_0x2179d2 instanceof Error){console[_0x1ce236(0x234)](_0x1ce236(0x24c),_0x2179d2[_0x1ce236(0x243)]),console[_0x1ce236(0x234)]('Error\x20stack:',_0x2179d2[_0x1ce236(0x25a)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x2179d2[_0x1ce236(0x243)]);}throw new Error(_0x1ce236(0x233));}}async['verifyPayment'](_0xfa133c){const _0x21cbd6=a42_0x18f997,_0x2a0808=Date[_0x21cbd6(0x222)]();try{loggerService_1['loggerService']['logWhiteDomainRequest']('noda',_0x21cbd6(0x22f)+_0xfa133c,'GET',{});const _0x42fbe2=await fetch(this[_0x21cbd6(0x229)]+'/'+_0xfa133c,{'method':_0x21cbd6(0x1ff),'headers':{'Content-Type':'application/json','User-Agent':_0x21cbd6(0x235)}}),_0x4fb3a7=Date[_0x21cbd6(0x222)]()-_0x2a0808;if(!_0x42fbe2['ok']){const _0x460a6b=await _0x42fbe2[_0x21cbd6(0x21c)]();loggerService_1[_0x21cbd6(0x251)][_0x21cbd6(0x210)](_0x21cbd6(0x1e3),_0x21cbd6(0x22f)+_0xfa133c,_0x42fbe2[_0x21cbd6(0x1fb)],_0x460a6b,_0x4fb3a7);throw new Error('HTTP\x20error!\x20status:\x20'+_0x42fbe2[_0x21cbd6(0x1fb)]);}const _0x2bfed7=await _0x42fbe2[_0x21cbd6(0x25b)]();loggerService_1[_0x21cbd6(0x251)]['logWhiteDomainResponse'](_0x21cbd6(0x1e3),_0x21cbd6(0x22f)+_0xfa133c,_0x42fbe2['status'],_0x2bfed7,_0x4fb3a7);if(_0x2bfed7[_0x21cbd6(0x234)]||_0x2bfed7[_0x21cbd6(0x23b)]){loggerService_1['loggerService'][_0x21cbd6(0x239)](_0x21cbd6(0x1e3),_0x21cbd6(0x22f)+_0xfa133c,_0x21cbd6(0x217)+(_0x2bfed7['message']||_0x2bfed7[_0x21cbd6(0x234)]||_0x21cbd6(0x224)));throw new Error(_0x21cbd6(0x217)+(_0x2bfed7[_0x21cbd6(0x243)]||_0x2bfed7['error']||_0x21cbd6(0x224)));}let _0x32ce06=_0x21cbd6(0x211);if(_0x2bfed7[_0x21cbd6(0x21b)]===![]){if(_0x2bfed7[_0x21cbd6(0x1f9)]){const _0x4b6507=new Date(_0x2bfed7[_0x21cbd6(0x1f9)]),_0x227ebe=new Date();_0x4b6507<_0x227ebe?_0x32ce06=_0x21cbd6(0x1f1):_0x32ce06=_0x21cbd6(0x250);}else _0x32ce06=_0x21cbd6(0x250);}else _0x32ce06=_0x21cbd6(0x211);return{'status':_0x32ce06,'amount':_0x2bfed7[_0x21cbd6(0x203)],'currency':_0x2bfed7[_0x21cbd6(0x22c)],'isActive':_0x2bfed7[_0x21cbd6(0x21b)]};}catch(_0x250200){console['error'](_0x21cbd6(0x1f0),_0x250200),loggerService_1[_0x21cbd6(0x251)][_0x21cbd6(0x239)]('noda',_0x21cbd6(0x22f)+_0xfa133c,_0x250200);throw new Error(_0x21cbd6(0x21a)+(_0x250200 instanceof Error?_0x250200['message']:_0x21cbd6(0x224)));}}async[a42_0x18f997(0x1e5)](_0x326cf0){const _0x14d853=a42_0x18f997;console[_0x14d853(0x205)](_0x14d853(0x1ef),_0x326cf0);let _0x28bde0=_0x14d853(0x211);switch(_0x326cf0['Status']?.[_0x14d853(0x1f7)]()){case _0x14d853(0x25d):case'completed':case _0x14d853(0x201):case _0x14d853(0x238):case _0x14d853(0x218):_0x326cf0[_0x14d853(0x202)]===_0x14d853(0x207)?_0x28bde0=_0x14d853(0x1ea):_0x28bde0='PENDING';break;case _0x14d853(0x249):case _0x14d853(0x20f):case'failed':case'error':case _0x14d853(0x1f2):_0x28bde0='FAILED';break;case _0x14d853(0x1ed):case _0x14d853(0x212):_0x28bde0='EXPIRED';break;case _0x14d853(0x241):case _0x14d853(0x20e):case _0x14d853(0x1e8):case _0x14d853(0x219):case _0x14d853(0x209):default:_0x28bde0=_0x14d853(0x211);break;}return{'paymentId':_0x326cf0[_0x14d853(0x21e)]||_0x326cf0[_0x14d853(0x258)],'status':_0x28bde0,'amount':_0x326cf0[_0x14d853(0x204)],'currency':_0x326cf0['Currency'],'additionalInfo':{'method':_0x326cf0[_0x14d853(0x230)],'bankId':_0x326cf0[_0x14d853(0x25f)],'settled':_0x326cf0[_0x14d853(0x202)],'settlementDate':_0x326cf0[_0x14d853(0x245)],'remitterName':_0x326cf0['Remitter']?.['Name'],'remitterIban':_0x326cf0[_0x14d853(0x23f)]?.[_0x14d853(0x253)],'bankTransactionId':_0x326cf0['BankTransactionId']}};}[a42_0x18f997(0x1fc)](_0xfb3f1a,_0x48023f){const _0x98a79c=a42_0x18f997;return console[_0x98a79c(0x205)](_0x98a79c(0x25e),{'receivedSignature':_0x48023f,'paymentId':_0xfb3f1a['PaymentId'],'merchantPaymentId':_0xfb3f1a[_0x98a79c(0x21e)]}),!![];}}exports[a42_0x18f997(0x257)]=NodaService;