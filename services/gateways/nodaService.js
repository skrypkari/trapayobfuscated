'use strict';const a48_0x545c0d=a48_0x5195;(function(_0x5bff69,_0x34e126){const _0xeed846=a48_0x5195,_0x10cef5=_0x5bff69();while(!![]){try{const _0x3fc90a=-parseInt(_0xeed846(0xd3))/0x1*(-parseInt(_0xeed846(0x107))/0x2)+parseInt(_0xeed846(0xa1))/0x3*(parseInt(_0xeed846(0xda))/0x4)+-parseInt(_0xeed846(0xfe))/0x5+-parseInt(_0xeed846(0xe7))/0x6*(parseInt(_0xeed846(0xea))/0x7)+-parseInt(_0xeed846(0x100))/0x8*(parseInt(_0xeed846(0x115))/0x9)+parseInt(_0xeed846(0x10a))/0xa*(parseInt(_0xeed846(0xcd))/0xb)+-parseInt(_0xeed846(0xec))/0xc;if(_0x3fc90a===_0x34e126)break;else _0x10cef5['push'](_0x10cef5['shift']());}catch(_0x5bdf9a){_0x10cef5['push'](_0x10cef5['shift']());}}}(a48_0x1d7a,0x56f2b));Object[a48_0x545c0d(0xc9)](exports,a48_0x545c0d(0x11b),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a48_0x545c0d(0xab));function a48_0x5195(_0x556768,_0x3ff295){const _0x1d7a5e=a48_0x1d7a();return a48_0x5195=function(_0x51951f,_0x143c6e){_0x51951f=_0x51951f-0x9c;let _0x55d7e1=_0x1d7a5e[_0x51951f];return _0x55d7e1;},a48_0x5195(_0x556768,_0x3ff295);}function a48_0x1d7a(){const _0x2a803f=['stringify','currency','toLowerCase','URL:','PaymentId','Method','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','https://tesoft.uk/gateway/noda/','Error\x20stack:','defineProperty','Parsed\x20Result:','FAILED','log','11vZizVd','Error\x20Message:','NodaService','Short\x20Link:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','noda','634300OQemGY','Not\x20provided','===\x20NODA\x20SERVICE\x20ERROR\x20===','Order\x20ID\x20Used:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','expired','status','4buszFa','HTTP\x20Status:','parse','Response\x20Time:','(8digits-8digits\x20format\x20for\x20Noda)','PENDING','success','statusCode','Amount','Status\x20Text:','https://tesoft.uk/gateway/pending.php?id=','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Settled','7512dKarKX','Currency','toUpperCase','3563dEKSHZ','headers','3164736QLLDbj','isActive','message','createPaymentLink','canceled','logWhiteDomainResponse','expiryDate','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','pending','HTTP\x20error!\x20status:\x20','https://tesoft.uk/gateway/noda/webhook/','BankId','Status','/payment-links','Status\x20Code:','EXPIRED','TesSoft\x20Payment\x20System/1.0','QR\x20Code\x20Link:','1039740xusoNV','MerchantPaymentId','6664FassRt','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','shortLink','entries','text','Status:','now','2TJphla',',\x20body:\x20','POST','6618370CxLmXK','GET','Name','processWebhook','Noda\x20webhook\x20signature\x20verification:','Raw\x20Response\x20Body:','rejected','Failed\x20to\x20parse\x20JSON\x20response:','loggerService','paid','===\x20NODA\x20API\x20ERROR\x20===','189guEYIu','cancelled','Response\x20Body:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Request\x20Body\x20(Direct\x20JSON):','JSON\x20Parse\x20Error:\x20','__esModule','===\x20NODA\x20SUCCESS\x20===','in_progress','(8digits-8digits\x20format)','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Noda\x20API\x20error:\x20','Unknown\x20error','qrCodeLink','Payment\x20Link\x20ID:','559317LaDaXg','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','HTTP\x20','stack','statusText','successful','error','Response\x20data:','apiUrl','shortLinkUrls','../loggerService','active','BankTransactionId','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Headers:','logWhiteDomainRequest','Processing\x20Noda\x20webhook:','amount','Missing\x20id\x20or\x20shortLink\x20in\x20response','application/json','done','timeout','logWhiteDomainError','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','/payment-links/','Remitter','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','fromEntries','verifyPayment','Yes','SettlementDate'];a48_0x1d7a=function(){return _0x2a803f;};return a48_0x1d7a();}class NodaService{constructor(){const _0x5ee346=a48_0x545c0d;this['apiUrl']=_0x5ee346(0xc7),console[_0x5ee346(0xcc)](_0x5ee346(0xf3));}async[a48_0x545c0d(0xef)](_0x589e4){const _0xecd409=a48_0x545c0d,{orderId:_0x56aab0,name:_0x1e32e5,paymentDescription:_0x556ff2,amount:_0x53c4d0,currency:_0x504db3,webhookUrl:_0x139233,returnUrl:_0x223e46,expiryDate:_0x17c796}=_0x589e4,_0x30d2aa=_0x504db3[_0xecd409(0xe9)](),_0xba6820=_0xecd409(0xf6),_0x229e34=_0xecd409(0xe4)+_0x56aab0,_0x2bc044={'name':_0x1e32e5,'paymentDescription':_0x556ff2,'amount':_0x53c4d0,'currency':_0x30d2aa,'paymentId':_0x56aab0,'webhookUrl':_0xba6820,'returnUrl':_0x229e34};_0x17c796&&(_0x2bc044[_0xecd409(0xf2)]=_0x17c796);const _0x4c3224=Date[_0xecd409(0x106)]();try{console[_0xecd409(0xcc)](_0xecd409(0xe5)),console[_0xecd409(0xcc)](_0xecd409(0xc3),this['apiUrl']),console[_0xecd409(0xcc)](_0xecd409(0x119),JSON[_0xecd409(0xc0)](_0x2bc044,null,0x2)),console[_0xecd409(0xcc)]('Order\x20ID\x20Format:',_0x56aab0,_0xecd409(0xde)),console[_0xecd409(0xcc)](_0xecd409(0xc6),_0x229e34),loggerService_1[_0xecd409(0x112)][_0xecd409(0xb0)]('noda','/payment-links',_0xecd409(0x109),_0x2bc044);const _0x50ce09=await fetch(this['apiUrl'],{'method':_0xecd409(0x109),'headers':{'Content-Type':_0xecd409(0xb4),'Accept':_0xecd409(0xb4),'User-Agent':_0xecd409(0xfc)},'body':JSON[_0xecd409(0xc0)](_0x2bc044)}),_0x2e4ac6=Date[_0xecd409(0x106)]()-_0x4c3224;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0xecd409(0x105),_0x50ce09[_0xecd409(0xd9)]),console['log'](_0xecd409(0xe3),_0x50ce09[_0xecd409(0xa5)]),console[_0xecd409(0xcc)](_0xecd409(0xaf),Object[_0xecd409(0xbc)](_0x50ce09[_0xecd409(0xeb)][_0xecd409(0x103)]())),console['log'](_0xecd409(0xdd),_0x2e4ac6+'ms');const _0x11c265=await _0x50ce09[_0xecd409(0x104)]();console['log'](_0xecd409(0x10f),_0x11c265);if(!_0x50ce09['ok']){console[_0xecd409(0xa7)](_0xecd409(0x114)),console[_0xecd409(0xa7)](_0xecd409(0xdb),_0x50ce09[_0xecd409(0xd9)]),console[_0xecd409(0xa7)](_0xecd409(0x117),_0x11c265),loggerService_1[_0xecd409(0x112)][_0xecd409(0xf1)]('noda','/payment-links',_0x50ce09[_0xecd409(0xd9)],_0x11c265,_0x2e4ac6),loggerService_1['loggerService'][_0xecd409(0xb7)]('noda','/payment-links',_0xecd409(0xa3)+_0x50ce09['status']+':\x20'+_0x11c265);if(_0x50ce09[_0xecd409(0xd9)]===0x190)throw new Error(_0xecd409(0xd7));else{if(_0x50ce09['status']===0x1f4)throw new Error(_0xecd409(0xb8));}throw new Error(_0xecd409(0xf5)+_0x50ce09[_0xecd409(0xd9)]+_0xecd409(0x108)+_0x11c265);}let _0x1ddfe8;try{_0x1ddfe8=JSON[_0xecd409(0xdc)](_0x11c265);}catch(_0x4ceaa7){console['error'](_0xecd409(0x111),_0x4ceaa7),loggerService_1[_0xecd409(0x112)][_0xecd409(0xb7)](_0xecd409(0xd2),'/payment-links',_0xecd409(0x11a)+_0x4ceaa7);throw new Error(_0xecd409(0x118)+_0x11c265);}console[_0xecd409(0xcc)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0xecd409(0xcc)](_0xecd409(0xca),JSON['stringify'](_0x1ddfe8,null,0x2)),loggerService_1[_0xecd409(0x112)][_0xecd409(0xf1)](_0xecd409(0xd2),_0xecd409(0xf9),_0x50ce09[_0xecd409(0xd9)],_0x1ddfe8,_0x2e4ac6);if(_0x1ddfe8['error']||_0x1ddfe8[_0xecd409(0xe1)]){const _0x56be17=_0x1ddfe8[_0xecd409(0xee)]||_0x1ddfe8['error']||'Unknown\x20error\x20from\x20Noda\x20API';console[_0xecd409(0xa7)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0xecd409(0xa7)](_0xecd409(0xce),_0x56be17),console[_0xecd409(0xa7)](_0xecd409(0xfa),_0x1ddfe8[_0xecd409(0xe1)]),loggerService_1[_0xecd409(0x112)][_0xecd409(0xb7)](_0xecd409(0xd2),'/payment-links','Business\x20Error:\x20'+_0x56be17);throw new Error('Noda\x20API\x20error:\x20'+_0x56be17);}if(!_0x1ddfe8['id']||!_0x1ddfe8[_0xecd409(0xaa)]?.[_0xecd409(0x102)]){console[_0xecd409(0xa7)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0xecd409(0xb3)),console[_0xecd409(0xa7)](_0xecd409(0xa8),_0x1ddfe8),loggerService_1[_0xecd409(0x112)][_0xecd409(0xb7)](_0xecd409(0xd2),_0xecd409(0xf9),_0xecd409(0xa2));throw new Error(_0xecd409(0x101));}return console[_0xecd409(0xcc)](_0xecd409(0x11c)),console[_0xecd409(0xcc)](_0xecd409(0xa0),_0x1ddfe8['id']),console[_0xecd409(0xcc)](_0xecd409(0xd0),_0x1ddfe8['shortLinkUrls'][_0xecd409(0x102)]),console[_0xecd409(0xcc)](_0xecd409(0xfd),_0x1ddfe8[_0xecd409(0xaa)][_0xecd409(0x9f)]||_0xecd409(0xd4)),console[_0xecd409(0xcc)](_0xecd409(0xd6),_0x56aab0,_0xecd409(0x11e)),console[_0xecd409(0xcc)](_0xecd409(0x9c),_0x229e34),{'gateway_payment_id':_0x1ddfe8['id'],'payment_url':_0x1ddfe8[_0xecd409(0xaa)][_0xecd409(0x102)],'qr_code_url':_0x1ddfe8['shortLinkUrls'][_0xecd409(0x9f)],'expiry_date':_0x1ddfe8[_0xecd409(0xf2)]};}catch(_0x32af09){console[_0xecd409(0xa7)](_0xecd409(0xd5)),console[_0xecd409(0xa7)]('Error\x20details:',_0x32af09),loggerService_1[_0xecd409(0x112)][_0xecd409(0xb7)](_0xecd409(0xd2),_0xecd409(0xf9),_0x32af09);if(_0x32af09 instanceof Error){console[_0xecd409(0xa7)]('Error\x20message:',_0x32af09[_0xecd409(0xee)]),console[_0xecd409(0xa7)](_0xecd409(0xc8),_0x32af09[_0xecd409(0xa4)]);throw new Error(_0xecd409(0xbb)+_0x32af09['message']);}throw new Error(_0xecd409(0xd1));}}async[a48_0x545c0d(0xbd)](_0x3fe8a2){const _0x370980=a48_0x545c0d,_0x5a18db=Date[_0x370980(0x106)]();try{loggerService_1[_0x370980(0x112)][_0x370980(0xb0)]('noda','/payment-links/'+_0x3fe8a2,_0x370980(0x10b),{});const _0x51e2df=await fetch(this[_0x370980(0xa9)]+'/'+_0x3fe8a2,{'method':_0x370980(0x10b),'headers':{'Content-Type':_0x370980(0xb4),'User-Agent':_0x370980(0xfc)}}),_0x156368=Date[_0x370980(0x106)]()-_0x5a18db;if(!_0x51e2df['ok']){const _0x4db0e7=await _0x51e2df[_0x370980(0x104)]();loggerService_1['loggerService'][_0x370980(0xf1)](_0x370980(0xd2),'/payment-links/'+_0x3fe8a2,_0x51e2df[_0x370980(0xd9)],_0x4db0e7,_0x156368);throw new Error('HTTP\x20error!\x20status:\x20'+_0x51e2df[_0x370980(0xd9)]);}const _0x3aecf1=await _0x51e2df['json']();loggerService_1[_0x370980(0x112)][_0x370980(0xf1)](_0x370980(0xd2),_0x370980(0xb9)+_0x3fe8a2,_0x51e2df[_0x370980(0xd9)],_0x3aecf1,_0x156368);if(_0x3aecf1[_0x370980(0xa7)]||_0x3aecf1[_0x370980(0xe1)]){loggerService_1[_0x370980(0x112)][_0x370980(0xb7)](_0x370980(0xd2),_0x370980(0xb9)+_0x3fe8a2,_0x370980(0x9d)+(_0x3aecf1[_0x370980(0xee)]||_0x3aecf1[_0x370980(0xa7)]||_0x370980(0x9e)));throw new Error(_0x370980(0x9d)+(_0x3aecf1['message']||_0x3aecf1[_0x370980(0xa7)]||_0x370980(0x9e)));}let _0x28da40=_0x370980(0xdf);if(_0x3aecf1[_0x370980(0xed)]===![]){if(_0x3aecf1['expiryDate']){const _0x30aba7=new Date(_0x3aecf1[_0x370980(0xf2)]),_0x49aee0=new Date();_0x30aba7<_0x49aee0?_0x28da40=_0x370980(0xfb):_0x28da40='FAILED';}else _0x28da40=_0x370980(0xcb);}else _0x28da40=_0x370980(0xdf);return{'status':_0x28da40,'amount':_0x3aecf1[_0x370980(0xb2)],'currency':_0x3aecf1[_0x370980(0xc1)],'isActive':_0x3aecf1[_0x370980(0xed)]};}catch(_0x142464){console[_0x370980(0xa7)]('Noda\x20payment\x20verification\x20error:',_0x142464),loggerService_1[_0x370980(0x112)][_0x370980(0xb7)](_0x370980(0xd2),'/payment-links/'+_0x3fe8a2,_0x142464);throw new Error(_0x370980(0xae)+(_0x142464 instanceof Error?_0x142464[_0x370980(0xee)]:_0x370980(0x9e)));}}async[a48_0x545c0d(0x10d)](_0x11bc05){const _0x316eaa=a48_0x545c0d;console[_0x316eaa(0xcc)](_0x316eaa(0xb1),_0x11bc05);let _0x4b2a72=_0x316eaa(0xdf);switch(_0x11bc05[_0x316eaa(0xf8)]?.[_0x316eaa(0xc2)]()){case _0x316eaa(0xb5):case'completed':case _0x316eaa(0x113):case _0x316eaa(0xe0):case _0x316eaa(0xa6):_0x11bc05[_0x316eaa(0xe6)]===_0x316eaa(0xbe)?_0x4b2a72='PAID':_0x4b2a72='PENDING';break;case _0x316eaa(0x116):case _0x316eaa(0xf0):case'failed':case _0x316eaa(0xa7):case _0x316eaa(0x110):_0x4b2a72=_0x316eaa(0xcb);break;case _0x316eaa(0xd8):case _0x316eaa(0xb6):_0x4b2a72=_0x316eaa(0xfb);break;case _0x316eaa(0xf4):case'created':case _0x316eaa(0xac):case'processing':case _0x316eaa(0x11d):default:_0x4b2a72=_0x316eaa(0xdf);break;}return{'paymentId':_0x11bc05[_0x316eaa(0xff)]||_0x11bc05[_0x316eaa(0xc4)],'status':_0x4b2a72,'amount':_0x11bc05[_0x316eaa(0xe2)],'currency':_0x11bc05[_0x316eaa(0xe8)],'additionalInfo':{'method':_0x11bc05[_0x316eaa(0xc5)],'bankId':_0x11bc05[_0x316eaa(0xf7)],'settled':_0x11bc05[_0x316eaa(0xe6)],'settlementDate':_0x11bc05[_0x316eaa(0xbf)],'remitterName':_0x11bc05[_0x316eaa(0xba)]?.[_0x316eaa(0x10c)],'remitterIban':_0x11bc05[_0x316eaa(0xba)]?.['Iban'],'bankTransactionId':_0x11bc05[_0x316eaa(0xad)]}};}['verifyWebhookSignature'](_0x4e6e5d,_0x88d4ba){const _0x592068=a48_0x545c0d;return console[_0x592068(0xcc)](_0x592068(0x10e),{'receivedSignature':_0x88d4ba,'paymentId':_0x4e6e5d[_0x592068(0xc4)],'merchantPaymentId':_0x4e6e5d[_0x592068(0xff)]}),!![];}}exports[a48_0x545c0d(0xcf)]=NodaService;