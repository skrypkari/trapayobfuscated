'use strict';const a60_0x59013a=a60_0x1e3a;(function(_0x1a0fde,_0x5d00ab){const _0x1699c8=a60_0x1e3a,_0x18642b=_0x1a0fde();while(!![]){try{const _0x408796=-parseInt(_0x1699c8(0xf2))/0x1*(-parseInt(_0x1699c8(0xcc))/0x2)+parseInt(_0x1699c8(0xe8))/0x3+parseInt(_0x1699c8(0x106))/0x4+parseInt(_0x1699c8(0xf4))/0x5+parseInt(_0x1699c8(0xb1))/0x6+-parseInt(_0x1699c8(0xfc))/0x7*(-parseInt(_0x1699c8(0xcf))/0x8)+-parseInt(_0x1699c8(0xea))/0x9;if(_0x408796===_0x5d00ab)break;else _0x18642b['push'](_0x18642b['shift']());}catch(_0x58dd92){_0x18642b['push'](_0x18642b['shift']());}}}(a60_0x4ba9,0x55413));Object[a60_0x59013a(0xbe)](exports,a60_0x59013a(0xb3),{'value':!![]}),exports[a60_0x59013a(0xc6)]=void 0x0;const loggerService_1=require(a60_0x59013a(0xf9));class NodaService{constructor(){const _0x218b39=a60_0x59013a;this[_0x218b39(0xdf)]=_0x218b39(0x102),console[_0x218b39(0xee)](_0x218b39(0x104));}async[a60_0x59013a(0x10d)](_0x553374){const _0x5f077b=a60_0x59013a,{orderId:_0xa71f88,name:_0x517e5d,paymentDescription:_0x1a7f05,amount:_0x59f939,currency:_0x2f95ee,webhookUrl:_0x4144ab,returnUrl:_0x508961,expiryDate:_0x44425e}=_0x553374,_0x56b365=_0x2f95ee[_0x5f077b(0xa2)](),_0x1ce9a2=_0x5f077b(0x108),_0x545425=_0x5f077b(0x103)+_0xa71f88,_0x1f4a05={'name':_0x517e5d,'paymentDescription':_0x1a7f05,'amount':_0x59f939,'currency':_0x56b365,'paymentId':_0xa71f88,'webhookUrl':_0x1ce9a2,'returnUrl':_0x545425};_0x44425e&&(_0x1f4a05[_0x5f077b(0xb8)]=_0x44425e);const _0x268526=Date[_0x5f077b(0xdd)]();try{console[_0x5f077b(0xee)](_0x5f077b(0xe0)),console[_0x5f077b(0xee)](_0x5f077b(0x113),this[_0x5f077b(0xdf)]),console['log'](_0x5f077b(0xb9),JSON[_0x5f077b(0xb0)](_0x1f4a05,null,0x2)),console[_0x5f077b(0xee)]('Order\x20ID\x20Format:',_0xa71f88,_0x5f077b(0x118)),console[_0x5f077b(0xee)](_0x5f077b(0xc4),_0x545425),loggerService_1['loggerService'][_0x5f077b(0x116)](_0x5f077b(0xef),_0x5f077b(0x100),_0x5f077b(0x117),_0x1f4a05);const _0x133148=await fetch(this[_0x5f077b(0xdf)],{'method':_0x5f077b(0x117),'headers':{'Content-Type':_0x5f077b(0xd8),'Accept':_0x5f077b(0xd8),'User-Agent':'Payment\x20System/1.0'},'body':JSON['stringify'](_0x1f4a05)}),_0x258b33=Date[_0x5f077b(0xdd)]()-_0x268526;console[_0x5f077b(0xee)]('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x5f077b(0xee)](_0x5f077b(0x10f),_0x133148[_0x5f077b(0x101)]),console[_0x5f077b(0xee)](_0x5f077b(0xc1),_0x133148[_0x5f077b(0xa3)]),console['log'](_0x5f077b(0xf1),Object['fromEntries'](_0x133148[_0x5f077b(0xfa)][_0x5f077b(0x112)]())),console[_0x5f077b(0xee)](_0x5f077b(0x10e),_0x258b33+'ms');const _0x45b3f9=await _0x133148['text']();console[_0x5f077b(0xee)](_0x5f077b(0xd5),_0x45b3f9);if(!_0x133148['ok']){console[_0x5f077b(0xa8)](_0x5f077b(0xac)),console[_0x5f077b(0xa8)](_0x5f077b(0xc8),_0x133148[_0x5f077b(0x101)]),console[_0x5f077b(0xa8)]('Response\x20Body:',_0x45b3f9),loggerService_1[_0x5f077b(0xa7)][_0x5f077b(0xb6)](_0x5f077b(0xef),_0x5f077b(0x100),_0x133148[_0x5f077b(0x101)],_0x45b3f9,_0x258b33),loggerService_1['loggerService']['logWhiteDomainError'](_0x5f077b(0xef),_0x5f077b(0x100),_0x5f077b(0xa6)+_0x133148['status']+':\x20'+_0x45b3f9);if(_0x133148[_0x5f077b(0x101)]===0x190)throw new Error(_0x5f077b(0xc3));else{if(_0x133148[_0x5f077b(0x101)]===0x1f4)throw new Error(_0x5f077b(0xbd));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x133148[_0x5f077b(0x101)]+_0x5f077b(0xd6)+_0x45b3f9);}let _0x24a8b9;try{_0x24a8b9=JSON[_0x5f077b(0xc0)](_0x45b3f9);}catch(_0x40625b){console[_0x5f077b(0xa8)](_0x5f077b(0xc7),_0x40625b),loggerService_1[_0x5f077b(0xa7)][_0x5f077b(0xe7)](_0x5f077b(0xef),_0x5f077b(0x100),_0x5f077b(0x120)+_0x40625b);throw new Error(_0x5f077b(0x10b)+_0x45b3f9);}console[_0x5f077b(0xee)](_0x5f077b(0xd2)),console[_0x5f077b(0xee)](_0x5f077b(0xa1),JSON['stringify'](_0x24a8b9,null,0x2)),loggerService_1[_0x5f077b(0xa7)][_0x5f077b(0xb6)](_0x5f077b(0xef),_0x5f077b(0x100),_0x133148['status'],_0x24a8b9,_0x258b33);if(_0x24a8b9[_0x5f077b(0xa8)]||_0x24a8b9[_0x5f077b(0xaf)]){const _0x55e42b=_0x24a8b9['message']||_0x24a8b9['error']||_0x5f077b(0x10c);console['error'](_0x5f077b(0xfb)),console[_0x5f077b(0xa8)](_0x5f077b(0xd4),_0x55e42b),console['error'](_0x5f077b(0xe2),_0x24a8b9[_0x5f077b(0xaf)]),loggerService_1[_0x5f077b(0xa7)][_0x5f077b(0xe7)]('noda','/payment-links',_0x5f077b(0xf3)+_0x55e42b);throw new Error('Noda\x20API\x20error:\x20'+_0x55e42b);}if(!_0x24a8b9['id']||!_0x24a8b9[_0x5f077b(0xf0)]?.[_0x5f077b(0xde)]){console[_0x5f077b(0xa8)](_0x5f077b(0xfd)),console[_0x5f077b(0xa8)](_0x5f077b(0x107)),console['error'](_0x5f077b(0xda),_0x24a8b9),loggerService_1['loggerService'][_0x5f077b(0xe7)]('noda',_0x5f077b(0x100),_0x5f077b(0xb5));throw new Error(_0x5f077b(0x105));}return console[_0x5f077b(0xee)](_0x5f077b(0x115)),console[_0x5f077b(0xee)]('Payment\x20Link\x20ID:',_0x24a8b9['id']),console[_0x5f077b(0xee)](_0x5f077b(0xa9),_0x24a8b9[_0x5f077b(0xf0)]['shortLink']),console[_0x5f077b(0xee)](_0x5f077b(0xe6),_0x24a8b9[_0x5f077b(0xf0)]['qrCodeLink']||_0x5f077b(0xd9)),console['log'](_0x5f077b(0xbc),_0xa71f88,_0x5f077b(0xd3)),console[_0x5f077b(0xee)]('âœ…\x20Return\x20URL\x20configured\x20for\x20pending:',_0x545425),{'gateway_payment_id':_0x24a8b9['id'],'payment_url':_0x24a8b9[_0x5f077b(0xf0)]['shortLink'],'qr_code_url':_0x24a8b9[_0x5f077b(0xf0)][_0x5f077b(0xeb)],'expiry_date':_0x24a8b9['expiryDate']};}catch(_0x3fc69f){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x5f077b(0xa8)](_0x5f077b(0xd7),_0x3fc69f),loggerService_1[_0x5f077b(0xa7)][_0x5f077b(0xe7)]('noda',_0x5f077b(0x100),_0x3fc69f);if(_0x3fc69f instanceof Error){console[_0x5f077b(0xa8)]('Error\x20message:',_0x3fc69f[_0x5f077b(0xa5)]),console[_0x5f077b(0xa8)](_0x5f077b(0xae),_0x3fc69f[_0x5f077b(0xe4)]);throw new Error(_0x5f077b(0xa4)+_0x3fc69f[_0x5f077b(0xa5)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x3b581e){const _0x3bc79d=a60_0x59013a,_0xe6abc3=Date[_0x3bc79d(0xdd)]();try{loggerService_1[_0x3bc79d(0xa7)][_0x3bc79d(0x116)](_0x3bc79d(0xef),'/payment-links/'+_0x3b581e,_0x3bc79d(0xe5),{});const _0x5a127d=await fetch(this['apiUrl']+'/'+_0x3b581e,{'method':'GET','headers':{'Content-Type':_0x3bc79d(0xd8),'User-Agent':_0x3bc79d(0xca)}}),_0x357baf=Date[_0x3bc79d(0xdd)]()-_0xe6abc3;if(!_0x5a127d['ok']){const _0x72d1db=await _0x5a127d['text']();loggerService_1[_0x3bc79d(0xa7)][_0x3bc79d(0xb6)](_0x3bc79d(0xef),_0x3bc79d(0xaa)+_0x3b581e,_0x5a127d[_0x3bc79d(0x101)],_0x72d1db,_0x357baf);throw new Error(_0x3bc79d(0xab)+_0x5a127d['status']);}const _0xd3e70f=await _0x5a127d[_0x3bc79d(0xdb)]();loggerService_1[_0x3bc79d(0xa7)]['logWhiteDomainResponse']('noda','/payment-links/'+_0x3b581e,_0x5a127d[_0x3bc79d(0x101)],_0xd3e70f,_0x357baf);if(_0xd3e70f['error']||_0xd3e70f[_0x3bc79d(0xaf)]){loggerService_1[_0x3bc79d(0xa7)][_0x3bc79d(0xe7)](_0x3bc79d(0xef),_0x3bc79d(0xaa)+_0x3b581e,_0x3bc79d(0x109)+(_0xd3e70f[_0x3bc79d(0xa5)]||_0xd3e70f[_0x3bc79d(0xa8)]||_0x3bc79d(0xff)));throw new Error(_0x3bc79d(0x109)+(_0xd3e70f['message']||_0xd3e70f[_0x3bc79d(0xa8)]||_0x3bc79d(0xff)));}let _0x4ecc37=_0x3bc79d(0x11b);if(_0xd3e70f[_0x3bc79d(0x11e)]===![]){if(_0xd3e70f['expiryDate']){const _0x3e72c7=new Date(_0xd3e70f[_0x3bc79d(0xb8)]),_0x9caa1=new Date();_0x3e72c7<_0x9caa1?_0x4ecc37=_0x3bc79d(0xbf):_0x4ecc37=_0x3bc79d(0xf8);}else _0x4ecc37=_0x3bc79d(0xf8);}else _0x4ecc37=_0x3bc79d(0x11b);return{'status':_0x4ecc37,'amount':_0xd3e70f[_0x3bc79d(0xce)],'currency':_0xd3e70f['currency'],'isActive':_0xd3e70f['isActive']};}catch(_0x105478){console[_0x3bc79d(0xa8)](_0x3bc79d(0xe1),_0x105478),loggerService_1[_0x3bc79d(0xa7)][_0x3bc79d(0xe7)](_0x3bc79d(0xef),_0x3bc79d(0xaa)+_0x3b581e,_0x105478);throw new Error(_0x3bc79d(0xc2)+(_0x105478 instanceof Error?_0x105478[_0x3bc79d(0xa5)]:_0x3bc79d(0xff)));}}async[a60_0x59013a(0x11c)](_0x4b8b5d){const _0x1e9280=a60_0x59013a;console['log'](_0x1e9280(0xfe),_0x4b8b5d);let _0x245e18='PENDING';switch(_0x4b8b5d[_0x1e9280(0xbb)]?.[_0x1e9280(0xc5)]()){case _0x1e9280(0xb2):case _0x1e9280(0xf5):case _0x1e9280(0x11a):case'success':case _0x1e9280(0x110):_0x4b8b5d[_0x1e9280(0xcd)]===_0x1e9280(0x111)?_0x245e18=_0x1e9280(0x119):_0x245e18=_0x1e9280(0x11b);break;case _0x1e9280(0x11d):case _0x1e9280(0xd0):case _0x1e9280(0xad):case'error':case _0x1e9280(0xed):_0x245e18=_0x1e9280(0xf8);break;case _0x1e9280(0x114):case _0x1e9280(0xdc):_0x245e18=_0x1e9280(0xbf);break;case'pending':case _0x1e9280(0xc9):case _0x1e9280(0xba):case _0x1e9280(0xb4):case _0x1e9280(0xf7):default:_0x245e18='PENDING';break;}return{'paymentId':_0x4b8b5d[_0x1e9280(0x11f)]||_0x4b8b5d['PaymentId'],'status':_0x245e18,'amount':_0x4b8b5d[_0x1e9280(0xec)],'currency':_0x4b8b5d[_0x1e9280(0xd1)],'additionalInfo':{'method':_0x4b8b5d['Method'],'bankId':_0x4b8b5d['BankId'],'settled':_0x4b8b5d[_0x1e9280(0xcd)],'settlementDate':_0x4b8b5d[_0x1e9280(0xf6)],'remitterName':_0x4b8b5d['Remitter']?.[_0x1e9280(0x121)],'remitterIban':_0x4b8b5d['Remitter']?.[_0x1e9280(0xcb)],'bankTransactionId':_0x4b8b5d[_0x1e9280(0xb7)]}};}[a60_0x59013a(0xe3)](_0x43cfaf,_0x16e55f){const _0x1e2a74=a60_0x59013a;return console[_0x1e2a74(0xee)](_0x1e2a74(0xe9),{'receivedSignature':_0x16e55f,'paymentId':_0x43cfaf[_0x1e2a74(0x10a)],'merchantPaymentId':_0x43cfaf[_0x1e2a74(0x11f)]}),!![];}}function a60_0x1e3a(_0x499c86,_0x3ce292){_0x499c86=_0x499c86-0xa1;const _0x4ba942=a60_0x4ba9();let _0x1e3a71=_0x4ba942[_0x499c86];return _0x1e3a71;}function a60_0x4ba9(){const _0x381847=['Yes','entries','URL:','expired','===\x20NODA\x20SUCCESS\x20===','logWhiteDomainRequest','POST','(8digits-8digits\x20format\x20for\x20Noda)','PAID','paid','PENDING','processWebhook','cancelled','isActive','MerchantPaymentId','JSON\x20Parse\x20Error:\x20','Name','Parsed\x20Result:','toUpperCase','statusText','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','message','HTTP\x20','loggerService','error','Short\x20Link:','/payment-links/','HTTP\x20error!\x20status:\x20','===\x20NODA\x20API\x20ERROR\x20===','failed','Error\x20stack:','statusCode','stringify','469908LAYloa','done','__esModule','processing','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','logWhiteDomainResponse','BankTransactionId','expiryDate','Request\x20Body\x20(Direct\x20JSON):','active','Status','Order\x20ID\x20Used:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','defineProperty','EXPIRED','parse','Status\x20Text:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','âœ…\x20ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž:\x20Return\x20URL\x20uses\x20pending.php:','toLowerCase','NodaService','Failed\x20to\x20parse\x20JSON\x20response:','HTTP\x20Status:','created','Payment\x20System/1.0','Iban','1122958PqlEUO','Settled','amount','8uWyfCy','canceled','Currency','===\x20PARSED\x20NODA\x20RESPONSE\x20===','(8digits-8digits\x20format)','Error\x20Message:','Raw\x20Response\x20Body:',',\x20body:\x20','Error\x20details:','application/json','Not\x20provided','Response\x20data:','json','timeout','now','shortLink','apiUrl','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Noda\x20payment\x20verification\x20error:','Status\x20Code:','verifyWebhookSignature','stack','GET','QR\x20Code\x20Link:','logWhiteDomainError','248160TROZbz','Noda\x20webhook\x20signature\x20verification:','13364118MJPYhN','qrCodeLink','Amount','rejected','log','noda','shortLinkUrls','Headers:','1REwvCW','Business\x20Error:\x20','1557540pbPhOt','completed','SettlementDate','in_progress','FAILED','../loggerService','headers','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','2629522kiuqmD','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Processing\x20Noda\x20webhook:','Unknown\x20error','/payment-links','status','https://tesoft.uk/gateway/noda/','https://tesoft.uk/gateway/pending.php?id=','ðŸŒ\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','1697736hxGCZN','Missing\x20id\x20or\x20shortLink\x20in\x20response','https://tesoft.uk/gateway/noda/webhook/','Noda\x20API\x20error:\x20','PaymentId','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Unknown\x20error\x20from\x20Noda\x20API','createPaymentLink','Response\x20Time:','Status:','successful'];a60_0x4ba9=function(){return _0x381847;};return a60_0x4ba9();}exports['NodaService']=NodaService;