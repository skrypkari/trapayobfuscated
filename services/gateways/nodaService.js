'use strict';const a53_0x527d76=a53_0x1f69;(function(_0x56ddb9,_0x20d9e6){const _0xf17b68=a53_0x1f69,_0x15ef6e=_0x56ddb9();while(!![]){try{const _0x37d94b=parseInt(_0xf17b68(0xef))/0x1*(parseInt(_0xf17b68(0xd1))/0x2)+parseInt(_0xf17b68(0x100))/0x3*(-parseInt(_0xf17b68(0xd5))/0x4)+-parseInt(_0xf17b68(0xcd))/0x5+parseInt(_0xf17b68(0xae))/0x6+parseInt(_0xf17b68(0xdd))/0x7*(-parseInt(_0xf17b68(0xb9))/0x8)+-parseInt(_0xf17b68(0xfb))/0x9+-parseInt(_0xf17b68(0xc8))/0xa*(-parseInt(_0xf17b68(0xe7))/0xb);if(_0x37d94b===_0x20d9e6)break;else _0x15ef6e['push'](_0x15ef6e['shift']());}catch(_0x28ade9){_0x15ef6e['push'](_0x15ef6e['shift']());}}}(a53_0x5537,0x844f9));Object['defineProperty'](exports,a53_0x527d76(0xbd),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a53_0x527d76(0xe2));class NodaService{constructor(){const _0x1449ea=a53_0x527d76;this['apiUrl']=_0x1449ea(0xb8),console['log'](_0x1449ea(0xc5));}async[a53_0x527d76(0xa6)](_0x5c2b1d){const _0x24ad32=a53_0x527d76,{orderId:_0x227578,name:_0x259b90,paymentDescription:_0xf3d4db,amount:_0x59b628,currency:_0x5d3f4d,webhookUrl:_0x4c4712,returnUrl:_0x265652,expiryDate:_0x5cb062}=_0x5c2b1d,_0x83c645=_0x5d3f4d[_0x24ad32(0xc9)](),_0x89d2ba=_0x24ad32(0xca),_0x3865cd=_0x24ad32(0xe8)+_0x227578,_0x370121={'name':_0x259b90,'paymentDescription':_0xf3d4db,'amount':_0x59b628,'currency':_0x83c645,'paymentId':_0x227578,'webhookUrl':_0x89d2ba,'returnUrl':_0x3865cd};_0x5cb062&&(_0x370121[_0x24ad32(0xe5)]=_0x5cb062);const _0x11f7c4=Date['now']();try{console[_0x24ad32(0xb7)](_0x24ad32(0xad)),console[_0x24ad32(0xb7)](_0x24ad32(0xe9),this[_0x24ad32(0xb5)]),console['log'](_0x24ad32(0xc0),JSON[_0x24ad32(0xd9)](_0x370121,null,0x2)),console[_0x24ad32(0xb7)]('Order\x20ID\x20Format:',_0x227578,'(8digits-8digits\x20format\x20for\x20Noda)'),console['log'](_0x24ad32(0x10d),_0x3865cd),loggerService_1['loggerService'][_0x24ad32(0xa3)](_0x24ad32(0xbb),_0x24ad32(0xf6),_0x24ad32(0xa2),_0x370121);const _0x42845d=await fetch(this[_0x24ad32(0xb5)],{'method':'POST','headers':{'Content-Type':_0x24ad32(0x9c),'Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON['stringify'](_0x370121)}),_0x9c4d38=Date[_0x24ad32(0xb0)]()-_0x11f7c4;console[_0x24ad32(0xb7)](_0x24ad32(0xea)),console['log'](_0x24ad32(0xab),_0x42845d['status']),console[_0x24ad32(0xb7)](_0x24ad32(0x106),_0x42845d['statusText']),console[_0x24ad32(0xb7)](_0x24ad32(0xe3),Object['fromEntries'](_0x42845d[_0x24ad32(0xeb)][_0x24ad32(0xc1)]())),console[_0x24ad32(0xb7)](_0x24ad32(0xff),_0x9c4d38+'ms');const _0x165b7f=await _0x42845d[_0x24ad32(0xf3)]();console['log'](_0x24ad32(0xbc),_0x165b7f);if(!_0x42845d['ok']){console[_0x24ad32(0xd3)](_0x24ad32(0xb3)),console[_0x24ad32(0xd3)](_0x24ad32(0xfe),_0x42845d[_0x24ad32(0xfd)]),console[_0x24ad32(0xd3)](_0x24ad32(0x10c),_0x165b7f),loggerService_1[_0x24ad32(0xfa)]['logWhiteDomainResponse']('noda',_0x24ad32(0xf6),_0x42845d[_0x24ad32(0xfd)],_0x165b7f,_0x9c4d38),loggerService_1[_0x24ad32(0xfa)][_0x24ad32(0xee)]('noda',_0x24ad32(0xf6),_0x24ad32(0x109)+_0x42845d[_0x24ad32(0xfd)]+':\x20'+_0x165b7f);if(_0x42845d['status']===0x190)throw new Error(_0x24ad32(0xe6));else{if(_0x42845d[_0x24ad32(0xfd)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x24ad32(0xed)+_0x42845d[_0x24ad32(0xfd)]+_0x24ad32(0x9d)+_0x165b7f);}let _0x5d6ca4;try{_0x5d6ca4=JSON[_0x24ad32(0x101)](_0x165b7f);}catch(_0x4fde8d){console[_0x24ad32(0xd3)](_0x24ad32(0x9a),_0x4fde8d),loggerService_1[_0x24ad32(0xfa)][_0x24ad32(0xee)](_0x24ad32(0xbb),_0x24ad32(0xf6),'JSON\x20Parse\x20Error:\x20'+_0x4fde8d);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x165b7f);}console['log'](_0x24ad32(0xd0)),console[_0x24ad32(0xb7)](_0x24ad32(0x10b),JSON[_0x24ad32(0xd9)](_0x5d6ca4,null,0x2)),loggerService_1['loggerService'][_0x24ad32(0xa9)](_0x24ad32(0xbb),'/payment-links',_0x42845d[_0x24ad32(0xfd)],_0x5d6ca4,_0x9c4d38);if(_0x5d6ca4[_0x24ad32(0xd3)]||_0x5d6ca4[_0x24ad32(0xa1)]){const _0x2daa6a=_0x5d6ca4['message']||_0x5d6ca4[_0x24ad32(0xd3)]||_0x24ad32(0xac);console[_0x24ad32(0xd3)](_0x24ad32(0xf7)),console[_0x24ad32(0xd3)]('Error\x20Message:',_0x2daa6a),console[_0x24ad32(0xd3)](_0x24ad32(0xb4),_0x5d6ca4[_0x24ad32(0xa1)]),loggerService_1[_0x24ad32(0xfa)]['logWhiteDomainError'](_0x24ad32(0xbb),_0x24ad32(0xf6),'Business\x20Error:\x20'+_0x2daa6a);throw new Error(_0x24ad32(0xb6)+_0x2daa6a);}if(!_0x5d6ca4['id']||!_0x5d6ca4[_0x24ad32(0x9b)]?.[_0x24ad32(0xbf)]){console[_0x24ad32(0xd3)](_0x24ad32(0xba)),console[_0x24ad32(0xd3)](_0x24ad32(0xcf)),console[_0x24ad32(0xd3)](_0x24ad32(0xd2),_0x5d6ca4),loggerService_1[_0x24ad32(0xfa)][_0x24ad32(0xee)]('noda',_0x24ad32(0xf6),_0x24ad32(0xb1));throw new Error(_0x24ad32(0xcc));}return console[_0x24ad32(0xb7)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x24ad32(0xb7)](_0x24ad32(0xd6),_0x5d6ca4['id']),console[_0x24ad32(0xb7)](_0x24ad32(0x107),_0x5d6ca4['shortLinkUrls'][_0x24ad32(0xbf)]),console[_0x24ad32(0xb7)](_0x24ad32(0x104),_0x5d6ca4['shortLinkUrls']['qrCodeLink']||_0x24ad32(0xd4)),console[_0x24ad32(0xb7)](_0x24ad32(0xc2),_0x227578,_0x24ad32(0xfc)),console[_0x24ad32(0xb7)]('✅\x20Return\x20URL\x20configured\x20for\x20pending:',_0x3865cd),{'gateway_payment_id':_0x5d6ca4['id'],'payment_url':_0x5d6ca4[_0x24ad32(0x9b)][_0x24ad32(0xbf)],'qr_code_url':_0x5d6ca4[_0x24ad32(0x9b)][_0x24ad32(0xc7)],'expiry_date':_0x5d6ca4['expiryDate']};}catch(_0x437770){console[_0x24ad32(0xd3)](_0x24ad32(0xaf)),console[_0x24ad32(0xd3)](_0x24ad32(0xdb),_0x437770),loggerService_1[_0x24ad32(0xfa)]['logWhiteDomainError'](_0x24ad32(0xbb),_0x24ad32(0xf6),_0x437770);if(_0x437770 instanceof Error){console[_0x24ad32(0xd3)](_0x24ad32(0xe1),_0x437770[_0x24ad32(0xc3)]),console['error'](_0x24ad32(0xf5),_0x437770[_0x24ad32(0x10f)]);throw new Error(_0x24ad32(0xf4)+_0x437770[_0x24ad32(0xc3)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x5e780d){const _0x291c0b=a53_0x527d76,_0x5ef9f5=Date[_0x291c0b(0xb0)]();try{loggerService_1[_0x291c0b(0xfa)][_0x291c0b(0xa3)]('noda',_0x291c0b(0xf8)+_0x5e780d,_0x291c0b(0xc4),{});const _0x21bc9f=await fetch(this['apiUrl']+'/'+_0x5e780d,{'method':_0x291c0b(0xc4),'headers':{'Content-Type':_0x291c0b(0x9c),'User-Agent':_0x291c0b(0xf0)}}),_0x31f64a=Date[_0x291c0b(0xb0)]()-_0x5ef9f5;if(!_0x21bc9f['ok']){const _0x222566=await _0x21bc9f[_0x291c0b(0xf3)]();loggerService_1[_0x291c0b(0xfa)][_0x291c0b(0xa9)](_0x291c0b(0xbb),'/payment-links/'+_0x5e780d,_0x21bc9f[_0x291c0b(0xfd)],_0x222566,_0x31f64a);throw new Error(_0x291c0b(0xed)+_0x21bc9f['status']);}const _0x400262=await _0x21bc9f[_0x291c0b(0xf2)]();loggerService_1[_0x291c0b(0xfa)][_0x291c0b(0xa9)](_0x291c0b(0xbb),_0x291c0b(0xf8)+_0x5e780d,_0x21bc9f[_0x291c0b(0xfd)],_0x400262,_0x31f64a);if(_0x400262[_0x291c0b(0xd3)]||_0x400262[_0x291c0b(0xa1)]){loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x291c0b(0xf8)+_0x5e780d,_0x291c0b(0xb6)+(_0x400262[_0x291c0b(0xc3)]||_0x400262[_0x291c0b(0xd3)]||_0x291c0b(0x9f)));throw new Error(_0x291c0b(0xb6)+(_0x400262[_0x291c0b(0xc3)]||_0x400262[_0x291c0b(0xd3)]||_0x291c0b(0x9f)));}let _0x52afd0=_0x291c0b(0xce);if(_0x400262[_0x291c0b(0x10a)]===![]){if(_0x400262['expiryDate']){const _0x30e341=new Date(_0x400262[_0x291c0b(0xe5)]),_0x74b16b=new Date();_0x30e341<_0x74b16b?_0x52afd0=_0x291c0b(0x99):_0x52afd0='FAILED';}else _0x52afd0=_0x291c0b(0xaa);}else _0x52afd0='PENDING';return{'status':_0x52afd0,'amount':_0x400262[_0x291c0b(0xa8)],'currency':_0x400262[_0x291c0b(0xa4)],'isActive':_0x400262['isActive']};}catch(_0x147181){console['error'](_0x291c0b(0xdf),_0x147181),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x291c0b(0xf8)+_0x5e780d,_0x147181);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x147181 instanceof Error?_0x147181['message']:_0x291c0b(0x9f)));}}async[a53_0x527d76(0xf1)](_0x3fe457){const _0x511aee=a53_0x527d76;console[_0x511aee(0xb7)](_0x511aee(0xc6),_0x3fe457);let _0x3d2634=_0x511aee(0xce);switch(_0x3fe457[_0x511aee(0x102)]?.[_0x511aee(0xde)]()){case'done':case'completed':case _0x511aee(0xdc):case _0x511aee(0x10e):case _0x511aee(0xe4):_0x3fe457['Settled']===_0x511aee(0x9e)?_0x3d2634=_0x511aee(0xa7):_0x3d2634=_0x511aee(0xce);break;case _0x511aee(0xa5):case _0x511aee(0xd8):case _0x511aee(0xf9):case _0x511aee(0xd3):case _0x511aee(0xb2):_0x3d2634=_0x511aee(0xaa);break;case _0x511aee(0x105):case _0x511aee(0xcb):_0x3d2634='EXPIRED';break;case _0x511aee(0x110):case'created':case _0x511aee(0x98):case _0x511aee(0xa0):case'in_progress':default:_0x3d2634=_0x511aee(0xce);break;}return{'paymentId':_0x3fe457[_0x511aee(0xda)]||_0x3fe457[_0x511aee(0x103)],'status':_0x3d2634,'amount':_0x3fe457['Amount'],'currency':_0x3fe457[_0x511aee(0x108)],'additionalInfo':{'method':_0x3fe457['Method'],'bankId':_0x3fe457['BankId'],'settled':_0x3fe457[_0x511aee(0xd7)],'settlementDate':_0x3fe457['SettlementDate'],'remitterName':_0x3fe457[_0x511aee(0xe0)]?.['Name'],'remitterIban':_0x3fe457[_0x511aee(0xe0)]?.[_0x511aee(0xbe)],'bankTransactionId':_0x3fe457['BankTransactionId']}};}['verifyWebhookSignature'](_0x59383c,_0x4f3fa0){const _0x12d3fe=a53_0x527d76;return console[_0x12d3fe(0xb7)](_0x12d3fe(0xec),{'receivedSignature':_0x4f3fa0,'paymentId':_0x59383c[_0x12d3fe(0x103)],'merchantPaymentId':_0x59383c[_0x12d3fe(0xda)]}),!![];}}exports['NodaService']=NodaService;function a53_0x1f69(_0x331298,_0x31dd4d){const _0x553758=a53_0x5537();return a53_0x1f69=function(_0x1f6956,_0x2a9747){_0x1f6956=_0x1f6956-0x98;let _0x5475ab=_0x553758[_0x1f6956];return _0x5475ab;},a53_0x1f69(_0x331298,_0x31dd4d);}function a53_0x5537(){const _0xe86305=['Missing\x20id\x20or\x20shortLink\x20in\x20response','===\x20PARSED\x20NODA\x20RESPONSE\x20===','2SbdIjO','Response\x20data:','error','Not\x20provided','3216zYCzaa','Payment\x20Link\x20ID:','Settled','canceled','stringify','MerchantPaymentId','Error\x20details:','paid','5812849iygQfj','toLowerCase','Noda\x20payment\x20verification\x20error:','Remitter','Error\x20message:','../loggerService','Headers:','successful','expiryDate','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','55ZvWhVE','https://tesoft.uk/gateway/pending.php?id=','URL:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','headers','Noda\x20webhook\x20signature\x20verification:','HTTP\x20error!\x20status:\x20','logWhiteDomainError','869921ydMdLi','Payment\x20System/1.0','processWebhook','json','text','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Error\x20stack:','/payment-links','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','/payment-links/','failed','loggerService','3758238MUczKa','(8digits-8digits\x20format)','status','HTTP\x20Status:','Response\x20Time:','3531NXkiTS','parse','Status','PaymentId','QR\x20Code\x20Link:','expired','Status\x20Text:','Short\x20Link:','Currency','HTTP\x20','isActive','Parsed\x20Result:','Response\x20Body:','✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:','success','stack','pending','active','EXPIRED','Failed\x20to\x20parse\x20JSON\x20response:','shortLinkUrls','application/json',',\x20body:\x20','Yes','Unknown\x20error','processing','statusCode','POST','logWhiteDomainRequest','currency','cancelled','createPaymentLink','PAID','amount','logWhiteDomainResponse','FAILED','Status:','Unknown\x20error\x20from\x20Noda\x20API','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','6488004EIxAAu','===\x20NODA\x20SERVICE\x20ERROR\x20===','now','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','rejected','===\x20NODA\x20API\x20ERROR\x20===','Status\x20Code:','apiUrl','Noda\x20API\x20error:\x20','log','https://tesoft.uk/gateway/noda/','8zhRUTP','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','noda','Raw\x20Response\x20Body:','__esModule','Iban','shortLink','Request\x20Body\x20(Direct\x20JSON):','entries','Order\x20ID\x20Used:','message','GET','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Processing\x20Noda\x20webhook:','qrCodeLink','2169610VPUNmL','toUpperCase','https://tesoft.uk/gateway/noda/webhook/','timeout','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','1499090HTngGJ','PENDING'];a53_0x5537=function(){return _0xe86305;};return a53_0x5537();}