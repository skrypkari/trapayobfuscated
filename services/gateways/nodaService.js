'use strict';function a63_0x5593(){const _0xf235b9=['json','FAILED','createPaymentLink','===\x20NODA\x20SERVICE\x20ERROR\x20===','PAID','rejected','Order\x20ID\x20Format:','GET','Parsed\x20Result:','Iban','Currency','5011979XDLmhv','error','/payment-links','Not\x20provided','Status\x20Text:','POST','BankTransactionId','MerchantPaymentId','===\x20NODA\x20API\x20ERROR\x20===','currency','text','Payment\x20System/1.0','Noda\x20API\x20error:\x20','Amount','done','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','Short\x20Link:','defineProperty','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Headers:','Order\x20ID\x20Used:','pending','https://tesoft.uk/gateway/noda/','failed','PENDING','/payment-links/','message','shortLink','Unknown\x20error','HTTP\x20error!\x20status:\x20','statusText','Missing\x20id\x20or\x20shortLink\x20in\x20response','Unknown\x20error\x20from\x20Noda\x20API','cancelled','39lMvpJL','8Btjfeo','apiUrl','logWhiteDomainRequest','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','HTTP\x20Status:','Response\x20Body:','Response\x20Time:','logWhiteDomainError','logWhiteDomainResponse','Error\x20stack:','shortLinkUrls','NodaService','../loggerService','Noda\x20payment\x20verification\x20error:','17602880YOQZUn','PaymentId','noda','Error\x20Message:','(8digits-8digits\x20format)','Method','EXPIRED','isActive','URL:','Status:','parse','Name','411773CTDlXv','entries','expiryDate','Status\x20Code:','paid','Failed\x20to\x20parse\x20JSON\x20response:','136420jZLoDs','Payment\x20Link\x20ID:','expired','amount','created','Yes',',\x20body:\x20','Processing\x20Noda\x20webhook:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','application/json','269901xQJDwV','Failed\x20to\x20verify\x20Noda\x20payment:\x20','fromEntries','Response\x20data:','stringify','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','190hHiuVd','loggerService','476676VUJoBa','toUpperCase','qrCodeLink','HTTP\x20','verifyPayment','QR\x20Code\x20Link:','Business\x20Error:\x20','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','(8digits-8digits\x20format\x20for\x20Noda)','Remitter','status','Settled','log','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','successful','statusCode','__esModule','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','now','JSON\x20Parse\x20Error:\x20','===\x20NODA\x20SUCCESS\x20===','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','stack','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','timeout','45564gTIOzn'];a63_0x5593=function(){return _0xf235b9;};return a63_0x5593();}const a63_0x157a72=a63_0x4c20;(function(_0x301b16,_0x1f3a50){const _0x4d3c2f=a63_0x4c20,_0x4f18d4=_0x301b16();while(!![]){try{const _0x6df3bc=parseInt(_0x4d3c2f(0x11c))/0x1+-parseInt(_0x4d3c2f(0x134))/0x2+-parseInt(_0x4d3c2f(0x101))/0x3*(parseInt(_0x4d3c2f(0x122))/0x4)+parseInt(_0x4d3c2f(0x132))/0x5*(-parseInt(_0x4d3c2f(0x14f))/0x6)+parseInt(_0x4d3c2f(0x15b))/0x7*(-parseInt(_0x4d3c2f(0x102))/0x8)+-parseInt(_0x4d3c2f(0x12c))/0x9+parseInt(_0x4d3c2f(0x110))/0xa;if(_0x6df3bc===_0x1f3a50)break;else _0x4f18d4['push'](_0x4f18d4['shift']());}catch(_0x57c9cd){_0x4f18d4['push'](_0x4f18d4['shift']());}}}(a63_0x5593,0x6f478));function a63_0x4c20(_0x2ba57b,_0x57d75a){_0x2ba57b=_0x2ba57b-0xec;const _0x5593da=a63_0x5593();let _0x4c20ee=_0x5593da[_0x2ba57b];return _0x4c20ee;}Object[a63_0x157a72(0xf0)](exports,a63_0x157a72(0x145),{'value':!![]}),exports[a63_0x157a72(0x10d)]=void 0x0;const loggerService_1=require(a63_0x157a72(0x10e));class NodaService{constructor(){const _0x3b7c48=a63_0x157a72;this[_0x3b7c48(0x103)]=_0x3b7c48(0xf5),console[_0x3b7c48(0x141)](_0x3b7c48(0x14a));}async[a63_0x157a72(0x152)](_0x28a361){const _0x2e4b96=a63_0x157a72,{orderId:_0x26723c,name:_0x498a65,paymentDescription:_0x5c67eb,amount:_0x5693a2,currency:_0x2e7d2a,webhookUrl:_0x1b0e4f,returnUrl:_0x128f79,expiryDate:_0x2028d9}=_0x28a361,_0x4dca9c=_0x2e7d2a[_0x2e4b96(0x135)](),_0x106876='https://tesoft.uk/gateway/noda/webhook/',_0x162269='https://tesoft.uk/gateway/pending.php?id='+_0x26723c,_0x4c1fc0={'name':_0x498a65,'paymentDescription':_0x5c67eb,'amount':_0x5693a2,'currency':_0x4dca9c,'paymentId':_0x26723c,'webhookUrl':_0x106876,'returnUrl':_0x162269};_0x2028d9&&(_0x4c1fc0['expiryDate']=_0x2028d9);const _0x27c8e2=Date[_0x2e4b96(0x147)]();try{console[_0x2e4b96(0x141)](_0x2e4b96(0x13b)),console['log'](_0x2e4b96(0x118),this[_0x2e4b96(0x103)]),console['log']('Request\x20Body\x20(Direct\x20JSON):',JSON['stringify'](_0x4c1fc0,null,0x2)),console[_0x2e4b96(0x141)](_0x2e4b96(0x156),_0x26723c,_0x2e4b96(0x13d)),console['log'](_0x2e4b96(0xee),_0x162269),loggerService_1[_0x2e4b96(0x133)][_0x2e4b96(0x104)]('noda','/payment-links',_0x2e4b96(0x160),_0x4c1fc0);const _0xe7f2a4=await fetch(this[_0x2e4b96(0x103)],{'method':_0x2e4b96(0x160),'headers':{'Content-Type':'application/json','Accept':_0x2e4b96(0x12b),'User-Agent':_0x2e4b96(0x166)},'body':JSON[_0x2e4b96(0x130)](_0x4c1fc0)}),_0x54877b=Date[_0x2e4b96(0x147)]()-_0x27c8e2;console[_0x2e4b96(0x141)](_0x2e4b96(0x12a)),console[_0x2e4b96(0x141)](_0x2e4b96(0x119),_0xe7f2a4[_0x2e4b96(0x13f)]),console[_0x2e4b96(0x141)](_0x2e4b96(0x15f),_0xe7f2a4[_0x2e4b96(0xfd)]),console[_0x2e4b96(0x141)](_0x2e4b96(0xf2),Object[_0x2e4b96(0x12e)](_0xe7f2a4['headers'][_0x2e4b96(0x11d)]())),console[_0x2e4b96(0x141)](_0x2e4b96(0x108),_0x54877b+'ms');const _0x13c793=await _0xe7f2a4[_0x2e4b96(0x165)]();console[_0x2e4b96(0x141)]('Raw\x20Response\x20Body:',_0x13c793);if(!_0xe7f2a4['ok']){console[_0x2e4b96(0x15c)](_0x2e4b96(0x163)),console[_0x2e4b96(0x15c)](_0x2e4b96(0x106),_0xe7f2a4[_0x2e4b96(0x13f)]),console[_0x2e4b96(0x15c)](_0x2e4b96(0x107),_0x13c793),loggerService_1['loggerService'][_0x2e4b96(0x10a)]('noda',_0x2e4b96(0x15d),_0xe7f2a4[_0x2e4b96(0x13f)],_0x13c793,_0x54877b),loggerService_1[_0x2e4b96(0x133)][_0x2e4b96(0x109)]('noda',_0x2e4b96(0x15d),_0x2e4b96(0x137)+_0xe7f2a4[_0x2e4b96(0x13f)]+':\x20'+_0x13c793);if(_0xe7f2a4[_0x2e4b96(0x13f)]===0x190)throw new Error(_0x2e4b96(0x142));else{if(_0xe7f2a4[_0x2e4b96(0x13f)]===0x1f4)throw new Error(_0x2e4b96(0xf1));}throw new Error('HTTP\x20error!\x20status:\x20'+_0xe7f2a4['status']+_0x2e4b96(0x128)+_0x13c793);}let _0x35d081;try{_0x35d081=JSON[_0x2e4b96(0x11a)](_0x13c793);}catch(_0x460b34){console[_0x2e4b96(0x15c)](_0x2e4b96(0x121),_0x460b34),loggerService_1[_0x2e4b96(0x133)][_0x2e4b96(0x109)](_0x2e4b96(0x112),'/payment-links',_0x2e4b96(0x148)+_0x460b34);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x13c793);}console[_0x2e4b96(0x141)](_0x2e4b96(0x14c)),console['log'](_0x2e4b96(0x158),JSON[_0x2e4b96(0x130)](_0x35d081,null,0x2)),loggerService_1[_0x2e4b96(0x133)]['logWhiteDomainResponse'](_0x2e4b96(0x112),_0x2e4b96(0x15d),_0xe7f2a4['status'],_0x35d081,_0x54877b);if(_0x35d081[_0x2e4b96(0x15c)]||_0x35d081['statusCode']){const _0x4889f5=_0x35d081[_0x2e4b96(0xf9)]||_0x35d081[_0x2e4b96(0x15c)]||_0x2e4b96(0xff);console[_0x2e4b96(0x15c)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x2e4b96(0x15c)](_0x2e4b96(0x113),_0x4889f5),console[_0x2e4b96(0x15c)](_0x2e4b96(0x11f),_0x35d081[_0x2e4b96(0x144)]),loggerService_1[_0x2e4b96(0x133)][_0x2e4b96(0x109)]('noda',_0x2e4b96(0x15d),_0x2e4b96(0x13a)+_0x4889f5);throw new Error(_0x2e4b96(0x167)+_0x4889f5);}if(!_0x35d081['id']||!_0x35d081['shortLinkUrls']?.[_0x2e4b96(0xfa)]){console[_0x2e4b96(0x15c)](_0x2e4b96(0x146)),console['error'](_0x2e4b96(0xfe)),console[_0x2e4b96(0x15c)](_0x2e4b96(0x12f),_0x35d081),loggerService_1[_0x2e4b96(0x133)][_0x2e4b96(0x109)](_0x2e4b96(0x112),_0x2e4b96(0x15d),'Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x2e4b96(0x13c));}return console[_0x2e4b96(0x141)](_0x2e4b96(0x149)),console['log'](_0x2e4b96(0x123),_0x35d081['id']),console[_0x2e4b96(0x141)](_0x2e4b96(0xef),_0x35d081[_0x2e4b96(0x10c)][_0x2e4b96(0xfa)]),console[_0x2e4b96(0x141)](_0x2e4b96(0x139),_0x35d081[_0x2e4b96(0x10c)][_0x2e4b96(0x136)]||_0x2e4b96(0x15e)),console[_0x2e4b96(0x141)](_0x2e4b96(0xf3),_0x26723c,_0x2e4b96(0x114)),console[_0x2e4b96(0x141)](_0x2e4b96(0x105),_0x162269),{'gateway_payment_id':_0x35d081['id'],'payment_url':_0x35d081['shortLinkUrls']['shortLink'],'qr_code_url':_0x35d081['shortLinkUrls']['qrCodeLink'],'expiry_date':_0x35d081[_0x2e4b96(0x11e)]};}catch(_0x1e5728){console[_0x2e4b96(0x15c)](_0x2e4b96(0x153)),console[_0x2e4b96(0x15c)]('Error\x20details:',_0x1e5728),loggerService_1[_0x2e4b96(0x133)]['logWhiteDomainError'](_0x2e4b96(0x112),_0x2e4b96(0x15d),_0x1e5728);if(_0x1e5728 instanceof Error){console[_0x2e4b96(0x15c)]('Error\x20message:',_0x1e5728[_0x2e4b96(0xf9)]),console[_0x2e4b96(0x15c)](_0x2e4b96(0x10b),_0x1e5728[_0x2e4b96(0x14b)]);throw new Error(_0x2e4b96(0x131)+_0x1e5728[_0x2e4b96(0xf9)]);}throw new Error(_0x2e4b96(0x14d));}}async[a63_0x157a72(0x138)](_0x57f8cb){const _0x269875=a63_0x157a72,_0x2e0ae8=Date[_0x269875(0x147)]();try{loggerService_1[_0x269875(0x133)][_0x269875(0x104)](_0x269875(0x112),_0x269875(0xf8)+_0x57f8cb,_0x269875(0x157),{});const _0x21e8cf=await fetch(this['apiUrl']+'/'+_0x57f8cb,{'method':_0x269875(0x157),'headers':{'Content-Type':_0x269875(0x12b),'User-Agent':_0x269875(0x166)}}),_0x274b58=Date['now']()-_0x2e0ae8;if(!_0x21e8cf['ok']){const _0x2938cd=await _0x21e8cf[_0x269875(0x165)]();loggerService_1[_0x269875(0x133)][_0x269875(0x10a)](_0x269875(0x112),_0x269875(0xf8)+_0x57f8cb,_0x21e8cf['status'],_0x2938cd,_0x274b58);throw new Error(_0x269875(0xfc)+_0x21e8cf['status']);}const _0x2999f5=await _0x21e8cf[_0x269875(0x150)]();loggerService_1[_0x269875(0x133)]['logWhiteDomainResponse'](_0x269875(0x112),_0x269875(0xf8)+_0x57f8cb,_0x21e8cf['status'],_0x2999f5,_0x274b58);if(_0x2999f5[_0x269875(0x15c)]||_0x2999f5[_0x269875(0x144)]){loggerService_1[_0x269875(0x133)][_0x269875(0x109)](_0x269875(0x112),'/payment-links/'+_0x57f8cb,_0x269875(0x167)+(_0x2999f5[_0x269875(0xf9)]||_0x2999f5[_0x269875(0x15c)]||_0x269875(0xfb)));throw new Error(_0x269875(0x167)+(_0x2999f5[_0x269875(0xf9)]||_0x2999f5[_0x269875(0x15c)]||_0x269875(0xfb)));}let _0x58d458='PENDING';if(_0x2999f5[_0x269875(0x117)]===![]){if(_0x2999f5[_0x269875(0x11e)]){const _0x4e2fe6=new Date(_0x2999f5[_0x269875(0x11e)]),_0x29e8b0=new Date();_0x4e2fe6<_0x29e8b0?_0x58d458=_0x269875(0x116):_0x58d458='FAILED';}else _0x58d458=_0x269875(0x151);}else _0x58d458=_0x269875(0xf7);return{'status':_0x58d458,'amount':_0x2999f5[_0x269875(0x125)],'currency':_0x2999f5[_0x269875(0x164)],'isActive':_0x2999f5[_0x269875(0x117)]};}catch(_0x262b88){console[_0x269875(0x15c)](_0x269875(0x10f),_0x262b88),loggerService_1[_0x269875(0x133)][_0x269875(0x109)](_0x269875(0x112),_0x269875(0xf8)+_0x57f8cb,_0x262b88);throw new Error(_0x269875(0x12d)+(_0x262b88 instanceof Error?_0x262b88[_0x269875(0xf9)]:'Unknown\x20error'));}}async['processWebhook'](_0x303be4){const _0x24cfd2=a63_0x157a72;console[_0x24cfd2(0x141)](_0x24cfd2(0x129),_0x303be4);let _0x237d95='PENDING';switch(_0x303be4['Status']?.['toLowerCase']()){case _0x24cfd2(0xed):case'completed':case _0x24cfd2(0x120):case'success':case _0x24cfd2(0x143):_0x303be4[_0x24cfd2(0x140)]===_0x24cfd2(0x127)?_0x237d95=_0x24cfd2(0x154):_0x237d95='PENDING';break;case _0x24cfd2(0x100):case'canceled':case _0x24cfd2(0xf6):case _0x24cfd2(0x15c):case _0x24cfd2(0x155):_0x237d95=_0x24cfd2(0x151);break;case _0x24cfd2(0x124):case _0x24cfd2(0x14e):_0x237d95=_0x24cfd2(0x116);break;case _0x24cfd2(0xf4):case _0x24cfd2(0x126):case'active':case'processing':case'in_progress':default:_0x237d95=_0x24cfd2(0xf7);break;}return{'paymentId':_0x303be4[_0x24cfd2(0x162)]||_0x303be4[_0x24cfd2(0x111)],'status':_0x237d95,'amount':_0x303be4[_0x24cfd2(0xec)],'currency':_0x303be4[_0x24cfd2(0x15a)],'additionalInfo':{'method':_0x303be4[_0x24cfd2(0x115)],'bankId':_0x303be4['BankId'],'settled':_0x303be4['Settled'],'settlementDate':_0x303be4['SettlementDate'],'remitterName':_0x303be4['Remitter']?.[_0x24cfd2(0x11b)],'remitterIban':_0x303be4[_0x24cfd2(0x13e)]?.[_0x24cfd2(0x159)],'bankTransactionId':_0x303be4[_0x24cfd2(0x161)]}};}['verifyWebhookSignature'](_0x282899,_0x4cd8ce){const _0xbdea22=a63_0x157a72;return console[_0xbdea22(0x141)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x4cd8ce,'paymentId':_0x282899[_0xbdea22(0x111)],'merchantPaymentId':_0x282899['MerchantPaymentId']}),!![];}}exports[a63_0x157a72(0x10d)]=NodaService;