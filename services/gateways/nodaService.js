'use strict';const a44_0x2608e0=a44_0x59d1;(function(_0x47c1ac,_0x4f61b0){const _0x37f8d4=a44_0x59d1,_0x2bff42=_0x47c1ac();while(!![]){try{const _0x56e570=-parseInt(_0x37f8d4(0x1c1))/0x1*(-parseInt(_0x37f8d4(0x1d6))/0x2)+parseInt(_0x37f8d4(0x1b9))/0x3*(parseInt(_0x37f8d4(0x1b0))/0x4)+parseInt(_0x37f8d4(0x1d7))/0x5*(-parseInt(_0x37f8d4(0x1cd))/0x6)+-parseInt(_0x37f8d4(0x1b1))/0x7+-parseInt(_0x37f8d4(0x1c3))/0x8+parseInt(_0x37f8d4(0x205))/0x9+-parseInt(_0x37f8d4(0x199))/0xa;if(_0x56e570===_0x4f61b0)break;else _0x2bff42['push'](_0x2bff42['shift']());}catch(_0x41f911){_0x2bff42['push'](_0x2bff42['shift']());}}}(a44_0x2b45,0xc4852));Object['defineProperty'](exports,a44_0x2608e0(0x19f),{'value':!![]}),exports[a44_0x2608e0(0x1ea)]=void 0x0;const loggerService_1=require(a44_0x2608e0(0x1a4));class NodaService{constructor(){const _0x3445ed=a44_0x2608e0;this[_0x3445ed(0x196)]='https://tesoft.uk/gateway/noda/',console[_0x3445ed(0x1e4)](_0x3445ed(0x1f5));}async[a44_0x2608e0(0x1b6)](_0x5b07be){const _0x1778ad=a44_0x2608e0,{orderId:_0xf06935,name:_0x499b72,paymentDescription:_0x17c226,amount:_0x3b1c96,currency:_0x22a344,webhookUrl:_0x273382,returnUrl:_0x21fcaf,expiryDate:_0x22b265}=_0x5b07be,_0x14844b=_0x22a344[_0x1778ad(0x1bc)](),_0x244b56='https://tesoft.uk/gateway/noda/webhook/',_0x186837=_0x1778ad(0x1ad)+_0xf06935,_0x1dfe1d={'name':_0x499b72,'paymentDescription':_0x17c226,'amount':_0x3b1c96,'currency':_0x14844b,'paymentId':_0xf06935,'webhookUrl':_0x244b56,'returnUrl':_0x186837};_0x22b265&&(_0x1dfe1d['expiryDate']=_0x22b265);const _0x4c79e0=Date['now']();try{console[_0x1778ad(0x1e4)](_0x1778ad(0x204)),console[_0x1778ad(0x1e4)](_0x1778ad(0x191),this[_0x1778ad(0x196)]),console[_0x1778ad(0x1e4)](_0x1778ad(0x1a7),JSON[_0x1778ad(0x1dc)](_0x1dfe1d,null,0x2)),console[_0x1778ad(0x1e4)](_0x1778ad(0x1d8),_0xf06935,_0x1778ad(0x190)),console[_0x1778ad(0x1e4)]('✅\x20ОБНОВЛЕНО:\x20Return\x20URL\x20uses\x20pending.php:',_0x186837),loggerService_1[_0x1778ad(0x1d3)]['logWhiteDomainRequest']('noda','/payment-links',_0x1778ad(0x1bb),_0x1dfe1d);const _0x3e1132=await fetch(this['apiUrl'],{'method':_0x1778ad(0x1bb),'headers':{'Content-Type':_0x1778ad(0x1f3),'Accept':'application/json','User-Agent':_0x1778ad(0x1ba)},'body':JSON['stringify'](_0x1dfe1d)}),_0x4a170d=Date[_0x1778ad(0x1c8)]()-_0x4c79e0;console[_0x1778ad(0x1e4)](_0x1778ad(0x1ec)),console[_0x1778ad(0x1e4)]('Status:',_0x3e1132[_0x1778ad(0x1b7)]),console[_0x1778ad(0x1e4)](_0x1778ad(0x1ef),_0x3e1132[_0x1778ad(0x1c5)]),console[_0x1778ad(0x1e4)]('Headers:',Object['fromEntries'](_0x3e1132[_0x1778ad(0x1ed)][_0x1778ad(0x1ca)]())),console[_0x1778ad(0x1e4)](_0x1778ad(0x1d4),_0x4a170d+'ms');const _0x332b88=await _0x3e1132[_0x1778ad(0x194)]();console[_0x1778ad(0x1e4)]('Raw\x20Response\x20Body:',_0x332b88);if(!_0x3e1132['ok']){console['error'](_0x1778ad(0x1b5)),console[_0x1778ad(0x192)](_0x1778ad(0x1a8),_0x3e1132[_0x1778ad(0x1b7)]),console[_0x1778ad(0x192)](_0x1778ad(0x1a9),_0x332b88),loggerService_1[_0x1778ad(0x1d3)][_0x1778ad(0x1e5)]('noda','/payment-links',_0x3e1132[_0x1778ad(0x1b7)],_0x332b88,_0x4a170d),loggerService_1[_0x1778ad(0x1d3)]['logWhiteDomainError'](_0x1778ad(0x1e0),_0x1778ad(0x1e2),_0x1778ad(0x1bd)+_0x3e1132['status']+':\x20'+_0x332b88);if(_0x3e1132[_0x1778ad(0x1b7)]===0x190)throw new Error(_0x1778ad(0x1f0));else{if(_0x3e1132[_0x1778ad(0x1b7)]===0x1f4)throw new Error(_0x1778ad(0x1db));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x3e1132['status']+',\x20body:\x20'+_0x332b88);}let _0x18b92f;try{_0x18b92f=JSON[_0x1778ad(0x1fd)](_0x332b88);}catch(_0x442db1){console[_0x1778ad(0x192)](_0x1778ad(0x1fb),_0x442db1),loggerService_1[_0x1778ad(0x1d3)][_0x1778ad(0x1a3)](_0x1778ad(0x1e0),_0x1778ad(0x1e2),_0x1778ad(0x19d)+_0x442db1);throw new Error(_0x1778ad(0x1f6)+_0x332b88);}console[_0x1778ad(0x1e4)](_0x1778ad(0x206)),console[_0x1778ad(0x1e4)](_0x1778ad(0x1af),JSON[_0x1778ad(0x1dc)](_0x18b92f,null,0x2)),loggerService_1[_0x1778ad(0x1d3)][_0x1778ad(0x1e5)](_0x1778ad(0x1e0),_0x1778ad(0x1e2),_0x3e1132['status'],_0x18b92f,_0x4a170d);if(_0x18b92f[_0x1778ad(0x192)]||_0x18b92f['statusCode']){const _0x44a442=_0x18b92f[_0x1778ad(0x1b2)]||_0x18b92f[_0x1778ad(0x192)]||_0x1778ad(0x1e7);console[_0x1778ad(0x192)](_0x1778ad(0x1cc)),console[_0x1778ad(0x192)](_0x1778ad(0x1f8),_0x44a442),console['error'](_0x1778ad(0x1c2),_0x18b92f[_0x1778ad(0x1fe)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x1778ad(0x1e0),_0x1778ad(0x1e2),'Business\x20Error:\x20'+_0x44a442);throw new Error('Noda\x20API\x20error:\x20'+_0x44a442);}if(!_0x18b92f['id']||!_0x18b92f[_0x1778ad(0x19c)]?.[_0x1778ad(0x198)]){console[_0x1778ad(0x192)](_0x1778ad(0x1d1)),console['error'](_0x1778ad(0x1df)),console[_0x1778ad(0x192)](_0x1778ad(0x1e1),_0x18b92f),loggerService_1[_0x1778ad(0x1d3)][_0x1778ad(0x1a3)](_0x1778ad(0x1e0),_0x1778ad(0x1e2),_0x1778ad(0x1c9));throw new Error(_0x1778ad(0x1ce));}return console[_0x1778ad(0x1e4)]('===\x20NODA\x20SUCCESS\x20==='),console['log']('Payment\x20Link\x20ID:',_0x18b92f['id']),console[_0x1778ad(0x1e4)](_0x1778ad(0x1aa),_0x18b92f[_0x1778ad(0x19c)][_0x1778ad(0x198)]),console[_0x1778ad(0x1e4)]('QR\x20Code\x20Link:',_0x18b92f[_0x1778ad(0x19c)][_0x1778ad(0x1a6)]||'Not\x20provided'),console[_0x1778ad(0x1e4)](_0x1778ad(0x197),_0xf06935,'(8digits-8digits\x20format)'),console[_0x1778ad(0x1e4)](_0x1778ad(0x19e),_0x186837),{'gateway_payment_id':_0x18b92f['id'],'payment_url':_0x18b92f[_0x1778ad(0x19c)]['shortLink'],'qr_code_url':_0x18b92f[_0x1778ad(0x19c)][_0x1778ad(0x1a6)],'expiry_date':_0x18b92f[_0x1778ad(0x1be)]};}catch(_0x41dd86){console['error']('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console['error'](_0x1778ad(0x195),_0x41dd86),loggerService_1[_0x1778ad(0x1d3)]['logWhiteDomainError'](_0x1778ad(0x1e0),_0x1778ad(0x1e2),_0x41dd86);if(_0x41dd86 instanceof Error){console[_0x1778ad(0x192)](_0x1778ad(0x1e3),_0x41dd86[_0x1778ad(0x1b2)]),console['error'](_0x1778ad(0x1cf),_0x41dd86[_0x1778ad(0x1a2)]);throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20'+_0x41dd86['message']);}throw new Error(_0x1778ad(0x1e9));}}async[a44_0x2608e0(0x1b8)](_0x57f1af){const _0x414365=a44_0x2608e0,_0x35bfdd=Date[_0x414365(0x1c8)]();try{loggerService_1[_0x414365(0x1d3)][_0x414365(0x1eb)]('noda',_0x414365(0x1bf)+_0x57f1af,'GET',{});const _0x3e3390=await fetch(this[_0x414365(0x196)]+'/'+_0x57f1af,{'method':'GET','headers':{'Content-Type':_0x414365(0x1f3),'User-Agent':_0x414365(0x1ba)}}),_0x258f79=Date['now']()-_0x35bfdd;if(!_0x3e3390['ok']){const _0x200905=await _0x3e3390[_0x414365(0x194)]();loggerService_1[_0x414365(0x1d3)][_0x414365(0x1e5)](_0x414365(0x1e0),_0x414365(0x1bf)+_0x57f1af,_0x3e3390[_0x414365(0x1b7)],_0x200905,_0x258f79);throw new Error(_0x414365(0x1b3)+_0x3e3390[_0x414365(0x1b7)]);}const _0x35e42e=await _0x3e3390[_0x414365(0x1e6)]();loggerService_1[_0x414365(0x1d3)][_0x414365(0x1e5)](_0x414365(0x1e0),'/payment-links/'+_0x57f1af,_0x3e3390[_0x414365(0x1b7)],_0x35e42e,_0x258f79);if(_0x35e42e['error']||_0x35e42e[_0x414365(0x1fe)]){loggerService_1['loggerService'][_0x414365(0x1a3)](_0x414365(0x1e0),'/payment-links/'+_0x57f1af,_0x414365(0x1e8)+(_0x35e42e[_0x414365(0x1b2)]||_0x35e42e[_0x414365(0x192)]||_0x414365(0x1da)));throw new Error('Noda\x20API\x20error:\x20'+(_0x35e42e[_0x414365(0x1b2)]||_0x35e42e[_0x414365(0x192)]||_0x414365(0x1da)));}let _0x1ea115='PENDING';if(_0x35e42e[_0x414365(0x202)]===![]){if(_0x35e42e[_0x414365(0x1be)]){const _0x127297=new Date(_0x35e42e[_0x414365(0x1be)]),_0x4967ad=new Date();_0x127297<_0x4967ad?_0x1ea115=_0x414365(0x1b4):_0x1ea115=_0x414365(0x1c6);}else _0x1ea115='FAILED';}else _0x1ea115=_0x414365(0x1f4);return{'status':_0x1ea115,'amount':_0x35e42e[_0x414365(0x1a5)],'currency':_0x35e42e['currency'],'isActive':_0x35e42e['isActive']};}catch(_0xfe1ae3){console['error']('Noda\x20payment\x20verification\x20error:',_0xfe1ae3),loggerService_1[_0x414365(0x1d3)][_0x414365(0x1a3)](_0x414365(0x1e0),_0x414365(0x1bf)+_0x57f1af,_0xfe1ae3);throw new Error(_0x414365(0x1fa)+(_0xfe1ae3 instanceof Error?_0xfe1ae3[_0x414365(0x1b2)]:_0x414365(0x1da)));}}async[a44_0x2608e0(0x201)](_0x2ff5cc){const _0xf5106=a44_0x2608e0;console[_0xf5106(0x1e4)](_0xf5106(0x19b),_0x2ff5cc);let _0x59752d=_0xf5106(0x1f4);switch(_0x2ff5cc[_0xf5106(0x1c4)]?.['toLowerCase']()){case _0xf5106(0x1ab):case'completed':case _0xf5106(0x193):case _0xf5106(0x1a1):case _0xf5106(0x1ae):_0x2ff5cc['Settled']===_0xf5106(0x1dd)?_0x59752d=_0xf5106(0x1a0):_0x59752d=_0xf5106(0x1f4);break;case'cancelled':case _0xf5106(0x1d2):case _0xf5106(0x19a):case _0xf5106(0x192):case _0xf5106(0x203):_0x59752d=_0xf5106(0x1c6);break;case'expired':case _0xf5106(0x1c7):_0x59752d=_0xf5106(0x1b4);break;case _0xf5106(0x1fc):case'created':case _0xf5106(0x1ff):case _0xf5106(0x1f2):case _0xf5106(0x200):default:_0x59752d='PENDING';break;}return{'paymentId':_0x2ff5cc['MerchantPaymentId']||_0x2ff5cc[_0xf5106(0x1c0)],'status':_0x59752d,'amount':_0x2ff5cc[_0xf5106(0x1cb)],'currency':_0x2ff5cc[_0xf5106(0x1f9)],'additionalInfo':{'method':_0x2ff5cc[_0xf5106(0x1d5)],'bankId':_0x2ff5cc['BankId'],'settled':_0x2ff5cc[_0xf5106(0x1ac)],'settlementDate':_0x2ff5cc['SettlementDate'],'remitterName':_0x2ff5cc[_0xf5106(0x1de)]?.['Name'],'remitterIban':_0x2ff5cc['Remitter']?.[_0xf5106(0x1f1)],'bankTransactionId':_0x2ff5cc[_0xf5106(0x1d0)]}};}[a44_0x2608e0(0x1ee)](_0x2622c9,_0x5047b2){const _0x309012=a44_0x2608e0;return console[_0x309012(0x1e4)](_0x309012(0x1f7),{'receivedSignature':_0x5047b2,'paymentId':_0x2622c9[_0x309012(0x1c0)],'merchantPaymentId':_0x2622c9[_0x309012(0x1d9)]}),!![];}}exports['NodaService']=NodaService;function a44_0x59d1(_0x5078b2,_0x19ca5e){const _0x2b455e=a44_0x2b45();return a44_0x59d1=function(_0x59d1e6,_0x1b1d98){_0x59d1e6=_0x59d1e6-0x190;let _0x371b3b=_0x2b455e[_0x59d1e6];return _0x371b3b;},a44_0x59d1(_0x5078b2,_0x19ca5e);}function a44_0x2b45(){const _0x962454=['statusCode','active','in_progress','processWebhook','isActive','rejected','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','335538NfXHOa','===\x20PARSED\x20NODA\x20RESPONSE\x20===','(8digits-8digits\x20format\x20for\x20Noda)','URL:','error','paid','text','Error\x20details:','apiUrl','Order\x20ID\x20Used:','shortLink','916500IiMwMR','failed','Processing\x20Noda\x20webhook:','shortLinkUrls','JSON\x20Parse\x20Error:\x20','✅\x20Return\x20URL\x20configured\x20for\x20pending:','__esModule','PAID','success','stack','logWhiteDomainError','../loggerService','amount','qrCodeLink','Request\x20Body\x20(Direct\x20JSON):','HTTP\x20Status:','Response\x20Body:','Short\x20Link:','done','Settled','https://tesoft.uk/gateway/pending.php?id=','successful','Parsed\x20Result:','276RjJcaY','1028797lkUmGc','message','HTTP\x20error!\x20status:\x20','EXPIRED','===\x20NODA\x20API\x20ERROR\x20===','createPaymentLink','status','verifyPayment','6168YngGBn','TesSoft\x20Payment\x20System/1.0','POST','toUpperCase','HTTP\x20','expiryDate','/payment-links/','PaymentId','1779XKIsKf','Status\x20Code:','575240IxnqhH','Status','statusText','FAILED','timeout','now','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','entries','Amount','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','600gnEtiy','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Error\x20stack:','BankTransactionId','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','canceled','loggerService','Response\x20Time:','Method','1788ZPdmeR','32705auTlKk','Order\x20ID\x20Format:','MerchantPaymentId','Unknown\x20error','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','stringify','Yes','Remitter','Missing\x20id\x20or\x20shortLink\x20in\x20response','noda','Response\x20data:','/payment-links','Error\x20message:','log','logWhiteDomainResponse','json','Unknown\x20error\x20from\x20Noda\x20API','Noda\x20API\x20error:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','NodaService','logWhiteDomainRequest','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','headers','verifyWebhookSignature','Status\x20Text:','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Iban','processing','application/json','PENDING','🌐\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Noda\x20webhook\x20signature\x20verification:','Error\x20Message:','Currency','Failed\x20to\x20verify\x20Noda\x20payment:\x20','Failed\x20to\x20parse\x20JSON\x20response:','pending','parse'];a44_0x2b45=function(){return _0x962454;};return a44_0x2b45();}