'use strict';function a71_0xd0ae(){const _0x5c280c=['Raw\x20Response\x20Body:','Response\x20data:','statusText','Request\x20Body\x20(Direct\x20JSON):','NodaService','3062845fDhYBQ','pending','PaymentId','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','message','Unknown\x20error','status','1005467MQXTRC','===\x20NODA\x20SUCCESS\x20===','done','Response\x20Time:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','text','parse','Noda\x20payment\x20verification\x20error:','PAID','POST','(8digits-8digits\x20format\x20for\x20Noda)','1466028ZPtSba','Status\x20Code:','logWhiteDomainError','Noda\x20API\x20error:\x20','Headers:','now','paid','application/json','441jrwXEU','shortLink','Error\x20details:','29745310RJsiot','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','fromEntries','Status:','failed','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','16236hrMiRU','defineProperty','FAILED','2600aUmPhN','active','created','__esModule','Payment\x20Link\x20ID:','HTTP\x20Status:','apiUrl','Processing\x20Noda\x20webhook:','9105186rycRfl','entries','stringify','Name','shortLinkUrls','error','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','===\x20NODA\x20SERVICE\x20ERROR\x20===','Business\x20Error:\x20','toLowerCase','canceled','SettlementDate','Failed\x20to\x20parse\x20JSON\x20response:','Parsed\x20Result:','JSON\x20Parse\x20Error:\x20','loggerService','json','Status\x20Text:','Order\x20ID\x20Format:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','QR\x20Code\x20Link:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','noda','Order\x20ID\x20Used:','logWhiteDomainRequest','PENDING','log','Settled','BankTransactionId','(8digits-8digits\x20format)','success','GET','/payment-links/','Failed\x20to\x20verify\x20Noda\x20payment:\x20','https://tesoft.uk/gateway/pending.php?id=','Method','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','logWhiteDomainResponse','Error\x20stack:','completed','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','createPaymentLink','Response\x20Body:','qrCodeLink','amount','Short\x20Link:','42536zFqoeC','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','/payment-links','7iqGQvl','statusCode','HTTP\x20error!\x20status:\x20','Payment\x20System/1.0','expired','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','expiryDate',',\x20body:\x20','headers','Unknown\x20error\x20from\x20Noda\x20API','verifyPayment','URL:','processWebhook','https://tesoft.uk/gateway/noda/webhook/','toUpperCase'];a71_0xd0ae=function(){return _0x5c280c;};return a71_0xd0ae();}function a71_0x2168(_0x4fbcd2,_0x435e1c){_0x4fbcd2=_0x4fbcd2-0x10d;const _0xd0ae2b=a71_0xd0ae();let _0x216885=_0xd0ae2b[_0x4fbcd2];return _0x216885;}const a71_0x25151d=a71_0x2168;(function(_0x3f32a7,_0x205327){const _0x207cc6=a71_0x2168,_0x57b1d7=_0x3f32a7();while(!![]){try{const _0xe4fac=-parseInt(_0x207cc6(0x132))/0x1+parseInt(_0x207cc6(0x13d))/0x2+parseInt(_0x207cc6(0x145))/0x3*(-parseInt(_0x207cc6(0x114))/0x4)+parseInt(_0x207cc6(0x12b))/0x5+parseInt(_0x207cc6(0x159))/0x6*(-parseInt(_0x207cc6(0x117))/0x7)+-parseInt(_0x207cc6(0x151))/0x8*(-parseInt(_0x207cc6(0x14e))/0x9)+parseInt(_0x207cc6(0x148))/0xa;if(_0xe4fac===_0x205327)break;else _0x57b1d7['push'](_0x57b1d7['shift']());}catch(_0x1e41e4){_0x57b1d7['push'](_0x57b1d7['shift']());}}}(a71_0xd0ae,0xc83fa));Object[a71_0x25151d(0x14f)](exports,a71_0x25151d(0x154),{'value':!![]}),exports[a71_0x25151d(0x12a)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x59de96=a71_0x25151d;this['apiUrl']='https://tesoft.uk/gateway/noda/',console[_0x59de96(0x174)](_0x59de96(0x136));}async[a71_0x25151d(0x10f)](_0x3f0833){const _0x5e0066=a71_0x25151d,{orderId:_0x16bd4a,name:_0x5365b5,paymentDescription:_0x3f41bc,amount:_0x56116a,currency:_0x1d0569,webhookUrl:_0x1616ec,returnUrl:_0xe84fef,expiryDate:_0x56d17d}=_0x3f0833,_0x4a1e84=_0x1d0569[_0x5e0066(0x125)](),_0x304a03=_0x5e0066(0x124),_0x2072ec=_0x5e0066(0x17c)+_0x16bd4a,_0x338a83={'name':_0x5365b5,'paymentDescription':_0x3f41bc,'amount':_0x56116a,'currency':_0x4a1e84,'paymentId':_0x16bd4a,'webhookUrl':_0x304a03,'returnUrl':_0x2072ec};_0x56d17d&&(_0x338a83[_0x5e0066(0x11d)]=_0x56d17d);const _0x2df03a=Date['now']();try{console['log'](_0x5e0066(0x12e)),console[_0x5e0066(0x174)](_0x5e0066(0x122),this[_0x5e0066(0x157)]),console[_0x5e0066(0x174)](_0x5e0066(0x129),JSON[_0x5e0066(0x15b)](_0x338a83,null,0x2)),console[_0x5e0066(0x174)](_0x5e0066(0x16c),_0x16bd4a,_0x5e0066(0x13c)),console[_0x5e0066(0x174)]('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x2072ec),loggerService_1[_0x5e0066(0x169)]['logWhiteDomainRequest']('noda',_0x5e0066(0x116),_0x5e0066(0x13b),_0x338a83);const _0x4e99e9=await fetch(this[_0x5e0066(0x157)],{'method':_0x5e0066(0x13b),'headers':{'Content-Type':'application/json','Accept':_0x5e0066(0x144),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x5e0066(0x15b)](_0x338a83)}),_0x34a3db=Date[_0x5e0066(0x142)]()-_0x2df03a;console[_0x5e0066(0x174)](_0x5e0066(0x16d)),console[_0x5e0066(0x174)](_0x5e0066(0x14b),_0x4e99e9[_0x5e0066(0x131)]),console[_0x5e0066(0x174)](_0x5e0066(0x16b),_0x4e99e9[_0x5e0066(0x128)]),console[_0x5e0066(0x174)](_0x5e0066(0x141),Object[_0x5e0066(0x14a)](_0x4e99e9[_0x5e0066(0x11f)][_0x5e0066(0x15a)]())),console[_0x5e0066(0x174)](_0x5e0066(0x135),_0x34a3db+'ms');const _0x1394c9=await _0x4e99e9[_0x5e0066(0x137)]();console[_0x5e0066(0x174)](_0x5e0066(0x126),_0x1394c9);if(!_0x4e99e9['ok']){console[_0x5e0066(0x15e)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x5e0066(0x15e)](_0x5e0066(0x156),_0x4e99e9[_0x5e0066(0x131)]),console[_0x5e0066(0x15e)](_0x5e0066(0x110),_0x1394c9),loggerService_1[_0x5e0066(0x169)][_0x5e0066(0x17f)](_0x5e0066(0x170),_0x5e0066(0x116),_0x4e99e9['status'],_0x1394c9,_0x34a3db),loggerService_1['loggerService'][_0x5e0066(0x13f)](_0x5e0066(0x170),_0x5e0066(0x116),'HTTP\x20'+_0x4e99e9[_0x5e0066(0x131)]+':\x20'+_0x1394c9);if(_0x4e99e9['status']===0x190)throw new Error(_0x5e0066(0x17e));else{if(_0x4e99e9[_0x5e0066(0x131)]===0x1f4)throw new Error(_0x5e0066(0x11c));}throw new Error(_0x5e0066(0x119)+_0x4e99e9[_0x5e0066(0x131)]+_0x5e0066(0x11e)+_0x1394c9);}let _0x16cfb5;try{_0x16cfb5=JSON[_0x5e0066(0x138)](_0x1394c9);}catch(_0x840c77){console['error'](_0x5e0066(0x166),_0x840c77),loggerService_1['loggerService'][_0x5e0066(0x13f)](_0x5e0066(0x170),'/payment-links',_0x5e0066(0x168)+_0x840c77);throw new Error(_0x5e0066(0x14d)+_0x1394c9);}console[_0x5e0066(0x174)]('===\x20PARSED\x20NODA\x20RESPONSE\x20==='),console[_0x5e0066(0x174)](_0x5e0066(0x167),JSON[_0x5e0066(0x15b)](_0x16cfb5,null,0x2)),loggerService_1[_0x5e0066(0x169)][_0x5e0066(0x17f)](_0x5e0066(0x170),_0x5e0066(0x116),_0x4e99e9['status'],_0x16cfb5,_0x34a3db);if(_0x16cfb5['error']||_0x16cfb5[_0x5e0066(0x118)]){const _0xbdf677=_0x16cfb5[_0x5e0066(0x12f)]||_0x16cfb5[_0x5e0066(0x15e)]||_0x5e0066(0x120);console['error'](_0x5e0066(0x15f)),console[_0x5e0066(0x15e)]('Error\x20Message:',_0xbdf677),console[_0x5e0066(0x15e)](_0x5e0066(0x13e),_0x16cfb5[_0x5e0066(0x118)]),loggerService_1[_0x5e0066(0x169)][_0x5e0066(0x13f)](_0x5e0066(0x170),'/payment-links',_0x5e0066(0x162)+_0xbdf677);throw new Error(_0x5e0066(0x140)+_0xbdf677);}if(!_0x16cfb5['id']||!_0x16cfb5['shortLinkUrls']?.['shortLink']){console[_0x5e0066(0x15e)](_0x5e0066(0x149)),console[_0x5e0066(0x15e)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x5e0066(0x15e)](_0x5e0066(0x127),_0x16cfb5),loggerService_1['loggerService']['logWhiteDomainError']('noda',_0x5e0066(0x116),_0x5e0066(0x16f));throw new Error('Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink');}return console[_0x5e0066(0x174)](_0x5e0066(0x133)),console[_0x5e0066(0x174)](_0x5e0066(0x155),_0x16cfb5['id']),console[_0x5e0066(0x174)](_0x5e0066(0x113),_0x16cfb5[_0x5e0066(0x15d)][_0x5e0066(0x146)]),console[_0x5e0066(0x174)](_0x5e0066(0x16e),_0x16cfb5[_0x5e0066(0x15d)][_0x5e0066(0x111)]||'Not\x20provided'),console['log'](_0x5e0066(0x171),_0x16bd4a,_0x5e0066(0x177)),console['log'](_0x5e0066(0x10e),_0x2072ec),{'gateway_payment_id':_0x16cfb5['id'],'payment_url':_0x16cfb5[_0x5e0066(0x15d)][_0x5e0066(0x146)],'qr_code_url':_0x16cfb5[_0x5e0066(0x15d)][_0x5e0066(0x111)],'expiry_date':_0x16cfb5[_0x5e0066(0x11d)]};}catch(_0x36bd16){console[_0x5e0066(0x15e)](_0x5e0066(0x161)),console[_0x5e0066(0x15e)](_0x5e0066(0x147),_0x36bd16),loggerService_1[_0x5e0066(0x169)][_0x5e0066(0x13f)](_0x5e0066(0x170),_0x5e0066(0x116),_0x36bd16);if(_0x36bd16 instanceof Error){console[_0x5e0066(0x15e)]('Error\x20message:',_0x36bd16[_0x5e0066(0x12f)]),console['error'](_0x5e0066(0x180),_0x36bd16['stack']);throw new Error(_0x5e0066(0x160)+_0x36bd16[_0x5e0066(0x12f)]);}throw new Error(_0x5e0066(0x115));}}async[a71_0x25151d(0x121)](_0x5c3f2f){const _0x272cfc=a71_0x25151d,_0x1b6ba4=Date[_0x272cfc(0x142)]();try{loggerService_1[_0x272cfc(0x169)][_0x272cfc(0x172)](_0x272cfc(0x170),_0x272cfc(0x17a)+_0x5c3f2f,_0x272cfc(0x179),{});const _0xce9ce7=await fetch(this[_0x272cfc(0x157)]+'/'+_0x5c3f2f,{'method':_0x272cfc(0x179),'headers':{'Content-Type':_0x272cfc(0x144),'User-Agent':_0x272cfc(0x11a)}}),_0x3ab9bc=Date['now']()-_0x1b6ba4;if(!_0xce9ce7['ok']){const _0x3c0580=await _0xce9ce7['text']();loggerService_1[_0x272cfc(0x169)]['logWhiteDomainResponse'](_0x272cfc(0x170),_0x272cfc(0x17a)+_0x5c3f2f,_0xce9ce7[_0x272cfc(0x131)],_0x3c0580,_0x3ab9bc);throw new Error(_0x272cfc(0x119)+_0xce9ce7[_0x272cfc(0x131)]);}const _0x516340=await _0xce9ce7[_0x272cfc(0x16a)]();loggerService_1['loggerService'][_0x272cfc(0x17f)]('noda','/payment-links/'+_0x5c3f2f,_0xce9ce7[_0x272cfc(0x131)],_0x516340,_0x3ab9bc);if(_0x516340[_0x272cfc(0x15e)]||_0x516340[_0x272cfc(0x118)]){loggerService_1[_0x272cfc(0x169)]['logWhiteDomainError'](_0x272cfc(0x170),'/payment-links/'+_0x5c3f2f,_0x272cfc(0x140)+(_0x516340[_0x272cfc(0x12f)]||_0x516340[_0x272cfc(0x15e)]||_0x272cfc(0x130)));throw new Error(_0x272cfc(0x140)+(_0x516340[_0x272cfc(0x12f)]||_0x516340[_0x272cfc(0x15e)]||_0x272cfc(0x130)));}let _0x55a173=_0x272cfc(0x173);if(_0x516340['isActive']===![]){if(_0x516340[_0x272cfc(0x11d)]){const _0xb605b8=new Date(_0x516340['expiryDate']),_0x4bc6c9=new Date();_0xb605b8<_0x4bc6c9?_0x55a173='EXPIRED':_0x55a173=_0x272cfc(0x150);}else _0x55a173=_0x272cfc(0x150);}else _0x55a173='PENDING';return{'status':_0x55a173,'amount':_0x516340[_0x272cfc(0x112)],'currency':_0x516340['currency'],'isActive':_0x516340['isActive']};}catch(_0x5c1c6a){console[_0x272cfc(0x15e)](_0x272cfc(0x139),_0x5c1c6a),loggerService_1['loggerService'][_0x272cfc(0x13f)](_0x272cfc(0x170),_0x272cfc(0x17a)+_0x5c3f2f,_0x5c1c6a);throw new Error(_0x272cfc(0x17b)+(_0x5c1c6a instanceof Error?_0x5c1c6a['message']:_0x272cfc(0x130)));}}async[a71_0x25151d(0x123)](_0x4534dd){const _0x36c886=a71_0x25151d;console['log'](_0x36c886(0x158),_0x4534dd);let _0x2b4330=_0x36c886(0x173);switch(_0x4534dd['Status']?.[_0x36c886(0x163)]()){case _0x36c886(0x134):case _0x36c886(0x10d):case _0x36c886(0x143):case _0x36c886(0x178):case'successful':_0x4534dd[_0x36c886(0x175)]==='Yes'?_0x2b4330=_0x36c886(0x13a):_0x2b4330=_0x36c886(0x173);break;case'cancelled':case _0x36c886(0x164):case _0x36c886(0x14c):case'error':case'rejected':_0x2b4330='FAILED';break;case _0x36c886(0x11b):case'timeout':_0x2b4330='EXPIRED';break;case _0x36c886(0x12c):case _0x36c886(0x153):case _0x36c886(0x152):case'processing':case'in_progress':default:_0x2b4330=_0x36c886(0x173);break;}return{'paymentId':_0x4534dd['MerchantPaymentId']||_0x4534dd[_0x36c886(0x12d)],'status':_0x2b4330,'amount':_0x4534dd['Amount'],'currency':_0x4534dd['Currency'],'additionalInfo':{'method':_0x4534dd[_0x36c886(0x17d)],'bankId':_0x4534dd['BankId'],'settled':_0x4534dd[_0x36c886(0x175)],'settlementDate':_0x4534dd[_0x36c886(0x165)],'remitterName':_0x4534dd['Remitter']?.[_0x36c886(0x15c)],'remitterIban':_0x4534dd['Remitter']?.['Iban'],'bankTransactionId':_0x4534dd[_0x36c886(0x176)]}};}['verifyWebhookSignature'](_0xee95d3,_0x4ac58c){const _0xf6b308=a71_0x25151d;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x4ac58c,'paymentId':_0xee95d3[_0xf6b308(0x12d)],'merchantPaymentId':_0xee95d3['MerchantPaymentId']}),!![];}}exports[a71_0x25151d(0x12a)]=NodaService;