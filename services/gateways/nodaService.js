'use strict';const a50_0x4442e5=a50_0x4e62;function a50_0x4e62(_0x185c55,_0x27385a){const _0x516884=a50_0x5168();return a50_0x4e62=function(_0x4e6245,_0x596a54){_0x4e6245=_0x4e6245-0xe2;let _0xc84644=_0x516884[_0x4e6245];return _0xc84644;},a50_0x4e62(_0x185c55,_0x27385a);}(function(_0x5bc12a,_0x501e97){const _0x3f5730=a50_0x4e62,_0x559108=_0x5bc12a();while(!![]){try{const _0x2480b3=parseInt(_0x3f5730(0xf8))/0x1*(-parseInt(_0x3f5730(0xeb))/0x2)+parseInt(_0x3f5730(0x125))/0x3+-parseInt(_0x3f5730(0x124))/0x4+-parseInt(_0x3f5730(0x106))/0x5+parseInt(_0x3f5730(0x10e))/0x6+-parseInt(_0x3f5730(0x141))/0x7+parseInt(_0x3f5730(0xec))/0x8;if(_0x2480b3===_0x501e97)break;else _0x559108['push'](_0x559108['shift']());}catch(_0x1e4ac4){_0x559108['push'](_0x559108['shift']());}}}(a50_0x5168,0xafbaa));function a50_0x5168(){const _0x47eb85=['===\x20PARSED\x20NODA\x20RESPONSE\x20===','defineProperty','/payment-links','2673276ANOOTd','30603968RxrSns','json','stack','https://tesoft.uk/gateway/pending.php?id=','Settled','expiryDate','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','pending','noda','Request\x20Body\x20(Direct\x20JSON):','Processing\x20Noda\x20webhook:','TesSoft\x20Payment\x20System/1.0','1yBFEcK','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','BankTransactionId','(8digits-8digits\x20format)','POST','created','message','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error',',\x20body:\x20','status','cancelled','Currency','completed','/payment-links/','5355185Gkaroh','loggerService','GET','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','processWebhook','createPaymentLink','Missing\x20id\x20or\x20shortLink\x20in\x20response','MerchantPaymentId','6076614VkSJEv','Short\x20Link:','logWhiteDomainRequest','currency','text','Status\x20Code:','log','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Unknown\x20error','Payment\x20Link\x20ID:','statusCode','PAID','toLowerCase','rejected','shortLink','logWhiteDomainResponse','__esModule','timeout','Response\x20Body:','Yes','stringify','Error\x20message:','5138732cWYBEE','363141jXskOF','Error\x20stack:','Status','error','active','success','HTTP\x20error!\x20status:\x20','fromEntries','application/json','JSON\x20Parse\x20Error:\x20','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainError','../loggerService','NodaService','failed','Remitter','apiUrl','EXPIRED','done','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','headers','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','===\x20NODA\x20SUCCESS\x20===','toUpperCase','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','in_progress','https://tesoft.uk/gateway/noda/webhook/','Unknown\x20error\x20from\x20Noda\x20API','3830176BWaPbQ','isActive','expired','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','BankId','Noda\x20payment\x20verification\x20error:','qrCodeLink','===\x20NODA\x20SERVICE\x20ERROR\x20===','now','Iban','Status\x20Text:','SettlementDate','canceled','Headers:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','statusText','(8digits-8digits\x20format\x20for\x20Noda)','successful','FAILED','PENDING','Noda\x20API\x20error:\x20','Order\x20ID\x20Format:','shortLinkUrls','Not\x20provided','HTTP\x20','Status:','Error\x20details:','Business\x20Error:\x20','Parsed\x20Result:','Raw\x20Response\x20Body:','verifyPayment'];a50_0x5168=function(){return _0x47eb85;};return a50_0x5168();}Object[a50_0x4442e5(0xe9)](exports,a50_0x4442e5(0x11e),{'value':!![]}),exports[a50_0x4442e5(0x132)]=void 0x0;const loggerService_1=require(a50_0x4442e5(0x131));class NodaService{constructor(){const _0x2e5da9=a50_0x4442e5;this[_0x2e5da9(0x135)]='https://tesoft.uk/gateway/noda/',console['log'](_0x2e5da9(0x144));}async[a50_0x4442e5(0x10b)](_0x17ac35){const _0x3dea45=a50_0x4442e5,{orderId:_0x4032d0,name:_0xdb06b9,paymentDescription:_0x392558,amount:_0x117e20,currency:_0x3e8daa,webhookUrl:_0x4fc4d7,returnUrl:_0x4430af,expiryDate:_0x59121f}=_0x17ac35,_0x119fbd=_0x3e8daa[_0x3dea45(0x13c)](),_0x343cfa=_0x3dea45(0x13f),_0x2cbf3a=_0x3dea45(0xef)+_0x4032d0,_0x475fa7={'name':_0xdb06b9,'paymentDescription':_0x392558,'amount':_0x117e20,'currency':_0x119fbd,'paymentId':_0x4032d0,'webhookUrl':_0x343cfa,'returnUrl':_0x2cbf3a};_0x59121f&&(_0x475fa7[_0x3dea45(0xf1)]=_0x59121f);const _0x50b597=Date[_0x3dea45(0x149)]();try{console[_0x3dea45(0x114)](_0x3dea45(0x13a)),console[_0x3dea45(0x114)]('URL:',this['apiUrl']),console[_0x3dea45(0x114)](_0x3dea45(0xf5),JSON[_0x3dea45(0x122)](_0x475fa7,null,0x2)),console[_0x3dea45(0x114)](_0x3dea45(0x156),_0x4032d0,_0x3dea45(0x151)),console[_0x3dea45(0x114)](_0x3dea45(0xf2),_0x2cbf3a),loggerService_1['loggerService'][_0x3dea45(0x110)]('noda',_0x3dea45(0xea),_0x3dea45(0xfc),_0x475fa7);const _0x4e30da=await fetch(this[_0x3dea45(0x135)],{'method':_0x3dea45(0xfc),'headers':{'Content-Type':_0x3dea45(0x12d),'Accept':_0x3dea45(0x12d),'User-Agent':_0x3dea45(0xf7)},'body':JSON[_0x3dea45(0x122)](_0x475fa7)}),_0x338e6a=Date[_0x3dea45(0x149)]()-_0x50b597;console[_0x3dea45(0x114)](_0x3dea45(0x115)),console[_0x3dea45(0x114)](_0x3dea45(0xe2),_0x4e30da[_0x3dea45(0x101)]),console[_0x3dea45(0x114)](_0x3dea45(0x14b),_0x4e30da[_0x3dea45(0x150)]),console[_0x3dea45(0x114)](_0x3dea45(0x14e),Object[_0x3dea45(0x12c)](_0x4e30da[_0x3dea45(0x139)]['entries']())),console['log']('Response\x20Time:',_0x338e6a+'ms');const _0x4c7cfb=await _0x4e30da['text']();console[_0x3dea45(0x114)](_0x3dea45(0xe6),_0x4c7cfb);if(!_0x4e30da['ok']){console[_0x3dea45(0x128)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x3dea45(0x128)]('HTTP\x20Status:',_0x4e30da['status']),console[_0x3dea45(0x128)](_0x3dea45(0x120),_0x4c7cfb),loggerService_1[_0x3dea45(0x107)][_0x3dea45(0x11d)](_0x3dea45(0xf4),_0x3dea45(0xea),_0x4e30da['status'],_0x4c7cfb,_0x338e6a),loggerService_1[_0x3dea45(0x107)][_0x3dea45(0x130)](_0x3dea45(0xf4),_0x3dea45(0xea),_0x3dea45(0x159)+_0x4e30da['status']+':\x20'+_0x4c7cfb);if(_0x4e30da[_0x3dea45(0x101)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x4e30da[_0x3dea45(0x101)]===0x1f4)throw new Error('All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid');}throw new Error(_0x3dea45(0x12b)+_0x4e30da['status']+_0x3dea45(0x100)+_0x4c7cfb);}let _0x4a306f;try{_0x4a306f=JSON['parse'](_0x4c7cfb);}catch(_0x22d42d){console[_0x3dea45(0x128)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x22d42d),loggerService_1['loggerService'][_0x3dea45(0x130)](_0x3dea45(0xf4),_0x3dea45(0xea),_0x3dea45(0x12e)+_0x22d42d);throw new Error(_0x3dea45(0x13d)+_0x4c7cfb);}console[_0x3dea45(0x114)](_0x3dea45(0xe8)),console[_0x3dea45(0x114)](_0x3dea45(0xe5),JSON['stringify'](_0x4a306f,null,0x2)),loggerService_1[_0x3dea45(0x107)][_0x3dea45(0x11d)]('noda',_0x3dea45(0xea),_0x4e30da[_0x3dea45(0x101)],_0x4a306f,_0x338e6a);if(_0x4a306f['error']||_0x4a306f[_0x3dea45(0x118)]){const _0x23f161=_0x4a306f[_0x3dea45(0xfe)]||_0x4a306f[_0x3dea45(0x128)]||_0x3dea45(0x140);console[_0x3dea45(0x128)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x3dea45(0x128)]('Error\x20Message:',_0x23f161),console[_0x3dea45(0x128)](_0x3dea45(0x113),_0x4a306f[_0x3dea45(0x118)]),loggerService_1['loggerService'][_0x3dea45(0x130)](_0x3dea45(0xf4),_0x3dea45(0xea),_0x3dea45(0xe4)+_0x23f161);throw new Error(_0x3dea45(0x155)+_0x23f161);}if(!_0x4a306f['id']||!_0x4a306f[_0x3dea45(0x157)]?.[_0x3dea45(0x11c)]){console['error'](_0x3dea45(0x12f)),console[_0x3dea45(0x128)](_0x3dea45(0x10c)),console[_0x3dea45(0x128)]('Response\x20data:',_0x4a306f),loggerService_1[_0x3dea45(0x107)]['logWhiteDomainError'](_0x3dea45(0xf4),_0x3dea45(0xea),_0x3dea45(0xf9));throw new Error(_0x3dea45(0x14f));}return console[_0x3dea45(0x114)](_0x3dea45(0x13b)),console[_0x3dea45(0x114)](_0x3dea45(0x117),_0x4a306f['id']),console[_0x3dea45(0x114)](_0x3dea45(0x10f),_0x4a306f[_0x3dea45(0x157)]['shortLink']),console[_0x3dea45(0x114)]('QR\x20Code\x20Link:',_0x4a306f[_0x3dea45(0x157)][_0x3dea45(0x147)]||_0x3dea45(0x158)),console[_0x3dea45(0x114)]('Order\x20ID\x20Used:',_0x4032d0,_0x3dea45(0xfb)),console[_0x3dea45(0x114)](_0x3dea45(0x109),_0x2cbf3a),{'gateway_payment_id':_0x4a306f['id'],'payment_url':_0x4a306f[_0x3dea45(0x157)][_0x3dea45(0x11c)],'qr_code_url':_0x4a306f[_0x3dea45(0x157)][_0x3dea45(0x147)],'expiry_date':_0x4a306f['expiryDate']};}catch(_0x444f67){console[_0x3dea45(0x128)](_0x3dea45(0x148)),console[_0x3dea45(0x128)](_0x3dea45(0xe3),_0x444f67),loggerService_1['loggerService'][_0x3dea45(0x130)](_0x3dea45(0xf4),'/payment-links',_0x444f67);if(_0x444f67 instanceof Error){console[_0x3dea45(0x128)](_0x3dea45(0x123),_0x444f67[_0x3dea45(0xfe)]),console[_0x3dea45(0x128)](_0x3dea45(0x126),_0x444f67[_0x3dea45(0xee)]);throw new Error(_0x3dea45(0x138)+_0x444f67[_0x3dea45(0xfe)]);}throw new Error(_0x3dea45(0xff));}}async[a50_0x4442e5(0xe7)](_0x52f8d0){const _0xd886b=a50_0x4442e5,_0x5add3d=Date[_0xd886b(0x149)]();try{loggerService_1[_0xd886b(0x107)][_0xd886b(0x110)](_0xd886b(0xf4),_0xd886b(0x105)+_0x52f8d0,_0xd886b(0x108),{});const _0x31822d=await fetch(this['apiUrl']+'/'+_0x52f8d0,{'method':'GET','headers':{'Content-Type':_0xd886b(0x12d),'User-Agent':_0xd886b(0xf7)}}),_0x378ed0=Date[_0xd886b(0x149)]()-_0x5add3d;if(!_0x31822d['ok']){const _0x4908e8=await _0x31822d[_0xd886b(0x112)]();loggerService_1['loggerService'][_0xd886b(0x11d)](_0xd886b(0xf4),_0xd886b(0x105)+_0x52f8d0,_0x31822d[_0xd886b(0x101)],_0x4908e8,_0x378ed0);throw new Error(_0xd886b(0x12b)+_0x31822d[_0xd886b(0x101)]);}const _0x5763cd=await _0x31822d[_0xd886b(0xed)]();loggerService_1[_0xd886b(0x107)][_0xd886b(0x11d)](_0xd886b(0xf4),'/payment-links/'+_0x52f8d0,_0x31822d[_0xd886b(0x101)],_0x5763cd,_0x378ed0);if(_0x5763cd[_0xd886b(0x128)]||_0x5763cd['statusCode']){loggerService_1['loggerService'][_0xd886b(0x130)](_0xd886b(0xf4),'/payment-links/'+_0x52f8d0,'Noda\x20API\x20error:\x20'+(_0x5763cd['message']||_0x5763cd[_0xd886b(0x128)]||_0xd886b(0x116)));throw new Error('Noda\x20API\x20error:\x20'+(_0x5763cd[_0xd886b(0xfe)]||_0x5763cd[_0xd886b(0x128)]||'Unknown\x20error'));}let _0x5d389c='PENDING';if(_0x5763cd['isActive']===![]){if(_0x5763cd[_0xd886b(0xf1)]){const _0xc52896=new Date(_0x5763cd[_0xd886b(0xf1)]),_0x356640=new Date();_0xc52896<_0x356640?_0x5d389c=_0xd886b(0x136):_0x5d389c=_0xd886b(0x153);}else _0x5d389c=_0xd886b(0x153);}else _0x5d389c='PENDING';return{'status':_0x5d389c,'amount':_0x5763cd['amount'],'currency':_0x5763cd[_0xd886b(0x111)],'isActive':_0x5763cd[_0xd886b(0x142)]};}catch(_0x2e1928){console['error'](_0xd886b(0x146),_0x2e1928),loggerService_1['loggerService'][_0xd886b(0x130)](_0xd886b(0xf4),_0xd886b(0x105)+_0x52f8d0,_0x2e1928);throw new Error('Failed\x20to\x20verify\x20Noda\x20payment:\x20'+(_0x2e1928 instanceof Error?_0x2e1928[_0xd886b(0xfe)]:'Unknown\x20error'));}}async[a50_0x4442e5(0x10a)](_0x130b5b){const _0x127254=a50_0x4442e5;console[_0x127254(0x114)](_0x127254(0xf6),_0x130b5b);let _0x4894d0='PENDING';switch(_0x130b5b[_0x127254(0x127)]?.[_0x127254(0x11a)]()){case _0x127254(0x137):case _0x127254(0x104):case'paid':case _0x127254(0x12a):case _0x127254(0x152):_0x130b5b[_0x127254(0xf0)]===_0x127254(0x121)?_0x4894d0=_0x127254(0x119):_0x4894d0=_0x127254(0x154);break;case _0x127254(0x102):case _0x127254(0x14d):case _0x127254(0x133):case _0x127254(0x128):case _0x127254(0x11b):_0x4894d0=_0x127254(0x153);break;case _0x127254(0x143):case _0x127254(0x11f):_0x4894d0=_0x127254(0x136);break;case _0x127254(0xf3):case _0x127254(0xfd):case _0x127254(0x129):case'processing':case _0x127254(0x13e):default:_0x4894d0='PENDING';break;}return{'paymentId':_0x130b5b[_0x127254(0x10d)]||_0x130b5b['PaymentId'],'status':_0x4894d0,'amount':_0x130b5b['Amount'],'currency':_0x130b5b[_0x127254(0x103)],'additionalInfo':{'method':_0x130b5b['Method'],'bankId':_0x130b5b[_0x127254(0x145)],'settled':_0x130b5b['Settled'],'settlementDate':_0x130b5b[_0x127254(0x14c)],'remitterName':_0x130b5b[_0x127254(0x134)]?.['Name'],'remitterIban':_0x130b5b[_0x127254(0x134)]?.[_0x127254(0x14a)],'bankTransactionId':_0x130b5b[_0x127254(0xfa)]}};}['verifyWebhookSignature'](_0x1f80a5,_0x4c34aa){const _0x498dbb=a50_0x4442e5;return console[_0x498dbb(0x114)]('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x4c34aa,'paymentId':_0x1f80a5['PaymentId'],'merchantPaymentId':_0x1f80a5[_0x498dbb(0x10d)]}),!![];}}exports[a50_0x4442e5(0x132)]=NodaService;