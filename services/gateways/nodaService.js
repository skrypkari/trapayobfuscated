'use strict';const a43_0xcd8c05=a43_0x2ad7;function a43_0x2ad7(_0x1485ba,_0x136f75){const _0x562a26=a43_0x562a();return a43_0x2ad7=function(_0x2ad774,_0x391cbe){_0x2ad774=_0x2ad774-0xfc;let _0x574c20=_0x562a26[_0x2ad774];return _0x574c20;},a43_0x2ad7(_0x1485ba,_0x136f75);}(function(_0x463c4f,_0x564122){const _0x4c827c=a43_0x2ad7,_0x52448b=_0x463c4f();while(!![]){try{const _0x3e2aed=-parseInt(_0x4c827c(0x131))/0x1+parseInt(_0x4c827c(0x15b))/0x2+-parseInt(_0x4c827c(0x12b))/0x3+parseInt(_0x4c827c(0x113))/0x4+-parseInt(_0x4c827c(0x159))/0x5+parseInt(_0x4c827c(0x11a))/0x6*(parseInt(_0x4c827c(0x149))/0x7)+parseInt(_0x4c827c(0x158))/0x8*(parseInt(_0x4c827c(0x14b))/0x9);if(_0x3e2aed===_0x564122)break;else _0x52448b['push'](_0x52448b['shift']());}catch(_0xc16b77){_0x52448b['push'](_0x52448b['shift']());}}}(a43_0x562a,0x7c426));function a43_0x562a(){const _0x32e558=['amount','shortLinkUrls','===\x20NODA\x20SERVICE\x20ERROR\x20===','qrCodeLink','verifyPayment','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','POST','Business\x20Error:\x20','fromEntries','loggerService','in_progress','created','logWhiteDomainResponse','Status\x20Text:','text','GET','2563256xJwvjM','MerchantPaymentId','stringify','entries','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:','(8digits-8digits\x20format\x20for\x20Noda)','https://tesoft.uk/gateway/noda/webhook/','25938zxYmcK','TesSoft\x20Payment\x20System/1.0','Error\x20details:','shortLink','noda','HTTP\x20Status:','__esModule','PENDING','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','paid','Yes','pending','Unknown\x20error','BankId','status','===\x20PARSED\x20NODA\x20RESPONSE\x20===','Error\x20stack:','2603115NpYCdz','(8digits-8digits\x20format)','cancelled','message','Error\x20message:','Failed\x20to\x20verify\x20Noda\x20payment:\x20','687235JEutfH','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','Response\x20data:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','expired','rejected','Short\x20Link:','statusText','Response\x20Body:','Request\x20Body\x20(Direct\x20JSON):','failed','FAILED','Currency','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','successful','apiUrl','processWebhook','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Noda\x20API\x20error:\x20','Response\x20Time:','verifyWebhookSignature','/payment-links/','798yDevwq','createPaymentLink','9aUQGHr','now','BankTransactionId','https://tesoft.uk/gateway/noda/','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','Headers:','JSON\x20Parse\x20Error:\x20','Noda\x20payment\x20verification\x20error:','logWhiteDomainRequest','Missing\x20id\x20or\x20shortLink\x20in\x20response','https://tesoft.uk/gateway/pending.php?id=','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','NodaService','5142344OyNMHj','3235480niAZMX','toUpperCase','1869146MiYKRF','statusCode','Remitter','PaymentId','log','Raw\x20Response\x20Body:','Settled','Processing\x20Noda\x20webhook:','isActive','Iban','Order\x20ID\x20Format:','application/json','logWhiteDomainError','timeout','EXPIRED','error','../loggerService','completed','expiryDate','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','/payment-links','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','===\x20NODA\x20API\x20ERROR\x20===','Status\x20Code:','Error\x20Message:','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='];a43_0x562a=function(){return _0x32e558;};return a43_0x562a();}Object['defineProperty'](exports,a43_0xcd8c05(0x120),{'value':!![]}),exports[a43_0xcd8c05(0x157)]=void 0x0;const loggerService_1=require(a43_0xcd8c05(0x16b));class NodaService{constructor(){const _0x477219=a43_0xcd8c05;this[_0x477219(0x142)]=_0x477219(0x14e),console[_0x477219(0x15f)](_0x477219(0x135));}async[a43_0xcd8c05(0x14a)](_0x361866){const _0x337220=a43_0xcd8c05,{orderId:_0x379eaf,name:_0x308ce5,paymentDescription:_0x2d142c,amount:_0x4a87aa,currency:_0x521d58,webhookUrl:_0x51246a,returnUrl:_0x428112,expiryDate:_0x5c0a90}=_0x361866,_0x1b9a35=_0x521d58[_0x337220(0x15a)](),_0x573a1c=_0x337220(0x119),_0x248a54=_0x337220(0x155)+_0x379eaf,_0x19c402={'name':_0x308ce5,'paymentDescription':_0x2d142c,'amount':_0x4a87aa,'currency':_0x1b9a35,'paymentId':_0x379eaf,'webhookUrl':_0x573a1c,'returnUrl':_0x248a54};_0x5c0a90&&(_0x19c402[_0x337220(0x16d)]=_0x5c0a90);const _0x4fcf3b=Date[_0x337220(0x14c)]();try{console[_0x337220(0x15f)](_0x337220(0xfe)),console[_0x337220(0x15f)]('URL:',this[_0x337220(0x142)]),console[_0x337220(0x15f)](_0x337220(0x13b),JSON[_0x337220(0x115)](_0x19c402,null,0x2)),console[_0x337220(0x15f)](_0x337220(0x165),_0x379eaf,_0x337220(0x118)),console[_0x337220(0x15f)](_0x337220(0x117),_0x248a54),loggerService_1[_0x337220(0x10c)][_0x337220(0x153)]('noda','/payment-links','POST',_0x19c402);const _0x692e2=await fetch(this[_0x337220(0x142)],{'method':_0x337220(0x109),'headers':{'Content-Type':_0x337220(0x166),'Accept':_0x337220(0x166),'User-Agent':_0x337220(0x11b)},'body':JSON['stringify'](_0x19c402)}),_0x30e332=Date['now']()-_0x4fcf3b;console[_0x337220(0x15f)](_0x337220(0x102)),console[_0x337220(0x15f)]('Status:',_0x692e2['status']),console[_0x337220(0x15f)](_0x337220(0x110),_0x692e2[_0x337220(0x139)]),console['log'](_0x337220(0x150),Object[_0x337220(0x10b)](_0x692e2['headers'][_0x337220(0x116)]())),console[_0x337220(0x15f)](_0x337220(0x146),_0x30e332+'ms');const _0x4f9af0=await _0x692e2[_0x337220(0x111)]();console[_0x337220(0x15f)](_0x337220(0x160),_0x4f9af0);if(!_0x692e2['ok']){console[_0x337220(0x16a)](_0x337220(0xff)),console['error'](_0x337220(0x11f),_0x692e2[_0x337220(0x128)]),console[_0x337220(0x16a)](_0x337220(0x13a),_0x4f9af0),loggerService_1['loggerService'][_0x337220(0x10f)]('noda',_0x337220(0xfd),_0x692e2[_0x337220(0x128)],_0x4f9af0,_0x30e332),loggerService_1[_0x337220(0x10c)]['logWhiteDomainError'](_0x337220(0x11e),_0x337220(0xfd),'HTTP\x20'+_0x692e2['status']+':\x20'+_0x4f9af0);if(_0x692e2['status']===0x190)throw new Error(_0x337220(0x122));else{if(_0x692e2[_0x337220(0x128)]===0x1f4)throw new Error(_0x337220(0x134));}throw new Error(_0x337220(0x140)+_0x692e2[_0x337220(0x128)]+',\x20body:\x20'+_0x4f9af0);}let _0x36bac6;try{_0x36bac6=JSON['parse'](_0x4f9af0);}catch(_0x26be63){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x26be63),loggerService_1[_0x337220(0x10c)][_0x337220(0x167)]('noda','/payment-links',_0x337220(0x151)+_0x26be63);throw new Error('Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20'+_0x4f9af0);}console[_0x337220(0x15f)](_0x337220(0x129)),console[_0x337220(0x15f)]('Parsed\x20Result:',JSON[_0x337220(0x115)](_0x36bac6,null,0x2)),loggerService_1[_0x337220(0x10c)][_0x337220(0x10f)]('noda',_0x337220(0xfd),_0x692e2[_0x337220(0x128)],_0x36bac6,_0x30e332);if(_0x36bac6[_0x337220(0x16a)]||_0x36bac6[_0x337220(0x15c)]){const _0x38f726=_0x36bac6[_0x337220(0x12e)]||_0x36bac6[_0x337220(0x16a)]||'Unknown\x20error\x20from\x20Noda\x20API';console['error'](_0x337220(0x13f)),console[_0x337220(0x16a)](_0x337220(0x101),_0x38f726),console[_0x337220(0x16a)](_0x337220(0x100),_0x36bac6[_0x337220(0x15c)]),loggerService_1[_0x337220(0x10c)][_0x337220(0x167)](_0x337220(0x11e),_0x337220(0xfd),_0x337220(0x10a)+_0x38f726);throw new Error('Noda\x20API\x20error:\x20'+_0x38f726);}if(!_0x36bac6['id']||!_0x36bac6[_0x337220(0x104)]?.[_0x337220(0x11d)]){console[_0x337220(0x16a)](_0x337220(0xfc)),console['error'](_0x337220(0x154)),console[_0x337220(0x16a)](_0x337220(0x133),_0x36bac6),loggerService_1[_0x337220(0x10c)]['logWhiteDomainError'](_0x337220(0x11e),_0x337220(0xfd),_0x337220(0x132));throw new Error(_0x337220(0x156));}return console[_0x337220(0x15f)]('===\x20NODA\x20SUCCESS\x20==='),console[_0x337220(0x15f)]('Payment\x20Link\x20ID:',_0x36bac6['id']),console[_0x337220(0x15f)](_0x337220(0x138),_0x36bac6['shortLinkUrls']['shortLink']),console[_0x337220(0x15f)]('QR\x20Code\x20Link:',_0x36bac6[_0x337220(0x104)]['qrCodeLink']||'Not\x20provided'),console[_0x337220(0x15f)]('Order\x20ID\x20Used:',_0x379eaf,_0x337220(0x12c)),console[_0x337220(0x15f)](_0x337220(0x14f),_0x248a54),{'gateway_payment_id':_0x36bac6['id'],'payment_url':_0x36bac6[_0x337220(0x104)][_0x337220(0x11d)],'qr_code_url':_0x36bac6[_0x337220(0x104)][_0x337220(0x106)],'expiry_date':_0x36bac6[_0x337220(0x16d)]};}catch(_0x557843){console['error'](_0x337220(0x105)),console['error'](_0x337220(0x11c),_0x557843),loggerService_1[_0x337220(0x10c)]['logWhiteDomainError'](_0x337220(0x11e),_0x337220(0xfd),_0x557843);if(_0x557843 instanceof Error){console[_0x337220(0x16a)](_0x337220(0x12f),_0x557843[_0x337220(0x12e)]),console[_0x337220(0x16a)](_0x337220(0x12a),_0x557843['stack']);throw new Error(_0x337220(0x144)+_0x557843['message']);}throw new Error(_0x337220(0x108));}}async[a43_0xcd8c05(0x107)](_0x3b56bf){const _0x3752b2=a43_0xcd8c05,_0x2a3dcd=Date['now']();try{loggerService_1[_0x3752b2(0x10c)][_0x3752b2(0x153)](_0x3752b2(0x11e),_0x3752b2(0x148)+_0x3b56bf,_0x3752b2(0x112),{});const _0x5ab167=await fetch(this['apiUrl']+'/'+_0x3b56bf,{'method':_0x3752b2(0x112),'headers':{'Content-Type':_0x3752b2(0x166),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x2609a4=Date[_0x3752b2(0x14c)]()-_0x2a3dcd;if(!_0x5ab167['ok']){const _0x13c872=await _0x5ab167[_0x3752b2(0x111)]();loggerService_1[_0x3752b2(0x10c)][_0x3752b2(0x10f)](_0x3752b2(0x11e),'/payment-links/'+_0x3b56bf,_0x5ab167[_0x3752b2(0x128)],_0x13c872,_0x2609a4);throw new Error(_0x3752b2(0x140)+_0x5ab167['status']);}const _0x48a6aa=await _0x5ab167['json']();loggerService_1[_0x3752b2(0x10c)][_0x3752b2(0x10f)](_0x3752b2(0x11e),'/payment-links/'+_0x3b56bf,_0x5ab167[_0x3752b2(0x128)],_0x48a6aa,_0x2609a4);if(_0x48a6aa[_0x3752b2(0x16a)]||_0x48a6aa['statusCode']){loggerService_1['loggerService'][_0x3752b2(0x167)]('noda',_0x3752b2(0x148)+_0x3b56bf,_0x3752b2(0x145)+(_0x48a6aa[_0x3752b2(0x12e)]||_0x48a6aa['error']||_0x3752b2(0x126)));throw new Error(_0x3752b2(0x145)+(_0x48a6aa['message']||_0x48a6aa[_0x3752b2(0x16a)]||_0x3752b2(0x126)));}let _0x58e861=_0x3752b2(0x121);if(_0x48a6aa[_0x3752b2(0x163)]===![]){if(_0x48a6aa[_0x3752b2(0x16d)]){const _0x54593a=new Date(_0x48a6aa[_0x3752b2(0x16d)]),_0x498c76=new Date();_0x54593a<_0x498c76?_0x58e861='EXPIRED':_0x58e861=_0x3752b2(0x13d);}else _0x58e861=_0x3752b2(0x13d);}else _0x58e861='PENDING';return{'status':_0x58e861,'amount':_0x48a6aa[_0x3752b2(0x103)],'currency':_0x48a6aa['currency'],'isActive':_0x48a6aa['isActive']};}catch(_0xd1f95){console['error'](_0x3752b2(0x152),_0xd1f95),loggerService_1[_0x3752b2(0x10c)][_0x3752b2(0x167)](_0x3752b2(0x11e),_0x3752b2(0x148)+_0x3b56bf,_0xd1f95);throw new Error(_0x3752b2(0x130)+(_0xd1f95 instanceof Error?_0xd1f95[_0x3752b2(0x12e)]:_0x3752b2(0x126)));}}async[a43_0xcd8c05(0x143)](_0x118ecc){const _0xbb9664=a43_0xcd8c05;console[_0xbb9664(0x15f)](_0xbb9664(0x162),_0x118ecc);let _0x2212d0=_0xbb9664(0x121);switch(_0x118ecc['Status']?.['toLowerCase']()){case'done':case _0xbb9664(0x16c):case _0xbb9664(0x123):case'success':case _0xbb9664(0x141):_0x118ecc[_0xbb9664(0x161)]===_0xbb9664(0x124)?_0x2212d0='PAID':_0x2212d0='PENDING';break;case _0xbb9664(0x12d):case'canceled':case _0xbb9664(0x13c):case'error':case _0xbb9664(0x137):_0x2212d0=_0xbb9664(0x13d);break;case _0xbb9664(0x136):case _0xbb9664(0x168):_0x2212d0=_0xbb9664(0x169);break;case _0xbb9664(0x125):case _0xbb9664(0x10e):case'active':case'processing':case _0xbb9664(0x10d):default:_0x2212d0='PENDING';break;}return{'paymentId':_0x118ecc[_0xbb9664(0x114)]||_0x118ecc['PaymentId'],'status':_0x2212d0,'amount':_0x118ecc['Amount'],'currency':_0x118ecc[_0xbb9664(0x13e)],'additionalInfo':{'method':_0x118ecc['Method'],'bankId':_0x118ecc[_0xbb9664(0x127)],'settled':_0x118ecc[_0xbb9664(0x161)],'settlementDate':_0x118ecc['SettlementDate'],'remitterName':_0x118ecc[_0xbb9664(0x15d)]?.['Name'],'remitterIban':_0x118ecc[_0xbb9664(0x15d)]?.[_0xbb9664(0x164)],'bankTransactionId':_0x118ecc[_0xbb9664(0x14d)]}};}[a43_0xcd8c05(0x147)](_0x2a8739,_0x1e7680){const _0x4523ab=a43_0xcd8c05;return console['log']('Noda\x20webhook\x20signature\x20verification:',{'receivedSignature':_0x1e7680,'paymentId':_0x2a8739[_0x4523ab(0x15e)],'merchantPaymentId':_0x2a8739[_0x4523ab(0x114)]}),!![];}}exports[a43_0xcd8c05(0x157)]=NodaService;