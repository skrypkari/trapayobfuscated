'use strict';const a48_0x188a26=a48_0x5086;function a48_0x5086(_0x50b5df,_0xb5f4c6){const _0x4871b5=a48_0x4871();return a48_0x5086=function(_0x5086aa,_0x454181){_0x5086aa=_0x5086aa-0x116;let _0x583674=_0x4871b5[_0x5086aa];return _0x583674;},a48_0x5086(_0x50b5df,_0xb5f4c6);}(function(_0x580924,_0x2e25f4){const _0x2e16fc=a48_0x5086,_0x2b23b0=_0x580924();while(!![]){try{const _0x2d4004=-parseInt(_0x2e16fc(0x13e))/0x1*(-parseInt(_0x2e16fc(0x141))/0x2)+parseInt(_0x2e16fc(0x17d))/0x3*(parseInt(_0x2e16fc(0x139))/0x4)+-parseInt(_0x2e16fc(0x121))/0x5*(-parseInt(_0x2e16fc(0x16a))/0x6)+-parseInt(_0x2e16fc(0x124))/0x7+-parseInt(_0x2e16fc(0x133))/0x8+-parseInt(_0x2e16fc(0x18b))/0x9+parseInt(_0x2e16fc(0x183))/0xa;if(_0x2d4004===_0x2e25f4)break;else _0x2b23b0['push'](_0x2b23b0['shift']());}catch(_0x5a4533){_0x2b23b0['push'](_0x2b23b0['shift']());}}}(a48_0x4871,0x9082a));Object['defineProperty'](exports,a48_0x188a26(0x182),{'value':!![]}),exports['NodaService']=void 0x0;const loggerService_1=require(a48_0x188a26(0x12f));function a48_0x4871(){const _0x26e336=['processing','parse','9677871MSXOuY','FAILED','BankId','expired','Status\x20Code:','Parsed\x20Result:','loggerService','Error\x20details:','success','shortLinkUrls','isActive','/payment-links','text','Status','14055PaJAfq','done','entries','937601HLOgiq','application/json','Status:','logWhiteDomainRequest','Noda\x20webhook\x20signature\x20verification:','Response\x20data:','Error\x20message:','rejected','PENDING','Response\x20Body:','stringify','../loggerService','Yes','statusCode','status','9256536qNZGoO','Noda\x20payment\x20verification\x20error:','successful','URL:','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Short\x20Link:','48pRxEPw','Failed\x20to\x20parse\x20JSON\x20response:','timeout','HTTP\x20Status:','‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:','399362rOeEDH','MerchantPaymentId','===\x20NODA\x20SERVICE\x20ERROR\x20===','2gYjJxu','GET','processWebhook','shortLink','Noda\x20API\x20error:\x20','EXPIRED','toUpperCase','completed','qrCodeLink','SettlementDate','POST','logWhiteDomainResponse','stack','Unknown\x20error\x20from\x20Noda\x20API','Currency','Status\x20Text:','createPaymentLink','Settled','json','noda','Business\x20Error:\x20','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','failed','error','toLowerCase','Unknown\x20error','Order\x20ID\x20Used:','now','Missing\x20id\x20or\x20shortLink\x20in\x20response','currency','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','log','Error\x20Message:','logWhiteDomainError','HTTP\x20','headers','PaymentId','paid','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Failed\x20to\x20verify\x20Noda\x20payment:\x20','792tJXEVj','Iban','verifyPayment','===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20===','https://tesoft.uk/gateway/pending.php?id=','active','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','https://tesoft.uk/gateway/noda/','===\x20NODA\x20API\x20ERROR\x20===','expiryDate','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Not\x20provided','apiUrl','(8digits-8digits\x20format\x20for\x20Noda)','Payment\x20Link\x20ID:','üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','JSON\x20Parse\x20Error:\x20','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','281790PeFgBC','/payment-links/','===\x20PARSED\x20NODA\x20RESPONSE\x20===','QR\x20Code\x20Link:','===\x20NODA\x20SUCCESS\x20===','__esModule','10606690MxYDpx','Response\x20Time:','NodaService','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','message','(8digits-8digits\x20format)'];a48_0x4871=function(){return _0x26e336;};return a48_0x4871();}class NodaService{constructor(){const _0x5c79a8=a48_0x188a26;this[_0x5c79a8(0x177)]=_0x5c79a8(0x171),console[_0x5c79a8(0x160)](_0x5c79a8(0x17a));}async[a48_0x188a26(0x151)](_0x3332c6){const _0x1999f9=a48_0x188a26,{orderId:_0x10ba53,name:_0x378e21,paymentDescription:_0x161f6c,amount:_0x91a0f0,currency:_0x2958cb,webhookUrl:_0xffb365,returnUrl:_0x4ba39f,expiryDate:_0x5da6c1}=_0x3332c6,_0x3066c4=_0x2958cb[_0x1999f9(0x147)](),_0x4e793b='https://tesoft.uk/gateway/noda/webhook/',_0x338297=_0x1999f9(0x16e)+_0x10ba53,_0x38fae2={'name':_0x378e21,'paymentDescription':_0x161f6c,'amount':_0x91a0f0,'currency':_0x3066c4,'paymentId':_0x10ba53,'webhookUrl':_0x4e793b,'returnUrl':_0x338297};_0x5da6c1&&(_0x38fae2['expiryDate']=_0x5da6c1);const _0x3a7673=Date['now']();try{console[_0x1999f9(0x160)](_0x1999f9(0x186)),console['log'](_0x1999f9(0x136),this[_0x1999f9(0x177)]),console[_0x1999f9(0x160)]('Request\x20Body\x20(Direct\x20JSON):',JSON[_0x1999f9(0x12e)](_0x38fae2,null,0x2)),console[_0x1999f9(0x160)]('Order\x20ID\x20Format:',_0x10ba53,_0x1999f9(0x178)),console['log']('‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:',_0x338297),loggerService_1[_0x1999f9(0x119)]['logWhiteDomainRequest'](_0x1999f9(0x154),_0x1999f9(0x11e),_0x1999f9(0x14b),_0x38fae2);const _0x23dc09=await fetch(this[_0x1999f9(0x177)],{'method':_0x1999f9(0x14b),'headers':{'Content-Type':_0x1999f9(0x125),'Accept':_0x1999f9(0x125),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x38fae2)}),_0x1b95b8=Date['now']()-_0x3a7673;console['log'](_0x1999f9(0x15f)),console[_0x1999f9(0x160)](_0x1999f9(0x126),_0x23dc09[_0x1999f9(0x132)]),console[_0x1999f9(0x160)](_0x1999f9(0x150),_0x23dc09['statusText']),console[_0x1999f9(0x160)]('Headers:',Object['fromEntries'](_0x23dc09[_0x1999f9(0x164)][_0x1999f9(0x123)]())),console['log'](_0x1999f9(0x184),_0x1b95b8+'ms');const _0x37f704=await _0x23dc09[_0x1999f9(0x11f)]();console[_0x1999f9(0x160)]('Raw\x20Response\x20Body:',_0x37f704);if(!_0x23dc09['ok']){console[_0x1999f9(0x158)](_0x1999f9(0x172)),console[_0x1999f9(0x158)](_0x1999f9(0x13c),_0x23dc09[_0x1999f9(0x132)]),console[_0x1999f9(0x158)](_0x1999f9(0x12d),_0x37f704),loggerService_1[_0x1999f9(0x119)]['logWhiteDomainResponse']('noda',_0x1999f9(0x11e),_0x23dc09[_0x1999f9(0x132)],_0x37f704,_0x1b95b8),loggerService_1[_0x1999f9(0x119)]['logWhiteDomainError']('noda',_0x1999f9(0x11e),_0x1999f9(0x163)+_0x23dc09['status']+':\x20'+_0x37f704);if(_0x23dc09[_0x1999f9(0x132)]===0x190)throw new Error(_0x1999f9(0x174));else{if(_0x23dc09[_0x1999f9(0x132)]===0x1f4)throw new Error(_0x1999f9(0x175));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x23dc09[_0x1999f9(0x132)]+',\x20body:\x20'+_0x37f704);}let _0x223434;try{_0x223434=JSON[_0x1999f9(0x18a)](_0x37f704);}catch(_0x57c21f){console[_0x1999f9(0x158)](_0x1999f9(0x13a),_0x57c21f),loggerService_1[_0x1999f9(0x119)][_0x1999f9(0x162)](_0x1999f9(0x154),_0x1999f9(0x11e),_0x1999f9(0x17b)+_0x57c21f);throw new Error(_0x1999f9(0x137)+_0x37f704);}console[_0x1999f9(0x160)](_0x1999f9(0x17f)),console[_0x1999f9(0x160)](_0x1999f9(0x118),JSON[_0x1999f9(0x12e)](_0x223434,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse']('noda',_0x1999f9(0x11e),_0x23dc09[_0x1999f9(0x132)],_0x223434,_0x1b95b8);if(_0x223434[_0x1999f9(0x158)]||_0x223434[_0x1999f9(0x131)]){const _0x572655=_0x223434[_0x1999f9(0x187)]||_0x223434[_0x1999f9(0x158)]||_0x1999f9(0x14e);console[_0x1999f9(0x158)](_0x1999f9(0x16d)),console[_0x1999f9(0x158)](_0x1999f9(0x161),_0x572655),console[_0x1999f9(0x158)](_0x1999f9(0x117),_0x223434['statusCode']),loggerService_1['loggerService'][_0x1999f9(0x162)](_0x1999f9(0x154),_0x1999f9(0x11e),_0x1999f9(0x155)+_0x572655);throw new Error(_0x1999f9(0x145)+_0x572655);}if(!_0x223434['id']||!_0x223434[_0x1999f9(0x11c)]?.['shortLink']){console[_0x1999f9(0x158)](_0x1999f9(0x170)),console[_0x1999f9(0x158)](_0x1999f9(0x15d)),console['error'](_0x1999f9(0x129),_0x223434),loggerService_1[_0x1999f9(0x119)][_0x1999f9(0x162)](_0x1999f9(0x154),_0x1999f9(0x11e),_0x1999f9(0x156));throw new Error(_0x1999f9(0x167));}return console[_0x1999f9(0x160)](_0x1999f9(0x181)),console['log'](_0x1999f9(0x179),_0x223434['id']),console[_0x1999f9(0x160)](_0x1999f9(0x138),_0x223434['shortLinkUrls'][_0x1999f9(0x144)]),console[_0x1999f9(0x160)](_0x1999f9(0x180),_0x223434[_0x1999f9(0x11c)][_0x1999f9(0x149)]||_0x1999f9(0x176)),console[_0x1999f9(0x160)](_0x1999f9(0x15b),_0x10ba53,_0x1999f9(0x188)),console[_0x1999f9(0x160)](_0x1999f9(0x13d),_0x338297),{'gateway_payment_id':_0x223434['id'],'payment_url':_0x223434[_0x1999f9(0x11c)][_0x1999f9(0x144)],'qr_code_url':_0x223434[_0x1999f9(0x11c)][_0x1999f9(0x149)],'expiry_date':_0x223434[_0x1999f9(0x173)]};}catch(_0x41c3c3){console[_0x1999f9(0x158)](_0x1999f9(0x140)),console[_0x1999f9(0x158)](_0x1999f9(0x11a),_0x41c3c3),loggerService_1[_0x1999f9(0x119)][_0x1999f9(0x162)]('noda',_0x1999f9(0x11e),_0x41c3c3);if(_0x41c3c3 instanceof Error){console[_0x1999f9(0x158)](_0x1999f9(0x12a),_0x41c3c3[_0x1999f9(0x187)]),console[_0x1999f9(0x158)]('Error\x20stack:',_0x41c3c3[_0x1999f9(0x14d)]);throw new Error(_0x1999f9(0x168)+_0x41c3c3['message']);}throw new Error(_0x1999f9(0x17c));}}async[a48_0x188a26(0x16c)](_0x2937ba){const _0x567609=a48_0x188a26,_0x487af6=Date[_0x567609(0x15c)]();try{loggerService_1['loggerService'][_0x567609(0x127)]('noda',_0x567609(0x17e)+_0x2937ba,_0x567609(0x142),{});const _0x251255=await fetch(this[_0x567609(0x177)]+'/'+_0x2937ba,{'method':'GET','headers':{'Content-Type':_0x567609(0x125),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x4f4992=Date[_0x567609(0x15c)]()-_0x487af6;if(!_0x251255['ok']){const _0x2b57e3=await _0x251255[_0x567609(0x11f)]();loggerService_1['loggerService'][_0x567609(0x14c)](_0x567609(0x154),_0x567609(0x17e)+_0x2937ba,_0x251255['status'],_0x2b57e3,_0x4f4992);throw new Error('HTTP\x20error!\x20status:\x20'+_0x251255[_0x567609(0x132)]);}const _0x5e9dfb=await _0x251255[_0x567609(0x153)]();loggerService_1[_0x567609(0x119)][_0x567609(0x14c)]('noda',_0x567609(0x17e)+_0x2937ba,_0x251255[_0x567609(0x132)],_0x5e9dfb,_0x4f4992);if(_0x5e9dfb[_0x567609(0x158)]||_0x5e9dfb['statusCode']){loggerService_1[_0x567609(0x119)][_0x567609(0x162)](_0x567609(0x154),_0x567609(0x17e)+_0x2937ba,'Noda\x20API\x20error:\x20'+(_0x5e9dfb[_0x567609(0x187)]||_0x5e9dfb[_0x567609(0x158)]||_0x567609(0x15a)));throw new Error(_0x567609(0x145)+(_0x5e9dfb[_0x567609(0x187)]||_0x5e9dfb[_0x567609(0x158)]||_0x567609(0x15a)));}let _0x4d5f9e=_0x567609(0x12c);if(_0x5e9dfb['isActive']===![]){if(_0x5e9dfb[_0x567609(0x173)]){const _0x46c4f0=new Date(_0x5e9dfb[_0x567609(0x173)]),_0x473caa=new Date();_0x46c4f0<_0x473caa?_0x4d5f9e=_0x567609(0x146):_0x4d5f9e=_0x567609(0x18c);}else _0x4d5f9e=_0x567609(0x18c);}else _0x4d5f9e='PENDING';return{'status':_0x4d5f9e,'amount':_0x5e9dfb['amount'],'currency':_0x5e9dfb[_0x567609(0x15e)],'isActive':_0x5e9dfb[_0x567609(0x11d)]};}catch(_0x9e261b){console[_0x567609(0x158)](_0x567609(0x134),_0x9e261b),loggerService_1[_0x567609(0x119)]['logWhiteDomainError']('noda',_0x567609(0x17e)+_0x2937ba,_0x9e261b);throw new Error(_0x567609(0x169)+(_0x9e261b instanceof Error?_0x9e261b[_0x567609(0x187)]:_0x567609(0x15a)));}}async[a48_0x188a26(0x143)](_0x471d10){const _0x484c08=a48_0x188a26;console[_0x484c08(0x160)]('Processing\x20Noda\x20webhook:',_0x471d10);let _0x18de02='PENDING';switch(_0x471d10[_0x484c08(0x120)]?.[_0x484c08(0x159)]()){case _0x484c08(0x122):case _0x484c08(0x148):case _0x484c08(0x166):case _0x484c08(0x11b):case _0x484c08(0x135):_0x471d10[_0x484c08(0x152)]===_0x484c08(0x130)?_0x18de02='PAID':_0x18de02='PENDING';break;case'cancelled':case'canceled':case _0x484c08(0x157):case _0x484c08(0x158):case _0x484c08(0x12b):_0x18de02=_0x484c08(0x18c);break;case _0x484c08(0x116):case _0x484c08(0x13b):_0x18de02='EXPIRED';break;case'pending':case'created':case _0x484c08(0x16f):case _0x484c08(0x189):case'in_progress':default:_0x18de02='PENDING';break;}return{'paymentId':_0x471d10['MerchantPaymentId']||_0x471d10[_0x484c08(0x165)],'status':_0x18de02,'amount':_0x471d10['Amount'],'currency':_0x471d10[_0x484c08(0x14f)],'additionalInfo':{'method':_0x471d10['Method'],'bankId':_0x471d10[_0x484c08(0x18d)],'settled':_0x471d10[_0x484c08(0x152)],'settlementDate':_0x471d10[_0x484c08(0x14a)],'remitterName':_0x471d10['Remitter']?.['Name'],'remitterIban':_0x471d10['Remitter']?.[_0x484c08(0x16b)],'bankTransactionId':_0x471d10['BankTransactionId']}};}['verifyWebhookSignature'](_0x5f18a7,_0x10e148){const _0x456450=a48_0x188a26;return console[_0x456450(0x160)](_0x456450(0x128),{'receivedSignature':_0x10e148,'paymentId':_0x5f18a7['PaymentId'],'merchantPaymentId':_0x5f18a7[_0x456450(0x13f)]}),!![];}}exports[a48_0x188a26(0x185)]=NodaService;