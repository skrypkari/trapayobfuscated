'use strict';const a44_0x266677=a44_0x2c56;function a44_0x2c56(_0x44ac41,_0x666941){const _0x5653ff=a44_0x5653();return a44_0x2c56=function(_0x2c56a8,_0x1d235e){_0x2c56a8=_0x2c56a8-0xc0;let _0x324d08=_0x5653ff[_0x2c56a8];return _0x324d08;},a44_0x2c56(_0x44ac41,_0x666941);}(function(_0x4622c5,_0x431371){const _0x10e161=a44_0x2c56,_0x3bc417=_0x4622c5();while(!![]){try{const _0x53d8fe=parseInt(_0x10e161(0x11a))/0x1+-parseInt(_0x10e161(0x116))/0x2+-parseInt(_0x10e161(0xfe))/0x3*(parseInt(_0x10e161(0x11c))/0x4)+parseInt(_0x10e161(0x123))/0x5*(parseInt(_0x10e161(0x10f))/0x6)+-parseInt(_0x10e161(0x101))/0x7*(parseInt(_0x10e161(0xf6))/0x8)+-parseInt(_0x10e161(0xf7))/0x9+parseInt(_0x10e161(0x125))/0xa*(parseInt(_0x10e161(0x103))/0xb);if(_0x53d8fe===_0x431371)break;else _0x3bc417['push'](_0x3bc417['shift']());}catch(_0x470d3d){_0x3bc417['push'](_0x3bc417['shift']());}}}(a44_0x5653,0xd17be));function a44_0x5653(){const _0x29bdf5=['/payment-links/','Order\x20ID\x20Format:','expired','Business\x20Error:\x20','One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value','Raw\x20Response\x20Body:','Processing\x20Noda\x20webhook:','HTTP\x20error!\x20status:\x20','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','qrCodeLink','log','Amount','toUpperCase','EXPIRED','Status','stringify','/payment-links','HTTP\x20Status:','PENDING','10200UxuKFw','9999450mumjaF','headers','https://tesoft.uk/gateway/pending.php?id=','Settled','Unknown\x20error','done','BankId','7527ihgIes','text','https://tesoft.uk/gateway/noda/','217RSHJpE','QR\x20Code\x20Link:','2782406LjejWO','===\x20PARSED\x20NODA\x20RESPONSE\x20===','loggerService','PAID','apiUrl','error','cancelled','Noda\x20webhook\x20signature\x20verification:','logWhiteDomainResponse','Yes','failed','Status\x20Text:','66furEhx','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error','__esModule','Unknown\x20error\x20from\x20Noda\x20API','logWhiteDomainRequest','FAILED','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','968640UUhbwM','active','Payment\x20Link\x20ID:','statusText','507989tBbRSN','JSON\x20Parse\x20Error:\x20','1524hKwhzd','pending','Response\x20data:','BankTransactionId','statusCode','application/json','Noda\x20API\x20error:\x20','301985RfOzxr','isActive','90pwKDHM','Not\x20provided','amount','Failed\x20to\x20verify\x20Noda\x20payment:\x20','rejected','verifyPayment','Status:','createPaymentLink','now','status','POST','entries','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','Request\x20Body\x20(Direct\x20JSON):','shortLink','Response\x20Time:','message','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','MerchantPaymentId','Remitter','Error\x20stack:','stack','===\x20NODA\x20SUCCESS\x20===','NodaService','Iban','Currency','expiryDate','Parsed\x20Result:','===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20===','shortLinkUrls','noda','GET','URL:',',\x20body:\x20','created','Headers:','Response\x20Body:','processing','logWhiteDomainError','(8digits-8digits\x20format)','===\x20NODA\x20SERVICE\x20ERROR\x20===','success','TesSoft\x20Payment\x20System/1.0','json','PaymentId','‚úÖ\x20–û–ë–ù–û–í–õ–ï–ù–û:\x20Return\x20URL\x20uses\x20pending.php:'];a44_0x5653=function(){return _0x29bdf5;};return a44_0x5653();}Object['defineProperty'](exports,a44_0x266677(0x111),{'value':!![]}),exports[a44_0x266677(0xcc)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x5dd282=a44_0x266677;this[_0x5dd282(0x107)]=_0x5dd282(0x100),console['log']('üåê\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy');}async[a44_0x266677(0x12c)](_0x1abe64){const _0x20c72d=a44_0x266677,{orderId:_0x166141,name:_0x114a43,paymentDescription:_0x19580b,amount:_0xf93631,currency:_0x189fb7,webhookUrl:_0x47c5d5,returnUrl:_0x48e897,expiryDate:_0xc67151}=_0x1abe64,_0x4264ed=_0x189fb7[_0x20c72d(0xef)](),_0x1d0362='https://tesoft.uk/gateway/noda/webhook/',_0x25c3f6=_0x20c72d(0xf9)+_0x166141,_0x1fdd08={'name':_0x114a43,'paymentDescription':_0x19580b,'amount':_0xf93631,'currency':_0x4264ed,'paymentId':_0x166141,'webhookUrl':_0x1d0362,'returnUrl':_0x25c3f6};_0xc67151&&(_0x1fdd08[_0x20c72d(0xcf)]=_0xc67151);const _0x7372c=Date[_0x20c72d(0x12d)]();try{console[_0x20c72d(0xed)](_0x20c72d(0xc0)),console[_0x20c72d(0xed)](_0x20c72d(0xd5),this[_0x20c72d(0x107)]),console[_0x20c72d(0xed)](_0x20c72d(0xc1),JSON[_0x20c72d(0xf2)](_0x1fdd08,null,0x2)),console['log'](_0x20c72d(0xe4),_0x166141,'(8digits-8digits\x20format\x20for\x20Noda)'),console[_0x20c72d(0xed)](_0x20c72d(0xe2),_0x25c3f6),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x20c72d(0xd3),_0x20c72d(0xf3),_0x20c72d(0x12f),_0x1fdd08);const _0x1141e7=await fetch(this[_0x20c72d(0x107)],{'method':_0x20c72d(0x12f),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x20c72d(0xdf)},'body':JSON[_0x20c72d(0xf2)](_0x1fdd08)}),_0x458dbd=Date[_0x20c72d(0x12d)]()-_0x7372c;console['log']('===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x20c72d(0xed)](_0x20c72d(0x12b),_0x1141e7['status']),console[_0x20c72d(0xed)](_0x20c72d(0x10e),_0x1141e7[_0x20c72d(0x119)]),console[_0x20c72d(0xed)](_0x20c72d(0xd8),Object['fromEntries'](_0x1141e7[_0x20c72d(0xf8)][_0x20c72d(0x130)]())),console[_0x20c72d(0xed)](_0x20c72d(0xc3),_0x458dbd+'ms');const _0x210cb5=await _0x1141e7[_0x20c72d(0xff)]();console[_0x20c72d(0xed)](_0x20c72d(0xe8),_0x210cb5);if(!_0x1141e7['ok']){console[_0x20c72d(0x108)]('===\x20NODA\x20API\x20ERROR\x20==='),console[_0x20c72d(0x108)](_0x20c72d(0xf4),_0x1141e7['status']),console['error'](_0x20c72d(0xd9),_0x210cb5),loggerService_1[_0x20c72d(0x105)][_0x20c72d(0x10b)](_0x20c72d(0xd3),_0x20c72d(0xf3),_0x1141e7[_0x20c72d(0x12e)],_0x210cb5,_0x458dbd),loggerService_1[_0x20c72d(0x105)]['logWhiteDomainError'](_0x20c72d(0xd3),'/payment-links','HTTP\x20'+_0x1141e7[_0x20c72d(0x12e)]+':\x20'+_0x210cb5);if(_0x1141e7[_0x20c72d(0x12e)]===0x190)throw new Error(_0x20c72d(0xe7));else{if(_0x1141e7[_0x20c72d(0x12e)]===0x1f4)throw new Error(_0x20c72d(0xc6));}throw new Error(_0x20c72d(0xea)+_0x1141e7[_0x20c72d(0x12e)]+_0x20c72d(0xd6)+_0x210cb5);}let _0x3b7347;try{_0x3b7347=JSON['parse'](_0x210cb5);}catch(_0x56ba53){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x56ba53),loggerService_1[_0x20c72d(0x105)][_0x20c72d(0xdb)](_0x20c72d(0xd3),'/payment-links',_0x20c72d(0x11b)+_0x56ba53);throw new Error(_0x20c72d(0xeb)+_0x210cb5);}console[_0x20c72d(0xed)](_0x20c72d(0x104)),console['log'](_0x20c72d(0xd0),JSON[_0x20c72d(0xf2)](_0x3b7347,null,0x2)),loggerService_1[_0x20c72d(0x105)][_0x20c72d(0x10b)]('noda',_0x20c72d(0xf3),_0x1141e7[_0x20c72d(0x12e)],_0x3b7347,_0x458dbd);if(_0x3b7347[_0x20c72d(0x108)]||_0x3b7347[_0x20c72d(0x120)]){const _0x18d0ac=_0x3b7347[_0x20c72d(0xc4)]||_0x3b7347[_0x20c72d(0x108)]||_0x20c72d(0x112);console[_0x20c72d(0x108)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x18d0ac),console[_0x20c72d(0x108)]('Status\x20Code:',_0x3b7347[_0x20c72d(0x120)]),loggerService_1['loggerService'][_0x20c72d(0xdb)](_0x20c72d(0xd3),_0x20c72d(0xf3),_0x20c72d(0xe6)+_0x18d0ac);throw new Error(_0x20c72d(0x122)+_0x18d0ac);}if(!_0x3b7347['id']||!_0x3b7347[_0x20c72d(0xd2)]?.[_0x20c72d(0xc2)]){console[_0x20c72d(0x108)](_0x20c72d(0xd1)),console[_0x20c72d(0x108)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x20c72d(0x108)](_0x20c72d(0x11e),_0x3b7347),loggerService_1[_0x20c72d(0x105)]['logWhiteDomainError'](_0x20c72d(0xd3),'/payment-links','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink');throw new Error(_0x20c72d(0x115));}return console['log'](_0x20c72d(0xcb)),console[_0x20c72d(0xed)](_0x20c72d(0x118),_0x3b7347['id']),console[_0x20c72d(0xed)]('Short\x20Link:',_0x3b7347[_0x20c72d(0xd2)][_0x20c72d(0xc2)]),console[_0x20c72d(0xed)](_0x20c72d(0x102),_0x3b7347[_0x20c72d(0xd2)][_0x20c72d(0xec)]||_0x20c72d(0x126)),console[_0x20c72d(0xed)]('Order\x20ID\x20Used:',_0x166141,_0x20c72d(0xdc)),console[_0x20c72d(0xed)]('‚úÖ\x20Return\x20URL\x20configured\x20for\x20pending:',_0x25c3f6),{'gateway_payment_id':_0x3b7347['id'],'payment_url':_0x3b7347[_0x20c72d(0xd2)]['shortLink'],'qr_code_url':_0x3b7347['shortLinkUrls'][_0x20c72d(0xec)],'expiry_date':_0x3b7347[_0x20c72d(0xcf)]};}catch(_0x48bdca){console[_0x20c72d(0x108)](_0x20c72d(0xdd)),console[_0x20c72d(0x108)]('Error\x20details:',_0x48bdca),loggerService_1[_0x20c72d(0x105)][_0x20c72d(0xdb)]('noda',_0x20c72d(0xf3),_0x48bdca);if(_0x48bdca instanceof Error){console[_0x20c72d(0x108)]('Error\x20message:',_0x48bdca['message']),console[_0x20c72d(0x108)](_0x20c72d(0xc9),_0x48bdca[_0x20c72d(0xca)]);throw new Error(_0x20c72d(0xc5)+_0x48bdca[_0x20c72d(0xc4)]);}throw new Error(_0x20c72d(0x110));}}async[a44_0x266677(0x12a)](_0x215ab6){const _0xf1dc0c=a44_0x266677,_0x21a96d=Date[_0xf1dc0c(0x12d)]();try{loggerService_1[_0xf1dc0c(0x105)][_0xf1dc0c(0x113)](_0xf1dc0c(0xd3),_0xf1dc0c(0xe3)+_0x215ab6,_0xf1dc0c(0xd4),{});const _0x3e3f47=await fetch(this[_0xf1dc0c(0x107)]+'/'+_0x215ab6,{'method':'GET','headers':{'Content-Type':_0xf1dc0c(0x121),'User-Agent':_0xf1dc0c(0xdf)}}),_0x44797e=Date[_0xf1dc0c(0x12d)]()-_0x21a96d;if(!_0x3e3f47['ok']){const _0x15008a=await _0x3e3f47[_0xf1dc0c(0xff)]();loggerService_1[_0xf1dc0c(0x105)][_0xf1dc0c(0x10b)](_0xf1dc0c(0xd3),_0xf1dc0c(0xe3)+_0x215ab6,_0x3e3f47[_0xf1dc0c(0x12e)],_0x15008a,_0x44797e);throw new Error(_0xf1dc0c(0xea)+_0x3e3f47[_0xf1dc0c(0x12e)]);}const _0x499e26=await _0x3e3f47[_0xf1dc0c(0xe0)]();loggerService_1['loggerService'][_0xf1dc0c(0x10b)](_0xf1dc0c(0xd3),'/payment-links/'+_0x215ab6,_0x3e3f47[_0xf1dc0c(0x12e)],_0x499e26,_0x44797e);if(_0x499e26[_0xf1dc0c(0x108)]||_0x499e26[_0xf1dc0c(0x120)]){loggerService_1['loggerService'][_0xf1dc0c(0xdb)]('noda','/payment-links/'+_0x215ab6,_0xf1dc0c(0x122)+(_0x499e26[_0xf1dc0c(0xc4)]||_0x499e26[_0xf1dc0c(0x108)]||_0xf1dc0c(0xfb)));throw new Error(_0xf1dc0c(0x122)+(_0x499e26[_0xf1dc0c(0xc4)]||_0x499e26[_0xf1dc0c(0x108)]||_0xf1dc0c(0xfb)));}let _0x25abf4=_0xf1dc0c(0xf5);if(_0x499e26['isActive']===![]){if(_0x499e26[_0xf1dc0c(0xcf)]){const _0x5df87d=new Date(_0x499e26['expiryDate']),_0x278294=new Date();_0x5df87d<_0x278294?_0x25abf4=_0xf1dc0c(0xf0):_0x25abf4=_0xf1dc0c(0x114);}else _0x25abf4='FAILED';}else _0x25abf4=_0xf1dc0c(0xf5);return{'status':_0x25abf4,'amount':_0x499e26[_0xf1dc0c(0x127)],'currency':_0x499e26['currency'],'isActive':_0x499e26[_0xf1dc0c(0x124)]};}catch(_0x3c9421){console['error']('Noda\x20payment\x20verification\x20error:',_0x3c9421),loggerService_1[_0xf1dc0c(0x105)]['logWhiteDomainError'](_0xf1dc0c(0xd3),_0xf1dc0c(0xe3)+_0x215ab6,_0x3c9421);throw new Error(_0xf1dc0c(0x128)+(_0x3c9421 instanceof Error?_0x3c9421['message']:_0xf1dc0c(0xfb)));}}async['processWebhook'](_0xe05b6a){const _0x5d2dd2=a44_0x266677;console[_0x5d2dd2(0xed)](_0x5d2dd2(0xe9),_0xe05b6a);let _0x491d60=_0x5d2dd2(0xf5);switch(_0xe05b6a[_0x5d2dd2(0xf1)]?.['toLowerCase']()){case _0x5d2dd2(0xfc):case'completed':case'paid':case _0x5d2dd2(0xde):case'successful':_0xe05b6a[_0x5d2dd2(0xfa)]===_0x5d2dd2(0x10c)?_0x491d60=_0x5d2dd2(0x106):_0x491d60=_0x5d2dd2(0xf5);break;case _0x5d2dd2(0x109):case'canceled':case _0x5d2dd2(0x10d):case'error':case _0x5d2dd2(0x129):_0x491d60='FAILED';break;case _0x5d2dd2(0xe5):case'timeout':_0x491d60=_0x5d2dd2(0xf0);break;case _0x5d2dd2(0x11d):case _0x5d2dd2(0xd7):case _0x5d2dd2(0x117):case _0x5d2dd2(0xda):case'in_progress':default:_0x491d60='PENDING';break;}return{'paymentId':_0xe05b6a['MerchantPaymentId']||_0xe05b6a[_0x5d2dd2(0xe1)],'status':_0x491d60,'amount':_0xe05b6a[_0x5d2dd2(0xee)],'currency':_0xe05b6a[_0x5d2dd2(0xce)],'additionalInfo':{'method':_0xe05b6a['Method'],'bankId':_0xe05b6a[_0x5d2dd2(0xfd)],'settled':_0xe05b6a[_0x5d2dd2(0xfa)],'settlementDate':_0xe05b6a['SettlementDate'],'remitterName':_0xe05b6a['Remitter']?.['Name'],'remitterIban':_0xe05b6a[_0x5d2dd2(0xc8)]?.[_0x5d2dd2(0xcd)],'bankTransactionId':_0xe05b6a[_0x5d2dd2(0x11f)]}};}['verifyWebhookSignature'](_0x5b9c5a,_0x5f6ea6){const _0x154275=a44_0x266677;return console['log'](_0x154275(0x10a),{'receivedSignature':_0x5f6ea6,'paymentId':_0x5b9c5a[_0x154275(0xe1)],'merchantPaymentId':_0x5b9c5a[_0x154275(0xc7)]}),!![];}}exports[a44_0x266677(0xcc)]=NodaService;