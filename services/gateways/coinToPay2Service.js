'use strict';const a48_0x2dfa84=a48_0xd530;(function(_0x503d02,_0x1d853f){const _0x5f54c8=a48_0xd530,_0x33c017=_0x503d02();while(!![]){try{const _0x26d1f5=parseInt(_0x5f54c8(0x22a))/0x1*(parseInt(_0x5f54c8(0x24d))/0x2)+-parseInt(_0x5f54c8(0x1f3))/0x3+parseInt(_0x5f54c8(0x207))/0x4*(parseInt(_0x5f54c8(0x21d))/0x5)+-parseInt(_0x5f54c8(0x221))/0x6+-parseInt(_0x5f54c8(0x205))/0x7+-parseInt(_0x5f54c8(0x268))/0x8*(parseInt(_0x5f54c8(0x262))/0x9)+parseInt(_0x5f54c8(0x1ff))/0xa*(parseInt(_0x5f54c8(0x232))/0xb);if(_0x26d1f5===_0x1d853f)break;else _0x33c017['push'](_0x33c017['shift']());}catch(_0x31edb0){_0x33c017['push'](_0x33c017['shift']());}}}(a48_0x2407,0xde034));Object[a48_0x2dfa84(0x266)](exports,'__esModule',{'value':!![]}),exports[a48_0x2dfa84(0x1fd)]=void 0x0;function a48_0x2407(){const _0x9f5ad7=['status_code','verifyPayment','headers','Unknown\x20error','HTTP\x20Status:','&alternative=false','../loggerService','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','CoinToPay2Service','created','6067850aDkWYI','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','Request\x20Body:','PaymentDetail','currency','/create','7252686idRHSn','Amount:','451720NnXHdC','Incomplete\x20response:\x20missing\x20data','CoinToPay2\x20API\x20error:\x20','POST','apiUrl','Amount','üè¶\x20Payment\x20Detail:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','PENDING','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','Transaction\x20ID:','waiting','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','URL:','inputCurrency','timeout','https://traffer.uk/gateway/cointopay/status.php','PAID','stack','TransactionConfirmedOn','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','50YgaBjQ','Status\x20Code:','application/json','pending','4986672TRecSf','loggerService','awaiting\x20fiat','using\x20pattern:','coinAddress','Error\x20message:','checkPaymentStatus','QRCodeURL','CreatedOn','1123WMvZVp','expired','Business\x20Error:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','CoinToPay2\x20payment\x20status\x20check\x20error:','processWebhook','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','data','55mqBIca','not\x20found','Status\x20Text:','Currency:','Missing\x20data\x20in\x20response','stringify','cancelled','error','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','parse','Result:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','gateway_payment_id','text','Response\x20data:','Status','paid','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Gateway\x20Payment\x20ID:','Payment\x20System/1.0\x20(CoinToPay2)','Parsed\x20Result:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','CoinToPay2\x20status\x20API\x20error:\x20','Response\x20Body:','toLowerCase','2042VHsTZm','Error\x20details:','not\x20confirmed','now','üìä\x20Status\x20check\x20URL:','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','https://traffer.uk/gateway/cointopay/','/status','statusUrl','ExpiryTime','log','Raw\x20Response\x20Body:','cointopay2','logWhiteDomainError','FAILED','message','logWhiteDomainRequest','Failed\x20to\x20parse\x20JSON\x20response:','Unknown\x20error\x20from\x20CoinToPay2\x20API','===\x20COINTOPAY2\x20API\x20ERROR\x20===','createPaymentLink','2546658UEdvoz','EXPIRED','HTTP\x20','TransactionID','defineProperty','failed','40vWCBXV','EUR','logWhiteDomainResponse','fromEntries','source','===\x20COINTOPAY2\x20SUCCESS\x20===','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','JSON\x20Parse\x20Error:\x20','HTTP\x20error!\x20status:\x20','payment_url','Error\x20stack:','statusText','Payment\x20URL\x20(modified):','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','result','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','merchant_reference_id','status','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','Status:','3355272QMsnbW','Headers:'];a48_0x2407=function(){return _0x9f5ad7;};return a48_0x2407();}const loggerService_1=require(a48_0x2dfa84(0x1fb));class CoinToPay2Service{constructor(){const _0x52c077=a48_0x2dfa84;this[_0x52c077(0x20b)]=_0x52c077(0x253),this[_0x52c077(0x255)]=_0x52c077(0x218),console[_0x52c077(0x257)](_0x52c077(0x214)),console['log'](_0x52c077(0x251),this[_0x52c077(0x255)]);}async[a48_0x2dfa84(0x261)](_0x125ab2){const _0x23bf35=a48_0x2dfa84,{orderId:_0x595722,amount:_0x33ea2a}=_0x125ab2;console['log'](_0x23bf35(0x244)+_0x33ea2a+'\x20EUR');const _0x14ceee={'amount':_0x33ea2a},_0x39786e=Date[_0x23bf35(0x250)]();try{console[_0x23bf35(0x257)](_0x23bf35(0x230)),console[_0x23bf35(0x257)](_0x23bf35(0x215),this[_0x23bf35(0x20b)]),console[_0x23bf35(0x257)](_0x23bf35(0x201),JSON[_0x23bf35(0x237)](_0x14ceee,null,0x2)),console[_0x23bf35(0x257)](_0x23bf35(0x206),_0x33ea2a,'EUR\x20(always\x20EUR\x20for\x20CoinToPay2)'),loggerService_1[_0x23bf35(0x222)][_0x23bf35(0x25d)](_0x23bf35(0x259),'/create','POST',_0x14ceee);const _0x3c8e14=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x23bf35(0x247)},'body':JSON[_0x23bf35(0x237)](_0x14ceee)}),_0x27d3b0=Date[_0x23bf35(0x250)]()-_0x39786e;console[_0x23bf35(0x257)](_0x23bf35(0x200)),console[_0x23bf35(0x257)](_0x23bf35(0x1f2),_0x3c8e14[_0x23bf35(0x1ef)]),console['log'](_0x23bf35(0x234),_0x3c8e14[_0x23bf35(0x273)]),console['log'](_0x23bf35(0x1f4),Object[_0x23bf35(0x26b)](_0x3c8e14[_0x23bf35(0x1f7)]['entries']())),console[_0x23bf35(0x257)]('Response\x20Time:',_0x27d3b0+'ms');const _0x2b8406=await _0x3c8e14['text']();console[_0x23bf35(0x257)](_0x23bf35(0x258),_0x2b8406);if(!_0x3c8e14['ok']){console[_0x23bf35(0x239)](_0x23bf35(0x260)),console[_0x23bf35(0x239)](_0x23bf35(0x1f9),_0x3c8e14[_0x23bf35(0x1ef)]),console[_0x23bf35(0x239)](_0x23bf35(0x24b),_0x2b8406),loggerService_1['loggerService'][_0x23bf35(0x26a)](_0x23bf35(0x259),_0x23bf35(0x204),_0x3c8e14['status'],_0x2b8406,_0x27d3b0),loggerService_1[_0x23bf35(0x222)][_0x23bf35(0x25a)](_0x23bf35(0x259),'/create',_0x23bf35(0x264)+_0x3c8e14[_0x23bf35(0x1ef)]+':\x20'+_0x2b8406);throw new Error(_0x23bf35(0x270)+_0x3c8e14[_0x23bf35(0x1ef)]+',\x20body:\x20'+_0x2b8406);}let _0x4d996a;try{_0x4d996a=JSON['parse'](_0x2b8406);}catch(_0x5249c7){console['error'](_0x23bf35(0x25e),_0x5249c7),loggerService_1[_0x23bf35(0x222)]['logWhiteDomainError'](_0x23bf35(0x259),'/create','JSON\x20Parse\x20Error:\x20'+_0x5249c7);throw new Error(_0x23bf35(0x277)+_0x2b8406);}console[_0x23bf35(0x257)](_0x23bf35(0x249)),console['log'](_0x23bf35(0x248),JSON[_0x23bf35(0x237)](_0x4d996a,null,0x2)),loggerService_1['loggerService'][_0x23bf35(0x26a)](_0x23bf35(0x259),_0x23bf35(0x204),_0x3c8e14[_0x23bf35(0x1ef)],_0x4d996a,_0x27d3b0);if(_0x4d996a[_0x23bf35(0x239)]){const _0xda45fa=_0x4d996a['message']||_0x4d996a['error']||_0x23bf35(0x25f);console['error'](_0x23bf35(0x1f0)),console['error']('Error\x20Message:',_0xda45fa),loggerService_1[_0x23bf35(0x222)]['logWhiteDomainError']('cointopay2','/create',_0x23bf35(0x22c)+_0xda45fa);throw new Error(_0x23bf35(0x209)+_0xda45fa);}if(!_0x4d996a[_0x23bf35(0x271)]||!_0x4d996a[_0x23bf35(0x23f)]){console[_0x23bf35(0x239)]('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x23bf35(0x239)](_0x23bf35(0x23a)),console[_0x23bf35(0x239)](_0x23bf35(0x241),_0x4d996a),loggerService_1[_0x23bf35(0x222)]['logWhiteDomainError'](_0x23bf35(0x259),_0x23bf35(0x204),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console['log'](_0x23bf35(0x26d)),console[_0x23bf35(0x257)](_0x23bf35(0x246),_0x4d996a['gateway_payment_id']),console[_0x23bf35(0x257)]('Payment\x20URL\x20(original):',_0x4d996a[_0x23bf35(0x271)]);const _0x219ab3=_0x4d996a[_0x23bf35(0x271)]+_0x23bf35(0x1fa);return console['log'](_0x23bf35(0x274),_0x219ab3),console[_0x23bf35(0x257)](_0x23bf35(0x206),_0x33ea2a,_0x23bf35(0x269)),{'gateway_payment_id':_0x4d996a['gateway_payment_id'],'payment_url':_0x219ab3};}catch(_0xe8a017){console['error']('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x23bf35(0x239)](_0x23bf35(0x24e),_0xe8a017),loggerService_1[_0x23bf35(0x222)][_0x23bf35(0x25a)]('cointopay2',_0x23bf35(0x204),_0xe8a017);if(_0xe8a017 instanceof Error){console[_0x23bf35(0x239)](_0x23bf35(0x226),_0xe8a017['message']),console[_0x23bf35(0x239)](_0x23bf35(0x272),_0xe8a017[_0x23bf35(0x21a)]);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0xe8a017[_0x23bf35(0x25c)]);}throw new Error(_0x23bf35(0x20f));}}async[a48_0x2dfa84(0x227)](_0x236258){const _0xb225c3=a48_0x2dfa84,_0x5467a6=Date[_0xb225c3(0x250)]();try{console[_0xb225c3(0x257)](_0xb225c3(0x245)+_0x236258);const _0x576b2d={'gatewayPaymentId':_0x236258};loggerService_1[_0xb225c3(0x222)][_0xb225c3(0x25d)](_0xb225c3(0x259),'/status',_0xb225c3(0x20a),_0x576b2d);const _0xc5af5=await fetch(this['statusUrl'],{'method':_0xb225c3(0x20a),'headers':{'Content-Type':_0xb225c3(0x21f),'Accept':_0xb225c3(0x21f),'User-Agent':_0xb225c3(0x247)},'body':JSON[_0xb225c3(0x237)](_0x576b2d)}),_0x3db0e9=Date[_0xb225c3(0x250)]()-_0x5467a6;console[_0xb225c3(0x257)](_0xb225c3(0x275)),console[_0xb225c3(0x257)](_0xb225c3(0x1f2),_0xc5af5['status']),console[_0xb225c3(0x257)]('Response\x20Time:',_0x3db0e9+'ms');if(!_0xc5af5['ok']){const _0x225ecc=await _0xc5af5[_0xb225c3(0x240)]();console[_0xb225c3(0x239)]('HTTP\x20Status:',_0xc5af5[_0xb225c3(0x1ef)]),console[_0xb225c3(0x239)]('Response\x20Body:',_0x225ecc),loggerService_1[_0xb225c3(0x222)]['logWhiteDomainResponse'](_0xb225c3(0x259),_0xb225c3(0x254),_0xc5af5['status'],_0x225ecc,_0x3db0e9),loggerService_1['loggerService'][_0xb225c3(0x25a)](_0xb225c3(0x259),_0xb225c3(0x254),_0xb225c3(0x264)+_0xc5af5[_0xb225c3(0x1ef)]+':\x20'+_0x225ecc);throw new Error('HTTP\x20error!\x20status:\x20'+_0xc5af5[_0xb225c3(0x1ef)]);}const _0xaa1105=await _0xc5af5[_0xb225c3(0x240)]();console['log'](_0xb225c3(0x258),_0xaa1105);let _0x48d911;try{_0x48d911=JSON[_0xb225c3(0x23c)](_0xaa1105);}catch(_0x5208b1){console[_0xb225c3(0x239)](_0xb225c3(0x25e),_0x5208b1),loggerService_1[_0xb225c3(0x222)]['logWhiteDomainError'](_0xb225c3(0x259),_0xb225c3(0x254),_0xb225c3(0x26f)+_0x5208b1);throw new Error(_0xb225c3(0x22d)+_0xaa1105);}loggerService_1[_0xb225c3(0x222)]['logWhiteDomainResponse'](_0xb225c3(0x259),_0xb225c3(0x254),_0xc5af5[_0xb225c3(0x1ef)],_0x48d911,_0x3db0e9),console['log'](_0xb225c3(0x252)),console[_0xb225c3(0x257)](_0xb225c3(0x23d),_0x48d911[_0xb225c3(0x276)]),console['log'](_0xb225c3(0x21e),_0x48d911[_0xb225c3(0x1f5)]),console[_0xb225c3(0x257)]('Payment\x20Status:',_0x48d911[_0xb225c3(0x231)]?.[_0xb225c3(0x242)]),console['log'](_0xb225c3(0x206),_0x48d911[_0xb225c3(0x231)]?.[_0xb225c3(0x20c)]),console[_0xb225c3(0x257)](_0xb225c3(0x235),_0x48d911['data']?.['inputCurrency']);if(_0x48d911[_0xb225c3(0x276)]!=='success'||_0x48d911[_0xb225c3(0x1f5)]!==0xc8){const _0x51b591=_0x48d911[_0xb225c3(0x25c)]||'Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API';console[_0xb225c3(0x239)](_0xb225c3(0x23b)),console[_0xb225c3(0x239)]('Error\x20Message:',_0x51b591),loggerService_1[_0xb225c3(0x222)]['logWhiteDomainError'](_0xb225c3(0x259),'/status','Status\x20API\x20Error:\x20'+_0x51b591);throw new Error(_0xb225c3(0x24a)+_0x51b591);}if(!_0x48d911[_0xb225c3(0x231)]){console[_0xb225c3(0x239)](_0xb225c3(0x26e)),console['error'](_0xb225c3(0x236)),loggerService_1[_0xb225c3(0x222)]['logWhiteDomainError'](_0xb225c3(0x259),_0xb225c3(0x254),_0xb225c3(0x208));throw new Error(_0xb225c3(0x278));}let _0x5cb6ae='PENDING';switch(_0x48d911[_0xb225c3(0x231)][_0xb225c3(0x242)]?.['toLowerCase']()){case _0xb225c3(0x243):_0x5cb6ae=_0xb225c3(0x219);break;case _0xb225c3(0x238):case _0xb225c3(0x267):case'error':_0x5cb6ae='FAILED';break;case _0xb225c3(0x22b):case _0xb225c3(0x217):_0x5cb6ae='EXPIRED';break;case'waiting':case _0xb225c3(0x223):case _0xb225c3(0x220):case'created':default:_0x5cb6ae='PENDING';break;}let _0xec2740,_0x3e5b04;if(_0x48d911['data'][_0xb225c3(0x202)]){const _0x2a20e1=_0x48d911[_0xb225c3(0x231)][_0xb225c3(0x202)];console[_0xb225c3(0x257)](_0xb225c3(0x20d),_0x2a20e1);const _0x10cded=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x12767a of _0x10cded){const _0x5109e0=_0x2a20e1['match'](_0x12767a);if(_0x5109e0){_0xec2740=_0x5109e0[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0xec2740,_0xb225c3(0x224),_0x12767a[_0xb225c3(0x26c)]);break;}}if(!_0xec2740){console[_0xb225c3(0x257)](_0xb225c3(0x211));const _0x7511c=_0x2a20e1['match'](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x7511c&&(_0xec2740=_0x7511c[0x1],console[_0xb225c3(0x257)](_0xb225c3(0x1f1),_0xec2740));}_0x3e5b04=_0x2a20e1;}const _0x19aa43={'iban':_0xec2740,'bankDetails':_0x3e5b04,'transactionId':_0x48d911[_0xb225c3(0x231)][_0xb225c3(0x265)],'coinAddress':_0x48d911['data'][_0xb225c3(0x225)],'qrCodeUrl':_0x48d911['data'][_0xb225c3(0x228)],'expiryTime':_0x48d911[_0xb225c3(0x231)][_0xb225c3(0x256)],'createdOn':_0x48d911[_0xb225c3(0x231)][_0xb225c3(0x229)],'confirmedOn':_0x48d911['data']['TransactionConfirmedOn']};console[_0xb225c3(0x257)]('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console['log'](_0xb225c3(0x1f2),_0x48d911[_0xb225c3(0x231)][_0xb225c3(0x242)],'->',_0x5cb6ae),console[_0xb225c3(0x257)]('Amount:',_0x48d911[_0xb225c3(0x231)][_0xb225c3(0x20c)],_0x48d911[_0xb225c3(0x231)][_0xb225c3(0x216)]),console[_0xb225c3(0x257)](_0xb225c3(0x212),_0x48d911[_0xb225c3(0x231)]['TransactionID']),console[_0xb225c3(0x257)]('IBAN:',_0xec2740||_0xb225c3(0x233)),console[_0xb225c3(0x257)]('Created\x20On:',_0x48d911[_0xb225c3(0x231)][_0xb225c3(0x229)]),console[_0xb225c3(0x257)]('Confirmed\x20On:',_0x48d911['data'][_0xb225c3(0x21b)]||_0xb225c3(0x24f));if(_0x48d911[_0xb225c3(0x231)][_0xb225c3(0x242)]?.['toLowerCase']()===_0xb225c3(0x223))console[_0xb225c3(0x257)](_0xb225c3(0x20e));else _0x48d911[_0xb225c3(0x231)][_0xb225c3(0x242)]?.[_0xb225c3(0x24c)]()===_0xb225c3(0x243)&&console[_0xb225c3(0x257)](_0xb225c3(0x23e));return{'status':_0x5cb6ae,'amount':parseFloat(_0x48d911[_0xb225c3(0x231)][_0xb225c3(0x20c)])||undefined,'currency':_0x48d911['data']['inputCurrency']||_0xb225c3(0x269),'paymentDetails':_0x19aa43};}catch(_0x2e747b){console['error'](_0xb225c3(0x22e),_0x2e747b),loggerService_1[_0xb225c3(0x222)]['logWhiteDomainError'](_0xb225c3(0x259),'/status',_0x2e747b);throw new Error(_0xb225c3(0x1fc)+(_0x2e747b instanceof Error?_0x2e747b[_0xb225c3(0x25c)]:_0xb225c3(0x1f8)));}}async[a48_0x2dfa84(0x1f6)](_0x5d02ea){const _0x13bb47=a48_0x2dfa84,_0x298134=await this[_0x13bb47(0x227)](_0x5d02ea);return{'status':_0x298134[_0x13bb47(0x1ef)],'amount':_0x298134['amount'],'currency':_0x298134[_0x13bb47(0x203)]};}async[a48_0x2dfa84(0x22f)](_0x572189){const _0x26b947=a48_0x2dfa84;console[_0x26b947(0x257)](_0x26b947(0x21c),_0x572189);let _0x2259f2=_0x26b947(0x210);switch(_0x572189[_0x26b947(0x1ef)]?.[_0x26b947(0x24c)]()){case _0x26b947(0x243):_0x2259f2=_0x26b947(0x219);break;case _0x26b947(0x238):case _0x26b947(0x267):case'error':_0x2259f2=_0x26b947(0x25b);break;case _0x26b947(0x22b):case _0x26b947(0x217):_0x2259f2=_0x26b947(0x263);break;case'pending':case _0x26b947(0x213):case _0x26b947(0x223):case _0x26b947(0x1fe):default:_0x2259f2=_0x26b947(0x210);break;}return{'paymentId':_0x572189['order_id']||_0x572189[_0x26b947(0x279)]||'','status':_0x2259f2,'amount':_0x572189['amount'],'currency':_0x572189['currency']||_0x26b947(0x269)};}}function a48_0xd530(_0xc3610f,_0x15fec3){const _0x2407e1=a48_0x2407();return a48_0xd530=function(_0xd5309a,_0x114cbf){_0xd5309a=_0xd5309a-0x1ef;let _0x1d5742=_0x2407e1[_0xd5309a];return _0x1d5742;},a48_0xd530(_0xc3610f,_0x15fec3);}exports['CoinToPay2Service']=CoinToPay2Service;