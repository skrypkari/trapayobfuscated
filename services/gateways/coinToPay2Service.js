'use strict';const a45_0x418aa2=a45_0xfe6d;function a45_0xfe6d(_0xce87d0,_0x5214a0){const _0x43d0f7=a45_0x43d0();return a45_0xfe6d=function(_0xfe6dc5,_0x5daa44){_0xfe6dc5=_0xfe6dc5-0x6b;let _0x36ee1a=_0x43d0f7[_0xfe6dc5];return _0x36ee1a;},a45_0xfe6d(_0xce87d0,_0x5214a0);}(function(_0x25d3f0,_0x1442e4){const _0x1620af=a45_0xfe6d,_0x231c4c=_0x25d3f0();while(!![]){try{const _0x5b3123=-parseInt(_0x1620af(0xe7))/0x1+parseInt(_0x1620af(0x7a))/0x2*(-parseInt(_0x1620af(0xad))/0x3)+-parseInt(_0x1620af(0xb3))/0x4+parseInt(_0x1620af(0xab))/0x5*(-parseInt(_0x1620af(0xb4))/0x6)+-parseInt(_0x1620af(0x8f))/0x7+-parseInt(_0x1620af(0xbe))/0x8+parseInt(_0x1620af(0xea))/0x9;if(_0x5b3123===_0x1442e4)break;else _0x231c4c['push'](_0x231c4c['shift']());}catch(_0xeedc63){_0x231c4c['push'](_0x231c4c['shift']());}}}(a45_0x43d0,0xc4fae));Object[a45_0x418aa2(0xd8)](exports,a45_0x418aa2(0x9b),{'value':!![]}),exports[a45_0x418aa2(0x9d)]=void 0x0;const loggerService_1=require(a45_0x418aa2(0xeb));class CoinToPay2Service{constructor(){const _0x4ecc91=a45_0x418aa2;this[_0x4ecc91(0xdf)]='https://traffer.uk/gateway/cointopay/',this[_0x4ecc91(0x77)]=_0x4ecc91(0x90),console[_0x4ecc91(0xb8)](_0x4ecc91(0xbb)),console[_0x4ecc91(0xb8)]('üìä\x20Status\x20check\x20URL:',this[_0x4ecc91(0x77)]);}async[a45_0x418aa2(0xbd)](_0x17f03e){const _0x5199f0=a45_0x418aa2,{orderId:_0x5a7362,amount:_0x4a53c5}=_0x17f03e;console[_0x5199f0(0xb8)]('ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20'+_0x4a53c5+_0x5199f0(0xb5));const _0x47d453={'amount':_0x4a53c5},_0x4803be=Date[_0x5199f0(0xf1)]();try{console[_0x5199f0(0xb8)](_0x5199f0(0xa7)),console['log']('URL:',this[_0x5199f0(0xdf)]),console[_0x5199f0(0xb8)]('Request\x20Body:',JSON[_0x5199f0(0xd4)](_0x47d453,null,0x2)),console[_0x5199f0(0xb8)](_0x5199f0(0xa3),_0x4a53c5,_0x5199f0(0xe3)),loggerService_1[_0x5199f0(0xec)]['logWhiteDomainRequest'](_0x5199f0(0xce),_0x5199f0(0x8c),'POST',_0x47d453);const _0x470273=await fetch(this[_0x5199f0(0xdf)],{'method':_0x5199f0(0xb0),'headers':{'Content-Type':'application/json','Accept':_0x5199f0(0xcb),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON['stringify'](_0x47d453)}),_0x43b4f0=Date[_0x5199f0(0xf1)]()-_0x4803be;console['log'](_0x5199f0(0x79)),console['log'](_0x5199f0(0xc9),_0x470273[_0x5199f0(0xbf)]),console[_0x5199f0(0xb8)]('Status\x20Text:',_0x470273[_0x5199f0(0xe6)]),console[_0x5199f0(0xb8)](_0x5199f0(0xcc),Object[_0x5199f0(0x73)](_0x470273['headers'][_0x5199f0(0x6f)]())),console['log'](_0x5199f0(0xba),_0x43b4f0+'ms');const _0x320c0a=await _0x470273['text']();console[_0x5199f0(0xb8)](_0x5199f0(0x6d),_0x320c0a);if(!_0x470273['ok']){console['error'](_0x5199f0(0x83)),console[_0x5199f0(0xcd)](_0x5199f0(0xc2),_0x470273[_0x5199f0(0xbf)]),console[_0x5199f0(0xcd)](_0x5199f0(0xc3),_0x320c0a),loggerService_1[_0x5199f0(0xec)][_0x5199f0(0x8b)](_0x5199f0(0xce),_0x5199f0(0x8c),_0x470273['status'],_0x320c0a,_0x43b4f0),loggerService_1[_0x5199f0(0xec)]['logWhiteDomainError'](_0x5199f0(0xce),_0x5199f0(0x8c),'HTTP\x20'+_0x470273[_0x5199f0(0xbf)]+':\x20'+_0x320c0a);throw new Error(_0x5199f0(0xe5)+_0x470273['status']+_0x5199f0(0xae)+_0x320c0a);}let _0x922820;try{_0x922820=JSON[_0x5199f0(0x74)](_0x320c0a);}catch(_0x10445a){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x10445a),loggerService_1[_0x5199f0(0xec)][_0x5199f0(0xd5)]('cointopay2','/create','JSON\x20Parse\x20Error:\x20'+_0x10445a);throw new Error(_0x5199f0(0x80)+_0x320c0a);}console[_0x5199f0(0xb8)](_0x5199f0(0xb9)),console[_0x5199f0(0xb8)]('Parsed\x20Result:',JSON['stringify'](_0x922820,null,0x2)),loggerService_1[_0x5199f0(0xec)]['logWhiteDomainResponse']('cointopay2',_0x5199f0(0x8c),_0x470273[_0x5199f0(0xbf)],_0x922820,_0x43b4f0);if(_0x922820['error']){const _0x3ce5f9=_0x922820[_0x5199f0(0xf0)]||_0x922820[_0x5199f0(0xcd)]||_0x5199f0(0x75);console['error']('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x5199f0(0xcd)](_0x5199f0(0xef),_0x3ce5f9),loggerService_1[_0x5199f0(0xec)][_0x5199f0(0xd5)](_0x5199f0(0xce),_0x5199f0(0x8c),_0x5199f0(0x88)+_0x3ce5f9);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x3ce5f9);}if(!_0x922820[_0x5199f0(0xda)]||!_0x922820[_0x5199f0(0x76)]){console[_0x5199f0(0xcd)]('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x5199f0(0xcd)](_0x5199f0(0xdd)),console[_0x5199f0(0xcd)](_0x5199f0(0x7f),_0x922820),loggerService_1[_0x5199f0(0xec)][_0x5199f0(0xd5)](_0x5199f0(0xce),_0x5199f0(0x8c),_0x5199f0(0x85));throw new Error(_0x5199f0(0xa4));}return console['log'](_0x5199f0(0xb2)),console['log'](_0x5199f0(0x8e),_0x922820[_0x5199f0(0x76)]),console['log'](_0x5199f0(0xde),_0x922820[_0x5199f0(0xda)]),console[_0x5199f0(0xb8)](_0x5199f0(0xa3),_0x4a53c5,'EUR'),{'gateway_payment_id':_0x922820['gateway_payment_id'],'payment_url':_0x922820[_0x5199f0(0xda)]};}catch(_0x25914a){console['error'](_0x5199f0(0x89)),console[_0x5199f0(0xcd)](_0x5199f0(0xca),_0x25914a),loggerService_1[_0x5199f0(0xec)]['logWhiteDomainError'](_0x5199f0(0xce),_0x5199f0(0x8c),_0x25914a);if(_0x25914a instanceof Error){console[_0x5199f0(0xcd)](_0x5199f0(0x6e),_0x25914a[_0x5199f0(0xf0)]),console[_0x5199f0(0xcd)](_0x5199f0(0xe9),_0x25914a[_0x5199f0(0xc5)]);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x25914a[_0x5199f0(0xf0)]);}throw new Error(_0x5199f0(0x87));}}async['checkPaymentStatus'](_0x39c844){const _0x222080=a45_0x418aa2,_0x383fab=Date[_0x222080(0xf1)]();try{console[_0x222080(0xb8)](_0x222080(0xd7)+_0x39c844);const _0x12d176={'gatewayPaymentId':_0x39c844};loggerService_1[_0x222080(0xec)][_0x222080(0x70)](_0x222080(0xce),_0x222080(0xc4),'POST',_0x12d176);const _0x5d5bb8=await fetch(this['statusUrl'],{'method':_0x222080(0xb0),'headers':{'Content-Type':_0x222080(0xcb),'Accept':'application/json','User-Agent':_0x222080(0xa9)},'body':JSON[_0x222080(0xd4)](_0x12d176)}),_0x3715bd=Date[_0x222080(0xf1)]()-_0x383fab;console['log'](_0x222080(0xe2)),console['log'](_0x222080(0xc9),_0x5d5bb8[_0x222080(0xbf)]),console[_0x222080(0xb8)](_0x222080(0xba),_0x3715bd+'ms');if(!_0x5d5bb8['ok']){const _0x492b19=await _0x5d5bb8[_0x222080(0xd3)]();console[_0x222080(0xcd)]('HTTP\x20Status:',_0x5d5bb8['status']),console[_0x222080(0xcd)](_0x222080(0xc3),_0x492b19),loggerService_1[_0x222080(0xec)][_0x222080(0x8b)](_0x222080(0xce),_0x222080(0xc4),_0x5d5bb8[_0x222080(0xbf)],_0x492b19,_0x3715bd),loggerService_1[_0x222080(0xec)]['logWhiteDomainError']('cointopay2',_0x222080(0xc4),_0x222080(0x8d)+_0x5d5bb8[_0x222080(0xbf)]+':\x20'+_0x492b19);throw new Error(_0x222080(0xe5)+_0x5d5bb8['status']);}const _0x227f8c=await _0x5d5bb8[_0x222080(0xd3)]();console[_0x222080(0xb8)](_0x222080(0x6d),_0x227f8c);let _0x2049a9;try{_0x2049a9=JSON[_0x222080(0x74)](_0x227f8c);}catch(_0x4cb9c5){console[_0x222080(0xcd)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x4cb9c5),loggerService_1[_0x222080(0xec)]['logWhiteDomainError'](_0x222080(0xce),_0x222080(0xc4),'JSON\x20Parse\x20Error:\x20'+_0x4cb9c5);throw new Error(_0x222080(0x84)+_0x227f8c);}loggerService_1[_0x222080(0xec)][_0x222080(0x8b)](_0x222080(0xce),_0x222080(0xc4),_0x5d5bb8[_0x222080(0xbf)],_0x2049a9,_0x3715bd),console[_0x222080(0xb8)]('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console['log']('Result:',_0x2049a9['result']),console['log']('Status\x20Code:',_0x2049a9['status_code']),console['log']('Payment\x20Status:',_0x2049a9[_0x222080(0xb7)]?.[_0x222080(0x7d)]),console[_0x222080(0xb8)](_0x222080(0xa3),_0x2049a9[_0x222080(0xb7)]?.[_0x222080(0xaf)]),console[_0x222080(0xb8)](_0x222080(0x97),_0x2049a9['data']?.['inputCurrency']);if(_0x2049a9[_0x222080(0x7c)]!==_0x222080(0x98)||_0x2049a9[_0x222080(0xa1)]!==0xc8){const _0x297f18=_0x2049a9[_0x222080(0xf0)]||_0x222080(0xd9);console[_0x222080(0xcd)](_0x222080(0xa5)),console[_0x222080(0xcd)](_0x222080(0xef),_0x297f18),loggerService_1[_0x222080(0xec)][_0x222080(0xd5)](_0x222080(0xce),_0x222080(0xc4),'Status\x20API\x20Error:\x20'+_0x297f18);throw new Error(_0x222080(0x6b)+_0x297f18);}if(!_0x2049a9[_0x222080(0xb7)]){console['error'](_0x222080(0xe1)),console['error'](_0x222080(0x93)),loggerService_1['loggerService'][_0x222080(0xd5)](_0x222080(0xce),_0x222080(0xc4),_0x222080(0xa8));throw new Error(_0x222080(0xa2));}let _0x4cc18c=_0x222080(0xd2);switch(_0x2049a9[_0x222080(0xb7)][_0x222080(0x7d)]?.[_0x222080(0xb6)]()){case'paid':_0x4cc18c=_0x222080(0xac);break;case _0x222080(0x71):case'failed':case _0x222080(0xcd):_0x4cc18c=_0x222080(0x92);break;case _0x222080(0xe4):case _0x222080(0xcf):_0x4cc18c=_0x222080(0x6c);break;case'waiting':case _0x222080(0x81):case'pending':case _0x222080(0xe0):default:_0x4cc18c=_0x222080(0xd2);break;}let _0x54e549,_0x1ba473;if(_0x2049a9['data'][_0x222080(0xc6)]){const _0x5aa023=_0x2049a9[_0x222080(0xb7)]['PaymentDetail'];console[_0x222080(0xb8)]('üè¶\x20Payment\x20Detail:',_0x5aa023);const _0x549839=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x59ab6f of _0x549839){const _0x490102=_0x5aa023[_0x222080(0xed)](_0x59ab6f);if(_0x490102){_0x54e549=_0x490102[0x1],console['log'](_0x222080(0x82),_0x54e549,_0x222080(0xbc),_0x59ab6f[_0x222080(0x7e)]);break;}}if(!_0x54e549){console[_0x222080(0xb8)](_0x222080(0xee));const _0x554383=_0x5aa023[_0x222080(0xed)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x554383&&(_0x54e549=_0x554383[0x1],console['log'](_0x222080(0xa0),_0x54e549));}_0x1ba473=_0x5aa023;}const _0x4418b4={'iban':_0x54e549,'bankDetails':_0x1ba473,'transactionId':_0x2049a9[_0x222080(0xb7)][_0x222080(0x9f)],'coinAddress':_0x2049a9[_0x222080(0xb7)]['coinAddress'],'qrCodeUrl':_0x2049a9[_0x222080(0xb7)][_0x222080(0xaa)],'expiryTime':_0x2049a9[_0x222080(0xb7)][_0x222080(0x95)],'createdOn':_0x2049a9[_0x222080(0xb7)][_0x222080(0x9a)],'confirmedOn':_0x2049a9[_0x222080(0xb7)]['TransactionConfirmedOn']};console['log'](_0x222080(0xc1)),console['log'](_0x222080(0xc9),_0x2049a9[_0x222080(0xb7)][_0x222080(0x7d)],'->',_0x4cc18c),console[_0x222080(0xb8)]('Amount:',_0x2049a9[_0x222080(0xb7)][_0x222080(0xaf)],_0x2049a9[_0x222080(0xb7)]['inputCurrency']),console[_0x222080(0xb8)](_0x222080(0x86),_0x2049a9[_0x222080(0xb7)][_0x222080(0x9f)]),console[_0x222080(0xb8)](_0x222080(0xd0),_0x54e549||_0x222080(0xc0)),console[_0x222080(0xb8)](_0x222080(0x7b),_0x2049a9[_0x222080(0xb7)][_0x222080(0x9a)]),console[_0x222080(0xb8)]('Confirmed\x20On:',_0x2049a9['data'][_0x222080(0xa6)]||_0x222080(0xdb));if(_0x2049a9[_0x222080(0xb7)][_0x222080(0x7d)]?.[_0x222080(0xb6)]()==='awaiting\x20fiat')console['log'](_0x222080(0xc8));else _0x2049a9[_0x222080(0xb7)]['Status']?.[_0x222080(0xb6)]()===_0x222080(0x91)&&console[_0x222080(0xb8)](_0x222080(0xd1));return{'status':_0x4cc18c,'amount':parseFloat(_0x2049a9[_0x222080(0xb7)][_0x222080(0xaf)])||undefined,'currency':_0x2049a9['data']['inputCurrency']||_0x222080(0x9e),'paymentDetails':_0x4418b4};}catch(_0x2d4253){console[_0x222080(0xcd)](_0x222080(0xd6),_0x2d4253),loggerService_1[_0x222080(0xec)][_0x222080(0xd5)](_0x222080(0xce),'/status',_0x2d4253);throw new Error(_0x222080(0x78)+(_0x2d4253 instanceof Error?_0x2d4253['message']:_0x222080(0x96)));}}async[a45_0x418aa2(0xe8)](_0xe81ae5){const _0x33f748=a45_0x418aa2,_0x39ac1f=await this[_0x33f748(0x9c)](_0xe81ae5);return{'status':_0x39ac1f[_0x33f748(0xbf)],'amount':_0x39ac1f['amount'],'currency':_0x39ac1f[_0x33f748(0x72)]};}async['processWebhook'](_0x4be10a){const _0x1edf6b=a45_0x418aa2;console[_0x1edf6b(0xb8)](_0x1edf6b(0x94),_0x4be10a);let _0x5fbe7c='PENDING';switch(_0x4be10a['status']?.['toLowerCase']()){case _0x1edf6b(0x91):_0x5fbe7c=_0x1edf6b(0xac);break;case _0x1edf6b(0x71):case _0x1edf6b(0xdc):case _0x1edf6b(0xcd):_0x5fbe7c=_0x1edf6b(0x92);break;case'expired':case _0x1edf6b(0xcf):_0x5fbe7c=_0x1edf6b(0x6c);break;case _0x1edf6b(0x8a):case _0x1edf6b(0xc7):case _0x1edf6b(0x81):case'created':default:_0x5fbe7c=_0x1edf6b(0xd2);break;}return{'paymentId':_0x4be10a[_0x1edf6b(0xb1)]||_0x4be10a[_0x1edf6b(0x99)]||'','status':_0x5fbe7c,'amount':_0x4be10a['amount'],'currency':_0x4be10a[_0x1edf6b(0x72)]||'EUR'};}}exports[a45_0x418aa2(0x9d)]=CoinToPay2Service;function a45_0x43d0(){const _0x191fae=['Transaction\x20ID:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','Business\x20Error:\x20','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','pending','logWhiteDomainResponse','/create','HTTP\x20','Gateway\x20Payment\x20ID:','3898643nkwclz','https://traffer.uk/gateway/cointopay/status.php','paid','FAILED','Missing\x20data\x20in\x20response','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','ExpiryTime','Unknown\x20error','Currency:','success','merchant_reference_id','CreatedOn','__esModule','checkPaymentStatus','CoinToPay2Service','EUR','TransactionID','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','status_code','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','Amount:','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','TransactionConfirmedOn','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Incomplete\x20response:\x20missing\x20data','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','QRCodeURL','125tiPHzz','PAID','63GiTUFx',',\x20body:\x20','Amount','POST','order_id','===\x20COINTOPAY2\x20SUCCESS\x20===','5680304BkgMzQ','359202wFGmbx','\x20EUR','toLowerCase','data','log','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','Response\x20Time:','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','using\x20pattern:','createPaymentLink','9895864qccMpJ','status','not\x20found','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','HTTP\x20Status:','Response\x20Body:','/status','stack','PaymentDetail','waiting','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Status:','Error\x20details:','application/json','Headers:','error','cointopay2','timeout','IBAN:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','PENDING','text','stringify','logWhiteDomainError','CoinToPay2\x20payment\x20status\x20check\x20error:','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','defineProperty','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','payment_url','not\x20confirmed','failed','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Payment\x20URL:','apiUrl','created','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','expired','HTTP\x20error!\x20status:\x20','statusText','638268IslIxw','verifyPayment','Error\x20stack:','66444354mgSCJo','../loggerService','loggerService','match','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','Error\x20Message:','message','now','CoinToPay2\x20status\x20API\x20error:\x20','EXPIRED','Raw\x20Response\x20Body:','Error\x20message:','entries','logWhiteDomainRequest','cancelled','currency','fromEntries','parse','Unknown\x20error\x20from\x20CoinToPay2\x20API','gateway_payment_id','statusUrl','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','116850UfUuYA','Created\x20On:','result','Status','source','Response\x20data:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','awaiting\x20fiat','üè¶\x20Extracted\x20IBAN:','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id'];a45_0x43d0=function(){return _0x191fae;};return a45_0x43d0();}