'use strict';const a43_0x54d4b8=a43_0x2cf1;(function(_0x22d57c,_0x304740){const _0x4d2625=a43_0x2cf1,_0x2e275b=_0x22d57c();while(!![]){try{const _0x5d7a14=-parseInt(_0x4d2625(0x13b))/0x1+parseInt(_0x4d2625(0x14e))/0x2+-parseInt(_0x4d2625(0x11f))/0x3+parseInt(_0x4d2625(0x14b))/0x4+parseInt(_0x4d2625(0x155))/0x5*(-parseInt(_0x4d2625(0x175))/0x6)+parseInt(_0x4d2625(0x128))/0x7+-parseInt(_0x4d2625(0x159))/0x8*(-parseInt(_0x4d2625(0x15e))/0x9);if(_0x5d7a14===_0x304740)break;else _0x2e275b['push'](_0x2e275b['shift']());}catch(_0xdca2b){_0x2e275b['push'](_0x2e275b['shift']());}}}(a43_0x47f9,0x67bf1));function a43_0x2cf1(_0x2ce9b8,_0x4848be){const _0x47f9ea=a43_0x47f9();return a43_0x2cf1=function(_0x2cf134,_0x4dbd1e){_0x2cf134=_0x2cf134-0x11d;let _0x4af1f0=_0x47f9ea[_0x2cf134];return _0x4af1f0;},a43_0x2cf1(_0x2ce9b8,_0x4848be);}function a43_0x47f9(){const _0x1ee3cd=['TransactionConfirmedOn','URL:','createPaymentLink','result','Response\x20Time:','Amount',',\x20body:\x20','failed','Transaction\x20ID:','awaiting\x20fiat','Status','üìä\x20Status\x20check\x20URL:','Incomplete\x20response:\x20missing\x20data','POST','Amount:','amount','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','cancelled','fromEntries','match','inputCurrency','Payment\x20Status:','Currency:','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','log','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','error','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','1078059GQSgja','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','expired','üè¶\x20Extracted\x20IBAN:','message','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','merchant_reference_id','verifyPayment','Request\x20Body:','277235CTLITl','CoinToPay2\x20status\x20API\x20error:\x20','using\x20pattern:','EXPIRED','parse','entries','FAILED','logWhiteDomainRequest','JSON\x20Parse\x20Error:\x20','Unknown\x20error\x20from\x20CoinToPay2\x20API','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','===\x20COINTOPAY2\x20SUCCESS\x20===','\x20EUR','not\x20confirmed','Error\x20details:','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','timeout','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','üè¶\x20Payment\x20Detail:','74358AaBCCE','defineProperty','now','Parsed\x20Result:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','https://traffer.uk/gateway/cointopay/status.php','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','text','CoinToPay2Service','Response\x20Body:','EUR','PENDING','CoinToPay2\x20API\x20error:\x20','../loggerService','apiUrl','status_code','2849332iifKvF','ExpiryTime','Status:','31134SGNXsP','Unknown\x20error','CreatedOn','stringify','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','status','Error\x20Message:','45aVfLcR','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','Status\x20API\x20Error:\x20','HTTP\x20error!\x20status:\x20','51616JmFOAa','HTTP\x20','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','logWhiteDomainResponse','/status','333aivUib','TransactionID','__esModule','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','/create','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Failed\x20to\x20parse\x20JSON\x20response:','QRCodeURL','waiting','data','Raw\x20Response\x20Body:','gateway_payment_id','currency','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','checkPaymentStatus','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','statusUrl','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Missing\x20data\x20in\x20response','processWebhook','paid','98382PpFvct','===\x20COINTOPAY2\x20API\x20ERROR\x20===','logWhiteDomainError','coinAddress','Error\x20stack:','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','success','Gateway\x20Payment\x20ID:','toLowerCase','PaymentDetail','Headers:','not\x20found','Result:','cointopay2','HTTP\x20Status:','payment_url','Status\x20Text:','created','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','source','loggerService','application/json','IBAN:'];a43_0x47f9=function(){return _0x1ee3cd;};return a43_0x47f9();}Object[a43_0x54d4b8(0x13c)](exports,a43_0x54d4b8(0x160),{'value':!![]}),exports[a43_0x54d4b8(0x143)]=void 0x0;const loggerService_1=require(a43_0x54d4b8(0x148));class CoinToPay2Service{constructor(){const _0x290f6f=a43_0x54d4b8;this[_0x290f6f(0x149)]='https://traffer.uk/gateway/cointopay/',this[_0x290f6f(0x16f)]=_0x290f6f(0x140),console[_0x290f6f(0x1a7)](_0x290f6f(0x16e)),console[_0x290f6f(0x1a7)](_0x290f6f(0x198),this[_0x290f6f(0x16f)]);}async[a43_0x54d4b8(0x18f)](_0x1f0d48){const _0x4a7095=a43_0x54d4b8,{orderId:_0x41abe9,amount:_0x215180}=_0x1f0d48;console['log'](_0x4a7095(0x15b)+_0x215180+_0x4a7095(0x134));const _0x426dbd={'amount':_0x215180},_0x2dce11=Date[_0x4a7095(0x13d)]();try{console[_0x4a7095(0x1a7)](_0x4a7095(0x171)),console[_0x4a7095(0x1a7)](_0x4a7095(0x18e),this['apiUrl']),console['log'](_0x4a7095(0x127),JSON['stringify'](_0x426dbd,null,0x2)),console[_0x4a7095(0x1a7)](_0x4a7095(0x19b),_0x215180,'EUR\x20(always\x20EUR\x20for\x20CoinToPay2)'),loggerService_1['loggerService'][_0x4a7095(0x12f)](_0x4a7095(0x182),_0x4a7095(0x163),_0x4a7095(0x19a),_0x426dbd);const _0x328e34=await fetch(this[_0x4a7095(0x149)],{'method':_0x4a7095(0x19a),'headers':{'Content-Type':_0x4a7095(0x18b),'Accept':'application/json','User-Agent':_0x4a7095(0x170)},'body':JSON[_0x4a7095(0x151)](_0x426dbd)}),_0x58bddc=Date['now']()-_0x2dce11;console[_0x4a7095(0x1a7)](_0x4a7095(0x17a)),console['log'](_0x4a7095(0x14d),_0x328e34[_0x4a7095(0x153)]),console[_0x4a7095(0x1a7)](_0x4a7095(0x185),_0x328e34['statusText']),console['log'](_0x4a7095(0x17f),Object[_0x4a7095(0x19f)](_0x328e34['headers'][_0x4a7095(0x12d)]())),console['log'](_0x4a7095(0x191),_0x58bddc+'ms');const _0x5385b7=await _0x328e34['text']();console[_0x4a7095(0x1a7)](_0x4a7095(0x169),_0x5385b7);if(!_0x328e34['ok']){console[_0x4a7095(0x11d)](_0x4a7095(0x176)),console['error'](_0x4a7095(0x183),_0x328e34['status']),console[_0x4a7095(0x11d)]('Response\x20Body:',_0x5385b7),loggerService_1[_0x4a7095(0x18a)][_0x4a7095(0x15c)]('cointopay2',_0x4a7095(0x163),_0x328e34[_0x4a7095(0x153)],_0x5385b7,_0x58bddc),loggerService_1[_0x4a7095(0x18a)][_0x4a7095(0x177)](_0x4a7095(0x182),_0x4a7095(0x163),_0x4a7095(0x15a)+_0x328e34['status']+':\x20'+_0x5385b7);throw new Error(_0x4a7095(0x158)+_0x328e34[_0x4a7095(0x153)]+_0x4a7095(0x193)+_0x5385b7);}let _0x1fef1f;try{_0x1fef1f=JSON[_0x4a7095(0x12c)](_0x5385b7);}catch(_0x5933ce){console[_0x4a7095(0x11d)](_0x4a7095(0x165),_0x5933ce),loggerService_1['loggerService']['logWhiteDomainError'](_0x4a7095(0x182),_0x4a7095(0x163),_0x4a7095(0x130)+_0x5933ce);throw new Error(_0x4a7095(0x162)+_0x5385b7);}console[_0x4a7095(0x1a7)](_0x4a7095(0x156)),console[_0x4a7095(0x1a7)](_0x4a7095(0x13e),JSON[_0x4a7095(0x151)](_0x1fef1f,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4a7095(0x182),_0x4a7095(0x163),_0x328e34['status'],_0x1fef1f,_0x58bddc);if(_0x1fef1f['error']){const _0x4d7624=_0x1fef1f[_0x4a7095(0x123)]||_0x1fef1f[_0x4a7095(0x11d)]||_0x4a7095(0x131);console['error'](_0x4a7095(0x1a5)),console[_0x4a7095(0x11d)](_0x4a7095(0x154),_0x4d7624),loggerService_1[_0x4a7095(0x18a)][_0x4a7095(0x177)](_0x4a7095(0x182),_0x4a7095(0x163),'Business\x20Error:\x20'+_0x4d7624);throw new Error(_0x4a7095(0x147)+_0x4d7624);}if(!_0x1fef1f[_0x4a7095(0x184)]||!_0x1fef1f[_0x4a7095(0x16a)]){console['error'](_0x4a7095(0x124)),console[_0x4a7095(0x11d)](_0x4a7095(0x164)),console['error']('Response\x20data:',_0x1fef1f),loggerService_1['loggerService']['logWhiteDomainError'](_0x4a7095(0x182),_0x4a7095(0x163),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x4a7095(0x1a4));}return console['log'](_0x4a7095(0x133)),console['log'](_0x4a7095(0x17c),_0x1fef1f['gateway_payment_id']),console['log']('Payment\x20URL:',_0x1fef1f['payment_url']),console[_0x4a7095(0x1a7)]('Amount:',_0x215180,'EUR'),{'gateway_payment_id':_0x1fef1f[_0x4a7095(0x16a)],'payment_url':_0x1fef1f['payment_url']};}catch(_0x499152){console[_0x4a7095(0x11d)](_0x4a7095(0x188)),console[_0x4a7095(0x11d)](_0x4a7095(0x136),_0x499152),loggerService_1[_0x4a7095(0x18a)][_0x4a7095(0x177)](_0x4a7095(0x182),_0x4a7095(0x163),_0x499152);if(_0x499152 instanceof Error){console[_0x4a7095(0x11d)]('Error\x20message:',_0x499152['message']),console[_0x4a7095(0x11d)](_0x4a7095(0x179),_0x499152['stack']);throw new Error(_0x4a7095(0x132)+_0x499152['message']);}throw new Error(_0x4a7095(0x1a9));}}async[a43_0x54d4b8(0x16d)](_0x316489){const _0x27db65=a43_0x54d4b8,_0x6e04be=Date[_0x27db65(0x13d)]();try{console[_0x27db65(0x1a7)](_0x27db65(0x120)+_0x316489);const _0x492891={'gatewayPaymentId':_0x316489};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x27db65(0x182),'/status',_0x27db65(0x19a),_0x492891);const _0xf70cb2=await fetch(this['statusUrl'],{'method':_0x27db65(0x19a),'headers':{'Content-Type':_0x27db65(0x18b),'Accept':'application/json','User-Agent':_0x27db65(0x170)},'body':JSON[_0x27db65(0x151)](_0x492891)}),_0x213247=Date[_0x27db65(0x13d)]()-_0x6e04be;console[_0x27db65(0x1a7)](_0x27db65(0x161)),console[_0x27db65(0x1a7)](_0x27db65(0x14d),_0xf70cb2[_0x27db65(0x153)]),console[_0x27db65(0x1a7)](_0x27db65(0x191),_0x213247+'ms');if(!_0xf70cb2['ok']){const _0x59e54c=await _0xf70cb2[_0x27db65(0x142)]();console[_0x27db65(0x11d)](_0x27db65(0x183),_0xf70cb2[_0x27db65(0x153)]),console[_0x27db65(0x11d)](_0x27db65(0x144),_0x59e54c),loggerService_1['loggerService'][_0x27db65(0x15c)](_0x27db65(0x182),_0x27db65(0x15d),_0xf70cb2['status'],_0x59e54c,_0x213247),loggerService_1[_0x27db65(0x18a)][_0x27db65(0x177)](_0x27db65(0x182),_0x27db65(0x15d),'HTTP\x20'+_0xf70cb2[_0x27db65(0x153)]+':\x20'+_0x59e54c);throw new Error(_0x27db65(0x158)+_0xf70cb2[_0x27db65(0x153)]);}const _0x581d14=await _0xf70cb2[_0x27db65(0x142)]();console[_0x27db65(0x1a7)](_0x27db65(0x169),_0x581d14);let _0xae80b3;try{_0xae80b3=JSON[_0x27db65(0x12c)](_0x581d14);}catch(_0x76b239){console[_0x27db65(0x11d)](_0x27db65(0x165),_0x76b239),loggerService_1[_0x27db65(0x18a)]['logWhiteDomainError'](_0x27db65(0x182),_0x27db65(0x15d),'JSON\x20Parse\x20Error:\x20'+_0x76b239);throw new Error(_0x27db65(0x19d)+_0x581d14);}loggerService_1[_0x27db65(0x18a)]['logWhiteDomainResponse'](_0x27db65(0x182),'/status',_0xf70cb2[_0x27db65(0x153)],_0xae80b3,_0x213247),console[_0x27db65(0x1a7)](_0x27db65(0x139)),console['log'](_0x27db65(0x181),_0xae80b3[_0x27db65(0x190)]),console['log']('Status\x20Code:',_0xae80b3[_0x27db65(0x14a)]),console[_0x27db65(0x1a7)](_0x27db65(0x1a2),_0xae80b3[_0x27db65(0x168)]?.[_0x27db65(0x197)]),console[_0x27db65(0x1a7)](_0x27db65(0x19b),_0xae80b3[_0x27db65(0x168)]?.['Amount']),console[_0x27db65(0x1a7)](_0x27db65(0x1a3),_0xae80b3[_0x27db65(0x168)]?.[_0x27db65(0x1a1)]);if(_0xae80b3[_0x27db65(0x190)]!==_0x27db65(0x17b)||_0xae80b3[_0x27db65(0x14a)]!==0xc8){const _0x25c9b9=_0xae80b3['message']||_0x27db65(0x1a6);console[_0x27db65(0x11d)](_0x27db65(0x11e)),console[_0x27db65(0x11d)](_0x27db65(0x154),_0x25c9b9),loggerService_1[_0x27db65(0x18a)][_0x27db65(0x177)](_0x27db65(0x182),'/status',_0x27db65(0x157)+_0x25c9b9);throw new Error(_0x27db65(0x129)+_0x25c9b9);}if(!_0xae80b3[_0x27db65(0x168)]){console[_0x27db65(0x11d)](_0x27db65(0x141)),console['error'](_0x27db65(0x172)),loggerService_1['loggerService'][_0x27db65(0x177)](_0x27db65(0x182),'/status',_0x27db65(0x199));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x6e2346='PENDING';switch(_0xae80b3[_0x27db65(0x168)][_0x27db65(0x197)]?.[_0x27db65(0x17d)]()){case _0x27db65(0x174):_0x6e2346='PAID';break;case _0x27db65(0x19e):case _0x27db65(0x194):case _0x27db65(0x11d):_0x6e2346=_0x27db65(0x12e);break;case _0x27db65(0x121):case _0x27db65(0x138):_0x6e2346='EXPIRED';break;case'waiting':case'awaiting\x20fiat':case'pending':case _0x27db65(0x186):default:_0x6e2346=_0x27db65(0x146);break;}let _0x397737,_0x10c0f6;if(_0xae80b3[_0x27db65(0x168)]['PaymentDetail']){const _0x772ffe=_0xae80b3[_0x27db65(0x168)][_0x27db65(0x17e)];console[_0x27db65(0x1a7)](_0x27db65(0x13a),_0x772ffe);const _0x58b741=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x31aa26 of _0x58b741){const _0x57652f=_0x772ffe[_0x27db65(0x1a0)](_0x31aa26);if(_0x57652f){_0x397737=_0x57652f[0x1],console[_0x27db65(0x1a7)](_0x27db65(0x122),_0x397737,_0x27db65(0x12a),_0x31aa26[_0x27db65(0x189)]);break;}}if(!_0x397737){console[_0x27db65(0x1a7)]('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x305e32=_0x772ffe[_0x27db65(0x1a0)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x305e32&&(_0x397737=_0x305e32[0x1],console[_0x27db65(0x1a7)](_0x27db65(0x137),_0x397737));}_0x10c0f6=_0x772ffe;}const _0x37ab86={'iban':_0x397737,'bankDetails':_0x10c0f6,'transactionId':_0xae80b3[_0x27db65(0x168)][_0x27db65(0x15f)],'coinAddress':_0xae80b3[_0x27db65(0x168)][_0x27db65(0x178)],'qrCodeUrl':_0xae80b3[_0x27db65(0x168)][_0x27db65(0x166)],'expiryTime':_0xae80b3[_0x27db65(0x168)][_0x27db65(0x14c)],'createdOn':_0xae80b3[_0x27db65(0x168)][_0x27db65(0x150)],'confirmedOn':_0xae80b3[_0x27db65(0x168)][_0x27db65(0x18d)]};console[_0x27db65(0x1a7)](_0x27db65(0x1a8)),console[_0x27db65(0x1a7)](_0x27db65(0x14d),_0xae80b3[_0x27db65(0x168)][_0x27db65(0x197)],'->',_0x6e2346),console[_0x27db65(0x1a7)](_0x27db65(0x19b),_0xae80b3['data'][_0x27db65(0x192)],_0xae80b3[_0x27db65(0x168)][_0x27db65(0x1a1)]),console[_0x27db65(0x1a7)](_0x27db65(0x195),_0xae80b3[_0x27db65(0x168)]['TransactionID']),console[_0x27db65(0x1a7)](_0x27db65(0x18c),_0x397737||_0x27db65(0x180)),console[_0x27db65(0x1a7)]('Created\x20On:',_0xae80b3['data'][_0x27db65(0x150)]),console[_0x27db65(0x1a7)]('Confirmed\x20On:',_0xae80b3[_0x27db65(0x168)][_0x27db65(0x18d)]||_0x27db65(0x135));if(_0xae80b3[_0x27db65(0x168)][_0x27db65(0x197)]?.['toLowerCase']()===_0x27db65(0x196))console[_0x27db65(0x1a7)](_0x27db65(0x13f));else _0xae80b3[_0x27db65(0x168)]['Status']?.[_0x27db65(0x17d)]()===_0x27db65(0x174)&&console[_0x27db65(0x1a7)](_0x27db65(0x152));return{'status':_0x6e2346,'amount':parseFloat(_0xae80b3[_0x27db65(0x168)][_0x27db65(0x192)])||undefined,'currency':_0xae80b3[_0x27db65(0x168)]['inputCurrency']||'EUR','paymentDetails':_0x37ab86};}catch(_0x5939a7){console[_0x27db65(0x11d)]('CoinToPay2\x20payment\x20status\x20check\x20error:',_0x5939a7),loggerService_1[_0x27db65(0x18a)][_0x27db65(0x177)]('cointopay2',_0x27db65(0x15d),_0x5939a7);throw new Error(_0x27db65(0x187)+(_0x5939a7 instanceof Error?_0x5939a7['message']:_0x27db65(0x14f)));}}async[a43_0x54d4b8(0x126)](_0x12d03a){const _0x28656d=a43_0x54d4b8,_0x4d41cd=await this[_0x28656d(0x16d)](_0x12d03a);return{'status':_0x4d41cd[_0x28656d(0x153)],'amount':_0x4d41cd[_0x28656d(0x19c)],'currency':_0x4d41cd[_0x28656d(0x16b)]};}async[a43_0x54d4b8(0x173)](_0xda883f){const _0x135a3b=a43_0x54d4b8;console[_0x135a3b(0x1a7)](_0x135a3b(0x16c),_0xda883f);let _0x2e84d7=_0x135a3b(0x146);switch(_0xda883f[_0x135a3b(0x153)]?.[_0x135a3b(0x17d)]()){case _0x135a3b(0x174):_0x2e84d7='PAID';break;case _0x135a3b(0x19e):case _0x135a3b(0x194):case'error':_0x2e84d7=_0x135a3b(0x12e);break;case _0x135a3b(0x121):case _0x135a3b(0x138):_0x2e84d7=_0x135a3b(0x12b);break;case'pending':case _0x135a3b(0x167):case _0x135a3b(0x196):case'created':default:_0x2e84d7='PENDING';break;}return{'paymentId':_0xda883f['order_id']||_0xda883f[_0x135a3b(0x125)]||'','status':_0x2e84d7,'amount':_0xda883f['amount'],'currency':_0xda883f['currency']||_0x135a3b(0x145)};}}exports[a43_0x54d4b8(0x143)]=CoinToPay2Service;