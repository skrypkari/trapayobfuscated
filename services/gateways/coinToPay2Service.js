'use strict';const a45_0x54b7b2=a45_0x255c;function a45_0x255c(_0x591f28,_0x151c23){const _0x41b654=a45_0x41b6();return a45_0x255c=function(_0x255c2f,_0x200eda){_0x255c2f=_0x255c2f-0x95;let _0x36031b=_0x41b654[_0x255c2f];return _0x36031b;},a45_0x255c(_0x591f28,_0x151c23);}(function(_0xae9710,_0x459944){const _0x547cdc=a45_0x255c,_0x2cc350=_0xae9710();while(!![]){try{const _0x37efbd=-parseInt(_0x547cdc(0x111))/0x1*(-parseInt(_0x547cdc(0xe3))/0x2)+-parseInt(_0x547cdc(0xf4))/0x3+-parseInt(_0x547cdc(0x10d))/0x4+parseInt(_0x547cdc(0x11a))/0x5+parseInt(_0x547cdc(0xc7))/0x6+parseInt(_0x547cdc(0xc8))/0x7*(parseInt(_0x547cdc(0xba))/0x8)+parseInt(_0x547cdc(0x115))/0x9*(-parseInt(_0x547cdc(0x114))/0xa);if(_0x37efbd===_0x459944)break;else _0x2cc350['push'](_0x2cc350['shift']());}catch(_0x415692){_0x2cc350['push'](_0x2cc350['shift']());}}}(a45_0x41b6,0xd8d9e));Object[a45_0x54b7b2(0xd0)](exports,a45_0x54b7b2(0xff),{'value':!![]}),exports[a45_0x54b7b2(0xde)]=void 0x0;const loggerService_1=require(a45_0x54b7b2(0xe8));class CoinToPay2Service{constructor(){const _0x3ec43c=a45_0x54b7b2;this['apiUrl']=_0x3ec43c(0xfb),this[_0x3ec43c(0xe2)]=_0x3ec43c(0x102),console['log']('ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0x3ec43c(0x10f)](_0x3ec43c(0xc3),this[_0x3ec43c(0xe2)]);}async[a45_0x54b7b2(0xcf)](_0x3ff571){const _0x5ab958=a45_0x54b7b2,{orderId:_0x4766c5,amount:_0x229224}=_0x3ff571;console[_0x5ab958(0x10f)](_0x5ab958(0xd9)+_0x229224+_0x5ab958(0xc9));const _0x392210={'amount':_0x229224},_0x223ff9=Date[_0x5ab958(0x10b)]();try{console[_0x5ab958(0x10f)](_0x5ab958(0xfe)),console[_0x5ab958(0x10f)]('URL:',this[_0x5ab958(0x95)]),console[_0x5ab958(0x10f)](_0x5ab958(0xdb),JSON['stringify'](_0x392210,null,0x2)),console['log'](_0x5ab958(0x105),_0x229224,_0x5ab958(0xe7)),loggerService_1[_0x5ab958(0x103)][_0x5ab958(0xc4)](_0x5ab958(0xc0),_0x5ab958(0xd1),'POST',_0x392210);const _0x19f799=await fetch(this[_0x5ab958(0x95)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x5ab958(0xce),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x5ab958(0xe6)](_0x392210)}),_0xabca95=Date['now']()-_0x223ff9;console[_0x5ab958(0x10f)](_0x5ab958(0xae)),console[_0x5ab958(0x10f)](_0x5ab958(0x109),_0x19f799[_0x5ab958(0x11f)]),console[_0x5ab958(0x10f)](_0x5ab958(0x11d),_0x19f799[_0x5ab958(0xbb)]),console[_0x5ab958(0x10f)](_0x5ab958(0xcd),Object[_0x5ab958(0x11e)](_0x19f799[_0x5ab958(0xc1)][_0x5ab958(0xa6)]())),console[_0x5ab958(0x10f)](_0x5ab958(0xa1),_0xabca95+'ms');const _0x312e97=await _0x19f799[_0x5ab958(0xf7)]();console['log'](_0x5ab958(0xb7),_0x312e97);if(!_0x19f799['ok']){console[_0x5ab958(0xb6)](_0x5ab958(0x9d)),console['error'](_0x5ab958(0xbf),_0x19f799[_0x5ab958(0x11f)]),console[_0x5ab958(0xb6)](_0x5ab958(0x10a),_0x312e97),loggerService_1[_0x5ab958(0x103)][_0x5ab958(0xa0)]('cointopay2',_0x5ab958(0xd1),_0x19f799[_0x5ab958(0x11f)],_0x312e97,_0xabca95),loggerService_1['loggerService'][_0x5ab958(0x112)](_0x5ab958(0xc0),'/create',_0x5ab958(0x118)+_0x19f799[_0x5ab958(0x11f)]+':\x20'+_0x312e97);throw new Error(_0x5ab958(0xb5)+_0x19f799['status']+_0x5ab958(0xaa)+_0x312e97);}let _0x56506b;try{_0x56506b=JSON[_0x5ab958(0xf9)](_0x312e97);}catch(_0xdcae6d){console[_0x5ab958(0xb6)](_0x5ab958(0x96),_0xdcae6d),loggerService_1[_0x5ab958(0x103)][_0x5ab958(0x112)]('cointopay2','/create',_0x5ab958(0xb0)+_0xdcae6d);throw new Error(_0x5ab958(0xfa)+_0x312e97);}console[_0x5ab958(0x10f)](_0x5ab958(0xd8)),console[_0x5ab958(0x10f)](_0x5ab958(0xca),JSON[_0x5ab958(0xe6)](_0x56506b,null,0x2)),loggerService_1[_0x5ab958(0x103)][_0x5ab958(0xa0)](_0x5ab958(0xc0),'/create',_0x19f799[_0x5ab958(0x11f)],_0x56506b,_0xabca95);if(_0x56506b[_0x5ab958(0xb6)]){const _0x36188f=_0x56506b['message']||_0x56506b['error']||_0x5ab958(0x108);console[_0x5ab958(0xb6)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x5ab958(0xb6)]('Error\x20Message:',_0x36188f),loggerService_1[_0x5ab958(0x103)][_0x5ab958(0x112)](_0x5ab958(0xc0),_0x5ab958(0xd1),_0x5ab958(0xcc)+_0x36188f);throw new Error(_0x5ab958(0xd4)+_0x36188f);}if(!_0x56506b[_0x5ab958(0xf3)]||!_0x56506b[_0x5ab958(0xb8)]){console[_0x5ab958(0xb6)](_0x5ab958(0xe1)),console[_0x5ab958(0xb6)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x5ab958(0xb6)]('Response\x20data:',_0x56506b),loggerService_1[_0x5ab958(0x103)][_0x5ab958(0x112)](_0x5ab958(0xc0),_0x5ab958(0xd1),_0x5ab958(0xab));throw new Error(_0x5ab958(0xa9));}return console[_0x5ab958(0x10f)](_0x5ab958(0xec)),console[_0x5ab958(0x10f)](_0x5ab958(0xa7),_0x56506b[_0x5ab958(0xb8)]),console[_0x5ab958(0x10f)](_0x5ab958(0xfd),_0x56506b[_0x5ab958(0xf3)]),console[_0x5ab958(0x10f)]('Amount:',_0x229224,_0x5ab958(0x98)),{'gateway_payment_id':_0x56506b[_0x5ab958(0xb8)],'payment_url':_0x56506b[_0x5ab958(0xf3)]};}catch(_0x1fa3d2){console[_0x5ab958(0xb6)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x5ab958(0xb6)](_0x5ab958(0xc6),_0x1fa3d2),loggerService_1['loggerService'][_0x5ab958(0x112)]('cointopay2',_0x5ab958(0xd1),_0x1fa3d2);if(_0x1fa3d2 instanceof Error){console[_0x5ab958(0xb6)]('Error\x20message:',_0x1fa3d2['message']),console['error'](_0x5ab958(0xeb),_0x1fa3d2[_0x5ab958(0xee)]);throw new Error(_0x5ab958(0xdf)+_0x1fa3d2[_0x5ab958(0xad)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a45_0x54b7b2(0x104)](_0x3267ec){const _0x56c5ed=a45_0x54b7b2,_0x5a124c=Date[_0x56c5ed(0x10b)]();try{console[_0x56c5ed(0x10f)](_0x56c5ed(0xa8)+_0x3267ec);const _0x2cbc43={'gatewayPaymentId':_0x3267ec};loggerService_1[_0x56c5ed(0x103)]['logWhiteDomainRequest'](_0x56c5ed(0xc0),'/status',_0x56c5ed(0xd5),_0x2cbc43);const _0x27435f=await fetch(this[_0x56c5ed(0xe2)],{'method':_0x56c5ed(0xd5),'headers':{'Content-Type':_0x56c5ed(0xce),'Accept':_0x56c5ed(0xce),'User-Agent':_0x56c5ed(0xe4)},'body':JSON[_0x56c5ed(0xe6)](_0x2cbc43)}),_0x4d86d6=Date['now']()-_0x5a124c;console['log'](_0x56c5ed(0xef)),console['log'](_0x56c5ed(0x109),_0x27435f[_0x56c5ed(0x11f)]),console[_0x56c5ed(0x10f)](_0x56c5ed(0xa1),_0x4d86d6+'ms');if(!_0x27435f['ok']){const _0x3f1a8d=await _0x27435f[_0x56c5ed(0xf7)]();console['error'](_0x56c5ed(0xbf),_0x27435f['status']),console[_0x56c5ed(0xb6)](_0x56c5ed(0x10a),_0x3f1a8d),loggerService_1['loggerService'][_0x56c5ed(0xa0)](_0x56c5ed(0xc0),'/status',_0x27435f[_0x56c5ed(0x11f)],_0x3f1a8d,_0x4d86d6),loggerService_1[_0x56c5ed(0x103)][_0x56c5ed(0x112)](_0x56c5ed(0xc0),_0x56c5ed(0xd2),_0x56c5ed(0x118)+_0x27435f[_0x56c5ed(0x11f)]+':\x20'+_0x3f1a8d);throw new Error(_0x56c5ed(0xb5)+_0x27435f[_0x56c5ed(0x11f)]);}const _0x342d2e=await _0x27435f[_0x56c5ed(0xf7)]();console['log'](_0x56c5ed(0xb7),_0x342d2e);let _0x4406a0;try{_0x4406a0=JSON[_0x56c5ed(0xf9)](_0x342d2e);}catch(_0x505f3f){console[_0x56c5ed(0xb6)](_0x56c5ed(0x96),_0x505f3f),loggerService_1[_0x56c5ed(0x103)]['logWhiteDomainError'](_0x56c5ed(0xc0),'/status',_0x56c5ed(0xb0)+_0x505f3f);throw new Error(_0x56c5ed(0xda)+_0x342d2e);}loggerService_1[_0x56c5ed(0x103)]['logWhiteDomainResponse']('cointopay2',_0x56c5ed(0xd2),_0x27435f[_0x56c5ed(0x11f)],_0x4406a0,_0x4d86d6),console[_0x56c5ed(0x10f)](_0x56c5ed(0xa3)),console[_0x56c5ed(0x10f)](_0x56c5ed(0x9e),_0x4406a0['result']),console[_0x56c5ed(0x10f)](_0x56c5ed(0xf6),_0x4406a0[_0x56c5ed(0xf8)]),console[_0x56c5ed(0x10f)]('Payment\x20Status:',_0x4406a0[_0x56c5ed(0xaf)]?.['Status']),console[_0x56c5ed(0x10f)]('Amount:',_0x4406a0['data']?.[_0x56c5ed(0xe9)]),console[_0x56c5ed(0x10f)]('Currency:',_0x4406a0[_0x56c5ed(0xaf)]?.['inputCurrency']);if(_0x4406a0[_0x56c5ed(0x100)]!==_0x56c5ed(0xbe)||_0x4406a0[_0x56c5ed(0xf8)]!==0xc8){const _0xf792f1=_0x4406a0[_0x56c5ed(0xad)]||'Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API';console[_0x56c5ed(0xb6)]('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console[_0x56c5ed(0xb6)](_0x56c5ed(0x10c),_0xf792f1),loggerService_1[_0x56c5ed(0x103)][_0x56c5ed(0x112)](_0x56c5ed(0xc0),_0x56c5ed(0xd2),_0x56c5ed(0xb3)+_0xf792f1);throw new Error(_0x56c5ed(0xac)+_0xf792f1);}if(!_0x4406a0[_0x56c5ed(0xaf)]){console['error'](_0x56c5ed(0xd6)),console['error'](_0x56c5ed(0xea)),loggerService_1[_0x56c5ed(0x103)][_0x56c5ed(0x112)]('cointopay2','/status',_0x56c5ed(0x97));throw new Error(_0x56c5ed(0xa4));}let _0x2baf0c=_0x56c5ed(0xb9);switch(_0x4406a0[_0x56c5ed(0xaf)][_0x56c5ed(0xf2)]?.[_0x56c5ed(0x9f)]()){case _0x56c5ed(0xd3):_0x2baf0c='PAID';break;case _0x56c5ed(0xf5):case _0x56c5ed(0xb4):case'error':_0x2baf0c=_0x56c5ed(0x9a);break;case _0x56c5ed(0xdd):case'timeout':_0x2baf0c=_0x56c5ed(0xd7);break;case _0x56c5ed(0xe0):case _0x56c5ed(0xa2):case'pending':case _0x56c5ed(0xb1):default:_0x2baf0c=_0x56c5ed(0xb9);break;}let _0x93118c,_0x11e589;if(_0x4406a0[_0x56c5ed(0xaf)][_0x56c5ed(0xf0)]){const _0x25cc29=_0x4406a0['data'][_0x56c5ed(0xf0)];console[_0x56c5ed(0x10f)]('üè¶\x20Payment\x20Detail:',_0x25cc29);const _0x5536eb=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x2011d8 of _0x5536eb){const _0x2eeeb6=_0x25cc29['match'](_0x2011d8);if(_0x2eeeb6){_0x93118c=_0x2eeeb6[0x1],console[_0x56c5ed(0x10f)](_0x56c5ed(0x10e),_0x93118c,'using\x20pattern:',_0x2011d8[_0x56c5ed(0x11c)]);break;}}if(!_0x93118c){console['log'](_0x56c5ed(0xbd));const _0x365bb1=_0x25cc29['match'](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x365bb1&&(_0x93118c=_0x365bb1[0x1],console['log'](_0x56c5ed(0xed),_0x93118c));}_0x11e589=_0x25cc29;}const _0x9b1186={'iban':_0x93118c,'bankDetails':_0x11e589,'transactionId':_0x4406a0['data'][_0x56c5ed(0x9c)],'coinAddress':_0x4406a0[_0x56c5ed(0xaf)][_0x56c5ed(0x11b)],'qrCodeUrl':_0x4406a0[_0x56c5ed(0xaf)]['QRCodeURL'],'expiryTime':_0x4406a0['data']['ExpiryTime'],'createdOn':_0x4406a0[_0x56c5ed(0xaf)][_0x56c5ed(0x107)],'confirmedOn':_0x4406a0['data'][_0x56c5ed(0xf1)]};console['log'](_0x56c5ed(0xc2)),console[_0x56c5ed(0x10f)](_0x56c5ed(0x109),_0x4406a0[_0x56c5ed(0xaf)]['Status'],'->',_0x2baf0c),console['log'](_0x56c5ed(0x105),_0x4406a0[_0x56c5ed(0xaf)][_0x56c5ed(0xe9)],_0x4406a0[_0x56c5ed(0xaf)]['inputCurrency']),console[_0x56c5ed(0x10f)](_0x56c5ed(0x110),_0x4406a0['data'][_0x56c5ed(0x9c)]),console[_0x56c5ed(0x10f)](_0x56c5ed(0x101),_0x93118c||'not\x20found'),console['log']('Created\x20On:',_0x4406a0['data'][_0x56c5ed(0x107)]),console['log'](_0x56c5ed(0xfc),_0x4406a0['data'][_0x56c5ed(0xf1)]||_0x56c5ed(0xbc));if(_0x4406a0['data'][_0x56c5ed(0xf2)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x56c5ed(0x10f)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x4406a0[_0x56c5ed(0xaf)][_0x56c5ed(0xf2)]?.['toLowerCase']()===_0x56c5ed(0xd3)&&console[_0x56c5ed(0x10f)](_0x56c5ed(0xc5));return{'status':_0x2baf0c,'amount':parseFloat(_0x4406a0[_0x56c5ed(0xaf)][_0x56c5ed(0xe9)])||undefined,'currency':_0x4406a0[_0x56c5ed(0xaf)][_0x56c5ed(0x117)]||'EUR','paymentDetails':_0x9b1186};}catch(_0x1cf311){console[_0x56c5ed(0xb6)]('CoinToPay2\x20payment\x20status\x20check\x20error:',_0x1cf311),loggerService_1['loggerService'][_0x56c5ed(0x112)](_0x56c5ed(0xc0),_0x56c5ed(0xd2),_0x1cf311);throw new Error(_0x56c5ed(0x106)+(_0x1cf311 instanceof Error?_0x1cf311[_0x56c5ed(0xad)]:'Unknown\x20error'));}}async[a45_0x54b7b2(0x9b)](_0x5ad4fc){const _0x1752ae=a45_0x54b7b2,_0x1f0d0b=await this['checkPaymentStatus'](_0x5ad4fc);return{'status':_0x1f0d0b['status'],'amount':_0x1f0d0b[_0x1752ae(0x119)],'currency':_0x1f0d0b[_0x1752ae(0xb2)]};}async[a45_0x54b7b2(0x99)](_0x127c4c){const _0x62b853=a45_0x54b7b2;console['log'](_0x62b853(0x113),_0x127c4c);let _0x5f3ff2=_0x62b853(0xb9);switch(_0x127c4c[_0x62b853(0x11f)]?.[_0x62b853(0x9f)]()){case'paid':_0x5f3ff2=_0x62b853(0xdc);break;case _0x62b853(0xf5):case'failed':case _0x62b853(0xb6):_0x5f3ff2=_0x62b853(0x9a);break;case'expired':case _0x62b853(0xa5):_0x5f3ff2=_0x62b853(0xd7);break;case _0x62b853(0x116):case _0x62b853(0xe0):case'awaiting\x20fiat':case _0x62b853(0xb1):default:_0x5f3ff2='PENDING';break;}return{'paymentId':_0x127c4c[_0x62b853(0xe5)]||_0x127c4c[_0x62b853(0xcb)]||'','status':_0x5f3ff2,'amount':_0x127c4c[_0x62b853(0x119)],'currency':_0x127c4c['currency']||'EUR'};}}exports[a45_0x54b7b2(0xde)]=CoinToPay2Service;function a45_0x41b6(){const _0x2e79b9=['Payment\x20URL:','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','__esModule','result','IBAN:','https://traffer.uk/gateway/cointopay/status.php','loggerService','checkPaymentStatus','Amount:','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','CreatedOn','Unknown\x20error\x20from\x20CoinToPay2\x20API','Status:','Response\x20Body:','now','Error\x20Message:','1434260tcZaUz','üè¶\x20Extracted\x20IBAN:','log','Transaction\x20ID:','510947QpuAwu','logWhiteDomainError','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','6848090znupBT','9UVDlok','pending','inputCurrency','HTTP\x20','amount','6315qpZOrN','coinAddress','source','Status\x20Text:','fromEntries','status','apiUrl','Failed\x20to\x20parse\x20JSON\x20response:','Incomplete\x20response:\x20missing\x20data','EUR','processWebhook','FAILED','verifyPayment','TransactionID','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Result:','toLowerCase','logWhiteDomainResponse','Response\x20Time:','awaiting\x20fiat','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','timeout','entries','Gateway\x20Payment\x20ID:','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id',',\x20body:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','CoinToPay2\x20status\x20API\x20error:\x20','message','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','data','JSON\x20Parse\x20Error:\x20','created','currency','Status\x20API\x20Error:\x20','failed','HTTP\x20error!\x20status:\x20','error','Raw\x20Response\x20Body:','gateway_payment_id','PENDING','16024oaHgGg','statusText','not\x20confirmed','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','success','HTTP\x20Status:','cointopay2','headers','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','üìä\x20Status\x20check\x20URL:','logWhiteDomainRequest','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Error\x20details:','6989760Oflpfo','4634yeqTbu','\x20EUR','Parsed\x20Result:','merchant_reference_id','Business\x20Error:\x20','Headers:','application/json','createPaymentLink','defineProperty','/create','/status','paid','CoinToPay2\x20API\x20error:\x20','POST','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','EXPIRED','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','Request\x20Body:','PAID','expired','CoinToPay2Service','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','waiting','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','statusUrl','4cugxQb','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','order_id','stringify','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','../loggerService','Amount','Missing\x20data\x20in\x20response','Error\x20stack:','===\x20COINTOPAY2\x20SUCCESS\x20===','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','stack','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','PaymentDetail','TransactionConfirmedOn','Status','payment_url','4747521PNbQfJ','cancelled','Status\x20Code:','text','status_code','parse','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','https://traffer.uk/gateway/cointopay/','Confirmed\x20On:'];a45_0x41b6=function(){return _0x2e79b9;};return a45_0x41b6();}