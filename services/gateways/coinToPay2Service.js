'use strict';const a42_0x27b131=a42_0x2e8e;(function(_0x56d84a,_0x2f2488){const _0x568c68=a42_0x2e8e,_0xb3a13e=_0x56d84a();while(!![]){try{const _0xcb4b04=-parseInt(_0x568c68(0x121))/0x1*(parseInt(_0x568c68(0x15c))/0x2)+-parseInt(_0x568c68(0x101))/0x3*(-parseInt(_0x568c68(0x161))/0x4)+-parseInt(_0x568c68(0x14e))/0x5+-parseInt(_0x568c68(0x12b))/0x6+parseInt(_0x568c68(0x17c))/0x7*(parseInt(_0x568c68(0x18b))/0x8)+-parseInt(_0x568c68(0x165))/0x9*(-parseInt(_0x568c68(0x13d))/0xa)+-parseInt(_0x568c68(0x14d))/0xb*(-parseInt(_0x568c68(0x152))/0xc);if(_0xcb4b04===_0x2f2488)break;else _0xb3a13e['push'](_0xb3a13e['shift']());}catch(_0x17decc){_0xb3a13e['push'](_0xb3a13e['shift']());}}}(a42_0x2b4e,0x86979));Object[a42_0x27b131(0x18c)](exports,a42_0x27b131(0x15e),{'value':!![]}),exports[a42_0x27b131(0x108)]=void 0x0;function a42_0x2e8e(_0x40ab6c,_0x4413f9){const _0x2b4ee9=a42_0x2b4e();return a42_0x2e8e=function(_0x2e8eb1,_0x3cb959){_0x2e8eb1=_0x2e8eb1-0xfe;let _0x20ad21=_0x2b4ee9[_0x2e8eb1];return _0x20ad21;},a42_0x2e8e(_0x40ab6c,_0x4413f9);}const loggerService_1=require(a42_0x27b131(0x124));class CoinToPay2Service{constructor(){const _0x5e2d49=a42_0x27b131;this[_0x5e2d49(0x162)]=_0x5e2d49(0x11d),this[_0x5e2d49(0x128)]=_0x5e2d49(0x146),console[_0x5e2d49(0x14f)](_0x5e2d49(0x182)),console['log'](_0x5e2d49(0x17e),this[_0x5e2d49(0x128)]);}async[a42_0x27b131(0x186)](_0x15a2b3){const _0x251757=a42_0x27b131,{orderId:_0x1da321,amount:_0x117933}=_0x15a2b3;console[_0x251757(0x14f)](_0x251757(0x100)+_0x117933+_0x251757(0x140));const _0x241015={'amount':_0x117933},_0x5d5b54=Date[_0x251757(0x17b)]();try{console['log']('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console[_0x251757(0x14f)]('URL:',this[_0x251757(0x162)]),console['log'](_0x251757(0x142),JSON['stringify'](_0x241015,null,0x2)),console['log'](_0x251757(0x137),_0x117933,'EUR\x20(always\x20EUR\x20for\x20CoinToPay2)'),loggerService_1[_0x251757(0x163)][_0x251757(0x14b)](_0x251757(0x117),_0x251757(0x189),_0x251757(0x133),_0x241015);const _0x161fbd=await fetch(this[_0x251757(0x162)],{'method':_0x251757(0x133),'headers':{'Content-Type':'application/json','Accept':_0x251757(0x11e),'User-Agent':_0x251757(0x156)},'body':JSON[_0x251757(0x135)](_0x241015)}),_0xe72544=Date['now']()-_0x5d5b54;console['log'](_0x251757(0x116)),console[_0x251757(0x14f)]('Status:',_0x161fbd[_0x251757(0x17d)]),console['log'](_0x251757(0x144),_0x161fbd[_0x251757(0x112)]),console[_0x251757(0x14f)]('Headers:',Object[_0x251757(0x136)](_0x161fbd[_0x251757(0x159)][_0x251757(0x164)]())),console[_0x251757(0x14f)](_0x251757(0x141),_0xe72544+'ms');const _0x2e65b2=await _0x161fbd[_0x251757(0x155)]();console[_0x251757(0x14f)](_0x251757(0x13c),_0x2e65b2);if(!_0x161fbd['ok']){console['error'](_0x251757(0x15a)),console[_0x251757(0x16e)](_0x251757(0x18f),_0x161fbd[_0x251757(0x17d)]),console[_0x251757(0x16e)]('Response\x20Body:',_0x2e65b2),loggerService_1[_0x251757(0x163)][_0x251757(0x149)](_0x251757(0x117),_0x251757(0x189),_0x161fbd[_0x251757(0x17d)],_0x2e65b2,_0xe72544),loggerService_1['loggerService'][_0x251757(0x154)](_0x251757(0x117),_0x251757(0x189),'HTTP\x20'+_0x161fbd['status']+':\x20'+_0x2e65b2);throw new Error('HTTP\x20error!\x20status:\x20'+_0x161fbd[_0x251757(0x17d)]+_0x251757(0x173)+_0x2e65b2);}let _0x7928be;try{_0x7928be=JSON[_0x251757(0xfe)](_0x2e65b2);}catch(_0x1b1044){console[_0x251757(0x16e)](_0x251757(0x126),_0x1b1044),loggerService_1[_0x251757(0x163)]['logWhiteDomainError'](_0x251757(0x117),_0x251757(0x189),_0x251757(0x16f)+_0x1b1044);throw new Error(_0x251757(0x147)+_0x2e65b2);}console[_0x251757(0x14f)](_0x251757(0x123)),console[_0x251757(0x14f)](_0x251757(0x138),JSON[_0x251757(0x135)](_0x7928be,null,0x2)),loggerService_1['loggerService'][_0x251757(0x149)]('cointopay2','/create',_0x161fbd[_0x251757(0x17d)],_0x7928be,_0xe72544);if(_0x7928be['error']){const _0x48a5e9=_0x7928be[_0x251757(0x10f)]||_0x7928be[_0x251757(0x16e)]||_0x251757(0x177);console[_0x251757(0x16e)](_0x251757(0x113)),console[_0x251757(0x16e)](_0x251757(0x13b),_0x48a5e9),loggerService_1[_0x251757(0x163)][_0x251757(0x154)](_0x251757(0x117),_0x251757(0x189),_0x251757(0x109)+_0x48a5e9);throw new Error(_0x251757(0x120)+_0x48a5e9);}if(!_0x7928be[_0x251757(0x171)]||!_0x7928be[_0x251757(0x11a)]){console[_0x251757(0x16e)](_0x251757(0xff)),console[_0x251757(0x16e)](_0x251757(0x102)),console['error']('Response\x20data:',_0x7928be),loggerService_1[_0x251757(0x163)]['logWhiteDomainError'](_0x251757(0x117),'/create',_0x251757(0x14a));throw new Error(_0x251757(0x131));}return console[_0x251757(0x14f)](_0x251757(0x15d)),console['log']('Gateway\x20Payment\x20ID:',_0x7928be[_0x251757(0x11a)]),console[_0x251757(0x14f)](_0x251757(0x160),_0x7928be[_0x251757(0x171)]),console[_0x251757(0x14f)](_0x251757(0x137),_0x117933,_0x251757(0x104)),{'gateway_payment_id':_0x7928be['gateway_payment_id'],'payment_url':_0x7928be['payment_url']};}catch(_0x368e6f){console[_0x251757(0x16e)](_0x251757(0x139)),console['error'](_0x251757(0x184),_0x368e6f),loggerService_1[_0x251757(0x163)][_0x251757(0x154)](_0x251757(0x117),_0x251757(0x189),_0x368e6f);if(_0x368e6f instanceof Error){console[_0x251757(0x16e)]('Error\x20message:',_0x368e6f[_0x251757(0x10f)]),console[_0x251757(0x16e)](_0x251757(0x15b),_0x368e6f[_0x251757(0x16b)]);throw new Error(_0x251757(0x150)+_0x368e6f[_0x251757(0x10f)]);}throw new Error(_0x251757(0x16a));}}async[a42_0x27b131(0x12a)](_0x416ed8){const _0x9bada7=a42_0x27b131,_0x2bdc30=Date['now']();try{console[_0x9bada7(0x14f)](_0x9bada7(0x169)+_0x416ed8);const _0x4b3da5={'gatewayPaymentId':_0x416ed8};loggerService_1[_0x9bada7(0x163)][_0x9bada7(0x14b)](_0x9bada7(0x117),_0x9bada7(0x145),'POST',_0x4b3da5);const _0x2336c2=await fetch(this[_0x9bada7(0x128)],{'method':_0x9bada7(0x133),'headers':{'Content-Type':_0x9bada7(0x11e),'Accept':_0x9bada7(0x11e),'User-Agent':_0x9bada7(0x156)},'body':JSON[_0x9bada7(0x135)](_0x4b3da5)}),_0x257a38=Date[_0x9bada7(0x17b)]()-_0x2bdc30;console['log'](_0x9bada7(0x12f)),console[_0x9bada7(0x14f)](_0x9bada7(0x118),_0x2336c2[_0x9bada7(0x17d)]),console[_0x9bada7(0x14f)]('Response\x20Time:',_0x257a38+'ms');if(!_0x2336c2['ok']){const _0x3088b6=await _0x2336c2['text']();console[_0x9bada7(0x16e)](_0x9bada7(0x18f),_0x2336c2[_0x9bada7(0x17d)]),console['error'](_0x9bada7(0x158),_0x3088b6),loggerService_1['loggerService'][_0x9bada7(0x149)](_0x9bada7(0x117),_0x9bada7(0x145),_0x2336c2[_0x9bada7(0x17d)],_0x3088b6,_0x257a38),loggerService_1['loggerService'][_0x9bada7(0x154)]('cointopay2',_0x9bada7(0x145),_0x9bada7(0x174)+_0x2336c2[_0x9bada7(0x17d)]+':\x20'+_0x3088b6);throw new Error(_0x9bada7(0x11c)+_0x2336c2[_0x9bada7(0x17d)]);}const _0x2c79f4=await _0x2336c2[_0x9bada7(0x155)]();console['log'](_0x9bada7(0x13c),_0x2c79f4);let _0xb40d2d;try{_0xb40d2d=JSON[_0x9bada7(0xfe)](_0x2c79f4);}catch(_0x5dcfaa){console[_0x9bada7(0x16e)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5dcfaa),loggerService_1[_0x9bada7(0x163)][_0x9bada7(0x154)](_0x9bada7(0x117),_0x9bada7(0x145),_0x9bada7(0x16f)+_0x5dcfaa);throw new Error(_0x9bada7(0x110)+_0x2c79f4);}loggerService_1[_0x9bada7(0x163)][_0x9bada7(0x149)]('cointopay2',_0x9bada7(0x145),_0x2336c2[_0x9bada7(0x17d)],_0xb40d2d,_0x257a38),console[_0x9bada7(0x14f)](_0x9bada7(0x107)),console[_0x9bada7(0x14f)](_0x9bada7(0x127),_0xb40d2d[_0x9bada7(0x172)]),console[_0x9bada7(0x14f)](_0x9bada7(0x105),_0xb40d2d['status_code']),console[_0x9bada7(0x14f)](_0x9bada7(0x12c),_0xb40d2d[_0x9bada7(0x151)]?.[_0x9bada7(0x129)]),console[_0x9bada7(0x14f)](_0x9bada7(0x137),_0xb40d2d[_0x9bada7(0x151)]?.['Amount']),console[_0x9bada7(0x14f)](_0x9bada7(0x106),_0xb40d2d[_0x9bada7(0x151)]?.[_0x9bada7(0x122)]);if(_0xb40d2d[_0x9bada7(0x172)]!=='success'||_0xb40d2d[_0x9bada7(0x103)]!==0xc8){const _0x158d6e=_0xb40d2d[_0x9bada7(0x10f)]||_0x9bada7(0x13e);console['error'](_0x9bada7(0x12e)),console['error'](_0x9bada7(0x13b),_0x158d6e),loggerService_1['loggerService'][_0x9bada7(0x154)](_0x9bada7(0x117),_0x9bada7(0x145),'Status\x20API\x20Error:\x20'+_0x158d6e);throw new Error(_0x9bada7(0x175)+_0x158d6e);}if(!_0xb40d2d[_0x9bada7(0x151)]){console[_0x9bada7(0x16e)](_0x9bada7(0x10a)),console[_0x9bada7(0x16e)](_0x9bada7(0x10e)),loggerService_1[_0x9bada7(0x163)]['logWhiteDomainError'](_0x9bada7(0x117),'/status',_0x9bada7(0x11f));throw new Error(_0x9bada7(0x114));}let _0xb10ea1=_0x9bada7(0x14c);switch(_0xb40d2d[_0x9bada7(0x151)]['Status']?.[_0x9bada7(0x153)]()){case'paid':_0xb10ea1=_0x9bada7(0x187);break;case _0x9bada7(0x143):case _0x9bada7(0x181):case'error':_0xb10ea1=_0x9bada7(0x130);break;case _0x9bada7(0x183):case _0x9bada7(0x148):_0xb10ea1=_0x9bada7(0x176);break;case _0x9bada7(0x18d):case _0x9bada7(0x167):case _0x9bada7(0x188):case _0x9bada7(0x111):default:_0xb10ea1=_0x9bada7(0x14c);break;}let _0x253f25,_0x5890ab;if(_0xb40d2d['data'][_0x9bada7(0x157)]){const _0x4cebb5=_0xb40d2d[_0x9bada7(0x151)]['PaymentDetail'];console[_0x9bada7(0x14f)]('üè¶\x20Payment\x20Detail:',_0x4cebb5);const _0x5756ce=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x5f4d86 of _0x5756ce){const _0x2162f7=_0x4cebb5['match'](_0x5f4d86);if(_0x2162f7){_0x253f25=_0x2162f7[0x1],console[_0x9bada7(0x14f)](_0x9bada7(0x17a),_0x253f25,_0x9bada7(0x13a),_0x5f4d86[_0x9bada7(0x115)]);break;}}if(!_0x253f25){console[_0x9bada7(0x14f)]('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x2b6d13=_0x4cebb5['match'](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x2b6d13&&(_0x253f25=_0x2b6d13[0x1],console[_0x9bada7(0x14f)](_0x9bada7(0x15f),_0x253f25));}_0x5890ab=_0x4cebb5;}const _0x156d05={'iban':_0x253f25,'bankDetails':_0x5890ab,'transactionId':_0xb40d2d[_0x9bada7(0x151)]['TransactionID'],'coinAddress':_0xb40d2d[_0x9bada7(0x151)][_0x9bada7(0x179)],'qrCodeUrl':_0xb40d2d[_0x9bada7(0x151)][_0x9bada7(0x10b)],'expiryTime':_0xb40d2d['data'][_0x9bada7(0x185)],'createdOn':_0xb40d2d[_0x9bada7(0x151)]['CreatedOn'],'confirmedOn':_0xb40d2d[_0x9bada7(0x151)]['TransactionConfirmedOn']};console[_0x9bada7(0x14f)](_0x9bada7(0x125)),console[_0x9bada7(0x14f)](_0x9bada7(0x118),_0xb40d2d[_0x9bada7(0x151)]['Status'],'->',_0xb10ea1),console['log'](_0x9bada7(0x137),_0xb40d2d[_0x9bada7(0x151)][_0x9bada7(0x11b)],_0xb40d2d[_0x9bada7(0x151)][_0x9bada7(0x122)]),console[_0x9bada7(0x14f)](_0x9bada7(0x178),_0xb40d2d[_0x9bada7(0x151)][_0x9bada7(0x166)]),console[_0x9bada7(0x14f)](_0x9bada7(0x10c),_0x253f25||'not\x20found'),console[_0x9bada7(0x14f)](_0x9bada7(0x12d),_0xb40d2d[_0x9bada7(0x151)][_0x9bada7(0x119)]),console['log'](_0x9bada7(0x17f),_0xb40d2d[_0x9bada7(0x151)]['TransactionConfirmedOn']||_0x9bada7(0x170));if(_0xb40d2d[_0x9bada7(0x151)]['Status']?.[_0x9bada7(0x153)]()==='awaiting\x20fiat')console[_0x9bada7(0x14f)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0xb40d2d[_0x9bada7(0x151)][_0x9bada7(0x129)]?.['toLowerCase']()===_0x9bada7(0x16c)&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0xb10ea1,'amount':parseFloat(_0xb40d2d[_0x9bada7(0x151)][_0x9bada7(0x11b)])||undefined,'currency':_0xb40d2d['data'][_0x9bada7(0x122)]||_0x9bada7(0x104),'paymentDetails':_0x156d05};}catch(_0x592897){console[_0x9bada7(0x16e)](_0x9bada7(0x134),_0x592897),loggerService_1[_0x9bada7(0x163)][_0x9bada7(0x154)](_0x9bada7(0x117),_0x9bada7(0x145),_0x592897);throw new Error(_0x9bada7(0x132)+(_0x592897 instanceof Error?_0x592897['message']:_0x9bada7(0x18a)));}}async['verifyPayment'](_0x4eb277){const _0x2988f8=a42_0x27b131,_0x25859a=await this[_0x2988f8(0x12a)](_0x4eb277);return{'status':_0x25859a[_0x2988f8(0x17d)],'amount':_0x25859a[_0x2988f8(0x13f)],'currency':_0x25859a[_0x2988f8(0x16d)]};}async[a42_0x27b131(0x18e)](_0x59bbcd){const _0x540a7e=a42_0x27b131;console[_0x540a7e(0x14f)](_0x540a7e(0x168),_0x59bbcd);let _0x3b47c3=_0x540a7e(0x14c);switch(_0x59bbcd[_0x540a7e(0x17d)]?.[_0x540a7e(0x153)]()){case _0x540a7e(0x16c):_0x3b47c3=_0x540a7e(0x187);break;case _0x540a7e(0x143):case'failed':case _0x540a7e(0x16e):_0x3b47c3=_0x540a7e(0x130);break;case _0x540a7e(0x183):case _0x540a7e(0x148):_0x3b47c3=_0x540a7e(0x176);break;case _0x540a7e(0x188):case _0x540a7e(0x18d):case _0x540a7e(0x167):case _0x540a7e(0x111):default:_0x3b47c3=_0x540a7e(0x14c);break;}return{'paymentId':_0x59bbcd[_0x540a7e(0x10d)]||_0x59bbcd[_0x540a7e(0x180)]||'','status':_0x3b47c3,'amount':_0x59bbcd[_0x540a7e(0x13f)],'currency':_0x59bbcd[_0x540a7e(0x16d)]||_0x540a7e(0x104)};}}exports['CoinToPay2Service']=CoinToPay2Service;function a42_0x2b4e(){const _0x5105f0=['text','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','PaymentDetail','Response\x20Body:','headers','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Error\x20stack:','16394RzAUAn','===\x20COINTOPAY2\x20SUCCESS\x20===','__esModule','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','Payment\x20URL:','508aDLPxg','apiUrl','loggerService','entries','45HYmncE','TransactionID','awaiting\x20fiat','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','stack','paid','currency','error','JSON\x20Parse\x20Error:\x20','not\x20confirmed','payment_url','result',',\x20body:\x20','HTTP\x20','CoinToPay2\x20status\x20API\x20error:\x20','EXPIRED','Unknown\x20error\x20from\x20CoinToPay2\x20API','Transaction\x20ID:','coinAddress','üè¶\x20Extracted\x20IBAN:','now','7966SPCQom','status','üìä\x20Status\x20check\x20URL:','Confirmed\x20On:','merchant_reference_id','failed','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','expired','Error\x20details:','ExpiryTime','createPaymentLink','PAID','pending','/create','Unknown\x20error','4568XeNiUy','defineProperty','waiting','processWebhook','HTTP\x20Status:','parse','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','13383BtdypL','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','status_code','EUR','Status\x20Code:','Currency:','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','CoinToPay2Service','Business\x20Error:\x20','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','QRCodeURL','IBAN:','order_id','Missing\x20data\x20in\x20response','message','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','created','statusText','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','source','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','cointopay2','Status:','CreatedOn','gateway_payment_id','Amount','HTTP\x20error!\x20status:\x20','https://traffer.uk/gateway/cointopay/','application/json','Incomplete\x20response:\x20missing\x20data','CoinToPay2\x20API\x20error:\x20','113yfpvpl','inputCurrency','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','../loggerService','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','Failed\x20to\x20parse\x20JSON\x20response:','Result:','statusUrl','Status','checkPaymentStatus','6437808iVHKtT','Payment\x20Status:','Created\x20On:','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','FAILED','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','POST','CoinToPay2\x20payment\x20status\x20check\x20error:','stringify','fromEntries','Amount:','Parsed\x20Result:','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','using\x20pattern:','Error\x20Message:','Raw\x20Response\x20Body:','626830tzXbrc','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','amount','\x20EUR','Response\x20Time:','Request\x20Body:','cancelled','Status\x20Text:','/status','https://traffer.uk/gateway/cointopay/status.php','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','timeout','logWhiteDomainResponse','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','logWhiteDomainRequest','PENDING','22TTVRLh','4322480hcbsnO','log','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','data','11311524eoAeNh','toLowerCase','logWhiteDomainError'];a42_0x2b4e=function(){return _0x5105f0;};return a42_0x2b4e();}