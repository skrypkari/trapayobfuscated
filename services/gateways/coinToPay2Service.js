'use strict';function a45_0x4a64(){const _0x33b6e7=['cointopay2','apiUrl','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error\x20from\x20CoinToPay2\x20API','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','stringify','defineProperty','order_id','pending','375980NicRFd','Payment\x20URL:','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','JSON\x20Parse\x20Error:\x20','timeout','https://traffer.uk/gateway/cointopay/','error','HTTP\x20error!\x20status:\x20','../loggerService','PaymentDetail','HTTP\x20Status:','status_code','expired','amount','Amount:','üìä\x20Status\x20check\x20URL:','Response\x20Time:','data','paid','HTTP\x20','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','using\x20pattern:','Confirmed\x20On:','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20details:','QRCodeURL','FAILED','Raw\x20Response\x20Body:','Transaction\x20ID:','7hwbEmu','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Response\x20data:','5694HTUZwX','üè¶\x20Extracted\x20IBAN:','Unknown\x20error','===\x20COINTOPAY2\x20SUCCESS\x20===','toLowerCase','CoinToPay2\x20payment\x20status\x20check\x20error:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','log','CreatedOn','URL:',',\x20body:\x20','1879524bAwGJS','===\x20COINTOPAY2\x20API\x20ERROR\x20===','/status','result','logWhiteDomainError','message','entries','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','createPaymentLink','PAID','3ClzqHJ','445nsMDvy','Incomplete\x20response:\x20missing\x20data','Error\x20stack:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','logWhiteDomainResponse','success','Error\x20message:','stack','CoinToPay2\x20status\x20API\x20error:\x20','PENDING','statusUrl','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','payment_url','fromEntries','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','Payment\x20Status:','CoinToPay2Service','now','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Amount','not\x20found','status','Status','headers','Response\x20Body:','failed','Parsed\x20Result:','match','POST','merchant_reference_id','coinAddress','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','209910uThPiL','2221440SdXxYE','text','EXPIRED','source','EUR','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','Missing\x20data\x20in\x20response','1345544lbSdYh','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','\x20EUR','loggerService','statusText','parse','Status\x20Text:','application/json','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','Result:','Headers:','waiting','__esModule','Status\x20API\x20Error:\x20','logWhiteDomainRequest','/create','Status:','awaiting\x20fiat','Error\x20Message:','inputCurrency','Request\x20Body:','gateway_payment_id','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','TransactionID','124414zvBbCC'];a45_0x4a64=function(){return _0x33b6e7;};return a45_0x4a64();}const a45_0x288b69=a45_0x43b6;(function(_0x26d8a5,_0x10e245){const _0x3cda05=a45_0x43b6,_0x5223f9=_0x26d8a5();while(!![]){try{const _0xad6567=-parseInt(_0x3cda05(0xcb))/0x1+parseInt(_0x3cda05(0xaa))/0x2*(parseInt(_0x3cda05(0x89))/0x3)+-parseInt(_0x3cda05(0xd5))/0x4+-parseInt(_0x3cda05(0x8a))/0x5*(-parseInt(_0x3cda05(0xf5))/0x6)+-parseInt(_0x3cda05(0xf2))/0x7*(-parseInt(_0x3cda05(0xb2))/0x8)+parseInt(_0x3cda05(0x7f))/0x9+-parseInt(_0x3cda05(0xab))/0xa;if(_0xad6567===_0x10e245)break;else _0x5223f9['push'](_0x5223f9['shift']());}catch(_0xa140b){_0x5223f9['push'](_0x5223f9['shift']());}}}(a45_0x4a64,0x1ebc4));Object[a45_0x288b69(0xd2)](exports,a45_0x288b69(0xbe),{'value':!![]}),exports[a45_0x288b69(0x9a)]=void 0x0;function a45_0x43b6(_0x530abc,_0xd8a8fb){const _0x4a6436=a45_0x4a64();return a45_0x43b6=function(_0x43b62e,_0x316821){_0x43b62e=_0x43b62e-0x7b;let _0x3ca31d=_0x4a6436[_0x43b62e];return _0x3ca31d;},a45_0x43b6(_0x530abc,_0xd8a8fb);}const loggerService_1=require(a45_0x288b69(0xdd));class CoinToPay2Service{constructor(){const _0x417799=a45_0x288b69;this[_0x417799(0xcd)]=_0x417799(0xda),this[_0x417799(0x94)]='https://traffer.uk/gateway/cointopay/status.php',console['log']('ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0x417799(0x7b)](_0x417799(0xe4),this['statusUrl']);}async[a45_0x288b69(0x87)](_0xc47c96){const _0x44f42e=a45_0x288b69,{orderId:_0x4e09a4,amount:_0x1905b6}=_0xc47c96;console[_0x44f42e(0x7b)](_0x44f42e(0xc8)+_0x1905b6+_0x44f42e(0xb4));const _0x249e22={'amount':_0x1905b6},_0xf9643f=Date['now']();try{console[_0x44f42e(0x7b)](_0x44f42e(0x86)),console[_0x44f42e(0x7b)](_0x44f42e(0x7d),this['apiUrl']),console['log'](_0x44f42e(0xc6),JSON[_0x44f42e(0xd1)](_0x249e22,null,0x2)),console[_0x44f42e(0x7b)](_0x44f42e(0xe3),_0x1905b6,_0x44f42e(0xb3)),loggerService_1[_0x44f42e(0xb5)][_0x44f42e(0xc0)](_0x44f42e(0xcc),'/create',_0x44f42e(0xa6),_0x249e22);const _0x14cb81=await fetch(this[_0x44f42e(0xcd)],{'method':_0x44f42e(0xa6),'headers':{'Content-Type':_0x44f42e(0xb9),'Accept':_0x44f42e(0xb9),'User-Agent':_0x44f42e(0xb0)},'body':JSON[_0x44f42e(0xd1)](_0x249e22)}),_0x52a0a8=Date['now']()-_0xf9643f;console[_0x44f42e(0x7b)]('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console[_0x44f42e(0x7b)](_0x44f42e(0xc2),_0x14cb81[_0x44f42e(0x9f)]),console[_0x44f42e(0x7b)](_0x44f42e(0xb8),_0x14cb81[_0x44f42e(0xb6)]),console['log'](_0x44f42e(0xbc),Object[_0x44f42e(0x97)](_0x14cb81[_0x44f42e(0xa1)][_0x44f42e(0x85)]())),console[_0x44f42e(0x7b)](_0x44f42e(0xe5),_0x52a0a8+'ms');const _0x5585bd=await _0x14cb81[_0x44f42e(0xac)]();console[_0x44f42e(0x7b)](_0x44f42e(0xf0),_0x5585bd);if(!_0x14cb81['ok']){console['error'](_0x44f42e(0x80)),console[_0x44f42e(0xdb)](_0x44f42e(0xdf),_0x14cb81[_0x44f42e(0x9f)]),console[_0x44f42e(0xdb)](_0x44f42e(0xa2),_0x5585bd),loggerService_1[_0x44f42e(0xb5)][_0x44f42e(0x8e)](_0x44f42e(0xcc),_0x44f42e(0xc1),_0x14cb81[_0x44f42e(0x9f)],_0x5585bd,_0x52a0a8),loggerService_1['loggerService'][_0x44f42e(0x83)]('cointopay2','/create',_0x44f42e(0xe8)+_0x14cb81[_0x44f42e(0x9f)]+':\x20'+_0x5585bd);throw new Error(_0x44f42e(0xdc)+_0x14cb81[_0x44f42e(0x9f)]+_0x44f42e(0x7e)+_0x5585bd);}let _0x2ff602;try{_0x2ff602=JSON['parse'](_0x5585bd);}catch(_0x35e7d4){console[_0x44f42e(0xdb)](_0x44f42e(0xec),_0x35e7d4),loggerService_1[_0x44f42e(0xb5)]['logWhiteDomainError'](_0x44f42e(0xcc),_0x44f42e(0xc1),_0x44f42e(0xd8)+_0x35e7d4);throw new Error(_0x44f42e(0x98)+_0x5585bd);}console[_0x44f42e(0x7b)]('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console[_0x44f42e(0x7b)](_0x44f42e(0xa4),JSON[_0x44f42e(0xd1)](_0x2ff602,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x44f42e(0xcc),_0x44f42e(0xc1),_0x14cb81['status'],_0x2ff602,_0x52a0a8);if(_0x2ff602[_0x44f42e(0xdb)]){const _0x1154ad=_0x2ff602[_0x44f42e(0x84)]||_0x2ff602[_0x44f42e(0xdb)]||_0x44f42e(0xcf);console['error'](_0x44f42e(0xba)),console[_0x44f42e(0xdb)](_0x44f42e(0xc4),_0x1154ad),loggerService_1[_0x44f42e(0xb5)][_0x44f42e(0x83)]('cointopay2','/create','Business\x20Error:\x20'+_0x1154ad);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x1154ad);}if(!_0x2ff602[_0x44f42e(0x96)]||!_0x2ff602[_0x44f42e(0xc7)]){console[_0x44f42e(0xdb)]('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x44f42e(0xdb)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error'](_0x44f42e(0xf4),_0x2ff602),loggerService_1['loggerService']['logWhiteDomainError'](_0x44f42e(0xcc),_0x44f42e(0xc1),_0x44f42e(0xf3));throw new Error(_0x44f42e(0xc9));}return console['log'](_0x44f42e(0xf8)),console[_0x44f42e(0x7b)]('Gateway\x20Payment\x20ID:',_0x2ff602[_0x44f42e(0xc7)]),console['log'](_0x44f42e(0xd6),_0x2ff602['payment_url']),console[_0x44f42e(0x7b)](_0x44f42e(0xe3),_0x1905b6,_0x44f42e(0xaf)),{'gateway_payment_id':_0x2ff602[_0x44f42e(0xc7)],'payment_url':_0x2ff602['payment_url']};}catch(_0x3a0eae){console[_0x44f42e(0xdb)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x44f42e(0xdb)](_0x44f42e(0xed),_0x3a0eae),loggerService_1['loggerService'][_0x44f42e(0x83)](_0x44f42e(0xcc),_0x44f42e(0xc1),_0x3a0eae);if(_0x3a0eae instanceof Error){console[_0x44f42e(0xdb)](_0x44f42e(0x90),_0x3a0eae[_0x44f42e(0x84)]),console[_0x44f42e(0xdb)](_0x44f42e(0x8c),_0x3a0eae[_0x44f42e(0x91)]);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x3a0eae[_0x44f42e(0x84)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x1137f5){const _0x3010bd=a45_0x288b69,_0x32ffae=Date['now']();try{console[_0x3010bd(0x7b)](_0x3010bd(0x95)+_0x1137f5);const _0x3b7273={'gatewayPaymentId':_0x1137f5};loggerService_1['loggerService'][_0x3010bd(0xc0)](_0x3010bd(0xcc),_0x3010bd(0x81),'POST',_0x3b7273);const _0x519a6c=await fetch(this['statusUrl'],{'method':_0x3010bd(0xa6),'headers':{'Content-Type':_0x3010bd(0xb9),'Accept':_0x3010bd(0xb9),'User-Agent':_0x3010bd(0xb0)},'body':JSON[_0x3010bd(0xd1)](_0x3b7273)}),_0x43af8e=Date[_0x3010bd(0x9b)]()-_0x32ffae;console[_0x3010bd(0x7b)](_0x3010bd(0xfc)),console[_0x3010bd(0x7b)](_0x3010bd(0xc2),_0x519a6c[_0x3010bd(0x9f)]),console[_0x3010bd(0x7b)](_0x3010bd(0xe5),_0x43af8e+'ms');if(!_0x519a6c['ok']){const _0x1d4018=await _0x519a6c[_0x3010bd(0xac)]();console['error'](_0x3010bd(0xdf),_0x519a6c[_0x3010bd(0x9f)]),console[_0x3010bd(0xdb)](_0x3010bd(0xa2),_0x1d4018),loggerService_1['loggerService'][_0x3010bd(0x8e)](_0x3010bd(0xcc),_0x3010bd(0x81),_0x519a6c[_0x3010bd(0x9f)],_0x1d4018,_0x43af8e),loggerService_1[_0x3010bd(0xb5)][_0x3010bd(0x83)](_0x3010bd(0xcc),_0x3010bd(0x81),_0x3010bd(0xe8)+_0x519a6c[_0x3010bd(0x9f)]+':\x20'+_0x1d4018);throw new Error(_0x3010bd(0xdc)+_0x519a6c[_0x3010bd(0x9f)]);}const _0x518567=await _0x519a6c['text']();console[_0x3010bd(0x7b)](_0x3010bd(0xf0),_0x518567);let _0x477341;try{_0x477341=JSON[_0x3010bd(0xb7)](_0x518567);}catch(_0x56c539){console[_0x3010bd(0xdb)](_0x3010bd(0xec),_0x56c539),loggerService_1[_0x3010bd(0xb5)]['logWhiteDomainError']('cointopay2',_0x3010bd(0x81),_0x3010bd(0xd8)+_0x56c539);throw new Error(_0x3010bd(0xfb)+_0x518567);}loggerService_1[_0x3010bd(0xb5)][_0x3010bd(0x8e)](_0x3010bd(0xcc),_0x3010bd(0x81),_0x519a6c[_0x3010bd(0x9f)],_0x477341,_0x43af8e),console['log'](_0x3010bd(0xe9)),console[_0x3010bd(0x7b)](_0x3010bd(0xbb),_0x477341[_0x3010bd(0x82)]),console['log']('Status\x20Code:',_0x477341['status_code']),console[_0x3010bd(0x7b)](_0x3010bd(0x99),_0x477341['data']?.[_0x3010bd(0xa0)]),console[_0x3010bd(0x7b)](_0x3010bd(0xe3),_0x477341[_0x3010bd(0xe6)]?.[_0x3010bd(0x9d)]),console[_0x3010bd(0x7b)]('Currency:',_0x477341[_0x3010bd(0xe6)]?.['inputCurrency']);if(_0x477341[_0x3010bd(0x82)]!==_0x3010bd(0x8f)||_0x477341[_0x3010bd(0xe0)]!==0xc8){const _0x44ccb6=_0x477341[_0x3010bd(0x84)]||_0x3010bd(0x9c);console[_0x3010bd(0xdb)]('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console[_0x3010bd(0xdb)]('Error\x20Message:',_0x44ccb6),loggerService_1[_0x3010bd(0xb5)]['logWhiteDomainError']('cointopay2','/status',_0x3010bd(0xbf)+_0x44ccb6);throw new Error(_0x3010bd(0x92)+_0x44ccb6);}if(!_0x477341[_0x3010bd(0xe6)]){console[_0x3010bd(0xdb)](_0x3010bd(0xce)),console[_0x3010bd(0xdb)](_0x3010bd(0xb1)),loggerService_1[_0x3010bd(0xb5)][_0x3010bd(0x83)](_0x3010bd(0xcc),'/status',_0x3010bd(0x8b));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x35bca9='PENDING';switch(_0x477341['data'][_0x3010bd(0xa0)]?.['toLowerCase']()){case _0x3010bd(0xe7):_0x35bca9='PAID';break;case'cancelled':case _0x3010bd(0xa3):case'error':_0x35bca9=_0x3010bd(0xef);break;case'expired':case'timeout':_0x35bca9='EXPIRED';break;case _0x3010bd(0xbd):case _0x3010bd(0xc3):case _0x3010bd(0xd4):case'created':default:_0x35bca9=_0x3010bd(0x93);break;}let _0x23c665,_0x45cac1;if(_0x477341[_0x3010bd(0xe6)][_0x3010bd(0xde)]){const _0x399395=_0x477341[_0x3010bd(0xe6)][_0x3010bd(0xde)];console['log']('üè¶\x20Payment\x20Detail:',_0x399395);const _0x3e33e4=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x25b9c8 of _0x3e33e4){const _0x9dad97=_0x399395[_0x3010bd(0xa5)](_0x25b9c8);if(_0x9dad97){_0x23c665=_0x9dad97[0x1],console['log'](_0x3010bd(0xf6),_0x23c665,_0x3010bd(0xea),_0x25b9c8[_0x3010bd(0xae)]);break;}}if(!_0x23c665){console[_0x3010bd(0x7b)]('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x274e08=_0x399395[_0x3010bd(0xa5)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x274e08&&(_0x23c665=_0x274e08[0x1],console[_0x3010bd(0x7b)](_0x3010bd(0xa9),_0x23c665));}_0x45cac1=_0x399395;}const _0x39b4cd={'iban':_0x23c665,'bankDetails':_0x45cac1,'transactionId':_0x477341[_0x3010bd(0xe6)][_0x3010bd(0xca)],'coinAddress':_0x477341[_0x3010bd(0xe6)][_0x3010bd(0xa8)],'qrCodeUrl':_0x477341[_0x3010bd(0xe6)][_0x3010bd(0xee)],'expiryTime':_0x477341[_0x3010bd(0xe6)]['ExpiryTime'],'createdOn':_0x477341[_0x3010bd(0xe6)][_0x3010bd(0x7c)],'confirmedOn':_0x477341[_0x3010bd(0xe6)]['TransactionConfirmedOn']};console['log'](_0x3010bd(0xd0)),console[_0x3010bd(0x7b)](_0x3010bd(0xc2),_0x477341[_0x3010bd(0xe6)][_0x3010bd(0xa0)],'->',_0x35bca9),console['log'](_0x3010bd(0xe3),_0x477341[_0x3010bd(0xe6)][_0x3010bd(0x9d)],_0x477341['data'][_0x3010bd(0xc5)]),console[_0x3010bd(0x7b)](_0x3010bd(0xf1),_0x477341['data']['TransactionID']),console[_0x3010bd(0x7b)]('IBAN:',_0x23c665||_0x3010bd(0x9e)),console[_0x3010bd(0x7b)]('Created\x20On:',_0x477341[_0x3010bd(0xe6)][_0x3010bd(0x7c)]),console['log'](_0x3010bd(0xeb),_0x477341[_0x3010bd(0xe6)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x477341[_0x3010bd(0xe6)][_0x3010bd(0xa0)]?.[_0x3010bd(0xf9)]()==='awaiting\x20fiat')console[_0x3010bd(0x7b)](_0x3010bd(0x8d));else _0x477341['data']['Status']?.[_0x3010bd(0xf9)]()===_0x3010bd(0xe7)&&console[_0x3010bd(0x7b)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x35bca9,'amount':parseFloat(_0x477341[_0x3010bd(0xe6)][_0x3010bd(0x9d)])||undefined,'currency':_0x477341[_0x3010bd(0xe6)][_0x3010bd(0xc5)]||_0x3010bd(0xaf),'paymentDetails':_0x39b4cd};}catch(_0x201de1){console[_0x3010bd(0xdb)](_0x3010bd(0xfa),_0x201de1),loggerService_1[_0x3010bd(0xb5)]['logWhiteDomainError'](_0x3010bd(0xcc),_0x3010bd(0x81),_0x201de1);throw new Error('Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20'+(_0x201de1 instanceof Error?_0x201de1['message']:_0x3010bd(0xf7)));}}async['verifyPayment'](_0x256a3c){const _0x51592b=a45_0x288b69,_0x493c79=await this['checkPaymentStatus'](_0x256a3c);return{'status':_0x493c79['status'],'amount':_0x493c79[_0x51592b(0xe2)],'currency':_0x493c79['currency']};}async['processWebhook'](_0x3f2425){const _0x954e28=a45_0x288b69;console[_0x954e28(0x7b)](_0x954e28(0xd7),_0x3f2425);let _0x2dcf99='PENDING';switch(_0x3f2425[_0x954e28(0x9f)]?.[_0x954e28(0xf9)]()){case'paid':_0x2dcf99=_0x954e28(0x88);break;case'cancelled':case _0x954e28(0xa3):case _0x954e28(0xdb):_0x2dcf99=_0x954e28(0xef);break;case _0x954e28(0xe1):case _0x954e28(0xd9):_0x2dcf99=_0x954e28(0xad);break;case _0x954e28(0xd4):case _0x954e28(0xbd):case'awaiting\x20fiat':case'created':default:_0x2dcf99='PENDING';break;}return{'paymentId':_0x3f2425[_0x954e28(0xd3)]||_0x3f2425[_0x954e28(0xa7)]||'','status':_0x2dcf99,'amount':_0x3f2425[_0x954e28(0xe2)],'currency':_0x3f2425['currency']||_0x954e28(0xaf)};}}exports[a45_0x288b69(0x9a)]=CoinToPay2Service;