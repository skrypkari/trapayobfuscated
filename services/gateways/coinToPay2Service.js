'use strict';function a42_0x38a4(_0x34e6b4,_0x44bae4){const _0x4e82f8=a42_0x4e82();return a42_0x38a4=function(_0x38a4f6,_0x4e4a18){_0x38a4f6=_0x38a4f6-0x130;let _0x53fe70=_0x4e82f8[_0x38a4f6];return _0x53fe70;},a42_0x38a4(_0x34e6b4,_0x44bae4);}const a42_0x1d9f4a=a42_0x38a4;(function(_0x213328,_0x2a117a){const _0x111946=a42_0x38a4,_0x3cf28d=_0x213328();while(!![]){try{const _0x37c8ec=parseInt(_0x111946(0x138))/0x1*(parseInt(_0x111946(0x18a))/0x2)+-parseInt(_0x111946(0x163))/0x3*(-parseInt(_0x111946(0x1bc))/0x4)+-parseInt(_0x111946(0x155))/0x5+-parseInt(_0x111946(0x172))/0x6*(-parseInt(_0x111946(0x194))/0x7)+parseInt(_0x111946(0x134))/0x8+parseInt(_0x111946(0x1be))/0x9+parseInt(_0x111946(0x177))/0xa*(-parseInt(_0x111946(0x1a2))/0xb);if(_0x37c8ec===_0x2a117a)break;else _0x3cf28d['push'](_0x3cf28d['shift']());}catch(_0x59c9af){_0x3cf28d['push'](_0x3cf28d['shift']());}}}(a42_0x4e82,0x7b56d));Object[a42_0x1d9f4a(0x190)](exports,a42_0x1d9f4a(0x13d),{'value':!![]}),exports[a42_0x1d9f4a(0x185)]=void 0x0;const loggerService_1=require(a42_0x1d9f4a(0x139));class CoinToPay2Service{constructor(){const _0xb5d96c=a42_0x1d9f4a;this['apiUrl']=_0xb5d96c(0x19e),this['statusUrl']=_0xb5d96c(0x188),console[_0xb5d96c(0x1bd)]('ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0xb5d96c(0x1bd)](_0xb5d96c(0x15a),this['statusUrl']);}async[a42_0x1d9f4a(0x1bf)](_0x5d28e5){const _0x184424=a42_0x1d9f4a,{orderId:_0xc56384,amount:_0x20beae}=_0x5d28e5;console[_0x184424(0x1bd)](_0x184424(0x166)+_0x20beae+_0x184424(0x19d));const _0xb27c7f={'amount':_0x20beae},_0x17dab8=Date[_0x184424(0x151)]();try{console[_0x184424(0x1bd)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console[_0x184424(0x1bd)](_0x184424(0x16d),this[_0x184424(0x137)]),console['log']('Request\x20Body:',JSON[_0x184424(0x173)](_0xb27c7f,null,0x2)),console['log'](_0x184424(0x135),_0x20beae,'EUR\x20(always\x20EUR\x20for\x20CoinToPay2)'),loggerService_1[_0x184424(0x16c)][_0x184424(0x14a)](_0x184424(0x13e),'/create',_0x184424(0x160),_0xb27c7f);const _0x1f932d=await fetch(this[_0x184424(0x137)],{'method':_0x184424(0x160),'headers':{'Content-Type':_0x184424(0x196),'Accept':_0x184424(0x196),'User-Agent':_0x184424(0x164)},'body':JSON[_0x184424(0x173)](_0xb27c7f)}),_0x16f7ea=Date['now']()-_0x17dab8;console[_0x184424(0x1bd)](_0x184424(0x17b)),console[_0x184424(0x1bd)](_0x184424(0x19f),_0x1f932d[_0x184424(0x1b6)]),console[_0x184424(0x1bd)](_0x184424(0x1a9),_0x1f932d[_0x184424(0x1a6)]),console[_0x184424(0x1bd)]('Headers:',Object[_0x184424(0x1b7)](_0x1f932d['headers'][_0x184424(0x15f)]())),console[_0x184424(0x1bd)](_0x184424(0x159),_0x16f7ea+'ms');const _0x3a5a99=await _0x1f932d[_0x184424(0x19a)]();console[_0x184424(0x1bd)](_0x184424(0x14d),_0x3a5a99);if(!_0x1f932d['ok']){console['error'](_0x184424(0x1bb)),console[_0x184424(0x149)]('HTTP\x20Status:',_0x1f932d[_0x184424(0x1b6)]),console[_0x184424(0x149)](_0x184424(0x17d),_0x3a5a99),loggerService_1[_0x184424(0x16c)]['logWhiteDomainResponse'](_0x184424(0x13e),_0x184424(0x1b4),_0x1f932d[_0x184424(0x1b6)],_0x3a5a99,_0x16f7ea),loggerService_1['loggerService'][_0x184424(0x19b)](_0x184424(0x13e),_0x184424(0x1b4),_0x184424(0x13c)+_0x1f932d[_0x184424(0x1b6)]+':\x20'+_0x3a5a99);throw new Error(_0x184424(0x18e)+_0x1f932d[_0x184424(0x1b6)]+_0x184424(0x18b)+_0x3a5a99);}let _0x520080;try{_0x520080=JSON[_0x184424(0x146)](_0x3a5a99);}catch(_0x556ec0){console[_0x184424(0x149)](_0x184424(0x136),_0x556ec0),loggerService_1[_0x184424(0x16c)][_0x184424(0x19b)](_0x184424(0x13e),_0x184424(0x1b4),_0x184424(0x1ae)+_0x556ec0);throw new Error(_0x184424(0x17e)+_0x3a5a99);}console['log']('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console[_0x184424(0x1bd)](_0x184424(0x1a5),JSON[_0x184424(0x173)](_0x520080,null,0x2)),loggerService_1['loggerService'][_0x184424(0x1ad)]('cointopay2',_0x184424(0x1b4),_0x1f932d[_0x184424(0x1b6)],_0x520080,_0x16f7ea);if(_0x520080[_0x184424(0x149)]){const _0x340534=_0x520080[_0x184424(0x18d)]||_0x520080[_0x184424(0x149)]||_0x184424(0x1a3);console[_0x184424(0x149)](_0x184424(0x158)),console[_0x184424(0x149)](_0x184424(0x162),_0x340534),loggerService_1[_0x184424(0x16c)]['logWhiteDomainError'](_0x184424(0x13e),_0x184424(0x1b4),'Business\x20Error:\x20'+_0x340534);throw new Error(_0x184424(0x15e)+_0x340534);}if(!_0x520080[_0x184424(0x16a)]||!_0x520080[_0x184424(0x132)]){console[_0x184424(0x149)](_0x184424(0x16f)),console[_0x184424(0x149)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x184424(0x149)](_0x184424(0x174),_0x520080),loggerService_1[_0x184424(0x16c)][_0x184424(0x19b)](_0x184424(0x13e),'/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x184424(0x1a1));}return console[_0x184424(0x1bd)](_0x184424(0x1b0)),console[_0x184424(0x1bd)](_0x184424(0x157),_0x520080[_0x184424(0x132)]),console['log']('Payment\x20URL:',_0x520080[_0x184424(0x16a)]),console['log']('Amount:',_0x20beae,_0x184424(0x14f)),{'gateway_payment_id':_0x520080[_0x184424(0x132)],'payment_url':_0x520080[_0x184424(0x16a)]};}catch(_0x35a54c){console[_0x184424(0x149)](_0x184424(0x17c)),console[_0x184424(0x149)](_0x184424(0x19c),_0x35a54c),loggerService_1['loggerService'][_0x184424(0x19b)](_0x184424(0x13e),'/create',_0x35a54c);if(_0x35a54c instanceof Error){console[_0x184424(0x149)]('Error\x20message:',_0x35a54c[_0x184424(0x18d)]),console[_0x184424(0x149)](_0x184424(0x171),_0x35a54c[_0x184424(0x14c)]);throw new Error(_0x184424(0x1a0)+_0x35a54c[_0x184424(0x18d)]);}throw new Error(_0x184424(0x1b5));}}async[a42_0x1d9f4a(0x13a)](_0x53ca53){const _0x49748c=a42_0x1d9f4a,_0x12a595=Date[_0x49748c(0x151)]();try{console[_0x49748c(0x1bd)](_0x49748c(0x13b)+_0x53ca53);const _0x386c68={'gatewayPaymentId':_0x53ca53};loggerService_1[_0x49748c(0x16c)][_0x49748c(0x14a)](_0x49748c(0x13e),_0x49748c(0x1ac),'POST',_0x386c68);const _0x584dfd=await fetch(this[_0x49748c(0x1a8)],{'method':_0x49748c(0x160),'headers':{'Content-Type':_0x49748c(0x196),'Accept':_0x49748c(0x196),'User-Agent':_0x49748c(0x164)},'body':JSON[_0x49748c(0x173)](_0x386c68)}),_0x20ee7c=Date['now']()-_0x12a595;console[_0x49748c(0x1bd)](_0x49748c(0x197)),console[_0x49748c(0x1bd)](_0x49748c(0x19f),_0x584dfd[_0x49748c(0x1b6)]),console[_0x49748c(0x1bd)](_0x49748c(0x159),_0x20ee7c+'ms');if(!_0x584dfd['ok']){const _0x499d88=await _0x584dfd[_0x49748c(0x19a)]();console[_0x49748c(0x149)](_0x49748c(0x18f),_0x584dfd[_0x49748c(0x1b6)]),console['error'](_0x49748c(0x17d),_0x499d88),loggerService_1[_0x49748c(0x16c)][_0x49748c(0x1ad)](_0x49748c(0x13e),_0x49748c(0x1ac),_0x584dfd[_0x49748c(0x1b6)],_0x499d88,_0x20ee7c),loggerService_1['loggerService'][_0x49748c(0x19b)](_0x49748c(0x13e),_0x49748c(0x1ac),_0x49748c(0x13c)+_0x584dfd[_0x49748c(0x1b6)]+':\x20'+_0x499d88);throw new Error(_0x49748c(0x18e)+_0x584dfd[_0x49748c(0x1b6)]);}const _0x327893=await _0x584dfd[_0x49748c(0x19a)]();console[_0x49748c(0x1bd)]('Raw\x20Response\x20Body:',_0x327893);let _0x19a736;try{_0x19a736=JSON[_0x49748c(0x146)](_0x327893);}catch(_0x145801){console[_0x49748c(0x149)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x145801),loggerService_1[_0x49748c(0x16c)][_0x49748c(0x19b)]('cointopay2',_0x49748c(0x1ac),_0x49748c(0x1ae)+_0x145801);throw new Error(_0x49748c(0x15d)+_0x327893);}loggerService_1[_0x49748c(0x16c)][_0x49748c(0x1ad)](_0x49748c(0x13e),'/status',_0x584dfd[_0x49748c(0x1b6)],_0x19a736,_0x20ee7c),console[_0x49748c(0x1bd)](_0x49748c(0x154)),console[_0x49748c(0x1bd)](_0x49748c(0x186),_0x19a736[_0x49748c(0x1b9)]),console[_0x49748c(0x1bd)](_0x49748c(0x179),_0x19a736['status_code']),console[_0x49748c(0x1bd)](_0x49748c(0x150),_0x19a736[_0x49748c(0x176)]?.[_0x49748c(0x14b)]),console['log']('Amount:',_0x19a736[_0x49748c(0x176)]?.[_0x49748c(0x14e)]),console[_0x49748c(0x1bd)](_0x49748c(0x175),_0x19a736[_0x49748c(0x176)]?.[_0x49748c(0x141)]);if(_0x19a736[_0x49748c(0x1b9)]!==_0x49748c(0x184)||_0x19a736[_0x49748c(0x1aa)]!==0xc8){const _0x27eec0=_0x19a736['message']||'Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API';console['error'](_0x49748c(0x1b8)),console[_0x49748c(0x149)](_0x49748c(0x162),_0x27eec0),loggerService_1[_0x49748c(0x16c)][_0x49748c(0x19b)](_0x49748c(0x13e),'/status',_0x49748c(0x189)+_0x27eec0);throw new Error(_0x49748c(0x193)+_0x27eec0);}if(!_0x19a736[_0x49748c(0x176)]){console['error'](_0x49748c(0x198)),console[_0x49748c(0x149)](_0x49748c(0x1af)),loggerService_1[_0x49748c(0x16c)][_0x49748c(0x19b)](_0x49748c(0x13e),_0x49748c(0x1ac),_0x49748c(0x1ba));throw new Error(_0x49748c(0x182));}let _0x571870=_0x49748c(0x140);switch(_0x19a736['data'][_0x49748c(0x14b)]?.['toLowerCase']()){case _0x49748c(0x152):_0x571870='PAID';break;case _0x49748c(0x178):case'failed':case'error':_0x571870=_0x49748c(0x153);break;case'expired':case _0x49748c(0x142):_0x571870=_0x49748c(0x133);break;case'waiting':case _0x49748c(0x167):case _0x49748c(0x156):case _0x49748c(0x1a7):default:_0x571870=_0x49748c(0x140);break;}let _0x5223e4,_0x2d8cdd;if(_0x19a736['data'][_0x49748c(0x130)]){const _0x2923cf=_0x19a736['data'][_0x49748c(0x130)];console[_0x49748c(0x1bd)](_0x49748c(0x169),_0x2923cf);const _0x1118e4=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x2079d1 of _0x1118e4){const _0x1f2b41=_0x2923cf[_0x49748c(0x165)](_0x2079d1);if(_0x1f2b41){_0x5223e4=_0x1f2b41[0x1],console['log'](_0x49748c(0x187),_0x5223e4,'using\x20pattern:',_0x2079d1[_0x49748c(0x16e)]);break;}}if(!_0x5223e4){console[_0x49748c(0x1bd)]('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x3c2f9d=_0x2923cf[_0x49748c(0x165)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x3c2f9d&&(_0x5223e4=_0x3c2f9d[0x1],console[_0x49748c(0x1bd)](_0x49748c(0x195),_0x5223e4));}_0x2d8cdd=_0x2923cf;}const _0x5cb4b7={'iban':_0x5223e4,'bankDetails':_0x2d8cdd,'transactionId':_0x19a736[_0x49748c(0x176)][_0x49748c(0x17f)],'coinAddress':_0x19a736['data'][_0x49748c(0x148)],'qrCodeUrl':_0x19a736[_0x49748c(0x176)][_0x49748c(0x199)],'expiryTime':_0x19a736[_0x49748c(0x176)][_0x49748c(0x168)],'createdOn':_0x19a736['data']['CreatedOn'],'confirmedOn':_0x19a736[_0x49748c(0x176)]['TransactionConfirmedOn']};console['log']('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console[_0x49748c(0x1bd)](_0x49748c(0x19f),_0x19a736[_0x49748c(0x176)][_0x49748c(0x14b)],'->',_0x571870),console[_0x49748c(0x1bd)](_0x49748c(0x135),_0x19a736['data'][_0x49748c(0x14e)],_0x19a736['data'][_0x49748c(0x141)]),console['log'](_0x49748c(0x15b),_0x19a736[_0x49748c(0x176)][_0x49748c(0x17f)]),console[_0x49748c(0x1bd)](_0x49748c(0x161),_0x5223e4||_0x49748c(0x1a4)),console['log'](_0x49748c(0x17a),_0x19a736[_0x49748c(0x176)]['CreatedOn']),console[_0x49748c(0x1bd)](_0x49748c(0x15c),_0x19a736[_0x49748c(0x176)][_0x49748c(0x144)]||_0x49748c(0x16b));if(_0x19a736[_0x49748c(0x176)][_0x49748c(0x14b)]?.['toLowerCase']()===_0x49748c(0x167))console['log'](_0x49748c(0x181));else _0x19a736[_0x49748c(0x176)][_0x49748c(0x14b)]?.[_0x49748c(0x131)]()==='paid'&&console[_0x49748c(0x1bd)](_0x49748c(0x192));return{'status':_0x571870,'amount':parseFloat(_0x19a736[_0x49748c(0x176)][_0x49748c(0x14e)])||undefined,'currency':_0x19a736[_0x49748c(0x176)][_0x49748c(0x141)]||'EUR','paymentDetails':_0x5cb4b7};}catch(_0x4ad8ce){console[_0x49748c(0x149)](_0x49748c(0x13f),_0x4ad8ce),loggerService_1['loggerService'][_0x49748c(0x19b)](_0x49748c(0x13e),_0x49748c(0x1ac),_0x4ad8ce);throw new Error(_0x49748c(0x145)+(_0x4ad8ce instanceof Error?_0x4ad8ce['message']:_0x49748c(0x183)));}}async[a42_0x1d9f4a(0x180)](_0x146f54){const _0x11ca2b=a42_0x1d9f4a,_0x138c23=await this[_0x11ca2b(0x13a)](_0x146f54);return{'status':_0x138c23['status'],'amount':_0x138c23[_0x11ca2b(0x1ab)],'currency':_0x138c23[_0x11ca2b(0x191)]};}async[a42_0x1d9f4a(0x170)](_0x1d8798){const _0x20970c=a42_0x1d9f4a;console[_0x20970c(0x1bd)](_0x20970c(0x1b3),_0x1d8798);let _0xc0c467='PENDING';switch(_0x1d8798[_0x20970c(0x1b6)]?.[_0x20970c(0x131)]()){case _0x20970c(0x152):_0xc0c467=_0x20970c(0x143);break;case _0x20970c(0x178):case _0x20970c(0x147):case _0x20970c(0x149):_0xc0c467=_0x20970c(0x153);break;case _0x20970c(0x1b2):case _0x20970c(0x142):_0xc0c467='EXPIRED';break;case _0x20970c(0x156):case _0x20970c(0x18c):case _0x20970c(0x167):case _0x20970c(0x1a7):default:_0xc0c467=_0x20970c(0x140);break;}return{'paymentId':_0x1d8798['order_id']||_0x1d8798[_0x20970c(0x1b1)]||'','status':_0xc0c467,'amount':_0x1d8798[_0x20970c(0x1ab)],'currency':_0x1d8798[_0x20970c(0x191)]||_0x20970c(0x14f)};}}function a42_0x4e82(){const _0xd44365=['loggerService','URL:','source','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','processWebhook','Error\x20stack:','1902wXlyjo','stringify','Response\x20data:','Currency:','data','10LRuClt','cancelled','Status\x20Code:','Created\x20On:','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','Response\x20Body:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','TransactionID','verifyPayment','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','Unknown\x20error','success','CoinToPay2Service','Result:','üè¶\x20Extracted\x20IBAN:','https://traffer.uk/gateway/cointopay/status.php','Status\x20API\x20Error:\x20','373366XUWHxJ',',\x20body:\x20','waiting','message','HTTP\x20error!\x20status:\x20','HTTP\x20Status:','defineProperty','currency','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','CoinToPay2\x20status\x20API\x20error:\x20','13944ypIMmo','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','application/json','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','QRCodeURL','text','logWhiteDomainError','Error\x20details:','\x20EUR','https://traffer.uk/gateway/cointopay/','Status:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','12414919tMAxky','Unknown\x20error\x20from\x20CoinToPay2\x20API','not\x20found','Parsed\x20Result:','statusText','created','statusUrl','Status\x20Text:','status_code','amount','/status','logWhiteDomainResponse','JSON\x20Parse\x20Error:\x20','Missing\x20data\x20in\x20response','===\x20COINTOPAY2\x20SUCCESS\x20===','merchant_reference_id','expired','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','/create','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','status','fromEntries','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','result','Incomplete\x20response:\x20missing\x20data','===\x20COINTOPAY2\x20API\x20ERROR\x20===','773020aPnAjM','log','6643809MLuCjL','createPaymentLink','PaymentDetail','toLowerCase','gateway_payment_id','EXPIRED','1494720pYDyfx','Amount:','Failed\x20to\x20parse\x20JSON\x20response:','apiUrl','2wODqfj','../loggerService','checkPaymentStatus','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','HTTP\x20','__esModule','cointopay2','CoinToPay2\x20payment\x20status\x20check\x20error:','PENDING','inputCurrency','timeout','PAID','TransactionConfirmedOn','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','parse','failed','coinAddress','error','logWhiteDomainRequest','Status','stack','Raw\x20Response\x20Body:','Amount','EUR','Payment\x20Status:','now','paid','FAILED','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','2446500pLKjtM','pending','Gateway\x20Payment\x20ID:','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','Response\x20Time:','üìä\x20Status\x20check\x20URL:','Transaction\x20ID:','Confirmed\x20On:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','CoinToPay2\x20API\x20error:\x20','entries','POST','IBAN:','Error\x20Message:','3yjZXmp','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','match','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','awaiting\x20fiat','ExpiryTime','üè¶\x20Payment\x20Detail:','payment_url','not\x20confirmed'];a42_0x4e82=function(){return _0xd44365;};return a42_0x4e82();}exports['CoinToPay2Service']=CoinToPay2Service;