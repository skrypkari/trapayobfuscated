'use strict';const a64_0x396f74=a64_0x18d6;(function(_0x3a01eb,_0x3bb658){const _0x27a348=a64_0x18d6,_0x2ebfe1=_0x3a01eb();while(!![]){try{const _0x1caca4=parseInt(_0x27a348(0x160))/0x1*(-parseInt(_0x27a348(0x1b6))/0x2)+parseInt(_0x27a348(0x199))/0x3*(parseInt(_0x27a348(0x163))/0x4)+-parseInt(_0x27a348(0x19c))/0x5+parseInt(_0x27a348(0x1aa))/0x6*(parseInt(_0x27a348(0x1c3))/0x7)+-parseInt(_0x27a348(0x162))/0x8*(parseInt(_0x27a348(0x174))/0x9)+-parseInt(_0x27a348(0x177))/0xa+parseInt(_0x27a348(0x1ad))/0xb;if(_0x1caca4===_0x3bb658)break;else _0x2ebfe1['push'](_0x2ebfe1['shift']());}catch(_0x5462db){_0x2ebfe1['push'](_0x2ebfe1['shift']());}}}(a64_0x3266,0x6b8fd));Object[a64_0x396f74(0x19d)](exports,a64_0x396f74(0x1a8),{'value':!![]}),exports['CoinToPay2Service']=void 0x0;const loggerService_1=require(a64_0x396f74(0x19a));class CoinToPay2Service{constructor(){const _0x5ccc7b=a64_0x396f74;this[_0x5ccc7b(0x1c7)]=_0x5ccc7b(0x1d0),this[_0x5ccc7b(0x1a6)]=_0x5ccc7b(0x1d9),console[_0x5ccc7b(0x196)](_0x5ccc7b(0x175)),console[_0x5ccc7b(0x196)](_0x5ccc7b(0x1ac),this[_0x5ccc7b(0x1a6)]);}async['createPaymentLink'](_0x55ed4f){const _0x20ed37=a64_0x396f74,{orderId:_0x423d47,amount:_0x3ba1eb}=_0x55ed4f;console[_0x20ed37(0x196)](_0x20ed37(0x1a9)+_0x3ba1eb+_0x20ed37(0x164));const _0x35819d={'amount':_0x3ba1eb},_0x1ef423=Date[_0x20ed37(0x1c5)]();try{console[_0x20ed37(0x196)](_0x20ed37(0x176)),console[_0x20ed37(0x196)](_0x20ed37(0x19e),this[_0x20ed37(0x1c7)]),console[_0x20ed37(0x196)](_0x20ed37(0x17d),JSON['stringify'](_0x35819d,null,0x2)),console[_0x20ed37(0x196)](_0x20ed37(0x1d2),_0x3ba1eb,_0x20ed37(0x188)),loggerService_1['loggerService'][_0x20ed37(0x15f)](_0x20ed37(0x19f),_0x20ed37(0x19b),'POST',_0x35819d);const _0x255401=await fetch(this[_0x20ed37(0x1c7)],{'method':'POST','headers':{'Content-Type':_0x20ed37(0x198),'Accept':'application/json','User-Agent':_0x20ed37(0x1c2)},'body':JSON[_0x20ed37(0x18a)](_0x35819d)}),_0x280ad6=Date[_0x20ed37(0x1c5)]()-_0x1ef423;console[_0x20ed37(0x196)](_0x20ed37(0x190)),console[_0x20ed37(0x196)](_0x20ed37(0x169),_0x255401['status']),console[_0x20ed37(0x196)](_0x20ed37(0x16b),_0x255401[_0x20ed37(0x16c)]),console[_0x20ed37(0x196)]('Headers:',Object['fromEntries'](_0x255401['headers'][_0x20ed37(0x1b1)]())),console[_0x20ed37(0x196)](_0x20ed37(0x1d6),_0x280ad6+'ms');const _0x92ce5=await _0x255401['text']();console[_0x20ed37(0x196)](_0x20ed37(0x1be),_0x92ce5);if(!_0x255401['ok']){console[_0x20ed37(0x1bc)]('===\x20COINTOPAY2\x20API\x20ERROR\x20==='),console[_0x20ed37(0x1bc)]('HTTP\x20Status:',_0x255401[_0x20ed37(0x1c1)]),console[_0x20ed37(0x1bc)](_0x20ed37(0x15d),_0x92ce5),loggerService_1[_0x20ed37(0x181)]['logWhiteDomainResponse']('cointopay2','/create',_0x255401['status'],_0x92ce5,_0x280ad6),loggerService_1[_0x20ed37(0x181)][_0x20ed37(0x1bb)]('cointopay2','/create',_0x20ed37(0x166)+_0x255401[_0x20ed37(0x1c1)]+':\x20'+_0x92ce5);throw new Error(_0x20ed37(0x1b7)+_0x255401[_0x20ed37(0x1c1)]+',\x20body:\x20'+_0x92ce5);}let _0x4e2913;try{_0x4e2913=JSON['parse'](_0x92ce5);}catch(_0x58bf0b){console['error'](_0x20ed37(0x1bd),_0x58bf0b),loggerService_1[_0x20ed37(0x181)][_0x20ed37(0x1bb)](_0x20ed37(0x19f),_0x20ed37(0x19b),_0x20ed37(0x180)+_0x58bf0b);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20'+_0x92ce5);}console[_0x20ed37(0x196)]('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console['log']('Parsed\x20Result:',JSON[_0x20ed37(0x18a)](_0x4e2913,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x20ed37(0x19f),'/create',_0x255401[_0x20ed37(0x1c1)],_0x4e2913,_0x280ad6);if(_0x4e2913['error']){const _0x134c4b=_0x4e2913[_0x20ed37(0x1b9)]||_0x4e2913['error']||_0x20ed37(0x182);console[_0x20ed37(0x1bc)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x20ed37(0x17a),_0x134c4b),loggerService_1[_0x20ed37(0x181)][_0x20ed37(0x1bb)](_0x20ed37(0x19f),_0x20ed37(0x19b),_0x20ed37(0x1c4)+_0x134c4b);throw new Error(_0x20ed37(0x161)+_0x134c4b);}if(!_0x4e2913[_0x20ed37(0x16d)]||!_0x4e2913[_0x20ed37(0x195)]){console[_0x20ed37(0x1bc)]('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x20ed37(0x1bc)]('Response\x20data:',_0x4e2913),loggerService_1['loggerService'][_0x20ed37(0x1bb)](_0x20ed37(0x19f),_0x20ed37(0x19b),_0x20ed37(0x1d5));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x20ed37(0x196)]('===\x20COINTOPAY2\x20SUCCESS\x20==='),console['log'](_0x20ed37(0x184),_0x4e2913[_0x20ed37(0x195)]),console['log']('Payment\x20URL\x20(original):',_0x4e2913[_0x20ed37(0x16d)]);const _0x27ca74=_0x4e2913[_0x20ed37(0x16d)]+_0x20ed37(0x167);return console[_0x20ed37(0x196)](_0x20ed37(0x1a7),_0x27ca74),console['log'](_0x20ed37(0x1d2),_0x3ba1eb,_0x20ed37(0x1ba)),{'gateway_payment_id':_0x4e2913['gateway_payment_id'],'payment_url':_0x27ca74};}catch(_0x32e9d1){console[_0x20ed37(0x1bc)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x20ed37(0x1bc)](_0x20ed37(0x1d8),_0x32e9d1),loggerService_1['loggerService']['logWhiteDomainError']('cointopay2','/create',_0x32e9d1);if(_0x32e9d1 instanceof Error){console[_0x20ed37(0x1bc)]('Error\x20message:',_0x32e9d1['message']),console[_0x20ed37(0x1bc)]('Error\x20stack:',_0x32e9d1[_0x20ed37(0x1b2)]);throw new Error(_0x20ed37(0x1cd)+_0x32e9d1[_0x20ed37(0x1b9)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a64_0x396f74(0x1c8)](_0xaae704){const _0x2a18e7=a64_0x396f74,_0x2ac18c=Date[_0x2a18e7(0x1c5)]();try{console[_0x2a18e7(0x196)](_0x2a18e7(0x17f)+_0xaae704);const _0x95b21a={'gatewayPaymentId':_0xaae704};loggerService_1['loggerService'][_0x2a18e7(0x15f)](_0x2a18e7(0x19f),_0x2a18e7(0x1d7),_0x2a18e7(0x191),_0x95b21a);const _0x563f1f=await fetch(this['statusUrl'],{'method':_0x2a18e7(0x191),'headers':{'Content-Type':_0x2a18e7(0x198),'Accept':_0x2a18e7(0x198),'User-Agent':_0x2a18e7(0x1c2)},'body':JSON['stringify'](_0x95b21a)}),_0x1c7bf1=Date[_0x2a18e7(0x1c5)]()-_0x2ac18c;console[_0x2a18e7(0x196)](_0x2a18e7(0x186)),console[_0x2a18e7(0x196)]('Status:',_0x563f1f[_0x2a18e7(0x1c1)]),console[_0x2a18e7(0x196)](_0x2a18e7(0x1d6),_0x1c7bf1+'ms');if(!_0x563f1f['ok']){const _0x4a8302=await _0x563f1f[_0x2a18e7(0x193)]();console[_0x2a18e7(0x1bc)](_0x2a18e7(0x179),_0x563f1f[_0x2a18e7(0x1c1)]),console[_0x2a18e7(0x1bc)](_0x2a18e7(0x15d),_0x4a8302),loggerService_1['loggerService'][_0x2a18e7(0x192)](_0x2a18e7(0x19f),_0x2a18e7(0x1d7),_0x563f1f['status'],_0x4a8302,_0x1c7bf1),loggerService_1['loggerService'][_0x2a18e7(0x1bb)]('cointopay2',_0x2a18e7(0x1d7),_0x2a18e7(0x166)+_0x563f1f['status']+':\x20'+_0x4a8302);throw new Error(_0x2a18e7(0x1b7)+_0x563f1f[_0x2a18e7(0x1c1)]);}const _0xdeca01=await _0x563f1f[_0x2a18e7(0x193)]();console[_0x2a18e7(0x196)](_0x2a18e7(0x1be),_0xdeca01);let _0x853b42;try{_0x853b42=JSON[_0x2a18e7(0x172)](_0xdeca01);}catch(_0x52ad45){console[_0x2a18e7(0x1bc)](_0x2a18e7(0x1bd),_0x52ad45),loggerService_1[_0x2a18e7(0x181)][_0x2a18e7(0x1bb)](_0x2a18e7(0x19f),_0x2a18e7(0x1d7),'JSON\x20Parse\x20Error:\x20'+_0x52ad45);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'+_0xdeca01);}loggerService_1[_0x2a18e7(0x181)][_0x2a18e7(0x192)](_0x2a18e7(0x19f),_0x2a18e7(0x1d7),_0x563f1f[_0x2a18e7(0x1c1)],_0x853b42,_0x1c7bf1),console[_0x2a18e7(0x196)](_0x2a18e7(0x189)),console[_0x2a18e7(0x196)]('Result:',_0x853b42[_0x2a18e7(0x16f)]),console[_0x2a18e7(0x196)](_0x2a18e7(0x1ab),_0x853b42[_0x2a18e7(0x16a)]),console['log'](_0x2a18e7(0x1c6),_0x853b42[_0x2a18e7(0x1d4)]?.[_0x2a18e7(0x168)]),console['log']('Amount:',_0x853b42[_0x2a18e7(0x1d4)]?.[_0x2a18e7(0x1ca)]),console['log'](_0x2a18e7(0x1d1),_0x853b42[_0x2a18e7(0x1d4)]?.[_0x2a18e7(0x173)]);if(_0x853b42[_0x2a18e7(0x16f)]!=='success'||_0x853b42['status_code']!==0xc8){const _0x4052a9=_0x853b42['message']||_0x2a18e7(0x1a5);console[_0x2a18e7(0x1bc)]('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console[_0x2a18e7(0x1bc)](_0x2a18e7(0x17a),_0x4052a9),loggerService_1['loggerService'][_0x2a18e7(0x1bb)](_0x2a18e7(0x19f),'/status',_0x2a18e7(0x1b8)+_0x4052a9);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0x4052a9);}if(!_0x853b42[_0x2a18e7(0x1d4)]){console['error']('===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2a18e7(0x1bc)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x2a18e7(0x181)][_0x2a18e7(0x1bb)](_0x2a18e7(0x19f),'/status',_0x2a18e7(0x17c));throw new Error(_0x2a18e7(0x18c));}let _0x3fbe37=_0x2a18e7(0x1a2);switch(_0x853b42[_0x2a18e7(0x1d4)][_0x2a18e7(0x168)]?.[_0x2a18e7(0x18e)]()){case _0x2a18e7(0x18b):_0x3fbe37='PAID';break;case _0x2a18e7(0x1af):case _0x2a18e7(0x1bf):case _0x2a18e7(0x1bc):_0x3fbe37=_0x2a18e7(0x197);break;case _0x2a18e7(0x1a1):case'timeout':_0x3fbe37=_0x2a18e7(0x18d);break;case _0x2a18e7(0x185):case _0x2a18e7(0x1ae):case _0x2a18e7(0x1ce):case _0x2a18e7(0x1cc):default:_0x3fbe37=_0x2a18e7(0x1a2);break;}let _0x22a775,_0x45a297;if(_0x853b42[_0x2a18e7(0x1d4)]['PaymentDetail']){const _0x3a9a65=_0x853b42['data']['PaymentDetail'];console[_0x2a18e7(0x196)](_0x2a18e7(0x17e),_0x3a9a65);const _0x4da652=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x31a381 of _0x4da652){const _0x2d6068=_0x3a9a65[_0x2a18e7(0x1b3)](_0x31a381);if(_0x2d6068){_0x22a775=_0x2d6068[0x1],console[_0x2a18e7(0x196)](_0x2a18e7(0x1cb),_0x22a775,_0x2a18e7(0x1a4),_0x31a381[_0x2a18e7(0x1b5)]);break;}}if(!_0x22a775){console[_0x2a18e7(0x196)](_0x2a18e7(0x17b));const _0x505773=_0x3a9a65[_0x2a18e7(0x1b3)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x505773&&(_0x22a775=_0x505773[0x1],console[_0x2a18e7(0x196)]('üè¶\x20Extracted\x20IBAN\x20via\x20fallback:',_0x22a775));}_0x45a297=_0x3a9a65;}const _0x4b576d={'iban':_0x22a775,'bankDetails':_0x45a297,'transactionId':_0x853b42['data'][_0x2a18e7(0x1d3)],'coinAddress':_0x853b42[_0x2a18e7(0x1d4)]['coinAddress'],'qrCodeUrl':_0x853b42[_0x2a18e7(0x1d4)][_0x2a18e7(0x18f)],'expiryTime':_0x853b42[_0x2a18e7(0x1d4)]['ExpiryTime'],'createdOn':_0x853b42[_0x2a18e7(0x1d4)][_0x2a18e7(0x171)],'confirmedOn':_0x853b42[_0x2a18e7(0x1d4)][_0x2a18e7(0x187)]};console['log'](_0x2a18e7(0x178)),console['log'](_0x2a18e7(0x169),_0x853b42[_0x2a18e7(0x1d4)]['Status'],'->',_0x3fbe37),console[_0x2a18e7(0x196)](_0x2a18e7(0x1d2),_0x853b42[_0x2a18e7(0x1d4)][_0x2a18e7(0x1ca)],_0x853b42[_0x2a18e7(0x1d4)][_0x2a18e7(0x173)]),console['log'](_0x2a18e7(0x15e),_0x853b42[_0x2a18e7(0x1d4)]['TransactionID']),console[_0x2a18e7(0x196)]('IBAN:',_0x22a775||_0x2a18e7(0x16e)),console[_0x2a18e7(0x196)](_0x2a18e7(0x1cf),_0x853b42[_0x2a18e7(0x1d4)][_0x2a18e7(0x171)]),console[_0x2a18e7(0x196)]('Confirmed\x20On:',_0x853b42[_0x2a18e7(0x1d4)][_0x2a18e7(0x187)]||'not\x20confirmed');if(_0x853b42['data'][_0x2a18e7(0x168)]?.[_0x2a18e7(0x18e)]()===_0x2a18e7(0x1ae))console['log'](_0x2a18e7(0x1a0));else _0x853b42[_0x2a18e7(0x1d4)][_0x2a18e7(0x168)]?.['toLowerCase']()===_0x2a18e7(0x18b)&&console[_0x2a18e7(0x196)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x3fbe37,'amount':parseFloat(_0x853b42[_0x2a18e7(0x1d4)][_0x2a18e7(0x1ca)])||undefined,'currency':_0x853b42[_0x2a18e7(0x1d4)][_0x2a18e7(0x173)]||'EUR','paymentDetails':_0x4b576d};}catch(_0x37d9f5){console['error']('CoinToPay2\x20payment\x20status\x20check\x20error:',_0x37d9f5),loggerService_1[_0x2a18e7(0x181)][_0x2a18e7(0x1bb)](_0x2a18e7(0x19f),_0x2a18e7(0x1d7),_0x37d9f5);throw new Error(_0x2a18e7(0x194)+(_0x37d9f5 instanceof Error?_0x37d9f5['message']:'Unknown\x20error'));}}async[a64_0x396f74(0x1b0)](_0x33f654){const _0x2b5144=a64_0x396f74,_0x460a45=await this['checkPaymentStatus'](_0x33f654);return{'status':_0x460a45['status'],'amount':_0x460a45[_0x2b5144(0x170)],'currency':_0x460a45[_0x2b5144(0x1c9)]};}async[a64_0x396f74(0x1b4)](_0x4a2bbf){const _0x47a9bb=a64_0x396f74;console[_0x47a9bb(0x196)]('Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x4a2bbf);let _0x2f6f99='PENDING';switch(_0x4a2bbf[_0x47a9bb(0x1c1)]?.[_0x47a9bb(0x18e)]()){case _0x47a9bb(0x18b):_0x2f6f99=_0x47a9bb(0x1a3);break;case'cancelled':case _0x47a9bb(0x1bf):case'error':_0x2f6f99=_0x47a9bb(0x197);break;case'expired':case _0x47a9bb(0x1c0):_0x2f6f99=_0x47a9bb(0x18d);break;case _0x47a9bb(0x1ce):case _0x47a9bb(0x185):case _0x47a9bb(0x1ae):case _0x47a9bb(0x1cc):default:_0x2f6f99=_0x47a9bb(0x1a2);break;}return{'paymentId':_0x4a2bbf[_0x47a9bb(0x165)]||_0x4a2bbf[_0x47a9bb(0x183)]||'','status':_0x2f6f99,'amount':_0x4a2bbf[_0x47a9bb(0x170)],'currency':_0x4a2bbf[_0x47a9bb(0x1c9)]||'EUR'};}}function a64_0x18d6(_0x181c91,_0x1196f4){_0x181c91=_0x181c91-0x15d;const _0x3266c6=a64_0x3266();let _0x18d6d1=_0x3266c6[_0x181c91];return _0x18d6d1;}exports['CoinToPay2Service']=CoinToPay2Service;function a64_0x3266(){const _0x119f4b=['Status\x20Text:','statusText','payment_url','not\x20found','result','amount','CreatedOn','parse','inputCurrency','9fzFmFu','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','2282130jNalyE','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','HTTP\x20Status:','Error\x20Message:','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','Incomplete\x20response:\x20missing\x20data','Request\x20Body:','üè¶\x20Payment\x20Detail:','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','JSON\x20Parse\x20Error:\x20','loggerService','Unknown\x20error\x20from\x20CoinToPay2\x20API','merchant_reference_id','Gateway\x20Payment\x20ID:','waiting','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','TransactionConfirmedOn','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','stringify','paid','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','EXPIRED','toLowerCase','QRCodeURL','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','POST','logWhiteDomainResponse','text','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','gateway_payment_id','log','FAILED','application/json','3nNaYdv','../loggerService','/create','3704395NtLati','defineProperty','URL:','cointopay2','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','expired','PENDING','PAID','using\x20pattern:','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','statusUrl','Payment\x20URL\x20(modified):','__esModule','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','176466xOpcZc','Status\x20Code:','üìä\x20Status\x20check\x20URL:','14255318BgfmNF','awaiting\x20fiat','cancelled','verifyPayment','entries','stack','match','processWebhook','source','2Gqenkt','HTTP\x20error!\x20status:\x20','Status\x20API\x20Error:\x20','message','EUR','logWhiteDomainError','error','Failed\x20to\x20parse\x20JSON\x20response:','Raw\x20Response\x20Body:','failed','timeout','status','Payment\x20System/1.0\x20(CoinToPay2)','140yXuTDO','Business\x20Error:\x20','now','Payment\x20Status:','apiUrl','checkPaymentStatus','currency','Amount','üè¶\x20Extracted\x20IBAN:','created','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','pending','Created\x20On:','https://traffer.uk/gateway/cointopay/','Currency:','Amount:','TransactionID','data','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Response\x20Time:','/status','Error\x20details:','https://traffer.uk/gateway/cointopay/status.php','Response\x20Body:','Transaction\x20ID:','logWhiteDomainRequest','746999gnCDiF','CoinToPay2\x20API\x20error:\x20','2869096LLNTOx','2524572ffufhq','\x20EUR','order_id','HTTP\x20','&alternative=false','Status','Status:','status_code'];a64_0x3266=function(){return _0x119f4b;};return a64_0x3266();}