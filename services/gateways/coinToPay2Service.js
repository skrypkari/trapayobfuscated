'use strict';const a40_0x540fdd=a40_0x52a1;(function(_0x30db9f,_0x1aaf6c){const _0x141f62=a40_0x52a1,_0xc3f730=_0x30db9f();while(!![]){try{const _0x42ea21=-parseInt(_0x141f62(0xd6))/0x1*(parseInt(_0x141f62(0x110))/0x2)+-parseInt(_0x141f62(0xf2))/0x3*(parseInt(_0x141f62(0xef))/0x4)+parseInt(_0x141f62(0x121))/0x5+-parseInt(_0x141f62(0x10a))/0x6*(parseInt(_0x141f62(0xd5))/0x7)+-parseInt(_0x141f62(0x122))/0x8*(parseInt(_0x141f62(0xcf))/0x9)+parseInt(_0x141f62(0x104))/0xa*(parseInt(_0x141f62(0xf0))/0xb)+parseInt(_0x141f62(0xc3))/0xc;if(_0x42ea21===_0x1aaf6c)break;else _0xc3f730['push'](_0xc3f730['shift']());}catch(_0x258bcf){_0xc3f730['push'](_0xc3f730['shift']());}}}(a40_0x1174,0x1fb4c));function a40_0x1174(){const _0x12f74c=['pending','Confirmed\x20On:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','Error\x20Message:','amount','CoinToPay2\x20payment\x20status\x20check\x20error:','__esModule','POST','Unknown\x20error\x20from\x20CoinToPay2\x20API','logWhiteDomainError','Failed\x20to\x20parse\x20JSON\x20response:','application/json','data','statusText','Response\x20Body:','Amount:','gateway_payment_id','Error\x20stack:','HTTP\x20error!\x20status:\x20','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','Raw\x20Response\x20Body:','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','message','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','failed','verifyPayment','Status\x20API\x20Error:\x20','Response\x20data:','IBAN:','5820732fizepE','CoinToPay2Service','Parsed\x20Result:','created','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','logWhiteDomainRequest','currency','/status','EUR','TransactionConfirmedOn','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Amount','9LkmDGW','Payment\x20URL:','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','Payment\x20Status:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','coinAddress','1737421rAVnNm','1205rPGRNx','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','not\x20confirmed','log','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','timeout','defineProperty','EXPIRED','text','Status:','HTTP\x20Status:','TransactionID','Result:','createPaymentLink','apiUrl','loggerService','logWhiteDomainResponse','üè¶\x20Payment\x20Detail:','fromEntries','status_code','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','toLowerCase','PENDING','paid','URL:','140hbDqjv','33MdYJDe','status','18570QuLZat','Incomplete\x20response:\x20missing\x20data','headers',',\x20body:\x20','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','Missing\x20data\x20in\x20response','\x20EUR','/create','CreatedOn','stack','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Status\x20Code:','processWebhook','now','result','waiting','match','322450GSnwxB','parse','cancelled','checkPaymentStatus','PaymentDetail','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','6HyWrtf','statusUrl','success','Error\x20message:','HTTP\x20','FAILED','170WfLAqy','QRCodeURL','inputCurrency','ExpiryTime','Created\x20On:','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY2\x20SUCCESS\x20===','https://traffer.uk/gateway/cointopay/','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','awaiting\x20fiat','Status','üè¶\x20Extracted\x20IBAN:','expired','error','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','JSON\x20Parse\x20Error:\x20','payment_url','645355GdXpuv','109768KgauFH','cointopay2','CoinToPay2\x20status\x20API\x20error:\x20','Gateway\x20Payment\x20ID:','stringify'];a40_0x1174=function(){return _0x12f74c;};return a40_0x1174();}Object[a40_0x540fdd(0xdc)](exports,a40_0x540fdd(0x12d),{'value':!![]}),exports[a40_0x540fdd(0xc4)]=void 0x0;const loggerService_1=require('../loggerService');function a40_0x52a1(_0x5ee72e,_0x7a8080){const _0x11747b=a40_0x1174();return a40_0x52a1=function(_0x52a109,_0x4c156a){_0x52a109=_0x52a109-0xbb;let _0x403c32=_0x11747b[_0x52a109];return _0x403c32;},a40_0x52a1(_0x5ee72e,_0x7a8080);}class CoinToPay2Service{constructor(){const _0x109e7b=a40_0x540fdd;this['apiUrl']=_0x109e7b(0x117),this[_0x109e7b(0x10b)]='https://traffer.uk/gateway/cointopay/status.php',console[_0x109e7b(0xd9)](_0x109e7b(0xbb)),console[_0x109e7b(0xd9)]('üìä\x20Status\x20check\x20URL:',this[_0x109e7b(0x10b)]);}async[a40_0x540fdd(0xe3)](_0x2ed709){const _0x5f1c9=a40_0x540fdd,{orderId:_0x4c350b,amount:_0xe0a77a}=_0x2ed709;console[_0x5f1c9(0xd9)](_0x5f1c9(0xea)+_0xe0a77a+_0x5f1c9(0xf8));const _0x1630b6={'amount':_0xe0a77a},_0x46b4ce=Date[_0x5f1c9(0x100)]();try{console[_0x5f1c9(0xd9)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console[_0x5f1c9(0xd9)](_0x5f1c9(0xee),this[_0x5f1c9(0xe4)]),console[_0x5f1c9(0xd9)]('Request\x20Body:',JSON[_0x5f1c9(0x126)](_0x1630b6,null,0x2)),console[_0x5f1c9(0xd9)]('Amount:',_0xe0a77a,_0x5f1c9(0xd1)),loggerService_1[_0x5f1c9(0xe5)][_0x5f1c9(0xc8)](_0x5f1c9(0x123),_0x5f1c9(0xf9),'POST',_0x1630b6);const _0x219083=await fetch(this[_0x5f1c9(0xe4)],{'method':_0x5f1c9(0x12e),'headers':{'Content-Type':_0x5f1c9(0x132),'Accept':_0x5f1c9(0x132),'User-Agent':_0x5f1c9(0x13a)},'body':JSON[_0x5f1c9(0x126)](_0x1630b6)}),_0x27d4d4=Date[_0x5f1c9(0x100)]()-_0x46b4ce;console[_0x5f1c9(0xd9)](_0x5f1c9(0xc7)),console[_0x5f1c9(0xd9)](_0x5f1c9(0xdf),_0x219083[_0x5f1c9(0xf1)]),console[_0x5f1c9(0xd9)]('Status\x20Text:',_0x219083[_0x5f1c9(0x134)]),console['log']('Headers:',Object[_0x5f1c9(0xe8)](_0x219083[_0x5f1c9(0xf4)]['entries']())),console['log']('Response\x20Time:',_0x27d4d4+'ms');const _0x38e534=await _0x219083[_0x5f1c9(0xde)]();console['log'](_0x5f1c9(0x13b),_0x38e534);if(!_0x219083['ok']){console[_0x5f1c9(0x11d)]('===\x20COINTOPAY2\x20API\x20ERROR\x20==='),console[_0x5f1c9(0x11d)](_0x5f1c9(0xe0),_0x219083[_0x5f1c9(0xf1)]),console[_0x5f1c9(0x11d)](_0x5f1c9(0x135),_0x38e534),loggerService_1[_0x5f1c9(0xe5)][_0x5f1c9(0xe6)](_0x5f1c9(0x123),_0x5f1c9(0xf9),_0x219083[_0x5f1c9(0xf1)],_0x38e534,_0x27d4d4),loggerService_1[_0x5f1c9(0xe5)][_0x5f1c9(0x130)]('cointopay2',_0x5f1c9(0xf9),_0x5f1c9(0x10e)+_0x219083[_0x5f1c9(0xf1)]+':\x20'+_0x38e534);throw new Error(_0x5f1c9(0x139)+_0x219083['status']+_0x5f1c9(0xf5)+_0x38e534);}let _0x4e8c25;try{_0x4e8c25=JSON['parse'](_0x38e534);}catch(_0x4eb1ed){console[_0x5f1c9(0x11d)](_0x5f1c9(0x131),_0x4eb1ed),loggerService_1[_0x5f1c9(0xe5)]['logWhiteDomainError'](_0x5f1c9(0x123),_0x5f1c9(0xf9),_0x5f1c9(0x11f)+_0x4eb1ed);throw new Error(_0x5f1c9(0x129)+_0x38e534);}console[_0x5f1c9(0xd9)]('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console[_0x5f1c9(0xd9)](_0x5f1c9(0xc5),JSON[_0x5f1c9(0x126)](_0x4e8c25,null,0x2)),loggerService_1[_0x5f1c9(0xe5)][_0x5f1c9(0xe6)](_0x5f1c9(0x123),_0x5f1c9(0xf9),_0x219083[_0x5f1c9(0xf1)],_0x4e8c25,_0x27d4d4);if(_0x4e8c25['error']){const _0x3f39e0=_0x4e8c25['message']||_0x4e8c25[_0x5f1c9(0x11d)]||_0x5f1c9(0x12f);console[_0x5f1c9(0x11d)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x5f1c9(0x12a),_0x3f39e0),loggerService_1['loggerService'][_0x5f1c9(0x130)]('cointopay2',_0x5f1c9(0xf9),'Business\x20Error:\x20'+_0x3f39e0);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x3f39e0);}if(!_0x4e8c25[_0x5f1c9(0x120)]||!_0x4e8c25[_0x5f1c9(0x137)]){console[_0x5f1c9(0x11d)](_0x5f1c9(0xbd)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error'](_0x5f1c9(0xc1),_0x4e8c25),loggerService_1[_0x5f1c9(0xe5)][_0x5f1c9(0x130)](_0x5f1c9(0x123),_0x5f1c9(0xf9),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x5f1c9(0x115));}return console['log'](_0x5f1c9(0x116)),console[_0x5f1c9(0xd9)](_0x5f1c9(0x125),_0x4e8c25[_0x5f1c9(0x137)]),console['log'](_0x5f1c9(0xd0),_0x4e8c25[_0x5f1c9(0x120)]),console[_0x5f1c9(0xd9)](_0x5f1c9(0x136),_0xe0a77a,_0x5f1c9(0xcb)),{'gateway_payment_id':_0x4e8c25[_0x5f1c9(0x137)],'payment_url':_0x4e8c25[_0x5f1c9(0x120)]};}catch(_0x3d727e){console[_0x5f1c9(0x11d)](_0x5f1c9(0x11e)),console[_0x5f1c9(0x11d)]('Error\x20details:',_0x3d727e),loggerService_1['loggerService'][_0x5f1c9(0x130)](_0x5f1c9(0x123),_0x5f1c9(0xf9),_0x3d727e);if(_0x3d727e instanceof Error){console[_0x5f1c9(0x11d)](_0x5f1c9(0x10d),_0x3d727e['message']),console[_0x5f1c9(0x11d)](_0x5f1c9(0x138),_0x3d727e[_0x5f1c9(0xfb)]);throw new Error(_0x5f1c9(0x118)+_0x3d727e[_0x5f1c9(0xbc)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x540fdd(0x107)](_0x3831e6){const _0x2c4fa6=a40_0x540fdd,_0x2d0946=Date[_0x2c4fa6(0x100)]();try{console[_0x2c4fa6(0xd9)](_0x2c4fa6(0xcd)+_0x3831e6);const _0x11bcf8={'gatewayPaymentId':_0x3831e6};loggerService_1['loggerService'][_0x2c4fa6(0xc8)]('cointopay2',_0x2c4fa6(0xca),_0x2c4fa6(0x12e),_0x11bcf8);const _0x1b9939=await fetch(this[_0x2c4fa6(0x10b)],{'method':_0x2c4fa6(0x12e),'headers':{'Content-Type':_0x2c4fa6(0x132),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x2c4fa6(0x126)](_0x11bcf8)}),_0x31a650=Date[_0x2c4fa6(0x100)]()-_0x2d0946;console[_0x2c4fa6(0xd9)](_0x2c4fa6(0xf6)),console[_0x2c4fa6(0xd9)](_0x2c4fa6(0xdf),_0x1b9939[_0x2c4fa6(0xf1)]),console['log']('Response\x20Time:',_0x31a650+'ms');if(!_0x1b9939['ok']){const _0x37a006=await _0x1b9939[_0x2c4fa6(0xde)]();console['error'](_0x2c4fa6(0xe0),_0x1b9939[_0x2c4fa6(0xf1)]),console[_0x2c4fa6(0x11d)]('Response\x20Body:',_0x37a006),loggerService_1['loggerService'][_0x2c4fa6(0xe6)]('cointopay2',_0x2c4fa6(0xca),_0x1b9939[_0x2c4fa6(0xf1)],_0x37a006,_0x31a650),loggerService_1['loggerService']['logWhiteDomainError'](_0x2c4fa6(0x123),_0x2c4fa6(0xca),_0x2c4fa6(0x10e)+_0x1b9939[_0x2c4fa6(0xf1)]+':\x20'+_0x37a006);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1b9939[_0x2c4fa6(0xf1)]);}const _0x528995=await _0x1b9939['text']();console[_0x2c4fa6(0xd9)](_0x2c4fa6(0x13b),_0x528995);let _0xfe326c;try{_0xfe326c=JSON[_0x2c4fa6(0x105)](_0x528995);}catch(_0x3282b8){console['error'](_0x2c4fa6(0x131),_0x3282b8),loggerService_1[_0x2c4fa6(0xe5)][_0x2c4fa6(0x130)]('cointopay2',_0x2c4fa6(0xca),'JSON\x20Parse\x20Error:\x20'+_0x3282b8);throw new Error(_0x2c4fa6(0xd3)+_0x528995);}loggerService_1[_0x2c4fa6(0xe5)][_0x2c4fa6(0xe6)](_0x2c4fa6(0x123),_0x2c4fa6(0xca),_0x1b9939[_0x2c4fa6(0xf1)],_0xfe326c,_0x31a650),console[_0x2c4fa6(0xd9)]('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console[_0x2c4fa6(0xd9)](_0x2c4fa6(0xe2),_0xfe326c[_0x2c4fa6(0x101)]),console[_0x2c4fa6(0xd9)](_0x2c4fa6(0xfe),_0xfe326c[_0x2c4fa6(0xe9)]),console[_0x2c4fa6(0xd9)](_0x2c4fa6(0xd2),_0xfe326c['data']?.[_0x2c4fa6(0x11a)]),console['log']('Amount:',_0xfe326c[_0x2c4fa6(0x133)]?.[_0x2c4fa6(0xce)]),console['log']('Currency:',_0xfe326c[_0x2c4fa6(0x133)]?.[_0x2c4fa6(0x112)]);if(_0xfe326c[_0x2c4fa6(0x101)]!==_0x2c4fa6(0x10c)||_0xfe326c[_0x2c4fa6(0xe9)]!==0xc8){const _0x24ebd3=_0xfe326c[_0x2c4fa6(0xbc)]||'Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API';console[_0x2c4fa6(0x11d)]('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console[_0x2c4fa6(0x11d)](_0x2c4fa6(0x12a),_0x24ebd3),loggerService_1[_0x2c4fa6(0xe5)][_0x2c4fa6(0x130)]('cointopay2','/status',_0x2c4fa6(0xc0)+_0x24ebd3);throw new Error(_0x2c4fa6(0x124)+_0x24ebd3);}if(!_0xfe326c[_0x2c4fa6(0x133)]){console[_0x2c4fa6(0x11d)](_0x2c4fa6(0xfc)),console[_0x2c4fa6(0x11d)](_0x2c4fa6(0xf7)),loggerService_1[_0x2c4fa6(0xe5)][_0x2c4fa6(0x130)](_0x2c4fa6(0x123),_0x2c4fa6(0xca),_0x2c4fa6(0xf3));throw new Error(_0x2c4fa6(0xda));}let _0x29eb82=_0x2c4fa6(0xec);switch(_0xfe326c[_0x2c4fa6(0x133)][_0x2c4fa6(0x11a)]?.[_0x2c4fa6(0xeb)]()){case _0x2c4fa6(0xed):_0x29eb82='PAID';break;case _0x2c4fa6(0x106):case _0x2c4fa6(0xbe):case _0x2c4fa6(0x11d):_0x29eb82='FAILED';break;case _0x2c4fa6(0x11c):case _0x2c4fa6(0xdb):_0x29eb82=_0x2c4fa6(0xdd);break;case _0x2c4fa6(0x102):case'awaiting\x20fiat':case _0x2c4fa6(0x127):case'created':default:_0x29eb82='PENDING';break;}let _0x57dcf6,_0x55871d;if(_0xfe326c['data'][_0x2c4fa6(0x108)]){const _0x9c0ff5=_0xfe326c[_0x2c4fa6(0x133)][_0x2c4fa6(0x108)];console[_0x2c4fa6(0xd9)](_0x2c4fa6(0xe7),_0x9c0ff5);const _0x161a0f=_0x9c0ff5[_0x2c4fa6(0x103)](/IBAN\s+([A-Z0-9]+)/i);_0x161a0f&&(_0x57dcf6=_0x161a0f[0x1],console[_0x2c4fa6(0xd9)](_0x2c4fa6(0x11b),_0x57dcf6)),_0x55871d=_0x9c0ff5;}const _0x30124c={'iban':_0x57dcf6,'bankDetails':_0x55871d,'transactionId':_0xfe326c[_0x2c4fa6(0x133)][_0x2c4fa6(0xe1)],'coinAddress':_0xfe326c['data'][_0x2c4fa6(0xd4)],'qrCodeUrl':_0xfe326c['data'][_0x2c4fa6(0x111)],'expiryTime':_0xfe326c['data'][_0x2c4fa6(0x113)],'createdOn':_0xfe326c[_0x2c4fa6(0x133)]['CreatedOn'],'confirmedOn':_0xfe326c[_0x2c4fa6(0x133)]['TransactionConfirmedOn']};console['log'](_0x2c4fa6(0x109)),console[_0x2c4fa6(0xd9)]('Status:',_0xfe326c[_0x2c4fa6(0x133)]['Status'],'->',_0x29eb82),console[_0x2c4fa6(0xd9)](_0x2c4fa6(0x136),_0xfe326c[_0x2c4fa6(0x133)][_0x2c4fa6(0xce)],_0xfe326c[_0x2c4fa6(0x133)]['inputCurrency']),console[_0x2c4fa6(0xd9)]('Transaction\x20ID:',_0xfe326c[_0x2c4fa6(0x133)]['TransactionID']),console[_0x2c4fa6(0xd9)](_0x2c4fa6(0xc2),_0x57dcf6||'not\x20found'),console[_0x2c4fa6(0xd9)](_0x2c4fa6(0x114),_0xfe326c[_0x2c4fa6(0x133)][_0x2c4fa6(0xfa)]),console[_0x2c4fa6(0xd9)](_0x2c4fa6(0x128),_0xfe326c[_0x2c4fa6(0x133)][_0x2c4fa6(0xcc)]||_0x2c4fa6(0xd8));if(_0xfe326c[_0x2c4fa6(0x133)][_0x2c4fa6(0x11a)]?.[_0x2c4fa6(0xeb)]()===_0x2c4fa6(0x119))console[_0x2c4fa6(0xd9)](_0x2c4fa6(0xfd));else _0xfe326c[_0x2c4fa6(0x133)][_0x2c4fa6(0x11a)]?.[_0x2c4fa6(0xeb)]()===_0x2c4fa6(0xed)&&console[_0x2c4fa6(0xd9)](_0x2c4fa6(0xd7));return{'status':_0x29eb82,'amount':parseFloat(_0xfe326c[_0x2c4fa6(0x133)]['Amount'])||undefined,'currency':_0xfe326c[_0x2c4fa6(0x133)][_0x2c4fa6(0x112)]||'EUR','paymentDetails':_0x30124c};}catch(_0x2a1de4){console[_0x2c4fa6(0x11d)](_0x2c4fa6(0x12c),_0x2a1de4),loggerService_1[_0x2c4fa6(0xe5)]['logWhiteDomainError'](_0x2c4fa6(0x123),'/status',_0x2a1de4);throw new Error('Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20'+(_0x2a1de4 instanceof Error?_0x2a1de4[_0x2c4fa6(0xbc)]:'Unknown\x20error'));}}async[a40_0x540fdd(0xbf)](_0x52421f){const _0x5c5328=a40_0x540fdd,_0x52ddd8=await this['checkPaymentStatus'](_0x52421f);return{'status':_0x52ddd8[_0x5c5328(0xf1)],'amount':_0x52ddd8[_0x5c5328(0x12b)],'currency':_0x52ddd8[_0x5c5328(0xc9)]};}async[a40_0x540fdd(0xff)](_0x289ff7){const _0x1811cc=a40_0x540fdd;console[_0x1811cc(0xd9)](_0x1811cc(0x13c),_0x289ff7);let _0x35e828=_0x1811cc(0xec);switch(_0x289ff7['status']?.[_0x1811cc(0xeb)]()){case'paid':_0x35e828='PAID';break;case _0x1811cc(0x106):case _0x1811cc(0xbe):case _0x1811cc(0x11d):_0x35e828=_0x1811cc(0x10f);break;case'expired':case _0x1811cc(0xdb):_0x35e828=_0x1811cc(0xdd);break;case _0x1811cc(0x127):case'waiting':case _0x1811cc(0x119):case _0x1811cc(0xc6):default:_0x35e828=_0x1811cc(0xec);break;}return{'paymentId':_0x289ff7['order_id']||_0x289ff7['merchant_reference_id']||'','status':_0x35e828,'amount':_0x289ff7[_0x1811cc(0x12b)],'currency':_0x289ff7[_0x1811cc(0xc9)]||_0x1811cc(0xcb)};}}exports['CoinToPay2Service']=CoinToPay2Service;