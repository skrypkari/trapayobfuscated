'use strict';const a46_0x36601b=a46_0x3658;function a46_0x1fe9(){const _0x25cdec=['Result:','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','log','cancelled','PENDING','5177432INiyNN','1202277wLfdlz','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','Amount','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','defineProperty','created','4PKNjQf','message','Error\x20Message:','🪙\x20Creating\x20CoinToPay2\x20payment:\x20','POST','ExpiryTime','not\x20found','statusUrl','Created\x20On:','CoinToPay2\x20status\x20API\x20error:\x20','Headers:','Payment\x20URL\x20(modified):','Parsed\x20Result:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','URL:','Status:','error','🪙\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','Raw\x20Response\x20Body:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','cointopay2','1289589dafYsu','match','paid','Error\x20message:','amount','Amount:','statusText','../loggerService','inputCurrency','source','TransactionConfirmedOn','JSON\x20Parse\x20Error:\x20','gateway_payment_id','1442295WXOoPT','waiting','CoinToPay2\x20API\x20error:\x20','result','now','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','/status','text','fromEntries','Payment\x20System/1.0\x20(CoinToPay2)','IBAN:','TransactionID','EXPIRED','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','/create','QRCodeURL','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','success','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','failed','6rMiHjW','PaymentDetail','Response\x20Body:','===\x20COINTOPAY2\x20API\x20ERROR\x20===','106397ooheuR','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','payment_url','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status\x20Code:','verifyPayment','order_id','merchant_reference_id','Status\x20API\x20Error:\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','HTTP\x20','Currency:','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','loggerService',',\x20body:\x20','coinAddress','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','\x20EUR','processWebhook','awaiting\x20fiat','20YIFBBD','===\x20COINTOPAY2\x20SUCCESS\x20===','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','PAID','Incomplete\x20response:\x20missing\x20data','currency','&alternative=false','logWhiteDomainError','toLowerCase','Business\x20Error:\x20','Missing\x20data\x20in\x20response','Unknown\x20error','EUR','stringify','https://traffer.uk/gateway/cointopay/status.php','📊\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','15408118dPTYFM','logWhiteDomainRequest','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','CoinToPay2Service','application/json','Error\x20stack:','6FCGpFG','status_code','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','Error\x20details:','pending','CoinToPay2\x20payment\x20status\x20check\x20error:','headers','Response\x20Time:','expired','using\x20pattern:','timeout','FAILED','parse','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','entries','https://traffer.uk/gateway/cointopay/','Payment\x20URL\x20(original):','2497260rVicku','logWhiteDomainResponse','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','HTTP\x20error!\x20status:\x20','HTTP\x20Status:','data','Status','status','apiUrl','Transaction\x20ID:','__esModule'];a46_0x1fe9=function(){return _0x25cdec;};return a46_0x1fe9();}(function(_0x55028b,_0xe14ced){const _0x1aca99=a46_0x3658,_0x4d606f=_0x55028b();while(!![]){try{const _0x9e3986=-parseInt(_0x1aca99(0x84))/0x1*(parseInt(_0x1aca99(0xae))/0x2)+-parseInt(_0x1aca99(0xd1))/0x3*(-parseInt(_0x1aca99(0xd7))/0x4)+parseInt(_0x1aca99(0xbf))/0x5+parseInt(_0x1aca99(0x80))/0x6*(parseInt(_0x1aca99(0xec))/0x7)+parseInt(_0x1aca99(0xd0))/0x8+parseInt(_0x1aca99(0xf9))/0x9*(parseInt(_0x1aca99(0x98))/0xa)+-parseInt(_0x1aca99(0xa8))/0xb;if(_0x9e3986===_0xe14ced)break;else _0x4d606f['push'](_0x4d606f['shift']());}catch(_0x213b4f){_0x4d606f['push'](_0x4d606f['shift']());}}}(a46_0x1fe9,0x511a6));Object[a46_0x36601b(0xd5)](exports,a46_0x36601b(0xc9),{'value':!![]}),exports[a46_0x36601b(0xab)]=void 0x0;const loggerService_1=require(a46_0x36601b(0xf3));function a46_0x3658(_0x355914,_0x957d93){const _0x1fe912=a46_0x1fe9();return a46_0x3658=function(_0x365848,_0x22444b){_0x365848=_0x365848-0x7e;let _0x44e38e=_0x1fe912[_0x365848];return _0x44e38e;},a46_0x3658(_0x355914,_0x957d93);}class CoinToPay2Service{constructor(){const _0xa38543=a46_0x36601b;this[_0xa38543(0xc7)]=_0xa38543(0xbd),this[_0xa38543(0xde)]=_0xa38543(0xa6),console[_0xa38543(0xcd)](_0xa38543(0xe8)),console[_0xa38543(0xcd)]('📊\x20Status\x20check\x20URL:',this[_0xa38543(0xde)]);}async['createPaymentLink'](_0x328b67){const _0x4f5f2c=a46_0x36601b,{orderId:_0x145db3,amount:_0x5edd85}=_0x328b67;console['log'](_0x4f5f2c(0xda)+_0x5edd85+_0x4f5f2c(0x95));const _0x94a1b2={'amount':_0x5edd85},_0xac92d5=Date[_0x4f5f2c(0xfd)]();try{console[_0x4f5f2c(0xcd)](_0x4f5f2c(0xcc)),console[_0x4f5f2c(0xcd)](_0x4f5f2c(0xe5),this[_0x4f5f2c(0xc7)]),console[_0x4f5f2c(0xcd)]('Request\x20Body:',JSON['stringify'](_0x94a1b2,null,0x2)),console[_0x4f5f2c(0xcd)](_0x4f5f2c(0xf1),_0x5edd85,'EUR\x20(always\x20EUR\x20for\x20CoinToPay2)'),loggerService_1[_0x4f5f2c(0x91)][_0x4f5f2c(0xa9)](_0x4f5f2c(0xeb),_0x4f5f2c(0x107),_0x4f5f2c(0xdb),_0x94a1b2);const _0x3df74e=await fetch(this['apiUrl'],{'method':_0x4f5f2c(0xdb),'headers':{'Content-Type':_0x4f5f2c(0xac),'Accept':'application/json','User-Agent':_0x4f5f2c(0x102)},'body':JSON[_0x4f5f2c(0xa5)](_0x94a1b2)}),_0x5cd85e=Date[_0x4f5f2c(0xfd)]()-_0xac92d5;console[_0x4f5f2c(0xcd)](_0x4f5f2c(0xaa)),console[_0x4f5f2c(0xcd)](_0x4f5f2c(0xe6),_0x3df74e[_0x4f5f2c(0xc6)]),console[_0x4f5f2c(0xcd)]('Status\x20Text:',_0x3df74e[_0x4f5f2c(0xf2)]),console['log'](_0x4f5f2c(0xe1),Object[_0x4f5f2c(0x101)](_0x3df74e[_0x4f5f2c(0xb4)][_0x4f5f2c(0xbc)]())),console[_0x4f5f2c(0xcd)]('Response\x20Time:',_0x5cd85e+'ms');const _0x5a3847=await _0x3df74e[_0x4f5f2c(0x100)]();console[_0x4f5f2c(0xcd)](_0x4f5f2c(0xe9),_0x5a3847);if(!_0x3df74e['ok']){console[_0x4f5f2c(0xe7)](_0x4f5f2c(0x83)),console[_0x4f5f2c(0xe7)](_0x4f5f2c(0xc3),_0x3df74e[_0x4f5f2c(0xc6)]),console[_0x4f5f2c(0xe7)]('Response\x20Body:',_0x5a3847),loggerService_1[_0x4f5f2c(0x91)]['logWhiteDomainResponse'](_0x4f5f2c(0xeb),_0x4f5f2c(0x107),_0x3df74e['status'],_0x5a3847,_0x5cd85e),loggerService_1[_0x4f5f2c(0x91)][_0x4f5f2c(0x9f)](_0x4f5f2c(0xeb),_0x4f5f2c(0x107),_0x4f5f2c(0x8e)+_0x3df74e['status']+':\x20'+_0x5a3847);throw new Error(_0x4f5f2c(0xc2)+_0x3df74e['status']+_0x4f5f2c(0x92)+_0x5a3847);}let _0x26fde5;try{_0x26fde5=JSON[_0x4f5f2c(0xba)](_0x5a3847);}catch(_0xb1db84){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0xb1db84),loggerService_1['loggerService'][_0x4f5f2c(0x9f)](_0x4f5f2c(0xeb),'/create',_0x4f5f2c(0xf7)+_0xb1db84);throw new Error(_0x4f5f2c(0xc1)+_0x5a3847);}console['log'](_0x4f5f2c(0xd2)),console[_0x4f5f2c(0xcd)](_0x4f5f2c(0xe3),JSON[_0x4f5f2c(0xa5)](_0x26fde5,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4f5f2c(0xeb),_0x4f5f2c(0x107),_0x3df74e['status'],_0x26fde5,_0x5cd85e);if(_0x26fde5[_0x4f5f2c(0xe7)]){const _0x71097f=_0x26fde5[_0x4f5f2c(0xd8)]||_0x26fde5[_0x4f5f2c(0xe7)]||'Unknown\x20error\x20from\x20CoinToPay2\x20API';console[_0x4f5f2c(0xe7)](_0x4f5f2c(0x85)),console[_0x4f5f2c(0xe7)](_0x4f5f2c(0xd9),_0x71097f),loggerService_1[_0x4f5f2c(0x91)][_0x4f5f2c(0x9f)](_0x4f5f2c(0xeb),'/create',_0x4f5f2c(0xa1)+_0x71097f);throw new Error(_0x4f5f2c(0xfb)+_0x71097f);}if(!_0x26fde5['payment_url']||!_0x26fde5['gateway_payment_id']){console['error']('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4f5f2c(0xe7)](_0x4f5f2c(0x8d)),console[_0x4f5f2c(0xe7)]('Response\x20data:',_0x26fde5),loggerService_1[_0x4f5f2c(0x91)][_0x4f5f2c(0x9f)](_0x4f5f2c(0xeb),_0x4f5f2c(0x107),_0x4f5f2c(0xea));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x4f5f2c(0xcd)](_0x4f5f2c(0x99)),console[_0x4f5f2c(0xcd)]('Gateway\x20Payment\x20ID:',_0x26fde5[_0x4f5f2c(0xf8)]),console[_0x4f5f2c(0xcd)](_0x4f5f2c(0xbe),_0x26fde5[_0x4f5f2c(0x86)]);const _0x1556b2=_0x26fde5['payment_url']+_0x4f5f2c(0x9e);return console['log'](_0x4f5f2c(0xe2),_0x1556b2),console['log']('Amount:',_0x5edd85,_0x4f5f2c(0xa4)),{'gateway_payment_id':_0x26fde5[_0x4f5f2c(0xf8)],'payment_url':_0x1556b2};}catch(_0x3cb5de){console['error'](_0x4f5f2c(0xd4)),console['error'](_0x4f5f2c(0xb1),_0x3cb5de),loggerService_1[_0x4f5f2c(0x91)][_0x4f5f2c(0x9f)](_0x4f5f2c(0xeb),_0x4f5f2c(0x107),_0x3cb5de);if(_0x3cb5de instanceof Error){console[_0x4f5f2c(0xe7)](_0x4f5f2c(0xef),_0x3cb5de[_0x4f5f2c(0xd8)]),console[_0x4f5f2c(0xe7)](_0x4f5f2c(0xad),_0x3cb5de['stack']);throw new Error(_0x4f5f2c(0xe4)+_0x3cb5de['message']);}throw new Error(_0x4f5f2c(0x9a));}}async['checkPaymentStatus'](_0x5318c9){const _0x512356=a46_0x36601b,_0x4ae61d=Date[_0x512356(0xfd)]();try{console['log'](_0x512356(0xa7)+_0x5318c9);const _0x5810f1={'gatewayPaymentId':_0x5318c9};loggerService_1[_0x512356(0x91)][_0x512356(0xa9)](_0x512356(0xeb),'/status','POST',_0x5810f1);const _0x6cbc48=await fetch(this[_0x512356(0xde)],{'method':_0x512356(0xdb),'headers':{'Content-Type':_0x512356(0xac),'Accept':_0x512356(0xac),'User-Agent':_0x512356(0x102)},'body':JSON[_0x512356(0xa5)](_0x5810f1)}),_0x338d5b=Date[_0x512356(0xfd)]()-_0x4ae61d;console[_0x512356(0xcd)](_0x512356(0xb0)),console['log']('Status:',_0x6cbc48[_0x512356(0xc6)]),console[_0x512356(0xcd)](_0x512356(0xb5),_0x338d5b+'ms');if(!_0x6cbc48['ok']){const _0x2cbadf=await _0x6cbc48[_0x512356(0x100)]();console[_0x512356(0xe7)](_0x512356(0xc3),_0x6cbc48[_0x512356(0xc6)]),console[_0x512356(0xe7)](_0x512356(0x82),_0x2cbadf),loggerService_1[_0x512356(0x91)][_0x512356(0xc0)]('cointopay2',_0x512356(0xff),_0x6cbc48[_0x512356(0xc6)],_0x2cbadf,_0x338d5b),loggerService_1['loggerService']['logWhiteDomainError'](_0x512356(0xeb),_0x512356(0xff),'HTTP\x20'+_0x6cbc48[_0x512356(0xc6)]+':\x20'+_0x2cbadf);throw new Error('HTTP\x20error!\x20status:\x20'+_0x6cbc48[_0x512356(0xc6)]);}const _0x2d9add=await _0x6cbc48[_0x512356(0x100)]();console[_0x512356(0xcd)](_0x512356(0xe9),_0x2d9add);let _0x85a404;try{_0x85a404=JSON[_0x512356(0xba)](_0x2d9add);}catch(_0x5438ce){console[_0x512356(0xe7)](_0x512356(0xcb),_0x5438ce),loggerService_1['loggerService'][_0x512356(0x9f)]('cointopay2','/status',_0x512356(0xf7)+_0x5438ce);throw new Error(_0x512356(0xfe)+_0x2d9add);}loggerService_1[_0x512356(0x91)][_0x512356(0xc0)]('cointopay2',_0x512356(0xff),_0x6cbc48['status'],_0x85a404,_0x338d5b),console[_0x512356(0xcd)]('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console[_0x512356(0xcd)](_0x512356(0xca),_0x85a404[_0x512356(0xfc)]),console['log'](_0x512356(0x88),_0x85a404[_0x512356(0xaf)]),console[_0x512356(0xcd)]('Payment\x20Status:',_0x85a404['data']?.[_0x512356(0xc5)]),console[_0x512356(0xcd)](_0x512356(0xf1),_0x85a404[_0x512356(0xc4)]?.[_0x512356(0xd3)]),console[_0x512356(0xcd)](_0x512356(0x8f),_0x85a404[_0x512356(0xc4)]?.[_0x512356(0xf4)]);if(_0x85a404[_0x512356(0xfc)]!==_0x512356(0x10a)||_0x85a404[_0x512356(0xaf)]!==0xc8){const _0x2b6d62=_0x85a404[_0x512356(0xd8)]||'Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API';console[_0x512356(0xe7)](_0x512356(0xbb)),console[_0x512356(0xe7)](_0x512356(0xd9),_0x2b6d62),loggerService_1['loggerService']['logWhiteDomainError'](_0x512356(0xeb),_0x512356(0xff),_0x512356(0x8c)+_0x2b6d62);throw new Error(_0x512356(0xe0)+_0x2b6d62);}if(!_0x85a404['data']){console['error'](_0x512356(0x87)),console[_0x512356(0xe7)](_0x512356(0xa2)),loggerService_1[_0x512356(0x91)][_0x512356(0x9f)](_0x512356(0xeb),_0x512356(0xff),_0x512356(0x9c));throw new Error(_0x512356(0x94));}let _0x29bf2d=_0x512356(0xcf);switch(_0x85a404[_0x512356(0xc4)][_0x512356(0xc5)]?.['toLowerCase']()){case _0x512356(0xee):_0x29bf2d=_0x512356(0x9b);break;case'cancelled':case _0x512356(0x7f):case _0x512356(0xe7):_0x29bf2d=_0x512356(0xb9);break;case'expired':case'timeout':_0x29bf2d=_0x512356(0x105);break;case _0x512356(0xfa):case _0x512356(0x97):case _0x512356(0xb2):case _0x512356(0xd6):default:_0x29bf2d='PENDING';break;}let _0x2cecb9,_0x382195;if(_0x85a404[_0x512356(0xc4)][_0x512356(0x81)]){const _0x388f9c=_0x85a404[_0x512356(0xc4)][_0x512356(0x81)];console[_0x512356(0xcd)]('🏦\x20Payment\x20Detail:',_0x388f9c);const _0x10fc55=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x549e41 of _0x10fc55){const _0x594580=_0x388f9c[_0x512356(0xed)](_0x549e41);if(_0x594580){_0x2cecb9=_0x594580[0x1],console[_0x512356(0xcd)]('🏦\x20Extracted\x20IBAN:',_0x2cecb9,_0x512356(0xb7),_0x549e41[_0x512356(0xf5)]);break;}}if(!_0x2cecb9){console[_0x512356(0xcd)]('⚠️\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x2b406b=_0x388f9c[_0x512356(0xed)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x2b406b&&(_0x2cecb9=_0x2b406b[0x1],console[_0x512356(0xcd)]('🏦\x20Extracted\x20IBAN\x20via\x20fallback:',_0x2cecb9));}_0x382195=_0x388f9c;}const _0x31e0b7={'iban':_0x2cecb9,'bankDetails':_0x382195,'transactionId':_0x85a404[_0x512356(0xc4)]['TransactionID'],'coinAddress':_0x85a404[_0x512356(0xc4)][_0x512356(0x93)],'qrCodeUrl':_0x85a404[_0x512356(0xc4)][_0x512356(0x108)],'expiryTime':_0x85a404[_0x512356(0xc4)][_0x512356(0xdc)],'createdOn':_0x85a404[_0x512356(0xc4)]['CreatedOn'],'confirmedOn':_0x85a404[_0x512356(0xc4)][_0x512356(0xf6)]};console['log'](_0x512356(0x109)),console[_0x512356(0xcd)](_0x512356(0xe6),_0x85a404[_0x512356(0xc4)]['Status'],'->',_0x29bf2d),console['log'](_0x512356(0xf1),_0x85a404[_0x512356(0xc4)][_0x512356(0xd3)],_0x85a404[_0x512356(0xc4)][_0x512356(0xf4)]),console[_0x512356(0xcd)](_0x512356(0xc8),_0x85a404['data'][_0x512356(0x104)]),console[_0x512356(0xcd)](_0x512356(0x103),_0x2cecb9||_0x512356(0xdd)),console['log'](_0x512356(0xdf),_0x85a404[_0x512356(0xc4)]['CreatedOn']),console[_0x512356(0xcd)]('Confirmed\x20On:',_0x85a404[_0x512356(0xc4)][_0x512356(0xf6)]||'not\x20confirmed');if(_0x85a404['data']['Status']?.[_0x512356(0xa0)]()==='awaiting\x20fiat')console[_0x512356(0xcd)](_0x512356(0x7e));else _0x85a404[_0x512356(0xc4)][_0x512356(0xc5)]?.[_0x512356(0xa0)]()==='paid'&&console[_0x512356(0xcd)](_0x512356(0x106));return{'status':_0x29bf2d,'amount':parseFloat(_0x85a404['data'][_0x512356(0xd3)])||undefined,'currency':_0x85a404[_0x512356(0xc4)][_0x512356(0xf4)]||_0x512356(0xa4),'paymentDetails':_0x31e0b7};}catch(_0x23ae25){console['error'](_0x512356(0xb3),_0x23ae25),loggerService_1['loggerService']['logWhiteDomainError']('cointopay2',_0x512356(0xff),_0x23ae25);throw new Error('Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20'+(_0x23ae25 instanceof Error?_0x23ae25[_0x512356(0xd8)]:_0x512356(0xa3)));}}async[a46_0x36601b(0x89)](_0x1b9596){const _0x119767=a46_0x36601b,_0x31fac6=await this['checkPaymentStatus'](_0x1b9596);return{'status':_0x31fac6[_0x119767(0xc6)],'amount':_0x31fac6[_0x119767(0xf0)],'currency':_0x31fac6[_0x119767(0x9d)]};}async[a46_0x36601b(0x96)](_0x1e4452){const _0x2ed896=a46_0x36601b;console[_0x2ed896(0xcd)](_0x2ed896(0x90),_0x1e4452);let _0x58bc5c='PENDING';switch(_0x1e4452['status']?.[_0x2ed896(0xa0)]()){case'paid':_0x58bc5c='PAID';break;case _0x2ed896(0xce):case _0x2ed896(0x7f):case _0x2ed896(0xe7):_0x58bc5c='FAILED';break;case _0x2ed896(0xb6):case _0x2ed896(0xb8):_0x58bc5c=_0x2ed896(0x105);break;case _0x2ed896(0xb2):case _0x2ed896(0xfa):case _0x2ed896(0x97):case'created':default:_0x58bc5c=_0x2ed896(0xcf);break;}return{'paymentId':_0x1e4452[_0x2ed896(0x8a)]||_0x1e4452[_0x2ed896(0x8b)]||'','status':_0x58bc5c,'amount':_0x1e4452[_0x2ed896(0xf0)],'currency':_0x1e4452[_0x2ed896(0x9d)]||_0x2ed896(0xa4)};}}exports[a46_0x36601b(0xab)]=CoinToPay2Service;