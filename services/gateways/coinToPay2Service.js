'use strict';const a42_0x3b2935=a42_0x2075;(function(_0x4ce705,_0x597a60){const _0x430140=a42_0x2075,_0x51048f=_0x4ce705();while(!![]){try{const _0x6b8d50=parseInt(_0x430140(0x13a))/0x1+-parseInt(_0x430140(0x19a))/0x2*(-parseInt(_0x430140(0x18b))/0x3)+parseInt(_0x430140(0x18d))/0x4*(parseInt(_0x430140(0x161))/0x5)+-parseInt(_0x430140(0x16c))/0x6*(-parseInt(_0x430140(0x17b))/0x7)+parseInt(_0x430140(0x16f))/0x8+parseInt(_0x430140(0x162))/0x9+-parseInt(_0x430140(0x160))/0xa;if(_0x6b8d50===_0x597a60)break;else _0x51048f['push'](_0x51048f['shift']());}catch(_0x46dbc1){_0x51048f['push'](_0x51048f['shift']());}}}(a42_0x44f1,0x3a532));function a42_0x44f1(){const _0x2144e2=['Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY2\x20SUCCESS\x20===','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','result','text','cointopay2','EXPIRED','apiUrl','logWhiteDomainResponse','gateway_payment_id','../loggerService','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Status:','/status','FAILED','362257UGWAoF','now','createPaymentLink','Payment\x20Status:','Failed\x20to\x20parse\x20JSON\x20response:','awaiting\x20fiat','CoinToPay2\x20API\x20error:\x20','order_id','TransactionID','status','Gateway\x20Payment\x20ID:','cancelled','log','Parsed\x20Result:','https://traffer.uk/gateway/cointopay/','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','Response\x20Body:','Raw\x20Response\x20Body:','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','Result:','entries','merchant_reference_id','not\x20found','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','application/json','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Error\x20details:','CoinToPay2Service','loggerService','statusText','Status','IBAN:','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','timeout','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','üè¶\x20Extracted\x20IBAN:','TransactionConfirmedOn','15806650wqIQYo','485135eLrVYf','3678282ddUUYw','Status\x20API\x20Error:\x20','checkPaymentStatus','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','paid','success','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','message','data','2695830ZbeVdS','Amount','EUR','967432AReuYz','Incomplete\x20response:\x20missing\x20data','Confirmed\x20On:','coinAddress','statusUrl','waiting','not\x20confirmed','Transaction\x20ID:','stringify','Request\x20Body:','Unknown\x20error','__esModule','7IxZKlL','POST','Missing\x20data\x20in\x20response','ExpiryTime','Unknown\x20error\x20from\x20CoinToPay2\x20API','amount','HTTP\x20','inputCurrency','URL:','payment_url','error','failed','Currency:','created','logWhiteDomainError','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','1144041uRPtSH','Payment\x20URL:','4SPTECr','pending','CoinToPay2\x20status\x20API\x20error:\x20','headers','HTTP\x20Status:','source','JSON\x20Parse\x20Error:\x20','match','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Status\x20Text:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','Amount:','PAID','2cuswns','Created\x20On:','expired','logWhiteDomainRequest','Status\x20Code:','/create','Error\x20Message:','üè¶\x20Payment\x20Detail:','Business\x20Error:\x20','currency','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','status_code','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','CreatedOn','processWebhook','toLowerCase','PaymentDetail','PENDING'];a42_0x44f1=function(){return _0x2144e2;};return a42_0x44f1();}Object['defineProperty'](exports,a42_0x3b2935(0x17a),{'value':!![]}),exports['CoinToPay2Service']=void 0x0;const loggerService_1=require(a42_0x3b2935(0x135));class CoinToPay2Service{constructor(){const _0x15377b=a42_0x3b2935;this[_0x15377b(0x132)]=_0x15377b(0x148),this[_0x15377b(0x173)]='https://traffer.uk/gateway/cointopay/status.php',console[_0x15377b(0x146)](_0x15377b(0x12d)),console[_0x15377b(0x146)]('üìä\x20Status\x20check\x20URL:',this[_0x15377b(0x173)]);}async[a42_0x3b2935(0x13c)](_0x1329cb){const _0x37a84b=a42_0x3b2935,{orderId:_0x24b85d,amount:_0x224f74}=_0x1329cb;console[_0x37a84b(0x146)]('ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20'+_0x224f74+'\x20EUR');const _0x5c2242={'amount':_0x224f74},_0xfd6f47=Date['now']();try{console[_0x37a84b(0x146)](_0x37a84b(0x15a)),console[_0x37a84b(0x146)](_0x37a84b(0x183),this[_0x37a84b(0x132)]),console[_0x37a84b(0x146)](_0x37a84b(0x178),JSON[_0x37a84b(0x177)](_0x5c2242,null,0x2)),console['log'](_0x37a84b(0x198),_0x224f74,'EUR\x20(always\x20EUR\x20for\x20CoinToPay2)'),loggerService_1[_0x37a84b(0x156)][_0x37a84b(0x19d)](_0x37a84b(0x130),_0x37a84b(0x19f),_0x37a84b(0x17c),_0x5c2242);const _0x206bde=await fetch(this[_0x37a84b(0x132)],{'method':_0x37a84b(0x17c),'headers':{'Content-Type':_0x37a84b(0x152),'Accept':_0x37a84b(0x152),'User-Agent':_0x37a84b(0x1a7)},'body':JSON[_0x37a84b(0x177)](_0x5c2242)}),_0x41206a=Date[_0x37a84b(0x13b)]()-_0xfd6f47;console[_0x37a84b(0x146)]('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console['log'](_0x37a84b(0x137),_0x206bde[_0x37a84b(0x143)]),console[_0x37a84b(0x146)](_0x37a84b(0x196),_0x206bde[_0x37a84b(0x157)]),console[_0x37a84b(0x146)]('Headers:',Object['fromEntries'](_0x206bde[_0x37a84b(0x190)][_0x37a84b(0x14e)]())),console[_0x37a84b(0x146)]('Response\x20Time:',_0x41206a+'ms');const _0x128a81=await _0x206bde[_0x37a84b(0x12f)]();console[_0x37a84b(0x146)](_0x37a84b(0x14b),_0x128a81);if(!_0x206bde['ok']){console[_0x37a84b(0x185)]('===\x20COINTOPAY2\x20API\x20ERROR\x20==='),console['error'](_0x37a84b(0x191),_0x206bde[_0x37a84b(0x143)]),console[_0x37a84b(0x185)](_0x37a84b(0x14a),_0x128a81),loggerService_1[_0x37a84b(0x156)]['logWhiteDomainResponse']('cointopay2',_0x37a84b(0x19f),_0x206bde[_0x37a84b(0x143)],_0x128a81,_0x41206a),loggerService_1[_0x37a84b(0x156)]['logWhiteDomainError'](_0x37a84b(0x130),_0x37a84b(0x19f),'HTTP\x20'+_0x206bde[_0x37a84b(0x143)]+':\x20'+_0x128a81);throw new Error('HTTP\x20error!\x20status:\x20'+_0x206bde[_0x37a84b(0x143)]+',\x20body:\x20'+_0x128a81);}let _0x49cd43;try{_0x49cd43=JSON['parse'](_0x128a81);}catch(_0x3e6f6d){console[_0x37a84b(0x185)](_0x37a84b(0x13e),_0x3e6f6d),loggerService_1['loggerService'][_0x37a84b(0x189)](_0x37a84b(0x130),_0x37a84b(0x19f),_0x37a84b(0x193)+_0x3e6f6d);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20'+_0x128a81);}console[_0x37a84b(0x146)](_0x37a84b(0x1a4)),console[_0x37a84b(0x146)](_0x37a84b(0x147),JSON[_0x37a84b(0x177)](_0x49cd43,null,0x2)),loggerService_1['loggerService'][_0x37a84b(0x133)]('cointopay2',_0x37a84b(0x19f),_0x206bde['status'],_0x49cd43,_0x41206a);if(_0x49cd43[_0x37a84b(0x185)]){const _0x330b30=_0x49cd43[_0x37a84b(0x16a)]||_0x49cd43['error']||_0x37a84b(0x17f);console['error'](_0x37a84b(0x14c)),console[_0x37a84b(0x185)](_0x37a84b(0x1a0),_0x330b30),loggerService_1[_0x37a84b(0x156)]['logWhiteDomainError'](_0x37a84b(0x130),_0x37a84b(0x19f),_0x37a84b(0x1a2)+_0x330b30);throw new Error(_0x37a84b(0x140)+_0x330b30);}if(!_0x49cd43[_0x37a84b(0x184)]||!_0x49cd43[_0x37a84b(0x134)]){console[_0x37a84b(0x185)]('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x37a84b(0x185)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x37a84b(0x185)]('Response\x20data:',_0x49cd43),loggerService_1[_0x37a84b(0x156)][_0x37a84b(0x189)](_0x37a84b(0x130),_0x37a84b(0x19f),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x37a84b(0x12c));}return console[_0x37a84b(0x146)](_0x37a84b(0x12b)),console[_0x37a84b(0x146)](_0x37a84b(0x144),_0x49cd43[_0x37a84b(0x134)]),console[_0x37a84b(0x146)](_0x37a84b(0x18c),_0x49cd43[_0x37a84b(0x184)]),console['log'](_0x37a84b(0x198),_0x224f74,_0x37a84b(0x16e)),{'gateway_payment_id':_0x49cd43['gateway_payment_id'],'payment_url':_0x49cd43[_0x37a84b(0x184)]};}catch(_0x453651){console[_0x37a84b(0x185)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console['error'](_0x37a84b(0x154),_0x453651),loggerService_1[_0x37a84b(0x156)][_0x37a84b(0x189)](_0x37a84b(0x130),_0x37a84b(0x19f),_0x453651);if(_0x453651 instanceof Error){console[_0x37a84b(0x185)]('Error\x20message:',_0x453651[_0x37a84b(0x16a)]),console[_0x37a84b(0x185)]('Error\x20stack:',_0x453651['stack']);throw new Error(_0x37a84b(0x197)+_0x453651[_0x37a84b(0x16a)]);}throw new Error(_0x37a84b(0x18a));}}async[a42_0x3b2935(0x164)](_0x529f0c){const _0x2c36e1=a42_0x3b2935,_0x11d8b6=Date[_0x2c36e1(0x13b)]();try{console['log'](_0x2c36e1(0x136)+_0x529f0c);const _0x47c1aa={'gatewayPaymentId':_0x529f0c};loggerService_1[_0x2c36e1(0x156)][_0x2c36e1(0x19d)](_0x2c36e1(0x130),_0x2c36e1(0x138),'POST',_0x47c1aa);const _0x3b063c=await fetch(this[_0x2c36e1(0x173)],{'method':_0x2c36e1(0x17c),'headers':{'Content-Type':_0x2c36e1(0x152),'Accept':_0x2c36e1(0x152),'User-Agent':_0x2c36e1(0x1a7)},'body':JSON[_0x2c36e1(0x177)](_0x47c1aa)}),_0x5f4a82=Date['now']()-_0x11d8b6;console[_0x2c36e1(0x146)](_0x2c36e1(0x165)),console[_0x2c36e1(0x146)]('Status:',_0x3b063c[_0x2c36e1(0x143)]),console[_0x2c36e1(0x146)]('Response\x20Time:',_0x5f4a82+'ms');if(!_0x3b063c['ok']){const _0x307b2d=await _0x3b063c[_0x2c36e1(0x12f)]();console[_0x2c36e1(0x185)]('HTTP\x20Status:',_0x3b063c[_0x2c36e1(0x143)]),console[_0x2c36e1(0x185)](_0x2c36e1(0x14a),_0x307b2d),loggerService_1[_0x2c36e1(0x156)][_0x2c36e1(0x133)](_0x2c36e1(0x130),_0x2c36e1(0x138),_0x3b063c[_0x2c36e1(0x143)],_0x307b2d,_0x5f4a82),loggerService_1[_0x2c36e1(0x156)][_0x2c36e1(0x189)](_0x2c36e1(0x130),_0x2c36e1(0x138),_0x2c36e1(0x181)+_0x3b063c[_0x2c36e1(0x143)]+':\x20'+_0x307b2d);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3b063c[_0x2c36e1(0x143)]);}const _0xf3c882=await _0x3b063c['text']();console['log'](_0x2c36e1(0x14b),_0xf3c882);let _0x3484eb;try{_0x3484eb=JSON['parse'](_0xf3c882);}catch(_0x4e9d67){console[_0x2c36e1(0x185)](_0x2c36e1(0x13e),_0x4e9d67),loggerService_1['loggerService'][_0x2c36e1(0x189)](_0x2c36e1(0x130),_0x2c36e1(0x138),'JSON\x20Parse\x20Error:\x20'+_0x4e9d67);throw new Error(_0x2c36e1(0x169)+_0xf3c882);}loggerService_1[_0x2c36e1(0x156)][_0x2c36e1(0x133)]('cointopay2','/status',_0x3b063c['status'],_0x3484eb,_0x5f4a82),console[_0x2c36e1(0x146)]('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console[_0x2c36e1(0x146)](_0x2c36e1(0x14d),_0x3484eb[_0x2c36e1(0x12e)]),console['log'](_0x2c36e1(0x19e),_0x3484eb['status_code']),console[_0x2c36e1(0x146)](_0x2c36e1(0x13d),_0x3484eb['data']?.['Status']),console[_0x2c36e1(0x146)](_0x2c36e1(0x198),_0x3484eb[_0x2c36e1(0x16b)]?.[_0x2c36e1(0x16d)]),console[_0x2c36e1(0x146)](_0x2c36e1(0x187),_0x3484eb[_0x2c36e1(0x16b)]?.['inputCurrency']);if(_0x3484eb[_0x2c36e1(0x12e)]!==_0x2c36e1(0x167)||_0x3484eb[_0x2c36e1(0x1a5)]!==0xc8){const _0x12a4ab=_0x3484eb[_0x2c36e1(0x16a)]||_0x2c36e1(0x195);console['error']('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console[_0x2c36e1(0x185)](_0x2c36e1(0x1a0),_0x12a4ab),loggerService_1[_0x2c36e1(0x156)]['logWhiteDomainError']('cointopay2','/status',_0x2c36e1(0x163)+_0x12a4ab);throw new Error(_0x2c36e1(0x18f)+_0x12a4ab);}if(!_0x3484eb[_0x2c36e1(0x16b)]){console['error'](_0x2c36e1(0x15c)),console[_0x2c36e1(0x185)](_0x2c36e1(0x17d)),loggerService_1[_0x2c36e1(0x156)][_0x2c36e1(0x189)](_0x2c36e1(0x130),_0x2c36e1(0x138),_0x2c36e1(0x170));throw new Error(_0x2c36e1(0x15d));}let _0x4c7ff8=_0x2c36e1(0x1ac);switch(_0x3484eb[_0x2c36e1(0x16b)][_0x2c36e1(0x158)]?.[_0x2c36e1(0x1aa)]()){case'paid':_0x4c7ff8=_0x2c36e1(0x199);break;case _0x2c36e1(0x145):case _0x2c36e1(0x186):case _0x2c36e1(0x185):_0x4c7ff8=_0x2c36e1(0x139);break;case _0x2c36e1(0x19c):case'timeout':_0x4c7ff8=_0x2c36e1(0x131);break;case _0x2c36e1(0x174):case _0x2c36e1(0x13f):case _0x2c36e1(0x18e):case _0x2c36e1(0x188):default:_0x4c7ff8=_0x2c36e1(0x1ac);break;}let _0x3348ca,_0x40b1a6;if(_0x3484eb[_0x2c36e1(0x16b)]['PaymentDetail']){const _0x29772d=_0x3484eb[_0x2c36e1(0x16b)][_0x2c36e1(0x1ab)];console[_0x2c36e1(0x146)](_0x2c36e1(0x1a1),_0x29772d);const _0x3c37ab=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x39e7a3 of _0x3c37ab){const _0x348910=_0x29772d['match'](_0x39e7a3);if(_0x348910){_0x3348ca=_0x348910[0x1],console[_0x2c36e1(0x146)](_0x2c36e1(0x15e),_0x3348ca,'using\x20pattern:',_0x39e7a3[_0x2c36e1(0x192)]);break;}}if(!_0x3348ca){console['log'](_0x2c36e1(0x151));const _0x3c86e6=_0x29772d[_0x2c36e1(0x194)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x3c86e6&&(_0x3348ca=_0x3c86e6[0x1],console['log'](_0x2c36e1(0x168),_0x3348ca));}_0x40b1a6=_0x29772d;}const _0x423b4b={'iban':_0x3348ca,'bankDetails':_0x40b1a6,'transactionId':_0x3484eb[_0x2c36e1(0x16b)]['TransactionID'],'coinAddress':_0x3484eb[_0x2c36e1(0x16b)][_0x2c36e1(0x172)],'qrCodeUrl':_0x3484eb[_0x2c36e1(0x16b)]['QRCodeURL'],'expiryTime':_0x3484eb[_0x2c36e1(0x16b)][_0x2c36e1(0x17e)],'createdOn':_0x3484eb['data']['CreatedOn'],'confirmedOn':_0x3484eb['data'][_0x2c36e1(0x15f)]};console[_0x2c36e1(0x146)]('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console[_0x2c36e1(0x146)](_0x2c36e1(0x137),_0x3484eb[_0x2c36e1(0x16b)][_0x2c36e1(0x158)],'->',_0x4c7ff8),console[_0x2c36e1(0x146)]('Amount:',_0x3484eb[_0x2c36e1(0x16b)][_0x2c36e1(0x16d)],_0x3484eb[_0x2c36e1(0x16b)][_0x2c36e1(0x182)]),console['log'](_0x2c36e1(0x176),_0x3484eb['data'][_0x2c36e1(0x142)]),console[_0x2c36e1(0x146)](_0x2c36e1(0x159),_0x3348ca||_0x2c36e1(0x150)),console['log'](_0x2c36e1(0x19b),_0x3484eb[_0x2c36e1(0x16b)][_0x2c36e1(0x1a8)]),console[_0x2c36e1(0x146)](_0x2c36e1(0x171),_0x3484eb[_0x2c36e1(0x16b)]['TransactionConfirmedOn']||_0x2c36e1(0x175));if(_0x3484eb[_0x2c36e1(0x16b)][_0x2c36e1(0x158)]?.[_0x2c36e1(0x1aa)]()===_0x2c36e1(0x13f))console['log'](_0x2c36e1(0x153));else _0x3484eb['data']['Status']?.[_0x2c36e1(0x1aa)]()===_0x2c36e1(0x166)&&console[_0x2c36e1(0x146)](_0x2c36e1(0x1a6));return{'status':_0x4c7ff8,'amount':parseFloat(_0x3484eb[_0x2c36e1(0x16b)]['Amount'])||undefined,'currency':_0x3484eb[_0x2c36e1(0x16b)][_0x2c36e1(0x182)]||_0x2c36e1(0x16e),'paymentDetails':_0x423b4b};}catch(_0x11470f){console[_0x2c36e1(0x185)]('CoinToPay2\x20payment\x20status\x20check\x20error:',_0x11470f),loggerService_1[_0x2c36e1(0x156)][_0x2c36e1(0x189)](_0x2c36e1(0x130),_0x2c36e1(0x138),_0x11470f);throw new Error(_0x2c36e1(0x149)+(_0x11470f instanceof Error?_0x11470f['message']:_0x2c36e1(0x179)));}}async['verifyPayment'](_0x33a7a1){const _0x429b29=a42_0x3b2935,_0x59ab51=await this['checkPaymentStatus'](_0x33a7a1);return{'status':_0x59ab51['status'],'amount':_0x59ab51[_0x429b29(0x180)],'currency':_0x59ab51[_0x429b29(0x1a3)]};}async[a42_0x3b2935(0x1a9)](_0x5559ad){const _0x118ada=a42_0x3b2935;console[_0x118ada(0x146)](_0x118ada(0x12a),_0x5559ad);let _0x2c82a0=_0x118ada(0x1ac);switch(_0x5559ad[_0x118ada(0x143)]?.['toLowerCase']()){case _0x118ada(0x166):_0x2c82a0=_0x118ada(0x199);break;case _0x118ada(0x145):case _0x118ada(0x186):case _0x118ada(0x185):_0x2c82a0=_0x118ada(0x139);break;case'expired':case _0x118ada(0x15b):_0x2c82a0=_0x118ada(0x131);break;case _0x118ada(0x18e):case _0x118ada(0x174):case _0x118ada(0x13f):case _0x118ada(0x188):default:_0x2c82a0=_0x118ada(0x1ac);break;}return{'paymentId':_0x5559ad[_0x118ada(0x141)]||_0x5559ad[_0x118ada(0x14f)]||'','status':_0x2c82a0,'amount':_0x5559ad['amount'],'currency':_0x5559ad[_0x118ada(0x1a3)]||_0x118ada(0x16e)};}}function a42_0x2075(_0x236504,_0x40adb6){const _0x44f153=a42_0x44f1();return a42_0x2075=function(_0x2075b4,_0x351ba4){_0x2075b4=_0x2075b4-0x12a;let _0xf7acf5=_0x44f153[_0x2075b4];return _0xf7acf5;},a42_0x2075(_0x236504,_0x40adb6);}exports[a42_0x3b2935(0x155)]=CoinToPay2Service;