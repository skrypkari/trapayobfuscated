'use strict';const a64_0x178ed7=a64_0x54b2;(function(_0x3ab3f6,_0x3db46c){const _0x45b068=a64_0x54b2,_0x38d69e=_0x3ab3f6();while(!![]){try{const _0x35518b=-parseInt(_0x45b068(0xf4))/0x1*(-parseInt(_0x45b068(0xef))/0x2)+parseInt(_0x45b068(0xc3))/0x3+-parseInt(_0x45b068(0x108))/0x4+-parseInt(_0x45b068(0x116))/0x5*(-parseInt(_0x45b068(0xbe))/0x6)+parseInt(_0x45b068(0x10d))/0x7+parseInt(_0x45b068(0xce))/0x8+-parseInt(_0x45b068(0x133))/0x9;if(_0x35518b===_0x3db46c)break;else _0x38d69e['push'](_0x38d69e['shift']());}catch(_0x28ecb3){_0x38d69e['push'](_0x38d69e['shift']());}}}(a64_0x2eab,0x6579a));Object[a64_0x178ed7(0xfc)](exports,a64_0x178ed7(0xe0),{'value':!![]}),exports['CoinToPay2Service']=void 0x0;function a64_0x2eab(){const _0x1d391d=['PAID','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','Confirmed\x20On:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','currency','Error\x20details:','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','success','JSON\x20Parse\x20Error:\x20','CoinToPay2Service','using\x20pattern:','HTTP\x20','processWebhook','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','__esModule','Business\x20Error:\x20','===\x20COINTOPAY2\x20SUCCESS\x20===','QRCodeURL','statusUrl','Status\x20API\x20Error:\x20','headers','Payment\x20System/1.0\x20(CoinToPay2)','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Amount','/status','Raw\x20Response\x20Body:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','toLowerCase','18fczRRr','application/json','parse','Error\x20stack:','failed','27490NCaVSL',',\x20body:\x20','Response\x20Body:','PaymentDetail','Payment\x20Status:','EUR','Result:','Transaction\x20ID:','defineProperty','Error\x20message:','Failed\x20to\x20parse\x20JSON\x20response:','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20error!\x20status:\x20','inputCurrency','===\x20COINTOPAY2\x20API\x20ERROR\x20===','URL:','Parsed\x20Result:','data','EXPIRED','736244JwDraU','loggerService','now','error','Payment\x20URL\x20(modified):','1327137yjAaqC','CoinToPay2\x20API\x20error:\x20','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','cancelled','verifyPayment','../loggerService','Gateway\x20Payment\x20ID:','log','Status','167305JwfbMH','Missing\x20data\x20in\x20response','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','fromEntries','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','status','CoinToPay2\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','checkPaymentStatus','apiUrl','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Response\x20Time:','waiting','stack','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','TransactionID','PENDING','Response\x20data:','CreatedOn','logWhiteDomainError','Amount:','timeout','text','status_code','message','FAILED','Status\x20Text:','12030327rndodg','/create','IBAN:','createPaymentLink','ExpiryTime','Currency:','HTTP\x20Status:','not\x20found','stringify','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','amount','&alternative=false','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','source','created','CoinToPay2\x20status\x20API\x20error:\x20','match','Status:','gateway_payment_id','114vfBVTI','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','cointopay2','logWhiteDomainRequest','pending','1274523rZertx','order_id','result','üè¶\x20Extracted\x20IBAN:','POST','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Created\x20On:','TransactionConfirmedOn','logWhiteDomainResponse','https://traffer.uk/gateway/cointopay/','Error\x20Message:','3510440EHVQXX','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','payment_url','Unknown\x20error\x20from\x20CoinToPay2\x20API'];a64_0x2eab=function(){return _0x1d391d;};return a64_0x2eab();}function a64_0x54b2(_0x122618,_0x3fd2de){_0x122618=_0x122618-0xbe;const _0x2eab07=a64_0x2eab();let _0x54b247=_0x2eab07[_0x122618];return _0x54b247;}const loggerService_1=require(a64_0x178ed7(0x112));class CoinToPay2Service{constructor(){const _0x536027=a64_0x178ed7;this[_0x536027(0x11f)]=_0x536027(0xcc),this[_0x536027(0xe4)]='https://traffer.uk/gateway/cointopay/status.php',console['log'](_0x536027(0x11a)),console['log']('üìä\x20Status\x20check\x20URL:',this[_0x536027(0xe4)]);}async[a64_0x178ed7(0x136)](_0x17fd1f){const _0x1ccce0=a64_0x178ed7,{orderId:_0x25c25b,amount:_0x4c561c}=_0x17fd1f;console[_0x1ccce0(0x114)](_0x1ccce0(0x13c)+_0x4c561c+'\x20EUR');const _0x181a00={'amount':_0x4c561c},_0x12ac3e=Date[_0x1ccce0(0x10a)]();try{console[_0x1ccce0(0x114)](_0x1ccce0(0xe9)),console[_0x1ccce0(0x114)](_0x1ccce0(0x104),this['apiUrl']),console[_0x1ccce0(0x114)]('Request\x20Body:',JSON[_0x1ccce0(0x13b)](_0x181a00,null,0x2)),console[_0x1ccce0(0x114)](_0x1ccce0(0x12c),_0x4c561c,_0x1ccce0(0xff)),loggerService_1['loggerService'][_0x1ccce0(0xc1)](_0x1ccce0(0xc0),_0x1ccce0(0x134),'POST',_0x181a00);const _0x10b7ae=await fetch(this[_0x1ccce0(0x11f)],{'method':_0x1ccce0(0xc7),'headers':{'Content-Type':'application/json','Accept':_0x1ccce0(0xf0),'User-Agent':_0x1ccce0(0xe7)},'body':JSON[_0x1ccce0(0x13b)](_0x181a00)}),_0x42f8a2=Date['now']()-_0x12ac3e;console['log'](_0x1ccce0(0x10f)),console[_0x1ccce0(0x114)](_0x1ccce0(0x144),_0x10b7ae[_0x1ccce0(0x11b)]),console['log'](_0x1ccce0(0x132),_0x10b7ae['statusText']),console['log']('Headers:',Object[_0x1ccce0(0x119)](_0x10b7ae[_0x1ccce0(0xe6)]['entries']())),console[_0x1ccce0(0x114)](_0x1ccce0(0x122),_0x42f8a2+'ms');const _0x2323a9=await _0x10b7ae['text']();console['log'](_0x1ccce0(0xec),_0x2323a9);if(!_0x10b7ae['ok']){console[_0x1ccce0(0x10b)](_0x1ccce0(0x103)),console[_0x1ccce0(0x10b)](_0x1ccce0(0x139),_0x10b7ae[_0x1ccce0(0x11b)]),console['error'](_0x1ccce0(0xf6),_0x2323a9),loggerService_1['loggerService'][_0x1ccce0(0xcb)](_0x1ccce0(0xc0),'/create',_0x10b7ae[_0x1ccce0(0x11b)],_0x2323a9,_0x42f8a2),loggerService_1[_0x1ccce0(0x109)][_0x1ccce0(0x12b)](_0x1ccce0(0xc0),_0x1ccce0(0x134),_0x1ccce0(0xdd)+_0x10b7ae[_0x1ccce0(0x11b)]+':\x20'+_0x2323a9);throw new Error(_0x1ccce0(0x101)+_0x10b7ae['status']+_0x1ccce0(0xf5)+_0x2323a9);}let _0x10e082;try{_0x10e082=JSON[_0x1ccce0(0xf1)](_0x2323a9);}catch(_0x36a9da){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x36a9da),loggerService_1[_0x1ccce0(0x109)][_0x1ccce0(0x12b)]('cointopay2',_0x1ccce0(0x134),'JSON\x20Parse\x20Error:\x20'+_0x36a9da);throw new Error(_0x1ccce0(0xcf)+_0x2323a9);}console[_0x1ccce0(0x114)](_0x1ccce0(0xd5)),console[_0x1ccce0(0x114)](_0x1ccce0(0x105),JSON[_0x1ccce0(0x13b)](_0x10e082,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1ccce0(0xc0),_0x1ccce0(0x134),_0x10b7ae[_0x1ccce0(0x11b)],_0x10e082,_0x42f8a2);if(_0x10e082['error']){const _0x2489b2=_0x10e082[_0x1ccce0(0x130)]||_0x10e082[_0x1ccce0(0x10b)]||_0x1ccce0(0xd1);console[_0x1ccce0(0x10b)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x1ccce0(0x10b)](_0x1ccce0(0xcd),_0x2489b2),loggerService_1[_0x1ccce0(0x109)][_0x1ccce0(0x12b)]('cointopay2','/create',_0x1ccce0(0xe1)+_0x2489b2);throw new Error(_0x1ccce0(0x10e)+_0x2489b2);}if(!_0x10e082[_0x1ccce0(0xd0)]||!_0x10e082['gateway_payment_id']){console[_0x1ccce0(0x10b)](_0x1ccce0(0x11d)),console['error'](_0x1ccce0(0x126)),console['error'](_0x1ccce0(0x129),_0x10e082),loggerService_1[_0x1ccce0(0x109)]['logWhiteDomainError'](_0x1ccce0(0xc0),_0x1ccce0(0x134),_0x1ccce0(0xed));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x1ccce0(0x114)](_0x1ccce0(0xe2)),console[_0x1ccce0(0x114)](_0x1ccce0(0x113),_0x10e082[_0x1ccce0(0x145)]),console['log']('Payment\x20URL\x20(original):',_0x10e082[_0x1ccce0(0xd0)]);const _0x30729a=_0x10e082['payment_url']+_0x1ccce0(0x13e);return console[_0x1ccce0(0x114)](_0x1ccce0(0x10c),_0x30729a),console[_0x1ccce0(0x114)]('Amount:',_0x4c561c,_0x1ccce0(0xf9)),{'gateway_payment_id':_0x10e082[_0x1ccce0(0x145)],'payment_url':_0x30729a};}catch(_0x32cec8){console[_0x1ccce0(0x10b)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x1ccce0(0x10b)](_0x1ccce0(0xd7),_0x32cec8),loggerService_1[_0x1ccce0(0x109)][_0x1ccce0(0x12b)](_0x1ccce0(0xc0),_0x1ccce0(0x134),_0x32cec8);if(_0x32cec8 instanceof Error){console[_0x1ccce0(0x10b)](_0x1ccce0(0xfd),_0x32cec8[_0x1ccce0(0x130)]),console['error'](_0x1ccce0(0xf2),_0x32cec8[_0x1ccce0(0x124)]);throw new Error(_0x1ccce0(0x13f)+_0x32cec8['message']);}throw new Error(_0x1ccce0(0x118));}}async['checkPaymentStatus'](_0xee399e){const _0xeb7d10=a64_0x178ed7,_0x232509=Date[_0xeb7d10(0x10a)]();try{console[_0xeb7d10(0x114)]('üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0xee399e);const _0xccc036={'gatewayPaymentId':_0xee399e};loggerService_1['loggerService'][_0xeb7d10(0xc1)](_0xeb7d10(0xc0),_0xeb7d10(0xeb),_0xeb7d10(0xc7),_0xccc036);const _0x36045c=await fetch(this[_0xeb7d10(0xe4)],{'method':'POST','headers':{'Content-Type':_0xeb7d10(0xf0),'Accept':'application/json','User-Agent':_0xeb7d10(0xe7)},'body':JSON['stringify'](_0xccc036)}),_0x2e4bbb=Date[_0xeb7d10(0x10a)]()-_0x232509;console['log'](_0xeb7d10(0xd3)),console[_0xeb7d10(0x114)](_0xeb7d10(0x144),_0x36045c[_0xeb7d10(0x11b)]),console['log']('Response\x20Time:',_0x2e4bbb+'ms');if(!_0x36045c['ok']){const _0x10d43e=await _0x36045c[_0xeb7d10(0x12e)]();console[_0xeb7d10(0x10b)](_0xeb7d10(0x139),_0x36045c[_0xeb7d10(0x11b)]),console[_0xeb7d10(0x10b)]('Response\x20Body:',_0x10d43e),loggerService_1[_0xeb7d10(0x109)][_0xeb7d10(0xcb)](_0xeb7d10(0xc0),'/status',_0x36045c[_0xeb7d10(0x11b)],_0x10d43e,_0x2e4bbb),loggerService_1['loggerService'][_0xeb7d10(0x12b)](_0xeb7d10(0xc0),'/status',_0xeb7d10(0xdd)+_0x36045c[_0xeb7d10(0x11b)]+':\x20'+_0x10d43e);throw new Error(_0xeb7d10(0x101)+_0x36045c['status']);}const _0x15ca37=await _0x36045c[_0xeb7d10(0x12e)]();console[_0xeb7d10(0x114)](_0xeb7d10(0xec),_0x15ca37);let _0x5ba0e7;try{_0x5ba0e7=JSON[_0xeb7d10(0xf1)](_0x15ca37);}catch(_0x41dc27){console[_0xeb7d10(0x10b)](_0xeb7d10(0xfe),_0x41dc27),loggerService_1[_0xeb7d10(0x109)]['logWhiteDomainError'](_0xeb7d10(0xc0),_0xeb7d10(0xeb),_0xeb7d10(0xda)+_0x41dc27);throw new Error(_0xeb7d10(0xdf)+_0x15ca37);}loggerService_1[_0xeb7d10(0x109)]['logWhiteDomainResponse']('cointopay2',_0xeb7d10(0xeb),_0x36045c[_0xeb7d10(0x11b)],_0x5ba0e7,_0x2e4bbb),console[_0xeb7d10(0x114)](_0xeb7d10(0xe8)),console['log'](_0xeb7d10(0xfa),_0x5ba0e7[_0xeb7d10(0xc5)]),console[_0xeb7d10(0x114)]('Status\x20Code:',_0x5ba0e7[_0xeb7d10(0x12f)]),console[_0xeb7d10(0x114)](_0xeb7d10(0xf8),_0x5ba0e7['data']?.['Status']),console[_0xeb7d10(0x114)]('Amount:',_0x5ba0e7[_0xeb7d10(0x106)]?.[_0xeb7d10(0xea)]),console['log'](_0xeb7d10(0x138),_0x5ba0e7[_0xeb7d10(0x106)]?.[_0xeb7d10(0x102)]);if(_0x5ba0e7[_0xeb7d10(0xc5)]!==_0xeb7d10(0xd9)||_0x5ba0e7['status_code']!==0xc8){const _0x4cbd38=_0x5ba0e7['message']||'Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API';console[_0xeb7d10(0x10b)](_0xeb7d10(0x125)),console[_0xeb7d10(0x10b)](_0xeb7d10(0xcd),_0x4cbd38),loggerService_1[_0xeb7d10(0x109)]['logWhiteDomainError'](_0xeb7d10(0xc0),_0xeb7d10(0xeb),_0xeb7d10(0xe5)+_0x4cbd38);throw new Error(_0xeb7d10(0x142)+_0x4cbd38);}if(!_0x5ba0e7[_0xeb7d10(0x106)]){console[_0xeb7d10(0x10b)](_0xeb7d10(0x100)),console[_0xeb7d10(0x10b)](_0xeb7d10(0x117)),loggerService_1[_0xeb7d10(0x109)][_0xeb7d10(0x12b)](_0xeb7d10(0xc0),_0xeb7d10(0xeb),'Incomplete\x20response:\x20missing\x20data');throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0xbb918d=_0xeb7d10(0x128);switch(_0x5ba0e7[_0xeb7d10(0x106)][_0xeb7d10(0x115)]?.[_0xeb7d10(0xee)]()){case'paid':_0xbb918d=_0xeb7d10(0xd2);break;case _0xeb7d10(0x110):case'failed':case'error':_0xbb918d=_0xeb7d10(0x131);break;case'expired':case _0xeb7d10(0x12d):_0xbb918d=_0xeb7d10(0x107);break;case _0xeb7d10(0x123):case'awaiting\x20fiat':case _0xeb7d10(0xc2):case _0xeb7d10(0x141):default:_0xbb918d='PENDING';break;}let _0x3c09f0,_0x34d5d3;if(_0x5ba0e7['data']['PaymentDetail']){const _0x1da49e=_0x5ba0e7['data'][_0xeb7d10(0xf7)];console[_0xeb7d10(0x114)]('üè¶\x20Payment\x20Detail:',_0x1da49e);const _0x5d40cf=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x1fcc61 of _0x5d40cf){const _0x1f6115=_0x1da49e[_0xeb7d10(0x143)](_0x1fcc61);if(_0x1f6115){_0x3c09f0=_0x1f6115[0x1],console[_0xeb7d10(0x114)](_0xeb7d10(0xc6),_0x3c09f0,_0xeb7d10(0xdc),_0x1fcc61[_0xeb7d10(0x140)]);break;}}if(!_0x3c09f0){console[_0xeb7d10(0x114)]('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x2653d4=_0x1da49e[_0xeb7d10(0x143)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x2653d4&&(_0x3c09f0=_0x2653d4[0x1],console['log'](_0xeb7d10(0xd8),_0x3c09f0));}_0x34d5d3=_0x1da49e;}const _0x4696d5={'iban':_0x3c09f0,'bankDetails':_0x34d5d3,'transactionId':_0x5ba0e7[_0xeb7d10(0x106)][_0xeb7d10(0x127)],'coinAddress':_0x5ba0e7[_0xeb7d10(0x106)]['coinAddress'],'qrCodeUrl':_0x5ba0e7['data'][_0xeb7d10(0xe3)],'expiryTime':_0x5ba0e7['data'][_0xeb7d10(0x137)],'createdOn':_0x5ba0e7['data'][_0xeb7d10(0x12a)],'confirmedOn':_0x5ba0e7['data']['TransactionConfirmedOn']};console['log'](_0xeb7d10(0xbf)),console[_0xeb7d10(0x114)](_0xeb7d10(0x144),_0x5ba0e7[_0xeb7d10(0x106)][_0xeb7d10(0x115)],'->',_0xbb918d),console[_0xeb7d10(0x114)](_0xeb7d10(0x12c),_0x5ba0e7[_0xeb7d10(0x106)]['Amount'],_0x5ba0e7[_0xeb7d10(0x106)][_0xeb7d10(0x102)]),console['log'](_0xeb7d10(0xfb),_0x5ba0e7['data'][_0xeb7d10(0x127)]),console[_0xeb7d10(0x114)](_0xeb7d10(0x135),_0x3c09f0||_0xeb7d10(0x13a)),console[_0xeb7d10(0x114)](_0xeb7d10(0xc9),_0x5ba0e7[_0xeb7d10(0x106)]['CreatedOn']),console[_0xeb7d10(0x114)](_0xeb7d10(0xd4),_0x5ba0e7[_0xeb7d10(0x106)][_0xeb7d10(0xca)]||'not\x20confirmed');if(_0x5ba0e7[_0xeb7d10(0x106)]['Status']?.[_0xeb7d10(0xee)]()==='awaiting\x20fiat')console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x5ba0e7[_0xeb7d10(0x106)][_0xeb7d10(0x115)]?.['toLowerCase']()==='paid'&&console['log'](_0xeb7d10(0x121));return{'status':_0xbb918d,'amount':parseFloat(_0x5ba0e7['data'][_0xeb7d10(0xea)])||undefined,'currency':_0x5ba0e7['data'][_0xeb7d10(0x102)]||_0xeb7d10(0xf9),'paymentDetails':_0x4696d5};}catch(_0x59f612){console[_0xeb7d10(0x10b)](_0xeb7d10(0x11c),_0x59f612),loggerService_1[_0xeb7d10(0x109)][_0xeb7d10(0x12b)](_0xeb7d10(0xc0),_0xeb7d10(0xeb),_0x59f612);throw new Error(_0xeb7d10(0x120)+(_0x59f612 instanceof Error?_0x59f612[_0xeb7d10(0x130)]:'Unknown\x20error'));}}async[a64_0x178ed7(0x111)](_0x74dcd4){const _0x56cb98=a64_0x178ed7,_0xa1b164=await this[_0x56cb98(0x11e)](_0x74dcd4);return{'status':_0xa1b164[_0x56cb98(0x11b)],'amount':_0xa1b164[_0x56cb98(0x13d)],'currency':_0xa1b164[_0x56cb98(0xd6)]};}async[a64_0x178ed7(0xde)](_0x3ff07b){const _0x38e073=a64_0x178ed7;console[_0x38e073(0x114)](_0x38e073(0xc8),_0x3ff07b);let _0x4c04f3='PENDING';switch(_0x3ff07b[_0x38e073(0x11b)]?.[_0x38e073(0xee)]()){case'paid':_0x4c04f3=_0x38e073(0xd2);break;case _0x38e073(0x110):case _0x38e073(0xf3):case'error':_0x4c04f3='FAILED';break;case'expired':case'timeout':_0x4c04f3=_0x38e073(0x107);break;case'pending':case _0x38e073(0x123):case'awaiting\x20fiat':case'created':default:_0x4c04f3=_0x38e073(0x128);break;}return{'paymentId':_0x3ff07b[_0x38e073(0xc4)]||_0x3ff07b['merchant_reference_id']||'','status':_0x4c04f3,'amount':_0x3ff07b[_0x38e073(0x13d)],'currency':_0x3ff07b[_0x38e073(0xd6)]||_0x38e073(0xf9)};}}exports[a64_0x178ed7(0xdb)]=CoinToPay2Service;