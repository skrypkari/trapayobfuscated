'use strict';const a40_0xfd0bae=a40_0x4170;function a40_0x1bdb(){const _0x15bb2d=['15506fcuAWw','Amount:','/create','status_code','logWhiteDomainResponse','created','Response\x20Time:','TransactionConfirmedOn','status','paid','üè¶\x20Extracted\x20IBAN:','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','Raw\x20Response\x20Body:','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','Confirmed\x20On:','PENDING','Status:','Gateway\x20Payment\x20ID:','waiting','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','fromEntries','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','üìä\x20Status\x20check\x20URL:','message','Response\x20Body:','order_id','2267671mtDXTi','parse','../loggerService','entries','===\x20COINTOPAY2\x20SUCCESS\x20===','Parsed\x20Result:','Status','amount','logWhiteDomainError','data','cointopay2','verifyPayment','\x20EUR','stack','Payment\x20URL:','Status\x20Code:','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','cancelled','QRCodeURL','110175NQYoDy','Payment\x20Status:','Error\x20details:','JSON\x20Parse\x20Error:\x20','https://traffer.uk/gateway/cointopay/','116WZqIuO','16VkBroo','CoinToPay2\x20API\x20error:\x20','Amount','checkPaymentStatus','Unknown\x20error\x20from\x20CoinToPay2\x20API','payment_url','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','currency','Status\x20Text:','loggerService','Business\x20Error:\x20','__esModule','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','PaymentDetail','application/json','EUR','TransactionID','processWebhook','7784955bHLHpv','2099124wMGQcp','POST','apiUrl','/status','CoinToPay2\x20payment\x20status\x20check\x20error:','55EdgzVq','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','CoinToPay2Service','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','error','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','not\x20confirmed','defineProperty','120222TbFIZo','Response\x20data:','3533101KdORSl','Result:','awaiting\x20fiat','failed','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','statusUrl','now','105eySAPI','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Request\x20Body:','Headers:','toLowerCase','HTTP\x20Status:','HTTP\x20','log','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','gateway_payment_id','pending','expired','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','IBAN:','timeout','PAID','text','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Currency:','Error\x20Message:','coinAddress','===\x20COINTOPAY2\x20API\x20ERROR\x20===','stringify','not\x20found','FAILED','10LojGrY','33NQtQNx','Created\x20On:',',\x20body:\x20','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','https://traffer.uk/gateway/cointopay/status.php'];a40_0x1bdb=function(){return _0x15bb2d;};return a40_0x1bdb();}(function(_0x3e9815,_0x1da3a1){const _0x56a846=a40_0x4170,_0x447e87=_0x3e9815();while(!![]){try{const _0x123464=parseInt(_0x56a846(0x183))/0x1*(parseInt(_0x56a846(0x106))/0x2)+-parseInt(_0x56a846(0x135))/0x3*(-parseInt(_0x56a846(0x13a))/0x4)+-parseInt(_0x56a846(0x169))/0x5*(parseInt(_0x56a846(0x15f))/0x6)+-parseInt(_0x56a846(0x122))/0x7*(parseInt(_0x56a846(0x13b))/0x8)+-parseInt(_0x56a846(0x14f))/0x9*(parseInt(_0x56a846(0x182))/0xa)+parseInt(_0x56a846(0x155))/0xb*(parseInt(_0x56a846(0x150))/0xc)+parseInt(_0x56a846(0x161))/0xd;if(_0x123464===_0x1da3a1)break;else _0x447e87['push'](_0x447e87['shift']());}catch(_0x896135){_0x447e87['push'](_0x447e87['shift']());}}}(a40_0x1bdb,0x82468));function a40_0x4170(_0x4bbfd8,_0xbd247){const _0x1bdbe3=a40_0x1bdb();return a40_0x4170=function(_0x417026,_0x2cdfd3){_0x417026=_0x417026-0x105;let _0x4cd4e0=_0x1bdbe3[_0x417026];return _0x4cd4e0;},a40_0x4170(_0x4bbfd8,_0xbd247);}Object[a40_0xfd0bae(0x15e)](exports,a40_0xfd0bae(0x146),{'value':!![]}),exports['CoinToPay2Service']=void 0x0;const loggerService_1=require(a40_0xfd0bae(0x124));class CoinToPay2Service{constructor(){const _0x1b7665=a40_0xfd0bae;this['apiUrl']=_0x1b7665(0x139),this[_0x1b7665(0x167)]=_0x1b7665(0x105),console[_0x1b7665(0x170)](_0x1b7665(0x132)),console[_0x1b7665(0x170)](_0x1b7665(0x11e),this[_0x1b7665(0x167)]);}async['createPaymentLink'](_0x4f7af1){const _0x49b9ff=a40_0xfd0bae,{orderId:_0x26e7dc,amount:_0xc8704c}=_0x4f7af1;console['log'](_0x49b9ff(0x141)+_0xc8704c+_0x49b9ff(0x12e));const _0x2c3122={'amount':_0xc8704c},_0x42d6d1=Date[_0x49b9ff(0x168)]();try{console['log'](_0x49b9ff(0x149)),console[_0x49b9ff(0x170)]('URL:',this[_0x49b9ff(0x152)]),console[_0x49b9ff(0x170)](_0x49b9ff(0x16b),JSON['stringify'](_0x2c3122,null,0x2)),console[_0x49b9ff(0x170)](_0x49b9ff(0x107),_0xc8704c,_0x49b9ff(0x156)),loggerService_1[_0x49b9ff(0x144)]['logWhiteDomainRequest'](_0x49b9ff(0x12c),'/create','POST',_0x2c3122);const _0x193214=await fetch(this['apiUrl'],{'method':_0x49b9ff(0x151),'headers':{'Content-Type':_0x49b9ff(0x14b),'Accept':'application/json','User-Agent':_0x49b9ff(0x159)},'body':JSON[_0x49b9ff(0x17f)](_0x2c3122)}),_0x6b212b=Date[_0x49b9ff(0x168)]()-_0x42d6d1;console[_0x49b9ff(0x170)](_0x49b9ff(0x165)),console[_0x49b9ff(0x170)]('Status:',_0x193214[_0x49b9ff(0x10e)]),console['log'](_0x49b9ff(0x143),_0x193214['statusText']),console[_0x49b9ff(0x170)](_0x49b9ff(0x16c),Object[_0x49b9ff(0x11b)](_0x193214['headers'][_0x49b9ff(0x125)]())),console['log'](_0x49b9ff(0x10c),_0x6b212b+'ms');const _0xe3a93c=await _0x193214[_0x49b9ff(0x179)]();console[_0x49b9ff(0x170)](_0x49b9ff(0x112),_0xe3a93c);if(!_0x193214['ok']){console[_0x49b9ff(0x15a)](_0x49b9ff(0x17e)),console[_0x49b9ff(0x15a)](_0x49b9ff(0x16e),_0x193214[_0x49b9ff(0x10e)]),console['error'](_0x49b9ff(0x120),_0xe3a93c),loggerService_1[_0x49b9ff(0x144)]['logWhiteDomainResponse'](_0x49b9ff(0x12c),'/create',_0x193214[_0x49b9ff(0x10e)],_0xe3a93c,_0x6b212b),loggerService_1['loggerService'][_0x49b9ff(0x12a)](_0x49b9ff(0x12c),'/create',_0x49b9ff(0x16f)+_0x193214['status']+':\x20'+_0xe3a93c);throw new Error('HTTP\x20error!\x20status:\x20'+_0x193214[_0x49b9ff(0x10e)]+_0x49b9ff(0x185)+_0xe3a93c);}let _0x4564f2;try{_0x4564f2=JSON[_0x49b9ff(0x123)](_0xe3a93c);}catch(_0x50290a){console[_0x49b9ff(0x15a)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x50290a),loggerService_1['loggerService'][_0x49b9ff(0x12a)](_0x49b9ff(0x12c),_0x49b9ff(0x108),_0x49b9ff(0x138)+_0x50290a);throw new Error(_0x49b9ff(0x175)+_0xe3a93c);}console[_0x49b9ff(0x170)](_0x49b9ff(0x166)),console[_0x49b9ff(0x170)](_0x49b9ff(0x127),JSON['stringify'](_0x4564f2,null,0x2)),loggerService_1[_0x49b9ff(0x144)][_0x49b9ff(0x10a)]('cointopay2',_0x49b9ff(0x108),_0x193214[_0x49b9ff(0x10e)],_0x4564f2,_0x6b212b);if(_0x4564f2[_0x49b9ff(0x15a)]){const _0x510232=_0x4564f2[_0x49b9ff(0x11f)]||_0x4564f2[_0x49b9ff(0x15a)]||_0x49b9ff(0x13f);console[_0x49b9ff(0x15a)](_0x49b9ff(0x11c)),console[_0x49b9ff(0x15a)](_0x49b9ff(0x17c),_0x510232),loggerService_1['loggerService'][_0x49b9ff(0x12a)](_0x49b9ff(0x12c),_0x49b9ff(0x108),_0x49b9ff(0x145)+_0x510232);throw new Error(_0x49b9ff(0x13c)+_0x510232);}if(!_0x4564f2['payment_url']||!_0x4564f2[_0x49b9ff(0x172)]){console[_0x49b9ff(0x15a)](_0x49b9ff(0x16a)),console[_0x49b9ff(0x15a)](_0x49b9ff(0x171)),console[_0x49b9ff(0x15a)](_0x49b9ff(0x160),_0x4564f2),loggerService_1[_0x49b9ff(0x144)][_0x49b9ff(0x12a)](_0x49b9ff(0x12c),'/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x49b9ff(0x15c));}return console[_0x49b9ff(0x170)](_0x49b9ff(0x126)),console[_0x49b9ff(0x170)](_0x49b9ff(0x118),_0x4564f2[_0x49b9ff(0x172)]),console[_0x49b9ff(0x170)](_0x49b9ff(0x130),_0x4564f2[_0x49b9ff(0x140)]),console[_0x49b9ff(0x170)](_0x49b9ff(0x107),_0xc8704c,_0x49b9ff(0x14c)),{'gateway_payment_id':_0x4564f2['gateway_payment_id'],'payment_url':_0x4564f2[_0x49b9ff(0x140)]};}catch(_0x12b059){console[_0x49b9ff(0x15a)](_0x49b9ff(0x111)),console['error'](_0x49b9ff(0x137),_0x12b059),loggerService_1[_0x49b9ff(0x144)][_0x49b9ff(0x12a)](_0x49b9ff(0x12c),_0x49b9ff(0x108),_0x12b059);if(_0x12b059 instanceof Error){console['error']('Error\x20message:',_0x12b059['message']),console[_0x49b9ff(0x15a)]('Error\x20stack:',_0x12b059[_0x49b9ff(0x12f)]);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x12b059[_0x49b9ff(0x11f)]);}throw new Error(_0x49b9ff(0x114));}}async[a40_0xfd0bae(0x13e)](_0x1ca332){const _0xe8250d=a40_0xfd0bae,_0x10d3e1=Date[_0xe8250d(0x168)]();try{console[_0xe8250d(0x170)]('üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0x1ca332);const _0x4ae2a8={'gatewayPaymentId':_0x1ca332};loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay2',_0xe8250d(0x153),'POST',_0x4ae2a8);const _0x20c40f=await fetch(this['statusUrl'],{'method':_0xe8250d(0x151),'headers':{'Content-Type':_0xe8250d(0x14b),'Accept':_0xe8250d(0x14b),'User-Agent':_0xe8250d(0x159)},'body':JSON[_0xe8250d(0x17f)](_0x4ae2a8)}),_0x3bc602=Date[_0xe8250d(0x168)]()-_0x10d3e1;console[_0xe8250d(0x170)](_0xe8250d(0x147)),console[_0xe8250d(0x170)](_0xe8250d(0x117),_0x20c40f[_0xe8250d(0x10e)]),console[_0xe8250d(0x170)](_0xe8250d(0x10c),_0x3bc602+'ms');if(!_0x20c40f['ok']){const _0x3be933=await _0x20c40f[_0xe8250d(0x179)]();console[_0xe8250d(0x15a)](_0xe8250d(0x16e),_0x20c40f['status']),console[_0xe8250d(0x15a)](_0xe8250d(0x120),_0x3be933),loggerService_1[_0xe8250d(0x144)][_0xe8250d(0x10a)](_0xe8250d(0x12c),_0xe8250d(0x153),_0x20c40f[_0xe8250d(0x10e)],_0x3be933,_0x3bc602),loggerService_1[_0xe8250d(0x144)][_0xe8250d(0x12a)](_0xe8250d(0x12c),'/status',_0xe8250d(0x16f)+_0x20c40f[_0xe8250d(0x10e)]+':\x20'+_0x3be933);throw new Error('HTTP\x20error!\x20status:\x20'+_0x20c40f[_0xe8250d(0x10e)]);}const _0x260748=await _0x20c40f[_0xe8250d(0x179)]();console[_0xe8250d(0x170)](_0xe8250d(0x112),_0x260748);let _0x3aae00;try{_0x3aae00=JSON[_0xe8250d(0x123)](_0x260748);}catch(_0x38565e){console[_0xe8250d(0x15a)](_0xe8250d(0x148),_0x38565e),loggerService_1[_0xe8250d(0x144)][_0xe8250d(0x12a)](_0xe8250d(0x12c),_0xe8250d(0x153),'JSON\x20Parse\x20Error:\x20'+_0x38565e);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'+_0x260748);}loggerService_1[_0xe8250d(0x144)]['logWhiteDomainResponse'](_0xe8250d(0x12c),_0xe8250d(0x153),_0x20c40f[_0xe8250d(0x10e)],_0x3aae00,_0x3bc602),console[_0xe8250d(0x170)](_0xe8250d(0x187)),console[_0xe8250d(0x170)](_0xe8250d(0x162),_0x3aae00['result']),console[_0xe8250d(0x170)](_0xe8250d(0x131),_0x3aae00[_0xe8250d(0x109)]),console[_0xe8250d(0x170)](_0xe8250d(0x136),_0x3aae00[_0xe8250d(0x12b)]?.[_0xe8250d(0x128)]),console[_0xe8250d(0x170)]('Amount:',_0x3aae00['data']?.['Amount']),console[_0xe8250d(0x170)](_0xe8250d(0x17b),_0x3aae00[_0xe8250d(0x12b)]?.['inputCurrency']);if(_0x3aae00['result']!=='success'||_0x3aae00[_0xe8250d(0x109)]!==0xc8){const _0x11c6b3=_0x3aae00[_0xe8250d(0x11f)]||_0xe8250d(0x15b);console[_0xe8250d(0x15a)]('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console[_0xe8250d(0x15a)](_0xe8250d(0x17c),_0x11c6b3),loggerService_1[_0xe8250d(0x144)][_0xe8250d(0x12a)](_0xe8250d(0x12c),_0xe8250d(0x153),'Status\x20API\x20Error:\x20'+_0x11c6b3);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0x11c6b3);}if(!_0x3aae00[_0xe8250d(0x12b)]){console['error'](_0xe8250d(0x113)),console[_0xe8250d(0x15a)]('Missing\x20data\x20in\x20response'),loggerService_1[_0xe8250d(0x144)][_0xe8250d(0x12a)](_0xe8250d(0x12c),_0xe8250d(0x153),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0xe8250d(0x11d));}let _0x4adcaf=_0xe8250d(0x116);switch(_0x3aae00[_0xe8250d(0x12b)][_0xe8250d(0x128)]?.[_0xe8250d(0x16d)]()){case _0xe8250d(0x10f):_0x4adcaf=_0xe8250d(0x178);break;case _0xe8250d(0x133):case _0xe8250d(0x164):case _0xe8250d(0x15a):_0x4adcaf='FAILED';break;case _0xe8250d(0x174):case'timeout':_0x4adcaf='EXPIRED';break;case _0xe8250d(0x119):case _0xe8250d(0x163):case'pending':case _0xe8250d(0x10b):default:_0x4adcaf=_0xe8250d(0x116);break;}let _0x4c78da,_0x317ca1;if(_0x3aae00['data'][_0xe8250d(0x14a)]){const _0x3c1ccf=_0x3aae00[_0xe8250d(0x12b)][_0xe8250d(0x14a)];console[_0xe8250d(0x170)]('üè¶\x20Payment\x20Detail:',_0x3c1ccf);const _0x3892f4=_0x3c1ccf['match'](/IBAN\s+([A-Z0-9]+)/i);_0x3892f4&&(_0x4c78da=_0x3892f4[0x1],console[_0xe8250d(0x170)](_0xe8250d(0x110),_0x4c78da)),_0x317ca1=_0x3c1ccf;}const _0x36b889={'iban':_0x4c78da,'bankDetails':_0x317ca1,'transactionId':_0x3aae00[_0xe8250d(0x12b)][_0xe8250d(0x14d)],'coinAddress':_0x3aae00[_0xe8250d(0x12b)][_0xe8250d(0x17d)],'qrCodeUrl':_0x3aae00[_0xe8250d(0x12b)][_0xe8250d(0x134)],'expiryTime':_0x3aae00[_0xe8250d(0x12b)]['ExpiryTime'],'createdOn':_0x3aae00[_0xe8250d(0x12b)]['CreatedOn'],'confirmedOn':_0x3aae00['data'][_0xe8250d(0x10d)]};console[_0xe8250d(0x170)]('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console[_0xe8250d(0x170)](_0xe8250d(0x117),_0x3aae00[_0xe8250d(0x12b)][_0xe8250d(0x128)],'->',_0x4adcaf),console[_0xe8250d(0x170)]('Amount:',_0x3aae00[_0xe8250d(0x12b)]['Amount'],_0x3aae00[_0xe8250d(0x12b)]['inputCurrency']),console['log']('Transaction\x20ID:',_0x3aae00[_0xe8250d(0x12b)][_0xe8250d(0x14d)]),console[_0xe8250d(0x170)](_0xe8250d(0x176),_0x4c78da||_0xe8250d(0x180)),console[_0xe8250d(0x170)](_0xe8250d(0x184),_0x3aae00['data']['CreatedOn']),console['log'](_0xe8250d(0x115),_0x3aae00[_0xe8250d(0x12b)][_0xe8250d(0x10d)]||_0xe8250d(0x15d));if(_0x3aae00[_0xe8250d(0x12b)]['Status']?.[_0xe8250d(0x16d)]()===_0xe8250d(0x163))console[_0xe8250d(0x170)](_0xe8250d(0x186));else _0x3aae00[_0xe8250d(0x12b)][_0xe8250d(0x128)]?.['toLowerCase']()===_0xe8250d(0x10f)&&console[_0xe8250d(0x170)](_0xe8250d(0x11a));return{'status':_0x4adcaf,'amount':parseFloat(_0x3aae00['data'][_0xe8250d(0x13d)])||undefined,'currency':_0x3aae00[_0xe8250d(0x12b)]['inputCurrency']||'EUR','paymentDetails':_0x36b889};}catch(_0x330943){console[_0xe8250d(0x15a)](_0xe8250d(0x154),_0x330943),loggerService_1[_0xe8250d(0x144)][_0xe8250d(0x12a)](_0xe8250d(0x12c),_0xe8250d(0x153),_0x330943);throw new Error(_0xe8250d(0x157)+(_0x330943 instanceof Error?_0x330943[_0xe8250d(0x11f)]:'Unknown\x20error'));}}async[a40_0xfd0bae(0x12d)](_0x4c1246){const _0x1e5b5f=a40_0xfd0bae,_0x37cb3e=await this[_0x1e5b5f(0x13e)](_0x4c1246);return{'status':_0x37cb3e[_0x1e5b5f(0x10e)],'amount':_0x37cb3e[_0x1e5b5f(0x129)],'currency':_0x37cb3e[_0x1e5b5f(0x142)]};}async[a40_0xfd0bae(0x14e)](_0x209da8){const _0x4166a0=a40_0xfd0bae;console[_0x4166a0(0x170)](_0x4166a0(0x17a),_0x209da8);let _0x581899=_0x4166a0(0x116);switch(_0x209da8[_0x4166a0(0x10e)]?.[_0x4166a0(0x16d)]()){case _0x4166a0(0x10f):_0x581899='PAID';break;case _0x4166a0(0x133):case _0x4166a0(0x164):case'error':_0x581899=_0x4166a0(0x181);break;case _0x4166a0(0x174):case _0x4166a0(0x177):_0x581899='EXPIRED';break;case _0x4166a0(0x173):case _0x4166a0(0x119):case'awaiting\x20fiat':case _0x4166a0(0x10b):default:_0x581899='PENDING';break;}return{'paymentId':_0x209da8[_0x4166a0(0x121)]||_0x209da8['merchant_reference_id']||'','status':_0x581899,'amount':_0x209da8[_0x4166a0(0x129)],'currency':_0x209da8['currency']||_0x4166a0(0x14c)};}}exports[a40_0xfd0bae(0x158)]=CoinToPay2Service;