'use strict';const a42_0x5471c2=a42_0x5753;(function(_0x52a171,_0x5372cd){const _0x5f1642=a42_0x5753,_0x307a1e=_0x52a171();while(!![]){try{const _0x481426=-parseInt(_0x5f1642(0xcf))/0x1*(parseInt(_0x5f1642(0x96))/0x2)+-parseInt(_0x5f1642(0xde))/0x3+parseInt(_0x5f1642(0xcd))/0x4+-parseInt(_0x5f1642(0x95))/0x5+-parseInt(_0x5f1642(0xae))/0x6+parseInt(_0x5f1642(0x66))/0x7*(-parseInt(_0x5f1642(0x79))/0x8)+parseInt(_0x5f1642(0x87))/0x9;if(_0x481426===_0x5372cd)break;else _0x307a1e['push'](_0x307a1e['shift']());}catch(_0x359a70){_0x307a1e['push'](_0x307a1e['shift']());}}}(a42_0x5007,0x657d1));function a42_0x5753(_0xf80297,_0x2c61aa){const _0x500711=a42_0x5007();return a42_0x5753=function(_0x5753b7,_0x388538){_0x5753b7=_0x5753b7-0x64;let _0x366d59=_0x500711[_0x5753b7];return _0x366d59;},a42_0x5753(_0xf80297,_0x2c61aa);}function a42_0x5007(){const _0x12dab8=['52481zNKzxw','created','currency','application/json','error','stack','Gateway\x20Payment\x20ID:','not\x20confirmed','Response\x20Body:','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','===\x20COINTOPAY2\x20SUCCESS\x20===','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','verifyPayment','merchant_reference_id','555852FoOjUJ','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','Currency:','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','Created\x20On:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','inputCurrency','match','Error\x20message:','order_id','Amount:','29561ywTujT','PAID','Transaction\x20ID:','now','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','parse','waiting','PaymentDetail','Payment\x20Status:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','pending','cancelled','timeout','gateway_payment_id','failed','Error\x20stack:','status_code','POST','776SkJilp','HTTP\x20error!\x20status:\x20','\x20EUR','PENDING','HTTP\x20','Headers:','not\x20found','stringify','TransactionID','Parsed\x20Result:','https://traffer.uk/gateway/cointopay/','Unknown\x20error','text','fromEntries','14196105gHTyDl','logWhiteDomainResponse','payment_url','createPaymentLink','paid','expired','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','HTTP\x20Status:','Status:','message','IBAN:','log','Response\x20data:','1376065UQRDmi','16KamFlr','/status','https://traffer.uk/gateway/cointopay/status.php','toLowerCase','Failed\x20to\x20parse\x20JSON\x20response:','üè¶\x20Payment\x20Detail:','checkPaymentStatus','apiUrl','using\x20pattern:','loggerService','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','FAILED','Status','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status\x20API\x20Error:\x20','source','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','CoinToPay2\x20status\x20API\x20error:\x20','amount','data','CoinToPay2Service','Raw\x20Response\x20Body:','statusUrl','/create','3447996gAvWVc','Error\x20details:','Status\x20Code:','cointopay2','awaiting\x20fiat','JSON\x20Parse\x20Error:\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','statusText','EUR','TransactionConfirmedOn','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','CreatedOn','headers','Missing\x20data\x20in\x20response','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','Confirmed\x20On:','EXPIRED','Unknown\x20error\x20from\x20CoinToPay2\x20API','Status\x20Text:','Response\x20Time:','Amount','result','coinAddress','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Business\x20Error:\x20','Payment\x20URL:','logWhiteDomainRequest','logWhiteDomainError','status','../loggerService','2811976CcriaE','Error\x20Message:'];a42_0x5007=function(){return _0x12dab8;};return a42_0x5007();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['CoinToPay2Service']=void 0x0;const loggerService_1=require(a42_0x5471c2(0xcc));class CoinToPay2Service{constructor(){const _0x560b10=a42_0x5471c2;this[_0x560b10(0x9d)]=_0x560b10(0x83),this['statusUrl']=_0x560b10(0x98),console[_0x560b10(0x93)](_0x560b10(0x8e)),console[_0x560b10(0x93)]('üìä\x20Status\x20check\x20URL:',this[_0x560b10(0xac)]);}async[a42_0x5471c2(0x8a)](_0x186218){const _0x16514e=a42_0x5471c2,{orderId:_0x41a7f5,amount:_0x5d5d6f}=_0x186218;console[_0x16514e(0x93)](_0x16514e(0xdf)+_0x5d5d6f+_0x16514e(0x7b));const _0x6de7cc={'amount':_0x5d5d6f},_0x4d2ce2=Date['now']();try{console[_0x16514e(0x93)](_0x16514e(0x8d)),console[_0x16514e(0x93)]('URL:',this[_0x16514e(0x9d)]),console[_0x16514e(0x93)]('Request\x20Body:',JSON[_0x16514e(0x80)](_0x6de7cc,null,0x2)),console[_0x16514e(0x93)]('Amount:',_0x5d5d6f,'EUR\x20(always\x20EUR\x20for\x20CoinToPay2)'),loggerService_1[_0x16514e(0x9f)][_0x16514e(0xc9)](_0x16514e(0xb1),_0x16514e(0xad),'POST',_0x6de7cc);const _0xb6ab4=await fetch(this[_0x16514e(0x9d)],{'method':_0x16514e(0x78),'headers':{'Content-Type':_0x16514e(0xd2),'Accept':'application/json','User-Agent':_0x16514e(0xdb)},'body':JSON['stringify'](_0x6de7cc)}),_0x350586=Date[_0x16514e(0x69)]()-_0x4d2ce2;console[_0x16514e(0x93)](_0x16514e(0xbc)),console['log'](_0x16514e(0x90),_0xb6ab4[_0x16514e(0xcb)]),console[_0x16514e(0x93)](_0x16514e(0xc1),_0xb6ab4[_0x16514e(0xb5)]),console[_0x16514e(0x93)](_0x16514e(0x7e),Object[_0x16514e(0x86)](_0xb6ab4[_0x16514e(0xba)]['entries']())),console[_0x16514e(0x93)]('Response\x20Time:',_0x350586+'ms');const _0x20c273=await _0xb6ab4['text']();console['log']('Raw\x20Response\x20Body:',_0x20c273);if(!_0xb6ab4['ok']){console[_0x16514e(0xd3)]('===\x20COINTOPAY2\x20API\x20ERROR\x20==='),console['error'](_0x16514e(0x8f),_0xb6ab4[_0x16514e(0xcb)]),console[_0x16514e(0xd3)](_0x16514e(0xd7),_0x20c273),loggerService_1[_0x16514e(0x9f)][_0x16514e(0x88)](_0x16514e(0xb1),_0x16514e(0xad),_0xb6ab4[_0x16514e(0xcb)],_0x20c273,_0x350586),loggerService_1['loggerService'][_0x16514e(0xca)](_0x16514e(0xb1),_0x16514e(0xad),'HTTP\x20'+_0xb6ab4[_0x16514e(0xcb)]+':\x20'+_0x20c273);throw new Error(_0x16514e(0x7a)+_0xb6ab4[_0x16514e(0xcb)]+',\x20body:\x20'+_0x20c273);}let _0x224dfc;try{_0x224dfc=JSON['parse'](_0x20c273);}catch(_0x598567){console['error'](_0x16514e(0x9a),_0x598567),loggerService_1[_0x16514e(0x9f)][_0x16514e(0xca)]('cointopay2',_0x16514e(0xad),'JSON\x20Parse\x20Error:\x20'+_0x598567);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20'+_0x20c273);}console[_0x16514e(0x93)](_0x16514e(0x6b)),console[_0x16514e(0x93)](_0x16514e(0x82),JSON[_0x16514e(0x80)](_0x224dfc,null,0x2)),loggerService_1['loggerService'][_0x16514e(0x88)]('cointopay2','/create',_0xb6ab4[_0x16514e(0xcb)],_0x224dfc,_0x350586);if(_0x224dfc[_0x16514e(0xd3)]){const _0x5c3d8b=_0x224dfc[_0x16514e(0x91)]||_0x224dfc['error']||_0x16514e(0xc0);console[_0x16514e(0xd3)](_0x16514e(0xa6)),console[_0x16514e(0xd3)](_0x16514e(0xce),_0x5c3d8b),loggerService_1[_0x16514e(0x9f)][_0x16514e(0xca)](_0x16514e(0xb1),_0x16514e(0xad),_0x16514e(0xc7)+_0x5c3d8b);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x5c3d8b);}if(!_0x224dfc[_0x16514e(0x89)]||!_0x224dfc['gateway_payment_id']){console[_0x16514e(0xd3)](_0x16514e(0xc6)),console[_0x16514e(0xd3)](_0x16514e(0xb4)),console['error'](_0x16514e(0x94),_0x224dfc),loggerService_1[_0x16514e(0x9f)][_0x16514e(0xca)](_0x16514e(0xb1),_0x16514e(0xad),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x16514e(0xda));}return console[_0x16514e(0x93)](_0x16514e(0xd9)),console[_0x16514e(0x93)](_0x16514e(0xd5),_0x224dfc[_0x16514e(0x74)]),console[_0x16514e(0x93)](_0x16514e(0xc8),_0x224dfc[_0x16514e(0x89)]),console[_0x16514e(0x93)](_0x16514e(0x65),_0x5d5d6f,_0x16514e(0xb6)),{'gateway_payment_id':_0x224dfc[_0x16514e(0x74)],'payment_url':_0x224dfc[_0x16514e(0x89)]};}catch(_0x4cd0b9){console[_0x16514e(0xd3)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x16514e(0xd3)](_0x16514e(0xaf),_0x4cd0b9),loggerService_1[_0x16514e(0x9f)][_0x16514e(0xca)]('cointopay2',_0x16514e(0xad),_0x4cd0b9);if(_0x4cd0b9 instanceof Error){console[_0x16514e(0xd3)](_0x16514e(0xe6),_0x4cd0b9[_0x16514e(0x91)]),console['error'](_0x16514e(0x76),_0x4cd0b9[_0x16514e(0xd4)]);throw new Error(_0x16514e(0x6a)+_0x4cd0b9[_0x16514e(0x91)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a42_0x5471c2(0x9c)](_0x24d1e5){const _0x3000fc=a42_0x5471c2,_0xf736d4=Date[_0x3000fc(0x69)]();try{console[_0x3000fc(0x93)]('üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0x24d1e5);const _0x3a6200={'gatewayPaymentId':_0x24d1e5};loggerService_1[_0x3000fc(0x9f)]['logWhiteDomainRequest'](_0x3000fc(0xb1),_0x3000fc(0x97),_0x3000fc(0x78),_0x3a6200);const _0x14893d=await fetch(this[_0x3000fc(0xac)],{'method':_0x3000fc(0x78),'headers':{'Content-Type':_0x3000fc(0xd2),'Accept':_0x3000fc(0xd2),'User-Agent':_0x3000fc(0xdb)},'body':JSON[_0x3000fc(0x80)](_0x3a6200)}),_0x2c0ab6=Date[_0x3000fc(0x69)]()-_0xf736d4;console[_0x3000fc(0x93)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x3000fc(0x93)](_0x3000fc(0x90),_0x14893d[_0x3000fc(0xcb)]),console[_0x3000fc(0x93)](_0x3000fc(0xc2),_0x2c0ab6+'ms');if(!_0x14893d['ok']){const _0x721760=await _0x14893d[_0x3000fc(0x85)]();console[_0x3000fc(0xd3)]('HTTP\x20Status:',_0x14893d[_0x3000fc(0xcb)]),console[_0x3000fc(0xd3)]('Response\x20Body:',_0x721760),loggerService_1[_0x3000fc(0x9f)][_0x3000fc(0x88)](_0x3000fc(0xb1),_0x3000fc(0x97),_0x14893d['status'],_0x721760,_0x2c0ab6),loggerService_1[_0x3000fc(0x9f)][_0x3000fc(0xca)](_0x3000fc(0xb1),_0x3000fc(0x97),_0x3000fc(0x7d)+_0x14893d[_0x3000fc(0xcb)]+':\x20'+_0x721760);throw new Error(_0x3000fc(0x7a)+_0x14893d[_0x3000fc(0xcb)]);}const _0x3e3ba2=await _0x14893d[_0x3000fc(0x85)]();console[_0x3000fc(0x93)](_0x3000fc(0xab),_0x3e3ba2);let _0x2f9be1;try{_0x2f9be1=JSON[_0x3000fc(0x6c)](_0x3e3ba2);}catch(_0x5ee573){console[_0x3000fc(0xd3)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5ee573),loggerService_1[_0x3000fc(0x9f)][_0x3000fc(0xca)](_0x3000fc(0xb1),_0x3000fc(0x97),_0x3000fc(0xb3)+_0x5ee573);throw new Error(_0x3000fc(0x70)+_0x3e3ba2);}loggerService_1[_0x3000fc(0x9f)][_0x3000fc(0x88)](_0x3000fc(0xb1),'/status',_0x14893d[_0x3000fc(0xcb)],_0x2f9be1,_0x2c0ab6),console[_0x3000fc(0x93)]('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console[_0x3000fc(0x93)]('Result:',_0x2f9be1[_0x3000fc(0xc4)]),console[_0x3000fc(0x93)](_0x3000fc(0xb0),_0x2f9be1[_0x3000fc(0x77)]),console[_0x3000fc(0x93)](_0x3000fc(0x6f),_0x2f9be1[_0x3000fc(0xa9)]?.[_0x3000fc(0xa2)]),console[_0x3000fc(0x93)](_0x3000fc(0x65),_0x2f9be1['data']?.[_0x3000fc(0xc3)]),console[_0x3000fc(0x93)](_0x3000fc(0xe0),_0x2f9be1['data']?.[_0x3000fc(0xe4)]);if(_0x2f9be1[_0x3000fc(0xc4)]!=='success'||_0x2f9be1[_0x3000fc(0x77)]!==0xc8){const _0x271722=_0x2f9be1[_0x3000fc(0x91)]||_0x3000fc(0xb8);console['error'](_0x3000fc(0xbd)),console[_0x3000fc(0xd3)](_0x3000fc(0xce),_0x271722),loggerService_1[_0x3000fc(0x9f)][_0x3000fc(0xca)]('cointopay2',_0x3000fc(0x97),_0x3000fc(0xa4)+_0x271722);throw new Error(_0x3000fc(0xa7)+_0x271722);}if(!_0x2f9be1[_0x3000fc(0xa9)]){console['error'](_0x3000fc(0xa3)),console[_0x3000fc(0xd3)](_0x3000fc(0xbb)),loggerService_1['loggerService'][_0x3000fc(0xca)](_0x3000fc(0xb1),'/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0x3000fc(0xe1));}let _0x233b57=_0x3000fc(0x7c);switch(_0x2f9be1['data'][_0x3000fc(0xa2)]?.[_0x3000fc(0x99)]()){case _0x3000fc(0x8b):_0x233b57=_0x3000fc(0x67);break;case'cancelled':case _0x3000fc(0x75):case _0x3000fc(0xd3):_0x233b57=_0x3000fc(0xa1);break;case _0x3000fc(0x8c):case _0x3000fc(0x73):_0x233b57=_0x3000fc(0xbf);break;case _0x3000fc(0x6d):case _0x3000fc(0xb2):case _0x3000fc(0x71):case _0x3000fc(0xd0):default:_0x233b57=_0x3000fc(0x7c);break;}let _0x55170c,_0x118367;if(_0x2f9be1[_0x3000fc(0xa9)]['PaymentDetail']){const _0x43c5df=_0x2f9be1['data'][_0x3000fc(0x6e)];console[_0x3000fc(0x93)](_0x3000fc(0x9b),_0x43c5df);const _0x3576af=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x4336b8 of _0x3576af){const _0xa129ea=_0x43c5df[_0x3000fc(0xe5)](_0x4336b8);if(_0xa129ea){_0x55170c=_0xa129ea[0x1],console[_0x3000fc(0x93)]('üè¶\x20Extracted\x20IBAN:',_0x55170c,_0x3000fc(0x9e),_0x4336b8[_0x3000fc(0xa5)]);break;}}if(!_0x55170c){console[_0x3000fc(0x93)](_0x3000fc(0xa0));const _0x158ac0=_0x43c5df[_0x3000fc(0xe5)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x158ac0&&(_0x55170c=_0x158ac0[0x1],console[_0x3000fc(0x93)]('üè¶\x20Extracted\x20IBAN\x20via\x20fallback:',_0x55170c));}_0x118367=_0x43c5df;}const _0x20424e={'iban':_0x55170c,'bankDetails':_0x118367,'transactionId':_0x2f9be1[_0x3000fc(0xa9)][_0x3000fc(0x81)],'coinAddress':_0x2f9be1[_0x3000fc(0xa9)][_0x3000fc(0xc5)],'qrCodeUrl':_0x2f9be1['data']['QRCodeURL'],'expiryTime':_0x2f9be1[_0x3000fc(0xa9)]['ExpiryTime'],'createdOn':_0x2f9be1[_0x3000fc(0xa9)][_0x3000fc(0xb9)],'confirmedOn':_0x2f9be1[_0x3000fc(0xa9)][_0x3000fc(0xb7)]};console['log']('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console[_0x3000fc(0x93)](_0x3000fc(0x90),_0x2f9be1[_0x3000fc(0xa9)][_0x3000fc(0xa2)],'->',_0x233b57),console[_0x3000fc(0x93)](_0x3000fc(0x65),_0x2f9be1[_0x3000fc(0xa9)][_0x3000fc(0xc3)],_0x2f9be1[_0x3000fc(0xa9)][_0x3000fc(0xe4)]),console[_0x3000fc(0x93)](_0x3000fc(0x68),_0x2f9be1[_0x3000fc(0xa9)][_0x3000fc(0x81)]),console[_0x3000fc(0x93)](_0x3000fc(0x92),_0x55170c||_0x3000fc(0x7f)),console[_0x3000fc(0x93)](_0x3000fc(0xe2),_0x2f9be1[_0x3000fc(0xa9)][_0x3000fc(0xb9)]),console[_0x3000fc(0x93)](_0x3000fc(0xbe),_0x2f9be1[_0x3000fc(0xa9)][_0x3000fc(0xb7)]||_0x3000fc(0xd6));if(_0x2f9be1['data']['Status']?.['toLowerCase']()==='awaiting\x20fiat')console[_0x3000fc(0x93)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x2f9be1[_0x3000fc(0xa9)][_0x3000fc(0xa2)]?.[_0x3000fc(0x99)]()===_0x3000fc(0x8b)&&console['log'](_0x3000fc(0xe3));return{'status':_0x233b57,'amount':parseFloat(_0x2f9be1[_0x3000fc(0xa9)]['Amount'])||undefined,'currency':_0x2f9be1['data'][_0x3000fc(0xe4)]||_0x3000fc(0xb6),'paymentDetails':_0x20424e};}catch(_0xeeb4fc){console[_0x3000fc(0xd3)]('CoinToPay2\x20payment\x20status\x20check\x20error:',_0xeeb4fc),loggerService_1[_0x3000fc(0x9f)][_0x3000fc(0xca)](_0x3000fc(0xb1),_0x3000fc(0x97),_0xeeb4fc);throw new Error(_0x3000fc(0xd8)+(_0xeeb4fc instanceof Error?_0xeeb4fc['message']:_0x3000fc(0x84)));}}async[a42_0x5471c2(0xdc)](_0x39f5a8){const _0x1d129d=a42_0x5471c2,_0x3a13e1=await this[_0x1d129d(0x9c)](_0x39f5a8);return{'status':_0x3a13e1['status'],'amount':_0x3a13e1['amount'],'currency':_0x3a13e1[_0x1d129d(0xd1)]};}async['processWebhook'](_0x5334ec){const _0x48b7cd=a42_0x5471c2;console[_0x48b7cd(0x93)]('Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x5334ec);let _0xe5b665=_0x48b7cd(0x7c);switch(_0x5334ec[_0x48b7cd(0xcb)]?.[_0x48b7cd(0x99)]()){case'paid':_0xe5b665=_0x48b7cd(0x67);break;case _0x48b7cd(0x72):case _0x48b7cd(0x75):case _0x48b7cd(0xd3):_0xe5b665='FAILED';break;case _0x48b7cd(0x8c):case'timeout':_0xe5b665='EXPIRED';break;case _0x48b7cd(0x71):case _0x48b7cd(0x6d):case _0x48b7cd(0xb2):case _0x48b7cd(0xd0):default:_0xe5b665='PENDING';break;}return{'paymentId':_0x5334ec[_0x48b7cd(0x64)]||_0x5334ec[_0x48b7cd(0xdd)]||'','status':_0xe5b665,'amount':_0x5334ec[_0x48b7cd(0xa8)],'currency':_0x5334ec[_0x48b7cd(0xd1)]||'EUR'};}}exports[a42_0x5471c2(0xaa)]=CoinToPay2Service;