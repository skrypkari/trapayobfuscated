'use strict';function a42_0x431c(_0x585697,_0x2157b3){const _0x15386f=a42_0x1538();return a42_0x431c=function(_0x431cd1,_0x3e04f7){_0x431cd1=_0x431cd1-0x113;let _0x40ae4c=_0x15386f[_0x431cd1];return _0x40ae4c;},a42_0x431c(_0x585697,_0x2157b3);}function a42_0x1538(){const _0x2b0c3d=['===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','üè¶\x20Payment\x20Detail:','Raw\x20Response\x20Body:','CreatedOn','application/json','Amount','CoinToPay2Service','pending','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status\x20API\x20Error:\x20','createPaymentLink','source','checkPaymentStatus','amount','../loggerService','not\x20confirmed','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Confirmed\x20On:','stringify','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','match','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','Business\x20Error:\x20','üè¶\x20Extracted\x20IBAN:','Status\x20Code:','Incomplete\x20response:\x20missing\x20data','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Response\x20Time:','headers','8248ObHXIu','Status','inputCurrency','569066gMymqL','Status:','merchant_reference_id','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','\x20EUR','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','QRCodeURL','Error\x20Message:','4194SuQiGA','stack','Payment\x20Status:','PAID','log','Unknown\x20error','637302jIQjmR','===\x20COINTOPAY2\x20SUCCESS\x20===','apiUrl','TransactionConfirmedOn','IBAN:','HTTP\x20Status:','now','/status','Error\x20message:','Gateway\x20Payment\x20ID:','142776WlNJOg','üìä\x20Status\x20check\x20URL:','error','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','5308bQmxSF','coinAddress','statusUrl','loggerService','2505942FRYAwM','parse','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Parsed\x20Result:','EXPIRED','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','paid','toLowerCase','HTTP\x20error!\x20status:\x20','fromEntries','expired','message','logWhiteDomainResponse','cointopay2','CoinToPay2\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','CoinToPay2\x20status\x20API\x20error:\x20','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','payment_url','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','defineProperty','148115TRSdrJ','1060NtquVo','processWebhook','Request\x20Body:','1810AIpGrn','cancelled','TransactionID','https://traffer.uk/gateway/cointopay/status.php','PENDING','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','gateway_payment_id','Response\x20Body:','awaiting\x20fiat','EUR','JSON\x20Parse\x20Error:\x20','not\x20found','status','Failed\x20to\x20parse\x20JSON\x20response:','failed','result','HTTP\x20','PaymentDetail','POST','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','statusText','https://traffer.uk/gateway/cointopay/','waiting','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===',',\x20body:\x20','data','FAILED','Transaction\x20ID:','/create','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','entries','Response\x20data:','Unknown\x20error\x20from\x20CoinToPay2\x20API','logWhiteDomainError','status_code','using\x20pattern:','Currency:','Amount:','timeout','created','URL:','text','logWhiteDomainRequest','7xcGRZK','Created\x20On:','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API'];a42_0x1538=function(){return _0x2b0c3d;};return a42_0x1538();}const a42_0x487fa2=a42_0x431c;(function(_0x178473,_0x193747){const _0x4106c2=a42_0x431c,_0x4e0eb4=_0x178473();while(!![]){try{const _0xd2a701=-parseInt(_0x4106c2(0x167))/0x1+-parseInt(_0x4106c2(0x14e))/0x2+-parseInt(_0x4106c2(0x16f))/0x3+parseInt(_0x4106c2(0x16b))/0x4*(-parseInt(_0x4106c2(0x187))/0x5)+-parseInt(_0x4106c2(0x15d))/0x6*(-parseInt(_0x4106c2(0x129))/0x7)+parseInt(_0x4106c2(0x14b))/0x8*(-parseInt(_0x4106c2(0x157))/0x9)+parseInt(_0x4106c2(0x18a))/0xa*(parseInt(_0x4106c2(0x186))/0xb);if(_0xd2a701===_0x193747)break;else _0x4e0eb4['push'](_0x4e0eb4['shift']());}catch(_0x1bab82){_0x4e0eb4['push'](_0x4e0eb4['shift']());}}}(a42_0x1538,0x7eb4d));Object[a42_0x487fa2(0x185)](exports,'__esModule',{'value':!![]}),exports[a42_0x487fa2(0x132)]=void 0x0;const loggerService_1=require(a42_0x487fa2(0x13b));class CoinToPay2Service{constructor(){const _0x388a83=a42_0x487fa2;this['apiUrl']=_0x388a83(0x19f),this[_0x388a83(0x16d)]=_0x388a83(0x18d),console[_0x388a83(0x15b)]('ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console['log'](_0x388a83(0x168),this[_0x388a83(0x16d)]);}async[a42_0x487fa2(0x137)](_0x3bec53){const _0x1873e0=a42_0x487fa2,{orderId:_0x1a4a5b,amount:_0x3b4606}=_0x3bec53;console[_0x1873e0(0x15b)](_0x1873e0(0x143)+_0x3b4606+_0x1873e0(0x153));const _0x1cb571={'amount':_0x3b4606},_0x2b6c05=Date[_0x1873e0(0x163)]();try{console['log']('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console[_0x1873e0(0x15b)](_0x1873e0(0x126),this[_0x1873e0(0x15f)]),console[_0x1873e0(0x15b)](_0x1873e0(0x189),JSON[_0x1873e0(0x140)](_0x1cb571,null,0x2)),console['log']('Amount:',_0x3b4606,_0x1873e0(0x13d)),loggerService_1[_0x1873e0(0x16e)][_0x1873e0(0x128)](_0x1873e0(0x17c),_0x1873e0(0x119),_0x1873e0(0x19c),_0x1cb571);const _0x1e1306=await fetch(this[_0x1873e0(0x15f)],{'method':_0x1873e0(0x19c),'headers':{'Content-Type':_0x1873e0(0x130),'Accept':_0x1873e0(0x130),'User-Agent':_0x1873e0(0x154)},'body':JSON[_0x1873e0(0x140)](_0x1cb571)}),_0x4efc93=Date[_0x1873e0(0x163)]()-_0x2b6c05;console[_0x1873e0(0x15b)](_0x1873e0(0x11a)),console[_0x1873e0(0x15b)]('Status:',_0x1e1306[_0x1873e0(0x196)]),console['log']('Status\x20Text:',_0x1e1306[_0x1873e0(0x19e)]),console[_0x1873e0(0x15b)]('Headers:',Object[_0x1873e0(0x178)](_0x1e1306[_0x1873e0(0x14a)][_0x1873e0(0x11c)]())),console['log'](_0x1873e0(0x149),_0x4efc93+'ms');const _0x2bbec1=await _0x1e1306[_0x1873e0(0x127)]();console[_0x1873e0(0x15b)](_0x1873e0(0x12e),_0x2bbec1);if(!_0x1e1306['ok']){console[_0x1873e0(0x169)](_0x1873e0(0x13e)),console[_0x1873e0(0x169)](_0x1873e0(0x162),_0x1e1306['status']),console[_0x1873e0(0x169)](_0x1873e0(0x191),_0x2bbec1),loggerService_1[_0x1873e0(0x16e)]['logWhiteDomainResponse'](_0x1873e0(0x17c),'/create',_0x1e1306['status'],_0x2bbec1,_0x4efc93),loggerService_1[_0x1873e0(0x16e)][_0x1873e0(0x11f)]('cointopay2',_0x1873e0(0x119),'HTTP\x20'+_0x1e1306[_0x1873e0(0x196)]+':\x20'+_0x2bbec1);throw new Error(_0x1873e0(0x177)+_0x1e1306[_0x1873e0(0x196)]+_0x1873e0(0x115)+_0x2bbec1);}let _0x5d5c04;try{_0x5d5c04=JSON[_0x1873e0(0x170)](_0x2bbec1);}catch(_0x51ec79){console[_0x1873e0(0x169)](_0x1873e0(0x197),_0x51ec79),loggerService_1['loggerService'][_0x1873e0(0x11f)](_0x1873e0(0x17c),_0x1873e0(0x119),_0x1873e0(0x194)+_0x51ec79);throw new Error(_0x1873e0(0x11b)+_0x2bbec1);}console[_0x1873e0(0x15b)](_0x1873e0(0x19d)),console['log'](_0x1873e0(0x172),JSON[_0x1873e0(0x140)](_0x5d5c04,null,0x2)),loggerService_1[_0x1873e0(0x16e)][_0x1873e0(0x17b)]('cointopay2','/create',_0x1e1306[_0x1873e0(0x196)],_0x5d5c04,_0x4efc93);if(_0x5d5c04[_0x1873e0(0x169)]){const _0x38af64=_0x5d5c04[_0x1873e0(0x17a)]||_0x5d5c04[_0x1873e0(0x169)]||_0x1873e0(0x11e);console[_0x1873e0(0x169)](_0x1873e0(0x181)),console[_0x1873e0(0x169)](_0x1873e0(0x156),_0x38af64),loggerService_1[_0x1873e0(0x16e)][_0x1873e0(0x11f)](_0x1873e0(0x17c),'/create',_0x1873e0(0x144)+_0x38af64);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x38af64);}if(!_0x5d5c04['payment_url']||!_0x5d5c04['gateway_payment_id']){console[_0x1873e0(0x169)](_0x1873e0(0x151)),console['error'](_0x1873e0(0x171)),console[_0x1873e0(0x169)](_0x1873e0(0x11d),_0x5d5c04),loggerService_1[_0x1873e0(0x16e)][_0x1873e0(0x11f)](_0x1873e0(0x17c),_0x1873e0(0x119),_0x1873e0(0x135));throw new Error(_0x1873e0(0x18f));}return console[_0x1873e0(0x15b)](_0x1873e0(0x15e)),console['log'](_0x1873e0(0x166),_0x5d5c04['gateway_payment_id']),console[_0x1873e0(0x15b)]('Payment\x20URL:',_0x5d5c04[_0x1873e0(0x183)]),console['log'](_0x1873e0(0x123),_0x3b4606,_0x1873e0(0x193)),{'gateway_payment_id':_0x5d5c04[_0x1873e0(0x190)],'payment_url':_0x5d5c04[_0x1873e0(0x183)]};}catch(_0x1fa2be){console[_0x1873e0(0x169)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x1873e0(0x169)]('Error\x20details:',_0x1fa2be),loggerService_1[_0x1873e0(0x16e)]['logWhiteDomainError'](_0x1873e0(0x17c),_0x1873e0(0x119),_0x1fa2be);if(_0x1fa2be instanceof Error){console[_0x1873e0(0x169)](_0x1873e0(0x165),_0x1fa2be[_0x1873e0(0x17a)]),console[_0x1873e0(0x169)]('Error\x20stack:',_0x1fa2be[_0x1873e0(0x158)]);throw new Error(_0x1873e0(0x174)+_0x1fa2be[_0x1873e0(0x17a)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a42_0x487fa2(0x139)](_0x3630cc){const _0x2e8992=a42_0x487fa2,_0x594259=Date[_0x2e8992(0x163)]();try{console[_0x2e8992(0x15b)](_0x2e8992(0x148)+_0x3630cc);const _0x4bb809={'gatewayPaymentId':_0x3630cc};loggerService_1['loggerService'][_0x2e8992(0x128)](_0x2e8992(0x17c),'/status',_0x2e8992(0x19c),_0x4bb809);const _0x107539=await fetch(this[_0x2e8992(0x16d)],{'method':_0x2e8992(0x19c),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x2e8992(0x140)](_0x4bb809)}),_0x1f8637=Date[_0x2e8992(0x163)]()-_0x594259;console['log'](_0x2e8992(0x17e)),console[_0x2e8992(0x15b)](_0x2e8992(0x14f),_0x107539[_0x2e8992(0x196)]),console[_0x2e8992(0x15b)](_0x2e8992(0x149),_0x1f8637+'ms');if(!_0x107539['ok']){const _0x39870f=await _0x107539[_0x2e8992(0x127)]();console[_0x2e8992(0x169)]('HTTP\x20Status:',_0x107539[_0x2e8992(0x196)]),console[_0x2e8992(0x169)](_0x2e8992(0x191),_0x39870f),loggerService_1['loggerService'][_0x2e8992(0x17b)](_0x2e8992(0x17c),'/status',_0x107539['status'],_0x39870f,_0x1f8637),loggerService_1['loggerService'][_0x2e8992(0x11f)](_0x2e8992(0x17c),_0x2e8992(0x164),_0x2e8992(0x19a)+_0x107539[_0x2e8992(0x196)]+':\x20'+_0x39870f);throw new Error(_0x2e8992(0x177)+_0x107539[_0x2e8992(0x196)]);}const _0x4b69b7=await _0x107539[_0x2e8992(0x127)]();console[_0x2e8992(0x15b)](_0x2e8992(0x12e),_0x4b69b7);let _0x9cfb54;try{_0x9cfb54=JSON[_0x2e8992(0x170)](_0x4b69b7);}catch(_0x8d1031){console[_0x2e8992(0x169)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x8d1031),loggerService_1[_0x2e8992(0x16e)][_0x2e8992(0x11f)](_0x2e8992(0x17c),_0x2e8992(0x164),_0x2e8992(0x194)+_0x8d1031);throw new Error(_0x2e8992(0x184)+_0x4b69b7);}loggerService_1[_0x2e8992(0x16e)][_0x2e8992(0x17b)](_0x2e8992(0x17c),_0x2e8992(0x164),_0x107539[_0x2e8992(0x196)],_0x9cfb54,_0x1f8637),console['log'](_0x2e8992(0x12c)),console[_0x2e8992(0x15b)]('Result:',_0x9cfb54['result']),console[_0x2e8992(0x15b)](_0x2e8992(0x146),_0x9cfb54[_0x2e8992(0x120)]),console['log'](_0x2e8992(0x159),_0x9cfb54['data']?.[_0x2e8992(0x14c)]),console[_0x2e8992(0x15b)](_0x2e8992(0x123),_0x9cfb54['data']?.[_0x2e8992(0x131)]),console[_0x2e8992(0x15b)](_0x2e8992(0x122),_0x9cfb54[_0x2e8992(0x116)]?.[_0x2e8992(0x14d)]);if(_0x9cfb54[_0x2e8992(0x199)]!=='success'||_0x9cfb54[_0x2e8992(0x120)]!==0xc8){const _0x2c965c=_0x9cfb54[_0x2e8992(0x17a)]||_0x2e8992(0x12b);console[_0x2e8992(0x169)](_0x2e8992(0x134)),console[_0x2e8992(0x169)](_0x2e8992(0x156),_0x2c965c),loggerService_1[_0x2e8992(0x16e)][_0x2e8992(0x11f)](_0x2e8992(0x17c),_0x2e8992(0x164),_0x2e8992(0x136)+_0x2c965c);throw new Error(_0x2e8992(0x17f)+_0x2c965c);}if(!_0x9cfb54[_0x2e8992(0x116)]){console[_0x2e8992(0x169)](_0x2e8992(0x182)),console[_0x2e8992(0x169)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x2e8992(0x16e)][_0x2e8992(0x11f)](_0x2e8992(0x17c),_0x2e8992(0x164),_0x2e8992(0x147));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x58173c=_0x2e8992(0x18e);switch(_0x9cfb54[_0x2e8992(0x116)][_0x2e8992(0x14c)]?.[_0x2e8992(0x176)]()){case _0x2e8992(0x175):_0x58173c=_0x2e8992(0x15a);break;case _0x2e8992(0x18b):case _0x2e8992(0x198):case _0x2e8992(0x169):_0x58173c=_0x2e8992(0x117);break;case'expired':case'timeout':_0x58173c=_0x2e8992(0x173);break;case _0x2e8992(0x113):case'awaiting\x20fiat':case _0x2e8992(0x133):case _0x2e8992(0x125):default:_0x58173c=_0x2e8992(0x18e);break;}let _0x1f7674,_0x360544;if(_0x9cfb54[_0x2e8992(0x116)][_0x2e8992(0x19b)]){const _0x2eea83=_0x9cfb54[_0x2e8992(0x116)][_0x2e8992(0x19b)];console[_0x2e8992(0x15b)](_0x2e8992(0x12d),_0x2eea83);const _0x5ba6e1=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x4307ea of _0x5ba6e1){const _0x4dcced=_0x2eea83[_0x2e8992(0x142)](_0x4307ea);if(_0x4dcced){_0x1f7674=_0x4dcced[0x1],console[_0x2e8992(0x15b)](_0x2e8992(0x145),_0x1f7674,_0x2e8992(0x121),_0x4307ea[_0x2e8992(0x138)]);break;}}if(!_0x1f7674){console[_0x2e8992(0x15b)]('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x408dec=_0x2eea83[_0x2e8992(0x142)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x408dec&&(_0x1f7674=_0x408dec[0x1],console[_0x2e8992(0x15b)](_0x2e8992(0x152),_0x1f7674));}_0x360544=_0x2eea83;}const _0x5cdac9={'iban':_0x1f7674,'bankDetails':_0x360544,'transactionId':_0x9cfb54['data'][_0x2e8992(0x18c)],'coinAddress':_0x9cfb54[_0x2e8992(0x116)][_0x2e8992(0x16c)],'qrCodeUrl':_0x9cfb54[_0x2e8992(0x116)][_0x2e8992(0x155)],'expiryTime':_0x9cfb54[_0x2e8992(0x116)]['ExpiryTime'],'createdOn':_0x9cfb54[_0x2e8992(0x116)]['CreatedOn'],'confirmedOn':_0x9cfb54['data'][_0x2e8992(0x160)]};console[_0x2e8992(0x15b)](_0x2e8992(0x114)),console[_0x2e8992(0x15b)](_0x2e8992(0x14f),_0x9cfb54['data']['Status'],'->',_0x58173c),console['log'](_0x2e8992(0x123),_0x9cfb54[_0x2e8992(0x116)][_0x2e8992(0x131)],_0x9cfb54[_0x2e8992(0x116)][_0x2e8992(0x14d)]),console[_0x2e8992(0x15b)](_0x2e8992(0x118),_0x9cfb54[_0x2e8992(0x116)][_0x2e8992(0x18c)]),console['log'](_0x2e8992(0x161),_0x1f7674||_0x2e8992(0x195)),console[_0x2e8992(0x15b)](_0x2e8992(0x12a),_0x9cfb54[_0x2e8992(0x116)][_0x2e8992(0x12f)]),console[_0x2e8992(0x15b)](_0x2e8992(0x13f),_0x9cfb54['data'][_0x2e8992(0x160)]||_0x2e8992(0x13c));if(_0x9cfb54[_0x2e8992(0x116)]['Status']?.['toLowerCase']()==='awaiting\x20fiat')console[_0x2e8992(0x15b)](_0x2e8992(0x180));else _0x9cfb54[_0x2e8992(0x116)][_0x2e8992(0x14c)]?.[_0x2e8992(0x176)]()===_0x2e8992(0x175)&&console[_0x2e8992(0x15b)](_0x2e8992(0x16a));return{'status':_0x58173c,'amount':parseFloat(_0x9cfb54[_0x2e8992(0x116)][_0x2e8992(0x131)])||undefined,'currency':_0x9cfb54[_0x2e8992(0x116)][_0x2e8992(0x14d)]||_0x2e8992(0x193),'paymentDetails':_0x5cdac9};}catch(_0x1b1511){console[_0x2e8992(0x169)](_0x2e8992(0x17d),_0x1b1511),loggerService_1[_0x2e8992(0x16e)][_0x2e8992(0x11f)](_0x2e8992(0x17c),_0x2e8992(0x164),_0x1b1511);throw new Error(_0x2e8992(0x141)+(_0x1b1511 instanceof Error?_0x1b1511[_0x2e8992(0x17a)]:_0x2e8992(0x15c)));}}async['verifyPayment'](_0x445ee7){const _0x249102=a42_0x487fa2,_0x2e897f=await this[_0x249102(0x139)](_0x445ee7);return{'status':_0x2e897f[_0x249102(0x196)],'amount':_0x2e897f[_0x249102(0x13a)],'currency':_0x2e897f['currency']};}async[a42_0x487fa2(0x188)](_0x40fc67){const _0x1addae=a42_0x487fa2;console[_0x1addae(0x15b)]('Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x40fc67);let _0x545220='PENDING';switch(_0x40fc67[_0x1addae(0x196)]?.[_0x1addae(0x176)]()){case _0x1addae(0x175):_0x545220=_0x1addae(0x15a);break;case _0x1addae(0x18b):case _0x1addae(0x198):case'error':_0x545220=_0x1addae(0x117);break;case _0x1addae(0x179):case _0x1addae(0x124):_0x545220=_0x1addae(0x173);break;case _0x1addae(0x133):case'waiting':case _0x1addae(0x192):case _0x1addae(0x125):default:_0x545220=_0x1addae(0x18e);break;}return{'paymentId':_0x40fc67['order_id']||_0x40fc67[_0x1addae(0x150)]||'','status':_0x545220,'amount':_0x40fc67[_0x1addae(0x13a)],'currency':_0x40fc67['currency']||_0x1addae(0x193)};}}exports['CoinToPay2Service']=CoinToPay2Service;