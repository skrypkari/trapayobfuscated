'use strict';const a43_0x394c86=a43_0x461f;(function(_0x2271d8,_0x573441){const _0x245f53=a43_0x461f,_0x37a513=_0x2271d8();while(!![]){try{const _0x5ee289=parseInt(_0x245f53(0x1e7))/0x1+-parseInt(_0x245f53(0x20c))/0x2+-parseInt(_0x245f53(0x247))/0x3*(-parseInt(_0x245f53(0x221))/0x4)+-parseInt(_0x245f53(0x1e0))/0x5+-parseInt(_0x245f53(0x223))/0x6+parseInt(_0x245f53(0x233))/0x7+parseInt(_0x245f53(0x22b))/0x8;if(_0x5ee289===_0x573441)break;else _0x37a513['push'](_0x37a513['shift']());}catch(_0x510fbb){_0x37a513['push'](_0x37a513['shift']());}}}(a43_0x5093,0xb8453));function a43_0x5093(){const _0x2deccb=['text','CoinToPay2\x20API\x20error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','failed','defineProperty','HTTP\x20Status:','processWebhook','stringify','Incomplete\x20response:\x20missing\x20data','CoinToPay2\x20status\x20API\x20error:\x20','https://traffer.uk/gateway/cointopay/','HTTP\x20','/create','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Status:','pending','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','logWhiteDomainRequest','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','ExpiryTime','Headers:','3972705oXQpSf','result','/status','https://traffer.uk/gateway/cointopay/status.php','Response\x20Time:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','timeout','680008OUkknZ','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','match','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','loggerService','EXPIRED','TransactionID','URL:','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','source','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','HTTP\x20error!\x20status:\x20','CoinToPay2Service','currency','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','Unknown\x20error','checkPaymentStatus','üè¶\x20Payment\x20Detail:','Currency:','toLowerCase','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','CoinToPay2\x20payment\x20status\x20check\x20error:','üìä\x20Status\x20check\x20URL:','coinAddress','not\x20found','Response\x20Body:','statusText','PaymentDetail','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','Status\x20Code:','EUR','logWhiteDomainResponse','gateway_payment_id','status','expired','635712UgDtat','Unknown\x20error\x20from\x20CoinToPay2\x20API','QRCodeURL','Payment\x20URL:','Error\x20details:','awaiting\x20fiat','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','TransactionConfirmedOn','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','üè¶\x20Extracted\x20IBAN:','Payment\x20Status:','cancelled','cointopay2','paid','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','payment_url','Status\x20API\x20Error:\x20','log','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','headers','Missing\x20data\x20in\x20response','414156ntviJo','logWhiteDomainError','41304pWyCpp','Error\x20message:','__esModule','../loggerService','CreatedOn','Result:','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','3843016jkEakA','PENDING','Parsed\x20Result:','merchant_reference_id','POST','stack','now','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','647031DnyLAs','Gateway\x20Payment\x20ID:','error','created',',\x20body:\x20','not\x20confirmed','Status','Amount','JSON\x20Parse\x20Error:\x20','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','\x20EUR','amount','application/json','inputCurrency','message','FAILED','IBAN:','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','Amount:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','18sGLAVQ','createPaymentLink','apiUrl','data'];a43_0x5093=function(){return _0x2deccb;};return a43_0x5093();}function a43_0x461f(_0x56bd79,_0x3096ef){const _0x50936d=a43_0x5093();return a43_0x461f=function(_0x461f84,_0xa94225){_0x461f84=_0x461f84-0x1d4;let _0x27eaee=_0x50936d[_0x461f84];return _0x27eaee;},a43_0x461f(_0x56bd79,_0x3096ef);}Object[a43_0x394c86(0x24f)](exports,a43_0x394c86(0x225),{'value':!![]}),exports['CoinToPay2Service']=void 0x0;const loggerService_1=require(a43_0x394c86(0x226));class CoinToPay2Service{constructor(){const _0x22ed40=a43_0x394c86;this[_0x22ed40(0x249)]=_0x22ed40(0x1d4),this['statusUrl']=_0x22ed40(0x1e3),console[_0x22ed40(0x21d)](_0x22ed40(0x22a)),console[_0x22ed40(0x21d)](_0x22ed40(0x1fe),this['statusUrl']);}async[a43_0x394c86(0x248)](_0x9aa1dd){const _0xe103ea=a43_0x394c86,{orderId:_0x52694e,amount:_0xea71e7}=_0x9aa1dd;console[_0xe103ea(0x21d)]('ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20'+_0xea71e7+_0xe103ea(0x23d));const _0x318489={'amount':_0xea71e7},_0x33cb3b=Date[_0xe103ea(0x231)]();try{console[_0xe103ea(0x21d)](_0xe103ea(0x1dc)),console[_0xe103ea(0x21d)](_0xe103ea(0x1ee),this['apiUrl']),console['log']('Request\x20Body:',JSON[_0xe103ea(0x252)](_0x318489,null,0x2)),console[_0xe103ea(0x21d)]('Amount:',_0xea71e7,'EUR\x20(always\x20EUR\x20for\x20CoinToPay2)'),loggerService_1[_0xe103ea(0x1eb)]['logWhiteDomainRequest'](_0xe103ea(0x218),_0xe103ea(0x1d6),_0xe103ea(0x22f),_0x318489);const _0x4cfc6d=await fetch(this[_0xe103ea(0x249)],{'method':'POST','headers':{'Content-Type':_0xe103ea(0x23f),'Accept':_0xe103ea(0x23f),'User-Agent':_0xe103ea(0x1e8)},'body':JSON[_0xe103ea(0x252)](_0x318489)}),_0x4567b1=Date['now']()-_0x33cb3b;console[_0xe103ea(0x21d)](_0xe103ea(0x1fb)),console['log'](_0xe103ea(0x1d8),_0x4cfc6d['status']),console[_0xe103ea(0x21d)]('Status\x20Text:',_0x4cfc6d[_0xe103ea(0x202)]),console['log'](_0xe103ea(0x1df),Object['fromEntries'](_0x4cfc6d[_0xe103ea(0x21f)]['entries']())),console[_0xe103ea(0x21d)](_0xe103ea(0x1e4),_0x4567b1+'ms');const _0x26a61c=await _0x4cfc6d[_0xe103ea(0x24b)]();console['log']('Raw\x20Response\x20Body:',_0x26a61c);if(!_0x4cfc6d['ok']){console[_0xe103ea(0x235)](_0xe103ea(0x1d7)),console['error']('HTTP\x20Status:',_0x4cfc6d[_0xe103ea(0x20a)]),console[_0xe103ea(0x235)](_0xe103ea(0x201),_0x26a61c),loggerService_1[_0xe103ea(0x1eb)][_0xe103ea(0x208)](_0xe103ea(0x218),'/create',_0x4cfc6d[_0xe103ea(0x20a)],_0x26a61c,_0x4567b1),loggerService_1[_0xe103ea(0x1eb)][_0xe103ea(0x222)](_0xe103ea(0x218),_0xe103ea(0x1d6),_0xe103ea(0x1d5)+_0x4cfc6d[_0xe103ea(0x20a)]+':\x20'+_0x26a61c);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4cfc6d[_0xe103ea(0x20a)]+_0xe103ea(0x237)+_0x26a61c);}let _0x5917ae;try{_0x5917ae=JSON['parse'](_0x26a61c);}catch(_0x528a81){console[_0xe103ea(0x235)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x528a81),loggerService_1[_0xe103ea(0x1eb)]['logWhiteDomainError']('cointopay2','/create',_0xe103ea(0x23b)+_0x528a81);throw new Error(_0xe103ea(0x246)+_0x26a61c);}console[_0xe103ea(0x21d)](_0xe103ea(0x1e5)),console[_0xe103ea(0x21d)](_0xe103ea(0x22d),JSON[_0xe103ea(0x252)](_0x5917ae,null,0x2)),loggerService_1[_0xe103ea(0x1eb)]['logWhiteDomainResponse'](_0xe103ea(0x218),_0xe103ea(0x1d6),_0x4cfc6d['status'],_0x5917ae,_0x4567b1);if(_0x5917ae[_0xe103ea(0x235)]){const _0x2682ea=_0x5917ae[_0xe103ea(0x241)]||_0x5917ae[_0xe103ea(0x235)]||_0xe103ea(0x20d);console[_0xe103ea(0x235)](_0xe103ea(0x232)),console['error']('Error\x20Message:',_0x2682ea),loggerService_1[_0xe103ea(0x1eb)]['logWhiteDomainError']('cointopay2','/create','Business\x20Error:\x20'+_0x2682ea);throw new Error(_0xe103ea(0x24c)+_0x2682ea);}if(!_0x5917ae['payment_url']||!_0x5917ae['gateway_payment_id']){console[_0xe103ea(0x235)](_0xe103ea(0x1fc)),console[_0xe103ea(0x235)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0xe103ea(0x235)]('Response\x20data:',_0x5917ae),loggerService_1[_0xe103ea(0x1eb)][_0xe103ea(0x222)](_0xe103ea(0x218),_0xe103ea(0x1d6),_0xe103ea(0x214));throw new Error(_0xe103ea(0x1ea));}return console[_0xe103ea(0x21d)]('===\x20COINTOPAY2\x20SUCCESS\x20==='),console[_0xe103ea(0x21d)](_0xe103ea(0x234),_0x5917ae[_0xe103ea(0x209)]),console[_0xe103ea(0x21d)](_0xe103ea(0x20f),_0x5917ae['payment_url']),console['log'](_0xe103ea(0x245),_0xea71e7,_0xe103ea(0x207)),{'gateway_payment_id':_0x5917ae[_0xe103ea(0x209)],'payment_url':_0x5917ae[_0xe103ea(0x21b)]};}catch(_0x96b40){console['error']('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0xe103ea(0x235)](_0xe103ea(0x210),_0x96b40),loggerService_1['loggerService']['logWhiteDomainError'](_0xe103ea(0x218),'/create',_0x96b40);if(_0x96b40 instanceof Error){console['error'](_0xe103ea(0x224),_0x96b40[_0xe103ea(0x241)]),console['error']('Error\x20stack:',_0x96b40[_0xe103ea(0x230)]);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x96b40[_0xe103ea(0x241)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x36c0cd){const _0x929a25=a43_0x394c86,_0x279758=Date[_0x929a25(0x231)]();try{console[_0x929a25(0x21d)]('üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0x36c0cd);const _0x46f59e={'gatewayPaymentId':_0x36c0cd};loggerService_1[_0x929a25(0x1eb)][_0x929a25(0x1db)]('cointopay2',_0x929a25(0x1e2),_0x929a25(0x22f),_0x46f59e);const _0xff377e=await fetch(this['statusUrl'],{'method':_0x929a25(0x22f),'headers':{'Content-Type':_0x929a25(0x23f),'Accept':_0x929a25(0x23f),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x929a25(0x252)](_0x46f59e)}),_0x53d478=Date[_0x929a25(0x231)]()-_0x279758;console['log'](_0x929a25(0x212)),console[_0x929a25(0x21d)](_0x929a25(0x1d8),_0xff377e['status']),console['log'](_0x929a25(0x1e4),_0x53d478+'ms');if(!_0xff377e['ok']){const _0x3de66e=await _0xff377e[_0x929a25(0x24b)]();console['error'](_0x929a25(0x250),_0xff377e[_0x929a25(0x20a)]),console[_0x929a25(0x235)]('Response\x20Body:',_0x3de66e),loggerService_1[_0x929a25(0x1eb)][_0x929a25(0x208)](_0x929a25(0x218),_0x929a25(0x1e2),_0xff377e[_0x929a25(0x20a)],_0x3de66e,_0x53d478),loggerService_1[_0x929a25(0x1eb)][_0x929a25(0x222)](_0x929a25(0x218),'/status',_0x929a25(0x1d5)+_0xff377e['status']+':\x20'+_0x3de66e);throw new Error(_0x929a25(0x1f2)+_0xff377e['status']);}const _0x26e640=await _0xff377e['text']();console['log']('Raw\x20Response\x20Body:',_0x26e640);let _0x3bf183;try{_0x3bf183=JSON['parse'](_0x26e640);}catch(_0xcfd5bf){console[_0x929a25(0x235)](_0x929a25(0x24d),_0xcfd5bf),loggerService_1[_0x929a25(0x1eb)][_0x929a25(0x222)](_0x929a25(0x218),_0x929a25(0x1e2),_0x929a25(0x23b)+_0xcfd5bf);throw new Error(_0x929a25(0x1da)+_0x26e640);}loggerService_1[_0x929a25(0x1eb)][_0x929a25(0x208)](_0x929a25(0x218),_0x929a25(0x1e2),_0xff377e['status'],_0x3bf183,_0x53d478),console[_0x929a25(0x21d)](_0x929a25(0x244)),console[_0x929a25(0x21d)](_0x929a25(0x228),_0x3bf183['result']),console[_0x929a25(0x21d)](_0x929a25(0x206),_0x3bf183['status_code']),console[_0x929a25(0x21d)](_0x929a25(0x216),_0x3bf183['data']?.['Status']),console[_0x929a25(0x21d)](_0x929a25(0x245),_0x3bf183[_0x929a25(0x24a)]?.[_0x929a25(0x23a)]),console[_0x929a25(0x21d)](_0x929a25(0x1f9),_0x3bf183[_0x929a25(0x24a)]?.[_0x929a25(0x240)]);if(_0x3bf183[_0x929a25(0x1e1)]!=='success'||_0x3bf183['status_code']!==0xc8){const _0x4529f0=_0x3bf183[_0x929a25(0x241)]||_0x929a25(0x1dd);console['error'](_0x929a25(0x1ef)),console[_0x929a25(0x235)]('Error\x20Message:',_0x4529f0),loggerService_1[_0x929a25(0x1eb)][_0x929a25(0x222)]('cointopay2',_0x929a25(0x1e2),_0x929a25(0x21c)+_0x4529f0);throw new Error(_0x929a25(0x254)+_0x4529f0);}if(!_0x3bf183['data']){console['error'](_0x929a25(0x229)),console[_0x929a25(0x235)](_0x929a25(0x220)),loggerService_1[_0x929a25(0x1eb)][_0x929a25(0x222)](_0x929a25(0x218),_0x929a25(0x1e2),_0x929a25(0x253));throw new Error(_0x929a25(0x21e));}let _0x213014=_0x929a25(0x22c);switch(_0x3bf183['data']['Status']?.[_0x929a25(0x1fa)]()){case _0x929a25(0x219):_0x213014='PAID';break;case _0x929a25(0x217):case _0x929a25(0x24e):case _0x929a25(0x235):_0x213014=_0x929a25(0x242);break;case _0x929a25(0x20b):case _0x929a25(0x1e6):_0x213014=_0x929a25(0x1ec);break;case'waiting':case _0x929a25(0x211):case'pending':case _0x929a25(0x236):default:_0x213014=_0x929a25(0x22c);break;}let _0x5c4ab4,_0x43c643;if(_0x3bf183[_0x929a25(0x24a)][_0x929a25(0x203)]){const _0x5a829c=_0x3bf183['data'][_0x929a25(0x203)];console['log'](_0x929a25(0x1f8),_0x5a829c);const _0x1022fe=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x2e4d41 of _0x1022fe){const _0xf5bcee=_0x5a829c[_0x929a25(0x1e9)](_0x2e4d41);if(_0xf5bcee){_0x5c4ab4=_0xf5bcee[0x1],console[_0x929a25(0x21d)](_0x929a25(0x215),_0x5c4ab4,'using\x20pattern:',_0x2e4d41[_0x929a25(0x1f0)]);break;}}if(!_0x5c4ab4){console[_0x929a25(0x21d)](_0x929a25(0x205));const _0x2edf5e=_0x5a829c[_0x929a25(0x1e9)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x2edf5e&&(_0x5c4ab4=_0x2edf5e[0x1],console[_0x929a25(0x21d)](_0x929a25(0x1f5),_0x5c4ab4));}_0x43c643=_0x5a829c;}const _0x8d2da1={'iban':_0x5c4ab4,'bankDetails':_0x43c643,'transactionId':_0x3bf183[_0x929a25(0x24a)][_0x929a25(0x1ed)],'coinAddress':_0x3bf183[_0x929a25(0x24a)][_0x929a25(0x1ff)],'qrCodeUrl':_0x3bf183['data'][_0x929a25(0x20e)],'expiryTime':_0x3bf183[_0x929a25(0x24a)][_0x929a25(0x1de)],'createdOn':_0x3bf183[_0x929a25(0x24a)][_0x929a25(0x227)],'confirmedOn':_0x3bf183['data'][_0x929a25(0x213)]};console[_0x929a25(0x21d)]('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console[_0x929a25(0x21d)](_0x929a25(0x1d8),_0x3bf183['data'][_0x929a25(0x239)],'->',_0x213014),console[_0x929a25(0x21d)](_0x929a25(0x245),_0x3bf183[_0x929a25(0x24a)][_0x929a25(0x23a)],_0x3bf183[_0x929a25(0x24a)][_0x929a25(0x240)]),console[_0x929a25(0x21d)]('Transaction\x20ID:',_0x3bf183[_0x929a25(0x24a)][_0x929a25(0x1ed)]),console['log'](_0x929a25(0x243),_0x5c4ab4||_0x929a25(0x200)),console[_0x929a25(0x21d)]('Created\x20On:',_0x3bf183[_0x929a25(0x24a)]['CreatedOn']),console['log']('Confirmed\x20On:',_0x3bf183[_0x929a25(0x24a)][_0x929a25(0x213)]||_0x929a25(0x238));if(_0x3bf183[_0x929a25(0x24a)][_0x929a25(0x239)]?.[_0x929a25(0x1fa)]()===_0x929a25(0x211))console['log'](_0x929a25(0x21a));else _0x3bf183[_0x929a25(0x24a)][_0x929a25(0x239)]?.[_0x929a25(0x1fa)]()==='paid'&&console[_0x929a25(0x21d)](_0x929a25(0x23c));return{'status':_0x213014,'amount':parseFloat(_0x3bf183[_0x929a25(0x24a)]['Amount'])||undefined,'currency':_0x3bf183[_0x929a25(0x24a)]['inputCurrency']||_0x929a25(0x207),'paymentDetails':_0x8d2da1};}catch(_0x15a9e5){console[_0x929a25(0x235)](_0x929a25(0x1fd),_0x15a9e5),loggerService_1[_0x929a25(0x1eb)][_0x929a25(0x222)]('cointopay2',_0x929a25(0x1e2),_0x15a9e5);throw new Error(_0x929a25(0x204)+(_0x15a9e5 instanceof Error?_0x15a9e5[_0x929a25(0x241)]:_0x929a25(0x1f6)));}}async['verifyPayment'](_0x5c6c73){const _0x4f1781=a43_0x394c86,_0x1b084b=await this[_0x4f1781(0x1f7)](_0x5c6c73);return{'status':_0x1b084b[_0x4f1781(0x20a)],'amount':_0x1b084b['amount'],'currency':_0x1b084b[_0x4f1781(0x1f4)]};}async[a43_0x394c86(0x251)](_0x3d45bd){const _0x18994c=a43_0x394c86;console[_0x18994c(0x21d)](_0x18994c(0x1f1),_0x3d45bd);let _0x3f7eca=_0x18994c(0x22c);switch(_0x3d45bd[_0x18994c(0x20a)]?.['toLowerCase']()){case _0x18994c(0x219):_0x3f7eca='PAID';break;case _0x18994c(0x217):case'failed':case _0x18994c(0x235):_0x3f7eca=_0x18994c(0x242);break;case _0x18994c(0x20b):case _0x18994c(0x1e6):_0x3f7eca='EXPIRED';break;case _0x18994c(0x1d9):case'waiting':case _0x18994c(0x211):case'created':default:_0x3f7eca=_0x18994c(0x22c);break;}return{'paymentId':_0x3d45bd['order_id']||_0x3d45bd[_0x18994c(0x22e)]||'','status':_0x3f7eca,'amount':_0x3d45bd[_0x18994c(0x23e)],'currency':_0x3d45bd['currency']||_0x18994c(0x207)};}}exports[a43_0x394c86(0x1f3)]=CoinToPay2Service;