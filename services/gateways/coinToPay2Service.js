'use strict';function a56_0x3fa8(){const _0xc431bd=['apiUrl','Response\x20Body:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','toLowerCase','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','ExpiryTime','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','not\x20found','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','Payment\x20System/1.0\x20(CoinToPay2)','4304536ZLLNUR','\x20EUR','logWhiteDomainResponse','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','now','cancelled','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Status\x20Code:','expired','gateway_payment_id','Error\x20details:','Raw\x20Response\x20Body:','Amount','CoinToPay2\x20status\x20API\x20error:\x20','/create','PENDING','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','POST','processWebhook','application/json','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','üè¶\x20Payment\x20Detail:','/status','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Payment\x20URL\x20(modified):','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','TransactionConfirmedOn','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','7TyiOtp','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','475892EBcdme','payment_url','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','HTTP\x20Status:','CoinToPay2\x20payment\x20status\x20check\x20error:','Unknown\x20error\x20from\x20CoinToPay2\x20API','Business\x20Error:\x20','===\x20COINTOPAY2\x20API\x20ERROR\x20===','inputCurrency','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','1160NfSZQs','fromEntries','HTTP\x20error!\x20status:\x20','error','30YcrOrW','https://traffer.uk/gateway/cointopay/','IBAN:','Amount:','FAILED','Request\x20Body:','stringify','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','https://traffer.uk/gateway/cointopay/status.php','EUR','created','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','Payment\x20URL\x20(original):',',\x20body:\x20','48230QtSWhE','loggerService','result','stack','Response\x20Time:','order_id','cointopay2','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','46838KmxCNO','success','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','defineProperty','using\x20pattern:','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','11rNNrKZ','Incomplete\x20response:\x20missing\x20data','üè¶\x20Extracted\x20IBAN:','CoinToPay2\x20API\x20error:\x20','../loggerService','Failed\x20to\x20parse\x20JSON\x20response:','Response\x20data:','status','Created\x20On:','Error\x20message:','parse','checkPaymentStatus','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','match','merchant_reference_id','waiting','log','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','URL:','pending','Confirmed\x20On:','Error\x20stack:','failed','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','418554jCgvDJ','Status\x20Text:','verifyPayment','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','2941098TFOzay','statusUrl','JSON\x20Parse\x20Error:\x20','TransactionID','createPaymentLink','CoinToPay2Service','data','paid','Result:','amount','text','message','CreatedOn','Status','status_code','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','Parsed\x20Result:','timeout','currency','Error\x20Message:','Status\x20API\x20Error:\x20','logWhiteDomainError','Missing\x20data\x20in\x20response','HTTP\x20','Status:','awaiting\x20fiat','PaymentDetail','EXPIRED','527037hbqZPd','&alternative=false','PAID'];a56_0x3fa8=function(){return _0xc431bd;};return a56_0x3fa8();}const a56_0x4c29af=a56_0x1492;function a56_0x1492(_0xb0074d,_0x42a6f1){_0xb0074d=_0xb0074d-0x9a;const _0x3fa8e7=a56_0x3fa8();let _0x1492cb=_0x3fa8e7[_0xb0074d];return _0x1492cb;}(function(_0xbd4597,_0x5afe44){const _0x1f895a=a56_0x1492,_0x17a133=_0xbd4597();while(!![]){try{const _0x4cf53f=parseInt(_0x1f895a(0xf8))/0x1*(-parseInt(_0x1f895a(0xea))/0x2)+-parseInt(_0x1f895a(0xa3))/0x3+-parseInt(_0x1f895a(0xce))/0x4*(parseInt(_0x1f895a(0xdc))/0x5)+-parseInt(_0x1f895a(0x114))/0x6*(-parseInt(_0x1f895a(0xcc))/0x7)+parseInt(_0x1f895a(0xb0))/0x8+parseInt(_0x1f895a(0x110))/0x9+parseInt(_0x1f895a(0xd8))/0xa*(parseInt(_0x1f895a(0xf2))/0xb);if(_0x4cf53f===_0x5afe44)break;else _0x17a133['push'](_0x17a133['shift']());}catch(_0x30ff56){_0x17a133['push'](_0x17a133['shift']());}}}(a56_0x3fa8,0x650ce));Object[a56_0x4c29af(0xf5)](exports,'__esModule',{'value':!![]}),exports['CoinToPay2Service']=void 0x0;const loggerService_1=require(a56_0x4c29af(0xfc));class CoinToPay2Service{constructor(){const _0x4cf198=a56_0x4c29af;this[_0x4cf198(0xa6)]=_0x4cf198(0xdd),this[_0x4cf198(0x115)]=_0x4cf198(0xe4),console['log'](_0x4cf198(0xcd)),console[_0x4cf198(0x108)]('üìä\x20Status\x20check\x20URL:',this[_0x4cf198(0x115)]);}async[a56_0x4c29af(0x118)](_0x50ea98){const _0x2e446c=a56_0x4c29af,{orderId:_0x4ec072,amount:_0x8f5977}=_0x50ea98;console[_0x2e446c(0x108)](_0x2e446c(0xcb)+_0x8f5977+_0x2e446c(0xb1));const _0x492748={'amount':_0x8f5977},_0x39d9f8=Date['now']();try{console[_0x2e446c(0x108)](_0x2e446c(0xc9)),console['log'](_0x2e446c(0x10a),this[_0x2e446c(0xa6)]),console['log'](_0x2e446c(0xe1),JSON['stringify'](_0x492748,null,0x2)),console[_0x2e446c(0x108)](_0x2e446c(0xdf),_0x8f5977,_0x2e446c(0xe7)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x2e446c(0xf0),_0x2e446c(0xbe),'POST',_0x492748);const _0x3ae690=await fetch(this[_0x2e446c(0xa6)],{'method':'POST','headers':{'Content-Type':_0x2e446c(0xc3),'Accept':_0x2e446c(0xc3),'User-Agent':_0x2e446c(0xaf)},'body':JSON[_0x2e446c(0xe2)](_0x492748)}),_0x242b0f=Date[_0x2e446c(0xb4)]()-_0x39d9f8;console[_0x2e446c(0x108)](_0x2e446c(0x104)),console[_0x2e446c(0x108)](_0x2e446c(0x9f),_0x3ae690[_0x2e446c(0xff)]),console[_0x2e446c(0x108)](_0x2e446c(0x111),_0x3ae690['statusText']),console['log']('Headers:',Object[_0x2e446c(0xd9)](_0x3ae690['headers']['entries']())),console['log'](_0x2e446c(0xee),_0x242b0f+'ms');const _0x9e298c=await _0x3ae690[_0x2e446c(0x11e)]();console[_0x2e446c(0x108)](_0x2e446c(0xbb),_0x9e298c);if(!_0x3ae690['ok']){console['error'](_0x2e446c(0xd5)),console[_0x2e446c(0xdb)](_0x2e446c(0xd1),_0x3ae690[_0x2e446c(0xff)]),console[_0x2e446c(0xdb)](_0x2e446c(0xa7),_0x9e298c),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2e446c(0xf0),_0x2e446c(0xbe),_0x3ae690['status'],_0x9e298c,_0x242b0f),loggerService_1['loggerService'][_0x2e446c(0x9c)](_0x2e446c(0xf0),_0x2e446c(0xbe),'HTTP\x20'+_0x3ae690[_0x2e446c(0xff)]+':\x20'+_0x9e298c);throw new Error(_0x2e446c(0xda)+_0x3ae690['status']+_0x2e446c(0xe9)+_0x9e298c);}let _0x594e43;try{_0x594e43=JSON[_0x2e446c(0x102)](_0x9e298c);}catch(_0x370a36){console[_0x2e446c(0xdb)](_0x2e446c(0xfd),_0x370a36),loggerService_1[_0x2e446c(0xeb)]['logWhiteDomainError'](_0x2e446c(0xf0),_0x2e446c(0xbe),'JSON\x20Parse\x20Error:\x20'+_0x370a36);throw new Error(_0x2e446c(0xae)+_0x9e298c);}console[_0x2e446c(0x108)](_0x2e446c(0xaa)),console[_0x2e446c(0x108)](_0x2e446c(0x124),JSON[_0x2e446c(0xe2)](_0x594e43,null,0x2)),loggerService_1[_0x2e446c(0xeb)][_0x2e446c(0xb2)](_0x2e446c(0xf0),_0x2e446c(0xbe),_0x3ae690[_0x2e446c(0xff)],_0x594e43,_0x242b0f);if(_0x594e43[_0x2e446c(0xdb)]){const _0x466cc8=_0x594e43['message']||_0x594e43[_0x2e446c(0xdb)]||_0x2e446c(0xd3);console[_0x2e446c(0xdb)](_0x2e446c(0xc4)),console[_0x2e446c(0xdb)](_0x2e446c(0x9a),_0x466cc8),loggerService_1[_0x2e446c(0xeb)][_0x2e446c(0x9c)]('cointopay2',_0x2e446c(0xbe),_0x2e446c(0xd4)+_0x466cc8);throw new Error(_0x2e446c(0xfb)+_0x466cc8);}if(!_0x594e43['payment_url']||!_0x594e43['gateway_payment_id']){console[_0x2e446c(0xdb)](_0x2e446c(0xd7)),console[_0x2e446c(0xdb)](_0x2e446c(0xd0)),console[_0x2e446c(0xdb)](_0x2e446c(0xfe),_0x594e43),loggerService_1[_0x2e446c(0xeb)][_0x2e446c(0x9c)](_0x2e446c(0xf0),_0x2e446c(0xbe),_0x2e446c(0xa8));throw new Error(_0x2e446c(0xf7));}console[_0x2e446c(0x108)]('===\x20COINTOPAY2\x20SUCCESS\x20==='),console['log']('Gateway\x20Payment\x20ID:',_0x594e43[_0x2e446c(0xb9)]),console[_0x2e446c(0x108)](_0x2e446c(0xe8),_0x594e43[_0x2e446c(0xcf)]);const _0x118233=_0x594e43[_0x2e446c(0xcf)]+_0x2e446c(0xa4);return console[_0x2e446c(0x108)](_0x2e446c(0xc8),_0x118233),console[_0x2e446c(0x108)]('Amount:',_0x8f5977,_0x2e446c(0xe5)),{'gateway_payment_id':_0x594e43[_0x2e446c(0xb9)],'payment_url':_0x118233};}catch(_0x393b71){console['error'](_0x2e446c(0x109)),console[_0x2e446c(0xdb)](_0x2e446c(0xba),_0x393b71),loggerService_1[_0x2e446c(0xeb)][_0x2e446c(0x9c)](_0x2e446c(0xf0),_0x2e446c(0xbe),_0x393b71);if(_0x393b71 instanceof Error){console[_0x2e446c(0xdb)](_0x2e446c(0x101),_0x393b71[_0x2e446c(0x11f)]),console['error'](_0x2e446c(0x10d),_0x393b71[_0x2e446c(0xed)]);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x393b71['message']);}throw new Error(_0x2e446c(0xe3));}}async[a56_0x4c29af(0x103)](_0x439ed1){const _0x44c281=a56_0x4c29af,_0x4408d5=Date[_0x44c281(0xb4)]();try{console['log'](_0x44c281(0xc0)+_0x439ed1);const _0x2b152c={'gatewayPaymentId':_0x439ed1};loggerService_1[_0x44c281(0xeb)]['logWhiteDomainRequest'](_0x44c281(0xf0),_0x44c281(0xc6),_0x44c281(0xc1),_0x2b152c);const _0x4d56b6=await fetch(this[_0x44c281(0x115)],{'method':_0x44c281(0xc1),'headers':{'Content-Type':_0x44c281(0xc3),'Accept':_0x44c281(0xc3),'User-Agent':'Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x44c281(0xe2)](_0x2b152c)}),_0xb492bc=Date[_0x44c281(0xb4)]()-_0x4408d5;console[_0x44c281(0x108)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log'](_0x44c281(0x9f),_0x4d56b6[_0x44c281(0xff)]),console[_0x44c281(0x108)](_0x44c281(0xee),_0xb492bc+'ms');if(!_0x4d56b6['ok']){const _0x3b7a7d=await _0x4d56b6['text']();console[_0x44c281(0xdb)](_0x44c281(0xd1),_0x4d56b6['status']),console[_0x44c281(0xdb)](_0x44c281(0xa7),_0x3b7a7d),loggerService_1[_0x44c281(0xeb)]['logWhiteDomainResponse']('cointopay2',_0x44c281(0xc6),_0x4d56b6[_0x44c281(0xff)],_0x3b7a7d,_0xb492bc),loggerService_1[_0x44c281(0xeb)][_0x44c281(0x9c)](_0x44c281(0xf0),_0x44c281(0xc6),_0x44c281(0x9e)+_0x4d56b6[_0x44c281(0xff)]+':\x20'+_0x3b7a7d);throw new Error(_0x44c281(0xda)+_0x4d56b6[_0x44c281(0xff)]);}const _0x312b3c=await _0x4d56b6[_0x44c281(0x11e)]();console[_0x44c281(0x108)](_0x44c281(0xbb),_0x312b3c);let _0x18e816;try{_0x18e816=JSON[_0x44c281(0x102)](_0x312b3c);}catch(_0x3c17b0){console[_0x44c281(0xdb)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x3c17b0),loggerService_1['loggerService'][_0x44c281(0x9c)]('cointopay2',_0x44c281(0xc6),_0x44c281(0x116)+_0x3c17b0);throw new Error(_0x44c281(0x113)+_0x312b3c);}loggerService_1[_0x44c281(0xeb)][_0x44c281(0xb2)](_0x44c281(0xf0),'/status',_0x4d56b6[_0x44c281(0xff)],_0x18e816,_0xb492bc),console[_0x44c281(0x108)](_0x44c281(0xf1)),console['log'](_0x44c281(0x11c),_0x18e816[_0x44c281(0xec)]),console[_0x44c281(0x108)](_0x44c281(0xb7),_0x18e816[_0x44c281(0x122)]),console[_0x44c281(0x108)]('Payment\x20Status:',_0x18e816['data']?.[_0x44c281(0x121)]),console[_0x44c281(0x108)]('Amount:',_0x18e816[_0x44c281(0x11a)]?.[_0x44c281(0xbc)]),console[_0x44c281(0x108)]('Currency:',_0x18e816['data']?.[_0x44c281(0xd6)]);if(_0x18e816[_0x44c281(0xec)]!==_0x44c281(0xf3)||_0x18e816['status_code']!==0xc8){const _0x5f6764=_0x18e816['message']||'Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API';console[_0x44c281(0xdb)](_0x44c281(0x10f)),console[_0x44c281(0xdb)](_0x44c281(0x9a),_0x5f6764),loggerService_1[_0x44c281(0xeb)][_0x44c281(0x9c)](_0x44c281(0xf0),'/status',_0x44c281(0x9b)+_0x5f6764);throw new Error(_0x44c281(0xbd)+_0x5f6764);}if(!_0x18e816[_0x44c281(0x11a)]){console[_0x44c281(0xdb)]('===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x44c281(0xdb)](_0x44c281(0x9d)),loggerService_1['loggerService'][_0x44c281(0x9c)](_0x44c281(0xf0),_0x44c281(0xc6),_0x44c281(0xf9));throw new Error(_0x44c281(0xb3));}let _0x4c7254=_0x44c281(0xbf);switch(_0x18e816[_0x44c281(0x11a)]['Status']?.['toLowerCase']()){case _0x44c281(0x11b):_0x4c7254=_0x44c281(0xa5);break;case _0x44c281(0xb5):case _0x44c281(0x10e):case _0x44c281(0xdb):_0x4c7254=_0x44c281(0xe0);break;case _0x44c281(0xb8):case _0x44c281(0x125):_0x4c7254=_0x44c281(0xa2);break;case _0x44c281(0x107):case _0x44c281(0xa0):case _0x44c281(0x10b):case'created':default:_0x4c7254=_0x44c281(0xbf);break;}let _0x538c39,_0x10da66;if(_0x18e816['data'][_0x44c281(0xa1)]){const _0x34cb31=_0x18e816[_0x44c281(0x11a)][_0x44c281(0xa1)];console[_0x44c281(0x108)](_0x44c281(0xc5),_0x34cb31);const _0x160ad3=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x558e75 of _0x160ad3){const _0x460c42=_0x34cb31[_0x44c281(0x105)](_0x558e75);if(_0x460c42){_0x538c39=_0x460c42[0x1],console[_0x44c281(0x108)](_0x44c281(0xfa),_0x538c39,_0x44c281(0xf6),_0x558e75['source']);break;}}if(!_0x538c39){console['log'](_0x44c281(0x123));const _0x181fbb=_0x34cb31[_0x44c281(0x105)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x181fbb&&(_0x538c39=_0x181fbb[0x1],console[_0x44c281(0x108)]('üè¶\x20Extracted\x20IBAN\x20via\x20fallback:',_0x538c39));}_0x10da66=_0x34cb31;}const _0x484db3={'iban':_0x538c39,'bankDetails':_0x10da66,'transactionId':_0x18e816[_0x44c281(0x11a)][_0x44c281(0x117)],'coinAddress':_0x18e816[_0x44c281(0x11a)]['coinAddress'],'qrCodeUrl':_0x18e816[_0x44c281(0x11a)]['QRCodeURL'],'expiryTime':_0x18e816['data'][_0x44c281(0xab)],'createdOn':_0x18e816[_0x44c281(0x11a)][_0x44c281(0x120)],'confirmedOn':_0x18e816[_0x44c281(0x11a)][_0x44c281(0xca)]};console['log'](_0x44c281(0xf4)),console[_0x44c281(0x108)](_0x44c281(0x9f),_0x18e816[_0x44c281(0x11a)][_0x44c281(0x121)],'->',_0x4c7254),console[_0x44c281(0x108)](_0x44c281(0xdf),_0x18e816['data'][_0x44c281(0xbc)],_0x18e816[_0x44c281(0x11a)][_0x44c281(0xd6)]),console[_0x44c281(0x108)]('Transaction\x20ID:',_0x18e816[_0x44c281(0x11a)][_0x44c281(0x117)]),console[_0x44c281(0x108)](_0x44c281(0xde),_0x538c39||_0x44c281(0xad)),console[_0x44c281(0x108)](_0x44c281(0x100),_0x18e816['data'][_0x44c281(0x120)]),console[_0x44c281(0x108)](_0x44c281(0x10c),_0x18e816[_0x44c281(0x11a)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x18e816['data'][_0x44c281(0x121)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x44c281(0x108)](_0x44c281(0xac));else _0x18e816['data']['Status']?.[_0x44c281(0xa9)]()===_0x44c281(0x11b)&&console[_0x44c281(0x108)](_0x44c281(0xc7));return{'status':_0x4c7254,'amount':parseFloat(_0x18e816[_0x44c281(0x11a)]['Amount'])||undefined,'currency':_0x18e816[_0x44c281(0x11a)][_0x44c281(0xd6)]||_0x44c281(0xe5),'paymentDetails':_0x484db3};}catch(_0x5c8abd){console[_0x44c281(0xdb)](_0x44c281(0xd2),_0x5c8abd),loggerService_1['loggerService'][_0x44c281(0x9c)](_0x44c281(0xf0),_0x44c281(0xc6),_0x5c8abd);throw new Error('Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20'+(_0x5c8abd instanceof Error?_0x5c8abd[_0x44c281(0x11f)]:'Unknown\x20error'));}}async[a56_0x4c29af(0x112)](_0x38f7a8){const _0xfd2a3f=a56_0x4c29af,_0x3f2368=await this[_0xfd2a3f(0x103)](_0x38f7a8);return{'status':_0x3f2368[_0xfd2a3f(0xff)],'amount':_0x3f2368['amount'],'currency':_0x3f2368[_0xfd2a3f(0x126)]};}async[a56_0x4c29af(0xc2)](_0x7af90d){const _0x5ba6e2=a56_0x4c29af;console[_0x5ba6e2(0x108)](_0x5ba6e2(0xb6),_0x7af90d);let _0x15ee5e=_0x5ba6e2(0xbf);switch(_0x7af90d[_0x5ba6e2(0xff)]?.['toLowerCase']()){case'paid':_0x15ee5e=_0x5ba6e2(0xa5);break;case _0x5ba6e2(0xb5):case'failed':case _0x5ba6e2(0xdb):_0x15ee5e=_0x5ba6e2(0xe0);break;case _0x5ba6e2(0xb8):case _0x5ba6e2(0x125):_0x15ee5e=_0x5ba6e2(0xa2);break;case _0x5ba6e2(0x10b):case _0x5ba6e2(0x107):case'awaiting\x20fiat':case _0x5ba6e2(0xe6):default:_0x15ee5e=_0x5ba6e2(0xbf);break;}return{'paymentId':_0x7af90d[_0x5ba6e2(0xef)]||_0x7af90d[_0x5ba6e2(0x106)]||'','status':_0x15ee5e,'amount':_0x7af90d[_0x5ba6e2(0x11d)],'currency':_0x7af90d[_0x5ba6e2(0x126)]||_0x5ba6e2(0xe5)};}}exports[a56_0x4c29af(0x119)]=CoinToPay2Service;