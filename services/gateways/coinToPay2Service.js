'use strict';const a40_0x2a3200=a40_0x31e3;(function(_0x40bcbd,_0xc5945d){const _0x4e8529=a40_0x31e3,_0x7453ec=_0x40bcbd();while(!![]){try{const _0x3df9e4=parseInt(_0x4e8529(0x203))/0x1*(-parseInt(_0x4e8529(0x1f5))/0x2)+-parseInt(_0x4e8529(0x265))/0x3*(parseInt(_0x4e8529(0x20a))/0x4)+-parseInt(_0x4e8529(0x1ef))/0x5*(parseInt(_0x4e8529(0x20f))/0x6)+-parseInt(_0x4e8529(0x23b))/0x7*(-parseInt(_0x4e8529(0x1f7))/0x8)+-parseInt(_0x4e8529(0x262))/0x9+-parseInt(_0x4e8529(0x202))/0xa+parseInt(_0x4e8529(0x26a))/0xb;if(_0x3df9e4===_0xc5945d)break;else _0x7453ec['push'](_0x7453ec['shift']());}catch(_0x50a513){_0x7453ec['push'](_0x7453ec['shift']());}}}(a40_0xfba1,0xd1634));Object[a40_0x2a3200(0x239)](exports,a40_0x2a3200(0x269),{'value':!![]}),exports['CoinToPay2Service']=void 0x0;const loggerService_1=require(a40_0x2a3200(0x24a));class CoinToPay2Service{constructor(){const _0x17b448=a40_0x2a3200;this[_0x17b448(0x1ec)]=_0x17b448(0x268),this['statusUrl']=_0x17b448(0x215),console[_0x17b448(0x249)](_0x17b448(0x1f3)),console[_0x17b448(0x249)]('📊\x20Status\x20check\x20URL:',this['statusUrl']);}async['createPaymentLink'](_0x1e4191){const _0x194670=a40_0x2a3200,{orderId:_0x23795c,amount:_0x104ba0}=_0x1e4191;console[_0x194670(0x249)](_0x194670(0x230)+_0x104ba0+_0x194670(0x220));const _0x5d4121={'amount':_0x104ba0},_0x415511=Date[_0x194670(0x210)]();try{console[_0x194670(0x249)](_0x194670(0x228)),console[_0x194670(0x249)]('URL:',this[_0x194670(0x1ec)]),console[_0x194670(0x249)](_0x194670(0x1ff),JSON[_0x194670(0x270)](_0x5d4121,null,0x2)),console[_0x194670(0x249)](_0x194670(0x216),_0x104ba0,_0x194670(0x25e)),loggerService_1[_0x194670(0x229)][_0x194670(0x209)](_0x194670(0x234),_0x194670(0x261),_0x194670(0x1e9),_0x5d4121);const _0xc619e2=await fetch(this[_0x194670(0x1ec)],{'method':_0x194670(0x1e9),'headers':{'Content-Type':_0x194670(0x1e7),'Accept':_0x194670(0x1e7),'User-Agent':_0x194670(0x1fd)},'body':JSON['stringify'](_0x5d4121)}),_0x44d99a=Date['now']()-_0x415511;console[_0x194670(0x249)](_0x194670(0x1fc)),console['log']('Status:',_0xc619e2[_0x194670(0x26f)]),console[_0x194670(0x249)](_0x194670(0x22c),_0xc619e2['statusText']),console[_0x194670(0x249)](_0x194670(0x26e),Object[_0x194670(0x233)](_0xc619e2['headers']['entries']())),console[_0x194670(0x249)](_0x194670(0x204),_0x44d99a+'ms');const _0x50364b=await _0xc619e2['text']();console[_0x194670(0x249)](_0x194670(0x22b),_0x50364b);if(!_0xc619e2['ok']){console[_0x194670(0x206)](_0x194670(0x23f)),console[_0x194670(0x206)]('HTTP\x20Status:',_0xc619e2['status']),console['error'](_0x194670(0x250),_0x50364b),loggerService_1[_0x194670(0x229)][_0x194670(0x22f)]('cointopay2','/create',_0xc619e2['status'],_0x50364b,_0x44d99a),loggerService_1[_0x194670(0x229)]['logWhiteDomainError'](_0x194670(0x234),'/create',_0x194670(0x246)+_0xc619e2['status']+':\x20'+_0x50364b);throw new Error(_0x194670(0x258)+_0xc619e2[_0x194670(0x26f)]+_0x194670(0x24c)+_0x50364b);}let _0x1dcac5;try{_0x1dcac5=JSON['parse'](_0x50364b);}catch(_0x32da54){console[_0x194670(0x206)](_0x194670(0x1f8),_0x32da54),loggerService_1[_0x194670(0x229)][_0x194670(0x238)]('cointopay2',_0x194670(0x261),_0x194670(0x266)+_0x32da54);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20'+_0x50364b);}console[_0x194670(0x249)](_0x194670(0x25b)),console['log'](_0x194670(0x212),JSON['stringify'](_0x1dcac5,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay2',_0x194670(0x261),_0xc619e2[_0x194670(0x26f)],_0x1dcac5,_0x44d99a);if(_0x1dcac5[_0x194670(0x206)]){const _0x53599f=_0x1dcac5[_0x194670(0x240)]||_0x1dcac5[_0x194670(0x206)]||_0x194670(0x237);console[_0x194670(0x206)](_0x194670(0x1fa)),console[_0x194670(0x206)](_0x194670(0x214),_0x53599f),loggerService_1[_0x194670(0x229)][_0x194670(0x238)](_0x194670(0x234),_0x194670(0x261),'Business\x20Error:\x20'+_0x53599f);throw new Error(_0x194670(0x217)+_0x53599f);}if(!_0x1dcac5[_0x194670(0x260)]||!_0x1dcac5[_0x194670(0x22d)]){console['error'](_0x194670(0x267)),console[_0x194670(0x206)](_0x194670(0x242)),console['error'](_0x194670(0x247),_0x1dcac5),loggerService_1[_0x194670(0x229)][_0x194670(0x238)](_0x194670(0x234),'/create',_0x194670(0x22a));throw new Error(_0x194670(0x213));}return console[_0x194670(0x249)](_0x194670(0x21f)),console[_0x194670(0x249)](_0x194670(0x1ee),_0x1dcac5[_0x194670(0x22d)]),console['log'](_0x194670(0x1fe),_0x1dcac5['payment_url']),console[_0x194670(0x249)](_0x194670(0x216),_0x104ba0,_0x194670(0x226)),{'gateway_payment_id':_0x1dcac5[_0x194670(0x22d)],'payment_url':_0x1dcac5[_0x194670(0x260)]};}catch(_0x3ce171){console[_0x194670(0x206)](_0x194670(0x254)),console['error'](_0x194670(0x1ea),_0x3ce171),loggerService_1[_0x194670(0x229)]['logWhiteDomainError'](_0x194670(0x234),_0x194670(0x261),_0x3ce171);if(_0x3ce171 instanceof Error){console['error'](_0x194670(0x21c),_0x3ce171[_0x194670(0x240)]),console[_0x194670(0x206)]('Error\x20stack:',_0x3ce171[_0x194670(0x205)]);throw new Error(_0x194670(0x248)+_0x3ce171[_0x194670(0x240)]);}throw new Error(_0x194670(0x207));}}async[a40_0x2a3200(0x271)](_0x29e92b){const _0x5ac294=a40_0x2a3200,_0x2db41e=Date[_0x5ac294(0x210)]();try{console['log'](_0x5ac294(0x231)+_0x29e92b);const _0x3e5414={'gatewayPaymentId':_0x29e92b};loggerService_1[_0x5ac294(0x229)][_0x5ac294(0x209)](_0x5ac294(0x234),_0x5ac294(0x23a),_0x5ac294(0x1e9),_0x3e5414);const _0x1d2700=await fetch(this[_0x5ac294(0x24d)],{'method':_0x5ac294(0x1e9),'headers':{'Content-Type':_0x5ac294(0x1e7),'Accept':'application/json','User-Agent':_0x5ac294(0x1fd)},'body':JSON[_0x5ac294(0x270)](_0x3e5414)}),_0x3043a3=Date[_0x5ac294(0x210)]()-_0x2db41e;console[_0x5ac294(0x249)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x5ac294(0x249)]('Status:',_0x1d2700[_0x5ac294(0x26f)]),console[_0x5ac294(0x249)](_0x5ac294(0x204),_0x3043a3+'ms');if(!_0x1d2700['ok']){const _0x5512f0=await _0x1d2700[_0x5ac294(0x1e8)]();console[_0x5ac294(0x206)](_0x5ac294(0x241),_0x1d2700[_0x5ac294(0x26f)]),console[_0x5ac294(0x206)](_0x5ac294(0x250),_0x5512f0),loggerService_1[_0x5ac294(0x229)][_0x5ac294(0x22f)]('cointopay2',_0x5ac294(0x23a),_0x1d2700[_0x5ac294(0x26f)],_0x5512f0,_0x3043a3),loggerService_1[_0x5ac294(0x229)][_0x5ac294(0x238)](_0x5ac294(0x234),_0x5ac294(0x23a),_0x5ac294(0x246)+_0x1d2700[_0x5ac294(0x26f)]+':\x20'+_0x5512f0);throw new Error(_0x5ac294(0x258)+_0x1d2700['status']);}const _0x31f609=await _0x1d2700[_0x5ac294(0x1e8)]();console[_0x5ac294(0x249)](_0x5ac294(0x22b),_0x31f609);let _0x54ad54;try{_0x54ad54=JSON['parse'](_0x31f609);}catch(_0x326d58){console['error'](_0x5ac294(0x1f8),_0x326d58),loggerService_1[_0x5ac294(0x229)][_0x5ac294(0x238)](_0x5ac294(0x234),_0x5ac294(0x23a),_0x5ac294(0x266)+_0x326d58);throw new Error(_0x5ac294(0x20e)+_0x31f609);}loggerService_1[_0x5ac294(0x229)]['logWhiteDomainResponse']('cointopay2',_0x5ac294(0x23a),_0x1d2700[_0x5ac294(0x26f)],_0x54ad54,_0x3043a3),console[_0x5ac294(0x249)](_0x5ac294(0x24f)),console['log'](_0x5ac294(0x24b),_0x54ad54[_0x5ac294(0x1e6)]),console[_0x5ac294(0x249)](_0x5ac294(0x1f2),_0x54ad54[_0x5ac294(0x222)]),console[_0x5ac294(0x249)](_0x5ac294(0x221),_0x54ad54[_0x5ac294(0x21d)]?.[_0x5ac294(0x264)]),console[_0x5ac294(0x249)]('Amount:',_0x54ad54[_0x5ac294(0x21d)]?.['Amount']),console[_0x5ac294(0x249)](_0x5ac294(0x23c),_0x54ad54[_0x5ac294(0x21d)]?.['inputCurrency']);if(_0x54ad54[_0x5ac294(0x1e6)]!==_0x5ac294(0x235)||_0x54ad54[_0x5ac294(0x222)]!==0xc8){const _0x95ed99=_0x54ad54[_0x5ac294(0x240)]||_0x5ac294(0x1f6);console[_0x5ac294(0x206)](_0x5ac294(0x1f0)),console['error'](_0x5ac294(0x214),_0x95ed99),loggerService_1['loggerService'][_0x5ac294(0x238)]('cointopay2',_0x5ac294(0x23a),_0x5ac294(0x256)+_0x95ed99);throw new Error(_0x5ac294(0x21a)+_0x95ed99);}if(!_0x54ad54[_0x5ac294(0x21d)]){console['error'](_0x5ac294(0x255)),console['error'](_0x5ac294(0x1f9)),loggerService_1[_0x5ac294(0x229)][_0x5ac294(0x238)](_0x5ac294(0x234),'/status',_0x5ac294(0x23d));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x38c0a2=_0x5ac294(0x20b);switch(_0x54ad54[_0x5ac294(0x21d)][_0x5ac294(0x264)]?.[_0x5ac294(0x25d)]()){case _0x5ac294(0x21b):_0x38c0a2=_0x5ac294(0x208);break;case _0x5ac294(0x1f1):case _0x5ac294(0x24e):case _0x5ac294(0x206):_0x38c0a2=_0x5ac294(0x26d);break;case _0x5ac294(0x20c):case'timeout':_0x38c0a2=_0x5ac294(0x25f);break;case _0x5ac294(0x1fb):case _0x5ac294(0x263):case'pending':case _0x5ac294(0x200):default:_0x38c0a2=_0x5ac294(0x20b);break;}let _0x5c6b1b,_0x5a781d;if(_0x54ad54[_0x5ac294(0x21d)][_0x5ac294(0x22e)]){const _0x2b4b3a=_0x54ad54[_0x5ac294(0x21d)][_0x5ac294(0x22e)];console[_0x5ac294(0x249)](_0x5ac294(0x243),_0x2b4b3a);const _0x98d92=_0x2b4b3a[_0x5ac294(0x253)](/IBAN\s+([A-Z0-9]+)/i);_0x98d92&&(_0x5c6b1b=_0x98d92[0x1],console[_0x5ac294(0x249)](_0x5ac294(0x1ed),_0x5c6b1b)),_0x5a781d=_0x2b4b3a;}const _0x3fa743={'iban':_0x5c6b1b,'bankDetails':_0x5a781d,'transactionId':_0x54ad54[_0x5ac294(0x21d)][_0x5ac294(0x252)],'coinAddress':_0x54ad54[_0x5ac294(0x21d)]['coinAddress'],'qrCodeUrl':_0x54ad54[_0x5ac294(0x21d)][_0x5ac294(0x245)],'expiryTime':_0x54ad54['data'][_0x5ac294(0x21e)],'createdOn':_0x54ad54['data'][_0x5ac294(0x227)],'confirmedOn':_0x54ad54[_0x5ac294(0x21d)][_0x5ac294(0x25c)]};console[_0x5ac294(0x249)](_0x5ac294(0x1eb)),console[_0x5ac294(0x249)](_0x5ac294(0x26b),_0x54ad54[_0x5ac294(0x21d)]['Status'],'->',_0x38c0a2),console[_0x5ac294(0x249)](_0x5ac294(0x216),_0x54ad54['data']['Amount'],_0x54ad54['data']['inputCurrency']),console['log'](_0x5ac294(0x1f4),_0x54ad54[_0x5ac294(0x21d)][_0x5ac294(0x252)]),console[_0x5ac294(0x249)]('IBAN:',_0x5c6b1b||_0x5ac294(0x223)),console[_0x5ac294(0x249)](_0x5ac294(0x219),_0x54ad54['data'][_0x5ac294(0x227)]),console['log'](_0x5ac294(0x211),_0x54ad54[_0x5ac294(0x21d)][_0x5ac294(0x25c)]||_0x5ac294(0x225));if(_0x54ad54[_0x5ac294(0x21d)]['Status']?.[_0x5ac294(0x25d)]()===_0x5ac294(0x263))console[_0x5ac294(0x249)](_0x5ac294(0x232));else _0x54ad54['data'][_0x5ac294(0x264)]?.[_0x5ac294(0x25d)]()===_0x5ac294(0x21b)&&console['log'](_0x5ac294(0x26c));return{'status':_0x38c0a2,'amount':parseFloat(_0x54ad54[_0x5ac294(0x21d)][_0x5ac294(0x236)])||undefined,'currency':_0x54ad54[_0x5ac294(0x21d)][_0x5ac294(0x201)]||'EUR','paymentDetails':_0x3fa743};}catch(_0x25a4b5){console[_0x5ac294(0x206)](_0x5ac294(0x23e),_0x25a4b5),loggerService_1[_0x5ac294(0x229)][_0x5ac294(0x238)](_0x5ac294(0x234),_0x5ac294(0x23a),_0x25a4b5);throw new Error('Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20'+(_0x25a4b5 instanceof Error?_0x25a4b5[_0x5ac294(0x240)]:'Unknown\x20error'));}}async[a40_0x2a3200(0x244)](_0x225be8){const _0x2044fd=a40_0x2a3200,_0x3dd392=await this[_0x2044fd(0x271)](_0x225be8);return{'status':_0x3dd392[_0x2044fd(0x26f)],'amount':_0x3dd392[_0x2044fd(0x257)],'currency':_0x3dd392['currency']};}async[a40_0x2a3200(0x251)](_0x33e734){const _0x2d30be=a40_0x2a3200;console['log'](_0x2d30be(0x218),_0x33e734);let _0x1168d6=_0x2d30be(0x20b);switch(_0x33e734['status']?.[_0x2d30be(0x25d)]()){case'paid':_0x1168d6=_0x2d30be(0x208);break;case _0x2d30be(0x1f1):case _0x2d30be(0x24e):case _0x2d30be(0x206):_0x1168d6=_0x2d30be(0x26d);break;case _0x2d30be(0x20c):case'timeout':_0x1168d6=_0x2d30be(0x25f);break;case'pending':case _0x2d30be(0x1fb):case _0x2d30be(0x263):case'created':default:_0x1168d6=_0x2d30be(0x20b);break;}return{'paymentId':_0x33e734[_0x2d30be(0x25a)]||_0x33e734[_0x2d30be(0x224)]||'','status':_0x1168d6,'amount':_0x33e734[_0x2d30be(0x257)],'currency':_0x33e734[_0x2d30be(0x20d)]||_0x2d30be(0x226)};}}function a40_0x31e3(_0x3e56ed,_0x4ca445){const _0xfba1e6=a40_0xfba1();return a40_0x31e3=function(_0x31e334,_0xb4cf67){_0x31e334=_0x31e334-0x1e6;let _0x506a8f=_0xfba1e6[_0x31e334];return _0x506a8f;},a40_0x31e3(_0x3e56ed,_0x4ca445);}function a40_0xfba1(){const _0x2a4a2b=['ExpiryTime','===\x20COINTOPAY2\x20SUCCESS\x20===','\x20EUR','Payment\x20Status:','status_code','not\x20found','merchant_reference_id','not\x20confirmed','EUR','CreatedOn','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','loggerService','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Raw\x20Response\x20Body:','Status\x20Text:','gateway_payment_id','PaymentDetail','logWhiteDomainResponse','🪙\x20Creating\x20CoinToPay2\x20payment:\x20','📊\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','fromEntries','cointopay2','success','Amount','Unknown\x20error\x20from\x20CoinToPay2\x20API','logWhiteDomainError','defineProperty','/status','361417CmVZay','Currency:','Incomplete\x20response:\x20missing\x20data','CoinToPay2\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY2\x20API\x20ERROR\x20===','message','HTTP\x20Status:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','🏦\x20Payment\x20Detail:','verifyPayment','QRCodeURL','HTTP\x20','Response\x20data:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','log','../loggerService','Result:',',\x20body:\x20','statusUrl','failed','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','Response\x20Body:','processWebhook','TransactionID','match','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status\x20API\x20Error:\x20','amount','HTTP\x20error!\x20status:\x20','CoinToPay2Service','order_id','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','TransactionConfirmedOn','toLowerCase','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','EXPIRED','payment_url','/create','10114218rOpeSV','awaiting\x20fiat','Status','42ayUVrP','JSON\x20Parse\x20Error:\x20','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','https://traffer.uk/gateway/cointopay/','__esModule','54607828yRoTQR','Status:','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','FAILED','Headers:','status','stringify','checkPaymentStatus','result','application/json','text','POST','Error\x20details:','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','apiUrl','🏦\x20Extracted\x20IBAN:','Gateway\x20Payment\x20ID:','20530fLwXOQ','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','cancelled','Status\x20Code:','🪙\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','Transaction\x20ID:','2PQkGKP','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','176rEYbgQ','Failed\x20to\x20parse\x20JSON\x20response:','Missing\x20data\x20in\x20response','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','waiting','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','Payment\x20URL:','Request\x20Body:','created','inputCurrency','14551680ZcuaST','1186662hwmpaV','Response\x20Time:','stack','error','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','PAID','logWhiteDomainRequest','195568TrrdOy','PENDING','expired','currency','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','1158kAenDG','now','Confirmed\x20On:','Parsed\x20Result:','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20Message:','https://traffer.uk/gateway/cointopay/status.php','Amount:','CoinToPay2\x20API\x20error:\x20','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Created\x20On:','CoinToPay2\x20status\x20API\x20error:\x20','paid','Error\x20message:','data'];a40_0xfba1=function(){return _0x2a4a2b;};return a40_0xfba1();}exports[a40_0x2a3200(0x259)]=CoinToPay2Service;