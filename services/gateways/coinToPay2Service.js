'use strict';const a40_0x4fd253=a40_0x5508;(function(_0x3a6e76,_0x579a49){const _0x3b0be8=a40_0x5508,_0x3793c5=_0x3a6e76();while(!![]){try{const _0x31ca6b=-parseInt(_0x3b0be8(0xdd))/0x1+-parseInt(_0x3b0be8(0xc5))/0x2+parseInt(_0x3b0be8(0x12f))/0x3*(parseInt(_0x3b0be8(0xdb))/0x4)+parseInt(_0x3b0be8(0xca))/0x5+parseInt(_0x3b0be8(0x100))/0x6*(-parseInt(_0x3b0be8(0xf6))/0x7)+parseInt(_0x3b0be8(0xc7))/0x8+-parseInt(_0x3b0be8(0x11f))/0x9;if(_0x31ca6b===_0x579a49)break;else _0x3793c5['push'](_0x3793c5['shift']());}catch(_0x1cc453){_0x3793c5['push'](_0x3793c5['shift']());}}}(a40_0x4854,0xb8366));Object[a40_0x4fd253(0x131)](exports,'__esModule',{'value':!![]}),exports[a40_0x4fd253(0xcb)]=void 0x0;const loggerService_1=require(a40_0x4fd253(0xb5));function a40_0x4854(){const _0xaaa0ae=['HTTP\x20error!\x20status:\x20','timeout','JSON\x20Parse\x20Error:\x20','status','expired','logWhiteDomainRequest','Currency:','IBAN:','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','payment_url','log','inputCurrency','URL:','parse','verifyPayment','4iJsvYY','Status\x20API\x20Error:\x20','114654EHhLbL','awaiting\x20fiat','Unknown\x20error','/create','stringify','headers','Status','Gateway\x20Payment\x20ID:','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','PAID','Status:','\x20EUR','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','POST','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Payment\x20URL:','HTTP\x20','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','loggerService','Request\x20Body:','apiUrl','message','EXPIRED','FAILED','8413503FtcFjZ','Response\x20Time:','coinAddress','Parsed\x20Result:','createPaymentLink','https://traffer.uk/gateway/cointopay/','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','Error\x20message:','Status\x20Text:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','6RjIfqQ','Incomplete\x20response:\x20missing\x20data','ExpiryTime','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','currency','order_id','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','===\x20COINTOPAY2\x20SUCCESS\x20===','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','stack','data','Unknown\x20error\x20from\x20CoinToPay2\x20API','paid','PENDING','gateway_payment_id','created','Response\x20data:','processWebhook','Error\x20details:','Raw\x20Response\x20Body:','TransactionConfirmedOn','logWhiteDomainResponse','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','Error\x20stack:','logWhiteDomainError','fromEntries','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','cointopay2','success','9940833qCABfK','amount','pending','üìä\x20Status\x20check\x20URL:','status_code','statusUrl','/status','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','merchant_reference_id','failed','waiting','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','üè¶\x20Extracted\x20IBAN:','application/json','checkPaymentStatus','Amount:','4204131hhIeUj','toLowerCase','defineProperty','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','TransactionID','entries','CoinToPay2\x20status\x20API\x20error:\x20','HTTP\x20Status:','Business\x20Error:\x20','Amount','===\x20COINTOPAY2\x20API\x20ERROR\x20===','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Created\x20On:','../loggerService','text','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','EUR','error','Missing\x20data\x20in\x20response','QRCodeURL','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','https://traffer.uk/gateway/cointopay/status.php','cancelled','Error\x20Message:','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','CreatedOn','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Result:','now','1021096tOMNNX','PaymentDetail','9965608EnKIOs','Response\x20Body:','Failed\x20to\x20parse\x20JSON\x20response:','5195620xZAjBu','CoinToPay2Service'];a40_0x4854=function(){return _0xaaa0ae;};return a40_0x4854();}function a40_0x5508(_0x475067,_0x2b427c){const _0x485447=a40_0x4854();return a40_0x5508=function(_0x5508fa,_0x299e44){_0x5508fa=_0x5508fa-0xb5;let _0x4f7359=_0x485447[_0x5508fa];return _0x4f7359;},a40_0x5508(_0x475067,_0x2b427c);}class CoinToPay2Service{constructor(){const _0x23aadb=a40_0x4fd253;this['apiUrl']=_0x23aadb(0xfb),this['statusUrl']=_0x23aadb(0xbd),console[_0x23aadb(0xd6)](_0x23aadb(0x11c)),console[_0x23aadb(0xd6)](_0x23aadb(0x122),this[_0x23aadb(0x124)]);}async[a40_0x4fd253(0xfa)](_0x14f8ae){const _0x5aa73f=a40_0x4fd253,{orderId:_0xedb6,amount:_0x4c6e48}=_0x14f8ae;console['log'](_0x5aa73f(0xfc)+_0x4c6e48+_0x5aa73f(0xe8));const _0x415b64={'amount':_0x4c6e48},_0x1fb930=Date[_0x5aa73f(0xc4)]();try{console[_0x5aa73f(0xd6)](_0x5aa73f(0xc0)),console[_0x5aa73f(0xd6)](_0x5aa73f(0xd8),this[_0x5aa73f(0xf2)]),console['log'](_0x5aa73f(0xf1),JSON[_0x5aa73f(0xe1)](_0x415b64,null,0x2)),console[_0x5aa73f(0xd6)](_0x5aa73f(0x12e),_0x4c6e48,_0x5aa73f(0xe9)),loggerService_1[_0x5aa73f(0xf0)][_0x5aa73f(0xd1)](_0x5aa73f(0x11d),'/create',_0x5aa73f(0xea),_0x415b64);const _0xd689c7=await fetch(this[_0x5aa73f(0xf2)],{'method':'POST','headers':{'Content-Type':_0x5aa73f(0x12c),'Accept':_0x5aa73f(0x12c),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x5aa73f(0xe1)](_0x415b64)}),_0x4343fc=Date[_0x5aa73f(0xc4)]()-_0x1fb930;console[_0x5aa73f(0xd6)](_0x5aa73f(0x126)),console[_0x5aa73f(0xd6)]('Status:',_0xd689c7[_0x5aa73f(0xcf)]),console[_0x5aa73f(0xd6)](_0x5aa73f(0xfe),_0xd689c7['statusText']),console[_0x5aa73f(0xd6)]('Headers:',Object[_0x5aa73f(0x11b)](_0xd689c7[_0x5aa73f(0xe2)][_0x5aa73f(0x134)]())),console[_0x5aa73f(0xd6)](_0x5aa73f(0xf7),_0x4343fc+'ms');const _0x52443a=await _0xd689c7[_0x5aa73f(0xb6)]();console[_0x5aa73f(0xd6)](_0x5aa73f(0x115),_0x52443a);if(!_0xd689c7['ok']){console[_0x5aa73f(0xb9)](_0x5aa73f(0x139)),console[_0x5aa73f(0xb9)](_0x5aa73f(0x136),_0xd689c7[_0x5aa73f(0xcf)]),console[_0x5aa73f(0xb9)](_0x5aa73f(0xc8),_0x52443a),loggerService_1['loggerService'][_0x5aa73f(0x117)]('cointopay2',_0x5aa73f(0xe0),_0xd689c7[_0x5aa73f(0xcf)],_0x52443a,_0x4343fc),loggerService_1['loggerService'][_0x5aa73f(0x11a)](_0x5aa73f(0x11d),'/create',_0x5aa73f(0xed)+_0xd689c7[_0x5aa73f(0xcf)]+':\x20'+_0x52443a);throw new Error(_0x5aa73f(0xcc)+_0xd689c7['status']+',\x20body:\x20'+_0x52443a);}let _0x470694;try{_0x470694=JSON[_0x5aa73f(0xd9)](_0x52443a);}catch(_0x2dbc4b){console[_0x5aa73f(0xb9)](_0x5aa73f(0xc9),_0x2dbc4b),loggerService_1[_0x5aa73f(0xf0)]['logWhiteDomainError'](_0x5aa73f(0x11d),_0x5aa73f(0xe0),_0x5aa73f(0xce)+_0x2dbc4b);throw new Error(_0x5aa73f(0xbc)+_0x52443a);}console[_0x5aa73f(0xd6)](_0x5aa73f(0xff)),console[_0x5aa73f(0xd6)](_0x5aa73f(0xf9),JSON[_0x5aa73f(0xe1)](_0x470694,null,0x2)),loggerService_1[_0x5aa73f(0xf0)]['logWhiteDomainResponse'](_0x5aa73f(0x11d),_0x5aa73f(0xe0),_0xd689c7[_0x5aa73f(0xcf)],_0x470694,_0x4343fc);if(_0x470694[_0x5aa73f(0xb9)]){const _0x297e27=_0x470694['message']||_0x470694[_0x5aa73f(0xb9)]||_0x5aa73f(0x10d);console[_0x5aa73f(0xb9)](_0x5aa73f(0x118)),console[_0x5aa73f(0xb9)](_0x5aa73f(0xbf),_0x297e27),loggerService_1[_0x5aa73f(0xf0)][_0x5aa73f(0x11a)](_0x5aa73f(0x11d),'/create',_0x5aa73f(0x137)+_0x297e27);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x297e27);}if(!_0x470694[_0x5aa73f(0xd5)]||!_0x470694[_0x5aa73f(0x110)]){console[_0x5aa73f(0xb9)](_0x5aa73f(0xee)),console[_0x5aa73f(0xb9)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x5aa73f(0xb9)](_0x5aa73f(0x112),_0x470694),loggerService_1[_0x5aa73f(0xf0)][_0x5aa73f(0x11a)](_0x5aa73f(0x11d),_0x5aa73f(0xe0),_0x5aa73f(0xb7));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x5aa73f(0xd6)](_0x5aa73f(0x109)),console[_0x5aa73f(0xd6)](_0x5aa73f(0xe4),_0x470694[_0x5aa73f(0x110)]),console[_0x5aa73f(0xd6)](_0x5aa73f(0xec),_0x470694[_0x5aa73f(0xd5)]),console['log'](_0x5aa73f(0x12e),_0x4c6e48,_0x5aa73f(0xb8)),{'gateway_payment_id':_0x470694[_0x5aa73f(0x110)],'payment_url':_0x470694[_0x5aa73f(0xd5)]};}catch(_0x4b6274){console[_0x5aa73f(0xb9)](_0x5aa73f(0xef)),console[_0x5aa73f(0xb9)](_0x5aa73f(0x114),_0x4b6274),loggerService_1['loggerService'][_0x5aa73f(0x11a)](_0x5aa73f(0x11d),_0x5aa73f(0xe0),_0x4b6274);if(_0x4b6274 instanceof Error){console[_0x5aa73f(0xb9)](_0x5aa73f(0xfd),_0x4b6274[_0x5aa73f(0xf3)]),console[_0x5aa73f(0xb9)](_0x5aa73f(0x119),_0x4b6274[_0x5aa73f(0x10b)]);throw new Error(_0x5aa73f(0x108)+_0x4b6274[_0x5aa73f(0xf3)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x4fd253(0x12d)](_0x402ae0){const _0x225aa8=a40_0x4fd253,_0xea2d=Date['now']();try{console[_0x225aa8(0xd6)](_0x225aa8(0x13a)+_0x402ae0);const _0x43552e={'gatewayPaymentId':_0x402ae0};loggerService_1[_0x225aa8(0xf0)][_0x225aa8(0xd1)]('cointopay2',_0x225aa8(0x125),_0x225aa8(0xea),_0x43552e);const _0x2fcbfd=await fetch(this['statusUrl'],{'method':_0x225aa8(0xea),'headers':{'Content-Type':_0x225aa8(0x12c),'Accept':'application/json','User-Agent':_0x225aa8(0x105)},'body':JSON['stringify'](_0x43552e)}),_0x36fa2b=Date[_0x225aa8(0xc4)]()-_0xea2d;console[_0x225aa8(0xd6)](_0x225aa8(0x10a)),console[_0x225aa8(0xd6)](_0x225aa8(0xe7),_0x2fcbfd[_0x225aa8(0xcf)]),console[_0x225aa8(0xd6)]('Response\x20Time:',_0x36fa2b+'ms');if(!_0x2fcbfd['ok']){const _0x5c682d=await _0x2fcbfd[_0x225aa8(0xb6)]();console[_0x225aa8(0xb9)]('HTTP\x20Status:',_0x2fcbfd[_0x225aa8(0xcf)]),console[_0x225aa8(0xb9)]('Response\x20Body:',_0x5c682d),loggerService_1[_0x225aa8(0xf0)][_0x225aa8(0x117)]('cointopay2',_0x225aa8(0x125),_0x2fcbfd['status'],_0x5c682d,_0x36fa2b),loggerService_1[_0x225aa8(0xf0)][_0x225aa8(0x11a)](_0x225aa8(0x11d),_0x225aa8(0x125),_0x225aa8(0xed)+_0x2fcbfd[_0x225aa8(0xcf)]+':\x20'+_0x5c682d);throw new Error(_0x225aa8(0xcc)+_0x2fcbfd[_0x225aa8(0xcf)]);}const _0x497c89=await _0x2fcbfd[_0x225aa8(0xb6)]();console[_0x225aa8(0xd6)](_0x225aa8(0x115),_0x497c89);let _0x56a915;try{_0x56a915=JSON[_0x225aa8(0xd9)](_0x497c89);}catch(_0x3f5ee7){console[_0x225aa8(0xb9)](_0x225aa8(0xc9),_0x3f5ee7),loggerService_1[_0x225aa8(0xf0)][_0x225aa8(0x11a)]('cointopay2',_0x225aa8(0x125),_0x225aa8(0xce)+_0x3f5ee7);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'+_0x497c89);}loggerService_1[_0x225aa8(0xf0)][_0x225aa8(0x117)](_0x225aa8(0x11d),'/status',_0x2fcbfd[_0x225aa8(0xcf)],_0x56a915,_0x36fa2b),console[_0x225aa8(0xd6)]('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console[_0x225aa8(0xd6)](_0x225aa8(0xc3),_0x56a915['result']),console[_0x225aa8(0xd6)]('Status\x20Code:',_0x56a915[_0x225aa8(0x123)]),console[_0x225aa8(0xd6)]('Payment\x20Status:',_0x56a915[_0x225aa8(0x10c)]?.[_0x225aa8(0xe3)]),console[_0x225aa8(0xd6)]('Amount:',_0x56a915['data']?.[_0x225aa8(0x138)]),console[_0x225aa8(0xd6)](_0x225aa8(0xd2),_0x56a915[_0x225aa8(0x10c)]?.[_0x225aa8(0xd7)]);if(_0x56a915['result']!==_0x225aa8(0x11e)||_0x56a915[_0x225aa8(0x123)]!==0xc8){const _0x3dbc9d=_0x56a915['message']||_0x225aa8(0x103);console['error'](_0x225aa8(0x132)),console[_0x225aa8(0xb9)](_0x225aa8(0xbf),_0x3dbc9d),loggerService_1[_0x225aa8(0xf0)][_0x225aa8(0x11a)](_0x225aa8(0x11d),'/status',_0x225aa8(0xdc)+_0x3dbc9d);throw new Error(_0x225aa8(0x135)+_0x3dbc9d);}if(!_0x56a915[_0x225aa8(0x10c)]){console[_0x225aa8(0xb9)](_0x225aa8(0xd4)),console[_0x225aa8(0xb9)](_0x225aa8(0xba)),loggerService_1[_0x225aa8(0xf0)][_0x225aa8(0x11a)](_0x225aa8(0x11d),_0x225aa8(0x125),_0x225aa8(0x101));throw new Error(_0x225aa8(0x12a));}let _0x1d903e=_0x225aa8(0x10f);switch(_0x56a915[_0x225aa8(0x10c)][_0x225aa8(0xe3)]?.[_0x225aa8(0x130)]()){case _0x225aa8(0x10e):_0x1d903e=_0x225aa8(0xe6);break;case _0x225aa8(0xbe):case _0x225aa8(0x128):case'error':_0x1d903e=_0x225aa8(0xf5);break;case _0x225aa8(0xd0):case _0x225aa8(0xcd):_0x1d903e=_0x225aa8(0xf4);break;case _0x225aa8(0x129):case _0x225aa8(0xde):case _0x225aa8(0x121):case _0x225aa8(0x111):default:_0x1d903e='PENDING';break;}let _0x1e8e97,_0x54e435;if(_0x56a915[_0x225aa8(0x10c)][_0x225aa8(0xc6)]){const _0x5f42f2=_0x56a915[_0x225aa8(0x10c)][_0x225aa8(0xc6)];console[_0x225aa8(0xd6)]('üè¶\x20Payment\x20Detail:',_0x5f42f2);const _0x589e70=_0x5f42f2['match'](/IBAN\s+([A-Z0-9]+)/i);_0x589e70&&(_0x1e8e97=_0x589e70[0x1],console[_0x225aa8(0xd6)](_0x225aa8(0x12b),_0x1e8e97)),_0x54e435=_0x5f42f2;}const _0x2e9541={'iban':_0x1e8e97,'bankDetails':_0x54e435,'transactionId':_0x56a915[_0x225aa8(0x10c)][_0x225aa8(0x133)],'coinAddress':_0x56a915[_0x225aa8(0x10c)][_0x225aa8(0xf8)],'qrCodeUrl':_0x56a915[_0x225aa8(0x10c)][_0x225aa8(0xbb)],'expiryTime':_0x56a915[_0x225aa8(0x10c)][_0x225aa8(0x102)],'createdOn':_0x56a915[_0x225aa8(0x10c)][_0x225aa8(0xc1)],'confirmedOn':_0x56a915[_0x225aa8(0x10c)][_0x225aa8(0x116)]};console[_0x225aa8(0xd6)](_0x225aa8(0x104)),console[_0x225aa8(0xd6)](_0x225aa8(0xe7),_0x56a915['data'][_0x225aa8(0xe3)],'->',_0x1d903e),console[_0x225aa8(0xd6)]('Amount:',_0x56a915[_0x225aa8(0x10c)]['Amount'],_0x56a915['data'][_0x225aa8(0xd7)]),console[_0x225aa8(0xd6)]('Transaction\x20ID:',_0x56a915[_0x225aa8(0x10c)][_0x225aa8(0x133)]),console[_0x225aa8(0xd6)](_0x225aa8(0xd3),_0x1e8e97||'not\x20found'),console[_0x225aa8(0xd6)](_0x225aa8(0x13b),_0x56a915['data'][_0x225aa8(0xc1)]),console[_0x225aa8(0xd6)]('Confirmed\x20On:',_0x56a915[_0x225aa8(0x10c)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x56a915['data']['Status']?.['toLowerCase']()===_0x225aa8(0xde))console['log'](_0x225aa8(0xeb));else _0x56a915['data'][_0x225aa8(0xe3)]?.[_0x225aa8(0x130)]()==='paid'&&console[_0x225aa8(0xd6)](_0x225aa8(0xc2));return{'status':_0x1d903e,'amount':parseFloat(_0x56a915[_0x225aa8(0x10c)][_0x225aa8(0x138)])||undefined,'currency':_0x56a915['data']['inputCurrency']||_0x225aa8(0xb8),'paymentDetails':_0x2e9541};}catch(_0xba4010){console[_0x225aa8(0xb9)]('CoinToPay2\x20payment\x20status\x20check\x20error:',_0xba4010),loggerService_1[_0x225aa8(0xf0)][_0x225aa8(0x11a)]('cointopay2',_0x225aa8(0x125),_0xba4010);throw new Error('Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20'+(_0xba4010 instanceof Error?_0xba4010[_0x225aa8(0xf3)]:_0x225aa8(0xdf)));}}async[a40_0x4fd253(0xda)](_0x25d33b){const _0xa2be3e=a40_0x4fd253,_0x3f2f96=await this[_0xa2be3e(0x12d)](_0x25d33b);return{'status':_0x3f2f96[_0xa2be3e(0xcf)],'amount':_0x3f2f96['amount'],'currency':_0x3f2f96['currency']};}async[a40_0x4fd253(0x113)](_0x224cef){const _0x27f9c1=a40_0x4fd253;console['log'](_0x27f9c1(0xe5),_0x224cef);let _0x5587f3='PENDING';switch(_0x224cef['status']?.[_0x27f9c1(0x130)]()){case _0x27f9c1(0x10e):_0x5587f3=_0x27f9c1(0xe6);break;case _0x27f9c1(0xbe):case _0x27f9c1(0x128):case'error':_0x5587f3=_0x27f9c1(0xf5);break;case _0x27f9c1(0xd0):case'timeout':_0x5587f3=_0x27f9c1(0xf4);break;case _0x27f9c1(0x121):case _0x27f9c1(0x129):case'awaiting\x20fiat':case'created':default:_0x5587f3=_0x27f9c1(0x10f);break;}return{'paymentId':_0x224cef[_0x27f9c1(0x107)]||_0x224cef[_0x27f9c1(0x127)]||'','status':_0x5587f3,'amount':_0x224cef[_0x27f9c1(0x120)],'currency':_0x224cef[_0x27f9c1(0x106)]||_0x27f9c1(0xb8)};}}exports[a40_0x4fd253(0xcb)]=CoinToPay2Service;