'use strict';const a48_0x3ab585=a48_0xa9b5;(function(_0x4a6b86,_0x6806ae){const _0x582a27=a48_0xa9b5,_0x4bcb0e=_0x4a6b86();while(!![]){try{const _0x5d9fd5=-parseInt(_0x582a27(0x18d))/0x1+-parseInt(_0x582a27(0x16e))/0x2*(-parseInt(_0x582a27(0x15d))/0x3)+-parseInt(_0x582a27(0x16b))/0x4*(-parseInt(_0x582a27(0x17c))/0x5)+parseInt(_0x582a27(0x1c4))/0x6*(-parseInt(_0x582a27(0x14f))/0x7)+-parseInt(_0x582a27(0x146))/0x8*(-parseInt(_0x582a27(0x149))/0x9)+-parseInt(_0x582a27(0x18b))/0xa*(parseInt(_0x582a27(0x17b))/0xb)+parseInt(_0x582a27(0x184))/0xc;if(_0x5d9fd5===_0x6806ae)break;else _0x4bcb0e['push'](_0x4bcb0e['shift']());}catch(_0x43587b){_0x4bcb0e['push'](_0x4bcb0e['shift']());}}}(a48_0x4ba5,0x2f197));Object[a48_0x3ab585(0x1c5)](exports,a48_0x3ab585(0x1aa),{'value':!![]}),exports[a48_0x3ab585(0x168)]=void 0x0;const loggerService_1=require(a48_0x3ab585(0x14d));class CoinToPay2Service{constructor(){const _0x4d6ba2=a48_0x3ab585;this['apiUrl']=_0x4d6ba2(0x17d),this[_0x4d6ba2(0x1c2)]=_0x4d6ba2(0x19e),console['log']('🪙\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0x4d6ba2(0x152)](_0x4d6ba2(0x1ab),this[_0x4d6ba2(0x1c2)]);}async[a48_0x3ab585(0x179)](_0x10f60d){const _0x55bead=a48_0x3ab585,{orderId:_0x2716b0,amount:_0x483b03}=_0x10f60d;console['log'](_0x55bead(0x1bb)+_0x483b03+_0x55bead(0x196));const _0x5890f7={'amount':_0x483b03},_0x42ea84=Date[_0x55bead(0x1a1)]();try{console['log'](_0x55bead(0x1ac)),console['log'](_0x55bead(0x18c),this['apiUrl']),console[_0x55bead(0x152)](_0x55bead(0x167),JSON[_0x55bead(0x189)](_0x5890f7,null,0x2)),console[_0x55bead(0x152)](_0x55bead(0x159),_0x483b03,'EUR\x20(always\x20EUR\x20for\x20CoinToPay2)'),loggerService_1[_0x55bead(0x169)]['logWhiteDomainRequest']('cointopay2',_0x55bead(0x15f),'POST',_0x5890f7);const _0x2e88de=await fetch(this[_0x55bead(0x190)],{'method':'POST','headers':{'Content-Type':_0x55bead(0x1a6),'Accept':_0x55bead(0x1a6),'User-Agent':_0x55bead(0x198)},'body':JSON[_0x55bead(0x189)](_0x5890f7)}),_0x2c99ff=Date[_0x55bead(0x1a1)]()-_0x42ea84;console[_0x55bead(0x152)]('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console[_0x55bead(0x152)](_0x55bead(0x183),_0x2e88de['status']),console[_0x55bead(0x152)]('Status\x20Text:',_0x2e88de[_0x55bead(0x182)]),console[_0x55bead(0x152)]('Headers:',Object[_0x55bead(0x19f)](_0x2e88de[_0x55bead(0x148)][_0x55bead(0x1a5)]())),console[_0x55bead(0x152)](_0x55bead(0x1c6),_0x2c99ff+'ms');const _0x1a1444=await _0x2e88de[_0x55bead(0x157)]();console[_0x55bead(0x152)](_0x55bead(0x193),_0x1a1444);if(!_0x2e88de['ok']){console[_0x55bead(0x1ba)](_0x55bead(0x16f)),console[_0x55bead(0x1ba)]('HTTP\x20Status:',_0x2e88de[_0x55bead(0x18a)]),console[_0x55bead(0x1ba)]('Response\x20Body:',_0x1a1444),loggerService_1['loggerService'][_0x55bead(0x155)](_0x55bead(0x187),_0x55bead(0x15f),_0x2e88de['status'],_0x1a1444,_0x2c99ff),loggerService_1['loggerService'][_0x55bead(0x1b3)](_0x55bead(0x187),'/create','HTTP\x20'+_0x2e88de[_0x55bead(0x18a)]+':\x20'+_0x1a1444);throw new Error(_0x55bead(0x191)+_0x2e88de[_0x55bead(0x18a)]+_0x55bead(0x156)+_0x1a1444);}let _0x16fd55;try{_0x16fd55=JSON[_0x55bead(0x1b7)](_0x1a1444);}catch(_0x3ed59b){console['error'](_0x55bead(0x1a4),_0x3ed59b),loggerService_1[_0x55bead(0x169)][_0x55bead(0x1b3)](_0x55bead(0x187),'/create',_0x55bead(0x15b)+_0x3ed59b);throw new Error(_0x55bead(0x19d)+_0x1a1444);}console['log']('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console[_0x55bead(0x152)]('Parsed\x20Result:',JSON[_0x55bead(0x189)](_0x16fd55,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x55bead(0x187),_0x55bead(0x15f),_0x2e88de[_0x55bead(0x18a)],_0x16fd55,_0x2c99ff);if(_0x16fd55[_0x55bead(0x1ba)]){const _0x1ca5d5=_0x16fd55['message']||_0x16fd55[_0x55bead(0x1ba)]||_0x55bead(0x19a);console[_0x55bead(0x1ba)](_0x55bead(0x17f)),console[_0x55bead(0x1ba)](_0x55bead(0x1b8),_0x1ca5d5),loggerService_1['loggerService'][_0x55bead(0x1b3)](_0x55bead(0x187),_0x55bead(0x15f),_0x55bead(0x1a3)+_0x1ca5d5);throw new Error(_0x55bead(0x1c7)+_0x1ca5d5);}if(!_0x16fd55[_0x55bead(0x15e)]||!_0x16fd55['gateway_payment_id']){console[_0x55bead(0x1ba)](_0x55bead(0x1cb)),console[_0x55bead(0x1ba)](_0x55bead(0x1bf)),console['error'](_0x55bead(0x1c9),_0x16fd55),loggerService_1[_0x55bead(0x169)]['logWhiteDomainError']('cointopay2','/create',_0x55bead(0x197));throw new Error(_0x55bead(0x14e));}console[_0x55bead(0x152)](_0x55bead(0x172)),console[_0x55bead(0x152)](_0x55bead(0x178),_0x16fd55[_0x55bead(0x175)]),console[_0x55bead(0x152)]('Payment\x20URL\x20(original):',_0x16fd55[_0x55bead(0x15e)]);const _0x2af3c4=_0x16fd55['payment_url']+_0x55bead(0x162);return console[_0x55bead(0x152)]('Payment\x20URL\x20(modified):',_0x2af3c4),console['log']('Amount:',_0x483b03,_0x55bead(0x15c)),{'gateway_payment_id':_0x16fd55[_0x55bead(0x175)],'payment_url':_0x2af3c4};}catch(_0x36a6eb){console['error'](_0x55bead(0x1c0)),console['error']('Error\x20details:',_0x36a6eb),loggerService_1['loggerService'][_0x55bead(0x1b3)](_0x55bead(0x187),_0x55bead(0x15f),_0x36a6eb);if(_0x36a6eb instanceof Error){console[_0x55bead(0x1ba)](_0x55bead(0x1b4),_0x36a6eb[_0x55bead(0x171)]),console['error'](_0x55bead(0x158),_0x36a6eb[_0x55bead(0x16d)]);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x36a6eb[_0x55bead(0x171)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a48_0x3ab585(0x1af)](_0x2deabf){const _0x234f84=a48_0x3ab585,_0x2a6158=Date[_0x234f84(0x1a1)]();try{console[_0x234f84(0x152)]('📊\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0x2deabf);const _0x4632e2={'gatewayPaymentId':_0x2deabf};loggerService_1[_0x234f84(0x169)][_0x234f84(0x176)](_0x234f84(0x187),_0x234f84(0x185),_0x234f84(0x18f),_0x4632e2);const _0x2133d8=await fetch(this[_0x234f84(0x1c2)],{'method':'POST','headers':{'Content-Type':_0x234f84(0x1a6),'Accept':_0x234f84(0x1a6),'User-Agent':_0x234f84(0x198)},'body':JSON[_0x234f84(0x189)](_0x4632e2)}),_0x31b850=Date['now']()-_0x2a6158;console[_0x234f84(0x152)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x234f84(0x152)](_0x234f84(0x183),_0x2133d8[_0x234f84(0x18a)]),console[_0x234f84(0x152)](_0x234f84(0x1c6),_0x31b850+'ms');if(!_0x2133d8['ok']){const _0x2adc9a=await _0x2133d8[_0x234f84(0x157)]();console[_0x234f84(0x1ba)](_0x234f84(0x199),_0x2133d8[_0x234f84(0x18a)]),console[_0x234f84(0x1ba)]('Response\x20Body:',_0x2adc9a),loggerService_1[_0x234f84(0x169)][_0x234f84(0x155)](_0x234f84(0x187),_0x234f84(0x185),_0x2133d8['status'],_0x2adc9a,_0x31b850),loggerService_1[_0x234f84(0x169)][_0x234f84(0x1b3)](_0x234f84(0x187),'/status',_0x234f84(0x14c)+_0x2133d8[_0x234f84(0x18a)]+':\x20'+_0x2adc9a);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2133d8[_0x234f84(0x18a)]);}const _0x57fb1f=await _0x2133d8['text']();console['log'](_0x234f84(0x193),_0x57fb1f);let _0x36a6d3;try{_0x36a6d3=JSON['parse'](_0x57fb1f);}catch(_0x4d92df){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x4d92df),loggerService_1[_0x234f84(0x169)]['logWhiteDomainError'](_0x234f84(0x187),_0x234f84(0x185),_0x234f84(0x15b)+_0x4d92df);throw new Error(_0x234f84(0x1b9)+_0x57fb1f);}loggerService_1[_0x234f84(0x169)]['logWhiteDomainResponse'](_0x234f84(0x187),_0x234f84(0x185),_0x2133d8['status'],_0x36a6d3,_0x31b850),console['log'](_0x234f84(0x161)),console[_0x234f84(0x152)](_0x234f84(0x174),_0x36a6d3[_0x234f84(0x1b2)]),console['log'](_0x234f84(0x1a7),_0x36a6d3[_0x234f84(0x186)]),console[_0x234f84(0x152)]('Payment\x20Status:',_0x36a6d3[_0x234f84(0x18e)]?.[_0x234f84(0x1b6)]),console['log']('Amount:',_0x36a6d3[_0x234f84(0x18e)]?.[_0x234f84(0x1cc)]),console[_0x234f84(0x152)](_0x234f84(0x1a8),_0x36a6d3['data']?.[_0x234f84(0x1c1)]);if(_0x36a6d3['result']!==_0x234f84(0x1be)||_0x36a6d3[_0x234f84(0x186)]!==0xc8){const _0xd083a9=_0x36a6d3['message']||_0x234f84(0x153);console['error']('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console[_0x234f84(0x1ba)]('Error\x20Message:',_0xd083a9),loggerService_1[_0x234f84(0x169)][_0x234f84(0x1b3)](_0x234f84(0x187),_0x234f84(0x185),_0x234f84(0x195)+_0xd083a9);throw new Error(_0x234f84(0x16c)+_0xd083a9);}if(!_0x36a6d3['data']){console[_0x234f84(0x1ba)](_0x234f84(0x1c3)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x234f84(0x169)][_0x234f84(0x1b3)](_0x234f84(0x187),_0x234f84(0x185),'Incomplete\x20response:\x20missing\x20data');throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x58d19e=_0x234f84(0x16a);switch(_0x36a6d3['data'][_0x234f84(0x1b6)]?.['toLowerCase']()){case _0x234f84(0x164):_0x58d19e='PAID';break;case _0x234f84(0x1ad):case'failed':case _0x234f84(0x1ba):_0x58d19e='FAILED';break;case _0x234f84(0x188):case _0x234f84(0x19b):_0x58d19e=_0x234f84(0x1a2);break;case _0x234f84(0x160):case _0x234f84(0x1a9):case'pending':case _0x234f84(0x1a0):default:_0x58d19e=_0x234f84(0x16a);break;}let _0x5307f7,_0x22d84a;if(_0x36a6d3[_0x234f84(0x18e)][_0x234f84(0x150)]){const _0xd6ef1c=_0x36a6d3[_0x234f84(0x18e)][_0x234f84(0x150)];console[_0x234f84(0x152)](_0x234f84(0x166),_0xd6ef1c);const _0x567c57=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x200f73 of _0x567c57){const _0x3ceeb9=_0xd6ef1c[_0x234f84(0x1ae)](_0x200f73);if(_0x3ceeb9){_0x5307f7=_0x3ceeb9[0x1],console[_0x234f84(0x152)](_0x234f84(0x181),_0x5307f7,'using\x20pattern:',_0x200f73['source']);break;}}if(!_0x5307f7){console[_0x234f84(0x152)](_0x234f84(0x180));const _0x2ebd92=_0xd6ef1c['match'](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x2ebd92&&(_0x5307f7=_0x2ebd92[0x1],console['log'](_0x234f84(0x1b1),_0x5307f7));}_0x22d84a=_0xd6ef1c;}const _0x25a1ba={'iban':_0x5307f7,'bankDetails':_0x22d84a,'transactionId':_0x36a6d3['data'][_0x234f84(0x147)],'coinAddress':_0x36a6d3['data'][_0x234f84(0x1bd)],'qrCodeUrl':_0x36a6d3[_0x234f84(0x18e)][_0x234f84(0x15a)],'expiryTime':_0x36a6d3[_0x234f84(0x18e)][_0x234f84(0x14a)],'createdOn':_0x36a6d3[_0x234f84(0x18e)][_0x234f84(0x1ca)],'confirmedOn':_0x36a6d3[_0x234f84(0x18e)][_0x234f84(0x194)]};console['log']('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console[_0x234f84(0x152)](_0x234f84(0x183),_0x36a6d3[_0x234f84(0x18e)][_0x234f84(0x1b6)],'->',_0x58d19e),console[_0x234f84(0x152)]('Amount:',_0x36a6d3[_0x234f84(0x18e)][_0x234f84(0x1cc)],_0x36a6d3[_0x234f84(0x18e)]['inputCurrency']),console[_0x234f84(0x152)]('Transaction\x20ID:',_0x36a6d3[_0x234f84(0x18e)][_0x234f84(0x147)]),console[_0x234f84(0x152)](_0x234f84(0x19c),_0x5307f7||_0x234f84(0x17a)),console['log'](_0x234f84(0x1c8),_0x36a6d3['data'][_0x234f84(0x1ca)]),console[_0x234f84(0x152)]('Confirmed\x20On:',_0x36a6d3[_0x234f84(0x18e)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x36a6d3[_0x234f84(0x18e)][_0x234f84(0x1b6)]?.[_0x234f84(0x14b)]()===_0x234f84(0x1a9))console[_0x234f84(0x152)](_0x234f84(0x173));else _0x36a6d3[_0x234f84(0x18e)][_0x234f84(0x1b6)]?.[_0x234f84(0x14b)]()===_0x234f84(0x164)&&console[_0x234f84(0x152)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x58d19e,'amount':parseFloat(_0x36a6d3[_0x234f84(0x18e)]['Amount'])||undefined,'currency':_0x36a6d3[_0x234f84(0x18e)]['inputCurrency']||'EUR','paymentDetails':_0x25a1ba};}catch(_0x498ce8){console[_0x234f84(0x1ba)]('CoinToPay2\x20payment\x20status\x20check\x20error:',_0x498ce8),loggerService_1[_0x234f84(0x169)][_0x234f84(0x1b3)](_0x234f84(0x187),_0x234f84(0x185),_0x498ce8);throw new Error('Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20'+(_0x498ce8 instanceof Error?_0x498ce8['message']:_0x234f84(0x192)));}}async[a48_0x3ab585(0x163)](_0x5db868){const _0x5d811c=a48_0x3ab585,_0x1b6759=await this['checkPaymentStatus'](_0x5db868);return{'status':_0x1b6759['status'],'amount':_0x1b6759[_0x5d811c(0x151)],'currency':_0x1b6759[_0x5d811c(0x177)]};}async['processWebhook'](_0xa6fef7){const _0x364f05=a48_0x3ab585;console[_0x364f05(0x152)](_0x364f05(0x17e),_0xa6fef7);let _0x221d13=_0x364f05(0x16a);switch(_0xa6fef7[_0x364f05(0x18a)]?.[_0x364f05(0x14b)]()){case _0x364f05(0x164):_0x221d13=_0x364f05(0x1bc);break;case'cancelled':case _0x364f05(0x1b5):case _0x364f05(0x1ba):_0x221d13=_0x364f05(0x170);break;case'expired':case _0x364f05(0x19b):_0x221d13=_0x364f05(0x1a2);break;case _0x364f05(0x165):case _0x364f05(0x160):case _0x364f05(0x1a9):case _0x364f05(0x1a0):default:_0x221d13=_0x364f05(0x16a);break;}return{'paymentId':_0xa6fef7[_0x364f05(0x154)]||_0xa6fef7[_0x364f05(0x1b0)]||'','status':_0x221d13,'amount':_0xa6fef7['amount'],'currency':_0xa6fef7['currency']||_0x364f05(0x15c)};}}exports['CoinToPay2Service']=CoinToPay2Service;function a48_0xa9b5(_0x427d9a,_0x862089){const _0x4ba5ba=a48_0x4ba5();return a48_0xa9b5=function(_0xa9b55c,_0x17c46f){_0xa9b55c=_0xa9b55c-0x146;let _0x236f01=_0x4ba5ba[_0xa9b55c];return _0x236f01;},a48_0xa9b5(_0x427d9a,_0x862089);}function a48_0x4ba5(){const _0x1df2af=['/status','status_code','cointopay2','expired','stringify','status','728870idJjzW','URL:','206232TIUeqO','data','POST','apiUrl','HTTP\x20error!\x20status:\x20','Unknown\x20error','Raw\x20Response\x20Body:','TransactionConfirmedOn','Status\x20API\x20Error:\x20','\x20EUR','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Payment\x20System/1.0\x20(CoinToPay2)','HTTP\x20Status:','Unknown\x20error\x20from\x20CoinToPay2\x20API','timeout','IBAN:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','https://traffer.uk/gateway/cointopay/status.php','fromEntries','created','now','EXPIRED','Business\x20Error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','entries','application/json','Status\x20Code:','Currency:','awaiting\x20fiat','__esModule','📊\x20Status\x20check\x20URL:','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','cancelled','match','checkPaymentStatus','merchant_reference_id','🏦\x20Extracted\x20IBAN\x20via\x20fallback:','result','logWhiteDomainError','Error\x20message:','failed','Status','parse','Error\x20Message:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','error','🪙\x20Creating\x20CoinToPay2\x20payment:\x20','PAID','coinAddress','success','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','inputCurrency','statusUrl','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','6426FAcOZL','defineProperty','Response\x20Time:','CoinToPay2\x20API\x20error:\x20','Created\x20On:','Response\x20data:','CreatedOn','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Amount','8QKGMWz','TransactionID','headers','335349HukxPC','ExpiryTime','toLowerCase','HTTP\x20','../loggerService','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','721XZbiCj','PaymentDetail','amount','log','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','order_id','logWhiteDomainResponse',',\x20body:\x20','text','Error\x20stack:','Amount:','QRCodeURL','JSON\x20Parse\x20Error:\x20','EUR','237IXEuLq','payment_url','/create','waiting','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','&alternative=false','verifyPayment','paid','pending','🏦\x20Payment\x20Detail:','Request\x20Body:','CoinToPay2Service','loggerService','PENDING','12Xbagsb','CoinToPay2\x20status\x20API\x20error:\x20','stack','9752EoSzeo','===\x20COINTOPAY2\x20API\x20ERROR\x20===','FAILED','message','===\x20COINTOPAY2\x20SUCCESS\x20===','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Result:','gateway_payment_id','logWhiteDomainRequest','currency','Gateway\x20Payment\x20ID:','createPaymentLink','not\x20found','33bhcRqC','148415SQaFAw','https://traffer.uk/gateway/cointopay/','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','⚠️\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','🏦\x20Extracted\x20IBAN:','statusText','Status:','2599332czIBtJ'];a48_0x4ba5=function(){return _0x1df2af;};return a48_0x4ba5();}