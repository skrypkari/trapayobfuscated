'use strict';const a40_0x284b7d=a40_0x4e93;(function(_0x3ba805,_0x5bf3c5){const _0x11c519=a40_0x4e93,_0xaed0a8=_0x3ba805();while(!![]){try{const _0x13ee51=-parseInt(_0x11c519(0x224))/0x1+parseInt(_0x11c519(0x1f8))/0x2*(parseInt(_0x11c519(0x1fc))/0x3)+-parseInt(_0x11c519(0x21b))/0x4+-parseInt(_0x11c519(0x1b7))/0x5*(parseInt(_0x11c519(0x204))/0x6)+parseInt(_0x11c519(0x1ee))/0x7*(parseInt(_0x11c519(0x225))/0x8)+-parseInt(_0x11c519(0x1fa))/0x9+-parseInt(_0x11c519(0x21a))/0xa*(-parseInt(_0x11c519(0x1d7))/0xb);if(_0x13ee51===_0x5bf3c5)break;else _0xaed0a8['push'](_0xaed0a8['shift']());}catch(_0x9e0595){_0xaed0a8['push'](_0xaed0a8['shift']());}}}(a40_0x4b63,0x901c7));function a40_0x4e93(_0x279186,_0x46fd40){const _0x4b6325=a40_0x4b63();return a40_0x4e93=function(_0x4e9345,_0x32d5c0){_0x4e9345=_0x4e9345-0x1a8;let _0x33fc50=_0x4b6325[_0x4e9345];return _0x33fc50;},a40_0x4e93(_0x279186,_0x46fd40);}function a40_0x4b63(){const _0x133025=['toLowerCase','currency','Response\x20data:','cointopay2','18ykELrB','IBAN:','2043045uxRfMc','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','56535VCBNZJ','awaiting\x20fiat','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','error','loggerService','CoinToPay2\x20API\x20error:\x20','Missing\x20data\x20in\x20response','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','114JJWWWr','logWhiteDomainResponse','TransactionConfirmedOn','===\x20COINTOPAY2\x20SUCCESS\x20===','HTTP\x20Status:','Unknown\x20error','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status','not\x20confirmed','order_id','Status\x20Code:','Request\x20Body:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','POST','pending','Error\x20Message:','Unknown\x20error\x20from\x20CoinToPay2\x20API','Transaction\x20ID:','stack','created','paid','stringify','10jRlsTI','1499836oJaBrZ','Response\x20Time:','fromEntries','statusUrl','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','cancelled','success','\x20EUR','expired','1134547NNPgsq','576dotSsY','JSON\x20Parse\x20Error:\x20','HTTP\x20','Gateway\x20Payment\x20ID:','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','ExpiryTime','/status','Error\x20message:','logWhiteDomainRequest','merchant_reference_id','inputCurrency','waiting','entries','PAID','Headers:','defineProperty','processWebhook','parse','CoinToPay2Service','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY2\x20API\x20ERROR\x20===','103335DLylMO','/create','data','Amount','log','checkPaymentStatus','TransactionID','status_code','now','Result:','amount','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','üè¶\x20Extracted\x20IBAN:','FAILED','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','https://traffer.uk/gateway/cointopay/','Response\x20Body:','EUR','https://traffer.uk/gateway/cointopay/status.php','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20',',\x20body:\x20','Payment\x20URL:','message','gateway_payment_id','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','text','Error\x20details:','Error\x20stack:','status','Currency:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','Status\x20Text:','25350886gFBcNS','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','PaymentDetail','PENDING','üìä\x20Status\x20check\x20URL:','Amount:','QRCodeURL','Status\x20API\x20Error:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Business\x20Error:\x20','CoinToPay2\x20payment\x20status\x20check\x20error:','apiUrl','Incomplete\x20response:\x20missing\x20data','Payment\x20Status:','application/json','Failed\x20to\x20parse\x20JSON\x20response:','CreatedOn','not\x20found','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','logWhiteDomainError','__esModule','23842TlXqwq','verifyPayment','timeout','payment_url','Status:','result'];a40_0x4b63=function(){return _0x133025;};return a40_0x4b63();}Object[a40_0x284b7d(0x1b1)](exports,a40_0x284b7d(0x1ed),{'value':!![]}),exports[a40_0x284b7d(0x1b4)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPay2Service{constructor(){const _0x9e144d=a40_0x284b7d;this[_0x9e144d(0x1e4)]=_0x9e144d(0x1c6),this[_0x9e144d(0x21e)]=_0x9e144d(0x1c9),console[_0x9e144d(0x1bb)](_0x9e144d(0x1e0)),console[_0x9e144d(0x1bb)](_0x9e144d(0x1db),this[_0x9e144d(0x21e)]);}async['createPaymentLink'](_0x974b02){const _0x54ed47=a40_0x284b7d,{orderId:_0x5e2600,amount:_0x9de5ec}=_0x974b02;console[_0x54ed47(0x1bb)]('ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20'+_0x9de5ec+_0x54ed47(0x222));const _0x41f658={'amount':_0x9de5ec},_0x180104=Date[_0x54ed47(0x1bf)]();try{console[_0x54ed47(0x1bb)](_0x54ed47(0x229)),console[_0x54ed47(0x1bb)]('URL:',this[_0x54ed47(0x1e4)]),console[_0x54ed47(0x1bb)](_0x54ed47(0x20f),JSON[_0x54ed47(0x219)](_0x41f658,null,0x2)),console[_0x54ed47(0x1bb)](_0x54ed47(0x1dc),_0x9de5ec,_0x54ed47(0x1cf)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x54ed47(0x1f7),_0x54ed47(0x1b8),_0x54ed47(0x211),_0x41f658);const _0xb42609=await fetch(this[_0x54ed47(0x1e4)],{'method':_0x54ed47(0x211),'headers':{'Content-Type':_0x54ed47(0x1e7),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x54ed47(0x219)](_0x41f658)}),_0x5662d1=Date[_0x54ed47(0x1bf)]()-_0x180104;console['log'](_0x54ed47(0x1d8)),console['log'](_0x54ed47(0x1f2),_0xb42609[_0x54ed47(0x1d3)]),console[_0x54ed47(0x1bb)](_0x54ed47(0x1d6),_0xb42609['statusText']),console[_0x54ed47(0x1bb)](_0x54ed47(0x1b0),Object[_0x54ed47(0x21d)](_0xb42609['headers'][_0x54ed47(0x1ae)]())),console[_0x54ed47(0x1bb)](_0x54ed47(0x21c),_0x5662d1+'ms');const _0x4e485e=await _0xb42609[_0x54ed47(0x1d0)]();console[_0x54ed47(0x1bb)]('Raw\x20Response\x20Body:',_0x4e485e);if(!_0xb42609['ok']){console[_0x54ed47(0x1ff)](_0x54ed47(0x1b6)),console[_0x54ed47(0x1ff)]('HTTP\x20Status:',_0xb42609[_0x54ed47(0x1d3)]),console[_0x54ed47(0x1ff)](_0x54ed47(0x1c7),_0x4e485e),loggerService_1[_0x54ed47(0x200)]['logWhiteDomainResponse']('cointopay2',_0x54ed47(0x1b8),_0xb42609[_0x54ed47(0x1d3)],_0x4e485e,_0x5662d1),loggerService_1['loggerService'][_0x54ed47(0x1ec)](_0x54ed47(0x1f7),_0x54ed47(0x1b8),_0x54ed47(0x227)+_0xb42609[_0x54ed47(0x1d3)]+':\x20'+_0x4e485e);throw new Error(_0x54ed47(0x1b5)+_0xb42609[_0x54ed47(0x1d3)]+_0x54ed47(0x1cb)+_0x4e485e);}let _0x252d25;try{_0x252d25=JSON[_0x54ed47(0x1b3)](_0x4e485e);}catch(_0x195839){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x195839),loggerService_1[_0x54ed47(0x200)]['logWhiteDomainError']('cointopay2','/create',_0x54ed47(0x226)+_0x195839);throw new Error(_0x54ed47(0x1df)+_0x4e485e);}console['log']('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console[_0x54ed47(0x1bb)]('Parsed\x20Result:',JSON[_0x54ed47(0x219)](_0x252d25,null,0x2)),loggerService_1[_0x54ed47(0x200)][_0x54ed47(0x205)]('cointopay2',_0x54ed47(0x1b8),_0xb42609['status'],_0x252d25,_0x5662d1);if(_0x252d25[_0x54ed47(0x1ff)]){const _0x4580b7=_0x252d25[_0x54ed47(0x1cd)]||_0x252d25[_0x54ed47(0x1ff)]||_0x54ed47(0x214);console[_0x54ed47(0x1ff)](_0x54ed47(0x1eb)),console[_0x54ed47(0x1ff)](_0x54ed47(0x213),_0x4580b7),loggerService_1[_0x54ed47(0x200)][_0x54ed47(0x1ec)](_0x54ed47(0x1f7),_0x54ed47(0x1b8),_0x54ed47(0x1e2)+_0x4580b7);throw new Error(_0x54ed47(0x201)+_0x4580b7);}if(!_0x252d25[_0x54ed47(0x1f1)]||!_0x252d25[_0x54ed47(0x1ce)]){console[_0x54ed47(0x1ff)]('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x54ed47(0x1fb)),console[_0x54ed47(0x1ff)](_0x54ed47(0x1f6),_0x252d25),loggerService_1['loggerService'][_0x54ed47(0x1ec)]('cointopay2',_0x54ed47(0x1b8),_0x54ed47(0x1fe));throw new Error(_0x54ed47(0x20a));}return console['log'](_0x54ed47(0x207)),console[_0x54ed47(0x1bb)](_0x54ed47(0x228),_0x252d25[_0x54ed47(0x1ce)]),console[_0x54ed47(0x1bb)](_0x54ed47(0x1cc),_0x252d25[_0x54ed47(0x1f1)]),console['log'](_0x54ed47(0x1dc),_0x9de5ec,'EUR'),{'gateway_payment_id':_0x252d25[_0x54ed47(0x1ce)],'payment_url':_0x252d25[_0x54ed47(0x1f1)]};}catch(_0x2409f6){console[_0x54ed47(0x1ff)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console['error'](_0x54ed47(0x1d1),_0x2409f6),loggerService_1['loggerService']['logWhiteDomainError']('cointopay2','/create',_0x2409f6);if(_0x2409f6 instanceof Error){console[_0x54ed47(0x1ff)](_0x54ed47(0x1a9),_0x2409f6[_0x54ed47(0x1cd)]),console[_0x54ed47(0x1ff)](_0x54ed47(0x1d2),_0x2409f6[_0x54ed47(0x216)]);throw new Error(_0x54ed47(0x1d5)+_0x2409f6['message']);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x284b7d(0x1bc)](_0x313dee){const _0x3af600=a40_0x284b7d,_0x982532=Date['now']();try{console['log'](_0x3af600(0x1e1)+_0x313dee);const _0xb7a098={'gatewayPaymentId':_0x313dee};loggerService_1[_0x3af600(0x200)][_0x3af600(0x1aa)]('cointopay2',_0x3af600(0x1a8),'POST',_0xb7a098);const _0x5145bc=await fetch(this[_0x3af600(0x21e)],{'method':'POST','headers':{'Content-Type':_0x3af600(0x1e7),'Accept':_0x3af600(0x1e7),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x3af600(0x219)](_0xb7a098)}),_0x45f71f=Date[_0x3af600(0x1bf)]()-_0x982532;console[_0x3af600(0x1bb)](_0x3af600(0x1c2)),console[_0x3af600(0x1bb)](_0x3af600(0x1f2),_0x5145bc['status']),console[_0x3af600(0x1bb)](_0x3af600(0x21c),_0x45f71f+'ms');if(!_0x5145bc['ok']){const _0x53deeb=await _0x5145bc[_0x3af600(0x1d0)]();console[_0x3af600(0x1ff)](_0x3af600(0x208),_0x5145bc[_0x3af600(0x1d3)]),console['error'](_0x3af600(0x1c7),_0x53deeb),loggerService_1[_0x3af600(0x200)][_0x3af600(0x205)](_0x3af600(0x1f7),_0x3af600(0x1a8),_0x5145bc[_0x3af600(0x1d3)],_0x53deeb,_0x45f71f),loggerService_1[_0x3af600(0x200)]['logWhiteDomainError'](_0x3af600(0x1f7),_0x3af600(0x1a8),_0x3af600(0x227)+_0x5145bc[_0x3af600(0x1d3)]+':\x20'+_0x53deeb);throw new Error(_0x3af600(0x1b5)+_0x5145bc['status']);}const _0xf8aefd=await _0x5145bc[_0x3af600(0x1d0)]();console[_0x3af600(0x1bb)]('Raw\x20Response\x20Body:',_0xf8aefd);let _0x543207;try{_0x543207=JSON[_0x3af600(0x1b3)](_0xf8aefd);}catch(_0x2c77e3){console[_0x3af600(0x1ff)](_0x3af600(0x1e8),_0x2c77e3),loggerService_1[_0x3af600(0x200)][_0x3af600(0x1ec)](_0x3af600(0x1f7),_0x3af600(0x1a8),_0x3af600(0x226)+_0x2c77e3);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'+_0xf8aefd);}loggerService_1[_0x3af600(0x200)][_0x3af600(0x205)](_0x3af600(0x1f7),_0x3af600(0x1a8),_0x5145bc[_0x3af600(0x1d3)],_0x543207,_0x45f71f),console[_0x3af600(0x1bb)]('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x3af600(0x1c0),_0x543207[_0x3af600(0x1f3)]),console[_0x3af600(0x1bb)](_0x3af600(0x20e),_0x543207['status_code']),console[_0x3af600(0x1bb)](_0x3af600(0x1e6),_0x543207[_0x3af600(0x1b9)]?.[_0x3af600(0x20b)]),console[_0x3af600(0x1bb)](_0x3af600(0x1dc),_0x543207['data']?.[_0x3af600(0x1ba)]),console[_0x3af600(0x1bb)](_0x3af600(0x1d4),_0x543207[_0x3af600(0x1b9)]?.['inputCurrency']);if(_0x543207[_0x3af600(0x1f3)]!==_0x3af600(0x221)||_0x543207[_0x3af600(0x1be)]!==0xc8){const _0x23df7a=_0x543207[_0x3af600(0x1cd)]||'Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API';console[_0x3af600(0x1ff)](_0x3af600(0x203)),console[_0x3af600(0x1ff)](_0x3af600(0x213),_0x23df7a),loggerService_1[_0x3af600(0x200)][_0x3af600(0x1ec)](_0x3af600(0x1f7),_0x3af600(0x1a8),_0x3af600(0x1de)+_0x23df7a);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0x23df7a);}if(!_0x543207[_0x3af600(0x1b9)]){console[_0x3af600(0x1ff)]('===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3af600(0x1ff)](_0x3af600(0x202)),loggerService_1[_0x3af600(0x200)][_0x3af600(0x1ec)](_0x3af600(0x1f7),'/status',_0x3af600(0x1e5));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x1a4b13=_0x3af600(0x1da);switch(_0x543207[_0x3af600(0x1b9)][_0x3af600(0x20b)]?.[_0x3af600(0x1f4)]()){case _0x3af600(0x218):_0x1a4b13=_0x3af600(0x1af);break;case _0x3af600(0x220):case'failed':case'error':_0x1a4b13=_0x3af600(0x1c4);break;case _0x3af600(0x223):case _0x3af600(0x1f0):_0x1a4b13='EXPIRED';break;case _0x3af600(0x1ad):case _0x3af600(0x1fd):case _0x3af600(0x212):case _0x3af600(0x217):default:_0x1a4b13=_0x3af600(0x1da);break;}let _0x1c9372,_0x528584;if(_0x543207[_0x3af600(0x1b9)][_0x3af600(0x1d9)]){const _0x4887e9=_0x543207['data'][_0x3af600(0x1d9)];console['log']('üè¶\x20Payment\x20Detail:',_0x4887e9);const _0x45395d=_0x4887e9['match'](/IBAN\s+([A-Z0-9]+)/i);_0x45395d&&(_0x1c9372=_0x45395d[0x1],console[_0x3af600(0x1bb)](_0x3af600(0x1c3),_0x1c9372)),_0x528584=_0x4887e9;}const _0x34f325={'iban':_0x1c9372,'bankDetails':_0x528584,'transactionId':_0x543207[_0x3af600(0x1b9)][_0x3af600(0x1bd)],'coinAddress':_0x543207[_0x3af600(0x1b9)]['coinAddress'],'qrCodeUrl':_0x543207[_0x3af600(0x1b9)][_0x3af600(0x1dd)],'expiryTime':_0x543207[_0x3af600(0x1b9)][_0x3af600(0x22a)],'createdOn':_0x543207[_0x3af600(0x1b9)][_0x3af600(0x1e9)],'confirmedOn':_0x543207[_0x3af600(0x1b9)][_0x3af600(0x206)]};console[_0x3af600(0x1bb)]('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console[_0x3af600(0x1bb)](_0x3af600(0x1f2),_0x543207['data'][_0x3af600(0x20b)],'->',_0x1a4b13),console[_0x3af600(0x1bb)](_0x3af600(0x1dc),_0x543207[_0x3af600(0x1b9)][_0x3af600(0x1ba)],_0x543207[_0x3af600(0x1b9)][_0x3af600(0x1ac)]),console['log'](_0x3af600(0x215),_0x543207['data'][_0x3af600(0x1bd)]),console[_0x3af600(0x1bb)](_0x3af600(0x1f9),_0x1c9372||_0x3af600(0x1ea)),console[_0x3af600(0x1bb)]('Created\x20On:',_0x543207[_0x3af600(0x1b9)][_0x3af600(0x1e9)]),console[_0x3af600(0x1bb)]('Confirmed\x20On:',_0x543207[_0x3af600(0x1b9)]['TransactionConfirmedOn']||_0x3af600(0x20c));if(_0x543207[_0x3af600(0x1b9)]['Status']?.[_0x3af600(0x1f4)]()==='awaiting\x20fiat')console[_0x3af600(0x1bb)](_0x3af600(0x1c5));else _0x543207[_0x3af600(0x1b9)]['Status']?.[_0x3af600(0x1f4)]()==='paid'&&console[_0x3af600(0x1bb)](_0x3af600(0x210));return{'status':_0x1a4b13,'amount':parseFloat(_0x543207[_0x3af600(0x1b9)][_0x3af600(0x1ba)])||undefined,'currency':_0x543207['data'][_0x3af600(0x1ac)]||_0x3af600(0x1c8),'paymentDetails':_0x34f325};}catch(_0x3fc73e){console['error'](_0x3af600(0x1e3),_0x3fc73e),loggerService_1['loggerService'][_0x3af600(0x1ec)](_0x3af600(0x1f7),_0x3af600(0x1a8),_0x3fc73e);throw new Error(_0x3af600(0x1ca)+(_0x3fc73e instanceof Error?_0x3fc73e[_0x3af600(0x1cd)]:_0x3af600(0x209)));}}async[a40_0x284b7d(0x1ef)](_0x134252){const _0x2b3796=a40_0x284b7d,_0x5a0341=await this[_0x2b3796(0x1bc)](_0x134252);return{'status':_0x5a0341[_0x2b3796(0x1d3)],'amount':_0x5a0341[_0x2b3796(0x1c1)],'currency':_0x5a0341[_0x2b3796(0x1f5)]};}async[a40_0x284b7d(0x1b2)](_0x36902d){const _0x4bb8e0=a40_0x284b7d;console['log'](_0x4bb8e0(0x21f),_0x36902d);let _0x57cace=_0x4bb8e0(0x1da);switch(_0x36902d[_0x4bb8e0(0x1d3)]?.[_0x4bb8e0(0x1f4)]()){case'paid':_0x57cace=_0x4bb8e0(0x1af);break;case'cancelled':case'failed':case _0x4bb8e0(0x1ff):_0x57cace=_0x4bb8e0(0x1c4);break;case _0x4bb8e0(0x223):case _0x4bb8e0(0x1f0):_0x57cace='EXPIRED';break;case'pending':case _0x4bb8e0(0x1ad):case _0x4bb8e0(0x1fd):case'created':default:_0x57cace=_0x4bb8e0(0x1da);break;}return{'paymentId':_0x36902d[_0x4bb8e0(0x20d)]||_0x36902d[_0x4bb8e0(0x1ab)]||'','status':_0x57cace,'amount':_0x36902d[_0x4bb8e0(0x1c1)],'currency':_0x36902d['currency']||_0x4bb8e0(0x1c8)};}}exports[a40_0x284b7d(0x1b4)]=CoinToPay2Service;