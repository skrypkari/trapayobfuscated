'use strict';const a46_0x9d53ce=a46_0x2199;(function(_0x491d04,_0x1ac7ed){const _0x396509=a46_0x2199,_0xbe75e4=_0x491d04();while(!![]){try{const _0x344364=-parseInt(_0x396509(0x123))/0x1+-parseInt(_0x396509(0x105))/0x2+-parseInt(_0x396509(0x10e))/0x3*(-parseInt(_0x396509(0xc8))/0x4)+-parseInt(_0x396509(0xec))/0x5+parseInt(_0x396509(0x11d))/0x6+-parseInt(_0x396509(0xee))/0x7*(-parseInt(_0x396509(0xb8))/0x8)+parseInt(_0x396509(0x10b))/0x9;if(_0x344364===_0x1ac7ed)break;else _0xbe75e4['push'](_0xbe75e4['shift']());}catch(_0x39fa1e){_0xbe75e4['push'](_0xbe75e4['shift']());}}}(a46_0xa5b7,0x2ace5));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a46_0x9d53ce(0x10f)]=void 0x0;function a46_0xa5b7(){const _0x39a3e5=['HTTP\x20error!\x20status:\x20','PaymentDetail','Status','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','payment_url','/create','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','waiting','parse','success','not\x20found','Payment\x20URL\x20(original):','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','Error\x20stack:','Payment\x20URL\x20(modified):','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','createPaymentLink','Unknown\x20error\x20from\x20CoinToPay2\x20API','Amount','POST','Error\x20message:','Status:','merchant_reference_id','Incomplete\x20response:\x20missing\x20data','8168cxvsrK','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','üè¶\x20Payment\x20Detail:','now','not\x20confirmed','cointopay2','apiUrl','using\x20pattern:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','loggerService','amount','Headers:','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Confirmed\x20On:','FAILED','200708HQHclG','Response\x20data:','CreatedOn','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','Transaction\x20ID:','CoinToPay2\x20status\x20API\x20error:\x20','entries','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','stringify','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','text','Created\x20On:','logWhiteDomainError','processWebhook','===\x20COINTOPAY2\x20SUCCESS\x20===','order_id','CoinToPay2\x20payment\x20status\x20check\x20error:','Status\x20Code:','EUR',',\x20body:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','statusText','awaiting\x20fiat','application/json','Amount:','message','Result:','Payment\x20System/1.0\x20(CoinToPay2)','IBAN:','Currency:','Missing\x20data\x20in\x20response','üè¶\x20Extracted\x20IBAN:','/status','result','TransactionID','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','904505qSFPzR','status_code','1337POgtIs','TransactionConfirmedOn','Unknown\x20error','Business\x20Error:\x20','logWhiteDomainResponse','coinAddress','verifyPayment','created','log','Gateway\x20Payment\x20ID:','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Parsed\x20Result:','Raw\x20Response\x20Body:','Request\x20Body:','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','\x20EUR','Payment\x20Status:','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','expired','paid','inputCurrency','360280QThmVx','https://traffer.uk/gateway/cointopay/','Status\x20API\x20Error:\x20','https://traffer.uk/gateway/cointopay/status.php','PENDING','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','4759596rcppgV','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','fromEntries','6Dshpmb','CoinToPay2Service','data','headers','logWhiteDomainRequest','cancelled','Response\x20Time:','checkPaymentStatus','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','pending','source','toLowerCase','HTTP\x20','timeout','175200OEOgcj','Error\x20Message:','QRCodeURL','match','failed','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','317035ZXQAOi','ExpiryTime','URL:','üìä\x20Status\x20check\x20URL:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','statusUrl','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','JSON\x20Parse\x20Error:\x20','Response\x20Body:','status','error','EXPIRED','&alternative=false','PAID','gateway_payment_id','HTTP\x20Status:'];a46_0xa5b7=function(){return _0x39a3e5;};return a46_0xa5b7();}const loggerService_1=require('../loggerService');function a46_0x2199(_0x415948,_0x350bb2){const _0xa5b77f=a46_0xa5b7();return a46_0x2199=function(_0x21991a,_0x83a2bb){_0x21991a=_0x21991a-0xae;let _0xe3e9cb=_0xa5b77f[_0x21991a];return _0xe3e9cb;},a46_0x2199(_0x415948,_0x350bb2);}class CoinToPay2Service{constructor(){const _0x1cc19d=a46_0x9d53ce;this[_0x1cc19d(0xbf)]=_0x1cc19d(0x106),this[_0x1cc19d(0x128)]=_0x1cc19d(0x108),console[_0x1cc19d(0xf6)]('ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console['log'](_0x1cc19d(0x126),this[_0x1cc19d(0x128)]);}async[a46_0x9d53ce(0xb0)](_0x517827){const _0x334565=a46_0x9d53ce,{orderId:_0x472b37,amount:_0x82ef8e}=_0x517827;console['log'](_0x334565(0xae)+_0x82ef8e+_0x334565(0xff));const _0x575482={'amount':_0x82ef8e},_0xdebb05=Date[_0x334565(0xbc)]();try{console[_0x334565(0xf6)](_0x334565(0x116)),console[_0x334565(0xf6)](_0x334565(0x125),this[_0x334565(0xbf)]),console[_0x334565(0xf6)](_0x334565(0xfb),JSON[_0x334565(0xd0)](_0x575482,null,0x2)),console['log'](_0x334565(0xe0),_0x82ef8e,_0x334565(0xdc)),loggerService_1[_0x334565(0xc2)][_0x334565(0x112)](_0x334565(0xbe),'/create','POST',_0x575482);const _0x508c2d=await fetch(this[_0x334565(0xbf)],{'method':_0x334565(0xb3),'headers':{'Content-Type':_0x334565(0xdf),'Accept':'application/json','User-Agent':_0x334565(0xe3)},'body':JSON[_0x334565(0xd0)](_0x575482)}),_0x5f3bfb=Date['now']()-_0xdebb05;console[_0x334565(0xf6)](_0x334565(0x10a)),console[_0x334565(0xf6)]('Status:',_0x508c2d[_0x334565(0x12c)]),console[_0x334565(0xf6)]('Status\x20Text:',_0x508c2d[_0x334565(0xdd)]),console['log'](_0x334565(0xc4),Object[_0x334565(0x10d)](_0x508c2d[_0x334565(0x111)][_0x334565(0xce)]())),console['log'](_0x334565(0x114),_0x5f3bfb+'ms');const _0xd2f7c3=await _0x508c2d[_0x334565(0xd2)]();console['log'](_0x334565(0xfa),_0xd2f7c3);if(!_0x508c2d['ok']){console['error'](_0x334565(0xf8)),console[_0x334565(0x12d)]('HTTP\x20Status:',_0x508c2d['status']),console[_0x334565(0x12d)](_0x334565(0x12b),_0xd2f7c3),loggerService_1['loggerService'][_0x334565(0xf2)]('cointopay2',_0x334565(0x138),_0x508c2d[_0x334565(0x12c)],_0xd2f7c3,_0x5f3bfb),loggerService_1[_0x334565(0xc2)][_0x334565(0xd4)](_0x334565(0xbe),_0x334565(0x138),_0x334565(0x11b)+_0x508c2d[_0x334565(0x12c)]+':\x20'+_0xd2f7c3);throw new Error(_0x334565(0x133)+_0x508c2d[_0x334565(0x12c)]+_0x334565(0xdb)+_0xd2f7c3);}let _0x43269d;try{_0x43269d=JSON['parse'](_0xd2f7c3);}catch(_0x4d5a93){console[_0x334565(0x12d)](_0x334565(0xfc),_0x4d5a93),loggerService_1[_0x334565(0xc2)]['logWhiteDomainError'](_0x334565(0xbe),_0x334565(0x138),_0x334565(0x12a)+_0x4d5a93);throw new Error(_0x334565(0x127)+_0xd2f7c3);}console[_0x334565(0xf6)](_0x334565(0x10c)),console['log'](_0x334565(0xf9),JSON[_0x334565(0xd0)](_0x43269d,null,0x2)),loggerService_1[_0x334565(0xc2)][_0x334565(0xf2)](_0x334565(0xbe),_0x334565(0x138),_0x508c2d[_0x334565(0x12c)],_0x43269d,_0x5f3bfb);if(_0x43269d[_0x334565(0x12d)]){const _0x26d571=_0x43269d[_0x334565(0xe1)]||_0x43269d[_0x334565(0x12d)]||_0x334565(0xb1);console[_0x334565(0x12d)](_0x334565(0xfe)),console['error'](_0x334565(0x11e),_0x26d571),loggerService_1['loggerService'][_0x334565(0xd4)]('cointopay2','/create',_0x334565(0xf1)+_0x26d571);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x26d571);}if(!_0x43269d[_0x334565(0x137)]||!_0x43269d[_0x334565(0x131)]){console['error']('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x334565(0xc1)),console['error'](_0x334565(0xc9),_0x43269d),loggerService_1[_0x334565(0xc2)][_0x334565(0xd4)](_0x334565(0xbe),'/create',_0x334565(0xcf));throw new Error(_0x334565(0xfd));}console[_0x334565(0xf6)](_0x334565(0xd6)),console[_0x334565(0xf6)](_0x334565(0xf7),_0x43269d[_0x334565(0x131)]),console[_0x334565(0xf6)](_0x334565(0x13e),_0x43269d['payment_url']);const _0x2d956b=_0x43269d[_0x334565(0x137)]+_0x334565(0x12f);return console[_0x334565(0xf6)](_0x334565(0x141),_0x2d956b),console['log'](_0x334565(0xe0),_0x82ef8e,_0x334565(0xda)),{'gateway_payment_id':_0x43269d[_0x334565(0x131)],'payment_url':_0x2d956b};}catch(_0x88a70d){console[_0x334565(0x12d)](_0x334565(0x136)),console[_0x334565(0x12d)]('Error\x20details:',_0x88a70d),loggerService_1[_0x334565(0xc2)][_0x334565(0xd4)](_0x334565(0xbe),_0x334565(0x138),_0x88a70d);if(_0x88a70d instanceof Error){console[_0x334565(0x12d)](_0x334565(0xb4),_0x88a70d[_0x334565(0xe1)]),console['error'](_0x334565(0x140),_0x88a70d['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x88a70d['message']);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a46_0x9d53ce(0x115)](_0x4fa359){const _0x42050b=a46_0x9d53ce,_0xf798b9=Date[_0x42050b(0xbc)]();try{console[_0x42050b(0xf6)](_0x42050b(0x117)+_0x4fa359);const _0x187bd2={'gatewayPaymentId':_0x4fa359};loggerService_1['loggerService'][_0x42050b(0x112)](_0x42050b(0xbe),'/status',_0x42050b(0xb3),_0x187bd2);const _0x1973f3=await fetch(this[_0x42050b(0x128)],{'method':'POST','headers':{'Content-Type':_0x42050b(0xdf),'Accept':_0x42050b(0xdf),'User-Agent':_0x42050b(0xe3)},'body':JSON['stringify'](_0x187bd2)}),_0x34f0de=Date[_0x42050b(0xbc)]()-_0xf798b9;console['log'](_0x42050b(0x129)),console[_0x42050b(0xf6)](_0x42050b(0xb5),_0x1973f3[_0x42050b(0x12c)]),console[_0x42050b(0xf6)](_0x42050b(0x114),_0x34f0de+'ms');if(!_0x1973f3['ok']){const _0x1f5e4e=await _0x1973f3['text']();console[_0x42050b(0x12d)](_0x42050b(0x132),_0x1973f3[_0x42050b(0x12c)]),console[_0x42050b(0x12d)](_0x42050b(0x12b),_0x1f5e4e),loggerService_1['loggerService'][_0x42050b(0xf2)]('cointopay2',_0x42050b(0xe8),_0x1973f3[_0x42050b(0x12c)],_0x1f5e4e,_0x34f0de),loggerService_1['loggerService']['logWhiteDomainError'](_0x42050b(0xbe),_0x42050b(0xe8),_0x42050b(0x11b)+_0x1973f3[_0x42050b(0x12c)]+':\x20'+_0x1f5e4e);throw new Error(_0x42050b(0x133)+_0x1973f3[_0x42050b(0x12c)]);}const _0x35ebd9=await _0x1973f3['text']();console[_0x42050b(0xf6)](_0x42050b(0xfa),_0x35ebd9);let _0x42c42a;try{_0x42c42a=JSON[_0x42050b(0x13b)](_0x35ebd9);}catch(_0x5e9d4c){console[_0x42050b(0x12d)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5e9d4c),loggerService_1[_0x42050b(0xc2)][_0x42050b(0xd4)](_0x42050b(0xbe),_0x42050b(0xe8),_0x42050b(0x12a)+_0x5e9d4c);throw new Error(_0x42050b(0xba)+_0x35ebd9);}loggerService_1[_0x42050b(0xc2)][_0x42050b(0xf2)]('cointopay2',_0x42050b(0xe8),_0x1973f3['status'],_0x42c42a,_0x34f0de),console['log'](_0x42050b(0x101)),console['log'](_0x42050b(0xe2),_0x42c42a[_0x42050b(0xe9)]),console['log'](_0x42050b(0xd9),_0x42c42a[_0x42050b(0xed)]),console[_0x42050b(0xf6)](_0x42050b(0x100),_0x42c42a[_0x42050b(0x110)]?.[_0x42050b(0x135)]),console[_0x42050b(0xf6)](_0x42050b(0xe0),_0x42c42a[_0x42050b(0x110)]?.[_0x42050b(0xb2)]),console[_0x42050b(0xf6)](_0x42050b(0xe5),_0x42c42a[_0x42050b(0x110)]?.['inputCurrency']);if(_0x42c42a[_0x42050b(0xe9)]!==_0x42050b(0x13c)||_0x42c42a['status_code']!==0xc8){const _0x55ae51=_0x42c42a['message']||_0x42050b(0xc5);console[_0x42050b(0x12d)]('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x55ae51),loggerService_1[_0x42050b(0xc2)][_0x42050b(0xd4)](_0x42050b(0xbe),_0x42050b(0xe8),_0x42050b(0x107)+_0x55ae51);throw new Error(_0x42050b(0xcd)+_0x55ae51);}if(!_0x42c42a['data']){console['error'](_0x42050b(0xd1)),console[_0x42050b(0x12d)](_0x42050b(0xe6)),loggerService_1['loggerService'][_0x42050b(0xd4)](_0x42050b(0xbe),'/status',_0x42050b(0xb7));throw new Error(_0x42050b(0x13f));}let _0x974475='PENDING';switch(_0x42c42a['data']['Status']?.[_0x42050b(0x11a)]()){case'paid':_0x974475=_0x42050b(0x130);break;case _0x42050b(0x113):case'failed':case _0x42050b(0x12d):_0x974475=_0x42050b(0xc7);break;case _0x42050b(0x102):case _0x42050b(0x11c):_0x974475='EXPIRED';break;case _0x42050b(0x13a):case'awaiting\x20fiat':case'pending':case _0x42050b(0xf5):default:_0x974475='PENDING';break;}let _0x32adcb,_0x3f78ec;if(_0x42c42a[_0x42050b(0x110)][_0x42050b(0x134)]){const _0x24ef2f=_0x42c42a[_0x42050b(0x110)][_0x42050b(0x134)];console['log'](_0x42050b(0xbb),_0x24ef2f);const _0x28a942=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x37ef0c of _0x28a942){const _0x223019=_0x24ef2f[_0x42050b(0x120)](_0x37ef0c);if(_0x223019){_0x32adcb=_0x223019[0x1],console[_0x42050b(0xf6)](_0x42050b(0xe7),_0x32adcb,_0x42050b(0xc0),_0x37ef0c[_0x42050b(0x119)]);break;}}if(!_0x32adcb){console[_0x42050b(0xf6)](_0x42050b(0xaf));const _0x1c5c40=_0x24ef2f[_0x42050b(0x120)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x1c5c40&&(_0x32adcb=_0x1c5c40[0x1],console['log'](_0x42050b(0xcb),_0x32adcb));}_0x3f78ec=_0x24ef2f;}const _0x2c953a={'iban':_0x32adcb,'bankDetails':_0x3f78ec,'transactionId':_0x42c42a[_0x42050b(0x110)]['TransactionID'],'coinAddress':_0x42c42a['data'][_0x42050b(0xf3)],'qrCodeUrl':_0x42c42a['data'][_0x42050b(0x11f)],'expiryTime':_0x42c42a[_0x42050b(0x110)][_0x42050b(0x124)],'createdOn':_0x42c42a[_0x42050b(0x110)][_0x42050b(0xca)],'confirmedOn':_0x42c42a[_0x42050b(0x110)][_0x42050b(0xef)]};console[_0x42050b(0xf6)](_0x42050b(0x139)),console[_0x42050b(0xf6)](_0x42050b(0xb5),_0x42c42a[_0x42050b(0x110)][_0x42050b(0x135)],'->',_0x974475),console['log'](_0x42050b(0xe0),_0x42c42a['data'][_0x42050b(0xb2)],_0x42c42a['data'][_0x42050b(0x104)]),console[_0x42050b(0xf6)](_0x42050b(0xcc),_0x42c42a['data'][_0x42050b(0xea)]),console[_0x42050b(0xf6)](_0x42050b(0xe4),_0x32adcb||_0x42050b(0x13d)),console['log'](_0x42050b(0xd3),_0x42c42a[_0x42050b(0x110)][_0x42050b(0xca)]),console[_0x42050b(0xf6)](_0x42050b(0xc6),_0x42c42a[_0x42050b(0x110)][_0x42050b(0xef)]||_0x42050b(0xbd));if(_0x42c42a['data']['Status']?.['toLowerCase']()===_0x42050b(0xde))console[_0x42050b(0xf6)](_0x42050b(0xeb));else _0x42c42a['data']['Status']?.[_0x42050b(0x11a)]()===_0x42050b(0x103)&&console[_0x42050b(0xf6)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x974475,'amount':parseFloat(_0x42c42a[_0x42050b(0x110)][_0x42050b(0xb2)])||undefined,'currency':_0x42c42a[_0x42050b(0x110)][_0x42050b(0x104)]||_0x42050b(0xda),'paymentDetails':_0x2c953a};}catch(_0x5f41a5){console[_0x42050b(0x12d)](_0x42050b(0xd8),_0x5f41a5),loggerService_1[_0x42050b(0xc2)][_0x42050b(0xd4)]('cointopay2',_0x42050b(0xe8),_0x5f41a5);throw new Error(_0x42050b(0x122)+(_0x5f41a5 instanceof Error?_0x5f41a5[_0x42050b(0xe1)]:_0x42050b(0xf0)));}}async[a46_0x9d53ce(0xf4)](_0x35e03a){const _0x17dfe0=a46_0x9d53ce,_0x573f6b=await this[_0x17dfe0(0x115)](_0x35e03a);return{'status':_0x573f6b['status'],'amount':_0x573f6b[_0x17dfe0(0xc3)],'currency':_0x573f6b['currency']};}async[a46_0x9d53ce(0xd5)](_0x4319c1){const _0x25c873=a46_0x9d53ce;console[_0x25c873(0xf6)](_0x25c873(0xb9),_0x4319c1);let _0x464bb6=_0x25c873(0x109);switch(_0x4319c1[_0x25c873(0x12c)]?.['toLowerCase']()){case _0x25c873(0x103):_0x464bb6=_0x25c873(0x130);break;case _0x25c873(0x113):case _0x25c873(0x121):case _0x25c873(0x12d):_0x464bb6=_0x25c873(0xc7);break;case'expired':case _0x25c873(0x11c):_0x464bb6=_0x25c873(0x12e);break;case _0x25c873(0x118):case _0x25c873(0x13a):case _0x25c873(0xde):case _0x25c873(0xf5):default:_0x464bb6=_0x25c873(0x109);break;}return{'paymentId':_0x4319c1[_0x25c873(0xd7)]||_0x4319c1[_0x25c873(0xb6)]||'','status':_0x464bb6,'amount':_0x4319c1['amount'],'currency':_0x4319c1['currency']||_0x25c873(0xda)};}}exports[a46_0x9d53ce(0x10f)]=CoinToPay2Service;