'use strict';const a42_0x1a6a70=a42_0x3a58;(function(_0x2d13b2,_0x13dcb8){const _0x1925df=a42_0x3a58,_0x42b111=_0x2d13b2();while(!![]){try{const _0x29d4a4=-parseInt(_0x1925df(0xee))/0x1*(parseInt(_0x1925df(0x118))/0x2)+-parseInt(_0x1925df(0xd1))/0x3+-parseInt(_0x1925df(0xf2))/0x4+parseInt(_0x1925df(0xf4))/0x5*(parseInt(_0x1925df(0x132))/0x6)+-parseInt(_0x1925df(0x11f))/0x7*(parseInt(_0x1925df(0xde))/0x8)+-parseInt(_0x1925df(0x140))/0x9+parseInt(_0x1925df(0xed))/0xa*(parseInt(_0x1925df(0xe1))/0xb);if(_0x29d4a4===_0x13dcb8)break;else _0x42b111['push'](_0x42b111['shift']());}catch(_0x1ff5d0){_0x42b111['push'](_0x42b111['shift']());}}}(a42_0x37cb,0x8b4fb));Object[a42_0x1a6a70(0x115)](exports,a42_0x1a6a70(0x13a),{'value':!![]}),exports[a42_0x1a6a70(0xe7)]=void 0x0;function a42_0x37cb(){const _0x93968a=['currency','TransactionID','Unknown\x20error\x20from\x20CoinToPay2\x20API','Response\x20Time:','URL:','expired','7rpbffj','Status\x20Code:','toLowerCase','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Status:','Transaction\x20ID:','POST','Currency:','HTTP\x20','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Amount','order_id','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','CoinToPay2\x20payment\x20status\x20check\x20error:','parse','TransactionConfirmedOn','stringify','pending','EUR','2797428PKXMhi',',\x20body:\x20','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','cointopay2','createPaymentLink','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','__esModule','statusUrl','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','log','cancelled','logWhiteDomainResponse','2622762RzlIel','JSON\x20Parse\x20Error:\x20','Headers:','Created\x20On:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','match','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','text','verifyPayment','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','payment_url','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','../loggerService','awaiting\x20fiat','HTTP\x20error!\x20status:\x20','status','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','https://traffer.uk/gateway/cointopay/status.php','message','Confirmed\x20On:','result','HTTP\x20Status:','apiUrl','waiting','failed','stack','https://traffer.uk/gateway/cointopay/','CreatedOn','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Parsed\x20Result:','Business\x20Error:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','logWhiteDomainError','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','3178842VTZIJx','now','statusText','Gateway\x20Payment\x20ID:','success','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','gateway_payment_id','Error\x20message:','\x20EUR','Failed\x20to\x20parse\x20JSON\x20response:','Status\x20Text:','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Raw\x20Response\x20Body:','579080OXwVWB','/status','CoinToPay2\x20status\x20API\x20error:\x20','22KYQXjz','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','using\x20pattern:','status_code','source','===\x20COINTOPAY2\x20SUCCESS\x20===','CoinToPay2Service','entries','timeout','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','EXPIRED','created','14561230ZqzXZS','103237vEpfFc','PAID','headers','checkPaymentStatus','2647156bLyayz','Error\x20Message:','5INiruk','Error\x20stack:','QRCodeURL','logWhiteDomainRequest','IBAN:','Unknown\x20error','Missing\x20data\x20in\x20response','fromEntries','Result:','coinAddress','not\x20confirmed','loggerService','üìä\x20Status\x20check\x20URL:','Amount:','inputCurrency','application/json','not\x20found','processWebhook','Payment\x20URL:','FAILED','PENDING','Response\x20data:','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','error','paid','PaymentDetail','Response\x20Body:','/create','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','data','defineProperty','amount','Status','14lbAHIb'];a42_0x37cb=function(){return _0x93968a;};return a42_0x37cb();}const loggerService_1=require(a42_0x1a6a70(0x14c));function a42_0x3a58(_0x7d6bb6,_0x3a89d0){const _0x37cbde=a42_0x37cb();return a42_0x3a58=function(_0x3a584e,_0x5557be){_0x3a584e=_0x3a584e-0xcf;let _0x5ccaf7=_0x37cbde[_0x3a584e];return _0x5ccaf7;},a42_0x3a58(_0x7d6bb6,_0x3a89d0);}class CoinToPay2Service{constructor(){const _0x389965=a42_0x1a6a70;this['apiUrl']=_0x389965(0x15a),this[_0x389965(0x13b)]=_0x389965(0x151),console['log']('ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0x389965(0x13d)](_0x389965(0x100),this[_0x389965(0x13b)]);}async[a42_0x1a6a70(0x137)](_0x3175de){const _0x15b948=a42_0x1a6a70,{orderId:_0x59e9de,amount:_0xff4394}=_0x3175de;console[_0x15b948(0x13d)](_0x15b948(0x10b)+_0xff4394+_0x15b948(0xd9));const _0x186f44={'amount':_0xff4394},_0xc63c1f=Date[_0x15b948(0xd2)]();try{console['log'](_0x15b948(0x122)),console[_0x15b948(0x13d)](_0x15b948(0x11d),this[_0x15b948(0x156)]),console[_0x15b948(0x13d)]('Request\x20Body:',JSON[_0x15b948(0x12f)](_0x186f44,null,0x2)),console['log']('Amount:',_0xff4394,_0x15b948(0x138)),loggerService_1[_0x15b948(0xff)]['logWhiteDomainRequest'](_0x15b948(0x136),'/create',_0x15b948(0x125),_0x186f44);const _0x175786=await fetch(this[_0x15b948(0x156)],{'method':'POST','headers':{'Content-Type':_0x15b948(0x103),'Accept':_0x15b948(0x103),'User-Agent':_0x15b948(0x146)},'body':JSON[_0x15b948(0x12f)](_0x186f44)}),_0x2316b4=Date[_0x15b948(0xd2)]()-_0xc63c1f;console[_0x15b948(0x13d)](_0x15b948(0x10a)),console[_0x15b948(0x13d)](_0x15b948(0x123),_0x175786['status']),console[_0x15b948(0x13d)](_0x15b948(0xdb),_0x175786[_0x15b948(0xd3)]),console[_0x15b948(0x13d)](_0x15b948(0x142),Object[_0x15b948(0xfb)](_0x175786[_0x15b948(0xf0)][_0x15b948(0xe8)]())),console[_0x15b948(0x13d)]('Response\x20Time:',_0x2316b4+'ms');const _0x411d88=await _0x175786[_0x15b948(0x147)]();console[_0x15b948(0x13d)](_0x15b948(0xdd),_0x411d88);if(!_0x175786['ok']){console[_0x15b948(0x10e)](_0x15b948(0x15c)),console[_0x15b948(0x10e)](_0x15b948(0x155),_0x175786[_0x15b948(0x14f)]),console[_0x15b948(0x10e)](_0x15b948(0x111),_0x411d88),loggerService_1['loggerService'][_0x15b948(0x13f)](_0x15b948(0x136),_0x15b948(0x112),_0x175786['status'],_0x411d88,_0x2316b4),loggerService_1[_0x15b948(0xff)][_0x15b948(0x160)](_0x15b948(0x136),_0x15b948(0x112),'HTTP\x20'+_0x175786[_0x15b948(0x14f)]+':\x20'+_0x411d88);throw new Error(_0x15b948(0x14e)+_0x175786['status']+_0x15b948(0x133)+_0x411d88);}let _0x2ffba5;try{_0x2ffba5=JSON[_0x15b948(0x12d)](_0x411d88);}catch(_0x21ae80){console[_0x15b948(0x10e)](_0x15b948(0xda),_0x21ae80),loggerService_1[_0x15b948(0xff)]['logWhiteDomainError'](_0x15b948(0x136),'/create',_0x15b948(0x141)+_0x21ae80);throw new Error(_0x15b948(0x149)+_0x411d88);}console[_0x15b948(0x13d)](_0x15b948(0x144)),console[_0x15b948(0x13d)](_0x15b948(0x15d),JSON['stringify'](_0x2ffba5,null,0x2)),loggerService_1[_0x15b948(0xff)][_0x15b948(0x13f)](_0x15b948(0x136),'/create',_0x175786[_0x15b948(0x14f)],_0x2ffba5,_0x2316b4);if(_0x2ffba5[_0x15b948(0x10e)]){const _0x22e678=_0x2ffba5[_0x15b948(0x152)]||_0x2ffba5[_0x15b948(0x10e)]||_0x15b948(0x11b);console[_0x15b948(0x10e)](_0x15b948(0xd6)),console[_0x15b948(0x10e)](_0x15b948(0xf3),_0x22e678),loggerService_1['loggerService']['logWhiteDomainError']('cointopay2','/create',_0x15b948(0x15e)+_0x22e678);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x22e678);}if(!_0x2ffba5[_0x15b948(0x14a)]||!_0x2ffba5[_0x15b948(0xd7)]){console[_0x15b948(0x10e)](_0x15b948(0xcf)),console[_0x15b948(0x10e)](_0x15b948(0x113)),console[_0x15b948(0x10e)](_0x15b948(0x109),_0x2ffba5),loggerService_1[_0x15b948(0xff)][_0x15b948(0x160)](_0x15b948(0x136),_0x15b948(0x112),_0x15b948(0x15f));throw new Error(_0x15b948(0x128));}return console[_0x15b948(0x13d)](_0x15b948(0xe6)),console[_0x15b948(0x13d)](_0x15b948(0xd4),_0x2ffba5['gateway_payment_id']),console[_0x15b948(0x13d)](_0x15b948(0x106),_0x2ffba5['payment_url']),console[_0x15b948(0x13d)](_0x15b948(0x101),_0xff4394,_0x15b948(0x131)),{'gateway_payment_id':_0x2ffba5['gateway_payment_id'],'payment_url':_0x2ffba5[_0x15b948(0x14a)]};}catch(_0x5cdd64){console['error'](_0x15b948(0xd0)),console[_0x15b948(0x10e)]('Error\x20details:',_0x5cdd64),loggerService_1['loggerService'][_0x15b948(0x160)](_0x15b948(0x136),_0x15b948(0x112),_0x5cdd64);if(_0x5cdd64 instanceof Error){console[_0x15b948(0x10e)](_0x15b948(0xd8),_0x5cdd64[_0x15b948(0x152)]),console[_0x15b948(0x10e)](_0x15b948(0xf5),_0x5cdd64[_0x15b948(0x159)]);throw new Error(_0x15b948(0x135)+_0x5cdd64[_0x15b948(0x152)]);}throw new Error(_0x15b948(0x10d));}}async[a42_0x1a6a70(0xf1)](_0x3d602c){const _0x1c395d=a42_0x1a6a70,_0x281d79=Date[_0x1c395d(0xd2)]();try{console[_0x1c395d(0x13d)](_0x1c395d(0xdc)+_0x3d602c);const _0x2439bf={'gatewayPaymentId':_0x3d602c};loggerService_1[_0x1c395d(0xff)][_0x1c395d(0xf7)](_0x1c395d(0x136),_0x1c395d(0xdf),'POST',_0x2439bf);const _0x5903b3=await fetch(this[_0x1c395d(0x13b)],{'method':_0x1c395d(0x125),'headers':{'Content-Type':'application/json','Accept':_0x1c395d(0x103),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x1c395d(0x12f)](_0x2439bf)}),_0x275375=Date[_0x1c395d(0xd2)]()-_0x281d79;console[_0x1c395d(0x13d)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x1c395d(0x13d)]('Status:',_0x5903b3[_0x1c395d(0x14f)]),console[_0x1c395d(0x13d)](_0x1c395d(0x11c),_0x275375+'ms');if(!_0x5903b3['ok']){const _0x17f42f=await _0x5903b3[_0x1c395d(0x147)]();console[_0x1c395d(0x10e)]('HTTP\x20Status:',_0x5903b3[_0x1c395d(0x14f)]),console[_0x1c395d(0x10e)]('Response\x20Body:',_0x17f42f),loggerService_1[_0x1c395d(0xff)][_0x1c395d(0x13f)](_0x1c395d(0x136),_0x1c395d(0xdf),_0x5903b3[_0x1c395d(0x14f)],_0x17f42f,_0x275375),loggerService_1[_0x1c395d(0xff)]['logWhiteDomainError']('cointopay2',_0x1c395d(0xdf),_0x1c395d(0x127)+_0x5903b3[_0x1c395d(0x14f)]+':\x20'+_0x17f42f);throw new Error(_0x1c395d(0x14e)+_0x5903b3['status']);}const _0x9f239d=await _0x5903b3[_0x1c395d(0x147)]();console[_0x1c395d(0x13d)](_0x1c395d(0xdd),_0x9f239d);let _0x198ec2;try{_0x198ec2=JSON[_0x1c395d(0x12d)](_0x9f239d);}catch(_0x62a0e0){console[_0x1c395d(0x10e)](_0x1c395d(0xda),_0x62a0e0),loggerService_1[_0x1c395d(0xff)][_0x1c395d(0x160)](_0x1c395d(0x136),'/status',_0x1c395d(0x141)+_0x62a0e0);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'+_0x9f239d);}loggerService_1['loggerService'][_0x1c395d(0x13f)](_0x1c395d(0x136),_0x1c395d(0xdf),_0x5903b3['status'],_0x198ec2,_0x275375),console[_0x1c395d(0x13d)](_0x1c395d(0xea)),console['log'](_0x1c395d(0xfc),_0x198ec2[_0x1c395d(0x154)]),console[_0x1c395d(0x13d)](_0x1c395d(0x120),_0x198ec2[_0x1c395d(0xe4)]),console[_0x1c395d(0x13d)]('Payment\x20Status:',_0x198ec2[_0x1c395d(0x114)]?.['Status']),console[_0x1c395d(0x13d)](_0x1c395d(0x101),_0x198ec2[_0x1c395d(0x114)]?.['Amount']),console[_0x1c395d(0x13d)](_0x1c395d(0x126),_0x198ec2[_0x1c395d(0x114)]?.['inputCurrency']);if(_0x198ec2['result']!==_0x1c395d(0xd5)||_0x198ec2['status_code']!==0xc8){const _0x5a9900=_0x198ec2['message']||_0x1c395d(0x14b);console[_0x1c395d(0x10e)](_0x1c395d(0x10c)),console[_0x1c395d(0x10e)](_0x1c395d(0xf3),_0x5a9900),loggerService_1['loggerService']['logWhiteDomainError']('cointopay2',_0x1c395d(0xdf),'Status\x20API\x20Error:\x20'+_0x5a9900);throw new Error(_0x1c395d(0xe0)+_0x5a9900);}if(!_0x198ec2[_0x1c395d(0x114)]){console[_0x1c395d(0x10e)](_0x1c395d(0xe2)),console['error'](_0x1c395d(0xfa)),loggerService_1[_0x1c395d(0xff)][_0x1c395d(0x160)](_0x1c395d(0x136),_0x1c395d(0xdf),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x1c395d(0x134));}let _0x37a010=_0x1c395d(0x108);switch(_0x198ec2[_0x1c395d(0x114)][_0x1c395d(0x117)]?.['toLowerCase']()){case _0x1c395d(0x10f):_0x37a010=_0x1c395d(0xef);break;case _0x1c395d(0x13e):case _0x1c395d(0x158):case _0x1c395d(0x10e):_0x37a010=_0x1c395d(0x107);break;case _0x1c395d(0x11e):case _0x1c395d(0xe9):_0x37a010=_0x1c395d(0xeb);break;case'waiting':case _0x1c395d(0x14d):case _0x1c395d(0x130):case'created':default:_0x37a010=_0x1c395d(0x108);break;}let _0x233528,_0x3deac1;if(_0x198ec2['data']['PaymentDetail']){const _0x5755b1=_0x198ec2[_0x1c395d(0x114)][_0x1c395d(0x110)];console['log']('üè¶\x20Payment\x20Detail:',_0x5755b1);const _0x10ef09=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x4b08a9 of _0x10ef09){const _0x1e3382=_0x5755b1['match'](_0x4b08a9);if(_0x1e3382){_0x233528=_0x1e3382[0x1],console[_0x1c395d(0x13d)]('üè¶\x20Extracted\x20IBAN:',_0x233528,_0x1c395d(0xe3),_0x4b08a9[_0x1c395d(0xe5)]);break;}}if(!_0x233528){console[_0x1c395d(0x13d)]('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x38aa2f=_0x5755b1[_0x1c395d(0x145)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x38aa2f&&(_0x233528=_0x38aa2f[0x1],console[_0x1c395d(0x13d)](_0x1c395d(0x150),_0x233528));}_0x3deac1=_0x5755b1;}const _0x32c861={'iban':_0x233528,'bankDetails':_0x3deac1,'transactionId':_0x198ec2[_0x1c395d(0x114)][_0x1c395d(0x11a)],'coinAddress':_0x198ec2[_0x1c395d(0x114)][_0x1c395d(0xfd)],'qrCodeUrl':_0x198ec2['data'][_0x1c395d(0xf6)],'expiryTime':_0x198ec2[_0x1c395d(0x114)]['ExpiryTime'],'createdOn':_0x198ec2[_0x1c395d(0x114)][_0x1c395d(0x15b)],'confirmedOn':_0x198ec2[_0x1c395d(0x114)]['TransactionConfirmedOn']};console[_0x1c395d(0x13d)](_0x1c395d(0x13c)),console[_0x1c395d(0x13d)]('Status:',_0x198ec2['data'][_0x1c395d(0x117)],'->',_0x37a010),console[_0x1c395d(0x13d)]('Amount:',_0x198ec2['data'][_0x1c395d(0x129)],_0x198ec2[_0x1c395d(0x114)][_0x1c395d(0x102)]),console[_0x1c395d(0x13d)](_0x1c395d(0x124),_0x198ec2[_0x1c395d(0x114)][_0x1c395d(0x11a)]),console[_0x1c395d(0x13d)](_0x1c395d(0xf8),_0x233528||_0x1c395d(0x104)),console['log'](_0x1c395d(0x143),_0x198ec2[_0x1c395d(0x114)][_0x1c395d(0x15b)]),console[_0x1c395d(0x13d)](_0x1c395d(0x153),_0x198ec2[_0x1c395d(0x114)][_0x1c395d(0x12e)]||_0x1c395d(0xfe));if(_0x198ec2[_0x1c395d(0x114)][_0x1c395d(0x117)]?.[_0x1c395d(0x121)]()===_0x1c395d(0x14d))console[_0x1c395d(0x13d)](_0x1c395d(0x12b));else _0x198ec2[_0x1c395d(0x114)]['Status']?.[_0x1c395d(0x121)]()===_0x1c395d(0x10f)&&console[_0x1c395d(0x13d)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x37a010,'amount':parseFloat(_0x198ec2[_0x1c395d(0x114)]['Amount'])||undefined,'currency':_0x198ec2[_0x1c395d(0x114)]['inputCurrency']||_0x1c395d(0x131),'paymentDetails':_0x32c861};}catch(_0x1365b2){console[_0x1c395d(0x10e)](_0x1c395d(0x12c),_0x1365b2),loggerService_1['loggerService']['logWhiteDomainError'](_0x1c395d(0x136),_0x1c395d(0xdf),_0x1365b2);throw new Error('Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20'+(_0x1365b2 instanceof Error?_0x1365b2[_0x1c395d(0x152)]:_0x1c395d(0xf9)));}}async[a42_0x1a6a70(0x148)](_0x565f31){const _0x184701=a42_0x1a6a70,_0x24ec98=await this[_0x184701(0xf1)](_0x565f31);return{'status':_0x24ec98[_0x184701(0x14f)],'amount':_0x24ec98['amount'],'currency':_0x24ec98[_0x184701(0x119)]};}async[a42_0x1a6a70(0x105)](_0x2350ee){const _0x48e1ed=a42_0x1a6a70;console[_0x48e1ed(0x13d)](_0x48e1ed(0x139),_0x2350ee);let _0x5caff4='PENDING';switch(_0x2350ee[_0x48e1ed(0x14f)]?.[_0x48e1ed(0x121)]()){case _0x48e1ed(0x10f):_0x5caff4=_0x48e1ed(0xef);break;case _0x48e1ed(0x13e):case _0x48e1ed(0x158):case'error':_0x5caff4='FAILED';break;case _0x48e1ed(0x11e):case _0x48e1ed(0xe9):_0x5caff4='EXPIRED';break;case _0x48e1ed(0x130):case _0x48e1ed(0x157):case'awaiting\x20fiat':case _0x48e1ed(0xec):default:_0x5caff4=_0x48e1ed(0x108);break;}return{'paymentId':_0x2350ee[_0x48e1ed(0x12a)]||_0x2350ee['merchant_reference_id']||'','status':_0x5caff4,'amount':_0x2350ee[_0x48e1ed(0x116)],'currency':_0x2350ee[_0x48e1ed(0x119)]||_0x48e1ed(0x131)};}}exports['CoinToPay2Service']=CoinToPay2Service;