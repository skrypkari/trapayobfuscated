'use strict';const a42_0x3d479a=a42_0x2fa3;(function(_0x372b54,_0x4a64d9){const _0x2fe982=a42_0x2fa3,_0x533fca=_0x372b54();while(!![]){try{const _0x2fee3f=parseInt(_0x2fe982(0x94))/0x1*(-parseInt(_0x2fe982(0xe1))/0x2)+parseInt(_0x2fe982(0xd5))/0x3+-parseInt(_0x2fe982(0xec))/0x4*(parseInt(_0x2fe982(0x93))/0x5)+parseInt(_0x2fe982(0x104))/0x6*(parseInt(_0x2fe982(0x99))/0x7)+-parseInt(_0x2fe982(0x100))/0x8*(parseInt(_0x2fe982(0xf2))/0x9)+-parseInt(_0x2fe982(0xac))/0xa*(-parseInt(_0x2fe982(0xc1))/0xb)+-parseInt(_0x2fe982(0xa5))/0xc;if(_0x2fee3f===_0x4a64d9)break;else _0x533fca['push'](_0x533fca['shift']());}catch(_0x593c5e){_0x533fca['push'](_0x533fca['shift']());}}}(a42_0x2217,0xb623c));Object[a42_0x3d479a(0x103)](exports,a42_0x3d479a(0x91),{'value':!![]}),exports[a42_0x3d479a(0xb9)]=void 0x0;const loggerService_1=require(a42_0x3d479a(0xa7));class CoinToPay2Service{constructor(){const _0x493794=a42_0x3d479a;this[_0x493794(0xa8)]=_0x493794(0xd3),this[_0x493794(0xca)]='https://traffer.uk/gateway/cointopay/status.php',console[_0x493794(0x110)](_0x493794(0xd1)),console[_0x493794(0x110)]('üìä\x20Status\x20check\x20URL:',this[_0x493794(0xca)]);}async[a42_0x3d479a(0x9b)](_0x2589c3){const _0x43c28e=a42_0x3d479a,{orderId:_0x293c8a,amount:_0x9efb31}=_0x2589c3;console[_0x43c28e(0x110)](_0x43c28e(0xd6)+_0x9efb31+_0x43c28e(0x10b));const _0x1a40e7={'amount':_0x9efb31},_0x5d5b5d=Date['now']();try{console[_0x43c28e(0x110)](_0x43c28e(0xf1)),console[_0x43c28e(0x110)](_0x43c28e(0xe0),this[_0x43c28e(0xa8)]),console[_0x43c28e(0x110)]('Request\x20Body:',JSON[_0x43c28e(0xb7)](_0x1a40e7,null,0x2)),console[_0x43c28e(0x110)](_0x43c28e(0x10e),_0x9efb31,_0x43c28e(0x115)),loggerService_1[_0x43c28e(0xef)][_0x43c28e(0xd4)](_0x43c28e(0xe2),_0x43c28e(0x9e),_0x43c28e(0x113),_0x1a40e7);const _0x383c39=await fetch(this[_0x43c28e(0xa8)],{'method':'POST','headers':{'Content-Type':_0x43c28e(0xe8),'Accept':_0x43c28e(0xe8),'User-Agent':_0x43c28e(0x111)},'body':JSON[_0x43c28e(0xb7)](_0x1a40e7)}),_0x2c8703=Date['now']()-_0x5d5b5d;console[_0x43c28e(0x110)]('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console[_0x43c28e(0x110)](_0x43c28e(0xb5),_0x383c39[_0x43c28e(0xfa)]),console[_0x43c28e(0x110)]('Status\x20Text:',_0x383c39['statusText']),console['log']('Headers:',Object[_0x43c28e(0xc2)](_0x383c39[_0x43c28e(0x105)][_0x43c28e(0xd0)]())),console[_0x43c28e(0x110)]('Response\x20Time:',_0x2c8703+'ms');const _0x5a6b2b=await _0x383c39[_0x43c28e(0xc7)]();console['log'](_0x43c28e(0xd2),_0x5a6b2b);if(!_0x383c39['ok']){console[_0x43c28e(0xdb)](_0x43c28e(0x9c)),console[_0x43c28e(0xdb)](_0x43c28e(0x109),_0x383c39[_0x43c28e(0xfa)]),console['error'](_0x43c28e(0xbe),_0x5a6b2b),loggerService_1[_0x43c28e(0xef)]['logWhiteDomainResponse'](_0x43c28e(0xe2),_0x43c28e(0x9e),_0x383c39[_0x43c28e(0xfa)],_0x5a6b2b,_0x2c8703),loggerService_1['loggerService'][_0x43c28e(0x9f)](_0x43c28e(0xe2),_0x43c28e(0x9e),_0x43c28e(0xb6)+_0x383c39[_0x43c28e(0xfa)]+':\x20'+_0x5a6b2b);throw new Error(_0x43c28e(0xee)+_0x383c39[_0x43c28e(0xfa)]+_0x43c28e(0x9a)+_0x5a6b2b);}let _0xad7493;try{_0xad7493=JSON['parse'](_0x5a6b2b);}catch(_0x20d9dd){console['error'](_0x43c28e(0xba),_0x20d9dd),loggerService_1['loggerService']['logWhiteDomainError'](_0x43c28e(0xe2),_0x43c28e(0x9e),_0x43c28e(0xf6)+_0x20d9dd);throw new Error(_0x43c28e(0xae)+_0x5a6b2b);}console[_0x43c28e(0x110)](_0x43c28e(0xb4)),console[_0x43c28e(0x110)](_0x43c28e(0xb3),JSON[_0x43c28e(0xb7)](_0xad7493,null,0x2)),loggerService_1[_0x43c28e(0xef)][_0x43c28e(0x114)](_0x43c28e(0xe2),_0x43c28e(0x9e),_0x383c39[_0x43c28e(0xfa)],_0xad7493,_0x2c8703);if(_0xad7493[_0x43c28e(0xdb)]){const _0x445dff=_0xad7493[_0x43c28e(0xd7)]||_0xad7493[_0x43c28e(0xdb)]||_0x43c28e(0xed);console[_0x43c28e(0xdb)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x43c28e(0xdb)](_0x43c28e(0x97),_0x445dff),loggerService_1[_0x43c28e(0xef)][_0x43c28e(0x9f)](_0x43c28e(0xe2),_0x43c28e(0x9e),'Business\x20Error:\x20'+_0x445dff);throw new Error(_0x43c28e(0xda)+_0x445dff);}if(!_0xad7493['payment_url']||!_0xad7493[_0x43c28e(0xeb)]){console[_0x43c28e(0xdb)](_0x43c28e(0xc3)),console['error'](_0x43c28e(0x10d)),console[_0x43c28e(0xdb)](_0x43c28e(0x108),_0xad7493),loggerService_1[_0x43c28e(0xef)][_0x43c28e(0x9f)](_0x43c28e(0xe2),_0x43c28e(0x9e),_0x43c28e(0xfb));throw new Error(_0x43c28e(0xc4));}return console['log'](_0x43c28e(0x10c)),console['log']('Gateway\x20Payment\x20ID:',_0xad7493['gateway_payment_id']),console['log'](_0x43c28e(0xaa),_0xad7493[_0x43c28e(0xbc)]),console[_0x43c28e(0x110)](_0x43c28e(0x10e),_0x9efb31,_0x43c28e(0xce)),{'gateway_payment_id':_0xad7493['gateway_payment_id'],'payment_url':_0xad7493[_0x43c28e(0xbc)]};}catch(_0x242154){console[_0x43c28e(0xdb)](_0x43c28e(0xcc)),console['error']('Error\x20details:',_0x242154),loggerService_1[_0x43c28e(0xef)][_0x43c28e(0x9f)](_0x43c28e(0xe2),_0x43c28e(0x9e),_0x242154);if(_0x242154 instanceof Error){console[_0x43c28e(0xdb)](_0x43c28e(0x116),_0x242154[_0x43c28e(0xd7)]),console[_0x43c28e(0xdb)](_0x43c28e(0x98),_0x242154[_0x43c28e(0x102)]);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x242154[_0x43c28e(0xd7)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x12798f){const _0x59983a=a42_0x3d479a,_0x45f9bd=Date['now']();try{console[_0x59983a(0x110)](_0x59983a(0xfc)+_0x12798f);const _0x2d41f2={'gatewayPaymentId':_0x12798f};loggerService_1[_0x59983a(0xef)][_0x59983a(0xd4)]('cointopay2',_0x59983a(0xb1),_0x59983a(0x113),_0x2d41f2);const _0x4b8ddb=await fetch(this[_0x59983a(0xca)],{'method':_0x59983a(0x113),'headers':{'Content-Type':'application/json','Accept':_0x59983a(0xe8),'User-Agent':_0x59983a(0x111)},'body':JSON['stringify'](_0x2d41f2)}),_0x3b000=Date['now']()-_0x45f9bd;console[_0x59983a(0x110)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x59983a(0x110)](_0x59983a(0xb5),_0x4b8ddb[_0x59983a(0xfa)]),console['log'](_0x59983a(0xa3),_0x3b000+'ms');if(!_0x4b8ddb['ok']){const _0x22ddce=await _0x4b8ddb[_0x59983a(0xc7)]();console['error'](_0x59983a(0x109),_0x4b8ddb[_0x59983a(0xfa)]),console['error']('Response\x20Body:',_0x22ddce),loggerService_1[_0x59983a(0xef)]['logWhiteDomainResponse'](_0x59983a(0xe2),'/status',_0x4b8ddb[_0x59983a(0xfa)],_0x22ddce,_0x3b000),loggerService_1[_0x59983a(0xef)][_0x59983a(0x9f)](_0x59983a(0xe2),_0x59983a(0xb1),_0x59983a(0xb6)+_0x4b8ddb[_0x59983a(0xfa)]+':\x20'+_0x22ddce);throw new Error(_0x59983a(0xee)+_0x4b8ddb['status']);}const _0x14fe37=await _0x4b8ddb[_0x59983a(0xc7)]();console[_0x59983a(0x110)]('Raw\x20Response\x20Body:',_0x14fe37);let _0x20b0f6;try{_0x20b0f6=JSON[_0x59983a(0xbd)](_0x14fe37);}catch(_0x4d1a00){console[_0x59983a(0xdb)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x4d1a00),loggerService_1[_0x59983a(0xef)][_0x59983a(0x9f)](_0x59983a(0xe2),_0x59983a(0xb1),'JSON\x20Parse\x20Error:\x20'+_0x4d1a00);throw new Error(_0x59983a(0xf5)+_0x14fe37);}loggerService_1['loggerService'][_0x59983a(0x114)](_0x59983a(0xe2),_0x59983a(0xb1),_0x4b8ddb[_0x59983a(0xfa)],_0x20b0f6,_0x3b000),console[_0x59983a(0x110)](_0x59983a(0x106)),console[_0x59983a(0x110)](_0x59983a(0xad),_0x20b0f6[_0x59983a(0xab)]),console[_0x59983a(0x110)]('Status\x20Code:',_0x20b0f6[_0x59983a(0xf9)]),console[_0x59983a(0x110)](_0x59983a(0x10a),_0x20b0f6['data']?.[_0x59983a(0xa9)]),console[_0x59983a(0x110)]('Amount:',_0x20b0f6[_0x59983a(0xb0)]?.['Amount']),console[_0x59983a(0x110)](_0x59983a(0x117),_0x20b0f6[_0x59983a(0xb0)]?.['inputCurrency']);if(_0x20b0f6['result']!==_0x59983a(0xa6)||_0x20b0f6[_0x59983a(0xf9)]!==0xc8){const _0x3b9907=_0x20b0f6[_0x59983a(0xd7)]||_0x59983a(0xa0);console[_0x59983a(0xdb)](_0x59983a(0xd9)),console[_0x59983a(0xdb)](_0x59983a(0x97),_0x3b9907),loggerService_1[_0x59983a(0xef)][_0x59983a(0x9f)](_0x59983a(0xe2),_0x59983a(0xb1),_0x59983a(0x9d)+_0x3b9907);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0x3b9907);}if(!_0x20b0f6['data']){console[_0x59983a(0xdb)]('===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x59983a(0xde)),loggerService_1[_0x59983a(0xef)]['logWhiteDomainError'](_0x59983a(0xe2),_0x59983a(0xb1),_0x59983a(0xb8));throw new Error(_0x59983a(0xe3));}let _0xc06722=_0x59983a(0xb2);switch(_0x20b0f6[_0x59983a(0xb0)]['Status']?.[_0x59983a(0xf3)]()){case _0x59983a(0xf8):_0xc06722=_0x59983a(0xa4);break;case _0x59983a(0xe6):case _0x59983a(0x101):case _0x59983a(0xdb):_0xc06722=_0x59983a(0xdc);break;case'expired':case'timeout':_0xc06722=_0x59983a(0xff);break;case'waiting':case _0x59983a(0xc6):case _0x59983a(0xe4):case _0x59983a(0x96):default:_0xc06722=_0x59983a(0xb2);break;}let _0x7d8e84,_0x478c3d;if(_0x20b0f6['data'][_0x59983a(0xe7)]){const _0x5dbb20=_0x20b0f6[_0x59983a(0xb0)][_0x59983a(0xe7)];console['log'](_0x59983a(0x10f),_0x5dbb20);const _0x7259f5=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x3c6066 of _0x7259f5){const _0x1728d1=_0x5dbb20[_0x59983a(0xaf)](_0x3c6066);if(_0x1728d1){_0x7d8e84=_0x1728d1[0x1],console[_0x59983a(0x110)](_0x59983a(0xfe),_0x7d8e84,_0x59983a(0xbb),_0x3c6066[_0x59983a(0xc8)]);break;}}if(!_0x7d8e84){console[_0x59983a(0x110)]('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x9a8ff=_0x5dbb20[_0x59983a(0xaf)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x9a8ff&&(_0x7d8e84=_0x9a8ff[0x1],console[_0x59983a(0x110)](_0x59983a(0xdd),_0x7d8e84));}_0x478c3d=_0x5dbb20;}const _0xda06f={'iban':_0x7d8e84,'bankDetails':_0x478c3d,'transactionId':_0x20b0f6['data']['TransactionID'],'coinAddress':_0x20b0f6[_0x59983a(0xb0)]['coinAddress'],'qrCodeUrl':_0x20b0f6[_0x59983a(0xb0)]['QRCodeURL'],'expiryTime':_0x20b0f6[_0x59983a(0xb0)][_0x59983a(0xd8)],'createdOn':_0x20b0f6[_0x59983a(0xb0)][_0x59983a(0xcd)],'confirmedOn':_0x20b0f6[_0x59983a(0xb0)][_0x59983a(0xa2)]};console[_0x59983a(0x110)]('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console[_0x59983a(0x110)](_0x59983a(0xb5),_0x20b0f6['data']['Status'],'->',_0xc06722),console['log'](_0x59983a(0x10e),_0x20b0f6['data'][_0x59983a(0x95)],_0x20b0f6[_0x59983a(0xb0)][_0x59983a(0x92)]),console[_0x59983a(0x110)]('Transaction\x20ID:',_0x20b0f6[_0x59983a(0xb0)][_0x59983a(0xcb)]),console[_0x59983a(0x110)]('IBAN:',_0x7d8e84||_0x59983a(0xc0)),console[_0x59983a(0x110)]('Created\x20On:',_0x20b0f6[_0x59983a(0xb0)][_0x59983a(0xcd)]),console[_0x59983a(0x110)](_0x59983a(0xdf),_0x20b0f6['data'][_0x59983a(0xa2)]||_0x59983a(0xfd));if(_0x20b0f6[_0x59983a(0xb0)]['Status']?.[_0x59983a(0xf3)]()===_0x59983a(0xc6))console[_0x59983a(0x110)](_0x59983a(0xf4));else _0x20b0f6[_0x59983a(0xb0)][_0x59983a(0xa9)]?.[_0x59983a(0xf3)]()===_0x59983a(0xf8)&&console[_0x59983a(0x110)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0xc06722,'amount':parseFloat(_0x20b0f6[_0x59983a(0xb0)]['Amount'])||undefined,'currency':_0x20b0f6[_0x59983a(0xb0)][_0x59983a(0x92)]||_0x59983a(0xce),'paymentDetails':_0xda06f};}catch(_0x20f4db){console[_0x59983a(0xdb)](_0x59983a(0x107),_0x20f4db),loggerService_1[_0x59983a(0xef)][_0x59983a(0x9f)](_0x59983a(0xe2),_0x59983a(0xb1),_0x20f4db);throw new Error(_0x59983a(0xf0)+(_0x20f4db instanceof Error?_0x20f4db[_0x59983a(0xd7)]:_0x59983a(0xa1)));}}async['verifyPayment'](_0x371cde){const _0x5bf4df=a42_0x3d479a,_0x5c24f2=await this['checkPaymentStatus'](_0x371cde);return{'status':_0x5c24f2['status'],'amount':_0x5c24f2['amount'],'currency':_0x5c24f2[_0x5bf4df(0xbf)]};}async[a42_0x3d479a(0xc5)](_0x1ab49c){const _0x22bc6b=a42_0x3d479a;console[_0x22bc6b(0x110)](_0x22bc6b(0xc9),_0x1ab49c);let _0xc36ff9=_0x22bc6b(0xb2);switch(_0x1ab49c[_0x22bc6b(0xfa)]?.['toLowerCase']()){case _0x22bc6b(0xf8):_0xc36ff9=_0x22bc6b(0xa4);break;case _0x22bc6b(0xe6):case _0x22bc6b(0x101):case'error':_0xc36ff9=_0x22bc6b(0xdc);break;case _0x22bc6b(0xea):case _0x22bc6b(0xcf):_0xc36ff9=_0x22bc6b(0xff);break;case _0x22bc6b(0xe4):case _0x22bc6b(0xf7):case _0x22bc6b(0xc6):case _0x22bc6b(0x96):default:_0xc36ff9='PENDING';break;}return{'paymentId':_0x1ab49c[_0x22bc6b(0xe5)]||_0x1ab49c[_0x22bc6b(0x112)]||'','status':_0xc36ff9,'amount':_0x1ab49c[_0x22bc6b(0xe9)],'currency':_0x1ab49c[_0x22bc6b(0xbf)]||_0x22bc6b(0xce)};}}function a42_0x2fa3(_0x5b46eb,_0x3830b2){const _0x2217b9=a42_0x2217();return a42_0x2fa3=function(_0x2fa3b9,_0x106c25){_0x2fa3b9=_0x2fa3b9-0x91;let _0x73cf08=_0x2217b9[_0x2fa3b9];return _0x73cf08;},a42_0x2fa3(_0x5b46eb,_0x3830b2);}function a42_0x2217(){const _0x295c06=['using\x20pattern:','payment_url','parse','Response\x20Body:','currency','not\x20found','6116ROSmpc','fromEntries','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','processWebhook','awaiting\x20fiat','text','source','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','statusUrl','TransactionID','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','CreatedOn','EUR','timeout','entries','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','Raw\x20Response\x20Body:','https://traffer.uk/gateway/cointopay/','logWhiteDomainRequest','1223103ZefvZG','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','message','ExpiryTime','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','CoinToPay2\x20API\x20error:\x20','error','FAILED','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','Missing\x20data\x20in\x20response','Confirmed\x20On:','URL:','5954qcCBEv','cointopay2','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','pending','order_id','cancelled','PaymentDetail','application/json','amount','expired','gateway_payment_id','1312hriKtJ','Unknown\x20error\x20from\x20CoinToPay2\x20API','HTTP\x20error!\x20status:\x20','loggerService','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','30123MfyMRR','toLowerCase','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','JSON\x20Parse\x20Error:\x20','waiting','paid','status_code','status','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','not\x20confirmed','üè¶\x20Extracted\x20IBAN:','EXPIRED','272gupLol','failed','stack','defineProperty','858uEFCWi','headers','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','CoinToPay2\x20payment\x20status\x20check\x20error:','Response\x20data:','HTTP\x20Status:','Payment\x20Status:','\x20EUR','===\x20COINTOPAY2\x20SUCCESS\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Amount:','üè¶\x20Payment\x20Detail:','log','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','merchant_reference_id','POST','logWhiteDomainResponse','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','Error\x20message:','Currency:','__esModule','inputCurrency','4010yMgvrV','101tPEUxG','Amount','created','Error\x20Message:','Error\x20stack:','51317hJUSSe',',\x20body:\x20','createPaymentLink','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Status\x20API\x20Error:\x20','/create','logWhiteDomainError','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Unknown\x20error','TransactionConfirmedOn','Response\x20Time:','PAID','4426068cchild','success','../loggerService','apiUrl','Status','Payment\x20URL:','result','6050QmzAur','Result:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','match','data','/status','PENDING','Parsed\x20Result:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','Status:','HTTP\x20','stringify','Incomplete\x20response:\x20missing\x20data','CoinToPay2Service','Failed\x20to\x20parse\x20JSON\x20response:'];a42_0x2217=function(){return _0x295c06;};return a42_0x2217();}exports[a42_0x3d479a(0xb9)]=CoinToPay2Service;