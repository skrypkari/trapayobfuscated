'use strict';const a40_0x3d3c0e=a40_0x4376;(function(_0x467566,_0x48e511){const _0x1d55b1=a40_0x4376,_0x5ed9ce=_0x467566();while(!![]){try{const _0x4f7ba2=-parseInt(_0x1d55b1(0x80))/0x1*(-parseInt(_0x1d55b1(0xbc))/0x2)+parseInt(_0x1d55b1(0xc1))/0x3*(parseInt(_0x1d55b1(0xd4))/0x4)+-parseInt(_0x1d55b1(0xb0))/0x5+-parseInt(_0x1d55b1(0xf2))/0x6+-parseInt(_0x1d55b1(0xbe))/0x7*(-parseInt(_0x1d55b1(0xbb))/0x8)+parseInt(_0x1d55b1(0xeb))/0x9*(parseInt(_0x1d55b1(0xc6))/0xa)+-parseInt(_0x1d55b1(0xd5))/0xb;if(_0x4f7ba2===_0x48e511)break;else _0x5ed9ce['push'](_0x5ed9ce['shift']());}catch(_0x4111f4){_0x5ed9ce['push'](_0x5ed9ce['shift']());}}}(a40_0xd69c,0xb88c3));Object[a40_0x3d3c0e(0xf9)](exports,a40_0x3d3c0e(0xc4),{'value':!![]}),exports[a40_0x3d3c0e(0x9d)]=void 0x0;const loggerService_1=require(a40_0x3d3c0e(0xb2));class CoinToPay2Service{constructor(){const _0x38a6a5=a40_0x3d3c0e;this[_0x38a6a5(0x9a)]=_0x38a6a5(0xdb),this['statusUrl']='https://traffer.uk/gateway/cointopay/status.php',console[_0x38a6a5(0xda)](_0x38a6a5(0xcf)),console[_0x38a6a5(0xda)](_0x38a6a5(0xb4),this[_0x38a6a5(0xbd)]);}async[a40_0x3d3c0e(0x7e)](_0xfb53b7){const _0x529c07=a40_0x3d3c0e,{orderId:_0x3cd1f8,amount:_0x443c70}=_0xfb53b7;console['log'](_0x529c07(0x94)+_0x443c70+_0x529c07(0x100));const _0x18828b={'amount':_0x443c70},_0x12ebdb=Date[_0x529c07(0x7d)]();try{console[_0x529c07(0xda)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console[_0x529c07(0xda)](_0x529c07(0xe7),this[_0x529c07(0x9a)]),console[_0x529c07(0xda)]('Request\x20Body:',JSON['stringify'](_0x18828b,null,0x2)),console['log'](_0x529c07(0xaf),_0x443c70,_0x529c07(0x7f)),loggerService_1[_0x529c07(0xc3)]['logWhiteDomainRequest'](_0x529c07(0xd2),'/create',_0x529c07(0xac),_0x18828b);const _0x22850b=await fetch(this[_0x529c07(0x9a)],{'method':_0x529c07(0xac),'headers':{'Content-Type':_0x529c07(0xed),'Accept':_0x529c07(0xed),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x529c07(0xf6)](_0x18828b)}),_0x2ae989=Date[_0x529c07(0x7d)]()-_0x12ebdb;console[_0x529c07(0xda)]('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console[_0x529c07(0xda)]('Status:',_0x22850b[_0x529c07(0xe3)]),console['log'](_0x529c07(0x8f),_0x22850b[_0x529c07(0x82)]),console[_0x529c07(0xda)]('Headers:',Object[_0x529c07(0xc8)](_0x22850b[_0x529c07(0xf0)][_0x529c07(0xde)]())),console['log'](_0x529c07(0x84),_0x2ae989+'ms');const _0x34a838=await _0x22850b[_0x529c07(0xa3)]();console[_0x529c07(0xda)]('Raw\x20Response\x20Body:',_0x34a838);if(!_0x22850b['ok']){console[_0x529c07(0xb9)](_0x529c07(0x9f)),console[_0x529c07(0xb9)](_0x529c07(0xa9),_0x22850b[_0x529c07(0xe3)]),console['error'](_0x529c07(0x9b),_0x34a838),loggerService_1[_0x529c07(0xc3)][_0x529c07(0xfd)]('cointopay2',_0x529c07(0xff),_0x22850b['status'],_0x34a838,_0x2ae989),loggerService_1[_0x529c07(0xc3)]['logWhiteDomainError'](_0x529c07(0xd2),'/create',_0x529c07(0xa8)+_0x22850b['status']+':\x20'+_0x34a838);throw new Error('HTTP\x20error!\x20status:\x20'+_0x22850b['status']+_0x529c07(0xc9)+_0x34a838);}let _0x59fa24;try{_0x59fa24=JSON[_0x529c07(0xe0)](_0x34a838);}catch(_0x58ae00){console[_0x529c07(0xb9)](_0x529c07(0xf4),_0x58ae00),loggerService_1[_0x529c07(0xc3)][_0x529c07(0x8a)]('cointopay2',_0x529c07(0xff),'JSON\x20Parse\x20Error:\x20'+_0x58ae00);throw new Error(_0x529c07(0x81)+_0x34a838);}console[_0x529c07(0xda)](_0x529c07(0xe1)),console[_0x529c07(0xda)]('Parsed\x20Result:',JSON[_0x529c07(0xf6)](_0x59fa24,null,0x2)),loggerService_1[_0x529c07(0xc3)][_0x529c07(0xfd)](_0x529c07(0xd2),_0x529c07(0xff),_0x22850b['status'],_0x59fa24,_0x2ae989);if(_0x59fa24[_0x529c07(0xb9)]){const _0x47c981=_0x59fa24['message']||_0x59fa24['error']||_0x529c07(0xc5);console['error'](_0x529c07(0x92)),console[_0x529c07(0xb9)]('Error\x20Message:',_0x47c981),loggerService_1[_0x529c07(0xc3)][_0x529c07(0x8a)]('cointopay2',_0x529c07(0xff),_0x529c07(0xa7)+_0x47c981);throw new Error(_0x529c07(0xe8)+_0x47c981);}if(!_0x59fa24[_0x529c07(0x96)]||!_0x59fa24[_0x529c07(0x87)]){console['error'](_0x529c07(0xa5)),console[_0x529c07(0xb9)](_0x529c07(0xe4)),console[_0x529c07(0xb9)](_0x529c07(0xba),_0x59fa24),loggerService_1[_0x529c07(0xc3)]['logWhiteDomainError'](_0x529c07(0xd2),_0x529c07(0xff),_0x529c07(0xfb));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x529c07(0xda)](_0x529c07(0xb5)),console['log'](_0x529c07(0xd7),_0x59fa24[_0x529c07(0x87)]),console[_0x529c07(0xda)](_0x529c07(0xa2),_0x59fa24[_0x529c07(0x96)]),console[_0x529c07(0xda)]('Amount:',_0x443c70,'EUR'),{'gateway_payment_id':_0x59fa24[_0x529c07(0x87)],'payment_url':_0x59fa24['payment_url']};}catch(_0xac2bd6){console[_0x529c07(0xb9)](_0x529c07(0xc2)),console[_0x529c07(0xb9)](_0x529c07(0xec),_0xac2bd6),loggerService_1[_0x529c07(0xc3)][_0x529c07(0x8a)](_0x529c07(0xd2),_0x529c07(0xff),_0xac2bd6);if(_0xac2bd6 instanceof Error){console['error'](_0x529c07(0xdc),_0xac2bd6[_0x529c07(0xc7)]),console['error'](_0x529c07(0x88),_0xac2bd6[_0x529c07(0xaa)]);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0xac2bd6[_0x529c07(0xc7)]);}throw new Error(_0x529c07(0x83));}}async[a40_0x3d3c0e(0xcd)](_0x167d87){const _0x226483=a40_0x3d3c0e,_0x582321=Date['now']();try{console[_0x226483(0xda)](_0x226483(0xa0)+_0x167d87);const _0x343467={'gatewayPaymentId':_0x167d87};loggerService_1[_0x226483(0xc3)][_0x226483(0xf7)](_0x226483(0xd2),_0x226483(0x89),_0x226483(0xac),_0x343467);const _0x4f7f4d=await fetch(this[_0x226483(0xbd)],{'method':'POST','headers':{'Content-Type':_0x226483(0xed),'Accept':_0x226483(0xed),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x226483(0xf6)](_0x343467)}),_0x41cc57=Date['now']()-_0x582321;console[_0x226483(0xda)](_0x226483(0xd8)),console[_0x226483(0xda)](_0x226483(0x7c),_0x4f7f4d[_0x226483(0xe3)]),console[_0x226483(0xda)]('Response\x20Time:',_0x41cc57+'ms');if(!_0x4f7f4d['ok']){const _0x2aa78a=await _0x4f7f4d[_0x226483(0xa3)]();console[_0x226483(0xb9)]('HTTP\x20Status:',_0x4f7f4d['status']),console[_0x226483(0xb9)](_0x226483(0x9b),_0x2aa78a),loggerService_1[_0x226483(0xc3)][_0x226483(0xfd)](_0x226483(0xd2),'/status',_0x4f7f4d['status'],_0x2aa78a,_0x41cc57),loggerService_1[_0x226483(0xc3)][_0x226483(0x8a)](_0x226483(0xd2),_0x226483(0x89),_0x226483(0xa8)+_0x4f7f4d['status']+':\x20'+_0x2aa78a);throw new Error(_0x226483(0xfa)+_0x4f7f4d[_0x226483(0xe3)]);}const _0xafc268=await _0x4f7f4d[_0x226483(0xa3)]();console[_0x226483(0xda)](_0x226483(0xcb),_0xafc268);let _0x383534;try{_0x383534=JSON[_0x226483(0xe0)](_0xafc268);}catch(_0x1824a3){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x1824a3),loggerService_1[_0x226483(0xc3)][_0x226483(0x8a)](_0x226483(0xd2),_0x226483(0x89),_0x226483(0x90)+_0x1824a3);throw new Error(_0x226483(0xf1)+_0xafc268);}loggerService_1['loggerService'][_0x226483(0xfd)](_0x226483(0xd2),'/status',_0x4f7f4d['status'],_0x383534,_0x41cc57),console[_0x226483(0xda)](_0x226483(0x99)),console[_0x226483(0xda)](_0x226483(0xcc),_0x383534['result']),console[_0x226483(0xda)](_0x226483(0x8d),_0x383534[_0x226483(0xa6)]),console['log'](_0x226483(0xf8),_0x383534[_0x226483(0x8b)]?.[_0x226483(0xee)]),console[_0x226483(0xda)](_0x226483(0xaf),_0x383534[_0x226483(0x8b)]?.[_0x226483(0xe6)]),console['log']('Currency:',_0x383534[_0x226483(0x8b)]?.['inputCurrency']);if(_0x383534['result']!==_0x226483(0xd3)||_0x383534[_0x226483(0xa6)]!==0xc8){const _0x158157=_0x383534[_0x226483(0xc7)]||_0x226483(0x8c);console['error']('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console[_0x226483(0xb9)]('Error\x20Message:',_0x158157),loggerService_1[_0x226483(0xc3)]['logWhiteDomainError'](_0x226483(0xd2),'/status',_0x226483(0xf5)+_0x158157);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0x158157);}if(!_0x383534[_0x226483(0x8b)]){console['error']('===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x226483(0xad)),loggerService_1[_0x226483(0xc3)][_0x226483(0x8a)]('cointopay2',_0x226483(0x89),'Incomplete\x20response:\x20missing\x20data');throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x13c871=_0x226483(0x95);switch(_0x383534[_0x226483(0x8b)][_0x226483(0xee)]?.[_0x226483(0xb6)]()){case'paid':_0x13c871='PAID';break;case'cancelled':case _0x226483(0x85):case _0x226483(0xb9):_0x13c871=_0x226483(0x9e);break;case _0x226483(0xe9):case _0x226483(0xdf):_0x13c871=_0x226483(0xd0);break;case _0x226483(0x9c):case _0x226483(0xd1):case _0x226483(0xd6):case'created':default:_0x13c871=_0x226483(0x95);break;}let _0x3df48d,_0x3ad985;if(_0x383534[_0x226483(0x8b)][_0x226483(0xae)]){const _0x491320=_0x383534[_0x226483(0x8b)][_0x226483(0xae)];console[_0x226483(0xda)](_0x226483(0x91),_0x491320);const _0x51371d=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x575278 of _0x51371d){const _0x209346=_0x491320['match'](_0x575278);if(_0x209346){_0x3df48d=_0x209346[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0x3df48d,'using\x20pattern:',_0x575278[_0x226483(0xa4)]);break;}}if(!_0x3df48d){console['log']('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x4dbfb9=_0x491320[_0x226483(0xca)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x4dbfb9&&(_0x3df48d=_0x4dbfb9[0x1],console[_0x226483(0xda)](_0x226483(0xd9),_0x3df48d));}_0x3ad985=_0x491320;}const _0x224a1d={'iban':_0x3df48d,'bankDetails':_0x3ad985,'transactionId':_0x383534['data'][_0x226483(0x8e)],'coinAddress':_0x383534[_0x226483(0x8b)][_0x226483(0xc0)],'qrCodeUrl':_0x383534[_0x226483(0x8b)]['QRCodeURL'],'expiryTime':_0x383534['data'][_0x226483(0x93)],'createdOn':_0x383534[_0x226483(0x8b)][_0x226483(0xb7)],'confirmedOn':_0x383534['data'][_0x226483(0xfe)]};console[_0x226483(0xda)]('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console[_0x226483(0xda)]('Status:',_0x383534[_0x226483(0x8b)][_0x226483(0xee)],'->',_0x13c871),console[_0x226483(0xda)](_0x226483(0xaf),_0x383534[_0x226483(0x8b)][_0x226483(0xe6)],_0x383534[_0x226483(0x8b)][_0x226483(0x98)]),console[_0x226483(0xda)]('Transaction\x20ID:',_0x383534[_0x226483(0x8b)][_0x226483(0x8e)]),console[_0x226483(0xda)](_0x226483(0xbf),_0x3df48d||'not\x20found'),console['log']('Created\x20On:',_0x383534[_0x226483(0x8b)][_0x226483(0xb7)]),console['log'](_0x226483(0xb1),_0x383534['data'][_0x226483(0xfe)]||'not\x20confirmed');if(_0x383534[_0x226483(0x8b)][_0x226483(0xee)]?.[_0x226483(0xb6)]()===_0x226483(0xd1))console[_0x226483(0xda)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x383534[_0x226483(0x8b)][_0x226483(0xee)]?.[_0x226483(0xb6)]()===_0x226483(0xab)&&console[_0x226483(0xda)](_0x226483(0xef));return{'status':_0x13c871,'amount':parseFloat(_0x383534['data'][_0x226483(0xe6)])||undefined,'currency':_0x383534[_0x226483(0x8b)]['inputCurrency']||_0x226483(0xea),'paymentDetails':_0x224a1d};}catch(_0x1a4737){console[_0x226483(0xb9)](_0x226483(0xce),_0x1a4737),loggerService_1[_0x226483(0xc3)]['logWhiteDomainError'](_0x226483(0xd2),'/status',_0x1a4737);throw new Error(_0x226483(0x97)+(_0x1a4737 instanceof Error?_0x1a4737[_0x226483(0xc7)]:_0x226483(0xa1)));}}async[a40_0x3d3c0e(0xfc)](_0x17a78f){const _0x4d992f=a40_0x3d3c0e,_0x320d28=await this[_0x4d992f(0xcd)](_0x17a78f);return{'status':_0x320d28[_0x4d992f(0xe3)],'amount':_0x320d28[_0x4d992f(0x86)],'currency':_0x320d28[_0x4d992f(0xb8)]};}async[a40_0x3d3c0e(0xdd)](_0xcc9b39){const _0x5516a3=a40_0x3d3c0e;console[_0x5516a3(0xda)](_0x5516a3(0xf3),_0xcc9b39);let _0xc75758=_0x5516a3(0x95);switch(_0xcc9b39[_0x5516a3(0xe3)]?.[_0x5516a3(0xb6)]()){case _0x5516a3(0xab):_0xc75758=_0x5516a3(0xb3);break;case'cancelled':case _0x5516a3(0x85):case'error':_0xc75758=_0x5516a3(0x9e);break;case'expired':case _0x5516a3(0xdf):_0xc75758=_0x5516a3(0xd0);break;case _0x5516a3(0xd6):case _0x5516a3(0x9c):case'awaiting\x20fiat':case'created':default:_0xc75758=_0x5516a3(0x95);break;}return{'paymentId':_0xcc9b39[_0x5516a3(0xe2)]||_0xcc9b39[_0x5516a3(0xe5)]||'','status':_0xc75758,'amount':_0xcc9b39['amount'],'currency':_0xcc9b39[_0x5516a3(0xb8)]||'EUR'};}}function a40_0xd69c(){const _0xdd080f=['HTTP\x20error!\x20status:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','verifyPayment','logWhiteDomainResponse','TransactionConfirmedOn','/create','\x20EUR','Status:','now','createPaymentLink','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','1LfcANj','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','statusText','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','Response\x20Time:','failed','amount','gateway_payment_id','Error\x20stack:','/status','logWhiteDomainError','data','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Status\x20Code:','TransactionID','Status\x20Text:','JSON\x20Parse\x20Error:\x20','üè¶\x20Payment\x20Detail:','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','ExpiryTime','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','PENDING','payment_url','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','inputCurrency','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','apiUrl','Response\x20Body:','waiting','CoinToPay2Service','FAILED','===\x20COINTOPAY2\x20API\x20ERROR\x20===','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Unknown\x20error','Payment\x20URL:','text','source','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','status_code','Business\x20Error:\x20','HTTP\x20','HTTP\x20Status:','stack','paid','POST','Missing\x20data\x20in\x20response','PaymentDetail','Amount:','738950nyFlqY','Confirmed\x20On:','../loggerService','PAID','üìä\x20Status\x20check\x20URL:','===\x20COINTOPAY2\x20SUCCESS\x20===','toLowerCase','CreatedOn','currency','error','Response\x20data:','319208MdtBdH','2082634HHTNoq','statusUrl','49JLwXfs','IBAN:','coinAddress','1653468zLvKkT','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','loggerService','__esModule','Unknown\x20error\x20from\x20CoinToPay2\x20API','12137360YAACoj','message','fromEntries',',\x20body:\x20','match','Raw\x20Response\x20Body:','Result:','checkPaymentStatus','CoinToPay2\x20payment\x20status\x20check\x20error:','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','EXPIRED','awaiting\x20fiat','cointopay2','success','4GqHAtz','12168981UFKtAE','pending','Gateway\x20Payment\x20ID:','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','log','https://traffer.uk/gateway/cointopay/','Error\x20message:','processWebhook','entries','timeout','parse','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','order_id','status','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','merchant_reference_id','Amount','URL:','CoinToPay2\x20API\x20error:\x20','expired','EUR','9bmrhWt','Error\x20details:','application/json','Status','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','headers','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','6453288tPiuko','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Failed\x20to\x20parse\x20JSON\x20response:','Status\x20API\x20Error:\x20','stringify','logWhiteDomainRequest','Payment\x20Status:','defineProperty'];a40_0xd69c=function(){return _0xdd080f;};return a40_0xd69c();}function a40_0x4376(_0xb60b31,_0x2d6a71){const _0xd69c6b=a40_0xd69c();return a40_0x4376=function(_0x437669,_0x2cd978){_0x437669=_0x437669-0x7c;let _0x30f282=_0xd69c6b[_0x437669];return _0x30f282;},a40_0x4376(_0xb60b31,_0x2d6a71);}exports['CoinToPay2Service']=CoinToPay2Service;