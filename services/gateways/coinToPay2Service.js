'use strict';const a48_0x16e1a6=a48_0x81f1;(function(_0x1ad2d1,_0x48f709){const _0x59beb2=a48_0x81f1,_0x18390c=_0x1ad2d1();while(!![]){try{const _0x20c8cf=-parseInt(_0x59beb2(0xc1))/0x1*(-parseInt(_0x59beb2(0xa8))/0x2)+-parseInt(_0x59beb2(0x101))/0x3+-parseInt(_0x59beb2(0x94))/0x4*(parseInt(_0x59beb2(0xad))/0x5)+-parseInt(_0x59beb2(0xd3))/0x6*(parseInt(_0x59beb2(0xda))/0x7)+-parseInt(_0x59beb2(0xdc))/0x8+-parseInt(_0x59beb2(0x102))/0x9*(parseInt(_0x59beb2(0x97))/0xa)+parseInt(_0x59beb2(0x9a))/0xb;if(_0x20c8cf===_0x48f709)break;else _0x18390c['push'](_0x18390c['shift']());}catch(_0x430b8a){_0x18390c['push'](_0x18390c['shift']());}}}(a48_0x57f4,0x5dbee));Object['defineProperty'](exports,a48_0x16e1a6(0x90),{'value':!![]}),exports[a48_0x16e1a6(0xbe)]=void 0x0;const loggerService_1=require(a48_0x16e1a6(0x104));class CoinToPay2Service{constructor(){const _0x4a0300=a48_0x16e1a6;this[_0x4a0300(0xcc)]=_0x4a0300(0xa9),this[_0x4a0300(0xfe)]=_0x4a0300(0xe7),console['log'](_0x4a0300(0xd7)),console[_0x4a0300(0xb5)](_0x4a0300(0xd5),this['statusUrl']);}async[a48_0x16e1a6(0x91)](_0x468452){const _0x19689e=a48_0x16e1a6,{orderId:_0x252503,amount:_0x52021f}=_0x468452;console[_0x19689e(0xb5)](_0x19689e(0xcf)+_0x52021f+'\x20EUR');const _0x10655b={'amount':_0x52021f},_0x22984a=Date[_0x19689e(0xb3)]();try{console[_0x19689e(0xb5)](_0x19689e(0xc6)),console[_0x19689e(0xb5)]('URL:',this['apiUrl']),console[_0x19689e(0xb5)](_0x19689e(0xe0),JSON[_0x19689e(0xaa)](_0x10655b,null,0x2)),console['log']('Amount:',_0x52021f,'EUR\x20(always\x20EUR\x20for\x20CoinToPay2)'),loggerService_1[_0x19689e(0x10b)][_0x19689e(0xf2)]('cointopay2',_0x19689e(0xab),'POST',_0x10655b);const _0x4cb675=await fetch(this[_0x19689e(0xcc)],{'method':_0x19689e(0x112),'headers':{'Content-Type':'application/json','Accept':_0x19689e(0xce),'User-Agent':'Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x19689e(0xaa)](_0x10655b)}),_0x85eb51=Date[_0x19689e(0xb3)]()-_0x22984a;console['log']('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console['log'](_0x19689e(0xc8),_0x4cb675['status']),console[_0x19689e(0xb5)]('Status\x20Text:',_0x4cb675[_0x19689e(0xc2)]),console[_0x19689e(0xb5)]('Headers:',Object[_0x19689e(0x8f)](_0x4cb675['headers']['entries']())),console[_0x19689e(0xb5)](_0x19689e(0x100),_0x85eb51+'ms');const _0x2016ee=await _0x4cb675[_0x19689e(0xdf)]();console[_0x19689e(0xb5)](_0x19689e(0xc5),_0x2016ee);if(!_0x4cb675['ok']){console[_0x19689e(0xf9)]('===\x20COINTOPAY2\x20API\x20ERROR\x20==='),console[_0x19689e(0xf9)](_0x19689e(0xd2),_0x4cb675[_0x19689e(0xb9)]),console['error'](_0x19689e(0x98),_0x2016ee),loggerService_1['loggerService'][_0x19689e(0x8b)](_0x19689e(0xed),_0x19689e(0xab),_0x4cb675[_0x19689e(0xb9)],_0x2016ee,_0x85eb51),loggerService_1['loggerService'][_0x19689e(0x10a)](_0x19689e(0xed),_0x19689e(0xab),_0x19689e(0xd6)+_0x4cb675[_0x19689e(0xb9)]+':\x20'+_0x2016ee);throw new Error(_0x19689e(0xf7)+_0x4cb675[_0x19689e(0xb9)]+_0x19689e(0xb0)+_0x2016ee);}let _0x261ead;try{_0x261ead=JSON[_0x19689e(0x99)](_0x2016ee);}catch(_0x4cb3c8){console[_0x19689e(0xf9)](_0x19689e(0xd8),_0x4cb3c8),loggerService_1[_0x19689e(0x10b)][_0x19689e(0x10a)](_0x19689e(0xed),_0x19689e(0xab),'JSON\x20Parse\x20Error:\x20'+_0x4cb3c8);throw new Error(_0x19689e(0xfb)+_0x2016ee);}console[_0x19689e(0xb5)](_0x19689e(0x95)),console[_0x19689e(0xb5)](_0x19689e(0x10c),JSON[_0x19689e(0xaa)](_0x261ead,null,0x2)),loggerService_1[_0x19689e(0x10b)][_0x19689e(0x8b)](_0x19689e(0xed),'/create',_0x4cb675[_0x19689e(0xb9)],_0x261ead,_0x85eb51);if(_0x261ead['error']){const _0x544dee=_0x261ead[_0x19689e(0xf5)]||_0x261ead[_0x19689e(0xf9)]||_0x19689e(0xa1);console[_0x19689e(0xf9)](_0x19689e(0xee)),console[_0x19689e(0xf9)](_0x19689e(0xe8),_0x544dee),loggerService_1[_0x19689e(0x10b)][_0x19689e(0x10a)]('cointopay2',_0x19689e(0xab),_0x19689e(0x103)+_0x544dee);throw new Error(_0x19689e(0xf0)+_0x544dee);}if(!_0x261ead[_0x19689e(0xb1)]||!_0x261ead[_0x19689e(0xc7)]){console['error']('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x19689e(0xf9)](_0x19689e(0x9b)),console[_0x19689e(0xf9)](_0x19689e(0x109),_0x261ead),loggerService_1[_0x19689e(0x10b)][_0x19689e(0x10a)](_0x19689e(0xed),'/create',_0x19689e(0xac));throw new Error(_0x19689e(0x107));}console[_0x19689e(0xb5)](_0x19689e(0xf3)),console[_0x19689e(0xb5)](_0x19689e(0xfc),_0x261ead['gateway_payment_id']),console[_0x19689e(0xb5)]('Payment\x20URL\x20(original):',_0x261ead[_0x19689e(0xb1)]);const _0xba94a1=_0x261ead[_0x19689e(0xb1)]+_0x19689e(0x8c);return console[_0x19689e(0xb5)]('Payment\x20URL\x20(modified):',_0xba94a1),console['log'](_0x19689e(0xff),_0x52021f,_0x19689e(0xcd)),{'gateway_payment_id':_0x261ead[_0x19689e(0xc7)],'payment_url':_0xba94a1};}catch(_0x338942){console['error'](_0x19689e(0xb6)),console[_0x19689e(0xf9)]('Error\x20details:',_0x338942),loggerService_1[_0x19689e(0x10b)][_0x19689e(0x10a)](_0x19689e(0xed),_0x19689e(0xab),_0x338942);if(_0x338942 instanceof Error){console[_0x19689e(0xf9)](_0x19689e(0xd4),_0x338942[_0x19689e(0xf5)]),console[_0x19689e(0xf9)]('Error\x20stack:',_0x338942[_0x19689e(0xeb)]);throw new Error(_0x19689e(0xa7)+_0x338942['message']);}throw new Error(_0x19689e(0xb4));}}async[a48_0x16e1a6(0xa5)](_0x309678){const _0x54356f=a48_0x16e1a6,_0x347b09=Date[_0x54356f(0xb3)]();try{console['log'](_0x54356f(0x106)+_0x309678);const _0x331926={'gatewayPaymentId':_0x309678};loggerService_1[_0x54356f(0x10b)][_0x54356f(0xf2)](_0x54356f(0xed),_0x54356f(0xfa),'POST',_0x331926);const _0x250a4=await fetch(this[_0x54356f(0xfe)],{'method':'POST','headers':{'Content-Type':_0x54356f(0xce),'Accept':_0x54356f(0xce),'User-Agent':_0x54356f(0xef)},'body':JSON[_0x54356f(0xaa)](_0x331926)}),_0x23f2eb=Date[_0x54356f(0xb3)]()-_0x347b09;console[_0x54356f(0xb5)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x54356f(0xb5)]('Status:',_0x250a4[_0x54356f(0xb9)]),console[_0x54356f(0xb5)](_0x54356f(0x100),_0x23f2eb+'ms');if(!_0x250a4['ok']){const _0x3b78de=await _0x250a4[_0x54356f(0xdf)]();console['error'](_0x54356f(0xd2),_0x250a4[_0x54356f(0xb9)]),console[_0x54356f(0xf9)](_0x54356f(0x98),_0x3b78de),loggerService_1[_0x54356f(0x10b)][_0x54356f(0x8b)](_0x54356f(0xed),_0x54356f(0xfa),_0x250a4['status'],_0x3b78de,_0x23f2eb),loggerService_1[_0x54356f(0x10b)][_0x54356f(0x10a)](_0x54356f(0xed),_0x54356f(0xfa),_0x54356f(0xd6)+_0x250a4[_0x54356f(0xb9)]+':\x20'+_0x3b78de);throw new Error(_0x54356f(0xf7)+_0x250a4[_0x54356f(0xb9)]);}const _0x294f48=await _0x250a4[_0x54356f(0xdf)]();console['log'](_0x54356f(0xc5),_0x294f48);let _0x553786;try{_0x553786=JSON[_0x54356f(0x99)](_0x294f48);}catch(_0x89df6f){console[_0x54356f(0xf9)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x89df6f),loggerService_1['loggerService'][_0x54356f(0x10a)]('cointopay2',_0x54356f(0xfa),_0x54356f(0x93)+_0x89df6f);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'+_0x294f48);}loggerService_1[_0x54356f(0x10b)][_0x54356f(0x8b)](_0x54356f(0xed),'/status',_0x250a4[_0x54356f(0xb9)],_0x553786,_0x23f2eb),console[_0x54356f(0xb5)]('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console[_0x54356f(0xb5)](_0x54356f(0xe2),_0x553786[_0x54356f(0x10d)]),console['log'](_0x54356f(0xd9),_0x553786[_0x54356f(0xdd)]),console[_0x54356f(0xb5)](_0x54356f(0xdb),_0x553786[_0x54356f(0xba)]?.[_0x54356f(0x113)]),console['log'](_0x54356f(0xff),_0x553786[_0x54356f(0xba)]?.[_0x54356f(0x96)]),console['log'](_0x54356f(0xf8),_0x553786['data']?.[_0x54356f(0x105)]);if(_0x553786[_0x54356f(0x10d)]!=='success'||_0x553786[_0x54356f(0xdd)]!==0xc8){const _0x539247=_0x553786[_0x54356f(0xf5)]||_0x54356f(0xe3);console['error'](_0x54356f(0xd0)),console['error'](_0x54356f(0xe8),_0x539247),loggerService_1[_0x54356f(0x10b)][_0x54356f(0x10a)](_0x54356f(0xed),_0x54356f(0xfa),_0x54356f(0xec)+_0x539247);throw new Error(_0x54356f(0x8d)+_0x539247);}if(!_0x553786[_0x54356f(0xba)]){console[_0x54356f(0xf9)](_0x54356f(0xb7)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x54356f(0x10b)]['logWhiteDomainError'](_0x54356f(0xed),'/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0x54356f(0xe5));}let _0x1aea3f=_0x54356f(0xcb);switch(_0x553786[_0x54356f(0xba)]['Status']?.[_0x54356f(0xe1)]()){case _0x54356f(0x110):_0x1aea3f=_0x54356f(0xc0);break;case _0x54356f(0xe4):case _0x54356f(0xb2):case _0x54356f(0xf9):_0x1aea3f=_0x54356f(0xa3);break;case _0x54356f(0xbd):case _0x54356f(0x10f):_0x1aea3f=_0x54356f(0xa0);break;case _0x54356f(0x92):case _0x54356f(0xe9):case _0x54356f(0x111):case'created':default:_0x1aea3f='PENDING';break;}let _0x4011d9,_0x4dc199;if(_0x553786['data'][_0x54356f(0xc4)]){const _0x47a80d=_0x553786[_0x54356f(0xba)][_0x54356f(0xc4)];console[_0x54356f(0xb5)](_0x54356f(0xbf),_0x47a80d);const _0x7ce99a=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x317516 of _0x7ce99a){const _0x34b4fc=_0x47a80d[_0x54356f(0xf6)](_0x317516);if(_0x34b4fc){_0x4011d9=_0x34b4fc[0x1],console[_0x54356f(0xb5)](_0x54356f(0xca),_0x4011d9,_0x54356f(0x9c),_0x317516[_0x54356f(0x9f)]);break;}}if(!_0x4011d9){console['log'](_0x54356f(0xf1));const _0x199872=_0x47a80d['match'](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x199872&&(_0x4011d9=_0x199872[0x1],console['log'](_0x54356f(0xde),_0x4011d9));}_0x4dc199=_0x47a80d;}const _0x4d5a8e={'iban':_0x4011d9,'bankDetails':_0x4dc199,'transactionId':_0x553786['data'][_0x54356f(0xa2)],'coinAddress':_0x553786[_0x54356f(0xba)][_0x54356f(0x9d)],'qrCodeUrl':_0x553786['data'][_0x54356f(0xae)],'expiryTime':_0x553786[_0x54356f(0xba)]['ExpiryTime'],'createdOn':_0x553786['data'][_0x54356f(0xf4)],'confirmedOn':_0x553786[_0x54356f(0xba)][_0x54356f(0xaf)]};console['log'](_0x54356f(0x8e)),console[_0x54356f(0xb5)](_0x54356f(0xc8),_0x553786['data'][_0x54356f(0x113)],'->',_0x1aea3f),console[_0x54356f(0xb5)](_0x54356f(0xff),_0x553786[_0x54356f(0xba)]['Amount'],_0x553786[_0x54356f(0xba)][_0x54356f(0x105)]),console['log']('Transaction\x20ID:',_0x553786[_0x54356f(0xba)]['TransactionID']),console[_0x54356f(0xb5)](_0x54356f(0x10e),_0x4011d9||_0x54356f(0xa4)),console[_0x54356f(0xb5)](_0x54356f(0xbb),_0x553786[_0x54356f(0xba)][_0x54356f(0xf4)]),console['log'](_0x54356f(0x108),_0x553786[_0x54356f(0xba)][_0x54356f(0xaf)]||_0x54356f(0xc3));if(_0x553786[_0x54356f(0xba)][_0x54356f(0x113)]?.[_0x54356f(0xe1)]()==='awaiting\x20fiat')console[_0x54356f(0xb5)](_0x54356f(0xd1));else _0x553786[_0x54356f(0xba)][_0x54356f(0x113)]?.['toLowerCase']()==='paid'&&console[_0x54356f(0xb5)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x1aea3f,'amount':parseFloat(_0x553786[_0x54356f(0xba)]['Amount'])||undefined,'currency':_0x553786[_0x54356f(0xba)][_0x54356f(0x105)]||_0x54356f(0xcd),'paymentDetails':_0x4d5a8e};}catch(_0x2b135d){console[_0x54356f(0xf9)](_0x54356f(0xfd),_0x2b135d),loggerService_1['loggerService'][_0x54356f(0x10a)]('cointopay2',_0x54356f(0xfa),_0x2b135d);throw new Error(_0x54356f(0xbc)+(_0x2b135d instanceof Error?_0x2b135d[_0x54356f(0xf5)]:_0x54356f(0xc9)));}}async[a48_0x16e1a6(0xea)](_0x4668a9){const _0x55760f=a48_0x16e1a6,_0x144d08=await this[_0x55760f(0xa5)](_0x4668a9);return{'status':_0x144d08[_0x55760f(0xb9)],'amount':_0x144d08['amount'],'currency':_0x144d08[_0x55760f(0xe6)]};}async[a48_0x16e1a6(0xb8)](_0x31cbde){const _0xc46fe7=a48_0x16e1a6;console[_0xc46fe7(0xb5)]('Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x31cbde);let _0x4a4544=_0xc46fe7(0xcb);switch(_0x31cbde[_0xc46fe7(0xb9)]?.[_0xc46fe7(0xe1)]()){case _0xc46fe7(0x110):_0x4a4544=_0xc46fe7(0xc0);break;case _0xc46fe7(0xe4):case'failed':case _0xc46fe7(0xf9):_0x4a4544=_0xc46fe7(0xa3);break;case'expired':case _0xc46fe7(0x10f):_0x4a4544='EXPIRED';break;case'pending':case _0xc46fe7(0x92):case _0xc46fe7(0xe9):case _0xc46fe7(0x9e):default:_0x4a4544=_0xc46fe7(0xcb);break;}return{'paymentId':_0x31cbde['order_id']||_0x31cbde['merchant_reference_id']||'','status':_0x4a4544,'amount':_0x31cbde[_0xc46fe7(0xa6)],'currency':_0x31cbde['currency']||_0xc46fe7(0xcd)};}}function a48_0x57f4(){const _0x4a1f86=['/status','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','Gateway\x20Payment\x20ID:','CoinToPay2\x20payment\x20status\x20check\x20error:','statusUrl','Amount:','Response\x20Time:','520578ateEQc','1816677rGZXer','Business\x20Error:\x20','../loggerService','inputCurrency','📊\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Confirmed\x20On:','Response\x20data:','logWhiteDomainError','loggerService','Parsed\x20Result:','result','IBAN:','timeout','paid','pending','POST','Status','logWhiteDomainResponse','&alternative=false','CoinToPay2\x20status\x20API\x20error:\x20','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','fromEntries','__esModule','createPaymentLink','waiting','JSON\x20Parse\x20Error:\x20','4oIzZdt','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','Amount','10FRMpUX','Response\x20Body:','parse','17977102mOMZfr','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','using\x20pattern:','coinAddress','created','source','EXPIRED','Unknown\x20error\x20from\x20CoinToPay2\x20API','TransactionID','FAILED','not\x20found','checkPaymentStatus','amount','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','168110FQVHKV','https://traffer.uk/gateway/cointopay/','stringify','/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','3386315lPxgrx','QRCodeURL','TransactionConfirmedOn',',\x20body:\x20','payment_url','failed','now','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','log','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','processWebhook','status','data','Created\x20On:','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','expired','CoinToPay2Service','🏦\x20Payment\x20Detail:','PAID','7lEfwqg','statusText','not\x20confirmed','PaymentDetail','Raw\x20Response\x20Body:','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','gateway_payment_id','Status:','Unknown\x20error','🏦\x20Extracted\x20IBAN:','PENDING','apiUrl','EUR','application/json','🪙\x20Creating\x20CoinToPay2\x20payment:\x20','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','HTTP\x20Status:','3580266WTBimT','Error\x20message:','📊\x20Status\x20check\x20URL:','HTTP\x20','🪙\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','Failed\x20to\x20parse\x20JSON\x20response:','Status\x20Code:','7ysfBuy','Payment\x20Status:','1514656ZnQETD','status_code','🏦\x20Extracted\x20IBAN\x20via\x20fallback:','text','Request\x20Body:','toLowerCase','Result:','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','cancelled','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','currency','https://traffer.uk/gateway/cointopay/status.php','Error\x20Message:','awaiting\x20fiat','verifyPayment','stack','Status\x20API\x20Error:\x20','cointopay2','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','Payment\x20System/1.0\x20(CoinToPay2)','CoinToPay2\x20API\x20error:\x20','⚠️\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','logWhiteDomainRequest','===\x20COINTOPAY2\x20SUCCESS\x20===','CreatedOn','message','match','HTTP\x20error!\x20status:\x20','Currency:','error'];a48_0x57f4=function(){return _0x4a1f86;};return a48_0x57f4();}function a48_0x81f1(_0x56fb28,_0x32a82b){const _0x57f421=a48_0x57f4();return a48_0x81f1=function(_0x81f129,_0x191c00){_0x81f129=_0x81f129-0x8b;let _0x535451=_0x57f421[_0x81f129];return _0x535451;},a48_0x81f1(_0x56fb28,_0x32a82b);}exports[a48_0x16e1a6(0xbe)]=CoinToPay2Service;