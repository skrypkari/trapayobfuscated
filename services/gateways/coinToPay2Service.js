'use strict';function a60_0x3b1c(_0x2b4c97,_0x15d8a3){_0x2b4c97=_0x2b4c97-0x151;const _0x2f36b5=a60_0x2f36();let _0x3b1c1d=_0x2f36b5[_0x2b4c97];return _0x3b1c1d;}const a60_0x27b44e=a60_0x3b1c;(function(_0x4d7ffe,_0x131c82){const _0x2db5f5=a60_0x3b1c,_0x37a1f7=_0x4d7ffe();while(!![]){try{const _0x22ed1c=-parseInt(_0x2db5f5(0x159))/0x1+-parseInt(_0x2db5f5(0x1bb))/0x2+-parseInt(_0x2db5f5(0x196))/0x3*(parseInt(_0x2db5f5(0x1a8))/0x4)+parseInt(_0x2db5f5(0x1b5))/0x5+parseInt(_0x2db5f5(0x185))/0x6+parseInt(_0x2db5f5(0x18d))/0x7*(parseInt(_0x2db5f5(0x19b))/0x8)+parseInt(_0x2db5f5(0x176))/0x9*(parseInt(_0x2db5f5(0x1d0))/0xa);if(_0x22ed1c===_0x131c82)break;else _0x37a1f7['push'](_0x37a1f7['shift']());}catch(_0x32b25e){_0x37a1f7['push'](_0x37a1f7['shift']());}}}(a60_0x2f36,0x1d2a7));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a60_0x27b44e(0x1c5)]=void 0x0;const loggerService_1=require(a60_0x27b44e(0x190));class CoinToPay2Service{constructor(){const _0x368585=a60_0x27b44e;this[_0x368585(0x19e)]='https://traffer.uk/gateway/cointopay/',this[_0x368585(0x184)]=_0x368585(0x1cc),console[_0x368585(0x166)](_0x368585(0x173)),console['log'](_0x368585(0x1c7),this[_0x368585(0x184)]);}async[a60_0x27b44e(0x188)](_0x4cedcf){const _0x15da41=a60_0x27b44e,{orderId:_0x19aeea,amount:_0x20247d}=_0x4cedcf;console[_0x15da41(0x166)](_0x15da41(0x170)+_0x20247d+_0x15da41(0x175));const _0x3068df={'amount':_0x20247d},_0x4f7340=Date[_0x15da41(0x198)]();try{console[_0x15da41(0x166)](_0x15da41(0x193)),console[_0x15da41(0x166)]('URL:',this['apiUrl']),console[_0x15da41(0x166)]('Request\x20Body:',JSON[_0x15da41(0x16f)](_0x3068df,null,0x2)),console[_0x15da41(0x166)](_0x15da41(0x1cf),_0x20247d,_0x15da41(0x1b7)),loggerService_1['loggerService'][_0x15da41(0x160)](_0x15da41(0x1a4),_0x15da41(0x16a),_0x15da41(0x1aa),_0x3068df);const _0x2c27a0=await fetch(this[_0x15da41(0x19e)],{'method':_0x15da41(0x1aa),'headers':{'Content-Type':_0x15da41(0x19c),'Accept':_0x15da41(0x19c),'User-Agent':_0x15da41(0x1ba)},'body':JSON[_0x15da41(0x16f)](_0x3068df)}),_0x481035=Date[_0x15da41(0x198)]()-_0x4f7340;console[_0x15da41(0x166)](_0x15da41(0x15b)),console['log'](_0x15da41(0x187),_0x2c27a0[_0x15da41(0x194)]),console[_0x15da41(0x166)]('Status\x20Text:',_0x2c27a0[_0x15da41(0x197)]),console[_0x15da41(0x166)](_0x15da41(0x1a7),Object[_0x15da41(0x19d)](_0x2c27a0['headers']['entries']())),console['log']('Response\x20Time:',_0x481035+'ms');const _0x53910e=await _0x2c27a0[_0x15da41(0x16d)]();console['log']('Raw\x20Response\x20Body:',_0x53910e);if(!_0x2c27a0['ok']){console[_0x15da41(0x1b6)](_0x15da41(0x181)),console[_0x15da41(0x1b6)](_0x15da41(0x17e),_0x2c27a0[_0x15da41(0x194)]),console[_0x15da41(0x1b6)](_0x15da41(0x1b0),_0x53910e),loggerService_1[_0x15da41(0x177)]['logWhiteDomainResponse'](_0x15da41(0x1a4),_0x15da41(0x16a),_0x2c27a0['status'],_0x53910e,_0x481035),loggerService_1[_0x15da41(0x177)]['logWhiteDomainError'](_0x15da41(0x1a4),_0x15da41(0x16a),_0x15da41(0x165)+_0x2c27a0[_0x15da41(0x194)]+':\x20'+_0x53910e);throw new Error(_0x15da41(0x152)+_0x2c27a0[_0x15da41(0x194)]+_0x15da41(0x169)+_0x53910e);}let _0x5490eb;try{_0x5490eb=JSON['parse'](_0x53910e);}catch(_0x36cf94){console['error'](_0x15da41(0x17a),_0x36cf94),loggerService_1[_0x15da41(0x177)][_0x15da41(0x172)]('cointopay2',_0x15da41(0x16a),'JSON\x20Parse\x20Error:\x20'+_0x36cf94);throw new Error(_0x15da41(0x1a1)+_0x53910e);}console[_0x15da41(0x166)](_0x15da41(0x18b)),console[_0x15da41(0x166)](_0x15da41(0x17d),JSON[_0x15da41(0x16f)](_0x5490eb,null,0x2)),loggerService_1[_0x15da41(0x177)]['logWhiteDomainResponse'](_0x15da41(0x1a4),_0x15da41(0x16a),_0x2c27a0[_0x15da41(0x194)],_0x5490eb,_0x481035);if(_0x5490eb[_0x15da41(0x1b6)]){const _0x3192d2=_0x5490eb[_0x15da41(0x1ce)]||_0x5490eb[_0x15da41(0x1b6)]||'Unknown\x20error\x20from\x20CoinToPay2\x20API';console[_0x15da41(0x1b6)](_0x15da41(0x186)),console[_0x15da41(0x1b6)](_0x15da41(0x18e),_0x3192d2),loggerService_1['loggerService'][_0x15da41(0x172)](_0x15da41(0x1a4),_0x15da41(0x16a),_0x15da41(0x199)+_0x3192d2);throw new Error(_0x15da41(0x16b)+_0x3192d2);}if(!_0x5490eb[_0x15da41(0x15f)]||!_0x5490eb[_0x15da41(0x153)]){console[_0x15da41(0x1b6)](_0x15da41(0x16c)),console['error'](_0x15da41(0x18c)),console[_0x15da41(0x1b6)](_0x15da41(0x162),_0x5490eb),loggerService_1[_0x15da41(0x177)][_0x15da41(0x172)](_0x15da41(0x1a4),_0x15da41(0x16a),_0x15da41(0x161));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x15da41(0x166)](_0x15da41(0x171)),console[_0x15da41(0x166)](_0x15da41(0x178),_0x5490eb[_0x15da41(0x153)]),console[_0x15da41(0x166)](_0x15da41(0x155),_0x5490eb[_0x15da41(0x15f)]);const _0x1e2721=_0x5490eb[_0x15da41(0x15f)]+_0x15da41(0x182);return console[_0x15da41(0x166)]('Payment\x20URL\x20(modified):',_0x1e2721),console['log'](_0x15da41(0x1cf),_0x20247d,_0x15da41(0x156)),{'gateway_payment_id':_0x5490eb[_0x15da41(0x153)],'payment_url':_0x1e2721};}catch(_0x48f2d4){console[_0x15da41(0x1b6)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x15da41(0x1b6)](_0x15da41(0x1bf),_0x48f2d4),loggerService_1['loggerService'][_0x15da41(0x172)](_0x15da41(0x1a4),_0x15da41(0x16a),_0x48f2d4);if(_0x48f2d4 instanceof Error){console[_0x15da41(0x1b6)](_0x15da41(0x1c4),_0x48f2d4[_0x15da41(0x1ce)]),console[_0x15da41(0x1b6)](_0x15da41(0x1ca),_0x48f2d4[_0x15da41(0x1cb)]);throw new Error(_0x15da41(0x164)+_0x48f2d4[_0x15da41(0x1ce)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x49e9a5){const _0x36eac6=a60_0x27b44e,_0x2f74a1=Date[_0x36eac6(0x198)]();try{console[_0x36eac6(0x166)](_0x36eac6(0x1b3)+_0x49e9a5);const _0x3d57c6={'gatewayPaymentId':_0x49e9a5};loggerService_1['loggerService'][_0x36eac6(0x160)](_0x36eac6(0x1a4),_0x36eac6(0x154),_0x36eac6(0x1aa),_0x3d57c6);const _0x2212ed=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0x36eac6(0x19c),'Accept':_0x36eac6(0x19c),'User-Agent':_0x36eac6(0x1ba)},'body':JSON[_0x36eac6(0x16f)](_0x3d57c6)}),_0x303f36=Date['now']()-_0x2f74a1;console[_0x36eac6(0x166)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x36eac6(0x166)]('Status:',_0x2212ed[_0x36eac6(0x194)]),console[_0x36eac6(0x166)](_0x36eac6(0x1b1),_0x303f36+'ms');if(!_0x2212ed['ok']){const _0x10b6c8=await _0x2212ed['text']();console['error'](_0x36eac6(0x17e),_0x2212ed[_0x36eac6(0x194)]),console['error'](_0x36eac6(0x1b0),_0x10b6c8),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x36eac6(0x1a4),_0x36eac6(0x154),_0x2212ed[_0x36eac6(0x194)],_0x10b6c8,_0x303f36),loggerService_1[_0x36eac6(0x177)]['logWhiteDomainError'](_0x36eac6(0x1a4),_0x36eac6(0x154),'HTTP\x20'+_0x2212ed[_0x36eac6(0x194)]+':\x20'+_0x10b6c8);throw new Error(_0x36eac6(0x152)+_0x2212ed[_0x36eac6(0x194)]);}const _0x8a19f1=await _0x2212ed['text']();console[_0x36eac6(0x166)]('Raw\x20Response\x20Body:',_0x8a19f1);let _0x2d660e;try{_0x2d660e=JSON[_0x36eac6(0x1a2)](_0x8a19f1);}catch(_0x2215a6){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x2215a6),loggerService_1[_0x36eac6(0x177)][_0x36eac6(0x172)](_0x36eac6(0x1a4),_0x36eac6(0x154),_0x36eac6(0x15e)+_0x2215a6);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'+_0x8a19f1);}loggerService_1[_0x36eac6(0x177)][_0x36eac6(0x1cd)](_0x36eac6(0x1a4),_0x36eac6(0x154),_0x2212ed[_0x36eac6(0x194)],_0x2d660e,_0x303f36),console['log'](_0x36eac6(0x1c0)),console[_0x36eac6(0x166)](_0x36eac6(0x1ad),_0x2d660e['result']),console[_0x36eac6(0x166)](_0x36eac6(0x1be),_0x2d660e[_0x36eac6(0x18f)]),console[_0x36eac6(0x166)](_0x36eac6(0x174),_0x2d660e['data']?.[_0x36eac6(0x1a3)]),console[_0x36eac6(0x166)](_0x36eac6(0x1cf),_0x2d660e[_0x36eac6(0x17c)]?.[_0x36eac6(0x1ae)]),console[_0x36eac6(0x166)](_0x36eac6(0x1b8),_0x2d660e[_0x36eac6(0x17c)]?.['inputCurrency']);if(_0x2d660e['result']!=='success'||_0x2d660e[_0x36eac6(0x18f)]!==0xc8){const _0x8fd0ea=_0x2d660e[_0x36eac6(0x1ce)]||_0x36eac6(0x1b9);console[_0x36eac6(0x1b6)](_0x36eac6(0x1c2)),console[_0x36eac6(0x1b6)]('Error\x20Message:',_0x8fd0ea),loggerService_1[_0x36eac6(0x177)]['logWhiteDomainError'](_0x36eac6(0x1a4),_0x36eac6(0x154),_0x36eac6(0x191)+_0x8fd0ea);throw new Error(_0x36eac6(0x1a9)+_0x8fd0ea);}if(!_0x2d660e[_0x36eac6(0x17c)]){console[_0x36eac6(0x1b6)]('===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x36eac6(0x183)),loggerService_1[_0x36eac6(0x177)]['logWhiteDomainError']('cointopay2',_0x36eac6(0x154),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x36eac6(0x17f));}let _0x18acc1=_0x36eac6(0x1b4);switch(_0x2d660e[_0x36eac6(0x17c)]['Status']?.[_0x36eac6(0x1a0)]()){case _0x36eac6(0x1ac):_0x18acc1='PAID';break;case _0x36eac6(0x1c8):case _0x36eac6(0x1c6):case _0x36eac6(0x1b6):_0x18acc1=_0x36eac6(0x1a6);break;case _0x36eac6(0x16e):case _0x36eac6(0x1a5):_0x18acc1='EXPIRED';break;case _0x36eac6(0x1bc):case _0x36eac6(0x180):case _0x36eac6(0x189):case _0x36eac6(0x1c9):default:_0x18acc1=_0x36eac6(0x1b4);break;}let _0x33d2cc,_0x287c43;if(_0x2d660e[_0x36eac6(0x17c)]['PaymentDetail']){const _0x2a66a1=_0x2d660e[_0x36eac6(0x17c)]['PaymentDetail'];console['log'](_0x36eac6(0x195),_0x2a66a1);const _0x4bf536=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x13510c of _0x4bf536){const _0x5d1fb4=_0x2a66a1[_0x36eac6(0x179)](_0x13510c);if(_0x5d1fb4){_0x33d2cc=_0x5d1fb4[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0x33d2cc,'using\x20pattern:',_0x13510c[_0x36eac6(0x19a)]);break;}}if(!_0x33d2cc){console[_0x36eac6(0x166)]('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x214235=_0x2a66a1[_0x36eac6(0x179)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x214235&&(_0x33d2cc=_0x214235[0x1],console['log']('üè¶\x20Extracted\x20IBAN\x20via\x20fallback:',_0x33d2cc));}_0x287c43=_0x2a66a1;}const _0x4af206={'iban':_0x33d2cc,'bankDetails':_0x287c43,'transactionId':_0x2d660e[_0x36eac6(0x17c)]['TransactionID'],'coinAddress':_0x2d660e['data'][_0x36eac6(0x1c1)],'qrCodeUrl':_0x2d660e[_0x36eac6(0x17c)]['QRCodeURL'],'expiryTime':_0x2d660e['data'][_0x36eac6(0x157)],'createdOn':_0x2d660e[_0x36eac6(0x17c)][_0x36eac6(0x163)],'confirmedOn':_0x2d660e[_0x36eac6(0x17c)][_0x36eac6(0x158)]};console[_0x36eac6(0x166)]('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console[_0x36eac6(0x166)](_0x36eac6(0x187),_0x2d660e['data'][_0x36eac6(0x1a3)],'->',_0x18acc1),console['log'](_0x36eac6(0x1cf),_0x2d660e[_0x36eac6(0x17c)][_0x36eac6(0x1ae)],_0x2d660e[_0x36eac6(0x17c)][_0x36eac6(0x1ab)]),console[_0x36eac6(0x166)]('Transaction\x20ID:',_0x2d660e[_0x36eac6(0x17c)][_0x36eac6(0x15d)]),console['log'](_0x36eac6(0x1c3),_0x33d2cc||'not\x20found'),console[_0x36eac6(0x166)]('Created\x20On:',_0x2d660e['data'][_0x36eac6(0x163)]),console[_0x36eac6(0x166)](_0x36eac6(0x18a),_0x2d660e[_0x36eac6(0x17c)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x2d660e[_0x36eac6(0x17c)][_0x36eac6(0x1a3)]?.[_0x36eac6(0x1a0)]()===_0x36eac6(0x180))console['log'](_0x36eac6(0x1b2));else _0x2d660e[_0x36eac6(0x17c)]['Status']?.[_0x36eac6(0x1a0)]()===_0x36eac6(0x1ac)&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x18acc1,'amount':parseFloat(_0x2d660e[_0x36eac6(0x17c)]['Amount'])||undefined,'currency':_0x2d660e[_0x36eac6(0x17c)]['inputCurrency']||_0x36eac6(0x156),'paymentDetails':_0x4af206};}catch(_0x45dac9){console['error']('CoinToPay2\x20payment\x20status\x20check\x20error:',_0x45dac9),loggerService_1['loggerService'][_0x36eac6(0x172)](_0x36eac6(0x1a4),_0x36eac6(0x154),_0x45dac9);throw new Error('Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20'+(_0x45dac9 instanceof Error?_0x45dac9['message']:_0x36eac6(0x168)));}}async['verifyPayment'](_0x54cb7b){const _0x4e4055=a60_0x27b44e,_0x1347dc=await this[_0x4e4055(0x15a)](_0x54cb7b);return{'status':_0x1347dc[_0x4e4055(0x194)],'amount':_0x1347dc[_0x4e4055(0x15c)],'currency':_0x1347dc[_0x4e4055(0x151)]};}async[a60_0x27b44e(0x192)](_0x514551){const _0x5adf5e=a60_0x27b44e;console['log'](_0x5adf5e(0x1af),_0x514551);let _0x351b35=_0x5adf5e(0x1b4);switch(_0x514551['status']?.[_0x5adf5e(0x1a0)]()){case _0x5adf5e(0x1ac):_0x351b35=_0x5adf5e(0x167);break;case _0x5adf5e(0x1c8):case _0x5adf5e(0x1c6):case _0x5adf5e(0x1b6):_0x351b35=_0x5adf5e(0x1a6);break;case _0x5adf5e(0x16e):case _0x5adf5e(0x1a5):_0x351b35=_0x5adf5e(0x17b);break;case'pending':case'waiting':case _0x5adf5e(0x180):case _0x5adf5e(0x1c9):default:_0x351b35=_0x5adf5e(0x1b4);break;}return{'paymentId':_0x514551[_0x5adf5e(0x1bd)]||_0x514551[_0x5adf5e(0x19f)]||'','status':_0x351b35,'amount':_0x514551[_0x5adf5e(0x15c)],'currency':_0x514551['currency']||_0x5adf5e(0x156)};}}exports[a60_0x27b44e(0x1c5)]=CoinToPay2Service;function a60_0x2f36(){const _0x5a76ec=['18bujCNJ','loggerService','Gateway\x20Payment\x20ID:','match','Failed\x20to\x20parse\x20JSON\x20response:','EXPIRED','data','Parsed\x20Result:','HTTP\x20Status:','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','awaiting\x20fiat','===\x20COINTOPAY2\x20API\x20ERROR\x20===','&alternative=false','Missing\x20data\x20in\x20response','statusUrl','1383816nGEgwJ','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','Status:','createPaymentLink','pending','Confirmed\x20On:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','1246bWoHYA','Error\x20Message:','status_code','../loggerService','Status\x20API\x20Error:\x20','processWebhook','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','status','üè¶\x20Payment\x20Detail:','4887YAjGQp','statusText','now','Business\x20Error:\x20','source','7960VvGzXG','application/json','fromEntries','apiUrl','merchant_reference_id','toLowerCase','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','parse','Status','cointopay2','timeout','FAILED','Headers:','228TDqdrq','CoinToPay2\x20status\x20API\x20error:\x20','POST','inputCurrency','paid','Result:','Amount','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Response\x20Body:','Response\x20Time:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','PENDING','405130ZQZgis','error','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','Currency:','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Payment\x20System/1.0\x20(CoinToPay2)','238860acDaNG','waiting','order_id','Status\x20Code:','Error\x20details:','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','coinAddress','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','IBAN:','Error\x20message:','CoinToPay2Service','failed','üìä\x20Status\x20check\x20URL:','cancelled','created','Error\x20stack:','stack','https://traffer.uk/gateway/cointopay/status.php','logWhiteDomainResponse','message','Amount:','363810gQpMPc','currency','HTTP\x20error!\x20status:\x20','gateway_payment_id','/status','Payment\x20URL\x20(original):','EUR','ExpiryTime','TransactionConfirmedOn','229788pMaKox','checkPaymentStatus','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','amount','TransactionID','JSON\x20Parse\x20Error:\x20','payment_url','logWhiteDomainRequest','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Response\x20data:','CreatedOn','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','HTTP\x20','log','PAID','Unknown\x20error',',\x20body:\x20','/create','CoinToPay2\x20API\x20error:\x20','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','text','expired','stringify','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','===\x20COINTOPAY2\x20SUCCESS\x20===','logWhiteDomainError','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','Payment\x20Status:','\x20EUR'];a60_0x2f36=function(){return _0x5a76ec;};return a60_0x2f36();}