'use strict';const a42_0x1d273f=a42_0x1ab2;(function(_0x3e3758,_0x434bf2){const _0x3b9e51=a42_0x1ab2,_0x3556c3=_0x3e3758();while(!![]){try{const _0x38589f=-parseInt(_0x3b9e51(0x272))/0x1+-parseInt(_0x3b9e51(0x25b))/0x2*(parseInt(_0x3b9e51(0x25d))/0x3)+-parseInt(_0x3b9e51(0x1fd))/0x4*(parseInt(_0x3b9e51(0x253))/0x5)+parseInt(_0x3b9e51(0x257))/0x6*(parseInt(_0x3b9e51(0x227))/0x7)+-parseInt(_0x3b9e51(0x1f7))/0x8+-parseInt(_0x3b9e51(0x206))/0x9*(parseInt(_0x3b9e51(0x271))/0xa)+parseInt(_0x3b9e51(0x24f))/0xb*(parseInt(_0x3b9e51(0x20c))/0xc);if(_0x38589f===_0x434bf2)break;else _0x3556c3['push'](_0x3556c3['shift']());}catch(_0x4fc838){_0x3556c3['push'](_0x3556c3['shift']());}}}(a42_0x1724,0x486bf));Object['defineProperty'](exports,a42_0x1d273f(0x250),{'value':!![]}),exports[a42_0x1d273f(0x26c)]=void 0x0;function a42_0x1724(){const _0x4aa050=['Response\x20Body:','order_id','checkPaymentStatus','verifyPayment','logWhiteDomainError','statusUrl','entries','HTTP\x20Status:','===\x20COINTOPAY2\x20API\x20ERROR\x20===','CoinToPay2\x20API\x20error:\x20','inputCurrency','failed','35OjLwaY','Error\x20message:','TransactionConfirmedOn','apiUrl','Response\x20Time:','Amount','status','EUR','logWhiteDomainRequest','Unknown\x20error\x20from\x20CoinToPay2\x20API','Payment\x20Status:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Request\x20Body:','Incomplete\x20response:\x20missing\x20data','Currency:','CoinToPay2\x20payment\x20status\x20check\x20error:','waiting','/status','processWebhook','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error','Business\x20Error:\x20','TransactionID','üè¶\x20Payment\x20Detail:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','cancelled','PaymentDetail','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','paid','PAID','CoinToPay2\x20status\x20API\x20error:\x20','result',',\x20body:\x20','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','fromEntries','Created\x20On:','https://traffer.uk/gateway/cointopay/status.php','amount','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','7850359YqxJLH','__esModule','loggerService','awaiting\x20fiat','1070sHCnvd','===\x20COINTOPAY2\x20SUCCESS\x20===','pending','Confirmed\x20On:','386916QyYiTR','createPaymentLink','/create','ExpiryTime','19078FTBein','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','57hnkHdP','now','Missing\x20data\x20in\x20response','status_code','https://traffer.uk/gateway/cointopay/','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Headers:','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','payment_url','üè¶\x20Extracted\x20IBAN:','log','URL:','stringify','Amount:','toLowerCase','CoinToPay2Service','Error\x20stack:','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','1267730tFxrsF','300499xezyMl','PENDING','Error\x20Message:','cointopay2','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','HTTP\x20','Status:','headers','data','815960VwRGyf','parse','logWhiteDomainResponse','Parsed\x20Result:','error','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','6772lGCYqL','gateway_payment_id','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','created','EXPIRED','message','Raw\x20Response\x20Body:','36LcdwaV','statusText','Failed\x20to\x20parse\x20JSON\x20response:','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','expired','not\x20found','24rxfhbP','JSON\x20Parse\x20Error:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','currency','Gateway\x20Payment\x20ID:','Status','Transaction\x20ID:','text','üìä\x20Status\x20check\x20URL:','Error\x20details:','HTTP\x20error!\x20status:\x20','POST','application/json','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','../loggerService'];a42_0x1724=function(){return _0x4aa050;};return a42_0x1724();}const loggerService_1=require(a42_0x1d273f(0x21a));class CoinToPay2Service{constructor(){const _0x5705dc=a42_0x1d273f;this[_0x5705dc(0x22a)]=_0x5705dc(0x261),this[_0x5705dc(0x220)]=_0x5705dc(0x24c),console['log']('ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0x5705dc(0x267)](_0x5705dc(0x214),this[_0x5705dc(0x220)]);}async[a42_0x1d273f(0x258)](_0xaed43d){const _0x3286e2=a42_0x1d273f,{orderId:_0x3d5999,amount:_0x5427df}=_0xaed43d;console[_0x3286e2(0x267)](_0x3286e2(0x209)+_0x5427df+'\x20EUR');const _0xb4cf69={'amount':_0x5427df},_0x50a47d=Date[_0x3286e2(0x25e)]();try{console[_0x3286e2(0x267)](_0x3286e2(0x26f)),console[_0x3286e2(0x267)](_0x3286e2(0x268),this[_0x3286e2(0x22a)]),console[_0x3286e2(0x267)](_0x3286e2(0x234),JSON[_0x3286e2(0x269)](_0xb4cf69,null,0x2)),console[_0x3286e2(0x267)]('Amount:',_0x5427df,_0x3286e2(0x20e)),loggerService_1['loggerService'][_0x3286e2(0x22f)](_0x3286e2(0x275),_0x3286e2(0x259),_0x3286e2(0x217),_0xb4cf69);const _0x4d94b1=await fetch(this['apiUrl'],{'method':_0x3286e2(0x217),'headers':{'Content-Type':_0x3286e2(0x218),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x3286e2(0x269)](_0xb4cf69)}),_0x31b59b=Date[_0x3286e2(0x25e)]()-_0x50a47d;console[_0x3286e2(0x267)]('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console[_0x3286e2(0x267)](_0x3286e2(0x1f4),_0x4d94b1[_0x3286e2(0x22d)]),console[_0x3286e2(0x267)]('Status\x20Text:',_0x4d94b1[_0x3286e2(0x207)]),console[_0x3286e2(0x267)](_0x3286e2(0x263),Object[_0x3286e2(0x24a)](_0x4d94b1[_0x3286e2(0x1f5)][_0x3286e2(0x221)]())),console[_0x3286e2(0x267)](_0x3286e2(0x22b),_0x31b59b+'ms');const _0x2ba811=await _0x4d94b1['text']();console[_0x3286e2(0x267)](_0x3286e2(0x205),_0x2ba811);if(!_0x4d94b1['ok']){console[_0x3286e2(0x1fb)](_0x3286e2(0x223)),console[_0x3286e2(0x1fb)]('HTTP\x20Status:',_0x4d94b1[_0x3286e2(0x22d)]),console['error'](_0x3286e2(0x21b),_0x2ba811),loggerService_1[_0x3286e2(0x251)][_0x3286e2(0x1f9)](_0x3286e2(0x275),_0x3286e2(0x259),_0x4d94b1['status'],_0x2ba811,_0x31b59b),loggerService_1[_0x3286e2(0x251)][_0x3286e2(0x21f)](_0x3286e2(0x275),_0x3286e2(0x259),_0x3286e2(0x1f3)+_0x4d94b1['status']+':\x20'+_0x2ba811);throw new Error(_0x3286e2(0x216)+_0x4d94b1[_0x3286e2(0x22d)]+_0x3286e2(0x248)+_0x2ba811);}let _0x207601;try{_0x207601=JSON['parse'](_0x2ba811);}catch(_0xe9b01d){console[_0x3286e2(0x1fb)](_0x3286e2(0x208),_0xe9b01d),loggerService_1[_0x3286e2(0x251)][_0x3286e2(0x21f)](_0x3286e2(0x275),_0x3286e2(0x259),_0x3286e2(0x20d)+_0xe9b01d);throw new Error(_0x3286e2(0x1fc)+_0x2ba811);}console[_0x3286e2(0x267)](_0x3286e2(0x200)),console[_0x3286e2(0x267)](_0x3286e2(0x1fa),JSON[_0x3286e2(0x269)](_0x207601,null,0x2)),loggerService_1[_0x3286e2(0x251)][_0x3286e2(0x1f9)](_0x3286e2(0x275),_0x3286e2(0x259),_0x4d94b1[_0x3286e2(0x22d)],_0x207601,_0x31b59b);if(_0x207601[_0x3286e2(0x1fb)]){const _0x547a33=_0x207601[_0x3286e2(0x204)]||_0x207601[_0x3286e2(0x1fb)]||_0x3286e2(0x230);console[_0x3286e2(0x1fb)](_0x3286e2(0x26e)),console[_0x3286e2(0x1fb)](_0x3286e2(0x274),_0x547a33),loggerService_1['loggerService'][_0x3286e2(0x21f)](_0x3286e2(0x275),_0x3286e2(0x259),_0x3286e2(0x23d)+_0x547a33);throw new Error(_0x3286e2(0x224)+_0x547a33);}if(!_0x207601['payment_url']||!_0x207601['gateway_payment_id']){console[_0x3286e2(0x1fb)](_0x3286e2(0x233)),console['error'](_0x3286e2(0x240)),console[_0x3286e2(0x1fb)]('Response\x20data:',_0x207601),loggerService_1[_0x3286e2(0x251)][_0x3286e2(0x21f)](_0x3286e2(0x275),_0x3286e2(0x259),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x3286e2(0x262));}return console['log'](_0x3286e2(0x254)),console[_0x3286e2(0x267)](_0x3286e2(0x210),_0x207601[_0x3286e2(0x1fe)]),console[_0x3286e2(0x267)]('Payment\x20URL:',_0x207601[_0x3286e2(0x265)]),console['log']('Amount:',_0x5427df,_0x3286e2(0x22e)),{'gateway_payment_id':_0x207601[_0x3286e2(0x1fe)],'payment_url':_0x207601[_0x3286e2(0x265)]};}catch(_0x5e1673){console[_0x3286e2(0x1fb)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x3286e2(0x1fb)](_0x3286e2(0x215),_0x5e1673),loggerService_1[_0x3286e2(0x251)][_0x3286e2(0x21f)](_0x3286e2(0x275),_0x3286e2(0x259),_0x5e1673);if(_0x5e1673 instanceof Error){console[_0x3286e2(0x1fb)](_0x3286e2(0x228),_0x5e1673[_0x3286e2(0x204)]),console[_0x3286e2(0x1fb)](_0x3286e2(0x26d),_0x5e1673['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x5e1673[_0x3286e2(0x204)]);}throw new Error(_0x3286e2(0x232));}}async['checkPaymentStatus'](_0x33e302){const _0x262308=a42_0x1d273f,_0x727eab=Date[_0x262308(0x25e)]();try{console['log'](_0x262308(0x219)+_0x33e302);const _0xc9dae6={'gatewayPaymentId':_0x33e302};loggerService_1[_0x262308(0x251)][_0x262308(0x22f)](_0x262308(0x275),'/status',_0x262308(0x217),_0xc9dae6);const _0x164ee1=await fetch(this[_0x262308(0x220)],{'method':_0x262308(0x217),'headers':{'Content-Type':'application/json','Accept':_0x262308(0x218),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x262308(0x269)](_0xc9dae6)}),_0x11aae8=Date[_0x262308(0x25e)]()-_0x727eab;console[_0x262308(0x267)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log'](_0x262308(0x1f4),_0x164ee1['status']),console[_0x262308(0x267)](_0x262308(0x22b),_0x11aae8+'ms');if(!_0x164ee1['ok']){const _0x1ec201=await _0x164ee1[_0x262308(0x213)]();console['error'](_0x262308(0x222),_0x164ee1['status']),console[_0x262308(0x1fb)](_0x262308(0x21b),_0x1ec201),loggerService_1[_0x262308(0x251)][_0x262308(0x1f9)](_0x262308(0x275),'/status',_0x164ee1[_0x262308(0x22d)],_0x1ec201,_0x11aae8),loggerService_1[_0x262308(0x251)][_0x262308(0x21f)](_0x262308(0x275),'/status',_0x262308(0x1f3)+_0x164ee1[_0x262308(0x22d)]+':\x20'+_0x1ec201);throw new Error(_0x262308(0x216)+_0x164ee1[_0x262308(0x22d)]);}const _0x1de68=await _0x164ee1[_0x262308(0x213)]();console['log'](_0x262308(0x205),_0x1de68);let _0x2feb94;try{_0x2feb94=JSON[_0x262308(0x1f8)](_0x1de68);}catch(_0x1d029d){console[_0x262308(0x1fb)](_0x262308(0x208),_0x1d029d),loggerService_1[_0x262308(0x251)]['logWhiteDomainError']('cointopay2',_0x262308(0x239),_0x262308(0x20d)+_0x1d029d);throw new Error(_0x262308(0x201)+_0x1de68);}loggerService_1[_0x262308(0x251)][_0x262308(0x1f9)](_0x262308(0x275),_0x262308(0x239),_0x164ee1[_0x262308(0x22d)],_0x2feb94,_0x11aae8),console[_0x262308(0x267)](_0x262308(0x1ff)),console[_0x262308(0x267)]('Result:',_0x2feb94['result']),console[_0x262308(0x267)]('Status\x20Code:',_0x2feb94[_0x262308(0x260)]),console[_0x262308(0x267)](_0x262308(0x231),_0x2feb94['data']?.[_0x262308(0x211)]),console[_0x262308(0x267)](_0x262308(0x26a),_0x2feb94[_0x262308(0x1f6)]?.[_0x262308(0x22c)]),console[_0x262308(0x267)](_0x262308(0x236),_0x2feb94['data']?.[_0x262308(0x225)]);if(_0x2feb94[_0x262308(0x247)]!=='success'||_0x2feb94['status_code']!==0xc8){const _0x400a6c=_0x2feb94[_0x262308(0x204)]||'Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API';console[_0x262308(0x1fb)](_0x262308(0x249)),console[_0x262308(0x1fb)](_0x262308(0x274),_0x400a6c),loggerService_1['loggerService'][_0x262308(0x21f)](_0x262308(0x275),'/status','Status\x20API\x20Error:\x20'+_0x400a6c);throw new Error(_0x262308(0x246)+_0x400a6c);}if(!_0x2feb94[_0x262308(0x1f6)]){console[_0x262308(0x1fb)](_0x262308(0x23b)),console['error'](_0x262308(0x25f)),loggerService_1['loggerService'][_0x262308(0x21f)](_0x262308(0x275),_0x262308(0x239),_0x262308(0x235));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x1d915b=_0x262308(0x273);switch(_0x2feb94[_0x262308(0x1f6)][_0x262308(0x211)]?.[_0x262308(0x26b)]()){case _0x262308(0x244):_0x1d915b='PAID';break;case _0x262308(0x241):case _0x262308(0x226):case _0x262308(0x1fb):_0x1d915b='FAILED';break;case _0x262308(0x20a):case'timeout':_0x1d915b=_0x262308(0x203);break;case _0x262308(0x238):case _0x262308(0x252):case _0x262308(0x255):case'created':default:_0x1d915b=_0x262308(0x273);break;}let _0x32aca7,_0x5e0537;if(_0x2feb94[_0x262308(0x1f6)][_0x262308(0x242)]){const _0x3042da=_0x2feb94[_0x262308(0x1f6)]['PaymentDetail'];console['log'](_0x262308(0x23f),_0x3042da);const _0x556cf6=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x124cb9 of _0x556cf6){const _0x4c7b10=_0x3042da['match'](_0x124cb9);if(_0x4c7b10){_0x32aca7=_0x4c7b10[0x1],console[_0x262308(0x267)](_0x262308(0x266),_0x32aca7,'using\x20pattern:',_0x124cb9['source']);break;}}if(!_0x32aca7){console[_0x262308(0x267)](_0x262308(0x1f2));const _0x5f073b=_0x3042da['match'](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x5f073b&&(_0x32aca7=_0x5f073b[0x1],console[_0x262308(0x267)](_0x262308(0x24e),_0x32aca7));}_0x5e0537=_0x3042da;}const _0x5a59a9={'iban':_0x32aca7,'bankDetails':_0x5e0537,'transactionId':_0x2feb94[_0x262308(0x1f6)][_0x262308(0x23e)],'coinAddress':_0x2feb94[_0x262308(0x1f6)]['coinAddress'],'qrCodeUrl':_0x2feb94[_0x262308(0x1f6)]['QRCodeURL'],'expiryTime':_0x2feb94[_0x262308(0x1f6)][_0x262308(0x25a)],'createdOn':_0x2feb94[_0x262308(0x1f6)]['CreatedOn'],'confirmedOn':_0x2feb94[_0x262308(0x1f6)][_0x262308(0x229)]};console[_0x262308(0x267)]('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console[_0x262308(0x267)](_0x262308(0x1f4),_0x2feb94[_0x262308(0x1f6)][_0x262308(0x211)],'->',_0x1d915b),console[_0x262308(0x267)](_0x262308(0x26a),_0x2feb94[_0x262308(0x1f6)][_0x262308(0x22c)],_0x2feb94['data'][_0x262308(0x225)]),console[_0x262308(0x267)](_0x262308(0x212),_0x2feb94[_0x262308(0x1f6)][_0x262308(0x23e)]),console[_0x262308(0x267)]('IBAN:',_0x32aca7||_0x262308(0x20b)),console['log'](_0x262308(0x24b),_0x2feb94[_0x262308(0x1f6)]['CreatedOn']),console[_0x262308(0x267)](_0x262308(0x256),_0x2feb94[_0x262308(0x1f6)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x2feb94[_0x262308(0x1f6)][_0x262308(0x211)]?.['toLowerCase']()===_0x262308(0x252))console[_0x262308(0x267)](_0x262308(0x25c));else _0x2feb94['data'][_0x262308(0x211)]?.[_0x262308(0x26b)]()==='paid'&&console[_0x262308(0x267)](_0x262308(0x243));return{'status':_0x1d915b,'amount':parseFloat(_0x2feb94[_0x262308(0x1f6)]['Amount'])||undefined,'currency':_0x2feb94[_0x262308(0x1f6)][_0x262308(0x225)]||_0x262308(0x22e),'paymentDetails':_0x5a59a9};}catch(_0x2e29fd){console['error'](_0x262308(0x237),_0x2e29fd),loggerService_1['loggerService'][_0x262308(0x21f)]('cointopay2',_0x262308(0x239),_0x2e29fd);throw new Error(_0x262308(0x270)+(_0x2e29fd instanceof Error?_0x2e29fd[_0x262308(0x204)]:_0x262308(0x23c)));}}async[a42_0x1d273f(0x21e)](_0x46f3b1){const _0x437c54=a42_0x1d273f,_0x1782f5=await this[_0x437c54(0x21d)](_0x46f3b1);return{'status':_0x1782f5['status'],'amount':_0x1782f5['amount'],'currency':_0x1782f5[_0x437c54(0x20f)]};}async[a42_0x1d273f(0x23a)](_0x502240){const _0x2ae320=a42_0x1d273f;console[_0x2ae320(0x267)](_0x2ae320(0x264),_0x502240);let _0x498a58=_0x2ae320(0x273);switch(_0x502240[_0x2ae320(0x22d)]?.[_0x2ae320(0x26b)]()){case _0x2ae320(0x244):_0x498a58=_0x2ae320(0x245);break;case _0x2ae320(0x241):case _0x2ae320(0x226):case'error':_0x498a58='FAILED';break;case _0x2ae320(0x20a):case'timeout':_0x498a58=_0x2ae320(0x203);break;case'pending':case'waiting':case _0x2ae320(0x252):case _0x2ae320(0x202):default:_0x498a58='PENDING';break;}return{'paymentId':_0x502240[_0x2ae320(0x21c)]||_0x502240['merchant_reference_id']||'','status':_0x498a58,'amount':_0x502240[_0x2ae320(0x24d)],'currency':_0x502240['currency']||_0x2ae320(0x22e)};}}function a42_0x1ab2(_0xe2e919,_0xa9cf22){const _0x1724ca=a42_0x1724();return a42_0x1ab2=function(_0x1ab28d,_0x4d3655){_0x1ab28d=_0x1ab28d-0x1f2;let _0x3004af=_0x1724ca[_0x1ab28d];return _0x3004af;},a42_0x1ab2(_0xe2e919,_0xa9cf22);}exports[a42_0x1d273f(0x26c)]=CoinToPay2Service;