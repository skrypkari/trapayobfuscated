'use strict';const a40_0x49fd14=a40_0x128f;(function(_0x477545,_0x889be){const _0x5141c4=a40_0x128f,_0x40d32d=_0x477545();while(!![]){try{const _0x3b3d97=-parseInt(_0x5141c4(0xcd))/0x1*(parseInt(_0x5141c4(0x8b))/0x2)+-parseInt(_0x5141c4(0xd9))/0x3*(-parseInt(_0x5141c4(0xbd))/0x4)+parseInt(_0x5141c4(0xe5))/0x5*(parseInt(_0x5141c4(0xab))/0x6)+-parseInt(_0x5141c4(0xf6))/0x7*(parseInt(_0x5141c4(0xad))/0x8)+-parseInt(_0x5141c4(0xdf))/0x9*(parseInt(_0x5141c4(0xa2))/0xa)+parseInt(_0x5141c4(0xd0))/0xb*(parseInt(_0x5141c4(0xdc))/0xc)+parseInt(_0x5141c4(0x94))/0xd;if(_0x3b3d97===_0x889be)break;else _0x40d32d['push'](_0x40d32d['shift']());}catch(_0x2c3322){_0x40d32d['push'](_0x40d32d['shift']());}}}(a40_0x4b88,0x7d177));function a40_0x4b88(){const _0x417f49=['HTTP\x20','verifyPayment','coinAddress','üìä\x20Status\x20check\x20URL:','QRCodeURL','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Parsed\x20Result:','780tVkihg','HTTP\x20Status:','status','CoinToPay2Service','timeout','Error\x20message:','Status','Amount','not\x20found','295224DhRLSX','order_id','376QZgXnZ','Failed\x20to\x20parse\x20JSON\x20response:','failed','text','üè¶\x20Payment\x20Detail:','ExpiryTime','gateway_payment_id','application/json','fromEntries','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','checkPaymentStatus','Business\x20Error:\x20','IBAN:','__esModule','Payment\x20URL:','üè¶\x20Extracted\x20IBAN:','4YxuqTq','EUR','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','apiUrl','FAILED','defineProperty','logWhiteDomainError','Incomplete\x20response:\x20missing\x20data','entries','loggerService','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','cointopay2','/create','Gateway\x20Payment\x20ID:','Currency:','20916MEdzNc','TransactionConfirmedOn','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','341CeTuOg','result','statusUrl','Created\x20On:','createPaymentLink','Response\x20data:','Amount:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20COINTOPAY2\x20SUCCESS\x20===','764727wVMjbG','Raw\x20Response\x20Body:','Transaction\x20ID:','167700imabxw','toLowerCase','cancelled','116010jMkkYb','amount','inputCurrency','JSON\x20Parse\x20Error:\x20','https://traffer.uk/gateway/cointopay/status.php','logWhiteDomainRequest','85PQcHeJ','CoinToPay2\x20API\x20error:\x20','processWebhook','Unknown\x20error','headers','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','/status','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','stringify','Confirmed\x20On:','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Missing\x20data\x20in\x20response','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','payment_url','Status:','26761auLAVt','CoinToPay2\x20payment\x20status\x20check\x20error:','Request\x20Body:','waiting','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','logWhiteDomainResponse','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','Status\x20Code:','CreatedOn','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','stack','not\x20confirmed','data','paid','Response\x20Time:','PAID','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','awaiting\x20fiat','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','status_code','Error\x20details:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','log','PENDING','https://traffer.uk/gateway/cointopay/','message','created','Response\x20Body:','Result:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','92UfILZJ','error','pending','Error\x20Message:','TransactionID','HTTP\x20error!\x20status:\x20','match','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','PaymentDetail','14755130sLMKaz','now','expired','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Status\x20Text:','Status\x20API\x20Error:\x20'];a40_0x4b88=function(){return _0x417f49;};return a40_0x4b88();}Object[a40_0x49fd14(0xc3)](exports,a40_0x49fd14(0xba),{'value':!![]}),exports[a40_0x49fd14(0xa5)]=void 0x0;function a40_0x128f(_0x3e7892,_0x365e79){const _0x4b8864=a40_0x4b88();return a40_0x128f=function(_0x128ff2,_0xd90348){_0x128ff2=_0x128ff2-0x7a;let _0x407c5e=_0x4b8864[_0x128ff2];return _0x407c5e;},a40_0x128f(_0x3e7892,_0x365e79);}const loggerService_1=require('../loggerService');class CoinToPay2Service{constructor(){const _0x209aec=a40_0x49fd14;this['apiUrl']=_0x209aec(0x85),this[_0x209aec(0xd2)]=_0x209aec(0xe3),console[_0x209aec(0x83)](_0x209aec(0xc8)),console[_0x209aec(0x83)](_0x209aec(0x9d),this[_0x209aec(0xd2)]);}async[a40_0x49fd14(0xd4)](_0x10c59b){const _0x5afc12=a40_0x49fd14,{orderId:_0x190748,amount:_0x53695b}=_0x10c59b;console[_0x5afc12(0x83)](_0x5afc12(0x7f)+_0x53695b+'\x20EUR');const _0x469a46={'amount':_0x53695b},_0xcfae54=Date[_0x5afc12(0x95)]();try{console[_0x5afc12(0x83)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console[_0x5afc12(0x83)]('URL:',this[_0x5afc12(0xc1)]),console[_0x5afc12(0x83)](_0x5afc12(0xf8),JSON['stringify'](_0x469a46,null,0x2)),console[_0x5afc12(0x83)](_0x5afc12(0xd6),_0x53695b,_0x5afc12(0xfa)),loggerService_1[_0x5afc12(0xc7)]['logWhiteDomainRequest'](_0x5afc12(0xc9),'/create','POST',_0x469a46);const _0x2e2bba=await fetch(this[_0x5afc12(0xc1)],{'method':'POST','headers':{'Content-Type':_0x5afc12(0xb4),'Accept':_0x5afc12(0xb4),'User-Agent':_0x5afc12(0x9f)},'body':JSON[_0x5afc12(0xef)](_0x469a46)}),_0x5c0aa1=Date['now']()-_0xcfae54;console[_0x5afc12(0x83)](_0x5afc12(0x7d)),console['log'](_0x5afc12(0xf5),_0x2e2bba['status']),console[_0x5afc12(0x83)](_0x5afc12(0x98),_0x2e2bba['statusText']),console[_0x5afc12(0x83)]('Headers:',Object[_0x5afc12(0xb5)](_0x2e2bba[_0x5afc12(0xe9)][_0x5afc12(0xc6)]())),console[_0x5afc12(0x83)](_0x5afc12(0x7b),_0x5c0aa1+'ms');const _0x129e7c=await _0x2e2bba[_0x5afc12(0xb0)]();console[_0x5afc12(0x83)](_0x5afc12(0xda),_0x129e7c);if(!_0x2e2bba['ok']){console[_0x5afc12(0x8c)](_0x5afc12(0xf1)),console[_0x5afc12(0x8c)](_0x5afc12(0xa3),_0x2e2bba[_0x5afc12(0xa4)]),console[_0x5afc12(0x8c)](_0x5afc12(0x88),_0x129e7c),loggerService_1[_0x5afc12(0xc7)][_0x5afc12(0xfb)](_0x5afc12(0xc9),_0x5afc12(0xca),_0x2e2bba['status'],_0x129e7c,_0x5c0aa1),loggerService_1['loggerService'][_0x5afc12(0xc4)](_0x5afc12(0xc9),'/create','HTTP\x20'+_0x2e2bba[_0x5afc12(0xa4)]+':\x20'+_0x129e7c);throw new Error(_0x5afc12(0x90)+_0x2e2bba[_0x5afc12(0xa4)]+',\x20body:\x20'+_0x129e7c);}let _0x17a08c;try{_0x17a08c=JSON['parse'](_0x129e7c);}catch(_0xfe88bb){console[_0x5afc12(0x8c)](_0x5afc12(0xae),_0xfe88bb),loggerService_1[_0x5afc12(0xc7)][_0x5afc12(0xc4)](_0x5afc12(0xc9),'/create',_0x5afc12(0xe2)+_0xfe88bb);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20'+_0x129e7c);}console[_0x5afc12(0x83)](_0x5afc12(0xff)),console[_0x5afc12(0x83)](_0x5afc12(0xa1),JSON[_0x5afc12(0xef)](_0x17a08c,null,0x2)),loggerService_1[_0x5afc12(0xc7)][_0x5afc12(0xfb)](_0x5afc12(0xc9),_0x5afc12(0xca),_0x2e2bba[_0x5afc12(0xa4)],_0x17a08c,_0x5c0aa1);if(_0x17a08c[_0x5afc12(0x8c)]){const _0x266215=_0x17a08c[_0x5afc12(0x86)]||_0x17a08c[_0x5afc12(0x8c)]||'Unknown\x20error\x20from\x20CoinToPay2\x20API';console[_0x5afc12(0x8c)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x5afc12(0x8c)]('Error\x20Message:',_0x266215),loggerService_1[_0x5afc12(0xc7)][_0x5afc12(0xc4)](_0x5afc12(0xc9),_0x5afc12(0xca),_0x5afc12(0xb8)+_0x266215);throw new Error(_0x5afc12(0xe6)+_0x266215);}if(!_0x17a08c[_0x5afc12(0xf4)]||!_0x17a08c[_0x5afc12(0xb3)]){console[_0x5afc12(0x8c)](_0x5afc12(0xcf)),console[_0x5afc12(0x8c)](_0x5afc12(0xd7)),console[_0x5afc12(0x8c)](_0x5afc12(0xd5),_0x17a08c),loggerService_1[_0x5afc12(0xc7)][_0x5afc12(0xc4)](_0x5afc12(0xc9),_0x5afc12(0xca),_0x5afc12(0xa0));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x5afc12(0x83)](_0x5afc12(0xd8)),console[_0x5afc12(0x83)](_0x5afc12(0xcb),_0x17a08c['gateway_payment_id']),console[_0x5afc12(0x83)](_0x5afc12(0xbb),_0x17a08c[_0x5afc12(0xf4)]),console[_0x5afc12(0x83)](_0x5afc12(0xd6),_0x53695b,_0x5afc12(0xbe)),{'gateway_payment_id':_0x17a08c['gateway_payment_id'],'payment_url':_0x17a08c[_0x5afc12(0xf4)]};}catch(_0x117a04){console[_0x5afc12(0x8c)](_0x5afc12(0xfc)),console['error'](_0x5afc12(0x81),_0x117a04),loggerService_1['loggerService'][_0x5afc12(0xc4)]('cointopay2','/create',_0x117a04);if(_0x117a04 instanceof Error){console[_0x5afc12(0x8c)](_0x5afc12(0xa7),_0x117a04[_0x5afc12(0x86)]),console[_0x5afc12(0x8c)]('Error\x20stack:',_0x117a04[_0x5afc12(0x100)]);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x117a04[_0x5afc12(0x86)]);}throw new Error(_0x5afc12(0x82));}}async['checkPaymentStatus'](_0x30daf6){const _0xca38=a40_0x49fd14,_0xda3849=Date[_0xca38(0x95)]();try{console[_0xca38(0x83)]('üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0x30daf6);const _0x12e4ae={'gatewayPaymentId':_0x30daf6};loggerService_1['loggerService'][_0xca38(0xe4)](_0xca38(0xc9),_0xca38(0xed),'POST',_0x12e4ae);const _0x5486f6=await fetch(this[_0xca38(0xd2)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0xca38(0xb4),'User-Agent':_0xca38(0x9f)},'body':JSON[_0xca38(0xef)](_0x12e4ae)}),_0x3480d6=Date[_0xca38(0x95)]()-_0xda3849;console[_0xca38(0x83)](_0xca38(0xea)),console['log'](_0xca38(0xf5),_0x5486f6['status']),console[_0xca38(0x83)](_0xca38(0x7b),_0x3480d6+'ms');if(!_0x5486f6['ok']){const _0x152f00=await _0x5486f6['text']();console[_0xca38(0x8c)](_0xca38(0xa3),_0x5486f6['status']),console['error']('Response\x20Body:',_0x152f00),loggerService_1[_0xca38(0xc7)][_0xca38(0xfb)](_0xca38(0xc9),_0xca38(0xed),_0x5486f6[_0xca38(0xa4)],_0x152f00,_0x3480d6),loggerService_1[_0xca38(0xc7)]['logWhiteDomainError']('cointopay2',_0xca38(0xed),_0xca38(0x9a)+_0x5486f6[_0xca38(0xa4)]+':\x20'+_0x152f00);throw new Error(_0xca38(0x90)+_0x5486f6[_0xca38(0xa4)]);}const _0x50dd49=await _0x5486f6['text']();console[_0xca38(0x83)](_0xca38(0xda),_0x50dd49);let _0x312d9f;try{_0x312d9f=JSON['parse'](_0x50dd49);}catch(_0x3abace){console[_0xca38(0x8c)](_0xca38(0xae),_0x3abace),loggerService_1['loggerService'][_0xca38(0xc4)](_0xca38(0xc9),_0xca38(0xed),_0xca38(0xe2)+_0x3abace);throw new Error(_0xca38(0xee)+_0x50dd49);}loggerService_1[_0xca38(0xc7)][_0xca38(0xfb)](_0xca38(0xc9),_0xca38(0xed),_0x5486f6[_0xca38(0xa4)],_0x312d9f,_0x3480d6),console['log'](_0xca38(0xbf)),console[_0xca38(0x83)](_0xca38(0x89),_0x312d9f[_0xca38(0xd1)]),console[_0xca38(0x83)](_0xca38(0xfd),_0x312d9f[_0xca38(0x80)]),console[_0xca38(0x83)]('Payment\x20Status:',_0x312d9f[_0xca38(0x102)]?.[_0xca38(0xa8)]),console[_0xca38(0x83)](_0xca38(0xd6),_0x312d9f[_0xca38(0x102)]?.[_0xca38(0xa9)]),console[_0xca38(0x83)](_0xca38(0xcc),_0x312d9f[_0xca38(0x102)]?.[_0xca38(0xe1)]);if(_0x312d9f['result']!=='success'||_0x312d9f[_0xca38(0x80)]!==0xc8){const _0x39c669=_0x312d9f[_0xca38(0x86)]||_0xca38(0xb6);console[_0xca38(0x8c)](_0xca38(0x92)),console[_0xca38(0x8c)](_0xca38(0x8e),_0x39c669),loggerService_1['loggerService'][_0xca38(0xc4)](_0xca38(0xc9),_0xca38(0xed),_0xca38(0x99)+_0x39c669);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0x39c669);}if(!_0x312d9f[_0xca38(0x102)]){console[_0xca38(0x8c)](_0xca38(0xc0)),console[_0xca38(0x8c)](_0xca38(0xf2)),loggerService_1[_0xca38(0xc7)]['logWhiteDomainError'](_0xca38(0xc9),_0xca38(0xed),_0xca38(0xc5));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x3d36a3=_0xca38(0x84);switch(_0x312d9f[_0xca38(0x102)][_0xca38(0xa8)]?.[_0xca38(0xdd)]()){case _0xca38(0x7a):_0x3d36a3=_0xca38(0x7c);break;case _0xca38(0xde):case _0xca38(0xaf):case _0xca38(0x8c):_0x3d36a3='FAILED';break;case _0xca38(0x96):case _0xca38(0xa6):_0x3d36a3='EXPIRED';break;case _0xca38(0xf9):case _0xca38(0x7e):case _0xca38(0x8d):case _0xca38(0x87):default:_0x3d36a3=_0xca38(0x84);break;}let _0x2a20f9,_0x6f10e2;if(_0x312d9f[_0xca38(0x102)][_0xca38(0x93)]){const _0x2d0419=_0x312d9f[_0xca38(0x102)][_0xca38(0x93)];console[_0xca38(0x83)](_0xca38(0xb1),_0x2d0419);const _0x2601af=_0x2d0419[_0xca38(0x91)](/IBAN\s+([A-Z0-9]+)/i);_0x2601af&&(_0x2a20f9=_0x2601af[0x1],console[_0xca38(0x83)](_0xca38(0xbc),_0x2a20f9)),_0x6f10e2=_0x2d0419;}const _0x1a5c9c={'iban':_0x2a20f9,'bankDetails':_0x6f10e2,'transactionId':_0x312d9f[_0xca38(0x102)][_0xca38(0x8f)],'coinAddress':_0x312d9f[_0xca38(0x102)][_0xca38(0x9c)],'qrCodeUrl':_0x312d9f[_0xca38(0x102)][_0xca38(0x9e)],'expiryTime':_0x312d9f['data'][_0xca38(0xb2)],'createdOn':_0x312d9f[_0xca38(0x102)][_0xca38(0xfe)],'confirmedOn':_0x312d9f[_0xca38(0x102)][_0xca38(0xce)]};console[_0xca38(0x83)](_0xca38(0xec)),console['log']('Status:',_0x312d9f[_0xca38(0x102)][_0xca38(0xa8)],'->',_0x3d36a3),console[_0xca38(0x83)](_0xca38(0xd6),_0x312d9f[_0xca38(0x102)][_0xca38(0xa9)],_0x312d9f[_0xca38(0x102)]['inputCurrency']),console['log'](_0xca38(0xdb),_0x312d9f[_0xca38(0x102)][_0xca38(0x8f)]),console['log'](_0xca38(0xb9),_0x2a20f9||_0xca38(0xaa)),console[_0xca38(0x83)](_0xca38(0xd3),_0x312d9f[_0xca38(0x102)][_0xca38(0xfe)]),console['log'](_0xca38(0xf0),_0x312d9f[_0xca38(0x102)][_0xca38(0xce)]||_0xca38(0x101));if(_0x312d9f[_0xca38(0x102)]['Status']?.['toLowerCase']()===_0xca38(0x7e))console[_0xca38(0x83)](_0xca38(0x97));else _0x312d9f['data'][_0xca38(0xa8)]?.[_0xca38(0xdd)]()===_0xca38(0x7a)&&console[_0xca38(0x83)](_0xca38(0x8a));return{'status':_0x3d36a3,'amount':parseFloat(_0x312d9f[_0xca38(0x102)][_0xca38(0xa9)])||undefined,'currency':_0x312d9f[_0xca38(0x102)]['inputCurrency']||'EUR','paymentDetails':_0x1a5c9c};}catch(_0x2d5eb1){console[_0xca38(0x8c)](_0xca38(0xf7),_0x2d5eb1),loggerService_1[_0xca38(0xc7)][_0xca38(0xc4)](_0xca38(0xc9),_0xca38(0xed),_0x2d5eb1);throw new Error(_0xca38(0xf3)+(_0x2d5eb1 instanceof Error?_0x2d5eb1[_0xca38(0x86)]:_0xca38(0xe8)));}}async[a40_0x49fd14(0x9b)](_0x540c48){const _0x13f0fe=a40_0x49fd14,_0x2b807f=await this[_0x13f0fe(0xb7)](_0x540c48);return{'status':_0x2b807f[_0x13f0fe(0xa4)],'amount':_0x2b807f[_0x13f0fe(0xe0)],'currency':_0x2b807f['currency']};}async[a40_0x49fd14(0xe7)](_0x290fdd){const _0x5d41f0=a40_0x49fd14;console[_0x5d41f0(0x83)](_0x5d41f0(0xeb),_0x290fdd);let _0x33d008=_0x5d41f0(0x84);switch(_0x290fdd[_0x5d41f0(0xa4)]?.[_0x5d41f0(0xdd)]()){case _0x5d41f0(0x7a):_0x33d008='PAID';break;case _0x5d41f0(0xde):case'failed':case _0x5d41f0(0x8c):_0x33d008=_0x5d41f0(0xc2);break;case _0x5d41f0(0x96):case _0x5d41f0(0xa6):_0x33d008='EXPIRED';break;case _0x5d41f0(0x8d):case _0x5d41f0(0xf9):case _0x5d41f0(0x7e):case _0x5d41f0(0x87):default:_0x33d008=_0x5d41f0(0x84);break;}return{'paymentId':_0x290fdd[_0x5d41f0(0xac)]||_0x290fdd['merchant_reference_id']||'','status':_0x33d008,'amount':_0x290fdd[_0x5d41f0(0xe0)],'currency':_0x290fdd['currency']||_0x5d41f0(0xbe)};}}exports[a40_0x49fd14(0xa5)]=CoinToPay2Service;