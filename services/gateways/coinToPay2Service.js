'use strict';const a64_0x194692=a64_0x596e;(function(_0x5c513d,_0x76e333){const _0x14de9a=a64_0x596e,_0x2dd177=_0x5c513d();while(!![]){try{const _0x2b2db9=parseInt(_0x14de9a(0x1ce))/0x1*(-parseInt(_0x14de9a(0x1e1))/0x2)+parseInt(_0x14de9a(0x224))/0x3*(-parseInt(_0x14de9a(0x21f))/0x4)+-parseInt(_0x14de9a(0x222))/0x5*(parseInt(_0x14de9a(0x23d))/0x6)+-parseInt(_0x14de9a(0x221))/0x7+-parseInt(_0x14de9a(0x1d7))/0x8*(-parseInt(_0x14de9a(0x1ca))/0x9)+parseInt(_0x14de9a(0x214))/0xa*(-parseInt(_0x14de9a(0x202))/0xb)+parseInt(_0x14de9a(0x22b))/0xc;if(_0x2b2db9===_0x76e333)break;else _0x2dd177['push'](_0x2dd177['shift']());}catch(_0x16cbc2){_0x2dd177['push'](_0x2dd177['shift']());}}}(a64_0x3f69,0xa3135));function a64_0x596e(_0x223439,_0x322e46){_0x223439=_0x223439-0x1c8;const _0x3f69cf=a64_0x3f69();let _0x596e1e=_0x3f69cf[_0x223439];return _0x596e1e;}Object[a64_0x194692(0x23e)](exports,a64_0x194692(0x24e),{'value':!![]}),exports[a64_0x194692(0x250)]=void 0x0;const loggerService_1=require(a64_0x194692(0x1d2));class CoinToPay2Service{constructor(){const _0x40e761=a64_0x194692;this[_0x40e761(0x1f6)]=_0x40e761(0x235),this['statusUrl']=_0x40e761(0x22f),console[_0x40e761(0x230)](_0x40e761(0x1cd)),console[_0x40e761(0x230)](_0x40e761(0x243),this[_0x40e761(0x1cf)]);}async[a64_0x194692(0x247)](_0x382688){const _0x4ce931=a64_0x194692,{orderId:_0x22ebc7,amount:_0xc5b93b}=_0x382688;console[_0x4ce931(0x230)](_0x4ce931(0x240)+_0xc5b93b+_0x4ce931(0x1ee));const _0x272bcc={'amount':_0xc5b93b},_0xcea1=Date[_0x4ce931(0x1f1)]();try{console[_0x4ce931(0x230)](_0x4ce931(0x239)),console[_0x4ce931(0x230)](_0x4ce931(0x237),this[_0x4ce931(0x1f6)]),console[_0x4ce931(0x230)](_0x4ce931(0x1f4),JSON[_0x4ce931(0x1f0)](_0x272bcc,null,0x2)),console[_0x4ce931(0x230)](_0x4ce931(0x254),_0xc5b93b,'EUR\x20(always\x20EUR\x20for\x20CoinToPay2)'),loggerService_1[_0x4ce931(0x21c)]['logWhiteDomainRequest'](_0x4ce931(0x22c),_0x4ce931(0x213),_0x4ce931(0x1f8),_0x272bcc);const _0x5753a7=await fetch(this['apiUrl'],{'method':_0x4ce931(0x1f8),'headers':{'Content-Type':_0x4ce931(0x23c),'Accept':_0x4ce931(0x23c),'User-Agent':_0x4ce931(0x249)},'body':JSON[_0x4ce931(0x1f0)](_0x272bcc)}),_0x250288=Date[_0x4ce931(0x1f1)]()-_0xcea1;console[_0x4ce931(0x230)](_0x4ce931(0x1fa)),console[_0x4ce931(0x230)]('Status:',_0x5753a7[_0x4ce931(0x20b)]),console[_0x4ce931(0x230)](_0x4ce931(0x1f3),_0x5753a7[_0x4ce931(0x205)]),console[_0x4ce931(0x230)](_0x4ce931(0x20a),Object[_0x4ce931(0x22a)](_0x5753a7['headers'][_0x4ce931(0x200)]())),console[_0x4ce931(0x230)](_0x4ce931(0x20c),_0x250288+'ms');const _0x338c22=await _0x5753a7[_0x4ce931(0x234)]();console['log']('Raw\x20Response\x20Body:',_0x338c22);if(!_0x5753a7['ok']){console[_0x4ce931(0x227)](_0x4ce931(0x1fe)),console[_0x4ce931(0x227)]('HTTP\x20Status:',_0x5753a7['status']),console[_0x4ce931(0x227)](_0x4ce931(0x1e7),_0x338c22),loggerService_1[_0x4ce931(0x21c)][_0x4ce931(0x1e3)](_0x4ce931(0x22c),_0x4ce931(0x213),_0x5753a7[_0x4ce931(0x20b)],_0x338c22,_0x250288),loggerService_1['loggerService'][_0x4ce931(0x24b)](_0x4ce931(0x22c),_0x4ce931(0x213),_0x4ce931(0x1c8)+_0x5753a7['status']+':\x20'+_0x338c22);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5753a7[_0x4ce931(0x20b)]+_0x4ce931(0x220)+_0x338c22);}let _0x22ac7f;try{_0x22ac7f=JSON[_0x4ce931(0x1d8)](_0x338c22);}catch(_0xd005a4){console[_0x4ce931(0x227)](_0x4ce931(0x217),_0xd005a4),loggerService_1['loggerService'][_0x4ce931(0x24b)](_0x4ce931(0x22c),_0x4ce931(0x213),_0x4ce931(0x1f9)+_0xd005a4);throw new Error(_0x4ce931(0x226)+_0x338c22);}console[_0x4ce931(0x230)](_0x4ce931(0x1ef)),console[_0x4ce931(0x230)](_0x4ce931(0x1e0),JSON[_0x4ce931(0x1f0)](_0x22ac7f,null,0x2)),loggerService_1[_0x4ce931(0x21c)][_0x4ce931(0x1e3)](_0x4ce931(0x22c),_0x4ce931(0x213),_0x5753a7['status'],_0x22ac7f,_0x250288);if(_0x22ac7f['error']){const _0x4ce574=_0x22ac7f[_0x4ce931(0x215)]||_0x22ac7f[_0x4ce931(0x227)]||_0x4ce931(0x238);console['error'](_0x4ce931(0x1eb)),console[_0x4ce931(0x227)](_0x4ce931(0x212),_0x4ce574),loggerService_1[_0x4ce931(0x21c)][_0x4ce931(0x24b)](_0x4ce931(0x22c),_0x4ce931(0x213),'Business\x20Error:\x20'+_0x4ce574);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x4ce574);}if(!_0x22ac7f[_0x4ce931(0x1e5)]||!_0x22ac7f[_0x4ce931(0x1e8)]){console[_0x4ce931(0x227)](_0x4ce931(0x248)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x4ce931(0x227)](_0x4ce931(0x233),_0x22ac7f),loggerService_1[_0x4ce931(0x21c)][_0x4ce931(0x24b)](_0x4ce931(0x22c),_0x4ce931(0x213),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x4ce931(0x23b));}console[_0x4ce931(0x230)](_0x4ce931(0x1d4)),console[_0x4ce931(0x230)](_0x4ce931(0x22d),_0x22ac7f[_0x4ce931(0x1e8)]),console[_0x4ce931(0x230)](_0x4ce931(0x216),_0x22ac7f['payment_url']);const _0x7cb8f7=_0x22ac7f[_0x4ce931(0x1e5)]+'&alternative=false';return console[_0x4ce931(0x230)]('Payment\x20URL\x20(modified):',_0x7cb8f7),console[_0x4ce931(0x230)](_0x4ce931(0x254),_0xc5b93b,_0x4ce931(0x246)),{'gateway_payment_id':_0x22ac7f[_0x4ce931(0x1e8)],'payment_url':_0x7cb8f7};}catch(_0x4a1f5f){console[_0x4ce931(0x227)](_0x4ce931(0x1ff)),console[_0x4ce931(0x227)](_0x4ce931(0x242),_0x4a1f5f),loggerService_1['loggerService'][_0x4ce931(0x24b)](_0x4ce931(0x22c),_0x4ce931(0x213),_0x4a1f5f);if(_0x4a1f5f instanceof Error){console[_0x4ce931(0x227)](_0x4ce931(0x244),_0x4a1f5f[_0x4ce931(0x215)]),console[_0x4ce931(0x227)]('Error\x20stack:',_0x4a1f5f[_0x4ce931(0x22e)]);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x4a1f5f['message']);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a64_0x194692(0x236)](_0x1f67dc){const _0x250202=a64_0x194692,_0x301e9d=Date[_0x250202(0x1f1)]();try{console['log']('üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0x1f67dc);const _0xcf4b9a={'gatewayPaymentId':_0x1f67dc};loggerService_1[_0x250202(0x21c)]['logWhiteDomainRequest'](_0x250202(0x22c),_0x250202(0x1f5),'POST',_0xcf4b9a);const _0xf84b61=await fetch(this[_0x250202(0x1cf)],{'method':_0x250202(0x1f8),'headers':{'Content-Type':'application/json','Accept':_0x250202(0x23c),'User-Agent':_0x250202(0x249)},'body':JSON['stringify'](_0xcf4b9a)}),_0x1b1b50=Date['now']()-_0x301e9d;console[_0x250202(0x230)](_0x250202(0x1e2)),console[_0x250202(0x230)]('Status:',_0xf84b61[_0x250202(0x20b)]),console[_0x250202(0x230)](_0x250202(0x20c),_0x1b1b50+'ms');if(!_0xf84b61['ok']){const _0xc26ea=await _0xf84b61[_0x250202(0x234)]();console[_0x250202(0x227)](_0x250202(0x1cc),_0xf84b61['status']),console[_0x250202(0x227)]('Response\x20Body:',_0xc26ea),loggerService_1[_0x250202(0x21c)]['logWhiteDomainResponse'](_0x250202(0x22c),'/status',_0xf84b61[_0x250202(0x20b)],_0xc26ea,_0x1b1b50),loggerService_1[_0x250202(0x21c)]['logWhiteDomainError'](_0x250202(0x22c),_0x250202(0x1f5),'HTTP\x20'+_0xf84b61[_0x250202(0x20b)]+':\x20'+_0xc26ea);throw new Error(_0x250202(0x1da)+_0xf84b61['status']);}const _0x3de999=await _0xf84b61['text']();console[_0x250202(0x230)](_0x250202(0x24c),_0x3de999);let _0x47ee96;try{_0x47ee96=JSON[_0x250202(0x1d8)](_0x3de999);}catch(_0x440aff){console[_0x250202(0x227)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x440aff),loggerService_1[_0x250202(0x21c)]['logWhiteDomainError'](_0x250202(0x22c),'/status',_0x250202(0x1f9)+_0x440aff);throw new Error(_0x250202(0x231)+_0x3de999);}loggerService_1['loggerService'][_0x250202(0x1e3)]('cointopay2','/status',_0xf84b61[_0x250202(0x20b)],_0x47ee96,_0x1b1b50),console[_0x250202(0x230)](_0x250202(0x21e)),console[_0x250202(0x230)](_0x250202(0x1db),_0x47ee96['result']),console[_0x250202(0x230)](_0x250202(0x1f2),_0x47ee96['status_code']),console[_0x250202(0x230)]('Payment\x20Status:',_0x47ee96[_0x250202(0x20f)]?.[_0x250202(0x1f7)]),console[_0x250202(0x230)](_0x250202(0x254),_0x47ee96['data']?.[_0x250202(0x1e4)]),console[_0x250202(0x230)](_0x250202(0x24a),_0x47ee96[_0x250202(0x20f)]?.[_0x250202(0x219)]);if(_0x47ee96[_0x250202(0x1cb)]!==_0x250202(0x245)||_0x47ee96[_0x250202(0x1ed)]!==0xc8){const _0x2eb4d8=_0x47ee96[_0x250202(0x215)]||_0x250202(0x206);console[_0x250202(0x227)](_0x250202(0x1ec)),console[_0x250202(0x227)](_0x250202(0x212),_0x2eb4d8),loggerService_1[_0x250202(0x21c)]['logWhiteDomainError']('cointopay2',_0x250202(0x1f5),_0x250202(0x24f)+_0x2eb4d8);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0x2eb4d8);}if(!_0x47ee96[_0x250202(0x20f)]){console[_0x250202(0x227)]('===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x250202(0x227)](_0x250202(0x1c9)),loggerService_1[_0x250202(0x21c)][_0x250202(0x24b)](_0x250202(0x22c),_0x250202(0x1f5),_0x250202(0x1dd));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x591b02='PENDING';switch(_0x47ee96['data']['Status']?.['toLowerCase']()){case _0x250202(0x1e6):_0x591b02=_0x250202(0x21d);break;case'cancelled':case'failed':case _0x250202(0x227):_0x591b02=_0x250202(0x209);break;case _0x250202(0x1dc):case _0x250202(0x1d3):_0x591b02=_0x250202(0x24d);break;case _0x250202(0x1d0):case'awaiting\x20fiat':case _0x250202(0x204):case'created':default:_0x591b02=_0x250202(0x232);break;}let _0x2cec7e,_0x389e38;if(_0x47ee96[_0x250202(0x20f)][_0x250202(0x229)]){const _0x43be0a=_0x47ee96['data'][_0x250202(0x229)];console['log'](_0x250202(0x210),_0x43be0a);const _0x244a89=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x2f4879 of _0x244a89){const _0x28653c=_0x43be0a[_0x250202(0x1ea)](_0x2f4879);if(_0x28653c){_0x2cec7e=_0x28653c[0x1],console['log'](_0x250202(0x1df),_0x2cec7e,_0x250202(0x1fd),_0x2f4879[_0x250202(0x1fb)]);break;}}if(!_0x2cec7e){console[_0x250202(0x230)](_0x250202(0x203));const _0x4574e2=_0x43be0a[_0x250202(0x1ea)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x4574e2&&(_0x2cec7e=_0x4574e2[0x1],console[_0x250202(0x230)]('üè¶\x20Extracted\x20IBAN\x20via\x20fallback:',_0x2cec7e));}_0x389e38=_0x43be0a;}const _0x2c2f0a={'iban':_0x2cec7e,'bankDetails':_0x389e38,'transactionId':_0x47ee96[_0x250202(0x20f)][_0x250202(0x1d6)],'coinAddress':_0x47ee96[_0x250202(0x20f)]['coinAddress'],'qrCodeUrl':_0x47ee96[_0x250202(0x20f)][_0x250202(0x253)],'expiryTime':_0x47ee96['data'][_0x250202(0x218)],'createdOn':_0x47ee96[_0x250202(0x20f)][_0x250202(0x1de)],'confirmedOn':_0x47ee96['data'][_0x250202(0x21b)]};console[_0x250202(0x230)](_0x250202(0x1d5)),console[_0x250202(0x230)](_0x250202(0x1d9),_0x47ee96['data']['Status'],'->',_0x591b02),console[_0x250202(0x230)](_0x250202(0x254),_0x47ee96[_0x250202(0x20f)]['Amount'],_0x47ee96[_0x250202(0x20f)]['inputCurrency']),console[_0x250202(0x230)](_0x250202(0x23f),_0x47ee96[_0x250202(0x20f)][_0x250202(0x1d6)]),console[_0x250202(0x230)](_0x250202(0x225),_0x2cec7e||'not\x20found'),console[_0x250202(0x230)](_0x250202(0x1e9),_0x47ee96[_0x250202(0x20f)]['CreatedOn']),console['log']('Confirmed\x20On:',_0x47ee96[_0x250202(0x20f)][_0x250202(0x21b)]||_0x250202(0x21a));if(_0x47ee96[_0x250202(0x20f)][_0x250202(0x1f7)]?.[_0x250202(0x223)]()===_0x250202(0x201))console[_0x250202(0x230)](_0x250202(0x1fc));else _0x47ee96['data'][_0x250202(0x1f7)]?.[_0x250202(0x223)]()===_0x250202(0x1e6)&&console[_0x250202(0x230)](_0x250202(0x207));return{'status':_0x591b02,'amount':parseFloat(_0x47ee96[_0x250202(0x20f)]['Amount'])||undefined,'currency':_0x47ee96['data'][_0x250202(0x219)]||_0x250202(0x246),'paymentDetails':_0x2c2f0a};}catch(_0x582cee){console[_0x250202(0x227)](_0x250202(0x211),_0x582cee),loggerService_1[_0x250202(0x21c)]['logWhiteDomainError']('cointopay2',_0x250202(0x1f5),_0x582cee);throw new Error(_0x250202(0x208)+(_0x582cee instanceof Error?_0x582cee['message']:_0x250202(0x1d1)));}}async['verifyPayment'](_0x48d1c7){const _0x12401d=a64_0x194692,_0x495b3f=await this['checkPaymentStatus'](_0x48d1c7);return{'status':_0x495b3f[_0x12401d(0x20b)],'amount':_0x495b3f[_0x12401d(0x251)],'currency':_0x495b3f[_0x12401d(0x252)]};}async[a64_0x194692(0x23a)](_0x81c3fb){const _0x59fd6a=a64_0x194692;console[_0x59fd6a(0x230)]('Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x81c3fb);let _0x4a95b9='PENDING';switch(_0x81c3fb[_0x59fd6a(0x20b)]?.['toLowerCase']()){case _0x59fd6a(0x1e6):_0x4a95b9=_0x59fd6a(0x21d);break;case _0x59fd6a(0x228):case _0x59fd6a(0x20e):case _0x59fd6a(0x227):_0x4a95b9=_0x59fd6a(0x209);break;case _0x59fd6a(0x1dc):case _0x59fd6a(0x1d3):_0x4a95b9='EXPIRED';break;case _0x59fd6a(0x204):case _0x59fd6a(0x1d0):case _0x59fd6a(0x201):case _0x59fd6a(0x241):default:_0x4a95b9=_0x59fd6a(0x232);break;}return{'paymentId':_0x81c3fb['order_id']||_0x81c3fb[_0x59fd6a(0x20d)]||'','status':_0x4a95b9,'amount':_0x81c3fb[_0x59fd6a(0x251)],'currency':_0x81c3fb[_0x59fd6a(0x252)]||_0x59fd6a(0x246)};}}function a64_0x3f69(){const _0x54f655=['Headers:','status','Response\x20Time:','merchant_reference_id','failed','data','üè¶\x20Payment\x20Detail:','CoinToPay2\x20payment\x20status\x20check\x20error:','Error\x20Message:','/create','20LCLxKZ','message','Payment\x20URL\x20(original):','Failed\x20to\x20parse\x20JSON\x20response:','ExpiryTime','inputCurrency','not\x20confirmed','TransactionConfirmedOn','loggerService','PAID','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','65612TErQOf',',\x20body:\x20','1868167pYsmzA','737405pdfXpZ','toLowerCase','12rHffpo','IBAN:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','error','cancelled','PaymentDetail','fromEntries','26687352zkgjGL','cointopay2','Gateway\x20Payment\x20ID:','stack','https://traffer.uk/gateway/cointopay/status.php','log','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','PENDING','Response\x20data:','text','https://traffer.uk/gateway/cointopay/','checkPaymentStatus','URL:','Unknown\x20error\x20from\x20CoinToPay2\x20API','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','processWebhook','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','application/json','18mBLHSP','defineProperty','Transaction\x20ID:','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','created','Error\x20details:','üìä\x20Status\x20check\x20URL:','Error\x20message:','success','EUR','createPaymentLink','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Payment\x20System/1.0\x20(CoinToPay2)','Currency:','logWhiteDomainError','Raw\x20Response\x20Body:','EXPIRED','__esModule','Status\x20API\x20Error:\x20','CoinToPay2Service','amount','currency','QRCodeURL','Amount:','HTTP\x20','Missing\x20data\x20in\x20response','27oEriHv','result','HTTP\x20Status:','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','25bGFAoL','statusUrl','waiting','Unknown\x20error','../loggerService','timeout','===\x20COINTOPAY2\x20SUCCESS\x20===','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','TransactionID','3157744QbFuBG','parse','Status:','HTTP\x20error!\x20status:\x20','Result:','expired','Incomplete\x20response:\x20missing\x20data','CreatedOn','üè¶\x20Extracted\x20IBAN:','Parsed\x20Result:','101030alrTnJ','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','logWhiteDomainResponse','Amount','payment_url','paid','Response\x20Body:','gateway_payment_id','Created\x20On:','match','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','status_code','\x20EUR','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','stringify','now','Status\x20Code:','Status\x20Text:','Request\x20Body:','/status','apiUrl','Status','POST','JSON\x20Parse\x20Error:\x20','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','source','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','using\x20pattern:','===\x20COINTOPAY2\x20API\x20ERROR\x20===','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','entries','awaiting\x20fiat','3862826XfSQLE','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','pending','statusText','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','FAILED'];a64_0x3f69=function(){return _0x54f655;};return a64_0x3f69();}exports[a64_0x194692(0x250)]=CoinToPay2Service;