'use strict';const a40_0x2cb249=a40_0x57c6;(function(_0x3bdd5c,_0x5c3df9){const _0x2c7faa=a40_0x57c6,_0x2594b7=_0x3bdd5c();while(!![]){try{const _0x449f0c=parseInt(_0x2c7faa(0x1f7))/0x1*(-parseInt(_0x2c7faa(0x20e))/0x2)+-parseInt(_0x2c7faa(0x1c4))/0x3*(-parseInt(_0x2c7faa(0x21b))/0x4)+parseInt(_0x2c7faa(0x1a4))/0x5+parseInt(_0x2c7faa(0x1c2))/0x6*(-parseInt(_0x2c7faa(0x1f1))/0x7)+parseInt(_0x2c7faa(0x1a8))/0x8*(-parseInt(_0x2c7faa(0x202))/0x9)+parseInt(_0x2c7faa(0x1d7))/0xa*(parseInt(_0x2c7faa(0x1af))/0xb)+-parseInt(_0x2c7faa(0x212))/0xc*(parseInt(_0x2c7faa(0x1d9))/0xd);if(_0x449f0c===_0x5c3df9)break;else _0x2594b7['push'](_0x2594b7['shift']());}catch(_0x5091eb){_0x2594b7['push'](_0x2594b7['shift']());}}}(a40_0x116b,0xbe3a1));Object[a40_0x2cb249(0x1eb)](exports,a40_0x2cb249(0x1f8),{'value':!![]}),exports['CoinToPay2Service']=void 0x0;const loggerService_1=require(a40_0x2cb249(0x1ea));class CoinToPay2Service{constructor(){const _0x154909=a40_0x2cb249;this['apiUrl']=_0x154909(0x19a),this['statusUrl']=_0x154909(0x1da),console[_0x154909(0x1e9)]('🪙\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0x154909(0x1e9)](_0x154909(0x1be),this[_0x154909(0x20f)]);}async[a40_0x2cb249(0x1a1)](_0x2667e9){const _0x2162c7=a40_0x2cb249,{orderId:_0x145f66,amount:_0x2e163c}=_0x2667e9;console[_0x2162c7(0x1e9)](_0x2162c7(0x1f5)+_0x2e163c+_0x2162c7(0x1a6));const _0x2cb45a={'amount':_0x2e163c},_0x96bbfa=Date['now']();try{console[_0x2162c7(0x1e9)](_0x2162c7(0x220)),console[_0x2162c7(0x1e9)](_0x2162c7(0x1cf),this[_0x2162c7(0x1b0)]),console['log'](_0x2162c7(0x211),JSON['stringify'](_0x2cb45a,null,0x2)),console[_0x2162c7(0x1e9)]('Amount:',_0x2e163c,_0x2162c7(0x201)),loggerService_1[_0x2162c7(0x1ab)][_0x2162c7(0x1a7)]('cointopay2',_0x2162c7(0x21a),_0x2162c7(0x1bf),_0x2cb45a);const _0x4fb8bc=await fetch(this[_0x2162c7(0x1b0)],{'method':'POST','headers':{'Content-Type':_0x2162c7(0x1c1),'Accept':_0x2162c7(0x1c1),'User-Agent':_0x2162c7(0x1fb)},'body':JSON[_0x2162c7(0x1dd)](_0x2cb45a)}),_0x51a19f=Date[_0x2162c7(0x1d8)]()-_0x96bbfa;console['log'](_0x2162c7(0x203)),console['log']('Status:',_0x4fb8bc['status']),console['log'](_0x2162c7(0x1ce),_0x4fb8bc[_0x2162c7(0x19f)]),console[_0x2162c7(0x1e9)](_0x2162c7(0x206),Object[_0x2162c7(0x1e4)](_0x4fb8bc[_0x2162c7(0x199)][_0x2162c7(0x1cc)]())),console['log']('Response\x20Time:',_0x51a19f+'ms');const _0x281f53=await _0x4fb8bc['text']();console['log'](_0x2162c7(0x207),_0x281f53);if(!_0x4fb8bc['ok']){console['error'](_0x2162c7(0x1d6)),console[_0x2162c7(0x1c6)](_0x2162c7(0x1bd),_0x4fb8bc[_0x2162c7(0x1df)]),console[_0x2162c7(0x1c6)](_0x2162c7(0x1b8),_0x281f53),loggerService_1[_0x2162c7(0x1ab)][_0x2162c7(0x20c)](_0x2162c7(0x1de),_0x2162c7(0x21a),_0x4fb8bc[_0x2162c7(0x1df)],_0x281f53,_0x51a19f),loggerService_1['loggerService'][_0x2162c7(0x1c8)](_0x2162c7(0x1de),_0x2162c7(0x21a),_0x2162c7(0x1a9)+_0x4fb8bc[_0x2162c7(0x1df)]+':\x20'+_0x281f53);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4fb8bc['status']+_0x2162c7(0x1c5)+_0x281f53);}let _0x48a38c;try{_0x48a38c=JSON[_0x2162c7(0x20a)](_0x281f53);}catch(_0x13139a){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x13139a),loggerService_1[_0x2162c7(0x1ab)][_0x2162c7(0x1c8)](_0x2162c7(0x1de),_0x2162c7(0x21a),_0x2162c7(0x1b4)+_0x13139a);throw new Error(_0x2162c7(0x217)+_0x281f53);}console[_0x2162c7(0x1e9)]('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console['log'](_0x2162c7(0x1d5),JSON[_0x2162c7(0x1dd)](_0x48a38c,null,0x2)),loggerService_1[_0x2162c7(0x1ab)][_0x2162c7(0x20c)](_0x2162c7(0x1de),_0x2162c7(0x21a),_0x4fb8bc[_0x2162c7(0x1df)],_0x48a38c,_0x51a19f);if(_0x48a38c['error']){const _0x1f7ce4=_0x48a38c[_0x2162c7(0x1f4)]||_0x48a38c[_0x2162c7(0x1c6)]||_0x2162c7(0x1e0);console[_0x2162c7(0x1c6)](_0x2162c7(0x19e)),console[_0x2162c7(0x1c6)](_0x2162c7(0x1bb),_0x1f7ce4),loggerService_1[_0x2162c7(0x1ab)]['logWhiteDomainError'](_0x2162c7(0x1de),_0x2162c7(0x21a),_0x2162c7(0x1c0)+_0x1f7ce4);throw new Error(_0x2162c7(0x218)+_0x1f7ce4);}if(!_0x48a38c['payment_url']||!_0x48a38c[_0x2162c7(0x1a3)]){console[_0x2162c7(0x1c6)](_0x2162c7(0x1ff)),console[_0x2162c7(0x1c6)](_0x2162c7(0x1e1)),console[_0x2162c7(0x1c6)](_0x2162c7(0x1ba),_0x48a38c),loggerService_1[_0x2162c7(0x1ab)]['logWhiteDomainError'](_0x2162c7(0x1de),_0x2162c7(0x21a),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x2162c7(0x19c));}return console['log'](_0x2162c7(0x1b7)),console[_0x2162c7(0x1e9)]('Gateway\x20Payment\x20ID:',_0x48a38c['gateway_payment_id']),console[_0x2162c7(0x1e9)]('Payment\x20URL:',_0x48a38c[_0x2162c7(0x1a5)]),console[_0x2162c7(0x1e9)]('Amount:',_0x2e163c,'EUR'),{'gateway_payment_id':_0x48a38c[_0x2162c7(0x1a3)],'payment_url':_0x48a38c[_0x2162c7(0x1a5)]};}catch(_0x501690){console[_0x2162c7(0x1c6)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x2162c7(0x1c6)](_0x2162c7(0x1e7),_0x501690),loggerService_1[_0x2162c7(0x1ab)][_0x2162c7(0x1c8)](_0x2162c7(0x1de),_0x2162c7(0x21a),_0x501690);if(_0x501690 instanceof Error){console['error'](_0x2162c7(0x1cb),_0x501690[_0x2162c7(0x1f4)]),console[_0x2162c7(0x1c6)]('Error\x20stack:',_0x501690['stack']);throw new Error(_0x2162c7(0x1f2)+_0x501690[_0x2162c7(0x1f4)]);}throw new Error(_0x2162c7(0x205));}}async['checkPaymentStatus'](_0x28ad51){const _0x490f19=a40_0x2cb249,_0x448283=Date['now']();try{console['log']('📊\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0x28ad51);const _0xddc4d6={'gatewayPaymentId':_0x28ad51};loggerService_1[_0x490f19(0x1ab)][_0x490f19(0x1a7)](_0x490f19(0x1de),_0x490f19(0x1b2),_0x490f19(0x1bf),_0xddc4d6);const _0x38a4e1=await fetch(this['statusUrl'],{'method':_0x490f19(0x1bf),'headers':{'Content-Type':_0x490f19(0x1c1),'Accept':'application/json','User-Agent':_0x490f19(0x1fb)},'body':JSON[_0x490f19(0x1dd)](_0xddc4d6)}),_0x2910e0=Date[_0x490f19(0x1d8)]()-_0x448283;console[_0x490f19(0x1e9)](_0x490f19(0x1b1)),console[_0x490f19(0x1e9)](_0x490f19(0x1bc),_0x38a4e1['status']),console[_0x490f19(0x1e9)](_0x490f19(0x1c3),_0x2910e0+'ms');if(!_0x38a4e1['ok']){const _0x1b8a40=await _0x38a4e1[_0x490f19(0x1ef)]();console[_0x490f19(0x1c6)]('HTTP\x20Status:',_0x38a4e1[_0x490f19(0x1df)]),console['error']('Response\x20Body:',_0x1b8a40),loggerService_1[_0x490f19(0x1ab)]['logWhiteDomainResponse'](_0x490f19(0x1de),'/status',_0x38a4e1[_0x490f19(0x1df)],_0x1b8a40,_0x2910e0),loggerService_1['loggerService']['logWhiteDomainError'](_0x490f19(0x1de),_0x490f19(0x1b2),'HTTP\x20'+_0x38a4e1[_0x490f19(0x1df)]+':\x20'+_0x1b8a40);throw new Error(_0x490f19(0x1e8)+_0x38a4e1['status']);}const _0x2055ac=await _0x38a4e1['text']();console['log']('Raw\x20Response\x20Body:',_0x2055ac);let _0x2748b1;try{_0x2748b1=JSON[_0x490f19(0x20a)](_0x2055ac);}catch(_0x518903){console['error'](_0x490f19(0x1ec),_0x518903),loggerService_1[_0x490f19(0x1ab)]['logWhiteDomainError'](_0x490f19(0x1de),_0x490f19(0x1b2),'JSON\x20Parse\x20Error:\x20'+_0x518903);throw new Error(_0x490f19(0x1ee)+_0x2055ac);}loggerService_1['loggerService'][_0x490f19(0x20c)](_0x490f19(0x1de),_0x490f19(0x1b2),_0x38a4e1[_0x490f19(0x1df)],_0x2748b1,_0x2910e0),console['log'](_0x490f19(0x1d4)),console['log'](_0x490f19(0x1ac),_0x2748b1[_0x490f19(0x1fd)]),console[_0x490f19(0x1e9)](_0x490f19(0x215),_0x2748b1['status_code']),console[_0x490f19(0x1e9)]('Payment\x20Status:',_0x2748b1[_0x490f19(0x204)]?.[_0x490f19(0x1d1)]),console[_0x490f19(0x1e9)]('Amount:',_0x2748b1['data']?.['Amount']),console[_0x490f19(0x1e9)](_0x490f19(0x219),_0x2748b1[_0x490f19(0x204)]?.['inputCurrency']);if(_0x2748b1[_0x490f19(0x1fd)]!=='success'||_0x2748b1['status_code']!==0xc8){const _0x112ecd=_0x2748b1[_0x490f19(0x1f4)]||_0x490f19(0x1db);console[_0x490f19(0x1c6)](_0x490f19(0x1b3)),console[_0x490f19(0x1c6)](_0x490f19(0x1bb),_0x112ecd),loggerService_1[_0x490f19(0x1ab)][_0x490f19(0x1c8)](_0x490f19(0x1de),'/status','Status\x20API\x20Error:\x20'+_0x112ecd);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0x112ecd);}if(!_0x2748b1[_0x490f19(0x204)]){console[_0x490f19(0x1c6)](_0x490f19(0x1ae)),console[_0x490f19(0x1c6)](_0x490f19(0x21d)),loggerService_1[_0x490f19(0x1ab)][_0x490f19(0x1c8)](_0x490f19(0x1de),_0x490f19(0x1b2),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x490f19(0x1dc));}let _0x51cf5b='PENDING';switch(_0x2748b1[_0x490f19(0x204)][_0x490f19(0x1d1)]?.[_0x490f19(0x200)]()){case'paid':_0x51cf5b=_0x490f19(0x214);break;case _0x490f19(0x19d):case _0x490f19(0x1b5):case _0x490f19(0x1c6):_0x51cf5b='FAILED';break;case _0x490f19(0x1ad):case _0x490f19(0x1e2):_0x51cf5b=_0x490f19(0x216);break;case _0x490f19(0x1e6):case _0x490f19(0x20d):case _0x490f19(0x1d0):case _0x490f19(0x1fa):default:_0x51cf5b=_0x490f19(0x1c9);break;}let _0x5a7034,_0x18ea69;if(_0x2748b1[_0x490f19(0x204)][_0x490f19(0x1d3)]){const _0x93d362=_0x2748b1[_0x490f19(0x204)][_0x490f19(0x1d3)];console[_0x490f19(0x1e9)](_0x490f19(0x1f0),_0x93d362);const _0x2562b7=_0x93d362[_0x490f19(0x19b)](/IBAN\s+([A-Z0-9]+)/i);_0x2562b7&&(_0x5a7034=_0x2562b7[0x1],console[_0x490f19(0x1e9)]('🏦\x20Extracted\x20IBAN:',_0x5a7034)),_0x18ea69=_0x93d362;}const _0x4e7568={'iban':_0x5a7034,'bankDetails':_0x18ea69,'transactionId':_0x2748b1[_0x490f19(0x204)]['TransactionID'],'coinAddress':_0x2748b1['data'][_0x490f19(0x198)],'qrCodeUrl':_0x2748b1[_0x490f19(0x204)][_0x490f19(0x210)],'expiryTime':_0x2748b1[_0x490f19(0x204)][_0x490f19(0x1fc)],'createdOn':_0x2748b1[_0x490f19(0x204)][_0x490f19(0x1ed)],'confirmedOn':_0x2748b1[_0x490f19(0x204)]['TransactionConfirmedOn']};console['log'](_0x490f19(0x1f9)),console[_0x490f19(0x1e9)]('Status:',_0x2748b1[_0x490f19(0x204)][_0x490f19(0x1d1)],'->',_0x51cf5b),console[_0x490f19(0x1e9)](_0x490f19(0x1ca),_0x2748b1['data']['Amount'],_0x2748b1['data'][_0x490f19(0x1b9)]),console[_0x490f19(0x1e9)](_0x490f19(0x208),_0x2748b1[_0x490f19(0x204)][_0x490f19(0x1f6)]),console[_0x490f19(0x1e9)](_0x490f19(0x1aa),_0x5a7034||'not\x20found'),console[_0x490f19(0x1e9)](_0x490f19(0x21e),_0x2748b1[_0x490f19(0x204)][_0x490f19(0x1ed)]),console['log']('Confirmed\x20On:',_0x2748b1['data'][_0x490f19(0x1e3)]||_0x490f19(0x1e5));if(_0x2748b1[_0x490f19(0x204)][_0x490f19(0x1d1)]?.[_0x490f19(0x200)]()==='awaiting\x20fiat')console[_0x490f19(0x1e9)]('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x2748b1[_0x490f19(0x204)][_0x490f19(0x1d1)]?.['toLowerCase']()===_0x490f19(0x21c)&&console[_0x490f19(0x1e9)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x51cf5b,'amount':parseFloat(_0x2748b1['data'][_0x490f19(0x21f)])||undefined,'currency':_0x2748b1[_0x490f19(0x204)][_0x490f19(0x1b9)]||'EUR','paymentDetails':_0x4e7568};}catch(_0x4c03ae){console[_0x490f19(0x1c6)]('CoinToPay2\x20payment\x20status\x20check\x20error:',_0x4c03ae),loggerService_1[_0x490f19(0x1ab)][_0x490f19(0x1c8)](_0x490f19(0x1de),_0x490f19(0x1b2),_0x4c03ae);throw new Error(_0x490f19(0x1fe)+(_0x4c03ae instanceof Error?_0x4c03ae[_0x490f19(0x1f4)]:_0x490f19(0x213)));}}async['verifyPayment'](_0x10bbb8){const _0x5a9677=a40_0x2cb249,_0x38aa7a=await this[_0x5a9677(0x1f3)](_0x10bbb8);return{'status':_0x38aa7a[_0x5a9677(0x1df)],'amount':_0x38aa7a[_0x5a9677(0x1c7)],'currency':_0x38aa7a[_0x5a9677(0x1cd)]};}async[a40_0x2cb249(0x20b)](_0x2aed17){const _0x4c368e=a40_0x2cb249;console['log']('Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x2aed17);let _0x3a2d56=_0x4c368e(0x1c9);switch(_0x2aed17[_0x4c368e(0x1df)]?.['toLowerCase']()){case _0x4c368e(0x21c):_0x3a2d56='PAID';break;case _0x4c368e(0x19d):case _0x4c368e(0x1b5):case _0x4c368e(0x1c6):_0x3a2d56=_0x4c368e(0x1a2);break;case _0x4c368e(0x1ad):case'timeout':_0x3a2d56=_0x4c368e(0x216);break;case'pending':case'waiting':case _0x4c368e(0x20d):case _0x4c368e(0x1fa):default:_0x3a2d56=_0x4c368e(0x1c9);break;}return{'paymentId':_0x2aed17[_0x4c368e(0x1a0)]||_0x2aed17[_0x4c368e(0x1b6)]||'','status':_0x3a2d56,'amount':_0x2aed17[_0x4c368e(0x1c7)],'currency':_0x2aed17[_0x4c368e(0x1cd)]||_0x4c368e(0x209)};}}exports[a40_0x2cb249(0x1d2)]=CoinToPay2Service;function a40_0x57c6(_0x5eab6e,_0x3147cf){const _0x116bec=a40_0x116b();return a40_0x57c6=function(_0x57c630,_0x48683d){_0x57c630=_0x57c630-0x198;let _0x177562=_0x116bec[_0x57c630];return _0x177562;},a40_0x57c6(_0x5eab6e,_0x3147cf);}function a40_0x116b(){const _0x2b5c13=['amount','logWhiteDomainError','PENDING','Amount:','Error\x20message:','entries','currency','Status\x20Text:','URL:','pending','Status','CoinToPay2Service','PaymentDetail','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','Parsed\x20Result:','===\x20COINTOPAY2\x20API\x20ERROR\x20===','253900ZFBoOy','now','2405BvdWBs','https://traffer.uk/gateway/cointopay/status.php','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','stringify','cointopay2','status','Unknown\x20error\x20from\x20CoinToPay2\x20API','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','timeout','TransactionConfirmedOn','fromEntries','not\x20confirmed','waiting','Error\x20details:','HTTP\x20error!\x20status:\x20','log','../loggerService','defineProperty','Failed\x20to\x20parse\x20JSON\x20response:','CreatedOn','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','text','🏦\x20Payment\x20Detail:','7PZuGLF','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','checkPaymentStatus','message','🪙\x20Creating\x20CoinToPay2\x20payment:\x20','TransactionID','552KvZEnP','__esModule','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','created','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','ExpiryTime','result','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','toLowerCase','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','45USzDTB','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','data','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','Headers:','Raw\x20Response\x20Body:','Transaction\x20ID:','EUR','parse','processWebhook','logWhiteDomainResponse','awaiting\x20fiat','1960gwySLf','statusUrl','QRCodeURL','Request\x20Body:','29544HTapbH','Unknown\x20error','PAID','Status\x20Code:','EXPIRED','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','CoinToPay2\x20API\x20error:\x20','Currency:','/create','56gOWDJp','paid','Missing\x20data\x20in\x20response','Created\x20On:','Amount','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','coinAddress','headers','https://traffer.uk/gateway/cointopay/','match','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','cancelled','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','statusText','order_id','createPaymentLink','FAILED','gateway_payment_id','5652295bwUcjC','payment_url','\x20EUR','logWhiteDomainRequest','2075984MZXBWH','HTTP\x20','IBAN:','loggerService','Result:','expired','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','308CrcsEE','apiUrl','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','/status','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','JSON\x20Parse\x20Error:\x20','failed','merchant_reference_id','===\x20COINTOPAY2\x20SUCCESS\x20===','Response\x20Body:','inputCurrency','Response\x20data:','Error\x20Message:','Status:','HTTP\x20Status:','📊\x20Status\x20check\x20URL:','POST','Business\x20Error:\x20','application/json','1187652RWVvMt','Response\x20Time:','306354drNAFx',',\x20body:\x20','error'];a40_0x116b=function(){return _0x2b5c13;};return a40_0x116b();}