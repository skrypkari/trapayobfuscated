'use strict';const a40_0xb61f2d=a40_0x271a;(function(_0x1ba538,_0x1c57d9){const _0x57f895=a40_0x271a,_0x3f2de2=_0x1ba538();while(!![]){try{const _0x1ce87b=-parseInt(_0x57f895(0x211))/0x1+parseInt(_0x57f895(0x229))/0x2*(-parseInt(_0x57f895(0x1c7))/0x3)+-parseInt(_0x57f895(0x20e))/0x4*(-parseInt(_0x57f895(0x1dc))/0x5)+parseInt(_0x57f895(0x1c6))/0x6*(-parseInt(_0x57f895(0x1fc))/0x7)+-parseInt(_0x57f895(0x1d5))/0x8*(parseInt(_0x57f895(0x217))/0x9)+-parseInt(_0x57f895(0x22e))/0xa+parseInt(_0x57f895(0x1de))/0xb;if(_0x1ce87b===_0x1c57d9)break;else _0x3f2de2['push'](_0x3f2de2['shift']());}catch(_0xf15b06){_0x3f2de2['push'](_0x3f2de2['shift']());}}}(a40_0x2b3a,0x492c8));function a40_0x2b3a(){const _0x19ea64=['waiting','Status\x20Text:','Amount:','PaymentDetail','Confirmed\x20On:','JSON\x20Parse\x20Error:\x20','üìä\x20Status\x20check\x20URL:','text','status_code','EUR','now','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','Unknown\x20error\x20from\x20CoinToPay2\x20API','defineProperty','491156vMviWh','üè¶\x20Extracted\x20IBAN:','status','526037KDYXmu','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','stack','cancelled','log','Payment\x20Status:','333dXOQWg','currency','verifyPayment','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','Response\x20Body:','payment_url','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20Message:','IBAN:','ExpiryTime','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Error\x20details:','cointopay2','Incomplete\x20response:\x20missing\x20data','application/json','Amount','apiUrl','Transaction\x20ID:','14LhPXeu','TransactionID','logWhiteDomainResponse','not\x20found','HTTP\x20','4858740MhBfqd','Currency:','/create','===\x20COINTOPAY2\x20API\x20ERROR\x20===','logWhiteDomainRequest','TransactionConfirmedOn','processWebhook','FAILED','PAID','Status:','inputCurrency','amount','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','gateway_payment_id','coinAddress','CoinToPay2\x20status\x20API\x20error:\x20','createPaymentLink','statusUrl','Status','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','stringify','PENDING','Business\x20Error:\x20','fromEntries','Result:','failed','URL:','CoinToPay2\x20payment\x20status\x20check\x20error:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','error','POST','117174POkvRi','114564SPgMFV','timeout','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','logWhiteDomainError','data','Failed\x20to\x20parse\x20JSON\x20response:','HTTP\x20error!\x20status:\x20','paid','Error\x20message:','HTTP\x20Status:','pending','../loggerService','merchant_reference_id','__esModule','48704ilHxQK','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','===\x20COINTOPAY2\x20SUCCESS\x20===','Status\x20API\x20Error:\x20','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20stack:','parse','15UdVmJu','expired','21594309cJvFmS','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','loggerService','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Request\x20Body:','message','EXPIRED','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','entries','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','Unknown\x20error','statusText','created','\x20EUR','/status','https://traffer.uk/gateway/cointopay/status.php','awaiting\x20fiat','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','https://traffer.uk/gateway/cointopay/','checkPaymentStatus','CoinToPay2Service','Response\x20Time:','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','toLowerCase','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','success','Created\x20On:','Raw\x20Response\x20Body:','189BzsKSk','CreatedOn','result','match'];a40_0x2b3a=function(){return _0x19ea64;};return a40_0x2b3a();}Object[a40_0xb61f2d(0x20d)](exports,a40_0xb61f2d(0x1d4),{'value':!![]}),exports[a40_0xb61f2d(0x1f3)]=void 0x0;function a40_0x271a(_0x5dab96,_0x2d6434){const _0x2b3a21=a40_0x2b3a();return a40_0x271a=function(_0x271ad2,_0x453d3c){_0x271ad2=_0x271ad2-0x1c1;let _0x223ae3=_0x2b3a21[_0x271ad2];return _0x223ae3;},a40_0x271a(_0x5dab96,_0x2d6434);}const loggerService_1=require(a40_0xb61f2d(0x1d2));class CoinToPay2Service{constructor(){const _0x5f408f=a40_0xb61f2d;this[_0x5f408f(0x227)]=_0x5f408f(0x1f1),this[_0x5f408f(0x23f)]=_0x5f408f(0x1ee),console[_0x5f408f(0x215)](_0x5f408f(0x20b)),console[_0x5f408f(0x215)](_0x5f408f(0x206),this[_0x5f408f(0x23f)]);}async[a40_0xb61f2d(0x23e)](_0x6a8b21){const _0x3dc9b4=a40_0xb61f2d,{orderId:_0x162c80,amount:_0x58ff64}=_0x6a8b21;console[_0x3dc9b4(0x215)]('ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20'+_0x58ff64+_0x3dc9b4(0x1ec));const _0x5afc15={'amount':_0x58ff64},_0x9b7ad2=Date['now']();try{console[_0x3dc9b4(0x215)](_0x3dc9b4(0x221)),console['log'](_0x3dc9b4(0x1c1),this['apiUrl']),console[_0x3dc9b4(0x215)](_0x3dc9b4(0x1e3),JSON[_0x3dc9b4(0x243)](_0x5afc15,null,0x2)),console['log'](_0x3dc9b4(0x202),_0x58ff64,_0x3dc9b4(0x1d6)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x3dc9b4(0x223),'/create',_0x3dc9b4(0x1c5),_0x5afc15);const _0x46eab7=await fetch(this[_0x3dc9b4(0x227)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x3dc9b4(0x225),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x3dc9b4(0x243)](_0x5afc15)}),_0x5e2b54=Date[_0x3dc9b4(0x20a)]()-_0x9b7ad2;console['log']('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console[_0x3dc9b4(0x215)](_0x3dc9b4(0x237),_0x46eab7[_0x3dc9b4(0x210)]),console[_0x3dc9b4(0x215)](_0x3dc9b4(0x201),_0x46eab7[_0x3dc9b4(0x1ea)]),console[_0x3dc9b4(0x215)]('Headers:',Object[_0x3dc9b4(0x246)](_0x46eab7['headers'][_0x3dc9b4(0x1e7)]())),console[_0x3dc9b4(0x215)]('Response\x20Time:',_0x5e2b54+'ms');const _0x2d1a83=await _0x46eab7[_0x3dc9b4(0x207)]();console[_0x3dc9b4(0x215)](_0x3dc9b4(0x1fb),_0x2d1a83);if(!_0x46eab7['ok']){console[_0x3dc9b4(0x1c4)](_0x3dc9b4(0x231)),console['error']('HTTP\x20Status:',_0x46eab7[_0x3dc9b4(0x210)]),console[_0x3dc9b4(0x1c4)](_0x3dc9b4(0x21b),_0x2d1a83),loggerService_1[_0x3dc9b4(0x1e1)][_0x3dc9b4(0x22b)](_0x3dc9b4(0x223),_0x3dc9b4(0x230),_0x46eab7[_0x3dc9b4(0x210)],_0x2d1a83,_0x5e2b54),loggerService_1[_0x3dc9b4(0x1e1)][_0x3dc9b4(0x1ca)](_0x3dc9b4(0x223),_0x3dc9b4(0x230),_0x3dc9b4(0x22d)+_0x46eab7['status']+':\x20'+_0x2d1a83);throw new Error(_0x3dc9b4(0x1cd)+_0x46eab7['status']+',\x20body:\x20'+_0x2d1a83);}let _0x44e71c;try{_0x44e71c=JSON[_0x3dc9b4(0x1db)](_0x2d1a83);}catch(_0x549130){console[_0x3dc9b4(0x1c4)](_0x3dc9b4(0x1cc),_0x549130),loggerService_1[_0x3dc9b4(0x1e1)][_0x3dc9b4(0x1ca)]('cointopay2',_0x3dc9b4(0x230),_0x3dc9b4(0x205)+_0x549130);throw new Error(_0x3dc9b4(0x1c3)+_0x2d1a83);}console['log'](_0x3dc9b4(0x23a)),console['log']('Parsed\x20Result:',JSON[_0x3dc9b4(0x243)](_0x44e71c,null,0x2)),loggerService_1[_0x3dc9b4(0x1e1)][_0x3dc9b4(0x22b)](_0x3dc9b4(0x223),_0x3dc9b4(0x230),_0x46eab7[_0x3dc9b4(0x210)],_0x44e71c,_0x5e2b54);if(_0x44e71c[_0x3dc9b4(0x1c4)]){const _0x4f912d=_0x44e71c[_0x3dc9b4(0x1e4)]||_0x44e71c[_0x3dc9b4(0x1c4)]||_0x3dc9b4(0x20c);console[_0x3dc9b4(0x1c4)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x3dc9b4(0x1c4)](_0x3dc9b4(0x21e),_0x4f912d),loggerService_1['loggerService'][_0x3dc9b4(0x1ca)](_0x3dc9b4(0x223),_0x3dc9b4(0x230),_0x3dc9b4(0x245)+_0x4f912d);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x4f912d);}if(!_0x44e71c['payment_url']||!_0x44e71c[_0x3dc9b4(0x23b)]){console[_0x3dc9b4(0x1c4)](_0x3dc9b4(0x1d9)),console[_0x3dc9b4(0x1c4)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error']('Response\x20data:',_0x44e71c),loggerService_1[_0x3dc9b4(0x1e1)]['logWhiteDomainError']('cointopay2',_0x3dc9b4(0x230),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x3dc9b4(0x1df));}return console[_0x3dc9b4(0x215)](_0x3dc9b4(0x1d7)),console[_0x3dc9b4(0x215)]('Gateway\x20Payment\x20ID:',_0x44e71c[_0x3dc9b4(0x23b)]),console[_0x3dc9b4(0x215)]('Payment\x20URL:',_0x44e71c['payment_url']),console[_0x3dc9b4(0x215)](_0x3dc9b4(0x202),_0x58ff64,_0x3dc9b4(0x209)),{'gateway_payment_id':_0x44e71c[_0x3dc9b4(0x23b)],'payment_url':_0x44e71c[_0x3dc9b4(0x21c)]};}catch(_0x50aca4){console[_0x3dc9b4(0x1c4)](_0x3dc9b4(0x212)),console['error'](_0x3dc9b4(0x222),_0x50aca4),loggerService_1[_0x3dc9b4(0x1e1)][_0x3dc9b4(0x1ca)]('cointopay2','/create',_0x50aca4);if(_0x50aca4 instanceof Error){console[_0x3dc9b4(0x1c4)](_0x3dc9b4(0x1cf),_0x50aca4[_0x3dc9b4(0x1e4)]),console['error'](_0x3dc9b4(0x1da),_0x50aca4[_0x3dc9b4(0x213)]);throw new Error(_0x3dc9b4(0x1e6)+_0x50aca4[_0x3dc9b4(0x1e4)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x214dbc){const _0x2ed150=a40_0xb61f2d,_0x1ebe53=Date['now']();try{console[_0x2ed150(0x215)](_0x2ed150(0x1f5)+_0x214dbc);const _0x5850a2={'gatewayPaymentId':_0x214dbc};loggerService_1[_0x2ed150(0x1e1)][_0x2ed150(0x232)](_0x2ed150(0x223),_0x2ed150(0x1ed),'POST',_0x5850a2);const _0x29cc21=await fetch(this[_0x2ed150(0x23f)],{'method':_0x2ed150(0x1c5),'headers':{'Content-Type':_0x2ed150(0x225),'Accept':_0x2ed150(0x225),'User-Agent':_0x2ed150(0x241)},'body':JSON[_0x2ed150(0x243)](_0x5850a2)}),_0x44eb91=Date[_0x2ed150(0x20a)]()-_0x1ebe53;console[_0x2ed150(0x215)](_0x2ed150(0x1e0)),console[_0x2ed150(0x215)](_0x2ed150(0x237),_0x29cc21[_0x2ed150(0x210)]),console[_0x2ed150(0x215)](_0x2ed150(0x1f4),_0x44eb91+'ms');if(!_0x29cc21['ok']){const _0x4cd1a4=await _0x29cc21[_0x2ed150(0x207)]();console[_0x2ed150(0x1c4)](_0x2ed150(0x1d0),_0x29cc21[_0x2ed150(0x210)]),console[_0x2ed150(0x1c4)](_0x2ed150(0x21b),_0x4cd1a4),loggerService_1[_0x2ed150(0x1e1)][_0x2ed150(0x22b)]('cointopay2',_0x2ed150(0x1ed),_0x29cc21[_0x2ed150(0x210)],_0x4cd1a4,_0x44eb91),loggerService_1[_0x2ed150(0x1e1)][_0x2ed150(0x1ca)](_0x2ed150(0x223),'/status',_0x2ed150(0x22d)+_0x29cc21[_0x2ed150(0x210)]+':\x20'+_0x4cd1a4);throw new Error(_0x2ed150(0x1cd)+_0x29cc21[_0x2ed150(0x210)]);}const _0xd4d936=await _0x29cc21['text']();console[_0x2ed150(0x215)](_0x2ed150(0x1fb),_0xd4d936);let _0x1f0297;try{_0x1f0297=JSON[_0x2ed150(0x1db)](_0xd4d936);}catch(_0x28a8f2){console[_0x2ed150(0x1c4)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x28a8f2),loggerService_1[_0x2ed150(0x1e1)][_0x2ed150(0x1ca)](_0x2ed150(0x223),'/status',_0x2ed150(0x205)+_0x28a8f2);throw new Error(_0x2ed150(0x1f8)+_0xd4d936);}loggerService_1['loggerService'][_0x2ed150(0x22b)]('cointopay2',_0x2ed150(0x1ed),_0x29cc21[_0x2ed150(0x210)],_0x1f0297,_0x44eb91),console[_0x2ed150(0x215)](_0x2ed150(0x1f6)),console[_0x2ed150(0x215)](_0x2ed150(0x247),_0x1f0297['result']),console[_0x2ed150(0x215)]('Status\x20Code:',_0x1f0297[_0x2ed150(0x208)]),console['log'](_0x2ed150(0x216),_0x1f0297[_0x2ed150(0x1cb)]?.['Status']),console[_0x2ed150(0x215)](_0x2ed150(0x202),_0x1f0297[_0x2ed150(0x1cb)]?.[_0x2ed150(0x226)]),console[_0x2ed150(0x215)](_0x2ed150(0x22f),_0x1f0297[_0x2ed150(0x1cb)]?.['inputCurrency']);if(_0x1f0297[_0x2ed150(0x1fe)]!==_0x2ed150(0x1f9)||_0x1f0297[_0x2ed150(0x208)]!==0xc8){const _0x5dd680=_0x1f0297[_0x2ed150(0x1e4)]||'Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API';console[_0x2ed150(0x1c4)](_0x2ed150(0x242)),console[_0x2ed150(0x1c4)](_0x2ed150(0x21e),_0x5dd680),loggerService_1[_0x2ed150(0x1e1)]['logWhiteDomainError'](_0x2ed150(0x223),_0x2ed150(0x1ed),_0x2ed150(0x1d8)+_0x5dd680);throw new Error(_0x2ed150(0x23d)+_0x5dd680);}if(!_0x1f0297[_0x2ed150(0x1cb)]){console[_0x2ed150(0x1c4)](_0x2ed150(0x21d)),console[_0x2ed150(0x1c4)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x2ed150(0x1e1)][_0x2ed150(0x1ca)](_0x2ed150(0x223),_0x2ed150(0x1ed),_0x2ed150(0x224));throw new Error(_0x2ed150(0x1e8));}let _0x5bc7e9=_0x2ed150(0x244);switch(_0x1f0297[_0x2ed150(0x1cb)]['Status']?.[_0x2ed150(0x1f7)]()){case _0x2ed150(0x1ce):_0x5bc7e9=_0x2ed150(0x236);break;case _0x2ed150(0x214):case _0x2ed150(0x248):case _0x2ed150(0x1c4):_0x5bc7e9='FAILED';break;case _0x2ed150(0x1dd):case _0x2ed150(0x1c8):_0x5bc7e9=_0x2ed150(0x1e5);break;case _0x2ed150(0x200):case _0x2ed150(0x1ef):case _0x2ed150(0x1d1):case'created':default:_0x5bc7e9=_0x2ed150(0x244);break;}let _0x345c24,_0x1ed00c;if(_0x1f0297[_0x2ed150(0x1cb)][_0x2ed150(0x203)]){const _0x213ccf=_0x1f0297['data'][_0x2ed150(0x203)];console[_0x2ed150(0x215)]('üè¶\x20Payment\x20Detail:',_0x213ccf);const _0x5c62ad=_0x213ccf[_0x2ed150(0x1ff)](/IBAN\s+([A-Z0-9]+)/i);_0x5c62ad&&(_0x345c24=_0x5c62ad[0x1],console[_0x2ed150(0x215)](_0x2ed150(0x20f),_0x345c24)),_0x1ed00c=_0x213ccf;}const _0x48a2f4={'iban':_0x345c24,'bankDetails':_0x1ed00c,'transactionId':_0x1f0297[_0x2ed150(0x1cb)]['TransactionID'],'coinAddress':_0x1f0297[_0x2ed150(0x1cb)][_0x2ed150(0x23c)],'qrCodeUrl':_0x1f0297[_0x2ed150(0x1cb)]['QRCodeURL'],'expiryTime':_0x1f0297[_0x2ed150(0x1cb)][_0x2ed150(0x220)],'createdOn':_0x1f0297[_0x2ed150(0x1cb)][_0x2ed150(0x1fd)],'confirmedOn':_0x1f0297[_0x2ed150(0x1cb)][_0x2ed150(0x233)]};console[_0x2ed150(0x215)](_0x2ed150(0x21a)),console[_0x2ed150(0x215)](_0x2ed150(0x237),_0x1f0297[_0x2ed150(0x1cb)][_0x2ed150(0x240)],'->',_0x5bc7e9),console[_0x2ed150(0x215)](_0x2ed150(0x202),_0x1f0297['data'][_0x2ed150(0x226)],_0x1f0297[_0x2ed150(0x1cb)]['inputCurrency']),console[_0x2ed150(0x215)](_0x2ed150(0x228),_0x1f0297[_0x2ed150(0x1cb)][_0x2ed150(0x22a)]),console[_0x2ed150(0x215)](_0x2ed150(0x21f),_0x345c24||_0x2ed150(0x22c)),console[_0x2ed150(0x215)](_0x2ed150(0x1fa),_0x1f0297[_0x2ed150(0x1cb)]['CreatedOn']),console['log'](_0x2ed150(0x204),_0x1f0297[_0x2ed150(0x1cb)][_0x2ed150(0x233)]||'not\x20confirmed');if(_0x1f0297[_0x2ed150(0x1cb)]['Status']?.[_0x2ed150(0x1f7)]()===_0x2ed150(0x1ef))console[_0x2ed150(0x215)](_0x2ed150(0x1f0));else _0x1f0297['data'][_0x2ed150(0x240)]?.['toLowerCase']()===_0x2ed150(0x1ce)&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x5bc7e9,'amount':parseFloat(_0x1f0297[_0x2ed150(0x1cb)][_0x2ed150(0x226)])||undefined,'currency':_0x1f0297[_0x2ed150(0x1cb)][_0x2ed150(0x238)]||_0x2ed150(0x209),'paymentDetails':_0x48a2f4};}catch(_0xb5eb54){console[_0x2ed150(0x1c4)](_0x2ed150(0x1c2),_0xb5eb54),loggerService_1[_0x2ed150(0x1e1)][_0x2ed150(0x1ca)](_0x2ed150(0x223),_0x2ed150(0x1ed),_0xb5eb54);throw new Error(_0x2ed150(0x1c9)+(_0xb5eb54 instanceof Error?_0xb5eb54[_0x2ed150(0x1e4)]:_0x2ed150(0x1e9)));}}async[a40_0xb61f2d(0x219)](_0x5d0253){const _0x2c1f4a=a40_0xb61f2d,_0x4e10e6=await this[_0x2c1f4a(0x1f2)](_0x5d0253);return{'status':_0x4e10e6[_0x2c1f4a(0x210)],'amount':_0x4e10e6[_0x2c1f4a(0x239)],'currency':_0x4e10e6[_0x2c1f4a(0x218)]};}async[a40_0xb61f2d(0x234)](_0x111f0b){const _0x307fbb=a40_0xb61f2d;console[_0x307fbb(0x215)](_0x307fbb(0x1e2),_0x111f0b);let _0x5a9150=_0x307fbb(0x244);switch(_0x111f0b[_0x307fbb(0x210)]?.['toLowerCase']()){case _0x307fbb(0x1ce):_0x5a9150=_0x307fbb(0x236);break;case'cancelled':case _0x307fbb(0x248):case'error':_0x5a9150=_0x307fbb(0x235);break;case _0x307fbb(0x1dd):case _0x307fbb(0x1c8):_0x5a9150=_0x307fbb(0x1e5);break;case _0x307fbb(0x1d1):case'waiting':case'awaiting\x20fiat':case _0x307fbb(0x1eb):default:_0x5a9150=_0x307fbb(0x244);break;}return{'paymentId':_0x111f0b['order_id']||_0x111f0b[_0x307fbb(0x1d3)]||'','status':_0x5a9150,'amount':_0x111f0b[_0x307fbb(0x239)],'currency':_0x111f0b['currency']||_0x307fbb(0x209)};}}exports[a40_0xb61f2d(0x1f3)]=CoinToPay2Service;