'use strict';const a46_0x585ca2=a46_0x329e;(function(_0x4fde3e,_0x222553){const _0x453f65=a46_0x329e,_0x104f34=_0x4fde3e();while(!![]){try{const _0x5517a4=-parseInt(_0x453f65(0x183))/0x1+parseInt(_0x453f65(0x173))/0x2*(-parseInt(_0x453f65(0x124))/0x3)+-parseInt(_0x453f65(0x11a))/0x4*(parseInt(_0x453f65(0x136))/0x5)+-parseInt(_0x453f65(0x106))/0x6+-parseInt(_0x453f65(0x139))/0x7+parseInt(_0x453f65(0x16f))/0x8+parseInt(_0x453f65(0x140))/0x9*(parseInt(_0x453f65(0x120))/0xa);if(_0x5517a4===_0x222553)break;else _0x104f34['push'](_0x104f34['shift']());}catch(_0x4c57c3){_0x104f34['push'](_0x104f34['shift']());}}}(a46_0x57f4,0x5fbba));Object[a46_0x585ca2(0x107)](exports,'__esModule',{'value':!![]}),exports[a46_0x585ca2(0x150)]=void 0x0;function a46_0x329e(_0x123f7d,_0x4a42de){const _0x57f4b=a46_0x57f4();return a46_0x329e=function(_0x329efc,_0x2cba5f){_0x329efc=_0x329efc-0xfc;let _0x3a76f4=_0x57f4b[_0x329efc];return _0x3a76f4;},a46_0x329e(_0x123f7d,_0x4a42de);}const loggerService_1=require('../loggerService');class CoinToPay2Service{constructor(){const _0x1d96cb=a46_0x585ca2;this[_0x1d96cb(0x135)]=_0x1d96cb(0x13b),this[_0x1d96cb(0x141)]=_0x1d96cb(0x144),console[_0x1d96cb(0x133)](_0x1d96cb(0x13e)),console[_0x1d96cb(0x133)](_0x1d96cb(0x10a),this[_0x1d96cb(0x141)]);}async[a46_0x585ca2(0x143)](_0x14a184){const _0x9a5fdf=a46_0x585ca2,{orderId:_0x222ed7,amount:_0x1f9370}=_0x14a184;console['log'](_0x9a5fdf(0x164)+_0x1f9370+'\x20EUR');const _0x4e8b40={'amount':_0x1f9370},_0x563cbc=Date['now']();try{console[_0x9a5fdf(0x133)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console[_0x9a5fdf(0x133)](_0x9a5fdf(0x17a),this[_0x9a5fdf(0x135)]),console[_0x9a5fdf(0x133)](_0x9a5fdf(0x123),JSON[_0x9a5fdf(0x11d)](_0x4e8b40,null,0x2)),console[_0x9a5fdf(0x133)](_0x9a5fdf(0x14e),_0x1f9370,_0x9a5fdf(0x154)),loggerService_1[_0x9a5fdf(0x11b)][_0x9a5fdf(0x13d)](_0x9a5fdf(0x127),_0x9a5fdf(0x14d),_0x9a5fdf(0x148),_0x4e8b40);const _0x494b4a=await fetch(this[_0x9a5fdf(0x135)],{'method':_0x9a5fdf(0x148),'headers':{'Content-Type':_0x9a5fdf(0x170),'Accept':_0x9a5fdf(0x170),'User-Agent':_0x9a5fdf(0x14f)},'body':JSON[_0x9a5fdf(0x11d)](_0x4e8b40)}),_0x233cfb=Date[_0x9a5fdf(0x155)]()-_0x563cbc;console[_0x9a5fdf(0x133)](_0x9a5fdf(0x16c)),console['log'](_0x9a5fdf(0xfc),_0x494b4a[_0x9a5fdf(0x11e)]),console[_0x9a5fdf(0x133)](_0x9a5fdf(0x126),_0x494b4a['statusText']),console['log'](_0x9a5fdf(0x16b),Object[_0x9a5fdf(0x180)](_0x494b4a['headers']['entries']())),console[_0x9a5fdf(0x133)]('Response\x20Time:',_0x233cfb+'ms');const _0x4b7d99=await _0x494b4a[_0x9a5fdf(0x13f)]();console[_0x9a5fdf(0x133)](_0x9a5fdf(0x17e),_0x4b7d99);if(!_0x494b4a['ok']){console['error']('===\x20COINTOPAY2\x20API\x20ERROR\x20==='),console[_0x9a5fdf(0x122)](_0x9a5fdf(0x119),_0x494b4a['status']),console[_0x9a5fdf(0x122)]('Response\x20Body:',_0x4b7d99),loggerService_1[_0x9a5fdf(0x11b)][_0x9a5fdf(0x12f)](_0x9a5fdf(0x127),_0x9a5fdf(0x14d),_0x494b4a[_0x9a5fdf(0x11e)],_0x4b7d99,_0x233cfb),loggerService_1[_0x9a5fdf(0x11b)][_0x9a5fdf(0x10d)](_0x9a5fdf(0x127),_0x9a5fdf(0x14d),_0x9a5fdf(0x157)+_0x494b4a[_0x9a5fdf(0x11e)]+':\x20'+_0x4b7d99);throw new Error(_0x9a5fdf(0x112)+_0x494b4a[_0x9a5fdf(0x11e)]+',\x20body:\x20'+_0x4b7d99);}let _0x8d12a2;try{_0x8d12a2=JSON['parse'](_0x4b7d99);}catch(_0x4768a7){console[_0x9a5fdf(0x122)](_0x9a5fdf(0x162),_0x4768a7),loggerService_1['loggerService'][_0x9a5fdf(0x10d)]('cointopay2',_0x9a5fdf(0x14d),_0x9a5fdf(0x176)+_0x4768a7);throw new Error(_0x9a5fdf(0x166)+_0x4b7d99);}console[_0x9a5fdf(0x133)](_0x9a5fdf(0x129)),console['log'](_0x9a5fdf(0x15f),JSON[_0x9a5fdf(0x11d)](_0x8d12a2,null,0x2)),loggerService_1[_0x9a5fdf(0x11b)][_0x9a5fdf(0x12f)](_0x9a5fdf(0x127),_0x9a5fdf(0x14d),_0x494b4a[_0x9a5fdf(0x11e)],_0x8d12a2,_0x233cfb);if(_0x8d12a2['error']){const _0x4bbac0=_0x8d12a2[_0x9a5fdf(0x179)]||_0x8d12a2[_0x9a5fdf(0x122)]||_0x9a5fdf(0x178);console[_0x9a5fdf(0x122)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x9a5fdf(0x122)](_0x9a5fdf(0x17d),_0x4bbac0),loggerService_1[_0x9a5fdf(0x11b)]['logWhiteDomainError'](_0x9a5fdf(0x127),_0x9a5fdf(0x14d),_0x9a5fdf(0x105)+_0x4bbac0);throw new Error(_0x9a5fdf(0x186)+_0x4bbac0);}if(!_0x8d12a2[_0x9a5fdf(0x10e)]||!_0x8d12a2[_0x9a5fdf(0x145)]){console[_0x9a5fdf(0x122)](_0x9a5fdf(0x102)),console[_0x9a5fdf(0x122)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error'](_0x9a5fdf(0x14a),_0x8d12a2),loggerService_1[_0x9a5fdf(0x11b)][_0x9a5fdf(0x10d)](_0x9a5fdf(0x127),_0x9a5fdf(0x14d),_0x9a5fdf(0x159));throw new Error(_0x9a5fdf(0x175));}console[_0x9a5fdf(0x133)](_0x9a5fdf(0x134)),console[_0x9a5fdf(0x133)](_0x9a5fdf(0x116),_0x8d12a2[_0x9a5fdf(0x145)]),console[_0x9a5fdf(0x133)]('Payment\x20URL\x20(original):',_0x8d12a2[_0x9a5fdf(0x10e)]);const _0x55e27f=_0x8d12a2[_0x9a5fdf(0x10e)]+_0x9a5fdf(0x16e);return console[_0x9a5fdf(0x133)](_0x9a5fdf(0x131),_0x55e27f),console['log'](_0x9a5fdf(0x14e),_0x1f9370,_0x9a5fdf(0x110)),{'gateway_payment_id':_0x8d12a2[_0x9a5fdf(0x145)],'payment_url':_0x55e27f};}catch(_0x4eb5c5){console[_0x9a5fdf(0x122)](_0x9a5fdf(0x12e)),console['error'](_0x9a5fdf(0xff),_0x4eb5c5),loggerService_1[_0x9a5fdf(0x11b)][_0x9a5fdf(0x10d)]('cointopay2',_0x9a5fdf(0x14d),_0x4eb5c5);if(_0x4eb5c5 instanceof Error){console[_0x9a5fdf(0x122)](_0x9a5fdf(0x15c),_0x4eb5c5['message']),console[_0x9a5fdf(0x122)](_0x9a5fdf(0x12b),_0x4eb5c5['stack']);throw new Error(_0x9a5fdf(0x13c)+_0x4eb5c5[_0x9a5fdf(0x179)]);}throw new Error(_0x9a5fdf(0x16d));}}async[a46_0x585ca2(0x104)](_0x19bff9){const _0x312fee=a46_0x585ca2,_0x5aff27=Date['now']();try{console[_0x312fee(0x133)](_0x312fee(0x100)+_0x19bff9);const _0x3eacdf={'gatewayPaymentId':_0x19bff9};loggerService_1[_0x312fee(0x11b)][_0x312fee(0x13d)](_0x312fee(0x127),_0x312fee(0x181),_0x312fee(0x148),_0x3eacdf);const _0x530baf=await fetch(this[_0x312fee(0x141)],{'method':_0x312fee(0x148),'headers':{'Content-Type':'application/json','Accept':_0x312fee(0x170),'User-Agent':_0x312fee(0x14f)},'body':JSON[_0x312fee(0x11d)](_0x3eacdf)}),_0x5eae7e=Date[_0x312fee(0x155)]()-_0x5aff27;console[_0x312fee(0x133)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log'](_0x312fee(0xfc),_0x530baf['status']),console['log'](_0x312fee(0x12d),_0x5eae7e+'ms');if(!_0x530baf['ok']){const _0x8101f8=await _0x530baf[_0x312fee(0x13f)]();console['error'](_0x312fee(0x119),_0x530baf[_0x312fee(0x11e)]),console['error']('Response\x20Body:',_0x8101f8),loggerService_1[_0x312fee(0x11b)][_0x312fee(0x12f)](_0x312fee(0x127),_0x312fee(0x181),_0x530baf[_0x312fee(0x11e)],_0x8101f8,_0x5eae7e),loggerService_1[_0x312fee(0x11b)][_0x312fee(0x10d)]('cointopay2',_0x312fee(0x181),'HTTP\x20'+_0x530baf['status']+':\x20'+_0x8101f8);throw new Error(_0x312fee(0x112)+_0x530baf['status']);}const _0x1f4b13=await _0x530baf['text']();console['log']('Raw\x20Response\x20Body:',_0x1f4b13);let _0x2b3368;try{_0x2b3368=JSON['parse'](_0x1f4b13);}catch(_0x35e713){console[_0x312fee(0x122)](_0x312fee(0x162),_0x35e713),loggerService_1[_0x312fee(0x11b)][_0x312fee(0x10d)](_0x312fee(0x127),_0x312fee(0x181),_0x312fee(0x176)+_0x35e713);throw new Error(_0x312fee(0x115)+_0x1f4b13);}loggerService_1['loggerService'][_0x312fee(0x12f)]('cointopay2',_0x312fee(0x181),_0x530baf[_0x312fee(0x11e)],_0x2b3368,_0x5eae7e),console['log']('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x312fee(0x114),_0x2b3368['result']),console[_0x312fee(0x133)](_0x312fee(0x147),_0x2b3368['status_code']),console[_0x312fee(0x133)](_0x312fee(0x113),_0x2b3368[_0x312fee(0x184)]?.[_0x312fee(0x174)]),console['log']('Amount:',_0x2b3368['data']?.[_0x312fee(0x15b)]),console[_0x312fee(0x133)](_0x312fee(0x109),_0x2b3368[_0x312fee(0x184)]?.[_0x312fee(0x182)]);if(_0x2b3368[_0x312fee(0x10c)]!=='success'||_0x2b3368[_0x312fee(0x15a)]!==0xc8){const _0x3d90c5=_0x2b3368['message']||_0x312fee(0x146);console[_0x312fee(0x122)](_0x312fee(0x117)),console[_0x312fee(0x122)](_0x312fee(0x17d),_0x3d90c5),loggerService_1[_0x312fee(0x11b)][_0x312fee(0x10d)](_0x312fee(0x127),_0x312fee(0x181),'Status\x20API\x20Error:\x20'+_0x3d90c5);throw new Error(_0x312fee(0x15e)+_0x3d90c5);}if(!_0x2b3368[_0x312fee(0x184)]){console[_0x312fee(0x122)](_0x312fee(0x156)),console[_0x312fee(0x122)](_0x312fee(0x171)),loggerService_1['loggerService'][_0x312fee(0x10d)](_0x312fee(0x127),_0x312fee(0x181),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x312fee(0x12a));}let _0x1d42e3=_0x312fee(0x172);switch(_0x2b3368[_0x312fee(0x184)][_0x312fee(0x174)]?.[_0x312fee(0x14b)]()){case'paid':_0x1d42e3=_0x312fee(0x12c);break;case _0x312fee(0x16a):case _0x312fee(0x158):case'error':_0x1d42e3=_0x312fee(0x168);break;case'expired':case _0x312fee(0x152):_0x1d42e3='EXPIRED';break;case _0x312fee(0x108):case _0x312fee(0x13a):case _0x312fee(0x11c):case _0x312fee(0x17b):default:_0x1d42e3=_0x312fee(0x172);break;}let _0x22edd9,_0x3ac795;if(_0x2b3368['data']['PaymentDetail']){const _0x175c4e=_0x2b3368['data'][_0x312fee(0x17c)];console[_0x312fee(0x133)](_0x312fee(0x185),_0x175c4e);const _0x5929fc=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x482491 of _0x5929fc){const _0x48982f=_0x175c4e['match'](_0x482491);if(_0x48982f){_0x22edd9=_0x48982f[0x1],console['log'](_0x312fee(0x14c),_0x22edd9,_0x312fee(0x149),_0x482491[_0x312fee(0x137)]);break;}}if(!_0x22edd9){console[_0x312fee(0x133)](_0x312fee(0x151));const _0x4c4be1=_0x175c4e[_0x312fee(0x15d)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x4c4be1&&(_0x22edd9=_0x4c4be1[0x1],console[_0x312fee(0x133)]('üè¶\x20Extracted\x20IBAN\x20via\x20fallback:',_0x22edd9));}_0x3ac795=_0x175c4e;}const _0x41a7bb={'iban':_0x22edd9,'bankDetails':_0x3ac795,'transactionId':_0x2b3368['data']['TransactionID'],'coinAddress':_0x2b3368[_0x312fee(0x184)][_0x312fee(0x165)],'qrCodeUrl':_0x2b3368[_0x312fee(0x184)][_0x312fee(0x103)],'expiryTime':_0x2b3368[_0x312fee(0x184)][_0x312fee(0x138)],'createdOn':_0x2b3368['data']['CreatedOn'],'confirmedOn':_0x2b3368[_0x312fee(0x184)][_0x312fee(0x10f)]};console[_0x312fee(0x133)](_0x312fee(0x121)),console[_0x312fee(0x133)](_0x312fee(0xfc),_0x2b3368[_0x312fee(0x184)][_0x312fee(0x174)],'->',_0x1d42e3),console[_0x312fee(0x133)](_0x312fee(0x14e),_0x2b3368['data'][_0x312fee(0x15b)],_0x2b3368[_0x312fee(0x184)][_0x312fee(0x182)]),console[_0x312fee(0x133)](_0x312fee(0x128),_0x2b3368['data'][_0x312fee(0x160)]),console[_0x312fee(0x133)](_0x312fee(0x161),_0x22edd9||_0x312fee(0x142)),console[_0x312fee(0x133)](_0x312fee(0x10b),_0x2b3368['data'][_0x312fee(0x177)]),console[_0x312fee(0x133)]('Confirmed\x20On:',_0x2b3368[_0x312fee(0x184)][_0x312fee(0x10f)]||'not\x20confirmed');if(_0x2b3368[_0x312fee(0x184)][_0x312fee(0x174)]?.['toLowerCase']()===_0x312fee(0x13a))console['log'](_0x312fee(0x101));else _0x2b3368[_0x312fee(0x184)]['Status']?.['toLowerCase']()===_0x312fee(0x167)&&console[_0x312fee(0x133)](_0x312fee(0x11f));return{'status':_0x1d42e3,'amount':parseFloat(_0x2b3368[_0x312fee(0x184)]['Amount'])||undefined,'currency':_0x2b3368['data'][_0x312fee(0x182)]||_0x312fee(0x110),'paymentDetails':_0x41a7bb};}catch(_0x426e38){console[_0x312fee(0x122)]('CoinToPay2\x20payment\x20status\x20check\x20error:',_0x426e38),loggerService_1['loggerService'][_0x312fee(0x10d)]('cointopay2',_0x312fee(0x181),_0x426e38);throw new Error(_0x312fee(0xfd)+(_0x426e38 instanceof Error?_0x426e38[_0x312fee(0x179)]:_0x312fee(0x132)));}}async[a46_0x585ca2(0x163)](_0x19451b){const _0x3652dd=a46_0x585ca2,_0x202d8b=await this['checkPaymentStatus'](_0x19451b);return{'status':_0x202d8b[_0x3652dd(0x11e)],'amount':_0x202d8b[_0x3652dd(0x169)],'currency':_0x202d8b[_0x3652dd(0x130)]};}async[a46_0x585ca2(0x153)](_0x416fff){const _0x4a81a6=a46_0x585ca2;console[_0x4a81a6(0x133)](_0x4a81a6(0xfe),_0x416fff);let _0x1bd767='PENDING';switch(_0x416fff[_0x4a81a6(0x11e)]?.[_0x4a81a6(0x14b)]()){case _0x4a81a6(0x167):_0x1bd767=_0x4a81a6(0x12c);break;case _0x4a81a6(0x16a):case _0x4a81a6(0x158):case _0x4a81a6(0x122):_0x1bd767='FAILED';break;case _0x4a81a6(0x125):case'timeout':_0x1bd767=_0x4a81a6(0x111);break;case _0x4a81a6(0x11c):case _0x4a81a6(0x108):case _0x4a81a6(0x13a):case'created':default:_0x1bd767=_0x4a81a6(0x172);break;}return{'paymentId':_0x416fff[_0x4a81a6(0x17f)]||_0x416fff[_0x4a81a6(0x118)]||'','status':_0x1bd767,'amount':_0x416fff[_0x4a81a6(0x169)],'currency':_0x416fff['currency']||_0x4a81a6(0x110)};}}function a46_0x57f4(){const _0x2b1571=['CoinToPay2\x20status\x20API\x20error:\x20','Parsed\x20Result:','TransactionID','IBAN:','Failed\x20to\x20parse\x20JSON\x20response:','verifyPayment','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','coinAddress','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','paid','FAILED','amount','cancelled','Headers:','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','&alternative=false','101984SojdvI','application/json','Missing\x20data\x20in\x20response','PENDING','784174zZrvlH','Status','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','JSON\x20Parse\x20Error:\x20','CreatedOn','Unknown\x20error\x20from\x20CoinToPay2\x20API','message','URL:','created','PaymentDetail','Error\x20Message:','Raw\x20Response\x20Body:','order_id','fromEntries','/status','inputCurrency','742548MecJms','data','üè¶\x20Payment\x20Detail:','CoinToPay2\x20API\x20error:\x20','Status:','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Error\x20details:','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','QRCodeURL','checkPaymentStatus','Business\x20Error:\x20','1347162HXXNJH','defineProperty','waiting','Currency:','üìä\x20Status\x20check\x20URL:','Created\x20On:','result','logWhiteDomainError','payment_url','TransactionConfirmedOn','EUR','EXPIRED','HTTP\x20error!\x20status:\x20','Payment\x20Status:','Result:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','Gateway\x20Payment\x20ID:','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','merchant_reference_id','HTTP\x20Status:','4UdUkFN','loggerService','pending','stringify','status','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','50EqfYbu','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','error','Request\x20Body:','3TPcuTw','expired','Status\x20Text:','cointopay2','Transaction\x20ID:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','Error\x20stack:','PAID','Response\x20Time:','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','logWhiteDomainResponse','currency','Payment\x20URL\x20(modified):','Unknown\x20error','log','===\x20COINTOPAY2\x20SUCCESS\x20===','apiUrl','2164565rETKre','source','ExpiryTime','2187822kkQhPK','awaiting\x20fiat','https://traffer.uk/gateway/cointopay/','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','logWhiteDomainRequest','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','text','4471191wVREHc','statusUrl','not\x20found','createPaymentLink','https://traffer.uk/gateway/cointopay/status.php','gateway_payment_id','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Status\x20Code:','POST','using\x20pattern:','Response\x20data:','toLowerCase','üè¶\x20Extracted\x20IBAN:','/create','Amount:','Payment\x20System/1.0\x20(CoinToPay2)','CoinToPay2Service','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','timeout','processWebhook','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','now','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20','failed','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','status_code','Amount','Error\x20message:','match'];a46_0x57f4=function(){return _0x2b1571;};return a46_0x57f4();}exports[a46_0x585ca2(0x150)]=CoinToPay2Service;