'use strict';const a48_0xd87719=a48_0xa7c6;(function(_0x1521b2,_0xbca2bc){const _0xa5d4e8=a48_0xa7c6,_0x6fff83=_0x1521b2();while(!![]){try{const _0x3d8975=parseInt(_0xa5d4e8(0xae))/0x1*(-parseInt(_0xa5d4e8(0x94))/0x2)+parseInt(_0xa5d4e8(0xc7))/0x3+parseInt(_0xa5d4e8(0x9f))/0x4+-parseInt(_0xa5d4e8(0x93))/0x5*(-parseInt(_0xa5d4e8(0xd3))/0x6)+parseInt(_0xa5d4e8(0xeb))/0x7*(-parseInt(_0xa5d4e8(0x87))/0x8)+-parseInt(_0xa5d4e8(0xec))/0x9+-parseInt(_0xa5d4e8(0x77))/0xa*(-parseInt(_0xa5d4e8(0x9b))/0xb);if(_0x3d8975===_0xbca2bc)break;else _0x6fff83['push'](_0x6fff83['shift']());}catch(_0x2da021){_0x6fff83['push'](_0x6fff83['shift']());}}}(a48_0x580e,0x832ba));function a48_0x580e(){const _0x4ae487=['1041620spiSlt','Transaction\x20ID:','&alternative=false','Amount','Incomplete\x20response:\x20missing\x20data','JSON\x20Parse\x20Error:\x20','order_id','Currency:','Payment\x20Status:','üè¶\x20Payment\x20Detail:','CoinToPay2\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','apiUrl','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Request\x20Body:','3NXskeu','Unknown\x20error\x20from\x20CoinToPay2\x20API','amount','statusText','stack','checkPaymentStatus','Raw\x20Response\x20Body:','logWhiteDomainResponse','Headers:','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','waiting','PAID','Unknown\x20error','ExpiryTime','error','cointopay2','stringify','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','Failed\x20to\x20parse\x20JSON\x20response:','Payment\x20URL\x20(original):','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','statusUrl','logWhiteDomainRequest','2193933nzTjJF','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','expired','HTTP\x20error!\x20status:\x20','paid','processWebhook','TransactionID','POST','\x20EUR','data','createPaymentLink','../loggerService','96QNuETh','success','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','Error\x20message:','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','Payment\x20System/1.0\x20(CoinToPay2)','status_code','pending','logWhiteDomainError','headers','toLowerCase','loggerService','/status','source','Response\x20Time:','application/json','fromEntries','status','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','Confirmed\x20On:','Status','IBAN:','91ZrjBsg','1657026jVdpvs','not\x20found','message','gateway_payment_id','entries','Error\x20Message:','verifyPayment','Amount:','Created\x20On:','result','log','CoinToPay2\x20status\x20API\x20error:\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','cancelled','using\x20pattern:','PENDING','inputCurrency',',\x20body:\x20','HTTP\x20Status:','Status:','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','PaymentDetail','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','Result:','Response\x20data:','70zzwadR','Gateway\x20Payment\x20ID:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','Missing\x20data\x20in\x20response','not\x20confirmed','URL:','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','FAILED','Response\x20Body:','Error\x20details:','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','HTTP\x20','awaiting\x20fiat','payment_url','timeout','CoinToPay2Service','631032WsBmIX','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','__esModule','EUR','CreatedOn','QRCodeURL','Status\x20Text:','now','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','EXPIRED','parse','match','98195DwayMb','60148XYUFaP','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','text','üè¶\x20Extracted\x20IBAN:','merchant_reference_id','/create','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','834581TKjxDe','Business\x20Error:\x20','created','failed'];a48_0x580e=function(){return _0x4ae487;};return a48_0x580e();}Object['defineProperty'](exports,a48_0xd87719(0x89),{'value':!![]}),exports[a48_0xd87719(0x86)]=void 0x0;function a48_0xa7c6(_0xc0d484,_0x53f2ac){const _0x580ec0=a48_0x580e();return a48_0xa7c6=function(_0xa7c6cc,_0x206c93){_0xa7c6cc=_0xa7c6cc-0x77;let _0x49354c=_0x580ec0[_0xa7c6cc];return _0x49354c;},a48_0xa7c6(_0xc0d484,_0x53f2ac);}const loggerService_1=require(a48_0xd87719(0xd2));class CoinToPay2Service{constructor(){const _0x319519=a48_0xd87719;this[_0x319519(0xab)]='https://traffer.uk/gateway/cointopay/',this[_0x319519(0xc5)]='https://traffer.uk/gateway/cointopay/status.php',console[_0x319519(0xf6)](_0x319519(0xd9)),console[_0x319519(0xf6)]('üìä\x20Status\x20check\x20URL:',this[_0x319519(0xc5)]);}async[a48_0xd87719(0xd1)](_0x5b549d){const _0x331b20=a48_0xd87719,{orderId:_0x1f5342,amount:_0x248ad1}=_0x5b549d;console[_0x331b20(0xf6)](_0x331b20(0x81)+_0x248ad1+_0x331b20(0xcf));const _0x1e1947={'amount':_0x248ad1},_0x3535cb=Date['now']();try{console[_0x331b20(0xf6)](_0x331b20(0xb9)),console[_0x331b20(0xf6)](_0x331b20(0x7c),this['apiUrl']),console[_0x331b20(0xf6)](_0x331b20(0xad),JSON[_0x331b20(0xc0)](_0x1e1947,null,0x2)),console[_0x331b20(0xf6)](_0x331b20(0xf3),_0x248ad1,_0x331b20(0x9a)),loggerService_1[_0x331b20(0xe0)][_0x331b20(0xc6)](_0x331b20(0xbf),'/create','POST',_0x1e1947);const _0x4de402=await fetch(this[_0x331b20(0xab)],{'method':'POST','headers':{'Content-Type':_0x331b20(0xe4),'Accept':'application/json','User-Agent':_0x331b20(0xda)},'body':JSON['stringify'](_0x1e1947)}),_0x3e3ce4=Date[_0x331b20(0x8e)]()-_0x3535cb;console['log'](_0x331b20(0xe7)),console[_0x331b20(0xf6)](_0x331b20(0xff),_0x4de402[_0x331b20(0xe6)]),console[_0x331b20(0xf6)](_0x331b20(0x8d),_0x4de402[_0x331b20(0xb1)]),console[_0x331b20(0xf6)](_0x331b20(0xb6),Object[_0x331b20(0xe5)](_0x4de402[_0x331b20(0xde)][_0x331b20(0xf0)]())),console[_0x331b20(0xf6)](_0x331b20(0xe3),_0x3e3ce4+'ms');const _0x2d006b=await _0x4de402[_0x331b20(0x96)]();console[_0x331b20(0xf6)](_0x331b20(0xb4),_0x2d006b);if(!_0x4de402['ok']){console[_0x331b20(0xbe)]('===\x20COINTOPAY2\x20API\x20ERROR\x20==='),console['error'](_0x331b20(0xfe),_0x4de402[_0x331b20(0xe6)]),console[_0x331b20(0xbe)](_0x331b20(0x7f),_0x2d006b),loggerService_1[_0x331b20(0xe0)]['logWhiteDomainResponse'](_0x331b20(0xbf),_0x331b20(0x99),_0x4de402[_0x331b20(0xe6)],_0x2d006b,_0x3e3ce4),loggerService_1[_0x331b20(0xe0)]['logWhiteDomainError'](_0x331b20(0xbf),_0x331b20(0x99),'HTTP\x20'+_0x4de402[_0x331b20(0xe6)]+':\x20'+_0x2d006b);throw new Error(_0x331b20(0xca)+_0x4de402['status']+_0x331b20(0xfd)+_0x2d006b);}let _0x3d6ecf;try{_0x3d6ecf=JSON[_0x331b20(0x91)](_0x2d006b);}catch(_0x2b712){console['error'](_0x331b20(0xc2),_0x2b712),loggerService_1[_0x331b20(0xe0)][_0x331b20(0xdd)](_0x331b20(0xbf),'/create','JSON\x20Parse\x20Error:\x20'+_0x2b712);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20'+_0x2d006b);}console['log'](_0x331b20(0x79)),console['log']('Parsed\x20Result:',JSON[_0x331b20(0xc0)](_0x3d6ecf,null,0x2)),loggerService_1['loggerService'][_0x331b20(0xb5)](_0x331b20(0xbf),'/create',_0x4de402[_0x331b20(0xe6)],_0x3d6ecf,_0x3e3ce4);if(_0x3d6ecf[_0x331b20(0xbe)]){const _0x57b15a=_0x3d6ecf[_0x331b20(0xee)]||_0x3d6ecf['error']||_0x331b20(0xaf);console['error'](_0x331b20(0xaa)),console[_0x331b20(0xbe)](_0x331b20(0xf1),_0x57b15a),loggerService_1[_0x331b20(0xe0)][_0x331b20(0xdd)](_0x331b20(0xbf),_0x331b20(0x99),_0x331b20(0x9c)+_0x57b15a);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x57b15a);}if(!_0x3d6ecf['payment_url']||!_0x3d6ecf['gateway_payment_id']){console[_0x331b20(0xbe)](_0x331b20(0xac)),console[_0x331b20(0xbe)](_0x331b20(0xf8)),console[_0x331b20(0xbe)](_0x331b20(0x104),_0x3d6ecf),loggerService_1['loggerService']['logWhiteDomainError'](_0x331b20(0xbf),_0x331b20(0x99),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x331b20(0xf6)]('===\x20COINTOPAY2\x20SUCCESS\x20==='),console[_0x331b20(0xf6)](_0x331b20(0x78),_0x3d6ecf[_0x331b20(0xef)]),console[_0x331b20(0xf6)](_0x331b20(0xc3),_0x3d6ecf[_0x331b20(0x84)]);const _0x59361a=_0x3d6ecf['payment_url']+_0x331b20(0xa1);return console[_0x331b20(0xf6)]('Payment\x20URL\x20(modified):',_0x59361a),console['log']('Amount:',_0x248ad1,_0x331b20(0x8a)),{'gateway_payment_id':_0x3d6ecf[_0x331b20(0xef)],'payment_url':_0x59361a};}catch(_0x3cc99d){console[_0x331b20(0xbe)](_0x331b20(0x88)),console[_0x331b20(0xbe)](_0x331b20(0x80),_0x3cc99d),loggerService_1[_0x331b20(0xe0)]['logWhiteDomainError'](_0x331b20(0xbf),_0x331b20(0x99),_0x3cc99d);if(_0x3cc99d instanceof Error){console[_0x331b20(0xbe)](_0x331b20(0xd6),_0x3cc99d[_0x331b20(0xee)]),console['error']('Error\x20stack:',_0x3cc99d[_0x331b20(0xb2)]);throw new Error(_0x331b20(0x102)+_0x3cc99d[_0x331b20(0xee)]);}throw new Error(_0x331b20(0xc1));}}async[a48_0xd87719(0xb3)](_0x514b13){const _0x4822d3=a48_0xd87719,_0x1cc674=Date['now']();try{console[_0x4822d3(0xf6)](_0x4822d3(0xd7)+_0x514b13);const _0x42d2d9={'gatewayPaymentId':_0x514b13};loggerService_1[_0x4822d3(0xe0)][_0x4822d3(0xc6)]('cointopay2',_0x4822d3(0xe1),_0x4822d3(0xce),_0x42d2d9);const _0x4a51af=await fetch(this[_0x4822d3(0xc5)],{'method':'POST','headers':{'Content-Type':_0x4822d3(0xe4),'Accept':_0x4822d3(0xe4),'User-Agent':_0x4822d3(0xda)},'body':JSON[_0x4822d3(0xc0)](_0x42d2d9)}),_0x1dfbc4=Date[_0x4822d3(0x8e)]()-_0x1cc674;console[_0x4822d3(0xf6)](_0x4822d3(0x8f)),console[_0x4822d3(0xf6)](_0x4822d3(0xff),_0x4a51af['status']),console[_0x4822d3(0xf6)]('Response\x20Time:',_0x1dfbc4+'ms');if(!_0x4a51af['ok']){const _0x225b9e=await _0x4a51af[_0x4822d3(0x96)]();console['error'](_0x4822d3(0xfe),_0x4a51af[_0x4822d3(0xe6)]),console[_0x4822d3(0xbe)]('Response\x20Body:',_0x225b9e),loggerService_1[_0x4822d3(0xe0)][_0x4822d3(0xb5)]('cointopay2',_0x4822d3(0xe1),_0x4a51af[_0x4822d3(0xe6)],_0x225b9e,_0x1dfbc4),loggerService_1['loggerService'][_0x4822d3(0xdd)](_0x4822d3(0xbf),'/status',_0x4822d3(0x82)+_0x4a51af[_0x4822d3(0xe6)]+':\x20'+_0x225b9e);throw new Error(_0x4822d3(0xca)+_0x4a51af['status']);}const _0x2a6e10=await _0x4a51af[_0x4822d3(0x96)]();console[_0x4822d3(0xf6)](_0x4822d3(0xb4),_0x2a6e10);let _0x34cb43;try{_0x34cb43=JSON['parse'](_0x2a6e10);}catch(_0x9a3c2b){console['error'](_0x4822d3(0xc2),_0x9a3c2b),loggerService_1[_0x4822d3(0xe0)]['logWhiteDomainError']('cointopay2','/status',_0x4822d3(0xa4)+_0x9a3c2b);throw new Error(_0x4822d3(0xd8)+_0x2a6e10);}loggerService_1[_0x4822d3(0xe0)][_0x4822d3(0xb5)](_0x4822d3(0xbf),_0x4822d3(0xe1),_0x4a51af[_0x4822d3(0xe6)],_0x34cb43,_0x1dfbc4),console[_0x4822d3(0xf6)](_0x4822d3(0xc8)),console[_0x4822d3(0xf6)](_0x4822d3(0x103),_0x34cb43[_0x4822d3(0xf5)]),console[_0x4822d3(0xf6)]('Status\x20Code:',_0x34cb43[_0x4822d3(0xdb)]),console[_0x4822d3(0xf6)](_0x4822d3(0xa7),_0x34cb43['data']?.[_0x4822d3(0xe9)]),console[_0x4822d3(0xf6)](_0x4822d3(0xf3),_0x34cb43[_0x4822d3(0xd0)]?.[_0x4822d3(0xa2)]),console[_0x4822d3(0xf6)](_0x4822d3(0xa6),_0x34cb43[_0x4822d3(0xd0)]?.[_0x4822d3(0xfc)]);if(_0x34cb43[_0x4822d3(0xf5)]!==_0x4822d3(0xd4)||_0x34cb43[_0x4822d3(0xdb)]!==0xc8){const _0x4a2acc=_0x34cb43['message']||_0x4822d3(0x7d);console[_0x4822d3(0xbe)](_0x4822d3(0xc4)),console['error'](_0x4822d3(0xf1),_0x4a2acc),loggerService_1['loggerService'][_0x4822d3(0xdd)](_0x4822d3(0xbf),_0x4822d3(0xe1),'Status\x20API\x20Error:\x20'+_0x4a2acc);throw new Error(_0x4822d3(0xf7)+_0x4a2acc);}if(!_0x34cb43[_0x4822d3(0xd0)]){console[_0x4822d3(0xbe)](_0x4822d3(0x95)),console[_0x4822d3(0xbe)](_0x4822d3(0x7a)),loggerService_1['loggerService']['logWhiteDomainError'](_0x4822d3(0xbf),'/status',_0x4822d3(0xa3));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0xdcd685='PENDING';switch(_0x34cb43['data'][_0x4822d3(0xe9)]?.[_0x4822d3(0xdf)]()){case'paid':_0xdcd685=_0x4822d3(0xbb);break;case'cancelled':case _0x4822d3(0x9e):case'error':_0xdcd685=_0x4822d3(0x7e);break;case _0x4822d3(0xc9):case _0x4822d3(0x85):_0xdcd685=_0x4822d3(0x90);break;case _0x4822d3(0xba):case _0x4822d3(0x83):case _0x4822d3(0xdc):case'created':default:_0xdcd685=_0x4822d3(0xfb);break;}let _0xc23474,_0x559d1d;if(_0x34cb43[_0x4822d3(0xd0)]['PaymentDetail']){const _0x5a2afc=_0x34cb43[_0x4822d3(0xd0)][_0x4822d3(0x101)];console[_0x4822d3(0xf6)](_0x4822d3(0xa8),_0x5a2afc);const _0x94121f=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x3f7e4e of _0x94121f){const _0x580c73=_0x5a2afc[_0x4822d3(0x92)](_0x3f7e4e);if(_0x580c73){_0xc23474=_0x580c73[0x1],console['log'](_0x4822d3(0x97),_0xc23474,_0x4822d3(0xfa),_0x3f7e4e[_0x4822d3(0xe2)]);break;}}if(!_0xc23474){console['log']('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x4a71d0=_0x5a2afc[_0x4822d3(0x92)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x4a71d0&&(_0xc23474=_0x4a71d0[0x1],console[_0x4822d3(0xf6)](_0x4822d3(0xb7),_0xc23474));}_0x559d1d=_0x5a2afc;}const _0x54f3e6={'iban':_0xc23474,'bankDetails':_0x559d1d,'transactionId':_0x34cb43[_0x4822d3(0xd0)][_0x4822d3(0xcd)],'coinAddress':_0x34cb43[_0x4822d3(0xd0)]['coinAddress'],'qrCodeUrl':_0x34cb43[_0x4822d3(0xd0)][_0x4822d3(0x8c)],'expiryTime':_0x34cb43['data'][_0x4822d3(0xbd)],'createdOn':_0x34cb43['data'][_0x4822d3(0x8b)],'confirmedOn':_0x34cb43[_0x4822d3(0xd0)]['TransactionConfirmedOn']};console[_0x4822d3(0xf6)](_0x4822d3(0xd5)),console['log']('Status:',_0x34cb43[_0x4822d3(0xd0)][_0x4822d3(0xe9)],'->',_0xdcd685),console[_0x4822d3(0xf6)]('Amount:',_0x34cb43['data'][_0x4822d3(0xa2)],_0x34cb43[_0x4822d3(0xd0)][_0x4822d3(0xfc)]),console['log'](_0x4822d3(0xa0),_0x34cb43[_0x4822d3(0xd0)][_0x4822d3(0xcd)]),console[_0x4822d3(0xf6)](_0x4822d3(0xea),_0xc23474||_0x4822d3(0xed)),console[_0x4822d3(0xf6)](_0x4822d3(0xf4),_0x34cb43['data'][_0x4822d3(0x8b)]),console[_0x4822d3(0xf6)](_0x4822d3(0xe8),_0x34cb43[_0x4822d3(0xd0)]['TransactionConfirmedOn']||_0x4822d3(0x7b));if(_0x34cb43['data'][_0x4822d3(0xe9)]?.[_0x4822d3(0xdf)]()==='awaiting\x20fiat')console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x34cb43[_0x4822d3(0xd0)][_0x4822d3(0xe9)]?.[_0x4822d3(0xdf)]()===_0x4822d3(0xcb)&&console[_0x4822d3(0xf6)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0xdcd685,'amount':parseFloat(_0x34cb43[_0x4822d3(0xd0)][_0x4822d3(0xa2)])||undefined,'currency':_0x34cb43[_0x4822d3(0xd0)]['inputCurrency']||_0x4822d3(0x8a),'paymentDetails':_0x54f3e6};}catch(_0x542c4a){console[_0x4822d3(0xbe)](_0x4822d3(0xa9),_0x542c4a),loggerService_1[_0x4822d3(0xe0)]['logWhiteDomainError'](_0x4822d3(0xbf),'/status',_0x542c4a);throw new Error(_0x4822d3(0x100)+(_0x542c4a instanceof Error?_0x542c4a[_0x4822d3(0xee)]:_0x4822d3(0xbc)));}}async[a48_0xd87719(0xf2)](_0x32b247){const _0x301df8=a48_0xd87719,_0x3e3cda=await this[_0x301df8(0xb3)](_0x32b247);return{'status':_0x3e3cda[_0x301df8(0xe6)],'amount':_0x3e3cda[_0x301df8(0xb0)],'currency':_0x3e3cda['currency']};}async[a48_0xd87719(0xcc)](_0x4f3ceb){const _0x2353fa=a48_0xd87719;console[_0x2353fa(0xf6)](_0x2353fa(0xb8),_0x4f3ceb);let _0x3998b2='PENDING';switch(_0x4f3ceb[_0x2353fa(0xe6)]?.[_0x2353fa(0xdf)]()){case _0x2353fa(0xcb):_0x3998b2=_0x2353fa(0xbb);break;case _0x2353fa(0xf9):case _0x2353fa(0x9e):case _0x2353fa(0xbe):_0x3998b2=_0x2353fa(0x7e);break;case _0x2353fa(0xc9):case'timeout':_0x3998b2=_0x2353fa(0x90);break;case _0x2353fa(0xdc):case _0x2353fa(0xba):case'awaiting\x20fiat':case _0x2353fa(0x9d):default:_0x3998b2=_0x2353fa(0xfb);break;}return{'paymentId':_0x4f3ceb[_0x2353fa(0xa5)]||_0x4f3ceb[_0x2353fa(0x98)]||'','status':_0x3998b2,'amount':_0x4f3ceb['amount'],'currency':_0x4f3ceb['currency']||'EUR'};}}exports['CoinToPay2Service']=CoinToPay2Service;