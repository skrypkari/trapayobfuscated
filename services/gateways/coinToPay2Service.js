'use strict';const a42_0x4b0a0e=a42_0x49d4;(function(_0x3b1d8a,_0x2367f5){const _0x5e3eda=a42_0x49d4,_0x35aa42=_0x3b1d8a();while(!![]){try{const _0x59bf88=parseInt(_0x5e3eda(0x112))/0x1*(-parseInt(_0x5e3eda(0xa4))/0x2)+parseInt(_0x5e3eda(0x88))/0x3+-parseInt(_0x5e3eda(0x10a))/0x4*(-parseInt(_0x5e3eda(0xcd))/0x5)+parseInt(_0x5e3eda(0xa2))/0x6+-parseInt(_0x5e3eda(0x92))/0x7+parseInt(_0x5e3eda(0x9b))/0x8*(parseInt(_0x5e3eda(0xf4))/0x9)+parseInt(_0x5e3eda(0xec))/0xa*(-parseInt(_0x5e3eda(0x86))/0xb);if(_0x59bf88===_0x2367f5)break;else _0x35aa42['push'](_0x35aa42['shift']());}catch(_0x450cdb){_0x35aa42['push'](_0x35aa42['shift']());}}}(a42_0x5ec5,0x7cc71));function a42_0x49d4(_0x247ec7,_0x36663c){const _0x5ec5ff=a42_0x5ec5();return a42_0x49d4=function(_0x49d4fa,_0x5f2a74){_0x49d4fa=_0x49d4fa-0x85;let _0x3df62a=_0x5ec5ff[_0x49d4fa];return _0x3df62a;},a42_0x49d4(_0x247ec7,_0x36663c);}Object[a42_0x4b0a0e(0xca)](exports,a42_0x4b0a0e(0x104),{'value':!![]}),exports[a42_0x4b0a0e(0xb2)]=void 0x0;const loggerService_1=require(a42_0x4b0a0e(0x90));class CoinToPay2Service{constructor(){const _0x2d945a=a42_0x4b0a0e;this[_0x2d945a(0x91)]=_0x2d945a(0xcf),this['statusUrl']=_0x2d945a(0xae),console['log'](_0x2d945a(0xa5)),console['log']('📊\x20Status\x20check\x20URL:',this[_0x2d945a(0x101)]);}async[a42_0x4b0a0e(0xfe)](_0x3b180f){const _0x504804=a42_0x4b0a0e,{orderId:_0x4700c6,amount:_0x4c6af1}=_0x3b180f;console[_0x504804(0xb9)](_0x504804(0xf3)+_0x4c6af1+'\x20EUR');const _0x40320c={'amount':_0x4c6af1},_0x350730=Date[_0x504804(0xeb)]();try{console[_0x504804(0xb9)](_0x504804(0xd8)),console[_0x504804(0xb9)](_0x504804(0xe8),this[_0x504804(0x91)]),console['log']('Request\x20Body:',JSON['stringify'](_0x40320c,null,0x2)),console[_0x504804(0xb9)](_0x504804(0xfd),_0x4c6af1,_0x504804(0xbc)),loggerService_1[_0x504804(0xe0)][_0x504804(0xa3)]('cointopay2',_0x504804(0xaa),'POST',_0x40320c);const _0x38fa99=await fetch(this['apiUrl'],{'method':_0x504804(0xb6),'headers':{'Content-Type':_0x504804(0xbe),'Accept':_0x504804(0xbe),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x504804(0xa6)](_0x40320c)}),_0x3347f4=Date[_0x504804(0xeb)]()-_0x350730;console[_0x504804(0xb9)](_0x504804(0x103)),console[_0x504804(0xb9)](_0x504804(0xc1),_0x38fa99[_0x504804(0xcb)]),console[_0x504804(0xb9)](_0x504804(0x89),_0x38fa99[_0x504804(0xb5)]),console[_0x504804(0xb9)]('Headers:',Object[_0x504804(0xfc)](_0x38fa99[_0x504804(0x9d)][_0x504804(0x10c)]())),console[_0x504804(0xb9)](_0x504804(0xd9),_0x3347f4+'ms');const _0x4a15ef=await _0x38fa99[_0x504804(0xf9)]();console['log']('Raw\x20Response\x20Body:',_0x4a15ef);if(!_0x38fa99['ok']){console['error'](_0x504804(0xe9)),console[_0x504804(0xb3)](_0x504804(0x109),_0x38fa99['status']),console[_0x504804(0xb3)](_0x504804(0x98),_0x4a15ef),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x504804(0xa9),_0x504804(0xaa),_0x38fa99[_0x504804(0xcb)],_0x4a15ef,_0x3347f4),loggerService_1[_0x504804(0xe0)][_0x504804(0x111)](_0x504804(0xa9),_0x504804(0xaa),_0x504804(0xf6)+_0x38fa99['status']+':\x20'+_0x4a15ef);throw new Error(_0x504804(0xdc)+_0x38fa99[_0x504804(0xcb)]+',\x20body:\x20'+_0x4a15ef);}let _0x5d0c7e;try{_0x5d0c7e=JSON['parse'](_0x4a15ef);}catch(_0x3ae0e0){console[_0x504804(0xb3)](_0x504804(0xd1),_0x3ae0e0),loggerService_1[_0x504804(0xe0)][_0x504804(0x111)](_0x504804(0xa9),'/create',_0x504804(0xa7)+_0x3ae0e0);throw new Error(_0x504804(0x95)+_0x4a15ef);}console['log'](_0x504804(0x85)),console['log'](_0x504804(0xf8),JSON[_0x504804(0xa6)](_0x5d0c7e,null,0x2)),loggerService_1[_0x504804(0xe0)][_0x504804(0xba)](_0x504804(0xa9),_0x504804(0xaa),_0x38fa99[_0x504804(0xcb)],_0x5d0c7e,_0x3347f4);if(_0x5d0c7e[_0x504804(0xb3)]){const _0x43fb44=_0x5d0c7e[_0x504804(0x108)]||_0x5d0c7e[_0x504804(0xb3)]||_0x504804(0xf5);console[_0x504804(0xb3)](_0x504804(0x9e)),console['error']('Error\x20Message:',_0x43fb44),loggerService_1[_0x504804(0xe0)]['logWhiteDomainError']('cointopay2',_0x504804(0xaa),'Business\x20Error:\x20'+_0x43fb44);throw new Error(_0x504804(0xe6)+_0x43fb44);}if(!_0x5d0c7e[_0x504804(0xdb)]||!_0x5d0c7e[_0x504804(0xce)]){console[_0x504804(0xb3)](_0x504804(0xab)),console[_0x504804(0xb3)](_0x504804(0x8d)),console[_0x504804(0xb3)](_0x504804(0xa8),_0x5d0c7e),loggerService_1['loggerService']['logWhiteDomainError'](_0x504804(0xa9),_0x504804(0xaa),_0x504804(0x96));throw new Error(_0x504804(0xc5));}return console[_0x504804(0xb9)](_0x504804(0xb1)),console[_0x504804(0xb9)](_0x504804(0xb7),_0x5d0c7e[_0x504804(0xce)]),console['log']('Payment\x20URL:',_0x5d0c7e['payment_url']),console['log']('Amount:',_0x4c6af1,_0x504804(0xda)),{'gateway_payment_id':_0x5d0c7e['gateway_payment_id'],'payment_url':_0x5d0c7e[_0x504804(0xdb)]};}catch(_0x1fd96c){console[_0x504804(0xb3)](_0x504804(0xb4)),console[_0x504804(0xb3)](_0x504804(0xb8),_0x1fd96c),loggerService_1[_0x504804(0xe0)]['logWhiteDomainError']('cointopay2',_0x504804(0xaa),_0x1fd96c);if(_0x1fd96c instanceof Error){console[_0x504804(0xb3)](_0x504804(0x105),_0x1fd96c['message']),console[_0x504804(0xb3)](_0x504804(0x10d),_0x1fd96c[_0x504804(0xd5)]);throw new Error(_0x504804(0xf0)+_0x1fd96c['message']);}throw new Error(_0x504804(0xac));}}async[a42_0x4b0a0e(0xe3)](_0x2fc7ea){const _0x27cdc4=a42_0x4b0a0e,_0x4ab6d4=Date['now']();try{console[_0x27cdc4(0xb9)]('📊\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0x2fc7ea);const _0x508a26={'gatewayPaymentId':_0x2fc7ea};loggerService_1[_0x27cdc4(0xe0)][_0x27cdc4(0xa3)](_0x27cdc4(0xa9),'/status','POST',_0x508a26);const _0x3fab35=await fetch(this[_0x27cdc4(0x101)],{'method':_0x27cdc4(0xb6),'headers':{'Content-Type':_0x27cdc4(0xbe),'Accept':_0x27cdc4(0xbe),'User-Agent':_0x27cdc4(0xd6)},'body':JSON['stringify'](_0x508a26)}),_0x37e7fe=Date['now']()-_0x4ab6d4;console[_0x27cdc4(0xb9)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log'](_0x27cdc4(0xc1),_0x3fab35[_0x27cdc4(0xcb)]),console[_0x27cdc4(0xb9)](_0x27cdc4(0xd9),_0x37e7fe+'ms');if(!_0x3fab35['ok']){const _0x3fa3d7=await _0x3fab35[_0x27cdc4(0xf9)]();console['error']('HTTP\x20Status:',_0x3fab35[_0x27cdc4(0xcb)]),console['error']('Response\x20Body:',_0x3fa3d7),loggerService_1[_0x27cdc4(0xe0)][_0x27cdc4(0xba)](_0x27cdc4(0xa9),'/status',_0x3fab35['status'],_0x3fa3d7,_0x37e7fe),loggerService_1[_0x27cdc4(0xe0)]['logWhiteDomainError']('cointopay2',_0x27cdc4(0xfa),_0x27cdc4(0xf6)+_0x3fab35[_0x27cdc4(0xcb)]+':\x20'+_0x3fa3d7);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3fab35[_0x27cdc4(0xcb)]);}const _0x2a3660=await _0x3fab35[_0x27cdc4(0xf9)]();console[_0x27cdc4(0xb9)](_0x27cdc4(0x9a),_0x2a3660);let _0x18f494;try{_0x18f494=JSON[_0x27cdc4(0xde)](_0x2a3660);}catch(_0x5ae90a){console['error'](_0x27cdc4(0xd1),_0x5ae90a),loggerService_1[_0x27cdc4(0xe0)][_0x27cdc4(0x111)]('cointopay2',_0x27cdc4(0xfa),_0x27cdc4(0xa7)+_0x5ae90a);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'+_0x2a3660);}loggerService_1[_0x27cdc4(0xe0)][_0x27cdc4(0xba)](_0x27cdc4(0xa9),_0x27cdc4(0xfa),_0x3fab35[_0x27cdc4(0xcb)],_0x18f494,_0x37e7fe),console[_0x27cdc4(0xb9)](_0x27cdc4(0xbd)),console['log'](_0x27cdc4(0xf7),_0x18f494[_0x27cdc4(0xa1)]),console['log'](_0x27cdc4(0x102),_0x18f494[_0x27cdc4(0xa0)]),console[_0x27cdc4(0xb9)](_0x27cdc4(0xc2),_0x18f494[_0x27cdc4(0x8a)]?.['Status']),console[_0x27cdc4(0xb9)](_0x27cdc4(0xfd),_0x18f494[_0x27cdc4(0x8a)]?.[_0x27cdc4(0xc8)]),console[_0x27cdc4(0xb9)]('Currency:',_0x18f494[_0x27cdc4(0x8a)]?.[_0x27cdc4(0xd3)]);if(_0x18f494[_0x27cdc4(0xa1)]!==_0x27cdc4(0xe2)||_0x18f494[_0x27cdc4(0xa0)]!==0xc8){const _0x46409f=_0x18f494[_0x27cdc4(0x108)]||_0x27cdc4(0xe4);console[_0x27cdc4(0xb3)](_0x27cdc4(0x9f)),console[_0x27cdc4(0xb3)](_0x27cdc4(0x9c),_0x46409f),loggerService_1['loggerService'][_0x27cdc4(0x111)](_0x27cdc4(0xa9),_0x27cdc4(0xfa),_0x27cdc4(0xf1)+_0x46409f);throw new Error(_0x27cdc4(0xaf)+_0x46409f);}if(!_0x18f494[_0x27cdc4(0x8a)]){console[_0x27cdc4(0xb3)](_0x27cdc4(0x87)),console[_0x27cdc4(0xb3)](_0x27cdc4(0xad)),loggerService_1[_0x27cdc4(0xe0)][_0x27cdc4(0x111)]('cointopay2',_0x27cdc4(0xfa),_0x27cdc4(0xdf));throw new Error(_0x27cdc4(0xd4));}let _0x317b40=_0x27cdc4(0x106);switch(_0x18f494[_0x27cdc4(0x8a)][_0x27cdc4(0xfb)]?.['toLowerCase']()){case'paid':_0x317b40=_0x27cdc4(0xed);break;case _0x27cdc4(0xc4):case'failed':case _0x27cdc4(0xb3):_0x317b40=_0x27cdc4(0xe5);break;case _0x27cdc4(0x10b):case'timeout':_0x317b40=_0x27cdc4(0x8f);break;case _0x27cdc4(0x10e):case _0x27cdc4(0xd2):case'pending':case _0x27cdc4(0xc0):default:_0x317b40=_0x27cdc4(0x106);break;}let _0x45094d,_0x2bb97a;if(_0x18f494[_0x27cdc4(0x8a)][_0x27cdc4(0xbb)]){const _0x2352f4=_0x18f494[_0x27cdc4(0x8a)]['PaymentDetail'];console['log'](_0x27cdc4(0x8b),_0x2352f4);const _0xec4038=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x2f138c of _0xec4038){const _0x58aa29=_0x2352f4[_0x27cdc4(0xb0)](_0x2f138c);if(_0x58aa29){_0x45094d=_0x58aa29[0x1],console[_0x27cdc4(0xb9)](_0x27cdc4(0x110),_0x45094d,_0x27cdc4(0x107),_0x2f138c[_0x27cdc4(0x8c)]);break;}}if(!_0x45094d){console['log']('⚠️\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x3bf401=_0x2352f4['match'](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x3bf401&&(_0x45094d=_0x3bf401[0x1],console[_0x27cdc4(0xb9)](_0x27cdc4(0xc3),_0x45094d));}_0x2bb97a=_0x2352f4;}const _0xcb4f7c={'iban':_0x45094d,'bankDetails':_0x2bb97a,'transactionId':_0x18f494[_0x27cdc4(0x8a)][_0x27cdc4(0xff)],'coinAddress':_0x18f494[_0x27cdc4(0x8a)]['coinAddress'],'qrCodeUrl':_0x18f494[_0x27cdc4(0x8a)][_0x27cdc4(0x8e)],'expiryTime':_0x18f494[_0x27cdc4(0x8a)][_0x27cdc4(0x97)],'createdOn':_0x18f494[_0x27cdc4(0x8a)][_0x27cdc4(0x100)],'confirmedOn':_0x18f494['data']['TransactionConfirmedOn']};console[_0x27cdc4(0xb9)](_0x27cdc4(0x99)),console['log'](_0x27cdc4(0xc1),_0x18f494['data'][_0x27cdc4(0xfb)],'->',_0x317b40),console[_0x27cdc4(0xb9)]('Amount:',_0x18f494[_0x27cdc4(0x8a)]['Amount'],_0x18f494[_0x27cdc4(0x8a)][_0x27cdc4(0xd3)]),console[_0x27cdc4(0xb9)](_0x27cdc4(0xc6),_0x18f494[_0x27cdc4(0x8a)][_0x27cdc4(0xff)]),console[_0x27cdc4(0xb9)](_0x27cdc4(0xc7),_0x45094d||_0x27cdc4(0xe1)),console[_0x27cdc4(0xb9)]('Created\x20On:',_0x18f494['data']['CreatedOn']),console[_0x27cdc4(0xb9)](_0x27cdc4(0xe7),_0x18f494[_0x27cdc4(0x8a)]['TransactionConfirmedOn']||_0x27cdc4(0xf2));if(_0x18f494[_0x27cdc4(0x8a)][_0x27cdc4(0xfb)]?.['toLowerCase']()===_0x27cdc4(0xd2))console[_0x27cdc4(0xb9)](_0x27cdc4(0xef));else _0x18f494[_0x27cdc4(0x8a)][_0x27cdc4(0xfb)]?.[_0x27cdc4(0xd0)]()===_0x27cdc4(0xee)&&console[_0x27cdc4(0xb9)](_0x27cdc4(0xbf));return{'status':_0x317b40,'amount':parseFloat(_0x18f494[_0x27cdc4(0x8a)][_0x27cdc4(0xc8)])||undefined,'currency':_0x18f494[_0x27cdc4(0x8a)]['inputCurrency']||_0x27cdc4(0xda),'paymentDetails':_0xcb4f7c};}catch(_0x357bbb){console[_0x27cdc4(0xb3)](_0x27cdc4(0xd7),_0x357bbb),loggerService_1[_0x27cdc4(0xe0)][_0x27cdc4(0x111)]('cointopay2','/status',_0x357bbb);throw new Error(_0x27cdc4(0x93)+(_0x357bbb instanceof Error?_0x357bbb[_0x27cdc4(0x108)]:'Unknown\x20error'));}}async[a42_0x4b0a0e(0xdd)](_0x2f844c){const _0x22056e=a42_0x4b0a0e,_0x76b3b6=await this[_0x22056e(0xe3)](_0x2f844c);return{'status':_0x76b3b6['status'],'amount':_0x76b3b6[_0x22056e(0x10f)],'currency':_0x76b3b6['currency']};}async['processWebhook'](_0xe78cb7){const _0x4ef9eb=a42_0x4b0a0e;console[_0x4ef9eb(0xb9)]('Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0xe78cb7);let _0x2fb5c7='PENDING';switch(_0xe78cb7[_0x4ef9eb(0xcb)]?.[_0x4ef9eb(0xd0)]()){case'paid':_0x2fb5c7='PAID';break;case'cancelled':case _0x4ef9eb(0x94):case'error':_0x2fb5c7=_0x4ef9eb(0xe5);break;case _0x4ef9eb(0x10b):case _0x4ef9eb(0xcc):_0x2fb5c7=_0x4ef9eb(0x8f);break;case'pending':case _0x4ef9eb(0x10e):case _0x4ef9eb(0xd2):case _0x4ef9eb(0xc0):default:_0x2fb5c7=_0x4ef9eb(0x106);break;}return{'paymentId':_0xe78cb7['order_id']||_0xe78cb7[_0x4ef9eb(0xc9)]||'','status':_0x2fb5c7,'amount':_0xe78cb7[_0x4ef9eb(0x10f)],'currency':_0xe78cb7[_0x4ef9eb(0xea)]||'EUR'};}}exports[a42_0x4b0a0e(0xb2)]=CoinToPay2Service;function a42_0x5ec5(){const _0x3d364d=['===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','Missing\x20data\x20in\x20response','https://traffer.uk/gateway/cointopay/status.php','CoinToPay2\x20status\x20API\x20error:\x20','match','===\x20COINTOPAY2\x20SUCCESS\x20===','CoinToPay2Service','error','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','statusText','POST','Gateway\x20Payment\x20ID:','Error\x20details:','log','logWhiteDomainResponse','PaymentDetail','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','application/json','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','created','Status:','Payment\x20Status:','🏦\x20Extracted\x20IBAN\x20via\x20fallback:','cancelled','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Transaction\x20ID:','IBAN:','Amount','merchant_reference_id','defineProperty','status','timeout','794245pbnGbf','gateway_payment_id','https://traffer.uk/gateway/cointopay/','toLowerCase','Failed\x20to\x20parse\x20JSON\x20response:','awaiting\x20fiat','inputCurrency','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','stack','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','CoinToPay2\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Response\x20Time:','EUR','payment_url','HTTP\x20error!\x20status:\x20','verifyPayment','parse','Incomplete\x20response:\x20missing\x20data','loggerService','not\x20found','success','checkPaymentStatus','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','FAILED','CoinToPay2\x20API\x20error:\x20','Confirmed\x20On:','URL:','===\x20COINTOPAY2\x20API\x20ERROR\x20===','currency','now','590TTKlQK','PAID','paid','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','Status\x20API\x20Error:\x20','not\x20confirmed','🪙\x20Creating\x20CoinToPay2\x20payment:\x20','369uvFvLU','Unknown\x20error\x20from\x20CoinToPay2\x20API','HTTP\x20','Result:','Parsed\x20Result:','text','/status','Status','fromEntries','Amount:','createPaymentLink','TransactionID','CreatedOn','statusUrl','Status\x20Code:','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','__esModule','Error\x20message:','PENDING','using\x20pattern:','message','HTTP\x20Status:','8ZVqcVy','expired','entries','Error\x20stack:','waiting','amount','🏦\x20Extracted\x20IBAN:','logWhiteDomainError','7VJTPYS','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','4202TtmKzC','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','808071ZkeCWn','Status\x20Text:','data','🏦\x20Payment\x20Detail:','source','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','QRCodeURL','EXPIRED','../loggerService','apiUrl','1726655pABewl','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','failed','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','ExpiryTime','Response\x20Body:','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','Raw\x20Response\x20Body:','103632ZDljiK','Error\x20Message:','headers','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','status_code','result','124650sFpINT','logWhiteDomainRequest','102472OIKGug','🪙\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','stringify','JSON\x20Parse\x20Error:\x20','Response\x20data:','cointopay2','/create'];a42_0x5ec5=function(){return _0x3d364d;};return a42_0x5ec5();}