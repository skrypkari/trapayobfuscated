'use strict';const a40_0x30cddd=a40_0x307d;(function(_0x2b242b,_0x36833e){const _0x3cf195=a40_0x307d,_0x40dac5=_0x2b242b();while(!![]){try{const _0x3af0ee=-parseInt(_0x3cf195(0x1de))/0x1+parseInt(_0x3cf195(0x1b0))/0x2+parseInt(_0x3cf195(0x1c8))/0x3+parseInt(_0x3cf195(0x164))/0x4*(parseInt(_0x3cf195(0x188))/0x5)+parseInt(_0x3cf195(0x15d))/0x6*(parseInt(_0x3cf195(0x16d))/0x7)+parseInt(_0x3cf195(0x15c))/0x8*(parseInt(_0x3cf195(0x1a3))/0x9)+parseInt(_0x3cf195(0x194))/0xa*(-parseInt(_0x3cf195(0x17a))/0xb);if(_0x3af0ee===_0x36833e)break;else _0x40dac5['push'](_0x40dac5['shift']());}catch(_0x1b2fdc){_0x40dac5['push'](_0x40dac5['shift']());}}}(a40_0x9d79,0xa2caa));function a40_0x9d79(){const _0x331887=['===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','text','verifyPayment','IBAN:','9YzbZAs','PAID','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','/create','waiting','cancelled','message','Failed\x20to\x20parse\x20JSON\x20response:','Payment\x20URL:',',\x20body:\x20','parse','statusUrl','Status\x20API\x20Error:\x20','383712SVgYqV','Result:','../loggerService','defineProperty','URL:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','📊\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Response\x20data:','not\x20confirmed','error','CoinToPay2\x20payment\x20status\x20check\x20error:','CoinToPay2Service','checkPaymentStatus','Headers:','CoinToPay2\x20API\x20error:\x20','payment_url','Payment\x20Status:','coinAddress','logWhiteDomainResponse','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainError','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','2453847TdbRFU','🪙\x20Creating\x20CoinToPay2\x20payment:\x20','Missing\x20data\x20in\x20response','statusText','JSON\x20Parse\x20Error:\x20','Amount','gateway_payment_id','Currency:','\x20EUR','awaiting\x20fiat','fromEntries','Status\x20Text:','FAILED','🪙\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','Unknown\x20error\x20from\x20CoinToPay2\x20API','Error\x20Message:','EXPIRED','apiUrl','processWebhook','__esModule','CreatedOn','PaymentDetail','431591jGqDHt','922040DBfheC','6204CMpTSC','Gateway\x20Payment\x20ID:','toLowerCase','TransactionID','stack','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Unknown\x20error','142276ithgdh','failed','Error\x20details:','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','loggerService','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','POST','expired','Business\x20Error:\x20','5775ABcYkr','inputCurrency','TransactionConfirmedOn','stringify','log','EUR','headers','status_code','PENDING','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','Error\x20message:','pending','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','11633270bfldec','created','application/json','Created\x20On:','currency','data','now','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','Amount:','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','25HNePDT','Status\x20Code:','Status:','status','/status','Response\x20Body:','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Status','logWhiteDomainRequest','paid','Request\x20Body:','HTTP\x20','10RfeGJV','HTTP\x20error!\x20status:\x20','Incomplete\x20response:\x20missing\x20data','QRCodeURL','createPaymentLink','HTTP\x20Status:','Confirmed\x20On:','cointopay2','amount','timeout','Raw\x20Response\x20Body:'];a40_0x9d79=function(){return _0x331887;};return a40_0x9d79();}function a40_0x307d(_0x42ec5b,_0x44fa47){const _0x9d7990=a40_0x9d79();return a40_0x307d=function(_0x307ddd,_0x193742){_0x307ddd=_0x307ddd-0x15c;let _0x308bbe=_0x9d7990[_0x307ddd];return _0x308bbe;},a40_0x307d(_0x42ec5b,_0x44fa47);}Object[a40_0x30cddd(0x1b3)](exports,a40_0x30cddd(0x1db),{'value':!![]}),exports['CoinToPay2Service']=void 0x0;const loggerService_1=require(a40_0x30cddd(0x1b2));class CoinToPay2Service{constructor(){const _0x31e343=a40_0x30cddd;this[_0x31e343(0x1d9)]='https://traffer.uk/gateway/cointopay/',this[_0x31e343(0x1ae)]='https://traffer.uk/gateway/cointopay/status.php',console[_0x31e343(0x171)](_0x31e343(0x1d5)),console[_0x31e343(0x171)]('📊\x20Status\x20check\x20URL:',this['statusUrl']);}async[a40_0x30cddd(0x198)](_0x59b266){const _0x38e242=a40_0x30cddd,{orderId:_0x3df013,amount:_0x10ec01}=_0x59b266;console[_0x38e242(0x171)](_0x38e242(0x1c9)+_0x10ec01+_0x38e242(0x1d0));const _0x346bba={'amount':_0x10ec01},_0x4b8bcf=Date[_0x38e242(0x180)]();try{console[_0x38e242(0x171)](_0x38e242(0x162)),console[_0x38e242(0x171)](_0x38e242(0x1b4),this[_0x38e242(0x1d9)]),console[_0x38e242(0x171)](_0x38e242(0x192),JSON[_0x38e242(0x170)](_0x346bba,null,0x2)),console['log'](_0x38e242(0x183),_0x10ec01,_0x38e242(0x176)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x38e242(0x19b),_0x38e242(0x1a6),_0x38e242(0x16a),_0x346bba);const _0x533bf7=await fetch(this[_0x38e242(0x1d9)],{'method':'POST','headers':{'Content-Type':_0x38e242(0x17c),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON['stringify'](_0x346bba)}),_0x1330bd=Date['now']()-_0x4b8bcf;console[_0x38e242(0x171)](_0x38e242(0x167)),console['log']('Status:',_0x533bf7[_0x38e242(0x18b)]),console['log'](_0x38e242(0x1d3),_0x533bf7[_0x38e242(0x1cb)]),console['log'](_0x38e242(0x1bd),Object[_0x38e242(0x1d2)](_0x533bf7[_0x38e242(0x173)]['entries']())),console[_0x38e242(0x171)]('Response\x20Time:',_0x1330bd+'ms');const _0x47f9e2=await _0x533bf7[_0x38e242(0x1a0)]();console[_0x38e242(0x171)](_0x38e242(0x19e),_0x47f9e2);if(!_0x533bf7['ok']){console['error'](_0x38e242(0x18e)),console[_0x38e242(0x1b9)](_0x38e242(0x199),_0x533bf7[_0x38e242(0x18b)]),console[_0x38e242(0x1b9)](_0x38e242(0x18d),_0x47f9e2),loggerService_1['loggerService'][_0x38e242(0x1c2)](_0x38e242(0x19b),_0x38e242(0x1a6),_0x533bf7[_0x38e242(0x18b)],_0x47f9e2,_0x1330bd),loggerService_1['loggerService']['logWhiteDomainError'](_0x38e242(0x19b),'/create',_0x38e242(0x193)+_0x533bf7['status']+':\x20'+_0x47f9e2);throw new Error(_0x38e242(0x195)+_0x533bf7[_0x38e242(0x18b)]+_0x38e242(0x1ac)+_0x47f9e2);}let _0x343ff3;try{_0x343ff3=JSON[_0x38e242(0x1ad)](_0x47f9e2);}catch(_0x205b7f){console[_0x38e242(0x1b9)](_0x38e242(0x1aa),_0x205b7f),loggerService_1[_0x38e242(0x168)][_0x38e242(0x1c4)](_0x38e242(0x19b),_0x38e242(0x1a6),'JSON\x20Parse\x20Error:\x20'+_0x205b7f);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20'+_0x47f9e2);}console[_0x38e242(0x171)](_0x38e242(0x1c7)),console[_0x38e242(0x171)]('Parsed\x20Result:',JSON[_0x38e242(0x170)](_0x343ff3,null,0x2)),loggerService_1[_0x38e242(0x168)][_0x38e242(0x1c2)](_0x38e242(0x19b),_0x38e242(0x1a6),_0x533bf7['status'],_0x343ff3,_0x1330bd);if(_0x343ff3[_0x38e242(0x1b9)]){const _0x38aa01=_0x343ff3[_0x38e242(0x1a9)]||_0x343ff3[_0x38e242(0x1b9)]||_0x38e242(0x1d6);console['error'](_0x38e242(0x19f)),console['error'](_0x38e242(0x1d7),_0x38aa01),loggerService_1[_0x38e242(0x168)][_0x38e242(0x1c4)](_0x38e242(0x19b),_0x38e242(0x1a6),_0x38e242(0x16c)+_0x38aa01);throw new Error(_0x38e242(0x1be)+_0x38aa01);}if(!_0x343ff3[_0x38e242(0x1bf)]||!_0x343ff3['gateway_payment_id']){console['error'](_0x38e242(0x185)),console[_0x38e242(0x1b9)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error'](_0x38e242(0x1b7),_0x343ff3),loggerService_1[_0x38e242(0x168)]['logWhiteDomainError'](_0x38e242(0x19b),_0x38e242(0x1a6),_0x38e242(0x179));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x38e242(0x171)]('===\x20COINTOPAY2\x20SUCCESS\x20==='),console['log'](_0x38e242(0x15e),_0x343ff3[_0x38e242(0x1ce)]),console[_0x38e242(0x171)](_0x38e242(0x1ab),_0x343ff3[_0x38e242(0x1bf)]),console[_0x38e242(0x171)](_0x38e242(0x183),_0x10ec01,_0x38e242(0x172)),{'gateway_payment_id':_0x343ff3[_0x38e242(0x1ce)],'payment_url':_0x343ff3[_0x38e242(0x1bf)]};}catch(_0x209289){console['error']('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x38e242(0x1b9)](_0x38e242(0x166),_0x209289),loggerService_1[_0x38e242(0x168)]['logWhiteDomainError'](_0x38e242(0x19b),'/create',_0x209289);if(_0x209289 instanceof Error){console['error'](_0x38e242(0x177),_0x209289[_0x38e242(0x1a9)]),console[_0x38e242(0x1b9)]('Error\x20stack:',_0x209289[_0x38e242(0x161)]);throw new Error(_0x38e242(0x181)+_0x209289[_0x38e242(0x1a9)]);}throw new Error(_0x38e242(0x1a5));}}async[a40_0x30cddd(0x1bc)](_0xa73365){const _0x133001=a40_0x30cddd,_0x422f70=Date['now']();try{console['log'](_0x133001(0x1b6)+_0xa73365);const _0x63ba38={'gatewayPaymentId':_0xa73365};loggerService_1['loggerService'][_0x133001(0x190)](_0x133001(0x19b),'/status','POST',_0x63ba38);const _0x4c5a53=await fetch(this[_0x133001(0x1ae)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x133001(0x17c),'User-Agent':_0x133001(0x187)},'body':JSON['stringify'](_0x63ba38)}),_0x3c9868=Date['now']()-_0x422f70;console['log'](_0x133001(0x1c5)),console['log'](_0x133001(0x18a),_0x4c5a53['status']),console[_0x133001(0x171)]('Response\x20Time:',_0x3c9868+'ms');if(!_0x4c5a53['ok']){const _0x338f90=await _0x4c5a53[_0x133001(0x1a0)]();console['error'](_0x133001(0x199),_0x4c5a53['status']),console['error']('Response\x20Body:',_0x338f90),loggerService_1[_0x133001(0x168)][_0x133001(0x1c2)]('cointopay2',_0x133001(0x18c),_0x4c5a53['status'],_0x338f90,_0x3c9868),loggerService_1[_0x133001(0x168)]['logWhiteDomainError']('cointopay2',_0x133001(0x18c),_0x133001(0x193)+_0x4c5a53[_0x133001(0x18b)]+':\x20'+_0x338f90);throw new Error(_0x133001(0x195)+_0x4c5a53['status']);}const _0x3e0ac9=await _0x4c5a53[_0x133001(0x1a0)]();console['log'](_0x133001(0x19e),_0x3e0ac9);let _0x38a593;try{_0x38a593=JSON['parse'](_0x3e0ac9);}catch(_0x216db3){console[_0x133001(0x1b9)](_0x133001(0x1aa),_0x216db3),loggerService_1[_0x133001(0x168)][_0x133001(0x1c4)](_0x133001(0x19b),_0x133001(0x18c),_0x133001(0x1cc)+_0x216db3);throw new Error(_0x133001(0x1b5)+_0x3e0ac9);}loggerService_1['loggerService'][_0x133001(0x1c2)](_0x133001(0x19b),'/status',_0x4c5a53[_0x133001(0x18b)],_0x38a593,_0x3c9868),console[_0x133001(0x171)](_0x133001(0x182)),console[_0x133001(0x171)](_0x133001(0x1b1),_0x38a593['result']),console['log'](_0x133001(0x189),_0x38a593[_0x133001(0x174)]),console['log'](_0x133001(0x1c0),_0x38a593[_0x133001(0x17f)]?.[_0x133001(0x18f)]),console[_0x133001(0x171)](_0x133001(0x183),_0x38a593[_0x133001(0x17f)]?.[_0x133001(0x1cd)]),console['log'](_0x133001(0x1cf),_0x38a593['data']?.[_0x133001(0x16e)]);if(_0x38a593['result']!=='success'||_0x38a593[_0x133001(0x174)]!==0xc8){const _0x2368cc=_0x38a593[_0x133001(0x1a9)]||_0x133001(0x169);console[_0x133001(0x1b9)](_0x133001(0x186)),console[_0x133001(0x1b9)](_0x133001(0x1d7),_0x2368cc),loggerService_1[_0x133001(0x168)]['logWhiteDomainError'](_0x133001(0x19b),'/status',_0x133001(0x1af)+_0x2368cc);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0x2368cc);}if(!_0x38a593[_0x133001(0x17f)]){console[_0x133001(0x1b9)](_0x133001(0x1c3)),console[_0x133001(0x1b9)](_0x133001(0x1ca)),loggerService_1['loggerService'][_0x133001(0x1c4)](_0x133001(0x19b),_0x133001(0x18c),_0x133001(0x196));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x323244='PENDING';switch(_0x38a593[_0x133001(0x17f)]['Status']?.[_0x133001(0x15f)]()){case _0x133001(0x191):_0x323244=_0x133001(0x1a4);break;case _0x133001(0x1a8):case _0x133001(0x165):case'error':_0x323244=_0x133001(0x1d4);break;case _0x133001(0x16b):case _0x133001(0x19d):_0x323244=_0x133001(0x1d8);break;case'waiting':case'awaiting\x20fiat':case _0x133001(0x178):case _0x133001(0x17b):default:_0x323244=_0x133001(0x175);break;}let _0x18d7c7,_0x4dad34;if(_0x38a593['data']['PaymentDetail']){const _0x31b9f0=_0x38a593[_0x133001(0x17f)][_0x133001(0x1dd)];console[_0x133001(0x171)]('🏦\x20Payment\x20Detail:',_0x31b9f0);const _0x34f069=_0x31b9f0['match'](/IBAN\s+([A-Z0-9]+)/i);_0x34f069&&(_0x18d7c7=_0x34f069[0x1],console[_0x133001(0x171)]('🏦\x20Extracted\x20IBAN:',_0x18d7c7)),_0x4dad34=_0x31b9f0;}const _0x54d8fa={'iban':_0x18d7c7,'bankDetails':_0x4dad34,'transactionId':_0x38a593[_0x133001(0x17f)][_0x133001(0x160)],'coinAddress':_0x38a593['data'][_0x133001(0x1c1)],'qrCodeUrl':_0x38a593[_0x133001(0x17f)][_0x133001(0x197)],'expiryTime':_0x38a593['data']['ExpiryTime'],'createdOn':_0x38a593[_0x133001(0x17f)][_0x133001(0x1dc)],'confirmedOn':_0x38a593[_0x133001(0x17f)][_0x133001(0x16f)]};console['log']('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console[_0x133001(0x171)]('Status:',_0x38a593[_0x133001(0x17f)][_0x133001(0x18f)],'->',_0x323244),console['log'](_0x133001(0x183),_0x38a593['data']['Amount'],_0x38a593[_0x133001(0x17f)]['inputCurrency']),console[_0x133001(0x171)]('Transaction\x20ID:',_0x38a593[_0x133001(0x17f)][_0x133001(0x160)]),console[_0x133001(0x171)](_0x133001(0x1a2),_0x18d7c7||'not\x20found'),console[_0x133001(0x171)](_0x133001(0x17d),_0x38a593[_0x133001(0x17f)][_0x133001(0x1dc)]),console[_0x133001(0x171)](_0x133001(0x19a),_0x38a593[_0x133001(0x17f)]['TransactionConfirmedOn']||_0x133001(0x1b8));if(_0x38a593['data'][_0x133001(0x18f)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x133001(0x171)](_0x133001(0x184));else _0x38a593['data'][_0x133001(0x18f)]?.[_0x133001(0x15f)]()===_0x133001(0x191)&&console[_0x133001(0x171)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x323244,'amount':parseFloat(_0x38a593[_0x133001(0x17f)][_0x133001(0x1cd)])||undefined,'currency':_0x38a593[_0x133001(0x17f)][_0x133001(0x16e)]||_0x133001(0x172),'paymentDetails':_0x54d8fa};}catch(_0x73312f){console[_0x133001(0x1b9)](_0x133001(0x1ba),_0x73312f),loggerService_1['loggerService']['logWhiteDomainError']('cointopay2','/status',_0x73312f);throw new Error(_0x133001(0x1c6)+(_0x73312f instanceof Error?_0x73312f['message']:_0x133001(0x163)));}}async[a40_0x30cddd(0x1a1)](_0x3a2f21){const _0x5bd3ba=a40_0x30cddd,_0xaa975f=await this[_0x5bd3ba(0x1bc)](_0x3a2f21);return{'status':_0xaa975f[_0x5bd3ba(0x18b)],'amount':_0xaa975f[_0x5bd3ba(0x19c)],'currency':_0xaa975f[_0x5bd3ba(0x17e)]};}async[a40_0x30cddd(0x1da)](_0x551c67){const _0x4e60ed=a40_0x30cddd;console[_0x4e60ed(0x171)]('Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x551c67);let _0x35f12d=_0x4e60ed(0x175);switch(_0x551c67[_0x4e60ed(0x18b)]?.[_0x4e60ed(0x15f)]()){case _0x4e60ed(0x191):_0x35f12d='PAID';break;case _0x4e60ed(0x1a8):case _0x4e60ed(0x165):case _0x4e60ed(0x1b9):_0x35f12d=_0x4e60ed(0x1d4);break;case'expired':case'timeout':_0x35f12d=_0x4e60ed(0x1d8);break;case _0x4e60ed(0x178):case _0x4e60ed(0x1a7):case _0x4e60ed(0x1d1):case _0x4e60ed(0x17b):default:_0x35f12d=_0x4e60ed(0x175);break;}return{'paymentId':_0x551c67['order_id']||_0x551c67['merchant_reference_id']||'','status':_0x35f12d,'amount':_0x551c67[_0x4e60ed(0x19c)],'currency':_0x551c67['currency']||_0x4e60ed(0x172)};}}exports[a40_0x30cddd(0x1bb)]=CoinToPay2Service;