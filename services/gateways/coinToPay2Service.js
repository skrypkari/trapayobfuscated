'use strict';const a64_0x525372=a64_0x8f7e;(function(_0x12ecfb,_0x409dab){const _0x1b5470=a64_0x8f7e,_0xba162e=_0x12ecfb();while(!![]){try{const _0x19aa90=parseInt(_0x1b5470(0xf5))/0x1+-parseInt(_0x1b5470(0xfc))/0x2*(-parseInt(_0x1b5470(0x100))/0x3)+parseInt(_0x1b5470(0x141))/0x4*(parseInt(_0x1b5470(0x10f))/0x5)+parseInt(_0x1b5470(0xee))/0x6+-parseInt(_0x1b5470(0x15f))/0x7+parseInt(_0x1b5470(0x15d))/0x8+-parseInt(_0x1b5470(0x132))/0x9;if(_0x19aa90===_0x409dab)break;else _0xba162e['push'](_0xba162e['shift']());}catch(_0x2d7084){_0xba162e['push'](_0xba162e['shift']());}}}(a64_0x409f,0x27ccd));Object[a64_0x525372(0x15e)](exports,a64_0x525372(0x112),{'value':!![]}),exports[a64_0x525372(0x145)]=void 0x0;const loggerService_1=require(a64_0x525372(0x135));class CoinToPay2Service{constructor(){const _0x427ff1=a64_0x525372;this[_0x427ff1(0x129)]=_0x427ff1(0x12b),this[_0x427ff1(0x116)]=_0x427ff1(0x16e),console['log'](_0x427ff1(0x172)),console['log'](_0x427ff1(0xfb),this[_0x427ff1(0x116)]);}async[a64_0x525372(0x118)](_0x43ad5e){const _0x228b3c=a64_0x525372,{orderId:_0x2ce828,amount:_0x6053e4}=_0x43ad5e;console[_0x228b3c(0x101)](_0x228b3c(0x14d)+_0x6053e4+'\x20EUR');const _0x4b5ec6={'amount':_0x6053e4},_0x312f1f=Date['now']();try{console[_0x228b3c(0x101)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console[_0x228b3c(0x101)](_0x228b3c(0x125),this['apiUrl']),console[_0x228b3c(0x101)](_0x228b3c(0x11a),JSON['stringify'](_0x4b5ec6,null,0x2)),console['log']('Amount:',_0x6053e4,_0x228b3c(0xf6)),loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay2',_0x228b3c(0x111),'POST',_0x4b5ec6);const _0x240f86=await fetch(this[_0x228b3c(0x129)],{'method':'POST','headers':{'Content-Type':_0x228b3c(0x178),'Accept':_0x228b3c(0x178),'User-Agent':_0x228b3c(0x117)},'body':JSON[_0x228b3c(0x15c)](_0x4b5ec6)}),_0x421237=Date[_0x228b3c(0x17c)]()-_0x312f1f;console['log'](_0x228b3c(0x143)),console[_0x228b3c(0x101)](_0x228b3c(0xf2),_0x240f86[_0x228b3c(0x13f)]),console[_0x228b3c(0x101)](_0x228b3c(0xf7),_0x240f86[_0x228b3c(0x11f)]),console[_0x228b3c(0x101)](_0x228b3c(0x12e),Object[_0x228b3c(0x13e)](_0x240f86[_0x228b3c(0x177)][_0x228b3c(0x137)]())),console['log'](_0x228b3c(0x11d),_0x421237+'ms');const _0x58934a=await _0x240f86[_0x228b3c(0xff)]();console[_0x228b3c(0x101)](_0x228b3c(0x152),_0x58934a);if(!_0x240f86['ok']){console[_0x228b3c(0x163)](_0x228b3c(0x128)),console[_0x228b3c(0x163)]('HTTP\x20Status:',_0x240f86[_0x228b3c(0x13f)]),console[_0x228b3c(0x163)](_0x228b3c(0x156),_0x58934a),loggerService_1[_0x228b3c(0x113)]['logWhiteDomainResponse'](_0x228b3c(0x115),_0x228b3c(0x111),_0x240f86['status'],_0x58934a,_0x421237),loggerService_1[_0x228b3c(0x113)][_0x228b3c(0x13a)](_0x228b3c(0x115),_0x228b3c(0x111),_0x228b3c(0x120)+_0x240f86['status']+':\x20'+_0x58934a);throw new Error(_0x228b3c(0x154)+_0x240f86[_0x228b3c(0x13f)]+_0x228b3c(0x11b)+_0x58934a);}let _0x4b5538;try{_0x4b5538=JSON[_0x228b3c(0x15a)](_0x58934a);}catch(_0x3b0531){console[_0x228b3c(0x163)](_0x228b3c(0x162),_0x3b0531),loggerService_1[_0x228b3c(0x113)][_0x228b3c(0x13a)]('cointopay2',_0x228b3c(0x111),_0x228b3c(0x12a)+_0x3b0531);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20'+_0x58934a);}console[_0x228b3c(0x101)](_0x228b3c(0x104)),console[_0x228b3c(0x101)](_0x228b3c(0x140),JSON[_0x228b3c(0x15c)](_0x4b5538,null,0x2)),loggerService_1[_0x228b3c(0x113)][_0x228b3c(0x110)]('cointopay2',_0x228b3c(0x111),_0x240f86[_0x228b3c(0x13f)],_0x4b5538,_0x421237);if(_0x4b5538[_0x228b3c(0x163)]){const _0x1e9b3a=_0x4b5538[_0x228b3c(0xf1)]||_0x4b5538['error']||'Unknown\x20error\x20from\x20CoinToPay2\x20API';console[_0x228b3c(0x163)](_0x228b3c(0x15b)),console[_0x228b3c(0x163)](_0x228b3c(0x106),_0x1e9b3a),loggerService_1[_0x228b3c(0x113)][_0x228b3c(0x13a)]('cointopay2',_0x228b3c(0x111),_0x228b3c(0x147)+_0x1e9b3a);throw new Error(_0x228b3c(0x146)+_0x1e9b3a);}if(!_0x4b5538[_0x228b3c(0x142)]||!_0x4b5538[_0x228b3c(0x17e)]){console[_0x228b3c(0x163)](_0x228b3c(0x170)),console[_0x228b3c(0x163)](_0x228b3c(0x169)),console[_0x228b3c(0x163)](_0x228b3c(0x12f),_0x4b5538),loggerService_1['loggerService'][_0x228b3c(0x13a)]('cointopay2',_0x228b3c(0x111),_0x228b3c(0xfe));throw new Error(_0x228b3c(0x17a));}console['log']('===\x20COINTOPAY2\x20SUCCESS\x20==='),console[_0x228b3c(0x101)](_0x228b3c(0x179),_0x4b5538['gateway_payment_id']),console[_0x228b3c(0x101)](_0x228b3c(0x131),_0x4b5538[_0x228b3c(0x142)]);const _0xaa263d=_0x4b5538[_0x228b3c(0x142)]+_0x228b3c(0x174);return console[_0x228b3c(0x101)](_0x228b3c(0x127),_0xaa263d),console[_0x228b3c(0x101)](_0x228b3c(0x158),_0x6053e4,_0x228b3c(0x119)),{'gateway_payment_id':_0x4b5538[_0x228b3c(0x17e)],'payment_url':_0xaa263d};}catch(_0x42d17a){console[_0x228b3c(0x163)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x228b3c(0x163)](_0x228b3c(0x10a),_0x42d17a),loggerService_1[_0x228b3c(0x113)][_0x228b3c(0x13a)]('cointopay2',_0x228b3c(0x111),_0x42d17a);if(_0x42d17a instanceof Error){console[_0x228b3c(0x163)]('Error\x20message:',_0x42d17a[_0x228b3c(0xf1)]),console['error'](_0x228b3c(0x167),_0x42d17a[_0x228b3c(0xf3)]);throw new Error(_0x228b3c(0x13d)+_0x42d17a[_0x228b3c(0xf1)]);}throw new Error(_0x228b3c(0x176));}}async[a64_0x525372(0x133)](_0x5c1559){const _0x19d837=a64_0x525372,_0x25fe36=Date[_0x19d837(0x17c)]();try{console[_0x19d837(0x101)]('üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0x5c1559);const _0x256e41={'gatewayPaymentId':_0x5c1559};loggerService_1[_0x19d837(0x113)][_0x19d837(0x151)](_0x19d837(0x115),_0x19d837(0x13c),_0x19d837(0x175),_0x256e41);const _0x47dc6b=await fetch(this[_0x19d837(0x116)],{'method':_0x19d837(0x175),'headers':{'Content-Type':_0x19d837(0x178),'Accept':_0x19d837(0x178),'User-Agent':_0x19d837(0x117)},'body':JSON[_0x19d837(0x15c)](_0x256e41)}),_0x3e3dec=Date[_0x19d837(0x17c)]()-_0x25fe36;console[_0x19d837(0x101)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x19d837(0x101)](_0x19d837(0xf2),_0x47dc6b[_0x19d837(0x13f)]),console[_0x19d837(0x101)](_0x19d837(0x11d),_0x3e3dec+'ms');if(!_0x47dc6b['ok']){const _0x2038d5=await _0x47dc6b['text']();console[_0x19d837(0x163)](_0x19d837(0x155),_0x47dc6b[_0x19d837(0x13f)]),console[_0x19d837(0x163)](_0x19d837(0x156),_0x2038d5),loggerService_1['loggerService'][_0x19d837(0x110)](_0x19d837(0x115),_0x19d837(0x13c),_0x47dc6b[_0x19d837(0x13f)],_0x2038d5,_0x3e3dec),loggerService_1[_0x19d837(0x113)][_0x19d837(0x13a)](_0x19d837(0x115),_0x19d837(0x13c),_0x19d837(0x120)+_0x47dc6b[_0x19d837(0x13f)]+':\x20'+_0x2038d5);throw new Error(_0x19d837(0x154)+_0x47dc6b[_0x19d837(0x13f)]);}const _0x35f7d7=await _0x47dc6b[_0x19d837(0xff)]();console[_0x19d837(0x101)](_0x19d837(0x152),_0x35f7d7);let _0x306a51;try{_0x306a51=JSON['parse'](_0x35f7d7);}catch(_0x26dd59){console['error'](_0x19d837(0x162),_0x26dd59),loggerService_1[_0x19d837(0x113)][_0x19d837(0x13a)](_0x19d837(0x115),_0x19d837(0x13c),_0x19d837(0x12a)+_0x26dd59);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'+_0x35f7d7);}loggerService_1['loggerService'][_0x19d837(0x110)](_0x19d837(0x115),'/status',_0x47dc6b[_0x19d837(0x13f)],_0x306a51,_0x3e3dec),console[_0x19d837(0x101)](_0x19d837(0x150)),console[_0x19d837(0x101)](_0x19d837(0x11c),_0x306a51[_0x19d837(0x10e)]),console[_0x19d837(0x101)](_0x19d837(0x160),_0x306a51[_0x19d837(0x105)]),console[_0x19d837(0x101)](_0x19d837(0x166),_0x306a51[_0x19d837(0x107)]?.[_0x19d837(0x16a)]),console[_0x19d837(0x101)](_0x19d837(0x158),_0x306a51[_0x19d837(0x107)]?.[_0x19d837(0x122)]),console[_0x19d837(0x101)](_0x19d837(0x144),_0x306a51['data']?.[_0x19d837(0xf4)]);if(_0x306a51[_0x19d837(0x10e)]!==_0x19d837(0x168)||_0x306a51[_0x19d837(0x105)]!==0xc8){const _0x38e958=_0x306a51['message']||_0x19d837(0x159);console[_0x19d837(0x163)](_0x19d837(0x164)),console[_0x19d837(0x163)](_0x19d837(0x106),_0x38e958),loggerService_1[_0x19d837(0x113)][_0x19d837(0x13a)](_0x19d837(0x115),_0x19d837(0x13c),_0x19d837(0x10d)+_0x38e958);throw new Error(_0x19d837(0x121)+_0x38e958);}if(!_0x306a51['data']){console[_0x19d837(0x163)](_0x19d837(0x10b)),console[_0x19d837(0x163)](_0x19d837(0x16d)),loggerService_1[_0x19d837(0x113)][_0x19d837(0x13a)](_0x19d837(0x115),_0x19d837(0x13c),_0x19d837(0x11e));throw new Error(_0x19d837(0x138));}let _0x3f2a1c='PENDING';switch(_0x306a51[_0x19d837(0x107)][_0x19d837(0x16a)]?.[_0x19d837(0x134)]()){case _0x19d837(0x108):_0x3f2a1c='PAID';break;case _0x19d837(0x10c):case _0x19d837(0x124):case'error':_0x3f2a1c=_0x19d837(0xfa);break;case _0x19d837(0x14e):case'timeout':_0x3f2a1c=_0x19d837(0x149);break;case _0x19d837(0x173):case'awaiting\x20fiat':case _0x19d837(0x123):case _0x19d837(0xfd):default:_0x3f2a1c=_0x19d837(0x157);break;}let _0x3b6868,_0x527fca;if(_0x306a51[_0x19d837(0x107)]['PaymentDetail']){const _0x195718=_0x306a51[_0x19d837(0x107)][_0x19d837(0x165)];console[_0x19d837(0x101)](_0x19d837(0x103),_0x195718);const _0x4a58f9=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x4a62d2 of _0x4a58f9){const _0x135670=_0x195718[_0x19d837(0x14c)](_0x4a62d2);if(_0x135670){_0x3b6868=_0x135670[0x1],console['log'](_0x19d837(0x148),_0x3b6868,_0x19d837(0x16f),_0x4a62d2[_0x19d837(0x14f)]);break;}}if(!_0x3b6868){console[_0x19d837(0x101)](_0x19d837(0x16c));const _0x834e2a=_0x195718[_0x19d837(0x14c)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x834e2a&&(_0x3b6868=_0x834e2a[0x1],console['log'](_0x19d837(0x17d),_0x3b6868));}_0x527fca=_0x195718;}const _0x1d9429={'iban':_0x3b6868,'bankDetails':_0x527fca,'transactionId':_0x306a51[_0x19d837(0x107)]['TransactionID'],'coinAddress':_0x306a51[_0x19d837(0x107)][_0x19d837(0x12c)],'qrCodeUrl':_0x306a51[_0x19d837(0x107)]['QRCodeURL'],'expiryTime':_0x306a51[_0x19d837(0x107)]['ExpiryTime'],'createdOn':_0x306a51['data'][_0x19d837(0x13b)],'confirmedOn':_0x306a51['data'][_0x19d837(0x136)]};console[_0x19d837(0x101)](_0x19d837(0x153)),console[_0x19d837(0x101)](_0x19d837(0xf2),_0x306a51[_0x19d837(0x107)][_0x19d837(0x16a)],'->',_0x3f2a1c),console['log']('Amount:',_0x306a51[_0x19d837(0x107)][_0x19d837(0x122)],_0x306a51['data'][_0x19d837(0xf4)]),console[_0x19d837(0x101)]('Transaction\x20ID:',_0x306a51[_0x19d837(0x107)][_0x19d837(0x130)]),console['log'](_0x19d837(0xf8),_0x3b6868||_0x19d837(0x12d)),console[_0x19d837(0x101)]('Created\x20On:',_0x306a51[_0x19d837(0x107)][_0x19d837(0x13b)]),console[_0x19d837(0x101)](_0x19d837(0xef),_0x306a51[_0x19d837(0x107)][_0x19d837(0x136)]||_0x19d837(0xf0));if(_0x306a51[_0x19d837(0x107)][_0x19d837(0x16a)]?.['toLowerCase']()===_0x19d837(0x114))console[_0x19d837(0x101)](_0x19d837(0xf9));else _0x306a51[_0x19d837(0x107)][_0x19d837(0x16a)]?.[_0x19d837(0x134)]()===_0x19d837(0x108)&&console[_0x19d837(0x101)](_0x19d837(0x161));return{'status':_0x3f2a1c,'amount':parseFloat(_0x306a51[_0x19d837(0x107)][_0x19d837(0x122)])||undefined,'currency':_0x306a51[_0x19d837(0x107)]['inputCurrency']||_0x19d837(0x119),'paymentDetails':_0x1d9429};}catch(_0x382d6b){console[_0x19d837(0x163)](_0x19d837(0x14b),_0x382d6b),loggerService_1[_0x19d837(0x113)][_0x19d837(0x13a)](_0x19d837(0x115),'/status',_0x382d6b);throw new Error(_0x19d837(0x16b)+(_0x382d6b instanceof Error?_0x382d6b[_0x19d837(0xf1)]:_0x19d837(0x102)));}}async[a64_0x525372(0xed)](_0x4e6cf0){const _0x5cd087=a64_0x525372,_0x15877e=await this[_0x5cd087(0x133)](_0x4e6cf0);return{'status':_0x15877e[_0x5cd087(0x13f)],'amount':_0x15877e[_0x5cd087(0x109)],'currency':_0x15877e[_0x5cd087(0x171)]};}async[a64_0x525372(0x139)](_0xadc650){const _0x4d8833=a64_0x525372;console[_0x4d8833(0x101)](_0x4d8833(0x14a),_0xadc650);let _0x46b28d=_0x4d8833(0x157);switch(_0xadc650['status']?.[_0x4d8833(0x134)]()){case'paid':_0x46b28d='PAID';break;case _0x4d8833(0x10c):case _0x4d8833(0x124):case _0x4d8833(0x163):_0x46b28d=_0x4d8833(0xfa);break;case _0x4d8833(0x14e):case'timeout':_0x46b28d='EXPIRED';break;case _0x4d8833(0x123):case _0x4d8833(0x173):case'awaiting\x20fiat':case _0x4d8833(0xfd):default:_0x46b28d=_0x4d8833(0x157);break;}return{'paymentId':_0xadc650[_0x4d8833(0x126)]||_0xadc650[_0x4d8833(0x17b)]||'','status':_0x46b28d,'amount':_0xadc650['amount'],'currency':_0xadc650[_0x4d8833(0x171)]||'EUR'};}}function a64_0x8f7e(_0x2f9186,_0x14432d){_0x2f9186=_0x2f9186-0xed;const _0x409f98=a64_0x409f();let _0x8f7e17=_0x409f98[_0x2f9186];return _0x8f7e17;}function a64_0x409f(){const _0x556a56=['üìä\x20Status\x20check\x20URL:','2jAzUNv','created','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','text','237621acRxwk','log','Unknown\x20error','üè¶\x20Payment\x20Detail:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','status_code','Error\x20Message:','data','paid','amount','Error\x20details:','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','cancelled','Status\x20API\x20Error:\x20','result','516055kceflV','logWhiteDomainResponse','/create','__esModule','loggerService','awaiting\x20fiat','cointopay2','statusUrl','Payment\x20System/1.0\x20(CoinToPay2)','createPaymentLink','EUR','Request\x20Body:',',\x20body:\x20','Result:','Response\x20Time:','Incomplete\x20response:\x20missing\x20data','statusText','HTTP\x20','CoinToPay2\x20status\x20API\x20error:\x20','Amount','pending','failed','URL:','order_id','Payment\x20URL\x20(modified):','===\x20COINTOPAY2\x20API\x20ERROR\x20===','apiUrl','JSON\x20Parse\x20Error:\x20','https://traffer.uk/gateway/cointopay/','coinAddress','not\x20found','Headers:','Response\x20data:','TransactionID','Payment\x20URL\x20(original):','5948928rnjGkU','checkPaymentStatus','toLowerCase','../loggerService','TransactionConfirmedOn','entries','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','processWebhook','logWhiteDomainError','CreatedOn','/status','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','fromEntries','status','Parsed\x20Result:','8oRbURN','payment_url','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','Currency:','CoinToPay2Service','CoinToPay2\x20API\x20error:\x20','Business\x20Error:\x20','üè¶\x20Extracted\x20IBAN:','EXPIRED','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','CoinToPay2\x20payment\x20status\x20check\x20error:','match','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','expired','source','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','logWhiteDomainRequest','Raw\x20Response\x20Body:','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','HTTP\x20error!\x20status:\x20','HTTP\x20Status:','Response\x20Body:','PENDING','Amount:','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','parse','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','stringify','933016sFhyjK','defineProperty','49357REAlhf','Status\x20Code:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Failed\x20to\x20parse\x20JSON\x20response:','error','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','PaymentDetail','Payment\x20Status:','Error\x20stack:','success','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Status','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','Missing\x20data\x20in\x20response','https://traffer.uk/gateway/cointopay/status.php','using\x20pattern:','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','currency','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','waiting','&alternative=false','POST','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','headers','application/json','Gateway\x20Payment\x20ID:','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','merchant_reference_id','now','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','gateway_payment_id','verifyPayment','1884726xWzQNa','Confirmed\x20On:','not\x20confirmed','message','Status:','stack','inputCurrency','114687rZOfJt','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','Status\x20Text:','IBAN:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','FAILED'];a64_0x409f=function(){return _0x556a56;};return a64_0x409f();}exports[a64_0x525372(0x145)]=CoinToPay2Service;