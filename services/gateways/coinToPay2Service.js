'use strict';const a46_0x845667=a46_0x48a7;(function(_0x34066e,_0x2fbc1f){const _0x3fe7da=a46_0x48a7,_0x4f7d75=_0x34066e();while(!![]){try{const _0x392032=-parseInt(_0x3fe7da(0x171))/0x1+-parseInt(_0x3fe7da(0x16b))/0x2+parseInt(_0x3fe7da(0x181))/0x3*(-parseInt(_0x3fe7da(0x11b))/0x4)+-parseInt(_0x3fe7da(0x163))/0x5+-parseInt(_0x3fe7da(0x143))/0x6*(-parseInt(_0x3fe7da(0x18c))/0x7)+-parseInt(_0x3fe7da(0x137))/0x8*(-parseInt(_0x3fe7da(0x1a0))/0x9)+parseInt(_0x3fe7da(0x14e))/0xa*(parseInt(_0x3fe7da(0x19a))/0xb);if(_0x392032===_0x2fbc1f)break;else _0x4f7d75['push'](_0x4f7d75['shift']());}catch(_0x4911ce){_0x4f7d75['push'](_0x4f7d75['shift']());}}}(a46_0x2196,0x52d63));function a46_0x48a7(_0x30a837,_0x1faf49){const _0x2196ec=a46_0x2196();return a46_0x48a7=function(_0x48a7ef,_0x4d97b3){_0x48a7ef=_0x48a7ef-0x116;let _0x1d17f3=_0x2196ec[_0x48a7ef];return _0x1d17f3;},a46_0x48a7(_0x30a837,_0x1faf49);}function a46_0x2196(){const _0x31ecbc=['pending','gateway_payment_id','EUR','awaiting\x20fiat','117YVrMDy','PAID','apiUrl','Status:','POST','/create','Unknown\x20error','36FTuUUn','Status\x20Text:','logWhiteDomainError','not\x20confirmed','parse','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','stack','waiting','logWhiteDomainRequest','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','/status','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Response\x20data:','HTTP\x20error!\x20status:\x20','using\x20pattern:','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','Currency:','coinAddress','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','not\x20found','inputCurrency','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Payment\x20URL\x20(modified):','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','success','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','fromEntries','expired','381568zlpVCJ','Confirmed\x20On:','PENDING','error','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','cointopay2','CoinToPay2\x20payment\x20status\x20check\x20error:','source','checkPaymentStatus','Missing\x20data\x20in\x20response','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','HTTP\x20Status:','13224PtpSms','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','Failed\x20to\x20parse\x20JSON\x20response:','entries','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Result:','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Payment\x20System/1.0\x20(CoinToPay2)','IBAN:','Response\x20Body:','currency','131830natgwD','__esModule','Error\x20message:','created','../loggerService','merchant_reference_id','text','status','toLowerCase','cancelled','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','Incomplete\x20response:\x20missing\x20data','CoinToPay2\x20status\x20API\x20error:\x20','ExpiryTime','FAILED','Business\x20Error:\x20','TransactionID','application/json','QRCodeURL','üìä\x20Status\x20check\x20URL:','JSON\x20Parse\x20Error:\x20','1733550TiYccs','üè¶\x20Payment\x20Detail:','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Gateway\x20Payment\x20ID:','Status\x20API\x20Error:\x20','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','Amount','createPaymentLink','1302400TYnCKO','Transaction\x20ID:','CoinToPay2\x20API\x20error:\x20','result','stringify','Status','262006llzBHZ','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','order_id','Error\x20Message:','Payment\x20URL\x20(original):','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','EXPIRED','https://traffer.uk/gateway/cointopay/','defineProperty','data','failed','headers','https://traffer.uk/gateway/cointopay/status.php','Parsed\x20Result:','paid','log','131739HJwFQu','CreatedOn','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','loggerService','PaymentDetail','processWebhook','message','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','now','Amount:','1183cBlbOM','TransactionConfirmedOn','Error\x20details:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','URL:','===\x20COINTOPAY2\x20SUCCESS\x20===','Headers:','payment_url','Created\x20On:','Response\x20Time:','timeout','verifyPayment','logWhiteDomainResponse','statusUrl','836BsHZxe','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):'];a46_0x2196=function(){return _0x31ecbc;};return a46_0x2196();}Object[a46_0x845667(0x179)](exports,a46_0x845667(0x14f),{'value':!![]}),exports['CoinToPay2Service']=void 0x0;const loggerService_1=require(a46_0x845667(0x152));class CoinToPay2Service{constructor(){const _0x4fc465=a46_0x845667;this[_0x4fc465(0x116)]=_0x4fc465(0x178),this[_0x4fc465(0x199)]=_0x4fc465(0x17d),console[_0x4fc465(0x180)]('ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console['log'](_0x4fc465(0x161),this['statusUrl']);}async[a46_0x845667(0x16a)](_0x104085){const _0x3da2f2=a46_0x845667,{orderId:_0x2e45ca,amount:_0x5b95cb}=_0x104085;console[_0x3da2f2(0x180)](_0x3da2f2(0x134)+_0x5b95cb+'\x20EUR');const _0x19a881={'amount':_0x5b95cb},_0x32d4cc=Date[_0x3da2f2(0x18a)]();try{console[_0x3da2f2(0x180)](_0x3da2f2(0x165)),console[_0x3da2f2(0x180)](_0x3da2f2(0x190),this[_0x3da2f2(0x116)]),console['log']('Request\x20Body:',JSON[_0x3da2f2(0x16f)](_0x19a881,null,0x2)),console[_0x3da2f2(0x180)]('Amount:',_0x5b95cb,_0x3da2f2(0x183)),loggerService_1[_0x3da2f2(0x184)][_0x3da2f2(0x123)]('cointopay2','/create','POST',_0x19a881);const _0x16d2ec=await fetch(this[_0x3da2f2(0x116)],{'method':_0x3da2f2(0x118),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':'Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON['stringify'](_0x19a881)}),_0x14ba9a=Date[_0x3da2f2(0x18a)]()-_0x32d4cc;console[_0x3da2f2(0x180)](_0x3da2f2(0x144)),console[_0x3da2f2(0x180)](_0x3da2f2(0x117),_0x16d2ec[_0x3da2f2(0x155)]),console[_0x3da2f2(0x180)](_0x3da2f2(0x11c),_0x16d2ec['statusText']),console[_0x3da2f2(0x180)](_0x3da2f2(0x192),Object[_0x3da2f2(0x135)](_0x16d2ec[_0x3da2f2(0x17c)][_0x3da2f2(0x146)]())),console[_0x3da2f2(0x180)](_0x3da2f2(0x195),_0x14ba9a+'ms');const _0x4a8715=await _0x16d2ec[_0x3da2f2(0x154)]();console[_0x3da2f2(0x180)]('Raw\x20Response\x20Body:',_0x4a8715);if(!_0x16d2ec['ok']){console[_0x3da2f2(0x13a)](_0x3da2f2(0x147)),console[_0x3da2f2(0x13a)](_0x3da2f2(0x142),_0x16d2ec['status']),console[_0x3da2f2(0x13a)](_0x3da2f2(0x14c),_0x4a8715),loggerService_1['loggerService'][_0x3da2f2(0x198)](_0x3da2f2(0x13c),_0x3da2f2(0x119),_0x16d2ec['status'],_0x4a8715,_0x14ba9a),loggerService_1['loggerService'][_0x3da2f2(0x11d)](_0x3da2f2(0x13c),'/create','HTTP\x20'+_0x16d2ec[_0x3da2f2(0x155)]+':\x20'+_0x4a8715);throw new Error(_0x3da2f2(0x128)+_0x16d2ec['status']+',\x20body:\x20'+_0x4a8715);}let _0x3d8f6c;try{_0x3d8f6c=JSON[_0x3da2f2(0x11f)](_0x4a8715);}catch(_0x4c0e5a){console[_0x3da2f2(0x13a)](_0x3da2f2(0x145),_0x4c0e5a),loggerService_1[_0x3da2f2(0x184)]['logWhiteDomainError']('cointopay2',_0x3da2f2(0x119),_0x3da2f2(0x162)+_0x4c0e5a);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20'+_0x4a8715);}console[_0x3da2f2(0x180)](_0x3da2f2(0x13b)),console[_0x3da2f2(0x180)](_0x3da2f2(0x17e),JSON[_0x3da2f2(0x16f)](_0x3d8f6c,null,0x2)),loggerService_1[_0x3da2f2(0x184)][_0x3da2f2(0x198)](_0x3da2f2(0x13c),_0x3da2f2(0x119),_0x16d2ec[_0x3da2f2(0x155)],_0x3d8f6c,_0x14ba9a);if(_0x3d8f6c['error']){const _0x7ae0cd=_0x3d8f6c[_0x3da2f2(0x187)]||_0x3d8f6c[_0x3da2f2(0x13a)]||'Unknown\x20error\x20from\x20CoinToPay2\x20API';console[_0x3da2f2(0x13a)](_0x3da2f2(0x172)),console[_0x3da2f2(0x13a)](_0x3da2f2(0x174),_0x7ae0cd),loggerService_1['loggerService'][_0x3da2f2(0x11d)](_0x3da2f2(0x13c),_0x3da2f2(0x119),_0x3da2f2(0x15d)+_0x7ae0cd);throw new Error(_0x3da2f2(0x16d)+_0x7ae0cd);}if(!_0x3d8f6c['payment_url']||!_0x3d8f6c[_0x3da2f2(0x19d)]){console['error']('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x3da2f2(0x124)),console[_0x3da2f2(0x13a)](_0x3da2f2(0x127),_0x3d8f6c),loggerService_1[_0x3da2f2(0x184)][_0x3da2f2(0x11d)]('cointopay2',_0x3da2f2(0x119),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x3da2f2(0x132));}console[_0x3da2f2(0x180)](_0x3da2f2(0x191)),console[_0x3da2f2(0x180)](_0x3da2f2(0x166),_0x3d8f6c[_0x3da2f2(0x19d)]),console[_0x3da2f2(0x180)](_0x3da2f2(0x175),_0x3d8f6c[_0x3da2f2(0x193)]);const _0x4de185=_0x3d8f6c[_0x3da2f2(0x193)]+'&alternative=false';return console[_0x3da2f2(0x180)](_0x3da2f2(0x131),_0x4de185),console['log'](_0x3da2f2(0x18b),_0x5b95cb,'EUR'),{'gateway_payment_id':_0x3d8f6c[_0x3da2f2(0x19d)],'payment_url':_0x4de185};}catch(_0x5644dd){console[_0x3da2f2(0x13a)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x3da2f2(0x13a)](_0x3da2f2(0x18e),_0x5644dd),loggerService_1[_0x3da2f2(0x184)]['logWhiteDomainError'](_0x3da2f2(0x13c),_0x3da2f2(0x119),_0x5644dd);if(_0x5644dd instanceof Error){console[_0x3da2f2(0x13a)](_0x3da2f2(0x150),_0x5644dd['message']),console[_0x3da2f2(0x13a)]('Error\x20stack:',_0x5644dd[_0x3da2f2(0x121)]);throw new Error(_0x3da2f2(0x18f)+_0x5644dd[_0x3da2f2(0x187)]);}throw new Error(_0x3da2f2(0x141));}}async['checkPaymentStatus'](_0x186273){const _0x35c99d=a46_0x845667,_0x28a657=Date[_0x35c99d(0x18a)]();try{console['log'](_0x35c99d(0x130)+_0x186273);const _0xa4ff94={'gatewayPaymentId':_0x186273};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x35c99d(0x13c),_0x35c99d(0x125),_0x35c99d(0x118),_0xa4ff94);const _0x4bdba2=await fetch(this[_0x35c99d(0x199)],{'method':'POST','headers':{'Content-Type':_0x35c99d(0x15f),'Accept':_0x35c99d(0x15f),'User-Agent':_0x35c99d(0x14a)},'body':JSON[_0x35c99d(0x16f)](_0xa4ff94)}),_0x225885=Date[_0x35c99d(0x18a)]()-_0x28a657;console[_0x35c99d(0x180)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log']('Status:',_0x4bdba2[_0x35c99d(0x155)]),console['log']('Response\x20Time:',_0x225885+'ms');if(!_0x4bdba2['ok']){const _0xedc908=await _0x4bdba2[_0x35c99d(0x154)]();console[_0x35c99d(0x13a)]('HTTP\x20Status:',_0x4bdba2['status']),console['error']('Response\x20Body:',_0xedc908),loggerService_1[_0x35c99d(0x184)]['logWhiteDomainResponse'](_0x35c99d(0x13c),'/status',_0x4bdba2[_0x35c99d(0x155)],_0xedc908,_0x225885),loggerService_1[_0x35c99d(0x184)]['logWhiteDomainError'](_0x35c99d(0x13c),_0x35c99d(0x125),'HTTP\x20'+_0x4bdba2[_0x35c99d(0x155)]+':\x20'+_0xedc908);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4bdba2[_0x35c99d(0x155)]);}const _0x25083d=await _0x4bdba2[_0x35c99d(0x154)]();console['log']('Raw\x20Response\x20Body:',_0x25083d);let _0x252736;try{_0x252736=JSON['parse'](_0x25083d);}catch(_0x3c3e19){console['error'](_0x35c99d(0x145),_0x3c3e19),loggerService_1[_0x35c99d(0x184)][_0x35c99d(0x11d)](_0x35c99d(0x13c),_0x35c99d(0x125),_0x35c99d(0x162)+_0x3c3e19);throw new Error(_0x35c99d(0x188)+_0x25083d);}loggerService_1[_0x35c99d(0x184)][_0x35c99d(0x198)](_0x35c99d(0x13c),_0x35c99d(0x125),_0x4bdba2[_0x35c99d(0x155)],_0x252736,_0x225885),console['log']('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x35c99d(0x148),_0x252736[_0x35c99d(0x16e)]),console['log']('Status\x20Code:',_0x252736['status_code']),console['log']('Payment\x20Status:',_0x252736[_0x35c99d(0x17a)]?.['Status']),console[_0x35c99d(0x180)](_0x35c99d(0x18b),_0x252736[_0x35c99d(0x17a)]?.[_0x35c99d(0x169)]),console[_0x35c99d(0x180)](_0x35c99d(0x12b),_0x252736[_0x35c99d(0x17a)]?.['inputCurrency']);if(_0x252736['result']!==_0x35c99d(0x133)||_0x252736['status_code']!==0xc8){const _0x54ab08=_0x252736[_0x35c99d(0x187)]||_0x35c99d(0x126);console[_0x35c99d(0x13a)](_0x35c99d(0x168)),console['error'](_0x35c99d(0x174),_0x54ab08),loggerService_1[_0x35c99d(0x184)]['logWhiteDomainError'](_0x35c99d(0x13c),_0x35c99d(0x125),_0x35c99d(0x167)+_0x54ab08);throw new Error(_0x35c99d(0x15a)+_0x54ab08);}if(!_0x252736[_0x35c99d(0x17a)]){console[_0x35c99d(0x13a)](_0x35c99d(0x149)),console[_0x35c99d(0x13a)](_0x35c99d(0x140)),loggerService_1[_0x35c99d(0x184)][_0x35c99d(0x11d)]('cointopay2','/status',_0x35c99d(0x159));throw new Error(_0x35c99d(0x158));}let _0x533998='PENDING';switch(_0x252736[_0x35c99d(0x17a)][_0x35c99d(0x170)]?.['toLowerCase']()){case _0x35c99d(0x17f):_0x533998=_0x35c99d(0x1a1);break;case _0x35c99d(0x157):case _0x35c99d(0x17b):case _0x35c99d(0x13a):_0x533998=_0x35c99d(0x15c);break;case'expired':case _0x35c99d(0x196):_0x533998=_0x35c99d(0x177);break;case _0x35c99d(0x122):case _0x35c99d(0x19f):case _0x35c99d(0x19c):case'created':default:_0x533998='PENDING';break;}let _0x26d11a,_0x34d003;if(_0x252736[_0x35c99d(0x17a)][_0x35c99d(0x185)]){const _0x49b425=_0x252736['data'][_0x35c99d(0x185)];console[_0x35c99d(0x180)](_0x35c99d(0x164),_0x49b425);const _0x5164a5=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0xa19fa0 of _0x5164a5){const _0x494b17=_0x49b425['match'](_0xa19fa0);if(_0x494b17){_0x26d11a=_0x494b17[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0x26d11a,_0x35c99d(0x129),_0xa19fa0[_0x35c99d(0x13e)]);break;}}if(!_0x26d11a){console[_0x35c99d(0x180)](_0x35c99d(0x12d));const _0x491ee4=_0x49b425['match'](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x491ee4&&(_0x26d11a=_0x491ee4[0x1],console['log'](_0x35c99d(0x120),_0x26d11a));}_0x34d003=_0x49b425;}const _0x4bc4f3={'iban':_0x26d11a,'bankDetails':_0x34d003,'transactionId':_0x252736[_0x35c99d(0x17a)][_0x35c99d(0x15e)],'coinAddress':_0x252736['data'][_0x35c99d(0x12c)],'qrCodeUrl':_0x252736[_0x35c99d(0x17a)][_0x35c99d(0x160)],'expiryTime':_0x252736['data'][_0x35c99d(0x15b)],'createdOn':_0x252736[_0x35c99d(0x17a)]['CreatedOn'],'confirmedOn':_0x252736[_0x35c99d(0x17a)][_0x35c99d(0x18d)]};console[_0x35c99d(0x180)](_0x35c99d(0x12a)),console[_0x35c99d(0x180)](_0x35c99d(0x117),_0x252736[_0x35c99d(0x17a)][_0x35c99d(0x170)],'->',_0x533998),console[_0x35c99d(0x180)](_0x35c99d(0x18b),_0x252736[_0x35c99d(0x17a)][_0x35c99d(0x169)],_0x252736[_0x35c99d(0x17a)]['inputCurrency']),console[_0x35c99d(0x180)](_0x35c99d(0x16c),_0x252736[_0x35c99d(0x17a)][_0x35c99d(0x15e)]),console[_0x35c99d(0x180)](_0x35c99d(0x14b),_0x26d11a||_0x35c99d(0x12e)),console[_0x35c99d(0x180)](_0x35c99d(0x194),_0x252736[_0x35c99d(0x17a)][_0x35c99d(0x182)]),console[_0x35c99d(0x180)](_0x35c99d(0x138),_0x252736[_0x35c99d(0x17a)][_0x35c99d(0x18d)]||_0x35c99d(0x11e));if(_0x252736[_0x35c99d(0x17a)][_0x35c99d(0x170)]?.[_0x35c99d(0x156)]()==='awaiting\x20fiat')console[_0x35c99d(0x180)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x252736[_0x35c99d(0x17a)][_0x35c99d(0x170)]?.['toLowerCase']()===_0x35c99d(0x17f)&&console['log'](_0x35c99d(0x189));return{'status':_0x533998,'amount':parseFloat(_0x252736[_0x35c99d(0x17a)][_0x35c99d(0x169)])||undefined,'currency':_0x252736[_0x35c99d(0x17a)][_0x35c99d(0x12f)]||_0x35c99d(0x19e),'paymentDetails':_0x4bc4f3};}catch(_0x3cada8){console['error'](_0x35c99d(0x13d),_0x3cada8),loggerService_1['loggerService'][_0x35c99d(0x11d)](_0x35c99d(0x13c),_0x35c99d(0x125),_0x3cada8);throw new Error(_0x35c99d(0x176)+(_0x3cada8 instanceof Error?_0x3cada8[_0x35c99d(0x187)]:_0x35c99d(0x11a)));}}async[a46_0x845667(0x197)](_0x4f4689){const _0x2cb2f6=a46_0x845667,_0x2c9625=await this[_0x2cb2f6(0x13f)](_0x4f4689);return{'status':_0x2c9625[_0x2cb2f6(0x155)],'amount':_0x2c9625['amount'],'currency':_0x2c9625[_0x2cb2f6(0x14d)]};}async[a46_0x845667(0x186)](_0x5b76f9){const _0x1f6caa=a46_0x845667;console[_0x1f6caa(0x180)](_0x1f6caa(0x19b),_0x5b76f9);let _0x3714f6=_0x1f6caa(0x139);switch(_0x5b76f9['status']?.[_0x1f6caa(0x156)]()){case _0x1f6caa(0x17f):_0x3714f6=_0x1f6caa(0x1a1);break;case _0x1f6caa(0x157):case'failed':case'error':_0x3714f6=_0x1f6caa(0x15c);break;case _0x1f6caa(0x136):case _0x1f6caa(0x196):_0x3714f6='EXPIRED';break;case'pending':case _0x1f6caa(0x122):case _0x1f6caa(0x19f):case _0x1f6caa(0x151):default:_0x3714f6=_0x1f6caa(0x139);break;}return{'paymentId':_0x5b76f9[_0x1f6caa(0x173)]||_0x5b76f9[_0x1f6caa(0x153)]||'','status':_0x3714f6,'amount':_0x5b76f9['amount'],'currency':_0x5b76f9['currency']||'EUR'};}}exports['CoinToPay2Service']=CoinToPay2Service;