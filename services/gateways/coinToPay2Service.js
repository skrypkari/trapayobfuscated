'use strict';const a43_0x3f5ba7=a43_0xa540;(function(_0x8c7bdf,_0x261e60){const _0x42678e=a43_0xa540,_0x1ba788=_0x8c7bdf();while(!![]){try{const _0x1da32c=-parseInt(_0x42678e(0xf3))/0x1*(-parseInt(_0x42678e(0xe0))/0x2)+-parseInt(_0x42678e(0xc2))/0x3*(parseInt(_0x42678e(0xf0))/0x4)+parseInt(_0x42678e(0xf9))/0x5*(-parseInt(_0x42678e(0x92))/0x6)+parseInt(_0x42678e(0xd8))/0x7+parseInt(_0x42678e(0x9c))/0x8*(parseInt(_0x42678e(0x8e))/0x9)+parseInt(_0x42678e(0xaf))/0xa*(parseInt(_0x42678e(0x83))/0xb)+parseInt(_0x42678e(0xa3))/0xc*(parseInt(_0x42678e(0xa7))/0xd);if(_0x1da32c===_0x261e60)break;else _0x1ba788['push'](_0x1ba788['shift']());}catch(_0x48b764){_0x1ba788['push'](_0x1ba788['shift']());}}}(a43_0x1d38,0x49339));Object[a43_0x3f5ba7(0xba)](exports,a43_0x3f5ba7(0xa1),{'value':!![]}),exports[a43_0x3f5ba7(0x88)]=void 0x0;const loggerService_1=require(a43_0x3f5ba7(0x80));class CoinToPay2Service{constructor(){const _0x1c334f=a43_0x3f5ba7;this['apiUrl']=_0x1c334f(0x96),this[_0x1c334f(0xb2)]='https://traffer.uk/gateway/cointopay/status.php',console['log'](_0x1c334f(0xed)),console[_0x1c334f(0xde)](_0x1c334f(0x101),this['statusUrl']);}async['createPaymentLink'](_0x5c5d41){const _0x12eacb=a43_0x3f5ba7,{orderId:_0x38e9a9,amount:_0x958411}=_0x5c5d41;console['log'](_0x12eacb(0x7f)+_0x958411+'\x20EUR');const _0x141f81={'amount':_0x958411},_0x64e1b1=Date[_0x12eacb(0x8f)]();try{console[_0x12eacb(0xde)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console[_0x12eacb(0xde)](_0x12eacb(0xe6),this[_0x12eacb(0xb9)]),console[_0x12eacb(0xde)](_0x12eacb(0xe2),JSON[_0x12eacb(0x102)](_0x141f81,null,0x2)),console[_0x12eacb(0xde)](_0x12eacb(0xa2),_0x958411,_0x12eacb(0xc9)),loggerService_1[_0x12eacb(0xeb)][_0x12eacb(0x93)](_0x12eacb(0xa9),_0x12eacb(0xfc),_0x12eacb(0xb1),_0x141f81);const _0x14900b=await fetch(this['apiUrl'],{'method':_0x12eacb(0xb1),'headers':{'Content-Type':'application/json','Accept':_0x12eacb(0xfa),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x12eacb(0x102)](_0x141f81)}),_0xf94387=Date[_0x12eacb(0x8f)]()-_0x64e1b1;console['log'](_0x12eacb(0xc1)),console[_0x12eacb(0xde)]('Status:',_0x14900b[_0x12eacb(0xe1)]),console['log'](_0x12eacb(0x9e),_0x14900b[_0x12eacb(0xe5)]),console[_0x12eacb(0xde)]('Headers:',Object[_0x12eacb(0xc4)](_0x14900b[_0x12eacb(0xae)][_0x12eacb(0xab)]())),console[_0x12eacb(0xde)](_0x12eacb(0xa5),_0xf94387+'ms');const _0x1663ad=await _0x14900b['text']();console[_0x12eacb(0xde)](_0x12eacb(0xcc),_0x1663ad);if(!_0x14900b['ok']){console[_0x12eacb(0xa8)](_0x12eacb(0xb6)),console[_0x12eacb(0xa8)]('HTTP\x20Status:',_0x14900b[_0x12eacb(0xe1)]),console[_0x12eacb(0xa8)](_0x12eacb(0xe9),_0x1663ad),loggerService_1[_0x12eacb(0xeb)][_0x12eacb(0xdd)]('cointopay2',_0x12eacb(0xfc),_0x14900b[_0x12eacb(0xe1)],_0x1663ad,_0xf94387),loggerService_1[_0x12eacb(0xeb)][_0x12eacb(0xf6)](_0x12eacb(0xa9),_0x12eacb(0xfc),_0x12eacb(0xce)+_0x14900b[_0x12eacb(0xe1)]+':\x20'+_0x1663ad);throw new Error(_0x12eacb(0xb4)+_0x14900b[_0x12eacb(0xe1)]+_0x12eacb(0xd9)+_0x1663ad);}let _0x509db8;try{_0x509db8=JSON['parse'](_0x1663ad);}catch(_0x2dd1d6){console[_0x12eacb(0xa8)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x2dd1d6),loggerService_1[_0x12eacb(0xeb)]['logWhiteDomainError'](_0x12eacb(0xa9),_0x12eacb(0xfc),_0x12eacb(0xbd)+_0x2dd1d6);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20'+_0x1663ad);}console[_0x12eacb(0xde)](_0x12eacb(0x89)),console[_0x12eacb(0xde)](_0x12eacb(0x97),JSON[_0x12eacb(0x102)](_0x509db8,null,0x2)),loggerService_1[_0x12eacb(0xeb)][_0x12eacb(0xdd)](_0x12eacb(0xa9),'/create',_0x14900b[_0x12eacb(0xe1)],_0x509db8,_0xf94387);if(_0x509db8[_0x12eacb(0xa8)]){const _0x136b5c=_0x509db8[_0x12eacb(0xcb)]||_0x509db8[_0x12eacb(0xa8)]||_0x12eacb(0xac);console['error']('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x12eacb(0xa8)](_0x12eacb(0x94),_0x136b5c),loggerService_1[_0x12eacb(0xeb)][_0x12eacb(0xf6)]('cointopay2',_0x12eacb(0xfc),_0x12eacb(0x99)+_0x136b5c);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x136b5c);}if(!_0x509db8[_0x12eacb(0x8b)]||!_0x509db8[_0x12eacb(0xe8)]){console[_0x12eacb(0xa8)](_0x12eacb(0xfe)),console[_0x12eacb(0xa8)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x12eacb(0xa8)]('Response\x20data:',_0x509db8),loggerService_1[_0x12eacb(0xeb)][_0x12eacb(0xf6)](_0x12eacb(0xa9),_0x12eacb(0xfc),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x12eacb(0xf4));}return console['log']('===\x20COINTOPAY2\x20SUCCESS\x20==='),console[_0x12eacb(0xde)]('Gateway\x20Payment\x20ID:',_0x509db8[_0x12eacb(0xe8)]),console[_0x12eacb(0xde)](_0x12eacb(0xda),_0x509db8['payment_url']),console['log'](_0x12eacb(0xa2),_0x958411,_0x12eacb(0xfd)),{'gateway_payment_id':_0x509db8['gateway_payment_id'],'payment_url':_0x509db8[_0x12eacb(0x8b)]};}catch(_0x32fca7){console['error']('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x12eacb(0xa8)](_0x12eacb(0xb7),_0x32fca7),loggerService_1[_0x12eacb(0xeb)][_0x12eacb(0xf6)](_0x12eacb(0xa9),_0x12eacb(0xfc),_0x32fca7);if(_0x32fca7 instanceof Error){console[_0x12eacb(0xa8)](_0x12eacb(0xf5),_0x32fca7['message']),console[_0x12eacb(0xa8)](_0x12eacb(0xf1),_0x32fca7[_0x12eacb(0x85)]);throw new Error(_0x12eacb(0xc7)+_0x32fca7[_0x12eacb(0xcb)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x3f5ba7(0x87)](_0x1a6d2d){const _0x2859d0=a43_0x3f5ba7,_0x4a5a02=Date['now']();try{console[_0x2859d0(0xde)](_0x2859d0(0xad)+_0x1a6d2d);const _0x36698c={'gatewayPaymentId':_0x1a6d2d};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x2859d0(0xa9),_0x2859d0(0xc6),_0x2859d0(0xb1),_0x36698c);const _0x444bd6=await fetch(this[_0x2859d0(0xb2)],{'method':_0x2859d0(0xb1),'headers':{'Content-Type':'application/json','Accept':_0x2859d0(0xfa),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x2859d0(0x102)](_0x36698c)}),_0x33c330=Date[_0x2859d0(0x8f)]()-_0x4a5a02;console[_0x2859d0(0xde)](_0x2859d0(0xb0)),console['log'](_0x2859d0(0xbb),_0x444bd6[_0x2859d0(0xe1)]),console[_0x2859d0(0xde)]('Response\x20Time:',_0x33c330+'ms');if(!_0x444bd6['ok']){const _0x4e83a3=await _0x444bd6[_0x2859d0(0xef)]();console[_0x2859d0(0xa8)](_0x2859d0(0x81),_0x444bd6['status']),console['error']('Response\x20Body:',_0x4e83a3),loggerService_1[_0x2859d0(0xeb)][_0x2859d0(0xdd)](_0x2859d0(0xa9),_0x2859d0(0xc6),_0x444bd6['status'],_0x4e83a3,_0x33c330),loggerService_1[_0x2859d0(0xeb)]['logWhiteDomainError'](_0x2859d0(0xa9),_0x2859d0(0xc6),_0x2859d0(0xce)+_0x444bd6[_0x2859d0(0xe1)]+':\x20'+_0x4e83a3);throw new Error(_0x2859d0(0xb4)+_0x444bd6['status']);}const _0x2298c2=await _0x444bd6[_0x2859d0(0xef)]();console[_0x2859d0(0xde)](_0x2859d0(0xcc),_0x2298c2);let _0x569166;try{_0x569166=JSON[_0x2859d0(0xee)](_0x2298c2);}catch(_0x3a5159){console['error'](_0x2859d0(0x86),_0x3a5159),loggerService_1[_0x2859d0(0xeb)][_0x2859d0(0xf6)]('cointopay2',_0x2859d0(0xc6),_0x2859d0(0xbd)+_0x3a5159);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'+_0x2298c2);}loggerService_1[_0x2859d0(0xeb)]['logWhiteDomainResponse']('cointopay2',_0x2859d0(0xc6),_0x444bd6[_0x2859d0(0xe1)],_0x569166,_0x33c330),console['log'](_0x2859d0(0x82)),console[_0x2859d0(0xde)](_0x2859d0(0x91),_0x569166[_0x2859d0(0xc3)]),console['log']('Status\x20Code:',_0x569166[_0x2859d0(0x8d)]),console[_0x2859d0(0xde)](_0x2859d0(0xbc),_0x569166['data']?.[_0x2859d0(0x9f)]),console[_0x2859d0(0xde)](_0x2859d0(0xa2),_0x569166[_0x2859d0(0xd5)]?.[_0x2859d0(0xfb)]),console[_0x2859d0(0xde)](_0x2859d0(0xd0),_0x569166[_0x2859d0(0xd5)]?.[_0x2859d0(0xcf)]);if(_0x569166['result']!==_0x2859d0(0xdf)||_0x569166[_0x2859d0(0x8d)]!==0xc8){const _0xce1dea=_0x569166[_0x2859d0(0xcb)]||_0x2859d0(0xff);console['error'](_0x2859d0(0xdb)),console[_0x2859d0(0xa8)](_0x2859d0(0x94),_0xce1dea),loggerService_1[_0x2859d0(0xeb)][_0x2859d0(0xf6)](_0x2859d0(0xa9),_0x2859d0(0xc6),'Status\x20API\x20Error:\x20'+_0xce1dea);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0xce1dea);}if(!_0x569166['data']){console[_0x2859d0(0xa8)](_0x2859d0(0xe3)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1['loggerService']['logWhiteDomainError']('cointopay2','/status',_0x2859d0(0xdc));throw new Error(_0x2859d0(0x9a));}let _0x2f1d2a=_0x2859d0(0x100);switch(_0x569166[_0x2859d0(0xd5)][_0x2859d0(0x9f)]?.[_0x2859d0(0xaa)]()){case _0x2859d0(0xc0):_0x2f1d2a='PAID';break;case _0x2859d0(0x95):case _0x2859d0(0xb3):case _0x2859d0(0xa8):_0x2f1d2a=_0x2859d0(0xd3);break;case _0x2859d0(0xbf):case _0x2859d0(0xd1):_0x2f1d2a=_0x2859d0(0xca);break;case _0x2859d0(0xb8):case _0x2859d0(0xa6):case _0x2859d0(0xd6):case _0x2859d0(0xbe):default:_0x2f1d2a=_0x2859d0(0x100);break;}let _0x1b328d,_0x43034b;if(_0x569166[_0x2859d0(0xd5)][_0x2859d0(0xa4)]){const _0x2daf08=_0x569166[_0x2859d0(0xd5)][_0x2859d0(0xa4)];console[_0x2859d0(0xde)](_0x2859d0(0xc8),_0x2daf08);const _0x5966b=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x14f05c of _0x5966b){const _0x5c1dc8=_0x2daf08['match'](_0x14f05c);if(_0x5c1dc8){_0x1b328d=_0x5c1dc8[0x1],console[_0x2859d0(0xde)]('üè¶\x20Extracted\x20IBAN:',_0x1b328d,_0x2859d0(0x8c),_0x14f05c[_0x2859d0(0xf2)]);break;}}if(!_0x1b328d){console[_0x2859d0(0xde)](_0x2859d0(0xf7));const _0x2f3a08=_0x2daf08['match'](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x2f3a08&&(_0x1b328d=_0x2f3a08[0x1],console['log'](_0x2859d0(0xa0),_0x1b328d));}_0x43034b=_0x2daf08;}const _0x295338={'iban':_0x1b328d,'bankDetails':_0x43034b,'transactionId':_0x569166[_0x2859d0(0xd5)][_0x2859d0(0xec)],'coinAddress':_0x569166[_0x2859d0(0xd5)]['coinAddress'],'qrCodeUrl':_0x569166['data']['QRCodeURL'],'expiryTime':_0x569166[_0x2859d0(0xd5)][_0x2859d0(0xd7)],'createdOn':_0x569166['data']['CreatedOn'],'confirmedOn':_0x569166[_0x2859d0(0xd5)][_0x2859d0(0x9b)]};console[_0x2859d0(0xde)]('===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20==='),console[_0x2859d0(0xde)](_0x2859d0(0xbb),_0x569166['data']['Status'],'->',_0x2f1d2a),console[_0x2859d0(0xde)](_0x2859d0(0xa2),_0x569166[_0x2859d0(0xd5)]['Amount'],_0x569166[_0x2859d0(0xd5)][_0x2859d0(0xcf)]),console[_0x2859d0(0xde)](_0x2859d0(0x103),_0x569166['data'][_0x2859d0(0xec)]),console[_0x2859d0(0xde)](_0x2859d0(0xf8),_0x1b328d||_0x2859d0(0xe7)),console[_0x2859d0(0xde)]('Created\x20On:',_0x569166[_0x2859d0(0xd5)][_0x2859d0(0x90)]),console['log'](_0x2859d0(0xe4),_0x569166[_0x2859d0(0xd5)][_0x2859d0(0x9b)]||_0x2859d0(0x84));if(_0x569166[_0x2859d0(0xd5)][_0x2859d0(0x9f)]?.[_0x2859d0(0xaa)]()===_0x2859d0(0xa6))console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x569166[_0x2859d0(0xd5)][_0x2859d0(0x9f)]?.[_0x2859d0(0xaa)]()===_0x2859d0(0xc0)&&console[_0x2859d0(0xde)](_0x2859d0(0x8a));return{'status':_0x2f1d2a,'amount':parseFloat(_0x569166['data'][_0x2859d0(0xfb)])||undefined,'currency':_0x569166[_0x2859d0(0xd5)][_0x2859d0(0xcf)]||_0x2859d0(0xfd),'paymentDetails':_0x295338};}catch(_0xb1ebab){console[_0x2859d0(0xa8)](_0x2859d0(0xcd),_0xb1ebab),loggerService_1[_0x2859d0(0xeb)][_0x2859d0(0xf6)](_0x2859d0(0xa9),'/status',_0xb1ebab);throw new Error('Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20'+(_0xb1ebab instanceof Error?_0xb1ebab[_0x2859d0(0xcb)]:'Unknown\x20error'));}}async['verifyPayment'](_0x11ac9f){const _0x89f1ae=a43_0x3f5ba7,_0xe56aa7=await this[_0x89f1ae(0x87)](_0x11ac9f);return{'status':_0xe56aa7[_0x89f1ae(0xe1)],'amount':_0xe56aa7[_0x89f1ae(0x98)],'currency':_0xe56aa7[_0x89f1ae(0xc5)]};}async[a43_0x3f5ba7(0xb5)](_0xfb3ca8){const _0x1c50b5=a43_0x3f5ba7;console['log'](_0x1c50b5(0xd2),_0xfb3ca8);let _0x325a92=_0x1c50b5(0x100);switch(_0xfb3ca8[_0x1c50b5(0xe1)]?.[_0x1c50b5(0xaa)]()){case'paid':_0x325a92=_0x1c50b5(0xd4);break;case _0x1c50b5(0x95):case _0x1c50b5(0xb3):case _0x1c50b5(0xa8):_0x325a92=_0x1c50b5(0xd3);break;case _0x1c50b5(0xbf):case _0x1c50b5(0xd1):_0x325a92=_0x1c50b5(0xca);break;case'pending':case _0x1c50b5(0xb8):case _0x1c50b5(0xa6):case _0x1c50b5(0xbe):default:_0x325a92=_0x1c50b5(0x100);break;}return{'paymentId':_0xfb3ca8[_0x1c50b5(0xea)]||_0xfb3ca8[_0x1c50b5(0x9d)]||'','status':_0x325a92,'amount':_0xfb3ca8[_0x1c50b5(0x98)],'currency':_0xfb3ca8['currency']||_0x1c50b5(0xfd)};}}function a43_0x1d38(){const _0xcff8fd=['checkPaymentStatus','CoinToPay2Service','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','payment_url','using\x20pattern:','status_code','542934wuqYxK','now','CreatedOn','Result:','174hPHiWm','logWhiteDomainRequest','Error\x20Message:','cancelled','https://traffer.uk/gateway/cointopay/','Parsed\x20Result:','amount','Business\x20Error:\x20','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','TransactionConfirmedOn','8YNnFVl','merchant_reference_id','Status\x20Text:','Status','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','__esModule','Amount:','686316ReiYsn','PaymentDetail','Response\x20Time:','awaiting\x20fiat','91fIuiXd','error','cointopay2','toLowerCase','entries','Unknown\x20error\x20from\x20CoinToPay2\x20API','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','headers','1468150rTDLIU','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','POST','statusUrl','failed','HTTP\x20error!\x20status:\x20','processWebhook','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Error\x20details:','waiting','apiUrl','defineProperty','Status:','Payment\x20Status:','JSON\x20Parse\x20Error:\x20','created','expired','paid','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','68097TLCTxJ','result','fromEntries','currency','/status','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','üè¶\x20Payment\x20Detail:','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','EXPIRED','message','Raw\x20Response\x20Body:','CoinToPay2\x20payment\x20status\x20check\x20error:','HTTP\x20','inputCurrency','Currency:','timeout','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','FAILED','PAID','data','pending','ExpiryTime','3566451AhtNaz',',\x20body:\x20','Payment\x20URL:','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','Incomplete\x20response:\x20missing\x20data','logWhiteDomainResponse','log','success','3966davwbx','status','Request\x20Body:','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Confirmed\x20On:','statusText','URL:','not\x20found','gateway_payment_id','Response\x20Body:','order_id','loggerService','TransactionID','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','parse','text','104LbhinK','Error\x20stack:','source','127KHmjoG','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20message:','logWhiteDomainError','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','IBAN:','82555jmEYcB','application/json','Amount','/create','EUR','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','PENDING','üìä\x20Status\x20check\x20URL:','stringify','Transaction\x20ID:','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','../loggerService','HTTP\x20Status:','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','11jaYypn','not\x20confirmed','stack','Failed\x20to\x20parse\x20JSON\x20response:'];a43_0x1d38=function(){return _0xcff8fd;};return a43_0x1d38();}function a43_0xa540(_0x8e0d99,_0x1a1ca0){const _0x1d38f2=a43_0x1d38();return a43_0xa540=function(_0xa540f2,_0x13c7c8){_0xa540f2=_0xa540f2-0x7f;let _0x42a50e=_0x1d38f2[_0xa540f2];return _0x42a50e;},a43_0xa540(_0x8e0d99,_0x1a1ca0);}exports['CoinToPay2Service']=CoinToPay2Service;