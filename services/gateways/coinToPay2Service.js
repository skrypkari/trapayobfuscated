'use strict';const a40_0x53a3b6=a40_0x4216;(function(_0x12a7d6,_0x31830a){const _0x25c64c=a40_0x4216,_0x505ded=_0x12a7d6();while(!![]){try{const _0x28211f=-parseInt(_0x25c64c(0xe4))/0x1+parseInt(_0x25c64c(0x114))/0x2*(parseInt(_0x25c64c(0x13d))/0x3)+parseInt(_0x25c64c(0xe1))/0x4*(parseInt(_0x25c64c(0xeb))/0x5)+-parseInt(_0x25c64c(0x131))/0x6*(-parseInt(_0x25c64c(0x11f))/0x7)+parseInt(_0x25c64c(0x117))/0x8+parseInt(_0x25c64c(0xfe))/0x9+-parseInt(_0x25c64c(0x126))/0xa*(parseInt(_0x25c64c(0x11d))/0xb);if(_0x28211f===_0x31830a)break;else _0x505ded['push'](_0x505ded['shift']());}catch(_0x2d9f37){_0x505ded['push'](_0x505ded['shift']());}}}(a40_0x1be6,0xde7ce));function a40_0x1be6(){const _0x24c348=['1500LDCDGC','failed','now','üè¶\x20Extracted\x20IBAN:','JSON\x20Parse\x20Error:\x20','inputCurrency','logWhiteDomainRequest','EXPIRED','Incomplete\x20response:\x20missing\x20data','processWebhook','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY2\x20SUCCESS\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','success','expired','Response\x20Body:','entries','order_id','cancelled','statusText','waiting','Payment\x20URL:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','https://traffer.uk/gateway/cointopay/','Status','Transaction\x20ID:','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','gateway_payment_id','Request\x20Body:','../loggerService','loggerService','CreatedOn','verifyPayment','logWhiteDomainResponse','awaiting\x20fiat','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','130440LgHQEL','created','stringify','43383bDudrW','Unknown\x20error','data','Status\x20Text:',',\x20body:\x20','message','Status\x20Code:','150boZxwH','parse','logWhiteDomainError','match','application/json','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','timeout','defineProperty','cointopay2','IBAN:','createPaymentLink','Business\x20Error:\x20','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','POST','Payment\x20Status:','paid','CoinToPay2Service','status','3609414zlTBGi','Gateway\x20Payment\x20ID:','payment_url','statusUrl','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','Confirmed\x20On:','Response\x20data:','apiUrl','https://traffer.uk/gateway/cointopay/status.php','EUR','fromEntries','CoinToPay2\x20status\x20API\x20error:\x20','log','status_code','ExpiryTime','Amount:','HTTP\x20Status:','Created\x20On:','CoinToPay2\x20payment\x20status\x20check\x20error:','amount','text','1002fDTWSF','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','11810960ngfIIw','HTTP\x20','Status:','currency','Amount','Failed\x20to\x20parse\x20JSON\x20response:','1016840ZtjCKH','\x20EUR','7917TBuGMB','result','Error\x20message:','PaymentDetail','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','PENDING','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','400vsOygz','Raw\x20Response\x20Body:','toLowerCase','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','error','Error\x20Message:','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','/status','Parsed\x20Result:','===\x20COINTOPAY2\x20API\x20ERROR\x20===','TransactionID','8202KGCKGG','HTTP\x20error!\x20status:\x20','Response\x20Time:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','coinAddress','CoinToPay2\x20API\x20error:\x20','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','/create','checkPaymentStatus','QRCodeURL','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)'];a40_0x1be6=function(){return _0x24c348;};return a40_0x1be6();}Object[a40_0x53a3b6(0xf2)](exports,'__esModule',{'value':!![]}),exports['CoinToPay2Service']=void 0x0;const loggerService_1=require(a40_0x53a3b6(0xda));function a40_0x4216(_0x1bf263,_0x8ba574){const _0x1be6a6=a40_0x1be6();return a40_0x4216=function(_0x421635,_0x51b97a){_0x421635=_0x421635-0xcc;let _0x13c9c9=_0x1be6a6[_0x421635];return _0x13c9c9;},a40_0x4216(_0x1bf263,_0x8ba574);}class CoinToPay2Service{constructor(){const _0xcab8bd=a40_0x53a3b6;this[_0xcab8bd(0x106)]=_0xcab8bd(0xd4),this[_0xcab8bd(0x101)]=_0xcab8bd(0x107),console[_0xcab8bd(0x10b)]('ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0xcab8bd(0x10b)]('üìä\x20Status\x20check\x20URL:',this[_0xcab8bd(0x101)]);}async[a40_0x53a3b6(0xf5)](_0x5e8c9d){const _0x42d63a=a40_0x53a3b6,{orderId:_0xd8628f,amount:_0x3fa464}=_0x5e8c9d;console['log']('ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20'+_0x3fa464+_0x42d63a(0x11e));const _0x4b891d={'amount':_0x3fa464},_0x5b794e=Date[_0x42d63a(0x13f)]();try{console[_0x42d63a(0x10b)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console[_0x42d63a(0x10b)]('URL:',this[_0x42d63a(0x106)]),console[_0x42d63a(0x10b)](_0x42d63a(0xd9),JSON[_0x42d63a(0xe3)](_0x4b891d,null,0x2)),console[_0x42d63a(0x10b)](_0x42d63a(0x10e),_0x3fa464,_0x42d63a(0x13c)),loggerService_1[_0x42d63a(0xdb)][_0x42d63a(0x143)](_0x42d63a(0xf3),'/create',_0x42d63a(0xf9),_0x4b891d);const _0x3bae7e=await fetch(this[_0x42d63a(0x106)],{'method':_0x42d63a(0xf9),'headers':{'Content-Type':_0x42d63a(0xef),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON['stringify'](_0x4b891d)}),_0x4eb8da=Date[_0x42d63a(0x13f)]()-_0x5b794e;console[_0x42d63a(0x10b)](_0x42d63a(0x123)),console[_0x42d63a(0x10b)](_0x42d63a(0x119),_0x3bae7e[_0x42d63a(0xfd)]),console[_0x42d63a(0x10b)](_0x42d63a(0xe7),_0x3bae7e[_0x42d63a(0xd0)]),console['log']('Headers:',Object[_0x42d63a(0x109)](_0x3bae7e['headers'][_0x42d63a(0xcd)]())),console[_0x42d63a(0x10b)](_0x42d63a(0x133),_0x4eb8da+'ms');const _0x314840=await _0x3bae7e[_0x42d63a(0x113)]();console[_0x42d63a(0x10b)](_0x42d63a(0x127),_0x314840);if(!_0x3bae7e['ok']){console[_0x42d63a(0x12a)](_0x42d63a(0x12f)),console[_0x42d63a(0x12a)](_0x42d63a(0x10f),_0x3bae7e['status']),console[_0x42d63a(0x12a)](_0x42d63a(0xcc),_0x314840),loggerService_1[_0x42d63a(0xdb)][_0x42d63a(0xde)](_0x42d63a(0xf3),_0x42d63a(0x138),_0x3bae7e['status'],_0x314840,_0x4eb8da),loggerService_1[_0x42d63a(0xdb)][_0x42d63a(0xed)]('cointopay2','/create',_0x42d63a(0x118)+_0x3bae7e[_0x42d63a(0xfd)]+':\x20'+_0x314840);throw new Error(_0x42d63a(0x132)+_0x3bae7e[_0x42d63a(0xfd)]+_0x42d63a(0xe8)+_0x314840);}let _0x2fa29a;try{_0x2fa29a=JSON[_0x42d63a(0xec)](_0x314840);}catch(_0x4ffcaf){console[_0x42d63a(0x12a)](_0x42d63a(0x11c),_0x4ffcaf),loggerService_1[_0x42d63a(0xdb)][_0x42d63a(0xed)](_0x42d63a(0xf3),'/create',_0x42d63a(0x141)+_0x4ffcaf);throw new Error(_0x42d63a(0x149)+_0x314840);}console[_0x42d63a(0x10b)](_0x42d63a(0x134)),console[_0x42d63a(0x10b)](_0x42d63a(0x12e),JSON['stringify'](_0x2fa29a,null,0x2)),loggerService_1[_0x42d63a(0xdb)]['logWhiteDomainResponse'](_0x42d63a(0xf3),'/create',_0x3bae7e[_0x42d63a(0xfd)],_0x2fa29a,_0x4eb8da);if(_0x2fa29a[_0x42d63a(0x12a)]){const _0xd44ba5=_0x2fa29a[_0x42d63a(0xe9)]||_0x2fa29a[_0x42d63a(0x12a)]||'Unknown\x20error\x20from\x20CoinToPay2\x20API';console[_0x42d63a(0x12a)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x42d63a(0x12a)](_0x42d63a(0x12b),_0xd44ba5),loggerService_1[_0x42d63a(0xdb)][_0x42d63a(0xed)](_0x42d63a(0xf3),'/create',_0x42d63a(0xf6)+_0xd44ba5);throw new Error(_0x42d63a(0x136)+_0xd44ba5);}if(!_0x2fa29a['payment_url']||!_0x2fa29a[_0x42d63a(0xd8)]){console[_0x42d63a(0x12a)](_0x42d63a(0x13b)),console[_0x42d63a(0x12a)](_0x42d63a(0xd3)),console[_0x42d63a(0x12a)](_0x42d63a(0x105),_0x2fa29a),loggerService_1[_0x42d63a(0xdb)]['logWhiteDomainError']('cointopay2',_0x42d63a(0x138),_0x42d63a(0x116));throw new Error(_0x42d63a(0xf8));}return console['log'](_0x42d63a(0x148)),console[_0x42d63a(0x10b)](_0x42d63a(0xff),_0x2fa29a[_0x42d63a(0xd8)]),console[_0x42d63a(0x10b)](_0x42d63a(0xd2),_0x2fa29a[_0x42d63a(0x100)]),console[_0x42d63a(0x10b)](_0x42d63a(0x10e),_0x3fa464,_0x42d63a(0x108)),{'gateway_payment_id':_0x2fa29a[_0x42d63a(0xd8)],'payment_url':_0x2fa29a[_0x42d63a(0x100)]};}catch(_0x5663ef){console[_0x42d63a(0x12a)](_0x42d63a(0xf0)),console[_0x42d63a(0x12a)]('Error\x20details:',_0x5663ef),loggerService_1[_0x42d63a(0xdb)]['logWhiteDomainError']('cointopay2',_0x42d63a(0x138),_0x5663ef);if(_0x5663ef instanceof Error){console[_0x42d63a(0x12a)](_0x42d63a(0x121),_0x5663ef['message']),console[_0x42d63a(0x12a)]('Error\x20stack:',_0x5663ef['stack']);throw new Error(_0x42d63a(0x102)+_0x5663ef[_0x42d63a(0xe9)]);}throw new Error(_0x42d63a(0xe0));}}async[a40_0x53a3b6(0x139)](_0xa4bae7){const _0x5ce3d8=a40_0x53a3b6,_0x467f32=Date['now']();try{console[_0x5ce3d8(0x10b)]('üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0xa4bae7);const _0x93a5c9={'gatewayPaymentId':_0xa4bae7};loggerService_1[_0x5ce3d8(0xdb)][_0x5ce3d8(0x143)]('cointopay2','/status',_0x5ce3d8(0xf9),_0x93a5c9);const _0x10b423=await fetch(this[_0x5ce3d8(0x101)],{'method':_0x5ce3d8(0xf9),'headers':{'Content-Type':_0x5ce3d8(0xef),'Accept':'application/json','User-Agent':_0x5ce3d8(0x137)},'body':JSON[_0x5ce3d8(0xe3)](_0x93a5c9)}),_0x16c745=Date[_0x5ce3d8(0x13f)]()-_0x467f32;console[_0x5ce3d8(0x10b)](_0x5ce3d8(0x115)),console[_0x5ce3d8(0x10b)](_0x5ce3d8(0x119),_0x10b423[_0x5ce3d8(0xfd)]),console[_0x5ce3d8(0x10b)](_0x5ce3d8(0x133),_0x16c745+'ms');if(!_0x10b423['ok']){const _0x1c529d=await _0x10b423[_0x5ce3d8(0x113)]();console[_0x5ce3d8(0x12a)](_0x5ce3d8(0x10f),_0x10b423['status']),console[_0x5ce3d8(0x12a)](_0x5ce3d8(0xcc),_0x1c529d),loggerService_1[_0x5ce3d8(0xdb)][_0x5ce3d8(0xde)](_0x5ce3d8(0xf3),_0x5ce3d8(0x12d),_0x10b423[_0x5ce3d8(0xfd)],_0x1c529d,_0x16c745),loggerService_1['loggerService']['logWhiteDomainError'](_0x5ce3d8(0xf3),_0x5ce3d8(0x12d),'HTTP\x20'+_0x10b423['status']+':\x20'+_0x1c529d);throw new Error(_0x5ce3d8(0x132)+_0x10b423[_0x5ce3d8(0xfd)]);}const _0x326699=await _0x10b423[_0x5ce3d8(0x113)]();console[_0x5ce3d8(0x10b)](_0x5ce3d8(0x127),_0x326699);let _0x7f3d3;try{_0x7f3d3=JSON[_0x5ce3d8(0xec)](_0x326699);}catch(_0x21c91e){console[_0x5ce3d8(0x12a)](_0x5ce3d8(0x11c),_0x21c91e),loggerService_1['loggerService'][_0x5ce3d8(0xed)](_0x5ce3d8(0xf3),_0x5ce3d8(0x12d),_0x5ce3d8(0x141)+_0x21c91e);throw new Error(_0x5ce3d8(0x125)+_0x326699);}loggerService_1['loggerService'][_0x5ce3d8(0xde)](_0x5ce3d8(0xf3),_0x5ce3d8(0x12d),_0x10b423[_0x5ce3d8(0xfd)],_0x7f3d3,_0x16c745),console[_0x5ce3d8(0x10b)](_0x5ce3d8(0xf7)),console[_0x5ce3d8(0x10b)]('Result:',_0x7f3d3['result']),console['log'](_0x5ce3d8(0xea),_0x7f3d3['status_code']),console['log'](_0x5ce3d8(0xfa),_0x7f3d3[_0x5ce3d8(0xe6)]?.[_0x5ce3d8(0xd5)]),console[_0x5ce3d8(0x10b)]('Amount:',_0x7f3d3['data']?.[_0x5ce3d8(0x11b)]),console[_0x5ce3d8(0x10b)]('Currency:',_0x7f3d3[_0x5ce3d8(0xe6)]?.[_0x5ce3d8(0x142)]);if(_0x7f3d3[_0x5ce3d8(0x120)]!==_0x5ce3d8(0x14a)||_0x7f3d3[_0x5ce3d8(0x10c)]!==0xc8){const _0x5bb8b1=_0x7f3d3[_0x5ce3d8(0xe9)]||'Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API';console[_0x5ce3d8(0x12a)](_0x5ce3d8(0x103)),console[_0x5ce3d8(0x12a)](_0x5ce3d8(0x12b),_0x5bb8b1),loggerService_1['loggerService'][_0x5ce3d8(0xed)](_0x5ce3d8(0xf3),'/status','Status\x20API\x20Error:\x20'+_0x5bb8b1);throw new Error(_0x5ce3d8(0x10a)+_0x5bb8b1);}if(!_0x7f3d3[_0x5ce3d8(0xe6)]){console['error'](_0x5ce3d8(0xd7)),console[_0x5ce3d8(0x12a)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x5ce3d8(0xed)](_0x5ce3d8(0xf3),_0x5ce3d8(0x12d),_0x5ce3d8(0x145));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x3e7943=_0x5ce3d8(0x124);switch(_0x7f3d3['data'][_0x5ce3d8(0xd5)]?.[_0x5ce3d8(0x128)]()){case _0x5ce3d8(0xfb):_0x3e7943='PAID';break;case _0x5ce3d8(0xcf):case _0x5ce3d8(0x13e):case _0x5ce3d8(0x12a):_0x3e7943='FAILED';break;case _0x5ce3d8(0x14b):case _0x5ce3d8(0xf1):_0x3e7943=_0x5ce3d8(0x144);break;case _0x5ce3d8(0xd1):case _0x5ce3d8(0xdf):case'pending':case _0x5ce3d8(0xe2):default:_0x3e7943=_0x5ce3d8(0x124);break;}let _0x12194e,_0x4e4d98;if(_0x7f3d3['data'][_0x5ce3d8(0x122)]){const _0x1318be=_0x7f3d3[_0x5ce3d8(0xe6)][_0x5ce3d8(0x122)];console[_0x5ce3d8(0x10b)]('üè¶\x20Payment\x20Detail:',_0x1318be);const _0xa0d7f4=_0x1318be[_0x5ce3d8(0xee)](/IBAN\s+([A-Z0-9]+)/i);_0xa0d7f4&&(_0x12194e=_0xa0d7f4[0x1],console['log'](_0x5ce3d8(0x140),_0x12194e)),_0x4e4d98=_0x1318be;}const _0x3c5e32={'iban':_0x12194e,'bankDetails':_0x4e4d98,'transactionId':_0x7f3d3[_0x5ce3d8(0xe6)][_0x5ce3d8(0x130)],'coinAddress':_0x7f3d3[_0x5ce3d8(0xe6)][_0x5ce3d8(0x135)],'qrCodeUrl':_0x7f3d3[_0x5ce3d8(0xe6)][_0x5ce3d8(0x13a)],'expiryTime':_0x7f3d3[_0x5ce3d8(0xe6)][_0x5ce3d8(0x10d)],'createdOn':_0x7f3d3[_0x5ce3d8(0xe6)]['CreatedOn'],'confirmedOn':_0x7f3d3['data']['TransactionConfirmedOn']};console['log'](_0x5ce3d8(0x129)),console['log'](_0x5ce3d8(0x119),_0x7f3d3[_0x5ce3d8(0xe6)][_0x5ce3d8(0xd5)],'->',_0x3e7943),console['log'](_0x5ce3d8(0x10e),_0x7f3d3[_0x5ce3d8(0xe6)]['Amount'],_0x7f3d3[_0x5ce3d8(0xe6)]['inputCurrency']),console[_0x5ce3d8(0x10b)](_0x5ce3d8(0xd6),_0x7f3d3['data'][_0x5ce3d8(0x130)]),console[_0x5ce3d8(0x10b)](_0x5ce3d8(0xf4),_0x12194e||'not\x20found'),console['log'](_0x5ce3d8(0x110),_0x7f3d3[_0x5ce3d8(0xe6)][_0x5ce3d8(0xdc)]),console[_0x5ce3d8(0x10b)](_0x5ce3d8(0x104),_0x7f3d3[_0x5ce3d8(0xe6)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x7f3d3[_0x5ce3d8(0xe6)][_0x5ce3d8(0xd5)]?.[_0x5ce3d8(0x128)]()===_0x5ce3d8(0xdf))console[_0x5ce3d8(0x10b)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x7f3d3[_0x5ce3d8(0xe6)][_0x5ce3d8(0xd5)]?.[_0x5ce3d8(0x128)]()==='paid'&&console[_0x5ce3d8(0x10b)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x3e7943,'amount':parseFloat(_0x7f3d3['data']['Amount'])||undefined,'currency':_0x7f3d3[_0x5ce3d8(0xe6)][_0x5ce3d8(0x142)]||'EUR','paymentDetails':_0x3c5e32};}catch(_0x4d6bfe){console[_0x5ce3d8(0x12a)](_0x5ce3d8(0x111),_0x4d6bfe),loggerService_1[_0x5ce3d8(0xdb)]['logWhiteDomainError'](_0x5ce3d8(0xf3),_0x5ce3d8(0x12d),_0x4d6bfe);throw new Error(_0x5ce3d8(0x12c)+(_0x4d6bfe instanceof Error?_0x4d6bfe[_0x5ce3d8(0xe9)]:_0x5ce3d8(0xe5)));}}async[a40_0x53a3b6(0xdd)](_0x2154fa){const _0x32c7d8=a40_0x53a3b6,_0x514c0d=await this['checkPaymentStatus'](_0x2154fa);return{'status':_0x514c0d[_0x32c7d8(0xfd)],'amount':_0x514c0d[_0x32c7d8(0x112)],'currency':_0x514c0d[_0x32c7d8(0x11a)]};}async[a40_0x53a3b6(0x146)](_0x5b5f3d){const _0x32bc0b=a40_0x53a3b6;console[_0x32bc0b(0x10b)](_0x32bc0b(0x147),_0x5b5f3d);let _0x5dfa0b='PENDING';switch(_0x5b5f3d[_0x32bc0b(0xfd)]?.[_0x32bc0b(0x128)]()){case _0x32bc0b(0xfb):_0x5dfa0b='PAID';break;case _0x32bc0b(0xcf):case _0x32bc0b(0x13e):case _0x32bc0b(0x12a):_0x5dfa0b='FAILED';break;case'expired':case _0x32bc0b(0xf1):_0x5dfa0b=_0x32bc0b(0x144);break;case'pending':case _0x32bc0b(0xd1):case'awaiting\x20fiat':case _0x32bc0b(0xe2):default:_0x5dfa0b='PENDING';break;}return{'paymentId':_0x5b5f3d[_0x32bc0b(0xce)]||_0x5b5f3d['merchant_reference_id']||'','status':_0x5dfa0b,'amount':_0x5b5f3d[_0x32bc0b(0x112)],'currency':_0x5b5f3d[_0x32bc0b(0x11a)]||_0x32bc0b(0x108)};}}exports[a40_0x53a3b6(0xfc)]=CoinToPay2Service;