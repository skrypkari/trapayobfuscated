'use strict';const a42_0x22e0c2=a42_0x12a2;(function(_0x57d324,_0x3eaf3b){const _0x385ebc=a42_0x12a2,_0x54d288=_0x57d324();while(!![]){try{const _0x595662=-parseInt(_0x385ebc(0xa1))/0x1+parseInt(_0x385ebc(0xb4))/0x2+-parseInt(_0x385ebc(0x101))/0x3+-parseInt(_0x385ebc(0xde))/0x4+-parseInt(_0x385ebc(0xa2))/0x5+-parseInt(_0x385ebc(0xe7))/0x6+-parseInt(_0x385ebc(0x9b))/0x7*(-parseInt(_0x385ebc(0xa6))/0x8);if(_0x595662===_0x3eaf3b)break;else _0x54d288['push'](_0x54d288['shift']());}catch(_0x575541){_0x54d288['push'](_0x54d288['shift']());}}}(a42_0x1bcd,0x377e7));function a42_0x12a2(_0x25717b,_0x125f21){const _0x1bcd0b=a42_0x1bcd();return a42_0x12a2=function(_0x12a2cf,_0x9cd6f4){_0x12a2cf=_0x12a2cf-0x7a;let _0x13eabd=_0x1bcd0b[_0x12a2cf];return _0x13eabd;},a42_0x12a2(_0x25717b,_0x125f21);}function a42_0x1bcd(){const _0x2f213e=['created','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','waiting','CreatedOn','cancelled','POST','https://traffer.uk/gateway/cointopay/','/create','/status','source','statusUrl','stringify','EUR','not\x20found','gateway_payment_id','loggerService','application/json','Confirmed\x20On:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','using\x20pattern:','Response\x20Time:','Parsed\x20Result:','Error\x20message:','paid','TransactionID','267728IMQpMt','parse','üè¶\x20Extracted\x20IBAN:','CoinToPay2Service','message','now','CoinToPay2\x20status\x20API\x20error:\x20','inputCurrency','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','1918878OqZNOJ','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','processWebhook','CoinToPay2\x20API\x20error:\x20','expired','data','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','logWhiteDomainRequest','üè¶\x20Payment\x20Detail:','pending','URL:','Response\x20Body:','TransactionConfirmedOn','not\x20confirmed','PaymentDetail','logWhiteDomainResponse','Status:','../loggerService','Error\x20Message:','Status','HTTP\x20Status:','match','HTTP\x20error!\x20status:\x20','JSON\x20Parse\x20Error:\x20','HTTP\x20','Status\x20Code:','342987HmjoMe','failed','result','Amount','payment_url','logWhiteDomainError','===\x20COINTOPAY2\x20API\x20ERROR\x20===','apiUrl','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','Gateway\x20Payment\x20ID:','Created\x20On:','Business\x20Error:\x20','Error\x20stack:','fromEntries','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','headers','Status\x20Text:','text','Request\x20Body:','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','merchant_reference_id','Raw\x20Response\x20Body:','Result:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','ExpiryTime','statusText','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','FAILED','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','status','success','error','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','EXPIRED','Error\x20details:','35yxfsUe','defineProperty','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','stack','checkPaymentStatus','128536ddfOmO','1331225iWXtBl','__esModule','currency','Failed\x20to\x20parse\x20JSON\x20response:','1453168JyQCCx','Transaction\x20ID:','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','Payment\x20Status:','Unknown\x20error','===\x20COINTOPAY2\x20SUCCESS\x20===','order_id','CoinToPay2\x20payment\x20status\x20check\x20error:','Status\x20API\x20Error:\x20','PAID','üìä\x20Status\x20check\x20URL:','Amount:','createPaymentLink','429856YsGYCw','cointopay2','coinAddress','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Response\x20data:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','Unknown\x20error\x20from\x20CoinToPay2\x20API','awaiting\x20fiat','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','PENDING','log','Headers:','amount','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','entries','toLowerCase'];a42_0x1bcd=function(){return _0x2f213e;};return a42_0x1bcd();}Object[a42_0x22e0c2(0x9c)](exports,a42_0x22e0c2(0xa3),{'value':!![]}),exports['CoinToPay2Service']=void 0x0;const loggerService_1=require(a42_0x22e0c2(0xf8));class CoinToPay2Service{constructor(){const _0x3f6d9f=a42_0x22e0c2;this[_0x3f6d9f(0x7d)]=_0x3f6d9f(0xcb),this['statusUrl']='https://traffer.uk/gateway/cointopay/status.php',console[_0x3f6d9f(0xbe)](_0x3f6d9f(0xed)),console['log'](_0x3f6d9f(0xb1),this[_0x3f6d9f(0xcf)]);}async[a42_0x22e0c2(0xb3)](_0x1b89f0){const _0x20230b=a42_0x22e0c2,{orderId:_0x5095da,amount:_0x4f3c51}=_0x1b89f0;console[_0x20230b(0xbe)](_0x20230b(0x86)+_0x4f3c51+'\x20EUR');const _0xb8d043={'amount':_0x4f3c51},_0x4a607b=Date[_0x20230b(0xe3)]();try{console[_0x20230b(0xbe)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console[_0x20230b(0xbe)](_0x20230b(0xf1),this[_0x20230b(0x7d)]),console['log'](_0x20230b(0x8a),JSON[_0x20230b(0xd0)](_0xb8d043,null,0x2)),console['log'](_0x20230b(0xb2),_0x4f3c51,_0x20230b(0xa8)),loggerService_1[_0x20230b(0xd4)][_0x20230b(0xee)](_0x20230b(0xb5),_0x20230b(0xcc),'POST',_0xb8d043);const _0x279b09=await fetch(this[_0x20230b(0x7d)],{'method':_0x20230b(0xca),'headers':{'Content-Type':_0x20230b(0xd5),'Accept':_0x20230b(0xd5),'User-Agent':_0x20230b(0xc6)},'body':JSON[_0x20230b(0xd0)](_0xb8d043)}),_0x539733=Date[_0x20230b(0xe3)]()-_0x4a607b;console[_0x20230b(0xbe)]('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console[_0x20230b(0xbe)](_0x20230b(0xf7),_0x279b09[_0x20230b(0x95)]),console[_0x20230b(0xbe)](_0x20230b(0x88),_0x279b09[_0x20230b(0x91)]),console['log'](_0x20230b(0xbf),Object[_0x20230b(0x85)](_0x279b09[_0x20230b(0x87)][_0x20230b(0xc2)]())),console[_0x20230b(0xbe)](_0x20230b(0xd9),_0x539733+'ms');const _0x4b0e27=await _0x279b09[_0x20230b(0x89)]();console[_0x20230b(0xbe)]('Raw\x20Response\x20Body:',_0x4b0e27);if(!_0x279b09['ok']){console[_0x20230b(0x97)](_0x20230b(0x7c)),console['error'](_0x20230b(0xfb),_0x279b09[_0x20230b(0x95)]),console[_0x20230b(0x97)]('Response\x20Body:',_0x4b0e27),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x20230b(0xb5),_0x20230b(0xcc),_0x279b09[_0x20230b(0x95)],_0x4b0e27,_0x539733),loggerService_1[_0x20230b(0xd4)][_0x20230b(0x7b)](_0x20230b(0xb5),_0x20230b(0xcc),_0x20230b(0xff)+_0x279b09[_0x20230b(0x95)]+':\x20'+_0x4b0e27);throw new Error(_0x20230b(0xfd)+_0x279b09[_0x20230b(0x95)]+',\x20body:\x20'+_0x4b0e27);}let _0x376bfa;try{_0x376bfa=JSON[_0x20230b(0xdf)](_0x4b0e27);}catch(_0x1781f2){console['error'](_0x20230b(0xa5),_0x1781f2),loggerService_1[_0x20230b(0xd4)][_0x20230b(0x7b)](_0x20230b(0xb5),_0x20230b(0xcc),_0x20230b(0xfe)+_0x1781f2);throw new Error(_0x20230b(0xc5)+_0x4b0e27);}console[_0x20230b(0xbe)](_0x20230b(0xd7)),console[_0x20230b(0xbe)](_0x20230b(0xda),JSON[_0x20230b(0xd0)](_0x376bfa,null,0x2)),loggerService_1[_0x20230b(0xd4)][_0x20230b(0xf6)](_0x20230b(0xb5),_0x20230b(0xcc),_0x279b09[_0x20230b(0x95)],_0x376bfa,_0x539733);if(_0x376bfa[_0x20230b(0x97)]){const _0x451a8d=_0x376bfa[_0x20230b(0xe2)]||_0x376bfa[_0x20230b(0x97)]||_0x20230b(0xba);console[_0x20230b(0x97)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x20230b(0x97)](_0x20230b(0xf9),_0x451a8d),loggerService_1[_0x20230b(0xd4)][_0x20230b(0x7b)](_0x20230b(0xb5),_0x20230b(0xcc),_0x20230b(0x83)+_0x451a8d);throw new Error(_0x20230b(0xea)+_0x451a8d);}if(!_0x376bfa['payment_url']||!_0x376bfa[_0x20230b(0xd3)]){console[_0x20230b(0x97)](_0x20230b(0x7f)),console[_0x20230b(0x97)](_0x20230b(0x8f)),console[_0x20230b(0x97)](_0x20230b(0xb8),_0x376bfa),loggerService_1[_0x20230b(0xd4)]['logWhiteDomainError'](_0x20230b(0xb5),'/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x20230b(0x94));}return console['log'](_0x20230b(0xac)),console['log'](_0x20230b(0x81),_0x376bfa[_0x20230b(0xd3)]),console[_0x20230b(0xbe)]('Payment\x20URL:',_0x376bfa[_0x20230b(0x7a)]),console['log'](_0x20230b(0xb2),_0x4f3c51,_0x20230b(0xd1)),{'gateway_payment_id':_0x376bfa[_0x20230b(0xd3)],'payment_url':_0x376bfa[_0x20230b(0x7a)]};}catch(_0x299edb){console[_0x20230b(0x97)](_0x20230b(0xbc)),console[_0x20230b(0x97)](_0x20230b(0x9a),_0x299edb),loggerService_1[_0x20230b(0xd4)][_0x20230b(0x7b)](_0x20230b(0xb5),_0x20230b(0xcc),_0x299edb);if(_0x299edb instanceof Error){console[_0x20230b(0x97)](_0x20230b(0xdb),_0x299edb[_0x20230b(0xe2)]),console['error'](_0x20230b(0x84),_0x299edb[_0x20230b(0x9f)]);throw new Error(_0x20230b(0xb9)+_0x299edb[_0x20230b(0xe2)]);}throw new Error(_0x20230b(0xe8));}}async[a42_0x22e0c2(0xa0)](_0xa6a081){const _0x3e71cc=a42_0x22e0c2,_0x3d84ba=Date[_0x3e71cc(0xe3)]();try{console[_0x3e71cc(0xbe)]('üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0xa6a081);const _0x29d63b={'gatewayPaymentId':_0xa6a081};loggerService_1[_0x3e71cc(0xd4)]['logWhiteDomainRequest'](_0x3e71cc(0xb5),_0x3e71cc(0xcd),'POST',_0x29d63b);const _0x4090e6=await fetch(this[_0x3e71cc(0xcf)],{'method':_0x3e71cc(0xca),'headers':{'Content-Type':_0x3e71cc(0xd5),'Accept':'application/json','User-Agent':_0x3e71cc(0xc6)},'body':JSON[_0x3e71cc(0xd0)](_0x29d63b)}),_0x1e2d93=Date[_0x3e71cc(0xe3)]()-_0x3d84ba;console[_0x3e71cc(0xbe)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x3e71cc(0xbe)]('Status:',_0x4090e6['status']),console[_0x3e71cc(0xbe)](_0x3e71cc(0xd9),_0x1e2d93+'ms');if(!_0x4090e6['ok']){const _0x3e4a99=await _0x4090e6['text']();console[_0x3e71cc(0x97)]('HTTP\x20Status:',_0x4090e6[_0x3e71cc(0x95)]),console['error'](_0x3e71cc(0xf2),_0x3e4a99),loggerService_1[_0x3e71cc(0xd4)][_0x3e71cc(0xf6)](_0x3e71cc(0xb5),_0x3e71cc(0xcd),_0x4090e6['status'],_0x3e4a99,_0x1e2d93),loggerService_1[_0x3e71cc(0xd4)]['logWhiteDomainError'](_0x3e71cc(0xb5),_0x3e71cc(0xcd),_0x3e71cc(0xff)+_0x4090e6[_0x3e71cc(0x95)]+':\x20'+_0x3e4a99);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4090e6['status']);}const _0xb323a0=await _0x4090e6[_0x3e71cc(0x89)]();console['log'](_0x3e71cc(0x8d),_0xb323a0);let _0x54133a;try{_0x54133a=JSON[_0x3e71cc(0xdf)](_0xb323a0);}catch(_0x2ec759){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x2ec759),loggerService_1['loggerService'][_0x3e71cc(0x7b)](_0x3e71cc(0xb5),_0x3e71cc(0xcd),_0x3e71cc(0xfe)+_0x2ec759);throw new Error(_0x3e71cc(0xc1)+_0xb323a0);}loggerService_1[_0x3e71cc(0xd4)]['logWhiteDomainResponse'](_0x3e71cc(0xb5),_0x3e71cc(0xcd),_0x4090e6[_0x3e71cc(0x95)],_0x54133a,_0x1e2d93),console[_0x3e71cc(0xbe)](_0x3e71cc(0xa9)),console[_0x3e71cc(0xbe)](_0x3e71cc(0x8e),_0x54133a[_0x3e71cc(0x103)]),console[_0x3e71cc(0xbe)](_0x3e71cc(0x100),_0x54133a['status_code']),console[_0x3e71cc(0xbe)](_0x3e71cc(0xaa),_0x54133a[_0x3e71cc(0xec)]?.[_0x3e71cc(0xfa)]),console[_0x3e71cc(0xbe)]('Amount:',_0x54133a['data']?.[_0x3e71cc(0x104)]),console[_0x3e71cc(0xbe)]('Currency:',_0x54133a[_0x3e71cc(0xec)]?.[_0x3e71cc(0xe5)]);if(_0x54133a[_0x3e71cc(0x103)]!==_0x3e71cc(0x96)||_0x54133a['status_code']!==0xc8){const _0x37d286=_0x54133a[_0x3e71cc(0xe2)]||_0x3e71cc(0xb7);console[_0x3e71cc(0x97)](_0x3e71cc(0x9e)),console[_0x3e71cc(0x97)](_0x3e71cc(0xf9),_0x37d286),loggerService_1[_0x3e71cc(0xd4)][_0x3e71cc(0x7b)]('cointopay2','/status',_0x3e71cc(0xaf)+_0x37d286);throw new Error(_0x3e71cc(0xe4)+_0x37d286);}if(!_0x54133a['data']){console[_0x3e71cc(0x97)](_0x3e71cc(0x98)),console[_0x3e71cc(0x97)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x3e71cc(0xd4)][_0x3e71cc(0x7b)](_0x3e71cc(0xb5),_0x3e71cc(0xcd),'Incomplete\x20response:\x20missing\x20data');throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x3dca1b=_0x3e71cc(0xbd);switch(_0x54133a[_0x3e71cc(0xec)]['Status']?.[_0x3e71cc(0xc3)]()){case _0x3e71cc(0xdc):_0x3dca1b='PAID';break;case _0x3e71cc(0xc9):case'failed':case _0x3e71cc(0x97):_0x3dca1b=_0x3e71cc(0x93);break;case _0x3e71cc(0xeb):case'timeout':_0x3dca1b=_0x3e71cc(0x99);break;case _0x3e71cc(0xc7):case _0x3e71cc(0xbb):case _0x3e71cc(0xf0):case _0x3e71cc(0xc4):default:_0x3dca1b=_0x3e71cc(0xbd);break;}let _0x4e5eec,_0x2ac368;if(_0x54133a['data']['PaymentDetail']){const _0x33dd40=_0x54133a['data'][_0x3e71cc(0xf5)];console[_0x3e71cc(0xbe)](_0x3e71cc(0xef),_0x33dd40);const _0x2c55a4=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x11f5a1 of _0x2c55a4){const _0xdc4604=_0x33dd40[_0x3e71cc(0xfc)](_0x11f5a1);if(_0xdc4604){_0x4e5eec=_0xdc4604[0x1],console[_0x3e71cc(0xbe)](_0x3e71cc(0xe0),_0x4e5eec,_0x3e71cc(0xd8),_0x11f5a1[_0x3e71cc(0xce)]);break;}}if(!_0x4e5eec){console[_0x3e71cc(0xbe)](_0x3e71cc(0x80));const _0x37c375=_0x33dd40[_0x3e71cc(0xfc)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x37c375&&(_0x4e5eec=_0x37c375[0x1],console['log'](_0x3e71cc(0xe6),_0x4e5eec));}_0x2ac368=_0x33dd40;}const _0x242b69={'iban':_0x4e5eec,'bankDetails':_0x2ac368,'transactionId':_0x54133a[_0x3e71cc(0xec)][_0x3e71cc(0xdd)],'coinAddress':_0x54133a[_0x3e71cc(0xec)][_0x3e71cc(0xb6)],'qrCodeUrl':_0x54133a['data']['QRCodeURL'],'expiryTime':_0x54133a[_0x3e71cc(0xec)][_0x3e71cc(0x90)],'createdOn':_0x54133a[_0x3e71cc(0xec)]['CreatedOn'],'confirmedOn':_0x54133a['data'][_0x3e71cc(0xf3)]};console[_0x3e71cc(0xbe)](_0x3e71cc(0x8b)),console[_0x3e71cc(0xbe)](_0x3e71cc(0xf7),_0x54133a[_0x3e71cc(0xec)][_0x3e71cc(0xfa)],'->',_0x3dca1b),console[_0x3e71cc(0xbe)](_0x3e71cc(0xb2),_0x54133a['data'][_0x3e71cc(0x104)],_0x54133a[_0x3e71cc(0xec)][_0x3e71cc(0xe5)]),console[_0x3e71cc(0xbe)](_0x3e71cc(0xa7),_0x54133a[_0x3e71cc(0xec)]['TransactionID']),console[_0x3e71cc(0xbe)]('IBAN:',_0x4e5eec||_0x3e71cc(0xd2)),console[_0x3e71cc(0xbe)](_0x3e71cc(0x82),_0x54133a[_0x3e71cc(0xec)][_0x3e71cc(0xc8)]),console['log'](_0x3e71cc(0xd6),_0x54133a[_0x3e71cc(0xec)]['TransactionConfirmedOn']||_0x3e71cc(0xf4));if(_0x54133a['data'][_0x3e71cc(0xfa)]?.[_0x3e71cc(0xc3)]()===_0x3e71cc(0xbb))console[_0x3e71cc(0xbe)](_0x3e71cc(0x92));else _0x54133a[_0x3e71cc(0xec)][_0x3e71cc(0xfa)]?.[_0x3e71cc(0xc3)]()==='paid'&&console[_0x3e71cc(0xbe)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x3dca1b,'amount':parseFloat(_0x54133a[_0x3e71cc(0xec)][_0x3e71cc(0x104)])||undefined,'currency':_0x54133a[_0x3e71cc(0xec)][_0x3e71cc(0xe5)]||_0x3e71cc(0xd1),'paymentDetails':_0x242b69};}catch(_0x22442c){console[_0x3e71cc(0x97)](_0x3e71cc(0xae),_0x22442c),loggerService_1[_0x3e71cc(0xd4)][_0x3e71cc(0x7b)](_0x3e71cc(0xb5),'/status',_0x22442c);throw new Error(_0x3e71cc(0x9d)+(_0x22442c instanceof Error?_0x22442c['message']:_0x3e71cc(0xab)));}}async['verifyPayment'](_0x5f32b0){const _0x5b398d=a42_0x22e0c2,_0x831ac4=await this[_0x5b398d(0xa0)](_0x5f32b0);return{'status':_0x831ac4['status'],'amount':_0x831ac4[_0x5b398d(0xc0)],'currency':_0x831ac4[_0x5b398d(0xa4)]};}async[a42_0x22e0c2(0xe9)](_0xf37bb5){const _0x4888c0=a42_0x22e0c2;console['log'](_0x4888c0(0x7e),_0xf37bb5);let _0x4e1865=_0x4888c0(0xbd);switch(_0xf37bb5['status']?.[_0x4888c0(0xc3)]()){case _0x4888c0(0xdc):_0x4e1865=_0x4888c0(0xb0);break;case'cancelled':case _0x4888c0(0x102):case _0x4888c0(0x97):_0x4e1865='FAILED';break;case _0x4888c0(0xeb):case'timeout':_0x4e1865=_0x4888c0(0x99);break;case _0x4888c0(0xf0):case'waiting':case _0x4888c0(0xbb):case _0x4888c0(0xc4):default:_0x4e1865='PENDING';break;}return{'paymentId':_0xf37bb5[_0x4888c0(0xad)]||_0xf37bb5[_0x4888c0(0x8c)]||'','status':_0x4e1865,'amount':_0xf37bb5[_0x4888c0(0xc0)],'currency':_0xf37bb5[_0x4888c0(0xa4)]||'EUR'};}}exports[a42_0x22e0c2(0xe1)]=CoinToPay2Service;