'use strict';const a56_0x181901=a56_0x26dc;(function(_0x48ddc2,_0x1d5c6b){const _0xdeb709=a56_0x26dc,_0x3edab2=_0x48ddc2();while(!![]){try{const _0x1a1d9d=parseInt(_0xdeb709(0x98))/0x1*(parseInt(_0xdeb709(0xfb))/0x2)+parseInt(_0xdeb709(0x95))/0x3*(parseInt(_0xdeb709(0x9e))/0x4)+-parseInt(_0xdeb709(0xc3))/0x5*(parseInt(_0xdeb709(0xda))/0x6)+-parseInt(_0xdeb709(0xc6))/0x7*(-parseInt(_0xdeb709(0x83))/0x8)+parseInt(_0xdeb709(0xf9))/0x9+-parseInt(_0xdeb709(0xbb))/0xa+parseInt(_0xdeb709(0x7b))/0xb;if(_0x1a1d9d===_0x1d5c6b)break;else _0x3edab2['push'](_0x3edab2['shift']());}catch(_0x135d8c){_0x3edab2['push'](_0x3edab2['shift']());}}}(a56_0x2a21,0xcd76a));Object[a56_0x181901(0xf2)](exports,a56_0x181901(0xf0),{'value':!![]}),exports[a56_0x181901(0xe5)]=void 0x0;const loggerService_1=require(a56_0x181901(0x93));class CoinToPay2Service{constructor(){const _0x260885=a56_0x181901;this[_0x260885(0xf1)]=_0x260885(0xc1),this[_0x260885(0x7f)]=_0x260885(0xb4),console[_0x260885(0xe9)](_0x260885(0xab)),console[_0x260885(0xe9)]('üìä\x20Status\x20check\x20URL:',this[_0x260885(0x7f)]);}async[a56_0x181901(0xd2)](_0x589ad0){const _0x5c8337=a56_0x181901,{orderId:_0x5c8dee,amount:_0x209286}=_0x589ad0;console[_0x5c8337(0xe9)](_0x5c8337(0x9c)+_0x209286+_0x5c8337(0xaf));const _0x1af640={'amount':_0x209286},_0x3ac55e=Date[_0x5c8337(0xa9)]();try{console[_0x5c8337(0xe9)](_0x5c8337(0x9a)),console[_0x5c8337(0xe9)](_0x5c8337(0xa8),this[_0x5c8337(0xf1)]),console[_0x5c8337(0xe9)](_0x5c8337(0xcd),JSON[_0x5c8337(0xa3)](_0x1af640,null,0x2)),console[_0x5c8337(0xe9)]('Amount:',_0x209286,_0x5c8337(0xd7)),loggerService_1[_0x5c8337(0xde)][_0x5c8337(0xce)](_0x5c8337(0x89),_0x5c8337(0xdc),_0x5c8337(0xca),_0x1af640);const _0x2373c1=await fetch(this[_0x5c8337(0xf1)],{'method':_0x5c8337(0xca),'headers':{'Content-Type':_0x5c8337(0xc8),'Accept':'application/json','User-Agent':_0x5c8337(0x103)},'body':JSON[_0x5c8337(0xa3)](_0x1af640)}),_0x2152cd=Date[_0x5c8337(0xa9)]()-_0x3ac55e;console[_0x5c8337(0xe9)](_0x5c8337(0x90)),console[_0x5c8337(0xe9)]('Status:',_0x2373c1['status']),console[_0x5c8337(0xe9)](_0x5c8337(0xd1),_0x2373c1[_0x5c8337(0xb6)]),console['log'](_0x5c8337(0xa2),Object[_0x5c8337(0xad)](_0x2373c1[_0x5c8337(0xac)][_0x5c8337(0xfd)]())),console[_0x5c8337(0xe9)](_0x5c8337(0xae),_0x2152cd+'ms');const _0x303bfd=await _0x2373c1['text']();console[_0x5c8337(0xe9)](_0x5c8337(0xdd),_0x303bfd);if(!_0x2373c1['ok']){console[_0x5c8337(0xb0)]('===\x20COINTOPAY2\x20API\x20ERROR\x20==='),console[_0x5c8337(0xb0)](_0x5c8337(0xe7),_0x2373c1[_0x5c8337(0xaa)]),console['error']('Response\x20Body:',_0x303bfd),loggerService_1[_0x5c8337(0xde)]['logWhiteDomainResponse'](_0x5c8337(0x89),_0x5c8337(0xdc),_0x2373c1['status'],_0x303bfd,_0x2152cd),loggerService_1[_0x5c8337(0xde)][_0x5c8337(0x8e)](_0x5c8337(0x89),_0x5c8337(0xdc),_0x5c8337(0x7c)+_0x2373c1[_0x5c8337(0xaa)]+':\x20'+_0x303bfd);throw new Error(_0x5c8337(0xbf)+_0x2373c1[_0x5c8337(0xaa)]+_0x5c8337(0xef)+_0x303bfd);}let _0x1a84ec;try{_0x1a84ec=JSON[_0x5c8337(0x101)](_0x303bfd);}catch(_0x46204b){console[_0x5c8337(0xb0)](_0x5c8337(0xeb),_0x46204b),loggerService_1['loggerService'][_0x5c8337(0x8e)]('cointopay2',_0x5c8337(0xdc),_0x5c8337(0x80)+_0x46204b);throw new Error(_0x5c8337(0x88)+_0x303bfd);}console['log']('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console[_0x5c8337(0xe9)](_0x5c8337(0xc9),JSON[_0x5c8337(0xa3)](_0x1a84ec,null,0x2)),loggerService_1[_0x5c8337(0xde)][_0x5c8337(0xd4)](_0x5c8337(0x89),_0x5c8337(0xdc),_0x2373c1[_0x5c8337(0xaa)],_0x1a84ec,_0x2152cd);if(_0x1a84ec[_0x5c8337(0xb0)]){const _0x5f5914=_0x1a84ec[_0x5c8337(0xf5)]||_0x1a84ec[_0x5c8337(0xb0)]||_0x5c8337(0xd8);console[_0x5c8337(0xb0)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x5c8337(0xb0)]('Error\x20Message:',_0x5f5914),loggerService_1[_0x5c8337(0xde)][_0x5c8337(0x8e)]('cointopay2',_0x5c8337(0xdc),_0x5c8337(0x100)+_0x5f5914);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x5f5914);}if(!_0x1a84ec[_0x5c8337(0xa7)]||!_0x1a84ec[_0x5c8337(0x91)]){console[_0x5c8337(0xb0)]('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x5c8337(0xb0)](_0x5c8337(0xe4),_0x1a84ec),loggerService_1[_0x5c8337(0xde)][_0x5c8337(0x8e)](_0x5c8337(0x89),_0x5c8337(0xdc),_0x5c8337(0x9f));throw new Error(_0x5c8337(0x99));}console[_0x5c8337(0xe9)](_0x5c8337(0x87)),console[_0x5c8337(0xe9)]('Gateway\x20Payment\x20ID:',_0x1a84ec[_0x5c8337(0x91)]),console[_0x5c8337(0xe9)](_0x5c8337(0xa5),_0x1a84ec[_0x5c8337(0xa7)]);const _0x4ffd48=_0x1a84ec['payment_url']+'&alternative=false';return console['log']('Payment\x20URL\x20(modified):',_0x4ffd48),console[_0x5c8337(0xe9)](_0x5c8337(0x86),_0x209286,'EUR'),{'gateway_payment_id':_0x1a84ec[_0x5c8337(0x91)],'payment_url':_0x4ffd48};}catch(_0xcb730){console[_0x5c8337(0xb0)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x5c8337(0xb0)]('Error\x20details:',_0xcb730),loggerService_1[_0x5c8337(0xde)][_0x5c8337(0x8e)](_0x5c8337(0x89),_0x5c8337(0xdc),_0xcb730);if(_0xcb730 instanceof Error){console[_0x5c8337(0xb0)]('Error\x20message:',_0xcb730['message']),console[_0x5c8337(0xb0)]('Error\x20stack:',_0xcb730['stack']);throw new Error(_0x5c8337(0xec)+_0xcb730[_0x5c8337(0xf5)]);}throw new Error(_0x5c8337(0x9d));}}async[a56_0x181901(0xff)](_0x4d4e3f){const _0x2888d7=a56_0x181901,_0x21afeb=Date[_0x2888d7(0xa9)]();try{console[_0x2888d7(0xe9)](_0x2888d7(0xb5)+_0x4d4e3f);const _0x13ad85={'gatewayPaymentId':_0x4d4e3f};loggerService_1[_0x2888d7(0xde)][_0x2888d7(0xce)](_0x2888d7(0x89),_0x2888d7(0xf8),_0x2888d7(0xca),_0x13ad85);const _0x505fb5=await fetch(this['statusUrl'],{'method':_0x2888d7(0xca),'headers':{'Content-Type':_0x2888d7(0xc8),'Accept':_0x2888d7(0xc8),'User-Agent':'Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON['stringify'](_0x13ad85)}),_0x5c86ec=Date[_0x2888d7(0xa9)]()-_0x21afeb;console[_0x2888d7(0xe9)](_0x2888d7(0xbc)),console[_0x2888d7(0xe9)](_0x2888d7(0x96),_0x505fb5[_0x2888d7(0xaa)]),console[_0x2888d7(0xe9)](_0x2888d7(0xae),_0x5c86ec+'ms');if(!_0x505fb5['ok']){const _0x426550=await _0x505fb5[_0x2888d7(0xcb)]();console['error'](_0x2888d7(0xe7),_0x505fb5[_0x2888d7(0xaa)]),console[_0x2888d7(0xb0)]('Response\x20Body:',_0x426550),loggerService_1['loggerService'][_0x2888d7(0xd4)](_0x2888d7(0x89),_0x2888d7(0xf8),_0x505fb5[_0x2888d7(0xaa)],_0x426550,_0x5c86ec),loggerService_1[_0x2888d7(0xde)][_0x2888d7(0x8e)](_0x2888d7(0x89),_0x2888d7(0xf8),_0x2888d7(0x7c)+_0x505fb5['status']+':\x20'+_0x426550);throw new Error(_0x2888d7(0xbf)+_0x505fb5[_0x2888d7(0xaa)]);}const _0x385847=await _0x505fb5['text']();console[_0x2888d7(0xe9)](_0x2888d7(0xdd),_0x385847);let _0x3557b2;try{_0x3557b2=JSON[_0x2888d7(0x101)](_0x385847);}catch(_0x15e5d7){console[_0x2888d7(0xb0)](_0x2888d7(0xeb),_0x15e5d7),loggerService_1[_0x2888d7(0xde)]['logWhiteDomainError'](_0x2888d7(0x89),_0x2888d7(0xf8),_0x2888d7(0x80)+_0x15e5d7);throw new Error(_0x2888d7(0xcc)+_0x385847);}loggerService_1['loggerService'][_0x2888d7(0xd4)](_0x2888d7(0x89),_0x2888d7(0xf8),_0x505fb5[_0x2888d7(0xaa)],_0x3557b2,_0x5c86ec),console[_0x2888d7(0xe9)](_0x2888d7(0xa1)),console[_0x2888d7(0xe9)](_0x2888d7(0xcf),_0x3557b2[_0x2888d7(0xc7)]),console['log'](_0x2888d7(0xba),_0x3557b2[_0x2888d7(0xe2)]),console[_0x2888d7(0xe9)](_0x2888d7(0xc0),_0x3557b2[_0x2888d7(0x85)]?.[_0x2888d7(0x94)]),console['log']('Amount:',_0x3557b2['data']?.[_0x2888d7(0xb8)]),console[_0x2888d7(0xe9)](_0x2888d7(0x104),_0x3557b2[_0x2888d7(0x85)]?.[_0x2888d7(0x9b)]);if(_0x3557b2[_0x2888d7(0xc7)]!==_0x2888d7(0x8d)||_0x3557b2[_0x2888d7(0xe2)]!==0xc8){const _0x3d3170=_0x3557b2[_0x2888d7(0xf5)]||_0x2888d7(0x105);console[_0x2888d7(0xb0)]('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console[_0x2888d7(0xb0)](_0x2888d7(0x97),_0x3d3170),loggerService_1[_0x2888d7(0xde)][_0x2888d7(0x8e)](_0x2888d7(0x89),_0x2888d7(0xf8),_0x2888d7(0x102)+_0x3d3170);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0x3d3170);}if(!_0x3557b2[_0x2888d7(0x85)]){console[_0x2888d7(0xb0)](_0x2888d7(0x7d)),console[_0x2888d7(0xb0)](_0x2888d7(0xb3)),loggerService_1[_0x2888d7(0xde)]['logWhiteDomainError'](_0x2888d7(0x89),_0x2888d7(0xf8),_0x2888d7(0xf4));throw new Error(_0x2888d7(0x81));}let _0x3c3799=_0x2888d7(0xe3);switch(_0x3557b2[_0x2888d7(0x85)][_0x2888d7(0x94)]?.[_0x2888d7(0x92)]()){case _0x2888d7(0xd6):_0x3c3799=_0x2888d7(0xea);break;case'cancelled':case _0x2888d7(0xbe):case _0x2888d7(0xb0):_0x3c3799=_0x2888d7(0x8a);break;case _0x2888d7(0x82):case _0x2888d7(0xfa):_0x3c3799=_0x2888d7(0xb2);break;case'waiting':case _0x2888d7(0xa4):case _0x2888d7(0xd5):case'created':default:_0x3c3799=_0x2888d7(0xe3);break;}let _0x2de99d,_0x5899bf;if(_0x3557b2[_0x2888d7(0x85)]['PaymentDetail']){const _0x224384=_0x3557b2['data'][_0x2888d7(0x8c)];console[_0x2888d7(0xe9)](_0x2888d7(0xc5),_0x224384);const _0x3802fc=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x156a39 of _0x3802fc){const _0x40c2c9=_0x224384['match'](_0x156a39);if(_0x40c2c9){_0x2de99d=_0x40c2c9[0x1],console[_0x2888d7(0xe9)]('üè¶\x20Extracted\x20IBAN:',_0x2de99d,_0x2888d7(0xe0),_0x156a39[_0x2888d7(0xa0)]);break;}}if(!_0x2de99d){console[_0x2888d7(0xe9)]('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x643c9d=_0x224384[_0x2888d7(0x7e)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x643c9d&&(_0x2de99d=_0x643c9d[0x1],console[_0x2888d7(0xe9)](_0x2888d7(0xc4),_0x2de99d));}_0x5899bf=_0x224384;}const _0x549600={'iban':_0x2de99d,'bankDetails':_0x5899bf,'transactionId':_0x3557b2[_0x2888d7(0x85)][_0x2888d7(0x8f)],'coinAddress':_0x3557b2[_0x2888d7(0x85)][_0x2888d7(0xbd)],'qrCodeUrl':_0x3557b2[_0x2888d7(0x85)][_0x2888d7(0xdb)],'expiryTime':_0x3557b2[_0x2888d7(0x85)]['ExpiryTime'],'createdOn':_0x3557b2['data']['CreatedOn'],'confirmedOn':_0x3557b2['data'][_0x2888d7(0xd3)]};console[_0x2888d7(0xe9)](_0x2888d7(0xe1)),console[_0x2888d7(0xe9)]('Status:',_0x3557b2['data'][_0x2888d7(0x94)],'->',_0x3c3799),console[_0x2888d7(0xe9)](_0x2888d7(0x86),_0x3557b2[_0x2888d7(0x85)][_0x2888d7(0xb8)],_0x3557b2['data'][_0x2888d7(0x9b)]),console[_0x2888d7(0xe9)](_0x2888d7(0xee),_0x3557b2[_0x2888d7(0x85)][_0x2888d7(0x8f)]),console['log']('IBAN:',_0x2de99d||_0x2888d7(0xb1)),console[_0x2888d7(0xe9)](_0x2888d7(0xf7),_0x3557b2[_0x2888d7(0x85)][_0x2888d7(0xe6)]),console['log'](_0x2888d7(0xf6),_0x3557b2[_0x2888d7(0x85)][_0x2888d7(0xd3)]||_0x2888d7(0xfc));if(_0x3557b2[_0x2888d7(0x85)][_0x2888d7(0x94)]?.[_0x2888d7(0x92)]()===_0x2888d7(0xa4))console[_0x2888d7(0xe9)](_0x2888d7(0xfe));else _0x3557b2[_0x2888d7(0x85)]['Status']?.['toLowerCase']()===_0x2888d7(0xd6)&&console[_0x2888d7(0xe9)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x3c3799,'amount':parseFloat(_0x3557b2[_0x2888d7(0x85)][_0x2888d7(0xb8)])||undefined,'currency':_0x3557b2[_0x2888d7(0x85)][_0x2888d7(0x9b)]||_0x2888d7(0xb7),'paymentDetails':_0x549600};}catch(_0x51a16a){console['error'](_0x2888d7(0xd0),_0x51a16a),loggerService_1[_0x2888d7(0xde)][_0x2888d7(0x8e)](_0x2888d7(0x89),_0x2888d7(0xf8),_0x51a16a);throw new Error(_0x2888d7(0xf3)+(_0x51a16a instanceof Error?_0x51a16a[_0x2888d7(0xf5)]:_0x2888d7(0xed)));}}async[a56_0x181901(0xb9)](_0x2ef95d){const _0x19ea0e=a56_0x181901,_0x10582d=await this[_0x19ea0e(0xff)](_0x2ef95d);return{'status':_0x10582d[_0x19ea0e(0xaa)],'amount':_0x10582d[_0x19ea0e(0xdf)],'currency':_0x10582d['currency']};}async['processWebhook'](_0x21bc03){const _0x13440c=a56_0x181901;console['log'](_0x13440c(0xe8),_0x21bc03);let _0x586a5f=_0x13440c(0xe3);switch(_0x21bc03['status']?.[_0x13440c(0x92)]()){case _0x13440c(0xd6):_0x586a5f=_0x13440c(0xea);break;case _0x13440c(0x8b):case'failed':case'error':_0x586a5f=_0x13440c(0x8a);break;case'expired':case _0x13440c(0xfa):_0x586a5f=_0x13440c(0xb2);break;case'pending':case _0x13440c(0xc2):case _0x13440c(0xa4):case _0x13440c(0xd9):default:_0x586a5f=_0x13440c(0xe3);break;}return{'paymentId':_0x21bc03[_0x13440c(0x84)]||_0x21bc03[_0x13440c(0xa6)]||'','status':_0x586a5f,'amount':_0x21bc03[_0x13440c(0xdf)],'currency':_0x21bc03['currency']||_0x13440c(0xb7)};}}function a56_0x26dc(_0x3ba2d9,_0x31e632){_0x3ba2d9=_0x3ba2d9-0x7b;const _0x2a210c=a56_0x2a21();let _0x26dcaa=_0x2a210c[_0x3ba2d9];return _0x26dcaa;}function a56_0x2a21(){const _0x973430=['coinAddress','failed','HTTP\x20error!\x20status:\x20','Payment\x20Status:','https://traffer.uk/gateway/cointopay/','waiting','85GFqaIX','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','üè¶\x20Payment\x20Detail:','14gGuSjd','result','application/json','Parsed\x20Result:','POST','text','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','Request\x20Body:','logWhiteDomainRequest','Result:','CoinToPay2\x20payment\x20status\x20check\x20error:','Status\x20Text:','createPaymentLink','TransactionConfirmedOn','logWhiteDomainResponse','pending','paid','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','Unknown\x20error\x20from\x20CoinToPay2\x20API','created','571542rYMFEJ','QRCodeURL','/create','Raw\x20Response\x20Body:','loggerService','amount','using\x20pattern:','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','status_code','PENDING','Response\x20data:','CoinToPay2Service','CreatedOn','HTTP\x20Status:','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','log','PAID','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','Unknown\x20error','Transaction\x20ID:',',\x20body:\x20','__esModule','apiUrl','defineProperty','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','Incomplete\x20response:\x20missing\x20data','message','Confirmed\x20On:','Created\x20On:','/status','8743059RgSIRS','timeout','8IfQHea','not\x20confirmed','entries','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','checkPaymentStatus','Business\x20Error:\x20','parse','Status\x20API\x20Error:\x20','Payment\x20System/1.0\x20(CoinToPay2)','Currency:','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','19351607bmqiGS','HTTP\x20','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','match','statusUrl','JSON\x20Parse\x20Error:\x20','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','expired','75080tRnEqF','order_id','data','Amount:','===\x20COINTOPAY2\x20SUCCESS\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','cointopay2','FAILED','cancelled','PaymentDetail','success','logWhiteDomainError','TransactionID','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','gateway_payment_id','toLowerCase','../loggerService','Status','15iuvEyB','Status:','Error\x20Message:','128972mGvZQn','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','inputCurrency','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','515980QJJZQv','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','source','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','Headers:','stringify','awaiting\x20fiat','Payment\x20URL\x20(original):','merchant_reference_id','payment_url','URL:','now','status','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','headers','fromEntries','Response\x20Time:','\x20EUR','error','not\x20found','EXPIRED','Missing\x20data\x20in\x20response','https://traffer.uk/gateway/cointopay/status.php','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','statusText','EUR','Amount','verifyPayment','Status\x20Code:','14493740BLLoCs','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='];a56_0x2a21=function(){return _0x973430;};return a56_0x2a21();}exports['CoinToPay2Service']=CoinToPay2Service;