'use strict';const a40_0x1498ab=a40_0xb2f6;(function(_0x646361,_0x252f7c){const _0x599cd4=a40_0xb2f6,_0x1c17ee=_0x646361();while(!![]){try{const _0x39f1a7=-parseInt(_0x599cd4(0xa1))/0x1*(parseInt(_0x599cd4(0xea))/0x2)+parseInt(_0x599cd4(0xcf))/0x3*(parseInt(_0x599cd4(0x105))/0x4)+parseInt(_0x599cd4(0xe9))/0x5*(-parseInt(_0x599cd4(0xaf))/0x6)+parseInt(_0x599cd4(0xd8))/0x7+parseInt(_0x599cd4(0xfd))/0x8*(parseInt(_0x599cd4(0x101))/0x9)+-parseInt(_0x599cd4(0x123))/0xa*(-parseInt(_0x599cd4(0xf8))/0xb)+-parseInt(_0x599cd4(0x10a))/0xc;if(_0x39f1a7===_0x252f7c)break;else _0x1c17ee['push'](_0x1c17ee['shift']());}catch(_0x1cb835){_0x1c17ee['push'](_0x1c17ee['shift']());}}}(a40_0x5815,0xbae5c));function a40_0x5815(){const _0x27645a=['3616046RtZcro','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','Confirmed\x20On:','Unknown\x20error','logWhiteDomainRequest','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','cointopay2','apiUrl','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','error','Amount','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','message','Payment\x20Status:','Currency:','25UzXaOq','11488sDoCjc','Incomplete\x20response:\x20missing\x20data',',\x20body:\x20','text','timeout','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Created\x20On:','TransactionConfirmedOn','Headers:','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','Business\x20Error:\x20','CoinToPay2\x20status\x20API\x20error:\x20','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','parse','143GsciZi','Request\x20Body:','amount','EXPIRED','https://traffer.uk/gateway/cointopay/status.php','124472rBvjRr','processWebhook','Status\x20API\x20Error:\x20','HTTP\x20','558cqlHDC','match','Raw\x20Response\x20Body:','QRCodeURL','2313928YcwPHY','FAILED','created','status_code','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','21764592evqFBr','HTTP\x20error!\x20status:\x20','logWhiteDomainResponse','\x20EUR','stringify','CreatedOn','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','stack','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','Payment\x20URL:','CoinToPay2\x20API\x20error:\x20','now','Error\x20Message:','merchant_reference_id','expired','statusUrl','JSON\x20Parse\x20Error:\x20','application/json','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','===\x20COINTOPAY2\x20API\x20ERROR\x20===','log','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','status','paid','headers','589790lDmnxq','PENDING','üìä\x20Status\x20check\x20URL:','awaiting\x20fiat','PAID','TransactionID','EUR','91JiydEd','Gateway\x20Payment\x20ID:','not\x20confirmed','../loggerService','checkPaymentStatus','Status','not\x20found','üè¶\x20Extracted\x20IBAN:','pending','Status:','data','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','cancelled','order_id','363570uZarEz','fromEntries','waiting','result','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','Failed\x20to\x20parse\x20JSON\x20response:','Result:','===\x20COINTOPAY2\x20SUCCESS\x20===','HTTP\x20Status:','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error\x20from\x20CoinToPay2\x20API','statusText','CoinToPay2\x20payment\x20status\x20check\x20error:','logWhiteDomainError','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','coinAddress','payment_url','Missing\x20data\x20in\x20response','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','toLowerCase','Amount:','ExpiryTime','/create','/status','gateway_payment_id','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','__esModule','inputCurrency','CoinToPay2Service','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','IBAN:','POST','6QDClVS','failed','Error\x20details:','currency','PaymentDetail','defineProperty','Parsed\x20Result:','loggerService','Response\x20Time:'];a40_0x5815=function(){return _0x27645a;};return a40_0x5815();}Object[a40_0x1498ab(0xd4)](exports,a40_0x1498ab(0xc9),{'value':!![]}),exports[a40_0x1498ab(0xcb)]=void 0x0;const loggerService_1=require(a40_0x1498ab(0xa4));function a40_0xb2f6(_0xc445f6,_0x234922){const _0x5815f8=a40_0x5815();return a40_0xb2f6=function(_0xb2f687,_0x3f1556){_0xb2f687=_0xb2f687-0xa1;let _0x3d1953=_0x5815f8[_0xb2f687];return _0x3d1953;},a40_0xb2f6(_0xc445f6,_0x234922);}class CoinToPay2Service{constructor(){const _0xaa8aad=a40_0x1498ab;this[_0xaa8aad(0xe0)]='https://traffer.uk/gateway/cointopay/',this[_0xaa8aad(0x119)]=_0xaa8aad(0xfc),console[_0xaa8aad(0x11e)](_0xaa8aad(0xcc)),console[_0xaa8aad(0x11e)](_0xaa8aad(0x125),this['statusUrl']);}async['createPaymentLink'](_0x4f199f){const _0x171b2d=a40_0x1498ab,{orderId:_0x2296cb,amount:_0x3f3c43}=_0x4f199f;console[_0x171b2d(0x11e)]('ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20'+_0x3f3c43+_0x171b2d(0x10d));const _0x1f4a84={'amount':_0x3f3c43},_0x242b77=Date[_0x171b2d(0x115)]();try{console[_0x171b2d(0x11e)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console['log']('URL:',this[_0x171b2d(0xe0)]),console[_0x171b2d(0x11e)](_0x171b2d(0xf9),JSON[_0x171b2d(0x10e)](_0x1f4a84,null,0x2)),console[_0x171b2d(0x11e)]('Amount:',_0x3f3c43,_0x171b2d(0xe5)),loggerService_1[_0x171b2d(0xd6)][_0x171b2d(0xdd)](_0x171b2d(0xdf),_0x171b2d(0xc5),'POST',_0x1f4a84);const _0x56784a=await fetch(this[_0x171b2d(0xe0)],{'method':_0x171b2d(0xce),'headers':{'Content-Type':'application/json','Accept':_0x171b2d(0x11b),'User-Agent':_0x171b2d(0xbd)},'body':JSON['stringify'](_0x1f4a84)}),_0x29e007=Date[_0x171b2d(0x115)]()-_0x242b77;console[_0x171b2d(0x11e)]('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console[_0x171b2d(0x11e)](_0x171b2d(0xaa),_0x56784a[_0x171b2d(0x120)]),console[_0x171b2d(0x11e)]('Status\x20Text:',_0x56784a[_0x171b2d(0xba)]),console[_0x171b2d(0x11e)](_0x171b2d(0xf2),Object[_0x171b2d(0xb0)](_0x56784a[_0x171b2d(0x122)]['entries']())),console['log'](_0x171b2d(0xd7),_0x29e007+'ms');const _0x10ece3=await _0x56784a[_0x171b2d(0xed)]();console[_0x171b2d(0x11e)](_0x171b2d(0x103),_0x10ece3);if(!_0x56784a['ok']){console['error'](_0x171b2d(0x11d)),console[_0x171b2d(0xe3)](_0x171b2d(0xb7),_0x56784a[_0x171b2d(0x120)]),console[_0x171b2d(0xe3)]('Response\x20Body:',_0x10ece3),loggerService_1[_0x171b2d(0xd6)]['logWhiteDomainResponse'](_0x171b2d(0xdf),'/create',_0x56784a['status'],_0x10ece3,_0x29e007),loggerService_1[_0x171b2d(0xd6)][_0x171b2d(0xbc)](_0x171b2d(0xdf),_0x171b2d(0xc5),'HTTP\x20'+_0x56784a['status']+':\x20'+_0x10ece3);throw new Error(_0x171b2d(0x10b)+_0x56784a[_0x171b2d(0x120)]+_0x171b2d(0xec)+_0x10ece3);}let _0x3d37ac;try{_0x3d37ac=JSON[_0x171b2d(0xf7)](_0x10ece3);}catch(_0x217651){console[_0x171b2d(0xe3)](_0x171b2d(0xb4),_0x217651),loggerService_1[_0x171b2d(0xd6)][_0x171b2d(0xbc)](_0x171b2d(0xdf),_0x171b2d(0xc5),_0x171b2d(0x11a)+_0x217651);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20'+_0x10ece3);}console[_0x171b2d(0x11e)](_0x171b2d(0xc1)),console[_0x171b2d(0x11e)](_0x171b2d(0xd5),JSON[_0x171b2d(0x10e)](_0x3d37ac,null,0x2)),loggerService_1[_0x171b2d(0xd6)][_0x171b2d(0x10c)](_0x171b2d(0xdf),_0x171b2d(0xc5),_0x56784a['status'],_0x3d37ac,_0x29e007);if(_0x3d37ac[_0x171b2d(0xe3)]){const _0x3fdaeb=_0x3d37ac[_0x171b2d(0xe6)]||_0x3d37ac[_0x171b2d(0xe3)]||_0x171b2d(0xb9);console[_0x171b2d(0xe3)](_0x171b2d(0x112)),console[_0x171b2d(0xe3)](_0x171b2d(0x116),_0x3fdaeb),loggerService_1[_0x171b2d(0xd6)]['logWhiteDomainError'](_0x171b2d(0xdf),_0x171b2d(0xc5),_0x171b2d(0xf4)+_0x3fdaeb);throw new Error(_0x171b2d(0x114)+_0x3fdaeb);}if(!_0x3d37ac[_0x171b2d(0xbf)]||!_0x3d37ac[_0x171b2d(0xc7)]){console[_0x171b2d(0xe3)](_0x171b2d(0xb8)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x171b2d(0xe3)]('Response\x20data:',_0x3d37ac),loggerService_1[_0x171b2d(0xd6)][_0x171b2d(0xbc)](_0x171b2d(0xdf),'/create',_0x171b2d(0x11f));throw new Error(_0x171b2d(0xf6));}return console[_0x171b2d(0x11e)](_0x171b2d(0xb6)),console['log'](_0x171b2d(0xa2),_0x3d37ac['gateway_payment_id']),console[_0x171b2d(0x11e)](_0x171b2d(0x113),_0x3d37ac[_0x171b2d(0xbf)]),console[_0x171b2d(0x11e)]('Amount:',_0x3f3c43,_0x171b2d(0x129)),{'gateway_payment_id':_0x3d37ac['gateway_payment_id'],'payment_url':_0x3d37ac['payment_url']};}catch(_0x24f2ef){console['error']('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x171b2d(0xe3)](_0x171b2d(0xd1),_0x24f2ef),loggerService_1[_0x171b2d(0xd6)][_0x171b2d(0xbc)]('cointopay2',_0x171b2d(0xc5),_0x24f2ef);if(_0x24f2ef instanceof Error){console['error']('Error\x20message:',_0x24f2ef[_0x171b2d(0xe6)]),console[_0x171b2d(0xe3)]('Error\x20stack:',_0x24f2ef[_0x171b2d(0x111)]);throw new Error(_0x171b2d(0x110)+_0x24f2ef[_0x171b2d(0xe6)]);}throw new Error(_0x171b2d(0xb3));}}async[a40_0x1498ab(0xa5)](_0xa0e658){const _0x52684d=a40_0x1498ab,_0x45757e=Date[_0x52684d(0x115)]();try{console[_0x52684d(0x11e)](_0x52684d(0x11c)+_0xa0e658);const _0x436c0c={'gatewayPaymentId':_0xa0e658};loggerService_1['loggerService'][_0x52684d(0xdd)](_0x52684d(0xdf),_0x52684d(0xc6),_0x52684d(0xce),_0x436c0c);const _0x2bfe62=await fetch(this[_0x52684d(0x119)],{'method':'POST','headers':{'Content-Type':_0x52684d(0x11b),'Accept':_0x52684d(0x11b),'User-Agent':_0x52684d(0xbd)},'body':JSON[_0x52684d(0x10e)](_0x436c0c)}),_0x239a79=Date[_0x52684d(0x115)]()-_0x45757e;console[_0x52684d(0x11e)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x52684d(0x11e)](_0x52684d(0xaa),_0x2bfe62[_0x52684d(0x120)]),console[_0x52684d(0x11e)](_0x52684d(0xd7),_0x239a79+'ms');if(!_0x2bfe62['ok']){const _0x3b2bc5=await _0x2bfe62[_0x52684d(0xed)]();console[_0x52684d(0xe3)](_0x52684d(0xb7),_0x2bfe62[_0x52684d(0x120)]),console[_0x52684d(0xe3)]('Response\x20Body:',_0x3b2bc5),loggerService_1[_0x52684d(0xd6)][_0x52684d(0x10c)](_0x52684d(0xdf),_0x52684d(0xc6),_0x2bfe62[_0x52684d(0x120)],_0x3b2bc5,_0x239a79),loggerService_1[_0x52684d(0xd6)][_0x52684d(0xbc)](_0x52684d(0xdf),_0x52684d(0xc6),_0x52684d(0x100)+_0x2bfe62[_0x52684d(0x120)]+':\x20'+_0x3b2bc5);throw new Error(_0x52684d(0x10b)+_0x2bfe62[_0x52684d(0x120)]);}const _0x196fd2=await _0x2bfe62['text']();console[_0x52684d(0x11e)](_0x52684d(0x103),_0x196fd2);let _0x6dbb8b;try{_0x6dbb8b=JSON['parse'](_0x196fd2);}catch(_0x543eb5){console[_0x52684d(0xe3)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x543eb5),loggerService_1['loggerService'][_0x52684d(0xbc)](_0x52684d(0xdf),_0x52684d(0xc6),_0x52684d(0x11a)+_0x543eb5);throw new Error(_0x52684d(0xd9)+_0x196fd2);}loggerService_1['loggerService'][_0x52684d(0x10c)]('cointopay2','/status',_0x2bfe62[_0x52684d(0x120)],_0x6dbb8b,_0x239a79),console[_0x52684d(0x11e)](_0x52684d(0xf3)),console[_0x52684d(0x11e)](_0x52684d(0xb5),_0x6dbb8b[_0x52684d(0xb2)]),console[_0x52684d(0x11e)]('Status\x20Code:',_0x6dbb8b[_0x52684d(0x108)]),console[_0x52684d(0x11e)](_0x52684d(0xe7),_0x6dbb8b['data']?.[_0x52684d(0xa6)]),console[_0x52684d(0x11e)](_0x52684d(0xc3),_0x6dbb8b[_0x52684d(0xab)]?.[_0x52684d(0xe4)]),console['log'](_0x52684d(0xe8),_0x6dbb8b[_0x52684d(0xab)]?.[_0x52684d(0xca)]);if(_0x6dbb8b[_0x52684d(0xb2)]!=='success'||_0x6dbb8b['status_code']!==0xc8){const _0x4bebb6=_0x6dbb8b[_0x52684d(0xe6)]||_0x52684d(0xde);console[_0x52684d(0xe3)](_0x52684d(0x109)),console['error'](_0x52684d(0x116),_0x4bebb6),loggerService_1['loggerService']['logWhiteDomainError'](_0x52684d(0xdf),'/status',_0x52684d(0xff)+_0x4bebb6);throw new Error(_0x52684d(0xf5)+_0x4bebb6);}if(!_0x6dbb8b[_0x52684d(0xab)]){console[_0x52684d(0xe3)](_0x52684d(0xe2)),console['error'](_0x52684d(0xc0)),loggerService_1[_0x52684d(0xd6)][_0x52684d(0xbc)]('cointopay2',_0x52684d(0xc6),_0x52684d(0xeb));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x182187=_0x52684d(0x124);switch(_0x6dbb8b['data'][_0x52684d(0xa6)]?.[_0x52684d(0xc2)]()){case'paid':_0x182187=_0x52684d(0x127);break;case _0x52684d(0xad):case _0x52684d(0xd0):case'error':_0x182187=_0x52684d(0x106);break;case _0x52684d(0x118):case _0x52684d(0xee):_0x182187=_0x52684d(0xfb);break;case _0x52684d(0xb1):case _0x52684d(0x126):case _0x52684d(0xa9):case _0x52684d(0x107):default:_0x182187=_0x52684d(0x124);break;}let _0x42b9f5,_0x291ce7;if(_0x6dbb8b[_0x52684d(0xab)][_0x52684d(0xd3)]){const _0x2c7c3f=_0x6dbb8b['data'][_0x52684d(0xd3)];console['log']('üè¶\x20Payment\x20Detail:',_0x2c7c3f);const _0x54b2f5=_0x2c7c3f[_0x52684d(0x102)](/IBAN\s+([A-Z0-9]+)/i);_0x54b2f5&&(_0x42b9f5=_0x54b2f5[0x1],console[_0x52684d(0x11e)](_0x52684d(0xa8),_0x42b9f5)),_0x291ce7=_0x2c7c3f;}const _0x3281da={'iban':_0x42b9f5,'bankDetails':_0x291ce7,'transactionId':_0x6dbb8b[_0x52684d(0xab)]['TransactionID'],'coinAddress':_0x6dbb8b[_0x52684d(0xab)][_0x52684d(0xbe)],'qrCodeUrl':_0x6dbb8b[_0x52684d(0xab)][_0x52684d(0x104)],'expiryTime':_0x6dbb8b[_0x52684d(0xab)][_0x52684d(0xc4)],'createdOn':_0x6dbb8b['data'][_0x52684d(0x10f)],'confirmedOn':_0x6dbb8b[_0x52684d(0xab)][_0x52684d(0xf1)]};console[_0x52684d(0x11e)](_0x52684d(0xe1)),console[_0x52684d(0x11e)](_0x52684d(0xaa),_0x6dbb8b[_0x52684d(0xab)][_0x52684d(0xa6)],'->',_0x182187),console[_0x52684d(0x11e)](_0x52684d(0xc3),_0x6dbb8b[_0x52684d(0xab)][_0x52684d(0xe4)],_0x6dbb8b[_0x52684d(0xab)][_0x52684d(0xca)]),console[_0x52684d(0x11e)]('Transaction\x20ID:',_0x6dbb8b[_0x52684d(0xab)][_0x52684d(0x128)]),console[_0x52684d(0x11e)](_0x52684d(0xcd),_0x42b9f5||_0x52684d(0xa7)),console[_0x52684d(0x11e)](_0x52684d(0xf0),_0x6dbb8b[_0x52684d(0xab)][_0x52684d(0x10f)]),console['log'](_0x52684d(0xdb),_0x6dbb8b[_0x52684d(0xab)][_0x52684d(0xf1)]||_0x52684d(0xa3));if(_0x6dbb8b['data'][_0x52684d(0xa6)]?.[_0x52684d(0xc2)]()===_0x52684d(0x126))console['log'](_0x52684d(0xef));else _0x6dbb8b[_0x52684d(0xab)][_0x52684d(0xa6)]?.[_0x52684d(0xc2)]()===_0x52684d(0x121)&&console[_0x52684d(0x11e)](_0x52684d(0xc8));return{'status':_0x182187,'amount':parseFloat(_0x6dbb8b[_0x52684d(0xab)][_0x52684d(0xe4)])||undefined,'currency':_0x6dbb8b[_0x52684d(0xab)][_0x52684d(0xca)]||'EUR','paymentDetails':_0x3281da};}catch(_0x595a1a){console[_0x52684d(0xe3)](_0x52684d(0xbb),_0x595a1a),loggerService_1[_0x52684d(0xd6)]['logWhiteDomainError'](_0x52684d(0xdf),'/status',_0x595a1a);throw new Error(_0x52684d(0xda)+(_0x595a1a instanceof Error?_0x595a1a['message']:_0x52684d(0xdc)));}}async['verifyPayment'](_0x416200){const _0x5340d0=a40_0x1498ab,_0x453923=await this[_0x5340d0(0xa5)](_0x416200);return{'status':_0x453923[_0x5340d0(0x120)],'amount':_0x453923[_0x5340d0(0xfa)],'currency':_0x453923[_0x5340d0(0xd2)]};}async[a40_0x1498ab(0xfe)](_0x4ab0f6){const _0x3eba15=a40_0x1498ab;console[_0x3eba15(0x11e)](_0x3eba15(0xac),_0x4ab0f6);let _0x58a6c2=_0x3eba15(0x124);switch(_0x4ab0f6['status']?.[_0x3eba15(0xc2)]()){case _0x3eba15(0x121):_0x58a6c2='PAID';break;case _0x3eba15(0xad):case _0x3eba15(0xd0):case _0x3eba15(0xe3):_0x58a6c2=_0x3eba15(0x106);break;case'expired':case'timeout':_0x58a6c2=_0x3eba15(0xfb);break;case _0x3eba15(0xa9):case _0x3eba15(0xb1):case _0x3eba15(0x126):case _0x3eba15(0x107):default:_0x58a6c2=_0x3eba15(0x124);break;}return{'paymentId':_0x4ab0f6[_0x3eba15(0xae)]||_0x4ab0f6[_0x3eba15(0x117)]||'','status':_0x58a6c2,'amount':_0x4ab0f6[_0x3eba15(0xfa)],'currency':_0x4ab0f6[_0x3eba15(0xd2)]||_0x3eba15(0x129)};}}exports[a40_0x1498ab(0xcb)]=CoinToPay2Service;