'use strict';const a48_0x366d94=a48_0x2084;(function(_0x4faba2,_0x181a44){const _0x3c2271=a48_0x2084,_0x49c6c2=_0x4faba2();while(!![]){try{const _0x16cc26=parseInt(_0x3c2271(0xe1))/0x1+-parseInt(_0x3c2271(0xfb))/0x2+parseInt(_0x3c2271(0xf0))/0x3*(parseInt(_0x3c2271(0xff))/0x4)+-parseInt(_0x3c2271(0xe2))/0x5+parseInt(_0x3c2271(0x14f))/0x6+parseInt(_0x3c2271(0xdc))/0x7+-parseInt(_0x3c2271(0x10b))/0x8;if(_0x16cc26===_0x181a44)break;else _0x49c6c2['push'](_0x49c6c2['shift']());}catch(_0x1a8335){_0x49c6c2['push'](_0x49c6c2['shift']());}}}(a48_0x3ed8,0x82dcf));function a48_0x3ed8(){const _0x45fb96=['https://traffer.uk/gateway/cointopay/','/create','1216588HBIuCq','Status:','QRCodeURL','PENDING','payment_url','waiting','Response\x20Body:','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','CreatedOn','Response\x20Time:','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','TransactionConfirmedOn','6326784vppTPH','cancelled','HTTP\x20','pending','log','stringify','EUR','gateway_payment_id','Payment\x20URL\x20(original):','Payment\x20URL\x20(modified):','data','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','Status\x20Text:','application/json','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','/status','Status\x20API\x20Error:\x20','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','text','Amount:','CoinToPay2\x20payment\x20status\x20check\x20error:','created','logWhiteDomainRequest','PAID','Request\x20Body:','TransactionID','apiUrl','Failed\x20to\x20parse\x20JSON\x20response:','Unknown\x20error\x20from\x20CoinToPay2\x20API','amount','awaiting\x20fiat','URL:','Error\x20message:','logWhiteDomainResponse','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','Created\x20On:','POST','verifyPayment','inputCurrency','logWhiteDomainError','failed','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','CoinToPay2Service','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Raw\x20Response\x20Body:','Confirmed\x20On:','Missing\x20data\x20in\x20response','entries','HTTP\x20Status:','üè¶\x20Extracted\x20IBAN:','Parsed\x20Result:','statusText','stack','Error\x20Message:','&alternative=false','message',',\x20body:\x20','Payment\x20Status:','JSON\x20Parse\x20Error:\x20','Result:','now','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','Transaction\x20ID:','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','source','Error\x20details:','using\x20pattern:','currency','4076394UcsqBt','Status\x20Code:','EXPIRED','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','Currency:','FAILED','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','cointopay2','Status','paid','checkPaymentStatus','createPaymentLink','error','Business\x20Error:\x20','===\x20COINTOPAY2\x20SUCCESS\x20===','===\x20COINTOPAY2\x20API\x20ERROR\x20===','3847767FNaJTQ','success','timeout','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','378267SaJAFP','293405qCZTGs','status_code','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','HTTP\x20error!\x20status:\x20','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','result','üè¶\x20Payment\x20Detail:','CoinToPay2\x20status\x20API\x20error:\x20','Gateway\x20Payment\x20ID:','merchant_reference_id','loggerService','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','parse','6YDIxfZ','Payment\x20System/1.0\x20(CoinToPay2)','toLowerCase','PaymentDetail','Unknown\x20error','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','fromEntries','coinAddress','status','expired','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','1660194vosIcD','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'];a48_0x3ed8=function(){return _0x45fb96;};return a48_0x3ed8();}function a48_0x2084(_0x444669,_0x8e2cde){const _0x3ed87f=a48_0x3ed8();return a48_0x2084=function(_0x20847f,_0x1f812c){_0x20847f=_0x20847f-0xd3;let _0x3dcb77=_0x3ed87f[_0x20847f];return _0x3dcb77;},a48_0x2084(_0x444669,_0x8e2cde);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a48_0x366d94(0x135)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPay2Service{constructor(){const _0x5b4a50=a48_0x366d94;this['apiUrl']=_0x5b4a50(0xfd),this['statusUrl']='https://traffer.uk/gateway/cointopay/status.php',console[_0x5b4a50(0x10f)]('ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0x5b4a50(0x10f)]('üìä\x20Status\x20check\x20URL:',this['statusUrl']);}async[a48_0x366d94(0xd7)](_0x58adc5){const _0x35451a=a48_0x366d94,{orderId:_0xcc4865,amount:_0x4454c7}=_0x58adc5;console['log'](_0x35451a(0x155)+_0x4454c7+'\x20EUR');const _0x2418a0={'amount':_0x4454c7},_0x1c1b24=Date[_0x35451a(0x147)]();try{console[_0x35451a(0x10f)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console[_0x35451a(0x10f)](_0x35451a(0x12a),this[_0x35451a(0x125)]),console[_0x35451a(0x10f)](_0x35451a(0x123),JSON['stringify'](_0x2418a0,null,0x2)),console[_0x35451a(0x10f)](_0x35451a(0x11e),_0x4454c7,_0x35451a(0xf5)),loggerService_1[_0x35451a(0xed)][_0x35451a(0x121)](_0x35451a(0xd3),_0x35451a(0xfe),'POST',_0x2418a0);const _0x36ea47=await fetch(this[_0x35451a(0x125)],{'method':_0x35451a(0x12f),'headers':{'Content-Type':_0x35451a(0x118),'Accept':_0x35451a(0x118),'User-Agent':'Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON['stringify'](_0x2418a0)}),_0x4f36f1=Date[_0x35451a(0x147)]()-_0x1c1b24;console['log']('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console[_0x35451a(0x10f)](_0x35451a(0x100),_0x36ea47[_0x35451a(0xf8)]),console[_0x35451a(0x10f)](_0x35451a(0x117),_0x36ea47[_0x35451a(0x13e)]),console[_0x35451a(0x10f)]('Headers:',Object[_0x35451a(0xf6)](_0x36ea47['headers'][_0x35451a(0x13a)]())),console[_0x35451a(0x10f)](_0x35451a(0x108),_0x4f36f1+'ms');const _0x2d25a6=await _0x36ea47[_0x35451a(0x11d)]();console[_0x35451a(0x10f)](_0x35451a(0x137),_0x2d25a6);if(!_0x36ea47['ok']){console[_0x35451a(0xd8)](_0x35451a(0xdb)),console[_0x35451a(0xd8)](_0x35451a(0x13b),_0x36ea47[_0x35451a(0xf8)]),console['error'](_0x35451a(0x105),_0x2d25a6),loggerService_1['loggerService'][_0x35451a(0x12c)]('cointopay2',_0x35451a(0xfe),_0x36ea47[_0x35451a(0xf8)],_0x2d25a6,_0x4f36f1),loggerService_1[_0x35451a(0xed)][_0x35451a(0x132)]('cointopay2',_0x35451a(0xfe),_0x35451a(0x10d)+_0x36ea47[_0x35451a(0xf8)]+':\x20'+_0x2d25a6);throw new Error('HTTP\x20error!\x20status:\x20'+_0x36ea47[_0x35451a(0xf8)]+_0x35451a(0x143)+_0x2d25a6);}let _0x260333;try{_0x260333=JSON[_0x35451a(0xef)](_0x2d25a6);}catch(_0x1f8103){console[_0x35451a(0xd8)](_0x35451a(0x126),_0x1f8103),loggerService_1[_0x35451a(0xed)][_0x35451a(0x132)](_0x35451a(0xd3),_0x35451a(0xfe),_0x35451a(0x145)+_0x1f8103);throw new Error(_0x35451a(0x12d)+_0x2d25a6);}console[_0x35451a(0x10f)]('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console[_0x35451a(0x10f)](_0x35451a(0x13d),JSON[_0x35451a(0x110)](_0x260333,null,0x2)),loggerService_1[_0x35451a(0xed)][_0x35451a(0x12c)]('cointopay2',_0x35451a(0xfe),_0x36ea47[_0x35451a(0xf8)],_0x260333,_0x4f36f1);if(_0x260333[_0x35451a(0xd8)]){const _0x2f884b=_0x260333[_0x35451a(0x142)]||_0x260333['error']||_0x35451a(0x127);console[_0x35451a(0xd8)](_0x35451a(0x11c)),console['error'](_0x35451a(0x140),_0x2f884b),loggerService_1[_0x35451a(0xed)][_0x35451a(0x132)]('cointopay2','/create',_0x35451a(0xd9)+_0x2f884b);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0x2f884b);}if(!_0x260333[_0x35451a(0x103)]||!_0x260333[_0x35451a(0x112)]){console[_0x35451a(0xd8)]('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x35451a(0xd8)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error']('Response\x20data:',_0x260333),loggerService_1[_0x35451a(0xed)][_0x35451a(0x132)](_0x35451a(0xd3),_0x35451a(0xfe),_0x35451a(0x134));throw new Error(_0x35451a(0xfa));}console[_0x35451a(0x10f)](_0x35451a(0xda)),console[_0x35451a(0x10f)](_0x35451a(0xeb),_0x260333[_0x35451a(0x112)]),console[_0x35451a(0x10f)](_0x35451a(0x113),_0x260333['payment_url']);const _0x371ffc=_0x260333[_0x35451a(0x103)]+_0x35451a(0x141);return console[_0x35451a(0x10f)](_0x35451a(0x114),_0x371ffc),console['log']('Amount:',_0x4454c7,_0x35451a(0x111)),{'gateway_payment_id':_0x260333[_0x35451a(0x112)],'payment_url':_0x371ffc};}catch(_0x159e63){console['error'](_0x35451a(0x14a)),console[_0x35451a(0xd8)](_0x35451a(0x14c),_0x159e63),loggerService_1[_0x35451a(0xed)][_0x35451a(0x132)](_0x35451a(0xd3),'/create',_0x159e63);if(_0x159e63 instanceof Error){console[_0x35451a(0xd8)](_0x35451a(0x12b),_0x159e63[_0x35451a(0x142)]),console['error']('Error\x20stack:',_0x159e63[_0x35451a(0x13f)]);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x159e63[_0x35451a(0x142)]);}throw new Error(_0x35451a(0xe4));}}async[a48_0x366d94(0xd6)](_0xd21f03){const _0x3af1e6=a48_0x366d94,_0x948ab7=Date[_0x3af1e6(0x147)]();try{console[_0x3af1e6(0x10f)](_0x3af1e6(0xe7)+_0xd21f03);const _0x388487={'gatewayPaymentId':_0xd21f03};loggerService_1[_0x3af1e6(0xed)][_0x3af1e6(0x121)]('cointopay2','/status',_0x3af1e6(0x12f),_0x388487);const _0x575c25=await fetch(this['statusUrl'],{'method':_0x3af1e6(0x12f),'headers':{'Content-Type':_0x3af1e6(0x118),'Accept':_0x3af1e6(0x118),'User-Agent':_0x3af1e6(0xf1)},'body':JSON[_0x3af1e6(0x110)](_0x388487)}),_0x4700dd=Date[_0x3af1e6(0x147)]()-_0x948ab7;console[_0x3af1e6(0x10f)](_0x3af1e6(0xe0)),console['log'](_0x3af1e6(0x100),_0x575c25['status']),console['log'](_0x3af1e6(0x108),_0x4700dd+'ms');if(!_0x575c25['ok']){const _0x3a32a4=await _0x575c25[_0x3af1e6(0x11d)]();console[_0x3af1e6(0xd8)](_0x3af1e6(0x13b),_0x575c25[_0x3af1e6(0xf8)]),console[_0x3af1e6(0xd8)](_0x3af1e6(0x105),_0x3a32a4),loggerService_1[_0x3af1e6(0xed)][_0x3af1e6(0x12c)](_0x3af1e6(0xd3),_0x3af1e6(0x11a),_0x575c25[_0x3af1e6(0xf8)],_0x3a32a4,_0x4700dd),loggerService_1['loggerService'][_0x3af1e6(0x132)](_0x3af1e6(0xd3),'/status',_0x3af1e6(0x10d)+_0x575c25[_0x3af1e6(0xf8)]+':\x20'+_0x3a32a4);throw new Error(_0x3af1e6(0xe5)+_0x575c25[_0x3af1e6(0xf8)]);}const _0x1ce895=await _0x575c25[_0x3af1e6(0x11d)]();console[_0x3af1e6(0x10f)](_0x3af1e6(0x137),_0x1ce895);let _0x294bce;try{_0x294bce=JSON[_0x3af1e6(0xef)](_0x1ce895);}catch(_0x5205e9){console[_0x3af1e6(0xd8)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5205e9),loggerService_1[_0x3af1e6(0xed)][_0x3af1e6(0x132)]('cointopay2',_0x3af1e6(0x11a),_0x3af1e6(0x145)+_0x5205e9);throw new Error(_0x3af1e6(0xfc)+_0x1ce895);}loggerService_1['loggerService'][_0x3af1e6(0x12c)](_0x3af1e6(0xd3),'/status',_0x575c25['status'],_0x294bce,_0x4700dd),console[_0x3af1e6(0x10f)](_0x3af1e6(0xdf)),console['log'](_0x3af1e6(0x146),_0x294bce[_0x3af1e6(0xe8)]),console['log'](_0x3af1e6(0x150),_0x294bce['status_code']),console[_0x3af1e6(0x10f)](_0x3af1e6(0x144),_0x294bce[_0x3af1e6(0x115)]?.[_0x3af1e6(0xd4)]),console[_0x3af1e6(0x10f)]('Amount:',_0x294bce[_0x3af1e6(0x115)]?.['Amount']),console[_0x3af1e6(0x10f)](_0x3af1e6(0x153),_0x294bce[_0x3af1e6(0x115)]?.['inputCurrency']);if(_0x294bce[_0x3af1e6(0xe8)]!==_0x3af1e6(0xdd)||_0x294bce[_0x3af1e6(0xe3)]!==0xc8){const _0x10a0c0=_0x294bce[_0x3af1e6(0x142)]||_0x3af1e6(0x119);console[_0x3af1e6(0xd8)](_0x3af1e6(0xee)),console[_0x3af1e6(0xd8)]('Error\x20Message:',_0x10a0c0),loggerService_1['loggerService'][_0x3af1e6(0x132)](_0x3af1e6(0xd3),_0x3af1e6(0x11a),_0x3af1e6(0x11b)+_0x10a0c0);throw new Error(_0x3af1e6(0xea)+_0x10a0c0);}if(!_0x294bce['data']){console[_0x3af1e6(0xd8)](_0x3af1e6(0x106)),console[_0x3af1e6(0xd8)](_0x3af1e6(0x139)),loggerService_1[_0x3af1e6(0xed)][_0x3af1e6(0x132)](_0x3af1e6(0xd3),'/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0x3af1e6(0x148));}let _0x4912bd='PENDING';switch(_0x294bce[_0x3af1e6(0x115)][_0x3af1e6(0xd4)]?.[_0x3af1e6(0xf2)]()){case _0x3af1e6(0xd5):_0x4912bd=_0x3af1e6(0x122);break;case _0x3af1e6(0x10c):case'failed':case _0x3af1e6(0xd8):_0x4912bd=_0x3af1e6(0x154);break;case _0x3af1e6(0xf9):case _0x3af1e6(0xde):_0x4912bd='EXPIRED';break;case'waiting':case _0x3af1e6(0x129):case _0x3af1e6(0x10e):case _0x3af1e6(0x120):default:_0x4912bd=_0x3af1e6(0x102);break;}let _0x48ac0f,_0x1de4ea;if(_0x294bce[_0x3af1e6(0x115)][_0x3af1e6(0xf3)]){const _0x5802cb=_0x294bce['data'][_0x3af1e6(0xf3)];console[_0x3af1e6(0x10f)](_0x3af1e6(0xe9),_0x5802cb);const _0xac2e2d=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x3d6c44 of _0xac2e2d){const _0x542c94=_0x5802cb['match'](_0x3d6c44);if(_0x542c94){_0x48ac0f=_0x542c94[0x1],console['log'](_0x3af1e6(0x13c),_0x48ac0f,_0x3af1e6(0x14d),_0x3d6c44[_0x3af1e6(0x14b)]);break;}}if(!_0x48ac0f){console['log']('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x343c70=_0x5802cb['match'](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x343c70&&(_0x48ac0f=_0x343c70[0x1],console[_0x3af1e6(0x10f)](_0x3af1e6(0x152),_0x48ac0f));}_0x1de4ea=_0x5802cb;}const _0xbf0523={'iban':_0x48ac0f,'bankDetails':_0x1de4ea,'transactionId':_0x294bce[_0x3af1e6(0x115)][_0x3af1e6(0x124)],'coinAddress':_0x294bce[_0x3af1e6(0x115)][_0x3af1e6(0xf7)],'qrCodeUrl':_0x294bce[_0x3af1e6(0x115)][_0x3af1e6(0x101)],'expiryTime':_0x294bce[_0x3af1e6(0x115)]['ExpiryTime'],'createdOn':_0x294bce[_0x3af1e6(0x115)][_0x3af1e6(0x107)],'confirmedOn':_0x294bce[_0x3af1e6(0x115)][_0x3af1e6(0x10a)]};console[_0x3af1e6(0x10f)](_0x3af1e6(0x116)),console[_0x3af1e6(0x10f)](_0x3af1e6(0x100),_0x294bce[_0x3af1e6(0x115)]['Status'],'->',_0x4912bd),console['log']('Amount:',_0x294bce[_0x3af1e6(0x115)]['Amount'],_0x294bce[_0x3af1e6(0x115)]['inputCurrency']),console[_0x3af1e6(0x10f)](_0x3af1e6(0x149),_0x294bce[_0x3af1e6(0x115)]['TransactionID']),console[_0x3af1e6(0x10f)]('IBAN:',_0x48ac0f||'not\x20found'),console[_0x3af1e6(0x10f)](_0x3af1e6(0x12e),_0x294bce[_0x3af1e6(0x115)][_0x3af1e6(0x107)]),console[_0x3af1e6(0x10f)](_0x3af1e6(0x138),_0x294bce[_0x3af1e6(0x115)][_0x3af1e6(0x10a)]||'not\x20confirmed');if(_0x294bce['data']['Status']?.[_0x3af1e6(0xf2)]()===_0x3af1e6(0x129))console[_0x3af1e6(0x10f)](_0x3af1e6(0x136));else _0x294bce[_0x3af1e6(0x115)][_0x3af1e6(0xd4)]?.[_0x3af1e6(0xf2)]()===_0x3af1e6(0xd5)&&console[_0x3af1e6(0x10f)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x4912bd,'amount':parseFloat(_0x294bce[_0x3af1e6(0x115)]['Amount'])||undefined,'currency':_0x294bce[_0x3af1e6(0x115)][_0x3af1e6(0x131)]||'EUR','paymentDetails':_0xbf0523};}catch(_0x3603c9){console[_0x3af1e6(0xd8)](_0x3af1e6(0x11f),_0x3603c9),loggerService_1['loggerService']['logWhiteDomainError'](_0x3af1e6(0xd3),_0x3af1e6(0x11a),_0x3603c9);throw new Error(_0x3af1e6(0xe6)+(_0x3603c9 instanceof Error?_0x3603c9['message']:_0x3af1e6(0xf4)));}}async[a48_0x366d94(0x130)](_0x456cfb){const _0x565fe3=a48_0x366d94,_0x3aba9d=await this[_0x565fe3(0xd6)](_0x456cfb);return{'status':_0x3aba9d[_0x565fe3(0xf8)],'amount':_0x3aba9d[_0x565fe3(0x128)],'currency':_0x3aba9d['currency']};}async['processWebhook'](_0x4822a6){const _0x3dafa2=a48_0x366d94;console[_0x3dafa2(0x10f)](_0x3dafa2(0x109),_0x4822a6);let _0x3fafc8=_0x3dafa2(0x102);switch(_0x4822a6[_0x3dafa2(0xf8)]?.[_0x3dafa2(0xf2)]()){case'paid':_0x3fafc8=_0x3dafa2(0x122);break;case _0x3dafa2(0x10c):case _0x3dafa2(0x133):case _0x3dafa2(0xd8):_0x3fafc8=_0x3dafa2(0x154);break;case _0x3dafa2(0xf9):case'timeout':_0x3fafc8=_0x3dafa2(0x151);break;case _0x3dafa2(0x10e):case _0x3dafa2(0x104):case _0x3dafa2(0x129):case'created':default:_0x3fafc8='PENDING';break;}return{'paymentId':_0x4822a6['order_id']||_0x4822a6[_0x3dafa2(0xec)]||'','status':_0x3fafc8,'amount':_0x4822a6[_0x3dafa2(0x128)],'currency':_0x4822a6[_0x3dafa2(0x14e)]||_0x3dafa2(0x111)};}}exports[a48_0x366d94(0x135)]=CoinToPay2Service;