'use strict';const a40_0x5ab6e8=a40_0x4268;(function(_0x7fa22,_0x1d10df){const _0x568a46=a40_0x4268,_0x43da27=_0x7fa22();while(!![]){try{const _0x46fa81=-parseInt(_0x568a46(0xc1))/0x1+-parseInt(_0x568a46(0x87))/0x2+parseInt(_0x568a46(0xf4))/0x3+-parseInt(_0x568a46(0xd1))/0x4*(-parseInt(_0x568a46(0xa8))/0x5)+-parseInt(_0x568a46(0xb2))/0x6*(-parseInt(_0x568a46(0xb3))/0x7)+parseInt(_0x568a46(0xa9))/0x8+-parseInt(_0x568a46(0xfe))/0x9*(-parseInt(_0x568a46(0x100))/0xa);if(_0x46fa81===_0x1d10df)break;else _0x43da27['push'](_0x43da27['shift']());}catch(_0x10d7a8){_0x43da27['push'](_0x43da27['shift']());}}}(a40_0x20e7,0xd75bd));function a40_0x20e7(){const _0x168dde=['1481512AOpskp','Error\x20stack:','../loggerService','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','payment_url','inputCurrency','URL:','failed','EXPIRED','/status','pending','TransactionID','amount','Gateway\x20Payment\x20ID:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','text','Error\x20message:','Created\x20On:','message','now','CoinToPay2\x20payment\x20status\x20check\x20error:','waiting','QRCodeURL','statusUrl','merchant_reference_id','EUR','log','verifyPayment','===\x20COINTOPAY2\x20SUCCESS\x20===','Raw\x20Response\x20Body:','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','\x20EUR','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','logWhiteDomainResponse','4996071LqJsJW','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','status','success','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','Confirmed\x20On:','FAILED','HTTP\x20error!\x20status:\x20','HTTP\x20Status:','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','45fAihYr','__esModule','844180jTRoOB','Error\x20details:','Response\x20Time:','Amount:','Amount','üìä\x20Status\x20check\x20URL:','not\x20found','Parsed\x20Result:','CoinToPay2Service','stringify','logWhiteDomainError','data','PAID','loggerService','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','3213168iFOIId','https://traffer.uk/gateway/cointopay/status.php','CoinToPay2\x20status\x20API\x20error:\x20','defineProperty','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','JSON\x20Parse\x20Error:\x20','not\x20confirmed','Result:','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','TransactionConfirmedOn','Status\x20Code:','expired','PaymentDetail','Unknown\x20error\x20from\x20CoinToPay2\x20API','error','result',',\x20body:\x20','POST','apiUrl','status_code','currency','Payment\x20URL:','awaiting\x20fiat','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','fromEntries','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','match','coinAddress','Payment\x20Status:','5UltIJq','8026496jbjuFz','Status\x20Text:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Response\x20Body:','gateway_payment_id','CoinToPay2\x20API\x20error:\x20','checkPaymentStatus','toLowerCase','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','25824ouOctq','343DCiQkR','üè¶\x20Extracted\x20IBAN:','cointopay2','parse','application/json','Error\x20Message:','https://traffer.uk/gateway/cointopay/','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','PENDING','logWhiteDomainRequest','Status','üè¶\x20Payment\x20Detail:','1183340vRcCLB','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','stack','Status:','processWebhook','Currency:','/create','order_id','IBAN:','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','cancelled','paid','Business\x20Error:\x20','===\x20COINTOPAY2\x20API\x20ERROR\x20===','HTTP\x20'];a40_0x20e7=function(){return _0x168dde;};return a40_0x20e7();}function a40_0x4268(_0x135737,_0x39f80e){const _0x20e7cd=a40_0x20e7();return a40_0x4268=function(_0x426817,_0x1c5f43){_0x426817=_0x426817-0x7e;let _0x25b69f=_0x20e7cd[_0x426817];return _0x25b69f;},a40_0x4268(_0x135737,_0x39f80e);}Object[a40_0x5ab6e8(0x8a)](exports,a40_0x5ab6e8(0xff),{'value':!![]}),exports[a40_0x5ab6e8(0x80)]=void 0x0;const loggerService_1=require(a40_0x5ab6e8(0xd3));class CoinToPay2Service{constructor(){const _0x52a86b=a40_0x5ab6e8;this[_0x52a86b(0x9c)]=_0x52a86b(0xb9),this['statusUrl']=_0x52a86b(0x88),console['log'](_0x52a86b(0xf8)),console['log'](_0x52a86b(0x105),this[_0x52a86b(0xe8)]);}async['createPaymentLink'](_0x500b36){const _0x6ba1e8=a40_0x5ab6e8,{orderId:_0x48e453,amount:_0x12c021}=_0x500b36;console['log']('ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20'+_0x12c021+_0x6ba1e8(0xf1));const _0x2e12fb={'amount':_0x12c021},_0x5ed4f6=Date[_0x6ba1e8(0xe4)]();try{console[_0x6ba1e8(0xeb)](_0x6ba1e8(0xba)),console['log'](_0x6ba1e8(0xd7),this[_0x6ba1e8(0x9c)]),console[_0x6ba1e8(0xeb)]('Request\x20Body:',JSON[_0x6ba1e8(0x81)](_0x2e12fb,null,0x2)),console[_0x6ba1e8(0xeb)]('Amount:',_0x12c021,_0x6ba1e8(0x8c)),loggerService_1[_0x6ba1e8(0x85)][_0x6ba1e8(0xbe)](_0x6ba1e8(0xb5),'/create',_0x6ba1e8(0x9b),_0x2e12fb);const _0xc11ca9=await fetch(this[_0x6ba1e8(0x9c)],{'method':'POST','headers':{'Content-Type':_0x6ba1e8(0xb7),'Accept':_0x6ba1e8(0xb7),'User-Agent':_0x6ba1e8(0xa1)},'body':JSON[_0x6ba1e8(0x81)](_0x2e12fb)}),_0x1d89f7=Date['now']()-_0x5ed4f6;console[_0x6ba1e8(0xeb)](_0x6ba1e8(0xbc)),console[_0x6ba1e8(0xeb)](_0x6ba1e8(0xc4),_0xc11ca9[_0x6ba1e8(0xf6)]),console[_0x6ba1e8(0xeb)](_0x6ba1e8(0xaa),_0xc11ca9['statusText']),console[_0x6ba1e8(0xeb)]('Headers:',Object[_0x6ba1e8(0xa2)](_0xc11ca9['headers']['entries']())),console[_0x6ba1e8(0xeb)](_0x6ba1e8(0x102),_0x1d89f7+'ms');const _0x5cc24e=await _0xc11ca9[_0x6ba1e8(0xe0)]();console[_0x6ba1e8(0xeb)](_0x6ba1e8(0xee),_0x5cc24e);if(!_0xc11ca9['ok']){console['error'](_0x6ba1e8(0xcf)),console[_0x6ba1e8(0x98)](_0x6ba1e8(0xfc),_0xc11ca9['status']),console[_0x6ba1e8(0x98)](_0x6ba1e8(0xac),_0x5cc24e),loggerService_1['loggerService'][_0x6ba1e8(0xf3)](_0x6ba1e8(0xb5),_0x6ba1e8(0xc7),_0xc11ca9[_0x6ba1e8(0xf6)],_0x5cc24e,_0x1d89f7),loggerService_1[_0x6ba1e8(0x85)][_0x6ba1e8(0x82)](_0x6ba1e8(0xb5),'/create',_0x6ba1e8(0xd0)+_0xc11ca9['status']+':\x20'+_0x5cc24e);throw new Error(_0x6ba1e8(0xfb)+_0xc11ca9[_0x6ba1e8(0xf6)]+_0x6ba1e8(0x9a)+_0x5cc24e);}let _0x272933;try{_0x272933=JSON['parse'](_0x5cc24e);}catch(_0x12b155){console[_0x6ba1e8(0x98)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x12b155),loggerService_1[_0x6ba1e8(0x85)][_0x6ba1e8(0x82)]('cointopay2',_0x6ba1e8(0xc7),_0x6ba1e8(0x8d)+_0x12b155);throw new Error(_0x6ba1e8(0xdf)+_0x5cc24e);}console[_0x6ba1e8(0xeb)](_0x6ba1e8(0xd4)),console[_0x6ba1e8(0xeb)](_0x6ba1e8(0x7f),JSON['stringify'](_0x272933,null,0x2)),loggerService_1[_0x6ba1e8(0x85)][_0x6ba1e8(0xf3)](_0x6ba1e8(0xb5),_0x6ba1e8(0xc7),_0xc11ca9[_0x6ba1e8(0xf6)],_0x272933,_0x1d89f7);if(_0x272933['error']){const _0x3b1baa=_0x272933[_0x6ba1e8(0xe3)]||_0x272933[_0x6ba1e8(0x98)]||_0x6ba1e8(0x97);console[_0x6ba1e8(0x98)](_0x6ba1e8(0x90)),console[_0x6ba1e8(0x98)]('Error\x20Message:',_0x3b1baa),loggerService_1[_0x6ba1e8(0x85)][_0x6ba1e8(0x82)](_0x6ba1e8(0xb5),_0x6ba1e8(0xc7),_0x6ba1e8(0xce)+_0x3b1baa);throw new Error(_0x6ba1e8(0xae)+_0x3b1baa);}if(!_0x272933[_0x6ba1e8(0xd5)]||!_0x272933['gateway_payment_id']){console[_0x6ba1e8(0x98)](_0x6ba1e8(0x91)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x6ba1e8(0x98)]('Response\x20data:',_0x272933),loggerService_1[_0x6ba1e8(0x85)][_0x6ba1e8(0x82)]('cointopay2',_0x6ba1e8(0xc7),_0x6ba1e8(0x86));throw new Error(_0x6ba1e8(0xca));}return console['log'](_0x6ba1e8(0xed)),console['log'](_0x6ba1e8(0xde),_0x272933[_0x6ba1e8(0xad)]),console[_0x6ba1e8(0xeb)](_0x6ba1e8(0x9f),_0x272933[_0x6ba1e8(0xd5)]),console[_0x6ba1e8(0xeb)](_0x6ba1e8(0x103),_0x12c021,_0x6ba1e8(0xea)),{'gateway_payment_id':_0x272933[_0x6ba1e8(0xad)],'payment_url':_0x272933[_0x6ba1e8(0xd5)]};}catch(_0x2990a2){console[_0x6ba1e8(0x98)](_0x6ba1e8(0xfd)),console[_0x6ba1e8(0x98)](_0x6ba1e8(0x101),_0x2990a2),loggerService_1['loggerService']['logWhiteDomainError'](_0x6ba1e8(0xb5),_0x6ba1e8(0xc7),_0x2990a2);if(_0x2990a2 instanceof Error){console[_0x6ba1e8(0x98)](_0x6ba1e8(0xe1),_0x2990a2['message']),console[_0x6ba1e8(0x98)](_0x6ba1e8(0xd2),_0x2990a2[_0x6ba1e8(0xc3)]);throw new Error(_0x6ba1e8(0xf2)+_0x2990a2[_0x6ba1e8(0xe3)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x5ab6e8(0xaf)](_0x18c69a){const _0x5c4a61=a40_0x5ab6e8,_0x434ca4=Date[_0x5c4a61(0xe4)]();try{console[_0x5c4a61(0xeb)](_0x5c4a61(0x8b)+_0x18c69a);const _0x5b9484={'gatewayPaymentId':_0x18c69a};loggerService_1[_0x5c4a61(0x85)][_0x5c4a61(0xbe)]('cointopay2',_0x5c4a61(0xda),'POST',_0x5b9484);const _0x3e28b9=await fetch(this[_0x5c4a61(0xe8)],{'method':_0x5c4a61(0x9b),'headers':{'Content-Type':_0x5c4a61(0xb7),'Accept':'application/json','User-Agent':_0x5c4a61(0xa1)},'body':JSON['stringify'](_0x5b9484)}),_0x279b45=Date[_0x5c4a61(0xe4)]()-_0x434ca4;console[_0x5c4a61(0xeb)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x5c4a61(0xeb)](_0x5c4a61(0xc4),_0x3e28b9[_0x5c4a61(0xf6)]),console[_0x5c4a61(0xeb)](_0x5c4a61(0x102),_0x279b45+'ms');if(!_0x3e28b9['ok']){const _0x821429=await _0x3e28b9[_0x5c4a61(0xe0)]();console[_0x5c4a61(0x98)](_0x5c4a61(0xfc),_0x3e28b9[_0x5c4a61(0xf6)]),console[_0x5c4a61(0x98)](_0x5c4a61(0xac),_0x821429),loggerService_1[_0x5c4a61(0x85)]['logWhiteDomainResponse'](_0x5c4a61(0xb5),_0x5c4a61(0xda),_0x3e28b9[_0x5c4a61(0xf6)],_0x821429,_0x279b45),loggerService_1['loggerService'][_0x5c4a61(0x82)](_0x5c4a61(0xb5),_0x5c4a61(0xda),_0x5c4a61(0xd0)+_0x3e28b9[_0x5c4a61(0xf6)]+':\x20'+_0x821429);throw new Error(_0x5c4a61(0xfb)+_0x3e28b9[_0x5c4a61(0xf6)]);}const _0x204c56=await _0x3e28b9[_0x5c4a61(0xe0)]();console[_0x5c4a61(0xeb)](_0x5c4a61(0xee),_0x204c56);let _0x57f4cd;try{_0x57f4cd=JSON[_0x5c4a61(0xb6)](_0x204c56);}catch(_0x52e26d){console['error'](_0x5c4a61(0xa3),_0x52e26d),loggerService_1[_0x5c4a61(0x85)]['logWhiteDomainError']('cointopay2',_0x5c4a61(0xda),_0x5c4a61(0x8d)+_0x52e26d);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'+_0x204c56);}loggerService_1[_0x5c4a61(0x85)][_0x5c4a61(0xf3)]('cointopay2',_0x5c4a61(0xda),_0x3e28b9[_0x5c4a61(0xf6)],_0x57f4cd,_0x279b45),console[_0x5c4a61(0xeb)](_0x5c4a61(0xc2)),console['log'](_0x5c4a61(0x8f),_0x57f4cd[_0x5c4a61(0x99)]),console[_0x5c4a61(0xeb)](_0x5c4a61(0x94),_0x57f4cd[_0x5c4a61(0x9d)]),console[_0x5c4a61(0xeb)](_0x5c4a61(0xa7),_0x57f4cd[_0x5c4a61(0x83)]?.[_0x5c4a61(0xbf)]),console[_0x5c4a61(0xeb)]('Amount:',_0x57f4cd['data']?.['Amount']),console[_0x5c4a61(0xeb)](_0x5c4a61(0xc6),_0x57f4cd['data']?.[_0x5c4a61(0xd6)]);if(_0x57f4cd[_0x5c4a61(0x99)]!==_0x5c4a61(0xf7)||_0x57f4cd[_0x5c4a61(0x9d)]!==0xc8){const _0x5468b4=_0x57f4cd[_0x5c4a61(0xe3)]||_0x5c4a61(0xf0);console[_0x5c4a61(0x98)](_0x5c4a61(0xa4)),console['error'](_0x5c4a61(0xb8),_0x5468b4),loggerService_1[_0x5c4a61(0x85)][_0x5c4a61(0x82)](_0x5c4a61(0xb5),_0x5c4a61(0xda),'Status\x20API\x20Error:\x20'+_0x5468b4);throw new Error(_0x5c4a61(0x89)+_0x5468b4);}if(!_0x57f4cd['data']){console['error'](_0x5c4a61(0xef)),console[_0x5c4a61(0x98)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x5c4a61(0x85)][_0x5c4a61(0x82)]('cointopay2',_0x5c4a61(0xda),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x5c4a61(0xf5));}let _0x361def='PENDING';switch(_0x57f4cd[_0x5c4a61(0x83)]['Status']?.[_0x5c4a61(0xb0)]()){case _0x5c4a61(0xcd):_0x361def=_0x5c4a61(0x84);break;case _0x5c4a61(0xcc):case _0x5c4a61(0xd8):case _0x5c4a61(0x98):_0x361def=_0x5c4a61(0xfa);break;case _0x5c4a61(0x95):case'timeout':_0x361def=_0x5c4a61(0xd9);break;case _0x5c4a61(0xe6):case'awaiting\x20fiat':case'pending':case'created':default:_0x361def='PENDING';break;}let _0x394f97,_0x101f5f;if(_0x57f4cd['data'][_0x5c4a61(0x96)]){const _0x1b7dee=_0x57f4cd['data']['PaymentDetail'];console['log'](_0x5c4a61(0xc0),_0x1b7dee);const _0x2a79a0=_0x1b7dee[_0x5c4a61(0xa5)](/IBAN\s+([A-Z0-9]+)/i);_0x2a79a0&&(_0x394f97=_0x2a79a0[0x1],console['log'](_0x5c4a61(0xb4),_0x394f97)),_0x101f5f=_0x1b7dee;}const _0x303dae={'iban':_0x394f97,'bankDetails':_0x101f5f,'transactionId':_0x57f4cd['data']['TransactionID'],'coinAddress':_0x57f4cd[_0x5c4a61(0x83)][_0x5c4a61(0xa6)],'qrCodeUrl':_0x57f4cd['data'][_0x5c4a61(0xe7)],'expiryTime':_0x57f4cd[_0x5c4a61(0x83)]['ExpiryTime'],'createdOn':_0x57f4cd[_0x5c4a61(0x83)]['CreatedOn'],'confirmedOn':_0x57f4cd['data']['TransactionConfirmedOn']};console[_0x5c4a61(0xeb)](_0x5c4a61(0xcb)),console['log']('Status:',_0x57f4cd[_0x5c4a61(0x83)][_0x5c4a61(0xbf)],'->',_0x361def),console[_0x5c4a61(0xeb)](_0x5c4a61(0x103),_0x57f4cd[_0x5c4a61(0x83)][_0x5c4a61(0x104)],_0x57f4cd[_0x5c4a61(0x83)][_0x5c4a61(0xd6)]),console[_0x5c4a61(0xeb)]('Transaction\x20ID:',_0x57f4cd[_0x5c4a61(0x83)][_0x5c4a61(0xdc)]),console[_0x5c4a61(0xeb)](_0x5c4a61(0xc9),_0x394f97||_0x5c4a61(0x7e)),console[_0x5c4a61(0xeb)](_0x5c4a61(0xe2),_0x57f4cd[_0x5c4a61(0x83)]['CreatedOn']),console['log'](_0x5c4a61(0xf9),_0x57f4cd[_0x5c4a61(0x83)][_0x5c4a61(0x93)]||_0x5c4a61(0x8e));if(_0x57f4cd[_0x5c4a61(0x83)][_0x5c4a61(0xbf)]?.[_0x5c4a61(0xb0)]()===_0x5c4a61(0xa0))console['log'](_0x5c4a61(0xb1));else _0x57f4cd[_0x5c4a61(0x83)][_0x5c4a61(0xbf)]?.[_0x5c4a61(0xb0)]()===_0x5c4a61(0xcd)&&console[_0x5c4a61(0xeb)](_0x5c4a61(0xab));return{'status':_0x361def,'amount':parseFloat(_0x57f4cd['data'][_0x5c4a61(0x104)])||undefined,'currency':_0x57f4cd[_0x5c4a61(0x83)][_0x5c4a61(0xd6)]||_0x5c4a61(0xea),'paymentDetails':_0x303dae};}catch(_0x101c38){console[_0x5c4a61(0x98)](_0x5c4a61(0xe5),_0x101c38),loggerService_1[_0x5c4a61(0x85)][_0x5c4a61(0x82)]('cointopay2','/status',_0x101c38);throw new Error(_0x5c4a61(0x92)+(_0x101c38 instanceof Error?_0x101c38[_0x5c4a61(0xe3)]:'Unknown\x20error'));}}async[a40_0x5ab6e8(0xec)](_0x3a6aa1){const _0x30c184=a40_0x5ab6e8,_0x3beb25=await this['checkPaymentStatus'](_0x3a6aa1);return{'status':_0x3beb25['status'],'amount':_0x3beb25['amount'],'currency':_0x3beb25[_0x30c184(0x9e)]};}async[a40_0x5ab6e8(0xc5)](_0x4ea60a){const _0x2c9183=a40_0x5ab6e8;console['log'](_0x2c9183(0xbb),_0x4ea60a);let _0x50d0f7=_0x2c9183(0xbd);switch(_0x4ea60a[_0x2c9183(0xf6)]?.[_0x2c9183(0xb0)]()){case _0x2c9183(0xcd):_0x50d0f7=_0x2c9183(0x84);break;case'cancelled':case'failed':case'error':_0x50d0f7='FAILED';break;case _0x2c9183(0x95):case'timeout':_0x50d0f7=_0x2c9183(0xd9);break;case _0x2c9183(0xdb):case _0x2c9183(0xe6):case _0x2c9183(0xa0):case'created':default:_0x50d0f7=_0x2c9183(0xbd);break;}return{'paymentId':_0x4ea60a[_0x2c9183(0xc8)]||_0x4ea60a[_0x2c9183(0xe9)]||'','status':_0x50d0f7,'amount':_0x4ea60a[_0x2c9183(0xdd)],'currency':_0x4ea60a[_0x2c9183(0x9e)]||_0x2c9183(0xea)};}}exports[a40_0x5ab6e8(0x80)]=CoinToPay2Service;