'use strict';const a64_0x56dce2=a64_0x58b5;(function(_0x3cd519,_0x5b0922){const _0x312f09=a64_0x58b5,_0x122f44=_0x3cd519();while(!![]){try{const _0x52a794=-parseInt(_0x312f09(0x1a3))/0x1+-parseInt(_0x312f09(0x1a6))/0x2*(-parseInt(_0x312f09(0x171))/0x3)+-parseInt(_0x312f09(0x177))/0x4*(parseInt(_0x312f09(0x166))/0x5)+-parseInt(_0x312f09(0x16e))/0x6+-parseInt(_0x312f09(0x1b6))/0x7+-parseInt(_0x312f09(0x165))/0x8*(-parseInt(_0x312f09(0x1ba))/0x9)+parseInt(_0x312f09(0x1cf))/0xa;if(_0x52a794===_0x5b0922)break;else _0x122f44['push'](_0x122f44['shift']());}catch(_0x1c4685){_0x122f44['push'](_0x122f44['shift']());}}}(a64_0x1fa9,0x30943));Object[a64_0x56dce2(0x1d4)](exports,a64_0x56dce2(0x1a1),{'value':!![]}),exports[a64_0x56dce2(0x1c6)]=void 0x0;const loggerService_1=require(a64_0x56dce2(0x1c8));function a64_0x58b5(_0x4e407c,_0x44681a){_0x4e407c=_0x4e407c-0x15d;const _0x1fa94b=a64_0x1fa9();let _0x58b5f4=_0x1fa94b[_0x4e407c];return _0x58b5f4;}class CoinToPay2Service{constructor(){const _0x74c5a2=a64_0x56dce2;this[_0x74c5a2(0x1c9)]=_0x74c5a2(0x162),this['statusUrl']='https://traffer.uk/gateway/cointopay/status.php',console['log'](_0x74c5a2(0x1e2)),console[_0x74c5a2(0x1c3)]('üìä\x20Status\x20check\x20URL:',this['statusUrl']);}async[a64_0x56dce2(0x16a)](_0x32b1d8){const _0x169780=a64_0x56dce2,{orderId:_0x3dc64c,amount:_0xf72cc4}=_0x32b1d8;console['log'](_0x169780(0x18f)+_0xf72cc4+'\x20EUR');const _0x3e3bd3={'amount':_0xf72cc4},_0x299512=Date[_0x169780(0x1d5)]();try{console[_0x169780(0x1c3)](_0x169780(0x1ce)),console[_0x169780(0x1c3)]('URL:',this[_0x169780(0x1c9)]),console[_0x169780(0x1c3)](_0x169780(0x15e),JSON[_0x169780(0x185)](_0x3e3bd3,null,0x2)),console['log'](_0x169780(0x1ac),_0xf72cc4,_0x169780(0x1b2)),loggerService_1[_0x169780(0x1a5)][_0x169780(0x179)](_0x169780(0x191),_0x169780(0x189),_0x169780(0x18d),_0x3e3bd3);const _0x476280=await fetch(this['apiUrl'],{'method':_0x169780(0x18d),'headers':{'Content-Type':_0x169780(0x1cb),'Accept':_0x169780(0x1cb),'User-Agent':_0x169780(0x19e)},'body':JSON[_0x169780(0x185)](_0x3e3bd3)}),_0x3774e7=Date[_0x169780(0x1d5)]()-_0x299512;console[_0x169780(0x1c3)](_0x169780(0x1e3)),console[_0x169780(0x1c3)](_0x169780(0x19d),_0x476280[_0x169780(0x174)]),console[_0x169780(0x1c3)](_0x169780(0x19c),_0x476280[_0x169780(0x186)]),console['log'](_0x169780(0x1a9),Object[_0x169780(0x1aa)](_0x476280[_0x169780(0x1ad)][_0x169780(0x1be)]())),console[_0x169780(0x1c3)](_0x169780(0x18b),_0x3774e7+'ms');const _0x32fd34=await _0x476280['text']();console[_0x169780(0x1c3)](_0x169780(0x167),_0x32fd34);if(!_0x476280['ok']){console[_0x169780(0x1bf)](_0x169780(0x19a)),console[_0x169780(0x1bf)]('HTTP\x20Status:',_0x476280[_0x169780(0x174)]),console[_0x169780(0x1bf)](_0x169780(0x193),_0x32fd34),loggerService_1[_0x169780(0x1a5)]['logWhiteDomainResponse'](_0x169780(0x191),_0x169780(0x189),_0x476280[_0x169780(0x174)],_0x32fd34,_0x3774e7),loggerService_1[_0x169780(0x1a5)][_0x169780(0x183)](_0x169780(0x191),_0x169780(0x189),'HTTP\x20'+_0x476280['status']+':\x20'+_0x32fd34);throw new Error('HTTP\x20error!\x20status:\x20'+_0x476280[_0x169780(0x174)]+_0x169780(0x1de)+_0x32fd34);}let _0x2a68ff;try{_0x2a68ff=JSON[_0x169780(0x182)](_0x32fd34);}catch(_0x2531b2){console[_0x169780(0x1bf)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x2531b2),loggerService_1[_0x169780(0x1a5)][_0x169780(0x183)](_0x169780(0x191),_0x169780(0x189),_0x169780(0x1c4)+_0x2531b2);throw new Error(_0x169780(0x1b5)+_0x32fd34);}console['log'](_0x169780(0x19f)),console[_0x169780(0x1c3)](_0x169780(0x1bb),JSON[_0x169780(0x185)](_0x2a68ff,null,0x2)),loggerService_1[_0x169780(0x1a5)][_0x169780(0x194)](_0x169780(0x191),_0x169780(0x189),_0x476280[_0x169780(0x174)],_0x2a68ff,_0x3774e7);if(_0x2a68ff[_0x169780(0x1bf)]){const _0xa78311=_0x2a68ff['message']||_0x2a68ff['error']||_0x169780(0x1e1);console[_0x169780(0x1bf)](_0x169780(0x173)),console[_0x169780(0x1bf)]('Error\x20Message:',_0xa78311),loggerService_1[_0x169780(0x1a5)]['logWhiteDomainError']('cointopay2','/create',_0x169780(0x1d6)+_0xa78311);throw new Error('CoinToPay2\x20API\x20error:\x20'+_0xa78311);}if(!_0x2a68ff[_0x169780(0x176)]||!_0x2a68ff[_0x169780(0x168)]){console[_0x169780(0x1bf)](_0x169780(0x17d)),console[_0x169780(0x1bf)](_0x169780(0x16f)),console[_0x169780(0x1bf)](_0x169780(0x164),_0x2a68ff),loggerService_1[_0x169780(0x1a5)]['logWhiteDomainError'](_0x169780(0x191),_0x169780(0x189),_0x169780(0x18c));throw new Error(_0x169780(0x1b9));}console[_0x169780(0x1c3)]('===\x20COINTOPAY2\x20SUCCESS\x20==='),console['log']('Gateway\x20Payment\x20ID:',_0x2a68ff[_0x169780(0x168)]),console[_0x169780(0x1c3)](_0x169780(0x1dc),_0x2a68ff['payment_url']);const _0x3165ac=_0x2a68ff[_0x169780(0x176)]+'&alternative=false';return console[_0x169780(0x1c3)](_0x169780(0x1d8),_0x3165ac),console['log'](_0x169780(0x1ac),_0xf72cc4,_0x169780(0x1a7)),{'gateway_payment_id':_0x2a68ff['gateway_payment_id'],'payment_url':_0x3165ac};}catch(_0x246083){console['error'](_0x169780(0x1af)),console[_0x169780(0x1bf)]('Error\x20details:',_0x246083),loggerService_1[_0x169780(0x1a5)][_0x169780(0x183)](_0x169780(0x191),'/create',_0x246083);if(_0x246083 instanceof Error){console[_0x169780(0x1bf)]('Error\x20message:',_0x246083[_0x169780(0x1b7)]),console['error'](_0x169780(0x163),_0x246083['stack']);throw new Error(_0x169780(0x1cd)+_0x246083[_0x169780(0x1b7)]);}throw new Error(_0x169780(0x195));}}async[a64_0x56dce2(0x17a)](_0x1de4dc){const _0x1220dc=a64_0x56dce2,_0x347b3d=Date[_0x1220dc(0x1d5)]();try{console[_0x1220dc(0x1c3)](_0x1220dc(0x1e0)+_0x1de4dc);const _0x228fef={'gatewayPaymentId':_0x1de4dc};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x1220dc(0x191),'/status',_0x1220dc(0x18d),_0x228fef);const _0x1488d9=await fetch(this[_0x1220dc(0x17c)],{'method':_0x1220dc(0x18d),'headers':{'Content-Type':'application/json','Accept':_0x1220dc(0x1cb),'User-Agent':_0x1220dc(0x19e)},'body':JSON[_0x1220dc(0x185)](_0x228fef)}),_0x3beb35=Date['now']()-_0x347b3d;console['log']('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x1220dc(0x1c3)]('Status:',_0x1488d9[_0x1220dc(0x174)]),console['log'](_0x1220dc(0x18b),_0x3beb35+'ms');if(!_0x1488d9['ok']){const _0x48b121=await _0x1488d9['text']();console[_0x1220dc(0x1bf)](_0x1220dc(0x197),_0x1488d9[_0x1220dc(0x174)]),console[_0x1220dc(0x1bf)](_0x1220dc(0x193),_0x48b121),loggerService_1[_0x1220dc(0x1a5)][_0x1220dc(0x194)](_0x1220dc(0x191),_0x1220dc(0x19b),_0x1488d9[_0x1220dc(0x174)],_0x48b121,_0x3beb35),loggerService_1[_0x1220dc(0x1a5)][_0x1220dc(0x183)]('cointopay2',_0x1220dc(0x19b),'HTTP\x20'+_0x1488d9['status']+':\x20'+_0x48b121);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1488d9['status']);}const _0xc16250=await _0x1488d9[_0x1220dc(0x15f)]();console[_0x1220dc(0x1c3)](_0x1220dc(0x167),_0xc16250);let _0x1c16ed;try{_0x1c16ed=JSON[_0x1220dc(0x182)](_0xc16250);}catch(_0x58d624){console[_0x1220dc(0x1bf)](_0x1220dc(0x16d),_0x58d624),loggerService_1[_0x1220dc(0x1a5)][_0x1220dc(0x183)](_0x1220dc(0x191),'/status',_0x1220dc(0x1c4)+_0x58d624);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'+_0xc16250);}loggerService_1[_0x1220dc(0x1a5)][_0x1220dc(0x194)](_0x1220dc(0x191),_0x1220dc(0x19b),_0x1488d9[_0x1220dc(0x174)],_0x1c16ed,_0x3beb35),console['log']('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x1220dc(0x1d7),_0x1c16ed['result']),console[_0x1220dc(0x1c3)](_0x1220dc(0x178),_0x1c16ed[_0x1220dc(0x1c5)]),console[_0x1220dc(0x1c3)](_0x1220dc(0x18e),_0x1c16ed['data']?.['Status']),console[_0x1220dc(0x1c3)](_0x1220dc(0x1ac),_0x1c16ed[_0x1220dc(0x15d)]?.['Amount']),console['log'](_0x1220dc(0x17b),_0x1c16ed['data']?.[_0x1220dc(0x1d3)]);if(_0x1c16ed[_0x1220dc(0x1d1)]!==_0x1220dc(0x16c)||_0x1c16ed[_0x1220dc(0x1c5)]!==0xc8){const _0x3ed442=_0x1c16ed[_0x1220dc(0x1b7)]||_0x1220dc(0x169);console['error']('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console[_0x1220dc(0x1bf)](_0x1220dc(0x17e),_0x3ed442),loggerService_1[_0x1220dc(0x1a5)][_0x1220dc(0x183)](_0x1220dc(0x191),_0x1220dc(0x19b),_0x1220dc(0x1b0)+_0x3ed442);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0x3ed442);}if(!_0x1c16ed[_0x1220dc(0x15d)]){console[_0x1220dc(0x1bf)](_0x1220dc(0x1b3)),console[_0x1220dc(0x1bf)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x1220dc(0x1a5)][_0x1220dc(0x183)]('cointopay2','/status',_0x1220dc(0x181));throw new Error(_0x1220dc(0x170));}let _0x578402=_0x1220dc(0x1a4);switch(_0x1c16ed[_0x1220dc(0x15d)][_0x1220dc(0x1b4)]?.['toLowerCase']()){case _0x1220dc(0x17f):_0x578402=_0x1220dc(0x160);break;case _0x1220dc(0x1ab):case'failed':case _0x1220dc(0x1bf):_0x578402=_0x1220dc(0x1bd);break;case _0x1220dc(0x16b):case _0x1220dc(0x1df):_0x578402='EXPIRED';break;case _0x1220dc(0x161):case _0x1220dc(0x192):case _0x1220dc(0x1a0):case _0x1220dc(0x184):default:_0x578402=_0x1220dc(0x1a4);break;}let _0x3fc1d3,_0x3d4b10;if(_0x1c16ed[_0x1220dc(0x15d)][_0x1220dc(0x1d0)]){const _0x4355c2=_0x1c16ed['data']['PaymentDetail'];console[_0x1220dc(0x1c3)]('üè¶\x20Payment\x20Detail:',_0x4355c2);const _0x3d3581=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x201de9 of _0x3d3581){const _0x16824a=_0x4355c2[_0x1220dc(0x1b8)](_0x201de9);if(_0x16824a){_0x3fc1d3=_0x16824a[0x1],console[_0x1220dc(0x1c3)]('üè¶\x20Extracted\x20IBAN:',_0x3fc1d3,_0x1220dc(0x198),_0x201de9[_0x1220dc(0x1da)]);break;}}if(!_0x3fc1d3){console['log']('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x413f58=_0x4355c2[_0x1220dc(0x1b8)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x413f58&&(_0x3fc1d3=_0x413f58[0x1],console[_0x1220dc(0x1c3)]('üè¶\x20Extracted\x20IBAN\x20via\x20fallback:',_0x3fc1d3));}_0x3d4b10=_0x4355c2;}const _0x43b88b={'iban':_0x3fc1d3,'bankDetails':_0x3d4b10,'transactionId':_0x1c16ed[_0x1220dc(0x15d)][_0x1220dc(0x18a)],'coinAddress':_0x1c16ed['data']['coinAddress'],'qrCodeUrl':_0x1c16ed[_0x1220dc(0x15d)][_0x1220dc(0x175)],'expiryTime':_0x1c16ed[_0x1220dc(0x15d)][_0x1220dc(0x1db)],'createdOn':_0x1c16ed['data'][_0x1220dc(0x1ae)],'confirmedOn':_0x1c16ed['data'][_0x1220dc(0x1c1)]};console[_0x1220dc(0x1c3)](_0x1220dc(0x187)),console[_0x1220dc(0x1c3)]('Status:',_0x1c16ed[_0x1220dc(0x15d)][_0x1220dc(0x1b4)],'->',_0x578402),console[_0x1220dc(0x1c3)](_0x1220dc(0x1ac),_0x1c16ed[_0x1220dc(0x15d)][_0x1220dc(0x1c2)],_0x1c16ed['data'][_0x1220dc(0x1d3)]),console[_0x1220dc(0x1c3)](_0x1220dc(0x180),_0x1c16ed['data'][_0x1220dc(0x18a)]),console[_0x1220dc(0x1c3)](_0x1220dc(0x196),_0x3fc1d3||_0x1220dc(0x172)),console[_0x1220dc(0x1c3)](_0x1220dc(0x1d9),_0x1c16ed[_0x1220dc(0x15d)][_0x1220dc(0x1ae)]),console[_0x1220dc(0x1c3)](_0x1220dc(0x1ca),_0x1c16ed[_0x1220dc(0x15d)][_0x1220dc(0x1c1)]||_0x1220dc(0x199));if(_0x1c16ed['data']['Status']?.[_0x1220dc(0x1b1)]()===_0x1220dc(0x192))console[_0x1220dc(0x1c3)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x1c16ed[_0x1220dc(0x15d)][_0x1220dc(0x1b4)]?.[_0x1220dc(0x1b1)]()==='paid'&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x578402,'amount':parseFloat(_0x1c16ed[_0x1220dc(0x15d)]['Amount'])||undefined,'currency':_0x1c16ed[_0x1220dc(0x15d)]['inputCurrency']||_0x1220dc(0x1a7),'paymentDetails':_0x43b88b};}catch(_0x2c00bd){console[_0x1220dc(0x1bf)](_0x1220dc(0x1cc),_0x2c00bd),loggerService_1['loggerService'][_0x1220dc(0x183)]('cointopay2','/status',_0x2c00bd);throw new Error(_0x1220dc(0x1dd)+(_0x2c00bd instanceof Error?_0x2c00bd[_0x1220dc(0x1b7)]:_0x1220dc(0x1a2)));}}async[a64_0x56dce2(0x1bc)](_0x70ade){const _0x39e3eb=a64_0x56dce2,_0x512ebe=await this[_0x39e3eb(0x17a)](_0x70ade);return{'status':_0x512ebe['status'],'amount':_0x512ebe[_0x39e3eb(0x1c7)],'currency':_0x512ebe['currency']};}async[a64_0x56dce2(0x190)](_0x18cfe4){const _0x1df798=a64_0x56dce2;console[_0x1df798(0x1c3)]('Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x18cfe4);let _0x509ada=_0x1df798(0x1a4);switch(_0x18cfe4[_0x1df798(0x174)]?.[_0x1df798(0x1b1)]()){case _0x1df798(0x17f):_0x509ada='PAID';break;case _0x1df798(0x1ab):case _0x1df798(0x1c0):case _0x1df798(0x1bf):_0x509ada='FAILED';break;case _0x1df798(0x16b):case'timeout':_0x509ada=_0x1df798(0x1a8);break;case _0x1df798(0x1a0):case _0x1df798(0x161):case _0x1df798(0x192):case _0x1df798(0x184):default:_0x509ada=_0x1df798(0x1a4);break;}return{'paymentId':_0x18cfe4['order_id']||_0x18cfe4[_0x1df798(0x188)]||'','status':_0x509ada,'amount':_0x18cfe4['amount'],'currency':_0x18cfe4[_0x1df798(0x1d2)]||_0x1df798(0x1a7)};}}function a64_0x1fa9(){const _0x2a93f7=['fromEntries','cancelled','Amount:','headers','CreatedOn','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','Status\x20API\x20Error:\x20','toLowerCase','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','2729993WGmLao','message','match','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','215883BrhlPU','Parsed\x20Result:','verifyPayment','FAILED','entries','error','failed','TransactionConfirmedOn','Amount','log','JSON\x20Parse\x20Error:\x20','status_code','CoinToPay2Service','amount','../loggerService','apiUrl','Confirmed\x20On:','application/json','CoinToPay2\x20payment\x20status\x20check\x20error:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','9028030qwKdFR','PaymentDetail','result','currency','inputCurrency','defineProperty','now','Business\x20Error:\x20','Result:','Payment\x20URL\x20(modified):','Created\x20On:','source','ExpiryTime','Payment\x20URL\x20(original):','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20',',\x20body:\x20','timeout','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Unknown\x20error\x20from\x20CoinToPay2\x20API','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','data','Request\x20Body:','text','PAID','waiting','https://traffer.uk/gateway/cointopay/','Error\x20stack:','Response\x20data:','8dBgvYT','3775kZPZvQ','Raw\x20Response\x20Body:','gateway_payment_id','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','createPaymentLink','expired','success','Failed\x20to\x20parse\x20JSON\x20response:','422814QXvDCA','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','6wvBhII','not\x20found','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','status','QRCodeURL','payment_url','1644FpwGDj','Status\x20Code:','logWhiteDomainRequest','checkPaymentStatus','Currency:','statusUrl','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20Message:','paid','Transaction\x20ID:','Incomplete\x20response:\x20missing\x20data','parse','logWhiteDomainError','created','stringify','statusText','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','merchant_reference_id','/create','TransactionID','Response\x20Time:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','POST','Payment\x20Status:','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','processWebhook','cointopay2','awaiting\x20fiat','Response\x20Body:','logWhiteDomainResponse','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','IBAN:','HTTP\x20Status:','using\x20pattern:','not\x20confirmed','===\x20COINTOPAY2\x20API\x20ERROR\x20===','/status','Status\x20Text:','Status:','Payment\x20System/1.0\x20(CoinToPay2)','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','pending','__esModule','Unknown\x20error','236458glHeXO','PENDING','loggerService','279420RRTikI','EUR','EXPIRED','Headers:'];a64_0x1fa9=function(){return _0x2a93f7;};return a64_0x1fa9();}exports[a64_0x56dce2(0x1c6)]=CoinToPay2Service;