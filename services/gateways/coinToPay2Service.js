'use strict';function a56_0x5cb8(){const _0x2ca4f8=['===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','cointopay2','246720dQbtNE','Payment\x20URL\x20(original):','inputCurrency','Failed\x20to\x20parse\x20JSON\x20response:','entries','parse','coinAddress','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20details:','/status','error','Request\x20Body:','logWhiteDomainRequest','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','toLowerCase','POST','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','log','PENDING','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','EXPIRED','message','source','logWhiteDomainResponse','Parsed\x20Result:','Payment\x20System/1.0\x20(CoinToPay2)','Headers:','stringify','logWhiteDomainError','created','result','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','https://traffer.uk/gateway/cointopay/','Status:','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','/create','now','expired','PaymentDetail','IBAN:','TransactionConfirmedOn','CoinToPay2Service','üìä\x20Status\x20check\x20URL:','paid','Status','text','timeout','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','amount','8145iuWaNe','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','Amount','827227wxoGvv','status_code','__esModule','failed','fromEntries','Response\x20Time:','statusUrl','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Transaction\x20ID:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Incomplete\x20response:\x20missing\x20data','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','22GZhloK','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','9289032PRCgjE','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','CreatedOn','===\x20COINTOPAY2\x20API\x20ERROR\x20===','verifyPayment','not\x20confirmed','===\x20COINTOPAY2\x20SUCCESS\x20===','49eSsHgz','HTTP\x20error!\x20status:\x20','Result:','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','apiUrl','345SnTOOX','pending','data','waiting','status','currency','loggerService','payment_url','2deLwQM','üè¶\x20Extracted\x20IBAN:','Amount:','EUR','Business\x20Error:\x20','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','Gateway\x20Payment\x20ID:','Confirmed\x20On:','Payment\x20URL\x20(modified):','7456HBJzGk','createPaymentLink','../loggerService','checkPaymentStatus','statusText','HTTP\x20Status:','Unknown\x20error','Error\x20message:','Created\x20On:','TransactionID','Status\x20API\x20Error:\x20','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','application/json','https://traffer.uk/gateway/cointopay/status.php','Raw\x20Response\x20Body:','CoinToPay2\x20API\x20error:\x20','PAID','cancelled','awaiting\x20fiat','not\x20found','match','9372twrLyJ','üè¶\x20Payment\x20Detail:','Response\x20Body:','\x20EUR','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','Unknown\x20error\x20from\x20CoinToPay2\x20API','QRCodeURL','205662UgnWbP','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','3572160wldXOd','CoinToPay2\x20payment\x20status\x20check\x20error:','gateway_payment_id'];a56_0x5cb8=function(){return _0x2ca4f8;};return a56_0x5cb8();}const a56_0x2bc162=a56_0x3768;(function(_0x3a854b,_0x375dfd){const _0x4707ab=a56_0x3768,_0x3b3202=_0x3a854b();while(!![]){try{const _0x4e29bc=parseInt(_0x4707ab(0x126))/0x1*(parseInt(_0x4707ab(0xc3))/0x2)+parseInt(_0x4707ab(0xbb))/0x3*(parseInt(_0x4707ab(0xe2))/0x4)+parseInt(_0x4707ab(0xf0))/0x5+parseInt(_0x4707ab(0xe9))/0x6*(parseInt(_0x4707ab(0xb6))/0x7)+parseInt(_0x4707ab(0xcd))/0x8*(-parseInt(_0x4707ab(0x123))/0x9)+parseInt(_0x4707ab(0xeb))/0xa*(-parseInt(_0x4707ab(0xad))/0xb)+parseInt(_0x4707ab(0xaf))/0xc;if(_0x4e29bc===_0x375dfd)break;else _0x3b3202['push'](_0x3b3202['shift']());}catch(_0x53a901){_0x3b3202['push'](_0x3b3202['shift']());}}}(a56_0x5cb8,0x93025));Object['defineProperty'](exports,a56_0x2bc162(0x128),{'value':!![]}),exports[a56_0x2bc162(0x11b)]=void 0x0;function a56_0x3768(_0x23c5d0,_0x42700b){_0x23c5d0=_0x23c5d0-0xa7;const _0x5cb899=a56_0x5cb8();let _0x376889=_0x5cb899[_0x23c5d0];return _0x376889;}const loggerService_1=require(a56_0x2bc162(0xcf));class CoinToPay2Service{constructor(){const _0x522156=a56_0x2bc162;this[_0x522156(0xba)]=_0x522156(0x111),this['statusUrl']=_0x522156(0xda),console['log']('ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0x522156(0x102)](_0x522156(0x11c),this[_0x522156(0x12c)]);}async[a56_0x2bc162(0xce)](_0x39f193){const _0xa8eefd=a56_0x2bc162,{orderId:_0x4bf422,amount:_0x2449a3}=_0x39f193;console[_0xa8eefd(0x102)](_0xa8eefd(0x114)+_0x2449a3+_0xa8eefd(0xe5));const _0x22da7c={'amount':_0x2449a3},_0x65e051=Date[_0xa8eefd(0x116)]();try{console[_0xa8eefd(0x102)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console['log']('URL:',this[_0xa8eefd(0xba)]),console[_0xa8eefd(0x102)](_0xa8eefd(0xfb),JSON[_0xa8eefd(0x10c)](_0x22da7c,null,0x2)),console[_0xa8eefd(0x102)](_0xa8eefd(0xc5),_0x2449a3,_0xa8eefd(0xe6)),loggerService_1[_0xa8eefd(0xc1)][_0xa8eefd(0xfc)](_0xa8eefd(0xef),_0xa8eefd(0x115),_0xa8eefd(0xff),_0x22da7c);const _0x3f2649=await fetch(this[_0xa8eefd(0xba)],{'method':_0xa8eefd(0xff),'headers':{'Content-Type':_0xa8eefd(0xd9),'Accept':_0xa8eefd(0xd9),'User-Agent':_0xa8eefd(0x10a)},'body':JSON[_0xa8eefd(0x10c)](_0x22da7c)}),_0x522c99=Date['now']()-_0x65e051;console['log'](_0xa8eefd(0x113)),console['log'](_0xa8eefd(0x112),_0x3f2649['status']),console[_0xa8eefd(0x102)]('Status\x20Text:',_0x3f2649[_0xa8eefd(0xd1)]),console[_0xa8eefd(0x102)](_0xa8eefd(0x10b),Object[_0xa8eefd(0x12a)](_0x3f2649['headers'][_0xa8eefd(0xf4)]())),console['log'](_0xa8eefd(0x12b),_0x522c99+'ms');const _0x53661a=await _0x3f2649[_0xa8eefd(0x11f)]();console[_0xa8eefd(0x102)](_0xa8eefd(0xdb),_0x53661a);if(!_0x3f2649['ok']){console['error'](_0xa8eefd(0xb2)),console[_0xa8eefd(0xfa)](_0xa8eefd(0xd2),_0x3f2649['status']),console[_0xa8eefd(0xfa)](_0xa8eefd(0xe4),_0x53661a),loggerService_1[_0xa8eefd(0xc1)][_0xa8eefd(0x108)](_0xa8eefd(0xef),_0xa8eefd(0x115),_0x3f2649[_0xa8eefd(0xbf)],_0x53661a,_0x522c99),loggerService_1['loggerService'][_0xa8eefd(0x10d)](_0xa8eefd(0xef),_0xa8eefd(0x115),'HTTP\x20'+_0x3f2649['status']+':\x20'+_0x53661a);throw new Error(_0xa8eefd(0xb7)+_0x3f2649[_0xa8eefd(0xbf)]+',\x20body:\x20'+_0x53661a);}let _0x3da4ba;try{_0x3da4ba=JSON[_0xa8eefd(0xf5)](_0x53661a);}catch(_0x23a098){console['error'](_0xa8eefd(0xf3),_0x23a098),loggerService_1[_0xa8eefd(0xc1)]['logWhiteDomainError']('cointopay2',_0xa8eefd(0x115),'JSON\x20Parse\x20Error:\x20'+_0x23a098);throw new Error(_0xa8eefd(0xae)+_0x53661a);}console['log']('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console['log'](_0xa8eefd(0x109),JSON[_0xa8eefd(0x10c)](_0x3da4ba,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0xa8eefd(0xef),_0xa8eefd(0x115),_0x3f2649[_0xa8eefd(0xbf)],_0x3da4ba,_0x522c99);if(_0x3da4ba['error']){const _0x5df94a=_0x3da4ba[_0xa8eefd(0x106)]||_0x3da4ba[_0xa8eefd(0xfa)]||_0xa8eefd(0xe7);console[_0xa8eefd(0xfa)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x5df94a),loggerService_1[_0xa8eefd(0xc1)]['logWhiteDomainError'](_0xa8eefd(0xef),'/create',_0xa8eefd(0xc7)+_0x5df94a);throw new Error(_0xa8eefd(0xdc)+_0x5df94a);}if(!_0x3da4ba[_0xa8eefd(0xc2)]||!_0x3da4ba[_0xa8eefd(0xed)]){console[_0xa8eefd(0xfa)](_0xa8eefd(0xf7)),console[_0xa8eefd(0xfa)](_0xa8eefd(0xa9)),console[_0xa8eefd(0xfa)]('Response\x20data:',_0x3da4ba),loggerService_1[_0xa8eefd(0xc1)][_0xa8eefd(0x10d)](_0xa8eefd(0xef),_0xa8eefd(0x115),_0xa8eefd(0xac));throw new Error(_0xa8eefd(0xea));}console[_0xa8eefd(0x102)](_0xa8eefd(0xb5)),console[_0xa8eefd(0x102)](_0xa8eefd(0xca),_0x3da4ba['gateway_payment_id']),console[_0xa8eefd(0x102)](_0xa8eefd(0xf1),_0x3da4ba[_0xa8eefd(0xc2)]);const _0x5667ca=_0x3da4ba[_0xa8eefd(0xc2)]+'&alternative=false';return console[_0xa8eefd(0x102)](_0xa8eefd(0xcc),_0x5667ca),console[_0xa8eefd(0x102)](_0xa8eefd(0xc5),_0x2449a3,_0xa8eefd(0xc6)),{'gateway_payment_id':_0x3da4ba[_0xa8eefd(0xed)],'payment_url':_0x5667ca};}catch(_0x3d3635){console['error'](_0xa8eefd(0x121)),console['error'](_0xa8eefd(0xf8),_0x3d3635),loggerService_1[_0xa8eefd(0xc1)][_0xa8eefd(0x10d)](_0xa8eefd(0xef),_0xa8eefd(0x115),_0x3d3635);if(_0x3d3635 instanceof Error){console[_0xa8eefd(0xfa)](_0xa8eefd(0xd4),_0x3d3635[_0xa8eefd(0x106)]),console[_0xa8eefd(0xfa)]('Error\x20stack:',_0x3d3635['stack']);throw new Error(_0xa8eefd(0x110)+_0x3d3635[_0xa8eefd(0x106)]);}throw new Error(_0xa8eefd(0xa8));}}async[a56_0x2bc162(0xd0)](_0x2f0934){const _0x51e75b=a56_0x2bc162,_0x5eda4c=Date['now']();try{console[_0x51e75b(0x102)](_0x51e75b(0xab)+_0x2f0934);const _0xc7037b={'gatewayPaymentId':_0x2f0934};loggerService_1[_0x51e75b(0xc1)]['logWhiteDomainRequest'](_0x51e75b(0xef),_0x51e75b(0xf9),_0x51e75b(0xff),_0xc7037b);const _0x3e1c33=await fetch(this[_0x51e75b(0x12c)],{'method':_0x51e75b(0xff),'headers':{'Content-Type':_0x51e75b(0xd9),'Accept':_0x51e75b(0xd9),'User-Agent':_0x51e75b(0x10a)},'body':JSON[_0x51e75b(0x10c)](_0xc7037b)}),_0x4ef7fd=Date['now']()-_0x5eda4c;console[_0x51e75b(0x102)](_0x51e75b(0xc8)),console[_0x51e75b(0x102)](_0x51e75b(0x112),_0x3e1c33['status']),console[_0x51e75b(0x102)](_0x51e75b(0x12b),_0x4ef7fd+'ms');if(!_0x3e1c33['ok']){const _0x69542c=await _0x3e1c33['text']();console['error']('HTTP\x20Status:',_0x3e1c33[_0x51e75b(0xbf)]),console['error'](_0x51e75b(0xe4),_0x69542c),loggerService_1[_0x51e75b(0xc1)][_0x51e75b(0x108)](_0x51e75b(0xef),_0x51e75b(0xf9),_0x3e1c33[_0x51e75b(0xbf)],_0x69542c,_0x4ef7fd),loggerService_1[_0x51e75b(0xc1)][_0x51e75b(0x10d)](_0x51e75b(0xef),_0x51e75b(0xf9),'HTTP\x20'+_0x3e1c33['status']+':\x20'+_0x69542c);throw new Error(_0x51e75b(0xb7)+_0x3e1c33[_0x51e75b(0xbf)]);}const _0x44ee89=await _0x3e1c33[_0x51e75b(0x11f)]();console['log'](_0x51e75b(0xdb),_0x44ee89);let _0xdfa3b8;try{_0xdfa3b8=JSON[_0x51e75b(0xf5)](_0x44ee89);}catch(_0x22ab5a){console[_0x51e75b(0xfa)](_0x51e75b(0xf3),_0x22ab5a),loggerService_1[_0x51e75b(0xc1)]['logWhiteDomainError']('cointopay2',_0x51e75b(0xf9),'JSON\x20Parse\x20Error:\x20'+_0x22ab5a);throw new Error(_0x51e75b(0x104)+_0x44ee89);}loggerService_1['loggerService']['logWhiteDomainResponse'](_0x51e75b(0xef),_0x51e75b(0xf9),_0x3e1c33[_0x51e75b(0xbf)],_0xdfa3b8,_0x4ef7fd),console[_0x51e75b(0x102)](_0x51e75b(0xc9)),console[_0x51e75b(0x102)](_0x51e75b(0xb8),_0xdfa3b8[_0x51e75b(0x10f)]),console[_0x51e75b(0x102)]('Status\x20Code:',_0xdfa3b8['status_code']),console[_0x51e75b(0x102)]('Payment\x20Status:',_0xdfa3b8['data']?.[_0x51e75b(0x11e)]),console['log']('Amount:',_0xdfa3b8[_0x51e75b(0xbd)]?.['Amount']),console['log']('Currency:',_0xdfa3b8[_0x51e75b(0xbd)]?.[_0x51e75b(0xf2)]);if(_0xdfa3b8[_0x51e75b(0x10f)]!=='success'||_0xdfa3b8[_0x51e75b(0x127)]!==0xc8){const _0x2445a0=_0xdfa3b8['message']||_0x51e75b(0x100);console[_0x51e75b(0xfa)](_0x51e75b(0xee)),console['error']('Error\x20Message:',_0x2445a0),loggerService_1[_0x51e75b(0xc1)][_0x51e75b(0x10d)](_0x51e75b(0xef),_0x51e75b(0xf9),_0x51e75b(0xd7)+_0x2445a0);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0x2445a0);}if(!_0xdfa3b8[_0x51e75b(0xbd)]){console[_0x51e75b(0xfa)](_0x51e75b(0x12d)),console[_0x51e75b(0xfa)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x51e75b(0xc1)]['logWhiteDomainError']('cointopay2','/status',_0x51e75b(0xaa));throw new Error(_0x51e75b(0x101));}let _0x1974c7=_0x51e75b(0x103);switch(_0xdfa3b8[_0x51e75b(0xbd)]['Status']?.[_0x51e75b(0xfe)]()){case'paid':_0x1974c7=_0x51e75b(0xdd);break;case'cancelled':case'failed':case _0x51e75b(0xfa):_0x1974c7='FAILED';break;case _0x51e75b(0x117):case _0x51e75b(0x120):_0x1974c7=_0x51e75b(0x105);break;case _0x51e75b(0xbe):case _0x51e75b(0xdf):case _0x51e75b(0xbc):case _0x51e75b(0x10e):default:_0x1974c7=_0x51e75b(0x103);break;}let _0x4b4a93,_0x41d536;if(_0xdfa3b8['data'][_0x51e75b(0x118)]){const _0x357dee=_0xdfa3b8[_0x51e75b(0xbd)][_0x51e75b(0x118)];console[_0x51e75b(0x102)](_0x51e75b(0xe3),_0x357dee);const _0x154b5a=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x1333f7 of _0x154b5a){const _0x503f60=_0x357dee[_0x51e75b(0xe1)](_0x1333f7);if(_0x503f60){_0x4b4a93=_0x503f60[0x1],console[_0x51e75b(0x102)](_0x51e75b(0xc4),_0x4b4a93,'using\x20pattern:',_0x1333f7[_0x51e75b(0x107)]);break;}}if(!_0x4b4a93){console[_0x51e75b(0x102)](_0x51e75b(0xb9));const _0x11fc3d=_0x357dee[_0x51e75b(0xe1)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x11fc3d&&(_0x4b4a93=_0x11fc3d[0x1],console[_0x51e75b(0x102)](_0x51e75b(0xfd),_0x4b4a93));}_0x41d536=_0x357dee;}const _0x4c2bdc={'iban':_0x4b4a93,'bankDetails':_0x41d536,'transactionId':_0xdfa3b8['data'][_0x51e75b(0xd6)],'coinAddress':_0xdfa3b8[_0x51e75b(0xbd)][_0x51e75b(0xf6)],'qrCodeUrl':_0xdfa3b8[_0x51e75b(0xbd)][_0x51e75b(0xe8)],'expiryTime':_0xdfa3b8[_0x51e75b(0xbd)]['ExpiryTime'],'createdOn':_0xdfa3b8[_0x51e75b(0xbd)][_0x51e75b(0xb1)],'confirmedOn':_0xdfa3b8[_0x51e75b(0xbd)][_0x51e75b(0x11a)]};console[_0x51e75b(0x102)](_0x51e75b(0xd8)),console['log']('Status:',_0xdfa3b8[_0x51e75b(0xbd)][_0x51e75b(0x11e)],'->',_0x1974c7),console[_0x51e75b(0x102)]('Amount:',_0xdfa3b8[_0x51e75b(0xbd)][_0x51e75b(0x125)],_0xdfa3b8[_0x51e75b(0xbd)][_0x51e75b(0xf2)]),console[_0x51e75b(0x102)](_0x51e75b(0xa7),_0xdfa3b8[_0x51e75b(0xbd)]['TransactionID']),console['log'](_0x51e75b(0x119),_0x4b4a93||_0x51e75b(0xe0)),console[_0x51e75b(0x102)](_0x51e75b(0xd5),_0xdfa3b8[_0x51e75b(0xbd)][_0x51e75b(0xb1)]),console['log'](_0x51e75b(0xcb),_0xdfa3b8['data']['TransactionConfirmedOn']||_0x51e75b(0xb4));if(_0xdfa3b8[_0x51e75b(0xbd)][_0x51e75b(0x11e)]?.[_0x51e75b(0xfe)]()==='awaiting\x20fiat')console[_0x51e75b(0x102)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0xdfa3b8['data']['Status']?.['toLowerCase']()===_0x51e75b(0x11d)&&console[_0x51e75b(0x102)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x1974c7,'amount':parseFloat(_0xdfa3b8[_0x51e75b(0xbd)][_0x51e75b(0x125)])||undefined,'currency':_0xdfa3b8['data']['inputCurrency']||_0x51e75b(0xc6),'paymentDetails':_0x4c2bdc};}catch(_0x593312){console[_0x51e75b(0xfa)](_0x51e75b(0xec),_0x593312),loggerService_1[_0x51e75b(0xc1)]['logWhiteDomainError'](_0x51e75b(0xef),'/status',_0x593312);throw new Error(_0x51e75b(0x124)+(_0x593312 instanceof Error?_0x593312[_0x51e75b(0x106)]:_0x51e75b(0xd3)));}}async[a56_0x2bc162(0xb3)](_0x238866){const _0x45a554=a56_0x2bc162,_0x2435a0=await this['checkPaymentStatus'](_0x238866);return{'status':_0x2435a0[_0x45a554(0xbf)],'amount':_0x2435a0['amount'],'currency':_0x2435a0[_0x45a554(0xc0)]};}async['processWebhook'](_0x2a82ea){const _0x2c3b42=a56_0x2bc162;console[_0x2c3b42(0x102)](_0x2c3b42(0xb0),_0x2a82ea);let _0x4f27ce='PENDING';switch(_0x2a82ea[_0x2c3b42(0xbf)]?.[_0x2c3b42(0xfe)]()){case'paid':_0x4f27ce=_0x2c3b42(0xdd);break;case _0x2c3b42(0xde):case _0x2c3b42(0x129):case'error':_0x4f27ce='FAILED';break;case _0x2c3b42(0x117):case _0x2c3b42(0x120):_0x4f27ce=_0x2c3b42(0x105);break;case _0x2c3b42(0xbc):case'waiting':case'awaiting\x20fiat':case _0x2c3b42(0x10e):default:_0x4f27ce=_0x2c3b42(0x103);break;}return{'paymentId':_0x2a82ea['order_id']||_0x2a82ea['merchant_reference_id']||'','status':_0x4f27ce,'amount':_0x2a82ea[_0x2c3b42(0x122)],'currency':_0x2a82ea[_0x2c3b42(0xc0)]||'EUR'};}}exports[a56_0x2bc162(0x11b)]=CoinToPay2Service;