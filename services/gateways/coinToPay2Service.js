'use strict';const a40_0x2ec9eb=a40_0x19fd;(function(_0x5f3290,_0x1b05a4){const _0x55b164=a40_0x19fd,_0x2b69e5=_0x5f3290();while(!![]){try{const _0x2e4b24=-parseInt(_0x55b164(0x204))/0x1*(-parseInt(_0x55b164(0x266))/0x2)+parseInt(_0x55b164(0x242))/0x3*(parseInt(_0x55b164(0x22b))/0x4)+-parseInt(_0x55b164(0x25d))/0x5*(parseInt(_0x55b164(0x218))/0x6)+-parseInt(_0x55b164(0x265))/0x7*(-parseInt(_0x55b164(0x223))/0x8)+parseInt(_0x55b164(0x21f))/0x9*(parseInt(_0x55b164(0x23b))/0xa)+parseInt(_0x55b164(0x215))/0xb+-parseInt(_0x55b164(0x23d))/0xc;if(_0x2e4b24===_0x1b05a4)break;else _0x2b69e5['push'](_0x2b69e5['shift']());}catch(_0x5bae79){_0x2b69e5['push'](_0x2b69e5['shift']());}}}(a40_0x1ca9,0xda887));function a40_0x19fd(_0x32bfbb,_0x3adccc){const _0x1ca92e=a40_0x1ca9();return a40_0x19fd=function(_0x19fd70,_0x112013){_0x19fd70=_0x19fd70-0x1ee;let _0x344b9a=_0x1ca92e[_0x19fd70];return _0x344b9a;},a40_0x19fd(_0x32bfbb,_0x3adccc);}Object[a40_0x2ec9eb(0x1fc)](exports,a40_0x2ec9eb(0x239),{'value':!![]}),exports[a40_0x2ec9eb(0x20a)]=void 0x0;const loggerService_1=require(a40_0x2ec9eb(0x27a));function a40_0x1ca9(){const _0x59e67b=['===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','CoinToPay2\x20API\x20error:\x20','../loggerService','paid','Confirmed\x20On:','log','Response\x20Body:','merchant_reference_id','TransactionConfirmedOn','verifyPayment','Error\x20Message:','now','CoinToPay2\x20status\x20API\x20error:\x20','stack','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','processWebhook','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','PaymentDetail','CoinToPay2\x20payment\x20status\x20check\x20error:','statusText','currency','defineProperty','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','match','===\x20COINTOPAY2\x20API\x20ERROR\x20===','POST','Transaction\x20ID:','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','Error\x20message:','91693tEVaCB','loggerService','Response\x20Time:','headers','payment_url','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','CoinToPay2Service','status','status_code','coinAddress','toLowerCase','application/json','HTTP\x20error!\x20status:\x20','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','/create','===\x20COINTOPAY2\x20SUCCESS\x20===','JSON\x20Parse\x20Error:\x20','17581674WwzldQ','ExpiryTime','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','4548bmOJqx','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20',',\x20body:\x20','Error\x20stack:','checkPaymentStatus','apiUrl','Status','89307YUsaCe','https://traffer.uk/gateway/cointopay/','Unknown\x20error\x20from\x20CoinToPay2\x20API','not\x20found','163472BCIAer','expired','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','https://traffer.uk/gateway/cointopay/status.php','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','\x20EUR','Result:','parse','794008WXqoLg','üìä\x20Status\x20check\x20URL:','success','logWhiteDomainResponse','Parsed\x20Result:','QRCodeURL','order_id','amount','cancelled','Status\x20API\x20Error:\x20','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','CreatedOn','Status:','Response\x20data:','__esModule','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','170ePUikk','Incomplete\x20response:\x20missing\x20data','19232100OvQPsm','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','result','inputCurrency','Business\x20Error:\x20','15VDlhpF','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','Failed\x20to\x20parse\x20JSON\x20response:','waiting','logWhiteDomainError','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','not\x20confirmed','IBAN:','failed','Missing\x20data\x20in\x20response','fromEntries','Payment\x20URL:','created','Payment\x20Status:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','statusUrl','message','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','üè¶\x20Payment\x20Detail:','/status','TransactionID','PAID','HTTP\x20','cointopay2','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','error','6230ySfmWQ','text','Status\x20Text:','gateway_payment_id','pending','data','URL:','PENDING','14lUnRok','14NHmKAS','FAILED','timeout','HTTP\x20Status:','Created\x20On:','Error\x20details:','Status\x20Code:','Amount:','awaiting\x20fiat','EXPIRED','EUR','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Currency:','Headers:','Raw\x20Response\x20Body:','logWhiteDomainRequest','stringify','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id'];a40_0x1ca9=function(){return _0x59e67b;};return a40_0x1ca9();}class CoinToPay2Service{constructor(){const _0x38b73d=a40_0x2ec9eb;this[_0x38b73d(0x21d)]=_0x38b73d(0x220),this['statusUrl']=_0x38b73d(0x226),console[_0x38b73d(0x27d)](_0x38b73d(0x202)),console[_0x38b73d(0x27d)](_0x38b73d(0x22c),this[_0x38b73d(0x252)]);}async['createPaymentLink'](_0x10be68){const _0x480112=a40_0x2ec9eb,{orderId:_0x58ba2c,amount:_0x1afcd6}=_0x10be68;console[_0x480112(0x27d)](_0x480112(0x219)+_0x1afcd6+_0x480112(0x228));const _0x4597c6={'amount':_0x1afcd6},_0x5136a0=Date[_0x480112(0x1f2)]();try{console['log'](_0x480112(0x227)),console[_0x480112(0x27d)](_0x480112(0x263),this['apiUrl']),console['log']('Request\x20Body:',JSON['stringify'](_0x4597c6,null,0x2)),console['log'](_0x480112(0x26d),_0x1afcd6,_0x480112(0x209)),loggerService_1[_0x480112(0x205)][_0x480112(0x275)](_0x480112(0x25a),'/create','POST',_0x4597c6);const _0x118640=await fetch(this[_0x480112(0x21d)],{'method':'POST','headers':{'Content-Type':_0x480112(0x20f),'Accept':_0x480112(0x20f),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x480112(0x276)](_0x4597c6)}),_0x92ffad=Date[_0x480112(0x1f2)]()-_0x5136a0;console[_0x480112(0x27d)](_0x480112(0x235)),console[_0x480112(0x27d)]('Status:',_0x118640['status']),console[_0x480112(0x27d)](_0x480112(0x25f),_0x118640[_0x480112(0x1fa)]),console[_0x480112(0x27d)](_0x480112(0x273),Object[_0x480112(0x24c)](_0x118640[_0x480112(0x207)]['entries']())),console[_0x480112(0x27d)](_0x480112(0x206),_0x92ffad+'ms');const _0x536d39=await _0x118640[_0x480112(0x25e)]();console['log'](_0x480112(0x274),_0x536d39);if(!_0x118640['ok']){console[_0x480112(0x25c)](_0x480112(0x1ff)),console[_0x480112(0x25c)](_0x480112(0x269),_0x118640[_0x480112(0x20b)]),console['error'](_0x480112(0x27e),_0x536d39),loggerService_1[_0x480112(0x205)][_0x480112(0x22e)](_0x480112(0x25a),_0x480112(0x212),_0x118640[_0x480112(0x20b)],_0x536d39,_0x92ffad),loggerService_1[_0x480112(0x205)][_0x480112(0x246)](_0x480112(0x25a),_0x480112(0x212),_0x480112(0x259)+_0x118640['status']+':\x20'+_0x536d39);throw new Error(_0x480112(0x210)+_0x118640[_0x480112(0x20b)]+_0x480112(0x21a)+_0x536d39);}let _0xfbe485;try{_0xfbe485=JSON[_0x480112(0x22a)](_0x536d39);}catch(_0x4e2ab7){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x4e2ab7),loggerService_1[_0x480112(0x205)][_0x480112(0x246)](_0x480112(0x25a),_0x480112(0x212),_0x480112(0x214)+_0x4e2ab7);throw new Error(_0x480112(0x251)+_0x536d39);}console[_0x480112(0x27d)](_0x480112(0x250)),console[_0x480112(0x27d)](_0x480112(0x22f),JSON[_0x480112(0x276)](_0xfbe485,null,0x2)),loggerService_1[_0x480112(0x205)][_0x480112(0x22e)](_0x480112(0x25a),_0x480112(0x212),_0x118640[_0x480112(0x20b)],_0xfbe485,_0x92ffad);if(_0xfbe485[_0x480112(0x25c)]){const _0x35d6b3=_0xfbe485[_0x480112(0x253)]||_0xfbe485['error']||_0x480112(0x221);console['error'](_0x480112(0x23a)),console['error']('Error\x20Message:',_0x35d6b3),loggerService_1[_0x480112(0x205)][_0x480112(0x246)](_0x480112(0x25a),'/create',_0x480112(0x241)+_0x35d6b3);throw new Error(_0x480112(0x279)+_0x35d6b3);}if(!_0xfbe485['payment_url']||!_0xfbe485[_0x480112(0x260)]){console['error']('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x480112(0x25c)](_0x480112(0x247)),console[_0x480112(0x25c)](_0x480112(0x238),_0xfbe485),loggerService_1[_0x480112(0x205)][_0x480112(0x246)]('cointopay2',_0x480112(0x212),_0x480112(0x277));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console['log'](_0x480112(0x213)),console['log']('Gateway\x20Payment\x20ID:',_0xfbe485[_0x480112(0x260)]),console[_0x480112(0x27d)](_0x480112(0x24d),_0xfbe485['payment_url']),console[_0x480112(0x27d)](_0x480112(0x26d),_0x1afcd6,_0x480112(0x270)),{'gateway_payment_id':_0xfbe485[_0x480112(0x260)],'payment_url':_0xfbe485[_0x480112(0x208)]};}catch(_0x4bbab3){console[_0x480112(0x25c)](_0x480112(0x243)),console['error'](_0x480112(0x26b),_0x4bbab3),loggerService_1[_0x480112(0x205)][_0x480112(0x246)](_0x480112(0x25a),'/create',_0x4bbab3);if(_0x4bbab3 instanceof Error){console['error'](_0x480112(0x203),_0x4bbab3['message']),console['error'](_0x480112(0x21b),_0x4bbab3[_0x480112(0x1f4)]);throw new Error(_0x480112(0x211)+_0x4bbab3[_0x480112(0x253)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x2ec9eb(0x21c)](_0x5142ef){const _0x39ccfe=a40_0x2ec9eb,_0x2b4f97=Date[_0x39ccfe(0x1f2)]();try{console[_0x39ccfe(0x27d)](_0x39ccfe(0x25b)+_0x5142ef);const _0x1493f1={'gatewayPaymentId':_0x5142ef};loggerService_1[_0x39ccfe(0x205)][_0x39ccfe(0x275)](_0x39ccfe(0x25a),_0x39ccfe(0x256),_0x39ccfe(0x200),_0x1493f1);const _0x4ce818=await fetch(this[_0x39ccfe(0x252)],{'method':'POST','headers':{'Content-Type':_0x39ccfe(0x20f),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x39ccfe(0x276)](_0x1493f1)}),_0x586f17=Date[_0x39ccfe(0x1f2)]()-_0x2b4f97;console[_0x39ccfe(0x27d)](_0x39ccfe(0x23e)),console['log']('Status:',_0x4ce818['status']),console[_0x39ccfe(0x27d)](_0x39ccfe(0x206),_0x586f17+'ms');if(!_0x4ce818['ok']){const _0x5b2fcc=await _0x4ce818[_0x39ccfe(0x25e)]();console[_0x39ccfe(0x25c)](_0x39ccfe(0x269),_0x4ce818[_0x39ccfe(0x20b)]),console[_0x39ccfe(0x25c)](_0x39ccfe(0x27e),_0x5b2fcc),loggerService_1['loggerService'][_0x39ccfe(0x22e)](_0x39ccfe(0x25a),_0x39ccfe(0x256),_0x4ce818[_0x39ccfe(0x20b)],_0x5b2fcc,_0x586f17),loggerService_1[_0x39ccfe(0x205)]['logWhiteDomainError'](_0x39ccfe(0x25a),'/status',_0x39ccfe(0x259)+_0x4ce818[_0x39ccfe(0x20b)]+':\x20'+_0x5b2fcc);throw new Error(_0x39ccfe(0x210)+_0x4ce818[_0x39ccfe(0x20b)]);}const _0x4e2f34=await _0x4ce818[_0x39ccfe(0x25e)]();console[_0x39ccfe(0x27d)]('Raw\x20Response\x20Body:',_0x4e2f34);let _0x487946;try{_0x487946=JSON[_0x39ccfe(0x22a)](_0x4e2f34);}catch(_0x209c69){console['error'](_0x39ccfe(0x244),_0x209c69),loggerService_1[_0x39ccfe(0x205)][_0x39ccfe(0x246)](_0x39ccfe(0x25a),_0x39ccfe(0x256),'JSON\x20Parse\x20Error:\x20'+_0x209c69);throw new Error(_0x39ccfe(0x217)+_0x4e2f34);}loggerService_1[_0x39ccfe(0x205)][_0x39ccfe(0x22e)](_0x39ccfe(0x25a),'/status',_0x4ce818[_0x39ccfe(0x20b)],_0x487946,_0x586f17),console[_0x39ccfe(0x27d)](_0x39ccfe(0x278)),console['log'](_0x39ccfe(0x229),_0x487946[_0x39ccfe(0x23f)]),console['log'](_0x39ccfe(0x26c),_0x487946['status_code']),console['log'](_0x39ccfe(0x24f),_0x487946[_0x39ccfe(0x262)]?.['Status']),console[_0x39ccfe(0x27d)](_0x39ccfe(0x26d),_0x487946[_0x39ccfe(0x262)]?.['Amount']),console[_0x39ccfe(0x27d)](_0x39ccfe(0x272),_0x487946['data']?.[_0x39ccfe(0x240)]);if(_0x487946[_0x39ccfe(0x23f)]!==_0x39ccfe(0x22d)||_0x487946[_0x39ccfe(0x20c)]!==0xc8){const _0x4d94d6=_0x487946['message']||_0x39ccfe(0x271);console[_0x39ccfe(0x25c)]('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console[_0x39ccfe(0x25c)](_0x39ccfe(0x1f1),_0x4d94d6),loggerService_1[_0x39ccfe(0x205)]['logWhiteDomainError'](_0x39ccfe(0x25a),_0x39ccfe(0x256),_0x39ccfe(0x234)+_0x4d94d6);throw new Error(_0x39ccfe(0x1f3)+_0x4d94d6);}if(!_0x487946[_0x39ccfe(0x262)]){console[_0x39ccfe(0x25c)](_0x39ccfe(0x1fd)),console[_0x39ccfe(0x25c)](_0x39ccfe(0x24b)),loggerService_1[_0x39ccfe(0x205)][_0x39ccfe(0x246)](_0x39ccfe(0x25a),_0x39ccfe(0x256),_0x39ccfe(0x23c));throw new Error(_0x39ccfe(0x254));}let _0x28c546='PENDING';switch(_0x487946[_0x39ccfe(0x262)]['Status']?.['toLowerCase']()){case _0x39ccfe(0x27b):_0x28c546='PAID';break;case _0x39ccfe(0x233):case'failed':case _0x39ccfe(0x25c):_0x28c546=_0x39ccfe(0x267);break;case _0x39ccfe(0x224):case _0x39ccfe(0x268):_0x28c546=_0x39ccfe(0x26f);break;case _0x39ccfe(0x245):case _0x39ccfe(0x26e):case _0x39ccfe(0x261):case'created':default:_0x28c546=_0x39ccfe(0x264);break;}let _0x2d4305,_0x3e7f4e;if(_0x487946[_0x39ccfe(0x262)][_0x39ccfe(0x1f8)]){const _0x48fa53=_0x487946['data'][_0x39ccfe(0x1f8)];console[_0x39ccfe(0x27d)](_0x39ccfe(0x255),_0x48fa53);const _0x3a5fde=_0x48fa53[_0x39ccfe(0x1fe)](/IBAN\s+([A-Z0-9]+)/i);_0x3a5fde&&(_0x2d4305=_0x3a5fde[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0x2d4305)),_0x3e7f4e=_0x48fa53;}const _0x2ac715={'iban':_0x2d4305,'bankDetails':_0x3e7f4e,'transactionId':_0x487946[_0x39ccfe(0x262)][_0x39ccfe(0x257)],'coinAddress':_0x487946['data'][_0x39ccfe(0x20d)],'qrCodeUrl':_0x487946['data'][_0x39ccfe(0x230)],'expiryTime':_0x487946[_0x39ccfe(0x262)][_0x39ccfe(0x216)],'createdOn':_0x487946[_0x39ccfe(0x262)]['CreatedOn'],'confirmedOn':_0x487946[_0x39ccfe(0x262)]['TransactionConfirmedOn']};console['log'](_0x39ccfe(0x1f5)),console[_0x39ccfe(0x27d)](_0x39ccfe(0x237),_0x487946[_0x39ccfe(0x262)][_0x39ccfe(0x21e)],'->',_0x28c546),console[_0x39ccfe(0x27d)](_0x39ccfe(0x26d),_0x487946[_0x39ccfe(0x262)]['Amount'],_0x487946['data'][_0x39ccfe(0x240)]),console[_0x39ccfe(0x27d)](_0x39ccfe(0x201),_0x487946[_0x39ccfe(0x262)][_0x39ccfe(0x257)]),console[_0x39ccfe(0x27d)](_0x39ccfe(0x249),_0x2d4305||_0x39ccfe(0x222)),console['log'](_0x39ccfe(0x26a),_0x487946[_0x39ccfe(0x262)][_0x39ccfe(0x236)]),console[_0x39ccfe(0x27d)](_0x39ccfe(0x27c),_0x487946['data'][_0x39ccfe(0x1ef)]||_0x39ccfe(0x248));if(_0x487946[_0x39ccfe(0x262)][_0x39ccfe(0x21e)]?.[_0x39ccfe(0x20e)]()===_0x39ccfe(0x26e))console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x487946[_0x39ccfe(0x262)][_0x39ccfe(0x21e)]?.[_0x39ccfe(0x20e)]()===_0x39ccfe(0x27b)&&console[_0x39ccfe(0x27d)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x28c546,'amount':parseFloat(_0x487946[_0x39ccfe(0x262)]['Amount'])||undefined,'currency':_0x487946[_0x39ccfe(0x262)]['inputCurrency']||_0x39ccfe(0x270),'paymentDetails':_0x2ac715};}catch(_0xb2bfcd){console[_0x39ccfe(0x25c)](_0x39ccfe(0x1f9),_0xb2bfcd),loggerService_1[_0x39ccfe(0x205)][_0x39ccfe(0x246)](_0x39ccfe(0x25a),_0x39ccfe(0x256),_0xb2bfcd);throw new Error(_0x39ccfe(0x225)+(_0xb2bfcd instanceof Error?_0xb2bfcd[_0x39ccfe(0x253)]:'Unknown\x20error'));}}async[a40_0x2ec9eb(0x1f0)](_0x41fdf1){const _0x2073c2=a40_0x2ec9eb,_0x15cbf1=await this[_0x2073c2(0x21c)](_0x41fdf1);return{'status':_0x15cbf1[_0x2073c2(0x20b)],'amount':_0x15cbf1[_0x2073c2(0x232)],'currency':_0x15cbf1[_0x2073c2(0x1fb)]};}async[a40_0x2ec9eb(0x1f6)](_0x4725bb){const _0x39bf17=a40_0x2ec9eb;console[_0x39bf17(0x27d)](_0x39bf17(0x1f7),_0x4725bb);let _0x1d5a2b=_0x39bf17(0x264);switch(_0x4725bb[_0x39bf17(0x20b)]?.[_0x39bf17(0x20e)]()){case _0x39bf17(0x27b):_0x1d5a2b=_0x39bf17(0x258);break;case _0x39bf17(0x233):case _0x39bf17(0x24a):case'error':_0x1d5a2b=_0x39bf17(0x267);break;case _0x39bf17(0x224):case _0x39bf17(0x268):_0x1d5a2b='EXPIRED';break;case _0x39bf17(0x261):case _0x39bf17(0x245):case _0x39bf17(0x26e):case _0x39bf17(0x24e):default:_0x1d5a2b=_0x39bf17(0x264);break;}return{'paymentId':_0x4725bb[_0x39bf17(0x231)]||_0x4725bb[_0x39bf17(0x1ee)]||'','status':_0x1d5a2b,'amount':_0x4725bb[_0x39bf17(0x232)],'currency':_0x4725bb[_0x39bf17(0x1fb)]||_0x39bf17(0x270)};}}exports[a40_0x2ec9eb(0x20a)]=CoinToPay2Service;