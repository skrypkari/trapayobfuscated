'use strict';const a58_0x1c8f1f=a58_0x33c8;(function(_0x30188a,_0x351e5c){const _0x463813=a58_0x33c8,_0x3551ba=_0x30188a();while(!![]){try{const _0x4d963c=parseInt(_0x463813(0x128))/0x1*(-parseInt(_0x463813(0x143))/0x2)+-parseInt(_0x463813(0xf6))/0x3*(parseInt(_0x463813(0x16f))/0x4)+parseInt(_0x463813(0x14e))/0x5*(parseInt(_0x463813(0xfa))/0x6)+parseInt(_0x463813(0x169))/0x7+-parseInt(_0x463813(0x117))/0x8*(parseInt(_0x463813(0x166))/0x9)+-parseInt(_0x463813(0x12c))/0xa*(-parseInt(_0x463813(0x102))/0xb)+-parseInt(_0x463813(0x139))/0xc*(parseInt(_0x463813(0x14d))/0xd);if(_0x4d963c===_0x351e5c)break;else _0x3551ba['push'](_0x3551ba['shift']());}catch(_0x3acb18){_0x3551ba['push'](_0x3551ba['shift']());}}}(a58_0x2e14,0xad5ba));function a58_0x2e14(){const _0x205557=['parse','waiting','441kDMBEk','logWhiteDomainError','Confirmed\x20On:','722680wnaHeJ','order_id','apiUrl','processWebhook','üè¶\x20Extracted\x20IBAN:','FAILED','304232ZDrnHl','pending','Status\x20Code:','Result:','error','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','result','message','text','Status\x20API\x20Error:\x20','expired','PAID','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','JSON\x20Parse\x20Error:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','payment_url','Parsed\x20Result:','https://traffer.uk/gateway/cointopay/','EUR','match','3ZUfUUU','Gateway\x20Payment\x20ID:','\x20EUR','using\x20pattern:','1663734GtGAbc','EXPIRED','Status:','Status','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','not\x20found','QRCodeURL','currency','11jLCOMY','cancelled','Headers:','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Response\x20data:','log','üìä\x20Status\x20check\x20URL:','Response\x20Body:','PENDING','PaymentDetail','IBAN:','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','__esModule','CoinToPay2\x20payment\x20status\x20check\x20error:','Payment\x20URL\x20(original):','verifyPayment','status','headers','coinAddress','89192hTOtnY','&alternative=false','timeout','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','failed','fromEntries','HTTP\x20','Unknown\x20error\x20from\x20CoinToPay2\x20API','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','not\x20confirmed','Error\x20stack:','Amount','Response\x20Time:','source','success','checkPaymentStatus','stack','990741bjcKAk','application/json','Currency:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','11760970YjChCy','logWhiteDomainResponse','POST','../loggerService','cointopay2','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','paid','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','Error\x20message:','now','üè¶\x20Payment\x20Detail:','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','createPaymentLink','783828TtcFMW','status_code','CreatedOn','Incomplete\x20response:\x20missing\x20data','statusUrl','logWhiteDomainRequest','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','Unknown\x20error','/create','2xKrMJo','CoinToPay2\x20status\x20API\x20error:\x20','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','data','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data',',\x20body:\x20','/status','amount','Payment\x20System/1.0\x20(CoinToPay2)','CoinToPay2Service','13uOEOZz','20oYCWTo','loggerService','HTTP\x20Status:','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Transaction\x20ID:','TransactionConfirmedOn','created','CoinToPay2\x20API\x20error:\x20','Raw\x20Response\x20Body:','inputCurrency','awaiting\x20fiat','Amount:','Business\x20Error:\x20','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','TransactionID','Status\x20Text:','stringify','gateway_payment_id','Request\x20Body:','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','toLowerCase','ExpiryTime'];a58_0x2e14=function(){return _0x205557;};return a58_0x2e14();}Object['defineProperty'](exports,a58_0x1c8f1f(0x110),{'value':!![]}),exports[a58_0x1c8f1f(0x14c)]=void 0x0;const loggerService_1=require(a58_0x1c8f1f(0x12f));class CoinToPay2Service{constructor(){const _0x2fb48e=a58_0x1c8f1f;this[_0x2fb48e(0x16b)]=_0x2fb48e(0xf3),this['statusUrl']='https://traffer.uk/gateway/cointopay/status.php',console[_0x2fb48e(0x109)](_0x2fb48e(0x17b)),console[_0x2fb48e(0x109)](_0x2fb48e(0x10a),this[_0x2fb48e(0x13d)]);}async[a58_0x1c8f1f(0x138)](_0x1841c7){const _0x31f139=a58_0x1c8f1f,{orderId:_0x3a3964,amount:_0xa04077}=_0x1841c7;console[_0x31f139(0x109)](_0x31f139(0x11a)+_0xa04077+_0x31f139(0xf8));const _0x15918d={'amount':_0xa04077},_0x10863a=Date[_0x31f139(0x135)]();try{console[_0x31f139(0x109)](_0x31f139(0x17f)),console[_0x31f139(0x109)]('URL:',this['apiUrl']),console['log'](_0x31f139(0x160),JSON[_0x31f139(0x15e)](_0x15918d,null,0x2)),console[_0x31f139(0x109)](_0x31f139(0x159),_0xa04077,_0x31f139(0x17d)),loggerService_1[_0x31f139(0x14f)]['logWhiteDomainRequest']('cointopay2',_0x31f139(0x142),_0x31f139(0x12e),_0x15918d);const _0x562a89=await fetch(this[_0x31f139(0x16b)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x31f139(0x129),'User-Agent':_0x31f139(0x14b)},'body':JSON[_0x31f139(0x15e)](_0x15918d)}),_0x4acf21=Date['now']()-_0x10863a;console['log']('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console[_0x31f139(0x109)](_0x31f139(0xfc),_0x562a89[_0x31f139(0x114)]),console[_0x31f139(0x109)](_0x31f139(0x15d),_0x562a89['statusText']),console['log'](_0x31f139(0x104),Object[_0x31f139(0x11c)](_0x562a89[_0x31f139(0x115)]['entries']())),console[_0x31f139(0x109)](_0x31f139(0x123),_0x4acf21+'ms');const _0x24b20b=await _0x562a89['text']();console[_0x31f139(0x109)](_0x31f139(0x156),_0x24b20b);if(!_0x562a89['ok']){console['error'](_0x31f139(0x107)),console['error']('HTTP\x20Status:',_0x562a89['status']),console[_0x31f139(0x173)](_0x31f139(0x10b),_0x24b20b),loggerService_1[_0x31f139(0x14f)][_0x31f139(0x12d)](_0x31f139(0x130),_0x31f139(0x142),_0x562a89[_0x31f139(0x114)],_0x24b20b,_0x4acf21),loggerService_1[_0x31f139(0x14f)]['logWhiteDomainError'](_0x31f139(0x130),_0x31f139(0x142),_0x31f139(0x11d)+_0x562a89['status']+':\x20'+_0x24b20b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x562a89[_0x31f139(0x114)]+_0x31f139(0x148)+_0x24b20b);}let _0x33951a;try{_0x33951a=JSON[_0x31f139(0x164)](_0x24b20b);}catch(_0x5bcc82){console[_0x31f139(0x173)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5bcc82),loggerService_1[_0x31f139(0x14f)]['logWhiteDomainError'](_0x31f139(0x130),_0x31f139(0x142),_0x31f139(0x17c)+_0x5bcc82);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20'+_0x24b20b);}console[_0x31f139(0x109)]('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console[_0x31f139(0x109)](_0x31f139(0xf2),JSON[_0x31f139(0x15e)](_0x33951a,null,0x2)),loggerService_1[_0x31f139(0x14f)][_0x31f139(0x12d)]('cointopay2',_0x31f139(0x142),_0x562a89[_0x31f139(0x114)],_0x33951a,_0x4acf21);if(_0x33951a['error']){const _0x4f1e7e=_0x33951a['message']||_0x33951a[_0x31f139(0x173)]||_0x31f139(0x11e);console['error']('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x31f139(0x173)]('Error\x20Message:',_0x4f1e7e),loggerService_1[_0x31f139(0x14f)][_0x31f139(0x167)](_0x31f139(0x130),_0x31f139(0x142),_0x31f139(0x15a)+_0x4f1e7e);throw new Error(_0x31f139(0x155)+_0x4f1e7e);}if(!_0x33951a[_0x31f139(0xf1)]||!_0x33951a[_0x31f139(0x15f)]){console['error'](_0x31f139(0x151)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error'](_0x31f139(0x108),_0x33951a),loggerService_1['loggerService']['logWhiteDomainError'](_0x31f139(0x130),_0x31f139(0x142),_0x31f139(0x106));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x31f139(0x109)]('===\x20COINTOPAY2\x20SUCCESS\x20==='),console[_0x31f139(0x109)](_0x31f139(0xf7),_0x33951a['gateway_payment_id']),console[_0x31f139(0x109)](_0x31f139(0x112),_0x33951a[_0x31f139(0xf1)]);const _0xf3e937=_0x33951a['payment_url']+_0x31f139(0x118);return console[_0x31f139(0x109)]('Payment\x20URL\x20(modified):',_0xf3e937),console[_0x31f139(0x109)](_0x31f139(0x159),_0xa04077,'EUR'),{'gateway_payment_id':_0x33951a['gateway_payment_id'],'payment_url':_0xf3e937};}catch(_0x54030c){console[_0x31f139(0x173)]('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x31f139(0x173)]('Error\x20details:',_0x54030c),loggerService_1[_0x31f139(0x14f)][_0x31f139(0x167)]('cointopay2',_0x31f139(0x142),_0x54030c);if(_0x54030c instanceof Error){console[_0x31f139(0x173)](_0x31f139(0x134),_0x54030c['message']),console['error'](_0x31f139(0x121),_0x54030c[_0x31f139(0x127)]);throw new Error(_0x31f139(0x140)+_0x54030c[_0x31f139(0x176)]);}throw new Error(_0x31f139(0x133));}}async[a58_0x1c8f1f(0x126)](_0x7d840a){const _0x1165b5=a58_0x1c8f1f,_0x312501=Date[_0x1165b5(0x135)]();try{console[_0x1165b5(0x109)](_0x1165b5(0x17e)+_0x7d840a);const _0x487804={'gatewayPaymentId':_0x7d840a};loggerService_1[_0x1165b5(0x14f)][_0x1165b5(0x13e)](_0x1165b5(0x130),_0x1165b5(0x149),_0x1165b5(0x12e),_0x487804);const _0x399237=await fetch(this[_0x1165b5(0x13d)],{'method':_0x1165b5(0x12e),'headers':{'Content-Type':_0x1165b5(0x129),'Accept':_0x1165b5(0x129),'User-Agent':_0x1165b5(0x14b)},'body':JSON[_0x1165b5(0x15e)](_0x487804)}),_0x5210b3=Date[_0x1165b5(0x135)]()-_0x312501;console[_0x1165b5(0x109)](_0x1165b5(0x105)),console['log'](_0x1165b5(0xfc),_0x399237[_0x1165b5(0x114)]),console[_0x1165b5(0x109)](_0x1165b5(0x123),_0x5210b3+'ms');if(!_0x399237['ok']){const _0x474c6a=await _0x399237[_0x1165b5(0x177)]();console[_0x1165b5(0x173)](_0x1165b5(0x150),_0x399237[_0x1165b5(0x114)]),console['error']('Response\x20Body:',_0x474c6a),loggerService_1['loggerService'][_0x1165b5(0x12d)]('cointopay2',_0x1165b5(0x149),_0x399237[_0x1165b5(0x114)],_0x474c6a,_0x5210b3),loggerService_1[_0x1165b5(0x14f)][_0x1165b5(0x167)](_0x1165b5(0x130),_0x1165b5(0x149),'HTTP\x20'+_0x399237['status']+':\x20'+_0x474c6a);throw new Error('HTTP\x20error!\x20status:\x20'+_0x399237[_0x1165b5(0x114)]);}const _0x262002=await _0x399237[_0x1165b5(0x177)]();console[_0x1165b5(0x109)](_0x1165b5(0x156),_0x262002);let _0x52d1b8;try{_0x52d1b8=JSON[_0x1165b5(0x164)](_0x262002);}catch(_0x3a7819){console[_0x1165b5(0x173)](_0x1165b5(0x13f),_0x3a7819),loggerService_1[_0x1165b5(0x14f)][_0x1165b5(0x167)](_0x1165b5(0x130),_0x1165b5(0x149),_0x1165b5(0x17c)+_0x3a7819);throw new Error(_0x1165b5(0x12b)+_0x262002);}loggerService_1[_0x1165b5(0x14f)][_0x1165b5(0x12d)](_0x1165b5(0x130),_0x1165b5(0x149),_0x399237['status'],_0x52d1b8,_0x5210b3),console[_0x1165b5(0x109)](_0x1165b5(0xfe)),console['log'](_0x1165b5(0x172),_0x52d1b8[_0x1165b5(0x175)]),console[_0x1165b5(0x109)](_0x1165b5(0x171),_0x52d1b8[_0x1165b5(0x13a)]),console[_0x1165b5(0x109)]('Payment\x20Status:',_0x52d1b8[_0x1165b5(0x146)]?.['Status']),console['log'](_0x1165b5(0x159),_0x52d1b8[_0x1165b5(0x146)]?.['Amount']),console[_0x1165b5(0x109)](_0x1165b5(0x12a),_0x52d1b8[_0x1165b5(0x146)]?.[_0x1165b5(0x157)]);if(_0x52d1b8[_0x1165b5(0x175)]!==_0x1165b5(0x125)||_0x52d1b8['status_code']!==0xc8){const _0x186a51=_0x52d1b8[_0x1165b5(0x176)]||_0x1165b5(0x137);console[_0x1165b5(0x173)](_0x1165b5(0x15b)),console['error']('Error\x20Message:',_0x186a51),loggerService_1[_0x1165b5(0x14f)][_0x1165b5(0x167)](_0x1165b5(0x130),_0x1165b5(0x149),_0x1165b5(0x178)+_0x186a51);throw new Error(_0x1165b5(0x144)+_0x186a51);}if(!_0x52d1b8[_0x1165b5(0x146)]){console[_0x1165b5(0x173)]('===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x1165b5(0x14f)][_0x1165b5(0x167)](_0x1165b5(0x130),'/status',_0x1165b5(0x13c));throw new Error(_0x1165b5(0x147));}let _0x255a9d=_0x1165b5(0x10c);switch(_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0xfd)]?.['toLowerCase']()){case _0x1165b5(0x132):_0x255a9d=_0x1165b5(0x17a);break;case _0x1165b5(0x103):case _0x1165b5(0x11b):case _0x1165b5(0x173):_0x255a9d=_0x1165b5(0x16e);break;case _0x1165b5(0x179):case _0x1165b5(0x119):_0x255a9d=_0x1165b5(0xfb);break;case _0x1165b5(0x165):case _0x1165b5(0x158):case _0x1165b5(0x170):case _0x1165b5(0x154):default:_0x255a9d=_0x1165b5(0x10c);break;}let _0x385e19,_0x4991c9;if(_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0x10d)]){const _0x54f4f2=_0x52d1b8[_0x1165b5(0x146)]['PaymentDetail'];console['log'](_0x1165b5(0x136),_0x54f4f2);const _0x595bc=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x25c140 of _0x595bc){const _0x3544de=_0x54f4f2[_0x1165b5(0xf5)](_0x25c140);if(_0x3544de){_0x385e19=_0x3544de[0x1],console[_0x1165b5(0x109)](_0x1165b5(0x16d),_0x385e19,_0x1165b5(0xf9),_0x25c140[_0x1165b5(0x124)]);break;}}if(!_0x385e19){console[_0x1165b5(0x109)](_0x1165b5(0x10f));const _0x591d7a=_0x54f4f2['match'](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x591d7a&&(_0x385e19=_0x591d7a[0x1],console['log'](_0x1165b5(0x161),_0x385e19));}_0x4991c9=_0x54f4f2;}const _0x50e915={'iban':_0x385e19,'bankDetails':_0x4991c9,'transactionId':_0x52d1b8[_0x1165b5(0x146)]['TransactionID'],'coinAddress':_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0x116)],'qrCodeUrl':_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0x100)],'expiryTime':_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0x163)],'createdOn':_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0x13b)],'confirmedOn':_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0x153)]};console[_0x1165b5(0x109)](_0x1165b5(0x174)),console['log'](_0x1165b5(0xfc),_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0xfd)],'->',_0x255a9d),console[_0x1165b5(0x109)](_0x1165b5(0x159),_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0x122)],_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0x157)]),console[_0x1165b5(0x109)](_0x1165b5(0x152),_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0x15c)]),console['log'](_0x1165b5(0x10e),_0x385e19||_0x1165b5(0xff)),console[_0x1165b5(0x109)]('Created\x20On:',_0x52d1b8[_0x1165b5(0x146)]['CreatedOn']),console['log'](_0x1165b5(0x168),_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0x153)]||_0x1165b5(0x120));if(_0x52d1b8[_0x1165b5(0x146)]['Status']?.[_0x1165b5(0x162)]()===_0x1165b5(0x158))console['log'](_0x1165b5(0x145));else _0x52d1b8[_0x1165b5(0x146)]['Status']?.['toLowerCase']()===_0x1165b5(0x132)&&console[_0x1165b5(0x109)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x255a9d,'amount':parseFloat(_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0x122)])||undefined,'currency':_0x52d1b8[_0x1165b5(0x146)][_0x1165b5(0x157)]||_0x1165b5(0xf4),'paymentDetails':_0x50e915};}catch(_0x4fcbc3){console['error'](_0x1165b5(0x111),_0x4fcbc3),loggerService_1['loggerService']['logWhiteDomainError'](_0x1165b5(0x130),_0x1165b5(0x149),_0x4fcbc3);throw new Error(_0x1165b5(0x11f)+(_0x4fcbc3 instanceof Error?_0x4fcbc3[_0x1165b5(0x176)]:_0x1165b5(0x141)));}}async[a58_0x1c8f1f(0x113)](_0x52940b){const _0x311255=a58_0x1c8f1f,_0x540f9d=await this['checkPaymentStatus'](_0x52940b);return{'status':_0x540f9d[_0x311255(0x114)],'amount':_0x540f9d['amount'],'currency':_0x540f9d[_0x311255(0x101)]};}async[a58_0x1c8f1f(0x16c)](_0x3d8315){const _0x51b1db=a58_0x1c8f1f;console[_0x51b1db(0x109)](_0x51b1db(0x131),_0x3d8315);let _0x520254=_0x51b1db(0x10c);switch(_0x3d8315[_0x51b1db(0x114)]?.[_0x51b1db(0x162)]()){case'paid':_0x520254=_0x51b1db(0x17a);break;case _0x51b1db(0x103):case _0x51b1db(0x11b):case _0x51b1db(0x173):_0x520254=_0x51b1db(0x16e);break;case _0x51b1db(0x179):case _0x51b1db(0x119):_0x520254=_0x51b1db(0xfb);break;case _0x51b1db(0x170):case _0x51b1db(0x165):case _0x51b1db(0x158):case _0x51b1db(0x154):default:_0x520254=_0x51b1db(0x10c);break;}return{'paymentId':_0x3d8315[_0x51b1db(0x16a)]||_0x3d8315['merchant_reference_id']||'','status':_0x520254,'amount':_0x3d8315[_0x51b1db(0x14a)],'currency':_0x3d8315[_0x51b1db(0x101)]||'EUR'};}}function a58_0x33c8(_0xa487e4,_0x503de8){_0xa487e4=_0xa487e4-0xf1;const _0x2e148a=a58_0x2e14();let _0x33c877=_0x2e148a[_0xa487e4];return _0x33c877;}exports['CoinToPay2Service']=CoinToPay2Service;