'use strict';const a42_0x5da3c5=a42_0x41cd;(function(_0xd63679,_0x3871d7){const _0x1d23cf=a42_0x41cd,_0x5f028a=_0xd63679();while(!![]){try{const _0x3cd21c=-parseInt(_0x1d23cf(0x12c))/0x1+-parseInt(_0x1d23cf(0x13f))/0x2*(parseInt(_0x1d23cf(0x173))/0x3)+parseInt(_0x1d23cf(0xf5))/0x4+parseInt(_0x1d23cf(0xf7))/0x5*(parseInt(_0x1d23cf(0x137))/0x6)+-parseInt(_0x1d23cf(0x130))/0x7+parseInt(_0x1d23cf(0x16b))/0x8+-parseInt(_0x1d23cf(0x14f))/0x9*(-parseInt(_0x1d23cf(0x124))/0xa);if(_0x3cd21c===_0x3871d7)break;else _0x5f028a['push'](_0x5f028a['shift']());}catch(_0x2b7394){_0x5f028a['push'](_0x5f028a['shift']());}}}(a42_0x3e76,0x7bb88));Object[a42_0x5da3c5(0x14a)](exports,'__esModule',{'value':!![]}),exports[a42_0x5da3c5(0x114)]=void 0x0;const loggerService_1=require(a42_0x5da3c5(0xfd));function a42_0x41cd(_0x9e0f21,_0x435fec){const _0x3e7644=a42_0x3e76();return a42_0x41cd=function(_0x41cd37,_0x21c8a6){_0x41cd37=_0x41cd37-0xf2;let _0x1bed51=_0x3e7644[_0x41cd37];return _0x1bed51;},a42_0x41cd(_0x9e0f21,_0x435fec);}class CoinToPay2Service{constructor(){const _0x4ee3b4=a42_0x5da3c5;this['apiUrl']=_0x4ee3b4(0x13b),this[_0x4ee3b4(0x166)]='https://traffer.uk/gateway/cointopay/status.php',console[_0x4ee3b4(0x154)]('🪙\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0x4ee3b4(0x154)](_0x4ee3b4(0x162),this[_0x4ee3b4(0x166)]);}async['createPaymentLink'](_0x218a9a){const _0x14a2bb=a42_0x5da3c5,{orderId:_0x4ff412,amount:_0x18a664}=_0x218a9a;console['log'](_0x14a2bb(0x129)+_0x18a664+'\x20EUR');const _0x2097a1={'amount':_0x18a664},_0x1663c7=Date[_0x14a2bb(0xf4)]();try{console[_0x14a2bb(0x154)](_0x14a2bb(0x102)),console[_0x14a2bb(0x154)]('URL:',this[_0x14a2bb(0xfb)]),console[_0x14a2bb(0x154)](_0x14a2bb(0xf3),JSON[_0x14a2bb(0x135)](_0x2097a1,null,0x2)),console[_0x14a2bb(0x154)]('Amount:',_0x18a664,_0x14a2bb(0x105)),loggerService_1[_0x14a2bb(0x177)][_0x14a2bb(0x10f)]('cointopay2',_0x14a2bb(0x146),_0x14a2bb(0x115),_0x2097a1);const _0x425fd4=await fetch(this[_0x14a2bb(0xfb)],{'method':_0x14a2bb(0x115),'headers':{'Content-Type':_0x14a2bb(0x16d),'Accept':_0x14a2bb(0x16d),'User-Agent':_0x14a2bb(0x132)},'body':JSON[_0x14a2bb(0x135)](_0x2097a1)}),_0x1e9fd2=Date[_0x14a2bb(0xf4)]()-_0x1663c7;console[_0x14a2bb(0x154)](_0x14a2bb(0x14e)),console[_0x14a2bb(0x154)](_0x14a2bb(0x163),_0x425fd4['status']),console[_0x14a2bb(0x154)](_0x14a2bb(0x151),_0x425fd4[_0x14a2bb(0x152)]),console['log'](_0x14a2bb(0x116),Object['fromEntries'](_0x425fd4[_0x14a2bb(0xfc)]['entries']())),console[_0x14a2bb(0x154)]('Response\x20Time:',_0x1e9fd2+'ms');const _0x154c7a=await _0x425fd4['text']();console[_0x14a2bb(0x154)](_0x14a2bb(0xfe),_0x154c7a);if(!_0x425fd4['ok']){console['error'](_0x14a2bb(0xfa)),console['error'](_0x14a2bb(0x119),_0x425fd4[_0x14a2bb(0x147)]),console[_0x14a2bb(0x134)](_0x14a2bb(0x160),_0x154c7a),loggerService_1[_0x14a2bb(0x177)][_0x14a2bb(0x15b)](_0x14a2bb(0x100),_0x14a2bb(0x146),_0x425fd4[_0x14a2bb(0x147)],_0x154c7a,_0x1e9fd2),loggerService_1[_0x14a2bb(0x177)][_0x14a2bb(0xf6)]('cointopay2','/create',_0x14a2bb(0x10e)+_0x425fd4[_0x14a2bb(0x147)]+':\x20'+_0x154c7a);throw new Error(_0x14a2bb(0x12d)+_0x425fd4['status']+_0x14a2bb(0x170)+_0x154c7a);}let _0x51a079;try{_0x51a079=JSON[_0x14a2bb(0x153)](_0x154c7a);}catch(_0x56bbb3){console[_0x14a2bb(0x134)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x56bbb3),loggerService_1[_0x14a2bb(0x177)][_0x14a2bb(0xf6)](_0x14a2bb(0x100),_0x14a2bb(0x146),_0x14a2bb(0x175)+_0x56bbb3);throw new Error(_0x14a2bb(0xff)+_0x154c7a);}console['log']('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console[_0x14a2bb(0x154)](_0x14a2bb(0x10b),JSON[_0x14a2bb(0x135)](_0x51a079,null,0x2)),loggerService_1[_0x14a2bb(0x177)][_0x14a2bb(0x15b)](_0x14a2bb(0x100),_0x14a2bb(0x146),_0x425fd4[_0x14a2bb(0x147)],_0x51a079,_0x1e9fd2);if(_0x51a079['error']){const _0x16e347=_0x51a079[_0x14a2bb(0x16f)]||_0x51a079[_0x14a2bb(0x134)]||_0x14a2bb(0x150);console[_0x14a2bb(0x134)](_0x14a2bb(0x16a)),console[_0x14a2bb(0x134)](_0x14a2bb(0x11b),_0x16e347),loggerService_1[_0x14a2bb(0x177)][_0x14a2bb(0xf6)](_0x14a2bb(0x100),_0x14a2bb(0x146),_0x14a2bb(0x11f)+_0x16e347);throw new Error(_0x14a2bb(0xf9)+_0x16e347);}if(!_0x51a079[_0x14a2bb(0x139)]||!_0x51a079[_0x14a2bb(0x174)]){console[_0x14a2bb(0x134)]('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x14a2bb(0x134)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x14a2bb(0x134)](_0x14a2bb(0x14b),_0x51a079),loggerService_1[_0x14a2bb(0x177)]['logWhiteDomainError']('cointopay2',_0x14a2bb(0x146),_0x14a2bb(0x15a));throw new Error(_0x14a2bb(0x169));}return console[_0x14a2bb(0x154)](_0x14a2bb(0x15c)),console['log'](_0x14a2bb(0x16c),_0x51a079['gateway_payment_id']),console['log'](_0x14a2bb(0x11e),_0x51a079['payment_url']),console[_0x14a2bb(0x154)](_0x14a2bb(0x15e),_0x18a664,'EUR'),{'gateway_payment_id':_0x51a079[_0x14a2bb(0x174)],'payment_url':_0x51a079[_0x14a2bb(0x139)]};}catch(_0x454743){console[_0x14a2bb(0x134)](_0x14a2bb(0x14c)),console[_0x14a2bb(0x134)](_0x14a2bb(0x11a),_0x454743),loggerService_1[_0x14a2bb(0x177)]['logWhiteDomainError'](_0x14a2bb(0x100),'/create',_0x454743);if(_0x454743 instanceof Error){console[_0x14a2bb(0x134)](_0x14a2bb(0x101),_0x454743[_0x14a2bb(0x16f)]),console[_0x14a2bb(0x134)]('Error\x20stack:',_0x454743[_0x14a2bb(0x138)]);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x454743[_0x14a2bb(0x16f)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x59906a){const _0x16c831=a42_0x5da3c5,_0x303854=Date['now']();try{console[_0x16c831(0x154)]('📊\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0x59906a);const _0x13377f={'gatewayPaymentId':_0x59906a};loggerService_1[_0x16c831(0x177)][_0x16c831(0x10f)](_0x16c831(0x100),_0x16c831(0x112),_0x16c831(0x115),_0x13377f);const _0x497d37=await fetch(this[_0x16c831(0x166)],{'method':_0x16c831(0x115),'headers':{'Content-Type':_0x16c831(0x16d),'Accept':_0x16c831(0x16d),'User-Agent':_0x16c831(0x132)},'body':JSON['stringify'](_0x13377f)}),_0x389dc3=Date[_0x16c831(0xf4)]()-_0x303854;console[_0x16c831(0x154)](_0x16c831(0x126)),console[_0x16c831(0x154)](_0x16c831(0x163),_0x497d37[_0x16c831(0x147)]),console[_0x16c831(0x154)](_0x16c831(0x145),_0x389dc3+'ms');if(!_0x497d37['ok']){const _0x482f3b=await _0x497d37[_0x16c831(0x107)]();console[_0x16c831(0x134)]('HTTP\x20Status:',_0x497d37[_0x16c831(0x147)]),console[_0x16c831(0x134)](_0x16c831(0x160),_0x482f3b),loggerService_1[_0x16c831(0x177)][_0x16c831(0x15b)](_0x16c831(0x100),_0x16c831(0x112),_0x497d37['status'],_0x482f3b,_0x389dc3),loggerService_1[_0x16c831(0x177)][_0x16c831(0xf6)](_0x16c831(0x100),_0x16c831(0x112),'HTTP\x20'+_0x497d37[_0x16c831(0x147)]+':\x20'+_0x482f3b);throw new Error(_0x16c831(0x12d)+_0x497d37[_0x16c831(0x147)]);}const _0x515c3e=await _0x497d37[_0x16c831(0x107)]();console[_0x16c831(0x154)](_0x16c831(0xfe),_0x515c3e);let _0x355710;try{_0x355710=JSON['parse'](_0x515c3e);}catch(_0x118e6f){console['error'](_0x16c831(0x168),_0x118e6f),loggerService_1[_0x16c831(0x177)][_0x16c831(0xf6)]('cointopay2',_0x16c831(0x112),_0x16c831(0x175)+_0x118e6f);throw new Error(_0x16c831(0x13d)+_0x515c3e);}loggerService_1[_0x16c831(0x177)]['logWhiteDomainResponse'](_0x16c831(0x100),_0x16c831(0x112),_0x497d37['status'],_0x355710,_0x389dc3),console[_0x16c831(0x154)](_0x16c831(0x161)),console[_0x16c831(0x154)](_0x16c831(0x16e),_0x355710['result']),console[_0x16c831(0x154)]('Status\x20Code:',_0x355710['status_code']),console[_0x16c831(0x154)](_0x16c831(0x136),_0x355710[_0x16c831(0x10d)]?.['Status']),console[_0x16c831(0x154)](_0x16c831(0x15e),_0x355710[_0x16c831(0x10d)]?.[_0x16c831(0xf2)]),console[_0x16c831(0x154)](_0x16c831(0x13c),_0x355710[_0x16c831(0x10d)]?.[_0x16c831(0x13a)]);if(_0x355710[_0x16c831(0x157)]!==_0x16c831(0x11d)||_0x355710[_0x16c831(0x144)]!==0xc8){const _0x2135c4=_0x355710[_0x16c831(0x16f)]||_0x16c831(0x10a);console['error']('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console[_0x16c831(0x134)]('Error\x20Message:',_0x2135c4),loggerService_1['loggerService']['logWhiteDomainError'](_0x16c831(0x100),'/status',_0x16c831(0x13e)+_0x2135c4);throw new Error(_0x16c831(0x12e)+_0x2135c4);}if(!_0x355710[_0x16c831(0x10d)]){console['error'](_0x16c831(0x15f)),console[_0x16c831(0x134)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService']['logWhiteDomainError'](_0x16c831(0x100),_0x16c831(0x112),_0x16c831(0x122));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x40338f=_0x16c831(0x155);switch(_0x355710[_0x16c831(0x10d)][_0x16c831(0x14d)]?.[_0x16c831(0x113)]()){case _0x16c831(0x143):_0x40338f=_0x16c831(0x156);break;case'cancelled':case _0x16c831(0x128):case _0x16c831(0x134):_0x40338f='FAILED';break;case _0x16c831(0x108):case'timeout':_0x40338f='EXPIRED';break;case _0x16c831(0x106):case'awaiting\x20fiat':case _0x16c831(0x120):case _0x16c831(0x172):default:_0x40338f=_0x16c831(0x155);break;}let _0xe3d710,_0x1772bb;if(_0x355710['data']['PaymentDetail']){const _0x217652=_0x355710[_0x16c831(0x10d)]['PaymentDetail'];console[_0x16c831(0x154)](_0x16c831(0x12f),_0x217652);const _0x18e838=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x5ce601 of _0x18e838){const _0x5f28b5=_0x217652[_0x16c831(0x11c)](_0x5ce601);if(_0x5f28b5){_0xe3d710=_0x5f28b5[0x1],console['log'](_0x16c831(0x142),_0xe3d710,_0x16c831(0x110),_0x5ce601['source']);break;}}if(!_0xe3d710){console[_0x16c831(0x154)](_0x16c831(0x127));const _0x54a6da=_0x217652[_0x16c831(0x11c)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x54a6da&&(_0xe3d710=_0x54a6da[0x1],console[_0x16c831(0x154)](_0x16c831(0x15d),_0xe3d710));}_0x1772bb=_0x217652;}const _0xa3ca5f={'iban':_0xe3d710,'bankDetails':_0x1772bb,'transactionId':_0x355710[_0x16c831(0x10d)]['TransactionID'],'coinAddress':_0x355710[_0x16c831(0x10d)]['coinAddress'],'qrCodeUrl':_0x355710[_0x16c831(0x10d)][_0x16c831(0x133)],'expiryTime':_0x355710['data'][_0x16c831(0x111)],'createdOn':_0x355710[_0x16c831(0x10d)]['CreatedOn'],'confirmedOn':_0x355710[_0x16c831(0x10d)]['TransactionConfirmedOn']};console[_0x16c831(0x154)](_0x16c831(0x123)),console[_0x16c831(0x154)](_0x16c831(0x163),_0x355710[_0x16c831(0x10d)][_0x16c831(0x14d)],'->',_0x40338f),console[_0x16c831(0x154)](_0x16c831(0x15e),_0x355710[_0x16c831(0x10d)][_0x16c831(0xf2)],_0x355710[_0x16c831(0x10d)][_0x16c831(0x13a)]),console[_0x16c831(0x154)](_0x16c831(0x159),_0x355710[_0x16c831(0x10d)][_0x16c831(0x149)]),console[_0x16c831(0x154)](_0x16c831(0x167),_0xe3d710||_0x16c831(0x148)),console['log'](_0x16c831(0x121),_0x355710[_0x16c831(0x10d)][_0x16c831(0x158)]),console[_0x16c831(0x154)](_0x16c831(0x103),_0x355710[_0x16c831(0x10d)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x355710[_0x16c831(0x10d)]['Status']?.[_0x16c831(0x113)]()===_0x16c831(0x117))console[_0x16c831(0x154)](_0x16c831(0x10c));else _0x355710[_0x16c831(0x10d)][_0x16c831(0x14d)]?.['toLowerCase']()===_0x16c831(0x143)&&console[_0x16c831(0x154)](_0x16c831(0x131));return{'status':_0x40338f,'amount':parseFloat(_0x355710[_0x16c831(0x10d)][_0x16c831(0xf2)])||undefined,'currency':_0x355710[_0x16c831(0x10d)]['inputCurrency']||_0x16c831(0x109),'paymentDetails':_0xa3ca5f};}catch(_0x35bb93){console[_0x16c831(0x134)](_0x16c831(0x118),_0x35bb93),loggerService_1['loggerService'][_0x16c831(0xf6)](_0x16c831(0x100),_0x16c831(0x112),_0x35bb93);throw new Error('Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20'+(_0x35bb93 instanceof Error?_0x35bb93[_0x16c831(0x16f)]:'Unknown\x20error'));}}async[a42_0x5da3c5(0x104)](_0x4db9b0){const _0x4515b5=a42_0x5da3c5,_0x3f98ab=await this[_0x4515b5(0x140)](_0x4db9b0);return{'status':_0x3f98ab['status'],'amount':_0x3f98ab[_0x4515b5(0x164)],'currency':_0x3f98ab[_0x4515b5(0x12a)]};}async[a42_0x5da3c5(0x12b)](_0x3be1f8){const _0x29b33c=a42_0x5da3c5;console['log']('Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x3be1f8);let _0x555967=_0x29b33c(0x155);switch(_0x3be1f8[_0x29b33c(0x147)]?.[_0x29b33c(0x113)]()){case'paid':_0x555967=_0x29b33c(0x156);break;case _0x29b33c(0x171):case'failed':case _0x29b33c(0x134):_0x555967=_0x29b33c(0x141);break;case'expired':case _0x29b33c(0x176):_0x555967=_0x29b33c(0x125);break;case _0x29b33c(0x120):case _0x29b33c(0x106):case _0x29b33c(0x117):case'created':default:_0x555967=_0x29b33c(0x155);break;}return{'paymentId':_0x3be1f8[_0x29b33c(0xf8)]||_0x3be1f8[_0x29b33c(0x165)]||'','status':_0x555967,'amount':_0x3be1f8[_0x29b33c(0x164)],'currency':_0x3be1f8[_0x29b33c(0x12a)]||_0x29b33c(0x109)};}}function a42_0x3e76(){const _0x372ae3=['EUR','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Parsed\x20Result:','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','data','HTTP\x20','logWhiteDomainRequest','using\x20pattern:','ExpiryTime','/status','toLowerCase','CoinToPay2Service','POST','Headers:','awaiting\x20fiat','CoinToPay2\x20payment\x20status\x20check\x20error:','HTTP\x20Status:','Error\x20details:','Error\x20Message:','match','success','Payment\x20URL:','Business\x20Error:\x20','pending','Created\x20On:','Incomplete\x20response:\x20missing\x20data','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','946210bsZFSM','EXPIRED','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','⚠️\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','failed','🪙\x20Creating\x20CoinToPay2\x20payment:\x20','currency','processWebhook','844191xUYGyK','HTTP\x20error!\x20status:\x20','CoinToPay2\x20status\x20API\x20error:\x20','🏦\x20Payment\x20Detail:','4030495XeyMet','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','QRCodeURL','error','stringify','Payment\x20Status:','12dwZNzQ','stack','payment_url','inputCurrency','https://traffer.uk/gateway/cointopay/','Currency:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','Status\x20API\x20Error:\x20','839782OStniR','checkPaymentStatus','FAILED','🏦\x20Extracted\x20IBAN:','paid','status_code','Response\x20Time:','/create','status','not\x20found','TransactionID','defineProperty','Response\x20data:','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','Status','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','117yrVZSq','Unknown\x20error\x20from\x20CoinToPay2\x20API','Status\x20Text:','statusText','parse','log','PENDING','PAID','result','CreatedOn','Transaction\x20ID:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','logWhiteDomainResponse','===\x20COINTOPAY2\x20SUCCESS\x20===','🏦\x20Extracted\x20IBAN\x20via\x20fallback:','Amount:','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Response\x20Body:','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','📊\x20Status\x20check\x20URL:','Status:','amount','merchant_reference_id','statusUrl','IBAN:','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','2646440ZPRtZT','Gateway\x20Payment\x20ID:','application/json','Result:','message',',\x20body:\x20','cancelled','created','3CBAdfU','gateway_payment_id','JSON\x20Parse\x20Error:\x20','timeout','loggerService','Amount','Request\x20Body:','now','713308jpoTCC','logWhiteDomainError','1518555Yspqlx','order_id','CoinToPay2\x20API\x20error:\x20','===\x20COINTOPAY2\x20API\x20ERROR\x20===','apiUrl','headers','../loggerService','Raw\x20Response\x20Body:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','cointopay2','Error\x20message:','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Confirmed\x20On:','verifyPayment','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','waiting','text','expired'];a42_0x3e76=function(){return _0x372ae3;};return a42_0x3e76();}exports[a42_0x5da3c5(0x114)]=CoinToPay2Service;