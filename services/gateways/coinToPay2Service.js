'use strict';function a40_0x1858(){const _0xedbe4c=['11148020eTucZj','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','52fVsQyh','message','1143nZSuuf','Error\x20message:','headers','application/json','Result:','üè¶\x20Payment\x20Detail:','FAILED','not\x20found','URL:','Business\x20Error:\x20','1635801blrHpc','CoinToPay2\x20API\x20error:\x20','merchant_reference_id','Status\x20API\x20Error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','loggerService','Unknown\x20error\x20from\x20CoinToPay2\x20API','data','55144QuyYHR','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','created','Missing\x20data\x20in\x20response','not\x20confirmed','üìä\x20Status\x20check\x20URL:','382400WOcGQD','https://traffer.uk/gateway/cointopay/','Status:','pending','coinAddress','Response\x20Time:','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','error','fromEntries','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','https://traffer.uk/gateway/cointopay/status.php','CreatedOn','log','70QMPZjB','toLowerCase','HTTP\x20','parse','inputCurrency','status_code','timeout','Status\x20Code:','HTTP\x20error!\x20status:\x20','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','Amount:','__esModule','PaymentDetail','===\x20COINTOPAY2\x20SUCCESS\x20===','apiUrl','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','EXPIRED','/create','expired','2610282QWHTjR','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','PENDING','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','payment_url','HTTP\x20Status:','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','/status','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Unknown\x20error','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','waiting','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','statusText','createPaymentLink','logWhiteDomainResponse','cointopay2','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','failed','Gateway\x20Payment\x20ID:','text','logWhiteDomainRequest','CoinToPay2\x20status\x20API\x20error:\x20','TransactionID','Incomplete\x20response:\x20missing\x20data','gateway_payment_id','POST','now','verifyPayment','Response\x20data:','Raw\x20Response\x20Body:','Payment\x20URL:','result','EUR','CoinToPay2Service','1222618fInbxY','stringify','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','awaiting\x20fiat','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','statusUrl','Currency:','ExpiryTime','JSON\x20Parse\x20Error:\x20','paid','checkPaymentStatus','logWhiteDomainError','Error\x20stack:','370374rBltEJ','stack','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Status','Response\x20Body:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','status','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','QRCodeURL','Transaction\x20ID:','amount',',\x20body:\x20','currency','cancelled','TransactionConfirmedOn','IBAN:','Amount','Created\x20On:','../loggerService'];a40_0x1858=function(){return _0xedbe4c;};return a40_0x1858();}const a40_0x1661e0=a40_0x3905;(function(_0x53c35f,_0x4378d3){const _0x4c46f5=a40_0x3905,_0x90c26e=_0x53c35f();while(!![]){try{const _0x3f956f=-parseInt(_0x4c46f5(0xea))/0x1+parseInt(_0x4c46f5(0xc7))/0x2+-parseInt(_0x4c46f5(0x119))/0x3+-parseInt(_0x4c46f5(0x10d))/0x4*(-parseInt(_0x4c46f5(0xa4))/0x5)+parseInt(_0x4c46f5(0xf8))/0x6*(parseInt(_0x4c46f5(0xb3))/0x7)+-parseInt(_0x4c46f5(0x9e))/0x8*(-parseInt(_0x4c46f5(0x10f))/0x9)+-parseInt(_0x4c46f5(0x10b))/0xa;if(_0x3f956f===_0x4378d3)break;else _0x90c26e['push'](_0x90c26e['shift']());}catch(_0x22848e){_0x90c26e['push'](_0x90c26e['shift']());}}}(a40_0x1858,0xde053));Object['defineProperty'](exports,a40_0x1661e0(0xbf),{'value':!![]}),exports[a40_0x1661e0(0xe9)]=void 0x0;function a40_0x3905(_0x398d2e,_0x3ec8b2){const _0x185806=a40_0x1858();return a40_0x3905=function(_0x390561,_0x50f093){_0x390561=_0x390561-0x97;let _0x454070=_0x185806[_0x390561];return _0x454070;},a40_0x3905(_0x398d2e,_0x3ec8b2);}const loggerService_1=require(a40_0x1661e0(0x10a));class CoinToPay2Service{constructor(){const _0x337c63=a40_0x1661e0;this[_0x337c63(0xc2)]=_0x337c63(0xa5),this[_0x337c63(0xf0)]=_0x337c63(0xb0),console['log'](_0x337c63(0xaa)),console[_0x337c63(0xb2)](_0x337c63(0xa3),this[_0x337c63(0xf0)]);}async[a40_0x1661e0(0xd5)](_0x34832d){const _0x2c69a0=a40_0x1661e0,{orderId:_0x116ac8,amount:_0x24b3be}=_0x34832d;console[_0x2c69a0(0xb2)](_0x2c69a0(0x9f)+_0x24b3be+'\x20EUR');const _0x14de7e={'amount':_0x24b3be},_0x195294=Date['now']();try{console['log'](_0x2c69a0(0xfa)),console[_0x2c69a0(0xb2)](_0x2c69a0(0x117),this['apiUrl']),console['log']('Request\x20Body:',JSON[_0x2c69a0(0xeb)](_0x14de7e,null,0x2)),console['log'](_0x2c69a0(0xbe),_0x24b3be,_0x2c69a0(0xae)),loggerService_1[_0x2c69a0(0x9b)][_0x2c69a0(0xdc)](_0x2c69a0(0xd7),_0x2c69a0(0xc5),_0x2c69a0(0xe1),_0x14de7e);const _0x15e220=await fetch(this[_0x2c69a0(0xc2)],{'method':_0x2c69a0(0xe1),'headers':{'Content-Type':_0x2c69a0(0x112),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x2c69a0(0xeb)](_0x14de7e)}),_0x48eef1=Date[_0x2c69a0(0xe2)]()-_0x195294;console[_0x2c69a0(0xb2)](_0x2c69a0(0x10c)),console[_0x2c69a0(0xb2)](_0x2c69a0(0xa6),_0x15e220[_0x2c69a0(0xfe)]),console[_0x2c69a0(0xb2)]('Status\x20Text:',_0x15e220[_0x2c69a0(0xd4)]),console[_0x2c69a0(0xb2)]('Headers:',Object[_0x2c69a0(0xac)](_0x15e220[_0x2c69a0(0x111)]['entries']())),console[_0x2c69a0(0xb2)]('Response\x20Time:',_0x48eef1+'ms');const _0xdcadc7=await _0x15e220['text']();console[_0x2c69a0(0xb2)](_0x2c69a0(0xe5),_0xdcadc7);if(!_0x15e220['ok']){console[_0x2c69a0(0xab)]('===\x20COINTOPAY2\x20API\x20ERROR\x20==='),console[_0x2c69a0(0xab)](_0x2c69a0(0xcc),_0x15e220[_0x2c69a0(0xfe)]),console[_0x2c69a0(0xab)](_0x2c69a0(0xfc),_0xdcadc7),loggerService_1[_0x2c69a0(0x9b)][_0x2c69a0(0xd6)]('cointopay2',_0x2c69a0(0xc5),_0x15e220[_0x2c69a0(0xfe)],_0xdcadc7,_0x48eef1),loggerService_1[_0x2c69a0(0x9b)][_0x2c69a0(0xf6)](_0x2c69a0(0xd7),_0x2c69a0(0xc5),_0x2c69a0(0xb5)+_0x15e220['status']+':\x20'+_0xdcadc7);throw new Error(_0x2c69a0(0xbb)+_0x15e220[_0x2c69a0(0xfe)]+_0x2c69a0(0x103)+_0xdcadc7);}let _0x29c1ea;try{_0x29c1ea=JSON[_0x2c69a0(0xb6)](_0xdcadc7);}catch(_0x340fe1){console['error'](_0x2c69a0(0x9a),_0x340fe1),loggerService_1[_0x2c69a0(0x9b)]['logWhiteDomainError']('cointopay2',_0x2c69a0(0xc5),_0x2c69a0(0xf3)+_0x340fe1);throw new Error(_0x2c69a0(0xc8)+_0xdcadc7);}console[_0x2c69a0(0xb2)]('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console['log']('Parsed\x20Result:',JSON[_0x2c69a0(0xeb)](_0x29c1ea,null,0x2)),loggerService_1['loggerService'][_0x2c69a0(0xd6)](_0x2c69a0(0xd7),'/create',_0x15e220[_0x2c69a0(0xfe)],_0x29c1ea,_0x48eef1);if(_0x29c1ea[_0x2c69a0(0xab)]){const _0x4ab485=_0x29c1ea['message']||_0x29c1ea['error']||_0x2c69a0(0x9c);console[_0x2c69a0(0xab)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x2c69a0(0xab)]('Error\x20Message:',_0x4ab485),loggerService_1['loggerService'][_0x2c69a0(0xf6)](_0x2c69a0(0xd7),_0x2c69a0(0xc5),_0x2c69a0(0x118)+_0x4ab485);throw new Error(_0x2c69a0(0x97)+_0x4ab485);}if(!_0x29c1ea[_0x2c69a0(0xcb)]||!_0x29c1ea[_0x2c69a0(0xe0)]){console[_0x2c69a0(0xab)](_0x2c69a0(0xed)),console['error'](_0x2c69a0(0xfd)),console[_0x2c69a0(0xab)](_0x2c69a0(0xe4),_0x29c1ea),loggerService_1[_0x2c69a0(0x9b)][_0x2c69a0(0xf6)](_0x2c69a0(0xd7),_0x2c69a0(0xc5),_0x2c69a0(0xad));throw new Error(_0x2c69a0(0xcf));}return console[_0x2c69a0(0xb2)](_0x2c69a0(0xc1)),console['log'](_0x2c69a0(0xda),_0x29c1ea[_0x2c69a0(0xe0)]),console['log'](_0x2c69a0(0xe6),_0x29c1ea['payment_url']),console[_0x2c69a0(0xb2)](_0x2c69a0(0xbe),_0x24b3be,_0x2c69a0(0xe8)),{'gateway_payment_id':_0x29c1ea['gateway_payment_id'],'payment_url':_0x29c1ea[_0x2c69a0(0xcb)]};}catch(_0x54a53e){console[_0x2c69a0(0xab)](_0x2c69a0(0xd8)),console[_0x2c69a0(0xab)]('Error\x20details:',_0x54a53e),loggerService_1[_0x2c69a0(0x9b)][_0x2c69a0(0xf6)]('cointopay2',_0x2c69a0(0xc5),_0x54a53e);if(_0x54a53e instanceof Error){console[_0x2c69a0(0xab)](_0x2c69a0(0x110),_0x54a53e[_0x2c69a0(0x10e)]),console[_0x2c69a0(0xab)](_0x2c69a0(0xf7),_0x54a53e[_0x2c69a0(0xf9)]);throw new Error(_0x2c69a0(0xef)+_0x54a53e[_0x2c69a0(0x10e)]);}throw new Error(_0x2c69a0(0xaf));}}async['checkPaymentStatus'](_0xb71a4d){const _0x4cd8a9=a40_0x1661e0,_0x258cc5=Date[_0x4cd8a9(0xe2)]();try{console[_0x4cd8a9(0xb2)](_0x4cd8a9(0xec)+_0xb71a4d);const _0x1e278a={'gatewayPaymentId':_0xb71a4d};loggerService_1[_0x4cd8a9(0x9b)][_0x4cd8a9(0xdc)](_0x4cd8a9(0xd7),'/status',_0x4cd8a9(0xe1),_0x1e278a);const _0x155720=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0x4cd8a9(0x112),'Accept':_0x4cd8a9(0x112),'User-Agent':_0x4cd8a9(0xbc)},'body':JSON[_0x4cd8a9(0xeb)](_0x1e278a)}),_0x35a42e=Date[_0x4cd8a9(0xe2)]()-_0x258cc5;console[_0x4cd8a9(0xb2)](_0x4cd8a9(0xca)),console[_0x4cd8a9(0xb2)]('Status:',_0x155720[_0x4cd8a9(0xfe)]),console[_0x4cd8a9(0xb2)](_0x4cd8a9(0xa9),_0x35a42e+'ms');if(!_0x155720['ok']){const _0x4d3f09=await _0x155720[_0x4cd8a9(0xdb)]();console[_0x4cd8a9(0xab)]('HTTP\x20Status:',_0x155720[_0x4cd8a9(0xfe)]),console[_0x4cd8a9(0xab)]('Response\x20Body:',_0x4d3f09),loggerService_1[_0x4cd8a9(0x9b)][_0x4cd8a9(0xd6)](_0x4cd8a9(0xd7),'/status',_0x155720[_0x4cd8a9(0xfe)],_0x4d3f09,_0x35a42e),loggerService_1['loggerService'][_0x4cd8a9(0xf6)]('cointopay2',_0x4cd8a9(0xce),_0x4cd8a9(0xb5)+_0x155720['status']+':\x20'+_0x4d3f09);throw new Error(_0x4cd8a9(0xbb)+_0x155720[_0x4cd8a9(0xfe)]);}const _0x3f30e0=await _0x155720[_0x4cd8a9(0xdb)]();console['log'](_0x4cd8a9(0xe5),_0x3f30e0);let _0xd56493;try{_0xd56493=JSON[_0x4cd8a9(0xb6)](_0x3f30e0);}catch(_0x138741){console[_0x4cd8a9(0xab)](_0x4cd8a9(0x9a),_0x138741),loggerService_1[_0x4cd8a9(0x9b)][_0x4cd8a9(0xf6)](_0x4cd8a9(0xd7),_0x4cd8a9(0xce),'JSON\x20Parse\x20Error:\x20'+_0x138741);throw new Error(_0x4cd8a9(0xbd)+_0x3f30e0);}loggerService_1[_0x4cd8a9(0x9b)][_0x4cd8a9(0xd6)](_0x4cd8a9(0xd7),'/status',_0x155720[_0x4cd8a9(0xfe)],_0xd56493,_0x35a42e),console[_0x4cd8a9(0xb2)]('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x4cd8a9(0x113),_0xd56493[_0x4cd8a9(0xe7)]),console[_0x4cd8a9(0xb2)](_0x4cd8a9(0xba),_0xd56493[_0x4cd8a9(0xb8)]),console[_0x4cd8a9(0xb2)]('Payment\x20Status:',_0xd56493[_0x4cd8a9(0x9d)]?.['Status']),console['log']('Amount:',_0xd56493[_0x4cd8a9(0x9d)]?.[_0x4cd8a9(0x108)]),console[_0x4cd8a9(0xb2)](_0x4cd8a9(0xf1),_0xd56493[_0x4cd8a9(0x9d)]?.[_0x4cd8a9(0xb7)]);if(_0xd56493[_0x4cd8a9(0xe7)]!=='success'||_0xd56493['status_code']!==0xc8){const _0x5e7b71=_0xd56493['message']||'Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API';console[_0x4cd8a9(0xab)]('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x5e7b71),loggerService_1[_0x4cd8a9(0x9b)][_0x4cd8a9(0xf6)](_0x4cd8a9(0xd7),_0x4cd8a9(0xce),_0x4cd8a9(0x99)+_0x5e7b71);throw new Error(_0x4cd8a9(0xdd)+_0x5e7b71);}if(!_0xd56493[_0x4cd8a9(0x9d)]){console[_0x4cd8a9(0xab)](_0x4cd8a9(0xcd)),console[_0x4cd8a9(0xab)](_0x4cd8a9(0xa1)),loggerService_1[_0x4cd8a9(0x9b)][_0x4cd8a9(0xf6)](_0x4cd8a9(0xd7),'/status',_0x4cd8a9(0xdf));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x759f57=_0x4cd8a9(0xc9);switch(_0xd56493[_0x4cd8a9(0x9d)]['Status']?.[_0x4cd8a9(0xb4)]()){case _0x4cd8a9(0xf4):_0x759f57='PAID';break;case'cancelled':case _0x4cd8a9(0xd9):case'error':_0x759f57=_0x4cd8a9(0x115);break;case _0x4cd8a9(0xc6):case _0x4cd8a9(0xb9):_0x759f57='EXPIRED';break;case _0x4cd8a9(0xd2):case _0x4cd8a9(0xee):case _0x4cd8a9(0xa7):case _0x4cd8a9(0xa0):default:_0x759f57=_0x4cd8a9(0xc9);break;}let _0x4ab921,_0x17b5a6;if(_0xd56493['data'][_0x4cd8a9(0xc0)]){const _0x53af7f=_0xd56493[_0x4cd8a9(0x9d)][_0x4cd8a9(0xc0)];console[_0x4cd8a9(0xb2)](_0x4cd8a9(0x114),_0x53af7f);const _0x1641ee=_0x53af7f['match'](/IBAN\s+([A-Z0-9]+)/i);_0x1641ee&&(_0x4ab921=_0x1641ee[0x1],console[_0x4cd8a9(0xb2)]('üè¶\x20Extracted\x20IBAN:',_0x4ab921)),_0x17b5a6=_0x53af7f;}const _0x4f01ef={'iban':_0x4ab921,'bankDetails':_0x17b5a6,'transactionId':_0xd56493[_0x4cd8a9(0x9d)][_0x4cd8a9(0xde)],'coinAddress':_0xd56493[_0x4cd8a9(0x9d)][_0x4cd8a9(0xa8)],'qrCodeUrl':_0xd56493[_0x4cd8a9(0x9d)][_0x4cd8a9(0x100)],'expiryTime':_0xd56493['data'][_0x4cd8a9(0xf2)],'createdOn':_0xd56493[_0x4cd8a9(0x9d)]['CreatedOn'],'confirmedOn':_0xd56493[_0x4cd8a9(0x9d)][_0x4cd8a9(0x106)]};console[_0x4cd8a9(0xb2)](_0x4cd8a9(0xd3)),console[_0x4cd8a9(0xb2)](_0x4cd8a9(0xa6),_0xd56493[_0x4cd8a9(0x9d)][_0x4cd8a9(0xfb)],'->',_0x759f57),console[_0x4cd8a9(0xb2)](_0x4cd8a9(0xbe),_0xd56493[_0x4cd8a9(0x9d)][_0x4cd8a9(0x108)],_0xd56493[_0x4cd8a9(0x9d)][_0x4cd8a9(0xb7)]),console['log'](_0x4cd8a9(0x101),_0xd56493[_0x4cd8a9(0x9d)][_0x4cd8a9(0xde)]),console[_0x4cd8a9(0xb2)](_0x4cd8a9(0x107),_0x4ab921||_0x4cd8a9(0x116)),console['log'](_0x4cd8a9(0x109),_0xd56493['data'][_0x4cd8a9(0xb1)]),console['log']('Confirmed\x20On:',_0xd56493[_0x4cd8a9(0x9d)][_0x4cd8a9(0x106)]||_0x4cd8a9(0xa2));if(_0xd56493['data'][_0x4cd8a9(0xfb)]?.['toLowerCase']()===_0x4cd8a9(0xee))console[_0x4cd8a9(0xb2)](_0x4cd8a9(0xd1));else _0xd56493[_0x4cd8a9(0x9d)][_0x4cd8a9(0xfb)]?.[_0x4cd8a9(0xb4)]()==='paid'&&console[_0x4cd8a9(0xb2)](_0x4cd8a9(0xc3));return{'status':_0x759f57,'amount':parseFloat(_0xd56493[_0x4cd8a9(0x9d)][_0x4cd8a9(0x108)])||undefined,'currency':_0xd56493[_0x4cd8a9(0x9d)][_0x4cd8a9(0xb7)]||_0x4cd8a9(0xe8),'paymentDetails':_0x4f01ef};}catch(_0x8374c0){console[_0x4cd8a9(0xab)]('CoinToPay2\x20payment\x20status\x20check\x20error:',_0x8374c0),loggerService_1['loggerService'][_0x4cd8a9(0xf6)](_0x4cd8a9(0xd7),_0x4cd8a9(0xce),_0x8374c0);throw new Error(_0x4cd8a9(0xff)+(_0x8374c0 instanceof Error?_0x8374c0[_0x4cd8a9(0x10e)]:_0x4cd8a9(0xd0)));}}async[a40_0x1661e0(0xe3)](_0x225824){const _0x5906e8=a40_0x1661e0,_0xe925ba=await this[_0x5906e8(0xf5)](_0x225824);return{'status':_0xe925ba[_0x5906e8(0xfe)],'amount':_0xe925ba[_0x5906e8(0x102)],'currency':_0xe925ba[_0x5906e8(0x104)]};}async['processWebhook'](_0x43e3f6){const _0x177458=a40_0x1661e0;console['log']('Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x43e3f6);let _0x40423c='PENDING';switch(_0x43e3f6['status']?.[_0x177458(0xb4)]()){case _0x177458(0xf4):_0x40423c='PAID';break;case _0x177458(0x105):case _0x177458(0xd9):case _0x177458(0xab):_0x40423c=_0x177458(0x115);break;case'expired':case _0x177458(0xb9):_0x40423c=_0x177458(0xc4);break;case _0x177458(0xa7):case _0x177458(0xd2):case _0x177458(0xee):case _0x177458(0xa0):default:_0x40423c=_0x177458(0xc9);break;}return{'paymentId':_0x43e3f6['order_id']||_0x43e3f6[_0x177458(0x98)]||'','status':_0x40423c,'amount':_0x43e3f6[_0x177458(0x102)],'currency':_0x43e3f6[_0x177458(0x104)]||'EUR'};}}exports[a40_0x1661e0(0xe9)]=CoinToPay2Service;