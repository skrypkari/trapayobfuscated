'use strict';const a40_0xb43d7=a40_0x5d9c;function a40_0x4c13(){const _0x58a42a=['Created\x20On:','statusText','toLowerCase','not\x20found','Transaction\x20ID:','order_id','üè¶\x20Payment\x20Detail:','TransactionID','CoinToPay2\x20API\x20error:\x20','gateway_payment_id','result','status_code','status','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','HTTP\x20error!\x20status:\x20','https://traffer.uk/gateway/cointopay/status.php','Status:','message','timeout','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','fromEntries','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','inputCurrency','error','Response\x20data:','Payment\x20URL:','HTTP\x20Status:','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','now','Error\x20Message:','üè¶\x20Extracted\x20IBAN:','currency','===\x20COINTOPAY2\x20API\x20ERROR\x20===','awaiting\x20fiat','cointopay2','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','headers','Raw\x20Response\x20Body:','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','success','FAILED','HTTP\x20','Error\x20stack:','Payment\x20Status:','merchant_reference_id','verifyPayment','data','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','application/json','Confirmed\x20On:','paid','https://traffer.uk/gateway/cointopay/','stringify','text','Status','logWhiteDomainRequest','pending','createPaymentLink','Response\x20Time:','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','CoinToPay2\x20payment\x20status\x20check\x20error:','Amount:','logWhiteDomainResponse','Error\x20message:','processWebhook',',\x20body:\x20','4841944SsoCok','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','JSON\x20Parse\x20Error:\x20','Incomplete\x20response:\x20missing\x20data','6991880JzysHt','payment_url','using\x20pattern:','40WsHGDj','statusUrl','stack','532266ZpevWl','apiUrl','coinAddress','QRCodeURL','PENDING','Gateway\x20Payment\x20ID:','loggerService','POST','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','ExpiryTime','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Business\x20Error:\x20','../loggerService','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','===\x20COINTOPAY2\x20SUCCESS\x20===','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','entries','7341345rMGeLD','expired','29jmGUbg','TransactionConfirmedOn','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','PaymentDetail','5679441EVuPNl','Amount','Status\x20Text:','Unknown\x20error','Error\x20details:','__esModule','log','checkPaymentStatus','Result:','source','cancelled','12019TecOMU','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','PAID','Currency:','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status\x20API\x20Error:\x20','logWhiteDomainError','Missing\x20data\x20in\x20response','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','/status','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','4272eUxiRo','/create','Response\x20Body:','Headers:','EXPIRED','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Status\x20Code:','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','75758mynguS','CoinToPay2Service','EUR','amount','defineProperty','created','CoinToPay2\x20status\x20API\x20error:\x20','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','waiting','Parsed\x20Result:','Unknown\x20error\x20from\x20CoinToPay2\x20API'];a40_0x4c13=function(){return _0x58a42a;};return a40_0x4c13();}function a40_0x5d9c(_0x276042,_0x27e78a){const _0x4c1369=a40_0x4c13();return a40_0x5d9c=function(_0x5d9cc6,_0x1640e1){_0x5d9cc6=_0x5d9cc6-0x116;let _0x4a574d=_0x4c1369[_0x5d9cc6];return _0x4a574d;},a40_0x5d9c(_0x276042,_0x27e78a);}(function(_0x2f1b85,_0x49c923){const _0xb105d4=a40_0x5d9c,_0x550e3a=_0x2f1b85();while(!![]){try{const _0x4dc63f=-parseInt(_0xb105d4(0x120))/0x1*(-parseInt(_0xb105d4(0x143))/0x2)+parseInt(_0xb105d4(0x19b))/0x3+-parseInt(_0xb105d4(0x191))/0x4+-parseInt(_0xb105d4(0x11e))/0x5+-parseInt(_0xb105d4(0x13b))/0x6*(parseInt(_0xb105d4(0x12f))/0x7)+parseInt(_0xb105d4(0x195))/0x8+parseInt(_0xb105d4(0x124))/0x9*(parseInt(_0xb105d4(0x198))/0xa);if(_0x4dc63f===_0x49c923)break;else _0x550e3a['push'](_0x550e3a['shift']());}catch(_0xe4d3fc){_0x550e3a['push'](_0x550e3a['shift']());}}}(a40_0x4c13,0xbcae3));Object[a40_0xb43d7(0x147)](exports,a40_0xb43d7(0x129),{'value':!![]}),exports[a40_0xb43d7(0x144)]=void 0x0;const loggerService_1=require(a40_0xb43d7(0x119));class CoinToPay2Service{constructor(){const _0x3e8f8d=a40_0xb43d7;this[_0x3e8f8d(0x19c)]=_0x3e8f8d(0x182),this[_0x3e8f8d(0x199)]=_0x3e8f8d(0x15d),console['log'](_0x3e8f8d(0x171)),console[_0x3e8f8d(0x12a)]('üìä\x20Status\x20check\x20URL:',this[_0x3e8f8d(0x199)]);}async[a40_0xb43d7(0x188)](_0x4b79da){const _0x19a4c8=a40_0xb43d7,{orderId:_0x3e5900,amount:_0x5e8dcd}=_0x4b79da;console[_0x19a4c8(0x12a)](_0x19a4c8(0x13a)+_0x5e8dcd+'\x20EUR');const _0x277679={'amount':_0x5e8dcd},_0x1d0624=Date[_0x19a4c8(0x16a)]();try{console[_0x19a4c8(0x12a)](_0x19a4c8(0x11a)),console[_0x19a4c8(0x12a)]('URL:',this[_0x19a4c8(0x19c)]),console[_0x19a4c8(0x12a)]('Request\x20Body:',JSON[_0x19a4c8(0x183)](_0x277679,null,0x2)),console['log'](_0x19a4c8(0x18c),_0x5e8dcd,_0x19a4c8(0x192)),loggerService_1[_0x19a4c8(0x1a1)][_0x19a4c8(0x186)](_0x19a4c8(0x170),'/create',_0x19a4c8(0x1a2),_0x277679);const _0x293355=await fetch(this[_0x19a4c8(0x19c)],{'method':_0x19a4c8(0x1a2),'headers':{'Content-Type':_0x19a4c8(0x17f),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x19a4c8(0x183)](_0x277679)}),_0x44c9d3=Date['now']()-_0x1d0624;console[_0x19a4c8(0x12a)]('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console[_0x19a4c8(0x12a)]('Status:',_0x293355[_0x19a4c8(0x15a)]),console[_0x19a4c8(0x12a)](_0x19a4c8(0x126),_0x293355[_0x19a4c8(0x14f)]),console[_0x19a4c8(0x12a)](_0x19a4c8(0x13e),Object[_0x19a4c8(0x162)](_0x293355[_0x19a4c8(0x173)][_0x19a4c8(0x11d)]())),console[_0x19a4c8(0x12a)](_0x19a4c8(0x189),_0x44c9d3+'ms');const _0xdb80ee=await _0x293355[_0x19a4c8(0x184)]();console['log'](_0x19a4c8(0x174),_0xdb80ee);if(!_0x293355['ok']){console['error'](_0x19a4c8(0x16e)),console[_0x19a4c8(0x165)]('HTTP\x20Status:',_0x293355[_0x19a4c8(0x15a)]),console[_0x19a4c8(0x165)](_0x19a4c8(0x13d),_0xdb80ee),loggerService_1['loggerService'][_0x19a4c8(0x18d)](_0x19a4c8(0x170),_0x19a4c8(0x13c),_0x293355[_0x19a4c8(0x15a)],_0xdb80ee,_0x44c9d3),loggerService_1[_0x19a4c8(0x1a1)]['logWhiteDomainError'](_0x19a4c8(0x170),_0x19a4c8(0x13c),'HTTP\x20'+_0x293355[_0x19a4c8(0x15a)]+':\x20'+_0xdb80ee);throw new Error(_0x19a4c8(0x15c)+_0x293355[_0x19a4c8(0x15a)]+_0x19a4c8(0x190)+_0xdb80ee);}let _0x4732bf;try{_0x4732bf=JSON['parse'](_0xdb80ee);}catch(_0x206c7d){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x206c7d),loggerService_1[_0x19a4c8(0x1a1)][_0x19a4c8(0x136)](_0x19a4c8(0x170),_0x19a4c8(0x13c),_0x19a4c8(0x193)+_0x206c7d);throw new Error(_0x19a4c8(0x163)+_0xdb80ee);}console[_0x19a4c8(0x12a)](_0x19a4c8(0x138)),console[_0x19a4c8(0x12a)](_0x19a4c8(0x14c),JSON[_0x19a4c8(0x183)](_0x4732bf,null,0x2)),loggerService_1[_0x19a4c8(0x1a1)][_0x19a4c8(0x18d)](_0x19a4c8(0x170),_0x19a4c8(0x13c),_0x293355['status'],_0x4732bf,_0x44c9d3);if(_0x4732bf[_0x19a4c8(0x165)]){const _0x46a752=_0x4732bf[_0x19a4c8(0x15f)]||_0x4732bf[_0x19a4c8(0x165)]||_0x19a4c8(0x14d);console[_0x19a4c8(0x165)]('===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x19a4c8(0x16b),_0x46a752),loggerService_1[_0x19a4c8(0x1a1)][_0x19a4c8(0x136)](_0x19a4c8(0x170),_0x19a4c8(0x13c),_0x19a4c8(0x118)+_0x46a752);throw new Error(_0x19a4c8(0x156)+_0x46a752);}if(!_0x4732bf[_0x19a4c8(0x196)]||!_0x4732bf[_0x19a4c8(0x157)]){console[_0x19a4c8(0x165)](_0x19a4c8(0x11c)),console[_0x19a4c8(0x165)](_0x19a4c8(0x1a3)),console[_0x19a4c8(0x165)](_0x19a4c8(0x166),_0x4732bf),loggerService_1[_0x19a4c8(0x1a1)][_0x19a4c8(0x136)](_0x19a4c8(0x170),_0x19a4c8(0x13c),_0x19a4c8(0x134));throw new Error(_0x19a4c8(0x161));}return console[_0x19a4c8(0x12a)](_0x19a4c8(0x11b)),console[_0x19a4c8(0x12a)](_0x19a4c8(0x1a0),_0x4732bf[_0x19a4c8(0x157)]),console[_0x19a4c8(0x12a)](_0x19a4c8(0x167),_0x4732bf[_0x19a4c8(0x196)]),console['log'](_0x19a4c8(0x18c),_0x5e8dcd,_0x19a4c8(0x145)),{'gateway_payment_id':_0x4732bf['gateway_payment_id'],'payment_url':_0x4732bf[_0x19a4c8(0x196)]};}catch(_0x5d23b4){console['error']('===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20==='),console[_0x19a4c8(0x165)](_0x19a4c8(0x128),_0x5d23b4),loggerService_1[_0x19a4c8(0x1a1)]['logWhiteDomainError'](_0x19a4c8(0x170),_0x19a4c8(0x13c),_0x5d23b4);if(_0x5d23b4 instanceof Error){console['error'](_0x19a4c8(0x18e),_0x5d23b4[_0x19a4c8(0x15f)]),console[_0x19a4c8(0x165)](_0x19a4c8(0x179),_0x5d23b4[_0x19a4c8(0x19a)]);throw new Error(_0x19a4c8(0x14a)+_0x5d23b4['message']);}throw new Error(_0x19a4c8(0x130));}}async[a40_0xb43d7(0x12b)](_0x2db420){const _0x136803=a40_0xb43d7,_0x11d0db=Date[_0x136803(0x16a)]();try{console['log'](_0x136803(0x117)+_0x2db420);const _0x19fd39={'gatewayPaymentId':_0x2db420};loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay2',_0x136803(0x139),'POST',_0x19fd39);const _0x12bc0b=await fetch(this[_0x136803(0x199)],{'method':_0x136803(0x1a2),'headers':{'Content-Type':_0x136803(0x17f),'Accept':_0x136803(0x17f),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x136803(0x183)](_0x19fd39)}),_0x15fa6c=Date[_0x136803(0x16a)]()-_0x11d0db;console[_0x136803(0x12a)](_0x136803(0x133)),console[_0x136803(0x12a)](_0x136803(0x15e),_0x12bc0b[_0x136803(0x15a)]),console[_0x136803(0x12a)]('Response\x20Time:',_0x15fa6c+'ms');if(!_0x12bc0b['ok']){const _0x8147e0=await _0x12bc0b[_0x136803(0x184)]();console[_0x136803(0x165)](_0x136803(0x168),_0x12bc0b['status']),console['error'](_0x136803(0x13d),_0x8147e0),loggerService_1[_0x136803(0x1a1)][_0x136803(0x18d)](_0x136803(0x170),'/status',_0x12bc0b[_0x136803(0x15a)],_0x8147e0,_0x15fa6c),loggerService_1['loggerService']['logWhiteDomainError'](_0x136803(0x170),_0x136803(0x139),_0x136803(0x178)+_0x12bc0b[_0x136803(0x15a)]+':\x20'+_0x8147e0);throw new Error(_0x136803(0x15c)+_0x12bc0b[_0x136803(0x15a)]);}const _0x54bdfe=await _0x12bc0b[_0x136803(0x184)]();console[_0x136803(0x12a)](_0x136803(0x174),_0x54bdfe);let _0x509e87;try{_0x509e87=JSON['parse'](_0x54bdfe);}catch(_0x23bf72){console[_0x136803(0x165)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x23bf72),loggerService_1[_0x136803(0x1a1)]['logWhiteDomainError'](_0x136803(0x170),_0x136803(0x139),'JSON\x20Parse\x20Error:\x20'+_0x23bf72);throw new Error(_0x136803(0x172)+_0x54bdfe);}loggerService_1['loggerService'][_0x136803(0x18d)](_0x136803(0x170),_0x136803(0x139),_0x12bc0b[_0x136803(0x15a)],_0x509e87,_0x15fa6c),console[_0x136803(0x12a)]('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console[_0x136803(0x12a)](_0x136803(0x12c),_0x509e87[_0x136803(0x158)]),console[_0x136803(0x12a)](_0x136803(0x141),_0x509e87[_0x136803(0x159)]),console[_0x136803(0x12a)](_0x136803(0x17a),_0x509e87[_0x136803(0x17d)]?.[_0x136803(0x185)]),console[_0x136803(0x12a)](_0x136803(0x18c),_0x509e87[_0x136803(0x17d)]?.[_0x136803(0x125)]),console[_0x136803(0x12a)](_0x136803(0x132),_0x509e87[_0x136803(0x17d)]?.[_0x136803(0x164)]);if(_0x509e87[_0x136803(0x158)]!==_0x136803(0x176)||_0x509e87['status_code']!==0xc8){const _0x28971f=_0x509e87[_0x136803(0x15f)]||_0x136803(0x140);console[_0x136803(0x165)](_0x136803(0x122)),console[_0x136803(0x165)]('Error\x20Message:',_0x28971f),loggerService_1[_0x136803(0x1a1)][_0x136803(0x136)](_0x136803(0x170),'/status',_0x136803(0x135)+_0x28971f);throw new Error(_0x136803(0x149)+_0x28971f);}if(!_0x509e87[_0x136803(0x17d)]){console[_0x136803(0x165)](_0x136803(0x142)),console[_0x136803(0x165)](_0x136803(0x137)),loggerService_1['loggerService']['logWhiteDomainError'](_0x136803(0x170),_0x136803(0x139),_0x136803(0x194));throw new Error(_0x136803(0x18a));}let _0x3c4b0e='PENDING';switch(_0x509e87[_0x136803(0x17d)][_0x136803(0x185)]?.[_0x136803(0x150)]()){case _0x136803(0x181):_0x3c4b0e='PAID';break;case _0x136803(0x12e):case'failed':case _0x136803(0x165):_0x3c4b0e=_0x136803(0x177);break;case _0x136803(0x11f):case _0x136803(0x160):_0x3c4b0e=_0x136803(0x13f);break;case _0x136803(0x14b):case _0x136803(0x16f):case _0x136803(0x187):case _0x136803(0x148):default:_0x3c4b0e=_0x136803(0x19f);break;}let _0x508dce,_0x4913c6;if(_0x509e87['data'][_0x136803(0x123)]){const _0x55df84=_0x509e87[_0x136803(0x17d)][_0x136803(0x123)];console[_0x136803(0x12a)](_0x136803(0x154),_0x55df84);const _0x3c06b1=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x532f34 of _0x3c06b1){const _0x21d86e=_0x55df84['match'](_0x532f34);if(_0x21d86e){_0x508dce=_0x21d86e[0x1],console[_0x136803(0x12a)](_0x136803(0x16c),_0x508dce,_0x136803(0x197),_0x532f34[_0x136803(0x12d)]);break;}}if(!_0x508dce){console[_0x136803(0x12a)]('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x8ab2ee=_0x55df84['match'](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x8ab2ee&&(_0x508dce=_0x8ab2ee[0x1],console[_0x136803(0x12a)]('üè¶\x20Extracted\x20IBAN\x20via\x20fallback:',_0x508dce));}_0x4913c6=_0x55df84;}const _0x39e97f={'iban':_0x508dce,'bankDetails':_0x4913c6,'transactionId':_0x509e87[_0x136803(0x17d)]['TransactionID'],'coinAddress':_0x509e87['data'][_0x136803(0x19d)],'qrCodeUrl':_0x509e87['data'][_0x136803(0x19e)],'expiryTime':_0x509e87[_0x136803(0x17d)][_0x136803(0x116)],'createdOn':_0x509e87['data']['CreatedOn'],'confirmedOn':_0x509e87[_0x136803(0x17d)][_0x136803(0x121)]};console[_0x136803(0x12a)](_0x136803(0x175)),console[_0x136803(0x12a)]('Status:',_0x509e87['data']['Status'],'->',_0x3c4b0e),console['log'](_0x136803(0x18c),_0x509e87[_0x136803(0x17d)][_0x136803(0x125)],_0x509e87['data'][_0x136803(0x164)]),console[_0x136803(0x12a)](_0x136803(0x152),_0x509e87[_0x136803(0x17d)][_0x136803(0x155)]),console[_0x136803(0x12a)]('IBAN:',_0x508dce||_0x136803(0x151)),console['log'](_0x136803(0x14e),_0x509e87['data']['CreatedOn']),console[_0x136803(0x12a)](_0x136803(0x180),_0x509e87[_0x136803(0x17d)][_0x136803(0x121)]||'not\x20confirmed');if(_0x509e87[_0x136803(0x17d)]['Status']?.[_0x136803(0x150)]()===_0x136803(0x16f))console[_0x136803(0x12a)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x509e87[_0x136803(0x17d)][_0x136803(0x185)]?.[_0x136803(0x150)]()===_0x136803(0x181)&&console[_0x136803(0x12a)](_0x136803(0x15b));return{'status':_0x3c4b0e,'amount':parseFloat(_0x509e87['data']['Amount'])||undefined,'currency':_0x509e87[_0x136803(0x17d)][_0x136803(0x164)]||_0x136803(0x145),'paymentDetails':_0x39e97f};}catch(_0x6c010){console[_0x136803(0x165)](_0x136803(0x18b),_0x6c010),loggerService_1[_0x136803(0x1a1)][_0x136803(0x136)]('cointopay2',_0x136803(0x139),_0x6c010);throw new Error(_0x136803(0x17e)+(_0x6c010 instanceof Error?_0x6c010[_0x136803(0x15f)]:_0x136803(0x127)));}}async[a40_0xb43d7(0x17c)](_0x4ae984){const _0x9e5ae1=a40_0xb43d7,_0xffc27=await this[_0x9e5ae1(0x12b)](_0x4ae984);return{'status':_0xffc27['status'],'amount':_0xffc27[_0x9e5ae1(0x146)],'currency':_0xffc27[_0x9e5ae1(0x16d)]};}async[a40_0xb43d7(0x18f)](_0x163926){const _0x30db4=a40_0xb43d7;console[_0x30db4(0x12a)](_0x30db4(0x169),_0x163926);let _0x3fbff0='PENDING';switch(_0x163926['status']?.[_0x30db4(0x150)]()){case _0x30db4(0x181):_0x3fbff0=_0x30db4(0x131);break;case _0x30db4(0x12e):case'failed':case _0x30db4(0x165):_0x3fbff0=_0x30db4(0x177);break;case'expired':case _0x30db4(0x160):_0x3fbff0=_0x30db4(0x13f);break;case _0x30db4(0x187):case'waiting':case'awaiting\x20fiat':case _0x30db4(0x148):default:_0x3fbff0=_0x30db4(0x19f);break;}return{'paymentId':_0x163926[_0x30db4(0x153)]||_0x163926[_0x30db4(0x17b)]||'','status':_0x3fbff0,'amount':_0x163926[_0x30db4(0x146)],'currency':_0x163926[_0x30db4(0x16d)]||_0x30db4(0x145)};}}exports[a40_0xb43d7(0x144)]=CoinToPay2Service;