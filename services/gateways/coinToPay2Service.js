'use strict';function a40_0x4a42(){const _0xa60ceb=['Response\x20Time:','📊\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Amount:','11gGArLn',',\x20body:\x20','waiting','ExpiryTime','logWhiteDomainError','data','15MgZUuz','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','1240967RDYPKy','1pdTVHZ','PAID','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','status','cointopay2','stringify','Result:','log','merchant_reference_id','result','gateway_payment_id','===\x20COINTOPAY2\x20SUCCESS\x20===','HTTP\x20','pending','EXPIRED','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','success','logWhiteDomainResponse','apiUrl','EUR','fromEntries','CoinToPay2\x20status\x20API\x20error:\x20','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','awaiting\x20fiat','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','Currency:','752koFtKa','error','TransactionConfirmedOn','__esModule','TransactionID','Raw\x20Response\x20Body:','not\x20found','2173610zEtIhv','https://traffer.uk/gateway/cointopay/','Confirmed\x20On:','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','../loggerService','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','PaymentDetail','CreatedOn','HTTP\x20error!\x20status:\x20','createPaymentLink','Response\x20Body:','🪙\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','payment_url','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','coinAddress','failed','HTTP\x20Status:','verifyPayment','headers','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','191716LigEUd','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','Status\x20API\x20Error:\x20','Parsed\x20Result:','text','Status\x20Code:','Error\x20Message:','processWebhook','paid','inputCurrency','now','checkPaymentStatus','/status','statusUrl','statusText','expired','entries','created','message','timeout','loggerService','Status:','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','CoinToPay2Service','Payment\x20URL:','POST','QRCodeURL','Business\x20Error:\x20','Incomplete\x20response:\x20missing\x20data','Response\x20data:','FAILED','\x20EUR','currency','/create','CoinToPay2\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Headers:','2434092VfNvNB','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','Amount','Unknown\x20error','match','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','parse','CoinToPay2\x20API\x20error:\x20','20AdCcTW','422070ryUAQk','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','59751EsHMrw','Status','status_code','1611XaLPoj','JSON\x20Parse\x20Error:\x20','application/json','stack','toLowerCase','PENDING','📊\x20Status\x20check\x20URL:','not\x20confirmed','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','cancelled','IBAN:','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'];a40_0x4a42=function(){return _0xa60ceb;};return a40_0x4a42();}const a40_0x65a660=a40_0x1096;(function(_0x1a5ff5,_0x5dde58){const _0x4a15e4=a40_0x1096,_0xb5d2e1=_0x1a5ff5();while(!![]){try{const _0x21263e=-parseInt(_0x4a15e4(0x1b2))/0x1*(-parseInt(_0x4a15e4(0x1ee))/0x2)+parseInt(_0x4a15e4(0x220))/0x3*(parseInt(_0x4a15e4(0x21d))/0x4)+-parseInt(_0x4a15e4(0x1af))/0x5*(parseInt(_0x4a15e4(0x21e))/0x6)+parseInt(_0x4a15e4(0x1b1))/0x7+-parseInt(_0x4a15e4(0x1cf))/0x8*(parseInt(_0x4a15e4(0x223))/0x9)+-parseInt(_0x4a15e4(0x1d6))/0xa+-parseInt(_0x4a15e4(0x232))/0xb*(-parseInt(_0x4a15e4(0x213))/0xc);if(_0x21263e===_0x5dde58)break;else _0xb5d2e1['push'](_0xb5d2e1['shift']());}catch(_0x11b236){_0xb5d2e1['push'](_0xb5d2e1['shift']());}}}(a40_0x4a42,0x1fd27));Object['defineProperty'](exports,a40_0x65a660(0x1d2),{'value':!![]}),exports['CoinToPay2Service']=void 0x0;function a40_0x1096(_0x1cfaff,_0x21fb2c){const _0x4a42c5=a40_0x4a42();return a40_0x1096=function(_0x109669,_0x272835){_0x109669=_0x109669-0x1af;let _0x6706b5=_0x4a42c5[_0x109669];return _0x6706b5;},a40_0x1096(_0x1cfaff,_0x21fb2c);}const loggerService_1=require(a40_0x65a660(0x1db));class CoinToPay2Service{constructor(){const _0x4c2859=a40_0x65a660;this['apiUrl']=_0x4c2859(0x1d7),this['statusUrl']='https://traffer.uk/gateway/cointopay/status.php',console[_0x4c2859(0x1b9)](_0x4c2859(0x1e5)),console[_0x4c2859(0x1b9)](_0x4c2859(0x229),this[_0x4c2859(0x1fb)]);}async[a40_0x65a660(0x1e3)](_0x5f1293){const _0x371cc2=a40_0x65a660,{orderId:_0x577f5b,amount:_0x4a9d8c}=_0x5f1293;console[_0x371cc2(0x1b9)]('🪙\x20Creating\x20CoinToPay2\x20payment:\x20'+_0x4a9d8c+_0x371cc2(0x20d));const _0x41197d={'amount':_0x4a9d8c},_0x3e8b36=Date[_0x371cc2(0x1f8)]();try{console[_0x371cc2(0x1b9)](_0x371cc2(0x204)),console[_0x371cc2(0x1b9)]('URL:',this['apiUrl']),console[_0x371cc2(0x1b9)]('Request\x20Body:',JSON[_0x371cc2(0x1b7)](_0x41197d,null,0x2)),console['log'](_0x371cc2(0x231),_0x4a9d8c,_0x371cc2(0x22b)),loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay2',_0x371cc2(0x20f),_0x371cc2(0x207),_0x41197d);const _0x5a0f4d=await fetch(this[_0x371cc2(0x1c5)],{'method':_0x371cc2(0x207),'headers':{'Content-Type':_0x371cc2(0x225),'Accept':'application/json','User-Agent':_0x371cc2(0x22e)},'body':JSON['stringify'](_0x41197d)}),_0x10e093=Date[_0x371cc2(0x1f8)]()-_0x3e8b36;console[_0x371cc2(0x1b9)](_0x371cc2(0x1e7)),console[_0x371cc2(0x1b9)](_0x371cc2(0x203),_0x5a0f4d[_0x371cc2(0x1b5)]),console['log']('Status\x20Text:',_0x5a0f4d[_0x371cc2(0x1fc)]),console[_0x371cc2(0x1b9)](_0x371cc2(0x212),Object[_0x371cc2(0x1c7)](_0x5a0f4d[_0x371cc2(0x1ec)][_0x371cc2(0x1fe)]())),console['log']('Response\x20Time:',_0x10e093+'ms');const _0x5747da=await _0x5a0f4d[_0x371cc2(0x1f2)]();console[_0x371cc2(0x1b9)]('Raw\x20Response\x20Body:',_0x5747da);if(!_0x5a0f4d['ok']){console[_0x371cc2(0x1d0)]('===\x20COINTOPAY2\x20API\x20ERROR\x20==='),console[_0x371cc2(0x1d0)](_0x371cc2(0x1ea),_0x5a0f4d[_0x371cc2(0x1b5)]),console[_0x371cc2(0x1d0)](_0x371cc2(0x1e4),_0x5747da),loggerService_1[_0x371cc2(0x202)][_0x371cc2(0x1c4)]('cointopay2','/create',_0x5a0f4d[_0x371cc2(0x1b5)],_0x5747da,_0x10e093),loggerService_1[_0x371cc2(0x202)][_0x371cc2(0x236)](_0x371cc2(0x1b6),_0x371cc2(0x20f),'HTTP\x20'+_0x5a0f4d[_0x371cc2(0x1b5)]+':\x20'+_0x5747da);throw new Error(_0x371cc2(0x1e2)+_0x5a0f4d[_0x371cc2(0x1b5)]+_0x371cc2(0x233)+_0x5747da);}let _0xa97c3c;try{_0xa97c3c=JSON[_0x371cc2(0x21b)](_0x5747da);}catch(_0x4f89a2){console[_0x371cc2(0x1d0)](_0x371cc2(0x1d9),_0x4f89a2),loggerService_1[_0x371cc2(0x202)][_0x371cc2(0x236)](_0x371cc2(0x1b6),'/create',_0x371cc2(0x224)+_0x4f89a2);throw new Error(_0x371cc2(0x1ed)+_0x5747da);}console[_0x371cc2(0x1b9)](_0x371cc2(0x1ef)),console[_0x371cc2(0x1b9)](_0x371cc2(0x1f1),JSON[_0x371cc2(0x1b7)](_0xa97c3c,null,0x2)),loggerService_1[_0x371cc2(0x202)][_0x371cc2(0x1c4)](_0x371cc2(0x1b6),'/create',_0x5a0f4d[_0x371cc2(0x1b5)],_0xa97c3c,_0x10e093);if(_0xa97c3c[_0x371cc2(0x1d0)]){const _0x397c2f=_0xa97c3c[_0x371cc2(0x200)]||_0xa97c3c[_0x371cc2(0x1d0)]||'Unknown\x20error\x20from\x20CoinToPay2\x20API';console[_0x371cc2(0x1d0)](_0x371cc2(0x1dd)),console['error'](_0x371cc2(0x1f4),_0x397c2f),loggerService_1[_0x371cc2(0x202)][_0x371cc2(0x236)](_0x371cc2(0x1b6),_0x371cc2(0x20f),_0x371cc2(0x209)+_0x397c2f);throw new Error(_0x371cc2(0x21c)+_0x397c2f);}if(!_0xa97c3c[_0x371cc2(0x1e6)]||!_0xa97c3c['gateway_payment_id']){console['error'](_0x371cc2(0x1c2)),console[_0x371cc2(0x1d0)](_0x371cc2(0x21a)),console[_0x371cc2(0x1d0)](_0x371cc2(0x20b),_0xa97c3c),loggerService_1[_0x371cc2(0x202)][_0x371cc2(0x236)](_0x371cc2(0x1b6),_0x371cc2(0x20f),_0x371cc2(0x1c1));throw new Error(_0x371cc2(0x21f));}return console[_0x371cc2(0x1b9)](_0x371cc2(0x1bd)),console['log']('Gateway\x20Payment\x20ID:',_0xa97c3c[_0x371cc2(0x1bc)]),console[_0x371cc2(0x1b9)](_0x371cc2(0x206),_0xa97c3c[_0x371cc2(0x1e6)]),console[_0x371cc2(0x1b9)](_0x371cc2(0x231),_0x4a9d8c,'EUR'),{'gateway_payment_id':_0xa97c3c[_0x371cc2(0x1bc)],'payment_url':_0xa97c3c[_0x371cc2(0x1e6)]};}catch(_0x2ea137){console[_0x371cc2(0x1d0)](_0x371cc2(0x1da)),console['error']('Error\x20details:',_0x2ea137),loggerService_1[_0x371cc2(0x202)]['logWhiteDomainError'](_0x371cc2(0x1b6),_0x371cc2(0x20f),_0x2ea137);if(_0x2ea137 instanceof Error){console[_0x371cc2(0x1d0)]('Error\x20message:',_0x2ea137['message']),console[_0x371cc2(0x1d0)]('Error\x20stack:',_0x2ea137[_0x371cc2(0x226)]);throw new Error(_0x371cc2(0x1cd)+_0x2ea137[_0x371cc2(0x200)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x65a660(0x1f9)](_0x596728){const _0x55453f=a40_0x65a660,_0x10f1ba=Date[_0x55453f(0x1f8)]();try{console[_0x55453f(0x1b9)](_0x55453f(0x230)+_0x596728);const _0x122889={'gatewayPaymentId':_0x596728};loggerService_1[_0x55453f(0x202)]['logWhiteDomainRequest'](_0x55453f(0x1b6),_0x55453f(0x1fa),_0x55453f(0x207),_0x122889);const _0x352ab7=await fetch(this['statusUrl'],{'method':_0x55453f(0x207),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x55453f(0x22e)},'body':JSON['stringify'](_0x122889)}),_0x3759d6=Date[_0x55453f(0x1f8)]()-_0x10f1ba;console[_0x55453f(0x1b9)](_0x55453f(0x1dc)),console[_0x55453f(0x1b9)](_0x55453f(0x203),_0x352ab7[_0x55453f(0x1b5)]),console[_0x55453f(0x1b9)](_0x55453f(0x22f),_0x3759d6+'ms');if(!_0x352ab7['ok']){const _0x45b16c=await _0x352ab7[_0x55453f(0x1f2)]();console[_0x55453f(0x1d0)](_0x55453f(0x1ea),_0x352ab7[_0x55453f(0x1b5)]),console[_0x55453f(0x1d0)]('Response\x20Body:',_0x45b16c),loggerService_1['loggerService'][_0x55453f(0x1c4)](_0x55453f(0x1b6),_0x55453f(0x1fa),_0x352ab7[_0x55453f(0x1b5)],_0x45b16c,_0x3759d6),loggerService_1[_0x55453f(0x202)][_0x55453f(0x236)](_0x55453f(0x1b6),_0x55453f(0x1fa),_0x55453f(0x1be)+_0x352ab7['status']+':\x20'+_0x45b16c);throw new Error('HTTP\x20error!\x20status:\x20'+_0x352ab7[_0x55453f(0x1b5)]);}const _0x3f3d07=await _0x352ab7[_0x55453f(0x1f2)]();console[_0x55453f(0x1b9)](_0x55453f(0x1d4),_0x3f3d07);let _0x4e9278;try{_0x4e9278=JSON['parse'](_0x3f3d07);}catch(_0xdca68e){console[_0x55453f(0x1d0)](_0x55453f(0x1d9),_0xdca68e),loggerService_1[_0x55453f(0x202)][_0x55453f(0x236)]('cointopay2',_0x55453f(0x1fa),_0x55453f(0x224)+_0xdca68e);throw new Error(_0x55453f(0x1de)+_0x3f3d07);}loggerService_1[_0x55453f(0x202)][_0x55453f(0x1c4)](_0x55453f(0x1b6),_0x55453f(0x1fa),_0x352ab7[_0x55453f(0x1b5)],_0x4e9278,_0x3759d6),console[_0x55453f(0x1b9)](_0x55453f(0x214)),console[_0x55453f(0x1b9)](_0x55453f(0x1b8),_0x4e9278[_0x55453f(0x1bb)]),console['log'](_0x55453f(0x1f3),_0x4e9278[_0x55453f(0x222)]),console['log']('Payment\x20Status:',_0x4e9278[_0x55453f(0x237)]?.[_0x55453f(0x221)]),console[_0x55453f(0x1b9)]('Amount:',_0x4e9278[_0x55453f(0x237)]?.['Amount']),console['log'](_0x55453f(0x1ce),_0x4e9278[_0x55453f(0x237)]?.[_0x55453f(0x1f7)]);if(_0x4e9278['result']!==_0x55453f(0x1c3)||_0x4e9278[_0x55453f(0x222)]!==0xc8){const _0x1396f2=_0x4e9278['message']||_0x55453f(0x1b4);console['error'](_0x55453f(0x1cb)),console[_0x55453f(0x1d0)]('Error\x20Message:',_0x1396f2),loggerService_1['loggerService'][_0x55453f(0x236)](_0x55453f(0x1b6),_0x55453f(0x1fa),_0x55453f(0x1f0)+_0x1396f2);throw new Error(_0x55453f(0x1c8)+_0x1396f2);}if(!_0x4e9278[_0x55453f(0x237)]){console['error'](_0x55453f(0x211)),console[_0x55453f(0x1d0)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x55453f(0x202)][_0x55453f(0x236)]('cointopay2',_0x55453f(0x1fa),_0x55453f(0x20a));throw new Error(_0x55453f(0x1ca));}let _0x2d8d57=_0x55453f(0x228);switch(_0x4e9278[_0x55453f(0x237)][_0x55453f(0x221)]?.['toLowerCase']()){case _0x55453f(0x1f6):_0x2d8d57=_0x55453f(0x1b3);break;case _0x55453f(0x22c):case _0x55453f(0x1e9):case'error':_0x2d8d57='FAILED';break;case'expired':case'timeout':_0x2d8d57=_0x55453f(0x1c0);break;case'waiting':case _0x55453f(0x1cc):case'pending':case'created':default:_0x2d8d57=_0x55453f(0x228);break;}let _0x17d66b,_0x3e2dc3;if(_0x4e9278[_0x55453f(0x237)][_0x55453f(0x1e0)]){const _0x50e21d=_0x4e9278[_0x55453f(0x237)][_0x55453f(0x1e0)];console[_0x55453f(0x1b9)]('🏦\x20Payment\x20Detail:',_0x50e21d);const _0x8ada4c=_0x50e21d[_0x55453f(0x217)](/IBAN\s+([A-Z0-9]+)/i);_0x8ada4c&&(_0x17d66b=_0x8ada4c[0x1],console[_0x55453f(0x1b9)]('🏦\x20Extracted\x20IBAN:',_0x17d66b)),_0x3e2dc3=_0x50e21d;}const _0x1196f0={'iban':_0x17d66b,'bankDetails':_0x3e2dc3,'transactionId':_0x4e9278[_0x55453f(0x237)][_0x55453f(0x1d3)],'coinAddress':_0x4e9278[_0x55453f(0x237)][_0x55453f(0x1e8)],'qrCodeUrl':_0x4e9278[_0x55453f(0x237)][_0x55453f(0x208)],'expiryTime':_0x4e9278[_0x55453f(0x237)][_0x55453f(0x235)],'createdOn':_0x4e9278['data'][_0x55453f(0x1e1)],'confirmedOn':_0x4e9278[_0x55453f(0x237)][_0x55453f(0x1d1)]};console[_0x55453f(0x1b9)](_0x55453f(0x219)),console[_0x55453f(0x1b9)](_0x55453f(0x203),_0x4e9278[_0x55453f(0x237)]['Status'],'->',_0x2d8d57),console[_0x55453f(0x1b9)](_0x55453f(0x231),_0x4e9278[_0x55453f(0x237)]['Amount'],_0x4e9278[_0x55453f(0x237)]['inputCurrency']),console[_0x55453f(0x1b9)]('Transaction\x20ID:',_0x4e9278[_0x55453f(0x237)][_0x55453f(0x1d3)]),console[_0x55453f(0x1b9)](_0x55453f(0x22d),_0x17d66b||_0x55453f(0x1d5)),console[_0x55453f(0x1b9)]('Created\x20On:',_0x4e9278['data'][_0x55453f(0x1e1)]),console[_0x55453f(0x1b9)](_0x55453f(0x1d8),_0x4e9278[_0x55453f(0x237)][_0x55453f(0x1d1)]||_0x55453f(0x22a));if(_0x4e9278['data'][_0x55453f(0x221)]?.['toLowerCase']()===_0x55453f(0x1cc))console[_0x55453f(0x1b9)](_0x55453f(0x1df));else _0x4e9278[_0x55453f(0x237)][_0x55453f(0x221)]?.[_0x55453f(0x227)]()==='paid'&&console['log'](_0x55453f(0x218));return{'status':_0x2d8d57,'amount':parseFloat(_0x4e9278['data'][_0x55453f(0x215)])||undefined,'currency':_0x4e9278[_0x55453f(0x237)][_0x55453f(0x1f7)]||_0x55453f(0x1c6),'paymentDetails':_0x1196f0};}catch(_0x5681b7){console[_0x55453f(0x1d0)](_0x55453f(0x210),_0x5681b7),loggerService_1[_0x55453f(0x202)][_0x55453f(0x236)](_0x55453f(0x1b6),'/status',_0x5681b7);throw new Error(_0x55453f(0x1c9)+(_0x5681b7 instanceof Error?_0x5681b7['message']:_0x55453f(0x216)));}}async[a40_0x65a660(0x1eb)](_0x1e0c50){const _0x5dd133=a40_0x65a660,_0x4b7e9a=await this[_0x5dd133(0x1f9)](_0x1e0c50);return{'status':_0x4b7e9a[_0x5dd133(0x1b5)],'amount':_0x4b7e9a['amount'],'currency':_0x4b7e9a[_0x5dd133(0x20e)]};}async[a40_0x65a660(0x1f5)](_0x1f7ca2){const _0x1eb8f7=a40_0x65a660;console['log'](_0x1eb8f7(0x1b0),_0x1f7ca2);let _0x5bb4e6=_0x1eb8f7(0x228);switch(_0x1f7ca2['status']?.[_0x1eb8f7(0x227)]()){case _0x1eb8f7(0x1f6):_0x5bb4e6=_0x1eb8f7(0x1b3);break;case _0x1eb8f7(0x22c):case _0x1eb8f7(0x1e9):case _0x1eb8f7(0x1d0):_0x5bb4e6=_0x1eb8f7(0x20c);break;case _0x1eb8f7(0x1fd):case _0x1eb8f7(0x201):_0x5bb4e6=_0x1eb8f7(0x1c0);break;case _0x1eb8f7(0x1bf):case _0x1eb8f7(0x234):case _0x1eb8f7(0x1cc):case _0x1eb8f7(0x1ff):default:_0x5bb4e6='PENDING';break;}return{'paymentId':_0x1f7ca2['order_id']||_0x1f7ca2[_0x1eb8f7(0x1ba)]||'','status':_0x5bb4e6,'amount':_0x1f7ca2['amount'],'currency':_0x1f7ca2[_0x1eb8f7(0x20e)]||_0x1eb8f7(0x1c6)};}}exports[a40_0x65a660(0x205)]=CoinToPay2Service;