'use strict';const a54_0x6b91da=a54_0x33ec;(function(_0x1a3fbe,_0x416b46){const _0x40aa77=a54_0x33ec,_0x371f6a=_0x1a3fbe();while(!![]){try{const _0xda68da=parseInt(_0x40aa77(0x125))/0x1*(-parseInt(_0x40aa77(0x133))/0x2)+-parseInt(_0x40aa77(0x12d))/0x3+-parseInt(_0x40aa77(0x12c))/0x4+-parseInt(_0x40aa77(0x172))/0x5*(parseInt(_0x40aa77(0x176))/0x6)+-parseInt(_0x40aa77(0x19f))/0x7*(parseInt(_0x40aa77(0x17f))/0x8)+-parseInt(_0x40aa77(0x183))/0x9+parseInt(_0x40aa77(0x190))/0xa;if(_0xda68da===_0x416b46)break;else _0x371f6a['push'](_0x371f6a['shift']());}catch(_0x197f6d){_0x371f6a['push'](_0x371f6a['shift']());}}}(a54_0x2ba5,0x74e30));function a54_0x2ba5(){const _0x45fb25=['Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','QRCodeURL','CoinToPay2\x20status\x20API\x20error:\x20','Gateway\x20Payment\x20ID:','now','stack','apiUrl','HTTP\x20Status:','Error\x20stack:','CoinToPay2Service','error','235RRKxmS','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','cancelled','status','65862nBzOsm','log','https://traffer.uk/gateway/cointopay/status.php','coinAddress','CreatedOn','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','text','7952QPDmZI','success','Amount','statusUrl','910035kxcOlC','Error\x20details:','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','failed','order_id','paid','CoinToPay2\x20API\x20error:\x20','Amount:','logWhiteDomainRequest','HTTP\x20error!\x20status:\x20','PAID','Business\x20Error:\x20','cointopay2','34793500okElxs','waiting','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','stringify','HTTP\x20',',\x20body:\x20','timeout','Incomplete\x20response:\x20missing\x20data','source','PaymentDetail','EUR','JSON\x20Parse\x20Error:\x20','not\x20found','data','\x20EUR','6174ngdqoD','not\x20confirmed','Payment\x20URL\x20(original):','===\x20COINTOPAY2\x20SUCCESS\x20===','Result:','message','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','gateway_payment_id','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','TransactionConfirmedOn','parse','Failed\x20to\x20parse\x20JSON\x20response:','Status:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','awaiting\x20fiat','üè¶\x20Payment\x20Detail:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','createPaymentLink','loggerService','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','825593eTYywQ','EXPIRED','IBAN:','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','status_code','application/json','URL:','1986820vYRNrD','553626ONDxFQ','toLowerCase','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...','POST','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','2ftqPvy','inputCurrency','created','Raw\x20Response\x20Body:','pending','https://traffer.uk/gateway/cointopay/','payment_url','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','Request\x20Body:','Response\x20Body:','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','Confirmed\x20On:','Currency:','fromEntries','match','Error\x20Message:','/status','Payment\x20System/1.0\x20(CoinToPay2)','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','Missing\x20data\x20in\x20response','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','../loggerService','merchant_reference_id','logWhiteDomainError','FAILED','expired','Error\x20message:','TransactionID','Unknown\x20error\x20from\x20CoinToPay2\x20API','currency','===\x20COINTOPAY2\x20API\x20ERROR\x20===','PENDING','statusText','Response\x20Time:','/create','logWhiteDomainResponse','__esModule','checkPaymentStatus','Status','Payment\x20Status:','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','Status\x20Code:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','processWebhook','Transaction\x20ID:','amount','üè¶\x20Extracted\x20IBAN:','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','Status\x20API\x20Error:\x20','Response\x20data:','ExpiryTime'];a54_0x2ba5=function(){return _0x45fb25;};return a54_0x2ba5();}Object['defineProperty'](exports,a54_0x6b91da(0x158),{'value':!![]}),exports[a54_0x6b91da(0x170)]=void 0x0;const loggerService_1=require(a54_0x6b91da(0x149));class CoinToPay2Service{constructor(){const _0x39d48=a54_0x6b91da;this['apiUrl']=_0x39d48(0x138),this[_0x39d48(0x182)]=_0x39d48(0x178),console[_0x39d48(0x177)]('ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0x39d48(0x177)]('üìä\x20Status\x20check\x20URL:',this[_0x39d48(0x182)]);}async[a54_0x6b91da(0x122)](_0x1c4e4e){const _0x5e781d=a54_0x6b91da,{orderId:_0x71e828,amount:_0x5895b2}=_0x1c4e4e;console['log'](_0x5e781d(0x1a5)+_0x5895b2+_0x5e781d(0x19e));const _0x4fd204={'amount':_0x5895b2},_0x23ae8f=Date[_0x5e781d(0x16b)]();try{console[_0x5e781d(0x177)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console['log'](_0x5e781d(0x12b),this[_0x5e781d(0x16d)]),console[_0x5e781d(0x177)](_0x5e781d(0x13b),JSON[_0x5e781d(0x193)](_0x4fd204,null,0x2)),console[_0x5e781d(0x177)]('Amount:',_0x5895b2,_0x5e781d(0x163)),loggerService_1[_0x5e781d(0x123)][_0x5e781d(0x18b)](_0x5e781d(0x18f),_0x5e781d(0x156),_0x5e781d(0x131),_0x4fd204);const _0xc1672c=await fetch(this[_0x5e781d(0x16d)],{'method':'POST','headers':{'Content-Type':_0x5e781d(0x12a),'Accept':_0x5e781d(0x12a),'User-Agent':_0x5e781d(0x144)},'body':JSON['stringify'](_0x4fd204)}),_0xfb16b5=Date['now']()-_0x23ae8f;console[_0x5e781d(0x177)](_0x5e781d(0x12f)),console['log']('Status:',_0xc1672c[_0x5e781d(0x175)]),console[_0x5e781d(0x177)]('Status\x20Text:',_0xc1672c[_0x5e781d(0x154)]),console[_0x5e781d(0x177)]('Headers:',Object[_0x5e781d(0x140)](_0xc1672c['headers']['entries']())),console[_0x5e781d(0x177)](_0x5e781d(0x155),_0xfb16b5+'ms');const _0x14aadb=await _0xc1672c[_0x5e781d(0x17e)]();console[_0x5e781d(0x177)](_0x5e781d(0x136),_0x14aadb);if(!_0xc1672c['ok']){console[_0x5e781d(0x171)](_0x5e781d(0x152)),console[_0x5e781d(0x171)](_0x5e781d(0x16e),_0xc1672c['status']),console[_0x5e781d(0x171)](_0x5e781d(0x13c),_0x14aadb),loggerService_1[_0x5e781d(0x123)][_0x5e781d(0x157)](_0x5e781d(0x18f),_0x5e781d(0x156),_0xc1672c[_0x5e781d(0x175)],_0x14aadb,_0xfb16b5),loggerService_1[_0x5e781d(0x123)][_0x5e781d(0x14b)](_0x5e781d(0x18f),_0x5e781d(0x156),_0x5e781d(0x194)+_0xc1672c[_0x5e781d(0x175)]+':\x20'+_0x14aadb);throw new Error(_0x5e781d(0x18c)+_0xc1672c['status']+_0x5e781d(0x195)+_0x14aadb);}let _0x4032b4;try{_0x4032b4=JSON['parse'](_0x14aadb);}catch(_0x465a1b){console[_0x5e781d(0x171)](_0x5e781d(0x1aa),_0x465a1b),loggerService_1[_0x5e781d(0x123)][_0x5e781d(0x14b)]('cointopay2',_0x5e781d(0x156),_0x5e781d(0x19b)+_0x465a1b);throw new Error(_0x5e781d(0x167)+_0x14aadb);}console[_0x5e781d(0x177)](_0x5e781d(0x1ac)),console[_0x5e781d(0x177)]('Parsed\x20Result:',JSON[_0x5e781d(0x193)](_0x4032b4,null,0x2)),loggerService_1['loggerService'][_0x5e781d(0x157)](_0x5e781d(0x18f),_0x5e781d(0x156),_0xc1672c[_0x5e781d(0x175)],_0x4032b4,_0xfb16b5);if(_0x4032b4[_0x5e781d(0x171)]){const _0x2ca261=_0x4032b4['message']||_0x4032b4[_0x5e781d(0x171)]||_0x5e781d(0x150);console['error'](_0x5e781d(0x192)),console[_0x5e781d(0x171)](_0x5e781d(0x142),_0x2ca261),loggerService_1[_0x5e781d(0x123)]['logWhiteDomainError']('cointopay2',_0x5e781d(0x156),_0x5e781d(0x18e)+_0x2ca261);throw new Error(_0x5e781d(0x189)+_0x2ca261);}if(!_0x4032b4[_0x5e781d(0x139)]||!_0x4032b4[_0x5e781d(0x1a6)]){console[_0x5e781d(0x171)](_0x5e781d(0x147)),console[_0x5e781d(0x171)](_0x5e781d(0x17c)),console[_0x5e781d(0x171)](_0x5e781d(0x165),_0x4032b4),loggerService_1[_0x5e781d(0x123)][_0x5e781d(0x14b)]('cointopay2',_0x5e781d(0x156),_0x5e781d(0x15e));throw new Error(_0x5e781d(0x128));}console[_0x5e781d(0x177)](_0x5e781d(0x1a2)),console['log'](_0x5e781d(0x16a),_0x4032b4[_0x5e781d(0x1a6)]),console[_0x5e781d(0x177)](_0x5e781d(0x1a1),_0x4032b4['payment_url']);const _0x52cfef=_0x4032b4[_0x5e781d(0x139)]+'&alternative=false';return console[_0x5e781d(0x177)]('Payment\x20URL\x20(modified):',_0x52cfef),console[_0x5e781d(0x177)](_0x5e781d(0x18a),_0x5895b2,_0x5e781d(0x19a)),{'gateway_payment_id':_0x4032b4[_0x5e781d(0x1a6)],'payment_url':_0x52cfef};}catch(_0x52b75e){console[_0x5e781d(0x171)](_0x5e781d(0x132)),console['error'](_0x5e781d(0x184),_0x52b75e),loggerService_1[_0x5e781d(0x123)][_0x5e781d(0x14b)]('cointopay2',_0x5e781d(0x156),_0x52b75e);if(_0x52b75e instanceof Error){console[_0x5e781d(0x171)](_0x5e781d(0x14e),_0x52b75e[_0x5e781d(0x1a4)]),console[_0x5e781d(0x171)](_0x5e781d(0x16f),_0x52b75e[_0x5e781d(0x16c)]);throw new Error(_0x5e781d(0x1a7)+_0x52b75e[_0x5e781d(0x1a4)]);}throw new Error(_0x5e781d(0x173));}}async[a54_0x6b91da(0x159)](_0x456544){const _0x4590d4=a54_0x6b91da,_0x91aafa=Date[_0x4590d4(0x16b)]();try{console[_0x4590d4(0x177)]('üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20'+_0x456544);const _0x28da5a={'gatewayPaymentId':_0x456544};loggerService_1['loggerService'][_0x4590d4(0x18b)](_0x4590d4(0x18f),_0x4590d4(0x143),_0x4590d4(0x131),_0x28da5a);const _0x1052b3=await fetch(this[_0x4590d4(0x182)],{'method':_0x4590d4(0x131),'headers':{'Content-Type':_0x4590d4(0x12a),'Accept':_0x4590d4(0x12a),'User-Agent':_0x4590d4(0x144)},'body':JSON[_0x4590d4(0x193)](_0x28da5a)}),_0x3c32b6=Date['now']()-_0x91aafa;console[_0x4590d4(0x177)](_0x4590d4(0x145)),console[_0x4590d4(0x177)](_0x4590d4(0x1ab),_0x1052b3[_0x4590d4(0x175)]),console[_0x4590d4(0x177)](_0x4590d4(0x155),_0x3c32b6+'ms');if(!_0x1052b3['ok']){const _0x24c332=await _0x1052b3['text']();console[_0x4590d4(0x171)](_0x4590d4(0x16e),_0x1052b3[_0x4590d4(0x175)]),console['error'](_0x4590d4(0x13c),_0x24c332),loggerService_1[_0x4590d4(0x123)][_0x4590d4(0x157)](_0x4590d4(0x18f),_0x4590d4(0x143),_0x1052b3[_0x4590d4(0x175)],_0x24c332,_0x3c32b6),loggerService_1[_0x4590d4(0x123)]['logWhiteDomainError'](_0x4590d4(0x18f),_0x4590d4(0x143),'HTTP\x20'+_0x1052b3[_0x4590d4(0x175)]+':\x20'+_0x24c332);throw new Error(_0x4590d4(0x18c)+_0x1052b3[_0x4590d4(0x175)]);}const _0x29f327=await _0x1052b3[_0x4590d4(0x17e)]();console[_0x4590d4(0x177)](_0x4590d4(0x136),_0x29f327);let _0x381add;try{_0x381add=JSON[_0x4590d4(0x1a9)](_0x29f327);}catch(_0x5492ba){console['error'](_0x4590d4(0x1aa),_0x5492ba),loggerService_1[_0x4590d4(0x123)][_0x4590d4(0x14b)](_0x4590d4(0x18f),_0x4590d4(0x143),_0x4590d4(0x19b)+_0x5492ba);throw new Error(_0x4590d4(0x13a)+_0x29f327);}loggerService_1['loggerService'][_0x4590d4(0x157)](_0x4590d4(0x18f),_0x4590d4(0x143),_0x1052b3[_0x4590d4(0x175)],_0x381add,_0x3c32b6),console[_0x4590d4(0x177)](_0x4590d4(0x13d)),console[_0x4590d4(0x177)](_0x4590d4(0x1a3),_0x381add['result']),console[_0x4590d4(0x177)](_0x4590d4(0x15d),_0x381add[_0x4590d4(0x129)]),console[_0x4590d4(0x177)](_0x4590d4(0x15b),_0x381add[_0x4590d4(0x19d)]?.[_0x4590d4(0x15a)]),console[_0x4590d4(0x177)](_0x4590d4(0x18a),_0x381add['data']?.[_0x4590d4(0x181)]),console[_0x4590d4(0x177)](_0x4590d4(0x13f),_0x381add[_0x4590d4(0x19d)]?.[_0x4590d4(0x134)]);if(_0x381add['result']!==_0x4590d4(0x180)||_0x381add[_0x4590d4(0x129)]!==0xc8){const _0x78083=_0x381add[_0x4590d4(0x1a4)]||_0x4590d4(0x17b);console[_0x4590d4(0x171)](_0x4590d4(0x185)),console['error']('Error\x20Message:',_0x78083),loggerService_1[_0x4590d4(0x123)][_0x4590d4(0x14b)]('cointopay2',_0x4590d4(0x143),_0x4590d4(0x164)+_0x78083);throw new Error(_0x4590d4(0x169)+_0x78083);}if(!_0x381add['data']){console['error'](_0x4590d4(0x148)),console[_0x4590d4(0x171)](_0x4590d4(0x146)),loggerService_1[_0x4590d4(0x123)][_0x4590d4(0x14b)](_0x4590d4(0x18f),_0x4590d4(0x143),_0x4590d4(0x197));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data');}let _0x5b23e1=_0x4590d4(0x153);switch(_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x15a)]?.[_0x4590d4(0x12e)]()){case _0x4590d4(0x188):_0x5b23e1=_0x4590d4(0x18d);break;case _0x4590d4(0x174):case _0x4590d4(0x186):case _0x4590d4(0x171):_0x5b23e1='FAILED';break;case _0x4590d4(0x14d):case _0x4590d4(0x196):_0x5b23e1=_0x4590d4(0x126);break;case _0x4590d4(0x191):case _0x4590d4(0x1ad):case _0x4590d4(0x137):case _0x4590d4(0x135):default:_0x5b23e1=_0x4590d4(0x153);break;}let _0x57b264,_0x56e7be;if(_0x381add['data'][_0x4590d4(0x199)]){const _0x4e02b4=_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x199)];console[_0x4590d4(0x177)](_0x4590d4(0x1ae),_0x4e02b4);const _0x3ccd48=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x3fbdc4 of _0x3ccd48){const _0x4ece9f=_0x4e02b4['match'](_0x3fbdc4);if(_0x4ece9f){_0x57b264=_0x4ece9f[0x1],console['log'](_0x4590d4(0x162),_0x57b264,'using\x20pattern:',_0x3fbdc4[_0x4590d4(0x198)]);break;}}if(!_0x57b264){console[_0x4590d4(0x177)](_0x4590d4(0x130));const _0x222f48=_0x4e02b4[_0x4590d4(0x141)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x222f48&&(_0x57b264=_0x222f48[0x1],console[_0x4590d4(0x177)](_0x4590d4(0x17d),_0x57b264));}_0x56e7be=_0x4e02b4;}const _0x5d7dd8={'iban':_0x57b264,'bankDetails':_0x56e7be,'transactionId':_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x14f)],'coinAddress':_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x179)],'qrCodeUrl':_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x168)],'expiryTime':_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x166)],'createdOn':_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x17a)],'confirmedOn':_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x1a8)]};console[_0x4590d4(0x177)](_0x4590d4(0x15c)),console[_0x4590d4(0x177)]('Status:',_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x15a)],'->',_0x5b23e1),console[_0x4590d4(0x177)](_0x4590d4(0x18a),_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x181)],_0x381add[_0x4590d4(0x19d)]['inputCurrency']),console[_0x4590d4(0x177)](_0x4590d4(0x160),_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x14f)]),console[_0x4590d4(0x177)](_0x4590d4(0x127),_0x57b264||_0x4590d4(0x19c)),console[_0x4590d4(0x177)]('Created\x20On:',_0x381add['data'][_0x4590d4(0x17a)]),console['log'](_0x4590d4(0x13e),_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x1a8)]||_0x4590d4(0x1a0));if(_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x15a)]?.[_0x4590d4(0x12e)]()===_0x4590d4(0x1ad))console[_0x4590d4(0x177)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x381add[_0x4590d4(0x19d)][_0x4590d4(0x15a)]?.[_0x4590d4(0x12e)]()===_0x4590d4(0x188)&&console['log'](_0x4590d4(0x1af));return{'status':_0x5b23e1,'amount':parseFloat(_0x381add[_0x4590d4(0x19d)]['Amount'])||undefined,'currency':_0x381add[_0x4590d4(0x19d)][_0x4590d4(0x134)]||_0x4590d4(0x19a),'paymentDetails':_0x5d7dd8};}catch(_0x4614a9){console['error']('CoinToPay2\x20payment\x20status\x20check\x20error:',_0x4614a9),loggerService_1['loggerService'][_0x4590d4(0x14b)](_0x4590d4(0x18f),_0x4590d4(0x143),_0x4614a9);throw new Error(_0x4590d4(0x124)+(_0x4614a9 instanceof Error?_0x4614a9['message']:'Unknown\x20error'));}}async['verifyPayment'](_0x1c3381){const _0xf20245=a54_0x6b91da,_0x5be62a=await this[_0xf20245(0x159)](_0x1c3381);return{'status':_0x5be62a[_0xf20245(0x175)],'amount':_0x5be62a[_0xf20245(0x161)],'currency':_0x5be62a[_0xf20245(0x151)]};}async[a54_0x6b91da(0x15f)](_0x5816de){const _0x362119=a54_0x6b91da;console[_0x362119(0x177)]('Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x5816de);let _0x130fb2=_0x362119(0x153);switch(_0x5816de[_0x362119(0x175)]?.[_0x362119(0x12e)]()){case _0x362119(0x188):_0x130fb2='PAID';break;case'cancelled':case _0x362119(0x186):case _0x362119(0x171):_0x130fb2=_0x362119(0x14c);break;case'expired':case _0x362119(0x196):_0x130fb2='EXPIRED';break;case _0x362119(0x137):case'waiting':case _0x362119(0x1ad):case _0x362119(0x135):default:_0x130fb2=_0x362119(0x153);break;}return{'paymentId':_0x5816de[_0x362119(0x187)]||_0x5816de[_0x362119(0x14a)]||'','status':_0x130fb2,'amount':_0x5816de['amount'],'currency':_0x5816de[_0x362119(0x151)]||'EUR'};}}function a54_0x33ec(_0x125b89,_0x235609){_0x125b89=_0x125b89-0x122;const _0x2ba531=a54_0x2ba5();let _0x33ec99=_0x2ba531[_0x125b89];return _0x33ec99;}exports[a54_0x6b91da(0x170)]=CoinToPay2Service;