'use strict';function a42_0x498f(_0x4dcb44,_0x5551a2){const _0x4e9f07=a42_0x4e9f();return a42_0x498f=function(_0x498fce,_0x2b43fb){_0x498fce=_0x498fce-0x122;let _0x123235=_0x4e9f07[_0x498fce];return _0x123235;},a42_0x498f(_0x4dcb44,_0x5551a2);}const a42_0x1db0be=a42_0x498f;(function(_0x171604,_0x5bc0e){const _0x335f72=a42_0x498f,_0x5da8cc=_0x171604();while(!![]){try{const _0x470493=-parseInt(_0x335f72(0x18f))/0x1*(-parseInt(_0x335f72(0x143))/0x2)+-parseInt(_0x335f72(0x12b))/0x3+-parseInt(_0x335f72(0x19c))/0x4*(parseInt(_0x335f72(0x142))/0x5)+parseInt(_0x335f72(0x132))/0x6+-parseInt(_0x335f72(0x1a6))/0x7*(parseInt(_0x335f72(0x178))/0x8)+parseInt(_0x335f72(0x15f))/0x9*(-parseInt(_0x335f72(0x188))/0xa)+parseInt(_0x335f72(0x14b))/0xb*(parseInt(_0x335f72(0x160))/0xc);if(_0x470493===_0x5bc0e)break;else _0x5da8cc['push'](_0x5da8cc['shift']());}catch(_0x5d753b){_0x5da8cc['push'](_0x5da8cc['shift']());}}}(a42_0x4e9f,0x94315));Object['defineProperty'](exports,a42_0x1db0be(0x129),{'value':!![]}),exports[a42_0x1db0be(0x196)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPay2Service{constructor(){const _0x2c3391=a42_0x1db0be;this[_0x2c3391(0x125)]=_0x2c3391(0x126),this[_0x2c3391(0x14a)]=_0x2c3391(0x17b),console[_0x2c3391(0x13a)](_0x2c3391(0x123)),console[_0x2c3391(0x13a)](_0x2c3391(0x189),this[_0x2c3391(0x14a)]);}async[a42_0x1db0be(0x19d)](_0x35419e){const _0x263116=a42_0x1db0be,{orderId:_0x47797d,amount:_0x34d1a8}=_0x35419e;console['log'](_0x263116(0x161)+_0x34d1a8+_0x263116(0x17f));const _0x580680={'amount':_0x34d1a8},_0x1d258f=Date[_0x263116(0x1a0)]();try{console['log'](_0x263116(0x19b)),console['log'](_0x263116(0x181),this[_0x263116(0x125)]),console[_0x263116(0x13a)](_0x263116(0x19a),JSON[_0x263116(0x13d)](_0x580680,null,0x2)),console[_0x263116(0x13a)](_0x263116(0x175),_0x34d1a8,'EUR\x20(always\x20EUR\x20for\x20CoinToPay2)'),loggerService_1[_0x263116(0x159)][_0x263116(0x16c)](_0x263116(0x179),'/create',_0x263116(0x177),_0x580680);const _0x1e13b0=await fetch(this[_0x263116(0x125)],{'method':'POST','headers':{'Content-Type':_0x263116(0x13b),'Accept':_0x263116(0x13b),'User-Agent':_0x263116(0x174)},'body':JSON[_0x263116(0x13d)](_0x580680)}),_0x50a9db=Date[_0x263116(0x1a0)]()-_0x1d258f;console[_0x263116(0x13a)]('===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20==='),console[_0x263116(0x13a)](_0x263116(0x194),_0x1e13b0[_0x263116(0x124)]),console[_0x263116(0x13a)]('Status\x20Text:',_0x1e13b0['statusText']),console[_0x263116(0x13a)]('Headers:',Object[_0x263116(0x1a5)](_0x1e13b0[_0x263116(0x16d)][_0x263116(0x19f)]())),console[_0x263116(0x13a)]('Response\x20Time:',_0x50a9db+'ms');const _0x91e8da=await _0x1e13b0[_0x263116(0x182)]();console['log'](_0x263116(0x150),_0x91e8da);if(!_0x1e13b0['ok']){console[_0x263116(0x135)](_0x263116(0x1a1)),console[_0x263116(0x135)](_0x263116(0x199),_0x1e13b0[_0x263116(0x124)]),console['error']('Response\x20Body:',_0x91e8da),loggerService_1['loggerService'][_0x263116(0x183)](_0x263116(0x179),_0x263116(0x1ac),_0x1e13b0[_0x263116(0x124)],_0x91e8da,_0x50a9db),loggerService_1[_0x263116(0x159)][_0x263116(0x14c)]('cointopay2',_0x263116(0x1ac),_0x263116(0x1a8)+_0x1e13b0[_0x263116(0x124)]+':\x20'+_0x91e8da);throw new Error(_0x263116(0x173)+_0x1e13b0[_0x263116(0x124)]+',\x20body:\x20'+_0x91e8da);}let _0x4e14d2;try{_0x4e14d2=JSON[_0x263116(0x12c)](_0x91e8da);}catch(_0x46a811){console[_0x263116(0x135)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x46a811),loggerService_1[_0x263116(0x159)][_0x263116(0x14c)](_0x263116(0x179),_0x263116(0x1ac),'JSON\x20Parse\x20Error:\x20'+_0x46a811);throw new Error(_0x263116(0x163)+_0x91e8da);}console[_0x263116(0x13a)](_0x263116(0x195)),console['log'](_0x263116(0x169),JSON[_0x263116(0x13d)](_0x4e14d2,null,0x2)),loggerService_1[_0x263116(0x159)][_0x263116(0x183)](_0x263116(0x179),_0x263116(0x1ac),_0x1e13b0['status'],_0x4e14d2,_0x50a9db);if(_0x4e14d2[_0x263116(0x135)]){const _0x44cd56=_0x4e14d2[_0x263116(0x1ad)]||_0x4e14d2['error']||_0x263116(0x184);console['error'](_0x263116(0x13e)),console[_0x263116(0x135)]('Error\x20Message:',_0x44cd56),loggerService_1[_0x263116(0x159)]['logWhiteDomainError'](_0x263116(0x179),_0x263116(0x1ac),_0x263116(0x172)+_0x44cd56);throw new Error(_0x263116(0x166)+_0x44cd56);}if(!_0x4e14d2['payment_url']||!_0x4e14d2[_0x263116(0x1a4)]){console['error'](_0x263116(0x16b)),console['error'](_0x263116(0x191)),console[_0x263116(0x135)](_0x263116(0x1ae),_0x4e14d2),loggerService_1[_0x263116(0x159)][_0x263116(0x14c)]('cointopay2',_0x263116(0x1ac),_0x263116(0x180));throw new Error(_0x263116(0x15e));}return console['log'](_0x263116(0x17e)),console[_0x263116(0x13a)]('Gateway\x20Payment\x20ID:',_0x4e14d2[_0x263116(0x1a4)]),console[_0x263116(0x13a)]('Payment\x20URL:',_0x4e14d2[_0x263116(0x1a9)]),console[_0x263116(0x13a)](_0x263116(0x175),_0x34d1a8,_0x263116(0x15b)),{'gateway_payment_id':_0x4e14d2[_0x263116(0x1a4)],'payment_url':_0x4e14d2[_0x263116(0x1a9)]};}catch(_0x12b01e){console['error'](_0x263116(0x12d)),console[_0x263116(0x135)](_0x263116(0x147),_0x12b01e),loggerService_1[_0x263116(0x159)][_0x263116(0x14c)](_0x263116(0x179),_0x263116(0x1ac),_0x12b01e);if(_0x12b01e instanceof Error){console[_0x263116(0x135)](_0x263116(0x13c),_0x12b01e[_0x263116(0x1ad)]),console[_0x263116(0x135)](_0x263116(0x18e),_0x12b01e['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20'+_0x12b01e['message']);}throw new Error(_0x263116(0x18b));}}async[a42_0x1db0be(0x16e)](_0x5043a2){const _0x1add00=a42_0x1db0be,_0x46316e=Date[_0x1add00(0x1a0)]();try{console[_0x1add00(0x13a)](_0x1add00(0x140)+_0x5043a2);const _0xbc5d2a={'gatewayPaymentId':_0x5043a2};loggerService_1[_0x1add00(0x159)]['logWhiteDomainRequest'](_0x1add00(0x179),_0x1add00(0x138),_0x1add00(0x177),_0xbc5d2a);const _0x322c05=await fetch(this['statusUrl'],{'method':_0x1add00(0x177),'headers':{'Content-Type':_0x1add00(0x13b),'Accept':_0x1add00(0x13b),'User-Agent':_0x1add00(0x174)},'body':JSON[_0x1add00(0x13d)](_0xbc5d2a)}),_0x416a15=Date[_0x1add00(0x1a0)]()-_0x46316e;console[_0x1add00(0x13a)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x1add00(0x13a)](_0x1add00(0x194),_0x322c05[_0x1add00(0x124)]),console[_0x1add00(0x13a)](_0x1add00(0x122),_0x416a15+'ms');if(!_0x322c05['ok']){const _0x415c8f=await _0x322c05[_0x1add00(0x182)]();console[_0x1add00(0x135)]('HTTP\x20Status:',_0x322c05[_0x1add00(0x124)]),console[_0x1add00(0x135)](_0x1add00(0x168),_0x415c8f),loggerService_1[_0x1add00(0x159)][_0x1add00(0x183)]('cointopay2',_0x1add00(0x138),_0x322c05[_0x1add00(0x124)],_0x415c8f,_0x416a15),loggerService_1[_0x1add00(0x159)][_0x1add00(0x14c)](_0x1add00(0x179),_0x1add00(0x138),_0x1add00(0x1a8)+_0x322c05[_0x1add00(0x124)]+':\x20'+_0x415c8f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x322c05[_0x1add00(0x124)]);}const _0x308347=await _0x322c05[_0x1add00(0x182)]();console[_0x1add00(0x13a)](_0x1add00(0x150),_0x308347);let _0x52703b;try{_0x52703b=JSON[_0x1add00(0x12c)](_0x308347);}catch(_0x3a1a40){console[_0x1add00(0x135)](_0x1add00(0x185),_0x3a1a40),loggerService_1['loggerService']['logWhiteDomainError']('cointopay2',_0x1add00(0x138),_0x1add00(0x164)+_0x3a1a40);throw new Error(_0x1add00(0x18c)+_0x308347);}loggerService_1[_0x1add00(0x159)]['logWhiteDomainResponse'](_0x1add00(0x179),'/status',_0x322c05[_0x1add00(0x124)],_0x52703b,_0x416a15),console[_0x1add00(0x13a)](_0x1add00(0x1ab)),console[_0x1add00(0x13a)](_0x1add00(0x1a2),_0x52703b[_0x1add00(0x162)]),console[_0x1add00(0x13a)](_0x1add00(0x151),_0x52703b[_0x1add00(0x153)]),console[_0x1add00(0x13a)](_0x1add00(0x18d),_0x52703b['data']?.[_0x1add00(0x190)]),console['log'](_0x1add00(0x175),_0x52703b[_0x1add00(0x1aa)]?.['Amount']),console[_0x1add00(0x13a)](_0x1add00(0x12a),_0x52703b[_0x1add00(0x1aa)]?.[_0x1add00(0x131)]);if(_0x52703b[_0x1add00(0x162)]!==_0x1add00(0x149)||_0x52703b[_0x1add00(0x153)]!==0xc8){const _0x19786a=_0x52703b[_0x1add00(0x1ad)]||_0x1add00(0x17d);console['error']('===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20==='),console[_0x1add00(0x135)]('Error\x20Message:',_0x19786a),loggerService_1['loggerService'][_0x1add00(0x14c)](_0x1add00(0x179),_0x1add00(0x138),_0x1add00(0x12e)+_0x19786a);throw new Error(_0x1add00(0x15a)+_0x19786a);}if(!_0x52703b[_0x1add00(0x1aa)]){console['error']('===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x1add00(0x14c)](_0x1add00(0x179),_0x1add00(0x138),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x1add00(0x17a));}let _0xcb0ac1=_0x1add00(0x176);switch(_0x52703b['data'][_0x1add00(0x190)]?.[_0x1add00(0x136)]()){case _0x1add00(0x14d):_0xcb0ac1=_0x1add00(0x167);break;case _0x1add00(0x197):case'failed':case'error':_0xcb0ac1=_0x1add00(0x133);break;case'expired':case _0x1add00(0x139):_0xcb0ac1=_0x1add00(0x1a7);break;case _0x1add00(0x137):case _0x1add00(0x15d):case _0x1add00(0x127):case'created':default:_0xcb0ac1=_0x1add00(0x176);break;}let _0x5258db,_0x11ee75;if(_0x52703b[_0x1add00(0x1aa)][_0x1add00(0x134)]){const _0x531a1f=_0x52703b['data'][_0x1add00(0x134)];console['log']('üè¶\x20Payment\x20Detail:',_0x531a1f);const _0x321658=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x207187 of _0x321658){const _0xef49d5=_0x531a1f['match'](_0x207187);if(_0xef49d5){_0x5258db=_0xef49d5[0x1],console[_0x1add00(0x13a)](_0x1add00(0x14f),_0x5258db,_0x1add00(0x1a3),_0x207187[_0x1add00(0x18a)]);break;}}if(!_0x5258db){console['log']('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x4657a6=_0x531a1f[_0x1add00(0x16f)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x4657a6&&(_0x5258db=_0x4657a6[0x1],console['log'](_0x1add00(0x13f),_0x5258db));}_0x11ee75=_0x531a1f;}const _0x3e37f1={'iban':_0x5258db,'bankDetails':_0x11ee75,'transactionId':_0x52703b[_0x1add00(0x1aa)][_0x1add00(0x15c)],'coinAddress':_0x52703b[_0x1add00(0x1aa)][_0x1add00(0x193)],'qrCodeUrl':_0x52703b[_0x1add00(0x1aa)][_0x1add00(0x130)],'expiryTime':_0x52703b[_0x1add00(0x1aa)][_0x1add00(0x146)],'createdOn':_0x52703b['data']['CreatedOn'],'confirmedOn':_0x52703b[_0x1add00(0x1aa)]['TransactionConfirmedOn']};console['log'](_0x1add00(0x152)),console[_0x1add00(0x13a)](_0x1add00(0x194),_0x52703b[_0x1add00(0x1aa)]['Status'],'->',_0xcb0ac1),console[_0x1add00(0x13a)](_0x1add00(0x175),_0x52703b[_0x1add00(0x1aa)][_0x1add00(0x141)],_0x52703b[_0x1add00(0x1aa)]['inputCurrency']),console[_0x1add00(0x13a)](_0x1add00(0x16a),_0x52703b[_0x1add00(0x1aa)][_0x1add00(0x15c)]),console[_0x1add00(0x13a)](_0x1add00(0x17c),_0x5258db||_0x1add00(0x157)),console[_0x1add00(0x13a)](_0x1add00(0x128),_0x52703b['data'][_0x1add00(0x145)]),console['log'](_0x1add00(0x12f),_0x52703b['data']['TransactionConfirmedOn']||_0x1add00(0x148));if(_0x52703b[_0x1add00(0x1aa)][_0x1add00(0x190)]?.[_0x1add00(0x136)]()===_0x1add00(0x15d))console[_0x1add00(0x13a)](_0x1add00(0x198));else _0x52703b[_0x1add00(0x1aa)][_0x1add00(0x190)]?.[_0x1add00(0x136)]()==='paid'&&console['log'](_0x1add00(0x158));return{'status':_0xcb0ac1,'amount':parseFloat(_0x52703b[_0x1add00(0x1aa)][_0x1add00(0x141)])||undefined,'currency':_0x52703b['data'][_0x1add00(0x131)]||'EUR','paymentDetails':_0x3e37f1};}catch(_0x314d75){console[_0x1add00(0x135)](_0x1add00(0x170),_0x314d75),loggerService_1['loggerService'][_0x1add00(0x14c)](_0x1add00(0x179),_0x1add00(0x138),_0x314d75);throw new Error(_0x1add00(0x156)+(_0x314d75 instanceof Error?_0x314d75['message']:'Unknown\x20error'));}}async[a42_0x1db0be(0x171)](_0x185268){const _0x19a061=a42_0x1db0be,_0x409146=await this[_0x19a061(0x16e)](_0x185268);return{'status':_0x409146[_0x19a061(0x124)],'amount':_0x409146[_0x19a061(0x165)],'currency':_0x409146['currency']};}async[a42_0x1db0be(0x192)](_0x5a3675){const _0x285d68=a42_0x1db0be;console['log'](_0x285d68(0x187),_0x5a3675);let _0x1da724=_0x285d68(0x176);switch(_0x5a3675[_0x285d68(0x124)]?.[_0x285d68(0x136)]()){case _0x285d68(0x14d):_0x1da724=_0x285d68(0x167);break;case _0x285d68(0x197):case _0x285d68(0x144):case _0x285d68(0x135):_0x1da724='FAILED';break;case _0x285d68(0x186):case _0x285d68(0x139):_0x1da724=_0x285d68(0x1a7);break;case _0x285d68(0x127):case _0x285d68(0x137):case _0x285d68(0x15d):case _0x285d68(0x14e):default:_0x1da724=_0x285d68(0x176);break;}return{'paymentId':_0x5a3675[_0x285d68(0x19e)]||_0x5a3675[_0x285d68(0x154)]||'','status':_0x1da724,'amount':_0x5a3675['amount'],'currency':_0x5a3675[_0x285d68(0x155)]||_0x285d68(0x15b)};}}exports[a42_0x1db0be(0x196)]=CoinToPay2Service;function a42_0x4e9f(){const _0x4361b2=['toLowerCase','waiting','/status','timeout','log','application/json','Error\x20message:','stringify','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','Amount','80tBBllN','1382HINByF','failed','CreatedOn','ExpiryTime','Error\x20details:','not\x20confirmed','success','statusUrl','682egYJYr','logWhiteDomainError','paid','created','üè¶\x20Extracted\x20IBAN:','Raw\x20Response\x20Body:','Status\x20Code:','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','status_code','merchant_reference_id','currency','Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20','not\x20found','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','loggerService','CoinToPay2\x20status\x20API\x20error:\x20','EUR','TransactionID','awaiting\x20fiat','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','1686690mLVMrl','158376KXGkzM','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','result','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','JSON\x20Parse\x20Error:\x20','amount','CoinToPay2\x20API\x20error:\x20','PAID','Response\x20Body:','Parsed\x20Result:','Transaction\x20ID:','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainRequest','headers','checkPaymentStatus','match','CoinToPay2\x20payment\x20status\x20check\x20error:','verifyPayment','Business\x20Error:\x20','HTTP\x20error!\x20status:\x20','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','Amount:','PENDING','POST','765944BDrujC','cointopay2','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','https://traffer.uk/gateway/cointopay/status.php','IBAN:','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','===\x20COINTOPAY2\x20SUCCESS\x20===','\x20EUR','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','URL:','text','logWhiteDomainResponse','Unknown\x20error\x20from\x20CoinToPay2\x20API','Failed\x20to\x20parse\x20JSON\x20response:','expired','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','30SHVKKc','üìä\x20Status\x20check\x20URL:','source','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','Payment\x20Status:','Error\x20stack:','1429wrftSG','Status','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','processWebhook','coinAddress','Status:','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','CoinToPay2Service','cancelled','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','HTTP\x20Status:','Request\x20Body:','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','1372gUBnKI','createPaymentLink','order_id','entries','now','===\x20COINTOPAY2\x20API\x20ERROR\x20===','Result:','using\x20pattern:','gateway_payment_id','fromEntries','35usylyR','EXPIRED','HTTP\x20','payment_url','data','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','/create','message','Response\x20data:','Response\x20Time:','ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy','status','apiUrl','https://traffer.uk/gateway/cointopay/','pending','Created\x20On:','__esModule','Currency:','2183841DPBGVo','parse','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','Status\x20API\x20Error:\x20','Confirmed\x20On:','QRCodeURL','inputCurrency','3453972NGCTmN','FAILED','PaymentDetail','error'];a42_0x4e9f=function(){return _0x4361b2;};return a42_0x4e9f();}