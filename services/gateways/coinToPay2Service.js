'use strict';const a40_0xdff9b8=a40_0x2437;(function(_0x499321,_0x1898aa){const _0x539a49=a40_0x2437,_0x4d1adb=_0x499321();while(!![]){try{const _0x3b5614=-parseInt(_0x539a49(0x1ed))/0x1+-parseInt(_0x539a49(0x212))/0x2+-parseInt(_0x539a49(0x218))/0x3+-parseInt(_0x539a49(0x24a))/0x4+parseInt(_0x539a49(0x224))/0x5+-parseInt(_0x539a49(0x20c))/0x6+parseInt(_0x539a49(0x1ca))/0x7;if(_0x3b5614===_0x1898aa)break;else _0x4d1adb['push'](_0x4d1adb['shift']());}catch(_0x45d744){_0x4d1adb['push'](_0x4d1adb['shift']());}}}(a40_0x3d61,0x67cff));function a40_0x2437(_0x371e51,_0x3bfd89){const _0x3d6170=a40_0x3d61();return a40_0x2437=function(_0x24371f,_0x38f3af){_0x24371f=_0x24371f-0x1c5;let _0x1ce4c2=_0x3d6170[_0x24371f];return _0x1ce4c2;},a40_0x2437(_0x371e51,_0x3bfd89);}Object[a40_0xdff9b8(0x219)](exports,a40_0xdff9b8(0x1ef),{'value':!![]}),exports[a40_0xdff9b8(0x23a)]=void 0x0;const loggerService_1=require(a40_0xdff9b8(0x1df));class CoinToPay2Service{constructor(){const _0x2ceaf2=a40_0xdff9b8;this[_0x2ceaf2(0x1dd)]='https://traffer.uk/gateway/cointopay/',this[_0x2ceaf2(0x24d)]=_0x2ceaf2(0x1dc),console[_0x2ceaf2(0x230)]('🪙\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0x2ceaf2(0x230)]('📊\x20Status\x20check\x20URL:',this[_0x2ceaf2(0x24d)]);}async[a40_0xdff9b8(0x200)](_0x141e3e){const _0x79943d=a40_0xdff9b8,{orderId:_0x466f87,amount:_0x409947}=_0x141e3e;console[_0x79943d(0x230)](_0x79943d(0x21a)+_0x409947+_0x79943d(0x22e));const _0x328644={'amount':_0x409947},_0x16c7ea=Date[_0x79943d(0x23e)]();try{console[_0x79943d(0x230)](_0x79943d(0x233)),console[_0x79943d(0x230)](_0x79943d(0x245),this[_0x79943d(0x1dd)]),console[_0x79943d(0x230)](_0x79943d(0x234),JSON[_0x79943d(0x1d0)](_0x328644,null,0x2)),console[_0x79943d(0x230)](_0x79943d(0x1d6),_0x409947,_0x79943d(0x23d)),loggerService_1['loggerService'][_0x79943d(0x211)](_0x79943d(0x20d),'/create','POST',_0x328644);const _0x50132b=await fetch(this[_0x79943d(0x1dd)],{'method':'POST','headers':{'Content-Type':_0x79943d(0x1e8),'Accept':_0x79943d(0x1e8),'User-Agent':_0x79943d(0x1f3)},'body':JSON[_0x79943d(0x1d0)](_0x328644)}),_0x431ac2=Date[_0x79943d(0x23e)]()-_0x16c7ea;console['log'](_0x79943d(0x1c7)),console[_0x79943d(0x230)](_0x79943d(0x240),_0x50132b[_0x79943d(0x238)]),console[_0x79943d(0x230)](_0x79943d(0x244),_0x50132b['statusText']),console[_0x79943d(0x230)](_0x79943d(0x1d5),Object['fromEntries'](_0x50132b['headers'][_0x79943d(0x1c8)]())),console[_0x79943d(0x230)](_0x79943d(0x1e0),_0x431ac2+'ms');const _0x43cef5=await _0x50132b[_0x79943d(0x213)]();console['log'](_0x79943d(0x23b),_0x43cef5);if(!_0x50132b['ok']){console['error'](_0x79943d(0x216)),console['error']('HTTP\x20Status:',_0x50132b[_0x79943d(0x238)]),console[_0x79943d(0x1ff)](_0x79943d(0x22f),_0x43cef5),loggerService_1['loggerService'][_0x79943d(0x225)]('cointopay2',_0x79943d(0x1f1),_0x50132b[_0x79943d(0x238)],_0x43cef5,_0x431ac2),loggerService_1[_0x79943d(0x1de)][_0x79943d(0x1fe)](_0x79943d(0x20d),_0x79943d(0x1f1),'HTTP\x20'+_0x50132b[_0x79943d(0x238)]+':\x20'+_0x43cef5);throw new Error(_0x79943d(0x201)+_0x50132b['status']+',\x20body:\x20'+_0x43cef5);}let _0x31e7b8;try{_0x31e7b8=JSON[_0x79943d(0x1f7)](_0x43cef5);}catch(_0x47b0e6){console[_0x79943d(0x1ff)](_0x79943d(0x236),_0x47b0e6),loggerService_1[_0x79943d(0x1de)][_0x79943d(0x1fe)](_0x79943d(0x20d),_0x79943d(0x1f1),_0x79943d(0x1d9)+_0x47b0e6);throw new Error(_0x79943d(0x235)+_0x43cef5);}console['log'](_0x79943d(0x21e)),console['log'](_0x79943d(0x1f2),JSON[_0x79943d(0x1d0)](_0x31e7b8,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x79943d(0x20d),_0x79943d(0x1f1),_0x50132b[_0x79943d(0x238)],_0x31e7b8,_0x431ac2);if(_0x31e7b8[_0x79943d(0x1ff)]){const _0x407d55=_0x31e7b8[_0x79943d(0x210)]||_0x31e7b8[_0x79943d(0x1ff)]||_0x79943d(0x227);console[_0x79943d(0x1ff)](_0x79943d(0x1d4)),console[_0x79943d(0x1ff)](_0x79943d(0x226),_0x407d55),loggerService_1[_0x79943d(0x1de)][_0x79943d(0x1fe)](_0x79943d(0x20d),_0x79943d(0x1f1),'Business\x20Error:\x20'+_0x407d55);throw new Error(_0x79943d(0x24e)+_0x407d55);}if(!_0x31e7b8[_0x79943d(0x242)]||!_0x31e7b8[_0x79943d(0x1ec)]){console[_0x79943d(0x1ff)](_0x79943d(0x1e7)),console[_0x79943d(0x1ff)](_0x79943d(0x1d2)),console[_0x79943d(0x1ff)](_0x79943d(0x1f4),_0x31e7b8),loggerService_1['loggerService'][_0x79943d(0x1fe)](_0x79943d(0x20d),_0x79943d(0x1f1),_0x79943d(0x209));throw new Error(_0x79943d(0x1d3));}return console[_0x79943d(0x230)](_0x79943d(0x21f)),console[_0x79943d(0x230)](_0x79943d(0x222),_0x31e7b8[_0x79943d(0x1ec)]),console[_0x79943d(0x230)]('Payment\x20URL:',_0x31e7b8[_0x79943d(0x242)]),console[_0x79943d(0x230)](_0x79943d(0x1d6),_0x409947,_0x79943d(0x1db)),{'gateway_payment_id':_0x31e7b8[_0x79943d(0x1ec)],'payment_url':_0x31e7b8[_0x79943d(0x242)]};}catch(_0x35d0c1){console[_0x79943d(0x1ff)](_0x79943d(0x248)),console['error'](_0x79943d(0x237),_0x35d0c1),loggerService_1[_0x79943d(0x1de)][_0x79943d(0x1fe)](_0x79943d(0x20d),_0x79943d(0x1f1),_0x35d0c1);if(_0x35d0c1 instanceof Error){console[_0x79943d(0x1ff)](_0x79943d(0x22b),_0x35d0c1['message']),console['error'](_0x79943d(0x1c9),_0x35d0c1[_0x79943d(0x239)]);throw new Error(_0x79943d(0x20f)+_0x35d0c1[_0x79943d(0x210)]);}throw new Error(_0x79943d(0x1e5));}}async[a40_0xdff9b8(0x246)](_0x4ebd25){const _0x28102b=a40_0xdff9b8,_0x3f5452=Date[_0x28102b(0x23e)]();try{console['log'](_0x28102b(0x1e3)+_0x4ebd25);const _0x49ab50={'gatewayPaymentId':_0x4ebd25};loggerService_1[_0x28102b(0x1de)][_0x28102b(0x211)](_0x28102b(0x20d),'/status',_0x28102b(0x207),_0x49ab50);const _0x1212fb=await fetch(this[_0x28102b(0x24d)],{'method':'POST','headers':{'Content-Type':_0x28102b(0x1e8),'Accept':_0x28102b(0x1e8),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)'},'body':JSON[_0x28102b(0x1d0)](_0x49ab50)}),_0xc2fba=Date[_0x28102b(0x23e)]()-_0x3f5452;console[_0x28102b(0x230)](_0x28102b(0x1c6)),console[_0x28102b(0x230)]('Status:',_0x1212fb[_0x28102b(0x238)]),console[_0x28102b(0x230)](_0x28102b(0x1e0),_0xc2fba+'ms');if(!_0x1212fb['ok']){const _0x389757=await _0x1212fb[_0x28102b(0x213)]();console[_0x28102b(0x1ff)](_0x28102b(0x24b),_0x1212fb[_0x28102b(0x238)]),console[_0x28102b(0x1ff)](_0x28102b(0x22f),_0x389757),loggerService_1[_0x28102b(0x1de)][_0x28102b(0x225)](_0x28102b(0x20d),_0x28102b(0x1e9),_0x1212fb[_0x28102b(0x238)],_0x389757,_0xc2fba),loggerService_1[_0x28102b(0x1de)][_0x28102b(0x1fe)]('cointopay2','/status',_0x28102b(0x1ce)+_0x1212fb['status']+':\x20'+_0x389757);throw new Error(_0x28102b(0x201)+_0x1212fb[_0x28102b(0x238)]);}const _0x51c85d=await _0x1212fb['text']();console[_0x28102b(0x230)](_0x28102b(0x23b),_0x51c85d);let _0x22ed0f;try{_0x22ed0f=JSON['parse'](_0x51c85d);}catch(_0xbcbb1c){console[_0x28102b(0x1ff)]('Failed\x20to\x20parse\x20JSON\x20response:',_0xbcbb1c),loggerService_1[_0x28102b(0x1de)][_0x28102b(0x1fe)](_0x28102b(0x20d),_0x28102b(0x1e9),_0x28102b(0x1d9)+_0xbcbb1c);throw new Error(_0x28102b(0x1fc)+_0x51c85d);}loggerService_1[_0x28102b(0x1de)][_0x28102b(0x225)](_0x28102b(0x20d),_0x28102b(0x1e9),_0x1212fb['status'],_0x22ed0f,_0xc2fba),console['log'](_0x28102b(0x1f9)),console[_0x28102b(0x230)](_0x28102b(0x20e),_0x22ed0f[_0x28102b(0x1cf)]),console[_0x28102b(0x230)](_0x28102b(0x1cc),_0x22ed0f['status_code']),console[_0x28102b(0x230)](_0x28102b(0x1e1),_0x22ed0f[_0x28102b(0x228)]?.[_0x28102b(0x220)]),console[_0x28102b(0x230)](_0x28102b(0x1d6),_0x22ed0f[_0x28102b(0x228)]?.[_0x28102b(0x1da)]),console[_0x28102b(0x230)](_0x28102b(0x1f5),_0x22ed0f[_0x28102b(0x228)]?.['inputCurrency']);if(_0x22ed0f['result']!==_0x28102b(0x1d8)||_0x22ed0f[_0x28102b(0x1e4)]!==0xc8){const _0x461766=_0x22ed0f['message']||_0x28102b(0x1f6);console[_0x28102b(0x1ff)](_0x28102b(0x214)),console[_0x28102b(0x1ff)](_0x28102b(0x226),_0x461766),loggerService_1[_0x28102b(0x1de)]['logWhiteDomainError'](_0x28102b(0x20d),_0x28102b(0x1e9),_0x28102b(0x1fb)+_0x461766);throw new Error(_0x28102b(0x1fd)+_0x461766);}if(!_0x22ed0f['data']){console[_0x28102b(0x1ff)](_0x28102b(0x1c5)),console[_0x28102b(0x1ff)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x28102b(0x1fe)](_0x28102b(0x20d),_0x28102b(0x1e9),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x28102b(0x204));}let _0x11e6e9=_0x28102b(0x208);switch(_0x22ed0f[_0x28102b(0x228)]['Status']?.[_0x28102b(0x241)]()){case _0x28102b(0x1ea):_0x11e6e9=_0x28102b(0x1f0);break;case _0x28102b(0x21c):case'failed':case _0x28102b(0x1ff):_0x11e6e9='FAILED';break;case _0x28102b(0x217):case _0x28102b(0x1fa):_0x11e6e9=_0x28102b(0x215);break;case _0x28102b(0x1cb):case'awaiting\x20fiat':case _0x28102b(0x221):case'created':default:_0x11e6e9=_0x28102b(0x208);break;}let _0x10e0e4,_0x47ccfd;if(_0x22ed0f[_0x28102b(0x228)]['PaymentDetail']){const _0x3b1b7c=_0x22ed0f[_0x28102b(0x228)][_0x28102b(0x205)];console['log'](_0x28102b(0x1e6),_0x3b1b7c);const _0xc58a60=_0x3b1b7c[_0x28102b(0x249)](/IBAN\s+([A-Z0-9]+)/i);_0xc58a60&&(_0x10e0e4=_0xc58a60[0x1],console['log'](_0x28102b(0x22a),_0x10e0e4)),_0x47ccfd=_0x3b1b7c;}const _0x3aa749={'iban':_0x10e0e4,'bankDetails':_0x47ccfd,'transactionId':_0x22ed0f['data'][_0x28102b(0x22c)],'coinAddress':_0x22ed0f[_0x28102b(0x228)]['coinAddress'],'qrCodeUrl':_0x22ed0f[_0x28102b(0x228)][_0x28102b(0x243)],'expiryTime':_0x22ed0f[_0x28102b(0x228)][_0x28102b(0x231)],'createdOn':_0x22ed0f['data'][_0x28102b(0x22d)],'confirmedOn':_0x22ed0f['data'][_0x28102b(0x1d7)]};console[_0x28102b(0x230)](_0x28102b(0x20b)),console['log']('Status:',_0x22ed0f[_0x28102b(0x228)][_0x28102b(0x220)],'->',_0x11e6e9),console['log']('Amount:',_0x22ed0f[_0x28102b(0x228)][_0x28102b(0x1da)],_0x22ed0f[_0x28102b(0x228)][_0x28102b(0x202)]),console[_0x28102b(0x230)](_0x28102b(0x20a),_0x22ed0f[_0x28102b(0x228)][_0x28102b(0x22c)]),console[_0x28102b(0x230)](_0x28102b(0x223),_0x10e0e4||'not\x20found'),console[_0x28102b(0x230)](_0x28102b(0x206),_0x22ed0f[_0x28102b(0x228)][_0x28102b(0x22d)]),console[_0x28102b(0x230)](_0x28102b(0x21b),_0x22ed0f[_0x28102b(0x228)]['TransactionConfirmedOn']||_0x28102b(0x23c));if(_0x22ed0f[_0x28102b(0x228)][_0x28102b(0x220)]?.[_0x28102b(0x241)]()===_0x28102b(0x203))console[_0x28102b(0x230)]('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x22ed0f[_0x28102b(0x228)][_0x28102b(0x220)]?.[_0x28102b(0x241)]()===_0x28102b(0x1ea)&&console[_0x28102b(0x230)](_0x28102b(0x21d));return{'status':_0x11e6e9,'amount':parseFloat(_0x22ed0f[_0x28102b(0x228)][_0x28102b(0x1da)])||undefined,'currency':_0x22ed0f[_0x28102b(0x228)][_0x28102b(0x202)]||'EUR','paymentDetails':_0x3aa749};}catch(_0xca0bc1){console['error'](_0x28102b(0x1eb),_0xca0bc1),loggerService_1[_0x28102b(0x1de)]['logWhiteDomainError'](_0x28102b(0x20d),_0x28102b(0x1e9),_0xca0bc1);throw new Error('Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20'+(_0xca0bc1 instanceof Error?_0xca0bc1['message']:_0x28102b(0x247)));}}async[a40_0xdff9b8(0x1e2)](_0x1264d5){const _0x5d97a0=a40_0xdff9b8,_0xfd0f60=await this[_0x5d97a0(0x246)](_0x1264d5);return{'status':_0xfd0f60[_0x5d97a0(0x238)],'amount':_0xfd0f60[_0x5d97a0(0x1d1)],'currency':_0xfd0f60['currency']};}async[a40_0xdff9b8(0x1cd)](_0x484db2){const _0x528ad4=a40_0xdff9b8;console['log'](_0x528ad4(0x1ee),_0x484db2);let _0x128628='PENDING';switch(_0x484db2['status']?.[_0x528ad4(0x241)]()){case'paid':_0x128628='PAID';break;case _0x528ad4(0x21c):case _0x528ad4(0x23f):case _0x528ad4(0x1ff):_0x128628='FAILED';break;case'expired':case _0x528ad4(0x1fa):_0x128628=_0x528ad4(0x215);break;case _0x528ad4(0x221):case'waiting':case'awaiting\x20fiat':case _0x528ad4(0x232):default:_0x128628='PENDING';break;}return{'paymentId':_0x484db2[_0x528ad4(0x1f8)]||_0x484db2[_0x528ad4(0x24c)]||'','status':_0x128628,'amount':_0x484db2[_0x528ad4(0x1d1)],'currency':_0x484db2[_0x528ad4(0x229)]||_0x528ad4(0x1db)};}}function a40_0x3d61(){const _0x3261aa=['Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','Headers:','Amount:','TransactionConfirmedOn','success','JSON\x20Parse\x20Error:\x20','Amount','EUR','https://traffer.uk/gateway/cointopay/status.php','apiUrl','loggerService','../loggerService','Response\x20Time:','Payment\x20Status:','verifyPayment','📊\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','status_code','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error','🏦\x20Payment\x20Detail:','===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20===','application/json','/status','paid','CoinToPay2\x20payment\x20status\x20check\x20error:','gateway_payment_id','794605YhDpgr','Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','__esModule','PAID','/create','Parsed\x20Result:','TesSoft\x20Payment\x20System/1.0\x20(CoinToPay2)','Response\x20data:','Currency:','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','parse','order_id','===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20===','timeout','Status\x20API\x20Error:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20','CoinToPay2\x20status\x20API\x20error:\x20','logWhiteDomainError','error','createPaymentLink','HTTP\x20error!\x20status:\x20','inputCurrency','awaiting\x20fiat','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','PaymentDetail','Created\x20On:','POST','PENDING','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Transaction\x20ID:','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','1251678XTnqNA','cointopay2','Result:','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','message','logWhiteDomainRequest','964022kqlmkV','text','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','EXPIRED','===\x20COINTOPAY2\x20API\x20ERROR\x20===','expired','1915470ognRHh','defineProperty','🪙\x20Creating\x20CoinToPay2\x20payment:\x20','Confirmed\x20On:','cancelled','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20===','===\x20COINTOPAY2\x20SUCCESS\x20===','Status','pending','Gateway\x20Payment\x20ID:','IBAN:','2750620NpRrJw','logWhiteDomainResponse','Error\x20Message:','Unknown\x20error\x20from\x20CoinToPay2\x20API','data','currency','🏦\x20Extracted\x20IBAN:','Error\x20message:','TransactionID','CreatedOn','\x20EUR','Response\x20Body:','log','ExpiryTime','created','===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20===','Request\x20Body:','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20details:','status','stack','CoinToPay2Service','Raw\x20Response\x20Body:','not\x20confirmed','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','now','failed','Status:','toLowerCase','payment_url','QRCodeURL','Status\x20Text:','URL:','checkPaymentStatus','Unknown\x20error','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','match','3019584KhfzOn','HTTP\x20Status:','merchant_reference_id','statusUrl','CoinToPay2\x20API\x20error:\x20','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','entries','Error\x20stack:','19275942nDyOMC','waiting','Status\x20Code:','processWebhook','HTTP\x20','result','stringify','amount'];a40_0x3d61=function(){return _0x3261aa;};return a40_0x3d61();}exports[a40_0xdff9b8(0x23a)]=CoinToPay2Service;