'use strict';const a56_0x50bc61=a56_0x1544;(function(_0x54f936,_0x31914d){const _0x415597=a56_0x1544,_0x10026=_0x54f936();while(!![]){try{const _0x28f9d1=-parseInt(_0x415597(0x102))/0x1*(-parseInt(_0x415597(0x11a))/0x2)+parseInt(_0x415597(0x139))/0x3+-parseInt(_0x415597(0x152))/0x4+parseInt(_0x415597(0x173))/0x5*(parseInt(_0x415597(0x147))/0x6)+parseInt(_0x415597(0x145))/0x7*(parseInt(_0x415597(0x16c))/0x8)+-parseInt(_0x415597(0x110))/0x9+-parseInt(_0x415597(0x13e))/0xa;if(_0x28f9d1===_0x31914d)break;else _0x10026['push'](_0x10026['shift']());}catch(_0x33ca10){_0x10026['push'](_0x10026['shift']());}}}(a56_0x4cfa,0x99122));Object[a56_0x50bc61(0x16a)](exports,a56_0x50bc61(0x118),{'value':!![]}),exports['CoinToPay2Service']=void 0x0;function a56_0x1544(_0x443c41,_0x5cf9da){_0x443c41=_0x443c41-0xf8;const _0x4cfa40=a56_0x4cfa();let _0x1544e9=_0x4cfa40[_0x443c41];return _0x1544e9;}const loggerService_1=require('../loggerService');class CoinToPay2Service{constructor(){const _0x44570c=a56_0x50bc61;this[_0x44570c(0x167)]=_0x44570c(0x178),this['statusUrl']=_0x44570c(0x140),console[_0x44570c(0x113)]('ü™ô\x20CoinToPay2\x20service\x20initialized\x20with\x20traffer.uk\x20proxy'),console[_0x44570c(0x113)](_0x44570c(0x155),this['statusUrl']);}async[a56_0x50bc61(0x168)](_0x957163){const _0x25c4e2=a56_0x50bc61,{orderId:_0x7951ca,amount:_0x5c2c30}=_0x957163;console[_0x25c4e2(0x113)](_0x25c4e2(0x105)+_0x5c2c30+'\x20EUR');const _0x5f9f19={'amount':_0x5c2c30},_0x4872ca=Date[_0x25c4e2(0x138)]();try{console[_0x25c4e2(0x113)]('===\x20COINTOPAY2\x20API\x20REQUEST\x20(traffer.uk)\x20==='),console[_0x25c4e2(0x113)](_0x25c4e2(0x10c),this[_0x25c4e2(0x167)]),console[_0x25c4e2(0x113)](_0x25c4e2(0x125),JSON['stringify'](_0x5f9f19,null,0x2)),console[_0x25c4e2(0x113)](_0x25c4e2(0x122),_0x5c2c30,_0x25c4e2(0x11c)),loggerService_1[_0x25c4e2(0x13b)][_0x25c4e2(0x15c)](_0x25c4e2(0x10e),'/create','POST',_0x5f9f19);const _0x213601=await fetch(this[_0x25c4e2(0x167)],{'method':_0x25c4e2(0x132),'headers':{'Content-Type':_0x25c4e2(0x157),'Accept':_0x25c4e2(0x157),'User-Agent':_0x25c4e2(0x130)},'body':JSON[_0x25c4e2(0x13a)](_0x5f9f19)}),_0x42ecf4=Date[_0x25c4e2(0x138)]()-_0x4872ca;console[_0x25c4e2(0x113)](_0x25c4e2(0x106)),console[_0x25c4e2(0x113)](_0x25c4e2(0x136),_0x213601['status']),console[_0x25c4e2(0x113)]('Status\x20Text:',_0x213601[_0x25c4e2(0x11e)]),console[_0x25c4e2(0x113)]('Headers:',Object['fromEntries'](_0x213601[_0x25c4e2(0x162)][_0x25c4e2(0x120)]())),console[_0x25c4e2(0x113)]('Response\x20Time:',_0x42ecf4+'ms');const _0x2ae0d7=await _0x213601[_0x25c4e2(0x150)]();console[_0x25c4e2(0x113)]('Raw\x20Response\x20Body:',_0x2ae0d7);if(!_0x213601['ok']){console[_0x25c4e2(0x10a)](_0x25c4e2(0x142)),console[_0x25c4e2(0x10a)](_0x25c4e2(0x10d),_0x213601['status']),console[_0x25c4e2(0x10a)]('Response\x20Body:',_0x2ae0d7),loggerService_1[_0x25c4e2(0x13b)]['logWhiteDomainResponse']('cointopay2',_0x25c4e2(0x15d),_0x213601[_0x25c4e2(0x159)],_0x2ae0d7,_0x42ecf4),loggerService_1[_0x25c4e2(0x13b)][_0x25c4e2(0xfb)]('cointopay2',_0x25c4e2(0x15d),_0x25c4e2(0x133)+_0x213601['status']+':\x20'+_0x2ae0d7);throw new Error(_0x25c4e2(0x11b)+_0x213601['status']+_0x25c4e2(0x175)+_0x2ae0d7);}let _0x133eef;try{_0x133eef=JSON[_0x25c4e2(0xff)](_0x2ae0d7);}catch(_0x4c87ad){console['error'](_0x25c4e2(0x108),_0x4c87ad),loggerService_1['loggerService'][_0x25c4e2(0xfb)](_0x25c4e2(0x10e),'/create',_0x25c4e2(0x17a)+_0x4c87ad);throw new Error(_0x25c4e2(0x111)+_0x2ae0d7);}console[_0x25c4e2(0x113)]('===\x20PARSED\x20COINTOPAY2\x20RESPONSE\x20==='),console[_0x25c4e2(0x113)](_0x25c4e2(0x10b),JSON['stringify'](_0x133eef,null,0x2)),loggerService_1[_0x25c4e2(0x13b)][_0x25c4e2(0x158)]('cointopay2','/create',_0x213601[_0x25c4e2(0x159)],_0x133eef,_0x42ecf4);if(_0x133eef['error']){const _0x594cc1=_0x133eef[_0x25c4e2(0x14c)]||_0x133eef['error']||_0x25c4e2(0x148);console[_0x25c4e2(0x10a)](_0x25c4e2(0x12d)),console[_0x25c4e2(0x10a)](_0x25c4e2(0x107),_0x594cc1),loggerService_1[_0x25c4e2(0x13b)]['logWhiteDomainError'](_0x25c4e2(0x10e),'/create',_0x25c4e2(0x11d)+_0x594cc1);throw new Error(_0x25c4e2(0x134)+_0x594cc1);}if(!_0x133eef['payment_url']||!_0x133eef[_0x25c4e2(0x115)]){console['error']('===\x20COINTOPAY2\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x25c4e2(0x10a)](_0x25c4e2(0x124)),console['error'](_0x25c4e2(0x15e),_0x133eef),loggerService_1['loggerService'][_0x25c4e2(0xfb)](_0x25c4e2(0x10e),_0x25c4e2(0x15d),_0x25c4e2(0x169));throw new Error('Invalid\x20response\x20from\x20CoinToPay2\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x25c4e2(0x113)](_0x25c4e2(0x144)),console[_0x25c4e2(0x113)]('Gateway\x20Payment\x20ID:',_0x133eef[_0x25c4e2(0x115)]),console[_0x25c4e2(0x113)](_0x25c4e2(0x12f),_0x133eef['payment_url']);const _0x1ecdda=_0x133eef[_0x25c4e2(0x119)]+_0x25c4e2(0xfc);return console[_0x25c4e2(0x113)]('Payment\x20URL\x20(modified):',_0x1ecdda),console['log'](_0x25c4e2(0x122),_0x5c2c30,_0x25c4e2(0x101)),{'gateway_payment_id':_0x133eef[_0x25c4e2(0x115)],'payment_url':_0x1ecdda};}catch(_0x4ae6f4){console[_0x25c4e2(0x10a)](_0x25c4e2(0xf9)),console[_0x25c4e2(0x10a)](_0x25c4e2(0x153),_0x4ae6f4),loggerService_1[_0x25c4e2(0x13b)][_0x25c4e2(0xfb)](_0x25c4e2(0x10e),_0x25c4e2(0x15d),_0x4ae6f4);if(_0x4ae6f4 instanceof Error){console[_0x25c4e2(0x10a)](_0x25c4e2(0x174),_0x4ae6f4[_0x25c4e2(0x14c)]),console[_0x25c4e2(0x10a)](_0x25c4e2(0xfe),_0x4ae6f4['stack']);throw new Error(_0x25c4e2(0x164)+_0x4ae6f4[_0x25c4e2(0x14c)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x3b5342){const _0x3074df=a56_0x50bc61,_0x53042c=Date[_0x3074df(0x138)]();try{console['log'](_0x3074df(0x117)+_0x3b5342);const _0x4465e8={'gatewayPaymentId':_0x3b5342};loggerService_1['loggerService'][_0x3074df(0x15c)]('cointopay2',_0x3074df(0x14e),_0x3074df(0x132),_0x4465e8);const _0x4d5535=await fetch(this[_0x3074df(0x12e)],{'method':_0x3074df(0x132),'headers':{'Content-Type':'application/json','Accept':_0x3074df(0x157),'User-Agent':_0x3074df(0x130)},'body':JSON['stringify'](_0x4465e8)}),_0x502360=Date['now']()-_0x53042c;console[_0x3074df(0x113)]('===\x20COINTOPAY2\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x3074df(0x113)](_0x3074df(0x136),_0x4d5535['status']),console['log'](_0x3074df(0x161),_0x502360+'ms');if(!_0x4d5535['ok']){const _0x2fc0f2=await _0x4d5535[_0x3074df(0x150)]();console['error']('HTTP\x20Status:',_0x4d5535[_0x3074df(0x159)]),console[_0x3074df(0x10a)](_0x3074df(0x16b),_0x2fc0f2),loggerService_1[_0x3074df(0x13b)]['logWhiteDomainResponse']('cointopay2','/status',_0x4d5535[_0x3074df(0x159)],_0x2fc0f2,_0x502360),loggerService_1[_0x3074df(0x13b)][_0x3074df(0xfb)](_0x3074df(0x10e),_0x3074df(0x14e),_0x3074df(0x133)+_0x4d5535[_0x3074df(0x159)]+':\x20'+_0x2fc0f2);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4d5535['status']);}const _0x39f527=await _0x4d5535['text']();console[_0x3074df(0x113)](_0x3074df(0xfa),_0x39f527);let _0x18411d;try{_0x18411d=JSON[_0x3074df(0xff)](_0x39f527);}catch(_0x3c61e0){console['error'](_0x3074df(0x108),_0x3c61e0),loggerService_1[_0x3074df(0x13b)]['logWhiteDomainError'](_0x3074df(0x10e),'/status',_0x3074df(0x17a)+_0x3c61e0);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20'+_0x39f527);}loggerService_1[_0x3074df(0x13b)][_0x3074df(0x158)](_0x3074df(0x10e),_0x3074df(0x14e),_0x4d5535['status'],_0x18411d,_0x502360),console['log']('===\x20PARSED\x20COINTOPAY2\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x3074df(0x13c),_0x18411d['result']),console[_0x3074df(0x113)]('Status\x20Code:',_0x18411d['status_code']),console[_0x3074df(0x113)](_0x3074df(0x100),_0x18411d[_0x3074df(0x15b)]?.[_0x3074df(0x15f)]),console['log'](_0x3074df(0x122),_0x18411d['data']?.['Amount']),console[_0x3074df(0x113)](_0x3074df(0x16e),_0x18411d[_0x3074df(0x15b)]?.[_0x3074df(0x170)]);if(_0x18411d[_0x3074df(0x135)]!=='success'||_0x18411d[_0x3074df(0x128)]!==0xc8){const _0x47c4f5=_0x18411d[_0x3074df(0x14c)]||_0x3074df(0x141);console[_0x3074df(0x10a)](_0x3074df(0x12a)),console['error'](_0x3074df(0x107),_0x47c4f5),loggerService_1[_0x3074df(0x13b)][_0x3074df(0xfb)](_0x3074df(0x10e),_0x3074df(0x14e),'Status\x20API\x20Error:\x20'+_0x47c4f5);throw new Error('CoinToPay2\x20status\x20API\x20error:\x20'+_0x47c4f5);}if(!_0x18411d['data']){console[_0x3074df(0x10a)](_0x3074df(0x16d)),console[_0x3074df(0x10a)](_0x3074df(0x156)),loggerService_1[_0x3074df(0x13b)]['logWhiteDomainError']('cointopay2',_0x3074df(0x14e),_0x3074df(0x12b));throw new Error(_0x3074df(0x14f));}let _0x422325=_0x3074df(0x171);switch(_0x18411d[_0x3074df(0x15b)][_0x3074df(0x15f)]?.['toLowerCase']()){case _0x3074df(0x151):_0x422325=_0x3074df(0x177);break;case'cancelled':case'failed':case _0x3074df(0x10a):_0x422325=_0x3074df(0x143);break;case _0x3074df(0x123):case _0x3074df(0x116):_0x422325=_0x3074df(0x13d);break;case _0x3074df(0x14b):case _0x3074df(0x127):case'pending':case _0x3074df(0x179):default:_0x422325='PENDING';break;}let _0x351c67,_0x4cfee8;if(_0x18411d['data'][_0x3074df(0x126)]){const _0x59d9aa=_0x18411d[_0x3074df(0x15b)][_0x3074df(0x126)];console[_0x3074df(0x113)](_0x3074df(0x15a),_0x59d9aa);const _0x549fe0=[/<span[^>]*>IBAN<\/span>&nbsp;([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN[:\s]+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i,/IBAN\s+([A-Z]{2}[0-9]{2}[A-Z0-9]+)/i];for(const _0x98b004 of _0x549fe0){const _0x23167d=_0x59d9aa[_0x3074df(0x172)](_0x98b004);if(_0x23167d){_0x351c67=_0x23167d[0x1],console[_0x3074df(0x113)](_0x3074df(0x109),_0x351c67,_0x3074df(0x166),_0x98b004[_0x3074df(0x112)]);break;}}if(!_0x351c67){console['log']('‚ö†Ô∏è\x20IBAN\x20not\x20found\x20in\x20payment\x20details.\x20Trying\x20to\x20extract\x20from\x20text...');const _0x85a89c=_0x59d9aa[_0x3074df(0x172)](/\b([A-Z]{2}[0-9]{2}[A-Z0-9]{10,})\b/i);_0x85a89c&&(_0x351c67=_0x85a89c[0x1],console[_0x3074df(0x113)](_0x3074df(0x12c),_0x351c67));}_0x4cfee8=_0x59d9aa;}const _0x198272={'iban':_0x351c67,'bankDetails':_0x4cfee8,'transactionId':_0x18411d[_0x3074df(0x15b)][_0x3074df(0x137)],'coinAddress':_0x18411d[_0x3074df(0x15b)][_0x3074df(0x103)],'qrCodeUrl':_0x18411d[_0x3074df(0x15b)][_0x3074df(0x10f)],'expiryTime':_0x18411d[_0x3074df(0x15b)][_0x3074df(0x16f)],'createdOn':_0x18411d[_0x3074df(0x15b)]['CreatedOn'],'confirmedOn':_0x18411d[_0x3074df(0x15b)][_0x3074df(0x176)]};console[_0x3074df(0x113)](_0x3074df(0xf8)),console['log']('Status:',_0x18411d[_0x3074df(0x15b)][_0x3074df(0x15f)],'->',_0x422325),console[_0x3074df(0x113)](_0x3074df(0x122),_0x18411d[_0x3074df(0x15b)][_0x3074df(0x121)],_0x18411d[_0x3074df(0x15b)][_0x3074df(0x170)]),console[_0x3074df(0x113)](_0x3074df(0x165),_0x18411d['data'][_0x3074df(0x137)]),console[_0x3074df(0x113)](_0x3074df(0x104),_0x351c67||_0x3074df(0x14a)),console[_0x3074df(0x113)](_0x3074df(0x11f),_0x18411d[_0x3074df(0x15b)][_0x3074df(0x154)]),console[_0x3074df(0x113)](_0x3074df(0x131),_0x18411d['data'][_0x3074df(0x176)]||_0x3074df(0x163));if(_0x18411d[_0x3074df(0x15b)][_0x3074df(0x15f)]?.[_0x3074df(0x146)]()==='awaiting\x20fiat')console[_0x3074df(0x113)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x18411d['data'][_0x3074df(0x15f)]?.[_0x3074df(0x146)]()===_0x3074df(0x151)&&console[_0x3074df(0x113)](_0x3074df(0x129));return{'status':_0x422325,'amount':parseFloat(_0x18411d['data'][_0x3074df(0x121)])||undefined,'currency':_0x18411d[_0x3074df(0x15b)][_0x3074df(0x170)]||'EUR','paymentDetails':_0x198272};}catch(_0x5a402f){console[_0x3074df(0x10a)](_0x3074df(0x13f),_0x5a402f),loggerService_1['loggerService'][_0x3074df(0xfb)](_0x3074df(0x10e),_0x3074df(0x14e),_0x5a402f);throw new Error('Failed\x20to\x20check\x20CoinToPay2\x20payment\x20status:\x20'+(_0x5a402f instanceof Error?_0x5a402f[_0x3074df(0x14c)]:_0x3074df(0x160)));}}async['verifyPayment'](_0x7eeee5){const _0x50e1bc=a56_0x50bc61,_0x222e3b=await this[_0x50e1bc(0xfd)](_0x7eeee5);return{'status':_0x222e3b[_0x50e1bc(0x159)],'amount':_0x222e3b['amount'],'currency':_0x222e3b['currency']};}async[a56_0x50bc61(0x14d)](_0x3cb578){const _0x560d76=a56_0x50bc61;console[_0x560d76(0x113)]('Processing\x20CoinToPay2\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x3cb578);let _0x2786ee='PENDING';switch(_0x3cb578[_0x560d76(0x159)]?.['toLowerCase']()){case _0x560d76(0x151):_0x2786ee=_0x560d76(0x177);break;case _0x560d76(0x149):case'failed':case _0x560d76(0x10a):_0x2786ee=_0x560d76(0x143);break;case'expired':case _0x560d76(0x116):_0x2786ee=_0x560d76(0x13d);break;case _0x560d76(0x114):case _0x560d76(0x14b):case _0x560d76(0x127):case _0x560d76(0x179):default:_0x2786ee=_0x560d76(0x171);break;}return{'paymentId':_0x3cb578['order_id']||_0x3cb578['merchant_reference_id']||'','status':_0x2786ee,'amount':_0x3cb578[_0x560d76(0x17b)],'currency':_0x3cb578['currency']||_0x560d76(0x101)};}}exports['CoinToPay2Service']=CoinToPay2Service;function a56_0x4cfa(){const _0xc26bcd=['üè¶\x20Extracted\x20IBAN:','error','Parsed\x20Result:','URL:','HTTP\x20Status:','cointopay2','QRCodeURL','10588392oOKnDL','Invalid\x20JSON\x20response\x20from\x20CoinToPay2\x20API:\x20','source','log','pending','gateway_payment_id','timeout','üìä\x20Checking\x20CoinToPay2\x20payment\x20status\x20for:\x20','__esModule','payment_url','2sujzlc','HTTP\x20error!\x20status:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay2)','Business\x20Error:\x20','statusText','Created\x20On:','entries','Amount','Amount:','expired','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Request\x20Body:','PaymentDetail','awaiting\x20fiat','status_code','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20COINTOPAY2\x20STATUS\x20API\x20ERROR\x20===','Incomplete\x20response:\x20missing\x20data','üè¶\x20Extracted\x20IBAN\x20via\x20fallback:','===\x20COINTOPAY2\x20API\x20BUSINESS\x20ERROR\x20===','statusUrl','Payment\x20URL\x20(original):','Payment\x20System/1.0\x20(CoinToPay2)','Confirmed\x20On:','POST','HTTP\x20','CoinToPay2\x20API\x20error:\x20','result','Status:','TransactionID','now','2002116HbbmsJ','stringify','loggerService','Result:','EXPIRED','5425770IeOnUm','CoinToPay2\x20payment\x20status\x20check\x20error:','https://traffer.uk/gateway/cointopay/status.php','Unknown\x20error\x20from\x20CoinToPay2\x20status\x20API','===\x20COINTOPAY2\x20API\x20ERROR\x20===','FAILED','===\x20COINTOPAY2\x20SUCCESS\x20===','6471661xUxGJt','toLowerCase','416298ZnPbhN','Unknown\x20error\x20from\x20CoinToPay2\x20API','cancelled','not\x20found','waiting','message','processWebhook','/status','Invalid\x20response\x20from\x20CoinToPay2\x20status\x20API:\x20missing\x20data','text','paid','4135664oAXURF','Error\x20details:','CreatedOn','üìä\x20Status\x20check\x20URL:','Missing\x20data\x20in\x20response','application/json','logWhiteDomainResponse','status','üè¶\x20Payment\x20Detail:','data','logWhiteDomainRequest','/create','Response\x20data:','Status','Unknown\x20error','Response\x20Time:','headers','not\x20confirmed','Failed\x20to\x20create\x20CoinToPay2\x20payment\x20link:\x20','Transaction\x20ID:','using\x20pattern:','apiUrl','createPaymentLink','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','defineProperty','Response\x20Body:','8uYQtDM','===\x20COINTOPAY2\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Currency:','ExpiryTime','inputCurrency','PENDING','match','70HxIzRx','Error\x20message:',',\x20body:\x20','TransactionConfirmedOn','PAID','https://traffer.uk/gateway/cointopay/','created','JSON\x20Parse\x20Error:\x20','amount','===\x20COINTOPAY2\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY2\x20SERVICE\x20ERROR\x20===','Raw\x20Response\x20Body:','logWhiteDomainError','&alternative=false','checkPaymentStatus','Error\x20stack:','parse','Payment\x20Status:','EUR','816702FTDuIv','coinAddress','IBAN:','ü™ô\x20Creating\x20CoinToPay2\x20payment:\x20','===\x20COINTOPAY2\x20API\x20RESPONSE\x20(traffer.uk)\x20===','Error\x20Message:','Failed\x20to\x20parse\x20JSON\x20response:'];a56_0x4cfa=function(){return _0xc26bcd;};return a56_0x4cfa();}