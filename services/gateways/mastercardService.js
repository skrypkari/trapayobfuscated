'use strict';const a42_0x4903fa=a42_0x4b5a;(function(_0x1bb391,_0x35f4aa){const _0x55b038=a42_0x4b5a,_0x2dc9c3=_0x1bb391();while(!![]){try{const _0x316eba=parseInt(_0x55b038(0xe6))/0x1+parseInt(_0x55b038(0xaf))/0x2*(parseInt(_0x55b038(0x148))/0x3)+-parseInt(_0x55b038(0x136))/0x4*(-parseInt(_0x55b038(0x110))/0x5)+-parseInt(_0x55b038(0x183))/0x6+parseInt(_0x55b038(0x9b))/0x7+parseInt(_0x55b038(0xe2))/0x8*(-parseInt(_0x55b038(0xea))/0x9)+parseInt(_0x55b038(0xd0))/0xa;if(_0x316eba===_0x35f4aa)break;else _0x2dc9c3['push'](_0x2dc9c3['shift']());}catch(_0x204b22){_0x2dc9c3['push'](_0x2dc9c3['shift']());}}}(a42_0x3433,0xd1419));var __createBinding=this&&this[a42_0x4903fa(0xe4)]||(Object['create']?function(_0x5eda85,_0x26820e,_0x599f20,_0x52b39a){const _0x58d589=a42_0x4903fa;if(_0x52b39a===undefined)_0x52b39a=_0x599f20;var _0x11b42e=Object['getOwnPropertyDescriptor'](_0x26820e,_0x599f20);(!_0x11b42e||(_0x58d589(0x11f)in _0x11b42e?!_0x26820e[_0x58d589(0x101)]:_0x11b42e['writable']||_0x11b42e[_0x58d589(0x131)]))&&(_0x11b42e={'enumerable':!![],'get':function(){return _0x26820e[_0x599f20];}}),Object[_0x58d589(0x17b)](_0x5eda85,_0x52b39a,_0x11b42e);}:function(_0x3714bc,_0x45f7de,_0x425012,_0x27f869){if(_0x27f869===undefined)_0x27f869=_0x425012;_0x3714bc[_0x27f869]=_0x45f7de[_0x425012];}),__setModuleDefault=this&&this[a42_0x4903fa(0xdb)]||(Object[a42_0x4903fa(0x100)]?function(_0x4526f3,_0x3bf43b){const _0xd1700=a42_0x4903fa;Object[_0xd1700(0x17b)](_0x4526f3,_0xd1700(0xb0),{'enumerable':!![],'value':_0x3bf43b});}:function(_0xdd188f,_0x2bc9ea){const _0xb4cefa=a42_0x4903fa;_0xdd188f[_0xb4cefa(0xb0)]=_0x2bc9ea;}),__importStar=this&&this[a42_0x4903fa(0x9c)]||(function(){var _0x18f315=function(_0x4858bd){return _0x18f315=Object['getOwnPropertyNames']||function(_0xf77984){const _0x5f0ec2=a42_0x4b5a;var _0x562628=[];for(var _0xde51f9 in _0xf77984)if(Object['prototype'][_0x5f0ec2(0xe3)][_0x5f0ec2(0xd8)](_0xf77984,_0xde51f9))_0x562628[_0x562628[_0x5f0ec2(0xcf)]]=_0xde51f9;return _0x562628;},_0x18f315(_0x4858bd);};return function(_0x21c45a){const _0x410ab7=a42_0x4b5a;if(_0x21c45a&&_0x21c45a[_0x410ab7(0x101)])return _0x21c45a;var _0x282acb={};if(_0x21c45a!=null){for(var _0x13d2a6=_0x18f315(_0x21c45a),_0x2c7076=0x0;_0x2c7076<_0x13d2a6[_0x410ab7(0xcf)];_0x2c7076++)if(_0x13d2a6[_0x2c7076]!==_0x410ab7(0xb0))__createBinding(_0x282acb,_0x21c45a,_0x13d2a6[_0x2c7076]);}return __setModuleDefault(_0x282acb,_0x21c45a),_0x282acb;};}()),__importDefault=this&&this[a42_0x4903fa(0x113)]||function(_0x36c581){const _0x4dc0b5=a42_0x4903fa;return _0x36c581&&_0x36c581[_0x4dc0b5(0x101)]?_0x36c581:{'default':_0x36c581};};function a42_0x3433(){const _0x4090ce=['updatePaymentStatus','payment','final','webhookEvents','log','../telegramBotService','🔐\x20Data\x20encrypted\x20with\x20AES','isArray','🔐\x20Private\x20key\x20length:\x20','SHA256','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','includes','Status\x20decryption\x20failed:\x20','📝\x20Encrypted\x20data\x20length:','none','push','3DS\x20URL:','constants','number','json','create','__esModule','createSign','mastercard','from','paidAt','-----END','validateKeyFiles','\x20failed\x20for\x20payment\x20','\x20\x20\x20-\x20sign\x20length:','sendShopWebhook','POST','****\x20****\x20****\x20','Decryption\x20failed:\x20','createCipheriv','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','120jAbVaS','now','psp_public.pem','__importDefault','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','📝\x20Signature\x20length:','path','crypto','PHP\x20decryptor\x20error','...','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','decryptResponsePhp','\x20status\x20checks\x20for\x20payment\x20','🔐\x20RSA\x20signing\x20successful','Status:','get','private.pem','end','ms)','logShopWebhookError','createDecipheriv','HTTP\x20error!\x20status:\x20','stopAllStatusChecks','Card\x20Number:','MasterCard:\x20','slice','resolve','🧹\x20Clearing\x20','toString','🔐\x203DS\x20verification\x20required','message','decryptResponse','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','configurable','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','info','../../config/database','base64','114064NtNltJ','Card\x20Holder:','utf8','❌\x20MasterCard\x20key\x20validation\x20failed:','encryptRSA','parse','size','💾\x20Payment\x20data\x20prepared','trim','❌\x20RSA\x20signing\x20failed:','logWhiteDomainRequest','****','MasterCardService','paid','Public\x20key\x20file\x20not\x20found:\x20','logWhiteDomainResponse','FAILED','Private\x20key\x20file\x20not\x20found:\x20','1767255vKNMwt','Processing\x20MasterCard\x20webhook:','clearStatusTimers','/charge_decrypted','status','expire_year','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','),\x20stopping\x20status\x20checks','🔐\x20AES\x20key\x20length:','error','shopId','MasterCard\x20status\x20check\x20error:','unknown','Return\x20URL:','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','stringify','✅\x20Status\x20response\x20decrypted\x20successfully','apiUrl','key','scheduleStatusChecks','floor','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','HTTP\x20Status:','webhookUrl','📝\x20Encrypted\x20key\x20length:','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','\x20for\x20payment\x20','toUpperCase','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','payment.failed','publicKeyPath','date_success','loggerService','orderId','Failed\x20to\x20decrypt\x20response','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','PENDING','/charge_raw','statusCheckTimers','text','Unknown\x20error','payment_id','merchantPointId','/status_decrypt','/status_raw','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','Failed\x20to\x20send\x20MasterCard\x20webhook:','Result\x20URL:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','defineProperty','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','MasterCard\x20webhook\x20sent\x20to\x20','\x20\x20\x20-\x20lang:\x20en','privateDecrypt','/status','encryptAES','logWhiteDomainError','7763940szzUOE','keys','Order\x20ID:','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','toLowerCase','\x20not\x20enabled\x20for\x20shop\x20','🔐\x20AES\x20IV\x20length:','system','existsSync','🔐\x20AES\x20key\x20and\x20IV\x20generated',',\x20Final:\x20','update','settings','📝\x20Data\x20to\x20sign\x20length:','Payment\x20ID:','gatewayOrderId',',\x20Desc:\x20','275240oUlDAM','__importStar','forEach','maskCardNumber','📊\x20Status\x20check\x20#','/charge_decrypt','desc','sign','readFileSync','📊\x20Status\x20check\x20result:','/charge','first_name','✅\x20Scheduled\x20','adminNotes','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','✅\x20Payment\x20','\x20\x20\x20-\x20merchant_point_id:','Error\x20parsing\x20webhook\x20events:','join','🔐\x20Public\x20key\x20path:','2KDJqoi','default','PAID','❌\x20PHP\x20decryptor\x20request\x20failed:','expire_month','🛑\x20Stopped\x20','charge','\x20\x20\x20-\x20method:\x20charge','application/json','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','TesSoft\x20Payment\x20System/1.0','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','findUnique','then','sendPaymentNotifications','description','delete','privateKeyPath','\x20\x20\x20-\x20info\x20length:','\x20result:','📝\x20Data\x20length:','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','\x20MasterCard\x20status\x20check\x20timers','🔐\x20Private\x20key\x20path:','RSA_PKCS1_PADDING','Final:','/status_decrypted',',\x20body:\x20','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','❌\x20Status\x20check\x20#','publicEncrypt','Webhook\x20event\x20','length','14007840hSBwjz','shop','📝\x20Final\x20request\x20structure:','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','✅\x20Payment\x20successful','signRSA','customerName','amount','call','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','\x20with\x20status\x20','__setModuleDefault','currency','sendPaymentNotification','HTTP\x20','payment.success','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','Error\x20details:','7319896Uxtybu','hasOwnProperty','__createBinding','cvv','352517CCqWGr','3ds_url','Response\x20Time:','randomBytes','9MVxMaa','logShopWebhookSent'];a42_0x3433=function(){return _0x4090ce;};return a42_0x3433();}Object[a42_0x4903fa(0x17b)](exports,a42_0x4903fa(0x101),{'value':!![]}),exports['MasterCardService']=void 0x0;const crypto_1=__importDefault(require(a42_0x4903fa(0x117))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x4903fa(0x116))),loggerService_1=require('../loggerService');function a42_0x4b5a(_0x17976a,_0x4b4f07){const _0x3433ed=a42_0x3433();return a42_0x4b5a=function(_0x4b5aa8,_0x1c2ff2){_0x4b5aa8=_0x4b5aa8-0x9a;let _0x1c370b=_0x3433ed[_0x4b5aa8];return _0x1c370b;},a42_0x4b5a(_0x17976a,_0x4b4f07);}class MasterCardService{constructor(){const _0xba1c9e=a42_0x4903fa;this[_0xba1c9e(0x16f)]=new Map(),this['apiUrl']='https://api.paydmeth.com/api',this[_0xba1c9e(0x173)]=0x67c,this[_0xba1c9e(0xc0)]=path_1[_0xba1c9e(0xb0)][_0xba1c9e(0xad)](process['cwd'](),_0xba1c9e(0x184),_0xba1c9e(0x120)),this[_0xba1c9e(0x167)]=path_1['default'][_0xba1c9e(0xad)](process['cwd'](),'keys',_0xba1c9e(0x112)),console[_0xba1c9e(0xf0)]('💳\x20MasterCard\x20service\x20initialized'),console[_0xba1c9e(0xf0)](_0xba1c9e(0xc6),this[_0xba1c9e(0xc0)]),console[_0xba1c9e(0xf0)](_0xba1c9e(0xae),this[_0xba1c9e(0x167)]),this['validateKeyFiles']();}[a42_0x4903fa(0x107)](){const _0x3e7299=a42_0x4903fa;try{if(!fs_1[_0x3e7299(0xb0)][_0x3e7299(0x18b)](this[_0x3e7299(0xc0)]))throw new Error(_0x3e7299(0x147)+this[_0x3e7299(0xc0)]);if(!fs_1[_0x3e7299(0xb0)][_0x3e7299(0x18b)](this[_0x3e7299(0x167)]))throw new Error(_0x3e7299(0x144)+this[_0x3e7299(0x167)]);const _0x33a9ae=fs_1[_0x3e7299(0xb0)][_0x3e7299(0xa3)](this[_0x3e7299(0xc0)],'utf8')['trim'](),_0x51f1f0=fs_1[_0x3e7299(0xb0)][_0x3e7299(0xa3)](this['publicKeyPath'],_0x3e7299(0x138))[_0x3e7299(0x13e)]();if(!_0x33a9ae['includes']('-----BEGIN')||!_0x33a9ae[_0x3e7299(0xf7)](_0x3e7299(0x106)))throw new Error(_0x3e7299(0x156));if(!_0x51f1f0[_0x3e7299(0xf7)]('-----BEGIN')||!_0x51f1f0['includes'](_0x3e7299(0x106)))throw new Error('Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x3e7299(0xf0)]('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console[_0x3e7299(0xf0)](_0x3e7299(0xf4)+_0x33a9ae['length']+'\x20characters'),console[_0x3e7299(0xf0)]('🔐\x20Public\x20key\x20length:\x20'+_0x51f1f0[_0x3e7299(0xcf)]+'\x20characters');}catch(_0x5ba434){console[_0x3e7299(0x151)](_0x3e7299(0x139),_0x5ba434);throw _0x5ba434;}}['generateAESKey'](){const _0x483571=a42_0x4903fa,_0x59d257=crypto_1['default'][_0x483571(0xe9)](0x20),_0x25f46e=crypto_1[_0x483571(0xb0)][_0x483571(0xe9)](0x10);return{'key':_0x59d257,'iv':_0x25f46e};}[a42_0x4903fa(0x181)](_0x198c15,_0xb0e765,_0x380a17){const _0x365a5b=a42_0x4903fa,_0xe47a10=crypto_1[_0x365a5b(0xb0)][_0x365a5b(0x10e)]('aes-256-ctr',_0xb0e765,_0x380a17);let _0x42b939=_0xe47a10[_0x365a5b(0x18e)](_0x198c15,_0x365a5b(0x138),_0x365a5b(0x135));return _0x42b939+=_0xe47a10['final']('base64'),_0x42b939;}[a42_0x4903fa(0x13a)](_0x2a284c,_0x28f547){const _0x22730e=a42_0x4903fa;try{const _0x3306be=fs_1[_0x22730e(0xb0)]['readFileSync'](this[_0x22730e(0x167)],'utf8')[_0x22730e(0x13e)](),_0x2c470e={'iv':_0x28f547[_0x22730e(0x12c)]('base64'),'key':_0x2a284c[_0x22730e(0x12c)](_0x22730e(0x135))},_0x53c7ff=JSON['stringify'](_0x2c470e);console['log'](_0x22730e(0xcb),_0x53c7ff[_0x22730e(0xcf)]);const _0x2ddb2e=crypto_1[_0x22730e(0xb0)][_0x22730e(0xcd)]({'key':_0x3306be,'padding':crypto_1[_0x22730e(0xb0)][_0x22730e(0xfd)][_0x22730e(0xc7)]},Buffer[_0x22730e(0x104)](_0x53c7ff));return console[_0x22730e(0xf0)](_0x22730e(0x14e),_0x2ddb2e['length']),_0x2ddb2e['toString'](_0x22730e(0x135));}catch(_0x18a13b){console[_0x22730e(0x151)]('❌\x20RSA\x20encryption\x20failed:',_0x18a13b);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a42_0x4903fa(0xd5)](_0x57fc2a){const _0x1bc565=a42_0x4903fa;try{const _0xca2d62=fs_1[_0x1bc565(0xb0)]['readFileSync'](this[_0x1bc565(0xc0)],_0x1bc565(0x138))[_0x1bc565(0x13e)](),_0x440b94=crypto_1[_0x1bc565(0xb0)][_0x1bc565(0x102)](_0x1bc565(0xf5));_0x440b94['update'](_0x57fc2a),_0x440b94[_0x1bc565(0x121)]();const _0x4f281d=_0x440b94['sign'](_0xca2d62,_0x1bc565(0x135));return console[_0x1bc565(0xf0)](_0x1bc565(0x11d)),console['log'](_0x1bc565(0x190),_0x57fc2a[_0x1bc565(0xcf)]),console[_0x1bc565(0xf0)](_0x1bc565(0x115),_0x4f281d[_0x1bc565(0xcf)]),_0x4f281d;}catch(_0x3256d7){console[_0x1bc565(0x151)](_0x1bc565(0x13f),_0x3256d7),console[_0x1bc565(0x151)]('❌\x20Data\x20being\x20signed:',_0x57fc2a['substring'](0x0,0xc8)+_0x1bc565(0x119));throw new Error(_0x1bc565(0x16c));}}['decryptAES'](_0x1eeebb,_0x19533e,_0x2feb1b){const _0x24bdb0=a42_0x4903fa,_0x566ede=crypto_1[_0x24bdb0(0xb0)][_0x24bdb0(0x124)]('aes-256-ctr',_0x19533e,_0x2feb1b);let _0x13e4a1=_0x566ede[_0x24bdb0(0x18e)](_0x1eeebb,'base64',_0x24bdb0(0x138));return _0x13e4a1+=_0x566ede[_0x24bdb0(0xee)](_0x24bdb0(0x138)),_0x13e4a1;}async[a42_0x4903fa(0x11b)](_0x34dd7b,_0x37207b){const _0x5639ae=a42_0x4903fa;try{const _0x233d5c=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x5639ae(0x10b),'headers':{'Content-Type':_0x5639ae(0xb7)},'body':JSON['stringify']({'info':_0x34dd7b,'key':_0x37207b})});if(!_0x233d5c['ok'])throw new Error(_0x5639ae(0x118));return await _0x233d5c[_0x5639ae(0x170)]();}catch(_0x285475){console['error'](_0x5639ae(0xb2),_0x285475);throw new Error(_0x5639ae(0x11a));}}[a42_0x4903fa(0x12f)](_0x53079f,_0x2970f6){const _0x1c0923=a42_0x4903fa;try{const _0x155b4d=fs_1[_0x1c0923(0xb0)][_0x1c0923(0xa3)](this[_0x1c0923(0xc0)],_0x1c0923(0x138))[_0x1c0923(0x13e)](),_0x3c7444=crypto_1[_0x1c0923(0xb0)][_0x1c0923(0x17f)](_0x155b4d,Buffer['from'](_0x2970f6,_0x1c0923(0x135))),_0x3bcb74=JSON[_0x1c0923(0x13b)](_0x3c7444[_0x1c0923(0x12c)]()),_0x9de45a=Buffer['from'](_0x3bcb74[_0x1c0923(0x15b)],_0x1c0923(0x135)),_0x301cdf=Buffer[_0x1c0923(0x104)](_0x3bcb74['iv'],_0x1c0923(0x135));return this['decryptAES'](_0x53079f,_0x9de45a,_0x301cdf);}catch(_0x2112b0){throw new Error(_0x1c0923(0x16b));}}async['processCardPayment'](_0x4fabb0){const _0x1ea04f=a42_0x4903fa,{paymentId:_0xc07d83,orderId:_0x3f588f,amount:_0x3bbd0f,currency:_0x31ee57,cardData:_0x429944,resultUrl:_0x488b97,returnUrl:_0x16d0e9,cardHolder:_0x119aad,browser:_0x2a8b73}=_0x4fabb0;console['log']('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console['log'](_0x1ea04f(0x191),_0xc07d83),console[_0x1ea04f(0xf0)](_0x1ea04f(0x185),_0x3f588f),console['log']('Amount:',_0x3bbd0f,_0x31ee57),console[_0x1ea04f(0xf0)](_0x1ea04f(0x127),this[_0x1ea04f(0x9e)](_0x429944[_0x1ea04f(0xfe)])),console[_0x1ea04f(0xf0)](_0x1ea04f(0x137),_0x119aad[_0x1ea04f(0xa6)]+'\x20'+_0x119aad['last_name']),console[_0x1ea04f(0xf0)](_0x1ea04f(0x155),_0x16d0e9),console['log'](_0x1ea04f(0x178),_0x488b97);const _0x4476cc={'amount':_0x3bbd0f,'currency':_0x31ee57[_0x1ea04f(0x164)](),'order_id':_0x3f588f,'result_url':_0x488b97,'return_url':_0x16d0e9,'card':{'number':_0x429944[_0x1ea04f(0xfe)],'expire_month':_0x429944[_0x1ea04f(0xb3)],'expire_year':_0x429944[_0x1ea04f(0x14d)],'cvv':_0x429944[_0x1ea04f(0xe5)]},'card_holder':_0x119aad,'browser':_0x2a8b73},_0x4f0bb9=JSON[_0x1ea04f(0x158)](_0x4476cc);console[_0x1ea04f(0xf0)](_0x1ea04f(0x13d)),console[_0x1ea04f(0xf0)](_0x1ea04f(0xb8)),console[_0x1ea04f(0xf0)](_0x4f0bb9),console[_0x1ea04f(0xf0)](_0x1ea04f(0xc3),_0x4f0bb9[_0x1ea04f(0xcf)]);try{const {key:_0x2bbc62,iv:_0x326190}=this['generateAESKey']();console['log'](_0x1ea04f(0x18c)),console['log'](_0x1ea04f(0x150),_0x2bbc62[_0x1ea04f(0xcf)]),console[_0x1ea04f(0xf0)](_0x1ea04f(0x189),_0x326190[_0x1ea04f(0xcf)]);const _0xbcf508=this['encryptAES'](_0x4f0bb9,_0x2bbc62,_0x326190);console[_0x1ea04f(0xf0)](_0x1ea04f(0xf2)),console['log'](_0x1ea04f(0xf9),_0xbcf508[_0x1ea04f(0xcf)]);const _0x123949=this['encryptRSA'](_0x2bbc62,_0x326190);console[_0x1ea04f(0xf0)](_0x1ea04f(0x10f)),console[_0x1ea04f(0xf0)](_0x1ea04f(0x161),_0x123949['length']);const _0x3dc768=this['signRSA'](_0x4f0bb9);console[_0x1ea04f(0xf0)]('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x1ea04f(0xf0)](_0x1ea04f(0x115),_0x3dc768[_0x1ea04f(0xcf)]);const _0x1d9897={'merchant_point_id':this[_0x1ea04f(0x173)],'method':'charge','info':_0xbcf508,'key':_0x123949,'sign':_0x3dc768,'lang':'en'};console['log'](_0x1ea04f(0xe0)),console['log'](_0x1ea04f(0xd2)),console[_0x1ea04f(0xf0)](_0x1ea04f(0xab),this[_0x1ea04f(0x173)]),console['log'](_0x1ea04f(0xb6)),console[_0x1ea04f(0xf0)](_0x1ea04f(0xc1),_0xbcf508[_0x1ea04f(0xcf)]),console[_0x1ea04f(0xf0)]('\x20\x20\x20-\x20key\x20length:',_0x123949[_0x1ea04f(0xcf)]),console[_0x1ea04f(0xf0)](_0x1ea04f(0x109),_0x3dc768[_0x1ea04f(0xcf)]),console[_0x1ea04f(0xf0)](_0x1ea04f(0x17e)),loggerService_1[_0x1ea04f(0x169)][_0x1ea04f(0x140)](_0x1ea04f(0x103),_0x1ea04f(0xa5),_0x1ea04f(0x10b),{'merchant_point_id':this['merchantPointId'],'method':_0x1ea04f(0xb5),'lang':'en'});const _0xef0b5d=Date['now'](),_0xb92c7a=await fetch(this[_0x1ea04f(0x15a)],{'method':_0x1ea04f(0x10b),'headers':{'Content-Type':'application/json','Accept':_0x1ea04f(0xb7),'User-Agent':_0x1ea04f(0xb9)},'body':JSON[_0x1ea04f(0x158)](_0x1d9897)}),_0x187d1a=Date[_0x1ea04f(0x111)]()-_0xef0b5d;console[_0x1ea04f(0xf0)](_0x1ea04f(0x17a)),console[_0x1ea04f(0xf0)]('Status:',_0xb92c7a[_0x1ea04f(0x14c)]),console[_0x1ea04f(0xf0)](_0x1ea04f(0xe8),_0x187d1a+'ms');if(!_0xb92c7a['ok']){const _0x4266ef=await _0xb92c7a[_0x1ea04f(0x170)]();console[_0x1ea04f(0x151)](_0x1ea04f(0x15f),_0xb92c7a['status']),console[_0x1ea04f(0x151)]('Response\x20Body:',_0x4266ef),loggerService_1[_0x1ea04f(0x169)][_0x1ea04f(0x145)](_0x1ea04f(0x103),_0x1ea04f(0x16e),_0xb92c7a['status'],_0x4266ef,_0x187d1a),loggerService_1[_0x1ea04f(0x169)][_0x1ea04f(0x182)](_0x1ea04f(0x103),_0x1ea04f(0xa5),_0x1ea04f(0xde)+_0xb92c7a[_0x1ea04f(0x14c)]+':\x20'+_0x4266ef);throw new Error(_0x1ea04f(0x125)+_0xb92c7a[_0x1ea04f(0x14c)]+_0x1ea04f(0xca)+_0x4266ef);}const _0x192123=await _0xb92c7a[_0x1ea04f(0xff)]();loggerService_1[_0x1ea04f(0x169)][_0x1ea04f(0x145)](_0x1ea04f(0x103),_0x1ea04f(0x16e),_0xb92c7a[_0x1ea04f(0x14c)],_0x192123,_0x187d1a),console[_0x1ea04f(0xf0)](_0x1ea04f(0x15e));let _0x42846d=_0x192123;if(_0x192123[_0x1ea04f(0x133)]&&_0x192123[_0x1ea04f(0x15b)]&&_0x192123[_0x1ea04f(0xa2)]){console['log'](_0x1ea04f(0xa9));try{const _0x4f1b5f=await this['decryptResponsePhp'](_0x192123['info'],_0x192123[_0x1ea04f(0x15b)]);_0x42846d=JSON[_0x1ea04f(0x13b)](_0x4f1b5f),console['log'](_0x1ea04f(0x186)),loggerService_1[_0x1ea04f(0x169)]['logWhiteDomainResponse'](_0x1ea04f(0x103),_0x1ea04f(0x14b),_0xb92c7a[_0x1ea04f(0x14c)],_0x42846d,_0x187d1a),console[_0x1ea04f(0xf0)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x41a64f){console[_0x1ea04f(0x151)](_0x1ea04f(0x130),_0x41a64f),loggerService_1[_0x1ea04f(0x169)][_0x1ea04f(0x182)](_0x1ea04f(0x103),_0x1ea04f(0xa0),_0x1ea04f(0x10d)+_0x41a64f),_0x42846d=_0x192123;}}else loggerService_1[_0x1ea04f(0x169)]['logWhiteDomainResponse']('mastercard',_0x1ea04f(0x14b),_0xb92c7a[_0x1ea04f(0x14c)],_0x42846d,_0x187d1a),console[_0x1ea04f(0xf0)](_0x1ea04f(0x157));console[_0x1ea04f(0xf0)](_0x1ea04f(0x11e),_0x42846d[_0x1ea04f(0x14c)]),console[_0x1ea04f(0xf0)](_0x1ea04f(0xc8),_0x42846d['final']),console['log'](_0x1ea04f(0x191),_0x42846d[_0x1ea04f(0x172)]),console['log'](_0x1ea04f(0xfc),_0x42846d['3ds_url']||_0x1ea04f(0xfa));if(_0x42846d[_0x1ea04f(0x14c)]===0x64&&_0x42846d[_0x1ea04f(0xee)]===0x1)return console[_0x1ea04f(0xf0)](_0x1ea04f(0xd4)),{'gateway_payment_id':_0x42846d[_0x1ea04f(0x172)]?.['toString'](),'payment_url':_0x16d0e9,'requires_3ds':![],'status':_0x1ea04f(0xb1),'final':!![]};if(_0x42846d[_0x1ea04f(0xe7)])return console[_0x1ea04f(0xf0)](_0x1ea04f(0x12d)),this[_0x1ea04f(0x15c)](_0xc07d83,_0x3f588f,_0x42846d['payment_id']?.[_0x1ea04f(0x12c)]()||_0x3f588f),{'gateway_payment_id':_0x42846d[_0x1ea04f(0x172)]?.[_0x1ea04f(0x12c)](),'payment_url':_0x42846d['3ds_url'],'requires_3ds':!![],'threeds_url':_0x42846d[_0x1ea04f(0xe7)],'status':_0x1ea04f(0x16d),'final':![]};let _0x1e42d0=_0x42846d['desc']||_0x42846d[_0x1ea04f(0x12e)]||'Unknown\x20error',_0x33356a=_0x42846d[_0x1ea04f(0x14c)],_0xeda32e=_0x42846d[_0x1ea04f(0xee)];return console[_0x1ea04f(0xf0)](_0x1ea04f(0xc4)+_0x33356a+_0x1ea04f(0x18d)+_0xeda32e+_0x1ea04f(0x9a)+_0x1e42d0),{'gateway_payment_id':_0x42846d[_0x1ea04f(0x172)]?.[_0x1ea04f(0x12c)](),'payment_url':_0x16d0e9,'requires_3ds':![],'status':_0x1ea04f(0x146),'final':!![]};}catch(_0x1c44af){console[_0x1ea04f(0x151)](_0x1ea04f(0x165)),console[_0x1ea04f(0x151)](_0x1ea04f(0xe1),_0x1c44af),loggerService_1[_0x1ea04f(0x169)][_0x1ea04f(0x182)](_0x1ea04f(0x103),_0x1ea04f(0xa5),_0x1c44af);throw new Error('Failed\x20to\x20process\x20MasterCard\x20payment:\x20'+(_0x1c44af instanceof Error?_0x1c44af[_0x1ea04f(0x12e)]:'Unknown\x20error'));}}async['checkPaymentStatus'](_0x5e9d3b,_0x2e3b43){const _0x17de64=a42_0x4903fa;console[_0x17de64(0xf0)](_0x17de64(0x114)+_0x5e9d3b+'\x20('+_0x2e3b43+')');try{const _0x35f847={'payment_id':_0x5e9d3b,'order_id':_0x2e3b43},_0x4e750b=JSON[_0x17de64(0x158)](_0x35f847),{key:_0x94dc6b,iv:_0x4c9c85}=this['generateAESKey'](),_0x4258e2=this['encryptAES'](_0x4e750b,_0x94dc6b,_0x4c9c85),_0x152136=this['encryptRSA'](_0x94dc6b,_0x4c9c85),_0x13b235=this[_0x17de64(0xd5)](_0x4e750b),_0x820156={'merchant_point_id':this['merchantPointId'],'method':_0x17de64(0x14c),'info':_0x4258e2,'key':_0x152136,'sign':_0x13b235,'lang':'en'};loggerService_1['loggerService'][_0x17de64(0x140)]('mastercard',_0x17de64(0x180),_0x17de64(0x10b),{'merchant_point_id':this[_0x17de64(0x173)],'method':'status','lang':'en'});const _0x3b317a=Date[_0x17de64(0x111)](),_0x3d77e8=await fetch(this['apiUrl'],{'method':_0x17de64(0x10b),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x17de64(0xb9)},'body':JSON[_0x17de64(0x158)](_0x820156)}),_0x488924=Date['now']()-_0x3b317a;if(!_0x3d77e8['ok']){const _0x5e453f=await _0x3d77e8['text']();loggerService_1[_0x17de64(0x169)]['logWhiteDomainResponse'](_0x17de64(0x103),_0x17de64(0x175),_0x3d77e8[_0x17de64(0x14c)],_0x5e453f,_0x488924);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3d77e8[_0x17de64(0x14c)]);}const _0xba2f75=await _0x3d77e8[_0x17de64(0xff)]();loggerService_1[_0x17de64(0x169)][_0x17de64(0x145)]('mastercard',_0x17de64(0x175),_0x3d77e8[_0x17de64(0x14c)],_0xba2f75,_0x488924);let _0x31dadd=_0xba2f75;if(_0xba2f75[_0x17de64(0x133)]&&_0xba2f75[_0x17de64(0x15b)]&&_0xba2f75[_0x17de64(0xa2)]){console[_0x17de64(0xf0)](_0x17de64(0x176));try{const _0x296404=this['decryptResponse'](_0xba2f75[_0x17de64(0x133)],_0xba2f75[_0x17de64(0x15b)]);_0x31dadd=JSON[_0x17de64(0x13b)](_0x296404),console['log'](_0x17de64(0x159)),loggerService_1[_0x17de64(0x169)][_0x17de64(0x145)](_0x17de64(0x103),_0x17de64(0xc9),_0x3d77e8[_0x17de64(0x14c)],_0x31dadd,_0x488924),console[_0x17de64(0xf0)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x301c1d){console[_0x17de64(0x151)](_0x17de64(0x17c),_0x301c1d),loggerService_1[_0x17de64(0x169)][_0x17de64(0x182)](_0x17de64(0x103),_0x17de64(0x174),_0x17de64(0xf8)+_0x301c1d),_0x31dadd=_0xba2f75;}}else loggerService_1[_0x17de64(0x169)]['logWhiteDomainResponse']('mastercard',_0x17de64(0xc9),_0x3d77e8['status'],_0x31dadd,_0x488924),console['log'](_0x17de64(0xd3));console[_0x17de64(0xf0)](_0x17de64(0xa4),{'status':_0x31dadd['status'],'final':_0x31dadd[_0x17de64(0xee)],'payment_id':_0x31dadd['payment_id'],'desc':_0x31dadd[_0x17de64(0xa1)]});let _0x47de3c=_0x17de64(0x16d);if(_0x31dadd[_0x17de64(0x14c)]===0x1&&_0x31dadd['final']===0x1)_0x47de3c=_0x17de64(0xb1);else _0x31dadd[_0x17de64(0x14c)]===0x0&&_0x31dadd[_0x17de64(0xee)]===0x0?_0x47de3c=_0x17de64(0x16d):_0x47de3c='FAILED';return{'status':_0x47de3c,'final':_0x31dadd[_0x17de64(0xee)]===0x1,'amount':_0x31dadd[_0x17de64(0xd7)],'currency':_0x31dadd[_0x17de64(0xdc)],'date_success':_0x31dadd[_0x17de64(0x168)],'description':_0x31dadd[_0x17de64(0xa1)]};}catch(_0x37cd3b){console[_0x17de64(0x151)](_0x17de64(0x153),_0x37cd3b),loggerService_1[_0x17de64(0x169)][_0x17de64(0x182)](_0x17de64(0x103),_0x17de64(0x180),_0x37cd3b);throw new Error(_0x17de64(0x132)+(_0x37cd3b instanceof Error?_0x37cd3b[_0x17de64(0x12e)]:_0x17de64(0x171)));}}[a42_0x4903fa(0x15c)](_0x54db25,_0x5c24b8,_0x1942a0){const _0x141531=a42_0x4903fa;console[_0x141531(0xf0)](_0x141531(0x162)+_0x54db25+'\x20('+_0x1942a0+')'),this[_0x141531(0x14a)](_0x54db25);const _0x8f6da3=[],_0x2a095e=0x5*0x3c*0x3e8,_0x2eba3b=0x2*0x3c*0x3c*0x3e8,_0x28ed4a=Math[_0x141531(0x15d)](_0x2eba3b/_0x2a095e);console[_0x141531(0xf0)]('⏰\x20Will\x20check\x20status\x20'+_0x28ed4a+_0x141531(0xba));for(let _0x32d18b=0x1;_0x32d18b<=_0x28ed4a;_0x32d18b++){const _0x5720b0=setTimeout(async()=>{const _0x236d1c=_0x141531;console['log']('🔍\x20MasterCard\x20status\x20check\x20#'+_0x32d18b+'/'+_0x28ed4a+_0x236d1c(0x163)+_0x54db25);try{const _0x30f9b4=await this['checkPaymentStatus'](_0x1942a0,_0x5c24b8);console[_0x236d1c(0xf0)](_0x236d1c(0x9f)+_0x32d18b+_0x236d1c(0xc2),_0x30f9b4),_0x30f9b4[_0x236d1c(0xee)]&&(console[_0x236d1c(0xf0)](_0x236d1c(0xaa)+_0x54db25+'\x20is\x20final\x20('+_0x30f9b4[_0x236d1c(0x14c)]+_0x236d1c(0x14f)),this[_0x236d1c(0x14a)](_0x54db25),await this[_0x236d1c(0xec)](_0x54db25,_0x30f9b4[_0x236d1c(0x14c)],_0x30f9b4));}catch(_0x329e4b){console[_0x236d1c(0x151)](_0x236d1c(0xcc)+_0x32d18b+_0x236d1c(0x108)+_0x54db25+':',_0x329e4b);}},_0x32d18b*_0x2a095e);_0x8f6da3[_0x141531(0xfb)](_0x5720b0);}this[_0x141531(0x16f)]['set'](_0x54db25,_0x8f6da3),console[_0x141531(0xf0)](_0x141531(0xa7)+_0x28ed4a+_0x141531(0x11c)+_0x54db25);}[a42_0x4903fa(0x14a)](_0x2ace35){const _0x289089=a42_0x4903fa,_0x5d54c9=this[_0x289089(0x16f)][_0x289089(0x11f)](_0x2ace35);_0x5d54c9&&(console[_0x289089(0xf0)](_0x289089(0x12b)+_0x5d54c9[_0x289089(0xcf)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x2ace35),_0x5d54c9[_0x289089(0x9d)]((_0x1f32d0,_0x579a79)=>{clearTimeout(_0x1f32d0);}),this[_0x289089(0x16f)][_0x289089(0xbf)](_0x2ace35));}async[a42_0x4903fa(0xec)](_0xd4345d,_0x1a1417,_0x5a6b92){const _0x3ba192=a42_0x4903fa;try{const _0x30e3fd=(await Promise['resolve']()[_0x3ba192(0xbc)](()=>__importStar(require('../../config/database'))))[_0x3ba192(0xb0)],_0x5d3826={'status':_0x1a1417[_0x3ba192(0x164)](),'updatedAt':new Date(),'statusChangedBy':_0x3ba192(0x18a),'statusChangedAt':new Date()};_0x1a1417===_0x3ba192(0xb1)&&(_0x5d3826[_0x3ba192(0x105)]=new Date()),_0x5a6b92[_0x3ba192(0xbe)]&&(_0x5d3826[_0x3ba192(0xa8)]=_0x3ba192(0x128)+_0x5a6b92[_0x3ba192(0xbe)]),await _0x30e3fd[_0x3ba192(0xed)][_0x3ba192(0x18e)]({'where':{'id':_0xd4345d},'data':_0x5d3826}),console['log'](_0x3ba192(0xaa)+_0xd4345d+'\x20status\x20updated\x20to\x20'+_0x1a1417),await this['sendPaymentNotifications'](_0xd4345d,_0x1a1417);}catch(_0x1239d4){console[_0x3ba192(0x151)](_0x3ba192(0xd9)+_0xd4345d+':',_0x1239d4);}}async[a42_0x4903fa(0xbd)](_0x465b95,_0x6e026a){const _0x56fd8f=a42_0x4903fa;try{const _0x558fc0=(await Promise['resolve']()['then'](()=>__importStar(require(_0x56fd8f(0x134)))))[_0x56fd8f(0xb0)],{telegramBotService:_0x200dc0}=await Promise[_0x56fd8f(0x12a)]()[_0x56fd8f(0xbc)](()=>__importStar(require(_0x56fd8f(0xf1)))),_0x21fb1a=await _0x558fc0[_0x56fd8f(0xed)][_0x56fd8f(0xbb)]({'where':{'id':_0x465b95},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x21fb1a)return;const _0x273383={'PAID':_0x56fd8f(0x143),'FAILED':'failed'},_0x205068=_0x273383[_0x6e026a];_0x205068&&await _0x200dc0[_0x56fd8f(0xdd)](_0x21fb1a['shopId'],_0x21fb1a,_0x205068),await this[_0x56fd8f(0x10a)](_0x21fb1a,_0x6e026a);}catch(_0x18041f){console[_0x56fd8f(0x151)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x18041f);}}async[a42_0x4903fa(0x10a)](_0x937230,_0x4ba62b){const _0x287245=a42_0x4903fa,_0x268a87=Date['now']();try{const _0x233cb5=_0x937230[_0x287245(0xd1)],_0x523d4c=_0x233cb5['settings'];if(!_0x523d4c?.[_0x287245(0x160)]){console[_0x287245(0xf0)](_0x287245(0xf6)+_0x233cb5['id']);return;}const _0x180b6e=_0x4ba62b==='PAID'?_0x287245(0xdf):_0x287245(0x166);let _0x567bc5=[];if(_0x523d4c[_0x287245(0xef)])try{_0x567bc5=Array[_0x287245(0xf3)](_0x523d4c[_0x287245(0xef)])?_0x523d4c[_0x287245(0xef)]:JSON[_0x287245(0x13b)](_0x523d4c[_0x287245(0xef)]);}catch(_0x575158){console['error'](_0x287245(0xac),_0x575158),_0x567bc5=[];}if(!_0x567bc5[_0x287245(0xf7)](_0x180b6e)){console[_0x287245(0xf0)](_0x287245(0xce)+_0x180b6e+_0x287245(0x188)+_0x233cb5['id']);return;}const _0x595827={'event':_0x180b6e,'payment':{'id':_0x937230['id'],'order_id':_0x937230[_0x287245(0x16a)],'gateway_order_id':_0x937230[_0x287245(0x192)],'gateway':'1111','amount':_0x937230['amount'],'currency':_0x937230[_0x287245(0xdc)],'status':_0x4ba62b[_0x287245(0x187)](),'customer_email':_0x937230['customerEmail'],'customer_name':_0x937230[_0x287245(0xd6)],'created_at':_0x937230['createdAt'],'updated_at':new Date()}},_0x1fea99=await fetch(_0x523d4c['webhookUrl'],{'method':_0x287245(0x10b),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(MasterCard)'},'body':JSON[_0x287245(0x158)](_0x595827)}),_0xed7eab=Date['now']()-_0x268a87;loggerService_1['loggerService'][_0x287245(0xeb)](_0x937230['shopId'],_0x523d4c['webhookUrl'],_0x180b6e,_0x1fea99[_0x287245(0x14c)],_0xed7eab,_0x595827),console[_0x287245(0xf0)](_0x287245(0x17d)+_0x523d4c[_0x287245(0x160)]+_0x287245(0xda)+_0x1fea99[_0x287245(0x14c)]+'\x20('+_0xed7eab+_0x287245(0x122));}catch(_0x319882){console['error'](_0x287245(0x177),_0x319882),loggerService_1['loggerService'][_0x287245(0x123)](_0x937230[_0x287245(0x152)],_0x937230[_0x287245(0xd1)]?.[_0x287245(0x18f)]?.[_0x287245(0x160)]||_0x287245(0x154),'webhook_send',_0x319882,{});}}['maskCardNumber'](_0x2772d9){const _0x3ae45d=a42_0x4903fa,_0x494482=_0x2772d9['replace'](/[\s-]/g,'');if(_0x494482['length']<0x4)return _0x3ae45d(0x141);return _0x3ae45d(0x10c)+_0x494482[_0x3ae45d(0x129)](-0x4);}async['processWebhook'](_0x56b427){const _0x523e67=a42_0x4903fa;console[_0x523e67(0xf0)](_0x523e67(0x149),_0x56b427);let _0x1a11b7=_0x523e67(0x16d);if(_0x56b427[_0x523e67(0x14c)]===0x1&&_0x56b427[_0x523e67(0xee)]===0x1)_0x1a11b7=_0x523e67(0xb1);else _0x56b427[_0x523e67(0x14c)]===0x0&&_0x56b427['final']===0x0?_0x1a11b7=_0x523e67(0x16d):_0x1a11b7=_0x523e67(0x146);return{'paymentId':_0x56b427['order_id']||'','status':_0x1a11b7,'amount':_0x56b427[_0x523e67(0xd7)],'currency':_0x56b427[_0x523e67(0xdc)]};}[a42_0x4903fa(0x126)](){const _0x5ef793=a42_0x4903fa;console[_0x5ef793(0xf0)](_0x5ef793(0x179));const _0x64c2b=this[_0x5ef793(0x16f)][_0x5ef793(0x13c)];for(const [_0x556c7e]of this[_0x5ef793(0x16f)]){this[_0x5ef793(0x14a)](_0x556c7e);}console[_0x5ef793(0xf0)](_0x5ef793(0xb4)+_0x64c2b+_0x5ef793(0xc5));}}exports[a42_0x4903fa(0x142)]=MasterCardService;