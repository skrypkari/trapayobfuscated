'use strict';const a57_0x3eab0a=a57_0x4aab;(function(_0x21eac0,_0x27c202){const _0x1d70cb=a57_0x4aab,_0x3bc1db=_0x21eac0();while(!![]){try{const _0x27bd00=parseInt(_0x1d70cb(0x214))/0x1*(-parseInt(_0x1d70cb(0x266))/0x2)+-parseInt(_0x1d70cb(0x149))/0x3*(parseInt(_0x1d70cb(0x24b))/0x4)+-parseInt(_0x1d70cb(0x222))/0x5*(-parseInt(_0x1d70cb(0x24a))/0x6)+parseInt(_0x1d70cb(0x22b))/0x7+parseInt(_0x1d70cb(0x120))/0x8*(-parseInt(_0x1d70cb(0x123))/0x9)+-parseInt(_0x1d70cb(0x22d))/0xa+parseInt(_0x1d70cb(0x111))/0xb;if(_0x27bd00===_0x27c202)break;else _0x3bc1db['push'](_0x3bc1db['shift']());}catch(_0x2b210e){_0x3bc1db['push'](_0x3bc1db['shift']());}}}(a57_0xe036,0x8e9aa));var __createBinding=this&&this[a57_0x3eab0a(0x13b)]||(Object[a57_0x3eab0a(0x136)]?function(_0x1228fe,_0xb0a4,_0x59b009,_0x182916){const _0x346409=a57_0x3eab0a;if(_0x182916===undefined)_0x182916=_0x59b009;var _0x1ecd89=Object[_0x346409(0x265)](_0xb0a4,_0x59b009);(!_0x1ecd89||(_0x346409(0x25f)in _0x1ecd89?!_0xb0a4['__esModule']:_0x1ecd89[_0x346409(0x1d7)]||_0x1ecd89[_0x346409(0x12a)]))&&(_0x1ecd89={'enumerable':!![],'get':function(){return _0xb0a4[_0x59b009];}}),Object[_0x346409(0x19b)](_0x1228fe,_0x182916,_0x1ecd89);}:function(_0x426821,_0x34ae9d,_0x493127,_0x37d016){if(_0x37d016===undefined)_0x37d016=_0x493127;_0x426821[_0x37d016]=_0x34ae9d[_0x493127];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x454e19,_0x15ac83){const _0x21292e=a57_0x3eab0a;Object['defineProperty'](_0x454e19,_0x21292e(0x1e1),{'enumerable':!![],'value':_0x15ac83});}:function(_0x8e6ee1,_0x28f65d){const _0x530741=a57_0x3eab0a;_0x8e6ee1[_0x530741(0x1e1)]=_0x28f65d;}),__importStar=this&&this['__importStar']||(function(){var _0x3ebe37=function(_0x1c1e8e){const _0x2476d8=a57_0x4aab;return _0x3ebe37=Object[_0x2476d8(0x190)]||function(_0x1d1813){const _0x39f979=_0x2476d8;var _0x5783dc=[];for(var _0xfed0 in _0x1d1813)if(Object[_0x39f979(0x1b9)][_0x39f979(0x19a)]['call'](_0x1d1813,_0xfed0))_0x5783dc[_0x5783dc[_0x39f979(0x1f5)]]=_0xfed0;return _0x5783dc;},_0x3ebe37(_0x1c1e8e);};return function(_0x2be39d){const _0x478d75=a57_0x4aab;if(_0x2be39d&&_0x2be39d[_0x478d75(0x1b6)])return _0x2be39d;var _0x4c92c5={};if(_0x2be39d!=null){for(var _0x276167=_0x3ebe37(_0x2be39d),_0x28bbf0=0x0;_0x28bbf0<_0x276167[_0x478d75(0x1f5)];_0x28bbf0++)if(_0x276167[_0x28bbf0]!==_0x478d75(0x1e1))__createBinding(_0x4c92c5,_0x2be39d,_0x276167[_0x28bbf0]);}return __setModuleDefault(_0x4c92c5,_0x2be39d),_0x4c92c5;};}()),__importDefault=this&&this['__importDefault']||function(_0x3dd042){const _0x2eb163=a57_0x3eab0a;return _0x3dd042&&_0x3dd042[_0x2eb163(0x1b6)]?_0x3dd042:{'default':_0x3dd042};};Object[a57_0x3eab0a(0x19b)](exports,a57_0x3eab0a(0x1b6),{'value':!![]}),exports['VisaMasterCardService']=void 0x0;function a57_0x4aab(_0xbef48c,_0x3397db){_0xbef48c=_0xbef48c-0x10e;const _0xe036c1=a57_0xe036();let _0x4aaba5=_0xe036c1[_0xbef48c];return _0x4aaba5;}function a57_0xe036(){const _0x21e3ac=['‚ùå\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','5000000000000000','üîê\x20Response\x20is\x20encrypted,\x20decrypting...','default','\x20(from:\x20status=','\x20payment:\x20','scheduleStatusChecks','existsSync','\x20\x20Original:\x20\x22','Failed\x20to\x20check\x20','‚ùå\x20Data\x20being\x20signed:','info','charge','Payment\x20ID:','settings','https://api2.trapay.uk/decrypt.php','now','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','system','sign','‚è∞\x20Will\x20check\x20status\x20','cwd','length','stopAllStatusChecks','maskCardNumber','base64','failed','visaPublicKeyPath','üßπ\x20Card\x20holder\x20names\x20cleaned:','statusCheckTimers','3ds_url','aes-256-ctr','üíæ\x20Saving\x20failure\x20message:\x20','Status:','üîê\x20VISA\x20Private\x20key\x20path:','üîç\x20','üéØ\x20Using\x20','\x20payment\x20status:\x20','postcode','üìù\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','üîê\x20VISA\x20Public\x20key\x20length:\x20','Awaiting\x20confirmation\x20in\x20the\x20application','paymentId','size','\x20status\x20check\x20error:','createdAt','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','‚úÖ\x20MasterCard\x20key\x20files\x20validated\x20successfully','join','===\x20PARSED\x20API\x20RESPONSE\x20===','update','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','publicKeyPath','583UNEMPQ','VisaMasterCardService','last_name','Payment\x20confirmation\x20required','logShopWebhookSent','Test\x20payment','warn','\x20\x20\x20-\x20sign\x20length:','slice','date_success','statusText','generateAESKey','\x20status\x20updated\x20to\x20','Method\x20not\x20allowed','465jRLMFx','decryptResponsePhp','‚ùå\x20Failed\x20to\x20decrypt\x20status\x20response:','payment','encryptAES','...','signRSA','\x20order_id\x20for\x20search:\x20','üìù\x20Decrypted\x20webhook\x20data:','4428788ndZdlj','desc','7896370sPvcYA','webhookEvents','first_name','üìù\x20Encrypted\x20key\x20length:','updatePaymentStatus','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','‚ùå\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','Failed\x20to\x20decrypt\x20response','charAt','‚ùå\x20RSA\x20signing\x20failed:','Failed\x20payment','üîÑ\x20Converted\x20postcode\x20to\x20post_code:\x20','4000000000000000','Request\x20data\x20error','clearStatusTimers','Cancellation\x20is\x20not\x20possible','‚úÖ\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','getDetailedErrorMessage','then','substring','1111','/status_decrypt','shop','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','parse','Webhook\x20event\x20','from','‚úÖ\x20Payment\x20','apiUrl','31116bbpcXa','4076vttbOa','error','üõë\x20Stopped\x20','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details',',\x20Final:\x20','‚úÖ\x20Payment\x20successful','‚ùå\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','/status_raw','üõë\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','isFinalStatus','‚ùå\x20VISA/MasterCard\x20key\x20validation\x20failed:','card_type','‚ö†Ô∏è\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','createDecipheriv','../../config/database','-----END','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','findUnique','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','\x20\x20\x20Status:\x20','get','üîê\x20AES\x20IV\x20length:','/status','paid','encryptRSA','LookUp\x20code\x20sent','getOwnPropertyDescriptor','2692bVhSim','utf8','SHA256','Final:','16910113kxfCAl','),\x20defaulting\x20to\x20MasterCard','forEach','Response\x20Time:','No\x20Error\x20executing\x20request','‚è∞\x20Scheduling\x20status\x20checks\x20for\x20','Sender\x20information\x20required','MASTERCARD','decryptResponse','üìù\x20Signature\x20length:','/charge_decrypted','logWhiteDomainRequest','üîê\x20AES\x20key\x20length:','Unsuccessful\x20payment','processCardPayment','856BMRDPM','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','cardType','3051tPwyaK','FAILED','paidAt','üì¶\x20FULL\x20REQUEST\x20JSON:','text','‚úÖ\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','configurable','üì¶\x20FULL\x20RESPONSE\x20JSON:','application/json','\x20API:\x20','\x20with\x20status\x20','Payment\x20returned','../loggerService','\x20\x20\x20-\x20method:\x20charge','Amount:','VISA','Payment\x20is\x20being\x20processed','\x20\x20\x20Payment\x20ID:\x20','create','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','‚úÖ\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','üìä\x20Status\x20check\x20#','Invalid\x20expiration\x20date','__createBinding','/charge','üìä\x20Checking\x20','number','privateKeyPath','keys','üîê\x20VISA\x20Private\x20key\x20length:\x20','Response\x20Headers:','getCardTypeAndApi','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','gatewayOrderId','POST','checkPaymentStatus','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','1347XoYwPt','\x20characters','üîê\x20Data\x20signed\x20with\x20RSA','\x20\x20Cleaned:\x20\x20\x22','expire_month',',\x20payment_id=','orderId','paymentStatuses','log','‚ö†Ô∏è\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','RSA_PKCS1_PADDING','üîê\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','status','üîê\x203DS\x20verification\x20required','amount','merchantPointId','‚ùå\x20RSA\x20encryption\x20failed:','\x20\x20\x20','masterCardApiUrl','createSign','üîê\x20VISA\x20API\x20URL:','logWhiteDomainError','Client\x20OTP\x20confirmation\x20required','post_code','PAID','webhook_send','visaPrivateKeyPath','HTTP\x20','Payment\x20System/1.0','üìù\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted',':\x20Unknown\x20status\x20code','toString','visaApiUrl','),\x20stopping\x20status\x20checks','‚ùå\x20Status\x20check\x20#','sendPaymentNotification','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','replace','Order\x20ID:','LookUp\x20code\x20verified','/charge_raw','üìä\x20','Payment\x20System/1.0\x20(MasterCard)','üí≥\x20Detected\x20MasterCard\x20(starts\x20with\x205)','cvv','\x20status\x20checks\x20for\x20payment\x20','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','readFileSync','toLowerCase','randomBytes','masterCardMerchantPointId','PENDING','The\x20card\x20is\x20lost\x20or\x20stolen','description','üìù\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Transaction\x20limit\x20exceeded','üîç\x20Using\x20fallback\x20fields\x20for\x20search:\x20','order_id','payment_id','resolve','üìù\x20Data\x20length:','‚ö†Ô∏è\x20Expected\x20VISA\x20public\x20key:\x20','LookUp\x20not\x20confirmed','\x20webhook\x20extracted\x20data:','\x20payment_id\x20for\x20search:\x20','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','visaMerchantPointId','‚ùå\x20Detailed\x20failure\x20description:\x20','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','\x20\x20\x20-\x20merchant_point_id:','visa_private.pem','getOwnPropertyNames','\x20\x20\x20Currency:\x20','json','üíæ\x20Payment\x20data\x20prepared','customerEmail','decryptAES','/status_decrypted','Error\x20parsing\x20webhook\x20events:','3DS\x20URL:','processWebhook','hasOwnProperty','defineProperty','isArray','Expected\x20bitcoin\x20transfer\x20from\x20client','Another\x20unknown\x20error','üßπ\x20Clearing\x20','psp_public.pem','webhookUrl','includes','shopId','üí≥\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','/charge_decrypt','\x20for\x20payment\x20','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','currency','Failed\x20to\x20send\x20MasterCard\x20webhook:','\x20status\x20timers\x20for\x20payment\x20','Number\x20of\x20attempts\x20exceeded','errorMessage','loggerService','key','üîê\x20MasterCard\x20Public\x20key\x20path:','üîç\x20Using\x20','\x20(from:\x20order_id=','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','HTTP\x20error!\x20status:\x20','üì¶\x20FULL\x20RESPONSE\x20BODY:','trim','__esModule','Sender\x27s\x20card\x20details\x20are\x20required','createCipheriv','prototype','üîê\x20MasterCard\x20Private\x20key\x20path:','Payment\x20cancellation\x20is\x20being\x20processed','üí≥\x20VISA/MasterCard\x20service\x20initialized','\x20not\x20enabled\x20for\x20shop\x20','validateKeyFiles','failureMessage','\x20status\x20check\x20#','customerName','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','payment.success','üîê\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','Card\x20Number:','message','final','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','Payment\x20prohibited','‚ö†Ô∏è\x20Expected\x20VISA\x20private\x20key:\x20','stringify','Captcha\x20confirmation\x20awaited','üì§\x20Sending\x20request\x20to\x20API...','toUpperCase',',\x20body:\x20','payment.failed','sendPaymentNotifications','üîê\x20RSA\x20signing\x20successful','Unknown\x20error','\x20\x20\x20Amount:\x20','unknown','logWhiteDomainResponse','writable','sendShopWebhook','‚ùå\x20PHP\x20decryptor\x20request\x20failed:','Card\x20Holder:','Failed\x20to\x20send\x20payment\x20notifications:','3DS\x20verification\x20required','-----BEGIN'];a57_0xe036=function(){return _0x21e3ac;};return a57_0xe036();}const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a57_0x3eab0a(0x130));class VisaMasterCardService{constructor(){const _0xaf0171=a57_0x3eab0a;this[_0xaf0171(0x1fc)]=new Map(),this[_0xaf0171(0x150)]={0x0:{'final':![],'description':'No\x20New\x20payment'},0x1:{'final':![],'description':_0xaf0171(0x115)},0x2:{'final':!![],'description':_0xaf0171(0x23a)},0x3:{'final':!![],'description':_0xaf0171(0x19e)},0x4:{'final':!![],'description':'Unsuccessful\x20payment'},0x5:{'final':!![],'description':_0xaf0171(0x1c2)},0x6:{'final':!![],'description':'Payment\x20returned'},0x7:{'final':!![],'description':_0xaf0171(0x219)},0x8:{'final':![],'description':_0xaf0171(0x15f)},0x9:{'final':![],'description':_0xaf0171(0x1dc)},0xa:{'final':![],'description':'Sender\x27s\x20CVV\x20card\x20is\x20required'},0xb:{'final':![],'description':_0xaf0171(0x117)},0xc:{'final':![],'description':'Recipient\x20data\x20required'},0xd:{'final':![],'description':_0xaf0171(0x121)},0xe:{'final':![],'description':'Awaiting\x20confirmation\x20by\x20ivr\x20call'},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':_0xaf0171(0x1cc)},0x11:{'final':![],'description':_0xaf0171(0x1a7)},0x12:{'final':![],'description':_0xaf0171(0x208)},0x13:{'final':![],'description':_0xaf0171(0x134)},0x14:{'final':![],'description':_0xaf0171(0x177)},0x15:{'final':![],'description':_0xaf0171(0x19d)},0x16:{'final':![],'description':'Payment\x20pending\x20verification'},0x18:{'final':![],'description':_0xaf0171(0x16d)},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':'Cash\x20payment\x20is\x20expected\x20at\x20TCO'},0x1b:{'final':![],'description':_0xaf0171(0x25d)},0x1c:{'final':![],'description':_0xaf0171(0x137)},0x1d:{'final':![],'description':_0xaf0171(0x18d)},0x1f:{'final':![],'description':_0xaf0171(0x1ef)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':_0xaf0171(0x1b7)},0x24:{'final':!![],'description':'Payment\x20confirmation\x20time\x20has\x20expired'},0x25:{'final':!![],'description':_0xaf0171(0x1c9)},0x26:{'final':!![],'description':_0xaf0171(0x232)},0x27:{'final':!![],'description':'Insufficient\x20funds\x20on\x20the\x20card'},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':_0xaf0171(0x17d)},0x2a:{'final':!![],'description':_0xaf0171(0x13a)},0x2b:{'final':!![],'description':_0xaf0171(0x180)},0x2c:{'final':!![],'description':_0xaf0171(0x18a)},0x2d:{'final':!![],'description':_0xaf0171(0x237)},0x2e:{'final':!![],'description':_0xaf0171(0x11e)},0x2f:{'final':!![],'description':'Unsuccessful\x20payment'},0x30:{'final':!![],'description':'Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled'},0x31:{'final':![],'description':_0xaf0171(0x217)},0x32:{'final':!![],'description':_0xaf0171(0x221)},0x33:{'final':!![],'description':_0xaf0171(0x237)},0x34:{'final':!![],'description':_0xaf0171(0x237)},0x35:{'final':!![],'description':_0xaf0171(0x237)},0x36:{'final':!![],'description':'Failed\x20payment'},0x37:{'final':!![],'description':_0xaf0171(0x237)},0x38:{'final':!![],'description':_0xaf0171(0x23c)},0x39:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank'},0x3a:{'final':![],'description':_0xaf0171(0x264)},0x3b:{'final':!![],'description':_0xaf0171(0x170)},0x3c:{'final':!![],'description':_0xaf0171(0x1ab)},0x3d:{'final':!![],'description':'Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible'},0x3e:{'final':!![],'description':_0xaf0171(0x148)},0x3f:{'final':!![],'description':_0xaf0171(0x12f)},0x40:{'final':![],'description':_0xaf0171(0x187)},0x41:{'final':!![],'description':'LookUp\x20number\x20of\x20attempts\x20exceeded'},0x42:{'final':![],'description':_0xaf0171(0x1bb)},0x43:{'final':!![],'description':_0xaf0171(0x1c8)},0x44:{'final':![],'description':'3DS\x20verification\x20required'},0x45:{'final':!![],'description':'Failed\x20payment'},0x46:{'final':!![],'description':'Failed\x20payment'},0x47:{'final':!![],'description':_0xaf0171(0x24e)},0x64:{'final':!![],'description':'Operation\x20completed\x20successfully'}},this[_0xaf0171(0x15b)]='https://api.myatranz.com/api',this[_0xaf0171(0x17b)]=0x50ca,this[_0xaf0171(0x13f)]=path_1[_0xaf0171(0x1e1)][_0xaf0171(0x20f)](process[_0xaf0171(0x1f4)](),_0xaf0171(0x140),'private.pem'),this[_0xaf0171(0x213)]=path_1[_0xaf0171(0x1e1)][_0xaf0171(0x20f)](process[_0xaf0171(0x1f4)](),'keys',_0xaf0171(0x1a0)),this[_0xaf0171(0x169)]='https://api.paydmeth.com/api',this[_0xaf0171(0x18b)]=0x6b7,this[_0xaf0171(0x163)]=path_1[_0xaf0171(0x1e1)][_0xaf0171(0x20f)](process[_0xaf0171(0x1f4)](),_0xaf0171(0x140),_0xaf0171(0x18f)),this[_0xaf0171(0x1fa)]=path_1['default'][_0xaf0171(0x20f)](process[_0xaf0171(0x1f4)](),'keys','visa_public.pem'),console[_0xaf0171(0x151)](_0xaf0171(0x1bc)),console['log']('üîê\x20MasterCard\x20API\x20URL:',this['masterCardApiUrl']),console[_0xaf0171(0x151)](_0xaf0171(0x15d),this['visaApiUrl']),console[_0xaf0171(0x151)](_0xaf0171(0x1ba),this[_0xaf0171(0x13f)]),console[_0xaf0171(0x151)](_0xaf0171(0x1af),this['publicKeyPath']),console[_0xaf0171(0x151)](_0xaf0171(0x201),this[_0xaf0171(0x163)]),console[_0xaf0171(0x151)]('üîê\x20VISA\x20Public\x20key\x20path:',this['visaPublicKeyPath']),this[_0xaf0171(0x1be)]();}['getDetailedErrorMessage'](_0x4a1ce3,_0xf282f7){const _0x51bc0f=a57_0x3eab0a,_0x11255c=this[_0x51bc0f(0x150)][_0x4a1ce3];let _0xc9a20e='';_0x11255c?_0xc9a20e='Status\x20'+_0x4a1ce3+':\x20'+_0x11255c['description']:_0xc9a20e='Status\x20'+_0x4a1ce3+_0x51bc0f(0x167);if(_0xf282f7&&_0xf282f7[_0x51bc0f(0x1b5)]()){const _0xae0ecb=_0xf282f7[_0x51bc0f(0x1b5)]();(!_0x11255c||_0xae0ecb[_0x51bc0f(0x179)]()!==_0x11255c[_0x51bc0f(0x17e)]['toLowerCase']())&&(_0xc9a20e+='\x20|\x20Response:\x20'+_0xae0ecb);}return _0xc9a20e;}[a57_0x3eab0a(0x254)](_0x5cceff){const _0x26a0d3=a57_0x3eab0a,_0x5ad090=this[_0x26a0d3(0x150)][_0x5cceff];return _0x5ad090?_0x5ad090['final']:!![];}[a57_0x3eab0a(0x143)](_0x54406b){const _0x8e3512=a57_0x3eab0a,_0x1d3c4b=_0x54406b[_0x8e3512(0x235)](0x0);if(_0x1d3c4b==='4')return console[_0x8e3512(0x151)](_0x8e3512(0x1a4)),{'cardType':'VISA','apiUrl':this[_0x8e3512(0x169)],'privateKeyPath':this[_0x8e3512(0x163)],'publicKeyPath':this['visaPublicKeyPath'],'merchantPointId':this['visaMerchantPointId']};else return _0x1d3c4b==='5'?(console[_0x8e3512(0x151)](_0x8e3512(0x174)),{'cardType':_0x8e3512(0x118),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x8e3512(0x17b)]}):(console[_0x8e3512(0x151)]('üí≥\x20Unknown\x20card\x20type\x20(starts\x20with\x20'+_0x1d3c4b+_0x8e3512(0x112)),{'cardType':_0x8e3512(0x118),'apiUrl':this[_0x8e3512(0x15b)],'privateKeyPath':this[_0x8e3512(0x13f)],'publicKeyPath':this[_0x8e3512(0x213)],'merchantPointId':this[_0x8e3512(0x17b)]});}['validateKeyFiles'](){const _0x48e2aa=a57_0x3eab0a;try{if(!fs_1[_0x48e2aa(0x1e1)][_0x48e2aa(0x1e5)](this['privateKeyPath']))throw new Error(_0x48e2aa(0x144)+this[_0x48e2aa(0x13f)]);if(!fs_1['default'][_0x48e2aa(0x1e5)](this[_0x48e2aa(0x213)]))throw new Error(_0x48e2aa(0x1f0)+this['publicKeyPath']);const _0x16d366=fs_1[_0x48e2aa(0x1e1)][_0x48e2aa(0x178)](this['privateKeyPath'],_0x48e2aa(0x10e))[_0x48e2aa(0x1b5)](),_0x2a542a=fs_1[_0x48e2aa(0x1e1)]['readFileSync'](this['publicKeyPath'],'utf8')[_0x48e2aa(0x1b5)]();if(!_0x16d366[_0x48e2aa(0x1a2)](_0x48e2aa(0x1dd))||!_0x16d366[_0x48e2aa(0x1a2)]('-----END'))throw new Error(_0x48e2aa(0x1b2));if(!_0x2a542a[_0x48e2aa(0x1a2)](_0x48e2aa(0x1dd))||!_0x2a542a[_0x48e2aa(0x1a2)]('-----END'))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x48e2aa(0x151)](_0x48e2aa(0x20e)),console[_0x48e2aa(0x151)]('üîê\x20MasterCard\x20Private\x20key\x20length:\x20'+_0x16d366[_0x48e2aa(0x1f5)]+_0x48e2aa(0x14a)),console['log']('üîê\x20MasterCard\x20Public\x20key\x20length:\x20'+_0x2a542a[_0x48e2aa(0x1f5)]+'\x20characters');if(fs_1['default'][_0x48e2aa(0x1e5)](this[_0x48e2aa(0x163)])&&fs_1['default'][_0x48e2aa(0x1e5)](this[_0x48e2aa(0x1fa)])){const _0xe848ab=fs_1[_0x48e2aa(0x1e1)][_0x48e2aa(0x178)](this[_0x48e2aa(0x163)],'utf8')[_0x48e2aa(0x1b5)](),_0x53f114=fs_1[_0x48e2aa(0x1e1)][_0x48e2aa(0x178)](this[_0x48e2aa(0x1fa)],'utf8')[_0x48e2aa(0x1b5)]();(!_0xe848ab[_0x48e2aa(0x1a2)](_0x48e2aa(0x1dd))||!_0xe848ab[_0x48e2aa(0x1a2)](_0x48e2aa(0x25a)))&&console[_0x48e2aa(0x21a)](_0x48e2aa(0x257)),(!_0x53f114[_0x48e2aa(0x1a2)](_0x48e2aa(0x1dd))||!_0x53f114['includes'](_0x48e2aa(0x25a)))&&console[_0x48e2aa(0x21a)]('‚ö†Ô∏è\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),console[_0x48e2aa(0x151)]('‚úÖ\x20VISA\x20key\x20files\x20validated\x20successfully'),console[_0x48e2aa(0x151)](_0x48e2aa(0x141)+_0xe848ab['length']+_0x48e2aa(0x14a)),console[_0x48e2aa(0x151)](_0x48e2aa(0x207)+_0x53f114[_0x48e2aa(0x1f5)]+'\x20characters');}else console[_0x48e2aa(0x21a)](_0x48e2aa(0x152)),console[_0x48e2aa(0x21a)](_0x48e2aa(0x1ca)+this[_0x48e2aa(0x163)]),console[_0x48e2aa(0x21a)](_0x48e2aa(0x186)+this[_0x48e2aa(0x1fa)]);}catch(_0x51c9a2){console[_0x48e2aa(0x24c)](_0x48e2aa(0x255),_0x51c9a2);throw _0x51c9a2;}}['generateAESKey'](){const _0xb7181b=a57_0x3eab0a,_0x2e6ca2=crypto_1[_0xb7181b(0x1e1)]['randomBytes'](0x20),_0x33f9fc=crypto_1[_0xb7181b(0x1e1)][_0xb7181b(0x17a)](0x10);return{'key':_0x2e6ca2,'iv':_0x33f9fc};}[a57_0x3eab0a(0x226)](_0x26b4c2,_0x299389,_0x223e37){const _0x2deedd=a57_0x3eab0a,_0x43808f=crypto_1['default'][_0x2deedd(0x1b8)](_0x2deedd(0x1fe),_0x299389,_0x223e37);let _0x1d46dc=_0x43808f[_0x2deedd(0x211)](_0x26b4c2,'utf8',_0x2deedd(0x1f8));return _0x1d46dc+=_0x43808f[_0x2deedd(0x1c7)](_0x2deedd(0x1f8)),_0x1d46dc;}[a57_0x3eab0a(0x263)](_0x4548f8,_0x10ed7d,_0x1fcfef){const _0x4e4f84=a57_0x3eab0a;try{const _0x10981b=fs_1[_0x4e4f84(0x1e1)][_0x4e4f84(0x178)](_0x1fcfef,_0x4e4f84(0x10e))[_0x4e4f84(0x1b5)](),_0x38a322={'iv':_0x10ed7d[_0x4e4f84(0x168)](_0x4e4f84(0x1f8)),'key':_0x4548f8[_0x4e4f84(0x168)](_0x4e4f84(0x1f8))},_0x25ce50=JSON[_0x4e4f84(0x1cb)](_0x38a322);console['log'](_0x4e4f84(0x1c4),_0x25ce50['length']);const _0x4d5ba1=crypto_1[_0x4e4f84(0x1e1)]['publicEncrypt']({'key':_0x10981b,'padding':crypto_1[_0x4e4f84(0x1e1)]['constants'][_0x4e4f84(0x153)]},Buffer[_0x4e4f84(0x247)](_0x25ce50));return console[_0x4e4f84(0x151)](_0x4e4f84(0x23d),_0x4d5ba1['length']),_0x4d5ba1[_0x4e4f84(0x168)](_0x4e4f84(0x1f8));}catch(_0x59ac80){console['error'](_0x4e4f84(0x159),_0x59ac80);throw new Error(_0x4e4f84(0x20d));}}[a57_0x3eab0a(0x228)](_0x16a78e,_0x7cf9c3){const _0x3e7c68=a57_0x3eab0a;try{const _0x17545d=fs_1[_0x3e7c68(0x1e1)][_0x3e7c68(0x178)](_0x7cf9c3,_0x3e7c68(0x10e))[_0x3e7c68(0x1b5)](),_0x3c7233=crypto_1[_0x3e7c68(0x1e1)][_0x3e7c68(0x15c)](_0x3e7c68(0x10f));_0x3c7233[_0x3e7c68(0x211)](_0x16a78e),_0x3c7233['end']();const _0x2f46b1=_0x3c7233['sign'](_0x17545d,_0x3e7c68(0x1f8));return console[_0x3e7c68(0x151)](_0x3e7c68(0x1d2)),console[_0x3e7c68(0x151)]('üìù\x20Data\x20to\x20sign\x20length:',_0x16a78e[_0x3e7c68(0x1f5)]),console['log'](_0x3e7c68(0x11a),_0x2f46b1[_0x3e7c68(0x1f5)]),_0x2f46b1;}catch(_0x5c37ed){console[_0x3e7c68(0x24c)](_0x3e7c68(0x236),_0x5c37ed),console[_0x3e7c68(0x24c)](_0x3e7c68(0x1e8),_0x16a78e[_0x3e7c68(0x240)](0x0,0xc8)+_0x3e7c68(0x227));throw new Error(_0x3e7c68(0x129));}}[a57_0x3eab0a(0x195)](_0x297825,_0x594f84,_0x4e0b88){const _0xcf9307=a57_0x3eab0a,_0x205735=crypto_1['default'][_0xcf9307(0x258)](_0xcf9307(0x1fe),_0x594f84,_0x4e0b88);let _0x2b6cca=_0x205735[_0xcf9307(0x211)](_0x297825,_0xcf9307(0x1f8),'utf8');return _0x2b6cca+=_0x205735[_0xcf9307(0x1c7)]('utf8'),_0x2b6cca;}async['decryptResponsePhp'](_0x294760,_0x3319a4,_0xe5069f='MASTERCARD'){const _0x5eb2de=a57_0x3eab0a;try{const _0x39cd80=await fetch(_0x5eb2de(0x1ed),{'method':_0x5eb2de(0x146),'headers':{'Content-Type':'application/json'},'body':JSON[_0x5eb2de(0x1cb)]({'info':_0x294760,'key':_0x3319a4,'card_type':_0xe5069f[_0x5eb2de(0x179)]()})});if(!_0x39cd80['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x39cd80[_0x5eb2de(0x127)]();}catch(_0x5e1be7){console[_0x5eb2de(0x24c)](_0x5eb2de(0x1d9),_0x5e1be7);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a57_0x3eab0a(0x119)](_0x51f349,_0x196604){const _0x122276=a57_0x3eab0a;try{const _0x72e014=fs_1[_0x122276(0x1e1)][_0x122276(0x178)](this[_0x122276(0x13f)],'utf8')['trim'](),_0x2071a5=crypto_1[_0x122276(0x1e1)]['privateDecrypt'](_0x72e014,Buffer[_0x122276(0x247)](_0x196604,_0x122276(0x1f8))),_0x5a0033=JSON['parse'](_0x2071a5['toString']()),_0x375a0d=Buffer[_0x122276(0x247)](_0x5a0033[_0x122276(0x1ae)],_0x122276(0x1f8)),_0x59dfb6=Buffer[_0x122276(0x247)](_0x5a0033['iv'],'base64');return this[_0x122276(0x195)](_0x51f349,_0x375a0d,_0x59dfb6);}catch(_0xa748e){throw new Error(_0x122276(0x234));}}async[a57_0x3eab0a(0x11f)](_0x53a16c){const _0x58a0f1=a57_0x3eab0a,{paymentId:_0x5e6e85,orderId:_0x345851,amount:_0x2ea618,currency:_0x1c1fbd,cardData:_0x29c038,resultUrl:_0x5c6173,returnUrl:_0x13df01,cardHolder:_0xa8548,browser:_0x45e3f1}=_0x53a16c;console[_0x58a0f1(0x151)]('===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x58a0f1(0x151)](_0x58a0f1(0x1eb),_0x5e6e85),console['log'](_0x58a0f1(0x16f),_0x345851),console[_0x58a0f1(0x151)](_0x58a0f1(0x132),_0x2ea618,_0x1c1fbd),console[_0x58a0f1(0x151)](_0x58a0f1(0x1c5),this['maskCardNumber'](_0x29c038['number'])),console[_0x58a0f1(0x151)](_0x58a0f1(0x1da),_0xa8548[_0x58a0f1(0x22f)]+'\x20'+_0xa8548[_0x58a0f1(0x216)]),console['log']('Return\x20URL:',_0x13df01),console[_0x58a0f1(0x151)]('Result\x20URL:',_0x5c6173);const _0x359112=this[_0x58a0f1(0x143)](_0x29c038[_0x58a0f1(0x13e)]);console[_0x58a0f1(0x151)](_0x58a0f1(0x203)+_0x359112[_0x58a0f1(0x122)]+_0x58a0f1(0x12d)+_0x359112['apiUrl']),console['log']('üîê\x20Using\x20keys:\x20'+_0x359112[_0x58a0f1(0x13f)]+',\x20'+_0x359112[_0x58a0f1(0x213)]);const _0x93518b={..._0xa8548,'first_name':_0xa8548['first_name']?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x58a0f1(0x1b5)]()||'','last_name':_0xa8548[_0x58a0f1(0x216)]?.[_0x58a0f1(0x16e)](/[\t\n\r\f\v]/g,'\x20')['trim']()||''};'postcode'in _0x93518b&&!(_0x58a0f1(0x160)in _0x93518b)&&(_0x93518b[_0x58a0f1(0x160)]=_0x93518b[_0x58a0f1(0x205)],delete _0x93518b[_0x58a0f1(0x205)],console[_0x58a0f1(0x151)](_0x58a0f1(0x238)+_0x93518b[_0x58a0f1(0x160)]));console[_0x58a0f1(0x151)](_0x58a0f1(0x1fb)),console[_0x58a0f1(0x151)](_0x58a0f1(0x1e6)+_0xa8548['first_name']+'\x22\x20|\x20\x22'+_0xa8548[_0x58a0f1(0x216)]+'\x22'),console[_0x58a0f1(0x151)](_0x58a0f1(0x14c)+_0x93518b[_0x58a0f1(0x22f)]+'\x22\x20|\x20\x22'+_0x93518b[_0x58a0f1(0x216)]+'\x22'),console['log']('üìç\x20Full\x20card\x20holder\x20data:',JSON[_0x58a0f1(0x1cb)](_0x93518b,null,0x2));const _0x1f4596={'amount':_0x2ea618,'currency':_0x1c1fbd['toUpperCase'](),'order_id':_0x345851,'result_url':_0x5c6173,'return_url':_0x13df01,'country':'','card':{'number':_0x29c038[_0x58a0f1(0x13e)],'expire_month':_0x29c038[_0x58a0f1(0x14d)],'expire_year':_0x29c038['expire_year'],'cvv':_0x29c038[_0x58a0f1(0x175)]},'card_holder':_0x93518b,'browser':_0x45e3f1},_0x39e649=JSON['stringify'](_0x1f4596);console['log'](_0x58a0f1(0x193)),console[_0x58a0f1(0x151)](_0x58a0f1(0x206)),console[_0x58a0f1(0x151)](_0x39e649),console[_0x58a0f1(0x151)](_0x58a0f1(0x185),_0x39e649[_0x58a0f1(0x1f5)]);try{const {key:_0x1b4ced,iv:_0x1d7b60}=this['generateAESKey']();console['log']('üîê\x20AES\x20key\x20and\x20IV\x20generated'),console[_0x58a0f1(0x151)](_0x58a0f1(0x11d),_0x1b4ced['length']),console['log'](_0x58a0f1(0x260),_0x1d7b60['length']);const _0x5a576=this[_0x58a0f1(0x226)](_0x39e649,_0x1b4ced,_0x1d7b60);console[_0x58a0f1(0x151)]('üîê\x20Data\x20encrypted\x20with\x20AES'),console[_0x58a0f1(0x151)]('üìù\x20Encrypted\x20data\x20length:',_0x5a576[_0x58a0f1(0x1f5)]);const _0x3934de=this[_0x58a0f1(0x263)](_0x1b4ced,_0x1d7b60,_0x359112['publicKeyPath']);console[_0x58a0f1(0x151)]('üîê\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x58a0f1(0x151)](_0x58a0f1(0x230),_0x3934de[_0x58a0f1(0x1f5)]);const _0x52fc46=this['signRSA'](_0x39e649,_0x359112[_0x58a0f1(0x13f)]);console[_0x58a0f1(0x151)](_0x58a0f1(0x14b)),console[_0x58a0f1(0x151)]('üìù\x20Signature\x20length:',_0x52fc46[_0x58a0f1(0x1f5)]);const _0x17e6ef={'merchant_point_id':_0x359112[_0x58a0f1(0x158)],'method':_0x58a0f1(0x1ea),'info':_0x5a576,'key':_0x3934de,'sign':_0x52fc46,'lang':'en'};console[_0x58a0f1(0x151)](_0x58a0f1(0x1cd)),console[_0x58a0f1(0x151)]('üìù\x20Final\x20request\x20structure:'),console[_0x58a0f1(0x151)](_0x58a0f1(0x18e),_0x359112['merchantPointId']),console[_0x58a0f1(0x151)](_0x58a0f1(0x131)),console[_0x58a0f1(0x151)]('\x20\x20\x20-\x20info\x20length:',_0x5a576[_0x58a0f1(0x1f5)]),console[_0x58a0f1(0x151)]('\x20\x20\x20-\x20key\x20length:',_0x3934de['length']),console[_0x58a0f1(0x151)](_0x58a0f1(0x21b),_0x52fc46[_0x58a0f1(0x1f5)]),console['log']('\x20\x20\x20-\x20lang:\x20en'),console[_0x58a0f1(0x151)](''),console[_0x58a0f1(0x151)](_0x58a0f1(0x126)),console[_0x58a0f1(0x151)](JSON[_0x58a0f1(0x1cb)](_0x17e6ef,null,0x2)),console[_0x58a0f1(0x151)](''),loggerService_1['loggerService'][_0x58a0f1(0x11c)](_0x359112[_0x58a0f1(0x122)]['toLowerCase'](),_0x58a0f1(0x13c),_0x58a0f1(0x146),{'merchant_point_id':_0x359112[_0x58a0f1(0x158)],'method':'charge','lang':'en'});const _0xa97a24=Date[_0x58a0f1(0x1ee)](),_0x3ec771=await fetch(_0x359112['apiUrl'],{'method':_0x58a0f1(0x146),'headers':{'Content-Type':_0x58a0f1(0x12c),'Accept':_0x58a0f1(0x12c),'User-Agent':_0x58a0f1(0x165)},'body':JSON['stringify'](_0x17e6ef)}),_0x2bf2a4=Date['now']()-_0xa97a24;console[_0x58a0f1(0x151)]('===\x20API\x20RESPONSE\x20==='),console['log'](_0x58a0f1(0x200),_0x3ec771[_0x58a0f1(0x155)]),console[_0x58a0f1(0x151)]('Status\x20Text:',_0x3ec771[_0x58a0f1(0x21e)]),console[_0x58a0f1(0x151)](_0x58a0f1(0x114),_0x2bf2a4+'ms'),console['log'](_0x58a0f1(0x142)),_0x3ec771['headers'][_0x58a0f1(0x113)]((_0x2b2c2a,_0x35df4b)=>{const _0x29670a=_0x58a0f1;console[_0x29670a(0x151)](_0x29670a(0x15a)+_0x35df4b+':\x20'+_0x2b2c2a);}),console[_0x58a0f1(0x151)]('');if(!_0x3ec771['ok']){const _0xb97f6f=await _0x3ec771[_0x58a0f1(0x127)]();console[_0x58a0f1(0x24c)]('HTTP\x20Status:',_0x3ec771['status']),console[_0x58a0f1(0x24c)](_0x58a0f1(0x1b4)),console[_0x58a0f1(0x24c)](_0xb97f6f),console['error'](''),loggerService_1[_0x58a0f1(0x1ad)][_0x58a0f1(0x1d6)](_0x359112[_0x58a0f1(0x122)]['toLowerCase'](),_0x58a0f1(0x171),_0x3ec771[_0x58a0f1(0x155)],_0xb97f6f,_0x2bf2a4),loggerService_1[_0x58a0f1(0x1ad)][_0x58a0f1(0x15e)](_0x359112[_0x58a0f1(0x122)]['toLowerCase'](),_0x58a0f1(0x13c),_0x58a0f1(0x164)+_0x3ec771[_0x58a0f1(0x155)]+':\x20'+_0xb97f6f);throw new Error(_0x58a0f1(0x1b3)+_0x3ec771[_0x58a0f1(0x155)]+_0x58a0f1(0x1cf)+_0xb97f6f);}const _0x395500=await _0x3ec771[_0x58a0f1(0x192)]();console[_0x58a0f1(0x151)](_0x58a0f1(0x12b)),console[_0x58a0f1(0x151)](JSON[_0x58a0f1(0x1cb)](_0x395500,null,0x2)),console[_0x58a0f1(0x151)](''),loggerService_1[_0x58a0f1(0x1ad)][_0x58a0f1(0x1d6)](_0x359112[_0x58a0f1(0x122)]['toLowerCase'](),_0x58a0f1(0x171),_0x3ec771[_0x58a0f1(0x155)],_0x395500,_0x2bf2a4),console[_0x58a0f1(0x151)](_0x58a0f1(0x210));let _0x13b1f4=_0x395500;if(_0x395500[_0x58a0f1(0x1e9)]&&_0x395500[_0x58a0f1(0x1ae)]&&_0x395500[_0x58a0f1(0x1f2)]){console[_0x58a0f1(0x151)](_0x58a0f1(0x1e0));try{const _0x2ad725=await this[_0x58a0f1(0x223)](_0x395500[_0x58a0f1(0x1e9)],_0x395500[_0x58a0f1(0x1ae)],_0x359112['cardType']);_0x13b1f4=JSON[_0x58a0f1(0x245)](_0x2ad725),console[_0x58a0f1(0x151)](_0x58a0f1(0x128)),loggerService_1['loggerService'][_0x58a0f1(0x1d6)](_0x359112[_0x58a0f1(0x122)]['toLowerCase'](),'/charge_decrypted',_0x3ec771[_0x58a0f1(0x155)],_0x13b1f4,_0x2bf2a4),console[_0x58a0f1(0x151)](_0x58a0f1(0x166));}catch(_0x39d672){console[_0x58a0f1(0x24c)](_0x58a0f1(0x233),_0x39d672),loggerService_1['loggerService'][_0x58a0f1(0x15e)](_0x359112['cardType'][_0x58a0f1(0x179)](),_0x58a0f1(0x1a5),'Decryption\x20failed:\x20'+_0x39d672),_0x13b1f4=_0x395500;}}else loggerService_1['loggerService'][_0x58a0f1(0x1d6)](_0x359112['cardType'][_0x58a0f1(0x179)](),_0x58a0f1(0x11b),_0x3ec771[_0x58a0f1(0x155)],_0x13b1f4,_0x2bf2a4),console[_0x58a0f1(0x151)](_0x58a0f1(0x17f));console[_0x58a0f1(0x151)](_0x58a0f1(0x200),_0x13b1f4[_0x58a0f1(0x155)]),console[_0x58a0f1(0x151)](_0x58a0f1(0x110),_0x13b1f4[_0x58a0f1(0x1c7)]),console[_0x58a0f1(0x151)](_0x58a0f1(0x1eb),_0x13b1f4[_0x58a0f1(0x183)]),console[_0x58a0f1(0x151)](_0x58a0f1(0x198),_0x13b1f4[_0x58a0f1(0x1fd)]||'none');if(_0x13b1f4[_0x58a0f1(0x155)]===0x64&&_0x13b1f4[_0x58a0f1(0x1c7)]===0x1)return console[_0x58a0f1(0x151)](_0x58a0f1(0x250)),{'gateway_payment_id':_0x13b1f4[_0x58a0f1(0x183)]?.[_0x58a0f1(0x168)](),'payment_url':_0x13df01,'requires_3ds':![],'status':_0x58a0f1(0x161),'final':!![]};if(_0x13b1f4[_0x58a0f1(0x1fd)])return console[_0x58a0f1(0x151)](_0x58a0f1(0x156)),this[_0x58a0f1(0x1e4)](_0x5e6e85,_0x345851,_0x13b1f4['payment_id']?.['toString']()||_0x345851,_0x359112['cardType']),{'gateway_payment_id':_0x13b1f4['payment_id']?.[_0x58a0f1(0x168)](),'payment_url':_0x13b1f4['3ds_url'],'requires_3ds':!![],'threeds_url':_0x13b1f4[_0x58a0f1(0x1fd)],'status':_0x58a0f1(0x17c),'final':![]};let _0x475544=this[_0x58a0f1(0x23e)](_0x13b1f4[_0x58a0f1(0x155)],_0x13b1f4[_0x58a0f1(0x22c)]||_0x13b1f4['message']),_0x27f48f=_0x13b1f4['status'],_0x7d7497=this[_0x58a0f1(0x254)](_0x13b1f4['status']);return console['log'](_0x58a0f1(0x1de)+_0x27f48f+_0x58a0f1(0x24f)+_0x7d7497+',\x20Desc:\x20'+_0x475544),{'gateway_payment_id':_0x13b1f4['payment_id']?.[_0x58a0f1(0x168)](),'payment_url':_0x13df01,'requires_3ds':![],'status':_0x58a0f1(0x124),'final':!![],'errorMessage':_0x475544};}catch(_0x542281){console['error'](_0x58a0f1(0x212)),console[_0x58a0f1(0x24c)]('Error\x20details:',_0x542281),loggerService_1[_0x58a0f1(0x1ad)][_0x58a0f1(0x15e)]('visa/mastercard','/charge',_0x542281);throw new Error(_0x58a0f1(0x25b)+(_0x542281 instanceof Error?_0x542281[_0x58a0f1(0x1c6)]:_0x58a0f1(0x1d3)));}}async[a57_0x3eab0a(0x147)](_0x384756,_0x232b1d,_0x3f2320=a57_0x3eab0a(0x133)){const _0x5ea700=a57_0x3eab0a;console['log'](_0x5ea700(0x13d)+_0x3f2320+'\x20payment\x20status:\x20'+_0x384756+'\x20('+_0x232b1d+')');try{const _0xf7a7ce={'payment_id':_0x384756,'order_id':_0x232b1d},_0xeba289=JSON[_0x5ea700(0x1cb)](_0xf7a7ce),_0x580d21=this[_0x5ea700(0x143)](_0x3f2320===_0x5ea700(0x133)?_0x5ea700(0x239):_0x5ea700(0x1df)),{key:_0x486318,iv:_0x922eea}=this[_0x5ea700(0x21f)](),_0xfbb1d6=this[_0x5ea700(0x226)](_0xeba289,_0x486318,_0x922eea),_0x5d556e=this[_0x5ea700(0x263)](_0x486318,_0x922eea,_0x580d21[_0x5ea700(0x213)]),_0xca6305=this['signRSA'](_0xeba289,_0x580d21['privateKeyPath']),_0x49dd07={'merchant_point_id':_0x580d21[_0x5ea700(0x158)],'method':_0x5ea700(0x155),'info':_0xfbb1d6,'key':_0x5d556e,'sign':_0xca6305,'lang':'en'};loggerService_1['loggerService'][_0x5ea700(0x11c)](_0x3f2320[_0x5ea700(0x179)](),_0x5ea700(0x261),_0x5ea700(0x146),{'merchant_point_id':_0x580d21[_0x5ea700(0x158)],'method':_0x5ea700(0x155),'lang':'en'});const _0x2a5741=Date[_0x5ea700(0x1ee)](),_0x25875d=await fetch(_0x580d21[_0x5ea700(0x249)],{'method':_0x5ea700(0x146),'headers':{'Content-Type':_0x5ea700(0x12c),'Accept':'application/json','User-Agent':_0x5ea700(0x165)},'body':JSON[_0x5ea700(0x1cb)](_0x49dd07)}),_0x2006f5=Date[_0x5ea700(0x1ee)]()-_0x2a5741;if(!_0x25875d['ok']){const _0x53059e=await _0x25875d['text']();loggerService_1[_0x5ea700(0x1ad)][_0x5ea700(0x1d6)](_0x3f2320[_0x5ea700(0x179)](),_0x5ea700(0x252),_0x25875d[_0x5ea700(0x155)],_0x53059e,_0x2006f5);throw new Error(_0x5ea700(0x1b3)+_0x25875d['status']);}const _0x487531=await _0x25875d['json']();loggerService_1[_0x5ea700(0x1ad)][_0x5ea700(0x1d6)](_0x3f2320[_0x5ea700(0x179)](),'/status_raw',_0x25875d['status'],_0x487531,_0x2006f5);let _0x471ca6=_0x487531;if(_0x487531[_0x5ea700(0x1e9)]&&_0x487531[_0x5ea700(0x1ae)]&&_0x487531[_0x5ea700(0x1f2)]){console[_0x5ea700(0x151)](_0x5ea700(0x154));try{const _0x1dcf6c=await this['decryptResponsePhp'](_0x487531[_0x5ea700(0x1e9)],_0x487531[_0x5ea700(0x1ae)],_0x3f2320);_0x471ca6=JSON[_0x5ea700(0x245)](_0x1dcf6c),console[_0x5ea700(0x151)]('‚úÖ\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x5ea700(0x1ad)][_0x5ea700(0x1d6)](_0x3f2320[_0x5ea700(0x179)](),_0x5ea700(0x196),_0x25875d[_0x5ea700(0x155)],_0x471ca6,_0x2006f5),console[_0x5ea700(0x151)]('üìù\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x217404){console[_0x5ea700(0x24c)](_0x5ea700(0x224),_0x217404),loggerService_1['loggerService'][_0x5ea700(0x15e)](_0x3f2320[_0x5ea700(0x179)](),_0x5ea700(0x242),'Status\x20decryption\x20failed:\x20'+_0x217404),_0x471ca6=_0x487531;}}else loggerService_1[_0x5ea700(0x1ad)][_0x5ea700(0x1d6)](_0x3f2320[_0x5ea700(0x179)](),'/status_decrypted',_0x25875d[_0x5ea700(0x155)],_0x471ca6,_0x2006f5),console[_0x5ea700(0x151)]('üìù\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console['log']('üìä\x20Status\x20check\x20result:',{'status':_0x471ca6[_0x5ea700(0x155)],'final':_0x471ca6['final'],'payment_id':_0x471ca6[_0x5ea700(0x183)],'desc':_0x471ca6[_0x5ea700(0x22c)]});let _0x3d2f61=_0x5ea700(0x17c);if(_0x471ca6['status']===0x64&&_0x471ca6[_0x5ea700(0x1c7)]===0x1)_0x3d2f61=_0x5ea700(0x161);else{if(_0x471ca6[_0x5ea700(0x1c7)]===0x0||!this[_0x5ea700(0x254)](_0x471ca6[_0x5ea700(0x155)]))_0x3d2f61=_0x5ea700(0x17c);else _0x471ca6[_0x5ea700(0x1c7)]===0x1||this[_0x5ea700(0x254)](_0x471ca6[_0x5ea700(0x155)])?_0x3d2f61=_0x5ea700(0x124):_0x3d2f61=_0x5ea700(0x17c);}const _0x540d6e=this['getDetailedErrorMessage'](_0x471ca6[_0x5ea700(0x155)],_0x471ca6[_0x5ea700(0x22c)]);return{'status':_0x3d2f61,'final':this['isFinalStatus'](_0x471ca6[_0x5ea700(0x155)]),'amount':_0x471ca6['amount'],'currency':_0x471ca6[_0x5ea700(0x1a8)],'date_success':_0x471ca6[_0x5ea700(0x21d)],'description':_0x540d6e};}catch(_0xe6d250){console[_0x5ea700(0x24c)](_0x3f2320+_0x5ea700(0x20b),_0xe6d250),loggerService_1[_0x5ea700(0x1ad)][_0x5ea700(0x15e)](_0x3f2320[_0x5ea700(0x179)](),_0x5ea700(0x261),_0xe6d250);throw new Error(_0x5ea700(0x1e7)+_0x3f2320+_0x5ea700(0x204)+(_0xe6d250 instanceof Error?_0xe6d250['message']:_0x5ea700(0x1d3)));}}[a57_0x3eab0a(0x1e4)](_0x320e09,_0x1ceacb,_0x533263,_0x330d80){const _0x39924a=a57_0x3eab0a;console[_0x39924a(0x151)](_0x39924a(0x116)+_0x330d80+_0x39924a(0x1e3)+_0x320e09+'\x20('+_0x533263+')'),this[_0x39924a(0x23b)](_0x320e09);const _0x28e0f1=[],_0x1fa325=0x5*0x3c*0x3e8,_0x2d870f=0x2*0x3c*0x3c*0x3e8,_0x146b1d=Math['floor'](_0x2d870f/_0x1fa325);console['log'](_0x39924a(0x1f3)+_0x146b1d+_0x39924a(0x244));for(let _0x3a2d1c=0x1;_0x3a2d1c<=_0x146b1d;_0x3a2d1c++){const _0x4fcfb4=setTimeout(async()=>{const _0x3b7c6b=_0x39924a;console[_0x3b7c6b(0x151)](_0x3b7c6b(0x202)+_0x330d80+_0x3b7c6b(0x1c0)+_0x3a2d1c+'/'+_0x146b1d+_0x3b7c6b(0x1a6)+_0x320e09);try{const _0x54f75f=await this['checkPaymentStatus'](_0x533263,_0x1ceacb,_0x330d80);console[_0x3b7c6b(0x151)](_0x3b7c6b(0x139)+_0x3a2d1c+'\x20result:',_0x54f75f),_0x54f75f[_0x3b7c6b(0x1c7)]&&(console[_0x3b7c6b(0x151)](_0x3b7c6b(0x248)+_0x320e09+'\x20is\x20final\x20('+_0x54f75f[_0x3b7c6b(0x155)]+_0x3b7c6b(0x16a)),this['clearStatusTimers'](_0x320e09),await this['updatePaymentStatus'](_0x320e09,_0x54f75f[_0x3b7c6b(0x155)],_0x54f75f));}catch(_0x4a2da0){console[_0x3b7c6b(0x24c)](_0x3b7c6b(0x16b)+_0x3a2d1c+'\x20failed\x20for\x20payment\x20'+_0x320e09+':',_0x4a2da0);}},_0x3a2d1c*_0x1fa325);_0x28e0f1['push'](_0x4fcfb4);}this[_0x39924a(0x1fc)]['set'](_0x320e09,_0x28e0f1),console[_0x39924a(0x151)]('‚úÖ\x20Scheduled\x20'+_0x146b1d+_0x39924a(0x176)+_0x320e09);}[a57_0x3eab0a(0x23b)](_0x44ea28){const _0x5435e3=a57_0x3eab0a,_0x11d400=this[_0x5435e3(0x1fc)][_0x5435e3(0x25f)](_0x44ea28);_0x11d400&&(console['log'](_0x5435e3(0x19f)+_0x11d400['length']+_0x5435e3(0x1aa)+_0x44ea28),_0x11d400[_0x5435e3(0x113)]((_0x32fa11,_0x1621d5)=>{clearTimeout(_0x32fa11);}),this[_0x5435e3(0x1fc)]['delete'](_0x44ea28));}async[a57_0x3eab0a(0x231)](_0x2ac6e4,_0x3f6dce,_0x1c0bf7){const _0x1e42a1=a57_0x3eab0a;try{const _0x4bbb48=(await Promise[_0x1e42a1(0x184)]()['then'](()=>__importStar(require(_0x1e42a1(0x259)))))['default'],_0x4d9268={'status':_0x3f6dce[_0x1e42a1(0x1ce)](),'updatedAt':new Date(),'statusChangedBy':_0x1e42a1(0x1f1),'statusChangedAt':new Date()};_0x3f6dce===_0x1e42a1(0x161)&&(_0x4d9268[_0x1e42a1(0x125)]=new Date()),_0x3f6dce===_0x1e42a1(0x124)&&_0x1c0bf7[_0x1e42a1(0x17e)]&&(_0x4d9268[_0x1e42a1(0x1bf)]=_0x1c0bf7[_0x1e42a1(0x17e)],console[_0x1e42a1(0x151)](_0x1e42a1(0x1ff)+_0x1c0bf7[_0x1e42a1(0x17e)])),await _0x4bbb48['payment'][_0x1e42a1(0x211)]({'where':{'id':_0x2ac6e4},'data':_0x4d9268}),console[_0x1e42a1(0x151)](_0x1e42a1(0x248)+_0x2ac6e4+_0x1e42a1(0x220)+_0x3f6dce),await this[_0x1e42a1(0x1d1)](_0x2ac6e4,_0x3f6dce);}catch(_0x44205e){console[_0x1e42a1(0x24c)]('‚ùå\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x2ac6e4+':',_0x44205e);}}async[a57_0x3eab0a(0x1d1)](_0x1dd22b,_0xde2767){const _0x31273c=a57_0x3eab0a;try{const _0x413743=(await Promise['resolve']()[_0x31273c(0x23f)](()=>__importStar(require('../../config/database'))))[_0x31273c(0x1e1)],{telegramBotService:_0x13724f}=await Promise[_0x31273c(0x184)]()[_0x31273c(0x23f)](()=>__importStar(require('../telegramBotService'))),_0x1e332a=await _0x413743[_0x31273c(0x225)][_0x31273c(0x25c)]({'where':{'id':_0x1dd22b},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x1e332a)return;const _0x23d51e={'PAID':_0x31273c(0x262),'FAILED':_0x31273c(0x1f9)},_0x55f3b1=_0x23d51e[_0xde2767];_0x55f3b1&&await _0x13724f[_0x31273c(0x16c)](_0x1e332a['shopId'],_0x1e332a,_0x55f3b1),await this[_0x31273c(0x1d8)](_0x1e332a,_0xde2767);}catch(_0x39155a){console[_0x31273c(0x24c)](_0x31273c(0x1db),_0x39155a);}}async[a57_0x3eab0a(0x1d8)](_0x1911ab,_0x303215){const _0x1b7dd7=a57_0x3eab0a,_0x2cb1d8=Date['now']();try{const _0xb78757=_0x1911ab[_0x1b7dd7(0x243)],_0x4ec92a=_0xb78757[_0x1b7dd7(0x1ec)];if(!_0x4ec92a?.[_0x1b7dd7(0x1a1)]){console[_0x1b7dd7(0x151)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0xb78757['id']);return;}const _0x77f980=_0x303215==='PAID'?_0x1b7dd7(0x1c3):_0x1b7dd7(0x1d0);let _0x429fe7=[];if(_0x4ec92a['webhookEvents'])try{_0x429fe7=Array[_0x1b7dd7(0x19c)](_0x4ec92a[_0x1b7dd7(0x22e)])?_0x4ec92a[_0x1b7dd7(0x22e)]:JSON[_0x1b7dd7(0x245)](_0x4ec92a['webhookEvents']);}catch(_0xe21cc2){console[_0x1b7dd7(0x24c)](_0x1b7dd7(0x197),_0xe21cc2),_0x429fe7=[];}if(!_0x429fe7['includes'](_0x77f980)){console['log'](_0x1b7dd7(0x246)+_0x77f980+_0x1b7dd7(0x1bd)+_0xb78757['id']);return;}const _0x157553={'event':_0x77f980,'payment':{'id':_0x1911ab['id'],'order_id':_0x1911ab['orderId'],'gateway_order_id':_0x1911ab[_0x1b7dd7(0x145)],'gateway':_0x1b7dd7(0x241),'amount':_0x1911ab['amount'],'currency':_0x1911ab[_0x1b7dd7(0x1a8)],'status':_0x303215['toLowerCase'](),'customer_email':_0x1911ab[_0x1b7dd7(0x194)],'customer_name':_0x1911ab[_0x1b7dd7(0x1c1)],'created_at':_0x1911ab[_0x1b7dd7(0x20c)],'updated_at':new Date()}},_0x22374d=await fetch(_0x4ec92a['webhookUrl'],{'method':_0x1b7dd7(0x146),'headers':{'Content-Type':'application/json','User-Agent':_0x1b7dd7(0x173)},'body':JSON[_0x1b7dd7(0x1cb)](_0x157553)}),_0x24e0fb=Date['now']()-_0x2cb1d8;loggerService_1['loggerService'][_0x1b7dd7(0x218)](_0x1911ab[_0x1b7dd7(0x1a3)],_0x4ec92a['webhookUrl'],_0x77f980,_0x22374d[_0x1b7dd7(0x155)],_0x24e0fb,_0x157553),console[_0x1b7dd7(0x151)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x4ec92a['webhookUrl']+_0x1b7dd7(0x12e)+_0x22374d[_0x1b7dd7(0x155)]+'\x20('+_0x24e0fb+'ms)');}catch(_0x5c4e7f){console[_0x1b7dd7(0x24c)](_0x1b7dd7(0x1a9),_0x5c4e7f),loggerService_1[_0x1b7dd7(0x1ad)]['logShopWebhookError'](_0x1911ab[_0x1b7dd7(0x1a3)],_0x1911ab[_0x1b7dd7(0x243)]?.['settings']?.[_0x1b7dd7(0x1a1)]||_0x1b7dd7(0x1d5),_0x1b7dd7(0x162),_0x5c4e7f,{});}}[a57_0x3eab0a(0x1f7)](_0x3c2884){const _0x328099=a57_0x3eab0a,_0x574bf9=_0x3c2884[_0x328099(0x16e)](/[\s-]/g,'');if(_0x574bf9[_0x328099(0x1f5)]<0x4)return'****';return'****\x20****\x20****\x20'+_0x574bf9[_0x328099(0x21c)](-0x4);}async[a57_0x3eab0a(0x199)](_0x1ce800,_0x444eba=a57_0x3eab0a(0x118)){const _0x1a97e9=a57_0x3eab0a;console[_0x1a97e9(0x151)]('üîÑ\x20Processing\x20MasterCard\x20webhook\x20data:',JSON['stringify'](_0x1ce800,null,0x2));let _0x461e37=_0x1ce800,_0x341371=_0x444eba;_0x1ce800[_0x1a97e9(0x256)]?(_0x341371=_0x1ce800[_0x1a97e9(0x256)][_0x1a97e9(0x1ce)]()===_0x1a97e9(0x133)?'VISA':_0x1a97e9(0x118),console[_0x1a97e9(0x151)]('üîç\x20Detected\x20card\x20type\x20from\x20webhook:\x20'+_0x341371)):console['log']('üîç\x20Using\x20provided\x20card\x20type:\x20'+_0x341371);if(_0x1ce800[_0x1a97e9(0x1e9)]&&_0x1ce800[_0x1a97e9(0x1ae)]&&_0x1ce800[_0x1a97e9(0x1f2)]){console[_0x1a97e9(0x151)]('üîê\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...');try{const _0x23fe2a=await this['decryptResponsePhp'](_0x1ce800[_0x1a97e9(0x1e9)],_0x1ce800['key'],_0x341371);_0x461e37=JSON[_0x1a97e9(0x245)](_0x23fe2a),console[_0x1a97e9(0x151)](_0x1a97e9(0x138)),console[_0x1a97e9(0x151)](_0x1a97e9(0x22a),JSON[_0x1a97e9(0x1cb)](_0x461e37,null,0x2));}catch(_0x4e8fd4){console[_0x1a97e9(0x24c)](_0x1a97e9(0x251),_0x4e8fd4),console[_0x1a97e9(0x151)]('‚ö†Ô∏è\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted'),_0x461e37=_0x1ce800;}}else console[_0x1a97e9(0x151)]('üìù\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0x9962df=_0x1a97e9(0x17c);if(_0x461e37[_0x1a97e9(0x155)]===0x64&&_0x461e37[_0x1a97e9(0x1c7)]===0x1)_0x9962df=_0x1a97e9(0x161);else{if(_0x461e37[_0x1a97e9(0x1c7)]===0x0||!this[_0x1a97e9(0x254)](_0x461e37[_0x1a97e9(0x155)]))_0x9962df=_0x1a97e9(0x17c);else _0x461e37[_0x1a97e9(0x1c7)]===0x1||this[_0x1a97e9(0x254)](_0x461e37[_0x1a97e9(0x155)])?_0x9962df=_0x1a97e9(0x124):_0x9962df='PENDING';}let _0x4bc546='';if(_0x461e37['order_id'])_0x4bc546=_0x461e37[_0x1a97e9(0x182)][_0x1a97e9(0x168)](),console[_0x1a97e9(0x151)](_0x1a97e9(0x1b0)+_0x341371+_0x1a97e9(0x229)+_0x4bc546);else _0x461e37['payment_id']?(_0x4bc546=_0x461e37['payment_id'][_0x1a97e9(0x168)](),console['log'](_0x1a97e9(0x1b0)+_0x341371+_0x1a97e9(0x189)+_0x4bc546)):(_0x4bc546=_0x461e37['orderId']||_0x461e37['paymentId']||_0x461e37['id']||'',console['log'](_0x1a97e9(0x181)+_0x4bc546));console[_0x1a97e9(0x151)](_0x1a97e9(0x172)+_0x341371+_0x1a97e9(0x188)),console[_0x1a97e9(0x151)](_0x1a97e9(0x135)+_0x4bc546+_0x1a97e9(0x1b1)+_0x461e37[_0x1a97e9(0x182)]+',\x20orderId='+_0x461e37[_0x1a97e9(0x14f)]+_0x1a97e9(0x14e)+_0x461e37[_0x1a97e9(0x183)]+',\x20paymentId='+_0x461e37[_0x1a97e9(0x209)]+',\x20id='+_0x461e37['id']+')'),console[_0x1a97e9(0x151)](_0x1a97e9(0x25e)+_0x9962df+_0x1a97e9(0x1e2)+_0x461e37[_0x1a97e9(0x155)]+',\x20final='+_0x461e37[_0x1a97e9(0x1c7)]+')'),console[_0x1a97e9(0x151)](_0x1a97e9(0x1d4)+_0x461e37['amount']),console['log'](_0x1a97e9(0x191)+_0x461e37[_0x1a97e9(0x1a8)]);let _0x1012a4;_0x9962df==='FAILED'&&(_0x1012a4=this[_0x1a97e9(0x23e)](_0x461e37['status'],_0x461e37[_0x1a97e9(0x22c)]),console[_0x1a97e9(0x151)](_0x1a97e9(0x18c)+_0x1012a4));const _0x218256={'paymentId':_0x4bc546,'status':_0x9962df,'amount':_0x461e37[_0x1a97e9(0x157)],'currency':_0x461e37[_0x1a97e9(0x1a8)]};return _0x1012a4&&(_0x218256[_0x1a97e9(0x1ac)]=_0x1012a4),_0x218256;}[a57_0x3eab0a(0x1f6)](){const _0xd2cce3=a57_0x3eab0a;console[_0xd2cce3(0x151)](_0xd2cce3(0x253));const _0x480a29=this[_0xd2cce3(0x1fc)][_0xd2cce3(0x20a)];for(const [_0x2fe078]of this[_0xd2cce3(0x1fc)]){this[_0xd2cce3(0x23b)](_0x2fe078);}console[_0xd2cce3(0x151)](_0xd2cce3(0x24d)+_0x480a29+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a57_0x3eab0a(0x215)]=VisaMasterCardService;