'use strict';const a42_0x6da1b1=a42_0x24c6;(function(_0x189bf6,_0x2dcd54){const _0x5e8074=a42_0x24c6,_0x588dd5=_0x189bf6();while(!![]){try{const _0xd1af2a=-parseInt(_0x5e8074(0x15f))/0x1*(parseInt(_0x5e8074(0x1a7))/0x2)+parseInt(_0x5e8074(0x208))/0x3*(-parseInt(_0x5e8074(0x1c9))/0x4)+-parseInt(_0x5e8074(0x13e))/0x5*(-parseInt(_0x5e8074(0x1c3))/0x6)+-parseInt(_0x5e8074(0x17c))/0x7*(parseInt(_0x5e8074(0x13f))/0x8)+parseInt(_0x5e8074(0x154))/0x9*(parseInt(_0x5e8074(0x199))/0xa)+-parseInt(_0x5e8074(0x15b))/0xb*(parseInt(_0x5e8074(0x1d6))/0xc)+parseInt(_0x5e8074(0x21a))/0xd;if(_0xd1af2a===_0x2dcd54)break;else _0x588dd5['push'](_0x588dd5['shift']());}catch(_0x50526d){_0x588dd5['push'](_0x588dd5['shift']());}}}(a42_0x54f6,0xe16fe));function a42_0x24c6(_0x2d53e9,_0x396537){const _0x54f6b2=a42_0x54f6();return a42_0x24c6=function(_0x24c66f,_0x1ad8aa){_0x24c66f=_0x24c66f-0x12a;let _0x473d6b=_0x54f6b2[_0x24c66f];return _0x473d6b;},a42_0x24c6(_0x2d53e9,_0x396537);}var __createBinding=this&&this[a42_0x6da1b1(0x1b1)]||(Object[a42_0x6da1b1(0x150)]?function(_0xf1065d,_0x3d73fb,_0x337495,_0x247bf2){const _0x48d3f0=a42_0x6da1b1;if(_0x247bf2===undefined)_0x247bf2=_0x337495;var _0x3d7f5a=Object[_0x48d3f0(0x202)](_0x3d73fb,_0x337495);(!_0x3d7f5a||(_0x48d3f0(0x1cc)in _0x3d7f5a?!_0x3d73fb[_0x48d3f0(0x1e4)]:_0x3d7f5a[_0x48d3f0(0x1e0)]||_0x3d7f5a[_0x48d3f0(0x186)]))&&(_0x3d7f5a={'enumerable':!![],'get':function(){return _0x3d73fb[_0x337495];}}),Object[_0x48d3f0(0x132)](_0xf1065d,_0x247bf2,_0x3d7f5a);}:function(_0x2e63d7,_0x1fb672,_0x89dd8d,_0x4da3b8){if(_0x4da3b8===undefined)_0x4da3b8=_0x89dd8d;_0x2e63d7[_0x4da3b8]=_0x1fb672[_0x89dd8d];}),__setModuleDefault=this&&this[a42_0x6da1b1(0x170)]||(Object[a42_0x6da1b1(0x150)]?function(_0x274d2e,_0x4c9a75){const _0x12f237=a42_0x6da1b1;Object[_0x12f237(0x132)](_0x274d2e,_0x12f237(0x144),{'enumerable':!![],'value':_0x4c9a75});}:function(_0x124ae6,_0xcc0b64){const _0x738529=a42_0x6da1b1;_0x124ae6[_0x738529(0x144)]=_0xcc0b64;}),__importStar=this&&this[a42_0x6da1b1(0x156)]||(function(){var _0x75c587=function(_0x4136c1){const _0x25a6d0=a42_0x24c6;return _0x75c587=Object[_0x25a6d0(0x21c)]||function(_0x16aff3){const _0x21b700=_0x25a6d0;var _0x209e9e=[];for(var _0x448ef6 in _0x16aff3)if(Object[_0x21b700(0x1be)]['hasOwnProperty'][_0x21b700(0x210)](_0x16aff3,_0x448ef6))_0x209e9e[_0x209e9e[_0x21b700(0x162)]]=_0x448ef6;return _0x209e9e;},_0x75c587(_0x4136c1);};return function(_0x1c298c){const _0x37100f=a42_0x24c6;if(_0x1c298c&&_0x1c298c[_0x37100f(0x1e4)])return _0x1c298c;var _0x4c7637={};if(_0x1c298c!=null){for(var _0x586f91=_0x75c587(_0x1c298c),_0x2d373e=0x0;_0x2d373e<_0x586f91[_0x37100f(0x162)];_0x2d373e++)if(_0x586f91[_0x2d373e]!==_0x37100f(0x144))__createBinding(_0x4c7637,_0x1c298c,_0x586f91[_0x2d373e]);}return __setModuleDefault(_0x4c7637,_0x1c298c),_0x4c7637;};}()),__importDefault=this&&this[a42_0x6da1b1(0x13a)]||function(_0x5f5a79){const _0x1710df=a42_0x6da1b1;return _0x5f5a79&&_0x5f5a79[_0x1710df(0x1e4)]?_0x5f5a79:{'default':_0x5f5a79};};Object['defineProperty'](exports,a42_0x6da1b1(0x1e4),{'value':!![]}),exports['MasterCardService']=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x6da1b1(0x12c))),loggerService_1=require(a42_0x6da1b1(0x1e3));class MasterCardService{constructor(){const _0x212d2a=a42_0x6da1b1;this[_0x212d2a(0x1a2)]=new Map(),this[_0x212d2a(0x1ae)]='https://api.paydmeth.com/api',this['merchantPointId']=0x67c,this[_0x212d2a(0x16e)]=path_1[_0x212d2a(0x144)][_0x212d2a(0x145)](process['cwd'](),_0x212d2a(0x168),'private.pem'),this['publicKeyPath']=path_1[_0x212d2a(0x144)][_0x212d2a(0x145)](process[_0x212d2a(0x178)](),_0x212d2a(0x168),'psp_public.pem'),console[_0x212d2a(0x13b)]('💳\x20MasterCard\x20service\x20initialized'),console[_0x212d2a(0x13b)](_0x212d2a(0x1ef),this[_0x212d2a(0x16e)]),console['log']('🔐\x20Public\x20key\x20path:',this[_0x212d2a(0x1aa)]),this[_0x212d2a(0x19d)]();}[a42_0x6da1b1(0x19d)](){const _0x5e2ccd=a42_0x6da1b1;try{if(!fs_1[_0x5e2ccd(0x144)][_0x5e2ccd(0x1e8)](this[_0x5e2ccd(0x16e)]))throw new Error(_0x5e2ccd(0x214)+this['privateKeyPath']);if(!fs_1[_0x5e2ccd(0x144)]['existsSync'](this[_0x5e2ccd(0x1aa)]))throw new Error('Public\x20key\x20file\x20not\x20found:\x20'+this[_0x5e2ccd(0x1aa)]);const _0x3c0d6c=fs_1[_0x5e2ccd(0x144)][_0x5e2ccd(0x205)](this[_0x5e2ccd(0x16e)],_0x5e2ccd(0x1f5))['trim'](),_0xbc4925=fs_1[_0x5e2ccd(0x144)]['readFileSync'](this['publicKeyPath'],_0x5e2ccd(0x1f5))[_0x5e2ccd(0x1e2)]();if(!_0x3c0d6c[_0x5e2ccd(0x185)](_0x5e2ccd(0x1e6))||!_0x3c0d6c['includes'](_0x5e2ccd(0x16a)))throw new Error(_0x5e2ccd(0x1bd));if(!_0xbc4925[_0x5e2ccd(0x185)]('-----BEGIN')||!_0xbc4925[_0x5e2ccd(0x185)](_0x5e2ccd(0x16a)))throw new Error(_0x5e2ccd(0x1d1));console[_0x5e2ccd(0x13b)]('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console[_0x5e2ccd(0x13b)](_0x5e2ccd(0x1c8)+_0x3c0d6c[_0x5e2ccd(0x162)]+'\x20characters'),console['log'](_0x5e2ccd(0x137)+_0xbc4925['length']+_0x5e2ccd(0x17d));}catch(_0x371209){console[_0x5e2ccd(0x1b5)]('❌\x20MasterCard\x20key\x20validation\x20failed:',_0x371209);throw _0x371209;}}[a42_0x6da1b1(0x1af)](){const _0x460f58=a42_0x6da1b1,_0x3f554c=crypto_1[_0x460f58(0x144)][_0x460f58(0x1d9)](0x20),_0x8f0c21=crypto_1[_0x460f58(0x144)][_0x460f58(0x1d9)](0x10);return{'key':_0x3f554c,'iv':_0x8f0c21};}[a42_0x6da1b1(0x16d)](_0x9fbc25,_0x266538,_0x3fbfcc){const _0x1c79e5=a42_0x6da1b1,_0x50d410=crypto_1[_0x1c79e5(0x144)][_0x1c79e5(0x1ce)](_0x1c79e5(0x1ad),_0x266538,_0x3fbfcc);let _0x249aea=_0x50d410[_0x1c79e5(0x196)](_0x9fbc25,_0x1c79e5(0x1f5),_0x1c79e5(0x15c));return _0x249aea+=_0x50d410[_0x1c79e5(0x18d)](_0x1c79e5(0x15c)),_0x249aea;}[a42_0x6da1b1(0x1c2)](_0x160d81,_0x3e24bd){const _0x5c1735=a42_0x6da1b1;try{const _0x5cb51b=fs_1[_0x5c1735(0x144)][_0x5c1735(0x205)](this['publicKeyPath'],_0x5c1735(0x1f5))[_0x5c1735(0x1e2)](),_0xb62e80={'iv':_0x3e24bd[_0x5c1735(0x1ca)](_0x5c1735(0x15c)),'key':_0x160d81[_0x5c1735(0x1ca)](_0x5c1735(0x15c))},_0x1984e3=JSON['stringify'](_0xb62e80);console[_0x5c1735(0x13b)](_0x5c1735(0x1fe),_0x1984e3[_0x5c1735(0x162)]);const _0x1c46ee=crypto_1[_0x5c1735(0x144)][_0x5c1735(0x1e9)]({'key':_0x5cb51b,'padding':crypto_1[_0x5c1735(0x144)][_0x5c1735(0x1ba)][_0x5c1735(0x1c0)]},Buffer[_0x5c1735(0x1c6)](_0x1984e3));return console['log'](_0x5c1735(0x194),_0x1c46ee[_0x5c1735(0x162)]),_0x1c46ee[_0x5c1735(0x1ca)](_0x5c1735(0x15c));}catch(_0x54bf69){console['error'](_0x5c1735(0x13d),_0x54bf69);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a42_0x6da1b1(0x1ab)](_0x2b5884){const _0x3d0553=a42_0x6da1b1;try{const _0x2bb5f3=fs_1[_0x3d0553(0x144)][_0x3d0553(0x205)](this[_0x3d0553(0x16e)],'utf8')[_0x3d0553(0x1e2)](),_0x379fc1=crypto_1[_0x3d0553(0x144)][_0x3d0553(0x1bb)](_0x3d0553(0x12a));_0x379fc1['update'](_0x2b5884),_0x379fc1[_0x3d0553(0x212)]();const _0x19cb87=_0x379fc1[_0x3d0553(0x200)](_0x2bb5f3,_0x3d0553(0x15c));return console[_0x3d0553(0x13b)](_0x3d0553(0x12d)),console[_0x3d0553(0x13b)](_0x3d0553(0x1a1),_0x2b5884[_0x3d0553(0x162)]),console[_0x3d0553(0x13b)](_0x3d0553(0x217),_0x19cb87[_0x3d0553(0x162)]),_0x19cb87;}catch(_0x3a7be4){console['error'](_0x3d0553(0x15e),_0x3a7be4),console['error'](_0x3d0553(0x1cb),_0x2b5884['substring'](0x0,0xc8)+'...');throw new Error(_0x3d0553(0x136));}}['decryptAES'](_0x4df5cf,_0x23e9cb,_0x47bb07){const _0xbfcb78=a42_0x6da1b1,_0x3bab0c=crypto_1[_0xbfcb78(0x144)][_0xbfcb78(0x13c)](_0xbfcb78(0x1ad),_0x23e9cb,_0x47bb07);let _0x5ec699=_0x3bab0c['update'](_0x4df5cf,_0xbfcb78(0x15c),_0xbfcb78(0x1f5));return _0x5ec699+=_0x3bab0c[_0xbfcb78(0x18d)](_0xbfcb78(0x1f5)),_0x5ec699;}async[a42_0x6da1b1(0x203)](_0x120b38,_0x3dfd3d){const _0xa0c3ef=a42_0x6da1b1;try{const _0x3113f8=await fetch(_0xa0c3ef(0x1b9),{'method':_0xa0c3ef(0x1ed),'headers':{'Content-Type':_0xa0c3ef(0x151)},'body':JSON[_0xa0c3ef(0x1ec)]({'info':_0x120b38,'key':_0x3dfd3d})});if(!_0x3113f8['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x3113f8[_0xa0c3ef(0x1a0)]();}catch(_0x277b4a){console['error'](_0xa0c3ef(0x207),_0x277b4a);throw new Error(_0xa0c3ef(0x152));}}['decryptResponse'](_0x344952,_0x48847c){const _0x17b82b=a42_0x6da1b1;try{const _0x1a94e7=fs_1[_0x17b82b(0x144)][_0x17b82b(0x205)](this[_0x17b82b(0x16e)],'utf8')['trim'](),_0x21da1e=crypto_1[_0x17b82b(0x144)][_0x17b82b(0x14a)](_0x1a94e7,Buffer['from'](_0x48847c,_0x17b82b(0x15c))),_0x34eb26=JSON[_0x17b82b(0x182)](_0x21da1e[_0x17b82b(0x1ca)]()),_0x3d88db=Buffer['from'](_0x34eb26['key'],_0x17b82b(0x15c)),_0x597b18=Buffer[_0x17b82b(0x1c6)](_0x34eb26['iv'],_0x17b82b(0x15c));return this[_0x17b82b(0x14e)](_0x344952,_0x3d88db,_0x597b18);}catch(_0x720edb){throw new Error(_0x17b82b(0x12b));}}async[a42_0x6da1b1(0x160)](_0x2baa65){const _0x24537b=a42_0x6da1b1,{paymentId:_0x2c879b,orderId:_0x36d3e1,amount:_0x5e3f70,currency:_0x416227,cardData:_0x172695,resultUrl:_0x1d410b,returnUrl:_0x1d1d75,cardHolder:_0x180934,browser:_0x5ac5e1}=_0x2baa65;console['log']('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x24537b(0x13b)]('Payment\x20ID:',_0x2c879b),console[_0x24537b(0x13b)](_0x24537b(0x209),_0x36d3e1),console[_0x24537b(0x13b)]('Amount:',_0x5e3f70,_0x416227),console['log']('Card\x20Number:',this[_0x24537b(0x19c)](_0x172695[_0x24537b(0x1b3)])),console[_0x24537b(0x13b)](_0x24537b(0x134),_0x180934[_0x24537b(0x171)]+'\x20'+_0x180934[_0x24537b(0x131)]),console[_0x24537b(0x13b)](_0x24537b(0x19f),_0x1d1d75),console['log'](_0x24537b(0x133),_0x1d410b);const _0x4191e3={'amount':_0x5e3f70,'currency':_0x416227[_0x24537b(0x1c5)](),'order_id':_0x36d3e1,'result_url':_0x1d410b,'return_url':_0x1d1d75,'card':{'number':_0x172695['number'],'expire_month':_0x172695[_0x24537b(0x1d8)],'expire_year':_0x172695[_0x24537b(0x140)],'cvv':_0x172695['cvv']},'card_holder':_0x180934,'browser':_0x5ac5e1},_0x4160b2=JSON[_0x24537b(0x1ec)](_0x4191e3);console[_0x24537b(0x13b)](_0x24537b(0x17f)),console[_0x24537b(0x13b)](_0x24537b(0x215)),console[_0x24537b(0x13b)](_0x4160b2),console[_0x24537b(0x13b)]('📝\x20Data\x20length:',_0x4160b2['length']);try{const {key:_0x54d10a,iv:_0x115ccb}=this[_0x24537b(0x1af)]();console['log'](_0x24537b(0x1c4)),console[_0x24537b(0x13b)](_0x24537b(0x16b),_0x54d10a[_0x24537b(0x162)]),console[_0x24537b(0x13b)](_0x24537b(0x190),_0x115ccb['length']);const _0x160705=this[_0x24537b(0x16d)](_0x4160b2,_0x54d10a,_0x115ccb);console['log'](_0x24537b(0x21d)),console[_0x24537b(0x13b)](_0x24537b(0x1d5),_0x160705['length']);const _0xcc4e44=this[_0x24537b(0x1c2)](_0x54d10a,_0x115ccb);console[_0x24537b(0x13b)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x24537b(0x13b)](_0x24537b(0x1d4),_0xcc4e44[_0x24537b(0x162)]);const _0x5316a6=this[_0x24537b(0x1ab)](_0x4160b2);console[_0x24537b(0x13b)](_0x24537b(0x1d3)),console[_0x24537b(0x13b)]('📝\x20Signature\x20length:',_0x5316a6['length']);const _0x4835b3={'merchant_point_id':this[_0x24537b(0x1ac)],'method':_0x24537b(0x135),'info':_0x160705,'key':_0xcc4e44,'sign':_0x5316a6,'lang':'en'};console[_0x24537b(0x13b)](_0x24537b(0x1bc)),console[_0x24537b(0x13b)](_0x24537b(0x1cf)),console['log'](_0x24537b(0x155),this[_0x24537b(0x1ac)]),console[_0x24537b(0x13b)](_0x24537b(0x184)),console[_0x24537b(0x13b)](_0x24537b(0x17e),_0x160705['length']),console[_0x24537b(0x13b)](_0x24537b(0x146),_0xcc4e44['length']),console['log'](_0x24537b(0x164),_0x5316a6[_0x24537b(0x162)]),console[_0x24537b(0x13b)](_0x24537b(0x1fa)),loggerService_1[_0x24537b(0x19a)]['logWhiteDomainRequest'](_0x24537b(0x176),'/charge',_0x24537b(0x1ed),{'merchant_point_id':this['merchantPointId'],'method':_0x24537b(0x135),'lang':'en'});const _0x361aa6=Date[_0x24537b(0x1fb)](),_0x36ccfa=await fetch(this[_0x24537b(0x1ae)],{'method':_0x24537b(0x1ed),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x24537b(0x21f)},'body':JSON[_0x24537b(0x1ec)](_0x4835b3)}),_0x439600=Date[_0x24537b(0x1fb)]()-_0x361aa6;console[_0x24537b(0x13b)](_0x24537b(0x1b7)),console[_0x24537b(0x13b)]('Status:',_0x36ccfa[_0x24537b(0x142)]),console[_0x24537b(0x13b)]('Response\x20Time:',_0x439600+'ms');if(!_0x36ccfa['ok']){const _0x31340f=await _0x36ccfa[_0x24537b(0x1a0)]();console[_0x24537b(0x1b5)](_0x24537b(0x1f9),_0x36ccfa[_0x24537b(0x142)]),console[_0x24537b(0x1b5)]('Response\x20Body:',_0x31340f),loggerService_1['loggerService'][_0x24537b(0x19b)](_0x24537b(0x176),'/charge_raw',_0x36ccfa[_0x24537b(0x142)],_0x31340f,_0x439600),loggerService_1[_0x24537b(0x19a)][_0x24537b(0x15d)]('mastercard','/charge',_0x24537b(0x206)+_0x36ccfa[_0x24537b(0x142)]+':\x20'+_0x31340f);throw new Error(_0x24537b(0x218)+_0x36ccfa['status']+_0x24537b(0x1da)+_0x31340f);}const _0x13b6c9=await _0x36ccfa[_0x24537b(0x18f)]();loggerService_1[_0x24537b(0x19a)]['logWhiteDomainResponse'](_0x24537b(0x176),_0x24537b(0x18e),_0x36ccfa[_0x24537b(0x142)],_0x13b6c9,_0x439600),console[_0x24537b(0x13b)](_0x24537b(0x1eb));let _0x38402d=_0x13b6c9;if(_0x13b6c9[_0x24537b(0x20f)]&&_0x13b6c9[_0x24537b(0x1fd)]&&_0x13b6c9[_0x24537b(0x200)]){console['log'](_0x24537b(0x1b6));try{const _0x1ab3b7=await this[_0x24537b(0x203)](_0x13b6c9[_0x24537b(0x20f)],_0x13b6c9[_0x24537b(0x1fd)]);_0x38402d=JSON[_0x24537b(0x182)](_0x1ab3b7),console[_0x24537b(0x13b)]('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1['loggerService'][_0x24537b(0x19b)](_0x24537b(0x176),_0x24537b(0x143),_0x36ccfa[_0x24537b(0x142)],_0x38402d,_0x439600),console[_0x24537b(0x13b)](_0x24537b(0x195));}catch(_0x1fe5df){console[_0x24537b(0x1b5)](_0x24537b(0x21b),_0x1fe5df),loggerService_1['loggerService'][_0x24537b(0x15d)](_0x24537b(0x176),_0x24537b(0x163),'Decryption\x20failed:\x20'+_0x1fe5df),_0x38402d=_0x13b6c9;}}else loggerService_1[_0x24537b(0x19a)][_0x24537b(0x19b)](_0x24537b(0x176),'/charge_decrypted',_0x36ccfa[_0x24537b(0x142)],_0x38402d,_0x439600),console[_0x24537b(0x13b)](_0x24537b(0x158));console[_0x24537b(0x13b)](_0x24537b(0x1a6),_0x38402d[_0x24537b(0x142)]),console[_0x24537b(0x13b)](_0x24537b(0x197),_0x38402d[_0x24537b(0x18d)]),console[_0x24537b(0x13b)](_0x24537b(0x1ea),_0x38402d[_0x24537b(0x213)]),console[_0x24537b(0x13b)](_0x24537b(0x1f8),_0x38402d[_0x24537b(0x1e5)]||_0x24537b(0x20d));if(_0x38402d[_0x24537b(0x142)]===0x64&&_0x38402d['final']===0x1)return console[_0x24537b(0x13b)]('✅\x20Payment\x20successful'),{'gateway_payment_id':_0x38402d['payment_id']?.['toString'](),'payment_url':_0x1d1d75,'requires_3ds':![],'status':_0x24537b(0x172),'final':!![]};if(_0x38402d[_0x24537b(0x1e5)])return console[_0x24537b(0x13b)](_0x24537b(0x198)),this['scheduleStatusChecks'](_0x2c879b,_0x36d3e1,_0x38402d[_0x24537b(0x213)]?.[_0x24537b(0x1ca)]()||_0x36d3e1),{'gateway_payment_id':_0x38402d[_0x24537b(0x213)]?.['toString'](),'payment_url':_0x38402d[_0x24537b(0x1e5)],'requires_3ds':!![],'threeds_url':_0x38402d[_0x24537b(0x1e5)],'status':'PENDING','final':![]};let _0x442cf5=_0x38402d[_0x24537b(0x1f7)]||_0x38402d['message']||'Unknown\x20error',_0x9ef3d3=_0x38402d[_0x24537b(0x142)],_0x3b0b8d=_0x38402d[_0x24537b(0x18d)];return console[_0x24537b(0x13b)]('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x9ef3d3+',\x20Final:\x20'+_0x3b0b8d+_0x24537b(0x180)+_0x442cf5),{'gateway_payment_id':_0x38402d[_0x24537b(0x213)]?.[_0x24537b(0x1ca)](),'payment_url':_0x1d1d75,'requires_3ds':![],'status':_0x24537b(0x1f3),'final':!![]};}catch(_0x4e4b6d){console['error']('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console[_0x24537b(0x1b5)](_0x24537b(0x1b2),_0x4e4b6d),loggerService_1[_0x24537b(0x19a)][_0x24537b(0x15d)](_0x24537b(0x176),_0x24537b(0x1cd),_0x4e4b6d);throw new Error(_0x24537b(0x1db)+(_0x4e4b6d instanceof Error?_0x4e4b6d['message']:'Unknown\x20error'));}}async[a42_0x6da1b1(0x1bf)](_0x52d8cc,_0x51d5cd){const _0x1c48f4=a42_0x6da1b1;console[_0x1c48f4(0x13b)]('📊\x20Checking\x20MasterCard\x20payment\x20status:\x20'+_0x52d8cc+'\x20('+_0x51d5cd+')');try{const _0x16d399={'payment_id':_0x52d8cc,'order_id':_0x51d5cd},_0x1c3999=JSON[_0x1c48f4(0x1ec)](_0x16d399),{key:_0x1ba588,iv:_0xe111c7}=this[_0x1c48f4(0x1af)](),_0x54f5d3=this['encryptAES'](_0x1c3999,_0x1ba588,_0xe111c7),_0x59bc63=this['encryptRSA'](_0x1ba588,_0xe111c7),_0x1af411=this[_0x1c48f4(0x1ab)](_0x1c3999),_0x239f57={'merchant_point_id':this['merchantPointId'],'method':_0x1c48f4(0x142),'info':_0x54f5d3,'key':_0x59bc63,'sign':_0x1af411,'lang':'en'};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x1c48f4(0x176),_0x1c48f4(0x1f4),_0x1c48f4(0x1ed),{'merchant_point_id':this[_0x1c48f4(0x1ac)],'method':_0x1c48f4(0x142),'lang':'en'});const _0x336bb5=Date[_0x1c48f4(0x1fb)](),_0x5899e9=await fetch(this['apiUrl'],{'method':_0x1c48f4(0x1ed),'headers':{'Content-Type':_0x1c48f4(0x151),'Accept':_0x1c48f4(0x151),'User-Agent':_0x1c48f4(0x21f)},'body':JSON[_0x1c48f4(0x1ec)](_0x239f57)}),_0x904ace=Date[_0x1c48f4(0x1fb)]()-_0x336bb5;if(!_0x5899e9['ok']){const _0x3a9f25=await _0x5899e9['text']();loggerService_1['loggerService'][_0x1c48f4(0x19b)](_0x1c48f4(0x176),_0x1c48f4(0x173),_0x5899e9[_0x1c48f4(0x142)],_0x3a9f25,_0x904ace);throw new Error(_0x1c48f4(0x218)+_0x5899e9[_0x1c48f4(0x142)]);}const _0x11d950=await _0x5899e9[_0x1c48f4(0x18f)]();loggerService_1[_0x1c48f4(0x19a)][_0x1c48f4(0x19b)](_0x1c48f4(0x176),_0x1c48f4(0x173),_0x5899e9['status'],_0x11d950,_0x904ace);let _0x3ac49f=_0x11d950;if(_0x11d950[_0x1c48f4(0x20f)]&&_0x11d950[_0x1c48f4(0x1fd)]&&_0x11d950[_0x1c48f4(0x200)]){console[_0x1c48f4(0x13b)](_0x1c48f4(0x1ee));try{const _0x27474a=this['decryptResponse'](_0x11d950[_0x1c48f4(0x20f)],_0x11d950['key']);_0x3ac49f=JSON[_0x1c48f4(0x182)](_0x27474a),console[_0x1c48f4(0x13b)](_0x1c48f4(0x147)),loggerService_1[_0x1c48f4(0x19a)]['logWhiteDomainResponse'](_0x1c48f4(0x176),_0x1c48f4(0x157),_0x5899e9[_0x1c48f4(0x142)],_0x3ac49f,_0x904ace),console[_0x1c48f4(0x13b)](_0x1c48f4(0x1a4));}catch(_0x4acb74){console[_0x1c48f4(0x1b5)](_0x1c48f4(0x216),_0x4acb74),loggerService_1[_0x1c48f4(0x19a)][_0x1c48f4(0x15d)]('mastercard','/status_decrypt',_0x1c48f4(0x12e)+_0x4acb74),_0x3ac49f=_0x11d950;}}else loggerService_1[_0x1c48f4(0x19a)]['logWhiteDomainResponse'](_0x1c48f4(0x176),'/status_decrypted',_0x5899e9[_0x1c48f4(0x142)],_0x3ac49f,_0x904ace),console[_0x1c48f4(0x13b)]('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x1c48f4(0x13b)]('📊\x20Status\x20check\x20result:',{'status':_0x3ac49f['status'],'final':_0x3ac49f[_0x1c48f4(0x18d)],'payment_id':_0x3ac49f[_0x1c48f4(0x213)],'desc':_0x3ac49f[_0x1c48f4(0x1f7)]});let _0x31be14=_0x1c48f4(0x18c);if(_0x3ac49f['status']===0x1&&_0x3ac49f[_0x1c48f4(0x18d)]===0x1)_0x31be14=_0x1c48f4(0x172);else _0x3ac49f[_0x1c48f4(0x142)]===0x0&&_0x3ac49f[_0x1c48f4(0x18d)]===0x0?_0x31be14=_0x1c48f4(0x18c):_0x31be14=_0x1c48f4(0x1f3);return{'status':_0x31be14,'final':_0x3ac49f[_0x1c48f4(0x18d)]===0x1,'amount':_0x3ac49f[_0x1c48f4(0x1b0)],'currency':_0x3ac49f[_0x1c48f4(0x14c)],'date_success':_0x3ac49f[_0x1c48f4(0x1a9)],'description':_0x3ac49f['desc']};}catch(_0x3bb9fa){console['error']('MasterCard\x20status\x20check\x20error:',_0x3bb9fa),loggerService_1['loggerService']['logWhiteDomainError'](_0x1c48f4(0x176),_0x1c48f4(0x1f4),_0x3bb9fa);throw new Error(_0x1c48f4(0x1b4)+(_0x3bb9fa instanceof Error?_0x3bb9fa[_0x1c48f4(0x1f2)]:_0x1c48f4(0x211)));}}[a42_0x6da1b1(0x1a3)](_0x1bf5ff,_0x3c56b5,_0x3836b2){const _0x3d2600=a42_0x6da1b1;console[_0x3d2600(0x13b)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0x1bf5ff+'\x20('+_0x3836b2+')'),this[_0x3d2600(0x1dd)](_0x1bf5ff);const _0x5d1c47=[],_0x5bf940=0x5*0x3c*0x3e8,_0x136d0d=0x2*0x3c*0x3c*0x3e8,_0x513975=Math[_0x3d2600(0x188)](_0x136d0d/_0x5bf940);console[_0x3d2600(0x13b)]('⏰\x20Will\x20check\x20status\x20'+_0x513975+_0x3d2600(0x17b));for(let _0x404205=0x1;_0x404205<=_0x513975;_0x404205++){const _0x5e24fb=setTimeout(async()=>{const _0xfca4c9=_0x3d2600;console['log'](_0xfca4c9(0x14d)+_0x404205+'/'+_0x513975+_0xfca4c9(0x166)+_0x1bf5ff);try{const _0x48dae9=await this[_0xfca4c9(0x1bf)](_0x3836b2,_0x3c56b5);console[_0xfca4c9(0x13b)](_0xfca4c9(0x18b)+_0x404205+_0xfca4c9(0x12f),_0x48dae9),_0x48dae9[_0xfca4c9(0x18d)]&&(console['log']('✅\x20Payment\x20'+_0x1bf5ff+_0xfca4c9(0x1f1)+_0x48dae9['status']+_0xfca4c9(0x219)),this[_0xfca4c9(0x1dd)](_0x1bf5ff),await this[_0xfca4c9(0x192)](_0x1bf5ff,_0x48dae9['status'],_0x48dae9));}catch(_0x17fbc4){console[_0xfca4c9(0x1b5)](_0xfca4c9(0x165)+_0x404205+'\x20failed\x20for\x20payment\x20'+_0x1bf5ff+':',_0x17fbc4);}},_0x404205*_0x5bf940);_0x5d1c47['push'](_0x5e24fb);}this[_0x3d2600(0x1a2)][_0x3d2600(0x1de)](_0x1bf5ff,_0x5d1c47),console[_0x3d2600(0x13b)](_0x3d2600(0x14b)+_0x513975+_0x3d2600(0x161)+_0x1bf5ff);}[a42_0x6da1b1(0x1dd)](_0x48bad3){const _0x4b95a9=a42_0x6da1b1,_0x185aad=this[_0x4b95a9(0x1a2)][_0x4b95a9(0x1cc)](_0x48bad3);_0x185aad&&(console[_0x4b95a9(0x13b)](_0x4b95a9(0x159)+_0x185aad[_0x4b95a9(0x162)]+_0x4b95a9(0x169)+_0x48bad3),_0x185aad['forEach']((_0x26d75b,_0x2a1661)=>{clearTimeout(_0x26d75b);}),this[_0x4b95a9(0x1a2)][_0x4b95a9(0x1c1)](_0x48bad3));}async[a42_0x6da1b1(0x192)](_0x45ccf8,_0x539dc7,_0x540c13){const _0x4e2281=a42_0x6da1b1;try{const _0x476b5a=(await Promise[_0x4e2281(0x1b8)]()[_0x4e2281(0x20a)](()=>__importStar(require(_0x4e2281(0x201)))))[_0x4e2281(0x144)],_0x5ceaa4={'status':_0x539dc7[_0x4e2281(0x1c5)](),'updatedAt':new Date(),'statusChangedBy':_0x4e2281(0x149),'statusChangedAt':new Date()};_0x539dc7==='PAID'&&(_0x5ceaa4['paidAt']=new Date()),_0x540c13[_0x4e2281(0x1a5)]&&(_0x5ceaa4[_0x4e2281(0x204)]=_0x4e2281(0x167)+_0x540c13['description']),await _0x476b5a[_0x4e2281(0x193)]['update']({'where':{'id':_0x45ccf8},'data':_0x5ceaa4}),console[_0x4e2281(0x13b)]('✅\x20Payment\x20'+_0x45ccf8+_0x4e2281(0x1df)+_0x539dc7),await this['sendPaymentNotifications'](_0x45ccf8,_0x539dc7);}catch(_0x4b39c3){console[_0x4e2281(0x1b5)](_0x4e2281(0x1f0)+_0x45ccf8+':',_0x4b39c3);}}async[a42_0x6da1b1(0x183)](_0x2d792b,_0x5a65d4){const _0x43a08c=a42_0x6da1b1;try{const _0x584e18=(await Promise[_0x43a08c(0x1b8)]()[_0x43a08c(0x20a)](()=>__importStar(require(_0x43a08c(0x201)))))['default'],{telegramBotService:_0x466e9d}=await Promise[_0x43a08c(0x1b8)]()[_0x43a08c(0x20a)](()=>__importStar(require(_0x43a08c(0x19e)))),_0x5c62af=await _0x584e18[_0x43a08c(0x193)]['findUnique']({'where':{'id':_0x2d792b},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x5c62af)return;const _0x53d2ab={'PAID':_0x43a08c(0x1f6),'FAILED':_0x43a08c(0x1a8)},_0x59d853=_0x53d2ab[_0x5a65d4];_0x59d853&&await _0x466e9d[_0x43a08c(0x18a)](_0x5c62af[_0x43a08c(0x179)],_0x5c62af,_0x59d853),await this[_0x43a08c(0x15a)](_0x5c62af,_0x5a65d4);}catch(_0x292b57){console[_0x43a08c(0x1b5)](_0x43a08c(0x141),_0x292b57);}}async[a42_0x6da1b1(0x15a)](_0x6af495,_0x18d017){const _0xb27548=a42_0x6da1b1,_0x14a98f=Date['now']();try{const _0x24d2dd=_0x6af495[_0xb27548(0x130)],_0x380560=_0x24d2dd[_0xb27548(0x16f)];if(!_0x380560?.['webhookUrl']){console[_0xb27548(0x13b)](_0xb27548(0x20e)+_0x24d2dd['id']);return;}const _0x2c7e74=_0x18d017==='PAID'?_0xb27548(0x1d2):_0xb27548(0x1c7);let _0x4727f3=[];if(_0x380560['webhookEvents'])try{_0x4727f3=Array[_0xb27548(0x21e)](_0x380560['webhookEvents'])?_0x380560[_0xb27548(0x1d7)]:JSON['parse'](_0x380560[_0xb27548(0x1d7)]);}catch(_0x4ae3ea){console[_0xb27548(0x1b5)](_0xb27548(0x1fc),_0x4ae3ea),_0x4727f3=[];}if(!_0x4727f3[_0xb27548(0x185)](_0x2c7e74)){console[_0xb27548(0x13b)](_0xb27548(0x175)+_0x2c7e74+_0xb27548(0x1ff)+_0x24d2dd['id']);return;}const _0x21ab72={'event':_0x2c7e74,'payment':{'id':_0x6af495['id'],'order_id':_0x6af495[_0xb27548(0x17a)],'gateway_order_id':_0x6af495[_0xb27548(0x1e1)],'gateway':'1111','amount':_0x6af495['amount'],'currency':_0x6af495[_0xb27548(0x14c)],'status':_0x18d017[_0xb27548(0x14f)](),'customer_email':_0x6af495['customerEmail'],'customer_name':_0x6af495[_0xb27548(0x174)],'created_at':_0x6af495[_0xb27548(0x189)],'updated_at':new Date()}},_0x8659eb=await fetch(_0x380560['webhookUrl'],{'method':_0xb27548(0x1ed),'headers':{'Content-Type':'application/json','User-Agent':_0xb27548(0x138)},'body':JSON[_0xb27548(0x1ec)](_0x21ab72)}),_0x2fdf29=Date[_0xb27548(0x1fb)]()-_0x14a98f;loggerService_1[_0xb27548(0x19a)]['logShopWebhookSent'](_0x6af495[_0xb27548(0x179)],_0x380560[_0xb27548(0x1e7)],_0x2c7e74,_0x8659eb[_0xb27548(0x142)],_0x2fdf29,_0x21ab72),console['log']('MasterCard\x20webhook\x20sent\x20to\x20'+_0x380560[_0xb27548(0x1e7)]+'\x20with\x20status\x20'+_0x8659eb[_0xb27548(0x142)]+'\x20('+_0x2fdf29+_0xb27548(0x153));}catch(_0xd6325c){console['error']('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0xd6325c),loggerService_1[_0xb27548(0x19a)][_0xb27548(0x20b)](_0x6af495[_0xb27548(0x179)],_0x6af495[_0xb27548(0x130)]?.[_0xb27548(0x16f)]?.[_0xb27548(0x1e7)]||_0xb27548(0x20c),_0xb27548(0x181),_0xd6325c,{});}}[a42_0x6da1b1(0x19c)](_0xbd02f1){const _0x39b13c=a42_0x6da1b1,_0x5d9243=_0xbd02f1['replace'](/[\s-]/g,'');if(_0x5d9243[_0x39b13c(0x162)]<0x4)return _0x39b13c(0x1d0);return _0x39b13c(0x187)+_0x5d9243['slice'](-0x4);}async[a42_0x6da1b1(0x139)](_0x23be50){const _0xe76370=a42_0x6da1b1;console[_0xe76370(0x13b)](_0xe76370(0x1dc),_0x23be50);let _0x515a58='PENDING';if(_0x23be50[_0xe76370(0x142)]===0x1&&_0x23be50['final']===0x1)_0x515a58=_0xe76370(0x172);else _0x23be50['status']===0x0&&_0x23be50[_0xe76370(0x18d)]===0x0?_0x515a58='PENDING':_0x515a58=_0xe76370(0x1f3);return{'paymentId':_0x23be50['order_id']||'','status':_0x515a58,'amount':_0x23be50[_0xe76370(0x1b0)],'currency':_0x23be50[_0xe76370(0x14c)]};}[a42_0x6da1b1(0x177)](){const _0x4c41b3=a42_0x6da1b1;console[_0x4c41b3(0x13b)](_0x4c41b3(0x16c));const _0x23b0b5=this[_0x4c41b3(0x1a2)][_0x4c41b3(0x148)];for(const [_0x197c89]of this[_0x4c41b3(0x1a2)]){this[_0x4c41b3(0x1dd)](_0x197c89);}console[_0x4c41b3(0x13b)](_0x4c41b3(0x191)+_0x23b0b5+'\x20MasterCard\x20status\x20check\x20timers');}}exports['MasterCardService']=MasterCardService;function a42_0x54f6(){const _0x1065f3=['desc','3DS\x20URL:','HTTP\x20Status:','\x20\x20\x20-\x20lang:\x20en','now','Error\x20parsing\x20webhook\x20events:','key','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','\x20not\x20enabled\x20for\x20shop\x20','sign','../../config/database','getOwnPropertyDescriptor','decryptResponsePhp','adminNotes','readFileSync','HTTP\x20','❌\x20PHP\x20decryptor\x20request\x20failed:','1166019ZyEtKT','Order\x20ID:','then','logShopWebhookError','unknown','none','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','info','call','Unknown\x20error','end','payment_id','Private\x20key\x20file\x20not\x20found:\x20','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','📝\x20Signature\x20length:','HTTP\x20error!\x20status:\x20','),\x20stopping\x20status\x20checks','29036046GOQLUL','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','getOwnPropertyNames','🔐\x20Data\x20encrypted\x20with\x20AES','isArray','TesSoft\x20Payment\x20System/1.0','SHA256','Failed\x20to\x20decrypt\x20response','path','🔐\x20RSA\x20signing\x20successful','Status\x20decryption\x20failed:\x20','\x20result:','shop','last_name','defineProperty','Result\x20URL:','Card\x20Holder:','charge','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','🔐\x20Public\x20key\x20length:\x20','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','processWebhook','__importDefault','log','createDecipheriv','❌\x20RSA\x20encryption\x20failed:','5YnvTLa','8365064rGIAwi','expire_year','Failed\x20to\x20send\x20payment\x20notifications:','status','/charge_decrypted','default','join','\x20\x20\x20-\x20key\x20length:','✅\x20Status\x20response\x20decrypted\x20successfully','size','system','privateDecrypt','✅\x20Scheduled\x20','currency','🔍\x20MasterCard\x20status\x20check\x20#','decryptAES','toLowerCase','create','application/json','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','ms)','10548fBSBHX','\x20\x20\x20-\x20merchant_point_id:','__importStar','/status_decrypted','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','🧹\x20Clearing\x20','sendShopWebhook','33odDAeF','base64','logWhiteDomainError','❌\x20RSA\x20signing\x20failed:','456QUAxyL','processCardPayment','\x20status\x20checks\x20for\x20payment\x20','length','/charge_decrypt','\x20\x20\x20-\x20sign\x20length:','❌\x20Status\x20check\x20#','\x20for\x20payment\x20','MasterCard:\x20','keys','\x20status\x20timers\x20for\x20payment\x20','-----END','🔐\x20AES\x20key\x20length:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','encryptAES','privateKeyPath','settings','__setModuleDefault','first_name','PAID','/status_raw','customerName','Webhook\x20event\x20','mastercard','stopAllStatusChecks','cwd','shopId','orderId','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','7ihvSfL','\x20characters','\x20\x20\x20-\x20info\x20length:','💾\x20Payment\x20data\x20prepared',',\x20Desc:\x20','webhook_send','parse','sendPaymentNotifications','\x20\x20\x20-\x20method:\x20charge','includes','configurable','****\x20****\x20****\x20','floor','createdAt','sendPaymentNotification','📊\x20Status\x20check\x20#','PENDING','final','/charge_raw','json','🔐\x20AES\x20IV\x20length:','🛑\x20Stopped\x20','updatePaymentStatus','payment','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','update','Final:','🔐\x203DS\x20verification\x20required','6590ROxWCJ','loggerService','logWhiteDomainResponse','maskCardNumber','validateKeyFiles','../telegramBotService','Return\x20URL:','text','📝\x20Data\x20to\x20sign\x20length:','statusCheckTimers','scheduleStatusChecks','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','description','Status:','1514vUeofa','failed','date_success','publicKeyPath','signRSA','merchantPointId','aes-256-ctr','apiUrl','generateAESKey','amount','__createBinding','Error\x20details:','number','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','error','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','resolve','https://api2.trapay.uk/decrypt.php','constants','createSign','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','prototype','checkPaymentStatus','RSA_PKCS1_PADDING','delete','encryptRSA','5434098MhuqVB','🔐\x20AES\x20key\x20and\x20IV\x20generated','toUpperCase','from','payment.failed','🔐\x20Private\x20key\x20length:\x20','16rENEyW','toString','❌\x20Data\x20being\x20signed:','get','/charge','createCipheriv','📝\x20Final\x20request\x20structure:','****','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','payment.success','🔐\x20Data\x20signed\x20with\x20RSA','📝\x20Encrypted\x20key\x20length:','📝\x20Encrypted\x20data\x20length:','170664OIXeZI','webhookEvents','expire_month','randomBytes',',\x20body:\x20','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','Processing\x20MasterCard\x20webhook:','clearStatusTimers','set','\x20status\x20updated\x20to\x20','writable','gatewayOrderId','trim','../loggerService','__esModule','3ds_url','-----BEGIN','webhookUrl','existsSync','publicEncrypt','Payment\x20ID:','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','stringify','POST','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','🔐\x20Private\x20key\x20path:','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','\x20is\x20final\x20(','message','FAILED','/status','utf8','paid'];a42_0x54f6=function(){return _0x1065f3;};return a42_0x54f6();}