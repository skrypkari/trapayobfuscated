'use strict';function a42_0x4766(_0x15f3a2,_0x54a12e){const _0x5bf59d=a42_0x5bf5();return a42_0x4766=function(_0x4766b0,_0x3f5132){_0x4766b0=_0x4766b0-0x1a0;let _0x1ece43=_0x5bf59d[_0x4766b0];return _0x1ece43;},a42_0x4766(_0x15f3a2,_0x54a12e);}const a42_0x3f003d=a42_0x4766;(function(_0x51f675,_0x2b68ef){const _0x5432b3=a42_0x4766,_0x216409=_0x51f675();while(!![]){try{const _0x101e07=parseInt(_0x5432b3(0x1a1))/0x1*(parseInt(_0x5432b3(0x1ed))/0x2)+parseInt(_0x5432b3(0x245))/0x3*(parseInt(_0x5432b3(0x25e))/0x4)+parseInt(_0x5432b3(0x1ba))/0x5+-parseInt(_0x5432b3(0x1ca))/0x6*(parseInt(_0x5432b3(0x1e1))/0x7)+-parseInt(_0x5432b3(0x1d0))/0x8+parseInt(_0x5432b3(0x1d2))/0x9+-parseInt(_0x5432b3(0x24a))/0xa;if(_0x101e07===_0x2b68ef)break;else _0x216409['push'](_0x216409['shift']());}catch(_0x282bdb){_0x216409['push'](_0x216409['shift']());}}}(a42_0x5bf5,0xad749));var __createBinding=this&&this[a42_0x3f003d(0x203)]||(Object[a42_0x3f003d(0x1fb)]?function(_0x3eadf7,_0x2ff37a,_0x3b2a3f,_0x359f16){const _0x1fb429=a42_0x3f003d;if(_0x359f16===undefined)_0x359f16=_0x3b2a3f;var _0x5dd990=Object[_0x1fb429(0x250)](_0x2ff37a,_0x3b2a3f);(!_0x5dd990||(_0x1fb429(0x1ff)in _0x5dd990?!_0x2ff37a[_0x1fb429(0x254)]:_0x5dd990['writable']||_0x5dd990[_0x1fb429(0x286)]))&&(_0x5dd990={'enumerable':!![],'get':function(){return _0x2ff37a[_0x3b2a3f];}}),Object[_0x1fb429(0x220)](_0x3eadf7,_0x359f16,_0x5dd990);}:function(_0x3108c9,_0x34da0f,_0x2061f1,_0x51e2d9){if(_0x51e2d9===undefined)_0x51e2d9=_0x2061f1;_0x3108c9[_0x51e2d9]=_0x34da0f[_0x2061f1];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a42_0x3f003d(0x1fb)]?function(_0x317689,_0x5d4cc8){const _0x476de5=a42_0x3f003d;Object[_0x476de5(0x220)](_0x317689,_0x476de5(0x251),{'enumerable':!![],'value':_0x5d4cc8});}:function(_0x221649,_0x258bdf){const _0x5463d1=a42_0x3f003d;_0x221649[_0x5463d1(0x251)]=_0x258bdf;}),__importStar=this&&this['__importStar']||(function(){var _0x547119=function(_0x51e7d0){return _0x547119=Object['getOwnPropertyNames']||function(_0x305ca7){const _0x44ed18=a42_0x4766;var _0x3acdb2=[];for(var _0x2df262 in _0x305ca7)if(Object[_0x44ed18(0x22d)][_0x44ed18(0x20b)][_0x44ed18(0x28e)](_0x305ca7,_0x2df262))_0x3acdb2[_0x3acdb2[_0x44ed18(0x1ec)]]=_0x2df262;return _0x3acdb2;},_0x547119(_0x51e7d0);};return function(_0x132e42){const _0x22a34a=a42_0x4766;if(_0x132e42&&_0x132e42['__esModule'])return _0x132e42;var _0x469ccd={};if(_0x132e42!=null){for(var _0x2c05cd=_0x547119(_0x132e42),_0x353313=0x0;_0x353313<_0x2c05cd[_0x22a34a(0x1ec)];_0x353313++)if(_0x2c05cd[_0x353313]!=='default')__createBinding(_0x469ccd,_0x132e42,_0x2c05cd[_0x353313]);}return __setModuleDefault(_0x469ccd,_0x132e42),_0x469ccd;};}()),__importDefault=this&&this[a42_0x3f003d(0x1b6)]||function(_0x548748){const _0x54988e=a42_0x3f003d;return _0x548748&&_0x548748[_0x54988e(0x254)]?_0x548748:{'default':_0x548748};};Object[a42_0x3f003d(0x220)](exports,a42_0x3f003d(0x254),{'value':!![]}),exports[a42_0x3f003d(0x293)]=void 0x0;function a42_0x5bf5(){const _0x15b23e=['https://api2.trapay.uk/decrypt.php','isArray','SHA256','3gNJtJD','forEach','date_success','error','size','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','❌\x20Data\x20being\x20signed:','❌\x20RSA\x20encryption\x20failed:','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','publicKeyPath','POST','charge','randomBytes','MasterCard\x20status\x20check\x20error:','logShopWebhookSent','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','encryptAES','❌\x20RSA\x20signing\x20failed:','delete','-----BEGIN','createSign','__importDefault','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','encryptRSA','1111','6792445LrSeWL','createdAt','/status_decrypt','cwd','📝\x20Signature\x20length:','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','resolve','\x20\x20\x20-\x20merchant_point_id:','ms)','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','logShopWebhookError','constants','\x20not\x20enabled\x20for\x20shop\x20','🔐\x20Public\x20key\x20path:','\x20\x20\x20-\x20sign\x20length:','✅\x20Payment\x20successful','30FflXav','psp_public.pem','updatePaymentStatus','then',',\x20body:\x20','shop','598912YyFXev','Response\x20Body:','5719059apdJRS','HTTP\x20','payment.failed','❌\x20MasterCard\x20key\x20validation\x20failed:','floor','number','Return\x20URL:','\x20result:','\x20status\x20timers\x20for\x20payment\x20','🔐\x20Public\x20key\x20length:\x20','/charge_decrypted','json','toString','Response\x20Time:','utf8','1902250iNoQyU','/charge_decrypt','base64','application/json','webhookUrl','path','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','3ds_url','key','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','length','120774oKdHBX','keys','📊\x20Status\x20check\x20#','webhook_send','join','Result\x20URL:','decryptResponsePhp','/status_decrypted','PENDING','apiUrl','crypto','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','\x20\x20\x20-\x20key\x20length:','💳\x20MasterCard\x20service\x20initialized','create','🔐\x20AES\x20key\x20and\x20IV\x20generated','desc','scheduleStatusChecks','get','Status\x20decryption\x20failed:\x20','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','signRSA','__createBinding','PAID','\x20\x20\x20-\x20method:\x20charge','clearStatusTimers','Final:','last_name','🔐\x20Data\x20encrypted\x20with\x20AES','findUnique','hasOwnProperty','TesSoft\x20Payment\x20System/1.0','stringify','RSA_PKCS1_PADDING','https://api.paydmeth.com/api','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','🔐\x20Private\x20key\x20length:\x20','privateKeyPath','substring','HTTP\x20Status:','statusCheckTimers','loggerService','✅\x20Payment\x20','mastercard','toUpperCase','💾\x20Payment\x20data\x20prepared','PHP\x20decryptor\x20error','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','trim','Private\x20key\x20file\x20not\x20found:\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','defineProperty','Processing\x20MasterCard\x20webhook:','🔐\x20AES\x20IV\x20length:','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours',',\x20Desc:\x20','Public\x20key\x20file\x20not\x20found:\x20','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','webhookEvents','Unknown\x20error','final','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','/status','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','prototype','decryptAES','Amount:','processWebhook','🔐\x20Private\x20key\x20path:','sendPaymentNotification','logWhiteDomainRequest','push','merchantPointId','info','\x20status\x20checks\x20for\x20payment\x20','⏰\x20Will\x20check\x20status\x20','message','log','🔐\x20AES\x20key\x20length:','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','status','logWhiteDomainResponse','first_name','existsSync','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','-----END','none','checkPaymentStatus','3MOaQUl','\x20characters','cvv','createCipheriv','HTTP\x20error!\x20status:\x20','487050KWeseB','text',',\x20Final:\x20','parse','readFileSync','/charge','getOwnPropertyDescriptor','default','🔐\x20Data\x20signed\x20with\x20RSA','validateKeyFiles','__esModule','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','currency','🔍\x20MasterCard\x20status\x20check\x20#','****','\x20MasterCard\x20status\x20check\x20timers','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','Card\x20Holder:','FAILED','Decryption\x20failed:\x20','70764TLdffU','📝\x20Encrypted\x20data\x20length:','/charge_raw','settings','Failed\x20to\x20decrypt\x20response','paidAt','❌\x20Status\x20check\x20#','paid','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','aes-256-ctr','set','Error\x20details:','end','../../config/database','\x20is\x20final\x20(','orderId','sign','payment_id','system','now','...','✅\x20Scheduled\x20','unknown','📝\x20Data\x20to\x20sign\x20length:','Order\x20ID:','Payment\x20ID:','stopAllStatusChecks','from','\x20for\x20payment\x20','sendShopWebhook','toLowerCase','generateAESKey','maskCardNumber','../loggerService','expire_month','Status:','processCardPayment','📝\x20Final\x20request\x20structure:','description','\x20\x20\x20-\x20info\x20length:','configurable','Webhook\x20event\x20','\x20with\x20status\x20','gatewayOrderId','\x20status\x20updated\x20to\x20','logWhiteDomainError','Failed\x20to\x20send\x20payment\x20notifications:','decryptResponse','call','****\x20****\x20****\x20','MasterCard:\x20','),\x20stopping\x20status\x20checks','amount','MasterCardService','update','✅\x20Status\x20response\x20decrypted\x20successfully','includes','🧹\x20Clearing\x20'];a42_0x5bf5=function(){return _0x15b23e;};return a42_0x5bf5();}const crypto_1=__importDefault(require(a42_0x3f003d(0x1f7))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x3f003d(0x1e6))),loggerService_1=require(a42_0x3f003d(0x27f));class MasterCardService{constructor(){const _0x2f0a29=a42_0x3f003d;this[_0x2f0a29(0x215)]=new Map(),this[_0x2f0a29(0x1f6)]=_0x2f0a29(0x20f),this[_0x2f0a29(0x235)]=0x67c,this['privateKeyPath']=path_1['default']['join'](process[_0x2f0a29(0x1bd)](),'keys','private.pem'),this['publicKeyPath']=path_1['default'][_0x2f0a29(0x1f1)](process[_0x2f0a29(0x1bd)](),_0x2f0a29(0x1ee),_0x2f0a29(0x1cb)),console[_0x2f0a29(0x23a)](_0x2f0a29(0x1fa)),console[_0x2f0a29(0x23a)](_0x2f0a29(0x231),this[_0x2f0a29(0x212)]),console['log'](_0x2f0a29(0x1c7),this[_0x2f0a29(0x1aa)]),this[_0x2f0a29(0x253)]();}['validateKeyFiles'](){const _0x872e3d=a42_0x3f003d;try{if(!fs_1[_0x872e3d(0x251)][_0x872e3d(0x240)](this[_0x872e3d(0x212)]))throw new Error(_0x872e3d(0x21e)+this[_0x872e3d(0x212)]);if(!fs_1['default']['existsSync'](this['publicKeyPath']))throw new Error(_0x872e3d(0x225)+this[_0x872e3d(0x1aa)]);const _0x4c32d7=fs_1[_0x872e3d(0x251)][_0x872e3d(0x24e)](this[_0x872e3d(0x212)],_0x872e3d(0x1e0))[_0x872e3d(0x21d)](),_0x240ed1=fs_1[_0x872e3d(0x251)]['readFileSync'](this[_0x872e3d(0x1aa)],_0x872e3d(0x1e0))[_0x872e3d(0x21d)]();if(!_0x4c32d7[_0x872e3d(0x296)](_0x872e3d(0x1b4))||!_0x4c32d7['includes'](_0x872e3d(0x242)))throw new Error(_0x872e3d(0x1f8));if(!_0x240ed1['includes'](_0x872e3d(0x1b4))||!_0x240ed1[_0x872e3d(0x296)](_0x872e3d(0x242)))throw new Error(_0x872e3d(0x1b0));console['log'](_0x872e3d(0x1eb)),console[_0x872e3d(0x23a)](_0x872e3d(0x211)+_0x4c32d7[_0x872e3d(0x1ec)]+_0x872e3d(0x246)),console[_0x872e3d(0x23a)](_0x872e3d(0x1db)+_0x240ed1[_0x872e3d(0x1ec)]+_0x872e3d(0x246));}catch(_0x40b283){console['error'](_0x872e3d(0x1d5),_0x40b283);throw _0x40b283;}}[a42_0x3f003d(0x27d)](){const _0x46f000=a42_0x3f003d,_0x50d3d1=crypto_1[_0x46f000(0x251)]['randomBytes'](0x20),_0x269cae=crypto_1[_0x46f000(0x251)][_0x46f000(0x1ad)](0x10);return{'key':_0x50d3d1,'iv':_0x269cae};}[a42_0x3f003d(0x1b1)](_0xc1658f,_0x3947fc,_0x16a4c5){const _0x3f45ac=a42_0x3f003d,_0x30379d=crypto_1[_0x3f45ac(0x251)][_0x3f45ac(0x248)](_0x3f45ac(0x267),_0x3947fc,_0x16a4c5);let _0x4d6b45=_0x30379d['update'](_0xc1658f,_0x3f45ac(0x1e0),_0x3f45ac(0x1e3));return _0x4d6b45+=_0x30379d[_0x3f45ac(0x229)](_0x3f45ac(0x1e3)),_0x4d6b45;}[a42_0x3f003d(0x1b8)](_0x39802b,_0x3bedaa){const _0x2067db=a42_0x3f003d;try{const _0x5e131e=fs_1[_0x2067db(0x251)][_0x2067db(0x24e)](this[_0x2067db(0x1aa)],'utf8')[_0x2067db(0x21d)](),_0x43e08e={'iv':_0x3bedaa[_0x2067db(0x1de)](_0x2067db(0x1e3)),'key':_0x39802b[_0x2067db(0x1de)]('base64')},_0x4a3560=JSON[_0x2067db(0x20d)](_0x43e08e);console[_0x2067db(0x23a)](_0x2067db(0x201),_0x4a3560['length']);const _0x41e15a=crypto_1[_0x2067db(0x251)]['publicEncrypt']({'key':_0x5e131e,'padding':crypto_1['default'][_0x2067db(0x1c5)][_0x2067db(0x20e)]},Buffer[_0x2067db(0x279)](_0x4a3560));return console[_0x2067db(0x23a)]('✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x41e15a[_0x2067db(0x1ec)]),_0x41e15a['toString']('base64');}catch(_0x4d79e6){console[_0x2067db(0x1a4)](_0x2067db(0x1a8),_0x4d79e6);throw new Error(_0x2067db(0x1a6));}}[a42_0x3f003d(0x202)](_0x1c8fdf){const _0x31c82b=a42_0x3f003d;try{const _0x5953e9=fs_1[_0x31c82b(0x251)]['readFileSync'](this[_0x31c82b(0x212)],'utf8')['trim'](),_0x24be92=crypto_1['default'][_0x31c82b(0x1b5)](_0x31c82b(0x1a0));_0x24be92[_0x31c82b(0x294)](_0x1c8fdf),_0x24be92[_0x31c82b(0x26a)]();const _0x479b87=_0x24be92[_0x31c82b(0x26e)](_0x5953e9,_0x31c82b(0x1e3));return console['log']('🔐\x20RSA\x20signing\x20successful'),console['log'](_0x31c82b(0x275),_0x1c8fdf[_0x31c82b(0x1ec)]),console[_0x31c82b(0x23a)]('📝\x20Signature\x20length:',_0x479b87['length']),_0x479b87;}catch(_0x28674e){console['error'](_0x31c82b(0x1b2),_0x28674e),console[_0x31c82b(0x1a4)](_0x31c82b(0x1a7),_0x1c8fdf[_0x31c82b(0x213)](0x0,0xc8)+_0x31c82b(0x272));throw new Error(_0x31c82b(0x1e7));}}['decryptAES'](_0x1f7303,_0x457c9a,_0x2d9194){const _0xa6d4bd=a42_0x3f003d,_0x4e0e99=crypto_1[_0xa6d4bd(0x251)]['createDecipheriv'](_0xa6d4bd(0x267),_0x457c9a,_0x2d9194);let _0x5a1dbb=_0x4e0e99[_0xa6d4bd(0x294)](_0x1f7303,_0xa6d4bd(0x1e3),_0xa6d4bd(0x1e0));return _0x5a1dbb+=_0x4e0e99[_0xa6d4bd(0x229)](_0xa6d4bd(0x1e0)),_0x5a1dbb;}async[a42_0x3f003d(0x1f3)](_0x1c29e6,_0x482ffb){const _0xfd120b=a42_0x3f003d;try{const _0x1e030b=await fetch(_0xfd120b(0x298),{'method':'POST','headers':{'Content-Type':_0xfd120b(0x1e4)},'body':JSON['stringify']({'info':_0x1c29e6,'key':_0x482ffb})});if(!_0x1e030b['ok'])throw new Error(_0xfd120b(0x21b));return await _0x1e030b[_0xfd120b(0x24b)]();}catch(_0x2af9ff){console['error']('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x2af9ff);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a42_0x3f003d(0x28d)](_0x1348da,_0x17bf20){const _0xd6ac14=a42_0x3f003d;try{const _0x2ecf3f=fs_1[_0xd6ac14(0x251)][_0xd6ac14(0x24e)](this['privateKeyPath'],'utf8')['trim'](),_0x39d52c=crypto_1[_0xd6ac14(0x251)]['privateDecrypt'](_0x2ecf3f,Buffer['from'](_0x17bf20,_0xd6ac14(0x1e3))),_0x38c7d0=JSON[_0xd6ac14(0x24d)](_0x39d52c[_0xd6ac14(0x1de)]()),_0x3405b9=Buffer[_0xd6ac14(0x279)](_0x38c7d0[_0xd6ac14(0x1ea)],_0xd6ac14(0x1e3)),_0x1ae61d=Buffer['from'](_0x38c7d0['iv'],_0xd6ac14(0x1e3));return this[_0xd6ac14(0x22e)](_0x1348da,_0x3405b9,_0x1ae61d);}catch(_0x8ed937){throw new Error(_0xd6ac14(0x262));}}async[a42_0x3f003d(0x282)](_0x2be083){const _0x43a0a9=a42_0x3f003d,{paymentId:_0xbfcd,orderId:_0x36dc09,amount:_0x459d6a,currency:_0x31d00a,cardData:_0x3af0e2,resultUrl:_0x3b576a,returnUrl:_0x1280ff,cardHolder:_0x120cf7,browser:_0x2b49f0}=_0x2be083;console['log']('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x43a0a9(0x23a)](_0x43a0a9(0x277),_0xbfcd),console[_0x43a0a9(0x23a)](_0x43a0a9(0x276),_0x36dc09),console[_0x43a0a9(0x23a)](_0x43a0a9(0x22f),_0x459d6a,_0x31d00a),console['log']('Card\x20Number:',this['maskCardNumber'](_0x3af0e2[_0x43a0a9(0x1d7)])),console[_0x43a0a9(0x23a)](_0x43a0a9(0x25b),_0x120cf7[_0x43a0a9(0x23f)]+'\x20'+_0x120cf7[_0x43a0a9(0x208)]),console[_0x43a0a9(0x23a)](_0x43a0a9(0x1d8),_0x1280ff),console[_0x43a0a9(0x23a)](_0x43a0a9(0x1f2),_0x3b576a);const _0x2ea81d={'amount':_0x459d6a,'currency':_0x31d00a[_0x43a0a9(0x219)](),'order_id':_0x36dc09,'result_url':_0x3b576a,'return_url':_0x1280ff,'card':{'number':_0x3af0e2[_0x43a0a9(0x1d7)],'expire_month':_0x3af0e2[_0x43a0a9(0x280)],'expire_year':_0x3af0e2['expire_year'],'cvv':_0x3af0e2[_0x43a0a9(0x247)]},'card_holder':_0x120cf7,'browser':_0x2b49f0},_0x1f8ea8=JSON[_0x43a0a9(0x20d)](_0x2ea81d);console[_0x43a0a9(0x23a)](_0x43a0a9(0x21a)),console[_0x43a0a9(0x23a)](_0x43a0a9(0x1c3)),console[_0x43a0a9(0x23a)](_0x1f8ea8),console[_0x43a0a9(0x23a)]('📝\x20Data\x20length:',_0x1f8ea8['length']);try{const {key:_0x48361e,iv:_0xf817f4}=this[_0x43a0a9(0x27d)]();console[_0x43a0a9(0x23a)](_0x43a0a9(0x1fc)),console['log'](_0x43a0a9(0x23b),_0x48361e[_0x43a0a9(0x1ec)]),console[_0x43a0a9(0x23a)](_0x43a0a9(0x222),_0xf817f4['length']);const _0x35f680=this[_0x43a0a9(0x1b1)](_0x1f8ea8,_0x48361e,_0xf817f4);console[_0x43a0a9(0x23a)](_0x43a0a9(0x209)),console['log'](_0x43a0a9(0x25f),_0x35f680['length']);const _0x9422ca=this[_0x43a0a9(0x1b8)](_0x48361e,_0xf817f4);console[_0x43a0a9(0x23a)](_0x43a0a9(0x22c)),console[_0x43a0a9(0x23a)]('📝\x20Encrypted\x20key\x20length:',_0x9422ca[_0x43a0a9(0x1ec)]);const _0x16f345=this[_0x43a0a9(0x202)](_0x1f8ea8);console['log'](_0x43a0a9(0x252)),console['log'](_0x43a0a9(0x1be),_0x16f345[_0x43a0a9(0x1ec)]);const _0x230482={'merchant_point_id':this['merchantPointId'],'method':_0x43a0a9(0x1ac),'info':_0x35f680,'key':_0x9422ca,'sign':_0x16f345,'lang':'en'};console['log'](_0x43a0a9(0x22a)),console[_0x43a0a9(0x23a)](_0x43a0a9(0x283)),console[_0x43a0a9(0x23a)](_0x43a0a9(0x1c1),this[_0x43a0a9(0x235)]),console[_0x43a0a9(0x23a)](_0x43a0a9(0x205)),console[_0x43a0a9(0x23a)](_0x43a0a9(0x285),_0x35f680['length']),console[_0x43a0a9(0x23a)](_0x43a0a9(0x1f9),_0x9422ca[_0x43a0a9(0x1ec)]),console[_0x43a0a9(0x23a)](_0x43a0a9(0x1c8),_0x16f345[_0x43a0a9(0x1ec)]),console[_0x43a0a9(0x23a)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x43a0a9(0x218),_0x43a0a9(0x24f),_0x43a0a9(0x1ab),{'merchant_point_id':this['merchantPointId'],'method':'charge','lang':'en'});const _0x1d015c=Date[_0x43a0a9(0x271)](),_0x4110fd=await fetch(this[_0x43a0a9(0x1f6)],{'method':_0x43a0a9(0x1ab),'headers':{'Content-Type':_0x43a0a9(0x1e4),'Accept':_0x43a0a9(0x1e4),'User-Agent':_0x43a0a9(0x20c)},'body':JSON[_0x43a0a9(0x20d)](_0x230482)}),_0x5759f3=Date[_0x43a0a9(0x271)]()-_0x1d015c;console[_0x43a0a9(0x23a)]('===\x20MASTERCARD\x20API\x20RESPONSE\x20==='),console[_0x43a0a9(0x23a)](_0x43a0a9(0x281),_0x4110fd[_0x43a0a9(0x23d)]),console[_0x43a0a9(0x23a)](_0x43a0a9(0x1df),_0x5759f3+'ms');if(!_0x4110fd['ok']){const _0x5ccd73=await _0x4110fd['text']();console[_0x43a0a9(0x1a4)](_0x43a0a9(0x214),_0x4110fd[_0x43a0a9(0x23d)]),console[_0x43a0a9(0x1a4)](_0x43a0a9(0x1d1),_0x5ccd73),loggerService_1[_0x43a0a9(0x216)][_0x43a0a9(0x23e)](_0x43a0a9(0x218),'/charge_raw',_0x4110fd['status'],_0x5ccd73,_0x5759f3),loggerService_1['loggerService'][_0x43a0a9(0x28b)](_0x43a0a9(0x218),_0x43a0a9(0x24f),_0x43a0a9(0x1d3)+_0x4110fd[_0x43a0a9(0x23d)]+':\x20'+_0x5ccd73);throw new Error(_0x43a0a9(0x249)+_0x4110fd[_0x43a0a9(0x23d)]+_0x43a0a9(0x1ce)+_0x5ccd73);}const _0x1428a9=await _0x4110fd[_0x43a0a9(0x1dd)]();loggerService_1[_0x43a0a9(0x216)][_0x43a0a9(0x23e)](_0x43a0a9(0x218),_0x43a0a9(0x260),_0x4110fd['status'],_0x1428a9,_0x5759f3),console[_0x43a0a9(0x23a)](_0x43a0a9(0x1e8));let _0x2755d2=_0x1428a9;if(_0x1428a9[_0x43a0a9(0x236)]&&_0x1428a9['key']&&_0x1428a9['sign']){console[_0x43a0a9(0x23a)]('🔐\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x1ca903=await this[_0x43a0a9(0x1f3)](_0x1428a9[_0x43a0a9(0x236)],_0x1428a9[_0x43a0a9(0x1ea)]);_0x2755d2=JSON[_0x43a0a9(0x24d)](_0x1ca903),console[_0x43a0a9(0x23a)](_0x43a0a9(0x255)),loggerService_1[_0x43a0a9(0x216)]['logWhiteDomainResponse'](_0x43a0a9(0x218),'/charge_decrypted',_0x4110fd['status'],_0x2755d2,_0x5759f3),console[_0x43a0a9(0x23a)](_0x43a0a9(0x23c));}catch(_0x2b08f9){console[_0x43a0a9(0x1a4)](_0x43a0a9(0x1a9),_0x2b08f9),loggerService_1[_0x43a0a9(0x216)][_0x43a0a9(0x28b)](_0x43a0a9(0x218),_0x43a0a9(0x1e2),_0x43a0a9(0x25d)+_0x2b08f9),_0x2755d2=_0x1428a9;}}else loggerService_1[_0x43a0a9(0x216)][_0x43a0a9(0x23e)](_0x43a0a9(0x218),_0x43a0a9(0x1dc),_0x4110fd['status'],_0x2755d2,_0x5759f3),console[_0x43a0a9(0x23a)](_0x43a0a9(0x241));console[_0x43a0a9(0x23a)](_0x43a0a9(0x281),_0x2755d2[_0x43a0a9(0x23d)]),console['log'](_0x43a0a9(0x207),_0x2755d2[_0x43a0a9(0x229)]),console[_0x43a0a9(0x23a)]('Payment\x20ID:',_0x2755d2[_0x43a0a9(0x26f)]),console[_0x43a0a9(0x23a)]('3DS\x20URL:',_0x2755d2[_0x43a0a9(0x1e9)]||_0x43a0a9(0x243));if(_0x2755d2[_0x43a0a9(0x23d)]===0x64&&_0x2755d2[_0x43a0a9(0x229)]===0x1)return console[_0x43a0a9(0x23a)](_0x43a0a9(0x1c9)),{'gateway_payment_id':_0x2755d2[_0x43a0a9(0x26f)]?.['toString'](),'payment_url':_0x1280ff,'requires_3ds':![],'status':_0x43a0a9(0x204),'final':!![]};if(_0x2755d2['3ds_url'])return console[_0x43a0a9(0x23a)]('🔐\x203DS\x20verification\x20required'),this[_0x43a0a9(0x1fe)](_0xbfcd,_0x36dc09,_0x2755d2[_0x43a0a9(0x26f)]?.['toString']()||_0x36dc09),{'gateway_payment_id':_0x2755d2[_0x43a0a9(0x26f)]?.[_0x43a0a9(0x1de)](),'payment_url':_0x2755d2[_0x43a0a9(0x1e9)],'requires_3ds':!![],'threeds_url':_0x2755d2['3ds_url'],'status':_0x43a0a9(0x1f5),'final':![]};let _0x4979ee=_0x2755d2['desc']||_0x2755d2['message']||_0x43a0a9(0x228),_0x190d4b=_0x2755d2[_0x43a0a9(0x23d)],_0x2d959c=_0x2755d2[_0x43a0a9(0x229)];return console['log']('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x190d4b+_0x43a0a9(0x24c)+_0x2d959c+_0x43a0a9(0x224)+_0x4979ee),{'gateway_payment_id':_0x2755d2['payment_id']?.[_0x43a0a9(0x1de)](),'payment_url':_0x1280ff,'requires_3ds':![],'status':_0x43a0a9(0x25c),'final':!![]};}catch(_0x172d5c){console[_0x43a0a9(0x1a4)](_0x43a0a9(0x1bf)),console[_0x43a0a9(0x1a4)](_0x43a0a9(0x269),_0x172d5c),loggerService_1[_0x43a0a9(0x216)][_0x43a0a9(0x28b)](_0x43a0a9(0x218),'/charge',_0x172d5c);throw new Error(_0x43a0a9(0x1b7)+(_0x172d5c instanceof Error?_0x172d5c['message']:_0x43a0a9(0x228)));}}async[a42_0x3f003d(0x244)](_0x3bd1ca,_0x541f26){const _0x11ef95=a42_0x3f003d;console[_0x11ef95(0x23a)]('📊\x20Checking\x20MasterCard\x20payment\x20status:\x20'+_0x3bd1ca+'\x20('+_0x541f26+')');try{const _0x35f3d5={'payment_id':_0x3bd1ca,'order_id':_0x541f26},_0x3d3235=JSON[_0x11ef95(0x20d)](_0x35f3d5),{key:_0x50432b,iv:_0x198be4}=this[_0x11ef95(0x27d)](),_0x510133=this[_0x11ef95(0x1b1)](_0x3d3235,_0x50432b,_0x198be4),_0x535329=this[_0x11ef95(0x1b8)](_0x50432b,_0x198be4),_0x139670=this['signRSA'](_0x3d3235),_0xbee110={'merchant_point_id':this[_0x11ef95(0x235)],'method':_0x11ef95(0x23d),'info':_0x510133,'key':_0x535329,'sign':_0x139670,'lang':'en'};loggerService_1[_0x11ef95(0x216)][_0x11ef95(0x233)](_0x11ef95(0x218),'/status','POST',{'merchant_point_id':this[_0x11ef95(0x235)],'method':_0x11ef95(0x23d),'lang':'en'});const _0x2e3e80=Date[_0x11ef95(0x271)](),_0x433c2d=await fetch(this[_0x11ef95(0x1f6)],{'method':_0x11ef95(0x1ab),'headers':{'Content-Type':_0x11ef95(0x1e4),'Accept':_0x11ef95(0x1e4),'User-Agent':_0x11ef95(0x20c)},'body':JSON[_0x11ef95(0x20d)](_0xbee110)}),_0x4fe052=Date[_0x11ef95(0x271)]()-_0x2e3e80;if(!_0x433c2d['ok']){const _0x466d69=await _0x433c2d[_0x11ef95(0x24b)]();loggerService_1['loggerService'][_0x11ef95(0x23e)](_0x11ef95(0x218),'/status_raw',_0x433c2d[_0x11ef95(0x23d)],_0x466d69,_0x4fe052);throw new Error(_0x11ef95(0x249)+_0x433c2d[_0x11ef95(0x23d)]);}const _0x15a146=await _0x433c2d[_0x11ef95(0x1dd)]();loggerService_1[_0x11ef95(0x216)][_0x11ef95(0x23e)](_0x11ef95(0x218),'/status_raw',_0x433c2d[_0x11ef95(0x23d)],_0x15a146,_0x4fe052);let _0x29ddef=_0x15a146;if(_0x15a146[_0x11ef95(0x236)]&&_0x15a146[_0x11ef95(0x1ea)]&&_0x15a146[_0x11ef95(0x26e)]){console[_0x11ef95(0x23a)](_0x11ef95(0x226));try{const _0x1c0f9d=this['decryptResponse'](_0x15a146[_0x11ef95(0x236)],_0x15a146[_0x11ef95(0x1ea)]);_0x29ddef=JSON[_0x11ef95(0x24d)](_0x1c0f9d),console[_0x11ef95(0x23a)](_0x11ef95(0x295)),loggerService_1['loggerService'][_0x11ef95(0x23e)](_0x11ef95(0x218),_0x11ef95(0x1f4),_0x433c2d['status'],_0x29ddef,_0x4fe052),console['log'](_0x11ef95(0x266));}catch(_0x94bc11){console[_0x11ef95(0x1a4)]('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x94bc11),loggerService_1[_0x11ef95(0x216)]['logWhiteDomainError'](_0x11ef95(0x218),_0x11ef95(0x1bc),_0x11ef95(0x200)+_0x94bc11),_0x29ddef=_0x15a146;}}else loggerService_1[_0x11ef95(0x216)][_0x11ef95(0x23e)](_0x11ef95(0x218),_0x11ef95(0x1f4),_0x433c2d[_0x11ef95(0x23d)],_0x29ddef,_0x4fe052),console['log']('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console['log']('📊\x20Status\x20check\x20result:',{'status':_0x29ddef[_0x11ef95(0x23d)],'final':_0x29ddef[_0x11ef95(0x229)],'payment_id':_0x29ddef[_0x11ef95(0x26f)],'desc':_0x29ddef['desc']});let _0x292c9e=_0x11ef95(0x1f5);if(_0x29ddef[_0x11ef95(0x23d)]===0x1&&_0x29ddef[_0x11ef95(0x229)]===0x1)_0x292c9e=_0x11ef95(0x204);else _0x29ddef[_0x11ef95(0x23d)]===0x0&&_0x29ddef[_0x11ef95(0x229)]===0x0?_0x292c9e='PENDING':_0x292c9e='FAILED';return{'status':_0x292c9e,'final':_0x29ddef[_0x11ef95(0x229)]===0x1,'amount':_0x29ddef[_0x11ef95(0x292)],'currency':_0x29ddef[_0x11ef95(0x256)],'date_success':_0x29ddef[_0x11ef95(0x1a3)],'description':_0x29ddef[_0x11ef95(0x1fd)]};}catch(_0xd283fe){console[_0x11ef95(0x1a4)](_0x11ef95(0x1ae),_0xd283fe),loggerService_1[_0x11ef95(0x216)]['logWhiteDomainError'](_0x11ef95(0x218),_0x11ef95(0x22b),_0xd283fe);throw new Error(_0x11ef95(0x21c)+(_0xd283fe instanceof Error?_0xd283fe[_0x11ef95(0x239)]:_0x11ef95(0x228)));}}['scheduleStatusChecks'](_0x523615,_0x466720,_0x428fa1){const _0x5dbc68=a42_0x3f003d;console[_0x5dbc68(0x23a)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0x523615+'\x20('+_0x428fa1+')'),this[_0x5dbc68(0x206)](_0x523615);const _0x4bc6ea=[],_0xa0f62c=0x5*0x3c*0x3e8,_0x3358f4=0x2*0x3c*0x3c*0x3e8,_0x25647e=Math[_0x5dbc68(0x1d6)](_0x3358f4/_0xa0f62c);console[_0x5dbc68(0x23a)](_0x5dbc68(0x238)+_0x25647e+_0x5dbc68(0x223));for(let _0x505b1c=0x1;_0x505b1c<=_0x25647e;_0x505b1c++){const _0x59c67a=setTimeout(async()=>{const _0x3e69e4=_0x5dbc68;console['log'](_0x3e69e4(0x257)+_0x505b1c+'/'+_0x25647e+_0x3e69e4(0x27a)+_0x523615);try{const _0x42a852=await this[_0x3e69e4(0x244)](_0x428fa1,_0x466720);console[_0x3e69e4(0x23a)](_0x3e69e4(0x1ef)+_0x505b1c+_0x3e69e4(0x1d9),_0x42a852),_0x42a852[_0x3e69e4(0x229)]&&(console[_0x3e69e4(0x23a)](_0x3e69e4(0x217)+_0x523615+_0x3e69e4(0x26c)+_0x42a852['status']+_0x3e69e4(0x291)),this[_0x3e69e4(0x206)](_0x523615),await this[_0x3e69e4(0x1cc)](_0x523615,_0x42a852[_0x3e69e4(0x23d)],_0x42a852));}catch(_0x2823b9){console[_0x3e69e4(0x1a4)](_0x3e69e4(0x264)+_0x505b1c+'\x20failed\x20for\x20payment\x20'+_0x523615+':',_0x2823b9);}},_0x505b1c*_0xa0f62c);_0x4bc6ea[_0x5dbc68(0x234)](_0x59c67a);}this[_0x5dbc68(0x215)][_0x5dbc68(0x268)](_0x523615,_0x4bc6ea),console[_0x5dbc68(0x23a)](_0x5dbc68(0x273)+_0x25647e+_0x5dbc68(0x237)+_0x523615);}['clearStatusTimers'](_0x2453cc){const _0x2411f0=a42_0x3f003d,_0x4e455b=this[_0x2411f0(0x215)][_0x2411f0(0x1ff)](_0x2453cc);_0x4e455b&&(console['log'](_0x2411f0(0x297)+_0x4e455b[_0x2411f0(0x1ec)]+_0x2411f0(0x1da)+_0x2453cc),_0x4e455b[_0x2411f0(0x1a2)]((_0x15fd28,_0x1eda80)=>{clearTimeout(_0x15fd28);}),this[_0x2411f0(0x215)][_0x2411f0(0x1b3)](_0x2453cc));}async[a42_0x3f003d(0x1cc)](_0x8ec0cf,_0x476041,_0x1eb463){const _0x4021c7=a42_0x3f003d;try{const _0x46bb02=(await Promise['resolve']()[_0x4021c7(0x1cd)](()=>__importStar(require(_0x4021c7(0x26b)))))[_0x4021c7(0x251)],_0x318e92={'status':_0x476041['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x4021c7(0x270),'statusChangedAt':new Date()};_0x476041===_0x4021c7(0x204)&&(_0x318e92[_0x4021c7(0x263)]=new Date()),_0x1eb463['description']&&(_0x318e92['adminNotes']=_0x4021c7(0x290)+_0x1eb463[_0x4021c7(0x284)]),await _0x46bb02['payment'][_0x4021c7(0x294)]({'where':{'id':_0x8ec0cf},'data':_0x318e92}),console[_0x4021c7(0x23a)]('✅\x20Payment\x20'+_0x8ec0cf+_0x4021c7(0x28a)+_0x476041),await this['sendPaymentNotifications'](_0x8ec0cf,_0x476041);}catch(_0x4f0847){console[_0x4021c7(0x1a4)](_0x4021c7(0x210)+_0x8ec0cf+':',_0x4f0847);}}async['sendPaymentNotifications'](_0x27a7bc,_0x24910a){const _0xc7e808=a42_0x3f003d;try{const _0xbeaebe=(await Promise[_0xc7e808(0x1c0)]()[_0xc7e808(0x1cd)](()=>__importStar(require(_0xc7e808(0x26b)))))[_0xc7e808(0x251)],{telegramBotService:_0x14461d}=await Promise['resolve']()[_0xc7e808(0x1cd)](()=>__importStar(require('../telegramBotService'))),_0xae6869=await _0xbeaebe['payment'][_0xc7e808(0x20a)]({'where':{'id':_0x27a7bc},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0xae6869)return;const _0x47078f={'PAID':_0xc7e808(0x265),'FAILED':'failed'},_0x560d7b=_0x47078f[_0x24910a];_0x560d7b&&await _0x14461d[_0xc7e808(0x232)](_0xae6869['shopId'],_0xae6869,_0x560d7b),await this['sendShopWebhook'](_0xae6869,_0x24910a);}catch(_0x4526fe){console[_0xc7e808(0x1a4)](_0xc7e808(0x28c),_0x4526fe);}}async[a42_0x3f003d(0x27b)](_0x2aa877,_0x3e58c2){const _0x2499fb=a42_0x3f003d,_0x3c2084=Date[_0x2499fb(0x271)]();try{const _0x36c1c6=_0x2aa877[_0x2499fb(0x1cf)],_0x4ef7c7=_0x36c1c6[_0x2499fb(0x261)];if(!_0x4ef7c7?.[_0x2499fb(0x1e5)]){console['log'](_0x2499fb(0x21f)+_0x36c1c6['id']);return;}const _0x374f98=_0x3e58c2==='PAID'?'payment.success':_0x2499fb(0x1d4);let _0x348e11=[];if(_0x4ef7c7[_0x2499fb(0x227)])try{_0x348e11=Array[_0x2499fb(0x299)](_0x4ef7c7[_0x2499fb(0x227)])?_0x4ef7c7[_0x2499fb(0x227)]:JSON[_0x2499fb(0x24d)](_0x4ef7c7[_0x2499fb(0x227)]);}catch(_0x2266eb){console[_0x2499fb(0x1a4)]('Error\x20parsing\x20webhook\x20events:',_0x2266eb),_0x348e11=[];}if(!_0x348e11[_0x2499fb(0x296)](_0x374f98)){console[_0x2499fb(0x23a)](_0x2499fb(0x287)+_0x374f98+_0x2499fb(0x1c6)+_0x36c1c6['id']);return;}const _0x230aae={'event':_0x374f98,'payment':{'id':_0x2aa877['id'],'order_id':_0x2aa877[_0x2499fb(0x26d)],'gateway_order_id':_0x2aa877[_0x2499fb(0x289)],'gateway':_0x2499fb(0x1b9),'amount':_0x2aa877[_0x2499fb(0x292)],'currency':_0x2aa877[_0x2499fb(0x256)],'status':_0x3e58c2[_0x2499fb(0x27c)](),'customer_email':_0x2aa877['customerEmail'],'customer_name':_0x2aa877['customerName'],'created_at':_0x2aa877[_0x2499fb(0x1bb)],'updated_at':new Date()}},_0x2e6ac1=await fetch(_0x4ef7c7[_0x2499fb(0x1e5)],{'method':_0x2499fb(0x1ab),'headers':{'Content-Type':_0x2499fb(0x1e4),'User-Agent':_0x2499fb(0x25a)},'body':JSON['stringify'](_0x230aae)}),_0x5cb137=Date[_0x2499fb(0x271)]()-_0x3c2084;loggerService_1[_0x2499fb(0x216)][_0x2499fb(0x1af)](_0x2aa877['shopId'],_0x4ef7c7[_0x2499fb(0x1e5)],_0x374f98,_0x2e6ac1['status'],_0x5cb137,_0x230aae),console['log']('MasterCard\x20webhook\x20sent\x20to\x20'+_0x4ef7c7[_0x2499fb(0x1e5)]+_0x2499fb(0x288)+_0x2e6ac1['status']+'\x20('+_0x5cb137+_0x2499fb(0x1c2));}catch(_0x4e2e45){console[_0x2499fb(0x1a4)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x4e2e45),loggerService_1[_0x2499fb(0x216)][_0x2499fb(0x1c4)](_0x2aa877['shopId'],_0x2aa877[_0x2499fb(0x1cf)]?.['settings']?.[_0x2499fb(0x1e5)]||_0x2499fb(0x274),_0x2499fb(0x1f0),_0x4e2e45,{});}}[a42_0x3f003d(0x27e)](_0x3d79a4){const _0x3ba6c3=a42_0x3f003d,_0x3c583a=_0x3d79a4['replace'](/[\s-]/g,'');if(_0x3c583a[_0x3ba6c3(0x1ec)]<0x4)return _0x3ba6c3(0x258);return _0x3ba6c3(0x28f)+_0x3c583a['slice'](-0x4);}async[a42_0x3f003d(0x230)](_0x50a4fd){const _0xea69aa=a42_0x3f003d;console[_0xea69aa(0x23a)](_0xea69aa(0x221),_0x50a4fd);let _0x2ae96c=_0xea69aa(0x1f5);if(_0x50a4fd[_0xea69aa(0x23d)]===0x1&&_0x50a4fd[_0xea69aa(0x229)]===0x1)_0x2ae96c=_0xea69aa(0x204);else _0x50a4fd[_0xea69aa(0x23d)]===0x0&&_0x50a4fd[_0xea69aa(0x229)]===0x0?_0x2ae96c=_0xea69aa(0x1f5):_0x2ae96c=_0xea69aa(0x25c);return{'paymentId':_0x50a4fd['order_id']||'','status':_0x2ae96c,'amount':_0x50a4fd['amount'],'currency':_0x50a4fd[_0xea69aa(0x256)]};}[a42_0x3f003d(0x278)](){const _0xea24a4=a42_0x3f003d;console[_0xea24a4(0x23a)]('🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...');const _0x456cd8=this[_0xea24a4(0x215)][_0xea24a4(0x1a5)];for(const [_0x2613e3]of this[_0xea24a4(0x215)]){this['clearStatusTimers'](_0x2613e3);}console[_0xea24a4(0x23a)]('🛑\x20Stopped\x20'+_0x456cd8+_0xea24a4(0x259));}}exports[a42_0x3f003d(0x293)]=MasterCardService;