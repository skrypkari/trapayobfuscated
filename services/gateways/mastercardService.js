'use strict';const a64_0x23d41e=a64_0x4466;function a64_0x4466(_0x5459af,_0x328d33){_0x5459af=_0x5459af-0x12b;const _0x46ca19=a64_0x46ca();let _0x446616=_0x46ca19[_0x5459af];return _0x446616;}(function(_0x39bb7b,_0x3717bc){const _0x2e3b7d=a64_0x4466,_0x4bea59=_0x39bb7b();while(!![]){try{const _0x44499c=parseInt(_0x2e3b7d(0x197))/0x1*(-parseInt(_0x2e3b7d(0x14d))/0x2)+parseInt(_0x2e3b7d(0x218))/0x3+parseInt(_0x2e3b7d(0x152))/0x4*(-parseInt(_0x2e3b7d(0x151))/0x5)+-parseInt(_0x2e3b7d(0x287))/0x6+parseInt(_0x2e3b7d(0x13d))/0x7*(parseInt(_0x2e3b7d(0x283))/0x8)+parseInt(_0x2e3b7d(0x294))/0x9*(-parseInt(_0x2e3b7d(0x17e))/0xa)+parseInt(_0x2e3b7d(0x1d3))/0xb*(parseInt(_0x2e3b7d(0x238))/0xc);if(_0x44499c===_0x3717bc)break;else _0x4bea59['push'](_0x4bea59['shift']());}catch(_0xcf1644){_0x4bea59['push'](_0x4bea59['shift']());}}}(a64_0x46ca,0x2843a));function a64_0x46ca(){const _0x2d449f=['push','Awaiting\x20confirmation\x20in\x20the\x20application','LookUp\x20code\x20sent','üìù\x20Decrypted\x20webhook\x20data:','\x20failed\x20for\x20payment\x20','get','first_name','parse','79047qYbYFt',',\x20body:\x20','MasterCard\x20webhook\x20sent\x20to\x20','‚úÖ\x20Payment\x20','Status\x20Text:','includes','\x20MasterCard\x20status\x20check\x20timers','\x20API:\x20','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','üîê\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','üõë\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','/charge_raw','\x20\x20\x20-\x20info\x20length:','update','cardType','resolve','üîê\x20Data\x20signed\x20with\x20RSA','‚ö†Ô∏è\x20Expected\x20VISA\x20public\x20key:\x20','failed','isFinalStatus','visa_public.pem','HTTP\x20error!\x20status:\x20','‚ùå\x20Data\x20being\x20signed:','webhook_send','Payment\x20System/1.0','üìù\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','unknown','floor','RSA_PKCS1_PADDING','visa/mastercard','Payment\x20ID:','Error\x20parsing\x20webhook\x20events:','publicKeyPath','path','1726823DZkdbq','merchantPointId','paymentId','Recipient\x20data\x20required','üì¶\x20FULL\x20RESPONSE\x20BODY:','\x20\x20\x20Payment\x20ID:\x20','findUnique','processCardPayment','üìç\x20Full\x20card\x20holder\x20data:','Status\x20decryption\x20failed:\x20','...','üîê\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','Client\x20OTP\x20confirmation\x20required','‚ö†Ô∏è\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','‚úÖ\x20Status\x20response\x20decrypted\x20successfully','../telegramBotService','343388xpIiGf','publicEncrypt','üí≥\x20VISA/MasterCard\x20service\x20initialized','text','890PZwABG','2316jKscGL','generateAESKey','üîê\x20VISA\x20Private\x20key\x20path:','logShopWebhookError','üîç\x20Using\x20provided\x20card\x20type:\x20','base64','PENDING','\x20not\x20enabled\x20for\x20shop\x20','order_id','\x20order_id\x20for\x20search:\x20','Sender\x20information\x20required','\x20\x20\x20-\x20key\x20length:',':\x20Unknown\x20status\x20code','üîê\x20AES\x20key\x20and\x20IV\x20generated','privateDecrypt','Result\x20URL:','failureMessage',',\x20id=','Status:','visaMerchantPointId','POST','statusCheckTimers','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','join','https://api.myatranz.com/api',',\x20Desc:\x20','-----END','utf8','info','üìù\x20Final\x20request\x20structure:','masterCardApiUrl','Error\x20details:','final','logWhiteDomainRequest',',\x20orderId=','__createBinding','payment.failed','status','üìä\x20','postcode','decryptResponsePhp','Payment\x20is\x20being\x20processed','validateKeyFiles','\x20\x20\x20-\x20merchant_point_id:','180iPGmhu','4000000000000000','Request\x20data\x20error','),\x20defaulting\x20to\x20MasterCard','visaPublicKeyPath','replace','/charge_decrypt','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','post_code','getCardTypeAndApi','Failed\x20to\x20decrypt\x20response','Number\x20of\x20attempts\x20exceeded','HTTP\x20Status:','expire_month',',\x20final=',',\x20payment_id=','\x20for\x20payment\x20','Unknown\x20error','FAILED','writable','Invalid\x20expiration\x20date','HTTP\x20','üì¶\x20FULL\x20REQUEST\x20JSON:','Failed\x20payment','hex','1zihroC','trim','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','Webhook\x20event\x20','MASTERCARD','Insufficient\x20funds\x20on\x20the\x20card','üìù\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','../../config/database','digest','__esModule','webhookUrl','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','loggerService','payment_id','forEach','number','logWhiteDomainError','‚ùå\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','randomBytes','‚ùå\x20Detailed\x20failure\x20description:\x20','json','clearStatusTimers','application/json','üìù\x20Data\x20length:','Cancellation\x20is\x20not\x20possible','statusText','‚ùå\x20VISA/MasterCard\x20key\x20validation\x20failed:','\x20(from:\x20order_id=','\x20(from:\x20status=','‚úÖ\x20MasterCard\x20key\x20files\x20validated\x20successfully','‚ùå\x20PHP\x20decryptor\x20request\x20failed:','üìù\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','/status','‚ö†Ô∏è\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','‚ö†Ô∏è\x20Expected\x20VISA\x20private\x20key:\x20','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','charAt','sha256','\x20\x20\x20Status:\x20','encryptAES','scheduleStatusChecks','üõë\x20Stopped\x20','üîê\x20MasterCard\x20Private\x20key\x20path:','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','stringify','\x22\x20|\x20\x22','crypto','hasOwnProperty','Sender\x27s\x20CVV\x20card\x20is\x20required','configurable','logShopWebhookSent','default','/status_raw','‚è∞\x20Scheduling\x20status\x20checks\x20for\x20','3DS\x20verification\x20required','üîê\x20MasterCard\x20Private\x20key\x20length:\x20','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','Payment\x20System/1.0\x20(MasterCard)','from','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','5883042dJXlQi','\x20payment\x20status:\x20','expire_year','none','üìä\x20Status\x20check\x20#','desc','keys','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','call','Expected\x20bitcoin\x20transfer\x20from\x20client','description','errorMessage','createSign','readFileSync','üí≥\x20Detected\x20MasterCard\x20(starts\x20with\x205)','orderId','isArray','then','privateKeyPath','end','Card\x20Holder:','sign','üîê\x20MasterCard\x20Public\x20key\x20length:\x20','cwd','__importStar','‚úÖ\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','length','üìù\x20Data\x20to\x20sign\x20length:','createHmac','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','5000000000000000','Order\x20ID:','getDetailedErrorMessage','üîê\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','3DS\x20URL:','delete','üßπ\x20Card\x20holder\x20names\x20cleaned:','logWhiteDomainResponse','LookUp\x20number\x20of\x20attempts\x20exceeded','üìä\x20Status\x20check\x20result:','now','‚ö†Ô∏è\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','‚úÖ\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','LookUp\x20not\x20confirmed','payment','\x20status\x20timers\x20for\x20payment\x20','shop','sendPaymentNotification','\x20\x20\x20-\x20sign\x20length:','last_name','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','‚úÖ\x20Scheduled\x20','üí≥\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','log','PAID','Failed\x20to\x20check\x20','private.pem','toLowerCase','toString','üîê\x20AES\x20key\x20length:','‚ùå\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','Operation\x20completed\x20successfully','apiUrl','),\x20stopping\x20status\x20checks','prototype','üîê\x20VISA\x20Public\x20key\x20path:','üíæ\x20Saving\x20failure\x20message:\x20','Failed\x20to\x20send\x20MasterCard\x20webhook:','‚ùå\x20Failed\x20to\x20decrypt\x20status\x20response:','215436KTjzqk','üîê\x20MasterCard\x20Public\x20key\x20path:','decryptAES','üéØ\x20Using\x20','Unsuccessful\x20payment','Status\x20','masterCardMerchantPointId','\x20payment_id\x20for\x20search:\x20','checkPaymentStatus','‚ùå\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','===\x20API\x20RESPONSE\x20===','‚ö†Ô∏è\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','defineProperty','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','signRSA','****\x20****\x20****\x20','üîê\x20VISA\x20Private\x20key\x20length:\x20','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','create','üîê\x20Data\x20encrypted\x20with\x20AES','üîç\x20Using\x20','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','üîê\x20VISA\x20Public\x20key\x20length:\x20','üìù\x20Encrypted\x20key\x20length:','paidAt','üîê\x203DS\x20verification\x20required','No\x20Error\x20executing\x20request','currency','üì¶\x20FULL\x20RESPONSE\x20JSON:','paymentStatuses','===\x20PARSED\x20API\x20RESPONSE\x20===',',\x20paymentId=','12bLRYni','Return\x20URL:','error','VisaMasterCardService','\x20status\x20updated\x20to\x20','The\x20card\x20does\x20not\x20exist','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','üîê\x20AES\x20IV\x20length:','3ds_url','visa_private.pem','PHP\x20decryptor\x20error','Payment\x20returned','üìù\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','visaPrivateKeyPath','/status_decrypted','aes-256-ctr','Another\x20unknown\x20error',',\x20Final:\x20','existsSync','\x20status\x20checks\x20for\x20payment\x20','üí≥\x20Unknown\x20card\x20type\x20(starts\x20with\x20','\x20\x20\x20Currency:\x20','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','üìù\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','\x20\x20Original:\x20\x22','/charge','stopAllStatusChecks','__setModuleDefault','SHA256','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','Sender\x27s\x20card\x20details\x20are\x20required','webhookEvents','\x20characters','createDecipheriv','No\x20New\x20payment','\x20webhook\x20extracted\x20data:','\x20\x20Cleaned:\x20\x20\x22','shopId','/charge_decrypted','customerEmail','encryptRSA','üîê\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','‚ùå\x20Status\x20check\x20#','Method\x20not\x20allowed','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','üìù\x20Signature\x20length:','charge','message','\x20\x20\x20-\x20method:\x20charge','payment.success','/status_decrypt','key','sendShopWebhook','****','country','getOwnPropertyDescriptor','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','headers','maskCardNumber','sendPaymentNotifications','‚ùå\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','üîç\x20Using\x20fallback\x20fields\x20for\x20search:\x20','amount','\x20result:','updatePaymentStatus','The\x20card\x20is\x20lost\x20or\x20stolen','cvv','visaApiUrl','üì§\x20Sending\x20request\x20to\x20API...','üìù\x20Encrypted\x20data\x20length:','üîÑ\x20Converted\x20postcode\x20to\x20post_code:\x20','Payment\x20confirmation\x20time\x20has\x20expired','warn','toUpperCase','8rvgXyz','secretKey','Response\x20Time:','set','1533306dNRUCV','paid','settings','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','VISA'];a64_0x46ca=function(){return _0x2d449f;};return a64_0x46ca();}var __createBinding=this&&this[a64_0x23d41e(0x175)]||(Object['create']?function(_0x4caf2c,_0x13e498,_0x38dcac,_0x4411ae){const _0x4b730f=a64_0x23d41e;if(_0x4411ae===undefined)_0x4411ae=_0x38dcac;var _0x3d5b97=Object[_0x4b730f(0x270)](_0x13e498,_0x38dcac);(!_0x3d5b97||(_0x4b730f(0x291)in _0x3d5b97?!_0x13e498[_0x4b730f(0x1a0)]:_0x3d5b97[_0x4b730f(0x191)]||_0x3d5b97[_0x4b730f(0x1c8)]))&&(_0x3d5b97={'enumerable':!![],'get':function(){return _0x13e498[_0x38dcac];}}),Object[_0x4b730f(0x224)](_0x4caf2c,_0x4411ae,_0x3d5b97);}:function(_0x5a586e,_0x41b6a5,_0x576b3c,_0x23bb38){if(_0x23bb38===undefined)_0x23bb38=_0x576b3c;_0x5a586e[_0x23bb38]=_0x41b6a5[_0x576b3c];}),__setModuleDefault=this&&this[a64_0x23d41e(0x254)]||(Object[a64_0x23d41e(0x22a)]?function(_0x250277,_0x267fe5){const _0x20ab6a=a64_0x23d41e;Object[_0x20ab6a(0x224)](_0x250277,_0x20ab6a(0x1ca),{'enumerable':!![],'value':_0x267fe5});}:function(_0x109bf8,_0x35d8d8){_0x109bf8['default']=_0x35d8d8;}),__importStar=this&&this[a64_0x23d41e(0x1eb)]||(function(){var _0x5542c3=function(_0x3952b6){return _0x5542c3=Object['getOwnPropertyNames']||function(_0x3d36df){const _0x26ac9c=a64_0x4466;var _0x4a5581=[];for(var _0x2862ef in _0x3d36df)if(Object[_0x26ac9c(0x213)][_0x26ac9c(0x1c6)][_0x26ac9c(0x1db)](_0x3d36df,_0x2862ef))_0x4a5581[_0x4a5581['length']]=_0x2862ef;return _0x4a5581;},_0x5542c3(_0x3952b6);};return function(_0x472f06){const _0xb4bb75=a64_0x4466;if(_0x472f06&&_0x472f06[_0xb4bb75(0x1a0)])return _0x472f06;var _0x4e59db={};if(_0x472f06!=null){for(var _0x3f8b2c=_0x5542c3(_0x472f06),_0x444cb6=0x0;_0x444cb6<_0x3f8b2c[_0xb4bb75(0x1ed)];_0x444cb6++)if(_0x3f8b2c[_0x444cb6]!==_0xb4bb75(0x1ca))__createBinding(_0x4e59db,_0x472f06,_0x3f8b2c[_0x444cb6]);}return __setModuleDefault(_0x4e59db,_0x472f06),_0x4e59db;};}()),__importDefault=this&&this['__importDefault']||function(_0xbced65){const _0x2ce3ed=a64_0x23d41e;return _0xbced65&&_0xbced65[_0x2ce3ed(0x1a0)]?_0xbced65:{'default':_0xbced65};};Object[a64_0x23d41e(0x224)](exports,a64_0x23d41e(0x1a0),{'value':!![]}),exports[a64_0x23d41e(0x23b)]=void 0x0;const crypto_1=__importDefault(require(a64_0x23d41e(0x1c5))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a64_0x23d41e(0x13c))),loggerService_1=require('../loggerService');class VisaMasterCardService{constructor(){const _0x2f0254=a64_0x23d41e;this[_0x2f0254(0x167)]=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0x2f0254(0x25b)},0x1:{'final':![],'description':_0x2f0254(0x232)},0x2:{'final':!![],'description':_0x2f0254(0x180)},0x3:{'final':!![],'description':_0x2f0254(0x248)},0x4:{'final':!![],'description':_0x2f0254(0x21c)},0x5:{'final':!![],'description':_0x2f0254(0x29c)},0x6:{'final':!![],'description':_0x2f0254(0x243)},0x7:{'final':!![],'description':'Test\x20payment'},0x8:{'final':![],'description':_0x2f0254(0x149)},0x9:{'final':![],'description':_0x2f0254(0x1cd)},0xa:{'final':![],'description':_0x2f0254(0x1c7)},0xb:{'final':![],'description':_0x2f0254(0x15c)},0xc:{'final':![],'description':_0x2f0254(0x140)},0xd:{'final':![],'description':'Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number'},0xe:{'final':![],'description':'Awaiting\x20confirmation\x20by\x20ivr\x20call'},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':'Captcha\x20confirmation\x20awaited'},0x11:{'final':![],'description':_0x2f0254(0x1a2)},0x12:{'final':![],'description':_0x2f0254(0x28d)},0x13:{'final':![],'description':_0x2f0254(0x17b)},0x14:{'final':![],'description':_0x2f0254(0x1f0)},0x15:{'final':![],'description':_0x2f0254(0x1dc)},0x16:{'final':![],'description':'Payment\x20pending\x20verification'},0x18:{'final':![],'description':_0x2f0254(0x256)},0x19:{'final':![],'description':_0x2f0254(0x271)},0x1a:{'final':!![],'description':'Cash\x20payment\x20is\x20expected\x20at\x20TCO'},0x1b:{'final':![],'description':_0x2f0254(0x1da)},0x1c:{'final':![],'description':_0x2f0254(0x24f)},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':_0x2f0254(0x22d)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':_0x2f0254(0x257)},0x24:{'final':!![],'description':_0x2f0254(0x280)},0x25:{'final':!![],'description':'Payment\x20prohibited'},0x26:{'final':!![],'description':_0x2f0254(0x168)},0x27:{'final':!![],'description':_0x2f0254(0x19c)},0x28:{'final':!![],'description':_0x2f0254(0x23d)},0x29:{'final':!![],'description':_0x2f0254(0x27a)},0x2a:{'final':!![],'description':_0x2f0254(0x192)},0x2b:{'final':!![],'description':'Transaction\x20limit\x20exceeded'},0x2c:{'final':!![],'description':_0x2f0254(0x1c2)},0x2d:{'final':!![],'description':_0x2f0254(0x195)},0x2e:{'final':!![],'description':_0x2f0254(0x21c)},0x2f:{'final':!![],'description':_0x2f0254(0x21c)},0x30:{'final':!![],'description':_0x2f0254(0x225)},0x31:{'final':![],'description':'Payment\x20confirmation\x20required'},0x32:{'final':!![],'description':_0x2f0254(0x264)},0x33:{'final':!![],'description':_0x2f0254(0x195)},0x34:{'final':!![],'description':_0x2f0254(0x195)},0x35:{'final':!![],'description':_0x2f0254(0x195)},0x36:{'final':!![],'description':_0x2f0254(0x195)},0x37:{'final':!![],'description':'Failed\x20payment'},0x38:{'final':!![],'description':_0x2f0254(0x1af)},0x39:{'final':![],'description':_0x2f0254(0x199)},0x3a:{'final':![],'description':_0x2f0254(0x28e)},0x3b:{'final':!![],'description':'LookUp\x20code\x20verified'},0x3c:{'final':!![],'description':_0x2f0254(0x189)},0x3d:{'final':!![],'description':_0x2f0254(0x229)},0x3e:{'final':!![],'description':_0x2f0254(0x23e)},0x3f:{'final':!![],'description':_0x2f0254(0x243)},0x40:{'final':![],'description':_0x2f0254(0x1fe)},0x41:{'final':!![],'description':_0x2f0254(0x1f9)},0x42:{'final':![],'description':'Payment\x20cancellation\x20is\x20being\x20processed'},0x43:{'final':!![],'description':'Technical\x20limit,\x20contact\x20your\x20personal\x20manager'},0x44:{'final':![],'description':_0x2f0254(0x1cd)},0x45:{'final':!![],'description':'Failed\x20payment'},0x46:{'final':!![],'description':_0x2f0254(0x195)},0x47:{'final':!![],'description':_0x2f0254(0x1cf)},0x64:{'final':!![],'description':_0x2f0254(0x210)}},this['masterCardApiUrl']=_0x2f0254(0x16a),this['masterCardMerchantPointId']=0x50ca,this['privateKeyPath']=path_1[_0x2f0254(0x1ca)][_0x2f0254(0x169)](process['cwd'](),_0x2f0254(0x1d9),_0x2f0254(0x20b)),this[_0x2f0254(0x13b)]=path_1[_0x2f0254(0x1ca)][_0x2f0254(0x169)](process['cwd'](),_0x2f0254(0x1d9),'psp_public.pem'),this[_0x2f0254(0x27c)]='https://api.paydmeth.com/api',this[_0x2f0254(0x165)]=0x6b7,this['visaPrivateKeyPath']=path_1['default'][_0x2f0254(0x169)](process[_0x2f0254(0x1ea)](),_0x2f0254(0x1d9),_0x2f0254(0x241)),this[_0x2f0254(0x182)]=path_1[_0x2f0254(0x1ca)]['join'](process[_0x2f0254(0x1ea)](),'keys',_0x2f0254(0x12f)),console[_0x2f0254(0x208)](_0x2f0254(0x14f)),console[_0x2f0254(0x208)]('üîê\x20MasterCard\x20API\x20URL:',this[_0x2f0254(0x170)]),console[_0x2f0254(0x208)]('üîê\x20VISA\x20API\x20URL:',this[_0x2f0254(0x27c)]),console[_0x2f0254(0x208)](_0x2f0254(0x1c1),this['privateKeyPath']),console[_0x2f0254(0x208)](_0x2f0254(0x219),this[_0x2f0254(0x13b)]),console[_0x2f0254(0x208)](_0x2f0254(0x154),this['visaPrivateKeyPath']),console['log'](_0x2f0254(0x214),this[_0x2f0254(0x182)]),this['validateKeyFiles']();}[a64_0x23d41e(0x1f3)](_0x18bf5f,_0x3c3dd8){const _0x4f93e4=a64_0x23d41e,_0x1971ab=this[_0x4f93e4(0x235)][_0x18bf5f];let _0x2f8da0='';_0x1971ab?_0x2f8da0=_0x4f93e4(0x21d)+_0x18bf5f+':\x20'+_0x1971ab[_0x4f93e4(0x1dd)]:_0x2f8da0=_0x4f93e4(0x21d)+_0x18bf5f+_0x4f93e4(0x15e);if(_0x3c3dd8&&_0x3c3dd8[_0x4f93e4(0x198)]()){const _0x4e7bc3=_0x3c3dd8[_0x4f93e4(0x198)]();(!_0x1971ab||_0x4e7bc3[_0x4f93e4(0x20c)]()!==_0x1971ab[_0x4f93e4(0x1dd)][_0x4f93e4(0x20c)]())&&(_0x2f8da0+='\x20|\x20Response:\x20'+_0x4e7bc3);}return _0x2f8da0;}['isFinalStatus'](_0x2c024a){const _0x3db12c=a64_0x23d41e,_0x4d1472=this['paymentStatuses'][_0x2c024a];return _0x4d1472?_0x4d1472[_0x3db12c(0x172)]:!![];}['getCardTypeAndApi'](_0x1c26dc){const _0x51c43d=a64_0x23d41e,_0x14943e=_0x1c26dc[_0x51c43d(0x1bb)](0x0);if(_0x14943e==='4')return console[_0x51c43d(0x208)](_0x51c43d(0x207)),{'cardType':_0x51c43d(0x28b),'apiUrl':this[_0x51c43d(0x27c)],'privateKeyPath':this['visaPrivateKeyPath'],'publicKeyPath':this['visaPublicKeyPath'],'merchantPointId':this[_0x51c43d(0x165)]};else return _0x14943e==='5'?(console['log'](_0x51c43d(0x1e1)),{'cardType':'MASTERCARD','apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x51c43d(0x1e5)],'publicKeyPath':this[_0x51c43d(0x13b)],'merchantPointId':this[_0x51c43d(0x21e)]}):(console[_0x51c43d(0x208)](_0x51c43d(0x24c)+_0x14943e+_0x51c43d(0x181)),{'cardType':_0x51c43d(0x19b),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x51c43d(0x1e5)],'publicKeyPath':this[_0x51c43d(0x13b)],'merchantPointId':this[_0x51c43d(0x21e)]});}[a64_0x23d41e(0x17c)](){const _0xc3a26a=a64_0x23d41e;try{if(!fs_1[_0xc3a26a(0x1ca)]['existsSync'](this[_0xc3a26a(0x1e5)]))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this[_0xc3a26a(0x1e5)]);if(!fs_1[_0xc3a26a(0x1ca)]['existsSync'](this[_0xc3a26a(0x13b)]))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this[_0xc3a26a(0x13b)]);const _0x5bc7a2=fs_1[_0xc3a26a(0x1ca)][_0xc3a26a(0x1e0)](this[_0xc3a26a(0x1e5)],_0xc3a26a(0x16d))[_0xc3a26a(0x198)](),_0x9fcea2=fs_1['default'][_0xc3a26a(0x1e0)](this['publicKeyPath'],_0xc3a26a(0x16d))[_0xc3a26a(0x198)]();if(!_0x5bc7a2['includes']('-----BEGIN')||!_0x5bc7a2['includes'](_0xc3a26a(0x16c)))throw new Error(_0xc3a26a(0x185));if(!_0x9fcea2[_0xc3a26a(0x299)]('-----BEGIN')||!_0x9fcea2[_0xc3a26a(0x299)](_0xc3a26a(0x16c)))throw new Error(_0xc3a26a(0x1ba));console[_0xc3a26a(0x208)](_0xc3a26a(0x1b4)),console[_0xc3a26a(0x208)](_0xc3a26a(0x1ce)+_0x5bc7a2[_0xc3a26a(0x1ed)]+'\x20characters'),console[_0xc3a26a(0x208)](_0xc3a26a(0x1e9)+_0x9fcea2['length']+_0xc3a26a(0x259));if(fs_1['default'][_0xc3a26a(0x24a)](this['visaPrivateKeyPath'])&&fs_1[_0xc3a26a(0x1ca)][_0xc3a26a(0x24a)](this[_0xc3a26a(0x182)])){const _0x34440f=fs_1[_0xc3a26a(0x1ca)]['readFileSync'](this[_0xc3a26a(0x245)],_0xc3a26a(0x16d))[_0xc3a26a(0x198)](),_0x3d4cc7=fs_1[_0xc3a26a(0x1ca)][_0xc3a26a(0x1e0)](this[_0xc3a26a(0x182)],_0xc3a26a(0x16d))['trim']();(!_0x34440f['includes']('-----BEGIN')||!_0x34440f[_0xc3a26a(0x299)](_0xc3a26a(0x16c)))&&console[_0xc3a26a(0x281)](_0xc3a26a(0x223)),(!_0x3d4cc7[_0xc3a26a(0x299)]('-----BEGIN')||!_0x3d4cc7[_0xc3a26a(0x299)](_0xc3a26a(0x16c)))&&console[_0xc3a26a(0x281)](_0xc3a26a(0x14a)),console['log']('‚úÖ\x20VISA\x20key\x20files\x20validated\x20successfully'),console['log'](_0xc3a26a(0x228)+_0x34440f[_0xc3a26a(0x1ed)]+_0xc3a26a(0x259)),console[_0xc3a26a(0x208)](_0xc3a26a(0x22e)+_0x3d4cc7[_0xc3a26a(0x1ed)]+'\x20characters');}else console[_0xc3a26a(0x281)](_0xc3a26a(0x1b8)),console[_0xc3a26a(0x281)](_0xc3a26a(0x1b9)+this[_0xc3a26a(0x245)]),console[_0xc3a26a(0x281)](_0xc3a26a(0x12c)+this[_0xc3a26a(0x182)]);}catch(_0x2cd4b2){console[_0xc3a26a(0x23a)](_0xc3a26a(0x1b1),_0x2cd4b2);throw _0x2cd4b2;}}[a64_0x23d41e(0x153)](){const _0x3a2a36=a64_0x23d41e,_0x138e7d=crypto_1['default']['randomBytes'](0x20),_0x14ad1d=crypto_1[_0x3a2a36(0x1ca)][_0x3a2a36(0x1a9)](0x10);return{'key':_0x138e7d,'iv':_0x14ad1d};}[a64_0x23d41e(0x1be)](_0x3299df,_0x404718,_0x44c167){const _0x28ad97=a64_0x23d41e,_0x1b3588=crypto_1[_0x28ad97(0x1ca)]['createCipheriv'](_0x28ad97(0x247),_0x404718,_0x44c167);let _0x56eb60=_0x1b3588['update'](_0x3299df,_0x28ad97(0x16d),_0x28ad97(0x157));return _0x56eb60+=_0x1b3588[_0x28ad97(0x172)](_0x28ad97(0x157)),_0x56eb60;}[a64_0x23d41e(0x261)](_0x3f9e41,_0x115266,_0x289c2b){const _0x33358f=a64_0x23d41e;try{const _0x56371a=fs_1[_0x33358f(0x1ca)][_0x33358f(0x1e0)](_0x289c2b,_0x33358f(0x16d))['trim'](),_0x1ce246={'iv':_0x115266['toString'](_0x33358f(0x157)),'key':_0x3f9e41[_0x33358f(0x20d)](_0x33358f(0x157))},_0x5e5624=JSON[_0x33358f(0x1c3)](_0x1ce246);console[_0x33358f(0x208)](_0x33358f(0x1f4),_0x5e5624[_0x33358f(0x1ed)]);const _0x51cc1f=crypto_1[_0x33358f(0x1ca)][_0x33358f(0x14e)]({'key':_0x56371a,'padding':crypto_1['default']['constants'][_0x33358f(0x137)]},Buffer[_0x33358f(0x1d1)](_0x5e5624));return console['log']('‚úÖ\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x51cc1f[_0x33358f(0x1ed)]),_0x51cc1f[_0x33358f(0x20d)]('base64');}catch(_0x502b91){console[_0x33358f(0x23a)]('‚ùå\x20RSA\x20encryption\x20failed:',_0x502b91);throw new Error(_0x33358f(0x24e));}}[a64_0x23d41e(0x226)](_0x2eb04e,_0x2e25fd){const _0x3f3687=a64_0x23d41e;try{const _0x4172d4=fs_1[_0x3f3687(0x1ca)][_0x3f3687(0x1e0)](_0x2e25fd,_0x3f3687(0x16d))['trim'](),_0x51debc=crypto_1['default'][_0x3f3687(0x1df)](_0x3f3687(0x255));_0x51debc[_0x3f3687(0x2a1)](_0x2eb04e),_0x51debc[_0x3f3687(0x1e6)]();const _0x241501=_0x51debc[_0x3f3687(0x1e8)](_0x4172d4,_0x3f3687(0x157));return console[_0x3f3687(0x208)]('üîê\x20RSA\x20signing\x20successful'),console['log'](_0x3f3687(0x1ee),_0x2eb04e[_0x3f3687(0x1ed)]),console['log'](_0x3f3687(0x266),_0x241501['length']),_0x241501;}catch(_0x4436ed){console['error']('‚ùå\x20RSA\x20signing\x20failed:',_0x4436ed),console[_0x3f3687(0x23a)](_0x3f3687(0x131),_0x2eb04e['substring'](0x0,0xc8)+_0x3f3687(0x147));throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}[a64_0x23d41e(0x21a)](_0x44c904,_0x544c7f,_0x2d4bdf){const _0x3f30ce=a64_0x23d41e,_0x35b507=crypto_1[_0x3f30ce(0x1ca)][_0x3f30ce(0x25a)](_0x3f30ce(0x247),_0x544c7f,_0x2d4bdf);let _0x43990f=_0x35b507[_0x3f30ce(0x2a1)](_0x44c904,_0x3f30ce(0x157),_0x3f30ce(0x16d));return _0x43990f+=_0x35b507['final'](_0x3f30ce(0x16d)),_0x43990f;}async[a64_0x23d41e(0x17a)](_0x1bd7f4,_0x32c3e6,_0xb626f7=a64_0x23d41e(0x19b)){const _0x4602d6=a64_0x23d41e;try{const _0x1e15d7=await fetch('https://api2.trapay.uk/decrypt.php',{'method':'POST','headers':{'Content-Type':_0x4602d6(0x1ad)},'body':JSON[_0x4602d6(0x1c3)]({'info':_0x1bd7f4,'key':_0x32c3e6,'card_type':_0xb626f7[_0x4602d6(0x20c)]()})});if(!_0x1e15d7['ok'])throw new Error(_0x4602d6(0x242));return await _0x1e15d7[_0x4602d6(0x150)]();}catch(_0x34b658){console[_0x4602d6(0x23a)](_0x4602d6(0x1b5),_0x34b658);throw new Error(_0x4602d6(0x205));}}['decryptResponse'](_0x56c5bc,_0x99c7bf){const _0x3da58d=a64_0x23d41e;try{const _0x49f54c=fs_1[_0x3da58d(0x1ca)][_0x3da58d(0x1e0)](this[_0x3da58d(0x1e5)],'utf8')[_0x3da58d(0x198)](),_0x19f918=crypto_1[_0x3da58d(0x1ca)][_0x3da58d(0x160)](_0x49f54c,Buffer[_0x3da58d(0x1d1)](_0x99c7bf,_0x3da58d(0x157))),_0x2e371d=JSON[_0x3da58d(0x293)](_0x19f918['toString']()),_0x2a407a=Buffer['from'](_0x2e371d[_0x3da58d(0x26c)],'base64'),_0x5b6161=Buffer[_0x3da58d(0x1d1)](_0x2e371d['iv'],'base64');return this[_0x3da58d(0x21a)](_0x56c5bc,_0x2a407a,_0x5b6161);}catch(_0x10fc4e){throw new Error(_0x3da58d(0x188));}}async[a64_0x23d41e(0x144)](_0x75f260){const _0x1a423b=a64_0x23d41e,{paymentId:_0x3cf679,orderId:_0x467417,amount:_0x9728c2,currency:_0x15ed90,cardData:_0x406380,resultUrl:_0x44acc6,returnUrl:_0xf723c7,cardHolder:_0x1926fa,browser:_0x2d5547}=_0x75f260;console[_0x1a423b(0x208)](_0x1a423b(0x1d2)),console[_0x1a423b(0x208)](_0x1a423b(0x139),_0x3cf679),console[_0x1a423b(0x208)](_0x1a423b(0x1f2),_0x467417),console['log']('Amount:',_0x9728c2,_0x15ed90),console[_0x1a423b(0x208)]('Card\x20Number:',this['maskCardNumber'](_0x406380[_0x1a423b(0x1a6)])),console['log'](_0x1a423b(0x1e7),_0x1926fa[_0x1a423b(0x292)]+'\x20'+_0x1926fa['last_name']),console['log'](_0x1a423b(0x239),_0xf723c7),console[_0x1a423b(0x208)](_0x1a423b(0x161),_0x44acc6);const _0x508a75=this[_0x1a423b(0x187)](_0x406380['number']);console[_0x1a423b(0x208)](_0x1a423b(0x21b)+_0x508a75[_0x1a423b(0x2a2)]+_0x1a423b(0x29b)+_0x508a75['apiUrl']),console['log']('üîê\x20Using\x20keys:\x20'+_0x508a75['privateKeyPath']+',\x20'+_0x508a75['publicKeyPath']);const _0x1ca14e={..._0x1926fa,'first_name':_0x1926fa[_0x1a423b(0x292)]?.[_0x1a423b(0x183)](/[\t\n\r\f\v]/g,'\x20')[_0x1a423b(0x198)]()||'','last_name':_0x1926fa[_0x1a423b(0x204)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x1a423b(0x198)]()||''};'postcode'in _0x1ca14e&&!(_0x1a423b(0x186)in _0x1ca14e)&&(_0x1ca14e[_0x1a423b(0x186)]=_0x1ca14e['postcode'],delete _0x1ca14e[_0x1a423b(0x179)],console[_0x1a423b(0x208)](_0x1a423b(0x27f)+_0x1ca14e[_0x1a423b(0x186)]));console[_0x1a423b(0x208)](_0x1a423b(0x1f7)),console[_0x1a423b(0x208)](_0x1a423b(0x251)+_0x1926fa[_0x1a423b(0x292)]+_0x1a423b(0x1c4)+_0x1926fa[_0x1a423b(0x204)]+'\x22'),console[_0x1a423b(0x208)](_0x1a423b(0x25d)+_0x1ca14e[_0x1a423b(0x292)]+_0x1a423b(0x1c4)+_0x1ca14e[_0x1a423b(0x204)]+'\x22'),console[_0x1a423b(0x208)](_0x1a423b(0x145),JSON[_0x1a423b(0x1c3)](_0x1ca14e,null,0x2));const _0x4593b={'amount':_0x9728c2,'currency':_0x15ed90['toUpperCase'](),'order_id':_0x467417,'result_url':_0x44acc6,'return_url':_0xf723c7,'country':_0x1ca14e[_0x1a423b(0x26f)]||'','card':{'number':_0x406380[_0x1a423b(0x1a6)],'expire_month':_0x406380[_0x1a423b(0x18b)],'expire_year':_0x406380[_0x1a423b(0x1d5)],'cvv':_0x406380[_0x1a423b(0x27b)]},'card_holder':_0x1ca14e,'browser':_0x2d5547},_0x1b0077=JSON[_0x1a423b(0x1c3)](_0x4593b);console[_0x1a423b(0x208)]('üíæ\x20Payment\x20data\x20prepared'),console[_0x1a423b(0x208)](_0x1a423b(0x250)),console[_0x1a423b(0x208)](_0x1b0077),console['log'](_0x1a423b(0x1ae),_0x1b0077[_0x1a423b(0x1ed)]);try{const {key:_0x5c4096,iv:_0x432ac5}=this[_0x1a423b(0x153)]();console[_0x1a423b(0x208)](_0x1a423b(0x15f)),console[_0x1a423b(0x208)](_0x1a423b(0x20e),_0x5c4096['length']),console[_0x1a423b(0x208)](_0x1a423b(0x23f),_0x432ac5['length']);const _0x20f4c1=this['encryptAES'](_0x1b0077,_0x5c4096,_0x432ac5);console[_0x1a423b(0x208)](_0x1a423b(0x22b)),console[_0x1a423b(0x208)](_0x1a423b(0x27e),_0x20f4c1[_0x1a423b(0x1ed)]);const _0x22c313=this[_0x1a423b(0x261)](_0x5c4096,_0x432ac5,_0x508a75[_0x1a423b(0x13b)]);console[_0x1a423b(0x208)](_0x1a423b(0x148)),console[_0x1a423b(0x208)](_0x1a423b(0x22f),_0x22c313[_0x1a423b(0x1ed)]);const _0x5a66b7=this[_0x1a423b(0x226)](_0x1b0077,_0x508a75[_0x1a423b(0x1e5)]);console[_0x1a423b(0x208)](_0x1a423b(0x12b)),console[_0x1a423b(0x208)](_0x1a423b(0x266),_0x5a66b7[_0x1a423b(0x1ed)]);const _0x3cf40b={'merchant_point_id':_0x508a75[_0x1a423b(0x13e)],'method':_0x1a423b(0x267),'info':_0x20f4c1,'key':_0x22c313,'sign':_0x5a66b7,'lang':'en'};console[_0x1a423b(0x208)](_0x1a423b(0x27d)),console[_0x1a423b(0x208)](_0x1a423b(0x16f)),console[_0x1a423b(0x208)](_0x1a423b(0x17d),_0x508a75[_0x1a423b(0x13e)]),console[_0x1a423b(0x208)](_0x1a423b(0x269)),console[_0x1a423b(0x208)](_0x1a423b(0x2a0),_0x20f4c1[_0x1a423b(0x1ed)]),console[_0x1a423b(0x208)](_0x1a423b(0x15d),_0x22c313['length']),console[_0x1a423b(0x208)](_0x1a423b(0x203),_0x5a66b7['length']),console[_0x1a423b(0x208)]('\x20\x20\x20-\x20lang:\x20en'),console[_0x1a423b(0x208)](''),console[_0x1a423b(0x208)](_0x1a423b(0x194)),console['log'](JSON[_0x1a423b(0x1c3)](_0x3cf40b,null,0x2)),console[_0x1a423b(0x208)](''),loggerService_1['loggerService'][_0x1a423b(0x173)](_0x508a75[_0x1a423b(0x2a2)][_0x1a423b(0x20c)](),_0x1a423b(0x252),_0x1a423b(0x166),{'merchant_point_id':_0x508a75[_0x1a423b(0x13e)],'method':_0x1a423b(0x267),'lang':'en'});const _0x536666=Date[_0x1a423b(0x1fb)](),_0x1ec6be=await fetch(_0x508a75[_0x1a423b(0x211)],{'method':_0x1a423b(0x166),'headers':{'Content-Type':_0x1a423b(0x1ad),'Accept':_0x1a423b(0x1ad),'User-Agent':_0x1a423b(0x133)},'body':JSON['stringify'](_0x3cf40b)}),_0x5bb86f=Date[_0x1a423b(0x1fb)]()-_0x536666;console[_0x1a423b(0x208)](_0x1a423b(0x222)),console[_0x1a423b(0x208)](_0x1a423b(0x164),_0x1ec6be[_0x1a423b(0x177)]),console[_0x1a423b(0x208)](_0x1a423b(0x298),_0x1ec6be[_0x1a423b(0x1b0)]),console[_0x1a423b(0x208)](_0x1a423b(0x285),_0x5bb86f+'ms'),console[_0x1a423b(0x208)]('Response\x20Headers:'),_0x1ec6be[_0x1a423b(0x272)]['forEach']((_0x2c2d9c,_0x5c55f0)=>{const _0x4e1133=_0x1a423b;console[_0x4e1133(0x208)]('\x20\x20\x20'+_0x5c55f0+':\x20'+_0x2c2d9c);}),console[_0x1a423b(0x208)]('');if(!_0x1ec6be['ok']){const _0x538a14=await _0x1ec6be[_0x1a423b(0x150)]();console['error'](_0x1a423b(0x18a),_0x1ec6be[_0x1a423b(0x177)]),console['error'](_0x1a423b(0x141)),console['error'](_0x538a14),console[_0x1a423b(0x23a)](''),loggerService_1['loggerService'][_0x1a423b(0x1f8)](_0x508a75['cardType'][_0x1a423b(0x20c)](),_0x1a423b(0x29f),_0x1ec6be[_0x1a423b(0x177)],_0x538a14,_0x5bb86f),loggerService_1[_0x1a423b(0x1a3)][_0x1a423b(0x1a7)](_0x508a75['cardType'][_0x1a423b(0x20c)](),_0x1a423b(0x252),_0x1a423b(0x193)+_0x1ec6be[_0x1a423b(0x177)]+':\x20'+_0x538a14);throw new Error(_0x1a423b(0x130)+_0x1ec6be[_0x1a423b(0x177)]+_0x1a423b(0x295)+_0x538a14);}const _0x57edf5=await _0x1ec6be['json']();console[_0x1a423b(0x208)](_0x1a423b(0x234)),console[_0x1a423b(0x208)](JSON[_0x1a423b(0x1c3)](_0x57edf5,null,0x2)),console['log'](''),loggerService_1[_0x1a423b(0x1a3)]['logWhiteDomainResponse'](_0x508a75[_0x1a423b(0x2a2)][_0x1a423b(0x20c)](),_0x1a423b(0x29f),_0x1ec6be[_0x1a423b(0x177)],_0x57edf5,_0x5bb86f),console[_0x1a423b(0x208)](_0x1a423b(0x236));let _0x21d255=_0x57edf5;if(_0x57edf5[_0x1a423b(0x16e)]&&_0x57edf5[_0x1a423b(0x26c)]&&_0x57edf5[_0x1a423b(0x1e8)]){console[_0x1a423b(0x208)]('üîê\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x5462bf=await this[_0x1a423b(0x17a)](_0x57edf5[_0x1a423b(0x16e)],_0x57edf5[_0x1a423b(0x26c)],_0x508a75[_0x1a423b(0x2a2)]);_0x21d255=JSON[_0x1a423b(0x293)](_0x5462bf),console[_0x1a423b(0x208)](_0x1a423b(0x1fd)),loggerService_1[_0x1a423b(0x1a3)][_0x1a423b(0x1f8)](_0x508a75['cardType']['toLowerCase'](),_0x1a423b(0x25f),_0x1ec6be['status'],_0x21d255,_0x5bb86f),console['log'](_0x1a423b(0x244));}catch(_0x2751df){console['error'](_0x1a423b(0x20f),_0x2751df),loggerService_1['loggerService'][_0x1a423b(0x1a7)](_0x508a75[_0x1a423b(0x2a2)][_0x1a423b(0x20c)](),_0x1a423b(0x184),'Decryption\x20failed:\x20'+_0x2751df),_0x21d255=_0x57edf5;}}else loggerService_1[_0x1a423b(0x1a3)][_0x1a423b(0x1f8)](_0x508a75[_0x1a423b(0x2a2)][_0x1a423b(0x20c)](),_0x1a423b(0x25f),_0x1ec6be['status'],_0x21d255,_0x5bb86f),console[_0x1a423b(0x208)](_0x1a423b(0x1b6));console[_0x1a423b(0x208)](_0x1a423b(0x164),_0x21d255[_0x1a423b(0x177)]),console[_0x1a423b(0x208)]('Final:',_0x21d255[_0x1a423b(0x172)]),console['log']('Payment\x20ID:',_0x21d255[_0x1a423b(0x1a4)]),console[_0x1a423b(0x208)](_0x1a423b(0x1f5),_0x21d255[_0x1a423b(0x240)]||_0x1a423b(0x1d6));if(_0x21d255['status']===0x64&&_0x21d255[_0x1a423b(0x172)]===0x1)return console['log']('‚úÖ\x20Payment\x20successful'),{'gateway_payment_id':_0x21d255[_0x1a423b(0x1a4)]?.[_0x1a423b(0x20d)](),'payment_url':_0xf723c7,'requires_3ds':![],'status':_0x1a423b(0x209),'final':!![]};if(_0x21d255[_0x1a423b(0x240)])return console[_0x1a423b(0x208)](_0x1a423b(0x231)),this[_0x1a423b(0x1bf)](_0x3cf679,_0x467417,_0x21d255['payment_id']?.[_0x1a423b(0x20d)]()||_0x467417,_0x508a75[_0x1a423b(0x2a2)]),{'gateway_payment_id':_0x21d255['payment_id']?.[_0x1a423b(0x20d)](),'payment_url':_0x21d255[_0x1a423b(0x240)],'requires_3ds':!![],'threeds_url':_0x21d255[_0x1a423b(0x240)],'status':_0x1a423b(0x158),'final':![]};let _0x4f15b4=this['getDetailedErrorMessage'](_0x21d255[_0x1a423b(0x177)],_0x21d255[_0x1a423b(0x1d8)]||_0x21d255['message']),_0x37fed3=_0x21d255['status'],_0x3ac66c=this[_0x1a423b(0x12e)](_0x21d255[_0x1a423b(0x177)]);return console[_0x1a423b(0x208)](_0x1a423b(0x275)+_0x37fed3+_0x1a423b(0x249)+_0x3ac66c+_0x1a423b(0x16b)+_0x4f15b4),{'gateway_payment_id':_0x21d255[_0x1a423b(0x1a4)]?.['toString'](),'payment_url':_0xf723c7,'requires_3ds':![],'status':_0x1a423b(0x190),'final':!![],'errorMessage':_0x4f15b4};}catch(_0x32d46e){console[_0x1a423b(0x23a)]('===\x20PAYMENT\x20SERVICE\x20ERROR\x20==='),console[_0x1a423b(0x23a)](_0x1a423b(0x171),_0x32d46e),loggerService_1[_0x1a423b(0x1a3)][_0x1a423b(0x1a7)](_0x1a423b(0x138),'/charge',_0x32d46e);throw new Error(_0x1a423b(0x265)+(_0x32d46e instanceof Error?_0x32d46e[_0x1a423b(0x268)]:_0x1a423b(0x18f)));}}async[a64_0x23d41e(0x220)](_0x3776a0,_0x127451,_0x3a17cf=a64_0x23d41e(0x28b)){const _0x1b2b3d=a64_0x23d41e;console['log']('üìä\x20Checking\x20'+_0x3a17cf+_0x1b2b3d(0x1d4)+_0x3776a0+'\x20('+_0x127451+')');try{const _0x10f303={'payment_id':_0x3776a0,'order_id':_0x127451},_0x4a81b4=JSON[_0x1b2b3d(0x1c3)](_0x10f303),_0x4fcce8=this[_0x1b2b3d(0x187)](_0x3a17cf===_0x1b2b3d(0x28b)?_0x1b2b3d(0x17f):_0x1b2b3d(0x1f1)),{key:_0x598bf2,iv:_0x5ca069}=this['generateAESKey'](),_0x8ea978=this[_0x1b2b3d(0x1be)](_0x4a81b4,_0x598bf2,_0x5ca069),_0x3c1f6f=this[_0x1b2b3d(0x261)](_0x598bf2,_0x5ca069,_0x4fcce8[_0x1b2b3d(0x13b)]),_0x4f931f=this[_0x1b2b3d(0x226)](_0x4a81b4,_0x4fcce8[_0x1b2b3d(0x1e5)]),_0x3164c9={'merchant_point_id':_0x4fcce8[_0x1b2b3d(0x13e)],'method':_0x1b2b3d(0x177),'info':_0x8ea978,'key':_0x3c1f6f,'sign':_0x4f931f,'lang':'en'};loggerService_1[_0x1b2b3d(0x1a3)][_0x1b2b3d(0x173)](_0x3a17cf['toLowerCase'](),_0x1b2b3d(0x1b7),_0x1b2b3d(0x166),{'merchant_point_id':_0x4fcce8['merchantPointId'],'method':'status','lang':'en'});const _0x158437=Date[_0x1b2b3d(0x1fb)](),_0x13edb5=await fetch(_0x4fcce8[_0x1b2b3d(0x211)],{'method':_0x1b2b3d(0x166),'headers':{'Content-Type':_0x1b2b3d(0x1ad),'Accept':_0x1b2b3d(0x1ad),'User-Agent':_0x1b2b3d(0x133)},'body':JSON[_0x1b2b3d(0x1c3)](_0x3164c9)}),_0x114c6d=Date[_0x1b2b3d(0x1fb)]()-_0x158437;if(!_0x13edb5['ok']){const _0x490409=await _0x13edb5['text']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3a17cf['toLowerCase'](),_0x1b2b3d(0x1cb),_0x13edb5['status'],_0x490409,_0x114c6d);throw new Error(_0x1b2b3d(0x130)+_0x13edb5[_0x1b2b3d(0x177)]);}const _0x6a31e=await _0x13edb5[_0x1b2b3d(0x1ab)]();loggerService_1[_0x1b2b3d(0x1a3)][_0x1b2b3d(0x1f8)](_0x3a17cf[_0x1b2b3d(0x20c)](),_0x1b2b3d(0x1cb),_0x13edb5[_0x1b2b3d(0x177)],_0x6a31e,_0x114c6d);let _0x1623f9=_0x6a31e;if(_0x6a31e[_0x1b2b3d(0x16e)]&&_0x6a31e['key']&&_0x6a31e[_0x1b2b3d(0x1e8)]){console['log'](_0x1b2b3d(0x262));try{const _0x4ec9c6=await this[_0x1b2b3d(0x17a)](_0x6a31e[_0x1b2b3d(0x16e)],_0x6a31e['key'],_0x3a17cf);_0x1623f9=JSON[_0x1b2b3d(0x293)](_0x4ec9c6),console[_0x1b2b3d(0x208)](_0x1b2b3d(0x14b)),loggerService_1[_0x1b2b3d(0x1a3)]['logWhiteDomainResponse'](_0x3a17cf['toLowerCase'](),_0x1b2b3d(0x246),_0x13edb5[_0x1b2b3d(0x177)],_0x1623f9,_0x114c6d),console['log'](_0x1b2b3d(0x19d));}catch(_0x1b9550){console['error'](_0x1b2b3d(0x217),_0x1b9550),loggerService_1[_0x1b2b3d(0x1a3)]['logWhiteDomainError'](_0x3a17cf[_0x1b2b3d(0x20c)](),_0x1b2b3d(0x26b),_0x1b2b3d(0x146)+_0x1b9550),_0x1623f9=_0x6a31e;}}else loggerService_1[_0x1b2b3d(0x1a3)][_0x1b2b3d(0x1f8)](_0x3a17cf[_0x1b2b3d(0x20c)](),'/status_decrypted',_0x13edb5['status'],_0x1623f9,_0x114c6d),console['log'](_0x1b2b3d(0x134));console[_0x1b2b3d(0x208)](_0x1b2b3d(0x1fa),{'status':_0x1623f9[_0x1b2b3d(0x177)],'final':_0x1623f9[_0x1b2b3d(0x172)],'payment_id':_0x1623f9[_0x1b2b3d(0x1a4)],'desc':_0x1623f9['desc']});let _0x1fda2b='PENDING';if(_0x1623f9[_0x1b2b3d(0x177)]===0x64&&_0x1623f9[_0x1b2b3d(0x172)]===0x1)_0x1fda2b=_0x1b2b3d(0x209);else{if(_0x1623f9[_0x1b2b3d(0x172)]===0x0||!this['isFinalStatus'](_0x1623f9[_0x1b2b3d(0x177)]))_0x1fda2b=_0x1b2b3d(0x158);else _0x1623f9['final']===0x1||this[_0x1b2b3d(0x12e)](_0x1623f9['status'])?_0x1fda2b='FAILED':_0x1fda2b=_0x1b2b3d(0x158);}const _0x1e278b=this[_0x1b2b3d(0x1f3)](_0x1623f9[_0x1b2b3d(0x177)],_0x1623f9[_0x1b2b3d(0x1d8)]);return{'status':_0x1fda2b,'final':this[_0x1b2b3d(0x12e)](_0x1623f9['status']),'amount':_0x1623f9[_0x1b2b3d(0x277)],'currency':_0x1623f9[_0x1b2b3d(0x233)],'date_success':_0x1623f9['date_success'],'description':_0x1e278b};}catch(_0x339e48){console['error'](_0x3a17cf+'\x20status\x20check\x20error:',_0x339e48),loggerService_1[_0x1b2b3d(0x1a3)][_0x1b2b3d(0x1a7)](_0x3a17cf[_0x1b2b3d(0x20c)](),_0x1b2b3d(0x1b7),_0x339e48);throw new Error(_0x1b2b3d(0x20a)+_0x3a17cf+_0x1b2b3d(0x1d4)+(_0x339e48 instanceof Error?_0x339e48[_0x1b2b3d(0x268)]:'Unknown\x20error'));}}['scheduleStatusChecks'](_0x1ad968,_0x56843b,_0xa09254,_0x457f63){const _0xa8810e=a64_0x23d41e;console[_0xa8810e(0x208)](_0xa8810e(0x1cc)+_0x457f63+'\x20payment:\x20'+_0x1ad968+'\x20('+_0xa09254+')'),this[_0xa8810e(0x1ac)](_0x1ad968);const _0xbacb55=[],_0x376c36=0x5*0x3c*0x3e8,_0x51f7f4=0x2*0x3c*0x3c*0x3e8,_0x5197f9=Math[_0xa8810e(0x136)](_0x51f7f4/_0x376c36);console[_0xa8810e(0x208)]('‚è∞\x20Will\x20check\x20status\x20'+_0x5197f9+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x5f4420=0x1;_0x5f4420<=_0x5197f9;_0x5f4420++){const _0x5c0a29=setTimeout(async()=>{const _0x342ac3=_0xa8810e;console[_0x342ac3(0x208)]('üîç\x20'+_0x457f63+'\x20status\x20check\x20#'+_0x5f4420+'/'+_0x5197f9+_0x342ac3(0x18e)+_0x1ad968);try{const _0x4cd7da=await this['checkPaymentStatus'](_0xa09254,_0x56843b,_0x457f63);console[_0x342ac3(0x208)](_0x342ac3(0x1d7)+_0x5f4420+_0x342ac3(0x278),_0x4cd7da),_0x4cd7da['final']&&(console['log'](_0x342ac3(0x297)+_0x1ad968+'\x20is\x20final\x20('+_0x4cd7da['status']+_0x342ac3(0x212)),this[_0x342ac3(0x1ac)](_0x1ad968),await this[_0x342ac3(0x279)](_0x1ad968,_0x4cd7da['status'],_0x4cd7da));}catch(_0x54baac){console[_0x342ac3(0x23a)](_0x342ac3(0x263)+_0x5f4420+_0x342ac3(0x290)+_0x1ad968+':',_0x54baac);}},_0x5f4420*_0x376c36);_0xbacb55[_0xa8810e(0x28c)](_0x5c0a29);}this['statusCheckTimers'][_0xa8810e(0x286)](_0x1ad968,_0xbacb55),console[_0xa8810e(0x208)](_0xa8810e(0x206)+_0x5197f9+_0xa8810e(0x24b)+_0x1ad968);}[a64_0x23d41e(0x1ac)](_0x12dd52){const _0x5aa1c3=a64_0x23d41e,_0xe342da=this[_0x5aa1c3(0x167)][_0x5aa1c3(0x291)](_0x12dd52);_0xe342da&&(console[_0x5aa1c3(0x208)]('üßπ\x20Clearing\x20'+_0xe342da[_0x5aa1c3(0x1ed)]+_0x5aa1c3(0x200)+_0x12dd52),_0xe342da[_0x5aa1c3(0x1a5)]((_0x5aa5bc,_0x20ec6b)=>{clearTimeout(_0x5aa5bc);}),this['statusCheckTimers'][_0x5aa1c3(0x1f6)](_0x12dd52));}async['updatePaymentStatus'](_0x2dbf33,_0x5ab340,_0x5df80e){const _0x4df4ce=a64_0x23d41e;try{const _0x434acf=(await Promise[_0x4df4ce(0x2a3)]()['then'](()=>__importStar(require(_0x4df4ce(0x19e)))))['default'],_0x241a72={'status':_0x5ab340['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x5ab340===_0x4df4ce(0x209)&&(_0x241a72[_0x4df4ce(0x230)]=new Date()),_0x5ab340===_0x4df4ce(0x190)&&_0x5df80e['description']&&(_0x241a72[_0x4df4ce(0x162)]=_0x5df80e[_0x4df4ce(0x1dd)],console[_0x4df4ce(0x208)](_0x4df4ce(0x215)+_0x5df80e[_0x4df4ce(0x1dd)])),await _0x434acf[_0x4df4ce(0x1ff)][_0x4df4ce(0x2a1)]({'where':{'id':_0x2dbf33},'data':_0x241a72}),console[_0x4df4ce(0x208)](_0x4df4ce(0x297)+_0x2dbf33+_0x4df4ce(0x23c)+_0x5ab340),await this['sendPaymentNotifications'](_0x2dbf33,_0x5ab340);}catch(_0x1af618){console[_0x4df4ce(0x23a)](_0x4df4ce(0x1a8)+_0x2dbf33+':',_0x1af618);}}async[a64_0x23d41e(0x274)](_0x4be291,_0x53a779){const _0x561d98=a64_0x23d41e;try{const _0x5571a7=(await Promise[_0x561d98(0x2a3)]()[_0x561d98(0x1e4)](()=>__importStar(require(_0x561d98(0x19e)))))[_0x561d98(0x1ca)],{telegramBotService:_0x23ce1b}=await Promise[_0x561d98(0x2a3)]()[_0x561d98(0x1e4)](()=>__importStar(require(_0x561d98(0x14c)))),_0x33a780=await _0x5571a7[_0x561d98(0x1ff)][_0x561d98(0x143)]({'where':{'id':_0x4be291},'include':{'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':!![]}}}});if(!_0x33a780)return;const _0x211b1c={'PAID':_0x561d98(0x288),'FAILED':_0x561d98(0x12d)},_0x341f2a=_0x211b1c[_0x53a779];_0x341f2a&&await _0x23ce1b[_0x561d98(0x202)](_0x33a780[_0x561d98(0x25e)],_0x33a780,_0x341f2a),await this['sendShopWebhook'](_0x33a780,_0x53a779);}catch(_0x3ac64a){console[_0x561d98(0x23a)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x3ac64a);}}async[a64_0x23d41e(0x26d)](_0x2f0772,_0x36ba64){const _0x10e32a=a64_0x23d41e,_0x6fc7b1=Date[_0x10e32a(0x1fb)]();try{const _0xb4c38e=_0x2f0772[_0x10e32a(0x201)],_0x319d00=_0xb4c38e[_0x10e32a(0x289)];if(!_0x319d00?.['webhookUrl']){console['log'](_0x10e32a(0x28a)+_0xb4c38e['id']);return;}const _0x211da2=_0x36ba64===_0x10e32a(0x209)?_0x10e32a(0x26a):_0x10e32a(0x176);let _0x438519=[];if(_0x319d00[_0x10e32a(0x258)])try{_0x438519=Array[_0x10e32a(0x1e3)](_0x319d00[_0x10e32a(0x258)])?_0x319d00[_0x10e32a(0x258)]:JSON[_0x10e32a(0x293)](_0x319d00[_0x10e32a(0x258)]);}catch(_0x56817f){console['error'](_0x10e32a(0x13a),_0x56817f),_0x438519=[];}if(!_0x438519[_0x10e32a(0x299)](_0x211da2)){console['log'](_0x10e32a(0x19a)+_0x211da2+_0x10e32a(0x159)+_0xb4c38e['id']);return;}const _0x2e077c={'event':_0x211da2,'payment':{'id':_0x2f0772['id'],'order_id':_0x2f0772['orderId'],'gateway_order_id':_0x2f0772['gatewayOrderId'],'gateway':'1111','amount':_0x2f0772['amount'],'currency':_0x2f0772[_0x10e32a(0x233)],'status':_0x36ba64[_0x10e32a(0x20c)](),'customer_email':_0x2f0772[_0x10e32a(0x260)],'customer_name':_0x2f0772['customerName'],'created_at':_0x2f0772['createdAt'],'updated_at':new Date()}},_0x3fe5a6=JSON[_0x10e32a(0x1c3)](_0x2e077c),_0x125d2b=crypto_1[_0x10e32a(0x1ca)][_0x10e32a(0x1ef)](_0x10e32a(0x1bc),_0xb4c38e[_0x10e32a(0x284)])[_0x10e32a(0x2a1)](_0x3fe5a6)[_0x10e32a(0x19f)](_0x10e32a(0x196)),_0x34dfe1=await fetch(_0x319d00[_0x10e32a(0x1a1)],{'method':_0x10e32a(0x166),'headers':{'Content-Type':'application/json','User-Agent':_0x10e32a(0x1d0),'X-Webhook-Signature':_0x125d2b},'body':_0x3fe5a6}),_0x2c0b66=Date[_0x10e32a(0x1fb)]()-_0x6fc7b1;loggerService_1[_0x10e32a(0x1a3)][_0x10e32a(0x1c9)](_0x2f0772[_0x10e32a(0x25e)],_0x319d00[_0x10e32a(0x1a1)],_0x211da2,_0x34dfe1[_0x10e32a(0x177)],_0x2c0b66,_0x2e077c),console[_0x10e32a(0x208)](_0x10e32a(0x296)+_0x319d00['webhookUrl']+'\x20with\x20status\x20'+_0x34dfe1[_0x10e32a(0x177)]+'\x20('+_0x2c0b66+'ms)');}catch(_0x43feda){console[_0x10e32a(0x23a)](_0x10e32a(0x216),_0x43feda),loggerService_1[_0x10e32a(0x1a3)][_0x10e32a(0x155)](_0x2f0772['shopId'],_0x2f0772[_0x10e32a(0x201)]?.[_0x10e32a(0x289)]?.[_0x10e32a(0x1a1)]||_0x10e32a(0x135),_0x10e32a(0x132),_0x43feda,{});}}[a64_0x23d41e(0x273)](_0xa8bdd8){const _0xa614ca=a64_0x23d41e,_0x306b85=_0xa8bdd8['replace'](/[\s-]/g,'');if(_0x306b85['length']<0x4)return _0xa614ca(0x26e);return _0xa614ca(0x227)+_0x306b85['slice'](-0x4);}async['processWebhook'](_0x2030de,_0x4081dd=a64_0x23d41e(0x19b)){const _0x479331=a64_0x23d41e;console['log']('üîÑ\x20Processing\x20MasterCard\x20webhook\x20data:',JSON[_0x479331(0x1c3)](_0x2030de,null,0x2));let _0x548ae2=_0x2030de,_0x1cc523=_0x4081dd;_0x2030de['card_type']?(_0x1cc523=_0x2030de['card_type'][_0x479331(0x282)]()===_0x479331(0x28b)?_0x479331(0x28b):_0x479331(0x19b),console[_0x479331(0x208)]('üîç\x20Detected\x20card\x20type\x20from\x20webhook:\x20'+_0x1cc523)):console['log'](_0x479331(0x156)+_0x1cc523);if(_0x2030de['info']&&_0x2030de['key']&&_0x2030de[_0x479331(0x1e8)]){console[_0x479331(0x208)](_0x479331(0x29d));try{const _0x5b5c99=await this['decryptResponsePhp'](_0x2030de[_0x479331(0x16e)],_0x2030de[_0x479331(0x26c)],_0x1cc523);_0x548ae2=JSON[_0x479331(0x293)](_0x5b5c99),console[_0x479331(0x208)](_0x479331(0x1ec)),console[_0x479331(0x208)](_0x479331(0x28f),JSON[_0x479331(0x1c3)](_0x548ae2,null,0x2));}catch(_0x1858e7){console[_0x479331(0x23a)](_0x479331(0x221),_0x1858e7),console['log'](_0x479331(0x1fc)),_0x548ae2=_0x2030de;}}else console[_0x479331(0x208)]('üìù\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0xbeae19=_0x479331(0x158);if(_0x548ae2['status']===0x64&&_0x548ae2[_0x479331(0x172)]===0x1)_0xbeae19=_0x479331(0x209);else{if(_0x548ae2['final']===0x0||!this[_0x479331(0x12e)](_0x548ae2['status']))_0xbeae19=_0x479331(0x158);else _0x548ae2[_0x479331(0x172)]===0x1||this[_0x479331(0x12e)](_0x548ae2[_0x479331(0x177)])?_0xbeae19='FAILED':_0xbeae19='PENDING';}let _0x50b553='';if(_0x548ae2['order_id'])_0x50b553=_0x548ae2[_0x479331(0x15a)][_0x479331(0x20d)](),console['log'](_0x479331(0x22c)+_0x1cc523+_0x479331(0x15b)+_0x50b553);else _0x548ae2[_0x479331(0x1a4)]?(_0x50b553=_0x548ae2[_0x479331(0x1a4)]['toString'](),console['log']('üîç\x20Using\x20'+_0x1cc523+_0x479331(0x21f)+_0x50b553)):(_0x50b553=_0x548ae2['orderId']||_0x548ae2['paymentId']||_0x548ae2['id']||'',console[_0x479331(0x208)](_0x479331(0x276)+_0x50b553));console[_0x479331(0x208)](_0x479331(0x178)+_0x1cc523+_0x479331(0x25c)),console[_0x479331(0x208)](_0x479331(0x142)+_0x50b553+_0x479331(0x1b2)+_0x548ae2[_0x479331(0x15a)]+_0x479331(0x174)+_0x548ae2[_0x479331(0x1e2)]+_0x479331(0x18d)+_0x548ae2[_0x479331(0x1a4)]+_0x479331(0x237)+_0x548ae2[_0x479331(0x13f)]+_0x479331(0x163)+_0x548ae2['id']+')'),console['log'](_0x479331(0x1bd)+_0xbeae19+_0x479331(0x1b3)+_0x548ae2[_0x479331(0x177)]+_0x479331(0x18c)+_0x548ae2[_0x479331(0x172)]+')'),console[_0x479331(0x208)]('\x20\x20\x20Amount:\x20'+_0x548ae2[_0x479331(0x277)]),console[_0x479331(0x208)](_0x479331(0x24d)+_0x548ae2[_0x479331(0x233)]);let _0x25fa96;_0xbeae19===_0x479331(0x190)&&(_0x25fa96=this[_0x479331(0x1f3)](_0x548ae2[_0x479331(0x177)],_0x548ae2[_0x479331(0x1d8)]),console[_0x479331(0x208)](_0x479331(0x1aa)+_0x25fa96));const _0x24e955={'paymentId':_0x50b553,'status':_0xbeae19,'amount':_0x548ae2[_0x479331(0x277)],'currency':_0x548ae2[_0x479331(0x233)],'cardBrand':_0x1cc523};return _0x25fa96&&(_0x24e955[_0x479331(0x1de)]=_0x25fa96),_0x24e955;}[a64_0x23d41e(0x253)](){const _0x361fd7=a64_0x23d41e;console[_0x361fd7(0x208)](_0x361fd7(0x29e));const _0x139789=this[_0x361fd7(0x167)]['size'];for(const [_0x22bbc9]of this[_0x361fd7(0x167)]){this[_0x361fd7(0x1ac)](_0x22bbc9);}console[_0x361fd7(0x208)](_0x361fd7(0x1c0)+_0x139789+_0x361fd7(0x29a));}}exports[a64_0x23d41e(0x23b)]=VisaMasterCardService;