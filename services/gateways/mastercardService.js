'use strict';const a51_0x1e6e46=a51_0x4afb;(function(_0x18646e,_0x41c90b){const _0x36171d=a51_0x4afb,_0x15aad2=_0x18646e();while(!![]){try{const _0xed8d3d=-parseInt(_0x36171d(0x1e0))/0x1*(-parseInt(_0x36171d(0x1a0))/0x2)+parseInt(_0x36171d(0xdc))/0x3+-parseInt(_0x36171d(0xf2))/0x4+parseInt(_0x36171d(0x11e))/0x5*(-parseInt(_0x36171d(0x10a))/0x6)+parseInt(_0x36171d(0x14b))/0x7*(parseInt(_0x36171d(0x1d1))/0x8)+-parseInt(_0x36171d(0x164))/0x9+parseInt(_0x36171d(0x81))/0xa;if(_0xed8d3d===_0x41c90b)break;else _0x15aad2['push'](_0x15aad2['shift']());}catch(_0x5245f8){_0x15aad2['push'](_0x15aad2['shift']());}}}(a51_0x1e08,0x7c791));function a51_0x4afb(_0x3b4d6b,_0x5e9722){const _0x1e08da=a51_0x1e08();return a51_0x4afb=function(_0x4afbd2,_0x2d6bf8){_0x4afbd2=_0x4afbd2-0x7b;let _0x584b77=_0x1e08da[_0x4afbd2];return _0x584b77;},a51_0x4afb(_0x3b4d6b,_0x5e9722);}var __createBinding=this&&this[a51_0x1e6e46(0xe4)]||(Object[a51_0x1e6e46(0x1ab)]?function(_0x458f64,_0x45cb27,_0xd1ba68,_0x8cecb2){const _0x17b152=a51_0x1e6e46;if(_0x8cecb2===undefined)_0x8cecb2=_0xd1ba68;var _0x3e9476=Object['getOwnPropertyDescriptor'](_0x45cb27,_0xd1ba68);(!_0x3e9476||(_0x17b152(0x161)in _0x3e9476?!_0x45cb27[_0x17b152(0x122)]:_0x3e9476[_0x17b152(0x1a1)]||_0x3e9476[_0x17b152(0x13b)]))&&(_0x3e9476={'enumerable':!![],'get':function(){return _0x45cb27[_0xd1ba68];}}),Object[_0x17b152(0x12f)](_0x458f64,_0x8cecb2,_0x3e9476);}:function(_0x3cf1d6,_0x16d6e4,_0x368602,_0x2c4267){if(_0x2c4267===undefined)_0x2c4267=_0x368602;_0x3cf1d6[_0x2c4267]=_0x16d6e4[_0x368602];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a51_0x1e6e46(0x1ab)]?function(_0x538fe1,_0x50716b){const _0x1b7208=a51_0x1e6e46;Object[_0x1b7208(0x12f)](_0x538fe1,_0x1b7208(0x140),{'enumerable':!![],'value':_0x50716b});}:function(_0x223d52,_0x594651){const _0x391fc1=a51_0x1e6e46;_0x223d52[_0x391fc1(0x140)]=_0x594651;}),__importStar=this&&this[a51_0x1e6e46(0x1c1)]||(function(){var _0x427495=function(_0x3562fa){const _0x20e88a=a51_0x4afb;return _0x427495=Object[_0x20e88a(0x112)]||function(_0x8f53f5){const _0x41bf55=_0x20e88a;var _0x32d272=[];for(var _0x165890 in _0x8f53f5)if(Object[_0x41bf55(0x1de)][_0x41bf55(0xdb)]['call'](_0x8f53f5,_0x165890))_0x32d272[_0x32d272[_0x41bf55(0x186)]]=_0x165890;return _0x32d272;},_0x427495(_0x3562fa);};return function(_0x1eb571){const _0x41b8f2=a51_0x4afb;if(_0x1eb571&&_0x1eb571[_0x41b8f2(0x122)])return _0x1eb571;var _0x68f6b9={};if(_0x1eb571!=null){for(var _0x3530a4=_0x427495(_0x1eb571),_0xd7659c=0x0;_0xd7659c<_0x3530a4[_0x41b8f2(0x186)];_0xd7659c++)if(_0x3530a4[_0xd7659c]!==_0x41b8f2(0x140))__createBinding(_0x68f6b9,_0x1eb571,_0x3530a4[_0xd7659c]);}return __setModuleDefault(_0x68f6b9,_0x1eb571),_0x68f6b9;};}()),__importDefault=this&&this['__importDefault']||function(_0x152b11){const _0xce7b46=a51_0x1e6e46;return _0x152b11&&_0x152b11[_0xce7b46(0x122)]?_0x152b11:{'default':_0x152b11};};Object['defineProperty'](exports,a51_0x1e6e46(0x122),{'value':!![]}),exports['VisaMasterCardService']=void 0x0;const crypto_1=__importDefault(require(a51_0x1e6e46(0x105))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x1e6e46(0x169))),loggerService_1=require(a51_0x1e6e46(0x12c));function a51_0x1e08(){const _0x448537=['❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','logWhiteDomainError','decryptResponsePhp','Failed\x20payment','🔐\x20VISA\x20Private\x20key\x20path:','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','600140OuEhCx','writable','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','Payment\x20returned','📝\x20Data\x20length:','shop','visa/mastercard','psp_public.pem','HTTP\x20error!\x20status:\x20','Payment\x20is\x20being\x20processed','toUpperCase','create','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','🔐\x20AES\x20key\x20and\x20IV\x20generated','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','description','\x20payment:\x20','The\x20card\x20does\x20not\x20exist','📤\x20Sending\x20request\x20to\x20API...','../telegramBotService','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','/charge_decrypted','-----END','🎯\x20Using\x20','Insufficient\x20funds\x20on\x20the\x20card','cvv','visa_private.pem','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','Order\x20ID:','\x20characters','🔐\x203DS\x20verification\x20required','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','__importStar','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','Payment\x20prohibited','Sender\x27s\x20card\x20details\x20are\x20required','Payment\x20confirmation\x20time\x20has\x20expired','Another\x20unknown\x20error','\x20order_id\x20for\x20search:\x20','customerName','stringify','application/json','end','Status:',',\x20orderId=','Payment\x20confirmation\x20required','isFinalStatus','delete','240rYSGfA','merchantPointId','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','visa_public.pem','adminNotes','size','The\x20card\x20is\x20lost\x20or\x20stolen','amount','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','paymentId','toLowerCase','scheduleStatusChecks','forEach','prototype','randomBytes','1ntJQXI','🔐\x20MasterCard\x20API\x20URL:','Payment\x20ID:','failed','encryptAES','push','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','apiUrl','https://api.paydmeth.com/api','Payment\x20cancellation\x20is\x20being\x20processed','7071530egwFWL','masterCardMerchantPointId','trim','No\x20New\x20payment','📝\x20Signature\x20length:','resolve','📊\x20Status\x20check\x20#','/status','text','Failed\x20to\x20decrypt\x20response','https://api2.trapay.uk/decrypt.php','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code',',\x20id=','updatePaymentStatus','key','message','VISA/MasterCard','\x20result:',',\x20payment_id=','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','LookUp\x20code\x20sent','existsSync','3DS\x20verification\x20required','floor','Response\x20Time:','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','Status\x20','PENDING','PAID','private.pem','createdAt','substring','Request\x20data\x20error','from','sign','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','visaApiUrl','payment','utf8','includes','warn','Error\x20details:','Expected\x20bitcoin\x20transfer\x20from\x20client','\x20\x20\x20-\x20lang:\x20en','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','logWhiteDomainResponse','\x20status\x20checks\x20for\x20payment\x20','📝\x20Encrypted\x20key\x20length:','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','number','status','\x20status\x20check\x20error:','💳\x20VISA/MasterCard\x20service\x20initialized','Sender\x20information\x20required','\x20status\x20check\x20#','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','Card\x20Number:','orderId','publicKeyPath','...','generateAESKey','encryptRSA','sendPaymentNotifications','\x20\x20Original:\x20\x22','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','paid','getCardTypeAndApi','===\x20PARSED\x20API\x20RESPONSE\x20===','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','\x20\x20\x20-\x20info\x20length:','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','Captcha\x20confirmation\x20awaited','❌\x20Data\x20being\x20signed:','shopId','/charge_raw','Method\x20not\x20allowed','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','final','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','payment_id','stopAllStatusChecks','Failed\x20to\x20send\x20MasterCard\x20webhook:','logShopWebhookSent','last_name','signRSA','Unsuccessful\x20payment','Status\x20decryption\x20failed:\x20','Payment\x20System/1.0\x20(MasterCard)','===\x20API\x20RESPONSE\x20===','join','hasOwnProperty','2230020SEgcLj','\x20API:\x20','🔐\x20Using\x20keys:\x20','visaMerchantPointId','❌\x20Detailed\x20failure\x20description:\x20','VISA/MasterCard\x20payment\x20successful','masterCardApiUrl','🔐\x20MasterCard\x20Public\x20key\x20path:','__createBinding','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','cardType','paymentStatuses','validateKeyFiles','paidAt','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','charge','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','🔐\x20VISA\x20Private\x20key\x20length:\x20','loggerService','privateKeyPath','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','2884724OeUoRn','💾\x20Saving\x20failure\x20message:\x20','then','❌\x20RSA\x20encryption\x20failed:','📝\x20Decrypted\x20webhook\x20data:','🧹\x20Clearing\x20','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','readFileSync','RSA_PKCS1_PADDING','Number\x20of\x20attempts\x20exceeded','checkPaymentStatus','HTTP\x20Status:','✅\x20Scheduled\x20','desc','/status_decrypted','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','expire_month','currency','parse','crypto','keys','toString','🛑\x20Stopped\x20',',\x20paymentId=','3780402QYEEZe','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','Transaction\x20limit\x20exceeded','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','Recipient\x20data\x20required','⏰\x20Will\x20check\x20status\x20','charAt','📊\x20','getOwnPropertyNames','\x20for\x20payment\x20','\x20status\x20updated\x20to\x20','decryptResponse','MasterCard\x20webhook\x20sent\x20to\x20','Invalid\x20expiration\x20date','VISA','set','🔐\x20AES\x20key\x20length:','order_id','slice','\x20\x20\x20Currency:\x20','5bxtkoU','\x20\x20\x20-\x20sign\x20length:','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Client\x20OTP\x20confirmation\x20required','__esModule','error','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','⏰\x20Scheduling\x20status\x20checks\x20for\x20','webhookEvents','failureMessage','getDetailedErrorMessage','Amount:','/status_raw','log','../loggerService','Response\x20Body:','LookUp\x20number\x20of\x20attempts\x20exceeded','defineProperty','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','🔍\x20Using\x20provided\x20card\x20type:\x20','date_success','❌\x20Status\x20check\x20#','\x20\x20\x20-\x20key\x20length:','-----BEGIN','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','3ds_url','settings','info','✅\x20Payment\x20','configurable','visaPublicKeyPath','clearStatusTimers','🔍\x20Using\x20','No\x20Error\x20executing\x20request','default','\x20(from:\x20status=',',\x20body:\x20','\x20payment_id\x20for\x20search:\x20','first_name','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','4000000000000000','createCipheriv','🔐\x20Data\x20encrypted\x20with\x20AES','webhook_send','base64','176365llLvvX','visaPrivateKeyPath','\x20\x20Cleaned:\x20\x20\x22','\x20|\x20Response:\x20','Payment\x20pending\x20verification','\x20(from:\x20order_id=','VisaMasterCardService','\x20webhook\x20extracted\x20data:','decryptAES','Payment\x20System/1.0','update','webhookUrl','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','\x20\x20\x20Amount:\x20','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','constants','\x22\x20|\x20\x22','../../config/database','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','🔐\x20VISA\x20Public\x20key\x20path:','Webhook\x20event\x20','Decryption\x20failed:\x20','get','Sender\x27s\x20CVV\x20card\x20is\x20required','sendPaymentNotification','5807916BVaNsT','statusCheckTimers','\x20\x20\x20-\x20method:\x20charge','\x20status\x20timers\x20for\x20payment\x20','MASTERCARD','path','Failed\x20to\x20check\x20','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','Awaiting\x20confirmation\x20by\x20ivr\x20call','payment.success','errorMessage','📝\x20Final\x20request\x20structure:','),\x20stopping\x20status\x20checks','card_type','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','/charge','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','\x20\x20\x20-\x20merchant_point_id:','json','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','Unknown\x20error','logShopWebhookError','replace','📝\x20Encrypted\x20data\x20length:','3DS\x20URL:','Final:','system','now','💾\x20Payment\x20data\x20prepared','****\x20****\x20****\x20','ms)','POST','unknown','cwd','length','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','HTTP\x20','🔐\x20MasterCard\x20Private\x20key\x20path:','🔐\x20AES\x20IV\x20length:','logWhiteDomainRequest','Card\x20Holder:','✅\x20VISA\x20key\x20files\x20validated\x20successfully','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','\x20payment\x20status:\x20','createDecipheriv','📝\x20Data\x20to\x20sign\x20length:','✅\x20Payment\x20successful','expire_year','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','\x20MasterCard\x20status\x20check\x20timers','\x20failed\x20for\x20payment\x20','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','FAILED','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'];a51_0x1e08=function(){return _0x448537;};return a51_0x1e08();}class VisaMasterCardService{constructor(){const _0x1dd4e3=a51_0x1e6e46;this[_0x1dd4e3(0x165)]=new Map(),this[_0x1dd4e3(0xe8)]={0x0:{'final':![],'description':_0x1dd4e3(0x84)},0x1:{'final':![],'description':_0x1dd4e3(0x13f)},0x2:{'final':!![],'description':_0x1dd4e3(0xa1)},0x3:{'final':!![],'description':_0x1dd4e3(0x1c6)},0x4:{'final':!![],'description':'Unsuccessful\x20payment'},0x5:{'final':!![],'description':_0x1dd4e3(0x1bf)},0x6:{'final':!![],'description':_0x1dd4e3(0x1a3)},0x7:{'final':!![],'description':'Test\x20payment'},0x8:{'final':![],'description':_0x1dd4e3(0x121)},0x9:{'final':![],'description':_0x1dd4e3(0x97)},0xa:{'final':![],'description':_0x1dd4e3(0x162)},0xb:{'final':![],'description':_0x1dd4e3(0xb6)},0xc:{'final':![],'description':_0x1dd4e3(0x10e)},0xd:{'final':![],'description':_0x1dd4e3(0x7d)},0xe:{'final':![],'description':_0x1dd4e3(0x16c)},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':_0x1dd4e3(0xc8)},0x11:{'final':![],'description':_0x1dd4e3(0x177)},0x12:{'final':![],'description':'Awaiting\x20confirmation\x20in\x20the\x20application'},0x13:{'final':![],'description':_0x1dd4e3(0x1a9)},0x14:{'final':![],'description':_0x1dd4e3(0x1d3)},0x15:{'final':![],'description':_0x1dd4e3(0xab)},0x16:{'final':![],'description':_0x1dd4e3(0x14f)},0x18:{'final':![],'description':_0x1dd4e3(0x199)},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':'Cash\x20payment\x20is\x20expected\x20at\x20TCO'},0x1b:{'final':![],'description':_0x1dd4e3(0x8c)},0x1c:{'final':![],'description':_0x1dd4e3(0x136)},0x1d:{'final':![],'description':_0x1dd4e3(0x1a2)},0x1f:{'final':![],'description':_0x1dd4e3(0x194)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':_0x1dd4e3(0x1c4)},0x24:{'final':!![],'description':_0x1dd4e3(0x1c5)},0x25:{'final':!![],'description':_0x1dd4e3(0x1c3)},0x26:{'final':!![],'description':_0x1dd4e3(0xb8)},0x27:{'final':!![],'description':_0x1dd4e3(0x1b8)},0x28:{'final':!![],'description':_0x1dd4e3(0x1b1)},0x29:{'final':!![],'description':_0x1dd4e3(0x1d7)},0x2a:{'final':!![],'description':_0x1dd4e3(0x117)},0x2b:{'final':!![],'description':_0x1dd4e3(0x10c)},0x2c:{'final':!![],'description':_0x1dd4e3(0xe5)},0x2d:{'final':!![],'description':_0x1dd4e3(0x19d)},0x2e:{'final':!![],'description':_0x1dd4e3(0xd6)},0x2f:{'final':!![],'description':'Unsuccessful\x20payment'},0x30:{'final':!![],'description':'Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled'},0x31:{'final':![],'description':_0x1dd4e3(0x1ce)},0x32:{'final':!![],'description':_0x1dd4e3(0xcc)},0x33:{'final':!![],'description':_0x1dd4e3(0x19d)},0x34:{'final':!![],'description':'Failed\x20payment'},0x35:{'final':!![],'description':_0x1dd4e3(0x19d)},0x36:{'final':!![],'description':'Failed\x20payment'},0x37:{'final':!![],'description':_0x1dd4e3(0x19d)},0x38:{'final':!![],'description':'Cancellation\x20is\x20not\x20possible'},0x39:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank'},0x3a:{'final':![],'description':_0x1dd4e3(0x95)},0x3b:{'final':!![],'description':'LookUp\x20code\x20verified'},0x3c:{'final':!![],'description':_0x1dd4e3(0xfb)},0x3d:{'final':!![],'description':_0x1dd4e3(0x1c2)},0x3e:{'final':!![],'description':_0x1dd4e3(0xf8)},0x3f:{'final':!![],'description':_0x1dd4e3(0x1a3)},0x40:{'final':![],'description':'LookUp\x20not\x20confirmed'},0x41:{'final':!![],'description':_0x1dd4e3(0x12e)},0x42:{'final':![],'description':_0x1dd4e3(0x80)},0x43:{'final':!![],'description':_0x1dd4e3(0x19f)},0x44:{'final':![],'description':'3DS\x20verification\x20required'},0x45:{'final':!![],'description':'Failed\x20payment'},0x46:{'final':!![],'description':_0x1dd4e3(0x19d)},0x47:{'final':!![],'description':_0x1dd4e3(0x174)},0x64:{'final':!![],'description':'Operation\x20completed\x20successfully'}},this[_0x1dd4e3(0xe2)]=_0x1dd4e3(0x7f),this[_0x1dd4e3(0x82)]=0x6e4,this[_0x1dd4e3(0xf0)]=path_1[_0x1dd4e3(0x140)][_0x1dd4e3(0xda)](process[_0x1dd4e3(0x185)](),_0x1dd4e3(0x106),_0x1dd4e3(0x9e)),this['publicKeyPath']=path_1['default'][_0x1dd4e3(0xda)](process[_0x1dd4e3(0x185)](),_0x1dd4e3(0x106),_0x1dd4e3(0x1a7)),this[_0x1dd4e3(0xa5)]=_0x1dd4e3(0x7f),this[_0x1dd4e3(0xdf)]=0x6b7,this[_0x1dd4e3(0x14c)]=path_1['default']['join'](process[_0x1dd4e3(0x185)](),'keys',_0x1dd4e3(0x1ba)),this[_0x1dd4e3(0x13c)]=path_1[_0x1dd4e3(0x140)][_0x1dd4e3(0xda)](process['cwd'](),_0x1dd4e3(0x106),_0x1dd4e3(0x1d4)),console[_0x1dd4e3(0x12b)](_0x1dd4e3(0xb5)),console['log'](_0x1dd4e3(0x1e1),this['masterCardApiUrl']),console[_0x1dd4e3(0x12b)]('🔐\x20VISA\x20API\x20URL:',this[_0x1dd4e3(0xa5)]),console[_0x1dd4e3(0x12b)](_0x1dd4e3(0x189),this[_0x1dd4e3(0xf0)]),console[_0x1dd4e3(0x12b)](_0x1dd4e3(0xe3),this['publicKeyPath']),console['log'](_0x1dd4e3(0x19e),this[_0x1dd4e3(0x14c)]),console[_0x1dd4e3(0x12b)](_0x1dd4e3(0x15e),this[_0x1dd4e3(0x13c)]),this[_0x1dd4e3(0xe9)]();}[a51_0x1e6e46(0x128)](_0x14aea5,_0x22dd8b){const _0x545355=a51_0x1e6e46,_0x4931aa=this[_0x545355(0xe8)][_0x14aea5];let _0x1e7d8f='';_0x4931aa?_0x1e7d8f=_0x545355(0x9b)+_0x14aea5+':\x20'+_0x4931aa[_0x545355(0x1af)]:_0x1e7d8f=_0x545355(0x9b)+_0x14aea5+':\x20Unknown\x20status\x20code';if(_0x22dd8b&&_0x22dd8b['trim']()){const _0x3b3ed8=_0x22dd8b[_0x545355(0x83)]();(!_0x4931aa||_0x3b3ed8[_0x545355(0x1db)]()!==_0x4931aa['description'][_0x545355(0x1db)]())&&(_0x1e7d8f+=_0x545355(0x14e)+_0x3b3ed8);}return _0x1e7d8f;}[a51_0x1e6e46(0x1cf)](_0x5b0e34){const _0x5bb0d5=a51_0x1e6e46,_0x434cd5=this['paymentStatuses'][_0x5b0e34];return _0x434cd5?_0x434cd5[_0x5bb0d5(0xce)]:!![];}['getCardTypeAndApi'](_0x43c7f5){const _0x11dec5=a51_0x1e6e46,_0x345b7c=_0x43c7f5[_0x11dec5(0x110)](0x0);if(_0x345b7c==='4')return console['log']('💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)'),{'cardType':'VISA','apiUrl':this[_0x11dec5(0xa5)],'privateKeyPath':this['visaPrivateKeyPath'],'publicKeyPath':this[_0x11dec5(0x13c)],'merchantPointId':this[_0x11dec5(0xdf)]};else return _0x345b7c==='5'?(console['log'](_0x11dec5(0xcf)),{'cardType':_0x11dec5(0x168),'apiUrl':this[_0x11dec5(0xe2)],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x11dec5(0xbb)],'merchantPointId':this[_0x11dec5(0x82)]}):(console[_0x11dec5(0x12b)](_0x11dec5(0x1ae)+_0x345b7c+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':_0x11dec5(0x168),'apiUrl':this[_0x11dec5(0xe2)],'privateKeyPath':this[_0x11dec5(0xf0)],'publicKeyPath':this[_0x11dec5(0xbb)],'merchantPointId':this[_0x11dec5(0x82)]});}[a51_0x1e6e46(0xe9)](){const _0x461be3=a51_0x1e6e46;try{if(!fs_1[_0x461be3(0x140)][_0x461be3(0x96)](this[_0x461be3(0xf0)]))throw new Error(_0x461be3(0x94)+this[_0x461be3(0xf0)]);if(!fs_1['default'][_0x461be3(0x96)](this['publicKeyPath']))throw new Error(_0x461be3(0xad)+this[_0x461be3(0xbb)]);const _0x1951c7=fs_1[_0x461be3(0x140)][_0x461be3(0xf9)](this[_0x461be3(0xf0)],'utf8')[_0x461be3(0x83)](),_0x85d800=fs_1[_0x461be3(0x140)][_0x461be3(0xf9)](this[_0x461be3(0xbb)],'utf8')[_0x461be3(0x83)]();if(!_0x1951c7['includes'](_0x461be3(0x135))||!_0x1951c7[_0x461be3(0xa8)](_0x461be3(0x1b6)))throw new Error(_0x461be3(0x197));if(!_0x85d800[_0x461be3(0xa8)]('-----BEGIN')||!_0x85d800['includes'](_0x461be3(0x1b6)))throw new Error(_0x461be3(0x159));console[_0x461be3(0x12b)](_0x461be3(0xeb)),console[_0x461be3(0x12b)]('🔐\x20MasterCard\x20Private\x20key\x20length:\x20'+_0x1951c7[_0x461be3(0x186)]+_0x461be3(0x1bd)),console['log']('🔐\x20MasterCard\x20Public\x20key\x20length:\x20'+_0x85d800[_0x461be3(0x186)]+_0x461be3(0x1bd));if(fs_1[_0x461be3(0x140)]['existsSync'](this['visaPrivateKeyPath'])&&fs_1['default'][_0x461be3(0x96)](this['visaPublicKeyPath'])){const _0x162f4c=fs_1[_0x461be3(0x140)]['readFileSync'](this[_0x461be3(0x14c)],_0x461be3(0xa7))[_0x461be3(0x83)](),_0x107f7e=fs_1['default'][_0x461be3(0xf9)](this[_0x461be3(0x13c)],_0x461be3(0xa7))[_0x461be3(0x83)]();(!_0x162f4c['includes'](_0x461be3(0x135))||!_0x162f4c[_0x461be3(0xa8)]('-----END'))&&console[_0x461be3(0xa9)](_0x461be3(0x120)),(!_0x107f7e[_0x461be3(0xa8)]('-----BEGIN')||!_0x107f7e[_0x461be3(0xa8)](_0x461be3(0x1b6)))&&console[_0x461be3(0xa9)](_0x461be3(0xcd)),console[_0x461be3(0x12b)](_0x461be3(0x18d)),console[_0x461be3(0x12b)](_0x461be3(0xee)+_0x162f4c[_0x461be3(0x186)]+_0x461be3(0x1bd)),console[_0x461be3(0x12b)]('🔐\x20VISA\x20Public\x20key\x20length:\x20'+_0x107f7e[_0x461be3(0x186)]+_0x461be3(0x1bd));}else console[_0x461be3(0xa9)](_0x461be3(0xb1)),console[_0x461be3(0xa9)](_0x461be3(0x1ac)+this[_0x461be3(0x14c)]),console[_0x461be3(0xa9)]('⚠️\x20Expected\x20VISA\x20public\x20key:\x20'+this[_0x461be3(0x13c)]);}catch(_0x1918a1){console[_0x461be3(0x123)](_0x461be3(0x130),_0x1918a1);throw _0x1918a1;}}['generateAESKey'](){const _0x43f2bc=a51_0x1e6e46,_0x37f39b=crypto_1[_0x43f2bc(0x140)][_0x43f2bc(0x1df)](0x20),_0x24a312=crypto_1[_0x43f2bc(0x140)][_0x43f2bc(0x1df)](0x10);return{'key':_0x37f39b,'iv':_0x24a312};}[a51_0x1e6e46(0x7b)](_0x26e8ca,_0x535dba,_0x53c5c4){const _0x59443b=a51_0x1e6e46,_0x5a59f4=crypto_1[_0x59443b(0x140)][_0x59443b(0x147)]('aes-256-ctr',_0x535dba,_0x53c5c4);let _0x960f54=_0x5a59f4['update'](_0x26e8ca,_0x59443b(0xa7),_0x59443b(0x14a));return _0x960f54+=_0x5a59f4['final'](_0x59443b(0x14a)),_0x960f54;}[a51_0x1e6e46(0xbe)](_0x4ec9c7,_0x47fc08,_0x46d113){const _0x1faa3f=a51_0x1e6e46;try{const _0x313788=fs_1[_0x1faa3f(0x140)]['readFileSync'](_0x46d113,_0x1faa3f(0xa7))[_0x1faa3f(0x83)](),_0x1f7c0b={'iv':_0x47fc08['toString'](_0x1faa3f(0x14a)),'key':_0x4ec9c7[_0x1faa3f(0x107)](_0x1faa3f(0x14a))},_0x55091c=JSON[_0x1faa3f(0x1c9)](_0x1f7c0b);console['log'](_0x1faa3f(0xc5),_0x55091c[_0x1faa3f(0x186)]);const _0x929766=crypto_1[_0x1faa3f(0x140)]['publicEncrypt']({'key':_0x313788,'padding':crypto_1['default'][_0x1faa3f(0x15a)][_0x1faa3f(0xfa)]},Buffer[_0x1faa3f(0xa2)](_0x55091c));return console[_0x1faa3f(0x12b)](_0x1faa3f(0x18e),_0x929766[_0x1faa3f(0x186)]),_0x929766[_0x1faa3f(0x107)](_0x1faa3f(0x14a));}catch(_0x5b20ff){console[_0x1faa3f(0x123)](_0x1faa3f(0xf5),_0x5b20ff);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a51_0x1e6e46(0xd5)](_0xbf8bbd,_0x4d9f68){const _0xe196a9=a51_0x1e6e46;try{const _0x65303d=fs_1[_0xe196a9(0x140)]['readFileSync'](_0x4d9f68,_0xe196a9(0xa7))[_0xe196a9(0x83)](),_0x4dedf2=crypto_1[_0xe196a9(0x140)]['createSign']('SHA256');_0x4dedf2['update'](_0xbf8bbd),_0x4dedf2[_0xe196a9(0x1cb)]();const _0x4fb4d6=_0x4dedf2[_0xe196a9(0xa3)](_0x65303d,'base64');return console['log']('🔐\x20RSA\x20signing\x20successful'),console[_0xe196a9(0x12b)](_0xe196a9(0x191),_0xbf8bbd[_0xe196a9(0x186)]),console[_0xe196a9(0x12b)](_0xe196a9(0x85),_0x4fb4d6['length']),_0x4fb4d6;}catch(_0x3d43e4){console['error']('❌\x20RSA\x20signing\x20failed:',_0x3d43e4),console[_0xe196a9(0x123)](_0xe196a9(0xc9),_0xbf8bbd[_0xe196a9(0xa0)](0x0,0xc8)+_0xe196a9(0xbc));throw new Error(_0xe196a9(0x145));}}['decryptAES'](_0x47069f,_0x191148,_0x42b69b){const _0xd3f7b3=a51_0x1e6e46,_0x592854=crypto_1['default'][_0xd3f7b3(0x190)]('aes-256-ctr',_0x191148,_0x42b69b);let _0x4d9f0d=_0x592854[_0xd3f7b3(0x155)](_0x47069f,_0xd3f7b3(0x14a),_0xd3f7b3(0xa7));return _0x4d9f0d+=_0x592854[_0xd3f7b3(0xce)](_0xd3f7b3(0xa7)),_0x4d9f0d;}async[a51_0x1e6e46(0x19c)](_0x5503d1,_0x25670d,_0x2289c5=a51_0x1e6e46(0x168)){const _0x583513=a51_0x1e6e46;try{const _0x59fee5=await fetch(_0x583513(0x8b),{'method':'POST','headers':{'Content-Type':_0x583513(0x1ca)},'body':JSON[_0x583513(0x1c9)]({'info':_0x5503d1,'key':_0x25670d,'card_type':_0x2289c5[_0x583513(0x1db)]()})});if(!_0x59fee5['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x59fee5[_0x583513(0x89)]();}catch(_0x2ffc08){console['error']('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x2ffc08);throw new Error(_0x583513(0x10b));}}[a51_0x1e6e46(0x115)](_0x358ff4,_0x141621){const _0x37eea4=a51_0x1e6e46;try{const _0x9ec1af=fs_1[_0x37eea4(0x140)][_0x37eea4(0xf9)](this[_0x37eea4(0xf0)],_0x37eea4(0xa7))[_0x37eea4(0x83)](),_0x596551=crypto_1[_0x37eea4(0x140)]['privateDecrypt'](_0x9ec1af,Buffer['from'](_0x141621,_0x37eea4(0x14a))),_0x3cb88e=JSON['parse'](_0x596551[_0x37eea4(0x107)]()),_0x247ddb=Buffer[_0x37eea4(0xa2)](_0x3cb88e[_0x37eea4(0x8f)],_0x37eea4(0x14a)),_0x59f6d4=Buffer[_0x37eea4(0xa2)](_0x3cb88e['iv'],_0x37eea4(0x14a));return this[_0x37eea4(0x153)](_0x358ff4,_0x247ddb,_0x59f6d4);}catch(_0x12b556){throw new Error(_0x37eea4(0x8a));}}async['processCardPayment'](_0x18e97b){const _0x44b1bf=a51_0x1e6e46,{paymentId:_0x4b64ae,orderId:_0x512c86,amount:_0x1a8e85,currency:_0x290a92,cardData:_0x189ee5,resultUrl:_0x19fd4f,returnUrl:_0x52454e,cardHolder:_0x5e3e4a,browser:_0x38c089}=_0x18e97b;console[_0x44b1bf(0x12b)](_0x44b1bf(0x1d9)),console[_0x44b1bf(0x12b)]('Payment\x20ID:',_0x4b64ae),console[_0x44b1bf(0x12b)](_0x44b1bf(0x1bc),_0x512c86),console[_0x44b1bf(0x12b)](_0x44b1bf(0x129),_0x1a8e85,_0x290a92),console[_0x44b1bf(0x12b)](_0x44b1bf(0xb9),this['maskCardNumber'](_0x189ee5[_0x44b1bf(0xb2)])),console[_0x44b1bf(0x12b)](_0x44b1bf(0x18c),_0x5e3e4a[_0x44b1bf(0x144)]+'\x20'+_0x5e3e4a['last_name']),console[_0x44b1bf(0x12b)]('Return\x20URL:',_0x52454e),console[_0x44b1bf(0x12b)]('Result\x20URL:',_0x19fd4f);const _0x412cac=this[_0x44b1bf(0xc3)](_0x189ee5[_0x44b1bf(0xb2)]);console['log'](_0x44b1bf(0x1b7)+_0x412cac[_0x44b1bf(0xe7)]+_0x44b1bf(0xdd)+_0x412cac[_0x44b1bf(0x7e)]),console['log'](_0x44b1bf(0xde)+_0x412cac['privateKeyPath']+',\x20'+_0x412cac['publicKeyPath']);const _0x4f3072={..._0x5e3e4a,'first_name':_0x5e3e4a[_0x44b1bf(0x144)]?.[_0x44b1bf(0x17a)](/[\t\n\r\f\v]/g,'\x20')[_0x44b1bf(0x83)]()||'','last_name':_0x5e3e4a['last_name']?.[_0x44b1bf(0x17a)](/[\t\n\r\f\v]/g,'\x20')[_0x44b1bf(0x83)]()||''};console['log']('🧹\x20Card\x20holder\x20names\x20cleaned:'),console['log'](_0x44b1bf(0xc0)+_0x5e3e4a['first_name']+_0x44b1bf(0x15b)+_0x5e3e4a[_0x44b1bf(0xd4)]+'\x22'),console[_0x44b1bf(0x12b)](_0x44b1bf(0x14d)+_0x4f3072[_0x44b1bf(0x144)]+'\x22\x20|\x20\x22'+_0x4f3072[_0x44b1bf(0xd4)]+'\x22');const _0x3d5cc9={'amount':_0x1a8e85,'currency':_0x290a92[_0x44b1bf(0x1aa)](),'order_id':_0x512c86,'result_url':_0x19fd4f,'return_url':_0x52454e,'country':'','card':{'number':_0x189ee5[_0x44b1bf(0xb2)],'expire_month':_0x189ee5[_0x44b1bf(0x102)],'expire_year':_0x189ee5[_0x44b1bf(0x193)],'cvv':_0x189ee5[_0x44b1bf(0x1b9)]},'card_holder':_0x4f3072,'browser':_0x38c089},_0x1cf0b0=JSON[_0x44b1bf(0x1c9)](_0x3d5cc9);console[_0x44b1bf(0x12b)](_0x44b1bf(0x180)),console[_0x44b1bf(0x12b)](_0x44b1bf(0x124)),console[_0x44b1bf(0x12b)](_0x1cf0b0),console[_0x44b1bf(0x12b)](_0x44b1bf(0x1a4),_0x1cf0b0[_0x44b1bf(0x186)]);try{const {key:_0x4f8f0a,iv:_0x2d48fe}=this[_0x44b1bf(0xbd)]();console['log'](_0x44b1bf(0x1ad)),console[_0x44b1bf(0x12b)](_0x44b1bf(0x11a),_0x4f8f0a[_0x44b1bf(0x186)]),console['log'](_0x44b1bf(0x18a),_0x2d48fe[_0x44b1bf(0x186)]);const _0x1a38db=this[_0x44b1bf(0x7b)](_0x1cf0b0,_0x4f8f0a,_0x2d48fe);console[_0x44b1bf(0x12b)](_0x44b1bf(0x148)),console[_0x44b1bf(0x12b)](_0x44b1bf(0x17b),_0x1a38db['length']);const _0x4a9b4b=this[_0x44b1bf(0xbe)](_0x4f8f0a,_0x2d48fe,_0x412cac[_0x44b1bf(0xbb)]);console['log'](_0x44b1bf(0xf1)),console['log'](_0x44b1bf(0xb0),_0x4a9b4b[_0x44b1bf(0x186)]);const _0x50e7d0=this[_0x44b1bf(0xd5)](_0x1cf0b0,_0x412cac[_0x44b1bf(0xf0)]);console[_0x44b1bf(0x12b)]('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x44b1bf(0x12b)](_0x44b1bf(0x85),_0x50e7d0[_0x44b1bf(0x186)]);const _0x4a128f={'merchant_point_id':_0x412cac['merchantPointId'],'method':'charge','info':_0x1a38db,'key':_0x4a9b4b,'sign':_0x50e7d0,'lang':'en'};console[_0x44b1bf(0x12b)](_0x44b1bf(0x1b2)),console[_0x44b1bf(0x12b)](_0x44b1bf(0x16f)),console[_0x44b1bf(0x12b)](_0x44b1bf(0x175),_0x412cac[_0x44b1bf(0x1d2)]),console['log'](_0x44b1bf(0x166)),console[_0x44b1bf(0x12b)](_0x44b1bf(0xc6),_0x1a38db[_0x44b1bf(0x186)]),console[_0x44b1bf(0x12b)](_0x44b1bf(0x134),_0x4a9b4b[_0x44b1bf(0x186)]),console['log'](_0x44b1bf(0x11f),_0x50e7d0[_0x44b1bf(0x186)]),console[_0x44b1bf(0x12b)](_0x44b1bf(0xac)),loggerService_1[_0x44b1bf(0xef)][_0x44b1bf(0x18b)](_0x412cac[_0x44b1bf(0xe7)][_0x44b1bf(0x1db)](),_0x44b1bf(0x173),_0x44b1bf(0x183),{'merchant_point_id':_0x412cac[_0x44b1bf(0x1d2)],'method':_0x44b1bf(0xec),'lang':'en'});const _0x2f85b8=Date[_0x44b1bf(0x17f)](),_0x393b11=await fetch(_0x412cac[_0x44b1bf(0x7e)],{'method':_0x44b1bf(0x183),'headers':{'Content-Type':_0x44b1bf(0x1ca),'Accept':_0x44b1bf(0x1ca),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x44b1bf(0x1c9)](_0x4a128f)}),_0x45b79f=Date[_0x44b1bf(0x17f)]()-_0x2f85b8;console[_0x44b1bf(0x12b)](_0x44b1bf(0xd9)),console[_0x44b1bf(0x12b)](_0x44b1bf(0x1cc),_0x393b11[_0x44b1bf(0xb3)]),console[_0x44b1bf(0x12b)](_0x44b1bf(0x99),_0x45b79f+'ms');if(!_0x393b11['ok']){const _0x170bb4=await _0x393b11[_0x44b1bf(0x89)]();console[_0x44b1bf(0x123)](_0x44b1bf(0xfd),_0x393b11[_0x44b1bf(0xb3)]),console[_0x44b1bf(0x123)](_0x44b1bf(0x12d),_0x170bb4),loggerService_1[_0x44b1bf(0xef)][_0x44b1bf(0xae)](_0x412cac[_0x44b1bf(0xe7)][_0x44b1bf(0x1db)](),_0x44b1bf(0xcb),_0x393b11[_0x44b1bf(0xb3)],_0x170bb4,_0x45b79f),loggerService_1[_0x44b1bf(0xef)]['logWhiteDomainError'](_0x412cac[_0x44b1bf(0xe7)][_0x44b1bf(0x1db)](),_0x44b1bf(0x173),_0x44b1bf(0x188)+_0x393b11[_0x44b1bf(0xb3)]+':\x20'+_0x170bb4);throw new Error(_0x44b1bf(0x1a8)+_0x393b11[_0x44b1bf(0xb3)]+_0x44b1bf(0x142)+_0x170bb4);}const _0x4d66db=await _0x393b11['json']();loggerService_1[_0x44b1bf(0xef)][_0x44b1bf(0xae)](_0x412cac[_0x44b1bf(0xe7)]['toLowerCase'](),_0x44b1bf(0xcb),_0x393b11[_0x44b1bf(0xb3)],_0x4d66db,_0x45b79f),console[_0x44b1bf(0x12b)](_0x44b1bf(0xc4));let _0x4dd45d=_0x4d66db;if(_0x4d66db[_0x44b1bf(0x139)]&&_0x4d66db['key']&&_0x4d66db[_0x44b1bf(0xa3)]){console[_0x44b1bf(0x12b)](_0x44b1bf(0x16b));try{const _0x340fea=await this[_0x44b1bf(0x19c)](_0x4d66db[_0x44b1bf(0x139)],_0x4d66db['key'],_0x412cac[_0x44b1bf(0xe7)]);_0x4dd45d=JSON['parse'](_0x340fea),console['log'](_0x44b1bf(0x15d)),loggerService_1[_0x44b1bf(0xef)]['logWhiteDomainResponse'](_0x412cac[_0x44b1bf(0xe7)][_0x44b1bf(0x1db)](),_0x44b1bf(0x1b5),_0x393b11[_0x44b1bf(0xb3)],_0x4dd45d,_0x45b79f),console[_0x44b1bf(0x12b)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x596ec3){console[_0x44b1bf(0x123)](_0x44b1bf(0x9a),_0x596ec3),loggerService_1[_0x44b1bf(0xef)][_0x44b1bf(0x19b)](_0x412cac[_0x44b1bf(0xe7)][_0x44b1bf(0x1db)](),'/charge_decrypt',_0x44b1bf(0x160)+_0x596ec3),_0x4dd45d=_0x4d66db;}}else loggerService_1[_0x44b1bf(0xef)]['logWhiteDomainResponse'](_0x412cac[_0x44b1bf(0xe7)][_0x44b1bf(0x1db)](),'/charge_decrypted',_0x393b11['status'],_0x4dd45d,_0x45b79f),console[_0x44b1bf(0x12b)](_0x44b1bf(0x1c0));console[_0x44b1bf(0x12b)](_0x44b1bf(0x1cc),_0x4dd45d['status']),console['log'](_0x44b1bf(0x17d),_0x4dd45d[_0x44b1bf(0xce)]),console['log'](_0x44b1bf(0x1e2),_0x4dd45d[_0x44b1bf(0xd0)]),console[_0x44b1bf(0x12b)](_0x44b1bf(0x17c),_0x4dd45d[_0x44b1bf(0x137)]||'none');if(_0x4dd45d[_0x44b1bf(0xb3)]===0x64&&_0x4dd45d['final']===0x1)return console[_0x44b1bf(0x12b)](_0x44b1bf(0x192)),{'gateway_payment_id':_0x4dd45d[_0x44b1bf(0xd0)]?.[_0x44b1bf(0x107)](),'payment_url':_0x52454e,'requires_3ds':![],'status':_0x44b1bf(0x9d),'final':!![]};if(_0x4dd45d['3ds_url'])return console['log'](_0x44b1bf(0x1be)),this[_0x44b1bf(0x1dc)](_0x4b64ae,_0x512c86,_0x4dd45d[_0x44b1bf(0xd0)]?.[_0x44b1bf(0x107)]()||_0x512c86,_0x412cac[_0x44b1bf(0xe7)]),{'gateway_payment_id':_0x4dd45d[_0x44b1bf(0xd0)]?.['toString'](),'payment_url':_0x4dd45d[_0x44b1bf(0x137)],'requires_3ds':!![],'threeds_url':_0x4dd45d[_0x44b1bf(0x137)],'status':_0x44b1bf(0x9c),'final':![]};let _0xd876e8=this[_0x44b1bf(0x128)](_0x4dd45d[_0x44b1bf(0xb3)],_0x4dd45d[_0x44b1bf(0xff)]||_0x4dd45d[_0x44b1bf(0x90)]),_0x14c38b=_0x4dd45d[_0x44b1bf(0xb3)],_0x3c0ac9=this[_0x44b1bf(0x1cf)](_0x4dd45d[_0x44b1bf(0xb3)]);return console[_0x44b1bf(0x12b)](_0x44b1bf(0x19a)+_0x14c38b+',\x20Final:\x20'+_0x3c0ac9+',\x20Desc:\x20'+_0xd876e8),{'gateway_payment_id':_0x4dd45d[_0x44b1bf(0xd0)]?.['toString'](),'payment_url':_0x52454e,'requires_3ds':![],'status':_0x44b1bf(0x198),'final':!![],'errorMessage':_0xd876e8};}catch(_0x393ce5){console[_0x44b1bf(0x123)](_0x44b1bf(0x157)),console[_0x44b1bf(0x123)](_0x44b1bf(0xaa),_0x393ce5),loggerService_1[_0x44b1bf(0xef)]['logWhiteDomainError'](_0x44b1bf(0x1a6),'/charge',_0x393ce5);throw new Error('Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'+(_0x393ce5 instanceof Error?_0x393ce5['message']:_0x44b1bf(0x178)));}}async['checkPaymentStatus'](_0x5dcb52,_0xbaf837,_0x3e35df=a51_0x1e6e46(0x118)){const _0x2be92a=a51_0x1e6e46;console[_0x2be92a(0x12b)]('📊\x20Checking\x20'+_0x3e35df+_0x2be92a(0x18f)+_0x5dcb52+'\x20('+_0xbaf837+')');try{const _0x3613b4={'payment_id':_0x5dcb52,'order_id':_0xbaf837},_0x1b03cc=JSON[_0x2be92a(0x1c9)](_0x3613b4),_0x1f4f84=this[_0x2be92a(0xc3)](_0x3e35df===_0x2be92a(0x118)?_0x2be92a(0x146):'5000000000000000'),{key:_0x4e3e3d,iv:_0x10557c}=this[_0x2be92a(0xbd)](),_0x89f82=this[_0x2be92a(0x7b)](_0x1b03cc,_0x4e3e3d,_0x10557c),_0x303a70=this[_0x2be92a(0xbe)](_0x4e3e3d,_0x10557c,_0x1f4f84[_0x2be92a(0xbb)]),_0x58bae2=this[_0x2be92a(0xd5)](_0x1b03cc,_0x1f4f84[_0x2be92a(0xf0)]),_0x41bfc8={'merchant_point_id':_0x1f4f84[_0x2be92a(0x1d2)],'method':_0x2be92a(0xb3),'info':_0x89f82,'key':_0x303a70,'sign':_0x58bae2,'lang':'en'};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x3e35df[_0x2be92a(0x1db)](),_0x2be92a(0x88),_0x2be92a(0x183),{'merchant_point_id':_0x1f4f84['merchantPointId'],'method':_0x2be92a(0xb3),'lang':'en'});const _0x473db8=Date['now'](),_0x3a24b9=await fetch(_0x1f4f84[_0x2be92a(0x7e)],{'method':_0x2be92a(0x183),'headers':{'Content-Type':_0x2be92a(0x1ca),'Accept':'application/json','User-Agent':_0x2be92a(0x154)},'body':JSON['stringify'](_0x41bfc8)}),_0x2ba0cb=Date[_0x2be92a(0x17f)]()-_0x473db8;if(!_0x3a24b9['ok']){const _0xe165aa=await _0x3a24b9['text']();loggerService_1[_0x2be92a(0xef)][_0x2be92a(0xae)](_0x3e35df[_0x2be92a(0x1db)](),'/status_raw',_0x3a24b9[_0x2be92a(0xb3)],_0xe165aa,_0x2ba0cb);throw new Error(_0x2be92a(0x1a8)+_0x3a24b9[_0x2be92a(0xb3)]);}const _0x322e3b=await _0x3a24b9[_0x2be92a(0x176)]();loggerService_1[_0x2be92a(0xef)][_0x2be92a(0xae)](_0x3e35df['toLowerCase'](),_0x2be92a(0x12a),_0x3a24b9['status'],_0x322e3b,_0x2ba0cb);let _0x556191=_0x322e3b;if(_0x322e3b['info']&&_0x322e3b['key']&&_0x322e3b[_0x2be92a(0xa3)]){console[_0x2be92a(0x12b)](_0x2be92a(0x1b4));try{const _0x285cd7=await this[_0x2be92a(0x19c)](_0x322e3b[_0x2be92a(0x139)],_0x322e3b[_0x2be92a(0x8f)],_0x3e35df);_0x556191=JSON[_0x2be92a(0x104)](_0x285cd7),console[_0x2be92a(0x12b)]('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x2be92a(0xef)][_0x2be92a(0xae)](_0x3e35df['toLowerCase'](),_0x2be92a(0x100),_0x3a24b9['status'],_0x556191,_0x2ba0cb),console[_0x2be92a(0x12b)](_0x2be92a(0x172));}catch(_0x3ed716){console['error'](_0x2be92a(0x1bb),_0x3ed716),loggerService_1[_0x2be92a(0xef)][_0x2be92a(0x19b)](_0x3e35df[_0x2be92a(0x1db)](),'/status_decrypt',_0x2be92a(0xd7)+_0x3ed716),_0x556191=_0x322e3b;}}else loggerService_1[_0x2be92a(0xef)][_0x2be92a(0xae)](_0x3e35df[_0x2be92a(0x1db)](),_0x2be92a(0x100),_0x3a24b9['status'],_0x556191,_0x2ba0cb),console[_0x2be92a(0x12b)](_0x2be92a(0x101));console[_0x2be92a(0x12b)]('📊\x20Status\x20check\x20result:',{'status':_0x556191['status'],'final':_0x556191[_0x2be92a(0xce)],'payment_id':_0x556191[_0x2be92a(0xd0)],'desc':_0x556191[_0x2be92a(0xff)]});let _0x3c84e4='PENDING';if(_0x556191[_0x2be92a(0xb3)]===0x64&&_0x556191['final']===0x1)_0x3c84e4=_0x2be92a(0x9d);else{if(_0x556191[_0x2be92a(0xce)]===0x0||!this[_0x2be92a(0x1cf)](_0x556191[_0x2be92a(0xb3)]))_0x3c84e4=_0x2be92a(0x9c);else _0x556191[_0x2be92a(0xce)]===0x1||this['isFinalStatus'](_0x556191[_0x2be92a(0xb3)])?_0x3c84e4=_0x2be92a(0x198):_0x3c84e4=_0x2be92a(0x9c);}const _0x3c6478=this[_0x2be92a(0x128)](_0x556191['status'],_0x556191[_0x2be92a(0xff)]);return{'status':_0x3c84e4,'final':this['isFinalStatus'](_0x556191['status']),'amount':_0x556191['amount'],'currency':_0x556191[_0x2be92a(0x103)],'date_success':_0x556191[_0x2be92a(0x132)],'description':_0x3c6478};}catch(_0x3dba61){console[_0x2be92a(0x123)](_0x3e35df+_0x2be92a(0xb4),_0x3dba61),loggerService_1['loggerService'][_0x2be92a(0x19b)](_0x3e35df['toLowerCase'](),_0x2be92a(0x88),_0x3dba61);throw new Error(_0x2be92a(0x16a)+_0x3e35df+_0x2be92a(0x18f)+(_0x3dba61 instanceof Error?_0x3dba61[_0x2be92a(0x90)]:'Unknown\x20error'));}}[a51_0x1e6e46(0x1dc)](_0xf9abe2,_0x2b5e45,_0x47677c,_0x80e8bb){const _0x12c759=a51_0x1e6e46;console['log'](_0x12c759(0x125)+_0x80e8bb+_0x12c759(0x1b0)+_0xf9abe2+'\x20('+_0x47677c+')'),this[_0x12c759(0x13d)](_0xf9abe2);const _0x286fa2=[],_0x4eb4b7=0x5*0x3c*0x3e8,_0x3e6ec9=0x2*0x3c*0x3c*0x3e8,_0x132797=Math[_0x12c759(0x98)](_0x3e6ec9/_0x4eb4b7);console[_0x12c759(0x12b)](_0x12c759(0x10f)+_0x132797+_0x12c759(0xe6));for(let _0x50bc6e=0x1;_0x50bc6e<=_0x132797;_0x50bc6e++){const _0x5e267f=setTimeout(async()=>{const _0x217915=_0x12c759;console[_0x217915(0x12b)]('🔍\x20'+_0x80e8bb+_0x217915(0xb7)+_0x50bc6e+'/'+_0x132797+_0x217915(0x113)+_0xf9abe2);try{const _0x5ef7e6=await this[_0x217915(0xfc)](_0x47677c,_0x2b5e45,_0x80e8bb);console[_0x217915(0x12b)](_0x217915(0x87)+_0x50bc6e+_0x217915(0x92),_0x5ef7e6),_0x5ef7e6['final']&&(console[_0x217915(0x12b)](_0x217915(0x13a)+_0xf9abe2+'\x20is\x20final\x20('+_0x5ef7e6['status']+_0x217915(0x170)),this[_0x217915(0x13d)](_0xf9abe2),await this['updatePaymentStatus'](_0xf9abe2,_0x5ef7e6[_0x217915(0xb3)],_0x5ef7e6));}catch(_0x57727c){console['error'](_0x217915(0x133)+_0x50bc6e+_0x217915(0x196)+_0xf9abe2+':',_0x57727c);}},_0x50bc6e*_0x4eb4b7);_0x286fa2[_0x12c759(0x7c)](_0x5e267f);}this[_0x12c759(0x165)][_0x12c759(0x119)](_0xf9abe2,_0x286fa2),console['log'](_0x12c759(0xfe)+_0x132797+_0x12c759(0xaf)+_0xf9abe2);}[a51_0x1e6e46(0x13d)](_0x507739){const _0x4c1152=a51_0x1e6e46,_0x2c6518=this[_0x4c1152(0x165)][_0x4c1152(0x161)](_0x507739);_0x2c6518&&(console[_0x4c1152(0x12b)](_0x4c1152(0xf7)+_0x2c6518[_0x4c1152(0x186)]+_0x4c1152(0x167)+_0x507739),_0x2c6518[_0x4c1152(0x1dd)]((_0x43789c,_0x10ed63)=>{clearTimeout(_0x43789c);}),this[_0x4c1152(0x165)][_0x4c1152(0x1d0)](_0x507739));}async[a51_0x1e6e46(0x8e)](_0x1028bf,_0x2d5eb9,_0x10b865){const _0x481ca6=a51_0x1e6e46;try{const _0x353505=(await Promise[_0x481ca6(0x86)]()['then'](()=>__importStar(require(_0x481ca6(0x15c)))))[_0x481ca6(0x140)],_0xe063b2={'status':_0x2d5eb9[_0x481ca6(0x1aa)](),'updatedAt':new Date(),'statusChangedBy':_0x481ca6(0x17e),'statusChangedAt':new Date()};_0x2d5eb9===_0x481ca6(0x9d)&&(_0xe063b2[_0x481ca6(0xea)]=new Date()),_0x2d5eb9==='FAILED'&&_0x10b865[_0x481ca6(0x1af)]&&(_0xe063b2[_0x481ca6(0x127)]=_0x10b865[_0x481ca6(0x1af)],console[_0x481ca6(0x12b)](_0x481ca6(0xf3)+_0x10b865[_0x481ca6(0x1af)])),_0x10b865['description']&&(_0xe063b2[_0x481ca6(0x1d5)]=(_0x2d5eb9===_0x481ca6(0x9d)?_0x481ca6(0xe1):_0x481ca6(0x91))+':\x20'+_0x10b865['description']),await _0x353505[_0x481ca6(0xa6)][_0x481ca6(0x155)]({'where':{'id':_0x1028bf},'data':_0xe063b2}),console['log'](_0x481ca6(0x13a)+_0x1028bf+_0x481ca6(0x114)+_0x2d5eb9),await this[_0x481ca6(0xbf)](_0x1028bf,_0x2d5eb9);}catch(_0x296fd1){console['error'](_0x481ca6(0xc7)+_0x1028bf+':',_0x296fd1);}}async[a51_0x1e6e46(0xbf)](_0x28e22d,_0x2660c4){const _0x571324=a51_0x1e6e46;try{const _0x219618=(await Promise[_0x571324(0x86)]()[_0x571324(0xf4)](()=>__importStar(require('../../config/database'))))[_0x571324(0x140)],{telegramBotService:_0x66befd}=await Promise['resolve']()[_0x571324(0xf4)](()=>__importStar(require(_0x571324(0x1b3)))),_0x48c304=await _0x219618[_0x571324(0xa6)]['findUnique']({'where':{'id':_0x28e22d},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x48c304)return;const _0x493c9c={'PAID':_0x571324(0xc2),'FAILED':_0x571324(0x1e3)},_0x2409d3=_0x493c9c[_0x2660c4];_0x2409d3&&await _0x66befd[_0x571324(0x163)](_0x48c304[_0x571324(0xca)],_0x48c304,_0x2409d3),await this['sendShopWebhook'](_0x48c304,_0x2660c4);}catch(_0x4c5c2d){console['error']('Failed\x20to\x20send\x20payment\x20notifications:',_0x4c5c2d);}}async['sendShopWebhook'](_0x39a972,_0x272b7){const _0x495db9=a51_0x1e6e46,_0x11baa6=Date[_0x495db9(0x17f)]();try{const _0x51bc42=_0x39a972[_0x495db9(0x1a5)],_0x493d75=_0x51bc42[_0x495db9(0x138)];if(!_0x493d75?.[_0x495db9(0x156)]){console[_0x495db9(0x12b)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x51bc42['id']);return;}const _0x2367ca=_0x272b7===_0x495db9(0x9d)?_0x495db9(0x16d):'payment.failed';let _0x5539d8=[];if(_0x493d75[_0x495db9(0x126)])try{_0x5539d8=Array['isArray'](_0x493d75[_0x495db9(0x126)])?_0x493d75[_0x495db9(0x126)]:JSON['parse'](_0x493d75[_0x495db9(0x126)]);}catch(_0x225023){console['error']('Error\x20parsing\x20webhook\x20events:',_0x225023),_0x5539d8=[];}if(!_0x5539d8['includes'](_0x2367ca)){console[_0x495db9(0x12b)](_0x495db9(0x15f)+_0x2367ca+'\x20not\x20enabled\x20for\x20shop\x20'+_0x51bc42['id']);return;}const _0x52dc08={'event':_0x2367ca,'payment':{'id':_0x39a972['id'],'order_id':_0x39a972[_0x495db9(0xba)],'gateway_order_id':_0x39a972['gatewayOrderId'],'gateway':'1111','amount':_0x39a972[_0x495db9(0x1d8)],'currency':_0x39a972[_0x495db9(0x103)],'status':_0x272b7[_0x495db9(0x1db)](),'customer_email':_0x39a972['customerEmail'],'customer_name':_0x39a972[_0x495db9(0x1c8)],'created_at':_0x39a972[_0x495db9(0x9f)],'updated_at':new Date()}},_0xfb84bf=await fetch(_0x493d75['webhookUrl'],{'method':_0x495db9(0x183),'headers':{'Content-Type':_0x495db9(0x1ca),'User-Agent':_0x495db9(0xd8)},'body':JSON[_0x495db9(0x1c9)](_0x52dc08)}),_0x502676=Date[_0x495db9(0x17f)]()-_0x11baa6;loggerService_1[_0x495db9(0xef)][_0x495db9(0xd3)](_0x39a972[_0x495db9(0xca)],_0x493d75[_0x495db9(0x156)],_0x2367ca,_0xfb84bf[_0x495db9(0xb3)],_0x502676,_0x52dc08),console[_0x495db9(0x12b)](_0x495db9(0x116)+_0x493d75[_0x495db9(0x156)]+'\x20with\x20status\x20'+_0xfb84bf[_0x495db9(0xb3)]+'\x20('+_0x502676+_0x495db9(0x182));}catch(_0xf79d9b){console[_0x495db9(0x123)](_0x495db9(0xd2),_0xf79d9b),loggerService_1[_0x495db9(0xef)][_0x495db9(0x179)](_0x39a972['shopId'],_0x39a972[_0x495db9(0x1a5)]?.[_0x495db9(0x138)]?.[_0x495db9(0x156)]||_0x495db9(0x184),_0x495db9(0x149),_0xf79d9b,{});}}['maskCardNumber'](_0x17c2f6){const _0x3b2086=a51_0x1e6e46,_0xbf8eba=_0x17c2f6[_0x3b2086(0x17a)](/[\s-]/g,'');if(_0xbf8eba[_0x3b2086(0x186)]<0x4)return'****';return _0x3b2086(0x181)+_0xbf8eba[_0x3b2086(0x11c)](-0x4);}async['processWebhook'](_0x4911ae,_0x1c4480=a51_0x1e6e46(0x168)){const _0x458411=a51_0x1e6e46;console[_0x458411(0x12b)](_0x458411(0xc1),JSON['stringify'](_0x4911ae,null,0x2));let _0x4942e7=_0x4911ae,_0x34c4d0=_0x1c4480;_0x4911ae['card_type']?(_0x34c4d0=_0x4911ae[_0x458411(0x171)][_0x458411(0x1aa)]()===_0x458411(0x118)?'VISA':'MASTERCARD',console[_0x458411(0x12b)](_0x458411(0x10d)+_0x34c4d0)):console[_0x458411(0x12b)](_0x458411(0x131)+_0x34c4d0);if(_0x4911ae['info']&&_0x4911ae[_0x458411(0x8f)]&&_0x4911ae['sign']){console[_0x458411(0x12b)]('🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...');try{const _0x375295=await this[_0x458411(0x19c)](_0x4911ae[_0x458411(0x139)],_0x4911ae[_0x458411(0x8f)],_0x34c4d0);_0x4942e7=JSON[_0x458411(0x104)](_0x375295),console['log']('✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP'),console['log'](_0x458411(0xf6),JSON[_0x458411(0x1c9)](_0x4942e7,null,0x2));}catch(_0xcdb9de){console[_0x458411(0x123)]('❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:',_0xcdb9de),console['log'](_0x458411(0x187)),_0x4942e7=_0x4911ae;}}else console['log']('📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0x3ff3a0=_0x458411(0x9c);if(_0x4942e7[_0x458411(0xb3)]===0x64&&_0x4942e7['final']===0x1)_0x3ff3a0=_0x458411(0x9d);else{if(_0x4942e7[_0x458411(0xce)]===0x0||!this[_0x458411(0x1cf)](_0x4942e7[_0x458411(0xb3)]))_0x3ff3a0=_0x458411(0x9c);else _0x4942e7[_0x458411(0xce)]===0x1||this['isFinalStatus'](_0x4942e7[_0x458411(0xb3)])?_0x3ff3a0=_0x458411(0x198):_0x3ff3a0=_0x458411(0x9c);}let _0x33f5a0='';if(_0x4942e7[_0x458411(0x11b)])_0x33f5a0=_0x4942e7[_0x458411(0x11b)][_0x458411(0x107)](),console[_0x458411(0x12b)]('🔍\x20Using\x20'+_0x34c4d0+_0x458411(0x1c7)+_0x33f5a0);else _0x4942e7['payment_id']?(_0x33f5a0=_0x4942e7[_0x458411(0xd0)][_0x458411(0x107)](),console['log'](_0x458411(0x13e)+_0x34c4d0+_0x458411(0x143)+_0x33f5a0)):(_0x33f5a0=_0x4942e7[_0x458411(0xba)]||_0x4942e7['paymentId']||_0x4942e7['id']||'',console[_0x458411(0x12b)](_0x458411(0xa4)+_0x33f5a0));console[_0x458411(0x12b)](_0x458411(0x111)+_0x34c4d0+_0x458411(0x152)),console[_0x458411(0x12b)]('\x20\x20\x20Payment\x20ID:\x20'+_0x33f5a0+_0x458411(0x150)+_0x4942e7[_0x458411(0x11b)]+_0x458411(0x1cd)+_0x4942e7['orderId']+_0x458411(0x93)+_0x4942e7[_0x458411(0xd0)]+_0x458411(0x109)+_0x4942e7[_0x458411(0x1da)]+_0x458411(0x8d)+_0x4942e7['id']+')'),console[_0x458411(0x12b)]('\x20\x20\x20Status:\x20'+_0x3ff3a0+_0x458411(0x141)+_0x4942e7[_0x458411(0xb3)]+',\x20final='+_0x4942e7[_0x458411(0xce)]+')'),console[_0x458411(0x12b)](_0x458411(0x158)+_0x4942e7[_0x458411(0x1d8)]),console[_0x458411(0x12b)](_0x458411(0x11d)+_0x4942e7[_0x458411(0x103)]);let _0x2e9b1b;_0x3ff3a0==='FAILED'&&(_0x2e9b1b=this[_0x458411(0x128)](_0x4942e7['status'],_0x4942e7[_0x458411(0xff)]),console[_0x458411(0x12b)](_0x458411(0xe0)+_0x2e9b1b));const _0x1f4e3c={'paymentId':_0x33f5a0,'status':_0x3ff3a0,'amount':_0x4942e7[_0x458411(0x1d8)],'currency':_0x4942e7[_0x458411(0x103)]};return _0x2e9b1b&&(_0x1f4e3c[_0x458411(0x16e)]=_0x2e9b1b),_0x1f4e3c;}[a51_0x1e6e46(0xd1)](){const _0xaaf8cc=a51_0x1e6e46;console[_0xaaf8cc(0x12b)](_0xaaf8cc(0xed));const _0x3aee00=this[_0xaaf8cc(0x165)][_0xaaf8cc(0x1d6)];for(const [_0xd10b49]of this['statusCheckTimers']){this['clearStatusTimers'](_0xd10b49);}console[_0xaaf8cc(0x12b)](_0xaaf8cc(0x108)+_0x3aee00+_0xaaf8cc(0x195));}}exports[a51_0x1e6e46(0x151)]=VisaMasterCardService;