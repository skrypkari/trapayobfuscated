'use strict';const a51_0x38a92b=a51_0xec5d;(function(_0x927a1d,_0x1fb9a2){const _0x27ae1a=a51_0xec5d,_0x17017b=_0x927a1d();while(!![]){try{const _0x5ecd4a=parseInt(_0x27ae1a(0x272))/0x1+-parseInt(_0x27ae1a(0x306))/0x2+parseInt(_0x27ae1a(0x2c6))/0x3+parseInt(_0x27ae1a(0x1dc))/0x4*(-parseInt(_0x27ae1a(0x2c0))/0x5)+parseInt(_0x27ae1a(0x2f6))/0x6+parseInt(_0x27ae1a(0x2dc))/0x7+parseInt(_0x27ae1a(0x294))/0x8*(-parseInt(_0x27ae1a(0x30c))/0x9);if(_0x5ecd4a===_0x1fb9a2)break;else _0x17017b['push'](_0x17017b['shift']());}catch(_0x49803b){_0x17017b['push'](_0x17017b['shift']());}}}(a51_0x321a,0xa0ed3));function a51_0xec5d(_0x625c9d,_0x55f694){const _0x321a39=a51_0x321a();return a51_0xec5d=function(_0xec5dd9,_0x4a1c35){_0xec5dd9=_0xec5dd9-0x1cc;let _0x3259e0=_0x321a39[_0xec5dd9];return _0x3259e0;},a51_0xec5d(_0x625c9d,_0x55f694);}var __createBinding=this&&this[a51_0x38a92b(0x1d4)]||(Object[a51_0x38a92b(0x2d9)]?function(_0x275789,_0x46a6b0,_0x24ceb5,_0x1b35ce){const _0xbbab4e=a51_0x38a92b;if(_0x1b35ce===undefined)_0x1b35ce=_0x24ceb5;var _0x1b2687=Object[_0xbbab4e(0x230)](_0x46a6b0,_0x24ceb5);(!_0x1b2687||(_0xbbab4e(0x2e6)in _0x1b2687?!_0x46a6b0['__esModule']:_0x1b2687[_0xbbab4e(0x275)]||_0x1b2687[_0xbbab4e(0x297)]))&&(_0x1b2687={'enumerable':!![],'get':function(){return _0x46a6b0[_0x24ceb5];}}),Object[_0xbbab4e(0x1ee)](_0x275789,_0x1b35ce,_0x1b2687);}:function(_0x3840b3,_0x5a307b,_0x5ac9a7,_0x1da4bb){if(_0x1da4bb===undefined)_0x1da4bb=_0x5ac9a7;_0x3840b3[_0x1da4bb]=_0x5a307b[_0x5ac9a7];}),__setModuleDefault=this&&this[a51_0x38a92b(0x29e)]||(Object['create']?function(_0x292524,_0x5e5729){Object['defineProperty'](_0x292524,'default',{'enumerable':!![],'value':_0x5e5729});}:function(_0x34f696,_0x259662){const _0x208544=a51_0x38a92b;_0x34f696[_0x208544(0x324)]=_0x259662;}),__importStar=this&&this[a51_0x38a92b(0x289)]||(function(){var _0x26f52a=function(_0x35d600){const _0x1a0daa=a51_0xec5d;return _0x26f52a=Object[_0x1a0daa(0x259)]||function(_0x5d77ef){const _0x385e19=_0x1a0daa;var _0x4fa7a3=[];for(var _0x26a2fd in _0x5d77ef)if(Object[_0x385e19(0x291)][_0x385e19(0x253)]['call'](_0x5d77ef,_0x26a2fd))_0x4fa7a3[_0x4fa7a3['length']]=_0x26a2fd;return _0x4fa7a3;},_0x26f52a(_0x35d600);};return function(_0x4515a8){const _0x35b0c2=a51_0xec5d;if(_0x4515a8&&_0x4515a8[_0x35b0c2(0x29f)])return _0x4515a8;var _0x554a4a={};if(_0x4515a8!=null){for(var _0x31d491=_0x26f52a(_0x4515a8),_0x1b8347=0x0;_0x1b8347<_0x31d491['length'];_0x1b8347++)if(_0x31d491[_0x1b8347]!=='default')__createBinding(_0x554a4a,_0x4515a8,_0x31d491[_0x1b8347]);}return __setModuleDefault(_0x554a4a,_0x4515a8),_0x554a4a;};}()),__importDefault=this&&this[a51_0x38a92b(0x30b)]||function(_0x3a0169){const _0x3b2940=a51_0x38a92b;return _0x3a0169&&_0x3a0169[_0x3b2940(0x29f)]?_0x3a0169:{'default':_0x3a0169};};Object[a51_0x38a92b(0x1ee)](exports,a51_0x38a92b(0x29f),{'value':!![]}),exports[a51_0x38a92b(0x2da)]=void 0x0;const crypto_1=__importDefault(require(a51_0x38a92b(0x32d))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x38a92b(0x21a))),loggerService_1=require(a51_0x38a92b(0x1e0));class VisaMasterCardService{constructor(){const _0x4b6d20=a51_0x38a92b;this['statusCheckTimers']=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0x4b6d20(0x319)},0x1:{'final':![],'description':_0x4b6d20(0x2a1)},0x2:{'final':!![],'description':_0x4b6d20(0x23a)},0x3:{'final':!![],'description':'Another\x20unknown\x20error'},0x4:{'final':!![],'description':_0x4b6d20(0x2e2)},0x5:{'final':!![],'description':_0x4b6d20(0x28c)},0x6:{'final':!![],'description':_0x4b6d20(0x2d1)},0x7:{'final':!![],'description':'Test\x20payment'},0x8:{'final':![],'description':_0x4b6d20(0x244)},0x9:{'final':![],'description':'3DS\x20verification\x20required'},0xa:{'final':![],'description':_0x4b6d20(0x296)},0xb:{'final':![],'description':_0x4b6d20(0x216)},0xc:{'final':![],'description':_0x4b6d20(0x20e)},0xd:{'final':![],'description':_0x4b6d20(0x32a)},0xe:{'final':![],'description':_0x4b6d20(0x288)},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':_0x4b6d20(0x24a)},0x11:{'final':![],'description':_0x4b6d20(0x1f6)},0x12:{'final':![],'description':_0x4b6d20(0x2d7)},0x13:{'final':![],'description':_0x4b6d20(0x30e)},0x14:{'final':![],'description':'The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender'},0x15:{'final':![],'description':_0x4b6d20(0x1ec)},0x16:{'final':![],'description':_0x4b6d20(0x206)},0x18:{'final':![],'description':'The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'},0x19:{'final':![],'description':_0x4b6d20(0x239)},0x1a:{'final':!![],'description':_0x4b6d20(0x225)},0x1b:{'final':![],'description':'Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code'},0x1c:{'final':![],'description':_0x4b6d20(0x1ea)},0x1d:{'final':![],'description':_0x4b6d20(0x295)},0x1f:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending'},0x20:{'final':![],'description':_0x4b6d20(0x318)},0x23:{'final':![],'description':_0x4b6d20(0x2a7)},0x24:{'final':!![],'description':_0x4b6d20(0x23b)},0x25:{'final':!![],'description':_0x4b6d20(0x219)},0x26:{'final':!![],'description':_0x4b6d20(0x24c)},0x27:{'final':!![],'description':_0x4b6d20(0x313)},0x28:{'final':!![],'description':_0x4b6d20(0x1d7)},0x29:{'final':!![],'description':_0x4b6d20(0x29d)},0x2a:{'final':!![],'description':'Invalid\x20expiration\x20date'},0x2b:{'final':!![],'description':_0x4b6d20(0x2ff)},0x2c:{'final':!![],'description':_0x4b6d20(0x322)},0x2d:{'final':!![],'description':'Failed\x20payment'},0x2e:{'final':!![],'description':_0x4b6d20(0x2e2)},0x2f:{'final':!![],'description':_0x4b6d20(0x2e2)},0x30:{'final':!![],'description':'Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled'},0x31:{'final':![],'description':'Payment\x20confirmation\x20required'},0x32:{'final':!![],'description':_0x4b6d20(0x2c4)},0x33:{'final':!![],'description':_0x4b6d20(0x269)},0x34:{'final':!![],'description':_0x4b6d20(0x269)},0x35:{'final':!![],'description':_0x4b6d20(0x269)},0x36:{'final':!![],'description':_0x4b6d20(0x269)},0x37:{'final':!![],'description':_0x4b6d20(0x269)},0x38:{'final':!![],'description':'Cancellation\x20is\x20not\x20possible'},0x39:{'final':![],'description':_0x4b6d20(0x32c)},0x3a:{'final':![],'description':_0x4b6d20(0x2c9)},0x3b:{'final':!![],'description':_0x4b6d20(0x267)},0x3c:{'final':!![],'description':'Number\x20of\x20attempts\x20exceeded'},0x3d:{'final':!![],'description':_0x4b6d20(0x316)},0x3e:{'final':!![],'description':_0x4b6d20(0x25a)},0x3f:{'final':!![],'description':_0x4b6d20(0x2d1)},0x40:{'final':![],'description':_0x4b6d20(0x2ac)},0x41:{'final':!![],'description':_0x4b6d20(0x2ce)},0x42:{'final':![],'description':_0x4b6d20(0x323)},0x43:{'final':!![],'description':_0x4b6d20(0x217)},0x44:{'final':![],'description':'3DS\x20verification\x20required'},0x45:{'final':!![],'description':_0x4b6d20(0x269)},0x46:{'final':!![],'description':_0x4b6d20(0x269)},0x47:{'final':!![],'description':_0x4b6d20(0x1e7)},0x64:{'final':!![],'description':_0x4b6d20(0x254)}},this[_0x4b6d20(0x27d)]=_0x4b6d20(0x25e),this['masterCardMerchantPointId']=0x6e4,this[_0x4b6d20(0x2b7)]=path_1[_0x4b6d20(0x324)][_0x4b6d20(0x328)](process[_0x4b6d20(0x2fe)](),_0x4b6d20(0x28b),'private.pem'),this[_0x4b6d20(0x2d5)]=path_1['default'][_0x4b6d20(0x328)](process[_0x4b6d20(0x2fe)](),_0x4b6d20(0x28b),_0x4b6d20(0x2ab)),this[_0x4b6d20(0x2a9)]=_0x4b6d20(0x25e),this[_0x4b6d20(0x305)]=0x6b7,this[_0x4b6d20(0x218)]=path_1['default']['join'](process[_0x4b6d20(0x2fe)](),_0x4b6d20(0x28b),_0x4b6d20(0x210)),this[_0x4b6d20(0x311)]=path_1[_0x4b6d20(0x324)]['join'](process[_0x4b6d20(0x2fe)](),_0x4b6d20(0x28b),'visa_public.pem'),console[_0x4b6d20(0x320)](_0x4b6d20(0x2dd)),console[_0x4b6d20(0x320)](_0x4b6d20(0x215),this[_0x4b6d20(0x27d)]),console[_0x4b6d20(0x320)](_0x4b6d20(0x314),this[_0x4b6d20(0x2a9)]),console[_0x4b6d20(0x320)](_0x4b6d20(0x28f),this[_0x4b6d20(0x2b7)]),console[_0x4b6d20(0x320)](_0x4b6d20(0x1f9),this[_0x4b6d20(0x2d5)]),console[_0x4b6d20(0x320)]('🔐\x20VISA\x20Private\x20key\x20path:',this[_0x4b6d20(0x218)]),console['log']('🔐\x20VISA\x20Public\x20key\x20path:',this[_0x4b6d20(0x311)]),this[_0x4b6d20(0x261)]();}[a51_0x38a92b(0x2fc)](_0x42053c,_0x3e376d){const _0x182800=a51_0x38a92b,_0x76538e=this[_0x182800(0x22b)][_0x42053c];let _0x182300='';_0x76538e?_0x182300=_0x182800(0x2c5)+_0x42053c+':\x20'+_0x76538e['description']:_0x182300='Status\x20'+_0x42053c+':\x20Unknown\x20status\x20code';if(_0x3e376d&&_0x3e376d[_0x182800(0x232)]()){const _0x30f2dd=_0x3e376d[_0x182800(0x232)]();(!_0x76538e||_0x30f2dd[_0x182800(0x2db)]()!==_0x76538e[_0x182800(0x30d)]['toLowerCase']())&&(_0x182300+=_0x182800(0x222)+_0x30f2dd);}return _0x182300;}['isFinalStatus'](_0x3b286f){const _0x1ecd01=a51_0x38a92b,_0x5192cb=this['paymentStatuses'][_0x3b286f];return _0x5192cb?_0x5192cb[_0x1ecd01(0x226)]:!![];}[a51_0x38a92b(0x212)](_0x14c9b2){const _0x1f81fb=a51_0x38a92b,_0x4e64e1=_0x14c9b2[_0x1f81fb(0x27f)](0x0);if(_0x4e64e1==='4')return console[_0x1f81fb(0x320)](_0x1f81fb(0x31f)),{'cardType':'VISA','apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x1f81fb(0x218)],'publicKeyPath':this[_0x1f81fb(0x311)],'merchantPointId':this[_0x1f81fb(0x305)]};else return _0x4e64e1==='5'?(console['log'](_0x1f81fb(0x202)),{'cardType':_0x1f81fb(0x27b),'apiUrl':this[_0x1f81fb(0x27d)],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x1f81fb(0x2d5)],'merchantPointId':this['masterCardMerchantPointId']}):(console['log']('💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20'+_0x4e64e1+_0x1f81fb(0x2b8)),{'cardType':_0x1f81fb(0x27b),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x1f81fb(0x2b7)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this['masterCardMerchantPointId']});}[a51_0x38a92b(0x261)](){const _0x55359b=a51_0x38a92b;try{if(!fs_1['default']['existsSync'](this[_0x55359b(0x2b7)]))throw new Error(_0x55359b(0x1ff)+this[_0x55359b(0x2b7)]);if(!fs_1[_0x55359b(0x324)]['existsSync'](this[_0x55359b(0x2d5)]))throw new Error(_0x55359b(0x1e3)+this[_0x55359b(0x2d5)]);const _0x42b5ae=fs_1['default'][_0x55359b(0x1fa)](this[_0x55359b(0x2b7)],_0x55359b(0x2f9))['trim'](),_0x5d2d71=fs_1['default'][_0x55359b(0x1fa)](this[_0x55359b(0x2d5)],_0x55359b(0x2f9))[_0x55359b(0x232)]();if(!_0x42b5ae[_0x55359b(0x308)](_0x55359b(0x31c))||!_0x42b5ae[_0x55359b(0x308)](_0x55359b(0x2e3)))throw new Error(_0x55359b(0x293));if(!_0x5d2d71[_0x55359b(0x308)](_0x55359b(0x31c))||!_0x5d2d71[_0x55359b(0x308)](_0x55359b(0x2e3)))throw new Error(_0x55359b(0x24d));console[_0x55359b(0x320)](_0x55359b(0x257)),console[_0x55359b(0x320)](_0x55359b(0x2c3)+_0x42b5ae[_0x55359b(0x2b3)]+_0x55359b(0x2a8)),console[_0x55359b(0x320)](_0x55359b(0x1f0)+_0x5d2d71['length']+_0x55359b(0x2a8));if(fs_1[_0x55359b(0x324)]['existsSync'](this[_0x55359b(0x218)])&&fs_1[_0x55359b(0x324)][_0x55359b(0x307)](this[_0x55359b(0x311)])){const _0x3a9e45=fs_1[_0x55359b(0x324)][_0x55359b(0x1fa)](this[_0x55359b(0x218)],_0x55359b(0x2f9))[_0x55359b(0x232)](),_0x4b94e7=fs_1[_0x55359b(0x324)][_0x55359b(0x1fa)](this['visaPublicKeyPath'],_0x55359b(0x2f9))[_0x55359b(0x232)]();(!_0x3a9e45[_0x55359b(0x308)]('-----BEGIN')||!_0x3a9e45['includes'](_0x55359b(0x2e3)))&&console[_0x55359b(0x317)]('⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),(!_0x4b94e7[_0x55359b(0x308)](_0x55359b(0x31c))||!_0x4b94e7['includes']('-----END'))&&console[_0x55359b(0x317)](_0x55359b(0x2ed)),console[_0x55359b(0x320)]('✅\x20VISA\x20key\x20files\x20validated\x20successfully'),console[_0x55359b(0x320)]('🔐\x20VISA\x20Private\x20key\x20length:\x20'+_0x3a9e45[_0x55359b(0x2b3)]+'\x20characters'),console[_0x55359b(0x320)](_0x55359b(0x2cc)+_0x4b94e7[_0x55359b(0x2b3)]+_0x55359b(0x2a8));}else console[_0x55359b(0x317)](_0x55359b(0x1cc)),console[_0x55359b(0x317)](_0x55359b(0x20c)+this[_0x55359b(0x218)]),console[_0x55359b(0x317)](_0x55359b(0x1ed)+this['visaPublicKeyPath']);}catch(_0xd1662f){console[_0x55359b(0x1db)]('❌\x20VISA/MasterCard\x20key\x20validation\x20failed:',_0xd1662f);throw _0xd1662f;}}['generateAESKey'](){const _0x246015=a51_0x38a92b,_0x38f86e=crypto_1[_0x246015(0x324)][_0x246015(0x242)](0x20),_0x2df297=crypto_1[_0x246015(0x324)][_0x246015(0x242)](0x10);return{'key':_0x38f86e,'iv':_0x2df297};}['encryptAES'](_0x8f7d86,_0x138a15,_0x56ace9){const _0x2f9731=a51_0x38a92b,_0x8f9f0a=crypto_1['default'][_0x2f9731(0x27c)](_0x2f9731(0x329),_0x138a15,_0x56ace9);let _0x2dc8e5=_0x8f9f0a[_0x2f9731(0x303)](_0x8f7d86,_0x2f9731(0x2f9),_0x2f9731(0x2e1));return _0x2dc8e5+=_0x8f9f0a[_0x2f9731(0x226)](_0x2f9731(0x2e1)),_0x2dc8e5;}['encryptRSA'](_0x5b6024,_0x25467c,_0x2550f0){const _0x56ffde=a51_0x38a92b;try{const _0x363be0=fs_1['default'][_0x56ffde(0x1fa)](_0x2550f0,_0x56ffde(0x2f9))['trim'](),_0x4cc95a={'iv':_0x25467c[_0x56ffde(0x22e)]('base64'),'key':_0x5b6024['toString']('base64')},_0x15f368=JSON[_0x56ffde(0x2a2)](_0x4cc95a);console[_0x56ffde(0x320)](_0x56ffde(0x1e6),_0x15f368[_0x56ffde(0x2b3)]);const _0x54dacb=crypto_1['default'][_0x56ffde(0x2b0)]({'key':_0x363be0,'padding':crypto_1[_0x56ffde(0x324)][_0x56ffde(0x27a)][_0x56ffde(0x2d4)]},Buffer[_0x56ffde(0x2b2)](_0x15f368));return console[_0x56ffde(0x320)](_0x56ffde(0x2bb),_0x54dacb[_0x56ffde(0x2b3)]),_0x54dacb[_0x56ffde(0x22e)]('base64');}catch(_0x34566c){console['error'](_0x56ffde(0x1f5),_0x34566c);throw new Error(_0x56ffde(0x298));}}[a51_0x38a92b(0x2fa)](_0x449a2f,_0x5ef5b8){const _0x492a06=a51_0x38a92b;try{const _0x29e901=fs_1['default']['readFileSync'](_0x5ef5b8,'utf8')['trim'](),_0xa3d4d=crypto_1[_0x492a06(0x324)]['createSign'](_0x492a06(0x2a4));_0xa3d4d[_0x492a06(0x303)](_0x449a2f),_0xa3d4d['end']();const _0x46ec2e=_0xa3d4d[_0x492a06(0x1fd)](_0x29e901,_0x492a06(0x2e1));return console['log']('🔐\x20RSA\x20signing\x20successful'),console['log']('📝\x20Data\x20to\x20sign\x20length:',_0x449a2f[_0x492a06(0x2b3)]),console[_0x492a06(0x320)](_0x492a06(0x2c1),_0x46ec2e['length']),_0x46ec2e;}catch(_0x848226){console[_0x492a06(0x1db)](_0x492a06(0x23d),_0x848226),console[_0x492a06(0x1db)](_0x492a06(0x2be),_0x449a2f[_0x492a06(0x2e0)](0x0,0xc8)+'...');throw new Error(_0x492a06(0x283));}}['decryptAES'](_0x453ab2,_0x1f6c76,_0x5490c1){const _0x52f948=a51_0x38a92b,_0xb1e9ef=crypto_1['default'][_0x52f948(0x246)](_0x52f948(0x329),_0x1f6c76,_0x5490c1);let _0x523570=_0xb1e9ef['update'](_0x453ab2,_0x52f948(0x2e1),_0x52f948(0x2f9));return _0x523570+=_0xb1e9ef[_0x52f948(0x226)](_0x52f948(0x2f9)),_0x523570;}async[a51_0x38a92b(0x263)](_0x5a2a27,_0x1bfece,_0x59a65c=a51_0x38a92b(0x27b)){const _0x26b40f=a51_0x38a92b;try{const _0xf65635=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x26b40f(0x2ef),'headers':{'Content-Type':_0x26b40f(0x22f)},'body':JSON[_0x26b40f(0x2a2)]({'info':_0x5a2a27,'key':_0x1bfece,'card_type':_0x59a65c[_0x26b40f(0x2db)]()})});if(!_0xf65635['ok'])throw new Error(_0x26b40f(0x304));return await _0xf65635[_0x26b40f(0x2bc)]();}catch(_0xcff87f){console[_0x26b40f(0x1db)](_0x26b40f(0x238),_0xcff87f);throw new Error(_0x26b40f(0x23e));}}[a51_0x38a92b(0x2df)](_0x35924a,_0x58f3fa){const _0x27dc0e=a51_0x38a92b;try{const _0x2aead0=fs_1[_0x27dc0e(0x324)][_0x27dc0e(0x1fa)](this[_0x27dc0e(0x2b7)],'utf8')[_0x27dc0e(0x232)](),_0x204857=crypto_1[_0x27dc0e(0x324)][_0x27dc0e(0x21d)](_0x2aead0,Buffer['from'](_0x58f3fa,'base64')),_0x14884f=JSON[_0x27dc0e(0x31a)](_0x204857[_0x27dc0e(0x22e)]()),_0x387d7e=Buffer[_0x27dc0e(0x2b2)](_0x14884f[_0x27dc0e(0x2eb)],_0x27dc0e(0x2e1)),_0x5b262b=Buffer[_0x27dc0e(0x2b2)](_0x14884f['iv'],_0x27dc0e(0x2e1));return this[_0x27dc0e(0x1cf)](_0x35924a,_0x387d7e,_0x5b262b);}catch(_0x3968f3){throw new Error(_0x27dc0e(0x28d));}}async[a51_0x38a92b(0x236)](_0xf16c16){const _0x4202cd=a51_0x38a92b,{paymentId:_0x4b03e0,orderId:_0x3cc548,amount:_0x2b077b,currency:_0x118df3,cardData:_0x17e745,resultUrl:_0x520526,returnUrl:_0x2feedf,cardHolder:_0x32a2dc,browser:_0x469ba3}=_0xf16c16;console['log'](_0x4202cd(0x255)),console[_0x4202cd(0x320)](_0x4202cd(0x1e9),_0x4b03e0),console['log']('Order\x20ID:',_0x3cc548),console[_0x4202cd(0x320)](_0x4202cd(0x274),_0x2b077b,_0x118df3),console[_0x4202cd(0x320)]('Card\x20Number:',this[_0x4202cd(0x1f4)](_0x17e745[_0x4202cd(0x2ba)])),console['log']('Card\x20Holder:',_0x32a2dc[_0x4202cd(0x1e2)]+'\x20'+_0x32a2dc[_0x4202cd(0x309)]),console[_0x4202cd(0x320)]('Return\x20URL:',_0x2feedf),console[_0x4202cd(0x320)](_0x4202cd(0x205),_0x520526);const _0x15991b=this[_0x4202cd(0x212)](_0x17e745[_0x4202cd(0x2ba)]);console[_0x4202cd(0x320)](_0x4202cd(0x2d3)+_0x15991b[_0x4202cd(0x2c7)]+'\x20API:\x20'+_0x15991b[_0x4202cd(0x325)]),console[_0x4202cd(0x320)](_0x4202cd(0x252)+_0x15991b['privateKeyPath']+',\x20'+_0x15991b[_0x4202cd(0x2d5)]);const _0x2a3369={..._0x32a2dc,'first_name':_0x32a2dc['first_name']?.[_0x4202cd(0x260)](/[\t\n\r\f\v]/g,'\x20')[_0x4202cd(0x232)]()||'','last_name':_0x32a2dc['last_name']?.[_0x4202cd(0x260)](/[\t\n\r\f\v]/g,'\x20')['trim']()||''};console[_0x4202cd(0x320)](_0x4202cd(0x1d1)),console[_0x4202cd(0x320)](_0x4202cd(0x209)+_0x32a2dc[_0x4202cd(0x1e2)]+_0x4202cd(0x2a0)+_0x32a2dc['last_name']+'\x22'),console[_0x4202cd(0x320)](_0x4202cd(0x2b5)+_0x2a3369[_0x4202cd(0x1e2)]+_0x4202cd(0x2a0)+_0x2a3369['last_name']+'\x22');const _0x350a20={'amount':_0x2b077b,'currency':_0x118df3[_0x4202cd(0x1f3)](),'order_id':_0x3cc548,'result_url':_0x520526,'return_url':_0x2feedf,'country':'','card':{'number':_0x17e745[_0x4202cd(0x2ba)],'expire_month':_0x17e745[_0x4202cd(0x1d6)],'expire_year':_0x17e745[_0x4202cd(0x1e4)],'cvv':_0x17e745[_0x4202cd(0x23f)]},'card_holder':_0x2a3369,'browser':_0x469ba3},_0x18a7d1=JSON['stringify'](_0x350a20);console[_0x4202cd(0x320)](_0x4202cd(0x1cd)),console[_0x4202cd(0x320)](_0x4202cd(0x258)),console[_0x4202cd(0x320)](_0x18a7d1),console[_0x4202cd(0x320)]('📝\x20Data\x20length:',_0x18a7d1[_0x4202cd(0x2b3)]);try{const {key:_0x467a98,iv:_0x428f26}=this[_0x4202cd(0x31d)]();console[_0x4202cd(0x320)]('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console[_0x4202cd(0x320)](_0x4202cd(0x2c2),_0x467a98[_0x4202cd(0x2b3)]),console[_0x4202cd(0x320)](_0x4202cd(0x21f),_0x428f26['length']);const _0x20f7f3=this['encryptAES'](_0x18a7d1,_0x467a98,_0x428f26);console[_0x4202cd(0x320)](_0x4202cd(0x2b9)),console[_0x4202cd(0x320)](_0x4202cd(0x214),_0x20f7f3[_0x4202cd(0x2b3)]);const _0x20e3e9=this[_0x4202cd(0x2af)](_0x467a98,_0x428f26,_0x15991b['publicKeyPath']);console[_0x4202cd(0x320)](_0x4202cd(0x2e4)),console[_0x4202cd(0x320)](_0x4202cd(0x1d5),_0x20e3e9[_0x4202cd(0x2b3)]);const _0x28c8cb=this[_0x4202cd(0x2fa)](_0x18a7d1,_0x15991b[_0x4202cd(0x2b7)]);console[_0x4202cd(0x320)](_0x4202cd(0x299)),console[_0x4202cd(0x320)](_0x4202cd(0x2c1),_0x28c8cb['length']);const _0x3a3c54={'merchant_point_id':_0x15991b[_0x4202cd(0x24e)],'method':_0x4202cd(0x2f7),'info':_0x20f7f3,'key':_0x20e3e9,'sign':_0x28c8cb,'lang':'en'};console[_0x4202cd(0x320)](_0x4202cd(0x31b)),console[_0x4202cd(0x320)]('📝\x20Final\x20request\x20structure:'),console[_0x4202cd(0x320)](_0x4202cd(0x241),_0x15991b[_0x4202cd(0x24e)]),console[_0x4202cd(0x320)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x4202cd(0x320)]('\x20\x20\x20-\x20info\x20length:',_0x20f7f3[_0x4202cd(0x2b3)]),console['log']('\x20\x20\x20-\x20key\x20length:',_0x20e3e9[_0x4202cd(0x2b3)]),console[_0x4202cd(0x320)](_0x4202cd(0x1fe),_0x28c8cb[_0x4202cd(0x2b3)]),console[_0x4202cd(0x320)](_0x4202cd(0x2d8)),loggerService_1[_0x4202cd(0x1f7)]['logWhiteDomainRequest'](_0x15991b['cardType'][_0x4202cd(0x2db)](),_0x4202cd(0x248),_0x4202cd(0x2ef),{'merchant_point_id':_0x15991b['merchantPointId'],'method':_0x4202cd(0x2f7),'lang':'en'});const _0x1440ef=Date[_0x4202cd(0x26b)](),_0x30519b=await fetch(_0x15991b[_0x4202cd(0x325)],{'method':_0x4202cd(0x2ef),'headers':{'Content-Type':_0x4202cd(0x22f),'Accept':_0x4202cd(0x22f),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x4202cd(0x2a2)](_0x3a3c54)}),_0x5d0040=Date['now']()-_0x1440ef;console[_0x4202cd(0x320)](_0x4202cd(0x29a)),console[_0x4202cd(0x320)](_0x4202cd(0x220),_0x30519b[_0x4202cd(0x1d2)]),console[_0x4202cd(0x320)](_0x4202cd(0x28e),_0x5d0040+'ms');if(!_0x30519b['ok']){const _0x527b7d=await _0x30519b[_0x4202cd(0x2bc)]();console[_0x4202cd(0x1db)]('HTTP\x20Status:',_0x30519b['status']),console[_0x4202cd(0x1db)](_0x4202cd(0x21b),_0x527b7d),loggerService_1[_0x4202cd(0x1f7)][_0x4202cd(0x2b1)](_0x15991b[_0x4202cd(0x2c7)]['toLowerCase'](),_0x4202cd(0x268),_0x30519b[_0x4202cd(0x1d2)],_0x527b7d,_0x5d0040),loggerService_1[_0x4202cd(0x1f7)][_0x4202cd(0x287)](_0x15991b['cardType'][_0x4202cd(0x2db)](),_0x4202cd(0x248),_0x4202cd(0x250)+_0x30519b[_0x4202cd(0x1d2)]+':\x20'+_0x527b7d);throw new Error(_0x4202cd(0x1de)+_0x30519b[_0x4202cd(0x1d2)]+_0x4202cd(0x228)+_0x527b7d);}const _0x3368a7=await _0x30519b['json']();loggerService_1[_0x4202cd(0x1f7)][_0x4202cd(0x2b1)](_0x15991b[_0x4202cd(0x2c7)][_0x4202cd(0x2db)](),'/charge_raw',_0x30519b['status'],_0x3368a7,_0x5d0040),console['log'](_0x4202cd(0x2c8));let _0x398093=_0x3368a7;if(_0x3368a7[_0x4202cd(0x2d0)]&&_0x3368a7['key']&&_0x3368a7['sign']){console[_0x4202cd(0x320)](_0x4202cd(0x32f));try{const _0x4b430c=await this[_0x4202cd(0x263)](_0x3368a7[_0x4202cd(0x2d0)],_0x3368a7['key'],_0x15991b['cardType']);_0x398093=JSON[_0x4202cd(0x31a)](_0x4b430c),console[_0x4202cd(0x320)](_0x4202cd(0x20d)),loggerService_1[_0x4202cd(0x1f7)][_0x4202cd(0x2b1)](_0x15991b[_0x4202cd(0x2c7)][_0x4202cd(0x2db)](),_0x4202cd(0x2fd),_0x30519b[_0x4202cd(0x1d2)],_0x398093,_0x5d0040),console[_0x4202cd(0x320)](_0x4202cd(0x2fb));}catch(_0x4c279e){console[_0x4202cd(0x1db)](_0x4202cd(0x1f2),_0x4c279e),loggerService_1[_0x4202cd(0x1f7)][_0x4202cd(0x287)](_0x15991b['cardType'][_0x4202cd(0x2db)](),_0x4202cd(0x1da),'Decryption\x20failed:\x20'+_0x4c279e),_0x398093=_0x3368a7;}}else loggerService_1[_0x4202cd(0x1f7)]['logWhiteDomainResponse'](_0x15991b[_0x4202cd(0x2c7)][_0x4202cd(0x2db)](),_0x4202cd(0x2fd),_0x30519b[_0x4202cd(0x1d2)],_0x398093,_0x5d0040),console[_0x4202cd(0x320)](_0x4202cd(0x26d));console[_0x4202cd(0x320)](_0x4202cd(0x220),_0x398093[_0x4202cd(0x1d2)]),console[_0x4202cd(0x320)](_0x4202cd(0x271),_0x398093[_0x4202cd(0x226)]),console['log'](_0x4202cd(0x1e9),_0x398093[_0x4202cd(0x2f1)]),console[_0x4202cd(0x320)](_0x4202cd(0x300),_0x398093[_0x4202cd(0x321)]||_0x4202cd(0x2f2));if(_0x398093[_0x4202cd(0x1d2)]===0x64&&_0x398093['final']===0x1)return console['log'](_0x4202cd(0x26e)),{'gateway_payment_id':_0x398093[_0x4202cd(0x2f1)]?.[_0x4202cd(0x22e)](),'payment_url':_0x2feedf,'requires_3ds':![],'status':_0x4202cd(0x26c),'final':!![]};if(_0x398093['3ds_url'])return console[_0x4202cd(0x320)]('🔐\x203DS\x20verification\x20required'),this[_0x4202cd(0x2ae)](_0x4b03e0,_0x3cc548,_0x398093[_0x4202cd(0x2f1)]?.[_0x4202cd(0x22e)]()||_0x3cc548,_0x15991b[_0x4202cd(0x2c7)]),{'gateway_payment_id':_0x398093[_0x4202cd(0x2f1)]?.[_0x4202cd(0x22e)](),'payment_url':_0x398093[_0x4202cd(0x321)],'requires_3ds':!![],'threeds_url':_0x398093[_0x4202cd(0x321)],'status':_0x4202cd(0x32e),'final':![]};let _0x36d9c1=this[_0x4202cd(0x2fc)](_0x398093['status'],_0x398093[_0x4202cd(0x25f)]||_0x398093[_0x4202cd(0x20b)]),_0x5c0235=_0x398093[_0x4202cd(0x1d2)],_0x2fa15f=this[_0x4202cd(0x213)](_0x398093[_0x4202cd(0x1d2)]);return console['log']('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x5c0235+',\x20Final:\x20'+_0x2fa15f+_0x4202cd(0x26a)+_0x36d9c1),{'gateway_payment_id':_0x398093[_0x4202cd(0x2f1)]?.['toString'](),'payment_url':_0x2feedf,'requires_3ds':![],'status':'FAILED','final':!![],'errorMessage':_0x36d9c1};}catch(_0x309913){console[_0x4202cd(0x1db)](_0x4202cd(0x1ef)),console[_0x4202cd(0x1db)]('Error\x20details:',_0x309913),loggerService_1[_0x4202cd(0x1f7)][_0x4202cd(0x287)]('visa/mastercard','/charge',_0x309913);throw new Error('Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'+(_0x309913 instanceof Error?_0x309913[_0x4202cd(0x20b)]:_0x4202cd(0x2a3)));}}async[a51_0x38a92b(0x292)](_0x3fb3a1,_0x5b8ea4,_0x1c68b0=a51_0x38a92b(0x2de)){const _0x369b06=a51_0x38a92b;console['log'](_0x369b06(0x2cf)+_0x1c68b0+_0x369b06(0x203)+_0x3fb3a1+'\x20('+_0x5b8ea4+')');try{const _0x548933={'payment_id':_0x3fb3a1,'order_id':_0x5b8ea4},_0x331365=JSON['stringify'](_0x548933),_0x3c0f82=this[_0x369b06(0x212)](_0x1c68b0==='VISA'?_0x369b06(0x302):_0x369b06(0x1dd)),{key:_0x13ee8d,iv:_0xd026f6}=this['generateAESKey'](),_0x258be8=this[_0x369b06(0x1d3)](_0x331365,_0x13ee8d,_0xd026f6),_0x384f38=this[_0x369b06(0x2af)](_0x13ee8d,_0xd026f6,_0x3c0f82[_0x369b06(0x2d5)]),_0xc080f0=this[_0x369b06(0x2fa)](_0x331365,_0x3c0f82[_0x369b06(0x2b7)]),_0x357f8a={'merchant_point_id':_0x3c0f82['merchantPointId'],'method':_0x369b06(0x1d2),'info':_0x258be8,'key':_0x384f38,'sign':_0xc080f0,'lang':'en'};loggerService_1[_0x369b06(0x1f7)][_0x369b06(0x201)](_0x1c68b0[_0x369b06(0x2db)](),_0x369b06(0x2ca),'POST',{'merchant_point_id':_0x3c0f82[_0x369b06(0x24e)],'method':_0x369b06(0x1d2),'lang':'en'});const _0x1290ce=Date[_0x369b06(0x26b)](),_0x19dec2=await fetch(_0x3c0f82[_0x369b06(0x325)],{'method':'POST','headers':{'Content-Type':_0x369b06(0x22f),'Accept':_0x369b06(0x22f),'User-Agent':_0x369b06(0x2a6)},'body':JSON['stringify'](_0x357f8a)}),_0xc3c591=Date[_0x369b06(0x26b)]()-_0x1290ce;if(!_0x19dec2['ok']){const _0x38fcaa=await _0x19dec2[_0x369b06(0x2bc)]();loggerService_1[_0x369b06(0x1f7)]['logWhiteDomainResponse'](_0x1c68b0[_0x369b06(0x2db)](),'/status_raw',_0x19dec2['status'],_0x38fcaa,_0xc3c591);throw new Error(_0x369b06(0x1de)+_0x19dec2['status']);}const _0x28caa8=await _0x19dec2[_0x369b06(0x264)]();loggerService_1['loggerService'][_0x369b06(0x2b1)](_0x1c68b0[_0x369b06(0x2db)](),'/status_raw',_0x19dec2[_0x369b06(0x1d2)],_0x28caa8,_0xc3c591);let _0xa584ac=_0x28caa8;if(_0x28caa8['info']&&_0x28caa8['key']&&_0x28caa8[_0x369b06(0x1fd)]){console[_0x369b06(0x320)]('🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0xf285f6=await this[_0x369b06(0x263)](_0x28caa8['info'],_0x28caa8['key'],_0x1c68b0);_0xa584ac=JSON[_0x369b06(0x31a)](_0xf285f6),console[_0x369b06(0x320)](_0x369b06(0x1d0)),loggerService_1[_0x369b06(0x1f7)]['logWhiteDomainResponse'](_0x1c68b0['toLowerCase'](),_0x369b06(0x243),_0x19dec2[_0x369b06(0x1d2)],_0xa584ac,_0xc3c591),console['log'](_0x369b06(0x207));}catch(_0x1dfc0b){console[_0x369b06(0x1db)](_0x369b06(0x30a),_0x1dfc0b),loggerService_1['loggerService'][_0x369b06(0x287)](_0x1c68b0[_0x369b06(0x2db)](),_0x369b06(0x25c),_0x369b06(0x2ad)+_0x1dfc0b),_0xa584ac=_0x28caa8;}}else loggerService_1[_0x369b06(0x1f7)][_0x369b06(0x2b1)](_0x1c68b0['toLowerCase'](),_0x369b06(0x243),_0x19dec2['status'],_0xa584ac,_0xc3c591),console[_0x369b06(0x320)](_0x369b06(0x208));console[_0x369b06(0x320)](_0x369b06(0x1ce),{'status':_0xa584ac[_0x369b06(0x1d2)],'final':_0xa584ac[_0x369b06(0x226)],'payment_id':_0xa584ac['payment_id'],'desc':_0xa584ac[_0x369b06(0x25f)]});let _0x516b8c='PENDING';if(_0xa584ac[_0x369b06(0x1d2)]===0x64&&_0xa584ac['final']===0x1)_0x516b8c=_0x369b06(0x26c);else{if(_0xa584ac[_0x369b06(0x226)]===0x0||!this[_0x369b06(0x213)](_0xa584ac[_0x369b06(0x1d2)]))_0x516b8c='PENDING';else _0xa584ac[_0x369b06(0x226)]===0x1||this['isFinalStatus'](_0xa584ac[_0x369b06(0x1d2)])?_0x516b8c=_0x369b06(0x276):_0x516b8c=_0x369b06(0x32e);}const _0x12ded7=this['getDetailedErrorMessage'](_0xa584ac[_0x369b06(0x1d2)],_0xa584ac[_0x369b06(0x25f)]);return{'status':_0x516b8c,'final':this['isFinalStatus'](_0xa584ac[_0x369b06(0x1d2)]),'amount':_0xa584ac[_0x369b06(0x266)],'currency':_0xa584ac[_0x369b06(0x2ea)],'date_success':_0xa584ac[_0x369b06(0x30f)],'description':_0x12ded7};}catch(_0x2f646a){console['error'](_0x1c68b0+_0x369b06(0x315),_0x2f646a),loggerService_1['loggerService'][_0x369b06(0x287)](_0x1c68b0[_0x369b06(0x2db)](),_0x369b06(0x2ca),_0x2f646a);throw new Error('Failed\x20to\x20check\x20'+_0x1c68b0+_0x369b06(0x203)+(_0x2f646a instanceof Error?_0x2f646a['message']:'Unknown\x20error'));}}[a51_0x38a92b(0x2ae)](_0x57a602,_0x1e12e2,_0x524eeb,_0x112632){const _0x19ca04=a51_0x38a92b;console['log'](_0x19ca04(0x312)+_0x112632+_0x19ca04(0x2b6)+_0x57a602+'\x20('+_0x524eeb+')'),this[_0x19ca04(0x1d9)](_0x57a602);const _0x2d73d9=[],_0x22ce33=0x5*0x3c*0x3e8,_0xe30f28=0x2*0x3c*0x3c*0x3e8,_0x844d45=Math[_0x19ca04(0x24f)](_0xe30f28/_0x22ce33);console[_0x19ca04(0x320)](_0x19ca04(0x20a)+_0x844d45+_0x19ca04(0x31e));for(let _0x2da6fc=0x1;_0x2da6fc<=_0x844d45;_0x2da6fc++){const _0x4fa44b=setTimeout(async()=>{const _0x23168b=_0x19ca04;console[_0x23168b(0x320)](_0x23168b(0x32b)+_0x112632+'\x20status\x20check\x20#'+_0x2da6fc+'/'+_0x844d45+_0x23168b(0x2f3)+_0x57a602);try{const _0x364d6b=await this['checkPaymentStatus'](_0x524eeb,_0x1e12e2,_0x112632);console[_0x23168b(0x320)](_0x23168b(0x265)+_0x2da6fc+_0x23168b(0x2b4),_0x364d6b),_0x364d6b[_0x23168b(0x226)]&&(console[_0x23168b(0x320)]('✅\x20Payment\x20'+_0x57a602+_0x23168b(0x29c)+_0x364d6b['status']+_0x23168b(0x27e)),this[_0x23168b(0x1d9)](_0x57a602),await this[_0x23168b(0x2e7)](_0x57a602,_0x364d6b['status'],_0x364d6b));}catch(_0x5388b7){console[_0x23168b(0x1db)]('❌\x20Status\x20check\x20#'+_0x2da6fc+'\x20failed\x20for\x20payment\x20'+_0x57a602+':',_0x5388b7);}},_0x2da6fc*_0x22ce33);_0x2d73d9[_0x19ca04(0x25b)](_0x4fa44b);}this['statusCheckTimers'][_0x19ca04(0x1fb)](_0x57a602,_0x2d73d9),console[_0x19ca04(0x320)](_0x19ca04(0x237)+_0x844d45+_0x19ca04(0x1e5)+_0x57a602);}[a51_0x38a92b(0x1d9)](_0xa1c1f9){const _0x566c23=a51_0x38a92b,_0x370b42=this[_0x566c23(0x23c)]['get'](_0xa1c1f9);_0x370b42&&(console[_0x566c23(0x320)]('🧹\x20Clearing\x20'+_0x370b42[_0x566c23(0x2b3)]+'\x20status\x20timers\x20for\x20payment\x20'+_0xa1c1f9),_0x370b42['forEach']((_0x259a9c,_0x4c5bdc)=>{clearTimeout(_0x259a9c);}),this['statusCheckTimers'][_0x566c23(0x282)](_0xa1c1f9));}async[a51_0x38a92b(0x2e7)](_0x749414,_0xeb0575,_0x33d2f2){const _0x461d1d=a51_0x38a92b;try{const _0x9512e6=(await Promise[_0x461d1d(0x1e1)]()[_0x461d1d(0x240)](()=>__importStar(require(_0x461d1d(0x28a)))))[_0x461d1d(0x324)],_0x597d88={'status':_0xeb0575[_0x461d1d(0x1f3)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0xeb0575===_0x461d1d(0x26c)&&(_0x597d88['paidAt']=new Date()),_0xeb0575===_0x461d1d(0x276)&&_0x33d2f2[_0x461d1d(0x30d)]&&(_0x597d88[_0x461d1d(0x26f)]=_0x33d2f2[_0x461d1d(0x30d)],console[_0x461d1d(0x320)]('💾\x20Saving\x20failure\x20message:\x20'+_0x33d2f2['description'])),_0x33d2f2['description']&&(_0x597d88['adminNotes']=(_0xeb0575==='PAID'?_0x461d1d(0x2f4):_0x461d1d(0x235))+':\x20'+_0x33d2f2['description']),await _0x9512e6[_0x461d1d(0x21e)][_0x461d1d(0x303)]({'where':{'id':_0x749414},'data':_0x597d88}),console['log'](_0x461d1d(0x1e8)+_0x749414+'\x20status\x20updated\x20to\x20'+_0xeb0575),await this[_0x461d1d(0x29b)](_0x749414,_0xeb0575);}catch(_0x3a12ed){console['error']('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x749414+':',_0x3a12ed);}}async[a51_0x38a92b(0x29b)](_0x65cd7a,_0x53f179){const _0x4e9e04=a51_0x38a92b;try{const _0x278205=(await Promise['resolve']()[_0x4e9e04(0x240)](()=>__importStar(require('../../config/database'))))[_0x4e9e04(0x324)],{telegramBotService:_0x4de069}=await Promise[_0x4e9e04(0x1e1)]()[_0x4e9e04(0x240)](()=>__importStar(require(_0x4e9e04(0x25d)))),_0x55b12c=await _0x278205[_0x4e9e04(0x21e)][_0x4e9e04(0x327)]({'where':{'id':_0x65cd7a},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x55b12c)return;const _0xc3b09e={'PAID':_0x4e9e04(0x224),'FAILED':_0x4e9e04(0x223)},_0x185997=_0xc3b09e[_0x53f179];_0x185997&&await _0x4de069[_0x4e9e04(0x2aa)](_0x55b12c['shopId'],_0x55b12c,_0x185997),await this['sendShopWebhook'](_0x55b12c,_0x53f179);}catch(_0x2274fd){console['error']('Failed\x20to\x20send\x20payment\x20notifications:',_0x2274fd);}}async[a51_0x38a92b(0x285)](_0x36eff3,_0x55f341){const _0x4aceca=a51_0x38a92b,_0x5d2124=Date[_0x4aceca(0x26b)]();try{const _0x36d23b=_0x36eff3[_0x4aceca(0x2cb)],_0x3c6a28=_0x36d23b['settings'];if(!_0x3c6a28?.[_0x4aceca(0x251)]){console[_0x4aceca(0x320)](_0x4aceca(0x270)+_0x36d23b['id']);return;}const _0x5703be=_0x55f341==='PAID'?_0x4aceca(0x277):_0x4aceca(0x2bf);let _0x1b0c19=[];if(_0x3c6a28[_0x4aceca(0x211)])try{_0x1b0c19=Array[_0x4aceca(0x2d6)](_0x3c6a28[_0x4aceca(0x211)])?_0x3c6a28[_0x4aceca(0x211)]:JSON[_0x4aceca(0x31a)](_0x3c6a28[_0x4aceca(0x211)]);}catch(_0xecee04){console['error']('Error\x20parsing\x20webhook\x20events:',_0xecee04),_0x1b0c19=[];}if(!_0x1b0c19[_0x4aceca(0x308)](_0x5703be)){console[_0x4aceca(0x320)](_0x4aceca(0x2e8)+_0x5703be+'\x20not\x20enabled\x20for\x20shop\x20'+_0x36d23b['id']);return;}const _0x5526d7={'event':_0x5703be,'payment':{'id':_0x36eff3['id'],'order_id':_0x36eff3[_0x4aceca(0x273)],'gateway_order_id':_0x36eff3[_0x4aceca(0x2f0)],'gateway':_0x4aceca(0x301),'amount':_0x36eff3['amount'],'currency':_0x36eff3[_0x4aceca(0x2ea)],'status':_0x55f341[_0x4aceca(0x2db)](),'customer_email':_0x36eff3[_0x4aceca(0x2f5)],'customer_name':_0x36eff3[_0x4aceca(0x231)],'created_at':_0x36eff3[_0x4aceca(0x204)],'updated_at':new Date()}},_0x2a8d83=await fetch(_0x3c6a28[_0x4aceca(0x251)],{'method':_0x4aceca(0x2ef),'headers':{'Content-Type':_0x4aceca(0x22f),'User-Agent':_0x4aceca(0x2f8)},'body':JSON[_0x4aceca(0x2a2)](_0x5526d7)}),_0x422328=Date[_0x4aceca(0x26b)]()-_0x5d2124;loggerService_1[_0x4aceca(0x1f7)]['logShopWebhookSent'](_0x36eff3['shopId'],_0x3c6a28[_0x4aceca(0x251)],_0x5703be,_0x2a8d83[_0x4aceca(0x1d2)],_0x422328,_0x5526d7),console[_0x4aceca(0x320)](_0x4aceca(0x1fc)+_0x3c6a28[_0x4aceca(0x251)]+'\x20with\x20status\x20'+_0x2a8d83[_0x4aceca(0x1d2)]+'\x20('+_0x422328+_0x4aceca(0x22c));}catch(_0x34a24d){console[_0x4aceca(0x1db)](_0x4aceca(0x279),_0x34a24d),loggerService_1[_0x4aceca(0x1f7)][_0x4aceca(0x2e9)](_0x36eff3[_0x4aceca(0x1f1)],_0x36eff3[_0x4aceca(0x2cb)]?.[_0x4aceca(0x2e5)]?.[_0x4aceca(0x251)]||_0x4aceca(0x256),'webhook_send',_0x34a24d,{});}}[a51_0x38a92b(0x1f4)](_0xced30e){const _0x310618=a51_0x38a92b,_0x5d9561=_0xced30e[_0x310618(0x260)](/[\s-]/g,'');if(_0x5d9561[_0x310618(0x2b3)]<0x4)return'****';return'****\x20****\x20****\x20'+_0x5d9561[_0x310618(0x284)](-0x4);}async[a51_0x38a92b(0x326)](_0x1a076d,_0x554661=a51_0x38a92b(0x27b)){const _0x548a36=a51_0x38a92b;console[_0x548a36(0x320)](_0x548a36(0x200),JSON['stringify'](_0x1a076d,null,0x2));let _0x125bc9=_0x1a076d,_0x577a38=_0x554661;_0x1a076d[_0x548a36(0x280)]?(_0x577a38=_0x1a076d['card_type'][_0x548a36(0x1f3)]()===_0x548a36(0x2de)?_0x548a36(0x2de):'MASTERCARD',console[_0x548a36(0x320)](_0x548a36(0x245)+_0x577a38)):console['log']('🔍\x20Using\x20provided\x20card\x20type:\x20'+_0x577a38);if(_0x1a076d[_0x548a36(0x2d0)]&&_0x1a076d[_0x548a36(0x2eb)]&&_0x1a076d[_0x548a36(0x1fd)]){console[_0x548a36(0x320)](_0x548a36(0x262));try{const _0x762c7e=await this['decryptResponsePhp'](_0x1a076d[_0x548a36(0x2d0)],_0x1a076d['key'],_0x577a38);_0x125bc9=JSON['parse'](_0x762c7e),console[_0x548a36(0x320)](_0x548a36(0x2cd)),console[_0x548a36(0x320)](_0x548a36(0x2ec),JSON['stringify'](_0x125bc9,null,0x2));}catch(_0x58d72c){console[_0x548a36(0x1db)](_0x548a36(0x22d),_0x58d72c),console['log'](_0x548a36(0x227)),_0x125bc9=_0x1a076d;}}else console[_0x548a36(0x320)](_0x548a36(0x221));let _0x261ce0='PENDING';if(_0x125bc9[_0x548a36(0x1d2)]===0x64&&_0x125bc9[_0x548a36(0x226)]===0x1)_0x261ce0=_0x548a36(0x26c);else{if(_0x125bc9[_0x548a36(0x226)]===0x0||!this[_0x548a36(0x213)](_0x125bc9[_0x548a36(0x1d2)]))_0x261ce0=_0x548a36(0x32e);else _0x125bc9[_0x548a36(0x226)]===0x1||this[_0x548a36(0x213)](_0x125bc9[_0x548a36(0x1d2)])?_0x261ce0=_0x548a36(0x276):_0x261ce0=_0x548a36(0x32e);}let _0x54f8af='';if(_0x125bc9['order_id'])_0x54f8af=_0x125bc9[_0x548a36(0x20f)][_0x548a36(0x22e)](),console[_0x548a36(0x320)](_0x548a36(0x22a)+_0x577a38+'\x20order_id\x20for\x20search:\x20'+_0x54f8af);else _0x125bc9[_0x548a36(0x2f1)]?(_0x54f8af=_0x125bc9['payment_id'][_0x548a36(0x22e)](),console[_0x548a36(0x320)]('🔍\x20Using\x20'+_0x577a38+_0x548a36(0x24b)+_0x54f8af)):(_0x54f8af=_0x125bc9['orderId']||_0x125bc9[_0x548a36(0x2ee)]||_0x125bc9['id']||'',console[_0x548a36(0x320)](_0x548a36(0x1df)+_0x54f8af));console['log']('📊\x20'+_0x577a38+_0x548a36(0x2d2)),console[_0x548a36(0x320)](_0x548a36(0x233)+_0x54f8af+_0x548a36(0x229)+_0x125bc9[_0x548a36(0x20f)]+',\x20orderId='+_0x125bc9[_0x548a36(0x273)]+_0x548a36(0x249)+_0x125bc9[_0x548a36(0x2f1)]+_0x548a36(0x281)+_0x125bc9[_0x548a36(0x2ee)]+_0x548a36(0x286)+_0x125bc9['id']+')'),console['log'](_0x548a36(0x21c)+_0x261ce0+_0x548a36(0x1d8)+_0x125bc9[_0x548a36(0x1d2)]+_0x548a36(0x278)+_0x125bc9['final']+')'),console[_0x548a36(0x320)](_0x548a36(0x2a5)+_0x125bc9[_0x548a36(0x266)]),console[_0x548a36(0x320)](_0x548a36(0x290)+_0x125bc9['currency']);let _0x5583a0;_0x261ce0===_0x548a36(0x276)&&(_0x5583a0=this[_0x548a36(0x2fc)](_0x125bc9[_0x548a36(0x1d2)],_0x125bc9['desc']),console[_0x548a36(0x320)]('❌\x20Detailed\x20failure\x20description:\x20'+_0x5583a0));const _0x36c2ad={'paymentId':_0x54f8af,'status':_0x261ce0,'amount':_0x125bc9[_0x548a36(0x266)],'currency':_0x125bc9[_0x548a36(0x2ea)]};return _0x5583a0&&(_0x36c2ad[_0x548a36(0x310)]=_0x5583a0),_0x36c2ad;}[a51_0x38a92b(0x234)](){const _0x3ab3c6=a51_0x38a92b;console[_0x3ab3c6(0x320)](_0x3ab3c6(0x1eb));const _0x1b55ce=this[_0x3ab3c6(0x23c)][_0x3ab3c6(0x1f8)];for(const [_0x43a2a4]of this[_0x3ab3c6(0x23c)]){this[_0x3ab3c6(0x1d9)](_0x43a2a4);}console[_0x3ab3c6(0x320)](_0x3ab3c6(0x2bd)+_0x1b55ce+_0x3ab3c6(0x247));}}exports[a51_0x38a92b(0x2da)]=VisaMasterCardService;function a51_0x321a(){const _0x487332=['No\x20New\x20payment','parse','📤\x20Sending\x20request\x20to\x20API...','-----BEGIN','generateAESKey','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','log','3ds_url','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','Payment\x20cancellation\x20is\x20being\x20processed','default','apiUrl','processWebhook','findUnique','join','aes-256-ctr','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','🔍\x20','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','crypto','PENDING','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','💾\x20Payment\x20data\x20prepared','📊\x20Status\x20check\x20result:','decryptAES','✅\x20Status\x20response\x20decrypted\x20successfully','🧹\x20Card\x20holder\x20names\x20cleaned:','status','encryptAES','__createBinding','📝\x20Encrypted\x20key\x20length:','expire_month','The\x20card\x20does\x20not\x20exist','\x20(from:\x20status=','clearStatusTimers','/charge_decrypt','error','1012tIdZxC','5000000000000000','HTTP\x20error!\x20status:\x20','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','../loggerService','resolve','first_name','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','expire_year','\x20status\x20checks\x20for\x20payment\x20','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','✅\x20Payment\x20','Payment\x20ID:','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','Expected\x20bitcoin\x20transfer\x20from\x20client','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','defineProperty','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','shopId','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','toUpperCase','maskCardNumber','❌\x20RSA\x20encryption\x20failed:','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','loggerService','size','🔐\x20MasterCard\x20Public\x20key\x20path:','readFileSync','set','MasterCard\x20webhook\x20sent\x20to\x20','sign','\x20\x20\x20-\x20sign\x20length:','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','logWhiteDomainRequest','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','\x20payment\x20status:\x20','createdAt','Result\x20URL:','Payment\x20pending\x20verification','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','\x20\x20Original:\x20\x22','⏰\x20Will\x20check\x20status\x20','message','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','Recipient\x20data\x20required','order_id','visa_private.pem','webhookEvents','getCardTypeAndApi','isFinalStatus','📝\x20Encrypted\x20data\x20length:','🔐\x20MasterCard\x20API\x20URL:','Sender\x20information\x20required','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','visaPrivateKeyPath','Payment\x20prohibited','path','Response\x20Body:','\x20\x20\x20Status:\x20','privateDecrypt','payment','🔐\x20AES\x20IV\x20length:','Status:','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','\x20|\x20Response:\x20','failed','paid','Cash\x20payment\x20is\x20expected\x20at\x20TCO','final','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted',',\x20body:\x20','\x20(from:\x20order_id=','🔍\x20Using\x20','paymentStatuses','ms)','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','toString','application/json','getOwnPropertyDescriptor','customerName','trim','\x20\x20\x20Payment\x20ID:\x20','stopAllStatusChecks','VISA/MasterCard','processCardPayment','✅\x20Scheduled\x20','❌\x20PHP\x20decryptor\x20request\x20failed:','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','Request\x20data\x20error','Payment\x20confirmation\x20time\x20has\x20expired','statusCheckTimers','❌\x20RSA\x20signing\x20failed:','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','cvv','then','\x20\x20\x20-\x20merchant_point_id:','randomBytes','/status_decrypted','Client\x20OTP\x20confirmation\x20required','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','createDecipheriv','\x20MasterCard\x20status\x20check\x20timers','/charge',',\x20payment_id=','Captcha\x20confirmation\x20awaited','\x20payment_id\x20for\x20search:\x20','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','merchantPointId','floor','HTTP\x20','webhookUrl','🔐\x20Using\x20keys:\x20','hasOwnProperty','Operation\x20completed\x20successfully','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','unknown','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','getOwnPropertyNames','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','push','/status_decrypt','../telegramBotService','https://api.paydmeth.com/api','desc','replace','validateKeyFiles','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','decryptResponsePhp','json','📊\x20Status\x20check\x20#','amount','LookUp\x20code\x20verified','/charge_raw','Failed\x20payment',',\x20Desc:\x20','now','PAID','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','✅\x20Payment\x20successful','failureMessage','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','Final:','513491zRxKrN','orderId','Amount:','writable','FAILED','payment.success',',\x20final=','Failed\x20to\x20send\x20MasterCard\x20webhook:','constants','MASTERCARD','createCipheriv','masterCardApiUrl','),\x20stopping\x20status\x20checks','charAt','card_type',',\x20paymentId=','delete','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','slice','sendShopWebhook',',\x20id=','logWhiteDomainError','Awaiting\x20confirmation\x20by\x20ivr\x20call','__importStar','../../config/database','keys','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','Failed\x20to\x20decrypt\x20response','Response\x20Time:','🔐\x20MasterCard\x20Private\x20key\x20path:','\x20\x20\x20Currency:\x20','prototype','checkPaymentStatus','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','104KVbyAT','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','Sender\x27s\x20CVV\x20card\x20is\x20required','configurable','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','🔐\x20Data\x20signed\x20with\x20RSA','===\x20API\x20RESPONSE\x20===','sendPaymentNotifications','\x20is\x20final\x20(','The\x20card\x20is\x20lost\x20or\x20stolen','__setModuleDefault','__esModule','\x22\x20|\x20\x22','No\x20Error\x20executing\x20request','stringify','Unknown\x20error','SHA256','\x20\x20\x20Amount:\x20','Payment\x20System/1.0','Sender\x27s\x20card\x20details\x20are\x20required','\x20characters','visaApiUrl','sendPaymentNotification','psp_public.pem','LookUp\x20not\x20confirmed','Status\x20decryption\x20failed:\x20','scheduleStatusChecks','encryptRSA','publicEncrypt','logWhiteDomainResponse','from','length','\x20result:','\x20\x20Cleaned:\x20\x20\x22','\x20payment:\x20','privateKeyPath','),\x20defaulting\x20to\x20MasterCard','🔐\x20Data\x20encrypted\x20with\x20AES','number','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','text','🛑\x20Stopped\x20','❌\x20Data\x20being\x20signed:','payment.failed','5380vpKrUV','📝\x20Signature\x20length:','🔐\x20AES\x20key\x20length:','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','Method\x20not\x20allowed','Status\x20','1494426AxgiVh','cardType','===\x20PARSED\x20API\x20RESPONSE\x20===','LookUp\x20code\x20sent','/status','shop','🔐\x20VISA\x20Public\x20key\x20length:\x20','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','LookUp\x20number\x20of\x20attempts\x20exceeded','📊\x20Checking\x20','info','Payment\x20returned','\x20webhook\x20extracted\x20data:','🎯\x20Using\x20','RSA_PKCS1_PADDING','publicKeyPath','isArray','Awaiting\x20confirmation\x20in\x20the\x20application','\x20\x20\x20-\x20lang:\x20en','create','VisaMasterCardService','toLowerCase','197603JWCaSz','💳\x20VISA/MasterCard\x20service\x20initialized','VISA','decryptResponse','substring','base64','Unsuccessful\x20payment','-----END','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','settings','get','updatePaymentStatus','Webhook\x20event\x20','logShopWebhookError','currency','key','📝\x20Decrypted\x20webhook\x20data:','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','paymentId','POST','gatewayOrderId','payment_id','none','\x20for\x20payment\x20','VISA/MasterCard\x20payment\x20successful','customerEmail','7277898QSlwKS','charge','Payment\x20System/1.0\x20(MasterCard)','utf8','signRSA','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','getDetailedErrorMessage','/charge_decrypted','cwd','Transaction\x20limit\x20exceeded','3DS\x20URL:','1111','4000000000000000','update','PHP\x20decryptor\x20error','visaMerchantPointId','2395534GoPluw','existsSync','includes','last_name','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','__importDefault','85635SMRnZN','description','Payment\x20is\x20being\x20processed','date_success','errorMessage','visaPublicKeyPath','⏰\x20Scheduling\x20status\x20checks\x20for\x20','Insufficient\x20funds\x20on\x20the\x20card','🔐\x20VISA\x20API\x20URL:','\x20status\x20check\x20error:','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','warn','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'];a51_0x321a=function(){return _0x487332;};return a51_0x321a();}