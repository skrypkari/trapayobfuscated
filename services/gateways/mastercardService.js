'use strict';const a46_0x40205a=a46_0xf1ac;(function(_0x30b399,_0x3d424a){const _0x340f39=a46_0xf1ac,_0x7fb951=_0x30b399();while(!![]){try{const _0xe21c5f=-parseInt(_0x340f39(0x11d))/0x1*(parseInt(_0x340f39(0xc2))/0x2)+-parseInt(_0x340f39(0xf6))/0x3+-parseInt(_0x340f39(0x10f))/0x4*(parseInt(_0x340f39(0x18c))/0x5)+-parseInt(_0x340f39(0x137))/0x6*(-parseInt(_0x340f39(0x170))/0x7)+-parseInt(_0x340f39(0x152))/0x8*(parseInt(_0x340f39(0x133))/0x9)+-parseInt(_0x340f39(0x17b))/0xa+parseInt(_0x340f39(0x158))/0xb;if(_0xe21c5f===_0x3d424a)break;else _0x7fb951['push'](_0x7fb951['shift']());}catch(_0xee9c56){_0x7fb951['push'](_0x7fb951['shift']());}}}(a46_0x30d0,0x22b4e));function a46_0x30d0(){const _0x53c381=['__importDefault','🧹\x20Clearing\x20','Status:','webhookEvents','create','Result\x20URL:',',\x20payment_id=','privateKeyPath','error','__setModuleDefault','aes-256-ctr','🎯\x20Using\x20','paidAt','🛑\x20Stopped\x20','failureMessage','989832fsGWSq','HTTP\x20','===\x20API\x20RESPONSE\x20===','decryptResponsePhp','existsSync','/status_decrypted','6705633VScLZK','encryptAES','hasOwnProperty','paymentId','✅\x20Payment\x20successful','first_name','currency','processCardPayment','https://api2.trapay.uk/decrypt.php',',\x20final=','PHP\x20decryptor\x20error','logWhiteDomainResponse','checkPaymentStatus','🔐\x20MasterCard\x20Private\x20key\x20path:','❌\x20RSA\x20signing\x20failed:','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','🔐\x20AES\x20IV\x20length:','base64','then','publicEncrypt','\x20\x20\x20Status:\x20','now','FAILED','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','7EUgWlF','🔐\x20AES\x20key\x20and\x20IV\x20generated','/charge','defineProperty','Decryption\x20failed:\x20','cardType','sendPaymentNotification','privateDecrypt','clearStatusTimers','🔐\x20Data\x20encrypted\x20with\x20AES','Payment\x20ID:','2236260giNwMW','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','description','📝\x20Signature\x20length:','trim','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','expire_month','Unknown\x20error','sendPaymentNotifications','cwd','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','\x20characters','🔐\x20VISA\x20Public\x20key\x20length:\x20','floor','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','includes','\x20(from:\x20status=','544555kzBTIM','🔐\x20MasterCard\x20Private\x20key\x20length:\x20',',\x20Desc:\x20','/status','charge','scheduleStatusChecks','visaApiUrl','POST','HTTP\x20error!\x20status:\x20','stringify','charAt','loggerService','maskCardNumber','\x20with\x20status\x20','/charge_raw','❌\x20Status\x20check\x20#','logShopWebhookSent','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','forEach','❌\x20Failure\x20description:\x20','\x20result:','card_type','\x20payment:\x20','default','\x20order_id\x20for\x20search:\x20','visa_public.pem','message','settings','/status_decrypt','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','webhook_send','sign','cvv','createCipheriv','logShopWebhookError','encryptRSA','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','signRSA','visaMerchantPointId','💾\x20Saving\x20failure\x20message:\x20','),\x20defaulting\x20to\x20MasterCard','-----BEGIN','MASTERCARD','\x20status\x20updated\x20to\x20','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','configurable','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Failed\x20to\x20send\x20MasterCard\x20webhook:','🔐\x20VISA\x20Public\x20key\x20path:','✅\x20Scheduled\x20','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','__esModule','📊\x20Status\x20check\x20result:','Return\x20URL:','shop','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','text','masterCardMerchantPointId','gatewayOrderId','PENDING','4000000000000000','validateKeyFiles','✅\x20Payment\x20','📝\x20Data\x20to\x20sign\x20length:','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','size','customerEmail','\x20not\x20enabled\x20for\x20shop\x20','parse','processWebhook','sendShopWebhook','amount','\x20\x20\x20-\x20lang:\x20en',',\x20orderId=','\x20\x20\x20-\x20sign\x20length:','readFileSync','shopId','toString','push','SHA256','json','get','stopAllStatusChecks','logWhiteDomainError','customerName','join','\x20payment\x20status:\x20','orderId','date_success','writable','unknown','randomBytes','🔍\x20Using\x20','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','\x20status\x20timers\x20for\x20payment\x20','utf8','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','key','📝\x20Encrypted\x20key\x20length:','isArray','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','118svHibw','merchantPointId','📝\x20Encrypted\x20data\x20length:','visa_private.pem','toLowerCase','toUpperCase','decryptAES','🔐\x20Data\x20signed\x20with\x20RSA','\x20\x20\x20Payment\x20ID:\x20','🔐\x20VISA\x20Private\x20key\x20length:\x20','../loggerService','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','length','getOwnPropertyDescriptor','statusCheckTimers','3ds_url','payment_id','webhookUrl','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','expire_year','visa/mastercard','❌\x20Data\x20being\x20signed:','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','/charge_decrypt','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','\x20API:\x20','\x20(from:\x20order_id=','Failed\x20to\x20send\x20payment\x20notifications:','publicKeyPath','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','delete','💳\x20VISA/MasterCard\x20service\x20initialized','🔐\x20VISA\x20API\x20URL:','system','VisaMasterCardService','slice','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','https://api.paydmeth.com/api','masterCardApiUrl','\x20\x20\x20-\x20method:\x20charge','/status_raw','visaPublicKeyPath','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','✅\x20VISA\x20key\x20files\x20validated\x20successfully','crypto','🔍\x20Using\x20provided\x20card\x20type:\x20','\x20status\x20check\x20#','\x20for\x20payment\x20','203019xhrjdN','Amount:','🔍\x20','application/json','path','order_id','../telegramBotService','Status\x20decryption\x20failed:\x20','5000000000000000','status','desc','update','Response\x20Time:','prototype','keys','number','generateAESKey','Final:','resolve','private.pem','...','PAID','\x20\x20\x20-\x20info\x20length:','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','final','4osKmKp','visaPrivateKeyPath','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','VISA/MasterCard\x20payment\x20successful','🔐\x20MasterCard\x20API\x20URL:','adminNotes','payment','❌\x20RSA\x20encryption\x20failed:','❌\x20PHP\x20decryptor\x20request\x20failed:','set','📊\x20','Failed\x20to\x20check\x20','🔐\x20AES\x20key\x20length:','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','2694cBeuAj','🔐\x203DS\x20verification\x20required','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','1111','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','apiUrl','-----END','createdAt','/charge_decrypted','info','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','MasterCard\x20webhook\x20sent\x20to\x20','warn','🔐\x20RSA\x20signing\x20successful','Error\x20details:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','createSign','end',',\x20body:\x20','\x20\x20\x20Amount:\x20','getCardTypeAndApi','🔐\x20VISA\x20Private\x20key\x20path:','9fPrITv','VISA','HTTP\x20Status:','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','1292640rzMKvK','logWhiteDomainRequest','\x20status\x20checks\x20for\x20payment\x20','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','from','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','createDecipheriv','log','ms)','),\x20stopping\x20status\x20checks','📝\x20Final\x20request\x20structure:','Failed\x20to\x20decrypt\x20response'];a46_0x30d0=function(){return _0x53c381;};return a46_0x30d0();}var __createBinding=this&&this['__createBinding']||(Object[a46_0x40205a(0x147)]?function(_0x205505,_0x1717ce,_0x55d9a8,_0xc6dc4e){const _0x45f290=a46_0x40205a;if(_0xc6dc4e===undefined)_0xc6dc4e=_0x55d9a8;var _0x523d8c=Object[_0x45f290(0xcf)](_0x1717ce,_0x55d9a8);(!_0x523d8c||(_0x45f290(0xae)in _0x523d8c?!_0x1717ce[_0x45f290(0x90)]:_0x523d8c[_0x45f290(0xb6)]||_0x523d8c[_0x45f290(0x8a)]))&&(_0x523d8c={'enumerable':!![],'get':function(){return _0x1717ce[_0x55d9a8];}}),Object[_0x45f290(0x173)](_0x205505,_0xc6dc4e,_0x523d8c);}:function(_0x3fc7ac,_0xfbf345,_0x22574c,_0x4e42d1){if(_0x4e42d1===undefined)_0x4e42d1=_0x22574c;_0x3fc7ac[_0x4e42d1]=_0xfbf345[_0x22574c];}),__setModuleDefault=this&&this[a46_0x40205a(0x14c)]||(Object[a46_0x40205a(0x147)]?function(_0x5a9fc1,_0x222e6f){const _0x480f03=a46_0x40205a;Object['defineProperty'](_0x5a9fc1,_0x480f03(0x1a5),{'enumerable':!![],'value':_0x222e6f});}:function(_0x4f4f3b,_0x1acaf1){const _0x266101=a46_0x40205a;_0x4f4f3b[_0x266101(0x1a5)]=_0x1acaf1;}),__importStar=this&&this['__importStar']||(function(){var _0x8d4498=function(_0x4c9da7){return _0x8d4498=Object['getOwnPropertyNames']||function(_0x1599f8){const _0x397245=a46_0xf1ac;var _0x16e31f=[];for(var _0x54d250 in _0x1599f8)if(Object[_0x397245(0x103)][_0x397245(0x15a)]['call'](_0x1599f8,_0x54d250))_0x16e31f[_0x16e31f[_0x397245(0xce)]]=_0x54d250;return _0x16e31f;},_0x8d4498(_0x4c9da7);};return function(_0x8ba5ec){const _0x44a595=a46_0xf1ac;if(_0x8ba5ec&&_0x8ba5ec[_0x44a595(0x90)])return _0x8ba5ec;var _0x5c6abb={};if(_0x8ba5ec!=null){for(var _0x3232d4=_0x8d4498(_0x8ba5ec),_0x3ab856=0x0;_0x3ab856<_0x3232d4['length'];_0x3ab856++)if(_0x3232d4[_0x3ab856]!==_0x44a595(0x1a5))__createBinding(_0x5c6abb,_0x8ba5ec,_0x3232d4[_0x3ab856]);}return __setModuleDefault(_0x5c6abb,_0x8ba5ec),_0x5c6abb;};}()),__importDefault=this&&this[a46_0x40205a(0x143)]||function(_0x22eb8b){return _0x22eb8b&&_0x22eb8b['__esModule']?_0x22eb8b:{'default':_0x22eb8b};};Object[a46_0x40205a(0x173)](exports,a46_0x40205a(0x90),{'value':!![]}),exports[a46_0x40205a(0xe7)]=void 0x0;function a46_0xf1ac(_0xcd7b6b,_0x40bbdc){const _0x30d0bf=a46_0x30d0();return a46_0xf1ac=function(_0xf1ac53,_0xab8a05){_0xf1ac53=_0xf1ac53-0x84;let _0x1ad054=_0x30d0bf[_0xf1ac53];return _0x1ad054;},a46_0xf1ac(_0xcd7b6b,_0x40bbdc);}const crypto_1=__importDefault(require(a46_0x40205a(0xf2))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a46_0x40205a(0xfa))),loggerService_1=require(a46_0x40205a(0xcc));class VisaMasterCardService{constructor(){const _0x1cdf63=a46_0x40205a;this[_0x1cdf63(0xd0)]=new Map(),this[_0x1cdf63(0xec)]=_0x1cdf63(0xeb),this['masterCardMerchantPointId']=0x6a7,this[_0x1cdf63(0x14a)]=path_1[_0x1cdf63(0x1a5)][_0x1cdf63(0xb2)](process[_0x1cdf63(0x184)](),_0x1cdf63(0x104),_0x1cdf63(0x109)),this[_0x1cdf63(0xe1)]=path_1[_0x1cdf63(0x1a5)][_0x1cdf63(0xb2)](process['cwd'](),_0x1cdf63(0x104),'psp_public.pem'),this[_0x1cdf63(0x192)]=_0x1cdf63(0xeb),this[_0x1cdf63(0x1b4)]=0x6b7,this[_0x1cdf63(0x110)]=path_1[_0x1cdf63(0x1a5)][_0x1cdf63(0xb2)](process[_0x1cdf63(0x184)](),'keys',_0x1cdf63(0xc5)),this[_0x1cdf63(0xef)]=path_1[_0x1cdf63(0x1a5)]['join'](process[_0x1cdf63(0x184)](),_0x1cdf63(0x104),_0x1cdf63(0x1a7)),console[_0x1cdf63(0x13e)](_0x1cdf63(0xe4)),console[_0x1cdf63(0x13e)](_0x1cdf63(0x113),this['masterCardApiUrl']),console[_0x1cdf63(0x13e)](_0x1cdf63(0xe5),this[_0x1cdf63(0x192)]),console[_0x1cdf63(0x13e)](_0x1cdf63(0x165),this['privateKeyPath']),console[_0x1cdf63(0x13e)]('🔐\x20MasterCard\x20Public\x20key\x20path:',this[_0x1cdf63(0xe1)]),console[_0x1cdf63(0x13e)](_0x1cdf63(0x132),this[_0x1cdf63(0x110)]),console['log'](_0x1cdf63(0x8d),this[_0x1cdf63(0xef)]),this[_0x1cdf63(0x9a)]();}[a46_0x40205a(0x131)](_0x41f9f6){const _0x3c85cc=a46_0x40205a,_0x31f70f=_0x41f9f6[_0x3c85cc(0x196)](0x0);if(_0x31f70f==='4')return console['log'](_0x3c85cc(0xcd)),{'cardType':'VISA','apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x3c85cc(0x110)],'publicKeyPath':this['visaPublicKeyPath'],'merchantPointId':this[_0x3c85cc(0x1b4)]};else return _0x31f70f==='5'?(console[_0x3c85cc(0x13e)](_0x3c85cc(0x13a)),{'cardType':_0x3c85cc(0x87),'apiUrl':this[_0x3c85cc(0xec)],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x3c85cc(0x96)]}):(console[_0x3c85cc(0x13e)](_0x3c85cc(0xe9)+_0x31f70f+_0x3c85cc(0x85)),{'cardType':_0x3c85cc(0x87),'apiUrl':this[_0x3c85cc(0xec)],'privateKeyPath':this[_0x3c85cc(0x14a)],'publicKeyPath':this[_0x3c85cc(0xe1)],'merchantPointId':this[_0x3c85cc(0x96)]});}[a46_0x40205a(0x9a)](){const _0x59f7f3=a46_0x40205a;try{if(!fs_1['default'][_0x59f7f3(0x156)](this[_0x59f7f3(0x14a)]))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this[_0x59f7f3(0x14a)]);if(!fs_1['default'][_0x59f7f3(0x156)](this[_0x59f7f3(0xe1)]))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this[_0x59f7f3(0xe1)]);const _0x24845a=fs_1[_0x59f7f3(0x1a5)][_0x59f7f3(0xa8)](this[_0x59f7f3(0x14a)],_0x59f7f3(0xbc))['trim'](),_0x99f026=fs_1[_0x59f7f3(0x1a5)][_0x59f7f3(0xa8)](this['publicKeyPath'],_0x59f7f3(0xbc))[_0x59f7f3(0x17f)]();if(!_0x24845a['includes']('-----BEGIN')||!_0x24845a['includes']('-----END'))throw new Error(_0x59f7f3(0x8b));if(!_0x99f026[_0x59f7f3(0x18a)]('-----BEGIN')||!_0x99f026[_0x59f7f3(0x18a)](_0x59f7f3(0x123)))throw new Error(_0x59f7f3(0x13c));console[_0x59f7f3(0x13e)](_0x59f7f3(0x16f)),console['log'](_0x59f7f3(0x18d)+_0x24845a[_0x59f7f3(0xce)]+_0x59f7f3(0x186)),console[_0x59f7f3(0x13e)](_0x59f7f3(0xd4)+_0x99f026['length']+_0x59f7f3(0x186));if(fs_1['default'][_0x59f7f3(0x156)](this['visaPrivateKeyPath'])&&fs_1['default'][_0x59f7f3(0x156)](this[_0x59f7f3(0xef)])){const _0x523ca3=fs_1[_0x59f7f3(0x1a5)]['readFileSync'](this[_0x59f7f3(0x110)],'utf8')[_0x59f7f3(0x17f)](),_0x564d03=fs_1[_0x59f7f3(0x1a5)][_0x59f7f3(0xa8)](this[_0x59f7f3(0xef)],_0x59f7f3(0xbc))[_0x59f7f3(0x17f)]();(!_0x523ca3[_0x59f7f3(0x18a)](_0x59f7f3(0x86))||!_0x523ca3['includes']('-----END'))&&console[_0x59f7f3(0x129)](_0x59f7f3(0xea)),(!_0x564d03[_0x59f7f3(0x18a)](_0x59f7f3(0x86))||!_0x564d03[_0x59f7f3(0x18a)]('-----END'))&&console[_0x59f7f3(0x129)](_0x59f7f3(0xba)),console['log'](_0x59f7f3(0xf1)),console[_0x59f7f3(0x13e)](_0x59f7f3(0xcb)+_0x523ca3[_0x59f7f3(0xce)]+_0x59f7f3(0x186)),console['log'](_0x59f7f3(0x187)+_0x564d03[_0x59f7f3(0xce)]+_0x59f7f3(0x186));}else console[_0x59f7f3(0x129)](_0x59f7f3(0x1ab)),console[_0x59f7f3(0x129)](_0x59f7f3(0x189)+this[_0x59f7f3(0x110)]),console[_0x59f7f3(0x129)](_0x59f7f3(0xd5)+this[_0x59f7f3(0xef)]);}catch(_0x420a1a){console['error'](_0x59f7f3(0x19f),_0x420a1a);throw _0x420a1a;}}[a46_0x40205a(0x106)](){const _0x5ec242=a46_0x40205a,_0x13ed6e=crypto_1[_0x5ec242(0x1a5)][_0x5ec242(0xb8)](0x20),_0x271b35=crypto_1['default']['randomBytes'](0x10);return{'key':_0x13ed6e,'iv':_0x271b35};}[a46_0x40205a(0x159)](_0xde3bf9,_0x286e01,_0x583818){const _0x14f5a9=a46_0x40205a,_0x48703c=crypto_1[_0x14f5a9(0x1a5)][_0x14f5a9(0x1af)](_0x14f5a9(0x14d),_0x286e01,_0x583818);let _0x26444d=_0x48703c[_0x14f5a9(0x101)](_0xde3bf9,_0x14f5a9(0xbc),_0x14f5a9(0x169));return _0x26444d+=_0x48703c['final'](_0x14f5a9(0x169)),_0x26444d;}[a46_0x40205a(0x1b1)](_0x23da09,_0x23d8ad,_0x3996da){const _0x2f9fab=a46_0x40205a;try{const _0x4f48e4=fs_1['default'][_0x2f9fab(0xa8)](_0x3996da,_0x2f9fab(0xbc))[_0x2f9fab(0x17f)](),_0x30dac7={'iv':_0x23d8ad[_0x2f9fab(0xaa)]('base64'),'key':_0x23da09[_0x2f9fab(0xaa)](_0x2f9fab(0x169))},_0x51b03f=JSON[_0x2f9fab(0x195)](_0x30dac7);console[_0x2f9fab(0x13e)](_0x2f9fab(0x89),_0x51b03f['length']);const _0x1acc23=crypto_1[_0x2f9fab(0x1a5)][_0x2f9fab(0x16b)]({'key':_0x4f48e4,'padding':crypto_1[_0x2f9fab(0x1a5)]['constants']['RSA_PKCS1_PADDING']},Buffer[_0x2f9fab(0x13b)](_0x51b03f));return console[_0x2f9fab(0x13e)](_0x2f9fab(0xd9),_0x1acc23['length']),_0x1acc23[_0x2f9fab(0xaa)](_0x2f9fab(0x169));}catch(_0x73afd6){console['error'](_0x2f9fab(0x116),_0x73afd6);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a46_0x40205a(0x1b3)](_0x56639e,_0x22ddfb){const _0x29e90b=a46_0x40205a;try{const _0x4a49cc=fs_1[_0x29e90b(0x1a5)][_0x29e90b(0xa8)](_0x22ddfb,_0x29e90b(0xbc))[_0x29e90b(0x17f)](),_0x2009ee=crypto_1[_0x29e90b(0x1a5)][_0x29e90b(0x12d)](_0x29e90b(0xac));_0x2009ee[_0x29e90b(0x101)](_0x56639e),_0x2009ee[_0x29e90b(0x12e)]();const _0x4398c3=_0x2009ee[_0x29e90b(0x1ad)](_0x4a49cc,'base64');return console[_0x29e90b(0x13e)](_0x29e90b(0x12a)),console[_0x29e90b(0x13e)](_0x29e90b(0x9c),_0x56639e[_0x29e90b(0xce)]),console[_0x29e90b(0x13e)](_0x29e90b(0x17e),_0x4398c3['length']),_0x4398c3;}catch(_0x248f7b){console[_0x29e90b(0x14b)](_0x29e90b(0x166),_0x248f7b),console[_0x29e90b(0x14b)](_0x29e90b(0xd8),_0x56639e['substring'](0x0,0xc8)+_0x29e90b(0x10a));throw new Error(_0x29e90b(0x1b2));}}[a46_0x40205a(0xc8)](_0x3bb9ac,_0x3f1648,_0x35b8ab){const _0x10a749=a46_0x40205a,_0xb746e9=crypto_1[_0x10a749(0x1a5)][_0x10a749(0x13d)]('aes-256-ctr',_0x3f1648,_0x35b8ab);let _0x598f52=_0xb746e9[_0x10a749(0x101)](_0x3bb9ac,_0x10a749(0x169),_0x10a749(0xbc));return _0x598f52+=_0xb746e9[_0x10a749(0x10e)](_0x10a749(0xbc)),_0x598f52;}async[a46_0x40205a(0x155)](_0x40f620,_0x198369,_0x544a6b='MASTERCARD'){const _0x3fd8c7=a46_0x40205a;try{const _0x1f85d5=await fetch(_0x3fd8c7(0x160),{'method':_0x3fd8c7(0x193),'headers':{'Content-Type':_0x3fd8c7(0xf9)},'body':JSON[_0x3fd8c7(0x195)]({'info':_0x40f620,'key':_0x198369,'card_type':_0x544a6b['toLowerCase']()})});if(!_0x1f85d5['ok'])throw new Error(_0x3fd8c7(0x162));return await _0x1f85d5[_0x3fd8c7(0x95)]();}catch(_0x597533){console[_0x3fd8c7(0x14b)](_0x3fd8c7(0x117),_0x597533);throw new Error(_0x3fd8c7(0xdb));}}['decryptResponse'](_0x1ffd27,_0xf3e465){const _0x29359e=a46_0x40205a;try{const _0x4570b5=fs_1[_0x29359e(0x1a5)]['readFileSync'](this['privateKeyPath'],_0x29359e(0xbc))[_0x29359e(0x17f)](),_0x2b44d6=crypto_1['default'][_0x29359e(0x177)](_0x4570b5,Buffer[_0x29359e(0x13b)](_0xf3e465,_0x29359e(0x169))),_0x1eadc4=JSON[_0x29359e(0xa1)](_0x2b44d6[_0x29359e(0xaa)]()),_0x5b1327=Buffer[_0x29359e(0x13b)](_0x1eadc4[_0x29359e(0xbe)],_0x29359e(0x169)),_0x3b0a84=Buffer['from'](_0x1eadc4['iv'],_0x29359e(0x169));return this[_0x29359e(0xc8)](_0x1ffd27,_0x5b1327,_0x3b0a84);}catch(_0x20d088){throw new Error(_0x29359e(0x142));}}async[a46_0x40205a(0x15f)](_0xe0086e){const _0x334d5b=a46_0x40205a,{paymentId:_0x2129e6,orderId:_0x390a54,amount:_0x220539,currency:_0x43fe7f,cardData:_0x5630aa,resultUrl:_0x54d35a,returnUrl:_0x2071f1,cardHolder:_0x9c6384,browser:_0x412297}=_0xe0086e;console[_0x334d5b(0x13e)](_0x334d5b(0xda)),console[_0x334d5b(0x13e)](_0x334d5b(0x17a),_0x2129e6),console['log']('Order\x20ID:',_0x390a54),console[_0x334d5b(0x13e)](_0x334d5b(0xf7),_0x220539,_0x43fe7f),console['log']('Card\x20Number:',this[_0x334d5b(0x198)](_0x5630aa[_0x334d5b(0x105)])),console[_0x334d5b(0x13e)]('Card\x20Holder:',_0x9c6384[_0x334d5b(0x15d)]+'\x20'+_0x9c6384['last_name']),console[_0x334d5b(0x13e)](_0x334d5b(0x92),_0x2071f1),console[_0x334d5b(0x13e)](_0x334d5b(0x148),_0x54d35a);const _0x2dd718=this[_0x334d5b(0x131)](_0x5630aa['number']);console[_0x334d5b(0x13e)](_0x334d5b(0x14e)+_0x2dd718[_0x334d5b(0x175)]+_0x334d5b(0xde)+_0x2dd718[_0x334d5b(0x122)]),console[_0x334d5b(0x13e)]('🔐\x20Using\x20keys:\x20'+_0x2dd718['privateKeyPath']+',\x20'+_0x2dd718['publicKeyPath']);const _0x2b0269={'amount':_0x220539,'currency':_0x43fe7f[_0x334d5b(0xc7)](),'order_id':_0x390a54,'result_url':_0x54d35a,'return_url':_0x2071f1,'country':'','card':{'number':_0x5630aa['number'],'expire_month':_0x5630aa[_0x334d5b(0x181)],'expire_year':_0x5630aa[_0x334d5b(0xd6)],'cvv':_0x5630aa[_0x334d5b(0x1ae)]},'card_holder':_0x9c6384,'browser':_0x412297},_0x13ed07=JSON[_0x334d5b(0x195)](_0x2b0269);console[_0x334d5b(0x13e)]('💾\x20Payment\x20data\x20prepared'),console[_0x334d5b(0x13e)](_0x334d5b(0xbd)),console[_0x334d5b(0x13e)](_0x13ed07),console[_0x334d5b(0x13e)]('📝\x20Data\x20length:',_0x13ed07[_0x334d5b(0xce)]);try{const {key:_0xed19e6,iv:_0x5a4290}=this[_0x334d5b(0x106)]();console['log'](_0x334d5b(0x171)),console[_0x334d5b(0x13e)](_0x334d5b(0x11b),_0xed19e6[_0x334d5b(0xce)]),console[_0x334d5b(0x13e)](_0x334d5b(0x168),_0x5a4290[_0x334d5b(0xce)]);const _0x5d7834=this[_0x334d5b(0x159)](_0x13ed07,_0xed19e6,_0x5a4290);console[_0x334d5b(0x13e)](_0x334d5b(0x179)),console[_0x334d5b(0x13e)](_0x334d5b(0xc4),_0x5d7834['length']);const _0x4f3aeb=this[_0x334d5b(0x1b1)](_0xed19e6,_0x5a4290,_0x2dd718[_0x334d5b(0xe1)]);console[_0x334d5b(0x13e)](_0x334d5b(0x9d)),console[_0x334d5b(0x13e)](_0x334d5b(0xbf),_0x4f3aeb[_0x334d5b(0xce)]);const _0x3bd428=this[_0x334d5b(0x1b3)](_0x13ed07,_0x2dd718['privateKeyPath']);console[_0x334d5b(0x13e)](_0x334d5b(0xc9)),console[_0x334d5b(0x13e)]('📝\x20Signature\x20length:',_0x3bd428[_0x334d5b(0xce)]);const _0x569fa5={'merchant_point_id':_0x2dd718[_0x334d5b(0xc3)],'method':_0x334d5b(0x190),'info':_0x5d7834,'key':_0x4f3aeb,'sign':_0x3bd428,'lang':'en'};console['log']('📤\x20Sending\x20request\x20to\x20API...'),console[_0x334d5b(0x13e)](_0x334d5b(0x141)),console[_0x334d5b(0x13e)]('\x20\x20\x20-\x20merchant_point_id:',_0x2dd718[_0x334d5b(0xc3)]),console[_0x334d5b(0x13e)](_0x334d5b(0xed)),console[_0x334d5b(0x13e)](_0x334d5b(0x10c),_0x5d7834[_0x334d5b(0xce)]),console['log']('\x20\x20\x20-\x20key\x20length:',_0x4f3aeb['length']),console[_0x334d5b(0x13e)](_0x334d5b(0xa7),_0x3bd428['length']),console[_0x334d5b(0x13e)](_0x334d5b(0xa5)),loggerService_1[_0x334d5b(0x197)][_0x334d5b(0x138)](_0x2dd718[_0x334d5b(0x175)][_0x334d5b(0xc6)](),_0x334d5b(0x172),_0x334d5b(0x193),{'merchant_point_id':_0x2dd718[_0x334d5b(0xc3)],'method':_0x334d5b(0x190),'lang':'en'});const _0x897221=Date[_0x334d5b(0x16d)](),_0x19ec71=await fetch(_0x2dd718[_0x334d5b(0x122)],{'method':_0x334d5b(0x193),'headers':{'Content-Type':_0x334d5b(0xf9),'Accept':_0x334d5b(0xf9),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x334d5b(0x195)](_0x569fa5)}),_0xf816c0=Date['now']()-_0x897221;console[_0x334d5b(0x13e)](_0x334d5b(0x154)),console[_0x334d5b(0x13e)]('Status:',_0x19ec71[_0x334d5b(0xff)]),console['log'](_0x334d5b(0x102),_0xf816c0+'ms');if(!_0x19ec71['ok']){const _0x1707b3=await _0x19ec71[_0x334d5b(0x95)]();console[_0x334d5b(0x14b)](_0x334d5b(0x135),_0x19ec71[_0x334d5b(0xff)]),console['error']('Response\x20Body:',_0x1707b3),loggerService_1['loggerService'][_0x334d5b(0x163)](_0x2dd718[_0x334d5b(0x175)][_0x334d5b(0xc6)](),'/charge_raw',_0x19ec71[_0x334d5b(0xff)],_0x1707b3,_0xf816c0),loggerService_1[_0x334d5b(0x197)][_0x334d5b(0xb0)](_0x2dd718['cardType']['toLowerCase'](),'/charge',_0x334d5b(0x153)+_0x19ec71[_0x334d5b(0xff)]+':\x20'+_0x1707b3);throw new Error(_0x334d5b(0x194)+_0x19ec71[_0x334d5b(0xff)]+_0x334d5b(0x12f)+_0x1707b3);}const _0x3065f4=await _0x19ec71[_0x334d5b(0xad)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2dd718[_0x334d5b(0x175)][_0x334d5b(0xc6)](),_0x334d5b(0x19a),_0x19ec71['status'],_0x3065f4,_0xf816c0),console[_0x334d5b(0x13e)]('===\x20PARSED\x20API\x20RESPONSE\x20===');let _0x508f85=_0x3065f4;if(_0x3065f4[_0x334d5b(0x126)]&&_0x3065f4[_0x334d5b(0xbe)]&&_0x3065f4[_0x334d5b(0x1ad)]){console['log'](_0x334d5b(0x185));try{const _0x5b7a55=await this['decryptResponsePhp'](_0x3065f4['info'],_0x3065f4['key'],_0x2dd718[_0x334d5b(0x175)]);_0x508f85=JSON[_0x334d5b(0xa1)](_0x5b7a55),console['log']('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0x334d5b(0x197)][_0x334d5b(0x163)](_0x2dd718[_0x334d5b(0x175)][_0x334d5b(0xc6)](),_0x334d5b(0x125),_0x19ec71[_0x334d5b(0xff)],_0x508f85,_0xf816c0),console[_0x334d5b(0x13e)](_0x334d5b(0x111));}catch(_0x329ae9){console[_0x334d5b(0x14b)](_0x334d5b(0xe2),_0x329ae9),loggerService_1[_0x334d5b(0x197)][_0x334d5b(0xb0)](_0x2dd718['cardType']['toLowerCase'](),_0x334d5b(0xdc),_0x334d5b(0x174)+_0x329ae9),_0x508f85=_0x3065f4;}}else loggerService_1[_0x334d5b(0x197)]['logWhiteDomainResponse'](_0x2dd718[_0x334d5b(0x175)][_0x334d5b(0xc6)](),_0x334d5b(0x125),_0x19ec71[_0x334d5b(0xff)],_0x508f85,_0xf816c0),console[_0x334d5b(0x13e)](_0x334d5b(0x10d));console['log'](_0x334d5b(0x145),_0x508f85[_0x334d5b(0xff)]),console[_0x334d5b(0x13e)](_0x334d5b(0x107),_0x508f85[_0x334d5b(0x10e)]),console[_0x334d5b(0x13e)](_0x334d5b(0x17a),_0x508f85['payment_id']),console['log']('3DS\x20URL:',_0x508f85['3ds_url']||'none');if(_0x508f85[_0x334d5b(0xff)]===0x64&&_0x508f85[_0x334d5b(0x10e)]===0x1)return console['log'](_0x334d5b(0x15c)),{'gateway_payment_id':_0x508f85[_0x334d5b(0xd2)]?.[_0x334d5b(0xaa)](),'payment_url':_0x2071f1,'requires_3ds':![],'status':_0x334d5b(0x10b),'final':!![]};if(_0x508f85['3ds_url'])return console[_0x334d5b(0x13e)](_0x334d5b(0x11e)),this[_0x334d5b(0x191)](_0x2129e6,_0x390a54,_0x508f85['payment_id']?.[_0x334d5b(0xaa)]()||_0x390a54,_0x2dd718['cardType']),{'gateway_payment_id':_0x508f85[_0x334d5b(0xd2)]?.[_0x334d5b(0xaa)](),'payment_url':_0x508f85[_0x334d5b(0xd1)],'requires_3ds':!![],'threeds_url':_0x508f85[_0x334d5b(0xd1)],'status':_0x334d5b(0x98),'final':![]};let _0x4f6e8e=_0x508f85[_0x334d5b(0x100)]||_0x508f85[_0x334d5b(0x1a8)]||'Unknown\x20error',_0x34a56c=_0x508f85[_0x334d5b(0xff)],_0x5bb0f0=_0x508f85['final'];return console[_0x334d5b(0x13e)](_0x334d5b(0x167)+_0x34a56c+',\x20Final:\x20'+_0x5bb0f0+_0x334d5b(0x18e)+_0x4f6e8e),{'gateway_payment_id':_0x508f85[_0x334d5b(0xd2)]?.[_0x334d5b(0xaa)](),'payment_url':_0x2071f1,'requires_3ds':![],'status':'FAILED','final':!![]};}catch(_0x472e51){console[_0x334d5b(0x14b)](_0x334d5b(0x11f)),console[_0x334d5b(0x14b)](_0x334d5b(0x12b),_0x472e51),loggerService_1[_0x334d5b(0x197)][_0x334d5b(0xb0)](_0x334d5b(0xd7),_0x334d5b(0x172),_0x472e51);throw new Error('Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'+(_0x472e51 instanceof Error?_0x472e51[_0x334d5b(0x1a8)]:_0x334d5b(0x182)));}}async[a46_0x40205a(0x164)](_0x27db5a,_0x5d74b4,_0x4e0ce3='VISA'){const _0x25e37b=a46_0x40205a;console[_0x25e37b(0x13e)]('📊\x20Checking\x20'+_0x4e0ce3+_0x25e37b(0xb3)+_0x27db5a+'\x20('+_0x5d74b4+')');try{const _0x2610ea={'payment_id':_0x27db5a,'order_id':_0x5d74b4},_0x44d935=JSON[_0x25e37b(0x195)](_0x2610ea),_0x355710=this[_0x25e37b(0x131)](_0x4e0ce3===_0x25e37b(0x134)?_0x25e37b(0x99):_0x25e37b(0xfe)),{key:_0x571dcf,iv:_0x2b82fd}=this[_0x25e37b(0x106)](),_0x1f3569=this[_0x25e37b(0x159)](_0x44d935,_0x571dcf,_0x2b82fd),_0x4951fa=this[_0x25e37b(0x1b1)](_0x571dcf,_0x2b82fd,_0x355710[_0x25e37b(0xe1)]),_0x24f34d=this[_0x25e37b(0x1b3)](_0x44d935,_0x355710[_0x25e37b(0x14a)]),_0x12082d={'merchant_point_id':_0x355710[_0x25e37b(0xc3)],'method':'status','info':_0x1f3569,'key':_0x4951fa,'sign':_0x24f34d,'lang':'en'};loggerService_1[_0x25e37b(0x197)][_0x25e37b(0x138)](_0x4e0ce3[_0x25e37b(0xc6)](),_0x25e37b(0x18f),_0x25e37b(0x193),{'merchant_point_id':_0x355710[_0x25e37b(0xc3)],'method':_0x25e37b(0xff),'lang':'en'});const _0x21ddef=Date['now'](),_0x3da838=await fetch(_0x355710[_0x25e37b(0x122)],{'method':_0x25e37b(0x193),'headers':{'Content-Type':_0x25e37b(0xf9),'Accept':_0x25e37b(0xf9),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x12082d)}),_0x197eb2=Date['now']()-_0x21ddef;if(!_0x3da838['ok']){const _0x253e2f=await _0x3da838[_0x25e37b(0x95)]();loggerService_1[_0x25e37b(0x197)][_0x25e37b(0x163)](_0x4e0ce3[_0x25e37b(0xc6)](),_0x25e37b(0xee),_0x3da838[_0x25e37b(0xff)],_0x253e2f,_0x197eb2);throw new Error(_0x25e37b(0x194)+_0x3da838[_0x25e37b(0xff)]);}const _0x2dd01c=await _0x3da838['json']();loggerService_1[_0x25e37b(0x197)][_0x25e37b(0x163)](_0x4e0ce3[_0x25e37b(0xc6)](),_0x25e37b(0xee),_0x3da838[_0x25e37b(0xff)],_0x2dd01c,_0x197eb2);let _0x593566=_0x2dd01c;if(_0x2dd01c[_0x25e37b(0x126)]&&_0x2dd01c[_0x25e37b(0xbe)]&&_0x2dd01c[_0x25e37b(0x1ad)]){console[_0x25e37b(0x13e)](_0x25e37b(0xc1));try{const _0xdba38a=await this['decryptResponsePhp'](_0x2dd01c[_0x25e37b(0x126)],_0x2dd01c['key'],_0x4e0ce3);_0x593566=JSON[_0x25e37b(0xa1)](_0xdba38a),console['log']('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1['loggerService'][_0x25e37b(0x163)](_0x4e0ce3[_0x25e37b(0xc6)](),_0x25e37b(0x157),_0x3da838[_0x25e37b(0xff)],_0x593566,_0x197eb2),console['log'](_0x25e37b(0x136));}catch(_0x2891a4){console[_0x25e37b(0x14b)](_0x25e37b(0x127),_0x2891a4),loggerService_1['loggerService']['logWhiteDomainError'](_0x4e0ce3[_0x25e37b(0xc6)](),_0x25e37b(0x1aa),_0x25e37b(0xfd)+_0x2891a4),_0x593566=_0x2dd01c;}}else loggerService_1[_0x25e37b(0x197)]['logWhiteDomainResponse'](_0x4e0ce3[_0x25e37b(0xc6)](),_0x25e37b(0x157),_0x3da838[_0x25e37b(0xff)],_0x593566,_0x197eb2),console[_0x25e37b(0x13e)](_0x25e37b(0x8f));console[_0x25e37b(0x13e)](_0x25e37b(0x91),{'status':_0x593566['status'],'final':_0x593566['final'],'payment_id':_0x593566[_0x25e37b(0xd2)],'desc':_0x593566[_0x25e37b(0x100)]});let _0x41bb3d=_0x25e37b(0x98);if(_0x593566[_0x25e37b(0xff)]===0x64&&_0x593566[_0x25e37b(0x10e)]===0x1)_0x41bb3d=_0x25e37b(0x10b);else{if(_0x593566[_0x25e37b(0x10e)]===0x0)_0x41bb3d=_0x25e37b(0x98);else _0x593566[_0x25e37b(0x10e)]===0x1&&_0x593566[_0x25e37b(0xff)]!==0x64?_0x41bb3d='FAILED':_0x41bb3d=_0x25e37b(0x98);}return{'status':_0x41bb3d,'final':_0x593566['final']===0x1,'amount':_0x593566['amount'],'currency':_0x593566['currency'],'date_success':_0x593566[_0x25e37b(0xb5)],'description':_0x593566[_0x25e37b(0x100)]};}catch(_0x49a787){console['error'](_0x4e0ce3+'\x20status\x20check\x20error:',_0x49a787),loggerService_1[_0x25e37b(0x197)][_0x25e37b(0xb0)](_0x4e0ce3[_0x25e37b(0xc6)](),_0x25e37b(0x18f),_0x49a787);throw new Error(_0x25e37b(0x11a)+_0x4e0ce3+_0x25e37b(0xb3)+(_0x49a787 instanceof Error?_0x49a787[_0x25e37b(0x1a8)]:_0x25e37b(0x182)));}}[a46_0x40205a(0x191)](_0x10747a,_0x1fe99b,_0x2c7c2f,_0x1ad4c8){const _0x50edb2=a46_0x40205a;console[_0x50edb2(0x13e)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20'+_0x1ad4c8+_0x50edb2(0x1a4)+_0x10747a+'\x20('+_0x2c7c2f+')'),this['clearStatusTimers'](_0x10747a);const _0xf9557d=[],_0x150043=0x5*0x3c*0x3e8,_0x2f7750=0x2*0x3c*0x3c*0x3e8,_0x53d548=Math[_0x50edb2(0x188)](_0x2f7750/_0x150043);console[_0x50edb2(0x13e)]('⏰\x20Will\x20check\x20status\x20'+_0x53d548+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x4128ef=0x1;_0x4128ef<=_0x53d548;_0x4128ef++){const _0x5d80c8=setTimeout(async()=>{const _0x49abb6=_0x50edb2;console[_0x49abb6(0x13e)](_0x49abb6(0xf8)+_0x1ad4c8+_0x49abb6(0xf4)+_0x4128ef+'/'+_0x53d548+_0x49abb6(0xf5)+_0x10747a);try{const _0x5cb2b8=await this['checkPaymentStatus'](_0x2c7c2f,_0x1fe99b,_0x1ad4c8);console['log']('📊\x20Status\x20check\x20#'+_0x4128ef+_0x49abb6(0x1a2),_0x5cb2b8),_0x5cb2b8[_0x49abb6(0x10e)]&&(console[_0x49abb6(0x13e)](_0x49abb6(0x9b)+_0x10747a+'\x20is\x20final\x20('+_0x5cb2b8['status']+_0x49abb6(0x140)),this['clearStatusTimers'](_0x10747a),await this['updatePaymentStatus'](_0x10747a,_0x5cb2b8[_0x49abb6(0xff)],_0x5cb2b8));}catch(_0x38651d){console[_0x49abb6(0x14b)](_0x49abb6(0x19b)+_0x4128ef+'\x20failed\x20for\x20payment\x20'+_0x10747a+':',_0x38651d);}},_0x4128ef*_0x150043);_0xf9557d[_0x50edb2(0xab)](_0x5d80c8);}this[_0x50edb2(0xd0)][_0x50edb2(0x118)](_0x10747a,_0xf9557d),console['log'](_0x50edb2(0x8e)+_0x53d548+_0x50edb2(0x139)+_0x10747a);}[a46_0x40205a(0x178)](_0x1629e9){const _0x2aedc1=a46_0x40205a,_0x39e473=this[_0x2aedc1(0xd0)][_0x2aedc1(0xae)](_0x1629e9);_0x39e473&&(console[_0x2aedc1(0x13e)](_0x2aedc1(0x144)+_0x39e473[_0x2aedc1(0xce)]+_0x2aedc1(0xbb)+_0x1629e9),_0x39e473[_0x2aedc1(0x1a0)]((_0x41c399,_0x297728)=>{clearTimeout(_0x41c399);}),this[_0x2aedc1(0xd0)][_0x2aedc1(0xe3)](_0x1629e9));}async['updatePaymentStatus'](_0x1151ab,_0x56f2fa,_0x334799){const _0x4c8527=a46_0x40205a;try{const _0x17697e=(await Promise[_0x4c8527(0x108)]()[_0x4c8527(0x16a)](()=>__importStar(require('../../config/database'))))[_0x4c8527(0x1a5)],_0x54f669={'status':_0x56f2fa[_0x4c8527(0xc7)](),'updatedAt':new Date(),'statusChangedBy':_0x4c8527(0xe6),'statusChangedAt':new Date()};_0x56f2fa==='PAID'&&(_0x54f669[_0x4c8527(0x14f)]=new Date()),_0x56f2fa===_0x4c8527(0x16e)&&_0x334799['description']&&(_0x54f669[_0x4c8527(0x151)]=_0x334799[_0x4c8527(0x17d)],console[_0x4c8527(0x13e)](_0x4c8527(0x84)+_0x334799['description'])),_0x334799[_0x4c8527(0x17d)]&&(_0x54f669[_0x4c8527(0x114)]=(_0x56f2fa===_0x4c8527(0x10b)?_0x4c8527(0x112):'VISA/MasterCard')+':\x20'+_0x334799[_0x4c8527(0x17d)]),await _0x17697e[_0x4c8527(0x115)][_0x4c8527(0x101)]({'where':{'id':_0x1151ab},'data':_0x54f669}),console[_0x4c8527(0x13e)](_0x4c8527(0x9b)+_0x1151ab+_0x4c8527(0x88)+_0x56f2fa),await this[_0x4c8527(0x183)](_0x1151ab,_0x56f2fa);}catch(_0x194e3d){console[_0x4c8527(0x14b)](_0x4c8527(0x19e)+_0x1151ab+':',_0x194e3d);}}async[a46_0x40205a(0x183)](_0x596738,_0x2ea0ee){const _0x399178=a46_0x40205a;try{const _0x86ef59=(await Promise['resolve']()[_0x399178(0x16a)](()=>__importStar(require('../../config/database'))))[_0x399178(0x1a5)],{telegramBotService:_0x2905ba}=await Promise['resolve']()[_0x399178(0x16a)](()=>__importStar(require(_0x399178(0xfc)))),_0x50552f=await _0x86ef59['payment']['findUnique']({'where':{'id':_0x596738},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x50552f)return;const _0x4c1d62={'PAID':'paid','FAILED':'failed'},_0x29010e=_0x4c1d62[_0x2ea0ee];_0x29010e&&await _0x2905ba[_0x399178(0x176)](_0x50552f[_0x399178(0xa9)],_0x50552f,_0x29010e),await this[_0x399178(0xa3)](_0x50552f,_0x2ea0ee);}catch(_0x44bdc4){console[_0x399178(0x14b)](_0x399178(0xe0),_0x44bdc4);}}async[a46_0x40205a(0xa3)](_0x2f5959,_0x15d64a){const _0x10f2b5=a46_0x40205a,_0x2479ad=Date[_0x10f2b5(0x16d)]();try{const _0x42f919=_0x2f5959[_0x10f2b5(0x93)],_0x56e100=_0x42f919[_0x10f2b5(0x1a9)];if(!_0x56e100?.[_0x10f2b5(0xd3)]){console[_0x10f2b5(0x13e)](_0x10f2b5(0x121)+_0x42f919['id']);return;}const _0x18134e=_0x15d64a===_0x10f2b5(0x10b)?'payment.success':'payment.failed';let _0x27123a=[];if(_0x56e100[_0x10f2b5(0x146)])try{_0x27123a=Array[_0x10f2b5(0xc0)](_0x56e100['webhookEvents'])?_0x56e100[_0x10f2b5(0x146)]:JSON[_0x10f2b5(0xa1)](_0x56e100[_0x10f2b5(0x146)]);}catch(_0x1cb7fb){console[_0x10f2b5(0x14b)]('Error\x20parsing\x20webhook\x20events:',_0x1cb7fb),_0x27123a=[];}if(!_0x27123a['includes'](_0x18134e)){console[_0x10f2b5(0x13e)]('Webhook\x20event\x20'+_0x18134e+_0x10f2b5(0xa0)+_0x42f919['id']);return;}const _0x4cbcb1={'event':_0x18134e,'payment':{'id':_0x2f5959['id'],'order_id':_0x2f5959[_0x10f2b5(0xb4)],'gateway_order_id':_0x2f5959[_0x10f2b5(0x97)],'gateway':_0x10f2b5(0x120),'amount':_0x2f5959[_0x10f2b5(0xa4)],'currency':_0x2f5959['currency'],'status':_0x15d64a[_0x10f2b5(0xc6)](),'customer_email':_0x2f5959[_0x10f2b5(0x9f)],'customer_name':_0x2f5959[_0x10f2b5(0xb1)],'created_at':_0x2f5959[_0x10f2b5(0x124)],'updated_at':new Date()}},_0x483812=await fetch(_0x56e100[_0x10f2b5(0xd3)],{'method':_0x10f2b5(0x193),'headers':{'Content-Type':_0x10f2b5(0xf9),'User-Agent':_0x10f2b5(0x19d)},'body':JSON[_0x10f2b5(0x195)](_0x4cbcb1)}),_0x5227c5=Date[_0x10f2b5(0x16d)]()-_0x2479ad;loggerService_1[_0x10f2b5(0x197)][_0x10f2b5(0x19c)](_0x2f5959[_0x10f2b5(0xa9)],_0x56e100[_0x10f2b5(0xd3)],_0x18134e,_0x483812[_0x10f2b5(0xff)],_0x5227c5,_0x4cbcb1),console[_0x10f2b5(0x13e)](_0x10f2b5(0x128)+_0x56e100[_0x10f2b5(0xd3)]+_0x10f2b5(0x199)+_0x483812[_0x10f2b5(0xff)]+'\x20('+_0x5227c5+_0x10f2b5(0x13f));}catch(_0x20e027){console[_0x10f2b5(0x14b)](_0x10f2b5(0x8c),_0x20e027),loggerService_1[_0x10f2b5(0x197)][_0x10f2b5(0x1b0)](_0x2f5959['shopId'],_0x2f5959['shop']?.[_0x10f2b5(0x1a9)]?.[_0x10f2b5(0xd3)]||_0x10f2b5(0xb7),_0x10f2b5(0x1ac),_0x20e027,{});}}['maskCardNumber'](_0x2529ab){const _0x5b76af=a46_0x40205a,_0x4ad922=_0x2529ab['replace'](/[\s-]/g,'');if(_0x4ad922[_0x5b76af(0xce)]<0x4)return'****';return'****\x20****\x20****\x20'+_0x4ad922[_0x5b76af(0xe8)](-0x4);}async[a46_0x40205a(0xa2)](_0x277f80,_0x1bf918='MASTERCARD'){const _0x3e2802=a46_0x40205a;console['log']('🔄\x20Processing\x20MasterCard\x20webhook\x20data:',JSON['stringify'](_0x277f80,null,0x2));let _0x5f52ff=_0x277f80,_0x56fdaa=_0x1bf918;_0x277f80['card_type']?(_0x56fdaa=_0x277f80[_0x3e2802(0x1a3)]['toUpperCase']()===_0x3e2802(0x134)?_0x3e2802(0x134):_0x3e2802(0x87),console[_0x3e2802(0x13e)](_0x3e2802(0x180)+_0x56fdaa)):console[_0x3e2802(0x13e)](_0x3e2802(0xf3)+_0x56fdaa);if(_0x277f80['info']&&_0x277f80[_0x3e2802(0xbe)]&&_0x277f80[_0x3e2802(0x1ad)]){console[_0x3e2802(0x13e)](_0x3e2802(0x94));try{const _0x495974=await this['decryptResponsePhp'](_0x277f80[_0x3e2802(0x126)],_0x277f80[_0x3e2802(0xbe)],_0x56fdaa);_0x5f52ff=JSON['parse'](_0x495974),console[_0x3e2802(0x13e)](_0x3e2802(0x17c)),console['log']('📝\x20Decrypted\x20webhook\x20data:',JSON['stringify'](_0x5f52ff,null,0x2));}catch(_0x496bea){console[_0x3e2802(0x14b)]('❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:',_0x496bea),console[_0x3e2802(0x13e)](_0x3e2802(0xf0)),_0x5f52ff=_0x277f80;}}else console[_0x3e2802(0x13e)](_0x3e2802(0xdd));let _0x505f0c=_0x3e2802(0x98);if(_0x5f52ff[_0x3e2802(0xff)]===0x64&&_0x5f52ff[_0x3e2802(0x10e)]===0x1)_0x505f0c=_0x3e2802(0x10b);else{if(_0x5f52ff[_0x3e2802(0x10e)]===0x0)_0x505f0c=_0x3e2802(0x98);else _0x5f52ff[_0x3e2802(0x10e)]===0x1&&_0x5f52ff[_0x3e2802(0xff)]!==0x64?_0x505f0c='FAILED':_0x505f0c='PENDING';}let _0x200ed9='';if(_0x5f52ff[_0x3e2802(0xfb)])_0x200ed9=_0x5f52ff[_0x3e2802(0xfb)]['toString'](),console['log'](_0x3e2802(0xb9)+_0x56fdaa+_0x3e2802(0x1a6)+_0x200ed9);else _0x5f52ff[_0x3e2802(0xd2)]?(_0x200ed9=_0x5f52ff[_0x3e2802(0xd2)][_0x3e2802(0xaa)](),console['log'](_0x3e2802(0xb9)+_0x56fdaa+'\x20payment_id\x20for\x20search:\x20'+_0x200ed9)):(_0x200ed9=_0x5f52ff['orderId']||_0x5f52ff['paymentId']||_0x5f52ff['id']||'',console[_0x3e2802(0x13e)](_0x3e2802(0x11c)+_0x200ed9));console[_0x3e2802(0x13e)](_0x3e2802(0x119)+_0x56fdaa+'\x20webhook\x20extracted\x20data:'),console[_0x3e2802(0x13e)](_0x3e2802(0xca)+_0x200ed9+_0x3e2802(0xdf)+_0x5f52ff[_0x3e2802(0xfb)]+_0x3e2802(0xa6)+_0x5f52ff[_0x3e2802(0xb4)]+_0x3e2802(0x149)+_0x5f52ff[_0x3e2802(0xd2)]+',\x20paymentId='+_0x5f52ff[_0x3e2802(0x15b)]+',\x20id='+_0x5f52ff['id']+')'),console[_0x3e2802(0x13e)](_0x3e2802(0x16c)+_0x505f0c+_0x3e2802(0x18b)+_0x5f52ff[_0x3e2802(0xff)]+_0x3e2802(0x161)+_0x5f52ff[_0x3e2802(0x10e)]+')'),console[_0x3e2802(0x13e)](_0x3e2802(0x130)+_0x5f52ff[_0x3e2802(0xa4)]),console['log']('\x20\x20\x20Currency:\x20'+_0x5f52ff[_0x3e2802(0x15e)]);let _0x392cac;_0x505f0c==='FAILED'&&_0x5f52ff['desc']&&(_0x392cac=_0x5f52ff[_0x3e2802(0x100)],console[_0x3e2802(0x13e)](_0x3e2802(0x1a1)+_0x392cac));const _0x42a1a0={'paymentId':_0x200ed9,'status':_0x505f0c,'amount':_0x5f52ff[_0x3e2802(0xa4)],'currency':_0x5f52ff[_0x3e2802(0x15e)]};return _0x392cac&&(_0x42a1a0['failureMessage']=_0x392cac),_0x42a1a0;}[a46_0x40205a(0xaf)](){const _0x199cdb=a46_0x40205a;console['log'](_0x199cdb(0x12c));const _0x4444fe=this['statusCheckTimers'][_0x199cdb(0x9e)];for(const [_0x1272f3]of this[_0x199cdb(0xd0)]){this[_0x199cdb(0x178)](_0x1272f3);}console['log'](_0x199cdb(0x150)+_0x4444fe+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a46_0x40205a(0xe7)]=VisaMasterCardService;