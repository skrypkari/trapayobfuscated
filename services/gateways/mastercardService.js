'use strict';const a57_0x4349fa=a57_0x4e68;(function(_0x58969d,_0x135bac){const _0x469aa9=a57_0x4e68,_0x5c6fc4=_0x58969d();while(!![]){try{const _0x8cf57b=-parseInt(_0x469aa9(0x2cf))/0x1+-parseInt(_0x469aa9(0x2db))/0x2*(-parseInt(_0x469aa9(0x25c))/0x3)+parseInt(_0x469aa9(0x335))/0x4*(parseInt(_0x469aa9(0x2ca))/0x5)+-parseInt(_0x469aa9(0x1f1))/0x6*(-parseInt(_0x469aa9(0x2f0))/0x7)+-parseInt(_0x469aa9(0x32e))/0x8*(-parseInt(_0x469aa9(0x2d7))/0x9)+-parseInt(_0x469aa9(0x2ba))/0xa+parseInt(_0x469aa9(0x282))/0xb*(-parseInt(_0x469aa9(0x224))/0xc);if(_0x8cf57b===_0x135bac)break;else _0x5c6fc4['push'](_0x5c6fc4['shift']());}catch(_0x534905){_0x5c6fc4['push'](_0x5c6fc4['shift']());}}}(a57_0x19d3,0x2e40b));var __createBinding=this&&this['__createBinding']||(Object[a57_0x4349fa(0x2d9)]?function(_0x5a83e2,_0x2cba66,_0x8c7434,_0xcba5e0){const _0x2522a9=a57_0x4349fa;if(_0xcba5e0===undefined)_0xcba5e0=_0x8c7434;var _0x22f580=Object[_0x2522a9(0x2b7)](_0x2cba66,_0x8c7434);(!_0x22f580||(_0x2522a9(0x324)in _0x22f580?!_0x2cba66['__esModule']:_0x22f580['writable']||_0x22f580[_0x2522a9(0x34a)]))&&(_0x22f580={'enumerable':!![],'get':function(){return _0x2cba66[_0x8c7434];}}),Object[_0x2522a9(0x30b)](_0x5a83e2,_0xcba5e0,_0x22f580);}:function(_0x520375,_0x3b7a4b,_0xb5ec,_0x37f000){if(_0x37f000===undefined)_0x37f000=_0xb5ec;_0x520375[_0x37f000]=_0x3b7a4b[_0xb5ec];}),__setModuleDefault=this&&this[a57_0x4349fa(0x2e5)]||(Object[a57_0x4349fa(0x2d9)]?function(_0x78385f,_0x474583){Object['defineProperty'](_0x78385f,'default',{'enumerable':!![],'value':_0x474583});}:function(_0x398f9d,_0x5a8e39){const _0x56ec9a=a57_0x4349fa;_0x398f9d[_0x56ec9a(0x342)]=_0x5a8e39;}),__importStar=this&&this[a57_0x4349fa(0x2d2)]||(function(){var _0x297042=function(_0x22452f){const _0x4361b2=a57_0x4e68;return _0x297042=Object[_0x4361b2(0x297)]||function(_0x1a7060){const _0x3ba518=_0x4361b2;var _0x47190e=[];for(var _0x1b27ad in _0x1a7060)if(Object[_0x3ba518(0x1fd)][_0x3ba518(0x215)][_0x3ba518(0x2a7)](_0x1a7060,_0x1b27ad))_0x47190e[_0x47190e[_0x3ba518(0x22c)]]=_0x1b27ad;return _0x47190e;},_0x297042(_0x22452f);};return function(_0x54a7c3){const _0x56230e=a57_0x4e68;if(_0x54a7c3&&_0x54a7c3['__esModule'])return _0x54a7c3;var _0x45e907={};if(_0x54a7c3!=null){for(var _0x382aec=_0x297042(_0x54a7c3),_0x58ea27=0x0;_0x58ea27<_0x382aec[_0x56230e(0x22c)];_0x58ea27++)if(_0x382aec[_0x58ea27]!==_0x56230e(0x342))__createBinding(_0x45e907,_0x54a7c3,_0x382aec[_0x58ea27]);}return __setModuleDefault(_0x45e907,_0x54a7c3),_0x45e907;};}()),__importDefault=this&&this[a57_0x4349fa(0x1f9)]||function(_0xcf4cd7){return _0xcf4cd7&&_0xcf4cd7['__esModule']?_0xcf4cd7:{'default':_0xcf4cd7};};function a57_0x4e68(_0x179034,_0x249fd7){_0x179034=_0x179034-0x1ef;const _0x19d36c=a57_0x19d3();let _0x4e68e3=_0x19d36c[_0x179034];return _0x4e68e3;}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a57_0x4349fa(0x284)]=void 0x0;function a57_0x19d3(){const _0x2c8461=['decryptAES','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','isFinalStatus','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','call','visaApiUrl','https://api.paydmeth.com/api','Status\x20','3DS\x20verification\x20required','isArray','Cash\x20payment\x20is\x20expected\x20at\x20TCO','üí≥\x20Detected\x20MasterCard\x20(starts\x20with\x205)','failed','VISA','randomBytes','üîê\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','\x20order_id\x20for\x20search:\x20','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','===\x20PARSED\x20API\x20RESPONSE\x20===','-----BEGIN','getOwnPropertyDescriptor','now','end','2275900LIwfOC','Cancellation\x20is\x20not\x20possible','createSign','üìù\x20Encrypted\x20key\x20length:','text','üõë\x20Stopped\x20','createdAt','desc','info','\x20failed\x20for\x20payment\x20','‚ùå\x20PHP\x20decryptor\x20request\x20failed:','‚è∞\x20Scheduling\x20status\x20checks\x20for\x20','Amount:','stringify','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','‚ö†Ô∏è\x20Expected\x20VISA\x20private\x20key:\x20','5bHOOhQ','system','includes','base64','error','36051dnZjmq','\x20result:','‚ùå\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','__importStar','Unknown\x20error','https://api2.trapay.uk/decrypt.php','substring','masterCardApiUrl','1412685YenVdV','****\x20****\x20****\x20','create','logWhiteDomainResponse','4nXguUw','üîê\x20AES\x20key\x20and\x20IV\x20generated','then','publicEncrypt','description','PENDING','üìù\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','üîê\x20Using\x20keys:\x20','shop','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','__setModuleDefault','currency','settings','paidAt','existsSync','üìù\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','üí≥\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','Test\x20payment','log','No\x20New\x20payment','\x20status\x20check\x20error:','1848YwDlFK','\x20MasterCard\x20status\x20check\x20timers','last_name','\x20is\x20final\x20(','===\x20API\x20RESPONSE\x20===','visa_public.pem','üìä\x20','‚ùå\x20Detailed\x20failure\x20description:\x20','\x20(from:\x20order_id=','sendPaymentNotifications','visa_private.pem','POST','üìù\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','\x20payment\x20status:\x20','status','üîç\x20Using\x20fallback\x20fields\x20for\x20search:\x20','Payment\x20pending\x20verification','üîÑ\x20Converted\x20postcode\x20to\x20post_code:\x20','Payment\x20returned','Response\x20Headers:','‚ùå\x20RSA\x20encryption\x20failed:','headers','\x20with\x20status\x20','final','Payment\x20System/1.0','Failed\x20payment','decryptResponsePhp','defineProperty','\x20\x20Original:\x20\x22','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','Failed\x20to\x20send\x20payment\x20notifications:','/status','Payment\x20cancellation\x20is\x20being\x20processed','floor','json','stopAllStatusChecks','\x20\x20\x20-\x20info\x20length:','Method\x20not\x20allowed','encryptAES','getCardTypeAndApi','****','delete','‚ùå\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','‚ùå\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','‚ùå\x20VISA/MasterCard\x20key\x20validation\x20failed:','üîê\x20MasterCard\x20Public\x20key\x20path:','1111','sendShopWebhook','‚úÖ\x20MasterCard\x20key\x20files\x20validated\x20successfully','date_success','üîç\x20','signRSA','get','\x20status\x20checks\x20for\x20payment\x20','from','üìù\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','maskCardNumber','FAILED','path','Insufficient\x20funds\x20on\x20the\x20card','‚úÖ\x20Payment\x20','üí≥\x20VISA/MasterCard\x20service\x20initialized','8pPaIsc','processWebhook','üìù\x20Decrypted\x20webhook\x20data:','/charge','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','Expected\x20bitcoin\x20transfer\x20from\x20client','expire_year','64408EmabDX','Sender\x27s\x20card\x20details\x20are\x20required','shopId','\x20status\x20updated\x20to\x20','/status_decrypted','Decryption\x20failed:\x20','toLowerCase','Sender\x20information\x20required','loggerService','statusText','\x20\x20\x20Currency:\x20','charge','LookUp\x20number\x20of\x20attempts\x20exceeded','default','Payment\x20prohibited','üíæ\x20Payment\x20data\x20prepared','-----END','HTTP\x20Status:','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','Status\x20Text:','üîê\x20MasterCard\x20API\x20URL:','configurable','üíæ\x20Saving\x20failure\x20message:\x20','errorMessage','üì¶\x20FULL\x20REQUEST\x20JSON:','constants','\x20API:\x20','/charge_raw','‚ùå\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','2166QxhTTt','HTTP\x20error!\x20status:\x20','privateKeyPath','post_code','cvv','amount','cardType','Failed\x20to\x20send\x20MasterCard\x20webhook:','__importDefault','toUpperCase','forEach','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','prototype','‚úÖ\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','‚ùå\x20RSA\x20signing\x20failed:','\x20\x20\x20-\x20key\x20length:',',\x20orderId=','\x20\x20\x20Amount:\x20','message','parse','PHP\x20decryptor\x20error','warn','MASTERCARD','number','failureMessage','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','first_name','\x20payment_id\x20for\x20search:\x20','üßπ\x20Clearing\x20','Order\x20ID:','trim','3DS\x20URL:','paymentId','clearStatusTimers','‚úÖ\x20Payment\x20successful','paymentStatuses','hasOwnProperty','MasterCard\x20webhook\x20sent\x20to\x20','webhookUrl','üîê\x20Data\x20encrypted\x20with\x20AES','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','Response\x20Time:','üîê\x20Data\x20signed\x20with\x20RSA','orderId','HTTP\x20','üîê\x20MasterCard\x20Public\x20key\x20length:\x20','‚è∞\x20Will\x20check\x20status\x20','logWhiteDomainRequest','join','Status:','sign','1092XFoLYG','üì¶\x20FULL\x20RESPONSE\x20BODY:','toString','customerEmail','order_id','üîç\x20Detected\x20card\x20type\x20from\x20webhook:\x20','LookUp\x20not\x20confirmed','Unsuccessful\x20payment','length','‚ùå\x20Status\x20check\x20#','Failed\x20to\x20check\x20','\x20\x20\x20-\x20sign\x20length:','üìç\x20Full\x20card\x20holder\x20data:','processCardPayment','\x22\x20|\x20\x22','RSA_PKCS1_PADDING','üîê\x20Response\x20is\x20encrypted,\x20decrypting...','statusCheckTimers','üîç\x20Using\x20','key','üîê\x20RSA\x20signing\x20successful','/status_raw','paid','cwd','getDetailedErrorMessage','publicKeyPath','readFileSync','utf8','postcode','‚úÖ\x20Scheduled\x20','../../config/database','‚ùå\x20Failed\x20to\x20decrypt\x20status\x20response:','apiUrl','Invalid\x20expiration\x20date','payment.success','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','PAID',',\x20payment_id=','\x20characters','\x20payment:\x20','visaPublicKeyPath','update','generateAESKey','resolve','updatePaymentStatus','createDecipheriv','logWhiteDomainError','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','aes-256-ctr','üìù\x20Signature\x20length:','üîê\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','...','Recipient\x20data\x20required','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','Result\x20URL:','üìù\x20Data\x20to\x20sign\x20length:','427368FWczQw','üîê\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','‚úÖ\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','üõë\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','Awaiting\x20confirmation\x20by\x20ivr\x20call','üìù\x20Encrypted\x20data\x20length:','‚ö†Ô∏è\x20Expected\x20VISA\x20public\x20key:\x20','\x20status\x20check\x20#','\x20not\x20enabled\x20for\x20shop\x20','createCipheriv','size','checkPaymentStatus','expire_month','\x20\x20\x20-\x20merchant_point_id:','üìù\x20Final\x20request\x20structure:','Payment\x20is\x20being\x20processed','üìù\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','scheduleStatusChecks','visaMerchantPointId','visa/mastercard','\x20status\x20timers\x20for\x20payment\x20','decryptResponse','üìä\x20Checking\x20','Number\x20of\x20attempts\x20exceeded','\x20webhook\x20extracted\x20data:','/status_decrypt','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','Return\x20URL:','keys','üîÑ\x20Processing\x20MasterCard\x20webhook\x20data:','visaPrivateKeyPath',',\x20Desc:\x20','‚ö†Ô∏è\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','),\x20stopping\x20status\x20checks','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','Final:','Transaction\x20limit\x20exceeded','12111VrrOlv','validateKeyFiles','VisaMasterCardService',',\x20id=','payment_id','üîê\x20VISA\x20Public\x20key\x20length:\x20','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','üí≥\x20Unknown\x20card\x20type\x20(starts\x20with\x20','encryptRSA','3ds_url','webhookEvents','masterCardMerchantPointId','üìù\x20Data\x20length:','üìä\x20Status\x20check\x20result:','Payment\x20ID:','application/json','üîê\x20VISA\x20Public\x20key\x20path:','LookUp\x20code\x20sent',',\x20Final:\x20','payment','\x20\x20Cleaned:\x20\x20\x22','getOwnPropertyNames','private.pem','Payment\x20System/1.0\x20(MasterCard)',',\x20body:\x20','PIN\x20code\x20confirmation\x20awaited','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','replace','\x20\x20\x20','merchantPointId','üéØ\x20Using\x20','Payment\x20confirmation\x20time\x20has\x20expired','Payment\x20confirmation\x20required'];a57_0x19d3=function(){return _0x2c8461;};return a57_0x19d3();}const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a57_0x4349fa(0x32a))),loggerService_1=require('../loggerService');class VisaMasterCardService{constructor(){const _0x68d06f=a57_0x4349fa;this[_0x68d06f(0x235)]=new Map(),this[_0x68d06f(0x214)]={0x0:{'final':![],'description':_0x68d06f(0x2ee)},0x1:{'final':![],'description':'No\x20Error\x20executing\x20request'},0x2:{'final':!![],'description':'Request\x20data\x20error'},0x3:{'final':!![],'description':'Another\x20unknown\x20error'},0x4:{'final':!![],'description':_0x68d06f(0x22b)},0x5:{'final':!![],'description':_0x68d06f(0x347)},0x6:{'final':!![],'description':_0x68d06f(0x302)},0x7:{'final':!![],'description':_0x68d06f(0x2ec)},0x8:{'final':![],'description':'Client\x20OTP\x20confirmation\x20required'},0x9:{'final':![],'description':_0x68d06f(0x2ab)},0xa:{'final':![],'description':'Sender\x27s\x20CVV\x20card\x20is\x20required'},0xb:{'final':![],'description':_0x68d06f(0x33c)},0xc:{'final':![],'description':_0x68d06f(0x258)},0xd:{'final':![],'description':_0x68d06f(0x288)},0xe:{'final':![],'description':_0x68d06f(0x260)},0xf:{'final':![],'description':_0x68d06f(0x29b)},0x10:{'final':![],'description':'Captcha\x20confirmation\x20awaited'},0x11:{'final':![],'description':_0x68d06f(0x1fc)},0x12:{'final':![],'description':'Awaiting\x20confirmation\x20in\x20the\x20application'},0x13:{'final':![],'description':_0x68d06f(0x26b)},0x14:{'final':![],'description':'The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender'},0x15:{'final':![],'description':_0x68d06f(0x333)},0x16:{'final':![],'description':_0x68d06f(0x300)},0x18:{'final':![],'description':'The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'},0x19:{'final':![],'description':_0x68d06f(0x29c)},0x1a:{'final':!![],'description':_0x68d06f(0x2ad)},0x1b:{'final':![],'description':'Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code'},0x1c:{'final':![],'description':'Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application'},0x1d:{'final':![],'description':_0x68d06f(0x247)},0x1f:{'final':![],'description':_0x68d06f(0x253)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':_0x68d06f(0x336)},0x24:{'final':!![],'description':_0x68d06f(0x2a1)},0x25:{'final':!![],'description':_0x68d06f(0x343)},0x26:{'final':!![],'description':'The\x20payment\x20status\x20must\x20be\x20clarified\x20manually'},0x27:{'final':!![],'description':_0x68d06f(0x32b)},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':'The\x20card\x20is\x20lost\x20or\x20stolen'},0x2a:{'final':!![],'description':_0x68d06f(0x245)},0x2b:{'final':!![],'description':_0x68d06f(0x281)},0x2c:{'final':!![],'description':_0x68d06f(0x2c8)},0x2d:{'final':!![],'description':_0x68d06f(0x309)},0x2e:{'final':!![],'description':_0x68d06f(0x22b)},0x2f:{'final':!![],'description':_0x68d06f(0x22b)},0x30:{'final':!![],'description':'Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled'},0x31:{'final':![],'description':_0x68d06f(0x2a2)},0x32:{'final':!![],'description':_0x68d06f(0x315)},0x33:{'final':!![],'description':_0x68d06f(0x309)},0x34:{'final':!![],'description':_0x68d06f(0x309)},0x35:{'final':!![],'description':_0x68d06f(0x309)},0x36:{'final':!![],'description':_0x68d06f(0x309)},0x37:{'final':!![],'description':_0x68d06f(0x309)},0x38:{'final':!![],'description':_0x68d06f(0x2bb)},0x39:{'final':![],'description':_0x68d06f(0x332)},0x3a:{'final':![],'description':_0x68d06f(0x293)},0x3b:{'final':!![],'description':'LookUp\x20code\x20verified'},0x3c:{'final':!![],'description':_0x68d06f(0x274)},0x3d:{'final':!![],'description':_0x68d06f(0x27f)},0x3e:{'final':!![],'description':'Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID'},0x3f:{'final':!![],'description':'Payment\x20returned'},0x40:{'final':![],'description':_0x68d06f(0x22a)},0x41:{'final':!![],'description':_0x68d06f(0x341)},0x42:{'final':![],'description':_0x68d06f(0x310)},0x43:{'final':!![],'description':'Technical\x20limit,\x20contact\x20your\x20personal\x20manager'},0x44:{'final':![],'description':_0x68d06f(0x2ab)},0x45:{'final':!![],'description':_0x68d06f(0x309)},0x46:{'final':!![],'description':_0x68d06f(0x309)},0x47:{'final':!![],'description':_0x68d06f(0x259)},0x64:{'final':!![],'description':'Operation\x20completed\x20successfully'}},this[_0x68d06f(0x2d6)]='https://api.myatranz.com/api',this[_0x68d06f(0x28d)]=0x50ca,this['privateKeyPath']=path_1[_0x68d06f(0x342)][_0x68d06f(0x221)](process['cwd'](),_0x68d06f(0x279),_0x68d06f(0x298)),this[_0x68d06f(0x23d)]=path_1['default'][_0x68d06f(0x221)](process[_0x68d06f(0x23b)](),_0x68d06f(0x279),'psp_public.pem'),this[_0x68d06f(0x2a8)]=_0x68d06f(0x2a9),this[_0x68d06f(0x26f)]=0x6b7,this[_0x68d06f(0x27b)]=path_1[_0x68d06f(0x342)][_0x68d06f(0x221)](process[_0x68d06f(0x23b)](),_0x68d06f(0x279),_0x68d06f(0x2fa)),this[_0x68d06f(0x24c)]=path_1[_0x68d06f(0x342)][_0x68d06f(0x221)](process[_0x68d06f(0x23b)](),_0x68d06f(0x279),_0x68d06f(0x2f5)),console[_0x68d06f(0x2ed)](_0x68d06f(0x32d)),console[_0x68d06f(0x2ed)](_0x68d06f(0x349),this[_0x68d06f(0x2d6)]),console[_0x68d06f(0x2ed)]('üîê\x20VISA\x20API\x20URL:',this['visaApiUrl']),console['log']('üîê\x20MasterCard\x20Private\x20key\x20path:',this[_0x68d06f(0x1f3)]),console['log'](_0x68d06f(0x31d),this[_0x68d06f(0x23d)]),console['log']('üîê\x20VISA\x20Private\x20key\x20path:',this[_0x68d06f(0x27b)]),console[_0x68d06f(0x2ed)](_0x68d06f(0x292),this['visaPublicKeyPath']),this[_0x68d06f(0x283)]();}[a57_0x4349fa(0x23c)](_0x2b3dff,_0x118b3b){const _0x3ae4dd=a57_0x4349fa,_0x307426=this[_0x3ae4dd(0x214)][_0x2b3dff];let _0x52769d='';_0x307426?_0x52769d='Status\x20'+_0x2b3dff+':\x20'+_0x307426[_0x3ae4dd(0x2df)]:_0x52769d=_0x3ae4dd(0x2aa)+_0x2b3dff+':\x20Unknown\x20status\x20code';if(_0x118b3b&&_0x118b3b[_0x3ae4dd(0x20f)]()){const _0x52af30=_0x118b3b[_0x3ae4dd(0x20f)]();(!_0x307426||_0x52af30[_0x3ae4dd(0x33b)]()!==_0x307426[_0x3ae4dd(0x2df)][_0x3ae4dd(0x33b)]())&&(_0x52769d+='\x20|\x20Response:\x20'+_0x52af30);}return _0x52769d;}[a57_0x4349fa(0x2a5)](_0x3285eb){const _0x55ea5e=a57_0x4349fa,_0x89e2d8=this['paymentStatuses'][_0x3285eb];return _0x89e2d8?_0x89e2d8[_0x55ea5e(0x307)]:!![];}[a57_0x4349fa(0x317)](_0x1414f5){const _0x908c23=a57_0x4349fa,_0x510c81=_0x1414f5['charAt'](0x0);if(_0x510c81==='4')return console['log'](_0x908c23(0x2eb)),{'cardType':_0x908c23(0x2b0),'apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x908c23(0x27b)],'publicKeyPath':this[_0x908c23(0x24c)],'merchantPointId':this[_0x908c23(0x26f)]};else return _0x510c81==='5'?(console[_0x908c23(0x2ed)](_0x908c23(0x2ae)),{'cardType':_0x908c23(0x207),'apiUrl':this[_0x908c23(0x2d6)],'privateKeyPath':this[_0x908c23(0x1f3)],'publicKeyPath':this[_0x908c23(0x23d)],'merchantPointId':this[_0x908c23(0x28d)]}):(console[_0x908c23(0x2ed)](_0x908c23(0x289)+_0x510c81+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':_0x908c23(0x207),'apiUrl':this[_0x908c23(0x2d6)],'privateKeyPath':this[_0x908c23(0x1f3)],'publicKeyPath':this[_0x908c23(0x23d)],'merchantPointId':this[_0x908c23(0x28d)]});}[a57_0x4349fa(0x283)](){const _0x3798cd=a57_0x4349fa;try{if(!fs_1[_0x3798cd(0x342)][_0x3798cd(0x2e9)](this[_0x3798cd(0x1f3)]))throw new Error(_0x3798cd(0x26d)+this[_0x3798cd(0x1f3)]);if(!fs_1['default']['existsSync'](this['publicKeyPath']))throw new Error(_0x3798cd(0x30d)+this['publicKeyPath']);const _0x584f37=fs_1[_0x3798cd(0x342)][_0x3798cd(0x23e)](this['privateKeyPath'],_0x3798cd(0x23f))[_0x3798cd(0x20f)](),_0x47e5d4=fs_1['default'][_0x3798cd(0x23e)](this[_0x3798cd(0x23d)],_0x3798cd(0x23f))[_0x3798cd(0x20f)]();if(!_0x584f37[_0x3798cd(0x2cc)](_0x3798cd(0x2b6))||!_0x584f37['includes'](_0x3798cd(0x345)))throw new Error(_0x3798cd(0x20a));if(!_0x47e5d4[_0x3798cd(0x2cc)](_0x3798cd(0x2b6))||!_0x47e5d4['includes'](_0x3798cd(0x345)))throw new Error(_0x3798cd(0x2e4));console['log'](_0x3798cd(0x320)),console[_0x3798cd(0x2ed)]('üîê\x20MasterCard\x20Private\x20key\x20length:\x20'+_0x584f37[_0x3798cd(0x22c)]+'\x20characters'),console[_0x3798cd(0x2ed)](_0x3798cd(0x21e)+_0x47e5d4[_0x3798cd(0x22c)]+_0x3798cd(0x24a));if(fs_1['default'][_0x3798cd(0x2e9)](this[_0x3798cd(0x27b)])&&fs_1[_0x3798cd(0x342)][_0x3798cd(0x2e9)](this[_0x3798cd(0x24c)])){const _0x570fde=fs_1[_0x3798cd(0x342)][_0x3798cd(0x23e)](this['visaPrivateKeyPath'],_0x3798cd(0x23f))[_0x3798cd(0x20f)](),_0x339465=fs_1[_0x3798cd(0x342)][_0x3798cd(0x23e)](this[_0x3798cd(0x24c)],'utf8')[_0x3798cd(0x20f)]();(!_0x570fde[_0x3798cd(0x2cc)](_0x3798cd(0x2b6))||!_0x570fde[_0x3798cd(0x2cc)]('-----END'))&&console[_0x3798cd(0x206)]('‚ö†Ô∏è\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),(!_0x339465[_0x3798cd(0x2cc)](_0x3798cd(0x2b6))||!_0x339465[_0x3798cd(0x2cc)](_0x3798cd(0x345)))&&console['warn']('‚ö†Ô∏è\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),console[_0x3798cd(0x2ed)]('‚úÖ\x20VISA\x20key\x20files\x20validated\x20successfully'),console['log']('üîê\x20VISA\x20Private\x20key\x20length:\x20'+_0x570fde[_0x3798cd(0x22c)]+_0x3798cd(0x24a)),console['log'](_0x3798cd(0x287)+_0x339465[_0x3798cd(0x22c)]+_0x3798cd(0x24a));}else console[_0x3798cd(0x206)]('‚ö†Ô∏è\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available'),console[_0x3798cd(0x206)](_0x3798cd(0x2c9)+this[_0x3798cd(0x27b)]),console[_0x3798cd(0x206)](_0x3798cd(0x262)+this[_0x3798cd(0x24c)]);}catch(_0x382be5){console[_0x3798cd(0x2ce)](_0x3798cd(0x31c),_0x382be5);throw _0x382be5;}}[a57_0x4349fa(0x24e)](){const _0x4ca41c=a57_0x4349fa,_0x5a4095=crypto_1[_0x4ca41c(0x342)]['randomBytes'](0x20),_0x2b5fff=crypto_1[_0x4ca41c(0x342)][_0x4ca41c(0x2b1)](0x10);return{'key':_0x5a4095,'iv':_0x2b5fff};}[a57_0x4349fa(0x316)](_0x146309,_0x46b1d4,_0x3d9e5f){const _0x42797a=a57_0x4349fa,_0x184792=crypto_1[_0x42797a(0x342)][_0x42797a(0x265)](_0x42797a(0x254),_0x46b1d4,_0x3d9e5f);let _0x361e42=_0x184792[_0x42797a(0x24d)](_0x146309,_0x42797a(0x23f),_0x42797a(0x2cd));return _0x361e42+=_0x184792[_0x42797a(0x307)](_0x42797a(0x2cd)),_0x361e42;}[a57_0x4349fa(0x28a)](_0xeb083,_0x44cf98,_0x51c3b4){const _0x3a1e87=a57_0x4349fa;try{const _0x235359=fs_1[_0x3a1e87(0x342)][_0x3a1e87(0x23e)](_0x51c3b4,_0x3a1e87(0x23f))[_0x3a1e87(0x20f)](),_0x5a3477={'iv':_0x44cf98[_0x3a1e87(0x226)](_0x3a1e87(0x2cd)),'key':_0xeb083[_0x3a1e87(0x226)](_0x3a1e87(0x2cd))},_0x4137d2=JSON[_0x3a1e87(0x2c7)](_0x5a3477);console[_0x3a1e87(0x2ed)](_0x3a1e87(0x2b2),_0x4137d2[_0x3a1e87(0x22c)]);const _0x5328da=crypto_1[_0x3a1e87(0x342)][_0x3a1e87(0x2de)]({'key':_0x235359,'padding':crypto_1[_0x3a1e87(0x342)][_0x3a1e87(0x34e)][_0x3a1e87(0x233)]},Buffer[_0x3a1e87(0x326)](_0x4137d2));return console['log']('‚úÖ\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x5328da[_0x3a1e87(0x22c)]),_0x5328da['toString'](_0x3a1e87(0x2cd));}catch(_0x4af479){console[_0x3a1e87(0x2ce)](_0x3a1e87(0x304),_0x4af479);throw new Error(_0x3a1e87(0x2a6));}}['signRSA'](_0x20512f,_0x1cb920){const _0x43db8c=a57_0x4349fa;try{const _0x2229e9=fs_1['default']['readFileSync'](_0x1cb920,'utf8')[_0x43db8c(0x20f)](),_0x98d4b=crypto_1['default'][_0x43db8c(0x2bc)]('SHA256');_0x98d4b[_0x43db8c(0x24d)](_0x20512f),_0x98d4b[_0x43db8c(0x2b9)]();const _0x1f3799=_0x98d4b[_0x43db8c(0x223)](_0x2229e9,'base64');return console['log'](_0x43db8c(0x238)),console[_0x43db8c(0x2ed)](_0x43db8c(0x25b),_0x20512f[_0x43db8c(0x22c)]),console['log'](_0x43db8c(0x255),_0x1f3799[_0x43db8c(0x22c)]),_0x1f3799;}catch(_0x51dc01){console[_0x43db8c(0x2ce)](_0x43db8c(0x1ff),_0x51dc01),console[_0x43db8c(0x2ce)]('‚ùå\x20Data\x20being\x20signed:',_0x20512f[_0x43db8c(0x2d5)](0x0,0xc8)+_0x43db8c(0x257));throw new Error(_0x43db8c(0x219));}}[a57_0x4349fa(0x2a3)](_0x48da74,_0x5b3201,_0x2c6436){const _0xc3efed=a57_0x4349fa,_0x3c2b14=crypto_1[_0xc3efed(0x342)][_0xc3efed(0x251)]('aes-256-ctr',_0x5b3201,_0x2c6436);let _0x487f0e=_0x3c2b14[_0xc3efed(0x24d)](_0x48da74,_0xc3efed(0x2cd),_0xc3efed(0x23f));return _0x487f0e+=_0x3c2b14['final'](_0xc3efed(0x23f)),_0x487f0e;}async[a57_0x4349fa(0x30a)](_0x2bad91,_0x25f831,_0x1ce121=a57_0x4349fa(0x207)){const _0x50063b=a57_0x4349fa;try{const _0x6e8e99=await fetch(_0x50063b(0x2d4),{'method':_0x50063b(0x2fb),'headers':{'Content-Type':'application/json'},'body':JSON[_0x50063b(0x2c7)]({'info':_0x2bad91,'key':_0x25f831,'card_type':_0x1ce121[_0x50063b(0x33b)]()})});if(!_0x6e8e99['ok'])throw new Error(_0x50063b(0x205));return await _0x6e8e99[_0x50063b(0x2be)]();}catch(_0x325a41){console[_0x50063b(0x2ce)](_0x50063b(0x2c4),_0x325a41);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a57_0x4349fa(0x272)](_0x12f42a,_0x36c746){const _0x4ee491=a57_0x4349fa;try{const _0x40c883=fs_1['default'][_0x4ee491(0x23e)](this[_0x4ee491(0x1f3)],'utf8')[_0x4ee491(0x20f)](),_0x5a25c5=crypto_1[_0x4ee491(0x342)]['privateDecrypt'](_0x40c883,Buffer[_0x4ee491(0x326)](_0x36c746,'base64')),_0x56fd3f=JSON[_0x4ee491(0x204)](_0x5a25c5[_0x4ee491(0x226)]()),_0x4d164c=Buffer[_0x4ee491(0x326)](_0x56fd3f['key'],_0x4ee491(0x2cd)),_0x47481e=Buffer['from'](_0x56fd3f['iv'],_0x4ee491(0x2cd));return this[_0x4ee491(0x2a3)](_0x12f42a,_0x4d164c,_0x47481e);}catch(_0x3af922){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a57_0x4349fa(0x231)](_0x1f4eff){const _0x17ee25=a57_0x4349fa,{paymentId:_0x3dcf89,orderId:_0x2a6956,amount:_0x4fa702,currency:_0x48342e,cardData:_0x454a0f,resultUrl:_0x4ef047,returnUrl:_0x29a9de,cardHolder:_0x41c622,browser:_0x37db81}=_0x1f4eff;console[_0x17ee25(0x2ed)](_0x17ee25(0x2b4)),console[_0x17ee25(0x2ed)](_0x17ee25(0x290),_0x3dcf89),console[_0x17ee25(0x2ed)](_0x17ee25(0x20e),_0x2a6956),console[_0x17ee25(0x2ed)](_0x17ee25(0x2c6),_0x4fa702,_0x48342e),console[_0x17ee25(0x2ed)]('Card\x20Number:',this[_0x17ee25(0x328)](_0x454a0f['number'])),console[_0x17ee25(0x2ed)]('Card\x20Holder:',_0x41c622[_0x17ee25(0x20b)]+'\x20'+_0x41c622[_0x17ee25(0x2f2)]),console['log'](_0x17ee25(0x278),_0x29a9de),console[_0x17ee25(0x2ed)](_0x17ee25(0x25a),_0x4ef047);const _0x4ee53e=this[_0x17ee25(0x317)](_0x454a0f[_0x17ee25(0x208)]);console[_0x17ee25(0x2ed)](_0x17ee25(0x2a0)+_0x4ee53e[_0x17ee25(0x1f7)]+_0x17ee25(0x34f)+_0x4ee53e[_0x17ee25(0x244)]),console[_0x17ee25(0x2ed)](_0x17ee25(0x2e2)+_0x4ee53e[_0x17ee25(0x1f3)]+',\x20'+_0x4ee53e[_0x17ee25(0x23d)]);const _0x59baf2={..._0x41c622,'first_name':_0x41c622[_0x17ee25(0x20b)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x17ee25(0x20f)]()||'','last_name':_0x41c622[_0x17ee25(0x2f2)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x17ee25(0x20f)]()||''};_0x17ee25(0x240)in _0x59baf2&&!('post_code'in _0x59baf2)&&(_0x59baf2[_0x17ee25(0x1f4)]=_0x59baf2['postcode'],delete _0x59baf2[_0x17ee25(0x240)],console[_0x17ee25(0x2ed)](_0x17ee25(0x301)+_0x59baf2[_0x17ee25(0x1f4)]));console[_0x17ee25(0x2ed)]('üßπ\x20Card\x20holder\x20names\x20cleaned:'),console[_0x17ee25(0x2ed)](_0x17ee25(0x30c)+_0x41c622[_0x17ee25(0x20b)]+_0x17ee25(0x232)+_0x41c622[_0x17ee25(0x2f2)]+'\x22'),console[_0x17ee25(0x2ed)](_0x17ee25(0x296)+_0x59baf2[_0x17ee25(0x20b)]+'\x22\x20|\x20\x22'+_0x59baf2[_0x17ee25(0x2f2)]+'\x22'),console[_0x17ee25(0x2ed)](_0x17ee25(0x230),JSON['stringify'](_0x59baf2,null,0x2));const _0x29ccd0={'amount':_0x4fa702,'currency':_0x48342e[_0x17ee25(0x1fa)](),'order_id':_0x2a6956,'result_url':_0x4ef047,'return_url':_0x29a9de,'country':'','card':{'number':_0x454a0f['number'],'expire_month':_0x454a0f[_0x17ee25(0x268)],'expire_year':_0x454a0f[_0x17ee25(0x334)],'cvv':_0x454a0f[_0x17ee25(0x1f5)]},'card_holder':_0x59baf2,'browser':_0x37db81},_0x2d933c=JSON[_0x17ee25(0x2c7)](_0x29ccd0);console['log'](_0x17ee25(0x344)),console['log'](_0x17ee25(0x2ea)),console[_0x17ee25(0x2ed)](_0x2d933c),console['log'](_0x17ee25(0x28e),_0x2d933c[_0x17ee25(0x22c)]);try{const {key:_0x121104,iv:_0x2f3fb5}=this[_0x17ee25(0x24e)]();console['log'](_0x17ee25(0x2dc)),console[_0x17ee25(0x2ed)]('üîê\x20AES\x20key\x20length:',_0x121104[_0x17ee25(0x22c)]),console[_0x17ee25(0x2ed)]('üîê\x20AES\x20IV\x20length:',_0x2f3fb5[_0x17ee25(0x22c)]);const _0x42cb36=this[_0x17ee25(0x316)](_0x2d933c,_0x121104,_0x2f3fb5);console[_0x17ee25(0x2ed)](_0x17ee25(0x218)),console[_0x17ee25(0x2ed)](_0x17ee25(0x261),_0x42cb36[_0x17ee25(0x22c)]);const _0x213f14=this['encryptRSA'](_0x121104,_0x2f3fb5,_0x4ee53e['publicKeyPath']);console['log'](_0x17ee25(0x256)),console[_0x17ee25(0x2ed)](_0x17ee25(0x2bd),_0x213f14[_0x17ee25(0x22c)]);const _0x4d96d8=this[_0x17ee25(0x323)](_0x2d933c,_0x4ee53e[_0x17ee25(0x1f3)]);console[_0x17ee25(0x2ed)](_0x17ee25(0x21b)),console[_0x17ee25(0x2ed)](_0x17ee25(0x255),_0x4d96d8[_0x17ee25(0x22c)]);const _0x48cc1f={'merchant_point_id':_0x4ee53e[_0x17ee25(0x29f)],'method':_0x17ee25(0x340),'info':_0x42cb36,'key':_0x213f14,'sign':_0x4d96d8,'lang':'en'};console[_0x17ee25(0x2ed)]('üì§\x20Sending\x20request\x20to\x20API...'),console[_0x17ee25(0x2ed)](_0x17ee25(0x26a)),console[_0x17ee25(0x2ed)](_0x17ee25(0x269),_0x4ee53e[_0x17ee25(0x29f)]),console['log']('\x20\x20\x20-\x20method:\x20charge'),console['log'](_0x17ee25(0x314),_0x42cb36[_0x17ee25(0x22c)]),console[_0x17ee25(0x2ed)](_0x17ee25(0x200),_0x213f14[_0x17ee25(0x22c)]),console['log'](_0x17ee25(0x22f),_0x4d96d8[_0x17ee25(0x22c)]),console['log']('\x20\x20\x20-\x20lang:\x20en'),console[_0x17ee25(0x2ed)](''),console[_0x17ee25(0x2ed)](_0x17ee25(0x34d)),console[_0x17ee25(0x2ed)](JSON[_0x17ee25(0x2c7)](_0x48cc1f,null,0x2)),console[_0x17ee25(0x2ed)](''),loggerService_1[_0x17ee25(0x33d)][_0x17ee25(0x220)](_0x4ee53e['cardType']['toLowerCase'](),_0x17ee25(0x331),'POST',{'merchant_point_id':_0x4ee53e['merchantPointId'],'method':_0x17ee25(0x340),'lang':'en'});const _0xd42915=Date[_0x17ee25(0x2b8)](),_0x9f5ae8=await fetch(_0x4ee53e['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x17ee25(0x291),'Accept':_0x17ee25(0x291),'User-Agent':_0x17ee25(0x308)},'body':JSON['stringify'](_0x48cc1f)}),_0x387785=Date[_0x17ee25(0x2b8)]()-_0xd42915;console['log'](_0x17ee25(0x2f4)),console[_0x17ee25(0x2ed)](_0x17ee25(0x222),_0x9f5ae8['status']),console[_0x17ee25(0x2ed)](_0x17ee25(0x348),_0x9f5ae8[_0x17ee25(0x33e)]),console[_0x17ee25(0x2ed)](_0x17ee25(0x21a),_0x387785+'ms'),console['log'](_0x17ee25(0x303)),_0x9f5ae8[_0x17ee25(0x305)][_0x17ee25(0x1fb)]((_0x43f8ae,_0x986901)=>{const _0x280405=_0x17ee25;console[_0x280405(0x2ed)](_0x280405(0x29e)+_0x986901+':\x20'+_0x43f8ae);}),console[_0x17ee25(0x2ed)]('');if(!_0x9f5ae8['ok']){const _0x6b7343=await _0x9f5ae8[_0x17ee25(0x2be)]();console['error'](_0x17ee25(0x346),_0x9f5ae8[_0x17ee25(0x2fe)]),console['error'](_0x17ee25(0x225)),console[_0x17ee25(0x2ce)](_0x6b7343),console[_0x17ee25(0x2ce)](''),loggerService_1[_0x17ee25(0x33d)][_0x17ee25(0x2da)](_0x4ee53e['cardType'][_0x17ee25(0x33b)](),_0x17ee25(0x1ef),_0x9f5ae8[_0x17ee25(0x2fe)],_0x6b7343,_0x387785),loggerService_1[_0x17ee25(0x33d)]['logWhiteDomainError'](_0x4ee53e['cardType'][_0x17ee25(0x33b)](),_0x17ee25(0x331),_0x17ee25(0x21d)+_0x9f5ae8[_0x17ee25(0x2fe)]+':\x20'+_0x6b7343);throw new Error(_0x17ee25(0x1f2)+_0x9f5ae8[_0x17ee25(0x2fe)]+_0x17ee25(0x29a)+_0x6b7343);}const _0x4aa46a=await _0x9f5ae8['json']();console[_0x17ee25(0x2ed)]('üì¶\x20FULL\x20RESPONSE\x20JSON:'),console[_0x17ee25(0x2ed)](JSON['stringify'](_0x4aa46a,null,0x2)),console['log'](''),loggerService_1[_0x17ee25(0x33d)]['logWhiteDomainResponse'](_0x4ee53e['cardType'][_0x17ee25(0x33b)](),_0x17ee25(0x1ef),_0x9f5ae8[_0x17ee25(0x2fe)],_0x4aa46a,_0x387785),console[_0x17ee25(0x2ed)](_0x17ee25(0x2b5));let _0x162afb=_0x4aa46a;if(_0x4aa46a[_0x17ee25(0x2c2)]&&_0x4aa46a[_0x17ee25(0x237)]&&_0x4aa46a[_0x17ee25(0x223)]){console['log'](_0x17ee25(0x234));try{const _0xf318aa=await this[_0x17ee25(0x30a)](_0x4aa46a[_0x17ee25(0x2c2)],_0x4aa46a['key'],_0x4ee53e[_0x17ee25(0x1f7)]);_0x162afb=JSON['parse'](_0xf318aa),console[_0x17ee25(0x2ed)](_0x17ee25(0x25e)),loggerService_1[_0x17ee25(0x33d)]['logWhiteDomainResponse'](_0x4ee53e[_0x17ee25(0x1f7)][_0x17ee25(0x33b)](),'/charge_decrypted',_0x9f5ae8[_0x17ee25(0x2fe)],_0x162afb,_0x387785),console[_0x17ee25(0x2ed)](_0x17ee25(0x327));}catch(_0x18e6e3){console[_0x17ee25(0x2ce)](_0x17ee25(0x2d1),_0x18e6e3),loggerService_1[_0x17ee25(0x33d)][_0x17ee25(0x252)](_0x4ee53e['cardType'][_0x17ee25(0x33b)](),'/charge_decrypt',_0x17ee25(0x33a)+_0x18e6e3),_0x162afb=_0x4aa46a;}}else loggerService_1[_0x17ee25(0x33d)]['logWhiteDomainResponse'](_0x4ee53e['cardType']['toLowerCase'](),'/charge_decrypted',_0x9f5ae8[_0x17ee25(0x2fe)],_0x162afb,_0x387785),console[_0x17ee25(0x2ed)]('üìù\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x17ee25(0x2ed)](_0x17ee25(0x222),_0x162afb[_0x17ee25(0x2fe)]),console['log'](_0x17ee25(0x280),_0x162afb[_0x17ee25(0x307)]),console[_0x17ee25(0x2ed)](_0x17ee25(0x290),_0x162afb[_0x17ee25(0x286)]),console[_0x17ee25(0x2ed)](_0x17ee25(0x210),_0x162afb[_0x17ee25(0x28b)]||'none');if(_0x162afb[_0x17ee25(0x2fe)]===0x64&&_0x162afb['final']===0x1)return console[_0x17ee25(0x2ed)](_0x17ee25(0x213)),{'gateway_payment_id':_0x162afb[_0x17ee25(0x286)]?.[_0x17ee25(0x226)](),'payment_url':_0x29a9de,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x162afb[_0x17ee25(0x28b)])return console[_0x17ee25(0x2ed)]('üîê\x203DS\x20verification\x20required'),this[_0x17ee25(0x26e)](_0x3dcf89,_0x2a6956,_0x162afb[_0x17ee25(0x286)]?.[_0x17ee25(0x226)]()||_0x2a6956,_0x4ee53e['cardType']),{'gateway_payment_id':_0x162afb[_0x17ee25(0x286)]?.[_0x17ee25(0x226)](),'payment_url':_0x162afb[_0x17ee25(0x28b)],'requires_3ds':!![],'threeds_url':_0x162afb[_0x17ee25(0x28b)],'status':_0x17ee25(0x2e0),'final':![]};let _0x498abc=this[_0x17ee25(0x23c)](_0x162afb[_0x17ee25(0x2fe)],_0x162afb[_0x17ee25(0x2c1)]||_0x162afb[_0x17ee25(0x203)]),_0x9658a7=_0x162afb[_0x17ee25(0x2fe)],_0x15074d=this[_0x17ee25(0x2a5)](_0x162afb[_0x17ee25(0x2fe)]);return console['log'](_0x17ee25(0x1f0)+_0x9658a7+_0x17ee25(0x294)+_0x15074d+_0x17ee25(0x27c)+_0x498abc),{'gateway_payment_id':_0x162afb[_0x17ee25(0x286)]?.[_0x17ee25(0x226)](),'payment_url':_0x29a9de,'requires_3ds':![],'status':_0x17ee25(0x329),'final':!![],'errorMessage':_0x498abc};}catch(_0x34e5ce){console[_0x17ee25(0x2ce)](_0x17ee25(0x2a4)),console[_0x17ee25(0x2ce)]('Error\x20details:',_0x34e5ce),loggerService_1[_0x17ee25(0x33d)][_0x17ee25(0x252)](_0x17ee25(0x270),_0x17ee25(0x331),_0x34e5ce);throw new Error('Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'+(_0x34e5ce instanceof Error?_0x34e5ce[_0x17ee25(0x203)]:_0x17ee25(0x2d3)));}}async[a57_0x4349fa(0x267)](_0x5af589,_0x1127df,_0x1031ef=a57_0x4349fa(0x2b0)){const _0x36f186=a57_0x4349fa;console[_0x36f186(0x2ed)](_0x36f186(0x273)+_0x1031ef+'\x20payment\x20status:\x20'+_0x5af589+'\x20('+_0x1127df+')');try{const _0x2b1b22={'payment_id':_0x5af589,'order_id':_0x1127df},_0x8d708b=JSON['stringify'](_0x2b1b22),_0x21c4cf=this[_0x36f186(0x317)](_0x1031ef===_0x36f186(0x2b0)?'4000000000000000':'5000000000000000'),{key:_0x1c7a10,iv:_0x5826e9}=this[_0x36f186(0x24e)](),_0x57868f=this[_0x36f186(0x316)](_0x8d708b,_0x1c7a10,_0x5826e9),_0x4636c5=this[_0x36f186(0x28a)](_0x1c7a10,_0x5826e9,_0x21c4cf['publicKeyPath']),_0x1a5032=this[_0x36f186(0x323)](_0x8d708b,_0x21c4cf[_0x36f186(0x1f3)]),_0x827119={'merchant_point_id':_0x21c4cf[_0x36f186(0x29f)],'method':_0x36f186(0x2fe),'info':_0x57868f,'key':_0x4636c5,'sign':_0x1a5032,'lang':'en'};loggerService_1[_0x36f186(0x33d)]['logWhiteDomainRequest'](_0x1031ef[_0x36f186(0x33b)](),_0x36f186(0x30f),_0x36f186(0x2fb),{'merchant_point_id':_0x21c4cf[_0x36f186(0x29f)],'method':_0x36f186(0x2fe),'lang':'en'});const _0x650046=Date['now'](),_0x4e6937=await fetch(_0x21c4cf['apiUrl'],{'method':_0x36f186(0x2fb),'headers':{'Content-Type':_0x36f186(0x291),'Accept':_0x36f186(0x291),'User-Agent':_0x36f186(0x308)},'body':JSON[_0x36f186(0x2c7)](_0x827119)}),_0xb18f3b=Date[_0x36f186(0x2b8)]()-_0x650046;if(!_0x4e6937['ok']){const _0x6f42a8=await _0x4e6937[_0x36f186(0x2be)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1031ef[_0x36f186(0x33b)](),_0x36f186(0x239),_0x4e6937['status'],_0x6f42a8,_0xb18f3b);throw new Error(_0x36f186(0x1f2)+_0x4e6937[_0x36f186(0x2fe)]);}const _0x2ff05b=await _0x4e6937[_0x36f186(0x312)]();loggerService_1[_0x36f186(0x33d)][_0x36f186(0x2da)](_0x1031ef[_0x36f186(0x33b)](),_0x36f186(0x239),_0x4e6937[_0x36f186(0x2fe)],_0x2ff05b,_0xb18f3b);let _0x221d0=_0x2ff05b;if(_0x2ff05b[_0x36f186(0x2c2)]&&_0x2ff05b[_0x36f186(0x237)]&&_0x2ff05b[_0x36f186(0x223)]){console[_0x36f186(0x2ed)](_0x36f186(0x25d));try{const _0x100b30=await this[_0x36f186(0x30a)](_0x2ff05b[_0x36f186(0x2c2)],_0x2ff05b[_0x36f186(0x237)],_0x1031ef);_0x221d0=JSON[_0x36f186(0x204)](_0x100b30),console[_0x36f186(0x2ed)]('‚úÖ\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x36f186(0x33d)][_0x36f186(0x2da)](_0x1031ef['toLowerCase'](),'/status_decrypted',_0x4e6937[_0x36f186(0x2fe)],_0x221d0,_0xb18f3b),console[_0x36f186(0x2ed)](_0x36f186(0x2fc));}catch(_0x1b699b){console[_0x36f186(0x2ce)](_0x36f186(0x243),_0x1b699b),loggerService_1[_0x36f186(0x33d)][_0x36f186(0x252)](_0x1031ef[_0x36f186(0x33b)](),_0x36f186(0x276),'Status\x20decryption\x20failed:\x20'+_0x1b699b),_0x221d0=_0x2ff05b;}}else loggerService_1[_0x36f186(0x33d)][_0x36f186(0x2da)](_0x1031ef[_0x36f186(0x33b)](),_0x36f186(0x339),_0x4e6937[_0x36f186(0x2fe)],_0x221d0,_0xb18f3b),console[_0x36f186(0x2ed)](_0x36f186(0x2e1));console['log'](_0x36f186(0x28f),{'status':_0x221d0[_0x36f186(0x2fe)],'final':_0x221d0[_0x36f186(0x307)],'payment_id':_0x221d0[_0x36f186(0x286)],'desc':_0x221d0[_0x36f186(0x2c1)]});let _0x424710='PENDING';if(_0x221d0[_0x36f186(0x2fe)]===0x64&&_0x221d0['final']===0x1)_0x424710=_0x36f186(0x248);else{if(_0x221d0[_0x36f186(0x307)]===0x0||!this[_0x36f186(0x2a5)](_0x221d0['status']))_0x424710=_0x36f186(0x2e0);else _0x221d0[_0x36f186(0x307)]===0x1||this[_0x36f186(0x2a5)](_0x221d0[_0x36f186(0x2fe)])?_0x424710=_0x36f186(0x329):_0x424710='PENDING';}const _0x115ac2=this['getDetailedErrorMessage'](_0x221d0['status'],_0x221d0['desc']);return{'status':_0x424710,'final':this[_0x36f186(0x2a5)](_0x221d0[_0x36f186(0x2fe)]),'amount':_0x221d0[_0x36f186(0x1f6)],'currency':_0x221d0[_0x36f186(0x2e6)],'date_success':_0x221d0[_0x36f186(0x321)],'description':_0x115ac2};}catch(_0x4ab4c3){console[_0x36f186(0x2ce)](_0x1031ef+_0x36f186(0x2ef),_0x4ab4c3),loggerService_1[_0x36f186(0x33d)][_0x36f186(0x252)](_0x1031ef[_0x36f186(0x33b)](),_0x36f186(0x30f),_0x4ab4c3);throw new Error(_0x36f186(0x22e)+_0x1031ef+_0x36f186(0x2fd)+(_0x4ab4c3 instanceof Error?_0x4ab4c3[_0x36f186(0x203)]:_0x36f186(0x2d3)));}}[a57_0x4349fa(0x26e)](_0x12ce95,_0x4c52c4,_0x1c2181,_0x3665d8){const _0x50af08=a57_0x4349fa;console['log'](_0x50af08(0x2c5)+_0x3665d8+_0x50af08(0x24b)+_0x12ce95+'\x20('+_0x1c2181+')'),this[_0x50af08(0x212)](_0x12ce95);const _0x2ebf86=[],_0x55c736=0x5*0x3c*0x3e8,_0x195d41=0x2*0x3c*0x3c*0x3e8,_0x23d8b2=Math[_0x50af08(0x311)](_0x195d41/_0x55c736);console[_0x50af08(0x2ed)](_0x50af08(0x21f)+_0x23d8b2+_0x50af08(0x277));for(let _0x34ddf0=0x1;_0x34ddf0<=_0x23d8b2;_0x34ddf0++){const _0x390fa0=setTimeout(async()=>{const _0x4f3aae=_0x50af08;console[_0x4f3aae(0x2ed)](_0x4f3aae(0x322)+_0x3665d8+_0x4f3aae(0x263)+_0x34ddf0+'/'+_0x23d8b2+'\x20for\x20payment\x20'+_0x12ce95);try{const _0x2ee3a0=await this[_0x4f3aae(0x267)](_0x1c2181,_0x4c52c4,_0x3665d8);console[_0x4f3aae(0x2ed)]('üìä\x20Status\x20check\x20#'+_0x34ddf0+_0x4f3aae(0x2d0),_0x2ee3a0),_0x2ee3a0['final']&&(console[_0x4f3aae(0x2ed)](_0x4f3aae(0x32c)+_0x12ce95+_0x4f3aae(0x2f3)+_0x2ee3a0[_0x4f3aae(0x2fe)]+_0x4f3aae(0x27e)),this['clearStatusTimers'](_0x12ce95),await this[_0x4f3aae(0x250)](_0x12ce95,_0x2ee3a0[_0x4f3aae(0x2fe)],_0x2ee3a0));}catch(_0x4ce684){console[_0x4f3aae(0x2ce)](_0x4f3aae(0x22d)+_0x34ddf0+_0x4f3aae(0x2c3)+_0x12ce95+':',_0x4ce684);}},_0x34ddf0*_0x55c736);_0x2ebf86['push'](_0x390fa0);}this[_0x50af08(0x235)]['set'](_0x12ce95,_0x2ebf86),console['log'](_0x50af08(0x241)+_0x23d8b2+_0x50af08(0x325)+_0x12ce95);}[a57_0x4349fa(0x212)](_0x526176){const _0x310b12=a57_0x4349fa,_0x29be53=this[_0x310b12(0x235)]['get'](_0x526176);_0x29be53&&(console[_0x310b12(0x2ed)](_0x310b12(0x20d)+_0x29be53[_0x310b12(0x22c)]+_0x310b12(0x271)+_0x526176),_0x29be53[_0x310b12(0x1fb)]((_0x201c22,_0x462854)=>{clearTimeout(_0x201c22);}),this['statusCheckTimers'][_0x310b12(0x319)](_0x526176));}async[a57_0x4349fa(0x250)](_0x17cfac,_0x196fca,_0x567821){const _0x2d994d=a57_0x4349fa;try{const _0x122a0e=(await Promise[_0x2d994d(0x24f)]()['then'](()=>__importStar(require(_0x2d994d(0x242)))))[_0x2d994d(0x342)],_0x4b6736={'status':_0x196fca[_0x2d994d(0x1fa)](),'updatedAt':new Date(),'statusChangedBy':_0x2d994d(0x2cb),'statusChangedAt':new Date()};_0x196fca===_0x2d994d(0x248)&&(_0x4b6736[_0x2d994d(0x2e8)]=new Date()),_0x196fca===_0x2d994d(0x329)&&_0x567821[_0x2d994d(0x2df)]&&(_0x4b6736[_0x2d994d(0x209)]=_0x567821[_0x2d994d(0x2df)],console['log'](_0x2d994d(0x34b)+_0x567821[_0x2d994d(0x2df)])),await _0x122a0e[_0x2d994d(0x295)][_0x2d994d(0x24d)]({'where':{'id':_0x17cfac},'data':_0x4b6736}),console[_0x2d994d(0x2ed)]('‚úÖ\x20Payment\x20'+_0x17cfac+_0x2d994d(0x338)+_0x196fca),await this[_0x2d994d(0x2f9)](_0x17cfac,_0x196fca);}catch(_0x1d0c60){console[_0x2d994d(0x2ce)](_0x2d994d(0x31b)+_0x17cfac+':',_0x1d0c60);}}async[a57_0x4349fa(0x2f9)](_0x43a02,_0x43d642){const _0x3c3afe=a57_0x4349fa;try{const _0x1e5562=(await Promise[_0x3c3afe(0x24f)]()[_0x3c3afe(0x2dd)](()=>__importStar(require(_0x3c3afe(0x242)))))[_0x3c3afe(0x342)],{telegramBotService:_0x3cc004}=await Promise['resolve']()[_0x3c3afe(0x2dd)](()=>__importStar(require('../telegramBotService'))),_0x4a7751=await _0x1e5562[_0x3c3afe(0x295)]['findUnique']({'where':{'id':_0x43a02},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x4a7751)return;const _0x11e224={'PAID':_0x3c3afe(0x23a),'FAILED':_0x3c3afe(0x2af)},_0x1f1db9=_0x11e224[_0x43d642];_0x1f1db9&&await _0x3cc004['sendPaymentNotification'](_0x4a7751[_0x3c3afe(0x337)],_0x4a7751,_0x1f1db9),await this[_0x3c3afe(0x31f)](_0x4a7751,_0x43d642);}catch(_0x1eff08){console['error'](_0x3c3afe(0x30e),_0x1eff08);}}async['sendShopWebhook'](_0x1597be,_0x4b37d9){const _0x550479=a57_0x4349fa,_0x12f065=Date[_0x550479(0x2b8)]();try{const _0x3a5ba4=_0x1597be[_0x550479(0x2e3)],_0x30bb2a=_0x3a5ba4[_0x550479(0x2e7)];if(!_0x30bb2a?.[_0x550479(0x217)]){console['log']('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x3a5ba4['id']);return;}const _0x37d1fa=_0x4b37d9===_0x550479(0x248)?_0x550479(0x246):'payment.failed';let _0x43952e=[];if(_0x30bb2a[_0x550479(0x28c)])try{_0x43952e=Array[_0x550479(0x2ac)](_0x30bb2a[_0x550479(0x28c)])?_0x30bb2a[_0x550479(0x28c)]:JSON[_0x550479(0x204)](_0x30bb2a[_0x550479(0x28c)]);}catch(_0x5501c8){console[_0x550479(0x2ce)]('Error\x20parsing\x20webhook\x20events:',_0x5501c8),_0x43952e=[];}if(!_0x43952e[_0x550479(0x2cc)](_0x37d1fa)){console[_0x550479(0x2ed)]('Webhook\x20event\x20'+_0x37d1fa+_0x550479(0x264)+_0x3a5ba4['id']);return;}const _0x56701c={'event':_0x37d1fa,'payment':{'id':_0x1597be['id'],'order_id':_0x1597be[_0x550479(0x21c)],'gateway_order_id':_0x1597be['gatewayOrderId'],'gateway':_0x550479(0x31e),'amount':_0x1597be[_0x550479(0x1f6)],'currency':_0x1597be[_0x550479(0x2e6)],'status':_0x4b37d9[_0x550479(0x33b)](),'customer_email':_0x1597be[_0x550479(0x227)],'customer_name':_0x1597be['customerName'],'created_at':_0x1597be[_0x550479(0x2c0)],'updated_at':new Date()}},_0x3afb2b=await fetch(_0x30bb2a[_0x550479(0x217)],{'method':_0x550479(0x2fb),'headers':{'Content-Type':_0x550479(0x291),'User-Agent':_0x550479(0x299)},'body':JSON[_0x550479(0x2c7)](_0x56701c)}),_0x16745b=Date['now']()-_0x12f065;loggerService_1[_0x550479(0x33d)]['logShopWebhookSent'](_0x1597be[_0x550479(0x337)],_0x30bb2a[_0x550479(0x217)],_0x37d1fa,_0x3afb2b[_0x550479(0x2fe)],_0x16745b,_0x56701c),console[_0x550479(0x2ed)](_0x550479(0x216)+_0x30bb2a[_0x550479(0x217)]+_0x550479(0x306)+_0x3afb2b['status']+'\x20('+_0x16745b+'ms)');}catch(_0x1c23e0){console[_0x550479(0x2ce)](_0x550479(0x1f8),_0x1c23e0),loggerService_1[_0x550479(0x33d)]['logShopWebhookError'](_0x1597be[_0x550479(0x337)],_0x1597be[_0x550479(0x2e3)]?.['settings']?.[_0x550479(0x217)]||'unknown','webhook_send',_0x1c23e0,{});}}['maskCardNumber'](_0x160cbb){const _0x1da218=a57_0x4349fa,_0x10f5d5=_0x160cbb[_0x1da218(0x29d)](/[\s-]/g,'');if(_0x10f5d5['length']<0x4)return _0x1da218(0x318);return _0x1da218(0x2d8)+_0x10f5d5['slice'](-0x4);}async[a57_0x4349fa(0x32f)](_0x983c0e,_0x2efe73=a57_0x4349fa(0x207)){const _0x3ae931=a57_0x4349fa;console[_0x3ae931(0x2ed)](_0x3ae931(0x27a),JSON['stringify'](_0x983c0e,null,0x2));let _0x2129d0=_0x983c0e,_0x5c99a2=_0x2efe73;_0x983c0e['card_type']?(_0x5c99a2=_0x983c0e['card_type']['toUpperCase']()===_0x3ae931(0x2b0)?_0x3ae931(0x2b0):_0x3ae931(0x207),console[_0x3ae931(0x2ed)](_0x3ae931(0x229)+_0x5c99a2)):console[_0x3ae931(0x2ed)]('üîç\x20Using\x20provided\x20card\x20type:\x20'+_0x5c99a2);if(_0x983c0e['info']&&_0x983c0e[_0x3ae931(0x237)]&&_0x983c0e[_0x3ae931(0x223)]){console[_0x3ae931(0x2ed)]('üîê\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...');try{const _0x35869b=await this['decryptResponsePhp'](_0x983c0e['info'],_0x983c0e[_0x3ae931(0x237)],_0x5c99a2);_0x2129d0=JSON[_0x3ae931(0x204)](_0x35869b),console[_0x3ae931(0x2ed)](_0x3ae931(0x1fe)),console[_0x3ae931(0x2ed)](_0x3ae931(0x330),JSON[_0x3ae931(0x2c7)](_0x2129d0,null,0x2));}catch(_0xf18c1){console[_0x3ae931(0x2ce)](_0x3ae931(0x31a),_0xf18c1),console[_0x3ae931(0x2ed)](_0x3ae931(0x27d)),_0x2129d0=_0x983c0e;}}else console[_0x3ae931(0x2ed)](_0x3ae931(0x26c));let _0x68a52a=_0x3ae931(0x2e0);if(_0x2129d0[_0x3ae931(0x2fe)]===0x64&&_0x2129d0['final']===0x1)_0x68a52a=_0x3ae931(0x248);else{if(_0x2129d0['final']===0x0||!this['isFinalStatus'](_0x2129d0[_0x3ae931(0x2fe)]))_0x68a52a=_0x3ae931(0x2e0);else _0x2129d0['final']===0x1||this[_0x3ae931(0x2a5)](_0x2129d0[_0x3ae931(0x2fe)])?_0x68a52a='FAILED':_0x68a52a=_0x3ae931(0x2e0);}let _0x21fc2e='';if(_0x2129d0[_0x3ae931(0x228)])_0x21fc2e=_0x2129d0[_0x3ae931(0x228)][_0x3ae931(0x226)](),console[_0x3ae931(0x2ed)](_0x3ae931(0x236)+_0x5c99a2+_0x3ae931(0x2b3)+_0x21fc2e);else _0x2129d0['payment_id']?(_0x21fc2e=_0x2129d0['payment_id'][_0x3ae931(0x226)](),console[_0x3ae931(0x2ed)](_0x3ae931(0x236)+_0x5c99a2+_0x3ae931(0x20c)+_0x21fc2e)):(_0x21fc2e=_0x2129d0['orderId']||_0x2129d0[_0x3ae931(0x211)]||_0x2129d0['id']||'',console[_0x3ae931(0x2ed)](_0x3ae931(0x2ff)+_0x21fc2e));console[_0x3ae931(0x2ed)](_0x3ae931(0x2f6)+_0x5c99a2+_0x3ae931(0x275)),console[_0x3ae931(0x2ed)]('\x20\x20\x20Payment\x20ID:\x20'+_0x21fc2e+_0x3ae931(0x2f8)+_0x2129d0[_0x3ae931(0x228)]+_0x3ae931(0x201)+_0x2129d0[_0x3ae931(0x21c)]+_0x3ae931(0x249)+_0x2129d0[_0x3ae931(0x286)]+',\x20paymentId='+_0x2129d0[_0x3ae931(0x211)]+_0x3ae931(0x285)+_0x2129d0['id']+')'),console[_0x3ae931(0x2ed)]('\x20\x20\x20Status:\x20'+_0x68a52a+'\x20(from:\x20status='+_0x2129d0[_0x3ae931(0x2fe)]+',\x20final='+_0x2129d0[_0x3ae931(0x307)]+')'),console[_0x3ae931(0x2ed)](_0x3ae931(0x202)+_0x2129d0[_0x3ae931(0x1f6)]),console[_0x3ae931(0x2ed)](_0x3ae931(0x33f)+_0x2129d0[_0x3ae931(0x2e6)]);let _0x5e407f;_0x68a52a==='FAILED'&&(_0x5e407f=this['getDetailedErrorMessage'](_0x2129d0[_0x3ae931(0x2fe)],_0x2129d0[_0x3ae931(0x2c1)]),console[_0x3ae931(0x2ed)](_0x3ae931(0x2f7)+_0x5e407f));const _0x592d1b={'paymentId':_0x21fc2e,'status':_0x68a52a,'amount':_0x2129d0[_0x3ae931(0x1f6)],'currency':_0x2129d0[_0x3ae931(0x2e6)]};return _0x5e407f&&(_0x592d1b[_0x3ae931(0x34c)]=_0x5e407f),_0x592d1b;}[a57_0x4349fa(0x313)](){const _0x4ff3fb=a57_0x4349fa;console[_0x4ff3fb(0x2ed)](_0x4ff3fb(0x25f));const _0x1a4ed1=this['statusCheckTimers'][_0x4ff3fb(0x266)];for(const [_0x18591c]of this[_0x4ff3fb(0x235)]){this['clearStatusTimers'](_0x18591c);}console[_0x4ff3fb(0x2ed)](_0x4ff3fb(0x2bf)+_0x1a4ed1+_0x4ff3fb(0x2f1));}}exports[a57_0x4349fa(0x284)]=VisaMasterCardService;