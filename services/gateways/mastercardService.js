'use strict';function a42_0x3228(_0x332a5b,_0x1aa425){const _0x262aa4=a42_0x262a();return a42_0x3228=function(_0x3228fe,_0x4df2b8){_0x3228fe=_0x3228fe-0xab;let _0x5e6368=_0x262aa4[_0x3228fe];return _0x5e6368;},a42_0x3228(_0x332a5b,_0x1aa425);}const a42_0x2254b2=a42_0x3228;(function(_0x190f5c,_0x50cc65){const _0x4ddf0a=a42_0x3228,_0x107961=_0x190f5c();while(!![]){try{const _0x2271ee=-parseInt(_0x4ddf0a(0x154))/0x1+-parseInt(_0x4ddf0a(0xbd))/0x2*(-parseInt(_0x4ddf0a(0x15e))/0x3)+parseInt(_0x4ddf0a(0x10a))/0x4*(parseInt(_0x4ddf0a(0x196))/0x5)+parseInt(_0x4ddf0a(0xbe))/0x6*(parseInt(_0x4ddf0a(0xc1))/0x7)+-parseInt(_0x4ddf0a(0xf6))/0x8*(-parseInt(_0x4ddf0a(0x16e))/0x9)+-parseInt(_0x4ddf0a(0xfe))/0xa*(parseInt(_0x4ddf0a(0xaf))/0xb)+-parseInt(_0x4ddf0a(0x12f))/0xc;if(_0x2271ee===_0x50cc65)break;else _0x107961['push'](_0x107961['shift']());}catch(_0x1b1215){_0x107961['push'](_0x107961['shift']());}}}(a42_0x262a,0xe574e));function a42_0x262a(){const _0x4a24a7=['⏰\x20Will\x20check\x20status\x20','webhookUrl','existsSync','shopId','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','logWhiteDomainError','****\x20****\x20****\x20','/status_decrypt','📝\x20Data\x20length:','TesSoft\x20Payment\x20System/1.0','Result\x20URL:','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','statusCheckTimers','__esModule','/charge_decrypted','decryptAES','\x20\x20\x20-\x20key\x20length:','number','text','https://api.paydmeth.com/api','toString','orderId','logWhiteDomainResponse','length','info','/status','customerName','Amount:','slice','cvv','payment','🔐\x20AES\x20key\x20and\x20IV\x20generated','settings','charge','crypto','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','✅\x20Status\x20response\x20decrypted\x20successfully','mastercard','POST','toUpperCase','\x20\x20\x20-\x20method:\x20charge','processWebhook','),\x20stopping\x20status\x20checks','\x20status\x20checks\x20for\x20payment\x20','\x20\x20\x20-\x20merchant_point_id:','/status_decrypted','psp_public.pem','createCipheriv','system','32bsYxKn','update','application/json','validateKeyFiles','payment_id','get','failed','__createBinding','8420590eCEUIY','merchantPointId','webhookEvents','\x20for\x20payment\x20','loggerService','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','__setModuleDefault','Webhook\x20event\x20','SHA256','📊\x20Status\x20check\x20#','FAILED','\x20characters','4gVLTvh','getOwnPropertyNames',',\x20Desc:\x20','Response\x20Body:','includes','processCardPayment','then','trim','create','expire_year','now','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','currency','randomBytes','prototype','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','paidAt','📝\x20Encrypted\x20key\x20length:','🧹\x20Clearing\x20','decryptResponse','signRSA','webhook_send','stringify','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','\x20\x20\x20-\x20sign\x20length:','💾\x20Payment\x20data\x20prepared','MasterCard\x20status\x20check\x20error:','expire_month','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Failed\x20to\x20send\x20payment\x20notifications:','push','scheduleStatusChecks','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','maskCardNumber','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','substring','25268664PKqgWa','Decryption\x20failed:\x20','3ds_url','json','createdAt','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','🛑\x20Stopped\x20','📝\x20Signature\x20length:','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','✅\x20Payment\x20successful','✅\x20Scheduled\x20','final','shop','/status_raw','ms)','aes-256-ctr','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','\x20status\x20timers\x20for\x20payment\x20','from','Status\x20decryption\x20failed:\x20','RSA_PKCS1_PADDING','payment.success','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','parse','unknown','-----END','Payment\x20ID:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','end','\x20\x20\x20-\x20info\x20length:','readFileSync','../loggerService','Card\x20Number:','base64','🔐\x20AES\x20key\x20length:','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','974203fxJBfM','key','amount','/charge_raw','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','Processing\x20MasterCard\x20webhook:','\x20with\x20status\x20','paid','\x20not\x20enabled\x20for\x20shop\x20','3bHBwWT','log','status','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','sendShopWebhook','createDecipheriv','Response\x20Time:','updatePaymentStatus','keys','privateKeyPath','default','-----BEGIN','1111','payment.failed','encryptRSA','getOwnPropertyDescriptor','3077262MnRATw','HTTP\x20error!\x20status:\x20','\x20\x20\x20-\x20lang:\x20en','💳\x20MasterCard\x20service\x20initialized','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','logWhiteDomainRequest','utf8','sign','Error\x20details:','defineProperty','first_name','error','size','🔐\x20Public\x20key\x20length:\x20','generateAESKey','desc','Status:','clearStatusTimers','📝\x20Final\x20request\x20structure:','✅\x20Payment\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','PAID','message','../../config/database','date_success',',\x20Final:\x20','description','findUnique',',\x20body:\x20','Card\x20Holder:','https://api2.trapay.uk/decrypt.php','cwd','🔐\x20Private\x20key\x20path:','decryptResponsePhp','🔐\x20Public\x20key\x20path:','Error\x20parsing\x20webhook\x20events:','3DS\x20URL:','❌\x20MasterCard\x20key\x20validation\x20failed:','encryptAES','Return\x20URL:','2172065JACOIj','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','constants','Unknown\x20error','MasterCard\x20webhook\x20sent\x20to\x20','🔐\x20RSA\x20signing\x20successful','\x20status\x20updated\x20to\x20','logShopWebhookSent','writable','privateDecrypt','order_id','HTTP\x20Status:','set','resolve','private.pem','none','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','📝\x20Encrypted\x20data\x20length:','11BcphBG','publicKeyPath','MasterCardService','customerEmail','🔐\x20Private\x20key\x20length:\x20','PENDING','last_name','❌\x20Status\x20check\x20#','stopAllStatusChecks','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','HTTP\x20','logShopWebhookError','isArray','checkPaymentStatus','2993722Uaudjx','4688676KLlLAd','🔐\x20AES\x20IV\x20length:','gatewayOrderId','14DiVabz','/charge','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','\x20result:'];a42_0x262a=function(){return _0x4a24a7;};return a42_0x262a();}var __createBinding=this&&this[a42_0x2254b2(0xfd)]||(Object[a42_0x2254b2(0x112)]?function(_0x423cfd,_0x21c7e8,_0x5e5db3,_0x530de2){const _0x115313=a42_0x2254b2;if(_0x530de2===undefined)_0x530de2=_0x5e5db3;var _0x1a5f70=Object[_0x115313(0x16d)](_0x21c7e8,_0x5e5db3);(!_0x1a5f70||(_0x115313(0xfb)in _0x1a5f70?!_0x21c7e8[_0x115313(0xd2)]:_0x1a5f70[_0x115313(0x19e)]||_0x1a5f70['configurable']))&&(_0x1a5f70={'enumerable':!![],'get':function(){return _0x21c7e8[_0x5e5db3];}}),Object[_0x115313(0x177)](_0x423cfd,_0x530de2,_0x1a5f70);}:function(_0x421f08,_0x1129d5,_0x206009,_0x14fe61){if(_0x14fe61===undefined)_0x14fe61=_0x206009;_0x421f08[_0x14fe61]=_0x1129d5[_0x206009];}),__setModuleDefault=this&&this[a42_0x2254b2(0x104)]||(Object['create']?function(_0x299837,_0x360116){const _0x48c9a3=a42_0x2254b2;Object['defineProperty'](_0x299837,_0x48c9a3(0x168),{'enumerable':!![],'value':_0x360116});}:function(_0x23e914,_0x7a8dba){_0x23e914['default']=_0x7a8dba;}),__importStar=this&&this['__importStar']||(function(){var _0x33fffd=function(_0x5da10a){const _0x985ee7=a42_0x3228;return _0x33fffd=Object[_0x985ee7(0x10b)]||function(_0x5776e2){const _0x1307eb=_0x985ee7;var _0x503dde=[];for(var _0x211b94 in _0x5776e2)if(Object[_0x1307eb(0x118)]['hasOwnProperty']['call'](_0x5776e2,_0x211b94))_0x503dde[_0x503dde[_0x1307eb(0xdc)]]=_0x211b94;return _0x503dde;},_0x33fffd(_0x5da10a);};return function(_0x4dbd97){const _0x12836e=a42_0x3228;if(_0x4dbd97&&_0x4dbd97['__esModule'])return _0x4dbd97;var _0x3ee57f={};if(_0x4dbd97!=null){for(var _0xc1d03e=_0x33fffd(_0x4dbd97),_0x474eb7=0x0;_0x474eb7<_0xc1d03e[_0x12836e(0xdc)];_0x474eb7++)if(_0xc1d03e[_0x474eb7]!==_0x12836e(0x168))__createBinding(_0x3ee57f,_0x4dbd97,_0xc1d03e[_0x474eb7]);}return __setModuleDefault(_0x3ee57f,_0x4dbd97),_0x3ee57f;};}()),__importDefault=this&&this['__importDefault']||function(_0x34675d){const _0x3e7d60=a42_0x2254b2;return _0x34675d&&_0x34675d[_0x3e7d60(0xd2)]?_0x34675d:{'default':_0x34675d};};Object[a42_0x2254b2(0x177)](exports,a42_0x2254b2(0xd2),{'value':!![]}),exports[a42_0x2254b2(0xb1)]=void 0x0;const crypto_1=__importDefault(require(a42_0x2254b2(0xe7))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a42_0x2254b2(0x14f));class MasterCardService{constructor(){const _0x1610af=a42_0x2254b2;this['statusCheckTimers']=new Map(),this['apiUrl']=_0x1610af(0xd8),this[_0x1610af(0xff)]=0x67c,this['privateKeyPath']=path_1[_0x1610af(0x168)]['join'](process[_0x1610af(0x18d)](),_0x1610af(0x166),_0x1610af(0xab)),this[_0x1610af(0xb0)]=path_1[_0x1610af(0x168)]['join'](process[_0x1610af(0x18d)](),'keys',_0x1610af(0xf3)),console[_0x1610af(0x15f)](_0x1610af(0x171)),console[_0x1610af(0x15f)](_0x1610af(0x18e),this['privateKeyPath']),console[_0x1610af(0x15f)](_0x1610af(0x190),this[_0x1610af(0xb0)]),this[_0x1610af(0xf9)]();}['validateKeyFiles'](){const _0x453828=a42_0x2254b2;try{if(!fs_1[_0x453828(0x168)][_0x453828(0xc7)](this[_0x453828(0x167)]))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this[_0x453828(0x167)]);if(!fs_1['default'][_0x453828(0xc7)](this[_0x453828(0xb0)]))throw new Error('Public\x20key\x20file\x20not\x20found:\x20'+this[_0x453828(0xb0)]);const _0x596e21=fs_1[_0x453828(0x168)]['readFileSync'](this[_0x453828(0x167)],_0x453828(0x174))[_0x453828(0x111)](),_0x322ccb=fs_1['default'][_0x453828(0x14e)](this[_0x453828(0xb0)],_0x453828(0x174))[_0x453828(0x111)]();if(!_0x596e21['includes']('-----BEGIN')||!_0x596e21[_0x453828(0x10e)](_0x453828(0x148)))throw new Error(_0x453828(0x127));if(!_0x322ccb[_0x453828(0x10e)](_0x453828(0x169))||!_0x322ccb['includes'](_0x453828(0x148)))throw new Error('Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x453828(0x15f)](_0x453828(0x13f)),console['log'](_0x453828(0xb3)+_0x596e21[_0x453828(0xdc)]+_0x453828(0x109)),console['log'](_0x453828(0x17b)+_0x322ccb[_0x453828(0xdc)]+_0x453828(0x109));}catch(_0x28a631){console[_0x453828(0x179)](_0x453828(0x193),_0x28a631);throw _0x28a631;}}[a42_0x2254b2(0x17c)](){const _0x2020d2=a42_0x2254b2,_0x450851=crypto_1[_0x2020d2(0x168)][_0x2020d2(0x117)](0x20),_0x30c132=crypto_1[_0x2020d2(0x168)][_0x2020d2(0x117)](0x10);return{'key':_0x450851,'iv':_0x30c132};}[a42_0x2254b2(0x194)](_0xb4b580,_0xcacb19,_0xe089f5){const _0x4f6ebb=a42_0x2254b2,_0x316670=crypto_1[_0x4f6ebb(0x168)][_0x4f6ebb(0xf4)]('aes-256-ctr',_0xcacb19,_0xe089f5);let _0x3822f4=_0x316670[_0x4f6ebb(0xf7)](_0xb4b580,_0x4f6ebb(0x174),'base64');return _0x3822f4+=_0x316670[_0x4f6ebb(0x13a)](_0x4f6ebb(0x151)),_0x3822f4;}[a42_0x2254b2(0x16c)](_0x296cdd,_0x49c02d){const _0x39f6e9=a42_0x2254b2;try{const _0x1a398f=fs_1['default'][_0x39f6e9(0x14e)](this[_0x39f6e9(0xb0)],_0x39f6e9(0x174))[_0x39f6e9(0x111)](),_0x56c347={'iv':_0x49c02d[_0x39f6e9(0xd9)](_0x39f6e9(0x151)),'key':_0x296cdd['toString'](_0x39f6e9(0x151))},_0x205507=JSON[_0x39f6e9(0x120)](_0x56c347);console[_0x39f6e9(0x15f)](_0x39f6e9(0x12b),_0x205507[_0x39f6e9(0xdc)]);const _0x16d139=crypto_1[_0x39f6e9(0x168)]['publicEncrypt']({'key':_0x1a398f,'padding':crypto_1[_0x39f6e9(0x168)][_0x39f6e9(0x198)][_0x39f6e9(0x143)]},Buffer[_0x39f6e9(0x141)](_0x205507));return console[_0x39f6e9(0x15f)](_0x39f6e9(0x134),_0x16d139[_0x39f6e9(0xdc)]),_0x16d139[_0x39f6e9(0xd9)](_0x39f6e9(0x151));}catch(_0x308445){console[_0x39f6e9(0x179)]('❌\x20RSA\x20encryption\x20failed:',_0x308445);throw new Error(_0x39f6e9(0xad));}}[a42_0x2254b2(0x11e)](_0x4d8416){const _0x1dacc9=a42_0x2254b2;try{const _0x50db03=fs_1[_0x1dacc9(0x168)][_0x1dacc9(0x14e)](this[_0x1dacc9(0x167)],_0x1dacc9(0x174))['trim'](),_0x2be4f0=crypto_1['default']['createSign'](_0x1dacc9(0x106));_0x2be4f0[_0x1dacc9(0xf7)](_0x4d8416),_0x2be4f0[_0x1dacc9(0x14c)]();const _0x11d334=_0x2be4f0[_0x1dacc9(0x175)](_0x50db03,_0x1dacc9(0x151));return console[_0x1dacc9(0x15f)](_0x1dacc9(0x19b)),console[_0x1dacc9(0x15f)]('📝\x20Data\x20to\x20sign\x20length:',_0x4d8416[_0x1dacc9(0xdc)]),console['log'](_0x1dacc9(0x136),_0x11d334[_0x1dacc9(0xdc)]),_0x11d334;}catch(_0x5ee1c2){console[_0x1dacc9(0x179)]('❌\x20RSA\x20signing\x20failed:',_0x5ee1c2),console[_0x1dacc9(0x179)]('❌\x20Data\x20being\x20signed:',_0x4d8416[_0x1dacc9(0x12e)](0x0,0xc8)+'...');throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}[a42_0x2254b2(0xd4)](_0x3663d6,_0x10faa3,_0x311b1e){const _0x538338=a42_0x2254b2,_0x402855=crypto_1[_0x538338(0x168)][_0x538338(0x163)](_0x538338(0x13e),_0x10faa3,_0x311b1e);let _0xef3caf=_0x402855[_0x538338(0xf7)](_0x3663d6,_0x538338(0x151),_0x538338(0x174));return _0xef3caf+=_0x402855[_0x538338(0x13a)](_0x538338(0x174)),_0xef3caf;}async[a42_0x2254b2(0x18f)](_0x52259b,_0x450ea9){const _0x6c437=a42_0x2254b2;try{const _0x174fba=await fetch(_0x6c437(0x18c),{'method':_0x6c437(0xeb),'headers':{'Content-Type':_0x6c437(0xf8)},'body':JSON[_0x6c437(0x120)]({'info':_0x52259b,'key':_0x450ea9})});if(!_0x174fba['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x174fba['text']();}catch(_0x1ac98e){console[_0x6c437(0x179)]('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x1ac98e);throw new Error(_0x6c437(0xb8));}}[a42_0x2254b2(0x11d)](_0x1eab1f,_0xf47c02){const _0x5282a4=a42_0x2254b2;try{const _0x34a142=fs_1[_0x5282a4(0x168)][_0x5282a4(0x14e)](this[_0x5282a4(0x167)],'utf8')[_0x5282a4(0x111)](),_0x15b59d=crypto_1[_0x5282a4(0x168)][_0x5282a4(0x19f)](_0x34a142,Buffer[_0x5282a4(0x141)](_0xf47c02,_0x5282a4(0x151))),_0x37c3c3=JSON[_0x5282a4(0x146)](_0x15b59d[_0x5282a4(0xd9)]()),_0x4754ae=Buffer['from'](_0x37c3c3['key'],_0x5282a4(0x151)),_0x52cf1a=Buffer[_0x5282a4(0x141)](_0x37c3c3['iv'],_0x5282a4(0x151));return this[_0x5282a4(0xd4)](_0x1eab1f,_0x4754ae,_0x52cf1a);}catch(_0x4d77bc){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a42_0x2254b2(0x10f)](_0xc1e12){const _0x428893=a42_0x2254b2,{paymentId:_0x436157,orderId:_0x2d8db3,amount:_0x42da0a,currency:_0xb773bf,cardData:_0x15898b,resultUrl:_0x17cd20,returnUrl:_0x269a06,cardHolder:_0x2e9b76,browser:_0x33fe61}=_0xc1e12;console[_0x428893(0x15f)](_0x428893(0x14b)),console[_0x428893(0x15f)](_0x428893(0x149),_0x436157),console[_0x428893(0x15f)]('Order\x20ID:',_0x2d8db3),console[_0x428893(0x15f)](_0x428893(0xe0),_0x42da0a,_0xb773bf),console[_0x428893(0x15f)](_0x428893(0x150),this[_0x428893(0x12c)](_0x15898b[_0x428893(0xd6)])),console['log'](_0x428893(0x18b),_0x2e9b76[_0x428893(0x178)]+'\x20'+_0x2e9b76[_0x428893(0xb5)]),console['log'](_0x428893(0x195),_0x269a06),console[_0x428893(0x15f)](_0x428893(0xcf),_0x17cd20);const _0x7f9996={'amount':_0x42da0a,'currency':_0xb773bf[_0x428893(0xec)](),'order_id':_0x2d8db3,'result_url':_0x17cd20,'return_url':_0x269a06,'card':{'number':_0x15898b[_0x428893(0xd6)],'expire_month':_0x15898b[_0x428893(0x125)],'expire_year':_0x15898b[_0x428893(0x113)],'cvv':_0x15898b[_0x428893(0xe2)]},'card_holder':_0x2e9b76,'browser':_0x33fe61},_0x398832=JSON[_0x428893(0x120)](_0x7f9996);console[_0x428893(0x15f)](_0x428893(0x123)),console[_0x428893(0x15f)](_0x428893(0x115)),console[_0x428893(0x15f)](_0x398832),console[_0x428893(0x15f)](_0x428893(0xcd),_0x398832[_0x428893(0xdc)]);try{const {key:_0x2ddd82,iv:_0x2ab568}=this[_0x428893(0x17c)]();console[_0x428893(0x15f)](_0x428893(0xe4)),console['log'](_0x428893(0x152),_0x2ddd82['length']),console[_0x428893(0x15f)](_0x428893(0xbf),_0x2ab568[_0x428893(0xdc)]);const _0x48d4a1=this[_0x428893(0x194)](_0x398832,_0x2ddd82,_0x2ab568);console[_0x428893(0x15f)]('🔐\x20Data\x20encrypted\x20with\x20AES'),console[_0x428893(0x15f)](_0x428893(0xae),_0x48d4a1[_0x428893(0xdc)]);const _0x29870b=this['encryptRSA'](_0x2ddd82,_0x2ab568);console['log'](_0x428893(0x12d)),console[_0x428893(0x15f)](_0x428893(0x11b),_0x29870b['length']);const _0xcc3a25=this[_0x428893(0x11e)](_0x398832);console[_0x428893(0x15f)]('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x428893(0x15f)](_0x428893(0x136),_0xcc3a25[_0x428893(0xdc)]);const _0x10a808={'merchant_point_id':this['merchantPointId'],'method':_0x428893(0xe6),'info':_0x48d4a1,'key':_0x29870b,'sign':_0xcc3a25,'lang':'en'};console[_0x428893(0x15f)](_0x428893(0x103)),console['log'](_0x428893(0x180)),console[_0x428893(0x15f)](_0x428893(0xf1),this[_0x428893(0xff)]),console['log'](_0x428893(0xed)),console[_0x428893(0x15f)](_0x428893(0x14d),_0x48d4a1[_0x428893(0xdc)]),console['log'](_0x428893(0xd5),_0x29870b['length']),console[_0x428893(0x15f)](_0x428893(0x122),_0xcc3a25[_0x428893(0xdc)]),console[_0x428893(0x15f)](_0x428893(0x170)),loggerService_1[_0x428893(0x102)][_0x428893(0x173)](_0x428893(0xea),_0x428893(0xc2),_0x428893(0xeb),{'merchant_point_id':this[_0x428893(0xff)],'method':_0x428893(0xe6),'lang':'en'});const _0x1ecf27=Date[_0x428893(0x114)](),_0x5a3c2a=await fetch(this['apiUrl'],{'method':_0x428893(0xeb),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x10a808)}),_0x3fa88d=Date['now']()-_0x1ecf27;console[_0x428893(0x15f)](_0x428893(0x121)),console['log'](_0x428893(0x17e),_0x5a3c2a[_0x428893(0x160)]),console[_0x428893(0x15f)](_0x428893(0x164),_0x3fa88d+'ms');if(!_0x5a3c2a['ok']){const _0x23c16e=await _0x5a3c2a[_0x428893(0xd7)]();console[_0x428893(0x179)](_0x428893(0x1a1),_0x5a3c2a[_0x428893(0x160)]),console[_0x428893(0x179)](_0x428893(0x10d),_0x23c16e),loggerService_1[_0x428893(0x102)][_0x428893(0xdb)](_0x428893(0xea),_0x428893(0x157),_0x5a3c2a[_0x428893(0x160)],_0x23c16e,_0x3fa88d),loggerService_1[_0x428893(0x102)][_0x428893(0xca)](_0x428893(0xea),_0x428893(0xc2),_0x428893(0xb9)+_0x5a3c2a[_0x428893(0x160)]+':\x20'+_0x23c16e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5a3c2a[_0x428893(0x160)]+_0x428893(0x18a)+_0x23c16e);}const _0x226ba4=await _0x5a3c2a[_0x428893(0x132)]();loggerService_1[_0x428893(0x102)][_0x428893(0xdb)](_0x428893(0xea),_0x428893(0x157),_0x5a3c2a[_0x428893(0x160)],_0x226ba4,_0x3fa88d),console[_0x428893(0x15f)](_0x428893(0x197));let _0x238352=_0x226ba4;if(_0x226ba4[_0x428893(0xdd)]&&_0x226ba4[_0x428893(0x155)]&&_0x226ba4['sign']){console[_0x428893(0x15f)](_0x428893(0x158));try{const _0x3ad16c=await this[_0x428893(0x18f)](_0x226ba4[_0x428893(0xdd)],_0x226ba4['key']);_0x238352=JSON[_0x428893(0x146)](_0x3ad16c),console[_0x428893(0x15f)](_0x428893(0x126)),loggerService_1['loggerService'][_0x428893(0xdb)](_0x428893(0xea),_0x428893(0xd3),_0x5a3c2a[_0x428893(0x160)],_0x238352,_0x3fa88d),console['log'](_0x428893(0xc3));}catch(_0x5bc921){console[_0x428893(0x179)](_0x428893(0x161),_0x5bc921),loggerService_1['loggerService'][_0x428893(0xca)]('mastercard','/charge_decrypt',_0x428893(0x130)+_0x5bc921),_0x238352=_0x226ba4;}}else loggerService_1['loggerService'][_0x428893(0xdb)](_0x428893(0xea),_0x428893(0xd3),_0x5a3c2a['status'],_0x238352,_0x3fa88d),console['log'](_0x428893(0x153));console[_0x428893(0x15f)](_0x428893(0x17e),_0x238352[_0x428893(0x160)]),console['log']('Final:',_0x238352[_0x428893(0x13a)]),console['log'](_0x428893(0x149),_0x238352[_0x428893(0xfa)]),console[_0x428893(0x15f)](_0x428893(0x192),_0x238352[_0x428893(0x131)]||_0x428893(0xac));if(_0x238352[_0x428893(0x160)]===0x64&&_0x238352[_0x428893(0x13a)]===0x1)return console['log'](_0x428893(0x138)),{'gateway_payment_id':_0x238352['payment_id']?.[_0x428893(0xd9)](),'payment_url':_0x269a06,'requires_3ds':![],'status':_0x428893(0x183),'final':!![]};if(_0x238352['3ds_url'])return console[_0x428893(0x15f)]('🔐\x203DS\x20verification\x20required'),this['scheduleStatusChecks'](_0x436157,_0x2d8db3,_0x238352[_0x428893(0xfa)]?.['toString']()||_0x2d8db3),{'gateway_payment_id':_0x238352[_0x428893(0xfa)]?.[_0x428893(0xd9)](),'payment_url':_0x238352[_0x428893(0x131)],'requires_3ds':!![],'threeds_url':_0x238352[_0x428893(0x131)],'status':'PENDING','final':![]};let _0x784228=_0x238352[_0x428893(0x17d)]||_0x238352[_0x428893(0x184)]||_0x428893(0x199),_0x4c4fec=_0x238352[_0x428893(0x160)],_0x4742a2=_0x238352[_0x428893(0x13a)];return console['log'](_0x428893(0xd0)+_0x4c4fec+_0x428893(0x187)+_0x4742a2+_0x428893(0x10c)+_0x784228),{'gateway_payment_id':_0x238352['payment_id']?.[_0x428893(0xd9)](),'payment_url':_0x269a06,'requires_3ds':![],'status':_0x428893(0x108),'final':!![]};}catch(_0x1a7b6b){console['error']('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console[_0x428893(0x179)](_0x428893(0x176),_0x1a7b6b),loggerService_1['loggerService'][_0x428893(0xca)](_0x428893(0xea),_0x428893(0xc2),_0x1a7b6b);throw new Error('Failed\x20to\x20process\x20MasterCard\x20payment:\x20'+(_0x1a7b6b instanceof Error?_0x1a7b6b[_0x428893(0x184)]:'Unknown\x20error'));}}async[a42_0x2254b2(0xbc)](_0x130c6c,_0x15274d){const _0x121b99=a42_0x2254b2;console[_0x121b99(0x15f)]('📊\x20Checking\x20MasterCard\x20payment\x20status:\x20'+_0x130c6c+'\x20('+_0x15274d+')');try{const _0x2aa398={'payment_id':_0x130c6c,'order_id':_0x15274d},_0x50b5f4=JSON[_0x121b99(0x120)](_0x2aa398),{key:_0x57dfda,iv:_0x1391a3}=this['generateAESKey'](),_0x1f98f4=this[_0x121b99(0x194)](_0x50b5f4,_0x57dfda,_0x1391a3),_0x46d7bc=this[_0x121b99(0x16c)](_0x57dfda,_0x1391a3),_0x32567b=this[_0x121b99(0x11e)](_0x50b5f4),_0x59a63d={'merchant_point_id':this[_0x121b99(0xff)],'method':_0x121b99(0x160),'info':_0x1f98f4,'key':_0x46d7bc,'sign':_0x32567b,'lang':'en'};loggerService_1[_0x121b99(0x102)]['logWhiteDomainRequest'](_0x121b99(0xea),_0x121b99(0xde),_0x121b99(0xeb),{'merchant_point_id':this['merchantPointId'],'method':_0x121b99(0x160),'lang':'en'});const _0x30f6d7=Date[_0x121b99(0x114)](),_0x59ddd3=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x121b99(0xf8),'User-Agent':_0x121b99(0xce)},'body':JSON[_0x121b99(0x120)](_0x59a63d)}),_0x3a4ce4=Date[_0x121b99(0x114)]()-_0x30f6d7;if(!_0x59ddd3['ok']){const _0x3cf352=await _0x59ddd3[_0x121b99(0xd7)]();loggerService_1[_0x121b99(0x102)][_0x121b99(0xdb)](_0x121b99(0xea),_0x121b99(0x13c),_0x59ddd3[_0x121b99(0x160)],_0x3cf352,_0x3a4ce4);throw new Error(_0x121b99(0x16f)+_0x59ddd3[_0x121b99(0x160)]);}const _0x25600a=await _0x59ddd3[_0x121b99(0x132)]();loggerService_1[_0x121b99(0x102)][_0x121b99(0xdb)](_0x121b99(0xea),_0x121b99(0x13c),_0x59ddd3[_0x121b99(0x160)],_0x25600a,_0x3a4ce4);let _0x36b473=_0x25600a;if(_0x25600a[_0x121b99(0xdd)]&&_0x25600a[_0x121b99(0x155)]&&_0x25600a['sign']){console[_0x121b99(0x15f)](_0x121b99(0x137));try{const _0x4abc54=this['decryptResponse'](_0x25600a['info'],_0x25600a[_0x121b99(0x155)]);_0x36b473=JSON['parse'](_0x4abc54),console[_0x121b99(0x15f)](_0x121b99(0xe9)),loggerService_1[_0x121b99(0x102)][_0x121b99(0xdb)](_0x121b99(0xea),_0x121b99(0xf2),_0x59ddd3[_0x121b99(0x160)],_0x36b473,_0x3a4ce4),console[_0x121b99(0x15f)](_0x121b99(0xc9));}catch(_0x3f0824){console['error']('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x3f0824),loggerService_1['loggerService']['logWhiteDomainError'](_0x121b99(0xea),_0x121b99(0xcc),_0x121b99(0x142)+_0x3f0824),_0x36b473=_0x25600a;}}else loggerService_1[_0x121b99(0x102)][_0x121b99(0xdb)](_0x121b99(0xea),_0x121b99(0xf2),_0x59ddd3[_0x121b99(0x160)],_0x36b473,_0x3a4ce4),console[_0x121b99(0x15f)](_0x121b99(0x145));console[_0x121b99(0x15f)]('📊\x20Status\x20check\x20result:',{'status':_0x36b473[_0x121b99(0x160)],'final':_0x36b473['final'],'payment_id':_0x36b473[_0x121b99(0xfa)],'desc':_0x36b473[_0x121b99(0x17d)]});let _0x46e26b='PENDING';if(_0x36b473[_0x121b99(0x160)]===0x1&&_0x36b473[_0x121b99(0x13a)]===0x1)_0x46e26b=_0x121b99(0x183);else _0x36b473[_0x121b99(0x160)]===0x0&&_0x36b473[_0x121b99(0x13a)]===0x0?_0x46e26b=_0x121b99(0xb4):_0x46e26b=_0x121b99(0x108);return{'status':_0x46e26b,'final':_0x36b473[_0x121b99(0x13a)]===0x1,'amount':_0x36b473[_0x121b99(0x156)],'currency':_0x36b473['currency'],'date_success':_0x36b473[_0x121b99(0x186)],'description':_0x36b473[_0x121b99(0x17d)]};}catch(_0x1ed4dc){console[_0x121b99(0x179)](_0x121b99(0x124),_0x1ed4dc),loggerService_1[_0x121b99(0x102)][_0x121b99(0xca)](_0x121b99(0xea),_0x121b99(0xde),_0x1ed4dc);throw new Error(_0x121b99(0x119)+(_0x1ed4dc instanceof Error?_0x1ed4dc[_0x121b99(0x184)]:_0x121b99(0x199)));}}[a42_0x2254b2(0x12a)](_0x31ecab,_0x464644,_0x5f0080){const _0x14bf31=a42_0x2254b2;console[_0x14bf31(0x15f)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0x31ecab+'\x20('+_0x5f0080+')'),this[_0x14bf31(0x17f)](_0x31ecab);const _0x6c2304=[],_0x3c38a5=0x5*0x3c*0x3e8,_0x226a6f=0x2*0x3c*0x3c*0x3e8,_0x569853=Math['floor'](_0x226a6f/_0x3c38a5);console['log'](_0x14bf31(0xc5)+_0x569853+_0x14bf31(0x172));for(let _0x562436=0x1;_0x562436<=_0x569853;_0x562436++){const _0x37fabd=setTimeout(async()=>{const _0x5bf27d=_0x14bf31;console[_0x5bf27d(0x15f)]('🔍\x20MasterCard\x20status\x20check\x20#'+_0x562436+'/'+_0x569853+_0x5bf27d(0x101)+_0x31ecab);try{const _0x14eb50=await this[_0x5bf27d(0xbc)](_0x5f0080,_0x464644);console[_0x5bf27d(0x15f)](_0x5bf27d(0x107)+_0x562436+_0x5bf27d(0xc4),_0x14eb50),_0x14eb50['final']&&(console[_0x5bf27d(0x15f)](_0x5bf27d(0x181)+_0x31ecab+'\x20is\x20final\x20('+_0x14eb50[_0x5bf27d(0x160)]+_0x5bf27d(0xef)),this[_0x5bf27d(0x17f)](_0x31ecab),await this[_0x5bf27d(0x165)](_0x31ecab,_0x14eb50[_0x5bf27d(0x160)],_0x14eb50));}catch(_0x110d0c){console[_0x5bf27d(0x179)](_0x5bf27d(0xb6)+_0x562436+'\x20failed\x20for\x20payment\x20'+_0x31ecab+':',_0x110d0c);}},_0x562436*_0x3c38a5);_0x6c2304[_0x14bf31(0x129)](_0x37fabd);}this[_0x14bf31(0xd1)][_0x14bf31(0x1a2)](_0x31ecab,_0x6c2304),console[_0x14bf31(0x15f)](_0x14bf31(0x139)+_0x569853+_0x14bf31(0xf0)+_0x31ecab);}[a42_0x2254b2(0x17f)](_0x503160){const _0x3cd39e=a42_0x2254b2,_0xe54c93=this[_0x3cd39e(0xd1)]['get'](_0x503160);_0xe54c93&&(console['log'](_0x3cd39e(0x11c)+_0xe54c93[_0x3cd39e(0xdc)]+_0x3cd39e(0x140)+_0x503160),_0xe54c93['forEach']((_0x8c4519,_0x3b9f36)=>{clearTimeout(_0x8c4519);}),this[_0x3cd39e(0xd1)]['delete'](_0x503160));}async[a42_0x2254b2(0x165)](_0x4511bd,_0x548733,_0x3fa8e8){const _0x68b398=a42_0x2254b2;try{const _0x1b3f05=(await Promise[_0x68b398(0x1a3)]()[_0x68b398(0x110)](()=>__importStar(require('../../config/database'))))[_0x68b398(0x168)],_0x24b653={'status':_0x548733[_0x68b398(0xec)](),'updatedAt':new Date(),'statusChangedBy':_0x68b398(0xf5),'statusChangedAt':new Date()};_0x548733==='PAID'&&(_0x24b653[_0x68b398(0x11a)]=new Date()),_0x3fa8e8[_0x68b398(0x188)]&&(_0x24b653['adminNotes']='MasterCard:\x20'+_0x3fa8e8[_0x68b398(0x188)]),await _0x1b3f05[_0x68b398(0xe3)][_0x68b398(0xf7)]({'where':{'id':_0x4511bd},'data':_0x24b653}),console[_0x68b398(0x15f)](_0x68b398(0x181)+_0x4511bd+_0x68b398(0x19c)+_0x548733),await this['sendPaymentNotifications'](_0x4511bd,_0x548733);}catch(_0x5eae69){console[_0x68b398(0x179)](_0x68b398(0x159)+_0x4511bd+':',_0x5eae69);}}async['sendPaymentNotifications'](_0x2065a6,_0x115ef8){const _0x57dbb2=a42_0x2254b2;try{const _0xe2c5bf=(await Promise[_0x57dbb2(0x1a3)]()[_0x57dbb2(0x110)](()=>__importStar(require(_0x57dbb2(0x185)))))[_0x57dbb2(0x168)],{telegramBotService:_0x405711}=await Promise['resolve']()['then'](()=>__importStar(require('../telegramBotService'))),_0x51ae48=await _0xe2c5bf[_0x57dbb2(0xe3)][_0x57dbb2(0x189)]({'where':{'id':_0x2065a6},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x51ae48)return;const _0x2e2c26={'PAID':_0x57dbb2(0x15c),'FAILED':_0x57dbb2(0xfc)},_0x57a40e=_0x2e2c26[_0x115ef8];_0x57a40e&&await _0x405711['sendPaymentNotification'](_0x51ae48['shopId'],_0x51ae48,_0x57a40e),await this[_0x57dbb2(0x162)](_0x51ae48,_0x115ef8);}catch(_0x388f02){console[_0x57dbb2(0x179)](_0x57dbb2(0x128),_0x388f02);}}async[a42_0x2254b2(0x162)](_0x3bca11,_0x2ca184){const _0x117ee3=a42_0x2254b2,_0x45b756=Date[_0x117ee3(0x114)]();try{const _0x3988c6=_0x3bca11[_0x117ee3(0x13b)],_0x4d8da5=_0x3988c6[_0x117ee3(0xe5)];if(!_0x4d8da5?.[_0x117ee3(0xc6)]){console[_0x117ee3(0x15f)](_0x117ee3(0x182)+_0x3988c6['id']);return;}const _0x258295=_0x2ca184===_0x117ee3(0x183)?_0x117ee3(0x144):_0x117ee3(0x16b);let _0x360465=[];if(_0x4d8da5[_0x117ee3(0x100)])try{_0x360465=Array[_0x117ee3(0xbb)](_0x4d8da5[_0x117ee3(0x100)])?_0x4d8da5[_0x117ee3(0x100)]:JSON[_0x117ee3(0x146)](_0x4d8da5[_0x117ee3(0x100)]);}catch(_0x21d7a0){console['error'](_0x117ee3(0x191),_0x21d7a0),_0x360465=[];}if(!_0x360465['includes'](_0x258295)){console[_0x117ee3(0x15f)](_0x117ee3(0x105)+_0x258295+_0x117ee3(0x15d)+_0x3988c6['id']);return;}const _0x59aa30={'event':_0x258295,'payment':{'id':_0x3bca11['id'],'order_id':_0x3bca11[_0x117ee3(0xda)],'gateway_order_id':_0x3bca11[_0x117ee3(0xc0)],'gateway':_0x117ee3(0x16a),'amount':_0x3bca11[_0x117ee3(0x156)],'currency':_0x3bca11['currency'],'status':_0x2ca184['toLowerCase'](),'customer_email':_0x3bca11[_0x117ee3(0xb2)],'customer_name':_0x3bca11[_0x117ee3(0xdf)],'created_at':_0x3bca11[_0x117ee3(0x133)],'updated_at':new Date()}},_0x5e5c0a=await fetch(_0x4d8da5[_0x117ee3(0xc6)],{'method':_0x117ee3(0xeb),'headers':{'Content-Type':'application/json','User-Agent':_0x117ee3(0xe8)},'body':JSON[_0x117ee3(0x120)](_0x59aa30)}),_0xc8ec15=Date['now']()-_0x45b756;loggerService_1['loggerService'][_0x117ee3(0x19d)](_0x3bca11[_0x117ee3(0xc8)],_0x4d8da5[_0x117ee3(0xc6)],_0x258295,_0x5e5c0a['status'],_0xc8ec15,_0x59aa30),console['log'](_0x117ee3(0x19a)+_0x4d8da5[_0x117ee3(0xc6)]+_0x117ee3(0x15b)+_0x5e5c0a[_0x117ee3(0x160)]+'\x20('+_0xc8ec15+_0x117ee3(0x13d));}catch(_0x18cd27){console[_0x117ee3(0x179)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x18cd27),loggerService_1[_0x117ee3(0x102)][_0x117ee3(0xba)](_0x3bca11['shopId'],_0x3bca11[_0x117ee3(0x13b)]?.[_0x117ee3(0xe5)]?.[_0x117ee3(0xc6)]||_0x117ee3(0x147),_0x117ee3(0x11f),_0x18cd27,{});}}[a42_0x2254b2(0x12c)](_0xedbb16){const _0x43329f=a42_0x2254b2,_0x32b5d9=_0xedbb16['replace'](/[\s-]/g,'');if(_0x32b5d9[_0x43329f(0xdc)]<0x4)return'****';return _0x43329f(0xcb)+_0x32b5d9[_0x43329f(0xe1)](-0x4);}async[a42_0x2254b2(0xee)](_0x42c46a){const _0x2c4027=a42_0x2254b2;console[_0x2c4027(0x15f)](_0x2c4027(0x15a),_0x42c46a);let _0x2249e3=_0x2c4027(0xb4);if(_0x42c46a[_0x2c4027(0x160)]===0x1&&_0x42c46a[_0x2c4027(0x13a)]===0x1)_0x2249e3='PAID';else _0x42c46a[_0x2c4027(0x160)]===0x0&&_0x42c46a[_0x2c4027(0x13a)]===0x0?_0x2249e3='PENDING':_0x2249e3=_0x2c4027(0x108);return{'paymentId':_0x42c46a[_0x2c4027(0x1a0)]||'','status':_0x2249e3,'amount':_0x42c46a[_0x2c4027(0x156)],'currency':_0x42c46a[_0x2c4027(0x116)]};}[a42_0x2254b2(0xb7)](){const _0x2e6e19=a42_0x2254b2;console['log'](_0x2e6e19(0x14a));const _0x457ebf=this[_0x2e6e19(0xd1)][_0x2e6e19(0x17a)];for(const [_0x25224a]of this[_0x2e6e19(0xd1)]){this['clearStatusTimers'](_0x25224a);}console[_0x2e6e19(0x15f)](_0x2e6e19(0x135)+_0x457ebf+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a42_0x2254b2(0xb1)]=MasterCardService;