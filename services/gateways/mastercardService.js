'use strict';const a42_0x2a6277=a42_0x43ae;(function(_0x59be3e,_0x4ce5e1){const _0x24171c=a42_0x43ae,_0x150d71=_0x59be3e();while(!![]){try{const _0x59bd59=-parseInt(_0x24171c(0xef))/0x1+-parseInt(_0x24171c(0x129))/0x2*(-parseInt(_0x24171c(0x100))/0x3)+parseInt(_0x24171c(0xe0))/0x4*(parseInt(_0x24171c(0x12e))/0x5)+parseInt(_0x24171c(0x19e))/0x6*(-parseInt(_0x24171c(0x152))/0x7)+parseInt(_0x24171c(0xd8))/0x8+-parseInt(_0x24171c(0x138))/0x9+parseInt(_0x24171c(0x111))/0xa;if(_0x59bd59===_0x4ce5e1)break;else _0x150d71['push'](_0x150d71['shift']());}catch(_0x54d105){_0x150d71['push'](_0x150d71['shift']());}}}(a42_0x48a6,0x89a92));function a42_0x48a6(){const _0x507573=['cwd','❌\x20Data\x20being\x20signed:','logShopWebhookSent','encryptAES',',\x20Desc:\x20','utf8','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','****\x20****\x20****\x20','🔐\x20Public\x20key\x20path:','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','settings','Response\x20Time:','create','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','description','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','\x20not\x20enabled\x20for\x20shop\x20','randomBytes','../../config/database','toUpperCase','defineProperty','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','7tGgjai','MasterCard:\x20','validateKeyFiles','privateDecrypt','PAID','statusCheckTimers','\x20status\x20timers\x20for\x20payment\x20','size','🔐\x20AES\x20key\x20and\x20IV\x20generated','decryptAES','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','updatePaymentStatus','3DS\x20URL:','✅\x20Status\x20response\x20decrypted\x20successfully','Unknown\x20error','aes-256-ctr','customerName','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','desc','publicEncrypt','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','stopAllStatusChecks','stringify','orderId','merchantPointId','length','__esModule','decryptResponse','../telegramBotService','readFileSync','gatewayOrderId','sendShopWebhook','clearStatusTimers','loggerService','hasOwnProperty','Final:','base64','logShopWebhookError','\x20for\x20payment\x20','log','...','expire_year','now','POST','💳\x20MasterCard\x20service\x20initialized','encryptRSA','toString','/charge_decrypted','parse','charge','scheduleStatusChecks','PENDING','replace','\x20\x20\x20-\x20merchant_point_id:','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','floor','RSA_PKCS1_PADDING','isArray','system','📝\x20Data\x20to\x20sign\x20length:','createSign','__setModuleDefault','psp_public.pem','set','path','\x20\x20\x20-\x20info\x20length:','📝\x20Encrypted\x20key\x20length:','json','Amount:','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','shopId','privateKeyPath','private.pem','TesSoft\x20Payment\x20System/1.0','payment','6711090DaUwMu','🔐\x20Data\x20encrypted\x20with\x20AES','webhookEvents','writable','📊\x20Status\x20check\x20result:','sign','🔐\x20Public\x20key\x20length:\x20','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','includes','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','🔐\x203DS\x20verification\x20required','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','Failed\x20to\x20send\x20payment\x20notifications:','\x20with\x20status\x20','Order\x20ID:','getOwnPropertyNames','HTTP\x20Status:','Return\x20URL:','ms)','Decryption\x20failed:\x20','/status','number','\x20MasterCard\x20status\x20check\x20timers','substring','failed','\x20characters','FAILED','📝\x20Data\x20length:','then','join','crypto','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','logWhiteDomainResponse','update','maskCardNumber','final','cvv','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','logWhiteDomainError','none','publicKeyPath','2678256pGNLsR','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','end','processWebhook','toLowerCase','Public\x20key\x20file\x20not\x20found:\x20','message','801132jTvFCf','customerEmail','info','adminNotes','trim','Payment\x20ID:','📊\x20Status\x20check\x20#','application/json','🔐\x20Private\x20key\x20path:','date_success','webhook_send','amount','/charge_raw','📝\x20Signature\x20length:','expire_month','851265cmCizU','🔐\x20Data\x20signed\x20with\x20RSA','HTTP\x20','Error\x20details:','❌\x20MasterCard\x20key\x20validation\x20failed:','error',',\x20Final:\x20','constants','Webhook\x20event\x20','payment_id','unknown','checkPaymentStatus','default','💾\x20Payment\x20data\x20prepared','PHP\x20decryptor\x20error','✅\x20Payment\x20successful','sendPaymentNotification','6wjxTXn','first_name','/charge_decrypt','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','status','getOwnPropertyDescriptor',',\x20body:\x20','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','createdAt','3ds_url','🔐\x20AES\x20IV\x20length:','call','HTTP\x20error!\x20status:\x20','configurable','processCardPayment','/status_decrypted','\x20is\x20final\x20(','12544690CDIiEs','existsSync','signRSA','🛑\x20Stopped\x20','\x20status\x20checks\x20for\x20payment\x20','logWhiteDomainRequest','Failed\x20to\x20decrypt\x20response','last_name','\x20\x20\x20-\x20sign\x20length:','apiUrl','🔐\x20RSA\x20signing\x20successful','generateAESKey','payment.failed','🧹\x20Clearing\x20','sendPaymentNotifications','keys','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','resolve','currency','text','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','Failed\x20to\x20send\x20MasterCard\x20webhook:','-----END','mastercard','665534lTeRem','decryptResponsePhp','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','key','/charge','15ratgTl','\x20status\x20updated\x20to\x20','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','../loggerService','shop','webhookUrl','-----BEGIN','createDecipheriv','get','2897964TsjFPZ','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','Processing\x20MasterCard\x20webhook:','from'];a42_0x48a6=function(){return _0x507573;};return a42_0x48a6();}function a42_0x43ae(_0x3c66df,_0x47511e){const _0x48a61c=a42_0x48a6();return a42_0x43ae=function(_0x43ae07,_0x421154){_0x43ae07=_0x43ae07-0xb3;let _0x1d22f6=_0x48a61c[_0x43ae07];return _0x1d22f6;},a42_0x43ae(_0x3c66df,_0x47511e);}var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x55adb4,_0x491d8c,_0x5afb48,_0x2b03ad){const _0x5870d6=a42_0x43ae;if(_0x2b03ad===undefined)_0x2b03ad=_0x5afb48;var _0x4443b8=Object[_0x5870d6(0x105)](_0x491d8c,_0x5afb48);(!_0x4443b8||(_0x5870d6(0x137)in _0x4443b8?!_0x491d8c[_0x5870d6(0x16c)]:_0x4443b8[_0x5870d6(0x1a1)]||_0x4443b8[_0x5870d6(0x10d)]))&&(_0x4443b8={'enumerable':!![],'get':function(){return _0x491d8c[_0x5afb48];}}),Object['defineProperty'](_0x55adb4,_0x2b03ad,_0x4443b8);}:function(_0xa342f9,_0xecfc32,_0x2e77cb,_0x5e6f71){if(_0x5e6f71===undefined)_0x5e6f71=_0x2e77cb;_0xa342f9[_0x5e6f71]=_0xecfc32[_0x2e77cb];}),__setModuleDefault=this&&this[a42_0x2a6277(0x18f)]||(Object[a42_0x2a6277(0x148)]?function(_0x3fd65d,_0x52d621){const _0x26c8b7=a42_0x2a6277;Object[_0x26c8b7(0x150)](_0x3fd65d,_0x26c8b7(0xfb),{'enumerable':!![],'value':_0x52d621});}:function(_0xba5e00,_0x2f1597){const _0xac0bd7=a42_0x2a6277;_0xba5e00[_0xac0bd7(0xfb)]=_0x2f1597;}),__importStar=this&&this['__importStar']||(function(){var _0xcd1378=function(_0x515282){const _0x44b3a9=a42_0x43ae;return _0xcd1378=Object[_0x44b3a9(0xbe)]||function(_0x550e1d){const _0x1231f3=_0x44b3a9;var _0x40888f=[];for(var _0x10e658 in _0x550e1d)if(Object['prototype'][_0x1231f3(0x174)][_0x1231f3(0x10b)](_0x550e1d,_0x10e658))_0x40888f[_0x40888f[_0x1231f3(0x16b)]]=_0x10e658;return _0x40888f;},_0xcd1378(_0x515282);};return function(_0x22ef23){const _0x389655=a42_0x43ae;if(_0x22ef23&&_0x22ef23[_0x389655(0x16c)])return _0x22ef23;var _0x2f86cf={};if(_0x22ef23!=null){for(var _0x2999da=_0xcd1378(_0x22ef23),_0x325dfc=0x0;_0x325dfc<_0x2999da[_0x389655(0x16b)];_0x325dfc++)if(_0x2999da[_0x325dfc]!==_0x389655(0xfb))__createBinding(_0x2f86cf,_0x22ef23,_0x2999da[_0x325dfc]);}return __setModuleDefault(_0x2f86cf,_0x22ef23),_0x2f86cf;};}()),__importDefault=this&&this['__importDefault']||function(_0x201f6f){const _0x26fe26=a42_0x2a6277;return _0x201f6f&&_0x201f6f[_0x26fe26(0x16c)]?_0x201f6f:{'default':_0x201f6f};};Object[a42_0x2a6277(0x150)](exports,a42_0x2a6277(0x16c),{'value':!![]}),exports['MasterCardService']=void 0x0;const crypto_1=__importDefault(require(a42_0x2a6277(0xcd))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x2a6277(0x192))),loggerService_1=require(a42_0x2a6277(0x132));class MasterCardService{constructor(){const _0x47f2c3=a42_0x2a6277;this[_0x47f2c3(0x157)]=new Map(),this['apiUrl']='https://api.paydmeth.com/api',this['merchantPointId']=0x67c,this[_0x47f2c3(0x19a)]=path_1[_0x47f2c3(0xfb)][_0x47f2c3(0xcc)](process[_0x47f2c3(0x13c)](),_0x47f2c3(0x120),_0x47f2c3(0x19b)),this[_0x47f2c3(0xd7)]=path_1[_0x47f2c3(0xfb)][_0x47f2c3(0xcc)](process[_0x47f2c3(0x13c)](),_0x47f2c3(0x120),_0x47f2c3(0x190)),console['log'](_0x47f2c3(0x17e)),console[_0x47f2c3(0x179)](_0x47f2c3(0xe8),this[_0x47f2c3(0x19a)]),console[_0x47f2c3(0x179)](_0x47f2c3(0x144),this[_0x47f2c3(0xd7)]),this[_0x47f2c3(0x154)]();}[a42_0x2a6277(0x154)](){const _0x58782d=a42_0x2a6277;try{if(!fs_1[_0x58782d(0xfb)]['existsSync'](this['privateKeyPath']))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this[_0x58782d(0x19a)]);if(!fs_1['default'][_0x58782d(0x112)](this[_0x58782d(0xd7)]))throw new Error(_0x58782d(0xde)+this[_0x58782d(0xd7)]);const _0x446883=fs_1['default']['readFileSync'](this[_0x58782d(0x19a)],_0x58782d(0x141))[_0x58782d(0xe4)](),_0x4fb13d=fs_1[_0x58782d(0xfb)][_0x58782d(0x16f)](this['publicKeyPath'],_0x58782d(0x141))['trim']();if(!_0x446883[_0x58782d(0xb7)]('-----BEGIN')||!_0x446883[_0x58782d(0xb7)]('-----END'))throw new Error('Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x4fb13d[_0x58782d(0xb7)](_0x58782d(0x135))||!_0x4fb13d[_0x58782d(0xb7)](_0x58782d(0x127)))throw new Error('Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x58782d(0x179)](_0x58782d(0x145)),console['log']('🔐\x20Private\x20key\x20length:\x20'+_0x446883[_0x58782d(0x16b)]+_0x58782d(0xc8)),console['log'](_0x58782d(0xb5)+_0x4fb13d[_0x58782d(0x16b)]+_0x58782d(0xc8));}catch(_0x71c516){console[_0x58782d(0xf4)](_0x58782d(0xf3),_0x71c516);throw _0x71c516;}}['generateAESKey'](){const _0x4350da=a42_0x2a6277,_0x2a2c3f=crypto_1[_0x4350da(0xfb)][_0x4350da(0x14d)](0x20),_0x5f4112=crypto_1[_0x4350da(0xfb)][_0x4350da(0x14d)](0x10);return{'key':_0x2a2c3f,'iv':_0x5f4112};}[a42_0x2a6277(0x13f)](_0x4656f0,_0x31a973,_0xf4277){const _0x4b4561=a42_0x2a6277,_0x525543=crypto_1['default']['createCipheriv']('aes-256-ctr',_0x31a973,_0xf4277);let _0xdfa683=_0x525543[_0x4b4561(0xd0)](_0x4656f0,'utf8',_0x4b4561(0x176));return _0xdfa683+=_0x525543[_0x4b4561(0xd2)](_0x4b4561(0x176)),_0xdfa683;}[a42_0x2a6277(0x17f)](_0x2bc76a,_0x2a9631){const _0x1fa58e=a42_0x2a6277;try{const _0x317ae5=fs_1[_0x1fa58e(0xfb)][_0x1fa58e(0x16f)](this[_0x1fa58e(0xd7)],_0x1fa58e(0x141))[_0x1fa58e(0xe4)](),_0x1b3e9b={'iv':_0x2a9631['toString'](_0x1fa58e(0x176)),'key':_0x2bc76a[_0x1fa58e(0x180)]('base64')},_0x211150=JSON[_0x1fa58e(0x168)](_0x1b3e9b);console[_0x1fa58e(0x179)](_0x1fa58e(0xda),_0x211150[_0x1fa58e(0x16b)]);const _0x27221b=crypto_1[_0x1fa58e(0xfb)][_0x1fa58e(0x165)]({'key':_0x317ae5,'padding':crypto_1[_0x1fa58e(0xfb)][_0x1fa58e(0xf6)][_0x1fa58e(0x18a)]},Buffer['from'](_0x211150));return console['log']('✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x27221b[_0x1fa58e(0x16b)]),_0x27221b[_0x1fa58e(0x180)](_0x1fa58e(0x176));}catch(_0xcafaba){console[_0x1fa58e(0xf4)]('❌\x20RSA\x20encryption\x20failed:',_0xcafaba);throw new Error(_0x1fa58e(0x142));}}[a42_0x2a6277(0x113)](_0x227539){const _0x58a8f2=a42_0x2a6277;try{const _0x396d3f=fs_1[_0x58a8f2(0xfb)][_0x58a8f2(0x16f)](this[_0x58a8f2(0x19a)],'utf8')[_0x58a8f2(0xe4)](),_0x351136=crypto_1[_0x58a8f2(0xfb)][_0x58a8f2(0x18e)]('SHA256');_0x351136[_0x58a8f2(0xd0)](_0x227539),_0x351136[_0x58a8f2(0xdb)]();const _0x1775fe=_0x351136[_0x58a8f2(0xb4)](_0x396d3f,_0x58a8f2(0x176));return console[_0x58a8f2(0x179)](_0x58a8f2(0x11b)),console[_0x58a8f2(0x179)](_0x58a8f2(0x18d),_0x227539['length']),console['log'](_0x58a8f2(0xed),_0x1775fe['length']),_0x1775fe;}catch(_0x305892){console[_0x58a8f2(0xf4)]('❌\x20RSA\x20signing\x20failed:',_0x305892),console[_0x58a8f2(0xf4)](_0x58a8f2(0x13d),_0x227539[_0x58a8f2(0xc6)](0x0,0xc8)+_0x58a8f2(0x17a));throw new Error(_0x58a8f2(0xce));}}[a42_0x2a6277(0x15b)](_0x30f5de,_0x20fecb,_0x1d7a71){const _0x302cc9=a42_0x2a6277,_0x134527=crypto_1[_0x302cc9(0xfb)][_0x302cc9(0x136)](_0x302cc9(0x161),_0x20fecb,_0x1d7a71);let _0x324d37=_0x134527[_0x302cc9(0xd0)](_0x30f5de,_0x302cc9(0x176),_0x302cc9(0x141));return _0x324d37+=_0x134527[_0x302cc9(0xd2)](_0x302cc9(0x141)),_0x324d37;}async[a42_0x2a6277(0x12a)](_0x481c62,_0x158ef2){const _0x4cbabe=a42_0x2a6277;try{const _0x429b08=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x4cbabe(0x17d),'headers':{'Content-Type':_0x4cbabe(0xe7)},'body':JSON[_0x4cbabe(0x168)]({'info':_0x481c62,'key':_0x158ef2})});if(!_0x429b08['ok'])throw new Error(_0x4cbabe(0xfd));return await _0x429b08[_0x4cbabe(0x124)]();}catch(_0x54bbda){console['error']('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x54bbda);throw new Error(_0x4cbabe(0xba));}}[a42_0x2a6277(0x16d)](_0x3914a7,_0xd67042){const _0x6f508a=a42_0x2a6277;try{const _0x4f4741=fs_1[_0x6f508a(0xfb)][_0x6f508a(0x16f)](this[_0x6f508a(0x19a)],'utf8')['trim'](),_0x425747=crypto_1[_0x6f508a(0xfb)][_0x6f508a(0x155)](_0x4f4741,Buffer[_0x6f508a(0x13b)](_0xd67042,_0x6f508a(0x176))),_0x26f449=JSON[_0x6f508a(0x182)](_0x425747[_0x6f508a(0x180)]()),_0x3ebdc3=Buffer[_0x6f508a(0x13b)](_0x26f449[_0x6f508a(0x12c)],_0x6f508a(0x176)),_0x39d0c4=Buffer['from'](_0x26f449['iv'],_0x6f508a(0x176));return this[_0x6f508a(0x15b)](_0x3914a7,_0x3ebdc3,_0x39d0c4);}catch(_0x3cac4d){throw new Error(_0x6f508a(0x117));}}async[a42_0x2a6277(0x10e)](_0x5f099f){const _0x1eae4a=a42_0x2a6277,{paymentId:_0x375104,orderId:_0x2d5c97,amount:_0x51f50f,currency:_0x1be40f,cardData:_0x35b9d2,resultUrl:_0x48b767,returnUrl:_0x41e3e6,cardHolder:_0x148574,browser:_0x5bbd9f}=_0x5f099f;console[_0x1eae4a(0x179)](_0x1eae4a(0x197)),console[_0x1eae4a(0x179)](_0x1eae4a(0xe5),_0x375104),console[_0x1eae4a(0x179)](_0x1eae4a(0xbd),_0x2d5c97),console[_0x1eae4a(0x179)](_0x1eae4a(0x196),_0x51f50f,_0x1be40f),console[_0x1eae4a(0x179)]('Card\x20Number:',this[_0x1eae4a(0xd1)](_0x35b9d2[_0x1eae4a(0xc4)])),console['log']('Card\x20Holder:',_0x148574[_0x1eae4a(0x101)]+'\x20'+_0x148574[_0x1eae4a(0x118)]),console['log'](_0x1eae4a(0xc0),_0x41e3e6),console[_0x1eae4a(0x179)]('Result\x20URL:',_0x48b767);const _0xa9c2a2={'amount':_0x51f50f,'currency':_0x1be40f[_0x1eae4a(0x14f)](),'order_id':_0x2d5c97,'result_url':_0x48b767,'return_url':_0x41e3e6,'card':{'number':_0x35b9d2[_0x1eae4a(0xc4)],'expire_month':_0x35b9d2[_0x1eae4a(0xee)],'expire_year':_0x35b9d2[_0x1eae4a(0x17b)],'cvv':_0x35b9d2[_0x1eae4a(0xd3)]},'card_holder':_0x148574,'browser':_0x5bbd9f},_0x5ebcb2=JSON['stringify'](_0xa9c2a2);console['log'](_0x1eae4a(0xfc)),console[_0x1eae4a(0x179)](_0x1eae4a(0x121)),console[_0x1eae4a(0x179)](_0x5ebcb2),console[_0x1eae4a(0x179)](_0x1eae4a(0xca),_0x5ebcb2[_0x1eae4a(0x16b)]);try{const {key:_0x448c3c,iv:_0x14df49}=this['generateAESKey']();console[_0x1eae4a(0x179)](_0x1eae4a(0x15a)),console['log']('🔐\x20AES\x20key\x20length:',_0x448c3c[_0x1eae4a(0x16b)]),console['log'](_0x1eae4a(0x10a),_0x14df49[_0x1eae4a(0x16b)]);const _0x2b74f2=this[_0x1eae4a(0x13f)](_0x5ebcb2,_0x448c3c,_0x14df49);console[_0x1eae4a(0x179)](_0x1eae4a(0x19f)),console['log']('📝\x20Encrypted\x20data\x20length:',_0x2b74f2[_0x1eae4a(0x16b)]);const _0x30016d=this[_0x1eae4a(0x17f)](_0x448c3c,_0x14df49);console['log'](_0x1eae4a(0x131)),console[_0x1eae4a(0x179)](_0x1eae4a(0x194),_0x30016d[_0x1eae4a(0x16b)]);const _0x30cbe0=this[_0x1eae4a(0x113)](_0x5ebcb2);console[_0x1eae4a(0x179)](_0x1eae4a(0xf0)),console[_0x1eae4a(0x179)]('📝\x20Signature\x20length:',_0x30cbe0[_0x1eae4a(0x16b)]);const _0x4c3558={'merchant_point_id':this[_0x1eae4a(0x16a)],'method':_0x1eae4a(0x183),'info':_0x2b74f2,'key':_0x30016d,'sign':_0x30cbe0,'lang':'en'};console[_0x1eae4a(0x179)](_0x1eae4a(0x166)),console[_0x1eae4a(0x179)]('📝\x20Final\x20request\x20structure:'),console[_0x1eae4a(0x179)](_0x1eae4a(0x187),this[_0x1eae4a(0x16a)]),console[_0x1eae4a(0x179)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x1eae4a(0x179)](_0x1eae4a(0x193),_0x2b74f2[_0x1eae4a(0x16b)]),console['log']('\x20\x20\x20-\x20key\x20length:',_0x30016d['length']),console['log'](_0x1eae4a(0x119),_0x30cbe0[_0x1eae4a(0x16b)]),console[_0x1eae4a(0x179)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x1eae4a(0x173)][_0x1eae4a(0x116)](_0x1eae4a(0x128),_0x1eae4a(0x12d),'POST',{'merchant_point_id':this[_0x1eae4a(0x16a)],'method':_0x1eae4a(0x183),'lang':'en'});const _0x55b49f=Date[_0x1eae4a(0x17c)](),_0x49c3bc=await fetch(this[_0x1eae4a(0x11a)],{'method':_0x1eae4a(0x17d),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x1eae4a(0x19c)},'body':JSON[_0x1eae4a(0x168)](_0x4c3558)}),_0x163626=Date[_0x1eae4a(0x17c)]()-_0x55b49f;console[_0x1eae4a(0x179)](_0x1eae4a(0xd9)),console[_0x1eae4a(0x179)]('Status:',_0x49c3bc[_0x1eae4a(0x104)]),console['log'](_0x1eae4a(0x147),_0x163626+'ms');if(!_0x49c3bc['ok']){const _0x4f06d7=await _0x49c3bc[_0x1eae4a(0x124)]();console['error'](_0x1eae4a(0xbf),_0x49c3bc[_0x1eae4a(0x104)]),console[_0x1eae4a(0xf4)]('Response\x20Body:',_0x4f06d7),loggerService_1['loggerService'][_0x1eae4a(0xcf)](_0x1eae4a(0x128),_0x1eae4a(0xec),_0x49c3bc[_0x1eae4a(0x104)],_0x4f06d7,_0x163626),loggerService_1[_0x1eae4a(0x173)][_0x1eae4a(0xd5)](_0x1eae4a(0x128),_0x1eae4a(0x12d),_0x1eae4a(0xf1)+_0x49c3bc[_0x1eae4a(0x104)]+':\x20'+_0x4f06d7);throw new Error(_0x1eae4a(0x10c)+_0x49c3bc[_0x1eae4a(0x104)]+_0x1eae4a(0x106)+_0x4f06d7);}const _0x41cc50=await _0x49c3bc[_0x1eae4a(0x195)]();loggerService_1[_0x1eae4a(0x173)][_0x1eae4a(0xcf)]('mastercard','/charge_raw',_0x49c3bc[_0x1eae4a(0x104)],_0x41cc50,_0x163626),console[_0x1eae4a(0x179)](_0x1eae4a(0x103));let _0x18a438=_0x41cc50;if(_0x41cc50[_0x1eae4a(0xe2)]&&_0x41cc50[_0x1eae4a(0x12c)]&&_0x41cc50[_0x1eae4a(0xb4)]){console[_0x1eae4a(0x179)](_0x1eae4a(0x125));try{const _0x4e54c7=await this[_0x1eae4a(0x12a)](_0x41cc50[_0x1eae4a(0xe2)],_0x41cc50['key']);_0x18a438=JSON[_0x1eae4a(0x182)](_0x4e54c7),console[_0x1eae4a(0x179)]('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0x1eae4a(0x173)][_0x1eae4a(0xcf)](_0x1eae4a(0x128),_0x1eae4a(0x181),_0x49c3bc[_0x1eae4a(0x104)],_0x18a438,_0x163626),console[_0x1eae4a(0x179)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x55fa6b){console['error'](_0x1eae4a(0x188),_0x55fa6b),loggerService_1[_0x1eae4a(0x173)][_0x1eae4a(0xd5)](_0x1eae4a(0x128),_0x1eae4a(0x102),_0x1eae4a(0xc2)+_0x55fa6b),_0x18a438=_0x41cc50;}}else loggerService_1[_0x1eae4a(0x173)][_0x1eae4a(0xcf)](_0x1eae4a(0x128),'/charge_decrypted',_0x49c3bc[_0x1eae4a(0x104)],_0x18a438,_0x163626),console[_0x1eae4a(0x179)](_0x1eae4a(0xd4));console[_0x1eae4a(0x179)]('Status:',_0x18a438[_0x1eae4a(0x104)]),console[_0x1eae4a(0x179)](_0x1eae4a(0x175),_0x18a438[_0x1eae4a(0xd2)]),console[_0x1eae4a(0x179)](_0x1eae4a(0xe5),_0x18a438[_0x1eae4a(0xf8)]),console[_0x1eae4a(0x179)](_0x1eae4a(0x15e),_0x18a438[_0x1eae4a(0x109)]||_0x1eae4a(0xd6));if(_0x18a438[_0x1eae4a(0x104)]===0x64&&_0x18a438[_0x1eae4a(0xd2)]===0x1)return console[_0x1eae4a(0x179)](_0x1eae4a(0xfe)),{'gateway_payment_id':_0x18a438[_0x1eae4a(0xf8)]?.[_0x1eae4a(0x180)](),'payment_url':_0x41e3e6,'requires_3ds':![],'status':_0x1eae4a(0x156),'final':!![]};if(_0x18a438[_0x1eae4a(0x109)])return console['log'](_0x1eae4a(0xb9)),this[_0x1eae4a(0x184)](_0x375104,_0x2d5c97,_0x18a438['payment_id']?.[_0x1eae4a(0x180)]()||_0x2d5c97),{'gateway_payment_id':_0x18a438[_0x1eae4a(0xf8)]?.[_0x1eae4a(0x180)](),'payment_url':_0x18a438['3ds_url'],'requires_3ds':!![],'threeds_url':_0x18a438[_0x1eae4a(0x109)],'status':_0x1eae4a(0x185),'final':![]};let _0x190fdc=_0x18a438[_0x1eae4a(0x164)]||_0x18a438[_0x1eae4a(0xdf)]||'Unknown\x20error',_0x1be7ad=_0x18a438['status'],_0x4431f3=_0x18a438[_0x1eae4a(0xd2)];return console[_0x1eae4a(0x179)](_0x1eae4a(0xb8)+_0x1be7ad+_0x1eae4a(0xf5)+_0x4431f3+_0x1eae4a(0x140)+_0x190fdc),{'gateway_payment_id':_0x18a438[_0x1eae4a(0xf8)]?.[_0x1eae4a(0x180)](),'payment_url':_0x41e3e6,'requires_3ds':![],'status':'FAILED','final':!![]};}catch(_0x45177b){console[_0x1eae4a(0xf4)](_0x1eae4a(0x139)),console[_0x1eae4a(0xf4)](_0x1eae4a(0xf2),_0x45177b),loggerService_1[_0x1eae4a(0x173)][_0x1eae4a(0xd5)](_0x1eae4a(0x128),'/charge',_0x45177b);throw new Error(_0x1eae4a(0x12b)+(_0x45177b instanceof Error?_0x45177b[_0x1eae4a(0xdf)]:_0x1eae4a(0x160)));}}async[a42_0x2a6277(0xfa)](_0x3bdb77,_0x3c631d){const _0x3091c3=a42_0x2a6277;console[_0x3091c3(0x179)](_0x3091c3(0x151)+_0x3bdb77+'\x20('+_0x3c631d+')');try{const _0x2b39ae={'payment_id':_0x3bdb77,'order_id':_0x3c631d},_0x22cd48=JSON['stringify'](_0x2b39ae),{key:_0x592be8,iv:_0x34d445}=this[_0x3091c3(0x11c)](),_0x19f3d5=this['encryptAES'](_0x22cd48,_0x592be8,_0x34d445),_0x41a1ce=this[_0x3091c3(0x17f)](_0x592be8,_0x34d445),_0x57d575=this[_0x3091c3(0x113)](_0x22cd48),_0x32a9e6={'merchant_point_id':this[_0x3091c3(0x16a)],'method':_0x3091c3(0x104),'info':_0x19f3d5,'key':_0x41a1ce,'sign':_0x57d575,'lang':'en'};loggerService_1[_0x3091c3(0x173)][_0x3091c3(0x116)](_0x3091c3(0x128),'/status',_0x3091c3(0x17d),{'merchant_point_id':this[_0x3091c3(0x16a)],'method':_0x3091c3(0x104),'lang':'en'});const _0x1cc592=Date[_0x3091c3(0x17c)](),_0x580629=await fetch(this[_0x3091c3(0x11a)],{'method':_0x3091c3(0x17d),'headers':{'Content-Type':'application/json','Accept':_0x3091c3(0xe7),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x3091c3(0x168)](_0x32a9e6)}),_0x4038ec=Date['now']()-_0x1cc592;if(!_0x580629['ok']){const _0x5aa6a7=await _0x580629[_0x3091c3(0x124)]();loggerService_1[_0x3091c3(0x173)][_0x3091c3(0xcf)](_0x3091c3(0x128),'/status_raw',_0x580629[_0x3091c3(0x104)],_0x5aa6a7,_0x4038ec);throw new Error('HTTP\x20error!\x20status:\x20'+_0x580629[_0x3091c3(0x104)]);}const _0x107e91=await _0x580629[_0x3091c3(0x195)]();loggerService_1['loggerService'][_0x3091c3(0xcf)](_0x3091c3(0x128),'/status_raw',_0x580629[_0x3091c3(0x104)],_0x107e91,_0x4038ec);let _0x24bb12=_0x107e91;if(_0x107e91[_0x3091c3(0xe2)]&&_0x107e91['key']&&_0x107e91[_0x3091c3(0xb4)]){console['log'](_0x3091c3(0x14b));try{const _0x234eb1=this[_0x3091c3(0x16d)](_0x107e91[_0x3091c3(0xe2)],_0x107e91[_0x3091c3(0x12c)]);_0x24bb12=JSON['parse'](_0x234eb1),console['log'](_0x3091c3(0x15f)),loggerService_1[_0x3091c3(0x173)]['logWhiteDomainResponse'](_0x3091c3(0x128),_0x3091c3(0x10f),_0x580629['status'],_0x24bb12,_0x4038ec),console[_0x3091c3(0x179)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x4e5d66){console['error'](_0x3091c3(0x198),_0x4e5d66),loggerService_1[_0x3091c3(0x173)][_0x3091c3(0xd5)](_0x3091c3(0x128),'/status_decrypt','Status\x20decryption\x20failed:\x20'+_0x4e5d66),_0x24bb12=_0x107e91;}}else loggerService_1[_0x3091c3(0x173)][_0x3091c3(0xcf)](_0x3091c3(0x128),_0x3091c3(0x10f),_0x580629[_0x3091c3(0x104)],_0x24bb12,_0x4038ec),console[_0x3091c3(0x179)](_0x3091c3(0x149));console[_0x3091c3(0x179)](_0x3091c3(0xb3),{'status':_0x24bb12[_0x3091c3(0x104)],'final':_0x24bb12[_0x3091c3(0xd2)],'payment_id':_0x24bb12[_0x3091c3(0xf8)],'desc':_0x24bb12[_0x3091c3(0x164)]});let _0xb66134=_0x3091c3(0x185);if(_0x24bb12['status']===0x1&&_0x24bb12[_0x3091c3(0xd2)]===0x1)_0xb66134=_0x3091c3(0x156);else _0x24bb12[_0x3091c3(0x104)]===0x0&&_0x24bb12[_0x3091c3(0xd2)]===0x0?_0xb66134='PENDING':_0xb66134=_0x3091c3(0xc9);return{'status':_0xb66134,'final':_0x24bb12[_0x3091c3(0xd2)]===0x1,'amount':_0x24bb12[_0x3091c3(0xeb)],'currency':_0x24bb12[_0x3091c3(0x123)],'date_success':_0x24bb12[_0x3091c3(0xe9)],'description':_0x24bb12['desc']};}catch(_0x261e3f){console[_0x3091c3(0xf4)]('MasterCard\x20status\x20check\x20error:',_0x261e3f),loggerService_1['loggerService'][_0x3091c3(0xd5)]('mastercard',_0x3091c3(0xc3),_0x261e3f);throw new Error(_0x3091c3(0x107)+(_0x261e3f instanceof Error?_0x261e3f[_0x3091c3(0xdf)]:_0x3091c3(0x160)));}}[a42_0x2a6277(0x184)](_0x2b4906,_0x2873b6,_0x4d2fc7){const _0x38240e=a42_0x2a6277;console[_0x38240e(0x179)](_0x38240e(0xb6)+_0x2b4906+'\x20('+_0x4d2fc7+')'),this[_0x38240e(0x172)](_0x2b4906);const _0x2726af=[],_0x23f97b=0x5*0x3c*0x3e8,_0x2cf033=0x2*0x3c*0x3c*0x3e8,_0x35f1f4=Math[_0x38240e(0x189)](_0x2cf033/_0x23f97b);console['log']('⏰\x20Will\x20check\x20status\x20'+_0x35f1f4+_0x38240e(0x130));for(let _0x22c99a=0x1;_0x22c99a<=_0x35f1f4;_0x22c99a++){const _0x1ebe20=setTimeout(async()=>{const _0x984a1a=_0x38240e;console['log']('🔍\x20MasterCard\x20status\x20check\x20#'+_0x22c99a+'/'+_0x35f1f4+_0x984a1a(0x178)+_0x2b4906);try{const _0x4e4a98=await this[_0x984a1a(0xfa)](_0x4d2fc7,_0x2873b6);console['log'](_0x984a1a(0xe6)+_0x22c99a+'\x20result:',_0x4e4a98),_0x4e4a98['final']&&(console['log']('✅\x20Payment\x20'+_0x2b4906+_0x984a1a(0x110)+_0x4e4a98[_0x984a1a(0x104)]+'),\x20stopping\x20status\x20checks'),this['clearStatusTimers'](_0x2b4906),await this[_0x984a1a(0x15d)](_0x2b4906,_0x4e4a98[_0x984a1a(0x104)],_0x4e4a98));}catch(_0x345e69){console[_0x984a1a(0xf4)]('❌\x20Status\x20check\x20#'+_0x22c99a+'\x20failed\x20for\x20payment\x20'+_0x2b4906+':',_0x345e69);}},_0x22c99a*_0x23f97b);_0x2726af['push'](_0x1ebe20);}this[_0x38240e(0x157)][_0x38240e(0x191)](_0x2b4906,_0x2726af),console[_0x38240e(0x179)]('✅\x20Scheduled\x20'+_0x35f1f4+_0x38240e(0x115)+_0x2b4906);}[a42_0x2a6277(0x172)](_0x1204ea){const _0x46c9c9=a42_0x2a6277,_0x14922d=this[_0x46c9c9(0x157)][_0x46c9c9(0x137)](_0x1204ea);_0x14922d&&(console[_0x46c9c9(0x179)](_0x46c9c9(0x11e)+_0x14922d[_0x46c9c9(0x16b)]+_0x46c9c9(0x158)+_0x1204ea),_0x14922d['forEach']((_0x360802,_0x2823ea)=>{clearTimeout(_0x360802);}),this['statusCheckTimers']['delete'](_0x1204ea));}async[a42_0x2a6277(0x15d)](_0x4e941c,_0x5ec073,_0x59c5c2){const _0x440059=a42_0x2a6277;try{const _0x516f31=(await Promise[_0x440059(0x122)]()[_0x440059(0xcb)](()=>__importStar(require(_0x440059(0x14e)))))[_0x440059(0xfb)],_0x32d81c={'status':_0x5ec073['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x440059(0x18c),'statusChangedAt':new Date()};_0x5ec073===_0x440059(0x156)&&(_0x32d81c['paidAt']=new Date()),_0x59c5c2[_0x440059(0x14a)]&&(_0x32d81c[_0x440059(0xe3)]=_0x440059(0x153)+_0x59c5c2['description']),await _0x516f31[_0x440059(0x19d)][_0x440059(0xd0)]({'where':{'id':_0x4e941c},'data':_0x32d81c}),console['log']('✅\x20Payment\x20'+_0x4e941c+_0x440059(0x12f)+_0x5ec073),await this[_0x440059(0x11f)](_0x4e941c,_0x5ec073);}catch(_0x4e7ba2){console[_0x440059(0xf4)]('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x4e941c+':',_0x4e7ba2);}}async[a42_0x2a6277(0x11f)](_0x4bbfbc,_0x37f40c){const _0x21b5a5=a42_0x2a6277;try{const _0x208a0e=(await Promise[_0x21b5a5(0x122)]()[_0x21b5a5(0xcb)](()=>__importStar(require(_0x21b5a5(0x14e)))))[_0x21b5a5(0xfb)],{telegramBotService:_0x4e5ecc}=await Promise[_0x21b5a5(0x122)]()[_0x21b5a5(0xcb)](()=>__importStar(require(_0x21b5a5(0x16e)))),_0x3e5bd8=await _0x208a0e[_0x21b5a5(0x19d)]['findUnique']({'where':{'id':_0x4bbfbc},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x3e5bd8)return;const _0x24216f={'PAID':'paid','FAILED':_0x21b5a5(0xc7)},_0x293712=_0x24216f[_0x37f40c];_0x293712&&await _0x4e5ecc[_0x21b5a5(0xff)](_0x3e5bd8['shopId'],_0x3e5bd8,_0x293712),await this[_0x21b5a5(0x171)](_0x3e5bd8,_0x37f40c);}catch(_0x29c024){console['error'](_0x21b5a5(0xbb),_0x29c024);}}async[a42_0x2a6277(0x171)](_0x12985c,_0x5acd3f){const _0x25aed5=a42_0x2a6277,_0x4f5c45=Date[_0x25aed5(0x17c)]();try{const _0x376596=_0x12985c['shop'],_0x2a83b7=_0x376596['settings'];if(!_0x2a83b7?.[_0x25aed5(0x134)]){console['log'](_0x25aed5(0x15c)+_0x376596['id']);return;}const _0x49dda6=_0x5acd3f===_0x25aed5(0x156)?'payment.success':_0x25aed5(0x11d);let _0x7d4325=[];if(_0x2a83b7[_0x25aed5(0x1a0)])try{_0x7d4325=Array[_0x25aed5(0x18b)](_0x2a83b7['webhookEvents'])?_0x2a83b7[_0x25aed5(0x1a0)]:JSON[_0x25aed5(0x182)](_0x2a83b7[_0x25aed5(0x1a0)]);}catch(_0x44affa){console[_0x25aed5(0xf4)]('Error\x20parsing\x20webhook\x20events:',_0x44affa),_0x7d4325=[];}if(!_0x7d4325['includes'](_0x49dda6)){console[_0x25aed5(0x179)](_0x25aed5(0xf7)+_0x49dda6+_0x25aed5(0x14c)+_0x376596['id']);return;}const _0x327dbf={'event':_0x49dda6,'payment':{'id':_0x12985c['id'],'order_id':_0x12985c[_0x25aed5(0x169)],'gateway_order_id':_0x12985c[_0x25aed5(0x170)],'gateway':'1111','amount':_0x12985c[_0x25aed5(0xeb)],'currency':_0x12985c[_0x25aed5(0x123)],'status':_0x5acd3f[_0x25aed5(0xdd)](),'customer_email':_0x12985c[_0x25aed5(0xe1)],'customer_name':_0x12985c[_0x25aed5(0x162)],'created_at':_0x12985c[_0x25aed5(0x108)],'updated_at':new Date()}},_0x4d2569=await fetch(_0x2a83b7[_0x25aed5(0x134)],{'method':'POST','headers':{'Content-Type':_0x25aed5(0xe7),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(MasterCard)'},'body':JSON[_0x25aed5(0x168)](_0x327dbf)}),_0x3743e9=Date[_0x25aed5(0x17c)]()-_0x4f5c45;loggerService_1[_0x25aed5(0x173)][_0x25aed5(0x13e)](_0x12985c[_0x25aed5(0x199)],_0x2a83b7['webhookUrl'],_0x49dda6,_0x4d2569['status'],_0x3743e9,_0x327dbf),console['log']('MasterCard\x20webhook\x20sent\x20to\x20'+_0x2a83b7[_0x25aed5(0x134)]+_0x25aed5(0xbc)+_0x4d2569[_0x25aed5(0x104)]+'\x20('+_0x3743e9+_0x25aed5(0xc1));}catch(_0x239f2c){console[_0x25aed5(0xf4)](_0x25aed5(0x126),_0x239f2c),loggerService_1[_0x25aed5(0x173)][_0x25aed5(0x177)](_0x12985c[_0x25aed5(0x199)],_0x12985c[_0x25aed5(0x133)]?.[_0x25aed5(0x146)]?.[_0x25aed5(0x134)]||_0x25aed5(0xf9),_0x25aed5(0xea),_0x239f2c,{});}}[a42_0x2a6277(0xd1)](_0x38460f){const _0x38d442=a42_0x2a6277,_0x143836=_0x38460f[_0x38d442(0x186)](/[\s-]/g,'');if(_0x143836[_0x38d442(0x16b)]<0x4)return'****';return _0x38d442(0x143)+_0x143836['slice'](-0x4);}async[a42_0x2a6277(0xdc)](_0x2057d7){const _0x2bad4b=a42_0x2a6277;console[_0x2bad4b(0x179)](_0x2bad4b(0x13a),_0x2057d7);let _0x1b06b7='PENDING';if(_0x2057d7[_0x2bad4b(0x104)]===0x1&&_0x2057d7['final']===0x1)_0x1b06b7=_0x2bad4b(0x156);else _0x2057d7['status']===0x0&&_0x2057d7[_0x2bad4b(0xd2)]===0x0?_0x1b06b7=_0x2bad4b(0x185):_0x1b06b7='FAILED';return{'paymentId':_0x2057d7['order_id']||'','status':_0x1b06b7,'amount':_0x2057d7[_0x2bad4b(0xeb)],'currency':_0x2057d7[_0x2bad4b(0x123)]};}[a42_0x2a6277(0x167)](){const _0x328e50=a42_0x2a6277;console[_0x328e50(0x179)](_0x328e50(0x163));const _0x4485a5=this[_0x328e50(0x157)][_0x328e50(0x159)];for(const [_0x335fcb]of this[_0x328e50(0x157)]){this['clearStatusTimers'](_0x335fcb);}console[_0x328e50(0x179)](_0x328e50(0x114)+_0x4485a5+_0x328e50(0xc5));}}exports['MasterCardService']=MasterCardService;