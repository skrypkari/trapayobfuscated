'use strict';const a42_0x24fc82=a42_0x31bc;(function(_0x2bafad,_0x198793){const _0x299e34=a42_0x31bc,_0x365c9c=_0x2bafad();while(!![]){try{const _0x117fb1=-parseInt(_0x299e34(0x186))/0x1+-parseInt(_0x299e34(0x15d))/0x2+-parseInt(_0x299e34(0x15e))/0x3+-parseInt(_0x299e34(0x158))/0x4*(-parseInt(_0x299e34(0x1cc))/0x5)+parseInt(_0x299e34(0x195))/0x6*(-parseInt(_0x299e34(0x15a))/0x7)+parseInt(_0x299e34(0x181))/0x8+-parseInt(_0x299e34(0x13c))/0x9*(-parseInt(_0x299e34(0x191))/0xa);if(_0x117fb1===_0x198793)break;else _0x365c9c['push'](_0x365c9c['shift']());}catch(_0x1ec68e){_0x365c9c['push'](_0x365c9c['shift']());}}}(a42_0x332a,0xed6c0));function a42_0x31bc(_0x5e9077,_0x41c6b7){const _0x332a6c=a42_0x332a();return a42_0x31bc=function(_0x31bc2f,_0x3bf960){_0x31bc2f=_0x31bc2f-0x110;let _0x3bd297=_0x332a6c[_0x31bc2f];return _0x3bd297;},a42_0x31bc(_0x5e9077,_0x41c6b7);}var __createBinding=this&&this[a42_0x24fc82(0x1d3)]||(Object[a42_0x24fc82(0x1e1)]?function(_0x2c979b,_0x4f064d,_0x408d86,_0x509e6c){const _0x5a98e4=a42_0x24fc82;if(_0x509e6c===undefined)_0x509e6c=_0x408d86;var _0x3985e0=Object['getOwnPropertyDescriptor'](_0x4f064d,_0x408d86);(!_0x3985e0||('get'in _0x3985e0?!_0x4f064d[_0x5a98e4(0x1ae)]:_0x3985e0[_0x5a98e4(0x1e8)]||_0x3985e0[_0x5a98e4(0x1c7)]))&&(_0x3985e0={'enumerable':!![],'get':function(){return _0x4f064d[_0x408d86];}}),Object[_0x5a98e4(0x15b)](_0x2c979b,_0x509e6c,_0x3985e0);}:function(_0x4587a5,_0x284b17,_0x7dc9c2,_0x1e5aca){if(_0x1e5aca===undefined)_0x1e5aca=_0x7dc9c2;_0x4587a5[_0x1e5aca]=_0x284b17[_0x7dc9c2];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x3a72fb,_0x39c867){const _0x3a0407=a42_0x24fc82;Object[_0x3a0407(0x15b)](_0x3a72fb,_0x3a0407(0x19e),{'enumerable':!![],'value':_0x39c867});}:function(_0x1d463a,_0x1b4643){_0x1d463a['default']=_0x1b4643;}),__importStar=this&&this[a42_0x24fc82(0x121)]||(function(){var _0xf0801f=function(_0x137933){const _0x342529=a42_0x31bc;return _0xf0801f=Object[_0x342529(0x197)]||function(_0x582339){const _0xc18207=_0x342529;var _0x26a107=[];for(var _0xf776df in _0x582339)if(Object[_0xc18207(0x18a)]['hasOwnProperty'][_0xc18207(0x159)](_0x582339,_0xf776df))_0x26a107[_0x26a107['length']]=_0xf776df;return _0x26a107;},_0xf0801f(_0x137933);};return function(_0x3c2b32){const _0x5df7a8=a42_0x31bc;if(_0x3c2b32&&_0x3c2b32[_0x5df7a8(0x1ae)])return _0x3c2b32;var _0xa82396={};if(_0x3c2b32!=null){for(var _0x35744a=_0xf0801f(_0x3c2b32),_0x511e5b=0x0;_0x511e5b<_0x35744a['length'];_0x511e5b++)if(_0x35744a[_0x511e5b]!=='default')__createBinding(_0xa82396,_0x3c2b32,_0x35744a[_0x511e5b]);}return __setModuleDefault(_0xa82396,_0x3c2b32),_0xa82396;};}()),__importDefault=this&&this[a42_0x24fc82(0x149)]||function(_0x458ab3){const _0x12c733=a42_0x24fc82;return _0x458ab3&&_0x458ab3[_0x12c733(0x1ae)]?_0x458ab3:{'default':_0x458ab3};};Object[a42_0x24fc82(0x15b)](exports,a42_0x24fc82(0x1ae),{'value':!![]}),exports[a42_0x24fc82(0x142)]=void 0x0;const crypto_1=__importDefault(require(a42_0x24fc82(0x1dc))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x24fc82(0x1e2))),loggerService_1=require(a42_0x24fc82(0x1b3));function a42_0x332a(){const _0x1739b9=['application/json','orderId','HTTP\x20error!\x20status:\x20','-----BEGIN','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','order_id','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','amount','expire_month','includes','🔍\x20MasterCard\x20status\x20check\x20#','\x20characters','Payment\x20ID:','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','aes-256-ctr','settings','__importStar','1111','keys','utf8','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','...','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','logShopWebhookError','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','HTTP\x20Status:','none','\x20\x20\x20-\x20merchant_point_id:','🔐\x20AES\x20IV\x20length:','\x20for\x20payment\x20','sign','Failed\x20to\x20send\x20payment\x20notifications:','\x20status\x20updated\x20to\x20','sendShopWebhook','get','📊\x20Status\x20check\x20#','shopId','gatewayOrderId','/status_raw','Status:','publicEncrypt','generateAESKey','💾\x20Payment\x20data\x20prepared','666zmhrGu','****\x20****\x20****\x20','../telegramBotService','from','loggerService','first_name','MasterCardService','readFileSync','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','Processing\x20MasterCard\x20webhook:','Response\x20Time:','https://api2.trapay.uk/decrypt.php',',\x20Desc:\x20','__importDefault','delete','Response\x20Body:','shop','private.pem','publicKeyPath','scheduleStatusChecks','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','3ds_url','slice','expire_year','webhookEvents','❌\x20RSA\x20signing\x20failed:','failed','1659860MYZQFi','call','253729QxtUWH','defineProperty','✅\x20Scheduled\x20','3811368XbpJhX','2156733anRzOQ','webhookUrl','floor','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','PENDING','logShopWebhookSent','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','cvv','message','cwd','constants','\x20status\x20checks\x20for\x20payment\x20','Final:','📊\x20Status\x20check\x20result:','🔐\x20Private\x20key\x20length:\x20','error','📝\x20Data\x20to\x20sign\x20length:','decryptResponsePhp','❌\x20PHP\x20decryptor\x20request\x20failed:','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Failed\x20to\x20decrypt\x20response','processWebhook','length','substring','🔐\x20Public\x20key\x20length:\x20','date_success','charge','logWhiteDomainResponse','\x20\x20\x20-\x20lang:\x20en','merchantPointId','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','MasterCard\x20webhook\x20sent\x20to\x20','validateKeyFiles','toLowerCase','12262424dDAlLW','/charge','info','🔐\x20Private\x20key\x20path:','\x20\x20\x20-\x20info\x20length:','143321qWHCik','unknown','isArray','log','prototype','customerName','payment','sendPaymentNotification','✅\x20Payment\x20successful','logWhiteDomainRequest','description','261840GjvNeA','parse','createDecipheriv','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','24YYYOUn','end','getOwnPropertyNames','Public\x20key\x20file\x20not\x20found:\x20','/status_decrypted','/status','clearStatusTimers','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','\x20is\x20final\x20(','default','\x20result:','📝\x20Signature\x20length:','privateKeyPath','ms)','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','key','TesSoft\x20Payment\x20System/1.0','Order\x20ID:','existsSync','logWhiteDomainError','🧹\x20Clearing\x20','stopAllStatusChecks','createCipheriv','PAID',',\x20Final:\x20','__esModule','psp_public.pem','forEach','customerEmail','text','../loggerService','🛑\x20Stopped\x20','payment.failed','Failed\x20to\x20send\x20MasterCard\x20webhook:','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','✅\x20Payment\x20','stringify','signRSA','mastercard','join','final','\x20\x20\x20-\x20key\x20length:','MasterCard\x20status\x20check\x20error:','\x20\x20\x20-\x20sign\x20length:','webhook_send','toString','Unknown\x20error','encryptAES','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','/charge_decrypted','configurable','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','../../config/database','statusCheckTimers','trim','5YfZlUD','payment_id','push','🔐\x20Data\x20encrypted\x20with\x20AES','FAILED','SHA256','base64','__createBinding','now','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','replace','Card\x20Number:','MasterCard:\x20','decryptResponse','****','json','crypto','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','status','decryptAES',',\x20body:\x20','create','path','update','updatePaymentStatus','then','/charge_decrypt','processCardPayment','writable','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','Return\x20URL:','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','🔐\x20AES\x20key\x20and\x20IV\x20generated','POST','\x20status\x20timers\x20for\x20payment\x20','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','apiUrl','number','currency','createSign','paidAt','Webhook\x20event\x20','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','❌\x20MasterCard\x20key\x20validation\x20failed:','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','📝\x20Encrypted\x20data\x20length:','maskCardNumber','adminNotes','toUpperCase','⏰\x20Will\x20check\x20status\x20','last_name','resolve','\x20not\x20enabled\x20for\x20shop\x20','\x20failed\x20for\x20payment\x20','checkPaymentStatus','sendPaymentNotifications','encryptRSA','payment.success','/charge_raw'];a42_0x332a=function(){return _0x1739b9;};return a42_0x332a();}class MasterCardService{constructor(){const _0x118b08=a42_0x24fc82;this[_0x118b08(0x1ca)]=new Map(),this[_0x118b08(0x1f0)]='https://api.paydmeth.com/api',this['merchantPointId']=0x67c,this[_0x118b08(0x1a1)]=path_1['default']['join'](process[_0x118b08(0x167)](),_0x118b08(0x123),_0x118b08(0x14d)),this[_0x118b08(0x14e)]=path_1[_0x118b08(0x19e)][_0x118b08(0x1bc)](process[_0x118b08(0x167)](),_0x118b08(0x123),_0x118b08(0x1af)),console[_0x118b08(0x189)]('💳\x20MasterCard\x20service\x20initialized'),console['log'](_0x118b08(0x184),this['privateKeyPath']),console['log']('🔐\x20Public\x20key\x20path:',this[_0x118b08(0x14e)]),this['validateKeyFiles']();}[a42_0x24fc82(0x17f)](){const _0x20db46=a42_0x24fc82;try{if(!fs_1[_0x20db46(0x19e)][_0x20db46(0x1a7)](this[_0x20db46(0x1a1)]))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this['privateKeyPath']);if(!fs_1[_0x20db46(0x19e)]['existsSync'](this[_0x20db46(0x14e)]))throw new Error(_0x20db46(0x198)+this[_0x20db46(0x14e)]);const _0x54c1be=fs_1[_0x20db46(0x19e)][_0x20db46(0x143)](this[_0x20db46(0x1a1)],_0x20db46(0x124))[_0x20db46(0x1cb)](),_0xcb51b7=fs_1[_0x20db46(0x19e)][_0x20db46(0x143)](this[_0x20db46(0x14e)],'utf8')['trim']();if(!_0x54c1be[_0x20db46(0x119)](_0x20db46(0x113))||!_0x54c1be['includes']('-----END'))throw new Error(_0x20db46(0x171));if(!_0xcb51b7[_0x20db46(0x119)](_0x20db46(0x113))||!_0xcb51b7[_0x20db46(0x119)]('-----END'))throw new Error('Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x20db46(0x189)](_0x20db46(0x114)),console[_0x20db46(0x189)](_0x20db46(0x16c)+_0x54c1be[_0x20db46(0x175)]+_0x20db46(0x11b)),console[_0x20db46(0x189)](_0x20db46(0x177)+_0xcb51b7[_0x20db46(0x175)]+_0x20db46(0x11b));}catch(_0x5f45d4){console[_0x20db46(0x16d)](_0x20db46(0x1f7),_0x5f45d4);throw _0x5f45d4;}}[a42_0x24fc82(0x13a)](){const _0x4ca216=a42_0x24fc82,_0x13cb7f=crypto_1[_0x4ca216(0x19e)]['randomBytes'](0x20),_0x4d5a72=crypto_1[_0x4ca216(0x19e)]['randomBytes'](0x10);return{'key':_0x13cb7f,'iv':_0x4d5a72};}['encryptAES'](_0x292744,_0x32fc6e,_0x2fa22c){const _0x37fd72=a42_0x24fc82,_0x37b6e1=crypto_1[_0x37fd72(0x19e)][_0x37fd72(0x1ab)](_0x37fd72(0x11f),_0x32fc6e,_0x2fa22c);let _0x2b5bb1=_0x37b6e1['update'](_0x292744,_0x37fd72(0x124),_0x37fd72(0x1d2));return _0x2b5bb1+=_0x37b6e1[_0x37fd72(0x1bd)](_0x37fd72(0x1d2)),_0x2b5bb1;}[a42_0x24fc82(0x204)](_0x3e3c85,_0x20e717){const _0x2ffc5f=a42_0x24fc82;try{const _0x2c3eff=fs_1[_0x2ffc5f(0x19e)][_0x2ffc5f(0x143)](this[_0x2ffc5f(0x14e)],_0x2ffc5f(0x124))[_0x2ffc5f(0x1cb)](),_0x3fb3d2={'iv':_0x20e717[_0x2ffc5f(0x1c2)](_0x2ffc5f(0x1d2)),'key':_0x3e3c85['toString'](_0x2ffc5f(0x1d2))},_0x467216=JSON['stringify'](_0x3fb3d2);console[_0x2ffc5f(0x189)](_0x2ffc5f(0x19c),_0x467216[_0x2ffc5f(0x175)]);const _0x5d623a=crypto_1['default'][_0x2ffc5f(0x139)]({'key':_0x2c3eff,'padding':crypto_1[_0x2ffc5f(0x19e)][_0x2ffc5f(0x168)]['RSA_PKCS1_PADDING']},Buffer[_0x2ffc5f(0x13f)](_0x467216));return console['log'](_0x2ffc5f(0x161),_0x5d623a['length']),_0x5d623a[_0x2ffc5f(0x1c2)](_0x2ffc5f(0x1d2));}catch(_0x55c68c){console[_0x2ffc5f(0x16d)]('❌\x20RSA\x20encryption\x20failed:',_0x55c68c);throw new Error(_0x2ffc5f(0x144));}}[a42_0x24fc82(0x1ba)](_0x511406){const _0x5228b3=a42_0x24fc82;try{const _0x12a43b=fs_1['default'][_0x5228b3(0x143)](this[_0x5228b3(0x1a1)],_0x5228b3(0x124))['trim'](),_0x5ac59c=crypto_1[_0x5228b3(0x19e)][_0x5228b3(0x1f3)](_0x5228b3(0x1d1));_0x5ac59c['update'](_0x511406),_0x5ac59c[_0x5228b3(0x196)]();const _0x757a0b=_0x5ac59c['sign'](_0x12a43b,_0x5228b3(0x1d2));return console[_0x5228b3(0x189)]('🔐\x20RSA\x20signing\x20successful'),console[_0x5228b3(0x189)](_0x5228b3(0x16e),_0x511406[_0x5228b3(0x175)]),console[_0x5228b3(0x189)](_0x5228b3(0x1a0),_0x757a0b[_0x5228b3(0x175)]),_0x757a0b;}catch(_0x4310d9){console['error'](_0x5228b3(0x156),_0x4310d9),console[_0x5228b3(0x16d)]('❌\x20Data\x20being\x20signed:',_0x511406[_0x5228b3(0x176)](0x0,0xc8)+_0x5228b3(0x126));throw new Error(_0x5228b3(0x1eb));}}['decryptAES'](_0x2de759,_0x12ad05,_0x159479){const _0x598888=a42_0x24fc82,_0x2de85f=crypto_1[_0x598888(0x19e)][_0x598888(0x193)](_0x598888(0x11f),_0x12ad05,_0x159479);let _0x429507=_0x2de85f[_0x598888(0x1e3)](_0x2de759,_0x598888(0x1d2),_0x598888(0x124));return _0x429507+=_0x2de85f['final'](_0x598888(0x124)),_0x429507;}async[a42_0x24fc82(0x16f)](_0x4c5d00,_0x37fb76){const _0x37a077=a42_0x24fc82;try{const _0x440d30=await fetch(_0x37a077(0x147),{'method':_0x37a077(0x1ed),'headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'info':_0x4c5d00,'key':_0x37fb76})});if(!_0x440d30['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x440d30[_0x37a077(0x1b2)]();}catch(_0x2f4806){console[_0x37a077(0x16d)](_0x37a077(0x170),_0x2f4806);throw new Error(_0x37a077(0x1b7));}}[a42_0x24fc82(0x1d9)](_0x156d21,_0x387bdf){const _0x2c7018=a42_0x24fc82;try{const _0x4a20d2=fs_1[_0x2c7018(0x19e)][_0x2c7018(0x143)](this[_0x2c7018(0x1a1)],_0x2c7018(0x124))[_0x2c7018(0x1cb)](),_0x2e9c57=crypto_1[_0x2c7018(0x19e)]['privateDecrypt'](_0x4a20d2,Buffer[_0x2c7018(0x13f)](_0x387bdf,'base64')),_0x18fcaa=JSON[_0x2c7018(0x192)](_0x2e9c57[_0x2c7018(0x1c2)]()),_0x2c6482=Buffer[_0x2c7018(0x13f)](_0x18fcaa[_0x2c7018(0x1a4)],'base64'),_0x477d56=Buffer[_0x2c7018(0x13f)](_0x18fcaa['iv'],'base64');return this[_0x2c7018(0x1df)](_0x156d21,_0x2c6482,_0x477d56);}catch(_0x12304f){throw new Error(_0x2c7018(0x173));}}async[a42_0x24fc82(0x1e7)](_0x41d5f7){const _0x2f2eab=a42_0x24fc82,{paymentId:_0x5511df,orderId:_0x548559,amount:_0x45db72,currency:_0x359966,cardData:_0x27b878,resultUrl:_0x18dae0,returnUrl:_0x451887,cardHolder:_0x9b6266,browser:_0x2b9970}=_0x41d5f7;console[_0x2f2eab(0x189)]('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x2f2eab(0x189)]('Payment\x20ID:',_0x5511df),console['log'](_0x2f2eab(0x1a6),_0x548559),console[_0x2f2eab(0x189)]('Amount:',_0x45db72,_0x359966),console[_0x2f2eab(0x189)](_0x2f2eab(0x1d7),this[_0x2f2eab(0x1fa)](_0x27b878[_0x2f2eab(0x1f1)])),console[_0x2f2eab(0x189)]('Card\x20Holder:',_0x9b6266[_0x2f2eab(0x141)]+'\x20'+_0x9b6266[_0x2f2eab(0x1fe)]),console['log'](_0x2f2eab(0x1ea),_0x451887),console[_0x2f2eab(0x189)]('Result\x20URL:',_0x18dae0);const _0x4c8f1b={'amount':_0x45db72,'currency':_0x359966[_0x2f2eab(0x1fc)](),'order_id':_0x548559,'result_url':_0x18dae0,'return_url':_0x451887,'card':{'number':_0x27b878[_0x2f2eab(0x1f1)],'expire_month':_0x27b878[_0x2f2eab(0x118)],'expire_year':_0x27b878[_0x2f2eab(0x154)],'cvv':_0x27b878[_0x2f2eab(0x165)]},'card_holder':_0x9b6266,'browser':_0x2b9970},_0x810847=JSON[_0x2f2eab(0x1b9)](_0x4c8f1b);console[_0x2f2eab(0x189)](_0x2f2eab(0x13b)),console['log'](_0x2f2eab(0x1a3)),console[_0x2f2eab(0x189)](_0x810847),console[_0x2f2eab(0x189)]('📝\x20Data\x20length:',_0x810847['length']);try{const {key:_0x583369,iv:_0x2052e3}=this[_0x2f2eab(0x13a)]();console['log'](_0x2f2eab(0x1ec)),console[_0x2f2eab(0x189)]('🔐\x20AES\x20key\x20length:',_0x583369[_0x2f2eab(0x175)]),console['log'](_0x2f2eab(0x12d),_0x2052e3[_0x2f2eab(0x175)]);const _0x7c6a24=this[_0x2f2eab(0x1c4)](_0x810847,_0x583369,_0x2052e3);console[_0x2f2eab(0x189)](_0x2f2eab(0x1cf)),console['log'](_0x2f2eab(0x1f9),_0x7c6a24['length']);const _0x19e4b9=this[_0x2f2eab(0x204)](_0x583369,_0x2052e3);console[_0x2f2eab(0x189)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x2f2eab(0x189)]('📝\x20Encrypted\x20key\x20length:',_0x19e4b9[_0x2f2eab(0x175)]);const _0x2260c0=this[_0x2f2eab(0x1ba)](_0x810847);console[_0x2f2eab(0x189)]('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x2f2eab(0x189)](_0x2f2eab(0x1a0),_0x2260c0[_0x2f2eab(0x175)]);const _0x499944={'merchant_point_id':this[_0x2f2eab(0x17c)],'method':_0x2f2eab(0x179),'info':_0x7c6a24,'key':_0x19e4b9,'sign':_0x2260c0,'lang':'en'};console['log'](_0x2f2eab(0x1d5)),console[_0x2f2eab(0x189)]('📝\x20Final\x20request\x20structure:'),console[_0x2f2eab(0x189)](_0x2f2eab(0x12c),this['merchantPointId']),console['log']('\x20\x20\x20-\x20method:\x20charge'),console[_0x2f2eab(0x189)](_0x2f2eab(0x185),_0x7c6a24[_0x2f2eab(0x175)]),console[_0x2f2eab(0x189)](_0x2f2eab(0x1be),_0x19e4b9[_0x2f2eab(0x175)]),console[_0x2f2eab(0x189)](_0x2f2eab(0x1c0),_0x2260c0[_0x2f2eab(0x175)]),console[_0x2f2eab(0x189)](_0x2f2eab(0x17b)),loggerService_1[_0x2f2eab(0x140)][_0x2f2eab(0x18f)](_0x2f2eab(0x1bb),_0x2f2eab(0x182),_0x2f2eab(0x1ed),{'merchant_point_id':this[_0x2f2eab(0x17c)],'method':'charge','lang':'en'});const _0x49eedc=Date['now'](),_0x10e0f9=await fetch(this[_0x2f2eab(0x1f0)],{'method':_0x2f2eab(0x1ed),'headers':{'Content-Type':_0x2f2eab(0x110),'Accept':_0x2f2eab(0x110),'User-Agent':_0x2f2eab(0x1a5)},'body':JSON[_0x2f2eab(0x1b9)](_0x499944)}),_0x59ce16=Date['now']()-_0x49eedc;console['log'](_0x2f2eab(0x150)),console['log']('Status:',_0x10e0f9['status']),console['log'](_0x2f2eab(0x146),_0x59ce16+'ms');if(!_0x10e0f9['ok']){const _0x364c4a=await _0x10e0f9[_0x2f2eab(0x1b2)]();console[_0x2f2eab(0x16d)](_0x2f2eab(0x12a),_0x10e0f9[_0x2f2eab(0x1de)]),console['error'](_0x2f2eab(0x14b),_0x364c4a),loggerService_1[_0x2f2eab(0x140)][_0x2f2eab(0x17a)](_0x2f2eab(0x1bb),_0x2f2eab(0x206),_0x10e0f9[_0x2f2eab(0x1de)],_0x364c4a,_0x59ce16),loggerService_1['loggerService'][_0x2f2eab(0x1a8)]('mastercard',_0x2f2eab(0x182),'HTTP\x20'+_0x10e0f9[_0x2f2eab(0x1de)]+':\x20'+_0x364c4a);throw new Error(_0x2f2eab(0x112)+_0x10e0f9[_0x2f2eab(0x1de)]+_0x2f2eab(0x1e0)+_0x364c4a);}const _0x1e0aaf=await _0x10e0f9[_0x2f2eab(0x1db)]();loggerService_1[_0x2f2eab(0x140)][_0x2f2eab(0x17a)](_0x2f2eab(0x1bb),_0x2f2eab(0x206),_0x10e0f9[_0x2f2eab(0x1de)],_0x1e0aaf,_0x59ce16),console[_0x2f2eab(0x189)](_0x2f2eab(0x164));let _0x302317=_0x1e0aaf;if(_0x1e0aaf[_0x2f2eab(0x183)]&&_0x1e0aaf[_0x2f2eab(0x1a4)]&&_0x1e0aaf[_0x2f2eab(0x12f)]){console[_0x2f2eab(0x189)](_0x2f2eab(0x1dd));try{const _0x90f178=await this['decryptResponsePhp'](_0x1e0aaf[_0x2f2eab(0x183)],_0x1e0aaf[_0x2f2eab(0x1a4)]);_0x302317=JSON['parse'](_0x90f178),console[_0x2f2eab(0x189)](_0x2f2eab(0x1f6)),loggerService_1[_0x2f2eab(0x140)][_0x2f2eab(0x17a)](_0x2f2eab(0x1bb),_0x2f2eab(0x1c6),_0x10e0f9['status'],_0x302317,_0x59ce16),console[_0x2f2eab(0x189)](_0x2f2eab(0x172));}catch(_0xb00634){console[_0x2f2eab(0x16d)](_0x2f2eab(0x1f8),_0xb00634),loggerService_1[_0x2f2eab(0x140)]['logWhiteDomainError'](_0x2f2eab(0x1bb),_0x2f2eab(0x1e6),'Decryption\x20failed:\x20'+_0xb00634),_0x302317=_0x1e0aaf;}}else loggerService_1[_0x2f2eab(0x140)][_0x2f2eab(0x17a)]('mastercard',_0x2f2eab(0x1c6),_0x10e0f9[_0x2f2eab(0x1de)],_0x302317,_0x59ce16),console[_0x2f2eab(0x189)](_0x2f2eab(0x194));console[_0x2f2eab(0x189)](_0x2f2eab(0x138),_0x302317['status']),console[_0x2f2eab(0x189)](_0x2f2eab(0x16a),_0x302317[_0x2f2eab(0x1bd)]),console[_0x2f2eab(0x189)](_0x2f2eab(0x11c),_0x302317[_0x2f2eab(0x1cd)]),console[_0x2f2eab(0x189)]('3DS\x20URL:',_0x302317[_0x2f2eab(0x152)]||_0x2f2eab(0x12b));if(_0x302317[_0x2f2eab(0x1de)]===0x64&&_0x302317[_0x2f2eab(0x1bd)]===0x1)return console[_0x2f2eab(0x189)](_0x2f2eab(0x18e)),{'gateway_payment_id':_0x302317[_0x2f2eab(0x1cd)]?.['toString'](),'payment_url':_0x451887,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x302317[_0x2f2eab(0x152)])return console[_0x2f2eab(0x189)]('🔐\x203DS\x20verification\x20required'),this[_0x2f2eab(0x14f)](_0x5511df,_0x548559,_0x302317[_0x2f2eab(0x1cd)]?.['toString']()||_0x548559),{'gateway_payment_id':_0x302317['payment_id']?.[_0x2f2eab(0x1c2)](),'payment_url':_0x302317[_0x2f2eab(0x152)],'requires_3ds':!![],'threeds_url':_0x302317[_0x2f2eab(0x152)],'status':_0x2f2eab(0x162),'final':![]};let _0x814d02=_0x302317['desc']||_0x302317[_0x2f2eab(0x166)]||_0x2f2eab(0x1c3),_0x21c3f1=_0x302317[_0x2f2eab(0x1de)],_0x35c843=_0x302317[_0x2f2eab(0x1bd)];return console[_0x2f2eab(0x189)](_0x2f2eab(0x1c8)+_0x21c3f1+_0x2f2eab(0x1ad)+_0x35c843+_0x2f2eab(0x148)+_0x814d02),{'gateway_payment_id':_0x302317[_0x2f2eab(0x1cd)]?.[_0x2f2eab(0x1c2)](),'payment_url':_0x451887,'requires_3ds':![],'status':_0x2f2eab(0x1d0),'final':!![]};}catch(_0x3d1105){console[_0x2f2eab(0x16d)](_0x2f2eab(0x1e9)),console[_0x2f2eab(0x16d)]('Error\x20details:',_0x3d1105),loggerService_1['loggerService'][_0x2f2eab(0x1a8)](_0x2f2eab(0x1bb),_0x2f2eab(0x182),_0x3d1105);throw new Error(_0x2f2eab(0x129)+(_0x3d1105 instanceof Error?_0x3d1105[_0x2f2eab(0x166)]:_0x2f2eab(0x1c3)));}}async[a42_0x24fc82(0x202)](_0xf8835a,_0xeae2f5){const _0x24d017=a42_0x24fc82;console[_0x24d017(0x189)](_0x24d017(0x151)+_0xf8835a+'\x20('+_0xeae2f5+')');try{const _0x41f22b={'payment_id':_0xf8835a,'order_id':_0xeae2f5},_0x5f4224=JSON[_0x24d017(0x1b9)](_0x41f22b),{key:_0x23cad1,iv:_0x2ddea2}=this[_0x24d017(0x13a)](),_0x3b4103=this[_0x24d017(0x1c4)](_0x5f4224,_0x23cad1,_0x2ddea2),_0xaa17bd=this['encryptRSA'](_0x23cad1,_0x2ddea2),_0x42e68b=this[_0x24d017(0x1ba)](_0x5f4224),_0xec5755={'merchant_point_id':this[_0x24d017(0x17c)],'method':_0x24d017(0x1de),'info':_0x3b4103,'key':_0xaa17bd,'sign':_0x42e68b,'lang':'en'};loggerService_1[_0x24d017(0x140)][_0x24d017(0x18f)](_0x24d017(0x1bb),_0x24d017(0x19a),'POST',{'merchant_point_id':this[_0x24d017(0x17c)],'method':'status','lang':'en'});const _0xc7e7f6=Date[_0x24d017(0x1d4)](),_0x5016fe=await fetch(this[_0x24d017(0x1f0)],{'method':_0x24d017(0x1ed),'headers':{'Content-Type':_0x24d017(0x110),'Accept':_0x24d017(0x110),'User-Agent':_0x24d017(0x1a5)},'body':JSON[_0x24d017(0x1b9)](_0xec5755)}),_0xbb5116=Date[_0x24d017(0x1d4)]()-_0xc7e7f6;if(!_0x5016fe['ok']){const _0xb9b5e4=await _0x5016fe[_0x24d017(0x1b2)]();loggerService_1[_0x24d017(0x140)][_0x24d017(0x17a)](_0x24d017(0x1bb),_0x24d017(0x137),_0x5016fe['status'],_0xb9b5e4,_0xbb5116);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5016fe[_0x24d017(0x1de)]);}const _0x3d2226=await _0x5016fe[_0x24d017(0x1db)]();loggerService_1['loggerService'][_0x24d017(0x17a)](_0x24d017(0x1bb),_0x24d017(0x137),_0x5016fe[_0x24d017(0x1de)],_0x3d2226,_0xbb5116);let _0x137bf8=_0x3d2226;if(_0x3d2226['info']&&_0x3d2226['key']&&_0x3d2226['sign']){console[_0x24d017(0x189)](_0x24d017(0x127));try{const _0x147180=this[_0x24d017(0x1d9)](_0x3d2226[_0x24d017(0x183)],_0x3d2226['key']);_0x137bf8=JSON[_0x24d017(0x192)](_0x147180),console['log']('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x24d017(0x1bb),'/status_decrypted',_0x5016fe['status'],_0x137bf8,_0xbb5116),console[_0x24d017(0x189)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x15cf30){console[_0x24d017(0x16d)](_0x24d017(0x11e),_0x15cf30),loggerService_1[_0x24d017(0x140)][_0x24d017(0x1a8)]('mastercard','/status_decrypt','Status\x20decryption\x20failed:\x20'+_0x15cf30),_0x137bf8=_0x3d2226;}}else loggerService_1['loggerService'][_0x24d017(0x17a)]('mastercard',_0x24d017(0x199),_0x5016fe[_0x24d017(0x1de)],_0x137bf8,_0xbb5116),console[_0x24d017(0x189)](_0x24d017(0x1c5));console['log'](_0x24d017(0x16b),{'status':_0x137bf8['status'],'final':_0x137bf8['final'],'payment_id':_0x137bf8[_0x24d017(0x1cd)],'desc':_0x137bf8['desc']});let _0x1b4e0b=_0x24d017(0x162);if(_0x137bf8[_0x24d017(0x1de)]===0x1&&_0x137bf8[_0x24d017(0x1bd)]===0x1)_0x1b4e0b=_0x24d017(0x1ac);else _0x137bf8[_0x24d017(0x1de)]===0x0&&_0x137bf8['final']===0x0?_0x1b4e0b=_0x24d017(0x162):_0x1b4e0b=_0x24d017(0x1d0);return{'status':_0x1b4e0b,'final':_0x137bf8[_0x24d017(0x1bd)]===0x1,'amount':_0x137bf8['amount'],'currency':_0x137bf8[_0x24d017(0x1f2)],'date_success':_0x137bf8[_0x24d017(0x178)],'description':_0x137bf8['desc']};}catch(_0x4d4693){console[_0x24d017(0x16d)](_0x24d017(0x1bf),_0x4d4693),loggerService_1[_0x24d017(0x140)][_0x24d017(0x1a8)](_0x24d017(0x1bb),_0x24d017(0x19a),_0x4d4693);throw new Error(_0x24d017(0x1ef)+(_0x4d4693 instanceof Error?_0x4d4693[_0x24d017(0x166)]:_0x24d017(0x1c3)));}}[a42_0x24fc82(0x14f)](_0x2a2300,_0x3ec03f,_0x124f75){const _0x35a248=a42_0x24fc82;console[_0x35a248(0x189)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0x2a2300+'\x20('+_0x124f75+')'),this['clearStatusTimers'](_0x2a2300);const _0x394579=[],_0x33522d=0x5*0x3c*0x3e8,_0x13ce44=0x2*0x3c*0x3c*0x3e8,_0x48d240=Math[_0x35a248(0x160)](_0x13ce44/_0x33522d);console[_0x35a248(0x189)](_0x35a248(0x1fd)+_0x48d240+_0x35a248(0x116));for(let _0x2007a9=0x1;_0x2007a9<=_0x48d240;_0x2007a9++){const _0x3c7e96=setTimeout(async()=>{const _0x120ef9=_0x35a248;console[_0x120ef9(0x189)](_0x120ef9(0x11a)+_0x2007a9+'/'+_0x48d240+_0x120ef9(0x12e)+_0x2a2300);try{const _0x27d43b=await this[_0x120ef9(0x202)](_0x124f75,_0x3ec03f);console[_0x120ef9(0x189)](_0x120ef9(0x134)+_0x2007a9+_0x120ef9(0x19f),_0x27d43b),_0x27d43b[_0x120ef9(0x1bd)]&&(console['log'](_0x120ef9(0x1b8)+_0x2a2300+_0x120ef9(0x19d)+_0x27d43b[_0x120ef9(0x1de)]+'),\x20stopping\x20status\x20checks'),this[_0x120ef9(0x19b)](_0x2a2300),await this['updatePaymentStatus'](_0x2a2300,_0x27d43b[_0x120ef9(0x1de)],_0x27d43b));}catch(_0x41f06b){console[_0x120ef9(0x16d)]('❌\x20Status\x20check\x20#'+_0x2007a9+_0x120ef9(0x201)+_0x2a2300+':',_0x41f06b);}},_0x2007a9*_0x33522d);_0x394579[_0x35a248(0x1ce)](_0x3c7e96);}this['statusCheckTimers']['set'](_0x2a2300,_0x394579),console[_0x35a248(0x189)](_0x35a248(0x15c)+_0x48d240+_0x35a248(0x169)+_0x2a2300);}[a42_0x24fc82(0x19b)](_0x301d27){const _0x21a31b=a42_0x24fc82,_0x44862e=this[_0x21a31b(0x1ca)][_0x21a31b(0x133)](_0x301d27);_0x44862e&&(console[_0x21a31b(0x189)](_0x21a31b(0x1a9)+_0x44862e[_0x21a31b(0x175)]+_0x21a31b(0x1ee)+_0x301d27),_0x44862e[_0x21a31b(0x1b0)]((_0x49b5cf,_0x51c71c)=>{clearTimeout(_0x49b5cf);}),this[_0x21a31b(0x1ca)][_0x21a31b(0x14a)](_0x301d27));}async[a42_0x24fc82(0x1e4)](_0x4432ec,_0x2201f7,_0x1fe741){const _0x386b0a=a42_0x24fc82;try{const _0x2804ed=(await Promise[_0x386b0a(0x1ff)]()[_0x386b0a(0x1e5)](()=>__importStar(require(_0x386b0a(0x1c9)))))[_0x386b0a(0x19e)],_0x380ba={'status':_0x2201f7['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x2201f7===_0x386b0a(0x1ac)&&(_0x380ba[_0x386b0a(0x1f4)]=new Date()),_0x1fe741['description']&&(_0x380ba[_0x386b0a(0x1fb)]=_0x386b0a(0x1d8)+_0x1fe741[_0x386b0a(0x190)]),await _0x2804ed['payment'][_0x386b0a(0x1e3)]({'where':{'id':_0x4432ec},'data':_0x380ba}),console['log'](_0x386b0a(0x1b8)+_0x4432ec+_0x386b0a(0x131)+_0x2201f7),await this[_0x386b0a(0x203)](_0x4432ec,_0x2201f7);}catch(_0x33053f){console[_0x386b0a(0x16d)]('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x4432ec+':',_0x33053f);}}async['sendPaymentNotifications'](_0x55e454,_0xbda2f7){const _0xc2745a=a42_0x24fc82;try{const _0x5f3139=(await Promise[_0xc2745a(0x1ff)]()[_0xc2745a(0x1e5)](()=>__importStar(require(_0xc2745a(0x1c9)))))[_0xc2745a(0x19e)],{telegramBotService:_0x28ca78}=await Promise['resolve']()['then'](()=>__importStar(require(_0xc2745a(0x13e)))),_0x53d64b=await _0x5f3139[_0xc2745a(0x18c)]['findUnique']({'where':{'id':_0x55e454},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x53d64b)return;const _0x24db4d={'PAID':'paid','FAILED':_0xc2745a(0x157)},_0x15aec9=_0x24db4d[_0xbda2f7];_0x15aec9&&await _0x28ca78[_0xc2745a(0x18d)](_0x53d64b[_0xc2745a(0x135)],_0x53d64b,_0x15aec9),await this[_0xc2745a(0x132)](_0x53d64b,_0xbda2f7);}catch(_0x5eb0f1){console['error'](_0xc2745a(0x130),_0x5eb0f1);}}async[a42_0x24fc82(0x132)](_0x53677b,_0x363591){const _0x5b4ba8=a42_0x24fc82,_0x2deb3f=Date[_0x5b4ba8(0x1d4)]();try{const _0x278ade=_0x53677b[_0x5b4ba8(0x14c)],_0x2c6584=_0x278ade[_0x5b4ba8(0x120)];if(!_0x2c6584?.[_0x5b4ba8(0x15f)]){console[_0x5b4ba8(0x189)](_0x5b4ba8(0x11d)+_0x278ade['id']);return;}const _0xa74d2f=_0x363591===_0x5b4ba8(0x1ac)?_0x5b4ba8(0x205):_0x5b4ba8(0x1b5);let _0x598671=[];if(_0x2c6584[_0x5b4ba8(0x155)])try{_0x598671=Array[_0x5b4ba8(0x188)](_0x2c6584[_0x5b4ba8(0x155)])?_0x2c6584['webhookEvents']:JSON[_0x5b4ba8(0x192)](_0x2c6584[_0x5b4ba8(0x155)]);}catch(_0x35b096){console[_0x5b4ba8(0x16d)]('Error\x20parsing\x20webhook\x20events:',_0x35b096),_0x598671=[];}if(!_0x598671['includes'](_0xa74d2f)){console[_0x5b4ba8(0x189)](_0x5b4ba8(0x1f5)+_0xa74d2f+_0x5b4ba8(0x200)+_0x278ade['id']);return;}const _0x310825={'event':_0xa74d2f,'payment':{'id':_0x53677b['id'],'order_id':_0x53677b[_0x5b4ba8(0x111)],'gateway_order_id':_0x53677b[_0x5b4ba8(0x136)],'gateway':_0x5b4ba8(0x122),'amount':_0x53677b[_0x5b4ba8(0x117)],'currency':_0x53677b[_0x5b4ba8(0x1f2)],'status':_0x363591[_0x5b4ba8(0x180)](),'customer_email':_0x53677b[_0x5b4ba8(0x1b1)],'customer_name':_0x53677b[_0x5b4ba8(0x18b)],'created_at':_0x53677b['createdAt'],'updated_at':new Date()}},_0x53144d=await fetch(_0x2c6584[_0x5b4ba8(0x15f)],{'method':_0x5b4ba8(0x1ed),'headers':{'Content-Type':_0x5b4ba8(0x110),'User-Agent':_0x5b4ba8(0x125)},'body':JSON[_0x5b4ba8(0x1b9)](_0x310825)}),_0x16ea3b=Date['now']()-_0x2deb3f;loggerService_1[_0x5b4ba8(0x140)][_0x5b4ba8(0x163)](_0x53677b[_0x5b4ba8(0x135)],_0x2c6584[_0x5b4ba8(0x15f)],_0xa74d2f,_0x53144d[_0x5b4ba8(0x1de)],_0x16ea3b,_0x310825),console[_0x5b4ba8(0x189)](_0x5b4ba8(0x17e)+_0x2c6584[_0x5b4ba8(0x15f)]+'\x20with\x20status\x20'+_0x53144d[_0x5b4ba8(0x1de)]+'\x20('+_0x16ea3b+_0x5b4ba8(0x1a2));}catch(_0x4e5d0d){console[_0x5b4ba8(0x16d)](_0x5b4ba8(0x1b6),_0x4e5d0d),loggerService_1[_0x5b4ba8(0x140)][_0x5b4ba8(0x128)](_0x53677b[_0x5b4ba8(0x135)],_0x53677b[_0x5b4ba8(0x14c)]?.[_0x5b4ba8(0x120)]?.[_0x5b4ba8(0x15f)]||_0x5b4ba8(0x187),_0x5b4ba8(0x1c1),_0x4e5d0d,{});}}[a42_0x24fc82(0x1fa)](_0x4de429){const _0x3f4841=a42_0x24fc82,_0x26b66e=_0x4de429[_0x3f4841(0x1d6)](/[\s-]/g,'');if(_0x26b66e[_0x3f4841(0x175)]<0x4)return _0x3f4841(0x1da);return _0x3f4841(0x13d)+_0x26b66e[_0x3f4841(0x153)](-0x4);}async[a42_0x24fc82(0x174)](_0x251976){const _0x234fde=a42_0x24fc82;console[_0x234fde(0x189)](_0x234fde(0x145),_0x251976);let _0xafeefa='PENDING';if(_0x251976[_0x234fde(0x1de)]===0x1&&_0x251976[_0x234fde(0x1bd)]===0x1)_0xafeefa='PAID';else _0x251976['status']===0x0&&_0x251976[_0x234fde(0x1bd)]===0x0?_0xafeefa=_0x234fde(0x162):_0xafeefa=_0x234fde(0x1d0);return{'paymentId':_0x251976[_0x234fde(0x115)]||'','status':_0xafeefa,'amount':_0x251976['amount'],'currency':_0x251976['currency']};}[a42_0x24fc82(0x1aa)](){const _0x463313=a42_0x24fc82;console[_0x463313(0x189)](_0x463313(0x17d));const _0x4c0199=this[_0x463313(0x1ca)]['size'];for(const [_0x3bb263]of this[_0x463313(0x1ca)]){this['clearStatusTimers'](_0x3bb263);}console[_0x463313(0x189)](_0x463313(0x1b4)+_0x4c0199+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a42_0x24fc82(0x142)]=MasterCardService;