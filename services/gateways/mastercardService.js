'use strict';function a51_0x36a8(_0xcb7a9a,_0x35fce9){const _0x5343a3=a51_0x5343();return a51_0x36a8=function(_0x36a825,_0xe3316){_0x36a825=_0x36a825-0xdb;let _0x52915d=_0x5343a3[_0x36a825];return _0x52915d;},a51_0x36a8(_0xcb7a9a,_0x35fce9);}const a51_0x207483=a51_0x36a8;(function(_0x250cbf,_0x328783){const _0x2161f2=a51_0x36a8,_0x303e04=_0x250cbf();while(!![]){try{const _0x1bfd81=parseInt(_0x2161f2(0x14b))/0x1*(-parseInt(_0x2161f2(0xe0))/0x2)+parseInt(_0x2161f2(0x13a))/0x3+-parseInt(_0x2161f2(0x238))/0x4*(-parseInt(_0x2161f2(0x165))/0x5)+parseInt(_0x2161f2(0x10c))/0x6+-parseInt(_0x2161f2(0x1a7))/0x7+parseInt(_0x2161f2(0x155))/0x8+parseInt(_0x2161f2(0x10e))/0x9*(-parseInt(_0x2161f2(0xe2))/0xa);if(_0x1bfd81===_0x328783)break;else _0x303e04['push'](_0x303e04['shift']());}catch(_0x314d84){_0x303e04['push'](_0x303e04['shift']());}}}(a51_0x5343,0x6a8c8));function a51_0x5343(){const _0x393712=['\x20\x20\x20-\x20merchant_point_id:','🔐\x20Data\x20encrypted\x20with\x20AES','\x20\x20\x20-\x20method:\x20charge','PAID','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','\x20\x20Original:\x20\x22','now','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','/status_raw','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','The\x20card\x20is\x20lost\x20or\x20stolen',',\x20orderId=','📝\x20Encrypted\x20data\x20length:','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','json','https://api2.trapay.uk/decrypt.php','\x20\x20\x20-\x20key\x20length:','),\x20stopping\x20status\x20checks','defineProperty','Unsuccessful\x20payment','publicKeyPath','Response\x20Body:','✅\x20Payment\x20','🔐\x20VISA\x20Public\x20key\x20length:\x20','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','\x20payment_id\x20for\x20search:\x20','join','-----END','Another\x20unknown\x20error','Response\x20Time:','Sender\x20information\x20required','visaApiUrl','532176RgVzhG','sendShopWebhook','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','PENDING','validateKeyFiles',',\x20id=','/charge','/status','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','configurable','webhookEvents','/charge_raw','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','HTTP\x20','webhook_send','✅\x20Status\x20response\x20decrypted\x20successfully','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','1vPQHLA','visaPrivateKeyPath','base64',',\x20final=','visa/mastercard','📝\x20Encrypted\x20key\x20length:',':\x20Unknown\x20status\x20code','\x20MasterCard\x20status\x20check\x20timers','warn','getCardTypeAndApi','5288848vICSLA','Failed\x20payment','Status:','stringify','✅\x20VISA\x20key\x20files\x20validated\x20successfully','loggerService','3DS\x20URL:','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','3ds_url','Sender\x27s\x20card\x20details\x20are\x20required','🔐\x20Using\x20keys:\x20','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','apiUrl','Payment\x20confirmation\x20time\x20has\x20expired','🛑\x20Stopped\x20','shopId','3740skuwAD','LookUp\x20code\x20verified','updatePaymentStatus','readFileSync','🔍\x20','3DS\x20verification\x20required','findUnique','decryptAES','desc','paidAt','/charge_decrypted','📊\x20','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','Insufficient\x20funds\x20on\x20the\x20card','4000000000000000','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','existsSync','),\x20defaulting\x20to\x20MasterCard','visa_public.pem','key','VISA','✅\x20Payment\x20successful','settings','parse','-----BEGIN','cardType','Webhook\x20event\x20','payment.failed','privateDecrypt','Payment\x20pending\x20verification','❌\x20Data\x20being\x20signed:','LookUp\x20not\x20confirmed','🔐\x20MasterCard\x20Public\x20key\x20path:','📝\x20Data\x20length:','isFinalStatus','toLowerCase','📝\x20Signature\x20length:','❌\x20PHP\x20decryptor\x20request\x20failed:','paid','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','replace','visaMerchantPointId','__importStar','\x20payment\x20status:\x20','🔐\x20AES\x20IV\x20length:','maskCardNumber','merchantPointId','masterCardApiUrl','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','psp_public.pem','❌\x20Detailed\x20failure\x20description:\x20','\x20\x20\x20Payment\x20ID:\x20','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','paymentId','logShopWebhookError','\x20not\x20enabled\x20for\x20shop\x20','paymentStatuses','logShopWebhookSent','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','📝\x20Data\x20to\x20sign\x20length:','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','toUpperCase','masterCardMerchantPointId','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','writable','order_id','2755739ZkPJwH','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','Payment\x20System/1.0','📤\x20Sending\x20request\x20to\x20API...','log',',\x20payment_id=','error','📊\x20Checking\x20','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','\x20is\x20final\x20(','constants','https://api.paydmeth.com/api','trim','\x20result:','🔐\x203DS\x20verification\x20required','encryptAES',',\x20Desc:\x20','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','set','crypto','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','Operation\x20completed\x20successfully','Request\x20data\x20error','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','processWebhook','orderId','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','Failed\x20to\x20decrypt\x20response','includes','1111','createCipheriv','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','sendPaymentNotification','statusCheckTimers','PHP\x20decryptor\x20error','description','📝\x20Final\x20request\x20structure:','last_name','checkPaymentStatus','VisaMasterCardService','Cancellation\x20is\x20not\x20possible','Failed\x20to\x20send\x20MasterCard\x20webhook:','from','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','logWhiteDomainResponse','Error\x20details:','expire_year','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','Status\x20decryption\x20failed:\x20','randomBytes','Unknown\x20error','visaPublicKeyPath','Decryption\x20failed:\x20','\x20webhook\x20extracted\x20data:','visa_private.pem','__setModuleDefault','isArray','PIN\x20code\x20confirmation\x20awaited','failureMessage','utf8','size','\x20\x20\x20Status:\x20','getOwnPropertyNames','slice','scheduleStatusChecks','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','\x20\x20\x20-\x20info\x20length:','createdAt','private.pem','toString','path','\x20status\x20check\x20#','failed','forEach','\x20status\x20checks\x20for\x20payment\x20','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','default','length','🔐\x20VISA\x20API\x20URL:','decryptResponsePhp','decryptResponse','privateKeyPath','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','final','floor','first_name','generateAESKey','card_type','getDetailedErrorMessage','clearStatusTimers','🔐\x20AES\x20key\x20length:','No\x20New\x20payment','\x20characters','encryptRSA','prototype','Awaiting\x20confirmation\x20in\x20the\x20application','Payment\x20ID:','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','Test\x20payment','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','payment.success','get','Payment\x20returned','Method\x20not\x20allowed',',\x20paymentId=','FAILED','processCardPayment','HTTP\x20error!\x20status:\x20','🔐\x20Data\x20signed\x20with\x20RSA','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','✅\x20Scheduled\x20','../telegramBotService','expire_month','The\x20card\x20does\x20not\x20exist','\x20for\x20payment\x20','\x20\x20Cleaned:\x20\x20\x22','currency','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','charAt','aes-256-ctr','status','payment','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','text','...','5000000000000000','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','Error\x20parsing\x20webhook\x20events:','none','Payment\x20System/1.0\x20(MasterCard)','/charge_decrypt','❌\x20Status\x20check\x20#','__esModule','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','Recipient\x20data\x20required','then','🔐\x20VISA\x20Public\x20key\x20path:','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending',',\x20body:\x20','28plTvDp','No\x20Error\x20executing\x20request','../../config/database','🔐\x20MasterCard\x20Private\x20key\x20path:','\x20\x20\x20Currency:\x20','webhookUrl','MasterCard\x20webhook\x20sent\x20to\x20','Transaction\x20limit\x20exceeded','Client\x20OTP\x20confirmation\x20required','346388jBWwvX','\x20with\x20status\x20','6570970goYpVg','Payment\x20is\x20being\x20processed','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','POST','HTTP\x20Status:','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','payment_id','logWhiteDomainError','Failed\x20to\x20send\x20payment\x20notifications:','resolve','===\x20PARSED\x20API\x20RESPONSE\x20===','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','info','Order\x20ID:','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','system','charge','keys','customerName','RSA_PKCS1_PADDING','cwd','/status_decrypt','Card\x20Number:','\x22\x20|\x20\x22','application/json','Number\x20of\x20attempts\x20exceeded','Payment\x20cancellation\x20is\x20being\x20processed','message','MASTERCARD','sign','🔍\x20Using\x20provided\x20card\x20type:\x20','\x20failed\x20for\x20payment\x20','cvv','customerEmail','💾\x20Payment\x20data\x20prepared','\x20(from:\x20order_id=','Status\x20','shop','substring','Payment\x20confirmation\x20required','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','❌\x20RSA\x20encryption\x20failed:','4899948jJyhJG','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','9sdnysh','🔐\x20VISA\x20Private\x20key\x20length:\x20','SHA256','create','\x20|\x20Response:\x20','amount','number','💳\x20VISA/MasterCard\x20service\x20initialized','LookUp\x20number\x20of\x20attempts\x20exceeded','\x20status\x20updated\x20to\x20','errorMessage','update'];a51_0x5343=function(){return _0x393712;};return a51_0x5343();}var __createBinding=this&&this['__createBinding']||(Object[a51_0x207483(0x111)]?function(_0x2fe56d,_0x4b5ca5,_0x2244ed,_0x32a7a1){const _0x3ce357=a51_0x207483;if(_0x32a7a1===undefined)_0x32a7a1=_0x2244ed;var _0xe84a96=Object['getOwnPropertyDescriptor'](_0x4b5ca5,_0x2244ed);(!_0xe84a96||(_0x3ce357(0x211)in _0xe84a96?!_0x4b5ca5[_0x3ce357(0x230)]:_0xe84a96[_0x3ce357(0x1a5)]||_0xe84a96[_0x3ce357(0x143)]))&&(_0xe84a96={'enumerable':!![],'get':function(){return _0x4b5ca5[_0x2244ed];}}),Object[_0x3ce357(0x12c)](_0x2fe56d,_0x32a7a1,_0xe84a96);}:function(_0xaf9139,_0x13f7be,_0x1a8a82,_0x1425ce){if(_0x1425ce===undefined)_0x1425ce=_0x1a8a82;_0xaf9139[_0x1425ce]=_0x13f7be[_0x1a8a82];}),__setModuleDefault=this&&this[a51_0x207483(0x1e2)]||(Object[a51_0x207483(0x111)]?function(_0x3d7bf4,_0xe91914){const _0x1e9fb4=a51_0x207483;Object[_0x1e9fb4(0x12c)](_0x3d7bf4,_0x1e9fb4(0x1f8),{'enumerable':!![],'value':_0xe91914});}:function(_0x404b9b,_0x317254){const _0x716238=a51_0x207483;_0x404b9b[_0x716238(0x1f8)]=_0x317254;}),__importStar=this&&this[a51_0x207483(0x18f)]||(function(){var _0x5ddc8a=function(_0x344870){const _0xb89c0d=a51_0x36a8;return _0x5ddc8a=Object[_0xb89c0d(0x1e9)]||function(_0x31cb0d){const _0x2fd129=_0xb89c0d;var _0x57d306=[];for(var _0x2894f4 in _0x31cb0d)if(Object[_0x2fd129(0x20a)]['hasOwnProperty']['call'](_0x31cb0d,_0x2894f4))_0x57d306[_0x57d306[_0x2fd129(0x1f9)]]=_0x2894f4;return _0x57d306;},_0x5ddc8a(_0x344870);};return function(_0x4f7183){const _0x2657bf=a51_0x36a8;if(_0x4f7183&&_0x4f7183[_0x2657bf(0x230)])return _0x4f7183;var _0x493392={};if(_0x4f7183!=null){for(var _0x30ebd2=_0x5ddc8a(_0x4f7183),_0x45b938=0x0;_0x45b938<_0x30ebd2[_0x2657bf(0x1f9)];_0x45b938++)if(_0x30ebd2[_0x45b938]!==_0x2657bf(0x1f8))__createBinding(_0x493392,_0x4f7183,_0x30ebd2[_0x45b938]);}return __setModuleDefault(_0x493392,_0x4f7183),_0x493392;};}()),__importDefault=this&&this['__importDefault']||function(_0x65137b){const _0xc9c90f=a51_0x207483;return _0x65137b&&_0x65137b[_0xc9c90f(0x230)]?_0x65137b:{'default':_0x65137b};};Object[a51_0x207483(0x12c)](exports,a51_0x207483(0x230),{'value':!![]}),exports[a51_0x207483(0x1d1)]=void 0x0;const crypto_1=__importDefault(require(a51_0x207483(0x1ba))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x207483(0x1f2))),loggerService_1=require('../loggerService');class VisaMasterCardService{constructor(){const _0x2c393e=a51_0x207483;this[_0x2c393e(0x1cb)]=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0x2c393e(0x207)},0x1:{'final':![],'description':_0x2c393e(0x239)},0x2:{'final':!![],'description':_0x2c393e(0x1bf)},0x3:{'final':!![],'description':_0x2c393e(0x136)},0x4:{'final':!![],'description':_0x2c393e(0x12d)},0x5:{'final':!![],'description':_0x2c393e(0x1ed)},0x6:{'final':!![],'description':_0x2c393e(0x212)},0x7:{'final':!![],'description':_0x2c393e(0x20e)},0x8:{'final':![],'description':_0x2c393e(0xdf)},0x9:{'final':![],'description':'3DS\x20verification\x20required'},0xa:{'final':![],'description':'Sender\x27s\x20CVV\x20card\x20is\x20required'},0xb:{'final':![],'description':_0x2c393e(0x138)},0xc:{'final':![],'description':_0x2c393e(0x232)},0xd:{'final':![],'description':_0x2c393e(0x1c4)},0xe:{'final':![],'description':'Awaiting\x20confirmation\x20by\x20ivr\x20call'},0xf:{'final':![],'description':_0x2c393e(0x1e4)},0x10:{'final':![],'description':'Captcha\x20confirmation\x20awaited'},0x11:{'final':![],'description':'Awaiting\x20confirmation\x20of\x20the\x20login\x20password'},0x12:{'final':![],'description':_0x2c393e(0x20b)},0x13:{'final':![],'description':_0x2c393e(0xe3)},0x14:{'final':![],'description':_0x2c393e(0x18c)},0x15:{'final':![],'description':'Expected\x20bitcoin\x20transfer\x20from\x20client'},0x16:{'final':![],'description':_0x2c393e(0x182)},0x18:{'final':![],'description':_0x2c393e(0x19f)},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':'Cash\x20payment\x20is\x20expected\x20at\x20TCO'},0x1b:{'final':![],'description':_0x2c393e(0x1c9)},0x1c:{'final':![],'description':'Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application'},0x1d:{'final':![],'description':_0x2c393e(0x123)},0x1f:{'final':![],'description':_0x2c393e(0x236)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':_0x2c393e(0x15e)},0x24:{'final':!![],'description':_0x2c393e(0x162)},0x25:{'final':!![],'description':'Payment\x20prohibited'},0x26:{'final':!![],'description':_0x2c393e(0x171)},0x27:{'final':!![],'description':_0x2c393e(0x172)},0x28:{'final':!![],'description':_0x2c393e(0x21d)},0x29:{'final':!![],'description':_0x2c393e(0x124)},0x2a:{'final':!![],'description':'Invalid\x20expiration\x20date'},0x2b:{'final':!![],'description':_0x2c393e(0xde)},0x2c:{'final':!![],'description':_0x2c393e(0x1a4)},0x2d:{'final':!![],'description':_0x2c393e(0x156)},0x2e:{'final':!![],'description':'Unsuccessful\x20payment'},0x2f:{'final':!![],'description':_0x2c393e(0x12d)},0x30:{'final':!![],'description':_0x2c393e(0x199)},0x31:{'final':![],'description':_0x2c393e(0x109)},0x32:{'final':!![],'description':_0x2c393e(0x213)},0x33:{'final':!![],'description':_0x2c393e(0x156)},0x34:{'final':!![],'description':'Failed\x20payment'},0x35:{'final':!![],'description':_0x2c393e(0x156)},0x36:{'final':!![],'description':_0x2c393e(0x156)},0x37:{'final':!![],'description':_0x2c393e(0x156)},0x38:{'final':!![],'description':_0x2c393e(0x1d2)},0x39:{'final':![],'description':_0x2c393e(0x1bc)},0x3a:{'final':![],'description':'LookUp\x20code\x20sent'},0x3b:{'final':!![],'description':_0x2c393e(0x166)},0x3c:{'final':!![],'description':_0x2c393e(0xfb)},0x3d:{'final':!![],'description':'Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible'},0x3e:{'final':!![],'description':_0x2c393e(0xed)},0x3f:{'final':!![],'description':_0x2c393e(0x212)},0x40:{'final':![],'description':_0x2c393e(0x184)},0x41:{'final':!![],'description':_0x2c393e(0x116)},0x42:{'final':![],'description':_0x2c393e(0xfc)},0x43:{'final':!![],'description':_0x2c393e(0x1d9)},0x44:{'final':![],'description':_0x2c393e(0x16a)},0x45:{'final':!![],'description':_0x2c393e(0x156)},0x46:{'final':!![],'description':'Failed\x20payment'},0x47:{'final':!![],'description':_0x2c393e(0x219)},0x64:{'final':!![],'description':_0x2c393e(0x1be)}},this['masterCardApiUrl']=_0x2c393e(0x1b2),this[_0x2c393e(0x1a3)]=0x6e4,this[_0x2c393e(0x1fd)]=path_1['default'][_0x2c393e(0x134)](process[_0x2c393e(0xf6)](),'keys',_0x2c393e(0x1f0)),this['publicKeyPath']=path_1[_0x2c393e(0x1f8)]['join'](process[_0x2c393e(0xf6)](),_0x2c393e(0xf3),_0x2c393e(0x196)),this[_0x2c393e(0x139)]='https://api.paydmeth.com/api',this[_0x2c393e(0x18e)]=0x6b7,this['visaPrivateKeyPath']=path_1['default'][_0x2c393e(0x134)](process['cwd'](),_0x2c393e(0xf3),_0x2c393e(0x1e1)),this[_0x2c393e(0x1de)]=path_1[_0x2c393e(0x1f8)][_0x2c393e(0x134)](process['cwd'](),_0x2c393e(0xf3),_0x2c393e(0x177)),console[_0x2c393e(0x1ab)](_0x2c393e(0x115)),console[_0x2c393e(0x1ab)]('🔐\x20MasterCard\x20API\x20URL:',this[_0x2c393e(0x194)]),console[_0x2c393e(0x1ab)](_0x2c393e(0x1fa),this[_0x2c393e(0x139)]),console[_0x2c393e(0x1ab)](_0x2c393e(0x23b),this[_0x2c393e(0x1fd)]),console[_0x2c393e(0x1ab)](_0x2c393e(0x185),this[_0x2c393e(0x12e)]),console[_0x2c393e(0x1ab)]('🔐\x20VISA\x20Private\x20key\x20path:',this['visaPrivateKeyPath']),console[_0x2c393e(0x1ab)](_0x2c393e(0x234),this[_0x2c393e(0x1de)]),this[_0x2c393e(0x13e)]();}[a51_0x207483(0x204)](_0x5df5fe,_0xfbca7d){const _0x50f792=a51_0x207483,_0x2e1085=this['paymentStatuses'][_0x5df5fe];let _0x35e21f='';_0x2e1085?_0x35e21f=_0x50f792(0x106)+_0x5df5fe+':\x20'+_0x2e1085[_0x50f792(0x1cd)]:_0x35e21f=_0x50f792(0x106)+_0x5df5fe+_0x50f792(0x151);if(_0xfbca7d&&_0xfbca7d[_0x50f792(0x1b3)]()){const _0x376d56=_0xfbca7d[_0x50f792(0x1b3)]();(!_0x2e1085||_0x376d56[_0x50f792(0x188)]()!==_0x2e1085[_0x50f792(0x1cd)][_0x50f792(0x188)]())&&(_0x35e21f+=_0x50f792(0x112)+_0x376d56);}return _0x35e21f;}['isFinalStatus'](_0xb6521a){const _0x513d28=a51_0x207483,_0x1564bb=this[_0x513d28(0x19d)][_0xb6521a];return _0x1564bb?_0x1564bb[_0x513d28(0x1ff)]:!![];}[a51_0x207483(0x154)](_0x2bcf7f){const _0x4652ea=a51_0x207483,_0x11706e=_0x2bcf7f[_0x4652ea(0x222)](0x0);if(_0x11706e==='4')return console[_0x4652ea(0x1ab)](_0x4652ea(0xe7)),{'cardType':'VISA','apiUrl':this[_0x4652ea(0x139)],'privateKeyPath':this[_0x4652ea(0x14c)],'publicKeyPath':this[_0x4652ea(0x1de)],'merchantPointId':this[_0x4652ea(0x18e)]};else return _0x11706e==='5'?(console[_0x4652ea(0x1ab)](_0x4652ea(0x1b8)),{'cardType':_0x4652ea(0xfe),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this['masterCardMerchantPointId']}):(console[_0x4652ea(0x1ab)](_0x4652ea(0x10a)+_0x11706e+_0x4652ea(0x176)),{'cardType':'MASTERCARD','apiUrl':this[_0x4652ea(0x194)],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x4652ea(0x1a3)]});}[a51_0x207483(0x13e)](){const _0x1776f1=a51_0x207483;try{if(!fs_1[_0x1776f1(0x1f8)][_0x1776f1(0x175)](this[_0x1776f1(0x1fd)]))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this[_0x1776f1(0x1fd)]);if(!fs_1[_0x1776f1(0x1f8)][_0x1776f1(0x175)](this[_0x1776f1(0x12e)]))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this[_0x1776f1(0x12e)]);const _0x27afa0=fs_1['default']['readFileSync'](this[_0x1776f1(0x1fd)],_0x1776f1(0x1e6))[_0x1776f1(0x1b3)](),_0xd22373=fs_1[_0x1776f1(0x1f8)][_0x1776f1(0x168)](this['publicKeyPath'],_0x1776f1(0x1e6))[_0x1776f1(0x1b3)]();if(!_0x27afa0[_0x1776f1(0x1c6)](_0x1776f1(0x17d))||!_0x27afa0['includes'](_0x1776f1(0x135)))throw new Error(_0x1776f1(0x1af));if(!_0xd22373['includes'](_0x1776f1(0x17d))||!_0xd22373[_0x1776f1(0x1c6)](_0x1776f1(0x135)))throw new Error(_0x1776f1(0x1c3));console[_0x1776f1(0x1ab)](_0x1776f1(0xf0)),console[_0x1776f1(0x1ab)](_0x1776f1(0x1bd)+_0x27afa0[_0x1776f1(0x1f9)]+_0x1776f1(0x208)),console[_0x1776f1(0x1ab)]('🔐\x20MasterCard\x20Public\x20key\x20length:\x20'+_0xd22373['length']+'\x20characters');if(fs_1[_0x1776f1(0x1f8)][_0x1776f1(0x175)](this[_0x1776f1(0x14c)])&&fs_1[_0x1776f1(0x1f8)][_0x1776f1(0x175)](this['visaPublicKeyPath'])){const _0x4c6d4d=fs_1[_0x1776f1(0x1f8)][_0x1776f1(0x168)](this['visaPrivateKeyPath'],'utf8')['trim'](),_0x58a96b=fs_1[_0x1776f1(0x1f8)][_0x1776f1(0x168)](this[_0x1776f1(0x1de)],_0x1776f1(0x1e6))['trim']();(!_0x4c6d4d[_0x1776f1(0x1c6)](_0x1776f1(0x17d))||!_0x4c6d4d[_0x1776f1(0x1c6)]('-----END'))&&console[_0x1776f1(0x153)](_0x1776f1(0x1d5)),(!_0x58a96b[_0x1776f1(0x1c6)](_0x1776f1(0x17d))||!_0x58a96b[_0x1776f1(0x1c6)](_0x1776f1(0x135)))&&console[_0x1776f1(0x153)]('⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),console[_0x1776f1(0x1ab)](_0x1776f1(0x159)),console[_0x1776f1(0x1ab)](_0x1776f1(0x10f)+_0x4c6d4d[_0x1776f1(0x1f9)]+_0x1776f1(0x208)),console[_0x1776f1(0x1ab)](_0x1776f1(0x131)+_0x58a96b[_0x1776f1(0x1f9)]+_0x1776f1(0x208));}else console[_0x1776f1(0x153)](_0x1776f1(0x13c)),console[_0x1776f1(0x153)](_0x1776f1(0x226)+this[_0x1776f1(0x14c)]),console[_0x1776f1(0x153)](_0x1776f1(0x174)+this[_0x1776f1(0x1de)]);}catch(_0x1bc780){console[_0x1776f1(0x1ad)](_0x1776f1(0x1a8),_0x1bc780);throw _0x1bc780;}}['generateAESKey'](){const _0x50b818=a51_0x207483,_0x496e50=crypto_1[_0x50b818(0x1f8)]['randomBytes'](0x20),_0x13c613=crypto_1[_0x50b818(0x1f8)][_0x50b818(0x1dc)](0x10);return{'key':_0x496e50,'iv':_0x13c613};}[a51_0x207483(0x1b6)](_0x51ae80,_0x287b06,_0x22771b){const _0x5883d4=a51_0x207483,_0xbea7e9=crypto_1[_0x5883d4(0x1f8)][_0x5883d4(0x1c8)](_0x5883d4(0x223),_0x287b06,_0x22771b);let _0x549746=_0xbea7e9[_0x5883d4(0x119)](_0x51ae80,_0x5883d4(0x1e6),_0x5883d4(0x14d));return _0x549746+=_0xbea7e9[_0x5883d4(0x1ff)](_0x5883d4(0x14d)),_0x549746;}['encryptRSA'](_0xc37797,_0x5d784,_0x2097bc){const _0x11ef49=a51_0x207483;try{const _0x156a18=fs_1[_0x11ef49(0x1f8)][_0x11ef49(0x168)](_0x2097bc,_0x11ef49(0x1e6))[_0x11ef49(0x1b3)](),_0x12115d={'iv':_0x5d784[_0x11ef49(0x1f1)]('base64'),'key':_0xc37797[_0x11ef49(0x1f1)](_0x11ef49(0x14d))},_0x457091=JSON[_0x11ef49(0x158)](_0x12115d);console[_0x11ef49(0x1ab)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x457091['length']);const _0x13975e=crypto_1[_0x11ef49(0x1f8)]['publicEncrypt']({'key':_0x156a18,'padding':crypto_1[_0x11ef49(0x1f8)][_0x11ef49(0x1b1)][_0x11ef49(0xf5)]},Buffer[_0x11ef49(0x1d4)](_0x457091));return console[_0x11ef49(0x1ab)](_0x11ef49(0x1f7),_0x13975e[_0x11ef49(0x1f9)]),_0x13975e['toString'](_0x11ef49(0x14d));}catch(_0x3c919b){console[_0x11ef49(0x1ad)](_0x11ef49(0x10b),_0x3c919b);throw new Error(_0x11ef49(0x195));}}['signRSA'](_0xfae738,_0x4b5fa3){const _0x2c1da1=a51_0x207483;try{const _0x210a48=fs_1['default'][_0x2c1da1(0x168)](_0x4b5fa3,_0x2c1da1(0x1e6))[_0x2c1da1(0x1b3)](),_0x23f751=crypto_1['default']['createSign'](_0x2c1da1(0x110));_0x23f751['update'](_0xfae738),_0x23f751['end']();const _0x33c8c2=_0x23f751[_0x2c1da1(0xff)](_0x210a48,'base64');return console[_0x2c1da1(0x1ab)]('🔐\x20RSA\x20signing\x20successful'),console[_0x2c1da1(0x1ab)](_0x2c1da1(0x1a0),_0xfae738['length']),console['log'](_0x2c1da1(0x189),_0x33c8c2[_0x2c1da1(0x1f9)]),_0x33c8c2;}catch(_0x137819){console[_0x2c1da1(0x1ad)]('❌\x20RSA\x20signing\x20failed:',_0x137819),console[_0x2c1da1(0x1ad)](_0x2c1da1(0x183),_0xfae738[_0x2c1da1(0x108)](0x0,0xc8)+_0x2c1da1(0x228));throw new Error(_0x2c1da1(0x1c0));}}[a51_0x207483(0x16c)](_0x576477,_0x30e308,_0x9602f7){const _0x509547=a51_0x207483,_0x4e3b41=crypto_1[_0x509547(0x1f8)]['createDecipheriv'](_0x509547(0x223),_0x30e308,_0x9602f7);let _0xd11565=_0x4e3b41['update'](_0x576477,_0x509547(0x14d),_0x509547(0x1e6));return _0xd11565+=_0x4e3b41[_0x509547(0x1ff)](_0x509547(0x1e6)),_0xd11565;}async[a51_0x207483(0x1fb)](_0x33a9c7,_0x4cb5c,_0x1afb37=a51_0x207483(0xfe)){const _0x3c7eb0=a51_0x207483;try{const _0x45dc24=await fetch(_0x3c7eb0(0x129),{'method':_0x3c7eb0(0xe5),'headers':{'Content-Type':'application/json'},'body':JSON[_0x3c7eb0(0x158)]({'info':_0x33a9c7,'key':_0x4cb5c,'card_type':_0x1afb37[_0x3c7eb0(0x188)]()})});if(!_0x45dc24['ok'])throw new Error(_0x3c7eb0(0x1cc));return await _0x45dc24[_0x3c7eb0(0x227)]();}catch(_0x4b6915){console[_0x3c7eb0(0x1ad)](_0x3c7eb0(0x18a),_0x4b6915);throw new Error(_0x3c7eb0(0x20d));}}[a51_0x207483(0x1fc)](_0x3eea81,_0x44edf3){const _0x42320c=a51_0x207483;try{const _0x5e701f=fs_1[_0x42320c(0x1f8)][_0x42320c(0x168)](this[_0x42320c(0x1fd)],_0x42320c(0x1e6))['trim'](),_0x10e017=crypto_1[_0x42320c(0x1f8)][_0x42320c(0x181)](_0x5e701f,Buffer[_0x42320c(0x1d4)](_0x44edf3,_0x42320c(0x14d))),_0x5f1426=JSON[_0x42320c(0x17c)](_0x10e017[_0x42320c(0x1f1)]()),_0x2ddafd=Buffer[_0x42320c(0x1d4)](_0x5f1426[_0x42320c(0x178)],_0x42320c(0x14d)),_0x590713=Buffer[_0x42320c(0x1d4)](_0x5f1426['iv'],_0x42320c(0x14d));return this[_0x42320c(0x16c)](_0x3eea81,_0x2ddafd,_0x590713);}catch(_0x1d5dfb){throw new Error(_0x42320c(0x1c5));}}async[a51_0x207483(0x216)](_0x334888){const _0x168526=a51_0x207483,{paymentId:_0x1fb3ac,orderId:_0x2e15b5,amount:_0x432f0b,currency:_0x4513da,cardData:_0x560f0b,resultUrl:_0xa13504,returnUrl:_0x3a8729,cardHolder:_0x19ad56,browser:_0x47fe78}=_0x334888;console[_0x168526(0x1ab)](_0x168526(0x160)),console['log'](_0x168526(0x20c),_0x1fb3ac),console['log'](_0x168526(0xef),_0x2e15b5),console[_0x168526(0x1ab)]('Amount:',_0x432f0b,_0x4513da),console[_0x168526(0x1ab)](_0x168526(0xf8),this['maskCardNumber'](_0x560f0b[_0x168526(0x114)])),console['log']('Card\x20Holder:',_0x19ad56[_0x168526(0x201)]+'\x20'+_0x19ad56[_0x168526(0x1cf)]),console[_0x168526(0x1ab)]('Return\x20URL:',_0x3a8729),console[_0x168526(0x1ab)]('Result\x20URL:',_0xa13504);const _0x4741c1=this[_0x168526(0x154)](_0x560f0b[_0x168526(0x114)]);console[_0x168526(0x1ab)]('🎯\x20Using\x20'+_0x4741c1[_0x168526(0x17e)]+'\x20API:\x20'+_0x4741c1['apiUrl']),console[_0x168526(0x1ab)](_0x168526(0x15f)+_0x4741c1[_0x168526(0x1fd)]+',\x20'+_0x4741c1['publicKeyPath']);const _0x4d4c1b={..._0x19ad56,'first_name':_0x19ad56[_0x168526(0x201)]?.[_0x168526(0x18d)](/[\t\n\r\f\v]/g,'\x20')['trim']()||'','last_name':_0x19ad56[_0x168526(0x1cf)]?.[_0x168526(0x18d)](/[\t\n\r\f\v]/g,'\x20')[_0x168526(0x1b3)]()||''};console[_0x168526(0x1ab)]('🧹\x20Card\x20holder\x20names\x20cleaned:'),console[_0x168526(0x1ab)](_0x168526(0x11f)+_0x19ad56[_0x168526(0x201)]+'\x22\x20|\x20\x22'+_0x19ad56[_0x168526(0x1cf)]+'\x22'),console[_0x168526(0x1ab)](_0x168526(0x21f)+_0x4d4c1b[_0x168526(0x201)]+_0x168526(0xf9)+_0x4d4c1b[_0x168526(0x1cf)]+'\x22');const _0x51af60={'amount':_0x432f0b,'currency':_0x4513da[_0x168526(0x1a2)](),'order_id':_0x2e15b5,'result_url':_0xa13504,'return_url':_0x3a8729,'country':'','card':{'number':_0x560f0b[_0x168526(0x114)],'expire_month':_0x560f0b[_0x168526(0x21c)],'expire_year':_0x560f0b[_0x168526(0x1d8)],'cvv':_0x560f0b[_0x168526(0x102)]},'card_holder':_0x4d4c1b,'browser':_0x47fe78},_0x17e853=JSON[_0x168526(0x158)](_0x51af60);console['log'](_0x168526(0x104)),console[_0x168526(0x1ab)](_0x168526(0x14a)),console['log'](_0x17e853),console[_0x168526(0x1ab)](_0x168526(0x186),_0x17e853[_0x168526(0x1f9)]);try{const {key:_0x732f0e,iv:_0xdf21f0}=this[_0x168526(0x202)]();console[_0x168526(0x1ab)]('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console[_0x168526(0x1ab)](_0x168526(0x206),_0x732f0e[_0x168526(0x1f9)]),console['log'](_0x168526(0x191),_0xdf21f0[_0x168526(0x1f9)]);const _0x390e8a=this['encryptAES'](_0x17e853,_0x732f0e,_0xdf21f0);console['log'](_0x168526(0x11b)),console['log'](_0x168526(0x126),_0x390e8a[_0x168526(0x1f9)]);const _0x14db01=this['encryptRSA'](_0x732f0e,_0xdf21f0,_0x4741c1['publicKeyPath']);console[_0x168526(0x1ab)](_0x168526(0x1a1)),console[_0x168526(0x1ab)](_0x168526(0x150),_0x14db01['length']);const _0x50ff6f=this['signRSA'](_0x17e853,_0x4741c1['privateKeyPath']);console['log'](_0x168526(0x218)),console[_0x168526(0x1ab)](_0x168526(0x189),_0x50ff6f[_0x168526(0x1f9)]);const _0x5e2106={'merchant_point_id':_0x4741c1[_0x168526(0x193)],'method':_0x168526(0xf2),'info':_0x390e8a,'key':_0x14db01,'sign':_0x50ff6f,'lang':'en'};console[_0x168526(0x1ab)](_0x168526(0x1aa)),console[_0x168526(0x1ab)](_0x168526(0x1ce)),console[_0x168526(0x1ab)](_0x168526(0x11a),_0x4741c1[_0x168526(0x193)]),console[_0x168526(0x1ab)](_0x168526(0x11c)),console[_0x168526(0x1ab)](_0x168526(0x1ee),_0x390e8a['length']),console['log'](_0x168526(0x12a),_0x14db01[_0x168526(0x1f9)]),console[_0x168526(0x1ab)]('\x20\x20\x20-\x20sign\x20length:',_0x50ff6f[_0x168526(0x1f9)]),console[_0x168526(0x1ab)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x168526(0x15a)]['logWhiteDomainRequest'](_0x4741c1['cardType'][_0x168526(0x188)](),'/charge','POST',{'merchant_point_id':_0x4741c1[_0x168526(0x193)],'method':'charge','lang':'en'});const _0x3df523=Date[_0x168526(0x120)](),_0x3f544b=await fetch(_0x4741c1[_0x168526(0x161)],{'method':'POST','headers':{'Content-Type':_0x168526(0xfa),'Accept':_0x168526(0xfa),'User-Agent':'Payment\x20System/1.0'},'body':JSON['stringify'](_0x5e2106)}),_0x92dfb1=Date['now']()-_0x3df523;console['log']('===\x20API\x20RESPONSE\x20==='),console[_0x168526(0x1ab)](_0x168526(0x157),_0x3f544b[_0x168526(0x224)]),console[_0x168526(0x1ab)](_0x168526(0x137),_0x92dfb1+'ms');if(!_0x3f544b['ok']){const _0xc25eba=await _0x3f544b[_0x168526(0x227)]();console['error'](_0x168526(0xe6),_0x3f544b[_0x168526(0x224)]),console[_0x168526(0x1ad)](_0x168526(0x12f),_0xc25eba),loggerService_1[_0x168526(0x15a)][_0x168526(0x1d6)](_0x4741c1[_0x168526(0x17e)][_0x168526(0x188)](),_0x168526(0x145),_0x3f544b[_0x168526(0x224)],_0xc25eba,_0x92dfb1),loggerService_1[_0x168526(0x15a)][_0x168526(0xe9)](_0x4741c1[_0x168526(0x17e)][_0x168526(0x188)](),_0x168526(0x140),_0x168526(0x147)+_0x3f544b['status']+':\x20'+_0xc25eba);throw new Error(_0x168526(0x217)+_0x3f544b[_0x168526(0x224)]+_0x168526(0x237)+_0xc25eba);}const _0x3eb104=await _0x3f544b[_0x168526(0x128)]();loggerService_1[_0x168526(0x15a)][_0x168526(0x1d6)](_0x4741c1[_0x168526(0x17e)][_0x168526(0x188)](),'/charge_raw',_0x3f544b[_0x168526(0x224)],_0x3eb104,_0x92dfb1),console[_0x168526(0x1ab)](_0x168526(0xec));let _0x53bac5=_0x3eb104;if(_0x3eb104[_0x168526(0xee)]&&_0x3eb104['key']&&_0x3eb104[_0x168526(0xff)]){console[_0x168526(0x1ab)](_0x168526(0x132));try{const _0x5a6a78=await this[_0x168526(0x1fb)](_0x3eb104[_0x168526(0xee)],_0x3eb104[_0x168526(0x178)],_0x4741c1[_0x168526(0x17e)]);_0x53bac5=JSON[_0x168526(0x17c)](_0x5a6a78),console[_0x168526(0x1ab)](_0x168526(0x121)),loggerService_1['loggerService'][_0x168526(0x1d6)](_0x4741c1[_0x168526(0x17e)][_0x168526(0x188)](),_0x168526(0x16f),_0x3f544b[_0x168526(0x224)],_0x53bac5,_0x92dfb1),console[_0x168526(0x1ab)](_0x168526(0x235));}catch(_0x1879f5){console[_0x168526(0x1ad)](_0x168526(0xe4),_0x1879f5),loggerService_1[_0x168526(0x15a)]['logWhiteDomainError'](_0x4741c1[_0x168526(0x17e)]['toLowerCase'](),_0x168526(0x22e),_0x168526(0x1df)+_0x1879f5),_0x53bac5=_0x3eb104;}}else loggerService_1[_0x168526(0x15a)][_0x168526(0x1d6)](_0x4741c1[_0x168526(0x17e)][_0x168526(0x188)](),'/charge_decrypted',_0x3f544b[_0x168526(0x224)],_0x53bac5,_0x92dfb1),console[_0x168526(0x1ab)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x168526(0x1ab)](_0x168526(0x157),_0x53bac5['status']),console[_0x168526(0x1ab)]('Final:',_0x53bac5[_0x168526(0x1ff)]),console[_0x168526(0x1ab)](_0x168526(0x20c),_0x53bac5[_0x168526(0xe8)]),console['log'](_0x168526(0x15b),_0x53bac5[_0x168526(0x15d)]||_0x168526(0x22c));if(_0x53bac5[_0x168526(0x224)]===0x64&&_0x53bac5['final']===0x1)return console[_0x168526(0x1ab)](_0x168526(0x17a)),{'gateway_payment_id':_0x53bac5[_0x168526(0xe8)]?.[_0x168526(0x1f1)](),'payment_url':_0x3a8729,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x53bac5[_0x168526(0x15d)])return console[_0x168526(0x1ab)](_0x168526(0x1b5)),this[_0x168526(0x1eb)](_0x1fb3ac,_0x2e15b5,_0x53bac5[_0x168526(0xe8)]?.[_0x168526(0x1f1)]()||_0x2e15b5,_0x4741c1[_0x168526(0x17e)]),{'gateway_payment_id':_0x53bac5[_0x168526(0xe8)]?.[_0x168526(0x1f1)](),'payment_url':_0x53bac5[_0x168526(0x15d)],'requires_3ds':!![],'threeds_url':_0x53bac5['3ds_url'],'status':_0x168526(0x13d),'final':![]};let _0x2b28a0=this['getDetailedErrorMessage'](_0x53bac5[_0x168526(0x224)],_0x53bac5[_0x168526(0x16d)]||_0x53bac5['message']),_0x6bbf83=_0x53bac5[_0x168526(0x224)],_0x51dbc3=this['isFinalStatus'](_0x53bac5[_0x168526(0x224)]);return console['log'](_0x168526(0x127)+_0x6bbf83+',\x20Final:\x20'+_0x51dbc3+_0x168526(0x1b7)+_0x2b28a0),{'gateway_payment_id':_0x53bac5['payment_id']?.['toString'](),'payment_url':_0x3a8729,'requires_3ds':![],'status':_0x168526(0x215),'final':!![],'errorMessage':_0x2b28a0};}catch(_0x3da290){console[_0x168526(0x1ad)](_0x168526(0x22a)),console[_0x168526(0x1ad)](_0x168526(0x1d7),_0x3da290),loggerService_1[_0x168526(0x15a)][_0x168526(0xe9)](_0x168526(0x14f),'/charge',_0x3da290);throw new Error('Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'+(_0x3da290 instanceof Error?_0x3da290[_0x168526(0xfd)]:_0x168526(0x1dd)));}}async['checkPaymentStatus'](_0x5cd352,_0x504695,_0x265892='VISA'){const _0x4536a7=a51_0x207483;console[_0x4536a7(0x1ab)](_0x4536a7(0x1ae)+_0x265892+'\x20payment\x20status:\x20'+_0x5cd352+'\x20('+_0x504695+')');try{const _0xee4fe4={'payment_id':_0x5cd352,'order_id':_0x504695},_0x21717d=JSON[_0x4536a7(0x158)](_0xee4fe4),_0x3ae893=this[_0x4536a7(0x154)](_0x265892===_0x4536a7(0x179)?_0x4536a7(0x173):_0x4536a7(0x229)),{key:_0x1192f1,iv:_0x3e267c}=this[_0x4536a7(0x202)](),_0x395424=this[_0x4536a7(0x1b6)](_0x21717d,_0x1192f1,_0x3e267c),_0x12671b=this[_0x4536a7(0x209)](_0x1192f1,_0x3e267c,_0x3ae893[_0x4536a7(0x12e)]),_0x26e771=this['signRSA'](_0x21717d,_0x3ae893[_0x4536a7(0x1fd)]),_0x3ce1a6={'merchant_point_id':_0x3ae893[_0x4536a7(0x193)],'method':_0x4536a7(0x224),'info':_0x395424,'key':_0x12671b,'sign':_0x26e771,'lang':'en'};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x265892[_0x4536a7(0x188)](),_0x4536a7(0x141),_0x4536a7(0xe5),{'merchant_point_id':_0x3ae893[_0x4536a7(0x193)],'method':_0x4536a7(0x224),'lang':'en'});const _0x44d1bc=Date[_0x4536a7(0x120)](),_0x73635e=await fetch(_0x3ae893['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x4536a7(0xfa),'Accept':_0x4536a7(0xfa),'User-Agent':_0x4536a7(0x1a9)},'body':JSON[_0x4536a7(0x158)](_0x3ce1a6)}),_0x17c8c1=Date[_0x4536a7(0x120)]()-_0x44d1bc;if(!_0x73635e['ok']){const _0xce2c20=await _0x73635e[_0x4536a7(0x227)]();loggerService_1[_0x4536a7(0x15a)][_0x4536a7(0x1d6)](_0x265892[_0x4536a7(0x188)](),'/status_raw',_0x73635e[_0x4536a7(0x224)],_0xce2c20,_0x17c8c1);throw new Error(_0x4536a7(0x217)+_0x73635e[_0x4536a7(0x224)]);}const _0x29a39e=await _0x73635e[_0x4536a7(0x128)]();loggerService_1[_0x4536a7(0x15a)][_0x4536a7(0x1d6)](_0x265892['toLowerCase'](),_0x4536a7(0x122),_0x73635e[_0x4536a7(0x224)],_0x29a39e,_0x17c8c1);let _0x1a524d=_0x29a39e;if(_0x29a39e[_0x4536a7(0xee)]&&_0x29a39e[_0x4536a7(0x178)]&&_0x29a39e[_0x4536a7(0xff)]){console['log'](_0x4536a7(0x146));try{const _0xf2856=await this[_0x4536a7(0x1fb)](_0x29a39e[_0x4536a7(0xee)],_0x29a39e[_0x4536a7(0x178)],_0x265892);_0x1a524d=JSON[_0x4536a7(0x17c)](_0xf2856),console[_0x4536a7(0x1ab)](_0x4536a7(0x149)),loggerService_1[_0x4536a7(0x15a)][_0x4536a7(0x1d6)](_0x265892[_0x4536a7(0x188)](),'/status_decrypted',_0x73635e[_0x4536a7(0x224)],_0x1a524d,_0x17c8c1),console[_0x4536a7(0x1ab)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x26d6cb){console[_0x4536a7(0x1ad)](_0x4536a7(0x20f),_0x26d6cb),loggerService_1[_0x4536a7(0x15a)][_0x4536a7(0xe9)](_0x265892[_0x4536a7(0x188)](),_0x4536a7(0xf7),_0x4536a7(0x1db)+_0x26d6cb),_0x1a524d=_0x29a39e;}}else loggerService_1['loggerService'][_0x4536a7(0x1d6)](_0x265892['toLowerCase'](),'/status_decrypted',_0x73635e['status'],_0x1a524d,_0x17c8c1),console['log'](_0x4536a7(0x1bb));console['log']('📊\x20Status\x20check\x20result:',{'status':_0x1a524d[_0x4536a7(0x224)],'final':_0x1a524d[_0x4536a7(0x1ff)],'payment_id':_0x1a524d['payment_id'],'desc':_0x1a524d[_0x4536a7(0x16d)]});let _0x1b8203=_0x4536a7(0x13d);if(_0x1a524d['status']===0x64&&_0x1a524d[_0x4536a7(0x1ff)]===0x1)_0x1b8203='PAID';else{if(_0x1a524d[_0x4536a7(0x1ff)]===0x0||!this['isFinalStatus'](_0x1a524d[_0x4536a7(0x224)]))_0x1b8203=_0x4536a7(0x13d);else _0x1a524d[_0x4536a7(0x1ff)]===0x1||this[_0x4536a7(0x187)](_0x1a524d['status'])?_0x1b8203=_0x4536a7(0x215):_0x1b8203=_0x4536a7(0x13d);}const _0x2bca99=this['getDetailedErrorMessage'](_0x1a524d[_0x4536a7(0x224)],_0x1a524d['desc']);return{'status':_0x1b8203,'final':this[_0x4536a7(0x187)](_0x1a524d[_0x4536a7(0x224)]),'amount':_0x1a524d[_0x4536a7(0x113)],'currency':_0x1a524d['currency'],'date_success':_0x1a524d['date_success'],'description':_0x2bca99};}catch(_0x37f900){console[_0x4536a7(0x1ad)](_0x265892+'\x20status\x20check\x20error:',_0x37f900),loggerService_1['loggerService'][_0x4536a7(0xe9)](_0x265892[_0x4536a7(0x188)](),_0x4536a7(0x141),_0x37f900);throw new Error('Failed\x20to\x20check\x20'+_0x265892+_0x4536a7(0x190)+(_0x37f900 instanceof Error?_0x37f900[_0x4536a7(0xfd)]:'Unknown\x20error'));}}[a51_0x207483(0x1eb)](_0x1d9440,_0x5055b4,_0x510715,_0x697dd7){const _0x465209=a51_0x207483;console['log']('⏰\x20Scheduling\x20status\x20checks\x20for\x20'+_0x697dd7+'\x20payment:\x20'+_0x1d9440+'\x20('+_0x510715+')'),this['clearStatusTimers'](_0x1d9440);const _0x4b9037=[],_0x1cd69d=0x5*0x3c*0x3e8,_0x1f1702=0x2*0x3c*0x3c*0x3e8,_0x443494=Math[_0x465209(0x200)](_0x1f1702/_0x1cd69d);console[_0x465209(0x1ab)]('⏰\x20Will\x20check\x20status\x20'+_0x443494+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x3f9c22=0x1;_0x3f9c22<=_0x443494;_0x3f9c22++){const _0x586462=setTimeout(async()=>{const _0x1666aa=_0x465209;console[_0x1666aa(0x1ab)](_0x1666aa(0x169)+_0x697dd7+_0x1666aa(0x1f3)+_0x3f9c22+'/'+_0x443494+_0x1666aa(0x21e)+_0x1d9440);try{const _0x2eafaf=await this[_0x1666aa(0x1d0)](_0x510715,_0x5055b4,_0x697dd7);console[_0x1666aa(0x1ab)]('📊\x20Status\x20check\x20#'+_0x3f9c22+_0x1666aa(0x1b4),_0x2eafaf),_0x2eafaf['final']&&(console[_0x1666aa(0x1ab)]('✅\x20Payment\x20'+_0x1d9440+_0x1666aa(0x1b0)+_0x2eafaf['status']+_0x1666aa(0x12b)),this[_0x1666aa(0x205)](_0x1d9440),await this[_0x1666aa(0x167)](_0x1d9440,_0x2eafaf['status'],_0x2eafaf));}catch(_0x1e57af){console[_0x1666aa(0x1ad)](_0x1666aa(0x22f)+_0x3f9c22+_0x1666aa(0x101)+_0x1d9440+':',_0x1e57af);}},_0x3f9c22*_0x1cd69d);_0x4b9037['push'](_0x586462);}this[_0x465209(0x1cb)][_0x465209(0x1b9)](_0x1d9440,_0x4b9037),console[_0x465209(0x1ab)](_0x465209(0x21a)+_0x443494+_0x465209(0x1f6)+_0x1d9440);}[a51_0x207483(0x205)](_0x2b6674){const _0x1059dc=a51_0x207483,_0x192a71=this[_0x1059dc(0x1cb)]['get'](_0x2b6674);_0x192a71&&(console['log']('🧹\x20Clearing\x20'+_0x192a71[_0x1059dc(0x1f9)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x2b6674),_0x192a71[_0x1059dc(0x1f5)]((_0x4392f3,_0xec0752)=>{clearTimeout(_0x4392f3);}),this[_0x1059dc(0x1cb)]['delete'](_0x2b6674));}async[a51_0x207483(0x167)](_0x35a83a,_0x13b949,_0x4f53db){const _0x4bd9af=a51_0x207483;try{const _0x5210ff=(await Promise[_0x4bd9af(0xeb)]()[_0x4bd9af(0x233)](()=>__importStar(require(_0x4bd9af(0x23a)))))[_0x4bd9af(0x1f8)],_0x21415a={'status':_0x13b949[_0x4bd9af(0x1a2)](),'updatedAt':new Date(),'statusChangedBy':_0x4bd9af(0xf1),'statusChangedAt':new Date()};_0x13b949==='PAID'&&(_0x21415a[_0x4bd9af(0x16e)]=new Date()),_0x13b949===_0x4bd9af(0x215)&&_0x4f53db[_0x4bd9af(0x1cd)]&&(_0x21415a[_0x4bd9af(0x1e5)]=_0x4f53db[_0x4bd9af(0x1cd)],console[_0x4bd9af(0x1ab)]('💾\x20Saving\x20failure\x20message:\x20'+_0x4f53db[_0x4bd9af(0x1cd)])),await _0x5210ff[_0x4bd9af(0x225)][_0x4bd9af(0x119)]({'where':{'id':_0x35a83a},'data':_0x21415a}),console[_0x4bd9af(0x1ab)](_0x4bd9af(0x130)+_0x35a83a+_0x4bd9af(0x117)+_0x13b949),await this['sendPaymentNotifications'](_0x35a83a,_0x13b949);}catch(_0x324834){console['error'](_0x4bd9af(0x15c)+_0x35a83a+':',_0x324834);}}async['sendPaymentNotifications'](_0x63a485,_0x3297c1){const _0x847200=a51_0x207483;try{const _0x2d9c98=(await Promise[_0x847200(0xeb)]()[_0x847200(0x233)](()=>__importStar(require(_0x847200(0x23a)))))['default'],{telegramBotService:_0x41b67f}=await Promise[_0x847200(0xeb)]()['then'](()=>__importStar(require(_0x847200(0x21b)))),_0x2cc026=await _0x2d9c98[_0x847200(0x225)][_0x847200(0x16b)]({'where':{'id':_0x63a485},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x2cc026)return;const _0x190c35={'PAID':_0x847200(0x18b),'FAILED':_0x847200(0x1f4)},_0x21459d=_0x190c35[_0x3297c1];_0x21459d&&await _0x41b67f[_0x847200(0x1ca)](_0x2cc026['shopId'],_0x2cc026,_0x21459d),await this[_0x847200(0x13b)](_0x2cc026,_0x3297c1);}catch(_0x2eaeaa){console[_0x847200(0x1ad)](_0x847200(0xea),_0x2eaeaa);}}async['sendShopWebhook'](_0x1efe4c,_0x41bb20){const _0x575f48=a51_0x207483,_0x1ac36e=Date[_0x575f48(0x120)]();try{const _0x3caab0=_0x1efe4c['shop'],_0x11bf28=_0x3caab0[_0x575f48(0x17b)];if(!_0x11bf28?.[_0x575f48(0xdc)]){console[_0x575f48(0x1ab)](_0x575f48(0x231)+_0x3caab0['id']);return;}const _0x5886ab=_0x41bb20===_0x575f48(0x11d)?_0x575f48(0x210):_0x575f48(0x180);let _0x24d3a9=[];if(_0x11bf28['webhookEvents'])try{_0x24d3a9=Array[_0x575f48(0x1e3)](_0x11bf28[_0x575f48(0x144)])?_0x11bf28['webhookEvents']:JSON[_0x575f48(0x17c)](_0x11bf28[_0x575f48(0x144)]);}catch(_0x219700){console['error'](_0x575f48(0x22b),_0x219700),_0x24d3a9=[];}if(!_0x24d3a9[_0x575f48(0x1c6)](_0x5886ab)){console[_0x575f48(0x1ab)](_0x575f48(0x17f)+_0x5886ab+_0x575f48(0x19c)+_0x3caab0['id']);return;}const _0x31673c={'event':_0x5886ab,'payment':{'id':_0x1efe4c['id'],'order_id':_0x1efe4c[_0x575f48(0x1c2)],'gateway_order_id':_0x1efe4c['gatewayOrderId'],'gateway':_0x575f48(0x1c7),'amount':_0x1efe4c['amount'],'currency':_0x1efe4c[_0x575f48(0x220)],'status':_0x41bb20['toLowerCase'](),'customer_email':_0x1efe4c[_0x575f48(0x103)],'customer_name':_0x1efe4c[_0x575f48(0xf4)],'created_at':_0x1efe4c[_0x575f48(0x1ef)],'updated_at':new Date()}},_0x5ec204=await fetch(_0x11bf28['webhookUrl'],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x575f48(0x22d)},'body':JSON[_0x575f48(0x158)](_0x31673c)}),_0x12dbbf=Date[_0x575f48(0x120)]()-_0x1ac36e;loggerService_1[_0x575f48(0x15a)][_0x575f48(0x19e)](_0x1efe4c[_0x575f48(0x164)],_0x11bf28[_0x575f48(0xdc)],_0x5886ab,_0x5ec204[_0x575f48(0x224)],_0x12dbbf,_0x31673c),console[_0x575f48(0x1ab)](_0x575f48(0xdd)+_0x11bf28['webhookUrl']+_0x575f48(0xe1)+_0x5ec204['status']+'\x20('+_0x12dbbf+'ms)');}catch(_0x276344){console[_0x575f48(0x1ad)](_0x575f48(0x1d3),_0x276344),loggerService_1[_0x575f48(0x15a)][_0x575f48(0x19b)](_0x1efe4c[_0x575f48(0x164)],_0x1efe4c[_0x575f48(0x107)]?.['settings']?.['webhookUrl']||'unknown',_0x575f48(0x148),_0x276344,{});}}[a51_0x207483(0x192)](_0x4ccb20){const _0x148d84=a51_0x207483,_0x27a03c=_0x4ccb20['replace'](/[\s-]/g,'');if(_0x27a03c[_0x148d84(0x1f9)]<0x4)return'****';return'****\x20****\x20****\x20'+_0x27a03c[_0x148d84(0x1ea)](-0x4);}async[a51_0x207483(0x1c1)](_0x2cb069,_0x40cd9e='MASTERCARD'){const _0x3e1cb0=a51_0x207483;console[_0x3e1cb0(0x1ab)](_0x3e1cb0(0x10d),JSON[_0x3e1cb0(0x158)](_0x2cb069,null,0x2));let _0x541650=_0x2cb069,_0x31d3d3=_0x40cd9e;_0x2cb069[_0x3e1cb0(0x203)]?(_0x31d3d3=_0x2cb069[_0x3e1cb0(0x203)][_0x3e1cb0(0x1a2)]()===_0x3e1cb0(0x179)?_0x3e1cb0(0x179):_0x3e1cb0(0xfe),console['log']('🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20'+_0x31d3d3)):console[_0x3e1cb0(0x1ab)](_0x3e1cb0(0x100)+_0x31d3d3);if(_0x2cb069[_0x3e1cb0(0xee)]&&_0x2cb069[_0x3e1cb0(0x178)]&&_0x2cb069[_0x3e1cb0(0xff)]){console[_0x3e1cb0(0x1ab)](_0x3e1cb0(0x11e));try{const _0x3aecc7=await this['decryptResponsePhp'](_0x2cb069[_0x3e1cb0(0xee)],_0x2cb069[_0x3e1cb0(0x178)],_0x31d3d3);_0x541650=JSON[_0x3e1cb0(0x17c)](_0x3aecc7),console[_0x3e1cb0(0x1ab)](_0x3e1cb0(0x1ec)),console[_0x3e1cb0(0x1ab)]('📝\x20Decrypted\x20webhook\x20data:',JSON[_0x3e1cb0(0x158)](_0x541650,null,0x2));}catch(_0xba6a5e){console['error'](_0x3e1cb0(0x221),_0xba6a5e),console['log'](_0x3e1cb0(0x1da)),_0x541650=_0x2cb069;}}else console['log'](_0x3e1cb0(0x1fe));let _0x24ff41=_0x3e1cb0(0x13d);if(_0x541650[_0x3e1cb0(0x224)]===0x64&&_0x541650[_0x3e1cb0(0x1ff)]===0x1)_0x24ff41=_0x3e1cb0(0x11d);else{if(_0x541650[_0x3e1cb0(0x1ff)]===0x0||!this[_0x3e1cb0(0x187)](_0x541650[_0x3e1cb0(0x224)]))_0x24ff41=_0x3e1cb0(0x13d);else _0x541650[_0x3e1cb0(0x1ff)]===0x1||this[_0x3e1cb0(0x187)](_0x541650[_0x3e1cb0(0x224)])?_0x24ff41=_0x3e1cb0(0x215):_0x24ff41=_0x3e1cb0(0x13d);}let _0x24ca92='';if(_0x541650[_0x3e1cb0(0x1a6)])_0x24ca92=_0x541650[_0x3e1cb0(0x1a6)][_0x3e1cb0(0x1f1)](),console[_0x3e1cb0(0x1ab)]('🔍\x20Using\x20'+_0x31d3d3+'\x20order_id\x20for\x20search:\x20'+_0x24ca92);else _0x541650[_0x3e1cb0(0xe8)]?(_0x24ca92=_0x541650[_0x3e1cb0(0xe8)]['toString'](),console[_0x3e1cb0(0x1ab)]('🔍\x20Using\x20'+_0x31d3d3+_0x3e1cb0(0x133)+_0x24ca92)):(_0x24ca92=_0x541650[_0x3e1cb0(0x1c2)]||_0x541650[_0x3e1cb0(0x19a)]||_0x541650['id']||'',console['log']('🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20'+_0x24ca92));console[_0x3e1cb0(0x1ab)](_0x3e1cb0(0x170)+_0x31d3d3+_0x3e1cb0(0x1e0)),console[_0x3e1cb0(0x1ab)](_0x3e1cb0(0x198)+_0x24ca92+_0x3e1cb0(0x105)+_0x541650[_0x3e1cb0(0x1a6)]+_0x3e1cb0(0x125)+_0x541650[_0x3e1cb0(0x1c2)]+_0x3e1cb0(0x1ac)+_0x541650['payment_id']+_0x3e1cb0(0x214)+_0x541650[_0x3e1cb0(0x19a)]+_0x3e1cb0(0x13f)+_0x541650['id']+')'),console['log'](_0x3e1cb0(0x1e8)+_0x24ff41+'\x20(from:\x20status='+_0x541650[_0x3e1cb0(0x224)]+_0x3e1cb0(0x14e)+_0x541650[_0x3e1cb0(0x1ff)]+')'),console['log']('\x20\x20\x20Amount:\x20'+_0x541650['amount']),console[_0x3e1cb0(0x1ab)](_0x3e1cb0(0xdb)+_0x541650['currency']);let _0x549ce9;_0x24ff41===_0x3e1cb0(0x215)&&(_0x549ce9=this['getDetailedErrorMessage'](_0x541650[_0x3e1cb0(0x224)],_0x541650[_0x3e1cb0(0x16d)]),console[_0x3e1cb0(0x1ab)](_0x3e1cb0(0x197)+_0x549ce9));const _0x28396a={'paymentId':_0x24ca92,'status':_0x24ff41,'amount':_0x541650[_0x3e1cb0(0x113)],'currency':_0x541650['currency']};return _0x549ce9&&(_0x28396a[_0x3e1cb0(0x118)]=_0x549ce9),_0x28396a;}['stopAllStatusChecks'](){const _0x2cced9=a51_0x207483;console['log'](_0x2cced9(0x142));const _0x470e70=this[_0x2cced9(0x1cb)][_0x2cced9(0x1e7)];for(const [_0x2d80a5]of this[_0x2cced9(0x1cb)]){this[_0x2cced9(0x205)](_0x2d80a5);}console[_0x2cced9(0x1ab)](_0x2cced9(0x163)+_0x470e70+_0x2cced9(0x152));}}exports[a51_0x207483(0x1d1)]=VisaMasterCardService;