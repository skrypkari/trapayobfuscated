'use strict';function a49_0x589f(){const _0x4cece2=['warn','forEach','\x20|\x20Response:\x20','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','adminNotes','🔐\x20RSA\x20signing\x20successful',':\x20Unknown\x20status\x20code',',\x20final=','4038vFjdul','MASTERCARD','⏰\x20Will\x20check\x20status\x20','payment_id','floor','crypto','Payment\x20confirmation\x20time\x20has\x20expired','gatewayOrderId','3ds_url','logShopWebhookSent','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','paymentId','\x22\x20|\x20\x22','\x20for\x20payment\x20','Transaction\x20limit\x20exceeded','2320376GOSiPF','join','The\x20card\x20is\x20lost\x20or\x20stolen','5508960TcAVrO','SHA256','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','Test\x20payment','charge','534552oyifgI','size','paidAt','desc','Awaiting\x20confirmation\x20by\x20ivr\x20call','Order\x20ID:','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','status','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','getDetailedErrorMessage','payment','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','❌\x20PHP\x20decryptor\x20request\x20failed:','/status_decrypted','\x20payment\x20status:\x20','error','\x20\x20\x20-\x20info\x20length:','🔍\x20','\x20\x20Cleaned:\x20\x20\x22','📝\x20Signature\x20length:','orderId','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','🔐\x20VISA\x20Public\x20key\x20length:\x20','order_id','unknown','❌\x20Status\x20check\x20#','sign','\x20\x20\x20Amount:\x20','stopAllStatusChecks','5000000000000000','\x20with\x20status\x20','PIN\x20code\x20confirmation\x20awaited','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','Unknown\x20error','45YcmaJs','📊\x20Status\x20check\x20#','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','Number\x20of\x20attempts\x20exceeded','__esModule','base64','shop','update',',\x20Desc:\x20','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','❌\x20Data\x20being\x20signed:','🛑\x20Stopped\x20','Payment\x20is\x20being\x20processed','🔐\x20MasterCard\x20Private\x20key\x20path:','🧹\x20Clearing\x20','\x20characters','\x20status\x20checks\x20for\x20payment\x20','validateKeyFiles','message','scheduleStatusChecks','push','failed',',\x20orderId=','/status_raw','LookUp\x20number\x20of\x20attempts\x20exceeded','defineProperty','parse','default','get','📝\x20Decrypted\x20webhook\x20data:','getCardTypeAndApi','VISA','expire_year','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key',',\x20body:\x20','create','6258HAMmkc','currency','maskCardNumber','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','utf8','then','Client\x20OTP\x20confirmation\x20required','isFinalStatus','\x20\x20\x20-\x20key\x20length:','Error\x20details:','webhookUrl','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','🔍\x20Using\x20','expire_month','randomBytes','visaPrivateKeyPath','includes','Failed\x20to\x20send\x20payment\x20notifications:','Payment\x20pending\x20verification','Payment\x20returned',',\x20id=','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','🧹\x20Card\x20holder\x20names\x20cleaned:','logWhiteDomainResponse',',\x20paymentId=',',\x20Final:\x20','📊\x20Checking\x20','webhook_send','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','4000000000000000','checkPaymentStatus','info','visaApiUrl','****','privateDecrypt',',\x20payment_id=','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','log','call','Recipient\x20data\x20required','substring','VisaMasterCardService','customerName','1111','📝\x20Data\x20to\x20sign\x20length:','getOwnPropertyDescriptor','\x20failed\x20for\x20payment\x20','🔐\x20Data\x20encrypted\x20with\x20AES','settings','❌\x20RSA\x20signing\x20failed:','📝\x20Final\x20request\x20structure:','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','length','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','signRSA','Invalid\x20expiration\x20date','https://api.paydmeth.com/api','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','💾\x20Saving\x20failure\x20message:\x20','🔐\x20Using\x20keys:\x20','FAILED','Final:','/charge_decrypted','5XzVnpA','visa/mastercard','/charge_raw','PAID','31229vYWcmq','\x20payment_id\x20for\x20search:\x20','📝\x20Encrypted\x20data\x20length:','1720oOWmkE','paid','Payment\x20confirmation\x20required','number','POST','logWhiteDomainError','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','Failed\x20to\x20send\x20MasterCard\x20webhook:','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','PHP\x20decryptor\x20error','📊\x20Status\x20check\x20result:','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','logShopWebhookError','slice','json','📤\x20Sending\x20request\x20to\x20API...','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','writable','shopId','Unsuccessful\x20payment','__createBinding','\x20\x20\x20Status:\x20','generateAESKey','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','Failed\x20to\x20check\x20','✅\x20Payment\x20successful','statusCheckTimers','\x20status\x20updated\x20to\x20','replace','\x20\x20\x20-\x20lang:\x20en','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','Payment\x20System/1.0\x20(MasterCard)','🔐\x203DS\x20verification\x20required','Status\x20','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','834uEzRpC','\x20status\x20check\x20error:','trim','HTTP\x20error!\x20status:\x20','decryptResponse','-----BEGIN','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','🔐\x20VISA\x20Private\x20key\x20path:','decryptAES','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','keys','-----END','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','createDecipheriv','...','private.pem','visaPublicKeyPath','LookUp\x20code\x20verified','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','privateKeyPath','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','💳\x20VISA/MasterCard\x20service\x20initialized','cvv','💾\x20Payment\x20data\x20prepared','The\x20card\x20does\x20not\x20exist','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','end','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','visa_public.pem','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','✅\x20Status\x20response\x20decrypted\x20successfully','stringify','from','\x20result:','cwd','Cancellation\x20is\x20not\x20possible','processCardPayment','card_type','toLowerCase','prototype','🔐\x20VISA\x20Private\x20key\x20length:\x20','MasterCard\x20webhook\x20sent\x20to\x20','Card\x20Number:','final','📝\x20Data\x20length:','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','23064BTjiek','logWhiteDomainRequest','🔐\x20MasterCard\x20Public\x20key\x20path:','Response\x20Body:','set','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','cardType','webhookEvents','readFileSync','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','\x20payment:\x20','date_success','LookUp\x20not\x20confirmed','Payment\x20System/1.0','createSign','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','===\x20API\x20RESPONSE\x20===','masterCardMerchantPointId','resolve','Expected\x20bitcoin\x20transfer\x20from\x20client','Awaiting\x20confirmation\x20in\x20the\x20application','📝\x20Encrypted\x20key\x20length:','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','\x20MasterCard\x20status\x20check\x20timers','masterCardApiUrl','toString','../telegramBotService','6eQYoTO','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','publicEncrypt','existsSync','loggerService','3DS\x20verification\x20required','PENDING','now','RSA_PKCS1_PADDING','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','Failed\x20payment','application/json','🔐\x20Data\x20signed\x20with\x20RSA','errorMessage','sendPaymentNotifications','\x20order_id\x20for\x20search:\x20','first_name','\x20\x20\x20Currency:\x20','No\x20New\x20payment','aes-256-ctr','payment.success','Card\x20Holder:','****\x20****\x20****\x20','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','Response\x20Time:','/charge','amount','../../config/database','publicKeyPath','visaMerchantPointId','description','sendShopWebhook','merchantPointId','Failed\x20to\x20decrypt\x20response','Amount:','Decryption\x20failed:\x20','toUpperCase','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','apiUrl','key','🔐\x20VISA\x20API\x20URL:','psp_public.pem','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','🔍\x20Using\x20provided\x20card\x20type:\x20','decryptResponsePhp','🔐\x20AES\x20key\x20length:','paymentStatuses','hasOwnProperty','path','encryptRSA','visa_private.pem','sendPaymentNotification','delete','\x20status\x20timers\x20for\x20payment\x20','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','✅\x20Payment\x20','last_name','encryptAES','\x20is\x20final\x20(','Insufficient\x20funds\x20on\x20the\x20card','/status','clearStatusTimers','Payment\x20prohibited','text','Another\x20unknown\x20error','Payment\x20ID:'];a49_0x589f=function(){return _0x4cece2;};return a49_0x589f();}const a49_0x3ff292=a49_0x594a;(function(_0x55dc2b,_0x519a8e){const _0x210067=a49_0x594a,_0xad32da=_0x55dc2b();while(!![]){try{const _0x3b8800=-parseInt(_0x210067(0x1b5))/0x1+parseInt(_0x210067(0x187))/0x2*(parseInt(_0x210067(0x1d0))/0x3)+-parseInt(_0x210067(0x229))/0x4*(parseInt(_0x210067(0x15c))/0x5)+-parseInt(_0x210067(0x21a))/0x6*(-parseInt(_0x210067(0x27a))/0x7)+-parseInt(_0x210067(0x231))/0x8*(-parseInt(_0x210067(0x256))/0x9)+-parseInt(_0x210067(0x163))/0xa*(-parseInt(_0x210067(0x160))/0xb)+-parseInt(_0x210067(0x22c))/0xc;if(_0x3b8800===_0x519a8e)break;else _0xad32da['push'](_0xad32da['shift']());}catch(_0x490d8c){_0xad32da['push'](_0xad32da['shift']());}}}(a49_0x589f,0x588a5));var __createBinding=this&&this[a49_0x3ff292(0x178)]||(Object[a49_0x3ff292(0x279)]?function(_0x44dae3,_0x323117,_0x5b870b,_0x3ddfd7){const _0x1f9059=a49_0x3ff292;if(_0x3ddfd7===undefined)_0x3ddfd7=_0x5b870b;var _0x40a2d8=Object[_0x1f9059(0x149)](_0x323117,_0x5b870b);(!_0x40a2d8||('get'in _0x40a2d8?!_0x323117[_0x1f9059(0x25a)]:_0x40a2d8[_0x1f9059(0x175)]||_0x40a2d8['configurable']))&&(_0x40a2d8={'enumerable':!![],'get':function(){return _0x323117[_0x5b870b];}}),Object[_0x1f9059(0x26f)](_0x44dae3,_0x3ddfd7,_0x40a2d8);}:function(_0x333661,_0x44a603,_0x4aea28,_0xac68e0){if(_0xac68e0===undefined)_0xac68e0=_0x4aea28;_0x333661[_0xac68e0]=_0x44a603[_0x4aea28];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a49_0x3ff292(0x279)]?function(_0x57ec80,_0x1104ec){const _0x4ed3c5=a49_0x3ff292;Object[_0x4ed3c5(0x26f)](_0x57ec80,_0x4ed3c5(0x271),{'enumerable':!![],'value':_0x1104ec});}:function(_0x14e045,_0x1a9711){_0x14e045['default']=_0x1a9711;}),__importStar=this&&this['__importStar']||(function(){var _0x42bb81=function(_0x31e1b1){return _0x42bb81=Object['getOwnPropertyNames']||function(_0x1d7a59){const _0x54637e=a49_0x594a;var _0x569dc7=[];for(var _0x33a7ca in _0x1d7a59)if(Object[_0x54637e(0x1ae)][_0x54637e(0x1ff)][_0x54637e(0x142)](_0x1d7a59,_0x33a7ca))_0x569dc7[_0x569dc7['length']]=_0x33a7ca;return _0x569dc7;},_0x42bb81(_0x31e1b1);};return function(_0x362105){const _0x2cea35=a49_0x594a;if(_0x362105&&_0x362105[_0x2cea35(0x25a)])return _0x362105;var _0x442477={};if(_0x362105!=null){for(var _0xb19350=_0x42bb81(_0x362105),_0x44603e=0x0;_0x44603e<_0xb19350[_0x2cea35(0x150)];_0x44603e++)if(_0xb19350[_0x44603e]!==_0x2cea35(0x271))__createBinding(_0x442477,_0x362105,_0xb19350[_0x44603e]);}return __setModuleDefault(_0x442477,_0x362105),_0x442477;};}()),__importDefault=this&&this['__importDefault']||function(_0x1175b7){const _0x1da613=a49_0x3ff292;return _0x1175b7&&_0x1175b7[_0x1da613(0x25a)]?_0x1175b7:{'default':_0x1175b7};};Object[a49_0x3ff292(0x26f)](exports,a49_0x3ff292(0x25a),{'value':!![]}),exports[a49_0x3ff292(0x145)]=void 0x0;const crypto_1=__importDefault(require(a49_0x3ff292(0x21f))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x3ff292(0x200))),loggerService_1=require('../loggerService');function a49_0x594a(_0x4085b1,_0x811a81){const _0x589fac=a49_0x589f();return a49_0x594a=function(_0x594ad2,_0x4365e6){_0x594ad2=_0x594ad2-0x136;let _0x5eb7c4=_0x589fac[_0x594ad2];return _0x5eb7c4;},a49_0x594a(_0x4085b1,_0x811a81);}class VisaMasterCardService{constructor(){const _0x26ab88=a49_0x3ff292;this[_0x26ab88(0x17e)]=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0x26ab88(0x1e2)},0x1:{'final':![],'description':'No\x20Error\x20executing\x20request'},0x2:{'final':!![],'description':'Request\x20data\x20error'},0x3:{'final':!![],'description':_0x26ab88(0x210)},0x4:{'final':!![],'description':_0x26ab88(0x177)},0x5:{'final':!![],'description':_0x26ab88(0x1d9)},0x6:{'final':!![],'description':'Payment\x20returned'},0x7:{'final':!![],'description':_0x26ab88(0x22f)},0x8:{'final':![],'description':_0x26ab88(0x280)},0x9:{'final':![],'description':_0x26ab88(0x1d5)},0xa:{'final':![],'description':'Sender\x27s\x20CVV\x20card\x20is\x20required'},0xb:{'final':![],'description':'Sender\x20information\x20required'},0xc:{'final':![],'description':_0x26ab88(0x143)},0xd:{'final':![],'description':'Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number'},0xe:{'final':![],'description':_0x26ab88(0x235)},0xf:{'final':![],'description':_0x26ab88(0x253)},0x10:{'final':![],'description':'Captcha\x20confirmation\x20awaited'},0x11:{'final':![],'description':'Awaiting\x20confirmation\x20of\x20the\x20login\x20password'},0x12:{'final':![],'description':_0x26ab88(0x1c9)},0x13:{'final':![],'description':_0x26ab88(0x262)},0x14:{'final':![],'description':_0x26ab88(0x254)},0x15:{'final':![],'description':_0x26ab88(0x1c8)},0x16:{'final':![],'description':_0x26ab88(0x28c)},0x18:{'final':![],'description':_0x26ab88(0x174)},0x19:{'final':![],'description':_0x26ab88(0x199)},0x1a:{'final':!![],'description':'Cash\x20payment\x20is\x20expected\x20at\x20TCO'},0x1b:{'final':![],'description':'Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code'},0x1c:{'final':![],'description':_0x26ab88(0x1a4)},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':_0x26ab88(0x173)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':'Sender\x27s\x20card\x20details\x20are\x20required'},0x24:{'final':!![],'description':_0x26ab88(0x220)},0x25:{'final':!![],'description':_0x26ab88(0x20e)},0x26:{'final':!![],'description':'The\x20payment\x20status\x20must\x20be\x20clarified\x20manually'},0x27:{'final':!![],'description':_0x26ab88(0x20b)},0x28:{'final':!![],'description':_0x26ab88(0x19f)},0x29:{'final':!![],'description':_0x26ab88(0x22b)},0x2a:{'final':!![],'description':_0x26ab88(0x154)},0x2b:{'final':!![],'description':_0x26ab88(0x228)},0x2c:{'final':!![],'description':_0x26ab88(0x1fa)},0x2d:{'final':!![],'description':_0x26ab88(0x1da)},0x2e:{'final':!![],'description':'Unsuccessful\x20payment'},0x2f:{'final':!![],'description':_0x26ab88(0x177)},0x30:{'final':!![],'description':_0x26ab88(0x169)},0x31:{'final':![],'description':_0x26ab88(0x165)},0x32:{'final':!![],'description':'Method\x20not\x20allowed'},0x33:{'final':!![],'description':_0x26ab88(0x1da)},0x34:{'final':!![],'description':_0x26ab88(0x1da)},0x35:{'final':!![],'description':_0x26ab88(0x1da)},0x36:{'final':!![],'description':'Failed\x20payment'},0x37:{'final':!![],'description':_0x26ab88(0x1da)},0x38:{'final':!![],'description':_0x26ab88(0x1aa)},0x39:{'final':![],'description':_0x26ab88(0x16e)},0x3a:{'final':![],'description':'LookUp\x20code\x20sent'},0x3b:{'final':!![],'description':_0x26ab88(0x198)},0x3c:{'final':!![],'description':_0x26ab88(0x259)},0x3d:{'final':!![],'description':_0x26ab88(0x1e7)},0x3e:{'final':!![],'description':'Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID'},0x3f:{'final':!![],'description':_0x26ab88(0x28d)},0x40:{'final':![],'description':_0x26ab88(0x1c1)},0x41:{'final':!![],'description':_0x26ab88(0x26e)},0x42:{'final':![],'description':'Payment\x20cancellation\x20is\x20being\x20processed'},0x43:{'final':!![],'description':'Technical\x20limit,\x20contact\x20your\x20personal\x20manager'},0x44:{'final':![],'description':_0x26ab88(0x1d5)},0x45:{'final':!![],'description':'Failed\x20payment'},0x46:{'final':!![],'description':'Failed\x20payment'},0x47:{'final':!![],'description':_0x26ab88(0x23e)},0x64:{'final':!![],'description':'Operation\x20completed\x20successfully'}},this[_0x26ab88(0x1cd)]=_0x26ab88(0x155),this[_0x26ab88(0x1c6)]=0x6e4,this[_0x26ab88(0x19a)]=path_1['default']['join'](process[_0x26ab88(0x1a9)](),_0x26ab88(0x191),_0x26ab88(0x196)),this[_0x26ab88(0x1ec)]=path_1[_0x26ab88(0x271)][_0x26ab88(0x22a)](process[_0x26ab88(0x1a9)](),_0x26ab88(0x191),_0x26ab88(0x1f9)),this[_0x26ab88(0x13c)]=_0x26ab88(0x155),this['visaMerchantPointId']=0x6b7,this[_0x26ab88(0x289)]=path_1['default'][_0x26ab88(0x22a)](process[_0x26ab88(0x1a9)](),_0x26ab88(0x191),_0x26ab88(0x202)),this[_0x26ab88(0x197)]=path_1[_0x26ab88(0x271)][_0x26ab88(0x22a)](process['cwd'](),_0x26ab88(0x191),_0x26ab88(0x1a3)),console['log'](_0x26ab88(0x19c)),console[_0x26ab88(0x141)]('🔐\x20MasterCard\x20API\x20URL:',this[_0x26ab88(0x1cd)]),console[_0x26ab88(0x141)](_0x26ab88(0x1f8),this[_0x26ab88(0x13c)]),console[_0x26ab88(0x141)](_0x26ab88(0x263),this[_0x26ab88(0x19a)]),console[_0x26ab88(0x141)](_0x26ab88(0x1b7),this[_0x26ab88(0x1ec)]),console[_0x26ab88(0x141)](_0x26ab88(0x18e),this['visaPrivateKeyPath']),console[_0x26ab88(0x141)]('🔐\x20VISA\x20Public\x20key\x20path:',this[_0x26ab88(0x197)]),this[_0x26ab88(0x267)]();}[a49_0x3ff292(0x23a)](_0x10d5cc,_0x283882){const _0x5073b0=a49_0x3ff292,_0x29f8ee=this[_0x5073b0(0x1fe)][_0x10d5cc];let _0x3ae57d='';_0x29f8ee?_0x3ae57d=_0x5073b0(0x185)+_0x10d5cc+':\x20'+_0x29f8ee[_0x5073b0(0x1ee)]:_0x3ae57d=_0x5073b0(0x185)+_0x10d5cc+_0x5073b0(0x218);if(_0x283882&&_0x283882[_0x5073b0(0x189)]()){const _0x4ee45f=_0x283882[_0x5073b0(0x189)]();(!_0x29f8ee||_0x4ee45f[_0x5073b0(0x1ad)]()!==_0x29f8ee['description'][_0x5073b0(0x1ad)]())&&(_0x3ae57d+=_0x5073b0(0x214)+_0x4ee45f);}return _0x3ae57d;}[a49_0x3ff292(0x281)](_0x58e98f){const _0x58cf67=a49_0x3ff292,_0x3a1a58=this[_0x58cf67(0x1fe)][_0x58e98f];return _0x3a1a58?_0x3a1a58['final']:!![];}[a49_0x3ff292(0x274)](_0x1397e0){const _0x161aa1=a49_0x3ff292,_0x16fd78=_0x1397e0['charAt'](0x0);if(_0x16fd78==='4')return console['log'](_0x161aa1(0x237)),{'cardType':_0x161aa1(0x275),'apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x161aa1(0x289)],'publicKeyPath':this[_0x161aa1(0x197)],'merchantPointId':this[_0x161aa1(0x1ed)]};else return _0x16fd78==='5'?(console[_0x161aa1(0x141)](_0x161aa1(0x19b)),{'cardType':_0x161aa1(0x21b),'apiUrl':this[_0x161aa1(0x1cd)],'privateKeyPath':this[_0x161aa1(0x19a)],'publicKeyPath':this[_0x161aa1(0x1ec)],'merchantPointId':this['masterCardMerchantPointId']}):(console[_0x161aa1(0x141)]('💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20'+_0x16fd78+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':_0x161aa1(0x21b),'apiUrl':this[_0x161aa1(0x1cd)],'privateKeyPath':this[_0x161aa1(0x19a)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x161aa1(0x1c6)]});}['validateKeyFiles'](){const _0x1c0ea6=a49_0x3ff292;try{if(!fs_1[_0x1c0ea6(0x271)][_0x1c0ea6(0x1d3)](this['privateKeyPath']))throw new Error(_0x1c0ea6(0x248)+this[_0x1c0ea6(0x19a)]);if(!fs_1[_0x1c0ea6(0x271)][_0x1c0ea6(0x1d3)](this['publicKeyPath']))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this[_0x1c0ea6(0x1ec)]);const _0x2fde56=fs_1[_0x1c0ea6(0x271)][_0x1c0ea6(0x1bd)](this[_0x1c0ea6(0x19a)],_0x1c0ea6(0x27e))[_0x1c0ea6(0x189)](),_0x114788=fs_1[_0x1c0ea6(0x271)]['readFileSync'](this[_0x1c0ea6(0x1ec)],_0x1c0ea6(0x27e))[_0x1c0ea6(0x189)]();if(!_0x2fde56['includes'](_0x1c0ea6(0x18c))||!_0x2fde56[_0x1c0ea6(0x28a)](_0x1c0ea6(0x192)))throw new Error(_0x1c0ea6(0x285));if(!_0x114788['includes'](_0x1c0ea6(0x18c))||!_0x114788[_0x1c0ea6(0x28a)](_0x1c0ea6(0x192)))throw new Error(_0x1c0ea6(0x1c4));console['log'](_0x1c0ea6(0x28f)),console[_0x1c0ea6(0x141)]('🔐\x20MasterCard\x20Private\x20key\x20length:\x20'+_0x2fde56[_0x1c0ea6(0x150)]+_0x1c0ea6(0x265)),console[_0x1c0ea6(0x141)](_0x1c0ea6(0x1cb)+_0x114788['length']+_0x1c0ea6(0x265));if(fs_1[_0x1c0ea6(0x271)][_0x1c0ea6(0x1d3)](this[_0x1c0ea6(0x289)])&&fs_1['default'][_0x1c0ea6(0x1d3)](this[_0x1c0ea6(0x197)])){const _0x720437=fs_1[_0x1c0ea6(0x271)][_0x1c0ea6(0x1bd)](this['visaPrivateKeyPath'],'utf8')[_0x1c0ea6(0x189)](),_0xccdffe=fs_1[_0x1c0ea6(0x271)][_0x1c0ea6(0x1bd)](this[_0x1c0ea6(0x197)],_0x1c0ea6(0x27e))[_0x1c0ea6(0x189)]();(!_0x720437[_0x1c0ea6(0x28a)](_0x1c0ea6(0x18c))||!_0x720437[_0x1c0ea6(0x28a)]('-----END'))&&console[_0x1c0ea6(0x212)](_0x1c0ea6(0x1d1)),(!_0xccdffe[_0x1c0ea6(0x28a)](_0x1c0ea6(0x18c))||!_0xccdffe[_0x1c0ea6(0x28a)]('-----END'))&&console[_0x1c0ea6(0x212)](_0x1c0ea6(0x138)),console['log']('✅\x20VISA\x20key\x20files\x20validated\x20successfully'),console[_0x1c0ea6(0x141)](_0x1c0ea6(0x1af)+_0x720437['length']+_0x1c0ea6(0x265)),console[_0x1c0ea6(0x141)](_0x1c0ea6(0x24a)+_0xccdffe[_0x1c0ea6(0x150)]+_0x1c0ea6(0x265));}else console[_0x1c0ea6(0x212)](_0x1c0ea6(0x206)),console[_0x1c0ea6(0x212)](_0x1c0ea6(0x190)+this[_0x1c0ea6(0x289)]),console['warn'](_0x1c0ea6(0x1b4)+this[_0x1c0ea6(0x197)]);}catch(_0x420d46){console[_0x1c0ea6(0x242)](_0x1c0ea6(0x239),_0x420d46);throw _0x420d46;}}[a49_0x3ff292(0x17a)](){const _0x151758=a49_0x3ff292,_0x23e1e6=crypto_1['default'][_0x151758(0x288)](0x20),_0x411b9a=crypto_1[_0x151758(0x271)]['randomBytes'](0x10);return{'key':_0x23e1e6,'iv':_0x411b9a};}[a49_0x3ff292(0x209)](_0x39c853,_0x615046,_0x2f52df){const _0x575a8e=a49_0x3ff292,_0xc57807=crypto_1[_0x575a8e(0x271)]['createCipheriv'](_0x575a8e(0x1e3),_0x615046,_0x2f52df);let _0x35f6e3=_0xc57807[_0x575a8e(0x25d)](_0x39c853,'utf8',_0x575a8e(0x25b));return _0x35f6e3+=_0xc57807[_0x575a8e(0x1b2)](_0x575a8e(0x25b)),_0x35f6e3;}[a49_0x3ff292(0x201)](_0x316346,_0x2db3ed,_0x586e4c){const _0x46d783=a49_0x3ff292;try{const _0x47fc0b=fs_1[_0x46d783(0x271)][_0x46d783(0x1bd)](_0x586e4c,_0x46d783(0x27e))['trim'](),_0xd947e4={'iv':_0x2db3ed['toString'](_0x46d783(0x25b)),'key':_0x316346[_0x46d783(0x1ce)](_0x46d783(0x25b))},_0x1c3abe=JSON[_0x46d783(0x1a6)](_0xd947e4);console['log'](_0x46d783(0x1be),_0x1c3abe['length']);const _0x4cf186=crypto_1[_0x46d783(0x271)][_0x46d783(0x1d2)]({'key':_0x47fc0b,'padding':crypto_1[_0x46d783(0x271)]['constants'][_0x46d783(0x1d8)]},Buffer[_0x46d783(0x1a7)](_0x1c3abe));return console['log'](_0x46d783(0x156),_0x4cf186['length']),_0x4cf186[_0x46d783(0x1ce)]('base64');}catch(_0x546ba){console[_0x46d783(0x242)]('❌\x20RSA\x20encryption\x20failed:',_0x546ba);throw new Error(_0x46d783(0x277));}}[a49_0x3ff292(0x153)](_0x353851,_0x3a855c){const _0x479f81=a49_0x3ff292;try{const _0x2d1f49=fs_1[_0x479f81(0x271)][_0x479f81(0x1bd)](_0x3a855c,'utf8')[_0x479f81(0x189)](),_0x36e0b2=crypto_1['default'][_0x479f81(0x1c3)](_0x479f81(0x22d));_0x36e0b2[_0x479f81(0x25d)](_0x353851),_0x36e0b2[_0x479f81(0x1a1)]();const _0x34e55d=_0x36e0b2[_0x479f81(0x24e)](_0x2d1f49,'base64');return console[_0x479f81(0x141)](_0x479f81(0x217)),console[_0x479f81(0x141)](_0x479f81(0x148),_0x353851[_0x479f81(0x150)]),console[_0x479f81(0x141)](_0x479f81(0x246),_0x34e55d[_0x479f81(0x150)]),_0x34e55d;}catch(_0x526cd5){console['error'](_0x479f81(0x14d),_0x526cd5),console['error'](_0x479f81(0x260),_0x353851[_0x479f81(0x144)](0x0,0xc8)+_0x479f81(0x195));throw new Error(_0x479f81(0x193));}}[a49_0x3ff292(0x18f)](_0x5a76a8,_0x5ceff8,_0x48d676){const _0x15eaab=a49_0x3ff292,_0x461406=crypto_1[_0x15eaab(0x271)][_0x15eaab(0x194)]('aes-256-ctr',_0x5ceff8,_0x48d676);let _0x26a81e=_0x461406[_0x15eaab(0x25d)](_0x5a76a8,_0x15eaab(0x25b),_0x15eaab(0x27e));return _0x26a81e+=_0x461406['final'](_0x15eaab(0x27e)),_0x26a81e;}async['decryptResponsePhp'](_0x12c827,_0x944fa3,_0x4de1a4=a49_0x3ff292(0x21b)){const _0x5e1efe=a49_0x3ff292;try{const _0x434eb4=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x5e1efe(0x167),'headers':{'Content-Type':_0x5e1efe(0x1db)},'body':JSON[_0x5e1efe(0x1a6)]({'info':_0x12c827,'key':_0x944fa3,'card_type':_0x4de1a4[_0x5e1efe(0x1ad)]()})});if(!_0x434eb4['ok'])throw new Error(_0x5e1efe(0x16c));return await _0x434eb4[_0x5e1efe(0x20f)]();}catch(_0x3c497d){console['error'](_0x5e1efe(0x23f),_0x3c497d);throw new Error(_0x5e1efe(0x151));}}[a49_0x3ff292(0x18b)](_0x1e7141,_0x314d73){const _0x520086=a49_0x3ff292;try{const _0x47b67b=fs_1[_0x520086(0x271)]['readFileSync'](this[_0x520086(0x19a)],_0x520086(0x27e))[_0x520086(0x189)](),_0x2d3772=crypto_1[_0x520086(0x271)][_0x520086(0x13e)](_0x47b67b,Buffer[_0x520086(0x1a7)](_0x314d73,_0x520086(0x25b))),_0x15884c=JSON[_0x520086(0x270)](_0x2d3772[_0x520086(0x1ce)]()),_0x1339c5=Buffer['from'](_0x15884c[_0x520086(0x1f7)],'base64'),_0x312039=Buffer[_0x520086(0x1a7)](_0x15884c['iv'],_0x520086(0x25b));return this[_0x520086(0x18f)](_0x1e7141,_0x1339c5,_0x312039);}catch(_0x4e6d44){throw new Error(_0x520086(0x1f1));}}async[a49_0x3ff292(0x1ab)](_0x6910cc){const _0x18c6e2=a49_0x3ff292,{paymentId:_0x3caf4b,orderId:_0x3abd09,amount:_0x1383d0,currency:_0x1d36f6,cardData:_0x48aec5,resultUrl:_0x144a80,returnUrl:_0x1a34bd,cardHolder:_0x81c502,browser:_0xbc22ae}=_0x6910cc;console[_0x18c6e2(0x141)](_0x18c6e2(0x1a0)),console[_0x18c6e2(0x141)](_0x18c6e2(0x211),_0x3caf4b),console[_0x18c6e2(0x141)](_0x18c6e2(0x236),_0x3abd09),console[_0x18c6e2(0x141)](_0x18c6e2(0x1f2),_0x1383d0,_0x1d36f6),console[_0x18c6e2(0x141)](_0x18c6e2(0x1b1),this[_0x18c6e2(0x27c)](_0x48aec5['number'])),console[_0x18c6e2(0x141)](_0x18c6e2(0x1e5),_0x81c502[_0x18c6e2(0x1e0)]+'\x20'+_0x81c502[_0x18c6e2(0x208)]),console['log']('Return\x20URL:',_0x1a34bd),console['log']('Result\x20URL:',_0x144a80);const _0x3a170e=this[_0x18c6e2(0x274)](_0x48aec5[_0x18c6e2(0x166)]);console[_0x18c6e2(0x141)]('🎯\x20Using\x20'+_0x3a170e[_0x18c6e2(0x1bb)]+'\x20API:\x20'+_0x3a170e[_0x18c6e2(0x1f6)]),console[_0x18c6e2(0x141)](_0x18c6e2(0x158)+_0x3a170e[_0x18c6e2(0x19a)]+',\x20'+_0x3a170e[_0x18c6e2(0x1ec)]);const _0x221ce9={..._0x81c502,'first_name':_0x81c502[_0x18c6e2(0x1e0)]?.[_0x18c6e2(0x180)](/[\t\n\r\f\v]/g,'\x20')[_0x18c6e2(0x189)]()||'','last_name':_0x81c502[_0x18c6e2(0x208)]?.[_0x18c6e2(0x180)](/[\t\n\r\f\v]/g,'\x20')[_0x18c6e2(0x189)]()||''};console[_0x18c6e2(0x141)](_0x18c6e2(0x290)),console[_0x18c6e2(0x141)]('\x20\x20Original:\x20\x22'+_0x81c502[_0x18c6e2(0x1e0)]+'\x22\x20|\x20\x22'+_0x81c502['last_name']+'\x22'),console[_0x18c6e2(0x141)](_0x18c6e2(0x245)+_0x221ce9[_0x18c6e2(0x1e0)]+_0x18c6e2(0x226)+_0x221ce9['last_name']+'\x22');const _0x3e8b6d={'amount':_0x1383d0,'currency':_0x1d36f6[_0x18c6e2(0x1f4)](),'order_id':_0x3abd09,'result_url':_0x144a80,'return_url':_0x1a34bd,'country':'','card':{'number':_0x48aec5[_0x18c6e2(0x166)],'expire_month':_0x48aec5[_0x18c6e2(0x287)],'expire_year':_0x48aec5[_0x18c6e2(0x276)],'cvv':_0x48aec5[_0x18c6e2(0x19d)]},'card_holder':_0x221ce9,'browser':_0xbc22ae},_0x43f12b=JSON[_0x18c6e2(0x1a6)](_0x3e8b6d);console[_0x18c6e2(0x141)](_0x18c6e2(0x19e)),console[_0x18c6e2(0x141)](_0x18c6e2(0x14f)),console[_0x18c6e2(0x141)](_0x43f12b),console[_0x18c6e2(0x141)](_0x18c6e2(0x1b3),_0x43f12b[_0x18c6e2(0x150)]);try{const {key:_0x187790,iv:_0x236475}=this[_0x18c6e2(0x17a)]();console[_0x18c6e2(0x141)]('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console[_0x18c6e2(0x141)](_0x18c6e2(0x1fd),_0x187790[_0x18c6e2(0x150)]),console[_0x18c6e2(0x141)]('🔐\x20AES\x20IV\x20length:',_0x236475[_0x18c6e2(0x150)]);const _0x5e957e=this[_0x18c6e2(0x209)](_0x43f12b,_0x187790,_0x236475);console['log'](_0x18c6e2(0x14b)),console[_0x18c6e2(0x141)](_0x18c6e2(0x162),_0x5e957e[_0x18c6e2(0x150)]);const _0x5778f9=this[_0x18c6e2(0x201)](_0x187790,_0x236475,_0x3a170e['publicKeyPath']);console[_0x18c6e2(0x141)](_0x18c6e2(0x16b)),console[_0x18c6e2(0x141)](_0x18c6e2(0x1ca),_0x5778f9[_0x18c6e2(0x150)]);const _0x5ed910=this[_0x18c6e2(0x153)](_0x43f12b,_0x3a170e[_0x18c6e2(0x19a)]);console[_0x18c6e2(0x141)](_0x18c6e2(0x1dc)),console[_0x18c6e2(0x141)](_0x18c6e2(0x246),_0x5ed910[_0x18c6e2(0x150)]);const _0x9365c2={'merchant_point_id':_0x3a170e['merchantPointId'],'method':_0x18c6e2(0x230),'info':_0x5e957e,'key':_0x5778f9,'sign':_0x5ed910,'lang':'en'};console[_0x18c6e2(0x141)](_0x18c6e2(0x172)),console[_0x18c6e2(0x141)](_0x18c6e2(0x14e)),console['log']('\x20\x20\x20-\x20merchant_point_id:',_0x3a170e[_0x18c6e2(0x1f0)]),console[_0x18c6e2(0x141)]('\x20\x20\x20-\x20method:\x20charge'),console['log'](_0x18c6e2(0x243),_0x5e957e['length']),console['log'](_0x18c6e2(0x282),_0x5778f9[_0x18c6e2(0x150)]),console['log']('\x20\x20\x20-\x20sign\x20length:',_0x5ed910[_0x18c6e2(0x150)]),console[_0x18c6e2(0x141)](_0x18c6e2(0x181)),loggerService_1['loggerService'][_0x18c6e2(0x1b6)](_0x3a170e[_0x18c6e2(0x1bb)]['toLowerCase'](),_0x18c6e2(0x1e9),_0x18c6e2(0x167),{'merchant_point_id':_0x3a170e[_0x18c6e2(0x1f0)],'method':_0x18c6e2(0x230),'lang':'en'});const _0x4f3166=Date['now'](),_0xc89455=await fetch(_0x3a170e[_0x18c6e2(0x1f6)],{'method':_0x18c6e2(0x167),'headers':{'Content-Type':_0x18c6e2(0x1db),'Accept':_0x18c6e2(0x1db),'User-Agent':_0x18c6e2(0x1c2)},'body':JSON['stringify'](_0x9365c2)}),_0x1a0516=Date['now']()-_0x4f3166;console[_0x18c6e2(0x141)](_0x18c6e2(0x1c5)),console[_0x18c6e2(0x141)]('Status:',_0xc89455[_0x18c6e2(0x238)]),console['log'](_0x18c6e2(0x1e8),_0x1a0516+'ms');if(!_0xc89455['ok']){const _0x1cb6b9=await _0xc89455['text']();console[_0x18c6e2(0x242)]('HTTP\x20Status:',_0xc89455[_0x18c6e2(0x238)]),console[_0x18c6e2(0x242)](_0x18c6e2(0x1b8),_0x1cb6b9),loggerService_1[_0x18c6e2(0x1d4)]['logWhiteDomainResponse'](_0x3a170e[_0x18c6e2(0x1bb)]['toLowerCase'](),_0x18c6e2(0x15e),_0xc89455['status'],_0x1cb6b9,_0x1a0516),loggerService_1[_0x18c6e2(0x1d4)][_0x18c6e2(0x168)](_0x3a170e[_0x18c6e2(0x1bb)]['toLowerCase'](),_0x18c6e2(0x1e9),'HTTP\x20'+_0xc89455[_0x18c6e2(0x238)]+':\x20'+_0x1cb6b9);throw new Error(_0x18c6e2(0x18a)+_0xc89455['status']+_0x18c6e2(0x278)+_0x1cb6b9);}const _0x14b029=await _0xc89455[_0x18c6e2(0x171)]();loggerService_1['loggerService'][_0x18c6e2(0x291)](_0x3a170e[_0x18c6e2(0x1bb)][_0x18c6e2(0x1ad)](),_0x18c6e2(0x15e),_0xc89455[_0x18c6e2(0x238)],_0x14b029,_0x1a0516),console[_0x18c6e2(0x141)]('===\x20PARSED\x20API\x20RESPONSE\x20===');let _0x395130=_0x14b029;if(_0x14b029[_0x18c6e2(0x13b)]&&_0x14b029[_0x18c6e2(0x1f7)]&&_0x14b029[_0x18c6e2(0x24e)]){console['log'](_0x18c6e2(0x1a2));try{const _0x50f7de=await this[_0x18c6e2(0x1fc)](_0x14b029[_0x18c6e2(0x13b)],_0x14b029['key'],_0x3a170e[_0x18c6e2(0x1bb)]);_0x395130=JSON[_0x18c6e2(0x270)](_0x50f7de),console[_0x18c6e2(0x141)](_0x18c6e2(0x22e)),loggerService_1[_0x18c6e2(0x1d4)]['logWhiteDomainResponse'](_0x3a170e[_0x18c6e2(0x1bb)][_0x18c6e2(0x1ad)](),'/charge_decrypted',_0xc89455['status'],_0x395130,_0x1a0516),console[_0x18c6e2(0x141)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x2077ac){console['error']('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x2077ac),loggerService_1[_0x18c6e2(0x1d4)]['logWhiteDomainError'](_0x3a170e[_0x18c6e2(0x1bb)]['toLowerCase'](),'/charge_decrypt',_0x18c6e2(0x1f3)+_0x2077ac),_0x395130=_0x14b029;}}else loggerService_1[_0x18c6e2(0x1d4)][_0x18c6e2(0x291)](_0x3a170e[_0x18c6e2(0x1bb)][_0x18c6e2(0x1ad)](),_0x18c6e2(0x15b),_0xc89455[_0x18c6e2(0x238)],_0x395130,_0x1a0516),console['log'](_0x18c6e2(0x186));console[_0x18c6e2(0x141)]('Status:',_0x395130[_0x18c6e2(0x238)]),console['log'](_0x18c6e2(0x15a),_0x395130[_0x18c6e2(0x1b2)]),console['log']('Payment\x20ID:',_0x395130[_0x18c6e2(0x21d)]),console[_0x18c6e2(0x141)]('3DS\x20URL:',_0x395130[_0x18c6e2(0x222)]||'none');if(_0x395130[_0x18c6e2(0x238)]===0x64&&_0x395130[_0x18c6e2(0x1b2)]===0x1)return console['log'](_0x18c6e2(0x17d)),{'gateway_payment_id':_0x395130[_0x18c6e2(0x21d)]?.[_0x18c6e2(0x1ce)](),'payment_url':_0x1a34bd,'requires_3ds':![],'status':_0x18c6e2(0x15f),'final':!![]};if(_0x395130[_0x18c6e2(0x222)])return console[_0x18c6e2(0x141)](_0x18c6e2(0x184)),this['scheduleStatusChecks'](_0x3caf4b,_0x3abd09,_0x395130[_0x18c6e2(0x21d)]?.[_0x18c6e2(0x1ce)]()||_0x3abd09,_0x3a170e[_0x18c6e2(0x1bb)]),{'gateway_payment_id':_0x395130[_0x18c6e2(0x21d)]?.[_0x18c6e2(0x1ce)](),'payment_url':_0x395130[_0x18c6e2(0x222)],'requires_3ds':!![],'threeds_url':_0x395130['3ds_url'],'status':_0x18c6e2(0x1d6),'final':![]};let _0x2f4221=this['getDetailedErrorMessage'](_0x395130[_0x18c6e2(0x238)],_0x395130[_0x18c6e2(0x234)]||_0x395130[_0x18c6e2(0x268)]),_0x3e6fc4=_0x395130[_0x18c6e2(0x238)],_0x513cb6=this['isFinalStatus'](_0x395130[_0x18c6e2(0x238)]);return console['log']('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x3e6fc4+_0x18c6e2(0x293)+_0x513cb6+_0x18c6e2(0x25e)+_0x2f4221),{'gateway_payment_id':_0x395130[_0x18c6e2(0x21d)]?.['toString'](),'payment_url':_0x1a34bd,'requires_3ds':![],'status':'FAILED','final':!![],'errorMessage':_0x2f4221};}catch(_0x1d7857){console['error']('===\x20PAYMENT\x20SERVICE\x20ERROR\x20==='),console[_0x18c6e2(0x242)](_0x18c6e2(0x283),_0x1d7857),loggerService_1[_0x18c6e2(0x1d4)][_0x18c6e2(0x168)](_0x18c6e2(0x15d),'/charge',_0x1d7857);throw new Error(_0x18c6e2(0x152)+(_0x1d7857 instanceof Error?_0x1d7857['message']:_0x18c6e2(0x255)));}}async[a49_0x3ff292(0x13a)](_0x31f159,_0x57236c,_0x4fbbcc=a49_0x3ff292(0x275)){const _0x3d0804=a49_0x3ff292;console[_0x3d0804(0x141)](_0x3d0804(0x136)+_0x4fbbcc+_0x3d0804(0x241)+_0x31f159+'\x20('+_0x57236c+')');try{const _0x4a4765={'payment_id':_0x31f159,'order_id':_0x57236c},_0x2f502a=JSON[_0x3d0804(0x1a6)](_0x4a4765),_0x3f6f60=this['getCardTypeAndApi'](_0x4fbbcc==='VISA'?_0x3d0804(0x139):_0x3d0804(0x251)),{key:_0x24b7ef,iv:_0x3f0386}=this[_0x3d0804(0x17a)](),_0x5c40e8=this['encryptAES'](_0x2f502a,_0x24b7ef,_0x3f0386),_0x1d3528=this[_0x3d0804(0x201)](_0x24b7ef,_0x3f0386,_0x3f6f60[_0x3d0804(0x1ec)]),_0x4ba23f=this[_0x3d0804(0x153)](_0x2f502a,_0x3f6f60[_0x3d0804(0x19a)]),_0x542723={'merchant_point_id':_0x3f6f60[_0x3d0804(0x1f0)],'method':_0x3d0804(0x238),'info':_0x5c40e8,'key':_0x1d3528,'sign':_0x4ba23f,'lang':'en'};loggerService_1['loggerService'][_0x3d0804(0x1b6)](_0x4fbbcc[_0x3d0804(0x1ad)](),_0x3d0804(0x20c),_0x3d0804(0x167),{'merchant_point_id':_0x3f6f60['merchantPointId'],'method':_0x3d0804(0x238),'lang':'en'});const _0x3fbdf6=Date[_0x3d0804(0x1d7)](),_0x32a833=await fetch(_0x3f6f60[_0x3d0804(0x1f6)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x3d0804(0x1db),'User-Agent':_0x3d0804(0x1c2)},'body':JSON[_0x3d0804(0x1a6)](_0x542723)}),_0x3b6978=Date[_0x3d0804(0x1d7)]()-_0x3fbdf6;if(!_0x32a833['ok']){const _0x36198f=await _0x32a833['text']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4fbbcc['toLowerCase'](),_0x3d0804(0x26d),_0x32a833[_0x3d0804(0x238)],_0x36198f,_0x3b6978);throw new Error(_0x3d0804(0x18a)+_0x32a833['status']);}const _0x1cd6a1=await _0x32a833[_0x3d0804(0x171)]();loggerService_1[_0x3d0804(0x1d4)][_0x3d0804(0x291)](_0x4fbbcc[_0x3d0804(0x1ad)](),_0x3d0804(0x26d),_0x32a833[_0x3d0804(0x238)],_0x1cd6a1,_0x3b6978);let _0x37bb53=_0x1cd6a1;if(_0x1cd6a1['info']&&_0x1cd6a1[_0x3d0804(0x1f7)]&&_0x1cd6a1['sign']){console['log'](_0x3d0804(0x17b));try{const _0x46cffd=await this['decryptResponsePhp'](_0x1cd6a1[_0x3d0804(0x13b)],_0x1cd6a1[_0x3d0804(0x1f7)],_0x4fbbcc);_0x37bb53=JSON[_0x3d0804(0x270)](_0x46cffd),console['log'](_0x3d0804(0x1a5)),loggerService_1[_0x3d0804(0x1d4)][_0x3d0804(0x291)](_0x4fbbcc[_0x3d0804(0x1ad)](),_0x3d0804(0x240),_0x32a833[_0x3d0804(0x238)],_0x37bb53,_0x3b6978),console[_0x3d0804(0x141)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x28c5ae){console[_0x3d0804(0x242)](_0x3d0804(0x215),_0x28c5ae),loggerService_1['loggerService']['logWhiteDomainError'](_0x4fbbcc[_0x3d0804(0x1ad)](),'/status_decrypt','Status\x20decryption\x20failed:\x20'+_0x28c5ae),_0x37bb53=_0x1cd6a1;}}else loggerService_1[_0x3d0804(0x1d4)][_0x3d0804(0x291)](_0x4fbbcc[_0x3d0804(0x1ad)](),'/status_decrypted',_0x32a833[_0x3d0804(0x238)],_0x37bb53,_0x3b6978),console['log'](_0x3d0804(0x23c));console[_0x3d0804(0x141)](_0x3d0804(0x16d),{'status':_0x37bb53[_0x3d0804(0x238)],'final':_0x37bb53['final'],'payment_id':_0x37bb53[_0x3d0804(0x21d)],'desc':_0x37bb53[_0x3d0804(0x234)]});let _0x221e35='PENDING';if(_0x37bb53['status']===0x64&&_0x37bb53['final']===0x1)_0x221e35=_0x3d0804(0x15f);else{if(_0x37bb53[_0x3d0804(0x1b2)]===0x0||!this[_0x3d0804(0x281)](_0x37bb53[_0x3d0804(0x238)]))_0x221e35=_0x3d0804(0x1d6);else _0x37bb53[_0x3d0804(0x1b2)]===0x1||this['isFinalStatus'](_0x37bb53[_0x3d0804(0x238)])?_0x221e35='FAILED':_0x221e35=_0x3d0804(0x1d6);}const _0x26749b=this['getDetailedErrorMessage'](_0x37bb53['status'],_0x37bb53[_0x3d0804(0x234)]);return{'status':_0x221e35,'final':this[_0x3d0804(0x281)](_0x37bb53[_0x3d0804(0x238)]),'amount':_0x37bb53[_0x3d0804(0x1ea)],'currency':_0x37bb53['currency'],'date_success':_0x37bb53[_0x3d0804(0x1c0)],'description':_0x26749b};}catch(_0x2cdd30){console['error'](_0x4fbbcc+_0x3d0804(0x188),_0x2cdd30),loggerService_1[_0x3d0804(0x1d4)][_0x3d0804(0x168)](_0x4fbbcc[_0x3d0804(0x1ad)](),_0x3d0804(0x20c),_0x2cdd30);throw new Error(_0x3d0804(0x17c)+_0x4fbbcc+_0x3d0804(0x241)+(_0x2cdd30 instanceof Error?_0x2cdd30['message']:_0x3d0804(0x255)));}}[a49_0x3ff292(0x269)](_0x2d988a,_0x6342f8,_0x647f93,_0x25c5d4){const _0x527987=a49_0x3ff292;console['log']('⏰\x20Scheduling\x20status\x20checks\x20for\x20'+_0x25c5d4+_0x527987(0x1bf)+_0x2d988a+'\x20('+_0x647f93+')'),this[_0x527987(0x20d)](_0x2d988a);const _0x198c94=[],_0x2330ec=0x5*0x3c*0x3e8,_0x50a1e2=0x2*0x3c*0x3c*0x3e8,_0x20ae32=Math[_0x527987(0x21e)](_0x50a1e2/_0x2330ec);console['log'](_0x527987(0x21c)+_0x20ae32+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x161d6c=0x1;_0x161d6c<=_0x20ae32;_0x161d6c++){const _0x350bf8=setTimeout(async()=>{const _0x578675=_0x527987;console['log'](_0x578675(0x244)+_0x25c5d4+'\x20status\x20check\x20#'+_0x161d6c+'/'+_0x20ae32+_0x578675(0x227)+_0x2d988a);try{const _0x5bc1d7=await this['checkPaymentStatus'](_0x647f93,_0x6342f8,_0x25c5d4);console[_0x578675(0x141)](_0x578675(0x257)+_0x161d6c+_0x578675(0x1a8),_0x5bc1d7),_0x5bc1d7[_0x578675(0x1b2)]&&(console['log'](_0x578675(0x207)+_0x2d988a+_0x578675(0x20a)+_0x5bc1d7['status']+'),\x20stopping\x20status\x20checks'),this['clearStatusTimers'](_0x2d988a),await this['updatePaymentStatus'](_0x2d988a,_0x5bc1d7[_0x578675(0x238)],_0x5bc1d7));}catch(_0x82c912){console['error'](_0x578675(0x24d)+_0x161d6c+_0x578675(0x14a)+_0x2d988a+':',_0x82c912);}},_0x161d6c*_0x2330ec);_0x198c94[_0x527987(0x26a)](_0x350bf8);}this['statusCheckTimers'][_0x527987(0x1b9)](_0x2d988a,_0x198c94),console[_0x527987(0x141)]('✅\x20Scheduled\x20'+_0x20ae32+_0x527987(0x266)+_0x2d988a);}[a49_0x3ff292(0x20d)](_0x3e4e84){const _0x3daa29=a49_0x3ff292,_0x57a82e=this[_0x3daa29(0x17e)][_0x3daa29(0x272)](_0x3e4e84);_0x57a82e&&(console[_0x3daa29(0x141)](_0x3daa29(0x264)+_0x57a82e[_0x3daa29(0x150)]+_0x3daa29(0x205)+_0x3e4e84),_0x57a82e[_0x3daa29(0x213)]((_0x413e33,_0x82296e)=>{clearTimeout(_0x413e33);}),this['statusCheckTimers'][_0x3daa29(0x204)](_0x3e4e84));}async['updatePaymentStatus'](_0x1ffd61,_0xb121be,_0x43ac4d){const _0x20f8c5=a49_0x3ff292;try{const _0x124b6c=(await Promise[_0x20f8c5(0x1c7)]()[_0x20f8c5(0x27f)](()=>__importStar(require(_0x20f8c5(0x1eb)))))[_0x20f8c5(0x271)],_0x15d648={'status':_0xb121be[_0x20f8c5(0x1f4)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0xb121be===_0x20f8c5(0x15f)&&(_0x15d648[_0x20f8c5(0x233)]=new Date()),_0xb121be==='FAILED'&&_0x43ac4d['description']&&(_0x15d648['failureMessage']=_0x43ac4d['description'],console[_0x20f8c5(0x141)](_0x20f8c5(0x157)+_0x43ac4d['description'])),_0x43ac4d['description']&&(_0x15d648[_0x20f8c5(0x216)]=(_0xb121be===_0x20f8c5(0x15f)?'VISA/MasterCard\x20payment\x20successful':'VISA/MasterCard')+':\x20'+_0x43ac4d[_0x20f8c5(0x1ee)]),await _0x124b6c[_0x20f8c5(0x23b)][_0x20f8c5(0x25d)]({'where':{'id':_0x1ffd61},'data':_0x15d648}),console[_0x20f8c5(0x141)]('✅\x20Payment\x20'+_0x1ffd61+_0x20f8c5(0x17f)+_0xb121be),await this[_0x20f8c5(0x1de)](_0x1ffd61,_0xb121be);}catch(_0x4e2aa9){console[_0x20f8c5(0x242)](_0x20f8c5(0x1ba)+_0x1ffd61+':',_0x4e2aa9);}}async[a49_0x3ff292(0x1de)](_0x46c544,_0x2875df){const _0x5b35b0=a49_0x3ff292;try{const _0x4b3d7c=(await Promise[_0x5b35b0(0x1c7)]()['then'](()=>__importStar(require(_0x5b35b0(0x1eb)))))[_0x5b35b0(0x271)],{telegramBotService:_0x4680b2}=await Promise[_0x5b35b0(0x1c7)]()[_0x5b35b0(0x27f)](()=>__importStar(require(_0x5b35b0(0x1cf)))),_0x27b4f4=await _0x4b3d7c[_0x5b35b0(0x23b)]['findUnique']({'where':{'id':_0x46c544},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x27b4f4)return;const _0x23517b={'PAID':_0x5b35b0(0x164),'FAILED':_0x5b35b0(0x26b)},_0x345843=_0x23517b[_0x2875df];_0x345843&&await _0x4680b2[_0x5b35b0(0x203)](_0x27b4f4[_0x5b35b0(0x176)],_0x27b4f4,_0x345843),await this[_0x5b35b0(0x1ef)](_0x27b4f4,_0x2875df);}catch(_0x41dfa7){console[_0x5b35b0(0x242)](_0x5b35b0(0x28b),_0x41dfa7);}}async[a49_0x3ff292(0x1ef)](_0x1f7511,_0x2b2658){const _0x41a8f3=a49_0x3ff292,_0x56d587=Date[_0x41a8f3(0x1d7)]();try{const _0x1ac4a4=_0x1f7511[_0x41a8f3(0x25c)],_0x12ef12=_0x1ac4a4[_0x41a8f3(0x14c)];if(!_0x12ef12?.[_0x41a8f3(0x284)]){console[_0x41a8f3(0x141)](_0x41a8f3(0x182)+_0x1ac4a4['id']);return;}const _0x13035b=_0x2b2658===_0x41a8f3(0x15f)?_0x41a8f3(0x1e4):'payment.failed';let _0x51bf30=[];if(_0x12ef12[_0x41a8f3(0x1bc)])try{_0x51bf30=Array['isArray'](_0x12ef12['webhookEvents'])?_0x12ef12[_0x41a8f3(0x1bc)]:JSON[_0x41a8f3(0x270)](_0x12ef12[_0x41a8f3(0x1bc)]);}catch(_0x3f1ade){console[_0x41a8f3(0x242)]('Error\x20parsing\x20webhook\x20events:',_0x3f1ade),_0x51bf30=[];}if(!_0x51bf30[_0x41a8f3(0x28a)](_0x13035b)){console[_0x41a8f3(0x141)]('Webhook\x20event\x20'+_0x13035b+'\x20not\x20enabled\x20for\x20shop\x20'+_0x1ac4a4['id']);return;}const _0x419558={'event':_0x13035b,'payment':{'id':_0x1f7511['id'],'order_id':_0x1f7511[_0x41a8f3(0x247)],'gateway_order_id':_0x1f7511[_0x41a8f3(0x221)],'gateway':_0x41a8f3(0x147),'amount':_0x1f7511['amount'],'currency':_0x1f7511[_0x41a8f3(0x27b)],'status':_0x2b2658[_0x41a8f3(0x1ad)](),'customer_email':_0x1f7511['customerEmail'],'customer_name':_0x1f7511[_0x41a8f3(0x146)],'created_at':_0x1f7511['createdAt'],'updated_at':new Date()}},_0x34724a=await fetch(_0x12ef12[_0x41a8f3(0x284)],{'method':_0x41a8f3(0x167),'headers':{'Content-Type':_0x41a8f3(0x1db),'User-Agent':_0x41a8f3(0x183)},'body':JSON[_0x41a8f3(0x1a6)](_0x419558)}),_0x39b885=Date['now']()-_0x56d587;loggerService_1[_0x41a8f3(0x1d4)][_0x41a8f3(0x223)](_0x1f7511[_0x41a8f3(0x176)],_0x12ef12['webhookUrl'],_0x13035b,_0x34724a[_0x41a8f3(0x238)],_0x39b885,_0x419558),console[_0x41a8f3(0x141)](_0x41a8f3(0x1b0)+_0x12ef12[_0x41a8f3(0x284)]+_0x41a8f3(0x252)+_0x34724a[_0x41a8f3(0x238)]+'\x20('+_0x39b885+'ms)');}catch(_0x149824){console[_0x41a8f3(0x242)](_0x41a8f3(0x16a),_0x149824),loggerService_1[_0x41a8f3(0x1d4)][_0x41a8f3(0x16f)](_0x1f7511[_0x41a8f3(0x176)],_0x1f7511[_0x41a8f3(0x25c)]?.[_0x41a8f3(0x14c)]?.['webhookUrl']||_0x41a8f3(0x24c),_0x41a8f3(0x137),_0x149824,{});}}['maskCardNumber'](_0x25525d){const _0x3a0d84=a49_0x3ff292,_0x1a20c9=_0x25525d[_0x3a0d84(0x180)](/[\s-]/g,'');if(_0x1a20c9[_0x3a0d84(0x150)]<0x4)return _0x3a0d84(0x13d);return _0x3a0d84(0x1e6)+_0x1a20c9[_0x3a0d84(0x170)](-0x4);}async['processWebhook'](_0x4a330e,_0x462ad8='MASTERCARD'){const _0x115451=a49_0x3ff292;console[_0x115451(0x141)](_0x115451(0x140),JSON[_0x115451(0x1a6)](_0x4a330e,null,0x2));let _0x440ebd=_0x4a330e,_0x342a66=_0x462ad8;_0x4a330e[_0x115451(0x1ac)]?(_0x342a66=_0x4a330e['card_type'][_0x115451(0x1f4)]()===_0x115451(0x275)?'VISA':_0x115451(0x21b),console[_0x115451(0x141)](_0x115451(0x27d)+_0x342a66)):console[_0x115451(0x141)](_0x115451(0x1fb)+_0x342a66);if(_0x4a330e[_0x115451(0x13b)]&&_0x4a330e['key']&&_0x4a330e[_0x115451(0x24e)]){console[_0x115451(0x141)](_0x115451(0x258));try{const _0x517c2e=await this[_0x115451(0x1fc)](_0x4a330e['info'],_0x4a330e[_0x115451(0x1f7)],_0x342a66);_0x440ebd=JSON[_0x115451(0x270)](_0x517c2e),console['log'](_0x115451(0x224)),console[_0x115451(0x141)](_0x115451(0x273),JSON[_0x115451(0x1a6)](_0x440ebd,null,0x2));}catch(_0x34fbcb){console[_0x115451(0x242)](_0x115451(0x23d),_0x34fbcb),console['log'](_0x115451(0x18d)),_0x440ebd=_0x4a330e;}}else console['log'](_0x115451(0x25f));let _0x3b776f='PENDING';if(_0x440ebd[_0x115451(0x238)]===0x64&&_0x440ebd[_0x115451(0x1b2)]===0x1)_0x3b776f=_0x115451(0x15f);else{if(_0x440ebd[_0x115451(0x1b2)]===0x0||!this[_0x115451(0x281)](_0x440ebd['status']))_0x3b776f=_0x115451(0x1d6);else _0x440ebd['final']===0x1||this['isFinalStatus'](_0x440ebd[_0x115451(0x238)])?_0x3b776f=_0x115451(0x159):_0x3b776f=_0x115451(0x1d6);}let _0x4b5dd8='';if(_0x440ebd[_0x115451(0x24b)])_0x4b5dd8=_0x440ebd['order_id'][_0x115451(0x1ce)](),console['log'](_0x115451(0x286)+_0x342a66+_0x115451(0x1df)+_0x4b5dd8);else _0x440ebd[_0x115451(0x21d)]?(_0x4b5dd8=_0x440ebd['payment_id'][_0x115451(0x1ce)](),console['log'](_0x115451(0x286)+_0x342a66+_0x115451(0x161)+_0x4b5dd8)):(_0x4b5dd8=_0x440ebd[_0x115451(0x247)]||_0x440ebd[_0x115451(0x225)]||_0x440ebd['id']||'',console[_0x115451(0x141)](_0x115451(0x249)+_0x4b5dd8));console[_0x115451(0x141)]('📊\x20'+_0x342a66+'\x20webhook\x20extracted\x20data:'),console[_0x115451(0x141)]('\x20\x20\x20Payment\x20ID:\x20'+_0x4b5dd8+'\x20(from:\x20order_id='+_0x440ebd[_0x115451(0x24b)]+_0x115451(0x26c)+_0x440ebd[_0x115451(0x247)]+_0x115451(0x13f)+_0x440ebd[_0x115451(0x21d)]+_0x115451(0x292)+_0x440ebd[_0x115451(0x225)]+_0x115451(0x28e)+_0x440ebd['id']+')'),console['log'](_0x115451(0x179)+_0x3b776f+'\x20(from:\x20status='+_0x440ebd[_0x115451(0x238)]+_0x115451(0x219)+_0x440ebd['final']+')'),console[_0x115451(0x141)](_0x115451(0x24f)+_0x440ebd[_0x115451(0x1ea)]),console['log'](_0x115451(0x1e1)+_0x440ebd[_0x115451(0x27b)]);let _0x2570fd;_0x3b776f===_0x115451(0x159)&&(_0x2570fd=this[_0x115451(0x23a)](_0x440ebd[_0x115451(0x238)],_0x440ebd[_0x115451(0x234)]),console['log']('❌\x20Detailed\x20failure\x20description:\x20'+_0x2570fd));const _0x36fadb={'paymentId':_0x4b5dd8,'status':_0x3b776f,'amount':_0x440ebd[_0x115451(0x1ea)],'currency':_0x440ebd['currency']};return _0x2570fd&&(_0x36fadb[_0x115451(0x1dd)]=_0x2570fd),_0x36fadb;}[a49_0x3ff292(0x250)](){const _0x337fa6=a49_0x3ff292;console['log'](_0x337fa6(0x1f5));const _0xa33521=this[_0x337fa6(0x17e)][_0x337fa6(0x232)];for(const [_0x5caa01]of this[_0x337fa6(0x17e)]){this[_0x337fa6(0x20d)](_0x5caa01);}console[_0x337fa6(0x141)](_0x337fa6(0x261)+_0xa33521+_0x337fa6(0x1cc));}}exports[a49_0x3ff292(0x145)]=VisaMasterCardService;