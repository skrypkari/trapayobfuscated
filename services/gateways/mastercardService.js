'use strict';function a49_0x13a7(){const _0x5abed=['MASTERCARD','paidAt','encryptRSA','customerName','signRSA','Payment\x20returned','system','now','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','🔐\x20AES\x20key\x20length:','\x20\x20\x20-\x20lang:\x20en','final','masterCardApiUrl','privateKeyPath','🔐\x20VISA\x20Public\x20key\x20path:','3ds_url','HTTP\x20','randomBytes','decryptResponsePhp','logWhiteDomainError','end','🔐\x20RSA\x20signing\x20successful','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format',',\x20Final:\x20','\x20\x20\x20-\x20method:\x20charge','1EcrQla','\x20\x20Original:\x20\x22','\x20failed\x20for\x20payment\x20','readFileSync','processWebhook','failed','💾\x20Payment\x20data\x20prepared','\x20for\x20payment\x20','checkPaymentStatus','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','resolve','===\x20PARSED\x20API\x20RESPONSE\x20===','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','PIN\x20code\x20confirmation\x20awaited','\x20status\x20check\x20error:','\x20characters','🔐\x20MasterCard\x20API\x20URL:','text','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','Failed\x20payment','visaPublicKeyPath','validateKeyFiles','logShopWebhookError','\x20webhook\x20extracted\x20data:','📤\x20Sending\x20request\x20to\x20API...','psp_public.pem','HTTP\x20error!\x20status:\x20','Captcha\x20confirmation\x20awaited','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code',',\x20body:\x20','343288reXjnd','VISA/MasterCard\x20payment\x20successful','Return\x20URL:','toString','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','toUpperCase','webhookEvents','../telegramBotService','key','amount','Result\x20URL:','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','SHA256','visa_public.pem','🔐\x20AES\x20IV\x20length:','Expected\x20bitcoin\x20transfer\x20from\x20client','12224vLnNQP','encryptAES','maskCardNumber','📝\x20Signature\x20length:','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','customerEmail','/status_decrypted','/status_decrypt','card_type','VisaMasterCardService','✅\x20Scheduled\x20','📝\x20Encrypted\x20key\x20length:','📝\x20Data\x20to\x20sign\x20length:','errorMessage','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','https://api.paydmeth.com/api','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','3DS\x20URL:','\x20(from:\x20status=','set','📝\x20Encrypted\x20data\x20length:','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','\x20\x20Cleaned:\x20\x20\x22','Transaction\x20limit\x20exceeded','1111','🎯\x20Using\x20','The\x20card\x20is\x20lost\x20or\x20stolen','\x20order_id\x20for\x20search:\x20','Card\x20Number:','default','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','stringify','privateDecrypt','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','floor','scheduleStatusChecks','❌\x20Data\x20being\x20signed:','visa_private.pem','3DS\x20verification\x20required','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted',',\x20payment_id=','then','LookUp\x20number\x20of\x20attempts\x20exceeded','🔐\x20AES\x20key\x20and\x20IV\x20generated','Recipient\x20data\x20required','🔐\x20VISA\x20Private\x20key\x20path:','🔐\x20VISA\x20Private\x20key\x20length:\x20','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','length','\x20not\x20enabled\x20for\x20shop\x20','VISA','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','558140pMgYyG','7RVUzoW','webhookUrl','visaMerchantPointId','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','get','includes','No\x20New\x20payment','Error\x20details:','status','__esModule','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','\x20payment:\x20','\x22\x20|\x20\x22','warn','🔍\x20','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','\x20\x20\x20Currency:\x20','Cancellation\x20is\x20not\x20possible','private.pem','HTTP\x20Status:','statusCheckTimers','sendShopWebhook','💳\x20VISA/MasterCard\x20service\x20initialized',',\x20Desc:\x20','/charge_decrypted','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','paymentId','create','81196843pQVksw','paid','),\x20stopping\x20status\x20checks','/status','Sender\x27s\x20card\x20details\x20are\x20required','📊\x20Checking\x20','LookUp\x20code\x20sent','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','isArray','/charge','/status_raw','createdAt','PENDING','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','Request\x20data\x20error','...','order_id','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','Another\x20unknown\x20error','call','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','date_success','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','decryptAES','❌\x20RSA\x20encryption\x20failed:','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','publicEncrypt','Failed\x20to\x20send\x20MasterCard\x20webhook:','-----BEGIN','apiUrl','description','defineProperty','sendPaymentNotifications','Decryption\x20failed:\x20','===\x20API\x20RESPONSE\x20===','3032998SXWtyz','✅\x20VISA\x20key\x20files\x20validated\x20successfully','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','ms)','🔐\x20VISA\x20API\x20URL:','\x20\x20\x20-\x20key\x20length:','Payment\x20prohibited','number','shop','findUnique','🔐\x20Using\x20keys:\x20','base64','generateAESKey','logWhiteDomainRequest','currency','✅\x20Payment\x20successful','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','createSign','cardType','getDetailedErrorMessage','settings','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','charge','join','size','\x20\x20\x20-\x20sign\x20length:','1149426bHGzNx','replace','Unsuccessful\x20payment','/charge_raw','PAID','https://api2.trapay.uk/decrypt.php','\x20status\x20checks\x20for\x20payment\x20','\x20status\x20timers\x20for\x20payment\x20','6221712ScqIgb','__createBinding','5000000000000000','⏰\x20Will\x20check\x20status\x20','🔍\x20Using\x20','135HMCGCq','configurable','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','charAt','Payment\x20is\x20being\x20processed','keys','info','\x20payment\x20status:\x20','Status:','\x20|\x20Response:\x20','🧹\x20Clearing\x20','Payment\x20System/1.0\x20(MasterCard)','\x20is\x20final\x20(','existsSync','masterCardMerchantPointId','\x20\x20\x20-\x20info\x20length:','first_name','webhook_send','toLowerCase','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','message','updatePaymentStatus','✅\x20Payment\x20','payment_id','clearStatusTimers','282xDebsE','/charge_decrypt','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','\x20\x20\x20Status:\x20','Payment\x20ID:','Webhook\x20event\x20','last_name','payment','\x20\x20\x20Payment\x20ID:\x20','parse','orderId','shopId','❌\x20Status\x20check\x20#','loggerService','decryptResponse','Status\x20','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','PHP\x20decryptor\x20error','json','expire_year','Client\x20OTP\x20confirmation\x20required','****\x20****\x20****\x20','cwd','prototype','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','Sender\x20information\x20required','__setModuleDefault',',\x20final=','application/json','paymentStatuses','⏰\x20Scheduling\x20status\x20checks\x20for\x20','-----END','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','__importDefault','from','isFinalStatus','❌\x20PHP\x20decryptor\x20request\x20failed:','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','error','Payment\x20System/1.0','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','writable','desc','../../config/database','Order\x20ID:','\x20result:','delete','Failed\x20to\x20check\x20','update','\x20status\x20updated\x20to\x20','logWhiteDomainResponse','336BopbOc','none','\x20payment_id\x20for\x20search:\x20','visa/mastercard','Status\x20decryption\x20failed:\x20','publicKeyPath','createCipheriv','\x20status\x20check\x20#','📊\x20Status\x20check\x20#','\x20API:\x20','visaApiUrl','POST','✅\x20Status\x20response\x20decrypted\x20successfully','visaPrivateKeyPath','💾\x20Saving\x20failure\x20message:\x20','\x20\x20\x20Amount:\x20','trim','****','merchantPointId','slice','utf8','logShopWebhookSent','Unknown\x20error','unknown','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','getCardTypeAndApi','📝\x20Decrypted\x20webhook\x20data:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','constants','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','log','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','Insufficient\x20funds\x20on\x20the\x20card','FAILED','sign','❌\x20Detailed\x20failure\x20description:\x20','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','\x20(from:\x20order_id=','LookUp\x20not\x20confirmed','payment.success','30toqUxT','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP'];a49_0x13a7=function(){return _0x5abed;};return a49_0x13a7();}const a49_0x5f3c30=a49_0x5cbd;(function(_0x22e042,_0x56cdd3){const _0x5063fc=a49_0x5cbd,_0x41d05a=_0x22e042();while(!![]){try{const _0x425e01=-parseInt(_0x5063fc(0x28a))/0x1*(parseInt(_0x5063fc(0x1d2))/0x2)+-parseInt(_0x5063fc(0x212))/0x3*(parseInt(_0x5063fc(0x2b8))/0x4)+-parseInt(_0x5063fc(0x26f))/0x5*(parseInt(_0x5063fc(0x1ec))/0x6)+parseInt(_0x5063fc(0x190))/0x7*(-parseInt(_0x5063fc(0x1f4))/0x8)+-parseInt(_0x5063fc(0x1f9))/0x9*(parseInt(_0x5063fc(0x18f))/0xa)+parseInt(_0x5063fc(0x2a8))/0xb*(-parseInt(_0x5063fc(0x247))/0xc)+parseInt(_0x5063fc(0x1ad))/0xd;if(_0x425e01===_0x56cdd3)break;else _0x41d05a['push'](_0x41d05a['shift']());}catch(_0x3835fd){_0x41d05a['push'](_0x41d05a['shift']());}}}(a49_0x13a7,0xc4486));var __createBinding=this&&this[a49_0x5f3c30(0x1f5)]||(Object[a49_0x5f3c30(0x1ac)]?function(_0x2a267f,_0x919596,_0x1aaa72,_0x8822e5){const _0x4e1e65=a49_0x5f3c30;if(_0x8822e5===undefined)_0x8822e5=_0x1aaa72;var _0x25ea65=Object['getOwnPropertyDescriptor'](_0x919596,_0x1aaa72);(!_0x25ea65||(_0x4e1e65(0x194)in _0x25ea65?!_0x919596[_0x4e1e65(0x199)]:_0x25ea65[_0x4e1e65(0x23d)]||_0x25ea65[_0x4e1e65(0x1fa)]))&&(_0x25ea65={'enumerable':!![],'get':function(){return _0x919596[_0x1aaa72];}}),Object[_0x4e1e65(0x1ce)](_0x2a267f,_0x8822e5,_0x25ea65);}:function(_0x396d7a,_0x166197,_0x561985,_0x2da319){if(_0x2da319===undefined)_0x2da319=_0x561985;_0x396d7a[_0x2da319]=_0x166197[_0x561985];}),__setModuleDefault=this&&this[a49_0x5f3c30(0x22c)]||(Object[a49_0x5f3c30(0x1ac)]?function(_0x2783ca,_0x10138f){const _0x4ccb0a=a49_0x5f3c30;Object[_0x4ccb0a(0x1ce)](_0x2783ca,'default',{'enumerable':!![],'value':_0x10138f});}:function(_0x59294b,_0xbb73a6){const _0x14b671=a49_0x5f3c30;_0x59294b[_0x14b671(0x2d5)]=_0xbb73a6;}),__importStar=this&&this['__importStar']||(function(){var _0x243d59=function(_0x379f16){return _0x243d59=Object['getOwnPropertyNames']||function(_0x502257){const _0x369358=a49_0x5cbd;var _0x69079d=[];for(var _0x3414b6 in _0x502257)if(Object[_0x369358(0x229)]['hasOwnProperty'][_0x369358(0x1c1)](_0x502257,_0x3414b6))_0x69079d[_0x69079d[_0x369358(0x2e9)]]=_0x3414b6;return _0x69079d;},_0x243d59(_0x379f16);};return function(_0x2e517a){const _0x12b7d7=a49_0x5cbd;if(_0x2e517a&&_0x2e517a[_0x12b7d7(0x199)])return _0x2e517a;var _0x19b9a1={};if(_0x2e517a!=null){for(var _0x40814c=_0x243d59(_0x2e517a),_0x385699=0x0;_0x385699<_0x40814c['length'];_0x385699++)if(_0x40814c[_0x385699]!==_0x12b7d7(0x2d5))__createBinding(_0x19b9a1,_0x2e517a,_0x40814c[_0x385699]);}return __setModuleDefault(_0x19b9a1,_0x2e517a),_0x19b9a1;};}()),__importDefault=this&&this[a49_0x5f3c30(0x235)]||function(_0x4892e3){const _0x5ae776=a49_0x5f3c30;return _0x4892e3&&_0x4892e3[_0x5ae776(0x199)]?_0x4892e3:{'default':_0x4892e3};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a49_0x5f3c30(0x2c1)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require('../loggerService');function a49_0x5cbd(_0xf11275,_0x561fa0){const _0x13a750=a49_0x13a7();return a49_0x5cbd=function(_0x5cbd56,_0x186d0c){_0x5cbd56=_0x5cbd56-0x18e;let _0x4c31b2=_0x13a750[_0x5cbd56];return _0x4c31b2;},a49_0x5cbd(_0xf11275,_0x561fa0);}class VisaMasterCardService{constructor(){const _0x41b63=a49_0x5f3c30;this['statusCheckTimers']=new Map(),this[_0x41b63(0x22f)]={0x0:{'final':![],'description':_0x41b63(0x196)},0x1:{'final':![],'description':'No\x20Error\x20executing\x20request'},0x2:{'final':!![],'description':_0x41b63(0x1bc)},0x3:{'final':!![],'description':_0x41b63(0x1c0)},0x4:{'final':!![],'description':_0x41b63(0x1ee)},0x5:{'final':!![],'description':_0x41b63(0x1b5)},0x6:{'final':!![],'description':_0x41b63(0x276)},0x7:{'final':!![],'description':'Test\x20payment'},0x8:{'final':![],'description':_0x41b63(0x226)},0x9:{'final':![],'description':_0x41b63(0x2de)},0xa:{'final':![],'description':'Sender\x27s\x20CVV\x20card\x20is\x20required'},0xb:{'final':![],'description':_0x41b63(0x22b)},0xc:{'final':![],'description':_0x41b63(0x2e4)},0xd:{'final':![],'description':_0x41b63(0x25f)},0xe:{'final':![],'description':'Awaiting\x20confirmation\x20by\x20ivr\x20call'},0xf:{'final':![],'description':_0x41b63(0x297)},0x10:{'final':![],'description':_0x41b63(0x2a5)},0x11:{'final':![],'description':_0x41b63(0x1c2)},0x12:{'final':![],'description':'Awaiting\x20confirmation\x20in\x20the\x20application'},0x13:{'final':![],'description':_0x41b63(0x1fd)},0x14:{'final':![],'description':'The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender'},0x15:{'final':![],'description':_0x41b63(0x2b7)},0x16:{'final':![],'description':'Payment\x20pending\x20verification'},0x18:{'final':![],'description':_0x41b63(0x20c)},0x19:{'final':![],'description':_0x41b63(0x26b)},0x1a:{'final':!![],'description':'Cash\x20payment\x20is\x20expected\x20at\x20TCO'},0x1b:{'final':![],'description':_0x41b63(0x2a6)},0x1c:{'final':![],'description':_0x41b63(0x1fb)},0x1d:{'final':![],'description':_0x41b63(0x1bb)},0x1f:{'final':![],'description':_0x41b63(0x1a0)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':_0x41b63(0x1b1)},0x24:{'final':!![],'description':'Payment\x20confirmation\x20time\x20has\x20expired'},0x25:{'final':!![],'description':_0x41b63(0x1d8)},0x26:{'final':!![],'description':_0x41b63(0x2c6)},0x27:{'final':!![],'description':_0x41b63(0x267)},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':_0x41b63(0x2d2)},0x2a:{'final':!![],'description':'Invalid\x20expiration\x20date'},0x2b:{'final':!![],'description':_0x41b63(0x2cf)},0x2c:{'final':!![],'description':_0x41b63(0x234)},0x2d:{'final':!![],'description':_0x41b63(0x29d)},0x2e:{'final':!![],'description':_0x41b63(0x1ee)},0x2f:{'final':!![],'description':_0x41b63(0x1ee)},0x30:{'final':!![],'description':_0x41b63(0x2c8)},0x31:{'final':![],'description':'Payment\x20confirmation\x20required'},0x32:{'final':!![],'description':'Method\x20not\x20allowed'},0x33:{'final':!![],'description':_0x41b63(0x29d)},0x34:{'final':!![],'description':'Failed\x20payment'},0x35:{'final':!![],'description':_0x41b63(0x29d)},0x36:{'final':!![],'description':_0x41b63(0x29d)},0x37:{'final':!![],'description':_0x41b63(0x29d)},0x38:{'final':!![],'description':_0x41b63(0x1a2)},0x39:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank'},0x3a:{'final':![],'description':_0x41b63(0x1b3)},0x3b:{'final':!![],'description':'LookUp\x20code\x20verified'},0x3c:{'final':!![],'description':'Number\x20of\x20attempts\x20exceeded'},0x3d:{'final':!![],'description':_0x41b63(0x1d4)},0x3e:{'final':!![],'description':'Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID'},0x3f:{'final':!![],'description':_0x41b63(0x276)},0x40:{'final':![],'description':_0x41b63(0x26d)},0x41:{'final':!![],'description':_0x41b63(0x2e2)},0x42:{'final':![],'description':'Payment\x20cancellation\x20is\x20being\x20processed'},0x43:{'final':!![],'description':_0x41b63(0x232)},0x44:{'final':![],'description':_0x41b63(0x2de)},0x45:{'final':!![],'description':_0x41b63(0x29d)},0x46:{'final':!![],'description':_0x41b63(0x29d)},0x47:{'final':!![],'description':'Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details'},0x64:{'final':!![],'description':'Operation\x20completed\x20successfully'}},this[_0x41b63(0x27d)]=_0x41b63(0x2c7),this[_0x41b63(0x207)]=0x6e4,this[_0x41b63(0x27e)]=path_1[_0x41b63(0x2d5)]['join'](process[_0x41b63(0x228)](),_0x41b63(0x1fe),_0x41b63(0x1a3)),this[_0x41b63(0x24c)]=path_1[_0x41b63(0x2d5)][_0x41b63(0x1e9)](process[_0x41b63(0x228)](),_0x41b63(0x1fe),_0x41b63(0x2a3)),this['visaApiUrl']=_0x41b63(0x2c7),this[_0x41b63(0x192)]=0x6b7,this['visaPrivateKeyPath']=path_1[_0x41b63(0x2d5)][_0x41b63(0x1e9)](process[_0x41b63(0x228)](),'keys',_0x41b63(0x2dd)),this[_0x41b63(0x29e)]=path_1[_0x41b63(0x2d5)][_0x41b63(0x1e9)](process[_0x41b63(0x228)](),_0x41b63(0x1fe),_0x41b63(0x2b5)),console[_0x41b63(0x265)](_0x41b63(0x1a7)),console[_0x41b63(0x265)](_0x41b63(0x29a),this[_0x41b63(0x27d)]),console[_0x41b63(0x265)](_0x41b63(0x1d6),this[_0x41b63(0x251)]),console[_0x41b63(0x265)]('🔐\x20MasterCard\x20Private\x20key\x20path:',this['privateKeyPath']),console[_0x41b63(0x265)]('🔐\x20MasterCard\x20Public\x20key\x20path:',this['publicKeyPath']),console[_0x41b63(0x265)](_0x41b63(0x2e5),this[_0x41b63(0x254)]),console[_0x41b63(0x265)](_0x41b63(0x27f),this[_0x41b63(0x29e)]),this[_0x41b63(0x29f)]();}[a49_0x5f3c30(0x1e5)](_0x3e9b0c,_0x348dd3){const _0x1cc858=a49_0x5f3c30,_0x25c975=this[_0x1cc858(0x22f)][_0x3e9b0c];let _0x1c2640='';_0x25c975?_0x1c2640=_0x1cc858(0x221)+_0x3e9b0c+':\x20'+_0x25c975[_0x1cc858(0x1cd)]:_0x1c2640=_0x1cc858(0x221)+_0x3e9b0c+':\x20Unknown\x20status\x20code';if(_0x348dd3&&_0x348dd3[_0x1cc858(0x257)]()){const _0x318a9e=_0x348dd3['trim']();(!_0x25c975||_0x318a9e[_0x1cc858(0x20b)]()!==_0x25c975[_0x1cc858(0x1cd)][_0x1cc858(0x20b)]())&&(_0x1c2640+=_0x1cc858(0x202)+_0x318a9e);}return _0x1c2640;}[a49_0x5f3c30(0x237)](_0x376338){const _0x1bd7dc=a49_0x5f3c30,_0x5e1518=this[_0x1bd7dc(0x22f)][_0x376338];return _0x5e1518?_0x5e1518[_0x1bd7dc(0x27c)]:!![];}[a49_0x5f3c30(0x260)](_0x31ab55){const _0x13b50a=a49_0x5f3c30,_0x3f8d07=_0x31ab55[_0x13b50a(0x1fc)](0x0);if(_0x3f8d07==='4')return console[_0x13b50a(0x265)](_0x13b50a(0x1e2)),{'cardType':_0x13b50a(0x2eb),'apiUrl':this[_0x13b50a(0x251)],'privateKeyPath':this['visaPrivateKeyPath'],'publicKeyPath':this['visaPublicKeyPath'],'merchantPointId':this[_0x13b50a(0x192)]};else return _0x3f8d07==='5'?(console[_0x13b50a(0x265)](_0x13b50a(0x2d9)),{'cardType':_0x13b50a(0x271),'apiUrl':this[_0x13b50a(0x27d)],'privateKeyPath':this[_0x13b50a(0x27e)],'publicKeyPath':this[_0x13b50a(0x24c)],'merchantPointId':this['masterCardMerchantPointId']}):(console[_0x13b50a(0x265)](_0x13b50a(0x214)+_0x3f8d07+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':_0x13b50a(0x271),'apiUrl':this[_0x13b50a(0x27d)],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x13b50a(0x24c)],'merchantPointId':this[_0x13b50a(0x207)]});}['validateKeyFiles'](){const _0x970dce=a49_0x5f3c30;try{if(!fs_1[_0x970dce(0x2d5)][_0x970dce(0x206)](this[_0x970dce(0x27e)]))throw new Error(_0x970dce(0x239)+this[_0x970dce(0x27e)]);if(!fs_1[_0x970dce(0x2d5)][_0x970dce(0x206)](this[_0x970dce(0x24c)]))throw new Error(_0x970dce(0x1b4)+this[_0x970dce(0x24c)]);const _0x3c6ecc=fs_1[_0x970dce(0x2d5)]['readFileSync'](this[_0x970dce(0x27e)],_0x970dce(0x25b))[_0x970dce(0x257)](),_0x28ef58=fs_1[_0x970dce(0x2d5)][_0x970dce(0x28d)](this[_0x970dce(0x24c)],_0x970dce(0x25b))[_0x970dce(0x257)]();if(!_0x3c6ecc[_0x970dce(0x195)]('-----BEGIN')||!_0x3c6ecc[_0x970dce(0x195)](_0x970dce(0x231)))throw new Error(_0x970dce(0x2d6));if(!_0x28ef58[_0x970dce(0x195)](_0x970dce(0x1cb))||!_0x28ef58['includes']('-----END'))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console['log'](_0x970dce(0x2b3)),console[_0x970dce(0x265)](_0x970dce(0x264)+_0x3c6ecc[_0x970dce(0x2e9)]+_0x970dce(0x299)),console[_0x970dce(0x265)](_0x970dce(0x279)+_0x28ef58['length']+_0x970dce(0x299));if(fs_1[_0x970dce(0x2d5)][_0x970dce(0x206)](this['visaPrivateKeyPath'])&&fs_1[_0x970dce(0x2d5)][_0x970dce(0x206)](this[_0x970dce(0x29e)])){const _0x2d475f=fs_1['default'][_0x970dce(0x28d)](this[_0x970dce(0x254)],'utf8')[_0x970dce(0x257)](),_0x3d13df=fs_1[_0x970dce(0x2d5)]['readFileSync'](this[_0x970dce(0x29e)],'utf8')[_0x970dce(0x257)]();(!_0x2d475f[_0x970dce(0x195)](_0x970dce(0x1cb))||!_0x2d475f['includes']('-----END'))&&console[_0x970dce(0x19d)](_0x970dce(0x287)),(!_0x3d13df['includes']('-----BEGIN')||!_0x3d13df[_0x970dce(0x195)](_0x970dce(0x231)))&&console[_0x970dce(0x19d)](_0x970dce(0x2cd)),console[_0x970dce(0x265)](_0x970dce(0x1d3)),console[_0x970dce(0x265)](_0x970dce(0x2e6)+_0x2d475f[_0x970dce(0x2e9)]+_0x970dce(0x299)),console[_0x970dce(0x265)]('🔐\x20VISA\x20Public\x20key\x20length:\x20'+_0x3d13df['length']+_0x970dce(0x299));}else console['warn'](_0x970dce(0x29c)),console[_0x970dce(0x19d)](_0x970dce(0x193)+this[_0x970dce(0x254)]),console['warn'](_0x970dce(0x2e8)+this[_0x970dce(0x29e)]);}catch(_0x53d5d2){console[_0x970dce(0x23a)]('❌\x20VISA/MasterCard\x20key\x20validation\x20failed:',_0x53d5d2);throw _0x53d5d2;}}[a49_0x5f3c30(0x1de)](){const _0x458efb=a49_0x5f3c30,_0x1850b6=crypto_1['default'][_0x458efb(0x282)](0x20),_0x580c0e=crypto_1[_0x458efb(0x2d5)][_0x458efb(0x282)](0x10);return{'key':_0x1850b6,'iv':_0x580c0e};}['encryptAES'](_0x3753f3,_0x37c95e,_0x164e2a){const _0x2a0468=a49_0x5f3c30,_0x4e7491=crypto_1[_0x2a0468(0x2d5)][_0x2a0468(0x24d)]('aes-256-ctr',_0x37c95e,_0x164e2a);let _0x3e1240=_0x4e7491[_0x2a0468(0x244)](_0x3753f3,'utf8','base64');return _0x3e1240+=_0x4e7491[_0x2a0468(0x27c)](_0x2a0468(0x1dd)),_0x3e1240;}['encryptRSA'](_0x4090fc,_0x2df6aa,_0x3357a2){const _0x4a94a4=a49_0x5f3c30;try{const _0x24516f=fs_1['default'][_0x4a94a4(0x28d)](_0x3357a2,'utf8')[_0x4a94a4(0x257)](),_0x54a64a={'iv':_0x2df6aa[_0x4a94a4(0x2ab)](_0x4a94a4(0x1dd)),'key':_0x4090fc[_0x4a94a4(0x2ab)](_0x4a94a4(0x1dd))},_0xdce2bf=JSON[_0x4a94a4(0x2d7)](_0x54a64a);console[_0x4a94a4(0x265)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0xdce2bf[_0x4a94a4(0x2e9)]);const _0x3a207b=crypto_1['default'][_0x4a94a4(0x1c9)]({'key':_0x24516f,'padding':crypto_1[_0x4a94a4(0x2d5)][_0x4a94a4(0x263)]['RSA_PKCS1_PADDING']},Buffer[_0x4a94a4(0x236)](_0xdce2bf));return console[_0x4a94a4(0x265)](_0x4a94a4(0x2e7),_0x3a207b[_0x4a94a4(0x2e9)]),_0x3a207b['toString'](_0x4a94a4(0x1dd));}catch(_0x15edb5){console[_0x4a94a4(0x23a)](_0x4a94a4(0x1c7),_0x15edb5);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a49_0x5f3c30(0x275)](_0x1dee3f,_0x398536){const _0x1b1259=a49_0x5f3c30;try{const _0x4b3fc4=fs_1[_0x1b1259(0x2d5)][_0x1b1259(0x28d)](_0x398536,_0x1b1259(0x25b))[_0x1b1259(0x257)](),_0x4ec4ff=crypto_1['default'][_0x1b1259(0x1e3)](_0x1b1259(0x2b4));_0x4ec4ff[_0x1b1259(0x244)](_0x1dee3f),_0x4ec4ff[_0x1b1259(0x285)]();const _0x56c741=_0x4ec4ff['sign'](_0x4b3fc4,'base64');return console[_0x1b1259(0x265)](_0x1b1259(0x286)),console['log'](_0x1b1259(0x2c4),_0x1dee3f[_0x1b1259(0x2e9)]),console[_0x1b1259(0x265)]('📝\x20Signature\x20length:',_0x56c741['length']),_0x56c741;}catch(_0x394684){console[_0x1b1259(0x23a)]('❌\x20RSA\x20signing\x20failed:',_0x394684),console['error'](_0x1b1259(0x2dc),_0x1dee3f['substring'](0x0,0xc8)+_0x1b1259(0x1bd));throw new Error(_0x1b1259(0x1aa));}}['decryptAES'](_0x3051ba,_0x6f5306,_0x466812){const _0x48d30a=a49_0x5f3c30,_0x2f13c=crypto_1[_0x48d30a(0x2d5)]['createDecipheriv']('aes-256-ctr',_0x6f5306,_0x466812);let _0x28ba55=_0x2f13c[_0x48d30a(0x244)](_0x3051ba,_0x48d30a(0x1dd),'utf8');return _0x28ba55+=_0x2f13c['final'](_0x48d30a(0x25b)),_0x28ba55;}async[a49_0x5f3c30(0x283)](_0x3a4271,_0xd94c33,_0x3f9f66=a49_0x5f3c30(0x271)){const _0x37a04d=a49_0x5f3c30;try{const _0x4f1b13=await fetch(_0x37a04d(0x1f1),{'method':_0x37a04d(0x252),'headers':{'Content-Type':_0x37a04d(0x22e)},'body':JSON[_0x37a04d(0x2d7)]({'info':_0x3a4271,'key':_0xd94c33,'card_type':_0x3f9f66['toLowerCase']()})});if(!_0x4f1b13['ok'])throw new Error(_0x37a04d(0x223));return await _0x4f1b13[_0x37a04d(0x29b)]();}catch(_0x4caa40){console[_0x37a04d(0x23a)](_0x37a04d(0x238),_0x4caa40);throw new Error(_0x37a04d(0x296));}}[a49_0x5f3c30(0x220)](_0x49620c,_0x2c67e9){const _0x14c27f=a49_0x5f3c30;try{const _0x93af3c=fs_1[_0x14c27f(0x2d5)][_0x14c27f(0x28d)](this[_0x14c27f(0x27e)],_0x14c27f(0x25b))[_0x14c27f(0x257)](),_0x548f98=crypto_1['default'][_0x14c27f(0x2d8)](_0x93af3c,Buffer[_0x14c27f(0x236)](_0x2c67e9,_0x14c27f(0x1dd))),_0x283e5a=JSON[_0x14c27f(0x21b)](_0x548f98['toString']()),_0x3108cb=Buffer[_0x14c27f(0x236)](_0x283e5a['key'],_0x14c27f(0x1dd)),_0x11511f=Buffer[_0x14c27f(0x236)](_0x283e5a['iv'],_0x14c27f(0x1dd));return this[_0x14c27f(0x1c6)](_0x49620c,_0x3108cb,_0x11511f);}catch(_0x46ea86){throw new Error('Failed\x20to\x20decrypt\x20response');}}async['processCardPayment'](_0x492105){const _0x174f3b=a49_0x5f3c30,{paymentId:_0x57bfe7,orderId:_0x20cd39,amount:_0x22b816,currency:_0x2a028b,cardData:_0x3bf1dd,resultUrl:_0x20b665,returnUrl:_0x45547e,cardHolder:_0x5bc06d,browser:_0x286703}=_0x492105;console[_0x174f3b(0x265)]('===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x174f3b(0x265)](_0x174f3b(0x216),_0x57bfe7),console[_0x174f3b(0x265)](_0x174f3b(0x240),_0x20cd39),console[_0x174f3b(0x265)]('Amount:',_0x22b816,_0x2a028b),console['log'](_0x174f3b(0x2d4),this[_0x174f3b(0x2ba)](_0x3bf1dd['number'])),console[_0x174f3b(0x265)]('Card\x20Holder:',_0x5bc06d['first_name']+'\x20'+_0x5bc06d[_0x174f3b(0x218)]),console[_0x174f3b(0x265)](_0x174f3b(0x2aa),_0x45547e),console[_0x174f3b(0x265)](_0x174f3b(0x2b2),_0x20b665);const _0x1afd42=this[_0x174f3b(0x260)](_0x3bf1dd['number']);console[_0x174f3b(0x265)](_0x174f3b(0x2d1)+_0x1afd42['cardType']+_0x174f3b(0x250)+_0x1afd42[_0x174f3b(0x1cc)]),console['log'](_0x174f3b(0x1dc)+_0x1afd42[_0x174f3b(0x27e)]+',\x20'+_0x1afd42[_0x174f3b(0x24c)]);const _0x9764cc={..._0x5bc06d,'first_name':_0x5bc06d[_0x174f3b(0x209)]?.[_0x174f3b(0x1ed)](/[\t\n\r\f\v]/g,'\x20')[_0x174f3b(0x257)]()||'','last_name':_0x5bc06d[_0x174f3b(0x218)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x174f3b(0x257)]()||''};console[_0x174f3b(0x265)]('🧹\x20Card\x20holder\x20names\x20cleaned:'),console[_0x174f3b(0x265)](_0x174f3b(0x28b)+_0x5bc06d[_0x174f3b(0x209)]+_0x174f3b(0x19c)+_0x5bc06d[_0x174f3b(0x218)]+'\x22'),console[_0x174f3b(0x265)](_0x174f3b(0x2ce)+_0x9764cc['first_name']+_0x174f3b(0x19c)+_0x9764cc[_0x174f3b(0x218)]+'\x22');const _0x4bd52f={'amount':_0x22b816,'currency':_0x2a028b[_0x174f3b(0x2ad)](),'order_id':_0x20cd39,'result_url':_0x20b665,'return_url':_0x45547e,'country':'','card':{'number':_0x3bf1dd[_0x174f3b(0x1d9)],'expire_month':_0x3bf1dd['expire_month'],'expire_year':_0x3bf1dd[_0x174f3b(0x225)],'cvv':_0x3bf1dd['cvv']},'card_holder':_0x9764cc,'browser':_0x286703},_0x49d199=JSON[_0x174f3b(0x2d7)](_0x4bd52f);console[_0x174f3b(0x265)](_0x174f3b(0x290)),console[_0x174f3b(0x265)](_0x174f3b(0x1bf)),console[_0x174f3b(0x265)](_0x49d199),console['log']('📝\x20Data\x20length:',_0x49d199[_0x174f3b(0x2e9)]);try{const {key:_0x2214e1,iv:_0x3d0ce0}=this[_0x174f3b(0x1de)]();console[_0x174f3b(0x265)](_0x174f3b(0x2e3)),console['log'](_0x174f3b(0x27a),_0x2214e1[_0x174f3b(0x2e9)]),console[_0x174f3b(0x265)](_0x174f3b(0x2b6),_0x3d0ce0[_0x174f3b(0x2e9)]);const _0x2b81c7=this[_0x174f3b(0x2b9)](_0x49d199,_0x2214e1,_0x3d0ce0);console[_0x174f3b(0x265)]('🔐\x20Data\x20encrypted\x20with\x20AES'),console[_0x174f3b(0x265)](_0x174f3b(0x2cc),_0x2b81c7[_0x174f3b(0x2e9)]);const _0x54b9fd=this[_0x174f3b(0x273)](_0x2214e1,_0x3d0ce0,_0x1afd42[_0x174f3b(0x24c)]);console[_0x174f3b(0x265)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console['log'](_0x174f3b(0x2c3),_0x54b9fd[_0x174f3b(0x2e9)]);const _0x204acb=this[_0x174f3b(0x275)](_0x49d199,_0x1afd42[_0x174f3b(0x27e)]);console[_0x174f3b(0x265)]('🔐\x20Data\x20signed\x20with\x20RSA'),console['log'](_0x174f3b(0x2bb),_0x204acb['length']);const _0x372e7a={'merchant_point_id':_0x1afd42['merchantPointId'],'method':_0x174f3b(0x1e8),'info':_0x2b81c7,'key':_0x54b9fd,'sign':_0x204acb,'lang':'en'};console[_0x174f3b(0x265)](_0x174f3b(0x2a2)),console[_0x174f3b(0x265)]('📝\x20Final\x20request\x20structure:'),console[_0x174f3b(0x265)]('\x20\x20\x20-\x20merchant_point_id:',_0x1afd42[_0x174f3b(0x259)]),console['log'](_0x174f3b(0x289)),console[_0x174f3b(0x265)](_0x174f3b(0x208),_0x2b81c7['length']),console[_0x174f3b(0x265)](_0x174f3b(0x1d7),_0x54b9fd[_0x174f3b(0x2e9)]),console[_0x174f3b(0x265)](_0x174f3b(0x1eb),_0x204acb['length']),console['log'](_0x174f3b(0x27b)),loggerService_1[_0x174f3b(0x21f)][_0x174f3b(0x1df)](_0x1afd42[_0x174f3b(0x1e4)][_0x174f3b(0x20b)](),_0x174f3b(0x1b7),_0x174f3b(0x252),{'merchant_point_id':_0x1afd42[_0x174f3b(0x259)],'method':_0x174f3b(0x1e8),'lang':'en'});const _0xb2a515=Date[_0x174f3b(0x278)](),_0x39a259=await fetch(_0x1afd42[_0x174f3b(0x1cc)],{'method':_0x174f3b(0x252),'headers':{'Content-Type':_0x174f3b(0x22e),'Accept':_0x174f3b(0x22e),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x174f3b(0x2d7)](_0x372e7a)}),_0x2d0f48=Date[_0x174f3b(0x278)]()-_0xb2a515;console[_0x174f3b(0x265)](_0x174f3b(0x1d1)),console[_0x174f3b(0x265)](_0x174f3b(0x201),_0x39a259[_0x174f3b(0x198)]),console[_0x174f3b(0x265)]('Response\x20Time:',_0x2d0f48+'ms');if(!_0x39a259['ok']){const _0x5219b4=await _0x39a259[_0x174f3b(0x29b)]();console[_0x174f3b(0x23a)](_0x174f3b(0x1a4),_0x39a259[_0x174f3b(0x198)]),console[_0x174f3b(0x23a)]('Response\x20Body:',_0x5219b4),loggerService_1[_0x174f3b(0x21f)][_0x174f3b(0x246)](_0x1afd42[_0x174f3b(0x1e4)][_0x174f3b(0x20b)](),_0x174f3b(0x1ef),_0x39a259[_0x174f3b(0x198)],_0x5219b4,_0x2d0f48),loggerService_1[_0x174f3b(0x21f)][_0x174f3b(0x284)](_0x1afd42['cardType'][_0x174f3b(0x20b)](),_0x174f3b(0x1b7),_0x174f3b(0x281)+_0x39a259[_0x174f3b(0x198)]+':\x20'+_0x5219b4);throw new Error(_0x174f3b(0x2a4)+_0x39a259[_0x174f3b(0x198)]+_0x174f3b(0x2a7)+_0x5219b4);}const _0x23be9b=await _0x39a259[_0x174f3b(0x224)]();loggerService_1[_0x174f3b(0x21f)]['logWhiteDomainResponse'](_0x1afd42[_0x174f3b(0x1e4)][_0x174f3b(0x20b)](),_0x174f3b(0x1ef),_0x39a259['status'],_0x23be9b,_0x2d0f48),console['log'](_0x174f3b(0x295));let _0x52de06=_0x23be9b;if(_0x23be9b[_0x174f3b(0x1ff)]&&_0x23be9b[_0x174f3b(0x2b0)]&&_0x23be9b[_0x174f3b(0x269)]){console[_0x174f3b(0x265)](_0x174f3b(0x2bc));try{const _0x3b59e4=await this[_0x174f3b(0x283)](_0x23be9b[_0x174f3b(0x1ff)],_0x23be9b['key'],_0x1afd42['cardType']);_0x52de06=JSON[_0x174f3b(0x21b)](_0x3b59e4),console[_0x174f3b(0x265)](_0x174f3b(0x293)),loggerService_1[_0x174f3b(0x21f)][_0x174f3b(0x246)](_0x1afd42[_0x174f3b(0x1e4)][_0x174f3b(0x20b)](),'/charge_decrypted',_0x39a259[_0x174f3b(0x198)],_0x52de06,_0x2d0f48),console[_0x174f3b(0x265)](_0x174f3b(0x1e7));}catch(_0xe7c048){console[_0x174f3b(0x23a)]('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0xe7c048),loggerService_1[_0x174f3b(0x21f)][_0x174f3b(0x284)](_0x1afd42[_0x174f3b(0x1e4)][_0x174f3b(0x20b)](),_0x174f3b(0x213),_0x174f3b(0x1d0)+_0xe7c048),_0x52de06=_0x23be9b;}}else loggerService_1[_0x174f3b(0x21f)]['logWhiteDomainResponse'](_0x1afd42[_0x174f3b(0x1e4)]['toLowerCase'](),_0x174f3b(0x1a9),_0x39a259[_0x174f3b(0x198)],_0x52de06,_0x2d0f48),console[_0x174f3b(0x265)](_0x174f3b(0x2df));console[_0x174f3b(0x265)](_0x174f3b(0x201),_0x52de06[_0x174f3b(0x198)]),console[_0x174f3b(0x265)]('Final:',_0x52de06[_0x174f3b(0x27c)]),console[_0x174f3b(0x265)](_0x174f3b(0x216),_0x52de06['payment_id']),console[_0x174f3b(0x265)](_0x174f3b(0x2c9),_0x52de06['3ds_url']||_0x174f3b(0x248));if(_0x52de06['status']===0x64&&_0x52de06['final']===0x1)return console[_0x174f3b(0x265)](_0x174f3b(0x1e1)),{'gateway_payment_id':_0x52de06[_0x174f3b(0x210)]?.[_0x174f3b(0x2ab)](),'payment_url':_0x45547e,'requires_3ds':![],'status':_0x174f3b(0x1f0),'final':!![]};if(_0x52de06[_0x174f3b(0x280)])return console[_0x174f3b(0x265)]('🔐\x203DS\x20verification\x20required'),this[_0x174f3b(0x2db)](_0x57bfe7,_0x20cd39,_0x52de06['payment_id']?.[_0x174f3b(0x2ab)]()||_0x20cd39,_0x1afd42[_0x174f3b(0x1e4)]),{'gateway_payment_id':_0x52de06[_0x174f3b(0x210)]?.[_0x174f3b(0x2ab)](),'payment_url':_0x52de06[_0x174f3b(0x280)],'requires_3ds':!![],'threeds_url':_0x52de06[_0x174f3b(0x280)],'status':_0x174f3b(0x1ba),'final':![]};let _0x24a27b=this[_0x174f3b(0x1e5)](_0x52de06['status'],_0x52de06[_0x174f3b(0x23e)]||_0x52de06[_0x174f3b(0x20d)]),_0x35530d=_0x52de06[_0x174f3b(0x198)],_0x36ec2d=this['isFinalStatus'](_0x52de06[_0x174f3b(0x198)]);return console['log'](_0x174f3b(0x19f)+_0x35530d+_0x174f3b(0x288)+_0x36ec2d+_0x174f3b(0x1a8)+_0x24a27b),{'gateway_payment_id':_0x52de06[_0x174f3b(0x210)]?.[_0x174f3b(0x2ab)](),'payment_url':_0x45547e,'requires_3ds':![],'status':_0x174f3b(0x268),'final':!![],'errorMessage':_0x24a27b};}catch(_0x22ba56){console[_0x174f3b(0x23a)](_0x174f3b(0x1c3)),console[_0x174f3b(0x23a)](_0x174f3b(0x197),_0x22ba56),loggerService_1[_0x174f3b(0x21f)]['logWhiteDomainError'](_0x174f3b(0x24a),'/charge',_0x22ba56);throw new Error(_0x174f3b(0x222)+(_0x22ba56 instanceof Error?_0x22ba56[_0x174f3b(0x20d)]:_0x174f3b(0x25d)));}}async[a49_0x5f3c30(0x292)](_0x479d38,_0x40a7e6,_0x5b86e4='VISA'){const _0x50b44d=a49_0x5f3c30;console[_0x50b44d(0x265)](_0x50b44d(0x1b2)+_0x5b86e4+_0x50b44d(0x200)+_0x479d38+'\x20('+_0x40a7e6+')');try{const _0x32ae06={'payment_id':_0x479d38,'order_id':_0x40a7e6},_0x374d45=JSON[_0x50b44d(0x2d7)](_0x32ae06),_0x4ccb50=this[_0x50b44d(0x260)](_0x5b86e4===_0x50b44d(0x2eb)?'4000000000000000':_0x50b44d(0x1f6)),{key:_0xa4a3a7,iv:_0x60442d}=this[_0x50b44d(0x1de)](),_0x149e5c=this['encryptAES'](_0x374d45,_0xa4a3a7,_0x60442d),_0x304bc3=this['encryptRSA'](_0xa4a3a7,_0x60442d,_0x4ccb50[_0x50b44d(0x24c)]),_0x3c34a2=this['signRSA'](_0x374d45,_0x4ccb50['privateKeyPath']),_0x64d78f={'merchant_point_id':_0x4ccb50['merchantPointId'],'method':'status','info':_0x149e5c,'key':_0x304bc3,'sign':_0x3c34a2,'lang':'en'};loggerService_1['loggerService'][_0x50b44d(0x1df)](_0x5b86e4[_0x50b44d(0x20b)](),_0x50b44d(0x1b0),_0x50b44d(0x252),{'merchant_point_id':_0x4ccb50[_0x50b44d(0x259)],'method':_0x50b44d(0x198),'lang':'en'});const _0x361ce1=Date['now'](),_0x127cce=await fetch(_0x4ccb50[_0x50b44d(0x1cc)],{'method':_0x50b44d(0x252),'headers':{'Content-Type':_0x50b44d(0x22e),'Accept':'application/json','User-Agent':_0x50b44d(0x23b)},'body':JSON[_0x50b44d(0x2d7)](_0x64d78f)}),_0x3de747=Date[_0x50b44d(0x278)]()-_0x361ce1;if(!_0x127cce['ok']){const _0x3a2f4f=await _0x127cce[_0x50b44d(0x29b)]();loggerService_1[_0x50b44d(0x21f)][_0x50b44d(0x246)](_0x5b86e4['toLowerCase'](),_0x50b44d(0x1b8),_0x127cce['status'],_0x3a2f4f,_0x3de747);throw new Error(_0x50b44d(0x2a4)+_0x127cce[_0x50b44d(0x198)]);}const _0x2f825d=await _0x127cce[_0x50b44d(0x224)]();loggerService_1[_0x50b44d(0x21f)]['logWhiteDomainResponse'](_0x5b86e4[_0x50b44d(0x20b)](),_0x50b44d(0x1b8),_0x127cce[_0x50b44d(0x198)],_0x2f825d,_0x3de747);let _0x4c12f3=_0x2f825d;if(_0x2f825d[_0x50b44d(0x1ff)]&&_0x2f825d[_0x50b44d(0x2b0)]&&_0x2f825d[_0x50b44d(0x269)]){console[_0x50b44d(0x265)](_0x50b44d(0x2ac));try{const _0x34f5f7=await this[_0x50b44d(0x283)](_0x2f825d['info'],_0x2f825d['key'],_0x5b86e4);_0x4c12f3=JSON[_0x50b44d(0x21b)](_0x34f5f7),console[_0x50b44d(0x265)](_0x50b44d(0x253)),loggerService_1[_0x50b44d(0x21f)][_0x50b44d(0x246)](_0x5b86e4['toLowerCase'](),_0x50b44d(0x2be),_0x127cce[_0x50b44d(0x198)],_0x4c12f3,_0x3de747),console[_0x50b44d(0x265)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x1122ac){console[_0x50b44d(0x23a)]('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x1122ac),loggerService_1['loggerService']['logWhiteDomainError'](_0x5b86e4[_0x50b44d(0x20b)](),_0x50b44d(0x2bf),_0x50b44d(0x24b)+_0x1122ac),_0x4c12f3=_0x2f825d;}}else loggerService_1[_0x50b44d(0x21f)][_0x50b44d(0x246)](_0x5b86e4[_0x50b44d(0x20b)](),_0x50b44d(0x2be),_0x127cce[_0x50b44d(0x198)],_0x4c12f3,_0x3de747),console[_0x50b44d(0x265)]('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x50b44d(0x265)]('📊\x20Status\x20check\x20result:',{'status':_0x4c12f3[_0x50b44d(0x198)],'final':_0x4c12f3[_0x50b44d(0x27c)],'payment_id':_0x4c12f3['payment_id'],'desc':_0x4c12f3[_0x50b44d(0x23e)]});let _0x50c548='PENDING';if(_0x4c12f3['status']===0x64&&_0x4c12f3['final']===0x1)_0x50c548=_0x50b44d(0x1f0);else{if(_0x4c12f3['final']===0x0||!this[_0x50b44d(0x237)](_0x4c12f3['status']))_0x50c548=_0x50b44d(0x1ba);else _0x4c12f3['final']===0x1||this['isFinalStatus'](_0x4c12f3[_0x50b44d(0x198)])?_0x50c548=_0x50b44d(0x268):_0x50c548=_0x50b44d(0x1ba);}const _0x5cd22c=this[_0x50b44d(0x1e5)](_0x4c12f3['status'],_0x4c12f3[_0x50b44d(0x23e)]);return{'status':_0x50c548,'final':this[_0x50b44d(0x237)](_0x4c12f3[_0x50b44d(0x198)]),'amount':_0x4c12f3[_0x50b44d(0x2b1)],'currency':_0x4c12f3['currency'],'date_success':_0x4c12f3[_0x50b44d(0x1c4)],'description':_0x5cd22c};}catch(_0x1c591a){console['error'](_0x5b86e4+_0x50b44d(0x298),_0x1c591a),loggerService_1[_0x50b44d(0x21f)][_0x50b44d(0x284)](_0x5b86e4[_0x50b44d(0x20b)](),_0x50b44d(0x1b0),_0x1c591a);throw new Error(_0x50b44d(0x243)+_0x5b86e4+'\x20payment\x20status:\x20'+(_0x1c591a instanceof Error?_0x1c591a[_0x50b44d(0x20d)]:_0x50b44d(0x25d)));}}['scheduleStatusChecks'](_0x2d23e6,_0x230e4e,_0x3bf6cf,_0xfebb61){const _0x2ce3cd=a49_0x5f3c30;console['log'](_0x2ce3cd(0x230)+_0xfebb61+_0x2ce3cd(0x19b)+_0x2d23e6+'\x20('+_0x3bf6cf+')'),this[_0x2ce3cd(0x211)](_0x2d23e6);const _0x31dfaa=[],_0x191d07=0x5*0x3c*0x3e8,_0x1872c5=0x2*0x3c*0x3c*0x3e8,_0x4a5eda=Math[_0x2ce3cd(0x2da)](_0x1872c5/_0x191d07);console[_0x2ce3cd(0x265)](_0x2ce3cd(0x1f7)+_0x4a5eda+_0x2ce3cd(0x19a));for(let _0x57bced=0x1;_0x57bced<=_0x4a5eda;_0x57bced++){const _0x5b05bf=setTimeout(async()=>{const _0x45dc79=_0x2ce3cd;console[_0x45dc79(0x265)](_0x45dc79(0x19e)+_0xfebb61+_0x45dc79(0x24e)+_0x57bced+'/'+_0x4a5eda+_0x45dc79(0x291)+_0x2d23e6);try{const _0x41f18c=await this[_0x45dc79(0x292)](_0x3bf6cf,_0x230e4e,_0xfebb61);console[_0x45dc79(0x265)](_0x45dc79(0x24f)+_0x57bced+_0x45dc79(0x241),_0x41f18c),_0x41f18c[_0x45dc79(0x27c)]&&(console[_0x45dc79(0x265)](_0x45dc79(0x20f)+_0x2d23e6+_0x45dc79(0x205)+_0x41f18c[_0x45dc79(0x198)]+_0x45dc79(0x1af)),this[_0x45dc79(0x211)](_0x2d23e6),await this[_0x45dc79(0x20e)](_0x2d23e6,_0x41f18c[_0x45dc79(0x198)],_0x41f18c));}catch(_0x9e0135){console['error'](_0x45dc79(0x21e)+_0x57bced+_0x45dc79(0x28c)+_0x2d23e6+':',_0x9e0135);}},_0x57bced*_0x191d07);_0x31dfaa['push'](_0x5b05bf);}this[_0x2ce3cd(0x1a5)][_0x2ce3cd(0x2cb)](_0x2d23e6,_0x31dfaa),console[_0x2ce3cd(0x265)](_0x2ce3cd(0x2c2)+_0x4a5eda+_0x2ce3cd(0x1f2)+_0x2d23e6);}[a49_0x5f3c30(0x211)](_0x55b45d){const _0x213f1b=a49_0x5f3c30,_0x5a717c=this[_0x213f1b(0x1a5)][_0x213f1b(0x194)](_0x55b45d);_0x5a717c&&(console[_0x213f1b(0x265)](_0x213f1b(0x203)+_0x5a717c[_0x213f1b(0x2e9)]+_0x213f1b(0x1f3)+_0x55b45d),_0x5a717c['forEach']((_0x5d2113,_0x38ad1e)=>{clearTimeout(_0x5d2113);}),this[_0x213f1b(0x1a5)][_0x213f1b(0x242)](_0x55b45d));}async[a49_0x5f3c30(0x20e)](_0x4f5db1,_0x5a67f7,_0x45e239){const _0x35a215=a49_0x5f3c30;try{const _0x581109=(await Promise[_0x35a215(0x294)]()['then'](()=>__importStar(require(_0x35a215(0x23f)))))[_0x35a215(0x2d5)],_0x3d8f45={'status':_0x5a67f7[_0x35a215(0x2ad)](),'updatedAt':new Date(),'statusChangedBy':_0x35a215(0x277),'statusChangedAt':new Date()};_0x5a67f7===_0x35a215(0x1f0)&&(_0x3d8f45[_0x35a215(0x272)]=new Date()),_0x5a67f7===_0x35a215(0x268)&&_0x45e239[_0x35a215(0x1cd)]&&(_0x3d8f45['failureMessage']=_0x45e239[_0x35a215(0x1cd)],console['log'](_0x35a215(0x255)+_0x45e239[_0x35a215(0x1cd)])),_0x45e239['description']&&(_0x3d8f45['adminNotes']=(_0x5a67f7===_0x35a215(0x1f0)?_0x35a215(0x2a9):'VISA/MasterCard')+':\x20'+_0x45e239[_0x35a215(0x1cd)]),await _0x581109['payment'][_0x35a215(0x244)]({'where':{'id':_0x4f5db1},'data':_0x3d8f45}),console[_0x35a215(0x265)](_0x35a215(0x20f)+_0x4f5db1+_0x35a215(0x245)+_0x5a67f7),await this[_0x35a215(0x1cf)](_0x4f5db1,_0x5a67f7);}catch(_0x30144d){console[_0x35a215(0x23a)]('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x4f5db1+':',_0x30144d);}}async[a49_0x5f3c30(0x1cf)](_0x485708,_0xf6857f){const _0x22c8fd=a49_0x5f3c30;try{const _0x27c21c=(await Promise['resolve']()[_0x22c8fd(0x2e1)](()=>__importStar(require(_0x22c8fd(0x23f)))))[_0x22c8fd(0x2d5)],{telegramBotService:_0x5dbdd8}=await Promise[_0x22c8fd(0x294)]()[_0x22c8fd(0x2e1)](()=>__importStar(require(_0x22c8fd(0x2af)))),_0x2375d8=await _0x27c21c[_0x22c8fd(0x219)][_0x22c8fd(0x1db)]({'where':{'id':_0x485708},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x2375d8)return;const _0x3f36de={'PAID':_0x22c8fd(0x1ae),'FAILED':_0x22c8fd(0x28f)},_0x1aef49=_0x3f36de[_0xf6857f];_0x1aef49&&await _0x5dbdd8['sendPaymentNotification'](_0x2375d8[_0x22c8fd(0x21d)],_0x2375d8,_0x1aef49),await this[_0x22c8fd(0x1a6)](_0x2375d8,_0xf6857f);}catch(_0x1d37b5){console[_0x22c8fd(0x23a)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x1d37b5);}}async[a49_0x5f3c30(0x1a6)](_0x3b6af8,_0x3674a1){const _0x28be18=a49_0x5f3c30,_0x18458d=Date[_0x28be18(0x278)]();try{const _0x5de0e6=_0x3b6af8['shop'],_0x352e33=_0x5de0e6[_0x28be18(0x1e6)];if(!_0x352e33?.[_0x28be18(0x191)]){console[_0x28be18(0x265)](_0x28be18(0x23c)+_0x5de0e6['id']);return;}const _0x3350dd=_0x3674a1===_0x28be18(0x1f0)?_0x28be18(0x26e):'payment.failed';let _0x3198c5=[];if(_0x352e33[_0x28be18(0x2ae)])try{_0x3198c5=Array[_0x28be18(0x1b6)](_0x352e33[_0x28be18(0x2ae)])?_0x352e33[_0x28be18(0x2ae)]:JSON[_0x28be18(0x21b)](_0x352e33['webhookEvents']);}catch(_0x4461ea){console[_0x28be18(0x23a)]('Error\x20parsing\x20webhook\x20events:',_0x4461ea),_0x3198c5=[];}if(!_0x3198c5[_0x28be18(0x195)](_0x3350dd)){console['log'](_0x28be18(0x217)+_0x3350dd+_0x28be18(0x2ea)+_0x5de0e6['id']);return;}const _0x5f481d={'event':_0x3350dd,'payment':{'id':_0x3b6af8['id'],'order_id':_0x3b6af8[_0x28be18(0x21c)],'gateway_order_id':_0x3b6af8['gatewayOrderId'],'gateway':_0x28be18(0x2d0),'amount':_0x3b6af8[_0x28be18(0x2b1)],'currency':_0x3b6af8[_0x28be18(0x1e0)],'status':_0x3674a1[_0x28be18(0x20b)](),'customer_email':_0x3b6af8[_0x28be18(0x2bd)],'customer_name':_0x3b6af8[_0x28be18(0x274)],'created_at':_0x3b6af8[_0x28be18(0x1b9)],'updated_at':new Date()}},_0x2d193a=await fetch(_0x352e33[_0x28be18(0x191)],{'method':'POST','headers':{'Content-Type':_0x28be18(0x22e),'User-Agent':_0x28be18(0x204)},'body':JSON[_0x28be18(0x2d7)](_0x5f481d)}),_0x2a0e58=Date[_0x28be18(0x278)]()-_0x18458d;loggerService_1['loggerService'][_0x28be18(0x25c)](_0x3b6af8[_0x28be18(0x21d)],_0x352e33[_0x28be18(0x191)],_0x3350dd,_0x2d193a[_0x28be18(0x198)],_0x2a0e58,_0x5f481d),console['log']('MasterCard\x20webhook\x20sent\x20to\x20'+_0x352e33['webhookUrl']+'\x20with\x20status\x20'+_0x2d193a['status']+'\x20('+_0x2a0e58+_0x28be18(0x1d5));}catch(_0x39971d){console[_0x28be18(0x23a)](_0x28be18(0x1ca),_0x39971d),loggerService_1[_0x28be18(0x21f)][_0x28be18(0x2a0)](_0x3b6af8[_0x28be18(0x21d)],_0x3b6af8[_0x28be18(0x1da)]?.[_0x28be18(0x1e6)]?.[_0x28be18(0x191)]||_0x28be18(0x25e),_0x28be18(0x20a),_0x39971d,{});}}[a49_0x5f3c30(0x2ba)](_0x34faa1){const _0x5248da=a49_0x5f3c30,_0x1011df=_0x34faa1['replace'](/[\s-]/g,'');if(_0x1011df[_0x5248da(0x2e9)]<0x4)return _0x5248da(0x258);return _0x5248da(0x227)+_0x1011df[_0x5248da(0x25a)](-0x4);}async[a49_0x5f3c30(0x28e)](_0x2b3b9f,_0x190cb9=a49_0x5f3c30(0x271)){const _0x34922e=a49_0x5f3c30;console[_0x34922e(0x265)](_0x34922e(0x233),JSON[_0x34922e(0x2d7)](_0x2b3b9f,null,0x2));let _0x546744=_0x2b3b9f,_0x473e4f=_0x190cb9;_0x2b3b9f['card_type']?(_0x473e4f=_0x2b3b9f[_0x34922e(0x2c0)][_0x34922e(0x2ad)]()===_0x34922e(0x2eb)?_0x34922e(0x2eb):_0x34922e(0x271),console[_0x34922e(0x265)](_0x34922e(0x1c5)+_0x473e4f)):console['log']('🔍\x20Using\x20provided\x20card\x20type:\x20'+_0x473e4f);if(_0x2b3b9f[_0x34922e(0x1ff)]&&_0x2b3b9f[_0x34922e(0x2b0)]&&_0x2b3b9f['sign']){console['log'](_0x34922e(0x22a));try{const _0x5deb9b=await this['decryptResponsePhp'](_0x2b3b9f[_0x34922e(0x1ff)],_0x2b3b9f[_0x34922e(0x2b0)],_0x473e4f);_0x546744=JSON[_0x34922e(0x21b)](_0x5deb9b),console['log'](_0x34922e(0x270)),console[_0x34922e(0x265)](_0x34922e(0x261),JSON['stringify'](_0x546744,null,0x2));}catch(_0x5a02df){console[_0x34922e(0x23a)](_0x34922e(0x18e),_0x5a02df),console[_0x34922e(0x265)]('⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted'),_0x546744=_0x2b3b9f;}}else console[_0x34922e(0x265)](_0x34922e(0x266));let _0x17cb27=_0x34922e(0x1ba);if(_0x546744['status']===0x64&&_0x546744[_0x34922e(0x27c)]===0x1)_0x17cb27='PAID';else{if(_0x546744[_0x34922e(0x27c)]===0x0||!this[_0x34922e(0x237)](_0x546744[_0x34922e(0x198)]))_0x17cb27=_0x34922e(0x1ba);else _0x546744[_0x34922e(0x27c)]===0x1||this[_0x34922e(0x237)](_0x546744['status'])?_0x17cb27=_0x34922e(0x268):_0x17cb27=_0x34922e(0x1ba);}let _0x1659dd='';if(_0x546744[_0x34922e(0x1be)])_0x1659dd=_0x546744[_0x34922e(0x1be)][_0x34922e(0x2ab)](),console[_0x34922e(0x265)](_0x34922e(0x1f8)+_0x473e4f+_0x34922e(0x2d3)+_0x1659dd);else _0x546744['payment_id']?(_0x1659dd=_0x546744[_0x34922e(0x210)]['toString'](),console['log'](_0x34922e(0x1f8)+_0x473e4f+_0x34922e(0x249)+_0x1659dd)):(_0x1659dd=_0x546744['orderId']||_0x546744[_0x34922e(0x1ab)]||_0x546744['id']||'',console['log'](_0x34922e(0x1c8)+_0x1659dd));console[_0x34922e(0x265)]('📊\x20'+_0x473e4f+_0x34922e(0x2a1)),console[_0x34922e(0x265)](_0x34922e(0x21a)+_0x1659dd+_0x34922e(0x26c)+_0x546744['order_id']+',\x20orderId='+_0x546744[_0x34922e(0x21c)]+_0x34922e(0x2e0)+_0x546744[_0x34922e(0x210)]+',\x20paymentId='+_0x546744['paymentId']+',\x20id='+_0x546744['id']+')'),console['log'](_0x34922e(0x215)+_0x17cb27+_0x34922e(0x2ca)+_0x546744[_0x34922e(0x198)]+_0x34922e(0x22d)+_0x546744[_0x34922e(0x27c)]+')'),console[_0x34922e(0x265)](_0x34922e(0x256)+_0x546744[_0x34922e(0x2b1)]),console['log'](_0x34922e(0x1a1)+_0x546744[_0x34922e(0x1e0)]);let _0x10021a;_0x17cb27==='FAILED'&&(_0x10021a=this[_0x34922e(0x1e5)](_0x546744[_0x34922e(0x198)],_0x546744[_0x34922e(0x23e)]),console[_0x34922e(0x265)](_0x34922e(0x26a)+_0x10021a));const _0xc2d4ba={'paymentId':_0x1659dd,'status':_0x17cb27,'amount':_0x546744['amount'],'currency':_0x546744[_0x34922e(0x1e0)]};return _0x10021a&&(_0xc2d4ba[_0x34922e(0x2c5)]=_0x10021a),_0xc2d4ba;}['stopAllStatusChecks'](){const _0x44070f=a49_0x5f3c30;console[_0x44070f(0x265)](_0x44070f(0x262));const _0x281076=this[_0x44070f(0x1a5)][_0x44070f(0x1ea)];for(const [_0x3df815]of this[_0x44070f(0x1a5)]){this[_0x44070f(0x211)](_0x3df815);}console['log']('🛑\x20Stopped\x20'+_0x281076+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a49_0x5f3c30(0x2c1)]=VisaMasterCardService;