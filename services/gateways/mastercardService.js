'use strict';const a43_0x5cc7e7=a43_0x596b;(function(_0xe89331,_0x240d46){const _0x9fb55a=a43_0x596b,_0xab7a96=_0xe89331();while(!![]){try{const _0x2c3b09=-parseInt(_0x9fb55a(0xcb))/0x1+parseInt(_0x9fb55a(0xe1))/0x2*(-parseInt(_0x9fb55a(0x185))/0x3)+-parseInt(_0x9fb55a(0x137))/0x4*(parseInt(_0x9fb55a(0x13c))/0x5)+-parseInt(_0x9fb55a(0xe6))/0x6*(parseInt(_0x9fb55a(0xeb))/0x7)+parseInt(_0x9fb55a(0x9a))/0x8+-parseInt(_0x9fb55a(0xed))/0x9*(parseInt(_0x9fb55a(0x107))/0xa)+parseInt(_0x9fb55a(0xa7))/0xb;if(_0x2c3b09===_0x240d46)break;else _0xab7a96['push'](_0xab7a96['shift']());}catch(_0x11092c){_0xab7a96['push'](_0xab7a96['shift']());}}}(a43_0x2f2a,0x7b0ec));var __createBinding=this&&this[a43_0x5cc7e7(0x11d)]||(Object['create']?function(_0x587456,_0x83425,_0x292981,_0x58308d){const _0x34a0c4=a43_0x5cc7e7;if(_0x58308d===undefined)_0x58308d=_0x292981;var _0x274cc3=Object['getOwnPropertyDescriptor'](_0x83425,_0x292981);(!_0x274cc3||(_0x34a0c4(0x147)in _0x274cc3?!_0x83425[_0x34a0c4(0x159)]:_0x274cc3['writable']||_0x274cc3[_0x34a0c4(0x171)]))&&(_0x274cc3={'enumerable':!![],'get':function(){return _0x83425[_0x292981];}}),Object[_0x34a0c4(0x11c)](_0x587456,_0x58308d,_0x274cc3);}:function(_0x351439,_0x547031,_0x12d6eb,_0xd3c8f6){if(_0xd3c8f6===undefined)_0xd3c8f6=_0x12d6eb;_0x351439[_0xd3c8f6]=_0x547031[_0x12d6eb];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a43_0x5cc7e7(0x16a)]?function(_0x3bfceb,_0x4e958b){const _0x1a5b08=a43_0x5cc7e7;Object[_0x1a5b08(0x11c)](_0x3bfceb,_0x1a5b08(0xcc),{'enumerable':!![],'value':_0x4e958b});}:function(_0x10cbae,_0x249af3){_0x10cbae['default']=_0x249af3;}),__importStar=this&&this[a43_0x5cc7e7(0xfa)]||(function(){var _0x301419=function(_0x5a9844){return _0x301419=Object['getOwnPropertyNames']||function(_0x53f1c0){const _0x277a85=a43_0x596b;var _0x426dad=[];for(var _0x52414b in _0x53f1c0)if(Object[_0x277a85(0x154)][_0x277a85(0xc9)]['call'](_0x53f1c0,_0x52414b))_0x426dad[_0x426dad[_0x277a85(0x16c)]]=_0x52414b;return _0x426dad;},_0x301419(_0x5a9844);};return function(_0x363449){const _0x454af1=a43_0x596b;if(_0x363449&&_0x363449[_0x454af1(0x159)])return _0x363449;var _0x24d829={};if(_0x363449!=null){for(var _0x2ff06d=_0x301419(_0x363449),_0x3c5ac4=0x0;_0x3c5ac4<_0x2ff06d[_0x454af1(0x16c)];_0x3c5ac4++)if(_0x2ff06d[_0x3c5ac4]!==_0x454af1(0xcc))__createBinding(_0x24d829,_0x363449,_0x2ff06d[_0x3c5ac4]);}return __setModuleDefault(_0x24d829,_0x363449),_0x24d829;};}()),__importDefault=this&&this[a43_0x5cc7e7(0x143)]||function(_0x22f8ed){const _0x40d8eb=a43_0x5cc7e7;return _0x22f8ed&&_0x22f8ed[_0x40d8eb(0x159)]?_0x22f8ed:{'default':_0x22f8ed};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a43_0x5cc7e7(0x91)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a43_0x5cc7e7(0xc0))),loggerService_1=require(a43_0x5cc7e7(0x9b));class MasterCardService{constructor(){const _0x598c7c=a43_0x5cc7e7;this[_0x598c7c(0xfd)]=new Map(),this[_0x598c7c(0xbb)]=_0x598c7c(0x117),this['merchantPointId']=0x67c,this['privateKeyPath']=path_1[_0x598c7c(0xcc)]['join'](process['cwd'](),_0x598c7c(0x145),_0x598c7c(0x14d)),this['publicKeyPath']=path_1[_0x598c7c(0xcc)][_0x598c7c(0xf7)](process[_0x598c7c(0xf3)](),_0x598c7c(0x145),_0x598c7c(0x119)),console[_0x598c7c(0xc3)](_0x598c7c(0xd1)),console[_0x598c7c(0xc3)](_0x598c7c(0x168),this['privateKeyPath']),console[_0x598c7c(0xc3)](_0x598c7c(0x116),this['publicKeyPath']),this[_0x598c7c(0xba)]();}[a43_0x5cc7e7(0xba)](){const _0x1d43e5=a43_0x5cc7e7;try{if(!fs_1[_0x1d43e5(0xcc)]['existsSync'](this[_0x1d43e5(0x184)]))throw new Error(_0x1d43e5(0x88)+this[_0x1d43e5(0x184)]);if(!fs_1[_0x1d43e5(0xcc)][_0x1d43e5(0x177)](this['publicKeyPath']))throw new Error('Public\x20key\x20file\x20not\x20found:\x20'+this[_0x1d43e5(0xd4)]);const _0x32459d=fs_1['default'][_0x1d43e5(0xc2)](this[_0x1d43e5(0x184)],_0x1d43e5(0x13d))[_0x1d43e5(0x93)](),_0x3bb455=fs_1['default'][_0x1d43e5(0xc2)](this[_0x1d43e5(0xd4)],_0x1d43e5(0x13d))[_0x1d43e5(0x93)]();if(!_0x32459d[_0x1d43e5(0x131)]('-----BEGIN')||!_0x32459d[_0x1d43e5(0x131)](_0x1d43e5(0xf2)))throw new Error(_0x1d43e5(0xce));if(!_0x3bb455[_0x1d43e5(0x131)](_0x1d43e5(0x104))||!_0x3bb455[_0x1d43e5(0x131)](_0x1d43e5(0xf2)))throw new Error('Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console['log']('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console['log']('🔐\x20Private\x20key\x20length:\x20'+_0x32459d[_0x1d43e5(0x16c)]+_0x1d43e5(0x86)),console[_0x1d43e5(0xc3)](_0x1d43e5(0x130)+_0x3bb455[_0x1d43e5(0x16c)]+_0x1d43e5(0x86));}catch(_0x1c411c){console[_0x1d43e5(0x97)](_0x1d43e5(0x96),_0x1c411c);throw _0x1c411c;}}['generateAESKey'](){const _0xf8554a=a43_0x5cc7e7,_0x350aa0=crypto_1[_0xf8554a(0xcc)][_0xf8554a(0xb1)](0x20),_0x5a714=crypto_1[_0xf8554a(0xcc)][_0xf8554a(0xb1)](0x10);return{'key':_0x350aa0,'iv':_0x5a714};}['encryptAES'](_0x20ad28,_0x3b4120,_0x27e15b){const _0x53bfe3=a43_0x5cc7e7,_0x476043=crypto_1[_0x53bfe3(0xcc)]['createCipheriv'](_0x53bfe3(0xaf),_0x3b4120,_0x27e15b);let _0x418ec8=_0x476043[_0x53bfe3(0xa9)](_0x20ad28,_0x53bfe3(0x13d),'base64');return _0x418ec8+=_0x476043[_0x53bfe3(0x188)](_0x53bfe3(0x15b)),_0x418ec8;}[a43_0x5cc7e7(0xef)](_0x198371,_0x390e1b){const _0x3060cb=a43_0x5cc7e7;try{const _0x4cc4a6=fs_1['default'][_0x3060cb(0xc2)](this[_0x3060cb(0xd4)],'utf8')[_0x3060cb(0x93)](),_0x5bae05={'iv':_0x390e1b[_0x3060cb(0x92)](_0x3060cb(0x15b)),'key':_0x198371[_0x3060cb(0x92)](_0x3060cb(0x15b))},_0xc35950=JSON[_0x3060cb(0xb3)](_0x5bae05);console[_0x3060cb(0xc3)](_0x3060cb(0x17c),_0xc35950[_0x3060cb(0x16c)]);const _0x26bbd5=crypto_1[_0x3060cb(0xcc)]['publicEncrypt']({'key':_0x4cc4a6,'padding':crypto_1[_0x3060cb(0xcc)][_0x3060cb(0xc4)][_0x3060cb(0xe4)]},Buffer[_0x3060cb(0xab)](_0xc35950));return console[_0x3060cb(0xc3)](_0x3060cb(0x13e),_0x26bbd5[_0x3060cb(0x16c)]),_0x26bbd5['toString']('base64');}catch(_0xde4cd1){console[_0x3060cb(0x97)](_0x3060cb(0x17d),_0xde4cd1);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a43_0x5cc7e7(0xdb)](_0xb6487b){const _0xd792f3=a43_0x5cc7e7;try{const _0xd15b96=fs_1['default'][_0xd792f3(0xc2)](this[_0xd792f3(0x184)],_0xd792f3(0x13d))['trim'](),_0x257514=crypto_1[_0xd792f3(0xcc)][_0xd792f3(0xb9)](_0xd792f3(0x162));_0x257514[_0xd792f3(0xa9)](_0xb6487b),_0x257514[_0xd792f3(0xd0)]();const _0x331169=_0x257514[_0xd792f3(0xee)](_0xd15b96,'base64');return console[_0xd792f3(0xc3)](_0xd792f3(0xfc)),console[_0xd792f3(0xc3)]('📝\x20Data\x20to\x20sign\x20length:',_0xb6487b[_0xd792f3(0x16c)]),console[_0xd792f3(0xc3)](_0xd792f3(0xec),_0x331169[_0xd792f3(0x16c)]),_0x331169;}catch(_0x51436f){console[_0xd792f3(0x97)](_0xd792f3(0xe9),_0x51436f),console[_0xd792f3(0x97)](_0xd792f3(0x135),_0xb6487b[_0xd792f3(0x146)](0x0,0xc8)+_0xd792f3(0x8e));throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}['decryptAES'](_0x17aeb6,_0x462aa9,_0x4fc8d5){const _0x22e6df=a43_0x5cc7e7,_0x5bac78=crypto_1[_0x22e6df(0xcc)][_0x22e6df(0x15d)](_0x22e6df(0xaf),_0x462aa9,_0x4fc8d5);let _0x280a2d=_0x5bac78[_0x22e6df(0xa9)](_0x17aeb6,_0x22e6df(0x15b),_0x22e6df(0x13d));return _0x280a2d+=_0x5bac78[_0x22e6df(0x188)]('utf8'),_0x280a2d;}async[a43_0x5cc7e7(0x13b)](_0x35b56f,_0x12b355){const _0xb25a3=a43_0x5cc7e7;try{const _0x3b7905=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0xb25a3(0x12a),'headers':{'Content-Type':'application/json'},'body':JSON[_0xb25a3(0xb3)]({'info':_0x35b56f,'key':_0x12b355})});if(!_0x3b7905['ok'])throw new Error(_0xb25a3(0xda));return await _0x3b7905['text']();}catch(_0x2a7a5c){console['error'](_0xb25a3(0xfb),_0x2a7a5c);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a43_0x5cc7e7(0x10e)](_0xac7117,_0x31d732){const _0x3ae2ff=a43_0x5cc7e7;try{const _0x586d68=fs_1[_0x3ae2ff(0xcc)][_0x3ae2ff(0xc2)](this[_0x3ae2ff(0x184)],_0x3ae2ff(0x13d))['trim'](),_0x369d46=crypto_1['default'][_0x3ae2ff(0xaa)](_0x586d68,Buffer[_0x3ae2ff(0xab)](_0x31d732,'base64')),_0x4632bd=JSON['parse'](_0x369d46[_0x3ae2ff(0x92)]()),_0x5b320c=Buffer[_0x3ae2ff(0xab)](_0x4632bd[_0x3ae2ff(0x129)],_0x3ae2ff(0x15b)),_0x1b1333=Buffer['from'](_0x4632bd['iv'],'base64');return this['decryptAES'](_0xac7117,_0x5b320c,_0x1b1333);}catch(_0x285549){throw new Error(_0x3ae2ff(0xe7));}}async[a43_0x5cc7e7(0xa2)](_0x4148c7){const _0x351fe2=a43_0x5cc7e7,{paymentId:_0x3caef7,orderId:_0x4cb54f,amount:_0x155f74,currency:_0x2d42f7,cardData:_0x3785f2,resultUrl:_0x54f257,returnUrl:_0x36db4d,cardHolder:_0x20e241,browser:_0x136318}=_0x4148c7;console[_0x351fe2(0xc3)](_0x351fe2(0x172)),console['log'](_0x351fe2(0x138),_0x3caef7),console['log']('Order\x20ID:',_0x4cb54f),console[_0x351fe2(0xc3)](_0x351fe2(0x186),_0x155f74,_0x2d42f7),console['log'](_0x351fe2(0xf0),this[_0x351fe2(0x17b)](_0x3785f2[_0x351fe2(0x151)])),console[_0x351fe2(0xc3)](_0x351fe2(0xf8),_0x20e241[_0x351fe2(0x100)]+'\x20'+_0x20e241[_0x351fe2(0xb0)]),console['log']('Return\x20URL:',_0x36db4d),console['log'](_0x351fe2(0xdf),_0x54f257);const _0x4f8df0={'amount':_0x155f74,'currency':_0x2d42f7[_0x351fe2(0xa1)](),'order_id':_0x4cb54f,'result_url':_0x54f257,'return_url':_0x36db4d,'country':'','card':{'number':_0x3785f2[_0x351fe2(0x151)],'expire_month':_0x3785f2[_0x351fe2(0x183)],'expire_year':_0x3785f2['expire_year'],'cvv':_0x3785f2[_0x351fe2(0x12f)]},'card_holder':_0x20e241,'browser':_0x136318},_0x2ae7ca=JSON[_0x351fe2(0xb3)](_0x4f8df0);console[_0x351fe2(0xc3)](_0x351fe2(0x9c)),console[_0x351fe2(0xc3)](_0x351fe2(0x134)),console[_0x351fe2(0xc3)](_0x2ae7ca),console['log'](_0x351fe2(0x163),_0x2ae7ca[_0x351fe2(0x16c)]);try{const {key:_0x1d9ae5,iv:_0x3840e8}=this[_0x351fe2(0x9f)]();console[_0x351fe2(0xc3)](_0x351fe2(0x12e)),console[_0x351fe2(0xc3)]('🔐\x20AES\x20key\x20length:',_0x1d9ae5['length']),console['log'](_0x351fe2(0xdc),_0x3840e8['length']);const _0x6c79bf=this[_0x351fe2(0x136)](_0x2ae7ca,_0x1d9ae5,_0x3840e8);console[_0x351fe2(0xc3)](_0x351fe2(0x17f)),console[_0x351fe2(0xc3)](_0x351fe2(0x128),_0x6c79bf[_0x351fe2(0x16c)]);const _0x9c9a54=this[_0x351fe2(0xef)](_0x1d9ae5,_0x3840e8);console[_0x351fe2(0xc3)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x351fe2(0xc3)](_0x351fe2(0x133),_0x9c9a54[_0x351fe2(0x16c)]);const _0x452a3f=this[_0x351fe2(0xdb)](_0x2ae7ca);console['log']('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x351fe2(0xc3)](_0x351fe2(0xec),_0x452a3f[_0x351fe2(0x16c)]);const _0x9ce8a1={'merchant_point_id':this[_0x351fe2(0x11e)],'method':_0x351fe2(0x161),'info':_0x6c79bf,'key':_0x9c9a54,'sign':_0x452a3f,'lang':'en'};console[_0x351fe2(0xc3)](_0x351fe2(0x142)),console[_0x351fe2(0xc3)]('📝\x20Final\x20request\x20structure:'),console[_0x351fe2(0xc3)](_0x351fe2(0xd9),this[_0x351fe2(0x11e)]),console[_0x351fe2(0xc3)](_0x351fe2(0x17e)),console['log'](_0x351fe2(0x173),_0x6c79bf[_0x351fe2(0x16c)]),console[_0x351fe2(0xc3)](_0x351fe2(0xb7),_0x9c9a54[_0x351fe2(0x16c)]),console[_0x351fe2(0xc3)](_0x351fe2(0xac),_0x452a3f[_0x351fe2(0x16c)]),console['log']('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x351fe2(0x8a)][_0x351fe2(0x17a)](_0x351fe2(0xbd),_0x351fe2(0x87),_0x351fe2(0x12a),{'merchant_point_id':this[_0x351fe2(0x11e)],'method':_0x351fe2(0x161),'lang':'en'});const _0x1ddf4c=Date['now'](),_0x5127b0=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x351fe2(0x90),'Accept':'application/json','User-Agent':_0x351fe2(0xf5)},'body':JSON[_0x351fe2(0xb3)](_0x9ce8a1)}),_0x11fdd3=Date[_0x351fe2(0x166)]()-_0x1ddf4c;console[_0x351fe2(0xc3)](_0x351fe2(0xe5)),console['log'](_0x351fe2(0xe0),_0x5127b0['status']),console[_0x351fe2(0xc3)](_0x351fe2(0x14e),_0x11fdd3+'ms');if(!_0x5127b0['ok']){const _0x2e459a=await _0x5127b0['text']();console[_0x351fe2(0x97)](_0x351fe2(0xd3),_0x5127b0['status']),console['error'](_0x351fe2(0x182),_0x2e459a),loggerService_1[_0x351fe2(0x8a)][_0x351fe2(0xe8)](_0x351fe2(0xbd),_0x351fe2(0x112),_0x5127b0['status'],_0x2e459a,_0x11fdd3),loggerService_1['loggerService'][_0x351fe2(0xad)](_0x351fe2(0xbd),_0x351fe2(0x87),_0x351fe2(0xa5)+_0x5127b0['status']+':\x20'+_0x2e459a);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5127b0[_0x351fe2(0x165)]+',\x20body:\x20'+_0x2e459a);}const _0x320fab=await _0x5127b0[_0x351fe2(0x140)]();loggerService_1['loggerService'][_0x351fe2(0xe8)]('mastercard',_0x351fe2(0x112),_0x5127b0[_0x351fe2(0x165)],_0x320fab,_0x11fdd3),console[_0x351fe2(0xc3)](_0x351fe2(0x10c));let _0x4ed8fb=_0x320fab;if(_0x320fab[_0x351fe2(0x9e)]&&_0x320fab[_0x351fe2(0x129)]&&_0x320fab['sign']){console[_0x351fe2(0xc3)]('🔐\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x3fcca0=await this[_0x351fe2(0x13b)](_0x320fab[_0x351fe2(0x9e)],_0x320fab['key']);_0x4ed8fb=JSON[_0x351fe2(0xdd)](_0x3fcca0),console[_0x351fe2(0xc3)]('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0x351fe2(0x8a)][_0x351fe2(0xe8)](_0x351fe2(0xbd),_0x351fe2(0x108),_0x5127b0['status'],_0x4ed8fb,_0x11fdd3),console[_0x351fe2(0xc3)](_0x351fe2(0x10a));}catch(_0x25e583){console[_0x351fe2(0x97)](_0x351fe2(0x153),_0x25e583),loggerService_1[_0x351fe2(0x8a)][_0x351fe2(0xad)](_0x351fe2(0xbd),_0x351fe2(0xde),_0x351fe2(0xb5)+_0x25e583),_0x4ed8fb=_0x320fab;}}else loggerService_1[_0x351fe2(0x8a)][_0x351fe2(0xe8)]('mastercard',_0x351fe2(0x108),_0x5127b0[_0x351fe2(0x165)],_0x4ed8fb,_0x11fdd3),console['log'](_0x351fe2(0x94));console[_0x351fe2(0xc3)]('Status:',_0x4ed8fb[_0x351fe2(0x165)]),console['log'](_0x351fe2(0xa3),_0x4ed8fb['final']),console[_0x351fe2(0xc3)](_0x351fe2(0x138),_0x4ed8fb[_0x351fe2(0xd8)]),console[_0x351fe2(0xc3)](_0x351fe2(0x125),_0x4ed8fb[_0x351fe2(0x10b)]||_0x351fe2(0xb4));if(_0x4ed8fb[_0x351fe2(0x165)]===0x64&&_0x4ed8fb['final']===0x1)return console['log'](_0x351fe2(0x157)),{'gateway_payment_id':_0x4ed8fb[_0x351fe2(0xd8)]?.[_0x351fe2(0x92)](),'payment_url':_0x36db4d,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x4ed8fb[_0x351fe2(0x10b)])return console[_0x351fe2(0xc3)]('🔐\x203DS\x20verification\x20required'),this[_0x351fe2(0xf1)](_0x3caef7,_0x4cb54f,_0x4ed8fb['payment_id']?.[_0x351fe2(0x92)]()||_0x4cb54f),{'gateway_payment_id':_0x4ed8fb['payment_id']?.[_0x351fe2(0x92)](),'payment_url':_0x4ed8fb[_0x351fe2(0x10b)],'requires_3ds':!![],'threeds_url':_0x4ed8fb[_0x351fe2(0x10b)],'status':_0x351fe2(0x115),'final':![]};let _0x30ff2b=_0x4ed8fb[_0x351fe2(0xe2)]||_0x4ed8fb['message']||_0x351fe2(0x8f),_0x17d0a8=_0x4ed8fb['status'],_0x57f33e=_0x4ed8fb[_0x351fe2(0x188)];return console[_0x351fe2(0xc3)](_0x351fe2(0xf9)+_0x17d0a8+_0x351fe2(0x144)+_0x57f33e+_0x351fe2(0x149)+_0x30ff2b),{'gateway_payment_id':_0x4ed8fb[_0x351fe2(0xd8)]?.[_0x351fe2(0x92)](),'payment_url':_0x36db4d,'requires_3ds':![],'status':_0x351fe2(0xae),'final':!![]};}catch(_0x449a20){console['error']('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console[_0x351fe2(0x97)]('Error\x20details:',_0x449a20),loggerService_1[_0x351fe2(0x8a)]['logWhiteDomainError'](_0x351fe2(0xbd),_0x351fe2(0x87),_0x449a20);throw new Error(_0x351fe2(0xc5)+(_0x449a20 instanceof Error?_0x449a20[_0x351fe2(0x176)]:_0x351fe2(0x8f)));}}async['checkPaymentStatus'](_0x3f36c1,_0x2b0093){const _0xab1392=a43_0x5cc7e7;console[_0xab1392(0xc3)](_0xab1392(0x152)+_0x3f36c1+'\x20('+_0x2b0093+')');try{const _0xeb6a06={'payment_id':_0x3f36c1,'order_id':_0x2b0093},_0x208e45=JSON[_0xab1392(0xb3)](_0xeb6a06),{key:_0x311847,iv:_0x12e401}=this[_0xab1392(0x9f)](),_0x12f8f0=this['encryptAES'](_0x208e45,_0x311847,_0x12e401),_0x11202c=this['encryptRSA'](_0x311847,_0x12e401),_0x306bc1=this[_0xab1392(0xdb)](_0x208e45),_0x491347={'merchant_point_id':this[_0xab1392(0x11e)],'method':_0xab1392(0x165),'info':_0x12f8f0,'key':_0x11202c,'sign':_0x306bc1,'lang':'en'};loggerService_1[_0xab1392(0x8a)]['logWhiteDomainRequest'](_0xab1392(0xbd),'/status',_0xab1392(0x12a),{'merchant_point_id':this[_0xab1392(0x11e)],'method':_0xab1392(0x165),'lang':'en'});const _0xb1a6e6=Date['now'](),_0x3f2c32=await fetch(this[_0xab1392(0xbb)],{'method':'POST','headers':{'Content-Type':_0xab1392(0x90),'Accept':_0xab1392(0x90),'User-Agent':_0xab1392(0xf5)},'body':JSON[_0xab1392(0xb3)](_0x491347)}),_0x3ccbf5=Date[_0xab1392(0x166)]()-_0xb1a6e6;if(!_0x3f2c32['ok']){const _0x4858a2=await _0x3f2c32[_0xab1392(0x15a)]();loggerService_1[_0xab1392(0x8a)][_0xab1392(0xe8)](_0xab1392(0xbd),_0xab1392(0x109),_0x3f2c32['status'],_0x4858a2,_0x3ccbf5);throw new Error(_0xab1392(0x95)+_0x3f2c32[_0xab1392(0x165)]);}const _0x21eae0=await _0x3f2c32[_0xab1392(0x140)]();loggerService_1[_0xab1392(0x8a)][_0xab1392(0xe8)]('mastercard',_0xab1392(0x109),_0x3f2c32[_0xab1392(0x165)],_0x21eae0,_0x3ccbf5);let _0x49b10f=_0x21eae0;if(_0x21eae0[_0xab1392(0x9e)]&&_0x21eae0[_0xab1392(0x129)]&&_0x21eae0['sign']){console['log'](_0xab1392(0xbf));try{const _0x2e7d0a=this[_0xab1392(0x10e)](_0x21eae0[_0xab1392(0x9e)],_0x21eae0['key']);_0x49b10f=JSON['parse'](_0x2e7d0a),console[_0xab1392(0xc3)](_0xab1392(0xd5)),loggerService_1['loggerService'][_0xab1392(0xe8)]('mastercard',_0xab1392(0x127),_0x3f2c32[_0xab1392(0x165)],_0x49b10f,_0x3ccbf5),console[_0xab1392(0xc3)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0xd8f0e1){console['error'](_0xab1392(0xc6),_0xd8f0e1),loggerService_1[_0xab1392(0x8a)][_0xab1392(0xad)](_0xab1392(0xbd),_0xab1392(0x150),'Status\x20decryption\x20failed:\x20'+_0xd8f0e1),_0x49b10f=_0x21eae0;}}else loggerService_1[_0xab1392(0x8a)][_0xab1392(0xe8)]('mastercard',_0xab1392(0x127),_0x3f2c32[_0xab1392(0x165)],_0x49b10f,_0x3ccbf5),console['log']('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0xab1392(0xc3)]('📊\x20Status\x20check\x20result:',{'status':_0x49b10f['status'],'final':_0x49b10f[_0xab1392(0x188)],'payment_id':_0x49b10f['payment_id'],'desc':_0x49b10f[_0xab1392(0xe2)]});let _0xc89625=_0xab1392(0x115);if(_0x49b10f[_0xab1392(0x165)]===0x1&&_0x49b10f[_0xab1392(0x188)]===0x1)_0xc89625=_0xab1392(0x122);else _0x49b10f[_0xab1392(0x165)]===0x0&&_0x49b10f[_0xab1392(0x188)]===0x0?_0xc89625=_0xab1392(0x115):_0xc89625='FAILED';return{'status':_0xc89625,'final':_0x49b10f[_0xab1392(0x188)]===0x1,'amount':_0x49b10f[_0xab1392(0x15e)],'currency':_0x49b10f[_0xab1392(0x169)],'date_success':_0x49b10f['date_success'],'description':_0x49b10f[_0xab1392(0xe2)]};}catch(_0x5a3bfb){console[_0xab1392(0x97)](_0xab1392(0xf6),_0x5a3bfb),loggerService_1['loggerService']['logWhiteDomainError'](_0xab1392(0xbd),_0xab1392(0x121),_0x5a3bfb);throw new Error(_0xab1392(0x14b)+(_0x5a3bfb instanceof Error?_0x5a3bfb[_0xab1392(0x176)]:_0xab1392(0x8f)));}}[a43_0x5cc7e7(0xf1)](_0x511349,_0x34f190,_0x21140c){const _0x416f81=a43_0x5cc7e7;console[_0x416f81(0xc3)](_0x416f81(0x9d)+_0x511349+'\x20('+_0x21140c+')'),this[_0x416f81(0xa0)](_0x511349);const _0x430f10=[],_0x48884b=0x5*0x3c*0x3e8,_0x298490=0x2*0x3c*0x3c*0x3e8,_0x2451b9=Math[_0x416f81(0xea)](_0x298490/_0x48884b);console[_0x416f81(0xc3)](_0x416f81(0x8c)+_0x2451b9+_0x416f81(0xcf));for(let _0x1b0cda=0x1;_0x1b0cda<=_0x2451b9;_0x1b0cda++){const _0x3816f0=setTimeout(async()=>{const _0x5034c8=_0x416f81;console[_0x5034c8(0xc3)](_0x5034c8(0xe3)+_0x1b0cda+'/'+_0x2451b9+_0x5034c8(0x164)+_0x511349);try{const _0x4f2ad3=await this['checkPaymentStatus'](_0x21140c,_0x34f190);console[_0x5034c8(0xc3)](_0x5034c8(0x167)+_0x1b0cda+_0x5034c8(0x16b),_0x4f2ad3),_0x4f2ad3[_0x5034c8(0x188)]&&(console[_0x5034c8(0xc3)](_0x5034c8(0x11b)+_0x511349+_0x5034c8(0x139)+_0x4f2ad3[_0x5034c8(0x165)]+_0x5034c8(0xbc)),this[_0x5034c8(0xa0)](_0x511349),await this[_0x5034c8(0x15c)](_0x511349,_0x4f2ad3['status'],_0x4f2ad3));}catch(_0x3ad3c8){console[_0x5034c8(0x97)](_0x5034c8(0x155)+_0x1b0cda+_0x5034c8(0xbe)+_0x511349+':',_0x3ad3c8);}},_0x1b0cda*_0x48884b);_0x430f10[_0x416f81(0x13f)](_0x3816f0);}this[_0x416f81(0xfd)][_0x416f81(0xb6)](_0x511349,_0x430f10),console['log'](_0x416f81(0x16d)+_0x2451b9+'\x20status\x20checks\x20for\x20payment\x20'+_0x511349);}[a43_0x5cc7e7(0xa0)](_0x38c9f6){const _0x546755=a43_0x5cc7e7,_0x119453=this[_0x546755(0xfd)][_0x546755(0x147)](_0x38c9f6);_0x119453&&(console[_0x546755(0xc3)](_0x546755(0x126)+_0x119453[_0x546755(0x16c)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x38c9f6),_0x119453[_0x546755(0x16e)]((_0x3248f9,_0x1f31f6)=>{clearTimeout(_0x3248f9);}),this['statusCheckTimers'][_0x546755(0x174)](_0x38c9f6));}async[a43_0x5cc7e7(0x15c)](_0x3710d2,_0x3d3e25,_0x3e40ab){const _0x2e7b0c=a43_0x5cc7e7;try{const _0x35f2c3=(await Promise[_0x2e7b0c(0xb2)]()[_0x2e7b0c(0x124)](()=>__importStar(require(_0x2e7b0c(0x148)))))[_0x2e7b0c(0xcc)],_0x23a592={'status':_0x3d3e25[_0x2e7b0c(0xa1)](),'updatedAt':new Date(),'statusChangedBy':_0x2e7b0c(0x158),'statusChangedAt':new Date()};_0x3d3e25==='PAID'&&(_0x23a592[_0x2e7b0c(0x187)]=new Date()),_0x3e40ab[_0x2e7b0c(0xb8)]&&(_0x23a592[_0x2e7b0c(0x98)]=_0x2e7b0c(0x132)+_0x3e40ab['description']),await _0x35f2c3[_0x2e7b0c(0xff)][_0x2e7b0c(0xa9)]({'where':{'id':_0x3710d2},'data':_0x23a592}),console[_0x2e7b0c(0xc3)](_0x2e7b0c(0x11b)+_0x3710d2+_0x2e7b0c(0x8d)+_0x3d3e25),await this[_0x2e7b0c(0x10d)](_0x3710d2,_0x3d3e25);}catch(_0xe2468c){console[_0x2e7b0c(0x97)](_0x2e7b0c(0x10f)+_0x3710d2+':',_0xe2468c);}}async[a43_0x5cc7e7(0x10d)](_0x4f129e,_0x14867a){const _0x4f0aab=a43_0x5cc7e7;try{const _0x1f422e=(await Promise['resolve']()['then'](()=>__importStar(require(_0x4f0aab(0x148)))))['default'],{telegramBotService:_0x4835ef}=await Promise[_0x4f0aab(0xb2)]()[_0x4f0aab(0x124)](()=>__importStar(require(_0x4f0aab(0x156)))),_0x1418f1=await _0x1f422e[_0x4f0aab(0xff)][_0x4f0aab(0xc8)]({'where':{'id':_0x4f129e},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x1418f1)return;const _0x24b94a={'PAID':'paid','FAILED':_0x4f0aab(0x160)},_0x2ba8df=_0x24b94a[_0x14867a];_0x2ba8df&&await _0x4835ef[_0x4f0aab(0xd2)](_0x1418f1[_0x4f0aab(0x11a)],_0x1418f1,_0x2ba8df),await this[_0x4f0aab(0x180)](_0x1418f1,_0x14867a);}catch(_0x25a9e0){console[_0x4f0aab(0x97)](_0x4f0aab(0x123),_0x25a9e0);}}async[a43_0x5cc7e7(0x180)](_0x19f22a,_0x542bfe){const _0x2fbc2a=a43_0x5cc7e7,_0x108186=Date[_0x2fbc2a(0x166)]();try{const _0x4ca1dd=_0x19f22a[_0x2fbc2a(0x8b)],_0x302936=_0x4ca1dd[_0x2fbc2a(0x120)];if(!_0x302936?.['webhookUrl']){console[_0x2fbc2a(0xc3)](_0x2fbc2a(0x11f)+_0x4ca1dd['id']);return;}const _0xc7088c=_0x542bfe==='PAID'?'payment.success':_0x2fbc2a(0x102);let _0x266dac=[];if(_0x302936[_0x2fbc2a(0xcd)])try{_0x266dac=Array[_0x2fbc2a(0xa4)](_0x302936['webhookEvents'])?_0x302936[_0x2fbc2a(0xcd)]:JSON[_0x2fbc2a(0xdd)](_0x302936[_0x2fbc2a(0xcd)]);}catch(_0x3364dc){console[_0x2fbc2a(0x97)](_0x2fbc2a(0x15f),_0x3364dc),_0x266dac=[];}if(!_0x266dac[_0x2fbc2a(0x131)](_0xc7088c)){console['log'](_0x2fbc2a(0x12c)+_0xc7088c+_0x2fbc2a(0x181)+_0x4ca1dd['id']);return;}const _0x42517e={'event':_0xc7088c,'payment':{'id':_0x19f22a['id'],'order_id':_0x19f22a['orderId'],'gateway_order_id':_0x19f22a[_0x2fbc2a(0x103)],'gateway':_0x2fbc2a(0x105),'amount':_0x19f22a[_0x2fbc2a(0x15e)],'currency':_0x19f22a[_0x2fbc2a(0x169)],'status':_0x542bfe[_0x2fbc2a(0x85)](),'customer_email':_0x19f22a[_0x2fbc2a(0x14a)],'customer_name':_0x19f22a[_0x2fbc2a(0x178)],'created_at':_0x19f22a[_0x2fbc2a(0x118)],'updated_at':new Date()}},_0x251382=await fetch(_0x302936[_0x2fbc2a(0xf4)],{'method':'POST','headers':{'Content-Type':_0x2fbc2a(0x90),'User-Agent':_0x2fbc2a(0x113)},'body':JSON[_0x2fbc2a(0xb3)](_0x42517e)}),_0x339465=Date[_0x2fbc2a(0x166)]()-_0x108186;loggerService_1[_0x2fbc2a(0x8a)][_0x2fbc2a(0x14f)](_0x19f22a[_0x2fbc2a(0x11a)],_0x302936[_0x2fbc2a(0xf4)],_0xc7088c,_0x251382[_0x2fbc2a(0x165)],_0x339465,_0x42517e),console[_0x2fbc2a(0xc3)](_0x2fbc2a(0xd6)+_0x302936[_0x2fbc2a(0xf4)]+_0x2fbc2a(0xc1)+_0x251382[_0x2fbc2a(0x165)]+'\x20('+_0x339465+_0x2fbc2a(0x12d));}catch(_0x2d8853){console[_0x2fbc2a(0x97)](_0x2fbc2a(0xa8),_0x2d8853),loggerService_1['loggerService'][_0x2fbc2a(0x16f)](_0x19f22a[_0x2fbc2a(0x11a)],_0x19f22a['shop']?.[_0x2fbc2a(0x120)]?.['webhookUrl']||_0x2fbc2a(0xa6),_0x2fbc2a(0x175),_0x2d8853,{});}}['maskCardNumber'](_0x17a0ee){const _0x5eeb40=a43_0x5cc7e7,_0x558e2f=_0x17a0ee[_0x5eeb40(0xc7)](/[\s-]/g,'');if(_0x558e2f[_0x5eeb40(0x16c)]<0x4)return'****';return _0x5eeb40(0x106)+_0x558e2f['slice'](-0x4);}async[a43_0x5cc7e7(0x110)](_0x3d9eef){const _0x21d277=a43_0x5cc7e7;console['log'](_0x21d277(0x141),JSON['stringify'](_0x3d9eef,null,0x2));let _0x4ee006='PENDING';if(_0x3d9eef['status']===0x1&&_0x3d9eef[_0x21d277(0x188)]===0x1)_0x4ee006='PAID';else _0x3d9eef['status']===0x0&&_0x3d9eef[_0x21d277(0x188)]===0x0?_0x4ee006=_0x21d277(0x115):_0x4ee006=_0x21d277(0xae);const _0x3a8683=_0x3d9eef[_0x21d277(0x101)]||_0x3d9eef[_0x21d277(0x114)]||_0x3d9eef['payment_id']||_0x3d9eef[_0x21d277(0xfe)]||_0x3d9eef['id']||'';return console['log'](_0x21d277(0x13a)),console[_0x21d277(0xc3)](_0x21d277(0x170)+_0x3a8683+_0x21d277(0xca)+_0x3d9eef['order_id']+',\x20orderId='+_0x3d9eef['orderId']+',\x20payment_id='+_0x3d9eef['payment_id']+_0x21d277(0x14c)+_0x3d9eef[_0x21d277(0xfe)]+_0x21d277(0xd7)+_0x3d9eef['id']+')'),console[_0x21d277(0xc3)](_0x21d277(0x99)+_0x4ee006+'\x20(from:\x20status='+_0x3d9eef[_0x21d277(0x165)]+',\x20final='+_0x3d9eef[_0x21d277(0x188)]+')'),console[_0x21d277(0xc3)]('\x20\x20\x20Amount:\x20'+_0x3d9eef[_0x21d277(0x15e)]),console[_0x21d277(0xc3)](_0x21d277(0x12b)+_0x3d9eef[_0x21d277(0x169)]),{'paymentId':_0x3a8683,'status':_0x4ee006,'amount':_0x3d9eef[_0x21d277(0x15e)],'currency':_0x3d9eef[_0x21d277(0x169)]};}['stopAllStatusChecks'](){const _0x46151f=a43_0x5cc7e7;console['log'](_0x46151f(0x111));const _0x3a63af=this[_0x46151f(0xfd)][_0x46151f(0x189)];for(const [_0x38bf42]of this[_0x46151f(0xfd)]){this[_0x46151f(0xa0)](_0x38bf42);}console[_0x46151f(0xc3)](_0x46151f(0x89)+_0x3a63af+_0x46151f(0x179));}}function a43_0x2f2a(){const _0x57f799=['📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','HTTP\x20error!\x20status:\x20','❌\x20MasterCard\x20key\x20validation\x20failed:','error','adminNotes','\x20\x20\x20Status:\x20','213568XGUDCO','../loggerService','💾\x20Payment\x20data\x20prepared','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','info','generateAESKey','clearStatusTimers','toUpperCase','processCardPayment','Final:','isArray','HTTP\x20','unknown','29614332gGjgmY','Failed\x20to\x20send\x20MasterCard\x20webhook:','update','privateDecrypt','from','\x20\x20\x20-\x20sign\x20length:','logWhiteDomainError','FAILED','aes-256-ctr','last_name','randomBytes','resolve','stringify','none','Decryption\x20failed:\x20','set','\x20\x20\x20-\x20key\x20length:','description','createSign','validateKeyFiles','apiUrl','),\x20stopping\x20status\x20checks','mastercard','\x20failed\x20for\x20payment\x20','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','path','\x20with\x20status\x20','readFileSync','log','constants','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','replace','findUnique','hasOwnProperty','\x20(from:\x20order_id=','33306HNbzbg','default','webhookEvents','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','end','💳\x20MasterCard\x20service\x20initialized','sendPaymentNotification','HTTP\x20Status:','publicKeyPath','✅\x20Status\x20response\x20decrypted\x20successfully','MasterCard\x20webhook\x20sent\x20to\x20',',\x20id=','payment_id','\x20\x20\x20-\x20merchant_point_id:','PHP\x20decryptor\x20error','signRSA','🔐\x20AES\x20IV\x20length:','parse','/charge_decrypt','Result\x20URL:','Status:','876fGNTsl','desc','🔍\x20MasterCard\x20status\x20check\x20#','RSA_PKCS1_PADDING','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','6yXqWdZ','Failed\x20to\x20decrypt\x20response','logWhiteDomainResponse','❌\x20RSA\x20signing\x20failed:','floor','4415243xZJKwz','📝\x20Signature\x20length:','27jxcNtV','sign','encryptRSA','Card\x20Number:','scheduleStatusChecks','-----END','cwd','webhookUrl','TesSoft\x20Payment\x20System/1.0','MasterCard\x20status\x20check\x20error:','join','Card\x20Holder:','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','__importStar','❌\x20PHP\x20decryptor\x20request\x20failed:','🔐\x20RSA\x20signing\x20successful','statusCheckTimers','paymentId','payment','first_name','order_id','payment.failed','gatewayOrderId','-----BEGIN','1111','****\x20****\x20****\x20','1587200VLQzps','/charge_decrypted','/status_raw','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','3ds_url','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','sendPaymentNotifications','decryptResponse','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','processWebhook','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','/charge_raw','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','orderId','PENDING','🔐\x20Public\x20key\x20path:','https://api.paydmeth.com/api','createdAt','psp_public.pem','shopId','✅\x20Payment\x20','defineProperty','__createBinding','merchantPointId','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','settings','/status','PAID','Failed\x20to\x20send\x20payment\x20notifications:','then','3DS\x20URL:','🧹\x20Clearing\x20','/status_decrypted','📝\x20Encrypted\x20data\x20length:','key','POST','\x20\x20\x20Currency:\x20','Webhook\x20event\x20','ms)','🔐\x20AES\x20key\x20and\x20IV\x20generated','cvv','🔐\x20Public\x20key\x20length:\x20','includes','MasterCard:\x20','📝\x20Encrypted\x20key\x20length:','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','❌\x20Data\x20being\x20signed:','encryptAES','476732hQzuBu','Payment\x20ID:','\x20is\x20final\x20(','📊\x20MasterCard\x20webhook\x20extracted\x20data:','decryptResponsePhp','25mTZkVX','utf8','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','push','json','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','__importDefault',',\x20Final:\x20','keys','substring','get','../../config/database',',\x20Desc:\x20','customerEmail','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20',',\x20paymentId=','private.pem','Response\x20Time:','logShopWebhookSent','/status_decrypt','number','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','prototype','❌\x20Status\x20check\x20#','../telegramBotService','✅\x20Payment\x20successful','system','__esModule','text','base64','updatePaymentStatus','createDecipheriv','amount','Error\x20parsing\x20webhook\x20events:','failed','charge','SHA256','📝\x20Data\x20length:','\x20for\x20payment\x20','status','now','📊\x20Status\x20check\x20#','🔐\x20Private\x20key\x20path:','currency','create','\x20result:','length','✅\x20Scheduled\x20','forEach','logShopWebhookError','\x20\x20\x20Payment\x20ID:\x20','configurable','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','\x20\x20\x20-\x20info\x20length:','delete','webhook_send','message','existsSync','customerName','\x20MasterCard\x20status\x20check\x20timers','logWhiteDomainRequest','maskCardNumber','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','❌\x20RSA\x20encryption\x20failed:','\x20\x20\x20-\x20method:\x20charge','🔐\x20Data\x20encrypted\x20with\x20AES','sendShopWebhook','\x20not\x20enabled\x20for\x20shop\x20','Response\x20Body:','expire_month','privateKeyPath','3279qdTlxp','Amount:','paidAt','final','size','toLowerCase','\x20characters','/charge','Private\x20key\x20file\x20not\x20found:\x20','🛑\x20Stopped\x20','loggerService','shop','⏰\x20Will\x20check\x20status\x20','\x20status\x20updated\x20to\x20','...','Unknown\x20error','application/json','MasterCardService','toString','trim'];a43_0x2f2a=function(){return _0x57f799;};return a43_0x2f2a();}function a43_0x596b(_0x4ad856,_0x4c5217){const _0x2f2a5b=a43_0x2f2a();return a43_0x596b=function(_0x596bb0,_0x571acc){_0x596bb0=_0x596bb0-0x85;let _0x2656b3=_0x2f2a5b[_0x596bb0];return _0x2656b3;},a43_0x596b(_0x4ad856,_0x4c5217);}exports['MasterCardService']=MasterCardService;