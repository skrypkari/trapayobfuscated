'use strict';const a60_0x477af2=a60_0xefb7;function a60_0xefb7(_0x4d9bd6,_0x3bd490){_0x4d9bd6=_0x4d9bd6-0x169;const _0x42d5ca=a60_0x42d5();let _0xefb701=_0x42d5ca[_0x4d9bd6];return _0xefb701;}function a60_0x42d5(){const _0x5eb179=['üí≥\x20VISA/MasterCard\x20service\x20initialized','Failed\x20to\x20send\x20MasterCard\x20webhook:','cvv','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','\x20\x20Original:\x20\x22','base64','‚ö†Ô∏è\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format',',\x20payment_id=','none','\x20characters','PAID','/status','\x20\x20\x20-\x20key\x20length:','\x20payment:\x20','üìù\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','publicKeyPath','size','POST','\x20status\x20check\x20#','createdAt','amount','processWebhook','create','__esModule','number','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','decryptAES','/charge_decrypted','psp_public.pem','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','114ICxhUU','writable','The\x20card\x20does\x20not\x20exist','Amount:','__importDefault','üîê\x20VISA\x20Private\x20key\x20path:','‚úÖ\x20VISA\x20key\x20files\x20validated\x20successfully','===\x20API\x20RESPONSE\x20===','üõë\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','MasterCard\x20webhook\x20sent\x20to\x20','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','üìù\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','üîê\x203DS\x20verification\x20required','No\x20Error\x20executing\x20request','4028620mZSedc','slice','/charge_raw','üîê\x20Data\x20encrypted\x20with\x20AES','warn',',\x20paymentId=','../../config/database','üîê\x20AES\x20key\x20and\x20IV\x20generated','\x20(from:\x20order_id=','Payment\x20System/1.0\x20(MasterCard)','‚ö†Ô∏è\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','Insufficient\x20funds\x20on\x20the\x20card','95tmwLHC','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','Decryption\x20failed:\x20','text','HTTP\x20Status:','sendPaymentNotifications','üîÑ\x20Converted\x20postcode\x20to\x20post_code:\x20','end','Client\x20OTP\x20confirmation\x20required','cardType','toLowerCase','Unknown\x20error','PENDING','\x22\x20|\x20\x22','‚ö†Ô∏è\x20Expected\x20VISA\x20public\x20key:\x20','üí≥\x20Unknown\x20card\x20type\x20(starts\x20with\x20','...','Payment\x20System/1.0','656WBYbKz','cwd','Failed\x20to\x20check\x20','üì¶\x20FULL\x20REQUEST\x20JSON:','status','logShopWebhookSent','‚úÖ\x20Payment\x20','\x20\x20\x20-\x20sign\x20length:','Operation\x20completed\x20successfully','üìä\x20Status\x20check\x20#','üîê\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','Another\x20unknown\x20error','5000000000000000','final','sign','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','set','\x20API:\x20','constants','/charge','join','\x20(from:\x20status=','\x20failed\x20for\x20payment\x20','\x20result:','logWhiteDomainResponse','getDetailedErrorMessage','‚ùå\x20PHP\x20decryptor\x20request\x20failed:','logShopWebhookError','https://api.paydmeth.com/api','sendShopWebhook','Error\x20details:','No\x20New\x20payment','-----END','isArray','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','postcode','substring','logWhiteDomainError','defineProperty','now','description','\x20for\x20payment\x20','Status\x20decryption\x20failed:\x20','webhookEvents','\x20\x20\x20-\x20merchant_point_id:','visaMerchantPointId','MASTERCARD','üîê\x20RSA\x20signing\x20successful',',\x20body:\x20','üîê\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','stringify','üîç\x20Using\x20provided\x20card\x20type:\x20','\x20\x20\x20-\x20lang:\x20en','updatePaymentStatus','logWhiteDomainRequest','3ds_url',',\x20final=','visaPrivateKeyPath','/status_raw','‚úÖ\x20MasterCard\x20key\x20files\x20validated\x20successfully','__setModuleDefault','‚ùå\x20Failed\x20to\x20decrypt\x20status\x20response:','decryptResponsePhp','Status:','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','then','expire_year','\x20status\x20updated\x20to\x20','üõë\x20Stopped\x20','\x20\x20\x20-\x20method:\x20charge','randomBytes','customerEmail','default','Payment\x20confirmation\x20required','getCardTypeAndApi','‚ùå\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','FAILED','\x20\x20\x20Payment\x20ID:\x20','Method\x20not\x20allowed','https://api2.trapay.uk/decrypt.php','error','publicEncrypt','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','üîê\x20AES\x20IV\x20length:','Response\x20Headers:','Sender\x27s\x20card\x20details\x20are\x20required','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','7311PvBwob','payment.failed','signRSA','trim','log','\x20status\x20checks\x20for\x20payment\x20','first_name','‚ùå\x20Data\x20being\x20signed:','üîê\x20VISA\x20Public\x20key\x20path:','validateKeyFiles','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','encryptRSA','üîê\x20VISA\x20Public\x20key\x20length:\x20','Failed\x20to\x20send\x20payment\x20notifications:','Cash\x20payment\x20is\x20expected\x20at\x20TCO','json','generateAESKey','316038mYvxAT','Request\x20data\x20error','shop','paymentStatuses','üîç\x20','gatewayOrderId','key',':\x20Unknown\x20status\x20code','65947iHIItQ','Card\x20Holder:','unknown','\x20\x20\x20Status:\x20','includes','üîê\x20VISA\x20Private\x20key\x20length:\x20','üîç\x20Detected\x20card\x20type\x20from\x20webhook:\x20','scheduleStatusChecks','application/json','\x20payment_id\x20for\x20search:\x20','delete','),\x20stopping\x20status\x20checks','resolve','üîç\x20Using\x20','webhook_send','The\x20card\x20is\x20lost\x20or\x20stolen','\x20order_id\x20for\x20search:\x20','getOwnPropertyNames','Recipient\x20data\x20required','\x20not\x20enabled\x20for\x20shop\x20','Payment\x20cancellation\x20is\x20being\x20processed','‚úÖ\x20Scheduled\x20','üìù\x20Decrypted\x20webhook\x20data:','Cancellation\x20is\x20not\x20possible','prototype','parse','failed','‚ö†Ô∏è\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','length','createSign','findUnique','clearStatusTimers','üìù\x20Data\x20length:','üßπ\x20Card\x20holder\x20names\x20cleaned:','message','desc','üìù\x20Data\x20to\x20sign\x20length:','RSA_PKCS1_PADDING','info','webhookUrl','maskCardNumber','‚ö†Ô∏è\x20Expected\x20VISA\x20private\x20key:\x20','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','üîê\x20MasterCard\x20API\x20URL:','3904245CbyfyE','üîê\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','../loggerService','statusCheckTimers','Invalid\x20expiration\x20date','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','Status\x20','shopId','checkPaymentStatus','aes-256-ctr','payment','/status_decrypted','private.pem','****\x20****\x20****\x20','existsSync','update','Response\x20Time:','merchantPointId','Payment\x20prohibited','PHP\x20decryptor\x20error','visa/mastercard','visaPublicKeyPath','\x20is\x20final\x20(','currency','Failed\x20to\x20decrypt\x20response','‚ùå\x20Status\x20check\x20#','privateKeyPath','üìù\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','‚úÖ\x20Status\x20response\x20decrypted\x20successfully','LookUp\x20code\x20verified','utf8','__importStar','order_id','‚ùå\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','masterCardApiUrl','Transaction\x20limit\x20exceeded','üîê\x20MasterCard\x20Private\x20key\x20path:','Order\x20ID:','readFileSync','decryptResponse','path','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','paidAt','\x20\x20\x20Currency:\x20','Status\x20Text:','‚ö†Ô∏è\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','‚ùå\x20Detailed\x20failure\x20description:\x20','charAt','toUpperCase','getOwnPropertyDescriptor','üîê\x20VISA\x20API\x20URL:','\x20\x20Cleaned:\x20\x20\x22','VISA','\x20with\x20status\x20','statusText',',\x20id=','failureMessage','üìä\x20Checking\x20','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','),\x20defaulting\x20to\x20MasterCard','Payment\x20returned','/status_decrypt','forEach','push','keys','3DS\x20verification\x20required','Result\x20URL:','/charge_decrypt','apiUrl','\x20\x20\x20Amount:\x20','Number\x20of\x20attempts\x20exceeded','üéØ\x20Using\x20','üìù\x20Encrypted\x20key\x20length:','Error\x20parsing\x20webhook\x20events:','Payment\x20ID:','üíæ\x20Payment\x20data\x20prepared','orderId','replace','HTTP\x20','charge','‚úÖ\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','HTTP\x20error!\x20status:\x20','hasOwnProperty','masterCardMerchantPointId','‚úÖ\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','payment_id','toString','-----BEGIN',',\x20Final:\x20','üîê\x20Data\x20signed\x20with\x20RSA','isFinalStatus','üìù\x20Signature\x20length:','üìç\x20Full\x20card\x20holder\x20data:','encryptAES','paymentId','LookUp\x20code\x20sent','visaApiUrl','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','Failed\x20payment','Webhook\x20event\x20','388243yUYFlr','VisaMasterCardService','errorMessage','27759910CHPZGZ','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','expire_month','üîê\x20MasterCard\x20Public\x20key\x20path:','****','loggerService','last_name','üìù\x20Encrypted\x20data\x20length:','ms)','\x20status\x20timers\x20for\x20payment\x20','Sender\x27s\x20CVV\x20card\x20is\x20required','‚ùå\x20RSA\x20encryption\x20failed:','üìù\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','card_type','üì¶\x20FULL\x20RESPONSE\x20JSON:','\x20|\x20Response:\x20','Awaiting\x20confirmation\x20by\x20ivr\x20call','LookUp\x20not\x20confirmed','1111','from','üîê\x20AES\x20key\x20length:','üîê\x20Using\x20keys:\x20','‚è∞\x20Scheduling\x20status\x20checks\x20for\x20','\x20payment\x20status:\x20','createCipheriv','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','stopAllStatusChecks'];a60_0x42d5=function(){return _0x5eb179;};return a60_0x42d5();}(function(_0x124a28,_0x586e7d){const _0x312919=a60_0xefb7,_0x5bff9e=_0x124a28();while(!![]){try{const _0x26daba=parseInt(_0x312919(0x183))/0x1+-parseInt(_0x312919(0x1c3))/0x2*(parseInt(_0x312919(0x246))/0x3)+parseInt(_0x312919(0x1d1))/0x4+-parseInt(_0x312919(0x1dd))/0x5*(-parseInt(_0x312919(0x257))/0x6)+-parseInt(_0x312919(0x25f))/0x7*(-parseInt(_0x312919(0x1ef))/0x8)+parseInt(_0x312919(0x28b))/0x9+-parseInt(_0x312919(0x186))/0xa;if(_0x26daba===_0x586e7d)break;else _0x5bff9e['push'](_0x5bff9e['shift']());}catch(_0x26ad90){_0x5bff9e['push'](_0x5bff9e['shift']());}}}(a60_0x42d5,0xa7dfc));var __createBinding=this&&this['__createBinding']||(Object[a60_0x477af2(0x1bb)]?function(_0x352464,_0x1052b5,_0x1e3cdd,_0x17d19d){const _0x3b392a=a60_0x477af2;if(_0x17d19d===undefined)_0x17d19d=_0x1e3cdd;var _0x4e9dee=Object[_0x3b392a(0x2bc)](_0x1052b5,_0x1e3cdd);(!_0x4e9dee||('get'in _0x4e9dee?!_0x1052b5[_0x3b392a(0x1bc)]:_0x4e9dee[_0x3b392a(0x1c4)]||_0x4e9dee['configurable']))&&(_0x4e9dee={'enumerable':!![],'get':function(){return _0x1052b5[_0x1e3cdd];}}),Object[_0x3b392a(0x215)](_0x352464,_0x17d19d,_0x4e9dee);}:function(_0x4d9c6,_0x422eb2,_0x133b80,_0x8156fa){if(_0x8156fa===undefined)_0x8156fa=_0x133b80;_0x4d9c6[_0x8156fa]=_0x422eb2[_0x133b80];}),__setModuleDefault=this&&this[a60_0x477af2(0x22b)]||(Object[a60_0x477af2(0x1bb)]?function(_0x3f50ef,_0x26c6d7){const _0x1d1728=a60_0x477af2;Object[_0x1d1728(0x215)](_0x3f50ef,_0x1d1728(0x237),{'enumerable':!![],'value':_0x26c6d7});}:function(_0x15f1b1,_0x3f6dc2){const _0x5e2456=a60_0x477af2;_0x15f1b1[_0x5e2456(0x237)]=_0x3f6dc2;}),__importStar=this&&this[a60_0x477af2(0x2aa)]||(function(){var _0x4d7066=function(_0x3da611){const _0x4d0d86=a60_0xefb7;return _0x4d7066=Object[_0x4d0d86(0x270)]||function(_0x2744f2){const _0x30bce6=_0x4d0d86;var _0x30d5cc=[];for(var _0x1705b0 in _0x2744f2)if(Object[_0x30bce6(0x277)][_0x30bce6(0x171)]['call'](_0x2744f2,_0x1705b0))_0x30d5cc[_0x30d5cc[_0x30bce6(0x27b)]]=_0x1705b0;return _0x30d5cc;},_0x4d7066(_0x3da611);};return function(_0x246cd8){const _0x5c77d7=a60_0xefb7;if(_0x246cd8&&_0x246cd8[_0x5c77d7(0x1bc)])return _0x246cd8;var _0x3e8a9b={};if(_0x246cd8!=null){for(var _0x35d18b=_0x4d7066(_0x246cd8),_0x524e77=0x0;_0x524e77<_0x35d18b[_0x5c77d7(0x27b)];_0x524e77++)if(_0x35d18b[_0x524e77]!==_0x5c77d7(0x237))__createBinding(_0x3e8a9b,_0x246cd8,_0x35d18b[_0x524e77]);}return __setModuleDefault(_0x3e8a9b,_0x246cd8),_0x3e8a9b;};}()),__importDefault=this&&this[a60_0x477af2(0x1c7)]||function(_0x47344f){return _0x47344f&&_0x47344f['__esModule']?_0x47344f:{'default':_0x47344f};};Object[a60_0x477af2(0x215)](exports,a60_0x477af2(0x1bc),{'value':!![]}),exports[a60_0x477af2(0x184)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a60_0x477af2(0x2b3))),loggerService_1=require(a60_0x477af2(0x28d));class VisaMasterCardService{constructor(){const _0x24eca0=a60_0x477af2;this[_0x24eca0(0x28e)]=new Map(),this[_0x24eca0(0x25a)]={0x0:{'final':![],'description':_0x24eca0(0x20e)},0x1:{'final':![],'description':_0x24eca0(0x1d0)},0x2:{'final':!![],'description':_0x24eca0(0x258)},0x3:{'final':!![],'description':_0x24eca0(0x1fa)},0x4:{'final':!![],'description':'Unsuccessful\x20payment'},0x5:{'final':!![],'description':_0x24eca0(0x245)},0x6:{'final':!![],'description':_0x24eca0(0x2c7)},0x7:{'final':!![],'description':'Test\x20payment'},0x8:{'final':![],'description':_0x24eca0(0x1e5)},0x9:{'final':![],'description':_0x24eca0(0x2cc)},0xa:{'final':![],'description':_0x24eca0(0x193)},0xb:{'final':![],'description':'Sender\x20information\x20required'},0xc:{'final':![],'description':_0x24eca0(0x271)},0xd:{'final':![],'description':_0x24eca0(0x2c5)},0xe:{'final':![],'description':_0x24eca0(0x19a)},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':'Captcha\x20confirmation\x20awaited'},0x11:{'final':![],'description':'Awaiting\x20confirmation\x20of\x20the\x20login\x20password'},0x12:{'final':![],'description':'Awaiting\x20confirmation\x20in\x20the\x20application'},0x13:{'final':![],'description':'Payment\x20is\x20being\x20processed'},0x14:{'final':![],'description':'The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender'},0x15:{'final':![],'description':'Expected\x20bitcoin\x20transfer\x20from\x20client'},0x16:{'final':![],'description':'Payment\x20pending\x20verification'},0x18:{'final':![],'description':_0x24eca0(0x187)},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':_0x24eca0(0x254)},0x1b:{'final':![],'description':_0x24eca0(0x180)},0x1c:{'final':![],'description':'Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application'},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':_0x24eca0(0x289)},0x20:{'final':![],'description':_0x24eca0(0x1cd)},0x23:{'final':![],'description':_0x24eca0(0x244)},0x24:{'final':!![],'description':'Payment\x20confirmation\x20time\x20has\x20expired'},0x25:{'final':!![],'description':_0x24eca0(0x29d)},0x26:{'final':!![],'description':_0x24eca0(0x188)},0x27:{'final':!![],'description':_0x24eca0(0x1dc)},0x28:{'final':!![],'description':_0x24eca0(0x1c5)},0x29:{'final':!![],'description':_0x24eca0(0x26e)},0x2a:{'final':!![],'description':_0x24eca0(0x28f)},0x2b:{'final':!![],'description':_0x24eca0(0x2ae)},0x2c:{'final':!![],'description':_0x24eca0(0x1a3)},0x2d:{'final':!![],'description':_0x24eca0(0x181)},0x2e:{'final':!![],'description':'Unsuccessful\x20payment'},0x2f:{'final':!![],'description':'Unsuccessful\x20payment'},0x30:{'final':!![],'description':_0x24eca0(0x1fe)},0x31:{'final':![],'description':_0x24eca0(0x238)},0x32:{'final':!![],'description':_0x24eca0(0x23d)},0x33:{'final':!![],'description':_0x24eca0(0x181)},0x34:{'final':!![],'description':_0x24eca0(0x181)},0x35:{'final':!![],'description':_0x24eca0(0x181)},0x36:{'final':!![],'description':_0x24eca0(0x181)},0x37:{'final':!![],'description':_0x24eca0(0x181)},0x38:{'final':!![],'description':_0x24eca0(0x276)},0x39:{'final':![],'description':_0x24eca0(0x1c2)},0x3a:{'final':![],'description':_0x24eca0(0x17e)},0x3b:{'final':!![],'description':_0x24eca0(0x2a8)},0x3c:{'final':!![],'description':_0x24eca0(0x2d1)},0x3d:{'final':!![],'description':_0x24eca0(0x189)},0x3e:{'final':!![],'description':_0x24eca0(0x241)},0x3f:{'final':!![],'description':_0x24eca0(0x2c7)},0x40:{'final':![],'description':_0x24eca0(0x19b)},0x41:{'final':!![],'description':'LookUp\x20number\x20of\x20attempts\x20exceeded'},0x42:{'final':![],'description':_0x24eca0(0x273)},0x43:{'final':!![],'description':_0x24eca0(0x196)},0x44:{'final':![],'description':'3DS\x20verification\x20required'},0x45:{'final':!![],'description':_0x24eca0(0x181)},0x46:{'final':!![],'description':_0x24eca0(0x181)},0x47:{'final':!![],'description':_0x24eca0(0x1be)},0x64:{'final':!![],'description':_0x24eca0(0x1f7)}},this[_0x24eca0(0x2ad)]='https://api.myatranz.com/api',this[_0x24eca0(0x172)]=0x50ca,this['privateKeyPath']=path_1[_0x24eca0(0x237)][_0x24eca0(0x203)](process[_0x24eca0(0x1f0)](),_0x24eca0(0x2cb),_0x24eca0(0x297)),this['publicKeyPath']=path_1[_0x24eca0(0x237)]['join'](process['cwd'](),'keys',_0x24eca0(0x1c1)),this[_0x24eca0(0x17f)]=_0x24eca0(0x20b),this[_0x24eca0(0x21c)]=0x6b7,this[_0x24eca0(0x228)]=path_1[_0x24eca0(0x237)][_0x24eca0(0x203)](process[_0x24eca0(0x1f0)](),_0x24eca0(0x2cb),'visa_private.pem'),this[_0x24eca0(0x2a0)]=path_1['default']['join'](process['cwd'](),_0x24eca0(0x2cb),'visa_public.pem'),console[_0x24eca0(0x24a)](_0x24eca0(0x1a5)),console[_0x24eca0(0x24a)](_0x24eca0(0x28a),this[_0x24eca0(0x2ad)]),console[_0x24eca0(0x24a)](_0x24eca0(0x2bd),this[_0x24eca0(0x17f)]),console['log'](_0x24eca0(0x2af),this[_0x24eca0(0x2a5)]),console[_0x24eca0(0x24a)](_0x24eca0(0x18c),this[_0x24eca0(0x1b4)]),console['log'](_0x24eca0(0x1c8),this[_0x24eca0(0x228)]),console[_0x24eca0(0x24a)](_0x24eca0(0x24e),this[_0x24eca0(0x2a0)]),this[_0x24eca0(0x24f)]();}[a60_0x477af2(0x208)](_0x3d0613,_0x36011f){const _0x2fca73=a60_0x477af2,_0x53654b=this[_0x2fca73(0x25a)][_0x3d0613];let _0x21e0db='';_0x53654b?_0x21e0db=_0x2fca73(0x291)+_0x3d0613+':\x20'+_0x53654b[_0x2fca73(0x217)]:_0x21e0db=_0x2fca73(0x291)+_0x3d0613+_0x2fca73(0x25e);if(_0x36011f&&_0x36011f[_0x2fca73(0x249)]()){const _0x2afd8c=_0x36011f['trim']();(!_0x53654b||_0x2afd8c['toLowerCase']()!==_0x53654b[_0x2fca73(0x217)][_0x2fca73(0x1e7)]())&&(_0x21e0db+=_0x2fca73(0x199)+_0x2afd8c);}return _0x21e0db;}[a60_0x477af2(0x179)](_0x12c566){const _0x3754c6=a60_0x477af2,_0xeb08d3=this[_0x3754c6(0x25a)][_0x12c566];return _0xeb08d3?_0xeb08d3[_0x3754c6(0x1fc)]:!![];}[a60_0x477af2(0x239)](_0x7bb6e9){const _0x4e9c30=a60_0x477af2,_0xd928dc=_0x7bb6e9[_0x4e9c30(0x2ba)](0x0);if(_0xd928dc==='4')return console['log']('üí≥\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)'),{'cardType':'VISA','apiUrl':this[_0x4e9c30(0x17f)],'privateKeyPath':this[_0x4e9c30(0x228)],'publicKeyPath':this[_0x4e9c30(0x2a0)],'merchantPointId':this['visaMerchantPointId']};else return _0xd928dc==='5'?(console[_0x4e9c30(0x24a)]('üí≥\x20Detected\x20MasterCard\x20(starts\x20with\x205)'),{'cardType':_0x4e9c30(0x21d),'apiUrl':this[_0x4e9c30(0x2ad)],'privateKeyPath':this[_0x4e9c30(0x2a5)],'publicKeyPath':this[_0x4e9c30(0x1b4)],'merchantPointId':this['masterCardMerchantPointId']}):(console[_0x4e9c30(0x24a)](_0x4e9c30(0x1ec)+_0xd928dc+_0x4e9c30(0x2c6)),{'cardType':_0x4e9c30(0x21d),'apiUrl':this[_0x4e9c30(0x2ad)],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x4e9c30(0x1b4)],'merchantPointId':this[_0x4e9c30(0x172)]});}[a60_0x477af2(0x24f)](){const _0x3213e5=a60_0x477af2;try{if(!fs_1[_0x3213e5(0x237)][_0x3213e5(0x299)](this[_0x3213e5(0x2a5)]))throw new Error(_0x3213e5(0x211)+this[_0x3213e5(0x2a5)]);if(!fs_1['default'][_0x3213e5(0x299)](this[_0x3213e5(0x1b4)]))throw new Error(_0x3213e5(0x250)+this[_0x3213e5(0x1b4)]);const _0x2c1284=fs_1['default'][_0x3213e5(0x2b1)](this['privateKeyPath'],_0x3213e5(0x2a9))['trim'](),_0x4f8def=fs_1['default'][_0x3213e5(0x2b1)](this['publicKeyPath'],_0x3213e5(0x2a9))[_0x3213e5(0x249)]();if(!_0x2c1284[_0x3213e5(0x263)](_0x3213e5(0x176))||!_0x2c1284[_0x3213e5(0x263)](_0x3213e5(0x20f)))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x4f8def[_0x3213e5(0x263)]('-----BEGIN')||!_0x4f8def[_0x3213e5(0x263)]('-----END'))throw new Error(_0x3213e5(0x1a8));console['log'](_0x3213e5(0x22a)),console[_0x3213e5(0x24a)]('üîê\x20MasterCard\x20Private\x20key\x20length:\x20'+_0x2c1284[_0x3213e5(0x27b)]+'\x20characters'),console[_0x3213e5(0x24a)]('üîê\x20MasterCard\x20Public\x20key\x20length:\x20'+_0x4f8def[_0x3213e5(0x27b)]+_0x3213e5(0x1ae));if(fs_1[_0x3213e5(0x237)]['existsSync'](this[_0x3213e5(0x228)])&&fs_1[_0x3213e5(0x237)][_0x3213e5(0x299)](this[_0x3213e5(0x2a0)])){const _0x57531b=fs_1['default']['readFileSync'](this['visaPrivateKeyPath'],'utf8')[_0x3213e5(0x249)](),_0x18098f=fs_1['default'][_0x3213e5(0x2b1)](this[_0x3213e5(0x2a0)],_0x3213e5(0x2a9))[_0x3213e5(0x249)]();(!_0x57531b['includes'](_0x3213e5(0x176))||!_0x57531b[_0x3213e5(0x263)](_0x3213e5(0x20f)))&&console['warn'](_0x3213e5(0x27a)),(!_0x18098f[_0x3213e5(0x263)]('-----BEGIN')||!_0x18098f[_0x3213e5(0x263)](_0x3213e5(0x20f)))&&console[_0x3213e5(0x1d5)](_0x3213e5(0x1ab)),console['log'](_0x3213e5(0x1c9)),console[_0x3213e5(0x24a)](_0x3213e5(0x264)+_0x57531b[_0x3213e5(0x27b)]+_0x3213e5(0x1ae)),console[_0x3213e5(0x24a)](_0x3213e5(0x252)+_0x18098f[_0x3213e5(0x27b)]+'\x20characters');}else console[_0x3213e5(0x1d5)](_0x3213e5(0x1db)),console[_0x3213e5(0x1d5)](_0x3213e5(0x288)+this[_0x3213e5(0x228)]),console[_0x3213e5(0x1d5)](_0x3213e5(0x1eb)+this[_0x3213e5(0x2a0)]);}catch(_0x127d14){console['error']('‚ùå\x20VISA/MasterCard\x20key\x20validation\x20failed:',_0x127d14);throw _0x127d14;}}[a60_0x477af2(0x256)](){const _0x518415=a60_0x477af2,_0x2ea0fe=crypto_1[_0x518415(0x237)][_0x518415(0x235)](0x20),_0x4250fb=crypto_1[_0x518415(0x237)][_0x518415(0x235)](0x10);return{'key':_0x2ea0fe,'iv':_0x4250fb};}[a60_0x477af2(0x17c)](_0x112c84,_0x14983b,_0x5b326a){const _0x6d2d4b=a60_0x477af2,_0x43bdd3=crypto_1[_0x6d2d4b(0x237)][_0x6d2d4b(0x1a2)](_0x6d2d4b(0x294),_0x14983b,_0x5b326a);let _0x33b762=_0x43bdd3[_0x6d2d4b(0x29a)](_0x112c84,'utf8','base64');return _0x33b762+=_0x43bdd3[_0x6d2d4b(0x1fc)](_0x6d2d4b(0x1aa)),_0x33b762;}['encryptRSA'](_0xae3727,_0x1148d0,_0x5a650d){const _0x232e04=a60_0x477af2;try{const _0x115f3b=fs_1['default'][_0x232e04(0x2b1)](_0x5a650d,_0x232e04(0x2a9))[_0x232e04(0x249)](),_0x2e8b25={'iv':_0x1148d0[_0x232e04(0x175)]('base64'),'key':_0xae3727['toString'](_0x232e04(0x1aa))},_0x5e70c4=JSON[_0x232e04(0x221)](_0x2e8b25);console['log'](_0x232e04(0x1f9),_0x5e70c4[_0x232e04(0x27b)]);const _0x3dbd89=crypto_1[_0x232e04(0x237)][_0x232e04(0x240)]({'key':_0x115f3b,'padding':crypto_1[_0x232e04(0x237)][_0x232e04(0x201)][_0x232e04(0x284)]},Buffer['from'](_0x5e70c4));return console['log'](_0x232e04(0x16f),_0x3dbd89[_0x232e04(0x27b)]),_0x3dbd89[_0x232e04(0x175)](_0x232e04(0x1aa));}catch(_0x2178ad){console['error'](_0x232e04(0x194),_0x2178ad);throw new Error(_0x232e04(0x18a));}}[a60_0x477af2(0x248)](_0x4f285a,_0x26bdf8){const _0x4c5a6d=a60_0x477af2;try{const _0x1742b2=fs_1['default'][_0x4c5a6d(0x2b1)](_0x26bdf8,_0x4c5a6d(0x2a9))[_0x4c5a6d(0x249)](),_0x374d88=crypto_1[_0x4c5a6d(0x237)][_0x4c5a6d(0x27c)]('SHA256');_0x374d88[_0x4c5a6d(0x29a)](_0x4f285a),_0x374d88[_0x4c5a6d(0x1e4)]();const _0x469004=_0x374d88[_0x4c5a6d(0x1fd)](_0x1742b2,_0x4c5a6d(0x1aa));return console[_0x4c5a6d(0x24a)](_0x4c5a6d(0x21e)),console['log'](_0x4c5a6d(0x283),_0x4f285a[_0x4c5a6d(0x27b)]),console[_0x4c5a6d(0x24a)](_0x4c5a6d(0x17a),_0x469004[_0x4c5a6d(0x27b)]),_0x469004;}catch(_0x314f22){console[_0x4c5a6d(0x23f)]('‚ùå\x20RSA\x20signing\x20failed:',_0x314f22),console['error'](_0x4c5a6d(0x24d),_0x4f285a[_0x4c5a6d(0x213)](0x0,0xc8)+_0x4c5a6d(0x1ed));throw new Error(_0x4c5a6d(0x2b4));}}[a60_0x477af2(0x1bf)](_0x1d12cd,_0x40f962,_0x4d076c){const _0x33161c=a60_0x477af2,_0x4bc22b=crypto_1[_0x33161c(0x237)]['createDecipheriv']('aes-256-ctr',_0x40f962,_0x4d076c);let _0x52e790=_0x4bc22b[_0x33161c(0x29a)](_0x1d12cd,'base64',_0x33161c(0x2a9));return _0x52e790+=_0x4bc22b['final'](_0x33161c(0x2a9)),_0x52e790;}async[a60_0x477af2(0x22d)](_0x4dcd17,_0x4a75f4,_0x29c5d1=a60_0x477af2(0x21d)){const _0x16be46=a60_0x477af2;try{const _0x5b5276=await fetch(_0x16be46(0x23e),{'method':'POST','headers':{'Content-Type':'application/json'},'body':JSON[_0x16be46(0x221)]({'info':_0x4dcd17,'key':_0x4a75f4,'card_type':_0x29c5d1[_0x16be46(0x1e7)]()})});if(!_0x5b5276['ok'])throw new Error(_0x16be46(0x29e));return await _0x5b5276['text']();}catch(_0x53fdd5){console[_0x16be46(0x23f)](_0x16be46(0x209),_0x53fdd5);throw new Error(_0x16be46(0x1de));}}[a60_0x477af2(0x2b2)](_0x2028b4,_0x2dd0fd){const _0x50fbf1=a60_0x477af2;try{const _0x56abac=fs_1[_0x50fbf1(0x237)][_0x50fbf1(0x2b1)](this['privateKeyPath'],_0x50fbf1(0x2a9))[_0x50fbf1(0x249)](),_0x3da8e9=crypto_1[_0x50fbf1(0x237)]['privateDecrypt'](_0x56abac,Buffer[_0x50fbf1(0x19d)](_0x2dd0fd,_0x50fbf1(0x1aa))),_0xca260d=JSON[_0x50fbf1(0x278)](_0x3da8e9['toString']()),_0x1f6947=Buffer['from'](_0xca260d['key'],_0x50fbf1(0x1aa)),_0xf77f88=Buffer[_0x50fbf1(0x19d)](_0xca260d['iv'],_0x50fbf1(0x1aa));return this['decryptAES'](_0x2028b4,_0x1f6947,_0xf77f88);}catch(_0x2abd91){throw new Error(_0x50fbf1(0x2a3));}}async['processCardPayment'](_0x3c10fb){const _0x49f0c4=a60_0x477af2,{paymentId:_0x235521,orderId:_0x5ab1ff,amount:_0x29a5da,currency:_0x2a3bbb,cardData:_0x223cb5,resultUrl:_0x5ef409,returnUrl:_0x26d210,cardHolder:_0x28bd75,browser:_0x3f84cb}=_0x3c10fb;console[_0x49f0c4(0x24a)](_0x49f0c4(0x22f)),console[_0x49f0c4(0x24a)](_0x49f0c4(0x169),_0x235521),console[_0x49f0c4(0x24a)](_0x49f0c4(0x2b0),_0x5ab1ff),console[_0x49f0c4(0x24a)](_0x49f0c4(0x1c6),_0x29a5da,_0x2a3bbb),console[_0x49f0c4(0x24a)]('Card\x20Number:',this[_0x49f0c4(0x287)](_0x223cb5[_0x49f0c4(0x1bd)])),console['log'](_0x49f0c4(0x260),_0x28bd75[_0x49f0c4(0x24c)]+'\x20'+_0x28bd75[_0x49f0c4(0x18f)]),console[_0x49f0c4(0x24a)]('Return\x20URL:',_0x26d210),console[_0x49f0c4(0x24a)](_0x49f0c4(0x2cd),_0x5ef409);const _0x3e338d=this[_0x49f0c4(0x239)](_0x223cb5[_0x49f0c4(0x1bd)]);console[_0x49f0c4(0x24a)](_0x49f0c4(0x2d2)+_0x3e338d[_0x49f0c4(0x1e6)]+_0x49f0c4(0x200)+_0x3e338d[_0x49f0c4(0x2cf)]),console[_0x49f0c4(0x24a)](_0x49f0c4(0x19f)+_0x3e338d[_0x49f0c4(0x2a5)]+',\x20'+_0x3e338d[_0x49f0c4(0x1b4)]);const _0x498359={..._0x28bd75,'first_name':_0x28bd75[_0x49f0c4(0x24c)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x49f0c4(0x249)]()||'','last_name':_0x28bd75['last_name']?.[_0x49f0c4(0x16c)](/[\t\n\r\f\v]/g,'\x20')[_0x49f0c4(0x249)]()||''};'postcode'in _0x498359&&!('post_code'in _0x498359)&&(_0x498359['post_code']=_0x498359[_0x49f0c4(0x212)],delete _0x498359[_0x49f0c4(0x212)],console[_0x49f0c4(0x24a)](_0x49f0c4(0x1e3)+_0x498359['post_code']));console[_0x49f0c4(0x24a)](_0x49f0c4(0x280)),console[_0x49f0c4(0x24a)](_0x49f0c4(0x1a9)+_0x28bd75[_0x49f0c4(0x24c)]+_0x49f0c4(0x1ea)+_0x28bd75[_0x49f0c4(0x18f)]+'\x22'),console['log'](_0x49f0c4(0x2be)+_0x498359[_0x49f0c4(0x24c)]+_0x49f0c4(0x1ea)+_0x498359['last_name']+'\x22'),console['log'](_0x49f0c4(0x17b),JSON['stringify'](_0x498359,null,0x2));const _0x4c45a8={'amount':_0x29a5da,'currency':_0x2a3bbb[_0x49f0c4(0x2bb)](),'order_id':_0x5ab1ff,'result_url':_0x5ef409,'return_url':_0x26d210,'country':'','card':{'number':_0x223cb5['number'],'expire_month':_0x223cb5[_0x49f0c4(0x18b)],'expire_year':_0x223cb5[_0x49f0c4(0x231)],'cvv':_0x223cb5[_0x49f0c4(0x1a7)]},'card_holder':_0x498359,'browser':_0x3f84cb},_0x1d1a3c=JSON[_0x49f0c4(0x221)](_0x4c45a8);console['log'](_0x49f0c4(0x16a)),console[_0x49f0c4(0x24a)](_0x49f0c4(0x1b3)),console['log'](_0x1d1a3c),console['log'](_0x49f0c4(0x27f),_0x1d1a3c[_0x49f0c4(0x27b)]);try{const {key:_0x553e65,iv:_0xdd507}=this['generateAESKey']();console[_0x49f0c4(0x24a)](_0x49f0c4(0x1d8)),console['log'](_0x49f0c4(0x19e),_0x553e65[_0x49f0c4(0x27b)]),console[_0x49f0c4(0x24a)](_0x49f0c4(0x242),_0xdd507[_0x49f0c4(0x27b)]);const _0x5bcaf3=this[_0x49f0c4(0x17c)](_0x1d1a3c,_0x553e65,_0xdd507);console[_0x49f0c4(0x24a)](_0x49f0c4(0x1d4)),console['log'](_0x49f0c4(0x190),_0x5bcaf3[_0x49f0c4(0x27b)]);const _0x1d200d=this[_0x49f0c4(0x251)](_0x553e65,_0xdd507,_0x3e338d[_0x49f0c4(0x1b4)]);console[_0x49f0c4(0x24a)]('üîê\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console['log'](_0x49f0c4(0x2d3),_0x1d200d[_0x49f0c4(0x27b)]);const _0x7a2b28=this[_0x49f0c4(0x248)](_0x1d1a3c,_0x3e338d['privateKeyPath']);console[_0x49f0c4(0x24a)](_0x49f0c4(0x178)),console[_0x49f0c4(0x24a)]('üìù\x20Signature\x20length:',_0x7a2b28[_0x49f0c4(0x27b)]);const _0x5244ab={'merchant_point_id':_0x3e338d[_0x49f0c4(0x29c)],'method':_0x49f0c4(0x16e),'info':_0x5bcaf3,'key':_0x1d200d,'sign':_0x7a2b28,'lang':'en'};console[_0x49f0c4(0x24a)]('üì§\x20Sending\x20request\x20to\x20API...'),console[_0x49f0c4(0x24a)]('üìù\x20Final\x20request\x20structure:'),console[_0x49f0c4(0x24a)](_0x49f0c4(0x21b),_0x3e338d[_0x49f0c4(0x29c)]),console[_0x49f0c4(0x24a)](_0x49f0c4(0x234)),console['log']('\x20\x20\x20-\x20info\x20length:',_0x5bcaf3[_0x49f0c4(0x27b)]),console[_0x49f0c4(0x24a)](_0x49f0c4(0x1b1),_0x1d200d[_0x49f0c4(0x27b)]),console[_0x49f0c4(0x24a)](_0x49f0c4(0x1f6),_0x7a2b28[_0x49f0c4(0x27b)]),console[_0x49f0c4(0x24a)](_0x49f0c4(0x223)),console[_0x49f0c4(0x24a)](''),console['log'](_0x49f0c4(0x1f2)),console[_0x49f0c4(0x24a)](JSON[_0x49f0c4(0x221)](_0x5244ab,null,0x2)),console[_0x49f0c4(0x24a)](''),loggerService_1[_0x49f0c4(0x18e)][_0x49f0c4(0x225)](_0x3e338d['cardType'][_0x49f0c4(0x1e7)](),'/charge',_0x49f0c4(0x1b6),{'merchant_point_id':_0x3e338d[_0x49f0c4(0x29c)],'method':'charge','lang':'en'});const _0x457fbc=Date[_0x49f0c4(0x216)](),_0x35005f=await fetch(_0x3e338d['apiUrl'],{'method':_0x49f0c4(0x1b6),'headers':{'Content-Type':'application/json','Accept':_0x49f0c4(0x267),'User-Agent':_0x49f0c4(0x1ee)},'body':JSON['stringify'](_0x5244ab)}),_0x1f9e19=Date['now']()-_0x457fbc;console['log'](_0x49f0c4(0x1ca)),console[_0x49f0c4(0x24a)](_0x49f0c4(0x22e),_0x35005f['status']),console[_0x49f0c4(0x24a)](_0x49f0c4(0x2b7),_0x35005f[_0x49f0c4(0x2c1)]),console[_0x49f0c4(0x24a)](_0x49f0c4(0x29b),_0x1f9e19+'ms'),console[_0x49f0c4(0x24a)](_0x49f0c4(0x243)),_0x35005f['headers']['forEach']((_0x409c91,_0x440cea)=>{const _0x24f35d=_0x49f0c4;console[_0x24f35d(0x24a)]('\x20\x20\x20'+_0x440cea+':\x20'+_0x409c91);}),console[_0x49f0c4(0x24a)]('');if(!_0x35005f['ok']){const _0x12c192=await _0x35005f[_0x49f0c4(0x1e0)]();console[_0x49f0c4(0x23f)](_0x49f0c4(0x1e1),_0x35005f[_0x49f0c4(0x1f3)]),console[_0x49f0c4(0x23f)]('üì¶\x20FULL\x20RESPONSE\x20BODY:'),console[_0x49f0c4(0x23f)](_0x12c192),console[_0x49f0c4(0x23f)](''),loggerService_1['loggerService'][_0x49f0c4(0x207)](_0x3e338d[_0x49f0c4(0x1e6)][_0x49f0c4(0x1e7)](),'/charge_raw',_0x35005f['status'],_0x12c192,_0x1f9e19),loggerService_1[_0x49f0c4(0x18e)][_0x49f0c4(0x214)](_0x3e338d[_0x49f0c4(0x1e6)][_0x49f0c4(0x1e7)](),'/charge',_0x49f0c4(0x16d)+_0x35005f[_0x49f0c4(0x1f3)]+':\x20'+_0x12c192);throw new Error(_0x49f0c4(0x170)+_0x35005f[_0x49f0c4(0x1f3)]+_0x49f0c4(0x21f)+_0x12c192);}const _0x339089=await _0x35005f[_0x49f0c4(0x255)]();console[_0x49f0c4(0x24a)](_0x49f0c4(0x198)),console[_0x49f0c4(0x24a)](JSON[_0x49f0c4(0x221)](_0x339089,null,0x2)),console[_0x49f0c4(0x24a)](''),loggerService_1[_0x49f0c4(0x18e)][_0x49f0c4(0x207)](_0x3e338d[_0x49f0c4(0x1e6)][_0x49f0c4(0x1e7)](),_0x49f0c4(0x1d3),_0x35005f[_0x49f0c4(0x1f3)],_0x339089,_0x1f9e19),console[_0x49f0c4(0x24a)]('===\x20PARSED\x20API\x20RESPONSE\x20===');let _0x3ec581=_0x339089;if(_0x339089[_0x49f0c4(0x285)]&&_0x339089[_0x49f0c4(0x25d)]&&_0x339089[_0x49f0c4(0x1fd)]){console[_0x49f0c4(0x24a)]('üîê\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x2289db=await this[_0x49f0c4(0x22d)](_0x339089[_0x49f0c4(0x285)],_0x339089['key'],_0x3e338d[_0x49f0c4(0x1e6)]);_0x3ec581=JSON[_0x49f0c4(0x278)](_0x2289db),console[_0x49f0c4(0x24a)](_0x49f0c4(0x173)),loggerService_1[_0x49f0c4(0x18e)]['logWhiteDomainResponse'](_0x3e338d['cardType'][_0x49f0c4(0x1e7)](),_0x49f0c4(0x1c0),_0x35005f[_0x49f0c4(0x1f3)],_0x3ec581,_0x1f9e19),console['log'](_0x49f0c4(0x195));}catch(_0x4bf452){console[_0x49f0c4(0x23f)]('‚ùå\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x4bf452),loggerService_1['loggerService']['logWhiteDomainError'](_0x3e338d[_0x49f0c4(0x1e6)][_0x49f0c4(0x1e7)](),_0x49f0c4(0x2ce),_0x49f0c4(0x1df)+_0x4bf452),_0x3ec581=_0x339089;}}else loggerService_1[_0x49f0c4(0x18e)][_0x49f0c4(0x207)](_0x3e338d[_0x49f0c4(0x1e6)][_0x49f0c4(0x1e7)](),_0x49f0c4(0x1c0),_0x35005f[_0x49f0c4(0x1f3)],_0x3ec581,_0x1f9e19),console[_0x49f0c4(0x24a)](_0x49f0c4(0x1ce));console[_0x49f0c4(0x24a)](_0x49f0c4(0x22e),_0x3ec581[_0x49f0c4(0x1f3)]),console[_0x49f0c4(0x24a)]('Final:',_0x3ec581[_0x49f0c4(0x1fc)]),console[_0x49f0c4(0x24a)](_0x49f0c4(0x169),_0x3ec581[_0x49f0c4(0x174)]),console['log']('3DS\x20URL:',_0x3ec581[_0x49f0c4(0x226)]||_0x49f0c4(0x1ad));if(_0x3ec581[_0x49f0c4(0x1f3)]===0x64&&_0x3ec581[_0x49f0c4(0x1fc)]===0x1)return console[_0x49f0c4(0x24a)]('‚úÖ\x20Payment\x20successful'),{'gateway_payment_id':_0x3ec581['payment_id']?.[_0x49f0c4(0x175)](),'payment_url':_0x26d210,'requires_3ds':![],'status':_0x49f0c4(0x1af),'final':!![]};if(_0x3ec581[_0x49f0c4(0x226)])return console[_0x49f0c4(0x24a)](_0x49f0c4(0x1cf)),this[_0x49f0c4(0x266)](_0x235521,_0x5ab1ff,_0x3ec581[_0x49f0c4(0x174)]?.[_0x49f0c4(0x175)]()||_0x5ab1ff,_0x3e338d[_0x49f0c4(0x1e6)]),{'gateway_payment_id':_0x3ec581['payment_id']?.[_0x49f0c4(0x175)](),'payment_url':_0x3ec581[_0x49f0c4(0x226)],'requires_3ds':!![],'threeds_url':_0x3ec581[_0x49f0c4(0x226)],'status':_0x49f0c4(0x1e9),'final':![]};let _0x2a1e58=this[_0x49f0c4(0x208)](_0x3ec581[_0x49f0c4(0x1f3)],_0x3ec581[_0x49f0c4(0x282)]||_0x3ec581[_0x49f0c4(0x281)]),_0x34172a=_0x3ec581[_0x49f0c4(0x1f3)],_0x376079=this[_0x49f0c4(0x179)](_0x3ec581['status']);return console[_0x49f0c4(0x24a)](_0x49f0c4(0x23a)+_0x34172a+_0x49f0c4(0x177)+_0x376079+',\x20Desc:\x20'+_0x2a1e58),{'gateway_payment_id':_0x3ec581[_0x49f0c4(0x174)]?.[_0x49f0c4(0x175)](),'payment_url':_0x26d210,'requires_3ds':![],'status':_0x49f0c4(0x23b),'final':!![],'errorMessage':_0x2a1e58};}catch(_0x2d25e1){console[_0x49f0c4(0x23f)]('===\x20PAYMENT\x20SERVICE\x20ERROR\x20==='),console[_0x49f0c4(0x23f)](_0x49f0c4(0x20d),_0x2d25e1),loggerService_1[_0x49f0c4(0x18e)][_0x49f0c4(0x214)](_0x49f0c4(0x29f),_0x49f0c4(0x202),_0x2d25e1);throw new Error(_0x49f0c4(0x290)+(_0x2d25e1 instanceof Error?_0x2d25e1[_0x49f0c4(0x281)]:_0x49f0c4(0x1e8)));}}async[a60_0x477af2(0x293)](_0x524063,_0x39f553,_0x15ac67='VISA'){const _0x522d7e=a60_0x477af2;console[_0x522d7e(0x24a)](_0x522d7e(0x2c4)+_0x15ac67+_0x522d7e(0x1a1)+_0x524063+'\x20('+_0x39f553+')');try{const _0x442d2f={'payment_id':_0x524063,'order_id':_0x39f553},_0x31f988=JSON[_0x522d7e(0x221)](_0x442d2f),_0x45f466=this[_0x522d7e(0x239)](_0x15ac67==='VISA'?'4000000000000000':_0x522d7e(0x1fb)),{key:_0x158eb5,iv:_0xd7ebe4}=this[_0x522d7e(0x256)](),_0x48b545=this['encryptAES'](_0x31f988,_0x158eb5,_0xd7ebe4),_0x32460a=this[_0x522d7e(0x251)](_0x158eb5,_0xd7ebe4,_0x45f466['publicKeyPath']),_0x425f7b=this[_0x522d7e(0x248)](_0x31f988,_0x45f466[_0x522d7e(0x2a5)]),_0x4e5676={'merchant_point_id':_0x45f466[_0x522d7e(0x29c)],'method':'status','info':_0x48b545,'key':_0x32460a,'sign':_0x425f7b,'lang':'en'};loggerService_1[_0x522d7e(0x18e)][_0x522d7e(0x225)](_0x15ac67['toLowerCase'](),_0x522d7e(0x1b0),_0x522d7e(0x1b6),{'merchant_point_id':_0x45f466[_0x522d7e(0x29c)],'method':_0x522d7e(0x1f3),'lang':'en'});const _0x4f32e7=Date[_0x522d7e(0x216)](),_0x4b6e2f=await fetch(_0x45f466[_0x522d7e(0x2cf)],{'method':_0x522d7e(0x1b6),'headers':{'Content-Type':_0x522d7e(0x267),'Accept':_0x522d7e(0x267),'User-Agent':_0x522d7e(0x1ee)},'body':JSON[_0x522d7e(0x221)](_0x4e5676)}),_0x1aa62a=Date['now']()-_0x4f32e7;if(!_0x4b6e2f['ok']){const _0x111fd5=await _0x4b6e2f[_0x522d7e(0x1e0)]();loggerService_1[_0x522d7e(0x18e)][_0x522d7e(0x207)](_0x15ac67[_0x522d7e(0x1e7)](),'/status_raw',_0x4b6e2f[_0x522d7e(0x1f3)],_0x111fd5,_0x1aa62a);throw new Error(_0x522d7e(0x170)+_0x4b6e2f[_0x522d7e(0x1f3)]);}const _0xeb1832=await _0x4b6e2f[_0x522d7e(0x255)]();loggerService_1[_0x522d7e(0x18e)]['logWhiteDomainResponse'](_0x15ac67[_0x522d7e(0x1e7)](),_0x522d7e(0x229),_0x4b6e2f[_0x522d7e(0x1f3)],_0xeb1832,_0x1aa62a);let _0x4602ce=_0xeb1832;if(_0xeb1832[_0x522d7e(0x285)]&&_0xeb1832['key']&&_0xeb1832[_0x522d7e(0x1fd)]){console['log'](_0x522d7e(0x220));try{const _0x268697=await this[_0x522d7e(0x22d)](_0xeb1832[_0x522d7e(0x285)],_0xeb1832['key'],_0x15ac67);_0x4602ce=JSON[_0x522d7e(0x278)](_0x268697),console[_0x522d7e(0x24a)](_0x522d7e(0x2a7)),loggerService_1[_0x522d7e(0x18e)][_0x522d7e(0x207)](_0x15ac67[_0x522d7e(0x1e7)](),_0x522d7e(0x296),_0x4b6e2f[_0x522d7e(0x1f3)],_0x4602ce,_0x1aa62a),console['log'](_0x522d7e(0x2a6));}catch(_0x34c1f1){console[_0x522d7e(0x23f)](_0x522d7e(0x22c),_0x34c1f1),loggerService_1[_0x522d7e(0x18e)]['logWhiteDomainError'](_0x15ac67[_0x522d7e(0x1e7)](),_0x522d7e(0x2c8),_0x522d7e(0x219)+_0x34c1f1),_0x4602ce=_0xeb1832;}}else loggerService_1[_0x522d7e(0x18e)][_0x522d7e(0x207)](_0x15ac67[_0x522d7e(0x1e7)](),_0x522d7e(0x296),_0x4b6e2f[_0x522d7e(0x1f3)],_0x4602ce,_0x1aa62a),console[_0x522d7e(0x24a)]('üìù\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x522d7e(0x24a)]('üìä\x20Status\x20check\x20result:',{'status':_0x4602ce[_0x522d7e(0x1f3)],'final':_0x4602ce['final'],'payment_id':_0x4602ce[_0x522d7e(0x174)],'desc':_0x4602ce[_0x522d7e(0x282)]});let _0xd5db79='PENDING';if(_0x4602ce[_0x522d7e(0x1f3)]===0x64&&_0x4602ce[_0x522d7e(0x1fc)]===0x1)_0xd5db79=_0x522d7e(0x1af);else{if(_0x4602ce[_0x522d7e(0x1fc)]===0x0||!this['isFinalStatus'](_0x4602ce['status']))_0xd5db79=_0x522d7e(0x1e9);else _0x4602ce[_0x522d7e(0x1fc)]===0x1||this[_0x522d7e(0x179)](_0x4602ce[_0x522d7e(0x1f3)])?_0xd5db79=_0x522d7e(0x23b):_0xd5db79=_0x522d7e(0x1e9);}const _0x47efa9=this[_0x522d7e(0x208)](_0x4602ce['status'],_0x4602ce[_0x522d7e(0x282)]);return{'status':_0xd5db79,'final':this[_0x522d7e(0x179)](_0x4602ce[_0x522d7e(0x1f3)]),'amount':_0x4602ce[_0x522d7e(0x1b9)],'currency':_0x4602ce[_0x522d7e(0x2a2)],'date_success':_0x4602ce['date_success'],'description':_0x47efa9};}catch(_0x579a4f){console[_0x522d7e(0x23f)](_0x15ac67+'\x20status\x20check\x20error:',_0x579a4f),loggerService_1['loggerService'][_0x522d7e(0x214)](_0x15ac67[_0x522d7e(0x1e7)](),_0x522d7e(0x1b0),_0x579a4f);throw new Error(_0x522d7e(0x1f1)+_0x15ac67+_0x522d7e(0x1a1)+(_0x579a4f instanceof Error?_0x579a4f[_0x522d7e(0x281)]:_0x522d7e(0x1e8)));}}[a60_0x477af2(0x266)](_0x320ccc,_0x719ff2,_0x1dcf0b,_0x407629){const _0x175020=a60_0x477af2;console[_0x175020(0x24a)](_0x175020(0x1a0)+_0x407629+_0x175020(0x1b2)+_0x320ccc+'\x20('+_0x1dcf0b+')'),this['clearStatusTimers'](_0x320ccc);const _0x5cc71c=[],_0x78abd4=0x5*0x3c*0x3e8,_0x1aa442=0x2*0x3c*0x3c*0x3e8,_0x424f8f=Math['floor'](_0x1aa442/_0x78abd4);console['log']('‚è∞\x20Will\x20check\x20status\x20'+_0x424f8f+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x928682=0x1;_0x928682<=_0x424f8f;_0x928682++){const _0x1922cd=setTimeout(async()=>{const _0xe44343=_0x175020;console['log'](_0xe44343(0x25b)+_0x407629+_0xe44343(0x1b7)+_0x928682+'/'+_0x424f8f+_0xe44343(0x218)+_0x320ccc);try{const _0x22d2d1=await this[_0xe44343(0x293)](_0x1dcf0b,_0x719ff2,_0x407629);console[_0xe44343(0x24a)](_0xe44343(0x1f8)+_0x928682+_0xe44343(0x206),_0x22d2d1),_0x22d2d1[_0xe44343(0x1fc)]&&(console[_0xe44343(0x24a)](_0xe44343(0x1f5)+_0x320ccc+_0xe44343(0x2a1)+_0x22d2d1[_0xe44343(0x1f3)]+_0xe44343(0x26a)),this[_0xe44343(0x27e)](_0x320ccc),await this[_0xe44343(0x224)](_0x320ccc,_0x22d2d1['status'],_0x22d2d1));}catch(_0x21b7c4){console[_0xe44343(0x23f)](_0xe44343(0x2a4)+_0x928682+_0xe44343(0x205)+_0x320ccc+':',_0x21b7c4);}},_0x928682*_0x78abd4);_0x5cc71c[_0x175020(0x2ca)](_0x1922cd);}this[_0x175020(0x28e)][_0x175020(0x1ff)](_0x320ccc,_0x5cc71c),console[_0x175020(0x24a)](_0x175020(0x274)+_0x424f8f+_0x175020(0x24b)+_0x320ccc);}[a60_0x477af2(0x27e)](_0x3bdc14){const _0x5761f3=a60_0x477af2,_0x1ceef4=this['statusCheckTimers']['get'](_0x3bdc14);_0x1ceef4&&(console[_0x5761f3(0x24a)]('üßπ\x20Clearing\x20'+_0x1ceef4[_0x5761f3(0x27b)]+_0x5761f3(0x192)+_0x3bdc14),_0x1ceef4[_0x5761f3(0x2c9)]((_0x12e723,_0x44b6b5)=>{clearTimeout(_0x12e723);}),this['statusCheckTimers'][_0x5761f3(0x269)](_0x3bdc14));}async[a60_0x477af2(0x224)](_0x44f680,_0x497a1e,_0x521b92){const _0x423159=a60_0x477af2;try{const _0x164733=(await Promise[_0x423159(0x26b)]()['then'](()=>__importStar(require(_0x423159(0x1d7)))))[_0x423159(0x237)],_0x1fe408={'status':_0x497a1e[_0x423159(0x2bb)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x497a1e===_0x423159(0x1af)&&(_0x1fe408[_0x423159(0x2b5)]=new Date()),_0x497a1e==='FAILED'&&_0x521b92[_0x423159(0x217)]&&(_0x1fe408[_0x423159(0x2c3)]=_0x521b92[_0x423159(0x217)],console[_0x423159(0x24a)]('üíæ\x20Saving\x20failure\x20message:\x20'+_0x521b92[_0x423159(0x217)])),await _0x164733[_0x423159(0x295)]['update']({'where':{'id':_0x44f680},'data':_0x1fe408}),console[_0x423159(0x24a)]('‚úÖ\x20Payment\x20'+_0x44f680+_0x423159(0x232)+_0x497a1e),await this[_0x423159(0x1e2)](_0x44f680,_0x497a1e);}catch(_0x471467){console[_0x423159(0x23f)]('‚ùå\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x44f680+':',_0x471467);}}async[a60_0x477af2(0x1e2)](_0x263baf,_0x28f525){const _0x36ac1f=a60_0x477af2;try{const _0x285bd9=(await Promise['resolve']()[_0x36ac1f(0x230)](()=>__importStar(require(_0x36ac1f(0x1d7)))))[_0x36ac1f(0x237)],{telegramBotService:_0x4715}=await Promise[_0x36ac1f(0x26b)]()[_0x36ac1f(0x230)](()=>__importStar(require('../telegramBotService'))),_0x18fc39=await _0x285bd9['payment'][_0x36ac1f(0x27d)]({'where':{'id':_0x263baf},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x18fc39)return;const _0x41cc9a={'PAID':'paid','FAILED':_0x36ac1f(0x279)},_0x13f1e1=_0x41cc9a[_0x28f525];_0x13f1e1&&await _0x4715['sendPaymentNotification'](_0x18fc39[_0x36ac1f(0x292)],_0x18fc39,_0x13f1e1),await this[_0x36ac1f(0x20c)](_0x18fc39,_0x28f525);}catch(_0x347707){console[_0x36ac1f(0x23f)](_0x36ac1f(0x253),_0x347707);}}async['sendShopWebhook'](_0x566903,_0x15cda0){const _0x328be9=a60_0x477af2,_0x2fb614=Date[_0x328be9(0x216)]();try{const _0x213598=_0x566903['shop'],_0x55384b=_0x213598['settings'];if(!_0x55384b?.[_0x328be9(0x286)]){console[_0x328be9(0x24a)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x213598['id']);return;}const _0x1d012f=_0x15cda0===_0x328be9(0x1af)?'payment.success':_0x328be9(0x247);let _0x5b30b7=[];if(_0x55384b['webhookEvents'])try{_0x5b30b7=Array[_0x328be9(0x210)](_0x55384b[_0x328be9(0x21a)])?_0x55384b[_0x328be9(0x21a)]:JSON[_0x328be9(0x278)](_0x55384b[_0x328be9(0x21a)]);}catch(_0x5934a1){console[_0x328be9(0x23f)](_0x328be9(0x2d4),_0x5934a1),_0x5b30b7=[];}if(!_0x5b30b7[_0x328be9(0x263)](_0x1d012f)){console[_0x328be9(0x24a)](_0x328be9(0x182)+_0x1d012f+_0x328be9(0x272)+_0x213598['id']);return;}const _0x5b29bc={'event':_0x1d012f,'payment':{'id':_0x566903['id'],'order_id':_0x566903['orderId'],'gateway_order_id':_0x566903[_0x328be9(0x25c)],'gateway':_0x328be9(0x19c),'amount':_0x566903['amount'],'currency':_0x566903[_0x328be9(0x2a2)],'status':_0x15cda0[_0x328be9(0x1e7)](),'customer_email':_0x566903[_0x328be9(0x236)],'customer_name':_0x566903['customerName'],'created_at':_0x566903[_0x328be9(0x1b8)],'updated_at':new Date()}},_0x389940=await fetch(_0x55384b[_0x328be9(0x286)],{'method':_0x328be9(0x1b6),'headers':{'Content-Type':'application/json','User-Agent':_0x328be9(0x1da)},'body':JSON[_0x328be9(0x221)](_0x5b29bc)}),_0x5ce21e=Date['now']()-_0x2fb614;loggerService_1[_0x328be9(0x18e)][_0x328be9(0x1f4)](_0x566903[_0x328be9(0x292)],_0x55384b['webhookUrl'],_0x1d012f,_0x389940[_0x328be9(0x1f3)],_0x5ce21e,_0x5b29bc),console[_0x328be9(0x24a)](_0x328be9(0x1cc)+_0x55384b['webhookUrl']+_0x328be9(0x2c0)+_0x389940[_0x328be9(0x1f3)]+'\x20('+_0x5ce21e+_0x328be9(0x191));}catch(_0xe70efd){console[_0x328be9(0x23f)](_0x328be9(0x1a6),_0xe70efd),loggerService_1[_0x328be9(0x18e)][_0x328be9(0x20a)](_0x566903[_0x328be9(0x292)],_0x566903[_0x328be9(0x259)]?.['settings']?.[_0x328be9(0x286)]||_0x328be9(0x261),_0x328be9(0x26d),_0xe70efd,{});}}[a60_0x477af2(0x287)](_0xaf4de3){const _0x21035a=a60_0x477af2,_0x4a4181=_0xaf4de3[_0x21035a(0x16c)](/[\s-]/g,'');if(_0x4a4181['length']<0x4)return _0x21035a(0x18d);return _0x21035a(0x298)+_0x4a4181[_0x21035a(0x1d2)](-0x4);}async[a60_0x477af2(0x1ba)](_0x22af98,_0x135c27=a60_0x477af2(0x21d)){const _0x4bbeeb=a60_0x477af2;console['log']('üîÑ\x20Processing\x20MasterCard\x20webhook\x20data:',JSON[_0x4bbeeb(0x221)](_0x22af98,null,0x2));let _0x19b734=_0x22af98,_0x378309=_0x135c27;_0x22af98[_0x4bbeeb(0x197)]?(_0x378309=_0x22af98[_0x4bbeeb(0x197)][_0x4bbeeb(0x2bb)]()==='VISA'?_0x4bbeeb(0x2bf):'MASTERCARD',console['log'](_0x4bbeeb(0x265)+_0x378309)):console[_0x4bbeeb(0x24a)](_0x4bbeeb(0x222)+_0x378309);if(_0x22af98['info']&&_0x22af98[_0x4bbeeb(0x25d)]&&_0x22af98[_0x4bbeeb(0x1fd)]){console[_0x4bbeeb(0x24a)](_0x4bbeeb(0x28c));try{const _0x5e9981=await this[_0x4bbeeb(0x22d)](_0x22af98[_0x4bbeeb(0x285)],_0x22af98[_0x4bbeeb(0x25d)],_0x378309);_0x19b734=JSON[_0x4bbeeb(0x278)](_0x5e9981),console[_0x4bbeeb(0x24a)]('‚úÖ\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP'),console[_0x4bbeeb(0x24a)](_0x4bbeeb(0x275),JSON[_0x4bbeeb(0x221)](_0x19b734,null,0x2));}catch(_0x1bb635){console[_0x4bbeeb(0x23f)](_0x4bbeeb(0x2ac),_0x1bb635),console[_0x4bbeeb(0x24a)](_0x4bbeeb(0x2b8)),_0x19b734=_0x22af98;}}else console['log']('üìù\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0x7fe97d='PENDING';if(_0x19b734['status']===0x64&&_0x19b734[_0x4bbeeb(0x1fc)]===0x1)_0x7fe97d=_0x4bbeeb(0x1af);else{if(_0x19b734[_0x4bbeeb(0x1fc)]===0x0||!this[_0x4bbeeb(0x179)](_0x19b734[_0x4bbeeb(0x1f3)]))_0x7fe97d=_0x4bbeeb(0x1e9);else _0x19b734[_0x4bbeeb(0x1fc)]===0x1||this[_0x4bbeeb(0x179)](_0x19b734['status'])?_0x7fe97d=_0x4bbeeb(0x23b):_0x7fe97d='PENDING';}let _0x5b0e98='';if(_0x19b734[_0x4bbeeb(0x2ab)])_0x5b0e98=_0x19b734[_0x4bbeeb(0x2ab)][_0x4bbeeb(0x175)](),console[_0x4bbeeb(0x24a)](_0x4bbeeb(0x26c)+_0x378309+_0x4bbeeb(0x26f)+_0x5b0e98);else _0x19b734['payment_id']?(_0x5b0e98=_0x19b734[_0x4bbeeb(0x174)][_0x4bbeeb(0x175)](),console['log']('üîç\x20Using\x20'+_0x378309+_0x4bbeeb(0x268)+_0x5b0e98)):(_0x5b0e98=_0x19b734[_0x4bbeeb(0x16b)]||_0x19b734[_0x4bbeeb(0x17d)]||_0x19b734['id']||'',console[_0x4bbeeb(0x24a)]('üîç\x20Using\x20fallback\x20fields\x20for\x20search:\x20'+_0x5b0e98));console[_0x4bbeeb(0x24a)]('üìä\x20'+_0x378309+'\x20webhook\x20extracted\x20data:'),console[_0x4bbeeb(0x24a)](_0x4bbeeb(0x23c)+_0x5b0e98+_0x4bbeeb(0x1d9)+_0x19b734[_0x4bbeeb(0x2ab)]+',\x20orderId='+_0x19b734[_0x4bbeeb(0x16b)]+_0x4bbeeb(0x1ac)+_0x19b734[_0x4bbeeb(0x174)]+_0x4bbeeb(0x1d6)+_0x19b734[_0x4bbeeb(0x17d)]+_0x4bbeeb(0x2c2)+_0x19b734['id']+')'),console[_0x4bbeeb(0x24a)](_0x4bbeeb(0x262)+_0x7fe97d+_0x4bbeeb(0x204)+_0x19b734['status']+_0x4bbeeb(0x227)+_0x19b734[_0x4bbeeb(0x1fc)]+')'),console[_0x4bbeeb(0x24a)](_0x4bbeeb(0x2d0)+_0x19b734[_0x4bbeeb(0x1b9)]),console[_0x4bbeeb(0x24a)](_0x4bbeeb(0x2b6)+_0x19b734[_0x4bbeeb(0x2a2)]);let _0x391b11;_0x7fe97d===_0x4bbeeb(0x23b)&&(_0x391b11=this[_0x4bbeeb(0x208)](_0x19b734[_0x4bbeeb(0x1f3)],_0x19b734['desc']),console[_0x4bbeeb(0x24a)](_0x4bbeeb(0x2b9)+_0x391b11));const _0x1f01f1={'paymentId':_0x5b0e98,'status':_0x7fe97d,'amount':_0x19b734['amount'],'currency':_0x19b734['currency'],'cardBrand':_0x378309};return _0x391b11&&(_0x1f01f1[_0x4bbeeb(0x185)]=_0x391b11),_0x1f01f1;}[a60_0x477af2(0x1a4)](){const _0x5a9805=a60_0x477af2;console['log'](_0x5a9805(0x1cb));const _0x15ebb1=this['statusCheckTimers'][_0x5a9805(0x1b5)];for(const [_0x5c72e4]of this[_0x5a9805(0x28e)]){this[_0x5a9805(0x27e)](_0x5c72e4);}console['log'](_0x5a9805(0x233)+_0x15ebb1+'\x20MasterCard\x20status\x20check\x20timers');}}exports['VisaMasterCardService']=VisaMasterCardService;