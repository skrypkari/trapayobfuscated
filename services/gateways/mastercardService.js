'use strict';const a57_0x46a889=a57_0x233f;(function(_0x5e06c7,_0x52248d){const _0x2caa3c=a57_0x233f,_0x4f8a70=_0x5e06c7();while(!![]){try{const _0x141b57=parseInt(_0x2caa3c(0x113))/0x1*(-parseInt(_0x2caa3c(0x1a5))/0x2)+parseInt(_0x2caa3c(0xa5))/0x3*(parseInt(_0x2caa3c(0x199))/0x4)+parseInt(_0x2caa3c(0x7a))/0x5*(-parseInt(_0x2caa3c(0x143))/0x6)+-parseInt(_0x2caa3c(0x84))/0x7+-parseInt(_0x2caa3c(0x12b))/0x8+parseInt(_0x2caa3c(0x13b))/0x9+parseInt(_0x2caa3c(0x117))/0xa;if(_0x141b57===_0x52248d)break;else _0x4f8a70['push'](_0x4f8a70['shift']());}catch(_0x2f7b21){_0x4f8a70['push'](_0x4f8a70['shift']());}}}(a57_0x4c78,0x85640));var __createBinding=this&&this[a57_0x46a889(0xae)]||(Object[a57_0x46a889(0x158)]?function(_0xd48710,_0x4dea93,_0x4cf1dd,_0x1b0280){const _0x138def=a57_0x46a889;if(_0x1b0280===undefined)_0x1b0280=_0x4cf1dd;var _0x47e42b=Object[_0x138def(0xe1)](_0x4dea93,_0x4cf1dd);(!_0x47e42b||(_0x138def(0x71)in _0x47e42b?!_0x4dea93[_0x138def(0x7d)]:_0x47e42b[_0x138def(0x132)]||_0x47e42b['configurable']))&&(_0x47e42b={'enumerable':!![],'get':function(){return _0x4dea93[_0x4cf1dd];}}),Object[_0x138def(0x170)](_0xd48710,_0x1b0280,_0x47e42b);}:function(_0x5d8104,_0x29783b,_0x3d525c,_0x1ae46e){if(_0x1ae46e===undefined)_0x1ae46e=_0x3d525c;_0x5d8104[_0x1ae46e]=_0x29783b[_0x3d525c];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a57_0x46a889(0x158)]?function(_0x5c316f,_0x285fd5){const _0x33e6fb=a57_0x46a889;Object[_0x33e6fb(0x170)](_0x5c316f,_0x33e6fb(0x189),{'enumerable':!![],'value':_0x285fd5});}:function(_0x175e08,_0x2d818d){_0x175e08['default']=_0x2d818d;}),__importStar=this&&this['__importStar']||(function(){var _0x3acf53=function(_0x557b23){return _0x3acf53=Object['getOwnPropertyNames']||function(_0x358a74){const _0x11bab8=a57_0x233f;var _0x5ccc6e=[];for(var _0x572cb2 in _0x358a74)if(Object[_0x11bab8(0x91)]['hasOwnProperty'][_0x11bab8(0x14e)](_0x358a74,_0x572cb2))_0x5ccc6e[_0x5ccc6e[_0x11bab8(0xa4)]]=_0x572cb2;return _0x5ccc6e;},_0x3acf53(_0x557b23);};return function(_0x3d9fe4){const _0x58cfb1=a57_0x233f;if(_0x3d9fe4&&_0x3d9fe4[_0x58cfb1(0x7d)])return _0x3d9fe4;var _0x5b4d86={};if(_0x3d9fe4!=null){for(var _0x4afb09=_0x3acf53(_0x3d9fe4),_0x458957=0x0;_0x458957<_0x4afb09[_0x58cfb1(0xa4)];_0x458957++)if(_0x4afb09[_0x458957]!=='default')__createBinding(_0x5b4d86,_0x3d9fe4,_0x4afb09[_0x458957]);}return __setModuleDefault(_0x5b4d86,_0x3d9fe4),_0x5b4d86;};}()),__importDefault=this&&this[a57_0x46a889(0xf4)]||function(_0x5a8cbe){const _0x250afb=a57_0x46a889;return _0x5a8cbe&&_0x5a8cbe[_0x250afb(0x7d)]?_0x5a8cbe:{'default':_0x5a8cbe};};Object[a57_0x46a889(0x170)](exports,a57_0x46a889(0x7d),{'value':!![]}),exports[a57_0x46a889(0x1b4)]=void 0x0;function a57_0x4c78(){const _0x33239a=['createDecipheriv',',\x20final=','Final:','ðŸ”\x20Using\x20keys:\x20','processWebhook','âœ…\x20VISA\x20key\x20files\x20validated\x20successfully','Failed\x20payment','Another\x20unknown\x20error','ðŸ”\x20AES\x20key\x20and\x20IV\x20generated','\x20\x20\x20-\x20merchant_point_id:','Recipient\x20data\x20required','logShopWebhookSent','Payment\x20returned','scheduleStatusChecks','apiUrl','Test\x20payment','\x20\x20Cleaned:\x20\x20\x22','trim','HTTP\x20Status:','Status:','customerEmail','card_type',',\x20body:\x20','getOwnPropertyDescriptor','Amount:','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','No\x20Error\x20executing\x20request','ðŸ’³\x20VISA/MasterCard\x20service\x20initialized','update','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','The\x20card\x20does\x20not\x20exist','ðŸ”\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','first_name','charge','last_name','Result\x20URL:','loggerService','ðŸ”\x20MasterCard\x20Private\x20key\x20path:','then','merchantPointId','âœ…\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','âœ…\x20Status\x20response\x20decrypted\x20successfully','__importDefault','replace','ðŸ“Š\x20Status\x20check\x20#','visaApiUrl','3ds_url','ðŸ”\x20VISA\x20Public\x20key\x20path:','base64','statusCheckTimers','âŒ\x20Detailed\x20failure\x20description:\x20','ðŸ“\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','join','randomBytes','ðŸ”\x20VISA\x20API\x20URL:','ðŸ”\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','failureMessage','floor','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','âŒ\x20Data\x20being\x20signed:','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','masterCardApiUrl','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','delete','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','visa_private.pem','visa/mastercard','ðŸ§¹\x20Clearing\x20','\x20(from:\x20status=','\x20\x20\x20-\x20info\x20length:','webhookEvents','ðŸ”\x20MasterCard\x20Public\x20key\x20length:\x20','1013624idGNud','Failed\x20to\x20send\x20payment\x20notifications:','constants','sendPaymentNotifications','27094590OsdzzM','createSign','cwd','getCardTypeAndApi','â°\x20Scheduling\x20status\x20checks\x20for\x20','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','/status_decrypt','\x20\x20\x20-\x20lang:\x20en','system','push','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','Unsuccessful\x20payment','Captcha\x20confirmation\x20awaited','ðŸ”\x20MasterCard\x20Private\x20key\x20length:\x20','payment_id','desc','from','paymentId','MasterCard\x20webhook\x20sent\x20to\x20','ðŸ”\x20Using\x20fallback\x20fields\x20for\x20search:\x20','4934624gweSGP','LookUp\x20number\x20of\x20attempts\x20exceeded','Payment\x20prohibited','\x20failed\x20for\x20payment\x20','sign','webhook_send','Payment\x20confirmation\x20required','writable','visa_public.pem','/charge_decrypted','payment.success','Decryption\x20failed:\x20','ðŸ”\x20AES\x20key\x20length:',':\x20Unknown\x20status\x20code','PAID','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','443061GVZrge','paymentStatuses','âš ï¸\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','customerName','ðŸ§¹\x20Card\x20holder\x20names\x20cleaned:','/charge_raw','encryptRSA','12378dfFkKn','Return\x20URL:','HTTP\x20error!\x20status:\x20','Invalid\x20expiration\x20date','ðŸ’³\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','crypto','The\x20card\x20is\x20lost\x20or\x20stolen',',\x20paymentId=','clearStatusTimers','ðŸ”\x20Response\x20is\x20encrypted,\x20decrypting...','/status_raw','call','includes','ðŸ”\x20VISA\x20Private\x20key\x20length:\x20',',\x20id=','message','set','/status','PENDING','logWhiteDomainRequest','Error\x20parsing\x20webhook\x20events:','create','ðŸ’¾\x20Saving\x20failure\x20message:\x20','amount','\x20\x20\x20Payment\x20ID:\x20','shopId','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','Expected\x20bitcoin\x20transfer\x20from\x20client','Failed\x20to\x20decrypt\x20response','),\x20stopping\x20status\x20checks','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','unknown','stopAllStatusChecks','Webhook\x20event\x20','ðŸ“¤\x20Sending\x20request\x20to\x20API...','Status\x20decryption\x20failed:\x20','https://api2.trapay.uk/decrypt.php','SHA256','Insufficient\x20funds\x20on\x20the\x20card','Transaction\x20limit\x20exceeded','parse','createCipheriv','ðŸ“\x20Data\x20to\x20sign\x20length:','\x20with\x20status\x20','resolve','defineProperty','âœ…\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','now','Awaiting\x20confirmation\x20by\x20ivr\x20call','settings','\x20status\x20updated\x20to\x20','../loggerService','expire_year','substring','ðŸ“\x20Final\x20request\x20structure:','json','ðŸ“\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','===\x20PARSED\x20API\x20RESPONSE\x20===','Client\x20OTP\x20confirmation\x20required','3DS\x20URL:','ðŸ”\x20Using\x20provided\x20card\x20type:\x20','path','ðŸ“\x20Encrypted\x20key\x20length:',',\x20Final:\x20','âœ…\x20Payment\x20','ðŸ’³\x20Unknown\x20card\x20type\x20(starts\x20with\x20','âš ï¸\x20Expected\x20VISA\x20private\x20key:\x20','âŒ\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','ðŸ”„\x20Processing\x20MasterCard\x20webhook\x20data:','\x20payment\x20status:\x20','default','payment.failed','getDetailedErrorMessage','status','ðŸ“Š\x20Status\x20check\x20result:','keys','logWhiteDomainError','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','isFinalStatus','application/json','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','log','****','âŒ\x20Status\x20check\x20#','ðŸ“\x20Data\x20length:','/charge','760XrsaiR','orderId','POST','updatePaymentStatus','logWhiteDomainResponse','cardType','utf8','publicKeyPath','decryptResponsePhp','decryptResponse','5000000000000000','\x20webhook\x20extracted\x20data:','2pDxcyP','Payment\x20System/1.0\x20(MasterCard)','âœ…\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','\x20\x20\x20-\x20sign\x20length:','toLowerCase','\x20status\x20check\x20error:','privateKeyPath','number','\x20\x20\x20Currency:\x20','RSA_PKCS1_PADDING','...','maskCardNumber','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','3DS\x20verification\x20required','signRSA','VisaMasterCardService','),\x20defaulting\x20to\x20MasterCard','encryptAES','currency','slice','key','\x20status\x20timers\x20for\x20payment\x20','masterCardMerchantPointId','ðŸ”\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','FAILED','-----BEGIN','sendPaymentNotification','get','sendShopWebhook','ms)','findUnique','Status\x20','ðŸ”\x20MasterCard\x20Public\x20key\x20path:','Sender\x20information\x20required','\x20for\x20payment\x20','ðŸ›‘\x20Stopped\x20','1555SDGCJR','text','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','__esModule','\x20characters','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','visaPrivateKeyPath','final','\x22\x20|\x20\x22','âŒ\x20PHP\x20decryptor\x20request\x20failed:','288155NTThHG','âŒ\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','MASTERCARD','Response\x20Body:','\x20result:','âŒ\x20VISA/MasterCard\x20key\x20validation\x20failed:','VISA','\x20payment_id\x20for\x20search:\x20',',\x20payment_id=','date_success','Awaiting\x20confirmation\x20in\x20the\x20application','Failed\x20to\x20send\x20MasterCard\x20webhook:','prototype','warn','stringify','validateKeyFiles','ðŸ“\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','Payment\x20System/1.0','Unknown\x20error','ðŸ’³\x20Detected\x20MasterCard\x20(starts\x20with\x205)','visaPublicKeyPath','https://api.paydmeth.com/api','aes-256-ctr','existsSync','LookUp\x20code\x20verified','readFileSync','webhookUrl','\x20API:\x20','âŒ\x20RSA\x20encryption\x20failed:','ðŸ“\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','error','length','1593PiqTon','ðŸ“\x20Signature\x20length:','payment','createdAt','generateAESKey','\x20is\x20final\x20(','Failed\x20to\x20check\x20','Method\x20not\x20allowed','ðŸ“\x20Encrypted\x20data\x20length:','__createBinding','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','shop','order_id','ðŸ”\x20','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','../../config/database','decryptAES','âŒ\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','toUpperCase','ðŸ”\x20VISA\x20Public\x20key\x20length:\x20','\x20|\x20Response:\x20','âŒ\x20Failed\x20to\x20decrypt\x20status\x20response:','ðŸŽ¯\x20Using\x20','description','ðŸ›‘\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','-----END','âš ï¸\x20Expected\x20VISA\x20public\x20key:\x20','1111','\x20not\x20enabled\x20for\x20shop\x20','LookUp\x20not\x20confirmed','ðŸ”\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','logShopWebhookError','info','âŒ\x20RSA\x20signing\x20failed:','toString','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','Failed\x20to\x20decrypt\x20response\x20via\x20PHP'];a57_0x4c78=function(){return _0x33239a;};return a57_0x4c78();}function a57_0x233f(_0x281ba1,_0x284b84){_0x281ba1=_0x281ba1-0x69;const _0x4c78a3=a57_0x4c78();let _0x233fd2=_0x4c78a3[_0x281ba1];return _0x233fd2;}const crypto_1=__importDefault(require(a57_0x46a889(0x148))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a57_0x46a889(0x180))),loggerService_1=require(a57_0x46a889(0x176));class VisaMasterCardService{constructor(){const _0x5eea28=a57_0x46a889;this[_0x5eea28(0xfb)]=new Map(),this[_0x5eea28(0x13c)]={0x0:{'final':![],'description':'No\x20New\x20payment'},0x1:{'final':![],'description':_0x5eea28(0xe4)},0x2:{'final':!![],'description':'Request\x20data\x20error'},0x3:{'final':!![],'description':_0x5eea28(0xd1)},0x4:{'final':!![],'description':_0x5eea28(0x122)},0x5:{'final':!![],'description':'Payment\x20not\x20found\x20using\x20the\x20specified\x20details'},0x6:{'final':!![],'description':_0x5eea28(0xd6)},0x7:{'final':!![],'description':_0x5eea28(0xd9)},0x8:{'final':![],'description':_0x5eea28(0x17d)},0x9:{'final':![],'description':_0x5eea28(0x1b2)},0xa:{'final':![],'description':'Sender\x27s\x20CVV\x20card\x20is\x20required'},0xb:{'final':![],'description':_0x5eea28(0x77)},0xc:{'final':![],'description':_0x5eea28(0xd4)},0xd:{'final':![],'description':_0x5eea28(0x7c)},0xe:{'final':![],'description':_0x5eea28(0x173)},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':_0x5eea28(0x123)},0x11:{'final':![],'description':_0x5eea28(0xe3)},0x12:{'final':![],'description':_0x5eea28(0x8f)},0x13:{'final':![],'description':'Payment\x20is\x20being\x20processed'},0x14:{'final':![],'description':_0x5eea28(0x86)},0x15:{'final':![],'description':_0x5eea28(0x15e)},0x16:{'final':![],'description':'Payment\x20pending\x20verification'},0x18:{'final':![],'description':'The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'},0x19:{'final':![],'description':_0x5eea28(0xaf)},0x1a:{'final':!![],'description':'Cash\x20payment\x20is\x20expected\x20at\x20TCO'},0x1b:{'final':![],'description':_0x5eea28(0xfe)},0x1c:{'final':![],'description':_0x5eea28(0x190)},0x1d:{'final':![],'description':_0x5eea28(0x10b)},0x1f:{'final':![],'description':_0x5eea28(0x105)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':'Sender\x27s\x20card\x20details\x20are\x20required'},0x24:{'final':!![],'description':'Payment\x20confirmation\x20time\x20has\x20expired'},0x25:{'final':!![],'description':_0x5eea28(0x12d)},0x26:{'final':!![],'description':_0x5eea28(0x13e)},0x27:{'final':!![],'description':_0x5eea28(0x169)},0x28:{'final':!![],'description':_0x5eea28(0xe8)},0x29:{'final':!![],'description':_0x5eea28(0x149)},0x2a:{'final':!![],'description':_0x5eea28(0x146)},0x2b:{'final':!![],'description':_0x5eea28(0x16a)},0x2c:{'final':!![],'description':_0x5eea28(0x11c)},0x2d:{'final':!![],'description':'Failed\x20payment'},0x2e:{'final':!![],'description':_0x5eea28(0x122)},0x2f:{'final':!![],'description':'Unsuccessful\x20payment'},0x30:{'final':!![],'description':_0x5eea28(0xb3)},0x31:{'final':![],'description':_0x5eea28(0x131)},0x32:{'final':!![],'description':_0x5eea28(0xac)},0x33:{'final':!![],'description':'Failed\x20payment'},0x34:{'final':!![],'description':_0x5eea28(0xd0)},0x35:{'final':!![],'description':'Failed\x20payment'},0x36:{'final':!![],'description':_0x5eea28(0xd0)},0x37:{'final':!![],'description':_0x5eea28(0xd0)},0x38:{'final':!![],'description':'Cancellation\x20is\x20not\x20possible'},0x39:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank'},0x3a:{'final':![],'description':'LookUp\x20code\x20sent'},0x3b:{'final':!![],'description':_0x5eea28(0x9d)},0x3c:{'final':!![],'description':'Number\x20of\x20attempts\x20exceeded'},0x3d:{'final':!![],'description':_0x5eea28(0x15d)},0x3e:{'final':!![],'description':_0x5eea28(0x107)},0x3f:{'final':!![],'description':_0x5eea28(0xd6)},0x40:{'final':![],'description':_0x5eea28(0xc2)},0x41:{'final':!![],'description':_0x5eea28(0x12c)},0x42:{'final':![],'description':'Payment\x20cancellation\x20is\x20being\x20processed'},0x43:{'final':!![],'description':_0x5eea28(0x193)},0x44:{'final':![],'description':_0x5eea28(0x1b2)},0x45:{'final':!![],'description':_0x5eea28(0xd0)},0x46:{'final':!![],'description':'Failed\x20payment'},0x47:{'final':!![],'description':'Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details'},0x64:{'final':!![],'description':'Operation\x20completed\x20successfully'}},this[_0x5eea28(0x108)]=_0x5eea28(0x9a),this[_0x5eea28(0x6c)]=0x744,this[_0x5eea28(0x1ab)]=path_1[_0x5eea28(0x189)][_0x5eea28(0xff)](process[_0x5eea28(0x119)](),_0x5eea28(0x18e),'private.pem'),this[_0x5eea28(0x1a0)]=path_1[_0x5eea28(0x189)][_0x5eea28(0xff)](process[_0x5eea28(0x119)](),'keys','psp_public.pem'),this['visaApiUrl']=_0x5eea28(0x9a),this['visaMerchantPointId']=0x6b7,this['visaPrivateKeyPath']=path_1['default'][_0x5eea28(0xff)](process[_0x5eea28(0x119)](),'keys',_0x5eea28(0x10c)),this[_0x5eea28(0x99)]=path_1[_0x5eea28(0x189)]['join'](process[_0x5eea28(0x119)](),_0x5eea28(0x18e),_0x5eea28(0x133)),console[_0x5eea28(0x194)](_0x5eea28(0xe5)),console[_0x5eea28(0x194)]('ðŸ”\x20MasterCard\x20API\x20URL:',this[_0x5eea28(0x108)]),console['log'](_0x5eea28(0x101),this[_0x5eea28(0xf7)]),console[_0x5eea28(0x194)](_0x5eea28(0xef),this['privateKeyPath']),console['log'](_0x5eea28(0x76),this['publicKeyPath']),console[_0x5eea28(0x194)]('ðŸ”\x20VISA\x20Private\x20key\x20path:',this[_0x5eea28(0x80)]),console['log'](_0x5eea28(0xf9),this[_0x5eea28(0x99)]),this[_0x5eea28(0x94)]();}['getDetailedErrorMessage'](_0xfe4751,_0xbd7b5d){const _0x2cffa2=a57_0x46a889,_0xfe83d7=this[_0x2cffa2(0x13c)][_0xfe4751];let _0x2659a7='';_0xfe83d7?_0x2659a7=_0x2cffa2(0x75)+_0xfe4751+':\x20'+_0xfe83d7[_0x2cffa2(0xbc)]:_0x2659a7=_0x2cffa2(0x75)+_0xfe4751+_0x2cffa2(0x138);if(_0xbd7b5d&&_0xbd7b5d['trim']()){const _0x1c6519=_0xbd7b5d[_0x2cffa2(0xdb)]();(!_0xfe83d7||_0x1c6519[_0x2cffa2(0x1a9)]()!==_0xfe83d7[_0x2cffa2(0xbc)][_0x2cffa2(0x1a9)]())&&(_0x2659a7+=_0x2cffa2(0xb9)+_0x1c6519);}return _0x2659a7;}[a57_0x46a889(0x191)](_0x2665d6){const _0x386ccf=a57_0x46a889,_0x40961f=this[_0x386ccf(0x13c)][_0x2665d6];return _0x40961f?_0x40961f[_0x386ccf(0x81)]:!![];}['getCardTypeAndApi'](_0x56b84e){const _0x4999e8=a57_0x46a889,_0x2e8d11=_0x56b84e['charAt'](0x0);if(_0x2e8d11==='4')return console['log'](_0x4999e8(0x147)),{'cardType':_0x4999e8(0x8b),'apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x4999e8(0x80)],'publicKeyPath':this[_0x4999e8(0x99)],'merchantPointId':this['visaMerchantPointId']};else return _0x2e8d11==='5'?(console[_0x4999e8(0x194)](_0x4999e8(0x98)),{'cardType':'MASTERCARD','apiUrl':this[_0x4999e8(0x108)],'privateKeyPath':this[_0x4999e8(0x1ab)],'publicKeyPath':this[_0x4999e8(0x1a0)],'merchantPointId':this['masterCardMerchantPointId']}):(console[_0x4999e8(0x194)](_0x4999e8(0x184)+_0x2e8d11+_0x4999e8(0x1b5)),{'cardType':_0x4999e8(0x87),'apiUrl':this[_0x4999e8(0x108)],'privateKeyPath':this[_0x4999e8(0x1ab)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this['masterCardMerchantPointId']});}['validateKeyFiles'](){const _0x455980=a57_0x46a889;try{if(!fs_1[_0x455980(0x189)]['existsSync'](this['privateKeyPath']))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this[_0x455980(0x1ab)]);if(!fs_1['default'][_0x455980(0x9c)](this['publicKeyPath']))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this[_0x455980(0x1a0)]);const _0x4da95e=fs_1[_0x455980(0x189)]['readFileSync'](this['privateKeyPath'],_0x455980(0x19f))[_0x455980(0xdb)](),_0x3f1d37=fs_1[_0x455980(0x189)][_0x455980(0x9e)](this[_0x455980(0x1a0)],_0x455980(0x19f))[_0x455980(0xdb)]();if(!_0x4da95e['includes']('-----BEGIN')||!_0x4da95e['includes'](_0x455980(0xbe)))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x3f1d37[_0x455980(0x14f)]('-----BEGIN')||!_0x3f1d37['includes']('-----END'))throw new Error(_0x455980(0x13a));console['log']('âœ…\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console[_0x455980(0x194)](_0x455980(0x124)+_0x4da95e['length']+_0x455980(0x7e)),console[_0x455980(0x194)](_0x455980(0x112)+_0x3f1d37[_0x455980(0xa4)]+_0x455980(0x7e));if(fs_1[_0x455980(0x189)][_0x455980(0x9c)](this[_0x455980(0x80)])&&fs_1[_0x455980(0x189)]['existsSync'](this[_0x455980(0x99)])){const _0x248f69=fs_1['default'][_0x455980(0x9e)](this[_0x455980(0x80)],_0x455980(0x19f))[_0x455980(0xdb)](),_0x10d749=fs_1[_0x455980(0x189)][_0x455980(0x9e)](this[_0x455980(0x99)],_0x455980(0x19f))[_0x455980(0xdb)]();(!_0x248f69[_0x455980(0x14f)](_0x455980(0x6f))||!_0x248f69[_0x455980(0x14f)](_0x455980(0xbe)))&&console[_0x455980(0x92)]('âš ï¸\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),(!_0x10d749[_0x455980(0x14f)](_0x455980(0x6f))||!_0x10d749[_0x455980(0x14f)](_0x455980(0xbe)))&&console['warn']('âš ï¸\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),console[_0x455980(0x194)](_0x455980(0xcf)),console[_0x455980(0x194)](_0x455980(0x150)+_0x248f69[_0x455980(0xa4)]+_0x455980(0x7e)),console[_0x455980(0x194)](_0x455980(0xb8)+_0x10d749['length']+_0x455980(0x7e));}else console[_0x455980(0x92)](_0x455980(0x13d)),console['warn'](_0x455980(0x185)+this['visaPrivateKeyPath']),console['warn'](_0x455980(0xbf)+this[_0x455980(0x99)]);}catch(_0x3e75c9){console[_0x455980(0xa3)](_0x455980(0x8a),_0x3e75c9);throw _0x3e75c9;}}[a57_0x46a889(0xa9)](){const _0x3552d5=a57_0x46a889,_0x284f74=crypto_1['default'][_0x3552d5(0x100)](0x20),_0x58c86d=crypto_1[_0x3552d5(0x189)][_0x3552d5(0x100)](0x10);return{'key':_0x284f74,'iv':_0x58c86d};}['encryptAES'](_0x301a38,_0x8bbf86,_0x322585){const _0xfa7a6d=a57_0x46a889,_0x284fa5=crypto_1['default'][_0xfa7a6d(0x16c)](_0xfa7a6d(0x9b),_0x8bbf86,_0x322585);let _0x58d043=_0x284fa5[_0xfa7a6d(0xe6)](_0x301a38,'utf8',_0xfa7a6d(0xfa));return _0x58d043+=_0x284fa5[_0xfa7a6d(0x81)](_0xfa7a6d(0xfa)),_0x58d043;}[a57_0x46a889(0x142)](_0x1b4acc,_0x5e14dd,_0x1c6aec){const _0x20cc29=a57_0x46a889;try{const _0x447405=fs_1[_0x20cc29(0x189)][_0x20cc29(0x9e)](_0x1c6aec,'utf8')['trim'](),_0x572438={'iv':_0x5e14dd['toString'](_0x20cc29(0xfa)),'key':_0x1b4acc[_0x20cc29(0xc7)]('base64')},_0x5563ac=JSON[_0x20cc29(0x93)](_0x572438);console[_0x20cc29(0x194)](_0x20cc29(0x6d),_0x5563ac[_0x20cc29(0xa4)]);const _0x3d6048=crypto_1[_0x20cc29(0x189)]['publicEncrypt']({'key':_0x447405,'padding':crypto_1[_0x20cc29(0x189)][_0x20cc29(0x115)][_0x20cc29(0x1ae)]},Buffer[_0x20cc29(0x127)](_0x5563ac));return console[_0x20cc29(0x194)](_0x20cc29(0xf2),_0x3d6048[_0x20cc29(0xa4)]),_0x3d6048[_0x20cc29(0xc7)](_0x20cc29(0xfa));}catch(_0x143351){console[_0x20cc29(0xa3)](_0x20cc29(0xa1),_0x143351);throw new Error(_0x20cc29(0xe7));}}['signRSA'](_0x5717b4,_0x37d5dd){const _0x432b3a=a57_0x46a889;try{const _0x447ecd=fs_1['default'][_0x432b3a(0x9e)](_0x37d5dd,_0x432b3a(0x19f))['trim'](),_0x4dc585=crypto_1[_0x432b3a(0x189)][_0x432b3a(0x118)](_0x432b3a(0x168));_0x4dc585['update'](_0x5717b4),_0x4dc585['end']();const _0x501c17=_0x4dc585[_0x432b3a(0x12f)](_0x447ecd,'base64');return console['log']('ðŸ”\x20RSA\x20signing\x20successful'),console[_0x432b3a(0x194)](_0x432b3a(0x16d),_0x5717b4[_0x432b3a(0xa4)]),console[_0x432b3a(0x194)]('ðŸ“\x20Signature\x20length:',_0x501c17[_0x432b3a(0xa4)]),_0x501c17;}catch(_0x5901e6){console['error'](_0x432b3a(0xc6),_0x5901e6),console['error'](_0x432b3a(0x106),_0x5717b4[_0x432b3a(0x178)](0x0,0xc8)+_0x432b3a(0x1af));throw new Error(_0x432b3a(0x7f));}}['decryptAES'](_0x44f250,_0x4fb6b0,_0x1e026c){const _0x52dde4=a57_0x46a889,_0x56566a=crypto_1[_0x52dde4(0x189)][_0x52dde4(0xca)](_0x52dde4(0x9b),_0x4fb6b0,_0x1e026c);let _0x184782=_0x56566a[_0x52dde4(0xe6)](_0x44f250,_0x52dde4(0xfa),_0x52dde4(0x19f));return _0x184782+=_0x56566a[_0x52dde4(0x81)](_0x52dde4(0x19f)),_0x184782;}async[a57_0x46a889(0x1a1)](_0x203e87,_0x1fa82d,_0x2f587d=a57_0x46a889(0x87)){const _0x164614=a57_0x46a889;try{const _0x2edffe=await fetch(_0x164614(0x167),{'method':_0x164614(0x19b),'headers':{'Content-Type':_0x164614(0x192)},'body':JSON[_0x164614(0x93)]({'info':_0x203e87,'key':_0x1fa82d,'card_type':_0x2f587d['toLowerCase']()})});if(!_0x2edffe['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x2edffe['text']();}catch(_0x586242){console[_0x164614(0xa3)](_0x164614(0x83),_0x586242);throw new Error(_0x164614(0xc9));}}[a57_0x46a889(0x1a2)](_0x420039,_0x4d2c69){const _0xe000f0=a57_0x46a889;try{const _0x4298d7=fs_1[_0xe000f0(0x189)]['readFileSync'](this['privateKeyPath'],_0xe000f0(0x19f))['trim'](),_0x1bb663=crypto_1[_0xe000f0(0x189)]['privateDecrypt'](_0x4298d7,Buffer['from'](_0x4d2c69,_0xe000f0(0xfa))),_0x388875=JSON['parse'](_0x1bb663[_0xe000f0(0xc7)]()),_0x8b05f7=Buffer[_0xe000f0(0x127)](_0x388875[_0xe000f0(0x6a)],'base64'),_0x1468a9=Buffer['from'](_0x388875['iv'],_0xe000f0(0xfa));return this[_0xe000f0(0xb5)](_0x420039,_0x8b05f7,_0x1468a9);}catch(_0x6801e5){throw new Error(_0xe000f0(0x15f));}}async['processCardPayment'](_0x16536f){const _0x1f9a3c=a57_0x46a889,{paymentId:_0x5f4fc9,orderId:_0x985da2,amount:_0x13b99f,currency:_0x4e6a5d,cardData:_0x13cd78,resultUrl:_0x49d192,returnUrl:_0x309a3f,cardHolder:_0x40a590,browser:_0x39b3a1}=_0x16536f;console[_0x1f9a3c(0x194)](_0x1f9a3c(0x109)),console['log']('Payment\x20ID:',_0x5f4fc9),console[_0x1f9a3c(0x194)]('Order\x20ID:',_0x985da2),console[_0x1f9a3c(0x194)](_0x1f9a3c(0xe2),_0x13b99f,_0x4e6a5d),console[_0x1f9a3c(0x194)]('Card\x20Number:',this[_0x1f9a3c(0x1b0)](_0x13cd78['number'])),console[_0x1f9a3c(0x194)]('Card\x20Holder:',_0x40a590[_0x1f9a3c(0xea)]+'\x20'+_0x40a590['last_name']),console[_0x1f9a3c(0x194)](_0x1f9a3c(0x144),_0x309a3f),console[_0x1f9a3c(0x194)](_0x1f9a3c(0xed),_0x49d192);const _0x47b707=this[_0x1f9a3c(0x11a)](_0x13cd78['number']);console['log'](_0x1f9a3c(0xbb)+_0x47b707[_0x1f9a3c(0x19e)]+_0x1f9a3c(0xa0)+_0x47b707[_0x1f9a3c(0xd8)]),console[_0x1f9a3c(0x194)](_0x1f9a3c(0xcd)+_0x47b707[_0x1f9a3c(0x1ab)]+',\x20'+_0x47b707['publicKeyPath']);const _0x4f858d={..._0x40a590,'first_name':_0x40a590['first_name']?.[_0x1f9a3c(0xf5)](/[\t\n\r\f\v]/g,'\x20')[_0x1f9a3c(0xdb)]()||'','last_name':_0x40a590[_0x1f9a3c(0xec)]?.[_0x1f9a3c(0xf5)](/[\t\n\r\f\v]/g,'\x20')[_0x1f9a3c(0xdb)]()||''};console[_0x1f9a3c(0x194)](_0x1f9a3c(0x140)),console[_0x1f9a3c(0x194)]('\x20\x20Original:\x20\x22'+_0x40a590['first_name']+_0x1f9a3c(0x82)+_0x40a590[_0x1f9a3c(0xec)]+'\x22'),console['log'](_0x1f9a3c(0xda)+_0x4f858d[_0x1f9a3c(0xea)]+'\x22\x20|\x20\x22'+_0x4f858d['last_name']+'\x22');const _0x4b0c23={'amount':_0x13b99f,'currency':_0x4e6a5d['toUpperCase'](),'order_id':_0x985da2,'result_url':_0x49d192,'return_url':_0x309a3f,'country':'','card':{'number':_0x13cd78[_0x1f9a3c(0x1ac)],'expire_month':_0x13cd78['expire_month'],'expire_year':_0x13cd78[_0x1f9a3c(0x177)],'cvv':_0x13cd78['cvv']},'card_holder':_0x4f858d,'browser':_0x39b3a1},_0x349a4f=JSON['stringify'](_0x4b0c23);console[_0x1f9a3c(0x194)]('ðŸ’¾\x20Payment\x20data\x20prepared'),console[_0x1f9a3c(0x194)](_0x1f9a3c(0x95)),console['log'](_0x349a4f),console[_0x1f9a3c(0x194)](_0x1f9a3c(0x197),_0x349a4f[_0x1f9a3c(0xa4)]);try{const {key:_0x2844c3,iv:_0x562939}=this['generateAESKey']();console[_0x1f9a3c(0x194)](_0x1f9a3c(0xd2)),console[_0x1f9a3c(0x194)](_0x1f9a3c(0x137),_0x2844c3[_0x1f9a3c(0xa4)]),console[_0x1f9a3c(0x194)]('ðŸ”\x20AES\x20IV\x20length:',_0x562939[_0x1f9a3c(0xa4)]);const _0xa92681=this[_0x1f9a3c(0x1b6)](_0x349a4f,_0x2844c3,_0x562939);console['log']('ðŸ”\x20Data\x20encrypted\x20with\x20AES'),console[_0x1f9a3c(0x194)](_0x1f9a3c(0xad),_0xa92681['length']);const _0x23ce4c=this[_0x1f9a3c(0x142)](_0x2844c3,_0x562939,_0x47b707[_0x1f9a3c(0x1a0)]);console['log'](_0x1f9a3c(0xc3)),console[_0x1f9a3c(0x194)](_0x1f9a3c(0x181),_0x23ce4c[_0x1f9a3c(0xa4)]);const _0x858def=this[_0x1f9a3c(0x1b3)](_0x349a4f,_0x47b707[_0x1f9a3c(0x1ab)]);console[_0x1f9a3c(0x194)]('ðŸ”\x20Data\x20signed\x20with\x20RSA'),console[_0x1f9a3c(0x194)](_0x1f9a3c(0xa6),_0x858def[_0x1f9a3c(0xa4)]);const _0x30262d={'merchant_point_id':_0x47b707['merchantPointId'],'method':_0x1f9a3c(0xeb),'info':_0xa92681,'key':_0x23ce4c,'sign':_0x858def,'lang':'en'};console['log'](_0x1f9a3c(0x165)),console[_0x1f9a3c(0x194)](_0x1f9a3c(0x179)),console[_0x1f9a3c(0x194)](_0x1f9a3c(0xd3),_0x47b707['merchantPointId']),console[_0x1f9a3c(0x194)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x1f9a3c(0x194)](_0x1f9a3c(0x110),_0xa92681[_0x1f9a3c(0xa4)]),console['log']('\x20\x20\x20-\x20key\x20length:',_0x23ce4c[_0x1f9a3c(0xa4)]),console[_0x1f9a3c(0x194)](_0x1f9a3c(0x1a8),_0x858def[_0x1f9a3c(0xa4)]),console[_0x1f9a3c(0x194)](_0x1f9a3c(0x11e)),loggerService_1[_0x1f9a3c(0xee)][_0x1f9a3c(0x156)](_0x47b707['cardType']['toLowerCase'](),_0x1f9a3c(0x198),_0x1f9a3c(0x19b),{'merchant_point_id':_0x47b707[_0x1f9a3c(0xf1)],'method':_0x1f9a3c(0xeb),'lang':'en'});const _0x5d9663=Date['now'](),_0x1087bc=await fetch(_0x47b707[_0x1f9a3c(0xd8)],{'method':_0x1f9a3c(0x19b),'headers':{'Content-Type':_0x1f9a3c(0x192),'Accept':_0x1f9a3c(0x192),'User-Agent':_0x1f9a3c(0x96)},'body':JSON[_0x1f9a3c(0x93)](_0x30262d)}),_0x54e594=Date[_0x1f9a3c(0x172)]()-_0x5d9663;console[_0x1f9a3c(0x194)]('===\x20API\x20RESPONSE\x20==='),console[_0x1f9a3c(0x194)](_0x1f9a3c(0xdd),_0x1087bc['status']),console[_0x1f9a3c(0x194)]('Response\x20Time:',_0x54e594+'ms');if(!_0x1087bc['ok']){const _0x3704b2=await _0x1087bc['text']();console[_0x1f9a3c(0xa3)](_0x1f9a3c(0xdc),_0x1087bc['status']),console[_0x1f9a3c(0xa3)](_0x1f9a3c(0x88),_0x3704b2),loggerService_1['loggerService'][_0x1f9a3c(0x19d)](_0x47b707[_0x1f9a3c(0x19e)][_0x1f9a3c(0x1a9)](),_0x1f9a3c(0x141),_0x1087bc[_0x1f9a3c(0x18c)],_0x3704b2,_0x54e594),loggerService_1['loggerService'][_0x1f9a3c(0x18f)](_0x47b707['cardType']['toLowerCase'](),_0x1f9a3c(0x198),'HTTP\x20'+_0x1087bc[_0x1f9a3c(0x18c)]+':\x20'+_0x3704b2);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1087bc[_0x1f9a3c(0x18c)]+_0x1f9a3c(0xe0)+_0x3704b2);}const _0x40919f=await _0x1087bc[_0x1f9a3c(0x17a)]();loggerService_1[_0x1f9a3c(0xee)][_0x1f9a3c(0x19d)](_0x47b707[_0x1f9a3c(0x19e)][_0x1f9a3c(0x1a9)](),'/charge_raw',_0x1087bc[_0x1f9a3c(0x18c)],_0x40919f,_0x54e594),console[_0x1f9a3c(0x194)](_0x1f9a3c(0x17c));let _0x23bf9f=_0x40919f;if(_0x40919f[_0x1f9a3c(0xc5)]&&_0x40919f['key']&&_0x40919f['sign']){console[_0x1f9a3c(0x194)](_0x1f9a3c(0x14c));try{const _0x4c15d2=await this[_0x1f9a3c(0x1a1)](_0x40919f[_0x1f9a3c(0xc5)],_0x40919f[_0x1f9a3c(0x6a)],_0x47b707['cardType']);_0x23bf9f=JSON[_0x1f9a3c(0x16b)](_0x4c15d2),console[_0x1f9a3c(0x194)](_0x1f9a3c(0x1a7)),loggerService_1[_0x1f9a3c(0xee)][_0x1f9a3c(0x19d)](_0x47b707[_0x1f9a3c(0x19e)][_0x1f9a3c(0x1a9)](),_0x1f9a3c(0x134),_0x1087bc[_0x1f9a3c(0x18c)],_0x23bf9f,_0x54e594),console['log']('ðŸ“\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x4513da){console[_0x1f9a3c(0xa3)](_0x1f9a3c(0x186),_0x4513da),loggerService_1[_0x1f9a3c(0xee)][_0x1f9a3c(0x18f)](_0x47b707[_0x1f9a3c(0x19e)][_0x1f9a3c(0x1a9)](),'/charge_decrypt',_0x1f9a3c(0x136)+_0x4513da),_0x23bf9f=_0x40919f;}}else loggerService_1['loggerService']['logWhiteDomainResponse'](_0x47b707[_0x1f9a3c(0x19e)][_0x1f9a3c(0x1a9)](),_0x1f9a3c(0x134),_0x1087bc[_0x1f9a3c(0x18c)],_0x23bf9f,_0x54e594),console[_0x1f9a3c(0x194)]('ðŸ“\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x1f9a3c(0x194)](_0x1f9a3c(0xdd),_0x23bf9f[_0x1f9a3c(0x18c)]),console['log'](_0x1f9a3c(0xcc),_0x23bf9f['final']),console[_0x1f9a3c(0x194)]('Payment\x20ID:',_0x23bf9f[_0x1f9a3c(0x125)]),console[_0x1f9a3c(0x194)](_0x1f9a3c(0x17e),_0x23bf9f[_0x1f9a3c(0xf8)]||'none');if(_0x23bf9f[_0x1f9a3c(0x18c)]===0x64&&_0x23bf9f['final']===0x1)return console['log']('âœ…\x20Payment\x20successful'),{'gateway_payment_id':_0x23bf9f[_0x1f9a3c(0x125)]?.[_0x1f9a3c(0xc7)](),'payment_url':_0x309a3f,'requires_3ds':![],'status':_0x1f9a3c(0x139),'final':!![]};if(_0x23bf9f[_0x1f9a3c(0xf8)])return console['log']('ðŸ”\x203DS\x20verification\x20required'),this[_0x1f9a3c(0xd7)](_0x5f4fc9,_0x985da2,_0x23bf9f[_0x1f9a3c(0x125)]?.['toString']()||_0x985da2,_0x47b707[_0x1f9a3c(0x19e)]),{'gateway_payment_id':_0x23bf9f[_0x1f9a3c(0x125)]?.['toString'](),'payment_url':_0x23bf9f[_0x1f9a3c(0xf8)],'requires_3ds':!![],'threeds_url':_0x23bf9f[_0x1f9a3c(0xf8)],'status':_0x1f9a3c(0x155),'final':![]};let _0x503652=this[_0x1f9a3c(0x18b)](_0x23bf9f[_0x1f9a3c(0x18c)],_0x23bf9f['desc']||_0x23bf9f[_0x1f9a3c(0x152)]),_0x54c336=_0x23bf9f[_0x1f9a3c(0x18c)],_0x41305c=this[_0x1f9a3c(0x191)](_0x23bf9f[_0x1f9a3c(0x18c)]);return console[_0x1f9a3c(0x194)]('âŒ\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x54c336+_0x1f9a3c(0x182)+_0x41305c+',\x20Desc:\x20'+_0x503652),{'gateway_payment_id':_0x23bf9f['payment_id']?.[_0x1f9a3c(0xc7)](),'payment_url':_0x309a3f,'requires_3ds':![],'status':_0x1f9a3c(0x6e),'final':!![],'errorMessage':_0x503652};}catch(_0x3c98cc){console[_0x1f9a3c(0xa3)](_0x1f9a3c(0x161)),console['error']('Error\x20details:',_0x3c98cc),loggerService_1['loggerService']['logWhiteDomainError'](_0x1f9a3c(0x10d),'/charge',_0x3c98cc);throw new Error(_0x1f9a3c(0x121)+(_0x3c98cc instanceof Error?_0x3c98cc[_0x1f9a3c(0x152)]:_0x1f9a3c(0x97)));}}async['checkPaymentStatus'](_0x5d20ea,_0x562d5f,_0x52dc72=a57_0x46a889(0x8b)){const _0x5c7af9=a57_0x46a889;console[_0x5c7af9(0x194)]('ðŸ“Š\x20Checking\x20'+_0x52dc72+_0x5c7af9(0x188)+_0x5d20ea+'\x20('+_0x562d5f+')');try{const _0x188dcd={'payment_id':_0x5d20ea,'order_id':_0x562d5f},_0x386927=JSON[_0x5c7af9(0x93)](_0x188dcd),_0x8f39a2=this['getCardTypeAndApi'](_0x52dc72===_0x5c7af9(0x8b)?'4000000000000000':_0x5c7af9(0x1a3)),{key:_0x20f210,iv:_0x368079}=this['generateAESKey'](),_0x4a5223=this['encryptAES'](_0x386927,_0x20f210,_0x368079),_0x17456a=this['encryptRSA'](_0x20f210,_0x368079,_0x8f39a2[_0x5c7af9(0x1a0)]),_0x436b3d=this[_0x5c7af9(0x1b3)](_0x386927,_0x8f39a2[_0x5c7af9(0x1ab)]),_0x214f9b={'merchant_point_id':_0x8f39a2[_0x5c7af9(0xf1)],'method':_0x5c7af9(0x18c),'info':_0x4a5223,'key':_0x17456a,'sign':_0x436b3d,'lang':'en'};loggerService_1[_0x5c7af9(0xee)][_0x5c7af9(0x156)](_0x52dc72[_0x5c7af9(0x1a9)](),_0x5c7af9(0x154),'POST',{'merchant_point_id':_0x8f39a2['merchantPointId'],'method':'status','lang':'en'});const _0x81b7ff=Date['now'](),_0x5495ba=await fetch(_0x8f39a2[_0x5c7af9(0xd8)],{'method':_0x5c7af9(0x19b),'headers':{'Content-Type':_0x5c7af9(0x192),'Accept':_0x5c7af9(0x192),'User-Agent':_0x5c7af9(0x96)},'body':JSON['stringify'](_0x214f9b)}),_0x52054b=Date[_0x5c7af9(0x172)]()-_0x81b7ff;if(!_0x5495ba['ok']){const _0x4abaa=await _0x5495ba[_0x5c7af9(0x7b)]();loggerService_1['loggerService'][_0x5c7af9(0x19d)](_0x52dc72[_0x5c7af9(0x1a9)](),'/status_raw',_0x5495ba[_0x5c7af9(0x18c)],_0x4abaa,_0x52054b);throw new Error(_0x5c7af9(0x145)+_0x5495ba['status']);}const _0x4aa941=await _0x5495ba[_0x5c7af9(0x17a)]();loggerService_1['loggerService'][_0x5c7af9(0x19d)](_0x52dc72[_0x5c7af9(0x1a9)](),_0x5c7af9(0x14d),_0x5495ba['status'],_0x4aa941,_0x52054b);let _0x52f622=_0x4aa941;if(_0x4aa941[_0x5c7af9(0xc5)]&&_0x4aa941['key']&&_0x4aa941[_0x5c7af9(0x12f)]){console['log'](_0x5c7af9(0xe9));try{const _0xedbdf0=await this[_0x5c7af9(0x1a1)](_0x4aa941[_0x5c7af9(0xc5)],_0x4aa941['key'],_0x52dc72);_0x52f622=JSON[_0x5c7af9(0x16b)](_0xedbdf0),console['log'](_0x5c7af9(0xf3)),loggerService_1[_0x5c7af9(0xee)][_0x5c7af9(0x19d)](_0x52dc72[_0x5c7af9(0x1a9)](),'/status_decrypted',_0x5495ba[_0x5c7af9(0x18c)],_0x52f622,_0x52054b),console[_0x5c7af9(0x194)](_0x5c7af9(0xfd));}catch(_0x35bd3e){console[_0x5c7af9(0xa3)](_0x5c7af9(0xba),_0x35bd3e),loggerService_1['loggerService'][_0x5c7af9(0x18f)](_0x52dc72[_0x5c7af9(0x1a9)](),_0x5c7af9(0x11d),_0x5c7af9(0x166)+_0x35bd3e),_0x52f622=_0x4aa941;}}else loggerService_1[_0x5c7af9(0xee)][_0x5c7af9(0x19d)](_0x52dc72['toLowerCase'](),'/status_decrypted',_0x5495ba[_0x5c7af9(0x18c)],_0x52f622,_0x52054b),console['log'](_0x5c7af9(0x17b));console[_0x5c7af9(0x194)](_0x5c7af9(0x18d),{'status':_0x52f622[_0x5c7af9(0x18c)],'final':_0x52f622[_0x5c7af9(0x81)],'payment_id':_0x52f622[_0x5c7af9(0x125)],'desc':_0x52f622[_0x5c7af9(0x126)]});let _0x3d4ef6=_0x5c7af9(0x155);if(_0x52f622[_0x5c7af9(0x18c)]===0x64&&_0x52f622[_0x5c7af9(0x81)]===0x1)_0x3d4ef6='PAID';else{if(_0x52f622[_0x5c7af9(0x81)]===0x0||!this[_0x5c7af9(0x191)](_0x52f622[_0x5c7af9(0x18c)]))_0x3d4ef6='PENDING';else _0x52f622[_0x5c7af9(0x81)]===0x1||this[_0x5c7af9(0x191)](_0x52f622['status'])?_0x3d4ef6='FAILED':_0x3d4ef6=_0x5c7af9(0x155);}const _0x2feaaf=this[_0x5c7af9(0x18b)](_0x52f622['status'],_0x52f622[_0x5c7af9(0x126)]);return{'status':_0x3d4ef6,'final':this['isFinalStatus'](_0x52f622[_0x5c7af9(0x18c)]),'amount':_0x52f622['amount'],'currency':_0x52f622[_0x5c7af9(0x1b7)],'date_success':_0x52f622[_0x5c7af9(0x8e)],'description':_0x2feaaf};}catch(_0xbd68bd){console[_0x5c7af9(0xa3)](_0x52dc72+_0x5c7af9(0x1aa),_0xbd68bd),loggerService_1[_0x5c7af9(0xee)][_0x5c7af9(0x18f)](_0x52dc72['toLowerCase'](),'/status',_0xbd68bd);throw new Error(_0x5c7af9(0xab)+_0x52dc72+_0x5c7af9(0x188)+(_0xbd68bd instanceof Error?_0xbd68bd[_0x5c7af9(0x152)]:_0x5c7af9(0x97)));}}[a57_0x46a889(0xd7)](_0x28e3cf,_0x3e49bb,_0x4e339a,_0x9552e){const _0x2a679a=a57_0x46a889;console[_0x2a679a(0x194)](_0x2a679a(0x11b)+_0x9552e+'\x20payment:\x20'+_0x28e3cf+'\x20('+_0x4e339a+')'),this[_0x2a679a(0x14b)](_0x28e3cf);const _0x2f5ddb=[],_0x2c2c92=0x5*0x3c*0x3e8,_0x59715d=0x2*0x3c*0x3c*0x3e8,_0x2ef862=Math[_0x2a679a(0x104)](_0x59715d/_0x2c2c92);console['log']('â°\x20Will\x20check\x20status\x20'+_0x2ef862+_0x2a679a(0xc8));for(let _0x2ecf58=0x1;_0x2ecf58<=_0x2ef862;_0x2ecf58++){const _0x476754=setTimeout(async()=>{const _0x1ff35c=_0x2a679a;console['log'](_0x1ff35c(0xb2)+_0x9552e+'\x20status\x20check\x20#'+_0x2ecf58+'/'+_0x2ef862+_0x1ff35c(0x78)+_0x28e3cf);try{const _0x2af943=await this['checkPaymentStatus'](_0x4e339a,_0x3e49bb,_0x9552e);console[_0x1ff35c(0x194)](_0x1ff35c(0xf6)+_0x2ecf58+_0x1ff35c(0x89),_0x2af943),_0x2af943['final']&&(console[_0x1ff35c(0x194)]('âœ…\x20Payment\x20'+_0x28e3cf+_0x1ff35c(0xaa)+_0x2af943[_0x1ff35c(0x18c)]+_0x1ff35c(0x160)),this[_0x1ff35c(0x14b)](_0x28e3cf),await this[_0x1ff35c(0x19c)](_0x28e3cf,_0x2af943[_0x1ff35c(0x18c)],_0x2af943));}catch(_0x135419){console[_0x1ff35c(0xa3)](_0x1ff35c(0x196)+_0x2ecf58+_0x1ff35c(0x12e)+_0x28e3cf+':',_0x135419);}},_0x2ecf58*_0x2c2c92);_0x2f5ddb[_0x2a679a(0x120)](_0x476754);}this['statusCheckTimers'][_0x2a679a(0x153)](_0x28e3cf,_0x2f5ddb),console[_0x2a679a(0x194)]('âœ…\x20Scheduled\x20'+_0x2ef862+'\x20status\x20checks\x20for\x20payment\x20'+_0x28e3cf);}[a57_0x46a889(0x14b)](_0x24d439){const _0x148a93=a57_0x46a889,_0x570315=this[_0x148a93(0xfb)][_0x148a93(0x71)](_0x24d439);_0x570315&&(console[_0x148a93(0x194)](_0x148a93(0x10e)+_0x570315[_0x148a93(0xa4)]+_0x148a93(0x6b)+_0x24d439),_0x570315['forEach']((_0x1029cc,_0x580f03)=>{clearTimeout(_0x1029cc);}),this[_0x148a93(0xfb)][_0x148a93(0x10a)](_0x24d439));}async[a57_0x46a889(0x19c)](_0x1705ba,_0x9262e9,_0x5898f3){const _0xc4818c=a57_0x46a889;try{const _0x4a4c1a=(await Promise[_0xc4818c(0x16f)]()[_0xc4818c(0xf0)](()=>__importStar(require(_0xc4818c(0xb4)))))[_0xc4818c(0x189)],_0x215033={'status':_0x9262e9['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0xc4818c(0x11f),'statusChangedAt':new Date()};_0x9262e9===_0xc4818c(0x139)&&(_0x215033['paidAt']=new Date()),_0x9262e9==='FAILED'&&_0x5898f3[_0xc4818c(0xbc)]&&(_0x215033[_0xc4818c(0x103)]=_0x5898f3['description'],console['log'](_0xc4818c(0x159)+_0x5898f3['description'])),await _0x4a4c1a[_0xc4818c(0xa7)][_0xc4818c(0xe6)]({'where':{'id':_0x1705ba},'data':_0x215033}),console[_0xc4818c(0x194)](_0xc4818c(0x183)+_0x1705ba+_0xc4818c(0x175)+_0x9262e9),await this[_0xc4818c(0x116)](_0x1705ba,_0x9262e9);}catch(_0x13ad21){console[_0xc4818c(0xa3)](_0xc4818c(0x85)+_0x1705ba+':',_0x13ad21);}}async[a57_0x46a889(0x116)](_0x47c889,_0x44dee0){const _0x435f45=a57_0x46a889;try{const _0x23233b=(await Promise[_0x435f45(0x16f)]()[_0x435f45(0xf0)](()=>__importStar(require(_0x435f45(0xb4)))))[_0x435f45(0x189)],{telegramBotService:_0x20aa07}=await Promise[_0x435f45(0x16f)]()[_0x435f45(0xf0)](()=>__importStar(require('../telegramBotService'))),_0x4ebf41=await _0x23233b[_0x435f45(0xa7)][_0x435f45(0x74)]({'where':{'id':_0x47c889},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x4ebf41)return;const _0x18f5f7={'PAID':'paid','FAILED':'failed'},_0x5c75ba=_0x18f5f7[_0x44dee0];_0x5c75ba&&await _0x20aa07[_0x435f45(0x70)](_0x4ebf41[_0x435f45(0x15c)],_0x4ebf41,_0x5c75ba),await this[_0x435f45(0x72)](_0x4ebf41,_0x44dee0);}catch(_0x43e543){console[_0x435f45(0xa3)](_0x435f45(0x114),_0x43e543);}}async[a57_0x46a889(0x72)](_0x59c0e9,_0x4bc102){const _0x26ca85=a57_0x46a889,_0x1c04bd=Date['now']();try{const _0x2565ce=_0x59c0e9['shop'],_0x38db73=_0x2565ce[_0x26ca85(0x174)];if(!_0x38db73?.[_0x26ca85(0x9f)]){console['log'](_0x26ca85(0x1b1)+_0x2565ce['id']);return;}const _0x16ce4f=_0x4bc102===_0x26ca85(0x139)?_0x26ca85(0x135):_0x26ca85(0x18a);let _0x567923=[];if(_0x38db73[_0x26ca85(0x111)])try{_0x567923=Array['isArray'](_0x38db73[_0x26ca85(0x111)])?_0x38db73['webhookEvents']:JSON['parse'](_0x38db73['webhookEvents']);}catch(_0x5cfa44){console[_0x26ca85(0xa3)](_0x26ca85(0x157),_0x5cfa44),_0x567923=[];}if(!_0x567923[_0x26ca85(0x14f)](_0x16ce4f)){console[_0x26ca85(0x194)](_0x26ca85(0x164)+_0x16ce4f+_0x26ca85(0xc1)+_0x2565ce['id']);return;}const _0x33345e={'event':_0x16ce4f,'payment':{'id':_0x59c0e9['id'],'order_id':_0x59c0e9['orderId'],'gateway_order_id':_0x59c0e9['gatewayOrderId'],'gateway':_0x26ca85(0xc0),'amount':_0x59c0e9[_0x26ca85(0x15a)],'currency':_0x59c0e9[_0x26ca85(0x1b7)],'status':_0x4bc102[_0x26ca85(0x1a9)](),'customer_email':_0x59c0e9[_0x26ca85(0xde)],'customer_name':_0x59c0e9[_0x26ca85(0x13f)],'created_at':_0x59c0e9[_0x26ca85(0xa8)],'updated_at':new Date()}},_0x4c1ed8=await fetch(_0x38db73[_0x26ca85(0x9f)],{'method':_0x26ca85(0x19b),'headers':{'Content-Type':_0x26ca85(0x192),'User-Agent':_0x26ca85(0x1a6)},'body':JSON['stringify'](_0x33345e)}),_0x2646a1=Date['now']()-_0x1c04bd;loggerService_1[_0x26ca85(0xee)][_0x26ca85(0xd5)](_0x59c0e9['shopId'],_0x38db73[_0x26ca85(0x9f)],_0x16ce4f,_0x4c1ed8[_0x26ca85(0x18c)],_0x2646a1,_0x33345e),console[_0x26ca85(0x194)](_0x26ca85(0x129)+_0x38db73[_0x26ca85(0x9f)]+_0x26ca85(0x16e)+_0x4c1ed8['status']+'\x20('+_0x2646a1+_0x26ca85(0x73));}catch(_0x2dcb62){console['error'](_0x26ca85(0x90),_0x2dcb62),loggerService_1[_0x26ca85(0xee)][_0x26ca85(0xc4)](_0x59c0e9[_0x26ca85(0x15c)],_0x59c0e9[_0x26ca85(0xb0)]?.[_0x26ca85(0x174)]?.[_0x26ca85(0x9f)]||_0x26ca85(0x162),_0x26ca85(0x130),_0x2dcb62,{});}}['maskCardNumber'](_0x76edd7){const _0x2e11da=a57_0x46a889,_0x4f3086=_0x76edd7['replace'](/[\s-]/g,'');if(_0x4f3086[_0x2e11da(0xa4)]<0x4)return _0x2e11da(0x195);return'****\x20****\x20****\x20'+_0x4f3086[_0x2e11da(0x69)](-0x4);}async[a57_0x46a889(0xce)](_0x510570,_0x5bdd5e=a57_0x46a889(0x87)){const _0x31cb17=a57_0x46a889;console[_0x31cb17(0x194)](_0x31cb17(0x187),JSON['stringify'](_0x510570,null,0x2));let _0x572281=_0x510570,_0x1bf57d=_0x5bdd5e;_0x510570['card_type']?(_0x1bf57d=_0x510570[_0x31cb17(0xdf)][_0x31cb17(0xb7)]()==='VISA'?'VISA':_0x31cb17(0x87),console['log']('ðŸ”\x20Detected\x20card\x20type\x20from\x20webhook:\x20'+_0x1bf57d)):console['log'](_0x31cb17(0x17f)+_0x1bf57d);if(_0x510570[_0x31cb17(0xc5)]&&_0x510570['key']&&_0x510570[_0x31cb17(0x12f)]){console[_0x31cb17(0x194)](_0x31cb17(0x102));try{const _0x5d45ca=await this[_0x31cb17(0x1a1)](_0x510570[_0x31cb17(0xc5)],_0x510570[_0x31cb17(0x6a)],_0x1bf57d);_0x572281=JSON['parse'](_0x5d45ca),console[_0x31cb17(0x194)](_0x31cb17(0x171)),console[_0x31cb17(0x194)]('ðŸ“\x20Decrypted\x20webhook\x20data:',JSON['stringify'](_0x572281,null,0x2));}catch(_0x18e1f4){console[_0x31cb17(0xa3)](_0x31cb17(0xb6),_0x18e1f4),console[_0x31cb17(0x194)]('âš ï¸\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted'),_0x572281=_0x510570;}}else console['log'](_0x31cb17(0xa2));let _0x2c3801=_0x31cb17(0x155);if(_0x572281[_0x31cb17(0x18c)]===0x64&&_0x572281[_0x31cb17(0x81)]===0x1)_0x2c3801=_0x31cb17(0x139);else{if(_0x572281[_0x31cb17(0x81)]===0x0||!this[_0x31cb17(0x191)](_0x572281[_0x31cb17(0x18c)]))_0x2c3801=_0x31cb17(0x155);else _0x572281[_0x31cb17(0x81)]===0x1||this['isFinalStatus'](_0x572281[_0x31cb17(0x18c)])?_0x2c3801=_0x31cb17(0x6e):_0x2c3801='PENDING';}let _0x31d116='';if(_0x572281[_0x31cb17(0xb1)])_0x31d116=_0x572281[_0x31cb17(0xb1)][_0x31cb17(0xc7)](),console[_0x31cb17(0x194)]('ðŸ”\x20Using\x20'+_0x1bf57d+'\x20order_id\x20for\x20search:\x20'+_0x31d116);else _0x572281['payment_id']?(_0x31d116=_0x572281[_0x31cb17(0x125)][_0x31cb17(0xc7)](),console[_0x31cb17(0x194)]('ðŸ”\x20Using\x20'+_0x1bf57d+_0x31cb17(0x8c)+_0x31d116)):(_0x31d116=_0x572281[_0x31cb17(0x19a)]||_0x572281[_0x31cb17(0x128)]||_0x572281['id']||'',console[_0x31cb17(0x194)](_0x31cb17(0x12a)+_0x31d116));console[_0x31cb17(0x194)]('ðŸ“Š\x20'+_0x1bf57d+_0x31cb17(0x1a4)),console['log'](_0x31cb17(0x15b)+_0x31d116+'\x20(from:\x20order_id='+_0x572281[_0x31cb17(0xb1)]+',\x20orderId='+_0x572281[_0x31cb17(0x19a)]+_0x31cb17(0x8d)+_0x572281[_0x31cb17(0x125)]+_0x31cb17(0x14a)+_0x572281[_0x31cb17(0x128)]+_0x31cb17(0x151)+_0x572281['id']+')'),console[_0x31cb17(0x194)]('\x20\x20\x20Status:\x20'+_0x2c3801+_0x31cb17(0x10f)+_0x572281[_0x31cb17(0x18c)]+_0x31cb17(0xcb)+_0x572281[_0x31cb17(0x81)]+')'),console[_0x31cb17(0x194)]('\x20\x20\x20Amount:\x20'+_0x572281[_0x31cb17(0x15a)]),console['log'](_0x31cb17(0x1ad)+_0x572281[_0x31cb17(0x1b7)]);let _0xe6c1c4;_0x2c3801===_0x31cb17(0x6e)&&(_0xe6c1c4=this[_0x31cb17(0x18b)](_0x572281['status'],_0x572281[_0x31cb17(0x126)]),console['log'](_0x31cb17(0xfc)+_0xe6c1c4));const _0x2cdc10={'paymentId':_0x31d116,'status':_0x2c3801,'amount':_0x572281[_0x31cb17(0x15a)],'currency':_0x572281[_0x31cb17(0x1b7)]};return _0xe6c1c4&&(_0x2cdc10['errorMessage']=_0xe6c1c4),_0x2cdc10;}[a57_0x46a889(0x163)](){const _0x5406f4=a57_0x46a889;console[_0x5406f4(0x194)](_0x5406f4(0xbd));const _0x1bf7fe=this[_0x5406f4(0xfb)]['size'];for(const [_0x113df4]of this['statusCheckTimers']){this[_0x5406f4(0x14b)](_0x113df4);}console[_0x5406f4(0x194)](_0x5406f4(0x79)+_0x1bf7fe+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a57_0x46a889(0x1b4)]=VisaMasterCardService;