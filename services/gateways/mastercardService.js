'use strict';const a42_0x1164de=a42_0x297c;(function(_0x2e3543,_0x50f286){const _0x241518=a42_0x297c,_0x3441c8=_0x2e3543();while(!![]){try{const _0x151cb9=parseInt(_0x241518(0x10c))/0x1+parseInt(_0x241518(0x105))/0x2+parseInt(_0x241518(0xb5))/0x3*(-parseInt(_0x241518(0x12d))/0x4)+parseInt(_0x241518(0x100))/0x5+parseInt(_0x241518(0xf2))/0x6+-parseInt(_0x241518(0xe9))/0x7+parseInt(_0x241518(0x142))/0x8*(-parseInt(_0x241518(0xe1))/0x9);if(_0x151cb9===_0x50f286)break;else _0x3441c8['push'](_0x3441c8['shift']());}catch(_0x477807){_0x3441c8['push'](_0x3441c8['shift']());}}}(a42_0x3c04,0xa2270));var __createBinding=this&&this[a42_0x1164de(0x152)]||(Object[a42_0x1164de(0xbe)]?function(_0x324566,_0x163124,_0x3e728e,_0x20911a){const _0x48c9a7=a42_0x1164de;if(_0x20911a===undefined)_0x20911a=_0x3e728e;var _0x402134=Object[_0x48c9a7(0x112)](_0x163124,_0x3e728e);(!_0x402134||('get'in _0x402134?!_0x163124[_0x48c9a7(0x115)]:_0x402134[_0x48c9a7(0x144)]||_0x402134[_0x48c9a7(0xa3)]))&&(_0x402134={'enumerable':!![],'get':function(){return _0x163124[_0x3e728e];}}),Object['defineProperty'](_0x324566,_0x20911a,_0x402134);}:function(_0x41e9bc,_0x1d3d53,_0x2c58ff,_0x75d167){if(_0x75d167===undefined)_0x75d167=_0x2c58ff;_0x41e9bc[_0x75d167]=_0x1d3d53[_0x2c58ff];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a42_0x1164de(0xbe)]?function(_0x2d6819,_0x2e9cbf){const _0x1c538b=a42_0x1164de;Object[_0x1c538b(0x90)](_0x2d6819,'default',{'enumerable':!![],'value':_0x2e9cbf});}:function(_0x1c5ad1,_0x2ab9a2){const _0x2d6388=a42_0x1164de;_0x1c5ad1[_0x2d6388(0xf0)]=_0x2ab9a2;}),__importStar=this&&this['__importStar']||(function(){var _0x1a3efe=function(_0x1940c3){const _0x2e0617=a42_0x297c;return _0x1a3efe=Object[_0x2e0617(0x156)]||function(_0x1ece4b){const _0x2180a9=_0x2e0617;var _0x40c6f8=[];for(var _0x2a92e2 in _0x1ece4b)if(Object[_0x2180a9(0xc1)][_0x2180a9(0x11e)]['call'](_0x1ece4b,_0x2a92e2))_0x40c6f8[_0x40c6f8[_0x2180a9(0x132)]]=_0x2a92e2;return _0x40c6f8;},_0x1a3efe(_0x1940c3);};return function(_0x4ce7c9){const _0x1df485=a42_0x297c;if(_0x4ce7c9&&_0x4ce7c9[_0x1df485(0x115)])return _0x4ce7c9;var _0x363538={};if(_0x4ce7c9!=null){for(var _0x1a34d6=_0x1a3efe(_0x4ce7c9),_0x2d1062=0x0;_0x2d1062<_0x1a34d6[_0x1df485(0x132)];_0x2d1062++)if(_0x1a34d6[_0x2d1062]!==_0x1df485(0xf0))__createBinding(_0x363538,_0x4ce7c9,_0x1a34d6[_0x2d1062]);}return __setModuleDefault(_0x363538,_0x4ce7c9),_0x363538;};}()),__importDefault=this&&this[a42_0x1164de(0xbd)]||function(_0x58e7df){const _0x15e547=a42_0x1164de;return _0x58e7df&&_0x58e7df[_0x15e547(0x115)]?_0x58e7df:{'default':_0x58e7df};};Object['defineProperty'](exports,a42_0x1164de(0x115),{'value':!![]}),exports[a42_0x1164de(0x120)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a42_0x1164de(0xc8));function a42_0x297c(_0x14ad3c,_0x2937d7){const _0x3c044d=a42_0x3c04();return a42_0x297c=function(_0x297ccb,_0x2118c2){_0x297ccb=_0x297ccb-0x90;let _0x26d685=_0x3c044d[_0x297ccb];return _0x26d685;},a42_0x297c(_0x14ad3c,_0x2937d7);}function a42_0x3c04(){const _0x5d6a0d=['__importDefault','create','1111','\x20for\x20payment\x20','prototype','\x20status\x20timers\x20for\x20payment\x20','Response\x20Time:','push','❌\x20Status\x20check\x20#','expire_month','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','../loggerService','first_name','settings','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','logWhiteDomainResponse','scheduleStatusChecks','❌\x20Response\x20decryption\x20failed:','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','webhookEvents','****','paid','publicEncrypt','createCipher','date_success','resolve','stopAllStatusChecks','HTTP\x20error!\x20status:\x20','../telegramBotService','key','maskCardNumber','Return\x20URL:','Card\x20Number:','number','desc','cwd','9YpqBLN','mastercard','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','Result\x20URL:','final','gatewayOrderId','decryptResponse','1321859NuqITW','text','processWebhook','cvv','processCardPayment','stringify','from','default','✅\x20Response\x20decrypted\x20successfully','907290bESKUJ','TesSoft\x20Payment\x20System/1.0','payment.failed','Failed\x20to\x20decrypt\x20response','then','\x20failed\x20for\x20payment\x20','replace','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','🔐\x20Data\x20signed\x20with\x20RSA','Payment\x20ID:','Processing\x20MasterCard\x20webhook:','🔐\x20Data\x20encrypted\x20with\x20AES','ms)','MasterCard\x20webhook\x20sent\x20to\x20','1452150KaQdAm','clearStatusTimers','keys','readFileSync','constants','2261174EblHmv','sendShopWebhook','FAILED','💾\x20Payment\x20data\x20prepared','Unknown\x20error','payment_id','\x20result:','711800ZlvvEC','payment','application/json','updatePaymentStatus','system','🔐\x203DS\x20verification\x20required','getOwnPropertyDescriptor','Order\x20ID:','apiUrl','__esModule','../../config/database','POST','loggerService','floor','✅\x20Payment\x20','MasterCard:\x20','toString','🛑\x20Stopped\x20','hasOwnProperty','🔐\x20AES\x20key\x20and\x20IV\x20generated','MasterCardService','****\x20****\x20****\x20','\x20MasterCard\x20status\x20check\x20timers','logWhiteDomainRequest','publicKeyPath','❌\x20Payment\x20failed\x20or\x20declined','payment.success','RSA_PKCS1_PADDING','Response\x20Body:','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','💳\x20MasterCard\x20service\x20initialized','Failed\x20to\x20send\x20payment\x20notifications:','expire_year','512UShLwr','forEach','createDecipher','❌\x20Failed\x20to\x20decrypt\x20response:','paidAt','length','✅\x20Scheduled\x20','private.pem','parse','🔍\x20MasterCard\x20status\x20check\x20#','logWhiteDomainError','join','https://api.psp-release.net/api','orderId','error','3ds_url','sign','✅\x20Status\x20response\x20decrypted\x20successfully','Error\x20details:','privateKeyPath','aes-256-ctr','8703832WlsbHC','logShopWebhookSent','writable','set',',\x20body:\x20','customerEmail','encryptAES','merchantPointId','PENDING','log','3DS\x20URL:','amount','Final:','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','shopId','status','__createBinding','update','json','slice','getOwnPropertyNames','decryptAES','description','defineProperty','webhookUrl','sendPaymentNotifications','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','isArray','base64','size','encryptRSA','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','/status','✅\x20Payment\x20successful\x20without\x203DS','generateAESKey','info','delete','none','\x20status\x20checks\x20for\x20payment\x20','Webhook\x20event\x20','/charge','toUpperCase','configurable','get','\x20not\x20enabled\x20for\x20shop\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','Status:','last_name','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','signRSA','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','order_id','currency','message','utf8','❌\x20RSA\x20signing\x20failed:','randomBytes','),\x20stopping\x20status\x20checks','PAID','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','8040UWnDKZ','\x20with\x20status\x20','statusCheckTimers','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','now','checkPaymentStatus','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','SHA256'];a42_0x3c04=function(){return _0x5d6a0d;};return a42_0x3c04();}class MasterCardService{constructor(){const _0x53f90f=a42_0x1164de;this[_0x53f90f(0xb7)]=new Map(),this[_0x53f90f(0x114)]=_0x53f90f(0x139),this['merchantPointId']=0x3e8,this[_0x53f90f(0x140)]=path_1[_0x53f90f(0xf0)][_0x53f90f(0x138)](process[_0x53f90f(0xe0)](),_0x53f90f(0x102),_0x53f90f(0x134)),this[_0x53f90f(0x124)]=path_1[_0x53f90f(0xf0)][_0x53f90f(0x138)](process['cwd'](),_0x53f90f(0x102),'psp_public.pem'),console[_0x53f90f(0x14b)](_0x53f90f(0x12a)),console[_0x53f90f(0x14b)]('🔐\x20Private\x20key\x20path:',this['privateKeyPath']),console['log']('🔐\x20Public\x20key\x20path:',this[_0x53f90f(0x124)]);}[a42_0x1164de(0x9b)](){const _0x1d4c2c=a42_0x1164de,_0x30cee2=crypto_1[_0x1d4c2c(0xf0)][_0x1d4c2c(0xb1)](0x20),_0x2c6655=crypto_1[_0x1d4c2c(0xf0)][_0x1d4c2c(0xb1)](0x10);return{'key':_0x30cee2,'iv':_0x2c6655};}[a42_0x1164de(0x148)](_0x2404e5,_0x25c974,_0x32e73a){const _0x3a5215=a42_0x1164de,_0x4b1899=crypto_1[_0x3a5215(0xf0)][_0x3a5215(0xd4)](_0x3a5215(0x141),_0x25c974);let _0x5d3f05=_0x4b1899[_0x3a5215(0x153)](_0x2404e5,'utf8',_0x3a5215(0x95));return _0x5d3f05+=_0x4b1899[_0x3a5215(0xe6)](_0x3a5215(0x95)),_0x5d3f05;}[a42_0x1164de(0x97)](_0x26ff7e,_0x3b85e5){const _0x1c4a00=a42_0x1164de;try{const _0x5c37b5=fs_1[_0x1c4a00(0xf0)][_0x1c4a00(0x103)](this['publicKeyPath'],_0x1c4a00(0xaf)),_0xb5373d={'iv':_0x3b85e5[_0x1c4a00(0x11c)](_0x1c4a00(0x95)),'key':_0x26ff7e['toString']('base64')},_0x495106=JSON['stringify'](_0xb5373d),_0x1245bd=crypto_1[_0x1c4a00(0xf0)][_0x1c4a00(0xd3)]({'key':_0x5c37b5,'padding':crypto_1[_0x1c4a00(0xf0)][_0x1c4a00(0x104)][_0x1c4a00(0x127)]},Buffer['from'](_0x495106));return _0x1245bd[_0x1c4a00(0x11c)](_0x1c4a00(0x95));}catch(_0x54b4aa){console[_0x1c4a00(0x13b)]('❌\x20RSA\x20encryption\x20failed:',_0x54b4aa);throw new Error(_0x1c4a00(0xab));}}[a42_0x1164de(0xaa)](_0x5d452f){const _0x4d3add=a42_0x1164de;try{const _0x500e82=fs_1['default'][_0x4d3add(0x103)](this[_0x4d3add(0x140)],_0x4d3add(0xaf)),_0x2350d8=crypto_1[_0x4d3add(0xf0)]['createSign'](_0x4d3add(0xbc));_0x2350d8[_0x4d3add(0x153)](_0x5d452f);const _0x401d7c=_0x2350d8[_0x4d3add(0x13d)](_0x500e82,_0x4d3add(0x95));return _0x401d7c;}catch(_0x1eb9e2){console[_0x4d3add(0x13b)](_0x4d3add(0xb0),_0x1eb9e2);throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}[a42_0x1164de(0x157)](_0x3e6b23,_0x1f5dfd,_0x3f7ef9){const _0x121a7f=a42_0x1164de,_0x349801=crypto_1[_0x121a7f(0xf0)][_0x121a7f(0x12f)](_0x121a7f(0x141),_0x1f5dfd);let _0x39b8a8=_0x349801[_0x121a7f(0x153)](_0x3e6b23,_0x121a7f(0x95),'utf8');return _0x39b8a8+=_0x349801[_0x121a7f(0xe6)](_0x121a7f(0xaf)),_0x39b8a8;}['decryptResponse'](_0xeec18b,_0x529d2b){const _0x40fd3c=a42_0x1164de;try{const _0x453d9f=fs_1['default'][_0x40fd3c(0x103)](this['privateKeyPath'],_0x40fd3c(0xaf)),_0x401814=crypto_1[_0x40fd3c(0xf0)]['privateDecrypt']({'key':_0x453d9f,'padding':crypto_1['default'][_0x40fd3c(0x104)][_0x40fd3c(0x127)]},Buffer[_0x40fd3c(0xef)](_0x529d2b,_0x40fd3c(0x95))),_0x2ddd98=JSON['parse'](_0x401814[_0x40fd3c(0x11c)]()),_0x40c929=Buffer[_0x40fd3c(0xef)](_0x2ddd98[_0x40fd3c(0xda)],'base64'),_0x400d74=Buffer[_0x40fd3c(0xef)](_0x2ddd98['iv'],_0x40fd3c(0x95));return this[_0x40fd3c(0x157)](_0xeec18b,_0x40c929,_0x400d74);}catch(_0x438eff){console[_0x40fd3c(0x13b)](_0x40fd3c(0xce),_0x438eff);throw new Error(_0x40fd3c(0xf5));}}async[a42_0x1164de(0xed)](_0x4ba6ec){const _0x96ce6a=a42_0x1164de,{paymentId:_0x4cba57,orderId:_0x39788f,amount:_0x2ace30,currency:_0x450fb0,cardData:_0x1cf855,resultUrl:_0x55f961,returnUrl:_0x9dd2c7,cardHolder:_0x7390fa,browser:_0xb81a30}=_0x4ba6ec;console['log'](_0x96ce6a(0xcf)),console['log'](_0x96ce6a(0xfb),_0x4cba57),console[_0x96ce6a(0x14b)](_0x96ce6a(0x113),_0x39788f),console[_0x96ce6a(0x14b)]('Amount:',_0x2ace30,_0x450fb0),console[_0x96ce6a(0x14b)](_0x96ce6a(0xdd),this[_0x96ce6a(0xdb)](_0x1cf855[_0x96ce6a(0xde)])),console['log']('Card\x20Holder:',_0x7390fa[_0x96ce6a(0xc9)]+'\x20'+_0x7390fa[_0x96ce6a(0xa8)]),console[_0x96ce6a(0x14b)](_0x96ce6a(0xdc),_0x9dd2c7),console[_0x96ce6a(0x14b)](_0x96ce6a(0xe5),_0x55f961);const _0x389157={'amount':_0x2ace30,'currency':_0x450fb0[_0x96ce6a(0xa2)](),'order_id':_0x39788f,'result_url':_0x55f961,'return_url':_0x9dd2c7,'card':{'number':_0x1cf855[_0x96ce6a(0xde)],'expire_month':_0x1cf855[_0x96ce6a(0xc6)],'expire_year':_0x1cf855[_0x96ce6a(0x12c)],'cvv':_0x1cf855[_0x96ce6a(0xec)]},'card_holder':_0x7390fa,'browser':_0xb81a30},_0x33cec5=JSON[_0x96ce6a(0xee)](_0x389157);console[_0x96ce6a(0x14b)](_0x96ce6a(0x108));try{const {key:_0x16fd5a,iv:_0xd019be}=this[_0x96ce6a(0x9b)]();console[_0x96ce6a(0x14b)](_0x96ce6a(0x11f));const _0x140d41=this[_0x96ce6a(0x148)](_0x33cec5,_0x16fd5a,_0xd019be);console['log'](_0x96ce6a(0xfd));const _0x3773df=this[_0x96ce6a(0x97)](_0x16fd5a,_0xd019be);console[_0x96ce6a(0x14b)](_0x96ce6a(0xbb));const _0x2e0aad=this[_0x96ce6a(0xaa)](_0x33cec5);console['log'](_0x96ce6a(0xfa));const _0x43d7dc={'merchant_point_id':this[_0x96ce6a(0x149)],'method':'charge','info':_0x140d41,'key':_0x3773df,'sign':_0x2e0aad,'lang':'en'};console[_0x96ce6a(0x14b)]('📤\x20Sending\x20request\x20to\x20MasterCard\x20API...'),loggerService_1[_0x96ce6a(0x118)][_0x96ce6a(0x123)](_0x96ce6a(0xe2),_0x96ce6a(0xa1),_0x96ce6a(0x117),{'merchant_point_id':this[_0x96ce6a(0x149)],'method':'charge','lang':'en'});const _0x26b6b5=Date[_0x96ce6a(0xb9)](),_0x1efd10=await fetch(this[_0x96ce6a(0x114)],{'method':_0x96ce6a(0x117),'headers':{'Content-Type':_0x96ce6a(0x10e),'Accept':_0x96ce6a(0x10e),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x96ce6a(0xee)](_0x43d7dc)}),_0x39e2f0=Date[_0x96ce6a(0xb9)]()-_0x26b6b5;console[_0x96ce6a(0x14b)](_0x96ce6a(0xc7)),console['log'](_0x96ce6a(0xa7),_0x1efd10[_0x96ce6a(0x151)]),console[_0x96ce6a(0x14b)](_0x96ce6a(0xc3),_0x39e2f0+'ms');if(!_0x1efd10['ok']){const _0x18f262=await _0x1efd10[_0x96ce6a(0xea)]();console['error']('HTTP\x20Status:',_0x1efd10[_0x96ce6a(0x151)]),console[_0x96ce6a(0x13b)](_0x96ce6a(0x128),_0x18f262),loggerService_1['loggerService'][_0x96ce6a(0xcc)](_0x96ce6a(0xe2),'/charge',_0x1efd10['status'],_0x18f262,_0x39e2f0),loggerService_1['loggerService'][_0x96ce6a(0x137)](_0x96ce6a(0xe2),_0x96ce6a(0xa1),'HTTP\x20'+_0x1efd10[_0x96ce6a(0x151)]+':\x20'+_0x18f262);throw new Error(_0x96ce6a(0xd8)+_0x1efd10['status']+_0x96ce6a(0x146)+_0x18f262);}const _0x2ece52=await _0x1efd10[_0x96ce6a(0x154)]();console['log'](_0x96ce6a(0xf9));let _0x5bb55d=_0x2ece52;if(_0x2ece52[_0x96ce6a(0x9c)]&&_0x2ece52[_0x96ce6a(0xda)]&&_0x2ece52[_0x96ce6a(0x13d)]){console[_0x96ce6a(0x14b)](_0x96ce6a(0x93));try{const _0x546fd2=this[_0x96ce6a(0xe8)](_0x2ece52['info'],_0x2ece52['key']);_0x5bb55d=JSON['parse'](_0x546fd2),console[_0x96ce6a(0x14b)](_0x96ce6a(0xf1));}catch(_0x14c1bb){console['error'](_0x96ce6a(0x130),_0x14c1bb),_0x5bb55d=_0x2ece52;}}console['log'](_0x96ce6a(0xa7),_0x5bb55d[_0x96ce6a(0x151)]),console[_0x96ce6a(0x14b)](_0x96ce6a(0x14e),_0x5bb55d[_0x96ce6a(0xe6)]),console[_0x96ce6a(0x14b)]('Payment\x20ID:',_0x5bb55d[_0x96ce6a(0x10a)]),console[_0x96ce6a(0x14b)](_0x96ce6a(0x14c),_0x5bb55d[_0x96ce6a(0x13c)]||_0x96ce6a(0x9e)),loggerService_1[_0x96ce6a(0x118)][_0x96ce6a(0xcc)](_0x96ce6a(0xe2),'/charge',_0x1efd10[_0x96ce6a(0x151)],_0x5bb55d,_0x39e2f0);if(_0x5bb55d['status']===0x1&&_0x5bb55d[_0x96ce6a(0xe6)]===0x1)return console[_0x96ce6a(0x14b)](_0x96ce6a(0x9a)),{'gateway_payment_id':_0x5bb55d[_0x96ce6a(0x10a)]?.[_0x96ce6a(0x11c)](),'payment_url':_0x9dd2c7,'requires_3ds':![],'status':_0x96ce6a(0xb3),'final':!![]};else return _0x5bb55d[_0x96ce6a(0x13c)]?(console[_0x96ce6a(0x14b)](_0x96ce6a(0x111)),this[_0x96ce6a(0xcd)](_0x4cba57,_0x39788f,_0x5bb55d[_0x96ce6a(0x10a)]?.[_0x96ce6a(0x11c)]()||_0x39788f),{'gateway_payment_id':_0x5bb55d[_0x96ce6a(0x10a)]?.[_0x96ce6a(0x11c)](),'payment_url':_0x5bb55d[_0x96ce6a(0x13c)],'requires_3ds':!![],'threeds_url':_0x5bb55d[_0x96ce6a(0x13c)],'status':_0x96ce6a(0x14a),'final':![]}):(console[_0x96ce6a(0x14b)](_0x96ce6a(0x125)),{'gateway_payment_id':_0x5bb55d[_0x96ce6a(0x10a)]?.['toString'](),'payment_url':_0x9dd2c7,'requires_3ds':![],'status':_0x96ce6a(0x107),'final':!![]});}catch(_0x20fb40){console['error'](_0x96ce6a(0x14f)),console[_0x96ce6a(0x13b)](_0x96ce6a(0x13f),_0x20fb40),loggerService_1[_0x96ce6a(0x118)]['logWhiteDomainError'](_0x96ce6a(0xe2),_0x96ce6a(0xa1),_0x20fb40);throw new Error(_0x96ce6a(0xcb)+(_0x20fb40 instanceof Error?_0x20fb40[_0x96ce6a(0xae)]:'Unknown\x20error'));}}async[a42_0x1164de(0xba)](_0x373081,_0x4f3d09){const _0x16c387=a42_0x1164de;console[_0x16c387(0x14b)](_0x16c387(0xe4)+_0x373081+'\x20('+_0x4f3d09+')');try{const _0x5c8b31={'payment_id':_0x373081,'order_id':_0x4f3d09},_0x32d288=JSON['stringify'](_0x5c8b31),{key:_0x25c2dc,iv:_0x42ee91}=this[_0x16c387(0x9b)](),_0x3a2a95=this[_0x16c387(0x148)](_0x32d288,_0x25c2dc,_0x42ee91),_0x3a381d=this[_0x16c387(0x97)](_0x25c2dc,_0x42ee91),_0x4a6f0f=this['signRSA'](_0x32d288),_0x373082={'merchant_point_id':this[_0x16c387(0x149)],'method':_0x16c387(0x151),'info':_0x3a2a95,'key':_0x3a381d,'sign':_0x4a6f0f,'lang':'en'};loggerService_1[_0x16c387(0x118)]['logWhiteDomainRequest'](_0x16c387(0xe2),_0x16c387(0x99),_0x16c387(0x117),{'merchant_point_id':this['merchantPointId'],'method':'status','lang':'en'});const _0x37fb09=Date[_0x16c387(0xb9)](),_0x404718=await fetch(this[_0x16c387(0x114)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x16c387(0x10e),'User-Agent':_0x16c387(0xf3)},'body':JSON['stringify'](_0x373082)}),_0x1e748b=Date[_0x16c387(0xb9)]()-_0x37fb09;if(!_0x404718['ok']){const _0x5d7820=await _0x404718[_0x16c387(0xea)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x16c387(0xe2),'/status',_0x404718[_0x16c387(0x151)],_0x5d7820,_0x1e748b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x404718['status']);}const _0x4d67cc=await _0x404718[_0x16c387(0x154)]();let _0xed5a2e=_0x4d67cc;if(_0x4d67cc[_0x16c387(0x9c)]&&_0x4d67cc[_0x16c387(0xda)]&&_0x4d67cc[_0x16c387(0x13d)]){console[_0x16c387(0x14b)](_0x16c387(0xe3));try{const _0x1bf0bb=this['decryptResponse'](_0x4d67cc[_0x16c387(0x9c)],_0x4d67cc[_0x16c387(0xda)]);_0xed5a2e=JSON[_0x16c387(0x135)](_0x1bf0bb),console[_0x16c387(0x14b)](_0x16c387(0x13e));}catch(_0x4e08a6){console[_0x16c387(0x13b)](_0x16c387(0x98),_0x4e08a6),_0xed5a2e=_0x4d67cc;}}loggerService_1['loggerService'][_0x16c387(0xcc)](_0x16c387(0xe2),'/status',_0x404718[_0x16c387(0x151)],_0x4d67cc,_0x1e748b),console[_0x16c387(0x14b)]('📊\x20Status\x20check\x20result:',{'status':_0xed5a2e[_0x16c387(0x151)],'final':_0xed5a2e[_0x16c387(0xe6)],'payment_id':_0xed5a2e['payment_id'],'desc':_0xed5a2e[_0x16c387(0xdf)]});let _0x2605ef='PENDING';if(_0xed5a2e['status']===0x1&&_0xed5a2e[_0x16c387(0xe6)]===0x1)_0x2605ef='PAID';else _0xed5a2e[_0x16c387(0x151)]===0x0&&_0xed5a2e['final']===0x0?_0x2605ef=_0x16c387(0x14a):_0x2605ef=_0x16c387(0x107);return{'status':_0x2605ef,'final':_0xed5a2e[_0x16c387(0xe6)]===0x1,'amount':_0xed5a2e[_0x16c387(0x14d)],'currency':_0xed5a2e['currency'],'date_success':_0xed5a2e[_0x16c387(0xd5)],'description':_0xed5a2e[_0x16c387(0xdf)]};}catch(_0x1373cd){console[_0x16c387(0x13b)]('MasterCard\x20status\x20check\x20error:',_0x1373cd),loggerService_1[_0x16c387(0x118)][_0x16c387(0x137)]('mastercard',_0x16c387(0x99),_0x1373cd);throw new Error('Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20'+(_0x1373cd instanceof Error?_0x1373cd['message']:_0x16c387(0x109)));}}[a42_0x1164de(0xcd)](_0x107048,_0x4ea2cc,_0x33a3fd){const _0xb9221f=a42_0x1164de;console[_0xb9221f(0x14b)](_0xb9221f(0x129)+_0x107048+'\x20('+_0x33a3fd+')'),this[_0xb9221f(0x101)](_0x107048);const _0x39275d=[],_0xc41645=0x5*0x3c*0x3e8,_0x252d13=0x2*0x3c*0x3c*0x3e8,_0x2ca956=Math[_0xb9221f(0x119)](_0x252d13/_0xc41645);console[_0xb9221f(0x14b)]('⏰\x20Will\x20check\x20status\x20'+_0x2ca956+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x1fab41=0x1;_0x1fab41<=_0x2ca956;_0x1fab41++){const _0x190443=setTimeout(async()=>{const _0x5b189d=_0xb9221f;console['log'](_0x5b189d(0x136)+_0x1fab41+'/'+_0x2ca956+_0x5b189d(0xc0)+_0x107048);try{const _0x3d3681=await this['checkPaymentStatus'](_0x33a3fd,_0x4ea2cc);console[_0x5b189d(0x14b)]('📊\x20Status\x20check\x20#'+_0x1fab41+_0x5b189d(0x10b),_0x3d3681),_0x3d3681[_0x5b189d(0xe6)]&&(console[_0x5b189d(0x14b)](_0x5b189d(0x11a)+_0x107048+'\x20is\x20final\x20('+_0x3d3681[_0x5b189d(0x151)]+_0x5b189d(0xb2)),this[_0x5b189d(0x101)](_0x107048),await this[_0x5b189d(0x10f)](_0x107048,_0x3d3681[_0x5b189d(0x151)],_0x3d3681));}catch(_0x23313c){console[_0x5b189d(0x13b)](_0x5b189d(0xc5)+_0x1fab41+_0x5b189d(0xf7)+_0x107048+':',_0x23313c);}},_0x1fab41*_0xc41645);_0x39275d[_0xb9221f(0xc4)](_0x190443);}this[_0xb9221f(0xb7)][_0xb9221f(0x145)](_0x107048,_0x39275d),console['log'](_0xb9221f(0x133)+_0x2ca956+_0xb9221f(0x9f)+_0x107048);}[a42_0x1164de(0x101)](_0x4033d1){const _0x513a4f=a42_0x1164de,_0x5c60a8=this[_0x513a4f(0xb7)][_0x513a4f(0xa4)](_0x4033d1);_0x5c60a8&&(console[_0x513a4f(0x14b)]('🧹\x20Clearing\x20'+_0x5c60a8[_0x513a4f(0x132)]+_0x513a4f(0xc2)+_0x4033d1),_0x5c60a8[_0x513a4f(0x12e)]((_0x63b7d6,_0x5c2601)=>{clearTimeout(_0x63b7d6);}),this[_0x513a4f(0xb7)][_0x513a4f(0x9d)](_0x4033d1));}async['updatePaymentStatus'](_0x5f296f,_0x47d364,_0x51d404){const _0x744f64=a42_0x1164de;try{const _0x2dd308=(await Promise[_0x744f64(0xd6)]()['then'](()=>__importStar(require(_0x744f64(0x116)))))['default'],_0x34f0b0={'status':_0x47d364[_0x744f64(0xa2)](),'updatedAt':new Date(),'statusChangedBy':_0x744f64(0x110),'statusChangedAt':new Date()};_0x47d364===_0x744f64(0xb3)&&(_0x34f0b0[_0x744f64(0x131)]=new Date()),_0x51d404[_0x744f64(0x158)]&&(_0x34f0b0['adminNotes']=_0x744f64(0x11b)+_0x51d404[_0x744f64(0x158)]),await _0x2dd308[_0x744f64(0x10d)][_0x744f64(0x153)]({'where':{'id':_0x5f296f},'data':_0x34f0b0}),console[_0x744f64(0x14b)](_0x744f64(0x11a)+_0x5f296f+'\x20status\x20updated\x20to\x20'+_0x47d364),await this['sendPaymentNotifications'](_0x5f296f,_0x47d364);}catch(_0x599ec3){console[_0x744f64(0x13b)](_0x744f64(0xb4)+_0x5f296f+':',_0x599ec3);}}async[a42_0x1164de(0x92)](_0x2b925c,_0x20c0d0){const _0x19210a=a42_0x1164de;try{const _0x16d5d8=(await Promise[_0x19210a(0xd6)]()['then'](()=>__importStar(require(_0x19210a(0x116)))))[_0x19210a(0xf0)],{telegramBotService:_0x5d3ed4}=await Promise['resolve']()[_0x19210a(0xf6)](()=>__importStar(require(_0x19210a(0xd9)))),_0x2c0563=await _0x16d5d8[_0x19210a(0x10d)]['findUnique']({'where':{'id':_0x2b925c},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x2c0563)return;const _0x5026cc={'PAID':_0x19210a(0xd2),'FAILED':'failed'},_0xb97f34=_0x5026cc[_0x20c0d0];_0xb97f34&&await _0x5d3ed4['sendPaymentNotification'](_0x2c0563[_0x19210a(0x150)],_0x2c0563,_0xb97f34),await this[_0x19210a(0x106)](_0x2c0563,_0x20c0d0);}catch(_0x3b86f1){console['error'](_0x19210a(0x12b),_0x3b86f1);}}async['sendShopWebhook'](_0x34a839,_0x28881c){const _0xc99bc6=a42_0x1164de,_0xa18500=Date['now']();try{const _0x301d16=_0x34a839['shop'],_0xcd6214=_0x301d16[_0xc99bc6(0xca)];if(!_0xcd6214?.[_0xc99bc6(0x91)]){console[_0xc99bc6(0x14b)](_0xc99bc6(0xa6)+_0x301d16['id']);return;}const _0x97620=_0x28881c==='PAID'?_0xc99bc6(0x126):_0xc99bc6(0xf4);let _0xc27e0d=[];if(_0xcd6214['webhookEvents'])try{_0xc27e0d=Array[_0xc99bc6(0x94)](_0xcd6214['webhookEvents'])?_0xcd6214[_0xc99bc6(0xd0)]:JSON['parse'](_0xcd6214[_0xc99bc6(0xd0)]);}catch(_0x4d904a){console[_0xc99bc6(0x13b)]('Error\x20parsing\x20webhook\x20events:',_0x4d904a),_0xc27e0d=[];}if(!_0xc27e0d['includes'](_0x97620)){console[_0xc99bc6(0x14b)](_0xc99bc6(0xa0)+_0x97620+_0xc99bc6(0xa5)+_0x301d16['id']);return;}const _0x208767={'event':_0x97620,'payment':{'id':_0x34a839['id'],'order_id':_0x34a839[_0xc99bc6(0x13a)],'gateway_order_id':_0x34a839[_0xc99bc6(0xe7)],'gateway':_0xc99bc6(0xbf),'amount':_0x34a839['amount'],'currency':_0x34a839[_0xc99bc6(0xad)],'status':_0x28881c['toLowerCase'](),'customer_email':_0x34a839[_0xc99bc6(0x147)],'customer_name':_0x34a839['customerName'],'created_at':_0x34a839['createdAt'],'updated_at':new Date()}},_0x46f377=await fetch(_0xcd6214['webhookUrl'],{'method':_0xc99bc6(0x117),'headers':{'Content-Type':_0xc99bc6(0x10e),'User-Agent':_0xc99bc6(0xa9)},'body':JSON[_0xc99bc6(0xee)](_0x208767)}),_0x324c40=Date['now']()-_0xa18500;loggerService_1[_0xc99bc6(0x118)][_0xc99bc6(0x143)](_0x34a839[_0xc99bc6(0x150)],_0xcd6214[_0xc99bc6(0x91)],_0x97620,_0x46f377[_0xc99bc6(0x151)],_0x324c40,_0x208767),console[_0xc99bc6(0x14b)](_0xc99bc6(0xff)+_0xcd6214[_0xc99bc6(0x91)]+_0xc99bc6(0xb6)+_0x46f377[_0xc99bc6(0x151)]+'\x20('+_0x324c40+_0xc99bc6(0xfe));}catch(_0x50baa3){console[_0xc99bc6(0x13b)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x50baa3),loggerService_1[_0xc99bc6(0x118)]['logShopWebhookError'](_0x34a839[_0xc99bc6(0x150)],_0x34a839['shop']?.[_0xc99bc6(0xca)]?.[_0xc99bc6(0x91)]||'unknown','webhook_send',_0x50baa3,{});}}['maskCardNumber'](_0xb80532){const _0x381e79=a42_0x1164de,_0x27ff44=_0xb80532[_0x381e79(0xf8)](/[\s-]/g,'');if(_0x27ff44[_0x381e79(0x132)]<0x4)return _0x381e79(0xd1);return _0x381e79(0x121)+_0x27ff44[_0x381e79(0x155)](-0x4);}async[a42_0x1164de(0xeb)](_0x307f77){const _0x42deb2=a42_0x1164de;console[_0x42deb2(0x14b)](_0x42deb2(0xfc),_0x307f77);let _0x58fac2='PENDING';if(_0x307f77['status']===0x1&&_0x307f77[_0x42deb2(0xe6)]===0x1)_0x58fac2='PAID';else _0x307f77[_0x42deb2(0x151)]===0x0&&_0x307f77[_0x42deb2(0xe6)]===0x0?_0x58fac2='PENDING':_0x58fac2='FAILED';return{'paymentId':_0x307f77[_0x42deb2(0xac)]||'','status':_0x58fac2,'amount':_0x307f77[_0x42deb2(0x14d)],'currency':_0x307f77[_0x42deb2(0xad)]};}[a42_0x1164de(0xd7)](){const _0x1401fa=a42_0x1164de;console[_0x1401fa(0x14b)](_0x1401fa(0xb8));const _0x4c1ffe=this[_0x1401fa(0xb7)][_0x1401fa(0x96)];for(const [_0x114494]of this[_0x1401fa(0xb7)]){this['clearStatusTimers'](_0x114494);}console[_0x1401fa(0x14b)](_0x1401fa(0x11d)+_0x4c1ffe+_0x1401fa(0x122));}}exports[a42_0x1164de(0x120)]=MasterCardService;