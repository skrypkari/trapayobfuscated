'use strict';const a46_0x3a48f2=a46_0x11d0;function a46_0x11d0(_0x85d000,_0x2d1335){const _0x98e286=a46_0x98e2();return a46_0x11d0=function(_0x11d075,_0x160a1c){_0x11d075=_0x11d075-0xf5;let _0x39b098=_0x98e286[_0x11d075];return _0x39b098;},a46_0x11d0(_0x85d000,_0x2d1335);}(function(_0x4f9fba,_0xd0da8a){const _0xcc625c=a46_0x11d0,_0x13dbb6=_0x4f9fba();while(!![]){try{const _0x251a76=parseInt(_0xcc625c(0x11c))/0x1+parseInt(_0xcc625c(0x189))/0x2*(-parseInt(_0xcc625c(0x10d))/0x3)+parseInt(_0xcc625c(0x202))/0x4+-parseInt(_0xcc625c(0x186))/0x5+-parseInt(_0xcc625c(0x17b))/0x6*(-parseInt(_0xcc625c(0x169))/0x7)+-parseInt(_0xcc625c(0x162))/0x8*(parseInt(_0xcc625c(0x15c))/0x9)+parseInt(_0xcc625c(0x1f3))/0xa;if(_0x251a76===_0xd0da8a)break;else _0x13dbb6['push'](_0x13dbb6['shift']());}catch(_0x242c83){_0x13dbb6['push'](_0x13dbb6['shift']());}}}(a46_0x98e2,0x62f0f));var __createBinding=this&&this[a46_0x3a48f2(0x1cf)]||(Object[a46_0x3a48f2(0x1d3)]?function(_0xeebaa0,_0x2fe76b,_0x212671,_0x3add82){const _0x25f67f=a46_0x3a48f2;if(_0x3add82===undefined)_0x3add82=_0x212671;var _0xaec35b=Object[_0x25f67f(0x1d2)](_0x2fe76b,_0x212671);(!_0xaec35b||(_0x25f67f(0x19a)in _0xaec35b?!_0x2fe76b[_0x25f67f(0x1ce)]:_0xaec35b[_0x25f67f(0x1fd)]||_0xaec35b['configurable']))&&(_0xaec35b={'enumerable':!![],'get':function(){return _0x2fe76b[_0x212671];}}),Object[_0x25f67f(0x119)](_0xeebaa0,_0x3add82,_0xaec35b);}:function(_0x1b6519,_0x141d53,_0x3ee855,_0x743d84){if(_0x743d84===undefined)_0x743d84=_0x3ee855;_0x1b6519[_0x743d84]=_0x141d53[_0x3ee855];}),__setModuleDefault=this&&this[a46_0x3a48f2(0x147)]||(Object[a46_0x3a48f2(0x1d3)]?function(_0x538c43,_0x51a555){const _0x27c0de=a46_0x3a48f2;Object[_0x27c0de(0x119)](_0x538c43,_0x27c0de(0x1b9),{'enumerable':!![],'value':_0x51a555});}:function(_0x4d8352,_0x255c10){const _0x231af9=a46_0x3a48f2;_0x4d8352[_0x231af9(0x1b9)]=_0x255c10;}),__importStar=this&&this[a46_0x3a48f2(0x1c6)]||(function(){var _0x5b420e=function(_0x198e7a){return _0x5b420e=Object['getOwnPropertyNames']||function(_0x1e5f10){const _0x3e59e4=a46_0x11d0;var _0x21d823=[];for(var _0x4b8616 in _0x1e5f10)if(Object['prototype']['hasOwnProperty'][_0x3e59e4(0x21a)](_0x1e5f10,_0x4b8616))_0x21d823[_0x21d823['length']]=_0x4b8616;return _0x21d823;},_0x5b420e(_0x198e7a);};return function(_0x5a960f){const _0x2363d0=a46_0x11d0;if(_0x5a960f&&_0x5a960f[_0x2363d0(0x1ce)])return _0x5a960f;var _0x3c531c={};if(_0x5a960f!=null){for(var _0x15a0fa=_0x5b420e(_0x5a960f),_0x1cc731=0x0;_0x1cc731<_0x15a0fa[_0x2363d0(0x1bd)];_0x1cc731++)if(_0x15a0fa[_0x1cc731]!==_0x2363d0(0x1b9))__createBinding(_0x3c531c,_0x5a960f,_0x15a0fa[_0x1cc731]);}return __setModuleDefault(_0x3c531c,_0x5a960f),_0x3c531c;};}()),__importDefault=this&&this[a46_0x3a48f2(0x1af)]||function(_0x37b36e){const _0x8c3b18=a46_0x3a48f2;return _0x37b36e&&_0x37b36e[_0x8c3b18(0x1ce)]?_0x37b36e:{'default':_0x37b36e};};function a46_0x98e2(){const _0x58142c=['2380084INbtrz','encryptAES','toLowerCase','loggerService','createSign','\x20\x20\x20-\x20info\x20length:','json','../telegramBotService','\x20\x20\x20Amount:\x20','base64','merchantPointId','isArray','toString','Amount:','💾\x20Payment\x20data\x20prepared','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','log','decryptAES','decryptResponse','private.pem','🛑\x20Stopped\x20','🔐\x20VISA\x20API\x20URL:','join','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','call','sendPaymentNotification','logWhiteDomainResponse','none','settings','info','\x20API:\x20','Status\x20decryption\x20failed:\x20','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','push','cwd','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','aes-256-ctr','💳\x20VISA/MasterCard\x20service\x20initialized','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','\x20payment:\x20','📤\x20Sending\x20request\x20to\x20API...','📝\x20Data\x20length:','🔐\x20Using\x20keys:\x20','\x20is\x20final\x20(','MasterCard:\x20','webhookEvents',',\x20payment_id=','3DS\x20URL:','floor','encryptRSA','visaPrivateKeyPath','276nNbpOD','❌\x20RSA\x20encryption\x20failed:','final','\x20MasterCard\x20status\x20check\x20timers','visaApiUrl','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','\x20payment\x20status:\x20','Failed\x20to\x20send\x20payment\x20notifications:','stringify','),\x20stopping\x20status\x20checks','clearStatusTimers','🔐\x20VISA\x20Private\x20key\x20length:\x20','defineProperty','\x20with\x20status\x20','🔐\x20VISA\x20Private\x20key\x20path:','114353DItPSX','number','failed','end','Order\x20ID:','🔐\x20MasterCard\x20Public\x20key\x20path:','charge','\x20not\x20enabled\x20for\x20shop\x20','\x20status\x20checks\x20for\x20payment\x20','🔐\x20MasterCard\x20API\x20URL:','first_name','Result\x20URL:','shopId','/status','replace','📝\x20Data\x20to\x20sign\x20length:','stopAllStatusChecks','order_id','utf8','paymentId','📊\x20Status\x20check\x20result:',',\x20orderId=','payment_id','\x20\x20\x20Currency:\x20','sendShopWebhook','masterCardMerchantPointId','ms)','\x20\x20\x20Status:\x20','\x20(from:\x20order_id=','/charge_decrypt','Error\x20details:','keys',',\x20final=','publicKeyPath','🔐\x20Data\x20signed\x20with\x20RSA','📊\x20','sendPaymentNotifications','Payment\x20ID:','apiUrl','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','paidAt','3ds_url','✅\x20Payment\x20','__setModuleDefault','VISA','privateKeyPath','from','masterCardApiUrl','✅\x20Status\x20response\x20decrypted\x20successfully','\x20status\x20check\x20#','key','===\x20PARSED\x20API\x20RESPONSE\x20===','card_type','visaMerchantPointId','✅\x20Scheduled\x20','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','createDecipheriv','payment.failed','text','\x20characters','status','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','🔐\x20RSA\x20signing\x20successful','471330eCpusg','5000000000000000','visaPublicKeyPath','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','🔍\x20','now','40evCgon','gatewayOrderId','🔐\x20VISA\x20Public\x20key\x20path:',',\x20id=','\x20(from:\x20status=','toUpperCase','visa/mastercard','126igNsCl','PENDING','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','findUnique','Failed\x20to\x20decrypt\x20response','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','warn','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','existsSync','randomBytes','PHP\x20decryptor\x20error','🔐\x203DS\x20verification\x20required','cardType','\x20\x20\x20-\x20merchant_point_id:','parse','getCardTypeAndApi','/charge_raw','25518waqoNL','../loggerService','logWhiteDomainRequest','description','📝\x20Decrypted\x20webhook\x20data:','🔍\x20Using\x20','resolve','****\x20****\x20****\x20','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','Response\x20Time:','📝\x20Signature\x20length:','81910miWjKa','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','16462QLMkQr','❌\x20RSA\x20signing\x20failed:','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Decryption\x20failed:\x20','webhookUrl',',\x20body:\x20','VisaMasterCardService','4000000000000000','validateKeyFiles','updatePaymentStatus','Unknown\x20error','size','PAID','maskCardNumber','-----BEGIN','update','-----END','get','payment.success','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','🔐\x20MasterCard\x20Private\x20key\x20path:','POST','decryptResponsePhp','\x20webhook\x20extracted\x20data:','psp_public.pem','📝\x20Final\x20request\x20structure:','../../config/database','\x20order_id\x20for\x20search:\x20','generateAESKey','cvv','❌\x20Failure\x20description:\x20','TesSoft\x20Payment\x20System/1.0','message','last_name','HTTP\x20error!\x20status:\x20','then','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','__importDefault','/charge','===\x20API\x20RESPONSE\x20===','application/json','Webhook\x20event\x20','❌\x20Data\x20being\x20signed:','adminNotes','✅\x20VISA\x20key\x20files\x20validated\x20successfully','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','🔐\x20VISA\x20Public\x20key\x20length:\x20','default','expire_year','publicEncrypt','logWhiteDomainError','length','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','path','Card\x20Number:','...','error','🔐\x20AES\x20IV\x20length:','📊\x20Checking\x20','substring','__importStar','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','FAILED','delete','❌\x20Status\x20check\x20#','\x20\x20\x20-\x20key\x20length:','createdAt','Final:','__esModule','__createBinding','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','\x20failed\x20for\x20payment\x20','getOwnPropertyDescriptor','create','\x20for\x20payment\x20','forEach','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','/charge_decrypted','amount','\x20result:','https://api.paydmeth.com/api','🔐\x20AES\x20key\x20length:','expire_month','payment','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','currency','orderId','\x20\x20\x20-\x20method:\x20charge','****','signRSA','customerEmail','constants','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','slice','Return\x20URL:','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','HTTP\x20','HTTP\x20Status:','statusCheckTimers','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','📊\x20Status\x20check\x20#','processWebhook','scheduleStatusChecks','shop','includes','6548190nXkGzZ','🔍\x20Using\x20provided\x20card\x20type:\x20','Status:','\x20payment_id\x20for\x20search:\x20','readFileSync','🧹\x20Clearing\x20','sign','MASTERCARD','desc','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','writable','),\x20defaulting\x20to\x20MasterCard','trim','date_success','❌\x20PHP\x20decryptor\x20request\x20failed:'];a46_0x98e2=function(){return _0x58142c;};return a46_0x98e2();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a46_0x3a48f2(0x18f)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a46_0x3a48f2(0x1bf))),loggerService_1=require(a46_0x3a48f2(0x17c));class VisaMasterCardService{constructor(){const _0x5a78ce=a46_0x3a48f2;this['statusCheckTimers']=new Map(),this[_0x5a78ce(0x14b)]='https://api.paydmeth.com/api',this['masterCardMerchantPointId']=0x6a7,this[_0x5a78ce(0x149)]=path_1['default'][_0x5a78ce(0x218)](process[_0x5a78ce(0xfb)](),_0x5a78ce(0x13b),_0x5a78ce(0x215)),this[_0x5a78ce(0x13d)]=path_1[_0x5a78ce(0x1b9)][_0x5a78ce(0x218)](process[_0x5a78ce(0xfb)](),'keys',_0x5a78ce(0x1a2)),this['visaApiUrl']=_0x5a78ce(0x1da),this[_0x5a78ce(0x151)]=0x6b7,this['visaPrivateKeyPath']=path_1[_0x5a78ce(0x1b9)][_0x5a78ce(0x218)](process['cwd'](),_0x5a78ce(0x13b),'visa_private.pem'),this['visaPublicKeyPath']=path_1['default']['join'](process['cwd'](),_0x5a78ce(0x13b),'visa_public.pem'),console[_0x5a78ce(0x212)](_0x5a78ce(0xfe)),console['log'](_0x5a78ce(0x125),this[_0x5a78ce(0x14b)]),console['log'](_0x5a78ce(0x217),this['visaApiUrl']),console['log'](_0x5a78ce(0x19e),this[_0x5a78ce(0x149)]),console[_0x5a78ce(0x212)](_0x5a78ce(0x121),this[_0x5a78ce(0x13d)]),console[_0x5a78ce(0x212)](_0x5a78ce(0x11b),this[_0x5a78ce(0x10c)]),console[_0x5a78ce(0x212)](_0x5a78ce(0x164),this['visaPublicKeyPath']),this[_0x5a78ce(0x191)]();}['getCardTypeAndApi'](_0x1d1944){const _0x1ddc76=a46_0x3a48f2,_0x164186=_0x1d1944['charAt'](0x0);if(_0x164186==='4')return console[_0x1ddc76(0x212)]('💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)'),{'cardType':_0x1ddc76(0x148),'apiUrl':this[_0x1ddc76(0x111)],'privateKeyPath':this[_0x1ddc76(0x10c)],'publicKeyPath':this[_0x1ddc76(0x15e)],'merchantPointId':this[_0x1ddc76(0x151)]};else return _0x164186==='5'?(console[_0x1ddc76(0x212)](_0x1ddc76(0x183)),{'cardType':_0x1ddc76(0x1fa),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x1ddc76(0x149)],'publicKeyPath':this[_0x1ddc76(0x13d)],'merchantPointId':this['masterCardMerchantPointId']}):(console['log'](_0x1ddc76(0x143)+_0x164186+_0x1ddc76(0x1fe)),{'cardType':_0x1ddc76(0x1fa),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x1ddc76(0x149)],'publicKeyPath':this[_0x1ddc76(0x13d)],'merchantPointId':this[_0x1ddc76(0x135)]});}[a46_0x3a48f2(0x191)](){const _0x5ef0b2=a46_0x3a48f2;try{if(!fs_1[_0x5ef0b2(0x1b9)][_0x5ef0b2(0x172)](this['privateKeyPath']))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this[_0x5ef0b2(0x149)]);if(!fs_1[_0x5ef0b2(0x1b9)][_0x5ef0b2(0x172)](this['publicKeyPath']))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this[_0x5ef0b2(0x13d)]);const _0x31506e=fs_1[_0x5ef0b2(0x1b9)][_0x5ef0b2(0x1f7)](this['privateKeyPath'],'utf8')['trim'](),_0x2bc9f6=fs_1[_0x5ef0b2(0x1b9)][_0x5ef0b2(0x1f7)](this[_0x5ef0b2(0x13d)],_0x5ef0b2(0x12e))[_0x5ef0b2(0x1ff)]();if(!_0x31506e[_0x5ef0b2(0x1f2)]('-----BEGIN')||!_0x31506e['includes']('-----END'))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x2bc9f6[_0x5ef0b2(0x1f2)](_0x5ef0b2(0x197))||!_0x2bc9f6[_0x5ef0b2(0x1f2)](_0x5ef0b2(0x199)))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console['log'](_0x5ef0b2(0x1c7)),console[_0x5ef0b2(0x212)]('🔐\x20MasterCard\x20Private\x20key\x20length:\x20'+_0x31506e[_0x5ef0b2(0x1bd)]+'\x20characters'),console[_0x5ef0b2(0x212)](_0x5ef0b2(0xff)+_0x2bc9f6['length']+_0x5ef0b2(0x157));if(fs_1[_0x5ef0b2(0x1b9)][_0x5ef0b2(0x172)](this[_0x5ef0b2(0x10c)])&&fs_1[_0x5ef0b2(0x1b9)][_0x5ef0b2(0x172)](this[_0x5ef0b2(0x15e)])){const _0x337e5c=fs_1[_0x5ef0b2(0x1b9)][_0x5ef0b2(0x1f7)](this[_0x5ef0b2(0x10c)],_0x5ef0b2(0x12e))[_0x5ef0b2(0x1ff)](),_0xfbc30a=fs_1[_0x5ef0b2(0x1b9)][_0x5ef0b2(0x1f7)](this[_0x5ef0b2(0x15e)],_0x5ef0b2(0x12e))[_0x5ef0b2(0x1ff)]();(!_0x337e5c[_0x5ef0b2(0x1f2)](_0x5ef0b2(0x197))||!_0x337e5c[_0x5ef0b2(0x1f2)](_0x5ef0b2(0x199)))&&console[_0x5ef0b2(0x170)](_0x5ef0b2(0x19d)),(!_0xfbc30a[_0x5ef0b2(0x1f2)](_0x5ef0b2(0x197))||!_0xfbc30a[_0x5ef0b2(0x1f2)](_0x5ef0b2(0x199)))&&console[_0x5ef0b2(0x170)](_0x5ef0b2(0x1be)),console['log'](_0x5ef0b2(0x1b6)),console[_0x5ef0b2(0x212)](_0x5ef0b2(0x118)+_0x337e5c[_0x5ef0b2(0x1bd)]+_0x5ef0b2(0x157)),console[_0x5ef0b2(0x212)](_0x5ef0b2(0x1b8)+_0xfbc30a[_0x5ef0b2(0x1bd)]+'\x20characters');}else console['warn'](_0x5ef0b2(0x219)),console[_0x5ef0b2(0x170)]('⚠️\x20Expected\x20VISA\x20private\x20key:\x20'+this[_0x5ef0b2(0x10c)]),console['warn'](_0x5ef0b2(0x16c)+this[_0x5ef0b2(0x15e)]);}catch(_0x302d94){console['error']('❌\x20VISA/MasterCard\x20key\x20validation\x20failed:',_0x302d94);throw _0x302d94;}}[a46_0x3a48f2(0x1a6)](){const _0x813777=a46_0x3a48f2,_0x42ba2c=crypto_1[_0x813777(0x1b9)]['randomBytes'](0x20),_0x3b4b8a=crypto_1[_0x813777(0x1b9)][_0x813777(0x173)](0x10);return{'key':_0x42ba2c,'iv':_0x3b4b8a};}[a46_0x3a48f2(0x203)](_0x5d50fe,_0x234d68,_0x4a245a){const _0x277a4d=a46_0x3a48f2,_0x551d90=crypto_1[_0x277a4d(0x1b9)]['createCipheriv']('aes-256-ctr',_0x234d68,_0x4a245a);let _0x14d116=_0x551d90[_0x277a4d(0x198)](_0x5d50fe,'utf8','base64');return _0x14d116+=_0x551d90[_0x277a4d(0x10f)](_0x277a4d(0x20b)),_0x14d116;}[a46_0x3a48f2(0x10b)](_0x3be76d,_0xcfaea2,_0x1876da){const _0x48318c=a46_0x3a48f2;try{const _0xff61e8=fs_1[_0x48318c(0x1b9)][_0x48318c(0x1f7)](_0x1876da,_0x48318c(0x12e))[_0x48318c(0x1ff)](),_0x345a6e={'iv':_0xcfaea2[_0x48318c(0x20e)](_0x48318c(0x20b)),'key':_0x3be76d[_0x48318c(0x20e)](_0x48318c(0x20b))},_0x5602cc=JSON[_0x48318c(0x115)](_0x345a6e);console[_0x48318c(0x212)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x5602cc[_0x48318c(0x1bd)]);const _0x5cebc6=crypto_1['default'][_0x48318c(0x1bb)]({'key':_0xff61e8,'padding':crypto_1[_0x48318c(0x1b9)][_0x48318c(0x1e5)]['RSA_PKCS1_PADDING']},Buffer[_0x48318c(0x14a)](_0x5602cc));return console[_0x48318c(0x212)]('✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x5cebc6[_0x48318c(0x1bd)]),_0x5cebc6[_0x48318c(0x20e)](_0x48318c(0x20b));}catch(_0x56e3ed){console[_0x48318c(0x1c2)](_0x48318c(0x10e),_0x56e3ed);throw new Error(_0x48318c(0xf9));}}['signRSA'](_0xfe1daa,_0x192fec){const _0x1e0416=a46_0x3a48f2;try{const _0x23bcdb=fs_1[_0x1e0416(0x1b9)]['readFileSync'](_0x192fec,_0x1e0416(0x12e))[_0x1e0416(0x1ff)](),_0x3d59a2=crypto_1['default'][_0x1e0416(0x206)]('SHA256');_0x3d59a2[_0x1e0416(0x198)](_0xfe1daa),_0x3d59a2[_0x1e0416(0x11f)]();const _0x32cd80=_0x3d59a2['sign'](_0x23bcdb,_0x1e0416(0x20b));return console[_0x1e0416(0x212)](_0x1e0416(0x15b)),console['log'](_0x1e0416(0x12b),_0xfe1daa['length']),console[_0x1e0416(0x212)](_0x1e0416(0x185),_0x32cd80['length']),_0x32cd80;}catch(_0xe753a7){console[_0x1e0416(0x1c2)](_0x1e0416(0x18a),_0xe753a7),console['error'](_0x1e0416(0x1b4),_0xfe1daa[_0x1e0416(0x1c5)](0x0,0xc8)+_0x1e0416(0x1c1));throw new Error(_0x1e0416(0x159));}}[a46_0x3a48f2(0x213)](_0x124847,_0x4db1f6,_0x14fe1e){const _0x3cb43e=a46_0x3a48f2,_0x5a398c=crypto_1['default'][_0x3cb43e(0x154)](_0x3cb43e(0xfd),_0x4db1f6,_0x14fe1e);let _0x487a29=_0x5a398c[_0x3cb43e(0x198)](_0x124847,_0x3cb43e(0x20b),_0x3cb43e(0x12e));return _0x487a29+=_0x5a398c[_0x3cb43e(0x10f)](_0x3cb43e(0x12e)),_0x487a29;}async[a46_0x3a48f2(0x1a0)](_0x53072e,_0x132f23,_0x345515=a46_0x3a48f2(0x1fa)){const _0x152622=a46_0x3a48f2;try{const _0x54fd4c=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x152622(0x19f),'headers':{'Content-Type':_0x152622(0x1b2)},'body':JSON['stringify']({'info':_0x53072e,'key':_0x132f23,'card_type':_0x345515[_0x152622(0x204)]()})});if(!_0x54fd4c['ok'])throw new Error(_0x152622(0x174));return await _0x54fd4c[_0x152622(0x156)]();}catch(_0x484437){console[_0x152622(0x1c2)](_0x152622(0x201),_0x484437);throw new Error(_0x152622(0x188));}}[a46_0x3a48f2(0x214)](_0x539575,_0x2436fe){const _0xe98cbd=a46_0x3a48f2;try{const _0x30beb1=fs_1['default'][_0xe98cbd(0x1f7)](this[_0xe98cbd(0x149)],_0xe98cbd(0x12e))[_0xe98cbd(0x1ff)](),_0x3826e4=crypto_1['default']['privateDecrypt'](_0x30beb1,Buffer[_0xe98cbd(0x14a)](_0x2436fe,_0xe98cbd(0x20b))),_0x2fa042=JSON[_0xe98cbd(0x178)](_0x3826e4['toString']()),_0x101359=Buffer[_0xe98cbd(0x14a)](_0x2fa042[_0xe98cbd(0x14e)],_0xe98cbd(0x20b)),_0x1ee4f1=Buffer['from'](_0x2fa042['iv'],_0xe98cbd(0x20b));return this[_0xe98cbd(0x213)](_0x539575,_0x101359,_0x1ee4f1);}catch(_0x4ddbb2){throw new Error(_0xe98cbd(0x16e));}}async['processCardPayment'](_0x22cd7f){const _0xba0884=a46_0x3a48f2,{paymentId:_0x54c444,orderId:_0x4c172f,amount:_0xbf0ea4,currency:_0x4268e6,cardData:_0x24f225,resultUrl:_0x56088d,returnUrl:_0x526704,cardHolder:_0x33db91,browser:_0x5d81e0}=_0x22cd7f;console['log'](_0xba0884(0x211)),console['log']('Payment\x20ID:',_0x54c444),console[_0xba0884(0x212)](_0xba0884(0x120),_0x4c172f),console[_0xba0884(0x212)](_0xba0884(0x20f),_0xbf0ea4,_0x4268e6),console[_0xba0884(0x212)](_0xba0884(0x1c0),this[_0xba0884(0x196)](_0x24f225[_0xba0884(0x11d)])),console[_0xba0884(0x212)]('Card\x20Holder:',_0x33db91[_0xba0884(0x126)]+'\x20'+_0x33db91[_0xba0884(0x1ab)]),console[_0xba0884(0x212)](_0xba0884(0x1e8),_0x526704),console[_0xba0884(0x212)](_0xba0884(0x127),_0x56088d);const _0x2c1599=this[_0xba0884(0x179)](_0x24f225['number']);console[_0xba0884(0x212)]('🎯\x20Using\x20'+_0x2c1599[_0xba0884(0x176)]+_0xba0884(0xf7)+_0x2c1599[_0xba0884(0x142)]),console[_0xba0884(0x212)](_0xba0884(0x104)+_0x2c1599[_0xba0884(0x149)]+',\x20'+_0x2c1599[_0xba0884(0x13d)]);const _0x2bf357={'amount':_0xbf0ea4,'currency':_0x4268e6['toUpperCase'](),'order_id':_0x4c172f,'result_url':_0x56088d,'return_url':_0x526704,'country':'','card':{'number':_0x24f225[_0xba0884(0x11d)],'expire_month':_0x24f225[_0xba0884(0x1dc)],'expire_year':_0x24f225[_0xba0884(0x1ba)],'cvv':_0x24f225[_0xba0884(0x1a7)]},'card_holder':_0x33db91,'browser':_0x5d81e0},_0xf3863d=JSON[_0xba0884(0x115)](_0x2bf357);console[_0xba0884(0x212)](_0xba0884(0x210)),console[_0xba0884(0x212)](_0xba0884(0x1de)),console[_0xba0884(0x212)](_0xf3863d),console[_0xba0884(0x212)](_0xba0884(0x103),_0xf3863d[_0xba0884(0x1bd)]);try{const {key:_0x31b72d,iv:_0x37dd55}=this['generateAESKey']();console[_0xba0884(0x212)]('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console['log'](_0xba0884(0x1db),_0x31b72d['length']),console[_0xba0884(0x212)](_0xba0884(0x1c3),_0x37dd55['length']);const _0xb3f771=this['encryptAES'](_0xf3863d,_0x31b72d,_0x37dd55);console[_0xba0884(0x212)]('🔐\x20Data\x20encrypted\x20with\x20AES'),console['log']('📝\x20Encrypted\x20data\x20length:',_0xb3f771[_0xba0884(0x1bd)]);const _0x3d5e34=this['encryptRSA'](_0x31b72d,_0x37dd55,_0x2c1599[_0xba0884(0x13d)]);console[_0xba0884(0x212)](_0xba0884(0x16b)),console[_0xba0884(0x212)]('📝\x20Encrypted\x20key\x20length:',_0x3d5e34[_0xba0884(0x1bd)]);const _0x3b14d6=this[_0xba0884(0x1e3)](_0xf3863d,_0x2c1599[_0xba0884(0x149)]);console[_0xba0884(0x212)](_0xba0884(0x13e)),console[_0xba0884(0x212)](_0xba0884(0x185),_0x3b14d6[_0xba0884(0x1bd)]);const _0x2d7d89={'merchant_point_id':_0x2c1599[_0xba0884(0x20c)],'method':_0xba0884(0x122),'info':_0xb3f771,'key':_0x3d5e34,'sign':_0x3b14d6,'lang':'en'};console[_0xba0884(0x212)](_0xba0884(0x102)),console[_0xba0884(0x212)](_0xba0884(0x1a3)),console['log'](_0xba0884(0x177),_0x2c1599[_0xba0884(0x20c)]),console['log'](_0xba0884(0x1e1)),console[_0xba0884(0x212)](_0xba0884(0x207),_0xb3f771['length']),console[_0xba0884(0x212)](_0xba0884(0x1cb),_0x3d5e34[_0xba0884(0x1bd)]),console[_0xba0884(0x212)]('\x20\x20\x20-\x20sign\x20length:',_0x3b14d6['length']),console[_0xba0884(0x212)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1['loggerService'][_0xba0884(0x17d)](_0x2c1599[_0xba0884(0x176)][_0xba0884(0x204)](),_0xba0884(0x1b0),_0xba0884(0x19f),{'merchant_point_id':_0x2c1599[_0xba0884(0x20c)],'method':'charge','lang':'en'});const _0x15db65=Date[_0xba0884(0x161)](),_0x5102d9=await fetch(_0x2c1599[_0xba0884(0x142)],{'method':_0xba0884(0x19f),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0xba0884(0x1a9)},'body':JSON[_0xba0884(0x115)](_0x2d7d89)}),_0x599528=Date[_0xba0884(0x161)]()-_0x15db65;console[_0xba0884(0x212)](_0xba0884(0x1b1)),console[_0xba0884(0x212)](_0xba0884(0x1f5),_0x5102d9[_0xba0884(0x158)]),console[_0xba0884(0x212)](_0xba0884(0x184),_0x599528+'ms');if(!_0x5102d9['ok']){const _0x114a18=await _0x5102d9['text']();console['error'](_0xba0884(0x1eb),_0x5102d9[_0xba0884(0x158)]),console['error']('Response\x20Body:',_0x114a18),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2c1599[_0xba0884(0x176)][_0xba0884(0x204)](),_0xba0884(0x17a),_0x5102d9['status'],_0x114a18,_0x599528),loggerService_1[_0xba0884(0x205)][_0xba0884(0x1bc)](_0x2c1599['cardType']['toLowerCase'](),_0xba0884(0x1b0),_0xba0884(0x1ea)+_0x5102d9[_0xba0884(0x158)]+':\x20'+_0x114a18);throw new Error(_0xba0884(0x1ac)+_0x5102d9[_0xba0884(0x158)]+_0xba0884(0x18e)+_0x114a18);}const _0x92abfd=await _0x5102d9[_0xba0884(0x208)]();loggerService_1[_0xba0884(0x205)]['logWhiteDomainResponse'](_0x2c1599[_0xba0884(0x176)]['toLowerCase'](),_0xba0884(0x17a),_0x5102d9[_0xba0884(0x158)],_0x92abfd,_0x599528),console[_0xba0884(0x212)](_0xba0884(0x14f));let _0x532fbf=_0x92abfd;if(_0x92abfd[_0xba0884(0xf6)]&&_0x92abfd[_0xba0884(0x14e)]&&_0x92abfd[_0xba0884(0x1f9)]){console[_0xba0884(0x212)](_0xba0884(0x19c));try{const _0x41d840=await this[_0xba0884(0x1a0)](_0x92abfd[_0xba0884(0xf6)],_0x92abfd['key'],_0x2c1599[_0xba0884(0x176)]);_0x532fbf=JSON['parse'](_0x41d840),console['log']('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0xba0884(0x205)]['logWhiteDomainResponse'](_0x2c1599[_0xba0884(0x176)]['toLowerCase'](),_0xba0884(0x1d7),_0x5102d9[_0xba0884(0x158)],_0x532fbf,_0x599528),console['log'](_0xba0884(0x1e6));}catch(_0x4e0536){console[_0xba0884(0x1c2)](_0xba0884(0x15f),_0x4e0536),loggerService_1[_0xba0884(0x205)]['logWhiteDomainError'](_0x2c1599[_0xba0884(0x176)][_0xba0884(0x204)](),_0xba0884(0x139),_0xba0884(0x18c)+_0x4e0536),_0x532fbf=_0x92abfd;}}else loggerService_1['loggerService'][_0xba0884(0x21c)](_0x2c1599[_0xba0884(0x176)][_0xba0884(0x204)](),_0xba0884(0x1d7),_0x5102d9[_0xba0884(0x158)],_0x532fbf,_0x599528),console[_0xba0884(0x212)](_0xba0884(0x18b));console['log'](_0xba0884(0x1f5),_0x532fbf[_0xba0884(0x158)]),console[_0xba0884(0x212)](_0xba0884(0x1cd),_0x532fbf['final']),console[_0xba0884(0x212)](_0xba0884(0x141),_0x532fbf[_0xba0884(0x132)]),console[_0xba0884(0x212)](_0xba0884(0x109),_0x532fbf[_0xba0884(0x145)]||_0xba0884(0x21d));if(_0x532fbf['status']===0x64&&_0x532fbf[_0xba0884(0x10f)]===0x1)return console[_0xba0884(0x212)]('✅\x20Payment\x20successful'),{'gateway_payment_id':_0x532fbf[_0xba0884(0x132)]?.[_0xba0884(0x20e)](),'payment_url':_0x526704,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x532fbf[_0xba0884(0x145)])return console[_0xba0884(0x212)](_0xba0884(0x175)),this['scheduleStatusChecks'](_0x54c444,_0x4c172f,_0x532fbf[_0xba0884(0x132)]?.[_0xba0884(0x20e)]()||_0x4c172f,_0x2c1599['cardType']),{'gateway_payment_id':_0x532fbf[_0xba0884(0x132)]?.[_0xba0884(0x20e)](),'payment_url':_0x532fbf['3ds_url'],'requires_3ds':!![],'threeds_url':_0x532fbf['3ds_url'],'status':_0xba0884(0x16a),'final':![]};let _0x40136e=_0x532fbf['desc']||_0x532fbf[_0xba0884(0x1aa)]||_0xba0884(0x193),_0x3b2a14=_0x532fbf[_0xba0884(0x158)],_0x241f3d=_0x532fbf['final'];return console[_0xba0884(0x212)]('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x3b2a14+',\x20Final:\x20'+_0x241f3d+',\x20Desc:\x20'+_0x40136e),{'gateway_payment_id':_0x532fbf[_0xba0884(0x132)]?.[_0xba0884(0x20e)](),'payment_url':_0x526704,'requires_3ds':![],'status':_0xba0884(0x1c8),'final':!![]};}catch(_0x32b71f){console[_0xba0884(0x1c2)](_0xba0884(0x112)),console[_0xba0884(0x1c2)](_0xba0884(0x13a),_0x32b71f),loggerService_1[_0xba0884(0x205)]['logWhiteDomainError'](_0xba0884(0x168),_0xba0884(0x1b0),_0x32b71f);throw new Error(_0xba0884(0x187)+(_0x32b71f instanceof Error?_0x32b71f[_0xba0884(0x1aa)]:_0xba0884(0x193)));}}async['checkPaymentStatus'](_0x3a9850,_0x31b386,_0x2137ff=a46_0x3a48f2(0x148)){const _0x4c1162=a46_0x3a48f2;console[_0x4c1162(0x212)](_0x4c1162(0x1c4)+_0x2137ff+'\x20payment\x20status:\x20'+_0x3a9850+'\x20('+_0x31b386+')');try{const _0x215c11={'payment_id':_0x3a9850,'order_id':_0x31b386},_0x1b514c=JSON['stringify'](_0x215c11),_0xc13d54=this[_0x4c1162(0x179)](_0x2137ff===_0x4c1162(0x148)?_0x4c1162(0x190):_0x4c1162(0x15d)),{key:_0x4ee896,iv:_0x447d41}=this[_0x4c1162(0x1a6)](),_0x546469=this[_0x4c1162(0x203)](_0x1b514c,_0x4ee896,_0x447d41),_0x271b96=this[_0x4c1162(0x10b)](_0x4ee896,_0x447d41,_0xc13d54['publicKeyPath']),_0x586ea0=this[_0x4c1162(0x1e3)](_0x1b514c,_0xc13d54[_0x4c1162(0x149)]),_0x5770b1={'merchant_point_id':_0xc13d54[_0x4c1162(0x20c)],'method':_0x4c1162(0x158),'info':_0x546469,'key':_0x271b96,'sign':_0x586ea0,'lang':'en'};loggerService_1[_0x4c1162(0x205)][_0x4c1162(0x17d)](_0x2137ff[_0x4c1162(0x204)](),'/status','POST',{'merchant_point_id':_0xc13d54[_0x4c1162(0x20c)],'method':_0x4c1162(0x158),'lang':'en'});const _0x4588de=Date[_0x4c1162(0x161)](),_0x3ecf20=await fetch(_0xc13d54['apiUrl'],{'method':_0x4c1162(0x19f),'headers':{'Content-Type':_0x4c1162(0x1b2),'Accept':_0x4c1162(0x1b2),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x4c1162(0x115)](_0x5770b1)}),_0x3e915d=Date['now']()-_0x4588de;if(!_0x3ecf20['ok']){const _0x18a773=await _0x3ecf20[_0x4c1162(0x156)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2137ff[_0x4c1162(0x204)](),'/status_raw',_0x3ecf20[_0x4c1162(0x158)],_0x18a773,_0x3e915d);throw new Error(_0x4c1162(0x1ac)+_0x3ecf20[_0x4c1162(0x158)]);}const _0x5e4d48=await _0x3ecf20[_0x4c1162(0x208)]();loggerService_1['loggerService'][_0x4c1162(0x21c)](_0x2137ff['toLowerCase'](),'/status_raw',_0x3ecf20[_0x4c1162(0x158)],_0x5e4d48,_0x3e915d);let _0x554b9a=_0x5e4d48;if(_0x5e4d48['info']&&_0x5e4d48[_0x4c1162(0x14e)]&&_0x5e4d48[_0x4c1162(0x1f9)]){console['log'](_0x4c1162(0x171));try{const _0x40447b=await this['decryptResponsePhp'](_0x5e4d48[_0x4c1162(0xf6)],_0x5e4d48[_0x4c1162(0x14e)],_0x2137ff);_0x554b9a=JSON['parse'](_0x40447b),console[_0x4c1162(0x212)](_0x4c1162(0x14c)),loggerService_1[_0x4c1162(0x205)][_0x4c1162(0x21c)](_0x2137ff[_0x4c1162(0x204)](),'/status_decrypted',_0x3ecf20[_0x4c1162(0x158)],_0x554b9a,_0x3e915d),console[_0x4c1162(0x212)](_0x4c1162(0x1d0));}catch(_0x139201){console[_0x4c1162(0x1c2)](_0x4c1162(0x1fc),_0x139201),loggerService_1[_0x4c1162(0x205)]['logWhiteDomainError'](_0x2137ff['toLowerCase'](),'/status_decrypt',_0x4c1162(0xf8)+_0x139201),_0x554b9a=_0x5e4d48;}}else loggerService_1[_0x4c1162(0x205)]['logWhiteDomainResponse'](_0x2137ff[_0x4c1162(0x204)](),'/status_decrypted',_0x3ecf20[_0x4c1162(0x158)],_0x554b9a,_0x3e915d),console[_0x4c1162(0x212)]('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x4c1162(0x212)](_0x4c1162(0x130),{'status':_0x554b9a[_0x4c1162(0x158)],'final':_0x554b9a[_0x4c1162(0x10f)],'payment_id':_0x554b9a['payment_id'],'desc':_0x554b9a['desc']});let _0x2c266a=_0x4c1162(0x16a);if(_0x554b9a[_0x4c1162(0x158)]===0x64&&_0x554b9a['final']===0x1)_0x2c266a=_0x4c1162(0x195);else{if(_0x554b9a['final']===0x0)_0x2c266a='PENDING';else _0x554b9a[_0x4c1162(0x10f)]===0x1&&_0x554b9a[_0x4c1162(0x158)]!==0x64?_0x2c266a='FAILED':_0x2c266a=_0x4c1162(0x16a);}return{'status':_0x2c266a,'final':_0x554b9a[_0x4c1162(0x10f)]===0x1,'amount':_0x554b9a['amount'],'currency':_0x554b9a[_0x4c1162(0x1df)],'date_success':_0x554b9a[_0x4c1162(0x200)],'description':_0x554b9a[_0x4c1162(0x1fb)]};}catch(_0x2b1cde){console[_0x4c1162(0x1c2)](_0x2137ff+'\x20status\x20check\x20error:',_0x2b1cde),loggerService_1['loggerService'][_0x4c1162(0x1bc)](_0x2137ff['toLowerCase'](),_0x4c1162(0x129),_0x2b1cde);throw new Error('Failed\x20to\x20check\x20'+_0x2137ff+_0x4c1162(0x113)+(_0x2b1cde instanceof Error?_0x2b1cde['message']:_0x4c1162(0x193)));}}[a46_0x3a48f2(0x1f0)](_0x4e51d0,_0x422603,_0x4f447e,_0xb6861a){const _0x1d1f99=a46_0x3a48f2;console[_0x1d1f99(0x212)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20'+_0xb6861a+_0x1d1f99(0x101)+_0x4e51d0+'\x20('+_0x4f447e+')'),this[_0x1d1f99(0x117)](_0x4e51d0);const _0x2313a4=[],_0xf36e0c=0x5*0x3c*0x3e8,_0x1ca700=0x2*0x3c*0x3c*0x3e8,_0x2b06cf=Math[_0x1d1f99(0x10a)](_0x1ca700/_0xf36e0c);console[_0x1d1f99(0x212)]('⏰\x20Will\x20check\x20status\x20'+_0x2b06cf+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x5884f6=0x1;_0x5884f6<=_0x2b06cf;_0x5884f6++){const _0x805eb1=setTimeout(async()=>{const _0x413ee7=_0x1d1f99;console['log'](_0x413ee7(0x160)+_0xb6861a+_0x413ee7(0x14d)+_0x5884f6+'/'+_0x2b06cf+_0x413ee7(0x1d4)+_0x4e51d0);try{const _0x320f8c=await this['checkPaymentStatus'](_0x4f447e,_0x422603,_0xb6861a);console['log'](_0x413ee7(0x1ee)+_0x5884f6+_0x413ee7(0x1d9),_0x320f8c),_0x320f8c[_0x413ee7(0x10f)]&&(console[_0x413ee7(0x212)](_0x413ee7(0x146)+_0x4e51d0+_0x413ee7(0x105)+_0x320f8c[_0x413ee7(0x158)]+_0x413ee7(0x116)),this[_0x413ee7(0x117)](_0x4e51d0),await this[_0x413ee7(0x192)](_0x4e51d0,_0x320f8c[_0x413ee7(0x158)],_0x320f8c));}catch(_0x236026){console[_0x413ee7(0x1c2)](_0x413ee7(0x1ca)+_0x5884f6+_0x413ee7(0x1d1)+_0x4e51d0+':',_0x236026);}},_0x5884f6*_0xf36e0c);_0x2313a4[_0x1d1f99(0xfa)](_0x805eb1);}this[_0x1d1f99(0x1ec)]['set'](_0x4e51d0,_0x2313a4),console[_0x1d1f99(0x212)](_0x1d1f99(0x152)+_0x2b06cf+_0x1d1f99(0x124)+_0x4e51d0);}[a46_0x3a48f2(0x117)](_0xc9c5ca){const _0x439e4e=a46_0x3a48f2,_0x5d1497=this['statusCheckTimers'][_0x439e4e(0x19a)](_0xc9c5ca);_0x5d1497&&(console['log'](_0x439e4e(0x1f8)+_0x5d1497[_0x439e4e(0x1bd)]+'\x20status\x20timers\x20for\x20payment\x20'+_0xc9c5ca),_0x5d1497[_0x439e4e(0x1d5)]((_0x405b36,_0x312a8a)=>{clearTimeout(_0x405b36);}),this[_0x439e4e(0x1ec)][_0x439e4e(0x1c9)](_0xc9c5ca));}async[a46_0x3a48f2(0x192)](_0x22cb69,_0x1685a3,_0x5264cf){const _0x4db67d=a46_0x3a48f2;try{const _0x9002e4=(await Promise[_0x4db67d(0x181)]()[_0x4db67d(0x1ad)](()=>__importStar(require(_0x4db67d(0x1a4)))))[_0x4db67d(0x1b9)],_0x1c65ad={'status':_0x1685a3[_0x4db67d(0x167)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x1685a3===_0x4db67d(0x195)&&(_0x1c65ad[_0x4db67d(0x144)]=new Date()),_0x5264cf[_0x4db67d(0x17e)]&&(_0x1c65ad[_0x4db67d(0x1b5)]=_0x4db67d(0x106)+_0x5264cf[_0x4db67d(0x17e)]),await _0x9002e4[_0x4db67d(0x1dd)][_0x4db67d(0x198)]({'where':{'id':_0x22cb69},'data':_0x1c65ad}),console[_0x4db67d(0x212)](_0x4db67d(0x146)+_0x22cb69+'\x20status\x20updated\x20to\x20'+_0x1685a3),await this[_0x4db67d(0x140)](_0x22cb69,_0x1685a3);}catch(_0x541088){console['error'](_0x4db67d(0x15a)+_0x22cb69+':',_0x541088);}}async[a46_0x3a48f2(0x140)](_0x4b646d,_0x4503bd){const _0x1c2d75=a46_0x3a48f2;try{const _0x480795=(await Promise[_0x1c2d75(0x181)]()[_0x1c2d75(0x1ad)](()=>__importStar(require(_0x1c2d75(0x1a4)))))[_0x1c2d75(0x1b9)],{telegramBotService:_0x475544}=await Promise[_0x1c2d75(0x181)]()[_0x1c2d75(0x1ad)](()=>__importStar(require(_0x1c2d75(0x209)))),_0x119d27=await _0x480795['payment'][_0x1c2d75(0x16d)]({'where':{'id':_0x4b646d},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x119d27)return;const _0x455f99={'PAID':'paid','FAILED':_0x1c2d75(0x11e)},_0x5b180a=_0x455f99[_0x4503bd];_0x5b180a&&await _0x475544[_0x1c2d75(0x21b)](_0x119d27[_0x1c2d75(0x128)],_0x119d27,_0x5b180a),await this[_0x1c2d75(0x134)](_0x119d27,_0x4503bd);}catch(_0x6ecc5b){console[_0x1c2d75(0x1c2)](_0x1c2d75(0x114),_0x6ecc5b);}}async['sendShopWebhook'](_0x29e563,_0x5f4a98){const _0x3b9f09=a46_0x3a48f2,_0x43e991=Date[_0x3b9f09(0x161)]();try{const _0x16cc78=_0x29e563['shop'],_0x198226=_0x16cc78[_0x3b9f09(0xf5)];if(!_0x198226?.[_0x3b9f09(0x18d)]){console[_0x3b9f09(0x212)](_0x3b9f09(0x1ed)+_0x16cc78['id']);return;}const _0x55d93b=_0x5f4a98===_0x3b9f09(0x195)?_0x3b9f09(0x19b):_0x3b9f09(0x155);let _0x44a323=[];if(_0x198226[_0x3b9f09(0x107)])try{_0x44a323=Array[_0x3b9f09(0x20d)](_0x198226['webhookEvents'])?_0x198226[_0x3b9f09(0x107)]:JSON[_0x3b9f09(0x178)](_0x198226[_0x3b9f09(0x107)]);}catch(_0x3ba33c){console[_0x3b9f09(0x1c2)]('Error\x20parsing\x20webhook\x20events:',_0x3ba33c),_0x44a323=[];}if(!_0x44a323[_0x3b9f09(0x1f2)](_0x55d93b)){console[_0x3b9f09(0x212)](_0x3b9f09(0x1b3)+_0x55d93b+_0x3b9f09(0x123)+_0x16cc78['id']);return;}const _0x17e6a0={'event':_0x55d93b,'payment':{'id':_0x29e563['id'],'order_id':_0x29e563[_0x3b9f09(0x1e0)],'gateway_order_id':_0x29e563[_0x3b9f09(0x163)],'gateway':'1111','amount':_0x29e563[_0x3b9f09(0x1d8)],'currency':_0x29e563[_0x3b9f09(0x1df)],'status':_0x5f4a98[_0x3b9f09(0x204)](),'customer_email':_0x29e563[_0x3b9f09(0x1e4)],'customer_name':_0x29e563['customerName'],'created_at':_0x29e563[_0x3b9f09(0x1cc)],'updated_at':new Date()}},_0x3a581e=await fetch(_0x198226['webhookUrl'],{'method':_0x3b9f09(0x19f),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(MasterCard)'},'body':JSON['stringify'](_0x17e6a0)}),_0x5bf276=Date[_0x3b9f09(0x161)]()-_0x43e991;loggerService_1[_0x3b9f09(0x205)]['logShopWebhookSent'](_0x29e563[_0x3b9f09(0x128)],_0x198226['webhookUrl'],_0x55d93b,_0x3a581e[_0x3b9f09(0x158)],_0x5bf276,_0x17e6a0),console[_0x3b9f09(0x212)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x198226[_0x3b9f09(0x18d)]+_0x3b9f09(0x11a)+_0x3a581e[_0x3b9f09(0x158)]+'\x20('+_0x5bf276+_0x3b9f09(0x136));}catch(_0x3f87c4){console[_0x3b9f09(0x1c2)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x3f87c4),loggerService_1['loggerService']['logShopWebhookError'](_0x29e563[_0x3b9f09(0x128)],_0x29e563[_0x3b9f09(0x1f1)]?.[_0x3b9f09(0xf5)]?.[_0x3b9f09(0x18d)]||'unknown','webhook_send',_0x3f87c4,{});}}['maskCardNumber'](_0x443647){const _0x4e0b50=a46_0x3a48f2,_0x376ff2=_0x443647[_0x4e0b50(0x12a)](/[\s-]/g,'');if(_0x376ff2[_0x4e0b50(0x1bd)]<0x4)return _0x4e0b50(0x1e2);return _0x4e0b50(0x182)+_0x376ff2[_0x4e0b50(0x1e7)](-0x4);}async[a46_0x3a48f2(0x1ef)](_0xe3e70,_0xd46a64=a46_0x3a48f2(0x1fa)){const _0x761fbf=a46_0x3a48f2;console['log']('🔄\x20Processing\x20MasterCard\x20webhook\x20data:',JSON[_0x761fbf(0x115)](_0xe3e70,null,0x2));let _0x1aa61a=_0xe3e70,_0x8f8783=_0xd46a64;_0xe3e70[_0x761fbf(0x150)]?(_0x8f8783=_0xe3e70['card_type'][_0x761fbf(0x167)]()===_0x761fbf(0x148)?_0x761fbf(0x148):_0x761fbf(0x1fa),console[_0x761fbf(0x212)](_0x761fbf(0x1d6)+_0x8f8783)):console[_0x761fbf(0x212)](_0x761fbf(0x1f4)+_0x8f8783);if(_0xe3e70[_0x761fbf(0xf6)]&&_0xe3e70[_0x761fbf(0x14e)]&&_0xe3e70['sign']){console[_0x761fbf(0x212)](_0x761fbf(0x1b7));try{const _0x3c9cab=await this['decryptResponsePhp'](_0xe3e70[_0x761fbf(0xf6)],_0xe3e70[_0x761fbf(0x14e)],_0x8f8783);_0x1aa61a=JSON[_0x761fbf(0x178)](_0x3c9cab),console[_0x761fbf(0x212)](_0x761fbf(0xfc)),console[_0x761fbf(0x212)](_0x761fbf(0x17f),JSON[_0x761fbf(0x115)](_0x1aa61a,null,0x2));}catch(_0x47f668){console[_0x761fbf(0x1c2)](_0x761fbf(0x16f),_0x47f668),console[_0x761fbf(0x212)](_0x761fbf(0x1e9)),_0x1aa61a=_0xe3e70;}}else console[_0x761fbf(0x212)](_0x761fbf(0x1ae));let _0x95951d=_0x761fbf(0x16a);if(_0x1aa61a[_0x761fbf(0x158)]===0x64&&_0x1aa61a[_0x761fbf(0x10f)]===0x1)_0x95951d=_0x761fbf(0x195);else{if(_0x1aa61a['final']===0x0)_0x95951d=_0x761fbf(0x16a);else _0x1aa61a[_0x761fbf(0x10f)]===0x1&&_0x1aa61a[_0x761fbf(0x158)]!==0x64?_0x95951d=_0x761fbf(0x1c8):_0x95951d=_0x761fbf(0x16a);}let _0x18d1d6='';if(_0x1aa61a['order_id'])_0x18d1d6=_0x1aa61a[_0x761fbf(0x12d)][_0x761fbf(0x20e)](),console[_0x761fbf(0x212)](_0x761fbf(0x180)+_0x8f8783+_0x761fbf(0x1a5)+_0x18d1d6);else _0x1aa61a[_0x761fbf(0x132)]?(_0x18d1d6=_0x1aa61a['payment_id'][_0x761fbf(0x20e)](),console[_0x761fbf(0x212)]('🔍\x20Using\x20'+_0x8f8783+_0x761fbf(0x1f6)+_0x18d1d6)):(_0x18d1d6=_0x1aa61a[_0x761fbf(0x1e0)]||_0x1aa61a[_0x761fbf(0x12f)]||_0x1aa61a['id']||'',console['log'](_0x761fbf(0x153)+_0x18d1d6));console[_0x761fbf(0x212)](_0x761fbf(0x13f)+_0x8f8783+_0x761fbf(0x1a1)),console[_0x761fbf(0x212)]('\x20\x20\x20Payment\x20ID:\x20'+_0x18d1d6+_0x761fbf(0x138)+_0x1aa61a[_0x761fbf(0x12d)]+_0x761fbf(0x131)+_0x1aa61a['orderId']+_0x761fbf(0x108)+_0x1aa61a[_0x761fbf(0x132)]+',\x20paymentId='+_0x1aa61a[_0x761fbf(0x12f)]+_0x761fbf(0x165)+_0x1aa61a['id']+')'),console[_0x761fbf(0x212)](_0x761fbf(0x137)+_0x95951d+_0x761fbf(0x166)+_0x1aa61a[_0x761fbf(0x158)]+_0x761fbf(0x13c)+_0x1aa61a['final']+')'),console[_0x761fbf(0x212)](_0x761fbf(0x20a)+_0x1aa61a[_0x761fbf(0x1d8)]),console[_0x761fbf(0x212)](_0x761fbf(0x133)+_0x1aa61a[_0x761fbf(0x1df)]);let _0x2a4aa3;_0x95951d==='FAILED'&&_0x1aa61a[_0x761fbf(0x1fb)]&&(_0x2a4aa3=_0x1aa61a[_0x761fbf(0x1fb)],console['log'](_0x761fbf(0x1a8)+_0x2a4aa3));const _0x36fca0={'paymentId':_0x18d1d6,'status':_0x95951d,'amount':_0x1aa61a[_0x761fbf(0x1d8)],'currency':_0x1aa61a[_0x761fbf(0x1df)]};return _0x2a4aa3&&(_0x36fca0['failureMessage']=_0x2a4aa3),_0x36fca0;}[a46_0x3a48f2(0x12c)](){const _0x9c6144=a46_0x3a48f2;console[_0x9c6144(0x212)](_0x9c6144(0x100));const _0x413ddb=this['statusCheckTimers'][_0x9c6144(0x194)];for(const [_0x52b581]of this[_0x9c6144(0x1ec)]){this[_0x9c6144(0x117)](_0x52b581);}console[_0x9c6144(0x212)](_0x9c6144(0x216)+_0x413ddb+_0x9c6144(0x110));}}exports[a46_0x3a48f2(0x18f)]=VisaMasterCardService;