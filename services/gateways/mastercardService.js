'use strict';const a62_0x5582f8=a62_0x7e8b;(function(_0x4a9ef2,_0xc30545){const _0x3efb5a=a62_0x7e8b,_0x50f291=_0x4a9ef2();while(!![]){try{const _0x2a0b48=parseInt(_0x3efb5a(0x2a7))/0x1*(-parseInt(_0x3efb5a(0x1e9))/0x2)+-parseInt(_0x3efb5a(0x307))/0x3*(parseInt(_0x3efb5a(0x2db))/0x4)+parseInt(_0x3efb5a(0x214))/0x5*(parseInt(_0x3efb5a(0x271))/0x6)+-parseInt(_0x3efb5a(0x2ef))/0x7+-parseInt(_0x3efb5a(0x23d))/0x8*(parseInt(_0x3efb5a(0x312))/0x9)+parseInt(_0x3efb5a(0x2ec))/0xa+-parseInt(_0x3efb5a(0x245))/0xb;if(_0x2a0b48===_0xc30545)break;else _0x50f291['push'](_0x50f291['shift']());}catch(_0x5e360f){_0x50f291['push'](_0x50f291['shift']());}}}(a62_0x457f,0xcd180));function a62_0x457f(){const _0x1c0d0b=['Error\x20parsing\x20webhook\x20events:','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','card_type','description','first_name','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','4OPkHDZ','application/json','\x20|\x20Response:\x20',',\x20Desc:\x20','\x20result:','\x20payment_id\x20for\x20search:\x20','üîê\x20MasterCard\x20Private\x20key\x20path:','\x20(from:\x20order_id=','Status\x20','visaApiUrl','HTTP\x20','replace','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','/status_raw','Status:','from','Another\x20unknown\x20error','13358730YNCzzT','‚ùå\x20VISA/MasterCard\x20key\x20validation\x20failed:','Payment\x20returned','3500532pDcjPT','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','\x20status\x20timers\x20for\x20payment\x20','\x20\x20\x20-\x20info\x20length:','üîê\x20MasterCard\x20Public\x20key\x20path:','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','Cash\x20payment\x20is\x20expected\x20at\x20TCO','üìä\x20Status\x20check\x20#','toLowerCase','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','../../config/database','amount','cardType','update','‚ùå\x20RSA\x20signing\x20failed:','‚úÖ\x20Payment\x20','errorMessage','Failed\x20to\x20send\x20MasterCard\x20webhook:','getOwnPropertyDescriptor','size','üîê\x20VISA\x20API\x20URL:','visa_public.pem','cwd','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','689811ZrRXua','‚úÖ\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','===\x20PARSED\x20API\x20RESPONSE\x20===','üìù\x20Encrypted\x20data\x20length:','final','\x20\x20\x20-\x20merchant_point_id:','visaPrivateKeyPath','Failed\x20to\x20send\x20payment\x20notifications:','\x20API:\x20','getDetailedErrorMessage','üîç\x20Using\x20','10098lwyfAH','join','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','üîê\x20MasterCard\x20Private\x20key\x20length:\x20','\x20\x20Original:\x20\x22','üìù\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','üîê\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','üì¶\x20FULL\x20RESPONSE\x20BODY:','/status','last_name','‚ö†Ô∏è\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','\x20\x20\x20','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','https://api.myatranz.com/api','visa_private.pem','PAID','üîê\x20AES\x20key\x20length:','\x20characters','\x20payment\x20status:\x20','/charge','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','../telegramBotService','decryptAES','Request\x20data\x20error','Awaiting\x20confirmation\x20by\x20ivr\x20call','üîê\x20Data\x20signed\x20with\x20RSA','apiUrl',',\x20payment_id=',',\x20paymentId=','üõë\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','Status\x20Text:','VISA','set','processWebhook','üì§\x20Sending\x20request\x20to\x20API...','call','‚è∞\x20Scheduling\x20status\x20checks\x20for\x20','crypto','\x20status\x20checks\x20for\x20payment\x20','-----BEGIN','\x20status\x20updated\x20to\x20','stopAllStatusChecks','charAt','Method\x20not\x20allowed','unknown','Final:','üìù\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','resolve','validateKeyFiles','üìä\x20Checking\x20','prototype','shopId','base64','üîê\x203DS\x20verification\x20required','payment.success','SHA256','LookUp\x20code\x20verified','‚ùå\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','‚úÖ\x20Status\x20response\x20decrypted\x20successfully','üîê\x20RSA\x20signing\x20successful','substring','psp_public.pem','VisaMasterCardService','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','Payment\x20confirmation\x20time\x20has\x20expired','üìù\x20Data\x20to\x20sign\x20length:','configurable','922kqkmxF','Test\x20payment','Payment\x20System/1.0','payment.failed','updatePaymentStatus','üíæ\x20Saving\x20failure\x20message:\x20','text','üí≥\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','No\x20Error\x20executing\x20request',',\x20final=','charge','Error\x20details:','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','üîê\x20AES\x20IV\x20length:','hasOwnProperty','writable','toUpperCase','orderId','keys','private.pem','end','Payment\x20prohibited','MasterCard\x20webhook\x20sent\x20to\x20','settings','createCipheriv','checkPaymentStatus','logWhiteDomainError','\x20status\x20check\x20error:','üîç\x20Using\x20fallback\x20fields\x20for\x20search:\x20','get','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','Sender\x27s\x20card\x20details\x20are\x20required','order_id','üéØ\x20Using\x20','üìù\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','‚ùå\x20Status\x20check\x20#','Return\x20URL:','postcode','failureMessage','masterCardMerchantPointId','stringify','__importStar','post_code','30IxSQwB','üîê\x20MasterCard\x20Public\x20key\x20length:\x20','\x20\x20\x20-\x20sign\x20length:','\x20not\x20enabled\x20for\x20shop\x20','encryptAES','üìä\x20','forEach',',\x20body:\x20','key','Response\x20Headers:','‚úÖ\x20Payment\x20successful','\x20for\x20payment\x20','\x20(from:\x20status=','...','Result\x20URL:','üìù\x20Data\x20length:','üîê\x20VISA\x20Public\x20key\x20length:\x20','\x20order_id\x20for\x20search:\x20','system','3DS\x20verification\x20required','decryptResponse','json','paymentStatuses','logWhiteDomainResponse','privateKeyPath','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','gatewayOrderId','MASTERCARD','__importDefault','No\x20New\x20payment','paymentId','Operation\x20completed\x20successfully','logShopWebhookError','slice','Awaiting\x20confirmation\x20in\x20the\x20application','status','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','‚úÖ\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','desc','webhookEvents','7536lFjHrb','/status_decrypted','message','\x22\x20|\x20\x22','\x20\x20\x20Payment\x20ID:\x20','paid','statusText','sendPaymentNotifications','1193247cvRYzl','encryptRSA','processCardPayment','decryptResponsePhp','readFileSync','error','delete','sign','‚ùå\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','üîê\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','signRSA','üîê\x20MasterCard\x20API\x20URL:','Unknown\x20error','Failed\x20to\x20decrypt\x20response','Payment\x20System/1.0\x20(MasterCard)','üîç\x20','info',':\x20Unknown\x20status\x20code','floor','HTTP\x20error!\x20status:\x20','Amount:','scheduleStatusChecks','üßπ\x20Clearing\x20',',\x20id=','randomBytes','merchantPointId','-----END','üîÑ\x20Processing\x20MasterCard\x20webhook\x20data:','then','Payment\x20is\x20being\x20processed','üí≥\x20Detected\x20MasterCard\x20(starts\x20with\x205)','LookUp\x20code\x20sent','includes','üìù\x20Signature\x20length:','headers','payment_id','üîê\x20VISA\x20Public\x20key\x20path:','none','****\x20****\x20****\x20','\x20with\x20status\x20','https://api.paydmeth.com/api','\x20failed\x20for\x20payment\x20','The\x20card\x20is\x20lost\x20or\x20stolen','1674822EhPsAW','Insufficient\x20funds\x20on\x20the\x20card','Status\x20decryption\x20failed:\x20','logWhiteDomainRequest','/status_decrypt','1111','\x20\x20\x20-\x20method:\x20charge','__createBinding','üîê\x20VISA\x20Private\x20key\x20length:\x20','Client\x20OTP\x20confirmation\x20required','‚ùå\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','üìù\x20Encrypted\x20key\x20length:','sendShopWebhook','Sender\x20information\x20required','__setModuleDefault','RSA_PKCS1_PADDING','privateDecrypt','masterCardApiUrl','length','push','date_success','POST','log','createdAt','publicKeyPath','Number\x20of\x20attempts\x20exceeded','\x20\x20\x20Amount:\x20','‚ùå\x20PHP\x20decryptor\x20request\x20failed:','aes-256-ctr','),\x20stopping\x20status\x20checks','visaPublicKeyPath','webhookUrl','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','failed','parse','statusCheckTimers','create','payment','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','üì¶\x20FULL\x20REQUEST\x20JSON:','‚ùå\x20RSA\x20encryption\x20failed:','maskCardNumber','Payment\x20ID:','default','paidAt','constants','‚ùå\x20Failed\x20to\x20decrypt\x20status\x20response:','Payment\x20confirmation\x20required','Failed\x20payment','sendPaymentNotification','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','/charge_decrypt','\x20payment:\x20','‚ùå\x20Detailed\x20failure\x20description:\x20','597nLBKin','\x20\x20Cleaned:\x20\x20\x22','getCardTypeAndApi','PENDING','generateAESKey','shop','The\x20card\x20does\x20not\x20exist','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','\x20\x20\x20Currency:\x20','now','findUnique','warn','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','FAILED','__esModule','toString','LookUp\x20number\x20of\x20attempts\x20exceeded','üîê\x20AES\x20key\x20and\x20IV\x20generated','\x20status\x20check\x20#','utf8','ms)','trim','Card\x20Holder:','‚ö†Ô∏è\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','existsSync','customerEmail','\x20\x20\x20-\x20key\x20length:','‚úÖ\x20MasterCard\x20key\x20files\x20validated\x20successfully','‚úÖ\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','expire_year','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','clearStatusTimers','üîç\x20Using\x20provided\x20card\x20type:\x20','/charge_raw','Payment\x20cancellation\x20is\x20being\x20processed','3ds_url','/charge_decrypted','üí≥\x20Unknown\x20card\x20type\x20(starts\x20with\x20','currency','number','defineProperty','Cancellation\x20is\x20not\x20possible','isFinalStatus','loggerService','Transaction\x20limit\x20exceeded','Sender\x27s\x20CVV\x20card\x20is\x20required'];a62_0x457f=function(){return _0x1c0d0b;};return a62_0x457f();}function a62_0x7e8b(_0x74ad47,_0x440d34){_0x74ad47=_0x74ad47-0x1cb;const _0x457fb3=a62_0x457f();let _0x7e8b34=_0x457fb3[_0x74ad47];return _0x7e8b34;}var __createBinding=this&&this[a62_0x5582f8(0x278)]||(Object[a62_0x5582f8(0x295)]?function(_0x16671a,_0x16cc64,_0x32c364,_0x255b02){const _0x3d30c2=a62_0x5582f8;if(_0x255b02===undefined)_0x255b02=_0x32c364;var _0x1b166e=Object[_0x3d30c2(0x301)](_0x16cc64,_0x32c364);(!_0x1b166e||(_0x3d30c2(0x206)in _0x1b166e?!_0x16cc64[_0x3d30c2(0x2b5)]:_0x1b166e[_0x3d30c2(0x1f8)]||_0x1b166e[_0x3d30c2(0x1e8)]))&&(_0x1b166e={'enumerable':!![],'get':function(){return _0x16cc64[_0x32c364];}}),Object[_0x3d30c2(0x2cf)](_0x16671a,_0x255b02,_0x1b166e);}:function(_0x1e5565,_0x31fb9b,_0x21a8c4,_0x705f24){if(_0x705f24===undefined)_0x705f24=_0x21a8c4;_0x1e5565[_0x705f24]=_0x31fb9b[_0x21a8c4];}),__setModuleDefault=this&&this[a62_0x5582f8(0x27f)]||(Object[a62_0x5582f8(0x295)]?function(_0x656d9e,_0x115f26){const _0x217fe0=a62_0x5582f8;Object[_0x217fe0(0x2cf)](_0x656d9e,_0x217fe0(0x29c),{'enumerable':!![],'value':_0x115f26});}:function(_0x55cf0f,_0x58c3ae){const _0x43df9d=a62_0x5582f8;_0x55cf0f[_0x43df9d(0x29c)]=_0x58c3ae;}),__importStar=this&&this[a62_0x5582f8(0x212)]||(function(){var _0x2e19e7=function(_0x23e721){return _0x2e19e7=Object['getOwnPropertyNames']||function(_0xa1380d){const _0x2a9bd0=a62_0x7e8b;var _0x35a2b8=[];for(var _0x359109 in _0xa1380d)if(Object[_0x2a9bd0(0x1d8)][_0x2a9bd0(0x1f7)][_0x2a9bd0(0x338)](_0xa1380d,_0x359109))_0x35a2b8[_0x35a2b8[_0x2a9bd0(0x283)]]=_0x359109;return _0x35a2b8;},_0x2e19e7(_0x23e721);};return function(_0x297d90){const _0x533fbb=a62_0x7e8b;if(_0x297d90&&_0x297d90['__esModule'])return _0x297d90;var _0x5b2923={};if(_0x297d90!=null){for(var _0x2c664=_0x2e19e7(_0x297d90),_0x476c91=0x0;_0x476c91<_0x2c664[_0x533fbb(0x283)];_0x476c91++)if(_0x2c664[_0x476c91]!=='default')__createBinding(_0x5b2923,_0x297d90,_0x2c664[_0x476c91]);}return __setModuleDefault(_0x5b2923,_0x297d90),_0x5b2923;};}()),__importDefault=this&&this[a62_0x5582f8(0x230)]||function(_0x15c17e){const _0x439300=a62_0x5582f8;return _0x15c17e&&_0x15c17e[_0x439300(0x2b5)]?_0x15c17e:{'default':_0x15c17e};};Object[a62_0x5582f8(0x2cf)](exports,a62_0x5582f8(0x2b5),{'value':!![]}),exports['VisaMasterCardService']=void 0x0;const crypto_1=__importDefault(require(a62_0x5582f8(0x1cb))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require('../loggerService');class VisaMasterCardService{constructor(){const _0x53d2c3=a62_0x5582f8;this['statusCheckTimers']=new Map(),this[_0x53d2c3(0x22a)]={0x0:{'final':![],'description':_0x53d2c3(0x231)},0x1:{'final':![],'description':_0x53d2c3(0x1f1)},0x2:{'final':!![],'description':_0x53d2c3(0x32c)},0x3:{'final':!![],'description':_0x53d2c3(0x2eb)},0x4:{'final':!![],'description':'Unsuccessful\x20payment'},0x5:{'final':!![],'description':'Payment\x20not\x20found\x20using\x20the\x20specified\x20details'},0x6:{'final':!![],'description':_0x53d2c3(0x2ee)},0x7:{'final':!![],'description':_0x53d2c3(0x1ea)},0x8:{'final':![],'description':_0x53d2c3(0x27a)},0x9:{'final':![],'description':'3DS\x20verification\x20required'},0xa:{'final':![],'description':_0x53d2c3(0x2d4)},0xb:{'final':![],'description':_0x53d2c3(0x27e)},0xc:{'final':![],'description':'Recipient\x20data\x20required'},0xd:{'final':![],'description':_0x53d2c3(0x24e)},0xe:{'final':![],'description':_0x53d2c3(0x32d)},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':'Captcha\x20confirmation\x20awaited'},0x11:{'final':![],'description':_0x53d2c3(0x329)},0x12:{'final':![],'description':_0x53d2c3(0x236)},0x13:{'final':![],'description':_0x53d2c3(0x263)},0x14:{'final':![],'description':_0x53d2c3(0x2ae)},0x15:{'final':![],'description':'Expected\x20bitcoin\x20transfer\x20from\x20client'},0x16:{'final':![],'description':'Payment\x20pending\x20verification'},0x18:{'final':![],'description':'The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'},0x19:{'final':![],'description':_0x53d2c3(0x1e5)},0x1a:{'final':!![],'description':_0x53d2c3(0x2f5)},0x1b:{'final':![],'description':_0x53d2c3(0x319)},0x1c:{'final':![],'description':_0x53d2c3(0x1f5)},0x1d:{'final':![],'description':_0x53d2c3(0x2f8)},0x1f:{'final':![],'description':_0x53d2c3(0x207)},0x20:{'final':![],'description':_0x53d2c3(0x297)},0x23:{'final':![],'description':_0x53d2c3(0x208)},0x24:{'final':!![],'description':_0x53d2c3(0x1e6)},0x25:{'final':!![],'description':_0x53d2c3(0x1fe)},0x26:{'final':!![],'description':_0x53d2c3(0x238)},0x27:{'final':!![],'description':_0x53d2c3(0x272)},0x28:{'final':!![],'description':_0x53d2c3(0x2ad)},0x29:{'final':!![],'description':_0x53d2c3(0x270)},0x2a:{'final':!![],'description':'Invalid\x20expiration\x20date'},0x2b:{'final':!![],'description':_0x53d2c3(0x2d3)},0x2c:{'final':!![],'description':_0x53d2c3(0x22d)},0x2d:{'final':!![],'description':_0x53d2c3(0x2a1)},0x2e:{'final':!![],'description':'Unsuccessful\x20payment'},0x2f:{'final':!![],'description':'Unsuccessful\x20payment'},0x30:{'final':!![],'description':'Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled'},0x31:{'final':![],'description':_0x53d2c3(0x2a0)},0x32:{'final':!![],'description':_0x53d2c3(0x1d1)},0x33:{'final':!![],'description':_0x53d2c3(0x2a1)},0x34:{'final':!![],'description':'Failed\x20payment'},0x35:{'final':!![],'description':_0x53d2c3(0x2a1)},0x36:{'final':!![],'description':_0x53d2c3(0x2a1)},0x37:{'final':!![],'description':_0x53d2c3(0x2a1)},0x38:{'final':!![],'description':_0x53d2c3(0x2d0)},0x39:{'final':![],'description':_0x53d2c3(0x321)},0x3a:{'final':![],'description':_0x53d2c3(0x265)},0x3b:{'final':!![],'description':_0x53d2c3(0x1de)},0x3c:{'final':!![],'description':_0x53d2c3(0x28a)},0x3d:{'final':!![],'description':_0x53d2c3(0x239)},0x3e:{'final':!![],'description':_0x53d2c3(0x2f4)},0x3f:{'final':!![],'description':_0x53d2c3(0x2ee)},0x40:{'final':![],'description':'LookUp\x20not\x20confirmed'},0x41:{'final':!![],'description':_0x53d2c3(0x2b7)},0x42:{'final':![],'description':_0x53d2c3(0x2c9)},0x43:{'final':!![],'description':_0x53d2c3(0x306)},0x44:{'final':![],'description':_0x53d2c3(0x227)},0x45:{'final':!![],'description':_0x53d2c3(0x2a1)},0x46:{'final':!![],'description':_0x53d2c3(0x2a1)},0x47:{'final':!![],'description':_0x53d2c3(0x31a)},0x64:{'final':!![],'description':_0x53d2c3(0x233)}},this[_0x53d2c3(0x282)]=_0x53d2c3(0x322),this[_0x53d2c3(0x210)]=0x50ca,this[_0x53d2c3(0x22c)]=path_1['default'][_0x53d2c3(0x313)](process['cwd'](),'keys',_0x53d2c3(0x1fc)),this[_0x53d2c3(0x289)]=path_1[_0x53d2c3(0x29c)]['join'](process[_0x53d2c3(0x305)](),'keys',_0x53d2c3(0x1e3)),this[_0x53d2c3(0x2e4)]=_0x53d2c3(0x26e),this['visaMerchantPointId']=0x6b7,this['visaPrivateKeyPath']=path_1[_0x53d2c3(0x29c)][_0x53d2c3(0x313)](process['cwd'](),_0x53d2c3(0x1fb),_0x53d2c3(0x323)),this['visaPublicKeyPath']=path_1[_0x53d2c3(0x29c)][_0x53d2c3(0x313)](process[_0x53d2c3(0x305)](),_0x53d2c3(0x1fb),_0x53d2c3(0x304)),console[_0x53d2c3(0x287)]('üí≥\x20VISA/MasterCard\x20service\x20initialized'),console[_0x53d2c3(0x287)](_0x53d2c3(0x251),this[_0x53d2c3(0x282)]),console[_0x53d2c3(0x287)](_0x53d2c3(0x303),this['visaApiUrl']),console[_0x53d2c3(0x287)](_0x53d2c3(0x2e1),this[_0x53d2c3(0x22c)]),console[_0x53d2c3(0x287)](_0x53d2c3(0x2f3),this[_0x53d2c3(0x289)]),console[_0x53d2c3(0x287)]('üîê\x20VISA\x20Private\x20key\x20path:',this[_0x53d2c3(0x30d)]),console[_0x53d2c3(0x287)](_0x53d2c3(0x26a),this[_0x53d2c3(0x28f)]),this[_0x53d2c3(0x1d6)]();}[a62_0x5582f8(0x310)](_0x47f69b,_0x124c6f){const _0x433abe=a62_0x5582f8,_0x36411f=this['paymentStatuses'][_0x47f69b];let _0x72158a='';_0x36411f?_0x72158a=_0x433abe(0x2e3)+_0x47f69b+':\x20'+_0x36411f['description']:_0x72158a=_0x433abe(0x2e3)+_0x47f69b+_0x433abe(0x257);if(_0x124c6f&&_0x124c6f[_0x433abe(0x2bc)]()){const _0x4b79be=_0x124c6f['trim']();(!_0x36411f||_0x4b79be[_0x433abe(0x2f7)]()!==_0x36411f[_0x433abe(0x2d8)][_0x433abe(0x2f7)]())&&(_0x72158a+=_0x433abe(0x2dd)+_0x4b79be);}return _0x72158a;}[a62_0x5582f8(0x2d1)](_0x1b85df){const _0x52571f=a62_0x5582f8,_0x225673=this[_0x52571f(0x22a)][_0x1b85df];return _0x225673?_0x225673[_0x52571f(0x30b)]:!![];}[a62_0x5582f8(0x2a9)](_0x7e9b34){const _0x2161a1=a62_0x5582f8,_0x1a9775=_0x7e9b34[_0x2161a1(0x1d0)](0x0);if(_0x1a9775==='4')return console['log'](_0x2161a1(0x1f0)),{'cardType':'VISA','apiUrl':this[_0x2161a1(0x2e4)],'privateKeyPath':this['visaPrivateKeyPath'],'publicKeyPath':this[_0x2161a1(0x28f)],'merchantPointId':this['visaMerchantPointId']};else return _0x1a9775==='5'?(console[_0x2161a1(0x287)](_0x2161a1(0x264)),{'cardType':_0x2161a1(0x22f),'apiUrl':this[_0x2161a1(0x282)],'privateKeyPath':this[_0x2161a1(0x22c)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x2161a1(0x210)]}):(console[_0x2161a1(0x287)](_0x2161a1(0x2cc)+_0x1a9775+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':_0x2161a1(0x22f),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x2161a1(0x289)],'merchantPointId':this['masterCardMerchantPointId']});}['validateKeyFiles'](){const _0x5caa41=a62_0x5582f8;try{if(!fs_1[_0x5caa41(0x29c)][_0x5caa41(0x2bf)](this[_0x5caa41(0x22c)]))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this[_0x5caa41(0x22c)]);if(!fs_1['default'][_0x5caa41(0x2bf)](this[_0x5caa41(0x289)]))throw new Error(_0x5caa41(0x2b3)+this[_0x5caa41(0x289)]);const _0x23f455=fs_1['default'][_0x5caa41(0x249)](this['privateKeyPath'],'utf8')['trim'](),_0x5406aa=fs_1[_0x5caa41(0x29c)]['readFileSync'](this[_0x5caa41(0x289)],_0x5caa41(0x2ba))['trim']();if(!_0x23f455[_0x5caa41(0x266)](_0x5caa41(0x1cd))||!_0x23f455['includes'](_0x5caa41(0x260)))throw new Error(_0x5caa41(0x2e7));if(!_0x5406aa[_0x5caa41(0x266)](_0x5caa41(0x1cd))||!_0x5406aa[_0x5caa41(0x266)]('-----END'))throw new Error(_0x5caa41(0x314));console[_0x5caa41(0x287)](_0x5caa41(0x2c2)),console[_0x5caa41(0x287)](_0x5caa41(0x315)+_0x23f455[_0x5caa41(0x283)]+_0x5caa41(0x326)),console[_0x5caa41(0x287)](_0x5caa41(0x215)+_0x5406aa['length']+'\x20characters');if(fs_1[_0x5caa41(0x29c)][_0x5caa41(0x2bf)](this['visaPrivateKeyPath'])&&fs_1[_0x5caa41(0x29c)][_0x5caa41(0x2bf)](this[_0x5caa41(0x28f)])){const _0x479393=fs_1['default'][_0x5caa41(0x249)](this[_0x5caa41(0x30d)],_0x5caa41(0x2ba))['trim'](),_0xd5f4f8=fs_1[_0x5caa41(0x29c)][_0x5caa41(0x249)](this['visaPublicKeyPath'],'utf8')[_0x5caa41(0x2bc)]();(!_0x479393[_0x5caa41(0x266)]('-----BEGIN')||!_0x479393[_0x5caa41(0x266)](_0x5caa41(0x260)))&&console['warn']('‚ö†Ô∏è\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),(!_0xd5f4f8['includes'](_0x5caa41(0x1cd))||!_0xd5f4f8[_0x5caa41(0x266)](_0x5caa41(0x260)))&&console[_0x5caa41(0x2b2)]('‚ö†Ô∏è\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),console[_0x5caa41(0x287)]('‚úÖ\x20VISA\x20key\x20files\x20validated\x20successfully'),console[_0x5caa41(0x287)](_0x5caa41(0x279)+_0x479393[_0x5caa41(0x283)]+_0x5caa41(0x326)),console[_0x5caa41(0x287)](_0x5caa41(0x224)+_0xd5f4f8[_0x5caa41(0x283)]+'\x20characters');}else console['warn'](_0x5caa41(0x31f)),console[_0x5caa41(0x2b2)]('‚ö†Ô∏è\x20Expected\x20VISA\x20private\x20key:\x20'+this[_0x5caa41(0x30d)]),console['warn']('‚ö†Ô∏è\x20Expected\x20VISA\x20public\x20key:\x20'+this[_0x5caa41(0x28f)]);}catch(_0x225b88){console[_0x5caa41(0x24a)](_0x5caa41(0x2ed),_0x225b88);throw _0x225b88;}}['generateAESKey'](){const _0xea0555=a62_0x5582f8,_0x39e919=crypto_1[_0xea0555(0x29c)][_0xea0555(0x25e)](0x20),_0x57d097=crypto_1['default'][_0xea0555(0x25e)](0x10);return{'key':_0x39e919,'iv':_0x57d097};}[a62_0x5582f8(0x218)](_0xf0e320,_0x5def74,_0x14aec0){const _0x14a2ed=a62_0x5582f8,_0x139ce6=crypto_1['default'][_0x14a2ed(0x201)](_0x14a2ed(0x28d),_0x5def74,_0x14aec0);let _0x4d04b0=_0x139ce6[_0x14a2ed(0x2fc)](_0xf0e320,_0x14a2ed(0x2ba),_0x14a2ed(0x1da));return _0x4d04b0+=_0x139ce6[_0x14a2ed(0x30b)](_0x14a2ed(0x1da)),_0x4d04b0;}['encryptRSA'](_0x27aed7,_0x229f1a,_0x3242a5){const _0x518064=a62_0x5582f8;try{const _0x130590=fs_1['default']['readFileSync'](_0x3242a5,'utf8')[_0x518064(0x2bc)](),_0x3cd533={'iv':_0x229f1a[_0x518064(0x2b6)](_0x518064(0x1da)),'key':_0x27aed7[_0x518064(0x2b6)](_0x518064(0x1da))},_0x4d74aa=JSON[_0x518064(0x211)](_0x3cd533);console[_0x518064(0x287)](_0x518064(0x24f),_0x4d74aa[_0x518064(0x283)]);const _0x1366be=crypto_1[_0x518064(0x29c)]['publicEncrypt']({'key':_0x130590,'padding':crypto_1[_0x518064(0x29c)][_0x518064(0x29e)][_0x518064(0x280)]},Buffer[_0x518064(0x2ea)](_0x4d74aa));return console['log'](_0x518064(0x2c3),_0x1366be[_0x518064(0x283)]),_0x1366be[_0x518064(0x2b6)](_0x518064(0x1da));}catch(_0x46ab72){console[_0x518064(0x24a)](_0x518064(0x299),_0x46ab72);throw new Error(_0x518064(0x318));}}[a62_0x5582f8(0x250)](_0x2d4e19,_0x12f45c){const _0x2a3056=a62_0x5582f8;try{const _0x4053b0=fs_1[_0x2a3056(0x29c)]['readFileSync'](_0x12f45c,_0x2a3056(0x2ba))['trim'](),_0x5abde3=crypto_1[_0x2a3056(0x29c)]['createSign'](_0x2a3056(0x1dd));_0x5abde3[_0x2a3056(0x2fc)](_0x2d4e19),_0x5abde3[_0x2a3056(0x1fd)]();const _0x12937e=_0x5abde3[_0x2a3056(0x24c)](_0x4053b0,'base64');return console[_0x2a3056(0x287)](_0x2a3056(0x1e1)),console[_0x2a3056(0x287)](_0x2a3056(0x1e7),_0x2d4e19[_0x2a3056(0x283)]),console[_0x2a3056(0x287)](_0x2a3056(0x267),_0x12937e[_0x2a3056(0x283)]),_0x12937e;}catch(_0x4442a2){console[_0x2a3056(0x24a)](_0x2a3056(0x2fd),_0x4442a2),console['error']('‚ùå\x20Data\x20being\x20signed:',_0x2d4e19[_0x2a3056(0x1e2)](0x0,0xc8)+_0x2a3056(0x221));throw new Error(_0x2a3056(0x2d6));}}[a62_0x5582f8(0x32b)](_0x4871de,_0x23e5d9,_0x4581d7){const _0x1b66de=a62_0x5582f8,_0x5adf74=crypto_1[_0x1b66de(0x29c)]['createDecipheriv'](_0x1b66de(0x28d),_0x23e5d9,_0x4581d7);let _0x2725a8=_0x5adf74[_0x1b66de(0x2fc)](_0x4871de,_0x1b66de(0x1da),'utf8');return _0x2725a8+=_0x5adf74['final'](_0x1b66de(0x2ba)),_0x2725a8;}async[a62_0x5582f8(0x248)](_0x2bcc54,_0x4221fb,_0x10073f=a62_0x5582f8(0x22f)){const _0x576944=a62_0x5582f8;try{const _0x536bae=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x576944(0x286),'headers':{'Content-Type':'application/json'},'body':JSON[_0x576944(0x211)]({'info':_0x2bcc54,'key':_0x4221fb,'card_type':_0x10073f[_0x576944(0x2f7)]()})});if(!_0x536bae['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x536bae[_0x576944(0x1ef)]();}catch(_0x5b9cde){console[_0x576944(0x24a)](_0x576944(0x28c),_0x5b9cde);throw new Error(_0x576944(0x291));}}[a62_0x5582f8(0x228)](_0x2ccdc5,_0x3118bb){const _0x2dbd5a=a62_0x5582f8;try{const _0x318c6c=fs_1[_0x2dbd5a(0x29c)][_0x2dbd5a(0x249)](this[_0x2dbd5a(0x22c)],_0x2dbd5a(0x2ba))[_0x2dbd5a(0x2bc)](),_0x32ac5b=crypto_1[_0x2dbd5a(0x29c)][_0x2dbd5a(0x281)](_0x318c6c,Buffer[_0x2dbd5a(0x2ea)](_0x3118bb,_0x2dbd5a(0x1da))),_0x4fd22b=JSON[_0x2dbd5a(0x293)](_0x32ac5b[_0x2dbd5a(0x2b6)]()),_0x1c3219=Buffer['from'](_0x4fd22b[_0x2dbd5a(0x21c)],_0x2dbd5a(0x1da)),_0x4f396b=Buffer[_0x2dbd5a(0x2ea)](_0x4fd22b['iv'],'base64');return this[_0x2dbd5a(0x32b)](_0x2ccdc5,_0x1c3219,_0x4f396b);}catch(_0x4ab96f){throw new Error(_0x2dbd5a(0x253));}}async[a62_0x5582f8(0x247)](_0x310e4b){const _0x53a59f=a62_0x5582f8,{paymentId:_0x5c9e12,orderId:_0x5863e2,amount:_0x44fd26,currency:_0x588761,cardData:_0x308d7e,resultUrl:_0x588302,returnUrl:_0x545b3e,cardHolder:_0x527c43,browser:_0x2e5795}=_0x310e4b;console[_0x53a59f(0x287)](_0x53a59f(0x2da)),console[_0x53a59f(0x287)]('Payment\x20ID:',_0x5c9e12),console[_0x53a59f(0x287)]('Order\x20ID:',_0x5863e2),console[_0x53a59f(0x287)](_0x53a59f(0x25a),_0x44fd26,_0x588761),console['log']('Card\x20Number:',this[_0x53a59f(0x29a)](_0x308d7e['number'])),console['log'](_0x53a59f(0x2bd),_0x527c43[_0x53a59f(0x2d9)]+'\x20'+_0x527c43[_0x53a59f(0x31e)]),console[_0x53a59f(0x287)](_0x53a59f(0x20d),_0x545b3e),console[_0x53a59f(0x287)](_0x53a59f(0x222),_0x588302);const _0x32a31c=this[_0x53a59f(0x2a9)](_0x308d7e[_0x53a59f(0x2ce)]);console[_0x53a59f(0x287)](_0x53a59f(0x20a)+_0x32a31c[_0x53a59f(0x2fb)]+_0x53a59f(0x30f)+_0x32a31c[_0x53a59f(0x32f)]),console['log']('üîê\x20Using\x20keys:\x20'+_0x32a31c['privateKeyPath']+',\x20'+_0x32a31c[_0x53a59f(0x289)]);const _0x46173f={..._0x527c43,'first_name':_0x527c43[_0x53a59f(0x2d9)]?.[_0x53a59f(0x2e6)](/[\t\n\r\f\v]/g,'\x20')[_0x53a59f(0x2bc)]()||'','last_name':_0x527c43[_0x53a59f(0x31e)]?.[_0x53a59f(0x2e6)](/[\t\n\r\f\v]/g,'\x20')['trim']()||''};'postcode'in _0x46173f&&!(_0x53a59f(0x213)in _0x46173f)&&(_0x46173f[_0x53a59f(0x213)]=_0x46173f[_0x53a59f(0x20e)],delete _0x46173f[_0x53a59f(0x20e)],console[_0x53a59f(0x287)]('üîÑ\x20Converted\x20postcode\x20to\x20post_code:\x20'+_0x46173f['post_code']));console[_0x53a59f(0x287)]('üßπ\x20Card\x20holder\x20names\x20cleaned:'),console[_0x53a59f(0x287)](_0x53a59f(0x316)+_0x527c43[_0x53a59f(0x2d9)]+_0x53a59f(0x240)+_0x527c43[_0x53a59f(0x31e)]+'\x22'),console[_0x53a59f(0x287)](_0x53a59f(0x2a8)+_0x46173f[_0x53a59f(0x2d9)]+_0x53a59f(0x240)+_0x46173f[_0x53a59f(0x31e)]+'\x22'),console[_0x53a59f(0x287)]('üìç\x20Full\x20card\x20holder\x20data:',JSON[_0x53a59f(0x211)](_0x46173f,null,0x2));const _0x7f1942={'amount':_0x44fd26,'currency':_0x588761[_0x53a59f(0x1f9)](),'order_id':_0x5863e2,'result_url':_0x588302,'return_url':_0x545b3e,'country':'','card':{'number':_0x308d7e[_0x53a59f(0x2ce)],'expire_month':_0x308d7e['expire_month'],'expire_year':_0x308d7e[_0x53a59f(0x2c4)],'cvv':_0x308d7e['cvv']},'card_holder':_0x46173f,'browser':_0x2e5795},_0x1e9fe3=JSON[_0x53a59f(0x211)](_0x7f1942);console[_0x53a59f(0x287)]('üíæ\x20Payment\x20data\x20prepared'),console[_0x53a59f(0x287)](_0x53a59f(0x20b)),console[_0x53a59f(0x287)](_0x1e9fe3),console[_0x53a59f(0x287)](_0x53a59f(0x223),_0x1e9fe3[_0x53a59f(0x283)]);try{const {key:_0x101403,iv:_0x2d2782}=this[_0x53a59f(0x2ab)]();console['log'](_0x53a59f(0x2b8)),console[_0x53a59f(0x287)](_0x53a59f(0x325),_0x101403[_0x53a59f(0x283)]),console[_0x53a59f(0x287)](_0x53a59f(0x1f6),_0x2d2782[_0x53a59f(0x283)]);const _0x10127d=this[_0x53a59f(0x218)](_0x1e9fe3,_0x101403,_0x2d2782);console[_0x53a59f(0x287)]('üîê\x20Data\x20encrypted\x20with\x20AES'),console[_0x53a59f(0x287)](_0x53a59f(0x30a),_0x10127d[_0x53a59f(0x283)]);const _0x4528dc=this[_0x53a59f(0x246)](_0x101403,_0x2d2782,_0x32a31c[_0x53a59f(0x289)]);console['log']('üîê\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x53a59f(0x287)](_0x53a59f(0x27c),_0x4528dc[_0x53a59f(0x283)]);const _0x1a11ee=this[_0x53a59f(0x250)](_0x1e9fe3,_0x32a31c[_0x53a59f(0x22c)]);console[_0x53a59f(0x287)](_0x53a59f(0x32e)),console[_0x53a59f(0x287)](_0x53a59f(0x267),_0x1a11ee[_0x53a59f(0x283)]);const _0x2ef4e5={'merchant_point_id':_0x32a31c[_0x53a59f(0x25f)],'method':_0x53a59f(0x1f3),'info':_0x10127d,'key':_0x4528dc,'sign':_0x1a11ee,'lang':'en'};console[_0x53a59f(0x287)](_0x53a59f(0x337)),console[_0x53a59f(0x287)]('üìù\x20Final\x20request\x20structure:'),console['log'](_0x53a59f(0x30c),_0x32a31c[_0x53a59f(0x25f)]),console[_0x53a59f(0x287)](_0x53a59f(0x277)),console['log'](_0x53a59f(0x2f2),_0x10127d[_0x53a59f(0x283)]),console[_0x53a59f(0x287)](_0x53a59f(0x2c1),_0x4528dc[_0x53a59f(0x283)]),console['log'](_0x53a59f(0x216),_0x1a11ee[_0x53a59f(0x283)]),console['log']('\x20\x20\x20-\x20lang:\x20en'),console[_0x53a59f(0x287)](''),console[_0x53a59f(0x287)](_0x53a59f(0x298)),console[_0x53a59f(0x287)](JSON[_0x53a59f(0x211)](_0x2ef4e5,null,0x2)),console[_0x53a59f(0x287)](''),loggerService_1['loggerService'][_0x53a59f(0x274)](_0x32a31c[_0x53a59f(0x2fb)][_0x53a59f(0x2f7)](),_0x53a59f(0x328),_0x53a59f(0x286),{'merchant_point_id':_0x32a31c['merchantPointId'],'method':_0x53a59f(0x1f3),'lang':'en'});const _0x3c4c0a=Date['now'](),_0x370270=await fetch(_0x32a31c[_0x53a59f(0x32f)],{'method':_0x53a59f(0x286),'headers':{'Content-Type':_0x53a59f(0x2dc),'Accept':_0x53a59f(0x2dc),'User-Agent':_0x53a59f(0x1eb)},'body':JSON['stringify'](_0x2ef4e5)}),_0x2f9d8d=Date[_0x53a59f(0x2b0)]()-_0x3c4c0a;console[_0x53a59f(0x287)]('===\x20API\x20RESPONSE\x20==='),console[_0x53a59f(0x287)](_0x53a59f(0x2e9),_0x370270[_0x53a59f(0x237)]),console[_0x53a59f(0x287)](_0x53a59f(0x333),_0x370270[_0x53a59f(0x243)]),console[_0x53a59f(0x287)]('Response\x20Time:',_0x2f9d8d+'ms'),console[_0x53a59f(0x287)](_0x53a59f(0x21d)),_0x370270[_0x53a59f(0x268)][_0x53a59f(0x21a)]((_0x220b80,_0x43c7ec)=>{const _0x49c431=_0x53a59f;console[_0x49c431(0x287)](_0x49c431(0x320)+_0x43c7ec+':\x20'+_0x220b80);}),console[_0x53a59f(0x287)]('');if(!_0x370270['ok']){const _0x6ef899=await _0x370270[_0x53a59f(0x1ef)]();console[_0x53a59f(0x24a)]('HTTP\x20Status:',_0x370270[_0x53a59f(0x237)]),console['error'](_0x53a59f(0x31c)),console[_0x53a59f(0x24a)](_0x6ef899),console['error'](''),loggerService_1[_0x53a59f(0x2d2)][_0x53a59f(0x22b)](_0x32a31c[_0x53a59f(0x2fb)]['toLowerCase'](),_0x53a59f(0x2c8),_0x370270[_0x53a59f(0x237)],_0x6ef899,_0x2f9d8d),loggerService_1['loggerService'][_0x53a59f(0x203)](_0x32a31c[_0x53a59f(0x2fb)][_0x53a59f(0x2f7)](),_0x53a59f(0x328),_0x53a59f(0x2e5)+_0x370270[_0x53a59f(0x237)]+':\x20'+_0x6ef899);throw new Error(_0x53a59f(0x259)+_0x370270[_0x53a59f(0x237)]+_0x53a59f(0x21b)+_0x6ef899);}const _0x326be5=await _0x370270[_0x53a59f(0x229)]();console[_0x53a59f(0x287)]('üì¶\x20FULL\x20RESPONSE\x20JSON:'),console['log'](JSON[_0x53a59f(0x211)](_0x326be5,null,0x2)),console[_0x53a59f(0x287)](''),loggerService_1[_0x53a59f(0x2d2)][_0x53a59f(0x22b)](_0x32a31c[_0x53a59f(0x2fb)][_0x53a59f(0x2f7)](),_0x53a59f(0x2c8),_0x370270[_0x53a59f(0x237)],_0x326be5,_0x2f9d8d),console['log'](_0x53a59f(0x309));let _0xd73af5=_0x326be5;if(_0x326be5[_0x53a59f(0x256)]&&_0x326be5[_0x53a59f(0x21c)]&&_0x326be5[_0x53a59f(0x24c)]){console[_0x53a59f(0x287)]('üîê\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x19f4bd=await this['decryptResponsePhp'](_0x326be5[_0x53a59f(0x256)],_0x326be5[_0x53a59f(0x21c)],_0x32a31c[_0x53a59f(0x2fb)]);_0xd73af5=JSON[_0x53a59f(0x293)](_0x19f4bd),console[_0x53a59f(0x287)](_0x53a59f(0x308)),loggerService_1[_0x53a59f(0x2d2)][_0x53a59f(0x22b)](_0x32a31c[_0x53a59f(0x2fb)][_0x53a59f(0x2f7)](),_0x53a59f(0x2cb),_0x370270[_0x53a59f(0x237)],_0xd73af5,_0x2f9d8d),console[_0x53a59f(0x287)]('üìù\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x70d0de){console['error']('‚ùå\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x70d0de),loggerService_1['loggerService'][_0x53a59f(0x203)](_0x32a31c[_0x53a59f(0x2fb)][_0x53a59f(0x2f7)](),_0x53a59f(0x2a4),'Decryption\x20failed:\x20'+_0x70d0de),_0xd73af5=_0x326be5;}}else loggerService_1['loggerService'][_0x53a59f(0x22b)](_0x32a31c[_0x53a59f(0x2fb)]['toLowerCase'](),_0x53a59f(0x2cb),_0x370270[_0x53a59f(0x237)],_0xd73af5,_0x2f9d8d),console[_0x53a59f(0x287)](_0x53a59f(0x317));console[_0x53a59f(0x287)](_0x53a59f(0x2e9),_0xd73af5['status']),console[_0x53a59f(0x287)](_0x53a59f(0x1d3),_0xd73af5[_0x53a59f(0x30b)]),console['log'](_0x53a59f(0x29b),_0xd73af5[_0x53a59f(0x269)]),console[_0x53a59f(0x287)]('3DS\x20URL:',_0xd73af5[_0x53a59f(0x2ca)]||_0x53a59f(0x26b));if(_0xd73af5['status']===0x64&&_0xd73af5['final']===0x1)return console[_0x53a59f(0x287)](_0x53a59f(0x21e)),{'gateway_payment_id':_0xd73af5['payment_id']?.[_0x53a59f(0x2b6)](),'payment_url':_0x545b3e,'requires_3ds':![],'status':_0x53a59f(0x324),'final':!![]};if(_0xd73af5['3ds_url'])return console[_0x53a59f(0x287)](_0x53a59f(0x1db)),this[_0x53a59f(0x25b)](_0x5c9e12,_0x5863e2,_0xd73af5[_0x53a59f(0x269)]?.[_0x53a59f(0x2b6)]()||_0x5863e2,_0x32a31c[_0x53a59f(0x2fb)]),{'gateway_payment_id':_0xd73af5['payment_id']?.['toString'](),'payment_url':_0xd73af5[_0x53a59f(0x2ca)],'requires_3ds':!![],'threeds_url':_0xd73af5['3ds_url'],'status':_0x53a59f(0x2aa),'final':![]};let _0x4035b6=this[_0x53a59f(0x310)](_0xd73af5['status'],_0xd73af5[_0x53a59f(0x23b)]||_0xd73af5[_0x53a59f(0x23f)]),_0x53ea33=_0xd73af5[_0x53a59f(0x237)],_0x36b8aa=this[_0x53a59f(0x2d1)](_0xd73af5[_0x53a59f(0x237)]);return console[_0x53a59f(0x287)](_0x53a59f(0x24d)+_0x53ea33+',\x20Final:\x20'+_0x36b8aa+_0x53a59f(0x2de)+_0x4035b6),{'gateway_payment_id':_0xd73af5['payment_id']?.[_0x53a59f(0x2b6)](),'payment_url':_0x545b3e,'requires_3ds':![],'status':_0x53a59f(0x2b4),'final':!![],'errorMessage':_0x4035b6};}catch(_0x2d85d8){console['error'](_0x53a59f(0x2a3)),console['error'](_0x53a59f(0x1f4),_0x2d85d8),loggerService_1[_0x53a59f(0x2d2)]['logWhiteDomainError']('visa/mastercard',_0x53a59f(0x328),_0x2d85d8);throw new Error(_0x53a59f(0x2f0)+(_0x2d85d8 instanceof Error?_0x2d85d8[_0x53a59f(0x23f)]:_0x53a59f(0x252)));}}async['checkPaymentStatus'](_0xfcf069,_0x2ffd00,_0x3da40c=a62_0x5582f8(0x334)){const _0x34fcd2=a62_0x5582f8;console[_0x34fcd2(0x287)](_0x34fcd2(0x1d7)+_0x3da40c+_0x34fcd2(0x327)+_0xfcf069+'\x20('+_0x2ffd00+')');try{const _0x2f8e3={'payment_id':_0xfcf069,'order_id':_0x2ffd00},_0x29a55c=JSON[_0x34fcd2(0x211)](_0x2f8e3),_0x46424a=this[_0x34fcd2(0x2a9)](_0x3da40c===_0x34fcd2(0x334)?'4000000000000000':'5000000000000000'),{key:_0xc66a7,iv:_0x1bceb6}=this[_0x34fcd2(0x2ab)](),_0x461aa3=this[_0x34fcd2(0x218)](_0x29a55c,_0xc66a7,_0x1bceb6),_0x5ea2e4=this['encryptRSA'](_0xc66a7,_0x1bceb6,_0x46424a['publicKeyPath']),_0x443efe=this[_0x34fcd2(0x250)](_0x29a55c,_0x46424a[_0x34fcd2(0x22c)]),_0x4ea7ef={'merchant_point_id':_0x46424a['merchantPointId'],'method':_0x34fcd2(0x237),'info':_0x461aa3,'key':_0x5ea2e4,'sign':_0x443efe,'lang':'en'};loggerService_1[_0x34fcd2(0x2d2)][_0x34fcd2(0x274)](_0x3da40c['toLowerCase'](),_0x34fcd2(0x31d),'POST',{'merchant_point_id':_0x46424a[_0x34fcd2(0x25f)],'method':_0x34fcd2(0x237),'lang':'en'});const _0x5e6664=Date[_0x34fcd2(0x2b0)](),_0x3f4f76=await fetch(_0x46424a[_0x34fcd2(0x32f)],{'method':_0x34fcd2(0x286),'headers':{'Content-Type':_0x34fcd2(0x2dc),'Accept':_0x34fcd2(0x2dc),'User-Agent':_0x34fcd2(0x1eb)},'body':JSON[_0x34fcd2(0x211)](_0x4ea7ef)}),_0x314f89=Date[_0x34fcd2(0x2b0)]()-_0x5e6664;if(!_0x3f4f76['ok']){const _0x31788f=await _0x3f4f76[_0x34fcd2(0x1ef)]();loggerService_1[_0x34fcd2(0x2d2)][_0x34fcd2(0x22b)](_0x3da40c['toLowerCase'](),_0x34fcd2(0x2e8),_0x3f4f76[_0x34fcd2(0x237)],_0x31788f,_0x314f89);throw new Error(_0x34fcd2(0x259)+_0x3f4f76[_0x34fcd2(0x237)]);}const _0x2286ee=await _0x3f4f76[_0x34fcd2(0x229)]();loggerService_1[_0x34fcd2(0x2d2)][_0x34fcd2(0x22b)](_0x3da40c[_0x34fcd2(0x2f7)](),_0x34fcd2(0x2e8),_0x3f4f76[_0x34fcd2(0x237)],_0x2286ee,_0x314f89);let _0x415737=_0x2286ee;if(_0x2286ee['info']&&_0x2286ee[_0x34fcd2(0x21c)]&&_0x2286ee[_0x34fcd2(0x24c)]){console[_0x34fcd2(0x287)]('üîê\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0x23ff22=await this[_0x34fcd2(0x248)](_0x2286ee['info'],_0x2286ee[_0x34fcd2(0x21c)],_0x3da40c);_0x415737=JSON[_0x34fcd2(0x293)](_0x23ff22),console[_0x34fcd2(0x287)](_0x34fcd2(0x1e0)),loggerService_1[_0x34fcd2(0x2d2)][_0x34fcd2(0x22b)](_0x3da40c[_0x34fcd2(0x2f7)](),_0x34fcd2(0x23e),_0x3f4f76['status'],_0x415737,_0x314f89),console['log'](_0x34fcd2(0x1d4));}catch(_0x4b6fe2){console[_0x34fcd2(0x24a)](_0x34fcd2(0x29f),_0x4b6fe2),loggerService_1['loggerService'][_0x34fcd2(0x203)](_0x3da40c[_0x34fcd2(0x2f7)](),_0x34fcd2(0x275),_0x34fcd2(0x273)+_0x4b6fe2),_0x415737=_0x2286ee;}}else loggerService_1[_0x34fcd2(0x2d2)][_0x34fcd2(0x22b)](_0x3da40c[_0x34fcd2(0x2f7)](),_0x34fcd2(0x23e),_0x3f4f76['status'],_0x415737,_0x314f89),console[_0x34fcd2(0x287)]('üìù\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x34fcd2(0x287)]('üìä\x20Status\x20check\x20result:',{'status':_0x415737['status'],'final':_0x415737[_0x34fcd2(0x30b)],'payment_id':_0x415737[_0x34fcd2(0x269)],'desc':_0x415737['desc']});let _0x1a9f37=_0x34fcd2(0x2aa);if(_0x415737[_0x34fcd2(0x237)]===0x64&&_0x415737[_0x34fcd2(0x30b)]===0x1)_0x1a9f37=_0x34fcd2(0x324);else{if(_0x415737[_0x34fcd2(0x30b)]===0x0||!this[_0x34fcd2(0x2d1)](_0x415737[_0x34fcd2(0x237)]))_0x1a9f37=_0x34fcd2(0x2aa);else _0x415737['final']===0x1||this[_0x34fcd2(0x2d1)](_0x415737[_0x34fcd2(0x237)])?_0x1a9f37=_0x34fcd2(0x2b4):_0x1a9f37=_0x34fcd2(0x2aa);}const _0x55a809=this[_0x34fcd2(0x310)](_0x415737[_0x34fcd2(0x237)],_0x415737[_0x34fcd2(0x23b)]);return{'status':_0x1a9f37,'final':this[_0x34fcd2(0x2d1)](_0x415737['status']),'amount':_0x415737[_0x34fcd2(0x2fa)],'currency':_0x415737['currency'],'date_success':_0x415737[_0x34fcd2(0x285)],'description':_0x55a809};}catch(_0x5e3d32){console[_0x34fcd2(0x24a)](_0x3da40c+_0x34fcd2(0x204),_0x5e3d32),loggerService_1['loggerService'][_0x34fcd2(0x203)](_0x3da40c[_0x34fcd2(0x2f7)](),'/status',_0x5e3d32);throw new Error('Failed\x20to\x20check\x20'+_0x3da40c+_0x34fcd2(0x327)+(_0x5e3d32 instanceof Error?_0x5e3d32[_0x34fcd2(0x23f)]:'Unknown\x20error'));}}['scheduleStatusChecks'](_0x203666,_0x4a1ce1,_0x428bd6,_0x125696){const _0x3d2b4d=a62_0x5582f8;console[_0x3d2b4d(0x287)](_0x3d2b4d(0x339)+_0x125696+_0x3d2b4d(0x2a5)+_0x203666+'\x20('+_0x428bd6+')'),this['clearStatusTimers'](_0x203666);const _0x398e10=[],_0x54f8c5=0x5*0x3c*0x3e8,_0x5cc773=0x2*0x3c*0x3c*0x3e8,_0x3c7ca7=Math[_0x3d2b4d(0x258)](_0x5cc773/_0x54f8c5);console[_0x3d2b4d(0x287)]('‚è∞\x20Will\x20check\x20status\x20'+_0x3c7ca7+_0x3d2b4d(0x2c5));for(let _0x2e026d=0x1;_0x2e026d<=_0x3c7ca7;_0x2e026d++){const _0x2c7c1b=setTimeout(async()=>{const _0x3606f1=_0x3d2b4d;console['log'](_0x3606f1(0x255)+_0x125696+_0x3606f1(0x2b9)+_0x2e026d+'/'+_0x3c7ca7+_0x3606f1(0x21f)+_0x203666);try{const _0x478f17=await this[_0x3606f1(0x202)](_0x428bd6,_0x4a1ce1,_0x125696);console[_0x3606f1(0x287)](_0x3606f1(0x2f6)+_0x2e026d+_0x3606f1(0x2df),_0x478f17),_0x478f17[_0x3606f1(0x30b)]&&(console[_0x3606f1(0x287)](_0x3606f1(0x2fe)+_0x203666+'\x20is\x20final\x20('+_0x478f17[_0x3606f1(0x237)]+_0x3606f1(0x28e)),this[_0x3606f1(0x2c6)](_0x203666),await this[_0x3606f1(0x1ed)](_0x203666,_0x478f17[_0x3606f1(0x237)],_0x478f17));}catch(_0x2bf204){console[_0x3606f1(0x24a)](_0x3606f1(0x20c)+_0x2e026d+_0x3606f1(0x26f)+_0x203666+':',_0x2bf204);}},_0x2e026d*_0x54f8c5);_0x398e10[_0x3d2b4d(0x284)](_0x2c7c1b);}this[_0x3d2b4d(0x294)][_0x3d2b4d(0x335)](_0x203666,_0x398e10),console['log']('‚úÖ\x20Scheduled\x20'+_0x3c7ca7+_0x3d2b4d(0x1cc)+_0x203666);}['clearStatusTimers'](_0xd79440){const _0x50cbe0=a62_0x5582f8,_0x2794a7=this[_0x50cbe0(0x294)][_0x50cbe0(0x206)](_0xd79440);_0x2794a7&&(console[_0x50cbe0(0x287)](_0x50cbe0(0x25c)+_0x2794a7['length']+_0x50cbe0(0x2f1)+_0xd79440),_0x2794a7['forEach']((_0x384efd,_0x4e2c3a)=>{clearTimeout(_0x384efd);}),this[_0x50cbe0(0x294)][_0x50cbe0(0x24b)](_0xd79440));}async['updatePaymentStatus'](_0x3ec919,_0x318095,_0x3fccf8){const _0x513ef8=a62_0x5582f8;try{const _0x5b59b3=(await Promise[_0x513ef8(0x1d5)]()['then'](()=>__importStar(require(_0x513ef8(0x2f9)))))[_0x513ef8(0x29c)],_0x38c133={'status':_0x318095['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x513ef8(0x226),'statusChangedAt':new Date()};_0x318095===_0x513ef8(0x324)&&(_0x38c133[_0x513ef8(0x29d)]=new Date()),_0x318095===_0x513ef8(0x2b4)&&_0x3fccf8[_0x513ef8(0x2d8)]&&(_0x38c133[_0x513ef8(0x20f)]=_0x3fccf8[_0x513ef8(0x2d8)],console[_0x513ef8(0x287)](_0x513ef8(0x1ee)+_0x3fccf8[_0x513ef8(0x2d8)])),await _0x5b59b3[_0x513ef8(0x296)][_0x513ef8(0x2fc)]({'where':{'id':_0x3ec919},'data':_0x38c133}),console[_0x513ef8(0x287)]('‚úÖ\x20Payment\x20'+_0x3ec919+_0x513ef8(0x1ce)+_0x318095),await this[_0x513ef8(0x244)](_0x3ec919,_0x318095);}catch(_0x5304ca){console['error'](_0x513ef8(0x1df)+_0x3ec919+':',_0x5304ca);}}async[a62_0x5582f8(0x244)](_0x3bba5e,_0x55179e){const _0x228aeb=a62_0x5582f8;try{const _0x48e3d2=(await Promise['resolve']()['then'](()=>__importStar(require(_0x228aeb(0x2f9)))))[_0x228aeb(0x29c)],{telegramBotService:_0x275a94}=await Promise[_0x228aeb(0x1d5)]()[_0x228aeb(0x262)](()=>__importStar(require(_0x228aeb(0x32a)))),_0x4ea5c0=await _0x48e3d2['payment'][_0x228aeb(0x2b1)]({'where':{'id':_0x3bba5e},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x4ea5c0)return;const _0x3a2c7c={'PAID':_0x228aeb(0x242),'FAILED':_0x228aeb(0x292)},_0x240a71=_0x3a2c7c[_0x55179e];_0x240a71&&await _0x275a94[_0x228aeb(0x2a2)](_0x4ea5c0[_0x228aeb(0x1d9)],_0x4ea5c0,_0x240a71),await this[_0x228aeb(0x27d)](_0x4ea5c0,_0x55179e);}catch(_0x375359){console[_0x228aeb(0x24a)](_0x228aeb(0x30e),_0x375359);}}async['sendShopWebhook'](_0x3644a9,_0x448888){const _0x3235b8=a62_0x5582f8,_0x22e5d5=Date['now']();try{const _0x10dd82=_0x3644a9[_0x3235b8(0x2ac)],_0x5de7eb=_0x10dd82[_0x3235b8(0x200)];if(!_0x5de7eb?.['webhookUrl']){console[_0x3235b8(0x287)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x10dd82['id']);return;}const _0x23a3dc=_0x448888===_0x3235b8(0x324)?_0x3235b8(0x1dc):_0x3235b8(0x1ec);let _0x19a5a7=[];if(_0x5de7eb['webhookEvents'])try{_0x19a5a7=Array['isArray'](_0x5de7eb['webhookEvents'])?_0x5de7eb['webhookEvents']:JSON[_0x3235b8(0x293)](_0x5de7eb[_0x3235b8(0x23c)]);}catch(_0x33cf1c){console[_0x3235b8(0x24a)](_0x3235b8(0x2d5),_0x33cf1c),_0x19a5a7=[];}if(!_0x19a5a7[_0x3235b8(0x266)](_0x23a3dc)){console['log']('Webhook\x20event\x20'+_0x23a3dc+_0x3235b8(0x217)+_0x10dd82['id']);return;}const _0x1a9f52={'event':_0x23a3dc,'payment':{'id':_0x3644a9['id'],'order_id':_0x3644a9['orderId'],'gateway_order_id':_0x3644a9[_0x3235b8(0x22e)],'gateway':_0x3235b8(0x276),'amount':_0x3644a9[_0x3235b8(0x2fa)],'currency':_0x3644a9[_0x3235b8(0x2cd)],'status':_0x448888[_0x3235b8(0x2f7)](),'customer_email':_0x3644a9[_0x3235b8(0x2c0)],'customer_name':_0x3644a9['customerName'],'created_at':_0x3644a9[_0x3235b8(0x288)],'updated_at':new Date()}},_0x54deb5=await fetch(_0x5de7eb['webhookUrl'],{'method':_0x3235b8(0x286),'headers':{'Content-Type':_0x3235b8(0x2dc),'User-Agent':_0x3235b8(0x254)},'body':JSON[_0x3235b8(0x211)](_0x1a9f52)}),_0x519873=Date[_0x3235b8(0x2b0)]()-_0x22e5d5;loggerService_1[_0x3235b8(0x2d2)]['logShopWebhookSent'](_0x3644a9['shopId'],_0x5de7eb[_0x3235b8(0x290)],_0x23a3dc,_0x54deb5['status'],_0x519873,_0x1a9f52),console[_0x3235b8(0x287)](_0x3235b8(0x1ff)+_0x5de7eb[_0x3235b8(0x290)]+_0x3235b8(0x26d)+_0x54deb5[_0x3235b8(0x237)]+'\x20('+_0x519873+_0x3235b8(0x2bb));}catch(_0x3ef65f){console[_0x3235b8(0x24a)](_0x3235b8(0x300),_0x3ef65f),loggerService_1[_0x3235b8(0x2d2)][_0x3235b8(0x234)](_0x3644a9[_0x3235b8(0x1d9)],_0x3644a9[_0x3235b8(0x2ac)]?.[_0x3235b8(0x200)]?.[_0x3235b8(0x290)]||_0x3235b8(0x1d2),'webhook_send',_0x3ef65f,{});}}[a62_0x5582f8(0x29a)](_0x3af206){const _0x1d4e56=a62_0x5582f8,_0x170f24=_0x3af206['replace'](/[\s-]/g,'');if(_0x170f24[_0x1d4e56(0x283)]<0x4)return'****';return _0x1d4e56(0x26c)+_0x170f24[_0x1d4e56(0x235)](-0x4);}async[a62_0x5582f8(0x336)](_0xef315e,_0x180074=a62_0x5582f8(0x22f)){const _0xa626e1=a62_0x5582f8;console[_0xa626e1(0x287)](_0xa626e1(0x261),JSON[_0xa626e1(0x211)](_0xef315e,null,0x2));let _0x44b805=_0xef315e,_0x1d51a8=_0x180074;_0xef315e[_0xa626e1(0x2d7)]?(_0x1d51a8=_0xef315e['card_type'][_0xa626e1(0x1f9)]()==='VISA'?_0xa626e1(0x334):'MASTERCARD',console['log']('üîç\x20Detected\x20card\x20type\x20from\x20webhook:\x20'+_0x1d51a8)):console[_0xa626e1(0x287)](_0xa626e1(0x2c7)+_0x1d51a8);if(_0xef315e['info']&&_0xef315e[_0xa626e1(0x21c)]&&_0xef315e[_0xa626e1(0x24c)]){console[_0xa626e1(0x287)](_0xa626e1(0x31b));try{const _0x2a04a5=await this[_0xa626e1(0x248)](_0xef315e[_0xa626e1(0x256)],_0xef315e[_0xa626e1(0x21c)],_0x1d51a8);_0x44b805=JSON[_0xa626e1(0x293)](_0x2a04a5),console[_0xa626e1(0x287)](_0xa626e1(0x23a)),console[_0xa626e1(0x287)]('üìù\x20Decrypted\x20webhook\x20data:',JSON[_0xa626e1(0x211)](_0x44b805,null,0x2));}catch(_0x203817){console[_0xa626e1(0x24a)](_0xa626e1(0x27b),_0x203817),console[_0xa626e1(0x287)](_0xa626e1(0x2be)),_0x44b805=_0xef315e;}}else console[_0xa626e1(0x287)]('üìù\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0x46e50f=_0xa626e1(0x2aa);if(_0x44b805[_0xa626e1(0x237)]===0x64&&_0x44b805[_0xa626e1(0x30b)]===0x1)_0x46e50f=_0xa626e1(0x324);else{if(_0x44b805[_0xa626e1(0x30b)]===0x0||!this[_0xa626e1(0x2d1)](_0x44b805['status']))_0x46e50f=_0xa626e1(0x2aa);else _0x44b805[_0xa626e1(0x30b)]===0x1||this[_0xa626e1(0x2d1)](_0x44b805[_0xa626e1(0x237)])?_0x46e50f='FAILED':_0x46e50f=_0xa626e1(0x2aa);}let _0x54d0a9='';if(_0x44b805[_0xa626e1(0x209)])_0x54d0a9=_0x44b805[_0xa626e1(0x209)][_0xa626e1(0x2b6)](),console[_0xa626e1(0x287)](_0xa626e1(0x311)+_0x1d51a8+_0xa626e1(0x225)+_0x54d0a9);else _0x44b805[_0xa626e1(0x269)]?(_0x54d0a9=_0x44b805['payment_id'][_0xa626e1(0x2b6)](),console[_0xa626e1(0x287)](_0xa626e1(0x311)+_0x1d51a8+_0xa626e1(0x2e0)+_0x54d0a9)):(_0x54d0a9=_0x44b805[_0xa626e1(0x1fa)]||_0x44b805[_0xa626e1(0x232)]||_0x44b805['id']||'',console[_0xa626e1(0x287)](_0xa626e1(0x205)+_0x54d0a9));console[_0xa626e1(0x287)](_0xa626e1(0x219)+_0x1d51a8+'\x20webhook\x20extracted\x20data:'),console[_0xa626e1(0x287)](_0xa626e1(0x241)+_0x54d0a9+_0xa626e1(0x2e2)+_0x44b805['order_id']+',\x20orderId='+_0x44b805['orderId']+_0xa626e1(0x330)+_0x44b805['payment_id']+_0xa626e1(0x331)+_0x44b805['paymentId']+_0xa626e1(0x25d)+_0x44b805['id']+')'),console[_0xa626e1(0x287)]('\x20\x20\x20Status:\x20'+_0x46e50f+_0xa626e1(0x220)+_0x44b805[_0xa626e1(0x237)]+_0xa626e1(0x1f2)+_0x44b805['final']+')'),console[_0xa626e1(0x287)](_0xa626e1(0x28b)+_0x44b805[_0xa626e1(0x2fa)]),console[_0xa626e1(0x287)](_0xa626e1(0x2af)+_0x44b805[_0xa626e1(0x2cd)]);let _0x96636f;_0x46e50f===_0xa626e1(0x2b4)&&(_0x96636f=this[_0xa626e1(0x310)](_0x44b805[_0xa626e1(0x237)],_0x44b805[_0xa626e1(0x23b)]),console[_0xa626e1(0x287)](_0xa626e1(0x2a6)+_0x96636f));const _0x4b57c8={'paymentId':_0x54d0a9,'status':_0x46e50f,'amount':_0x44b805[_0xa626e1(0x2fa)],'currency':_0x44b805[_0xa626e1(0x2cd)],'cardBrand':_0x1d51a8};return _0x96636f&&(_0x4b57c8[_0xa626e1(0x2ff)]=_0x96636f),_0x4b57c8;}[a62_0x5582f8(0x1cf)](){const _0x24c130=a62_0x5582f8;console[_0x24c130(0x287)](_0x24c130(0x332));const _0x345eb1=this[_0x24c130(0x294)][_0x24c130(0x302)];for(const [_0x21a549]of this['statusCheckTimers']){this['clearStatusTimers'](_0x21a549);}console[_0x24c130(0x287)]('üõë\x20Stopped\x20'+_0x345eb1+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a62_0x5582f8(0x1e4)]=VisaMasterCardService;