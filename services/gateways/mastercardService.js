'use strict';const a42_0x3443b0=a42_0x226c;(function(_0x145ed,_0x1de363){const _0x4f7166=a42_0x226c,_0x203b2c=_0x145ed();while(!![]){try{const _0x2b1195=parseInt(_0x4f7166(0x238))/0x1*(parseInt(_0x4f7166(0x2be))/0x2)+parseInt(_0x4f7166(0x2d2))/0x3*(-parseInt(_0x4f7166(0x2bb))/0x4)+parseInt(_0x4f7166(0x2aa))/0x5*(parseInt(_0x4f7166(0x298))/0x6)+parseInt(_0x4f7166(0x295))/0x7+parseInt(_0x4f7166(0x2cb))/0x8*(parseInt(_0x4f7166(0x2ce))/0x9)+parseInt(_0x4f7166(0x245))/0xa*(parseInt(_0x4f7166(0x291))/0xb)+-parseInt(_0x4f7166(0x217))/0xc*(parseInt(_0x4f7166(0x28e))/0xd);if(_0x2b1195===_0x1de363)break;else _0x203b2c['push'](_0x203b2c['shift']());}catch(_0x88828b){_0x203b2c['push'](_0x203b2c['shift']());}}}(a42_0x39d0,0xede07));function a42_0x226c(_0x14a5af,_0x32d035){const _0x39d05a=a42_0x39d0();return a42_0x226c=function(_0x226cb0,_0x4be301){_0x226cb0=_0x226cb0-0x1eb;let _0x358f62=_0x39d05a[_0x226cb0];return _0x358f62;},a42_0x226c(_0x14a5af,_0x32d035);}function a42_0x39d0(){const _0x7acffc=['❌\x20Failed\x20to\x20decrypt\x20status\x20response:','../../config/database','5YQMwwE','failed','\x20\x20\x20-\x20key\x20length:','Public\x20key\x20file\x20not\x20found:\x20','isArray','writable','randomBytes','size','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','Failed\x20to\x20send\x20MasterCard\x20webhook:','get','status','orderId','-----END','shop','decryptResponse','__importStar','121620ORgnTP','MasterCardService','/charge','12znMUIj','HTTP\x20','🛑\x20Stopped\x20','\x20not\x20enabled\x20for\x20shop\x20','path','../telegramBotService','Card\x20Number:','\x20failed\x20for\x20payment\x20','merchantPointId','__importDefault','logWhiteDomainError','\x20MasterCard\x20status\x20check\x20timers','\x20result:','440DdoXff','__setModuleDefault','✅\x20Status\x20response\x20decrypted\x20successfully','304443nIxSGv','info','error',',\x20Desc:\x20','69TudOay','toUpperCase','webhookUrl','../loggerService','base64','log','logWhiteDomainResponse','❌\x20RSA\x20signing\x20failed:','\x20status\x20updated\x20to\x20','/status','logWhiteDomainRequest','validateKeyFiles','expire_year','HTTP\x20error!\x20status:\x20','private.pem','/charge_decrypted','cwd','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','toString','statusCheckTimers','Return\x20URL:','desc','FAILED','❌\x20PHP\x20decryptor\x20request\x20failed:','push','customerName','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','publicEncrypt','update','❌\x20RSA\x20encryption\x20failed:','then','none','order_id','payment_id','decryptResponsePhp','set','currency','updatePaymentStatus','\x20\x20\x20-\x20method:\x20charge','✅\x20Payment\x20successful','✅\x20Payment\x20','constants','createCipheriv','Card\x20Holder:','logShopWebhookSent','PAID','📝\x20Signature\x20length:','-----BEGIN','aes-256-ctr','/status_decrypted','from','prototype','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','adminNotes','🔐\x203DS\x20verification\x20required','trim','https://api.paydmeth.com/api','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','🔐\x20Data\x20encrypted\x20with\x20AES',',\x20body:\x20','2676gFMxFv','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','scheduleStatusChecks','****\x20****\x20****\x20','3DS\x20URL:','includes','shopId','parse','📊\x20Status\x20check\x20#','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','default','/charge_decrypt','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','processCardPayment','utf8','privateKeyPath','text','json','last_name','💾\x20Payment\x20data\x20prepared','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','Response\x20Time:','checkPaymentStatus','createdAt','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','MasterCard:\x20','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','findUnique','decryptAES','3ds_url','first_name','296047IsQmhp','webhookEvents','Payment\x20ID:','payment.failed','\x20\x20\x20-\x20sign\x20length:','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','🔐\x20Public\x20key\x20path:','application/json','Unknown\x20error','delete','existsSync','MasterCard\x20webhook\x20sent\x20to\x20','settings','5830mgTOID','system','📝\x20Encrypted\x20data\x20length:','description','Status:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','apiUrl','webhook_send','amount','logShopWebhookError','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','sendPaymentNotification','getOwnPropertyDescriptor','PENDING','final','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','SHA256','POST','📝\x20Data\x20to\x20sign\x20length:','key','call','stopAllStatusChecks','configurable','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','\x20with\x20status\x20','PHP\x20decryptor\x20error','create','charge','stringify','defineProperty','slice','🔐\x20Private\x20key\x20path:','replace','🔍\x20MasterCard\x20status\x20check\x20#','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','Failed\x20to\x20decrypt\x20response','),\x20stopping\x20status\x20checks','encryptRSA','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','Webhook\x20event\x20','1111','/charge_raw','publicKeyPath','❌\x20Data\x20being\x20signed:','processWebhook','clearStatusTimers','length','date_success','loggerService','\x20for\x20payment\x20','Result\x20URL:','mastercard','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','sendShopWebhook','createDecipheriv','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours',',\x20Final:\x20','\x20\x20\x20-\x20lang:\x20en','TesSoft\x20Payment\x20System/1.0','🔐\x20Public\x20key\x20length:\x20','encryptAES','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','\x20\x20\x20-\x20info\x20length:','sendPaymentNotifications','join','now','RSA_PKCS1_PADDING','\x20characters','substring','✅\x20Scheduled\x20','resolve','signRSA','floor','241007RgHwLe','message','Failed\x20to\x20send\x20payment\x20notifications:','15983nUMMlV','****','🔐\x20AES\x20IV\x20length:','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','8262037WIHyyz','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','readFileSync','862188LGPzcq','sign','__esModule','psp_public.pem','MasterCard\x20status\x20check\x20error:','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','payment.success','forEach','\x20is\x20final\x20(','generateAESKey','Final:','🧹\x20Clearing\x20','❌\x20Status\x20check\x20#','gatewayOrderId','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','keys'];a42_0x39d0=function(){return _0x7acffc;};return a42_0x39d0();}var __createBinding=this&&this['__createBinding']||(Object[a42_0x3443b0(0x25f)]?function(_0x2b2186,_0x5a2fed,_0x20459a,_0xce4d8b){const _0x39a644=a42_0x3443b0;if(_0xce4d8b===undefined)_0xce4d8b=_0x20459a;var _0x5869f4=Object[_0x39a644(0x251)](_0x5a2fed,_0x20459a);(!_0x5869f4||(_0x39a644(0x2b4)in _0x5869f4?!_0x5a2fed[_0x39a644(0x29a)]:_0x5869f4[_0x39a644(0x2af)]||_0x5869f4[_0x39a644(0x25b)]))&&(_0x5869f4={'enumerable':!![],'get':function(){return _0x5a2fed[_0x20459a];}}),Object['defineProperty'](_0x2b2186,_0xce4d8b,_0x5869f4);}:function(_0x281e0d,_0x4678b6,_0x42f2c7,_0x555615){if(_0x555615===undefined)_0x555615=_0x42f2c7;_0x281e0d[_0x555615]=_0x4678b6[_0x42f2c7];}),__setModuleDefault=this&&this[a42_0x3443b0(0x2cc)]||(Object['create']?function(_0x423d6c,_0x110344){const _0x384449=a42_0x3443b0;Object['defineProperty'](_0x423d6c,_0x384449(0x221),{'enumerable':!![],'value':_0x110344});}:function(_0x305f0e,_0x2584f7){const _0x1fbcb2=a42_0x3443b0;_0x305f0e[_0x1fbcb2(0x221)]=_0x2584f7;}),__importStar=this&&this[a42_0x3443b0(0x2ba)]||(function(){var _0x566fcb=function(_0x2b99c4){return _0x566fcb=Object['getOwnPropertyNames']||function(_0x1a5f4b){const _0x2887e2=a42_0x226c;var _0x5cad5f=[];for(var _0x3d2338 in _0x1a5f4b)if(Object[_0x2887e2(0x20d)]['hasOwnProperty'][_0x2887e2(0x259)](_0x1a5f4b,_0x3d2338))_0x5cad5f[_0x5cad5f[_0x2887e2(0x273)]]=_0x3d2338;return _0x5cad5f;},_0x566fcb(_0x2b99c4);};return function(_0x1cb713){const _0x3ef04b=a42_0x226c;if(_0x1cb713&&_0x1cb713[_0x3ef04b(0x29a)])return _0x1cb713;var _0x50c944={};if(_0x1cb713!=null){for(var _0x48ab1d=_0x566fcb(_0x1cb713),_0x1b7f27=0x0;_0x1b7f27<_0x48ab1d[_0x3ef04b(0x273)];_0x1b7f27++)if(_0x48ab1d[_0x1b7f27]!=='default')__createBinding(_0x50c944,_0x1cb713,_0x48ab1d[_0x1b7f27]);}return __setModuleDefault(_0x50c944,_0x1cb713),_0x50c944;};}()),__importDefault=this&&this[a42_0x3443b0(0x2c7)]||function(_0x32b409){const _0x46647a=a42_0x3443b0;return _0x32b409&&_0x32b409[_0x46647a(0x29a)]?_0x32b409:{'default':_0x32b409};};Object[a42_0x3443b0(0x262)](exports,a42_0x3443b0(0x29a),{'value':!![]}),exports[a42_0x3443b0(0x2bc)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x3443b0(0x2c2))),loggerService_1=require(a42_0x3443b0(0x2d5));class MasterCardService{constructor(){const _0x23f142=a42_0x3443b0;this[_0x23f142(0x1ed)]=new Map(),this['apiUrl']=_0x23f142(0x213),this['merchantPointId']=0x67c,this['privateKeyPath']=path_1[_0x23f142(0x221)][_0x23f142(0x285)](process[_0x23f142(0x2e2)](),_0x23f142(0x2a7),_0x23f142(0x2e0)),this[_0x23f142(0x26f)]=path_1['default'][_0x23f142(0x285)](process['cwd'](),_0x23f142(0x2a7),_0x23f142(0x29b)),console[_0x23f142(0x2d7)]('💳\x20MasterCard\x20service\x20initialized'),console[_0x23f142(0x2d7)](_0x23f142(0x264),this[_0x23f142(0x227)]),console[_0x23f142(0x2d7)](_0x23f142(0x23e),this['publicKeyPath']),this[_0x23f142(0x2dd)]();}[a42_0x3443b0(0x2dd)](){const _0x1544be=a42_0x3443b0;try{if(!fs_1['default'][_0x1544be(0x242)](this['privateKeyPath']))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this['privateKeyPath']);if(!fs_1[_0x1544be(0x221)][_0x1544be(0x242)](this[_0x1544be(0x26f)]))throw new Error(_0x1544be(0x2ad)+this[_0x1544be(0x26f)]);const _0x3ae44e=fs_1[_0x1544be(0x221)][_0x1544be(0x297)](this[_0x1544be(0x227)],'utf8')[_0x1544be(0x212)](),_0x26bfd0=fs_1[_0x1544be(0x221)][_0x1544be(0x297)](this[_0x1544be(0x26f)],_0x1544be(0x226))[_0x1544be(0x212)]();if(!_0x3ae44e[_0x1544be(0x21c)](_0x1544be(0x209))||!_0x3ae44e[_0x1544be(0x21c)](_0x1544be(0x2b7)))throw new Error(_0x1544be(0x230));if(!_0x26bfd0[_0x1544be(0x21c)](_0x1544be(0x209))||!_0x26bfd0['includes'](_0x1544be(0x2b7)))throw new Error(_0x1544be(0x23d));console['log']('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console[_0x1544be(0x2d7)]('🔐\x20Private\x20key\x20length:\x20'+_0x3ae44e['length']+_0x1544be(0x288)),console[_0x1544be(0x2d7)](_0x1544be(0x280)+_0x26bfd0['length']+'\x20characters');}catch(_0x189e56){console[_0x1544be(0x2d0)]('❌\x20MasterCard\x20key\x20validation\x20failed:',_0x189e56);throw _0x189e56;}}[a42_0x3443b0(0x2a1)](){const _0xd14990=a42_0x3443b0,_0x1aee67=crypto_1[_0xd14990(0x221)][_0xd14990(0x2b0)](0x20),_0x10bbc4=crypto_1[_0xd14990(0x221)][_0xd14990(0x2b0)](0x10);return{'key':_0x1aee67,'iv':_0x10bbc4};}[a42_0x3443b0(0x281)](_0x1299e0,_0x4c1071,_0x5de441){const _0x22408b=a42_0x3443b0,_0x33ae54=crypto_1[_0x22408b(0x221)][_0x22408b(0x204)](_0x22408b(0x20a),_0x4c1071,_0x5de441);let _0x1b2e8f=_0x33ae54['update'](_0x1299e0,_0x22408b(0x226),_0x22408b(0x2d6));return _0x1b2e8f+=_0x33ae54[_0x22408b(0x253)](_0x22408b(0x2d6)),_0x1b2e8f;}[a42_0x3443b0(0x26a)](_0x25443f,_0x3752d5){const _0x12dd18=a42_0x3443b0;try{const _0xdecb5c=fs_1[_0x12dd18(0x221)][_0x12dd18(0x297)](this['publicKeyPath'],_0x12dd18(0x226))[_0x12dd18(0x212)](),_0x4b6c33={'iv':_0x3752d5[_0x12dd18(0x1ec)](_0x12dd18(0x2d6)),'key':_0x25443f['toString']('base64')},_0x47e5e8=JSON[_0x12dd18(0x261)](_0x4b6c33);console[_0x12dd18(0x2d7)](_0x12dd18(0x26b),_0x47e5e8[_0x12dd18(0x273)]);const _0x374b01=crypto_1[_0x12dd18(0x221)][_0x12dd18(0x1f5)]({'key':_0xdecb5c,'padding':crypto_1[_0x12dd18(0x221)][_0x12dd18(0x203)][_0x12dd18(0x287)]},Buffer[_0x12dd18(0x20c)](_0x47e5e8));return console[_0x12dd18(0x2d7)](_0x12dd18(0x224),_0x374b01[_0x12dd18(0x273)]),_0x374b01['toString'](_0x12dd18(0x2d6));}catch(_0x124586){console[_0x12dd18(0x2d0)](_0x12dd18(0x1f7),_0x124586);throw new Error(_0x12dd18(0x267));}}[a42_0x3443b0(0x28c)](_0x298956){const _0x197172=a42_0x3443b0;try{const _0x88c8c1=fs_1[_0x197172(0x221)]['readFileSync'](this[_0x197172(0x227)],_0x197172(0x226))[_0x197172(0x212)](),_0x138594=crypto_1['default']['createSign'](_0x197172(0x255));_0x138594[_0x197172(0x1f6)](_0x298956),_0x138594['end']();const _0x354f53=_0x138594['sign'](_0x88c8c1,_0x197172(0x2d6));return console['log']('🔐\x20RSA\x20signing\x20successful'),console[_0x197172(0x2d7)](_0x197172(0x257),_0x298956[_0x197172(0x273)]),console[_0x197172(0x2d7)](_0x197172(0x208),_0x354f53['length']),_0x354f53;}catch(_0x2e45f3){console[_0x197172(0x2d0)](_0x197172(0x2d9),_0x2e45f3),console[_0x197172(0x2d0)](_0x197172(0x270),_0x298956[_0x197172(0x289)](0x0,0xc8)+'...');throw new Error(_0x197172(0x254));}}[a42_0x3443b0(0x235)](_0x44710f,_0x39e479,_0x4bcf15){const _0x3bdaee=a42_0x3443b0,_0x237d49=crypto_1[_0x3bdaee(0x221)][_0x3bdaee(0x27b)]('aes-256-ctr',_0x39e479,_0x4bcf15);let _0x138aa2=_0x237d49[_0x3bdaee(0x1f6)](_0x44710f,'base64','utf8');return _0x138aa2+=_0x237d49['final'](_0x3bdaee(0x226)),_0x138aa2;}async['decryptResponsePhp'](_0x114e92,_0x552186){const _0x982779=a42_0x3443b0;try{const _0xa365ba=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x982779(0x256),'headers':{'Content-Type':'application/json'},'body':JSON[_0x982779(0x261)]({'info':_0x114e92,'key':_0x552186})});if(!_0xa365ba['ok'])throw new Error(_0x982779(0x25e));return await _0xa365ba['text']();}catch(_0x40131c){console[_0x982779(0x2d0)](_0x982779(0x1f1),_0x40131c);throw new Error(_0x982779(0x22c));}}['decryptResponse'](_0x33de5c,_0x136446){const _0x1d14e8=a42_0x3443b0;try{const _0x3669d4=fs_1[_0x1d14e8(0x221)][_0x1d14e8(0x297)](this[_0x1d14e8(0x227)],_0x1d14e8(0x226))[_0x1d14e8(0x212)](),_0x499fa8=crypto_1[_0x1d14e8(0x221)]['privateDecrypt'](_0x3669d4,Buffer[_0x1d14e8(0x20c)](_0x136446,_0x1d14e8(0x2d6))),_0x25ef68=JSON[_0x1d14e8(0x21e)](_0x499fa8['toString']()),_0x143f4c=Buffer[_0x1d14e8(0x20c)](_0x25ef68['key'],_0x1d14e8(0x2d6)),_0x4c91a4=Buffer[_0x1d14e8(0x20c)](_0x25ef68['iv'],_0x1d14e8(0x2d6));return this[_0x1d14e8(0x235)](_0x33de5c,_0x143f4c,_0x4c91a4);}catch(_0x5d55c4){throw new Error(_0x1d14e8(0x268));}}async[a42_0x3443b0(0x225)](_0x138793){const _0x1c59f4=a42_0x3443b0,{paymentId:_0xef1e73,orderId:_0x3fc436,amount:_0x2442b2,currency:_0x3961cc,cardData:_0x827b85,resultUrl:_0x39a042,returnUrl:_0xa8aade,cardHolder:_0x4ee6e0,browser:_0x1b2b05}=_0x138793;console[_0x1c59f4(0x2d7)](_0x1c59f4(0x1f4)),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x23a),_0xef1e73),console[_0x1c59f4(0x2d7)]('Order\x20ID:',_0x3fc436),console[_0x1c59f4(0x2d7)]('Amount:',_0x2442b2,_0x3961cc),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x2c4),this['maskCardNumber'](_0x827b85['number'])),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x205),_0x4ee6e0[_0x1c59f4(0x237)]+'\x20'+_0x4ee6e0[_0x1c59f4(0x22a)]),console['log'](_0x1c59f4(0x1ee),_0xa8aade),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x277),_0x39a042);const _0x5441de={'amount':_0x2442b2,'currency':_0x3961cc[_0x1c59f4(0x2d3)](),'order_id':_0x3fc436,'result_url':_0x39a042,'return_url':_0xa8aade,'card':{'number':_0x827b85['number'],'expire_month':_0x827b85['expire_month'],'expire_year':_0x827b85[_0x1c59f4(0x2de)],'cvv':_0x827b85['cvv']},'card_holder':_0x4ee6e0,'browser':_0x1b2b05},_0x12dd78=JSON[_0x1c59f4(0x261)](_0x5441de);console[_0x1c59f4(0x2d7)](_0x1c59f4(0x22b)),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x220)),console[_0x1c59f4(0x2d7)](_0x12dd78),console[_0x1c59f4(0x2d7)]('📝\x20Data\x20length:',_0x12dd78[_0x1c59f4(0x273)]);try{const {key:_0x3d8a92,iv:_0x5562d7}=this[_0x1c59f4(0x2a1)]();console['log']('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console['log']('🔐\x20AES\x20key\x20length:',_0x3d8a92[_0x1c59f4(0x273)]),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x293),_0x5562d7[_0x1c59f4(0x273)]);const _0x1ba6ae=this['encryptAES'](_0x12dd78,_0x3d8a92,_0x5562d7);console[_0x1c59f4(0x2d7)](_0x1c59f4(0x215)),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x247),_0x1ba6ae[_0x1c59f4(0x273)]);const _0x1c991e=this['encryptRSA'](_0x3d8a92,_0x5562d7);console['log'](_0x1c59f4(0x223)),console[_0x1c59f4(0x2d7)]('📝\x20Encrypted\x20key\x20length:',_0x1c991e['length']);const _0x24f51d=this[_0x1c59f4(0x28c)](_0x12dd78);console[_0x1c59f4(0x2d7)]('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x1c59f4(0x2d7)]('📝\x20Signature\x20length:',_0x24f51d[_0x1c59f4(0x273)]);const _0x4728b2={'merchant_point_id':this['merchantPointId'],'method':_0x1c59f4(0x260),'info':_0x1ba6ae,'key':_0x1c991e,'sign':_0x24f51d,'lang':'en'};console[_0x1c59f4(0x2d7)](_0x1c59f4(0x294)),console[_0x1c59f4(0x2d7)]('📝\x20Final\x20request\x20structure:'),console[_0x1c59f4(0x2d7)]('\x20\x20\x20-\x20merchant_point_id:',this['merchantPointId']),console['log'](_0x1c59f4(0x200)),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x283),_0x1ba6ae[_0x1c59f4(0x273)]),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x2ac),_0x1c991e[_0x1c59f4(0x273)]),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x23c),_0x24f51d[_0x1c59f4(0x273)]),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x27e)),loggerService_1[_0x1c59f4(0x275)]['logWhiteDomainRequest']('mastercard',_0x1c59f4(0x2bd),_0x1c59f4(0x256),{'merchant_point_id':this[_0x1c59f4(0x2c6)],'method':_0x1c59f4(0x260),'lang':'en'});const _0x42eb78=Date[_0x1c59f4(0x286)](),_0x571681=await fetch(this[_0x1c59f4(0x24b)],{'method':_0x1c59f4(0x256),'headers':{'Content-Type':_0x1c59f4(0x23f),'Accept':_0x1c59f4(0x23f),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x4728b2)}),_0x5cf078=Date[_0x1c59f4(0x286)]()-_0x42eb78;console[_0x1c59f4(0x2d7)](_0x1c59f4(0x1eb)),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x249),_0x571681[_0x1c59f4(0x2b5)]),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x22d),_0x5cf078+'ms');if(!_0x571681['ok']){const _0x70a0de=await _0x571681[_0x1c59f4(0x228)]();console[_0x1c59f4(0x2d0)]('HTTP\x20Status:',_0x571681[_0x1c59f4(0x2b5)]),console['error']('Response\x20Body:',_0x70a0de),loggerService_1[_0x1c59f4(0x275)][_0x1c59f4(0x2d8)]('mastercard',_0x1c59f4(0x26e),_0x571681[_0x1c59f4(0x2b5)],_0x70a0de,_0x5cf078),loggerService_1['loggerService'][_0x1c59f4(0x2c8)](_0x1c59f4(0x278),'/charge',_0x1c59f4(0x2bf)+_0x571681[_0x1c59f4(0x2b5)]+':\x20'+_0x70a0de);throw new Error('HTTP\x20error!\x20status:\x20'+_0x571681['status']+_0x1c59f4(0x216)+_0x70a0de);}const _0x1a59f5=await _0x571681[_0x1c59f4(0x229)]();loggerService_1[_0x1c59f4(0x275)][_0x1c59f4(0x2d8)]('mastercard',_0x1c59f4(0x26e),_0x571681[_0x1c59f4(0x2b5)],_0x1a59f5,_0x5cf078),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x29d));let _0x1ddb1b=_0x1a59f5;if(_0x1a59f5[_0x1c59f4(0x2cf)]&&_0x1a59f5[_0x1c59f4(0x258)]&&_0x1a59f5['sign']){console[_0x1c59f4(0x2d7)](_0x1c59f4(0x25c));try{const _0x35f16e=await this[_0x1c59f4(0x1fc)](_0x1a59f5[_0x1c59f4(0x2cf)],_0x1a59f5[_0x1c59f4(0x258)]);_0x1ddb1b=JSON[_0x1c59f4(0x21e)](_0x35f16e),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x233)),loggerService_1[_0x1c59f4(0x275)][_0x1c59f4(0x2d8)](_0x1c59f4(0x278),_0x1c59f4(0x2e1),_0x571681[_0x1c59f4(0x2b5)],_0x1ddb1b,_0x5cf078),console[_0x1c59f4(0x2d7)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x36b8ec){console[_0x1c59f4(0x2d0)](_0x1c59f4(0x214),_0x36b8ec),loggerService_1[_0x1c59f4(0x275)][_0x1c59f4(0x2c8)](_0x1c59f4(0x278),_0x1c59f4(0x222),'Decryption\x20failed:\x20'+_0x36b8ec),_0x1ddb1b=_0x1a59f5;}}else loggerService_1['loggerService'][_0x1c59f4(0x2d8)]('mastercard','/charge_decrypted',_0x571681[_0x1c59f4(0x2b5)],_0x1ddb1b,_0x5cf078),console['log'](_0x1c59f4(0x232));console['log'](_0x1c59f4(0x249),_0x1ddb1b[_0x1c59f4(0x2b5)]),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x2a2),_0x1ddb1b[_0x1c59f4(0x253)]),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x23a),_0x1ddb1b[_0x1c59f4(0x1fb)]),console[_0x1c59f4(0x2d7)](_0x1c59f4(0x21b),_0x1ddb1b[_0x1c59f4(0x236)]||_0x1c59f4(0x1f9));if(_0x1ddb1b[_0x1c59f4(0x2b5)]===0x64&&_0x1ddb1b[_0x1c59f4(0x253)]===0x1)return console[_0x1c59f4(0x2d7)](_0x1c59f4(0x201)),{'gateway_payment_id':_0x1ddb1b[_0x1c59f4(0x1fb)]?.['toString'](),'payment_url':_0xa8aade,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x1ddb1b[_0x1c59f4(0x236)])return console[_0x1c59f4(0x2d7)](_0x1c59f4(0x211)),this[_0x1c59f4(0x219)](_0xef1e73,_0x3fc436,_0x1ddb1b[_0x1c59f4(0x1fb)]?.[_0x1c59f4(0x1ec)]()||_0x3fc436),{'gateway_payment_id':_0x1ddb1b['payment_id']?.['toString'](),'payment_url':_0x1ddb1b[_0x1c59f4(0x236)],'requires_3ds':!![],'threeds_url':_0x1ddb1b['3ds_url'],'status':_0x1c59f4(0x252),'final':![]};let _0x24ffc4=_0x1ddb1b[_0x1c59f4(0x1ef)]||_0x1ddb1b[_0x1c59f4(0x28f)]||_0x1c59f4(0x240),_0x31332b=_0x1ddb1b[_0x1c59f4(0x2b5)],_0x407768=_0x1ddb1b[_0x1c59f4(0x253)];return console[_0x1c59f4(0x2d7)](_0x1c59f4(0x279)+_0x31332b+_0x1c59f4(0x27d)+_0x407768+_0x1c59f4(0x2d1)+_0x24ffc4),{'gateway_payment_id':_0x1ddb1b['payment_id']?.[_0x1c59f4(0x1ec)](),'payment_url':_0xa8aade,'requires_3ds':![],'status':'FAILED','final':!![]};}catch(_0xc9a76c){console[_0x1c59f4(0x2d0)](_0x1c59f4(0x24f)),console['error']('Error\x20details:',_0xc9a76c),loggerService_1[_0x1c59f4(0x275)][_0x1c59f4(0x2c8)](_0x1c59f4(0x278),_0x1c59f4(0x2bd),_0xc9a76c);throw new Error(_0x1c59f4(0x20e)+(_0xc9a76c instanceof Error?_0xc9a76c[_0x1c59f4(0x28f)]:_0x1c59f4(0x240)));}}async[a42_0x3443b0(0x22e)](_0x312a6a,_0x489f9d){const _0x4d912e=a42_0x3443b0;console[_0x4d912e(0x2d7)]('📊\x20Checking\x20MasterCard\x20payment\x20status:\x20'+_0x312a6a+'\x20('+_0x489f9d+')');try{const _0x2256c0={'payment_id':_0x312a6a,'order_id':_0x489f9d},_0x4c3bc2=JSON[_0x4d912e(0x261)](_0x2256c0),{key:_0x39325d,iv:_0x3db23c}=this[_0x4d912e(0x2a1)](),_0xdda8f6=this['encryptAES'](_0x4c3bc2,_0x39325d,_0x3db23c),_0x592398=this[_0x4d912e(0x26a)](_0x39325d,_0x3db23c),_0x446e02=this[_0x4d912e(0x28c)](_0x4c3bc2),_0x1323c0={'merchant_point_id':this[_0x4d912e(0x2c6)],'method':_0x4d912e(0x2b5),'info':_0xdda8f6,'key':_0x592398,'sign':_0x446e02,'lang':'en'};loggerService_1[_0x4d912e(0x275)][_0x4d912e(0x2dc)](_0x4d912e(0x278),_0x4d912e(0x2db),'POST',{'merchant_point_id':this[_0x4d912e(0x2c6)],'method':_0x4d912e(0x2b5),'lang':'en'});const _0x5f4d66=Date[_0x4d912e(0x286)](),_0x22c468=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x4d912e(0x23f),'Accept':'application/json','User-Agent':_0x4d912e(0x27f)},'body':JSON[_0x4d912e(0x261)](_0x1323c0)}),_0x2f2481=Date[_0x4d912e(0x286)]()-_0x5f4d66;if(!_0x22c468['ok']){const _0x1b1bdb=await _0x22c468['text']();loggerService_1['loggerService'][_0x4d912e(0x2d8)](_0x4d912e(0x278),'/status_raw',_0x22c468['status'],_0x1b1bdb,_0x2f2481);throw new Error(_0x4d912e(0x2df)+_0x22c468[_0x4d912e(0x2b5)]);}const _0x34dc26=await _0x22c468[_0x4d912e(0x229)]();loggerService_1[_0x4d912e(0x275)][_0x4d912e(0x2d8)](_0x4d912e(0x278),'/status_raw',_0x22c468[_0x4d912e(0x2b5)],_0x34dc26,_0x2f2481);let _0xadbbe2=_0x34dc26;if(_0x34dc26['info']&&_0x34dc26[_0x4d912e(0x258)]&&_0x34dc26[_0x4d912e(0x299)]){console[_0x4d912e(0x2d7)](_0x4d912e(0x218));try{const _0x574c1d=this[_0x4d912e(0x2b9)](_0x34dc26[_0x4d912e(0x2cf)],_0x34dc26[_0x4d912e(0x258)]);_0xadbbe2=JSON[_0x4d912e(0x21e)](_0x574c1d),console[_0x4d912e(0x2d7)](_0x4d912e(0x2cd)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4d912e(0x278),_0x4d912e(0x20b),_0x22c468[_0x4d912e(0x2b5)],_0xadbbe2,_0x2f2481),console[_0x4d912e(0x2d7)](_0x4d912e(0x296));}catch(_0x1ac366){console[_0x4d912e(0x2d0)](_0x4d912e(0x2a8),_0x1ac366),loggerService_1['loggerService'][_0x4d912e(0x2c8)]('mastercard','/status_decrypt','Status\x20decryption\x20failed:\x20'+_0x1ac366),_0xadbbe2=_0x34dc26;}}else loggerService_1[_0x4d912e(0x275)][_0x4d912e(0x2d8)](_0x4d912e(0x278),'/status_decrypted',_0x22c468['status'],_0xadbbe2,_0x2f2481),console[_0x4d912e(0x2d7)]('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x4d912e(0x2d7)]('📊\x20Status\x20check\x20result:',{'status':_0xadbbe2[_0x4d912e(0x2b5)],'final':_0xadbbe2[_0x4d912e(0x253)],'payment_id':_0xadbbe2[_0x4d912e(0x1fb)],'desc':_0xadbbe2[_0x4d912e(0x1ef)]});let _0x2d7c01='PENDING';if(_0xadbbe2[_0x4d912e(0x2b5)]===0x1&&_0xadbbe2['final']===0x1)_0x2d7c01=_0x4d912e(0x207);else _0xadbbe2[_0x4d912e(0x2b5)]===0x0&&_0xadbbe2['final']===0x0?_0x2d7c01=_0x4d912e(0x252):_0x2d7c01=_0x4d912e(0x1f0);return{'status':_0x2d7c01,'final':_0xadbbe2[_0x4d912e(0x253)]===0x1,'amount':_0xadbbe2[_0x4d912e(0x24d)],'currency':_0xadbbe2[_0x4d912e(0x1fe)],'date_success':_0xadbbe2[_0x4d912e(0x274)],'description':_0xadbbe2[_0x4d912e(0x1ef)]};}catch(_0x3d0748){console[_0x4d912e(0x2d0)](_0x4d912e(0x29c),_0x3d0748),loggerService_1[_0x4d912e(0x275)][_0x4d912e(0x2c8)]('mastercard','/status',_0x3d0748);throw new Error('Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20'+(_0x3d0748 instanceof Error?_0x3d0748['message']:'Unknown\x20error'));}}[a42_0x3443b0(0x219)](_0x58cbcf,_0x49bdec,_0x453c0e){const _0x129540=a42_0x3443b0;console[_0x129540(0x2d7)](_0x129540(0x20f)+_0x58cbcf+'\x20('+_0x453c0e+')'),this['clearStatusTimers'](_0x58cbcf);const _0xc104e2=[],_0xf0cf0e=0x5*0x3c*0x3e8,_0x894119=0x2*0x3c*0x3c*0x3e8,_0x2b3806=Math[_0x129540(0x28d)](_0x894119/_0xf0cf0e);console['log']('⏰\x20Will\x20check\x20status\x20'+_0x2b3806+_0x129540(0x27c));for(let _0x164516=0x1;_0x164516<=_0x2b3806;_0x164516++){const _0x8e6da9=setTimeout(async()=>{const _0x58c2dd=_0x129540;console[_0x58c2dd(0x2d7)](_0x58c2dd(0x266)+_0x164516+'/'+_0x2b3806+_0x58c2dd(0x276)+_0x58cbcf);try{const _0x9bd5d4=await this[_0x58c2dd(0x22e)](_0x453c0e,_0x49bdec);console[_0x58c2dd(0x2d7)](_0x58c2dd(0x21f)+_0x164516+_0x58c2dd(0x2ca),_0x9bd5d4),_0x9bd5d4[_0x58c2dd(0x253)]&&(console[_0x58c2dd(0x2d7)]('✅\x20Payment\x20'+_0x58cbcf+_0x58c2dd(0x2a0)+_0x9bd5d4[_0x58c2dd(0x2b5)]+_0x58c2dd(0x269)),this['clearStatusTimers'](_0x58cbcf),await this[_0x58c2dd(0x1ff)](_0x58cbcf,_0x9bd5d4[_0x58c2dd(0x2b5)],_0x9bd5d4));}catch(_0x47c8e2){console['error'](_0x58c2dd(0x2a4)+_0x164516+_0x58c2dd(0x2c5)+_0x58cbcf+':',_0x47c8e2);}},_0x164516*_0xf0cf0e);_0xc104e2[_0x129540(0x1f2)](_0x8e6da9);}this[_0x129540(0x1ed)][_0x129540(0x1fd)](_0x58cbcf,_0xc104e2),console[_0x129540(0x2d7)](_0x129540(0x28a)+_0x2b3806+'\x20status\x20checks\x20for\x20payment\x20'+_0x58cbcf);}[a42_0x3443b0(0x272)](_0x154abb){const _0x21528d=a42_0x3443b0,_0x5aeb44=this[_0x21528d(0x1ed)][_0x21528d(0x2b4)](_0x154abb);_0x5aeb44&&(console[_0x21528d(0x2d7)](_0x21528d(0x2a3)+_0x5aeb44[_0x21528d(0x273)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x154abb),_0x5aeb44[_0x21528d(0x29f)]((_0x328bac,_0x3f4b62)=>{clearTimeout(_0x328bac);}),this[_0x21528d(0x1ed)][_0x21528d(0x241)](_0x154abb));}async['updatePaymentStatus'](_0x1d69fe,_0x4e35fe,_0x2e5c25){const _0x28f259=a42_0x3443b0;try{const _0x22eda6=(await Promise[_0x28f259(0x28b)]()['then'](()=>__importStar(require('../../config/database'))))[_0x28f259(0x221)],_0x8803b8={'status':_0x4e35fe['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x28f259(0x246),'statusChangedAt':new Date()};_0x4e35fe===_0x28f259(0x207)&&(_0x8803b8['paidAt']=new Date()),_0x2e5c25[_0x28f259(0x248)]&&(_0x8803b8[_0x28f259(0x210)]=_0x28f259(0x231)+_0x2e5c25['description']),await _0x22eda6['payment'][_0x28f259(0x1f6)]({'where':{'id':_0x1d69fe},'data':_0x8803b8}),console[_0x28f259(0x2d7)](_0x28f259(0x202)+_0x1d69fe+_0x28f259(0x2da)+_0x4e35fe),await this[_0x28f259(0x284)](_0x1d69fe,_0x4e35fe);}catch(_0x381437){console[_0x28f259(0x2d0)](_0x28f259(0x2b2)+_0x1d69fe+':',_0x381437);}}async[a42_0x3443b0(0x284)](_0x2f065f,_0x44792a){const _0x3c3d02=a42_0x3443b0;try{const _0x36504d=(await Promise[_0x3c3d02(0x28b)]()[_0x3c3d02(0x1f8)](()=>__importStar(require(_0x3c3d02(0x2a9)))))[_0x3c3d02(0x221)],{telegramBotService:_0x1fab03}=await Promise['resolve']()['then'](()=>__importStar(require(_0x3c3d02(0x2c3)))),_0xf4a71d=await _0x36504d['payment'][_0x3c3d02(0x234)]({'where':{'id':_0x2f065f},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0xf4a71d)return;const _0x44a5a5={'PAID':'paid','FAILED':_0x3c3d02(0x2ab)},_0x55b10f=_0x44a5a5[_0x44792a];_0x55b10f&&await _0x1fab03[_0x3c3d02(0x250)](_0xf4a71d['shopId'],_0xf4a71d,_0x55b10f),await this[_0x3c3d02(0x27a)](_0xf4a71d,_0x44792a);}catch(_0x348bf8){console[_0x3c3d02(0x2d0)](_0x3c3d02(0x290),_0x348bf8);}}async['sendShopWebhook'](_0x217a86,_0x5f0d85){const _0x110751=a42_0x3443b0,_0x4b5eaf=Date[_0x110751(0x286)]();try{const _0x2f4948=_0x217a86['shop'],_0x4e5d5a=_0x2f4948['settings'];if(!_0x4e5d5a?.['webhookUrl']){console['log'](_0x110751(0x2a6)+_0x2f4948['id']);return;}const _0x400eb4=_0x5f0d85==='PAID'?_0x110751(0x29e):_0x110751(0x23b);let _0xb65db6=[];if(_0x4e5d5a['webhookEvents'])try{_0xb65db6=Array[_0x110751(0x2ae)](_0x4e5d5a[_0x110751(0x239)])?_0x4e5d5a[_0x110751(0x239)]:JSON[_0x110751(0x21e)](_0x4e5d5a['webhookEvents']);}catch(_0x26b6c6){console['error']('Error\x20parsing\x20webhook\x20events:',_0x26b6c6),_0xb65db6=[];}if(!_0xb65db6[_0x110751(0x21c)](_0x400eb4)){console['log'](_0x110751(0x26c)+_0x400eb4+_0x110751(0x2c1)+_0x2f4948['id']);return;}const _0x20ddba={'event':_0x400eb4,'payment':{'id':_0x217a86['id'],'order_id':_0x217a86[_0x110751(0x2b6)],'gateway_order_id':_0x217a86[_0x110751(0x2a5)],'gateway':_0x110751(0x26d),'amount':_0x217a86[_0x110751(0x24d)],'currency':_0x217a86[_0x110751(0x1fe)],'status':_0x5f0d85['toLowerCase'](),'customer_email':_0x217a86['customerEmail'],'customer_name':_0x217a86[_0x110751(0x1f3)],'created_at':_0x217a86[_0x110751(0x22f)],'updated_at':new Date()}},_0x52ea74=await fetch(_0x4e5d5a[_0x110751(0x2d4)],{'method':_0x110751(0x256),'headers':{'Content-Type':'application/json','User-Agent':_0x110751(0x282)},'body':JSON[_0x110751(0x261)](_0x20ddba)}),_0x3c13f9=Date[_0x110751(0x286)]()-_0x4b5eaf;loggerService_1[_0x110751(0x275)][_0x110751(0x206)](_0x217a86['shopId'],_0x4e5d5a['webhookUrl'],_0x400eb4,_0x52ea74[_0x110751(0x2b5)],_0x3c13f9,_0x20ddba),console['log'](_0x110751(0x243)+_0x4e5d5a[_0x110751(0x2d4)]+_0x110751(0x25d)+_0x52ea74[_0x110751(0x2b5)]+'\x20('+_0x3c13f9+'ms)');}catch(_0x167c9b){console['error'](_0x110751(0x2b3),_0x167c9b),loggerService_1[_0x110751(0x275)][_0x110751(0x24e)](_0x217a86[_0x110751(0x21d)],_0x217a86[_0x110751(0x2b8)]?.[_0x110751(0x244)]?.[_0x110751(0x2d4)]||'unknown',_0x110751(0x24c),_0x167c9b,{});}}['maskCardNumber'](_0x2f3b9e){const _0x560681=a42_0x3443b0,_0x34da10=_0x2f3b9e[_0x560681(0x265)](/[\s-]/g,'');if(_0x34da10[_0x560681(0x273)]<0x4)return _0x560681(0x292);return _0x560681(0x21a)+_0x34da10[_0x560681(0x263)](-0x4);}async[a42_0x3443b0(0x271)](_0x4cf15d){const _0x3d94a6=a42_0x3443b0;console[_0x3d94a6(0x2d7)]('Processing\x20MasterCard\x20webhook:',_0x4cf15d);let _0x2f38f3=_0x3d94a6(0x252);if(_0x4cf15d[_0x3d94a6(0x2b5)]===0x1&&_0x4cf15d[_0x3d94a6(0x253)]===0x1)_0x2f38f3=_0x3d94a6(0x207);else _0x4cf15d[_0x3d94a6(0x2b5)]===0x0&&_0x4cf15d[_0x3d94a6(0x253)]===0x0?_0x2f38f3=_0x3d94a6(0x252):_0x2f38f3=_0x3d94a6(0x1f0);return{'paymentId':_0x4cf15d[_0x3d94a6(0x1fa)]||'','status':_0x2f38f3,'amount':_0x4cf15d[_0x3d94a6(0x24d)],'currency':_0x4cf15d['currency']};}[a42_0x3443b0(0x25a)](){const _0xa9ef54=a42_0x3443b0;console[_0xa9ef54(0x2d7)](_0xa9ef54(0x24a));const _0x598fcc=this[_0xa9ef54(0x1ed)][_0xa9ef54(0x2b1)];for(const [_0x562774]of this[_0xa9ef54(0x1ed)]){this['clearStatusTimers'](_0x562774);}console[_0xa9ef54(0x2d7)](_0xa9ef54(0x2c0)+_0x598fcc+_0xa9ef54(0x2c9));}}exports['MasterCardService']=MasterCardService;