'use strict';const a51_0x40b7f2=a51_0x3b76;(function(_0x53b809,_0x24845c){const _0x4187ec=a51_0x3b76,_0x1d1d93=_0x53b809();while(!![]){try{const _0xf134be=parseInt(_0x4187ec(0x17e))/0x1+-parseInt(_0x4187ec(0x1e1))/0x2+-parseInt(_0x4187ec(0x1ad))/0x3*(-parseInt(_0x4187ec(0xa2))/0x4)+-parseInt(_0x4187ec(0x109))/0x5+parseInt(_0x4187ec(0x13a))/0x6+parseInt(_0x4187ec(0x14e))/0x7+-parseInt(_0x4187ec(0xbd))/0x8;if(_0xf134be===_0x24845c)break;else _0x1d1d93['push'](_0x1d1d93['shift']());}catch(_0x29544c){_0x1d1d93['push'](_0x1d1d93['shift']());}}}(a51_0x47e9,0x72b3f));function a51_0x47e9(){const _0x11ce83=['__createBinding','sign','application/json','\x20\x20\x20Currency:\x20','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','desc','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','paymentStatuses','\x20webhook\x20extracted\x20data:','PENDING','Cash\x20payment\x20is\x20expected\x20at\x20TCO','✅\x20Payment\x20','findUnique','log','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','VisaMasterCardService','payment','__importStar','ms)','\x20\x20\x20Status:\x20','errorMessage','Payment\x20System/1.0\x20(MasterCard)','🔍\x20','\x20order_id\x20for\x20search:\x20',',\x20payment_id=','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','status','now','\x20with\x20status\x20','loggerService','keys','readFileSync','Failed\x20to\x20check\x20','SHA256','Amount:','masterCardMerchantPointId','🔐\x20VISA\x20Private\x20key\x20length:\x20','description','\x20MasterCard\x20status\x20check\x20timers','final','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','clearStatusTimers','Payment\x20returned','merchantPointId','\x20payment:\x20','LookUp\x20number\x20of\x20attempts\x20exceeded','721607ORMFfb','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','failureMessage','🔐\x20Data\x20signed\x20with\x20RSA','delete','utf8','Insufficient\x20funds\x20on\x20the\x20card','❌\x20Status\x20check\x20#','cardType','🔐\x20VISA\x20Private\x20key\x20path:','/status_raw','cvv','Decryption\x20failed:\x20','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','\x20result:','VISA','\x22\x20|\x20\x22','🛑\x20Stopped\x20','then','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','Awaiting\x20confirmation\x20in\x20the\x20application','prototype','Payment\x20pending\x20verification','apiUrl','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','logShopWebhookError','\x20is\x20final\x20(','encryptAES','visaMerchantPointId','updatePaymentStatus','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','📝\x20Encrypted\x20key\x20length:','HTTP\x20Status:','Payment\x20confirmation\x20time\x20has\x20expired','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','📝\x20Final\x20request\x20structure:','Awaiting\x20confirmation\x20by\x20ivr\x20call','/charge_decrypt','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','\x20(from:\x20status=','order_id','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Payment\x20ID:','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','payment.failed','createdAt','30aTLNiR','Payment\x20System/1.0','customerEmail','cwd','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','paid','orderId','Payment\x20prohibited','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','\x20\x20Original:\x20\x22','\x20payment_id\x20for\x20search:\x20','Unsuccessful\x20payment','end','Payment\x20cancellation\x20is\x20being\x20processed','isFinalStatus','warn','payment_id','Another\x20unknown\x20error','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','📤\x20Sending\x20request\x20to\x20API...','Recipient\x20data\x20required','message','Error\x20details:','visa_private.pem','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','existsSync','Final:','../telegramBotService','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','stringify','visa_public.pem','checkPaymentStatus','\x20status\x20check\x20#','trim','LookUp\x20not\x20confirmed','statusCheckTimers','Unknown\x20error','Number\x20of\x20attempts\x20exceeded','Status:','__esModule','number','info','Cancellation\x20is\x20not\x20possible','/charge_decrypted','from','generateAESKey','📝\x20Encrypted\x20data\x20length:','constants','sendShopWebhook','/status_decrypted','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','call','718738sDgelM','Sender\x20information\x20required','Result\x20URL:','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20\x20\x20-\x20method:\x20charge','HTTP\x20','decryptAES','-----BEGIN','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','-----END','Sender\x27s\x20card\x20details\x20are\x20required','currency','default','🔐\x20Using\x20keys:\x20','\x20not\x20enabled\x20for\x20shop\x20','gatewayOrderId','psp_public.pem','🔐\x20MasterCard\x20API\x20URL:','Return\x20URL:','configurable','get','Response\x20Body:','289724UsXxsj',',\x20paymentId=','replace','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','paidAt','PAID','/charge','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','✅\x20VISA\x20key\x20files\x20validated\x20successfully','defineProperty','❌\x20Detailed\x20failure\x20description:\x20','decryptResponsePhp','toLowerCase','📊\x20Status\x20check\x20result:','Invalid\x20expiration\x20date','Payment\x20is\x20being\x20processed','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','3ds_url','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','visaPublicKeyPath','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','Card\x20Holder:','Request\x20data\x20error','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','14180080KurnRQ','toString','Failed\x20payment','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application',':\x20Unknown\x20status\x20code','🔐\x20AES\x20key\x20and\x20IV\x20generated','floor','PHP\x20decryptor\x20error','Response\x20Time:','__importDefault','charAt','aes-256-ctr','signRSA','text',',\x20orderId=','🔍\x20Using\x20','validateKeyFiles','🔐\x20Data\x20encrypted\x20with\x20AES','payment.success','\x20status\x20timers\x20for\x20payment\x20','\x20\x20\x20-\x20key\x20length:','encryptRSA','No\x20New\x20payment','webhook_send',',\x20Desc:\x20','),\x20defaulting\x20to\x20MasterCard','create','getCardTypeAndApi','logWhiteDomainResponse','\x20\x20Cleaned:\x20\x20\x22','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','4000000000000000','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','getDetailedErrorMessage','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','sendPaymentNotifications','scheduleStatusChecks','substring','base64','📊\x20Status\x20check\x20#','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','push','webhookEvents','size','⏰\x20Will\x20check\x20status\x20','none','MasterCard\x20webhook\x20sent\x20to\x20','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','\x20\x20\x20Payment\x20ID:\x20','failed','/status','shopId','No\x20Error\x20executing\x20request','visa/mastercard','publicEncrypt','⏰\x20Scheduling\x20status\x20checks\x20for\x20','visaPrivateKeyPath','\x20status\x20updated\x20to\x20','The\x20card\x20does\x20not\x20exist','\x20\x20\x20-\x20lang:\x20en','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','),\x20stopping\x20status\x20checks','3DS\x20verification\x20required','settings','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','amount','webhookUrl','POST','join','Order\x20ID:','Method\x20not\x20allowed','FAILED','🔐\x20RSA\x20signing\x20successful','hasOwnProperty','Failed\x20to\x20decrypt\x20response','📝\x20Data\x20to\x20sign\x20length:','647325uKnQXN','update','decryptResponse','\x20|\x20Response:\x20','\x20\x20\x20-\x20sign\x20length:','shop','\x20API:\x20','../../config/database','📝\x20Signature\x20length:','MASTERCARD','/charge_raw','✅\x20Scheduled\x20','\x20payment\x20status:\x20','🔍\x20Using\x20provided\x20card\x20type:\x20','Client\x20OTP\x20confirmation\x20required','https://api.paydmeth.com/api','date_success','publicKeyPath','The\x20card\x20is\x20lost\x20or\x20stolen','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','Card\x20Number:','charge','length','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','key','first_name','Status\x20decryption\x20failed:\x20','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','logWhiteDomainRequest','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','🔐\x20VISA\x20Public\x20key\x20path:','Sender\x27s\x20CVV\x20card\x20is\x20required','1111','\x20failed\x20for\x20payment\x20','\x20\x20\x20-\x20info\x20length:','🧹\x20Clearing\x20','RSA_PKCS1_PADDING','card_type','includes','privateKeyPath','stopAllStatusChecks','randomBytes',',\x20body:\x20','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',',\x20Final:\x20','Test\x20payment','🧹\x20Card\x20holder\x20names\x20cleaned:','parse','masterCardApiUrl','3171570WYyTWY','logWhiteDomainError','error','Captcha\x20confirmation\x20awaited','createDecipheriv','\x20characters','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','❌\x20RSA\x20encryption\x20failed:','HTTP\x20error!\x20status:\x20','💾\x20Saving\x20failure\x20message:\x20','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','maskCardNumber','Error\x20parsing\x20webhook\x20events:','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','last_name','visaApiUrl','toUpperCase','✅\x20Payment\x20successful','resolve','****','5296585vvafLp','LookUp\x20code\x20sent'];a51_0x47e9=function(){return _0x11ce83;};return a51_0x47e9();}function a51_0x3b76(_0x40753f,_0xde6bc1){const _0x47e943=a51_0x47e9();return a51_0x3b76=function(_0x3b765c,_0x57f9f7){_0x3b765c=_0x3b765c-0x8e;let _0x37777b=_0x47e943[_0x3b765c];return _0x37777b;},a51_0x3b76(_0x40753f,_0xde6bc1);}var __createBinding=this&&this[a51_0x40b7f2(0x150)]||(Object[a51_0x40b7f2(0xd7)]?function(_0xb2f2d8,_0x18cb2b,_0x74abe,_0x241c26){const _0x2c5088=a51_0x40b7f2;if(_0x241c26===undefined)_0x241c26=_0x74abe;var _0x17b1ff=Object['getOwnPropertyDescriptor'](_0x18cb2b,_0x74abe);(!_0x17b1ff||('get'in _0x17b1ff?!_0x18cb2b['__esModule']:_0x17b1ff['writable']||_0x17b1ff[_0x2c5088(0x9f)]))&&(_0x17b1ff={'enumerable':!![],'get':function(){return _0x18cb2b[_0x74abe];}}),Object[_0x2c5088(0xac)](_0xb2f2d8,_0x241c26,_0x17b1ff);}:function(_0x14eef1,_0x558199,_0x36d3be,_0x62b34c){if(_0x62b34c===undefined)_0x62b34c=_0x36d3be;_0x14eef1[_0x62b34c]=_0x558199[_0x36d3be];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x5d22db,_0x36acb2){const _0x2b5b11=a51_0x40b7f2;Object[_0x2b5b11(0xac)](_0x5d22db,'default',{'enumerable':!![],'value':_0x36acb2});}:function(_0x885d95,_0x48cc76){_0x885d95['default']=_0x48cc76;}),__importStar=this&&this[a51_0x40b7f2(0x161)]||(function(){var _0x66a7c=function(_0x35762d){return _0x66a7c=Object['getOwnPropertyNames']||function(_0xd7edf4){const _0x238478=a51_0x3b76;var _0x89893d=[];for(var _0x1bef2a in _0xd7edf4)if(Object[_0x238478(0x193)][_0x238478(0x106)][_0x238478(0x1e0)](_0xd7edf4,_0x1bef2a))_0x89893d[_0x89893d[_0x238478(0x11f)]]=_0x1bef2a;return _0x89893d;},_0x66a7c(_0x35762d);};return function(_0x23480c){const _0x22cb3f=a51_0x3b76;if(_0x23480c&&_0x23480c['__esModule'])return _0x23480c;var _0x482f08={};if(_0x23480c!=null){for(var _0x3ad503=_0x66a7c(_0x23480c),_0x4df207=0x0;_0x4df207<_0x3ad503['length'];_0x4df207++)if(_0x3ad503[_0x4df207]!==_0x22cb3f(0x98))__createBinding(_0x482f08,_0x23480c,_0x3ad503[_0x4df207]);}return __setModuleDefault(_0x482f08,_0x23480c),_0x482f08;};}()),__importDefault=this&&this[a51_0x40b7f2(0xc6)]||function(_0x5a9348){const _0x59f352=a51_0x40b7f2;return _0x5a9348&&_0x5a9348[_0x59f352(0x1d4)]?_0x5a9348:{'default':_0x5a9348};};Object[a51_0x40b7f2(0xac)](exports,a51_0x40b7f2(0x1d4),{'value':!![]}),exports[a51_0x40b7f2(0x15f)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require('../loggerService');class VisaMasterCardService{constructor(){const _0x1183ee=a51_0x40b7f2;this[_0x1183ee(0x1d0)]=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0x1183ee(0xd3)},0x1:{'final':![],'description':_0x1183ee(0xf1)},0x2:{'final':!![],'description':_0x1183ee(0xbb)},0x3:{'final':!![],'description':_0x1183ee(0x1be)},0x4:{'final':!![],'description':'Unsuccessful\x20payment'},0x5:{'final':!![],'description':'Payment\x20not\x20found\x20using\x20the\x20specified\x20details'},0x6:{'final':!![],'description':_0x1183ee(0x17a)},0x7:{'final':!![],'description':_0x1183ee(0x136)},0x8:{'final':![],'description':_0x1183ee(0x117)},0x9:{'final':![],'description':_0x1183ee(0xfb)},0xa:{'final':![],'description':_0x1183ee(0x128)},0xb:{'final':![],'description':_0x1183ee(0x1e2)},0xc:{'final':![],'description':_0x1183ee(0x1c1)},0xd:{'final':![],'description':_0x1183ee(0xaa)},0xe:{'final':![],'description':_0x1183ee(0x1a2)},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':_0x1183ee(0x13d)},0x11:{'final':![],'description':_0x1183ee(0x124)},0x12:{'final':![],'description':_0x1183ee(0x192)},0x13:{'final':![],'description':_0x1183ee(0xb2)},0x14:{'final':![],'description':_0x1183ee(0x1c5)},0x15:{'final':![],'description':'Expected\x20bitcoin\x20transfer\x20from\x20client'},0x16:{'final':![],'description':_0x1183ee(0x194)},0x18:{'final':![],'description':'The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':_0x1183ee(0x15a)},0x1b:{'final':![],'description':_0x1183ee(0xb9)},0x1c:{'final':![],'description':_0x1183ee(0xc0)},0x1d:{'final':![],'description':_0x1183ee(0x154)},0x1f:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending'},0x20:{'final':![],'description':_0x1183ee(0x1a4)},0x23:{'final':![],'description':_0x1183ee(0x96)},0x24:{'final':!![],'description':_0x1183ee(0x19f)},0x25:{'final':!![],'description':_0x1183ee(0x1b4)},0x26:{'final':!![],'description':_0x1183ee(0xb6)},0x27:{'final':!![],'description':_0x1183ee(0x184)},0x28:{'final':!![],'description':_0x1183ee(0xf7)},0x29:{'final':!![],'description':_0x1183ee(0x11b)},0x2a:{'final':!![],'description':_0x1183ee(0xb1)},0x2b:{'final':!![],'description':'Transaction\x20limit\x20exceeded'},0x2c:{'final':!![],'description':_0x1183ee(0x140)},0x2d:{'final':!![],'description':_0x1183ee(0xbf)},0x2e:{'final':!![],'description':'Unsuccessful\x20payment'},0x2f:{'final':!![],'description':_0x1183ee(0x1b8)},0x30:{'final':!![],'description':_0x1183ee(0x1aa)},0x31:{'final':![],'description':'Payment\x20confirmation\x20required'},0x32:{'final':!![],'description':_0x1183ee(0x103)},0x33:{'final':!![],'description':'Failed\x20payment'},0x34:{'final':!![],'description':'Failed\x20payment'},0x35:{'final':!![],'description':'Failed\x20payment'},0x36:{'final':!![],'description':_0x1183ee(0xbf)},0x37:{'final':!![],'description':_0x1183ee(0xbf)},0x38:{'final':!![],'description':_0x1183ee(0x1d7)},0x39:{'final':![],'description':_0x1183ee(0x156)},0x3a:{'final':![],'description':_0x1183ee(0x14f)},0x3b:{'final':!![],'description':'LookUp\x20code\x20verified'},0x3c:{'final':!![],'description':_0x1183ee(0x1d2)},0x3d:{'final':!![],'description':_0x1183ee(0xf9)},0x3e:{'final':!![],'description':_0x1183ee(0x17f)},0x3f:{'final':!![],'description':_0x1183ee(0x17a)},0x40:{'final':![],'description':_0x1183ee(0x1cf)},0x41:{'final':!![],'description':_0x1183ee(0x17d)},0x42:{'final':![],'description':_0x1183ee(0x1ba)},0x43:{'final':!![],'description':_0x1183ee(0xa6)},0x44:{'final':![],'description':_0x1183ee(0xfb)},0x45:{'final':!![],'description':_0x1183ee(0xbf)},0x46:{'final':!![],'description':_0x1183ee(0xbf)},0x47:{'final':!![],'description':_0x1183ee(0x169)},0x64:{'final':!![],'description':'Operation\x20completed\x20successfully'}},this[_0x1183ee(0x139)]=_0x1183ee(0x118),this[_0x1183ee(0x173)]=0x6e4,this[_0x1183ee(0x130)]=path_1[_0x1183ee(0x98)][_0x1183ee(0x101)](process[_0x1183ee(0x1b0)](),_0x1183ee(0x16e),'private.pem'),this['publicKeyPath']=path_1[_0x1183ee(0x98)][_0x1183ee(0x101)](process['cwd'](),'keys',_0x1183ee(0x9c)),this[_0x1183ee(0x149)]=_0x1183ee(0x118),this[_0x1183ee(0x19a)]=0x6b7,this[_0x1183ee(0xf5)]=path_1[_0x1183ee(0x98)]['join'](process[_0x1183ee(0x1b0)](),_0x1183ee(0x16e),_0x1183ee(0x1c4)),this[_0x1183ee(0xb8)]=path_1[_0x1183ee(0x98)][_0x1183ee(0x101)](process[_0x1183ee(0x1b0)](),_0x1183ee(0x16e),_0x1183ee(0x1cb)),console[_0x1183ee(0x15d)]('💳\x20VISA/MasterCard\x20service\x20initialized'),console[_0x1183ee(0x15d)](_0x1183ee(0x9d),this[_0x1183ee(0x139)]),console[_0x1183ee(0x15d)]('🔐\x20VISA\x20API\x20URL:',this['visaApiUrl']),console[_0x1183ee(0x15d)]('🔐\x20MasterCard\x20Private\x20key\x20path:',this[_0x1183ee(0x130)]),console['log']('🔐\x20MasterCard\x20Public\x20key\x20path:',this[_0x1183ee(0x11a)]),console[_0x1183ee(0x15d)](_0x1183ee(0x187),this[_0x1183ee(0xf5)]),console[_0x1183ee(0x15d)](_0x1183ee(0x127),this['visaPublicKeyPath']),this[_0x1183ee(0xcd)]();}[a51_0x40b7f2(0xde)](_0x42ece0,_0xb8f816){const _0xf73cdb=a51_0x40b7f2,_0xf4bb1d=this[_0xf73cdb(0x157)][_0x42ece0];let _0xb0b04c='';_0xf4bb1d?_0xb0b04c='Status\x20'+_0x42ece0+':\x20'+_0xf4bb1d[_0xf73cdb(0x175)]:_0xb0b04c='Status\x20'+_0x42ece0+_0xf73cdb(0xc1);if(_0xb8f816&&_0xb8f816[_0xf73cdb(0x1ce)]()){const _0x22e912=_0xb8f816['trim']();(!_0xf4bb1d||_0x22e912[_0xf73cdb(0xaf)]()!==_0xf4bb1d['description'][_0xf73cdb(0xaf)]())&&(_0xb0b04c+=_0xf73cdb(0x10c)+_0x22e912);}return _0xb0b04c;}['isFinalStatus'](_0x15e49e){const _0x31f770=a51_0x40b7f2,_0xf60672=this[_0x31f770(0x157)][_0x15e49e];return _0xf60672?_0xf60672[_0x31f770(0x177)]:!![];}[a51_0x40b7f2(0xd8)](_0x39b258){const _0x3611cb=a51_0x40b7f2,_0x57b531=_0x39b258[_0x3611cb(0xc7)](0x0);if(_0x57b531==='4')return console['log']('💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)'),{'cardType':_0x3611cb(0x18d),'apiUrl':this[_0x3611cb(0x149)],'privateKeyPath':this[_0x3611cb(0xf5)],'publicKeyPath':this[_0x3611cb(0xb8)],'merchantPointId':this[_0x3611cb(0x19a)]};else return _0x57b531==='5'?(console['log'](_0x3611cb(0x11c)),{'cardType':'MASTERCARD','apiUrl':this[_0x3611cb(0x139)],'privateKeyPath':this[_0x3611cb(0x130)],'publicKeyPath':this[_0x3611cb(0x11a)],'merchantPointId':this['masterCardMerchantPointId']}):(console['log'](_0x3611cb(0x126)+_0x57b531+_0x3611cb(0xd6)),{'cardType':_0x3611cb(0x112),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x3611cb(0x130)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x3611cb(0x173)]});}['validateKeyFiles'](){const _0x4a811e=a51_0x40b7f2;try{if(!fs_1[_0x4a811e(0x98)][_0x4a811e(0x1c6)](this[_0x4a811e(0x130)]))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this[_0x4a811e(0x130)]);if(!fs_1[_0x4a811e(0x98)][_0x4a811e(0x1c6)](this[_0x4a811e(0x11a)]))throw new Error(_0x4a811e(0x19c)+this['publicKeyPath']);const _0x1c7a52=fs_1[_0x4a811e(0x98)][_0x4a811e(0x16f)](this[_0x4a811e(0x130)],_0x4a811e(0x183))[_0x4a811e(0x1ce)](),_0x3da9dd=fs_1[_0x4a811e(0x98)][_0x4a811e(0x16f)](this[_0x4a811e(0x11a)],_0x4a811e(0x183))[_0x4a811e(0x1ce)]();if(!_0x1c7a52[_0x4a811e(0x12f)](_0x4a811e(0x93))||!_0x1c7a52[_0x4a811e(0x12f)](_0x4a811e(0x95)))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x3da9dd[_0x4a811e(0x12f)](_0x4a811e(0x93))||!_0x3da9dd[_0x4a811e(0x12f)](_0x4a811e(0x95)))throw new Error(_0x4a811e(0x120));console[_0x4a811e(0x15d)](_0x4a811e(0x191)),console[_0x4a811e(0x15d)](_0x4a811e(0x18b)+_0x1c7a52[_0x4a811e(0x11f)]+'\x20characters'),console[_0x4a811e(0x15d)]('🔐\x20MasterCard\x20Public\x20key\x20length:\x20'+_0x3da9dd['length']+_0x4a811e(0x13f));if(fs_1[_0x4a811e(0x98)][_0x4a811e(0x1c6)](this[_0x4a811e(0xf5)])&&fs_1[_0x4a811e(0x98)][_0x4a811e(0x1c6)](this[_0x4a811e(0xb8)])){const _0x6d00ba=fs_1[_0x4a811e(0x98)]['readFileSync'](this[_0x4a811e(0xf5)],_0x4a811e(0x183))['trim'](),_0x2f7156=fs_1[_0x4a811e(0x98)][_0x4a811e(0x16f)](this[_0x4a811e(0xb8)],_0x4a811e(0x183))[_0x4a811e(0x1ce)]();(!_0x6d00ba[_0x4a811e(0x12f)](_0x4a811e(0x93))||!_0x6d00ba[_0x4a811e(0x12f)](_0x4a811e(0x95)))&&console[_0x4a811e(0x1bc)](_0x4a811e(0xb5)),(!_0x2f7156[_0x4a811e(0x12f)](_0x4a811e(0x93))||!_0x2f7156[_0x4a811e(0x12f)](_0x4a811e(0x95)))&&console[_0x4a811e(0x1bc)](_0x4a811e(0x1a7)),console['log'](_0x4a811e(0xab)),console[_0x4a811e(0x15d)](_0x4a811e(0x174)+_0x6d00ba[_0x4a811e(0x11f)]+_0x4a811e(0x13f)),console[_0x4a811e(0x15d)]('🔐\x20VISA\x20Public\x20key\x20length:\x20'+_0x2f7156[_0x4a811e(0x11f)]+'\x20characters');}else console[_0x4a811e(0x1bc)](_0x4a811e(0xec)),console[_0x4a811e(0x1bc)](_0x4a811e(0xa5)+this['visaPrivateKeyPath']),console['warn'](_0x4a811e(0xfd)+this[_0x4a811e(0xb8)]);}catch(_0x879e5){console['error'](_0x4a811e(0x1a0),_0x879e5);throw _0x879e5;}}[a51_0x40b7f2(0x1da)](){const _0x1ff3a7=a51_0x40b7f2,_0x59d2a3=crypto_1[_0x1ff3a7(0x98)]['randomBytes'](0x20),_0x30837f=crypto_1[_0x1ff3a7(0x98)][_0x1ff3a7(0x132)](0x10);return{'key':_0x59d2a3,'iv':_0x30837f};}[a51_0x40b7f2(0x199)](_0x5ad6be,_0x3fb7d1,_0x3fe8f9){const _0x236ec9=a51_0x40b7f2,_0x4f2ee9=crypto_1[_0x236ec9(0x98)]['createCipheriv'](_0x236ec9(0xc8),_0x3fb7d1,_0x3fe8f9);let _0x44cc4b=_0x4f2ee9[_0x236ec9(0x10a)](_0x5ad6be,_0x236ec9(0x183),'base64');return _0x44cc4b+=_0x4f2ee9[_0x236ec9(0x177)](_0x236ec9(0xe3)),_0x44cc4b;}[a51_0x40b7f2(0xd2)](_0x5477d1,_0xa72f9,_0x184ec0){const _0x4227d9=a51_0x40b7f2;try{const _0x3dc0d9=fs_1[_0x4227d9(0x98)][_0x4227d9(0x16f)](_0x184ec0,'utf8')['trim'](),_0x46dc4b={'iv':_0xa72f9[_0x4227d9(0xbe)](_0x4227d9(0xe3)),'key':_0x5477d1[_0x4227d9(0xbe)](_0x4227d9(0xe3))},_0x974df0=JSON['stringify'](_0x46dc4b);console[_0x4227d9(0x15d)](_0x4227d9(0x134),_0x974df0[_0x4227d9(0x11f)]);const _0xde0b71=crypto_1[_0x4227d9(0x98)][_0x4227d9(0xf3)]({'key':_0x3dc0d9,'padding':crypto_1['default'][_0x4227d9(0x1dc)][_0x4227d9(0x12d)]},Buffer['from'](_0x974df0));return console[_0x4227d9(0x15d)]('✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0xde0b71[_0x4227d9(0x11f)]),_0xde0b71[_0x4227d9(0xbe)]('base64');}catch(_0x115607){console[_0x4227d9(0x13c)](_0x4227d9(0x141),_0x115607);throw new Error(_0x4227d9(0xe5));}}['signRSA'](_0x10ec10,_0x13e134){const _0x27d601=a51_0x40b7f2;try{const _0xe874a1=fs_1[_0x27d601(0x98)][_0x27d601(0x16f)](_0x13e134,_0x27d601(0x183))[_0x27d601(0x1ce)](),_0x211a83=crypto_1['default']['createSign'](_0x27d601(0x171));_0x211a83['update'](_0x10ec10),_0x211a83[_0x27d601(0x1b9)]();const _0x51c9ea=_0x211a83[_0x27d601(0x151)](_0xe874a1,_0x27d601(0xe3));return console[_0x27d601(0x15d)](_0x27d601(0x105)),console[_0x27d601(0x15d)](_0x27d601(0x108),_0x10ec10[_0x27d601(0x11f)]),console[_0x27d601(0x15d)]('📝\x20Signature\x20length:',_0x51c9ea[_0x27d601(0x11f)]),_0x51c9ea;}catch(_0x4ebd1a){console[_0x27d601(0x13c)]('❌\x20RSA\x20signing\x20failed:',_0x4ebd1a),console[_0x27d601(0x13c)]('❌\x20Data\x20being\x20signed:',_0x10ec10[_0x27d601(0xe2)](0x0,0xc8)+'...');throw new Error(_0x27d601(0x1b5));}}['decryptAES'](_0xc35a1a,_0x4471ca,_0x26489e){const _0x1a2d62=a51_0x40b7f2,_0x389ea4=crypto_1[_0x1a2d62(0x98)][_0x1a2d62(0x13e)](_0x1a2d62(0xc8),_0x4471ca,_0x26489e);let _0x26abdd=_0x389ea4[_0x1a2d62(0x10a)](_0xc35a1a,'base64','utf8');return _0x26abdd+=_0x389ea4[_0x1a2d62(0x177)](_0x1a2d62(0x183)),_0x26abdd;}async[a51_0x40b7f2(0xae)](_0x387d11,_0x4fadb8,_0x5946b4=a51_0x40b7f2(0x112)){const _0x43031b=a51_0x40b7f2;try{const _0x167390=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x43031b(0x100),'headers':{'Content-Type':_0x43031b(0x152)},'body':JSON['stringify']({'info':_0x387d11,'key':_0x4fadb8,'card_type':_0x5946b4[_0x43031b(0xaf)]()})});if(!_0x167390['ok'])throw new Error(_0x43031b(0xc4));return await _0x167390['text']();}catch(_0x5bc634){console[_0x43031b(0x13c)]('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x5bc634);throw new Error(_0x43031b(0x1bf));}}[a51_0x40b7f2(0x10b)](_0x2bef23,_0x19b292){const _0xb5fe26=a51_0x40b7f2;try{const _0x377937=fs_1[_0xb5fe26(0x98)]['readFileSync'](this[_0xb5fe26(0x130)],_0xb5fe26(0x183))['trim'](),_0x4ba332=crypto_1[_0xb5fe26(0x98)]['privateDecrypt'](_0x377937,Buffer['from'](_0x19b292,_0xb5fe26(0xe3))),_0x275654=JSON['parse'](_0x4ba332[_0xb5fe26(0xbe)]()),_0x2a9481=Buffer[_0xb5fe26(0x1d9)](_0x275654[_0xb5fe26(0x121)],_0xb5fe26(0xe3)),_0x3f610e=Buffer[_0xb5fe26(0x1d9)](_0x275654['iv'],_0xb5fe26(0xe3));return this[_0xb5fe26(0x92)](_0x2bef23,_0x2a9481,_0x3f610e);}catch(_0x350298){throw new Error(_0xb5fe26(0x107));}}async['processCardPayment'](_0x1388e9){const _0x4f64fd=a51_0x40b7f2,{paymentId:_0xed98dc,orderId:_0x51496d,amount:_0x48b5b0,currency:_0x1dbfc4,cardData:_0x241fee,resultUrl:_0x2618d8,returnUrl:_0x40ba34,cardHolder:_0x419b9d,browser:_0x59c279}=_0x1388e9;console[_0x4f64fd(0x15d)]('===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x4f64fd(0x15d)](_0x4f64fd(0x1a8),_0xed98dc),console[_0x4f64fd(0x15d)](_0x4f64fd(0x102),_0x51496d),console[_0x4f64fd(0x15d)](_0x4f64fd(0x172),_0x48b5b0,_0x1dbfc4),console['log'](_0x4f64fd(0x11d),this[_0x4f64fd(0x145)](_0x241fee['number'])),console[_0x4f64fd(0x15d)](_0x4f64fd(0xba),_0x419b9d[_0x4f64fd(0x122)]+'\x20'+_0x419b9d[_0x4f64fd(0x148)]),console[_0x4f64fd(0x15d)](_0x4f64fd(0x9e),_0x40ba34),console[_0x4f64fd(0x15d)](_0x4f64fd(0x1e3),_0x2618d8);const _0x1a6ce8=this[_0x4f64fd(0xd8)](_0x241fee[_0x4f64fd(0x1d5)]);console[_0x4f64fd(0x15d)]('🎯\x20Using\x20'+_0x1a6ce8[_0x4f64fd(0x186)]+_0x4f64fd(0x10f)+_0x1a6ce8[_0x4f64fd(0x195)]),console[_0x4f64fd(0x15d)](_0x4f64fd(0x99)+_0x1a6ce8['privateKeyPath']+',\x20'+_0x1a6ce8[_0x4f64fd(0x11a)]);const _0x429a8e={..._0x419b9d,'first_name':_0x419b9d[_0x4f64fd(0x122)]?.[_0x4f64fd(0xa4)](/[\t\n\r\f\v]/g,'\x20')[_0x4f64fd(0x1ce)]()||'','last_name':_0x419b9d[_0x4f64fd(0x148)]?.[_0x4f64fd(0xa4)](/[\t\n\r\f\v]/g,'\x20')[_0x4f64fd(0x1ce)]()||''};console[_0x4f64fd(0x15d)](_0x4f64fd(0x137)),console['log'](_0x4f64fd(0x1b6)+_0x419b9d[_0x4f64fd(0x122)]+'\x22\x20|\x20\x22'+_0x419b9d[_0x4f64fd(0x148)]+'\x22'),console[_0x4f64fd(0x15d)](_0x4f64fd(0xda)+_0x429a8e[_0x4f64fd(0x122)]+_0x4f64fd(0x18e)+_0x429a8e[_0x4f64fd(0x148)]+'\x22');const _0x32e78b={'amount':_0x48b5b0,'currency':_0x1dbfc4[_0x4f64fd(0x14a)](),'order_id':_0x51496d,'result_url':_0x2618d8,'return_url':_0x40ba34,'country':'','card':{'number':_0x241fee[_0x4f64fd(0x1d5)],'expire_month':_0x241fee['expire_month'],'expire_year':_0x241fee['expire_year'],'cvv':_0x241fee[_0x4f64fd(0x189)]},'card_holder':_0x429a8e,'browser':_0x59c279},_0x306fe5=JSON[_0x4f64fd(0x1ca)](_0x32e78b);console['log']('💾\x20Payment\x20data\x20prepared'),console[_0x4f64fd(0x15d)](_0x4f64fd(0x8e)),console[_0x4f64fd(0x15d)](_0x306fe5),console['log']('📝\x20Data\x20length:',_0x306fe5[_0x4f64fd(0x11f)]);try{const {key:_0x5bd75e,iv:_0x306159}=this[_0x4f64fd(0x1da)]();console[_0x4f64fd(0x15d)](_0x4f64fd(0xc2)),console[_0x4f64fd(0x15d)]('🔐\x20AES\x20key\x20length:',_0x5bd75e[_0x4f64fd(0x11f)]),console[_0x4f64fd(0x15d)]('🔐\x20AES\x20IV\x20length:',_0x306159[_0x4f64fd(0x11f)]);const _0x4eb8cb=this[_0x4f64fd(0x199)](_0x306fe5,_0x5bd75e,_0x306159);console[_0x4f64fd(0x15d)](_0x4f64fd(0xce)),console['log'](_0x4f64fd(0x1db),_0x4eb8cb[_0x4f64fd(0x11f)]);const _0x1232bd=this[_0x4f64fd(0xd2)](_0x5bd75e,_0x306159,_0x1a6ce8['publicKeyPath']);console[_0x4f64fd(0x15d)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x4f64fd(0x15d)](_0x4f64fd(0x19d),_0x1232bd['length']);const _0x115eb6=this[_0x4f64fd(0xc9)](_0x306fe5,_0x1a6ce8[_0x4f64fd(0x130)]);console[_0x4f64fd(0x15d)](_0x4f64fd(0x181)),console[_0x4f64fd(0x15d)](_0x4f64fd(0x111),_0x115eb6[_0x4f64fd(0x11f)]);const _0x3562e1={'merchant_point_id':_0x1a6ce8['merchantPointId'],'method':'charge','info':_0x4eb8cb,'key':_0x1232bd,'sign':_0x115eb6,'lang':'en'};console['log'](_0x4f64fd(0x1c0)),console['log'](_0x4f64fd(0x1a1)),console[_0x4f64fd(0x15d)]('\x20\x20\x20-\x20merchant_point_id:',_0x1a6ce8[_0x4f64fd(0x17b)]),console[_0x4f64fd(0x15d)](_0x4f64fd(0x90)),console[_0x4f64fd(0x15d)](_0x4f64fd(0x12b),_0x4eb8cb[_0x4f64fd(0x11f)]),console[_0x4f64fd(0x15d)](_0x4f64fd(0xd1),_0x1232bd[_0x4f64fd(0x11f)]),console[_0x4f64fd(0x15d)](_0x4f64fd(0x10d),_0x115eb6[_0x4f64fd(0x11f)]),console[_0x4f64fd(0x15d)](_0x4f64fd(0xf8)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x1a6ce8[_0x4f64fd(0x186)][_0x4f64fd(0xaf)](),'/charge',_0x4f64fd(0x100),{'merchant_point_id':_0x1a6ce8[_0x4f64fd(0x17b)],'method':_0x4f64fd(0x11e),'lang':'en'});const _0x22fe1e=Date[_0x4f64fd(0x16b)](),_0x323c76=await fetch(_0x1a6ce8[_0x4f64fd(0x195)],{'method':_0x4f64fd(0x100),'headers':{'Content-Type':_0x4f64fd(0x152),'Accept':_0x4f64fd(0x152),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x4f64fd(0x1ca)](_0x3562e1)}),_0x184135=Date['now']()-_0x22fe1e;console[_0x4f64fd(0x15d)]('===\x20API\x20RESPONSE\x20==='),console[_0x4f64fd(0x15d)](_0x4f64fd(0x1d3),_0x323c76['status']),console[_0x4f64fd(0x15d)](_0x4f64fd(0xc5),_0x184135+'ms');if(!_0x323c76['ok']){const _0x3e312d=await _0x323c76[_0x4f64fd(0xca)]();console[_0x4f64fd(0x13c)](_0x4f64fd(0x19e),_0x323c76[_0x4f64fd(0x16a)]),console['error'](_0x4f64fd(0xa1),_0x3e312d),loggerService_1[_0x4f64fd(0x16d)][_0x4f64fd(0xd9)](_0x1a6ce8[_0x4f64fd(0x186)][_0x4f64fd(0xaf)](),'/charge_raw',_0x323c76['status'],_0x3e312d,_0x184135),loggerService_1['loggerService'][_0x4f64fd(0x13b)](_0x1a6ce8['cardType'][_0x4f64fd(0xaf)](),'/charge',_0x4f64fd(0x91)+_0x323c76[_0x4f64fd(0x16a)]+':\x20'+_0x3e312d);throw new Error(_0x4f64fd(0x142)+_0x323c76[_0x4f64fd(0x16a)]+_0x4f64fd(0x133)+_0x3e312d);}const _0x3a6845=await _0x323c76['json']();loggerService_1[_0x4f64fd(0x16d)][_0x4f64fd(0xd9)](_0x1a6ce8[_0x4f64fd(0x186)][_0x4f64fd(0xaf)](),_0x4f64fd(0x113),_0x323c76[_0x4f64fd(0x16a)],_0x3a6845,_0x184135),console[_0x4f64fd(0x15d)]('===\x20PARSED\x20API\x20RESPONSE\x20===');let _0x40e1c9=_0x3a6845;if(_0x3a6845[_0x4f64fd(0x1d6)]&&_0x3a6845['key']&&_0x3a6845['sign']){console['log']('🔐\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x14bffe=await this['decryptResponsePhp'](_0x3a6845[_0x4f64fd(0x1d6)],_0x3a6845[_0x4f64fd(0x121)],_0x1a6ce8[_0x4f64fd(0x186)]);_0x40e1c9=JSON['parse'](_0x14bffe),console[_0x4f64fd(0x15d)](_0x4f64fd(0xb7)),loggerService_1[_0x4f64fd(0x16d)]['logWhiteDomainResponse'](_0x1a6ce8[_0x4f64fd(0x186)][_0x4f64fd(0xaf)](),_0x4f64fd(0x1d8),_0x323c76[_0x4f64fd(0x16a)],_0x40e1c9,_0x184135),console['log']('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x10e36c){console[_0x4f64fd(0x13c)](_0x4f64fd(0x1c9),_0x10e36c),loggerService_1[_0x4f64fd(0x16d)][_0x4f64fd(0x13b)](_0x1a6ce8[_0x4f64fd(0x186)][_0x4f64fd(0xaf)](),_0x4f64fd(0x1a3),_0x4f64fd(0x18a)+_0x10e36c),_0x40e1c9=_0x3a6845;}}else loggerService_1[_0x4f64fd(0x16d)][_0x4f64fd(0xd9)](_0x1a6ce8[_0x4f64fd(0x186)]['toLowerCase'](),_0x4f64fd(0x1d8),_0x323c76['status'],_0x40e1c9,_0x184135),console[_0x4f64fd(0x15d)](_0x4f64fd(0x144));console[_0x4f64fd(0x15d)](_0x4f64fd(0x1d3),_0x40e1c9[_0x4f64fd(0x16a)]),console[_0x4f64fd(0x15d)](_0x4f64fd(0x1c7),_0x40e1c9[_0x4f64fd(0x177)]),console[_0x4f64fd(0x15d)](_0x4f64fd(0x1a8),_0x40e1c9[_0x4f64fd(0x1bd)]),console['log']('3DS\x20URL:',_0x40e1c9[_0x4f64fd(0xb4)]||_0x4f64fd(0xea));if(_0x40e1c9[_0x4f64fd(0x16a)]===0x64&&_0x40e1c9[_0x4f64fd(0x177)]===0x1)return console[_0x4f64fd(0x15d)](_0x4f64fd(0x14b)),{'gateway_payment_id':_0x40e1c9['payment_id']?.[_0x4f64fd(0xbe)](),'payment_url':_0x40ba34,'requires_3ds':![],'status':_0x4f64fd(0xa8),'final':!![]};if(_0x40e1c9['3ds_url'])return console['log']('🔐\x203DS\x20verification\x20required'),this[_0x4f64fd(0xe1)](_0xed98dc,_0x51496d,_0x40e1c9[_0x4f64fd(0x1bd)]?.[_0x4f64fd(0xbe)]()||_0x51496d,_0x1a6ce8['cardType']),{'gateway_payment_id':_0x40e1c9['payment_id']?.[_0x4f64fd(0xbe)](),'payment_url':_0x40e1c9[_0x4f64fd(0xb4)],'requires_3ds':!![],'threeds_url':_0x40e1c9[_0x4f64fd(0xb4)],'status':_0x4f64fd(0x159),'final':![]};let _0x3e3027=this[_0x4f64fd(0xde)](_0x40e1c9['status'],_0x40e1c9[_0x4f64fd(0x155)]||_0x40e1c9[_0x4f64fd(0x1c2)]),_0x2a690b=_0x40e1c9[_0x4f64fd(0x16a)],_0x5bc758=this[_0x4f64fd(0x1bb)](_0x40e1c9[_0x4f64fd(0x16a)]);return console[_0x4f64fd(0x15d)](_0x4f64fd(0xdf)+_0x2a690b+_0x4f64fd(0x135)+_0x5bc758+_0x4f64fd(0xd5)+_0x3e3027),{'gateway_payment_id':_0x40e1c9['payment_id']?.[_0x4f64fd(0xbe)](),'payment_url':_0x40ba34,'requires_3ds':![],'status':_0x4f64fd(0x104),'final':!![],'errorMessage':_0x3e3027};}catch(_0x4c93f5){console[_0x4f64fd(0x13c)](_0x4f64fd(0x178)),console[_0x4f64fd(0x13c)](_0x4f64fd(0x1c3),_0x4c93f5),loggerService_1[_0x4f64fd(0x16d)][_0x4f64fd(0x13b)](_0x4f64fd(0xf2),_0x4f64fd(0xa9),_0x4c93f5);throw new Error(_0x4f64fd(0x94)+(_0x4c93f5 instanceof Error?_0x4c93f5['message']:_0x4f64fd(0x1d1)));}}async[a51_0x40b7f2(0x1cc)](_0x39869b,_0x5b87f1,_0x2a9d42=a51_0x40b7f2(0x18d)){const _0x541624=a51_0x40b7f2;console['log']('📊\x20Checking\x20'+_0x2a9d42+'\x20payment\x20status:\x20'+_0x39869b+'\x20('+_0x5b87f1+')');try{const _0x644f67={'payment_id':_0x39869b,'order_id':_0x5b87f1},_0x1eee84=JSON[_0x541624(0x1ca)](_0x644f67),_0x3c84a5=this[_0x541624(0xd8)](_0x2a9d42===_0x541624(0x18d)?_0x541624(0xdc):'5000000000000000'),{key:_0x2f652a,iv:_0x280abc}=this[_0x541624(0x1da)](),_0x5bb609=this[_0x541624(0x199)](_0x1eee84,_0x2f652a,_0x280abc),_0x1e7ad1=this['encryptRSA'](_0x2f652a,_0x280abc,_0x3c84a5['publicKeyPath']),_0x50b42c=this[_0x541624(0xc9)](_0x1eee84,_0x3c84a5['privateKeyPath']),_0x1e4b03={'merchant_point_id':_0x3c84a5[_0x541624(0x17b)],'method':'status','info':_0x5bb609,'key':_0x1e7ad1,'sign':_0x50b42c,'lang':'en'};loggerService_1[_0x541624(0x16d)][_0x541624(0x125)](_0x2a9d42[_0x541624(0xaf)](),_0x541624(0xef),_0x541624(0x100),{'merchant_point_id':_0x3c84a5[_0x541624(0x17b)],'method':'status','lang':'en'});const _0x5b9dd1=Date['now'](),_0x1c4eab=await fetch(_0x3c84a5[_0x541624(0x195)],{'method':'POST','headers':{'Content-Type':_0x541624(0x152),'Accept':_0x541624(0x152),'User-Agent':_0x541624(0x1ae)},'body':JSON['stringify'](_0x1e4b03)}),_0x9c7230=Date[_0x541624(0x16b)]()-_0x5b9dd1;if(!_0x1c4eab['ok']){const _0x3414fe=await _0x1c4eab[_0x541624(0xca)]();loggerService_1[_0x541624(0x16d)][_0x541624(0xd9)](_0x2a9d42['toLowerCase'](),_0x541624(0x188),_0x1c4eab[_0x541624(0x16a)],_0x3414fe,_0x9c7230);throw new Error(_0x541624(0x142)+_0x1c4eab[_0x541624(0x16a)]);}const _0xee94c7=await _0x1c4eab['json']();loggerService_1[_0x541624(0x16d)][_0x541624(0xd9)](_0x2a9d42[_0x541624(0xaf)](),_0x541624(0x188),_0x1c4eab[_0x541624(0x16a)],_0xee94c7,_0x9c7230);let _0x1fa9fd=_0xee94c7;if(_0xee94c7[_0x541624(0x1d6)]&&_0xee94c7[_0x541624(0x121)]&&_0xee94c7[_0x541624(0x151)]){console[_0x541624(0x15d)](_0x541624(0x1b1));try{const _0x18b862=await this[_0x541624(0xae)](_0xee94c7[_0x541624(0x1d6)],_0xee94c7[_0x541624(0x121)],_0x2a9d42);_0x1fa9fd=JSON[_0x541624(0x138)](_0x18b862),console[_0x541624(0x15d)]('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1['loggerService'][_0x541624(0xd9)](_0x2a9d42[_0x541624(0xaf)](),_0x541624(0x1de),_0x1c4eab[_0x541624(0x16a)],_0x1fa9fd,_0x9c7230),console[_0x541624(0x15d)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x106486){console[_0x541624(0x13c)](_0x541624(0xdd),_0x106486),loggerService_1[_0x541624(0x16d)][_0x541624(0x13b)](_0x2a9d42[_0x541624(0xaf)](),'/status_decrypt',_0x541624(0x123)+_0x106486),_0x1fa9fd=_0xee94c7;}}else loggerService_1['loggerService'][_0x541624(0xd9)](_0x2a9d42[_0x541624(0xaf)](),_0x541624(0x1de),_0x1c4eab[_0x541624(0x16a)],_0x1fa9fd,_0x9c7230),console[_0x541624(0x15d)]('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x541624(0x15d)](_0x541624(0xb0),{'status':_0x1fa9fd['status'],'final':_0x1fa9fd[_0x541624(0x177)],'payment_id':_0x1fa9fd[_0x541624(0x1bd)],'desc':_0x1fa9fd[_0x541624(0x155)]});let _0x45bb77=_0x541624(0x159);if(_0x1fa9fd[_0x541624(0x16a)]===0x64&&_0x1fa9fd[_0x541624(0x177)]===0x1)_0x45bb77=_0x541624(0xa8);else{if(_0x1fa9fd['final']===0x0||!this[_0x541624(0x1bb)](_0x1fa9fd['status']))_0x45bb77=_0x541624(0x159);else _0x1fa9fd[_0x541624(0x177)]===0x1||this[_0x541624(0x1bb)](_0x1fa9fd[_0x541624(0x16a)])?_0x45bb77=_0x541624(0x104):_0x45bb77=_0x541624(0x159);}const _0xe0115=this[_0x541624(0xde)](_0x1fa9fd[_0x541624(0x16a)],_0x1fa9fd['desc']);return{'status':_0x45bb77,'final':this['isFinalStatus'](_0x1fa9fd['status']),'amount':_0x1fa9fd[_0x541624(0xfe)],'currency':_0x1fa9fd[_0x541624(0x97)],'date_success':_0x1fa9fd[_0x541624(0x119)],'description':_0xe0115};}catch(_0xdb945){console['error'](_0x2a9d42+'\x20status\x20check\x20error:',_0xdb945),loggerService_1[_0x541624(0x16d)]['logWhiteDomainError'](_0x2a9d42[_0x541624(0xaf)](),_0x541624(0xef),_0xdb945);throw new Error(_0x541624(0x170)+_0x2a9d42+_0x541624(0x115)+(_0xdb945 instanceof Error?_0xdb945[_0x541624(0x1c2)]:_0x541624(0x1d1)));}}['scheduleStatusChecks'](_0x22a018,_0x2d2fe2,_0x560b41,_0x4ec876){const _0x57e75e=a51_0x40b7f2;console[_0x57e75e(0x15d)](_0x57e75e(0xf4)+_0x4ec876+_0x57e75e(0x17c)+_0x22a018+'\x20('+_0x560b41+')'),this[_0x57e75e(0x179)](_0x22a018);const _0x214694=[],_0x4ff29b=0x5*0x3c*0x3e8,_0x233993=0x2*0x3c*0x3c*0x3e8,_0x36b4d7=Math[_0x57e75e(0xc3)](_0x233993/_0x4ff29b);console['log'](_0x57e75e(0xe9)+_0x36b4d7+_0x57e75e(0xdb));for(let _0x2b1d1c=0x1;_0x2b1d1c<=_0x36b4d7;_0x2b1d1c++){const _0x5f2319=setTimeout(async()=>{const _0x58aee6=_0x57e75e;console['log'](_0x58aee6(0x166)+_0x4ec876+_0x58aee6(0x1cd)+_0x2b1d1c+'/'+_0x36b4d7+'\x20for\x20payment\x20'+_0x22a018);try{const _0x17dd41=await this[_0x58aee6(0x1cc)](_0x560b41,_0x2d2fe2,_0x4ec876);console['log'](_0x58aee6(0xe4)+_0x2b1d1c+_0x58aee6(0x18c),_0x17dd41),_0x17dd41[_0x58aee6(0x177)]&&(console[_0x58aee6(0x15d)](_0x58aee6(0x15b)+_0x22a018+_0x58aee6(0x198)+_0x17dd41['status']+_0x58aee6(0xfa)),this[_0x58aee6(0x179)](_0x22a018),await this[_0x58aee6(0x19b)](_0x22a018,_0x17dd41[_0x58aee6(0x16a)],_0x17dd41));}catch(_0x39cbef){console[_0x58aee6(0x13c)](_0x58aee6(0x185)+_0x2b1d1c+_0x58aee6(0x12a)+_0x22a018+':',_0x39cbef);}},_0x2b1d1c*_0x4ff29b);_0x214694[_0x57e75e(0xe6)](_0x5f2319);}this[_0x57e75e(0x1d0)]['set'](_0x22a018,_0x214694),console[_0x57e75e(0x15d)](_0x57e75e(0x114)+_0x36b4d7+'\x20status\x20checks\x20for\x20payment\x20'+_0x22a018);}[a51_0x40b7f2(0x179)](_0x5cbbbf){const _0x4342ea=a51_0x40b7f2,_0x7d910e=this['statusCheckTimers'][_0x4342ea(0xa0)](_0x5cbbbf);_0x7d910e&&(console['log'](_0x4342ea(0x12c)+_0x7d910e[_0x4342ea(0x11f)]+_0x4342ea(0xd0)+_0x5cbbbf),_0x7d910e['forEach']((_0x5bec9a,_0xcc487d)=>{clearTimeout(_0x5bec9a);}),this[_0x4342ea(0x1d0)][_0x4342ea(0x182)](_0x5cbbbf));}async[a51_0x40b7f2(0x19b)](_0x3ad2a3,_0x5aa022,_0x56def4){const _0x399785=a51_0x40b7f2;try{const _0x4fd24d=(await Promise['resolve']()[_0x399785(0x190)](()=>__importStar(require(_0x399785(0x110)))))['default'],_0x43959c={'status':_0x5aa022[_0x399785(0x14a)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x5aa022===_0x399785(0xa8)&&(_0x43959c[_0x399785(0xa7)]=new Date()),_0x5aa022===_0x399785(0x104)&&_0x56def4['description']&&(_0x43959c[_0x399785(0x180)]=_0x56def4['description'],console[_0x399785(0x15d)](_0x399785(0x143)+_0x56def4['description'])),await _0x4fd24d[_0x399785(0x160)][_0x399785(0x10a)]({'where':{'id':_0x3ad2a3},'data':_0x43959c}),console[_0x399785(0x15d)](_0x399785(0x15b)+_0x3ad2a3+_0x399785(0xf6)+_0x5aa022),await this[_0x399785(0xe0)](_0x3ad2a3,_0x5aa022);}catch(_0x4d6518){console[_0x399785(0x13c)](_0x399785(0x1a9)+_0x3ad2a3+':',_0x4d6518);}}async['sendPaymentNotifications'](_0x581e13,_0x3631fc){const _0x1ebae8=a51_0x40b7f2;try{const _0xd390ae=(await Promise[_0x1ebae8(0x14c)]()[_0x1ebae8(0x190)](()=>__importStar(require(_0x1ebae8(0x110)))))[_0x1ebae8(0x98)],{telegramBotService:_0x15738a}=await Promise[_0x1ebae8(0x14c)]()['then'](()=>__importStar(require(_0x1ebae8(0x1c8)))),_0x5393f1=await _0xd390ae[_0x1ebae8(0x160)][_0x1ebae8(0x15c)]({'where':{'id':_0x581e13},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x5393f1)return;const _0x18239f={'PAID':_0x1ebae8(0x1b2),'FAILED':_0x1ebae8(0xee)},_0x42ca6b=_0x18239f[_0x3631fc];_0x42ca6b&&await _0x15738a['sendPaymentNotification'](_0x5393f1[_0x1ebae8(0xf0)],_0x5393f1,_0x42ca6b),await this['sendShopWebhook'](_0x5393f1,_0x3631fc);}catch(_0x13e60e){console['error']('Failed\x20to\x20send\x20payment\x20notifications:',_0x13e60e);}}async[a51_0x40b7f2(0x1dd)](_0x1dd00e,_0x37be1e){const _0x477a41=a51_0x40b7f2,_0x12be38=Date['now']();try{const _0x48bec9=_0x1dd00e[_0x477a41(0x10e)],_0x448492=_0x48bec9[_0x477a41(0xfc)];if(!_0x448492?.[_0x477a41(0xff)]){console[_0x477a41(0x15d)](_0x477a41(0x8f)+_0x48bec9['id']);return;}const _0x46cf3f=_0x37be1e==='PAID'?_0x477a41(0xcf):_0x477a41(0x1ab);let _0xdc3854=[];if(_0x448492[_0x477a41(0xe7)])try{_0xdc3854=Array['isArray'](_0x448492[_0x477a41(0xe7)])?_0x448492[_0x477a41(0xe7)]:JSON[_0x477a41(0x138)](_0x448492[_0x477a41(0xe7)]);}catch(_0x2b5698){console[_0x477a41(0x13c)](_0x477a41(0x146),_0x2b5698),_0xdc3854=[];}if(!_0xdc3854[_0x477a41(0x12f)](_0x46cf3f)){console['log']('Webhook\x20event\x20'+_0x46cf3f+_0x477a41(0x9a)+_0x48bec9['id']);return;}const _0x2b6072={'event':_0x46cf3f,'payment':{'id':_0x1dd00e['id'],'order_id':_0x1dd00e[_0x477a41(0x1b3)],'gateway_order_id':_0x1dd00e[_0x477a41(0x9b)],'gateway':_0x477a41(0x129),'amount':_0x1dd00e[_0x477a41(0xfe)],'currency':_0x1dd00e['currency'],'status':_0x37be1e[_0x477a41(0xaf)](),'customer_email':_0x1dd00e[_0x477a41(0x1af)],'customer_name':_0x1dd00e['customerName'],'created_at':_0x1dd00e[_0x477a41(0x1ac)],'updated_at':new Date()}},_0x2fe3c2=await fetch(_0x448492['webhookUrl'],{'method':_0x477a41(0x100),'headers':{'Content-Type':_0x477a41(0x152),'User-Agent':_0x477a41(0x165)},'body':JSON[_0x477a41(0x1ca)](_0x2b6072)}),_0x3da6d5=Date[_0x477a41(0x16b)]()-_0x12be38;loggerService_1['loggerService']['logShopWebhookSent'](_0x1dd00e[_0x477a41(0xf0)],_0x448492[_0x477a41(0xff)],_0x46cf3f,_0x2fe3c2[_0x477a41(0x16a)],_0x3da6d5,_0x2b6072),console[_0x477a41(0x15d)](_0x477a41(0xeb)+_0x448492['webhookUrl']+_0x477a41(0x16c)+_0x2fe3c2['status']+'\x20('+_0x3da6d5+_0x477a41(0x162));}catch(_0x202b27){console[_0x477a41(0x13c)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x202b27),loggerService_1[_0x477a41(0x16d)][_0x477a41(0x197)](_0x1dd00e[_0x477a41(0xf0)],_0x1dd00e[_0x477a41(0x10e)]?.[_0x477a41(0xfc)]?.['webhookUrl']||'unknown',_0x477a41(0xd4),_0x202b27,{});}}[a51_0x40b7f2(0x145)](_0x146186){const _0x32d628=a51_0x40b7f2,_0x329c49=_0x146186[_0x32d628(0xa4)](/[\s-]/g,'');if(_0x329c49[_0x32d628(0x11f)]<0x4)return _0x32d628(0x14d);return'****\x20****\x20****\x20'+_0x329c49['slice'](-0x4);}async['processWebhook'](_0x3fe744,_0x1d29bd='MASTERCARD'){const _0x39336a=a51_0x40b7f2;console[_0x39336a(0x15d)](_0x39336a(0x147),JSON[_0x39336a(0x1ca)](_0x3fe744,null,0x2));let _0x33b46a=_0x3fe744,_0xab3d36=_0x1d29bd;_0x3fe744['card_type']?(_0xab3d36=_0x3fe744[_0x39336a(0x12e)][_0x39336a(0x14a)]()===_0x39336a(0x18d)?_0x39336a(0x18d):_0x39336a(0x112),console[_0x39336a(0x15d)]('🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20'+_0xab3d36)):console[_0x39336a(0x15d)](_0x39336a(0x116)+_0xab3d36);if(_0x3fe744[_0x39336a(0x1d6)]&&_0x3fe744[_0x39336a(0x121)]&&_0x3fe744[_0x39336a(0x151)]){console[_0x39336a(0x15d)](_0x39336a(0x1df));try{const _0x5153cd=await this['decryptResponsePhp'](_0x3fe744[_0x39336a(0x1d6)],_0x3fe744[_0x39336a(0x121)],_0xab3d36);_0x33b46a=JSON[_0x39336a(0x138)](_0x5153cd),console[_0x39336a(0x15d)](_0x39336a(0x15e)),console[_0x39336a(0x15d)]('📝\x20Decrypted\x20webhook\x20data:',JSON[_0x39336a(0x1ca)](_0x33b46a,null,0x2));}catch(_0x43f32){console['error'](_0x39336a(0x196),_0x43f32),console[_0x39336a(0x15d)](_0x39336a(0xb3)),_0x33b46a=_0x3fe744;}}else console[_0x39336a(0x15d)]('📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0xa8d4ab=_0x39336a(0x159);if(_0x33b46a['status']===0x64&&_0x33b46a['final']===0x1)_0xa8d4ab=_0x39336a(0xa8);else{if(_0x33b46a[_0x39336a(0x177)]===0x0||!this['isFinalStatus'](_0x33b46a[_0x39336a(0x16a)]))_0xa8d4ab=_0x39336a(0x159);else _0x33b46a[_0x39336a(0x177)]===0x1||this[_0x39336a(0x1bb)](_0x33b46a[_0x39336a(0x16a)])?_0xa8d4ab='FAILED':_0xa8d4ab=_0x39336a(0x159);}let _0x2fab68='';if(_0x33b46a[_0x39336a(0x1a6)])_0x2fab68=_0x33b46a[_0x39336a(0x1a6)][_0x39336a(0xbe)](),console[_0x39336a(0x15d)](_0x39336a(0xcc)+_0xab3d36+_0x39336a(0x167)+_0x2fab68);else _0x33b46a[_0x39336a(0x1bd)]?(_0x2fab68=_0x33b46a[_0x39336a(0x1bd)]['toString'](),console[_0x39336a(0x15d)](_0x39336a(0xcc)+_0xab3d36+_0x39336a(0x1b7)+_0x2fab68)):(_0x2fab68=_0x33b46a['orderId']||_0x33b46a['paymentId']||_0x33b46a['id']||'',console['log'](_0x39336a(0xbc)+_0x2fab68));console[_0x39336a(0x15d)]('📊\x20'+_0xab3d36+_0x39336a(0x158)),console['log'](_0x39336a(0xed)+_0x2fab68+'\x20(from:\x20order_id='+_0x33b46a[_0x39336a(0x1a6)]+_0x39336a(0xcb)+_0x33b46a['orderId']+_0x39336a(0x168)+_0x33b46a[_0x39336a(0x1bd)]+_0x39336a(0xa3)+_0x33b46a['paymentId']+',\x20id='+_0x33b46a['id']+')'),console[_0x39336a(0x15d)](_0x39336a(0x163)+_0xa8d4ab+_0x39336a(0x1a5)+_0x33b46a['status']+',\x20final='+_0x33b46a[_0x39336a(0x177)]+')'),console[_0x39336a(0x15d)]('\x20\x20\x20Amount:\x20'+_0x33b46a[_0x39336a(0xfe)]),console[_0x39336a(0x15d)](_0x39336a(0x153)+_0x33b46a[_0x39336a(0x97)]);let _0x236b96;_0xa8d4ab===_0x39336a(0x104)&&(_0x236b96=this[_0x39336a(0xde)](_0x33b46a['status'],_0x33b46a[_0x39336a(0x155)]),console[_0x39336a(0x15d)](_0x39336a(0xad)+_0x236b96));const _0x6d9e01={'paymentId':_0x2fab68,'status':_0xa8d4ab,'amount':_0x33b46a['amount'],'currency':_0x33b46a[_0x39336a(0x97)]};return _0x236b96&&(_0x6d9e01[_0x39336a(0x164)]=_0x236b96),_0x6d9e01;}[a51_0x40b7f2(0x131)](){const _0xe58e74=a51_0x40b7f2;console[_0xe58e74(0x15d)]('🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...');const _0xd356b5=this[_0xe58e74(0x1d0)][_0xe58e74(0xe8)];for(const [_0x28baa5]of this[_0xe58e74(0x1d0)]){this[_0xe58e74(0x179)](_0x28baa5);}console[_0xe58e74(0x15d)](_0xe58e74(0x18f)+_0xd356b5+_0xe58e74(0x176));}}exports[a51_0x40b7f2(0x15f)]=VisaMasterCardService;