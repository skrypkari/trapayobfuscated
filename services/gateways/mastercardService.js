'use strict';const a42_0x273783=a42_0x5bc8;(function(_0x10210d,_0x22d54b){const _0x28dc8b=a42_0x5bc8,_0x45a96a=_0x10210d();while(!![]){try{const _0x281f86=parseInt(_0x28dc8b(0x249))/0x1+parseInt(_0x28dc8b(0x16d))/0x2*(parseInt(_0x28dc8b(0x1a1))/0x3)+-parseInt(_0x28dc8b(0x177))/0x4*(-parseInt(_0x28dc8b(0x201))/0x5)+parseInt(_0x28dc8b(0x1a5))/0x6+parseInt(_0x28dc8b(0x171))/0x7*(-parseInt(_0x28dc8b(0x1f5))/0x8)+-parseInt(_0x28dc8b(0x1e6))/0x9*(parseInt(_0x28dc8b(0x248))/0xa)+-parseInt(_0x28dc8b(0x1f1))/0xb;if(_0x281f86===_0x22d54b)break;else _0x45a96a['push'](_0x45a96a['shift']());}catch(_0x64fe23){_0x45a96a['push'](_0x45a96a['shift']());}}}(a42_0x1581,0xbe716));function a42_0x1581(){const _0x284f6d=['../loggerService','shop','number','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','3ds_url','/charge_raw','randomBytes','log','Decryption\x20failed:\x20','\x20status\x20checks\x20for\x20payment\x20','size','21654kiQpKV','updatePaymentStatus','HTTP\x20error!\x20status:\x20','TesSoft\x20Payment\x20System/1.0','toLowerCase','🔐\x203DS\x20verification\x20required','now','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','logShopWebhookSent','\x20for\x20payment\x20','findUnique','11217514BxPznQ','Status\x20decryption\x20failed:\x20','existsSync','order_id','6512OIiOWf','\x20MasterCard\x20status\x20check\x20timers','logWhiteDomainResponse','\x20result:','clearStatusTimers','Order\x20ID:','📝\x20Encrypted\x20data\x20length:','🔐\x20Private\x20key\x20path:',',\x20Final:\x20','📝\x20Encrypted\x20key\x20length:','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','❌\x20Status\x20check\x20#','4405865BcuEHg','unknown','info','payment.success','replace','Processing\x20MasterCard\x20webhook:','final','json','getOwnPropertyDescriptor','/charge_decrypted','✅\x20Payment\x20successful','maskCardNumber','expire_month','floor','generateAESKey','createSign','defineProperty','encryptRSA','ms)','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','slice','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','logWhiteDomainError','🔐\x20Private\x20key\x20length:\x20','MasterCard\x20status\x20check\x20error:','crypto','error','-----END','customerName','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','none','text','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','⏰\x20Will\x20check\x20status\x20','****\x20****\x20****\x20','__createBinding','/status_raw','readFileSync','SHA256','forEach','📝\x20Final\x20request\x20structure:','payment','__esModule','then','\x20\x20\x20-\x20info\x20length:','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','📝\x20Data\x20length:','toString','settings','failed','Final:','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','get','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','last_name','💾\x20Payment\x20data\x20prepared','trim','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','decryptAES','amount',',\x20Desc:\x20','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','sign','loggerService','📝\x20Signature\x20length:','path','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','writable','decryptResponse','status','private.pem','570dlPswV','118446tGfRKm','🔐\x20Public\x20key\x20path:','statusCheckTimers','publicKeyPath','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','Payment\x20ID:','❌\x20MasterCard\x20key\x20validation\x20failed:','payment_id','shopId','🔐\x20AES\x20key\x20and\x20IV\x20generated','✅\x20Payment\x20','🧹\x20Clearing\x20','🔐\x20Data\x20signed\x20with\x20RSA','adminNotes','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','payment.failed','Public\x20key\x20file\x20not\x20found:\x20','call','/status','Error\x20details:','merchantPointId','publicEncrypt','Unknown\x20error','📝\x20Data\x20to\x20sign\x20length:','\x20\x20\x20-\x20merchant_point_id:','839514jXIIXF','apiUrl','utf8','mastercard','5922RzCBmQ','\x20status\x20updated\x20to\x20','\x20\x20\x20-\x20key\x20length:','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','getOwnPropertyNames','encryptAES','4hNfThF','stringify','\x20\x20\x20-\x20sign\x20length:','length','aes-256-ctr','description','Return\x20URL:','signRSA','✅\x20Scheduled\x20','application/json','privateKeyPath','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','key','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','FAILED','resolve','__importStar','\x20\x20\x20-\x20method:\x20charge','webhook_send','Response\x20Body:','__setModuleDefault','PAID','\x20failed\x20for\x20payment\x20','processWebhook','psp_public.pem','MasterCard:\x20','scheduleStatusChecks','includes','paidAt','../../config/database','createDecipheriv','customerEmail','default','keys','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','gatewayOrderId','substring','cwd','🔐\x20AES\x20IV\x20length:','privateDecrypt','delete','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','6XqzxwZ','❌\x20RSA\x20encryption\x20failed:','RSA_PKCS1_PADDING','message','4718886iKuoRt','PENDING','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','constants','toUpperCase','💳\x20MasterCard\x20service\x20initialized','join','\x20\x20\x20-\x20lang:\x20en','webhookEvents','decryptResponsePhp','base64','Error\x20parsing\x20webhook\x20events:','https://api.paydmeth.com/api','📊\x20Status\x20check\x20#','MasterCardService','push','-----BEGIN','3DS\x20URL:','first_name','🔐\x20Public\x20key\x20length:\x20','isArray','sendPaymentNotifications','❌\x20PHP\x20decryptor\x20request\x20failed:','webhookUrl','HTTP\x20Status:','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','✅\x20Status\x20response\x20decrypted\x20successfully','checkPaymentStatus','sendShopWebhook','🔐\x20Data\x20encrypted\x20with\x20AES','Amount:','create','system','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','orderId','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','currency','\x20not\x20enabled\x20for\x20shop\x20','POST','update','Response\x20Time:','\x20status\x20timers\x20for\x20payment\x20','desc','charge','set','configurable','Result\x20URL:','validateKeyFiles','Status:','from','Webhook\x20event\x20','parse','/status_decrypt'];a42_0x1581=function(){return _0x284f6d;};return a42_0x1581();}function a42_0x5bc8(_0x3c0db3,_0x1da5d2){const _0x1581c0=a42_0x1581();return a42_0x5bc8=function(_0x5bc8c9,_0x92a1e8){_0x5bc8c9=_0x5bc8c9-0x155;let _0x40feff=_0x1581c0[_0x5bc8c9];return _0x40feff;},a42_0x5bc8(_0x3c0db3,_0x1da5d2);}var __createBinding=this&&this[a42_0x273783(0x224)]||(Object['create']?function(_0x538029,_0x37f52c,_0x5e26fb,_0x1a53e6){const _0x77282b=a42_0x273783;if(_0x1a53e6===undefined)_0x1a53e6=_0x5e26fb;var _0x533fed=Object[_0x77282b(0x209)](_0x37f52c,_0x5e26fb);(!_0x533fed||(_0x77282b(0x235)in _0x533fed?!_0x37f52c['__esModule']:_0x533fed[_0x77282b(0x244)]||_0x533fed[_0x77282b(0x1d3)]))&&(_0x533fed={'enumerable':!![],'get':function(){return _0x37f52c[_0x5e26fb];}}),Object[_0x77282b(0x211)](_0x538029,_0x1a53e6,_0x533fed);}:function(_0xbc5af9,_0x560eb2,_0x220eb4,_0x90fe94){if(_0x90fe94===undefined)_0x90fe94=_0x220eb4;_0xbc5af9[_0x90fe94]=_0x560eb2[_0x220eb4];}),__setModuleDefault=this&&this[a42_0x273783(0x18b)]||(Object[a42_0x273783(0x1c4)]?function(_0x187fbe,_0x28bd1f){const _0x484c61=a42_0x273783;Object[_0x484c61(0x211)](_0x187fbe,_0x484c61(0x197),{'enumerable':!![],'value':_0x28bd1f});}:function(_0x290cb7,_0x248ee9){_0x290cb7['default']=_0x248ee9;}),__importStar=this&&this[a42_0x273783(0x187)]||(function(){var _0x5ac504=function(_0x3e75b5){const _0x36e54a=a42_0x5bc8;return _0x5ac504=Object[_0x36e54a(0x175)]||function(_0x441cf2){const _0x534d6f=_0x36e54a;var _0x36b972=[];for(var _0x394d44 in _0x441cf2)if(Object['prototype']['hasOwnProperty'][_0x534d6f(0x165)](_0x441cf2,_0x394d44))_0x36b972[_0x36b972[_0x534d6f(0x17a)]]=_0x394d44;return _0x36b972;},_0x5ac504(_0x3e75b5);};return function(_0x281fd6){const _0x36afcb=a42_0x5bc8;if(_0x281fd6&&_0x281fd6['__esModule'])return _0x281fd6;var _0x22e737={};if(_0x281fd6!=null){for(var _0x2be92a=_0x5ac504(_0x281fd6),_0x3099a2=0x0;_0x3099a2<_0x2be92a['length'];_0x3099a2++)if(_0x2be92a[_0x3099a2]!==_0x36afcb(0x197))__createBinding(_0x22e737,_0x281fd6,_0x2be92a[_0x3099a2]);}return __setModuleDefault(_0x22e737,_0x281fd6),_0x22e737;};}()),__importDefault=this&&this['__importDefault']||function(_0x10391a){const _0x13fb61=a42_0x273783;return _0x10391a&&_0x10391a[_0x13fb61(0x22b)]?_0x10391a:{'default':_0x10391a};};Object[a42_0x273783(0x211)](exports,a42_0x273783(0x22b),{'value':!![]}),exports[a42_0x273783(0x1b3)]=void 0x0;const crypto_1=__importDefault(require(a42_0x273783(0x21a))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x273783(0x242))),loggerService_1=require(a42_0x273783(0x1db));class MasterCardService{constructor(){const _0x443228=a42_0x273783;this[_0x443228(0x156)]=new Map(),this[_0x443228(0x16e)]=_0x443228(0x1b1),this[_0x443228(0x168)]=0x67c,this[_0x443228(0x181)]=path_1['default']['join'](process[_0x443228(0x19c)](),_0x443228(0x198),_0x443228(0x247)),this[_0x443228(0x157)]=path_1[_0x443228(0x197)][_0x443228(0x1ab)](process[_0x443228(0x19c)](),_0x443228(0x198),_0x443228(0x18f)),console['log'](_0x443228(0x1aa)),console[_0x443228(0x1e2)](_0x443228(0x1fc),this[_0x443228(0x181)]),console[_0x443228(0x1e2)](_0x443228(0x155),this[_0x443228(0x157)]),this[_0x443228(0x1d5)]();}[a42_0x273783(0x1d5)](){const _0x4cf63d=a42_0x273783;try{if(!fs_1[_0x4cf63d(0x197)][_0x4cf63d(0x1f3)](this[_0x4cf63d(0x181)]))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this[_0x4cf63d(0x181)]);if(!fs_1[_0x4cf63d(0x197)][_0x4cf63d(0x1f3)](this[_0x4cf63d(0x157)]))throw new Error(_0x4cf63d(0x164)+this[_0x4cf63d(0x157)]);const _0x2c2e8e=fs_1[_0x4cf63d(0x197)][_0x4cf63d(0x226)](this['privateKeyPath'],_0x4cf63d(0x16f))[_0x4cf63d(0x239)](),_0x117a62=fs_1[_0x4cf63d(0x197)][_0x4cf63d(0x226)](this['publicKeyPath'],_0x4cf63d(0x16f))[_0x4cf63d(0x239)]();if(!_0x2c2e8e[_0x4cf63d(0x192)](_0x4cf63d(0x1b5))||!_0x2c2e8e[_0x4cf63d(0x192)](_0x4cf63d(0x21c)))throw new Error(_0x4cf63d(0x21e));if(!_0x117a62[_0x4cf63d(0x192)]('-----BEGIN')||!_0x117a62[_0x4cf63d(0x192)](_0x4cf63d(0x21c)))throw new Error(_0x4cf63d(0x214));console[_0x4cf63d(0x1e2)](_0x4cf63d(0x23a)),console[_0x4cf63d(0x1e2)](_0x4cf63d(0x218)+_0x2c2e8e[_0x4cf63d(0x17a)]+'\x20characters'),console[_0x4cf63d(0x1e2)](_0x4cf63d(0x1b8)+_0x117a62[_0x4cf63d(0x17a)]+'\x20characters');}catch(_0x5c707c){console[_0x4cf63d(0x21b)](_0x4cf63d(0x15a),_0x5c707c);throw _0x5c707c;}}[a42_0x273783(0x20f)](){const _0x3f5faa=a42_0x273783,_0x3951de=crypto_1[_0x3f5faa(0x197)][_0x3f5faa(0x1e1)](0x20),_0x3086e8=crypto_1[_0x3f5faa(0x197)][_0x3f5faa(0x1e1)](0x10);return{'key':_0x3951de,'iv':_0x3086e8};}[a42_0x273783(0x176)](_0x549840,_0x9d80f7,_0x7c93d4){const _0x909c5=a42_0x273783,_0x42d5c6=crypto_1['default']['createCipheriv']('aes-256-ctr',_0x9d80f7,_0x7c93d4);let _0x194073=_0x42d5c6[_0x909c5(0x1cd)](_0x549840,'utf8',_0x909c5(0x1af));return _0x194073+=_0x42d5c6[_0x909c5(0x207)](_0x909c5(0x1af)),_0x194073;}['encryptRSA'](_0x14aef9,_0x88c4cd){const _0x51a446=a42_0x273783;try{const _0x106e29=fs_1[_0x51a446(0x197)][_0x51a446(0x226)](this['publicKeyPath'],_0x51a446(0x16f))[_0x51a446(0x239)](),_0x42f505={'iv':_0x88c4cd[_0x51a446(0x230)](_0x51a446(0x1af)),'key':_0x14aef9[_0x51a446(0x230)](_0x51a446(0x1af))},_0x1da132=JSON['stringify'](_0x42f505);console[_0x51a446(0x1e2)](_0x51a446(0x1c7),_0x1da132[_0x51a446(0x17a)]);const _0x2ea218=crypto_1['default'][_0x51a446(0x169)]({'key':_0x106e29,'padding':crypto_1[_0x51a446(0x197)][_0x51a446(0x1a8)][_0x51a446(0x1a3)]},Buffer[_0x51a446(0x1d7)](_0x1da132));return console['log']('✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x2ea218[_0x51a446(0x17a)]),_0x2ea218[_0x51a446(0x230)](_0x51a446(0x1af));}catch(_0x516314){console[_0x51a446(0x21b)](_0x51a446(0x1a2),_0x516314);throw new Error(_0x51a446(0x1be));}}[a42_0x273783(0x17e)](_0x9199bd){const _0xa0956e=a42_0x273783;try{const _0x4a3b22=fs_1[_0xa0956e(0x197)][_0xa0956e(0x226)](this[_0xa0956e(0x181)],_0xa0956e(0x16f))['trim'](),_0x4c67d2=crypto_1[_0xa0956e(0x197)][_0xa0956e(0x210)](_0xa0956e(0x227));_0x4c67d2[_0xa0956e(0x1cd)](_0x9199bd),_0x4c67d2['end']();const _0x446085=_0x4c67d2['sign'](_0x4a3b22,_0xa0956e(0x1af));return console[_0xa0956e(0x1e2)]('🔐\x20RSA\x20signing\x20successful'),console[_0xa0956e(0x1e2)](_0xa0956e(0x16b),_0x9199bd[_0xa0956e(0x17a)]),console[_0xa0956e(0x1e2)](_0xa0956e(0x241),_0x446085[_0xa0956e(0x17a)]),_0x446085;}catch(_0x238e88){console[_0xa0956e(0x21b)]('❌\x20RSA\x20signing\x20failed:',_0x238e88),console[_0xa0956e(0x21b)]('❌\x20Data\x20being\x20signed:',_0x9199bd[_0xa0956e(0x19b)](0x0,0xc8)+'...');throw new Error(_0xa0956e(0x1c9));}}['decryptAES'](_0x234e2e,_0x19bd4b,_0x17cf98){const _0x10f9cc=a42_0x273783,_0x671500=crypto_1[_0x10f9cc(0x197)][_0x10f9cc(0x195)](_0x10f9cc(0x17b),_0x19bd4b,_0x17cf98);let _0x224bd6=_0x671500[_0x10f9cc(0x1cd)](_0x234e2e,_0x10f9cc(0x1af),_0x10f9cc(0x16f));return _0x224bd6+=_0x671500[_0x10f9cc(0x207)]('utf8'),_0x224bd6;}async[a42_0x273783(0x1ae)](_0x43cacf,_0x1dde70){const _0x4e8c1c=a42_0x273783;try{const _0x253b2d=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x4e8c1c(0x1cc),'headers':{'Content-Type':'application/json'},'body':JSON[_0x4e8c1c(0x178)]({'info':_0x43cacf,'key':_0x1dde70})});if(!_0x253b2d['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x253b2d[_0x4e8c1c(0x220)]();}catch(_0x6d0407){console['error'](_0x4e8c1c(0x1bb),_0x6d0407);throw new Error(_0x4e8c1c(0x221));}}[a42_0x273783(0x245)](_0xf2281a,_0xc419fa){const _0x46bec7=a42_0x273783;try{const _0x88a2cb=fs_1[_0x46bec7(0x197)][_0x46bec7(0x226)](this[_0x46bec7(0x181)],_0x46bec7(0x16f))[_0x46bec7(0x239)](),_0x2bd9d8=crypto_1[_0x46bec7(0x197)][_0x46bec7(0x19e)](_0x88a2cb,Buffer[_0x46bec7(0x1d7)](_0xc419fa,'base64')),_0x53bdc6=JSON[_0x46bec7(0x1d9)](_0x2bd9d8[_0x46bec7(0x230)]()),_0x202c93=Buffer[_0x46bec7(0x1d7)](_0x53bdc6[_0x46bec7(0x183)],_0x46bec7(0x1af)),_0x3c41a2=Buffer[_0x46bec7(0x1d7)](_0x53bdc6['iv'],_0x46bec7(0x1af));return this[_0x46bec7(0x23b)](_0xf2281a,_0x202c93,_0x3c41a2);}catch(_0x77ad5e){throw new Error('Failed\x20to\x20decrypt\x20response');}}async['processCardPayment'](_0x595926){const _0x4b9840=a42_0x273783,{paymentId:_0x307b81,orderId:_0x5a07b7,amount:_0x163df2,currency:_0x2f7a29,cardData:_0x2cf821,resultUrl:_0x67d6a6,returnUrl:_0x393c55,cardHolder:_0x1c347a,browser:_0x175ff2}=_0x595926;console[_0x4b9840(0x1e2)](_0x4b9840(0x1a0)),console[_0x4b9840(0x1e2)](_0x4b9840(0x159),_0x307b81),console[_0x4b9840(0x1e2)](_0x4b9840(0x1fa),_0x5a07b7),console[_0x4b9840(0x1e2)](_0x4b9840(0x1c3),_0x163df2,_0x2f7a29),console[_0x4b9840(0x1e2)]('Card\x20Number:',this[_0x4b9840(0x20c)](_0x2cf821[_0x4b9840(0x1dd)])),console[_0x4b9840(0x1e2)]('Card\x20Holder:',_0x1c347a[_0x4b9840(0x1b7)]+'\x20'+_0x1c347a[_0x4b9840(0x237)]),console['log'](_0x4b9840(0x17d),_0x393c55),console[_0x4b9840(0x1e2)](_0x4b9840(0x1d4),_0x67d6a6);const _0x1f7fd7={'amount':_0x163df2,'currency':_0x2f7a29[_0x4b9840(0x1a9)](),'order_id':_0x5a07b7,'result_url':_0x67d6a6,'return_url':_0x393c55,'card':{'number':_0x2cf821[_0x4b9840(0x1dd)],'expire_month':_0x2cf821[_0x4b9840(0x20d)],'expire_year':_0x2cf821['expire_year'],'cvv':_0x2cf821['cvv']},'card_holder':_0x1c347a,'browser':_0x175ff2},_0x2e75f4=JSON['stringify'](_0x1f7fd7);console[_0x4b9840(0x1e2)](_0x4b9840(0x238)),console[_0x4b9840(0x1e2)]('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console['log'](_0x2e75f4),console['log'](_0x4b9840(0x22f),_0x2e75f4[_0x4b9840(0x17a)]);try{const {key:_0xaf6587,iv:_0x3fc22a}=this[_0x4b9840(0x20f)]();console[_0x4b9840(0x1e2)](_0x4b9840(0x15d)),console[_0x4b9840(0x1e2)]('🔐\x20AES\x20key\x20length:',_0xaf6587['length']),console[_0x4b9840(0x1e2)](_0x4b9840(0x19d),_0x3fc22a[_0x4b9840(0x17a)]);const _0x1cddc4=this['encryptAES'](_0x2e75f4,_0xaf6587,_0x3fc22a);console[_0x4b9840(0x1e2)](_0x4b9840(0x1c2)),console[_0x4b9840(0x1e2)](_0x4b9840(0x1fb),_0x1cddc4['length']);const _0x45fde6=this['encryptRSA'](_0xaf6587,_0x3fc22a);console[_0x4b9840(0x1e2)](_0x4b9840(0x1ed)),console[_0x4b9840(0x1e2)](_0x4b9840(0x1fe),_0x45fde6['length']);const _0xfb4b91=this[_0x4b9840(0x17e)](_0x2e75f4);console[_0x4b9840(0x1e2)](_0x4b9840(0x160)),console[_0x4b9840(0x1e2)](_0x4b9840(0x241),_0xfb4b91[_0x4b9840(0x17a)]);const _0x5d5c54={'merchant_point_id':this['merchantPointId'],'method':'charge','info':_0x1cddc4,'key':_0x45fde6,'sign':_0xfb4b91,'lang':'en'};console[_0x4b9840(0x1e2)]('📤\x20Sending\x20request\x20to\x20MasterCard\x20API...'),console[_0x4b9840(0x1e2)](_0x4b9840(0x229)),console['log'](_0x4b9840(0x16c),this[_0x4b9840(0x168)]),console[_0x4b9840(0x1e2)](_0x4b9840(0x188)),console[_0x4b9840(0x1e2)](_0x4b9840(0x22d),_0x1cddc4[_0x4b9840(0x17a)]),console[_0x4b9840(0x1e2)](_0x4b9840(0x173),_0x45fde6[_0x4b9840(0x17a)]),console[_0x4b9840(0x1e2)](_0x4b9840(0x179),_0xfb4b91[_0x4b9840(0x17a)]),console['log'](_0x4b9840(0x1ac)),loggerService_1[_0x4b9840(0x240)]['logWhiteDomainRequest']('mastercard','/charge',_0x4b9840(0x1cc),{'merchant_point_id':this['merchantPointId'],'method':_0x4b9840(0x1d1),'lang':'en'});const _0xed174c=Date[_0x4b9840(0x1ec)](),_0x48e8ee=await fetch(this[_0x4b9840(0x16e)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x4b9840(0x180),'User-Agent':_0x4b9840(0x1e9)},'body':JSON[_0x4b9840(0x178)](_0x5d5c54)}),_0x5a5692=Date[_0x4b9840(0x1ec)]()-_0xed174c;console['log'](_0x4b9840(0x1a7)),console[_0x4b9840(0x1e2)](_0x4b9840(0x1d6),_0x48e8ee['status']),console[_0x4b9840(0x1e2)](_0x4b9840(0x1ce),_0x5a5692+'ms');if(!_0x48e8ee['ok']){const _0x173954=await _0x48e8ee[_0x4b9840(0x220)]();console['error'](_0x4b9840(0x1bd),_0x48e8ee[_0x4b9840(0x246)]),console['error'](_0x4b9840(0x18a),_0x173954),loggerService_1[_0x4b9840(0x240)]['logWhiteDomainResponse'](_0x4b9840(0x170),_0x4b9840(0x1e0),_0x48e8ee[_0x4b9840(0x246)],_0x173954,_0x5a5692),loggerService_1[_0x4b9840(0x240)][_0x4b9840(0x217)](_0x4b9840(0x170),'/charge','HTTP\x20'+_0x48e8ee[_0x4b9840(0x246)]+':\x20'+_0x173954);throw new Error('HTTP\x20error!\x20status:\x20'+_0x48e8ee['status']+',\x20body:\x20'+_0x173954);}const _0xef2ec7=await _0x48e8ee[_0x4b9840(0x208)]();loggerService_1[_0x4b9840(0x240)][_0x4b9840(0x1f7)](_0x4b9840(0x170),_0x4b9840(0x1e0),_0x48e8ee[_0x4b9840(0x246)],_0xef2ec7,_0x5a5692),console['log']('===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===');let _0x59f498=_0xef2ec7;if(_0xef2ec7[_0x4b9840(0x203)]&&_0xef2ec7[_0x4b9840(0x183)]&&_0xef2ec7[_0x4b9840(0x23f)]){console[_0x4b9840(0x1e2)](_0x4b9840(0x199));try{const _0x58ed4c=await this[_0x4b9840(0x1ae)](_0xef2ec7[_0x4b9840(0x203)],_0xef2ec7[_0x4b9840(0x183)]);_0x59f498=JSON['parse'](_0x58ed4c),console[_0x4b9840(0x1e2)]('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0x4b9840(0x240)][_0x4b9840(0x1f7)](_0x4b9840(0x170),_0x4b9840(0x20a),_0x48e8ee[_0x4b9840(0x246)],_0x59f498,_0x5a5692),console['log'](_0x4b9840(0x22e));}catch(_0x4aef80){console['error'](_0x4b9840(0x216),_0x4aef80),loggerService_1[_0x4b9840(0x240)][_0x4b9840(0x217)](_0x4b9840(0x170),'/charge_decrypt',_0x4b9840(0x1e3)+_0x4aef80),_0x59f498=_0xef2ec7;}}else loggerService_1[_0x4b9840(0x240)]['logWhiteDomainResponse'](_0x4b9840(0x170),_0x4b9840(0x20a),_0x48e8ee[_0x4b9840(0x246)],_0x59f498,_0x5a5692),console[_0x4b9840(0x1e2)](_0x4b9840(0x162));console[_0x4b9840(0x1e2)](_0x4b9840(0x1d6),_0x59f498[_0x4b9840(0x246)]),console[_0x4b9840(0x1e2)](_0x4b9840(0x233),_0x59f498[_0x4b9840(0x207)]),console[_0x4b9840(0x1e2)](_0x4b9840(0x159),_0x59f498[_0x4b9840(0x15b)]),console[_0x4b9840(0x1e2)](_0x4b9840(0x1b6),_0x59f498['3ds_url']||_0x4b9840(0x21f));if(_0x59f498[_0x4b9840(0x246)]===0x64&&_0x59f498[_0x4b9840(0x207)]===0x1)return console[_0x4b9840(0x1e2)](_0x4b9840(0x20b)),{'gateway_payment_id':_0x59f498[_0x4b9840(0x15b)]?.['toString'](),'payment_url':_0x393c55,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x59f498[_0x4b9840(0x1df)])return console[_0x4b9840(0x1e2)](_0x4b9840(0x1eb)),this[_0x4b9840(0x191)](_0x307b81,_0x5a07b7,_0x59f498[_0x4b9840(0x15b)]?.[_0x4b9840(0x230)]()||_0x5a07b7),{'gateway_payment_id':_0x59f498[_0x4b9840(0x15b)]?.['toString'](),'payment_url':_0x59f498[_0x4b9840(0x1df)],'requires_3ds':!![],'threeds_url':_0x59f498[_0x4b9840(0x1df)],'status':_0x4b9840(0x1a6),'final':![]};let _0xc5db17=_0x59f498[_0x4b9840(0x1d0)]||_0x59f498['message']||_0x4b9840(0x16a),_0x3299e8=_0x59f498[_0x4b9840(0x246)],_0x37117c=_0x59f498[_0x4b9840(0x207)];return console[_0x4b9840(0x1e2)](_0x4b9840(0x234)+_0x3299e8+_0x4b9840(0x1fd)+_0x37117c+_0x4b9840(0x23d)+_0xc5db17),{'gateway_payment_id':_0x59f498[_0x4b9840(0x15b)]?.['toString'](),'payment_url':_0x393c55,'requires_3ds':![],'status':_0x4b9840(0x185),'final':!![]};}catch(_0x209735){console[_0x4b9840(0x21b)]('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console[_0x4b9840(0x21b)](_0x4b9840(0x167),_0x209735),loggerService_1[_0x4b9840(0x240)][_0x4b9840(0x217)](_0x4b9840(0x170),'/charge',_0x209735);throw new Error('Failed\x20to\x20process\x20MasterCard\x20payment:\x20'+(_0x209735 instanceof Error?_0x209735[_0x4b9840(0x1a4)]:_0x4b9840(0x16a)));}}async['checkPaymentStatus'](_0x17f403,_0x128c12){const _0x309787=a42_0x273783;console[_0x309787(0x1e2)](_0x309787(0x236)+_0x17f403+'\x20('+_0x128c12+')');try{const _0x57edee={'payment_id':_0x17f403,'order_id':_0x128c12},_0x55c981=JSON[_0x309787(0x178)](_0x57edee),{key:_0x1bb1e2,iv:_0x2a70d2}=this['generateAESKey'](),_0x27a0e4=this[_0x309787(0x176)](_0x55c981,_0x1bb1e2,_0x2a70d2),_0x5c7212=this[_0x309787(0x212)](_0x1bb1e2,_0x2a70d2),_0x3cc31e=this[_0x309787(0x17e)](_0x55c981),_0x14cb2a={'merchant_point_id':this[_0x309787(0x168)],'method':'status','info':_0x27a0e4,'key':_0x5c7212,'sign':_0x3cc31e,'lang':'en'};loggerService_1[_0x309787(0x240)]['logWhiteDomainRequest'](_0x309787(0x170),_0x309787(0x166),'POST',{'merchant_point_id':this[_0x309787(0x168)],'method':_0x309787(0x246),'lang':'en'});const _0x5b58f2=Date[_0x309787(0x1ec)](),_0x5a5151=await fetch(this[_0x309787(0x16e)],{'method':_0x309787(0x1cc),'headers':{'Content-Type':_0x309787(0x180),'Accept':_0x309787(0x180),'User-Agent':_0x309787(0x1e9)},'body':JSON['stringify'](_0x14cb2a)}),_0x5ab766=Date[_0x309787(0x1ec)]()-_0x5b58f2;if(!_0x5a5151['ok']){const _0x700f47=await _0x5a5151['text']();loggerService_1[_0x309787(0x240)][_0x309787(0x1f7)](_0x309787(0x170),'/status_raw',_0x5a5151[_0x309787(0x246)],_0x700f47,_0x5ab766);throw new Error(_0x309787(0x1e8)+_0x5a5151[_0x309787(0x246)]);}const _0x559e07=await _0x5a5151['json']();loggerService_1['loggerService'][_0x309787(0x1f7)](_0x309787(0x170),_0x309787(0x225),_0x5a5151[_0x309787(0x246)],_0x559e07,_0x5ab766);let _0x43a5f5=_0x559e07;if(_0x559e07[_0x309787(0x203)]&&_0x559e07[_0x309787(0x183)]&&_0x559e07[_0x309787(0x23f)]){console[_0x309787(0x1e2)](_0x309787(0x243));try{const _0x4b5be5=this[_0x309787(0x245)](_0x559e07['info'],_0x559e07[_0x309787(0x183)]);_0x43a5f5=JSON[_0x309787(0x1d9)](_0x4b5be5),console[_0x309787(0x1e2)](_0x309787(0x1bf)),loggerService_1['loggerService'][_0x309787(0x1f7)]('mastercard','/status_decrypted',_0x5a5151[_0x309787(0x246)],_0x43a5f5,_0x5ab766),console[_0x309787(0x1e2)](_0x309787(0x1c6));}catch(_0x44df03){console[_0x309787(0x21b)](_0x309787(0x1ff),_0x44df03),loggerService_1[_0x309787(0x240)][_0x309787(0x217)](_0x309787(0x170),_0x309787(0x1da),_0x309787(0x1f2)+_0x44df03),_0x43a5f5=_0x559e07;}}else loggerService_1[_0x309787(0x240)]['logWhiteDomainResponse'](_0x309787(0x170),'/status_decrypted',_0x5a5151[_0x309787(0x246)],_0x43a5f5,_0x5ab766),console['log']('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x309787(0x1e2)]('📊\x20Status\x20check\x20result:',{'status':_0x43a5f5['status'],'final':_0x43a5f5[_0x309787(0x207)],'payment_id':_0x43a5f5['payment_id'],'desc':_0x43a5f5[_0x309787(0x1d0)]});let _0x105523=_0x309787(0x1a6);if(_0x43a5f5[_0x309787(0x246)]===0x1&&_0x43a5f5[_0x309787(0x207)]===0x1)_0x105523=_0x309787(0x18c);else _0x43a5f5[_0x309787(0x246)]===0x0&&_0x43a5f5[_0x309787(0x207)]===0x0?_0x105523=_0x309787(0x1a6):_0x105523='FAILED';return{'status':_0x105523,'final':_0x43a5f5[_0x309787(0x207)]===0x1,'amount':_0x43a5f5[_0x309787(0x23c)],'currency':_0x43a5f5['currency'],'date_success':_0x43a5f5['date_success'],'description':_0x43a5f5[_0x309787(0x1d0)]};}catch(_0x7af603){console['error'](_0x309787(0x219),_0x7af603),loggerService_1[_0x309787(0x240)][_0x309787(0x217)](_0x309787(0x170),_0x309787(0x166),_0x7af603);throw new Error('Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20'+(_0x7af603 instanceof Error?_0x7af603[_0x309787(0x1a4)]:_0x309787(0x16a)));}}[a42_0x273783(0x191)](_0x111ffb,_0x20b935,_0x4de94e){const _0x4afaf5=a42_0x273783;console[_0x4afaf5(0x1e2)](_0x4afaf5(0x184)+_0x111ffb+'\x20('+_0x4de94e+')'),this[_0x4afaf5(0x1f9)](_0x111ffb);const _0x443894=[],_0x157027=0x5*0x3c*0x3e8,_0x2a016c=0x2*0x3c*0x3c*0x3e8,_0x5de3a2=Math[_0x4afaf5(0x20e)](_0x2a016c/_0x157027);console[_0x4afaf5(0x1e2)](_0x4afaf5(0x222)+_0x5de3a2+_0x4afaf5(0x182));for(let _0x1e309c=0x1;_0x1e309c<=_0x5de3a2;_0x1e309c++){const _0x4a0539=setTimeout(async()=>{const _0x4944e8=_0x4afaf5;console[_0x4944e8(0x1e2)]('🔍\x20MasterCard\x20status\x20check\x20#'+_0x1e309c+'/'+_0x5de3a2+_0x4944e8(0x1ef)+_0x111ffb);try{const _0x4019ad=await this[_0x4944e8(0x1c0)](_0x4de94e,_0x20b935);console['log'](_0x4944e8(0x1b2)+_0x1e309c+_0x4944e8(0x1f8),_0x4019ad),_0x4019ad[_0x4944e8(0x207)]&&(console['log'](_0x4944e8(0x15e)+_0x111ffb+'\x20is\x20final\x20('+_0x4019ad[_0x4944e8(0x246)]+'),\x20stopping\x20status\x20checks'),this[_0x4944e8(0x1f9)](_0x111ffb),await this[_0x4944e8(0x1e7)](_0x111ffb,_0x4019ad[_0x4944e8(0x246)],_0x4019ad));}catch(_0xfef27f){console[_0x4944e8(0x21b)](_0x4944e8(0x200)+_0x1e309c+_0x4944e8(0x18d)+_0x111ffb+':',_0xfef27f);}},_0x1e309c*_0x157027);_0x443894[_0x4afaf5(0x1b4)](_0x4a0539);}this['statusCheckTimers'][_0x4afaf5(0x1d2)](_0x111ffb,_0x443894),console[_0x4afaf5(0x1e2)](_0x4afaf5(0x17f)+_0x5de3a2+_0x4afaf5(0x1e4)+_0x111ffb);}['clearStatusTimers'](_0x20fc1d){const _0xd7a7de=a42_0x273783,_0x3ec8e6=this[_0xd7a7de(0x156)][_0xd7a7de(0x235)](_0x20fc1d);_0x3ec8e6&&(console['log'](_0xd7a7de(0x15f)+_0x3ec8e6[_0xd7a7de(0x17a)]+_0xd7a7de(0x1cf)+_0x20fc1d),_0x3ec8e6[_0xd7a7de(0x228)]((_0x30df33,_0x3636a2)=>{clearTimeout(_0x30df33);}),this[_0xd7a7de(0x156)][_0xd7a7de(0x19f)](_0x20fc1d));}async[a42_0x273783(0x1e7)](_0x1fe756,_0x56159d,_0x18dbdc){const _0x3f487a=a42_0x273783;try{const _0x48605a=(await Promise[_0x3f487a(0x186)]()[_0x3f487a(0x22c)](()=>__importStar(require(_0x3f487a(0x194)))))['default'],_0x42df5c={'status':_0x56159d[_0x3f487a(0x1a9)](),'updatedAt':new Date(),'statusChangedBy':_0x3f487a(0x1c5),'statusChangedAt':new Date()};_0x56159d===_0x3f487a(0x18c)&&(_0x42df5c[_0x3f487a(0x193)]=new Date()),_0x18dbdc[_0x3f487a(0x17c)]&&(_0x42df5c[_0x3f487a(0x161)]=_0x3f487a(0x190)+_0x18dbdc[_0x3f487a(0x17c)]),await _0x48605a[_0x3f487a(0x22a)]['update']({'where':{'id':_0x1fe756},'data':_0x42df5c}),console[_0x3f487a(0x1e2)]('✅\x20Payment\x20'+_0x1fe756+_0x3f487a(0x172)+_0x56159d),await this[_0x3f487a(0x1ba)](_0x1fe756,_0x56159d);}catch(_0x3b2071){console[_0x3f487a(0x21b)](_0x3f487a(0x174)+_0x1fe756+':',_0x3b2071);}}async['sendPaymentNotifications'](_0x5b5f56,_0x2aec41){const _0x5d39ed=a42_0x273783;try{const _0x34f56b=(await Promise[_0x5d39ed(0x186)]()[_0x5d39ed(0x22c)](()=>__importStar(require(_0x5d39ed(0x194)))))['default'],{telegramBotService:_0xf86cc8}=await Promise[_0x5d39ed(0x186)]()[_0x5d39ed(0x22c)](()=>__importStar(require('../telegramBotService'))),_0x11ddef=await _0x34f56b[_0x5d39ed(0x22a)][_0x5d39ed(0x1f0)]({'where':{'id':_0x5b5f56},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x11ddef)return;const _0x588a0c={'PAID':'paid','FAILED':_0x5d39ed(0x232)},_0xe38fcf=_0x588a0c[_0x2aec41];_0xe38fcf&&await _0xf86cc8['sendPaymentNotification'](_0x11ddef[_0x5d39ed(0x15c)],_0x11ddef,_0xe38fcf),await this[_0x5d39ed(0x1c1)](_0x11ddef,_0x2aec41);}catch(_0x3e42b2){console[_0x5d39ed(0x21b)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x3e42b2);}}async[a42_0x273783(0x1c1)](_0x539781,_0x4a3f3c){const _0x45a8dd=a42_0x273783,_0x299b67=Date['now']();try{const _0x1618d7=_0x539781[_0x45a8dd(0x1dc)],_0x1f4be=_0x1618d7[_0x45a8dd(0x231)];if(!_0x1f4be?.['webhookUrl']){console[_0x45a8dd(0x1e2)](_0x45a8dd(0x1de)+_0x1618d7['id']);return;}const _0x4f39c3=_0x4a3f3c===_0x45a8dd(0x18c)?_0x45a8dd(0x204):_0x45a8dd(0x163);let _0x267f72=[];if(_0x1f4be[_0x45a8dd(0x1ad)])try{_0x267f72=Array[_0x45a8dd(0x1b9)](_0x1f4be['webhookEvents'])?_0x1f4be[_0x45a8dd(0x1ad)]:JSON[_0x45a8dd(0x1d9)](_0x1f4be[_0x45a8dd(0x1ad)]);}catch(_0x317e9c){console[_0x45a8dd(0x21b)](_0x45a8dd(0x1b0),_0x317e9c),_0x267f72=[];}if(!_0x267f72['includes'](_0x4f39c3)){console[_0x45a8dd(0x1e2)](_0x45a8dd(0x1d8)+_0x4f39c3+_0x45a8dd(0x1cb)+_0x1618d7['id']);return;}const _0x1567f9={'event':_0x4f39c3,'payment':{'id':_0x539781['id'],'order_id':_0x539781[_0x45a8dd(0x1c8)],'gateway_order_id':_0x539781[_0x45a8dd(0x19a)],'gateway':'1111','amount':_0x539781[_0x45a8dd(0x23c)],'currency':_0x539781[_0x45a8dd(0x1ca)],'status':_0x4a3f3c[_0x45a8dd(0x1ea)](),'customer_email':_0x539781[_0x45a8dd(0x196)],'customer_name':_0x539781[_0x45a8dd(0x21d)],'created_at':_0x539781['createdAt'],'updated_at':new Date()}},_0x3bee5c=await fetch(_0x1f4be[_0x45a8dd(0x1bc)],{'method':_0x45a8dd(0x1cc),'headers':{'Content-Type':'application/json','User-Agent':_0x45a8dd(0x23e)},'body':JSON[_0x45a8dd(0x178)](_0x1567f9)}),_0x3ba35f=Date['now']()-_0x299b67;loggerService_1[_0x45a8dd(0x240)][_0x45a8dd(0x1ee)](_0x539781['shopId'],_0x1f4be[_0x45a8dd(0x1bc)],_0x4f39c3,_0x3bee5c['status'],_0x3ba35f,_0x1567f9),console[_0x45a8dd(0x1e2)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x1f4be[_0x45a8dd(0x1bc)]+'\x20with\x20status\x20'+_0x3bee5c[_0x45a8dd(0x246)]+'\x20('+_0x3ba35f+_0x45a8dd(0x213));}catch(_0x2c0a9f){console[_0x45a8dd(0x21b)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x2c0a9f),loggerService_1[_0x45a8dd(0x240)]['logShopWebhookError'](_0x539781['shopId'],_0x539781[_0x45a8dd(0x1dc)]?.[_0x45a8dd(0x231)]?.[_0x45a8dd(0x1bc)]||_0x45a8dd(0x202),_0x45a8dd(0x189),_0x2c0a9f,{});}}[a42_0x273783(0x20c)](_0x39dc42){const _0x4ad3b8=a42_0x273783,_0x58c509=_0x39dc42[_0x4ad3b8(0x205)](/[\s-]/g,'');if(_0x58c509[_0x4ad3b8(0x17a)]<0x4)return'****';return _0x4ad3b8(0x223)+_0x58c509[_0x4ad3b8(0x215)](-0x4);}async[a42_0x273783(0x18e)](_0x40c960){const _0xc5388=a42_0x273783;console[_0xc5388(0x1e2)](_0xc5388(0x206),_0x40c960);let _0x3384fe=_0xc5388(0x1a6);if(_0x40c960[_0xc5388(0x246)]===0x1&&_0x40c960['final']===0x1)_0x3384fe=_0xc5388(0x18c);else _0x40c960[_0xc5388(0x246)]===0x0&&_0x40c960['final']===0x0?_0x3384fe='PENDING':_0x3384fe=_0xc5388(0x185);return{'paymentId':_0x40c960[_0xc5388(0x1f4)]||'','status':_0x3384fe,'amount':_0x40c960['amount'],'currency':_0x40c960[_0xc5388(0x1ca)]};}['stopAllStatusChecks'](){const _0x331c8e=a42_0x273783;console[_0x331c8e(0x1e2)](_0x331c8e(0x158));const _0x587a8d=this[_0x331c8e(0x156)][_0x331c8e(0x1e5)];for(const [_0x2918d9]of this[_0x331c8e(0x156)]){this[_0x331c8e(0x1f9)](_0x2918d9);}console[_0x331c8e(0x1e2)]('🛑\x20Stopped\x20'+_0x587a8d+_0x331c8e(0x1f6));}}exports['MasterCardService']=MasterCardService;