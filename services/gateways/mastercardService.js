'use strict';const a43_0x22bbaf=a43_0x1d9f;(function(_0x9510ba,_0xc549fb){const _0x1a8ca9=a43_0x1d9f,_0x1a0d08=_0x9510ba();while(!![]){try{const _0x129b7d=-parseInt(_0x1a8ca9(0x1d8))/0x1*(-parseInt(_0x1a8ca9(0x14f))/0x2)+parseInt(_0x1a8ca9(0x1a2))/0x3+-parseInt(_0x1a8ca9(0x1ae))/0x4+parseInt(_0x1a8ca9(0x172))/0x5*(-parseInt(_0x1a8ca9(0x1a1))/0x6)+-parseInt(_0x1a8ca9(0x1c9))/0x7+parseInt(_0x1a8ca9(0x1aa))/0x8*(parseInt(_0x1a8ca9(0x198))/0x9)+parseInt(_0x1a8ca9(0x16f))/0xa;if(_0x129b7d===_0xc549fb)break;else _0x1a0d08['push'](_0x1a0d08['shift']());}catch(_0x2cc541){_0x1a0d08['push'](_0x1a0d08['shift']());}}}(a43_0x34c7,0x4e7e6));function a43_0x34c7(){const _0x8ffcbd=['===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','statusCheckTimers','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','error','MasterCard\x20status\x20check\x20error:','publicEncrypt','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','order_id','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','desc','Order\x20ID:','last_name','\x20for\x20payment\x20','clearStatusTimers','expire_month','now','...','\x20failed\x20for\x20payment\x20','length','../telegramBotService','forEach','PHP\x20decryptor\x20error','\x20status\x20timers\x20for\x20payment\x20','❌\x20RSA\x20signing\x20failed:','HTTP\x20Status:','privateDecrypt','message','stringify','scheduleStatusChecks','from','⏰\x20Will\x20check\x20status\x20','\x20\x20\x20-\x20lang:\x20en','/status_decrypt','MasterCard\x20webhook\x20sent\x20to\x20','💾\x20Payment\x20data\x20prepared','📝\x20Final\x20request\x20structure:','Error\x20details:','push','/status_raw','6uFLAry','system','defineProperty','failed','✅\x20Scheduled\x20','🔐\x20Data\x20signed\x20with\x20RSA','✅\x20Payment\x20successful','constants','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','final','generateAESKey','/charge','\x20with\x20status\x20','MasterCard:\x20','validateKeyFiles','settings','findUnique','update','🔐\x20AES\x20key\x20length:','mastercard','createDecipheriv','MasterCardService','substring','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','updatePaymentStatus','parse','HTTP\x20','cwd','utf8','adminNotes','payment_id','/status_decrypted','5875070ZNshMS','../loggerService','PAID','346895AUYUWR','loggerService','payment','sendPaymentNotification','❌\x20Failed\x20to\x20decrypt\x20status\x20response:',',\x20paymentId=','currency','psp_public.pem','replace','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','🔐\x20Data\x20encrypted\x20with\x20AES','includes','then','set','Failed\x20to\x20decrypt\x20response','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','customerEmail','📝\x20Signature\x20length:','checkPaymentStatus','\x20(from:\x20order_id=','delete','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','sendPaymentNotifications',',\x20payment_id=','slice','maskCardNumber','🔐\x20Public\x20key\x20path:','-----END','decryptAES','encryptAES','❌\x20Status\x20check\x20#','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','-----BEGIN','isArray','Return\x20URL:','create','📝\x20Encrypted\x20key\x20length:','666207wnzGmJ','charge','end','default','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','****\x20****\x20****\x20','\x20\x20\x20-\x20method:\x20charge','text','🧹\x20Clearing\x20','18WARVMu','695313oJOuiG','join','1111','__esModule','https://api2.trapay.uk/decrypt.php','webhook_send','logWhiteDomainResponse','processCardPayment','24KiAPRK','\x20is\x20final\x20(','📊\x20Status\x20check\x20#','unknown','1240716Nwegmv','Status\x20decryption\x20failed:\x20','\x20\x20\x20-\x20merchant_point_id:','configurable','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','Failed\x20to\x20send\x20MasterCard\x20webhook:','🔐\x20Public\x20key\x20length:\x20','📊\x20Status\x20check\x20result:','/charge_decrypted','get','Decryption\x20failed:\x20','SHA256','✅\x20Status\x20response\x20decrypted\x20successfully','\x20\x20\x20-\x20key\x20length:',',\x20Final:\x20','webhookEvents','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','aes-256-ctr','logWhiteDomainRequest','toUpperCase','description','path','\x20result:','HTTP\x20error!\x20status:\x20','🛑\x20Stopped\x20','../../config/database','Public\x20key\x20file\x20not\x20found:\x20','2995034NEbNLB','payment.success','signRSA','size','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','none','/status','sendShopWebhook','info','paidAt','json','apiUrl','sign','Result\x20URL:','log','75447rnNHAw','application/json','🔐\x20Private\x20key\x20length:\x20','payment.failed','first_name','\x20\x20\x20-\x20info\x20length:','stopAllStatusChecks','writable','Payment\x20ID:','readFileSync','****','randomBytes','\x20characters','expire_year','status','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','✅\x20Payment\x20','\x20MasterCard\x20status\x20check\x20timers','📝\x20Data\x20to\x20sign\x20length:','Response\x20Body:',',\x20Desc:\x20','❌\x20PHP\x20decryptor\x20request\x20failed:','paymentId','PENDING','floor','__createBinding','🔐\x20AES\x20key\x20and\x20IV\x20generated','__setModuleDefault','TesSoft\x20Payment\x20System/1.0','logWhiteDomainError','🔐\x20RSA\x20signing\x20successful','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','key','\x20\x20\x20Currency:\x20','decryptResponsePhp','merchantPointId','decryptResponse','webhookUrl','cvv','shopId','encryptRSA','prototype','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','ms)','FAILED',',\x20id=','base64','💳\x20MasterCard\x20service\x20initialized','\x20(from:\x20status=','POST','toString','3ds_url','Webhook\x20event\x20','Card\x20Number:','❌\x20RSA\x20encryption\x20failed:','\x20status\x20checks\x20for\x20payment\x20','existsSync','__importDefault','Status:','hasOwnProperty','trim',',\x20final=','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','Private\x20key\x20file\x20not\x20found:\x20','toLowerCase','amount','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','publicKeyPath','❌\x20Data\x20being\x20signed:','resolve','orderId','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','privateKeyPath','number','/charge_raw',',\x20orderId=','🔐\x20Private\x20key\x20path:','Unknown\x20error','getOwnPropertyDescriptor'];a43_0x34c7=function(){return _0x8ffcbd;};return a43_0x34c7();}var __createBinding=this&&this[a43_0x22bbaf(0x1f1)]||(Object[a43_0x22bbaf(0x196)]?function(_0x493f78,_0x240609,_0x44b1e5,_0x35b002){const _0x394994=a43_0x22bbaf;if(_0x35b002===undefined)_0x35b002=_0x44b1e5;var _0x16cc3c=Object[_0x394994(0x226)](_0x240609,_0x44b1e5);(!_0x16cc3c||(_0x394994(0x1b7)in _0x16cc3c?!_0x240609[_0x394994(0x1a5)]:_0x16cc3c[_0x394994(0x1df)]||_0x16cc3c[_0x394994(0x1b1)]))&&(_0x16cc3c={'enumerable':!![],'get':function(){return _0x240609[_0x44b1e5];}}),Object[_0x394994(0x151)](_0x493f78,_0x35b002,_0x16cc3c);}:function(_0x1d6e0c,_0x5cfcd8,_0x2fa1aa,_0x2e46f0){if(_0x2e46f0===undefined)_0x2e46f0=_0x2fa1aa;_0x1d6e0c[_0x2e46f0]=_0x5cfcd8[_0x2fa1aa];}),__setModuleDefault=this&&this[a43_0x22bbaf(0x1f3)]||(Object[a43_0x22bbaf(0x196)]?function(_0x260c41,_0x38639c){const _0x49a1dd=a43_0x22bbaf;Object[_0x49a1dd(0x151)](_0x260c41,_0x49a1dd(0x19b),{'enumerable':!![],'value':_0x38639c});}:function(_0x162265,_0x474bc7){const _0x1cf079=a43_0x22bbaf;_0x162265[_0x1cf079(0x19b)]=_0x474bc7;}),__importStar=this&&this['__importStar']||(function(){var _0x11a9ea=function(_0x4a3953){return _0x11a9ea=Object['getOwnPropertyNames']||function(_0x72522c){const _0x5d8a3e=a43_0x1d9f;var _0x40210b=[];for(var _0x155819 in _0x72522c)if(Object[_0x5d8a3e(0x201)][_0x5d8a3e(0x213)]['call'](_0x72522c,_0x155819))_0x40210b[_0x40210b[_0x5d8a3e(0x239)]]=_0x155819;return _0x40210b;},_0x11a9ea(_0x4a3953);};return function(_0x402001){const _0x4cc822=a43_0x1d9f;if(_0x402001&&_0x402001[_0x4cc822(0x1a5)])return _0x402001;var _0x56378e={};if(_0x402001!=null){for(var _0x4cf7f3=_0x11a9ea(_0x402001),_0x341559=0x0;_0x341559<_0x4cf7f3[_0x4cc822(0x239)];_0x341559++)if(_0x4cf7f3[_0x341559]!=='default')__createBinding(_0x56378e,_0x402001,_0x4cf7f3[_0x341559]);}return __setModuleDefault(_0x56378e,_0x402001),_0x56378e;};}()),__importDefault=this&&this[a43_0x22bbaf(0x211)]||function(_0x7ae986){const _0x3e518b=a43_0x22bbaf;return _0x7ae986&&_0x7ae986[_0x3e518b(0x1a5)]?_0x7ae986:{'default':_0x7ae986};};function a43_0x1d9f(_0x257379,_0x3c9747){const _0x34c74e=a43_0x34c7();return a43_0x1d9f=function(_0x1d9fab,_0x4604f1){_0x1d9fab=_0x1d9fab-0x13e;let _0x435c55=_0x34c74e[_0x1d9fab];return _0x435c55;},a43_0x1d9f(_0x257379,_0x3c9747);}Object['defineProperty'](exports,a43_0x22bbaf(0x1a5),{'value':!![]}),exports[a43_0x22bbaf(0x164)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a43_0x22bbaf(0x1c3))),loggerService_1=require(a43_0x22bbaf(0x170));class MasterCardService{constructor(){const _0x2af8fb=a43_0x22bbaf;this['statusCheckTimers']=new Map(),this[_0x2af8fb(0x1d4)]='https://api.paydmeth.com/api',this[_0x2af8fb(0x1fb)]=0x67c,this[_0x2af8fb(0x220)]=path_1['default'][_0x2af8fb(0x1a3)](process['cwd'](),'keys','private.pem'),this['publicKeyPath']=path_1[_0x2af8fb(0x19b)]['join'](process[_0x2af8fb(0x16a)](),'keys',_0x2af8fb(0x179)),console['log'](_0x2af8fb(0x207)),console[_0x2af8fb(0x1d7)](_0x2af8fb(0x224),this[_0x2af8fb(0x220)]),console[_0x2af8fb(0x1d7)](_0x2af8fb(0x18c),this[_0x2af8fb(0x21b)]),this[_0x2af8fb(0x15d)]();}[a43_0x22bbaf(0x15d)](){const _0x52850b=a43_0x22bbaf;try{if(!fs_1[_0x52850b(0x19b)][_0x52850b(0x210)](this[_0x52850b(0x220)]))throw new Error(_0x52850b(0x217)+this[_0x52850b(0x220)]);if(!fs_1['default'][_0x52850b(0x210)](this[_0x52850b(0x21b)]))throw new Error(_0x52850b(0x1c8)+this['publicKeyPath']);const _0x6838f=fs_1[_0x52850b(0x19b)][_0x52850b(0x1e1)](this[_0x52850b(0x220)],_0x52850b(0x16b))[_0x52850b(0x214)](),_0x4d1683=fs_1['default'][_0x52850b(0x1e1)](this[_0x52850b(0x21b)],'utf8')['trim']();if(!_0x6838f[_0x52850b(0x17d)]('-----BEGIN')||!_0x6838f['includes']('-----END'))throw new Error(_0x52850b(0x21f));if(!_0x4d1683['includes'](_0x52850b(0x193))||!_0x4d1683[_0x52850b(0x17d)](_0x52850b(0x18d)))throw new Error(_0x52850b(0x187));console[_0x52850b(0x1d7)]('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console[_0x52850b(0x1d7)](_0x52850b(0x1da)+_0x6838f['length']+_0x52850b(0x1e4)),console[_0x52850b(0x1d7)](_0x52850b(0x1b4)+_0x4d1683['length']+_0x52850b(0x1e4));}catch(_0x93094c){console[_0x52850b(0x22a)]('❌\x20MasterCard\x20key\x20validation\x20failed:',_0x93094c);throw _0x93094c;}}[a43_0x22bbaf(0x159)](){const _0x2254c6=a43_0x22bbaf,_0x3720c6=crypto_1[_0x2254c6(0x19b)][_0x2254c6(0x1e3)](0x20),_0x507e0b=crypto_1[_0x2254c6(0x19b)]['randomBytes'](0x10);return{'key':_0x3720c6,'iv':_0x507e0b};}[a43_0x22bbaf(0x18f)](_0x471f51,_0x3898fe,_0x24c98a){const _0x27a3b3=a43_0x22bbaf,_0x44d322=crypto_1[_0x27a3b3(0x19b)]['createCipheriv']('aes-256-ctr',_0x3898fe,_0x24c98a);let _0x6a875b=_0x44d322[_0x27a3b3(0x160)](_0x471f51,'utf8',_0x27a3b3(0x206));return _0x6a875b+=_0x44d322[_0x27a3b3(0x158)]('base64'),_0x6a875b;}['encryptRSA'](_0x4f1edf,_0x5eb91e){const _0x4a4147=a43_0x22bbaf;try{const _0x5e4f71=fs_1[_0x4a4147(0x19b)]['readFileSync'](this[_0x4a4147(0x21b)],_0x4a4147(0x16b))[_0x4a4147(0x214)](),_0x1cee83={'iv':_0x5eb91e[_0x4a4147(0x20a)](_0x4a4147(0x206)),'key':_0x4f1edf[_0x4a4147(0x20a)](_0x4a4147(0x206))},_0x1a3684=JSON['stringify'](_0x1cee83);console['log'](_0x4a4147(0x166),_0x1a3684[_0x4a4147(0x239)]);const _0x41d655=crypto_1[_0x4a4147(0x19b)][_0x4a4147(0x22c)]({'key':_0x5e4f71,'padding':crypto_1['default'][_0x4a4147(0x156)]['RSA_PKCS1_PADDING']},Buffer[_0x4a4147(0x145)](_0x1a3684));return console['log'](_0x4a4147(0x17b),_0x41d655['length']),_0x41d655[_0x4a4147(0x20a)](_0x4a4147(0x206));}catch(_0x4117b6){console[_0x4a4147(0x22a)](_0x4a4147(0x20e),_0x4117b6);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}['signRSA'](_0x138d1b){const _0x39e939=a43_0x22bbaf;try{const _0x46ffe3=fs_1[_0x39e939(0x19b)][_0x39e939(0x1e1)](this[_0x39e939(0x220)],_0x39e939(0x16b))[_0x39e939(0x214)](),_0x107740=crypto_1[_0x39e939(0x19b)]['createSign'](_0x39e939(0x1b9));_0x107740[_0x39e939(0x160)](_0x138d1b),_0x107740[_0x39e939(0x19a)]();const _0x2e4eac=_0x107740[_0x39e939(0x1d5)](_0x46ffe3,_0x39e939(0x206));return console['log'](_0x39e939(0x1f6)),console[_0x39e939(0x1d7)](_0x39e939(0x1ea),_0x138d1b[_0x39e939(0x239)]),console['log']('📝\x20Signature\x20length:',_0x2e4eac['length']),_0x2e4eac;}catch(_0x267061){console[_0x39e939(0x22a)](_0x39e939(0x13f),_0x267061),console[_0x39e939(0x22a)](_0x39e939(0x21c),_0x138d1b[_0x39e939(0x165)](0x0,0xc8)+_0x39e939(0x237));throw new Error(_0x39e939(0x191));}}[a43_0x22bbaf(0x18e)](_0x106bea,_0x3ca12f,_0x4b1a5d){const _0x38b0d6=a43_0x22bbaf,_0x207deb=crypto_1[_0x38b0d6(0x19b)][_0x38b0d6(0x163)](_0x38b0d6(0x1bf),_0x3ca12f,_0x4b1a5d);let _0x59724e=_0x207deb[_0x38b0d6(0x160)](_0x106bea,_0x38b0d6(0x206),_0x38b0d6(0x16b));return _0x59724e+=_0x207deb[_0x38b0d6(0x158)](_0x38b0d6(0x16b)),_0x59724e;}async[a43_0x22bbaf(0x1fa)](_0x248766,_0x12e9ed){const _0xa06a59=a43_0x22bbaf;try{const _0x1141ce=await fetch(_0xa06a59(0x1a6),{'method':_0xa06a59(0x209),'headers':{'Content-Type':'application/json'},'body':JSON[_0xa06a59(0x143)]({'info':_0x248766,'key':_0x12e9ed})});if(!_0x1141ce['ok'])throw new Error(_0xa06a59(0x23c));return await _0x1141ce['text']();}catch(_0x252c10){console[_0xa06a59(0x22a)](_0xa06a59(0x1ed),_0x252c10);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a43_0x22bbaf(0x1fc)](_0x4ba5bd,_0x280157){const _0x58facf=a43_0x22bbaf;try{const _0x25be18=fs_1[_0x58facf(0x19b)]['readFileSync'](this[_0x58facf(0x220)],_0x58facf(0x16b))[_0x58facf(0x214)](),_0x22f7fb=crypto_1[_0x58facf(0x19b)][_0x58facf(0x141)](_0x25be18,Buffer[_0x58facf(0x145)](_0x280157,'base64')),_0xe14ba6=JSON['parse'](_0x22f7fb[_0x58facf(0x20a)]()),_0x41f733=Buffer[_0x58facf(0x145)](_0xe14ba6['key'],'base64'),_0x34f7a3=Buffer['from'](_0xe14ba6['iv'],'base64');return this[_0x58facf(0x18e)](_0x4ba5bd,_0x41f733,_0x34f7a3);}catch(_0x151347){throw new Error(_0x58facf(0x180));}}async[a43_0x22bbaf(0x1a9)](_0x110b61){const _0xa3e911=a43_0x22bbaf,{paymentId:_0x135028,orderId:_0x2ade83,amount:_0x185b4e,currency:_0x10225d,cardData:_0x44ea8e,resultUrl:_0x282ca6,returnUrl:_0x365e09,cardHolder:_0x383064,browser:_0x1ad827}=_0x110b61;console[_0xa3e911(0x1d7)](_0xa3e911(0x227)),console[_0xa3e911(0x1d7)]('Payment\x20ID:',_0x135028),console[_0xa3e911(0x1d7)](_0xa3e911(0x231),_0x2ade83),console[_0xa3e911(0x1d7)]('Amount:',_0x185b4e,_0x10225d),console[_0xa3e911(0x1d7)](_0xa3e911(0x20d),this[_0xa3e911(0x18b)](_0x44ea8e[_0xa3e911(0x221)])),console['log']('Card\x20Holder:',_0x383064[_0xa3e911(0x1dc)]+'\x20'+_0x383064[_0xa3e911(0x232)]),console[_0xa3e911(0x1d7)](_0xa3e911(0x195),_0x365e09),console[_0xa3e911(0x1d7)](_0xa3e911(0x1d6),_0x282ca6);const _0x5954ee={'amount':_0x185b4e,'currency':_0x10225d[_0xa3e911(0x1c1)](),'order_id':_0x2ade83,'result_url':_0x282ca6,'return_url':_0x365e09,'country':'','card':{'number':_0x44ea8e['number'],'expire_month':_0x44ea8e[_0xa3e911(0x235)],'expire_year':_0x44ea8e[_0xa3e911(0x1e5)],'cvv':_0x44ea8e[_0xa3e911(0x1fe)]},'card_holder':_0x383064,'browser':_0x1ad827},_0x50196f=JSON[_0xa3e911(0x143)](_0x5954ee);console[_0xa3e911(0x1d7)](_0xa3e911(0x14a)),console[_0xa3e911(0x1d7)](_0xa3e911(0x157)),console['log'](_0x50196f),console[_0xa3e911(0x1d7)]('📝\x20Data\x20length:',_0x50196f[_0xa3e911(0x239)]);try{const {key:_0x3045e7,iv:_0x187a1f}=this['generateAESKey']();console['log'](_0xa3e911(0x1f2)),console[_0xa3e911(0x1d7)](_0xa3e911(0x161),_0x3045e7[_0xa3e911(0x239)]),console[_0xa3e911(0x1d7)]('🔐\x20AES\x20IV\x20length:',_0x187a1f['length']);const _0x4d136f=this[_0xa3e911(0x18f)](_0x50196f,_0x3045e7,_0x187a1f);console[_0xa3e911(0x1d7)](_0xa3e911(0x17c)),console['log']('📝\x20Encrypted\x20data\x20length:',_0x4d136f[_0xa3e911(0x239)]);const _0x1e5e1f=this[_0xa3e911(0x200)](_0x3045e7,_0x187a1f);console[_0xa3e911(0x1d7)](_0xa3e911(0x192)),console[_0xa3e911(0x1d7)](_0xa3e911(0x197),_0x1e5e1f[_0xa3e911(0x239)]);const _0xccf1e4=this[_0xa3e911(0x1cb)](_0x50196f);console[_0xa3e911(0x1d7)](_0xa3e911(0x154)),console[_0xa3e911(0x1d7)](_0xa3e911(0x183),_0xccf1e4[_0xa3e911(0x239)]);const _0x2063ed={'merchant_point_id':this[_0xa3e911(0x1fb)],'method':_0xa3e911(0x199),'info':_0x4d136f,'key':_0x1e5e1f,'sign':_0xccf1e4,'lang':'en'};console[_0xa3e911(0x1d7)]('📤\x20Sending\x20request\x20to\x20MasterCard\x20API...'),console[_0xa3e911(0x1d7)](_0xa3e911(0x14b)),console[_0xa3e911(0x1d7)](_0xa3e911(0x1b0),this[_0xa3e911(0x1fb)]),console['log'](_0xa3e911(0x19e)),console['log'](_0xa3e911(0x1dd),_0x4d136f[_0xa3e911(0x239)]),console[_0xa3e911(0x1d7)](_0xa3e911(0x1bb),_0x1e5e1f[_0xa3e911(0x239)]),console[_0xa3e911(0x1d7)]('\x20\x20\x20-\x20sign\x20length:',_0xccf1e4[_0xa3e911(0x239)]),console[_0xa3e911(0x1d7)](_0xa3e911(0x147)),loggerService_1[_0xa3e911(0x173)][_0xa3e911(0x1c0)]('mastercard','/charge',_0xa3e911(0x209),{'merchant_point_id':this[_0xa3e911(0x1fb)],'method':_0xa3e911(0x199),'lang':'en'});const _0x248220=Date[_0xa3e911(0x236)](),_0x3e4c19=await fetch(this[_0xa3e911(0x1d4)],{'method':_0xa3e911(0x209),'headers':{'Content-Type':_0xa3e911(0x1d9),'Accept':_0xa3e911(0x1d9),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x2063ed)}),_0xcc7c3c=Date[_0xa3e911(0x236)]()-_0x248220;console[_0xa3e911(0x1d7)]('===\x20MASTERCARD\x20API\x20RESPONSE\x20==='),console[_0xa3e911(0x1d7)](_0xa3e911(0x212),_0x3e4c19[_0xa3e911(0x1e6)]),console[_0xa3e911(0x1d7)]('Response\x20Time:',_0xcc7c3c+'ms');if(!_0x3e4c19['ok']){const _0x19d7a3=await _0x3e4c19[_0xa3e911(0x19f)]();console['error'](_0xa3e911(0x140),_0x3e4c19[_0xa3e911(0x1e6)]),console[_0xa3e911(0x22a)](_0xa3e911(0x1eb),_0x19d7a3),loggerService_1[_0xa3e911(0x173)]['logWhiteDomainResponse'](_0xa3e911(0x162),'/charge_raw',_0x3e4c19[_0xa3e911(0x1e6)],_0x19d7a3,_0xcc7c3c),loggerService_1['loggerService'][_0xa3e911(0x1f5)](_0xa3e911(0x162),_0xa3e911(0x15a),_0xa3e911(0x169)+_0x3e4c19[_0xa3e911(0x1e6)]+':\x20'+_0x19d7a3);throw new Error(_0xa3e911(0x1c5)+_0x3e4c19[_0xa3e911(0x1e6)]+',\x20body:\x20'+_0x19d7a3);}const _0x30aa85=await _0x3e4c19['json']();loggerService_1[_0xa3e911(0x173)][_0xa3e911(0x1a8)](_0xa3e911(0x162),_0xa3e911(0x222),_0x3e4c19['status'],_0x30aa85,_0xcc7c3c),console[_0xa3e911(0x1d7)]('===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===');let _0x5c9ffa=_0x30aa85;if(_0x30aa85[_0xa3e911(0x1d1)]&&_0x30aa85[_0xa3e911(0x1f8)]&&_0x30aa85[_0xa3e911(0x1d5)]){console[_0xa3e911(0x1d7)](_0xa3e911(0x202));try{const _0x33c66d=await this[_0xa3e911(0x1fa)](_0x30aa85[_0xa3e911(0x1d1)],_0x30aa85[_0xa3e911(0x1f8)]);_0x5c9ffa=JSON['parse'](_0x33c66d),console['log'](_0xa3e911(0x19c)),loggerService_1[_0xa3e911(0x173)][_0xa3e911(0x1a8)](_0xa3e911(0x162),'/charge_decrypted',_0x3e4c19[_0xa3e911(0x1e6)],_0x5c9ffa,_0xcc7c3c),console['log']('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x181764){console[_0xa3e911(0x22a)](_0xa3e911(0x1be),_0x181764),loggerService_1[_0xa3e911(0x173)][_0xa3e911(0x1f5)](_0xa3e911(0x162),'/charge_decrypt',_0xa3e911(0x1b8)+_0x181764),_0x5c9ffa=_0x30aa85;}}else loggerService_1[_0xa3e911(0x173)]['logWhiteDomainResponse']('mastercard',_0xa3e911(0x1b6),_0x3e4c19[_0xa3e911(0x1e6)],_0x5c9ffa,_0xcc7c3c),console['log'](_0xa3e911(0x21a));console[_0xa3e911(0x1d7)](_0xa3e911(0x212),_0x5c9ffa[_0xa3e911(0x1e6)]),console[_0xa3e911(0x1d7)]('Final:',_0x5c9ffa[_0xa3e911(0x158)]),console[_0xa3e911(0x1d7)](_0xa3e911(0x1e0),_0x5c9ffa[_0xa3e911(0x16d)]),console[_0xa3e911(0x1d7)]('3DS\x20URL:',_0x5c9ffa['3ds_url']||_0xa3e911(0x1ce));if(_0x5c9ffa[_0xa3e911(0x1e6)]===0x64&&_0x5c9ffa[_0xa3e911(0x158)]===0x1)return console[_0xa3e911(0x1d7)](_0xa3e911(0x155)),{'gateway_payment_id':_0x5c9ffa['payment_id']?.['toString'](),'payment_url':_0x365e09,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x5c9ffa[_0xa3e911(0x20b)])return console['log']('🔐\x203DS\x20verification\x20required'),this[_0xa3e911(0x144)](_0x135028,_0x2ade83,_0x5c9ffa[_0xa3e911(0x16d)]?.[_0xa3e911(0x20a)]()||_0x2ade83),{'gateway_payment_id':_0x5c9ffa[_0xa3e911(0x16d)]?.[_0xa3e911(0x20a)](),'payment_url':_0x5c9ffa[_0xa3e911(0x20b)],'requires_3ds':!![],'threeds_url':_0x5c9ffa[_0xa3e911(0x20b)],'status':_0xa3e911(0x1ef),'final':![]};let _0x14c6a2=_0x5c9ffa['desc']||_0x5c9ffa[_0xa3e911(0x142)]||_0xa3e911(0x225),_0xb27ff4=_0x5c9ffa[_0xa3e911(0x1e6)],_0x10bef8=_0x5c9ffa[_0xa3e911(0x158)];return console[_0xa3e911(0x1d7)]('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0xb27ff4+_0xa3e911(0x1bc)+_0x10bef8+_0xa3e911(0x1ec)+_0x14c6a2),{'gateway_payment_id':_0x5c9ffa[_0xa3e911(0x16d)]?.[_0xa3e911(0x20a)](),'payment_url':_0x365e09,'requires_3ds':![],'status':_0xa3e911(0x204),'final':!![]};}catch(_0x39752d){console[_0xa3e911(0x22a)](_0xa3e911(0x216)),console[_0xa3e911(0x22a)](_0xa3e911(0x14c),_0x39752d),loggerService_1[_0xa3e911(0x173)][_0xa3e911(0x1f5)](_0xa3e911(0x162),'/charge',_0x39752d);throw new Error('Failed\x20to\x20process\x20MasterCard\x20payment:\x20'+(_0x39752d instanceof Error?_0x39752d[_0xa3e911(0x142)]:_0xa3e911(0x225)));}}async['checkPaymentStatus'](_0x1d3246,_0x3c72c8){const _0x1206e0=a43_0x22bbaf;console[_0x1206e0(0x1d7)](_0x1206e0(0x181)+_0x1d3246+'\x20('+_0x3c72c8+')');try{const _0xd3dba1={'payment_id':_0x1d3246,'order_id':_0x3c72c8},_0x1c9c49=JSON[_0x1206e0(0x143)](_0xd3dba1),{key:_0x52f799,iv:_0x4ae772}=this[_0x1206e0(0x159)](),_0x4bd4c7=this[_0x1206e0(0x18f)](_0x1c9c49,_0x52f799,_0x4ae772),_0x567224=this[_0x1206e0(0x200)](_0x52f799,_0x4ae772),_0x553be7=this[_0x1206e0(0x1cb)](_0x1c9c49),_0x3d4b5d={'merchant_point_id':this['merchantPointId'],'method':_0x1206e0(0x1e6),'info':_0x4bd4c7,'key':_0x567224,'sign':_0x553be7,'lang':'en'};loggerService_1[_0x1206e0(0x173)][_0x1206e0(0x1c0)](_0x1206e0(0x162),'/status','POST',{'merchant_point_id':this[_0x1206e0(0x1fb)],'method':_0x1206e0(0x1e6),'lang':'en'});const _0x52f6cb=Date['now'](),_0x26f18e=await fetch(this[_0x1206e0(0x1d4)],{'method':_0x1206e0(0x209),'headers':{'Content-Type':_0x1206e0(0x1d9),'Accept':_0x1206e0(0x1d9),'User-Agent':_0x1206e0(0x1f4)},'body':JSON[_0x1206e0(0x143)](_0x3d4b5d)}),_0x38624a=Date['now']()-_0x52f6cb;if(!_0x26f18e['ok']){const _0x4315ef=await _0x26f18e[_0x1206e0(0x19f)]();loggerService_1[_0x1206e0(0x173)][_0x1206e0(0x1a8)]('mastercard',_0x1206e0(0x14e),_0x26f18e[_0x1206e0(0x1e6)],_0x4315ef,_0x38624a);throw new Error('HTTP\x20error!\x20status:\x20'+_0x26f18e[_0x1206e0(0x1e6)]);}const _0x15b202=await _0x26f18e[_0x1206e0(0x1d3)]();loggerService_1[_0x1206e0(0x173)][_0x1206e0(0x1a8)](_0x1206e0(0x162),'/status_raw',_0x26f18e['status'],_0x15b202,_0x38624a);let _0x11563c=_0x15b202;if(_0x15b202[_0x1206e0(0x1d1)]&&_0x15b202[_0x1206e0(0x1f8)]&&_0x15b202[_0x1206e0(0x1d5)]){console[_0x1206e0(0x1d7)]('🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0x111753=this[_0x1206e0(0x1fc)](_0x15b202[_0x1206e0(0x1d1)],_0x15b202[_0x1206e0(0x1f8)]);_0x11563c=JSON[_0x1206e0(0x168)](_0x111753),console['log'](_0x1206e0(0x1ba)),loggerService_1[_0x1206e0(0x173)]['logWhiteDomainResponse'](_0x1206e0(0x162),_0x1206e0(0x16e),_0x26f18e[_0x1206e0(0x1e6)],_0x11563c,_0x38624a),console[_0x1206e0(0x1d7)](_0x1206e0(0x22f));}catch(_0x2ed78d){console[_0x1206e0(0x22a)](_0x1206e0(0x176),_0x2ed78d),loggerService_1[_0x1206e0(0x173)][_0x1206e0(0x1f5)](_0x1206e0(0x162),_0x1206e0(0x148),_0x1206e0(0x1af)+_0x2ed78d),_0x11563c=_0x15b202;}}else loggerService_1['loggerService'][_0x1206e0(0x1a8)]('mastercard',_0x1206e0(0x16e),_0x26f18e['status'],_0x11563c,_0x38624a),console['log'](_0x1206e0(0x229));console[_0x1206e0(0x1d7)](_0x1206e0(0x1b5),{'status':_0x11563c['status'],'final':_0x11563c[_0x1206e0(0x158)],'payment_id':_0x11563c[_0x1206e0(0x16d)],'desc':_0x11563c[_0x1206e0(0x230)]});let _0x37edf1='PENDING';if(_0x11563c['status']===0x1&&_0x11563c[_0x1206e0(0x158)]===0x1)_0x37edf1='PAID';else _0x11563c['status']===0x0&&_0x11563c[_0x1206e0(0x158)]===0x0?_0x37edf1='PENDING':_0x37edf1=_0x1206e0(0x204);return{'status':_0x37edf1,'final':_0x11563c[_0x1206e0(0x158)]===0x1,'amount':_0x11563c['amount'],'currency':_0x11563c[_0x1206e0(0x178)],'date_success':_0x11563c['date_success'],'description':_0x11563c[_0x1206e0(0x230)]};}catch(_0x291818){console['error'](_0x1206e0(0x22b),_0x291818),loggerService_1[_0x1206e0(0x173)][_0x1206e0(0x1f5)](_0x1206e0(0x162),_0x1206e0(0x1cf),_0x291818);throw new Error(_0x1206e0(0x1e7)+(_0x291818 instanceof Error?_0x291818[_0x1206e0(0x142)]:_0x1206e0(0x225)));}}[a43_0x22bbaf(0x144)](_0xf1d7e9,_0x3c8dad,_0x44fce7){const _0x4561d8=a43_0x22bbaf;console[_0x4561d8(0x1d7)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0xf1d7e9+'\x20('+_0x44fce7+')'),this[_0x4561d8(0x234)](_0xf1d7e9);const _0x2a6417=[],_0x304283=0x5*0x3c*0x3e8,_0x382dda=0x2*0x3c*0x3c*0x3e8,_0x836a37=Math[_0x4561d8(0x1f0)](_0x382dda/_0x304283);console[_0x4561d8(0x1d7)](_0x4561d8(0x146)+_0x836a37+_0x4561d8(0x1cd));for(let _0x455352=0x1;_0x455352<=_0x836a37;_0x455352++){const _0x1b000e=setTimeout(async()=>{const _0x23ba23=_0x4561d8;console[_0x23ba23(0x1d7)]('🔍\x20MasterCard\x20status\x20check\x20#'+_0x455352+'/'+_0x836a37+_0x23ba23(0x233)+_0xf1d7e9);try{const _0x23f342=await this[_0x23ba23(0x184)](_0x44fce7,_0x3c8dad);console['log'](_0x23ba23(0x1ac)+_0x455352+_0x23ba23(0x1c4),_0x23f342),_0x23f342[_0x23ba23(0x158)]&&(console[_0x23ba23(0x1d7)](_0x23ba23(0x1e8)+_0xf1d7e9+_0x23ba23(0x1ab)+_0x23f342['status']+'),\x20stopping\x20status\x20checks'),this[_0x23ba23(0x234)](_0xf1d7e9),await this[_0x23ba23(0x167)](_0xf1d7e9,_0x23f342[_0x23ba23(0x1e6)],_0x23f342));}catch(_0x4aa8ce){console[_0x23ba23(0x22a)](_0x23ba23(0x190)+_0x455352+_0x23ba23(0x238)+_0xf1d7e9+':',_0x4aa8ce);}},_0x455352*_0x304283);_0x2a6417[_0x4561d8(0x14d)](_0x1b000e);}this['statusCheckTimers'][_0x4561d8(0x17f)](_0xf1d7e9,_0x2a6417),console[_0x4561d8(0x1d7)](_0x4561d8(0x153)+_0x836a37+_0x4561d8(0x20f)+_0xf1d7e9);}['clearStatusTimers'](_0x315a7f){const _0x360aa2=a43_0x22bbaf,_0x288454=this[_0x360aa2(0x228)]['get'](_0x315a7f);_0x288454&&(console[_0x360aa2(0x1d7)](_0x360aa2(0x1a0)+_0x288454[_0x360aa2(0x239)]+_0x360aa2(0x13e)+_0x315a7f),_0x288454[_0x360aa2(0x23b)]((_0xc3983c,_0x3f73f5)=>{clearTimeout(_0xc3983c);}),this[_0x360aa2(0x228)][_0x360aa2(0x186)](_0x315a7f));}async['updatePaymentStatus'](_0x2117fa,_0x1e6115,_0x358732){const _0x3f1aa1=a43_0x22bbaf;try{const _0x12bd1e=(await Promise['resolve']()[_0x3f1aa1(0x17e)](()=>__importStar(require(_0x3f1aa1(0x1c7)))))['default'],_0x4341e1={'status':_0x1e6115[_0x3f1aa1(0x1c1)](),'updatedAt':new Date(),'statusChangedBy':_0x3f1aa1(0x150),'statusChangedAt':new Date()};_0x1e6115===_0x3f1aa1(0x171)&&(_0x4341e1[_0x3f1aa1(0x1d2)]=new Date()),_0x358732[_0x3f1aa1(0x1c2)]&&(_0x4341e1[_0x3f1aa1(0x16c)]=_0x3f1aa1(0x15c)+_0x358732[_0x3f1aa1(0x1c2)]),await _0x12bd1e[_0x3f1aa1(0x174)][_0x3f1aa1(0x160)]({'where':{'id':_0x2117fa},'data':_0x4341e1}),console[_0x3f1aa1(0x1d7)]('✅\x20Payment\x20'+_0x2117fa+'\x20status\x20updated\x20to\x20'+_0x1e6115),await this['sendPaymentNotifications'](_0x2117fa,_0x1e6115);}catch(_0x34a909){console[_0x3f1aa1(0x22a)]('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x2117fa+':',_0x34a909);}}async[a43_0x22bbaf(0x188)](_0x485328,_0xa9fcbe){const _0x458ebf=a43_0x22bbaf;try{const _0x326f99=(await Promise[_0x458ebf(0x21d)]()['then'](()=>__importStar(require(_0x458ebf(0x1c7)))))[_0x458ebf(0x19b)],{telegramBotService:_0x1160d8}=await Promise[_0x458ebf(0x21d)]()[_0x458ebf(0x17e)](()=>__importStar(require(_0x458ebf(0x23a)))),_0x4d80ae=await _0x326f99[_0x458ebf(0x174)][_0x458ebf(0x15f)]({'where':{'id':_0x485328},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x4d80ae)return;const _0x369656={'PAID':'paid','FAILED':_0x458ebf(0x152)},_0x5f8124=_0x369656[_0xa9fcbe];_0x5f8124&&await _0x1160d8[_0x458ebf(0x175)](_0x4d80ae[_0x458ebf(0x1ff)],_0x4d80ae,_0x5f8124),await this[_0x458ebf(0x1d0)](_0x4d80ae,_0xa9fcbe);}catch(_0x20247a){console[_0x458ebf(0x22a)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x20247a);}}async[a43_0x22bbaf(0x1d0)](_0x446d92,_0x5c5975){const _0x444918=a43_0x22bbaf,_0x3b5fd4=Date[_0x444918(0x236)]();try{const _0x212b91=_0x446d92['shop'],_0xa79b41=_0x212b91[_0x444918(0x15e)];if(!_0xa79b41?.[_0x444918(0x1fd)]){console[_0x444918(0x1d7)](_0x444918(0x22d)+_0x212b91['id']);return;}const _0x166206=_0x5c5975==='PAID'?_0x444918(0x1ca):_0x444918(0x1db);let _0x1aed2d=[];if(_0xa79b41[_0x444918(0x1bd)])try{_0x1aed2d=Array[_0x444918(0x194)](_0xa79b41[_0x444918(0x1bd)])?_0xa79b41[_0x444918(0x1bd)]:JSON['parse'](_0xa79b41[_0x444918(0x1bd)]);}catch(_0x7a7420){console[_0x444918(0x22a)]('Error\x20parsing\x20webhook\x20events:',_0x7a7420),_0x1aed2d=[];}if(!_0x1aed2d[_0x444918(0x17d)](_0x166206)){console[_0x444918(0x1d7)](_0x444918(0x20c)+_0x166206+'\x20not\x20enabled\x20for\x20shop\x20'+_0x212b91['id']);return;}const _0x1a512b={'event':_0x166206,'payment':{'id':_0x446d92['id'],'order_id':_0x446d92[_0x444918(0x21e)],'gateway_order_id':_0x446d92['gatewayOrderId'],'gateway':_0x444918(0x1a4),'amount':_0x446d92[_0x444918(0x219)],'currency':_0x446d92['currency'],'status':_0x5c5975[_0x444918(0x218)](),'customer_email':_0x446d92[_0x444918(0x182)],'customer_name':_0x446d92['customerName'],'created_at':_0x446d92['createdAt'],'updated_at':new Date()}},_0x805a78=await fetch(_0xa79b41[_0x444918(0x1fd)],{'method':_0x444918(0x209),'headers':{'Content-Type':_0x444918(0x1d9),'User-Agent':_0x444918(0x1f7)},'body':JSON[_0x444918(0x143)](_0x1a512b)}),_0x42eb96=Date[_0x444918(0x236)]()-_0x3b5fd4;loggerService_1['loggerService']['logShopWebhookSent'](_0x446d92[_0x444918(0x1ff)],_0xa79b41['webhookUrl'],_0x166206,_0x805a78[_0x444918(0x1e6)],_0x42eb96,_0x1a512b),console['log'](_0x444918(0x149)+_0xa79b41[_0x444918(0x1fd)]+_0x444918(0x15b)+_0x805a78[_0x444918(0x1e6)]+'\x20('+_0x42eb96+_0x444918(0x203));}catch(_0x3fe84){console[_0x444918(0x22a)](_0x444918(0x1b3),_0x3fe84),loggerService_1[_0x444918(0x173)]['logShopWebhookError'](_0x446d92['shopId'],_0x446d92['shop']?.[_0x444918(0x15e)]?.[_0x444918(0x1fd)]||_0x444918(0x1ad),_0x444918(0x1a7),_0x3fe84,{});}}['maskCardNumber'](_0x315b92){const _0x1dd9d5=a43_0x22bbaf,_0x5d4a82=_0x315b92[_0x1dd9d5(0x17a)](/[\s-]/g,'');if(_0x5d4a82['length']<0x4)return _0x1dd9d5(0x1e2);return _0x1dd9d5(0x19d)+_0x5d4a82[_0x1dd9d5(0x18a)](-0x4);}async['processWebhook'](_0x23d65f){const _0x51177b=a43_0x22bbaf;console[_0x51177b(0x1d7)]('🔄\x20Processing\x20MasterCard\x20webhook\x20data:',JSON['stringify'](_0x23d65f,null,0x2));let _0x27db2b=_0x51177b(0x1ef);if(_0x23d65f['status']===0x1&&_0x23d65f['final']===0x1)_0x27db2b=_0x51177b(0x171);else _0x23d65f['status']===0x0&&_0x23d65f[_0x51177b(0x158)]===0x0?_0x27db2b=_0x51177b(0x1ef):_0x27db2b=_0x51177b(0x204);const _0x9fbb5e=_0x23d65f[_0x51177b(0x22e)]||_0x23d65f[_0x51177b(0x21e)]||_0x23d65f['payment_id']||_0x23d65f[_0x51177b(0x1ee)]||_0x23d65f['id']||'';return console[_0x51177b(0x1d7)]('📊\x20MasterCard\x20webhook\x20extracted\x20data:'),console['log']('\x20\x20\x20Payment\x20ID:\x20'+_0x9fbb5e+_0x51177b(0x185)+_0x23d65f[_0x51177b(0x22e)]+_0x51177b(0x223)+_0x23d65f[_0x51177b(0x21e)]+_0x51177b(0x189)+_0x23d65f['payment_id']+_0x51177b(0x177)+_0x23d65f[_0x51177b(0x1ee)]+_0x51177b(0x205)+_0x23d65f['id']+')'),console['log']('\x20\x20\x20Status:\x20'+_0x27db2b+_0x51177b(0x208)+_0x23d65f['status']+_0x51177b(0x215)+_0x23d65f[_0x51177b(0x158)]+')'),console[_0x51177b(0x1d7)]('\x20\x20\x20Amount:\x20'+_0x23d65f[_0x51177b(0x219)]),console['log'](_0x51177b(0x1f9)+_0x23d65f[_0x51177b(0x178)]),{'paymentId':_0x9fbb5e,'status':_0x27db2b,'amount':_0x23d65f['amount'],'currency':_0x23d65f['currency']};}[a43_0x22bbaf(0x1de)](){const _0x2d0165=a43_0x22bbaf;console['log'](_0x2d0165(0x1b2));const _0x1a4d4d=this[_0x2d0165(0x228)][_0x2d0165(0x1cc)];for(const [_0x186111]of this['statusCheckTimers']){this[_0x2d0165(0x234)](_0x186111);}console[_0x2d0165(0x1d7)](_0x2d0165(0x1c6)+_0x1a4d4d+_0x2d0165(0x1e9));}}exports[a43_0x22bbaf(0x164)]=MasterCardService;