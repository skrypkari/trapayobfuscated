'use strict';const a46_0x19c01b=a46_0x49a0;function a46_0x49a0(_0x4cb2e0,_0x52cf40){const _0x595e5d=a46_0x595e();return a46_0x49a0=function(_0x49a07e,_0x597e6a){_0x49a07e=_0x49a07e-0x12a;let _0x5a2440=_0x595e5d[_0x49a07e];return _0x5a2440;},a46_0x49a0(_0x4cb2e0,_0x52cf40);}(function(_0x463b68,_0x2baa7e){const _0x2daca1=a46_0x49a0,_0x1aab14=_0x463b68();while(!![]){try{const _0x311d98=parseInt(_0x2daca1(0x14d))/0x1*(parseInt(_0x2daca1(0x1e7))/0x2)+-parseInt(_0x2daca1(0x196))/0x3+parseInt(_0x2daca1(0x1c2))/0x4*(-parseInt(_0x2daca1(0x249))/0x5)+-parseInt(_0x2daca1(0x240))/0x6+parseInt(_0x2daca1(0x211))/0x7+parseInt(_0x2daca1(0x133))/0x8+parseInt(_0x2daca1(0x1b5))/0x9*(parseInt(_0x2daca1(0x149))/0xa);if(_0x311d98===_0x2baa7e)break;else _0x1aab14['push'](_0x1aab14['shift']());}catch(_0x2bead2){_0x1aab14['push'](_0x1aab14['shift']());}}}(a46_0x595e,0x3762d));var __createBinding=this&&this['__createBinding']||(Object[a46_0x19c01b(0x146)]?function(_0x56eaf0,_0x28e952,_0x501aff,_0x258af4){const _0x2ed67f=a46_0x19c01b;if(_0x258af4===undefined)_0x258af4=_0x501aff;var _0x24cadd=Object['getOwnPropertyDescriptor'](_0x28e952,_0x501aff);(!_0x24cadd||(_0x2ed67f(0x1e1)in _0x24cadd?!_0x28e952[_0x2ed67f(0x16f)]:_0x24cadd[_0x2ed67f(0x1fc)]||_0x24cadd['configurable']))&&(_0x24cadd={'enumerable':!![],'get':function(){return _0x28e952[_0x501aff];}}),Object['defineProperty'](_0x56eaf0,_0x258af4,_0x24cadd);}:function(_0x4f4367,_0x46cf02,_0x5316c1,_0x1817b6){if(_0x1817b6===undefined)_0x1817b6=_0x5316c1;_0x4f4367[_0x1817b6]=_0x46cf02[_0x5316c1];}),__setModuleDefault=this&&this[a46_0x19c01b(0x198)]||(Object[a46_0x19c01b(0x146)]?function(_0x5e182f,_0x4eb507){const _0x15f8b3=a46_0x19c01b;Object['defineProperty'](_0x5e182f,_0x15f8b3(0x182),{'enumerable':!![],'value':_0x4eb507});}:function(_0x482370,_0x45ae00){_0x482370['default']=_0x45ae00;}),__importStar=this&&this[a46_0x19c01b(0x1d4)]||(function(){var _0x368fa3=function(_0x397108){const _0xba51e3=a46_0x49a0;return _0x368fa3=Object[_0xba51e3(0x151)]||function(_0x3cfc4b){const _0x4f2e08=_0xba51e3;var _0x540480=[];for(var _0x5e5aac in _0x3cfc4b)if(Object[_0x4f2e08(0x220)][_0x4f2e08(0x16e)][_0x4f2e08(0x17b)](_0x3cfc4b,_0x5e5aac))_0x540480[_0x540480[_0x4f2e08(0x1c3)]]=_0x5e5aac;return _0x540480;},_0x368fa3(_0x397108);};return function(_0x3d499b){const _0x26143e=a46_0x49a0;if(_0x3d499b&&_0x3d499b[_0x26143e(0x16f)])return _0x3d499b;var _0x4ecb7c={};if(_0x3d499b!=null){for(var _0x26f0ed=_0x368fa3(_0x3d499b),_0x239c27=0x0;_0x239c27<_0x26f0ed[_0x26143e(0x1c3)];_0x239c27++)if(_0x26f0ed[_0x239c27]!==_0x26143e(0x182))__createBinding(_0x4ecb7c,_0x3d499b,_0x26f0ed[_0x239c27]);}return __setModuleDefault(_0x4ecb7c,_0x3d499b),_0x4ecb7c;};}()),__importDefault=this&&this[a46_0x19c01b(0x1ec)]||function(_0xf8c615){return _0xf8c615&&_0xf8c615['__esModule']?_0xf8c615:{'default':_0xf8c615};};Object[a46_0x19c01b(0x21c)](exports,a46_0x19c01b(0x16f),{'value':!![]}),exports[a46_0x19c01b(0x13a)]=void 0x0;function a46_0x595e(){const _0x4252a5=['constants','shop','sign','status',',\x20orderId=','📤\x20Sending\x20request\x20to\x20API...','error','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','\x20for\x20payment\x20','randomBytes','\x20MasterCard\x20status\x20check\x20timers','encryptAES','⏰\x20Will\x20check\x20status\x20','Card\x20Holder:','\x20payment\x20status:\x20','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','🔐\x20MasterCard\x20Public\x20key\x20path:','\x20API:\x20','key','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','amount','card_type','\x20status\x20check\x20#','psp_public.pem','description','\x20\x20\x20-\x20info\x20length:','\x20\x20\x20-\x20lang:\x20en','🔐\x20VISA\x20Public\x20key\x20path:','date_success','🔐\x20RSA\x20signing\x20successful','643650YgTKGQ','📊\x20Status\x20check\x20#','📝\x20Signature\x20length:','webhookUrl','log','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','\x20payment_id\x20for\x20search:\x20','RSA_PKCS1_PADDING','keys','105IyyhSf','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','sendPaymentNotification','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','floor','📝\x20Final\x20request\x20structure:','🔐\x203DS\x20verification\x20required','cvv','🔐\x20MasterCard\x20Private\x20key\x20path:','-----BEGIN','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','Status\x20decryption\x20failed:\x20','💳\x20VISA/MasterCard\x20service\x20initialized','path','isArray','✅\x20Status\x20response\x20decrypted\x20successfully','decryptResponsePhp','3DS\x20URL:','🔍\x20Using\x20provided\x20card\x20type:\x20','\x20result:','createSign','privateKeyPath','update','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','Error\x20details:','Payment\x20ID:','863016lUddWg','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','scheduleStatusChecks','sendShopWebhook','⏰\x20Scheduling\x20status\x20checks\x20for\x20','charge','validateKeyFiles','VisaMasterCardService','expire_month','❌\x20PHP\x20decryptor\x20request\x20failed:','generateAESKey','resolve','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','toLowerCase','paidAt','4000000000000000','-----END','masterCardApiUrl','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','create','logWhiteDomainResponse','❌\x20Status\x20check\x20#','1253210UMQUkL','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','\x20not\x20enabled\x20for\x20shop\x20','publicEncrypt','46863qDPqgq','parse','SHA256','application/json','getOwnPropertyNames','PENDING','warn','\x20failed\x20for\x20payment\x20','cardType','createDecipheriv','paid','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','../../config/database','VISA','order_id','📝\x20Encrypted\x20data\x20length:','maskCardNumber','📝\x20Decrypted\x20webhook\x20data:','slice','checkPaymentStatus','\x20payment:\x20','expire_year','🔐\x20VISA\x20Private\x20key\x20path:','PHP\x20decryptor\x20error','payment_id','settings','Failed\x20to\x20decrypt\x20response','signRSA','1111','\x20\x20\x20Amount:\x20','encryptRSA','/status_decrypt','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','hasOwnProperty','__esModule','toString','\x20\x20\x20Status:\x20','logShopWebhookSent','\x20\x20\x20-\x20method:\x20charge','desc','📝\x20Encrypted\x20key\x20length:','stringify','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','Failed\x20to\x20check\x20','clearStatusTimers','HTTP\x20','call','Final:','json','Unknown\x20error','PAID','TesSoft\x20Payment\x20System/1.0','decryptResponse','default','visaPublicKeyPath','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20',',\x20body:\x20','\x20status\x20check\x20error:',',\x20final=','/status','now','visaApiUrl','createdAt','includes','join','failed','===\x20PARSED\x20API\x20RESPONSE\x20===','processWebhook','===\x20API\x20RESPONSE\x20===','https://api.paydmeth.com/api','🔐\x20AES\x20IV\x20length:','POST','1130958KdZLri',',\x20paymentId=','__setModuleDefault','cwd','Amount:','\x20status\x20timers\x20for\x20payment\x20','❌\x20RSA\x20encryption\x20failed:','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','findUnique',',\x20id=','currency','trim','decryptAES','privateDecrypt','payment.failed','****\x20****\x20****\x20','aes-256-ctr','5000000000000000','MASTERCARD','adminNotes','/status_decrypted','/charge_decrypt','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','statusCheckTimers','\x20\x20\x20-\x20merchant_point_id:','loggerService','number','3ds_url','🔍\x20Using\x20','Response\x20Body:','updatePaymentStatus','45MRaXOS','forEach','❌\x20Data\x20being\x20signed:','Response\x20Time:','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','FAILED','visa_public.pem','),\x20defaulting\x20to\x20MasterCard','sendPaymentNotifications','logWhiteDomainRequest','final','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','then','32936Wonaji','length','✅\x20Scheduled\x20','charAt','createCipheriv','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','failureMessage','visa_private.pem','🔐\x20AES\x20key\x20and\x20IV\x20generated','payment.success','\x20(from:\x20order_id=','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','Order\x20ID:','readFileSync','getCardTypeAndApi','orderId','Card\x20Number:','system','__importStar','/charge_decrypted','message','base64','info','customerName','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','size','stopAllStatusChecks','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','📊\x20','\x20status\x20checks\x20for\x20payment\x20','gatewayOrderId','get','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','text','✅\x20Payment\x20successful','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','logWhiteDomainError','4UvamAj',',\x20Final:\x20','/charge','payment','),\x20stopping\x20status\x20checks','__importDefault','utf8','🔐\x20Data\x20encrypted\x20with\x20AES',',\x20Desc:\x20','from','publicKeyPath','HTTP\x20Status:','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','\x20\x20\x20-\x20key\x20length:','https://api2.trapay.uk/decrypt.php','Error\x20parsing\x20webhook\x20events:','customerEmail','\x20characters','📊\x20Checking\x20','ms)','merchantPointId','writable','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','delete','../loggerService','last_name','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','VISA/MasterCard\x20payment\x20successful','💾\x20Saving\x20failure\x20message:\x20','🔍\x20','set','🔐\x20MasterCard\x20API\x20URL:','✅\x20VISA\x20key\x20files\x20validated\x20successfully','/status_raw','✅\x20Payment\x20','📝\x20Data\x20to\x20sign\x20length:','🎯\x20Using\x20','shopId','toUpperCase','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','first_name','visaMerchantPointId','390796uASGnW','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','existsSync','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','\x20status\x20updated\x20to\x20','visaPrivateKeyPath','visa/mastercard','❌\x20Failure\x20description:\x20','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','defineProperty','HTTP\x20error!\x20status:\x20','📝\x20Data\x20length:','paymentId','prototype','apiUrl'];a46_0x595e=function(){return _0x4252a5;};return a46_0x595e();}const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a46_0x19c01b(0x256))),loggerService_1=require(a46_0x19c01b(0x1ff));class VisaMasterCardService{constructor(){const _0x14877d=a46_0x19c01b;this['statusCheckTimers']=new Map(),this['masterCardApiUrl']='https://api.paydmeth.com/api',this['masterCardMerchantPointId']=0x6a7,this[_0x14877d(0x12e)]=path_1[_0x14877d(0x182)][_0x14877d(0x18e)](process['cwd'](),_0x14877d(0x248),'private.pem'),this[_0x14877d(0x1f1)]=path_1[_0x14877d(0x182)][_0x14877d(0x18e)](process['cwd'](),_0x14877d(0x248),_0x14877d(0x239)),this[_0x14877d(0x18b)]=_0x14877d(0x193),this[_0x14877d(0x210)]=0x6b7,this[_0x14877d(0x216)]=path_1['default']['join'](process['cwd'](),_0x14877d(0x248),_0x14877d(0x1c9)),this[_0x14877d(0x183)]=path_1[_0x14877d(0x182)][_0x14877d(0x18e)](process[_0x14877d(0x199)](),'keys',_0x14877d(0x1bb)),console[_0x14877d(0x244)](_0x14877d(0x255)),console[_0x14877d(0x244)](_0x14877d(0x206),this[_0x14877d(0x144)]),console[_0x14877d(0x244)]('🔐\x20VISA\x20API\x20URL:',this[_0x14877d(0x18b)]),console[_0x14877d(0x244)](_0x14877d(0x251),this['privateKeyPath']),console[_0x14877d(0x244)](_0x14877d(0x232),this[_0x14877d(0x1f1)]),console[_0x14877d(0x244)](_0x14877d(0x163),this[_0x14877d(0x216)]),console['log'](_0x14877d(0x23d),this['visaPublicKeyPath']),this[_0x14877d(0x139)]();}[a46_0x19c01b(0x1d0)](_0x1486c8){const _0x1ad051=a46_0x19c01b,_0x328282=_0x1486c8[_0x1ad051(0x1c5)](0x0);if(_0x328282==='4')return console[_0x1ad051(0x244)](_0x1ad051(0x1e5)),{'cardType':_0x1ad051(0x15a),'apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x1ad051(0x216)],'publicKeyPath':this['visaPublicKeyPath'],'merchantPointId':this['visaMerchantPointId']};else return _0x328282==='5'?(console[_0x1ad051(0x244)](_0x1ad051(0x13f)),{'cardType':_0x1ad051(0x1a8),'apiUrl':this[_0x1ad051(0x144)],'privateKeyPath':this[_0x1ad051(0x12e)],'publicKeyPath':this[_0x1ad051(0x1f1)],'merchantPointId':this['masterCardMerchantPointId']}):(console[_0x1ad051(0x244)](_0x1ad051(0x185)+_0x328282+_0x1ad051(0x1bc)),{'cardType':_0x1ad051(0x1a8),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this['masterCardMerchantPointId']});}[a46_0x19c01b(0x139)](){const _0x3acf43=a46_0x19c01b;try{if(!fs_1[_0x3acf43(0x182)][_0x3acf43(0x213)](this[_0x3acf43(0x12e)]))throw new Error(_0x3acf43(0x1f3)+this[_0x3acf43(0x12e)]);if(!fs_1[_0x3acf43(0x182)][_0x3acf43(0x213)](this[_0x3acf43(0x1f1)]))throw new Error(_0x3acf43(0x130)+this[_0x3acf43(0x1f1)]);const _0x214f50=fs_1[_0x3acf43(0x182)][_0x3acf43(0x1cf)](this[_0x3acf43(0x12e)],_0x3acf43(0x1ed))[_0x3acf43(0x1a1)](),_0x5ec1ab=fs_1[_0x3acf43(0x182)][_0x3acf43(0x1cf)](this[_0x3acf43(0x1f1)],_0x3acf43(0x1ed))[_0x3acf43(0x1a1)]();if(!_0x214f50[_0x3acf43(0x18d)](_0x3acf43(0x252))||!_0x214f50[_0x3acf43(0x18d)](_0x3acf43(0x143)))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x5ec1ab[_0x3acf43(0x18d)]('-----BEGIN')||!_0x5ec1ab['includes']('-----END'))throw new Error(_0x3acf43(0x1fd));console[_0x3acf43(0x244)]('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console[_0x3acf43(0x244)](_0x3acf43(0x24a)+_0x214f50[_0x3acf43(0x1c3)]+_0x3acf43(0x1f8)),console[_0x3acf43(0x244)](_0x3acf43(0x20e)+_0x5ec1ab[_0x3acf43(0x1c3)]+_0x3acf43(0x1f8));if(fs_1['default'][_0x3acf43(0x213)](this['visaPrivateKeyPath'])&&fs_1[_0x3acf43(0x182)][_0x3acf43(0x213)](this[_0x3acf43(0x183)])){const _0x505103=fs_1[_0x3acf43(0x182)][_0x3acf43(0x1cf)](this[_0x3acf43(0x216)],_0x3acf43(0x1ed))[_0x3acf43(0x1a1)](),_0x595b6d=fs_1[_0x3acf43(0x182)]['readFileSync'](this[_0x3acf43(0x183)],_0x3acf43(0x1ed))[_0x3acf43(0x1a1)]();(!_0x505103[_0x3acf43(0x18d)]('-----BEGIN')||!_0x505103[_0x3acf43(0x18d)](_0x3acf43(0x143)))&&console[_0x3acf43(0x153)](_0x3acf43(0x184)),(!_0x595b6d['includes']('-----BEGIN')||!_0x595b6d[_0x3acf43(0x18d)](_0x3acf43(0x143)))&&console[_0x3acf43(0x153)]('⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),console[_0x3acf43(0x244)](_0x3acf43(0x207)),console['log']('🔐\x20VISA\x20Private\x20key\x20length:\x20'+_0x505103[_0x3acf43(0x1c3)]+'\x20characters'),console[_0x3acf43(0x244)]('🔐\x20VISA\x20Public\x20key\x20length:\x20'+_0x595b6d[_0x3acf43(0x1c3)]+_0x3acf43(0x1f8));}else console[_0x3acf43(0x153)](_0x3acf43(0x1c7)),console[_0x3acf43(0x153)](_0x3acf43(0x1da)+this[_0x3acf43(0x216)]),console[_0x3acf43(0x153)]('⚠️\x20Expected\x20VISA\x20public\x20key:\x20'+this[_0x3acf43(0x183)]);}catch(_0x5e84b5){console[_0x3acf43(0x228)](_0x3acf43(0x158),_0x5e84b5);throw _0x5e84b5;}}[a46_0x19c01b(0x13d)](){const _0xdabef=a46_0x19c01b,_0xfb847=crypto_1[_0xdabef(0x182)]['randomBytes'](0x20),_0x841f92=crypto_1[_0xdabef(0x182)][_0xdabef(0x22b)](0x10);return{'key':_0xfb847,'iv':_0x841f92};}['encryptAES'](_0x5ea7ba,_0xaa6591,_0x518e2e){const _0x26b230=a46_0x19c01b,_0x59c24e=crypto_1[_0x26b230(0x182)][_0x26b230(0x1c6)](_0x26b230(0x1a6),_0xaa6591,_0x518e2e);let _0x2eb3b1=_0x59c24e[_0x26b230(0x12f)](_0x5ea7ba,'utf8',_0x26b230(0x1d7));return _0x2eb3b1+=_0x59c24e[_0x26b230(0x1bf)](_0x26b230(0x1d7)),_0x2eb3b1;}[a46_0x19c01b(0x16b)](_0x514531,_0x41d519,_0x4735ee){const _0x1fceb7=a46_0x19c01b;try{const _0x4b5039=fs_1[_0x1fceb7(0x182)]['readFileSync'](_0x4735ee,'utf8')[_0x1fceb7(0x1a1)](),_0x50870b={'iv':_0x41d519['toString'](_0x1fceb7(0x1d7)),'key':_0x514531[_0x1fceb7(0x170)](_0x1fceb7(0x1d7))},_0x54dc4e=JSON[_0x1fceb7(0x176)](_0x50870b);console[_0x1fceb7(0x244)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x54dc4e[_0x1fceb7(0x1c3)]);const _0x3ef502=crypto_1['default'][_0x1fceb7(0x14c)]({'key':_0x4b5039,'padding':crypto_1[_0x1fceb7(0x182)][_0x1fceb7(0x222)][_0x1fceb7(0x247)]},Buffer[_0x1fceb7(0x1f0)](_0x54dc4e));return console[_0x1fceb7(0x244)](_0x1fceb7(0x14a),_0x3ef502[_0x1fceb7(0x1c3)]),_0x3ef502[_0x1fceb7(0x170)](_0x1fceb7(0x1d7));}catch(_0x12bdbe){console[_0x1fceb7(0x228)](_0x1fceb7(0x19c),_0x12bdbe);throw new Error(_0x1fceb7(0x21a));}}['signRSA'](_0x217a00,_0x4d01f4){const _0x5f4cdf=a46_0x19c01b;try{const _0x2a1f12=fs_1[_0x5f4cdf(0x182)]['readFileSync'](_0x4d01f4,_0x5f4cdf(0x1ed))[_0x5f4cdf(0x1a1)](),_0xc86dd5=crypto_1[_0x5f4cdf(0x182)][_0x5f4cdf(0x12d)](_0x5f4cdf(0x14f));_0xc86dd5[_0x5f4cdf(0x12f)](_0x217a00),_0xc86dd5['end']();const _0x342780=_0xc86dd5[_0x5f4cdf(0x224)](_0x2a1f12,_0x5f4cdf(0x1d7));return console[_0x5f4cdf(0x244)](_0x5f4cdf(0x23f)),console[_0x5f4cdf(0x244)](_0x5f4cdf(0x20a),_0x217a00[_0x5f4cdf(0x1c3)]),console[_0x5f4cdf(0x244)](_0x5f4cdf(0x242),_0x342780[_0x5f4cdf(0x1c3)]),_0x342780;}catch(_0x3b58c1){console['error']('❌\x20RSA\x20signing\x20failed:',_0x3b58c1),console[_0x5f4cdf(0x228)](_0x5f4cdf(0x1b7),_0x217a00['substring'](0x0,0xc8)+'...');throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}[a46_0x19c01b(0x1a2)](_0x456645,_0x2a4b00,_0x3f4121){const _0x2dcd9c=a46_0x19c01b,_0x24c370=crypto_1[_0x2dcd9c(0x182)][_0x2dcd9c(0x156)]('aes-256-ctr',_0x2a4b00,_0x3f4121);let _0x5d29bc=_0x24c370[_0x2dcd9c(0x12f)](_0x456645,_0x2dcd9c(0x1d7),_0x2dcd9c(0x1ed));return _0x5d29bc+=_0x24c370[_0x2dcd9c(0x1bf)]('utf8'),_0x5d29bc;}async['decryptResponsePhp'](_0x2de84f,_0x15dce4,_0x539b34=a46_0x19c01b(0x1a8)){const _0x5501c6=a46_0x19c01b;try{const _0x455dae=await fetch(_0x5501c6(0x1f5),{'method':_0x5501c6(0x195),'headers':{'Content-Type':_0x5501c6(0x150)},'body':JSON[_0x5501c6(0x176)]({'info':_0x2de84f,'key':_0x15dce4,'card_type':_0x539b34[_0x5501c6(0x140)]()})});if(!_0x455dae['ok'])throw new Error(_0x5501c6(0x164));return await _0x455dae['text']();}catch(_0x4928e5){console['error'](_0x5501c6(0x13c),_0x4928e5);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a46_0x19c01b(0x181)](_0x52eeb9,_0x4a216a){const _0x21995c=a46_0x19c01b;try{const _0x59ad39=fs_1['default']['readFileSync'](this['privateKeyPath'],'utf8')['trim'](),_0x3f23f8=crypto_1['default'][_0x21995c(0x1a3)](_0x59ad39,Buffer[_0x21995c(0x1f0)](_0x4a216a,_0x21995c(0x1d7))),_0x55dbb4=JSON[_0x21995c(0x14e)](_0x3f23f8[_0x21995c(0x170)]()),_0x5ec1df=Buffer[_0x21995c(0x1f0)](_0x55dbb4[_0x21995c(0x234)],_0x21995c(0x1d7)),_0x53e066=Buffer[_0x21995c(0x1f0)](_0x55dbb4['iv'],'base64');return this[_0x21995c(0x1a2)](_0x52eeb9,_0x5ec1df,_0x53e066);}catch(_0x5357ae){throw new Error(_0x21995c(0x167));}}async['processCardPayment'](_0x3df1d5){const _0x518e5c=a46_0x19c01b,{paymentId:_0x549551,orderId:_0x2f425e,amount:_0x33b263,currency:_0x148d21,cardData:_0x56250a,resultUrl:_0xad7888,returnUrl:_0x5f5735,cardHolder:_0x3dcc4f,browser:_0x216552}=_0x3df1d5;console[_0x518e5c(0x244)](_0x518e5c(0x214)),console[_0x518e5c(0x244)](_0x518e5c(0x132),_0x549551),console[_0x518e5c(0x244)](_0x518e5c(0x1ce),_0x2f425e),console['log'](_0x518e5c(0x19a),_0x33b263,_0x148d21),console[_0x518e5c(0x244)](_0x518e5c(0x1d2),this[_0x518e5c(0x15d)](_0x56250a[_0x518e5c(0x1b0)])),console[_0x518e5c(0x244)](_0x518e5c(0x22f),_0x3dcc4f[_0x518e5c(0x20f)]+'\x20'+_0x3dcc4f[_0x518e5c(0x200)]),console[_0x518e5c(0x244)]('Return\x20URL:',_0x5f5735),console[_0x518e5c(0x244)]('Result\x20URL:',_0xad7888);const _0x2142a3=this[_0x518e5c(0x1d0)](_0x56250a['number']);console[_0x518e5c(0x244)](_0x518e5c(0x20b)+_0x2142a3[_0x518e5c(0x155)]+_0x518e5c(0x233)+_0x2142a3[_0x518e5c(0x221)]),console['log']('🔐\x20Using\x20keys:\x20'+_0x2142a3['privateKeyPath']+',\x20'+_0x2142a3['publicKeyPath']);const _0x58acd5={'amount':_0x33b263,'currency':_0x148d21[_0x518e5c(0x20d)](),'order_id':_0x2f425e,'result_url':_0xad7888,'return_url':_0x5f5735,'country':'','card':{'number':_0x56250a['number'],'expire_month':_0x56250a[_0x518e5c(0x13b)],'expire_year':_0x56250a[_0x518e5c(0x162)],'cvv':_0x56250a[_0x518e5c(0x250)]},'card_holder':_0x3dcc4f,'browser':_0x216552},_0x5ea2f1=JSON[_0x518e5c(0x176)](_0x58acd5);console['log']('💾\x20Payment\x20data\x20prepared'),console[_0x518e5c(0x244)](_0x518e5c(0x235)),console['log'](_0x5ea2f1),console[_0x518e5c(0x244)](_0x518e5c(0x21e),_0x5ea2f1[_0x518e5c(0x1c3)]);try{const {key:_0x5b5706,iv:_0x320bf5}=this[_0x518e5c(0x13d)]();console[_0x518e5c(0x244)](_0x518e5c(0x1ca)),console[_0x518e5c(0x244)]('🔐\x20AES\x20key\x20length:',_0x5b5706['length']),console[_0x518e5c(0x244)](_0x518e5c(0x194),_0x320bf5[_0x518e5c(0x1c3)]);const _0x8cba46=this[_0x518e5c(0x22d)](_0x5ea2f1,_0x5b5706,_0x320bf5);console[_0x518e5c(0x244)](_0x518e5c(0x1ee)),console['log'](_0x518e5c(0x15c),_0x8cba46[_0x518e5c(0x1c3)]);const _0x3dfe7=this['encryptRSA'](_0x5b5706,_0x320bf5,_0x2142a3[_0x518e5c(0x1f1)]);console['log'](_0x518e5c(0x134)),console[_0x518e5c(0x244)](_0x518e5c(0x175),_0x3dfe7[_0x518e5c(0x1c3)]);const _0x28636e=this[_0x518e5c(0x168)](_0x5ea2f1,_0x2142a3['privateKeyPath']);console[_0x518e5c(0x244)]('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x518e5c(0x244)](_0x518e5c(0x242),_0x28636e[_0x518e5c(0x1c3)]);const _0x3b4a8f={'merchant_point_id':_0x2142a3[_0x518e5c(0x1fb)],'method':_0x518e5c(0x138),'info':_0x8cba46,'key':_0x3dfe7,'sign':_0x28636e,'lang':'en'};console[_0x518e5c(0x244)](_0x518e5c(0x227)),console[_0x518e5c(0x244)](_0x518e5c(0x24e)),console[_0x518e5c(0x244)](_0x518e5c(0x1ae),_0x2142a3['merchantPointId']),console[_0x518e5c(0x244)](_0x518e5c(0x173)),console['log'](_0x518e5c(0x23b),_0x8cba46[_0x518e5c(0x1c3)]),console['log'](_0x518e5c(0x1f4),_0x3dfe7['length']),console[_0x518e5c(0x244)]('\x20\x20\x20-\x20sign\x20length:',_0x28636e[_0x518e5c(0x1c3)]),console[_0x518e5c(0x244)](_0x518e5c(0x23c)),loggerService_1['loggerService'][_0x518e5c(0x1be)](_0x2142a3[_0x518e5c(0x155)][_0x518e5c(0x140)](),_0x518e5c(0x1e9),_0x518e5c(0x195),{'merchant_point_id':_0x2142a3[_0x518e5c(0x1fb)],'method':_0x518e5c(0x138),'lang':'en'});const _0x510c69=Date[_0x518e5c(0x18a)](),_0x548c41=await fetch(_0x2142a3['apiUrl'],{'method':_0x518e5c(0x195),'headers':{'Content-Type':_0x518e5c(0x150),'Accept':_0x518e5c(0x150),'User-Agent':_0x518e5c(0x180)},'body':JSON['stringify'](_0x3b4a8f)}),_0x79d533=Date[_0x518e5c(0x18a)]()-_0x510c69;console[_0x518e5c(0x244)](_0x518e5c(0x192)),console[_0x518e5c(0x244)]('Status:',_0x548c41[_0x518e5c(0x225)]),console[_0x518e5c(0x244)](_0x518e5c(0x1b8),_0x79d533+'ms');if(!_0x548c41['ok']){const _0x40f918=await _0x548c41[_0x518e5c(0x1e3)]();console['error'](_0x518e5c(0x1f2),_0x548c41[_0x518e5c(0x225)]),console[_0x518e5c(0x228)](_0x518e5c(0x1b3),_0x40f918),loggerService_1[_0x518e5c(0x1af)]['logWhiteDomainResponse'](_0x2142a3['cardType']['toLowerCase'](),'/charge_raw',_0x548c41[_0x518e5c(0x225)],_0x40f918,_0x79d533),loggerService_1[_0x518e5c(0x1af)][_0x518e5c(0x1e6)](_0x2142a3[_0x518e5c(0x155)][_0x518e5c(0x140)](),_0x518e5c(0x1e9),_0x518e5c(0x17a)+_0x548c41[_0x518e5c(0x225)]+':\x20'+_0x40f918);throw new Error(_0x518e5c(0x21d)+_0x548c41[_0x518e5c(0x225)]+_0x518e5c(0x186)+_0x40f918);}const _0x4b1831=await _0x548c41[_0x518e5c(0x17d)]();loggerService_1['loggerService'][_0x518e5c(0x147)](_0x2142a3[_0x518e5c(0x155)][_0x518e5c(0x140)](),'/charge_raw',_0x548c41[_0x518e5c(0x225)],_0x4b1831,_0x79d533),console[_0x518e5c(0x244)](_0x518e5c(0x190));let _0x25d42a=_0x4b1831;if(_0x4b1831[_0x518e5c(0x1d8)]&&_0x4b1831[_0x518e5c(0x234)]&&_0x4b1831[_0x518e5c(0x224)]){console[_0x518e5c(0x244)](_0x518e5c(0x212));try{const _0x1d4398=await this[_0x518e5c(0x259)](_0x4b1831[_0x518e5c(0x1d8)],_0x4b1831[_0x518e5c(0x234)],_0x2142a3[_0x518e5c(0x155)]);_0x25d42a=JSON['parse'](_0x1d4398),console['log'](_0x518e5c(0x245)),loggerService_1[_0x518e5c(0x1af)][_0x518e5c(0x147)](_0x2142a3[_0x518e5c(0x155)][_0x518e5c(0x140)](),'/charge_decrypted',_0x548c41['status'],_0x25d42a,_0x79d533),console[_0x518e5c(0x244)](_0x518e5c(0x229));}catch(_0xbe9393){console[_0x518e5c(0x228)]('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0xbe9393),loggerService_1[_0x518e5c(0x1af)][_0x518e5c(0x1e6)](_0x2142a3[_0x518e5c(0x155)][_0x518e5c(0x140)](),_0x518e5c(0x1ab),'Decryption\x20failed:\x20'+_0xbe9393),_0x25d42a=_0x4b1831;}}else loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2142a3[_0x518e5c(0x155)]['toLowerCase'](),_0x518e5c(0x1d5),_0x548c41[_0x518e5c(0x225)],_0x25d42a,_0x79d533),console[_0x518e5c(0x244)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console['log']('Status:',_0x25d42a['status']),console[_0x518e5c(0x244)](_0x518e5c(0x17c),_0x25d42a[_0x518e5c(0x1bf)]),console[_0x518e5c(0x244)](_0x518e5c(0x132),_0x25d42a[_0x518e5c(0x165)]),console[_0x518e5c(0x244)](_0x518e5c(0x12a),_0x25d42a[_0x518e5c(0x1b1)]||'none');if(_0x25d42a[_0x518e5c(0x225)]===0x64&&_0x25d42a[_0x518e5c(0x1bf)]===0x1)return console[_0x518e5c(0x244)](_0x518e5c(0x1e4)),{'gateway_payment_id':_0x25d42a[_0x518e5c(0x165)]?.[_0x518e5c(0x170)](),'payment_url':_0x5f5735,'requires_3ds':![],'status':_0x518e5c(0x17f),'final':!![]};if(_0x25d42a[_0x518e5c(0x1b1)])return console[_0x518e5c(0x244)](_0x518e5c(0x24f)),this[_0x518e5c(0x135)](_0x549551,_0x2f425e,_0x25d42a[_0x518e5c(0x165)]?.['toString']()||_0x2f425e,_0x2142a3[_0x518e5c(0x155)]),{'gateway_payment_id':_0x25d42a[_0x518e5c(0x165)]?.[_0x518e5c(0x170)](),'payment_url':_0x25d42a[_0x518e5c(0x1b1)],'requires_3ds':!![],'threeds_url':_0x25d42a[_0x518e5c(0x1b1)],'status':_0x518e5c(0x152),'final':![]};let _0x456b4a=_0x25d42a[_0x518e5c(0x174)]||_0x25d42a[_0x518e5c(0x1d6)]||'Unknown\x20error',_0x4f17ec=_0x25d42a['status'],_0x274cf4=_0x25d42a['final'];return console[_0x518e5c(0x244)](_0x518e5c(0x253)+_0x4f17ec+_0x518e5c(0x1e8)+_0x274cf4+_0x518e5c(0x1ef)+_0x456b4a),{'gateway_payment_id':_0x25d42a[_0x518e5c(0x165)]?.[_0x518e5c(0x170)](),'payment_url':_0x5f5735,'requires_3ds':![],'status':_0x518e5c(0x1ba),'final':!![]};}catch(_0x3bc2cc){console['error'](_0x518e5c(0x177)),console[_0x518e5c(0x228)](_0x518e5c(0x131),_0x3bc2cc),loggerService_1[_0x518e5c(0x1af)][_0x518e5c(0x1e6)](_0x518e5c(0x217),_0x518e5c(0x1e9),_0x3bc2cc);throw new Error(_0x518e5c(0x1ac)+(_0x3bc2cc instanceof Error?_0x3bc2cc[_0x518e5c(0x1d6)]:_0x518e5c(0x17e)));}}async[a46_0x19c01b(0x160)](_0x1e506d,_0x3ec45f,_0x2d25c1=a46_0x19c01b(0x15a)){const _0xb48b07=a46_0x19c01b;console['log'](_0xb48b07(0x1f9)+_0x2d25c1+_0xb48b07(0x230)+_0x1e506d+'\x20('+_0x3ec45f+')');try{const _0x148d5e={'payment_id':_0x1e506d,'order_id':_0x3ec45f},_0x20c3ae=JSON[_0xb48b07(0x176)](_0x148d5e),_0x52fccc=this[_0xb48b07(0x1d0)](_0x2d25c1===_0xb48b07(0x15a)?_0xb48b07(0x142):_0xb48b07(0x1a7)),{key:_0xd40086,iv:_0x50616d}=this[_0xb48b07(0x13d)](),_0x5642ad=this[_0xb48b07(0x22d)](_0x20c3ae,_0xd40086,_0x50616d),_0x4e7c0e=this[_0xb48b07(0x16b)](_0xd40086,_0x50616d,_0x52fccc['publicKeyPath']),_0x32c3ec=this[_0xb48b07(0x168)](_0x20c3ae,_0x52fccc[_0xb48b07(0x12e)]),_0x2fe3d4={'merchant_point_id':_0x52fccc['merchantPointId'],'method':_0xb48b07(0x225),'info':_0x5642ad,'key':_0x4e7c0e,'sign':_0x32c3ec,'lang':'en'};loggerService_1['loggerService'][_0xb48b07(0x1be)](_0x2d25c1[_0xb48b07(0x140)](),_0xb48b07(0x189),_0xb48b07(0x195),{'merchant_point_id':_0x52fccc['merchantPointId'],'method':_0xb48b07(0x225),'lang':'en'});const _0x3ae113=Date[_0xb48b07(0x18a)](),_0x2b584c=await fetch(_0x52fccc['apiUrl'],{'method':_0xb48b07(0x195),'headers':{'Content-Type':_0xb48b07(0x150),'Accept':_0xb48b07(0x150),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0xb48b07(0x176)](_0x2fe3d4)}),_0x194b1d=Date[_0xb48b07(0x18a)]()-_0x3ae113;if(!_0x2b584c['ok']){const _0x223440=await _0x2b584c[_0xb48b07(0x1e3)]();loggerService_1[_0xb48b07(0x1af)][_0xb48b07(0x147)](_0x2d25c1[_0xb48b07(0x140)](),'/status_raw',_0x2b584c[_0xb48b07(0x225)],_0x223440,_0x194b1d);throw new Error(_0xb48b07(0x21d)+_0x2b584c[_0xb48b07(0x225)]);}const _0x47c725=await _0x2b584c[_0xb48b07(0x17d)]();loggerService_1[_0xb48b07(0x1af)][_0xb48b07(0x147)](_0x2d25c1[_0xb48b07(0x140)](),_0xb48b07(0x208),_0x2b584c['status'],_0x47c725,_0x194b1d);let _0x48dd72=_0x47c725;if(_0x47c725['info']&&_0x47c725[_0xb48b07(0x234)]&&_0x47c725[_0xb48b07(0x224)]){console[_0xb48b07(0x244)]('🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0x5d953e=await this['decryptResponsePhp'](_0x47c725['info'],_0x47c725['key'],_0x2d25c1);_0x48dd72=JSON[_0xb48b07(0x14e)](_0x5d953e),console['log'](_0xb48b07(0x258)),loggerService_1['loggerService'][_0xb48b07(0x147)](_0x2d25c1[_0xb48b07(0x140)](),'/status_decrypted',_0x2b584c[_0xb48b07(0x225)],_0x48dd72,_0x194b1d),console['log'](_0xb48b07(0x1dd));}catch(_0x58d4b8){console['error']('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x58d4b8),loggerService_1[_0xb48b07(0x1af)]['logWhiteDomainError'](_0x2d25c1[_0xb48b07(0x140)](),_0xb48b07(0x16c),_0xb48b07(0x254)+_0x58d4b8),_0x48dd72=_0x47c725;}}else loggerService_1[_0xb48b07(0x1af)][_0xb48b07(0x147)](_0x2d25c1['toLowerCase'](),_0xb48b07(0x1aa),_0x2b584c[_0xb48b07(0x225)],_0x48dd72,_0x194b1d),console[_0xb48b07(0x244)](_0xb48b07(0x1c0));console[_0xb48b07(0x244)]('📊\x20Status\x20check\x20result:',{'status':_0x48dd72[_0xb48b07(0x225)],'final':_0x48dd72[_0xb48b07(0x1bf)],'payment_id':_0x48dd72[_0xb48b07(0x165)],'desc':_0x48dd72[_0xb48b07(0x174)]});let _0x69d675=_0xb48b07(0x152);if(_0x48dd72[_0xb48b07(0x225)]===0x64&&_0x48dd72[_0xb48b07(0x1bf)]===0x1)_0x69d675='PAID';else{if(_0x48dd72[_0xb48b07(0x1bf)]===0x0)_0x69d675=_0xb48b07(0x152);else _0x48dd72[_0xb48b07(0x1bf)]===0x1&&_0x48dd72[_0xb48b07(0x225)]!==0x64?_0x69d675='FAILED':_0x69d675='PENDING';}return{'status':_0x69d675,'final':_0x48dd72['final']===0x1,'amount':_0x48dd72[_0xb48b07(0x236)],'currency':_0x48dd72['currency'],'date_success':_0x48dd72[_0xb48b07(0x23e)],'description':_0x48dd72['desc']};}catch(_0x14b0a0){console[_0xb48b07(0x228)](_0x2d25c1+_0xb48b07(0x187),_0x14b0a0),loggerService_1[_0xb48b07(0x1af)][_0xb48b07(0x1e6)](_0x2d25c1['toLowerCase'](),_0xb48b07(0x189),_0x14b0a0);throw new Error(_0xb48b07(0x178)+_0x2d25c1+_0xb48b07(0x230)+(_0x14b0a0 instanceof Error?_0x14b0a0['message']:_0xb48b07(0x17e)));}}[a46_0x19c01b(0x135)](_0x11b947,_0x2c50b8,_0x44be40,_0x3bc64e){const _0x30ebe0=a46_0x19c01b;console['log'](_0x30ebe0(0x137)+_0x3bc64e+_0x30ebe0(0x161)+_0x11b947+'\x20('+_0x44be40+')'),this[_0x30ebe0(0x179)](_0x11b947);const _0x365f62=[],_0xd67bb5=0x5*0x3c*0x3e8,_0x1bae4a=0x2*0x3c*0x3c*0x3e8,_0x3004d1=Math[_0x30ebe0(0x24d)](_0x1bae4a/_0xd67bb5);console[_0x30ebe0(0x244)](_0x30ebe0(0x22e)+_0x3004d1+_0x30ebe0(0x201));for(let _0xc800e6=0x1;_0xc800e6<=_0x3004d1;_0xc800e6++){const _0x20783b=setTimeout(async()=>{const _0x4794f8=_0x30ebe0;console[_0x4794f8(0x244)](_0x4794f8(0x204)+_0x3bc64e+_0x4794f8(0x238)+_0xc800e6+'/'+_0x3004d1+_0x4794f8(0x22a)+_0x11b947);try{const _0x278bf6=await this[_0x4794f8(0x160)](_0x44be40,_0x2c50b8,_0x3bc64e);console[_0x4794f8(0x244)](_0x4794f8(0x241)+_0xc800e6+_0x4794f8(0x12c),_0x278bf6),_0x278bf6[_0x4794f8(0x1bf)]&&(console[_0x4794f8(0x244)](_0x4794f8(0x209)+_0x11b947+'\x20is\x20final\x20('+_0x278bf6[_0x4794f8(0x225)]+_0x4794f8(0x1eb)),this[_0x4794f8(0x179)](_0x11b947),await this['updatePaymentStatus'](_0x11b947,_0x278bf6['status'],_0x278bf6));}catch(_0x224f1f){console[_0x4794f8(0x228)](_0x4794f8(0x148)+_0xc800e6+_0x4794f8(0x154)+_0x11b947+':',_0x224f1f);}},_0xc800e6*_0xd67bb5);_0x365f62['push'](_0x20783b);}this[_0x30ebe0(0x1ad)][_0x30ebe0(0x205)](_0x11b947,_0x365f62),console[_0x30ebe0(0x244)](_0x30ebe0(0x1c4)+_0x3004d1+_0x30ebe0(0x1df)+_0x11b947);}[a46_0x19c01b(0x179)](_0x1ac99a){const _0x58984d=a46_0x19c01b,_0x246fc3=this[_0x58984d(0x1ad)][_0x58984d(0x1e1)](_0x1ac99a);_0x246fc3&&(console[_0x58984d(0x244)]('🧹\x20Clearing\x20'+_0x246fc3['length']+_0x58984d(0x19b)+_0x1ac99a),_0x246fc3[_0x58984d(0x1b6)]((_0x1b9dbb,_0x4f4922)=>{clearTimeout(_0x1b9dbb);}),this[_0x58984d(0x1ad)][_0x58984d(0x1fe)](_0x1ac99a));}async[a46_0x19c01b(0x1b4)](_0xc9e23a,_0x1ea411,_0x186b55){const _0x57653f=a46_0x19c01b;try{const _0x2a93de=(await Promise[_0x57653f(0x13e)]()[_0x57653f(0x1c1)](()=>__importStar(require('../../config/database'))))[_0x57653f(0x182)],_0x18b4de={'status':_0x1ea411[_0x57653f(0x20d)](),'updatedAt':new Date(),'statusChangedBy':_0x57653f(0x1d3),'statusChangedAt':new Date()};_0x1ea411===_0x57653f(0x17f)&&(_0x18b4de[_0x57653f(0x141)]=new Date()),_0x1ea411===_0x57653f(0x1ba)&&_0x186b55[_0x57653f(0x23a)]&&(_0x18b4de[_0x57653f(0x1c8)]=_0x186b55[_0x57653f(0x23a)],console[_0x57653f(0x244)](_0x57653f(0x203)+_0x186b55['description'])),_0x186b55[_0x57653f(0x23a)]&&(_0x18b4de[_0x57653f(0x1a9)]=(_0x1ea411===_0x57653f(0x17f)?_0x57653f(0x202):'VISA/MasterCard')+':\x20'+_0x186b55[_0x57653f(0x23a)]),await _0x2a93de[_0x57653f(0x1ea)][_0x57653f(0x12f)]({'where':{'id':_0xc9e23a},'data':_0x18b4de}),console[_0x57653f(0x244)](_0x57653f(0x209)+_0xc9e23a+_0x57653f(0x215)+_0x1ea411),await this[_0x57653f(0x1bd)](_0xc9e23a,_0x1ea411);}catch(_0x27c2f8){console['error'](_0x57653f(0x1e2)+_0xc9e23a+':',_0x27c2f8);}}async[a46_0x19c01b(0x1bd)](_0x7341cc,_0x50d126){const _0x7c955=a46_0x19c01b;try{const _0x420e01=(await Promise['resolve']()[_0x7c955(0x1c1)](()=>__importStar(require(_0x7c955(0x159)))))[_0x7c955(0x182)],{telegramBotService:_0x5a9720}=await Promise[_0x7c955(0x13e)]()[_0x7c955(0x1c1)](()=>__importStar(require('../telegramBotService'))),_0x2e9505=await _0x420e01[_0x7c955(0x1ea)][_0x7c955(0x19e)]({'where':{'id':_0x7341cc},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x2e9505)return;const _0x6b31ee={'PAID':_0x7c955(0x157),'FAILED':_0x7c955(0x18f)},_0x421d91=_0x6b31ee[_0x50d126];_0x421d91&&await _0x5a9720[_0x7c955(0x24b)](_0x2e9505[_0x7c955(0x20c)],_0x2e9505,_0x421d91),await this['sendShopWebhook'](_0x2e9505,_0x50d126);}catch(_0x30c6f6){console[_0x7c955(0x228)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x30c6f6);}}async[a46_0x19c01b(0x136)](_0x20119e,_0x122da5){const _0x48627b=a46_0x19c01b,_0x2d7301=Date[_0x48627b(0x18a)]();try{const _0x396a12=_0x20119e['shop'],_0x170ed3=_0x396a12[_0x48627b(0x166)];if(!_0x170ed3?.[_0x48627b(0x243)]){console[_0x48627b(0x244)](_0x48627b(0x21b)+_0x396a12['id']);return;}const _0x36de80=_0x122da5===_0x48627b(0x17f)?_0x48627b(0x1cb):_0x48627b(0x1a4);let _0x540ae0=[];if(_0x170ed3['webhookEvents'])try{_0x540ae0=Array[_0x48627b(0x257)](_0x170ed3['webhookEvents'])?_0x170ed3['webhookEvents']:JSON[_0x48627b(0x14e)](_0x170ed3['webhookEvents']);}catch(_0x1bbb96){console[_0x48627b(0x228)](_0x48627b(0x1f6),_0x1bbb96),_0x540ae0=[];}if(!_0x540ae0[_0x48627b(0x18d)](_0x36de80)){console['log']('Webhook\x20event\x20'+_0x36de80+_0x48627b(0x14b)+_0x396a12['id']);return;}const _0xb61f0e={'event':_0x36de80,'payment':{'id':_0x20119e['id'],'order_id':_0x20119e[_0x48627b(0x1d1)],'gateway_order_id':_0x20119e[_0x48627b(0x1e0)],'gateway':_0x48627b(0x169),'amount':_0x20119e[_0x48627b(0x236)],'currency':_0x20119e['currency'],'status':_0x122da5[_0x48627b(0x140)](),'customer_email':_0x20119e[_0x48627b(0x1f7)],'customer_name':_0x20119e[_0x48627b(0x1d9)],'created_at':_0x20119e[_0x48627b(0x18c)],'updated_at':new Date()}},_0x48c7e6=await fetch(_0x170ed3[_0x48627b(0x243)],{'method':_0x48627b(0x195),'headers':{'Content-Type':_0x48627b(0x150),'User-Agent':_0x48627b(0x231)},'body':JSON['stringify'](_0xb61f0e)}),_0x463410=Date[_0x48627b(0x18a)]()-_0x2d7301;loggerService_1[_0x48627b(0x1af)][_0x48627b(0x172)](_0x20119e[_0x48627b(0x20c)],_0x170ed3[_0x48627b(0x243)],_0x36de80,_0x48c7e6[_0x48627b(0x225)],_0x463410,_0xb61f0e),console[_0x48627b(0x244)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x170ed3[_0x48627b(0x243)]+'\x20with\x20status\x20'+_0x48c7e6[_0x48627b(0x225)]+'\x20('+_0x463410+_0x48627b(0x1fa));}catch(_0x2d86c1){console[_0x48627b(0x228)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x2d86c1),loggerService_1[_0x48627b(0x1af)]['logShopWebhookError'](_0x20119e[_0x48627b(0x20c)],_0x20119e[_0x48627b(0x223)]?.[_0x48627b(0x166)]?.[_0x48627b(0x243)]||'unknown','webhook_send',_0x2d86c1,{});}}[a46_0x19c01b(0x15d)](_0x576dc9){const _0x3e17ba=a46_0x19c01b,_0xe5fb09=_0x576dc9['replace'](/[\s-]/g,'');if(_0xe5fb09['length']<0x4)return'****';return _0x3e17ba(0x1a5)+_0xe5fb09[_0x3e17ba(0x15f)](-0x4);}async[a46_0x19c01b(0x191)](_0xb73206,_0x43ce5f=a46_0x19c01b(0x1a8)){const _0x5e6a1c=a46_0x19c01b;console[_0x5e6a1c(0x244)](_0x5e6a1c(0x19d),JSON['stringify'](_0xb73206,null,0x2));let _0x404124=_0xb73206,_0x23422f=_0x43ce5f;_0xb73206[_0x5e6a1c(0x237)]?(_0x23422f=_0xb73206[_0x5e6a1c(0x237)][_0x5e6a1c(0x20d)]()===_0x5e6a1c(0x15a)?_0x5e6a1c(0x15a):'MASTERCARD',console[_0x5e6a1c(0x244)](_0x5e6a1c(0x16d)+_0x23422f)):console['log'](_0x5e6a1c(0x12b)+_0x23422f);if(_0xb73206[_0x5e6a1c(0x1d8)]&&_0xb73206[_0x5e6a1c(0x234)]&&_0xb73206[_0x5e6a1c(0x224)]){console['log'](_0x5e6a1c(0x1b9));try{const _0x1da805=await this['decryptResponsePhp'](_0xb73206[_0x5e6a1c(0x1d8)],_0xb73206[_0x5e6a1c(0x234)],_0x23422f);_0x404124=JSON[_0x5e6a1c(0x14e)](_0x1da805),console['log'](_0x5e6a1c(0x145)),console['log'](_0x5e6a1c(0x15e),JSON[_0x5e6a1c(0x176)](_0x404124,null,0x2));}catch(_0x2113c5){console['error'](_0x5e6a1c(0x219),_0x2113c5),console[_0x5e6a1c(0x244)](_0x5e6a1c(0x24c)),_0x404124=_0xb73206;}}else console[_0x5e6a1c(0x244)]('📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0x16b8ab=_0x5e6a1c(0x152);if(_0x404124[_0x5e6a1c(0x225)]===0x64&&_0x404124[_0x5e6a1c(0x1bf)]===0x1)_0x16b8ab=_0x5e6a1c(0x17f);else{if(_0x404124['final']===0x0)_0x16b8ab=_0x5e6a1c(0x152);else _0x404124[_0x5e6a1c(0x1bf)]===0x1&&_0x404124[_0x5e6a1c(0x225)]!==0x64?_0x16b8ab=_0x5e6a1c(0x1ba):_0x16b8ab=_0x5e6a1c(0x152);}let _0x556897='';if(_0x404124[_0x5e6a1c(0x15b)])_0x556897=_0x404124[_0x5e6a1c(0x15b)][_0x5e6a1c(0x170)](),console[_0x5e6a1c(0x244)](_0x5e6a1c(0x1b2)+_0x23422f+'\x20order_id\x20for\x20search:\x20'+_0x556897);else _0x404124[_0x5e6a1c(0x165)]?(_0x556897=_0x404124['payment_id']['toString'](),console[_0x5e6a1c(0x244)](_0x5e6a1c(0x1b2)+_0x23422f+_0x5e6a1c(0x246)+_0x556897)):(_0x556897=_0x404124[_0x5e6a1c(0x1d1)]||_0x404124[_0x5e6a1c(0x21f)]||_0x404124['id']||'',console[_0x5e6a1c(0x244)](_0x5e6a1c(0x1cd)+_0x556897));console[_0x5e6a1c(0x244)](_0x5e6a1c(0x1de)+_0x23422f+'\x20webhook\x20extracted\x20data:'),console['log']('\x20\x20\x20Payment\x20ID:\x20'+_0x556897+_0x5e6a1c(0x1cc)+_0x404124['order_id']+_0x5e6a1c(0x226)+_0x404124[_0x5e6a1c(0x1d1)]+',\x20payment_id='+_0x404124[_0x5e6a1c(0x165)]+_0x5e6a1c(0x197)+_0x404124[_0x5e6a1c(0x21f)]+_0x5e6a1c(0x19f)+_0x404124['id']+')'),console[_0x5e6a1c(0x244)](_0x5e6a1c(0x171)+_0x16b8ab+'\x20(from:\x20status='+_0x404124[_0x5e6a1c(0x225)]+_0x5e6a1c(0x188)+_0x404124[_0x5e6a1c(0x1bf)]+')'),console['log'](_0x5e6a1c(0x16a)+_0x404124[_0x5e6a1c(0x236)]),console[_0x5e6a1c(0x244)]('\x20\x20\x20Currency:\x20'+_0x404124['currency']);let _0x13a8dc;_0x16b8ab===_0x5e6a1c(0x1ba)&&_0x404124[_0x5e6a1c(0x174)]&&(_0x13a8dc=_0x404124[_0x5e6a1c(0x174)],console[_0x5e6a1c(0x244)](_0x5e6a1c(0x218)+_0x13a8dc));const _0x3aba3a={'paymentId':_0x556897,'status':_0x16b8ab,'amount':_0x404124[_0x5e6a1c(0x236)],'currency':_0x404124[_0x5e6a1c(0x1a0)]};return _0x13a8dc&&(_0x3aba3a[_0x5e6a1c(0x1c8)]=_0x13a8dc),_0x3aba3a;}[a46_0x19c01b(0x1dc)](){const _0x4b294c=a46_0x19c01b;console[_0x4b294c(0x244)]('🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...');const _0x137a15=this[_0x4b294c(0x1ad)][_0x4b294c(0x1db)];for(const [_0x29ecbd]of this['statusCheckTimers']){this[_0x4b294c(0x179)](_0x29ecbd);}console[_0x4b294c(0x244)]('🛑\x20Stopped\x20'+_0x137a15+_0x4b294c(0x22c));}}exports[a46_0x19c01b(0x13a)]=VisaMasterCardService;