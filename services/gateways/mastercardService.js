'use strict';const a42_0x451713=a42_0x4edc;function a42_0x26aa(){const _0x41de09=['15439730oVvHow','createDecipheriv','3DS\x20URL:','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','keys','webhookEvents','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','orderId','parse','trim','Result\x20URL:','join','RSA_PKCS1_PADDING','Webhook\x20event\x20','7193445vgLxwN','❌\x20PHP\x20decryptor\x20request\x20failed:','cwd',',\x20Final:\x20','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','expire_month','json',',\x20body:\x20','getOwnPropertyDescriptor','randomBytes','🔐\x20RSA\x20signing\x20successful','error','stopAllStatusChecks','❌\x20Data\x20being\x20signed:','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','merchantPointId','...','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','signRSA','mastercard','slice','clearStatusTimers','decryptResponse','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','__importDefault','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','description','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','/charge','log','4JQdake','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','Status\x20decryption\x20failed:\x20','createSign','MasterCard\x20webhook\x20sent\x20to\x20','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','/charge_raw','createCipheriv','PENDING','Error\x20details:','3003780TZKcby','updatePaymentStatus','📝\x20Encrypted\x20data\x20length:','HTTP\x20','now','Unknown\x20error','validateKeyFiles','webhook_send','readFileSync','settings','),\x20stopping\x20status\x20checks','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','1111','\x20result:','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','3ds_url','\x20\x20\x20-\x20sign\x20length:','create','text','existsSync','payment_id','info','🧹\x20Clearing\x20','https://api.paydmeth.com/api','defineProperty','MasterCard\x20status\x20check\x20error:','5819490ohRDbV','payment.failed','✅\x20Payment\x20successful','unknown','HTTP\x20Status:','💾\x20Payment\x20data\x20prepared','key','number','processWebhook','status','floor','final','forEach','/status_decrypt','logWhiteDomainError','logWhiteDomainResponse','📊\x20Status\x20check\x20#','length','loggerService','FAILED','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','from','❌\x20MasterCard\x20key\x20validation\x20failed:','resolve','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','desc','Final:','stringify','logWhiteDomainRequest','Payment\x20ID:','decryptResponsePhp','includes','Response\x20Body:','Order\x20ID:','\x20MasterCard\x20status\x20check\x20timers','\x20\x20\x20-\x20method:\x20charge','then','✅\x20Scheduled\x20','Card\x20Number:','sendPaymentNotification','PAID','delete','encryptAES','system','toUpperCase','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','🔐\x20Data\x20encrypted\x20with\x20AES','logShopWebhookError','checkPaymentStatus','publicKeyPath','\x20failed\x20for\x20payment\x20','customerName','\x20\x20\x20-\x20key\x20length:','-----END','toLowerCase','📝\x20Signature\x20length:','251726sTwsjO','apiUrl','amount','Failed\x20to\x20send\x20MasterCard\x20webhook:','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','📊\x20Status\x20check\x20result:','constants','getOwnPropertyNames','end','🔐\x203DS\x20verification\x20required','createdAt','6780036hgaEui','****\x20****\x20****\x20','webhookUrl','expire_year','application/json','/status_raw','paidAt','get','❌\x20RSA\x20encryption\x20failed:','MasterCard:\x20','🔐\x20AES\x20key\x20length:','🔐\x20Private\x20key\x20length:\x20','first_name','\x20with\x20status\x20','MasterCardService','🔐\x20Public\x20key\x20path:','../telegramBotService','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','update','\x20\x20\x20-\x20lang:\x20en','maskCardNumber','paid','statusCheckTimers','prototype','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','default','order_id','__esModule','decryptAES','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','https://api2.trapay.uk/decrypt.php','toString','🔐\x20Data\x20signed\x20with\x20RSA','set','date_success','currency','\x20characters','encryptRSA','shopId',',\x20Desc:\x20','replace','processCardPayment','hasOwnProperty','🛑\x20Stopped\x20','logShopWebhookSent','sendShopWebhook','PHP\x20decryptor\x20error','5fxbIxt','Private\x20key\x20file\x20not\x20found:\x20','/status','/charge_decrypt','last_name','size','Return\x20URL:','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','message','Failed\x20to\x20decrypt\x20response','-----BEGIN','shop','psp_public.pem','🔐\x20Public\x20key\x20length:\x20','utf8','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','\x20status\x20updated\x20to\x20','333KiBFkg','generateAESKey','aes-256-ctr','sendPaymentNotifications','⏰\x20Will\x20check\x20status\x20','HTTP\x20error!\x20status:\x20','\x20\x20\x20-\x20info\x20length:','🔐\x20Private\x20key\x20path:','__createBinding','privateKeyPath','call','Card\x20Holder:','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','/charge_decrypted','\x20is\x20final\x20(','POST','../loggerService','crypto','🔐\x20AES\x20IV\x20length:','✅\x20Payment\x20','base64','charge','failed','****','10504HwkGYs','Status:','sign','../../config/database','Public\x20key\x20file\x20not\x20found:\x20','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','📝\x20Final\x20request\x20structure:','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','📝\x20Data\x20length:','/status_decrypted','\x20status\x20timers\x20for\x20payment\x20','SHA256','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'];a42_0x26aa=function(){return _0x41de09;};return a42_0x26aa();}(function(_0x3d00cb,_0x1f57f5){const _0x35ea65=a42_0x4edc,_0x31a2e8=_0x3d00cb();while(!![]){try{const _0x2f9196=-parseInt(_0x35ea65(0x15a))/0x1*(parseInt(_0x35ea65(0x21a))/0x2)+parseInt(_0x35ea65(0x1c8))/0x3+parseInt(_0x35ea65(0x1be))/0x4*(-parseInt(_0x35ea65(0x1e2))/0x5)+-parseInt(_0x35ea65(0x225))/0x6+parseInt(_0x35ea65(0x1a0))/0x7+parseInt(_0x35ea65(0x183))/0x8*(parseInt(_0x35ea65(0x16b))/0x9)+parseInt(_0x35ea65(0x191))/0xa;if(_0x2f9196===_0x1f57f5)break;else _0x31a2e8['push'](_0x31a2e8['shift']());}catch(_0x3e4317){_0x31a2e8['push'](_0x31a2e8['shift']());}}}(a42_0x26aa,0xaa776));var __createBinding=this&&this[a42_0x451713(0x173)]||(Object[a42_0x451713(0x1d9)]?function(_0x3578ab,_0x23c283,_0x1961c7,_0xa22aab){const _0x2fcab7=a42_0x451713;if(_0xa22aab===undefined)_0xa22aab=_0x1961c7;var _0x3aa0ee=Object[_0x2fcab7(0x1a8)](_0x23c283,_0x1961c7);(!_0x3aa0ee||('get'in _0x3aa0ee?!_0x23c283['__esModule']:_0x3aa0ee['writable']||_0x3aa0ee['configurable']))&&(_0x3aa0ee={'enumerable':!![],'get':function(){return _0x23c283[_0x1961c7];}}),Object[_0x2fcab7(0x1e0)](_0x3578ab,_0xa22aab,_0x3aa0ee);}:function(_0x144291,_0x794f87,_0x4ff68a,_0x52ae70){if(_0x52ae70===undefined)_0x52ae70=_0x4ff68a;_0x144291[_0x52ae70]=_0x794f87[_0x4ff68a];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x5eec9d,_0x5820f0){const _0x1b389d=a42_0x451713;Object[_0x1b389d(0x1e0)](_0x5eec9d,_0x1b389d(0x23e),{'enumerable':!![],'value':_0x5820f0});}:function(_0x36dbe2,_0x15f96c){const _0x192b1a=a42_0x451713;_0x36dbe2[_0x192b1a(0x23e)]=_0x15f96c;}),__importStar=this&&this['__importStar']||(function(){var _0x505331=function(_0x710a04){const _0x592eac=a42_0x4edc;return _0x505331=Object[_0x592eac(0x221)]||function(_0x11a756){const _0x5eb716=_0x592eac;var _0x28e1a1=[];for(var _0x214a00 in _0x11a756)if(Object[_0x5eb716(0x23c)][_0x5eb716(0x24f)][_0x5eb716(0x175)](_0x11a756,_0x214a00))_0x28e1a1[_0x28e1a1[_0x5eb716(0x1f3)]]=_0x214a00;return _0x28e1a1;},_0x505331(_0x710a04);};return function(_0x1b34b7){const _0x3b0e57=a42_0x4edc;if(_0x1b34b7&&_0x1b34b7[_0x3b0e57(0x240)])return _0x1b34b7;var _0x3b5af9={};if(_0x1b34b7!=null){for(var _0x1f4c5f=_0x505331(_0x1b34b7),_0x54ef7e=0x0;_0x54ef7e<_0x1f4c5f[_0x3b0e57(0x1f3)];_0x54ef7e++)if(_0x1f4c5f[_0x54ef7e]!=='default')__createBinding(_0x3b5af9,_0x1b34b7,_0x1f4c5f[_0x54ef7e]);}return __setModuleDefault(_0x3b5af9,_0x1b34b7),_0x3b5af9;};}()),__importDefault=this&&this[a42_0x451713(0x1b8)]||function(_0x2b03e7){return _0x2b03e7&&_0x2b03e7['__esModule']?_0x2b03e7:{'default':_0x2b03e7};};Object[a42_0x451713(0x1e0)](exports,a42_0x451713(0x240),{'value':!![]}),exports[a42_0x451713(0x233)]=void 0x0;const crypto_1=__importDefault(require(a42_0x451713(0x17c))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a42_0x451713(0x17b));function a42_0x4edc(_0x4df4b4,_0x3eb5d7){const _0x26aaad=a42_0x26aa();return a42_0x4edc=function(_0x4edc75,_0x27d55c){_0x4edc75=_0x4edc75-0x159;let _0x57a5e5=_0x26aaad[_0x4edc75];return _0x57a5e5;},a42_0x4edc(_0x4df4b4,_0x3eb5d7);}class MasterCardService{constructor(){const _0x4a2985=a42_0x451713;this['statusCheckTimers']=new Map(),this['apiUrl']=_0x4a2985(0x1df),this[_0x4a2985(0x1af)]=0x67c,this[_0x4a2985(0x174)]=path_1['default'][_0x4a2985(0x19d)](process[_0x4a2985(0x1a2)](),_0x4a2985(0x196),'private.pem'),this[_0x4a2985(0x213)]=path_1[_0x4a2985(0x23e)][_0x4a2985(0x19d)](process[_0x4a2985(0x1a2)](),_0x4a2985(0x196),_0x4a2985(0x166)),console[_0x4a2985(0x1bd)]('💳\x20MasterCard\x20service\x20initialized'),console[_0x4a2985(0x1bd)](_0x4a2985(0x172),this[_0x4a2985(0x174)]),console['log'](_0x4a2985(0x234),this[_0x4a2985(0x213)]),this[_0x4a2985(0x1ce)]();}[a42_0x451713(0x1ce)](){const _0x3b162e=a42_0x451713;try{if(!fs_1[_0x3b162e(0x23e)][_0x3b162e(0x1db)](this['privateKeyPath']))throw new Error(_0x3b162e(0x15b)+this[_0x3b162e(0x174)]);if(!fs_1[_0x3b162e(0x23e)][_0x3b162e(0x1db)](this['publicKeyPath']))throw new Error(_0x3b162e(0x187)+this[_0x3b162e(0x213)]);const _0x7b45bd=fs_1[_0x3b162e(0x23e)]['readFileSync'](this['privateKeyPath'],_0x3b162e(0x168))[_0x3b162e(0x19b)](),_0x27b5c8=fs_1[_0x3b162e(0x23e)][_0x3b162e(0x1d0)](this[_0x3b162e(0x213)],_0x3b162e(0x168))['trim']();if(!_0x7b45bd[_0x3b162e(0x201)](_0x3b162e(0x164))||!_0x7b45bd['includes'](_0x3b162e(0x217)))throw new Error(_0x3b162e(0x195));if(!_0x27b5c8[_0x3b162e(0x201)](_0x3b162e(0x164))||!_0x27b5c8['includes'](_0x3b162e(0x217)))throw new Error(_0x3b162e(0x20f));console[_0x3b162e(0x1bd)](_0x3b162e(0x1c3)),console[_0x3b162e(0x1bd)](_0x3b162e(0x230)+_0x7b45bd[_0x3b162e(0x1f3)]+'\x20characters'),console[_0x3b162e(0x1bd)](_0x3b162e(0x167)+_0x27b5c8[_0x3b162e(0x1f3)]+_0x3b162e(0x249));}catch(_0x30f630){console[_0x3b162e(0x1ab)](_0x3b162e(0x1f8),_0x30f630);throw _0x30f630;}}[a42_0x451713(0x16c)](){const _0x146366=a42_0x451713,_0xb5664d=crypto_1[_0x146366(0x23e)]['randomBytes'](0x20),_0x3c0533=crypto_1[_0x146366(0x23e)][_0x146366(0x1a9)](0x10);return{'key':_0xb5664d,'iv':_0x3c0533};}['encryptAES'](_0xf13725,_0x422a05,_0x2c608e){const _0x3239c9=a42_0x451713,_0x4f3b43=crypto_1['default'][_0x3239c9(0x1c5)](_0x3239c9(0x16d),_0x422a05,_0x2c608e);let _0x3c5c9d=_0x4f3b43[_0x3239c9(0x237)](_0xf13725,_0x3239c9(0x168),_0x3239c9(0x17f));return _0x3c5c9d+=_0x4f3b43[_0x3239c9(0x1ed)]('base64'),_0x3c5c9d;}[a42_0x451713(0x24a)](_0x4fa40b,_0x2badca){const _0x1e5c7a=a42_0x451713;try{const _0x4564d2=fs_1[_0x1e5c7a(0x23e)]['readFileSync'](this[_0x1e5c7a(0x213)],_0x1e5c7a(0x168))[_0x1e5c7a(0x19b)](),_0x5022d8={'iv':_0x2badca[_0x1e5c7a(0x244)](_0x1e5c7a(0x17f)),'key':_0x4fa40b[_0x1e5c7a(0x244)](_0x1e5c7a(0x17f))},_0x8bdf7a=JSON[_0x1e5c7a(0x1fd)](_0x5022d8);console[_0x1e5c7a(0x1bd)](_0x1e5c7a(0x21e),_0x8bdf7a[_0x1e5c7a(0x1f3)]);const _0x441f12=crypto_1[_0x1e5c7a(0x23e)]['publicEncrypt']({'key':_0x4564d2,'padding':crypto_1[_0x1e5c7a(0x23e)][_0x1e5c7a(0x220)][_0x1e5c7a(0x19e)]},Buffer[_0x1e5c7a(0x1f7)](_0x8bdf7a));return console[_0x1e5c7a(0x1bd)](_0x1e5c7a(0x169),_0x441f12[_0x1e5c7a(0x1f3)]),_0x441f12[_0x1e5c7a(0x244)](_0x1e5c7a(0x17f));}catch(_0x1d28ad){console['error'](_0x1e5c7a(0x22d),_0x1d28ad);throw new Error(_0x1e5c7a(0x1bb));}}[a42_0x451713(0x1b2)](_0x4b240c){const _0xcc1f64=a42_0x451713;try{const _0x7bb0f0=fs_1[_0xcc1f64(0x23e)][_0xcc1f64(0x1d0)](this[_0xcc1f64(0x174)],_0xcc1f64(0x168))['trim'](),_0x391ed5=crypto_1[_0xcc1f64(0x23e)][_0xcc1f64(0x1c1)](_0xcc1f64(0x18e));_0x391ed5[_0xcc1f64(0x237)](_0x4b240c),_0x391ed5[_0xcc1f64(0x222)]();const _0x25ec95=_0x391ed5['sign'](_0x7bb0f0,_0xcc1f64(0x17f));return console[_0xcc1f64(0x1bd)](_0xcc1f64(0x1aa)),console[_0xcc1f64(0x1bd)]('📝\x20Data\x20to\x20sign\x20length:',_0x4b240c[_0xcc1f64(0x1f3)]),console['log']('📝\x20Signature\x20length:',_0x25ec95[_0xcc1f64(0x1f3)]),_0x25ec95;}catch(_0x49600d){console[_0xcc1f64(0x1ab)]('❌\x20RSA\x20signing\x20failed:',_0x49600d),console[_0xcc1f64(0x1ab)](_0xcc1f64(0x1ad),_0x4b240c['substring'](0x0,0xc8)+_0xcc1f64(0x1b0));throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}[a42_0x451713(0x241)](_0x47dab1,_0x5cac94,_0x285f2f){const _0x3cac2d=a42_0x451713,_0x3faab2=crypto_1[_0x3cac2d(0x23e)][_0x3cac2d(0x192)]('aes-256-ctr',_0x5cac94,_0x285f2f);let _0x48e701=_0x3faab2[_0x3cac2d(0x237)](_0x47dab1,_0x3cac2d(0x17f),_0x3cac2d(0x168));return _0x48e701+=_0x3faab2['final'](_0x3cac2d(0x168)),_0x48e701;}async[a42_0x451713(0x200)](_0x2f07da,_0x315e84){const _0x54931b=a42_0x451713;try{const _0xb655d7=await fetch(_0x54931b(0x243),{'method':_0x54931b(0x17a),'headers':{'Content-Type':_0x54931b(0x229)},'body':JSON[_0x54931b(0x1fd)]({'info':_0x2f07da,'key':_0x315e84})});if(!_0xb655d7['ok'])throw new Error(_0x54931b(0x159));return await _0xb655d7[_0x54931b(0x1da)]();}catch(_0x72edcf){console[_0x54931b(0x1ab)](_0x54931b(0x1a1),_0x72edcf);throw new Error(_0x54931b(0x1d3));}}[a42_0x451713(0x1b6)](_0x1a1376,_0x1fe152){const _0x5552f6=a42_0x451713;try{const _0x4c0b04=fs_1['default'][_0x5552f6(0x1d0)](this[_0x5552f6(0x174)],_0x5552f6(0x168))[_0x5552f6(0x19b)](),_0x10e5b2=crypto_1[_0x5552f6(0x23e)]['privateDecrypt'](_0x4c0b04,Buffer[_0x5552f6(0x1f7)](_0x1fe152,_0x5552f6(0x17f))),_0x3e585e=JSON[_0x5552f6(0x19a)](_0x10e5b2[_0x5552f6(0x244)]()),_0x3e5e08=Buffer[_0x5552f6(0x1f7)](_0x3e585e[_0x5552f6(0x1e8)],_0x5552f6(0x17f)),_0x55c0af=Buffer[_0x5552f6(0x1f7)](_0x3e585e['iv'],_0x5552f6(0x17f));return this[_0x5552f6(0x241)](_0x1a1376,_0x3e5e08,_0x55c0af);}catch(_0x2c0630){throw new Error(_0x5552f6(0x163));}}async[a42_0x451713(0x24e)](_0x504e7f){const _0x201e0d=a42_0x451713,{paymentId:_0x50623c,orderId:_0x27fa12,amount:_0x32e8fd,currency:_0x34d894,cardData:_0x2a319d,resultUrl:_0xcfb636,returnUrl:_0x31530a,cardHolder:_0x181496,browser:_0x42b323}=_0x504e7f;console[_0x201e0d(0x1bd)](_0x201e0d(0x1b7)),console[_0x201e0d(0x1bd)](_0x201e0d(0x1ff),_0x50623c),console[_0x201e0d(0x1bd)](_0x201e0d(0x203),_0x27fa12),console[_0x201e0d(0x1bd)]('Amount:',_0x32e8fd,_0x34d894),console['log'](_0x201e0d(0x208),this[_0x201e0d(0x239)](_0x2a319d[_0x201e0d(0x1e9)])),console[_0x201e0d(0x1bd)](_0x201e0d(0x176),_0x181496[_0x201e0d(0x231)]+'\x20'+_0x181496[_0x201e0d(0x15e)]),console['log'](_0x201e0d(0x160),_0x31530a),console['log'](_0x201e0d(0x19c),_0xcfb636);const _0x443298={'amount':_0x32e8fd,'currency':_0x34d894[_0x201e0d(0x20e)](),'order_id':_0x27fa12,'result_url':_0xcfb636,'return_url':_0x31530a,'card':{'number':_0x2a319d[_0x201e0d(0x1e9)],'expire_month':_0x2a319d[_0x201e0d(0x1a5)],'expire_year':_0x2a319d[_0x201e0d(0x228)],'cvv':_0x2a319d['cvv']},'card_holder':_0x181496,'browser':_0x42b323},_0x4accfc=JSON[_0x201e0d(0x1fd)](_0x443298);console[_0x201e0d(0x1bd)](_0x201e0d(0x1e7)),console['log']('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console['log'](_0x4accfc),console[_0x201e0d(0x1bd)](_0x201e0d(0x18b),_0x4accfc[_0x201e0d(0x1f3)]);try{const {key:_0x536221,iv:_0x16e4b9}=this[_0x201e0d(0x16c)]();console[_0x201e0d(0x1bd)]('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console['log'](_0x201e0d(0x22f),_0x536221[_0x201e0d(0x1f3)]),console[_0x201e0d(0x1bd)](_0x201e0d(0x17d),_0x16e4b9[_0x201e0d(0x1f3)]);const _0x12572c=this[_0x201e0d(0x20c)](_0x4accfc,_0x536221,_0x16e4b9);console['log'](_0x201e0d(0x210)),console[_0x201e0d(0x1bd)](_0x201e0d(0x1ca),_0x12572c[_0x201e0d(0x1f3)]);const _0x2f28e2=this[_0x201e0d(0x24a)](_0x536221,_0x16e4b9);console[_0x201e0d(0x1bd)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x201e0d(0x1bd)]('📝\x20Encrypted\x20key\x20length:',_0x2f28e2[_0x201e0d(0x1f3)]);const _0x49a131=this['signRSA'](_0x4accfc);console[_0x201e0d(0x1bd)](_0x201e0d(0x245)),console['log'](_0x201e0d(0x219),_0x49a131['length']);const _0x38ce52={'merchant_point_id':this[_0x201e0d(0x1af)],'method':_0x201e0d(0x180),'info':_0x12572c,'key':_0x2f28e2,'sign':_0x49a131,'lang':'en'};console[_0x201e0d(0x1bd)]('📤\x20Sending\x20request\x20to\x20MasterCard\x20API...'),console[_0x201e0d(0x1bd)](_0x201e0d(0x189)),console[_0x201e0d(0x1bd)]('\x20\x20\x20-\x20merchant_point_id:',this[_0x201e0d(0x1af)]),console[_0x201e0d(0x1bd)](_0x201e0d(0x205)),console['log'](_0x201e0d(0x171),_0x12572c[_0x201e0d(0x1f3)]),console[_0x201e0d(0x1bd)](_0x201e0d(0x216),_0x2f28e2[_0x201e0d(0x1f3)]),console['log'](_0x201e0d(0x1d8),_0x49a131['length']),console[_0x201e0d(0x1bd)](_0x201e0d(0x238)),loggerService_1['loggerService'][_0x201e0d(0x1fe)](_0x201e0d(0x1b3),_0x201e0d(0x1bc),_0x201e0d(0x17a),{'merchant_point_id':this['merchantPointId'],'method':_0x201e0d(0x180),'lang':'en'});const _0x298eed=Date[_0x201e0d(0x1cc)](),_0x32e74b=await fetch(this[_0x201e0d(0x21b)],{'method':_0x201e0d(0x17a),'headers':{'Content-Type':_0x201e0d(0x229),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x201e0d(0x1fd)](_0x38ce52)}),_0x37afbb=Date[_0x201e0d(0x1cc)]()-_0x298eed;console['log'](_0x201e0d(0x177)),console[_0x201e0d(0x1bd)]('Status:',_0x32e74b[_0x201e0d(0x1eb)]),console[_0x201e0d(0x1bd)]('Response\x20Time:',_0x37afbb+'ms');if(!_0x32e74b['ok']){const _0x158197=await _0x32e74b[_0x201e0d(0x1da)]();console[_0x201e0d(0x1ab)](_0x201e0d(0x1e6),_0x32e74b[_0x201e0d(0x1eb)]),console['error'](_0x201e0d(0x202),_0x158197),loggerService_1['loggerService'][_0x201e0d(0x1f1)](_0x201e0d(0x1b3),_0x201e0d(0x1c4),_0x32e74b[_0x201e0d(0x1eb)],_0x158197,_0x37afbb),loggerService_1[_0x201e0d(0x1f4)][_0x201e0d(0x1f0)](_0x201e0d(0x1b3),'/charge',_0x201e0d(0x1cb)+_0x32e74b[_0x201e0d(0x1eb)]+':\x20'+_0x158197);throw new Error(_0x201e0d(0x170)+_0x32e74b[_0x201e0d(0x1eb)]+_0x201e0d(0x1a7)+_0x158197);}const _0x1fcab7=await _0x32e74b[_0x201e0d(0x1a6)]();loggerService_1[_0x201e0d(0x1f4)]['logWhiteDomainResponse']('mastercard','/charge_raw',_0x32e74b[_0x201e0d(0x1eb)],_0x1fcab7,_0x37afbb),console[_0x201e0d(0x1bd)](_0x201e0d(0x18f));let _0x3f897e=_0x1fcab7;if(_0x1fcab7[_0x201e0d(0x1dd)]&&_0x1fcab7[_0x201e0d(0x1e8)]&&_0x1fcab7[_0x201e0d(0x185)]){console[_0x201e0d(0x1bd)](_0x201e0d(0x1b1));try{const _0x3bacc7=await this[_0x201e0d(0x200)](_0x1fcab7[_0x201e0d(0x1dd)],_0x1fcab7[_0x201e0d(0x1e8)]);_0x3f897e=JSON[_0x201e0d(0x19a)](_0x3bacc7),console[_0x201e0d(0x1bd)](_0x201e0d(0x1bf)),loggerService_1[_0x201e0d(0x1f4)][_0x201e0d(0x1f1)]('mastercard',_0x201e0d(0x178),_0x32e74b[_0x201e0d(0x1eb)],_0x3f897e,_0x37afbb),console[_0x201e0d(0x1bd)](_0x201e0d(0x1d6));}catch(_0x56a5d3){console['error'](_0x201e0d(0x1ae),_0x56a5d3),loggerService_1[_0x201e0d(0x1f4)]['logWhiteDomainError'](_0x201e0d(0x1b3),_0x201e0d(0x15d),'Decryption\x20failed:\x20'+_0x56a5d3),_0x3f897e=_0x1fcab7;}}else loggerService_1['loggerService'][_0x201e0d(0x1f1)](_0x201e0d(0x1b3),_0x201e0d(0x178),_0x32e74b[_0x201e0d(0x1eb)],_0x3f897e,_0x37afbb),console[_0x201e0d(0x1bd)](_0x201e0d(0x236));console[_0x201e0d(0x1bd)](_0x201e0d(0x184),_0x3f897e[_0x201e0d(0x1eb)]),console[_0x201e0d(0x1bd)](_0x201e0d(0x1fc),_0x3f897e[_0x201e0d(0x1ed)]),console[_0x201e0d(0x1bd)](_0x201e0d(0x1ff),_0x3f897e[_0x201e0d(0x1dc)]),console['log'](_0x201e0d(0x193),_0x3f897e[_0x201e0d(0x1d7)]||'none');if(_0x3f897e[_0x201e0d(0x1eb)]===0x64&&_0x3f897e[_0x201e0d(0x1ed)]===0x1)return console[_0x201e0d(0x1bd)](_0x201e0d(0x1e4)),{'gateway_payment_id':_0x3f897e[_0x201e0d(0x1dc)]?.[_0x201e0d(0x244)](),'payment_url':_0x31530a,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x3f897e[_0x201e0d(0x1d7)])return console[_0x201e0d(0x1bd)](_0x201e0d(0x223)),this['scheduleStatusChecks'](_0x50623c,_0x27fa12,_0x3f897e[_0x201e0d(0x1dc)]?.[_0x201e0d(0x244)]()||_0x27fa12),{'gateway_payment_id':_0x3f897e[_0x201e0d(0x1dc)]?.[_0x201e0d(0x244)](),'payment_url':_0x3f897e['3ds_url'],'requires_3ds':!![],'threeds_url':_0x3f897e[_0x201e0d(0x1d7)],'status':_0x201e0d(0x1c6),'final':![]};let _0x4cd9c2=_0x3f897e[_0x201e0d(0x1fb)]||_0x3f897e[_0x201e0d(0x162)]||_0x201e0d(0x1cd),_0xb8526c=_0x3f897e[_0x201e0d(0x1eb)],_0x13147b=_0x3f897e[_0x201e0d(0x1ed)];return console[_0x201e0d(0x1bd)](_0x201e0d(0x190)+_0xb8526c+_0x201e0d(0x1a3)+_0x13147b+_0x201e0d(0x24c)+_0x4cd9c2),{'gateway_payment_id':_0x3f897e['payment_id']?.[_0x201e0d(0x244)](),'payment_url':_0x31530a,'requires_3ds':![],'status':'FAILED','final':!![]};}catch(_0x53b494){console[_0x201e0d(0x1ab)]('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console[_0x201e0d(0x1ab)](_0x201e0d(0x1c7),_0x53b494),loggerService_1['loggerService']['logWhiteDomainError'](_0x201e0d(0x1b3),_0x201e0d(0x1bc),_0x53b494);throw new Error('Failed\x20to\x20process\x20MasterCard\x20payment:\x20'+(_0x53b494 instanceof Error?_0x53b494[_0x201e0d(0x162)]:'Unknown\x20error'));}}async['checkPaymentStatus'](_0x2a1dc6,_0x56067d){const _0x3f6d93=a42_0x451713;console[_0x3f6d93(0x1bd)](_0x3f6d93(0x1a4)+_0x2a1dc6+'\x20('+_0x56067d+')');try{const _0x2a6beb={'payment_id':_0x2a1dc6,'order_id':_0x56067d},_0x1a9080=JSON[_0x3f6d93(0x1fd)](_0x2a6beb),{key:_0x1a55eb,iv:_0xe0f221}=this[_0x3f6d93(0x16c)](),_0x5076c8=this[_0x3f6d93(0x20c)](_0x1a9080,_0x1a55eb,_0xe0f221),_0x50f39b=this[_0x3f6d93(0x24a)](_0x1a55eb,_0xe0f221),_0x1c5aa6=this[_0x3f6d93(0x1b2)](_0x1a9080),_0x3c6766={'merchant_point_id':this[_0x3f6d93(0x1af)],'method':_0x3f6d93(0x1eb),'info':_0x5076c8,'key':_0x50f39b,'sign':_0x1c5aa6,'lang':'en'};loggerService_1['loggerService'][_0x3f6d93(0x1fe)](_0x3f6d93(0x1b3),_0x3f6d93(0x15c),_0x3f6d93(0x17a),{'merchant_point_id':this[_0x3f6d93(0x1af)],'method':_0x3f6d93(0x1eb),'lang':'en'});const _0x1df52f=Date[_0x3f6d93(0x1cc)](),_0x182e7d=await fetch(this[_0x3f6d93(0x21b)],{'method':_0x3f6d93(0x17a),'headers':{'Content-Type':_0x3f6d93(0x229),'Accept':_0x3f6d93(0x229),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x3f6d93(0x1fd)](_0x3c6766)}),_0xb52663=Date[_0x3f6d93(0x1cc)]()-_0x1df52f;if(!_0x182e7d['ok']){const _0x1bdd2e=await _0x182e7d['text']();loggerService_1[_0x3f6d93(0x1f4)][_0x3f6d93(0x1f1)](_0x3f6d93(0x1b3),_0x3f6d93(0x22a),_0x182e7d[_0x3f6d93(0x1eb)],_0x1bdd2e,_0xb52663);throw new Error(_0x3f6d93(0x170)+_0x182e7d[_0x3f6d93(0x1eb)]);}const _0xcbafb7=await _0x182e7d['json']();loggerService_1[_0x3f6d93(0x1f4)][_0x3f6d93(0x1f1)]('mastercard',_0x3f6d93(0x22a),_0x182e7d['status'],_0xcbafb7,_0xb52663);let _0x1b0488=_0xcbafb7;if(_0xcbafb7[_0x3f6d93(0x1dd)]&&_0xcbafb7['key']&&_0xcbafb7[_0x3f6d93(0x185)]){console[_0x3f6d93(0x1bd)](_0x3f6d93(0x1fa));try{const _0x2f8255=this[_0x3f6d93(0x1b6)](_0xcbafb7[_0x3f6d93(0x1dd)],_0xcbafb7['key']);_0x1b0488=JSON[_0x3f6d93(0x19a)](_0x2f8255),console[_0x3f6d93(0x1bd)]('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x3f6d93(0x1f4)][_0x3f6d93(0x1f1)]('mastercard',_0x3f6d93(0x18c),_0x182e7d[_0x3f6d93(0x1eb)],_0x1b0488,_0xb52663),console[_0x3f6d93(0x1bd)](_0x3f6d93(0x188));}catch(_0x6ccb8b){console['error']('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x6ccb8b),loggerService_1[_0x3f6d93(0x1f4)]['logWhiteDomainError'](_0x3f6d93(0x1b3),_0x3f6d93(0x1ef),_0x3f6d93(0x1c0)+_0x6ccb8b),_0x1b0488=_0xcbafb7;}}else loggerService_1[_0x3f6d93(0x1f4)][_0x3f6d93(0x1f1)](_0x3f6d93(0x1b3),_0x3f6d93(0x18c),_0x182e7d['status'],_0x1b0488,_0xb52663),console[_0x3f6d93(0x1bd)](_0x3f6d93(0x23d));console['log'](_0x3f6d93(0x21f),{'status':_0x1b0488[_0x3f6d93(0x1eb)],'final':_0x1b0488[_0x3f6d93(0x1ed)],'payment_id':_0x1b0488[_0x3f6d93(0x1dc)],'desc':_0x1b0488[_0x3f6d93(0x1fb)]});let _0x2b5e88='PENDING';if(_0x1b0488[_0x3f6d93(0x1eb)]===0x1&&_0x1b0488[_0x3f6d93(0x1ed)]===0x1)_0x2b5e88=_0x3f6d93(0x20a);else _0x1b0488[_0x3f6d93(0x1eb)]===0x0&&_0x1b0488[_0x3f6d93(0x1ed)]===0x0?_0x2b5e88='PENDING':_0x2b5e88=_0x3f6d93(0x1f5);return{'status':_0x2b5e88,'final':_0x1b0488[_0x3f6d93(0x1ed)]===0x1,'amount':_0x1b0488['amount'],'currency':_0x1b0488[_0x3f6d93(0x248)],'date_success':_0x1b0488[_0x3f6d93(0x247)],'description':_0x1b0488[_0x3f6d93(0x1fb)]};}catch(_0x24f3f){console[_0x3f6d93(0x1ab)](_0x3f6d93(0x1e1),_0x24f3f),loggerService_1[_0x3f6d93(0x1f4)][_0x3f6d93(0x1f0)](_0x3f6d93(0x1b3),'/status',_0x24f3f);throw new Error(_0x3f6d93(0x194)+(_0x24f3f instanceof Error?_0x24f3f[_0x3f6d93(0x162)]:_0x3f6d93(0x1cd)));}}['scheduleStatusChecks'](_0x1e6218,_0x9e0642,_0x2fc932){const _0x43eefc=a42_0x451713;console[_0x43eefc(0x1bd)](_0x43eefc(0x1b9)+_0x1e6218+'\x20('+_0x2fc932+')'),this[_0x43eefc(0x1b5)](_0x1e6218);const _0x278f2d=[],_0x11af06=0x5*0x3c*0x3e8,_0x4a794b=0x2*0x3c*0x3c*0x3e8,_0x1d37fb=Math[_0x43eefc(0x1ec)](_0x4a794b/_0x11af06);console[_0x43eefc(0x1bd)](_0x43eefc(0x16f)+_0x1d37fb+_0x43eefc(0x198));for(let _0x24976a=0x1;_0x24976a<=_0x1d37fb;_0x24976a++){const _0x2c3e5a=setTimeout(async()=>{const _0x2d5efd=_0x43eefc;console[_0x2d5efd(0x1bd)]('🔍\x20MasterCard\x20status\x20check\x20#'+_0x24976a+'/'+_0x1d37fb+'\x20for\x20payment\x20'+_0x1e6218);try{const _0x2b05e1=await this[_0x2d5efd(0x212)](_0x2fc932,_0x9e0642);console[_0x2d5efd(0x1bd)](_0x2d5efd(0x1f2)+_0x24976a+_0x2d5efd(0x1d5),_0x2b05e1),_0x2b05e1[_0x2d5efd(0x1ed)]&&(console[_0x2d5efd(0x1bd)](_0x2d5efd(0x17e)+_0x1e6218+_0x2d5efd(0x179)+_0x2b05e1[_0x2d5efd(0x1eb)]+_0x2d5efd(0x1d2)),this[_0x2d5efd(0x1b5)](_0x1e6218),await this[_0x2d5efd(0x1c9)](_0x1e6218,_0x2b05e1[_0x2d5efd(0x1eb)],_0x2b05e1));}catch(_0x5877a2){console[_0x2d5efd(0x1ab)]('❌\x20Status\x20check\x20#'+_0x24976a+_0x2d5efd(0x214)+_0x1e6218+':',_0x5877a2);}},_0x24976a*_0x11af06);_0x278f2d['push'](_0x2c3e5a);}this['statusCheckTimers'][_0x43eefc(0x246)](_0x1e6218,_0x278f2d),console[_0x43eefc(0x1bd)](_0x43eefc(0x207)+_0x1d37fb+'\x20status\x20checks\x20for\x20payment\x20'+_0x1e6218);}[a42_0x451713(0x1b5)](_0x322144){const _0x2686b6=a42_0x451713,_0x3fc88f=this[_0x2686b6(0x23b)][_0x2686b6(0x22c)](_0x322144);_0x3fc88f&&(console[_0x2686b6(0x1bd)](_0x2686b6(0x1de)+_0x3fc88f['length']+_0x2686b6(0x18d)+_0x322144),_0x3fc88f[_0x2686b6(0x1ee)]((_0x592f50,_0x41df0a)=>{clearTimeout(_0x592f50);}),this['statusCheckTimers'][_0x2686b6(0x20b)](_0x322144));}async[a42_0x451713(0x1c9)](_0x30e9c3,_0x246ed3,_0x507075){const _0x8a6b=a42_0x451713;try{const _0x55fe43=(await Promise['resolve']()[_0x8a6b(0x206)](()=>__importStar(require(_0x8a6b(0x186)))))[_0x8a6b(0x23e)],_0x838368={'status':_0x246ed3[_0x8a6b(0x20e)](),'updatedAt':new Date(),'statusChangedBy':_0x8a6b(0x20d),'statusChangedAt':new Date()};_0x246ed3===_0x8a6b(0x20a)&&(_0x838368[_0x8a6b(0x22b)]=new Date()),_0x507075[_0x8a6b(0x1ba)]&&(_0x838368['adminNotes']=_0x8a6b(0x22e)+_0x507075[_0x8a6b(0x1ba)]),await _0x55fe43['payment'][_0x8a6b(0x237)]({'where':{'id':_0x30e9c3},'data':_0x838368}),console[_0x8a6b(0x1bd)](_0x8a6b(0x17e)+_0x30e9c3+_0x8a6b(0x16a)+_0x246ed3),await this['sendPaymentNotifications'](_0x30e9c3,_0x246ed3);}catch(_0x51f921){console[_0x8a6b(0x1ab)](_0x8a6b(0x1f6)+_0x30e9c3+':',_0x51f921);}}async[a42_0x451713(0x16e)](_0x2efd5b,_0x51f997){const _0xf5ef4f=a42_0x451713;try{const _0x540ff7=(await Promise[_0xf5ef4f(0x1f9)]()[_0xf5ef4f(0x206)](()=>__importStar(require(_0xf5ef4f(0x186)))))[_0xf5ef4f(0x23e)],{telegramBotService:_0xc90769}=await Promise[_0xf5ef4f(0x1f9)]()[_0xf5ef4f(0x206)](()=>__importStar(require(_0xf5ef4f(0x235)))),_0x46a5d4=await _0x540ff7['payment']['findUnique']({'where':{'id':_0x2efd5b},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x46a5d4)return;const _0x1ff9a4={'PAID':_0xf5ef4f(0x23a),'FAILED':_0xf5ef4f(0x181)},_0x431aae=_0x1ff9a4[_0x51f997];_0x431aae&&await _0xc90769[_0xf5ef4f(0x209)](_0x46a5d4['shopId'],_0x46a5d4,_0x431aae),await this[_0xf5ef4f(0x252)](_0x46a5d4,_0x51f997);}catch(_0x3f1b8e){console[_0xf5ef4f(0x1ab)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x3f1b8e);}}async[a42_0x451713(0x252)](_0x4cdcbe,_0x553876){const _0x3c85df=a42_0x451713,_0x1d7f16=Date[_0x3c85df(0x1cc)]();try{const _0x3013d6=_0x4cdcbe['shop'],_0x488b6e=_0x3013d6[_0x3c85df(0x1d1)];if(!_0x488b6e?.['webhookUrl']){console[_0x3c85df(0x1bd)](_0x3c85df(0x161)+_0x3013d6['id']);return;}const _0x4b29db=_0x553876===_0x3c85df(0x20a)?'payment.success':_0x3c85df(0x1e3);let _0x3cf7ee=[];if(_0x488b6e[_0x3c85df(0x197)])try{_0x3cf7ee=Array['isArray'](_0x488b6e[_0x3c85df(0x197)])?_0x488b6e[_0x3c85df(0x197)]:JSON[_0x3c85df(0x19a)](_0x488b6e[_0x3c85df(0x197)]);}catch(_0x5b7dda){console[_0x3c85df(0x1ab)]('Error\x20parsing\x20webhook\x20events:',_0x5b7dda),_0x3cf7ee=[];}if(!_0x3cf7ee[_0x3c85df(0x201)](_0x4b29db)){console[_0x3c85df(0x1bd)](_0x3c85df(0x19f)+_0x4b29db+'\x20not\x20enabled\x20for\x20shop\x20'+_0x3013d6['id']);return;}const _0x4cb7f8={'event':_0x4b29db,'payment':{'id':_0x4cdcbe['id'],'order_id':_0x4cdcbe[_0x3c85df(0x199)],'gateway_order_id':_0x4cdcbe['gatewayOrderId'],'gateway':_0x3c85df(0x1d4),'amount':_0x4cdcbe['amount'],'currency':_0x4cdcbe[_0x3c85df(0x248)],'status':_0x553876[_0x3c85df(0x218)](),'customer_email':_0x4cdcbe['customerEmail'],'customer_name':_0x4cdcbe[_0x3c85df(0x215)],'created_at':_0x4cdcbe[_0x3c85df(0x224)],'updated_at':new Date()}},_0x1b268b=await fetch(_0x488b6e[_0x3c85df(0x227)],{'method':_0x3c85df(0x17a),'headers':{'Content-Type':'application/json','User-Agent':_0x3c85df(0x18a)},'body':JSON[_0x3c85df(0x1fd)](_0x4cb7f8)}),_0x2c17f7=Date[_0x3c85df(0x1cc)]()-_0x1d7f16;loggerService_1[_0x3c85df(0x1f4)][_0x3c85df(0x251)](_0x4cdcbe[_0x3c85df(0x24b)],_0x488b6e['webhookUrl'],_0x4b29db,_0x1b268b[_0x3c85df(0x1eb)],_0x2c17f7,_0x4cb7f8),console[_0x3c85df(0x1bd)](_0x3c85df(0x1c2)+_0x488b6e[_0x3c85df(0x227)]+_0x3c85df(0x232)+_0x1b268b[_0x3c85df(0x1eb)]+'\x20('+_0x2c17f7+'ms)');}catch(_0x4e0167){console['error'](_0x3c85df(0x21d),_0x4e0167),loggerService_1['loggerService'][_0x3c85df(0x211)](_0x4cdcbe[_0x3c85df(0x24b)],_0x4cdcbe[_0x3c85df(0x165)]?.[_0x3c85df(0x1d1)]?.[_0x3c85df(0x227)]||_0x3c85df(0x1e5),_0x3c85df(0x1cf),_0x4e0167,{});}}['maskCardNumber'](_0x4fb723){const _0x20cbf0=a42_0x451713,_0x70fe92=_0x4fb723[_0x20cbf0(0x24d)](/[\s-]/g,'');if(_0x70fe92[_0x20cbf0(0x1f3)]<0x4)return _0x20cbf0(0x182);return _0x20cbf0(0x226)+_0x70fe92[_0x20cbf0(0x1b4)](-0x4);}async[a42_0x451713(0x1ea)](_0x299848){const _0x1df7ac=a42_0x451713;console[_0x1df7ac(0x1bd)]('Processing\x20MasterCard\x20webhook:',_0x299848);let _0x216ede=_0x1df7ac(0x1c6);if(_0x299848[_0x1df7ac(0x1eb)]===0x1&&_0x299848['final']===0x1)_0x216ede=_0x1df7ac(0x20a);else _0x299848[_0x1df7ac(0x1eb)]===0x0&&_0x299848[_0x1df7ac(0x1ed)]===0x0?_0x216ede=_0x1df7ac(0x1c6):_0x216ede=_0x1df7ac(0x1f5);return{'paymentId':_0x299848[_0x1df7ac(0x23f)]||'','status':_0x216ede,'amount':_0x299848[_0x1df7ac(0x21c)],'currency':_0x299848[_0x1df7ac(0x248)]};}[a42_0x451713(0x1ac)](){const _0x12c40e=a42_0x451713;console[_0x12c40e(0x1bd)](_0x12c40e(0x242));const _0x4fb8a4=this[_0x12c40e(0x23b)][_0x12c40e(0x15f)];for(const [_0x515f0b]of this['statusCheckTimers']){this[_0x12c40e(0x1b5)](_0x515f0b);}console['log'](_0x12c40e(0x250)+_0x4fb8a4+_0x12c40e(0x204));}}exports[a42_0x451713(0x233)]=MasterCardService;