'use strict';const a68_0x26e895=a68_0x4ace;(function(_0x3050e7,_0x176fe7){const _0x246651=a68_0x4ace,_0x43699f=_0x3050e7();while(!![]){try{const _0x16a6f8=parseInt(_0x246651(0x346))/0x1*(-parseInt(_0x246651(0x1f0))/0x2)+parseInt(_0x246651(0x27d))/0x3+-parseInt(_0x246651(0x1f7))/0x4+-parseInt(_0x246651(0x237))/0x5+parseInt(_0x246651(0x1e7))/0x6*(parseInt(_0x246651(0x27c))/0x7)+-parseInt(_0x246651(0x2a1))/0x8+parseInt(_0x246651(0x265))/0x9*(parseInt(_0x246651(0x25d))/0xa);if(_0x16a6f8===_0x176fe7)break;else _0x43699f['push'](_0x43699f['shift']());}catch(_0x15bb62){_0x43699f['push'](_0x43699f['shift']());}}}(a68_0x3697,0x9c19e));function a68_0x4ace(_0x4cae87,_0x3373d3){_0x4cae87=_0x4cae87-0x1e0;const _0x369726=a68_0x3697();let _0x4acebf=_0x369726[_0x4cae87];return _0x4acebf;}var __createBinding=this&&this[a68_0x26e895(0x27a)]||(Object['create']?function(_0x56bcc1,_0x48297b,_0x435795,_0x27b5af){const _0x56b56c=a68_0x26e895;if(_0x27b5af===undefined)_0x27b5af=_0x435795;var _0x11f218=Object['getOwnPropertyDescriptor'](_0x48297b,_0x435795);(!_0x11f218||(_0x56b56c(0x2af)in _0x11f218?!_0x48297b[_0x56b56c(0x20d)]:_0x11f218[_0x56b56c(0x305)]||_0x11f218[_0x56b56c(0x343)]))&&(_0x11f218={'enumerable':!![],'get':function(){return _0x48297b[_0x435795];}}),Object[_0x56b56c(0x255)](_0x56bcc1,_0x27b5af,_0x11f218);}:function(_0x4a9a3c,_0x50f2cc,_0x1e5444,_0x730a1e){if(_0x730a1e===undefined)_0x730a1e=_0x1e5444;_0x4a9a3c[_0x730a1e]=_0x50f2cc[_0x1e5444];}),__setModuleDefault=this&&this[a68_0x26e895(0x2bf)]||(Object[a68_0x26e895(0x34a)]?function(_0x463974,_0xfbe080){Object['defineProperty'](_0x463974,'default',{'enumerable':!![],'value':_0xfbe080});}:function(_0x3d8241,_0x143c92){const _0x1fb833=a68_0x26e895;_0x3d8241[_0x1fb833(0x21c)]=_0x143c92;}),__importStar=this&&this[a68_0x26e895(0x30c)]||(function(){var _0x1cc099=function(_0xb3cf01){const _0x851f1f=a68_0x4ace;return _0x1cc099=Object[_0x851f1f(0x1ee)]||function(_0x35304b){const _0x52b46c=_0x851f1f;var _0x428740=[];for(var _0x56beb9 in _0x35304b)if(Object[_0x52b46c(0x2fe)]['hasOwnProperty'][_0x52b46c(0x2b7)](_0x35304b,_0x56beb9))_0x428740[_0x428740[_0x52b46c(0x330)]]=_0x56beb9;return _0x428740;},_0x1cc099(_0xb3cf01);};return function(_0x301718){const _0x55a4d4=a68_0x4ace;if(_0x301718&&_0x301718[_0x55a4d4(0x20d)])return _0x301718;var _0x3f2d47={};if(_0x301718!=null){for(var _0x1374dd=_0x1cc099(_0x301718),_0x2f5cb3=0x0;_0x2f5cb3<_0x1374dd[_0x55a4d4(0x330)];_0x2f5cb3++)if(_0x1374dd[_0x2f5cb3]!==_0x55a4d4(0x21c))__createBinding(_0x3f2d47,_0x301718,_0x1374dd[_0x2f5cb3]);}return __setModuleDefault(_0x3f2d47,_0x301718),_0x3f2d47;};}()),__importDefault=this&&this[a68_0x26e895(0x329)]||function(_0xdd1226){return _0xdd1226&&_0xdd1226['__esModule']?_0xdd1226:{'default':_0xdd1226};};Object[a68_0x26e895(0x255)](exports,a68_0x26e895(0x20d),{'value':!![]}),exports[a68_0x26e895(0x2dc)]=void 0x0;const crypto_1=__importDefault(require(a68_0x26e895(0x33f))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a68_0x26e895(0x21e));function a68_0x3697(){const _0x4bb47b=['7401152uINdOK','The\x20card\x20is\x20lost\x20or\x20stolen','\x20not\x20enabled\x20for\x20shop\x20','Payment\x20pending\x20verification','...','Payment\x20is\x20being\x20processed','3DS\x20URL:','üîê\x20Response\x20is\x20encrypted,\x20decrypting...','shop','üîê\x20VISA\x20Public\x20key\x20path:','üîê\x20Data\x20encrypted\x20with\x20AES','then','unknown','https://api.paydmeth.com/api','get','\x20|\x20Response:\x20','Insufficient\x20funds\x20on\x20the\x20card','üìù\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','slice','scheduleStatusChecks','\x20\x20\x20-\x20info\x20length:','\x20payment_id\x20for\x20search:\x20','call','\x20\x20Cleaned:\x20\x20\x22','createDecipheriv','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','MasterCard\x20webhook\x20sent\x20to\x20','/status_decrypted','\x20payment:\x20','createSign','__setModuleDefault','toLowerCase','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','Failed\x20to\x20send\x20payment\x20notifications:','üîê\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','‚úÖ\x20MasterCard\x20key\x20files\x20validated\x20successfully','createdAt','readFileSync','\x20\x20\x20-\x20merchant_point_id:','date_success',',\x20body:\x20','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','charge','üìù\x20Data\x20length:','number','3ds_url','checkPaymentStatus','‚ùå\x20VISA/MasterCard\x20key\x20validation\x20failed:','\x20API:\x20','signRSA','‚ùå\x20Detailed\x20failure\x20description:\x20','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','amount','\x20for\x20payment\x20','üîê\x20MasterCard\x20Private\x20key\x20length:\x20','../../config/database','post_code','/charge_decrypt','üîÑ\x20Processing\x20MasterCard\x20webhook\x20data:','VisaMasterCardService','üîê\x20VISA\x20API\x20URL:','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','Webhook\x20event\x20','key','Status\x20','final','Sender\x27s\x20CVV\x20card\x20is\x20required','generateAESKey','üìù\x20Encrypted\x20key\x20length:','Payment\x20System/1.0\x20(MasterCard)','üìä\x20Checking\x20','4000000000000000','üéØ\x20Using\x20','‚ùå\x20RSA\x20encryption\x20failed:','‚ùå\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','üîê\x20Using\x20keys:\x20','üìç\x20Full\x20card\x20holder\x20data:','Response\x20Headers:','publicKeyPath','expire_month','===\x20PARSED\x20API\x20RESPONSE\x20===','country','updatePaymentStatus','Method\x20not\x20allowed','\x20webhook\x20extracted\x20data:','logWhiteDomainResponse','Error\x20details:','üí≥\x20Detected\x20MasterCard\x20(starts\x20with\x205)','warn','üìù\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','\x20\x20Original:\x20\x22','card_type','delete','prototype','substring','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','‚úÖ\x20Payment\x20','\x20\x20\x20Payment\x20ID:\x20','set','expire_year','writable','3DS\x20verification\x20required','replace','/status_raw','webhookEvents','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','payment_id','__importStar','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','üì¶\x20FULL\x20RESPONSE\x20JSON:','orderId','\x20status\x20check\x20error:','stringify','\x20\x20\x20-\x20key\x20length:','üîÑ\x20Converted\x20postcode\x20to\x20post_code:\x20','RSA_PKCS1_PADDING','\x20status\x20check\x20#','desc','‚è∞\x20Will\x20check\x20status\x20','Invalid\x20expiration\x20date',',\x20final=','/charge_raw','Another\x20unknown\x20error','‚ö†Ô∏è\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format',':\x20Unknown\x20status\x20code','\x20\x20\x20Amount:\x20','aes-256-ctr','decryptAES','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','system','LookUp\x20number\x20of\x20attempts\x20exceeded','üìù\x20Final\x20request\x20structure:','statusCheckTimers','log','logWhiteDomainRequest','__importDefault','Unsuccessful\x20payment','Status:',',\x20orderId=','decryptResponse','sha256','getDetailedErrorMessage','length','/status_decrypt','description','paymentStatuses','‚úÖ\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','Return\x20URL:','Transaction\x20limit\x20exceeded','Payment\x20System/1.0','keys','errorMessage','clearStatusTimers','-----BEGIN','‚úÖ\x20VISA\x20key\x20files\x20validated\x20successfully','webhookUrl','\x20\x20\x20Status:\x20','crypto',',\x20Final:\x20','privateKeyPath','visaMerchantPointId','configurable','validateKeyFiles','status','8tLWyPr','randomBytes','isFinalStatus','sendShopWebhook','create','üìä\x20','createHmac','üîê\x20MasterCard\x20API\x20URL:','Client\x20OTP\x20confirmation\x20required','MASTERCARD','postcode','üßπ\x20Card\x20holder\x20names\x20cleaned:','üí≥\x20VISA/MasterCard\x20service\x20initialized',',\x20Desc:\x20','paymentId','üîê\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','üîç\x20Using\x20','314898cElDLa','üìù\x20Signature\x20length:','‚ö†Ô∏è\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','privateDecrypt','üîç\x20Detected\x20card\x20type\x20from\x20webhook:\x20','base64','üìù\x20Encrypted\x20data\x20length:','getOwnPropertyNames','\x20with\x20status\x20','243596gkcPLB','../telegramBotService','paidAt','\x20\x20\x20Currency:\x20','join','üßπ\x20Clearing\x20','last_name','2452564UCQPjR','logWhiteDomainError','SHA256',',\x20paymentId=','text','application/json','\x20MasterCard\x20status\x20check\x20timers','createCipheriv','üí≥\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','LookUp\x20not\x20confirmed','parse','LookUp\x20code\x20verified','currency','‚ö†Ô∏è\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','No\x20New\x20payment','message','LookUp\x20code\x20sent','‚úÖ\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','payment.failed','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','customerEmail','__esModule','toUpperCase','isArray','Card\x20Holder:','Unknown\x20error','\x20characters','\x20\x20\x20-\x20sign\x20length:','üìä\x20Status\x20check\x20#','Result\x20URL:','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','-----END','size','No\x20Error\x20executing\x20request','merchantPointId','\x20(from:\x20status=','default','existsSync','../loggerService','Cancellation\x20is\x20not\x20possible','Awaiting\x20confirmation\x20by\x20ivr\x20call','üîê\x20AES\x20key\x20length:','constants','visa/mastercard','statusText','from','üíæ\x20Saving\x20failure\x20message:\x20','Number\x20of\x20attempts\x20exceeded','failed',',\x20id=','hex','maskCardNumber','Payment\x20returned','encryptRSA','‚ùå\x20RSA\x20signing\x20failed:','masterCardMerchantPointId','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','HTTP\x20error!\x20status:\x20','‚úÖ\x20Scheduled\x20','json','‚ùå\x20Status\x20check\x20#','decryptResponsePhp','digest','2305010Saxwzv','‚úÖ\x20Status\x20response\x20decrypted\x20successfully','now','üîê\x20MasterCard\x20Public\x20key\x20length:\x20','üìù\x20Decrypted\x20webhook\x20data:','sign','charAt','payment.success','‚ö†Ô∏è\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','https://api2.trapay.uk/decrypt.php','loggerService','üìù\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','cwd','sendPaymentNotifications','****\x20****\x20****\x20','cvv','shopId','Payment\x20confirmation\x20time\x20has\x20expired','Cash\x20payment\x20is\x20expected\x20at\x20TCO','Payment\x20prohibited','forEach','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','first_name','private.pem','cardType','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','apiUrl','masterCardApiUrl','utf8','HTTP\x20Status:','defineProperty','üîê\x20Data\x20signed\x20with\x20RSA','PAID','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','Failed\x20to\x20check\x20','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','visa_private.pem','Sender\x27s\x20card\x20details\x20are\x20required','85480mBTjeD','end','includes','push','üõë\x20Stopped\x20','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','\x20payment\x20status:\x20','‚ùå\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','2061AXNvTa','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','update','info','PHP\x20decryptor\x20error','error','Recipient\x20data\x20required','üîê\x20MasterCard\x20Public\x20key\x20path:','toString','üì¶\x20FULL\x20REQUEST\x20JSON:','üîê\x20MasterCard\x20Private\x20key\x20path:','/status','Captcha\x20confirmation\x20awaited','\x20order_id\x20for\x20search:\x20','trim','Sender\x20information\x20required','visaPrivateKeyPath','‚ö†Ô∏è\x20Expected\x20VISA\x20public\x20key:\x20','Failed\x20payment','Decryption\x20failed:\x20','\x20\x20\x20-\x20lang:\x20en','__createBinding',',\x20payment_id=','112dFxdrv','2447523COpWrD','publicEncrypt','üîç\x20Using\x20provided\x20card\x20type:\x20','order_id','/charge','‚úÖ\x20Payment\x20successful','logShopWebhookError','gatewayOrderId','üîç\x20Using\x20fallback\x20fields\x20for\x20search:\x20','‚ùå\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','üí≥\x20Unknown\x20card\x20type\x20(starts\x20with\x20','üõë\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','resolve','visaApiUrl','PIN\x20code\x20confirmation\x20awaited','Final:','Payment\x20cancellation\x20is\x20being\x20processed','settings','getCardTypeAndApi','paid','processWebhook','PENDING','üîê\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','/charge_decrypted','\x20(from:\x20order_id=','‚ùå\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','üì¶\x20FULL\x20RESPONSE\x20BODY:','POST','FAILED','Test\x20payment','encryptAES','floor','Status\x20Text:','visaPublicKeyPath','VISA','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key'];a68_0x3697=function(){return _0x4bb47b;};return a68_0x3697();}class VisaMasterCardService{constructor(){const _0x4e9762=a68_0x26e895;this[_0x4e9762(0x326)]=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0x4e9762(0x206)},0x1:{'final':![],'description':_0x4e9762(0x219)},0x2:{'final':!![],'description':'Request\x20data\x20error'},0x3:{'final':!![],'description':_0x4e9762(0x31b)},0x4:{'final':!![],'description':_0x4e9762(0x32a)},0x5:{'final':!![],'description':_0x4e9762(0x262)},0x6:{'final':!![],'description':_0x4e9762(0x22c)},0x7:{'final':!![],'description':_0x4e9762(0x29a)},0x8:{'final':![],'description':_0x4e9762(0x34e)},0x9:{'final':![],'description':_0x4e9762(0x306)},0xa:{'final':![],'description':_0x4e9762(0x2e3)},0xb:{'final':![],'description':_0x4e9762(0x274)},0xc:{'final':![],'description':_0x4e9762(0x26b)},0xd:{'final':![],'description':'Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number'},0xe:{'final':![],'description':_0x4e9762(0x220)},0xf:{'final':![],'description':_0x4e9762(0x28b)},0x10:{'final':![],'description':_0x4e9762(0x271)},0x11:{'final':![],'description':'Awaiting\x20confirmation\x20of\x20the\x20login\x20password'},0x12:{'final':![],'description':'Awaiting\x20confirmation\x20in\x20the\x20application'},0x13:{'final':![],'description':_0x4e9762(0x2a6)},0x14:{'final':![],'description':_0x4e9762(0x250)},0x15:{'final':![],'description':'Expected\x20bitcoin\x20transfer\x20from\x20client'},0x16:{'final':![],'description':_0x4e9762(0x2a4)},0x18:{'final':![],'description':'The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':_0x4e9762(0x249)},0x1b:{'final':![],'description':_0x4e9762(0x266)},0x1c:{'final':![],'description':_0x4e9762(0x321)},0x1d:{'final':![],'description':_0x4e9762(0x2de)},0x1f:{'final':![],'description':_0x4e9762(0x24c)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':_0x4e9762(0x25c)},0x24:{'final':!![],'description':_0x4e9762(0x248)},0x25:{'final':!![],'description':_0x4e9762(0x24a)},0x26:{'final':!![],'description':'The\x20payment\x20status\x20must\x20be\x20clarified\x20manually'},0x27:{'final':!![],'description':_0x4e9762(0x2b1)},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':_0x4e9762(0x2a2)},0x2a:{'final':!![],'description':_0x4e9762(0x318)},0x2b:{'final':!![],'description':_0x4e9762(0x336)},0x2c:{'final':!![],'description':_0x4e9762(0x322)},0x2d:{'final':!![],'description':'Failed\x20payment'},0x2e:{'final':!![],'description':_0x4e9762(0x32a)},0x2f:{'final':!![],'description':_0x4e9762(0x32a)},0x30:{'final':!![],'description':'Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled'},0x31:{'final':![],'description':'Payment\x20confirmation\x20required'},0x32:{'final':!![],'description':_0x4e9762(0x2f4)},0x33:{'final':!![],'description':'Failed\x20payment'},0x34:{'final':!![],'description':_0x4e9762(0x277)},0x35:{'final':!![],'description':_0x4e9762(0x277)},0x36:{'final':!![],'description':_0x4e9762(0x277)},0x37:{'final':!![],'description':_0x4e9762(0x277)},0x38:{'final':!![],'description':_0x4e9762(0x21f)},0x39:{'final':![],'description':_0x4e9762(0x20b)},0x3a:{'final':![],'description':_0x4e9762(0x208)},0x3b:{'final':!![],'description':_0x4e9762(0x202)},0x3c:{'final':!![],'description':_0x4e9762(0x227)},0x3d:{'final':!![],'description':_0x4e9762(0x2c1)},0x3e:{'final':!![],'description':_0x4e9762(0x258)},0x3f:{'final':!![],'description':_0x4e9762(0x22c)},0x40:{'final':![],'description':_0x4e9762(0x200)},0x41:{'final':!![],'description':_0x4e9762(0x324)},0x42:{'final':![],'description':_0x4e9762(0x28d)},0x43:{'final':!![],'description':_0x4e9762(0x2d4)},0x44:{'final':![],'description':'3DS\x20verification\x20required'},0x45:{'final':!![],'description':'Failed\x20payment'},0x46:{'final':!![],'description':_0x4e9762(0x277)},0x47:{'final':!![],'description':_0x4e9762(0x300)},0x64:{'final':!![],'description':'Operation\x20completed\x20successfully'}},this[_0x4e9762(0x252)]='https://api.myatranz.com/api',this['masterCardMerchantPointId']=0x50ca,this[_0x4e9762(0x341)]=path_1[_0x4e9762(0x21c)][_0x4e9762(0x1f4)](process[_0x4e9762(0x243)](),_0x4e9762(0x338),_0x4e9762(0x24e)),this[_0x4e9762(0x2ef)]=path_1['default'][_0x4e9762(0x1f4)](process[_0x4e9762(0x243)](),'keys','psp_public.pem'),this['visaApiUrl']=_0x4e9762(0x2ae),this[_0x4e9762(0x342)]=0x6b7,this[_0x4e9762(0x275)]=path_1['default']['join'](process['cwd'](),_0x4e9762(0x338),_0x4e9762(0x25b)),this['visaPublicKeyPath']=path_1[_0x4e9762(0x21c)][_0x4e9762(0x1f4)](process[_0x4e9762(0x243)](),'keys','visa_public.pem'),console['log'](_0x4e9762(0x1e2)),console['log'](_0x4e9762(0x34d),this[_0x4e9762(0x252)]),console[_0x4e9762(0x327)](_0x4e9762(0x2dd),this['visaApiUrl']),console[_0x4e9762(0x327)](_0x4e9762(0x26f),this[_0x4e9762(0x341)]),console['log'](_0x4e9762(0x26c),this[_0x4e9762(0x2ef)]),console[_0x4e9762(0x327)]('üîê\x20VISA\x20Private\x20key\x20path:',this[_0x4e9762(0x275)]),console[_0x4e9762(0x327)](_0x4e9762(0x2aa),this['visaPublicKeyPath']),this[_0x4e9762(0x344)]();}[a68_0x26e895(0x32f)](_0x58ce68,_0x45ed83){const _0x3b873b=a68_0x26e895,_0x456807=this[_0x3b873b(0x333)][_0x58ce68];let _0x1ba7a7='';_0x456807?_0x1ba7a7=_0x3b873b(0x2e1)+_0x58ce68+':\x20'+_0x456807[_0x3b873b(0x332)]:_0x1ba7a7=_0x3b873b(0x2e1)+_0x58ce68+_0x3b873b(0x31d);if(_0x45ed83&&_0x45ed83[_0x3b873b(0x273)]()){const _0x4217d9=_0x45ed83['trim']();(!_0x456807||_0x4217d9[_0x3b873b(0x2c0)]()!==_0x456807[_0x3b873b(0x332)][_0x3b873b(0x2c0)]())&&(_0x1ba7a7+=_0x3b873b(0x2b0)+_0x4217d9);}return _0x1ba7a7;}[a68_0x26e895(0x348)](_0x4798d1){const _0x5b6f23=this['paymentStatuses'][_0x4798d1];return _0x5b6f23?_0x5b6f23['final']:!![];}['getCardTypeAndApi'](_0x5d80c2){const _0x1a942a=a68_0x26e895,_0x808cd2=_0x5d80c2[_0x1a942a(0x23d)](0x0);if(_0x808cd2==='4')return console['log'](_0x1a942a(0x1ff)),{'cardType':_0x1a942a(0x29f),'apiUrl':this[_0x1a942a(0x28a)],'privateKeyPath':this[_0x1a942a(0x275)],'publicKeyPath':this[_0x1a942a(0x29e)],'merchantPointId':this[_0x1a942a(0x342)]};else return _0x808cd2==='5'?(console[_0x1a942a(0x327)](_0x1a942a(0x2f8)),{'cardType':_0x1a942a(0x34f),'apiUrl':this[_0x1a942a(0x252)],'privateKeyPath':this[_0x1a942a(0x341)],'publicKeyPath':this[_0x1a942a(0x2ef)],'merchantPointId':this[_0x1a942a(0x22f)]}):(console['log'](_0x1a942a(0x287)+_0x808cd2+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':_0x1a942a(0x34f),'apiUrl':this[_0x1a942a(0x252)],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x1a942a(0x22f)]});}[a68_0x26e895(0x344)](){const _0x20025a=a68_0x26e895;try{if(!fs_1[_0x20025a(0x21c)][_0x20025a(0x21d)](this['privateKeyPath']))throw new Error(_0x20025a(0x25a)+this['privateKeyPath']);if(!fs_1['default'][_0x20025a(0x21d)](this['publicKeyPath']))throw new Error(_0x20025a(0x30a)+this[_0x20025a(0x2ef)]);const _0x50c89a=fs_1['default'][_0x20025a(0x2c6)](this['privateKeyPath'],'utf8')['trim'](),_0x224118=fs_1[_0x20025a(0x21c)][_0x20025a(0x2c6)](this[_0x20025a(0x2ef)],_0x20025a(0x253))['trim']();if(!_0x50c89a['includes'](_0x20025a(0x33b))||!_0x50c89a[_0x20025a(0x25f)](_0x20025a(0x217)))throw new Error(_0x20025a(0x2ba));if(!_0x224118[_0x20025a(0x25f)](_0x20025a(0x33b))||!_0x224118[_0x20025a(0x25f)](_0x20025a(0x217)))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x20025a(0x327)](_0x20025a(0x2c4)),console['log'](_0x20025a(0x2d7)+_0x50c89a[_0x20025a(0x330)]+'\x20characters'),console[_0x20025a(0x327)](_0x20025a(0x23a)+_0x224118[_0x20025a(0x330)]+_0x20025a(0x212));if(fs_1['default'][_0x20025a(0x21d)](this[_0x20025a(0x275)])&&fs_1[_0x20025a(0x21c)][_0x20025a(0x21d)](this['visaPublicKeyPath'])){const _0x5c60a3=fs_1['default'][_0x20025a(0x2c6)](this[_0x20025a(0x275)],_0x20025a(0x253))[_0x20025a(0x273)](),_0x3fe2dc=fs_1[_0x20025a(0x21c)][_0x20025a(0x2c6)](this[_0x20025a(0x29e)],'utf8')['trim']();(!_0x5c60a3[_0x20025a(0x25f)](_0x20025a(0x33b))||!_0x5c60a3[_0x20025a(0x25f)]('-----END'))&&console[_0x20025a(0x2f9)](_0x20025a(0x23f)),(!_0x3fe2dc['includes'](_0x20025a(0x33b))||!_0x3fe2dc[_0x20025a(0x25f)](_0x20025a(0x217)))&&console[_0x20025a(0x2f9)](_0x20025a(0x31c)),console['log'](_0x20025a(0x33c)),console['log']('üîê\x20VISA\x20Private\x20key\x20length:\x20'+_0x5c60a3[_0x20025a(0x330)]+_0x20025a(0x212)),console[_0x20025a(0x327)]('üîê\x20VISA\x20Public\x20key\x20length:\x20'+_0x3fe2dc[_0x20025a(0x330)]+_0x20025a(0x212));}else console['warn'](_0x20025a(0x1e9)),console[_0x20025a(0x2f9)]('‚ö†Ô∏è\x20Expected\x20VISA\x20private\x20key:\x20'+this['visaPrivateKeyPath']),console[_0x20025a(0x2f9)](_0x20025a(0x276)+this[_0x20025a(0x29e)]);}catch(_0x1de9b3){console[_0x20025a(0x26a)](_0x20025a(0x2d0),_0x1de9b3);throw _0x1de9b3;}}[a68_0x26e895(0x2e4)](){const _0x1db484=a68_0x26e895,_0x197e52=crypto_1[_0x1db484(0x21c)][_0x1db484(0x347)](0x20),_0x2fb78e=crypto_1['default'][_0x1db484(0x347)](0x10);return{'key':_0x197e52,'iv':_0x2fb78e};}[a68_0x26e895(0x29b)](_0x24e5ec,_0x188fcb,_0x4de2e0){const _0x353bf1=a68_0x26e895,_0x31d410=crypto_1[_0x353bf1(0x21c)][_0x353bf1(0x1fe)](_0x353bf1(0x31f),_0x188fcb,_0x4de2e0);let _0x2b7d55=_0x31d410['update'](_0x24e5ec,_0x353bf1(0x253),_0x353bf1(0x1ec));return _0x2b7d55+=_0x31d410[_0x353bf1(0x2e2)](_0x353bf1(0x1ec)),_0x2b7d55;}['encryptRSA'](_0x13d5ab,_0x1ff439,_0x318994){const _0x354385=a68_0x26e895;try{const _0x477278=fs_1[_0x354385(0x21c)][_0x354385(0x2c6)](_0x318994,_0x354385(0x253))[_0x354385(0x273)](),_0x4f33ac={'iv':_0x1ff439[_0x354385(0x26d)](_0x354385(0x1ec)),'key':_0x13d5ab[_0x354385(0x26d)](_0x354385(0x1ec))},_0x4a193c=JSON[_0x354385(0x311)](_0x4f33ac);console['log'](_0x354385(0x293),_0x4a193c[_0x354385(0x330)]);const _0x1794cb=crypto_1['default'][_0x354385(0x27e)]({'key':_0x477278,'padding':crypto_1[_0x354385(0x21c)][_0x354385(0x222)][_0x354385(0x314)]},Buffer[_0x354385(0x225)](_0x4a193c));return console['log']('‚úÖ\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x1794cb[_0x354385(0x330)]),_0x1794cb[_0x354385(0x26d)](_0x354385(0x1ec));}catch(_0xc49167){console['error'](_0x354385(0x2ea),_0xc49167);throw new Error(_0x354385(0x2ca));}}[a68_0x26e895(0x2d2)](_0x2f7e01,_0x193a10){const _0x332375=a68_0x26e895;try{const _0x5c6fac=fs_1['default'][_0x332375(0x2c6)](_0x193a10,_0x332375(0x253))[_0x332375(0x273)](),_0x32e39c=crypto_1[_0x332375(0x21c)][_0x332375(0x2be)](_0x332375(0x1f9));_0x32e39c[_0x332375(0x267)](_0x2f7e01),_0x32e39c[_0x332375(0x25e)]();const _0x498a84=_0x32e39c[_0x332375(0x23c)](_0x5c6fac,_0x332375(0x1ec));return console[_0x332375(0x327)]('üîê\x20RSA\x20signing\x20successful'),console[_0x332375(0x327)]('üìù\x20Data\x20to\x20sign\x20length:',_0x2f7e01[_0x332375(0x330)]),console[_0x332375(0x327)](_0x332375(0x1e8),_0x498a84[_0x332375(0x330)]),_0x498a84;}catch(_0x5c6e53){console['error'](_0x332375(0x22e),_0x5c6e53),console[_0x332375(0x26a)]('‚ùå\x20Data\x20being\x20signed:',_0x2f7e01[_0x332375(0x2ff)](0x0,0xc8)+_0x332375(0x2a5));throw new Error(_0x332375(0x2a0));}}[a68_0x26e895(0x320)](_0x468ec8,_0x3ec103,_0x172cd1){const _0x29425c=a68_0x26e895,_0x194c5e=crypto_1[_0x29425c(0x21c)][_0x29425c(0x2b9)](_0x29425c(0x31f),_0x3ec103,_0x172cd1);let _0x459f5b=_0x194c5e[_0x29425c(0x267)](_0x468ec8,'base64',_0x29425c(0x253));return _0x459f5b+=_0x194c5e['final'](_0x29425c(0x253)),_0x459f5b;}async[a68_0x26e895(0x235)](_0x1723e6,_0x43689d,_0x3011cc=a68_0x26e895(0x34f)){const _0x96342c=a68_0x26e895;try{const _0x29108e=await fetch(_0x96342c(0x240),{'method':_0x96342c(0x298),'headers':{'Content-Type':_0x96342c(0x1fc)},'body':JSON[_0x96342c(0x311)]({'info':_0x1723e6,'key':_0x43689d,'card_type':_0x3011cc[_0x96342c(0x2c0)]()})});if(!_0x29108e['ok'])throw new Error(_0x96342c(0x269));return await _0x29108e[_0x96342c(0x1fb)]();}catch(_0x59d264){console[_0x96342c(0x26a)]('‚ùå\x20PHP\x20decryptor\x20request\x20failed:',_0x59d264);throw new Error(_0x96342c(0x30d));}}[a68_0x26e895(0x32d)](_0x1d8296,_0x3924cf){const _0x5d5ced=a68_0x26e895;try{const _0x5972c0=fs_1[_0x5d5ced(0x21c)]['readFileSync'](this['privateKeyPath'],_0x5d5ced(0x253))[_0x5d5ced(0x273)](),_0x3ded0f=crypto_1[_0x5d5ced(0x21c)][_0x5d5ced(0x1ea)](_0x5972c0,Buffer[_0x5d5ced(0x225)](_0x3924cf,'base64')),_0x2b87b9=JSON[_0x5d5ced(0x201)](_0x3ded0f[_0x5d5ced(0x26d)]()),_0x1a1720=Buffer[_0x5d5ced(0x225)](_0x2b87b9[_0x5d5ced(0x2e0)],_0x5d5ced(0x1ec)),_0x1697a5=Buffer['from'](_0x2b87b9['iv'],_0x5d5ced(0x1ec));return this[_0x5d5ced(0x320)](_0x1d8296,_0x1a1720,_0x1697a5);}catch(_0x2c6a73){throw new Error('Failed\x20to\x20decrypt\x20response');}}async['processCardPayment'](_0x3d131b){const _0x5d528a=a68_0x26e895,{paymentId:_0xcd317f,orderId:_0x53cb0e,amount:_0x2190ca,currency:_0x363389,cardData:_0x467921,resultUrl:_0x26bd04,returnUrl:_0x4f5df8,cardHolder:_0x2dc1ea,browser:_0x41aa9d}=_0x3d131b;console[_0x5d528a(0x327)](_0x5d528a(0x216)),console['log']('Payment\x20ID:',_0xcd317f),console[_0x5d528a(0x327)]('Order\x20ID:',_0x53cb0e),console['log']('Amount:',_0x2190ca,_0x363389),console[_0x5d528a(0x327)]('Card\x20Number:',this[_0x5d528a(0x22b)](_0x467921[_0x5d528a(0x2cd)])),console[_0x5d528a(0x327)](_0x5d528a(0x210),_0x2dc1ea[_0x5d528a(0x24d)]+'\x20'+_0x2dc1ea[_0x5d528a(0x1f6)]),console[_0x5d528a(0x327)](_0x5d528a(0x335),_0x4f5df8),console['log'](_0x5d528a(0x215),_0x26bd04);const _0x1163ef=this[_0x5d528a(0x28f)](_0x467921[_0x5d528a(0x2cd)]);console['log'](_0x5d528a(0x2e9)+_0x1163ef[_0x5d528a(0x24f)]+_0x5d528a(0x2d1)+_0x1163ef[_0x5d528a(0x251)]),console['log'](_0x5d528a(0x2ec)+_0x1163ef[_0x5d528a(0x341)]+',\x20'+_0x1163ef['publicKeyPath']);const _0x449f60={..._0x2dc1ea,'first_name':_0x2dc1ea[_0x5d528a(0x24d)]?.[_0x5d528a(0x307)](/[\t\n\r\f\v]/g,'\x20')[_0x5d528a(0x273)]()||'','last_name':_0x2dc1ea[_0x5d528a(0x1f6)]?.[_0x5d528a(0x307)](/[\t\n\r\f\v]/g,'\x20')[_0x5d528a(0x273)]()||''};_0x5d528a(0x1e0)in _0x449f60&&!(_0x5d528a(0x2d9)in _0x449f60)&&(_0x449f60[_0x5d528a(0x2d9)]=_0x449f60[_0x5d528a(0x1e0)],delete _0x449f60[_0x5d528a(0x1e0)],console[_0x5d528a(0x327)](_0x5d528a(0x313)+_0x449f60[_0x5d528a(0x2d9)]));console[_0x5d528a(0x327)](_0x5d528a(0x1e1)),console[_0x5d528a(0x327)](_0x5d528a(0x2fb)+_0x2dc1ea[_0x5d528a(0x24d)]+'\x22\x20|\x20\x22'+_0x2dc1ea['last_name']+'\x22'),console[_0x5d528a(0x327)](_0x5d528a(0x2b8)+_0x449f60[_0x5d528a(0x24d)]+'\x22\x20|\x20\x22'+_0x449f60['last_name']+'\x22'),console[_0x5d528a(0x327)](_0x5d528a(0x2ed),JSON[_0x5d528a(0x311)](_0x449f60,null,0x2));const _0x183929={'amount':_0x2190ca,'currency':_0x363389[_0x5d528a(0x20e)](),'order_id':_0x53cb0e,'result_url':_0x26bd04,'return_url':_0x4f5df8,'country':_0x449f60[_0x5d528a(0x2f2)]||'','card':{'number':_0x467921['number'],'expire_month':_0x467921[_0x5d528a(0x2f0)],'expire_year':_0x467921[_0x5d528a(0x304)],'cvv':_0x467921[_0x5d528a(0x246)]},'card_holder':_0x449f60,'browser':_0x41aa9d},_0x48239f=JSON[_0x5d528a(0x311)](_0x183929);console['log']('üíæ\x20Payment\x20data\x20prepared'),console['log'](_0x5d528a(0x242)),console[_0x5d528a(0x327)](_0x48239f),console[_0x5d528a(0x327)](_0x5d528a(0x2cc),_0x48239f['length']);try{const {key:_0x26ca49,iv:_0x341fb2}=this[_0x5d528a(0x2e4)]();console['log']('üîê\x20AES\x20key\x20and\x20IV\x20generated'),console['log'](_0x5d528a(0x221),_0x26ca49[_0x5d528a(0x330)]),console[_0x5d528a(0x327)]('üîê\x20AES\x20IV\x20length:',_0x341fb2['length']);const _0x80ca60=this[_0x5d528a(0x29b)](_0x48239f,_0x26ca49,_0x341fb2);console[_0x5d528a(0x327)](_0x5d528a(0x2ab)),console[_0x5d528a(0x327)](_0x5d528a(0x1ed),_0x80ca60[_0x5d528a(0x330)]);const _0x90028f=this['encryptRSA'](_0x26ca49,_0x341fb2,_0x1163ef['publicKeyPath']);console[_0x5d528a(0x327)](_0x5d528a(0x2c3)),console[_0x5d528a(0x327)](_0x5d528a(0x2e5),_0x90028f[_0x5d528a(0x330)]);const _0x469e86=this[_0x5d528a(0x2d2)](_0x48239f,_0x1163ef[_0x5d528a(0x341)]);console[_0x5d528a(0x327)](_0x5d528a(0x256)),console[_0x5d528a(0x327)](_0x5d528a(0x1e8),_0x469e86[_0x5d528a(0x330)]);const _0x36c51f={'merchant_point_id':_0x1163ef[_0x5d528a(0x21a)],'method':'charge','info':_0x80ca60,'key':_0x90028f,'sign':_0x469e86,'lang':'en'};console[_0x5d528a(0x327)]('üì§\x20Sending\x20request\x20to\x20API...'),console['log'](_0x5d528a(0x325)),console[_0x5d528a(0x327)](_0x5d528a(0x2c7),_0x1163ef[_0x5d528a(0x21a)]),console['log']('\x20\x20\x20-\x20method:\x20charge'),console['log'](_0x5d528a(0x2b5),_0x80ca60[_0x5d528a(0x330)]),console['log'](_0x5d528a(0x312),_0x90028f['length']),console[_0x5d528a(0x327)](_0x5d528a(0x213),_0x469e86['length']),console[_0x5d528a(0x327)](_0x5d528a(0x279)),console[_0x5d528a(0x327)](''),console[_0x5d528a(0x327)](_0x5d528a(0x26e)),console[_0x5d528a(0x327)](JSON[_0x5d528a(0x311)](_0x36c51f,null,0x2)),console[_0x5d528a(0x327)](''),loggerService_1['loggerService'][_0x5d528a(0x328)](_0x1163ef[_0x5d528a(0x24f)][_0x5d528a(0x2c0)](),_0x5d528a(0x281),'POST',{'merchant_point_id':_0x1163ef['merchantPointId'],'method':_0x5d528a(0x2cb),'lang':'en'});const _0x5118d5=Date[_0x5d528a(0x239)](),_0xab4b6b=await fetch(_0x1163ef[_0x5d528a(0x251)],{'method':_0x5d528a(0x298),'headers':{'Content-Type':'application/json','Accept':_0x5d528a(0x1fc),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x5d528a(0x311)](_0x36c51f)}),_0x43234c=Date[_0x5d528a(0x239)]()-_0x5118d5;console[_0x5d528a(0x327)]('===\x20API\x20RESPONSE\x20==='),console['log']('Status:',_0xab4b6b[_0x5d528a(0x345)]),console[_0x5d528a(0x327)](_0x5d528a(0x29d),_0xab4b6b[_0x5d528a(0x224)]),console['log']('Response\x20Time:',_0x43234c+'ms'),console[_0x5d528a(0x327)](_0x5d528a(0x2ee)),_0xab4b6b['headers']['forEach']((_0x28cd4b,_0x515ae3)=>{const _0x19b5d7=_0x5d528a;console[_0x19b5d7(0x327)]('\x20\x20\x20'+_0x515ae3+':\x20'+_0x28cd4b);}),console['log']('');if(!_0xab4b6b['ok']){const _0x5292a4=await _0xab4b6b[_0x5d528a(0x1fb)]();console['error'](_0x5d528a(0x254),_0xab4b6b['status']),console[_0x5d528a(0x26a)](_0x5d528a(0x297)),console[_0x5d528a(0x26a)](_0x5292a4),console[_0x5d528a(0x26a)](''),loggerService_1[_0x5d528a(0x241)][_0x5d528a(0x2f6)](_0x1163ef[_0x5d528a(0x24f)]['toLowerCase'](),_0x5d528a(0x31a),_0xab4b6b[_0x5d528a(0x345)],_0x5292a4,_0x43234c),loggerService_1[_0x5d528a(0x241)][_0x5d528a(0x1f8)](_0x1163ef[_0x5d528a(0x24f)]['toLowerCase'](),_0x5d528a(0x281),'HTTP\x20'+_0xab4b6b[_0x5d528a(0x345)]+':\x20'+_0x5292a4);throw new Error(_0x5d528a(0x231)+_0xab4b6b[_0x5d528a(0x345)]+_0x5d528a(0x2c9)+_0x5292a4);}const _0x2166dd=await _0xab4b6b[_0x5d528a(0x233)]();console[_0x5d528a(0x327)](_0x5d528a(0x30e)),console['log'](JSON[_0x5d528a(0x311)](_0x2166dd,null,0x2)),console[_0x5d528a(0x327)](''),loggerService_1[_0x5d528a(0x241)][_0x5d528a(0x2f6)](_0x1163ef['cardType'][_0x5d528a(0x2c0)](),_0x5d528a(0x31a),_0xab4b6b[_0x5d528a(0x345)],_0x2166dd,_0x43234c),console[_0x5d528a(0x327)](_0x5d528a(0x2f1));let _0x1c3117=_0x2166dd;if(_0x2166dd['info']&&_0x2166dd[_0x5d528a(0x2e0)]&&_0x2166dd[_0x5d528a(0x23c)]){console[_0x5d528a(0x327)](_0x5d528a(0x2a8));try{const _0x18b792=await this[_0x5d528a(0x235)](_0x2166dd[_0x5d528a(0x268)],_0x2166dd[_0x5d528a(0x2e0)],_0x1163ef['cardType']);_0x1c3117=JSON[_0x5d528a(0x201)](_0x18b792),console[_0x5d528a(0x327)](_0x5d528a(0x334)),loggerService_1['loggerService'][_0x5d528a(0x2f6)](_0x1163ef['cardType'][_0x5d528a(0x2c0)](),_0x5d528a(0x294),_0xab4b6b[_0x5d528a(0x345)],_0x1c3117,_0x43234c),console[_0x5d528a(0x327)](_0x5d528a(0x2b2));}catch(_0x1cc76e){console[_0x5d528a(0x26a)](_0x5d528a(0x286),_0x1cc76e),loggerService_1[_0x5d528a(0x241)][_0x5d528a(0x1f8)](_0x1163ef[_0x5d528a(0x24f)][_0x5d528a(0x2c0)](),_0x5d528a(0x2da),_0x5d528a(0x278)+_0x1cc76e),_0x1c3117=_0x2166dd;}}else loggerService_1[_0x5d528a(0x241)][_0x5d528a(0x2f6)](_0x1163ef['cardType'][_0x5d528a(0x2c0)](),'/charge_decrypted',_0xab4b6b[_0x5d528a(0x345)],_0x1c3117,_0x43234c),console[_0x5d528a(0x327)]('üìù\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x5d528a(0x327)](_0x5d528a(0x32b),_0x1c3117[_0x5d528a(0x345)]),console['log'](_0x5d528a(0x28c),_0x1c3117[_0x5d528a(0x2e2)]),console[_0x5d528a(0x327)]('Payment\x20ID:',_0x1c3117['payment_id']),console[_0x5d528a(0x327)](_0x5d528a(0x2a7),_0x1c3117[_0x5d528a(0x2ce)]||'none');if(_0x1c3117['status']===0x64&&_0x1c3117[_0x5d528a(0x2e2)]===0x1)return console[_0x5d528a(0x327)](_0x5d528a(0x282)),{'gateway_payment_id':_0x1c3117[_0x5d528a(0x30b)]?.[_0x5d528a(0x26d)](),'payment_url':_0x4f5df8,'requires_3ds':![],'status':_0x5d528a(0x257),'final':!![]};if(_0x1c3117[_0x5d528a(0x2ce)])return console[_0x5d528a(0x327)]('üîê\x203DS\x20verification\x20required'),this[_0x5d528a(0x2b4)](_0xcd317f,_0x53cb0e,_0x1c3117['payment_id']?.[_0x5d528a(0x26d)]()||_0x53cb0e,_0x1163ef[_0x5d528a(0x24f)]),{'gateway_payment_id':_0x1c3117['payment_id']?.['toString'](),'payment_url':_0x1c3117[_0x5d528a(0x2ce)],'requires_3ds':!![],'threeds_url':_0x1c3117[_0x5d528a(0x2ce)],'status':_0x5d528a(0x292),'final':![]};let _0x3662a7=this[_0x5d528a(0x32f)](_0x1c3117[_0x5d528a(0x345)],_0x1c3117['desc']||_0x1c3117[_0x5d528a(0x207)]),_0x5c2d39=_0x1c3117[_0x5d528a(0x345)],_0x3c9d76=this['isFinalStatus'](_0x1c3117[_0x5d528a(0x345)]);return console[_0x5d528a(0x327)](_0x5d528a(0x2eb)+_0x5c2d39+_0x5d528a(0x340)+_0x3c9d76+_0x5d528a(0x1e3)+_0x3662a7),{'gateway_payment_id':_0x1c3117[_0x5d528a(0x30b)]?.[_0x5d528a(0x26d)](),'payment_url':_0x4f5df8,'requires_3ds':![],'status':_0x5d528a(0x299),'final':!![],'errorMessage':_0x3662a7};}catch(_0x4e0fb4){console[_0x5d528a(0x26a)]('===\x20PAYMENT\x20SERVICE\x20ERROR\x20==='),console[_0x5d528a(0x26a)](_0x5d528a(0x2f7),_0x4e0fb4),loggerService_1[_0x5d528a(0x241)][_0x5d528a(0x1f8)](_0x5d528a(0x223),'/charge',_0x4e0fb4);throw new Error(_0x5d528a(0x230)+(_0x4e0fb4 instanceof Error?_0x4e0fb4[_0x5d528a(0x207)]:'Unknown\x20error'));}}async['checkPaymentStatus'](_0x5d1d79,_0x38b5aa,_0x167282=a68_0x26e895(0x29f)){const _0x54db28=a68_0x26e895;console[_0x54db28(0x327)](_0x54db28(0x2e7)+_0x167282+_0x54db28(0x263)+_0x5d1d79+'\x20('+_0x38b5aa+')');try{const _0x2abe54={'payment_id':_0x5d1d79,'order_id':_0x38b5aa},_0x5c3880=JSON[_0x54db28(0x311)](_0x2abe54),_0x5d4707=this['getCardTypeAndApi'](_0x167282===_0x54db28(0x29f)?_0x54db28(0x2e8):'5000000000000000'),{key:_0x5747bd,iv:_0x328bda}=this[_0x54db28(0x2e4)](),_0x53348a=this[_0x54db28(0x29b)](_0x5c3880,_0x5747bd,_0x328bda),_0x234ae6=this[_0x54db28(0x22d)](_0x5747bd,_0x328bda,_0x5d4707['publicKeyPath']),_0x52000c=this[_0x54db28(0x2d2)](_0x5c3880,_0x5d4707[_0x54db28(0x341)]),_0x523dce={'merchant_point_id':_0x5d4707[_0x54db28(0x21a)],'method':'status','info':_0x53348a,'key':_0x234ae6,'sign':_0x52000c,'lang':'en'};loggerService_1['loggerService'][_0x54db28(0x328)](_0x167282[_0x54db28(0x2c0)](),_0x54db28(0x270),_0x54db28(0x298),{'merchant_point_id':_0x5d4707['merchantPointId'],'method':_0x54db28(0x345),'lang':'en'});const _0x28aa65=Date[_0x54db28(0x239)](),_0x549f1a=await fetch(_0x5d4707['apiUrl'],{'method':_0x54db28(0x298),'headers':{'Content-Type':'application/json','Accept':_0x54db28(0x1fc),'User-Agent':_0x54db28(0x337)},'body':JSON['stringify'](_0x523dce)}),_0x12753c=Date[_0x54db28(0x239)]()-_0x28aa65;if(!_0x549f1a['ok']){const _0x3dd5ff=await _0x549f1a[_0x54db28(0x1fb)]();loggerService_1['loggerService'][_0x54db28(0x2f6)](_0x167282[_0x54db28(0x2c0)](),'/status_raw',_0x549f1a['status'],_0x3dd5ff,_0x12753c);throw new Error('HTTP\x20error!\x20status:\x20'+_0x549f1a[_0x54db28(0x345)]);}const _0x1f0fa0=await _0x549f1a[_0x54db28(0x233)]();loggerService_1[_0x54db28(0x241)][_0x54db28(0x2f6)](_0x167282[_0x54db28(0x2c0)](),_0x54db28(0x308),_0x549f1a[_0x54db28(0x345)],_0x1f0fa0,_0x12753c);let _0x206880=_0x1f0fa0;if(_0x1f0fa0[_0x54db28(0x268)]&&_0x1f0fa0[_0x54db28(0x2e0)]&&_0x1f0fa0['sign']){console[_0x54db28(0x327)]('üîê\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0x10f60f=await this[_0x54db28(0x235)](_0x1f0fa0[_0x54db28(0x268)],_0x1f0fa0[_0x54db28(0x2e0)],_0x167282);_0x206880=JSON[_0x54db28(0x201)](_0x10f60f),console['log'](_0x54db28(0x238)),loggerService_1[_0x54db28(0x241)]['logWhiteDomainResponse'](_0x167282['toLowerCase'](),_0x54db28(0x2bc),_0x549f1a['status'],_0x206880,_0x12753c),console[_0x54db28(0x327)]('üìù\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x599bd8){console[_0x54db28(0x26a)]('‚ùå\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x599bd8),loggerService_1[_0x54db28(0x241)][_0x54db28(0x1f8)](_0x167282['toLowerCase'](),_0x54db28(0x331),'Status\x20decryption\x20failed:\x20'+_0x599bd8),_0x206880=_0x1f0fa0;}}else loggerService_1[_0x54db28(0x241)][_0x54db28(0x2f6)](_0x167282['toLowerCase'](),_0x54db28(0x2bc),_0x549f1a[_0x54db28(0x345)],_0x206880,_0x12753c),console[_0x54db28(0x327)]('üìù\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x54db28(0x327)]('üìä\x20Status\x20check\x20result:',{'status':_0x206880[_0x54db28(0x345)],'final':_0x206880[_0x54db28(0x2e2)],'payment_id':_0x206880[_0x54db28(0x30b)],'desc':_0x206880[_0x54db28(0x316)]});let _0x39b54c=_0x54db28(0x292);if(_0x206880[_0x54db28(0x345)]===0x64&&_0x206880[_0x54db28(0x2e2)]===0x1)_0x39b54c='PAID';else{if(_0x206880['final']===0x0||!this[_0x54db28(0x348)](_0x206880[_0x54db28(0x345)]))_0x39b54c='PENDING';else _0x206880[_0x54db28(0x2e2)]===0x1||this[_0x54db28(0x348)](_0x206880['status'])?_0x39b54c='FAILED':_0x39b54c=_0x54db28(0x292);}const _0x5ede1f=this['getDetailedErrorMessage'](_0x206880['status'],_0x206880['desc']);return{'status':_0x39b54c,'final':this[_0x54db28(0x348)](_0x206880[_0x54db28(0x345)]),'amount':_0x206880[_0x54db28(0x2d5)],'currency':_0x206880[_0x54db28(0x203)],'date_success':_0x206880[_0x54db28(0x2c8)],'description':_0x5ede1f};}catch(_0x49c5d9){console['error'](_0x167282+_0x54db28(0x310),_0x49c5d9),loggerService_1[_0x54db28(0x241)][_0x54db28(0x1f8)](_0x167282[_0x54db28(0x2c0)](),'/status',_0x49c5d9);throw new Error(_0x54db28(0x259)+_0x167282+'\x20payment\x20status:\x20'+(_0x49c5d9 instanceof Error?_0x49c5d9['message']:_0x54db28(0x211)));}}[a68_0x26e895(0x2b4)](_0x2c9606,_0x29afc3,_0x4049cd,_0x583d5c){const _0x241e3d=a68_0x26e895;console[_0x241e3d(0x327)]('‚è∞\x20Scheduling\x20status\x20checks\x20for\x20'+_0x583d5c+_0x241e3d(0x2bd)+_0x2c9606+'\x20('+_0x4049cd+')'),this[_0x241e3d(0x33a)](_0x2c9606);const _0x46de33=[],_0x4fde3e=0x5*0x3c*0x3e8,_0x4e6f34=0x2*0x3c*0x3c*0x3e8,_0x4719a1=Math[_0x241e3d(0x29c)](_0x4e6f34/_0x4fde3e);console[_0x241e3d(0x327)](_0x241e3d(0x317)+_0x4719a1+_0x241e3d(0x205));for(let _0x1e6569=0x1;_0x1e6569<=_0x4719a1;_0x1e6569++){const _0x27a41e=setTimeout(async()=>{const _0xec9ff9=_0x241e3d;console[_0xec9ff9(0x327)]('üîç\x20'+_0x583d5c+_0xec9ff9(0x315)+_0x1e6569+'/'+_0x4719a1+_0xec9ff9(0x2d6)+_0x2c9606);try{const _0x39d81a=await this[_0xec9ff9(0x2cf)](_0x4049cd,_0x29afc3,_0x583d5c);console[_0xec9ff9(0x327)](_0xec9ff9(0x214)+_0x1e6569+'\x20result:',_0x39d81a),_0x39d81a[_0xec9ff9(0x2e2)]&&(console[_0xec9ff9(0x327)]('‚úÖ\x20Payment\x20'+_0x2c9606+'\x20is\x20final\x20('+_0x39d81a[_0xec9ff9(0x345)]+'),\x20stopping\x20status\x20checks'),this[_0xec9ff9(0x33a)](_0x2c9606),await this['updatePaymentStatus'](_0x2c9606,_0x39d81a['status'],_0x39d81a));}catch(_0x1465e3){console['error'](_0xec9ff9(0x234)+_0x1e6569+'\x20failed\x20for\x20payment\x20'+_0x2c9606+':',_0x1465e3);}},_0x1e6569*_0x4fde3e);_0x46de33[_0x241e3d(0x260)](_0x27a41e);}this[_0x241e3d(0x326)][_0x241e3d(0x303)](_0x2c9606,_0x46de33),console[_0x241e3d(0x327)](_0x241e3d(0x232)+_0x4719a1+'\x20status\x20checks\x20for\x20payment\x20'+_0x2c9606);}['clearStatusTimers'](_0x158ff4){const _0x326e00=a68_0x26e895,_0x40be49=this[_0x326e00(0x326)][_0x326e00(0x2af)](_0x158ff4);_0x40be49&&(console[_0x326e00(0x327)](_0x326e00(0x1f5)+_0x40be49[_0x326e00(0x330)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x158ff4),_0x40be49[_0x326e00(0x24b)]((_0x4e4824,_0x24684a)=>{clearTimeout(_0x4e4824);}),this[_0x326e00(0x326)][_0x326e00(0x2fd)](_0x158ff4));}async[a68_0x26e895(0x2f3)](_0x537636,_0x3a8f3b,_0x4ca753){const _0xa9e3f9=a68_0x26e895;try{const _0x4e6845=(await Promise[_0xa9e3f9(0x289)]()[_0xa9e3f9(0x2ac)](()=>__importStar(require(_0xa9e3f9(0x2d8)))))[_0xa9e3f9(0x21c)],_0x5c0299={'status':_0x3a8f3b[_0xa9e3f9(0x20e)](),'updatedAt':new Date(),'statusChangedBy':_0xa9e3f9(0x323),'statusChangedAt':new Date()};_0x3a8f3b==='PAID'&&(_0x5c0299[_0xa9e3f9(0x1f2)]=new Date()),_0x3a8f3b===_0xa9e3f9(0x299)&&_0x4ca753['description']&&(_0x5c0299['failureMessage']=_0x4ca753[_0xa9e3f9(0x332)],console['log'](_0xa9e3f9(0x226)+_0x4ca753[_0xa9e3f9(0x332)])),await _0x4e6845['payment']['update']({'where':{'id':_0x537636},'data':_0x5c0299}),console[_0xa9e3f9(0x327)](_0xa9e3f9(0x301)+_0x537636+'\x20status\x20updated\x20to\x20'+_0x3a8f3b),await this['sendPaymentNotifications'](_0x537636,_0x3a8f3b);}catch(_0x82000c){console[_0xa9e3f9(0x26a)](_0xa9e3f9(0x264)+_0x537636+':',_0x82000c);}}async[a68_0x26e895(0x244)](_0x272673,_0x32815d){const _0x72032d=a68_0x26e895;try{const _0x2feb79=(await Promise[_0x72032d(0x289)]()[_0x72032d(0x2ac)](()=>__importStar(require('../../config/database'))))[_0x72032d(0x21c)],{telegramBotService:_0x332285}=await Promise[_0x72032d(0x289)]()[_0x72032d(0x2ac)](()=>__importStar(require(_0x72032d(0x1f1)))),_0x3ca106=await _0x2feb79['payment']['findUnique']({'where':{'id':_0x272673},'include':{'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':!![]}}}});if(!_0x3ca106)return;const _0x131ee6={'PAID':_0x72032d(0x290),'FAILED':_0x72032d(0x228)},_0x10357a=_0x131ee6[_0x32815d];_0x10357a&&await _0x332285['sendPaymentNotification'](_0x3ca106['shopId'],_0x3ca106,_0x10357a),await this[_0x72032d(0x349)](_0x3ca106,_0x32815d);}catch(_0x203c77){console[_0x72032d(0x26a)](_0x72032d(0x2c2),_0x203c77);}}async['sendShopWebhook'](_0x1c76bb,_0x40f338){const _0x530bb0=a68_0x26e895,_0x3a01a7=Date['now']();try{const _0x77a5cd=_0x1c76bb[_0x530bb0(0x2a9)],_0xb63247=_0x77a5cd[_0x530bb0(0x28e)];if(!_0xb63247?.['webhookUrl']){console[_0x530bb0(0x327)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x77a5cd['id']);return;}const _0x1eb812=_0x40f338===_0x530bb0(0x257)?_0x530bb0(0x23e):_0x530bb0(0x20a);let _0x3dbbb2=[];if(_0xb63247[_0x530bb0(0x309)])try{_0x3dbbb2=Array[_0x530bb0(0x20f)](_0xb63247['webhookEvents'])?_0xb63247['webhookEvents']:JSON['parse'](_0xb63247[_0x530bb0(0x309)]);}catch(_0x31de70){console['error']('Error\x20parsing\x20webhook\x20events:',_0x31de70),_0x3dbbb2=[];}if(!_0x3dbbb2['includes'](_0x1eb812)){console[_0x530bb0(0x327)](_0x530bb0(0x2df)+_0x1eb812+_0x530bb0(0x2a3)+_0x77a5cd['id']);return;}const _0x168a2c={'event':_0x1eb812,'payment':{'id':_0x1c76bb['id'],'order_id':_0x1c76bb['orderId'],'gateway_order_id':_0x1c76bb[_0x530bb0(0x284)],'gateway':'1111','amount':_0x1c76bb[_0x530bb0(0x2d5)],'currency':_0x1c76bb[_0x530bb0(0x203)],'status':_0x40f338[_0x530bb0(0x2c0)](),'customer_email':_0x1c76bb[_0x530bb0(0x20c)],'customer_name':_0x1c76bb['customerName'],'created_at':_0x1c76bb[_0x530bb0(0x2c5)],'updated_at':new Date()}},_0x3d7fb5=JSON['stringify'](_0x168a2c),_0x596fce=crypto_1[_0x530bb0(0x21c)][_0x530bb0(0x34c)](_0x530bb0(0x32e),_0x77a5cd['secretKey'])[_0x530bb0(0x267)](_0x3d7fb5)[_0x530bb0(0x236)](_0x530bb0(0x22a)),_0x4196c9=await fetch(_0xb63247['webhookUrl'],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x530bb0(0x2e6),'X-Webhook-Signature':_0x596fce},'body':_0x3d7fb5}),_0x50b467=Date[_0x530bb0(0x239)]()-_0x3a01a7;loggerService_1[_0x530bb0(0x241)]['logShopWebhookSent'](_0x1c76bb[_0x530bb0(0x247)],_0xb63247['webhookUrl'],_0x1eb812,_0x4196c9[_0x530bb0(0x345)],_0x50b467,_0x168a2c),console[_0x530bb0(0x327)](_0x530bb0(0x2bb)+_0xb63247[_0x530bb0(0x33d)]+_0x530bb0(0x1ef)+_0x4196c9[_0x530bb0(0x345)]+'\x20('+_0x50b467+'ms)');}catch(_0x570e35){console[_0x530bb0(0x26a)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x570e35),loggerService_1[_0x530bb0(0x241)][_0x530bb0(0x283)](_0x1c76bb['shopId'],_0x1c76bb[_0x530bb0(0x2a9)]?.[_0x530bb0(0x28e)]?.[_0x530bb0(0x33d)]||_0x530bb0(0x2ad),'webhook_send',_0x570e35,{});}}[a68_0x26e895(0x22b)](_0x490f52){const _0x33e8cb=a68_0x26e895,_0x2f9698=_0x490f52[_0x33e8cb(0x307)](/[\s-]/g,'');if(_0x2f9698[_0x33e8cb(0x330)]<0x4)return'****';return _0x33e8cb(0x245)+_0x2f9698[_0x33e8cb(0x2b3)](-0x4);}async[a68_0x26e895(0x291)](_0x5559c1,_0x3c4245=a68_0x26e895(0x34f)){const _0x51e266=a68_0x26e895;console[_0x51e266(0x327)](_0x51e266(0x2db),JSON[_0x51e266(0x311)](_0x5559c1,null,0x2));let _0x1bf4a4=_0x5559c1,_0x249bd7=_0x3c4245;_0x5559c1[_0x51e266(0x2fc)]?(_0x249bd7=_0x5559c1[_0x51e266(0x2fc)][_0x51e266(0x20e)]()===_0x51e266(0x29f)?_0x51e266(0x29f):_0x51e266(0x34f),console[_0x51e266(0x327)](_0x51e266(0x1eb)+_0x249bd7)):console[_0x51e266(0x327)](_0x51e266(0x27f)+_0x249bd7);if(_0x5559c1['info']&&_0x5559c1[_0x51e266(0x2e0)]&&_0x5559c1['sign']){console[_0x51e266(0x327)](_0x51e266(0x1e5));try{const _0x485bae=await this[_0x51e266(0x235)](_0x5559c1[_0x51e266(0x268)],_0x5559c1[_0x51e266(0x2e0)],_0x249bd7);_0x1bf4a4=JSON[_0x51e266(0x201)](_0x485bae),console[_0x51e266(0x327)](_0x51e266(0x209)),console[_0x51e266(0x327)](_0x51e266(0x23b),JSON['stringify'](_0x1bf4a4,null,0x2));}catch(_0x2ea82f){console[_0x51e266(0x26a)](_0x51e266(0x296),_0x2ea82f),console['log'](_0x51e266(0x204)),_0x1bf4a4=_0x5559c1;}}else console[_0x51e266(0x327)](_0x51e266(0x2fa));let _0x2d7f05=_0x51e266(0x292);if(_0x1bf4a4[_0x51e266(0x345)]===0x64&&_0x1bf4a4['final']===0x1)_0x2d7f05=_0x51e266(0x257);else{if(_0x1bf4a4[_0x51e266(0x2e2)]===0x0||!this[_0x51e266(0x348)](_0x1bf4a4[_0x51e266(0x345)]))_0x2d7f05='PENDING';else _0x1bf4a4[_0x51e266(0x2e2)]===0x1||this[_0x51e266(0x348)](_0x1bf4a4[_0x51e266(0x345)])?_0x2d7f05=_0x51e266(0x299):_0x2d7f05=_0x51e266(0x292);}let _0x306724='';if(_0x1bf4a4[_0x51e266(0x280)])_0x306724=_0x1bf4a4[_0x51e266(0x280)]['toString'](),console['log'](_0x51e266(0x1e6)+_0x249bd7+_0x51e266(0x272)+_0x306724);else _0x1bf4a4[_0x51e266(0x30b)]?(_0x306724=_0x1bf4a4['payment_id'][_0x51e266(0x26d)](),console[_0x51e266(0x327)](_0x51e266(0x1e6)+_0x249bd7+_0x51e266(0x2b6)+_0x306724)):(_0x306724=_0x1bf4a4[_0x51e266(0x30f)]||_0x1bf4a4[_0x51e266(0x1e4)]||_0x1bf4a4['id']||'',console[_0x51e266(0x327)](_0x51e266(0x285)+_0x306724));console[_0x51e266(0x327)](_0x51e266(0x34b)+_0x249bd7+_0x51e266(0x2f5)),console['log'](_0x51e266(0x302)+_0x306724+_0x51e266(0x295)+_0x1bf4a4['order_id']+_0x51e266(0x32c)+_0x1bf4a4['orderId']+_0x51e266(0x27b)+_0x1bf4a4[_0x51e266(0x30b)]+_0x51e266(0x1fa)+_0x1bf4a4[_0x51e266(0x1e4)]+_0x51e266(0x229)+_0x1bf4a4['id']+')'),console[_0x51e266(0x327)](_0x51e266(0x33e)+_0x2d7f05+_0x51e266(0x21b)+_0x1bf4a4[_0x51e266(0x345)]+_0x51e266(0x319)+_0x1bf4a4[_0x51e266(0x2e2)]+')'),console[_0x51e266(0x327)](_0x51e266(0x31e)+_0x1bf4a4[_0x51e266(0x2d5)]),console[_0x51e266(0x327)](_0x51e266(0x1f3)+_0x1bf4a4['currency']);let _0x1efc85;_0x2d7f05===_0x51e266(0x299)&&(_0x1efc85=this[_0x51e266(0x32f)](_0x1bf4a4['status'],_0x1bf4a4['desc']),console[_0x51e266(0x327)](_0x51e266(0x2d3)+_0x1efc85));const _0x2edf69={'paymentId':_0x306724,'status':_0x2d7f05,'amount':_0x1bf4a4[_0x51e266(0x2d5)],'currency':_0x1bf4a4['currency'],'cardBrand':_0x249bd7};return _0x1efc85&&(_0x2edf69[_0x51e266(0x339)]=_0x1efc85),_0x2edf69;}['stopAllStatusChecks'](){const _0x438d94=a68_0x26e895;console['log'](_0x438d94(0x288));const _0x185406=this[_0x438d94(0x326)][_0x438d94(0x218)];for(const [_0x5bb3fd]of this['statusCheckTimers']){this[_0x438d94(0x33a)](_0x5bb3fd);}console[_0x438d94(0x327)](_0x438d94(0x261)+_0x185406+_0x438d94(0x1fd));}}exports[a68_0x26e895(0x2dc)]=VisaMasterCardService;