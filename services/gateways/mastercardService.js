'use strict';const a51_0x5b2495=a51_0x1f9c;(function(_0x36a31b,_0x7693ea){const _0x3efb74=a51_0x1f9c,_0x550d31=_0x36a31b();while(!![]){try{const _0x2f4373=parseInt(_0x3efb74(0x10c))/0x1+-parseInt(_0x3efb74(0x140))/0x2+parseInt(_0x3efb74(0x241))/0x3+parseInt(_0x3efb74(0x20d))/0x4+-parseInt(_0x3efb74(0x14d))/0x5*(parseInt(_0x3efb74(0x20c))/0x6)+-parseInt(_0x3efb74(0x124))/0x7*(-parseInt(_0x3efb74(0x1df))/0x8)+parseInt(_0x3efb74(0x1c9))/0x9*(-parseInt(_0x3efb74(0x14f))/0xa);if(_0x2f4373===_0x7693ea)break;else _0x550d31['push'](_0x550d31['shift']());}catch(_0xb28a8d){_0x550d31['push'](_0x550d31['shift']());}}}(a51_0x4a03,0x3a195));function a51_0x4a03(){const _0x207ebe=['validateKeyFiles','error','first_name','__esModule','payment','),\x20stopping\x20status\x20checks','🔐\x203DS\x20verification\x20required','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','https://api2.trapay.uk/decrypt.php',',\x20orderId=','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','108iHSCAQ','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','createDecipheriv','🔐\x20RSA\x20signing\x20successful','🔐\x20AES\x20key\x20and\x20IV\x20generated','last_name','join','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','message','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','https://api.paydmeth.com/api','decryptResponse','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','toUpperCase','crypto','Failed\x20to\x20send\x20payment\x20notifications:','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','key','Payment\x20confirmation\x20time\x20has\x20expired','SHA256','📊\x20Status\x20check\x20result:','24fbMygP','/charge_decrypted','sendShopWebhook','\x20\x20\x20Status:\x20','decryptResponsePhp','Sender\x27s\x20card\x20details\x20are\x20required','💳\x20VISA/MasterCard\x20service\x20initialized','now','checkPaymentStatus','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','scheduleStatusChecks','set','Unknown\x20error','\x20\x20\x20-\x20lang:\x20en','Insufficient\x20funds\x20on\x20the\x20card','🛑\x20Stopped\x20','/status_raw','PAID','\x20(from:\x20order_id=','Request\x20data\x20error','amount','\x20for\x20payment\x20','\x20result:','\x20payment:\x20','🔐\x20MasterCard\x20API\x20URL:','Response\x20Time:','🎯\x20Using\x20','__importStar','PIN\x20code\x20confirmation\x20awaited','createdAt','\x20status\x20timers\x20for\x20payment\x20','expire_year','Cancellation\x20is\x20not\x20possible','cvv','resolve','log','webhookEvents','💾\x20Saving\x20failure\x20message:\x20','LookUp\x20not\x20confirmed','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','\x20\x20\x20Amount:\x20','Failed\x20to\x20send\x20MasterCard\x20webhook:','logWhiteDomainRequest','Amount:','Status\x20','852108OnkYak','1654104hJaNJM','-----BEGIN','📝\x20Data\x20length:','\x20status\x20updated\x20to\x20','customerName','🔍\x20Using\x20','Decryption\x20failed:\x20','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','sendPaymentNotification','/charge_decrypt','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','Status\x20decryption\x20failed:\x20','status','\x20\x20\x20-\x20merchant_point_id:',',\x20paymentId=','Sender\x20information\x20required','===\x20PARSED\x20API\x20RESPONSE\x20===','Webhook\x20event\x20','private.pem','Captcha\x20confirmation\x20awaited','desc','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)',',\x20payment_id=','encryptAES','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','\x20status\x20check\x20error:','3ds_url','none','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','Payment\x20ID:','Error\x20details:','No\x20Error\x20executing\x20request','update','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','\x20\x20\x20-\x20key\x20length:','masterCardApiUrl','includes','readFileSync','writable','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','then','updatePaymentStatus','warn','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','🔐\x20MasterCard\x20Private\x20key\x20path:','VISA','end','Return\x20URL:','\x20\x20Original:\x20\x22','replace','isArray','1006227qqoubK','application/json','Payment\x20prohibited','visa/mastercard','\x20MasterCard\x20status\x20check\x20timers','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','🔐\x20Data\x20signed\x20with\x20RSA','default','createCipheriv','PENDING','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','Awaiting\x20confirmation\x20by\x20ivr\x20call','/charge_raw','gatewayOrderId','Unsuccessful\x20payment','cardType','Payment\x20returned','stringify','4000000000000000','🔐\x20Data\x20encrypted\x20with\x20AES','clearStatusTimers','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','\x22\x20|\x20\x22','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','webhookUrl','webhook_send','logShopWebhookSent','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','🔐\x20MasterCard\x20Public\x20key\x20path:','payment.failed','297101RnpEhB','apiUrl','substring','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','\x20order_id\x20for\x20search:\x20','shop','visaPublicKeyPath','MASTERCARD','✅\x20Payment\x20','forEach','🔐\x20Using\x20keys:\x20','\x20\x20Cleaned:\x20\x20\x22','📝\x20Final\x20request\x20structure:','-----END','/status_decrypted','📝\x20Encrypted\x20data\x20length:','🔐\x20VISA\x20Private\x20key\x20length:\x20','order_id','final','Operation\x20completed\x20successfully','Invalid\x20expiration\x20date','psp_public.pem','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','FAILED','1061662kaqZWg','card_type','5000000000000000','signRSA','visaApiUrl','Result\x20URL:','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','HTTP\x20Status:','📤\x20Sending\x20request\x20to\x20API...','encryptRSA','visaPrivateKeyPath','configurable','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','Failed\x20payment','Cash\x20payment\x20is\x20expected\x20at\x20TCO','decryptAES','🔐\x20VISA\x20Public\x20key\x20length:\x20','\x20is\x20final\x20(','Error\x20parsing\x20webhook\x20events:','constants','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','\x20status\x20check\x20#','unknown','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','length','merchantPointId','masterCardMerchantPointId','539262YvENgU','payment.success','number','3DS\x20verification\x20required','existsSync','/status','findUnique','expire_month','privateKeyPath','✅\x20VISA\x20key\x20files\x20validated\x20successfully','sign','Failed\x20to\x20check\x20','HTTP\x20error!\x20status:\x20','5jprEZd','aes-256-ctr','709510NioWtM','slice','\x20\x20\x20Currency:\x20','prototype','loggerService','description','isFinalStatus','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','settings','⏰\x20Will\x20check\x20status\x20','PHP\x20decryptor\x20error','📝\x20Decrypted\x20webhook\x20data:','Card\x20Number:','✅\x20Status\x20response\x20decrypted\x20successfully','createSign','errorMessage','customerEmail','\x20payment\x20status:\x20','Payment\x20System/1.0','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','paymentStatuses','getDetailedErrorMessage','../loggerService','toString','utf8','randomBytes','shopId','visa_private.pem','🔐\x20AES\x20IV\x20length:','create','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','payment_id','\x20(from:\x20status=','call','get','/status_decrypt','🧹\x20Card\x20holder\x20names\x20cleaned:','toLowerCase','charAt','path','Number\x20of\x20attempts\x20exceeded','🔐\x20AES\x20key\x20length:','Final:','/charge','generateAESKey','floor','\x20|\x20Response:\x20','❌\x20RSA\x20encryption\x20failed:','trim','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','🔍\x20','HTTP\x20','paid','Sender\x27s\x20CVV\x20card\x20is\x20required','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','processWebhook','from','VisaMasterCardService','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Card\x20Holder:','Payment\x20is\x20being\x20processed','LookUp\x20number\x20of\x20attempts\x20exceeded','\x20characters','parse','📊\x20Checking\x20','⏰\x20Scheduling\x20status\x20checks\x20for\x20','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','stopAllStatusChecks','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format',',\x20final=','base64','info','POST','publicKeyPath','logShopWebhookError','__setModuleDefault','📝\x20Data\x20to\x20sign\x20length:','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','keys','defineProperty','orderId','paymentId','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','currency','Payment\x20cancellation\x20is\x20being\x20processed','Payment\x20confirmation\x20required','Expected\x20bitcoin\x20transfer\x20from\x20client','paidAt','text','\x20status\x20checks\x20for\x20payment\x20','statusCheckTimers','sendPaymentNotifications','❌\x20PHP\x20decryptor\x20request\x20failed:','Order\x20ID:','📊\x20','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','../telegramBotService','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','Status:','privateDecrypt','Method\x20not\x20allowed','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20',',\x20Final:\x20','charge','logWhiteDomainResponse','hasOwnProperty','logWhiteDomainError','Response\x20Body:'];a51_0x4a03=function(){return _0x207ebe;};return a51_0x4a03();}var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x181da9,_0x2bc9b1,_0x4a9135,_0x54a57a){const _0x33a631=a51_0x1f9c;if(_0x54a57a===undefined)_0x54a57a=_0x4a9135;var _0x12ca97=Object['getOwnPropertyDescriptor'](_0x2bc9b1,_0x4a9135);(!_0x12ca97||(_0x33a631(0x171)in _0x12ca97?!_0x2bc9b1[_0x33a631(0x1c0)]:_0x12ca97[_0x33a631(0x234)]||_0x12ca97[_0x33a631(0x12f)]))&&(_0x12ca97={'enumerable':!![],'get':function(){return _0x2bc9b1[_0x4a9135];}}),Object[_0x33a631(0x19f)](_0x181da9,_0x54a57a,_0x12ca97);}:function(_0x1a4d4c,_0x3870c2,_0x36b81b,_0x3c1141){if(_0x3c1141===undefined)_0x3c1141=_0x36b81b;_0x1a4d4c[_0x3c1141]=_0x3870c2[_0x36b81b];}),__setModuleDefault=this&&this[a51_0x5b2495(0x19b)]||(Object[a51_0x5b2495(0x16c)]?function(_0x23d21a,_0x4af786){const _0x110752=a51_0x5b2495;Object[_0x110752(0x19f)](_0x23d21a,_0x110752(0x248),{'enumerable':!![],'value':_0x4af786});}:function(_0x20924d,_0x1f1672){const _0x559dce=a51_0x5b2495;_0x20924d[_0x559dce(0x248)]=_0x1f1672;}),__importStar=this&&this[a51_0x5b2495(0x1fa)]||(function(){var _0x2fea13=function(_0x39b26f){return _0x2fea13=Object['getOwnPropertyNames']||function(_0x5cd562){const _0x308a4b=a51_0x1f9c;var _0x28e7da=[];for(var _0x535fb6 in _0x5cd562)if(Object[_0x308a4b(0x152)][_0x308a4b(0x1ba)][_0x308a4b(0x170)](_0x5cd562,_0x535fb6))_0x28e7da[_0x28e7da[_0x308a4b(0x13d)]]=_0x535fb6;return _0x28e7da;},_0x2fea13(_0x39b26f);};return function(_0xb2687d){const _0x5be4a8=a51_0x1f9c;if(_0xb2687d&&_0xb2687d[_0x5be4a8(0x1c0)])return _0xb2687d;var _0x5900df={};if(_0xb2687d!=null){for(var _0x3287ca=_0x2fea13(_0xb2687d),_0x4f988b=0x0;_0x4f988b<_0x3287ca['length'];_0x4f988b++)if(_0x3287ca[_0x4f988b]!==_0x5be4a8(0x248))__createBinding(_0x5900df,_0xb2687d,_0x3287ca[_0x4f988b]);}return __setModuleDefault(_0x5900df,_0xb2687d),_0x5900df;};}()),__importDefault=this&&this['__importDefault']||function(_0x305eef){const _0x2f0f5e=a51_0x5b2495;return _0x305eef&&_0x305eef[_0x2f0f5e(0x1c0)]?_0x305eef:{'default':_0x305eef};};function a51_0x1f9c(_0x82d009,_0x58aaca){const _0x4a033a=a51_0x4a03();return a51_0x1f9c=function(_0x1f9c08,_0x43ae93){_0x1f9c08=_0x1f9c08-0x10b;let _0x4c27f8=_0x4a033a[_0x1f9c08];return _0x4c27f8;},a51_0x1f9c(_0x82d009,_0x58aaca);}Object[a51_0x5b2495(0x19f)](exports,a51_0x5b2495(0x1c0),{'value':!![]}),exports['VisaMasterCardService']=void 0x0;const crypto_1=__importDefault(require(a51_0x5b2495(0x1d8))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x5b2495(0x176))),loggerService_1=require(a51_0x5b2495(0x165));class VisaMasterCardService{constructor(){const _0x4198a5=a51_0x5b2495;this[_0x4198a5(0x1aa)]=new Map(),this[_0x4198a5(0x163)]={0x0:{'final':![],'description':'No\x20New\x20payment'},0x1:{'final':![],'description':_0x4198a5(0x22d)},0x2:{'final':!![],'description':_0x4198a5(0x1f2)},0x3:{'final':!![],'description':'Another\x20unknown\x20error'},0x4:{'final':!![],'description':_0x4198a5(0x24f)},0x5:{'final':!![],'description':'Payment\x20not\x20found\x20using\x20the\x20specified\x20details'},0x6:{'final':!![],'description':'Payment\x20returned'},0x7:{'final':!![],'description':'Test\x20payment'},0x8:{'final':![],'description':'Client\x20OTP\x20confirmation\x20required'},0x9:{'final':![],'description':_0x4198a5(0x143)},0xa:{'final':![],'description':_0x4198a5(0x184)},0xb:{'final':![],'description':_0x4198a5(0x21c)},0xc:{'final':![],'description':'Recipient\x20data\x20required'},0xd:{'final':![],'description':_0x4198a5(0x1d6)},0xe:{'final':![],'description':_0x4198a5(0x24c)},0xf:{'final':![],'description':_0x4198a5(0x1fb)},0x10:{'final':![],'description':_0x4198a5(0x220)},0x11:{'final':![],'description':_0x4198a5(0x1af)},0x12:{'final':![],'description':'Awaiting\x20confirmation\x20in\x20the\x20application'},0x13:{'final':![],'description':_0x4198a5(0x18b)},0x14:{'final':![],'description':_0x4198a5(0x162)},0x15:{'final':![],'description':_0x4198a5(0x1a6)},0x16:{'final':![],'description':'Payment\x20pending\x20verification'},0x18:{'final':![],'description':_0x4198a5(0x180)},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':_0x4198a5(0x132)},0x1b:{'final':![],'description':_0x4198a5(0x1b1)},0x1c:{'final':![],'description':_0x4198a5(0x256)},0x1d:{'final':![],'description':_0x4198a5(0x193)},0x1f:{'final':![],'description':_0x4198a5(0x185)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':_0x4198a5(0x1e4)},0x24:{'final':!![],'description':_0x4198a5(0x1dc)},0x25:{'final':!![],'description':_0x4198a5(0x243)},0x26:{'final':!![],'description':'The\x20payment\x20status\x20must\x20be\x20clarified\x20manually'},0x27:{'final':!![],'description':_0x4198a5(0x1ed)},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':'The\x20card\x20is\x20lost\x20or\x20stolen'},0x2a:{'final':!![],'description':_0x4198a5(0x120)},0x2b:{'final':!![],'description':'Transaction\x20limit\x20exceeded'},0x2c:{'final':!![],'description':'The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank'},0x2d:{'final':!![],'description':_0x4198a5(0x131)},0x2e:{'final':!![],'description':_0x4198a5(0x24f)},0x2f:{'final':!![],'description':_0x4198a5(0x24f)},0x30:{'final':!![],'description':_0x4198a5(0x25d)},0x31:{'final':![],'description':_0x4198a5(0x1a5)},0x32:{'final':!![],'description':_0x4198a5(0x1b4)},0x33:{'final':!![],'description':'Failed\x20payment'},0x34:{'final':!![],'description':_0x4198a5(0x131)},0x35:{'final':!![],'description':_0x4198a5(0x131)},0x36:{'final':!![],'description':'Failed\x20payment'},0x37:{'final':!![],'description':_0x4198a5(0x131)},0x38:{'final':!![],'description':_0x4198a5(0x1ff)},0x39:{'final':![],'description':_0x4198a5(0x122)},0x3a:{'final':![],'description':'LookUp\x20code\x20sent'},0x3b:{'final':!![],'description':'LookUp\x20code\x20verified'},0x3c:{'final':!![],'description':_0x4198a5(0x177)},0x3d:{'final':!![],'description':_0x4198a5(0x239)},0x3e:{'final':!![],'description':'Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID'},0x3f:{'final':!![],'description':_0x4198a5(0x251)},0x40:{'final':![],'description':_0x4198a5(0x205)},0x41:{'final':!![],'description':_0x4198a5(0x18c)},0x42:{'final':![],'description':_0x4198a5(0x1a4)},0x43:{'final':!![],'description':_0x4198a5(0x12a)},0x44:{'final':![],'description':_0x4198a5(0x143)},0x45:{'final':!![],'description':_0x4198a5(0x131)},0x46:{'final':!![],'description':_0x4198a5(0x131)},0x47:{'final':!![],'description':'Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details'},0x64:{'final':!![],'description':_0x4198a5(0x11f)}},this['masterCardApiUrl']='https://api.paydmeth.com/api',this[_0x4198a5(0x13f)]=0x6e4,this[_0x4198a5(0x148)]=path_1['default'][_0x4198a5(0x1cf)](process['cwd'](),_0x4198a5(0x19e),_0x4198a5(0x21f)),this[_0x4198a5(0x199)]=path_1[_0x4198a5(0x248)][_0x4198a5(0x1cf)](process['cwd'](),_0x4198a5(0x19e),_0x4198a5(0x121)),this[_0x4198a5(0x128)]=_0x4198a5(0x1d3),this['visaMerchantPointId']=0x6b7,this[_0x4198a5(0x12e)]=path_1[_0x4198a5(0x248)]['join'](process['cwd'](),'keys',_0x4198a5(0x16a)),this[_0x4198a5(0x112)]=path_1[_0x4198a5(0x248)]['join'](process['cwd'](),_0x4198a5(0x19e),'visa_public.pem'),console[_0x4198a5(0x202)](_0x4198a5(0x1e5)),console['log'](_0x4198a5(0x1f7),this[_0x4198a5(0x231)]),console[_0x4198a5(0x202)]('🔐\x20VISA\x20API\x20URL:',this[_0x4198a5(0x128)]),console[_0x4198a5(0x202)](_0x4198a5(0x23a),this[_0x4198a5(0x148)]),console[_0x4198a5(0x202)](_0x4198a5(0x25e),this[_0x4198a5(0x199)]),console[_0x4198a5(0x202)]('🔐\x20VISA\x20Private\x20key\x20path:',this[_0x4198a5(0x12e)]),console[_0x4198a5(0x202)]('🔐\x20VISA\x20Public\x20key\x20path:',this[_0x4198a5(0x112)]),this[_0x4198a5(0x1bd)]();}['getDetailedErrorMessage'](_0x235d05,_0x2de16e){const _0x58c43f=a51_0x5b2495,_0x1553e3=this[_0x58c43f(0x163)][_0x235d05];let _0x2e17c8='';_0x1553e3?_0x2e17c8='Status\x20'+_0x235d05+':\x20'+_0x1553e3['description']:_0x2e17c8=_0x58c43f(0x20b)+_0x235d05+':\x20Unknown\x20status\x20code';if(_0x2de16e&&_0x2de16e[_0x58c43f(0x17f)]()){const _0x558ab6=_0x2de16e['trim']();(!_0x1553e3||_0x558ab6[_0x58c43f(0x174)]()!==_0x1553e3[_0x58c43f(0x154)][_0x58c43f(0x174)]())&&(_0x2e17c8+=_0x58c43f(0x17d)+_0x558ab6);}return _0x2e17c8;}[a51_0x5b2495(0x155)](_0x36eafa){const _0x3eb026=a51_0x5b2495,_0x14ba44=this[_0x3eb026(0x163)][_0x36eafa];return _0x14ba44?_0x14ba44[_0x3eb026(0x11e)]:!![];}['getCardTypeAndApi'](_0x43f4cc){const _0x4180eb=a51_0x5b2495,_0x4348b4=_0x43f4cc[_0x4180eb(0x175)](0x0);if(_0x4348b4==='4')return console[_0x4180eb(0x202)](_0x4180eb(0x1b5)),{'cardType':_0x4180eb(0x23b),'apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x4180eb(0x12e)],'publicKeyPath':this[_0x4180eb(0x112)],'merchantPointId':this['visaMerchantPointId']};else return _0x4348b4==='5'?(console[_0x4180eb(0x202)](_0x4180eb(0x222)),{'cardType':_0x4180eb(0x113),'apiUrl':this[_0x4180eb(0x231)],'privateKeyPath':this[_0x4180eb(0x148)],'publicKeyPath':this[_0x4180eb(0x199)],'merchantPointId':this['masterCardMerchantPointId']}):(console['log'](_0x4180eb(0x19d)+_0x4348b4+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':_0x4180eb(0x113),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x4180eb(0x199)],'merchantPointId':this[_0x4180eb(0x13f)]});}[a51_0x5b2495(0x1bd)](){const _0xdc92ac=a51_0x5b2495;try{if(!fs_1['default'][_0xdc92ac(0x144)](this[_0xdc92ac(0x148)]))throw new Error(_0xdc92ac(0x1b6)+this[_0xdc92ac(0x148)]);if(!fs_1['default']['existsSync'](this[_0xdc92ac(0x199)]))throw new Error(_0xdc92ac(0x1c4)+this[_0xdc92ac(0x199)]);const _0x4206aa=fs_1[_0xdc92ac(0x248)]['readFileSync'](this['privateKeyPath'],_0xdc92ac(0x167))[_0xdc92ac(0x17f)](),_0x45b022=fs_1[_0xdc92ac(0x248)][_0xdc92ac(0x233)](this[_0xdc92ac(0x199)],_0xdc92ac(0x167))[_0xdc92ac(0x17f)]();if(!_0x4206aa[_0xdc92ac(0x232)](_0xdc92ac(0x20e))||!_0x4206aa[_0xdc92ac(0x232)]('-----END'))throw new Error(_0xdc92ac(0x194));if(!_0x45b022[_0xdc92ac(0x232)](_0xdc92ac(0x20e))||!_0x45b022[_0xdc92ac(0x232)](_0xdc92ac(0x119)))throw new Error(_0xdc92ac(0x1c5));console[_0xdc92ac(0x202)](_0xdc92ac(0x258)),console[_0xdc92ac(0x202)](_0xdc92ac(0x22a)+_0x4206aa[_0xdc92ac(0x13d)]+_0xdc92ac(0x18d)),console['log'](_0xdc92ac(0x1d0)+_0x45b022[_0xdc92ac(0x13d)]+_0xdc92ac(0x18d));if(fs_1[_0xdc92ac(0x248)][_0xdc92ac(0x144)](this['visaPrivateKeyPath'])&&fs_1[_0xdc92ac(0x248)][_0xdc92ac(0x144)](this[_0xdc92ac(0x112)])){const _0x49c14b=fs_1['default']['readFileSync'](this['visaPrivateKeyPath'],_0xdc92ac(0x167))[_0xdc92ac(0x17f)](),_0x342eaf=fs_1[_0xdc92ac(0x248)][_0xdc92ac(0x233)](this[_0xdc92ac(0x112)],'utf8')[_0xdc92ac(0x17f)]();(!_0x49c14b['includes']('-----BEGIN')||!_0x49c14b['includes']('-----END'))&&console[_0xdc92ac(0x238)]('⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),(!_0x342eaf['includes']('-----BEGIN')||!_0x342eaf[_0xdc92ac(0x232)](_0xdc92ac(0x119)))&&console[_0xdc92ac(0x238)](_0xdc92ac(0x13c)),console[_0xdc92ac(0x202)](_0xdc92ac(0x149)),console[_0xdc92ac(0x202)](_0xdc92ac(0x11c)+_0x49c14b[_0xdc92ac(0x13d)]+_0xdc92ac(0x18d)),console[_0xdc92ac(0x202)](_0xdc92ac(0x134)+_0x342eaf['length']+_0xdc92ac(0x18d));}else console[_0xdc92ac(0x238)](_0xdc92ac(0x16d)),console['warn'](_0xdc92ac(0x1d2)+this[_0xdc92ac(0x12e)]),console[_0xdc92ac(0x238)](_0xdc92ac(0x206)+this['visaPublicKeyPath']);}catch(_0xee0ffe){console[_0xdc92ac(0x1be)](_0xdc92ac(0x130),_0xee0ffe);throw _0xee0ffe;}}['generateAESKey'](){const _0x16a582=a51_0x5b2495,_0x47e7ce=crypto_1[_0x16a582(0x248)]['randomBytes'](0x20),_0x2fefd2=crypto_1['default'][_0x16a582(0x168)](0x10);return{'key':_0x47e7ce,'iv':_0x2fefd2};}[a51_0x5b2495(0x224)](_0xfcea2a,_0x42ad13,_0x4a9a29){const _0x5677b0=a51_0x5b2495,_0x117fa1=crypto_1['default'][_0x5677b0(0x249)](_0x5677b0(0x14e),_0x42ad13,_0x4a9a29);let _0x4d8909=_0x117fa1[_0x5677b0(0x22e)](_0xfcea2a,_0x5677b0(0x167),'base64');return _0x4d8909+=_0x117fa1[_0x5677b0(0x11e)](_0x5677b0(0x196)),_0x4d8909;}[a51_0x5b2495(0x12d)](_0x31207b,_0x17e57e,_0x5dc043){const _0x2be19d=a51_0x5b2495;try{const _0x2efc6b=fs_1[_0x2be19d(0x248)][_0x2be19d(0x233)](_0x5dc043,_0x2be19d(0x167))[_0x2be19d(0x17f)](),_0x43b659={'iv':_0x17e57e['toString'](_0x2be19d(0x196)),'key':_0x31207b['toString']('base64')},_0x2120ca=JSON[_0x2be19d(0x252)](_0x43b659);console[_0x2be19d(0x202)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x2120ca[_0x2be19d(0x13d)]);const _0x321a00=crypto_1[_0x2be19d(0x248)]['publicEncrypt']({'key':_0x2efc6b,'padding':crypto_1[_0x2be19d(0x248)][_0x2be19d(0x137)]['RSA_PKCS1_PADDING']},Buffer['from'](_0x2120ca));return console['log'](_0x2be19d(0x191),_0x321a00[_0x2be19d(0x13d)]),_0x321a00[_0x2be19d(0x166)](_0x2be19d(0x196));}catch(_0x29eb0b){console['error'](_0x2be19d(0x17e),_0x29eb0b);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a51_0x5b2495(0x127)](_0x13d075,_0x54a09f){const _0x1e0413=a51_0x5b2495;try{const _0xefd141=fs_1['default'][_0x1e0413(0x233)](_0x54a09f,_0x1e0413(0x167))[_0x1e0413(0x17f)](),_0x19219d=crypto_1[_0x1e0413(0x248)][_0x1e0413(0x15d)](_0x1e0413(0x1dd));_0x19219d['update'](_0x13d075),_0x19219d[_0x1e0413(0x23c)]();const _0x388878=_0x19219d[_0x1e0413(0x14a)](_0xefd141,_0x1e0413(0x196));return console['log'](_0x1e0413(0x1cc)),console[_0x1e0413(0x202)](_0x1e0413(0x19c),_0x13d075[_0x1e0413(0x13d)]),console[_0x1e0413(0x202)]('📝\x20Signature\x20length:',_0x388878[_0x1e0413(0x13d)]),_0x388878;}catch(_0x30c7ab){console[_0x1e0413(0x1be)]('❌\x20RSA\x20signing\x20failed:',_0x30c7ab),console[_0x1e0413(0x1be)]('❌\x20Data\x20being\x20signed:',_0x13d075[_0x1e0413(0x10e)](0x0,0xc8)+'...');throw new Error(_0x1e0413(0x24b));}}[a51_0x5b2495(0x133)](_0xec01b1,_0x5246d8,_0x4614ea){const _0x3633f7=a51_0x5b2495,_0x39accc=crypto_1['default'][_0x3633f7(0x1cb)](_0x3633f7(0x14e),_0x5246d8,_0x4614ea);let _0x5f398e=_0x39accc[_0x3633f7(0x22e)](_0xec01b1,_0x3633f7(0x196),_0x3633f7(0x167));return _0x5f398e+=_0x39accc[_0x3633f7(0x11e)](_0x3633f7(0x167)),_0x5f398e;}async[a51_0x5b2495(0x1e3)](_0x8b9034,_0x57b533,_0x275389=a51_0x5b2495(0x113)){const _0x4c2eb7=a51_0x5b2495;try{const _0x5b61c4=await fetch(_0x4c2eb7(0x1c6),{'method':'POST','headers':{'Content-Type':_0x4c2eb7(0x242)},'body':JSON['stringify']({'info':_0x8b9034,'key':_0x57b533,'card_type':_0x275389[_0x4c2eb7(0x174)]()})});if(!_0x5b61c4['ok'])throw new Error(_0x4c2eb7(0x159));return await _0x5b61c4['text']();}catch(_0x163cff){console['error'](_0x4c2eb7(0x1ac),_0x163cff);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a51_0x5b2495(0x1d4)](_0x2f3061,_0x3eec2b){const _0xb40b08=a51_0x5b2495;try{const _0x306d9b=fs_1[_0xb40b08(0x248)]['readFileSync'](this[_0xb40b08(0x148)],'utf8')['trim'](),_0x2911ac=crypto_1[_0xb40b08(0x248)][_0xb40b08(0x1b3)](_0x306d9b,Buffer[_0xb40b08(0x187)](_0x3eec2b,_0xb40b08(0x196))),_0x43ba05=JSON[_0xb40b08(0x18e)](_0x2911ac['toString']()),_0x59c7f1=Buffer['from'](_0x43ba05[_0xb40b08(0x1db)],_0xb40b08(0x196)),_0x10c192=Buffer['from'](_0x43ba05['iv'],_0xb40b08(0x196));return this['decryptAES'](_0x2f3061,_0x59c7f1,_0x10c192);}catch(_0x584d42){throw new Error('Failed\x20to\x20decrypt\x20response');}}async['processCardPayment'](_0x5fdce0){const _0x57461b=a51_0x5b2495,{paymentId:_0xeba32f,orderId:_0x12fc17,amount:_0x29b3ad,currency:_0x2a41d4,cardData:_0x45e471,resultUrl:_0x1085b3,returnUrl:_0x4a2a4e,cardHolder:_0x28b9e0,browser:_0x19890b}=_0x5fdce0;console[_0x57461b(0x202)](_0x57461b(0x10f)),console[_0x57461b(0x202)]('Payment\x20ID:',_0xeba32f),console[_0x57461b(0x202)](_0x57461b(0x1ad),_0x12fc17),console['log'](_0x57461b(0x20a),_0x29b3ad,_0x2a41d4),console[_0x57461b(0x202)](_0x57461b(0x15b),this['maskCardNumber'](_0x45e471['number'])),console[_0x57461b(0x202)](_0x57461b(0x18a),_0x28b9e0[_0x57461b(0x1bf)]+'\x20'+_0x28b9e0[_0x57461b(0x1ce)]),console['log'](_0x57461b(0x23d),_0x4a2a4e),console[_0x57461b(0x202)](_0x57461b(0x129),_0x1085b3);const _0xf93275=this['getCardTypeAndApi'](_0x45e471[_0x57461b(0x142)]);console[_0x57461b(0x202)](_0x57461b(0x1f9)+_0xf93275[_0x57461b(0x250)]+'\x20API:\x20'+_0xf93275[_0x57461b(0x10d)]),console[_0x57461b(0x202)](_0x57461b(0x116)+_0xf93275[_0x57461b(0x148)]+',\x20'+_0xf93275[_0x57461b(0x199)]);const _0x596ca9={..._0x28b9e0,'first_name':_0x28b9e0[_0x57461b(0x1bf)]?.[_0x57461b(0x23f)](/[\t\n\r\f\v]/g,'\x20')[_0x57461b(0x17f)]()||'','last_name':_0x28b9e0[_0x57461b(0x1ce)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x57461b(0x17f)]()||''};console[_0x57461b(0x202)](_0x57461b(0x173)),console[_0x57461b(0x202)](_0x57461b(0x23e)+_0x28b9e0[_0x57461b(0x1bf)]+_0x57461b(0x257)+_0x28b9e0['last_name']+'\x22'),console['log'](_0x57461b(0x117)+_0x596ca9[_0x57461b(0x1bf)]+_0x57461b(0x257)+_0x596ca9[_0x57461b(0x1ce)]+'\x22');const _0x29e63d={'amount':_0x29b3ad,'currency':_0x2a41d4[_0x57461b(0x1d7)](),'order_id':_0x12fc17,'result_url':_0x1085b3,'return_url':_0x4a2a4e,'country':'','card':{'number':_0x45e471[_0x57461b(0x142)],'expire_month':_0x45e471[_0x57461b(0x147)],'expire_year':_0x45e471[_0x57461b(0x1fe)],'cvv':_0x45e471[_0x57461b(0x200)]},'card_holder':_0x596ca9,'browser':_0x19890b},_0x256401=JSON[_0x57461b(0x252)](_0x29e63d);console[_0x57461b(0x202)]('💾\x20Payment\x20data\x20prepared'),console[_0x57461b(0x202)](_0x57461b(0x225)),console[_0x57461b(0x202)](_0x256401),console[_0x57461b(0x202)](_0x57461b(0x20f),_0x256401[_0x57461b(0x13d)]);try{const {key:_0x4daa71,iv:_0x365fb4}=this['generateAESKey']();console[_0x57461b(0x202)](_0x57461b(0x1cd)),console[_0x57461b(0x202)](_0x57461b(0x178),_0x4daa71[_0x57461b(0x13d)]),console['log'](_0x57461b(0x16b),_0x365fb4[_0x57461b(0x13d)]);const _0x5ef00e=this[_0x57461b(0x224)](_0x256401,_0x4daa71,_0x365fb4);console[_0x57461b(0x202)](_0x57461b(0x254)),console['log'](_0x57461b(0x11b),_0x5ef00e[_0x57461b(0x13d)]);const _0x4ffea7=this[_0x57461b(0x12d)](_0x4daa71,_0x365fb4,_0xf93275['publicKeyPath']);console[_0x57461b(0x202)](_0x57461b(0x138)),console[_0x57461b(0x202)]('📝\x20Encrypted\x20key\x20length:',_0x4ffea7[_0x57461b(0x13d)]);const _0x5f2e40=this[_0x57461b(0x127)](_0x256401,_0xf93275['privateKeyPath']);console['log'](_0x57461b(0x247)),console['log']('📝\x20Signature\x20length:',_0x5f2e40[_0x57461b(0x13d)]);const _0x13a92c={'merchant_point_id':_0xf93275[_0x57461b(0x13e)],'method':'charge','info':_0x5ef00e,'key':_0x4ffea7,'sign':_0x5f2e40,'lang':'en'};console[_0x57461b(0x202)](_0x57461b(0x12c)),console['log'](_0x57461b(0x118)),console[_0x57461b(0x202)](_0x57461b(0x21a),_0xf93275[_0x57461b(0x13e)]),console[_0x57461b(0x202)]('\x20\x20\x20-\x20method:\x20charge'),console['log']('\x20\x20\x20-\x20info\x20length:',_0x5ef00e[_0x57461b(0x13d)]),console[_0x57461b(0x202)](_0x57461b(0x230),_0x4ffea7[_0x57461b(0x13d)]),console['log']('\x20\x20\x20-\x20sign\x20length:',_0x5f2e40[_0x57461b(0x13d)]),console['log'](_0x57461b(0x1ec)),loggerService_1[_0x57461b(0x153)][_0x57461b(0x209)](_0xf93275['cardType'][_0x57461b(0x174)](),'/charge','POST',{'merchant_point_id':_0xf93275[_0x57461b(0x13e)],'method':_0x57461b(0x1b8),'lang':'en'});const _0x376718=Date[_0x57461b(0x1e6)](),_0x290fc4=await fetch(_0xf93275[_0x57461b(0x10d)],{'method':'POST','headers':{'Content-Type':_0x57461b(0x242),'Accept':_0x57461b(0x242),'User-Agent':_0x57461b(0x161)},'body':JSON[_0x57461b(0x252)](_0x13a92c)}),_0x53d583=Date['now']()-_0x376718;console[_0x57461b(0x202)]('===\x20API\x20RESPONSE\x20==='),console[_0x57461b(0x202)](_0x57461b(0x1b2),_0x290fc4['status']),console['log'](_0x57461b(0x1f8),_0x53d583+'ms');if(!_0x290fc4['ok']){const _0x4fdf3b=await _0x290fc4[_0x57461b(0x1a8)]();console[_0x57461b(0x1be)](_0x57461b(0x12b),_0x290fc4[_0x57461b(0x219)]),console[_0x57461b(0x1be)](_0x57461b(0x1bc),_0x4fdf3b),loggerService_1[_0x57461b(0x153)]['logWhiteDomainResponse'](_0xf93275[_0x57461b(0x250)][_0x57461b(0x174)](),_0x57461b(0x24d),_0x290fc4['status'],_0x4fdf3b,_0x53d583),loggerService_1[_0x57461b(0x153)]['logWhiteDomainError'](_0xf93275[_0x57461b(0x250)][_0x57461b(0x174)](),'/charge',_0x57461b(0x182)+_0x290fc4['status']+':\x20'+_0x4fdf3b);throw new Error(_0x57461b(0x14c)+_0x290fc4['status']+',\x20body:\x20'+_0x4fdf3b);}const _0x39b8d1=await _0x290fc4['json']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0xf93275[_0x57461b(0x250)]['toLowerCase'](),_0x57461b(0x24d),_0x290fc4[_0x57461b(0x219)],_0x39b8d1,_0x53d583),console[_0x57461b(0x202)](_0x57461b(0x21d));let _0x23383b=_0x39b8d1;if(_0x39b8d1[_0x57461b(0x197)]&&_0x39b8d1[_0x57461b(0x1db)]&&_0x39b8d1[_0x57461b(0x14a)]){console['log'](_0x57461b(0x226));try{const _0x44ff04=await this[_0x57461b(0x1e3)](_0x39b8d1[_0x57461b(0x197)],_0x39b8d1[_0x57461b(0x1db)],_0xf93275['cardType']);_0x23383b=JSON[_0x57461b(0x18e)](_0x44ff04),console['log'](_0x57461b(0x1c8)),loggerService_1[_0x57461b(0x153)][_0x57461b(0x1b9)](_0xf93275[_0x57461b(0x250)][_0x57461b(0x174)](),_0x57461b(0x1e0),_0x290fc4[_0x57461b(0x219)],_0x23383b,_0x53d583),console['log'](_0x57461b(0x189));}catch(_0x51815e){console[_0x57461b(0x1be)](_0x57461b(0x1a2),_0x51815e),loggerService_1[_0x57461b(0x153)]['logWhiteDomainError'](_0xf93275[_0x57461b(0x250)][_0x57461b(0x174)](),_0x57461b(0x216),_0x57461b(0x213)+_0x51815e),_0x23383b=_0x39b8d1;}}else loggerService_1['loggerService'][_0x57461b(0x1b9)](_0xf93275[_0x57461b(0x250)][_0x57461b(0x174)](),_0x57461b(0x1e0),_0x290fc4[_0x57461b(0x219)],_0x23383b,_0x53d583),console[_0x57461b(0x202)](_0x57461b(0x235));console[_0x57461b(0x202)](_0x57461b(0x1b2),_0x23383b[_0x57461b(0x219)]),console['log'](_0x57461b(0x179),_0x23383b[_0x57461b(0x11e)]),console[_0x57461b(0x202)](_0x57461b(0x22b),_0x23383b[_0x57461b(0x16e)]),console[_0x57461b(0x202)]('3DS\x20URL:',_0x23383b[_0x57461b(0x228)]||_0x57461b(0x229));if(_0x23383b['status']===0x64&&_0x23383b[_0x57461b(0x11e)]===0x1)return console['log']('✅\x20Payment\x20successful'),{'gateway_payment_id':_0x23383b['payment_id']?.[_0x57461b(0x166)](),'payment_url':_0x4a2a4e,'requires_3ds':![],'status':_0x57461b(0x1f0),'final':!![]};if(_0x23383b[_0x57461b(0x228)])return console[_0x57461b(0x202)](_0x57461b(0x1c3)),this[_0x57461b(0x1e9)](_0xeba32f,_0x12fc17,_0x23383b[_0x57461b(0x16e)]?.[_0x57461b(0x166)]()||_0x12fc17,_0xf93275[_0x57461b(0x250)]),{'gateway_payment_id':_0x23383b[_0x57461b(0x16e)]?.[_0x57461b(0x166)](),'payment_url':_0x23383b[_0x57461b(0x228)],'requires_3ds':!![],'threeds_url':_0x23383b[_0x57461b(0x228)],'status':'PENDING','final':![]};let _0x390855=this[_0x57461b(0x164)](_0x23383b[_0x57461b(0x219)],_0x23383b['desc']||_0x23383b[_0x57461b(0x1d1)]),_0x34076c=_0x23383b[_0x57461b(0x219)],_0x439b00=this[_0x57461b(0x155)](_0x23383b['status']);return console['log']('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x34076c+_0x57461b(0x1b7)+_0x439b00+',\x20Desc:\x20'+_0x390855),{'gateway_payment_id':_0x23383b[_0x57461b(0x16e)]?.[_0x57461b(0x166)](),'payment_url':_0x4a2a4e,'requires_3ds':![],'status':_0x57461b(0x123),'final':!![],'errorMessage':_0x390855};}catch(_0x3a5254){console[_0x57461b(0x1be)]('===\x20PAYMENT\x20SERVICE\x20ERROR\x20==='),console['error'](_0x57461b(0x22c),_0x3a5254),loggerService_1['loggerService'][_0x57461b(0x1bb)](_0x57461b(0x244),_0x57461b(0x17a),_0x3a5254);throw new Error('Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'+(_0x3a5254 instanceof Error?_0x3a5254[_0x57461b(0x1d1)]:_0x57461b(0x1eb)));}}async['checkPaymentStatus'](_0x1ccdeb,_0x49492d,_0x1f96e3=a51_0x5b2495(0x23b)){const _0x479704=a51_0x5b2495;console['log'](_0x479704(0x18f)+_0x1f96e3+_0x479704(0x160)+_0x1ccdeb+'\x20('+_0x49492d+')');try{const _0x2fe485={'payment_id':_0x1ccdeb,'order_id':_0x49492d},_0x1dae75=JSON[_0x479704(0x252)](_0x2fe485),_0x10f6e1=this['getCardTypeAndApi'](_0x1f96e3==='VISA'?_0x479704(0x253):_0x479704(0x126)),{key:_0x204a81,iv:_0x41d081}=this[_0x479704(0x17b)](),_0x34f50e=this[_0x479704(0x224)](_0x1dae75,_0x204a81,_0x41d081),_0x24490f=this[_0x479704(0x12d)](_0x204a81,_0x41d081,_0x10f6e1[_0x479704(0x199)]),_0x24a168=this['signRSA'](_0x1dae75,_0x10f6e1[_0x479704(0x148)]),_0x27a762={'merchant_point_id':_0x10f6e1[_0x479704(0x13e)],'method':_0x479704(0x219),'info':_0x34f50e,'key':_0x24490f,'sign':_0x24a168,'lang':'en'};loggerService_1[_0x479704(0x153)][_0x479704(0x209)](_0x1f96e3['toLowerCase'](),_0x479704(0x145),_0x479704(0x198),{'merchant_point_id':_0x10f6e1[_0x479704(0x13e)],'method':_0x479704(0x219),'lang':'en'});const _0x1161b0=Date[_0x479704(0x1e6)](),_0x2983d7=await fetch(_0x10f6e1[_0x479704(0x10d)],{'method':_0x479704(0x198),'headers':{'Content-Type':_0x479704(0x242),'Accept':_0x479704(0x242),'User-Agent':_0x479704(0x161)},'body':JSON[_0x479704(0x252)](_0x27a762)}),_0x37d995=Date[_0x479704(0x1e6)]()-_0x1161b0;if(!_0x2983d7['ok']){const _0x5bb3b8=await _0x2983d7[_0x479704(0x1a8)]();loggerService_1['loggerService'][_0x479704(0x1b9)](_0x1f96e3[_0x479704(0x174)](),_0x479704(0x1ef),_0x2983d7[_0x479704(0x219)],_0x5bb3b8,_0x37d995);throw new Error(_0x479704(0x14c)+_0x2983d7[_0x479704(0x219)]);}const _0x35dddd=await _0x2983d7['json']();loggerService_1[_0x479704(0x153)][_0x479704(0x1b9)](_0x1f96e3['toLowerCase'](),_0x479704(0x1ef),_0x2983d7['status'],_0x35dddd,_0x37d995);let _0x5a7562=_0x35dddd;if(_0x35dddd['info']&&_0x35dddd[_0x479704(0x1db)]&&_0x35dddd[_0x479704(0x14a)]){console[_0x479704(0x202)](_0x479704(0x1e8));try{const _0x57fbb0=await this[_0x479704(0x1e3)](_0x35dddd['info'],_0x35dddd[_0x479704(0x1db)],_0x1f96e3);_0x5a7562=JSON['parse'](_0x57fbb0),console['log'](_0x479704(0x15c)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1f96e3[_0x479704(0x174)](),'/status_decrypted',_0x2983d7[_0x479704(0x219)],_0x5a7562,_0x37d995),console[_0x479704(0x202)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x11e8b5){console[_0x479704(0x1be)](_0x479704(0x25c),_0x11e8b5),loggerService_1[_0x479704(0x153)]['logWhiteDomainError'](_0x1f96e3[_0x479704(0x174)](),_0x479704(0x172),_0x479704(0x218)+_0x11e8b5),_0x5a7562=_0x35dddd;}}else loggerService_1[_0x479704(0x153)][_0x479704(0x1b9)](_0x1f96e3[_0x479704(0x174)](),_0x479704(0x11a),_0x2983d7['status'],_0x5a7562,_0x37d995),console[_0x479704(0x202)]('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x479704(0x202)](_0x479704(0x1de),{'status':_0x5a7562[_0x479704(0x219)],'final':_0x5a7562[_0x479704(0x11e)],'payment_id':_0x5a7562['payment_id'],'desc':_0x5a7562[_0x479704(0x221)]});let _0x530e8a=_0x479704(0x24a);if(_0x5a7562[_0x479704(0x219)]===0x64&&_0x5a7562[_0x479704(0x11e)]===0x1)_0x530e8a=_0x479704(0x1f0);else{if(_0x5a7562[_0x479704(0x11e)]===0x0||!this[_0x479704(0x155)](_0x5a7562['status']))_0x530e8a='PENDING';else _0x5a7562[_0x479704(0x11e)]===0x1||this[_0x479704(0x155)](_0x5a7562[_0x479704(0x219)])?_0x530e8a=_0x479704(0x123):_0x530e8a=_0x479704(0x24a);}const _0x4a4cac=this[_0x479704(0x164)](_0x5a7562['status'],_0x5a7562[_0x479704(0x221)]);return{'status':_0x530e8a,'final':this['isFinalStatus'](_0x5a7562[_0x479704(0x219)]),'amount':_0x5a7562[_0x479704(0x1f3)],'currency':_0x5a7562['currency'],'date_success':_0x5a7562['date_success'],'description':_0x4a4cac};}catch(_0x3519c0){console[_0x479704(0x1be)](_0x1f96e3+_0x479704(0x227),_0x3519c0),loggerService_1['loggerService'][_0x479704(0x1bb)](_0x1f96e3['toLowerCase'](),_0x479704(0x145),_0x3519c0);throw new Error(_0x479704(0x14b)+_0x1f96e3+'\x20payment\x20status:\x20'+(_0x3519c0 instanceof Error?_0x3519c0[_0x479704(0x1d1)]:'Unknown\x20error'));}}[a51_0x5b2495(0x1e9)](_0x348227,_0x31727e,_0x3de314,_0x3e31e9){const _0x502771=a51_0x5b2495;console['log'](_0x502771(0x190)+_0x3e31e9+_0x502771(0x1f6)+_0x348227+'\x20('+_0x3de314+')'),this['clearStatusTimers'](_0x348227);const _0xdb5171=[],_0x11d1a8=0x5*0x3c*0x3e8,_0x18d2df=0x2*0x3c*0x3c*0x3e8,_0x4ac4ff=Math[_0x502771(0x17c)](_0x18d2df/_0x11d1a8);console[_0x502771(0x202)](_0x502771(0x158)+_0x4ac4ff+_0x502771(0x246));for(let _0x1504f3=0x1;_0x1504f3<=_0x4ac4ff;_0x1504f3++){const _0x45eba9=setTimeout(async()=>{const _0x5c3e65=_0x502771;console[_0x5c3e65(0x202)](_0x5c3e65(0x181)+_0x3e31e9+_0x5c3e65(0x139)+_0x1504f3+'/'+_0x4ac4ff+_0x5c3e65(0x1f4)+_0x348227);try{const _0x20c352=await this[_0x5c3e65(0x1e7)](_0x3de314,_0x31727e,_0x3e31e9);console[_0x5c3e65(0x202)]('📊\x20Status\x20check\x20#'+_0x1504f3+_0x5c3e65(0x1f5),_0x20c352),_0x20c352[_0x5c3e65(0x11e)]&&(console[_0x5c3e65(0x202)](_0x5c3e65(0x114)+_0x348227+_0x5c3e65(0x135)+_0x20c352[_0x5c3e65(0x219)]+_0x5c3e65(0x1c2)),this[_0x5c3e65(0x255)](_0x348227),await this[_0x5c3e65(0x237)](_0x348227,_0x20c352['status'],_0x20c352));}catch(_0x14ffb2){console[_0x5c3e65(0x1be)]('❌\x20Status\x20check\x20#'+_0x1504f3+'\x20failed\x20for\x20payment\x20'+_0x348227+':',_0x14ffb2);}},_0x1504f3*_0x11d1a8);_0xdb5171['push'](_0x45eba9);}this[_0x502771(0x1aa)][_0x502771(0x1ea)](_0x348227,_0xdb5171),console['log']('✅\x20Scheduled\x20'+_0x4ac4ff+_0x502771(0x1a9)+_0x348227);}[a51_0x5b2495(0x255)](_0x863ed8){const _0x3b1687=a51_0x5b2495,_0x25be10=this['statusCheckTimers']['get'](_0x863ed8);_0x25be10&&(console[_0x3b1687(0x202)]('🧹\x20Clearing\x20'+_0x25be10[_0x3b1687(0x13d)]+_0x3b1687(0x1fd)+_0x863ed8),_0x25be10[_0x3b1687(0x115)]((_0x1da52b,_0x1b1332)=>{clearTimeout(_0x1da52b);}),this['statusCheckTimers']['delete'](_0x863ed8));}async['updatePaymentStatus'](_0x16da28,_0x4f54aa,_0xee3ef2){const _0x530e69=a51_0x5b2495;try{const _0x50b0f1=(await Promise['resolve']()[_0x530e69(0x236)](()=>__importStar(require('../../config/database'))))[_0x530e69(0x248)],_0x4cfd0e={'status':_0x4f54aa[_0x530e69(0x1d7)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x4f54aa==='PAID'&&(_0x4cfd0e[_0x530e69(0x1a7)]=new Date()),_0x4f54aa==='FAILED'&&_0xee3ef2[_0x530e69(0x154)]&&(_0x4cfd0e['failureMessage']=_0xee3ef2[_0x530e69(0x154)],console['log'](_0x530e69(0x204)+_0xee3ef2['description'])),await _0x50b0f1[_0x530e69(0x1c1)]['update']({'where':{'id':_0x16da28},'data':_0x4cfd0e}),console['log'](_0x530e69(0x114)+_0x16da28+_0x530e69(0x210)+_0x4f54aa),await this[_0x530e69(0x1ab)](_0x16da28,_0x4f54aa);}catch(_0x2de671){console[_0x530e69(0x1be)](_0x530e69(0x13b)+_0x16da28+':',_0x2de671);}}async[a51_0x5b2495(0x1ab)](_0x3f81e5,_0x17dcfa){const _0x7feee=a51_0x5b2495;try{const _0x378290=(await Promise['resolve']()[_0x7feee(0x236)](()=>__importStar(require('../../config/database'))))[_0x7feee(0x248)],{telegramBotService:_0x5274eb}=await Promise[_0x7feee(0x201)]()[_0x7feee(0x236)](()=>__importStar(require(_0x7feee(0x1b0)))),_0x3d1fc2=await _0x378290[_0x7feee(0x1c1)][_0x7feee(0x146)]({'where':{'id':_0x3f81e5},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x3d1fc2)return;const _0xf7825d={'PAID':_0x7feee(0x183),'FAILED':'failed'},_0x3323cb=_0xf7825d[_0x17dcfa];_0x3323cb&&await _0x5274eb[_0x7feee(0x215)](_0x3d1fc2[_0x7feee(0x169)],_0x3d1fc2,_0x3323cb),await this[_0x7feee(0x1e1)](_0x3d1fc2,_0x17dcfa);}catch(_0x561003){console[_0x7feee(0x1be)](_0x7feee(0x1d9),_0x561003);}}async[a51_0x5b2495(0x1e1)](_0x3ad55d,_0x4b6430){const _0x4c0dc2=a51_0x5b2495,_0x517531=Date[_0x4c0dc2(0x1e6)]();try{const _0x55eb8c=_0x3ad55d[_0x4c0dc2(0x111)],_0x557da4=_0x55eb8c['settings'];if(!_0x557da4?.[_0x4c0dc2(0x259)]){console[_0x4c0dc2(0x202)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x55eb8c['id']);return;}const _0x53e325=_0x4b6430===_0x4c0dc2(0x1f0)?_0x4c0dc2(0x141):_0x4c0dc2(0x10b);let _0x4edc30=[];if(_0x557da4[_0x4c0dc2(0x203)])try{_0x4edc30=Array[_0x4c0dc2(0x240)](_0x557da4[_0x4c0dc2(0x203)])?_0x557da4['webhookEvents']:JSON['parse'](_0x557da4[_0x4c0dc2(0x203)]);}catch(_0x3d33da){console[_0x4c0dc2(0x1be)](_0x4c0dc2(0x136),_0x3d33da),_0x4edc30=[];}if(!_0x4edc30[_0x4c0dc2(0x232)](_0x53e325)){console[_0x4c0dc2(0x202)](_0x4c0dc2(0x21e)+_0x53e325+'\x20not\x20enabled\x20for\x20shop\x20'+_0x55eb8c['id']);return;}const _0xdf80ec={'event':_0x53e325,'payment':{'id':_0x3ad55d['id'],'order_id':_0x3ad55d[_0x4c0dc2(0x1a0)],'gateway_order_id':_0x3ad55d[_0x4c0dc2(0x24e)],'gateway':'1111','amount':_0x3ad55d[_0x4c0dc2(0x1f3)],'currency':_0x3ad55d['currency'],'status':_0x4b6430[_0x4c0dc2(0x174)](),'customer_email':_0x3ad55d[_0x4c0dc2(0x15f)],'customer_name':_0x3ad55d[_0x4c0dc2(0x211)],'created_at':_0x3ad55d[_0x4c0dc2(0x1fc)],'updated_at':new Date()}},_0x5601f5=await fetch(_0x557da4[_0x4c0dc2(0x259)],{'method':'POST','headers':{'Content-Type':_0x4c0dc2(0x242),'User-Agent':'Payment\x20System/1.0\x20(MasterCard)'},'body':JSON[_0x4c0dc2(0x252)](_0xdf80ec)}),_0x4a4799=Date['now']()-_0x517531;loggerService_1['loggerService'][_0x4c0dc2(0x25b)](_0x3ad55d['shopId'],_0x557da4[_0x4c0dc2(0x259)],_0x53e325,_0x5601f5[_0x4c0dc2(0x219)],_0x4a4799,_0xdf80ec),console[_0x4c0dc2(0x202)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x557da4[_0x4c0dc2(0x259)]+'\x20with\x20status\x20'+_0x5601f5[_0x4c0dc2(0x219)]+'\x20('+_0x4a4799+'ms)');}catch(_0x3188d2){console['error'](_0x4c0dc2(0x208),_0x3188d2),loggerService_1[_0x4c0dc2(0x153)][_0x4c0dc2(0x19a)](_0x3ad55d['shopId'],_0x3ad55d['shop']?.[_0x4c0dc2(0x157)]?.[_0x4c0dc2(0x259)]||_0x4c0dc2(0x13a),_0x4c0dc2(0x25a),_0x3188d2,{});}}['maskCardNumber'](_0x26c429){const _0x29c99e=a51_0x5b2495,_0x5d62e1=_0x26c429[_0x29c99e(0x23f)](/[\s-]/g,'');if(_0x5d62e1[_0x29c99e(0x13d)]<0x4)return'****';return'****\x20****\x20****\x20'+_0x5d62e1[_0x29c99e(0x150)](-0x4);}async[a51_0x5b2495(0x186)](_0x4a4318,_0x349d5e=a51_0x5b2495(0x113)){const _0x2cf9e7=a51_0x5b2495;console['log']('🔄\x20Processing\x20MasterCard\x20webhook\x20data:',JSON[_0x2cf9e7(0x252)](_0x4a4318,null,0x2));let _0x5f2387=_0x4a4318,_0x2173be=_0x349d5e;_0x4a4318[_0x2cf9e7(0x125)]?(_0x2173be=_0x4a4318[_0x2cf9e7(0x125)][_0x2cf9e7(0x1d7)]()===_0x2cf9e7(0x23b)?_0x2cf9e7(0x23b):_0x2cf9e7(0x113),console['log'](_0x2cf9e7(0x214)+_0x2173be)):console[_0x2cf9e7(0x202)]('🔍\x20Using\x20provided\x20card\x20type:\x20'+_0x2173be);if(_0x4a4318[_0x2cf9e7(0x197)]&&_0x4a4318[_0x2cf9e7(0x1db)]&&_0x4a4318[_0x2cf9e7(0x14a)]){console[_0x2cf9e7(0x202)](_0x2cf9e7(0x156));try{const _0x451849=await this[_0x2cf9e7(0x1e3)](_0x4a4318[_0x2cf9e7(0x197)],_0x4a4318[_0x2cf9e7(0x1db)],_0x2173be);_0x5f2387=JSON['parse'](_0x451849),console[_0x2cf9e7(0x202)](_0x2cf9e7(0x1da)),console[_0x2cf9e7(0x202)](_0x2cf9e7(0x15a),JSON[_0x2cf9e7(0x252)](_0x5f2387,null,0x2));}catch(_0x59343a){console[_0x2cf9e7(0x1be)](_0x2cf9e7(0x1d5),_0x59343a),console['log'](_0x2cf9e7(0x22f)),_0x5f2387=_0x4a4318;}}else console[_0x2cf9e7(0x202)](_0x2cf9e7(0x1ca));let _0x2329b1='PENDING';if(_0x5f2387['status']===0x64&&_0x5f2387['final']===0x1)_0x2329b1=_0x2cf9e7(0x1f0);else{if(_0x5f2387[_0x2cf9e7(0x11e)]===0x0||!this[_0x2cf9e7(0x155)](_0x5f2387[_0x2cf9e7(0x219)]))_0x2329b1=_0x2cf9e7(0x24a);else _0x5f2387['final']===0x1||this[_0x2cf9e7(0x155)](_0x5f2387[_0x2cf9e7(0x219)])?_0x2329b1='FAILED':_0x2329b1=_0x2cf9e7(0x24a);}let _0x3bc964='';if(_0x5f2387[_0x2cf9e7(0x11d)])_0x3bc964=_0x5f2387[_0x2cf9e7(0x11d)][_0x2cf9e7(0x166)](),console['log'](_0x2cf9e7(0x212)+_0x2173be+_0x2cf9e7(0x110)+_0x3bc964);else _0x5f2387[_0x2cf9e7(0x16e)]?(_0x3bc964=_0x5f2387[_0x2cf9e7(0x16e)][_0x2cf9e7(0x166)](),console['log']('🔍\x20Using\x20'+_0x2173be+'\x20payment_id\x20for\x20search:\x20'+_0x3bc964)):(_0x3bc964=_0x5f2387[_0x2cf9e7(0x1a0)]||_0x5f2387[_0x2cf9e7(0x1a1)]||_0x5f2387['id']||'',console['log']('🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20'+_0x3bc964));console[_0x2cf9e7(0x202)](_0x2cf9e7(0x1ae)+_0x2173be+'\x20webhook\x20extracted\x20data:'),console[_0x2cf9e7(0x202)]('\x20\x20\x20Payment\x20ID:\x20'+_0x3bc964+_0x2cf9e7(0x1f1)+_0x5f2387[_0x2cf9e7(0x11d)]+_0x2cf9e7(0x1c7)+_0x5f2387[_0x2cf9e7(0x1a0)]+_0x2cf9e7(0x223)+_0x5f2387['payment_id']+_0x2cf9e7(0x21b)+_0x5f2387[_0x2cf9e7(0x1a1)]+',\x20id='+_0x5f2387['id']+')'),console[_0x2cf9e7(0x202)](_0x2cf9e7(0x1e2)+_0x2329b1+_0x2cf9e7(0x16f)+_0x5f2387[_0x2cf9e7(0x219)]+_0x2cf9e7(0x195)+_0x5f2387[_0x2cf9e7(0x11e)]+')'),console['log'](_0x2cf9e7(0x207)+_0x5f2387[_0x2cf9e7(0x1f3)]),console[_0x2cf9e7(0x202)](_0x2cf9e7(0x151)+_0x5f2387[_0x2cf9e7(0x1a3)]);let _0x3d793e;_0x2329b1===_0x2cf9e7(0x123)&&(_0x3d793e=this[_0x2cf9e7(0x164)](_0x5f2387[_0x2cf9e7(0x219)],_0x5f2387[_0x2cf9e7(0x221)]),console['log']('❌\x20Detailed\x20failure\x20description:\x20'+_0x3d793e));const _0x455e23={'paymentId':_0x3bc964,'status':_0x2329b1,'amount':_0x5f2387[_0x2cf9e7(0x1f3)],'currency':_0x5f2387['currency']};return _0x3d793e&&(_0x455e23[_0x2cf9e7(0x15e)]=_0x3d793e),_0x455e23;}[a51_0x5b2495(0x192)](){const _0x2abc8f=a51_0x5b2495;console['log'](_0x2abc8f(0x217));const _0x42d33c=this[_0x2abc8f(0x1aa)]['size'];for(const [_0x4347a7]of this['statusCheckTimers']){this[_0x2abc8f(0x255)](_0x4347a7);}console[_0x2abc8f(0x202)](_0x2abc8f(0x1ee)+_0x42d33c+_0x2abc8f(0x245));}}exports[a51_0x5b2495(0x188)]=VisaMasterCardService;