'use strict';function a42_0x1c63(){const _0x303135=['-----END','🔐\x20Data\x20signed\x20with\x20RSA','payment_id','https://api2.trapay.uk/decrypt.php','now','shopId','application/json','none','11206jMmwtE','settings','decryptResponsePhp','webhookUrl','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','42675xEHqvc','createSign','decryptResponse','length','✅\x20Scheduled\x20','MasterCardService','get','key','1111','🔐\x20Private\x20key\x20path:','🔐\x20AES\x20key\x20length:','defineProperty','\x20status\x20timers\x20for\x20payment\x20','sign','merchantPointId',',\x20Desc:\x20','includes','📊\x20Status\x20check\x20#','Private\x20key\x20file\x20not\x20found:\x20','then','Return\x20URL:','****','PAID','../telegramBotService','description','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','🔐\x20AES\x20key\x20and\x20IV\x20generated','🔐\x20Public\x20key\x20path:','decryptAES','cwd','🔐\x20Data\x20encrypted\x20with\x20AES','PENDING','webhook_send','),\x20stopping\x20status\x20checks','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','\x20status\x20updated\x20to\x20','toLowerCase','POST','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','gatewayOrderId','updatePaymentStatus','Unknown\x20error','default','statusCheckTimers','184lPmlkb','currency','first_name','stopAllStatusChecks','30kPMSLF','Order\x20ID:','error','findUnique','/charge','create','status','✅\x20Payment\x20successful','desc','maskCardNumber','\x20MasterCard\x20status\x20check\x20timers','Failed\x20to\x20send\x20payment\x20notifications:','🛑\x20Stopped\x20','FAILED','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','/charge_raw','\x20\x20\x20-\x20sign\x20length:','resolve','43483ERuzHX','Card\x20Number:','scheduleStatusChecks','MasterCard:\x20','clearStatusTimers','privateKeyPath','isArray','logWhiteDomainError','❌\x20RSA\x20signing\x20failed:','logWhiteDomainResponse',',\x20body:\x20','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','💾\x20Payment\x20data\x20prepared','\x20result:','expire_month','amount','final','end','parse','🔐\x20AES\x20IV\x20length:','charge','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','stringify','MasterCard\x20webhook\x20sent\x20to\x20','❌\x20PHP\x20decryptor\x20request\x20failed:','Final:','2280hYyblj','/charge_decrypted','publicEncrypt','https://api.paydmeth.com/api','📝\x20Data\x20length:','Failed\x20to\x20send\x20MasterCard\x20webhook:','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','orderId','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','-----BEGIN','failed','processWebhook','text','Error\x20details:','__setModuleDefault','4490CheFYl','HTTP\x20Status:','❌\x20Status\x20check\x20#','signRSA','generateAESKey',',\x20Final:\x20','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','customerName','update','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','message','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','payment','📝\x20Data\x20to\x20sign\x20length:','🔐\x20Private\x20key\x20length:\x20','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','shop','Response\x20Time:','✅\x20Payment\x20','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','aes-256-ctr','/status_decrypt','toString','publicKeyPath','apiUrl','sendShopWebhook','⏰\x20Will\x20check\x20status\x20','Status:','encryptRSA','937752mftQFq','3DS\x20URL:','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','TesSoft\x20Payment\x20System/1.0','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','checkPaymentStatus','system','HTTP\x20error!\x20status:\x20','base64','Failed\x20to\x20decrypt\x20response','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','HTTP\x20','crypto','keys','from','number','📝\x20Signature\x20length:','Card\x20Holder:','readFileSync','/status_decrypted','createCipheriv','RSA_PKCS1_PADDING','replace','logShopWebhookSent','utf8','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','slice','\x20\x20\x20-\x20lang:\x20en','configurable','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20\x20\x20-\x20method:\x20charge','Error\x20parsing\x20webhook\x20events:','customerEmail','randomBytes','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','../loggerService','3ds_url','call','loggerService','\x20not\x20enabled\x20for\x20shop\x20','logWhiteDomainRequest','createDecipheriv','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','private.pem','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','3303nSgEme','19144RgGhgv','📝\x20Encrypted\x20key\x20length:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','📝\x20Encrypted\x20data\x20length:','size','privateDecrypt','\x20\x20\x20-\x20key\x20length:','sendPaymentNotifications','logShopWebhookError','hasOwnProperty','📊\x20Status\x20check\x20result:','35hvFuBz','/status','\x20with\x20status\x20','writable','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','json','last_name','\x20characters','🧹\x20Clearing\x20','createdAt','\x20for\x20payment\x20','existsSync','delete','\x20\x20\x20-\x20info\x20length:','🔐\x20RSA\x20signing\x20successful','Status\x20decryption\x20failed:\x20','1188qlQfCs','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','psp_public.pem','log','/charge_decrypt','✅\x20Status\x20response\x20decrypted\x20successfully','Payment\x20ID:','mastercard','❌\x20RSA\x20encryption\x20failed:','webhookEvents','Amount:','info','trim','../../config/database','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','ms)','__esModule','\x20failed\x20for\x20payment\x20','getOwnPropertyDescriptor','Decryption\x20failed:\x20','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','Webhook\x20event\x20'];a42_0x1c63=function(){return _0x303135;};return a42_0x1c63();}const a42_0x1c989a=a42_0x3857;function a42_0x3857(_0x400af2,_0x781ae4){const _0x1c63ca=a42_0x1c63();return a42_0x3857=function(_0x385769,_0x299816){_0x385769=_0x385769-0x94;let _0x1b1fa2=_0x1c63ca[_0x385769];return _0x1b1fa2;},a42_0x3857(_0x400af2,_0x781ae4);}(function(_0x2c93a1,_0x5bcc11){const _0x505ae5=a42_0x3857,_0xd20456=_0x2c93a1();while(!![]){try{const _0x3bc0b7=-parseInt(_0x505ae5(0xa3))/0x1*(parseInt(_0x505ae5(0xd8))/0x2)+parseInt(_0x505ae5(0xa8))/0x3+-parseInt(_0x505ae5(0xd4))/0x4*(parseInt(_0x505ae5(0x114))/0x5)+-parseInt(_0x505ae5(0x131))/0x6+-parseInt(_0x505ae5(0x16b))/0x7*(parseInt(_0x505ae5(0x160))/0x8)+parseInt(_0x505ae5(0x15f))/0x9*(parseInt(_0x505ae5(0x104))/0xa)+-parseInt(_0x505ae5(0xea))/0xb*(-parseInt(_0x505ae5(0x17b))/0xc);if(_0x3bc0b7===_0x5bcc11)break;else _0xd20456['push'](_0xd20456['shift']());}catch(_0x378f2f){_0xd20456['push'](_0xd20456['shift']());}}}(a42_0x1c63,0x1b3e9));var __createBinding=this&&this['__createBinding']||(Object[a42_0x1c989a(0xdd)]?function(_0x5024d3,_0x131ee2,_0x72eebf,_0x3cde56){const _0x5c099e=a42_0x1c989a;if(_0x3cde56===undefined)_0x3cde56=_0x72eebf;var _0x28c319=Object[_0x5c099e(0x97)](_0x131ee2,_0x72eebf);(!_0x28c319||(_0x5c099e(0xae)in _0x28c319?!_0x131ee2[_0x5c099e(0x95)]:_0x28c319[_0x5c099e(0x16e)]||_0x28c319[_0x5c099e(0x14e)]))&&(_0x28c319={'enumerable':!![],'get':function(){return _0x131ee2[_0x72eebf];}}),Object[_0x5c099e(0xb3)](_0x5024d3,_0x3cde56,_0x28c319);}:function(_0x4c4774,_0x30f88e,_0x3ca79e,_0x3a3f48){if(_0x3a3f48===undefined)_0x3a3f48=_0x3ca79e;_0x4c4774[_0x3a3f48]=_0x30f88e[_0x3ca79e];}),__setModuleDefault=this&&this[a42_0x1c989a(0x113)]||(Object['create']?function(_0x56d2ba,_0x499d6a){const _0x97e47b=a42_0x1c989a;Object[_0x97e47b(0xb3)](_0x56d2ba,_0x97e47b(0xd2),{'enumerable':!![],'value':_0x499d6a});}:function(_0x4e1a97,_0x2d5e0a){const _0x1ebf17=a42_0x1c989a;_0x4e1a97[_0x1ebf17(0xd2)]=_0x2d5e0a;}),__importStar=this&&this['__importStar']||(function(){var _0x21c18e=function(_0x3d9d5a){return _0x21c18e=Object['getOwnPropertyNames']||function(_0x1c730b){const _0x35ad19=a42_0x3857;var _0x25f9d8=[];for(var _0x46e6bf in _0x1c730b)if(Object['prototype'][_0x35ad19(0x169)][_0x35ad19(0x157)](_0x1c730b,_0x46e6bf))_0x25f9d8[_0x25f9d8[_0x35ad19(0xab)]]=_0x46e6bf;return _0x25f9d8;},_0x21c18e(_0x3d9d5a);};return function(_0x35fccc){const _0x2d3a48=a42_0x3857;if(_0x35fccc&&_0x35fccc[_0x2d3a48(0x95)])return _0x35fccc;var _0x545b70={};if(_0x35fccc!=null){for(var _0x441ef7=_0x21c18e(_0x35fccc),_0x1ddb85=0x0;_0x1ddb85<_0x441ef7[_0x2d3a48(0xab)];_0x1ddb85++)if(_0x441ef7[_0x1ddb85]!==_0x2d3a48(0xd2))__createBinding(_0x545b70,_0x35fccc,_0x441ef7[_0x1ddb85]);}return __setModuleDefault(_0x545b70,_0x35fccc),_0x545b70;};}()),__importDefault=this&&this['__importDefault']||function(_0x5e9660){return _0x5e9660&&_0x5e9660['__esModule']?_0x5e9660:{'default':_0x5e9660};};Object[a42_0x1c989a(0xb3)](exports,'__esModule',{'value':!![]}),exports['MasterCardService']=void 0x0;const crypto_1=__importDefault(require(a42_0x1c989a(0x13d))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a42_0x1c989a(0x155));class MasterCardService{constructor(){const _0x38faa3=a42_0x1c989a;this[_0x38faa3(0xd3)]=new Map(),this[_0x38faa3(0x12c)]=_0x38faa3(0x107),this['merchantPointId']=0x67c,this[_0x38faa3(0xef)]=path_1['default']['join'](process[_0x38faa3(0xc5)](),_0x38faa3(0x13e),_0x38faa3(0x15d)),this[_0x38faa3(0x12b)]=path_1[_0x38faa3(0xd2)]['join'](process['cwd'](),_0x38faa3(0x13e),_0x38faa3(0x17d)),console[_0x38faa3(0x17e)]('💳\x20MasterCard\x20service\x20initialized'),console['log'](_0x38faa3(0xb1),this[_0x38faa3(0xef)]),console[_0x38faa3(0x17e)](_0x38faa3(0xc3),this[_0x38faa3(0x12b)]),this['validateKeyFiles']();}['validateKeyFiles'](){const _0x4f7215=a42_0x1c989a;try{if(!fs_1[_0x4f7215(0xd2)][_0x4f7215(0x176)](this[_0x4f7215(0xef)]))throw new Error(_0x4f7215(0xba)+this[_0x4f7215(0xef)]);if(!fs_1[_0x4f7215(0xd2)]['existsSync'](this['publicKeyPath']))throw new Error('Public\x20key\x20file\x20not\x20found:\x20'+this[_0x4f7215(0x12b)]);const _0x112214=fs_1[_0x4f7215(0xd2)][_0x4f7215(0x143)](this[_0x4f7215(0xef)],_0x4f7215(0x149))[_0x4f7215(0x187)](),_0x448d5b=fs_1['default'][_0x4f7215(0x143)](this[_0x4f7215(0x12b)],'utf8')[_0x4f7215(0x187)]();if(!_0x112214[_0x4f7215(0xb8)]('-----BEGIN')||!_0x112214['includes']('-----END'))throw new Error(_0x4f7215(0x16f));if(!_0x448d5b[_0x4f7215(0xb8)](_0x4f7215(0x10e))||!_0x448d5b['includes'](_0x4f7215(0x9b)))throw new Error(_0x4f7215(0x10d));console[_0x4f7215(0x17e)](_0x4f7215(0x154)),console[_0x4f7215(0x17e)](_0x4f7215(0x122)+_0x112214[_0x4f7215(0xab)]+_0x4f7215(0x172)),console['log']('🔐\x20Public\x20key\x20length:\x20'+_0x448d5b[_0x4f7215(0xab)]+'\x20characters');}catch(_0x246b9f){console['error']('❌\x20MasterCard\x20key\x20validation\x20failed:',_0x246b9f);throw _0x246b9f;}}[a42_0x1c989a(0x118)](){const _0x29d168=a42_0x1c989a,_0x5e62b0=crypto_1['default'][_0x29d168(0x153)](0x20),_0x2e0d37=crypto_1[_0x29d168(0xd2)][_0x29d168(0x153)](0x10);return{'key':_0x5e62b0,'iv':_0x2e0d37};}['encryptAES'](_0x5d3d99,_0x49b14e,_0x5cf335){const _0x10baba=a42_0x1c989a,_0x239080=crypto_1[_0x10baba(0xd2)][_0x10baba(0x145)](_0x10baba(0x128),_0x49b14e,_0x5cf335);let _0x1dd204=_0x239080['update'](_0x5d3d99,'utf8',_0x10baba(0x139));return _0x1dd204+=_0x239080[_0x10baba(0xfa)]('base64'),_0x1dd204;}[a42_0x1c989a(0x130)](_0x1c1902,_0x55f560){const _0x5c21fa=a42_0x1c989a;try{const _0x3e1aff=fs_1['default']['readFileSync'](this[_0x5c21fa(0x12b)],'utf8')['trim'](),_0x33b406={'iv':_0x55f560['toString'](_0x5c21fa(0x139)),'key':_0x1c1902[_0x5c21fa(0x12a)]('base64')},_0x4f9084=JSON['stringify'](_0x33b406);console[_0x5c21fa(0x17e)](_0x5c21fa(0x15e),_0x4f9084[_0x5c21fa(0xab)]);const _0x53faa4=crypto_1['default'][_0x5c21fa(0x106)]({'key':_0x3e1aff,'padding':crypto_1[_0x5c21fa(0xd2)]['constants'][_0x5c21fa(0x146)]},Buffer[_0x5c21fa(0x13f)](_0x4f9084));return console['log'](_0x5c21fa(0xa7),_0x53faa4[_0x5c21fa(0xab)]),_0x53faa4['toString'](_0x5c21fa(0x139));}catch(_0x56a3f9){console[_0x5c21fa(0xda)](_0x5c21fa(0x183),_0x56a3f9);throw new Error(_0x5c21fa(0x14a));}}[a42_0x1c989a(0x117)](_0x2b6728){const _0x5c9a28=a42_0x1c989a;try{const _0x2c16fb=fs_1[_0x5c9a28(0xd2)][_0x5c9a28(0x143)](this[_0x5c9a28(0xef)],_0x5c9a28(0x149))[_0x5c9a28(0x187)](),_0x3a607f=crypto_1[_0x5c9a28(0xd2)][_0x5c9a28(0xa9)]('SHA256');_0x3a607f[_0x5c9a28(0x11c)](_0x2b6728),_0x3a607f[_0x5c9a28(0xfb)]();const _0x14fbac=_0x3a607f[_0x5c9a28(0xb5)](_0x2c16fb,_0x5c9a28(0x139));return console[_0x5c9a28(0x17e)](_0x5c9a28(0x179)),console['log'](_0x5c9a28(0x121),_0x2b6728[_0x5c9a28(0xab)]),console[_0x5c9a28(0x17e)](_0x5c9a28(0x141),_0x14fbac[_0x5c9a28(0xab)]),_0x14fbac;}catch(_0x3815dc){console['error'](_0x5c9a28(0xf2),_0x3815dc),console[_0x5c9a28(0xda)]('❌\x20Data\x20being\x20signed:',_0x2b6728['substring'](0x0,0xc8)+'...');throw new Error(_0x5c9a28(0x10a));}}[a42_0x1c989a(0xc4)](_0x5ef411,_0x232afd,_0x5d4f1b){const _0x432bfa=a42_0x1c989a,_0x26c6a8=crypto_1[_0x432bfa(0xd2)][_0x432bfa(0x15b)]('aes-256-ctr',_0x232afd,_0x5d4f1b);let _0x2036fc=_0x26c6a8[_0x432bfa(0x11c)](_0x5ef411,_0x432bfa(0x139),'utf8');return _0x2036fc+=_0x26c6a8[_0x432bfa(0xfa)]('utf8'),_0x2036fc;}async[a42_0x1c989a(0xa5)](_0x3f1178,_0x13f741){const _0x2aa4ba=a42_0x1c989a;try{const _0x296b18=await fetch(_0x2aa4ba(0x9e),{'method':_0x2aa4ba(0xcd),'headers':{'Content-Type':_0x2aa4ba(0xa1)},'body':JSON[_0x2aa4ba(0x100)]({'info':_0x3f1178,'key':_0x13f741})});if(!_0x296b18['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x296b18['text']();}catch(_0x371d94){console[_0x2aa4ba(0xda)](_0x2aa4ba(0x102),_0x371d94);throw new Error(_0x2aa4ba(0xe6));}}[a42_0x1c989a(0xaa)](_0x41734c,_0x2ad423){const _0x375b0d=a42_0x1c989a;try{const _0x1e25b6=fs_1[_0x375b0d(0xd2)][_0x375b0d(0x143)](this[_0x375b0d(0xef)],_0x375b0d(0x149))[_0x375b0d(0x187)](),_0x502af6=crypto_1[_0x375b0d(0xd2)][_0x375b0d(0x165)](_0x1e25b6,Buffer[_0x375b0d(0x13f)](_0x2ad423,'base64')),_0x4d90f9=JSON[_0x375b0d(0xfc)](_0x502af6[_0x375b0d(0x12a)]()),_0x4367f5=Buffer[_0x375b0d(0x13f)](_0x4d90f9[_0x375b0d(0xaf)],_0x375b0d(0x139)),_0x20e49f=Buffer[_0x375b0d(0x13f)](_0x4d90f9['iv'],_0x375b0d(0x139));return this[_0x375b0d(0xc4)](_0x41734c,_0x4367f5,_0x20e49f);}catch(_0x563556){throw new Error(_0x375b0d(0x13a));}}async['processCardPayment'](_0x5d049f){const _0x124697=a42_0x1c989a,{paymentId:_0x52fffa,orderId:_0x3d5379,amount:_0x160393,currency:_0x5e58ca,cardData:_0xca61d5,resultUrl:_0x2268a4,returnUrl:_0xa36045,cardHolder:_0x2dffed,browser:_0x1e67b0}=_0x5d049f;console[_0x124697(0x17e)](_0x124697(0x133)),console[_0x124697(0x17e)](_0x124697(0x181),_0x52fffa),console[_0x124697(0x17e)](_0x124697(0xd9),_0x3d5379),console[_0x124697(0x17e)](_0x124697(0x185),_0x160393,_0x5e58ca),console[_0x124697(0x17e)](_0x124697(0xeb),this['maskCardNumber'](_0xca61d5[_0x124697(0x140)])),console[_0x124697(0x17e)](_0x124697(0x142),_0x2dffed[_0x124697(0xd6)]+'\x20'+_0x2dffed[_0x124697(0x171)]),console['log'](_0x124697(0xbc),_0xa36045),console[_0x124697(0x17e)]('Result\x20URL:',_0x2268a4);const _0x3fbe38={'amount':_0x160393,'currency':_0x5e58ca['toUpperCase'](),'order_id':_0x3d5379,'result_url':_0x2268a4,'return_url':_0xa36045,'country':'','card':{'number':_0xca61d5[_0x124697(0x140)],'expire_month':_0xca61d5[_0x124697(0xf8)],'expire_year':_0xca61d5['expire_year'],'cvv':_0xca61d5['cvv']},'card_holder':_0x2dffed,'browser':_0x1e67b0},_0x5d383b=JSON[_0x124697(0x100)](_0x3fbe38);console[_0x124697(0x17e)](_0x124697(0xf6)),console[_0x124697(0x17e)]('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console[_0x124697(0x17e)](_0x5d383b),console[_0x124697(0x17e)](_0x124697(0x108),_0x5d383b[_0x124697(0xab)]);try{const {key:_0x510148,iv:_0x15e7dc}=this[_0x124697(0x118)]();console[_0x124697(0x17e)](_0x124697(0xc2)),console[_0x124697(0x17e)](_0x124697(0xb2),_0x510148[_0x124697(0xab)]),console['log'](_0x124697(0xfd),_0x15e7dc['length']);const _0x3589a8=this['encryptAES'](_0x5d383b,_0x510148,_0x15e7dc);console['log'](_0x124697(0xc6)),console[_0x124697(0x17e)](_0x124697(0x163),_0x3589a8[_0x124697(0xab)]);const _0x3f6331=this[_0x124697(0x130)](_0x510148,_0x15e7dc);console[_0x124697(0x17e)](_0x124697(0x127)),console[_0x124697(0x17e)](_0x124697(0x161),_0x3f6331[_0x124697(0xab)]);const _0x32ff57=this[_0x124697(0x117)](_0x5d383b);console[_0x124697(0x17e)](_0x124697(0x9c)),console[_0x124697(0x17e)](_0x124697(0x141),_0x32ff57['length']);const _0x33668b={'merchant_point_id':this['merchantPointId'],'method':_0x124697(0xfe),'info':_0x3589a8,'key':_0x3f6331,'sign':_0x32ff57,'lang':'en'};console[_0x124697(0x17e)](_0x124697(0x15c)),console[_0x124697(0x17e)]('📝\x20Final\x20request\x20structure:'),console[_0x124697(0x17e)]('\x20\x20\x20-\x20merchant_point_id:',this[_0x124697(0xb6)]),console[_0x124697(0x17e)](_0x124697(0x150)),console[_0x124697(0x17e)](_0x124697(0x178),_0x3589a8[_0x124697(0xab)]),console[_0x124697(0x17e)](_0x124697(0x166),_0x3f6331[_0x124697(0xab)]),console[_0x124697(0x17e)](_0x124697(0xe8),_0x32ff57[_0x124697(0xab)]),console[_0x124697(0x17e)](_0x124697(0x14d)),loggerService_1[_0x124697(0x158)][_0x124697(0x15a)](_0x124697(0x182),_0x124697(0xdc),_0x124697(0xcd),{'merchant_point_id':this[_0x124697(0xb6)],'method':_0x124697(0xfe),'lang':'en'});const _0x7b6a24=Date[_0x124697(0x9f)](),_0x39862a=await fetch(this[_0x124697(0x12c)],{'method':_0x124697(0xcd),'headers':{'Content-Type':_0x124697(0xa1),'Accept':'application/json','User-Agent':_0x124697(0x134)},'body':JSON[_0x124697(0x100)](_0x33668b)}),_0x3eade1=Date[_0x124697(0x9f)]()-_0x7b6a24;console[_0x124697(0x17e)](_0x124697(0x11f)),console[_0x124697(0x17e)]('Status:',_0x39862a[_0x124697(0xde)]),console[_0x124697(0x17e)](_0x124697(0x125),_0x3eade1+'ms');if(!_0x39862a['ok']){const _0x153671=await _0x39862a[_0x124697(0x111)]();console[_0x124697(0xda)](_0x124697(0x115),_0x39862a['status']),console[_0x124697(0xda)]('Response\x20Body:',_0x153671),loggerService_1[_0x124697(0x158)][_0x124697(0xf3)](_0x124697(0x182),_0x124697(0xe7),_0x39862a[_0x124697(0xde)],_0x153671,_0x3eade1),loggerService_1[_0x124697(0x158)][_0x124697(0xf1)]('mastercard',_0x124697(0xdc),_0x124697(0x13c)+_0x39862a['status']+':\x20'+_0x153671);throw new Error(_0x124697(0x138)+_0x39862a['status']+_0x124697(0xf4)+_0x153671);}const _0x694551=await _0x39862a[_0x124697(0x170)]();loggerService_1[_0x124697(0x158)][_0x124697(0xf3)](_0x124697(0x182),_0x124697(0xe7),_0x39862a[_0x124697(0xde)],_0x694551,_0x3eade1),console[_0x124697(0x17e)]('===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===');let _0x24faa1=_0x694551;if(_0x694551[_0x124697(0x186)]&&_0x694551[_0x124697(0xaf)]&&_0x694551['sign']){console[_0x124697(0x17e)](_0x124697(0x10c));try{const _0x475fc6=await this['decryptResponsePhp'](_0x694551[_0x124697(0x186)],_0x694551[_0x124697(0xaf)]);_0x24faa1=JSON[_0x124697(0xfc)](_0x475fc6),console[_0x124697(0x17e)](_0x124697(0x135)),loggerService_1[_0x124697(0x158)][_0x124697(0xf3)](_0x124697(0x182),_0x124697(0x105),_0x39862a['status'],_0x24faa1,_0x3eade1),console['log'](_0x124697(0x14b));}catch(_0x5ae3f3){console[_0x124697(0xda)](_0x124697(0xff),_0x5ae3f3),loggerService_1[_0x124697(0x158)][_0x124697(0xf1)](_0x124697(0x182),_0x124697(0x17f),_0x124697(0x98)+_0x5ae3f3),_0x24faa1=_0x694551;}}else loggerService_1[_0x124697(0x158)]['logWhiteDomainResponse']('mastercard',_0x124697(0x105),_0x39862a[_0x124697(0xde)],_0x24faa1,_0x3eade1),console[_0x124697(0x17e)](_0x124697(0xce));console[_0x124697(0x17e)](_0x124697(0x12f),_0x24faa1[_0x124697(0xde)]),console[_0x124697(0x17e)](_0x124697(0x103),_0x24faa1['final']),console['log'](_0x124697(0x181),_0x24faa1['payment_id']),console[_0x124697(0x17e)](_0x124697(0x132),_0x24faa1[_0x124697(0x156)]||_0x124697(0xa2));if(_0x24faa1[_0x124697(0xde)]===0x64&&_0x24faa1['final']===0x1)return console[_0x124697(0x17e)](_0x124697(0xdf)),{'gateway_payment_id':_0x24faa1['payment_id']?.[_0x124697(0x12a)](),'payment_url':_0xa36045,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x24faa1[_0x124697(0x156)])return console[_0x124697(0x17e)]('🔐\x203DS\x20verification\x20required'),this['scheduleStatusChecks'](_0x52fffa,_0x3d5379,_0x24faa1['payment_id']?.['toString']()||_0x3d5379),{'gateway_payment_id':_0x24faa1['payment_id']?.[_0x124697(0x12a)](),'payment_url':_0x24faa1['3ds_url'],'requires_3ds':!![],'threeds_url':_0x24faa1[_0x124697(0x156)],'status':_0x124697(0xc7),'final':![]};let _0x34d688=_0x24faa1[_0x124697(0xe0)]||_0x24faa1[_0x124697(0x11e)]||_0x124697(0xd1),_0xbd1e29=_0x24faa1[_0x124697(0xde)],_0x295609=_0x24faa1['final'];return console[_0x124697(0x17e)](_0x124697(0x123)+_0xbd1e29+_0x124697(0x119)+_0x295609+_0x124697(0xb7)+_0x34d688),{'gateway_payment_id':_0x24faa1[_0x124697(0x9d)]?.[_0x124697(0x12a)](),'payment_url':_0xa36045,'requires_3ds':![],'status':_0x124697(0xe5),'final':!![]};}catch(_0xb62b9d){console[_0x124697(0xda)]('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console['error'](_0x124697(0x112),_0xb62b9d),loggerService_1['loggerService'][_0x124697(0xf1)](_0x124697(0x182),_0x124697(0xdc),_0xb62b9d);throw new Error(_0x124697(0x11d)+(_0xb62b9d instanceof Error?_0xb62b9d['message']:_0x124697(0xd1)));}}async[a42_0x1c989a(0x136)](_0x5f32ae,_0x182400){const _0xf610ad=a42_0x1c989a;console[_0xf610ad(0x17e)](_0xf610ad(0x189)+_0x5f32ae+'\x20('+_0x182400+')');try{const _0x240d07={'payment_id':_0x5f32ae,'order_id':_0x182400},_0x589b6e=JSON[_0xf610ad(0x100)](_0x240d07),{key:_0x314532,iv:_0x2f12e1}=this[_0xf610ad(0x118)](),_0x2fcdec=this['encryptAES'](_0x589b6e,_0x314532,_0x2f12e1),_0xa90836=this[_0xf610ad(0x130)](_0x314532,_0x2f12e1),_0x4ab949=this['signRSA'](_0x589b6e),_0x45d6b7={'merchant_point_id':this[_0xf610ad(0xb6)],'method':_0xf610ad(0xde),'info':_0x2fcdec,'key':_0xa90836,'sign':_0x4ab949,'lang':'en'};loggerService_1['loggerService'][_0xf610ad(0x15a)](_0xf610ad(0x182),'/status',_0xf610ad(0xcd),{'merchant_point_id':this[_0xf610ad(0xb6)],'method':_0xf610ad(0xde),'lang':'en'});const _0x59d0bd=Date[_0xf610ad(0x9f)](),_0x51f6f3=await fetch(this[_0xf610ad(0x12c)],{'method':_0xf610ad(0xcd),'headers':{'Content-Type':_0xf610ad(0xa1),'Accept':_0xf610ad(0xa1),'User-Agent':_0xf610ad(0x134)},'body':JSON[_0xf610ad(0x100)](_0x45d6b7)}),_0x5aac69=Date[_0xf610ad(0x9f)]()-_0x59d0bd;if(!_0x51f6f3['ok']){const _0x552277=await _0x51f6f3[_0xf610ad(0x111)]();loggerService_1[_0xf610ad(0x158)][_0xf610ad(0xf3)](_0xf610ad(0x182),'/status_raw',_0x51f6f3[_0xf610ad(0xde)],_0x552277,_0x5aac69);throw new Error(_0xf610ad(0x138)+_0x51f6f3[_0xf610ad(0xde)]);}const _0x4206b6=await _0x51f6f3[_0xf610ad(0x170)]();loggerService_1[_0xf610ad(0x158)][_0xf610ad(0xf3)](_0xf610ad(0x182),'/status_raw',_0x51f6f3['status'],_0x4206b6,_0x5aac69);let _0x6845a2=_0x4206b6;if(_0x4206b6[_0xf610ad(0x186)]&&_0x4206b6[_0xf610ad(0xaf)]&&_0x4206b6[_0xf610ad(0xb5)]){console[_0xf610ad(0x17e)](_0xf610ad(0xc1));try{const _0x17ab5e=this[_0xf610ad(0xaa)](_0x4206b6[_0xf610ad(0x186)],_0x4206b6[_0xf610ad(0xaf)]);_0x6845a2=JSON[_0xf610ad(0xfc)](_0x17ab5e),console[_0xf610ad(0x17e)](_0xf610ad(0x180)),loggerService_1[_0xf610ad(0x158)][_0xf610ad(0xf3)]('mastercard',_0xf610ad(0x144),_0x51f6f3['status'],_0x6845a2,_0x5aac69),console[_0xf610ad(0x17e)](_0xf610ad(0xf5));}catch(_0x2bfc9a){console[_0xf610ad(0xda)](_0xf610ad(0x17c),_0x2bfc9a),loggerService_1[_0xf610ad(0x158)][_0xf610ad(0xf1)](_0xf610ad(0x182),_0xf610ad(0x129),_0xf610ad(0x17a)+_0x2bfc9a),_0x6845a2=_0x4206b6;}}else loggerService_1[_0xf610ad(0x158)]['logWhiteDomainResponse'](_0xf610ad(0x182),_0xf610ad(0x144),_0x51f6f3[_0xf610ad(0xde)],_0x6845a2,_0x5aac69),console['log']('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console['log'](_0xf610ad(0x16a),{'status':_0x6845a2[_0xf610ad(0xde)],'final':_0x6845a2[_0xf610ad(0xfa)],'payment_id':_0x6845a2[_0xf610ad(0x9d)],'desc':_0x6845a2['desc']});let _0x56aa0e=_0xf610ad(0xc7);if(_0x6845a2[_0xf610ad(0xde)]===0x1&&_0x6845a2[_0xf610ad(0xfa)]===0x1)_0x56aa0e=_0xf610ad(0xbe);else _0x6845a2[_0xf610ad(0xde)]===0x0&&_0x6845a2['final']===0x0?_0x56aa0e=_0xf610ad(0xc7):_0x56aa0e=_0xf610ad(0xe5);return{'status':_0x56aa0e,'final':_0x6845a2['final']===0x1,'amount':_0x6845a2['amount'],'currency':_0x6845a2['currency'],'date_success':_0x6845a2['date_success'],'description':_0x6845a2[_0xf610ad(0xe0)]};}catch(_0x51e22d){console[_0xf610ad(0xda)]('MasterCard\x20status\x20check\x20error:',_0x51e22d),loggerService_1[_0xf610ad(0x158)][_0xf610ad(0xf1)]('mastercard',_0xf610ad(0x16c),_0x51e22d);throw new Error(_0xf610ad(0x11a)+(_0x51e22d instanceof Error?_0x51e22d[_0xf610ad(0x11e)]:_0xf610ad(0xd1)));}}[a42_0x1c989a(0xec)](_0x1ebfe3,_0x36c519,_0x80ce71){const _0x20a885=a42_0x1c989a;console[_0x20a885(0x17e)](_0x20a885(0xca)+_0x1ebfe3+'\x20('+_0x80ce71+')'),this[_0x20a885(0xee)](_0x1ebfe3);const _0xb52aec=[],_0x55162a=0x5*0x3c*0x3e8,_0x136388=0x2*0x3c*0x3c*0x3e8,_0x1e0e97=Math['floor'](_0x136388/_0x55162a);console[_0x20a885(0x17e)](_0x20a885(0x12e)+_0x1e0e97+_0x20a885(0x99));for(let _0x3d2456=0x1;_0x3d2456<=_0x1e0e97;_0x3d2456++){const _0xb6d726=setTimeout(async()=>{const _0x10c58a=_0x20a885;console[_0x10c58a(0x17e)]('🔍\x20MasterCard\x20status\x20check\x20#'+_0x3d2456+'/'+_0x1e0e97+_0x10c58a(0x175)+_0x1ebfe3);try{const _0x49e392=await this[_0x10c58a(0x136)](_0x80ce71,_0x36c519);console[_0x10c58a(0x17e)](_0x10c58a(0xb9)+_0x3d2456+_0x10c58a(0xf7),_0x49e392),_0x49e392[_0x10c58a(0xfa)]&&(console[_0x10c58a(0x17e)](_0x10c58a(0x126)+_0x1ebfe3+'\x20is\x20final\x20('+_0x49e392[_0x10c58a(0xde)]+_0x10c58a(0xc9)),this[_0x10c58a(0xee)](_0x1ebfe3),await this[_0x10c58a(0xd0)](_0x1ebfe3,_0x49e392['status'],_0x49e392));}catch(_0x577642){console[_0x10c58a(0xda)](_0x10c58a(0x116)+_0x3d2456+_0x10c58a(0x96)+_0x1ebfe3+':',_0x577642);}},_0x3d2456*_0x55162a);_0xb52aec['push'](_0xb6d726);}this[_0x20a885(0xd3)]['set'](_0x1ebfe3,_0xb52aec),console[_0x20a885(0x17e)](_0x20a885(0xac)+_0x1e0e97+'\x20status\x20checks\x20for\x20payment\x20'+_0x1ebfe3);}['clearStatusTimers'](_0x17188e){const _0x56b5f5=a42_0x1c989a,_0x1f050a=this[_0x56b5f5(0xd3)][_0x56b5f5(0xae)](_0x17188e);_0x1f050a&&(console['log'](_0x56b5f5(0x173)+_0x1f050a[_0x56b5f5(0xab)]+_0x56b5f5(0xb4)+_0x17188e),_0x1f050a['forEach']((_0x107b07,_0xf54b11)=>{clearTimeout(_0x107b07);}),this[_0x56b5f5(0xd3)][_0x56b5f5(0x177)](_0x17188e));}async[a42_0x1c989a(0xd0)](_0x1c6854,_0x2fe61e,_0x445293){const _0x1d4392=a42_0x1c989a;try{const _0x4e6560=(await Promise['resolve']()['then'](()=>__importStar(require(_0x1d4392(0x188)))))[_0x1d4392(0xd2)],_0x5cd1ec={'status':_0x2fe61e['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x1d4392(0x137),'statusChangedAt':new Date()};_0x2fe61e===_0x1d4392(0xbe)&&(_0x5cd1ec['paidAt']=new Date()),_0x445293[_0x1d4392(0xc0)]&&(_0x5cd1ec['adminNotes']=_0x1d4392(0xed)+_0x445293[_0x1d4392(0xc0)]),await _0x4e6560[_0x1d4392(0x120)]['update']({'where':{'id':_0x1c6854},'data':_0x5cd1ec}),console[_0x1d4392(0x17e)](_0x1d4392(0x126)+_0x1c6854+_0x1d4392(0xcb)+_0x2fe61e),await this['sendPaymentNotifications'](_0x1c6854,_0x2fe61e);}catch(_0x4e0aa2){console[_0x1d4392(0xda)]('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x1c6854+':',_0x4e0aa2);}}async[a42_0x1c989a(0x167)](_0x558178,_0x24f50f){const _0x9f4ee3=a42_0x1c989a;try{const _0x16344b=(await Promise[_0x9f4ee3(0xe9)]()[_0x9f4ee3(0xbb)](()=>__importStar(require(_0x9f4ee3(0x188)))))[_0x9f4ee3(0xd2)],{telegramBotService:_0x118adf}=await Promise['resolve']()['then'](()=>__importStar(require(_0x9f4ee3(0xbf)))),_0x4a85b0=await _0x16344b['payment'][_0x9f4ee3(0xdb)]({'where':{'id':_0x558178},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x4a85b0)return;const _0xda9cb={'PAID':'paid','FAILED':_0x9f4ee3(0x10f)},_0x4847c9=_0xda9cb[_0x24f50f];_0x4847c9&&await _0x118adf['sendPaymentNotification'](_0x4a85b0[_0x9f4ee3(0xa0)],_0x4a85b0,_0x4847c9),await this[_0x9f4ee3(0x12d)](_0x4a85b0,_0x24f50f);}catch(_0x25962a){console[_0x9f4ee3(0xda)](_0x9f4ee3(0xe3),_0x25962a);}}async[a42_0x1c989a(0x12d)](_0x5098fa,_0x486987){const _0x269d78=a42_0x1c989a,_0x12b88e=Date[_0x269d78(0x9f)]();try{const _0x59b77a=_0x5098fa[_0x269d78(0x124)],_0x3c9fbf=_0x59b77a[_0x269d78(0xa4)];if(!_0x3c9fbf?.[_0x269d78(0xa6)]){console[_0x269d78(0x17e)](_0x269d78(0x14f)+_0x59b77a['id']);return;}const _0x22d6ee=_0x486987===_0x269d78(0xbe)?'payment.success':'payment.failed';let _0x53b6db=[];if(_0x3c9fbf[_0x269d78(0x184)])try{_0x53b6db=Array[_0x269d78(0xf0)](_0x3c9fbf['webhookEvents'])?_0x3c9fbf[_0x269d78(0x184)]:JSON['parse'](_0x3c9fbf[_0x269d78(0x184)]);}catch(_0x4aea42){console[_0x269d78(0xda)](_0x269d78(0x151),_0x4aea42),_0x53b6db=[];}if(!_0x53b6db[_0x269d78(0xb8)](_0x22d6ee)){console['log'](_0x269d78(0x9a)+_0x22d6ee+_0x269d78(0x159)+_0x59b77a['id']);return;}const _0x1e76e5={'event':_0x22d6ee,'payment':{'id':_0x5098fa['id'],'order_id':_0x5098fa[_0x269d78(0x10b)],'gateway_order_id':_0x5098fa[_0x269d78(0xcf)],'gateway':_0x269d78(0xb0),'amount':_0x5098fa[_0x269d78(0xf9)],'currency':_0x5098fa[_0x269d78(0xd5)],'status':_0x486987[_0x269d78(0xcc)](),'customer_email':_0x5098fa[_0x269d78(0x152)],'customer_name':_0x5098fa[_0x269d78(0x11b)],'created_at':_0x5098fa[_0x269d78(0x174)],'updated_at':new Date()}},_0xfd892e=await fetch(_0x3c9fbf['webhookUrl'],{'method':_0x269d78(0xcd),'headers':{'Content-Type':_0x269d78(0xa1),'User-Agent':_0x269d78(0x13b)},'body':JSON[_0x269d78(0x100)](_0x1e76e5)}),_0x4d92de=Date[_0x269d78(0x9f)]()-_0x12b88e;loggerService_1[_0x269d78(0x158)][_0x269d78(0x148)](_0x5098fa['shopId'],_0x3c9fbf[_0x269d78(0xa6)],_0x22d6ee,_0xfd892e[_0x269d78(0xde)],_0x4d92de,_0x1e76e5),console[_0x269d78(0x17e)](_0x269d78(0x101)+_0x3c9fbf[_0x269d78(0xa6)]+_0x269d78(0x16d)+_0xfd892e[_0x269d78(0xde)]+'\x20('+_0x4d92de+_0x269d78(0x94));}catch(_0x7a4f05){console[_0x269d78(0xda)](_0x269d78(0x109),_0x7a4f05),loggerService_1[_0x269d78(0x158)][_0x269d78(0x168)](_0x5098fa[_0x269d78(0xa0)],_0x5098fa[_0x269d78(0x124)]?.[_0x269d78(0xa4)]?.[_0x269d78(0xa6)]||'unknown',_0x269d78(0xc8),_0x7a4f05,{});}}[a42_0x1c989a(0xe1)](_0x143229){const _0x269e4b=a42_0x1c989a,_0x3675c0=_0x143229[_0x269e4b(0x147)](/[\s-]/g,'');if(_0x3675c0[_0x269e4b(0xab)]<0x4)return _0x269e4b(0xbd);return'****\x20****\x20****\x20'+_0x3675c0[_0x269e4b(0x14c)](-0x4);}async[a42_0x1c989a(0x110)](_0x4327c7){const _0x57207e=a42_0x1c989a;console[_0x57207e(0x17e)]('Processing\x20MasterCard\x20webhook:',_0x4327c7);let _0x2ddb38=_0x57207e(0xc7);if(_0x4327c7[_0x57207e(0xde)]===0x1&&_0x4327c7[_0x57207e(0xfa)]===0x1)_0x2ddb38=_0x57207e(0xbe);else _0x4327c7[_0x57207e(0xde)]===0x0&&_0x4327c7[_0x57207e(0xfa)]===0x0?_0x2ddb38=_0x57207e(0xc7):_0x2ddb38=_0x57207e(0xe5);return{'paymentId':_0x4327c7['order_id']||'','status':_0x2ddb38,'amount':_0x4327c7[_0x57207e(0xf9)],'currency':_0x4327c7[_0x57207e(0xd5)]};}[a42_0x1c989a(0xd7)](){const _0x31e82b=a42_0x1c989a;console['log'](_0x31e82b(0x162));const _0x130d5=this[_0x31e82b(0xd3)][_0x31e82b(0x164)];for(const [_0x453654]of this['statusCheckTimers']){this['clearStatusTimers'](_0x453654);}console[_0x31e82b(0x17e)](_0x31e82b(0xe4)+_0x130d5+_0x31e82b(0xe2));}}exports[a42_0x1c989a(0xad)]=MasterCardService;