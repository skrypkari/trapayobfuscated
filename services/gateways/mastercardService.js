'use strict';const a43_0x495e1b=a43_0x4f3c;(function(_0xfeaf49,_0x558cd3){const _0x368613=a43_0x4f3c,_0xfc8c46=_0xfeaf49();while(!![]){try{const _0x1c6e40=-parseInt(_0x368613(0x179))/0x1+parseInt(_0x368613(0x133))/0x2*(parseInt(_0x368613(0x108))/0x3)+parseInt(_0x368613(0x14d))/0x4*(parseInt(_0x368613(0x172))/0x5)+parseInt(_0x368613(0x130))/0x6+parseInt(_0x368613(0x11d))/0x7*(-parseInt(_0x368613(0x1e8))/0x8)+-parseInt(_0x368613(0x127))/0x9+parseInt(_0x368613(0x1a9))/0xa*(parseInt(_0x368613(0x145))/0xb);if(_0x1c6e40===_0x558cd3)break;else _0xfc8c46['push'](_0xfc8c46['shift']());}catch(_0x5c9790){_0xfc8c46['push'](_0xfc8c46['shift']());}}}(a43_0x5407,0xeac0d));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x1b0548,_0x51c50d,_0x22402e,_0x40ad05){const _0x4b6eb6=a43_0x4f3c;if(_0x40ad05===undefined)_0x40ad05=_0x22402e;var _0x10c305=Object[_0x4b6eb6(0x175)](_0x51c50d,_0x22402e);(!_0x10c305||(_0x4b6eb6(0x1cb)in _0x10c305?!_0x51c50d[_0x4b6eb6(0x11e)]:_0x10c305[_0x4b6eb6(0x120)]||_0x10c305[_0x4b6eb6(0x152)]))&&(_0x10c305={'enumerable':!![],'get':function(){return _0x51c50d[_0x22402e];}}),Object['defineProperty'](_0x1b0548,_0x40ad05,_0x10c305);}:function(_0x3cd53f,_0x89dba0,_0x4cc890,_0x3146fc){if(_0x3146fc===undefined)_0x3146fc=_0x4cc890;_0x3cd53f[_0x3146fc]=_0x89dba0[_0x4cc890];}),__setModuleDefault=this&&this[a43_0x495e1b(0x1af)]||(Object['create']?function(_0x276a0b,_0x2ff23c){const _0x3af7c0=a43_0x495e1b;Object[_0x3af7c0(0x135)](_0x276a0b,'default',{'enumerable':!![],'value':_0x2ff23c});}:function(_0x44e01e,_0x54526a){const _0x2e1327=a43_0x495e1b;_0x44e01e[_0x2e1327(0x180)]=_0x54526a;}),__importStar=this&&this['__importStar']||(function(){var _0x40c367=function(_0x495e03){return _0x40c367=Object['getOwnPropertyNames']||function(_0x4d57fa){const _0x585214=a43_0x4f3c;var _0x3412ec=[];for(var _0x2dc1d4 in _0x4d57fa)if(Object[_0x585214(0x1b7)][_0x585214(0x162)][_0x585214(0x167)](_0x4d57fa,_0x2dc1d4))_0x3412ec[_0x3412ec[_0x585214(0x18b)]]=_0x2dc1d4;return _0x3412ec;},_0x40c367(_0x495e03);};return function(_0xaefcc6){const _0x2fd45c=a43_0x4f3c;if(_0xaefcc6&&_0xaefcc6[_0x2fd45c(0x11e)])return _0xaefcc6;var _0x3116c3={};if(_0xaefcc6!=null){for(var _0x2effe2=_0x40c367(_0xaefcc6),_0x567b38=0x0;_0x567b38<_0x2effe2['length'];_0x567b38++)if(_0x2effe2[_0x567b38]!==_0x2fd45c(0x180))__createBinding(_0x3116c3,_0xaefcc6,_0x2effe2[_0x567b38]);}return __setModuleDefault(_0x3116c3,_0xaefcc6),_0x3116c3;};}()),__importDefault=this&&this[a43_0x495e1b(0x140)]||function(_0x76acd4){return _0x76acd4&&_0x76acd4['__esModule']?_0x76acd4:{'default':_0x76acd4};};function a43_0x4f3c(_0xe98c33,_0x3a74c1){const _0x540782=a43_0x5407();return a43_0x4f3c=function(_0x4f3c97,_0x2f67c2){_0x4f3c97=_0x4f3c97-0x105;let _0x5aa8f3=_0x540782[_0x4f3c97];return _0x5aa8f3;},a43_0x4f3c(_0xe98c33,_0x3a74c1);}function a43_0x5407(){const _0x2f5a7d=['📊\x20Status\x20check\x20result:','✅\x20Scheduled\x20','****\x20****\x20****\x20','last_name','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','🔐\x20Data\x20signed\x20with\x20RSA','\x20characters','utf8','parse','Error\x20details:','charge','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','MasterCard\x20webhook\x20sent\x20to\x20','end','Final:','first_name','webhook_send','validateKeyFiles','/charge_raw','generateAESKey','📝\x20Encrypted\x20key\x20length:','💳\x20MasterCard\x20service\x20initialized','\x20for\x20payment\x20','🔐\x20Private\x20key\x20path:','checkPaymentStatus','7495208eiIOMT','🔐\x20AES\x20key\x20and\x20IV\x20generated','/status','createDecipheriv','publicKeyPath','privateKeyPath','paymentId',',\x20paymentId=','/charge_decrypt','\x20\x20\x20-\x20lang:\x20en','info','date_success','join','updatePaymentStatus','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','\x20(from:\x20status=','🔐\x20RSA\x20signing\x20successful','decryptResponse','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','paidAt','application/json','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','privateDecrypt','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','/charge','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','encryptRSA','cwd','PENDING','),\x20stopping\x20status\x20checks','13041sDTjuQ','✅\x20Payment\x20successful','Status:','failed','logWhiteDomainResponse','shop','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','then',',\x20final=','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','PHP\x20decryptor\x20error','❌\x20Data\x20being\x20signed:','final','../../config/database','constants','set','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','Status\x20decryption\x20failed:\x20','toUpperCase','14XmoCVC','__esModule','aes-256-ctr','writable','logWhiteDomainError','❌\x20RSA\x20encryption\x20failed:','MasterCardService','substring','🔐\x20Private\x20key\x20length:\x20','keys','6463458PmnQZL','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','maskCardNumber','sendPaymentNotifications','3ds_url','processCardPayment','🔐\x203DS\x20verification\x20required','📊\x20Status\x20check\x20#','TesSoft\x20Payment\x20System/1.0','4522884vAPdTN','orderId','****','220yYFKYY','paid','defineProperty','📊\x20MasterCard\x20webhook\x20extracted\x20data:','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','Payment\x20ID:','\x20\x20\x20-\x20sign\x20length:','toLowerCase','POST','...','merchantPointId','\x20status\x20timers\x20for\x20payment\x20','slice','__importDefault','\x20status\x20checks\x20for\x20payment\x20','\x20status\x20updated\x20to\x20','json','loggerService','11EKjMgF','none','existsSync','FAILED','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','-----END','findUnique','stopAllStatusChecks','88820zyBiIj','3DS\x20URL:','toString','\x20\x20\x20-\x20info\x20length:','statusCheckTimers','configurable','\x20\x20\x20-\x20merchant_point_id:','update','Error\x20parsing\x20webhook\x20events:','Return\x20URL:','cvv','📝\x20Final\x20request\x20structure:','customerEmail','Failed\x20to\x20send\x20payment\x20notifications:','https://api.paydmeth.com/api','createCipheriv','settings','message','includes','sendShopWebhook','currency','hasOwnProperty','/status_raw','\x20MasterCard\x20status\x20check\x20timers','decryptResponsePhp','HTTP\x20Status:','call','payment.success','logWhiteDomainRequest','MasterCard\x20status\x20check\x20error:','adminNotes','ms)','order_id','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','stringify','🔐\x20Public\x20key\x20length:\x20','Amount:','225rncPuy','\x20failed\x20for\x20payment\x20','\x20\x20\x20-\x20key\x20length:','getOwnPropertyDescriptor',',\x20orderId=','signRSA','sign','872335ECpJkX','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','-----BEGIN',',\x20body:\x20','\x20\x20\x20Payment\x20ID:\x20','Unknown\x20error','scheduleStatusChecks','default','publicEncrypt','floor','https://api2.trapay.uk/decrypt.php','delete','🔍\x20MasterCard\x20status\x20check\x20#','gatewayOrderId','decryptAES','error','../telegramBotService','size','length','📝\x20Signature\x20length:','\x20\x20\x20Currency:\x20','shopId','../loggerService','mastercard','💾\x20Payment\x20data\x20prepared','payment_id','webhookUrl','from','\x20not\x20enabled\x20for\x20shop\x20','📝\x20Data\x20length:','MasterCard:\x20','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','log','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','customerName','readFileSync','clearStatusTimers','\x20is\x20final\x20(','amount','trim','\x20result:','private.pem','key','📝\x20Encrypted\x20data\x20length:','apiUrl','text','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','❌\x20MasterCard\x20key\x20validation\x20failed:','21946390CMkyTw','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','Response\x20Body:','⏰\x20Will\x20check\x20status\x20','logShopWebhookError','number','__setModuleDefault','❌\x20PHP\x20decryptor\x20request\x20failed:','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','🔐\x20AES\x20key\x20length:','now','desc','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','expire_year','prototype','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','resolve','HTTP\x20error!\x20status:\x20','createdAt','webhookEvents','unknown','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','Failed\x20to\x20decrypt\x20response','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','🔐\x20Data\x20encrypted\x20with\x20AES','Card\x20Holder:','randomBytes','base64','✅\x20Payment\x20','/charge_decrypted','PAID','status','push','encryptAES','get','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...',',\x20payment_id=','crypto'];a43_0x5407=function(){return _0x2f5a7d;};return a43_0x5407();}Object[a43_0x495e1b(0x135)](exports,'__esModule',{'value':!![]}),exports[a43_0x495e1b(0x123)]=void 0x0;const crypto_1=__importDefault(require(a43_0x495e1b(0x1ce))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a43_0x495e1b(0x18f));class MasterCardService{constructor(){const _0x314478=a43_0x495e1b;this[_0x314478(0x151)]=new Map(),this[_0x314478(0x1a5)]=_0x314478(0x15b),this[_0x314478(0x13d)]=0x67c,this['privateKeyPath']=path_1['default'][_0x314478(0x1f4)](process[_0x314478(0x105)](),_0x314478(0x126),_0x314478(0x1a2)),this[_0x314478(0x1ec)]=path_1[_0x314478(0x180)][_0x314478(0x1f4)](process[_0x314478(0x105)](),_0x314478(0x126),'psp_public.pem'),console[_0x314478(0x199)](_0x314478(0x1e4)),console[_0x314478(0x199)](_0x314478(0x1e6),this['privateKeyPath']),console['log']('🔐\x20Public\x20key\x20path:',this[_0x314478(0x1ec)]),this[_0x314478(0x1e0)]();}[a43_0x495e1b(0x1e0)](){const _0x18228e=a43_0x495e1b;try{if(!fs_1[_0x18228e(0x180)][_0x18228e(0x147)](this['privateKeyPath']))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this[_0x18228e(0x1ed)]);if(!fs_1['default']['existsSync'](this[_0x18228e(0x1ec)]))throw new Error('Public\x20key\x20file\x20not\x20found:\x20'+this[_0x18228e(0x1ec)]);const _0x5e31a3=fs_1[_0x18228e(0x180)][_0x18228e(0x19c)](this['privateKeyPath'],_0x18228e(0x1d6))[_0x18228e(0x1a0)](),_0x412f04=fs_1[_0x18228e(0x180)][_0x18228e(0x19c)](this[_0x18228e(0x1ec)],'utf8')[_0x18228e(0x1a0)]();if(!_0x5e31a3[_0x18228e(0x15f)](_0x18228e(0x17b))||!_0x5e31a3[_0x18228e(0x15f)](_0x18228e(0x14a)))throw new Error(_0x18228e(0x110));if(!_0x412f04[_0x18228e(0x15f)](_0x18228e(0x17b))||!_0x412f04[_0x18228e(0x15f)]('-----END'))throw new Error(_0x18228e(0x1da));console[_0x18228e(0x199)](_0x18228e(0x19a)),console[_0x18228e(0x199)](_0x18228e(0x125)+_0x5e31a3[_0x18228e(0x18b)]+_0x18228e(0x1d5)),console[_0x18228e(0x199)](_0x18228e(0x170)+_0x412f04['length']+_0x18228e(0x1d5));}catch(_0x3b640c){console[_0x18228e(0x188)](_0x18228e(0x1a8),_0x3b640c);throw _0x3b640c;}}['generateAESKey'](){const _0x31d96d=a43_0x495e1b,_0x53cd43=crypto_1[_0x31d96d(0x180)][_0x31d96d(0x1c3)](0x20),_0x5c14e3=crypto_1[_0x31d96d(0x180)][_0x31d96d(0x1c3)](0x10);return{'key':_0x53cd43,'iv':_0x5c14e3};}[a43_0x495e1b(0x1ca)](_0xa58f5,_0x456abb,_0x363e1e){const _0x60192e=a43_0x495e1b,_0x53a7cb=crypto_1[_0x60192e(0x180)][_0x60192e(0x15c)](_0x60192e(0x11f),_0x456abb,_0x363e1e);let _0x2e9164=_0x53a7cb[_0x60192e(0x154)](_0xa58f5,_0x60192e(0x1d6),_0x60192e(0x1c4));return _0x2e9164+=_0x53a7cb[_0x60192e(0x116)]('base64'),_0x2e9164;}['encryptRSA'](_0x467797,_0x561452){const _0xbcde30=a43_0x495e1b;try{const _0x35f927=fs_1[_0xbcde30(0x180)][_0xbcde30(0x19c)](this[_0xbcde30(0x1ec)],_0xbcde30(0x1d6))[_0xbcde30(0x1a0)](),_0x96e218={'iv':_0x561452[_0xbcde30(0x14f)](_0xbcde30(0x1c4)),'key':_0x467797['toString']('base64')},_0x29109a=JSON[_0xbcde30(0x16f)](_0x96e218);console['log'](_0xbcde30(0x11a),_0x29109a[_0xbcde30(0x18b)]);const _0x8876f5=crypto_1[_0xbcde30(0x180)][_0xbcde30(0x181)]({'key':_0x35f927,'padding':crypto_1[_0xbcde30(0x180)][_0xbcde30(0x118)]['RSA_PKCS1_PADDING']},Buffer[_0xbcde30(0x194)](_0x29109a));return console[_0xbcde30(0x199)](_0xbcde30(0x1a7),_0x8876f5['length']),_0x8876f5['toString'](_0xbcde30(0x1c4));}catch(_0x9581ea){console[_0xbcde30(0x188)](_0xbcde30(0x122),_0x9581ea);throw new Error(_0xbcde30(0x1be));}}[a43_0x495e1b(0x177)](_0x17eaea){const _0x2f08a8=a43_0x495e1b;try{const _0x57fe5e=fs_1[_0x2f08a8(0x180)]['readFileSync'](this[_0x2f08a8(0x1ed)],'utf8')[_0x2f08a8(0x1a0)](),_0x2cb8c1=crypto_1[_0x2f08a8(0x180)]['createSign']('SHA256');_0x2cb8c1[_0x2f08a8(0x154)](_0x17eaea),_0x2cb8c1[_0x2f08a8(0x1dc)]();const _0xd330b1=_0x2cb8c1[_0x2f08a8(0x178)](_0x57fe5e,'base64');return console[_0x2f08a8(0x199)](_0x2f08a8(0x1f8)),console[_0x2f08a8(0x199)]('📝\x20Data\x20to\x20sign\x20length:',_0x17eaea[_0x2f08a8(0x18b)]),console['log'](_0x2f08a8(0x18c),_0xd330b1[_0x2f08a8(0x18b)]),_0xd330b1;}catch(_0x5d871c){console[_0x2f08a8(0x188)]('❌\x20RSA\x20signing\x20failed:',_0x5d871c),console[_0x2f08a8(0x188)](_0x2f08a8(0x115),_0x17eaea[_0x2f08a8(0x124)](0x0,0xc8)+_0x2f08a8(0x13c));throw new Error(_0x2f08a8(0x1b1));}}[a43_0x495e1b(0x187)](_0x270af8,_0x2a28b9,_0x523b6e){const _0x24ad1c=a43_0x495e1b,_0x1aba73=crypto_1['default'][_0x24ad1c(0x1eb)]('aes-256-ctr',_0x2a28b9,_0x523b6e);let _0x24b8cb=_0x1aba73['update'](_0x270af8,_0x24ad1c(0x1c4),_0x24ad1c(0x1d6));return _0x24b8cb+=_0x1aba73[_0x24ad1c(0x116)](_0x24ad1c(0x1d6)),_0x24b8cb;}async['decryptResponsePhp'](_0x1e008c,_0x2fe863){const _0x1bba59=a43_0x495e1b;try{const _0x250873=await fetch(_0x1bba59(0x183),{'method':_0x1bba59(0x13b),'headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'info':_0x1e008c,'key':_0x2fe863})});if(!_0x250873['ok'])throw new Error(_0x1bba59(0x114));return await _0x250873[_0x1bba59(0x1a6)]();}catch(_0x52c76d){console['error'](_0x1bba59(0x1b0),_0x52c76d);throw new Error(_0x1bba59(0x137));}}[a43_0x495e1b(0x1f9)](_0x1039f5,_0x4d418a){const _0x8a972d=a43_0x495e1b;try{const _0x42201a=fs_1[_0x8a972d(0x180)][_0x8a972d(0x19c)](this[_0x8a972d(0x1ed)],_0x8a972d(0x1d6))['trim'](),_0x2f13ff=crypto_1['default'][_0x8a972d(0x1fe)](_0x42201a,Buffer[_0x8a972d(0x194)](_0x4d418a,_0x8a972d(0x1c4))),_0x3d63d1=JSON[_0x8a972d(0x1d7)](_0x2f13ff[_0x8a972d(0x14f)]()),_0xb41bf=Buffer[_0x8a972d(0x194)](_0x3d63d1[_0x8a972d(0x1a3)],_0x8a972d(0x1c4)),_0x242a80=Buffer[_0x8a972d(0x194)](_0x3d63d1['iv'],_0x8a972d(0x1c4));return this[_0x8a972d(0x187)](_0x1039f5,_0xb41bf,_0x242a80);}catch(_0x2e5cf9){throw new Error(_0x8a972d(0x1bf));}}async[a43_0x495e1b(0x12c)](_0x250968){const _0x536b5f=a43_0x495e1b,{paymentId:_0x34a994,orderId:_0x1fc4b7,amount:_0x300ad8,currency:_0xcd6812,cardData:_0x2b1314,resultUrl:_0x243988,returnUrl:_0x501d70,cardHolder:_0x3ea556,browser:_0x2d0ccc}=_0x250968;console[_0x536b5f(0x199)](_0x536b5f(0x1f6)),console['log']('Payment\x20ID:',_0x34a994),console[_0x536b5f(0x199)]('Order\x20ID:',_0x1fc4b7),console[_0x536b5f(0x199)](_0x536b5f(0x171),_0x300ad8,_0xcd6812),console[_0x536b5f(0x199)]('Card\x20Number:',this[_0x536b5f(0x129)](_0x2b1314[_0x536b5f(0x1ae)])),console[_0x536b5f(0x199)](_0x536b5f(0x1c2),_0x3ea556[_0x536b5f(0x1de)]+'\x20'+_0x3ea556[_0x536b5f(0x1d2)]),console['log'](_0x536b5f(0x156),_0x501d70),console[_0x536b5f(0x199)]('Result\x20URL:',_0x243988);const _0x4294cf={'amount':_0x300ad8,'currency':_0xcd6812['toUpperCase'](),'order_id':_0x1fc4b7,'result_url':_0x243988,'return_url':_0x501d70,'country':'','card':{'number':_0x2b1314['number'],'expire_month':_0x2b1314['expire_month'],'expire_year':_0x2b1314[_0x536b5f(0x1b6)],'cvv':_0x2b1314[_0x536b5f(0x157)]},'card_holder':_0x3ea556,'browser':_0x2d0ccc},_0x4de3b5=JSON[_0x536b5f(0x16f)](_0x4294cf);console[_0x536b5f(0x199)](_0x536b5f(0x191)),console[_0x536b5f(0x199)](_0x536b5f(0x113)),console[_0x536b5f(0x199)](_0x4de3b5),console[_0x536b5f(0x199)](_0x536b5f(0x196),_0x4de3b5[_0x536b5f(0x18b)]);try{const {key:_0x8a212d,iv:_0xe7394}=this[_0x536b5f(0x1e2)]();console[_0x536b5f(0x199)](_0x536b5f(0x1e9)),console[_0x536b5f(0x199)](_0x536b5f(0x1b2),_0x8a212d[_0x536b5f(0x18b)]),console[_0x536b5f(0x199)]('🔐\x20AES\x20IV\x20length:',_0xe7394[_0x536b5f(0x18b)]);const _0x6092f8=this[_0x536b5f(0x1ca)](_0x4de3b5,_0x8a212d,_0xe7394);console[_0x536b5f(0x199)](_0x536b5f(0x1c1)),console[_0x536b5f(0x199)](_0x536b5f(0x1a4),_0x6092f8[_0x536b5f(0x18b)]);const _0x4eb3fd=this[_0x536b5f(0x203)](_0x8a212d,_0xe7394);console[_0x536b5f(0x199)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x536b5f(0x199)](_0x536b5f(0x1e3),_0x4eb3fd['length']);const _0x4b3cbf=this['signRSA'](_0x4de3b5);console[_0x536b5f(0x199)](_0x536b5f(0x1d4)),console[_0x536b5f(0x199)](_0x536b5f(0x18c),_0x4b3cbf[_0x536b5f(0x18b)]);const _0x1a31f0={'merchant_point_id':this[_0x536b5f(0x13d)],'method':_0x536b5f(0x1d9),'info':_0x6092f8,'key':_0x4eb3fd,'sign':_0x4b3cbf,'lang':'en'};console[_0x536b5f(0x199)](_0x536b5f(0x1cc)),console['log'](_0x536b5f(0x158)),console[_0x536b5f(0x199)](_0x536b5f(0x153),this[_0x536b5f(0x13d)]),console[_0x536b5f(0x199)]('\x20\x20\x20-\x20method:\x20charge'),console['log'](_0x536b5f(0x150),_0x6092f8[_0x536b5f(0x18b)]),console['log'](_0x536b5f(0x174),_0x4eb3fd[_0x536b5f(0x18b)]),console[_0x536b5f(0x199)](_0x536b5f(0x139),_0x4b3cbf[_0x536b5f(0x18b)]),console[_0x536b5f(0x199)](_0x536b5f(0x1f1)),loggerService_1[_0x536b5f(0x144)][_0x536b5f(0x169)](_0x536b5f(0x190),_0x536b5f(0x201),_0x536b5f(0x13b),{'merchant_point_id':this[_0x536b5f(0x13d)],'method':_0x536b5f(0x1d9),'lang':'en'});const _0x722dce=Date['now'](),_0x371cca=await fetch(this[_0x536b5f(0x1a5)],{'method':_0x536b5f(0x13b),'headers':{'Content-Type':_0x536b5f(0x1fc),'Accept':_0x536b5f(0x1fc),'User-Agent':_0x536b5f(0x12f)},'body':JSON[_0x536b5f(0x16f)](_0x1a31f0)}),_0x3e051a=Date[_0x536b5f(0x1b3)]()-_0x722dce;console[_0x536b5f(0x199)](_0x536b5f(0x1aa)),console[_0x536b5f(0x199)](_0x536b5f(0x10a),_0x371cca[_0x536b5f(0x1c8)]),console[_0x536b5f(0x199)]('Response\x20Time:',_0x3e051a+'ms');if(!_0x371cca['ok']){const _0x1ca51a=await _0x371cca[_0x536b5f(0x1a6)]();console[_0x536b5f(0x188)](_0x536b5f(0x166),_0x371cca[_0x536b5f(0x1c8)]),console[_0x536b5f(0x188)](_0x536b5f(0x1ab),_0x1ca51a),loggerService_1[_0x536b5f(0x144)][_0x536b5f(0x10c)](_0x536b5f(0x190),'/charge_raw',_0x371cca[_0x536b5f(0x1c8)],_0x1ca51a,_0x3e051a),loggerService_1[_0x536b5f(0x144)][_0x536b5f(0x121)](_0x536b5f(0x190),'/charge','HTTP\x20'+_0x371cca['status']+':\x20'+_0x1ca51a);throw new Error(_0x536b5f(0x1ba)+_0x371cca[_0x536b5f(0x1c8)]+_0x536b5f(0x17c)+_0x1ca51a);}const _0x1d2b64=await _0x371cca[_0x536b5f(0x143)]();loggerService_1[_0x536b5f(0x144)][_0x536b5f(0x10c)]('mastercard',_0x536b5f(0x1e1),_0x371cca[_0x536b5f(0x1c8)],_0x1d2b64,_0x3e051a),console[_0x536b5f(0x199)](_0x536b5f(0x1b8));let _0x36f2de=_0x1d2b64;if(_0x1d2b64[_0x536b5f(0x1f2)]&&_0x1d2b64[_0x536b5f(0x1a3)]&&_0x1d2b64['sign']){console['log'](_0x536b5f(0x1fd));try{const _0x2d7490=await this[_0x536b5f(0x165)](_0x1d2b64[_0x536b5f(0x1f2)],_0x1d2b64[_0x536b5f(0x1a3)]);_0x36f2de=JSON[_0x536b5f(0x1d7)](_0x2d7490),console[_0x536b5f(0x199)]('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0x536b5f(0x144)][_0x536b5f(0x10c)](_0x536b5f(0x190),_0x536b5f(0x1c6),_0x371cca[_0x536b5f(0x1c8)],_0x36f2de,_0x3e051a),console['log']('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x18bb5a){console[_0x536b5f(0x188)]('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x18bb5a),loggerService_1[_0x536b5f(0x144)][_0x536b5f(0x121)](_0x536b5f(0x190),_0x536b5f(0x1f0),'Decryption\x20failed:\x20'+_0x18bb5a),_0x36f2de=_0x1d2b64;}}else loggerService_1[_0x536b5f(0x144)][_0x536b5f(0x10c)](_0x536b5f(0x190),_0x536b5f(0x1c6),_0x371cca['status'],_0x36f2de,_0x3e051a),console['log'](_0x536b5f(0x10f));console[_0x536b5f(0x199)](_0x536b5f(0x10a),_0x36f2de['status']),console[_0x536b5f(0x199)](_0x536b5f(0x1dd),_0x36f2de[_0x536b5f(0x116)]),console[_0x536b5f(0x199)](_0x536b5f(0x138),_0x36f2de[_0x536b5f(0x192)]),console[_0x536b5f(0x199)](_0x536b5f(0x14e),_0x36f2de[_0x536b5f(0x12b)]||_0x536b5f(0x146));if(_0x36f2de[_0x536b5f(0x1c8)]===0x64&&_0x36f2de[_0x536b5f(0x116)]===0x1)return console[_0x536b5f(0x199)](_0x536b5f(0x109)),{'gateway_payment_id':_0x36f2de['payment_id']?.[_0x536b5f(0x14f)](),'payment_url':_0x501d70,'requires_3ds':![],'status':_0x536b5f(0x1c7),'final':!![]};if(_0x36f2de[_0x536b5f(0x12b)])return console[_0x536b5f(0x199)](_0x536b5f(0x12d)),this[_0x536b5f(0x17f)](_0x34a994,_0x1fc4b7,_0x36f2de[_0x536b5f(0x192)]?.[_0x536b5f(0x14f)]()||_0x1fc4b7),{'gateway_payment_id':_0x36f2de[_0x536b5f(0x192)]?.[_0x536b5f(0x14f)](),'payment_url':_0x36f2de[_0x536b5f(0x12b)],'requires_3ds':!![],'threeds_url':_0x36f2de[_0x536b5f(0x12b)],'status':_0x536b5f(0x106),'final':![]};let _0x29851d=_0x36f2de[_0x536b5f(0x1b4)]||_0x36f2de[_0x536b5f(0x15e)]||_0x536b5f(0x17e),_0x49ee1e=_0x36f2de[_0x536b5f(0x1c8)],_0x430b69=_0x36f2de[_0x536b5f(0x116)];return console[_0x536b5f(0x199)](_0x536b5f(0x198)+_0x49ee1e+',\x20Final:\x20'+_0x430b69+',\x20Desc:\x20'+_0x29851d),{'gateway_payment_id':_0x36f2de[_0x536b5f(0x192)]?.[_0x536b5f(0x14f)](),'payment_url':_0x501d70,'requires_3ds':![],'status':_0x536b5f(0x148),'final':!![]};}catch(_0x530a23){console[_0x536b5f(0x188)]('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console[_0x536b5f(0x188)](_0x536b5f(0x1d8),_0x530a23),loggerService_1[_0x536b5f(0x144)][_0x536b5f(0x121)](_0x536b5f(0x190),'/charge',_0x530a23);throw new Error(_0x536b5f(0x1b5)+(_0x530a23 instanceof Error?_0x530a23[_0x536b5f(0x15e)]:_0x536b5f(0x17e)));}}async[a43_0x495e1b(0x1e7)](_0xbd7163,_0x155c69){const _0x45c423=a43_0x495e1b;console[_0x45c423(0x199)](_0x45c423(0x1c0)+_0xbd7163+'\x20('+_0x155c69+')');try{const _0x3c3a0a={'payment_id':_0xbd7163,'order_id':_0x155c69},_0x53b369=JSON[_0x45c423(0x16f)](_0x3c3a0a),{key:_0x92e7ad,iv:_0x57ea68}=this[_0x45c423(0x1e2)](),_0x4a2904=this[_0x45c423(0x1ca)](_0x53b369,_0x92e7ad,_0x57ea68),_0xa46ee3=this[_0x45c423(0x203)](_0x92e7ad,_0x57ea68),_0x1c2fc3=this[_0x45c423(0x177)](_0x53b369),_0xcc12f5={'merchant_point_id':this[_0x45c423(0x13d)],'method':'status','info':_0x4a2904,'key':_0xa46ee3,'sign':_0x1c2fc3,'lang':'en'};loggerService_1[_0x45c423(0x144)][_0x45c423(0x169)](_0x45c423(0x190),_0x45c423(0x1ea),_0x45c423(0x13b),{'merchant_point_id':this[_0x45c423(0x13d)],'method':_0x45c423(0x1c8),'lang':'en'});const _0x19473e=Date[_0x45c423(0x1b3)](),_0x49f249=await fetch(this[_0x45c423(0x1a5)],{'method':_0x45c423(0x13b),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x45c423(0x16f)](_0xcc12f5)}),_0x25d222=Date[_0x45c423(0x1b3)]()-_0x19473e;if(!_0x49f249['ok']){const _0x35c0d6=await _0x49f249[_0x45c423(0x1a6)]();loggerService_1['loggerService'][_0x45c423(0x10c)](_0x45c423(0x190),_0x45c423(0x163),_0x49f249['status'],_0x35c0d6,_0x25d222);throw new Error(_0x45c423(0x1ba)+_0x49f249[_0x45c423(0x1c8)]);}const _0x2f3434=await _0x49f249[_0x45c423(0x143)]();loggerService_1[_0x45c423(0x144)]['logWhiteDomainResponse'](_0x45c423(0x190),_0x45c423(0x163),_0x49f249[_0x45c423(0x1c8)],_0x2f3434,_0x25d222);let _0x34757c=_0x2f3434;if(_0x2f3434[_0x45c423(0x1f2)]&&_0x2f3434[_0x45c423(0x1a3)]&&_0x2f3434[_0x45c423(0x178)]){console[_0x45c423(0x199)](_0x45c423(0x128));try{const _0x21bf60=this[_0x45c423(0x1f9)](_0x2f3434[_0x45c423(0x1f2)],_0x2f3434[_0x45c423(0x1a3)]);_0x34757c=JSON[_0x45c423(0x1d7)](_0x21bf60),console['log']('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x45c423(0x144)]['logWhiteDomainResponse'](_0x45c423(0x190),'/status_decrypted',_0x49f249[_0x45c423(0x1c8)],_0x34757c,_0x25d222),console['log'](_0x45c423(0x149));}catch(_0x2af28c){console[_0x45c423(0x188)](_0x45c423(0x1ff),_0x2af28c),loggerService_1[_0x45c423(0x144)][_0x45c423(0x121)]('mastercard','/status_decrypt',_0x45c423(0x11b)+_0x2af28c),_0x34757c=_0x2f3434;}}else loggerService_1[_0x45c423(0x144)][_0x45c423(0x10c)](_0x45c423(0x190),'/status_decrypted',_0x49f249[_0x45c423(0x1c8)],_0x34757c,_0x25d222),console[_0x45c423(0x199)](_0x45c423(0x10e));console[_0x45c423(0x199)](_0x45c423(0x1cf),{'status':_0x34757c[_0x45c423(0x1c8)],'final':_0x34757c[_0x45c423(0x116)],'payment_id':_0x34757c[_0x45c423(0x192)],'desc':_0x34757c[_0x45c423(0x1b4)]});let _0x3bd7a0=_0x45c423(0x106);if(_0x34757c['status']===0x1&&_0x34757c[_0x45c423(0x116)]===0x1)_0x3bd7a0=_0x45c423(0x1c7);else _0x34757c[_0x45c423(0x1c8)]===0x0&&_0x34757c['final']===0x0?_0x3bd7a0=_0x45c423(0x106):_0x3bd7a0=_0x45c423(0x148);return{'status':_0x3bd7a0,'final':_0x34757c['final']===0x1,'amount':_0x34757c[_0x45c423(0x19f)],'currency':_0x34757c[_0x45c423(0x161)],'date_success':_0x34757c[_0x45c423(0x1f3)],'description':_0x34757c[_0x45c423(0x1b4)]};}catch(_0x400f4c){console[_0x45c423(0x188)](_0x45c423(0x16a),_0x400f4c),loggerService_1[_0x45c423(0x144)][_0x45c423(0x121)](_0x45c423(0x190),_0x45c423(0x1ea),_0x400f4c);throw new Error(_0x45c423(0x17a)+(_0x400f4c instanceof Error?_0x400f4c['message']:_0x45c423(0x17e)));}}['scheduleStatusChecks'](_0x32f438,_0x2a8cd8,_0x57e82a){const _0x334c5e=a43_0x495e1b;console['log'](_0x334c5e(0x1d3)+_0x32f438+'\x20('+_0x57e82a+')'),this[_0x334c5e(0x19d)](_0x32f438);const _0x150d0d=[],_0x40ecdb=0x5*0x3c*0x3e8,_0x1fa20f=0x2*0x3c*0x3c*0x3e8,_0x2e142e=Math[_0x334c5e(0x182)](_0x1fa20f/_0x40ecdb);console[_0x334c5e(0x199)](_0x334c5e(0x1ac)+_0x2e142e+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x1d38e1=0x1;_0x1d38e1<=_0x2e142e;_0x1d38e1++){const _0x137a2d=setTimeout(async()=>{const _0x107305=_0x334c5e;console['log'](_0x107305(0x185)+_0x1d38e1+'/'+_0x2e142e+_0x107305(0x1e5)+_0x32f438);try{const _0x5bf0c4=await this[_0x107305(0x1e7)](_0x57e82a,_0x2a8cd8);console['log'](_0x107305(0x12e)+_0x1d38e1+_0x107305(0x1a1),_0x5bf0c4),_0x5bf0c4[_0x107305(0x116)]&&(console[_0x107305(0x199)](_0x107305(0x1c5)+_0x32f438+_0x107305(0x19e)+_0x5bf0c4[_0x107305(0x1c8)]+_0x107305(0x107)),this[_0x107305(0x19d)](_0x32f438),await this[_0x107305(0x1f5)](_0x32f438,_0x5bf0c4[_0x107305(0x1c8)],_0x5bf0c4));}catch(_0x4b0f22){console[_0x107305(0x188)]('❌\x20Status\x20check\x20#'+_0x1d38e1+_0x107305(0x173)+_0x32f438+':',_0x4b0f22);}},_0x1d38e1*_0x40ecdb);_0x150d0d[_0x334c5e(0x1c9)](_0x137a2d);}this[_0x334c5e(0x151)][_0x334c5e(0x119)](_0x32f438,_0x150d0d),console[_0x334c5e(0x199)](_0x334c5e(0x1d0)+_0x2e142e+_0x334c5e(0x141)+_0x32f438);}[a43_0x495e1b(0x19d)](_0x38f68a){const _0x3306a5=a43_0x495e1b,_0x450c6e=this[_0x3306a5(0x151)][_0x3306a5(0x1cb)](_0x38f68a);_0x450c6e&&(console['log']('🧹\x20Clearing\x20'+_0x450c6e['length']+_0x3306a5(0x13e)+_0x38f68a),_0x450c6e['forEach']((_0x17986b,_0x110721)=>{clearTimeout(_0x17986b);}),this[_0x3306a5(0x151)][_0x3306a5(0x184)](_0x38f68a));}async[a43_0x495e1b(0x1f5)](_0x26b500,_0x1c3d81,_0x2ce797){const _0xd3a5c=a43_0x495e1b;try{const _0x40d29e=(await Promise[_0xd3a5c(0x1b9)]()[_0xd3a5c(0x111)](()=>__importStar(require(_0xd3a5c(0x117)))))[_0xd3a5c(0x180)],_0x34e8df={'status':_0x1c3d81[_0xd3a5c(0x11c)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x1c3d81===_0xd3a5c(0x1c7)&&(_0x34e8df[_0xd3a5c(0x1fb)]=new Date()),_0x2ce797['description']&&(_0x34e8df[_0xd3a5c(0x16b)]=_0xd3a5c(0x197)+_0x2ce797['description']),await _0x40d29e['payment']['update']({'where':{'id':_0x26b500},'data':_0x34e8df}),console[_0xd3a5c(0x199)](_0xd3a5c(0x1c5)+_0x26b500+_0xd3a5c(0x142)+_0x1c3d81),await this[_0xd3a5c(0x12a)](_0x26b500,_0x1c3d81);}catch(_0x9d4286){console[_0xd3a5c(0x188)](_0xd3a5c(0x1fa)+_0x26b500+':',_0x9d4286);}}async[a43_0x495e1b(0x12a)](_0x10772e,_0x181696){const _0x5d8eaa=a43_0x495e1b;try{const _0x170680=(await Promise[_0x5d8eaa(0x1b9)]()[_0x5d8eaa(0x111)](()=>__importStar(require(_0x5d8eaa(0x117)))))[_0x5d8eaa(0x180)],{telegramBotService:_0x4002dc}=await Promise['resolve']()[_0x5d8eaa(0x111)](()=>__importStar(require(_0x5d8eaa(0x189)))),_0x1aad0d=await _0x170680['payment'][_0x5d8eaa(0x14b)]({'where':{'id':_0x10772e},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x1aad0d)return;const _0x3b919b={'PAID':_0x5d8eaa(0x134),'FAILED':_0x5d8eaa(0x10b)},_0xb2bf63=_0x3b919b[_0x181696];_0xb2bf63&&await _0x4002dc['sendPaymentNotification'](_0x1aad0d['shopId'],_0x1aad0d,_0xb2bf63),await this[_0x5d8eaa(0x160)](_0x1aad0d,_0x181696);}catch(_0x5913f7){console[_0x5d8eaa(0x188)](_0x5d8eaa(0x15a),_0x5913f7);}}async[a43_0x495e1b(0x160)](_0x5bb467,_0x1e9589){const _0x11df8b=a43_0x495e1b,_0x5cf53d=Date[_0x11df8b(0x1b3)]();try{const _0x1227be=_0x5bb467['shop'],_0x30ff25=_0x1227be[_0x11df8b(0x15d)];if(!_0x30ff25?.[_0x11df8b(0x193)]){console[_0x11df8b(0x199)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x1227be['id']);return;}const _0x7ffdee=_0x1e9589==='PAID'?_0x11df8b(0x168):'payment.failed';let _0x516126=[];if(_0x30ff25[_0x11df8b(0x1bc)])try{_0x516126=Array['isArray'](_0x30ff25['webhookEvents'])?_0x30ff25[_0x11df8b(0x1bc)]:JSON[_0x11df8b(0x1d7)](_0x30ff25['webhookEvents']);}catch(_0x12a773){console['error'](_0x11df8b(0x155),_0x12a773),_0x516126=[];}if(!_0x516126[_0x11df8b(0x15f)](_0x7ffdee)){console['log']('Webhook\x20event\x20'+_0x7ffdee+_0x11df8b(0x195)+_0x1227be['id']);return;}const _0x54a276={'event':_0x7ffdee,'payment':{'id':_0x5bb467['id'],'order_id':_0x5bb467[_0x11df8b(0x131)],'gateway_order_id':_0x5bb467[_0x11df8b(0x186)],'gateway':'1111','amount':_0x5bb467[_0x11df8b(0x19f)],'currency':_0x5bb467[_0x11df8b(0x161)],'status':_0x1e9589[_0x11df8b(0x13a)](),'customer_email':_0x5bb467[_0x11df8b(0x159)],'customer_name':_0x5bb467[_0x11df8b(0x19b)],'created_at':_0x5bb467[_0x11df8b(0x1bb)],'updated_at':new Date()}},_0x10fa8d=await fetch(_0x30ff25[_0x11df8b(0x193)],{'method':_0x11df8b(0x13b),'headers':{'Content-Type':_0x11df8b(0x1fc),'User-Agent':_0x11df8b(0x16e)},'body':JSON['stringify'](_0x54a276)}),_0xe17745=Date[_0x11df8b(0x1b3)]()-_0x5cf53d;loggerService_1[_0x11df8b(0x144)]['logShopWebhookSent'](_0x5bb467[_0x11df8b(0x18e)],_0x30ff25[_0x11df8b(0x193)],_0x7ffdee,_0x10fa8d[_0x11df8b(0x1c8)],_0xe17745,_0x54a276),console[_0x11df8b(0x199)](_0x11df8b(0x1db)+_0x30ff25[_0x11df8b(0x193)]+'\x20with\x20status\x20'+_0x10fa8d['status']+'\x20('+_0xe17745+_0x11df8b(0x16c));}catch(_0x52a4ac){console['error']('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x52a4ac),loggerService_1['loggerService'][_0x11df8b(0x1ad)](_0x5bb467[_0x11df8b(0x18e)],_0x5bb467[_0x11df8b(0x10d)]?.[_0x11df8b(0x15d)]?.[_0x11df8b(0x193)]||_0x11df8b(0x1bd),_0x11df8b(0x1df),_0x52a4ac,{});}}[a43_0x495e1b(0x129)](_0x1fa2d5){const _0x42eda2=a43_0x495e1b,_0x5956f0=_0x1fa2d5['replace'](/[\s-]/g,'');if(_0x5956f0[_0x42eda2(0x18b)]<0x4)return _0x42eda2(0x132);return _0x42eda2(0x1d1)+_0x5956f0[_0x42eda2(0x13f)](-0x4);}async['processWebhook'](_0x3282ee){const _0x3ca622=a43_0x495e1b;console['log'](_0x3ca622(0x202),JSON[_0x3ca622(0x16f)](_0x3282ee,null,0x2));let _0xc593ac=_0x3ca622(0x106);if(_0x3282ee[_0x3ca622(0x1c8)]===0x1&&_0x3282ee[_0x3ca622(0x116)]===0x1)_0xc593ac=_0x3ca622(0x1c7);else _0x3282ee[_0x3ca622(0x1c8)]===0x0&&_0x3282ee[_0x3ca622(0x116)]===0x0?_0xc593ac='PENDING':_0xc593ac=_0x3ca622(0x148);const _0x535193=_0x3282ee[_0x3ca622(0x16d)]||_0x3282ee[_0x3ca622(0x131)]||_0x3282ee[_0x3ca622(0x192)]||_0x3282ee[_0x3ca622(0x1ee)]||_0x3282ee['id']||'';return console[_0x3ca622(0x199)](_0x3ca622(0x136)),console[_0x3ca622(0x199)](_0x3ca622(0x17d)+_0x535193+'\x20(from:\x20order_id='+_0x3282ee[_0x3ca622(0x16d)]+_0x3ca622(0x176)+_0x3282ee[_0x3ca622(0x131)]+_0x3ca622(0x1cd)+_0x3282ee[_0x3ca622(0x192)]+_0x3ca622(0x1ef)+_0x3282ee['paymentId']+',\x20id='+_0x3282ee['id']+')'),console['log']('\x20\x20\x20Status:\x20'+_0xc593ac+_0x3ca622(0x1f7)+_0x3282ee[_0x3ca622(0x1c8)]+_0x3ca622(0x112)+_0x3282ee[_0x3ca622(0x116)]+')'),console[_0x3ca622(0x199)]('\x20\x20\x20Amount:\x20'+_0x3282ee[_0x3ca622(0x19f)]),console[_0x3ca622(0x199)](_0x3ca622(0x18d)+_0x3282ee[_0x3ca622(0x161)]),{'paymentId':_0x535193,'status':_0xc593ac,'amount':_0x3282ee['amount'],'currency':_0x3282ee[_0x3ca622(0x161)]};}[a43_0x495e1b(0x14c)](){const _0x343836=a43_0x495e1b;console[_0x343836(0x199)](_0x343836(0x200));const _0x330c8b=this[_0x343836(0x151)][_0x343836(0x18a)];for(const [_0x466814]of this[_0x343836(0x151)]){this[_0x343836(0x19d)](_0x466814);}console[_0x343836(0x199)]('🛑\x20Stopped\x20'+_0x330c8b+_0x343836(0x164));}}exports['MasterCardService']=MasterCardService;