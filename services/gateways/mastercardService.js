'use strict';const a42_0x547cca=a42_0x76ce;(function(_0x507f17,_0x962cd4){const _0x24adf4=a42_0x76ce,_0x5a5b73=_0x507f17();while(!![]){try{const _0x46ceb0=-parseInt(_0x24adf4(0x21c))/0x1+parseInt(_0x24adf4(0x2b1))/0x2+parseInt(_0x24adf4(0x219))/0x3*(-parseInt(_0x24adf4(0x1d9))/0x4)+parseInt(_0x24adf4(0x2b5))/0x5+-parseInt(_0x24adf4(0x22e))/0x6*(parseInt(_0x24adf4(0x22d))/0x7)+-parseInt(_0x24adf4(0x217))/0x8+parseInt(_0x24adf4(0x204))/0x9;if(_0x46ceb0===_0x962cd4)break;else _0x5a5b73['push'](_0x5a5b73['shift']());}catch(_0x228352){_0x5a5b73['push'](_0x5a5b73['shift']());}}}(a42_0x5d80,0x5247c));function a42_0x76ce(_0x15799e,_0x5dc7df){const _0x5d808d=a42_0x5d80();return a42_0x76ce=function(_0x76ce1d,_0x24267f){_0x76ce1d=_0x76ce1d-0x1ca;let _0x2c2897=_0x5d808d[_0x76ce1d];return _0x2c2897;},a42_0x76ce(_0x15799e,_0x5dc7df);}var __createBinding=this&&this[a42_0x547cca(0x296)]||(Object[a42_0x547cca(0x260)]?function(_0x1c801e,_0x17f90d,_0x15ad73,_0x102214){const _0x51dbae=a42_0x547cca;if(_0x102214===undefined)_0x102214=_0x15ad73;var _0x205204=Object['getOwnPropertyDescriptor'](_0x17f90d,_0x15ad73);(!_0x205204||(_0x51dbae(0x2bd)in _0x205204?!_0x17f90d['__esModule']:_0x205204['writable']||_0x205204[_0x51dbae(0x21f)]))&&(_0x205204={'enumerable':!![],'get':function(){return _0x17f90d[_0x15ad73];}}),Object[_0x51dbae(0x21a)](_0x1c801e,_0x102214,_0x205204);}:function(_0x59b1a8,_0x3fe415,_0x40a6ba,_0x47ab21){if(_0x47ab21===undefined)_0x47ab21=_0x40a6ba;_0x59b1a8[_0x47ab21]=_0x3fe415[_0x40a6ba];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a42_0x547cca(0x260)]?function(_0x55c776,_0x44ce6c){const _0x53c307=a42_0x547cca;Object['defineProperty'](_0x55c776,_0x53c307(0x269),{'enumerable':!![],'value':_0x44ce6c});}:function(_0x486bc5,_0xb5147e){_0x486bc5['default']=_0xb5147e;}),__importStar=this&&this[a42_0x547cca(0x245)]||(function(){var _0x4f8055=function(_0x468d70){const _0x5ed70d=a42_0x76ce;return _0x4f8055=Object[_0x5ed70d(0x280)]||function(_0x5126fc){const _0x52bdea=_0x5ed70d;var _0x282b96=[];for(var _0xbe145f in _0x5126fc)if(Object['prototype'][_0x52bdea(0x265)][_0x52bdea(0x267)](_0x5126fc,_0xbe145f))_0x282b96[_0x282b96[_0x52bdea(0x1ed)]]=_0xbe145f;return _0x282b96;},_0x4f8055(_0x468d70);};return function(_0x497b9f){const _0x73ecc4=a42_0x76ce;if(_0x497b9f&&_0x497b9f['__esModule'])return _0x497b9f;var _0x283807={};if(_0x497b9f!=null){for(var _0x303e0f=_0x4f8055(_0x497b9f),_0x2f56ee=0x0;_0x2f56ee<_0x303e0f[_0x73ecc4(0x1ed)];_0x2f56ee++)if(_0x303e0f[_0x2f56ee]!==_0x73ecc4(0x269))__createBinding(_0x283807,_0x497b9f,_0x303e0f[_0x2f56ee]);}return __setModuleDefault(_0x283807,_0x497b9f),_0x283807;};}()),__importDefault=this&&this[a42_0x547cca(0x281)]||function(_0xbd03bc){const _0x6f33b6=a42_0x547cca;return _0xbd03bc&&_0xbd03bc[_0x6f33b6(0x26f)]?_0xbd03bc:{'default':_0xbd03bc};};Object['defineProperty'](exports,a42_0x547cca(0x26f),{'value':!![]}),exports['MasterCardService']=void 0x0;const crypto_1=__importDefault(require(a42_0x547cca(0x250))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x547cca(0x1ff))),loggerService_1=require(a42_0x547cca(0x27d));class MasterCardService{constructor(){const _0x318ef7=a42_0x547cca;this[_0x318ef7(0x2a1)]=new Map(),this[_0x318ef7(0x29d)]='https://api.paydmeth.com/api',this[_0x318ef7(0x1de)]=0x67c,this[_0x318ef7(0x2ba)]=path_1[_0x318ef7(0x269)][_0x318ef7(0x1eb)](process[_0x318ef7(0x2b0)](),_0x318ef7(0x1e0),_0x318ef7(0x23e)),this[_0x318ef7(0x27f)]=path_1[_0x318ef7(0x269)]['join'](process[_0x318ef7(0x2b0)](),_0x318ef7(0x1e0),_0x318ef7(0x237)),console[_0x318ef7(0x292)](_0x318ef7(0x28c)),console[_0x318ef7(0x292)](_0x318ef7(0x224),this['privateKeyPath']),console[_0x318ef7(0x292)](_0x318ef7(0x28a),this['publicKeyPath']),this[_0x318ef7(0x288)]();}['validateKeyFiles'](){const _0x1ee15c=a42_0x547cca;try{if(!fs_1['default']['existsSync'](this[_0x1ee15c(0x2ba)]))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this[_0x1ee15c(0x2ba)]);if(!fs_1['default'][_0x1ee15c(0x1cf)](this[_0x1ee15c(0x27f)]))throw new Error(_0x1ee15c(0x24f)+this[_0x1ee15c(0x27f)]);const _0x196ad7=fs_1['default'][_0x1ee15c(0x212)](this['privateKeyPath'],_0x1ee15c(0x1d5))[_0x1ee15c(0x211)](),_0x534171=fs_1['default']['readFileSync'](this[_0x1ee15c(0x27f)],'utf8')[_0x1ee15c(0x211)]();if(!_0x196ad7[_0x1ee15c(0x23f)](_0x1ee15c(0x221))||!_0x196ad7['includes'](_0x1ee15c(0x2af)))throw new Error(_0x1ee15c(0x268));if(!_0x534171[_0x1ee15c(0x23f)](_0x1ee15c(0x221))||!_0x534171[_0x1ee15c(0x23f)](_0x1ee15c(0x2af)))throw new Error(_0x1ee15c(0x213));console['log']('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console['log'](_0x1ee15c(0x24b)+_0x196ad7['length']+_0x1ee15c(0x282)),console[_0x1ee15c(0x292)](_0x1ee15c(0x2bf)+_0x534171[_0x1ee15c(0x1ed)]+'\x20characters');}catch(_0x1fe13c){console[_0x1ee15c(0x289)](_0x1ee15c(0x1d7),_0x1fe13c);throw _0x1fe13c;}}[a42_0x547cca(0x242)](){const _0x330514=a42_0x547cca,_0xf886c=crypto_1['default'][_0x330514(0x23c)](0x20),_0x22d63b=crypto_1[_0x330514(0x269)][_0x330514(0x23c)](0x10);return{'key':_0xf886c,'iv':_0x22d63b};}['encryptAES'](_0x1f9681,_0x519aa9,_0x24e4b2){const _0x41bd76=a42_0x547cca,_0x5b3165=crypto_1[_0x41bd76(0x269)]['createCipheriv']('aes-256-ctr',_0x519aa9,_0x24e4b2);let _0xd43ca1=_0x5b3165[_0x41bd76(0x258)](_0x1f9681,'utf8',_0x41bd76(0x1e7));return _0xd43ca1+=_0x5b3165['final']('base64'),_0xd43ca1;}[a42_0x547cca(0x225)](_0x5b6826,_0x3e986f){const _0x7459=a42_0x547cca;try{const _0x4e8b08=fs_1[_0x7459(0x269)][_0x7459(0x212)](this[_0x7459(0x27f)],_0x7459(0x1d5))[_0x7459(0x211)](),_0x1db863={'iv':_0x3e986f['toString']('base64'),'key':_0x5b6826[_0x7459(0x2a8)](_0x7459(0x1e7))},_0x20bef3=JSON[_0x7459(0x21b)](_0x1db863);console[_0x7459(0x292)](_0x7459(0x200),_0x20bef3[_0x7459(0x1ed)]);const _0x4c5f16=crypto_1[_0x7459(0x269)]['publicEncrypt']({'key':_0x4e8b08,'padding':crypto_1[_0x7459(0x269)][_0x7459(0x2b3)][_0x7459(0x1f9)]},Buffer['from'](_0x20bef3));return console[_0x7459(0x292)]('✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x4c5f16['length']),_0x4c5f16[_0x7459(0x2a8)](_0x7459(0x1e7));}catch(_0x54f1d0){console[_0x7459(0x289)](_0x7459(0x232),_0x54f1d0);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a42_0x547cca(0x24d)](_0x29b653){const _0x2a0486=a42_0x547cca;try{const _0x56503f=fs_1['default'][_0x2a0486(0x212)](this['privateKeyPath'],_0x2a0486(0x1d5))[_0x2a0486(0x211)](),_0x1aa5b4=crypto_1[_0x2a0486(0x269)][_0x2a0486(0x22b)](_0x2a0486(0x1cc));_0x1aa5b4[_0x2a0486(0x258)](_0x29b653),_0x1aa5b4[_0x2a0486(0x1ca)]();const _0x1e6af6=_0x1aa5b4[_0x2a0486(0x1ea)](_0x56503f,'base64');return console[_0x2a0486(0x292)](_0x2a0486(0x2a2)),console['log'](_0x2a0486(0x208),_0x29b653[_0x2a0486(0x1ed)]),console[_0x2a0486(0x292)](_0x2a0486(0x1ee),_0x1e6af6[_0x2a0486(0x1ed)]),_0x1e6af6;}catch(_0x24a0e5){console['error'](_0x2a0486(0x22a),_0x24a0e5),console['error'](_0x2a0486(0x1f5),_0x29b653[_0x2a0486(0x205)](0x0,0xc8)+_0x2a0486(0x231));throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}[a42_0x547cca(0x1ef)](_0x197475,_0x4daea3,_0x14a201){const _0x1951c9=a42_0x547cca,_0x2dc28a=crypto_1[_0x1951c9(0x269)][_0x1951c9(0x270)](_0x1951c9(0x244),_0x4daea3,_0x14a201);let _0x4e0a3e=_0x2dc28a[_0x1951c9(0x258)](_0x197475,_0x1951c9(0x1e7),'utf8');return _0x4e0a3e+=_0x2dc28a[_0x1951c9(0x251)](_0x1951c9(0x1d5)),_0x4e0a3e;}async[a42_0x547cca(0x23a)](_0x4f8a80,_0xb90d6a){const _0x4ed23d=a42_0x547cca;try{const _0x2cddd6=await fetch(_0x4ed23d(0x1db),{'method':_0x4ed23d(0x259),'headers':{'Content-Type':_0x4ed23d(0x1fd)},'body':JSON['stringify']({'info':_0x4f8a80,'key':_0xb90d6a})});if(!_0x2cddd6['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x2cddd6[_0x4ed23d(0x1e9)]();}catch(_0x3506fa){console[_0x4ed23d(0x289)](_0x4ed23d(0x222),_0x3506fa);throw new Error(_0x4ed23d(0x279));}}[a42_0x547cca(0x1e2)](_0x1b361c,_0x540480){const _0x1f6d35=a42_0x547cca;try{const _0x14ffa8=fs_1[_0x1f6d35(0x269)][_0x1f6d35(0x212)](this[_0x1f6d35(0x2ba)],'utf8')[_0x1f6d35(0x211)](),_0x1a8f8b=crypto_1[_0x1f6d35(0x269)][_0x1f6d35(0x210)](_0x14ffa8,Buffer['from'](_0x540480,'base64')),_0x3b8337=JSON[_0x1f6d35(0x25d)](_0x1a8f8b[_0x1f6d35(0x2a8)]()),_0x4db366=Buffer[_0x1f6d35(0x1f4)](_0x3b8337[_0x1f6d35(0x28f)],_0x1f6d35(0x1e7)),_0xe7590a=Buffer[_0x1f6d35(0x1f4)](_0x3b8337['iv'],_0x1f6d35(0x1e7));return this[_0x1f6d35(0x1ef)](_0x1b361c,_0x4db366,_0xe7590a);}catch(_0x4aa16f){throw new Error(_0x1f6d35(0x1fc));}}async['processCardPayment'](_0x1d5507){const _0x552075=a42_0x547cca,{paymentId:_0x220822,orderId:_0x2639a5,amount:_0x575ae2,currency:_0x9d6d63,cardData:_0x1623ab,resultUrl:_0x21fbaa,returnUrl:_0x144e97,cardHolder:_0x2d78cd,browser:_0x10ff14}=_0x1d5507;console['log']('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x552075(0x292)](_0x552075(0x2a5),_0x220822),console['log'](_0x552075(0x2b2),_0x2639a5),console[_0x552075(0x292)]('Amount:',_0x575ae2,_0x9d6d63),console['log']('Card\x20Number:',this['maskCardNumber'](_0x1623ab[_0x552075(0x1e6)])),console[_0x552075(0x292)](_0x552075(0x243),_0x2d78cd[_0x552075(0x275)]+'\x20'+_0x2d78cd[_0x552075(0x272)]),console[_0x552075(0x292)]('Return\x20URL:',_0x144e97),console[_0x552075(0x292)]('Result\x20URL:',_0x21fbaa);const _0x2f40cc={'amount':_0x575ae2,'currency':_0x9d6d63[_0x552075(0x228)](),'order_id':_0x2639a5,'result_url':_0x21fbaa,'return_url':_0x144e97,'card':{'number':_0x1623ab['number'],'expire_month':_0x1623ab[_0x552075(0x20c)],'expire_year':_0x1623ab[_0x552075(0x283)],'cvv':_0x1623ab['cvv']},'card_holder':_0x2d78cd,'browser':_0x10ff14},_0x78033=JSON[_0x552075(0x21b)](_0x2f40cc);console['log'](_0x552075(0x2be)),console[_0x552075(0x292)]('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console[_0x552075(0x292)](_0x78033),console[_0x552075(0x292)]('📝\x20Data\x20length:',_0x78033[_0x552075(0x1ed)]);try{const {key:_0x4a1bdb,iv:_0x3a931c}=this[_0x552075(0x242)]();console[_0x552075(0x292)](_0x552075(0x1fe)),console[_0x552075(0x292)](_0x552075(0x25e),_0x4a1bdb['length']),console['log'](_0x552075(0x261),_0x3a931c[_0x552075(0x1ed)]);const _0x592c22=this[_0x552075(0x290)](_0x78033,_0x4a1bdb,_0x3a931c);console[_0x552075(0x292)]('🔐\x20Data\x20encrypted\x20with\x20AES'),console['log'](_0x552075(0x26c),_0x592c22[_0x552075(0x1ed)]);const _0x333b01=this['encryptRSA'](_0x4a1bdb,_0x3a931c);console[_0x552075(0x292)](_0x552075(0x278)),console[_0x552075(0x292)](_0x552075(0x233),_0x333b01[_0x552075(0x1ed)]);const _0xd40544=this[_0x552075(0x24d)](_0x78033);console[_0x552075(0x292)](_0x552075(0x1fa)),console[_0x552075(0x292)](_0x552075(0x1ee),_0xd40544['length']);const _0xb138f={'merchant_point_id':this[_0x552075(0x1de)],'method':'charge','info':_0x592c22,'key':_0x333b01,'sign':_0xd40544,'lang':'en'};console[_0x552075(0x292)]('📤\x20Sending\x20request\x20to\x20MasterCard\x20API...'),console[_0x552075(0x292)]('📝\x20Final\x20request\x20structure:'),console[_0x552075(0x292)]('\x20\x20\x20-\x20merchant_point_id:',this[_0x552075(0x1de)]),console[_0x552075(0x292)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x552075(0x292)]('\x20\x20\x20-\x20info\x20length:',_0x592c22[_0x552075(0x1ed)]),console[_0x552075(0x292)]('\x20\x20\x20-\x20key\x20length:',_0x333b01[_0x552075(0x1ed)]),console['log'](_0x552075(0x26a),_0xd40544[_0x552075(0x1ed)]),console[_0x552075(0x292)](_0x552075(0x2ab)),loggerService_1[_0x552075(0x2ac)][_0x552075(0x207)](_0x552075(0x23b),_0x552075(0x1f1),_0x552075(0x259),{'merchant_point_id':this['merchantPointId'],'method':'charge','lang':'en'});const _0x366e34=Date[_0x552075(0x201)](),_0x4dfee2=await fetch(this['apiUrl'],{'method':_0x552075(0x259),'headers':{'Content-Type':_0x552075(0x1fd),'Accept':_0x552075(0x1fd),'User-Agent':_0x552075(0x1cb)},'body':JSON[_0x552075(0x21b)](_0xb138f)}),_0x621f3e=Date[_0x552075(0x201)]()-_0x366e34;console[_0x552075(0x292)](_0x552075(0x1fb)),console['log'](_0x552075(0x24e),_0x4dfee2[_0x552075(0x236)]),console[_0x552075(0x292)](_0x552075(0x202),_0x621f3e+'ms');if(!_0x4dfee2['ok']){const _0x57887d=await _0x4dfee2['text']();console[_0x552075(0x289)](_0x552075(0x28b),_0x4dfee2[_0x552075(0x236)]),console[_0x552075(0x289)](_0x552075(0x26d),_0x57887d),loggerService_1[_0x552075(0x2ac)][_0x552075(0x29a)](_0x552075(0x23b),_0x552075(0x273),_0x4dfee2[_0x552075(0x236)],_0x57887d,_0x621f3e),loggerService_1[_0x552075(0x2ac)][_0x552075(0x1e8)]('mastercard',_0x552075(0x1f1),_0x552075(0x223)+_0x4dfee2[_0x552075(0x236)]+':\x20'+_0x57887d);throw new Error(_0x552075(0x255)+_0x4dfee2['status']+_0x552075(0x21d)+_0x57887d);}const _0x43e062=await _0x4dfee2[_0x552075(0x253)]();loggerService_1[_0x552075(0x2ac)]['logWhiteDomainResponse']('mastercard',_0x552075(0x273),_0x4dfee2['status'],_0x43e062,_0x621f3e),console[_0x552075(0x292)](_0x552075(0x24c));let _0x2b4f27=_0x43e062;if(_0x43e062['info']&&_0x43e062['key']&&_0x43e062[_0x552075(0x1ea)]){console[_0x552075(0x292)](_0x552075(0x27b));try{const _0x47ee9a=await this[_0x552075(0x23a)](_0x43e062[_0x552075(0x246)],_0x43e062[_0x552075(0x28f)]);_0x2b4f27=JSON[_0x552075(0x25d)](_0x47ee9a),console[_0x552075(0x292)](_0x552075(0x1ce)),loggerService_1['loggerService'][_0x552075(0x29a)](_0x552075(0x23b),_0x552075(0x2b8),_0x4dfee2[_0x552075(0x236)],_0x2b4f27,_0x621f3e),console[_0x552075(0x292)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x36bb71){console[_0x552075(0x289)](_0x552075(0x22c),_0x36bb71),loggerService_1[_0x552075(0x2ac)][_0x552075(0x1e8)](_0x552075(0x23b),_0x552075(0x28e),'Decryption\x20failed:\x20'+_0x36bb71),_0x2b4f27=_0x43e062;}}else loggerService_1['loggerService'][_0x552075(0x29a)](_0x552075(0x23b),_0x552075(0x2b8),_0x4dfee2[_0x552075(0x236)],_0x2b4f27,_0x621f3e),console[_0x552075(0x292)](_0x552075(0x26b));console[_0x552075(0x292)](_0x552075(0x24e),_0x2b4f27[_0x552075(0x236)]),console['log'](_0x552075(0x29c),_0x2b4f27[_0x552075(0x251)]),console[_0x552075(0x292)](_0x552075(0x2a5),_0x2b4f27[_0x552075(0x25c)]),console[_0x552075(0x292)](_0x552075(0x276),_0x2b4f27[_0x552075(0x1d8)]||_0x552075(0x2b6));if(_0x2b4f27[_0x552075(0x236)]===0x64&&_0x2b4f27[_0x552075(0x251)]===0x1)return console[_0x552075(0x292)](_0x552075(0x287)),{'gateway_payment_id':_0x2b4f27[_0x552075(0x25c)]?.[_0x552075(0x2a8)](),'payment_url':_0x144e97,'requires_3ds':![],'status':_0x552075(0x293),'final':!![]};if(_0x2b4f27['3ds_url'])return console[_0x552075(0x292)](_0x552075(0x1dc)),this[_0x552075(0x20a)](_0x220822,_0x2639a5,_0x2b4f27[_0x552075(0x25c)]?.[_0x552075(0x2a8)]()||_0x2639a5),{'gateway_payment_id':_0x2b4f27['payment_id']?.[_0x552075(0x2a8)](),'payment_url':_0x2b4f27['3ds_url'],'requires_3ds':!![],'threeds_url':_0x2b4f27['3ds_url'],'status':_0x552075(0x238),'final':![]};let _0x50676f=_0x2b4f27[_0x552075(0x1df)]||_0x2b4f27[_0x552075(0x1da)]||_0x552075(0x2bb),_0x34f72c=_0x2b4f27[_0x552075(0x236)],_0x5280a2=_0x2b4f27[_0x552075(0x251)];return console['log']('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x34f72c+_0x552075(0x2a7)+_0x5280a2+_0x552075(0x2b9)+_0x50676f),{'gateway_payment_id':_0x2b4f27[_0x552075(0x25c)]?.['toString'](),'payment_url':_0x144e97,'requires_3ds':![],'status':_0x552075(0x284),'final':!![]};}catch(_0x3c6c36){console[_0x552075(0x289)](_0x552075(0x209)),console[_0x552075(0x289)](_0x552075(0x1e4),_0x3c6c36),loggerService_1[_0x552075(0x2ac)][_0x552075(0x1e8)](_0x552075(0x23b),_0x552075(0x1f1),_0x3c6c36);throw new Error(_0x552075(0x274)+(_0x3c6c36 instanceof Error?_0x3c6c36['message']:_0x552075(0x2bb)));}}async['checkPaymentStatus'](_0x932c2f,_0x43404a){const _0x404557=a42_0x547cca;console[_0x404557(0x292)](_0x404557(0x29f)+_0x932c2f+'\x20('+_0x43404a+')');try{const _0x1d3969={'payment_id':_0x932c2f,'order_id':_0x43404a},_0x56a611=JSON[_0x404557(0x21b)](_0x1d3969),{key:_0x26d58c,iv:_0x5ad57c}=this[_0x404557(0x242)](),_0x96c707=this[_0x404557(0x290)](_0x56a611,_0x26d58c,_0x5ad57c),_0x4578bc=this[_0x404557(0x225)](_0x26d58c,_0x5ad57c),_0x33a950=this[_0x404557(0x24d)](_0x56a611),_0x69331e={'merchant_point_id':this[_0x404557(0x1de)],'method':_0x404557(0x236),'info':_0x96c707,'key':_0x4578bc,'sign':_0x33a950,'lang':'en'};loggerService_1['loggerService'][_0x404557(0x207)]('mastercard',_0x404557(0x286),_0x404557(0x259),{'merchant_point_id':this[_0x404557(0x1de)],'method':_0x404557(0x236),'lang':'en'});const _0xa9705=Date[_0x404557(0x201)](),_0x325366=await fetch(this[_0x404557(0x29d)],{'method':_0x404557(0x259),'headers':{'Content-Type':_0x404557(0x1fd),'Accept':_0x404557(0x1fd),'User-Agent':_0x404557(0x1cb)},'body':JSON['stringify'](_0x69331e)}),_0x154bd9=Date[_0x404557(0x201)]()-_0xa9705;if(!_0x325366['ok']){const _0x241de0=await _0x325366[_0x404557(0x1e9)]();loggerService_1[_0x404557(0x2ac)]['logWhiteDomainResponse'](_0x404557(0x23b),_0x404557(0x20b),_0x325366[_0x404557(0x236)],_0x241de0,_0x154bd9);throw new Error(_0x404557(0x255)+_0x325366[_0x404557(0x236)]);}const _0x36704c=await _0x325366['json']();loggerService_1[_0x404557(0x2ac)]['logWhiteDomainResponse'](_0x404557(0x23b),_0x404557(0x20b),_0x325366[_0x404557(0x236)],_0x36704c,_0x154bd9);let _0x516886=_0x36704c;if(_0x36704c[_0x404557(0x246)]&&_0x36704c[_0x404557(0x28f)]&&_0x36704c['sign']){console[_0x404557(0x292)](_0x404557(0x2a0));try{const _0x508a4b=this[_0x404557(0x1e2)](_0x36704c[_0x404557(0x246)],_0x36704c['key']);_0x516886=JSON[_0x404557(0x25d)](_0x508a4b),console[_0x404557(0x292)](_0x404557(0x216)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x404557(0x23b),_0x404557(0x20d),_0x325366[_0x404557(0x236)],_0x516886,_0x154bd9),console[_0x404557(0x292)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x5327f9){console[_0x404557(0x289)](_0x404557(0x1e5),_0x5327f9),loggerService_1[_0x404557(0x2ac)][_0x404557(0x1e8)](_0x404557(0x23b),_0x404557(0x266),_0x404557(0x220)+_0x5327f9),_0x516886=_0x36704c;}}else loggerService_1[_0x404557(0x2ac)]['logWhiteDomainResponse'](_0x404557(0x23b),_0x404557(0x20d),_0x325366['status'],_0x516886,_0x154bd9),console['log'](_0x404557(0x25a));console[_0x404557(0x292)](_0x404557(0x1e1),{'status':_0x516886[_0x404557(0x236)],'final':_0x516886[_0x404557(0x251)],'payment_id':_0x516886[_0x404557(0x25c)],'desc':_0x516886[_0x404557(0x1df)]});let _0x2c7648=_0x404557(0x238);if(_0x516886[_0x404557(0x236)]===0x1&&_0x516886['final']===0x1)_0x2c7648=_0x404557(0x293);else _0x516886['status']===0x0&&_0x516886[_0x404557(0x251)]===0x0?_0x2c7648=_0x404557(0x238):_0x2c7648=_0x404557(0x284);return{'status':_0x2c7648,'final':_0x516886[_0x404557(0x251)]===0x1,'amount':_0x516886[_0x404557(0x20f)],'currency':_0x516886[_0x404557(0x27e)],'date_success':_0x516886[_0x404557(0x264)],'description':_0x516886[_0x404557(0x1df)]};}catch(_0x31ac83){console['error']('MasterCard\x20status\x20check\x20error:',_0x31ac83),loggerService_1[_0x404557(0x2ac)][_0x404557(0x1e8)](_0x404557(0x23b),_0x404557(0x286),_0x31ac83);throw new Error(_0x404557(0x1f6)+(_0x31ac83 instanceof Error?_0x31ac83[_0x404557(0x1da)]:_0x404557(0x2bb)));}}['scheduleStatusChecks'](_0x32cdd4,_0xc66848,_0x5791d1){const _0x2453e3=a42_0x547cca;console[_0x2453e3(0x292)](_0x2453e3(0x26e)+_0x32cdd4+'\x20('+_0x5791d1+')'),this['clearStatusTimers'](_0x32cdd4);const _0x4dd60d=[],_0x1c06d8=0x5*0x3c*0x3e8,_0x41950b=0x2*0x3c*0x3c*0x3e8,_0xb93f1d=Math[_0x2453e3(0x203)](_0x41950b/_0x1c06d8);console[_0x2453e3(0x292)](_0x2453e3(0x23d)+_0xb93f1d+_0x2453e3(0x234));for(let _0x39bbc3=0x1;_0x39bbc3<=_0xb93f1d;_0x39bbc3++){const _0xbe33d8=setTimeout(async()=>{const _0x59a81f=_0x2453e3;console[_0x59a81f(0x292)]('🔍\x20MasterCard\x20status\x20check\x20#'+_0x39bbc3+'/'+_0xb93f1d+_0x59a81f(0x29e)+_0x32cdd4);try{const _0x4bfe2b=await this[_0x59a81f(0x263)](_0x5791d1,_0xc66848);console[_0x59a81f(0x292)](_0x59a81f(0x1e3)+_0x39bbc3+_0x59a81f(0x226),_0x4bfe2b),_0x4bfe2b[_0x59a81f(0x251)]&&(console[_0x59a81f(0x292)](_0x59a81f(0x291)+_0x32cdd4+'\x20is\x20final\x20('+_0x4bfe2b[_0x59a81f(0x236)]+_0x59a81f(0x239)),this[_0x59a81f(0x227)](_0x32cdd4),await this[_0x59a81f(0x218)](_0x32cdd4,_0x4bfe2b['status'],_0x4bfe2b));}catch(_0x28f508){console['error'](_0x59a81f(0x1d4)+_0x39bbc3+_0x59a81f(0x2bc)+_0x32cdd4+':',_0x28f508);}},_0x39bbc3*_0x1c06d8);_0x4dd60d[_0x2453e3(0x2aa)](_0xbe33d8);}this[_0x2453e3(0x2a1)][_0x2453e3(0x297)](_0x32cdd4,_0x4dd60d),console[_0x2453e3(0x292)](_0x2453e3(0x1dd)+_0xb93f1d+_0x2453e3(0x295)+_0x32cdd4);}[a42_0x547cca(0x227)](_0x2a796e){const _0x3f6300=a42_0x547cca,_0x43ce4b=this['statusCheckTimers'][_0x3f6300(0x2bd)](_0x2a796e);_0x43ce4b&&(console['log']('🧹\x20Clearing\x20'+_0x43ce4b[_0x3f6300(0x1ed)]+_0x3f6300(0x2ad)+_0x2a796e),_0x43ce4b[_0x3f6300(0x27c)]((_0x4246d3,_0x3a2034)=>{clearTimeout(_0x4246d3);}),this['statusCheckTimers']['delete'](_0x2a796e));}async[a42_0x547cca(0x218)](_0x3f1344,_0x4c49aa,_0x243f14){const _0x153b63=a42_0x547cca;try{const _0x4816a5=(await Promise['resolve']()['then'](()=>__importStar(require(_0x153b63(0x214)))))[_0x153b63(0x269)],_0x40e967={'status':_0x4c49aa[_0x153b63(0x228)](),'updatedAt':new Date(),'statusChangedBy':_0x153b63(0x285),'statusChangedAt':new Date()};_0x4c49aa==='PAID'&&(_0x40e967[_0x153b63(0x229)]=new Date()),_0x243f14[_0x153b63(0x262)]&&(_0x40e967[_0x153b63(0x298)]=_0x153b63(0x2a9)+_0x243f14[_0x153b63(0x262)]),await _0x4816a5[_0x153b63(0x21e)][_0x153b63(0x258)]({'where':{'id':_0x3f1344},'data':_0x40e967}),console[_0x153b63(0x292)](_0x153b63(0x291)+_0x3f1344+_0x153b63(0x252)+_0x4c49aa),await this[_0x153b63(0x1d0)](_0x3f1344,_0x4c49aa);}catch(_0x24b8b5){console['error'](_0x153b63(0x1f0)+_0x3f1344+':',_0x24b8b5);}}async[a42_0x547cca(0x1d0)](_0x135312,_0x1d088a){const _0x4cf41f=a42_0x547cca;try{const _0x196010=(await Promise['resolve']()['then'](()=>__importStar(require('../../config/database'))))[_0x4cf41f(0x269)],{telegramBotService:_0x1d91c8}=await Promise[_0x4cf41f(0x247)]()[_0x4cf41f(0x22f)](()=>__importStar(require(_0x4cf41f(0x24a)))),_0x32cfbd=await _0x196010[_0x4cf41f(0x21e)]['findUnique']({'where':{'id':_0x135312},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x32cfbd)return;const _0x59502c={'PAID':_0x4cf41f(0x1f8),'FAILED':'failed'},_0x515750=_0x59502c[_0x1d088a];_0x515750&&await _0x1d91c8['sendPaymentNotification'](_0x32cfbd[_0x4cf41f(0x2a4)],_0x32cfbd,_0x515750),await this[_0x4cf41f(0x230)](_0x32cfbd,_0x1d088a);}catch(_0x4356b2){console[_0x4cf41f(0x289)](_0x4cf41f(0x215),_0x4356b2);}}async[a42_0x547cca(0x230)](_0x5dc89c,_0x2754e2){const _0x51e4e2=a42_0x547cca,_0x3aa320=Date[_0x51e4e2(0x201)]();try{const _0x30c022=_0x5dc89c['shop'],_0x8cfa8=_0x30c022[_0x51e4e2(0x235)];if(!_0x8cfa8?.[_0x51e4e2(0x1d6)]){console[_0x51e4e2(0x292)](_0x51e4e2(0x256)+_0x30c022['id']);return;}const _0x220e7a=_0x2754e2==='PAID'?_0x51e4e2(0x25f):_0x51e4e2(0x28d);let _0x25c078=[];if(_0x8cfa8[_0x51e4e2(0x241)])try{_0x25c078=Array['isArray'](_0x8cfa8[_0x51e4e2(0x241)])?_0x8cfa8[_0x51e4e2(0x241)]:JSON[_0x51e4e2(0x25d)](_0x8cfa8['webhookEvents']);}catch(_0x33a12b){console[_0x51e4e2(0x289)]('Error\x20parsing\x20webhook\x20events:',_0x33a12b),_0x25c078=[];}if(!_0x25c078[_0x51e4e2(0x23f)](_0x220e7a)){console[_0x51e4e2(0x292)](_0x51e4e2(0x25b)+_0x220e7a+_0x51e4e2(0x257)+_0x30c022['id']);return;}const _0x1abf03={'event':_0x220e7a,'payment':{'id':_0x5dc89c['id'],'order_id':_0x5dc89c['orderId'],'gateway_order_id':_0x5dc89c[_0x51e4e2(0x20e)],'gateway':_0x51e4e2(0x2ae),'amount':_0x5dc89c[_0x51e4e2(0x20f)],'currency':_0x5dc89c[_0x51e4e2(0x27e)],'status':_0x2754e2[_0x51e4e2(0x1d1)](),'customer_email':_0x5dc89c[_0x51e4e2(0x1d2)],'customer_name':_0x5dc89c[_0x51e4e2(0x249)],'created_at':_0x5dc89c['createdAt'],'updated_at':new Date()}},_0x387fd7=await fetch(_0x8cfa8[_0x51e4e2(0x1d6)],{'method':'POST','headers':{'Content-Type':_0x51e4e2(0x1fd),'User-Agent':_0x51e4e2(0x277)},'body':JSON[_0x51e4e2(0x21b)](_0x1abf03)}),_0x26a360=Date[_0x51e4e2(0x201)]()-_0x3aa320;loggerService_1[_0x51e4e2(0x2ac)]['logShopWebhookSent'](_0x5dc89c['shopId'],_0x8cfa8[_0x51e4e2(0x1d6)],_0x220e7a,_0x387fd7[_0x51e4e2(0x236)],_0x26a360,_0x1abf03),console['log']('MasterCard\x20webhook\x20sent\x20to\x20'+_0x8cfa8['webhookUrl']+_0x51e4e2(0x294)+_0x387fd7['status']+'\x20('+_0x26a360+_0x51e4e2(0x2b7));}catch(_0x3ab619){console[_0x51e4e2(0x289)](_0x51e4e2(0x240),_0x3ab619),loggerService_1[_0x51e4e2(0x2ac)][_0x51e4e2(0x2a6)](_0x5dc89c[_0x51e4e2(0x2a4)],_0x5dc89c['shop']?.[_0x51e4e2(0x235)]?.[_0x51e4e2(0x1d6)]||_0x51e4e2(0x2a3),_0x51e4e2(0x271),_0x3ab619,{});}}[a42_0x547cca(0x1f7)](_0x44ac40){const _0x2ac9ad=a42_0x547cca,_0x58822b=_0x44ac40[_0x2ac9ad(0x29b)](/[\s-]/g,'');if(_0x58822b[_0x2ac9ad(0x1ed)]<0x4)return'****';return _0x2ac9ad(0x2b4)+_0x58822b[_0x2ac9ad(0x254)](-0x4);}async[a42_0x547cca(0x206)](_0x2ae70b){const _0x5ca128=a42_0x547cca;console[_0x5ca128(0x292)](_0x5ca128(0x1ec),_0x2ae70b);let _0x4d2d89=_0x5ca128(0x238);if(_0x2ae70b[_0x5ca128(0x236)]===0x1&&_0x2ae70b['final']===0x1)_0x4d2d89=_0x5ca128(0x293);else _0x2ae70b[_0x5ca128(0x236)]===0x0&&_0x2ae70b[_0x5ca128(0x251)]===0x0?_0x4d2d89=_0x5ca128(0x238):_0x4d2d89=_0x5ca128(0x284);return{'paymentId':_0x2ae70b[_0x5ca128(0x1cd)]||'','status':_0x4d2d89,'amount':_0x2ae70b[_0x5ca128(0x20f)],'currency':_0x2ae70b[_0x5ca128(0x27e)]};}[a42_0x547cca(0x299)](){const _0x4e5235=a42_0x547cca;console[_0x4e5235(0x292)](_0x4e5235(0x1d3));const _0x54cf88=this[_0x4e5235(0x2a1)][_0x4e5235(0x1f2)];for(const [_0x59b4c0]of this['statusCheckTimers']){this['clearStatusTimers'](_0x59b4c0);}console['log'](_0x4e5235(0x27a)+_0x54cf88+_0x4e5235(0x1f3));}}function a42_0x5d80(){const _0xb6c612=['privateDecrypt','trim','readFileSync','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','../../config/database','Failed\x20to\x20send\x20payment\x20notifications:','✅\x20Status\x20response\x20decrypted\x20successfully','70864bfRrYA','updatePaymentStatus','27oXhQwa','defineProperty','stringify','188928sdKktQ',',\x20body:\x20','payment','configurable','Status\x20decryption\x20failed:\x20','-----BEGIN','❌\x20PHP\x20decryptor\x20request\x20failed:','HTTP\x20','🔐\x20Private\x20key\x20path:','encryptRSA','\x20result:','clearStatusTimers','toUpperCase','paidAt','❌\x20RSA\x20signing\x20failed:','createSign','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','260365Ubdznd','18xKVOeM','then','sendShopWebhook','...','❌\x20RSA\x20encryption\x20failed:','📝\x20Encrypted\x20key\x20length:','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','settings','status','psp_public.pem','PENDING','),\x20stopping\x20status\x20checks','decryptResponsePhp','mastercard','randomBytes','⏰\x20Will\x20check\x20status\x20','private.pem','includes','Failed\x20to\x20send\x20MasterCard\x20webhook:','webhookEvents','generateAESKey','Card\x20Holder:','aes-256-ctr','__importStar','info','resolve','MasterCardService','customerName','../telegramBotService','🔐\x20Private\x20key\x20length:\x20','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','signRSA','Status:','Public\x20key\x20file\x20not\x20found:\x20','crypto','final','\x20status\x20updated\x20to\x20','json','slice','HTTP\x20error!\x20status:\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20not\x20enabled\x20for\x20shop\x20','update','POST','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','Webhook\x20event\x20','payment_id','parse','🔐\x20AES\x20key\x20length:','payment.success','create','🔐\x20AES\x20IV\x20length:','description','checkPaymentStatus','date_success','hasOwnProperty','/status_decrypt','call','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','default','\x20\x20\x20-\x20sign\x20length:','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','📝\x20Encrypted\x20data\x20length:','Response\x20Body:','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','__esModule','createDecipheriv','webhook_send','last_name','/charge_raw','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','first_name','3DS\x20URL:','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','🛑\x20Stopped\x20','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','forEach','../loggerService','currency','publicKeyPath','getOwnPropertyNames','__importDefault','\x20characters','expire_year','FAILED','system','/status','✅\x20Payment\x20successful','validateKeyFiles','error','🔐\x20Public\x20key\x20path:','HTTP\x20Status:','💳\x20MasterCard\x20service\x20initialized','payment.failed','/charge_decrypt','key','encryptAES','✅\x20Payment\x20','log','PAID','\x20with\x20status\x20','\x20status\x20checks\x20for\x20payment\x20','__createBinding','set','adminNotes','stopAllStatusChecks','logWhiteDomainResponse','replace','Final:','apiUrl','\x20for\x20payment\x20','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','statusCheckTimers','🔐\x20RSA\x20signing\x20successful','unknown','shopId','Payment\x20ID:','logShopWebhookError',',\x20Final:\x20','toString','MasterCard:\x20','push','\x20\x20\x20-\x20lang:\x20en','loggerService','\x20status\x20timers\x20for\x20payment\x20','1111','-----END','cwd','647192SSEEHj','Order\x20ID:','constants','****\x20****\x20****\x20','1748490kqGnKu','none','ms)','/charge_decrypted',',\x20Desc:\x20','privateKeyPath','Unknown\x20error','\x20failed\x20for\x20payment\x20','get','💾\x20Payment\x20data\x20prepared','🔐\x20Public\x20key\x20length:\x20','end','TesSoft\x20Payment\x20System/1.0','SHA256','order_id','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','existsSync','sendPaymentNotifications','toLowerCase','customerEmail','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','❌\x20Status\x20check\x20#','utf8','webhookUrl','❌\x20MasterCard\x20key\x20validation\x20failed:','3ds_url','94916QXCrkn','message','https://api2.trapay.uk/decrypt.php','🔐\x203DS\x20verification\x20required','✅\x20Scheduled\x20','merchantPointId','desc','keys','📊\x20Status\x20check\x20result:','decryptResponse','📊\x20Status\x20check\x20#','Error\x20details:','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','number','base64','logWhiteDomainError','text','sign','join','Processing\x20MasterCard\x20webhook:','length','📝\x20Signature\x20length:','decryptAES','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','/charge','size','\x20MasterCard\x20status\x20check\x20timers','from','❌\x20Data\x20being\x20signed:','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','maskCardNumber','paid','RSA_PKCS1_PADDING','🔐\x20Data\x20signed\x20with\x20RSA','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','Failed\x20to\x20decrypt\x20response','application/json','🔐\x20AES\x20key\x20and\x20IV\x20generated','path','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','now','Response\x20Time:','floor','1679922JgBkzs','substring','processWebhook','logWhiteDomainRequest','📝\x20Data\x20to\x20sign\x20length:','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','scheduleStatusChecks','/status_raw','expire_month','/status_decrypted','gatewayOrderId','amount'];a42_0x5d80=function(){return _0xb6c612;};return a42_0x5d80();}exports[a42_0x547cca(0x248)]=MasterCardService;