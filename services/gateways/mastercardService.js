'use strict';const a51_0x44004b=a51_0x4de0;(function(_0x5dc74b,_0x3717f4){const _0x37c83e=a51_0x4de0,_0x2fe160=_0x5dc74b();while(!![]){try{const _0x5a5633=parseInt(_0x37c83e(0x229))/0x1+parseInt(_0x37c83e(0x2eb))/0x2*(-parseInt(_0x37c83e(0x1e1))/0x3)+parseInt(_0x37c83e(0x218))/0x4+parseInt(_0x37c83e(0x1e4))/0x5+-parseInt(_0x37c83e(0x1f8))/0x6*(-parseInt(_0x37c83e(0x2b7))/0x7)+parseInt(_0x37c83e(0x320))/0x8*(parseInt(_0x37c83e(0x2f6))/0x9)+-parseInt(_0x37c83e(0x2a4))/0xa;if(_0x5a5633===_0x3717f4)break;else _0x2fe160['push'](_0x2fe160['shift']());}catch(_0x5ce99a){_0x2fe160['push'](_0x2fe160['shift']());}}}(a51_0x29e4,0x3459d));function a51_0x29e4(){const _0xe9a820=['paidAt','RSA_PKCS1_PADDING','POST','Payment\x20cancellation\x20is\x20being\x20processed','VisaMasterCardService','\x20(from:\x20status=','Status\x20decryption\x20failed:\x20','🔐\x20VISA\x20Public\x20key\x20length:\x20','===\x20API\x20RESPONSE\x20===','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','VISA','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','❌\x20RSA\x20signing\x20failed:','randomBytes','payment_id','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','charge','🔐\x20VISA\x20Private\x20key\x20length:\x20','Awaiting\x20confirmation\x20in\x20the\x20application','Card\x20Holder:','loggerService','5000000000000000','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','warn','isFinalStatus',',\x20id=','Amount:','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','\x20result:','Another\x20unknown\x20error','\x20status\x20updated\x20to\x20','80brisez','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','Unknown\x20error','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','sendPaymentNotification','visaApiUrl','processCardPayment','\x20API:\x20','defineProperty','===\x20PARSED\x20API\x20RESPONSE\x20===','Payment\x20confirmation\x20time\x20has\x20expired','🔐\x20MasterCard\x20Public\x20key\x20path:','\x20\x20\x20Currency:\x20','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','settings','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','none','✅\x20Scheduled\x20','Payment\x20prohibited','🧹\x20Clearing\x20','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','privateDecrypt','join','\x20not\x20enabled\x20for\x20shop\x20','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','scheduleStatusChecks','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','VISA/MasterCard','writable','PHP\x20decryptor\x20error','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','message','__setModuleDefault','webhookEvents','signRSA','Payment\x20ID:','hasOwnProperty','198093EGwISK','\x20order_id\x20for\x20search:\x20','SHA256','562140eqiwbM','\x20(from:\x20order_id=','Sender\x20information\x20required','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','❌\x20Status\x20check\x20#','logWhiteDomainError','orderId','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','floor','set','default','🔍\x20Using\x20provided\x20card\x20type:\x20','1111','masterCardMerchantPointId','encryptRSA','Expected\x20bitcoin\x20transfer\x20from\x20client','\x20\x20\x20Status:\x20','\x22\x20|\x20\x22','existsSync','Failed\x20to\x20check\x20','18VbqUit','base64','__importDefault','cardType','__createBinding','includes','failureMessage','/status','toString','Payment\x20System/1.0\x20(MasterCard)','MASTERCARD','🔐\x20MasterCard\x20API\x20URL:','\x20failed\x20for\x20payment\x20','adminNotes','****\x20****\x20****\x20','Cash\x20payment\x20is\x20expected\x20at\x20TCO','update','Awaiting\x20confirmation\x20by\x20ivr\x20call','🔐\x20RSA\x20signing\x20successful','HTTP\x20Status:','amount','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','__importStar','checkPaymentStatus','configurable','paid','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited',',\x20body:\x20','card_type','Invalid\x20expiration\x20date','742952QHIClT','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','customerName','clearStatusTimers','payment.failed','PENDING','\x20\x20\x20-\x20lang:\x20en','Payment\x20is\x20being\x20processed','Decryption\x20failed:\x20','visa_public.pem','privateKeyPath','psp_public.pem','parse','readFileSync','json','\x20MasterCard\x20status\x20check\x20timers','Payment\x20pending\x20verification','244620LThUFF','error','),\x20stopping\x20status\x20checks','📝\x20Final\x20request\x20structure:','shop','No\x20New\x20payment','order_id','findUnique',',\x20payment_id=','Response\x20Time:','getDetailedErrorMessage','📝\x20Decrypted\x20webhook\x20data:','\x20characters','Recipient\x20data\x20required','errorMessage','📝\x20Signature\x20length:','encryptAES','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','key','\x20with\x20status\x20','3DS\x20URL:','decryptResponsePhp','💾\x20Saving\x20failure\x20message:\x20','paymentId','merchantPointId','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','sign','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','then','📊\x20','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','toLowerCase','now','ms)','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','Failed\x20to\x20decrypt\x20response','call','Order\x20ID:','path','The\x20card\x20does\x20not\x20exist','masterCardApiUrl','❌\x20Detailed\x20failure\x20description:\x20','visaMerchantPointId','Transaction\x20limit\x20exceeded','number','https://api2.trapay.uk/decrypt.php','getCardTypeAndApi','gatewayOrderId','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','cvv','****','Payment\x20System/1.0','isArray','\x20status\x20checks\x20for\x20payment\x20','from',',\x20final=','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','end','Test\x20payment','Number\x20of\x20attempts\x20exceeded','utf8','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','length','generateAESKey','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','🔐\x20AES\x20IV\x20length:','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','Failed\x20payment','⏰\x20Will\x20check\x20status\x20','📝\x20Encrypted\x20data\x20length:','system','push','processWebhook','Cancellation\x20is\x20not\x20possible','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','\x20\x20Original:\x20\x22','PAID','3DS\x20verification\x20required','\x20webhook\x20extracted\x20data:','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','statusCheckTimers','createDecipheriv','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','publicEncrypt','Captcha\x20confirmation\x20awaited','payment.success','validateKeyFiles','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','shopId','/status_decrypted','desc','Insufficient\x20funds\x20on\x20the\x20card','\x20status\x20check\x20#','\x20\x20\x20-\x20method:\x20charge','visa_private.pem','Failed\x20to\x20send\x20payment\x20notifications:','\x20payment:\x20','Error\x20parsing\x20webhook\x20events:','charAt','expire_year','status','),\x20defaulting\x20to\x20MasterCard','🔐\x20VISA\x20API\x20URL:','✅\x20VISA\x20key\x20files\x20validated\x20successfully','sendPaymentNotifications','/charge_decrypted','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','expire_month','logWhiteDomainResponse','Final:','Unsuccessful\x20payment','LookUp\x20number\x20of\x20attempts\x20exceeded','\x20\x20\x20Payment\x20ID:\x20','failed','✅\x20Status\x20response\x20decrypted\x20successfully','PIN\x20code\x20confirmation\x20awaited','-----END','🔐\x20AES\x20key\x20length:','log','8511360uqGUdZ','\x20payment_id\x20for\x20search:\x20','description','currency','\x20\x20\x20-\x20key\x20length:','keys','🔐\x20Data\x20encrypted\x20with\x20AES','decryptAES','maskCardNumber','apiUrl','\x20status\x20check\x20error:','Status\x20','final','resolve','✅\x20Payment\x20','toUpperCase','🔐\x20VISA\x20Public\x20key\x20path:','/charge_raw','VISA/MasterCard\x20payment\x20successful','919219PHNBOA','private.pem','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','⏰\x20Scheduling\x20status\x20checks\x20for\x20','substring','sendShopWebhook','application/json','Status:','__esModule','prototype','Return\x20URL:','stringify','/charge_decrypt','cwd','updatePaymentStatus','🔍\x20Using\x20','-----BEGIN','📝\x20Encrypted\x20key\x20length:','💳\x20VISA/MasterCard\x20service\x20initialized','forEach','3ds_url','/charge','🔐\x20Data\x20signed\x20with\x20RSA','publicKeyPath','❌\x20RSA\x20encryption\x20failed:','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','webhookUrl','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','📤\x20Sending\x20request\x20to\x20API...',',\x20Final:\x20','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','visaPublicKeyPath','4000000000000000','aes-256-ctr','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','../../config/database','Client\x20OTP\x20confirmation\x20required','date_success','\x20for\x20payment\x20','🔐\x203DS\x20verification\x20required','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','/status_decrypt','FAILED','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','No\x20Error\x20executing\x20request','replace','text','🔐\x20MasterCard\x20Private\x20key\x20path:','logShopWebhookError','info','last_name','📊\x20Status\x20check\x20result:','4MEwstv','trim','Card\x20Number:','getOwnPropertyDescriptor','https://api.paydmeth.com/api','Payment\x20returned','first_name','size','get','Failed\x20to\x20send\x20MasterCard\x20webhook:','🔐\x20AES\x20key\x20and\x20IV\x20generated','234801Ntcrot','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','payment','paymentStatuses','constants','visaPrivateKeyPath','stopAllStatusChecks','logWhiteDomainRequest','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted'];a51_0x29e4=function(){return _0xe9a820;};return a51_0x29e4();}var __createBinding=this&&this[a51_0x44004b(0x1fc)]||(Object['create']?function(_0x2522e1,_0x8a6b95,_0x5f1452,_0x15c118){const _0x337ca5=a51_0x44004b;if(_0x15c118===undefined)_0x15c118=_0x5f1452;var _0xb37551=Object[_0x337ca5(0x2ee)](_0x8a6b95,_0x5f1452);(!_0xb37551||(_0x337ca5(0x2f3)in _0xb37551?!_0x8a6b95[_0x337ca5(0x2bf)]:_0xb37551[_0x337ca5(0x1d8)]||_0xb37551[_0x337ca5(0x212)]))&&(_0xb37551={'enumerable':!![],'get':function(){return _0x8a6b95[_0x5f1452];}}),Object[_0x337ca5(0x328)](_0x2522e1,_0x15c118,_0xb37551);}:function(_0x401fe8,_0x2d42c8,_0x27b4c8,_0x4c2816){if(_0x4c2816===undefined)_0x4c2816=_0x27b4c8;_0x401fe8[_0x4c2816]=_0x2d42c8[_0x27b4c8];}),__setModuleDefault=this&&this[a51_0x44004b(0x1dc)]||(Object['create']?function(_0x422365,_0x37650b){const _0x28f645=a51_0x44004b;Object[_0x28f645(0x328)](_0x422365,_0x28f645(0x1ee),{'enumerable':!![],'value':_0x37650b});}:function(_0x3f0b67,_0x22367f){_0x3f0b67['default']=_0x22367f;}),__importStar=this&&this[a51_0x44004b(0x210)]||(function(){var _0x757de7=function(_0x492d2e){return _0x757de7=Object['getOwnPropertyNames']||function(_0x7eb0db){const _0x4ca4ef=a51_0x4de0;var _0x11848d=[];for(var _0x233b21 in _0x7eb0db)if(Object[_0x4ca4ef(0x2c0)][_0x4ca4ef(0x1e0)][_0x4ca4ef(0x24d)](_0x7eb0db,_0x233b21))_0x11848d[_0x11848d[_0x4ca4ef(0x268)]]=_0x233b21;return _0x11848d;},_0x757de7(_0x492d2e);};return function(_0x1eae68){const _0x1d709e=a51_0x4de0;if(_0x1eae68&&_0x1eae68[_0x1d709e(0x2bf)])return _0x1eae68;var _0x1be6e6={};if(_0x1eae68!=null){for(var _0x5ac224=_0x757de7(_0x1eae68),_0x2dd6a9=0x0;_0x2dd6a9<_0x5ac224['length'];_0x2dd6a9++)if(_0x5ac224[_0x2dd6a9]!==_0x1d709e(0x1ee))__createBinding(_0x1be6e6,_0x1eae68,_0x5ac224[_0x2dd6a9]);}return __setModuleDefault(_0x1be6e6,_0x1eae68),_0x1be6e6;};}()),__importDefault=this&&this[a51_0x44004b(0x1fa)]||function(_0x4b4767){const _0x331979=a51_0x44004b;return _0x4b4767&&_0x4b4767[_0x331979(0x2bf)]?_0x4b4767:{'default':_0x4b4767};};Object['defineProperty'](exports,a51_0x44004b(0x2bf),{'value':!![]}),exports[a51_0x44004b(0x303)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x44004b(0x24f))),loggerService_1=require('../loggerService');class VisaMasterCardService{constructor(){const _0x5745c3=a51_0x44004b;this[_0x5745c3(0x27c)]=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0x5745c3(0x22e)},0x1:{'final':![],'description':_0x5745c3(0x2e3)},0x2:{'final':!![],'description':'Request\x20data\x20error'},0x3:{'final':!![],'description':_0x5745c3(0x31e)},0x4:{'final':!![],'description':'Unsuccessful\x20payment'},0x5:{'final':!![],'description':_0x5745c3(0x330)},0x6:{'final':!![],'description':_0x5745c3(0x2f0)},0x7:{'final':!![],'description':_0x5745c3(0x263)},0x8:{'final':![],'description':_0x5745c3(0x2db)},0x9:{'final':![],'description':_0x5745c3(0x278)},0xa:{'final':![],'description':'Sender\x27s\x20CVV\x20card\x20is\x20required'},0xb:{'final':![],'description':_0x5745c3(0x1e6)},0xc:{'final':![],'description':_0x5745c3(0x236)},0xd:{'final':![],'description':'Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number'},0xe:{'final':![],'description':_0x5745c3(0x209)},0xf:{'final':![],'description':_0x5745c3(0x2a0)},0x10:{'final':![],'description':_0x5745c3(0x280)},0x11:{'final':![],'description':_0x5745c3(0x1da)},0x12:{'final':![],'description':_0x5745c3(0x312)},0x13:{'final':![],'description':_0x5745c3(0x21f)},0x14:{'final':![],'description':_0x5745c3(0x308)},0x15:{'final':![],'description':_0x5745c3(0x1f3)},0x16:{'final':![],'description':_0x5745c3(0x228)},0x18:{'final':![],'description':_0x5745c3(0x214)},0x19:{'final':![],'description':_0x5745c3(0x2d5)},0x1a:{'final':!![],'description':_0x5745c3(0x207)},0x1b:{'final':![],'description':_0x5745c3(0x259)},0x1c:{'final':![],'description':_0x5745c3(0x316)},0x1d:{'final':![],'description':_0x5745c3(0x1d6)},0x1f:{'final':![],'description':_0x5745c3(0x2df)},0x20:{'final':![],'description':_0x5745c3(0x2b9)},0x23:{'final':![],'description':'Sender\x27s\x20card\x20details\x20are\x20required'},0x24:{'final':!![],'description':_0x5745c3(0x32a)},0x25:{'final':!![],'description':_0x5745c3(0x333)},0x26:{'final':!![],'description':'The\x20payment\x20status\x20must\x20be\x20clarified\x20manually'},0x27:{'final':!![],'description':_0x5745c3(0x287)},0x28:{'final':!![],'description':_0x5745c3(0x250)},0x29:{'final':!![],'description':'The\x20card\x20is\x20lost\x20or\x20stolen'},0x2a:{'final':!![],'description':_0x5745c3(0x217)},0x2b:{'final':!![],'description':_0x5745c3(0x254)},0x2c:{'final':!![],'description':_0x5745c3(0x2d9)},0x2d:{'final':!![],'description':_0x5745c3(0x26e)},0x2e:{'final':!![],'description':'Unsuccessful\x20payment'},0x2f:{'final':!![],'description':_0x5745c3(0x29b)},0x30:{'final':!![],'description':_0x5745c3(0x275)},0x31:{'final':![],'description':'Payment\x20confirmation\x20required'},0x32:{'final':!![],'description':'Method\x20not\x20allowed'},0x33:{'final':!![],'description':_0x5745c3(0x26e)},0x34:{'final':!![],'description':_0x5745c3(0x26e)},0x35:{'final':!![],'description':_0x5745c3(0x26e)},0x36:{'final':!![],'description':_0x5745c3(0x26e)},0x37:{'final':!![],'description':'Failed\x20payment'},0x38:{'final':!![],'description':_0x5745c3(0x274)},0x39:{'final':![],'description':_0x5745c3(0x30f)},0x3a:{'final':![],'description':'LookUp\x20code\x20sent'},0x3b:{'final':!![],'description':'LookUp\x20code\x20verified'},0x3c:{'final':!![],'description':_0x5745c3(0x264)},0x3d:{'final':!![],'description':'Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible'},0x3e:{'final':!![],'description':_0x5745c3(0x1eb)},0x3f:{'final':!![],'description':_0x5745c3(0x2f0)},0x40:{'final':![],'description':'LookUp\x20not\x20confirmed'},0x41:{'final':!![],'description':_0x5745c3(0x29c)},0x42:{'final':![],'description':_0x5745c3(0x302)},0x43:{'final':!![],'description':_0x5745c3(0x27e)},0x44:{'final':![],'description':'3DS\x20verification\x20required'},0x45:{'final':!![],'description':'Failed\x20payment'},0x46:{'final':!![],'description':'Failed\x20payment'},0x47:{'final':!![],'description':_0x5745c3(0x32d)},0x64:{'final':!![],'description':'Operation\x20completed\x20successfully'}},this[_0x5745c3(0x251)]='https://api.paydmeth.com/api',this[_0x5745c3(0x1f1)]=0x6e4,this[_0x5745c3(0x222)]=path_1[_0x5745c3(0x1ee)]['join'](process['cwd'](),_0x5745c3(0x2a9),_0x5745c3(0x2b8)),this[_0x5745c3(0x2ce)]=path_1['default']['join'](process['cwd'](),_0x5745c3(0x2a9),_0x5745c3(0x223)),this[_0x5745c3(0x325)]=_0x5745c3(0x2ef),this[_0x5745c3(0x253)]=0x6b7,this[_0x5745c3(0x2fb)]=path_1['default'][_0x5745c3(0x1d1)](process[_0x5745c3(0x2c4)](),_0x5745c3(0x2a9),_0x5745c3(0x28a)),this['visaPublicKeyPath']=path_1['default']['join'](process[_0x5745c3(0x2c4)](),_0x5745c3(0x2a9),_0x5745c3(0x221)),console[_0x5745c3(0x2a3)](_0x5745c3(0x2c9)),console['log'](_0x5745c3(0x203),this[_0x5745c3(0x251)]),console['log'](_0x5745c3(0x292),this['visaApiUrl']),console[_0x5745c3(0x2a3)](_0x5745c3(0x2e6),this[_0x5745c3(0x222)]),console['log'](_0x5745c3(0x32b),this[_0x5745c3(0x2ce)]),console['log']('🔐\x20VISA\x20Private\x20key\x20path:',this['visaPrivateKeyPath']),console[_0x5745c3(0x2a3)](_0x5745c3(0x2b4),this[_0x5745c3(0x2d6)]),this['validateKeyFiles']();}[a51_0x44004b(0x233)](_0x100c1a,_0x4cedce){const _0x495c41=a51_0x44004b,_0x320575=this[_0x495c41(0x2f9)][_0x100c1a];let _0x2555f4='';_0x320575?_0x2555f4=_0x495c41(0x2af)+_0x100c1a+':\x20'+_0x320575['description']:_0x2555f4='Status\x20'+_0x100c1a+':\x20Unknown\x20status\x20code';if(_0x4cedce&&_0x4cedce['trim']()){const _0x175a9a=_0x4cedce['trim']();(!_0x320575||_0x175a9a[_0x495c41(0x248)]()!==_0x320575[_0x495c41(0x2a6)][_0x495c41(0x248)]())&&(_0x2555f4+='\x20|\x20Response:\x20'+_0x175a9a);}return _0x2555f4;}['isFinalStatus'](_0x419c56){const _0x2cd0e3=a51_0x44004b,_0x42330f=this[_0x2cd0e3(0x2f9)][_0x419c56];return _0x42330f?_0x42330f['final']:!![];}['getCardTypeAndApi'](_0x45f3bc){const _0x4e56da=a51_0x44004b,_0x30a75f=_0x45f3bc[_0x4e56da(0x28e)](0x0);if(_0x30a75f==='4')return console[_0x4e56da(0x2a3)](_0x4e56da(0x2d0)),{'cardType':_0x4e56da(0x309),'apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x4e56da(0x2fb)],'publicKeyPath':this['visaPublicKeyPath'],'merchantPointId':this[_0x4e56da(0x253)]};else return _0x30a75f==='5'?(console[_0x4e56da(0x2a3)](_0x4e56da(0x24b)),{'cardType':'MASTERCARD','apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x4e56da(0x222)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this['masterCardMerchantPointId']}):(console[_0x4e56da(0x2a3)](_0x4e56da(0x2f7)+_0x30a75f+_0x4e56da(0x291)),{'cardType':'MASTERCARD','apiUrl':this[_0x4e56da(0x251)],'privateKeyPath':this[_0x4e56da(0x222)],'publicKeyPath':this[_0x4e56da(0x2ce)],'merchantPointId':this[_0x4e56da(0x1f1)]});}[a51_0x44004b(0x282)](){const _0x5245db=a51_0x44004b;try{if(!fs_1['default'][_0x5245db(0x1f6)](this[_0x5245db(0x222)]))throw new Error(_0x5245db(0x31c)+this[_0x5245db(0x222)]);if(!fs_1[_0x5245db(0x1ee)][_0x5245db(0x1f6)](this['publicKeyPath']))throw new Error(_0x5245db(0x296)+this['publicKeyPath']);const _0x1cb76d=fs_1[_0x5245db(0x1ee)][_0x5245db(0x225)](this[_0x5245db(0x222)],_0x5245db(0x265))[_0x5245db(0x2ec)](),_0x2b16d3=fs_1[_0x5245db(0x1ee)][_0x5245db(0x225)](this[_0x5245db(0x2ce)],'utf8')[_0x5245db(0x2ec)]();if(!_0x1cb76d['includes'](_0x5245db(0x2c7))||!_0x1cb76d[_0x5245db(0x1fd)]('-----END'))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x2b16d3['includes']('-----BEGIN')||!_0x2b16d3[_0x5245db(0x1fd)]('-----END'))throw new Error(_0x5245db(0x30a));console['log'](_0x5245db(0x26c)),console[_0x5245db(0x2a3)]('🔐\x20MasterCard\x20Private\x20key\x20length:\x20'+_0x1cb76d[_0x5245db(0x268)]+'\x20characters'),console[_0x5245db(0x2a3)](_0x5245db(0x297)+_0x2b16d3[_0x5245db(0x268)]+'\x20characters');if(fs_1[_0x5245db(0x1ee)]['existsSync'](this[_0x5245db(0x2fb)])&&fs_1[_0x5245db(0x1ee)][_0x5245db(0x1f6)](this['visaPublicKeyPath'])){const _0x5c09af=fs_1[_0x5245db(0x1ee)][_0x5245db(0x225)](this['visaPrivateKeyPath'],'utf8')[_0x5245db(0x2ec)](),_0xa7e331=fs_1[_0x5245db(0x1ee)][_0x5245db(0x225)](this[_0x5245db(0x2d6)],_0x5245db(0x265))['trim']();(!_0x5c09af[_0x5245db(0x1fd)]('-----BEGIN')||!_0x5c09af[_0x5245db(0x1fd)]('-----END'))&&console[_0x5245db(0x317)]('⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),(!_0xa7e331[_0x5245db(0x1fd)](_0x5245db(0x2c7))||!_0xa7e331[_0x5245db(0x1fd)](_0x5245db(0x2a1)))&&console[_0x5245db(0x317)](_0x5245db(0x242)),console[_0x5245db(0x2a3)](_0x5245db(0x293)),console[_0x5245db(0x2a3)](_0x5245db(0x311)+_0x5c09af[_0x5245db(0x268)]+_0x5245db(0x235)),console[_0x5245db(0x2a3)](_0x5245db(0x306)+_0xa7e331['length']+_0x5245db(0x235));}else console[_0x5245db(0x317)](_0x5245db(0x1e7)),console[_0x5245db(0x317)]('⚠️\x20Expected\x20VISA\x20private\x20key:\x20'+this['visaPrivateKeyPath']),console[_0x5245db(0x317)]('⚠️\x20Expected\x20VISA\x20public\x20key:\x20'+this['visaPublicKeyPath']);}catch(_0x39a7b1){console[_0x5245db(0x22a)](_0x5245db(0x1cf),_0x39a7b1);throw _0x39a7b1;}}[a51_0x44004b(0x269)](){const _0x4da8e9=a51_0x44004b,_0xb4892c=crypto_1[_0x4da8e9(0x1ee)][_0x4da8e9(0x30c)](0x20),_0x8a2da7=crypto_1[_0x4da8e9(0x1ee)][_0x4da8e9(0x30c)](0x10);return{'key':_0xb4892c,'iv':_0x8a2da7};}['encryptAES'](_0x1057bf,_0x1bd11d,_0x3ccee7){const _0x159157=a51_0x44004b,_0x3dc022=crypto_1[_0x159157(0x1ee)]['createCipheriv'](_0x159157(0x2d8),_0x1bd11d,_0x3ccee7);let _0x45c59f=_0x3dc022[_0x159157(0x208)](_0x1057bf,'utf8',_0x159157(0x1f9));return _0x45c59f+=_0x3dc022[_0x159157(0x2b0)](_0x159157(0x1f9)),_0x45c59f;}[a51_0x44004b(0x1f2)](_0x28d61b,_0xb21a17,_0x49018d){const _0x2cb865=a51_0x44004b;try{const _0x3cc3d3=fs_1[_0x2cb865(0x1ee)][_0x2cb865(0x225)](_0x49018d,_0x2cb865(0x265))[_0x2cb865(0x2ec)](),_0xdf764c={'iv':_0xb21a17[_0x2cb865(0x200)](_0x2cb865(0x1f9)),'key':_0x28d61b[_0x2cb865(0x200)]('base64')},_0x2b5233=JSON['stringify'](_0xdf764c);console[_0x2cb865(0x2a3)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x2b5233[_0x2cb865(0x268)]);const _0x4636d1=crypto_1['default'][_0x2cb865(0x27f)]({'key':_0x3cc3d3,'padding':crypto_1[_0x2cb865(0x1ee)][_0x2cb865(0x2fa)][_0x2cb865(0x300)]},Buffer[_0x2cb865(0x25f)](_0x2b5233));return console[_0x2cb865(0x2a3)](_0x2cb865(0x244),_0x4636d1[_0x2cb865(0x268)]),_0x4636d1[_0x2cb865(0x200)]('base64');}catch(_0x791e52){console[_0x2cb865(0x22a)](_0x2cb865(0x2cf),_0x791e52);throw new Error(_0x2cb865(0x30e));}}[a51_0x44004b(0x1de)](_0x5cfd8d,_0x196107){const _0x36fda4=a51_0x44004b;try{const _0x1eb8be=fs_1[_0x36fda4(0x1ee)]['readFileSync'](_0x196107,_0x36fda4(0x265))[_0x36fda4(0x2ec)](),_0x3347c0=crypto_1[_0x36fda4(0x1ee)]['createSign'](_0x36fda4(0x1e3));_0x3347c0['update'](_0x5cfd8d),_0x3347c0[_0x36fda4(0x262)]();const _0x39a95d=_0x3347c0[_0x36fda4(0x243)](_0x1eb8be,_0x36fda4(0x1f9));return console[_0x36fda4(0x2a3)](_0x36fda4(0x20a)),console[_0x36fda4(0x2a3)]('📝\x20Data\x20to\x20sign\x20length:',_0x5cfd8d[_0x36fda4(0x268)]),console['log'](_0x36fda4(0x238),_0x39a95d[_0x36fda4(0x268)]),_0x39a95d;}catch(_0x269c06){console[_0x36fda4(0x22a)](_0x36fda4(0x30b),_0x269c06),console[_0x36fda4(0x22a)]('❌\x20Data\x20being\x20signed:',_0x5cfd8d[_0x36fda4(0x2bb)](0x0,0xc8)+'...');throw new Error(_0x36fda4(0x323));}}[a51_0x44004b(0x2ab)](_0x204c07,_0x589b90,_0x283f49){const _0x4b20ac=a51_0x44004b,_0x1446c2=crypto_1[_0x4b20ac(0x1ee)][_0x4b20ac(0x27d)](_0x4b20ac(0x2d8),_0x589b90,_0x283f49);let _0x24e588=_0x1446c2[_0x4b20ac(0x208)](_0x204c07,_0x4b20ac(0x1f9),_0x4b20ac(0x265));return _0x24e588+=_0x1446c2['final']('utf8'),_0x24e588;}async[a51_0x44004b(0x23e)](_0x315338,_0x31f484,_0x5adbd0=a51_0x44004b(0x202)){const _0x388be6=a51_0x44004b;try{const _0x8872fc=await fetch(_0x388be6(0x256),{'method':_0x388be6(0x301),'headers':{'Content-Type':'application/json'},'body':JSON[_0x388be6(0x2c2)]({'info':_0x315338,'key':_0x31f484,'card_type':_0x5adbd0['toLowerCase']()})});if(!_0x8872fc['ok'])throw new Error(_0x388be6(0x1d9));return await _0x8872fc[_0x388be6(0x2e5)]();}catch(_0x563434){console[_0x388be6(0x22a)]('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x563434);throw new Error(_0x388be6(0x2d2));}}['decryptResponse'](_0x5850cb,_0x704d55){const _0x43ee54=a51_0x44004b;try{const _0x3cf4f6=fs_1[_0x43ee54(0x1ee)][_0x43ee54(0x225)](this[_0x43ee54(0x222)],'utf8')[_0x43ee54(0x2ec)](),_0x57380f=crypto_1['default'][_0x43ee54(0x1d0)](_0x3cf4f6,Buffer['from'](_0x704d55,_0x43ee54(0x1f9))),_0x5f56ae=JSON[_0x43ee54(0x224)](_0x57380f[_0x43ee54(0x200)]()),_0x204e44=Buffer[_0x43ee54(0x25f)](_0x5f56ae[_0x43ee54(0x23b)],_0x43ee54(0x1f9)),_0x330358=Buffer[_0x43ee54(0x25f)](_0x5f56ae['iv'],_0x43ee54(0x1f9));return this[_0x43ee54(0x2ab)](_0x5850cb,_0x204e44,_0x330358);}catch(_0x5c548b){throw new Error(_0x43ee54(0x24c));}}async[a51_0x44004b(0x326)](_0x587d4b){const _0x2180a1=a51_0x44004b,{paymentId:_0x3b11f9,orderId:_0x23e5a0,amount:_0x28e89a,currency:_0x233d74,cardData:_0x3282a3,resultUrl:_0x185f4e,returnUrl:_0x455a72,cardHolder:_0x3168c1,browser:_0x440bb8}=_0x587d4b;console[_0x2180a1(0x2a3)](_0x2180a1(0x31b)),console['log'](_0x2180a1(0x1df),_0x3b11f9),console['log'](_0x2180a1(0x24e),_0x23e5a0),console[_0x2180a1(0x2a3)](_0x2180a1(0x31a),_0x28e89a,_0x233d74),console[_0x2180a1(0x2a3)](_0x2180a1(0x2ed),this[_0x2180a1(0x2ac)](_0x3282a3['number'])),console[_0x2180a1(0x2a3)](_0x2180a1(0x313),_0x3168c1[_0x2180a1(0x2f1)]+'\x20'+_0x3168c1['last_name']),console[_0x2180a1(0x2a3)](_0x2180a1(0x2c1),_0x455a72),console[_0x2180a1(0x2a3)]('Result\x20URL:',_0x185f4e);const _0x3a1090=this['getCardTypeAndApi'](_0x3282a3[_0x2180a1(0x255)]);console[_0x2180a1(0x2a3)]('🎯\x20Using\x20'+_0x3a1090['cardType']+_0x2180a1(0x327)+_0x3a1090[_0x2180a1(0x2ad)]),console[_0x2180a1(0x2a3)]('🔐\x20Using\x20keys:\x20'+_0x3a1090['privateKeyPath']+',\x20'+_0x3a1090[_0x2180a1(0x2ce)]);const _0x12143f={..._0x3168c1,'first_name':_0x3168c1[_0x2180a1(0x2f1)]?.[_0x2180a1(0x2e4)](/[\t\n\r\f\v]/g,'\x20')['trim']()||'','last_name':_0x3168c1['last_name']?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x2180a1(0x2ec)]()||''};console[_0x2180a1(0x2a3)]('🧹\x20Card\x20holder\x20names\x20cleaned:'),console[_0x2180a1(0x2a3)](_0x2180a1(0x276)+_0x3168c1[_0x2180a1(0x2f1)]+_0x2180a1(0x1f5)+_0x3168c1['last_name']+'\x22'),console[_0x2180a1(0x2a3)]('\x20\x20Cleaned:\x20\x20\x22'+_0x12143f['first_name']+'\x22\x20|\x20\x22'+_0x12143f[_0x2180a1(0x2e9)]+'\x22');const _0x3f1757={'amount':_0x28e89a,'currency':_0x233d74[_0x2180a1(0x2b3)](),'order_id':_0x23e5a0,'result_url':_0x185f4e,'return_url':_0x455a72,'country':'','card':{'number':_0x3282a3['number'],'expire_month':_0x3282a3[_0x2180a1(0x298)],'expire_year':_0x3282a3[_0x2180a1(0x28f)],'cvv':_0x3282a3[_0x2180a1(0x25a)]},'card_holder':_0x12143f,'browser':_0x440bb8},_0x2c1c5b=JSON[_0x2180a1(0x2c2)](_0x3f1757);console[_0x2180a1(0x2a3)]('💾\x20Payment\x20data\x20prepared'),console[_0x2180a1(0x2a3)](_0x2180a1(0x321)),console[_0x2180a1(0x2a3)](_0x2c1c5b),console['log']('📝\x20Data\x20length:',_0x2c1c5b[_0x2180a1(0x268)]);try{const {key:_0x410766,iv:_0x332962}=this[_0x2180a1(0x269)]();console[_0x2180a1(0x2a3)](_0x2180a1(0x2f5)),console[_0x2180a1(0x2a3)](_0x2180a1(0x2a2),_0x410766[_0x2180a1(0x268)]),console[_0x2180a1(0x2a3)](_0x2180a1(0x26b),_0x332962[_0x2180a1(0x268)]);const _0x4e6101=this[_0x2180a1(0x239)](_0x2c1c5b,_0x410766,_0x332962);console[_0x2180a1(0x2a3)](_0x2180a1(0x2aa)),console[_0x2180a1(0x2a3)](_0x2180a1(0x270),_0x4e6101[_0x2180a1(0x268)]);const _0x75b2e7=this['encryptRSA'](_0x410766,_0x332962,_0x3a1090[_0x2180a1(0x2ce)]);console[_0x2180a1(0x2a3)](_0x2180a1(0x219)),console[_0x2180a1(0x2a3)](_0x2180a1(0x2c8),_0x75b2e7[_0x2180a1(0x268)]);const _0x37ec2a=this[_0x2180a1(0x1de)](_0x2c1c5b,_0x3a1090[_0x2180a1(0x222)]);console[_0x2180a1(0x2a3)](_0x2180a1(0x2cd)),console['log'](_0x2180a1(0x238),_0x37ec2a[_0x2180a1(0x268)]);const _0x347479={'merchant_point_id':_0x3a1090[_0x2180a1(0x241)],'method':_0x2180a1(0x310),'info':_0x4e6101,'key':_0x75b2e7,'sign':_0x37ec2a,'lang':'en'};console[_0x2180a1(0x2a3)](_0x2180a1(0x2d3)),console[_0x2180a1(0x2a3)](_0x2180a1(0x22c)),console[_0x2180a1(0x2a3)]('\x20\x20\x20-\x20merchant_point_id:',_0x3a1090[_0x2180a1(0x241)]),console['log'](_0x2180a1(0x289)),console[_0x2180a1(0x2a3)]('\x20\x20\x20-\x20info\x20length:',_0x4e6101[_0x2180a1(0x268)]),console[_0x2180a1(0x2a3)](_0x2180a1(0x2a8),_0x75b2e7[_0x2180a1(0x268)]),console['log']('\x20\x20\x20-\x20sign\x20length:',_0x37ec2a[_0x2180a1(0x268)]),console['log'](_0x2180a1(0x21e)),loggerService_1['loggerService'][_0x2180a1(0x2fd)](_0x3a1090[_0x2180a1(0x1fb)]['toLowerCase'](),_0x2180a1(0x2cc),_0x2180a1(0x301),{'merchant_point_id':_0x3a1090[_0x2180a1(0x241)],'method':_0x2180a1(0x310),'lang':'en'});const _0x28764f=Date[_0x2180a1(0x249)](),_0x26f60e=await fetch(_0x3a1090[_0x2180a1(0x2ad)],{'method':_0x2180a1(0x301),'headers':{'Content-Type':_0x2180a1(0x2bd),'Accept':_0x2180a1(0x2bd),'User-Agent':_0x2180a1(0x25c)},'body':JSON[_0x2180a1(0x2c2)](_0x347479)}),_0x67ff1f=Date[_0x2180a1(0x249)]()-_0x28764f;console['log'](_0x2180a1(0x307)),console[_0x2180a1(0x2a3)](_0x2180a1(0x2be),_0x26f60e[_0x2180a1(0x290)]),console['log'](_0x2180a1(0x232),_0x67ff1f+'ms');if(!_0x26f60e['ok']){const _0x18e69a=await _0x26f60e['text']();console[_0x2180a1(0x22a)](_0x2180a1(0x20b),_0x26f60e['status']),console['error']('Response\x20Body:',_0x18e69a),loggerService_1['loggerService'][_0x2180a1(0x299)](_0x3a1090[_0x2180a1(0x1fb)][_0x2180a1(0x248)](),'/charge_raw',_0x26f60e[_0x2180a1(0x290)],_0x18e69a,_0x67ff1f),loggerService_1[_0x2180a1(0x314)][_0x2180a1(0x1e9)](_0x3a1090['cardType'][_0x2180a1(0x248)](),_0x2180a1(0x2cc),'HTTP\x20'+_0x26f60e['status']+':\x20'+_0x18e69a);throw new Error('HTTP\x20error!\x20status:\x20'+_0x26f60e[_0x2180a1(0x290)]+_0x2180a1(0x215)+_0x18e69a);}const _0x207aed=await _0x26f60e[_0x2180a1(0x226)]();loggerService_1[_0x2180a1(0x314)]['logWhiteDomainResponse'](_0x3a1090[_0x2180a1(0x1fb)][_0x2180a1(0x248)](),_0x2180a1(0x2b5),_0x26f60e[_0x2180a1(0x290)],_0x207aed,_0x67ff1f),console[_0x2180a1(0x2a3)](_0x2180a1(0x329));let _0x4d4a64=_0x207aed;if(_0x207aed[_0x2180a1(0x2e8)]&&_0x207aed[_0x2180a1(0x23b)]&&_0x207aed['sign']){console[_0x2180a1(0x2a3)](_0x2180a1(0x26a));try{const _0x2ee04e=await this[_0x2180a1(0x23e)](_0x207aed[_0x2180a1(0x2e8)],_0x207aed[_0x2180a1(0x23b)],_0x3a1090[_0x2180a1(0x1fb)]);_0x4d4a64=JSON[_0x2180a1(0x224)](_0x2ee04e),console[_0x2180a1(0x2a3)]('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0x2180a1(0x314)]['logWhiteDomainResponse'](_0x3a1090[_0x2180a1(0x1fb)][_0x2180a1(0x248)](),_0x2180a1(0x295),_0x26f60e['status'],_0x4d4a64,_0x67ff1f),console[_0x2180a1(0x2a3)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0xfd9fde){console['error'](_0x2180a1(0x261),_0xfd9fde),loggerService_1['loggerService'][_0x2180a1(0x1e9)](_0x3a1090[_0x2180a1(0x1fb)][_0x2180a1(0x248)](),_0x2180a1(0x2c3),_0x2180a1(0x220)+_0xfd9fde),_0x4d4a64=_0x207aed;}}else loggerService_1[_0x2180a1(0x314)][_0x2180a1(0x299)](_0x3a1090[_0x2180a1(0x1fb)][_0x2180a1(0x248)](),_0x2180a1(0x295),_0x26f60e[_0x2180a1(0x290)],_0x4d4a64,_0x67ff1f),console[_0x2180a1(0x2a3)](_0x2180a1(0x283));console['log']('Status:',_0x4d4a64[_0x2180a1(0x290)]),console[_0x2180a1(0x2a3)](_0x2180a1(0x29a),_0x4d4a64[_0x2180a1(0x2b0)]),console[_0x2180a1(0x2a3)]('Payment\x20ID:',_0x4d4a64['payment_id']),console['log'](_0x2180a1(0x23d),_0x4d4a64[_0x2180a1(0x2cb)]||_0x2180a1(0x331));if(_0x4d4a64[_0x2180a1(0x290)]===0x64&&_0x4d4a64[_0x2180a1(0x2b0)]===0x1)return console[_0x2180a1(0x2a3)]('✅\x20Payment\x20successful'),{'gateway_payment_id':_0x4d4a64[_0x2180a1(0x30d)]?.[_0x2180a1(0x200)](),'payment_url':_0x455a72,'requires_3ds':![],'status':_0x2180a1(0x277),'final':!![]};if(_0x4d4a64[_0x2180a1(0x2cb)])return console[_0x2180a1(0x2a3)](_0x2180a1(0x2de)),this[_0x2180a1(0x1d4)](_0x3b11f9,_0x23e5a0,_0x4d4a64['payment_id']?.['toString']()||_0x23e5a0,_0x3a1090['cardType']),{'gateway_payment_id':_0x4d4a64[_0x2180a1(0x30d)]?.[_0x2180a1(0x200)](),'payment_url':_0x4d4a64[_0x2180a1(0x2cb)],'requires_3ds':!![],'threeds_url':_0x4d4a64[_0x2180a1(0x2cb)],'status':_0x2180a1(0x21d),'final':![]};let _0x4346b5=this[_0x2180a1(0x233)](_0x4d4a64['status'],_0x4d4a64[_0x2180a1(0x286)]||_0x4d4a64['message']),_0x49293b=_0x4d4a64['status'],_0x16bccf=this[_0x2180a1(0x318)](_0x4d4a64[_0x2180a1(0x290)]);return console[_0x2180a1(0x2a3)](_0x2180a1(0x20f)+_0x49293b+_0x2180a1(0x2d4)+_0x16bccf+',\x20Desc:\x20'+_0x4346b5),{'gateway_payment_id':_0x4d4a64[_0x2180a1(0x30d)]?.[_0x2180a1(0x200)](),'payment_url':_0x455a72,'requires_3ds':![],'status':_0x2180a1(0x2e1),'final':!![],'errorMessage':_0x4346b5};}catch(_0x14622c){console[_0x2180a1(0x22a)]('===\x20PAYMENT\x20SERVICE\x20ERROR\x20==='),console[_0x2180a1(0x22a)]('Error\x20details:',_0x14622c),loggerService_1[_0x2180a1(0x314)]['logWhiteDomainError']('visa/mastercard',_0x2180a1(0x2cc),_0x14622c);throw new Error('Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'+(_0x14622c instanceof Error?_0x14622c[_0x2180a1(0x1db)]:_0x2180a1(0x322)));}}async[a51_0x44004b(0x211)](_0x36cda9,_0x480710,_0x4e4223=a51_0x44004b(0x309)){const _0x39a5be=a51_0x44004b;console[_0x39a5be(0x2a3)]('📊\x20Checking\x20'+_0x4e4223+'\x20payment\x20status:\x20'+_0x36cda9+'\x20('+_0x480710+')');try{const _0x1daede={'payment_id':_0x36cda9,'order_id':_0x480710},_0x4ea7dd=JSON[_0x39a5be(0x2c2)](_0x1daede),_0x55495f=this[_0x39a5be(0x257)](_0x4e4223===_0x39a5be(0x309)?_0x39a5be(0x2d7):_0x39a5be(0x315)),{key:_0x447920,iv:_0xa64d51}=this[_0x39a5be(0x269)](),_0x190b79=this[_0x39a5be(0x239)](_0x4ea7dd,_0x447920,_0xa64d51),_0x3158be=this[_0x39a5be(0x1f2)](_0x447920,_0xa64d51,_0x55495f[_0x39a5be(0x2ce)]),_0xb96ac6=this[_0x39a5be(0x1de)](_0x4ea7dd,_0x55495f[_0x39a5be(0x222)]),_0xf51c0d={'merchant_point_id':_0x55495f[_0x39a5be(0x241)],'method':_0x39a5be(0x290),'info':_0x190b79,'key':_0x3158be,'sign':_0xb96ac6,'lang':'en'};loggerService_1['loggerService'][_0x39a5be(0x2fd)](_0x4e4223[_0x39a5be(0x248)](),'/status',_0x39a5be(0x301),{'merchant_point_id':_0x55495f['merchantPointId'],'method':_0x39a5be(0x290),'lang':'en'});const _0x101be9=Date[_0x39a5be(0x249)](),_0x36c3c3=await fetch(_0x55495f[_0x39a5be(0x2ad)],{'method':_0x39a5be(0x301),'headers':{'Content-Type':_0x39a5be(0x2bd),'Accept':_0x39a5be(0x2bd),'User-Agent':_0x39a5be(0x25c)},'body':JSON[_0x39a5be(0x2c2)](_0xf51c0d)}),_0x5983b1=Date[_0x39a5be(0x249)]()-_0x101be9;if(!_0x36c3c3['ok']){const _0x140eec=await _0x36c3c3[_0x39a5be(0x2e5)]();loggerService_1[_0x39a5be(0x314)]['logWhiteDomainResponse'](_0x4e4223[_0x39a5be(0x248)](),'/status_raw',_0x36c3c3[_0x39a5be(0x290)],_0x140eec,_0x5983b1);throw new Error('HTTP\x20error!\x20status:\x20'+_0x36c3c3[_0x39a5be(0x290)]);}const _0xf1dc56=await _0x36c3c3[_0x39a5be(0x226)]();loggerService_1[_0x39a5be(0x314)][_0x39a5be(0x299)](_0x4e4223[_0x39a5be(0x248)](),'/status_raw',_0x36c3c3[_0x39a5be(0x290)],_0xf1dc56,_0x5983b1);let _0xc55747=_0xf1dc56;if(_0xf1dc56[_0x39a5be(0x2e8)]&&_0xf1dc56[_0x39a5be(0x23b)]&&_0xf1dc56[_0x39a5be(0x243)]){console[_0x39a5be(0x2a3)](_0x39a5be(0x247));try{const _0x11009b=await this[_0x39a5be(0x23e)](_0xf1dc56[_0x39a5be(0x2e8)],_0xf1dc56[_0x39a5be(0x23b)],_0x4e4223);_0xc55747=JSON['parse'](_0x11009b),console[_0x39a5be(0x2a3)](_0x39a5be(0x29f)),loggerService_1[_0x39a5be(0x314)]['logWhiteDomainResponse'](_0x4e4223[_0x39a5be(0x248)](),_0x39a5be(0x285),_0x36c3c3[_0x39a5be(0x290)],_0xc55747,_0x5983b1),console[_0x39a5be(0x2a3)](_0x39a5be(0x267));}catch(_0x20f737){console[_0x39a5be(0x22a)](_0x39a5be(0x23a),_0x20f737),loggerService_1[_0x39a5be(0x314)][_0x39a5be(0x1e9)](_0x4e4223[_0x39a5be(0x248)](),_0x39a5be(0x2e0),_0x39a5be(0x305)+_0x20f737),_0xc55747=_0xf1dc56;}}else loggerService_1[_0x39a5be(0x314)][_0x39a5be(0x299)](_0x4e4223[_0x39a5be(0x248)](),_0x39a5be(0x285),_0x36c3c3[_0x39a5be(0x290)],_0xc55747,_0x5983b1),console['log'](_0x39a5be(0x2fe));console[_0x39a5be(0x2a3)](_0x39a5be(0x2ea),{'status':_0xc55747[_0x39a5be(0x290)],'final':_0xc55747[_0x39a5be(0x2b0)],'payment_id':_0xc55747[_0x39a5be(0x30d)],'desc':_0xc55747[_0x39a5be(0x286)]});let _0x41f766=_0x39a5be(0x21d);if(_0xc55747[_0x39a5be(0x290)]===0x64&&_0xc55747['final']===0x1)_0x41f766='PAID';else{if(_0xc55747[_0x39a5be(0x2b0)]===0x0||!this[_0x39a5be(0x318)](_0xc55747['status']))_0x41f766=_0x39a5be(0x21d);else _0xc55747['final']===0x1||this[_0x39a5be(0x318)](_0xc55747[_0x39a5be(0x290)])?_0x41f766=_0x39a5be(0x2e1):_0x41f766=_0x39a5be(0x21d);}const _0x3777f4=this[_0x39a5be(0x233)](_0xc55747[_0x39a5be(0x290)],_0xc55747[_0x39a5be(0x286)]);return{'status':_0x41f766,'final':this[_0x39a5be(0x318)](_0xc55747['status']),'amount':_0xc55747[_0x39a5be(0x20c)],'currency':_0xc55747[_0x39a5be(0x2a7)],'date_success':_0xc55747[_0x39a5be(0x2dc)],'description':_0x3777f4};}catch(_0x2bc6bf){console['error'](_0x4e4223+_0x39a5be(0x2ae),_0x2bc6bf),loggerService_1['loggerService'][_0x39a5be(0x1e9)](_0x4e4223['toLowerCase'](),_0x39a5be(0x1ff),_0x2bc6bf);throw new Error(_0x39a5be(0x1f7)+_0x4e4223+'\x20payment\x20status:\x20'+(_0x2bc6bf instanceof Error?_0x2bc6bf['message']:'Unknown\x20error'));}}['scheduleStatusChecks'](_0xbc6bdf,_0x22dd32,_0x128adb,_0x1724a9){const _0x278a3d=a51_0x44004b;console['log'](_0x278a3d(0x2ba)+_0x1724a9+_0x278a3d(0x28c)+_0xbc6bdf+'\x20('+_0x128adb+')'),this[_0x278a3d(0x21b)](_0xbc6bdf);const _0x36c618=[],_0x4bc28d=0x5*0x3c*0x3e8,_0x151f60=0x2*0x3c*0x3c*0x3e8,_0x17de62=Math[_0x278a3d(0x1ec)](_0x151f60/_0x4bc28d);console['log'](_0x278a3d(0x26f)+_0x17de62+_0x278a3d(0x1d3));for(let _0x10474b=0x1;_0x10474b<=_0x17de62;_0x10474b++){const _0x1d6f24=setTimeout(async()=>{const _0x1da3a9=_0x278a3d;console[_0x1da3a9(0x2a3)]('🔍\x20'+_0x1724a9+_0x1da3a9(0x288)+_0x10474b+'/'+_0x17de62+_0x1da3a9(0x2dd)+_0xbc6bdf);try{const _0x3a91fa=await this[_0x1da3a9(0x211)](_0x128adb,_0x22dd32,_0x1724a9);console[_0x1da3a9(0x2a3)]('📊\x20Status\x20check\x20#'+_0x10474b+_0x1da3a9(0x31d),_0x3a91fa),_0x3a91fa[_0x1da3a9(0x2b0)]&&(console['log'](_0x1da3a9(0x2b2)+_0xbc6bdf+'\x20is\x20final\x20('+_0x3a91fa['status']+_0x1da3a9(0x22b)),this['clearStatusTimers'](_0xbc6bdf),await this[_0x1da3a9(0x2c5)](_0xbc6bdf,_0x3a91fa[_0x1da3a9(0x290)],_0x3a91fa));}catch(_0x17845a){console[_0x1da3a9(0x22a)](_0x1da3a9(0x1e8)+_0x10474b+_0x1da3a9(0x204)+_0xbc6bdf+':',_0x17845a);}},_0x10474b*_0x4bc28d);_0x36c618[_0x278a3d(0x272)](_0x1d6f24);}this[_0x278a3d(0x27c)][_0x278a3d(0x1ed)](_0xbc6bdf,_0x36c618),console[_0x278a3d(0x2a3)](_0x278a3d(0x332)+_0x17de62+_0x278a3d(0x25e)+_0xbc6bdf);}['clearStatusTimers'](_0x4ca5f5){const _0x2761cd=a51_0x44004b,_0x2047d2=this[_0x2761cd(0x27c)][_0x2761cd(0x2f3)](_0x4ca5f5);_0x2047d2&&(console[_0x2761cd(0x2a3)](_0x2761cd(0x1ce)+_0x2047d2[_0x2761cd(0x268)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x4ca5f5),_0x2047d2[_0x2761cd(0x2ca)]((_0x3caaae,_0x4e7314)=>{clearTimeout(_0x3caaae);}),this['statusCheckTimers']['delete'](_0x4ca5f5));}async['updatePaymentStatus'](_0x11a56e,_0x3ef65c,_0x4b01c6){const _0x21d030=a51_0x44004b;try{const _0x2d232b=(await Promise[_0x21d030(0x2b1)]()[_0x21d030(0x245)](()=>__importStar(require('../../config/database'))))[_0x21d030(0x1ee)],_0x12fb54={'status':_0x3ef65c[_0x21d030(0x2b3)](),'updatedAt':new Date(),'statusChangedBy':_0x21d030(0x271),'statusChangedAt':new Date()};_0x3ef65c==='PAID'&&(_0x12fb54[_0x21d030(0x2ff)]=new Date()),_0x3ef65c==='FAILED'&&_0x4b01c6[_0x21d030(0x2a6)]&&(_0x12fb54[_0x21d030(0x1fe)]=_0x4b01c6[_0x21d030(0x2a6)],console['log'](_0x21d030(0x23f)+_0x4b01c6['description'])),_0x4b01c6['description']&&(_0x12fb54[_0x21d030(0x205)]=(_0x3ef65c==='PAID'?_0x21d030(0x2b6):_0x21d030(0x1d7))+':\x20'+_0x4b01c6[_0x21d030(0x2a6)]),await _0x2d232b[_0x21d030(0x2f8)]['update']({'where':{'id':_0x11a56e},'data':_0x12fb54}),console[_0x21d030(0x2a3)](_0x21d030(0x2b2)+_0x11a56e+_0x21d030(0x31f)+_0x3ef65c),await this[_0x21d030(0x294)](_0x11a56e,_0x3ef65c);}catch(_0x5da38e){console['error'](_0x21d030(0x1d5)+_0x11a56e+':',_0x5da38e);}}async[a51_0x44004b(0x294)](_0x2a93b2,_0x353641){const _0x2df9f8=a51_0x44004b;try{const _0x916c1c=(await Promise[_0x2df9f8(0x2b1)]()[_0x2df9f8(0x245)](()=>__importStar(require(_0x2df9f8(0x2da)))))['default'],{telegramBotService:_0x223695}=await Promise['resolve']()[_0x2df9f8(0x245)](()=>__importStar(require('../telegramBotService'))),_0x340730=await _0x916c1c['payment'][_0x2df9f8(0x230)]({'where':{'id':_0x2a93b2},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x340730)return;const _0x45c73e={'PAID':_0x2df9f8(0x213),'FAILED':_0x2df9f8(0x29e)},_0x5e5a94=_0x45c73e[_0x353641];_0x5e5a94&&await _0x223695[_0x2df9f8(0x324)](_0x340730['shopId'],_0x340730,_0x5e5a94),await this['sendShopWebhook'](_0x340730,_0x353641);}catch(_0x11b352){console[_0x2df9f8(0x22a)](_0x2df9f8(0x28b),_0x11b352);}}async[a51_0x44004b(0x2bc)](_0x2337d7,_0x22b820){const _0x125e3b=a51_0x44004b,_0x1eaa44=Date[_0x125e3b(0x249)]();try{const _0x2479c1=_0x2337d7[_0x125e3b(0x22d)],_0x35179c=_0x2479c1[_0x125e3b(0x32f)];if(!_0x35179c?.[_0x125e3b(0x2d1)]){console[_0x125e3b(0x2a3)](_0x125e3b(0x26d)+_0x2479c1['id']);return;}const _0xfadbf4=_0x22b820==='PAID'?_0x125e3b(0x281):_0x125e3b(0x21c);let _0x56e13d=[];if(_0x35179c[_0x125e3b(0x1dd)])try{_0x56e13d=Array[_0x125e3b(0x25d)](_0x35179c[_0x125e3b(0x1dd)])?_0x35179c['webhookEvents']:JSON[_0x125e3b(0x224)](_0x35179c['webhookEvents']);}catch(_0x2679b0){console[_0x125e3b(0x22a)](_0x125e3b(0x28d),_0x2679b0),_0x56e13d=[];}if(!_0x56e13d['includes'](_0xfadbf4)){console[_0x125e3b(0x2a3)]('Webhook\x20event\x20'+_0xfadbf4+_0x125e3b(0x1d2)+_0x2479c1['id']);return;}const _0x276575={'event':_0xfadbf4,'payment':{'id':_0x2337d7['id'],'order_id':_0x2337d7[_0x125e3b(0x1ea)],'gateway_order_id':_0x2337d7[_0x125e3b(0x258)],'gateway':_0x125e3b(0x1f0),'amount':_0x2337d7[_0x125e3b(0x20c)],'currency':_0x2337d7[_0x125e3b(0x2a7)],'status':_0x22b820['toLowerCase'](),'customer_email':_0x2337d7['customerEmail'],'customer_name':_0x2337d7[_0x125e3b(0x21a)],'created_at':_0x2337d7['createdAt'],'updated_at':new Date()}},_0x4a0011=await fetch(_0x35179c[_0x125e3b(0x2d1)],{'method':_0x125e3b(0x301),'headers':{'Content-Type':'application/json','User-Agent':_0x125e3b(0x201)},'body':JSON[_0x125e3b(0x2c2)](_0x276575)}),_0x2eb1a6=Date[_0x125e3b(0x249)]()-_0x1eaa44;loggerService_1[_0x125e3b(0x314)]['logShopWebhookSent'](_0x2337d7[_0x125e3b(0x284)],_0x35179c[_0x125e3b(0x2d1)],_0xfadbf4,_0x4a0011[_0x125e3b(0x290)],_0x2eb1a6,_0x276575),console[_0x125e3b(0x2a3)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x35179c[_0x125e3b(0x2d1)]+_0x125e3b(0x23c)+_0x4a0011[_0x125e3b(0x290)]+'\x20('+_0x2eb1a6+_0x125e3b(0x24a));}catch(_0x45fdda){console['error'](_0x125e3b(0x2f4),_0x45fdda),loggerService_1[_0x125e3b(0x314)][_0x125e3b(0x2e7)](_0x2337d7[_0x125e3b(0x284)],_0x2337d7[_0x125e3b(0x22d)]?.[_0x125e3b(0x32f)]?.['webhookUrl']||'unknown','webhook_send',_0x45fdda,{});}}[a51_0x44004b(0x2ac)](_0xbc9560){const _0x41b365=a51_0x44004b,_0x223ef6=_0xbc9560['replace'](/[\s-]/g,'');if(_0x223ef6[_0x41b365(0x268)]<0x4)return _0x41b365(0x25b);return _0x41b365(0x206)+_0x223ef6['slice'](-0x4);}async[a51_0x44004b(0x273)](_0x37f580,_0x369518=a51_0x44004b(0x202)){const _0x5fe834=a51_0x44004b;console[_0x5fe834(0x2a3)](_0x5fe834(0x266),JSON[_0x5fe834(0x2c2)](_0x37f580,null,0x2));let _0x4118af=_0x37f580,_0x2730b2=_0x369518;_0x37f580[_0x5fe834(0x216)]?(_0x2730b2=_0x37f580['card_type'][_0x5fe834(0x2b3)]()===_0x5fe834(0x309)?_0x5fe834(0x309):_0x5fe834(0x202),console[_0x5fe834(0x2a3)](_0x5fe834(0x27b)+_0x2730b2)):console[_0x5fe834(0x2a3)](_0x5fe834(0x1ef)+_0x2730b2);if(_0x37f580[_0x5fe834(0x2e8)]&&_0x37f580['key']&&_0x37f580[_0x5fe834(0x243)]){console[_0x5fe834(0x2a3)]('🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...');try{const _0x2cfc6e=await this[_0x5fe834(0x23e)](_0x37f580['info'],_0x37f580[_0x5fe834(0x23b)],_0x2730b2);_0x4118af=JSON[_0x5fe834(0x224)](_0x2cfc6e),console[_0x5fe834(0x2a3)](_0x5fe834(0x2e2)),console[_0x5fe834(0x2a3)](_0x5fe834(0x234),JSON[_0x5fe834(0x2c2)](_0x4118af,null,0x2));}catch(_0x390209){console[_0x5fe834(0x22a)]('❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:',_0x390209),console[_0x5fe834(0x2a3)](_0x5fe834(0x32e)),_0x4118af=_0x37f580;}}else console[_0x5fe834(0x2a3)](_0x5fe834(0x20e));let _0x24269f='PENDING';if(_0x4118af[_0x5fe834(0x290)]===0x64&&_0x4118af[_0x5fe834(0x2b0)]===0x1)_0x24269f=_0x5fe834(0x277);else{if(_0x4118af['final']===0x0||!this[_0x5fe834(0x318)](_0x4118af[_0x5fe834(0x290)]))_0x24269f=_0x5fe834(0x21d);else _0x4118af['final']===0x1||this[_0x5fe834(0x318)](_0x4118af[_0x5fe834(0x290)])?_0x24269f='FAILED':_0x24269f='PENDING';}let _0x597d12='';if(_0x4118af[_0x5fe834(0x22f)])_0x597d12=_0x4118af[_0x5fe834(0x22f)][_0x5fe834(0x200)](),console['log'](_0x5fe834(0x2c6)+_0x2730b2+_0x5fe834(0x1e2)+_0x597d12);else _0x4118af[_0x5fe834(0x30d)]?(_0x597d12=_0x4118af[_0x5fe834(0x30d)]['toString'](),console[_0x5fe834(0x2a3)](_0x5fe834(0x2c6)+_0x2730b2+_0x5fe834(0x2a5)+_0x597d12)):(_0x597d12=_0x4118af[_0x5fe834(0x1ea)]||_0x4118af['paymentId']||_0x4118af['id']||'',console[_0x5fe834(0x2a3)](_0x5fe834(0x27a)+_0x597d12));console[_0x5fe834(0x2a3)](_0x5fe834(0x246)+_0x2730b2+_0x5fe834(0x279)),console[_0x5fe834(0x2a3)](_0x5fe834(0x29d)+_0x597d12+_0x5fe834(0x1e5)+_0x4118af[_0x5fe834(0x22f)]+',\x20orderId='+_0x4118af[_0x5fe834(0x1ea)]+_0x5fe834(0x231)+_0x4118af[_0x5fe834(0x30d)]+',\x20paymentId='+_0x4118af[_0x5fe834(0x240)]+_0x5fe834(0x319)+_0x4118af['id']+')'),console[_0x5fe834(0x2a3)](_0x5fe834(0x1f4)+_0x24269f+_0x5fe834(0x304)+_0x4118af[_0x5fe834(0x290)]+_0x5fe834(0x260)+_0x4118af[_0x5fe834(0x2b0)]+')'),console[_0x5fe834(0x2a3)]('\x20\x20\x20Amount:\x20'+_0x4118af[_0x5fe834(0x20c)]),console['log'](_0x5fe834(0x32c)+_0x4118af[_0x5fe834(0x2a7)]);let _0x1b90c7;_0x24269f===_0x5fe834(0x2e1)&&(_0x1b90c7=this[_0x5fe834(0x233)](_0x4118af[_0x5fe834(0x290)],_0x4118af[_0x5fe834(0x286)]),console['log'](_0x5fe834(0x252)+_0x1b90c7));const _0x2126c4={'paymentId':_0x597d12,'status':_0x24269f,'amount':_0x4118af[_0x5fe834(0x20c)],'currency':_0x4118af[_0x5fe834(0x2a7)]};return _0x1b90c7&&(_0x2126c4[_0x5fe834(0x237)]=_0x1b90c7),_0x2126c4;}[a51_0x44004b(0x2fc)](){const _0x4a9889=a51_0x44004b;console[_0x4a9889(0x2a3)](_0x4a9889(0x20d));const _0x22046b=this[_0x4a9889(0x27c)][_0x4a9889(0x2f2)];for(const [_0x9b2360]of this[_0x4a9889(0x27c)]){this[_0x4a9889(0x21b)](_0x9b2360);}console['log']('🛑\x20Stopped\x20'+_0x22046b+_0x4a9889(0x227));}}function a51_0x4de0(_0x539e01,_0x32e155){const _0x29e4a3=a51_0x29e4();return a51_0x4de0=function(_0x4de050,_0xbd67d8){_0x4de050=_0x4de050-0x1ce;let _0xcaba87=_0x29e4a3[_0x4de050];return _0xcaba87;},a51_0x4de0(_0x539e01,_0x32e155);}exports[a51_0x44004b(0x303)]=VisaMasterCardService;