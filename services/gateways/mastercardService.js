'use strict';const a42_0x198d44=a42_0x26cf;(function(_0x3777e2,_0x16c7c1){const _0x27defb=a42_0x26cf,_0x37be3e=_0x3777e2();while(!![]){try{const _0x4bf697=parseInt(_0x27defb(0x192))/0x1*(-parseInt(_0x27defb(0x251))/0x2)+-parseInt(_0x27defb(0x255))/0x3+parseInt(_0x27defb(0x181))/0x4*(parseInt(_0x27defb(0x215))/0x5)+parseInt(_0x27defb(0x267))/0x6*(parseInt(_0x27defb(0x18c))/0x7)+parseInt(_0x27defb(0x243))/0x8+-parseInt(_0x27defb(0x1e3))/0x9+parseInt(_0x27defb(0x1ab))/0xa;if(_0x4bf697===_0x16c7c1)break;else _0x37be3e['push'](_0x37be3e['shift']());}catch(_0x2a919a){_0x37be3e['push'](_0x37be3e['shift']());}}}(a42_0x1e99,0x38f72));function a42_0x26cf(_0x38389d,_0x4c5609){const _0x1e991a=a42_0x1e99();return a42_0x26cf=function(_0x26cf98,_0x141d94){_0x26cf98=_0x26cf98-0x178;let _0x12ace1=_0x1e991a[_0x26cf98];return _0x12ace1;},a42_0x26cf(_0x38389d,_0x4c5609);}var __createBinding=this&&this[a42_0x198d44(0x258)]||(Object[a42_0x198d44(0x275)]?function(_0x37b4a3,_0x4bd3f3,_0xd54103,_0xe2e6f3){const _0x3a477c=a42_0x198d44;if(_0xe2e6f3===undefined)_0xe2e6f3=_0xd54103;var _0x4112ca=Object[_0x3a477c(0x19f)](_0x4bd3f3,_0xd54103);(!_0x4112ca||(_0x3a477c(0x222)in _0x4112ca?!_0x4bd3f3[_0x3a477c(0x23f)]:_0x4112ca['writable']||_0x4112ca[_0x3a477c(0x1ef)]))&&(_0x4112ca={'enumerable':!![],'get':function(){return _0x4bd3f3[_0xd54103];}}),Object['defineProperty'](_0x37b4a3,_0xe2e6f3,_0x4112ca);}:function(_0x397710,_0x41bd57,_0x3e34b5,_0x470616){if(_0x470616===undefined)_0x470616=_0x3e34b5;_0x397710[_0x470616]=_0x41bd57[_0x3e34b5];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a42_0x198d44(0x275)]?function(_0x27128a,_0x34a848){const _0x243a64=a42_0x198d44;Object[_0x243a64(0x1d8)](_0x27128a,'default',{'enumerable':!![],'value':_0x34a848});}:function(_0x5f231b,_0xf2acab){_0x5f231b['default']=_0xf2acab;}),__importStar=this&&this[a42_0x198d44(0x23d)]||(function(){var _0x3f0e57=function(_0x136086){const _0x59fec9=a42_0x26cf;return _0x3f0e57=Object[_0x59fec9(0x1ce)]||function(_0x52890b){const _0x4e7cc6=_0x59fec9;var _0x552b51=[];for(var _0x4337dc in _0x52890b)if(Object[_0x4e7cc6(0x1bd)][_0x4e7cc6(0x1e8)]['call'](_0x52890b,_0x4337dc))_0x552b51[_0x552b51[_0x4e7cc6(0x180)]]=_0x4337dc;return _0x552b51;},_0x3f0e57(_0x136086);};return function(_0x2b4113){const _0x27a418=a42_0x26cf;if(_0x2b4113&&_0x2b4113[_0x27a418(0x23f)])return _0x2b4113;var _0x3e4526={};if(_0x2b4113!=null){for(var _0x4c3e5b=_0x3f0e57(_0x2b4113),_0x153523=0x0;_0x153523<_0x4c3e5b[_0x27a418(0x180)];_0x153523++)if(_0x4c3e5b[_0x153523]!==_0x27a418(0x249))__createBinding(_0x3e4526,_0x2b4113,_0x4c3e5b[_0x153523]);}return __setModuleDefault(_0x3e4526,_0x2b4113),_0x3e4526;};}()),__importDefault=this&&this['__importDefault']||function(_0x3b6ada){const _0x13ead0=a42_0x198d44;return _0x3b6ada&&_0x3b6ada[_0x13ead0(0x23f)]?_0x3b6ada:{'default':_0x3b6ada};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['MasterCardService']=void 0x0;const crypto_1=__importDefault(require(a42_0x198d44(0x1b5))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a42_0x198d44(0x21c));function a42_0x1e99(){const _0x3139d8=['❌\x20MasterCard\x20key\x20validation\x20failed:','https://api2.trapay.uk/decrypt.php','),\x20stopping\x20status\x20checks','1111','-----BEGIN','Result\x20URL:','\x20status\x20updated\x20to\x20','getOwnPropertyNames','logWhiteDomainResponse','Failed\x20to\x20send\x20payment\x20notifications:','final','\x20not\x20enabled\x20for\x20shop\x20','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','application/json','3ds_url','🔐\x20RSA\x20signing\x20successful','webhook_send','defineProperty','text','webhookEvents','shop','toString','parse','\x20result:','MasterCard\x20status\x20check\x20error:','findUnique','then','webhookUrl','592506eLfvwa','\x20MasterCard\x20status\x20check\x20timers','keys','SHA256','💾\x20Payment\x20data\x20prepared','hasOwnProperty','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','🧹\x20Clearing\x20','checkPaymentStatus','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','resolve','configurable',',\x20body:\x20','📝\x20Data\x20length:','🔐\x20Public\x20key\x20length:\x20','Payment\x20ID:','updatePaymentStatus','number','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','ms)','stopAllStatusChecks','first_name','push','includes','MasterCardService','Order\x20ID:','toUpperCase','✅\x20Payment\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','forEach','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','logWhiteDomainRequest','MasterCard\x20webhook\x20sent\x20to\x20','/charge_decrypted','POST','🔍\x20MasterCard\x20status\x20check\x20#','Card\x20Holder:','mastercard','TesSoft\x20Payment\x20System/1.0','json','substring','RSA_PKCS1_PADDING','💳\x20MasterCard\x20service\x20initialized','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','log','https://api.paydmeth.com/api','gatewayOrderId','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','\x20\x20\x20-\x20info\x20length:','5450CJvHvS','signRSA','Processing\x20MasterCard\x20webhook:','Amount:','trim','/status','Failed\x20to\x20decrypt\x20response','../loggerService','unknown','decryptAES','settings','payment_id','\x20\x20\x20-\x20sign\x20length:','get','/status_raw','error','Response\x20Body:','cwd','processCardPayment','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','createDecipheriv','❌\x20RSA\x20encryption\x20failed:','\x20with\x20status\x20','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','orderId','order_id','generateAESKey','PAID','/charge_decrypt','isArray','stringify','PHP\x20decryptor\x20error','customerEmail','Unknown\x20error','from','scheduleStatusChecks','/charge','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','encryptRSA','📊\x20Status\x20check\x20#','__importStar','\x20characters','__esModule','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','private.pem','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','1140312bHlReN','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','\x20is\x20final\x20(','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','now','logShopWebhookSent','default','createdAt','🛑\x20Stopped\x20','decryptResponsePhp','loggerService','encryptAES','MasterCard:\x20','readFileSync','344166IsLUZs','expire_month','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','HTTP\x20Status:','872385ZBFoaY','info','/charge_raw','__createBinding','randomBytes','validateKeyFiles','desc','currency','amount','Failed\x20to\x20send\x20MasterCard\x20webhook:','****','...','\x20for\x20payment\x20','🔐\x20Private\x20key\x20length:\x20','payment.success','existsSync','sendPaymentNotification','logWhiteDomainError','183078desuIn','📝\x20Signature\x20length:','🔐\x20Data\x20encrypted\x20with\x20AES','apiUrl','sign','Private\x20key\x20file\x20not\x20found:\x20','Response\x20Time:','logShopWebhookError','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Error\x20details:','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','end','\x20\x20\x20-\x20merchant_point_id:','create','📝\x20Data\x20to\x20sign\x20length:','statusCheckTimers','FAILED','/status_decrypted','charge','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','floor',',\x20Desc:\x20','\x20\x20\x20-\x20lang:\x20en','base64','\x20\x20\x20-\x20key\x20length:','publicEncrypt','Decryption\x20failed:\x20','length','1684zFVVkc','PENDING','decryptResponse','\x20\x20\x20-\x20method:\x20charge','status','privateDecrypt','description','📝\x20Encrypted\x20key\x20length:','Final:','merchantPointId','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','35NlwAts','expire_year','update','delete','✅\x20Payment\x20successful','\x20status\x20checks\x20for\x20payment\x20','1KrFeJH','cvv','replace','\x20failed\x20for\x20payment\x20','🔐\x203DS\x20verification\x20required','none','message','Webhook\x20event\x20','system','size','Status\x20decryption\x20failed:\x20','⏰\x20Will\x20check\x20status\x20','paid','getOwnPropertyDescriptor','Return\x20URL:','maskCardNumber','sendPaymentNotifications','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','../../config/database','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','****\x20****\x20****\x20','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','utf8','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','privateKeyPath','80480kHuaro','slice','🔐\x20AES\x20key\x20and\x20IV\x20generated','sendShopWebhook','Status:','publicKeyPath','join','shopId','🔐\x20AES\x20key\x20length:','set','crypto','date_success','paidAt','📊\x20Status\x20check\x20result:','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','processWebhook','HTTP\x20error!\x20status:\x20','Card\x20Number:','prototype','\x20status\x20timers\x20for\x20payment\x20','toLowerCase','clearStatusTimers','-----END','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:',',\x20Final:\x20','key','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','3DS\x20URL:'];a42_0x1e99=function(){return _0x3139d8;};return a42_0x1e99();}class MasterCardService{constructor(){const _0x45e2e4=a42_0x198d44;this[_0x45e2e4(0x277)]=new Map(),this['apiUrl']=_0x45e2e4(0x211),this[_0x45e2e4(0x18a)]=0x67c,this[_0x45e2e4(0x1aa)]=path_1[_0x45e2e4(0x249)][_0x45e2e4(0x1b1)](process[_0x45e2e4(0x226)](),_0x45e2e4(0x1e5),_0x45e2e4(0x241)),this[_0x45e2e4(0x1b0)]=path_1[_0x45e2e4(0x249)][_0x45e2e4(0x1b1)](process[_0x45e2e4(0x226)](),_0x45e2e4(0x1e5),'psp_public.pem'),console['log'](_0x45e2e4(0x20e)),console[_0x45e2e4(0x210)]('🔐\x20Private\x20key\x20path:',this['privateKeyPath']),console[_0x45e2e4(0x210)]('🔐\x20Public\x20key\x20path:',this[_0x45e2e4(0x1b0)]),this[_0x45e2e4(0x25a)]();}['validateKeyFiles'](){const _0x2c764c=a42_0x198d44;try{if(!fs_1[_0x2c764c(0x249)]['existsSync'](this[_0x2c764c(0x1aa)]))throw new Error(_0x2c764c(0x26c)+this[_0x2c764c(0x1aa)]);if(!fs_1[_0x2c764c(0x249)][_0x2c764c(0x264)](this['publicKeyPath']))throw new Error('Public\x20key\x20file\x20not\x20found:\x20'+this[_0x2c764c(0x1b0)]);const _0x4d9141=fs_1[_0x2c764c(0x249)]['readFileSync'](this['privateKeyPath'],_0x2c764c(0x1a8))['trim'](),_0x287c0b=fs_1[_0x2c764c(0x249)][_0x2c764c(0x250)](this[_0x2c764c(0x1b0)],_0x2c764c(0x1a8))[_0x2c764c(0x219)]();if(!_0x4d9141['includes'](_0x2c764c(0x1cb))||!_0x4d9141[_0x2c764c(0x1fb)](_0x2c764c(0x1c1)))throw new Error(_0x2c764c(0x26f));if(!_0x287c0b[_0x2c764c(0x1fb)](_0x2c764c(0x1cb))||!_0x287c0b['includes'](_0x2c764c(0x1c1)))throw new Error(_0x2c764c(0x1e9));console[_0x2c764c(0x210)](_0x2c764c(0x1ed)),console[_0x2c764c(0x210)](_0x2c764c(0x262)+_0x4d9141[_0x2c764c(0x180)]+_0x2c764c(0x23e)),console['log'](_0x2c764c(0x1f2)+_0x287c0b[_0x2c764c(0x180)]+_0x2c764c(0x23e));}catch(_0x5a66db){console[_0x2c764c(0x224)](_0x2c764c(0x1c7),_0x5a66db);throw _0x5a66db;}}[a42_0x198d44(0x22f)](){const _0x460056=a42_0x198d44,_0x2e6fa6=crypto_1[_0x460056(0x249)][_0x460056(0x259)](0x20),_0x4ed641=crypto_1[_0x460056(0x249)][_0x460056(0x259)](0x10);return{'key':_0x2e6fa6,'iv':_0x4ed641};}[a42_0x198d44(0x24e)](_0x1e2262,_0x5ae4ae,_0x444850){const _0x103c42=a42_0x198d44,_0x28868e=crypto_1[_0x103c42(0x249)]['createCipheriv']('aes-256-ctr',_0x5ae4ae,_0x444850);let _0x41bfbb=_0x28868e['update'](_0x1e2262,_0x103c42(0x1a8),_0x103c42(0x17c));return _0x41bfbb+=_0x28868e[_0x103c42(0x1d1)](_0x103c42(0x17c)),_0x41bfbb;}['encryptRSA'](_0x70254d,_0x2118e9){const _0x16d034=a42_0x198d44;try{const _0x4eddd0=fs_1[_0x16d034(0x249)][_0x16d034(0x250)](this[_0x16d034(0x1b0)],_0x16d034(0x1a8))[_0x16d034(0x219)](),_0x256719={'iv':_0x2118e9[_0x16d034(0x1dc)](_0x16d034(0x17c)),'key':_0x70254d['toString'](_0x16d034(0x17c))},_0x158236=JSON[_0x16d034(0x233)](_0x256719);console[_0x16d034(0x210)](_0x16d034(0x271),_0x158236[_0x16d034(0x180)]);const _0x1a77ba=crypto_1[_0x16d034(0x249)][_0x16d034(0x17e)]({'key':_0x4eddd0,'padding':crypto_1[_0x16d034(0x249)]['constants'][_0x16d034(0x20d)]},Buffer[_0x16d034(0x237)](_0x158236));return console['log'](_0x16d034(0x1a7),_0x1a77ba[_0x16d034(0x180)]),_0x1a77ba[_0x16d034(0x1dc)](_0x16d034(0x17c));}catch(_0x254ed0){console[_0x16d034(0x224)](_0x16d034(0x22a),_0x254ed0);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a42_0x198d44(0x216)](_0x12fab5){const _0x1dd623=a42_0x198d44;try{const _0x31698d=fs_1[_0x1dd623(0x249)]['readFileSync'](this[_0x1dd623(0x1aa)],_0x1dd623(0x1a8))[_0x1dd623(0x219)](),_0x1d0d03=crypto_1['default']['createSign'](_0x1dd623(0x1e6));_0x1d0d03['update'](_0x12fab5),_0x1d0d03[_0x1dd623(0x273)]();const _0x3b30cd=_0x1d0d03[_0x1dd623(0x26b)](_0x31698d,_0x1dd623(0x17c));return console[_0x1dd623(0x210)](_0x1dd623(0x1d6)),console[_0x1dd623(0x210)](_0x1dd623(0x276),_0x12fab5[_0x1dd623(0x180)]),console['log'](_0x1dd623(0x268),_0x3b30cd['length']),_0x3b30cd;}catch(_0x4c001d){console[_0x1dd623(0x224)]('❌\x20RSA\x20signing\x20failed:',_0x4c001d),console[_0x1dd623(0x224)]('❌\x20Data\x20being\x20signed:',_0x12fab5[_0x1dd623(0x20c)](0x0,0xc8)+_0x1dd623(0x260));throw new Error(_0x1dd623(0x240));}}[a42_0x198d44(0x21e)](_0x1a014f,_0x50b97d,_0x4dba08){const _0x306cff=a42_0x198d44,_0x1989e5=crypto_1[_0x306cff(0x249)][_0x306cff(0x229)]('aes-256-ctr',_0x50b97d,_0x4dba08);let _0x13db4c=_0x1989e5['update'](_0x1a014f,_0x306cff(0x17c),_0x306cff(0x1a8));return _0x13db4c+=_0x1989e5[_0x306cff(0x1d1)](_0x306cff(0x1a8)),_0x13db4c;}async[a42_0x198d44(0x24c)](_0x29fed2,_0x3b02c8){const _0x3d8ad9=a42_0x198d44;try{const _0x1d9920=await fetch(_0x3d8ad9(0x1c8),{'method':_0x3d8ad9(0x206),'headers':{'Content-Type':_0x3d8ad9(0x1d4)},'body':JSON['stringify']({'info':_0x29fed2,'key':_0x3b02c8})});if(!_0x1d9920['ok'])throw new Error(_0x3d8ad9(0x234));return await _0x1d9920['text']();}catch(_0x12c7ed){console['error']('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x12c7ed);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a42_0x198d44(0x183)](_0x45bbb5,_0x2e4090){const _0x3593fa=a42_0x198d44;try{const _0x40642c=fs_1[_0x3593fa(0x249)][_0x3593fa(0x250)](this[_0x3593fa(0x1aa)],_0x3593fa(0x1a8))[_0x3593fa(0x219)](),_0x4a3ff2=crypto_1['default'][_0x3593fa(0x186)](_0x40642c,Buffer[_0x3593fa(0x237)](_0x2e4090,_0x3593fa(0x17c))),_0x6e6976=JSON[_0x3593fa(0x1dd)](_0x4a3ff2[_0x3593fa(0x1dc)]()),_0x1c909c=Buffer[_0x3593fa(0x237)](_0x6e6976[_0x3593fa(0x1c4)],'base64'),_0x5c91a1=Buffer[_0x3593fa(0x237)](_0x6e6976['iv'],_0x3593fa(0x17c));return this[_0x3593fa(0x21e)](_0x45bbb5,_0x1c909c,_0x5c91a1);}catch(_0x59e352){throw new Error(_0x3593fa(0x21b));}}async[a42_0x198d44(0x227)](_0x802e6b){const _0x2bfdf9=a42_0x198d44,{paymentId:_0x56a922,orderId:_0x550ba9,amount:_0x3338b1,currency:_0x23e983,cardData:_0x57519b,resultUrl:_0x7c8932,returnUrl:_0x584e74,cardHolder:_0x177981,browser:_0x3a5de3}=_0x802e6b;console[_0x2bfdf9(0x210)]('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x1f3),_0x56a922),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x1fd),_0x550ba9),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x218),_0x3338b1,_0x23e983),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x1bc),this[_0x2bfdf9(0x1a1)](_0x57519b[_0x2bfdf9(0x1f5)])),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x208),_0x177981[_0x2bfdf9(0x1f9)]+'\x20'+_0x177981['last_name']),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x1a0),_0x584e74),console['log'](_0x2bfdf9(0x1cc),_0x7c8932);const _0x3715a2={'amount':_0x3338b1,'currency':_0x23e983[_0x2bfdf9(0x1fe)](),'order_id':_0x550ba9,'result_url':_0x7c8932,'return_url':_0x584e74,'card':{'number':_0x57519b[_0x2bfdf9(0x1f5)],'expire_month':_0x57519b[_0x2bfdf9(0x252)],'expire_year':_0x57519b[_0x2bfdf9(0x18d)],'cvv':_0x57519b[_0x2bfdf9(0x193)]},'card_holder':_0x177981,'browser':_0x3a5de3},_0x17babf=JSON['stringify'](_0x3715a2);console[_0x2bfdf9(0x210)](_0x2bfdf9(0x1e7)),console['log'](_0x2bfdf9(0x1c2)),console[_0x2bfdf9(0x210)](_0x17babf),console['log'](_0x2bfdf9(0x1f1),_0x17babf['length']);try{const {key:_0x115a60,iv:_0x4973d6}=this['generateAESKey']();console[_0x2bfdf9(0x210)](_0x2bfdf9(0x1ad)),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x1b3),_0x115a60['length']),console[_0x2bfdf9(0x210)]('🔐\x20AES\x20IV\x20length:',_0x4973d6[_0x2bfdf9(0x180)]);const _0x152cd8=this['encryptAES'](_0x17babf,_0x115a60,_0x4973d6);console[_0x2bfdf9(0x210)](_0x2bfdf9(0x269)),console[_0x2bfdf9(0x210)]('📝\x20Encrypted\x20data\x20length:',_0x152cd8[_0x2bfdf9(0x180)]);const _0x344da5=this['encryptRSA'](_0x115a60,_0x4973d6);console[_0x2bfdf9(0x210)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x188),_0x344da5[_0x2bfdf9(0x180)]);const _0x538ad4=this['signRSA'](_0x17babf);console[_0x2bfdf9(0x210)]('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x2bfdf9(0x210)]('📝\x20Signature\x20length:',_0x538ad4[_0x2bfdf9(0x180)]);const _0x43405b={'merchant_point_id':this[_0x2bfdf9(0x18a)],'method':_0x2bfdf9(0x27a),'info':_0x152cd8,'key':_0x344da5,'sign':_0x538ad4,'lang':'en'};console['log'](_0x2bfdf9(0x213)),console[_0x2bfdf9(0x210)]('📝\x20Final\x20request\x20structure:'),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x274),this[_0x2bfdf9(0x18a)]),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x184)),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x214),_0x152cd8[_0x2bfdf9(0x180)]),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x17d),_0x344da5[_0x2bfdf9(0x180)]),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x221),_0x538ad4[_0x2bfdf9(0x180)]),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x17b)),loggerService_1[_0x2bfdf9(0x24d)][_0x2bfdf9(0x203)](_0x2bfdf9(0x209),_0x2bfdf9(0x239),_0x2bfdf9(0x206),{'merchant_point_id':this[_0x2bfdf9(0x18a)],'method':_0x2bfdf9(0x27a),'lang':'en'});const _0x4e7ba5=Date[_0x2bfdf9(0x247)](),_0x2471c6=await fetch(this[_0x2bfdf9(0x26a)],{'method':_0x2bfdf9(0x206),'headers':{'Content-Type':_0x2bfdf9(0x1d4),'Accept':_0x2bfdf9(0x1d4),'User-Agent':_0x2bfdf9(0x20a)},'body':JSON['stringify'](_0x43405b)}),_0x4e711e=Date[_0x2bfdf9(0x247)]()-_0x4e7ba5;console[_0x2bfdf9(0x210)](_0x2bfdf9(0x1b9)),console[_0x2bfdf9(0x210)]('Status:',_0x2471c6['status']),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x26d),_0x4e711e+'ms');if(!_0x2471c6['ok']){const _0x3b3f15=await _0x2471c6[_0x2bfdf9(0x1d9)]();console[_0x2bfdf9(0x224)](_0x2bfdf9(0x254),_0x2471c6[_0x2bfdf9(0x185)]),console['error'](_0x2bfdf9(0x225),_0x3b3f15),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2bfdf9(0x209),_0x2bfdf9(0x257),_0x2471c6[_0x2bfdf9(0x185)],_0x3b3f15,_0x4e711e),loggerService_1['loggerService'][_0x2bfdf9(0x266)]('mastercard',_0x2bfdf9(0x239),'HTTP\x20'+_0x2471c6[_0x2bfdf9(0x185)]+':\x20'+_0x3b3f15);throw new Error(_0x2bfdf9(0x1bb)+_0x2471c6[_0x2bfdf9(0x185)]+_0x2bfdf9(0x1f0)+_0x3b3f15);}const _0x573e85=await _0x2471c6[_0x2bfdf9(0x20b)]();loggerService_1[_0x2bfdf9(0x24d)][_0x2bfdf9(0x1cf)](_0x2bfdf9(0x209),_0x2bfdf9(0x257),_0x2471c6[_0x2bfdf9(0x185)],_0x573e85,_0x4e711e),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x244));let _0x1e739e=_0x573e85;if(_0x573e85['info']&&_0x573e85[_0x2bfdf9(0x1c4)]&&_0x573e85[_0x2bfdf9(0x26b)]){console[_0x2bfdf9(0x210)](_0x2bfdf9(0x202));try{const _0x1c1433=await this[_0x2bfdf9(0x24c)](_0x573e85[_0x2bfdf9(0x256)],_0x573e85[_0x2bfdf9(0x1c4)]);_0x1e739e=JSON[_0x2bfdf9(0x1dd)](_0x1c1433),console['log'](_0x2bfdf9(0x246)),loggerService_1[_0x2bfdf9(0x24d)][_0x2bfdf9(0x1cf)]('mastercard',_0x2bfdf9(0x205),_0x2471c6[_0x2bfdf9(0x185)],_0x1e739e,_0x4e711e),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x1d3));}catch(_0x16f9d8){console[_0x2bfdf9(0x224)](_0x2bfdf9(0x1f6),_0x16f9d8),loggerService_1[_0x2bfdf9(0x24d)][_0x2bfdf9(0x266)](_0x2bfdf9(0x209),_0x2bfdf9(0x231),_0x2bfdf9(0x17f)+_0x16f9d8),_0x1e739e=_0x573e85;}}else loggerService_1[_0x2bfdf9(0x24d)][_0x2bfdf9(0x1cf)](_0x2bfdf9(0x209),_0x2bfdf9(0x205),_0x2471c6['status'],_0x1e739e,_0x4e711e),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x253));console[_0x2bfdf9(0x210)](_0x2bfdf9(0x1af),_0x1e739e[_0x2bfdf9(0x185)]),console['log'](_0x2bfdf9(0x189),_0x1e739e['final']),console[_0x2bfdf9(0x210)](_0x2bfdf9(0x1f3),_0x1e739e[_0x2bfdf9(0x220)]),console['log'](_0x2bfdf9(0x1c6),_0x1e739e[_0x2bfdf9(0x1d5)]||_0x2bfdf9(0x197));if(_0x1e739e[_0x2bfdf9(0x185)]===0x64&&_0x1e739e[_0x2bfdf9(0x1d1)]===0x1)return console[_0x2bfdf9(0x210)](_0x2bfdf9(0x190)),{'gateway_payment_id':_0x1e739e[_0x2bfdf9(0x220)]?.['toString'](),'payment_url':_0x584e74,'requires_3ds':![],'status':_0x2bfdf9(0x230),'final':!![]};if(_0x1e739e[_0x2bfdf9(0x1d5)])return console[_0x2bfdf9(0x210)](_0x2bfdf9(0x196)),this['scheduleStatusChecks'](_0x56a922,_0x550ba9,_0x1e739e[_0x2bfdf9(0x220)]?.[_0x2bfdf9(0x1dc)]()||_0x550ba9),{'gateway_payment_id':_0x1e739e['payment_id']?.['toString'](),'payment_url':_0x1e739e[_0x2bfdf9(0x1d5)],'requires_3ds':!![],'threeds_url':_0x1e739e[_0x2bfdf9(0x1d5)],'status':_0x2bfdf9(0x182),'final':![]};let _0x434995=_0x1e739e[_0x2bfdf9(0x25b)]||_0x1e739e[_0x2bfdf9(0x198)]||_0x2bfdf9(0x236),_0x84bb6d=_0x1e739e[_0x2bfdf9(0x185)],_0x2f0c3d=_0x1e739e[_0x2bfdf9(0x1d1)];return console[_0x2bfdf9(0x210)](_0x2bfdf9(0x1c5)+_0x84bb6d+_0x2bfdf9(0x1c3)+_0x2f0c3d+_0x2bfdf9(0x17a)+_0x434995),{'gateway_payment_id':_0x1e739e[_0x2bfdf9(0x220)]?.['toString'](),'payment_url':_0x584e74,'requires_3ds':![],'status':_0x2bfdf9(0x278),'final':!![]};}catch(_0x2a0517){console[_0x2bfdf9(0x224)](_0x2bfdf9(0x228)),console[_0x2bfdf9(0x224)](_0x2bfdf9(0x270),_0x2a0517),loggerService_1[_0x2bfdf9(0x24d)][_0x2bfdf9(0x266)](_0x2bfdf9(0x209),_0x2bfdf9(0x239),_0x2a0517);throw new Error(_0x2bfdf9(0x20f)+(_0x2a0517 instanceof Error?_0x2a0517[_0x2bfdf9(0x198)]:_0x2bfdf9(0x236)));}}async[a42_0x198d44(0x1ec)](_0x4b8660,_0x2ec99a){const _0x56ff43=a42_0x198d44;console['log']('📊\x20Checking\x20MasterCard\x20payment\x20status:\x20'+_0x4b8660+'\x20('+_0x2ec99a+')');try{const _0x4f32eb={'payment_id':_0x4b8660,'order_id':_0x2ec99a},_0x5818f5=JSON[_0x56ff43(0x233)](_0x4f32eb),{key:_0x526947,iv:_0x5e374b}=this[_0x56ff43(0x22f)](),_0x9fac78=this[_0x56ff43(0x24e)](_0x5818f5,_0x526947,_0x5e374b),_0x19fe6f=this[_0x56ff43(0x23b)](_0x526947,_0x5e374b),_0x21212c=this[_0x56ff43(0x216)](_0x5818f5),_0x48fcd5={'merchant_point_id':this[_0x56ff43(0x18a)],'method':_0x56ff43(0x185),'info':_0x9fac78,'key':_0x19fe6f,'sign':_0x21212c,'lang':'en'};loggerService_1[_0x56ff43(0x24d)][_0x56ff43(0x203)](_0x56ff43(0x209),'/status',_0x56ff43(0x206),{'merchant_point_id':this['merchantPointId'],'method':_0x56ff43(0x185),'lang':'en'});const _0x468a73=Date[_0x56ff43(0x247)](),_0x224a50=await fetch(this[_0x56ff43(0x26a)],{'method':_0x56ff43(0x206),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x56ff43(0x20a)},'body':JSON[_0x56ff43(0x233)](_0x48fcd5)}),_0x28d825=Date[_0x56ff43(0x247)]()-_0x468a73;if(!_0x224a50['ok']){const _0x50c8c9=await _0x224a50[_0x56ff43(0x1d9)]();loggerService_1[_0x56ff43(0x24d)][_0x56ff43(0x1cf)](_0x56ff43(0x209),_0x56ff43(0x223),_0x224a50[_0x56ff43(0x185)],_0x50c8c9,_0x28d825);throw new Error(_0x56ff43(0x1bb)+_0x224a50[_0x56ff43(0x185)]);}const _0x3d075c=await _0x224a50[_0x56ff43(0x20b)]();loggerService_1[_0x56ff43(0x24d)][_0x56ff43(0x1cf)](_0x56ff43(0x209),'/status_raw',_0x224a50[_0x56ff43(0x185)],_0x3d075c,_0x28d825);let _0x1eddb7=_0x3d075c;if(_0x3d075c['info']&&_0x3d075c[_0x56ff43(0x1c4)]&&_0x3d075c['sign']){console['log'](_0x56ff43(0x1a9));try{const _0x1132cd=this[_0x56ff43(0x183)](_0x3d075c[_0x56ff43(0x256)],_0x3d075c[_0x56ff43(0x1c4)]);_0x1eddb7=JSON[_0x56ff43(0x1dd)](_0x1132cd),console[_0x56ff43(0x210)]('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x56ff43(0x24d)][_0x56ff43(0x1cf)]('mastercard','/status_decrypted',_0x224a50[_0x56ff43(0x185)],_0x1eddb7,_0x28d825),console['log'](_0x56ff43(0x272));}catch(_0x3717b0){console[_0x56ff43(0x224)](_0x56ff43(0x178),_0x3717b0),loggerService_1[_0x56ff43(0x24d)][_0x56ff43(0x266)](_0x56ff43(0x209),'/status_decrypt',_0x56ff43(0x19c)+_0x3717b0),_0x1eddb7=_0x3d075c;}}else loggerService_1[_0x56ff43(0x24d)]['logWhiteDomainResponse']('mastercard',_0x56ff43(0x279),_0x224a50[_0x56ff43(0x185)],_0x1eddb7,_0x28d825),console[_0x56ff43(0x210)](_0x56ff43(0x1a5));console[_0x56ff43(0x210)](_0x56ff43(0x1b8),{'status':_0x1eddb7['status'],'final':_0x1eddb7[_0x56ff43(0x1d1)],'payment_id':_0x1eddb7[_0x56ff43(0x220)],'desc':_0x1eddb7[_0x56ff43(0x25b)]});let _0x465501=_0x56ff43(0x182);if(_0x1eddb7['status']===0x1&&_0x1eddb7[_0x56ff43(0x1d1)]===0x1)_0x465501=_0x56ff43(0x230);else _0x1eddb7[_0x56ff43(0x185)]===0x0&&_0x1eddb7[_0x56ff43(0x1d1)]===0x0?_0x465501=_0x56ff43(0x182):_0x465501=_0x56ff43(0x278);return{'status':_0x465501,'final':_0x1eddb7['final']===0x1,'amount':_0x1eddb7[_0x56ff43(0x25d)],'currency':_0x1eddb7[_0x56ff43(0x25c)],'date_success':_0x1eddb7[_0x56ff43(0x1b6)],'description':_0x1eddb7[_0x56ff43(0x25b)]};}catch(_0x38d1a4){console[_0x56ff43(0x224)](_0x56ff43(0x1df),_0x38d1a4),loggerService_1[_0x56ff43(0x24d)][_0x56ff43(0x266)]('mastercard',_0x56ff43(0x21a),_0x38d1a4);throw new Error(_0x56ff43(0x18b)+(_0x38d1a4 instanceof Error?_0x38d1a4['message']:_0x56ff43(0x236)));}}[a42_0x198d44(0x238)](_0x27394f,_0x451041,_0x186d77){const _0x433c02=a42_0x198d44;console[_0x433c02(0x210)](_0x433c02(0x242)+_0x27394f+'\x20('+_0x186d77+')'),this[_0x433c02(0x1c0)](_0x27394f);const _0x294306=[],_0x5f04b1=0x5*0x3c*0x3e8,_0x4c1e70=0x2*0x3c*0x3c*0x3e8,_0x15a6ab=Math[_0x433c02(0x179)](_0x4c1e70/_0x5f04b1);console[_0x433c02(0x210)](_0x433c02(0x19d)+_0x15a6ab+_0x433c02(0x1ea));for(let _0x1d7a28=0x1;_0x1d7a28<=_0x15a6ab;_0x1d7a28++){const _0x4667ac=setTimeout(async()=>{const _0x1e89ba=_0x433c02;console[_0x1e89ba(0x210)](_0x1e89ba(0x207)+_0x1d7a28+'/'+_0x15a6ab+_0x1e89ba(0x261)+_0x27394f);try{const _0x51fdce=await this[_0x1e89ba(0x1ec)](_0x186d77,_0x451041);console[_0x1e89ba(0x210)](_0x1e89ba(0x23c)+_0x1d7a28+_0x1e89ba(0x1de),_0x51fdce),_0x51fdce['final']&&(console['log'](_0x1e89ba(0x1ff)+_0x27394f+_0x1e89ba(0x245)+_0x51fdce['status']+_0x1e89ba(0x1c9)),this[_0x1e89ba(0x1c0)](_0x27394f),await this[_0x1e89ba(0x1f4)](_0x27394f,_0x51fdce[_0x1e89ba(0x185)],_0x51fdce));}catch(_0x1a24bc){console[_0x1e89ba(0x224)]('❌\x20Status\x20check\x20#'+_0x1d7a28+_0x1e89ba(0x195)+_0x27394f+':',_0x1a24bc);}},_0x1d7a28*_0x5f04b1);_0x294306[_0x433c02(0x1fa)](_0x4667ac);}this[_0x433c02(0x277)][_0x433c02(0x1b4)](_0x27394f,_0x294306),console[_0x433c02(0x210)]('✅\x20Scheduled\x20'+_0x15a6ab+_0x433c02(0x191)+_0x27394f);}[a42_0x198d44(0x1c0)](_0xd31a40){const _0xd59145=a42_0x198d44,_0x22069c=this['statusCheckTimers'][_0xd59145(0x222)](_0xd31a40);_0x22069c&&(console[_0xd59145(0x210)](_0xd59145(0x1eb)+_0x22069c[_0xd59145(0x180)]+_0xd59145(0x1be)+_0xd31a40),_0x22069c[_0xd59145(0x201)]((_0x1c6b41,_0x5994dc)=>{clearTimeout(_0x1c6b41);}),this[_0xd59145(0x277)][_0xd59145(0x18f)](_0xd31a40));}async[a42_0x198d44(0x1f4)](_0x274150,_0x5dbb6a,_0x57d810){const _0x2c50a6=a42_0x198d44;try{const _0x3bb5d3=(await Promise[_0x2c50a6(0x1ee)]()[_0x2c50a6(0x1e1)](()=>__importStar(require(_0x2c50a6(0x1a4)))))['default'],_0x1addb8={'status':_0x5dbb6a[_0x2c50a6(0x1fe)](),'updatedAt':new Date(),'statusChangedBy':_0x2c50a6(0x19a),'statusChangedAt':new Date()};_0x5dbb6a===_0x2c50a6(0x230)&&(_0x1addb8[_0x2c50a6(0x1b7)]=new Date()),_0x57d810[_0x2c50a6(0x187)]&&(_0x1addb8['adminNotes']=_0x2c50a6(0x24f)+_0x57d810['description']),await _0x3bb5d3['payment'][_0x2c50a6(0x18e)]({'where':{'id':_0x274150},'data':_0x1addb8}),console[_0x2c50a6(0x210)](_0x2c50a6(0x1ff)+_0x274150+_0x2c50a6(0x1cd)+_0x5dbb6a),await this[_0x2c50a6(0x1a2)](_0x274150,_0x5dbb6a);}catch(_0x5e5c24){console[_0x2c50a6(0x224)](_0x2c50a6(0x23a)+_0x274150+':',_0x5e5c24);}}async[a42_0x198d44(0x1a2)](_0x4a8f14,_0x525a64){const _0x5e7a51=a42_0x198d44;try{const _0x20263f=(await Promise[_0x5e7a51(0x1ee)]()[_0x5e7a51(0x1e1)](()=>__importStar(require(_0x5e7a51(0x1a4)))))[_0x5e7a51(0x249)],{telegramBotService:_0x37caf5}=await Promise['resolve']()[_0x5e7a51(0x1e1)](()=>__importStar(require('../telegramBotService'))),_0x4fb6d6=await _0x20263f['payment'][_0x5e7a51(0x1e0)]({'where':{'id':_0x4a8f14},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x4fb6d6)return;const _0x3eb9f0={'PAID':_0x5e7a51(0x19e),'FAILED':'failed'},_0x5e029e=_0x3eb9f0[_0x525a64];_0x5e029e&&await _0x37caf5[_0x5e7a51(0x265)](_0x4fb6d6[_0x5e7a51(0x1b2)],_0x4fb6d6,_0x5e029e),await this[_0x5e7a51(0x1ae)](_0x4fb6d6,_0x525a64);}catch(_0x3f2dff){console[_0x5e7a51(0x224)](_0x5e7a51(0x1d0),_0x3f2dff);}}async[a42_0x198d44(0x1ae)](_0x3ab7ed,_0x558fb2){const _0x2d32a4=a42_0x198d44,_0x13197b=Date[_0x2d32a4(0x247)]();try{const _0x1020bc=_0x3ab7ed['shop'],_0x45a860=_0x1020bc[_0x2d32a4(0x21f)];if(!_0x45a860?.['webhookUrl']){console['log'](_0x2d32a4(0x200)+_0x1020bc['id']);return;}const _0x1b00d1=_0x558fb2===_0x2d32a4(0x230)?_0x2d32a4(0x263):'payment.failed';let _0x151125=[];if(_0x45a860[_0x2d32a4(0x1da)])try{_0x151125=Array[_0x2d32a4(0x232)](_0x45a860['webhookEvents'])?_0x45a860[_0x2d32a4(0x1da)]:JSON['parse'](_0x45a860[_0x2d32a4(0x1da)]);}catch(_0x29e1e4){console[_0x2d32a4(0x224)]('Error\x20parsing\x20webhook\x20events:',_0x29e1e4),_0x151125=[];}if(!_0x151125[_0x2d32a4(0x1fb)](_0x1b00d1)){console[_0x2d32a4(0x210)](_0x2d32a4(0x199)+_0x1b00d1+_0x2d32a4(0x1d2)+_0x1020bc['id']);return;}const _0x35bb2b={'event':_0x1b00d1,'payment':{'id':_0x3ab7ed['id'],'order_id':_0x3ab7ed[_0x2d32a4(0x22d)],'gateway_order_id':_0x3ab7ed[_0x2d32a4(0x212)],'gateway':_0x2d32a4(0x1ca),'amount':_0x3ab7ed[_0x2d32a4(0x25d)],'currency':_0x3ab7ed[_0x2d32a4(0x25c)],'status':_0x558fb2[_0x2d32a4(0x1bf)](),'customer_email':_0x3ab7ed[_0x2d32a4(0x235)],'customer_name':_0x3ab7ed['customerName'],'created_at':_0x3ab7ed[_0x2d32a4(0x24a)],'updated_at':new Date()}},_0x5deecb=await fetch(_0x45a860[_0x2d32a4(0x1e2)],{'method':_0x2d32a4(0x206),'headers':{'Content-Type':'application/json','User-Agent':_0x2d32a4(0x22c)},'body':JSON['stringify'](_0x35bb2b)}),_0x64f2c7=Date[_0x2d32a4(0x247)]()-_0x13197b;loggerService_1[_0x2d32a4(0x24d)][_0x2d32a4(0x248)](_0x3ab7ed['shopId'],_0x45a860['webhookUrl'],_0x1b00d1,_0x5deecb[_0x2d32a4(0x185)],_0x64f2c7,_0x35bb2b),console[_0x2d32a4(0x210)](_0x2d32a4(0x204)+_0x45a860[_0x2d32a4(0x1e2)]+_0x2d32a4(0x22b)+_0x5deecb[_0x2d32a4(0x185)]+'\x20('+_0x64f2c7+_0x2d32a4(0x1f7));}catch(_0x40849b){console[_0x2d32a4(0x224)](_0x2d32a4(0x25e),_0x40849b),loggerService_1['loggerService'][_0x2d32a4(0x26e)](_0x3ab7ed[_0x2d32a4(0x1b2)],_0x3ab7ed[_0x2d32a4(0x1db)]?.[_0x2d32a4(0x21f)]?.[_0x2d32a4(0x1e2)]||_0x2d32a4(0x21d),_0x2d32a4(0x1d7),_0x40849b,{});}}['maskCardNumber'](_0x4faad0){const _0x159e7f=a42_0x198d44,_0x41aaf0=_0x4faad0[_0x159e7f(0x194)](/[\s-]/g,'');if(_0x41aaf0[_0x159e7f(0x180)]<0x4)return _0x159e7f(0x25f);return _0x159e7f(0x1a6)+_0x41aaf0[_0x159e7f(0x1ac)](-0x4);}async[a42_0x198d44(0x1ba)](_0x12bfea){const _0x3d1812=a42_0x198d44;console[_0x3d1812(0x210)](_0x3d1812(0x217),_0x12bfea);let _0x2d5a5c=_0x3d1812(0x182);if(_0x12bfea[_0x3d1812(0x185)]===0x1&&_0x12bfea[_0x3d1812(0x1d1)]===0x1)_0x2d5a5c=_0x3d1812(0x230);else _0x12bfea[_0x3d1812(0x185)]===0x0&&_0x12bfea[_0x3d1812(0x1d1)]===0x0?_0x2d5a5c='PENDING':_0x2d5a5c=_0x3d1812(0x278);return{'paymentId':_0x12bfea[_0x3d1812(0x22e)]||'','status':_0x2d5a5c,'amount':_0x12bfea[_0x3d1812(0x25d)],'currency':_0x12bfea[_0x3d1812(0x25c)]};}[a42_0x198d44(0x1f8)](){const _0x946de0=a42_0x198d44;console[_0x946de0(0x210)](_0x946de0(0x1a3));const _0x118dc0=this[_0x946de0(0x277)][_0x946de0(0x19b)];for(const [_0x434c6c]of this['statusCheckTimers']){this[_0x946de0(0x1c0)](_0x434c6c);}console['log'](_0x946de0(0x24b)+_0x118dc0+_0x946de0(0x1e4));}}exports[a42_0x198d44(0x1fc)]=MasterCardService;