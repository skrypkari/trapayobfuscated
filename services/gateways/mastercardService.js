'use strict';const a42_0x30124a=a42_0x4ed3;(function(_0x512c0a,_0x14058f){const _0x361d48=a42_0x4ed3,_0x5987f2=_0x512c0a();while(!![]){try{const _0x2d1066=-parseInt(_0x361d48(0xfb))/0x1*(parseInt(_0x361d48(0x147))/0x2)+parseInt(_0x361d48(0x80))/0x3+parseInt(_0x361d48(0x100))/0x4*(-parseInt(_0x361d48(0xbb))/0x5)+parseInt(_0x361d48(0xf4))/0x6*(-parseInt(_0x361d48(0x15f))/0x7)+-parseInt(_0x361d48(0x160))/0x8*(-parseInt(_0x361d48(0xce))/0x9)+parseInt(_0x361d48(0xdd))/0xa*(-parseInt(_0x361d48(0xd4))/0xb)+-parseInt(_0x361d48(0x104))/0xc*(-parseInt(_0x361d48(0x150))/0xd);if(_0x2d1066===_0x14058f)break;else _0x5987f2['push'](_0x5987f2['shift']());}catch(_0x5c4606){_0x5987f2['push'](_0x5987f2['shift']());}}}(a42_0x4d8c,0x72ba3));var __createBinding=this&&this[a42_0x30124a(0x9c)]||(Object['create']?function(_0x1397a6,_0x5aeb6e,_0x47e51a,_0x4d5a42){const _0x3059d7=a42_0x30124a;if(_0x4d5a42===undefined)_0x4d5a42=_0x47e51a;var _0x2526d7=Object[_0x3059d7(0x98)](_0x5aeb6e,_0x47e51a);(!_0x2526d7||('get'in _0x2526d7?!_0x5aeb6e[_0x3059d7(0xd7)]:_0x2526d7[_0x3059d7(0x8f)]||_0x2526d7[_0x3059d7(0xd3)]))&&(_0x2526d7={'enumerable':!![],'get':function(){return _0x5aeb6e[_0x47e51a];}}),Object[_0x3059d7(0x152)](_0x1397a6,_0x4d5a42,_0x2526d7);}:function(_0x29d9e0,_0x367237,_0x3f8974,_0x4ec8e1){if(_0x4ec8e1===undefined)_0x4ec8e1=_0x3f8974;_0x29d9e0[_0x4ec8e1]=_0x367237[_0x3f8974];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a42_0x30124a(0x116)]?function(_0x2a1b86,_0x5109f2){const _0x38426a=a42_0x30124a;Object[_0x38426a(0x152)](_0x2a1b86,'default',{'enumerable':!![],'value':_0x5109f2});}:function(_0x15e2f2,_0x2de2ae){_0x15e2f2['default']=_0x2de2ae;}),__importStar=this&&this[a42_0x30124a(0xb7)]||(function(){var _0x508396=function(_0x3ac409){const _0x17dbd8=a42_0x4ed3;return _0x508396=Object[_0x17dbd8(0xb8)]||function(_0x9d7b8c){const _0x196313=_0x17dbd8;var _0x18720e=[];for(var _0x216b21 in _0x9d7b8c)if(Object[_0x196313(0x140)]['hasOwnProperty']['call'](_0x9d7b8c,_0x216b21))_0x18720e[_0x18720e[_0x196313(0x87)]]=_0x216b21;return _0x18720e;},_0x508396(_0x3ac409);};return function(_0x18213c){const _0x342341=a42_0x4ed3;if(_0x18213c&&_0x18213c[_0x342341(0xd7)])return _0x18213c;var _0xfbc2f3={};if(_0x18213c!=null){for(var _0x509a4b=_0x508396(_0x18213c),_0x37b453=0x0;_0x37b453<_0x509a4b[_0x342341(0x87)];_0x37b453++)if(_0x509a4b[_0x37b453]!==_0x342341(0xd2))__createBinding(_0xfbc2f3,_0x18213c,_0x509a4b[_0x37b453]);}return __setModuleDefault(_0xfbc2f3,_0x18213c),_0xfbc2f3;};}()),__importDefault=this&&this['__importDefault']||function(_0x1fdc1c){const _0x2c3101=a42_0x30124a;return _0x1fdc1c&&_0x1fdc1c[_0x2c3101(0xd7)]?_0x1fdc1c:{'default':_0x1fdc1c};};function a42_0x4ed3(_0x3b66f3,_0x3cbb24){const _0x4d8c8f=a42_0x4d8c();return a42_0x4ed3=function(_0x4ed3fb,_0x49d150){_0x4ed3fb=_0x4ed3fb-0x7b;let _0x1e9945=_0x4d8c8f[_0x4ed3fb];return _0x1e9945;},a42_0x4ed3(_0x3b66f3,_0x3cbb24);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a42_0x30124a(0x159)]=void 0x0;function a42_0x4d8c(){const _0x1796a6=['log','adminNotes','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','unknown','\x20status\x20checks\x20for\x20payment\x20','/status','Error\x20parsing\x20webhook\x20events:','✅\x20Status\x20response\x20decrypted\x20successfully','🔐\x203DS\x20verification\x20required','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','🔐\x20Data\x20signed\x20with\x20RSA','🛑\x20Stopped\x20','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','3918nRnbiy','size','findUnique','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','merchantPointId','orderId','69883fqZcXh','/charge_raw','expire_year','SHA256','publicEncrypt','1872436fXSMVY','logWhiteDomainError',',\x20Final:\x20','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','24wGOkQf','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','HTTP\x20error!\x20status:\x20','generateAESKey','Status\x20decryption\x20failed:\x20','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','signRSA','🔐\x20Public\x20key\x20path:','maskCardNumber','end','desc',',\x20Desc:\x20','\x20\x20\x20-\x20key\x20length:','\x20characters','first_name','failed','Card\x20Number:','****\x20****\x20****\x20','create','📝\x20Encrypted\x20data\x20length:','stringify','\x20not\x20enabled\x20for\x20shop\x20','utf8','payment.success','📝\x20Data\x20to\x20sign\x20length:','status','sign','error','MasterCard\x20webhook\x20sent\x20to\x20','FAILED','resolve','https://api2.trapay.uk/decrypt.php','base64','Order\x20ID:','isArray','🔍\x20MasterCard\x20status\x20check\x20#','expire_month','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Error\x20details:','https://api.paydmeth.com/api','Result\x20URL:','✅\x20Scheduled\x20','then','TesSoft\x20Payment\x20System/1.0','customerEmail','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','charge','\x20for\x20payment\x20','🔐\x20Public\x20key\x20length:\x20','none','delete','shopId','statusCheckTimers','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','paid','/charge','includes','json','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','path','prototype','privateDecrypt','🔐\x20AES\x20key\x20and\x20IV\x20generated','ms)','Processing\x20MasterCard\x20webhook:','Final:','logWhiteDomainResponse','4tgNfgB','trim','now','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','webhookEvents','../../config/database','date_success','PHP\x20decryptor\x20error','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','6007313spSuvA','createCipheriv','defineProperty','final','/status_raw','Unknown\x20error','randomBytes','MasterCard:\x20','❌\x20RSA\x20encryption\x20failed:','MasterCardService','PENDING','/status_decrypted','message','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','validateKeyFiles','2954aFHfbk','32KSRobJ','clearStatusTimers','📝\x20Data\x20length:','from','webhook_send','keys','encryptRSA','🔐\x20AES\x20IV\x20length:','info','readFileSync','🧹\x20Clearing\x20','privateKeyPath','update','🔐\x20Data\x20encrypted\x20with\x20AES','/status_decrypt','payment_id','aes-256-ctr','logShopWebhookSent','loggerService','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','❌\x20Data\x20being\x20signed:','decryptResponsePhp','Failed\x20to\x20send\x20payment\x20notifications:','parse','📊\x20Status\x20check\x20result:','1833261FfcVxX','replace','-----END','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','\x20failed\x20for\x20payment\x20','updatePaymentStatus','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','length','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','Status:','amount','logWhiteDomainRequest','/charge_decrypted','webhookUrl','toString','writable','Payment\x20ID:','****','text','...','decryptAES','HTTP\x20Status:','forEach','shop','getOwnPropertyDescriptor','processWebhook','POST','-----BEGIN','__createBinding','key','1111','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','checkPaymentStatus','\x20status\x20updated\x20to\x20','Response\x20Time:','private.pem','⏰\x20Will\x20check\x20status\x20','3ds_url','application/json','Failed\x20to\x20send\x20MasterCard\x20webhook:','publicKeyPath','gatewayOrderId','mastercard','\x20\x20\x20-\x20lang:\x20en','Card\x20Holder:','sendPaymentNotifications','push','💳\x20MasterCard\x20service\x20initialized','encryptAES','RSA_PKCS1_PADDING','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','logShopWebhookError','/charge_decrypt','✅\x20Payment\x20','__importStar','getOwnPropertyNames','constants','\x20\x20\x20-\x20sign\x20length:','5hwxqAF','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','Webhook\x20event\x20','\x20\x20\x20-\x20info\x20length:','settings','../telegramBotService','floor','createdAt','toLowerCase','currency','join','description','📝\x20Encrypted\x20key\x20length:','\x20result:','toUpperCase','PAID','../loggerService','❌\x20PHP\x20decryptor\x20request\x20failed:','payment','1291995gSAlMV','),\x20stopping\x20status\x20checks','sendPaymentNotification','❌\x20RSA\x20signing\x20failed:','default','configurable','1663519ZPnoRJ','Amount:','cvv','__esModule','sendShopWebhook','HTTP\x20','Failed\x20to\x20decrypt\x20response','paidAt','slice','50LwUqQd','scheduleStatusChecks','✅\x20Payment\x20successful','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','payment.failed','number','stopAllStatusChecks','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','apiUrl','🔐\x20RSA\x20signing\x20successful'];a42_0x4d8c=function(){return _0x1796a6;};return a42_0x4d8c();}const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x30124a(0x13f))),loggerService_1=require(a42_0x30124a(0xcb));class MasterCardService{constructor(){const _0x21f062=a42_0x30124a;this[_0x21f062(0x138)]=new Map(),this[_0x21f062(0xe5)]=_0x21f062(0x12b),this[_0x21f062(0xf9)]=0x67c,this[_0x21f062(0x16b)]=path_1[_0x21f062(0xd2)][_0x21f062(0xc5)](process['cwd'](),_0x21f062(0x165),_0x21f062(0xa4)),this['publicKeyPath']=path_1[_0x21f062(0xd2)][_0x21f062(0xc5)](process['cwd'](),_0x21f062(0x165),'psp_public.pem'),console[_0x21f062(0xe7)](_0x21f062(0xb0)),console[_0x21f062(0xe7)]('🔐\x20Private\x20key\x20path:',this[_0x21f062(0x16b)]),console[_0x21f062(0xe7)](_0x21f062(0x10b),this[_0x21f062(0xa9)]),this['validateKeyFiles']();}[a42_0x30124a(0x15e)](){const _0x2ef560=a42_0x30124a;try{if(!fs_1[_0x2ef560(0xd2)]['existsSync'](this[_0x2ef560(0x16b)]))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this['privateKeyPath']);if(!fs_1[_0x2ef560(0xd2)]['existsSync'](this[_0x2ef560(0xa9)]))throw new Error('Public\x20key\x20file\x20not\x20found:\x20'+this[_0x2ef560(0xa9)]);const _0x3fb45b=fs_1[_0x2ef560(0xd2)][_0x2ef560(0x169)](this['privateKeyPath'],'utf8')[_0x2ef560(0x148)](),_0x2d87d9=fs_1[_0x2ef560(0xd2)][_0x2ef560(0x169)](this[_0x2ef560(0xa9)],'utf8')['trim']();if(!_0x3fb45b['includes'](_0x2ef560(0x9b))||!_0x3fb45b[_0x2ef560(0x13c)]('-----END'))throw new Error(_0x2ef560(0xf8));if(!_0x2d87d9[_0x2ef560(0x13c)](_0x2ef560(0x9b))||!_0x2d87d9[_0x2ef560(0x13c)](_0x2ef560(0x82)))throw new Error(_0x2ef560(0x129));console[_0x2ef560(0xe7)](_0x2ef560(0x15d)),console[_0x2ef560(0xe7)]('🔐\x20Private\x20key\x20length:\x20'+_0x3fb45b[_0x2ef560(0x87)]+_0x2ef560(0x111)),console[_0x2ef560(0xe7)](_0x2ef560(0x134)+_0x2d87d9[_0x2ef560(0x87)]+'\x20characters');}catch(_0x248f59){console['error']('❌\x20MasterCard\x20key\x20validation\x20failed:',_0x248f59);throw _0x248f59;}}[a42_0x30124a(0x107)](){const _0x401446=a42_0x30124a,_0x56d407=crypto_1['default'][_0x401446(0x156)](0x20),_0x240665=crypto_1[_0x401446(0xd2)][_0x401446(0x156)](0x10);return{'key':_0x56d407,'iv':_0x240665};}[a42_0x30124a(0xb1)](_0x37a3c6,_0x44ffe2,_0x4d5ebb){const _0x25f5e2=a42_0x30124a,_0x145b25=crypto_1[_0x25f5e2(0xd2)][_0x25f5e2(0x151)](_0x25f5e2(0x170),_0x44ffe2,_0x4d5ebb);let _0x2f232a=_0x145b25[_0x25f5e2(0x16c)](_0x37a3c6,_0x25f5e2(0x11a),_0x25f5e2(0x124));return _0x2f232a+=_0x145b25['final'](_0x25f5e2(0x124)),_0x2f232a;}[a42_0x30124a(0x166)](_0x2a1ea1,_0x4bf879){const _0x2fbfbc=a42_0x30124a;try{const _0x5666e2=fs_1[_0x2fbfbc(0xd2)][_0x2fbfbc(0x169)](this[_0x2fbfbc(0xa9)],_0x2fbfbc(0x11a))[_0x2fbfbc(0x148)](),_0x3af76b={'iv':_0x4bf879['toString']('base64'),'key':_0x2a1ea1[_0x2fbfbc(0x8e)]('base64')},_0x281d6b=JSON[_0x2fbfbc(0x118)](_0x3af76b);console[_0x2fbfbc(0xe7)](_0x2fbfbc(0xf3),_0x281d6b[_0x2fbfbc(0x87)]);const _0x383461=crypto_1[_0x2fbfbc(0xd2)][_0x2fbfbc(0xff)]({'key':_0x5666e2,'padding':crypto_1['default'][_0x2fbfbc(0xb9)][_0x2fbfbc(0xb2)]},Buffer[_0x2fbfbc(0x163)](_0x281d6b));return console[_0x2fbfbc(0xe7)](_0x2fbfbc(0x14f),_0x383461[_0x2fbfbc(0x87)]),_0x383461['toString'](_0x2fbfbc(0x124));}catch(_0x4ecfe7){console[_0x2fbfbc(0x11f)](_0x2fbfbc(0x158),_0x4ecfe7);throw new Error(_0x2fbfbc(0x109));}}['signRSA'](_0x2af2f0){const _0x3033ad=a42_0x30124a;try{const _0x1d0963=fs_1[_0x3033ad(0xd2)][_0x3033ad(0x169)](this[_0x3033ad(0x16b)],'utf8')[_0x3033ad(0x148)](),_0xc2f797=crypto_1[_0x3033ad(0xd2)]['createSign'](_0x3033ad(0xfe));_0xc2f797[_0x3033ad(0x16c)](_0x2af2f0),_0xc2f797[_0x3033ad(0x10d)]();const _0x526c06=_0xc2f797[_0x3033ad(0x11e)](_0x1d0963,_0x3033ad(0x124));return console[_0x3033ad(0xe7)](_0x3033ad(0xe6)),console[_0x3033ad(0xe7)](_0x3033ad(0x11c),_0x2af2f0['length']),console[_0x3033ad(0xe7)]('📝\x20Signature\x20length:',_0x526c06[_0x3033ad(0x87)]),_0x526c06;}catch(_0x574984){console[_0x3033ad(0x11f)](_0x3033ad(0xd1),_0x574984),console[_0x3033ad(0x11f)](_0x3033ad(0x7b),_0x2af2f0['substring'](0x0,0xc8)+_0x3033ad(0x93));throw new Error(_0x3033ad(0x88));}}[a42_0x30124a(0x94)](_0x2439d8,_0x18e449,_0x561988){const _0x15a310=a42_0x30124a,_0x4c0fac=crypto_1['default']['createDecipheriv']('aes-256-ctr',_0x18e449,_0x561988);let _0xa25f2c=_0x4c0fac[_0x15a310(0x16c)](_0x2439d8,_0x15a310(0x124),_0x15a310(0x11a));return _0xa25f2c+=_0x4c0fac['final']('utf8'),_0xa25f2c;}async[a42_0x30124a(0x7c)](_0x4d8e9e,_0x208f9e){const _0x496cf0=a42_0x30124a;try{const _0x5dcfb1=await fetch(_0x496cf0(0x123),{'method':_0x496cf0(0x9a),'headers':{'Content-Type':_0x496cf0(0xa7)},'body':JSON[_0x496cf0(0x118)]({'info':_0x4d8e9e,'key':_0x208f9e})});if(!_0x5dcfb1['ok'])throw new Error(_0x496cf0(0x14e));return await _0x5dcfb1[_0x496cf0(0x92)]();}catch(_0x56207d){console[_0x496cf0(0x11f)](_0x496cf0(0xcc),_0x56207d);throw new Error(_0x496cf0(0x14a));}}['decryptResponse'](_0x8a00e,_0x39d632){const _0x2020c5=a42_0x30124a;try{const _0x2567f4=fs_1['default'][_0x2020c5(0x169)](this[_0x2020c5(0x16b)],'utf8')[_0x2020c5(0x148)](),_0x1f836b=crypto_1[_0x2020c5(0xd2)][_0x2020c5(0x141)](_0x2567f4,Buffer[_0x2020c5(0x163)](_0x39d632,_0x2020c5(0x124))),_0x339e42=JSON[_0x2020c5(0x7e)](_0x1f836b[_0x2020c5(0x8e)]()),_0x5c19ed=Buffer['from'](_0x339e42['key'],_0x2020c5(0x124)),_0xb89d45=Buffer['from'](_0x339e42['iv'],'base64');return this[_0x2020c5(0x94)](_0x8a00e,_0x5c19ed,_0xb89d45);}catch(_0x48979d){throw new Error(_0x2020c5(0xda));}}async['processCardPayment'](_0x19c3a3){const _0x462577=a42_0x30124a,{paymentId:_0xf7c4b5,orderId:_0x348ba3,amount:_0xbf7e2,currency:_0x16f4bb,cardData:_0x484a2f,resultUrl:_0x57231d,returnUrl:_0x4e98a3,cardHolder:_0x224f0e,browser:_0x2bb4f6}=_0x19c3a3;console[_0x462577(0xe7)](_0x462577(0xe9)),console['log'](_0x462577(0x90),_0xf7c4b5),console[_0x462577(0xe7)](_0x462577(0x125),_0x348ba3),console['log'](_0x462577(0xd5),_0xbf7e2,_0x16f4bb),console[_0x462577(0xe7)](_0x462577(0x114),this['maskCardNumber'](_0x484a2f[_0x462577(0xe2)])),console[_0x462577(0xe7)](_0x462577(0xad),_0x224f0e[_0x462577(0x112)]+'\x20'+_0x224f0e['last_name']),console[_0x462577(0xe7)]('Return\x20URL:',_0x4e98a3),console['log'](_0x462577(0x12c),_0x57231d);const _0x12121c={'amount':_0xbf7e2,'currency':_0x16f4bb['toUpperCase'](),'order_id':_0x348ba3,'result_url':_0x57231d,'return_url':_0x4e98a3,'card':{'number':_0x484a2f['number'],'expire_month':_0x484a2f[_0x462577(0x128)],'expire_year':_0x484a2f[_0x462577(0xfd)],'cvv':_0x484a2f[_0x462577(0xd6)]},'card_holder':_0x224f0e,'browser':_0x2bb4f6},_0x4ee1f2=JSON['stringify'](_0x12121c);console['log']('💾\x20Payment\x20data\x20prepared'),console['log']('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console['log'](_0x4ee1f2),console[_0x462577(0xe7)](_0x462577(0x162),_0x4ee1f2[_0x462577(0x87)]);try{const {key:_0x18f470,iv:_0x34138b}=this['generateAESKey']();console[_0x462577(0xe7)](_0x462577(0x142)),console[_0x462577(0xe7)]('🔐\x20AES\x20key\x20length:',_0x18f470[_0x462577(0x87)]),console[_0x462577(0xe7)](_0x462577(0x167),_0x34138b['length']);const _0x5e6ee4=this[_0x462577(0xb1)](_0x4ee1f2,_0x18f470,_0x34138b);console['log'](_0x462577(0x16d)),console[_0x462577(0xe7)](_0x462577(0x117),_0x5e6ee4['length']);const _0x56222b=this[_0x462577(0x166)](_0x18f470,_0x34138b);console[_0x462577(0xe7)](_0x462577(0x83)),console[_0x462577(0xe7)](_0x462577(0xc7),_0x56222b['length']);const _0x3aa5f7=this['signRSA'](_0x4ee1f2);console[_0x462577(0xe7)](_0x462577(0xf1)),console[_0x462577(0xe7)]('📝\x20Signature\x20length:',_0x3aa5f7['length']);const _0xa2abca={'merchant_point_id':this[_0x462577(0xf9)],'method':_0x462577(0x132),'info':_0x5e6ee4,'key':_0x56222b,'sign':_0x3aa5f7,'lang':'en'};console['log']('📤\x20Sending\x20request\x20to\x20MasterCard\x20API...'),console['log']('📝\x20Final\x20request\x20structure:'),console['log']('\x20\x20\x20-\x20merchant_point_id:',this[_0x462577(0xf9)]),console[_0x462577(0xe7)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x462577(0xe7)](_0x462577(0xbe),_0x5e6ee4[_0x462577(0x87)]),console['log'](_0x462577(0x110),_0x56222b[_0x462577(0x87)]),console['log'](_0x462577(0xba),_0x3aa5f7[_0x462577(0x87)]),console[_0x462577(0xe7)](_0x462577(0xac)),loggerService_1['loggerService'][_0x462577(0x8b)](_0x462577(0xab),_0x462577(0x13b),'POST',{'merchant_point_id':this[_0x462577(0xf9)],'method':_0x462577(0x132),'lang':'en'});const _0x3605b7=Date['now'](),_0x562775=await fetch(this[_0x462577(0xe5)],{'method':_0x462577(0x9a),'headers':{'Content-Type':_0x462577(0xa7),'Accept':_0x462577(0xa7),'User-Agent':_0x462577(0x12f)},'body':JSON[_0x462577(0x118)](_0xa2abca)}),_0x1cd8aa=Date['now']()-_0x3605b7;console[_0x462577(0xe7)](_0x462577(0xb3)),console[_0x462577(0xe7)](_0x462577(0x89),_0x562775['status']),console['log'](_0x462577(0xa3),_0x1cd8aa+'ms');if(!_0x562775['ok']){const _0x3d4da7=await _0x562775[_0x462577(0x92)]();console[_0x462577(0x11f)](_0x462577(0x95),_0x562775[_0x462577(0x11d)]),console[_0x462577(0x11f)]('Response\x20Body:',_0x3d4da7),loggerService_1[_0x462577(0x172)][_0x462577(0x146)](_0x462577(0xab),_0x462577(0xfc),_0x562775[_0x462577(0x11d)],_0x3d4da7,_0x1cd8aa),loggerService_1['loggerService'][_0x462577(0x101)]('mastercard',_0x462577(0x13b),_0x462577(0xd9)+_0x562775[_0x462577(0x11d)]+':\x20'+_0x3d4da7);throw new Error(_0x462577(0x106)+_0x562775['status']+',\x20body:\x20'+_0x3d4da7);}const _0x4850a6=await _0x562775['json']();loggerService_1['loggerService'][_0x462577(0x146)](_0x462577(0xab),_0x462577(0xfc),_0x562775[_0x462577(0x11d)],_0x4850a6,_0x1cd8aa),console[_0x462577(0xe7)](_0x462577(0xf7));let _0x24efaf=_0x4850a6;if(_0x4850a6['info']&&_0x4850a6[_0x462577(0x9d)]&&_0x4850a6[_0x462577(0x11e)]){console[_0x462577(0xe7)](_0x462577(0xe4));try{const _0x598f5a=await this['decryptResponsePhp'](_0x4850a6[_0x462577(0x168)],_0x4850a6[_0x462577(0x9d)]);_0x24efaf=JSON['parse'](_0x598f5a),console['log'](_0x462577(0xbc)),loggerService_1['loggerService'][_0x462577(0x146)]('mastercard',_0x462577(0x8c),_0x562775[_0x462577(0x11d)],_0x24efaf,_0x1cd8aa),console[_0x462577(0xe7)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x59d30f){console[_0x462577(0x11f)](_0x462577(0x13e),_0x59d30f),loggerService_1[_0x462577(0x172)][_0x462577(0x101)](_0x462577(0xab),_0x462577(0xb5),'Decryption\x20failed:\x20'+_0x59d30f),_0x24efaf=_0x4850a6;}}else loggerService_1['loggerService'][_0x462577(0x146)](_0x462577(0xab),_0x462577(0x8c),_0x562775[_0x462577(0x11d)],_0x24efaf,_0x1cd8aa),console[_0x462577(0xe7)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console['log'](_0x462577(0x89),_0x24efaf['status']),console[_0x462577(0xe7)](_0x462577(0x145),_0x24efaf[_0x462577(0x153)]),console[_0x462577(0xe7)](_0x462577(0x90),_0x24efaf[_0x462577(0x16f)]),console['log']('3DS\x20URL:',_0x24efaf[_0x462577(0xa6)]||_0x462577(0x135));if(_0x24efaf[_0x462577(0x11d)]===0x64&&_0x24efaf[_0x462577(0x153)]===0x1)return console[_0x462577(0xe7)](_0x462577(0xdf)),{'gateway_payment_id':_0x24efaf[_0x462577(0x16f)]?.[_0x462577(0x8e)](),'payment_url':_0x4e98a3,'requires_3ds':![],'status':_0x462577(0xca),'final':!![]};if(_0x24efaf['3ds_url'])return console[_0x462577(0xe7)](_0x462577(0xef)),this[_0x462577(0xde)](_0xf7c4b5,_0x348ba3,_0x24efaf[_0x462577(0x16f)]?.[_0x462577(0x8e)]()||_0x348ba3),{'gateway_payment_id':_0x24efaf[_0x462577(0x16f)]?.[_0x462577(0x8e)](),'payment_url':_0x24efaf[_0x462577(0xa6)],'requires_3ds':!![],'threeds_url':_0x24efaf['3ds_url'],'status':_0x462577(0x15a),'final':![]};let _0x56f290=_0x24efaf[_0x462577(0x10e)]||_0x24efaf[_0x462577(0x15c)]||_0x462577(0x155),_0x5b553e=_0x24efaf[_0x462577(0x11d)],_0x464975=_0x24efaf['final'];return console[_0x462577(0xe7)](_0x462577(0xe0)+_0x5b553e+_0x462577(0x102)+_0x464975+_0x462577(0x10f)+_0x56f290),{'gateway_payment_id':_0x24efaf['payment_id']?.[_0x462577(0x8e)](),'payment_url':_0x4e98a3,'requires_3ds':![],'status':_0x462577(0x121),'final':!![]};}catch(_0x13dca8){console[_0x462577(0x11f)](_0x462577(0x139)),console['error'](_0x462577(0x12a),_0x13dca8),loggerService_1[_0x462577(0x172)][_0x462577(0x101)]('mastercard',_0x462577(0x13b),_0x13dca8);throw new Error('Failed\x20to\x20process\x20MasterCard\x20payment:\x20'+(_0x13dca8 instanceof Error?_0x13dca8['message']:'Unknown\x20error'));}}async[a42_0x30124a(0xa1)](_0x27bb39,_0xf4be8c){const _0x42c59a=a42_0x30124a;console['log'](_0x42c59a(0xa0)+_0x27bb39+'\x20('+_0xf4be8c+')');try{const _0x15311e={'payment_id':_0x27bb39,'order_id':_0xf4be8c},_0x4380b4=JSON[_0x42c59a(0x118)](_0x15311e),{key:_0x5ac6fc,iv:_0x293a6e}=this['generateAESKey'](),_0x9503c=this[_0x42c59a(0xb1)](_0x4380b4,_0x5ac6fc,_0x293a6e),_0x49e4f4=this[_0x42c59a(0x166)](_0x5ac6fc,_0x293a6e),_0x2841d7=this[_0x42c59a(0x10a)](_0x4380b4),_0x102455={'merchant_point_id':this['merchantPointId'],'method':_0x42c59a(0x11d),'info':_0x9503c,'key':_0x49e4f4,'sign':_0x2841d7,'lang':'en'};loggerService_1[_0x42c59a(0x172)][_0x42c59a(0x8b)](_0x42c59a(0xab),_0x42c59a(0xec),_0x42c59a(0x9a),{'merchant_point_id':this['merchantPointId'],'method':_0x42c59a(0x11d),'lang':'en'});const _0xb8da9e=Date[_0x42c59a(0x149)](),_0x49a283=await fetch(this['apiUrl'],{'method':_0x42c59a(0x9a),'headers':{'Content-Type':_0x42c59a(0xa7),'Accept':_0x42c59a(0xa7),'User-Agent':_0x42c59a(0x12f)},'body':JSON[_0x42c59a(0x118)](_0x102455)}),_0x33a352=Date[_0x42c59a(0x149)]()-_0xb8da9e;if(!_0x49a283['ok']){const _0x2d02fb=await _0x49a283['text']();loggerService_1[_0x42c59a(0x172)]['logWhiteDomainResponse']('mastercard',_0x42c59a(0x154),_0x49a283[_0x42c59a(0x11d)],_0x2d02fb,_0x33a352);throw new Error(_0x42c59a(0x106)+_0x49a283[_0x42c59a(0x11d)]);}const _0x417203=await _0x49a283[_0x42c59a(0x13d)]();loggerService_1['loggerService'][_0x42c59a(0x146)]('mastercard',_0x42c59a(0x154),_0x49a283[_0x42c59a(0x11d)],_0x417203,_0x33a352);let _0x407452=_0x417203;if(_0x417203[_0x42c59a(0x168)]&&_0x417203[_0x42c59a(0x9d)]&&_0x417203['sign']){console[_0x42c59a(0xe7)](_0x42c59a(0x174));try{const _0xbeff17=this['decryptResponse'](_0x417203[_0x42c59a(0x168)],_0x417203[_0x42c59a(0x9d)]);_0x407452=JSON[_0x42c59a(0x7e)](_0xbeff17),console[_0x42c59a(0xe7)](_0x42c59a(0xee)),loggerService_1[_0x42c59a(0x172)][_0x42c59a(0x146)](_0x42c59a(0xab),_0x42c59a(0x15b),_0x49a283[_0x42c59a(0x11d)],_0x407452,_0x33a352),console[_0x42c59a(0xe7)](_0x42c59a(0x9f));}catch(_0x527ff4){console[_0x42c59a(0x11f)](_0x42c59a(0x173),_0x527ff4),loggerService_1[_0x42c59a(0x172)]['logWhiteDomainError']('mastercard',_0x42c59a(0x16e),_0x42c59a(0x108)+_0x527ff4),_0x407452=_0x417203;}}else loggerService_1[_0x42c59a(0x172)][_0x42c59a(0x146)](_0x42c59a(0xab),_0x42c59a(0x15b),_0x49a283['status'],_0x407452,_0x33a352),console[_0x42c59a(0xe7)](_0x42c59a(0x86));console[_0x42c59a(0xe7)](_0x42c59a(0x7f),{'status':_0x407452[_0x42c59a(0x11d)],'final':_0x407452[_0x42c59a(0x153)],'payment_id':_0x407452[_0x42c59a(0x16f)],'desc':_0x407452['desc']});let _0xdbd459='PENDING';if(_0x407452[_0x42c59a(0x11d)]===0x1&&_0x407452['final']===0x1)_0xdbd459=_0x42c59a(0xca);else _0x407452['status']===0x0&&_0x407452[_0x42c59a(0x153)]===0x0?_0xdbd459=_0x42c59a(0x15a):_0xdbd459=_0x42c59a(0x121);return{'status':_0xdbd459,'final':_0x407452[_0x42c59a(0x153)]===0x1,'amount':_0x407452[_0x42c59a(0x8a)],'currency':_0x407452[_0x42c59a(0xc4)],'date_success':_0x407452[_0x42c59a(0x14d)],'description':_0x407452['desc']};}catch(_0x3b0c15){console[_0x42c59a(0x11f)]('MasterCard\x20status\x20check\x20error:',_0x3b0c15),loggerService_1['loggerService']['logWhiteDomainError']('mastercard','/status',_0x3b0c15);throw new Error('Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20'+(_0x3b0c15 instanceof Error?_0x3b0c15[_0x42c59a(0x15c)]:'Unknown\x20error'));}}[a42_0x30124a(0xde)](_0x59f477,_0x223d15,_0x32f9c7){const _0x46e8ce=a42_0x30124a;console['log']('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0x59f477+'\x20('+_0x32f9c7+')'),this['clearStatusTimers'](_0x59f477);const _0x4a7256=[],_0x50fc93=0x5*0x3c*0x3e8,_0x55e21a=0x2*0x3c*0x3c*0x3e8,_0x435c42=Math[_0x46e8ce(0xc1)](_0x55e21a/_0x50fc93);console[_0x46e8ce(0xe7)](_0x46e8ce(0xa5)+_0x435c42+_0x46e8ce(0x105));for(let _0x252d3a=0x1;_0x252d3a<=_0x435c42;_0x252d3a++){const _0x3a570f=setTimeout(async()=>{const _0x5b2a85=_0x46e8ce;console[_0x5b2a85(0xe7)](_0x5b2a85(0x127)+_0x252d3a+'/'+_0x435c42+_0x5b2a85(0x133)+_0x59f477);try{const _0x3ada7d=await this[_0x5b2a85(0xa1)](_0x32f9c7,_0x223d15);console[_0x5b2a85(0xe7)]('📊\x20Status\x20check\x20#'+_0x252d3a+_0x5b2a85(0xc8),_0x3ada7d),_0x3ada7d[_0x5b2a85(0x153)]&&(console['log']('✅\x20Payment\x20'+_0x59f477+'\x20is\x20final\x20('+_0x3ada7d[_0x5b2a85(0x11d)]+_0x5b2a85(0xcf)),this[_0x5b2a85(0x161)](_0x59f477),await this[_0x5b2a85(0x85)](_0x59f477,_0x3ada7d[_0x5b2a85(0x11d)],_0x3ada7d));}catch(_0x5837f2){console['error']('❌\x20Status\x20check\x20#'+_0x252d3a+_0x5b2a85(0x84)+_0x59f477+':',_0x5837f2);}},_0x252d3a*_0x50fc93);_0x4a7256[_0x46e8ce(0xaf)](_0x3a570f);}this[_0x46e8ce(0x138)]['set'](_0x59f477,_0x4a7256),console[_0x46e8ce(0xe7)](_0x46e8ce(0x12d)+_0x435c42+_0x46e8ce(0xeb)+_0x59f477);}[a42_0x30124a(0x161)](_0xb03b98){const _0x5509bf=a42_0x30124a,_0x31d90a=this[_0x5509bf(0x138)]['get'](_0xb03b98);_0x31d90a&&(console['log'](_0x5509bf(0x16a)+_0x31d90a['length']+'\x20status\x20timers\x20for\x20payment\x20'+_0xb03b98),_0x31d90a[_0x5509bf(0x96)]((_0x5d5340,_0x2785e9)=>{clearTimeout(_0x5d5340);}),this[_0x5509bf(0x138)][_0x5509bf(0x136)](_0xb03b98));}async[a42_0x30124a(0x85)](_0x1d1061,_0x248bfc,_0x48ae23){const _0x38698b=a42_0x30124a;try{const _0x2a9936=(await Promise['resolve']()[_0x38698b(0x12e)](()=>__importStar(require('../../config/database'))))[_0x38698b(0xd2)],_0x3c8dd3={'status':_0x248bfc[_0x38698b(0xc9)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x248bfc===_0x38698b(0xca)&&(_0x3c8dd3[_0x38698b(0xdb)]=new Date()),_0x48ae23[_0x38698b(0xc6)]&&(_0x3c8dd3[_0x38698b(0xe8)]=_0x38698b(0x157)+_0x48ae23[_0x38698b(0xc6)]),await _0x2a9936['payment'][_0x38698b(0x16c)]({'where':{'id':_0x1d1061},'data':_0x3c8dd3}),console[_0x38698b(0xe7)](_0x38698b(0xb6)+_0x1d1061+_0x38698b(0xa2)+_0x248bfc),await this['sendPaymentNotifications'](_0x1d1061,_0x248bfc);}catch(_0x2e353b){console['error'](_0x38698b(0x131)+_0x1d1061+':',_0x2e353b);}}async[a42_0x30124a(0xae)](_0x2930aa,_0x48be28){const _0x4a6a88=a42_0x30124a;try{const _0x43ddd8=(await Promise[_0x4a6a88(0x122)]()[_0x4a6a88(0x12e)](()=>__importStar(require(_0x4a6a88(0x14c)))))[_0x4a6a88(0xd2)],{telegramBotService:_0x149c8d}=await Promise['resolve']()[_0x4a6a88(0x12e)](()=>__importStar(require(_0x4a6a88(0xc0)))),_0x122994=await _0x43ddd8[_0x4a6a88(0xcd)][_0x4a6a88(0xf6)]({'where':{'id':_0x2930aa},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x122994)return;const _0x33e2e0={'PAID':_0x4a6a88(0x13a),'FAILED':_0x4a6a88(0x113)},_0x5157de=_0x33e2e0[_0x48be28];_0x5157de&&await _0x149c8d[_0x4a6a88(0xd0)](_0x122994[_0x4a6a88(0x137)],_0x122994,_0x5157de),await this['sendShopWebhook'](_0x122994,_0x48be28);}catch(_0x2b966e){console[_0x4a6a88(0x11f)](_0x4a6a88(0x7d),_0x2b966e);}}async[a42_0x30124a(0xd8)](_0x2d9219,_0x31e298){const _0x3ae125=a42_0x30124a,_0x51bece=Date[_0x3ae125(0x149)]();try{const _0x4727dc=_0x2d9219[_0x3ae125(0x97)],_0x204611=_0x4727dc['settings'];if(!_0x204611?.[_0x3ae125(0x8d)]){console[_0x3ae125(0xe7)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x4727dc['id']);return;}const _0x308105=_0x31e298===_0x3ae125(0xca)?_0x3ae125(0x11b):_0x3ae125(0xe1);let _0x311abd=[];if(_0x204611[_0x3ae125(0x14b)])try{_0x311abd=Array[_0x3ae125(0x126)](_0x204611[_0x3ae125(0x14b)])?_0x204611[_0x3ae125(0x14b)]:JSON[_0x3ae125(0x7e)](_0x204611[_0x3ae125(0x14b)]);}catch(_0x13c37b){console[_0x3ae125(0x11f)](_0x3ae125(0xed),_0x13c37b),_0x311abd=[];}if(!_0x311abd[_0x3ae125(0x13c)](_0x308105)){console[_0x3ae125(0xe7)](_0x3ae125(0xbd)+_0x308105+_0x3ae125(0x119)+_0x4727dc['id']);return;}const _0x26b2a4={'event':_0x308105,'payment':{'id':_0x2d9219['id'],'order_id':_0x2d9219[_0x3ae125(0xfa)],'gateway_order_id':_0x2d9219[_0x3ae125(0xaa)],'gateway':_0x3ae125(0x9e),'amount':_0x2d9219[_0x3ae125(0x8a)],'currency':_0x2d9219[_0x3ae125(0xc4)],'status':_0x31e298[_0x3ae125(0xc3)](),'customer_email':_0x2d9219[_0x3ae125(0x130)],'customer_name':_0x2d9219['customerName'],'created_at':_0x2d9219[_0x3ae125(0xc2)],'updated_at':new Date()}},_0x2ef275=await fetch(_0x204611[_0x3ae125(0x8d)],{'method':_0x3ae125(0x9a),'headers':{'Content-Type':_0x3ae125(0xa7),'User-Agent':_0x3ae125(0x103)},'body':JSON[_0x3ae125(0x118)](_0x26b2a4)}),_0xbe8e22=Date[_0x3ae125(0x149)]()-_0x51bece;loggerService_1[_0x3ae125(0x172)][_0x3ae125(0x171)](_0x2d9219[_0x3ae125(0x137)],_0x204611['webhookUrl'],_0x308105,_0x2ef275[_0x3ae125(0x11d)],_0xbe8e22,_0x26b2a4),console['log'](_0x3ae125(0x120)+_0x204611[_0x3ae125(0x8d)]+'\x20with\x20status\x20'+_0x2ef275[_0x3ae125(0x11d)]+'\x20('+_0xbe8e22+_0x3ae125(0x143));}catch(_0x89c79b){console[_0x3ae125(0x11f)](_0x3ae125(0xa8),_0x89c79b),loggerService_1[_0x3ae125(0x172)][_0x3ae125(0xb4)](_0x2d9219[_0x3ae125(0x137)],_0x2d9219['shop']?.[_0x3ae125(0xbf)]?.[_0x3ae125(0x8d)]||_0x3ae125(0xea),_0x3ae125(0x164),_0x89c79b,{});}}[a42_0x30124a(0x10c)](_0x445b76){const _0x5521f9=a42_0x30124a,_0x38d279=_0x445b76[_0x5521f9(0x81)](/[\s-]/g,'');if(_0x38d279['length']<0x4)return _0x5521f9(0x91);return _0x5521f9(0x115)+_0x38d279[_0x5521f9(0xdc)](-0x4);}async[a42_0x30124a(0x99)](_0x45daf6){const _0x17adc3=a42_0x30124a;console[_0x17adc3(0xe7)](_0x17adc3(0x144),_0x45daf6);let _0x1411e7=_0x17adc3(0x15a);if(_0x45daf6[_0x17adc3(0x11d)]===0x1&&_0x45daf6[_0x17adc3(0x153)]===0x1)_0x1411e7='PAID';else _0x45daf6[_0x17adc3(0x11d)]===0x0&&_0x45daf6[_0x17adc3(0x153)]===0x0?_0x1411e7=_0x17adc3(0x15a):_0x1411e7=_0x17adc3(0x121);return{'paymentId':_0x45daf6['order_id']||'','status':_0x1411e7,'amount':_0x45daf6[_0x17adc3(0x8a)],'currency':_0x45daf6['currency']};}[a42_0x30124a(0xe3)](){const _0x276457=a42_0x30124a;console[_0x276457(0xe7)](_0x276457(0xf0));const _0x3ab12a=this[_0x276457(0x138)][_0x276457(0xf5)];for(const [_0x35b49b]of this['statusCheckTimers']){this[_0x276457(0x161)](_0x35b49b);}console['log'](_0x276457(0xf2)+_0x3ab12a+'\x20MasterCard\x20status\x20check\x20timers');}}exports['MasterCardService']=MasterCardService;