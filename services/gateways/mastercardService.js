'use strict';const a51_0x27d78e=a51_0x130a;(function(_0x480573,_0x36efea){const _0x574bbc=a51_0x130a,_0x6363c3=_0x480573();while(!![]){try{const _0x5cfc69=parseInt(_0x574bbc(0x1f5))/0x1*(parseInt(_0x574bbc(0x283))/0x2)+parseInt(_0x574bbc(0x18b))/0x3*(-parseInt(_0x574bbc(0x1f7))/0x4)+-parseInt(_0x574bbc(0x2a6))/0x5+-parseInt(_0x574bbc(0x293))/0x6*(-parseInt(_0x574bbc(0x2c5))/0x7)+-parseInt(_0x574bbc(0x205))/0x8*(parseInt(_0x574bbc(0x17b))/0x9)+parseInt(_0x574bbc(0x276))/0xa+-parseInt(_0x574bbc(0x225))/0xb;if(_0x5cfc69===_0x36efea)break;else _0x6363c3['push'](_0x6363c3['shift']());}catch(_0x40d05c){_0x6363c3['push'](_0x6363c3['shift']());}}}(a51_0x442d,0x7ffe3));function a51_0x130a(_0x18c051,_0x52b056){const _0x442d8c=a51_0x442d();return a51_0x130a=function(_0x130a29,_0x1db408){_0x130a29=_0x130a29-0x163;let _0x303a97=_0x442d8c[_0x130a29];return _0x303a97;},a51_0x130a(_0x18c051,_0x52b056);}var __createBinding=this&&this[a51_0x27d78e(0x173)]||(Object[a51_0x27d78e(0x187)]?function(_0x1c3fc6,_0x2a4e4a,_0x371d20,_0x4a2c82){const _0x1c822c=a51_0x27d78e;if(_0x4a2c82===undefined)_0x4a2c82=_0x371d20;var _0x24c642=Object[_0x1c822c(0x231)](_0x2a4e4a,_0x371d20);(!_0x24c642||(_0x1c822c(0x23b)in _0x24c642?!_0x2a4e4a[_0x1c822c(0x1cd)]:_0x24c642[_0x1c822c(0x295)]||_0x24c642[_0x1c822c(0x268)]))&&(_0x24c642={'enumerable':!![],'get':function(){return _0x2a4e4a[_0x371d20];}}),Object[_0x1c822c(0x185)](_0x1c3fc6,_0x4a2c82,_0x24c642);}:function(_0x412815,_0x151c56,_0xbaa364,_0x5c40af){if(_0x5c40af===undefined)_0x5c40af=_0xbaa364;_0x412815[_0x5c40af]=_0x151c56[_0xbaa364];}),__setModuleDefault=this&&this[a51_0x27d78e(0x196)]||(Object[a51_0x27d78e(0x187)]?function(_0x399c44,_0x3bcd37){const _0x23396d=a51_0x27d78e;Object[_0x23396d(0x185)](_0x399c44,'default',{'enumerable':!![],'value':_0x3bcd37});}:function(_0x2e7d25,_0x24045e){_0x2e7d25['default']=_0x24045e;}),__importStar=this&&this['__importStar']||(function(){var _0x5e737e=function(_0x5a5f30){const _0x14c0de=a51_0x130a;return _0x5e737e=Object[_0x14c0de(0x291)]||function(_0x50b70f){const _0x138bbc=_0x14c0de;var _0x14210b=[];for(var _0x388c14 in _0x50b70f)if(Object[_0x138bbc(0x18c)][_0x138bbc(0x213)][_0x138bbc(0x1bf)](_0x50b70f,_0x388c14))_0x14210b[_0x14210b['length']]=_0x388c14;return _0x14210b;},_0x5e737e(_0x5a5f30);};return function(_0x53c77e){const _0x22874e=a51_0x130a;if(_0x53c77e&&_0x53c77e[_0x22874e(0x1cd)])return _0x53c77e;var _0x2d53f2={};if(_0x53c77e!=null){for(var _0x80fd0e=_0x5e737e(_0x53c77e),_0x1c7edd=0x0;_0x1c7edd<_0x80fd0e[_0x22874e(0x24e)];_0x1c7edd++)if(_0x80fd0e[_0x1c7edd]!==_0x22874e(0x1f6))__createBinding(_0x2d53f2,_0x53c77e,_0x80fd0e[_0x1c7edd]);}return __setModuleDefault(_0x2d53f2,_0x53c77e),_0x2d53f2;};}()),__importDefault=this&&this[a51_0x27d78e(0x20f)]||function(_0xab32fe){return _0xab32fe&&_0xab32fe['__esModule']?_0xab32fe:{'default':_0xab32fe};};Object[a51_0x27d78e(0x185)](exports,a51_0x27d78e(0x1cd),{'value':!![]}),exports[a51_0x27d78e(0x198)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x27d78e(0x1d9))),loggerService_1=require(a51_0x27d78e(0x1cb));function a51_0x442d(){const _0x391e7c=['===\x20PARSED\x20API\x20RESPONSE\x20===','📊\x20Status\x20check\x20#','card_type',',\x20orderId=','\x20with\x20status\x20','VISA/MasterCard','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','application/json','text','Failed\x20payment','merchantPointId','9307670EwyOhj','/status_raw','logShopWebhookSent','Status:','toString','LookUp\x20not\x20confirmed','📝\x20Encrypted\x20data\x20length:','\x20MasterCard\x20status\x20check\x20timers','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','🔍\x20','none','publicKeyPath','base64','7244aMMzRX','maskCardNumber','status','resolve','\x20for\x20payment\x20','message','webhookEvents','processWebhook','paid','Status\x20','replace','customerName','paidAt','logWhiteDomainError','getOwnPropertyNames','✅\x20Payment\x20successful','24bNrXGL','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','writable','payment.failed','Request\x20data\x20error','push','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','SHA256','paymentId','Result\x20URL:','number','currency','failed','🔐\x20VISA\x20Private\x20key\x20path:','apiUrl','update','constants','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','join','996275onxiRv','clearStatusTimers','publicEncrypt','\x20status\x20updated\x20to\x20','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','desc','visaApiUrl','aes-256-ctr','readFileSync','RSA_PKCS1_PADDING','\x20payment_id\x20for\x20search:\x20','PAID','📝\x20Decrypted\x20webhook\x20data:','🔐\x20Data\x20signed\x20with\x20RSA','\x20\x20\x20Currency:\x20',',\x20payment_id=','loggerService','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','❌\x20PHP\x20decryptor\x20request\x20failed:','\x20status\x20check\x20error:','system','sendShopWebhook','../telegramBotService','Failed\x20to\x20check\x20','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','logWhiteDomainResponse','Transaction\x20limit\x20exceeded','🧹\x20Card\x20holder\x20names\x20cleaned:','logWhiteDomainRequest','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','1414392kGGlJc','✅\x20Payment\x20','Another\x20unknown\x20error','shopId','MasterCard\x20webhook\x20sent\x20to\x20','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','Response\x20Time:','description','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','https://api.paydmeth.com/api','visaPrivateKeyPath','/charge_decrypted','🔐\x203DS\x20verification\x20required','sendPaymentNotifications','No\x20Error\x20executing\x20request','Status\x20decryption\x20failed:\x20','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','first_name','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','📊\x20Status\x20check\x20result:','Invalid\x20expiration\x20date','🔐\x20RSA\x20signing\x20successful','\x22\x20|\x20\x22','Final:','Test\x20payment','__createBinding','validateKeyFiles','psp_public.pem','/status_decrypted','unknown','🔐\x20VISA\x20API\x20URL:','❌\x20RSA\x20encryption\x20failed:','Payment\x20ID:','9prvAov','visa_private.pem',',\x20final=','Cancellation\x20is\x20not\x20possible','\x20status\x20checks\x20for\x20payment\x20','🔍\x20Using\x20','\x20characters','5000000000000000','❌\x20Status\x20check\x20#','key','defineProperty','Captcha\x20confirmation\x20awaited','create','visa_public.pem','errorMessage','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','117186uREHwI','prototype','\x20result:','createSign','charAt','warn','FAILED','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Payment\x20returned','randomBytes','__setModuleDefault','Payment\x20pending\x20verification','VisaMasterCardService','Sender\x27s\x20CVV\x20card\x20is\x20required','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','adminNotes','encryptAES','error','PHP\x20decryptor\x20error','✅\x20VISA\x20key\x20files\x20validated\x20successfully','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','paymentStatuses','settings','now','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','utf8','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','The\x20card\x20is\x20lost\x20or\x20stolen','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','💾\x20Saving\x20failure\x20message:\x20','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','Unsuccessful\x20payment','🔐\x20AES\x20key\x20length:','gatewayOrderId','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','then','Cash\x20payment\x20is\x20expected\x20at\x20TCO','Number\x20of\x20attempts\x20exceeded','/charge','🔍\x20Using\x20provided\x20card\x20type:\x20','\x20not\x20enabled\x20for\x20shop\x20','No\x20New\x20payment','\x20webhook\x20extracted\x20data:','set','HTTP\x20error!\x20status:\x20','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','webhookUrl','stopAllStatusChecks','Payment\x20cancellation\x20is\x20being\x20processed','getCardTypeAndApi','findUnique','call','3DS\x20URL:','Response\x20Body:','\x20payment:\x20','includes','expire_year','Operation\x20completed\x20successfully','order_id','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','decryptAES','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','4000000000000000','../loggerService','VISA','__esModule','🔐\x20Data\x20encrypted\x20with\x20AES','logShopWebhookError','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','\x20status\x20timers\x20for\x20payment\x20','expire_month','payment','VISA/MasterCard\x20payment\x20successful','last_name','\x20\x20\x20Amount:\x20','Payment\x20System/1.0\x20(MasterCard)','/status','path','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','payment_id','existsSync','\x20\x20\x20-\x20key\x20length:','failureMessage','The\x20card\x20does\x20not\x20exist','encryptRSA','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','webhook_send','privateDecrypt','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','Insufficient\x20funds\x20on\x20the\x20card','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','PIN\x20code\x20confirmation\x20awaited','Card\x20Number:','forEach','trim','signRSA','createCipheriv','isFinalStatus','parse','🔐\x20MasterCard\x20API\x20URL:','\x20is\x20final\x20(','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format',',\x20paymentId=','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','masterCardApiUrl','76vzrzQR','default','8cNzThm','❌\x20Data\x20being\x20signed:','3DS\x20verification\x20required','/charge_raw','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','end','Order\x20ID:','Payment\x20is\x20being\x20processed','\x20(from:\x20order_id=','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','checkPaymentStatus','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','sendPaymentNotification','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','4787912IJXVKl','visaPublicKeyPath','statusCheckTimers','\x20\x20\x20-\x20lang:\x20en','Awaiting\x20confirmation\x20by\x20ivr\x20call','cwd','\x20\x20\x20Payment\x20ID:\x20','createDecipheriv','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','Client\x20OTP\x20confirmation\x20required','__importDefault','isArray','log','masterCardMerchantPointId','hasOwnProperty','visaMerchantPointId','****\x20****\x20****\x20','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','final','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','info','3ds_url','\x20status\x20check\x20#','1111','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','📤\x20Sending\x20request\x20to\x20API...','slice','Failed\x20to\x20decrypt\x20response','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','scheduleStatusChecks','PENDING','6755496aVukol','-----BEGIN',',\x20Desc:\x20','Unknown\x20error','-----END','stringify','date_success','Failed\x20to\x20send\x20payment\x20notifications:','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','generateAESKey','decryptResponse','Error\x20parsing\x20webhook\x20events:','getOwnPropertyDescriptor','visa/mastercard','getDetailedErrorMessage','✅\x20Status\x20response\x20decrypted\x20successfully','\x20\x20\x20-\x20merchant_point_id:','✅\x20Scheduled\x20','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20',',\x20id=','MASTERCARD','shop','get','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','HTTP\x20Status:','keys','💾\x20Payment\x20data\x20prepared','🔐\x20VISA\x20Private\x20key\x20length:\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','orderId','delete','\x20\x20\x20-\x20sign\x20length:','Sender\x27s\x20card\x20details\x20are\x20required','toLowerCase','\x20order_id\x20for\x20search:\x20','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','/status_decrypt','HTTP\x20','from','📊\x20','cardType','length','🧹\x20Clearing\x20','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','substring','privateKeyPath','updatePaymentStatus','sign',',\x20body:\x20','/charge_decrypt','POST','),\x20defaulting\x20to\x20MasterCard','Payment\x20System/1.0','🔐\x20MasterCard\x20Private\x20key\x20path:','...','Return\x20URL:','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','Awaiting\x20confirmation\x20in\x20the\x20application','amount','\x20\x20\x20-\x20info\x20length:','processCardPayment','\x20API:\x20','toUpperCase','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','LookUp\x20code\x20sent','🔐\x20MasterCard\x20Public\x20key\x20path:','\x20\x20\x20Status:\x20','configurable','📝\x20Data\x20length:','Payment\x20prohibited'];a51_0x442d=function(){return _0x391e7c;};return a51_0x442d();}class VisaMasterCardService{constructor(){const _0x476500=a51_0x27d78e;this[_0x476500(0x207)]=new Map(),this[_0x476500(0x1a1)]={0x0:{'final':![],'description':_0x476500(0x1b5)},0x1:{'final':![],'description':_0x476500(0x168)},0x2:{'final':!![],'description':_0x476500(0x297)},0x3:{'final':!![],'description':_0x476500(0x2c7)},0x4:{'final':!![],'description':_0x476500(0x1ab)},0x5:{'final':!![],'description':_0x476500(0x2cd)},0x6:{'final':!![],'description':_0x476500(0x194)},0x7:{'final':!![],'description':_0x476500(0x172)},0x8:{'final':![],'description':_0x476500(0x20e)},0x9:{'final':![],'description':_0x476500(0x1f9)},0xa:{'final':![],'description':_0x476500(0x199)},0xb:{'final':![],'description':'Sender\x20information\x20required'},0xc:{'final':![],'description':'Recipient\x20data\x20required'},0xd:{'final':![],'description':_0x476500(0x16a)},0xe:{'final':![],'description':_0x476500(0x209)},0xf:{'final':![],'description':_0x476500(0x1e7)},0x10:{'final':![],'description':_0x476500(0x186)},0x11:{'final':![],'description':_0x476500(0x2b8)},0x12:{'final':![],'description':_0x476500(0x25e)},0x13:{'final':![],'description':_0x476500(0x1fe)},0x14:{'final':![],'description':_0x476500(0x264)},0x15:{'final':![],'description':'Expected\x20bitcoin\x20transfer\x20from\x20client'},0x16:{'final':![],'description':_0x476500(0x197)},0x18:{'final':![],'description':_0x476500(0x1d0)},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':_0x476500(0x1b0)},0x1b:{'final':![],'description':_0x476500(0x21e)},0x1c:{'final':![],'description':_0x476500(0x1f3)},0x1d:{'final':![],'description':_0x476500(0x218)},0x1f:{'final':![],'description':_0x476500(0x1b9)},0x20:{'final':![],'description':_0x476500(0x202)},0x23:{'final':![],'description':_0x476500(0x245)},0x24:{'final':!![],'description':'Payment\x20confirmation\x20time\x20has\x20expired'},0x25:{'final':!![],'description':_0x476500(0x26a)},0x26:{'final':!![],'description':_0x476500(0x27e)},0x27:{'final':!![],'description':_0x476500(0x1e5)},0x28:{'final':!![],'description':_0x476500(0x1df)},0x29:{'final':!![],'description':_0x476500(0x1a7)},0x2a:{'final':!![],'description':_0x476500(0x16e)},0x2b:{'final':!![],'description':_0x476500(0x2c1)},0x2c:{'final':!![],'description':_0x476500(0x1aa)},0x2d:{'final':!![],'description':_0x476500(0x274)},0x2e:{'final':!![],'description':_0x476500(0x1ab)},0x2f:{'final':!![],'description':_0x476500(0x1ab)},0x30:{'final':!![],'description':_0x476500(0x192)},0x31:{'final':![],'description':'Payment\x20confirmation\x20required'},0x32:{'final':!![],'description':'Method\x20not\x20allowed'},0x33:{'final':!![],'description':'Failed\x20payment'},0x34:{'final':!![],'description':'Failed\x20payment'},0x35:{'final':!![],'description':_0x476500(0x274)},0x36:{'final':!![],'description':_0x476500(0x274)},0x37:{'final':!![],'description':_0x476500(0x274)},0x38:{'final':!![],'description':_0x476500(0x17e)},0x39:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank'},0x3a:{'final':![],'description':_0x476500(0x265)},0x3b:{'final':!![],'description':'LookUp\x20code\x20verified'},0x3c:{'final':!![],'description':_0x476500(0x1b1)},0x3d:{'final':!![],'description':'Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible'},0x3e:{'final':!![],'description':_0x476500(0x1c7)},0x3f:{'final':!![],'description':_0x476500(0x194)},0x40:{'final':![],'description':_0x476500(0x27b)},0x41:{'final':!![],'description':'LookUp\x20number\x20of\x20attempts\x20exceeded'},0x42:{'final':![],'description':_0x476500(0x1bc)},0x43:{'final':!![],'description':_0x476500(0x248)},0x44:{'final':![],'description':'3DS\x20verification\x20required'},0x45:{'final':!![],'description':'Failed\x20payment'},0x46:{'final':!![],'description':_0x476500(0x274)},0x47:{'final':!![],'description':_0x476500(0x16c)},0x64:{'final':!![],'description':_0x476500(0x1c5)}},this[_0x476500(0x1f4)]=_0x476500(0x163),this[_0x476500(0x212)]=0x6e4,this[_0x476500(0x252)]=path_1[_0x476500(0x1f6)][_0x476500(0x2a5)](process['cwd'](),_0x476500(0x23e),'private.pem'),this[_0x476500(0x281)]=path_1[_0x476500(0x1f6)][_0x476500(0x2a5)](process[_0x476500(0x20a)](),_0x476500(0x23e),_0x476500(0x175)),this[_0x476500(0x2ad)]=_0x476500(0x163),this['visaMerchantPointId']=0x6b7,this[_0x476500(0x164)]=path_1[_0x476500(0x1f6)][_0x476500(0x2a5)](process[_0x476500(0x20a)](),_0x476500(0x23e),_0x476500(0x17c)),this[_0x476500(0x206)]=path_1['default'][_0x476500(0x2a5)](process['cwd'](),_0x476500(0x23e),_0x476500(0x188)),console[_0x476500(0x211)]('💳\x20VISA/MasterCard\x20service\x20initialized'),console[_0x476500(0x211)](_0x476500(0x1ef),this[_0x476500(0x1f4)]),console['log'](_0x476500(0x178),this[_0x476500(0x2ad)]),console[_0x476500(0x211)](_0x476500(0x25a),this[_0x476500(0x252)]),console[_0x476500(0x211)](_0x476500(0x266),this[_0x476500(0x281)]),console[_0x476500(0x211)](_0x476500(0x2a0),this[_0x476500(0x164)]),console[_0x476500(0x211)]('🔐\x20VISA\x20Public\x20key\x20path:',this[_0x476500(0x206)]),this[_0x476500(0x174)]();}[a51_0x27d78e(0x233)](_0x44ec47,_0x467806){const _0x2c5028=a51_0x27d78e,_0x5f2dc6=this[_0x2c5028(0x1a1)][_0x44ec47];let _0x24b41a='';_0x5f2dc6?_0x24b41a=_0x2c5028(0x28c)+_0x44ec47+':\x20'+_0x5f2dc6['description']:_0x24b41a=_0x2c5028(0x28c)+_0x44ec47+':\x20Unknown\x20status\x20code';if(_0x467806&&_0x467806[_0x2c5028(0x1ea)]()){const _0x4bfc01=_0x467806['trim']();(!_0x5f2dc6||_0x4bfc01[_0x2c5028(0x246)]()!==_0x5f2dc6[_0x2c5028(0x2cc)][_0x2c5028(0x246)]())&&(_0x24b41a+='\x20|\x20Response:\x20'+_0x4bfc01);}return _0x24b41a;}[a51_0x27d78e(0x1ed)](_0x5b4270){const _0x445216=a51_0x27d78e,_0x16e66d=this[_0x445216(0x1a1)][_0x5b4270];return _0x16e66d?_0x16e66d[_0x445216(0x217)]:!![];}[a51_0x27d78e(0x1bd)](_0x1b9891){const _0x1fb558=a51_0x27d78e,_0x55eed8=_0x1b9891[_0x1fb558(0x18f)](0x0);if(_0x55eed8==='4')return console[_0x1fb558(0x211)](_0x1fb558(0x1e1)),{'cardType':_0x1fb558(0x1cc),'apiUrl':this[_0x1fb558(0x2ad)],'privateKeyPath':this[_0x1fb558(0x164)],'publicKeyPath':this['visaPublicKeyPath'],'merchantPointId':this[_0x1fb558(0x214)]};else return _0x55eed8==='5'?(console[_0x1fb558(0x211)](_0x1fb558(0x2bf)),{'cardType':_0x1fb558(0x239),'apiUrl':this[_0x1fb558(0x1f4)],'privateKeyPath':this[_0x1fb558(0x252)],'publicKeyPath':this[_0x1fb558(0x281)],'merchantPointId':this['masterCardMerchantPointId']}):(console['log'](_0x1fb558(0x19a)+_0x55eed8+_0x1fb558(0x258)),{'cardType':_0x1fb558(0x239),'apiUrl':this[_0x1fb558(0x1f4)],'privateKeyPath':this[_0x1fb558(0x252)],'publicKeyPath':this[_0x1fb558(0x281)],'merchantPointId':this[_0x1fb558(0x212)]});}[a51_0x27d78e(0x174)](){const _0x35ca67=a51_0x27d78e;try{if(!fs_1['default']['existsSync'](this[_0x35ca67(0x252)]))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this['privateKeyPath']);if(!fs_1['default'][_0x35ca67(0x1dc)](this[_0x35ca67(0x281)]))throw new Error(_0x35ca67(0x2ab)+this['publicKeyPath']);const _0x24cea1=fs_1[_0x35ca67(0x1f6)][_0x35ca67(0x2af)](this[_0x35ca67(0x252)],_0x35ca67(0x1a5))[_0x35ca67(0x1ea)](),_0x223df2=fs_1[_0x35ca67(0x1f6)][_0x35ca67(0x2af)](this[_0x35ca67(0x281)],'utf8')[_0x35ca67(0x1ea)]();if(!_0x24cea1[_0x35ca67(0x1c3)](_0x35ca67(0x226))||!_0x24cea1[_0x35ca67(0x1c3)](_0x35ca67(0x229)))throw new Error(_0x35ca67(0x216));if(!_0x223df2[_0x35ca67(0x1c3)](_0x35ca67(0x226))||!_0x223df2[_0x35ca67(0x1c3)](_0x35ca67(0x229)))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console['log'](_0x35ca67(0x294)),console['log'](_0x35ca67(0x222)+_0x24cea1[_0x35ca67(0x24e)]+_0x35ca67(0x181)),console['log'](_0x35ca67(0x21d)+_0x223df2['length']+_0x35ca67(0x181));if(fs_1[_0x35ca67(0x1f6)][_0x35ca67(0x1dc)](this[_0x35ca67(0x164)])&&fs_1['default'][_0x35ca67(0x1dc)](this[_0x35ca67(0x206)])){const _0x9db20d=fs_1[_0x35ca67(0x1f6)][_0x35ca67(0x2af)](this[_0x35ca67(0x164)],_0x35ca67(0x1a5))[_0x35ca67(0x1ea)](),_0xbbe6ab=fs_1[_0x35ca67(0x1f6)][_0x35ca67(0x2af)](this[_0x35ca67(0x206)],'utf8')[_0x35ca67(0x1ea)]();(!_0x9db20d[_0x35ca67(0x1c3)](_0x35ca67(0x226))||!_0x9db20d[_0x35ca67(0x1c3)](_0x35ca67(0x229)))&&console[_0x35ca67(0x190)](_0x35ca67(0x1f1)),(!_0xbbe6ab[_0x35ca67(0x1c3)](_0x35ca67(0x226))||!_0xbbe6ab[_0x35ca67(0x1c3)](_0x35ca67(0x229)))&&console['warn'](_0x35ca67(0x23c)),console[_0x35ca67(0x211)](_0x35ca67(0x19f)),console[_0x35ca67(0x211)](_0x35ca67(0x240)+_0x9db20d['length']+'\x20characters'),console['log']('🔐\x20VISA\x20Public\x20key\x20length:\x20'+_0xbbe6ab[_0x35ca67(0x24e)]+_0x35ca67(0x181));}else console['warn'](_0x35ca67(0x1fb)),console['warn']('⚠️\x20Expected\x20VISA\x20private\x20key:\x20'+this['visaPrivateKeyPath']),console[_0x35ca67(0x190)](_0x35ca67(0x271)+this[_0x35ca67(0x206)]);}catch(_0x3eaa60){console[_0x35ca67(0x19d)](_0x35ca67(0x2ca),_0x3eaa60);throw _0x3eaa60;}}[a51_0x27d78e(0x22e)](){const _0x360fdb=a51_0x27d78e,_0x1cb7b1=crypto_1[_0x360fdb(0x1f6)][_0x360fdb(0x195)](0x20),_0x2cc05a=crypto_1[_0x360fdb(0x1f6)][_0x360fdb(0x195)](0x10);return{'key':_0x1cb7b1,'iv':_0x2cc05a};}[a51_0x27d78e(0x19c)](_0x20af88,_0x33b091,_0x5d00a9){const _0x277953=a51_0x27d78e,_0x3bcda5=crypto_1[_0x277953(0x1f6)][_0x277953(0x1ec)](_0x277953(0x2ae),_0x33b091,_0x5d00a9);let _0x2a104c=_0x3bcda5[_0x277953(0x2a2)](_0x20af88,_0x277953(0x1a5),_0x277953(0x282));return _0x2a104c+=_0x3bcda5['final'](_0x277953(0x282)),_0x2a104c;}[a51_0x27d78e(0x1e0)](_0x441b7f,_0x28a4d0,_0x4d69c6){const _0x413afb=a51_0x27d78e;try{const _0x24fc4e=fs_1[_0x413afb(0x1f6)][_0x413afb(0x2af)](_0x4d69c6,_0x413afb(0x1a5))[_0x413afb(0x1ea)](),_0x19dc16={'iv':_0x28a4d0[_0x413afb(0x27a)]('base64'),'key':_0x441b7f[_0x413afb(0x27a)](_0x413afb(0x282))},_0xcb2aa6=JSON[_0x413afb(0x22a)](_0x19dc16);console[_0x413afb(0x211)](_0x413afb(0x25d),_0xcb2aa6[_0x413afb(0x24e)]);const _0x1eb7a8=crypto_1[_0x413afb(0x1f6)][_0x413afb(0x2a8)]({'key':_0x24fc4e,'padding':crypto_1[_0x413afb(0x1f6)][_0x413afb(0x2a3)][_0x413afb(0x2b0)]},Buffer[_0x413afb(0x24b)](_0xcb2aa6));return console[_0x413afb(0x211)](_0x413afb(0x204),_0x1eb7a8[_0x413afb(0x24e)]),_0x1eb7a8[_0x413afb(0x27a)](_0x413afb(0x282));}catch(_0x549270){console['error'](_0x413afb(0x179),_0x549270);throw new Error(_0x413afb(0x250));}}[a51_0x27d78e(0x1eb)](_0x9d2b26,_0x21e8ca){const _0x6a014e=a51_0x27d78e;try{const _0x5eb91a=fs_1[_0x6a014e(0x1f6)]['readFileSync'](_0x21e8ca,_0x6a014e(0x1a5))[_0x6a014e(0x1ea)](),_0x4cea2c=crypto_1['default'][_0x6a014e(0x18e)](_0x6a014e(0x29a));_0x4cea2c[_0x6a014e(0x2a2)](_0x9d2b26),_0x4cea2c[_0x6a014e(0x1fc)]();const _0x119a48=_0x4cea2c[_0x6a014e(0x254)](_0x5eb91a,_0x6a014e(0x282));return console['log'](_0x6a014e(0x16f)),console[_0x6a014e(0x211)]('📝\x20Data\x20to\x20sign\x20length:',_0x9d2b26['length']),console[_0x6a014e(0x211)]('📝\x20Signature\x20length:',_0x119a48[_0x6a014e(0x24e)]),_0x119a48;}catch(_0x589a50){console[_0x6a014e(0x19d)]('❌\x20RSA\x20signing\x20failed:',_0x589a50),console[_0x6a014e(0x19d)](_0x6a014e(0x1f8),_0x9d2b26[_0x6a014e(0x251)](0x0,0xc8)+_0x6a014e(0x25b));throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}['decryptAES'](_0x3d85af,_0x235f70,_0x5995a3){const _0x4e242f=a51_0x27d78e,_0x2f26b9=crypto_1[_0x4e242f(0x1f6)][_0x4e242f(0x20c)]('aes-256-ctr',_0x235f70,_0x5995a3);let _0x5ae7bd=_0x2f26b9[_0x4e242f(0x2a2)](_0x3d85af,_0x4e242f(0x282),'utf8');return _0x5ae7bd+=_0x2f26b9[_0x4e242f(0x217)]('utf8'),_0x5ae7bd;}async['decryptResponsePhp'](_0x3b379f,_0x845feb,_0xd19864=a51_0x27d78e(0x239)){const _0x3b3a05=a51_0x27d78e;try{const _0xb84c65=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x3b3a05(0x257),'headers':{'Content-Type':_0x3b3a05(0x272)},'body':JSON[_0x3b3a05(0x22a)]({'info':_0x3b379f,'key':_0x845feb,'card_type':_0xd19864[_0x3b3a05(0x246)]()})});if(!_0xb84c65['ok'])throw new Error(_0x3b3a05(0x19e));return await _0xb84c65[_0x3b3a05(0x273)]();}catch(_0xa2d215){console[_0x3b3a05(0x19d)](_0x3b3a05(0x2b9),_0xa2d215);throw new Error(_0x3b3a05(0x2aa));}}[a51_0x27d78e(0x22f)](_0x158723,_0x5ded1e){const _0x5b1dc5=a51_0x27d78e;try{const _0x30f9c8=fs_1[_0x5b1dc5(0x1f6)]['readFileSync'](this[_0x5b1dc5(0x252)],_0x5b1dc5(0x1a5))[_0x5b1dc5(0x1ea)](),_0x24d491=crypto_1[_0x5b1dc5(0x1f6)][_0x5b1dc5(0x1e3)](_0x30f9c8,Buffer[_0x5b1dc5(0x24b)](_0x5ded1e,_0x5b1dc5(0x282))),_0x38e913=JSON['parse'](_0x24d491[_0x5b1dc5(0x27a)]()),_0x5201c0=Buffer[_0x5b1dc5(0x24b)](_0x38e913['key'],_0x5b1dc5(0x282)),_0x4bf7f2=Buffer[_0x5b1dc5(0x24b)](_0x38e913['iv'],_0x5b1dc5(0x282));return this[_0x5b1dc5(0x1c8)](_0x158723,_0x5201c0,_0x4bf7f2);}catch(_0x1201e0){throw new Error(_0x5b1dc5(0x221));}}async[a51_0x27d78e(0x261)](_0x14de19){const _0x3de2f4=a51_0x27d78e,{paymentId:_0x2134e7,orderId:_0x356997,amount:_0x5990ab,currency:_0x4405d6,cardData:_0x1f1ff3,resultUrl:_0x22cc7b,returnUrl:_0xd5e01b,cardHolder:_0x1a7676,browser:_0x23a1e8}=_0x14de19;console[_0x3de2f4(0x211)](_0x3de2f4(0x1ae)),console['log'](_0x3de2f4(0x17a),_0x2134e7),console[_0x3de2f4(0x211)](_0x3de2f4(0x1fd),_0x356997),console[_0x3de2f4(0x211)]('Amount:',_0x5990ab,_0x4405d6),console['log'](_0x3de2f4(0x1e8),this[_0x3de2f4(0x284)](_0x1f1ff3['number'])),console[_0x3de2f4(0x211)]('Card\x20Holder:',_0x1a7676[_0x3de2f4(0x16b)]+'\x20'+_0x1a7676[_0x3de2f4(0x1d5)]),console[_0x3de2f4(0x211)](_0x3de2f4(0x25c),_0xd5e01b),console[_0x3de2f4(0x211)](_0x3de2f4(0x29c),_0x22cc7b);const _0x28758c=this['getCardTypeAndApi'](_0x1f1ff3[_0x3de2f4(0x29d)]);console[_0x3de2f4(0x211)]('🎯\x20Using\x20'+_0x28758c['cardType']+_0x3de2f4(0x262)+_0x28758c[_0x3de2f4(0x2a1)]),console[_0x3de2f4(0x211)]('🔐\x20Using\x20keys:\x20'+_0x28758c['privateKeyPath']+',\x20'+_0x28758c[_0x3de2f4(0x281)]);const _0x430911={..._0x1a7676,'first_name':_0x1a7676[_0x3de2f4(0x16b)]?.[_0x3de2f4(0x28d)](/[\t\n\r\f\v]/g,'\x20')[_0x3de2f4(0x1ea)]()||'','last_name':_0x1a7676[_0x3de2f4(0x1d5)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x3de2f4(0x1ea)]()||''};console[_0x3de2f4(0x211)](_0x3de2f4(0x2c2)),console[_0x3de2f4(0x211)]('\x20\x20Original:\x20\x22'+_0x1a7676[_0x3de2f4(0x16b)]+_0x3de2f4(0x170)+_0x1a7676[_0x3de2f4(0x1d5)]+'\x22'),console['log']('\x20\x20Cleaned:\x20\x20\x22'+_0x430911['first_name']+_0x3de2f4(0x170)+_0x430911[_0x3de2f4(0x1d5)]+'\x22');const _0x140503={'amount':_0x5990ab,'currency':_0x4405d6['toUpperCase'](),'order_id':_0x356997,'result_url':_0x22cc7b,'return_url':_0xd5e01b,'country':'','card':{'number':_0x1f1ff3[_0x3de2f4(0x29d)],'expire_month':_0x1f1ff3[_0x3de2f4(0x1d2)],'expire_year':_0x1f1ff3[_0x3de2f4(0x1c4)],'cvv':_0x1f1ff3['cvv']},'card_holder':_0x430911,'browser':_0x23a1e8},_0x13d47c=JSON[_0x3de2f4(0x22a)](_0x140503);console['log'](_0x3de2f4(0x23f)),console['log'](_0x3de2f4(0x22d)),console[_0x3de2f4(0x211)](_0x13d47c),console[_0x3de2f4(0x211)](_0x3de2f4(0x269),_0x13d47c['length']);try{const {key:_0x519f24,iv:_0x269070}=this[_0x3de2f4(0x22e)]();console[_0x3de2f4(0x211)]('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console['log'](_0x3de2f4(0x1ac),_0x519f24[_0x3de2f4(0x24e)]),console[_0x3de2f4(0x211)]('🔐\x20AES\x20IV\x20length:',_0x269070[_0x3de2f4(0x24e)]);const _0xde8097=this[_0x3de2f4(0x19c)](_0x13d47c,_0x519f24,_0x269070);console[_0x3de2f4(0x211)](_0x3de2f4(0x1ce)),console[_0x3de2f4(0x211)](_0x3de2f4(0x27c),_0xde8097[_0x3de2f4(0x24e)]);const _0x323702=this['encryptRSA'](_0x519f24,_0x269070,_0x28758c['publicKeyPath']);console[_0x3de2f4(0x211)](_0x3de2f4(0x2a4)),console[_0x3de2f4(0x211)]('📝\x20Encrypted\x20key\x20length:',_0x323702[_0x3de2f4(0x24e)]);const _0x4239b1=this['signRSA'](_0x13d47c,_0x28758c[_0x3de2f4(0x252)]);console[_0x3de2f4(0x211)](_0x3de2f4(0x2b4)),console['log']('📝\x20Signature\x20length:',_0x4239b1['length']);const _0x5ec1aa={'merchant_point_id':_0x28758c[_0x3de2f4(0x275)],'method':'charge','info':_0xde8097,'key':_0x323702,'sign':_0x4239b1,'lang':'en'};console[_0x3de2f4(0x211)](_0x3de2f4(0x21f)),console[_0x3de2f4(0x211)]('📝\x20Final\x20request\x20structure:'),console[_0x3de2f4(0x211)](_0x3de2f4(0x235),_0x28758c[_0x3de2f4(0x275)]),console[_0x3de2f4(0x211)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x3de2f4(0x211)](_0x3de2f4(0x260),_0xde8097[_0x3de2f4(0x24e)]),console[_0x3de2f4(0x211)](_0x3de2f4(0x1dd),_0x323702['length']),console[_0x3de2f4(0x211)](_0x3de2f4(0x244),_0x4239b1[_0x3de2f4(0x24e)]),console[_0x3de2f4(0x211)](_0x3de2f4(0x208)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x28758c[_0x3de2f4(0x24d)][_0x3de2f4(0x246)](),_0x3de2f4(0x1b2),_0x3de2f4(0x257),{'merchant_point_id':_0x28758c['merchantPointId'],'method':'charge','lang':'en'});const _0xd0edaa=Date[_0x3de2f4(0x1a3)](),_0x1be62e=await fetch(_0x28758c[_0x3de2f4(0x2a1)],{'method':_0x3de2f4(0x257),'headers':{'Content-Type':'application/json','Accept':_0x3de2f4(0x272),'User-Agent':_0x3de2f4(0x259)},'body':JSON['stringify'](_0x5ec1aa)}),_0x573dab=Date[_0x3de2f4(0x1a3)]()-_0xd0edaa;console[_0x3de2f4(0x211)]('===\x20API\x20RESPONSE\x20==='),console[_0x3de2f4(0x211)](_0x3de2f4(0x279),_0x1be62e[_0x3de2f4(0x285)]),console[_0x3de2f4(0x211)](_0x3de2f4(0x2cb),_0x573dab+'ms');if(!_0x1be62e['ok']){const _0x5818ec=await _0x1be62e[_0x3de2f4(0x273)]();console['error'](_0x3de2f4(0x23d),_0x1be62e[_0x3de2f4(0x285)]),console['error'](_0x3de2f4(0x1c1),_0x5818ec),loggerService_1['loggerService'][_0x3de2f4(0x2c0)](_0x28758c[_0x3de2f4(0x24d)][_0x3de2f4(0x246)](),_0x3de2f4(0x1fa),_0x1be62e[_0x3de2f4(0x285)],_0x5818ec,_0x573dab),loggerService_1['loggerService']['logWhiteDomainError'](_0x28758c[_0x3de2f4(0x24d)][_0x3de2f4(0x246)](),_0x3de2f4(0x1b2),_0x3de2f4(0x24a)+_0x1be62e[_0x3de2f4(0x285)]+':\x20'+_0x5818ec);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1be62e[_0x3de2f4(0x285)]+_0x3de2f4(0x255)+_0x5818ec);}const _0x2ceb07=await _0x1be62e['json']();loggerService_1[_0x3de2f4(0x2b7)][_0x3de2f4(0x2c0)](_0x28758c[_0x3de2f4(0x24d)][_0x3de2f4(0x246)](),'/charge_raw',_0x1be62e[_0x3de2f4(0x285)],_0x2ceb07,_0x573dab),console['log'](_0x3de2f4(0x26b));let _0x3e0344=_0x2ceb07;if(_0x2ceb07[_0x3de2f4(0x219)]&&_0x2ceb07['key']&&_0x2ceb07[_0x3de2f4(0x254)]){console[_0x3de2f4(0x211)]('🔐\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x55360e=await this['decryptResponsePhp'](_0x2ceb07[_0x3de2f4(0x219)],_0x2ceb07[_0x3de2f4(0x184)],_0x28758c[_0x3de2f4(0x24d)]);_0x3e0344=JSON['parse'](_0x55360e),console['log'](_0x3de2f4(0x1a8)),loggerService_1[_0x3de2f4(0x2b7)][_0x3de2f4(0x2c0)](_0x28758c[_0x3de2f4(0x24d)][_0x3de2f4(0x246)](),'/charge_decrypted',_0x1be62e[_0x3de2f4(0x285)],_0x3e0344,_0x573dab),console[_0x3de2f4(0x211)](_0x3de2f4(0x193));}catch(_0x1b0247){console[_0x3de2f4(0x19d)](_0x3de2f4(0x18a),_0x1b0247),loggerService_1[_0x3de2f4(0x2b7)]['logWhiteDomainError'](_0x28758c[_0x3de2f4(0x24d)][_0x3de2f4(0x246)](),_0x3de2f4(0x256),'Decryption\x20failed:\x20'+_0x1b0247),_0x3e0344=_0x2ceb07;}}else loggerService_1[_0x3de2f4(0x2b7)]['logWhiteDomainResponse'](_0x28758c[_0x3de2f4(0x24d)][_0x3de2f4(0x246)](),_0x3de2f4(0x165),_0x1be62e[_0x3de2f4(0x285)],_0x3e0344,_0x573dab),console[_0x3de2f4(0x211)](_0x3de2f4(0x299));console[_0x3de2f4(0x211)](_0x3de2f4(0x279),_0x3e0344[_0x3de2f4(0x285)]),console[_0x3de2f4(0x211)](_0x3de2f4(0x171),_0x3e0344[_0x3de2f4(0x217)]),console[_0x3de2f4(0x211)](_0x3de2f4(0x17a),_0x3e0344[_0x3de2f4(0x1db)]),console[_0x3de2f4(0x211)](_0x3de2f4(0x1c0),_0x3e0344['3ds_url']||_0x3de2f4(0x280));if(_0x3e0344[_0x3de2f4(0x285)]===0x64&&_0x3e0344[_0x3de2f4(0x217)]===0x1)return console[_0x3de2f4(0x211)](_0x3de2f4(0x292)),{'gateway_payment_id':_0x3e0344['payment_id']?.[_0x3de2f4(0x27a)](),'payment_url':_0xd5e01b,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x3e0344['3ds_url'])return console[_0x3de2f4(0x211)](_0x3de2f4(0x166)),this[_0x3de2f4(0x223)](_0x2134e7,_0x356997,_0x3e0344[_0x3de2f4(0x1db)]?.[_0x3de2f4(0x27a)]()||_0x356997,_0x28758c['cardType']),{'gateway_payment_id':_0x3e0344[_0x3de2f4(0x1db)]?.['toString'](),'payment_url':_0x3e0344[_0x3de2f4(0x21a)],'requires_3ds':!![],'threeds_url':_0x3e0344['3ds_url'],'status':_0x3de2f4(0x224),'final':![]};let _0x5c0639=this[_0x3de2f4(0x233)](_0x3e0344['status'],_0x3e0344[_0x3de2f4(0x2ac)]||_0x3e0344['message']),_0x18e8dd=_0x3e0344[_0x3de2f4(0x285)],_0x236b20=this[_0x3de2f4(0x1ed)](_0x3e0344[_0x3de2f4(0x285)]);return console['log']('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x18e8dd+',\x20Final:\x20'+_0x236b20+_0x3de2f4(0x227)+_0x5c0639),{'gateway_payment_id':_0x3e0344[_0x3de2f4(0x1db)]?.[_0x3de2f4(0x27a)](),'payment_url':_0xd5e01b,'requires_3ds':![],'status':'FAILED','final':!![],'errorMessage':_0x5c0639};}catch(_0x29c1a7){console[_0x3de2f4(0x19d)](_0x3de2f4(0x20d)),console[_0x3de2f4(0x19d)]('Error\x20details:',_0x29c1a7),loggerService_1['loggerService'][_0x3de2f4(0x290)](_0x3de2f4(0x232),_0x3de2f4(0x1b2),_0x29c1a7);throw new Error('Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'+(_0x29c1a7 instanceof Error?_0x29c1a7[_0x3de2f4(0x288)]:'Unknown\x20error'));}}async[a51_0x27d78e(0x201)](_0x5d606f,_0x18cde7,_0x495dc=a51_0x27d78e(0x1cc)){const _0x17a9ad=a51_0x27d78e;console[_0x17a9ad(0x211)]('📊\x20Checking\x20'+_0x495dc+'\x20payment\x20status:\x20'+_0x5d606f+'\x20('+_0x18cde7+')');try{const _0xa91c4c={'payment_id':_0x5d606f,'order_id':_0x18cde7},_0x3ca372=JSON[_0x17a9ad(0x22a)](_0xa91c4c),_0x3e054c=this[_0x17a9ad(0x1bd)](_0x495dc===_0x17a9ad(0x1cc)?_0x17a9ad(0x1ca):_0x17a9ad(0x182)),{key:_0x311daa,iv:_0x36a8eb}=this[_0x17a9ad(0x22e)](),_0x5c59ec=this[_0x17a9ad(0x19c)](_0x3ca372,_0x311daa,_0x36a8eb),_0x4cf829=this['encryptRSA'](_0x311daa,_0x36a8eb,_0x3e054c[_0x17a9ad(0x281)]),_0x3b8d66=this[_0x17a9ad(0x1eb)](_0x3ca372,_0x3e054c[_0x17a9ad(0x252)]),_0x532dfb={'merchant_point_id':_0x3e054c[_0x17a9ad(0x275)],'method':_0x17a9ad(0x285),'info':_0x5c59ec,'key':_0x4cf829,'sign':_0x3b8d66,'lang':'en'};loggerService_1[_0x17a9ad(0x2b7)][_0x17a9ad(0x2c3)](_0x495dc[_0x17a9ad(0x246)](),_0x17a9ad(0x1d8),_0x17a9ad(0x257),{'merchant_point_id':_0x3e054c[_0x17a9ad(0x275)],'method':_0x17a9ad(0x285),'lang':'en'});const _0x2a38f3=Date[_0x17a9ad(0x1a3)](),_0x3f9515=await fetch(_0x3e054c[_0x17a9ad(0x2a1)],{'method':_0x17a9ad(0x257),'headers':{'Content-Type':_0x17a9ad(0x272),'Accept':_0x17a9ad(0x272),'User-Agent':_0x17a9ad(0x259)},'body':JSON['stringify'](_0x532dfb)}),_0x2f5bc9=Date[_0x17a9ad(0x1a3)]()-_0x2a38f3;if(!_0x3f9515['ok']){const _0x170b1f=await _0x3f9515[_0x17a9ad(0x273)]();loggerService_1[_0x17a9ad(0x2b7)]['logWhiteDomainResponse'](_0x495dc[_0x17a9ad(0x246)](),_0x17a9ad(0x277),_0x3f9515[_0x17a9ad(0x285)],_0x170b1f,_0x2f5bc9);throw new Error(_0x17a9ad(0x1b8)+_0x3f9515[_0x17a9ad(0x285)]);}const _0x41b733=await _0x3f9515['json']();loggerService_1[_0x17a9ad(0x2b7)][_0x17a9ad(0x2c0)](_0x495dc[_0x17a9ad(0x246)](),_0x17a9ad(0x277),_0x3f9515[_0x17a9ad(0x285)],_0x41b733,_0x2f5bc9);let _0x1b2a3=_0x41b733;if(_0x41b733[_0x17a9ad(0x219)]&&_0x41b733['key']&&_0x41b733[_0x17a9ad(0x254)]){console[_0x17a9ad(0x211)](_0x17a9ad(0x1a0));try{const _0x2e0a4e=await this['decryptResponsePhp'](_0x41b733[_0x17a9ad(0x219)],_0x41b733[_0x17a9ad(0x184)],_0x495dc);_0x1b2a3=JSON[_0x17a9ad(0x1ee)](_0x2e0a4e),console[_0x17a9ad(0x211)](_0x17a9ad(0x234)),loggerService_1[_0x17a9ad(0x2b7)]['logWhiteDomainResponse'](_0x495dc[_0x17a9ad(0x246)](),_0x17a9ad(0x176),_0x3f9515[_0x17a9ad(0x285)],_0x1b2a3,_0x2f5bc9),console['log']('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x4919a2){console['error']('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x4919a2),loggerService_1[_0x17a9ad(0x2b7)][_0x17a9ad(0x290)](_0x495dc[_0x17a9ad(0x246)](),_0x17a9ad(0x249),_0x17a9ad(0x169)+_0x4919a2),_0x1b2a3=_0x41b733;}}else loggerService_1['loggerService'][_0x17a9ad(0x2c0)](_0x495dc[_0x17a9ad(0x246)](),_0x17a9ad(0x176),_0x3f9515[_0x17a9ad(0x285)],_0x1b2a3,_0x2f5bc9),console[_0x17a9ad(0x211)](_0x17a9ad(0x1da));console[_0x17a9ad(0x211)](_0x17a9ad(0x16d),{'status':_0x1b2a3[_0x17a9ad(0x285)],'final':_0x1b2a3[_0x17a9ad(0x217)],'payment_id':_0x1b2a3[_0x17a9ad(0x1db)],'desc':_0x1b2a3[_0x17a9ad(0x2ac)]});let _0x145fb1='PENDING';if(_0x1b2a3['status']===0x64&&_0x1b2a3[_0x17a9ad(0x217)]===0x1)_0x145fb1=_0x17a9ad(0x2b2);else{if(_0x1b2a3[_0x17a9ad(0x217)]===0x0||!this[_0x17a9ad(0x1ed)](_0x1b2a3[_0x17a9ad(0x285)]))_0x145fb1=_0x17a9ad(0x224);else _0x1b2a3[_0x17a9ad(0x217)]===0x1||this[_0x17a9ad(0x1ed)](_0x1b2a3[_0x17a9ad(0x285)])?_0x145fb1=_0x17a9ad(0x191):_0x145fb1=_0x17a9ad(0x224);}const _0x53041a=this[_0x17a9ad(0x233)](_0x1b2a3[_0x17a9ad(0x285)],_0x1b2a3[_0x17a9ad(0x2ac)]);return{'status':_0x145fb1,'final':this[_0x17a9ad(0x1ed)](_0x1b2a3['status']),'amount':_0x1b2a3[_0x17a9ad(0x25f)],'currency':_0x1b2a3[_0x17a9ad(0x29e)],'date_success':_0x1b2a3[_0x17a9ad(0x22b)],'description':_0x53041a};}catch(_0x4c104c){console[_0x17a9ad(0x19d)](_0x495dc+_0x17a9ad(0x2ba),_0x4c104c),loggerService_1[_0x17a9ad(0x2b7)][_0x17a9ad(0x290)](_0x495dc[_0x17a9ad(0x246)](),_0x17a9ad(0x1d8),_0x4c104c);throw new Error(_0x17a9ad(0x2be)+_0x495dc+'\x20payment\x20status:\x20'+(_0x4c104c instanceof Error?_0x4c104c[_0x17a9ad(0x288)]:_0x17a9ad(0x228)));}}[a51_0x27d78e(0x223)](_0x43178f,_0x3b7584,_0x274edd,_0x244c02){const _0x39e46b=a51_0x27d78e;console[_0x39e46b(0x211)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20'+_0x244c02+_0x39e46b(0x1c2)+_0x43178f+'\x20('+_0x274edd+')'),this[_0x39e46b(0x2a7)](_0x43178f);const _0x538ef2=[],_0x14cc5d=0x5*0x3c*0x3e8,_0x160ce6=0x2*0x3c*0x3c*0x3e8,_0x15707a=Math['floor'](_0x160ce6/_0x14cc5d);console[_0x39e46b(0x211)]('⏰\x20Will\x20check\x20status\x20'+_0x15707a+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x867b9d=0x1;_0x867b9d<=_0x15707a;_0x867b9d++){const _0x293662=setTimeout(async()=>{const _0x30620c=_0x39e46b;console[_0x30620c(0x211)](_0x30620c(0x27f)+_0x244c02+_0x30620c(0x21b)+_0x867b9d+'/'+_0x15707a+_0x30620c(0x287)+_0x43178f);try{const _0x1fa080=await this[_0x30620c(0x201)](_0x274edd,_0x3b7584,_0x244c02);console['log'](_0x30620c(0x26c)+_0x867b9d+_0x30620c(0x18d),_0x1fa080),_0x1fa080[_0x30620c(0x217)]&&(console[_0x30620c(0x211)]('✅\x20Payment\x20'+_0x43178f+_0x30620c(0x1f0)+_0x1fa080[_0x30620c(0x285)]+'),\x20stopping\x20status\x20checks'),this[_0x30620c(0x2a7)](_0x43178f),await this[_0x30620c(0x253)](_0x43178f,_0x1fa080[_0x30620c(0x285)],_0x1fa080));}catch(_0x5cfc5f){console[_0x30620c(0x19d)](_0x30620c(0x183)+_0x867b9d+'\x20failed\x20for\x20payment\x20'+_0x43178f+':',_0x5cfc5f);}},_0x867b9d*_0x14cc5d);_0x538ef2[_0x39e46b(0x298)](_0x293662);}this[_0x39e46b(0x207)][_0x39e46b(0x1b7)](_0x43178f,_0x538ef2),console[_0x39e46b(0x211)](_0x39e46b(0x236)+_0x15707a+_0x39e46b(0x17f)+_0x43178f);}['clearStatusTimers'](_0x56368c){const _0xcbb96c=a51_0x27d78e,_0x34d7ab=this[_0xcbb96c(0x207)]['get'](_0x56368c);_0x34d7ab&&(console['log'](_0xcbb96c(0x24f)+_0x34d7ab[_0xcbb96c(0x24e)]+_0xcbb96c(0x1d1)+_0x56368c),_0x34d7ab[_0xcbb96c(0x1e9)]((_0x761d76,_0x2c11b0)=>{clearTimeout(_0x761d76);}),this[_0xcbb96c(0x207)][_0xcbb96c(0x243)](_0x56368c));}async[a51_0x27d78e(0x253)](_0x529d8d,_0x5e7173,_0x155aad){const _0x169149=a51_0x27d78e;try{const _0x14bccf=(await Promise['resolve']()[_0x169149(0x1af)](()=>__importStar(require('../../config/database'))))[_0x169149(0x1f6)],_0x46b4c6={'status':_0x5e7173[_0x169149(0x263)](),'updatedAt':new Date(),'statusChangedBy':_0x169149(0x2bb),'statusChangedAt':new Date()};_0x5e7173===_0x169149(0x2b2)&&(_0x46b4c6[_0x169149(0x28f)]=new Date()),_0x5e7173===_0x169149(0x191)&&_0x155aad[_0x169149(0x2cc)]&&(_0x46b4c6[_0x169149(0x1de)]=_0x155aad[_0x169149(0x2cc)],console['log'](_0x169149(0x1a9)+_0x155aad[_0x169149(0x2cc)])),_0x155aad[_0x169149(0x2cc)]&&(_0x46b4c6[_0x169149(0x19b)]=(_0x5e7173===_0x169149(0x2b2)?_0x169149(0x1d4):_0x169149(0x270))+':\x20'+_0x155aad[_0x169149(0x2cc)]),await _0x14bccf[_0x169149(0x1d3)][_0x169149(0x2a2)]({'where':{'id':_0x529d8d},'data':_0x46b4c6}),console[_0x169149(0x211)](_0x169149(0x2c6)+_0x529d8d+_0x169149(0x2a9)+_0x5e7173),await this[_0x169149(0x167)](_0x529d8d,_0x5e7173);}catch(_0x3ceabc){console[_0x169149(0x19d)]('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x529d8d+':',_0x3ceabc);}}async[a51_0x27d78e(0x167)](_0x3d987b,_0x31d6fb){const _0x1003ca=a51_0x27d78e;try{const _0x31fbe3=(await Promise[_0x1003ca(0x286)]()[_0x1003ca(0x1af)](()=>__importStar(require('../../config/database'))))[_0x1003ca(0x1f6)],{telegramBotService:_0x50e053}=await Promise[_0x1003ca(0x286)]()[_0x1003ca(0x1af)](()=>__importStar(require(_0x1003ca(0x2bd)))),_0x12a0a4=await _0x31fbe3[_0x1003ca(0x1d3)][_0x1003ca(0x1be)]({'where':{'id':_0x3d987b},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x12a0a4)return;const _0x8aab7={'PAID':_0x1003ca(0x28b),'FAILED':_0x1003ca(0x29f)},_0x18c9cd=_0x8aab7[_0x31d6fb];_0x18c9cd&&await _0x50e053[_0x1003ca(0x203)](_0x12a0a4[_0x1003ca(0x2c8)],_0x12a0a4,_0x18c9cd),await this[_0x1003ca(0x2bc)](_0x12a0a4,_0x31d6fb);}catch(_0x43982a){console[_0x1003ca(0x19d)](_0x1003ca(0x22c),_0x43982a);}}async[a51_0x27d78e(0x2bc)](_0x30450f,_0x1a50dd){const _0x434523=a51_0x27d78e,_0x6c6b38=Date[_0x434523(0x1a3)]();try{const _0x16baae=_0x30450f[_0x434523(0x23a)],_0x4e7842=_0x16baae[_0x434523(0x1a2)];if(!_0x4e7842?.['webhookUrl']){console[_0x434523(0x211)](_0x434523(0x241)+_0x16baae['id']);return;}const _0x5c7e7a=_0x1a50dd===_0x434523(0x2b2)?'payment.success':_0x434523(0x296);let _0x23ce22=[];if(_0x4e7842['webhookEvents'])try{_0x23ce22=Array[_0x434523(0x210)](_0x4e7842[_0x434523(0x289)])?_0x4e7842[_0x434523(0x289)]:JSON[_0x434523(0x1ee)](_0x4e7842[_0x434523(0x289)]);}catch(_0x437e82){console['error'](_0x434523(0x230),_0x437e82),_0x23ce22=[];}if(!_0x23ce22[_0x434523(0x1c3)](_0x5c7e7a)){console[_0x434523(0x211)]('Webhook\x20event\x20'+_0x5c7e7a+_0x434523(0x1b4)+_0x16baae['id']);return;}const _0xabddf7={'event':_0x5c7e7a,'payment':{'id':_0x30450f['id'],'order_id':_0x30450f['orderId'],'gateway_order_id':_0x30450f[_0x434523(0x1ad)],'gateway':_0x434523(0x21c),'amount':_0x30450f[_0x434523(0x25f)],'currency':_0x30450f['currency'],'status':_0x1a50dd['toLowerCase'](),'customer_email':_0x30450f['customerEmail'],'customer_name':_0x30450f[_0x434523(0x28e)],'created_at':_0x30450f['createdAt'],'updated_at':new Date()}},_0x2678b2=await fetch(_0x4e7842['webhookUrl'],{'method':_0x434523(0x257),'headers':{'Content-Type':'application/json','User-Agent':_0x434523(0x1d7)},'body':JSON['stringify'](_0xabddf7)}),_0x230150=Date[_0x434523(0x1a3)]()-_0x6c6b38;loggerService_1['loggerService'][_0x434523(0x278)](_0x30450f[_0x434523(0x2c8)],_0x4e7842[_0x434523(0x1ba)],_0x5c7e7a,_0x2678b2[_0x434523(0x285)],_0x230150,_0xabddf7),console[_0x434523(0x211)](_0x434523(0x2c9)+_0x4e7842[_0x434523(0x1ba)]+_0x434523(0x26f)+_0x2678b2[_0x434523(0x285)]+'\x20('+_0x230150+'ms)');}catch(_0x1177ad){console[_0x434523(0x19d)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x1177ad),loggerService_1['loggerService'][_0x434523(0x1cf)](_0x30450f[_0x434523(0x2c8)],_0x30450f['shop']?.[_0x434523(0x1a2)]?.[_0x434523(0x1ba)]||_0x434523(0x177),_0x434523(0x1e2),_0x1177ad,{});}}[a51_0x27d78e(0x284)](_0x57ab69){const _0x2dcc3b=a51_0x27d78e,_0x342e4b=_0x57ab69[_0x2dcc3b(0x28d)](/[\s-]/g,'');if(_0x342e4b[_0x2dcc3b(0x24e)]<0x4)return'****';return _0x2dcc3b(0x215)+_0x342e4b[_0x2dcc3b(0x220)](-0x4);}async[a51_0x27d78e(0x28a)](_0x16b93d,_0x437e16=a51_0x27d78e(0x239)){const _0x4c83f4=a51_0x27d78e;console[_0x4c83f4(0x211)](_0x4c83f4(0x200),JSON['stringify'](_0x16b93d,null,0x2));let _0x1a46c3=_0x16b93d,_0x345030=_0x437e16;_0x16b93d[_0x4c83f4(0x26d)]?(_0x345030=_0x16b93d[_0x4c83f4(0x26d)][_0x4c83f4(0x263)]()===_0x4c83f4(0x1cc)?_0x4c83f4(0x1cc):'MASTERCARD',console[_0x4c83f4(0x211)](_0x4c83f4(0x1a4)+_0x345030)):console[_0x4c83f4(0x211)](_0x4c83f4(0x1b3)+_0x345030);if(_0x16b93d['info']&&_0x16b93d[_0x4c83f4(0x184)]&&_0x16b93d[_0x4c83f4(0x254)]){console['log'](_0x4c83f4(0x1c9));try{const _0x9e98b1=await this['decryptResponsePhp'](_0x16b93d[_0x4c83f4(0x219)],_0x16b93d['key'],_0x345030);_0x1a46c3=JSON['parse'](_0x9e98b1),console['log'](_0x4c83f4(0x1e4)),console[_0x4c83f4(0x211)](_0x4c83f4(0x2b3),JSON[_0x4c83f4(0x22a)](_0x1a46c3,null,0x2));}catch(_0x26abea){console['error'](_0x4c83f4(0x1a6),_0x26abea),console[_0x4c83f4(0x211)]('⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted'),_0x1a46c3=_0x16b93d;}}else console['log'](_0x4c83f4(0x2c4));let _0x16c256='PENDING';if(_0x1a46c3['status']===0x64&&_0x1a46c3[_0x4c83f4(0x217)]===0x1)_0x16c256='PAID';else{if(_0x1a46c3[_0x4c83f4(0x217)]===0x0||!this[_0x4c83f4(0x1ed)](_0x1a46c3[_0x4c83f4(0x285)]))_0x16c256=_0x4c83f4(0x224);else _0x1a46c3['final']===0x1||this['isFinalStatus'](_0x1a46c3[_0x4c83f4(0x285)])?_0x16c256=_0x4c83f4(0x191):_0x16c256='PENDING';}let _0x1201cc='';if(_0x1a46c3[_0x4c83f4(0x1c6)])_0x1201cc=_0x1a46c3[_0x4c83f4(0x1c6)][_0x4c83f4(0x27a)](),console[_0x4c83f4(0x211)]('🔍\x20Using\x20'+_0x345030+_0x4c83f4(0x247)+_0x1201cc);else _0x1a46c3[_0x4c83f4(0x1db)]?(_0x1201cc=_0x1a46c3[_0x4c83f4(0x1db)][_0x4c83f4(0x27a)](),console['log'](_0x4c83f4(0x180)+_0x345030+_0x4c83f4(0x2b1)+_0x1201cc)):(_0x1201cc=_0x1a46c3[_0x4c83f4(0x242)]||_0x1a46c3[_0x4c83f4(0x29b)]||_0x1a46c3['id']||'',console[_0x4c83f4(0x211)](_0x4c83f4(0x237)+_0x1201cc));console[_0x4c83f4(0x211)](_0x4c83f4(0x24c)+_0x345030+_0x4c83f4(0x1b6)),console['log'](_0x4c83f4(0x20b)+_0x1201cc+_0x4c83f4(0x1ff)+_0x1a46c3[_0x4c83f4(0x1c6)]+_0x4c83f4(0x26e)+_0x1a46c3['orderId']+_0x4c83f4(0x2b6)+_0x1a46c3[_0x4c83f4(0x1db)]+_0x4c83f4(0x1f2)+_0x1a46c3[_0x4c83f4(0x29b)]+_0x4c83f4(0x238)+_0x1a46c3['id']+')'),console['log'](_0x4c83f4(0x267)+_0x16c256+'\x20(from:\x20status='+_0x1a46c3[_0x4c83f4(0x285)]+_0x4c83f4(0x17d)+_0x1a46c3[_0x4c83f4(0x217)]+')'),console[_0x4c83f4(0x211)](_0x4c83f4(0x1d6)+_0x1a46c3[_0x4c83f4(0x25f)]),console['log'](_0x4c83f4(0x2b5)+_0x1a46c3[_0x4c83f4(0x29e)]);let _0x1eb7ea;_0x16c256==='FAILED'&&(_0x1eb7ea=this[_0x4c83f4(0x233)](_0x1a46c3[_0x4c83f4(0x285)],_0x1a46c3[_0x4c83f4(0x2ac)]),console[_0x4c83f4(0x211)]('❌\x20Detailed\x20failure\x20description:\x20'+_0x1eb7ea));const _0x1f4c64={'paymentId':_0x1201cc,'status':_0x16c256,'amount':_0x1a46c3[_0x4c83f4(0x25f)],'currency':_0x1a46c3['currency']};return _0x1eb7ea&&(_0x1f4c64[_0x4c83f4(0x189)]=_0x1eb7ea),_0x1f4c64;}[a51_0x27d78e(0x1bb)](){const _0x19e75e=a51_0x27d78e;console[_0x19e75e(0x211)](_0x19e75e(0x1e6));const _0x1fd7bb=this['statusCheckTimers']['size'];for(const [_0xbde52b]of this[_0x19e75e(0x207)]){this[_0x19e75e(0x2a7)](_0xbde52b);}console['log']('🛑\x20Stopped\x20'+_0x1fd7bb+_0x19e75e(0x27d));}}exports[a51_0x27d78e(0x198)]=VisaMasterCardService;