'use strict';const a42_0xfa2b0d=a42_0x4413;(function(_0x477b28,_0x5c91ff){const _0x969b79=a42_0x4413,_0x2e8952=_0x477b28();while(!![]){try{const _0x3c1315=parseInt(_0x969b79(0x23a))/0x1*(parseInt(_0x969b79(0x2bc))/0x2)+parseInt(_0x969b79(0x266))/0x3*(parseInt(_0x969b79(0x2c4))/0x4)+parseInt(_0x969b79(0x27b))/0x5*(parseInt(_0x969b79(0x2a9))/0x6)+-parseInt(_0x969b79(0x283))/0x7+parseInt(_0x969b79(0x21e))/0x8+parseInt(_0x969b79(0x26c))/0x9+-parseInt(_0x969b79(0x1f9))/0xa;if(_0x3c1315===_0x5c91ff)break;else _0x2e8952['push'](_0x2e8952['shift']());}catch(_0x441103){_0x2e8952['push'](_0x2e8952['shift']());}}}(a42_0x37f6,0xf0272));var __createBinding=this&&this[a42_0xfa2b0d(0x1df)]||(Object[a42_0xfa2b0d(0x24c)]?function(_0x5004b3,_0x41e41b,_0x3ed69c,_0x1fb6e8){const _0x1e6cb4=a42_0xfa2b0d;if(_0x1fb6e8===undefined)_0x1fb6e8=_0x3ed69c;var _0x3831f5=Object[_0x1e6cb4(0x252)](_0x41e41b,_0x3ed69c);(!_0x3831f5||(_0x1e6cb4(0x230)in _0x3831f5?!_0x41e41b[_0x1e6cb4(0x29c)]:_0x3831f5[_0x1e6cb4(0x258)]||_0x3831f5[_0x1e6cb4(0x1dd)]))&&(_0x3831f5={'enumerable':!![],'get':function(){return _0x41e41b[_0x3ed69c];}}),Object[_0x1e6cb4(0x1f8)](_0x5004b3,_0x1fb6e8,_0x3831f5);}:function(_0x4b71bc,_0x5ebb50,_0x1eb9fd,_0x44b37c){if(_0x44b37c===undefined)_0x44b37c=_0x1eb9fd;_0x4b71bc[_0x44b37c]=_0x5ebb50[_0x1eb9fd];}),__setModuleDefault=this&&this[a42_0xfa2b0d(0x21f)]||(Object[a42_0xfa2b0d(0x24c)]?function(_0x634f95,_0x37cb0e){const _0x22f994=a42_0xfa2b0d;Object[_0x22f994(0x1f8)](_0x634f95,_0x22f994(0x2ad),{'enumerable':!![],'value':_0x37cb0e});}:function(_0x9fd074,_0x232b15){_0x9fd074['default']=_0x232b15;}),__importStar=this&&this[a42_0xfa2b0d(0x205)]||(function(){var _0x3a0155=function(_0x4c918e){const _0x654878=a42_0x4413;return _0x3a0155=Object[_0x654878(0x287)]||function(_0xd0c467){const _0x46f639=_0x654878;var _0x51af78=[];for(var _0x7a858c in _0xd0c467)if(Object['prototype'][_0x46f639(0x1e5)]['call'](_0xd0c467,_0x7a858c))_0x51af78[_0x51af78['length']]=_0x7a858c;return _0x51af78;},_0x3a0155(_0x4c918e);};return function(_0x22e37d){const _0x1039e8=a42_0x4413;if(_0x22e37d&&_0x22e37d[_0x1039e8(0x29c)])return _0x22e37d;var _0x1de00e={};if(_0x22e37d!=null){for(var _0x3aa223=_0x3a0155(_0x22e37d),_0x168192=0x0;_0x168192<_0x3aa223[_0x1039e8(0x28b)];_0x168192++)if(_0x3aa223[_0x168192]!=='default')__createBinding(_0x1de00e,_0x22e37d,_0x3aa223[_0x168192]);}return __setModuleDefault(_0x1de00e,_0x22e37d),_0x1de00e;};}()),__importDefault=this&&this['__importDefault']||function(_0x3ded63){const _0x3ed97f=a42_0xfa2b0d;return _0x3ded63&&_0x3ded63[_0x3ed97f(0x29c)]?_0x3ded63:{'default':_0x3ded63};};Object['defineProperty'](exports,a42_0xfa2b0d(0x29c),{'value':!![]}),exports[a42_0xfa2b0d(0x1d9)]=void 0x0;function a42_0x37f6(){const _0x54f836=['message','gatewayOrderId','webhookUrl','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','📝\x20Encrypted\x20data\x20length:','apiUrl','delete','defineProperty','21460170ajckdm','-----END','3DS\x20URL:','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','sendShopWebhook','Decryption\x20failed:\x20','/charge_raw','/status_decrypt','crypto','Error\x20parsing\x20webhook\x20events:','❌\x20MasterCard\x20key\x20validation\x20failed:','publicKeyPath','__importStar','/charge','updatePaymentStatus','🔐\x203DS\x20verification\x20required','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','📊\x20Status\x20check\x20result:','Failed\x20to\x20decrypt\x20response','\x20status\x20updated\x20to\x20','stopAllStatusChecks','orderId','Public\x20key\x20file\x20not\x20found:\x20','charge','Response\x20Time:','****\x20****\x20****\x20','🔍\x20MasterCard\x20status\x20check\x20#','maskCardNumber','📝\x20Encrypted\x20key\x20length:','3ds_url','readFileSync','number','ms)','/status','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','\x20not\x20enabled\x20for\x20shop\x20','11456664YVxDoj','__setModuleDefault','decryptResponsePhp','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','payment','📝\x20Data\x20to\x20sign\x20length:','\x20failed\x20for\x20payment\x20','✅\x20Status\x20response\x20decrypted\x20successfully','\x20for\x20payment\x20','push','error','forEach','log','../../config/database','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',',\x20body:\x20',',\x20Final:\x20','),\x20stopping\x20status\x20checks','get','/status_raw','\x20status\x20checks\x20for\x20payment\x20','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','\x20\x20\x20-\x20lang:\x20en','/charge_decrypted','Return\x20URL:','1111','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','FAILED','154hNkNqv','💾\x20Payment\x20data\x20prepared','payment.failed','resolve','...','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','-----BEGIN','Card\x20Holder:','expire_year','system','then','paid','adminNotes','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','SHA256','MasterCard:\x20','POST','application/json','create','\x20is\x20final\x20(','floor','shopId','Error\x20details:','description','getOwnPropertyDescriptor','json','/status_decrypted','join','signRSA','shop','writable','🔐\x20AES\x20key\x20and\x20IV\x20generated','sendPaymentNotifications','Card\x20Number:','HTTP\x20','includes','base64','PAID','✅\x20Payment\x20successful','desc','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','statusCheckTimers','payment.success','expire_month','357egKZCE','Private\x20key\x20file\x20not\x20found:\x20','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','scheduleStatusChecks','stringify','toString','4000284zXWVhd','/charge_decrypt','logShopWebhookError','clearStatusTimers','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','generateAESKey','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','encryptAES','randomBytes','❌\x20PHP\x20decryptor\x20request\x20failed:','TesSoft\x20Payment\x20System/1.0','parse','settings','date_success','Response\x20Body:','14015HiUAQq','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','🧹\x20Clearing\x20','encryptRSA','Payment\x20ID:','findUnique','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','https://api.paydmeth.com/api','3892798KQpFXV','validateKeyFiles','publicEncrypt','\x20with\x20status\x20','getOwnPropertyNames','text','currency','🔐\x20Private\x20key\x20path:','length','failed','logWhiteDomainError','❌\x20RSA\x20encryption\x20failed:','end','from','createCipheriv','../loggerService','MasterCard\x20webhook\x20sent\x20to\x20','sendPaymentNotification','Processing\x20MasterCard\x20webhook:','cvv','processWebhook','none','sign','substring','customerEmail','__esModule','Status:','\x20status\x20timers\x20for\x20payment\x20','keys','trim','paidAt','aes-256-ctr','first_name','decryptResponse','🛑\x20Stopped\x20','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','PENDING','createdAt','78zavXJk','processCardPayment','privateKeyPath','order_id','default','payment_id','decryptAES','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','webhook_send','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','key','utf8','🔐\x20Data\x20encrypted\x20with\x20AES','📝\x20Final\x20request\x20structure:','now','🔐\x20Private\x20key\x20length:\x20','final','toUpperCase','HTTP\x20error!\x20status:\x20','19628MVRXFU','status','createDecipheriv','****','❌\x20Status\x20check\x20#','cwd','❌\x20Data\x20being\x20signed:','mastercard','8788ruKIZr','update','toLowerCase','Status\x20decryption\x20failed:\x20','../telegramBotService','\x20\x20\x20-\x20method:\x20charge','Unknown\x20error','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','slice','MasterCardService','webhookEvents','constants','\x20\x20\x20-\x20sign\x20length:','configurable','\x20characters','__createBinding','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','✅\x20Payment\x20','❌\x20RSA\x20signing\x20failed:','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','last_name','hasOwnProperty','info','checkPaymentStatus','loggerService','merchantPointId','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','\x20\x20\x20-\x20info\x20length:','set','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','logWhiteDomainResponse','\x20\x20\x20-\x20merchant_point_id:','💳\x20MasterCard\x20service\x20initialized'];a42_0x37f6=function(){return _0x54f836;};return a42_0x37f6();}const crypto_1=__importDefault(require(a42_0xfa2b0d(0x201))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a42_0xfa2b0d(0x292));class MasterCardService{constructor(){const _0x2a9194=a42_0xfa2b0d;this[_0x2a9194(0x263)]=new Map(),this[_0x2a9194(0x1f6)]=_0x2a9194(0x282),this[_0x2a9194(0x1e9)]=0x67c,this[_0x2a9194(0x2ab)]=path_1[_0x2a9194(0x2ad)]['join'](process[_0x2a9194(0x2c1)](),_0x2a9194(0x29f),'private.pem'),this[_0x2a9194(0x204)]=path_1['default'][_0x2a9194(0x255)](process[_0x2a9194(0x2c1)](),_0x2a9194(0x29f),'psp_public.pem'),console[_0x2a9194(0x22a)](_0x2a9194(0x1f0)),console[_0x2a9194(0x22a)](_0x2a9194(0x28a),this['privateKeyPath']),console[_0x2a9194(0x22a)]('🔐\x20Public\x20key\x20path:',this['publicKeyPath']),this[_0x2a9194(0x284)]();}[a42_0xfa2b0d(0x284)](){const _0x3b54ca=a42_0xfa2b0d;try{if(!fs_1[_0x3b54ca(0x2ad)]['existsSync'](this['privateKeyPath']))throw new Error(_0x3b54ca(0x267)+this['privateKeyPath']);if(!fs_1[_0x3b54ca(0x2ad)]['existsSync'](this[_0x3b54ca(0x204)]))throw new Error(_0x3b54ca(0x20f)+this[_0x3b54ca(0x204)]);const _0x2e7bb4=fs_1[_0x3b54ca(0x2ad)][_0x3b54ca(0x217)](this[_0x3b54ca(0x2ab)],_0x3b54ca(0x2b4))[_0x3b54ca(0x2a0)](),_0x5a9857=fs_1['default']['readFileSync'](this[_0x3b54ca(0x204)],_0x3b54ca(0x2b4))[_0x3b54ca(0x2a0)]();if(!_0x2e7bb4[_0x3b54ca(0x25d)](_0x3b54ca(0x240))||!_0x2e7bb4[_0x3b54ca(0x25d)](_0x3b54ca(0x1fa)))throw new Error(_0x3b54ca(0x247));if(!_0x5a9857[_0x3b54ca(0x25d)](_0x3b54ca(0x240))||!_0x5a9857['includes']('-----END'))throw new Error(_0x3b54ca(0x21c));console['log'](_0x3b54ca(0x281)),console[_0x3b54ca(0x22a)](_0x3b54ca(0x2b8)+_0x2e7bb4[_0x3b54ca(0x28b)]+_0x3b54ca(0x1de)),console[_0x3b54ca(0x22a)]('🔐\x20Public\x20key\x20length:\x20'+_0x5a9857['length']+'\x20characters');}catch(_0x9da371){console['error'](_0x3b54ca(0x203),_0x9da371);throw _0x9da371;}}['generateAESKey'](){const _0xeaa1c9=a42_0xfa2b0d,_0x5f1eff=crypto_1[_0xeaa1c9(0x2ad)][_0xeaa1c9(0x274)](0x20),_0x344afa=crypto_1[_0xeaa1c9(0x2ad)]['randomBytes'](0x10);return{'key':_0x5f1eff,'iv':_0x344afa};}['encryptAES'](_0x3ff8aa,_0x80fcbf,_0x39b347){const _0x202385=a42_0xfa2b0d,_0x5c46de=crypto_1[_0x202385(0x2ad)][_0x202385(0x291)](_0x202385(0x2a2),_0x80fcbf,_0x39b347);let _0x2684c9=_0x5c46de['update'](_0x3ff8aa,'utf8',_0x202385(0x25e));return _0x2684c9+=_0x5c46de['final'](_0x202385(0x25e)),_0x2684c9;}['encryptRSA'](_0x584a4a,_0x23ef48){const _0x4a823c=a42_0xfa2b0d;try{const _0x542449=fs_1['default'][_0x4a823c(0x217)](this[_0x4a823c(0x204)],_0x4a823c(0x2b4))[_0x4a823c(0x2a0)](),_0x2a4764={'iv':_0x23ef48['toString'](_0x4a823c(0x25e)),'key':_0x584a4a[_0x4a823c(0x26b)](_0x4a823c(0x25e))},_0x30fdeb=JSON[_0x4a823c(0x26a)](_0x2a4764);console['log'](_0x4a823c(0x22c),_0x30fdeb[_0x4a823c(0x28b)]);const _0x4c0363=crypto_1[_0x4a823c(0x2ad)][_0x4a823c(0x285)]({'key':_0x542449,'padding':crypto_1[_0x4a823c(0x2ad)][_0x4a823c(0x1db)]['RSA_PKCS1_PADDING']},Buffer[_0x4a823c(0x290)](_0x30fdeb));return console[_0x4a823c(0x22a)](_0x4a823c(0x1ed),_0x4c0363['length']),_0x4c0363[_0x4a823c(0x26b)](_0x4a823c(0x25e));}catch(_0x126c96){console[_0x4a823c(0x228)](_0x4a823c(0x28e),_0x126c96);throw new Error(_0x4a823c(0x209));}}['signRSA'](_0x58c9a7){const _0xfca36b=a42_0xfa2b0d;try{const _0x207e66=fs_1[_0xfca36b(0x2ad)][_0xfca36b(0x217)](this[_0xfca36b(0x2ab)],_0xfca36b(0x2b4))['trim'](),_0x4f6715=crypto_1[_0xfca36b(0x2ad)]['createSign'](_0xfca36b(0x248));_0x4f6715[_0xfca36b(0x2c5)](_0x58c9a7),_0x4f6715[_0xfca36b(0x28f)]();const _0x3700d2=_0x4f6715[_0xfca36b(0x299)](_0x207e66,_0xfca36b(0x25e));return console[_0xfca36b(0x22a)]('🔐\x20RSA\x20signing\x20successful'),console['log'](_0xfca36b(0x223),_0x58c9a7[_0xfca36b(0x28b)]),console[_0xfca36b(0x22a)]('📝\x20Signature\x20length:',_0x3700d2[_0xfca36b(0x28b)]),_0x3700d2;}catch(_0x1f04c3){console[_0xfca36b(0x228)](_0xfca36b(0x1e2),_0x1f04c3),console[_0xfca36b(0x228)](_0xfca36b(0x2c2),_0x58c9a7[_0xfca36b(0x29a)](0x0,0xc8)+_0xfca36b(0x23e));throw new Error(_0xfca36b(0x268));}}[a42_0xfa2b0d(0x2af)](_0x5512e5,_0x240378,_0x188d76){const _0x5ef64a=a42_0xfa2b0d,_0x1b82bc=crypto_1[_0x5ef64a(0x2ad)][_0x5ef64a(0x2be)]('aes-256-ctr',_0x240378,_0x188d76);let _0x42b6e3=_0x1b82bc[_0x5ef64a(0x2c5)](_0x5512e5,_0x5ef64a(0x25e),_0x5ef64a(0x2b4));return _0x42b6e3+=_0x1b82bc[_0x5ef64a(0x2b9)](_0x5ef64a(0x2b4)),_0x42b6e3;}async['decryptResponsePhp'](_0x26b989,_0x209682){const _0x43adc8=a42_0xfa2b0d;try{const _0x1b0ecf=await fetch('https://api2.trapay.uk/decrypt.php',{'method':'POST','headers':{'Content-Type':_0x43adc8(0x24b)},'body':JSON['stringify']({'info':_0x26b989,'key':_0x209682})});if(!_0x1b0ecf['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x1b0ecf[_0x43adc8(0x288)]();}catch(_0x32e1dc){console[_0x43adc8(0x228)](_0x43adc8(0x275),_0x32e1dc);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a42_0xfa2b0d(0x2a4)](_0x23f55f,_0x2ad9d0){const _0x5e78cb=a42_0xfa2b0d;try{const _0x6f1359=fs_1[_0x5e78cb(0x2ad)][_0x5e78cb(0x217)](this[_0x5e78cb(0x2ab)],_0x5e78cb(0x2b4))[_0x5e78cb(0x2a0)](),_0x457f95=crypto_1[_0x5e78cb(0x2ad)]['privateDecrypt'](_0x6f1359,Buffer['from'](_0x2ad9d0,_0x5e78cb(0x25e))),_0x24af9d=JSON[_0x5e78cb(0x277)](_0x457f95[_0x5e78cb(0x26b)]()),_0xacfad0=Buffer['from'](_0x24af9d[_0x5e78cb(0x2b3)],_0x5e78cb(0x25e)),_0xf69a94=Buffer[_0x5e78cb(0x290)](_0x24af9d['iv'],_0x5e78cb(0x25e));return this[_0x5e78cb(0x2af)](_0x23f55f,_0xacfad0,_0xf69a94);}catch(_0x20ae88){throw new Error(_0x5e78cb(0x20b));}}async[a42_0xfa2b0d(0x2aa)](_0x50581f){const _0x22aac9=a42_0xfa2b0d,{paymentId:_0x5f3fed,orderId:_0x197603,amount:_0x322c10,currency:_0x54e090,cardData:_0x86849d,resultUrl:_0x5cadf7,returnUrl:_0x4b696c,cardHolder:_0x481474,browser:_0x3fb6d2}=_0x50581f;console[_0x22aac9(0x22a)]('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x22aac9(0x22a)](_0x22aac9(0x27f),_0x5f3fed),console['log']('Order\x20ID:',_0x197603),console[_0x22aac9(0x22a)]('Amount:',_0x322c10,_0x54e090),console[_0x22aac9(0x22a)](_0x22aac9(0x25b),this[_0x22aac9(0x214)](_0x86849d[_0x22aac9(0x218)])),console[_0x22aac9(0x22a)](_0x22aac9(0x241),_0x481474[_0x22aac9(0x2a3)]+'\x20'+_0x481474[_0x22aac9(0x1e4)]),console['log'](_0x22aac9(0x236),_0x4b696c),console[_0x22aac9(0x22a)]('Result\x20URL:',_0x5cadf7);const _0x13ba47={'amount':_0x322c10,'currency':_0x54e090[_0x22aac9(0x2ba)](),'order_id':_0x197603,'result_url':_0x5cadf7,'return_url':_0x4b696c,'card':{'number':_0x86849d[_0x22aac9(0x218)],'expire_month':_0x86849d[_0x22aac9(0x265)],'expire_year':_0x86849d[_0x22aac9(0x242)],'cvv':_0x86849d[_0x22aac9(0x296)]},'card_holder':_0x481474,'browser':_0x3fb6d2},_0x244666=JSON[_0x22aac9(0x26a)](_0x13ba47);console[_0x22aac9(0x22a)](_0x22aac9(0x23b)),console[_0x22aac9(0x22a)](_0x22aac9(0x27c)),console['log'](_0x244666),console[_0x22aac9(0x22a)]('📝\x20Data\x20length:',_0x244666[_0x22aac9(0x28b)]);try{const {key:_0x453717,iv:_0x4160fa}=this[_0x22aac9(0x271)]();console[_0x22aac9(0x22a)](_0x22aac9(0x259)),console['log']('🔐\x20AES\x20key\x20length:',_0x453717['length']),console[_0x22aac9(0x22a)]('🔐\x20AES\x20IV\x20length:',_0x4160fa[_0x22aac9(0x28b)]);const _0x3d1668=this[_0x22aac9(0x273)](_0x244666,_0x453717,_0x4160fa);console[_0x22aac9(0x22a)](_0x22aac9(0x2b5)),console[_0x22aac9(0x22a)](_0x22aac9(0x1f5),_0x3d1668[_0x22aac9(0x28b)]);const _0x440ddf=this[_0x22aac9(0x27e)](_0x453717,_0x4160fa);console[_0x22aac9(0x22a)](_0x22aac9(0x221)),console[_0x22aac9(0x22a)](_0x22aac9(0x215),_0x440ddf[_0x22aac9(0x28b)]);const _0x45fbc4=this['signRSA'](_0x244666);console['log']('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x22aac9(0x22a)]('📝\x20Signature\x20length:',_0x45fbc4[_0x22aac9(0x28b)]);const _0x5d950d={'merchant_point_id':this[_0x22aac9(0x1e9)],'method':'charge','info':_0x3d1668,'key':_0x440ddf,'sign':_0x45fbc4,'lang':'en'};console[_0x22aac9(0x22a)](_0x22aac9(0x238)),console['log'](_0x22aac9(0x2b6)),console[_0x22aac9(0x22a)](_0x22aac9(0x1ef),this['merchantPointId']),console[_0x22aac9(0x22a)](_0x22aac9(0x2c9)),console['log'](_0x22aac9(0x1eb),_0x3d1668[_0x22aac9(0x28b)]),console[_0x22aac9(0x22a)]('\x20\x20\x20-\x20key\x20length:',_0x440ddf['length']),console[_0x22aac9(0x22a)](_0x22aac9(0x1dc),_0x45fbc4[_0x22aac9(0x28b)]),console[_0x22aac9(0x22a)](_0x22aac9(0x234)),loggerService_1[_0x22aac9(0x1e8)]['logWhiteDomainRequest'](_0x22aac9(0x2c3),_0x22aac9(0x206),_0x22aac9(0x24a),{'merchant_point_id':this[_0x22aac9(0x1e9)],'method':_0x22aac9(0x210),'lang':'en'});const _0x1b8dea=Date[_0x22aac9(0x2b7)](),_0x506a6e=await fetch(this[_0x22aac9(0x1f6)],{'method':_0x22aac9(0x24a),'headers':{'Content-Type':_0x22aac9(0x24b),'Accept':_0x22aac9(0x24b),'User-Agent':_0x22aac9(0x276)},'body':JSON[_0x22aac9(0x26a)](_0x5d950d)}),_0x370953=Date['now']()-_0x1b8dea;console[_0x22aac9(0x22a)](_0x22aac9(0x233)),console[_0x22aac9(0x22a)]('Status:',_0x506a6e['status']),console['log'](_0x22aac9(0x211),_0x370953+'ms');if(!_0x506a6e['ok']){const _0x17edac=await _0x506a6e[_0x22aac9(0x288)]();console[_0x22aac9(0x228)]('HTTP\x20Status:',_0x506a6e['status']),console[_0x22aac9(0x228)](_0x22aac9(0x27a),_0x17edac),loggerService_1[_0x22aac9(0x1e8)]['logWhiteDomainResponse'](_0x22aac9(0x2c3),_0x22aac9(0x1ff),_0x506a6e[_0x22aac9(0x2bd)],_0x17edac,_0x370953),loggerService_1[_0x22aac9(0x1e8)][_0x22aac9(0x28d)](_0x22aac9(0x2c3),_0x22aac9(0x206),_0x22aac9(0x25c)+_0x506a6e['status']+':\x20'+_0x17edac);throw new Error(_0x22aac9(0x2bb)+_0x506a6e[_0x22aac9(0x2bd)]+_0x22aac9(0x22d)+_0x17edac);}const _0xa3b53c=await _0x506a6e[_0x22aac9(0x253)]();loggerService_1[_0x22aac9(0x1e8)][_0x22aac9(0x1ee)](_0x22aac9(0x2c3),'/charge_raw',_0x506a6e[_0x22aac9(0x2bd)],_0xa3b53c,_0x370953),console[_0x22aac9(0x22a)](_0x22aac9(0x1ea));let _0x3f241e=_0xa3b53c;if(_0xa3b53c[_0x22aac9(0x1e6)]&&_0xa3b53c['key']&&_0xa3b53c[_0x22aac9(0x299)]){console[_0x22aac9(0x22a)](_0x22aac9(0x1e3));try{const _0x4e9fb3=await this[_0x22aac9(0x220)](_0xa3b53c['info'],_0xa3b53c[_0x22aac9(0x2b3)]);_0x3f241e=JSON[_0x22aac9(0x277)](_0x4e9fb3),console[_0x22aac9(0x22a)](_0x22aac9(0x2b2)),loggerService_1[_0x22aac9(0x1e8)][_0x22aac9(0x1ee)]('mastercard',_0x22aac9(0x235),_0x506a6e[_0x22aac9(0x2bd)],_0x3f241e,_0x370953),console[_0x22aac9(0x22a)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x10646b){console[_0x22aac9(0x228)]('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x10646b),loggerService_1['loggerService'][_0x22aac9(0x28d)](_0x22aac9(0x2c3),_0x22aac9(0x26d),_0x22aac9(0x1fe)+_0x10646b),_0x3f241e=_0xa3b53c;}}else loggerService_1[_0x22aac9(0x1e8)][_0x22aac9(0x1ee)]('mastercard',_0x22aac9(0x235),_0x506a6e['status'],_0x3f241e,_0x370953),console[_0x22aac9(0x22a)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x22aac9(0x22a)](_0x22aac9(0x29d),_0x3f241e[_0x22aac9(0x2bd)]),console['log']('Final:',_0x3f241e[_0x22aac9(0x2b9)]),console[_0x22aac9(0x22a)](_0x22aac9(0x27f),_0x3f241e['payment_id']),console[_0x22aac9(0x22a)](_0x22aac9(0x1fb),_0x3f241e[_0x22aac9(0x216)]||_0x22aac9(0x298));if(_0x3f241e[_0x22aac9(0x2bd)]===0x64&&_0x3f241e[_0x22aac9(0x2b9)]===0x1)return console[_0x22aac9(0x22a)](_0x22aac9(0x260)),{'gateway_payment_id':_0x3f241e[_0x22aac9(0x2ae)]?.[_0x22aac9(0x26b)](),'payment_url':_0x4b696c,'requires_3ds':![],'status':_0x22aac9(0x25f),'final':!![]};if(_0x3f241e[_0x22aac9(0x216)])return console[_0x22aac9(0x22a)](_0x22aac9(0x208)),this[_0x22aac9(0x269)](_0x5f3fed,_0x197603,_0x3f241e[_0x22aac9(0x2ae)]?.['toString']()||_0x197603),{'gateway_payment_id':_0x3f241e[_0x22aac9(0x2ae)]?.['toString'](),'payment_url':_0x3f241e[_0x22aac9(0x216)],'requires_3ds':!![],'threeds_url':_0x3f241e[_0x22aac9(0x216)],'status':'PENDING','final':![]};let _0x337584=_0x3f241e['desc']||_0x3f241e[_0x22aac9(0x1f1)]||'Unknown\x20error',_0x17b57b=_0x3f241e[_0x22aac9(0x2bd)],_0x46b7c0=_0x3f241e[_0x22aac9(0x2b9)];return console[_0x22aac9(0x22a)](_0x22aac9(0x262)+_0x17b57b+_0x22aac9(0x22e)+_0x46b7c0+',\x20Desc:\x20'+_0x337584),{'gateway_payment_id':_0x3f241e[_0x22aac9(0x2ae)]?.['toString'](),'payment_url':_0x4b696c,'requires_3ds':![],'status':_0x22aac9(0x239),'final':!![]};}catch(_0x5c97b8){console[_0x22aac9(0x228)](_0x22aac9(0x1f4)),console[_0x22aac9(0x228)](_0x22aac9(0x250),_0x5c97b8),loggerService_1[_0x22aac9(0x1e8)][_0x22aac9(0x28d)]('mastercard',_0x22aac9(0x206),_0x5c97b8);throw new Error('Failed\x20to\x20process\x20MasterCard\x20payment:\x20'+(_0x5c97b8 instanceof Error?_0x5c97b8['message']:_0x22aac9(0x2ca)));}}async[a42_0xfa2b0d(0x1e7)](_0x9d98a,_0xb50dc2){const _0xd8bff8=a42_0xfa2b0d;console[_0xd8bff8(0x22a)](_0xd8bff8(0x2a6)+_0x9d98a+'\x20('+_0xb50dc2+')');try{const _0x38fed2={'payment_id':_0x9d98a,'order_id':_0xb50dc2},_0x355db3=JSON[_0xd8bff8(0x26a)](_0x38fed2),{key:_0x10b74e,iv:_0x58f4d3}=this[_0xd8bff8(0x271)](),_0x1762fa=this[_0xd8bff8(0x273)](_0x355db3,_0x10b74e,_0x58f4d3),_0x16227f=this[_0xd8bff8(0x27e)](_0x10b74e,_0x58f4d3),_0x55f047=this[_0xd8bff8(0x256)](_0x355db3),_0x1d3fd7={'merchant_point_id':this[_0xd8bff8(0x1e9)],'method':_0xd8bff8(0x2bd),'info':_0x1762fa,'key':_0x16227f,'sign':_0x55f047,'lang':'en'};loggerService_1[_0xd8bff8(0x1e8)]['logWhiteDomainRequest'](_0xd8bff8(0x2c3),'/status',_0xd8bff8(0x24a),{'merchant_point_id':this['merchantPointId'],'method':_0xd8bff8(0x2bd),'lang':'en'});const _0x53b64e=Date[_0xd8bff8(0x2b7)](),_0x14212d=await fetch(this[_0xd8bff8(0x1f6)],{'method':_0xd8bff8(0x24a),'headers':{'Content-Type':'application/json','Accept':_0xd8bff8(0x24b),'User-Agent':_0xd8bff8(0x276)},'body':JSON[_0xd8bff8(0x26a)](_0x1d3fd7)}),_0x40d669=Date[_0xd8bff8(0x2b7)]()-_0x53b64e;if(!_0x14212d['ok']){const _0x2ae4d7=await _0x14212d[_0xd8bff8(0x288)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0xd8bff8(0x2c3),_0xd8bff8(0x231),_0x14212d['status'],_0x2ae4d7,_0x40d669);throw new Error(_0xd8bff8(0x2bb)+_0x14212d[_0xd8bff8(0x2bd)]);}const _0x57f7b9=await _0x14212d['json']();loggerService_1[_0xd8bff8(0x1e8)]['logWhiteDomainResponse'](_0xd8bff8(0x2c3),_0xd8bff8(0x231),_0x14212d[_0xd8bff8(0x2bd)],_0x57f7b9,_0x40d669);let _0x4b1445=_0x57f7b9;if(_0x57f7b9[_0xd8bff8(0x1e6)]&&_0x57f7b9[_0xd8bff8(0x2b3)]&&_0x57f7b9[_0xd8bff8(0x299)]){console[_0xd8bff8(0x22a)](_0xd8bff8(0x1fc));try{const _0x2ffff3=this[_0xd8bff8(0x2a4)](_0x57f7b9[_0xd8bff8(0x1e6)],_0x57f7b9['key']);_0x4b1445=JSON[_0xd8bff8(0x277)](_0x2ffff3),console[_0xd8bff8(0x22a)](_0xd8bff8(0x225)),loggerService_1['loggerService'][_0xd8bff8(0x1ee)](_0xd8bff8(0x2c3),_0xd8bff8(0x254),_0x14212d[_0xd8bff8(0x2bd)],_0x4b1445,_0x40d669),console['log'](_0xd8bff8(0x1d7));}catch(_0x4a7329){console[_0xd8bff8(0x228)]('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x4a7329),loggerService_1['loggerService'][_0xd8bff8(0x28d)](_0xd8bff8(0x2c3),_0xd8bff8(0x200),_0xd8bff8(0x2c7)+_0x4a7329),_0x4b1445=_0x57f7b9;}}else loggerService_1[_0xd8bff8(0x1e8)][_0xd8bff8(0x1ee)]('mastercard',_0xd8bff8(0x254),_0x14212d[_0xd8bff8(0x2bd)],_0x4b1445,_0x40d669),console[_0xd8bff8(0x22a)](_0xd8bff8(0x21b));console[_0xd8bff8(0x22a)](_0xd8bff8(0x20a),{'status':_0x4b1445['status'],'final':_0x4b1445[_0xd8bff8(0x2b9)],'payment_id':_0x4b1445[_0xd8bff8(0x2ae)],'desc':_0x4b1445[_0xd8bff8(0x261)]});let _0x5b3e6a=_0xd8bff8(0x2a7);if(_0x4b1445[_0xd8bff8(0x2bd)]===0x1&&_0x4b1445[_0xd8bff8(0x2b9)]===0x1)_0x5b3e6a='PAID';else _0x4b1445[_0xd8bff8(0x2bd)]===0x0&&_0x4b1445[_0xd8bff8(0x2b9)]===0x0?_0x5b3e6a=_0xd8bff8(0x2a7):_0x5b3e6a=_0xd8bff8(0x239);return{'status':_0x5b3e6a,'final':_0x4b1445['final']===0x1,'amount':_0x4b1445['amount'],'currency':_0x4b1445['currency'],'date_success':_0x4b1445[_0xd8bff8(0x279)],'description':_0x4b1445[_0xd8bff8(0x261)]};}catch(_0x32811b){console[_0xd8bff8(0x228)]('MasterCard\x20status\x20check\x20error:',_0x32811b),loggerService_1[_0xd8bff8(0x1e8)][_0xd8bff8(0x28d)]('mastercard',_0xd8bff8(0x21a),_0x32811b);throw new Error(_0xd8bff8(0x272)+(_0x32811b instanceof Error?_0x32811b['message']:'Unknown\x20error'));}}['scheduleStatusChecks'](_0x524910,_0x1f8534,_0x58010b){const _0x335fa8=a42_0xfa2b0d;console['log']('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0x524910+'\x20('+_0x58010b+')'),this[_0x335fa8(0x26f)](_0x524910);const _0x56e35f=[],_0x94061c=0x5*0x3c*0x3e8,_0x4f23fd=0x2*0x3c*0x3c*0x3e8,_0x594383=Math[_0x335fa8(0x24e)](_0x4f23fd/_0x94061c);console['log']('⏰\x20Will\x20check\x20status\x20'+_0x594383+_0x335fa8(0x2b0));for(let _0x26d313=0x1;_0x26d313<=_0x594383;_0x26d313++){const _0x38849e=setTimeout(async()=>{const _0x5069a1=_0x335fa8;console['log'](_0x5069a1(0x213)+_0x26d313+'/'+_0x594383+_0x5069a1(0x226)+_0x524910);try{const _0x239eca=await this[_0x5069a1(0x1e7)](_0x58010b,_0x1f8534);console['log']('📊\x20Status\x20check\x20#'+_0x26d313+'\x20result:',_0x239eca),_0x239eca[_0x5069a1(0x2b9)]&&(console[_0x5069a1(0x22a)]('✅\x20Payment\x20'+_0x524910+_0x5069a1(0x24d)+_0x239eca['status']+_0x5069a1(0x22f)),this[_0x5069a1(0x26f)](_0x524910),await this['updatePaymentStatus'](_0x524910,_0x239eca[_0x5069a1(0x2bd)],_0x239eca));}catch(_0x36b531){console[_0x5069a1(0x228)](_0x5069a1(0x2c0)+_0x26d313+_0x5069a1(0x224)+_0x524910+':',_0x36b531);}},_0x26d313*_0x94061c);_0x56e35f[_0x335fa8(0x227)](_0x38849e);}this[_0x335fa8(0x263)][_0x335fa8(0x1ec)](_0x524910,_0x56e35f),console['log']('✅\x20Scheduled\x20'+_0x594383+_0x335fa8(0x232)+_0x524910);}['clearStatusTimers'](_0xbbdb02){const _0x277fa2=a42_0xfa2b0d,_0x1206d9=this['statusCheckTimers'][_0x277fa2(0x230)](_0xbbdb02);_0x1206d9&&(console['log'](_0x277fa2(0x27d)+_0x1206d9[_0x277fa2(0x28b)]+_0x277fa2(0x29e)+_0xbbdb02),_0x1206d9[_0x277fa2(0x229)]((_0x3818e8,_0x3ab776)=>{clearTimeout(_0x3818e8);}),this[_0x277fa2(0x263)][_0x277fa2(0x1f7)](_0xbbdb02));}async[a42_0xfa2b0d(0x207)](_0x2b7294,_0x520f0c,_0x265e48){const _0x29735c=a42_0xfa2b0d;try{const _0x1f7edd=(await Promise['resolve']()[_0x29735c(0x244)](()=>__importStar(require(_0x29735c(0x22b)))))[_0x29735c(0x2ad)],_0x1242a7={'status':_0x520f0c[_0x29735c(0x2ba)](),'updatedAt':new Date(),'statusChangedBy':_0x29735c(0x243),'statusChangedAt':new Date()};_0x520f0c===_0x29735c(0x25f)&&(_0x1242a7[_0x29735c(0x2a1)]=new Date()),_0x265e48[_0x29735c(0x251)]&&(_0x1242a7[_0x29735c(0x246)]=_0x29735c(0x249)+_0x265e48['description']),await _0x1f7edd['payment']['update']({'where':{'id':_0x2b7294},'data':_0x1242a7}),console[_0x29735c(0x22a)](_0x29735c(0x1e1)+_0x2b7294+_0x29735c(0x20c)+_0x520f0c),await this[_0x29735c(0x25a)](_0x2b7294,_0x520f0c);}catch(_0x10d653){console['error'](_0x29735c(0x23f)+_0x2b7294+':',_0x10d653);}}async[a42_0xfa2b0d(0x25a)](_0xa49396,_0x52e1ab){const _0x18bcd9=a42_0xfa2b0d;try{const _0x284739=(await Promise[_0x18bcd9(0x23d)]()[_0x18bcd9(0x244)](()=>__importStar(require('../../config/database'))))['default'],{telegramBotService:_0x52ab0e}=await Promise[_0x18bcd9(0x23d)]()[_0x18bcd9(0x244)](()=>__importStar(require(_0x18bcd9(0x2c8)))),_0x106515=await _0x284739[_0x18bcd9(0x222)][_0x18bcd9(0x280)]({'where':{'id':_0xa49396},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x106515)return;const _0x3e41cd={'PAID':_0x18bcd9(0x245),'FAILED':_0x18bcd9(0x28c)},_0x2aa19d=_0x3e41cd[_0x52e1ab];_0x2aa19d&&await _0x52ab0e[_0x18bcd9(0x294)](_0x106515[_0x18bcd9(0x24f)],_0x106515,_0x2aa19d),await this[_0x18bcd9(0x1fd)](_0x106515,_0x52e1ab);}catch(_0x1c7fc1){console[_0x18bcd9(0x228)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x1c7fc1);}}async['sendShopWebhook'](_0x4172d8,_0x390633){const _0x298f39=a42_0xfa2b0d,_0x161e69=Date['now']();try{const _0x25cd2c=_0x4172d8[_0x298f39(0x257)],_0x2500f9=_0x25cd2c[_0x298f39(0x278)];if(!_0x2500f9?.[_0x298f39(0x1f3)]){console[_0x298f39(0x22a)](_0x298f39(0x1e0)+_0x25cd2c['id']);return;}const _0xabdc1=_0x390633===_0x298f39(0x25f)?_0x298f39(0x264):_0x298f39(0x23c);let _0x37cb94=[];if(_0x2500f9[_0x298f39(0x1da)])try{_0x37cb94=Array['isArray'](_0x2500f9[_0x298f39(0x1da)])?_0x2500f9['webhookEvents']:JSON[_0x298f39(0x277)](_0x2500f9[_0x298f39(0x1da)]);}catch(_0x5f4c44){console[_0x298f39(0x228)](_0x298f39(0x202),_0x5f4c44),_0x37cb94=[];}if(!_0x37cb94[_0x298f39(0x25d)](_0xabdc1)){console[_0x298f39(0x22a)]('Webhook\x20event\x20'+_0xabdc1+_0x298f39(0x21d)+_0x25cd2c['id']);return;}const _0x477f0a={'event':_0xabdc1,'payment':{'id':_0x4172d8['id'],'order_id':_0x4172d8[_0x298f39(0x20e)],'gateway_order_id':_0x4172d8[_0x298f39(0x1f2)],'gateway':_0x298f39(0x237),'amount':_0x4172d8['amount'],'currency':_0x4172d8[_0x298f39(0x289)],'status':_0x390633[_0x298f39(0x2c6)](),'customer_email':_0x4172d8[_0x298f39(0x29b)],'customer_name':_0x4172d8['customerName'],'created_at':_0x4172d8[_0x298f39(0x2a8)],'updated_at':new Date()}},_0x37b22b=await fetch(_0x2500f9['webhookUrl'],{'method':_0x298f39(0x24a),'headers':{'Content-Type':'application/json','User-Agent':_0x298f39(0x270)},'body':JSON[_0x298f39(0x26a)](_0x477f0a)}),_0x4b0342=Date[_0x298f39(0x2b7)]()-_0x161e69;loggerService_1['loggerService']['logShopWebhookSent'](_0x4172d8[_0x298f39(0x24f)],_0x2500f9[_0x298f39(0x1f3)],_0xabdc1,_0x37b22b[_0x298f39(0x2bd)],_0x4b0342,_0x477f0a),console[_0x298f39(0x22a)](_0x298f39(0x293)+_0x2500f9[_0x298f39(0x1f3)]+_0x298f39(0x286)+_0x37b22b[_0x298f39(0x2bd)]+'\x20('+_0x4b0342+_0x298f39(0x219));}catch(_0x5a45a7){console[_0x298f39(0x228)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x5a45a7),loggerService_1[_0x298f39(0x1e8)][_0x298f39(0x26e)](_0x4172d8[_0x298f39(0x24f)],_0x4172d8[_0x298f39(0x257)]?.[_0x298f39(0x278)]?.[_0x298f39(0x1f3)]||'unknown',_0x298f39(0x2b1),_0x5a45a7,{});}}[a42_0xfa2b0d(0x214)](_0x267f6a){const _0x2bd04f=a42_0xfa2b0d,_0x1fdf26=_0x267f6a['replace'](/[\s-]/g,'');if(_0x1fdf26[_0x2bd04f(0x28b)]<0x4)return _0x2bd04f(0x2bf);return _0x2bd04f(0x212)+_0x1fdf26[_0x2bd04f(0x1d8)](-0x4);}async[a42_0xfa2b0d(0x297)](_0x451533){const _0x44fc3f=a42_0xfa2b0d;console[_0x44fc3f(0x22a)](_0x44fc3f(0x295),_0x451533);let _0x20ca95=_0x44fc3f(0x2a7);if(_0x451533[_0x44fc3f(0x2bd)]===0x1&&_0x451533[_0x44fc3f(0x2b9)]===0x1)_0x20ca95=_0x44fc3f(0x25f);else _0x451533[_0x44fc3f(0x2bd)]===0x0&&_0x451533[_0x44fc3f(0x2b9)]===0x0?_0x20ca95=_0x44fc3f(0x2a7):_0x20ca95=_0x44fc3f(0x239);return{'paymentId':_0x451533[_0x44fc3f(0x2ac)]||'','status':_0x20ca95,'amount':_0x451533['amount'],'currency':_0x451533[_0x44fc3f(0x289)]};}[a42_0xfa2b0d(0x20d)](){const _0x323f31=a42_0xfa2b0d;console[_0x323f31(0x22a)]('🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...');const _0x1bf0b4=this[_0x323f31(0x263)]['size'];for(const [_0x14cc71]of this['statusCheckTimers']){this[_0x323f31(0x26f)](_0x14cc71);}console[_0x323f31(0x22a)](_0x323f31(0x2a5)+_0x1bf0b4+'\x20MasterCard\x20status\x20check\x20timers');}}function a42_0x4413(_0x4c404f,_0x1a8c07){const _0x37f6b9=a42_0x37f6();return a42_0x4413=function(_0x441336,_0x336f90){_0x441336=_0x441336-0x1d7;let _0xa8279=_0x37f6b9[_0x441336];return _0xa8279;},a42_0x4413(_0x4c404f,_0x1a8c07);}exports[a42_0xfa2b0d(0x1d9)]=MasterCardService;