'use strict';const a42_0x50765a=a42_0x546c;(function(_0x2e01a2,_0x29626e){const _0x547904=a42_0x546c,_0x5d48e5=_0x2e01a2();while(!![]){try{const _0x3a805e=-parseInt(_0x547904(0x11f))/0x1*(-parseInt(_0x547904(0x10e))/0x2)+parseInt(_0x547904(0x138))/0x3*(-parseInt(_0x547904(0x15a))/0x4)+parseInt(_0x547904(0x168))/0x5+-parseInt(_0x547904(0x15c))/0x6+parseInt(_0x547904(0x136))/0x7*(-parseInt(_0x547904(0x19d))/0x8)+-parseInt(_0x547904(0x14a))/0x9+parseInt(_0x547904(0x1ac))/0xa*(parseInt(_0x547904(0x17f))/0xb);if(_0x3a805e===_0x29626e)break;else _0x5d48e5['push'](_0x5d48e5['shift']());}catch(_0x51c94e){_0x5d48e5['push'](_0x5d48e5['shift']());}}}(a42_0x5f4d,0x8d54d));function a42_0x5f4d(){const _0x59fe86=['🔐\x20AES\x20key\x20length:','replace','webhook_send','Result\x20URL:','signRSA','__importDefault','from','🔍\x20MasterCard\x20status\x20check\x20#','Payment\x20ID:','Error\x20details:','TesSoft\x20Payment\x20System/1.0','/charge_decrypt','updatePaymentStatus','maskCardNumber','aes-256-ctr','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','MasterCard\x20status\x20check\x20error:','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','📝\x20Signature\x20length:','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','processWebhook','🔐\x20Data\x20signed\x20with\x20RSA','getOwnPropertyNames','❌\x20RSA\x20encryption\x20failed:','resolve','includes','defineProperty','❌\x20Status\x20check\x20#','\x20not\x20enabled\x20for\x20shop\x20','orderId','randomBytes','Response\x20Time:','__importStar','gatewayOrderId','forEach','cwd','final','SHA256','60934tDuOpN','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','HTTP\x20','sign','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','error','Card\x20Number:','\x20\x20\x20-\x20sign\x20length:','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','💳\x20MasterCard\x20service\x20initialized','default','customerName','amount','status','message','createCipheriv','size','10IdtzLg','call','/status_decrypt','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format',',\x20body:\x20','logWhiteDomainError','✅\x20Payment\x20successful','__setModuleDefault','createDecipheriv','desc','../loggerService','stringify','apiUrl','privateKeyPath','application/json','ms)','prototype','\x20for\x20payment\x20','1111','hasOwnProperty','HTTP\x20Status:','...','🔐\x20Private\x20key\x20path:','7TzTrZU','Processing\x20MasterCard\x20webhook:','3DnYlDG','expire_year','adminNotes','📊\x20Status\x20check\x20#','length','stopAllStatusChecks','Unknown\x20error','system','toUpperCase','Final:','statusCheckTimers','toString','__esModule','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','-----END','\x20\x20\x20-\x20merchant_point_id:','createSign','parse','4089096tFfbgi','failed','🔐\x20RSA\x20signing\x20successful','mastercard','Failed\x20to\x20send\x20payment\x20notifications:','\x20with\x20status\x20','/charge','update','__createBinding','unknown','📝\x20Encrypted\x20key\x20length:','/status_raw','payment.success','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','🔐\x20Data\x20encrypted\x20with\x20AES','generateAESKey','2709640NLaTOC','loggerService','3420276zTNDrn','✅\x20Status\x20response\x20decrypted\x20successfully','delete','/charge_raw','createdAt','📝\x20Encrypted\x20data\x20length:','POST','📝\x20Data\x20length:','log','substring','expire_month','paidAt','4245380mlguem','join','\x20\x20\x20-\x20info\x20length:','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','\x20\x20\x20-\x20method:\x20charge','scheduleStatusChecks','Amount:','decryptAES','key','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','https://api2.trapay.uk/decrypt.php','crypto','text','🛑\x20Stopped\x20','info','findUnique','⏰\x20Will\x20check\x20status\x20','\x20status\x20timers\x20for\x20payment\x20','-----BEGIN','psp_public.pem','merchantPointId','existsSync','sendPaymentNotification','21941689WhchrK','❌\x20RSA\x20signing\x20failed:','🔐\x20Public\x20key\x20length:\x20','get','privateDecrypt','Decryption\x20failed:\x20','\x20is\x20final\x20(',',\x20Final:\x20','payment','📝\x20Final\x20request\x20structure:','Webhook\x20event\x20','checkPaymentStatus','****\x20****\x20****\x20','configurable','decryptResponsePhp','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','webhookEvents','Response\x20Body:','writable','Public\x20key\x20file\x20not\x20found:\x20','paid','shop','PAID','encryptRSA','❌\x20Data\x20being\x20signed:','then','../../config/database','order_id','3ds_url','shopId','6942016bYndaT','📝\x20Data\x20to\x20sign\x20length:','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','logWhiteDomainResponse','PHP\x20decryptor\x20error','FAILED','/status','PENDING','publicKeyPath','date_success','HTTP\x20error!\x20status:\x20','🔐\x20Private\x20key\x20length:\x20','webhookUrl','\x20status\x20updated\x20to\x20','✅\x20Payment\x20','10OZSWva','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','base64','description','create','payment_id','encryptAES','number','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','/status_decrypted','Return\x20URL:','Status:','RSA_PKCS1_PADDING','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','\x20\x20\x20-\x20key\x20length:','charge','logShopWebhookSent','🔐\x20AES\x20key\x20and\x20IV\x20generated','🧹\x20Clearing\x20','logWhiteDomainRequest','currency','\x20failed\x20for\x20payment\x20','validateKeyFiles','trim','keys','/charge_decrypted','📊\x20Status\x20check\x20result:','first_name','decryptResponse','json','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','Card\x20Holder:','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','clearStatusTimers','readFileSync','last_name','../telegramBotService','utf8','logShopWebhookError','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','settings','constants','\x20result:','processCardPayment','\x20characters','Order\x20ID:','sendPaymentNotifications','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','),\x20stopping\x20status\x20checks','now'];a42_0x5f4d=function(){return _0x59fe86;};return a42_0x5f4d();}function a42_0x546c(_0x407512,_0x23a6c1){const _0x5f4d65=a42_0x5f4d();return a42_0x546c=function(_0x546c1c,_0x209a1c){_0x546c1c=_0x546c1c-0xf4;let _0x373cd4=_0x5f4d65[_0x546c1c];return _0x373cd4;},a42_0x546c(_0x407512,_0x23a6c1);}var __createBinding=this&&this[a42_0x50765a(0x152)]||(Object[a42_0x50765a(0x1b1)]?function(_0x4d7cfa,_0x33d988,_0x19a15d,_0x1d566c){const _0x158d12=a42_0x50765a;if(_0x1d566c===undefined)_0x1d566c=_0x19a15d;var _0x479544=Object['getOwnPropertyDescriptor'](_0x33d988,_0x19a15d);(!_0x479544||(_0x158d12(0x182)in _0x479544?!_0x33d988[_0x158d12(0x144)]:_0x479544[_0x158d12(0x191)]||_0x479544[_0x158d12(0x18c)]))&&(_0x479544={'enumerable':!![],'get':function(){return _0x33d988[_0x19a15d];}}),Object['defineProperty'](_0x4d7cfa,_0x1d566c,_0x479544);}:function(_0x56d351,_0x469786,_0x2ac16b,_0x11236b){if(_0x11236b===undefined)_0x11236b=_0x2ac16b;_0x56d351[_0x11236b]=_0x469786[_0x2ac16b];}),__setModuleDefault=this&&this[a42_0x50765a(0x126)]||(Object[a42_0x50765a(0x1b1)]?function(_0x4f56a4,_0x33ed22){const _0x5a35f0=a42_0x50765a;Object[_0x5a35f0(0x102)](_0x4f56a4,_0x5a35f0(0x118),{'enumerable':!![],'value':_0x33ed22});}:function(_0x4fa9a3,_0x5e7e39){const _0x42f1f0=a42_0x50765a;_0x4fa9a3[_0x42f1f0(0x118)]=_0x5e7e39;}),__importStar=this&&this[a42_0x50765a(0x108)]||(function(){var _0x374812=function(_0x226d74){const _0x1138f1=a42_0x546c;return _0x374812=Object[_0x1138f1(0xfe)]||function(_0x39268b){const _0xbc5fb4=_0x1138f1;var _0x4c86c7=[];for(var _0x33bd2b in _0x39268b)if(Object[_0xbc5fb4(0x12f)][_0xbc5fb4(0x132)][_0xbc5fb4(0x120)](_0x39268b,_0x33bd2b))_0x4c86c7[_0x4c86c7[_0xbc5fb4(0x13c)]]=_0x33bd2b;return _0x4c86c7;},_0x374812(_0x226d74);};return function(_0x26e0d3){const _0x255e99=a42_0x546c;if(_0x26e0d3&&_0x26e0d3[_0x255e99(0x144)])return _0x26e0d3;var _0x5aa98d={};if(_0x26e0d3!=null){for(var _0x4e30c5=_0x374812(_0x26e0d3),_0x186fa5=0x0;_0x186fa5<_0x4e30c5[_0x255e99(0x13c)];_0x186fa5++)if(_0x4e30c5[_0x186fa5]!==_0x255e99(0x118))__createBinding(_0x5aa98d,_0x26e0d3,_0x4e30c5[_0x186fa5]);}return __setModuleDefault(_0x5aa98d,_0x26e0d3),_0x5aa98d;};}()),__importDefault=this&&this[a42_0x50765a(0x1e5)]||function(_0x32d8cb){const _0x21f3be=a42_0x50765a;return _0x32d8cb&&_0x32d8cb[_0x21f3be(0x144)]?_0x32d8cb:{'default':_0x32d8cb};};Object[a42_0x50765a(0x102)](exports,a42_0x50765a(0x144),{'value':!![]}),exports['MasterCardService']=void 0x0;const crypto_1=__importDefault(require(a42_0x50765a(0x173))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a42_0x50765a(0x129));class MasterCardService{constructor(){const _0x37b68b=a42_0x50765a;this[_0x37b68b(0x142)]=new Map(),this[_0x37b68b(0x12b)]='https://api.paydmeth.com/api',this[_0x37b68b(0x17c)]=0x67c,this['privateKeyPath']=path_1[_0x37b68b(0x118)][_0x37b68b(0x169)](process[_0x37b68b(0x10b)](),_0x37b68b(0x1c5),'private.pem'),this[_0x37b68b(0x1a5)]=path_1[_0x37b68b(0x118)][_0x37b68b(0x169)](process[_0x37b68b(0x10b)](),_0x37b68b(0x1c5),_0x37b68b(0x17b)),console[_0x37b68b(0x164)](_0x37b68b(0x117)),console[_0x37b68b(0x164)](_0x37b68b(0x135),this[_0x37b68b(0x12c)]),console['log']('🔐\x20Public\x20key\x20path:',this[_0x37b68b(0x1a5)]),this[_0x37b68b(0x1c3)]();}[a42_0x50765a(0x1c3)](){const _0x2ce079=a42_0x50765a;try{if(!fs_1[_0x2ce079(0x118)][_0x2ce079(0x17d)](this[_0x2ce079(0x12c)]))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this[_0x2ce079(0x12c)]);if(!fs_1[_0x2ce079(0x118)][_0x2ce079(0x17d)](this[_0x2ce079(0x1a5)]))throw new Error(_0x2ce079(0x192)+this[_0x2ce079(0x1a5)]);const _0x3cdb2f=fs_1[_0x2ce079(0x118)]['readFileSync'](this['privateKeyPath'],_0x2ce079(0x1d3))['trim'](),_0x551a1=fs_1[_0x2ce079(0x118)]['readFileSync'](this[_0x2ce079(0x1a5)],'utf8')[_0x2ce079(0x1c4)]();if(!_0x3cdb2f[_0x2ce079(0x101)](_0x2ce079(0x17a))||!_0x3cdb2f[_0x2ce079(0x101)](_0x2ce079(0x146)))throw new Error(_0x2ce079(0x171));if(!_0x551a1[_0x2ce079(0x101)](_0x2ce079(0x17a))||!_0x551a1['includes']('-----END'))throw new Error(_0x2ce079(0x122));console['log'](_0x2ce079(0x1cd)),console[_0x2ce079(0x164)](_0x2ce079(0x1a8)+_0x3cdb2f['length']+_0x2ce079(0x1da)),console['log'](_0x2ce079(0x181)+_0x551a1[_0x2ce079(0x13c)]+_0x2ce079(0x1da));}catch(_0x15a40a){console[_0x2ce079(0x113)]('❌\x20MasterCard\x20key\x20validation\x20failed:',_0x15a40a);throw _0x15a40a;}}[a42_0x50765a(0x159)](){const _0x478a4c=a42_0x50765a,_0x33620c=crypto_1[_0x478a4c(0x118)][_0x478a4c(0x106)](0x20),_0x3bcb99=crypto_1[_0x478a4c(0x118)][_0x478a4c(0x106)](0x10);return{'key':_0x33620c,'iv':_0x3bcb99};}[a42_0x50765a(0x1b3)](_0x2c7c7a,_0x1c6da5,_0xae2220){const _0x39503e=a42_0x50765a,_0x8c1712=crypto_1[_0x39503e(0x118)][_0x39503e(0x11d)](_0x39503e(0xf5),_0x1c6da5,_0xae2220);let _0x538344=_0x8c1712[_0x39503e(0x151)](_0x2c7c7a,_0x39503e(0x1d3),_0x39503e(0x1af));return _0x538344+=_0x8c1712[_0x39503e(0x10c)](_0x39503e(0x1af)),_0x538344;}[a42_0x50765a(0x196)](_0x26fe6d,_0x58ccf8){const _0x1eda8c=a42_0x50765a;try{const _0x31437b=fs_1[_0x1eda8c(0x118)][_0x1eda8c(0x1d0)](this[_0x1eda8c(0x1a5)],'utf8')[_0x1eda8c(0x1c4)](),_0x20e06a={'iv':_0x58ccf8[_0x1eda8c(0x143)](_0x1eda8c(0x1af)),'key':_0x26fe6d[_0x1eda8c(0x143)](_0x1eda8c(0x1af))},_0x4b20a1=JSON[_0x1eda8c(0x12a)](_0x20e06a);console[_0x1eda8c(0x164)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x4b20a1[_0x1eda8c(0x13c)]);const _0x66ff4a=crypto_1['default']['publicEncrypt']({'key':_0x31437b,'padding':crypto_1[_0x1eda8c(0x118)][_0x1eda8c(0x1d7)][_0x1eda8c(0x1b9)]},Buffer[_0x1eda8c(0x1e6)](_0x4b20a1));return console['log'](_0x1eda8c(0x1d5),_0x66ff4a['length']),_0x66ff4a['toString'](_0x1eda8c(0x1af));}catch(_0x1de90b){console[_0x1eda8c(0x113)](_0x1eda8c(0xff),_0x1de90b);throw new Error(_0x1eda8c(0xf6));}}[a42_0x50765a(0x1e4)](_0x13226c){const _0x7f0a5a=a42_0x50765a;try{const _0x5eb398=fs_1[_0x7f0a5a(0x118)]['readFileSync'](this[_0x7f0a5a(0x12c)],_0x7f0a5a(0x1d3))[_0x7f0a5a(0x1c4)](),_0x556b2e=crypto_1[_0x7f0a5a(0x118)][_0x7f0a5a(0x148)](_0x7f0a5a(0x10d));_0x556b2e['update'](_0x13226c),_0x556b2e['end']();const _0x337c59=_0x556b2e[_0x7f0a5a(0x111)](_0x5eb398,_0x7f0a5a(0x1af));return console[_0x7f0a5a(0x164)](_0x7f0a5a(0x14c)),console['log'](_0x7f0a5a(0x19e),_0x13226c[_0x7f0a5a(0x13c)]),console[_0x7f0a5a(0x164)](_0x7f0a5a(0xfa),_0x337c59[_0x7f0a5a(0x13c)]),_0x337c59;}catch(_0x52b0b0){console[_0x7f0a5a(0x113)](_0x7f0a5a(0x180),_0x52b0b0),console[_0x7f0a5a(0x113)](_0x7f0a5a(0x197),_0x13226c[_0x7f0a5a(0x165)](0x0,0xc8)+_0x7f0a5a(0x134));throw new Error(_0x7f0a5a(0x10f));}}[a42_0x50765a(0x16f)](_0x3d9cb4,_0x295f7e,_0x2effd0){const _0x5af81a=a42_0x50765a,_0x21a9cc=crypto_1[_0x5af81a(0x118)][_0x5af81a(0x127)](_0x5af81a(0xf5),_0x295f7e,_0x2effd0);let _0xc722fc=_0x21a9cc[_0x5af81a(0x151)](_0x3d9cb4,_0x5af81a(0x1af),_0x5af81a(0x1d3));return _0xc722fc+=_0x21a9cc[_0x5af81a(0x10c)](_0x5af81a(0x1d3)),_0xc722fc;}async[a42_0x50765a(0x18d)](_0x1d95b7,_0x4e42ba){const _0x4dcff0=a42_0x50765a;try{const _0x13d2dc=await fetch(_0x4dcff0(0x172),{'method':_0x4dcff0(0x162),'headers':{'Content-Type':_0x4dcff0(0x12d)},'body':JSON['stringify']({'info':_0x1d95b7,'key':_0x4e42ba})});if(!_0x13d2dc['ok'])throw new Error(_0x4dcff0(0x1a1));return await _0x13d2dc[_0x4dcff0(0x174)]();}catch(_0x7b68a6){console[_0x4dcff0(0x113)]('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x7b68a6);throw new Error(_0x4dcff0(0x1ba));}}['decryptResponse'](_0x53163f,_0x8faafa){const _0x26f46c=a42_0x50765a;try{const _0x59231f=fs_1[_0x26f46c(0x118)][_0x26f46c(0x1d0)](this['privateKeyPath'],'utf8')[_0x26f46c(0x1c4)](),_0x119f70=crypto_1['default'][_0x26f46c(0x183)](_0x59231f,Buffer[_0x26f46c(0x1e6)](_0x8faafa,'base64')),_0x4ac44e=JSON[_0x26f46c(0x149)](_0x119f70[_0x26f46c(0x143)]()),_0x183dd1=Buffer[_0x26f46c(0x1e6)](_0x4ac44e[_0x26f46c(0x170)],_0x26f46c(0x1af)),_0x303ed3=Buffer[_0x26f46c(0x1e6)](_0x4ac44e['iv'],_0x26f46c(0x1af));return this[_0x26f46c(0x16f)](_0x53163f,_0x183dd1,_0x303ed3);}catch(_0x44a7c3){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a42_0x50765a(0x1d9)](_0x2c6c01){const _0x206c94=a42_0x50765a,{paymentId:_0x3299d5,orderId:_0x2f7ca2,amount:_0x243bbc,currency:_0x2bc5e4,cardData:_0x3f1c9c,resultUrl:_0x30eb25,returnUrl:_0x32b9e9,cardHolder:_0xcc55c,browser:_0x2f7b8c}=_0x2c6c01;console[_0x206c94(0x164)](_0x206c94(0x145)),console['log'](_0x206c94(0x1e8),_0x3299d5),console[_0x206c94(0x164)](_0x206c94(0x1db),_0x2f7ca2),console[_0x206c94(0x164)](_0x206c94(0x16e),_0x243bbc,_0x2bc5e4),console[_0x206c94(0x164)](_0x206c94(0x114),this[_0x206c94(0xf4)](_0x3f1c9c[_0x206c94(0x1b4)])),console['log'](_0x206c94(0x1cc),_0xcc55c[_0x206c94(0x1c8)]+'\x20'+_0xcc55c[_0x206c94(0x1d1)]),console[_0x206c94(0x164)](_0x206c94(0x1b7),_0x32b9e9),console['log'](_0x206c94(0x1e3),_0x30eb25);const _0x3572bc={'amount':_0x243bbc,'currency':_0x2bc5e4[_0x206c94(0x140)](),'order_id':_0x2f7ca2,'result_url':_0x30eb25,'return_url':_0x32b9e9,'card':{'number':_0x3f1c9c[_0x206c94(0x1b4)],'expire_month':_0x3f1c9c[_0x206c94(0x166)],'expire_year':_0x3f1c9c[_0x206c94(0x139)],'cvv':_0x3f1c9c['cvv']},'card_holder':_0xcc55c,'browser':_0x2f7b8c},_0x473df4=JSON[_0x206c94(0x12a)](_0x3572bc);console['log']('💾\x20Payment\x20data\x20prepared'),console[_0x206c94(0x164)]('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console[_0x206c94(0x164)](_0x473df4),console[_0x206c94(0x164)](_0x206c94(0x163),_0x473df4[_0x206c94(0x13c)]);try{const {key:_0xf478da,iv:_0x3d189a}=this[_0x206c94(0x159)]();console[_0x206c94(0x164)](_0x206c94(0x1be)),console[_0x206c94(0x164)](_0x206c94(0x1e0),_0xf478da['length']),console[_0x206c94(0x164)]('🔐\x20AES\x20IV\x20length:',_0x3d189a[_0x206c94(0x13c)]);const _0x5285ff=this[_0x206c94(0x1b3)](_0x473df4,_0xf478da,_0x3d189a);console['log'](_0x206c94(0x158)),console[_0x206c94(0x164)](_0x206c94(0x161),_0x5285ff['length']);const _0x456071=this['encryptRSA'](_0xf478da,_0x3d189a);console[_0x206c94(0x164)](_0x206c94(0x1cb)),console[_0x206c94(0x164)](_0x206c94(0x154),_0x456071['length']);const _0x3ddf11=this['signRSA'](_0x473df4);console[_0x206c94(0x164)](_0x206c94(0xfd)),console['log'](_0x206c94(0xfa),_0x3ddf11['length']);const _0x12d3ce={'merchant_point_id':this[_0x206c94(0x17c)],'method':'charge','info':_0x5285ff,'key':_0x456071,'sign':_0x3ddf11,'lang':'en'};console[_0x206c94(0x164)](_0x206c94(0x18e)),console[_0x206c94(0x164)](_0x206c94(0x188)),console['log'](_0x206c94(0x147),this['merchantPointId']),console[_0x206c94(0x164)](_0x206c94(0x16c)),console[_0x206c94(0x164)](_0x206c94(0x16a),_0x5285ff[_0x206c94(0x13c)]),console[_0x206c94(0x164)](_0x206c94(0x1bb),_0x456071['length']),console[_0x206c94(0x164)](_0x206c94(0x115),_0x3ddf11[_0x206c94(0x13c)]),console[_0x206c94(0x164)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x206c94(0x15b)][_0x206c94(0x1c0)](_0x206c94(0x14d),'/charge',_0x206c94(0x162),{'merchant_point_id':this[_0x206c94(0x17c)],'method':_0x206c94(0x1bc),'lang':'en'});const _0x3e6782=Date[_0x206c94(0x1df)](),_0x19caf5=await fetch(this[_0x206c94(0x12b)],{'method':_0x206c94(0x162),'headers':{'Content-Type':_0x206c94(0x12d),'Accept':_0x206c94(0x12d),'User-Agent':_0x206c94(0x1ea)},'body':JSON[_0x206c94(0x12a)](_0x12d3ce)}),_0x47773b=Date[_0x206c94(0x1df)]()-_0x3e6782;console[_0x206c94(0x164)](_0x206c94(0xfb)),console[_0x206c94(0x164)]('Status:',_0x19caf5[_0x206c94(0x11b)]),console[_0x206c94(0x164)](_0x206c94(0x107),_0x47773b+'ms');if(!_0x19caf5['ok']){const _0x27295e=await _0x19caf5[_0x206c94(0x174)]();console[_0x206c94(0x113)](_0x206c94(0x133),_0x19caf5[_0x206c94(0x11b)]),console[_0x206c94(0x113)](_0x206c94(0x190),_0x27295e),loggerService_1['loggerService'][_0x206c94(0x1a0)](_0x206c94(0x14d),_0x206c94(0x15f),_0x19caf5['status'],_0x27295e,_0x47773b),loggerService_1[_0x206c94(0x15b)][_0x206c94(0x124)](_0x206c94(0x14d),_0x206c94(0x150),_0x206c94(0x110)+_0x19caf5[_0x206c94(0x11b)]+':\x20'+_0x27295e);throw new Error(_0x206c94(0x1a7)+_0x19caf5[_0x206c94(0x11b)]+_0x206c94(0x123)+_0x27295e);}const _0x2c1464=await _0x19caf5[_0x206c94(0x1ca)]();loggerService_1[_0x206c94(0x15b)][_0x206c94(0x1a0)]('mastercard',_0x206c94(0x15f),_0x19caf5[_0x206c94(0x11b)],_0x2c1464,_0x47773b),console[_0x206c94(0x164)](_0x206c94(0x157));let _0x43d3f9=_0x2c1464;if(_0x2c1464[_0x206c94(0x176)]&&_0x2c1464[_0x206c94(0x170)]&&_0x2c1464[_0x206c94(0x111)]){console[_0x206c94(0x164)](_0x206c94(0xf7));try{const _0x2b87b3=await this[_0x206c94(0x18d)](_0x2c1464['info'],_0x2c1464[_0x206c94(0x170)]);_0x43d3f9=JSON['parse'](_0x2b87b3),console['log']('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x206c94(0x14d),'/charge_decrypted',_0x19caf5[_0x206c94(0x11b)],_0x43d3f9,_0x47773b),console[_0x206c94(0x164)](_0x206c94(0xf9));}catch(_0x552c31){console['error'](_0x206c94(0x112),_0x552c31),loggerService_1['loggerService'][_0x206c94(0x124)]('mastercard',_0x206c94(0x1eb),_0x206c94(0x184)+_0x552c31),_0x43d3f9=_0x2c1464;}}else loggerService_1[_0x206c94(0x15b)][_0x206c94(0x1a0)](_0x206c94(0x14d),_0x206c94(0x1c6),_0x19caf5[_0x206c94(0x11b)],_0x43d3f9,_0x47773b),console[_0x206c94(0x164)](_0x206c94(0x116));console['log'](_0x206c94(0x1b8),_0x43d3f9[_0x206c94(0x11b)]),console[_0x206c94(0x164)](_0x206c94(0x141),_0x43d3f9['final']),console['log'](_0x206c94(0x1e8),_0x43d3f9[_0x206c94(0x1b2)]),console['log']('3DS\x20URL:',_0x43d3f9[_0x206c94(0x19b)]||'none');if(_0x43d3f9[_0x206c94(0x11b)]===0x64&&_0x43d3f9['final']===0x1)return console[_0x206c94(0x164)](_0x206c94(0x125)),{'gateway_payment_id':_0x43d3f9[_0x206c94(0x1b2)]?.[_0x206c94(0x143)](),'payment_url':_0x32b9e9,'requires_3ds':![],'status':_0x206c94(0x195),'final':!![]};if(_0x43d3f9[_0x206c94(0x19b)])return console[_0x206c94(0x164)]('🔐\x203DS\x20verification\x20required'),this['scheduleStatusChecks'](_0x3299d5,_0x2f7ca2,_0x43d3f9[_0x206c94(0x1b2)]?.['toString']()||_0x2f7ca2),{'gateway_payment_id':_0x43d3f9[_0x206c94(0x1b2)]?.['toString'](),'payment_url':_0x43d3f9['3ds_url'],'requires_3ds':!![],'threeds_url':_0x43d3f9['3ds_url'],'status':_0x206c94(0x1a4),'final':![]};let _0xb68ba2=_0x43d3f9[_0x206c94(0x128)]||_0x43d3f9[_0x206c94(0x11c)]||'Unknown\x20error',_0x100e25=_0x43d3f9[_0x206c94(0x11b)],_0x1d3c88=_0x43d3f9[_0x206c94(0x10c)];return console[_0x206c94(0x164)]('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x100e25+_0x206c94(0x186)+_0x1d3c88+',\x20Desc:\x20'+_0xb68ba2),{'gateway_payment_id':_0x43d3f9[_0x206c94(0x1b2)]?.[_0x206c94(0x143)](),'payment_url':_0x32b9e9,'requires_3ds':![],'status':'FAILED','final':!![]};}catch(_0x544b59){console[_0x206c94(0x113)](_0x206c94(0x1b5)),console['error'](_0x206c94(0x1e9),_0x544b59),loggerService_1[_0x206c94(0x15b)][_0x206c94(0x124)](_0x206c94(0x14d),_0x206c94(0x150),_0x544b59);throw new Error(_0x206c94(0x1ce)+(_0x544b59 instanceof Error?_0x544b59[_0x206c94(0x11c)]:'Unknown\x20error'));}}async[a42_0x50765a(0x18a)](_0x311566,_0x184861){const _0x4d3e40=a42_0x50765a;console['log'](_0x4d3e40(0x19f)+_0x311566+'\x20('+_0x184861+')');try{const _0x2d7979={'payment_id':_0x311566,'order_id':_0x184861},_0x207390=JSON['stringify'](_0x2d7979),{key:_0x31fdd6,iv:_0x31a134}=this[_0x4d3e40(0x159)](),_0x34af66=this['encryptAES'](_0x207390,_0x31fdd6,_0x31a134),_0x192bbd=this[_0x4d3e40(0x196)](_0x31fdd6,_0x31a134),_0x25950e=this[_0x4d3e40(0x1e4)](_0x207390),_0x46d204={'merchant_point_id':this['merchantPointId'],'method':'status','info':_0x34af66,'key':_0x192bbd,'sign':_0x25950e,'lang':'en'};loggerService_1[_0x4d3e40(0x15b)]['logWhiteDomainRequest'](_0x4d3e40(0x14d),_0x4d3e40(0x1a3),_0x4d3e40(0x162),{'merchant_point_id':this[_0x4d3e40(0x17c)],'method':_0x4d3e40(0x11b),'lang':'en'});const _0x5517dc=Date[_0x4d3e40(0x1df)](),_0x2cdf64=await fetch(this[_0x4d3e40(0x12b)],{'method':_0x4d3e40(0x162),'headers':{'Content-Type':_0x4d3e40(0x12d),'Accept':_0x4d3e40(0x12d),'User-Agent':_0x4d3e40(0x1ea)},'body':JSON['stringify'](_0x46d204)}),_0x54cd2c=Date[_0x4d3e40(0x1df)]()-_0x5517dc;if(!_0x2cdf64['ok']){const _0x5e66aa=await _0x2cdf64[_0x4d3e40(0x174)]();loggerService_1[_0x4d3e40(0x15b)][_0x4d3e40(0x1a0)](_0x4d3e40(0x14d),_0x4d3e40(0x155),_0x2cdf64[_0x4d3e40(0x11b)],_0x5e66aa,_0x54cd2c);throw new Error(_0x4d3e40(0x1a7)+_0x2cdf64[_0x4d3e40(0x11b)]);}const _0x41ff2f=await _0x2cdf64['json']();loggerService_1['loggerService'][_0x4d3e40(0x1a0)]('mastercard',_0x4d3e40(0x155),_0x2cdf64[_0x4d3e40(0x11b)],_0x41ff2f,_0x54cd2c);let _0x499d7d=_0x41ff2f;if(_0x41ff2f[_0x4d3e40(0x176)]&&_0x41ff2f['key']&&_0x41ff2f[_0x4d3e40(0x111)]){console['log']('🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0x392b84=this[_0x4d3e40(0x1c9)](_0x41ff2f[_0x4d3e40(0x176)],_0x41ff2f[_0x4d3e40(0x170)]);_0x499d7d=JSON[_0x4d3e40(0x149)](_0x392b84),console[_0x4d3e40(0x164)](_0x4d3e40(0x15d)),loggerService_1[_0x4d3e40(0x15b)][_0x4d3e40(0x1a0)](_0x4d3e40(0x14d),_0x4d3e40(0x1b6),_0x2cdf64[_0x4d3e40(0x11b)],_0x499d7d,_0x54cd2c),console[_0x4d3e40(0x164)](_0x4d3e40(0x16b));}catch(_0x3a6c47){console[_0x4d3e40(0x113)]('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x3a6c47),loggerService_1[_0x4d3e40(0x15b)]['logWhiteDomainError'](_0x4d3e40(0x14d),_0x4d3e40(0x121),'Status\x20decryption\x20failed:\x20'+_0x3a6c47),_0x499d7d=_0x41ff2f;}}else loggerService_1[_0x4d3e40(0x15b)][_0x4d3e40(0x1a0)]('mastercard','/status_decrypted',_0x2cdf64[_0x4d3e40(0x11b)],_0x499d7d,_0x54cd2c),console[_0x4d3e40(0x164)](_0x4d3e40(0x1ae));console[_0x4d3e40(0x164)](_0x4d3e40(0x1c7),{'status':_0x499d7d[_0x4d3e40(0x11b)],'final':_0x499d7d[_0x4d3e40(0x10c)],'payment_id':_0x499d7d[_0x4d3e40(0x1b2)],'desc':_0x499d7d[_0x4d3e40(0x128)]});let _0x49b302=_0x4d3e40(0x1a4);if(_0x499d7d['status']===0x1&&_0x499d7d[_0x4d3e40(0x10c)]===0x1)_0x49b302=_0x4d3e40(0x195);else _0x499d7d[_0x4d3e40(0x11b)]===0x0&&_0x499d7d[_0x4d3e40(0x10c)]===0x0?_0x49b302=_0x4d3e40(0x1a4):_0x49b302=_0x4d3e40(0x1a2);return{'status':_0x49b302,'final':_0x499d7d[_0x4d3e40(0x10c)]===0x1,'amount':_0x499d7d[_0x4d3e40(0x11a)],'currency':_0x499d7d[_0x4d3e40(0x1c1)],'date_success':_0x499d7d[_0x4d3e40(0x1a6)],'description':_0x499d7d[_0x4d3e40(0x128)]};}catch(_0x24ea5f){console[_0x4d3e40(0x113)](_0x4d3e40(0xf8),_0x24ea5f),loggerService_1[_0x4d3e40(0x15b)][_0x4d3e40(0x124)](_0x4d3e40(0x14d),_0x4d3e40(0x1a3),_0x24ea5f);throw new Error('Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20'+(_0x24ea5f instanceof Error?_0x24ea5f[_0x4d3e40(0x11c)]:_0x4d3e40(0x13e)));}}[a42_0x50765a(0x16d)](_0x9da4d3,_0xf439ca,_0x14594e){const _0xfbcb11=a42_0x50765a;console[_0xfbcb11(0x164)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0x9da4d3+'\x20('+_0x14594e+')'),this[_0xfbcb11(0x1cf)](_0x9da4d3);const _0x2a2436=[],_0x504aac=0x5*0x3c*0x3e8,_0x3dbd54=0x2*0x3c*0x3c*0x3e8,_0x412174=Math['floor'](_0x3dbd54/_0x504aac);console[_0xfbcb11(0x164)](_0xfbcb11(0x178)+_0x412174+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x57f266=0x1;_0x57f266<=_0x412174;_0x57f266++){const _0x499416=setTimeout(async()=>{const _0x153581=_0xfbcb11;console['log'](_0x153581(0x1e7)+_0x57f266+'/'+_0x412174+_0x153581(0x130)+_0x9da4d3);try{const _0x23fb05=await this['checkPaymentStatus'](_0x14594e,_0xf439ca);console['log'](_0x153581(0x13b)+_0x57f266+_0x153581(0x1d8),_0x23fb05),_0x23fb05[_0x153581(0x10c)]&&(console[_0x153581(0x164)]('✅\x20Payment\x20'+_0x9da4d3+_0x153581(0x185)+_0x23fb05[_0x153581(0x11b)]+_0x153581(0x1de)),this[_0x153581(0x1cf)](_0x9da4d3),await this[_0x153581(0x1ec)](_0x9da4d3,_0x23fb05[_0x153581(0x11b)],_0x23fb05));}catch(_0x7fcbf0){console[_0x153581(0x113)](_0x153581(0x103)+_0x57f266+_0x153581(0x1c2)+_0x9da4d3+':',_0x7fcbf0);}},_0x57f266*_0x504aac);_0x2a2436['push'](_0x499416);}this[_0xfbcb11(0x142)]['set'](_0x9da4d3,_0x2a2436),console[_0xfbcb11(0x164)]('✅\x20Scheduled\x20'+_0x412174+'\x20status\x20checks\x20for\x20payment\x20'+_0x9da4d3);}[a42_0x50765a(0x1cf)](_0x238555){const _0x5baf96=a42_0x50765a,_0x48bcec=this[_0x5baf96(0x142)][_0x5baf96(0x182)](_0x238555);_0x48bcec&&(console[_0x5baf96(0x164)](_0x5baf96(0x1bf)+_0x48bcec[_0x5baf96(0x13c)]+_0x5baf96(0x179)+_0x238555),_0x48bcec[_0x5baf96(0x10a)]((_0x27fc9b,_0xb068a)=>{clearTimeout(_0x27fc9b);}),this[_0x5baf96(0x142)][_0x5baf96(0x15e)](_0x238555));}async[a42_0x50765a(0x1ec)](_0x31194e,_0x2585f4,_0x3e8f9f){const _0x1a71c0=a42_0x50765a;try{const _0x47621b=(await Promise[_0x1a71c0(0x100)]()[_0x1a71c0(0x198)](()=>__importStar(require('../../config/database'))))[_0x1a71c0(0x118)],_0x168a10={'status':_0x2585f4['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x1a71c0(0x13f),'statusChangedAt':new Date()};_0x2585f4===_0x1a71c0(0x195)&&(_0x168a10[_0x1a71c0(0x167)]=new Date()),_0x3e8f9f[_0x1a71c0(0x1b0)]&&(_0x168a10[_0x1a71c0(0x13a)]='MasterCard:\x20'+_0x3e8f9f[_0x1a71c0(0x1b0)]),await _0x47621b[_0x1a71c0(0x187)][_0x1a71c0(0x151)]({'where':{'id':_0x31194e},'data':_0x168a10}),console['log'](_0x1a71c0(0x1ab)+_0x31194e+_0x1a71c0(0x1aa)+_0x2585f4),await this[_0x1a71c0(0x1dc)](_0x31194e,_0x2585f4);}catch(_0x512daf){console[_0x1a71c0(0x113)](_0x1a71c0(0x1dd)+_0x31194e+':',_0x512daf);}}async[a42_0x50765a(0x1dc)](_0x23881f,_0x9959eb){const _0x3a7167=a42_0x50765a;try{const _0x11359f=(await Promise[_0x3a7167(0x100)]()[_0x3a7167(0x198)](()=>__importStar(require(_0x3a7167(0x199)))))[_0x3a7167(0x118)],{telegramBotService:_0x2c45e3}=await Promise[_0x3a7167(0x100)]()[_0x3a7167(0x198)](()=>__importStar(require(_0x3a7167(0x1d2)))),_0x55b4f7=await _0x11359f[_0x3a7167(0x187)][_0x3a7167(0x177)]({'where':{'id':_0x23881f},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x55b4f7)return;const _0x34c5e8={'PAID':_0x3a7167(0x193),'FAILED':_0x3a7167(0x14b)},_0x169d74=_0x34c5e8[_0x9959eb];_0x169d74&&await _0x2c45e3[_0x3a7167(0x17e)](_0x55b4f7[_0x3a7167(0x19c)],_0x55b4f7,_0x169d74),await this['sendShopWebhook'](_0x55b4f7,_0x9959eb);}catch(_0x19deff){console[_0x3a7167(0x113)](_0x3a7167(0x14e),_0x19deff);}}async['sendShopWebhook'](_0x46a50c,_0x96425c){const _0x4e91d7=a42_0x50765a,_0x3ccdc1=Date[_0x4e91d7(0x1df)]();try{const _0x4a24fc=_0x46a50c[_0x4e91d7(0x194)],_0x3b54b5=_0x4a24fc[_0x4e91d7(0x1d6)];if(!_0x3b54b5?.[_0x4e91d7(0x1a9)]){console[_0x4e91d7(0x164)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x4a24fc['id']);return;}const _0x455b25=_0x96425c===_0x4e91d7(0x195)?_0x4e91d7(0x156):'payment.failed';let _0x4b85d5=[];if(_0x3b54b5['webhookEvents'])try{_0x4b85d5=Array['isArray'](_0x3b54b5[_0x4e91d7(0x18f)])?_0x3b54b5[_0x4e91d7(0x18f)]:JSON['parse'](_0x3b54b5[_0x4e91d7(0x18f)]);}catch(_0x6734e1){console[_0x4e91d7(0x113)]('Error\x20parsing\x20webhook\x20events:',_0x6734e1),_0x4b85d5=[];}if(!_0x4b85d5[_0x4e91d7(0x101)](_0x455b25)){console[_0x4e91d7(0x164)](_0x4e91d7(0x189)+_0x455b25+_0x4e91d7(0x104)+_0x4a24fc['id']);return;}const _0x278c1e={'event':_0x455b25,'payment':{'id':_0x46a50c['id'],'order_id':_0x46a50c[_0x4e91d7(0x105)],'gateway_order_id':_0x46a50c[_0x4e91d7(0x109)],'gateway':_0x4e91d7(0x131),'amount':_0x46a50c['amount'],'currency':_0x46a50c['currency'],'status':_0x96425c['toLowerCase'](),'customer_email':_0x46a50c['customerEmail'],'customer_name':_0x46a50c[_0x4e91d7(0x119)],'created_at':_0x46a50c[_0x4e91d7(0x160)],'updated_at':new Date()}},_0x2a560b=await fetch(_0x3b54b5[_0x4e91d7(0x1a9)],{'method':_0x4e91d7(0x162),'headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(MasterCard)'},'body':JSON[_0x4e91d7(0x12a)](_0x278c1e)}),_0x5a2f6e=Date[_0x4e91d7(0x1df)]()-_0x3ccdc1;loggerService_1[_0x4e91d7(0x15b)][_0x4e91d7(0x1bd)](_0x46a50c[_0x4e91d7(0x19c)],_0x3b54b5[_0x4e91d7(0x1a9)],_0x455b25,_0x2a560b[_0x4e91d7(0x11b)],_0x5a2f6e,_0x278c1e),console['log']('MasterCard\x20webhook\x20sent\x20to\x20'+_0x3b54b5[_0x4e91d7(0x1a9)]+_0x4e91d7(0x14f)+_0x2a560b[_0x4e91d7(0x11b)]+'\x20('+_0x5a2f6e+_0x4e91d7(0x12e));}catch(_0xc4388){console['error']('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0xc4388),loggerService_1[_0x4e91d7(0x15b)][_0x4e91d7(0x1d4)](_0x46a50c['shopId'],_0x46a50c[_0x4e91d7(0x194)]?.[_0x4e91d7(0x1d6)]?.[_0x4e91d7(0x1a9)]||_0x4e91d7(0x153),_0x4e91d7(0x1e2),_0xc4388,{});}}[a42_0x50765a(0xf4)](_0x27f15d){const _0x1c1c66=a42_0x50765a,_0x388da8=_0x27f15d[_0x1c1c66(0x1e1)](/[\s-]/g,'');if(_0x388da8[_0x1c1c66(0x13c)]<0x4)return'****';return _0x1c1c66(0x18b)+_0x388da8['slice'](-0x4);}async[a42_0x50765a(0xfc)](_0x22339e){const _0x515cfb=a42_0x50765a;console[_0x515cfb(0x164)](_0x515cfb(0x137),_0x22339e);let _0x39600d=_0x515cfb(0x1a4);if(_0x22339e[_0x515cfb(0x11b)]===0x1&&_0x22339e[_0x515cfb(0x10c)]===0x1)_0x39600d=_0x515cfb(0x195);else _0x22339e[_0x515cfb(0x11b)]===0x0&&_0x22339e[_0x515cfb(0x10c)]===0x0?_0x39600d=_0x515cfb(0x1a4):_0x39600d=_0x515cfb(0x1a2);return{'paymentId':_0x22339e[_0x515cfb(0x19a)]||'','status':_0x39600d,'amount':_0x22339e[_0x515cfb(0x11a)],'currency':_0x22339e['currency']};}[a42_0x50765a(0x13d)](){const _0xfa0bb6=a42_0x50765a;console[_0xfa0bb6(0x164)](_0xfa0bb6(0x1ad));const _0x1d7a6b=this[_0xfa0bb6(0x142)][_0xfa0bb6(0x11e)];for(const [_0x4b9d17]of this[_0xfa0bb6(0x142)]){this[_0xfa0bb6(0x1cf)](_0x4b9d17);}console[_0xfa0bb6(0x164)](_0xfa0bb6(0x175)+_0x1d7a6b+'\x20MasterCard\x20status\x20check\x20timers');}}exports['MasterCardService']=MasterCardService;