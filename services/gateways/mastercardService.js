'use strict';const a42_0x2b6ff7=a42_0x350f;function a42_0x33c8(){const _0xf7ffc1=['webhookEvents','🔐\x20Private\x20key\x20length:\x20','/charge','FAILED','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','\x20failed\x20for\x20payment\x20','sendPaymentNotifications','✅\x20Status\x20response\x20decrypted\x20successfully','first_name','/status','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','update','RSA_PKCS1_PADDING','createSign','psp_public.pem','Status:','❌\x20Data\x20being\x20signed:','mastercard','✅\x20Payment\x20successful','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','POST','Final:','📝\x20Encrypted\x20data\x20length:','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','Unknown\x20error','/charge_decrypted','final','../loggerService','✅\x20Payment\x20','Error\x20details:','then','870260jXhsUq','payment','),\x20stopping\x20status\x20checks','set','createdAt','key','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','Private\x20key\x20file\x20not\x20found:\x20','🔐\x20AES\x20key\x20length:','MasterCard\x20webhook\x20sent\x20to\x20','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','amount','toString','create','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','scheduleStatusChecks','parse','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','last_name','generateAESKey','payment.failed','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','stringify','\x20result:','808712OMgrLH','resolve','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','expire_month','44snyaxr','\x20is\x20final\x20(','charge','shopId','base64','webhook_send','paidAt','existsSync','paid','\x20\x20\x20-\x20merchant_point_id:','date_success','error','../telegramBotService','Public\x20key\x20file\x20not\x20found:\x20','readFileSync','maskCardNumber','❌\x20RSA\x20encryption\x20failed:','6GdyjbF','isArray','2275371siBZGl','forEach','settings','Payment\x20ID:','cvv','3ds_url','7402851GGiYXT','-----END','logWhiteDomainError','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','4996ATXGPN','1111','Order\x20ID:','hasOwnProperty','❌\x20MasterCard\x20key\x20validation\x20failed:','none','floor','/status_raw','__createBinding','logWhiteDomainRequest','💳\x20MasterCard\x20service\x20initialized','\x20with\x20status\x20','\x20\x20\x20-\x20sign\x20length:','📝\x20Final\x20request\x20structure:','__importStar','/charge_decrypt','HTTP\x20','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','log','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','decryptResponsePhp','currency','692896EjNdSN','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','number','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','encryptRSA','ms)','📊\x20Status\x20check\x20result:','delete','141468qzIrSJ','/status_decrypt','processCardPayment','__esModule','decryptResponse','loggerService','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','logShopWebhookError','signRSA','info','getOwnPropertyNames','keys','❌\x20Status\x20check\x20#','processWebhook','📝\x20Signature\x20length:','call','order_id','sendPaymentNotification','-----BEGIN','🔐\x20AES\x20key\x20and\x20IV\x20generated','/charge_raw','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format',',\x20Final:\x20','apiUrl','Error\x20parsing\x20webhook\x20events:','sign','publicEncrypt','merchantPointId','now','🔍\x20MasterCard\x20status\x20check\x20#','🛑\x20Stopped\x20','push','unknown','🔐\x20Data\x20signed\x20with\x20RSA','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','⏰\x20Will\x20check\x20status\x20','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','system','SHA256','length','\x20status\x20timers\x20for\x20payment\x20','privateDecrypt','findUnique','replace','get','createCipheriv','Response\x20Body:','checkPaymentStatus','from','PENDING','decryptAES','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','sendShopWebhook','encryptAES','💾\x20Payment\x20data\x20prepared','PHP\x20decryptor\x20error','constants','\x20\x20\x20-\x20lang:\x20en','expire_year','toUpperCase','updatePaymentStatus','payment_id','logWhiteDomainResponse','join','HTTP\x20error!\x20status:\x20','../../config/database','Status\x20decryption\x20failed:\x20','payment.success','randomBytes','clearStatusTimers',',\x20Desc:\x20','text','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','logShopWebhookSent','\x20\x20\x20-\x20info\x20length:','\x20status\x20checks\x20for\x20payment\x20','****','Webhook\x20event\x20','includes','default','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','path','__importDefault','desc','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','validateKeyFiles','defineProperty','adminNotes','🔐\x20Data\x20encrypted\x20with\x20AES','PAID','shop','Failed\x20to\x20send\x20MasterCard\x20webhook:','orderId','publicKeyPath','trim','\x20\x20\x20-\x20key\x20length:','Amount:','webhookUrl','TesSoft\x20Payment\x20System/1.0','MasterCardService','utf8','aes-256-ctr','message','🔐\x20Private\x20key\x20path:','❌\x20PHP\x20decryptor\x20request\x20failed:','cwd','toLowerCase','application/json','📊\x20Status\x20check\x20#','statusCheckTimers','\x20status\x20updated\x20to\x20','writable','stopAllStatusChecks','🔐\x203DS\x20verification\x20required','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','privateKeyPath','Processing\x20MasterCard\x20webhook:','description','prototype','🔐\x20Public\x20key\x20length:\x20','\x20characters','status'];a42_0x33c8=function(){return _0xf7ffc1;};return a42_0x33c8();}function a42_0x350f(_0x197c70,_0x19ed10){const _0x33c895=a42_0x33c8();return a42_0x350f=function(_0x350fdc,_0x39359c){_0x350fdc=_0x350fdc-0x175;let _0x529bed=_0x33c895[_0x350fdc];return _0x529bed;},a42_0x350f(_0x197c70,_0x19ed10);}(function(_0x4d6cbe,_0x46ac6d){const _0x257fcc=a42_0x350f,_0x1efaf3=_0x4d6cbe();while(!![]){try{const _0x594ba2=-parseInt(_0x257fcc(0x1d9))/0x1+-parseInt(_0x257fcc(0x1b8))/0x2+-parseInt(_0x257fcc(0x1fb))/0x3*(parseInt(_0x257fcc(0x1bc))/0x4)+-parseInt(_0x257fcc(0x1a0))/0x5*(-parseInt(_0x257fcc(0x1cd))/0x6)+parseInt(_0x257fcc(0x1cf))/0x7+-parseInt(_0x257fcc(0x1f3))/0x8+parseInt(_0x257fcc(0x1d5))/0x9;if(_0x594ba2===_0x46ac6d)break;else _0x1efaf3['push'](_0x1efaf3['shift']());}catch(_0x5652e0){_0x1efaf3['push'](_0x1efaf3['shift']());}}}(a42_0x33c8,0x4af14));var __createBinding=this&&this[a42_0x2b6ff7(0x1e1)]||(Object[a42_0x2b6ff7(0x1ad)]?function(_0x57ab5a,_0x395aba,_0x1217cb,_0x4f9049){const _0x13230f=a42_0x2b6ff7;if(_0x4f9049===undefined)_0x4f9049=_0x1217cb;var _0x203418=Object['getOwnPropertyDescriptor'](_0x395aba,_0x1217cb);(!_0x203418||(_0x13230f(0x228)in _0x203418?!_0x395aba[_0x13230f(0x1fe)]:_0x203418[_0x13230f(0x176)]||_0x203418['configurable']))&&(_0x203418={'enumerable':!![],'get':function(){return _0x395aba[_0x1217cb];}}),Object[_0x13230f(0x252)](_0x57ab5a,_0x4f9049,_0x203418);}:function(_0x48cf72,_0x372c04,_0x5f15c8,_0x5d813f){if(_0x5d813f===undefined)_0x5d813f=_0x5f15c8;_0x48cf72[_0x5d813f]=_0x372c04[_0x5f15c8];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a42_0x2b6ff7(0x1ad)]?function(_0x4c3ee6,_0x656e7a){const _0x48d07f=a42_0x2b6ff7;Object[_0x48d07f(0x252)](_0x4c3ee6,_0x48d07f(0x24b),{'enumerable':!![],'value':_0x656e7a});}:function(_0xe726a6,_0x2774cb){const _0x4e0543=a42_0x2b6ff7;_0xe726a6[_0x4e0543(0x24b)]=_0x2774cb;}),__importStar=this&&this[a42_0x2b6ff7(0x1e7)]||(function(){var _0x1cc604=function(_0x4c96e7){const _0x367b02=a42_0x350f;return _0x1cc604=Object[_0x367b02(0x205)]||function(_0x12f901){const _0x1ce7b1=_0x367b02;var _0x3db13d=[];for(var _0x3e14d3 in _0x12f901)if(Object[_0x1ce7b1(0x17d)][_0x1ce7b1(0x1dc)][_0x1ce7b1(0x20a)](_0x12f901,_0x3e14d3))_0x3db13d[_0x3db13d[_0x1ce7b1(0x223)]]=_0x3e14d3;return _0x3db13d;},_0x1cc604(_0x4c96e7);};return function(_0x5dcac9){const _0x12b202=a42_0x350f;if(_0x5dcac9&&_0x5dcac9[_0x12b202(0x1fe)])return _0x5dcac9;var _0x1b3452={};if(_0x5dcac9!=null){for(var _0x4e0b62=_0x1cc604(_0x5dcac9),_0x5af11e=0x0;_0x5af11e<_0x4e0b62[_0x12b202(0x223)];_0x5af11e++)if(_0x4e0b62[_0x5af11e]!==_0x12b202(0x24b))__createBinding(_0x1b3452,_0x5dcac9,_0x4e0b62[_0x5af11e]);}return __setModuleDefault(_0x1b3452,_0x5dcac9),_0x1b3452;};}()),__importDefault=this&&this[a42_0x2b6ff7(0x24e)]||function(_0x4d6a1f){const _0x1dd60c=a42_0x2b6ff7;return _0x4d6a1f&&_0x4d6a1f[_0x1dd60c(0x1fe)]?_0x4d6a1f:{'default':_0x4d6a1f};};Object['defineProperty'](exports,a42_0x2b6ff7(0x1fe),{'value':!![]}),exports[a42_0x2b6ff7(0x25f)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x2b6ff7(0x24d))),loggerService_1=require(a42_0x2b6ff7(0x19c));class MasterCardService{constructor(){const _0x126550=a42_0x2b6ff7;this[_0x126550(0x269)]=new Map(),this[_0x126550(0x212)]='https://api.paydmeth.com/api',this['merchantPointId']=0x67c,this[_0x126550(0x17a)]=path_1[_0x126550(0x24b)]['join'](process[_0x126550(0x265)](),_0x126550(0x206),'private.pem'),this[_0x126550(0x259)]=path_1[_0x126550(0x24b)][_0x126550(0x23b)](process['cwd'](),_0x126550(0x206),_0x126550(0x18f)),console[_0x126550(0x1eb)](_0x126550(0x1e3)),console[_0x126550(0x1eb)](_0x126550(0x263),this[_0x126550(0x17a)]),console[_0x126550(0x1eb)]('🔐\x20Public\x20key\x20path:',this['publicKeyPath']),this[_0x126550(0x251)]();}[a42_0x2b6ff7(0x251)](){const _0x4a6269=a42_0x2b6ff7;try{if(!fs_1[_0x4a6269(0x24b)][_0x4a6269(0x1c3)](this['privateKeyPath']))throw new Error(_0x4a6269(0x1a7)+this[_0x4a6269(0x17a)]);if(!fs_1['default']['existsSync'](this[_0x4a6269(0x259)]))throw new Error(_0x4a6269(0x1c9)+this[_0x4a6269(0x259)]);const _0x3b26f1=fs_1[_0x4a6269(0x24b)]['readFileSync'](this[_0x4a6269(0x17a)],_0x4a6269(0x260))[_0x4a6269(0x25a)](),_0x58248b=fs_1[_0x4a6269(0x24b)][_0x4a6269(0x1ca)](this[_0x4a6269(0x259)],_0x4a6269(0x260))[_0x4a6269(0x25a)]();if(!_0x3b26f1['includes'](_0x4a6269(0x20d))||!_0x3b26f1['includes'](_0x4a6269(0x1d6)))throw new Error(_0x4a6269(0x185));if(!_0x58248b['includes']('-----BEGIN')||!_0x58248b[_0x4a6269(0x24a)]('-----END'))throw new Error(_0x4a6269(0x210));console[_0x4a6269(0x1eb)](_0x4a6269(0x244)),console[_0x4a6269(0x1eb)](_0x4a6269(0x182)+_0x3b26f1[_0x4a6269(0x223)]+'\x20characters'),console[_0x4a6269(0x1eb)](_0x4a6269(0x17e)+_0x58248b['length']+_0x4a6269(0x17f));}catch(_0x31b3dd){console[_0x4a6269(0x1c7)](_0x4a6269(0x1dd),_0x31b3dd);throw _0x31b3dd;}}[a42_0x2b6ff7(0x1b3)](){const _0x380db6=a42_0x2b6ff7,_0x1db5ec=crypto_1['default'][_0x380db6(0x240)](0x20),_0x37ee8b=crypto_1[_0x380db6(0x24b)]['randomBytes'](0x10);return{'key':_0x1db5ec,'iv':_0x37ee8b};}[a42_0x2b6ff7(0x231)](_0x2e767e,_0x180f5d,_0x47bce6){const _0x3b2eae=a42_0x2b6ff7,_0x143844=crypto_1[_0x3b2eae(0x24b)][_0x3b2eae(0x229)](_0x3b2eae(0x261),_0x180f5d,_0x47bce6);let _0x461ebe=_0x143844[_0x3b2eae(0x18c)](_0x2e767e,_0x3b2eae(0x260),_0x3b2eae(0x1c0));return _0x461ebe+=_0x143844[_0x3b2eae(0x19b)](_0x3b2eae(0x1c0)),_0x461ebe;}[a42_0x2b6ff7(0x1f7)](_0x4e6633,_0x23591e){const _0x2d7855=a42_0x2b6ff7;try{const _0x169a0e=fs_1[_0x2d7855(0x24b)]['readFileSync'](this[_0x2d7855(0x259)],_0x2d7855(0x260))[_0x2d7855(0x25a)](),_0x9caaf={'iv':_0x23591e[_0x2d7855(0x1ac)]('base64'),'key':_0x4e6633[_0x2d7855(0x1ac)](_0x2d7855(0x1c0))},_0x1456d8=JSON['stringify'](_0x9caaf);console['log']('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x1456d8[_0x2d7855(0x223)]);const _0x25f898=crypto_1[_0x2d7855(0x24b)][_0x2d7855(0x215)]({'key':_0x169a0e,'padding':crypto_1['default'][_0x2d7855(0x234)][_0x2d7855(0x18d)]},Buffer[_0x2d7855(0x22c)](_0x1456d8));return console['log'](_0x2d7855(0x1ee),_0x25f898[_0x2d7855(0x223)]),_0x25f898['toString'](_0x2d7855(0x1c0));}catch(_0x566ca3){console['error'](_0x2d7855(0x1cc),_0x566ca3);throw new Error(_0x2d7855(0x1a6));}}[a42_0x2b6ff7(0x203)](_0x5ad26f){const _0x14ea95=a42_0x2b6ff7;try{const _0x51a27d=fs_1[_0x14ea95(0x24b)]['readFileSync'](this['privateKeyPath'],'utf8')['trim'](),_0x601528=crypto_1[_0x14ea95(0x24b)][_0x14ea95(0x18e)](_0x14ea95(0x222));_0x601528[_0x14ea95(0x18c)](_0x5ad26f),_0x601528['end']();const _0x416750=_0x601528[_0x14ea95(0x214)](_0x51a27d,_0x14ea95(0x1c0));return console[_0x14ea95(0x1eb)]('🔐\x20RSA\x20signing\x20successful'),console['log']('📝\x20Data\x20to\x20sign\x20length:',_0x5ad26f[_0x14ea95(0x223)]),console[_0x14ea95(0x1eb)](_0x14ea95(0x209),_0x416750[_0x14ea95(0x223)]),_0x416750;}catch(_0x163e24){console[_0x14ea95(0x1c7)]('❌\x20RSA\x20signing\x20failed:',_0x163e24),console[_0x14ea95(0x1c7)](_0x14ea95(0x191),_0x5ad26f['substring'](0x0,0xc8)+'...');throw new Error(_0x14ea95(0x1b1));}}[a42_0x2b6ff7(0x22e)](_0x2fd517,_0x56affe,_0x3b2f85){const _0x1655eb=a42_0x2b6ff7,_0xb4dcef=crypto_1[_0x1655eb(0x24b)]['createDecipheriv'](_0x1655eb(0x261),_0x56affe,_0x3b2f85);let _0x39da4c=_0xb4dcef[_0x1655eb(0x18c)](_0x2fd517,'base64',_0x1655eb(0x260));return _0x39da4c+=_0xb4dcef[_0x1655eb(0x19b)](_0x1655eb(0x260)),_0x39da4c;}async['decryptResponsePhp'](_0x1debff,_0x4736b6){const _0x1ed8f0=a42_0x2b6ff7;try{const _0x37b938=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x1ed8f0(0x195),'headers':{'Content-Type':_0x1ed8f0(0x267)},'body':JSON[_0x1ed8f0(0x1b6)]({'info':_0x1debff,'key':_0x4736b6})});if(!_0x37b938['ok'])throw new Error(_0x1ed8f0(0x233));return await _0x37b938[_0x1ed8f0(0x243)]();}catch(_0x2cdba9){console[_0x1ed8f0(0x1c7)](_0x1ed8f0(0x264),_0x2cdba9);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a42_0x2b6ff7(0x1ff)](_0x2e4ebc,_0x1f5068){const _0x35e738=a42_0x2b6ff7;try{const _0x3770ef=fs_1['default'][_0x35e738(0x1ca)](this[_0x35e738(0x17a)],_0x35e738(0x260))[_0x35e738(0x25a)](),_0x22d78a=crypto_1[_0x35e738(0x24b)][_0x35e738(0x225)](_0x3770ef,Buffer[_0x35e738(0x22c)](_0x1f5068,'base64')),_0x59c089=JSON['parse'](_0x22d78a[_0x35e738(0x1ac)]()),_0x27c079=Buffer['from'](_0x59c089['key'],_0x35e738(0x1c0)),_0xff6c5c=Buffer[_0x35e738(0x22c)](_0x59c089['iv'],_0x35e738(0x1c0));return this['decryptAES'](_0x2e4ebc,_0x27c079,_0xff6c5c);}catch(_0x4071e2){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a42_0x2b6ff7(0x1fd)](_0x4ba725){const _0x318992=a42_0x2b6ff7,{paymentId:_0x39e75e,orderId:_0x5c7ae7,amount:_0x1c42f9,currency:_0x2cd05a,cardData:_0x9d3a52,resultUrl:_0x388d65,returnUrl:_0x376fe9,cardHolder:_0x2d878f,browser:_0x2ef476}=_0x4ba725;console[_0x318992(0x1eb)](_0x318992(0x179)),console[_0x318992(0x1eb)]('Payment\x20ID:',_0x39e75e),console[_0x318992(0x1eb)](_0x318992(0x1db),_0x5c7ae7),console[_0x318992(0x1eb)](_0x318992(0x25c),_0x1c42f9,_0x2cd05a),console['log']('Card\x20Number:',this[_0x318992(0x1cb)](_0x9d3a52[_0x318992(0x1f5)])),console['log']('Card\x20Holder:',_0x2d878f[_0x318992(0x189)]+'\x20'+_0x2d878f[_0x318992(0x1b2)]),console[_0x318992(0x1eb)]('Return\x20URL:',_0x376fe9),console['log']('Result\x20URL:',_0x388d65);const _0x308645={'amount':_0x1c42f9,'currency':_0x2cd05a['toUpperCase'](),'order_id':_0x5c7ae7,'result_url':_0x388d65,'return_url':_0x376fe9,'card':{'number':_0x9d3a52['number'],'expire_month':_0x9d3a52[_0x318992(0x1bb)],'expire_year':_0x9d3a52[_0x318992(0x236)],'cvv':_0x9d3a52[_0x318992(0x1d3)]},'card_holder':_0x2d878f,'browser':_0x2ef476},_0x14ff98=JSON[_0x318992(0x1b6)](_0x308645);console[_0x318992(0x1eb)](_0x318992(0x232)),console[_0x318992(0x1eb)](_0x318992(0x24c)),console[_0x318992(0x1eb)](_0x14ff98),console[_0x318992(0x1eb)]('📝\x20Data\x20length:',_0x14ff98[_0x318992(0x223)]);try{const {key:_0x5963b6,iv:_0x1fe4ce}=this[_0x318992(0x1b3)]();console[_0x318992(0x1eb)](_0x318992(0x20e)),console['log'](_0x318992(0x1a8),_0x5963b6[_0x318992(0x223)]),console[_0x318992(0x1eb)]('🔐\x20AES\x20IV\x20length:',_0x1fe4ce[_0x318992(0x223)]);const _0x34fc2c=this[_0x318992(0x231)](_0x14ff98,_0x5963b6,_0x1fe4ce);console[_0x318992(0x1eb)](_0x318992(0x254)),console[_0x318992(0x1eb)](_0x318992(0x197),_0x34fc2c['length']);const _0xe28d98=this[_0x318992(0x1f7)](_0x5963b6,_0x1fe4ce);console[_0x318992(0x1eb)](_0x318992(0x250)),console[_0x318992(0x1eb)]('📝\x20Encrypted\x20key\x20length:',_0xe28d98[_0x318992(0x223)]);const _0x41a354=this[_0x318992(0x203)](_0x14ff98);console[_0x318992(0x1eb)](_0x318992(0x21c)),console[_0x318992(0x1eb)]('📝\x20Signature\x20length:',_0x41a354[_0x318992(0x223)]);const _0x4a4534={'merchant_point_id':this[_0x318992(0x216)],'method':_0x318992(0x1be),'info':_0x34fc2c,'key':_0xe28d98,'sign':_0x41a354,'lang':'en'};console[_0x318992(0x1eb)](_0x318992(0x1d8)),console[_0x318992(0x1eb)](_0x318992(0x1e6)),console[_0x318992(0x1eb)](_0x318992(0x1c5),this[_0x318992(0x216)]),console[_0x318992(0x1eb)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x318992(0x1eb)](_0x318992(0x246),_0x34fc2c[_0x318992(0x223)]),console['log'](_0x318992(0x25b),_0xe28d98['length']),console['log'](_0x318992(0x1e5),_0x41a354[_0x318992(0x223)]),console[_0x318992(0x1eb)](_0x318992(0x235)),loggerService_1[_0x318992(0x200)][_0x318992(0x1e2)](_0x318992(0x192),_0x318992(0x183),_0x318992(0x195),{'merchant_point_id':this['merchantPointId'],'method':_0x318992(0x1be),'lang':'en'});const _0x28cfd0=Date['now'](),_0x1ed24b=await fetch(this[_0x318992(0x212)],{'method':_0x318992(0x195),'headers':{'Content-Type':_0x318992(0x267),'Accept':'application/json','User-Agent':_0x318992(0x25e)},'body':JSON[_0x318992(0x1b6)](_0x4a4534)}),_0x17770e=Date[_0x318992(0x217)]()-_0x28cfd0;console[_0x318992(0x1eb)](_0x318992(0x220)),console[_0x318992(0x1eb)]('Status:',_0x1ed24b[_0x318992(0x180)]),console['log']('Response\x20Time:',_0x17770e+'ms');if(!_0x1ed24b['ok']){const _0x19b43b=await _0x1ed24b['text']();console['error']('HTTP\x20Status:',_0x1ed24b[_0x318992(0x180)]),console[_0x318992(0x1c7)](_0x318992(0x22a),_0x19b43b),loggerService_1['loggerService'][_0x318992(0x23a)](_0x318992(0x192),_0x318992(0x20f),_0x1ed24b[_0x318992(0x180)],_0x19b43b,_0x17770e),loggerService_1[_0x318992(0x200)][_0x318992(0x1d7)](_0x318992(0x192),_0x318992(0x183),_0x318992(0x1e9)+_0x1ed24b['status']+':\x20'+_0x19b43b);throw new Error(_0x318992(0x23c)+_0x1ed24b['status']+',\x20body:\x20'+_0x19b43b);}const _0x20d3b4=await _0x1ed24b['json']();loggerService_1[_0x318992(0x200)][_0x318992(0x23a)](_0x318992(0x192),_0x318992(0x20f),_0x1ed24b['status'],_0x20d3b4,_0x17770e),console[_0x318992(0x1eb)](_0x318992(0x1ef));let _0xc2db27=_0x20d3b4;if(_0x20d3b4['info']&&_0x20d3b4[_0x318992(0x1a5)]&&_0x20d3b4[_0x318992(0x214)]){console['log'](_0x318992(0x1ea));try{const _0x515ec7=await this[_0x318992(0x1f1)](_0x20d3b4[_0x318992(0x204)],_0x20d3b4[_0x318992(0x1a5)]);_0xc2db27=JSON[_0x318992(0x1b0)](_0x515ec7),console[_0x318992(0x1eb)](_0x318992(0x1ed)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x318992(0x192),_0x318992(0x19a),_0x1ed24b['status'],_0xc2db27,_0x17770e),console[_0x318992(0x1eb)](_0x318992(0x1ec));}catch(_0x48daba){console[_0x318992(0x1c7)](_0x318992(0x22f),_0x48daba),loggerService_1[_0x318992(0x200)][_0x318992(0x1d7)](_0x318992(0x192),_0x318992(0x1e8),'Decryption\x20failed:\x20'+_0x48daba),_0xc2db27=_0x20d3b4;}}else loggerService_1['loggerService'][_0x318992(0x23a)](_0x318992(0x192),_0x318992(0x19a),_0x1ed24b[_0x318992(0x180)],_0xc2db27,_0x17770e),console[_0x318992(0x1eb)](_0x318992(0x1f6));console[_0x318992(0x1eb)](_0x318992(0x190),_0xc2db27['status']),console[_0x318992(0x1eb)](_0x318992(0x196),_0xc2db27[_0x318992(0x19b)]),console[_0x318992(0x1eb)](_0x318992(0x1d2),_0xc2db27[_0x318992(0x239)]),console['log']('3DS\x20URL:',_0xc2db27[_0x318992(0x1d4)]||_0x318992(0x1de));if(_0xc2db27[_0x318992(0x180)]===0x64&&_0xc2db27['final']===0x1)return console[_0x318992(0x1eb)](_0x318992(0x193)),{'gateway_payment_id':_0xc2db27[_0x318992(0x239)]?.[_0x318992(0x1ac)](),'payment_url':_0x376fe9,'requires_3ds':![],'status':'PAID','final':!![]};if(_0xc2db27['3ds_url'])return console[_0x318992(0x1eb)](_0x318992(0x178)),this[_0x318992(0x1af)](_0x39e75e,_0x5c7ae7,_0xc2db27[_0x318992(0x239)]?.[_0x318992(0x1ac)]()||_0x5c7ae7),{'gateway_payment_id':_0xc2db27['payment_id']?.[_0x318992(0x1ac)](),'payment_url':_0xc2db27[_0x318992(0x1d4)],'requires_3ds':!![],'threeds_url':_0xc2db27[_0x318992(0x1d4)],'status':'PENDING','final':![]};let _0x396936=_0xc2db27[_0x318992(0x24f)]||_0xc2db27[_0x318992(0x262)]||_0x318992(0x199),_0xd264=_0xc2db27[_0x318992(0x180)],_0x9b186f=_0xc2db27[_0x318992(0x19b)];return console['log'](_0x318992(0x194)+_0xd264+_0x318992(0x211)+_0x9b186f+_0x318992(0x242)+_0x396936),{'gateway_payment_id':_0xc2db27[_0x318992(0x239)]?.[_0x318992(0x1ac)](),'payment_url':_0x376fe9,'requires_3ds':![],'status':_0x318992(0x184),'final':!![]};}catch(_0x24ce53){console[_0x318992(0x1c7)](_0x318992(0x18b)),console[_0x318992(0x1c7)](_0x318992(0x19e),_0x24ce53),loggerService_1[_0x318992(0x200)][_0x318992(0x1d7)](_0x318992(0x192),_0x318992(0x183),_0x24ce53);throw new Error(_0x318992(0x201)+(_0x24ce53 instanceof Error?_0x24ce53['message']:_0x318992(0x199)));}}async[a42_0x2b6ff7(0x22b)](_0x64fa8b,_0x471f60){const _0x54cf0e=a42_0x2b6ff7;console['log'](_0x54cf0e(0x1ae)+_0x64fa8b+'\x20('+_0x471f60+')');try{const _0x19685a={'payment_id':_0x64fa8b,'order_id':_0x471f60},_0x512d64=JSON['stringify'](_0x19685a),{key:_0x3f626a,iv:_0x1fcb3f}=this[_0x54cf0e(0x1b3)](),_0x1a6607=this[_0x54cf0e(0x231)](_0x512d64,_0x3f626a,_0x1fcb3f),_0x5855e0=this[_0x54cf0e(0x1f7)](_0x3f626a,_0x1fcb3f),_0x2945ce=this[_0x54cf0e(0x203)](_0x512d64),_0x3bc3c5={'merchant_point_id':this[_0x54cf0e(0x216)],'method':_0x54cf0e(0x180),'info':_0x1a6607,'key':_0x5855e0,'sign':_0x2945ce,'lang':'en'};loggerService_1[_0x54cf0e(0x200)][_0x54cf0e(0x1e2)]('mastercard',_0x54cf0e(0x18a),_0x54cf0e(0x195),{'merchant_point_id':this[_0x54cf0e(0x216)],'method':_0x54cf0e(0x180),'lang':'en'});const _0x29f9dd=Date[_0x54cf0e(0x217)](),_0x1772a7=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x54cf0e(0x267),'User-Agent':_0x54cf0e(0x25e)},'body':JSON['stringify'](_0x3bc3c5)}),_0x325319=Date[_0x54cf0e(0x217)]()-_0x29f9dd;if(!_0x1772a7['ok']){const _0x2e77c8=await _0x1772a7[_0x54cf0e(0x243)]();loggerService_1[_0x54cf0e(0x200)]['logWhiteDomainResponse']('mastercard','/status_raw',_0x1772a7[_0x54cf0e(0x180)],_0x2e77c8,_0x325319);throw new Error(_0x54cf0e(0x23c)+_0x1772a7[_0x54cf0e(0x180)]);}const _0x1c022d=await _0x1772a7['json']();loggerService_1[_0x54cf0e(0x200)][_0x54cf0e(0x23a)](_0x54cf0e(0x192),_0x54cf0e(0x1e0),_0x1772a7[_0x54cf0e(0x180)],_0x1c022d,_0x325319);let _0x4cda0d=_0x1c022d;if(_0x1c022d[_0x54cf0e(0x204)]&&_0x1c022d[_0x54cf0e(0x1a5)]&&_0x1c022d[_0x54cf0e(0x214)]){console['log']('🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0xe7df8=this['decryptResponse'](_0x1c022d[_0x54cf0e(0x204)],_0x1c022d[_0x54cf0e(0x1a5)]);_0x4cda0d=JSON[_0x54cf0e(0x1b0)](_0xe7df8),console[_0x54cf0e(0x1eb)](_0x54cf0e(0x188)),loggerService_1[_0x54cf0e(0x200)][_0x54cf0e(0x23a)]('mastercard','/status_decrypted',_0x1772a7[_0x54cf0e(0x180)],_0x4cda0d,_0x325319),console[_0x54cf0e(0x1eb)](_0x54cf0e(0x1ba));}catch(_0x13f8c5){console[_0x54cf0e(0x1c7)](_0x54cf0e(0x21f),_0x13f8c5),loggerService_1[_0x54cf0e(0x200)]['logWhiteDomainError'](_0x54cf0e(0x192),_0x54cf0e(0x1fc),_0x54cf0e(0x23e)+_0x13f8c5),_0x4cda0d=_0x1c022d;}}else loggerService_1['loggerService'][_0x54cf0e(0x23a)](_0x54cf0e(0x192),'/status_decrypted',_0x1772a7[_0x54cf0e(0x180)],_0x4cda0d,_0x325319),console[_0x54cf0e(0x1eb)](_0x54cf0e(0x198));console[_0x54cf0e(0x1eb)](_0x54cf0e(0x1f9),{'status':_0x4cda0d['status'],'final':_0x4cda0d['final'],'payment_id':_0x4cda0d[_0x54cf0e(0x239)],'desc':_0x4cda0d[_0x54cf0e(0x24f)]});let _0x20c2cd='PENDING';if(_0x4cda0d[_0x54cf0e(0x180)]===0x1&&_0x4cda0d['final']===0x1)_0x20c2cd='PAID';else _0x4cda0d[_0x54cf0e(0x180)]===0x0&&_0x4cda0d['final']===0x0?_0x20c2cd=_0x54cf0e(0x22d):_0x20c2cd=_0x54cf0e(0x184);return{'status':_0x20c2cd,'final':_0x4cda0d['final']===0x1,'amount':_0x4cda0d['amount'],'currency':_0x4cda0d[_0x54cf0e(0x1f2)],'date_success':_0x4cda0d[_0x54cf0e(0x1c6)],'description':_0x4cda0d[_0x54cf0e(0x24f)]};}catch(_0x5a4e00){console[_0x54cf0e(0x1c7)]('MasterCard\x20status\x20check\x20error:',_0x5a4e00),loggerService_1[_0x54cf0e(0x200)][_0x54cf0e(0x1d7)]('mastercard',_0x54cf0e(0x18a),_0x5a4e00);throw new Error(_0x54cf0e(0x1b5)+(_0x5a4e00 instanceof Error?_0x5a4e00[_0x54cf0e(0x262)]:'Unknown\x20error'));}}[a42_0x2b6ff7(0x1af)](_0x2efd91,_0x569038,_0x1a70e1){const _0x3093bd=a42_0x2b6ff7;console[_0x3093bd(0x1eb)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0x2efd91+'\x20('+_0x1a70e1+')'),this[_0x3093bd(0x241)](_0x2efd91);const _0x3a3140=[],_0x18efc2=0x5*0x3c*0x3e8,_0x4e243a=0x2*0x3c*0x3c*0x3e8,_0x4ba914=Math[_0x3093bd(0x1df)](_0x4e243a/_0x18efc2);console[_0x3093bd(0x1eb)](_0x3093bd(0x21e)+_0x4ba914+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x23d35c=0x1;_0x23d35c<=_0x4ba914;_0x23d35c++){const _0x6f5462=setTimeout(async()=>{const _0x436c42=_0x3093bd;console['log'](_0x436c42(0x218)+_0x23d35c+'/'+_0x4ba914+'\x20for\x20payment\x20'+_0x2efd91);try{const _0x1108cd=await this[_0x436c42(0x22b)](_0x1a70e1,_0x569038);console[_0x436c42(0x1eb)](_0x436c42(0x268)+_0x23d35c+_0x436c42(0x1b7),_0x1108cd),_0x1108cd[_0x436c42(0x19b)]&&(console[_0x436c42(0x1eb)]('✅\x20Payment\x20'+_0x2efd91+_0x436c42(0x1bd)+_0x1108cd[_0x436c42(0x180)]+_0x436c42(0x1a2)),this[_0x436c42(0x241)](_0x2efd91),await this[_0x436c42(0x238)](_0x2efd91,_0x1108cd[_0x436c42(0x180)],_0x1108cd));}catch(_0x6a9151){console[_0x436c42(0x1c7)](_0x436c42(0x207)+_0x23d35c+_0x436c42(0x186)+_0x2efd91+':',_0x6a9151);}},_0x23d35c*_0x18efc2);_0x3a3140[_0x3093bd(0x21a)](_0x6f5462);}this['statusCheckTimers'][_0x3093bd(0x1a3)](_0x2efd91,_0x3a3140),console[_0x3093bd(0x1eb)]('✅\x20Scheduled\x20'+_0x4ba914+_0x3093bd(0x247)+_0x2efd91);}[a42_0x2b6ff7(0x241)](_0x5e4616){const _0x385fa0=a42_0x2b6ff7,_0x42f03c=this[_0x385fa0(0x269)]['get'](_0x5e4616);_0x42f03c&&(console['log']('🧹\x20Clearing\x20'+_0x42f03c[_0x385fa0(0x223)]+_0x385fa0(0x224)+_0x5e4616),_0x42f03c[_0x385fa0(0x1d0)]((_0x2098fc,_0x5c07e8)=>{clearTimeout(_0x2098fc);}),this[_0x385fa0(0x269)][_0x385fa0(0x1fa)](_0x5e4616));}async['updatePaymentStatus'](_0x1d87be,_0x49c9b2,_0x3e46d4){const _0xf472f=a42_0x2b6ff7;try{const _0x128db7=(await Promise[_0xf472f(0x1b9)]()[_0xf472f(0x19f)](()=>__importStar(require(_0xf472f(0x23d)))))[_0xf472f(0x24b)],_0x3ad387={'status':_0x49c9b2[_0xf472f(0x237)](),'updatedAt':new Date(),'statusChangedBy':_0xf472f(0x221),'statusChangedAt':new Date()};_0x49c9b2===_0xf472f(0x255)&&(_0x3ad387[_0xf472f(0x1c2)]=new Date()),_0x3e46d4[_0xf472f(0x17c)]&&(_0x3ad387[_0xf472f(0x253)]='MasterCard:\x20'+_0x3e46d4['description']),await _0x128db7[_0xf472f(0x1a1)][_0xf472f(0x18c)]({'where':{'id':_0x1d87be},'data':_0x3ad387}),console[_0xf472f(0x1eb)](_0xf472f(0x19d)+_0x1d87be+_0xf472f(0x175)+_0x49c9b2),await this[_0xf472f(0x187)](_0x1d87be,_0x49c9b2);}catch(_0xae8511){console[_0xf472f(0x1c7)](_0xf472f(0x21d)+_0x1d87be+':',_0xae8511);}}async[a42_0x2b6ff7(0x187)](_0x5aa3d0,_0x5e27b5){const _0xe7c016=a42_0x2b6ff7;try{const _0xcf06bf=(await Promise[_0xe7c016(0x1b9)]()[_0xe7c016(0x19f)](()=>__importStar(require(_0xe7c016(0x23d)))))[_0xe7c016(0x24b)],{telegramBotService:_0x545b38}=await Promise[_0xe7c016(0x1b9)]()[_0xe7c016(0x19f)](()=>__importStar(require(_0xe7c016(0x1c8)))),_0x3c9e4=await _0xcf06bf['payment'][_0xe7c016(0x226)]({'where':{'id':_0x5aa3d0},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x3c9e4)return;const _0x2683a3={'PAID':_0xe7c016(0x1c4),'FAILED':'failed'},_0x5d60fa=_0x2683a3[_0x5e27b5];_0x5d60fa&&await _0x545b38[_0xe7c016(0x20c)](_0x3c9e4[_0xe7c016(0x1bf)],_0x3c9e4,_0x5d60fa),await this[_0xe7c016(0x230)](_0x3c9e4,_0x5e27b5);}catch(_0x49934f){console[_0xe7c016(0x1c7)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x49934f);}}async[a42_0x2b6ff7(0x230)](_0x32128d,_0x10a021){const _0x4486b1=a42_0x2b6ff7,_0x3c9d71=Date[_0x4486b1(0x217)]();try{const _0x41757b=_0x32128d['shop'],_0x1473ce=_0x41757b[_0x4486b1(0x1d1)];if(!_0x1473ce?.['webhookUrl']){console[_0x4486b1(0x1eb)](_0x4486b1(0x1f4)+_0x41757b['id']);return;}const _0x1be211=_0x10a021===_0x4486b1(0x255)?_0x4486b1(0x23f):_0x4486b1(0x1b4);let _0x3a9f12=[];if(_0x1473ce[_0x4486b1(0x181)])try{_0x3a9f12=Array[_0x4486b1(0x1ce)](_0x1473ce[_0x4486b1(0x181)])?_0x1473ce[_0x4486b1(0x181)]:JSON[_0x4486b1(0x1b0)](_0x1473ce[_0x4486b1(0x181)]);}catch(_0x3a544b){console[_0x4486b1(0x1c7)](_0x4486b1(0x213),_0x3a544b),_0x3a9f12=[];}if(!_0x3a9f12[_0x4486b1(0x24a)](_0x1be211)){console['log'](_0x4486b1(0x249)+_0x1be211+'\x20not\x20enabled\x20for\x20shop\x20'+_0x41757b['id']);return;}const _0x504a92={'event':_0x1be211,'payment':{'id':_0x32128d['id'],'order_id':_0x32128d[_0x4486b1(0x258)],'gateway_order_id':_0x32128d['gatewayOrderId'],'gateway':_0x4486b1(0x1da),'amount':_0x32128d[_0x4486b1(0x1ab)],'currency':_0x32128d[_0x4486b1(0x1f2)],'status':_0x10a021[_0x4486b1(0x266)](),'customer_email':_0x32128d['customerEmail'],'customer_name':_0x32128d['customerName'],'created_at':_0x32128d[_0x4486b1(0x1a4)],'updated_at':new Date()}},_0x48f3d7=await fetch(_0x1473ce['webhookUrl'],{'method':_0x4486b1(0x195),'headers':{'Content-Type':_0x4486b1(0x267),'User-Agent':_0x4486b1(0x1f0)},'body':JSON[_0x4486b1(0x1b6)](_0x504a92)}),_0x4fdf50=Date[_0x4486b1(0x217)]()-_0x3c9d71;loggerService_1[_0x4486b1(0x200)][_0x4486b1(0x245)](_0x32128d['shopId'],_0x1473ce[_0x4486b1(0x25d)],_0x1be211,_0x48f3d7[_0x4486b1(0x180)],_0x4fdf50,_0x504a92),console[_0x4486b1(0x1eb)](_0x4486b1(0x1a9)+_0x1473ce['webhookUrl']+_0x4486b1(0x1e4)+_0x48f3d7[_0x4486b1(0x180)]+'\x20('+_0x4fdf50+_0x4486b1(0x1f8));}catch(_0x515149){console['error'](_0x4486b1(0x257),_0x515149),loggerService_1[_0x4486b1(0x200)][_0x4486b1(0x202)](_0x32128d['shopId'],_0x32128d[_0x4486b1(0x256)]?.[_0x4486b1(0x1d1)]?.[_0x4486b1(0x25d)]||_0x4486b1(0x21b),_0x4486b1(0x1c1),_0x515149,{});}}[a42_0x2b6ff7(0x1cb)](_0x375afe){const _0x3333c2=a42_0x2b6ff7,_0x3b7398=_0x375afe[_0x3333c2(0x227)](/[\s-]/g,'');if(_0x3b7398[_0x3333c2(0x223)]<0x4)return _0x3333c2(0x248);return'****\x20****\x20****\x20'+_0x3b7398['slice'](-0x4);}async[a42_0x2b6ff7(0x208)](_0x5825fc){const _0x52f38f=a42_0x2b6ff7;console['log'](_0x52f38f(0x17b),_0x5825fc);let _0x499f25=_0x52f38f(0x22d);if(_0x5825fc['status']===0x1&&_0x5825fc['final']===0x1)_0x499f25=_0x52f38f(0x255);else _0x5825fc[_0x52f38f(0x180)]===0x0&&_0x5825fc[_0x52f38f(0x19b)]===0x0?_0x499f25=_0x52f38f(0x22d):_0x499f25=_0x52f38f(0x184);return{'paymentId':_0x5825fc[_0x52f38f(0x20b)]||'','status':_0x499f25,'amount':_0x5825fc[_0x52f38f(0x1ab)],'currency':_0x5825fc[_0x52f38f(0x1f2)]};}[a42_0x2b6ff7(0x177)](){const _0x426961=a42_0x2b6ff7;console[_0x426961(0x1eb)](_0x426961(0x1aa));const _0x320510=this['statusCheckTimers']['size'];for(const [_0x3115c3]of this['statusCheckTimers']){this[_0x426961(0x241)](_0x3115c3);}console[_0x426961(0x1eb)](_0x426961(0x219)+_0x320510+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a42_0x2b6ff7(0x25f)]=MasterCardService;