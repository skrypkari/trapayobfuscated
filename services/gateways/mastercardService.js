'use strict';const a57_0x464a4e=a57_0x3932;(function(_0x3c9d15,_0x390ed0){const _0x1048ce=a57_0x3932,_0x5ca6e4=_0x3c9d15();while(!![]){try{const _0x2faab3=parseInt(_0x1048ce(0x28d))/0x1+-parseInt(_0x1048ce(0x253))/0x2*(-parseInt(_0x1048ce(0x1ee))/0x3)+parseInt(_0x1048ce(0x1f7))/0x4+parseInt(_0x1048ce(0x29c))/0x5+-parseInt(_0x1048ce(0x1a0))/0x6*(-parseInt(_0x1048ce(0x159))/0x7)+-parseInt(_0x1048ce(0x274))/0x8+-parseInt(_0x1048ce(0x262))/0x9;if(_0x2faab3===_0x390ed0)break;else _0x5ca6e4['push'](_0x5ca6e4['shift']());}catch(_0x5b41f5){_0x5ca6e4['push'](_0x5ca6e4['shift']());}}}(a57_0x52ed,0xd3d6f));function a57_0x52ed(){const _0x1e5399=['\x20payment\x20status:\x20','Transaction\x20limit\x20exceeded','\x20\x20\x20-\x20method:\x20charge','Captcha\x20confirmation\x20awaited','Operation\x20completed\x20successfully','payment.success','end','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','ğŸ“\x20Encrypted\x20data\x20length:','date_success','currency','\x20status\x20check\x20#','application/json','ğŸ›‘\x20Stopped\x20','ğŸ“Š\x20Checking\x20','logShopWebhookError','default','\x20failed\x20for\x20payment\x20','delete','-----BEGIN','logWhiteDomainError','ğŸ“\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','join','âŒ\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','shop','visaPrivateKeyPath','validateKeyFiles','LookUp\x20number\x20of\x20attempts\x20exceeded','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','\x20is\x20final\x20(','scheduleStatusChecks','Error\x20details:','****\x20****\x20****\x20','MasterCard\x20webhook\x20sent\x20to\x20','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','message','ğŸ’³\x20Detected\x20MasterCard\x20(starts\x20with\x205)',',\x20id=','ğŸ”\x20AES\x20IV\x20length:','decryptResponse','/charge_decrypt','../telegramBotService','\x20payment:\x20','hasOwnProperty','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','Sender\x27s\x20CVV\x20card\x20is\x20required','ğŸ”\x20VISA\x20Public\x20key\x20path:','Payment\x20cancellation\x20is\x20being\x20processed','logShopWebhookSent','stringify','ğŸ§¹\x20Clearing\x20','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','getOwnPropertyNames','desc','visaApiUrl','ğŸ“\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','âœ…\x20Scheduled\x20','âœ…\x20Payment\x20','push','===\x20API\x20RESPONSE\x20===','âš ï¸\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','Payment\x20System/1.0','Test\x20payment','paymentStatuses','maskCardNumber','none','ğŸ“\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','last_name','readFileSync','35118mrBWeM','__importStar','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','-----END','Payment\x20confirmation\x20time\x20has\x20expired','webhookUrl','aes-256-ctr','âœ…\x20MasterCard\x20key\x20files\x20validated\x20successfully','The\x20card\x20does\x20not\x20exist','1551384xfWlsv','payment.failed','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','âŒ\x20Detailed\x20failure\x20description:\x20','updatePaymentStatus','webhookEvents','No\x20New\x20payment','privateKeyPath','publicKeyPath','merchantPointId','/status_raw','update','===\x20PARSED\x20API\x20RESPONSE\x20===','includes','toUpperCase','visa_private.pem','ğŸ”\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','âŒ\x20Status\x20check\x20#','ğŸ”\x20VISA\x20Public\x20key\x20length:\x20','masterCardMerchantPointId','logWhiteDomainRequest','\x20\x20\x20-\x20sign\x20length:','payment_id','âœ…\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','create','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','\x20status\x20timers\x20for\x20payment\x20','signRSA','trim','defineProperty','settings','cwd','text','Failed\x20to\x20send\x20MasterCard\x20webhook:','âœ…\x20Payment\x20successful','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','amount','decryptAES','Failed\x20payment','paid','status','Payment\x20System/1.0\x20(MasterCard)','failureMessage','âŒ\x20RSA\x20encryption\x20failed:','/status_decrypted','\x20\x20\x20-\x20lang:\x20en','HTTP\x20error!\x20status:\x20','/charge_raw','/charge','ğŸ”\x20Response\x20is\x20encrypted,\x20decrypting...','ğŸ”\x20Using\x20fallback\x20fields\x20for\x20search:\x20','toString','Final:','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','\x20result:','Response\x20Time:','\x20\x20Original:\x20\x22','json','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','getDetailedErrorMessage','log','\x20status\x20check\x20error:','Status:','ğŸ”\x20AES\x20key\x20and\x20IV\x20generated','ğŸ“\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','ğŸ”\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','length','visaPublicKeyPath','Request\x20data\x20error','Awaiting\x20confirmation\x20by\x20ivr\x20call','âœ…\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','warn','ğŸ§¹\x20Card\x20holder\x20names\x20cleaned:','\x20\x20\x20Status:\x20','Cash\x20payment\x20is\x20expected\x20at\x20TCO','createDecipheriv','\x20status\x20checks\x20for\x20payment\x20','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','\x20\x20\x20-\x20merchant_point_id:','processCardPayment','parse',',\x20paymentId=','\x20characters','ğŸ”\x20MasterCard\x20API\x20URL:','ğŸ“\x20Decrypted\x20webhook\x20data:','âŒ\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','gatewayOrderId','__esModule','Awaiting\x20confirmation\x20in\x20the\x20application','ğŸ”\x20MasterCard\x20Private\x20key\x20length:\x20','processWebhook','172SwbaNR','isFinalStatus','then','ms)','\x20API:\x20','unknown','Status\x20','ğŸ”\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','ğŸ”\x20Using\x20','Cancellation\x20is\x20not\x20possible','ğŸ“\x20Data\x20to\x20sign\x20length:','Payment\x20returned','PENDING','/status','âŒ\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','33695631bVsmJg','base64','sign','configurable','getCardTypeAndApi','encryptAES','masterCardApiUrl','ğŸ¯\x20Using\x20','first_name','__createBinding','3DS\x20verification\x20required','âš ï¸\x20Expected\x20VISA\x20public\x20key:\x20','crypto','âš ï¸\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','PAID','from','...','ğŸ”\x20MasterCard\x20Public\x20key\x20path:','2056440zARnpR','paymentId','5000000000000000','Unknown\x20error','ğŸ“Š\x20Status\x20check\x20result:','charge','RSA_PKCS1_PADDING','Card\x20Holder:','Recipient\x20data\x20required','HTTP\x20','âš ï¸\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','findUnique','Unsuccessful\x20payment','visaMerchantPointId','âš ï¸\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','âŒ\x20PHP\x20decryptor\x20request\x20failed:','generateAESKey','resolve','ğŸ“¤\x20Sending\x20request\x20to\x20API...','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','https://api2.trapay.uk/decrypt.php','toLowerCase','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','Payment\x20pending\x20verification','privateDecrypt','438963KfIWBV','ğŸ“Š\x20','FAILED','createCipheriv',':\x20Unknown\x20status\x20code','checkPaymentStatus','prototype','randomBytes','number','shopId',',\x20body:\x20','LookUp\x20code\x20sent','VisaMasterCardService','orderId','\x20for\x20payment\x20','8451850bGUnOP','../../config/database','existsSync','POST','SHA256','ğŸ“\x20Final\x20request\x20structure:','ğŸ“\x20Encrypted\x20key\x20length:','path','cardType','\x20with\x20status\x20','Payment\x20is\x20being\x20processed','visa_public.pem','3DS\x20URL:','\x20|\x20Response:\x20',',\x20Final:\x20','/status_decrypt','clearStatusTimers','__setModuleDefault','charAt','Payment\x20ID:','failed','3ds_url','keys','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','LookUp\x20code\x20verified','ğŸ’¾\x20Saving\x20failure\x20message:\x20','loggerService','card_type','psp_public.pem','\x20(from:\x20order_id=','4706849AewuJO','Error\x20parsing\x20webhook\x20events:','Failed\x20to\x20check\x20','stopAllStatusChecks','Number\x20of\x20attempts\x20exceeded','info','ğŸ”\x20Using\x20provided\x20card\x20type:\x20','Return\x20URL:','createSign','https://api.paydmeth.com/api','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','error','key','constants','Invalid\x20expiration\x20date','LookUp\x20not\x20confirmed','âš ï¸\x20Expected\x20VISA\x20private\x20key:\x20','\x20(from:\x20status=','ğŸ›‘\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','âŒ\x20VISA/MasterCard\x20key\x20validation\x20failed:','ğŸ”\x203DS\x20verification\x20required','substring','Result\x20URL:','MASTERCARD','ğŸ“\x20Signature\x20length:','ğŸ’¾\x20Payment\x20data\x20prepared','ğŸ”\x20','description','HTTP\x20Status:','replace','Webhook\x20event\x20','customerEmail','),\x20stopping\x20status\x20checks','Payment\x20confirmation\x20required','âŒ\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','customerName','set','sendPaymentNotifications','ğŸ’³\x20Unknown\x20card\x20type\x20(starts\x20with\x20','Sender\x20information\x20required','cvv',',\x20final=','\x20payment_id\x20for\x20search:\x20','Method\x20not\x20allowed','sendShopWebhook','âŒ\x20RSA\x20signing\x20failed:','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','final','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','order_id','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','decryptResponsePhp','ğŸ“\x20Data\x20length:','No\x20Error\x20executing\x20request','\x20\x20Cleaned:\x20\x20\x22','ğŸ’³\x20VISA/MasterCard\x20service\x20initialized','ğŸ“Š\x20Status\x20check\x20#','\x20not\x20enabled\x20for\x20shop\x20','now','1111','statusCheckTimers','Payment\x20prohibited','âŒ\x20Failed\x20to\x20decrypt\x20status\x20response:','writable','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','call','forEach','utf8','getOwnPropertyDescriptor','logWhiteDomainResponse','12SpNhlp','/charge_decrypted','****','ğŸ”„\x20Processing\x20MasterCard\x20webhook\x20data:','Another\x20unknown\x20error','payment','VISA','\x20webhook\x20extracted\x20data:','isArray'];a57_0x52ed=function(){return _0x1e5399;};return a57_0x52ed();}var __createBinding=this&&this[a57_0x464a4e(0x26b)]||(Object['create']?function(_0x440a69,_0x47764d,_0x209208,_0x41cfdc){const _0x555a3b=a57_0x464a4e;if(_0x41cfdc===undefined)_0x41cfdc=_0x209208;var _0x2e95a6=Object[_0x555a3b(0x19e)](_0x47764d,_0x209208);(!_0x2e95a6||('get'in _0x2e95a6?!_0x47764d[_0x555a3b(0x24f)]:_0x2e95a6[_0x555a3b(0x199)]||_0x2e95a6[_0x555a3b(0x265)]))&&(_0x2e95a6={'enumerable':!![],'get':function(){return _0x47764d[_0x209208];}}),Object[_0x555a3b(0x215)](_0x440a69,_0x41cfdc,_0x2e95a6);}:function(_0x307bfd,_0x539f98,_0x57fd40,_0x38feda){if(_0x38feda===undefined)_0x38feda=_0x57fd40;_0x307bfd[_0x38feda]=_0x539f98[_0x57fd40];}),__setModuleDefault=this&&this[a57_0x464a4e(0x14c)]||(Object[a57_0x464a4e(0x20f)]?function(_0x5dbfd5,_0x2d44c9){Object['defineProperty'](_0x5dbfd5,'default',{'enumerable':!![],'value':_0x2d44c9});}:function(_0x5deaa9,_0x3a2576){_0x5deaa9['default']=_0x3a2576;}),__importStar=this&&this[a57_0x464a4e(0x1ef)]||(function(){var _0x5f23d8=function(_0x121244){const _0xbabfd2=a57_0x3932;return _0x5f23d8=Object[_0xbabfd2(0x1dd)]||function(_0x3d8680){const _0x11646f=_0xbabfd2;var _0x340cf0=[];for(var _0x2f3f28 in _0x3d8680)if(Object[_0x11646f(0x293)][_0x11646f(0x1d4)][_0x11646f(0x19b)](_0x3d8680,_0x2f3f28))_0x340cf0[_0x340cf0[_0x11646f(0x23a)]]=_0x2f3f28;return _0x340cf0;},_0x5f23d8(_0x121244);};return function(_0x110775){const _0x36561a=a57_0x3932;if(_0x110775&&_0x110775[_0x36561a(0x24f)])return _0x110775;var _0x5c4c5f={};if(_0x110775!=null){for(var _0x4cbb48=_0x5f23d8(_0x110775),_0x568fb8=0x0;_0x568fb8<_0x4cbb48[_0x36561a(0x23a)];_0x568fb8++)if(_0x4cbb48[_0x568fb8]!==_0x36561a(0x1b9))__createBinding(_0x5c4c5f,_0x110775,_0x4cbb48[_0x568fb8]);}return __setModuleDefault(_0x5c4c5f,_0x110775),_0x5c4c5f;};}()),__importDefault=this&&this['__importDefault']||function(_0x13ece3){return _0x13ece3&&_0x13ece3['__esModule']?_0x13ece3:{'default':_0x13ece3};};Object[a57_0x464a4e(0x215)](exports,'__esModule',{'value':!![]}),exports[a57_0x464a4e(0x299)]=void 0x0;const crypto_1=__importDefault(require(a57_0x464a4e(0x26e))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a57_0x464a4e(0x142))),loggerService_1=require('../loggerService');function a57_0x3932(_0x38e65b,_0x3a9bf3){_0x38e65b=_0x38e65b-0x140;const _0x52ede7=a57_0x52ed();let _0x3932aa=_0x52ede7[_0x38e65b];return _0x3932aa;}class VisaMasterCardService{constructor(){const _0x4772de=a57_0x464a4e;this[_0x4772de(0x196)]=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0x4772de(0x1fd)},0x1:{'final':![],'description':_0x4772de(0x18f)},0x2:{'final':!![],'description':_0x4772de(0x23c)},0x3:{'final':!![],'description':_0x4772de(0x1a4)},0x4:{'final':!![],'description':_0x4772de(0x280)},0x5:{'final':!![],'description':_0x4772de(0x1f0)},0x6:{'final':!![],'description':_0x4772de(0x25e)},0x7:{'final':!![],'description':_0x4772de(0x1e7)},0x8:{'final':![],'description':'Client\x20OTP\x20confirmation\x20required'},0x9:{'final':![],'description':_0x4772de(0x26c)},0xa:{'final':![],'description':_0x4772de(0x1d6)},0xb:{'final':![],'description':_0x4772de(0x181)},0xc:{'final':![],'description':_0x4772de(0x27c)},0xd:{'final':![],'description':'Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number'},0xe:{'final':![],'description':_0x4772de(0x23d)},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':_0x4772de(0x1ac)},0x11:{'final':![],'description':_0x4772de(0x211)},0x12:{'final':![],'description':_0x4772de(0x250)},0x13:{'final':![],'description':_0x4772de(0x145)},0x14:{'final':![],'description':_0x4772de(0x16c)},0x15:{'final':![],'description':'Expected\x20bitcoin\x20transfer\x20from\x20client'},0x16:{'final':![],'description':_0x4772de(0x28b)},0x18:{'final':![],'description':_0x4772de(0x22d)},0x19:{'final':![],'description':_0x4772de(0x188)},0x1a:{'final':!![],'description':_0x4772de(0x242)},0x1b:{'final':![],'description':'Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code'},0x1c:{'final':![],'description':_0x4772de(0x1b0)},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending'},0x20:{'final':![],'description':_0x4772de(0x245)},0x23:{'final':![],'description':'Sender\x27s\x20card\x20details\x20are\x20required'},0x24:{'final':!![],'description':_0x4772de(0x1f2)},0x25:{'final':!![],'description':_0x4772de(0x197)},0x26:{'final':!![],'description':'The\x20payment\x20status\x20must\x20be\x20clarified\x20manually'},0x27:{'final':!![],'description':'Insufficient\x20funds\x20on\x20the\x20card'},0x28:{'final':!![],'description':_0x4772de(0x1f6)},0x29:{'final':!![],'description':'The\x20card\x20is\x20lost\x20or\x20stolen'},0x2a:{'final':!![],'description':_0x4772de(0x167)},0x2b:{'final':!![],'description':_0x4772de(0x1aa)},0x2c:{'final':!![],'description':'The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank'},0x2d:{'final':!![],'description':_0x4772de(0x21e)},0x2e:{'final':!![],'description':'Unsuccessful\x20payment'},0x2f:{'final':!![],'description':'Unsuccessful\x20payment'},0x30:{'final':!![],'description':_0x4772de(0x28a)},0x31:{'final':![],'description':_0x4772de(0x17b)},0x32:{'final':!![],'description':_0x4772de(0x185)},0x33:{'final':!![],'description':'Failed\x20payment'},0x34:{'final':!![],'description':'Failed\x20payment'},0x35:{'final':!![],'description':_0x4772de(0x21e)},0x36:{'final':!![],'description':_0x4772de(0x21e)},0x37:{'final':!![],'description':'Failed\x20payment'},0x38:{'final':!![],'description':_0x4772de(0x25c)},0x39:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank'},0x3a:{'final':![],'description':_0x4772de(0x298)},0x3b:{'final':!![],'description':_0x4772de(0x153)},0x3c:{'final':!![],'description':_0x4772de(0x15d)},0x3d:{'final':!![],'description':_0x4772de(0x163)},0x3e:{'final':!![],'description':_0x4772de(0x232)},0x3f:{'final':!![],'description':'Payment\x20returned'},0x40:{'final':![],'description':_0x4772de(0x168)},0x41:{'final':!![],'description':_0x4772de(0x1c4)},0x42:{'final':![],'description':_0x4772de(0x1d8)},0x43:{'final':!![],'description':_0x4772de(0x152)},0x44:{'final':![],'description':_0x4772de(0x26c)},0x45:{'final':!![],'description':_0x4772de(0x21e)},0x46:{'final':!![],'description':_0x4772de(0x21e)},0x47:{'final':!![],'description':_0x4772de(0x1c5)},0x64:{'final':!![],'description':_0x4772de(0x1ad)}},this[_0x4772de(0x268)]=_0x4772de(0x162),this[_0x4772de(0x20a)]=0x744,this[_0x4772de(0x1fe)]=path_1[_0x4772de(0x1b9)][_0x4772de(0x1bf)](process[_0x4772de(0x217)](),'keys','private.pem'),this['publicKeyPath']=path_1[_0x4772de(0x1b9)][_0x4772de(0x1bf)](process[_0x4772de(0x217)](),'keys',_0x4772de(0x157)),this[_0x4772de(0x1df)]=_0x4772de(0x162),this[_0x4772de(0x281)]=0x6b7,this[_0x4772de(0x1c2)]=path_1[_0x4772de(0x1b9)][_0x4772de(0x1bf)](process[_0x4772de(0x217)](),'keys',_0x4772de(0x206)),this[_0x4772de(0x23b)]=path_1[_0x4772de(0x1b9)]['join'](process[_0x4772de(0x217)](),_0x4772de(0x151),_0x4772de(0x146)),console[_0x4772de(0x234)](_0x4772de(0x191)),console['log'](_0x4772de(0x24b),this[_0x4772de(0x268)]),console[_0x4772de(0x234)]('ğŸ”\x20VISA\x20API\x20URL:',this[_0x4772de(0x1df)]),console['log']('ğŸ”\x20MasterCard\x20Private\x20key\x20path:',this[_0x4772de(0x1fe)]),console[_0x4772de(0x234)](_0x4772de(0x273),this[_0x4772de(0x1ff)]),console[_0x4772de(0x234)]('ğŸ”\x20VISA\x20Private\x20key\x20path:',this[_0x4772de(0x1c2)]),console[_0x4772de(0x234)](_0x4772de(0x1d7),this['visaPublicKeyPath']),this['validateKeyFiles']();}[a57_0x464a4e(0x233)](_0x3b0c6b,_0x343306){const _0x16ea88=a57_0x464a4e,_0x35d1d5=this[_0x16ea88(0x1e8)][_0x3b0c6b];let _0x2dba29='';_0x35d1d5?_0x2dba29='Status\x20'+_0x3b0c6b+':\x20'+_0x35d1d5[_0x16ea88(0x175)]:_0x2dba29=_0x16ea88(0x259)+_0x3b0c6b+_0x16ea88(0x291);if(_0x343306&&_0x343306['trim']()){const _0x5e620c=_0x343306[_0x16ea88(0x214)]();(!_0x35d1d5||_0x5e620c['toLowerCase']()!==_0x35d1d5[_0x16ea88(0x175)]['toLowerCase']())&&(_0x2dba29+=_0x16ea88(0x148)+_0x5e620c);}return _0x2dba29;}[a57_0x464a4e(0x254)](_0x4f76c5){const _0x3c3312=a57_0x464a4e,_0x2f0973=this['paymentStatuses'][_0x4f76c5];return _0x2f0973?_0x2f0973[_0x3c3312(0x189)]:!![];}[a57_0x464a4e(0x266)](_0xe304de){const _0x3987bd=a57_0x464a4e,_0x3e2235=_0xe304de[_0x3987bd(0x14d)](0x0);if(_0x3e2235==='4')return console[_0x3987bd(0x234)]('ğŸ’³\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)'),{'cardType':'VISA','apiUrl':this[_0x3987bd(0x1df)],'privateKeyPath':this['visaPrivateKeyPath'],'publicKeyPath':this[_0x3987bd(0x23b)],'merchantPointId':this['visaMerchantPointId']};else return _0x3e2235==='5'?(console[_0x3987bd(0x234)](_0x3987bd(0x1cd)),{'cardType':_0x3987bd(0x171),'apiUrl':this[_0x3987bd(0x268)],'privateKeyPath':this[_0x3987bd(0x1fe)],'publicKeyPath':this[_0x3987bd(0x1ff)],'merchantPointId':this['masterCardMerchantPointId']}):(console[_0x3987bd(0x234)](_0x3987bd(0x180)+_0x3e2235+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':'MASTERCARD','apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x3987bd(0x1fe)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x3987bd(0x20a)]});}[a57_0x464a4e(0x1c3)](){const _0x3751c3=a57_0x464a4e;try{if(!fs_1[_0x3751c3(0x1b9)]['existsSync'](this['privateKeyPath']))throw new Error(_0x3751c3(0x287)+this['privateKeyPath']);if(!fs_1[_0x3751c3(0x1b9)][_0x3751c3(0x29e)](this[_0x3751c3(0x1ff)]))throw new Error(_0x3751c3(0x1d5)+this['publicKeyPath']);const _0x2e69ec=fs_1[_0x3751c3(0x1b9)][_0x3751c3(0x1ed)](this[_0x3751c3(0x1fe)],'utf8')['trim'](),_0x5d0cfa=fs_1[_0x3751c3(0x1b9)][_0x3751c3(0x1ed)](this['publicKeyPath'],_0x3751c3(0x19d))[_0x3751c3(0x214)]();if(!_0x2e69ec['includes'](_0x3751c3(0x1bc))||!_0x2e69ec['includes'](_0x3751c3(0x1f1)))throw new Error(_0x3751c3(0x18c));if(!_0x5d0cfa[_0x3751c3(0x204)](_0x3751c3(0x1bc))||!_0x5d0cfa[_0x3751c3(0x204)](_0x3751c3(0x1f1)))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x3751c3(0x234)](_0x3751c3(0x1f5)),console[_0x3751c3(0x234)](_0x3751c3(0x251)+_0x2e69ec[_0x3751c3(0x23a)]+_0x3751c3(0x24a)),console['log']('ğŸ”\x20MasterCard\x20Public\x20key\x20length:\x20'+_0x5d0cfa[_0x3751c3(0x23a)]+_0x3751c3(0x24a));if(fs_1[_0x3751c3(0x1b9)][_0x3751c3(0x29e)](this[_0x3751c3(0x1c2)])&&fs_1[_0x3751c3(0x1b9)][_0x3751c3(0x29e)](this[_0x3751c3(0x23b)])){const _0x1dd395=fs_1[_0x3751c3(0x1b9)][_0x3751c3(0x1ed)](this[_0x3751c3(0x1c2)],_0x3751c3(0x19d))[_0x3751c3(0x214)](),_0x336360=fs_1[_0x3751c3(0x1b9)][_0x3751c3(0x1ed)](this[_0x3751c3(0x23b)],_0x3751c3(0x19d))['trim']();(!_0x1dd395[_0x3751c3(0x204)](_0x3751c3(0x1bc))||!_0x1dd395['includes'](_0x3751c3(0x1f1)))&&console['warn'](_0x3751c3(0x282)),(!_0x336360[_0x3751c3(0x204)](_0x3751c3(0x1bc))||!_0x336360['includes']('-----END'))&&console[_0x3751c3(0x23f)](_0x3751c3(0x27e)),console[_0x3751c3(0x234)]('âœ…\x20VISA\x20key\x20files\x20validated\x20successfully'),console[_0x3751c3(0x234)]('ğŸ”\x20VISA\x20Private\x20key\x20length:\x20'+_0x1dd395[_0x3751c3(0x23a)]+_0x3751c3(0x24a)),console[_0x3751c3(0x234)](_0x3751c3(0x209)+_0x336360[_0x3751c3(0x23a)]+'\x20characters');}else console['warn'](_0x3751c3(0x1e5)),console[_0x3751c3(0x23f)](_0x3751c3(0x169)+this[_0x3751c3(0x1c2)]),console[_0x3751c3(0x23f)](_0x3751c3(0x26d)+this['visaPublicKeyPath']);}catch(_0x1c595c){console[_0x3751c3(0x164)](_0x3751c3(0x16d),_0x1c595c);throw _0x1c595c;}}['generateAESKey'](){const _0x5c7086=a57_0x464a4e,_0x11eb7b=crypto_1[_0x5c7086(0x1b9)][_0x5c7086(0x294)](0x20),_0x447676=crypto_1[_0x5c7086(0x1b9)][_0x5c7086(0x294)](0x10);return{'key':_0x11eb7b,'iv':_0x447676};}['encryptAES'](_0x13f078,_0x151c21,_0x1c1091){const _0x31dce8=a57_0x464a4e,_0x1ab88c=crypto_1['default'][_0x31dce8(0x290)](_0x31dce8(0x1f4),_0x151c21,_0x1c1091);let _0x3d4be7=_0x1ab88c['update'](_0x13f078,_0x31dce8(0x19d),_0x31dce8(0x263));return _0x3d4be7+=_0x1ab88c['final'](_0x31dce8(0x263)),_0x3d4be7;}['encryptRSA'](_0x465fa0,_0x185f5b,_0x3c515b){const _0x38caca=a57_0x464a4e;try{const _0x1b1ae3=fs_1['default'][_0x38caca(0x1ed)](_0x3c515b,_0x38caca(0x19d))['trim'](),_0x1488db={'iv':_0x185f5b['toString'](_0x38caca(0x263)),'key':_0x465fa0[_0x38caca(0x22b)](_0x38caca(0x263))},_0x3846a1=JSON[_0x38caca(0x1da)](_0x1488db);console[_0x38caca(0x234)]('ğŸ”\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x3846a1['length']);const _0x57d06f=crypto_1[_0x38caca(0x1b9)]['publicEncrypt']({'key':_0x1b1ae3,'padding':crypto_1['default'][_0x38caca(0x166)][_0x38caca(0x27a)]},Buffer[_0x38caca(0x271)](_0x3846a1));return console[_0x38caca(0x234)]('âœ…\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x57d06f[_0x38caca(0x23a)]),_0x57d06f['toString'](_0x38caca(0x263));}catch(_0x4d1b30){console['error'](_0x38caca(0x223),_0x4d1b30);throw new Error(_0x38caca(0x19a));}}['signRSA'](_0x498ec7,_0x1a85d2){const _0x24e1ba=a57_0x464a4e;try{const _0x26bf64=fs_1[_0x24e1ba(0x1b9)]['readFileSync'](_0x1a85d2,_0x24e1ba(0x19d))[_0x24e1ba(0x214)](),_0x4d3d2b=crypto_1[_0x24e1ba(0x1b9)][_0x24e1ba(0x161)](_0x24e1ba(0x2a0));_0x4d3d2b['update'](_0x498ec7),_0x4d3d2b[_0x24e1ba(0x1af)]();const _0x4259f0=_0x4d3d2b[_0x24e1ba(0x264)](_0x26bf64,_0x24e1ba(0x263));return console[_0x24e1ba(0x234)]('ğŸ”\x20RSA\x20signing\x20successful'),console[_0x24e1ba(0x234)](_0x24e1ba(0x25d),_0x498ec7[_0x24e1ba(0x23a)]),console[_0x24e1ba(0x234)](_0x24e1ba(0x172),_0x4259f0[_0x24e1ba(0x23a)]),_0x4259f0;}catch(_0x1588ab){console[_0x24e1ba(0x164)](_0x24e1ba(0x187),_0x1588ab),console[_0x24e1ba(0x164)]('âŒ\x20Data\x20being\x20signed:',_0x498ec7[_0x24e1ba(0x16f)](0x0,0xc8)+_0x24e1ba(0x272));throw new Error(_0x24e1ba(0x1cb));}}[a57_0x464a4e(0x21d)](_0x5532ba,_0x2f39f4,_0x36e413){const _0x5cb81f=a57_0x464a4e,_0x5d84fb=crypto_1['default'][_0x5cb81f(0x243)]('aes-256-ctr',_0x2f39f4,_0x36e413);let _0x51764c=_0x5d84fb[_0x5cb81f(0x202)](_0x5532ba,_0x5cb81f(0x263),'utf8');return _0x51764c+=_0x5d84fb[_0x5cb81f(0x189)](_0x5cb81f(0x19d)),_0x51764c;}async[a57_0x464a4e(0x18d)](_0x28ea8a,_0x156ece,_0x3f0cdb=a57_0x464a4e(0x171)){const _0x546c7b=a57_0x464a4e;try{const _0x289737=await fetch(_0x546c7b(0x288),{'method':_0x546c7b(0x29f),'headers':{'Content-Type':_0x546c7b(0x1b5)},'body':JSON['stringify']({'info':_0x28ea8a,'key':_0x156ece,'card_type':_0x3f0cdb[_0x546c7b(0x289)]()})});if(!_0x289737['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x289737['text']();}catch(_0x5aa5ca){console[_0x546c7b(0x164)](_0x546c7b(0x283),_0x5aa5ca);throw new Error(_0x546c7b(0x1dc));}}[a57_0x464a4e(0x1d0)](_0x2bd744,_0x8dbd7f){const _0x25f571=a57_0x464a4e;try{const _0x1d02ba=fs_1[_0x25f571(0x1b9)][_0x25f571(0x1ed)](this[_0x25f571(0x1fe)],_0x25f571(0x19d))[_0x25f571(0x214)](),_0x5298fd=crypto_1['default'][_0x25f571(0x28c)](_0x1d02ba,Buffer[_0x25f571(0x271)](_0x8dbd7f,'base64')),_0x237d19=JSON['parse'](_0x5298fd[_0x25f571(0x22b)]()),_0x294c7d=Buffer[_0x25f571(0x271)](_0x237d19[_0x25f571(0x165)],_0x25f571(0x263)),_0x36a2ef=Buffer[_0x25f571(0x271)](_0x237d19['iv'],_0x25f571(0x263));return this[_0x25f571(0x21d)](_0x2bd744,_0x294c7d,_0x36a2ef);}catch(_0x5f1ec9){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a57_0x464a4e(0x247)](_0x1340e2){const _0x14db07=a57_0x464a4e,{paymentId:_0x5e36fb,orderId:_0x227fc8,amount:_0x1c071f,currency:_0x4765cc,cardData:_0x1bfb42,resultUrl:_0x4a13b3,returnUrl:_0x464486,cardHolder:_0x406312,browser:_0x22012b}=_0x1340e2;console[_0x14db07(0x234)](_0x14db07(0x210)),console[_0x14db07(0x234)]('Payment\x20ID:',_0x5e36fb),console[_0x14db07(0x234)]('Order\x20ID:',_0x227fc8),console['log']('Amount:',_0x1c071f,_0x4765cc),console[_0x14db07(0x234)]('Card\x20Number:',this[_0x14db07(0x1e9)](_0x1bfb42[_0x14db07(0x295)])),console['log'](_0x14db07(0x27b),_0x406312[_0x14db07(0x26a)]+'\x20'+_0x406312['last_name']),console[_0x14db07(0x234)](_0x14db07(0x160),_0x464486),console[_0x14db07(0x234)](_0x14db07(0x170),_0x4a13b3);const _0x1faec3=this['getCardTypeAndApi'](_0x1bfb42['number']);console['log'](_0x14db07(0x269)+_0x1faec3['cardType']+_0x14db07(0x257)+_0x1faec3['apiUrl']),console[_0x14db07(0x234)]('ğŸ”\x20Using\x20keys:\x20'+_0x1faec3[_0x14db07(0x1fe)]+',\x20'+_0x1faec3[_0x14db07(0x1ff)]);const _0x59c115={..._0x406312,'first_name':_0x406312['first_name']?.[_0x14db07(0x177)](/[\t\n\r\f\v]/g,'\x20')['trim']()||'','last_name':_0x406312[_0x14db07(0x1ec)]?.[_0x14db07(0x177)](/[\t\n\r\f\v]/g,'\x20')[_0x14db07(0x214)]()||''};console['log'](_0x14db07(0x240)),console[_0x14db07(0x234)](_0x14db07(0x230)+_0x406312[_0x14db07(0x26a)]+'\x22\x20|\x20\x22'+_0x406312['last_name']+'\x22'),console[_0x14db07(0x234)](_0x14db07(0x190)+_0x59c115[_0x14db07(0x26a)]+'\x22\x20|\x20\x22'+_0x59c115['last_name']+'\x22');const _0x43efe4={'amount':_0x1c071f,'currency':_0x4765cc['toUpperCase'](),'order_id':_0x227fc8,'result_url':_0x4a13b3,'return_url':_0x464486,'country':'','card':{'number':_0x1bfb42[_0x14db07(0x295)],'expire_month':_0x1bfb42['expire_month'],'expire_year':_0x1bfb42['expire_year'],'cvv':_0x1bfb42[_0x14db07(0x182)]},'card_holder':_0x59c115,'browser':_0x22012b},_0x3f9ad2=JSON[_0x14db07(0x1da)](_0x43efe4);console[_0x14db07(0x234)](_0x14db07(0x173)),console[_0x14db07(0x234)](_0x14db07(0x1be)),console['log'](_0x3f9ad2),console[_0x14db07(0x234)](_0x14db07(0x18e),_0x3f9ad2[_0x14db07(0x23a)]);try{const {key:_0x1cdb23,iv:_0x5a0c32}=this[_0x14db07(0x284)]();console[_0x14db07(0x234)](_0x14db07(0x237)),console[_0x14db07(0x234)]('ğŸ”\x20AES\x20key\x20length:',_0x1cdb23['length']),console[_0x14db07(0x234)](_0x14db07(0x1cf),_0x5a0c32[_0x14db07(0x23a)]);const _0x1670f8=this[_0x14db07(0x267)](_0x3f9ad2,_0x1cdb23,_0x5a0c32);console[_0x14db07(0x234)]('ğŸ”\x20Data\x20encrypted\x20with\x20AES'),console[_0x14db07(0x234)](_0x14db07(0x1b1),_0x1670f8[_0x14db07(0x23a)]);const _0xc49407=this['encryptRSA'](_0x1cdb23,_0x5a0c32,_0x1faec3[_0x14db07(0x1ff)]);console[_0x14db07(0x234)](_0x14db07(0x239)),console['log'](_0x14db07(0x141),_0xc49407[_0x14db07(0x23a)]);const _0x45c45c=this[_0x14db07(0x213)](_0x3f9ad2,_0x1faec3[_0x14db07(0x1fe)]);console[_0x14db07(0x234)]('ğŸ”\x20Data\x20signed\x20with\x20RSA'),console[_0x14db07(0x234)](_0x14db07(0x172),_0x45c45c['length']);const _0x2ba446={'merchant_point_id':_0x1faec3[_0x14db07(0x200)],'method':_0x14db07(0x279),'info':_0x1670f8,'key':_0xc49407,'sign':_0x45c45c,'lang':'en'};console[_0x14db07(0x234)](_0x14db07(0x286)),console[_0x14db07(0x234)](_0x14db07(0x140)),console[_0x14db07(0x234)](_0x14db07(0x246),_0x1faec3[_0x14db07(0x200)]),console[_0x14db07(0x234)](_0x14db07(0x1ab)),console['log']('\x20\x20\x20-\x20info\x20length:',_0x1670f8['length']),console[_0x14db07(0x234)]('\x20\x20\x20-\x20key\x20length:',_0xc49407[_0x14db07(0x23a)]),console['log'](_0x14db07(0x20c),_0x45c45c[_0x14db07(0x23a)]),console[_0x14db07(0x234)](_0x14db07(0x225)),loggerService_1[_0x14db07(0x155)]['logWhiteDomainRequest'](_0x1faec3[_0x14db07(0x143)][_0x14db07(0x289)](),_0x14db07(0x228),'POST',{'merchant_point_id':_0x1faec3[_0x14db07(0x200)],'method':_0x14db07(0x279),'lang':'en'});const _0x5652f3=Date[_0x14db07(0x194)](),_0x2e2fdb=await fetch(_0x1faec3['apiUrl'],{'method':_0x14db07(0x29f),'headers':{'Content-Type':_0x14db07(0x1b5),'Accept':'application/json','User-Agent':_0x14db07(0x1e6)},'body':JSON['stringify'](_0x2ba446)}),_0x141939=Date[_0x14db07(0x194)]()-_0x5652f3;console[_0x14db07(0x234)](_0x14db07(0x1e4)),console[_0x14db07(0x234)]('Status:',_0x2e2fdb[_0x14db07(0x220)]),console[_0x14db07(0x234)](_0x14db07(0x22f),_0x141939+'ms');if(!_0x2e2fdb['ok']){const _0xeec1a1=await _0x2e2fdb['text']();console[_0x14db07(0x164)](_0x14db07(0x176),_0x2e2fdb[_0x14db07(0x220)]),console['error']('Response\x20Body:',_0xeec1a1),loggerService_1[_0x14db07(0x155)][_0x14db07(0x19f)](_0x1faec3[_0x14db07(0x143)][_0x14db07(0x289)](),_0x14db07(0x227),_0x2e2fdb[_0x14db07(0x220)],_0xeec1a1,_0x141939),loggerService_1[_0x14db07(0x155)][_0x14db07(0x1bd)](_0x1faec3['cardType'][_0x14db07(0x289)](),_0x14db07(0x228),_0x14db07(0x27d)+_0x2e2fdb['status']+':\x20'+_0xeec1a1);throw new Error(_0x14db07(0x226)+_0x2e2fdb[_0x14db07(0x220)]+_0x14db07(0x297)+_0xeec1a1);}const _0x3764f7=await _0x2e2fdb['json']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1faec3['cardType'][_0x14db07(0x289)](),_0x14db07(0x227),_0x2e2fdb[_0x14db07(0x220)],_0x3764f7,_0x141939),console['log'](_0x14db07(0x203));let _0x29b92a=_0x3764f7;if(_0x3764f7[_0x14db07(0x15e)]&&_0x3764f7[_0x14db07(0x165)]&&_0x3764f7[_0x14db07(0x264)]){console[_0x14db07(0x234)](_0x14db07(0x229));try{const _0x21b701=await this[_0x14db07(0x18d)](_0x3764f7['info'],_0x3764f7[_0x14db07(0x165)],_0x1faec3[_0x14db07(0x143)]);_0x29b92a=JSON[_0x14db07(0x248)](_0x21b701),console['log'](_0x14db07(0x23e)),loggerService_1[_0x14db07(0x155)][_0x14db07(0x19f)](_0x1faec3['cardType'][_0x14db07(0x289)](),_0x14db07(0x1a1),_0x2e2fdb['status'],_0x29b92a,_0x141939),console[_0x14db07(0x234)]('ğŸ“\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x3378b3){console[_0x14db07(0x164)](_0x14db07(0x24d),_0x3378b3),loggerService_1[_0x14db07(0x155)][_0x14db07(0x1bd)](_0x1faec3[_0x14db07(0x143)][_0x14db07(0x289)](),_0x14db07(0x1d1),'Decryption\x20failed:\x20'+_0x3378b3),_0x29b92a=_0x3764f7;}}else loggerService_1['loggerService'][_0x14db07(0x19f)](_0x1faec3['cardType'][_0x14db07(0x289)](),'/charge_decrypted',_0x2e2fdb[_0x14db07(0x220)],_0x29b92a,_0x141939),console[_0x14db07(0x234)]('ğŸ“\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x14db07(0x234)](_0x14db07(0x236),_0x29b92a[_0x14db07(0x220)]),console['log'](_0x14db07(0x22c),_0x29b92a[_0x14db07(0x189)]),console[_0x14db07(0x234)](_0x14db07(0x14e),_0x29b92a[_0x14db07(0x20d)]),console[_0x14db07(0x234)](_0x14db07(0x147),_0x29b92a['3ds_url']||_0x14db07(0x1ea));if(_0x29b92a[_0x14db07(0x220)]===0x64&&_0x29b92a[_0x14db07(0x189)]===0x1)return console['log'](_0x14db07(0x21a)),{'gateway_payment_id':_0x29b92a[_0x14db07(0x20d)]?.[_0x14db07(0x22b)](),'payment_url':_0x464486,'requires_3ds':![],'status':_0x14db07(0x270),'final':!![]};if(_0x29b92a[_0x14db07(0x150)])return console['log'](_0x14db07(0x16e)),this[_0x14db07(0x1c7)](_0x5e36fb,_0x227fc8,_0x29b92a['payment_id']?.[_0x14db07(0x22b)]()||_0x227fc8,_0x1faec3[_0x14db07(0x143)]),{'gateway_payment_id':_0x29b92a['payment_id']?.[_0x14db07(0x22b)](),'payment_url':_0x29b92a[_0x14db07(0x150)],'requires_3ds':!![],'threeds_url':_0x29b92a[_0x14db07(0x150)],'status':_0x14db07(0x25f),'final':![]};let _0x502194=this['getDetailedErrorMessage'](_0x29b92a['status'],_0x29b92a[_0x14db07(0x1de)]||_0x29b92a[_0x14db07(0x1cc)]),_0x375796=_0x29b92a['status'],_0x2775e3=this[_0x14db07(0x254)](_0x29b92a[_0x14db07(0x220)]);return console['log'](_0x14db07(0x1c0)+_0x375796+_0x14db07(0x149)+_0x2775e3+',\x20Desc:\x20'+_0x502194),{'gateway_payment_id':_0x29b92a[_0x14db07(0x20d)]?.[_0x14db07(0x22b)](),'payment_url':_0x464486,'requires_3ds':![],'status':'FAILED','final':!![],'errorMessage':_0x502194};}catch(_0x280bb3){console['error'](_0x14db07(0x18a)),console[_0x14db07(0x164)](_0x14db07(0x1c8),_0x280bb3),loggerService_1['loggerService'][_0x14db07(0x1bd)]('visa/mastercard','/charge',_0x280bb3);throw new Error(_0x14db07(0x1f9)+(_0x280bb3 instanceof Error?_0x280bb3[_0x14db07(0x1cc)]:_0x14db07(0x277)));}}async[a57_0x464a4e(0x292)](_0x20c67f,_0x3f08b9,_0x386483=a57_0x464a4e(0x1a6)){const _0x2e0550=a57_0x464a4e;console[_0x2e0550(0x234)](_0x2e0550(0x1b7)+_0x386483+_0x2e0550(0x1a9)+_0x20c67f+'\x20('+_0x3f08b9+')');try{const _0x29a5cb={'payment_id':_0x20c67f,'order_id':_0x3f08b9},_0x2cbe9e=JSON[_0x2e0550(0x1da)](_0x29a5cb),_0x198726=this['getCardTypeAndApi'](_0x386483===_0x2e0550(0x1a6)?'4000000000000000':_0x2e0550(0x276)),{key:_0x45daa3,iv:_0x79105f}=this[_0x2e0550(0x284)](),_0x138f5f=this['encryptAES'](_0x2cbe9e,_0x45daa3,_0x79105f),_0x5ed736=this['encryptRSA'](_0x45daa3,_0x79105f,_0x198726['publicKeyPath']),_0x112453=this[_0x2e0550(0x213)](_0x2cbe9e,_0x198726[_0x2e0550(0x1fe)]),_0x3c7b56={'merchant_point_id':_0x198726[_0x2e0550(0x200)],'method':_0x2e0550(0x220),'info':_0x138f5f,'key':_0x5ed736,'sign':_0x112453,'lang':'en'};loggerService_1[_0x2e0550(0x155)][_0x2e0550(0x20b)](_0x386483['toLowerCase'](),'/status',_0x2e0550(0x29f),{'merchant_point_id':_0x198726[_0x2e0550(0x200)],'method':_0x2e0550(0x220),'lang':'en'});const _0x149ac4=Date[_0x2e0550(0x194)](),_0x3dd9de=await fetch(_0x198726['apiUrl'],{'method':_0x2e0550(0x29f),'headers':{'Content-Type':'application/json','Accept':_0x2e0550(0x1b5),'User-Agent':_0x2e0550(0x1e6)},'body':JSON[_0x2e0550(0x1da)](_0x3c7b56)}),_0x3fa8ba=Date[_0x2e0550(0x194)]()-_0x149ac4;if(!_0x3dd9de['ok']){const _0xc0e9d0=await _0x3dd9de[_0x2e0550(0x218)]();loggerService_1[_0x2e0550(0x155)][_0x2e0550(0x19f)](_0x386483[_0x2e0550(0x289)](),_0x2e0550(0x201),_0x3dd9de[_0x2e0550(0x220)],_0xc0e9d0,_0x3fa8ba);throw new Error(_0x2e0550(0x226)+_0x3dd9de[_0x2e0550(0x220)]);}const _0x466e75=await _0x3dd9de[_0x2e0550(0x231)]();loggerService_1[_0x2e0550(0x155)][_0x2e0550(0x19f)](_0x386483[_0x2e0550(0x289)](),_0x2e0550(0x201),_0x3dd9de[_0x2e0550(0x220)],_0x466e75,_0x3fa8ba);let _0x744fc1=_0x466e75;if(_0x466e75[_0x2e0550(0x15e)]&&_0x466e75[_0x2e0550(0x165)]&&_0x466e75[_0x2e0550(0x264)]){console[_0x2e0550(0x234)](_0x2e0550(0x25a));try{const _0x4fd7c2=await this['decryptResponsePhp'](_0x466e75[_0x2e0550(0x15e)],_0x466e75[_0x2e0550(0x165)],_0x386483);_0x744fc1=JSON[_0x2e0550(0x248)](_0x4fd7c2),console['log']('âœ…\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x2e0550(0x155)][_0x2e0550(0x19f)](_0x386483[_0x2e0550(0x289)](),_0x2e0550(0x224),_0x3dd9de['status'],_0x744fc1,_0x3fa8ba),console[_0x2e0550(0x234)](_0x2e0550(0x1e0));}catch(_0x2de8db){console[_0x2e0550(0x164)](_0x2e0550(0x198),_0x2de8db),loggerService_1[_0x2e0550(0x155)][_0x2e0550(0x1bd)](_0x386483[_0x2e0550(0x289)](),_0x2e0550(0x14a),'Status\x20decryption\x20failed:\x20'+_0x2de8db),_0x744fc1=_0x466e75;}}else loggerService_1['loggerService'][_0x2e0550(0x19f)](_0x386483[_0x2e0550(0x289)](),_0x2e0550(0x224),_0x3dd9de[_0x2e0550(0x220)],_0x744fc1,_0x3fa8ba),console[_0x2e0550(0x234)](_0x2e0550(0x238));console[_0x2e0550(0x234)](_0x2e0550(0x278),{'status':_0x744fc1['status'],'final':_0x744fc1[_0x2e0550(0x189)],'payment_id':_0x744fc1[_0x2e0550(0x20d)],'desc':_0x744fc1[_0x2e0550(0x1de)]});let _0x4e44c2=_0x2e0550(0x25f);if(_0x744fc1[_0x2e0550(0x220)]===0x64&&_0x744fc1[_0x2e0550(0x189)]===0x1)_0x4e44c2='PAID';else{if(_0x744fc1[_0x2e0550(0x189)]===0x0||!this[_0x2e0550(0x254)](_0x744fc1[_0x2e0550(0x220)]))_0x4e44c2=_0x2e0550(0x25f);else _0x744fc1[_0x2e0550(0x189)]===0x1||this[_0x2e0550(0x254)](_0x744fc1[_0x2e0550(0x220)])?_0x4e44c2='FAILED':_0x4e44c2=_0x2e0550(0x25f);}const _0x298dfe=this['getDetailedErrorMessage'](_0x744fc1[_0x2e0550(0x220)],_0x744fc1[_0x2e0550(0x1de)]);return{'status':_0x4e44c2,'final':this[_0x2e0550(0x254)](_0x744fc1[_0x2e0550(0x220)]),'amount':_0x744fc1[_0x2e0550(0x21c)],'currency':_0x744fc1[_0x2e0550(0x1b3)],'date_success':_0x744fc1[_0x2e0550(0x1b2)],'description':_0x298dfe};}catch(_0x60651e){console[_0x2e0550(0x164)](_0x386483+_0x2e0550(0x235),_0x60651e),loggerService_1[_0x2e0550(0x155)][_0x2e0550(0x1bd)](_0x386483[_0x2e0550(0x289)](),_0x2e0550(0x260),_0x60651e);throw new Error(_0x2e0550(0x15b)+_0x386483+_0x2e0550(0x1a9)+(_0x60651e instanceof Error?_0x60651e[_0x2e0550(0x1cc)]:_0x2e0550(0x277)));}}['scheduleStatusChecks'](_0x1506d2,_0x13f019,_0xc00497,_0xd378d6){const _0x4382cf=a57_0x464a4e;console[_0x4382cf(0x234)]('â°\x20Scheduling\x20status\x20checks\x20for\x20'+_0xd378d6+_0x4382cf(0x1d3)+_0x1506d2+'\x20('+_0xc00497+')'),this[_0x4382cf(0x14b)](_0x1506d2);const _0x8d1069=[],_0x480980=0x5*0x3c*0x3e8,_0x4a5515=0x2*0x3c*0x3c*0x3e8,_0x50c2aa=Math['floor'](_0x4a5515/_0x480980);console[_0x4382cf(0x234)]('â°\x20Will\x20check\x20status\x20'+_0x50c2aa+_0x4382cf(0x21b));for(let _0x4909af=0x1;_0x4909af<=_0x50c2aa;_0x4909af++){const _0x3214a9=setTimeout(async()=>{const _0xc62caf=_0x4382cf;console[_0xc62caf(0x234)](_0xc62caf(0x174)+_0xd378d6+_0xc62caf(0x1b4)+_0x4909af+'/'+_0x50c2aa+_0xc62caf(0x29b)+_0x1506d2);try{const _0x5861f2=await this[_0xc62caf(0x292)](_0xc00497,_0x13f019,_0xd378d6);console[_0xc62caf(0x234)](_0xc62caf(0x192)+_0x4909af+_0xc62caf(0x22e),_0x5861f2),_0x5861f2[_0xc62caf(0x189)]&&(console[_0xc62caf(0x234)](_0xc62caf(0x1e2)+_0x1506d2+_0xc62caf(0x1c6)+_0x5861f2[_0xc62caf(0x220)]+_0xc62caf(0x17a)),this[_0xc62caf(0x14b)](_0x1506d2),await this[_0xc62caf(0x1fb)](_0x1506d2,_0x5861f2[_0xc62caf(0x220)],_0x5861f2));}catch(_0x27d477){console[_0xc62caf(0x164)](_0xc62caf(0x208)+_0x4909af+_0xc62caf(0x1ba)+_0x1506d2+':',_0x27d477);}},_0x4909af*_0x480980);_0x8d1069[_0x4382cf(0x1e3)](_0x3214a9);}this['statusCheckTimers'][_0x4382cf(0x17e)](_0x1506d2,_0x8d1069),console['log'](_0x4382cf(0x1e1)+_0x50c2aa+_0x4382cf(0x244)+_0x1506d2);}[a57_0x464a4e(0x14b)](_0x4ae6ae){const _0x325819=a57_0x464a4e,_0x4e074a=this[_0x325819(0x196)]['get'](_0x4ae6ae);_0x4e074a&&(console[_0x325819(0x234)](_0x325819(0x1db)+_0x4e074a[_0x325819(0x23a)]+_0x325819(0x212)+_0x4ae6ae),_0x4e074a[_0x325819(0x19c)]((_0x4c97ee,_0x537ace)=>{clearTimeout(_0x4c97ee);}),this[_0x325819(0x196)][_0x325819(0x1bb)](_0x4ae6ae));}async['updatePaymentStatus'](_0x5a1bae,_0x5c968b,_0x321115){const _0x280538=a57_0x464a4e;try{const _0x5af4de=(await Promise['resolve']()[_0x280538(0x255)](()=>__importStar(require(_0x280538(0x29d)))))['default'],_0x38b486={'status':_0x5c968b[_0x280538(0x205)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x5c968b===_0x280538(0x270)&&(_0x38b486['paidAt']=new Date()),_0x5c968b===_0x280538(0x28f)&&_0x321115[_0x280538(0x175)]&&(_0x38b486[_0x280538(0x222)]=_0x321115['description'],console[_0x280538(0x234)](_0x280538(0x154)+_0x321115[_0x280538(0x175)])),await _0x5af4de['payment'][_0x280538(0x202)]({'where':{'id':_0x5a1bae},'data':_0x38b486}),console[_0x280538(0x234)](_0x280538(0x1e2)+_0x5a1bae+'\x20status\x20updated\x20to\x20'+_0x5c968b),await this[_0x280538(0x17f)](_0x5a1bae,_0x5c968b);}catch(_0x25c2cb){console[_0x280538(0x164)](_0x280538(0x261)+_0x5a1bae+':',_0x25c2cb);}}async[a57_0x464a4e(0x17f)](_0xf35591,_0x25cceb){const _0x57cbb8=a57_0x464a4e;try{const _0x49ba59=(await Promise[_0x57cbb8(0x285)]()[_0x57cbb8(0x255)](()=>__importStar(require(_0x57cbb8(0x29d)))))[_0x57cbb8(0x1b9)],{telegramBotService:_0x16e743}=await Promise[_0x57cbb8(0x285)]()[_0x57cbb8(0x255)](()=>__importStar(require(_0x57cbb8(0x1d2)))),_0x25ad19=await _0x49ba59[_0x57cbb8(0x1a5)][_0x57cbb8(0x27f)]({'where':{'id':_0xf35591},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x25ad19)return;const _0x423d53={'PAID':_0x57cbb8(0x21f),'FAILED':_0x57cbb8(0x14f)},_0x274817=_0x423d53[_0x25cceb];_0x274817&&await _0x16e743['sendPaymentNotification'](_0x25ad19['shopId'],_0x25ad19,_0x274817),await this['sendShopWebhook'](_0x25ad19,_0x25cceb);}catch(_0x5d50d7){console[_0x57cbb8(0x164)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x5d50d7);}}async[a57_0x464a4e(0x186)](_0x330776,_0x146dc7){const _0x30623c=a57_0x464a4e,_0x14d5d4=Date[_0x30623c(0x194)]();try{const _0x3004d4=_0x330776[_0x30623c(0x1c1)],_0x2b9173=_0x3004d4[_0x30623c(0x216)];if(!_0x2b9173?.[_0x30623c(0x1f3)]){console['log']('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x3004d4['id']);return;}const _0x2cf070=_0x146dc7===_0x30623c(0x270)?_0x30623c(0x1ae):_0x30623c(0x1f8);let _0x3177aa=[];if(_0x2b9173['webhookEvents'])try{_0x3177aa=Array[_0x30623c(0x1a8)](_0x2b9173[_0x30623c(0x1fc)])?_0x2b9173[_0x30623c(0x1fc)]:JSON[_0x30623c(0x248)](_0x2b9173[_0x30623c(0x1fc)]);}catch(_0x341874){console[_0x30623c(0x164)](_0x30623c(0x15a),_0x341874),_0x3177aa=[];}if(!_0x3177aa[_0x30623c(0x204)](_0x2cf070)){console['log'](_0x30623c(0x178)+_0x2cf070+_0x30623c(0x193)+_0x3004d4['id']);return;}const _0x40636b={'event':_0x2cf070,'payment':{'id':_0x330776['id'],'order_id':_0x330776[_0x30623c(0x29a)],'gateway_order_id':_0x330776[_0x30623c(0x24e)],'gateway':_0x30623c(0x195),'amount':_0x330776[_0x30623c(0x21c)],'currency':_0x330776[_0x30623c(0x1b3)],'status':_0x146dc7[_0x30623c(0x289)](),'customer_email':_0x330776[_0x30623c(0x179)],'customer_name':_0x330776[_0x30623c(0x17d)],'created_at':_0x330776['createdAt'],'updated_at':new Date()}},_0x5d3488=await fetch(_0x2b9173[_0x30623c(0x1f3)],{'method':_0x30623c(0x29f),'headers':{'Content-Type':_0x30623c(0x1b5),'User-Agent':_0x30623c(0x221)},'body':JSON[_0x30623c(0x1da)](_0x40636b)}),_0x1145ef=Date[_0x30623c(0x194)]()-_0x14d5d4;loggerService_1[_0x30623c(0x155)][_0x30623c(0x1d9)](_0x330776[_0x30623c(0x296)],_0x2b9173[_0x30623c(0x1f3)],_0x2cf070,_0x5d3488[_0x30623c(0x220)],_0x1145ef,_0x40636b),console[_0x30623c(0x234)](_0x30623c(0x1ca)+_0x2b9173[_0x30623c(0x1f3)]+_0x30623c(0x144)+_0x5d3488[_0x30623c(0x220)]+'\x20('+_0x1145ef+_0x30623c(0x256));}catch(_0x55cf2e){console[_0x30623c(0x164)](_0x30623c(0x219),_0x55cf2e),loggerService_1[_0x30623c(0x155)][_0x30623c(0x1b8)](_0x330776[_0x30623c(0x296)],_0x330776['shop']?.[_0x30623c(0x216)]?.[_0x30623c(0x1f3)]||_0x30623c(0x258),'webhook_send',_0x55cf2e,{});}}['maskCardNumber'](_0x29fad3){const _0x326c19=a57_0x464a4e,_0x48a4cb=_0x29fad3[_0x326c19(0x177)](/[\s-]/g,'');if(_0x48a4cb['length']<0x4)return _0x326c19(0x1a2);return _0x326c19(0x1c9)+_0x48a4cb['slice'](-0x4);}async[a57_0x464a4e(0x252)](_0x216b0f,_0x2de8af='MASTERCARD'){const _0x4a0795=a57_0x464a4e;console['log'](_0x4a0795(0x1a3),JSON['stringify'](_0x216b0f,null,0x2));let _0x57e966=_0x216b0f,_0x5c6faf=_0x2de8af;_0x216b0f['card_type']?(_0x5c6faf=_0x216b0f[_0x4a0795(0x156)]['toUpperCase']()===_0x4a0795(0x1a6)?'VISA':_0x4a0795(0x171),console[_0x4a0795(0x234)]('ğŸ”\x20Detected\x20card\x20type\x20from\x20webhook:\x20'+_0x5c6faf)):console[_0x4a0795(0x234)](_0x4a0795(0x15f)+_0x5c6faf);if(_0x216b0f[_0x4a0795(0x15e)]&&_0x216b0f[_0x4a0795(0x165)]&&_0x216b0f[_0x4a0795(0x264)]){console['log'](_0x4a0795(0x207));try{const _0x512d1e=await this[_0x4a0795(0x18d)](_0x216b0f[_0x4a0795(0x15e)],_0x216b0f[_0x4a0795(0x165)],_0x5c6faf);_0x57e966=JSON['parse'](_0x512d1e),console[_0x4a0795(0x234)](_0x4a0795(0x20e)),console['log'](_0x4a0795(0x24c),JSON[_0x4a0795(0x1da)](_0x57e966,null,0x2));}catch(_0x336499){console[_0x4a0795(0x164)](_0x4a0795(0x17c),_0x336499),console['log'](_0x4a0795(0x26f)),_0x57e966=_0x216b0f;}}else console[_0x4a0795(0x234)](_0x4a0795(0x1eb));let _0x3695de=_0x4a0795(0x25f);if(_0x57e966[_0x4a0795(0x220)]===0x64&&_0x57e966[_0x4a0795(0x189)]===0x1)_0x3695de=_0x4a0795(0x270);else{if(_0x57e966[_0x4a0795(0x189)]===0x0||!this[_0x4a0795(0x254)](_0x57e966[_0x4a0795(0x220)]))_0x3695de=_0x4a0795(0x25f);else _0x57e966['final']===0x1||this[_0x4a0795(0x254)](_0x57e966[_0x4a0795(0x220)])?_0x3695de='FAILED':_0x3695de=_0x4a0795(0x25f);}let _0x57a58f='';if(_0x57e966[_0x4a0795(0x18b)])_0x57a58f=_0x57e966[_0x4a0795(0x18b)][_0x4a0795(0x22b)](),console['log'](_0x4a0795(0x25b)+_0x5c6faf+'\x20order_id\x20for\x20search:\x20'+_0x57a58f);else _0x57e966[_0x4a0795(0x20d)]?(_0x57a58f=_0x57e966[_0x4a0795(0x20d)][_0x4a0795(0x22b)](),console['log'](_0x4a0795(0x25b)+_0x5c6faf+_0x4a0795(0x184)+_0x57a58f)):(_0x57a58f=_0x57e966['orderId']||_0x57e966[_0x4a0795(0x275)]||_0x57e966['id']||'',console['log'](_0x4a0795(0x22a)+_0x57a58f));console[_0x4a0795(0x234)](_0x4a0795(0x28e)+_0x5c6faf+_0x4a0795(0x1a7)),console['log']('\x20\x20\x20Payment\x20ID:\x20'+_0x57a58f+_0x4a0795(0x158)+_0x57e966['order_id']+',\x20orderId='+_0x57e966[_0x4a0795(0x29a)]+',\x20payment_id='+_0x57e966[_0x4a0795(0x20d)]+_0x4a0795(0x249)+_0x57e966[_0x4a0795(0x275)]+_0x4a0795(0x1ce)+_0x57e966['id']+')'),console['log'](_0x4a0795(0x241)+_0x3695de+_0x4a0795(0x16a)+_0x57e966[_0x4a0795(0x220)]+_0x4a0795(0x183)+_0x57e966[_0x4a0795(0x189)]+')'),console[_0x4a0795(0x234)]('\x20\x20\x20Amount:\x20'+_0x57e966[_0x4a0795(0x21c)]),console[_0x4a0795(0x234)]('\x20\x20\x20Currency:\x20'+_0x57e966[_0x4a0795(0x1b3)]);let _0xc6e8cc;_0x3695de==='FAILED'&&(_0xc6e8cc=this[_0x4a0795(0x233)](_0x57e966[_0x4a0795(0x220)],_0x57e966[_0x4a0795(0x1de)]),console[_0x4a0795(0x234)](_0x4a0795(0x1fa)+_0xc6e8cc));const _0x11fa1b={'paymentId':_0x57a58f,'status':_0x3695de,'amount':_0x57e966['amount'],'currency':_0x57e966[_0x4a0795(0x1b3)]};return _0xc6e8cc&&(_0x11fa1b['errorMessage']=_0xc6e8cc),_0x11fa1b;}[a57_0x464a4e(0x15c)](){const _0x27a078=a57_0x464a4e;console[_0x27a078(0x234)](_0x27a078(0x16b));const _0x544da6=this[_0x27a078(0x196)]['size'];for(const [_0x4908e5]of this['statusCheckTimers']){this[_0x27a078(0x14b)](_0x4908e5);}console[_0x27a078(0x234)](_0x27a078(0x1b6)+_0x544da6+'\x20MasterCard\x20status\x20check\x20timers');}}exports['VisaMasterCardService']=VisaMasterCardService;