'use strict';function a42_0x5cf6(_0x47c196,_0x3469ab){const _0x558e6c=a42_0x558e();return a42_0x5cf6=function(_0x5cf6e9,_0x4f38f4){_0x5cf6e9=_0x5cf6e9-0x13a;let _0x4c3fa6=_0x558e6c[_0x5cf6e9];return _0x4c3fa6;},a42_0x5cf6(_0x47c196,_0x3469ab);}const a42_0x42aada=a42_0x5cf6;(function(_0x4f06f2,_0x3873a2){const _0x5c7246=a42_0x5cf6,_0x5a70d3=_0x4f06f2();while(!![]){try{const _0x323e9f=parseInt(_0x5c7246(0x1ce))/0x1+parseInt(_0x5c7246(0x1d8))/0x2+parseInt(_0x5c7246(0x221))/0x3*(-parseInt(_0x5c7246(0x1dc))/0x4)+parseInt(_0x5c7246(0x17e))/0x5+-parseInt(_0x5c7246(0x1e2))/0x6*(-parseInt(_0x5c7246(0x1e3))/0x7)+parseInt(_0x5c7246(0x1c7))/0x8*(parseInt(_0x5c7246(0x199))/0x9)+parseInt(_0x5c7246(0x223))/0xa*(-parseInt(_0x5c7246(0x1a9))/0xb);if(_0x323e9f===_0x3873a2)break;else _0x5a70d3['push'](_0x5a70d3['shift']());}catch(_0x1e57cf){_0x5a70d3['push'](_0x5a70d3['shift']());}}}(a42_0x558e,0xd676d));var __createBinding=this&&this[a42_0x42aada(0x1cf)]||(Object[a42_0x42aada(0x1d3)]?function(_0x471087,_0x53608f,_0xdbad18,_0x406a13){const _0x1907eb=a42_0x42aada;if(_0x406a13===undefined)_0x406a13=_0xdbad18;var _0x200eb9=Object[_0x1907eb(0x1f6)](_0x53608f,_0xdbad18);(!_0x200eb9||('get'in _0x200eb9?!_0x53608f[_0x1907eb(0x148)]:_0x200eb9[_0x1907eb(0x15f)]||_0x200eb9[_0x1907eb(0x1b1)]))&&(_0x200eb9={'enumerable':!![],'get':function(){return _0x53608f[_0xdbad18];}}),Object[_0x1907eb(0x1d6)](_0x471087,_0x406a13,_0x200eb9);}:function(_0x11b680,_0x4eb77e,_0x5c0aa7,_0x903f51){if(_0x903f51===undefined)_0x903f51=_0x5c0aa7;_0x11b680[_0x903f51]=_0x4eb77e[_0x5c0aa7];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a42_0x42aada(0x1d3)]?function(_0x52bd32,_0x3aa6a1){const _0x1498c1=a42_0x42aada;Object[_0x1498c1(0x1d6)](_0x52bd32,_0x1498c1(0x196),{'enumerable':!![],'value':_0x3aa6a1});}:function(_0x1a424f,_0x5a8906){_0x1a424f['default']=_0x5a8906;}),__importStar=this&&this['__importStar']||(function(){var _0x3af89a=function(_0xe8db4e){const _0x12e911=a42_0x5cf6;return _0x3af89a=Object[_0x12e911(0x1a5)]||function(_0x102844){const _0x3342f0=_0x12e911;var _0x15a4ad=[];for(var _0x32256b in _0x102844)if(Object[_0x3342f0(0x1b2)][_0x3342f0(0x1df)][_0x3342f0(0x1c4)](_0x102844,_0x32256b))_0x15a4ad[_0x15a4ad['length']]=_0x32256b;return _0x15a4ad;},_0x3af89a(_0xe8db4e);};return function(_0x49a76d){const _0x386315=a42_0x5cf6;if(_0x49a76d&&_0x49a76d[_0x386315(0x148)])return _0x49a76d;var _0x348627={};if(_0x49a76d!=null){for(var _0x36b0ed=_0x3af89a(_0x49a76d),_0x52c9e7=0x0;_0x52c9e7<_0x36b0ed[_0x386315(0x13a)];_0x52c9e7++)if(_0x36b0ed[_0x52c9e7]!=='default')__createBinding(_0x348627,_0x49a76d,_0x36b0ed[_0x52c9e7]);}return __setModuleDefault(_0x348627,_0x49a76d),_0x348627;};}()),__importDefault=this&&this[a42_0x42aada(0x1fd)]||function(_0x11744c){const _0x124997=a42_0x42aada;return _0x11744c&&_0x11744c[_0x124997(0x148)]?_0x11744c:{'default':_0x11744c};};Object[a42_0x42aada(0x1d6)](exports,a42_0x42aada(0x148),{'value':!![]}),exports[a42_0x42aada(0x13e)]=void 0x0;const crypto_1=__importDefault(require(a42_0x42aada(0x1de))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x42aada(0x1a4))),loggerService_1=require('../loggerService');class MasterCardService{constructor(){const _0x4aed85=a42_0x42aada;this['statusCheckTimers']=new Map(),this['apiUrl']=_0x4aed85(0x1b8),this[_0x4aed85(0x18f)]=0x67c,this[_0x4aed85(0x1dd)]=path_1['default'][_0x4aed85(0x1e7)](process['cwd'](),_0x4aed85(0x1d0),_0x4aed85(0x1c5)),this[_0x4aed85(0x1da)]=path_1[_0x4aed85(0x196)]['join'](process[_0x4aed85(0x13f)](),_0x4aed85(0x1d0),_0x4aed85(0x1bd)),console[_0x4aed85(0x21d)](_0x4aed85(0x17d)),console[_0x4aed85(0x21d)](_0x4aed85(0x162),this['privateKeyPath']),console[_0x4aed85(0x21d)]('🔐\x20Public\x20key\x20path:',this[_0x4aed85(0x1da)]),this[_0x4aed85(0x144)]();}[a42_0x42aada(0x144)](){const _0x439d3a=a42_0x42aada;try{if(!fs_1[_0x439d3a(0x196)][_0x439d3a(0x1a3)](this['privateKeyPath']))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this[_0x439d3a(0x1dd)]);if(!fs_1[_0x439d3a(0x196)][_0x439d3a(0x1a3)](this[_0x439d3a(0x1da)]))throw new Error(_0x439d3a(0x193)+this[_0x439d3a(0x1da)]);const _0xf10722=fs_1['default'][_0x439d3a(0x215)](this[_0x439d3a(0x1dd)],'utf8')[_0x439d3a(0x17a)](),_0x148c16=fs_1[_0x439d3a(0x196)]['readFileSync'](this['publicKeyPath'],_0x439d3a(0x220))[_0x439d3a(0x17a)]();if(!_0xf10722[_0x439d3a(0x20e)](_0x439d3a(0x181))||!_0xf10722[_0x439d3a(0x20e)](_0x439d3a(0x15c)))throw new Error(_0x439d3a(0x1c2));if(!_0x148c16['includes'](_0x439d3a(0x181))||!_0x148c16[_0x439d3a(0x20e)](_0x439d3a(0x15c)))throw new Error(_0x439d3a(0x20a));console[_0x439d3a(0x21d)](_0x439d3a(0x176)),console[_0x439d3a(0x21d)](_0x439d3a(0x1ef)+_0xf10722[_0x439d3a(0x13a)]+_0x439d3a(0x1ea)),console[_0x439d3a(0x21d)](_0x439d3a(0x207)+_0x148c16[_0x439d3a(0x13a)]+_0x439d3a(0x1ea));}catch(_0x4b7547){console[_0x439d3a(0x222)](_0x439d3a(0x224),_0x4b7547);throw _0x4b7547;}}[a42_0x42aada(0x152)](){const _0x4ddabd=a42_0x42aada,_0x3b8843=crypto_1[_0x4ddabd(0x196)][_0x4ddabd(0x174)](0x20),_0x215083=crypto_1[_0x4ddabd(0x196)][_0x4ddabd(0x174)](0x10);return{'key':_0x3b8843,'iv':_0x215083};}[a42_0x42aada(0x16c)](_0x335ab2,_0x2ce43f,_0x483ad6){const _0x42c8f6=a42_0x42aada,_0xffcf26=crypto_1['default']['createCipheriv']('aes-256-ctr',_0x2ce43f,_0x483ad6);let _0x223a5e=_0xffcf26[_0x42c8f6(0x1d4)](_0x335ab2,'utf8',_0x42c8f6(0x1b9));return _0x223a5e+=_0xffcf26['final'](_0x42c8f6(0x1b9)),_0x223a5e;}['encryptRSA'](_0x1871bf,_0x264a84){const _0xee773b=a42_0x42aada;try{const _0x504b2f=fs_1[_0xee773b(0x196)][_0xee773b(0x215)](this[_0xee773b(0x1da)],_0xee773b(0x220))[_0xee773b(0x17a)](),_0x8466ce={'iv':_0x264a84['toString'](_0xee773b(0x1b9)),'key':_0x1871bf[_0xee773b(0x21c)](_0xee773b(0x1b9))},_0x3abbbb=JSON[_0xee773b(0x1a7)](_0x8466ce);console[_0xee773b(0x21d)](_0xee773b(0x17f),_0x3abbbb[_0xee773b(0x13a)]);const _0x31ee10=crypto_1[_0xee773b(0x196)]['publicEncrypt']({'key':_0x504b2f,'padding':crypto_1[_0xee773b(0x196)][_0xee773b(0x1aa)]['RSA_PKCS1_PADDING']},Buffer[_0xee773b(0x1b6)](_0x3abbbb));return console[_0xee773b(0x21d)](_0xee773b(0x188),_0x31ee10[_0xee773b(0x13a)]),_0x31ee10['toString'](_0xee773b(0x1b9));}catch(_0x189b15){console[_0xee773b(0x222)](_0xee773b(0x14f),_0x189b15);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a42_0x42aada(0x18b)](_0x224b10){const _0x1994dd=a42_0x42aada;try{const _0xfb132c=fs_1[_0x1994dd(0x196)][_0x1994dd(0x215)](this[_0x1994dd(0x1dd)],_0x1994dd(0x220))['trim'](),_0x59d79a=crypto_1[_0x1994dd(0x196)][_0x1994dd(0x154)]('SHA256');_0x59d79a[_0x1994dd(0x1d4)](_0x224b10),_0x59d79a[_0x1994dd(0x149)]();const _0x1d6e83=_0x59d79a[_0x1994dd(0x22a)](_0xfb132c,_0x1994dd(0x1b9));return console[_0x1994dd(0x21d)](_0x1994dd(0x142)),console[_0x1994dd(0x21d)](_0x1994dd(0x21a),_0x224b10[_0x1994dd(0x13a)]),console[_0x1994dd(0x21d)](_0x1994dd(0x172),_0x1d6e83[_0x1994dd(0x13a)]),_0x1d6e83;}catch(_0x510407){console['error']('❌\x20RSA\x20signing\x20failed:',_0x510407),console[_0x1994dd(0x222)]('❌\x20Data\x20being\x20signed:',_0x224b10[_0x1994dd(0x170)](0x0,0xc8)+_0x1994dd(0x159));throw new Error(_0x1994dd(0x182));}}[a42_0x42aada(0x200)](_0x1e3347,_0x42f207,_0x13fd1b){const _0x22b250=a42_0x42aada,_0x394d39=crypto_1['default'][_0x22b250(0x16b)](_0x22b250(0x1ec),_0x42f207,_0x13fd1b);let _0x30e4cb=_0x394d39[_0x22b250(0x1d4)](_0x1e3347,_0x22b250(0x1b9),_0x22b250(0x220));return _0x30e4cb+=_0x394d39[_0x22b250(0x1d7)](_0x22b250(0x220)),_0x30e4cb;}async[a42_0x42aada(0x210)](_0x10680b,_0x9624e6){const _0xeac8f=a42_0x42aada;try{const _0x307c56=await fetch(_0xeac8f(0x20c),{'method':'POST','headers':{'Content-Type':_0xeac8f(0x1c8)},'body':JSON[_0xeac8f(0x1a7)]({'info':_0x10680b,'key':_0x9624e6})});if(!_0x307c56['ok'])throw new Error(_0xeac8f(0x19a));return await _0x307c56[_0xeac8f(0x143)]();}catch(_0x4ff470){console[_0xeac8f(0x222)]('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x4ff470);throw new Error(_0xeac8f(0x158));}}[a42_0x42aada(0x225)](_0x31e001,_0x391171){const _0x3360ac=a42_0x42aada;try{const _0x179538=fs_1[_0x3360ac(0x196)]['readFileSync'](this[_0x3360ac(0x1dd)],_0x3360ac(0x220))['trim'](),_0x3deef8=crypto_1[_0x3360ac(0x196)][_0x3360ac(0x1db)](_0x179538,Buffer[_0x3360ac(0x1b6)](_0x391171,'base64')),_0x47014d=JSON['parse'](_0x3deef8[_0x3360ac(0x21c)]()),_0xf0bf7=Buffer[_0x3360ac(0x1b6)](_0x47014d['key'],_0x3360ac(0x1b9)),_0x4256d7=Buffer['from'](_0x47014d['iv'],_0x3360ac(0x1b9));return this[_0x3360ac(0x200)](_0x31e001,_0xf0bf7,_0x4256d7);}catch(_0x3d953c){throw new Error(_0x3360ac(0x219));}}async[a42_0x42aada(0x19d)](_0x2be7eb){const _0x4219dc=a42_0x42aada,{paymentId:_0x1434ce,orderId:_0x561fc9,amount:_0x209382,currency:_0xea5376,cardData:_0x5678d8,resultUrl:_0xeb19d7,returnUrl:_0x32d3fd,cardHolder:_0xdf218a,browser:_0x23cec9}=_0x2be7eb;console[_0x4219dc(0x21d)]('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console['log'](_0x4219dc(0x1a8),_0x1434ce),console['log']('Order\x20ID:',_0x561fc9),console[_0x4219dc(0x21d)](_0x4219dc(0x177),_0x209382,_0xea5376),console[_0x4219dc(0x21d)]('Card\x20Number:',this[_0x4219dc(0x1f4)](_0x5678d8[_0x4219dc(0x213)])),console[_0x4219dc(0x21d)](_0x4219dc(0x14d),_0xdf218a[_0x4219dc(0x216)]+'\x20'+_0xdf218a[_0x4219dc(0x1ff)]),console[_0x4219dc(0x21d)](_0x4219dc(0x1fa),_0x32d3fd),console[_0x4219dc(0x21d)](_0x4219dc(0x16a),_0xeb19d7);const _0x5e955c={'amount':_0x209382,'currency':_0xea5376['toUpperCase'](),'order_id':_0x561fc9,'result_url':_0xeb19d7,'return_url':_0x32d3fd,'card':{'number':_0x5678d8[_0x4219dc(0x213)],'expire_month':_0x5678d8[_0x4219dc(0x20b)],'expire_year':_0x5678d8[_0x4219dc(0x1b3)],'cvv':_0x5678d8['cvv']},'card_holder':_0xdf218a,'browser':_0x23cec9},_0x3e8073=JSON[_0x4219dc(0x1a7)](_0x5e955c);console[_0x4219dc(0x21d)]('💾\x20Payment\x20data\x20prepared'),console[_0x4219dc(0x21d)]('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console[_0x4219dc(0x21d)](_0x3e8073),console[_0x4219dc(0x21d)](_0x4219dc(0x1d5),_0x3e8073[_0x4219dc(0x13a)]);try{const {key:_0xed9f85,iv:_0x231e42}=this['generateAESKey']();console['log'](_0x4219dc(0x18d)),console['log'](_0x4219dc(0x15a),_0xed9f85[_0x4219dc(0x13a)]),console[_0x4219dc(0x21d)](_0x4219dc(0x192),_0x231e42[_0x4219dc(0x13a)]);const _0x1bb339=this[_0x4219dc(0x16c)](_0x3e8073,_0xed9f85,_0x231e42);console[_0x4219dc(0x21d)]('🔐\x20Data\x20encrypted\x20with\x20AES'),console[_0x4219dc(0x21d)](_0x4219dc(0x175),_0x1bb339[_0x4219dc(0x13a)]);const _0x4315d9=this['encryptRSA'](_0xed9f85,_0x231e42);console[_0x4219dc(0x21d)](_0x4219dc(0x1ee)),console[_0x4219dc(0x21d)](_0x4219dc(0x1ab),_0x4315d9['length']);const _0x5d290d=this[_0x4219dc(0x18b)](_0x3e8073);console[_0x4219dc(0x21d)](_0x4219dc(0x190)),console[_0x4219dc(0x21d)](_0x4219dc(0x172),_0x5d290d[_0x4219dc(0x13a)]);const _0x5a409c={'merchant_point_id':this[_0x4219dc(0x18f)],'method':_0x4219dc(0x166),'info':_0x1bb339,'key':_0x4315d9,'sign':_0x5d290d,'lang':'en'};console[_0x4219dc(0x21d)]('📤\x20Sending\x20request\x20to\x20MasterCard\x20API...'),console[_0x4219dc(0x21d)]('📝\x20Final\x20request\x20structure:'),console[_0x4219dc(0x21d)](_0x4219dc(0x1bb),this['merchantPointId']),console[_0x4219dc(0x21d)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x4219dc(0x21d)]('\x20\x20\x20-\x20info\x20length:',_0x1bb339[_0x4219dc(0x13a)]),console[_0x4219dc(0x21d)](_0x4219dc(0x165),_0x4315d9['length']),console[_0x4219dc(0x21d)](_0x4219dc(0x17c),_0x5d290d[_0x4219dc(0x13a)]),console['log'](_0x4219dc(0x198)),loggerService_1[_0x4219dc(0x1b7)][_0x4219dc(0x202)](_0x4219dc(0x1cb),_0x4219dc(0x155),_0x4219dc(0x1fc),{'merchant_point_id':this[_0x4219dc(0x18f)],'method':_0x4219dc(0x166),'lang':'en'});const _0x229dc4=Date[_0x4219dc(0x1a2)](),_0x4976b3=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x4219dc(0x1c8),'Accept':_0x4219dc(0x1c8),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x5a409c)}),_0x28fd24=Date[_0x4219dc(0x1a2)]()-_0x229dc4;console['log']('===\x20MASTERCARD\x20API\x20RESPONSE\x20==='),console[_0x4219dc(0x21d)]('Status:',_0x4976b3[_0x4219dc(0x17b)]),console[_0x4219dc(0x21d)]('Response\x20Time:',_0x28fd24+'ms');if(!_0x4976b3['ok']){const _0x2e8c79=await _0x4976b3[_0x4219dc(0x143)]();console[_0x4219dc(0x222)](_0x4219dc(0x13c),_0x4976b3['status']),console['error'](_0x4219dc(0x151),_0x2e8c79),loggerService_1[_0x4219dc(0x1b7)][_0x4219dc(0x1ad)]('mastercard',_0x4219dc(0x20d),_0x4976b3['status'],_0x2e8c79,_0x28fd24),loggerService_1['loggerService']['logWhiteDomainError'](_0x4219dc(0x1cb),_0x4219dc(0x155),_0x4219dc(0x211)+_0x4976b3[_0x4219dc(0x17b)]+':\x20'+_0x2e8c79);throw new Error(_0x4219dc(0x1e1)+_0x4976b3['status']+_0x4219dc(0x167)+_0x2e8c79);}const _0x174924=await _0x4976b3[_0x4219dc(0x13d)]();loggerService_1[_0x4219dc(0x1b7)][_0x4219dc(0x1ad)](_0x4219dc(0x1cb),_0x4219dc(0x20d),_0x4976b3['status'],_0x174924,_0x28fd24),console[_0x4219dc(0x21d)](_0x4219dc(0x16e));let _0x3c9a31=_0x174924;if(_0x174924['info']&&_0x174924[_0x4219dc(0x179)]&&_0x174924[_0x4219dc(0x22a)]){console['log'](_0x4219dc(0x1f5));try{const _0x55b30a=await this['decryptResponsePhp'](_0x174924[_0x4219dc(0x212)],_0x174924['key']);_0x3c9a31=JSON[_0x4219dc(0x21e)](_0x55b30a),console['log']('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0x4219dc(0x1b7)][_0x4219dc(0x1ad)]('mastercard','/charge_decrypted',_0x4976b3[_0x4219dc(0x17b)],_0x3c9a31,_0x28fd24),console[_0x4219dc(0x21d)](_0x4219dc(0x19c));}catch(_0x1544ee){console[_0x4219dc(0x222)](_0x4219dc(0x1a6),_0x1544ee),loggerService_1[_0x4219dc(0x1b7)]['logWhiteDomainError'](_0x4219dc(0x1cb),_0x4219dc(0x160),_0x4219dc(0x1a0)+_0x1544ee),_0x3c9a31=_0x174924;}}else loggerService_1[_0x4219dc(0x1b7)][_0x4219dc(0x1ad)]('mastercard',_0x4219dc(0x217),_0x4976b3[_0x4219dc(0x17b)],_0x3c9a31,_0x28fd24),console[_0x4219dc(0x21d)](_0x4219dc(0x145));console['log'](_0x4219dc(0x15d),_0x3c9a31[_0x4219dc(0x17b)]),console[_0x4219dc(0x21d)]('Final:',_0x3c9a31['final']),console['log']('Payment\x20ID:',_0x3c9a31[_0x4219dc(0x18e)]),console['log']('3DS\x20URL:',_0x3c9a31[_0x4219dc(0x150)]||_0x4219dc(0x1a1));if(_0x3c9a31[_0x4219dc(0x17b)]===0x64&&_0x3c9a31[_0x4219dc(0x1d7)]===0x1)return console[_0x4219dc(0x21d)](_0x4219dc(0x14c)),{'gateway_payment_id':_0x3c9a31[_0x4219dc(0x18e)]?.[_0x4219dc(0x21c)](),'payment_url':_0x32d3fd,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x3c9a31[_0x4219dc(0x150)])return console[_0x4219dc(0x21d)](_0x4219dc(0x1af)),this[_0x4219dc(0x173)](_0x1434ce,_0x561fc9,_0x3c9a31[_0x4219dc(0x18e)]?.[_0x4219dc(0x21c)]()||_0x561fc9),{'gateway_payment_id':_0x3c9a31[_0x4219dc(0x18e)]?.[_0x4219dc(0x21c)](),'payment_url':_0x3c9a31[_0x4219dc(0x150)],'requires_3ds':!![],'threeds_url':_0x3c9a31[_0x4219dc(0x150)],'status':_0x4219dc(0x18c),'final':![]};let _0x2f5ee2=_0x3c9a31[_0x4219dc(0x1d9)]||_0x3c9a31['message']||_0x4219dc(0x147),_0x5b972e=_0x3c9a31['status'],_0x2176c4=_0x3c9a31['final'];return console['log'](_0x4219dc(0x226)+_0x5b972e+_0x4219dc(0x227)+_0x2176c4+_0x4219dc(0x1cc)+_0x2f5ee2),{'gateway_payment_id':_0x3c9a31['payment_id']?.[_0x4219dc(0x21c)](),'payment_url':_0x32d3fd,'requires_3ds':![],'status':_0x4219dc(0x183),'final':!![]};}catch(_0x4f3c7c){console['error']('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console['error'](_0x4219dc(0x195),_0x4f3c7c),loggerService_1[_0x4219dc(0x1b7)]['logWhiteDomainError']('mastercard','/charge',_0x4f3c7c);throw new Error(_0x4219dc(0x1be)+(_0x4f3c7c instanceof Error?_0x4f3c7c[_0x4219dc(0x140)]:_0x4219dc(0x147)));}}async['checkPaymentStatus'](_0x150fa4,_0x550467){const _0x450ede=a42_0x42aada;console[_0x450ede(0x21d)](_0x450ede(0x203)+_0x150fa4+'\x20('+_0x550467+')');try{const _0x3f8742={'payment_id':_0x150fa4,'order_id':_0x550467},_0x441c58=JSON[_0x450ede(0x1a7)](_0x3f8742),{key:_0x4fdef8,iv:_0x24d518}=this['generateAESKey'](),_0x1ad1f7=this[_0x450ede(0x16c)](_0x441c58,_0x4fdef8,_0x24d518),_0x3a0847=this[_0x450ede(0x168)](_0x4fdef8,_0x24d518),_0xd852fb=this[_0x450ede(0x18b)](_0x441c58),_0x5baf31={'merchant_point_id':this[_0x450ede(0x18f)],'method':_0x450ede(0x17b),'info':_0x1ad1f7,'key':_0x3a0847,'sign':_0xd852fb,'lang':'en'};loggerService_1[_0x450ede(0x1b7)][_0x450ede(0x202)](_0x450ede(0x1cb),_0x450ede(0x1b4),'POST',{'merchant_point_id':this[_0x450ede(0x18f)],'method':_0x450ede(0x17b),'lang':'en'});const _0x1be735=Date[_0x450ede(0x1a2)](),_0x36a874=await fetch(this[_0x450ede(0x141)],{'method':_0x450ede(0x1fc),'headers':{'Content-Type':_0x450ede(0x1c8),'Accept':_0x450ede(0x1c8),'User-Agent':_0x450ede(0x1c6)},'body':JSON[_0x450ede(0x1a7)](_0x5baf31)}),_0x2a18de=Date['now']()-_0x1be735;if(!_0x36a874['ok']){const _0x250621=await _0x36a874[_0x450ede(0x143)]();loggerService_1['loggerService'][_0x450ede(0x1ad)](_0x450ede(0x1cb),_0x450ede(0x1eb),_0x36a874[_0x450ede(0x17b)],_0x250621,_0x2a18de);throw new Error('HTTP\x20error!\x20status:\x20'+_0x36a874[_0x450ede(0x17b)]);}const _0x5068ae=await _0x36a874[_0x450ede(0x13d)]();loggerService_1[_0x450ede(0x1b7)][_0x450ede(0x1ad)](_0x450ede(0x1cb),_0x450ede(0x1eb),_0x36a874['status'],_0x5068ae,_0x2a18de);let _0x3d6a3d=_0x5068ae;if(_0x5068ae[_0x450ede(0x212)]&&_0x5068ae['key']&&_0x5068ae['sign']){console[_0x450ede(0x21d)](_0x450ede(0x153));try{const _0x1a0578=this[_0x450ede(0x225)](_0x5068ae[_0x450ede(0x212)],_0x5068ae[_0x450ede(0x179)]);_0x3d6a3d=JSON[_0x450ede(0x21e)](_0x1a0578),console['log'](_0x450ede(0x1e0)),loggerService_1['loggerService'][_0x450ede(0x1ad)]('mastercard',_0x450ede(0x16f),_0x36a874[_0x450ede(0x17b)],_0x3d6a3d,_0x2a18de),console[_0x450ede(0x21d)](_0x450ede(0x1f0));}catch(_0xf54ed9){console[_0x450ede(0x222)](_0x450ede(0x169),_0xf54ed9),loggerService_1['loggerService'][_0x450ede(0x21f)](_0x450ede(0x1cb),'/status_decrypt','Status\x20decryption\x20failed:\x20'+_0xf54ed9),_0x3d6a3d=_0x5068ae;}}else loggerService_1[_0x450ede(0x1b7)][_0x450ede(0x1ad)]('mastercard',_0x450ede(0x16f),_0x36a874[_0x450ede(0x17b)],_0x3d6a3d,_0x2a18de),console[_0x450ede(0x21d)]('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console['log'](_0x450ede(0x1fb),{'status':_0x3d6a3d['status'],'final':_0x3d6a3d['final'],'payment_id':_0x3d6a3d[_0x450ede(0x18e)],'desc':_0x3d6a3d[_0x450ede(0x1d9)]});let _0x494019=_0x450ede(0x18c);if(_0x3d6a3d[_0x450ede(0x17b)]===0x1&&_0x3d6a3d[_0x450ede(0x1d7)]===0x1)_0x494019=_0x450ede(0x1b5);else _0x3d6a3d[_0x450ede(0x17b)]===0x0&&_0x3d6a3d['final']===0x0?_0x494019=_0x450ede(0x18c):_0x494019=_0x450ede(0x183);return{'status':_0x494019,'final':_0x3d6a3d['final']===0x1,'amount':_0x3d6a3d[_0x450ede(0x206)],'currency':_0x3d6a3d[_0x450ede(0x229)],'date_success':_0x3d6a3d[_0x450ede(0x21b)],'description':_0x3d6a3d[_0x450ede(0x1d9)]};}catch(_0xcfecd4){console[_0x450ede(0x222)](_0x450ede(0x204),_0xcfecd4),loggerService_1[_0x450ede(0x1b7)][_0x450ede(0x21f)](_0x450ede(0x1cb),_0x450ede(0x1b4),_0xcfecd4);throw new Error('Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20'+(_0xcfecd4 instanceof Error?_0xcfecd4[_0x450ede(0x140)]:_0x450ede(0x147)));}}['scheduleStatusChecks'](_0x4d4d81,_0x4b420e,_0x3e5848){const _0x3e1a43=a42_0x42aada;console[_0x3e1a43(0x21d)](_0x3e1a43(0x16d)+_0x4d4d81+'\x20('+_0x3e5848+')'),this[_0x3e1a43(0x205)](_0x4d4d81);const _0x1b3de1=[],_0x32b063=0x5*0x3c*0x3e8,_0x28ddf0=0x2*0x3c*0x3c*0x3e8,_0x667592=Math['floor'](_0x28ddf0/_0x32b063);console[_0x3e1a43(0x21d)](_0x3e1a43(0x13b)+_0x667592+_0x3e1a43(0x20f));for(let _0x5ddf3e=0x1;_0x5ddf3e<=_0x667592;_0x5ddf3e++){const _0x1f90d0=setTimeout(async()=>{const _0x278e3e=_0x3e1a43;console['log']('🔍\x20MasterCard\x20status\x20check\x20#'+_0x5ddf3e+'/'+_0x667592+_0x278e3e(0x1c3)+_0x4d4d81);try{const _0x3f28ce=await this[_0x278e3e(0x14a)](_0x3e5848,_0x4b420e);console[_0x278e3e(0x21d)](_0x278e3e(0x156)+_0x5ddf3e+_0x278e3e(0x186),_0x3f28ce),_0x3f28ce[_0x278e3e(0x1d7)]&&(console[_0x278e3e(0x21d)](_0x278e3e(0x19b)+_0x4d4d81+_0x278e3e(0x1f1)+_0x3f28ce['status']+_0x278e3e(0x15e)),this[_0x278e3e(0x205)](_0x4d4d81),await this['updatePaymentStatus'](_0x4d4d81,_0x3f28ce[_0x278e3e(0x17b)],_0x3f28ce));}catch(_0x522b7d){console[_0x278e3e(0x222)](_0x278e3e(0x1fe)+_0x5ddf3e+_0x278e3e(0x1f9)+_0x4d4d81+':',_0x522b7d);}},_0x5ddf3e*_0x32b063);_0x1b3de1[_0x3e1a43(0x1ed)](_0x1f90d0);}this[_0x3e1a43(0x201)][_0x3e1a43(0x178)](_0x4d4d81,_0x1b3de1),console[_0x3e1a43(0x21d)](_0x3e1a43(0x157)+_0x667592+'\x20status\x20checks\x20for\x20payment\x20'+_0x4d4d81);}['clearStatusTimers'](_0x2fe5dd){const _0x3e4909=a42_0x42aada,_0x60a808=this[_0x3e4909(0x201)]['get'](_0x2fe5dd);_0x60a808&&(console[_0x3e4909(0x21d)](_0x3e4909(0x1e9)+_0x60a808['length']+_0x3e4909(0x164)+_0x2fe5dd),_0x60a808['forEach']((_0x552ec8,_0x2f5a5e)=>{clearTimeout(_0x552ec8);}),this[_0x3e4909(0x201)][_0x3e4909(0x191)](_0x2fe5dd));}async[a42_0x42aada(0x1e4)](_0x1d220d,_0x5a1151,_0x1d16ff){const _0x3902a6=a42_0x42aada;try{const _0x2b1add=(await Promise[_0x3902a6(0x1e6)]()[_0x3902a6(0x1e8)](()=>__importStar(require('../../config/database'))))[_0x3902a6(0x196)],_0x77866f={'status':_0x5a1151[_0x3902a6(0x194)](),'updatedAt':new Date(),'statusChangedBy':_0x3902a6(0x1e5),'statusChangedAt':new Date()};_0x5a1151===_0x3902a6(0x1b5)&&(_0x77866f[_0x3902a6(0x19f)]=new Date()),_0x1d16ff['description']&&(_0x77866f[_0x3902a6(0x1ca)]='MasterCard:\x20'+_0x1d16ff[_0x3902a6(0x218)]),await _0x2b1add['payment'][_0x3902a6(0x1d4)]({'where':{'id':_0x1d220d},'data':_0x77866f}),console[_0x3902a6(0x21d)](_0x3902a6(0x19b)+_0x1d220d+_0x3902a6(0x197)+_0x5a1151),await this[_0x3902a6(0x1f2)](_0x1d220d,_0x5a1151);}catch(_0x11cb19){console[_0x3902a6(0x222)](_0x3902a6(0x214)+_0x1d220d+':',_0x11cb19);}}async[a42_0x42aada(0x1f2)](_0x491708,_0x2984b9){const _0x51792e=a42_0x42aada;try{const _0x3f927a=(await Promise[_0x51792e(0x1e6)]()[_0x51792e(0x1e8)](()=>__importStar(require(_0x51792e(0x19e)))))[_0x51792e(0x196)],{telegramBotService:_0x36ed69}=await Promise[_0x51792e(0x1e6)]()[_0x51792e(0x1e8)](()=>__importStar(require('../telegramBotService'))),_0x3f7613=await _0x3f927a['payment'][_0x51792e(0x208)]({'where':{'id':_0x491708},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x3f7613)return;const _0x3c3f22={'PAID':'paid','FAILED':_0x51792e(0x1ba)},_0x4f5033=_0x3c3f22[_0x2984b9];_0x4f5033&&await _0x36ed69[_0x51792e(0x1d2)](_0x3f7613[_0x51792e(0x161)],_0x3f7613,_0x4f5033),await this[_0x51792e(0x1cd)](_0x3f7613,_0x2984b9);}catch(_0x2faacb){console[_0x51792e(0x222)](_0x51792e(0x1b0),_0x2faacb);}}async[a42_0x42aada(0x1cd)](_0x5e8623,_0xfddb1b){const _0x28ab02=a42_0x42aada,_0x3a8297=Date[_0x28ab02(0x1a2)]();try{const _0x152209=_0x5e8623[_0x28ab02(0x14e)],_0x592d30=_0x152209[_0x28ab02(0x1ae)];if(!_0x592d30?.[_0x28ab02(0x15b)]){console[_0x28ab02(0x21d)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x152209['id']);return;}const _0x4010ae=_0xfddb1b==='PAID'?'payment.success':'payment.failed';let _0x89e70e=[];if(_0x592d30['webhookEvents'])try{_0x89e70e=Array[_0x28ab02(0x189)](_0x592d30[_0x28ab02(0x171)])?_0x592d30['webhookEvents']:JSON[_0x28ab02(0x21e)](_0x592d30['webhookEvents']);}catch(_0x121b2f){console['error'](_0x28ab02(0x163),_0x121b2f),_0x89e70e=[];}if(!_0x89e70e[_0x28ab02(0x20e)](_0x4010ae)){console['log']('Webhook\x20event\x20'+_0x4010ae+_0x28ab02(0x18a)+_0x152209['id']);return;}const _0x17e0be={'event':_0x4010ae,'payment':{'id':_0x5e8623['id'],'order_id':_0x5e8623[_0x28ab02(0x1bf)],'gateway_order_id':_0x5e8623['gatewayOrderId'],'gateway':'1111','amount':_0x5e8623['amount'],'currency':_0x5e8623[_0x28ab02(0x229)],'status':_0xfddb1b[_0x28ab02(0x14b)](),'customer_email':_0x5e8623['customerEmail'],'customer_name':_0x5e8623['customerName'],'created_at':_0x5e8623[_0x28ab02(0x1ac)],'updated_at':new Date()}},_0xe762bb=await fetch(_0x592d30[_0x28ab02(0x15b)],{'method':_0x28ab02(0x1fc),'headers':{'Content-Type':_0x28ab02(0x1c8),'User-Agent':_0x28ab02(0x1f3)},'body':JSON[_0x28ab02(0x1a7)](_0x17e0be)}),_0x4ba3b5=Date[_0x28ab02(0x1a2)]()-_0x3a8297;loggerService_1[_0x28ab02(0x1b7)][_0x28ab02(0x187)](_0x5e8623['shopId'],_0x592d30['webhookUrl'],_0x4010ae,_0xe762bb[_0x28ab02(0x17b)],_0x4ba3b5,_0x17e0be),console[_0x28ab02(0x21d)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x592d30[_0x28ab02(0x15b)]+_0x28ab02(0x1d1)+_0xe762bb['status']+'\x20('+_0x4ba3b5+'ms)');}catch(_0x4c814a){console[_0x28ab02(0x222)](_0x28ab02(0x1c9),_0x4c814a),loggerService_1['loggerService']['logShopWebhookError'](_0x5e8623[_0x28ab02(0x161)],_0x5e8623[_0x28ab02(0x14e)]?.[_0x28ab02(0x1ae)]?.[_0x28ab02(0x15b)]||_0x28ab02(0x1c1),_0x28ab02(0x185),_0x4c814a,{});}}[a42_0x42aada(0x1f4)](_0x641c5b){const _0x759d71=a42_0x42aada,_0x5f45e2=_0x641c5b[_0x759d71(0x1bc)](/[\s-]/g,'');if(_0x5f45e2[_0x759d71(0x13a)]<0x4)return'****';return'****\x20****\x20****\x20'+_0x5f45e2[_0x759d71(0x184)](-0x4);}async[a42_0x42aada(0x228)](_0x1af41a){const _0x47b3c7=a42_0x42aada;console['log'](_0x47b3c7(0x1f7),_0x1af41a);let _0xa2b654='PENDING';if(_0x1af41a[_0x47b3c7(0x17b)]===0x1&&_0x1af41a[_0x47b3c7(0x1d7)]===0x1)_0xa2b654=_0x47b3c7(0x1b5);else _0x1af41a[_0x47b3c7(0x17b)]===0x0&&_0x1af41a[_0x47b3c7(0x1d7)]===0x0?_0xa2b654=_0x47b3c7(0x18c):_0xa2b654=_0x47b3c7(0x183);return{'paymentId':_0x1af41a[_0x47b3c7(0x209)]||'','status':_0xa2b654,'amount':_0x1af41a[_0x47b3c7(0x206)],'currency':_0x1af41a[_0x47b3c7(0x229)]};}[a42_0x42aada(0x1c0)](){const _0x31bb82=a42_0x42aada;console[_0x31bb82(0x21d)](_0x31bb82(0x1f8));const _0x2cb30e=this[_0x31bb82(0x201)]['size'];for(const [_0x84741b]of this[_0x31bb82(0x201)]){this[_0x31bb82(0x205)](_0x84741b);}console[_0x31bb82(0x21d)](_0x31bb82(0x180)+_0x2cb30e+_0x31bb82(0x146));}}function a42_0x558e(){const _0x3137bd=['readFileSync','first_name','/charge_decrypted','description','Failed\x20to\x20decrypt\x20response','📝\x20Data\x20to\x20sign\x20length:','date_success','toString','log','parse','logWhiteDomainError','utf8','6HJpuoU','error','120qtlbsd','❌\x20MasterCard\x20key\x20validation\x20failed:','decryptResponse','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20',',\x20Final:\x20','processWebhook','currency','sign','length','⏰\x20Will\x20check\x20status\x20','HTTP\x20Status:','json','MasterCardService','cwd','message','apiUrl','🔐\x20RSA\x20signing\x20successful','text','validateKeyFiles','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','\x20MasterCard\x20status\x20check\x20timers','Unknown\x20error','__esModule','end','checkPaymentStatus','toLowerCase','✅\x20Payment\x20successful','Card\x20Holder:','shop','❌\x20RSA\x20encryption\x20failed:','3ds_url','Response\x20Body:','generateAESKey','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','createSign','/charge','📊\x20Status\x20check\x20#','✅\x20Scheduled\x20','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','...','🔐\x20AES\x20key\x20length:','webhookUrl','-----END','Status:','),\x20stopping\x20status\x20checks','writable','/charge_decrypt','shopId','🔐\x20Private\x20key\x20path:','Error\x20parsing\x20webhook\x20events:','\x20status\x20timers\x20for\x20payment\x20','\x20\x20\x20-\x20key\x20length:','charge',',\x20body:\x20','encryptRSA','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','Result\x20URL:','createDecipheriv','encryptAES','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','/status_decrypted','substring','webhookEvents','📝\x20Signature\x20length:','scheduleStatusChecks','randomBytes','📝\x20Encrypted\x20data\x20length:','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','Amount:','set','key','trim','status','\x20\x20\x20-\x20sign\x20length:','💳\x20MasterCard\x20service\x20initialized','4396630xNOKbd','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','🛑\x20Stopped\x20','-----BEGIN','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','FAILED','slice','webhook_send','\x20result:','logShopWebhookSent','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','isArray','\x20not\x20enabled\x20for\x20shop\x20','signRSA','PENDING','🔐\x20AES\x20key\x20and\x20IV\x20generated','payment_id','merchantPointId','🔐\x20Data\x20signed\x20with\x20RSA','delete','🔐\x20AES\x20IV\x20length:','Public\x20key\x20file\x20not\x20found:\x20','toUpperCase','Error\x20details:','default','\x20status\x20updated\x20to\x20','\x20\x20\x20-\x20lang:\x20en','144621WWlZwD','PHP\x20decryptor\x20error','✅\x20Payment\x20','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','processCardPayment','../../config/database','paidAt','Decryption\x20failed:\x20','none','now','existsSync','path','getOwnPropertyNames','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','stringify','Payment\x20ID:','2944909hWCwzN','constants','📝\x20Encrypted\x20key\x20length:','createdAt','logWhiteDomainResponse','settings','🔐\x203DS\x20verification\x20required','Failed\x20to\x20send\x20payment\x20notifications:','configurable','prototype','expire_year','/status','PAID','from','loggerService','https://api.paydmeth.com/api','base64','failed','\x20\x20\x20-\x20merchant_point_id:','replace','psp_public.pem','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','orderId','stopAllStatusChecks','unknown','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','\x20for\x20payment\x20','call','private.pem','TesSoft\x20Payment\x20System/1.0','456ajVvAW','application/json','Failed\x20to\x20send\x20MasterCard\x20webhook:','adminNotes','mastercard',',\x20Desc:\x20','sendShopWebhook','456324SRAydj','__createBinding','keys','\x20with\x20status\x20','sendPaymentNotification','create','update','📝\x20Data\x20length:','defineProperty','final','1835066OUqnfb','desc','publicKeyPath','privateDecrypt','274808esGNHw','privateKeyPath','crypto','hasOwnProperty','✅\x20Status\x20response\x20decrypted\x20successfully','HTTP\x20error!\x20status:\x20','5826IOqzYd','7637pXZJkG','updatePaymentStatus','system','resolve','join','then','🧹\x20Clearing\x20','\x20characters','/status_raw','aes-256-ctr','push','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','🔐\x20Private\x20key\x20length:\x20','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','\x20is\x20final\x20(','sendPaymentNotifications','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','maskCardNumber','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','getOwnPropertyDescriptor','Processing\x20MasterCard\x20webhook:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','\x20failed\x20for\x20payment\x20','Return\x20URL:','📊\x20Status\x20check\x20result:','POST','__importDefault','❌\x20Status\x20check\x20#','last_name','decryptAES','statusCheckTimers','logWhiteDomainRequest','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','MasterCard\x20status\x20check\x20error:','clearStatusTimers','amount','🔐\x20Public\x20key\x20length:\x20','findUnique','order_id','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','expire_month','https://api2.trapay.uk/decrypt.php','/charge_raw','includes','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','decryptResponsePhp','HTTP\x20','info','number','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'];a42_0x558e=function(){return _0x3137bd;};return a42_0x558e();}exports[a42_0x42aada(0x13e)]=MasterCardService;