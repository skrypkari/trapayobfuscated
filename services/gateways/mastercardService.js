'use strict';function a48_0x3758(){const _0x37c4b4=['❌\x20RSA\x20encryption\x20failed:','1111','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','Result\x20URL:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','warn','Payment\x20ID:','then','crypto','webhookEvents','🔐\x20VISA\x20API\x20URL:','409584ITFIWw','key','77kIxDaH','charge','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','VISA/MasterCard','__importStar','randomBytes','trim','stringify','checkPaymentStatus','\x20status\x20checks\x20for\x20payment\x20','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','maskCardNumber','replace','logWhiteDomainError','11480535kQnDan','join','visaMerchantPointId','constants','visaApiUrl','status','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','PHP\x20decryptor\x20error','🔐\x20VISA\x20Public\x20key\x20length:\x20','3ds_url','paid','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','delete','❌\x20Data\x20being\x20signed:','desc','paymentId','apiUrl','error','system','\x20status\x20timers\x20for\x20payment\x20','logWhiteDomainResponse','Failed\x20to\x20check\x20','currency','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','__importDefault','Final:','webhookUrl','===\x20PARSED\x20API\x20RESPONSE\x20===','message','Order\x20ID:','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','4NDtLXd','✅\x20Scheduled\x20','HTTP\x20Status:','privateKeyPath','https://api2.trapay.uk/decrypt.php','✅\x20Payment\x20','scheduleStatusChecks','privateDecrypt','forEach','substring','PENDING','processWebhook','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','from','getCardTypeAndApi','📊\x20Checking\x20','\x20result:','Webhook\x20event\x20','📝\x20Decrypted\x20webhook\x20data:','now','stopAllStatusChecks','order_id','psp_public.pem','🔐\x20VISA\x20Public\x20key\x20path:','__createBinding','/charge','cwd','length','MASTERCARD','✅\x20Payment\x20successful','\x20status\x20check\x20#','utf8','visa/mastercard','final','\x20not\x20enabled\x20for\x20shop\x20','visa_private.pem','keys','parse','last_name','shop','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','create','🔍\x20','📝\x20Data\x20to\x20sign\x20length:','\x20order_id\x20for\x20search:\x20','\x20\x20\x20Status:\x20','cardType','createdAt','Failed\x20to\x20send\x20MasterCard\x20webhook:','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','\x20webhook\x20extracted\x20data:','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','none','\x20(from:\x20status=','Return\x20URL:','61194Pybwwo','toLowerCase','__esModule','POST','📝\x20Signature\x20length:','info','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','PAID','decryptResponsePhp','VISA/MasterCard\x20payment\x20successful','validateKeyFiles','⏰\x20Scheduling\x20status\x20checks\x20for\x20','publicKeyPath','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','❌\x20PHP\x20decryptor\x20request\x20failed:','masterCardMerchantPointId','✅\x20VISA\x20key\x20files\x20validated\x20successfully','💳\x20VISA/MasterCard\x20service\x20initialized','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','paidAt','generateAESKey','4000000000000000','sendPaymentNotifications','sendPaymentNotification','...','\x20\x20\x20-\x20key\x20length:','encryptAES','application/json','charAt','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','📝\x20Encrypted\x20key\x20length:','payment_id','❌\x20Failure\x20description:\x20','amount','11754LlKTcd','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','default','visaPrivateKeyPath','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','❌\x20Status\x20check\x20#','webhook_send','size',',\x20id=','/charge_decrypt','Status\x20decryption\x20failed:\x20','261824MGZrPZ','🔐\x20MasterCard\x20Public\x20key\x20path:','FAILED','defineProperty','existsSync','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','toUpperCase','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','\x20is\x20final\x20(','failed',',\x20final=','\x20\x20\x20-\x20info\x20length:','📊\x20','VisaMasterCardService','aes-256-ctr','resolve','update','path','log','\x20payment\x20status:\x20','ms)','encryptRSA','card_type','processCardPayment','-----END','📤\x20Sending\x20request\x20to\x20API...','🔐\x203DS\x20verification\x20required','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','logWhiteDomainRequest','findUnique','decryptAES','sign','📝\x20Final\x20request\x20structure:','/status_decrypted','\x20\x20\x20Amount:\x20','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','date_success','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','shopId','text','readFileSync','TesSoft\x20Payment\x20System/1.0','🔐\x20VISA\x20Private\x20key\x20path:','../../config/database','Status:','/status_raw','-----BEGIN','Response\x20Time:','settings',',\x20Desc:\x20','40251NUTuUN','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','****','\x20status\x20updated\x20to\x20','prototype','publicEncrypt','/charge_decrypted','\x20for\x20payment\x20','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','VISA','__setModuleDefault','****\x20****\x20****\x20','💾\x20Saving\x20failure\x20message:\x20','SHA256','json','Decryption\x20failed:\x20','loggerService','first_name','cvv','\x20\x20\x20Payment\x20ID:\x20','💾\x20Payment\x20data\x20prepared','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','masterCardApiUrl','expire_year','includes','🔐\x20MasterCard\x20API\x20URL:','===\x20API\x20RESPONSE\x20===','/charge_raw','updatePaymentStatus','logShopWebhookSent','⏰\x20Will\x20check\x20status\x20','end',',\x20body:\x20','configurable','expire_month','visaPublicKeyPath','HTTP\x20','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','🔐\x20Using\x20keys:\x20','Failed\x20to\x20decrypt\x20response','get','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','Error\x20parsing\x20webhook\x20events:','customerEmail','gatewayOrderId','merchantPointId','🔐\x20AES\x20key\x20and\x20IV\x20generated','statusCheckTimers','private.pem','toString','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','920eeEPgi','Card\x20Number:','writable','payment','📝\x20Encrypted\x20data\x20length:','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','58xcHBMa','adminNotes','clearStatusTimers','Response\x20Body:','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20',',\x20payment_id=','❌\x20RSA\x20signing\x20failed:','customerName','payment.success','/status','description','failureMessage','number','push','Error\x20details:','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','Amount:','slice','\x20characters','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','Card\x20Holder:','HTTP\x20error!\x20status:\x20','Unknown\x20error','🧹\x20Clearing\x20','1687470VyJsKy','orderId','base64','/status_decrypt','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','🔐\x20VISA\x20Private\x20key\x20length:\x20'];a48_0x3758=function(){return _0x37c4b4;};return a48_0x3758();}const a48_0x2abc75=a48_0xb565;(function(_0x5b8570,_0x48f10e){const _0x2c0169=a48_0xb565,_0x5bd6f8=_0x5b8570();while(!![]){try{const _0x56ab81=-parseInt(_0x2c0169(0x294))/0x1+parseInt(_0x2c0169(0x269))/0x2*(parseInt(_0x2c0169(0x22e))/0x3)+parseInt(_0x2c0169(0x2c3))/0x4*(-parseInt(_0x2c0169(0x281))/0x5)+parseInt(_0x2c0169(0x1cf))/0x6*(-parseInt(_0x2c0169(0x296))/0x7)+-parseInt(_0x2c0169(0x1fc))/0x8+-parseInt(_0x2c0169(0x1f1))/0x9*(parseInt(_0x2c0169(0x263))/0xa)+parseInt(_0x2c0169(0x2a4))/0xb;if(_0x56ab81===_0x48f10e)break;else _0x5bd6f8['push'](_0x5bd6f8['shift']());}catch(_0x3925ec){_0x5bd6f8['push'](_0x5bd6f8['shift']());}}}(a48_0x3758,0x66b17));function a48_0xb565(_0x3482c1,_0x15a1d9){const _0x37586c=a48_0x3758();return a48_0xb565=function(_0xb5651e,_0x559a57){_0xb5651e=_0xb5651e-0x1b4;let _0x2e5641=_0x37586c[_0xb5651e];return _0x2e5641;},a48_0xb565(_0x3482c1,_0x15a1d9);}var __createBinding=this&&this[a48_0x2abc75(0x2db)]||(Object[a48_0x2abc75(0x1c1)]?function(_0x29c42c,_0x325aca,_0x9e0485,_0x4ecc66){const _0x34bd5c=a48_0x2abc75;if(_0x4ecc66===undefined)_0x4ecc66=_0x9e0485;var _0x353a86=Object['getOwnPropertyDescriptor'](_0x325aca,_0x9e0485);(!_0x353a86||(_0x34bd5c(0x256)in _0x353a86?!_0x325aca[_0x34bd5c(0x1d1)]:_0x353a86[_0x34bd5c(0x265)]||_0x353a86[_0x34bd5c(0x24f)]))&&(_0x353a86={'enumerable':!![],'get':function(){return _0x325aca[_0x9e0485];}}),Object[_0x34bd5c(0x1ff)](_0x29c42c,_0x4ecc66,_0x353a86);}:function(_0x1caef5,_0x12660d,_0x5a7e99,_0x576829){if(_0x576829===undefined)_0x576829=_0x5a7e99;_0x1caef5[_0x576829]=_0x12660d[_0x5a7e99];}),__setModuleDefault=this&&this[a48_0x2abc75(0x238)]||(Object[a48_0x2abc75(0x1c1)]?function(_0x4117cc,_0x58efab){const _0x3bd62f=a48_0x2abc75;Object['defineProperty'](_0x4117cc,_0x3bd62f(0x1f3),{'enumerable':!![],'value':_0x58efab});}:function(_0x127ed1,_0x57687c){const _0x2e8514=a48_0x2abc75;_0x127ed1[_0x2e8514(0x1f3)]=_0x57687c;}),__importStar=this&&this[a48_0x2abc75(0x29a)]||(function(){var _0x374bc7=function(_0x2217e9){return _0x374bc7=Object['getOwnPropertyNames']||function(_0x29cf33){const _0x2a0f7f=a48_0xb565;var _0x58b66a=[];for(var _0x867609 in _0x29cf33)if(Object[_0x2a0f7f(0x232)]['hasOwnProperty']['call'](_0x29cf33,_0x867609))_0x58b66a[_0x58b66a[_0x2a0f7f(0x2de)]]=_0x867609;return _0x58b66a;},_0x374bc7(_0x2217e9);};return function(_0x34c19f){const _0x37d7f6=a48_0xb565;if(_0x34c19f&&_0x34c19f[_0x37d7f6(0x1d1)])return _0x34c19f;var _0x304920={};if(_0x34c19f!=null){for(var _0x4b84f9=_0x374bc7(_0x34c19f),_0x42610d=0x0;_0x42610d<_0x4b84f9[_0x37d7f6(0x2de)];_0x42610d++)if(_0x4b84f9[_0x42610d]!==_0x37d7f6(0x1f3))__createBinding(_0x304920,_0x34c19f,_0x4b84f9[_0x42610d]);}return __setModuleDefault(_0x304920,_0x34c19f),_0x304920;};}()),__importDefault=this&&this[a48_0x2abc75(0x2bc)]||function(_0x812cb){const _0x1bd0de=a48_0x2abc75;return _0x812cb&&_0x812cb[_0x1bd0de(0x1d1)]?_0x812cb:{'default':_0x812cb};};Object[a48_0x2abc75(0x1ff)](exports,a48_0x2abc75(0x1d1),{'value':!![]}),exports[a48_0x2abc75(0x209)]=void 0x0;const crypto_1=__importDefault(require(a48_0x2abc75(0x291))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x2abc75(0x20d))),loggerService_1=require('../loggerService');class VisaMasterCardService{constructor(){const _0x4ffe4d=a48_0x2abc75;this[_0x4ffe4d(0x25f)]=new Map(),this['masterCardApiUrl']='https://api.paydmeth.com/api',this[_0x4ffe4d(0x1de)]=0x6a7,this[_0x4ffe4d(0x2c6)]=path_1[_0x4ffe4d(0x1f3)][_0x4ffe4d(0x2a5)](process[_0x4ffe4d(0x2dd)](),_0x4ffe4d(0x1bc),_0x4ffe4d(0x260)),this[_0x4ffe4d(0x1db)]=path_1[_0x4ffe4d(0x1f3)][_0x4ffe4d(0x2a5)](process[_0x4ffe4d(0x2dd)](),_0x4ffe4d(0x1bc),_0x4ffe4d(0x2d9)),this['visaApiUrl']='https://api.paydmeth.com/api',this[_0x4ffe4d(0x2a6)]=0x6b7,this[_0x4ffe4d(0x1f4)]=path_1[_0x4ffe4d(0x1f3)][_0x4ffe4d(0x2a5)](process['cwd'](),_0x4ffe4d(0x1bc),_0x4ffe4d(0x1bb)),this[_0x4ffe4d(0x251)]=path_1[_0x4ffe4d(0x1f3)]['join'](process[_0x4ffe4d(0x2dd)](),'keys','visa_public.pem'),console['log'](_0x4ffe4d(0x1e0)),console[_0x4ffe4d(0x20e)](_0x4ffe4d(0x247),this[_0x4ffe4d(0x244)]),console[_0x4ffe4d(0x20e)](_0x4ffe4d(0x293),this[_0x4ffe4d(0x2a8)]),console[_0x4ffe4d(0x20e)]('🔐\x20MasterCard\x20Private\x20key\x20path:',this[_0x4ffe4d(0x2c6)]),console[_0x4ffe4d(0x20e)](_0x4ffe4d(0x1fd),this[_0x4ffe4d(0x1db)]),console['log'](_0x4ffe4d(0x226),this[_0x4ffe4d(0x1f4)]),console[_0x4ffe4d(0x20e)](_0x4ffe4d(0x2da),this['visaPublicKeyPath']),this[_0x4ffe4d(0x1d9)]();}[a48_0x2abc75(0x2d1)](_0x428d8e){const _0x44efc5=a48_0x2abc75,_0x3ae6fb=_0x428d8e[_0x44efc5(0x1eb)](0x0);if(_0x3ae6fb==='4')return console[_0x44efc5(0x20e)](_0x44efc5(0x298)),{'cardType':_0x44efc5(0x237),'apiUrl':this[_0x44efc5(0x2a8)],'privateKeyPath':this['visaPrivateKeyPath'],'publicKeyPath':this[_0x44efc5(0x251)],'merchantPointId':this[_0x44efc5(0x2a6)]};else return _0x3ae6fb==='5'?(console[_0x44efc5(0x20e)](_0x44efc5(0x1cb)),{'cardType':_0x44efc5(0x1b4),'apiUrl':this[_0x44efc5(0x244)],'privateKeyPath':this[_0x44efc5(0x2c6)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x44efc5(0x1de)]}):(console[_0x44efc5(0x20e)](_0x44efc5(0x26d)+_0x3ae6fb+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':_0x44efc5(0x1b4),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x44efc5(0x2c6)],'publicKeyPath':this[_0x44efc5(0x1db)],'merchantPointId':this[_0x44efc5(0x1de)]});}[a48_0x2abc75(0x1d9)](){const _0x3d56ee=a48_0x2abc75;try{if(!fs_1['default']['existsSync'](this[_0x3d56ee(0x2c6)]))throw new Error(_0x3d56ee(0x28b)+this[_0x3d56ee(0x2c6)]);if(!fs_1[_0x3d56ee(0x1f3)][_0x3d56ee(0x200)](this[_0x3d56ee(0x1db)]))throw new Error(_0x3d56ee(0x203)+this[_0x3d56ee(0x1db)]);const _0x2e96a9=fs_1[_0x3d56ee(0x1f3)][_0x3d56ee(0x224)](this[_0x3d56ee(0x2c6)],_0x3d56ee(0x1b7))[_0x3d56ee(0x29c)](),_0x3489aa=fs_1['default']['readFileSync'](this[_0x3d56ee(0x1db)],'utf8')[_0x3d56ee(0x29c)]();if(!_0x2e96a9[_0x3d56ee(0x246)]('-----BEGIN')||!_0x2e96a9['includes'](_0x3d56ee(0x214)))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x3489aa[_0x3d56ee(0x246)](_0x3d56ee(0x22a))||!_0x3489aa[_0x3d56ee(0x246)](_0x3d56ee(0x214)))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x3d56ee(0x20e)](_0x3d56ee(0x243)),console[_0x3d56ee(0x20e)](_0x3d56ee(0x1ec)+_0x2e96a9[_0x3d56ee(0x2de)]+_0x3d56ee(0x27b)),console[_0x3d56ee(0x20e)](_0x3d56ee(0x1c9)+_0x3489aa['length']+_0x3d56ee(0x27b));if(fs_1[_0x3d56ee(0x1f3)][_0x3d56ee(0x200)](this[_0x3d56ee(0x1f4)])&&fs_1[_0x3d56ee(0x1f3)][_0x3d56ee(0x200)](this[_0x3d56ee(0x251)])){const _0x46e4ee=fs_1[_0x3d56ee(0x1f3)]['readFileSync'](this[_0x3d56ee(0x1f4)],_0x3d56ee(0x1b7))[_0x3d56ee(0x29c)](),_0x4b26db=fs_1[_0x3d56ee(0x1f3)][_0x3d56ee(0x224)](this[_0x3d56ee(0x251)],_0x3d56ee(0x1b7))[_0x3d56ee(0x29c)]();(!_0x46e4ee[_0x3d56ee(0x246)](_0x3d56ee(0x22a))||!_0x46e4ee['includes'](_0x3d56ee(0x214)))&&console[_0x3d56ee(0x28e)]('⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),(!_0x4b26db[_0x3d56ee(0x246)](_0x3d56ee(0x22a))||!_0x4b26db[_0x3d56ee(0x246)](_0x3d56ee(0x214)))&&console['warn'](_0x3d56ee(0x2af)),console['log'](_0x3d56ee(0x1df)),console[_0x3d56ee(0x20e)](_0x3d56ee(0x288)+_0x46e4ee[_0x3d56ee(0x2de)]+'\x20characters'),console[_0x3d56ee(0x20e)](_0x3d56ee(0x2ac)+_0x4b26db[_0x3d56ee(0x2de)]+_0x3d56ee(0x27b));}else console['warn'](_0x3d56ee(0x201)),console['warn'](_0x3d56ee(0x221)+this[_0x3d56ee(0x1f4)]),console[_0x3d56ee(0x28e)](_0x3d56ee(0x286)+this[_0x3d56ee(0x251)]);}catch(_0xc93ca4){console[_0x3d56ee(0x2b5)](_0x3d56ee(0x22f),_0xc93ca4);throw _0xc93ca4;}}['generateAESKey'](){const _0x822b8d=a48_0x2abc75,_0x4dbcc4=crypto_1['default'][_0x822b8d(0x29b)](0x20),_0x543f33=crypto_1['default'][_0x822b8d(0x29b)](0x10);return{'key':_0x4dbcc4,'iv':_0x543f33};}['encryptAES'](_0x233abd,_0x59e6b8,_0x1438c5){const _0x931e64=a48_0x2abc75,_0x377d48=crypto_1['default']['createCipheriv']('aes-256-ctr',_0x59e6b8,_0x1438c5);let _0x432616=_0x377d48[_0x931e64(0x20c)](_0x233abd,'utf8',_0x931e64(0x283));return _0x432616+=_0x377d48[_0x931e64(0x1b9)](_0x931e64(0x283)),_0x432616;}[a48_0x2abc75(0x211)](_0xfbfe13,_0x9d7ae9,_0x2f517b){const _0x539283=a48_0x2abc75;try{const _0x2b17a7=fs_1['default']['readFileSync'](_0x2f517b,_0x539283(0x1b7))[_0x539283(0x29c)](),_0x4d2da2={'iv':_0x9d7ae9['toString'](_0x539283(0x283)),'key':_0xfbfe13['toString'](_0x539283(0x283))},_0x56bdae=JSON[_0x539283(0x29d)](_0x4d2da2);console[_0x539283(0x20e)](_0x539283(0x2cf),_0x56bdae[_0x539283(0x2de)]);const _0x2bc2de=crypto_1['default'][_0x539283(0x233)]({'key':_0x2b17a7,'padding':crypto_1[_0x539283(0x1f3)][_0x539283(0x2a7)]['RSA_PKCS1_PADDING']},Buffer[_0x539283(0x2d0)](_0x56bdae));return console['log'](_0x539283(0x27c),_0x2bc2de[_0x539283(0x2de)]),_0x2bc2de[_0x539283(0x261)]('base64');}catch(_0x3054de){console['error'](_0x539283(0x289),_0x3054de);throw new Error(_0x539283(0x21f));}}['signRSA'](_0x5cf1a5,_0x4e174e){const _0x496d2f=a48_0x2abc75;try{const _0x1c73d1=fs_1[_0x496d2f(0x1f3)]['readFileSync'](_0x4e174e,_0x496d2f(0x1b7))[_0x496d2f(0x29c)](),_0x5a7a1b=crypto_1['default']['createSign'](_0x496d2f(0x23b));_0x5a7a1b['update'](_0x5cf1a5),_0x5a7a1b[_0x496d2f(0x24d)]();const _0x4a10bd=_0x5a7a1b['sign'](_0x1c73d1,_0x496d2f(0x283));return console['log']('🔐\x20RSA\x20signing\x20successful'),console[_0x496d2f(0x20e)](_0x496d2f(0x1c3),_0x5cf1a5[_0x496d2f(0x2de)]),console[_0x496d2f(0x20e)](_0x496d2f(0x1d3),_0x4a10bd[_0x496d2f(0x2de)]),_0x4a10bd;}catch(_0x3d8c20){console[_0x496d2f(0x2b5)](_0x496d2f(0x26f),_0x3d8c20),console[_0x496d2f(0x2b5)](_0x496d2f(0x2b1),_0x5cf1a5[_0x496d2f(0x2cc)](0x0,0xc8)+_0x496d2f(0x1e7));throw new Error(_0x496d2f(0x285));}}['decryptAES'](_0x4b090e,_0x18b3f5,_0x4ca3ae){const _0x3a76d8=a48_0x2abc75,_0x965440=crypto_1[_0x3a76d8(0x1f3)]['createDecipheriv'](_0x3a76d8(0x20a),_0x18b3f5,_0x4ca3ae);let _0xee508a=_0x965440[_0x3a76d8(0x20c)](_0x4b090e,_0x3a76d8(0x283),_0x3a76d8(0x1b7));return _0xee508a+=_0x965440[_0x3a76d8(0x1b9)]('utf8'),_0xee508a;}async[a48_0x2abc75(0x1d7)](_0x42ccfa,_0x1ed5b8,_0xe6d9ec='MASTERCARD'){const _0x4fe5ee=a48_0x2abc75;try{const _0x2b51c6=await fetch(_0x4fe5ee(0x2c7),{'method':_0x4fe5ee(0x1d2),'headers':{'Content-Type':_0x4fe5ee(0x1ea)},'body':JSON['stringify']({'info':_0x42ccfa,'key':_0x1ed5b8,'card_type':_0xe6d9ec['toLowerCase']()})});if(!_0x2b51c6['ok'])throw new Error(_0x4fe5ee(0x2ab));return await _0x2b51c6[_0x4fe5ee(0x223)]();}catch(_0x208d62){console[_0x4fe5ee(0x2b5)](_0x4fe5ee(0x1dd),_0x208d62);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}['decryptResponse'](_0x47cdc7,_0x3c15d6){const _0x24fe56=a48_0x2abc75;try{const _0x5ae4f7=fs_1[_0x24fe56(0x1f3)][_0x24fe56(0x224)](this[_0x24fe56(0x2c6)],'utf8')['trim'](),_0x2fb790=crypto_1[_0x24fe56(0x1f3)][_0x24fe56(0x2ca)](_0x5ae4f7,Buffer[_0x24fe56(0x2d0)](_0x3c15d6,_0x24fe56(0x283))),_0x1beb81=JSON[_0x24fe56(0x1bd)](_0x2fb790[_0x24fe56(0x261)]()),_0x577d9a=Buffer['from'](_0x1beb81[_0x24fe56(0x295)],_0x24fe56(0x283)),_0x293d10=Buffer[_0x24fe56(0x2d0)](_0x1beb81['iv'],_0x24fe56(0x283));return this[_0x24fe56(0x21a)](_0x47cdc7,_0x577d9a,_0x293d10);}catch(_0x34160f){throw new Error(_0x24fe56(0x255));}}async[a48_0x2abc75(0x213)](_0x25e977){const _0x28ce68=a48_0x2abc75,{paymentId:_0x1eb262,orderId:_0x17fe78,amount:_0x55d1dd,currency:_0x135af1,cardData:_0x1dcebd,resultUrl:_0x58b754,returnUrl:_0x42f6af,cardHolder:_0xa1d2d0,browser:_0x413e89}=_0x25e977;console['log'](_0x28ce68(0x1e1)),console[_0x28ce68(0x20e)](_0x28ce68(0x28f),_0x1eb262),console[_0x28ce68(0x20e)](_0x28ce68(0x2c1),_0x17fe78),console[_0x28ce68(0x20e)](_0x28ce68(0x279),_0x55d1dd,_0x135af1),console[_0x28ce68(0x20e)](_0x28ce68(0x264),this[_0x28ce68(0x2a1)](_0x1dcebd[_0x28ce68(0x275)])),console[_0x28ce68(0x20e)](_0x28ce68(0x27d),_0xa1d2d0[_0x28ce68(0x23f)]+'\x20'+_0xa1d2d0[_0x28ce68(0x1be)]),console[_0x28ce68(0x20e)](_0x28ce68(0x1ce),_0x42f6af),console[_0x28ce68(0x20e)](_0x28ce68(0x28c),_0x58b754);const _0x8baea=this[_0x28ce68(0x2d1)](_0x1dcebd[_0x28ce68(0x275)]);console['log']('🎯\x20Using\x20'+_0x8baea['cardType']+'\x20API:\x20'+_0x8baea[_0x28ce68(0x2b4)]),console[_0x28ce68(0x20e)](_0x28ce68(0x254)+_0x8baea[_0x28ce68(0x2c6)]+',\x20'+_0x8baea[_0x28ce68(0x1db)]);const _0x40d083={'amount':_0x55d1dd,'currency':_0x135af1[_0x28ce68(0x202)](),'order_id':_0x17fe78,'result_url':_0x58b754,'return_url':_0x42f6af,'country':'','card':{'number':_0x1dcebd[_0x28ce68(0x275)],'expire_month':_0x1dcebd[_0x28ce68(0x250)],'expire_year':_0x1dcebd[_0x28ce68(0x245)],'cvv':_0x1dcebd[_0x28ce68(0x240)]},'card_holder':_0xa1d2d0,'browser':_0x413e89},_0x1e8dbb=JSON['stringify'](_0x40d083);console['log'](_0x28ce68(0x242)),console[_0x28ce68(0x20e)](_0x28ce68(0x1d5)),console[_0x28ce68(0x20e)](_0x1e8dbb),console[_0x28ce68(0x20e)]('📝\x20Data\x20length:',_0x1e8dbb[_0x28ce68(0x2de)]);try{const {key:_0x4f39c4,iv:_0x171dd0}=this[_0x28ce68(0x1e3)]();console[_0x28ce68(0x20e)](_0x28ce68(0x25e)),console[_0x28ce68(0x20e)]('🔐\x20AES\x20key\x20length:',_0x4f39c4[_0x28ce68(0x2de)]),console[_0x28ce68(0x20e)]('🔐\x20AES\x20IV\x20length:',_0x171dd0[_0x28ce68(0x2de)]);const _0x4b7a41=this['encryptAES'](_0x1e8dbb,_0x4f39c4,_0x171dd0);console[_0x28ce68(0x20e)]('🔐\x20Data\x20encrypted\x20with\x20AES'),console['log'](_0x28ce68(0x267),_0x4b7a41[_0x28ce68(0x2de)]);const _0x317142=this[_0x28ce68(0x211)](_0x4f39c4,_0x171dd0,_0x8baea['publicKeyPath']);console[_0x28ce68(0x20e)](_0x28ce68(0x2c2)),console[_0x28ce68(0x20e)](_0x28ce68(0x1ed),_0x317142[_0x28ce68(0x2de)]);const _0x3c489c=this['signRSA'](_0x1e8dbb,_0x8baea[_0x28ce68(0x2c6)]);console[_0x28ce68(0x20e)]('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x28ce68(0x20e)](_0x28ce68(0x1d3),_0x3c489c['length']);const _0x5eec98={'merchant_point_id':_0x8baea[_0x28ce68(0x25d)],'method':_0x28ce68(0x297),'info':_0x4b7a41,'key':_0x317142,'sign':_0x3c489c,'lang':'en'};console[_0x28ce68(0x20e)](_0x28ce68(0x215)),console[_0x28ce68(0x20e)](_0x28ce68(0x21c)),console[_0x28ce68(0x20e)]('\x20\x20\x20-\x20merchant_point_id:',_0x8baea[_0x28ce68(0x25d)]),console[_0x28ce68(0x20e)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x28ce68(0x20e)](_0x28ce68(0x207),_0x4b7a41[_0x28ce68(0x2de)]),console[_0x28ce68(0x20e)](_0x28ce68(0x1e8),_0x317142[_0x28ce68(0x2de)]),console[_0x28ce68(0x20e)]('\x20\x20\x20-\x20sign\x20length:',_0x3c489c['length']),console[_0x28ce68(0x20e)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x28ce68(0x23e)][_0x28ce68(0x218)](_0x8baea[_0x28ce68(0x1c6)][_0x28ce68(0x1d0)](),_0x28ce68(0x2dc),'POST',{'merchant_point_id':_0x8baea[_0x28ce68(0x25d)],'method':_0x28ce68(0x297),'lang':'en'});const _0x4c2aa8=Date[_0x28ce68(0x2d6)](),_0x2bb45a=await fetch(_0x8baea[_0x28ce68(0x2b4)],{'method':_0x28ce68(0x1d2),'headers':{'Content-Type':_0x28ce68(0x1ea),'Accept':_0x28ce68(0x1ea),'User-Agent':_0x28ce68(0x225)},'body':JSON['stringify'](_0x5eec98)}),_0x39ed4b=Date[_0x28ce68(0x2d6)]()-_0x4c2aa8;console[_0x28ce68(0x20e)](_0x28ce68(0x248)),console[_0x28ce68(0x20e)]('Status:',_0x2bb45a[_0x28ce68(0x2a9)]),console[_0x28ce68(0x20e)](_0x28ce68(0x22b),_0x39ed4b+'ms');if(!_0x2bb45a['ok']){const _0x189b55=await _0x2bb45a['text']();console[_0x28ce68(0x2b5)](_0x28ce68(0x2c5),_0x2bb45a[_0x28ce68(0x2a9)]),console['error'](_0x28ce68(0x26c),_0x189b55),loggerService_1[_0x28ce68(0x23e)][_0x28ce68(0x2b8)](_0x8baea[_0x28ce68(0x1c6)][_0x28ce68(0x1d0)](),_0x28ce68(0x249),_0x2bb45a[_0x28ce68(0x2a9)],_0x189b55,_0x39ed4b),loggerService_1[_0x28ce68(0x23e)]['logWhiteDomainError'](_0x8baea[_0x28ce68(0x1c6)][_0x28ce68(0x1d0)](),_0x28ce68(0x2dc),_0x28ce68(0x252)+_0x2bb45a[_0x28ce68(0x2a9)]+':\x20'+_0x189b55);throw new Error(_0x28ce68(0x27e)+_0x2bb45a[_0x28ce68(0x2a9)]+_0x28ce68(0x24e)+_0x189b55);}const _0x272b9e=await _0x2bb45a[_0x28ce68(0x23c)]();loggerService_1[_0x28ce68(0x23e)][_0x28ce68(0x2b8)](_0x8baea['cardType'][_0x28ce68(0x1d0)](),_0x28ce68(0x249),_0x2bb45a[_0x28ce68(0x2a9)],_0x272b9e,_0x39ed4b),console[_0x28ce68(0x20e)](_0x28ce68(0x2bf));let _0x3ef1e6=_0x272b9e;if(_0x272b9e[_0x28ce68(0x1d4)]&&_0x272b9e['key']&&_0x272b9e[_0x28ce68(0x21b)]){console[_0x28ce68(0x20e)](_0x28ce68(0x259));try{const _0x463e5a=await this['decryptResponsePhp'](_0x272b9e[_0x28ce68(0x1d4)],_0x272b9e[_0x28ce68(0x295)],_0x8baea[_0x28ce68(0x1c6)]);_0x3ef1e6=JSON[_0x28ce68(0x1bd)](_0x463e5a),console[_0x28ce68(0x20e)](_0x28ce68(0x262)),loggerService_1[_0x28ce68(0x23e)][_0x28ce68(0x2b8)](_0x8baea[_0x28ce68(0x1c6)][_0x28ce68(0x1d0)](),_0x28ce68(0x234),_0x2bb45a['status'],_0x3ef1e6,_0x39ed4b),console[_0x28ce68(0x20e)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x36f0c9){console['error'](_0x28ce68(0x278),_0x36f0c9),loggerService_1[_0x28ce68(0x23e)][_0x28ce68(0x2a3)](_0x8baea[_0x28ce68(0x1c6)][_0x28ce68(0x1d0)](),_0x28ce68(0x1fa),_0x28ce68(0x23d)+_0x36f0c9),_0x3ef1e6=_0x272b9e;}}else loggerService_1[_0x28ce68(0x23e)][_0x28ce68(0x2b8)](_0x8baea['cardType'][_0x28ce68(0x1d0)](),'/charge_decrypted',_0x2bb45a[_0x28ce68(0x2a9)],_0x3ef1e6,_0x39ed4b),console[_0x28ce68(0x20e)](_0x28ce68(0x258));console[_0x28ce68(0x20e)](_0x28ce68(0x228),_0x3ef1e6[_0x28ce68(0x2a9)]),console['log'](_0x28ce68(0x2bd),_0x3ef1e6[_0x28ce68(0x1b9)]),console[_0x28ce68(0x20e)]('Payment\x20ID:',_0x3ef1e6[_0x28ce68(0x1ee)]),console[_0x28ce68(0x20e)]('3DS\x20URL:',_0x3ef1e6[_0x28ce68(0x2ad)]||_0x28ce68(0x1cc));if(_0x3ef1e6[_0x28ce68(0x2a9)]===0x64&&_0x3ef1e6['final']===0x1)return console[_0x28ce68(0x20e)](_0x28ce68(0x1b5)),{'gateway_payment_id':_0x3ef1e6[_0x28ce68(0x1ee)]?.[_0x28ce68(0x261)](),'payment_url':_0x42f6af,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x3ef1e6[_0x28ce68(0x2ad)])return console['log'](_0x28ce68(0x216)),this[_0x28ce68(0x2c9)](_0x1eb262,_0x17fe78,_0x3ef1e6['payment_id']?.[_0x28ce68(0x261)]()||_0x17fe78,_0x8baea['cardType']),{'gateway_payment_id':_0x3ef1e6['payment_id']?.[_0x28ce68(0x261)](),'payment_url':_0x3ef1e6['3ds_url'],'requires_3ds':!![],'threeds_url':_0x3ef1e6[_0x28ce68(0x2ad)],'status':'PENDING','final':![]};let _0x437dc8=_0x3ef1e6['desc']||_0x3ef1e6[_0x28ce68(0x2c0)]||'Unknown\x20error',_0x115a52=_0x3ef1e6[_0x28ce68(0x2a9)],_0x3f8dc9=_0x3ef1e6[_0x28ce68(0x1b9)];return console[_0x28ce68(0x20e)](_0x28ce68(0x287)+_0x115a52+',\x20Final:\x20'+_0x3f8dc9+_0x28ce68(0x22d)+_0x437dc8),{'gateway_payment_id':_0x3ef1e6[_0x28ce68(0x1ee)]?.[_0x28ce68(0x261)](),'payment_url':_0x42f6af,'requires_3ds':![],'status':_0x28ce68(0x1fe),'final':!![]};}catch(_0x4fec32){console[_0x28ce68(0x2b5)](_0x28ce68(0x1f5)),console['error'](_0x28ce68(0x277),_0x4fec32),loggerService_1[_0x28ce68(0x23e)]['logWhiteDomainError'](_0x28ce68(0x1b8),_0x28ce68(0x2dc),_0x4fec32);throw new Error(_0x28ce68(0x236)+(_0x4fec32 instanceof Error?_0x4fec32[_0x28ce68(0x2c0)]:'Unknown\x20error'));}}async['checkPaymentStatus'](_0x4b89c2,_0x58adc9,_0x77cae2='VISA'){const _0x307543=a48_0x2abc75;console['log'](_0x307543(0x2d2)+_0x77cae2+_0x307543(0x20f)+_0x4b89c2+'\x20('+_0x58adc9+')');try{const _0x32335e={'payment_id':_0x4b89c2,'order_id':_0x58adc9},_0x18757a=JSON[_0x307543(0x29d)](_0x32335e),_0x4d7f5e=this['getCardTypeAndApi'](_0x77cae2===_0x307543(0x237)?_0x307543(0x1e4):'5000000000000000'),{key:_0x3b7643,iv:_0x4c2108}=this[_0x307543(0x1e3)](),_0x59a69d=this[_0x307543(0x1e9)](_0x18757a,_0x3b7643,_0x4c2108),_0x137282=this[_0x307543(0x211)](_0x3b7643,_0x4c2108,_0x4d7f5e[_0x307543(0x1db)]),_0x55bbad=this['signRSA'](_0x18757a,_0x4d7f5e[_0x307543(0x2c6)]),_0x3702e7={'merchant_point_id':_0x4d7f5e[_0x307543(0x25d)],'method':_0x307543(0x2a9),'info':_0x59a69d,'key':_0x137282,'sign':_0x55bbad,'lang':'en'};loggerService_1[_0x307543(0x23e)][_0x307543(0x218)](_0x77cae2[_0x307543(0x1d0)](),_0x307543(0x272),'POST',{'merchant_point_id':_0x4d7f5e['merchantPointId'],'method':'status','lang':'en'});const _0x8e28e3=Date[_0x307543(0x2d6)](),_0x279ab3=await fetch(_0x4d7f5e[_0x307543(0x2b4)],{'method':_0x307543(0x1d2),'headers':{'Content-Type':_0x307543(0x1ea),'Accept':_0x307543(0x1ea),'User-Agent':_0x307543(0x225)},'body':JSON[_0x307543(0x29d)](_0x3702e7)}),_0x3c3614=Date['now']()-_0x8e28e3;if(!_0x279ab3['ok']){const _0x5e200b=await _0x279ab3[_0x307543(0x223)]();loggerService_1[_0x307543(0x23e)]['logWhiteDomainResponse'](_0x77cae2[_0x307543(0x1d0)](),'/status_raw',_0x279ab3[_0x307543(0x2a9)],_0x5e200b,_0x3c3614);throw new Error(_0x307543(0x27e)+_0x279ab3['status']);}const _0x3bb840=await _0x279ab3[_0x307543(0x23c)]();loggerService_1['loggerService'][_0x307543(0x2b8)](_0x77cae2[_0x307543(0x1d0)](),_0x307543(0x229),_0x279ab3[_0x307543(0x2a9)],_0x3bb840,_0x3c3614);let _0x3a4fac=_0x3bb840;if(_0x3bb840[_0x307543(0x1d4)]&&_0x3bb840[_0x307543(0x295)]&&_0x3bb840['sign']){console[_0x307543(0x20e)](_0x307543(0x2bb));try{const _0x1b95e7=await this[_0x307543(0x1d7)](_0x3bb840['info'],_0x3bb840[_0x307543(0x295)],_0x77cae2);_0x3a4fac=JSON[_0x307543(0x1bd)](_0x1b95e7),console['log']('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x307543(0x23e)][_0x307543(0x2b8)](_0x77cae2['toLowerCase'](),_0x307543(0x21d),_0x279ab3['status'],_0x3a4fac,_0x3c3614),console['log'](_0x307543(0x268));}catch(_0x3a4063){console[_0x307543(0x2b5)]('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x3a4063),loggerService_1['loggerService'][_0x307543(0x2a3)](_0x77cae2[_0x307543(0x1d0)](),_0x307543(0x284),_0x307543(0x1fb)+_0x3a4063),_0x3a4fac=_0x3bb840;}}else loggerService_1[_0x307543(0x23e)][_0x307543(0x2b8)](_0x77cae2[_0x307543(0x1d0)](),'/status_decrypted',_0x279ab3[_0x307543(0x2a9)],_0x3a4fac,_0x3c3614),console[_0x307543(0x20e)]('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x307543(0x20e)]('📊\x20Status\x20check\x20result:',{'status':_0x3a4fac['status'],'final':_0x3a4fac[_0x307543(0x1b9)],'payment_id':_0x3a4fac[_0x307543(0x1ee)],'desc':_0x3a4fac[_0x307543(0x2b2)]});let _0x502f48=_0x307543(0x2cd);if(_0x3a4fac[_0x307543(0x2a9)]===0x64&&_0x3a4fac[_0x307543(0x1b9)]===0x1)_0x502f48='PAID';else{if(_0x3a4fac[_0x307543(0x1b9)]===0x0)_0x502f48=_0x307543(0x2cd);else _0x3a4fac[_0x307543(0x1b9)]===0x1&&_0x3a4fac[_0x307543(0x2a9)]!==0x64?_0x502f48='FAILED':_0x502f48=_0x307543(0x2cd);}return{'status':_0x502f48,'final':_0x3a4fac[_0x307543(0x1b9)]===0x1,'amount':_0x3a4fac['amount'],'currency':_0x3a4fac[_0x307543(0x2ba)],'date_success':_0x3a4fac[_0x307543(0x220)],'description':_0x3a4fac['desc']};}catch(_0x3f2650){console['error'](_0x77cae2+'\x20status\x20check\x20error:',_0x3f2650),loggerService_1[_0x307543(0x23e)][_0x307543(0x2a3)](_0x77cae2[_0x307543(0x1d0)](),'/status',_0x3f2650);throw new Error(_0x307543(0x2b9)+_0x77cae2+'\x20payment\x20status:\x20'+(_0x3f2650 instanceof Error?_0x3f2650['message']:_0x307543(0x27f)));}}[a48_0x2abc75(0x2c9)](_0x492131,_0x1738df,_0x4c709c,_0x5d4372){const _0x1d226f=a48_0x2abc75;console[_0x1d226f(0x20e)](_0x1d226f(0x1da)+_0x5d4372+'\x20payment:\x20'+_0x492131+'\x20('+_0x4c709c+')'),this[_0x1d226f(0x26b)](_0x492131);const _0xe1e781=[],_0xd801dd=0x5*0x3c*0x3e8,_0x42f2da=0x2*0x3c*0x3c*0x3e8,_0x327654=Math['floor'](_0x42f2da/_0xd801dd);console[_0x1d226f(0x20e)](_0x1d226f(0x24c)+_0x327654+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x3f5489=0x1;_0x3f5489<=_0x327654;_0x3f5489++){const _0x3b114f=setTimeout(async()=>{const _0x1b98eb=_0x1d226f;console[_0x1b98eb(0x20e)](_0x1b98eb(0x1c2)+_0x5d4372+_0x1b98eb(0x1b6)+_0x3f5489+'/'+_0x327654+_0x1b98eb(0x235)+_0x492131);try{const _0x27f741=await this[_0x1b98eb(0x29e)](_0x4c709c,_0x1738df,_0x5d4372);console[_0x1b98eb(0x20e)]('📊\x20Status\x20check\x20#'+_0x3f5489+_0x1b98eb(0x2d3),_0x27f741),_0x27f741['final']&&(console[_0x1b98eb(0x20e)](_0x1b98eb(0x2c8)+_0x492131+_0x1b98eb(0x204)+_0x27f741[_0x1b98eb(0x2a9)]+'),\x20stopping\x20status\x20checks'),this[_0x1b98eb(0x26b)](_0x492131),await this[_0x1b98eb(0x24a)](_0x492131,_0x27f741[_0x1b98eb(0x2a9)],_0x27f741));}catch(_0xea1ba5){console[_0x1b98eb(0x2b5)](_0x1b98eb(0x1f6)+_0x3f5489+'\x20failed\x20for\x20payment\x20'+_0x492131+':',_0xea1ba5);}},_0x3f5489*_0xd801dd);_0xe1e781[_0x1d226f(0x276)](_0x3b114f);}this[_0x1d226f(0x25f)]['set'](_0x492131,_0xe1e781),console['log'](_0x1d226f(0x2c4)+_0x327654+_0x1d226f(0x29f)+_0x492131);}['clearStatusTimers'](_0x54a1a7){const _0x464cd3=a48_0x2abc75,_0x4341d4=this[_0x464cd3(0x25f)][_0x464cd3(0x256)](_0x54a1a7);_0x4341d4&&(console[_0x464cd3(0x20e)](_0x464cd3(0x280)+_0x4341d4[_0x464cd3(0x2de)]+_0x464cd3(0x2b7)+_0x54a1a7),_0x4341d4[_0x464cd3(0x2cb)]((_0x5666e2,_0x4d4260)=>{clearTimeout(_0x5666e2);}),this[_0x464cd3(0x25f)][_0x464cd3(0x2b0)](_0x54a1a7));}async[a48_0x2abc75(0x24a)](_0x1d89b5,_0xb1f480,_0x5baad2){const _0xfb06de=a48_0x2abc75;try{const _0x14883c=(await Promise[_0xfb06de(0x20b)]()[_0xfb06de(0x290)](()=>__importStar(require(_0xfb06de(0x227)))))[_0xfb06de(0x1f3)],_0x277304={'status':_0xb1f480[_0xfb06de(0x202)](),'updatedAt':new Date(),'statusChangedBy':_0xfb06de(0x2b6),'statusChangedAt':new Date()};_0xb1f480===_0xfb06de(0x1d6)&&(_0x277304[_0xfb06de(0x1e2)]=new Date()),_0xb1f480===_0xfb06de(0x1fe)&&_0x5baad2[_0xfb06de(0x273)]&&(_0x277304['failureMessage']=_0x5baad2[_0xfb06de(0x273)],console[_0xfb06de(0x20e)](_0xfb06de(0x23a)+_0x5baad2['description'])),_0x5baad2[_0xfb06de(0x273)]&&(_0x277304[_0xfb06de(0x26a)]=(_0xb1f480===_0xfb06de(0x1d6)?_0xfb06de(0x1d8):_0xfb06de(0x299))+':\x20'+_0x5baad2[_0xfb06de(0x273)]),await _0x14883c[_0xfb06de(0x266)][_0xfb06de(0x20c)]({'where':{'id':_0x1d89b5},'data':_0x277304}),console['log'](_0xfb06de(0x2c8)+_0x1d89b5+_0xfb06de(0x231)+_0xb1f480),await this[_0xfb06de(0x1e5)](_0x1d89b5,_0xb1f480);}catch(_0x418186){console[_0xfb06de(0x2b5)](_0xfb06de(0x2aa)+_0x1d89b5+':',_0x418186);}}async[a48_0x2abc75(0x1e5)](_0x2d6f4c,_0x466563){const _0x2254a6=a48_0x2abc75;try{const _0xc844aa=(await Promise[_0x2254a6(0x20b)]()[_0x2254a6(0x290)](()=>__importStar(require('../../config/database'))))[_0x2254a6(0x1f3)],{telegramBotService:_0x1f11fb}=await Promise['resolve']()['then'](()=>__importStar(require('../telegramBotService'))),_0x407be5=await _0xc844aa[_0x2254a6(0x266)][_0x2254a6(0x219)]({'where':{'id':_0x2d6f4c},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x407be5)return;const _0x5a7548={'PAID':_0x2254a6(0x2ae),'FAILED':_0x2254a6(0x205)},_0x51ee23=_0x5a7548[_0x466563];_0x51ee23&&await _0x1f11fb[_0x2254a6(0x1e6)](_0x407be5['shopId'],_0x407be5,_0x51ee23),await this['sendShopWebhook'](_0x407be5,_0x466563);}catch(_0x484351){console[_0x2254a6(0x2b5)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x484351);}}async['sendShopWebhook'](_0x443a08,_0x336f87){const _0x34ea66=a48_0x2abc75,_0x82bf3a=Date[_0x34ea66(0x2d6)]();try{const _0x327f4e=_0x443a08[_0x34ea66(0x1bf)],_0x456313=_0x327f4e[_0x34ea66(0x22c)];if(!_0x456313?.['webhookUrl']){console[_0x34ea66(0x20e)](_0x34ea66(0x1f2)+_0x327f4e['id']);return;}const _0x1c9515=_0x336f87==='PAID'?_0x34ea66(0x271):'payment.failed';let _0x468ed4=[];if(_0x456313[_0x34ea66(0x292)])try{_0x468ed4=Array['isArray'](_0x456313['webhookEvents'])?_0x456313[_0x34ea66(0x292)]:JSON[_0x34ea66(0x1bd)](_0x456313['webhookEvents']);}catch(_0x3154d0){console['error'](_0x34ea66(0x25a),_0x3154d0),_0x468ed4=[];}if(!_0x468ed4[_0x34ea66(0x246)](_0x1c9515)){console[_0x34ea66(0x20e)](_0x34ea66(0x2d4)+_0x1c9515+_0x34ea66(0x1ba)+_0x327f4e['id']);return;}const _0x433194={'event':_0x1c9515,'payment':{'id':_0x443a08['id'],'order_id':_0x443a08[_0x34ea66(0x282)],'gateway_order_id':_0x443a08[_0x34ea66(0x25c)],'gateway':_0x34ea66(0x28a),'amount':_0x443a08[_0x34ea66(0x1f0)],'currency':_0x443a08[_0x34ea66(0x2ba)],'status':_0x336f87[_0x34ea66(0x1d0)](),'customer_email':_0x443a08[_0x34ea66(0x25b)],'customer_name':_0x443a08[_0x34ea66(0x270)],'created_at':_0x443a08[_0x34ea66(0x1c7)],'updated_at':new Date()}},_0x522499=await fetch(_0x456313[_0x34ea66(0x2be)],{'method':'POST','headers':{'Content-Type':_0x34ea66(0x1ea),'User-Agent':_0x34ea66(0x253)},'body':JSON[_0x34ea66(0x29d)](_0x433194)}),_0x2317ef=Date[_0x34ea66(0x2d6)]()-_0x82bf3a;loggerService_1[_0x34ea66(0x23e)][_0x34ea66(0x24b)](_0x443a08['shopId'],_0x456313[_0x34ea66(0x2be)],_0x1c9515,_0x522499[_0x34ea66(0x2a9)],_0x2317ef,_0x433194),console['log']('MasterCard\x20webhook\x20sent\x20to\x20'+_0x456313[_0x34ea66(0x2be)]+'\x20with\x20status\x20'+_0x522499[_0x34ea66(0x2a9)]+'\x20('+_0x2317ef+_0x34ea66(0x210));}catch(_0x420410){console['error'](_0x34ea66(0x1c8),_0x420410),loggerService_1[_0x34ea66(0x23e)]['logShopWebhookError'](_0x443a08[_0x34ea66(0x222)],_0x443a08['shop']?.[_0x34ea66(0x22c)]?.[_0x34ea66(0x2be)]||'unknown',_0x34ea66(0x1f7),_0x420410,{});}}[a48_0x2abc75(0x2a1)](_0x4d8597){const _0x4040dd=a48_0x2abc75,_0x227953=_0x4d8597[_0x4040dd(0x2a2)](/[\s-]/g,'');if(_0x227953[_0x4040dd(0x2de)]<0x4)return _0x4040dd(0x230);return _0x4040dd(0x239)+_0x227953[_0x4040dd(0x27a)](-0x4);}async[a48_0x2abc75(0x2ce)](_0x5863c5,_0x38e1a7=a48_0x2abc75(0x1b4)){const _0x1cf8c9=a48_0x2abc75;console[_0x1cf8c9(0x20e)](_0x1cf8c9(0x257),JSON[_0x1cf8c9(0x29d)](_0x5863c5,null,0x2));let _0x281283=_0x5863c5,_0x49052c=_0x38e1a7;_0x5863c5[_0x1cf8c9(0x212)]?(_0x49052c=_0x5863c5[_0x1cf8c9(0x212)][_0x1cf8c9(0x202)]()===_0x1cf8c9(0x237)?'VISA':_0x1cf8c9(0x1b4),console[_0x1cf8c9(0x20e)](_0x1cf8c9(0x2a0)+_0x49052c)):console[_0x1cf8c9(0x20e)]('🔍\x20Using\x20provided\x20card\x20type:\x20'+_0x49052c);if(_0x5863c5[_0x1cf8c9(0x1d4)]&&_0x5863c5[_0x1cf8c9(0x295)]&&_0x5863c5['sign']){console['log']('🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...');try{const _0x3f5927=await this[_0x1cf8c9(0x1d7)](_0x5863c5['info'],_0x5863c5['key'],_0x49052c);_0x281283=JSON[_0x1cf8c9(0x1bd)](_0x3f5927),console[_0x1cf8c9(0x20e)](_0x1cf8c9(0x217)),console[_0x1cf8c9(0x20e)](_0x1cf8c9(0x2d5),JSON[_0x1cf8c9(0x29d)](_0x281283,null,0x2));}catch(_0x2d8c6e){console['error'](_0x1cf8c9(0x1dc),_0x2d8c6e),console[_0x1cf8c9(0x20e)]('⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted'),_0x281283=_0x5863c5;}}else console[_0x1cf8c9(0x20e)](_0x1cf8c9(0x1c0));let _0x2d4763='PENDING';if(_0x281283[_0x1cf8c9(0x2a9)]===0x64&&_0x281283['final']===0x1)_0x2d4763=_0x1cf8c9(0x1d6);else{if(_0x281283[_0x1cf8c9(0x1b9)]===0x0)_0x2d4763=_0x1cf8c9(0x2cd);else _0x281283[_0x1cf8c9(0x1b9)]===0x1&&_0x281283[_0x1cf8c9(0x2a9)]!==0x64?_0x2d4763=_0x1cf8c9(0x1fe):_0x2d4763=_0x1cf8c9(0x2cd);}let _0x248a7d='';if(_0x281283[_0x1cf8c9(0x2d8)])_0x248a7d=_0x281283[_0x1cf8c9(0x2d8)][_0x1cf8c9(0x261)](),console[_0x1cf8c9(0x20e)]('🔍\x20Using\x20'+_0x49052c+_0x1cf8c9(0x1c4)+_0x248a7d);else _0x281283['payment_id']?(_0x248a7d=_0x281283['payment_id']['toString'](),console['log']('🔍\x20Using\x20'+_0x49052c+'\x20payment_id\x20for\x20search:\x20'+_0x248a7d)):(_0x248a7d=_0x281283[_0x1cf8c9(0x282)]||_0x281283[_0x1cf8c9(0x2b3)]||_0x281283['id']||'',console[_0x1cf8c9(0x20e)]('🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20'+_0x248a7d));console[_0x1cf8c9(0x20e)](_0x1cf8c9(0x208)+_0x49052c+_0x1cf8c9(0x1ca)),console[_0x1cf8c9(0x20e)](_0x1cf8c9(0x241)+_0x248a7d+'\x20(from:\x20order_id='+_0x281283['order_id']+',\x20orderId='+_0x281283['orderId']+_0x1cf8c9(0x26e)+_0x281283[_0x1cf8c9(0x1ee)]+',\x20paymentId='+_0x281283['paymentId']+_0x1cf8c9(0x1f9)+_0x281283['id']+')'),console['log'](_0x1cf8c9(0x1c5)+_0x2d4763+_0x1cf8c9(0x1cd)+_0x281283[_0x1cf8c9(0x2a9)]+_0x1cf8c9(0x206)+_0x281283[_0x1cf8c9(0x1b9)]+')'),console[_0x1cf8c9(0x20e)](_0x1cf8c9(0x21e)+_0x281283['amount']),console[_0x1cf8c9(0x20e)]('\x20\x20\x20Currency:\x20'+_0x281283[_0x1cf8c9(0x2ba)]);let _0x10b0f2;_0x2d4763==='FAILED'&&_0x281283[_0x1cf8c9(0x2b2)]&&(_0x10b0f2=_0x281283[_0x1cf8c9(0x2b2)],console['log'](_0x1cf8c9(0x1ef)+_0x10b0f2));const _0x16981c={'paymentId':_0x248a7d,'status':_0x2d4763,'amount':_0x281283[_0x1cf8c9(0x1f0)],'currency':_0x281283['currency']};return _0x10b0f2&&(_0x16981c[_0x1cf8c9(0x274)]=_0x10b0f2),_0x16981c;}[a48_0x2abc75(0x2d7)](){const _0x4654a7=a48_0x2abc75;console[_0x4654a7(0x20e)](_0x4654a7(0x28d));const _0x9bab06=this['statusCheckTimers'][_0x4654a7(0x1f8)];for(const [_0x43e9cd]of this[_0x4654a7(0x25f)]){this[_0x4654a7(0x26b)](_0x43e9cd);}console['log']('🛑\x20Stopped\x20'+_0x9bab06+'\x20MasterCard\x20status\x20check\x20timers');}}exports['VisaMasterCardService']=VisaMasterCardService;