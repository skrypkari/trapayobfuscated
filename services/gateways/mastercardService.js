'use strict';const a57_0x499ca9=a57_0x22cb;function a57_0x3562(){const _0x15f629=['Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','MASTERCARD','trim','paymentId','statusCheckTimers','Unknown\x20error','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','Order\x20ID:','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','121816UwazzH','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','Payment\x20ID:','Error\x20details:','Method\x20not\x20allowed','POST','\x20\x20\x20-\x20info\x20length:','randomBytes','paidAt','Failed\x20to\x20send\x20MasterCard\x20webhook:','Sender\x20information\x20required','\x20status\x20timers\x20for\x20payment\x20','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Client\x20OTP\x20confirmation\x20required','length','call','ğŸ“\x20Encrypted\x20key\x20length:','30AinIIk','encryptRSA','-----END','privateKeyPath','validateKeyFiles','Payment\x20pending\x20verification','â°\x20Will\x20check\x20status\x20','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','createDecipheriv','visa_public.pem','Webhook\x20event\x20','âŒ\x20RSA\x20encryption\x20failed:','/status','logWhiteDomainError','âš ï¸\x20Expected\x20VISA\x20public\x20key:\x20','Awaiting\x20confirmation\x20in\x20the\x20application','clearStatusTimers','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','-----BEGIN','ğŸ”\x20AES\x20key\x20length:','createdAt','/charge_raw','â°\x20Scheduling\x20status\x20checks\x20for\x20','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','ğŸ”\x20Detected\x20card\x20type\x20from\x20webhook:\x20','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','orderId','Card\x20Number:','ğŸ§¹\x20Card\x20holder\x20names\x20cleaned:','https://api2.trapay.uk/decrypt.php','ğŸ“\x20Signature\x20length:','ğŸ“\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','replace','settings','âŒ\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','customerEmail','from','readFileSync','apiUrl','2035200pnlQwA','===\x20PARSED\x20API\x20RESPONSE\x20===','sendPaymentNotification','expire_month','webhookUrl','Expected\x20bitcoin\x20transfer\x20from\x20client','expire_year','amount',',\x20final=','parse','toUpperCase','****\x20****\x20****\x20','Amount:','ğŸ”\x20RSA\x20signing\x20successful','isArray','\x20\x20\x20Currency:\x20','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','3764UFmOAs','\x20\x20Original:\x20\x22','base64','No\x20New\x20payment','HTTP\x20','now','decryptAES','Invalid\x20expiration\x20date','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','signRSA','\x20characters','281RMgIlW','Failed\x20to\x20decrypt\x20response','\x20|\x20Response:\x20','failureMessage','path','ğŸ”\x20AES\x20IV\x20length:','VisaMasterCardService','order_id','get','ğŸ”\x20VISA\x20API\x20URL:','publicEncrypt','delete','ms)','hasOwnProperty','payment.failed','PENDING','logWhiteDomainRequest','ğŸ”\x20Data\x20signed\x20with\x20RSA','charAt','create','shop','createCipheriv','Status\x20','maskCardNumber','resolve','\x20status\x20updated\x20to\x20','visaMerchantPointId','Response\x20Time:','âœ…\x20Scheduled\x20','visaPublicKeyPath','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','15393FEWjLI','status','\x20\x20\x20-\x20key\x20length:','visa_private.pem','payment','default','\x20\x20Cleaned:\x20\x20\x22','732534RjOiAo','ğŸ§¹\x20Clearing\x20','sendShopWebhook','publicKeyPath','existsSync','push','utf8','\x22\x20|\x20\x22','Failed\x20payment',',\x20Final:\x20','ğŸ“\x20Data\x20length:','Decryption\x20failed:\x20','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','âŒ\x20VISA/MasterCard\x20key\x20validation\x20failed:','final','),\x20defaulting\x20to\x20MasterCard','date_success','customerName','âœ…\x20Payment\x20',',\x20id=','cvv','logShopWebhookSent','ğŸ”\x20','logShopWebhookError','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','ğŸ”\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','ğŸ’³\x20Unknown\x20card\x20type\x20(starts\x20with\x20','VISA','Response\x20Body:','LookUp\x20code\x20verified','Cash\x20payment\x20is\x20expected\x20at\x20TCO','forEach','configurable','FAILED','info','Status:','ğŸ”\x20VISA\x20Public\x20key\x20path:','Unsuccessful\x20payment','\x20\x20\x20-\x20lang:\x20en','number','masterCardApiUrl','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','stringify','ğŸ“Š\x20Status\x20check\x20result:','set','2485377gngpNq','Insufficient\x20funds\x20on\x20the\x20card','ğŸ“\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Status\x20decryption\x20failed:\x20','ğŸ“\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','Awaiting\x20confirmation\x20by\x20ivr\x20call','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','âŒ\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','masterCardMerchantPointId','35SXeyTc','ğŸ”\x20Response\x20is\x20encrypted,\x20decrypting...','first_name','json','\x20MasterCard\x20status\x20check\x20timers','ğŸ”\x20VISA\x20Private\x20key\x20path:','âš ï¸\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','paymentStatuses','âŒ\x20PHP\x20decryptor\x20request\x20failed:','PAID','ğŸ”\x20AES\x20key\x20and\x20IV\x20generated',',\x20body:\x20',':\x20Unknown\x20status\x20code','substring','join','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','decryptResponsePhp','ğŸ”\x20Using\x20keys:\x20','ğŸ“Š\x20Checking\x20','loggerService','/status_decrypted','\x20(from:\x20order_id=','payment.success','\x20\x20\x20Amount:\x20','../telegramBotService','Failed\x20to\x20check\x20','warn','visaPrivateKeyPath','sign','../../config/database','âŒ\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','webhookEvents','ğŸ“\x20Encrypted\x20data\x20length:','\x20(from:\x20status=','Recipient\x20data\x20required','scheduleStatusChecks','3DS\x20verification\x20required','ğŸ“Š\x20Status\x20check\x20#','âœ…\x20Status\x20response\x20decrypted\x20successfully','ğŸ”\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','description','ğŸ“¤\x20Sending\x20request\x20to\x20API...','slice','gatewayOrderId','ğŸ”\x20Using\x20provided\x20card\x20type:\x20','Payment\x20prohibited','3ds_url','application/json','ğŸ”\x20MasterCard\x20Public\x20key\x20path:','keys','HTTP\x20Status:','ğŸ”\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','Payment\x20is\x20being\x20processed','system','LookUp\x20not\x20confirmed','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','ğŸ’¾\x20Payment\x20data\x20prepared','psp_public.pem','Sender\x27s\x20card\x20details\x20are\x20required',',\x20payment_id=','48LybzYl','toString','__setModuleDefault','merchantPointId','ğŸ›‘\x20Stopped\x20','shopId','Another\x20unknown\x20error','key','Payment\x20returned','end','RSA_PKCS1_PADDING','cwd','last_name','Transaction\x20limit\x20exceeded','getOwnPropertyDescriptor','\x20\x20\x20-\x20merchant_point_id:','ğŸ’³\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','ğŸ’³\x20VISA/MasterCard\x20service\x20initialized','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','log','ğŸ“\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','cardType','\x20payment\x20status:\x20','charge','visaApiUrl','includes','errorMessage','âœ…\x20VISA\x20key\x20files\x20validated\x20successfully','message','generateAESKey','payment_id','Final:','sendPaymentNotifications','âŒ\x20Detailed\x20failure\x20description:\x20','toLowerCase','ğŸ“\x20Decrypted\x20webhook\x20data:','privateDecrypt','createSign','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','defineProperty','Test\x20payment','ğŸ”\x20Data\x20encrypted\x20with\x20AES','error',',\x20orderId=','then','ğŸ“\x20Data\x20to\x20sign\x20length:','ğŸ“\x20Final\x20request\x20structure:','failed','https://api.paydmeth.com/api','...','private.pem','===\x20API\x20RESPONSE\x20===','/charge','\x20status\x20check\x20#','1456YEtejR','âœ…\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','Payment\x20confirmation\x20required','text','../loggerService','checkPaymentStatus','\x20is\x20final\x20(','getOwnPropertyNames','****','ğŸ›‘\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','/charge_decrypt','isFinalStatus','unknown','card_type','/status_raw','Payment\x20System/1.0\x20(MasterCard)','encryptAES','__importDefault','âŒ\x20Data\x20being\x20signed:','MasterCard\x20webhook\x20sent\x20to\x20','âœ…\x20Payment\x20successful','none',',\x20paymentId=','aes-256-ctr','currency','ğŸ¯\x20Using\x20','__esModule','ğŸ’¾\x20Saving\x20failure\x20message:\x20','\x20payment:\x20','âŒ\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','\x20API:\x20','ğŸ”\x20MasterCard\x20API\x20URL:','paid','getCardTypeAndApi','714738KiUytG','LookUp\x20code\x20sent','getDetailedErrorMessage','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','\x20failed\x20for\x20payment\x20','/charge_decrypted','prototype','\x20\x20\x20-\x20sign\x20length:','âŒ\x20RSA\x20signing\x20failed:','logWhiteDomainResponse','desc','floor','processWebhook','update','ğŸ”\x20MasterCard\x20Private\x20key\x20path:','crypto','3DS\x20URL:','ğŸ”„\x20Processing\x20MasterCard\x20webhook\x20data:'];a57_0x3562=function(){return _0x15f629;};return a57_0x3562();}(function(_0x3896ed,_0x4a38df){const _0x2f75df=a57_0x22cb,_0xfeb928=_0x3896ed();while(!![]){try{const _0x4445bb=parseInt(_0x2f75df(0x207))/0x1*(-parseInt(_0x2f75df(0x1fc))/0x2)+-parseInt(_0x2f75df(0x2a1))/0x3*(parseInt(_0x2f75df(0x314))/0x4)+-parseInt(_0x2f75df(0x265))/0x5*(-parseInt(_0x2f75df(0x2f9))/0x6)+parseInt(_0x2f75df(0x226))/0x7*(-parseInt(_0x2f75df(0x2d7))/0x8)+parseInt(_0x2f75df(0x25c))/0x9*(parseInt(_0x2f75df(0x1c4))/0xa)+parseInt(_0x2f75df(0x22d))/0xb+parseInt(_0x2f75df(0x1eb))/0xc;if(_0x4445bb===_0x4a38df)break;else _0xfeb928['push'](_0xfeb928['shift']());}catch(_0x1893be){_0xfeb928['push'](_0xfeb928['shift']());}}}(a57_0x3562,0x75b8e));var __createBinding=this&&this['__createBinding']||(Object[a57_0x499ca9(0x21a)]?function(_0x17feaf,_0x434e4f,_0x1c2a53,_0x2ddb7b){const _0x4f0025=a57_0x499ca9;if(_0x2ddb7b===undefined)_0x2ddb7b=_0x1c2a53;var _0x569ab8=Object[_0x4f0025(0x2af)](_0x434e4f,_0x1c2a53);(!_0x569ab8||(_0x4f0025(0x20f)in _0x569ab8?!_0x434e4f[_0x4f0025(0x2f1)]:_0x569ab8['writable']||_0x569ab8[_0x4f0025(0x24f)]))&&(_0x569ab8={'enumerable':!![],'get':function(){return _0x434e4f[_0x1c2a53];}}),Object[_0x4f0025(0x2c8)](_0x17feaf,_0x2ddb7b,_0x569ab8);}:function(_0x469d5a,_0x158078,_0x306357,_0x2d4f2a){if(_0x2d4f2a===undefined)_0x2d4f2a=_0x306357;_0x469d5a[_0x2d4f2a]=_0x158078[_0x306357];}),__setModuleDefault=this&&this[a57_0x499ca9(0x2a3)]||(Object[a57_0x499ca9(0x21a)]?function(_0x2badb7,_0x1c69b6){const _0x437dc6=a57_0x499ca9;Object[_0x437dc6(0x2c8)](_0x2badb7,_0x437dc6(0x22b),{'enumerable':!![],'value':_0x1c69b6});}:function(_0x121d17,_0x442217){_0x121d17['default']=_0x442217;}),__importStar=this&&this['__importStar']||(function(){var _0x3bb129=function(_0x3a77d4){const _0x47b522=a57_0x22cb;return _0x3bb129=Object[_0x47b522(0x2de)]||function(_0x38306a){const _0x2bbc53=_0x47b522;var _0x2e4137=[];for(var _0x2b80a5 in _0x38306a)if(Object[_0x2bbc53(0x2ff)][_0x2bbc53(0x214)][_0x2bbc53(0x1c2)](_0x38306a,_0x2b80a5))_0x2e4137[_0x2e4137['length']]=_0x2b80a5;return _0x2e4137;},_0x3bb129(_0x3a77d4);};return function(_0x560a68){const _0x3a74a8=a57_0x22cb;if(_0x560a68&&_0x560a68['__esModule'])return _0x560a68;var _0x299caf={};if(_0x560a68!=null){for(var _0x39b19a=_0x3bb129(_0x560a68),_0x1eda86=0x0;_0x1eda86<_0x39b19a[_0x3a74a8(0x1c1)];_0x1eda86++)if(_0x39b19a[_0x1eda86]!==_0x3a74a8(0x22b))__createBinding(_0x299caf,_0x560a68,_0x39b19a[_0x1eda86]);}return __setModuleDefault(_0x299caf,_0x560a68),_0x299caf;};}()),__importDefault=this&&this[a57_0x499ca9(0x2e8)]||function(_0x396186){const _0x335f05=a57_0x499ca9;return _0x396186&&_0x396186[_0x335f05(0x2f1)]?_0x396186:{'default':_0x396186};};Object[a57_0x499ca9(0x2c8)](exports,a57_0x499ca9(0x2f1),{'value':!![]}),exports[a57_0x499ca9(0x20d)]=void 0x0;const crypto_1=__importDefault(require(a57_0x499ca9(0x308))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a57_0x499ca9(0x20b))),loggerService_1=require(a57_0x499ca9(0x2db));function a57_0x22cb(_0xbc3b6b,_0x459ce0){_0xbc3b6b=_0xbc3b6b-0x1bb;const _0x356277=a57_0x3562();let _0x22cb46=_0x356277[_0xbc3b6b];return _0x22cb46;}class VisaMasterCardService{constructor(){const _0x262d06=a57_0x499ca9;this['statusCheckTimers']=new Map(),this[_0x262d06(0x26c)]={0x0:{'final':![],'description':_0x262d06(0x1ff)},0x1:{'final':![],'description':'No\x20Error\x20executing\x20request'},0x2:{'final':!![],'description':'Request\x20data\x20error'},0x3:{'final':!![],'description':_0x262d06(0x2a7)},0x4:{'final':!![],'description':_0x262d06(0x254)},0x5:{'final':!![],'description':'Payment\x20not\x20found\x20using\x20the\x20specified\x20details'},0x6:{'final':!![],'description':_0x262d06(0x2a9)},0x7:{'final':!![],'description':_0x262d06(0x2c9)},0x8:{'final':![],'description':_0x262d06(0x1c0)},0x9:{'final':![],'description':'3DS\x20verification\x20required'},0xa:{'final':![],'description':'Sender\x27s\x20CVV\x20card\x20is\x20required'},0xb:{'final':![],'description':_0x262d06(0x1bd)},0xc:{'final':![],'description':_0x262d06(0x287)},0xd:{'final':![],'description':_0x262d06(0x30b)},0xe:{'final':![],'description':_0x262d06(0x261)},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':'Captcha\x20confirmation\x20awaited'},0x11:{'final':![],'description':_0x262d06(0x1d5)},0x12:{'final':![],'description':_0x262d06(0x1d3)},0x13:{'final':![],'description':_0x262d06(0x299)},0x14:{'final':![],'description':_0x262d06(0x258)},0x15:{'final':![],'description':_0x262d06(0x1f0)},0x16:{'final':![],'description':_0x262d06(0x1c9)},0x18:{'final':![],'description':'The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':_0x262d06(0x24d)},0x1b:{'final':![],'description':_0x262d06(0x2b3)},0x1c:{'final':![],'description':_0x262d06(0x204)},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':_0x262d06(0x313)},0x20:{'final':![],'description':_0x262d06(0x225)},0x23:{'final':![],'description':_0x262d06(0x29f)},0x24:{'final':!![],'description':'Payment\x20confirmation\x20time\x20has\x20expired'},0x25:{'final':!![],'description':_0x262d06(0x292)},0x26:{'final':!![],'description':'The\x20payment\x20status\x20must\x20be\x20clarified\x20manually'},0x27:{'final':!![],'description':_0x262d06(0x25d)},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':'The\x20card\x20is\x20lost\x20or\x20stolen'},0x2a:{'final':!![],'description':_0x262d06(0x203)},0x2b:{'final':!![],'description':_0x262d06(0x2ae)},0x2c:{'final':!![],'description':_0x262d06(0x2fc)},0x2d:{'final':!![],'description':'Failed\x20payment'},0x2e:{'final':!![],'description':_0x262d06(0x254)},0x2f:{'final':!![],'description':_0x262d06(0x254)},0x30:{'final':!![],'description':_0x262d06(0x239)},0x31:{'final':![],'description':_0x262d06(0x2d9)},0x32:{'final':!![],'description':_0x262d06(0x318)},0x33:{'final':!![],'description':_0x262d06(0x235)},0x34:{'final':!![],'description':_0x262d06(0x235)},0x35:{'final':!![],'description':_0x262d06(0x235)},0x36:{'final':!![],'description':_0x262d06(0x235)},0x37:{'final':!![],'description':_0x262d06(0x235)},0x38:{'final':!![],'description':'Cancellation\x20is\x20not\x20possible'},0x39:{'final':![],'description':_0x262d06(0x1db)},0x3a:{'final':![],'description':_0x262d06(0x2fa)},0x3b:{'final':!![],'description':_0x262d06(0x24c)},0x3c:{'final':!![],'description':'Number\x20of\x20attempts\x20exceeded'},0x3d:{'final':!![],'description':_0x262d06(0x29c)},0x3e:{'final':!![],'description':_0x262d06(0x245)},0x3f:{'final':!![],'description':_0x262d06(0x2a9)},0x40:{'final':![],'description':_0x262d06(0x29b)},0x41:{'final':!![],'description':'LookUp\x20number\x20of\x20attempts\x20exceeded'},0x42:{'final':![],'description':'Payment\x20cancellation\x20is\x20being\x20processed'},0x43:{'final':!![],'description':_0x262d06(0x262)},0x44:{'final':![],'description':_0x262d06(0x289)},0x45:{'final':!![],'description':_0x262d06(0x235)},0x46:{'final':!![],'description':'Failed\x20payment'},0x47:{'final':!![],'description':'Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details'},0x64:{'final':!![],'description':'Operation\x20completed\x20successfully'}},this[_0x262d06(0x257)]='https://api.paydmeth.com/api',this[_0x262d06(0x264)]=0x744,this['privateKeyPath']=path_1[_0x262d06(0x22b)][_0x262d06(0x273)](process[_0x262d06(0x2ac)](),_0x262d06(0x296),_0x262d06(0x2d3)),this['publicKeyPath']=path_1[_0x262d06(0x22b)][_0x262d06(0x273)](process[_0x262d06(0x2ac)](),_0x262d06(0x296),_0x262d06(0x29e)),this[_0x262d06(0x2b9)]=_0x262d06(0x2d1),this[_0x262d06(0x221)]=0x6b7,this[_0x262d06(0x280)]=path_1[_0x262d06(0x22b)]['join'](process[_0x262d06(0x2ac)](),_0x262d06(0x296),_0x262d06(0x229)),this[_0x262d06(0x224)]=path_1[_0x262d06(0x22b)][_0x262d06(0x273)](process[_0x262d06(0x2ac)](),'keys',_0x262d06(0x1cd)),console['log'](_0x262d06(0x2b2)),console[_0x262d06(0x2b4)](_0x262d06(0x2f6),this[_0x262d06(0x257)]),console[_0x262d06(0x2b4)](_0x262d06(0x210),this['visaApiUrl']),console[_0x262d06(0x2b4)](_0x262d06(0x307),this[_0x262d06(0x1c7)]),console['log'](_0x262d06(0x295),this['publicKeyPath']),console['log'](_0x262d06(0x26a),this[_0x262d06(0x280)]),console['log'](_0x262d06(0x253),this[_0x262d06(0x224)]),this[_0x262d06(0x1c8)]();}[a57_0x499ca9(0x2fb)](_0x39ae89,_0xe9d576){const _0x4b6a8f=a57_0x499ca9,_0x1de5d4=this[_0x4b6a8f(0x26c)][_0x39ae89];let _0x4de203='';_0x1de5d4?_0x4de203=_0x4b6a8f(0x21d)+_0x39ae89+':\x20'+_0x1de5d4[_0x4b6a8f(0x28d)]:_0x4de203=_0x4b6a8f(0x21d)+_0x39ae89+_0x4b6a8f(0x271);if(_0xe9d576&&_0xe9d576['trim']()){const _0x5b2918=_0xe9d576[_0x4b6a8f(0x30d)]();(!_0x1de5d4||_0x5b2918[_0x4b6a8f(0x2c3)]()!==_0x1de5d4[_0x4b6a8f(0x28d)][_0x4b6a8f(0x2c3)]())&&(_0x4de203+=_0x4b6a8f(0x209)+_0x5b2918);}return _0x4de203;}[a57_0x499ca9(0x2e2)](_0x5e3878){const _0x4b005e=a57_0x499ca9,_0x2180d0=this['paymentStatuses'][_0x5e3878];return _0x2180d0?_0x2180d0[_0x4b005e(0x23b)]:!![];}[a57_0x499ca9(0x2f8)](_0x500c75){const _0x443a6f=a57_0x499ca9,_0x3e9a76=_0x500c75[_0x443a6f(0x219)](0x0);if(_0x3e9a76==='4')return console[_0x443a6f(0x2b4)](_0x443a6f(0x2b1)),{'cardType':_0x443a6f(0x24a),'apiUrl':this[_0x443a6f(0x2b9)],'privateKeyPath':this['visaPrivateKeyPath'],'publicKeyPath':this[_0x443a6f(0x224)],'merchantPointId':this['visaMerchantPointId']};else return _0x3e9a76==='5'?(console['log']('ğŸ’³\x20Detected\x20MasterCard\x20(starts\x20with\x205)'),{'cardType':_0x443a6f(0x30c),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x443a6f(0x230)],'merchantPointId':this[_0x443a6f(0x264)]}):(console[_0x443a6f(0x2b4)](_0x443a6f(0x249)+_0x3e9a76+_0x443a6f(0x23c)),{'cardType':_0x443a6f(0x30c),'apiUrl':this[_0x443a6f(0x257)],'privateKeyPath':this[_0x443a6f(0x1c7)],'publicKeyPath':this[_0x443a6f(0x230)],'merchantPointId':this[_0x443a6f(0x264)]});}[a57_0x499ca9(0x1c8)](){const _0x508d1c=a57_0x499ca9;try{if(!fs_1[_0x508d1c(0x22b)][_0x508d1c(0x231)](this[_0x508d1c(0x1c7)]))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this[_0x508d1c(0x1c7)]);if(!fs_1[_0x508d1c(0x22b)][_0x508d1c(0x231)](this['publicKeyPath']))throw new Error(_0x508d1c(0x1fb)+this[_0x508d1c(0x230)]);const _0x42cca8=fs_1[_0x508d1c(0x22b)][_0x508d1c(0x1e9)](this[_0x508d1c(0x1c7)],_0x508d1c(0x233))[_0x508d1c(0x30d)](),_0x588bc9=fs_1[_0x508d1c(0x22b)][_0x508d1c(0x1e9)](this[_0x508d1c(0x230)],_0x508d1c(0x233))['trim']();if(!_0x42cca8['includes'](_0x508d1c(0x1d6))||!_0x42cca8[_0x508d1c(0x2ba)](_0x508d1c(0x1c6)))throw new Error(_0x508d1c(0x2c7));if(!_0x588bc9[_0x508d1c(0x2ba)](_0x508d1c(0x1d6))||!_0x588bc9[_0x508d1c(0x2ba)](_0x508d1c(0x1c6)))throw new Error(_0x508d1c(0x1bf));console['log']('âœ…\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console[_0x508d1c(0x2b4)]('ğŸ”\x20MasterCard\x20Private\x20key\x20length:\x20'+_0x42cca8[_0x508d1c(0x1c1)]+_0x508d1c(0x206)),console[_0x508d1c(0x2b4)]('ğŸ”\x20MasterCard\x20Public\x20key\x20length:\x20'+_0x588bc9['length']+_0x508d1c(0x206));if(fs_1[_0x508d1c(0x22b)][_0x508d1c(0x231)](this[_0x508d1c(0x280)])&&fs_1[_0x508d1c(0x22b)][_0x508d1c(0x231)](this['visaPublicKeyPath'])){const _0x3baa42=fs_1[_0x508d1c(0x22b)][_0x508d1c(0x1e9)](this[_0x508d1c(0x280)],_0x508d1c(0x233))['trim'](),_0x3480ac=fs_1[_0x508d1c(0x22b)]['readFileSync'](this['visaPublicKeyPath'],'utf8')[_0x508d1c(0x30d)]();(!_0x3baa42[_0x508d1c(0x2ba)](_0x508d1c(0x1d6))||!_0x3baa42[_0x508d1c(0x2ba)](_0x508d1c(0x1c6)))&&console[_0x508d1c(0x27f)]('âš ï¸\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),(!_0x3480ac['includes'](_0x508d1c(0x1d6))||!_0x3480ac[_0x508d1c(0x2ba)](_0x508d1c(0x1c6)))&&console[_0x508d1c(0x27f)](_0x508d1c(0x26b)),console[_0x508d1c(0x2b4)](_0x508d1c(0x2bc)),console[_0x508d1c(0x2b4)]('ğŸ”\x20VISA\x20Private\x20key\x20length:\x20'+_0x3baa42['length']+_0x508d1c(0x206)),console[_0x508d1c(0x2b4)]('ğŸ”\x20VISA\x20Public\x20key\x20length:\x20'+_0x3480ac['length']+_0x508d1c(0x206));}else console['warn']('âš ï¸\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available'),console[_0x508d1c(0x27f)]('âš ï¸\x20Expected\x20VISA\x20private\x20key:\x20'+this[_0x508d1c(0x280)]),console['warn'](_0x508d1c(0x1d2)+this['visaPublicKeyPath']);}catch(_0x5cb5e0){console['error'](_0x508d1c(0x23a),_0x5cb5e0);throw _0x5cb5e0;}}[a57_0x499ca9(0x2be)](){const _0x39a61c=a57_0x499ca9,_0x2ec48c=crypto_1[_0x39a61c(0x22b)][_0x39a61c(0x31b)](0x20),_0x1fb60f=crypto_1[_0x39a61c(0x22b)][_0x39a61c(0x31b)](0x10);return{'key':_0x2ec48c,'iv':_0x1fb60f};}['encryptAES'](_0x591aa0,_0xccac96,_0x5f1703){const _0x2c6bd9=a57_0x499ca9,_0x244b45=crypto_1[_0x2c6bd9(0x22b)][_0x2c6bd9(0x21c)](_0x2c6bd9(0x2ee),_0xccac96,_0x5f1703);let _0xe54208=_0x244b45['update'](_0x591aa0,_0x2c6bd9(0x233),_0x2c6bd9(0x1fe));return _0xe54208+=_0x244b45[_0x2c6bd9(0x23b)]('base64'),_0xe54208;}[a57_0x499ca9(0x1c5)](_0x5c41a9,_0x3fd188,_0x584535){const _0x4a3e36=a57_0x499ca9;try{const _0x5bebd7=fs_1['default'][_0x4a3e36(0x1e9)](_0x584535,_0x4a3e36(0x233))[_0x4a3e36(0x30d)](),_0x37a3fe={'iv':_0x3fd188[_0x4a3e36(0x2a2)]('base64'),'key':_0x5c41a9[_0x4a3e36(0x2a2)](_0x4a3e36(0x1fe))},_0x4c036b=JSON['stringify'](_0x37a3fe);console[_0x4a3e36(0x2b4)](_0x4a3e36(0x248),_0x4c036b[_0x4a3e36(0x1c1)]);const _0x36bc39=crypto_1[_0x4a3e36(0x22b)][_0x4a3e36(0x211)]({'key':_0x5bebd7,'padding':crypto_1['default']['constants'][_0x4a3e36(0x2ab)]},Buffer[_0x4a3e36(0x1e8)](_0x4c036b));return console[_0x4a3e36(0x2b4)]('âœ…\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x36bc39['length']),_0x36bc39[_0x4a3e36(0x2a2)](_0x4a3e36(0x1fe));}catch(_0x43e3a4){console[_0x4a3e36(0x2cb)](_0x4a3e36(0x1cf),_0x43e3a4);throw new Error(_0x4a3e36(0x274));}}[a57_0x499ca9(0x205)](_0x5d0ba3,_0x26a256){const _0x5c3f2f=a57_0x499ca9;try{const _0x77eba8=fs_1[_0x5c3f2f(0x22b)][_0x5c3f2f(0x1e9)](_0x26a256,_0x5c3f2f(0x233))[_0x5c3f2f(0x30d)](),_0x159549=crypto_1['default'][_0x5c3f2f(0x2c6)]('SHA256');_0x159549[_0x5c3f2f(0x306)](_0x5d0ba3),_0x159549[_0x5c3f2f(0x2aa)]();const _0x1423d7=_0x159549[_0x5c3f2f(0x281)](_0x77eba8,_0x5c3f2f(0x1fe));return console[_0x5c3f2f(0x2b4)](_0x5c3f2f(0x1f8)),console['log'](_0x5c3f2f(0x2ce),_0x5d0ba3['length']),console[_0x5c3f2f(0x2b4)](_0x5c3f2f(0x1e2),_0x1423d7[_0x5c3f2f(0x1c1)]),_0x1423d7;}catch(_0x2821c0){console[_0x5c3f2f(0x2cb)](_0x5c3f2f(0x301),_0x2821c0),console[_0x5c3f2f(0x2cb)](_0x5c3f2f(0x2e9),_0x5d0ba3[_0x5c3f2f(0x272)](0x0,0xc8)+_0x5c3f2f(0x2d2));throw new Error(_0x5c3f2f(0x1dd));}}[a57_0x499ca9(0x202)](_0x119eee,_0x23f7ea,_0x55f236){const _0x593322=a57_0x499ca9,_0x14c1c8=crypto_1[_0x593322(0x22b)][_0x593322(0x1cc)]('aes-256-ctr',_0x23f7ea,_0x55f236);let _0x517921=_0x14c1c8['update'](_0x119eee,'base64',_0x593322(0x233));return _0x517921+=_0x14c1c8[_0x593322(0x23b)](_0x593322(0x233)),_0x517921;}async[a57_0x499ca9(0x275)](_0x326ed2,_0x481810,_0x3a4240=a57_0x499ca9(0x30c)){const _0x5bc09b=a57_0x499ca9;try{const _0x57baa7=await fetch(_0x5bc09b(0x1e1),{'method':_0x5bc09b(0x319),'headers':{'Content-Type':_0x5bc09b(0x294)},'body':JSON[_0x5bc09b(0x259)]({'info':_0x326ed2,'key':_0x481810,'card_type':_0x3a4240['toLowerCase']()})});if(!_0x57baa7['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x57baa7[_0x5bc09b(0x2da)]();}catch(_0x37d508){console['error'](_0x5bc09b(0x26d),_0x37d508);throw new Error(_0x5bc09b(0x315));}}['decryptResponse'](_0x341ac7,_0x483027){const _0x42bede=a57_0x499ca9;try{const _0x3a0d0e=fs_1[_0x42bede(0x22b)][_0x42bede(0x1e9)](this['privateKeyPath'],'utf8')[_0x42bede(0x30d)](),_0x3118b0=crypto_1[_0x42bede(0x22b)][_0x42bede(0x2c5)](_0x3a0d0e,Buffer[_0x42bede(0x1e8)](_0x483027,_0x42bede(0x1fe))),_0x4cd66f=JSON[_0x42bede(0x1f4)](_0x3118b0['toString']()),_0xfb7e2a=Buffer[_0x42bede(0x1e8)](_0x4cd66f[_0x42bede(0x2a8)],_0x42bede(0x1fe)),_0x1a38ab=Buffer[_0x42bede(0x1e8)](_0x4cd66f['iv'],'base64');return this[_0x42bede(0x202)](_0x341ac7,_0xfb7e2a,_0x1a38ab);}catch(_0x5a6d62){throw new Error(_0x42bede(0x208));}}async['processCardPayment'](_0x355ed8){const _0x380ff3=a57_0x499ca9,{paymentId:_0x208d97,orderId:_0x1a0188,amount:_0x3c4a7e,currency:_0x139fda,cardData:_0xe88a1b,resultUrl:_0x520979,returnUrl:_0x4e82e3,cardHolder:_0x37d31e,browser:_0x3aeaf5}=_0x355ed8;console[_0x380ff3(0x2b4)](_0x380ff3(0x311)),console[_0x380ff3(0x2b4)](_0x380ff3(0x316),_0x208d97),console['log'](_0x380ff3(0x312),_0x1a0188),console[_0x380ff3(0x2b4)](_0x380ff3(0x1f7),_0x3c4a7e,_0x139fda),console[_0x380ff3(0x2b4)](_0x380ff3(0x1df),this[_0x380ff3(0x21e)](_0xe88a1b['number'])),console['log']('Card\x20Holder:',_0x37d31e[_0x380ff3(0x267)]+'\x20'+_0x37d31e[_0x380ff3(0x2ad)]),console['log']('Return\x20URL:',_0x4e82e3),console[_0x380ff3(0x2b4)]('Result\x20URL:',_0x520979);const _0x1ed360=this['getCardTypeAndApi'](_0xe88a1b['number']);console[_0x380ff3(0x2b4)](_0x380ff3(0x2f0)+_0x1ed360[_0x380ff3(0x2b6)]+_0x380ff3(0x2f5)+_0x1ed360[_0x380ff3(0x1ea)]),console[_0x380ff3(0x2b4)](_0x380ff3(0x276)+_0x1ed360[_0x380ff3(0x1c7)]+',\x20'+_0x1ed360[_0x380ff3(0x230)]);const _0x2b226a={..._0x37d31e,'first_name':_0x37d31e['first_name']?.[_0x380ff3(0x1e4)](/[\t\n\r\f\v]/g,'\x20')['trim']()||'','last_name':_0x37d31e[_0x380ff3(0x2ad)]?.[_0x380ff3(0x1e4)](/[\t\n\r\f\v]/g,'\x20')[_0x380ff3(0x30d)]()||''};console[_0x380ff3(0x2b4)](_0x380ff3(0x1e0)),console['log'](_0x380ff3(0x1fd)+_0x37d31e[_0x380ff3(0x267)]+_0x380ff3(0x234)+_0x37d31e[_0x380ff3(0x2ad)]+'\x22'),console[_0x380ff3(0x2b4)](_0x380ff3(0x22c)+_0x2b226a[_0x380ff3(0x267)]+_0x380ff3(0x234)+_0x2b226a[_0x380ff3(0x2ad)]+'\x22');const _0x33d6a1={'amount':_0x3c4a7e,'currency':_0x139fda['toUpperCase'](),'order_id':_0x1a0188,'result_url':_0x520979,'return_url':_0x4e82e3,'country':'','card':{'number':_0xe88a1b[_0x380ff3(0x256)],'expire_month':_0xe88a1b[_0x380ff3(0x1ee)],'expire_year':_0xe88a1b[_0x380ff3(0x1f1)],'cvv':_0xe88a1b[_0x380ff3(0x241)]},'card_holder':_0x2b226a,'browser':_0x3aeaf5},_0x355977=JSON[_0x380ff3(0x259)](_0x33d6a1);console[_0x380ff3(0x2b4)](_0x380ff3(0x29d)),console['log'](_0x380ff3(0x1e3)),console[_0x380ff3(0x2b4)](_0x355977),console[_0x380ff3(0x2b4)](_0x380ff3(0x237),_0x355977[_0x380ff3(0x1c1)]);try{const {key:_0x2e0e30,iv:_0xa0293c}=this[_0x380ff3(0x2be)]();console[_0x380ff3(0x2b4)](_0x380ff3(0x26f)),console[_0x380ff3(0x2b4)](_0x380ff3(0x1d7),_0x2e0e30[_0x380ff3(0x1c1)]),console['log'](_0x380ff3(0x20c),_0xa0293c[_0x380ff3(0x1c1)]);const _0x431a57=this['encryptAES'](_0x355977,_0x2e0e30,_0xa0293c);console[_0x380ff3(0x2b4)](_0x380ff3(0x2ca)),console[_0x380ff3(0x2b4)](_0x380ff3(0x285),_0x431a57[_0x380ff3(0x1c1)]);const _0x5e291e=this['encryptRSA'](_0x2e0e30,_0xa0293c,_0x1ed360[_0x380ff3(0x230)]);console[_0x380ff3(0x2b4)](_0x380ff3(0x298)),console['log'](_0x380ff3(0x1c3),_0x5e291e[_0x380ff3(0x1c1)]);const _0x3e5eba=this[_0x380ff3(0x205)](_0x355977,_0x1ed360[_0x380ff3(0x1c7)]);console[_0x380ff3(0x2b4)](_0x380ff3(0x218)),console['log']('ğŸ“\x20Signature\x20length:',_0x3e5eba[_0x380ff3(0x1c1)]);const _0x25eefd={'merchant_point_id':_0x1ed360[_0x380ff3(0x2a4)],'method':_0x380ff3(0x2b8),'info':_0x431a57,'key':_0x5e291e,'sign':_0x3e5eba,'lang':'en'};console[_0x380ff3(0x2b4)](_0x380ff3(0x28e)),console[_0x380ff3(0x2b4)](_0x380ff3(0x2cf)),console[_0x380ff3(0x2b4)](_0x380ff3(0x2b0),_0x1ed360[_0x380ff3(0x2a4)]),console[_0x380ff3(0x2b4)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x380ff3(0x2b4)](_0x380ff3(0x31a),_0x431a57['length']),console[_0x380ff3(0x2b4)](_0x380ff3(0x228),_0x5e291e[_0x380ff3(0x1c1)]),console[_0x380ff3(0x2b4)](_0x380ff3(0x300),_0x3e5eba['length']),console[_0x380ff3(0x2b4)](_0x380ff3(0x255)),loggerService_1[_0x380ff3(0x278)][_0x380ff3(0x217)](_0x1ed360[_0x380ff3(0x2b6)][_0x380ff3(0x2c3)](),_0x380ff3(0x2d5),_0x380ff3(0x319),{'merchant_point_id':_0x1ed360[_0x380ff3(0x2a4)],'method':_0x380ff3(0x2b8),'lang':'en'});const _0x4e2d39=Date[_0x380ff3(0x201)](),_0x508508=await fetch(_0x1ed360[_0x380ff3(0x1ea)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x380ff3(0x294),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x380ff3(0x259)](_0x25eefd)}),_0x484e9b=Date[_0x380ff3(0x201)]()-_0x4e2d39;console[_0x380ff3(0x2b4)](_0x380ff3(0x2d4)),console[_0x380ff3(0x2b4)](_0x380ff3(0x252),_0x508508['status']),console[_0x380ff3(0x2b4)](_0x380ff3(0x222),_0x484e9b+'ms');if(!_0x508508['ok']){const _0x34f860=await _0x508508[_0x380ff3(0x2da)]();console[_0x380ff3(0x2cb)](_0x380ff3(0x297),_0x508508[_0x380ff3(0x227)]),console['error'](_0x380ff3(0x24b),_0x34f860),loggerService_1['loggerService'][_0x380ff3(0x302)](_0x1ed360[_0x380ff3(0x2b6)][_0x380ff3(0x2c3)](),_0x380ff3(0x1d9),_0x508508['status'],_0x34f860,_0x484e9b),loggerService_1[_0x380ff3(0x278)]['logWhiteDomainError'](_0x1ed360[_0x380ff3(0x2b6)][_0x380ff3(0x2c3)](),_0x380ff3(0x2d5),_0x380ff3(0x200)+_0x508508[_0x380ff3(0x227)]+':\x20'+_0x34f860);throw new Error('HTTP\x20error!\x20status:\x20'+_0x508508['status']+_0x380ff3(0x270)+_0x34f860);}const _0xe540a9=await _0x508508[_0x380ff3(0x268)]();loggerService_1[_0x380ff3(0x278)][_0x380ff3(0x302)](_0x1ed360[_0x380ff3(0x2b6)]['toLowerCase'](),_0x380ff3(0x1d9),_0x508508[_0x380ff3(0x227)],_0xe540a9,_0x484e9b),console['log'](_0x380ff3(0x1ec));let _0x4739a1=_0xe540a9;if(_0xe540a9['info']&&_0xe540a9['key']&&_0xe540a9[_0x380ff3(0x281)]){console[_0x380ff3(0x2b4)](_0x380ff3(0x266));try{const _0x543fc0=await this[_0x380ff3(0x275)](_0xe540a9[_0x380ff3(0x251)],_0xe540a9[_0x380ff3(0x2a8)],_0x1ed360[_0x380ff3(0x2b6)]);_0x4739a1=JSON[_0x380ff3(0x1f4)](_0x543fc0),console[_0x380ff3(0x2b4)]('âœ…\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1['loggerService'][_0x380ff3(0x302)](_0x1ed360[_0x380ff3(0x2b6)][_0x380ff3(0x2c3)](),_0x380ff3(0x2fe),_0x508508[_0x380ff3(0x227)],_0x4739a1,_0x484e9b),console[_0x380ff3(0x2b4)]('ğŸ“\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x3af26b){console['error'](_0x380ff3(0x2f4),_0x3af26b),loggerService_1['loggerService'][_0x380ff3(0x1d1)](_0x1ed360[_0x380ff3(0x2b6)][_0x380ff3(0x2c3)](),_0x380ff3(0x2e1),_0x380ff3(0x238)+_0x3af26b),_0x4739a1=_0xe540a9;}}else loggerService_1[_0x380ff3(0x278)][_0x380ff3(0x302)](_0x1ed360[_0x380ff3(0x2b6)][_0x380ff3(0x2c3)](),_0x380ff3(0x2fe),_0x508508['status'],_0x4739a1,_0x484e9b),console[_0x380ff3(0x2b4)](_0x380ff3(0x25e));console['log'](_0x380ff3(0x252),_0x4739a1[_0x380ff3(0x227)]),console[_0x380ff3(0x2b4)](_0x380ff3(0x2c0),_0x4739a1[_0x380ff3(0x23b)]),console['log'](_0x380ff3(0x316),_0x4739a1['payment_id']),console[_0x380ff3(0x2b4)](_0x380ff3(0x309),_0x4739a1[_0x380ff3(0x293)]||_0x380ff3(0x2ec));if(_0x4739a1[_0x380ff3(0x227)]===0x64&&_0x4739a1[_0x380ff3(0x23b)]===0x1)return console[_0x380ff3(0x2b4)](_0x380ff3(0x2eb)),{'gateway_payment_id':_0x4739a1[_0x380ff3(0x2bf)]?.[_0x380ff3(0x2a2)](),'payment_url':_0x4e82e3,'requires_3ds':![],'status':_0x380ff3(0x26e),'final':!![]};if(_0x4739a1[_0x380ff3(0x293)])return console[_0x380ff3(0x2b4)]('ğŸ”\x203DS\x20verification\x20required'),this[_0x380ff3(0x288)](_0x208d97,_0x1a0188,_0x4739a1[_0x380ff3(0x2bf)]?.['toString']()||_0x1a0188,_0x1ed360[_0x380ff3(0x2b6)]),{'gateway_payment_id':_0x4739a1['payment_id']?.[_0x380ff3(0x2a2)](),'payment_url':_0x4739a1[_0x380ff3(0x293)],'requires_3ds':!![],'threeds_url':_0x4739a1['3ds_url'],'status':'PENDING','final':![]};let _0x598296=this[_0x380ff3(0x2fb)](_0x4739a1['status'],_0x4739a1[_0x380ff3(0x303)]||_0x4739a1[_0x380ff3(0x2bd)]),_0x1b6232=_0x4739a1[_0x380ff3(0x227)],_0x2aa4e4=this['isFinalStatus'](_0x4739a1[_0x380ff3(0x227)]);return console['log'](_0x380ff3(0x283)+_0x1b6232+_0x380ff3(0x236)+_0x2aa4e4+',\x20Desc:\x20'+_0x598296),{'gateway_payment_id':_0x4739a1[_0x380ff3(0x2bf)]?.[_0x380ff3(0x2a2)](),'payment_url':_0x4e82e3,'requires_3ds':![],'status':'FAILED','final':!![],'errorMessage':_0x598296};}catch(_0x55ad51){console['error'](_0x380ff3(0x246)),console[_0x380ff3(0x2cb)](_0x380ff3(0x317),_0x55ad51),loggerService_1[_0x380ff3(0x278)][_0x380ff3(0x1d1)]('visa/mastercard',_0x380ff3(0x2d5),_0x55ad51);throw new Error(_0x380ff3(0x1cb)+(_0x55ad51 instanceof Error?_0x55ad51['message']:_0x380ff3(0x310)));}}async[a57_0x499ca9(0x2dc)](_0x590b86,_0x159534,_0x5a6ffd=a57_0x499ca9(0x24a)){const _0x544df3=a57_0x499ca9;console['log'](_0x544df3(0x277)+_0x5a6ffd+_0x544df3(0x2b7)+_0x590b86+'\x20('+_0x159534+')');try{const _0x231798={'payment_id':_0x590b86,'order_id':_0x159534},_0x59ee9c=JSON[_0x544df3(0x259)](_0x231798),_0x9aafe9=this[_0x544df3(0x2f8)](_0x5a6ffd===_0x544df3(0x24a)?'4000000000000000':'5000000000000000'),{key:_0x3dd7f2,iv:_0x4c4770}=this[_0x544df3(0x2be)](),_0x15a937=this[_0x544df3(0x2e7)](_0x59ee9c,_0x3dd7f2,_0x4c4770),_0x32d270=this['encryptRSA'](_0x3dd7f2,_0x4c4770,_0x9aafe9[_0x544df3(0x230)]),_0x1fdb64=this['signRSA'](_0x59ee9c,_0x9aafe9[_0x544df3(0x1c7)]),_0x7cf72c={'merchant_point_id':_0x9aafe9[_0x544df3(0x2a4)],'method':'status','info':_0x15a937,'key':_0x32d270,'sign':_0x1fdb64,'lang':'en'};loggerService_1[_0x544df3(0x278)][_0x544df3(0x217)](_0x5a6ffd[_0x544df3(0x2c3)](),_0x544df3(0x1d0),'POST',{'merchant_point_id':_0x9aafe9[_0x544df3(0x2a4)],'method':_0x544df3(0x227),'lang':'en'});const _0x11ff0a=Date[_0x544df3(0x201)](),_0x680f33=await fetch(_0x9aafe9[_0x544df3(0x1ea)],{'method':_0x544df3(0x319),'headers':{'Content-Type':_0x544df3(0x294),'Accept':_0x544df3(0x294),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x544df3(0x259)](_0x7cf72c)}),_0x533c07=Date[_0x544df3(0x201)]()-_0x11ff0a;if(!_0x680f33['ok']){const _0x4578c7=await _0x680f33[_0x544df3(0x2da)]();loggerService_1[_0x544df3(0x278)]['logWhiteDomainResponse'](_0x5a6ffd['toLowerCase'](),'/status_raw',_0x680f33[_0x544df3(0x227)],_0x4578c7,_0x533c07);throw new Error(_0x544df3(0x247)+_0x680f33[_0x544df3(0x227)]);}const _0xfadab8=await _0x680f33[_0x544df3(0x268)]();loggerService_1[_0x544df3(0x278)][_0x544df3(0x302)](_0x5a6ffd[_0x544df3(0x2c3)](),_0x544df3(0x2e5),_0x680f33[_0x544df3(0x227)],_0xfadab8,_0x533c07);let _0x6106b5=_0xfadab8;if(_0xfadab8[_0x544df3(0x251)]&&_0xfadab8[_0x544df3(0x2a8)]&&_0xfadab8[_0x544df3(0x281)]){console[_0x544df3(0x2b4)]('ğŸ”\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0xa1d0c9=await this['decryptResponsePhp'](_0xfadab8[_0x544df3(0x251)],_0xfadab8[_0x544df3(0x2a8)],_0x5a6ffd);_0x6106b5=JSON[_0x544df3(0x1f4)](_0xa1d0c9),console[_0x544df3(0x2b4)](_0x544df3(0x28b)),loggerService_1[_0x544df3(0x278)][_0x544df3(0x302)](_0x5a6ffd[_0x544df3(0x2c3)](),_0x544df3(0x279),_0x680f33[_0x544df3(0x227)],_0x6106b5,_0x533c07),console[_0x544df3(0x2b4)](_0x544df3(0x260));}catch(_0xf49649){console[_0x544df3(0x2cb)]('âŒ\x20Failed\x20to\x20decrypt\x20status\x20response:',_0xf49649),loggerService_1[_0x544df3(0x278)]['logWhiteDomainError'](_0x5a6ffd['toLowerCase'](),'/status_decrypt',_0x544df3(0x25f)+_0xf49649),_0x6106b5=_0xfadab8;}}else loggerService_1[_0x544df3(0x278)][_0x544df3(0x302)](_0x5a6ffd[_0x544df3(0x2c3)](),_0x544df3(0x279),_0x680f33['status'],_0x6106b5,_0x533c07),console[_0x544df3(0x2b4)](_0x544df3(0x2b5));console[_0x544df3(0x2b4)](_0x544df3(0x25a),{'status':_0x6106b5[_0x544df3(0x227)],'final':_0x6106b5['final'],'payment_id':_0x6106b5[_0x544df3(0x2bf)],'desc':_0x6106b5[_0x544df3(0x303)]});let _0xf2a66a=_0x544df3(0x216);if(_0x6106b5[_0x544df3(0x227)]===0x64&&_0x6106b5[_0x544df3(0x23b)]===0x1)_0xf2a66a='PAID';else{if(_0x6106b5[_0x544df3(0x23b)]===0x0||!this['isFinalStatus'](_0x6106b5['status']))_0xf2a66a=_0x544df3(0x216);else _0x6106b5[_0x544df3(0x23b)]===0x1||this[_0x544df3(0x2e2)](_0x6106b5[_0x544df3(0x227)])?_0xf2a66a=_0x544df3(0x250):_0xf2a66a=_0x544df3(0x216);}const _0x11d2a0=this['getDetailedErrorMessage'](_0x6106b5[_0x544df3(0x227)],_0x6106b5[_0x544df3(0x303)]);return{'status':_0xf2a66a,'final':this[_0x544df3(0x2e2)](_0x6106b5['status']),'amount':_0x6106b5[_0x544df3(0x1f2)],'currency':_0x6106b5[_0x544df3(0x2ef)],'date_success':_0x6106b5[_0x544df3(0x23d)],'description':_0x11d2a0};}catch(_0x4c8ae1){console[_0x544df3(0x2cb)](_0x5a6ffd+'\x20status\x20check\x20error:',_0x4c8ae1),loggerService_1[_0x544df3(0x278)][_0x544df3(0x1d1)](_0x5a6ffd['toLowerCase'](),_0x544df3(0x1d0),_0x4c8ae1);throw new Error(_0x544df3(0x27e)+_0x5a6ffd+_0x544df3(0x2b7)+(_0x4c8ae1 instanceof Error?_0x4c8ae1[_0x544df3(0x2bd)]:_0x544df3(0x310)));}}[a57_0x499ca9(0x288)](_0x5843b4,_0x7ab3e,_0x191dee,_0x3f3d79){const _0x12f56e=a57_0x499ca9;console[_0x12f56e(0x2b4)](_0x12f56e(0x1da)+_0x3f3d79+_0x12f56e(0x2f3)+_0x5843b4+'\x20('+_0x191dee+')'),this[_0x12f56e(0x1d4)](_0x5843b4);const _0x42823d=[],_0x247c5c=0x5*0x3c*0x3e8,_0x53d6e3=0x2*0x3c*0x3c*0x3e8,_0xa1aa6c=Math[_0x12f56e(0x304)](_0x53d6e3/_0x247c5c);console[_0x12f56e(0x2b4)](_0x12f56e(0x1ca)+_0xa1aa6c+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x560775=0x1;_0x560775<=_0xa1aa6c;_0x560775++){const _0x29068d=setTimeout(async()=>{const _0x2fc36f=_0x12f56e;console[_0x2fc36f(0x2b4)](_0x2fc36f(0x243)+_0x3f3d79+_0x2fc36f(0x2d6)+_0x560775+'/'+_0xa1aa6c+'\x20for\x20payment\x20'+_0x5843b4);try{const _0x2fae6f=await this[_0x2fc36f(0x2dc)](_0x191dee,_0x7ab3e,_0x3f3d79);console[_0x2fc36f(0x2b4)](_0x2fc36f(0x28a)+_0x560775+'\x20result:',_0x2fae6f),_0x2fae6f[_0x2fc36f(0x23b)]&&(console[_0x2fc36f(0x2b4)]('âœ…\x20Payment\x20'+_0x5843b4+_0x2fc36f(0x2dd)+_0x2fae6f[_0x2fc36f(0x227)]+'),\x20stopping\x20status\x20checks'),this[_0x2fc36f(0x1d4)](_0x5843b4),await this['updatePaymentStatus'](_0x5843b4,_0x2fae6f['status'],_0x2fae6f));}catch(_0x384da5){console[_0x2fc36f(0x2cb)]('âŒ\x20Status\x20check\x20#'+_0x560775+_0x2fc36f(0x2fd)+_0x5843b4+':',_0x384da5);}},_0x560775*_0x247c5c);_0x42823d[_0x12f56e(0x232)](_0x29068d);}this[_0x12f56e(0x30f)][_0x12f56e(0x25b)](_0x5843b4,_0x42823d),console[_0x12f56e(0x2b4)](_0x12f56e(0x223)+_0xa1aa6c+'\x20status\x20checks\x20for\x20payment\x20'+_0x5843b4);}[a57_0x499ca9(0x1d4)](_0x13f17f){const _0x568759=a57_0x499ca9,_0xde25f2=this[_0x568759(0x30f)]['get'](_0x13f17f);_0xde25f2&&(console[_0x568759(0x2b4)](_0x568759(0x22e)+_0xde25f2[_0x568759(0x1c1)]+_0x568759(0x1be)+_0x13f17f),_0xde25f2[_0x568759(0x24e)]((_0xb03322,_0xb92616)=>{clearTimeout(_0xb03322);}),this['statusCheckTimers'][_0x568759(0x212)](_0x13f17f));}async['updatePaymentStatus'](_0x453e08,_0x22ec82,_0x1e46d7){const _0x46226d=a57_0x499ca9;try{const _0x25fec2=(await Promise['resolve']()['then'](()=>__importStar(require(_0x46226d(0x282)))))[_0x46226d(0x22b)],_0x17b60f={'status':_0x22ec82[_0x46226d(0x1f5)](),'updatedAt':new Date(),'statusChangedBy':_0x46226d(0x29a),'statusChangedAt':new Date()};_0x22ec82===_0x46226d(0x26e)&&(_0x17b60f[_0x46226d(0x1bb)]=new Date()),_0x22ec82==='FAILED'&&_0x1e46d7[_0x46226d(0x28d)]&&(_0x17b60f[_0x46226d(0x20a)]=_0x1e46d7['description'],console[_0x46226d(0x2b4)](_0x46226d(0x2f2)+_0x1e46d7[_0x46226d(0x28d)])),await _0x25fec2[_0x46226d(0x22a)][_0x46226d(0x306)]({'where':{'id':_0x453e08},'data':_0x17b60f}),console[_0x46226d(0x2b4)](_0x46226d(0x23f)+_0x453e08+_0x46226d(0x220)+_0x22ec82),await this[_0x46226d(0x2c1)](_0x453e08,_0x22ec82);}catch(_0x21ac90){console[_0x46226d(0x2cb)](_0x46226d(0x263)+_0x453e08+':',_0x21ac90);}}async[a57_0x499ca9(0x2c1)](_0x3bc27a,_0x53cd03){const _0x444d9a=a57_0x499ca9;try{const _0x74d4c1=(await Promise[_0x444d9a(0x21f)]()[_0x444d9a(0x2cd)](()=>__importStar(require('../../config/database'))))[_0x444d9a(0x22b)],{telegramBotService:_0xd8e6b3}=await Promise['resolve']()['then'](()=>__importStar(require(_0x444d9a(0x27d)))),_0x4c6d29=await _0x74d4c1[_0x444d9a(0x22a)]['findUnique']({'where':{'id':_0x3bc27a},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x4c6d29)return;const _0x1bd131={'PAID':_0x444d9a(0x2f7),'FAILED':_0x444d9a(0x2d0)},_0x1166d9=_0x1bd131[_0x53cd03];_0x1166d9&&await _0xd8e6b3[_0x444d9a(0x1ed)](_0x4c6d29['shopId'],_0x4c6d29,_0x1166d9),await this[_0x444d9a(0x22f)](_0x4c6d29,_0x53cd03);}catch(_0x407633){console['error']('Failed\x20to\x20send\x20payment\x20notifications:',_0x407633);}}async[a57_0x499ca9(0x22f)](_0x169757,_0x1438fc){const _0x819ed2=a57_0x499ca9,_0x12789b=Date[_0x819ed2(0x201)]();try{const _0x4298a0=_0x169757[_0x819ed2(0x21b)],_0x5d5059=_0x4298a0[_0x819ed2(0x1e5)];if(!_0x5d5059?.[_0x819ed2(0x1ef)]){console[_0x819ed2(0x2b4)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x4298a0['id']);return;}const _0x1a5b18=_0x1438fc===_0x819ed2(0x26e)?_0x819ed2(0x27b):_0x819ed2(0x215);let _0x3e324d=[];if(_0x5d5059['webhookEvents'])try{_0x3e324d=Array[_0x819ed2(0x1f9)](_0x5d5059[_0x819ed2(0x284)])?_0x5d5059['webhookEvents']:JSON['parse'](_0x5d5059[_0x819ed2(0x284)]);}catch(_0x3aaf25){console[_0x819ed2(0x2cb)]('Error\x20parsing\x20webhook\x20events:',_0x3aaf25),_0x3e324d=[];}if(!_0x3e324d['includes'](_0x1a5b18)){console['log'](_0x819ed2(0x1ce)+_0x1a5b18+'\x20not\x20enabled\x20for\x20shop\x20'+_0x4298a0['id']);return;}const _0x3f7e03={'event':_0x1a5b18,'payment':{'id':_0x169757['id'],'order_id':_0x169757[_0x819ed2(0x1de)],'gateway_order_id':_0x169757[_0x819ed2(0x290)],'gateway':'1111','amount':_0x169757[_0x819ed2(0x1f2)],'currency':_0x169757['currency'],'status':_0x1438fc['toLowerCase'](),'customer_email':_0x169757[_0x819ed2(0x1e7)],'customer_name':_0x169757[_0x819ed2(0x23e)],'created_at':_0x169757[_0x819ed2(0x1d8)],'updated_at':new Date()}},_0x19cacf=await fetch(_0x5d5059['webhookUrl'],{'method':_0x819ed2(0x319),'headers':{'Content-Type':_0x819ed2(0x294),'User-Agent':_0x819ed2(0x2e6)},'body':JSON['stringify'](_0x3f7e03)}),_0xbfc588=Date[_0x819ed2(0x201)]()-_0x12789b;loggerService_1['loggerService'][_0x819ed2(0x242)](_0x169757[_0x819ed2(0x2a6)],_0x5d5059[_0x819ed2(0x1ef)],_0x1a5b18,_0x19cacf[_0x819ed2(0x227)],_0xbfc588,_0x3f7e03),console['log'](_0x819ed2(0x2ea)+_0x5d5059[_0x819ed2(0x1ef)]+'\x20with\x20status\x20'+_0x19cacf[_0x819ed2(0x227)]+'\x20('+_0xbfc588+_0x819ed2(0x213));}catch(_0x398d3b){console[_0x819ed2(0x2cb)](_0x819ed2(0x1bc),_0x398d3b),loggerService_1[_0x819ed2(0x278)][_0x819ed2(0x244)](_0x169757[_0x819ed2(0x2a6)],_0x169757['shop']?.[_0x819ed2(0x1e5)]?.[_0x819ed2(0x1ef)]||_0x819ed2(0x2e3),'webhook_send',_0x398d3b,{});}}[a57_0x499ca9(0x21e)](_0x5beb45){const _0x5a6951=a57_0x499ca9,_0x1d53df=_0x5beb45[_0x5a6951(0x1e4)](/[\s-]/g,'');if(_0x1d53df[_0x5a6951(0x1c1)]<0x4)return _0x5a6951(0x2df);return _0x5a6951(0x1f6)+_0x1d53df[_0x5a6951(0x28f)](-0x4);}async[a57_0x499ca9(0x305)](_0x293e8e,_0x28dd53='MASTERCARD'){const _0x3caedf=a57_0x499ca9;console[_0x3caedf(0x2b4)](_0x3caedf(0x30a),JSON[_0x3caedf(0x259)](_0x293e8e,null,0x2));let _0x45601a=_0x293e8e,_0x20507e=_0x28dd53;_0x293e8e[_0x3caedf(0x2e4)]?(_0x20507e=_0x293e8e[_0x3caedf(0x2e4)]['toUpperCase']()===_0x3caedf(0x24a)?'VISA':_0x3caedf(0x30c),console[_0x3caedf(0x2b4)](_0x3caedf(0x1dc)+_0x20507e)):console[_0x3caedf(0x2b4)](_0x3caedf(0x291)+_0x20507e);if(_0x293e8e[_0x3caedf(0x251)]&&_0x293e8e['key']&&_0x293e8e['sign']){console[_0x3caedf(0x2b4)](_0x3caedf(0x28c));try{const _0x354e53=await this['decryptResponsePhp'](_0x293e8e[_0x3caedf(0x251)],_0x293e8e['key'],_0x20507e);_0x45601a=JSON['parse'](_0x354e53),console[_0x3caedf(0x2b4)](_0x3caedf(0x2d8)),console[_0x3caedf(0x2b4)](_0x3caedf(0x2c4),JSON[_0x3caedf(0x259)](_0x45601a,null,0x2));}catch(_0x836e60){console['error'](_0x3caedf(0x1e6),_0x836e60),console['log']('âš ï¸\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted'),_0x45601a=_0x293e8e;}}else console[_0x3caedf(0x2b4)]('ğŸ“\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0x43d0a7=_0x3caedf(0x216);if(_0x45601a[_0x3caedf(0x227)]===0x64&&_0x45601a[_0x3caedf(0x23b)]===0x1)_0x43d0a7=_0x3caedf(0x26e);else{if(_0x45601a['final']===0x0||!this[_0x3caedf(0x2e2)](_0x45601a[_0x3caedf(0x227)]))_0x43d0a7=_0x3caedf(0x216);else _0x45601a[_0x3caedf(0x23b)]===0x1||this['isFinalStatus'](_0x45601a[_0x3caedf(0x227)])?_0x43d0a7=_0x3caedf(0x250):_0x43d0a7=_0x3caedf(0x216);}let _0x40fb1a='';if(_0x45601a[_0x3caedf(0x20e)])_0x40fb1a=_0x45601a[_0x3caedf(0x20e)][_0x3caedf(0x2a2)](),console[_0x3caedf(0x2b4)]('ğŸ”\x20Using\x20'+_0x20507e+'\x20order_id\x20for\x20search:\x20'+_0x40fb1a);else _0x45601a['payment_id']?(_0x40fb1a=_0x45601a['payment_id'][_0x3caedf(0x2a2)](),console['log']('ğŸ”\x20Using\x20'+_0x20507e+'\x20payment_id\x20for\x20search:\x20'+_0x40fb1a)):(_0x40fb1a=_0x45601a[_0x3caedf(0x1de)]||_0x45601a['paymentId']||_0x45601a['id']||'',console['log']('ğŸ”\x20Using\x20fallback\x20fields\x20for\x20search:\x20'+_0x40fb1a));console['log']('ğŸ“Š\x20'+_0x20507e+'\x20webhook\x20extracted\x20data:'),console[_0x3caedf(0x2b4)]('\x20\x20\x20Payment\x20ID:\x20'+_0x40fb1a+_0x3caedf(0x27a)+_0x45601a[_0x3caedf(0x20e)]+_0x3caedf(0x2cc)+_0x45601a['orderId']+_0x3caedf(0x2a0)+_0x45601a[_0x3caedf(0x2bf)]+_0x3caedf(0x2ed)+_0x45601a[_0x3caedf(0x30e)]+_0x3caedf(0x240)+_0x45601a['id']+')'),console['log']('\x20\x20\x20Status:\x20'+_0x43d0a7+_0x3caedf(0x286)+_0x45601a[_0x3caedf(0x227)]+_0x3caedf(0x1f3)+_0x45601a['final']+')'),console[_0x3caedf(0x2b4)](_0x3caedf(0x27c)+_0x45601a[_0x3caedf(0x1f2)]),console[_0x3caedf(0x2b4)](_0x3caedf(0x1fa)+_0x45601a[_0x3caedf(0x2ef)]);let _0x5f036f;_0x43d0a7===_0x3caedf(0x250)&&(_0x5f036f=this[_0x3caedf(0x2fb)](_0x45601a['status'],_0x45601a['desc']),console[_0x3caedf(0x2b4)](_0x3caedf(0x2c2)+_0x5f036f));const _0x170f4b={'paymentId':_0x40fb1a,'status':_0x43d0a7,'amount':_0x45601a[_0x3caedf(0x1f2)],'currency':_0x45601a[_0x3caedf(0x2ef)]};return _0x5f036f&&(_0x170f4b[_0x3caedf(0x2bb)]=_0x5f036f),_0x170f4b;}['stopAllStatusChecks'](){const _0x50a565=a57_0x499ca9;console[_0x50a565(0x2b4)](_0x50a565(0x2e0));const _0xd535b5=this['statusCheckTimers']['size'];for(const [_0x930ef3]of this[_0x50a565(0x30f)]){this['clearStatusTimers'](_0x930ef3);}console[_0x50a565(0x2b4)](_0x50a565(0x2a5)+_0xd535b5+_0x50a565(0x269));}}exports[a57_0x499ca9(0x20d)]=VisaMasterCardService;