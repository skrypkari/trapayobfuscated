'use strict';const a42_0x38b30f=a42_0x4d43;(function(_0x53e843,_0x353572){const _0x424635=a42_0x4d43,_0x3764c8=_0x53e843();while(!![]){try{const _0x46061a=-parseInt(_0x424635(0x1f4))/0x1+parseInt(_0x424635(0x10a))/0x2+-parseInt(_0x424635(0x133))/0x3*(parseInt(_0x424635(0x156))/0x4)+parseInt(_0x424635(0x19e))/0x5+parseInt(_0x424635(0x1d0))/0x6+-parseInt(_0x424635(0x1cb))/0x7*(parseInt(_0x424635(0x1eb))/0x8)+parseInt(_0x424635(0x15a))/0x9*(parseInt(_0x424635(0x187))/0xa);if(_0x46061a===_0x353572)break;else _0x3764c8['push'](_0x3764c8['shift']());}catch(_0x42aa7a){_0x3764c8['push'](_0x3764c8['shift']());}}}(a42_0x1880,0xb73cc));var __createBinding=this&&this[a42_0x38b30f(0x12a)]||(Object[a42_0x38b30f(0x199)]?function(_0x1aa4e3,_0x2bc51b,_0x1f8a43,_0xadcb2){const _0x232cb1=a42_0x38b30f;if(_0xadcb2===undefined)_0xadcb2=_0x1f8a43;var _0x1bddfd=Object[_0x232cb1(0x1c3)](_0x2bc51b,_0x1f8a43);(!_0x1bddfd||(_0x232cb1(0x14e)in _0x1bddfd?!_0x2bc51b[_0x232cb1(0x132)]:_0x1bddfd[_0x232cb1(0x1dd)]||_0x1bddfd[_0x232cb1(0x1c0)]))&&(_0x1bddfd={'enumerable':!![],'get':function(){return _0x2bc51b[_0x1f8a43];}}),Object[_0x232cb1(0x181)](_0x1aa4e3,_0xadcb2,_0x1bddfd);}:function(_0x11d759,_0x4a2b8e,_0x35d6a1,_0x5d9a84){if(_0x5d9a84===undefined)_0x5d9a84=_0x35d6a1;_0x11d759[_0x5d9a84]=_0x4a2b8e[_0x35d6a1];}),__setModuleDefault=this&&this[a42_0x38b30f(0x1de)]||(Object[a42_0x38b30f(0x199)]?function(_0x3487f2,_0x59d02c){Object['defineProperty'](_0x3487f2,'default',{'enumerable':!![],'value':_0x59d02c});}:function(_0x42185f,_0x546e46){const _0x420b0b=a42_0x38b30f;_0x42185f[_0x420b0b(0x17e)]=_0x546e46;}),__importStar=this&&this[a42_0x38b30f(0x1f6)]||(function(){var _0x38bc4b=function(_0x40cec7){const _0x11787a=a42_0x4d43;return _0x38bc4b=Object[_0x11787a(0x14a)]||function(_0x1570ac){const _0x5b8454=_0x11787a;var _0x4c0a57=[];for(var _0x491871 in _0x1570ac)if(Object['prototype'][_0x5b8454(0x1b1)][_0x5b8454(0x16f)](_0x1570ac,_0x491871))_0x4c0a57[_0x4c0a57[_0x5b8454(0x140)]]=_0x491871;return _0x4c0a57;},_0x38bc4b(_0x40cec7);};return function(_0xd06cda){const _0x525867=a42_0x4d43;if(_0xd06cda&&_0xd06cda[_0x525867(0x132)])return _0xd06cda;var _0x56d318={};if(_0xd06cda!=null){for(var _0x3a23b6=_0x38bc4b(_0xd06cda),_0x622e39=0x0;_0x622e39<_0x3a23b6[_0x525867(0x140)];_0x622e39++)if(_0x3a23b6[_0x622e39]!==_0x525867(0x17e))__createBinding(_0x56d318,_0xd06cda,_0x3a23b6[_0x622e39]);}return __setModuleDefault(_0x56d318,_0xd06cda),_0x56d318;};}()),__importDefault=this&&this[a42_0x38b30f(0x127)]||function(_0x52c03e){const _0x2d1948=a42_0x38b30f;return _0x52c03e&&_0x52c03e[_0x2d1948(0x132)]?_0x52c03e:{'default':_0x52c03e};};Object['defineProperty'](exports,a42_0x38b30f(0x132),{'value':!![]}),exports['MasterCardService']=void 0x0;function a42_0x4d43(_0x3d0a5a,_0x8ff509){const _0x18801d=a42_0x1880();return a42_0x4d43=function(_0x4d43bb,_0x524d8e){_0x4d43bb=_0x4d43bb-0x109;let _0x5130c2=_0x18801d[_0x4d43bb];return _0x5130c2;},a42_0x4d43(_0x3d0a5a,_0x8ff509);}function a42_0x1880(){const _0x474a60=['toLowerCase','signRSA','generateAESKey','❌\x20Status\x20check\x20#','3ds_url','aes-256-ctr','expire_year','✅\x20Status\x20response\x20decrypted\x20successfully','\x20with\x20status\x20','maskCardNumber','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','adminNotes','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','📊\x20Status\x20check\x20result:','MasterCard:\x20','hasOwnProperty','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','\x20result:','paidAt','HTTP\x20','💳\x20MasterCard\x20service\x20initialized','delete','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','error','POST','path','HTTP\x20error!\x20status:\x20','\x20MasterCard\x20status\x20check\x20timers','HTTP\x20Status:','order_id','configurable','join','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','getOwnPropertyDescriptor','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Result\x20URL:','description','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','Failed\x20to\x20send\x20MasterCard\x20webhook:','existsSync','Processing\x20MasterCard\x20webhook:','1939ngnBBx','decryptAES','🔐\x20Public\x20key\x20path:','cwd','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','1731054aOxNFz','/status_decrypted','encryptAES','⏰\x20Will\x20check\x20status\x20','paid','Order\x20ID:','json','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','scheduleStatusChecks','\x20\x20\x20-\x20info\x20length:','Status:','resolve','📝\x20Encrypted\x20data\x20length:','writable','__setModuleDefault','****\x20****\x20****\x20','toString','🔐\x20AES\x20key\x20and\x20IV\x20generated','final','📝\x20Signature\x20length:','customerName','Status\x20decryption\x20failed:\x20','Failed\x20to\x20send\x20payment\x20notifications:','logWhiteDomainError','status','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','🔐\x20Data\x20signed\x20with\x20RSA','33272liAWyy','🛑\x20Stopped\x20','merchantPointId','Payment\x20ID:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','sign','processCardPayment','loggerService','amount','280136IoUynA','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','__importStar','Card\x20Number:','1477422bRTKbE','FAILED','❌\x20PHP\x20decryptor\x20request\x20failed:','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','logShopWebhookError','\x20status\x20timers\x20for\x20payment\x20','log','clearStatusTimers','system','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','https://api2.trapay.uk/decrypt.php','🔐\x20Public\x20key\x20length:\x20','../telegramBotService','validateKeyFiles','🔐\x20RSA\x20signing\x20successful','createSign','webhookEvents','🔐\x20AES\x20IV\x20length:','/status','readFileSync','apiUrl','info','publicKeyPath','https://api.paydmeth.com/api','PAID','randomBytes','❌\x20Data\x20being\x20signed:','crypto','includes','__importDefault','shopId','-----BEGIN','__createBinding','Response\x20Time:','Unknown\x20error','date_success',',\x20body:\x20','application/json','privateKeyPath','✅\x20Payment\x20successful','__esModule','2571AaSYZl','keys','base64','\x20for\x20payment\x20','set','last_name','/charge_decrypt','then','-----END','RSA_PKCS1_PADDING','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','now','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','length','shop','\x20\x20\x20-\x20sign\x20length:','Public\x20key\x20file\x20not\x20found:\x20','❌\x20RSA\x20encryption\x20failed:','/status_raw','stringify','webhookUrl','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','),\x20stopping\x20status\x20checks','getOwnPropertyNames','processWebhook','../loggerService','update','get','logWhiteDomainResponse','logWhiteDomainRequest','mastercard','Amount:','constants','payment.failed','text','1120UbhCaq','updatePaymentStatus','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','privateDecrypt','8712dwHSKs','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','Return\x20URL:','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','/charge_decrypted','utf8','sendPaymentNotifications','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','publicEncrypt','\x20\x20\x20-\x20key\x20length:','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','number','payment','key','❌\x20MasterCard\x20key\x20validation\x20failed:','failed','🔐\x20Data\x20encrypted\x20with\x20AES','/charge_raw','\x20\x20\x20-\x20merchant_point_id:','expire_month','call','PENDING','Card\x20Holder:','findUnique','charge','🔐\x20Private\x20key\x20path:','createCipheriv','logShopWebhookSent','/charge','📝\x20Data\x20to\x20sign\x20length:','TesSoft\x20Payment\x20System/1.0','desc','decryptResponsePhp','Private\x20key\x20file\x20not\x20found:\x20','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','default','customerEmail','\x20\x20\x20-\x20method:\x20charge','defineProperty','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','replace','statusCheckTimers','Response\x20Body:','settings','14040KLIYNj','encryptRSA','Error\x20parsing\x20webhook\x20events:','sendShopWebhook','forEach','end','MasterCard\x20webhook\x20sent\x20to\x20','message','toUpperCase','\x20not\x20enabled\x20for\x20shop\x20','payment_id','webhook_send','first_name','📊\x20Status\x20check\x20#','trim','\x20failed\x20for\x20payment\x20','floor','\x20is\x20final\x20(','create','parse','createDecipheriv','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','from','181935WpbgOP','cvv','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'];a42_0x1880=function(){return _0x474a60;};return a42_0x1880();}const crypto_1=__importDefault(require(a42_0x38b30f(0x125))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x38b30f(0x1bb))),loggerService_1=require(a42_0x38b30f(0x14c));class MasterCardService{constructor(){const _0x2d68d6=a42_0x38b30f;this[_0x2d68d6(0x184)]=new Map(),this['apiUrl']=_0x2d68d6(0x121),this['merchantPointId']=0x67c,this['privateKeyPath']=path_1[_0x2d68d6(0x17e)][_0x2d68d6(0x1c1)](process[_0x2d68d6(0x1ce)](),_0x2d68d6(0x134),'private.pem'),this[_0x2d68d6(0x120)]=path_1[_0x2d68d6(0x17e)][_0x2d68d6(0x1c1)](process[_0x2d68d6(0x1ce)](),_0x2d68d6(0x134),'psp_public.pem'),console['log'](_0x2d68d6(0x1b6)),console['log'](_0x2d68d6(0x174),this['privateKeyPath']),console[_0x2d68d6(0x110)](_0x2d68d6(0x1cd),this[_0x2d68d6(0x120)]),this[_0x2d68d6(0x117)]();}[a42_0x38b30f(0x117)](){const _0x55c04b=a42_0x38b30f;try{if(!fs_1[_0x55c04b(0x17e)][_0x55c04b(0x1c9)](this[_0x55c04b(0x130)]))throw new Error(_0x55c04b(0x17c)+this[_0x55c04b(0x130)]);if(!fs_1['default'][_0x55c04b(0x1c9)](this['publicKeyPath']))throw new Error(_0x55c04b(0x143)+this[_0x55c04b(0x120)]);const _0x5575b4=fs_1[_0x55c04b(0x17e)][_0x55c04b(0x11d)](this[_0x55c04b(0x130)],_0x55c04b(0x160))[_0x55c04b(0x195)](),_0x3fdc91=fs_1[_0x55c04b(0x17e)][_0x55c04b(0x11d)](this[_0x55c04b(0x120)],'utf8')['trim']();if(!_0x5575b4[_0x55c04b(0x126)](_0x55c04b(0x129))||!_0x5575b4[_0x55c04b(0x126)]('-----END'))throw new Error(_0x55c04b(0x1d7));if(!_0x3fdc91[_0x55c04b(0x126)](_0x55c04b(0x129))||!_0x3fdc91[_0x55c04b(0x126)](_0x55c04b(0x13b)))throw new Error(_0x55c04b(0x1c4));console['log'](_0x55c04b(0x1e9)),console[_0x55c04b(0x110)]('🔐\x20Private\x20key\x20length:\x20'+_0x5575b4[_0x55c04b(0x140)]+'\x20characters'),console[_0x55c04b(0x110)](_0x55c04b(0x115)+_0x3fdc91[_0x55c04b(0x140)]+'\x20characters');}catch(_0x3befe1){console['error'](_0x55c04b(0x169),_0x3befe1);throw _0x3befe1;}}[a42_0x38b30f(0x1a3)](){const _0x38e739=a42_0x38b30f,_0x1762c7=crypto_1[_0x38e739(0x17e)][_0x38e739(0x123)](0x20),_0x49273e=crypto_1['default'][_0x38e739(0x123)](0x10);return{'key':_0x1762c7,'iv':_0x49273e};}[a42_0x38b30f(0x1d2)](_0xd6e511,_0x907623,_0x6280bc){const _0x431ed4=a42_0x38b30f,_0x37f0b4=crypto_1[_0x431ed4(0x17e)][_0x431ed4(0x175)]('aes-256-ctr',_0x907623,_0x6280bc);let _0x135205=_0x37f0b4[_0x431ed4(0x14d)](_0xd6e511,_0x431ed4(0x160),_0x431ed4(0x135));return _0x135205+=_0x37f0b4['final'](_0x431ed4(0x135)),_0x135205;}[a42_0x38b30f(0x188)](_0x27f71e,_0x9f60e3){const _0x168c57=a42_0x38b30f;try{const _0x526c99=fs_1[_0x168c57(0x17e)][_0x168c57(0x11d)](this[_0x168c57(0x120)],_0x168c57(0x160))[_0x168c57(0x195)](),_0x30bf95={'iv':_0x9f60e3['toString'](_0x168c57(0x135)),'key':_0x27f71e[_0x168c57(0x1e0)](_0x168c57(0x135))},_0x4c5cf0=JSON[_0x168c57(0x146)](_0x30bf95);console['log'](_0x168c57(0x182),_0x4c5cf0[_0x168c57(0x140)]);const _0x4e42c4=crypto_1[_0x168c57(0x17e)][_0x168c57(0x163)]({'key':_0x526c99,'padding':crypto_1['default'][_0x168c57(0x153)][_0x168c57(0x13c)]},Buffer[_0x168c57(0x19d)](_0x4c5cf0));return console[_0x168c57(0x110)](_0x168c57(0x1c7),_0x4e42c4[_0x168c57(0x140)]),_0x4e42c4[_0x168c57(0x1e0)](_0x168c57(0x135));}catch(_0x388417){console[_0x168c57(0x1b9)](_0x168c57(0x144),_0x388417);throw new Error(_0x168c57(0x10d));}}['signRSA'](_0x3eb2ee){const _0x2f3325=a42_0x38b30f;try{const _0x200bba=fs_1[_0x2f3325(0x17e)][_0x2f3325(0x11d)](this[_0x2f3325(0x130)],_0x2f3325(0x160))['trim'](),_0x158c73=crypto_1[_0x2f3325(0x17e)][_0x2f3325(0x119)]('SHA256');_0x158c73['update'](_0x3eb2ee),_0x158c73[_0x2f3325(0x18c)]();const _0x2b17ee=_0x158c73['sign'](_0x200bba,_0x2f3325(0x135));return console[_0x2f3325(0x110)](_0x2f3325(0x118)),console[_0x2f3325(0x110)](_0x2f3325(0x178),_0x3eb2ee[_0x2f3325(0x140)]),console['log'](_0x2f3325(0x1e3),_0x2b17ee[_0x2f3325(0x140)]),_0x2b17ee;}catch(_0x2d7f1b){console[_0x2f3325(0x1b9)]('❌\x20RSA\x20signing\x20failed:',_0x2d7f1b),console[_0x2f3325(0x1b9)](_0x2f3325(0x124),_0x3eb2ee['substring'](0x0,0xc8)+'...');throw new Error(_0x2f3325(0x15b));}}['decryptAES'](_0x2fffea,_0x184231,_0x23bfa7){const _0x3d9ca7=a42_0x38b30f,_0x154725=crypto_1[_0x3d9ca7(0x17e)][_0x3d9ca7(0x19b)](_0x3d9ca7(0x1a6),_0x184231,_0x23bfa7);let _0x130cd2=_0x154725[_0x3d9ca7(0x14d)](_0x2fffea,'base64',_0x3d9ca7(0x160));return _0x130cd2+=_0x154725[_0x3d9ca7(0x1e2)](_0x3d9ca7(0x160)),_0x130cd2;}async['decryptResponsePhp'](_0x1f9510,_0x4197be){const _0x4820f0=a42_0x38b30f;try{const _0x15bb5f=await fetch(_0x4820f0(0x114),{'method':_0x4820f0(0x1ba),'headers':{'Content-Type':'application/json'},'body':JSON[_0x4820f0(0x146)]({'info':_0x1f9510,'key':_0x4197be})});if(!_0x15bb5f['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x15bb5f[_0x4820f0(0x155)]();}catch(_0x171718){console[_0x4820f0(0x1b9)](_0x4820f0(0x10c),_0x171718);throw new Error(_0x4820f0(0x158));}}['decryptResponse'](_0x5b7a28,_0x145d91){const _0x4f1af6=a42_0x38b30f;try{const _0x124364=fs_1['default'][_0x4f1af6(0x11d)](this[_0x4f1af6(0x130)],'utf8')[_0x4f1af6(0x195)](),_0x3f9350=crypto_1[_0x4f1af6(0x17e)][_0x4f1af6(0x159)](_0x124364,Buffer['from'](_0x145d91,_0x4f1af6(0x135))),_0x458550=JSON['parse'](_0x3f9350[_0x4f1af6(0x1e0)]()),_0x3081dd=Buffer[_0x4f1af6(0x19d)](_0x458550['key'],_0x4f1af6(0x135)),_0xee41ac=Buffer[_0x4f1af6(0x19d)](_0x458550['iv'],'base64');return this[_0x4f1af6(0x1cc)](_0x5b7a28,_0x3081dd,_0xee41ac);}catch(_0x27e7df){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a42_0x38b30f(0x1f1)](_0x4609b6){const _0x1b7c9d=a42_0x38b30f,{paymentId:_0x311163,orderId:_0xf22dcf,amount:_0x244788,currency:_0x578a36,cardData:_0x2bb8cc,resultUrl:_0x370f03,returnUrl:_0x3ae904,cardHolder:_0x42e92b,browser:_0x4cdb39}=_0x4609b6;console[_0x1b7c9d(0x110)]('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x1ee),_0x311163),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x1d5),_0xf22dcf),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x152),_0x244788,_0x578a36),console['log'](_0x1b7c9d(0x109),this[_0x1b7c9d(0x1aa)](_0x2bb8cc[_0x1b7c9d(0x166)])),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x171),_0x42e92b[_0x1b7c9d(0x193)]+'\x20'+_0x42e92b[_0x1b7c9d(0x138)]),console['log'](_0x1b7c9d(0x15c),_0x3ae904),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x1c5),_0x370f03);const _0x3aebe0={'amount':_0x244788,'currency':_0x578a36[_0x1b7c9d(0x18f)](),'order_id':_0xf22dcf,'result_url':_0x370f03,'return_url':_0x3ae904,'card':{'number':_0x2bb8cc[_0x1b7c9d(0x166)],'expire_month':_0x2bb8cc[_0x1b7c9d(0x16e)],'expire_year':_0x2bb8cc[_0x1b7c9d(0x1a7)],'cvv':_0x2bb8cc[_0x1b7c9d(0x19f)]},'card_holder':_0x42e92b,'browser':_0x4cdb39},_0x51a5ea=JSON[_0x1b7c9d(0x146)](_0x3aebe0);console[_0x1b7c9d(0x110)]('💾\x20Payment\x20data\x20prepared'),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x13d)),console[_0x1b7c9d(0x110)](_0x51a5ea),console[_0x1b7c9d(0x110)]('📝\x20Data\x20length:',_0x51a5ea[_0x1b7c9d(0x140)]);try{const {key:_0x226809,iv:_0x1f4476}=this['generateAESKey']();console[_0x1b7c9d(0x110)](_0x1b7c9d(0x1e1)),console['log']('🔐\x20AES\x20key\x20length:',_0x226809[_0x1b7c9d(0x140)]),console['log'](_0x1b7c9d(0x11b),_0x1f4476[_0x1b7c9d(0x140)]);const _0x499fbb=this[_0x1b7c9d(0x1d2)](_0x51a5ea,_0x226809,_0x1f4476);console[_0x1b7c9d(0x110)](_0x1b7c9d(0x16b)),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x1dc),_0x499fbb['length']);const _0x9d755b=this['encryptRSA'](_0x226809,_0x1f4476);console[_0x1b7c9d(0x110)](_0x1b7c9d(0x1a0)),console[_0x1b7c9d(0x110)]('📝\x20Encrypted\x20key\x20length:',_0x9d755b[_0x1b7c9d(0x140)]);const _0x302523=this[_0x1b7c9d(0x1a2)](_0x51a5ea);console[_0x1b7c9d(0x110)](_0x1b7c9d(0x1ea)),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x1e3),_0x302523['length']);const _0x1cd5b4={'merchant_point_id':this['merchantPointId'],'method':'charge','info':_0x499fbb,'key':_0x9d755b,'sign':_0x302523,'lang':'en'};console[_0x1b7c9d(0x110)](_0x1b7c9d(0x1f5)),console['log']('📝\x20Final\x20request\x20structure:'),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x16d),this['merchantPointId']),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x180)),console['log'](_0x1b7c9d(0x1d9),_0x499fbb['length']),console['log'](_0x1b7c9d(0x164),_0x9d755b[_0x1b7c9d(0x140)]),console['log'](_0x1b7c9d(0x142),_0x302523['length']),console[_0x1b7c9d(0x110)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x1b7c9d(0x1f2)][_0x1b7c9d(0x150)]('mastercard',_0x1b7c9d(0x177),_0x1b7c9d(0x1ba),{'merchant_point_id':this[_0x1b7c9d(0x1ed)],'method':_0x1b7c9d(0x173),'lang':'en'});const _0x387714=Date['now'](),_0x2dccfe=await fetch(this[_0x1b7c9d(0x11e)],{'method':_0x1b7c9d(0x1ba),'headers':{'Content-Type':_0x1b7c9d(0x12f),'Accept':'application/json','User-Agent':_0x1b7c9d(0x179)},'body':JSON['stringify'](_0x1cd5b4)}),_0x5069b8=Date['now']()-_0x387714;console[_0x1b7c9d(0x110)](_0x1b7c9d(0x13f)),console['log'](_0x1b7c9d(0x1da),_0x2dccfe[_0x1b7c9d(0x1e8)]),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x12b),_0x5069b8+'ms');if(!_0x2dccfe['ok']){const _0x3c8ecd=await _0x2dccfe['text']();console['error'](_0x1b7c9d(0x1be),_0x2dccfe[_0x1b7c9d(0x1e8)]),console['error'](_0x1b7c9d(0x185),_0x3c8ecd),loggerService_1['loggerService'][_0x1b7c9d(0x14f)](_0x1b7c9d(0x151),_0x1b7c9d(0x16c),_0x2dccfe['status'],_0x3c8ecd,_0x5069b8),loggerService_1['loggerService']['logWhiteDomainError'](_0x1b7c9d(0x151),_0x1b7c9d(0x177),_0x1b7c9d(0x1b5)+_0x2dccfe['status']+':\x20'+_0x3c8ecd);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2dccfe[_0x1b7c9d(0x1e8)]+_0x1b7c9d(0x12e)+_0x3c8ecd);}const _0x338955=await _0x2dccfe['json']();loggerService_1[_0x1b7c9d(0x1f2)][_0x1b7c9d(0x14f)](_0x1b7c9d(0x151),_0x1b7c9d(0x16c),_0x2dccfe['status'],_0x338955,_0x5069b8),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x1c2));let _0x2e8aab=_0x338955;if(_0x338955[_0x1b7c9d(0x11f)]&&_0x338955[_0x1b7c9d(0x168)]&&_0x338955[_0x1b7c9d(0x1f0)]){console[_0x1b7c9d(0x110)](_0x1b7c9d(0x113));try{const _0x230c6b=await this[_0x1b7c9d(0x17b)](_0x338955[_0x1b7c9d(0x11f)],_0x338955[_0x1b7c9d(0x168)]);_0x2e8aab=JSON[_0x1b7c9d(0x19a)](_0x230c6b),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x19c)),loggerService_1[_0x1b7c9d(0x1f2)]['logWhiteDomainResponse'](_0x1b7c9d(0x151),_0x1b7c9d(0x15f),_0x2dccfe[_0x1b7c9d(0x1e8)],_0x2e8aab,_0x5069b8),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x1b2));}catch(_0x2d042c){console[_0x1b7c9d(0x1b9)](_0x1b7c9d(0x1ac),_0x2d042c),loggerService_1[_0x1b7c9d(0x1f2)][_0x1b7c9d(0x1e7)](_0x1b7c9d(0x151),_0x1b7c9d(0x139),'Decryption\x20failed:\x20'+_0x2d042c),_0x2e8aab=_0x338955;}}else loggerService_1[_0x1b7c9d(0x1f2)]['logWhiteDomainResponse'](_0x1b7c9d(0x151),'/charge_decrypted',_0x2dccfe['status'],_0x2e8aab,_0x5069b8),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x1ae));console[_0x1b7c9d(0x110)]('Status:',_0x2e8aab[_0x1b7c9d(0x1e8)]),console[_0x1b7c9d(0x110)]('Final:',_0x2e8aab[_0x1b7c9d(0x1e2)]),console[_0x1b7c9d(0x110)](_0x1b7c9d(0x1ee),_0x2e8aab[_0x1b7c9d(0x191)]),console[_0x1b7c9d(0x110)]('3DS\x20URL:',_0x2e8aab[_0x1b7c9d(0x1a5)]||'none');if(_0x2e8aab['status']===0x64&&_0x2e8aab[_0x1b7c9d(0x1e2)]===0x1)return console[_0x1b7c9d(0x110)](_0x1b7c9d(0x131)),{'gateway_payment_id':_0x2e8aab[_0x1b7c9d(0x191)]?.[_0x1b7c9d(0x1e0)](),'payment_url':_0x3ae904,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x2e8aab['3ds_url'])return console['log']('🔐\x203DS\x20verification\x20required'),this[_0x1b7c9d(0x1d8)](_0x311163,_0xf22dcf,_0x2e8aab[_0x1b7c9d(0x191)]?.[_0x1b7c9d(0x1e0)]()||_0xf22dcf),{'gateway_payment_id':_0x2e8aab[_0x1b7c9d(0x191)]?.['toString'](),'payment_url':_0x2e8aab['3ds_url'],'requires_3ds':!![],'threeds_url':_0x2e8aab[_0x1b7c9d(0x1a5)],'status':_0x1b7c9d(0x170),'final':![]};let _0x4c3494=_0x2e8aab['desc']||_0x2e8aab[_0x1b7c9d(0x18e)]||'Unknown\x20error',_0x1855ea=_0x2e8aab[_0x1b7c9d(0x1e8)],_0x1d33c8=_0x2e8aab['final'];return console[_0x1b7c9d(0x110)](_0x1b7c9d(0x162)+_0x1855ea+',\x20Final:\x20'+_0x1d33c8+',\x20Desc:\x20'+_0x4c3494),{'gateway_payment_id':_0x2e8aab['payment_id']?.['toString'](),'payment_url':_0x3ae904,'requires_3ds':![],'status':_0x1b7c9d(0x10b),'final':!![]};}catch(_0x35d304){console['error'](_0x1b7c9d(0x148)),console[_0x1b7c9d(0x1b9)]('Error\x20details:',_0x35d304),loggerService_1[_0x1b7c9d(0x1f2)][_0x1b7c9d(0x1e7)](_0x1b7c9d(0x151),_0x1b7c9d(0x177),_0x35d304);throw new Error(_0x1b7c9d(0x1ab)+(_0x35d304 instanceof Error?_0x35d304[_0x1b7c9d(0x18e)]:_0x1b7c9d(0x12c)));}}async['checkPaymentStatus'](_0xb85c1a,_0x4d773b){const _0x2a3029=a42_0x38b30f;console[_0x2a3029(0x110)]('📊\x20Checking\x20MasterCard\x20payment\x20status:\x20'+_0xb85c1a+'\x20('+_0x4d773b+')');try{const _0x475312={'payment_id':_0xb85c1a,'order_id':_0x4d773b},_0x2055a6=JSON[_0x2a3029(0x146)](_0x475312),{key:_0x39c62f,iv:_0x1fc7cb}=this[_0x2a3029(0x1a3)](),_0x193bd9=this[_0x2a3029(0x1d2)](_0x2055a6,_0x39c62f,_0x1fc7cb),_0x382184=this[_0x2a3029(0x188)](_0x39c62f,_0x1fc7cb),_0x41ad97=this[_0x2a3029(0x1a2)](_0x2055a6),_0x18bef4={'merchant_point_id':this[_0x2a3029(0x1ed)],'method':_0x2a3029(0x1e8),'info':_0x193bd9,'key':_0x382184,'sign':_0x41ad97,'lang':'en'};loggerService_1[_0x2a3029(0x1f2)][_0x2a3029(0x150)]('mastercard',_0x2a3029(0x11c),_0x2a3029(0x1ba),{'merchant_point_id':this[_0x2a3029(0x1ed)],'method':_0x2a3029(0x1e8),'lang':'en'});const _0x32e5ca=Date[_0x2a3029(0x13e)](),_0x1074e1=await fetch(this[_0x2a3029(0x11e)],{'method':_0x2a3029(0x1ba),'headers':{'Content-Type':'application/json','Accept':_0x2a3029(0x12f),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x2a3029(0x146)](_0x18bef4)}),_0x5ad53b=Date['now']()-_0x32e5ca;if(!_0x1074e1['ok']){const _0x515a79=await _0x1074e1['text']();loggerService_1[_0x2a3029(0x1f2)][_0x2a3029(0x14f)](_0x2a3029(0x151),_0x2a3029(0x145),_0x1074e1[_0x2a3029(0x1e8)],_0x515a79,_0x5ad53b);throw new Error(_0x2a3029(0x1bc)+_0x1074e1[_0x2a3029(0x1e8)]);}const _0x2c9b0d=await _0x1074e1[_0x2a3029(0x1d6)]();loggerService_1[_0x2a3029(0x1f2)][_0x2a3029(0x14f)](_0x2a3029(0x151),_0x2a3029(0x145),_0x1074e1['status'],_0x2c9b0d,_0x5ad53b);let _0x4dbcc7=_0x2c9b0d;if(_0x2c9b0d[_0x2a3029(0x11f)]&&_0x2c9b0d['key']&&_0x2c9b0d[_0x2a3029(0x1f0)]){console[_0x2a3029(0x110)](_0x2a3029(0x15d));try{const _0x4bd83b=this['decryptResponse'](_0x2c9b0d['info'],_0x2c9b0d['key']);_0x4dbcc7=JSON['parse'](_0x4bd83b),console[_0x2a3029(0x110)](_0x2a3029(0x1a8)),loggerService_1[_0x2a3029(0x1f2)]['logWhiteDomainResponse'](_0x2a3029(0x151),_0x2a3029(0x1d1),_0x1074e1[_0x2a3029(0x1e8)],_0x4dbcc7,_0x5ad53b),console[_0x2a3029(0x110)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x222347){console['error']('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x222347),loggerService_1[_0x2a3029(0x1f2)][_0x2a3029(0x1e7)](_0x2a3029(0x151),'/status_decrypt',_0x2a3029(0x1e5)+_0x222347),_0x4dbcc7=_0x2c9b0d;}}else loggerService_1[_0x2a3029(0x1f2)][_0x2a3029(0x14f)](_0x2a3029(0x151),_0x2a3029(0x1d1),_0x1074e1['status'],_0x4dbcc7,_0x5ad53b),console[_0x2a3029(0x110)](_0x2a3029(0x1b8));console[_0x2a3029(0x110)](_0x2a3029(0x1af),{'status':_0x4dbcc7['status'],'final':_0x4dbcc7[_0x2a3029(0x1e2)],'payment_id':_0x4dbcc7[_0x2a3029(0x191)],'desc':_0x4dbcc7[_0x2a3029(0x17a)]});let _0x2d796b='PENDING';if(_0x4dbcc7[_0x2a3029(0x1e8)]===0x1&&_0x4dbcc7[_0x2a3029(0x1e2)]===0x1)_0x2d796b=_0x2a3029(0x122);else _0x4dbcc7[_0x2a3029(0x1e8)]===0x0&&_0x4dbcc7[_0x2a3029(0x1e2)]===0x0?_0x2d796b='PENDING':_0x2d796b=_0x2a3029(0x10b);return{'status':_0x2d796b,'final':_0x4dbcc7[_0x2a3029(0x1e2)]===0x1,'amount':_0x4dbcc7['amount'],'currency':_0x4dbcc7['currency'],'date_success':_0x4dbcc7[_0x2a3029(0x12d)],'description':_0x4dbcc7[_0x2a3029(0x17a)]};}catch(_0x2d72a6){console[_0x2a3029(0x1b9)]('MasterCard\x20status\x20check\x20error:',_0x2d72a6),loggerService_1[_0x2a3029(0x1f2)][_0x2a3029(0x1e7)](_0x2a3029(0x151),_0x2a3029(0x11c),_0x2d72a6);throw new Error(_0x2a3029(0x15e)+(_0x2d72a6 instanceof Error?_0x2d72a6[_0x2a3029(0x18e)]:_0x2a3029(0x12c)));}}['scheduleStatusChecks'](_0x1fdd55,_0x56f33a,_0x31e62a){const _0x274005=a42_0x38b30f;console['log'](_0x274005(0x17d)+_0x1fdd55+'\x20('+_0x31e62a+')'),this[_0x274005(0x111)](_0x1fdd55);const _0x3b0436=[],_0x40dc8a=0x5*0x3c*0x3e8,_0x564685=0x2*0x3c*0x3c*0x3e8,_0x1d365a=Math[_0x274005(0x197)](_0x564685/_0x40dc8a);console[_0x274005(0x110)](_0x274005(0x1d3)+_0x1d365a+_0x274005(0x1cf));for(let _0x44e4b8=0x1;_0x44e4b8<=_0x1d365a;_0x44e4b8++){const _0x1d60c1=setTimeout(async()=>{const _0x305277=_0x274005;console[_0x305277(0x110)]('🔍\x20MasterCard\x20status\x20check\x20#'+_0x44e4b8+'/'+_0x1d365a+_0x305277(0x136)+_0x1fdd55);try{const _0x3a4f56=await this['checkPaymentStatus'](_0x31e62a,_0x56f33a);console[_0x305277(0x110)](_0x305277(0x194)+_0x44e4b8+_0x305277(0x1b3),_0x3a4f56),_0x3a4f56[_0x305277(0x1e2)]&&(console[_0x305277(0x110)]('✅\x20Payment\x20'+_0x1fdd55+_0x305277(0x198)+_0x3a4f56[_0x305277(0x1e8)]+_0x305277(0x149)),this[_0x305277(0x111)](_0x1fdd55),await this[_0x305277(0x157)](_0x1fdd55,_0x3a4f56[_0x305277(0x1e8)],_0x3a4f56));}catch(_0x158280){console[_0x305277(0x1b9)](_0x305277(0x1a4)+_0x44e4b8+_0x305277(0x196)+_0x1fdd55+':',_0x158280);}},_0x44e4b8*_0x40dc8a);_0x3b0436['push'](_0x1d60c1);}this['statusCheckTimers'][_0x274005(0x137)](_0x1fdd55,_0x3b0436),console[_0x274005(0x110)]('✅\x20Scheduled\x20'+_0x1d365a+'\x20status\x20checks\x20for\x20payment\x20'+_0x1fdd55);}['clearStatusTimers'](_0x2b7bd9){const _0x5d87d9=a42_0x38b30f,_0x4b8e5c=this['statusCheckTimers'][_0x5d87d9(0x14e)](_0x2b7bd9);_0x4b8e5c&&(console[_0x5d87d9(0x110)]('🧹\x20Clearing\x20'+_0x4b8e5c[_0x5d87d9(0x140)]+_0x5d87d9(0x10f)+_0x2b7bd9),_0x4b8e5c[_0x5d87d9(0x18b)]((_0x2e4193,_0x228634)=>{clearTimeout(_0x2e4193);}),this['statusCheckTimers'][_0x5d87d9(0x1b7)](_0x2b7bd9));}async['updatePaymentStatus'](_0x2b3e1a,_0x2562c4,_0xf6ea3c){const _0x22cc3f=a42_0x38b30f;try{const _0x4ac816=(await Promise[_0x22cc3f(0x1db)]()[_0x22cc3f(0x13a)](()=>__importStar(require('../../config/database'))))['default'],_0x381dca={'status':_0x2562c4[_0x22cc3f(0x18f)](),'updatedAt':new Date(),'statusChangedBy':_0x22cc3f(0x112),'statusChangedAt':new Date()};_0x2562c4==='PAID'&&(_0x381dca[_0x22cc3f(0x1b4)]=new Date()),_0xf6ea3c[_0x22cc3f(0x1c6)]&&(_0x381dca[_0x22cc3f(0x1ad)]=_0x22cc3f(0x1b0)+_0xf6ea3c[_0x22cc3f(0x1c6)]),await _0x4ac816[_0x22cc3f(0x167)][_0x22cc3f(0x14d)]({'where':{'id':_0x2b3e1a},'data':_0x381dca}),console[_0x22cc3f(0x110)]('✅\x20Payment\x20'+_0x2b3e1a+'\x20status\x20updated\x20to\x20'+_0x2562c4),await this['sendPaymentNotifications'](_0x2b3e1a,_0x2562c4);}catch(_0x2c0757){console[_0x22cc3f(0x1b9)](_0x22cc3f(0x165)+_0x2b3e1a+':',_0x2c0757);}}async[a42_0x38b30f(0x161)](_0x582fa6,_0x2c54de){const _0x10a61a=a42_0x38b30f;try{const _0x58843c=(await Promise[_0x10a61a(0x1db)]()[_0x10a61a(0x13a)](()=>__importStar(require('../../config/database'))))['default'],{telegramBotService:_0x3ce3a0}=await Promise['resolve']()[_0x10a61a(0x13a)](()=>__importStar(require(_0x10a61a(0x116)))),_0x2fb06f=await _0x58843c[_0x10a61a(0x167)][_0x10a61a(0x172)]({'where':{'id':_0x582fa6},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x2fb06f)return;const _0x3add16={'PAID':_0x10a61a(0x1d4),'FAILED':_0x10a61a(0x16a)},_0x2fd133=_0x3add16[_0x2c54de];_0x2fd133&&await _0x3ce3a0['sendPaymentNotification'](_0x2fb06f[_0x10a61a(0x128)],_0x2fb06f,_0x2fd133),await this[_0x10a61a(0x18a)](_0x2fb06f,_0x2c54de);}catch(_0x3e4e92){console[_0x10a61a(0x1b9)](_0x10a61a(0x1e6),_0x3e4e92);}}async[a42_0x38b30f(0x18a)](_0x451e65,_0x4e2996){const _0x504011=a42_0x38b30f,_0xb4df0a=Date[_0x504011(0x13e)]();try{const _0xe0828b=_0x451e65[_0x504011(0x141)],_0x528ed8=_0xe0828b[_0x504011(0x186)];if(!_0x528ed8?.[_0x504011(0x147)]){console['log']('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0xe0828b['id']);return;}const _0x421a1b=_0x4e2996===_0x504011(0x122)?'payment.success':_0x504011(0x154);let _0x4934cc=[];if(_0x528ed8[_0x504011(0x11a)])try{_0x4934cc=Array['isArray'](_0x528ed8[_0x504011(0x11a)])?_0x528ed8['webhookEvents']:JSON[_0x504011(0x19a)](_0x528ed8[_0x504011(0x11a)]);}catch(_0xedb3fc){console['error'](_0x504011(0x189),_0xedb3fc),_0x4934cc=[];}if(!_0x4934cc[_0x504011(0x126)](_0x421a1b)){console['log']('Webhook\x20event\x20'+_0x421a1b+_0x504011(0x190)+_0xe0828b['id']);return;}const _0x4d5a3a={'event':_0x421a1b,'payment':{'id':_0x451e65['id'],'order_id':_0x451e65['orderId'],'gateway_order_id':_0x451e65['gatewayOrderId'],'gateway':'1111','amount':_0x451e65[_0x504011(0x1f3)],'currency':_0x451e65['currency'],'status':_0x4e2996[_0x504011(0x1a1)](),'customer_email':_0x451e65[_0x504011(0x17f)],'customer_name':_0x451e65[_0x504011(0x1e4)],'created_at':_0x451e65['createdAt'],'updated_at':new Date()}},_0x505e8c=await fetch(_0x528ed8[_0x504011(0x147)],{'method':'POST','headers':{'Content-Type':_0x504011(0x12f),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(MasterCard)'},'body':JSON[_0x504011(0x146)](_0x4d5a3a)}),_0xa09b3e=Date[_0x504011(0x13e)]()-_0xb4df0a;loggerService_1[_0x504011(0x1f2)][_0x504011(0x176)](_0x451e65[_0x504011(0x128)],_0x528ed8['webhookUrl'],_0x421a1b,_0x505e8c['status'],_0xa09b3e,_0x4d5a3a),console[_0x504011(0x110)](_0x504011(0x18d)+_0x528ed8['webhookUrl']+_0x504011(0x1a9)+_0x505e8c['status']+'\x20('+_0xa09b3e+'ms)');}catch(_0x3ba512){console['error'](_0x504011(0x1c8),_0x3ba512),loggerService_1['loggerService'][_0x504011(0x10e)](_0x451e65[_0x504011(0x128)],_0x451e65[_0x504011(0x141)]?.[_0x504011(0x186)]?.[_0x504011(0x147)]||'unknown',_0x504011(0x192),_0x3ba512,{});}}[a42_0x38b30f(0x1aa)](_0x42e4c3){const _0x564a5d=a42_0x38b30f,_0x1ce5fa=_0x42e4c3[_0x564a5d(0x183)](/[\s-]/g,'');if(_0x1ce5fa[_0x564a5d(0x140)]<0x4)return'****';return _0x564a5d(0x1df)+_0x1ce5fa['slice'](-0x4);}async[a42_0x38b30f(0x14b)](_0x56611c){const _0x4592b6=a42_0x38b30f;console[_0x4592b6(0x110)](_0x4592b6(0x1ca),_0x56611c);let _0x55ea5=_0x4592b6(0x170);if(_0x56611c['status']===0x1&&_0x56611c['final']===0x1)_0x55ea5=_0x4592b6(0x122);else _0x56611c[_0x4592b6(0x1e8)]===0x0&&_0x56611c[_0x4592b6(0x1e2)]===0x0?_0x55ea5='PENDING':_0x55ea5=_0x4592b6(0x10b);return{'paymentId':_0x56611c[_0x4592b6(0x1bf)]||'','status':_0x55ea5,'amount':_0x56611c[_0x4592b6(0x1f3)],'currency':_0x56611c['currency']};}['stopAllStatusChecks'](){const _0x4a4b1c=a42_0x38b30f;console[_0x4a4b1c(0x110)](_0x4a4b1c(0x1ef));const _0xf0f04f=this[_0x4a4b1c(0x184)]['size'];for(const [_0x493393]of this['statusCheckTimers']){this['clearStatusTimers'](_0x493393);}console[_0x4a4b1c(0x110)](_0x4a4b1c(0x1ec)+_0xf0f04f+_0x4a4b1c(0x1bd));}}exports['MasterCardService']=MasterCardService;