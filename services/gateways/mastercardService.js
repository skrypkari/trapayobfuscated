'use strict';const a42_0x4ff58c=a42_0x528b;(function(_0x298e96,_0x450b46){const _0x358c9c=a42_0x528b,_0x3f69e1=_0x298e96();while(!![]){try{const _0x5a253d=parseInt(_0x358c9c(0x20e))/0x1*(-parseInt(_0x358c9c(0x2d7))/0x2)+parseInt(_0x358c9c(0x244))/0x3*(-parseInt(_0x358c9c(0x283))/0x4)+parseInt(_0x358c9c(0x26a))/0x5*(parseInt(_0x358c9c(0x2c6))/0x6)+parseInt(_0x358c9c(0x205))/0x7*(parseInt(_0x358c9c(0x2b4))/0x8)+parseInt(_0x358c9c(0x247))/0x9*(parseInt(_0x358c9c(0x27b))/0xa)+-parseInt(_0x358c9c(0x28a))/0xb*(parseInt(_0x358c9c(0x2ab))/0xc)+-parseInt(_0x358c9c(0x261))/0xd*(-parseInt(_0x358c9c(0x2c2))/0xe);if(_0x5a253d===_0x450b46)break;else _0x3f69e1['push'](_0x3f69e1['shift']());}catch(_0x9335c3){_0x3f69e1['push'](_0x3f69e1['shift']());}}}(a42_0x2884,0xcc7d8));var __createBinding=this&&this[a42_0x4ff58c(0x26d)]||(Object[a42_0x4ff58c(0x28e)]?function(_0x7664c4,_0x36ea86,_0x2330c5,_0x4ece62){const _0x108fd7=a42_0x4ff58c;if(_0x4ece62===undefined)_0x4ece62=_0x2330c5;var _0x72b760=Object[_0x108fd7(0x257)](_0x36ea86,_0x2330c5);(!_0x72b760||(_0x108fd7(0x210)in _0x72b760?!_0x36ea86[_0x108fd7(0x246)]:_0x72b760[_0x108fd7(0x2b3)]||_0x72b760['configurable']))&&(_0x72b760={'enumerable':!![],'get':function(){return _0x36ea86[_0x2330c5];}}),Object[_0x108fd7(0x252)](_0x7664c4,_0x4ece62,_0x72b760);}:function(_0x2f7de8,_0x47347b,_0x5cccfe,_0x1fa261){if(_0x1fa261===undefined)_0x1fa261=_0x5cccfe;_0x2f7de8[_0x1fa261]=_0x47347b[_0x5cccfe];}),__setModuleDefault=this&&this[a42_0x4ff58c(0x1ff)]||(Object[a42_0x4ff58c(0x28e)]?function(_0x41de6b,_0x4a7020){const _0x4363dc=a42_0x4ff58c;Object['defineProperty'](_0x41de6b,_0x4363dc(0x2cb),{'enumerable':!![],'value':_0x4a7020});}:function(_0x574738,_0x152665){const _0x4667b1=a42_0x4ff58c;_0x574738[_0x4667b1(0x2cb)]=_0x152665;}),__importStar=this&&this[a42_0x4ff58c(0x285)]||(function(){var _0x2f55d4=function(_0x1ef7f4){const _0x40f3a0=a42_0x528b;return _0x2f55d4=Object[_0x40f3a0(0x24e)]||function(_0x1cbe46){const _0x52546f=_0x40f3a0;var _0x28852c=[];for(var _0x4f81d3 in _0x1cbe46)if(Object[_0x52546f(0x289)][_0x52546f(0x201)]['call'](_0x1cbe46,_0x4f81d3))_0x28852c[_0x28852c['length']]=_0x4f81d3;return _0x28852c;},_0x2f55d4(_0x1ef7f4);};return function(_0x48524a){const _0x408ecf=a42_0x528b;if(_0x48524a&&_0x48524a[_0x408ecf(0x246)])return _0x48524a;var _0x307496={};if(_0x48524a!=null){for(var _0x4da94=_0x2f55d4(_0x48524a),_0x17ccf2=0x0;_0x17ccf2<_0x4da94['length'];_0x17ccf2++)if(_0x4da94[_0x17ccf2]!==_0x408ecf(0x2cb))__createBinding(_0x307496,_0x48524a,_0x4da94[_0x17ccf2]);}return __setModuleDefault(_0x307496,_0x48524a),_0x307496;};}()),__importDefault=this&&this[a42_0x4ff58c(0x1f5)]||function(_0x1a57d7){const _0x4329d8=a42_0x4ff58c;return _0x1a57d7&&_0x1a57d7[_0x4329d8(0x246)]?_0x1a57d7:{'default':_0x1a57d7};};function a42_0x528b(_0x3452c0,_0x46461a){const _0x2884af=a42_0x2884();return a42_0x528b=function(_0x528be2,_0x552654){_0x528be2=_0x528be2-0x1ee;let _0x35fe97=_0x2884af[_0x528be2];return _0x35fe97;},a42_0x528b(_0x3452c0,_0x46461a);}Object[a42_0x4ff58c(0x252)](exports,'__esModule',{'value':!![]}),exports[a42_0x4ff58c(0x22c)]=void 0x0;const crypto_1=__importDefault(require(a42_0x4ff58c(0x250))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x4ff58c(0x2de))),loggerService_1=require(a42_0x4ff58c(0x245));class MasterCardService{constructor(){const _0x1ac588=a42_0x4ff58c;this[_0x1ac588(0x212)]=new Map(),this[_0x1ac588(0x293)]=_0x1ac588(0x26e),this[_0x1ac588(0x2bf)]=0x67c,this[_0x1ac588(0x2c5)]=path_1[_0x1ac588(0x2cb)][_0x1ac588(0x29d)](process['cwd'](),_0x1ac588(0x254),_0x1ac588(0x230)),this[_0x1ac588(0x2a6)]=path_1[_0x1ac588(0x2cb)][_0x1ac588(0x29d)](process[_0x1ac588(0x2d9)](),'keys',_0x1ac588(0x27a)),console[_0x1ac588(0x209)](_0x1ac588(0x2a3)),console[_0x1ac588(0x209)](_0x1ac588(0x2d5),this[_0x1ac588(0x2c5)]),console['log'](_0x1ac588(0x26c),this['publicKeyPath']),this[_0x1ac588(0x278)]();}[a42_0x4ff58c(0x278)](){const _0x43db58=a42_0x4ff58c;try{if(!fs_1[_0x43db58(0x2cb)][_0x43db58(0x1ee)](this[_0x43db58(0x2c5)]))throw new Error(_0x43db58(0x2aa)+this[_0x43db58(0x2c5)]);if(!fs_1['default']['existsSync'](this[_0x43db58(0x2a6)]))throw new Error(_0x43db58(0x206)+this[_0x43db58(0x2a6)]);const _0x2cd84b=fs_1['default'][_0x43db58(0x207)](this[_0x43db58(0x2c5)],_0x43db58(0x274))['trim'](),_0x27debc=fs_1['default'][_0x43db58(0x207)](this[_0x43db58(0x2a6)],_0x43db58(0x274))[_0x43db58(0x28b)]();if(!_0x2cd84b[_0x43db58(0x21e)](_0x43db58(0x25a))||!_0x2cd84b['includes'](_0x43db58(0x2c9)))throw new Error('Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x27debc[_0x43db58(0x21e)](_0x43db58(0x25a))||!_0x27debc[_0x43db58(0x21e)]('-----END'))throw new Error(_0x43db58(0x215));console[_0x43db58(0x209)](_0x43db58(0x211)),console[_0x43db58(0x209)](_0x43db58(0x266)+_0x2cd84b['length']+'\x20characters'),console[_0x43db58(0x209)](_0x43db58(0x25b)+_0x27debc[_0x43db58(0x249)]+'\x20characters');}catch(_0x75711){console[_0x43db58(0x253)]('❌\x20MasterCard\x20key\x20validation\x20failed:',_0x75711);throw _0x75711;}}[a42_0x4ff58c(0x24a)](){const _0x51e6ae=a42_0x4ff58c,_0x20927b=crypto_1[_0x51e6ae(0x2cb)]['randomBytes'](0x20),_0x3390a7=crypto_1[_0x51e6ae(0x2cb)][_0x51e6ae(0x1f4)](0x10);return{'key':_0x20927b,'iv':_0x3390a7};}['encryptAES'](_0x515c93,_0x3e4190,_0x53c91a){const _0x344570=a42_0x4ff58c,_0x5610ce=crypto_1[_0x344570(0x2cb)]['createCipheriv'](_0x344570(0x282),_0x3e4190,_0x53c91a);let _0x2a73c0=_0x5610ce[_0x344570(0x229)](_0x515c93,_0x344570(0x274),_0x344570(0x2e1));return _0x2a73c0+=_0x5610ce['final'](_0x344570(0x2e1)),_0x2a73c0;}[a42_0x4ff58c(0x23b)](_0x315f61,_0x8f8b81){const _0x1eacaa=a42_0x4ff58c;try{const _0x5ce44e=fs_1[_0x1eacaa(0x2cb)][_0x1eacaa(0x207)](this[_0x1eacaa(0x2a6)],'utf8')[_0x1eacaa(0x28b)](),_0x504170={'iv':_0x8f8b81[_0x1eacaa(0x1f6)](_0x1eacaa(0x2e1)),'key':_0x315f61[_0x1eacaa(0x1f6)](_0x1eacaa(0x2e1))},_0x5aebe5=JSON[_0x1eacaa(0x218)](_0x504170);console[_0x1eacaa(0x209)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x5aebe5[_0x1eacaa(0x249)]);const _0x570d07=crypto_1['default'][_0x1eacaa(0x237)]({'key':_0x5ce44e,'padding':crypto_1['default'][_0x1eacaa(0x2bd)][_0x1eacaa(0x2ba)]},Buffer[_0x1eacaa(0x2d1)](_0x5aebe5));return console[_0x1eacaa(0x209)](_0x1eacaa(0x29b),_0x570d07[_0x1eacaa(0x249)]),_0x570d07['toString'](_0x1eacaa(0x2e1));}catch(_0x3606e6){console['error'](_0x1eacaa(0x22b),_0x3606e6);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}['signRSA'](_0x1e7e19){const _0x486834=a42_0x4ff58c;try{const _0x5e009e=fs_1['default'][_0x486834(0x207)](this[_0x486834(0x2c5)],'utf8')['trim'](),_0x2276f0=crypto_1[_0x486834(0x2cb)][_0x486834(0x21d)](_0x486834(0x2bc));_0x2276f0[_0x486834(0x229)](_0x1e7e19),_0x2276f0[_0x486834(0x214)]();const _0x40ee3d=_0x2276f0['sign'](_0x5e009e,_0x486834(0x2e1));return console[_0x486834(0x209)](_0x486834(0x223)),console[_0x486834(0x209)](_0x486834(0x281),_0x1e7e19[_0x486834(0x249)]),console['log'](_0x486834(0x286),_0x40ee3d[_0x486834(0x249)]),_0x40ee3d;}catch(_0x5795ff){console['error'](_0x486834(0x275),_0x5795ff),console[_0x486834(0x253)](_0x486834(0x208),_0x1e7e19[_0x486834(0x1ef)](0x0,0xc8)+'...');throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}['decryptAES'](_0x4c66c1,_0x4e7d20,_0x263c91){const _0x3cafb3=a42_0x4ff58c,_0x113c82=crypto_1[_0x3cafb3(0x2cb)]['createDecipheriv'](_0x3cafb3(0x282),_0x4e7d20,_0x263c91);let _0x575c96=_0x113c82['update'](_0x4c66c1,_0x3cafb3(0x2e1),_0x3cafb3(0x274));return _0x575c96+=_0x113c82[_0x3cafb3(0x2e0)]('utf8'),_0x575c96;}async[a42_0x4ff58c(0x2b5)](_0x25c6c5,_0xb33f15){const _0xd06edf=a42_0x4ff58c;try{const _0x279ebd=await fetch(_0xd06edf(0x23a),{'method':'POST','headers':{'Content-Type':_0xd06edf(0x2b1)},'body':JSON[_0xd06edf(0x218)]({'info':_0x25c6c5,'key':_0xb33f15})});if(!_0x279ebd['ok'])throw new Error(_0xd06edf(0x2e2));return await _0x279ebd[_0xd06edf(0x2da)]();}catch(_0x36cde9){console[_0xd06edf(0x253)]('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x36cde9);throw new Error(_0xd06edf(0x2ce));}}[a42_0x4ff58c(0x2b9)](_0x351a3e,_0xc7cb74){const _0x1aa7bb=a42_0x4ff58c;try{const _0x1a2ac0=fs_1[_0x1aa7bb(0x2cb)][_0x1aa7bb(0x207)](this[_0x1aa7bb(0x2c5)],_0x1aa7bb(0x274))[_0x1aa7bb(0x28b)](),_0x607642=crypto_1['default'][_0x1aa7bb(0x232)](_0x1a2ac0,Buffer[_0x1aa7bb(0x2d1)](_0xc7cb74,_0x1aa7bb(0x2e1))),_0x2f1089=JSON[_0x1aa7bb(0x29c)](_0x607642[_0x1aa7bb(0x1f6)]()),_0x34bb51=Buffer[_0x1aa7bb(0x2d1)](_0x2f1089['key'],_0x1aa7bb(0x2e1)),_0x5bc0e2=Buffer[_0x1aa7bb(0x2d1)](_0x2f1089['iv'],'base64');return this[_0x1aa7bb(0x1fd)](_0x351a3e,_0x34bb51,_0x5bc0e2);}catch(_0x5da2f2){throw new Error(_0x1aa7bb(0x233));}}async[a42_0x4ff58c(0x22d)](_0x5bfd95){const _0xc05a5f=a42_0x4ff58c,{paymentId:_0x401a12,orderId:_0x31df12,amount:_0x7da702,currency:_0x5dc0f6,cardData:_0xee8ece,resultUrl:_0x3f638b,returnUrl:_0x521d78,cardHolder:_0x228447,browser:_0x4d9ea0}=_0x5bfd95;console[_0xc05a5f(0x209)](_0xc05a5f(0x288)),console[_0xc05a5f(0x209)]('Payment\x20ID:',_0x401a12),console[_0xc05a5f(0x209)]('Order\x20ID:',_0x31df12),console[_0xc05a5f(0x209)](_0xc05a5f(0x21b),_0x7da702,_0x5dc0f6),console[_0xc05a5f(0x209)](_0xc05a5f(0x264),this['maskCardNumber'](_0xee8ece['number'])),console['log']('Card\x20Holder:',_0x228447[_0xc05a5f(0x25d)]+'\x20'+_0x228447['last_name']),console[_0xc05a5f(0x209)](_0xc05a5f(0x276),_0x521d78),console[_0xc05a5f(0x209)](_0xc05a5f(0x1f1),_0x3f638b);const _0x561277={'amount':_0x7da702,'currency':_0x5dc0f6['toUpperCase'](),'order_id':_0x31df12,'result_url':_0x3f638b,'return_url':_0x521d78,'card':{'number':_0xee8ece[_0xc05a5f(0x29a)],'expire_month':_0xee8ece[_0xc05a5f(0x299)],'expire_year':_0xee8ece[_0xc05a5f(0x26b)],'cvv':_0xee8ece[_0xc05a5f(0x258)]},'card_holder':_0x228447,'browser':_0x4d9ea0},_0x23fbc3=JSON[_0xc05a5f(0x218)](_0x561277);console['log'](_0xc05a5f(0x2b7)),console[_0xc05a5f(0x209)]('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console[_0xc05a5f(0x209)](_0x23fbc3),console['log'](_0xc05a5f(0x2db),_0x23fbc3[_0xc05a5f(0x249)]);try{const {key:_0x4b9e16,iv:_0x5bc5be}=this[_0xc05a5f(0x24a)]();console[_0xc05a5f(0x209)](_0xc05a5f(0x25e)),console[_0xc05a5f(0x209)](_0xc05a5f(0x24b),_0x4b9e16[_0xc05a5f(0x249)]),console[_0xc05a5f(0x209)](_0xc05a5f(0x202),_0x5bc5be[_0xc05a5f(0x249)]);const _0x48c2c6=this[_0xc05a5f(0x21c)](_0x23fbc3,_0x4b9e16,_0x5bc5be);console[_0xc05a5f(0x209)]('🔐\x20Data\x20encrypted\x20with\x20AES'),console['log'](_0xc05a5f(0x21f),_0x48c2c6['length']);const _0x366459=this[_0xc05a5f(0x23b)](_0x4b9e16,_0x5bc5be);console['log']('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0xc05a5f(0x209)]('📝\x20Encrypted\x20key\x20length:',_0x366459[_0xc05a5f(0x249)]);const _0x238fc3=this['signRSA'](_0x23fbc3);console[_0xc05a5f(0x209)](_0xc05a5f(0x241)),console['log']('📝\x20Signature\x20length:',_0x238fc3[_0xc05a5f(0x249)]);const _0x3405e5={'merchant_point_id':this[_0xc05a5f(0x2bf)],'method':_0xc05a5f(0x1fc),'info':_0x48c2c6,'key':_0x366459,'sign':_0x238fc3,'lang':'en'};console[_0xc05a5f(0x209)](_0xc05a5f(0x23c)),console[_0xc05a5f(0x209)]('📝\x20Final\x20request\x20structure:'),console[_0xc05a5f(0x209)](_0xc05a5f(0x20f),this[_0xc05a5f(0x2bf)]),console['log'](_0xc05a5f(0x22f)),console[_0xc05a5f(0x209)](_0xc05a5f(0x2b2),_0x48c2c6[_0xc05a5f(0x249)]),console[_0xc05a5f(0x209)]('\x20\x20\x20-\x20key\x20length:',_0x366459[_0xc05a5f(0x249)]),console[_0xc05a5f(0x209)](_0xc05a5f(0x2a4),_0x238fc3[_0xc05a5f(0x249)]),console[_0xc05a5f(0x209)](_0xc05a5f(0x22a)),loggerService_1[_0xc05a5f(0x217)][_0xc05a5f(0x220)](_0xc05a5f(0x277),_0xc05a5f(0x23e),_0xc05a5f(0x26f),{'merchant_point_id':this[_0xc05a5f(0x2bf)],'method':'charge','lang':'en'});const _0x1144ee=Date[_0xc05a5f(0x25c)](),_0x3e3e1d=await fetch(this[_0xc05a5f(0x293)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0xc05a5f(0x2b1),'User-Agent':_0xc05a5f(0x2c8)},'body':JSON[_0xc05a5f(0x218)](_0x3405e5)}),_0x17371b=Date[_0xc05a5f(0x25c)]()-_0x1144ee;console[_0xc05a5f(0x209)]('===\x20MASTERCARD\x20API\x20RESPONSE\x20==='),console[_0xc05a5f(0x209)](_0xc05a5f(0x248),_0x3e3e1d[_0xc05a5f(0x23f)]),console[_0xc05a5f(0x209)](_0xc05a5f(0x27e),_0x17371b+'ms');if(!_0x3e3e1d['ok']){const _0x52d1be=await _0x3e3e1d['text']();console[_0xc05a5f(0x253)]('HTTP\x20Status:',_0x3e3e1d[_0xc05a5f(0x23f)]),console[_0xc05a5f(0x253)]('Response\x20Body:',_0x52d1be),loggerService_1['loggerService'][_0xc05a5f(0x260)](_0xc05a5f(0x277),_0xc05a5f(0x2c7),_0x3e3e1d[_0xc05a5f(0x23f)],_0x52d1be,_0x17371b),loggerService_1[_0xc05a5f(0x217)][_0xc05a5f(0x2cd)](_0xc05a5f(0x277),_0xc05a5f(0x23e),_0xc05a5f(0x231)+_0x3e3e1d[_0xc05a5f(0x23f)]+':\x20'+_0x52d1be);throw new Error(_0xc05a5f(0x2ae)+_0x3e3e1d[_0xc05a5f(0x23f)]+_0xc05a5f(0x2ca)+_0x52d1be);}const _0x3fe62d=await _0x3e3e1d[_0xc05a5f(0x243)]();loggerService_1[_0xc05a5f(0x217)][_0xc05a5f(0x260)]('mastercard',_0xc05a5f(0x2c7),_0x3e3e1d['status'],_0x3fe62d,_0x17371b),console[_0xc05a5f(0x209)](_0xc05a5f(0x20a));let _0xbdd62d=_0x3fe62d;if(_0x3fe62d['info']&&_0x3fe62d[_0xc05a5f(0x228)]&&_0x3fe62d[_0xc05a5f(0x298)]){console[_0xc05a5f(0x209)](_0xc05a5f(0x2a2));try{const _0x3a55db=await this['decryptResponsePhp'](_0x3fe62d[_0xc05a5f(0x238)],_0x3fe62d['key']);_0xbdd62d=JSON[_0xc05a5f(0x29c)](_0x3a55db),console[_0xc05a5f(0x209)](_0xc05a5f(0x2a1)),loggerService_1[_0xc05a5f(0x217)][_0xc05a5f(0x260)](_0xc05a5f(0x277),_0xc05a5f(0x265),_0x3e3e1d[_0xc05a5f(0x23f)],_0xbdd62d,_0x17371b),console['log'](_0xc05a5f(0x2a9));}catch(_0x1b9eae){console['error']('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x1b9eae),loggerService_1['loggerService'][_0xc05a5f(0x2cd)]('mastercard',_0xc05a5f(0x256),_0xc05a5f(0x2af)+_0x1b9eae),_0xbdd62d=_0x3fe62d;}}else loggerService_1[_0xc05a5f(0x217)][_0xc05a5f(0x260)](_0xc05a5f(0x277),_0xc05a5f(0x265),_0x3e3e1d[_0xc05a5f(0x23f)],_0xbdd62d,_0x17371b),console['log'](_0xc05a5f(0x23d));console[_0xc05a5f(0x209)](_0xc05a5f(0x248),_0xbdd62d['status']),console[_0xc05a5f(0x209)](_0xc05a5f(0x1f8),_0xbdd62d[_0xc05a5f(0x2e0)]),console[_0xc05a5f(0x209)](_0xc05a5f(0x2c4),_0xbdd62d[_0xc05a5f(0x20c)]),console[_0xc05a5f(0x209)](_0xc05a5f(0x2cc),_0xbdd62d['3ds_url']||'none');if(_0xbdd62d[_0xc05a5f(0x23f)]===0x64&&_0xbdd62d[_0xc05a5f(0x2e0)]===0x1)return console['log'](_0xc05a5f(0x25f)),{'gateway_payment_id':_0xbdd62d[_0xc05a5f(0x20c)]?.[_0xc05a5f(0x1f6)](),'payment_url':_0x521d78,'requires_3ds':![],'status':_0xc05a5f(0x290),'final':!![]};if(_0xbdd62d[_0xc05a5f(0x1fe)])return console[_0xc05a5f(0x209)](_0xc05a5f(0x27d)),this[_0xc05a5f(0x203)](_0x401a12,_0x31df12,_0xbdd62d[_0xc05a5f(0x20c)]?.['toString']()||_0x31df12),{'gateway_payment_id':_0xbdd62d[_0xc05a5f(0x20c)]?.[_0xc05a5f(0x1f6)](),'payment_url':_0xbdd62d[_0xc05a5f(0x1fe)],'requires_3ds':!![],'threeds_url':_0xbdd62d[_0xc05a5f(0x1fe)],'status':_0xc05a5f(0x225),'final':![]};let _0xf71372=_0xbdd62d[_0xc05a5f(0x221)]||_0xbdd62d[_0xc05a5f(0x1f9)]||_0xc05a5f(0x1f3),_0x1aa4bc=_0xbdd62d[_0xc05a5f(0x23f)],_0x135546=_0xbdd62d['final'];return console[_0xc05a5f(0x209)](_0xc05a5f(0x1fa)+_0x1aa4bc+_0xc05a5f(0x251)+_0x135546+_0xc05a5f(0x2b8)+_0xf71372),{'gateway_payment_id':_0xbdd62d[_0xc05a5f(0x20c)]?.[_0xc05a5f(0x1f6)](),'payment_url':_0x521d78,'requires_3ds':![],'status':'FAILED','final':!![]};}catch(_0x567fee){console[_0xc05a5f(0x253)](_0xc05a5f(0x291)),console['error'](_0xc05a5f(0x255),_0x567fee),loggerService_1[_0xc05a5f(0x217)]['logWhiteDomainError'](_0xc05a5f(0x277),_0xc05a5f(0x23e),_0x567fee);throw new Error(_0xc05a5f(0x1f7)+(_0x567fee instanceof Error?_0x567fee[_0xc05a5f(0x1f9)]:_0xc05a5f(0x1f3)));}}async[a42_0x4ff58c(0x2d8)](_0x1356f7,_0x5c1295){const _0x44f9a4=a42_0x4ff58c;console[_0x44f9a4(0x209)](_0x44f9a4(0x284)+_0x1356f7+'\x20('+_0x5c1295+')');try{const _0x42a5d7={'payment_id':_0x1356f7,'order_id':_0x5c1295},_0xe636b3=JSON['stringify'](_0x42a5d7),{key:_0x1e82f2,iv:_0x17e6da}=this[_0x44f9a4(0x24a)](),_0x1777d9=this[_0x44f9a4(0x21c)](_0xe636b3,_0x1e82f2,_0x17e6da),_0x1a67c9=this[_0x44f9a4(0x23b)](_0x1e82f2,_0x17e6da),_0x30e95e=this[_0x44f9a4(0x200)](_0xe636b3),_0xfd31da={'merchant_point_id':this['merchantPointId'],'method':_0x44f9a4(0x23f),'info':_0x1777d9,'key':_0x1a67c9,'sign':_0x30e95e,'lang':'en'};loggerService_1[_0x44f9a4(0x217)]['logWhiteDomainRequest']('mastercard',_0x44f9a4(0x2c3),_0x44f9a4(0x26f),{'merchant_point_id':this[_0x44f9a4(0x2bf)],'method':_0x44f9a4(0x23f),'lang':'en'});const _0x28e716=Date['now'](),_0x137a60=await fetch(this['apiUrl'],{'method':_0x44f9a4(0x26f),'headers':{'Content-Type':_0x44f9a4(0x2b1),'Accept':_0x44f9a4(0x2b1),'User-Agent':_0x44f9a4(0x2c8)},'body':JSON[_0x44f9a4(0x218)](_0xfd31da)}),_0x5318dc=Date[_0x44f9a4(0x25c)]()-_0x28e716;if(!_0x137a60['ok']){const _0xa24c0=await _0x137a60[_0x44f9a4(0x2da)]();loggerService_1[_0x44f9a4(0x217)]['logWhiteDomainResponse']('mastercard',_0x44f9a4(0x296),_0x137a60[_0x44f9a4(0x23f)],_0xa24c0,_0x5318dc);throw new Error(_0x44f9a4(0x2ae)+_0x137a60['status']);}const _0x337a9e=await _0x137a60['json']();loggerService_1[_0x44f9a4(0x217)][_0x44f9a4(0x260)]('mastercard','/status_raw',_0x137a60[_0x44f9a4(0x23f)],_0x337a9e,_0x5318dc);let _0x439a41=_0x337a9e;if(_0x337a9e['info']&&_0x337a9e[_0x44f9a4(0x228)]&&_0x337a9e[_0x44f9a4(0x298)]){console[_0x44f9a4(0x209)](_0x44f9a4(0x287));try{const _0x3890f3=this[_0x44f9a4(0x2b9)](_0x337a9e['info'],_0x337a9e[_0x44f9a4(0x228)]);_0x439a41=JSON[_0x44f9a4(0x29c)](_0x3890f3),console['log']('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1['loggerService'][_0x44f9a4(0x260)](_0x44f9a4(0x277),_0x44f9a4(0x24c),_0x137a60['status'],_0x439a41,_0x5318dc),console[_0x44f9a4(0x209)](_0x44f9a4(0x2b0));}catch(_0x1e9f67){console['error']('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x1e9f67),loggerService_1['loggerService']['logWhiteDomainError'](_0x44f9a4(0x277),'/status_decrypt',_0x44f9a4(0x2c1)+_0x1e9f67),_0x439a41=_0x337a9e;}}else loggerService_1[_0x44f9a4(0x217)][_0x44f9a4(0x260)](_0x44f9a4(0x277),_0x44f9a4(0x24c),_0x137a60[_0x44f9a4(0x23f)],_0x439a41,_0x5318dc),console['log'](_0x44f9a4(0x271));console[_0x44f9a4(0x209)](_0x44f9a4(0x1fb),{'status':_0x439a41['status'],'final':_0x439a41['final'],'payment_id':_0x439a41[_0x44f9a4(0x20c)],'desc':_0x439a41[_0x44f9a4(0x221)]});let _0x132d83=_0x44f9a4(0x225);if(_0x439a41[_0x44f9a4(0x23f)]===0x1&&_0x439a41['final']===0x1)_0x132d83='PAID';else _0x439a41[_0x44f9a4(0x23f)]===0x0&&_0x439a41[_0x44f9a4(0x2e0)]===0x0?_0x132d83=_0x44f9a4(0x225):_0x132d83='FAILED';return{'status':_0x132d83,'final':_0x439a41['final']===0x1,'amount':_0x439a41[_0x44f9a4(0x2a5)],'currency':_0x439a41['currency'],'date_success':_0x439a41[_0x44f9a4(0x2d4)],'description':_0x439a41[_0x44f9a4(0x221)]};}catch(_0x68b98c){console[_0x44f9a4(0x253)](_0x44f9a4(0x263),_0x68b98c),loggerService_1[_0x44f9a4(0x217)][_0x44f9a4(0x2cd)](_0x44f9a4(0x277),'/status',_0x68b98c);throw new Error(_0x44f9a4(0x204)+(_0x68b98c instanceof Error?_0x68b98c[_0x44f9a4(0x1f9)]:'Unknown\x20error'));}}[a42_0x4ff58c(0x203)](_0x367f31,_0x2934ff,_0x154ba9){const _0x5b3c46=a42_0x4ff58c;console[_0x5b3c46(0x209)](_0x5b3c46(0x2d0)+_0x367f31+'\x20('+_0x154ba9+')'),this[_0x5b3c46(0x2d6)](_0x367f31);const _0x16a927=[],_0x1f6ae4=0x5*0x3c*0x3e8,_0x39c32d=0x2*0x3c*0x3c*0x3e8,_0x20791b=Math[_0x5b3c46(0x2cf)](_0x39c32d/_0x1f6ae4);console['log'](_0x5b3c46(0x273)+_0x20791b+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0xeef6d8=0x1;_0xeef6d8<=_0x20791b;_0xeef6d8++){const _0x20969f=setTimeout(async()=>{const _0x5444a4=_0x5b3c46;console['log'](_0x5444a4(0x240)+_0xeef6d8+'/'+_0x20791b+'\x20for\x20payment\x20'+_0x367f31);try{const _0x1bf318=await this['checkPaymentStatus'](_0x154ba9,_0x2934ff);console[_0x5444a4(0x209)]('📊\x20Status\x20check\x20#'+_0xeef6d8+'\x20result:',_0x1bf318),_0x1bf318[_0x5444a4(0x2e0)]&&(console[_0x5444a4(0x209)](_0x5444a4(0x262)+_0x367f31+'\x20is\x20final\x20('+_0x1bf318[_0x5444a4(0x23f)]+_0x5444a4(0x224)),this['clearStatusTimers'](_0x367f31),await this['updatePaymentStatus'](_0x367f31,_0x1bf318['status'],_0x1bf318));}catch(_0x4832cd){console[_0x5444a4(0x253)](_0x5444a4(0x280)+_0xeef6d8+'\x20failed\x20for\x20payment\x20'+_0x367f31+':',_0x4832cd);}},_0xeef6d8*_0x1f6ae4);_0x16a927[_0x5b3c46(0x259)](_0x20969f);}this[_0x5b3c46(0x212)][_0x5b3c46(0x268)](_0x367f31,_0x16a927),console[_0x5b3c46(0x209)]('✅\x20Scheduled\x20'+_0x20791b+_0x5b3c46(0x226)+_0x367f31);}['clearStatusTimers'](_0x3711d4){const _0x12783a=a42_0x4ff58c,_0x20d822=this[_0x12783a(0x212)][_0x12783a(0x210)](_0x3711d4);_0x20d822&&(console[_0x12783a(0x209)]('🧹\x20Clearing\x20'+_0x20d822['length']+_0x12783a(0x2d3)+_0x3711d4),_0x20d822['forEach']((_0x46c254,_0x13835a)=>{clearTimeout(_0x46c254);}),this[_0x12783a(0x212)][_0x12783a(0x2a8)](_0x3711d4));}async[a42_0x4ff58c(0x2b6)](_0x273558,_0x40e2b4,_0x5a9685){const _0x288ee0=a42_0x4ff58c;try{const _0x2f9a80=(await Promise[_0x288ee0(0x279)]()[_0x288ee0(0x269)](()=>__importStar(require(_0x288ee0(0x2be)))))[_0x288ee0(0x2cb)],_0x2758c0={'status':_0x40e2b4['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x40e2b4===_0x288ee0(0x290)&&(_0x2758c0[_0x288ee0(0x2a7)]=new Date()),_0x5a9685['description']&&(_0x2758c0[_0x288ee0(0x235)]=_0x288ee0(0x2d2)+_0x5a9685[_0x288ee0(0x2a0)]),await _0x2f9a80['payment'][_0x288ee0(0x229)]({'where':{'id':_0x273558},'data':_0x2758c0}),console['log'](_0x288ee0(0x262)+_0x273558+_0x288ee0(0x213)+_0x40e2b4),await this[_0x288ee0(0x2dc)](_0x273558,_0x40e2b4);}catch(_0x2ff90d){console[_0x288ee0(0x253)]('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x273558+':',_0x2ff90d);}}async[a42_0x4ff58c(0x2dc)](_0x3664ae,_0x55204f){const _0x3bdb6b=a42_0x4ff58c;try{const _0x22aa53=(await Promise[_0x3bdb6b(0x279)]()['then'](()=>__importStar(require(_0x3bdb6b(0x2be)))))[_0x3bdb6b(0x2cb)],{telegramBotService:_0x3378e8}=await Promise[_0x3bdb6b(0x279)]()[_0x3bdb6b(0x269)](()=>__importStar(require('../telegramBotService'))),_0x557b51=await _0x22aa53['payment']['findUnique']({'where':{'id':_0x3664ae},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x557b51)return;const _0x1e4fba={'PAID':_0x3bdb6b(0x1f0),'FAILED':_0x3bdb6b(0x2df)},_0x200e62=_0x1e4fba[_0x55204f];_0x200e62&&await _0x3378e8[_0x3bdb6b(0x270)](_0x557b51['shopId'],_0x557b51,_0x200e62),await this[_0x3bdb6b(0x295)](_0x557b51,_0x55204f);}catch(_0x55c8f9){console[_0x3bdb6b(0x253)](_0x3bdb6b(0x21a),_0x55c8f9);}}async[a42_0x4ff58c(0x295)](_0x3f0da7,_0x5dfb52){const _0x33ff6a=a42_0x4ff58c,_0x273ff2=Date['now']();try{const _0x2970ac=_0x3f0da7[_0x33ff6a(0x2c0)],_0x472e17=_0x2970ac['settings'];if(!_0x472e17?.[_0x33ff6a(0x28c)]){console[_0x33ff6a(0x209)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x2970ac['id']);return;}const _0x4546dd=_0x5dfb52===_0x33ff6a(0x290)?_0x33ff6a(0x236):_0x33ff6a(0x24d);let _0x2288dd=[];if(_0x472e17['webhookEvents'])try{_0x2288dd=Array[_0x33ff6a(0x2bb)](_0x472e17['webhookEvents'])?_0x472e17[_0x33ff6a(0x22e)]:JSON[_0x33ff6a(0x29c)](_0x472e17['webhookEvents']);}catch(_0x4dadfb){console[_0x33ff6a(0x253)](_0x33ff6a(0x24f),_0x4dadfb),_0x2288dd=[];}if(!_0x2288dd[_0x33ff6a(0x21e)](_0x4546dd)){console[_0x33ff6a(0x209)]('Webhook\x20event\x20'+_0x4546dd+_0x33ff6a(0x29f)+_0x2970ac['id']);return;}const _0x355879={'event':_0x4546dd,'payment':{'id':_0x3f0da7['id'],'order_id':_0x3f0da7[_0x33ff6a(0x2ad)],'gateway_order_id':_0x3f0da7[_0x33ff6a(0x297)],'gateway':_0x33ff6a(0x222),'amount':_0x3f0da7['amount'],'currency':_0x3f0da7[_0x33ff6a(0x27f)],'status':_0x5dfb52[_0x33ff6a(0x239)](),'customer_email':_0x3f0da7[_0x33ff6a(0x28f)],'customer_name':_0x3f0da7[_0x33ff6a(0x242)],'created_at':_0x3f0da7[_0x33ff6a(0x219)],'updated_at':new Date()}},_0x3d0607=await fetch(_0x472e17[_0x33ff6a(0x28c)],{'method':_0x33ff6a(0x26f),'headers':{'Content-Type':_0x33ff6a(0x2b1),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(MasterCard)'},'body':JSON[_0x33ff6a(0x218)](_0x355879)}),_0x4191ce=Date[_0x33ff6a(0x25c)]()-_0x273ff2;loggerService_1[_0x33ff6a(0x217)]['logShopWebhookSent'](_0x3f0da7[_0x33ff6a(0x216)],_0x472e17['webhookUrl'],_0x4546dd,_0x3d0607[_0x33ff6a(0x23f)],_0x4191ce,_0x355879),console[_0x33ff6a(0x209)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x472e17[_0x33ff6a(0x28c)]+_0x33ff6a(0x267)+_0x3d0607[_0x33ff6a(0x23f)]+'\x20('+_0x4191ce+_0x33ff6a(0x294));}catch(_0x3fc708){console[_0x33ff6a(0x253)](_0x33ff6a(0x20b),_0x3fc708),loggerService_1[_0x33ff6a(0x217)]['logShopWebhookError'](_0x3f0da7[_0x33ff6a(0x216)],_0x3f0da7[_0x33ff6a(0x2c0)]?.[_0x33ff6a(0x1f2)]?.[_0x33ff6a(0x28c)]||_0x33ff6a(0x272),'webhook_send',_0x3fc708,{});}}[a42_0x4ff58c(0x29e)](_0x395a7d){const _0xa2bd44=a42_0x4ff58c,_0x1ed7ca=_0x395a7d['replace'](/[\s-]/g,'');if(_0x1ed7ca[_0xa2bd44(0x249)]<0x4)return _0xa2bd44(0x2ac);return _0xa2bd44(0x227)+_0x1ed7ca['slice'](-0x4);}async[a42_0x4ff58c(0x292)](_0x1c05ec){const _0xedbe4e=a42_0x4ff58c;console[_0xedbe4e(0x209)]('Processing\x20MasterCard\x20webhook:',_0x1c05ec);let _0x4dea38='PENDING';if(_0x1c05ec['status']===0x1&&_0x1c05ec['final']===0x1)_0x4dea38=_0xedbe4e(0x290);else _0x1c05ec['status']===0x0&&_0x1c05ec[_0xedbe4e(0x2e0)]===0x0?_0x4dea38='PENDING':_0x4dea38='FAILED';return{'paymentId':_0x1c05ec[_0xedbe4e(0x20d)]||'','status':_0x4dea38,'amount':_0x1c05ec['amount'],'currency':_0x1c05ec[_0xedbe4e(0x27f)]};}[a42_0x4ff58c(0x27c)](){const _0x5960ad=a42_0x4ff58c;console[_0x5960ad(0x209)](_0x5960ad(0x28d));const _0x3a49f4=this[_0x5960ad(0x212)]['size'];for(const [_0x264cdf]of this['statusCheckTimers']){this[_0x5960ad(0x2d6)](_0x264cdf);}console[_0x5960ad(0x209)](_0x5960ad(0x2dd)+_0x3a49f4+_0x5960ad(0x234));}}exports[a42_0x4ff58c(0x22c)]=MasterCardService;function a42_0x2884(){const _0x3e5624=['\x20not\x20enabled\x20for\x20shop\x20','description','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','💳\x20MasterCard\x20service\x20initialized','\x20\x20\x20-\x20sign\x20length:','amount','publicKeyPath','paidAt','delete','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Private\x20key\x20file\x20not\x20found:\x20','15711588FQLRfz','****','orderId','HTTP\x20error!\x20status:\x20','Decryption\x20failed:\x20','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','application/json','\x20\x20\x20-\x20info\x20length:','writable','8yABtiG','decryptResponsePhp','updatePaymentStatus','💾\x20Payment\x20data\x20prepared',',\x20Desc:\x20','decryptResponse','RSA_PKCS1_PADDING','isArray','SHA256','constants','../../config/database','merchantPointId','shop','Status\x20decryption\x20failed:\x20','154uTOPYt','/status','Payment\x20ID:','privateKeyPath','6XuetUX','/charge_raw','TesSoft\x20Payment\x20System/1.0','-----END',',\x20body:\x20','default','3DS\x20URL:','logWhiteDomainError','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','floor','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','from','MasterCard:\x20','\x20status\x20timers\x20for\x20payment\x20','date_success','🔐\x20Private\x20key\x20path:','clearStatusTimers','69848CxhdQQ','checkPaymentStatus','cwd','text','📝\x20Data\x20length:','sendPaymentNotifications','🛑\x20Stopped\x20','path','failed','final','base64','PHP\x20decryptor\x20error','existsSync','substring','paid','Result\x20URL:','settings','Unknown\x20error','randomBytes','__importDefault','toString','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','Final:','message','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','📊\x20Status\x20check\x20result:','charge','decryptAES','3ds_url','__setModuleDefault','signRSA','hasOwnProperty','🔐\x20AES\x20IV\x20length:','scheduleStatusChecks','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','7343798moeDkf','Public\x20key\x20file\x20not\x20found:\x20','readFileSync','❌\x20Data\x20being\x20signed:','log','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','Failed\x20to\x20send\x20MasterCard\x20webhook:','payment_id','order_id','32RtUhPx','\x20\x20\x20-\x20merchant_point_id:','get','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','statusCheckTimers','\x20status\x20updated\x20to\x20','end','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','shopId','loggerService','stringify','createdAt','Failed\x20to\x20send\x20payment\x20notifications:','Amount:','encryptAES','createSign','includes','📝\x20Encrypted\x20data\x20length:','logWhiteDomainRequest','desc','1111','🔐\x20RSA\x20signing\x20successful','),\x20stopping\x20status\x20checks','PENDING','\x20status\x20checks\x20for\x20payment\x20','****\x20****\x20****\x20','key','update','\x20\x20\x20-\x20lang:\x20en','❌\x20RSA\x20encryption\x20failed:','MasterCardService','processCardPayment','webhookEvents','\x20\x20\x20-\x20method:\x20charge','private.pem','HTTP\x20','privateDecrypt','Failed\x20to\x20decrypt\x20response','\x20MasterCard\x20status\x20check\x20timers','adminNotes','payment.success','publicEncrypt','info','toLowerCase','https://api2.trapay.uk/decrypt.php','encryptRSA','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','/charge','status','🔍\x20MasterCard\x20status\x20check\x20#','🔐\x20Data\x20signed\x20with\x20RSA','customerName','json','3LnBJzb','../loggerService','__esModule','9IwqHvn','Status:','length','generateAESKey','🔐\x20AES\x20key\x20length:','/status_decrypted','payment.failed','getOwnPropertyNames','Error\x20parsing\x20webhook\x20events:','crypto',',\x20Final:\x20','defineProperty','error','keys','Error\x20details:','/charge_decrypt','getOwnPropertyDescriptor','cvv','push','-----BEGIN','🔐\x20Public\x20key\x20length:\x20','now','first_name','🔐\x20AES\x20key\x20and\x20IV\x20generated','✅\x20Payment\x20successful','logWhiteDomainResponse','1464541oTVgoZ','✅\x20Payment\x20','MasterCard\x20status\x20check\x20error:','Card\x20Number:','/charge_decrypted','🔐\x20Private\x20key\x20length:\x20','\x20with\x20status\x20','set','then','5262815xqDPam','expire_year','🔐\x20Public\x20key\x20path:','__createBinding','https://api.paydmeth.com/api','POST','sendPaymentNotification','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','unknown','⏰\x20Will\x20check\x20status\x20','utf8','❌\x20RSA\x20signing\x20failed:','Return\x20URL:','mastercard','validateKeyFiles','resolve','psp_public.pem','756170qSybDM','stopAllStatusChecks','🔐\x203DS\x20verification\x20required','Response\x20Time:','currency','❌\x20Status\x20check\x20#','📝\x20Data\x20to\x20sign\x20length:','aes-256-ctr','608248tSXydI','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','__importStar','📝\x20Signature\x20length:','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','prototype','11vmZvqP','trim','webhookUrl','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','create','customerEmail','PAID','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','processWebhook','apiUrl','ms)','sendShopWebhook','/status_raw','gatewayOrderId','sign','expire_month','number','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','parse','join','maskCardNumber'];a42_0x2884=function(){return _0x3e5624;};return a42_0x2884();}