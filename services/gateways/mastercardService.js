'use strict';const a42_0x57f4ac=a42_0x4dfd;(function(_0x383267,_0x462cde){const _0x4492fc=a42_0x4dfd,_0x85d8a2=_0x383267();while(!![]){try{const _0x265e78=-parseInt(_0x4492fc(0x197))/0x1*(parseInt(_0x4492fc(0x127))/0x2)+parseInt(_0x4492fc(0x18c))/0x3*(-parseInt(_0x4492fc(0xe8))/0x4)+-parseInt(_0x4492fc(0x166))/0x5*(parseInt(_0x4492fc(0xf8))/0x6)+parseInt(_0x4492fc(0x117))/0x7*(-parseInt(_0x4492fc(0xd1))/0x8)+-parseInt(_0x4492fc(0x18a))/0x9*(parseInt(_0x4492fc(0x1bf))/0xa)+parseInt(_0x4492fc(0x153))/0xb+parseInt(_0x4492fc(0x135))/0xc;if(_0x265e78===_0x462cde)break;else _0x85d8a2['push'](_0x85d8a2['shift']());}catch(_0x1dc3d){_0x85d8a2['push'](_0x85d8a2['shift']());}}}(a42_0x1918,0x70c35));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0xd69000,_0x124ea4,_0x12f435,_0x5132ba){const _0xbf610d=a42_0x4dfd;if(_0x5132ba===undefined)_0x5132ba=_0x12f435;var _0x51a81f=Object[_0xbf610d(0x170)](_0x124ea4,_0x12f435);(!_0x51a81f||(_0xbf610d(0x1aa)in _0x51a81f?!_0x124ea4['__esModule']:_0x51a81f[_0xbf610d(0x129)]||_0x51a81f[_0xbf610d(0x15e)]))&&(_0x51a81f={'enumerable':!![],'get':function(){return _0x124ea4[_0x12f435];}}),Object[_0xbf610d(0x174)](_0xd69000,_0x5132ba,_0x51a81f);}:function(_0xd7572c,_0x171598,_0x1b7ca9,_0x597de6){if(_0x597de6===undefined)_0x597de6=_0x1b7ca9;_0xd7572c[_0x597de6]=_0x171598[_0x1b7ca9];}),__setModuleDefault=this&&this[a42_0x57f4ac(0x114)]||(Object[a42_0x57f4ac(0x112)]?function(_0x53b04c,_0x15c359){const _0xfe4834=a42_0x57f4ac;Object['defineProperty'](_0x53b04c,_0xfe4834(0xe7),{'enumerable':!![],'value':_0x15c359});}:function(_0x391203,_0x508bbd){_0x391203['default']=_0x508bbd;}),__importStar=this&&this['__importStar']||(function(){var _0x1777dd=function(_0x292fb3){const _0x555199=a42_0x4dfd;return _0x1777dd=Object[_0x555199(0x18d)]||function(_0x370572){const _0x2c8e13=_0x555199;var _0x59632a=[];for(var _0xe8439f in _0x370572)if(Object[_0x2c8e13(0xcd)][_0x2c8e13(0x123)]['call'](_0x370572,_0xe8439f))_0x59632a[_0x59632a[_0x2c8e13(0x131)]]=_0xe8439f;return _0x59632a;},_0x1777dd(_0x292fb3);};return function(_0x198f31){const _0x31dc1d=a42_0x4dfd;if(_0x198f31&&_0x198f31['__esModule'])return _0x198f31;var _0x17c3fd={};if(_0x198f31!=null){for(var _0x3800a6=_0x1777dd(_0x198f31),_0x19df36=0x0;_0x19df36<_0x3800a6[_0x31dc1d(0x131)];_0x19df36++)if(_0x3800a6[_0x19df36]!==_0x31dc1d(0xe7))__createBinding(_0x17c3fd,_0x198f31,_0x3800a6[_0x19df36]);}return __setModuleDefault(_0x17c3fd,_0x198f31),_0x17c3fd;};}()),__importDefault=this&&this[a42_0x57f4ac(0x136)]||function(_0x292316){return _0x292316&&_0x292316['__esModule']?_0x292316:{'default':_0x292316};};function a42_0x1918(){const _0xa73a57=['🔐\x20AES\x20IV\x20length:','error','Public\x20key\x20file\x20not\x20found:\x20','replace','orderId','Processing\x20MasterCard\x20webhook:','🔐\x20Private\x20key\x20length:\x20','❌\x20RSA\x20encryption\x20failed:','log','decryptResponsePhp','Failed\x20to\x20send\x20MasterCard\x20webhook:','🔐\x20Public\x20key\x20length:\x20','\x20result:','1111','unknown','https://api2.trapay.uk/decrypt.php','webhook_send','📊\x20Status\x20check\x20#','PHP\x20decryptor\x20error','6779806AYiszS','PAID','MasterCard:\x20','info','ms)','3DS\x20URL:','stringify','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','Failed\x20to\x20decrypt\x20response','/status','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','configurable','validateKeyFiles','apiUrl','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','../telegramBotService','📝\x20Signature\x20length:','https://api.paydmeth.com/api','application/json','606285ajWwjQ','webhookEvents','slice','scheduleStatusChecks','📝\x20Data\x20length:','statusCheckTimers','text','Status:','\x20status\x20checks\x20for\x20payment\x20','🔐\x20Private\x20key\x20path:','getOwnPropertyDescriptor','then','🧹\x20Clearing\x20','push','defineProperty','publicEncrypt','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','base64','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','../../config/database','trim','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','processWebhook','\x20for\x20payment\x20','toLowerCase','payment.failed','✅\x20Payment\x20','toString','mastercard','💳\x20MasterCard\x20service\x20initialized','constants','payment','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','📊\x20Status\x20check\x20result:','findUnique','9Sbkdbp','MasterCard\x20status\x20check\x20error:','68721bKMZWs','getOwnPropertyNames','\x20\x20\x20-\x20merchant_point_id:','randomBytes','🔐\x20AES\x20key\x20and\x20IV\x20generated','-----BEGIN','-----END','💾\x20Payment\x20data\x20prepared','...','Card\x20Number:','paidAt','7zZJcgN','/charge','encryptRSA','join','gatewayOrderId','sendPaymentNotification','encryptAES','readFileSync','🔐\x20Public\x20key\x20path:','order_id','FAILED','adminNotes','/status_raw','\x20status\x20timers\x20for\x20payment\x20','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','logShopWebhookError','aes-256-ctr','number','✅\x20Scheduled\x20','get','checkPaymentStatus','cwd','privateDecrypt','Return\x20URL:','\x20MasterCard\x20status\x20check\x20timers','date_success','logWhiteDomainError','PENDING','\x20\x20\x20-\x20method:\x20charge','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','🔐\x203DS\x20verification\x20required','sendShopWebhook','generateAESKey','privateKeyPath','../loggerService','MasterCardService','psp_public.pem','❌\x20Status\x20check\x20#','json','HTTP\x20','3802700zuIGVz','Final:','TesSoft\x20Payment\x20System/1.0','keys','includes','payment.success','🔐\x20Data\x20signed\x20with\x20RSA','❌\x20Data\x20being\x20signed:','createDecipheriv','🛑\x20Stopped\x20','expire_year','Response\x20Time:','message','shopId','prototype','maskCardNumber','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','path','241576SkELEg','logShopWebhookSent','HTTP\x20Status:','Order\x20ID:','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','size','\x20\x20\x20-\x20key\x20length:','sign','\x20status\x20updated\x20to\x20','amount','logWhiteDomainRequest','last_name','isArray','processCardPayment','status','payment_id','🔐\x20AES\x20key\x20length:','description','🔐\x20RSA\x20signing\x20successful',',\x20Final:\x20','desc','decryptAES','default','148OkUPZe','existsSync','__esModule','signRSA','SHA256','webhookUrl','loggerService','Status\x20decryption\x20failed:\x20','end','merchantPointId','parse','/charge_raw','RSA_PKCS1_PADDING','clearStatusTimers','toUpperCase','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','30qHbcUZ','from','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','📝\x20Data\x20to\x20sign\x20length:','🔐\x20Data\x20encrypted\x20with\x20AES','delete','📝\x20Encrypted\x20key\x20length:',',\x20body:\x20','resolve','floor','/charge_decrypt','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','sendPaymentNotifications','forEach','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Unknown\x20error','/status_decrypt','currency','first_name','shop','3ds_url','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','/status_decrypted','final','Response\x20Body:','decryptResponse','create','settings','__setModuleDefault','Result\x20URL:','Amount:','7KGBzuX','❌\x20PHP\x20decryptor\x20request\x20failed:','createdAt','❌\x20MasterCard\x20key\x20validation\x20failed:','⏰\x20Will\x20check\x20status\x20','key','),\x20stopping\x20status\x20checks','updatePaymentStatus','\x20with\x20status\x20','utf8','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','Payment\x20ID:','hasOwnProperty','Error\x20details:','customerName','publicKeyPath','18056ZmMzvl','Failed\x20to\x20send\x20payment\x20notifications:','writable','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','POST','\x20\x20\x20-\x20info\x20length:','createSign','logWhiteDomainResponse','private.pem','HTTP\x20error!\x20status:\x20','length','MasterCard\x20webhook\x20sent\x20to\x20','now','/charge_decrypted','21276456smHCuy','__importDefault','charge','substring','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','system','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','📝\x20Encrypted\x20data\x20length:','stopAllStatusChecks','update'];a42_0x1918=function(){return _0xa73a57;};return a42_0x1918();}Object[a42_0x57f4ac(0x174)](exports,a42_0x57f4ac(0xea),{'value':!![]}),exports[a42_0x57f4ac(0x1ba)]=void 0x0;function a42_0x4dfd(_0x4b2a46,_0x1db27d){const _0x191865=a42_0x1918();return a42_0x4dfd=function(_0x4dfdc6,_0x140fd6){_0x4dfdc6=_0x4dfdc6-0xc6;let _0x341911=_0x191865[_0x4dfdc6];return _0x341911;},a42_0x4dfd(_0x4b2a46,_0x1db27d);}const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x57f4ac(0xd0))),loggerService_1=require(a42_0x57f4ac(0x1b9));class MasterCardService{constructor(){const _0x439c34=a42_0x57f4ac;this[_0x439c34(0x16b)]=new Map(),this['apiUrl']=_0x439c34(0x164),this[_0x439c34(0xf1)]=0x67c,this[_0x439c34(0x1b8)]=path_1[_0x439c34(0xe7)][_0x439c34(0x19a)](process['cwd'](),_0x439c34(0x1c2),_0x439c34(0x12f)),this['publicKeyPath']=path_1[_0x439c34(0xe7)][_0x439c34(0x19a)](process[_0x439c34(0x1ac)](),_0x439c34(0x1c2),_0x439c34(0x1bb)),console['log'](_0x439c34(0x184)),console[_0x439c34(0x148)](_0x439c34(0x16f),this['privateKeyPath']),console[_0x439c34(0x148)](_0x439c34(0x19f),this[_0x439c34(0x126)]),this[_0x439c34(0x15f)]();}[a42_0x57f4ac(0x15f)](){const _0x50130d=a42_0x57f4ac;try{if(!fs_1[_0x50130d(0xe7)]['existsSync'](this[_0x50130d(0x1b8)]))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this[_0x50130d(0x1b8)]);if(!fs_1['default'][_0x50130d(0xe9)](this[_0x50130d(0x126)]))throw new Error(_0x50130d(0x142)+this['publicKeyPath']);const _0x3d0e91=fs_1['default']['readFileSync'](this[_0x50130d(0x1b8)],_0x50130d(0x120))[_0x50130d(0x17b)](),_0x1045ab=fs_1[_0x50130d(0xe7)][_0x50130d(0x19e)](this[_0x50130d(0x126)],_0x50130d(0x120))['trim']();if(!_0x3d0e91[_0x50130d(0x1c3)](_0x50130d(0x191))||!_0x3d0e91[_0x50130d(0x1c3)](_0x50130d(0x192)))throw new Error(_0x50130d(0x17c));if(!_0x1045ab[_0x50130d(0x1c3)](_0x50130d(0x191))||!_0x1045ab[_0x50130d(0x1c3)](_0x50130d(0x192)))throw new Error(_0x50130d(0x161));console[_0x50130d(0x148)](_0x50130d(0x187)),console[_0x50130d(0x148)](_0x50130d(0x146)+_0x3d0e91[_0x50130d(0x131)]+'\x20characters'),console[_0x50130d(0x148)](_0x50130d(0x14b)+_0x1045ab[_0x50130d(0x131)]+'\x20characters');}catch(_0x154dab){console[_0x50130d(0x141)](_0x50130d(0x11a),_0x154dab);throw _0x154dab;}}[a42_0x57f4ac(0x1b7)](){const _0x20991f=a42_0x57f4ac,_0x2bbde2=crypto_1[_0x20991f(0xe7)][_0x20991f(0x18f)](0x20),_0x187a5e=crypto_1[_0x20991f(0xe7)][_0x20991f(0x18f)](0x10);return{'key':_0x2bbde2,'iv':_0x187a5e};}[a42_0x57f4ac(0x19d)](_0x490198,_0x44a3c2,_0x5c2eef){const _0x205666=a42_0x57f4ac,_0x598b6c=crypto_1[_0x205666(0xe7)]['createCipheriv'](_0x205666(0x1a7),_0x44a3c2,_0x5c2eef);let _0x35a5df=_0x598b6c[_0x205666(0x13f)](_0x490198,_0x205666(0x120),_0x205666(0x177));return _0x35a5df+=_0x598b6c[_0x205666(0x10f)](_0x205666(0x177)),_0x35a5df;}[a42_0x57f4ac(0x199)](_0x7f17e5,_0x577a47){const _0x3d6809=a42_0x57f4ac;try{const _0x27734b=fs_1['default'][_0x3d6809(0x19e)](this[_0x3d6809(0x126)],_0x3d6809(0x120))[_0x3d6809(0x17b)](),_0x3172ee={'iv':_0x577a47[_0x3d6809(0x182)]('base64'),'key':_0x7f17e5[_0x3d6809(0x182)](_0x3d6809(0x177))},_0x2d29dc=JSON['stringify'](_0x3172ee);console[_0x3d6809(0x148)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x2d29dc[_0x3d6809(0x131)]);const _0x55f468=crypto_1[_0x3d6809(0xe7)][_0x3d6809(0x175)]({'key':_0x27734b,'padding':crypto_1['default'][_0x3d6809(0x185)][_0x3d6809(0xf4)]},Buffer[_0x3d6809(0xf9)](_0x2d29dc));return console[_0x3d6809(0x148)](_0x3d6809(0x13a),_0x55f468[_0x3d6809(0x131)]),_0x55f468['toString'](_0x3d6809(0x177));}catch(_0x4f8cfa){console[_0x3d6809(0x141)](_0x3d6809(0x147),_0x4f8cfa);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a42_0x57f4ac(0xeb)](_0x5c8ea9){const _0xfdaf53=a42_0x57f4ac;try{const _0x4dd339=fs_1[_0xfdaf53(0xe7)][_0xfdaf53(0x19e)](this[_0xfdaf53(0x1b8)],_0xfdaf53(0x120))[_0xfdaf53(0x17b)](),_0x180c27=crypto_1[_0xfdaf53(0xe7)][_0xfdaf53(0x12d)](_0xfdaf53(0xec));_0x180c27[_0xfdaf53(0x13f)](_0x5c8ea9),_0x180c27[_0xfdaf53(0xf0)]();const _0x2a4968=_0x180c27[_0xfdaf53(0xd8)](_0x4dd339,_0xfdaf53(0x177));return console['log'](_0xfdaf53(0xe3)),console[_0xfdaf53(0x148)](_0xfdaf53(0xfb),_0x5c8ea9['length']),console[_0xfdaf53(0x148)](_0xfdaf53(0x163),_0x2a4968[_0xfdaf53(0x131)]),_0x2a4968;}catch(_0x32f93d){console[_0xfdaf53(0x141)]('❌\x20RSA\x20signing\x20failed:',_0x32f93d),console[_0xfdaf53(0x141)](_0xfdaf53(0xc6),_0x5c8ea9[_0xfdaf53(0x138)](0x0,0xc8)+_0xfdaf53(0x194));throw new Error(_0xfdaf53(0x179));}}['decryptAES'](_0x15057e,_0x30551f,_0x545c10){const _0x416219=a42_0x57f4ac,_0x586490=crypto_1['default'][_0x416219(0xc7)](_0x416219(0x1a7),_0x30551f,_0x545c10);let _0x32e7b1=_0x586490[_0x416219(0x13f)](_0x15057e,_0x416219(0x177),_0x416219(0x120));return _0x32e7b1+=_0x586490[_0x416219(0x10f)](_0x416219(0x120)),_0x32e7b1;}async[a42_0x57f4ac(0x149)](_0x108116,_0x57b4d3){const _0x2fd9b4=a42_0x57f4ac;try{const _0x3a666f=await fetch(_0x2fd9b4(0x14f),{'method':_0x2fd9b4(0x12b),'headers':{'Content-Type':'application/json'},'body':JSON[_0x2fd9b4(0x159)]({'info':_0x108116,'key':_0x57b4d3})});if(!_0x3a666f['ok'])throw new Error(_0x2fd9b4(0x152));return await _0x3a666f['text']();}catch(_0xf57252){console[_0x2fd9b4(0x141)](_0x2fd9b4(0x118),_0xf57252);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}['decryptResponse'](_0x4d7f2e,_0x40211c){const _0x17e951=a42_0x57f4ac;try{const _0x319cec=fs_1[_0x17e951(0xe7)]['readFileSync'](this['privateKeyPath'],_0x17e951(0x120))[_0x17e951(0x17b)](),_0x19af7d=crypto_1['default'][_0x17e951(0x1ad)](_0x319cec,Buffer[_0x17e951(0xf9)](_0x40211c,_0x17e951(0x177))),_0x1bd9f8=JSON[_0x17e951(0xf2)](_0x19af7d[_0x17e951(0x182)]()),_0x591ce4=Buffer[_0x17e951(0xf9)](_0x1bd9f8[_0x17e951(0x11c)],'base64'),_0x50023a=Buffer[_0x17e951(0xf9)](_0x1bd9f8['iv'],_0x17e951(0x177));return this[_0x17e951(0xe6)](_0x4d7f2e,_0x591ce4,_0x50023a);}catch(_0x548eef){throw new Error(_0x17e951(0x15b));}}async[a42_0x57f4ac(0xde)](_0x2f339b){const _0xfcdef7=a42_0x57f4ac,{paymentId:_0x23e5aa,orderId:_0x9306da,amount:_0x29aa3d,currency:_0x5d4f15,cardData:_0x1b1777,resultUrl:_0x56fe4e,returnUrl:_0x1a57ff,cardHolder:_0x1ec3c5,browser:_0x47316e}=_0x2f339b;console['log'](_0xfcdef7(0x10d)),console['log'](_0xfcdef7(0x122),_0x23e5aa),console['log'](_0xfcdef7(0xd4),_0x9306da),console[_0xfcdef7(0x148)](_0xfcdef7(0x116),_0x29aa3d,_0x5d4f15),console['log'](_0xfcdef7(0x195),this['maskCardNumber'](_0x1b1777[_0xfcdef7(0x1a8)])),console[_0xfcdef7(0x148)]('Card\x20Holder:',_0x1ec3c5[_0xfcdef7(0x10a)]+'\x20'+_0x1ec3c5[_0xfcdef7(0xdc)]),console[_0xfcdef7(0x148)](_0xfcdef7(0x1ae),_0x1a57ff),console[_0xfcdef7(0x148)](_0xfcdef7(0x115),_0x56fe4e);const _0x4a0be4={'amount':_0x29aa3d,'currency':_0x5d4f15[_0xfcdef7(0xf6)](),'order_id':_0x9306da,'result_url':_0x56fe4e,'return_url':_0x1a57ff,'card':{'number':_0x1b1777['number'],'expire_month':_0x1b1777['expire_month'],'expire_year':_0x1b1777[_0xfcdef7(0xc9)],'cvv':_0x1b1777['cvv']},'card_holder':_0x1ec3c5,'browser':_0x47316e},_0x25043a=JSON[_0xfcdef7(0x159)](_0x4a0be4);console[_0xfcdef7(0x148)](_0xfcdef7(0x193)),console[_0xfcdef7(0x148)]('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console['log'](_0x25043a),console[_0xfcdef7(0x148)](_0xfcdef7(0x16a),_0x25043a['length']);try{const {key:_0x11f35f,iv:_0x3ccd4a}=this[_0xfcdef7(0x1b7)]();console[_0xfcdef7(0x148)](_0xfcdef7(0x190)),console[_0xfcdef7(0x148)](_0xfcdef7(0xe1),_0x11f35f[_0xfcdef7(0x131)]),console[_0xfcdef7(0x148)](_0xfcdef7(0x140),_0x3ccd4a[_0xfcdef7(0x131)]);const _0x2cfc55=this[_0xfcdef7(0x19d)](_0x25043a,_0x11f35f,_0x3ccd4a);console[_0xfcdef7(0x148)](_0xfcdef7(0xfc)),console[_0xfcdef7(0x148)](_0xfcdef7(0x13d),_0x2cfc55[_0xfcdef7(0x131)]);const _0x48ecaf=this[_0xfcdef7(0x199)](_0x11f35f,_0x3ccd4a);console[_0xfcdef7(0x148)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0xfcdef7(0x148)](_0xfcdef7(0xfe),_0x48ecaf[_0xfcdef7(0x131)]);const _0x2a4b51=this['signRSA'](_0x25043a);console['log'](_0xfcdef7(0x1c5)),console[_0xfcdef7(0x148)](_0xfcdef7(0x163),_0x2a4b51[_0xfcdef7(0x131)]);const _0x56d58e={'merchant_point_id':this[_0xfcdef7(0xf1)],'method':'charge','info':_0x2cfc55,'key':_0x48ecaf,'sign':_0x2a4b51,'lang':'en'};console[_0xfcdef7(0x148)]('📤\x20Sending\x20request\x20to\x20MasterCard\x20API...'),console[_0xfcdef7(0x148)]('📝\x20Final\x20request\x20structure:'),console[_0xfcdef7(0x148)](_0xfcdef7(0x18e),this[_0xfcdef7(0xf1)]),console[_0xfcdef7(0x148)](_0xfcdef7(0x1b3)),console[_0xfcdef7(0x148)](_0xfcdef7(0x12c),_0x2cfc55['length']),console['log'](_0xfcdef7(0xd7),_0x48ecaf[_0xfcdef7(0x131)]),console[_0xfcdef7(0x148)]('\x20\x20\x20-\x20sign\x20length:',_0x2a4b51[_0xfcdef7(0x131)]),console[_0xfcdef7(0x148)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0xfcdef7(0xee)][_0xfcdef7(0xdb)](_0xfcdef7(0x183),_0xfcdef7(0x198),_0xfcdef7(0x12b),{'merchant_point_id':this['merchantPointId'],'method':_0xfcdef7(0x137),'lang':'en'});const _0x238246=Date[_0xfcdef7(0x133)](),_0x2de146=await fetch(this[_0xfcdef7(0x160)],{'method':_0xfcdef7(0x12b),'headers':{'Content-Type':_0xfcdef7(0x165),'Accept':_0xfcdef7(0x165),'User-Agent':_0xfcdef7(0x1c1)},'body':JSON[_0xfcdef7(0x159)](_0x56d58e)}),_0x29b10b=Date[_0xfcdef7(0x133)]()-_0x238246;console[_0xfcdef7(0x148)](_0xfcdef7(0x178)),console[_0xfcdef7(0x148)]('Status:',_0x2de146['status']),console[_0xfcdef7(0x148)](_0xfcdef7(0xca),_0x29b10b+'ms');if(!_0x2de146['ok']){const _0xc0bc61=await _0x2de146[_0xfcdef7(0x16c)]();console[_0xfcdef7(0x141)](_0xfcdef7(0xd3),_0x2de146[_0xfcdef7(0xdf)]),console[_0xfcdef7(0x141)](_0xfcdef7(0x110),_0xc0bc61),loggerService_1[_0xfcdef7(0xee)]['logWhiteDomainResponse'](_0xfcdef7(0x183),_0xfcdef7(0xf3),_0x2de146[_0xfcdef7(0xdf)],_0xc0bc61,_0x29b10b),loggerService_1[_0xfcdef7(0xee)][_0xfcdef7(0x1b1)](_0xfcdef7(0x183),_0xfcdef7(0x198),_0xfcdef7(0x1be)+_0x2de146[_0xfcdef7(0xdf)]+':\x20'+_0xc0bc61);throw new Error(_0xfcdef7(0x130)+_0x2de146[_0xfcdef7(0xdf)]+_0xfcdef7(0xff)+_0xc0bc61);}const _0x17a394=await _0x2de146['json']();loggerService_1['loggerService'][_0xfcdef7(0x12e)](_0xfcdef7(0x183),_0xfcdef7(0xf3),_0x2de146[_0xfcdef7(0xdf)],_0x17a394,_0x29b10b),console[_0xfcdef7(0x148)](_0xfcdef7(0xf7));let _0x467eb8=_0x17a394;if(_0x17a394[_0xfcdef7(0x156)]&&_0x17a394['key']&&_0x17a394[_0xfcdef7(0xd8)]){console['log'](_0xfcdef7(0x139));try{const _0x249d91=await this[_0xfcdef7(0x149)](_0x17a394['info'],_0x17a394[_0xfcdef7(0x11c)]);_0x467eb8=JSON['parse'](_0x249d91),console[_0xfcdef7(0x148)]('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0xfcdef7(0xee)][_0xfcdef7(0x12e)](_0xfcdef7(0x183),_0xfcdef7(0x134),_0x2de146[_0xfcdef7(0xdf)],_0x467eb8,_0x29b10b),console[_0xfcdef7(0x148)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x171930){console['error'](_0xfcdef7(0x103),_0x171930),loggerService_1['loggerService']['logWhiteDomainError'](_0xfcdef7(0x183),_0xfcdef7(0x102),'Decryption\x20failed:\x20'+_0x171930),_0x467eb8=_0x17a394;}}else loggerService_1[_0xfcdef7(0xee)][_0xfcdef7(0x12e)](_0xfcdef7(0x183),_0xfcdef7(0x134),_0x2de146[_0xfcdef7(0xdf)],_0x467eb8,_0x29b10b),console['log'](_0xfcdef7(0x106));console[_0xfcdef7(0x148)](_0xfcdef7(0x16d),_0x467eb8['status']),console[_0xfcdef7(0x148)](_0xfcdef7(0x1c0),_0x467eb8['final']),console[_0xfcdef7(0x148)]('Payment\x20ID:',_0x467eb8[_0xfcdef7(0xe0)]),console[_0xfcdef7(0x148)](_0xfcdef7(0x158),_0x467eb8['3ds_url']||'none');if(_0x467eb8[_0xfcdef7(0xdf)]===0x64&&_0x467eb8[_0xfcdef7(0x10f)]===0x1)return console[_0xfcdef7(0x148)]('✅\x20Payment\x20successful'),{'gateway_payment_id':_0x467eb8[_0xfcdef7(0xe0)]?.[_0xfcdef7(0x182)](),'payment_url':_0x1a57ff,'requires_3ds':![],'status':_0xfcdef7(0x154),'final':!![]};if(_0x467eb8['3ds_url'])return console[_0xfcdef7(0x148)](_0xfcdef7(0x1b5)),this['scheduleStatusChecks'](_0x23e5aa,_0x9306da,_0x467eb8[_0xfcdef7(0xe0)]?.[_0xfcdef7(0x182)]()||_0x9306da),{'gateway_payment_id':_0x467eb8['payment_id']?.['toString'](),'payment_url':_0x467eb8[_0xfcdef7(0x10c)],'requires_3ds':!![],'threeds_url':_0x467eb8[_0xfcdef7(0x10c)],'status':'PENDING','final':![]};let _0x4ea437=_0x467eb8[_0xfcdef7(0xe5)]||_0x467eb8['message']||_0xfcdef7(0x107),_0x6b2932=_0x467eb8[_0xfcdef7(0xdf)],_0x56144c=_0x467eb8[_0xfcdef7(0x10f)];return console[_0xfcdef7(0x148)](_0xfcdef7(0xd5)+_0x6b2932+_0xfcdef7(0xe4)+_0x56144c+',\x20Desc:\x20'+_0x4ea437),{'gateway_payment_id':_0x467eb8[_0xfcdef7(0xe0)]?.['toString'](),'payment_url':_0x1a57ff,'requires_3ds':![],'status':'FAILED','final':!![]};}catch(_0x4b72ac){console[_0xfcdef7(0x141)](_0xfcdef7(0xcf)),console[_0xfcdef7(0x141)](_0xfcdef7(0x124),_0x4b72ac),loggerService_1[_0xfcdef7(0xee)]['logWhiteDomainError'](_0xfcdef7(0x183),_0xfcdef7(0x198),_0x4b72ac);throw new Error(_0xfcdef7(0x15a)+(_0x4b72ac instanceof Error?_0x4b72ac[_0xfcdef7(0xcb)]:'Unknown\x20error'));}}async[a42_0x57f4ac(0x1ab)](_0x1c1873,_0x1896a3){const _0x3f5af7=a42_0x57f4ac;console[_0x3f5af7(0x148)](_0x3f5af7(0x13c)+_0x1c1873+'\x20('+_0x1896a3+')');try{const _0x3595ba={'payment_id':_0x1c1873,'order_id':_0x1896a3},_0x444aa8=JSON[_0x3f5af7(0x159)](_0x3595ba),{key:_0x3e7910,iv:_0x1a9d3f}=this[_0x3f5af7(0x1b7)](),_0x2baa7d=this[_0x3f5af7(0x19d)](_0x444aa8,_0x3e7910,_0x1a9d3f),_0x513ce3=this[_0x3f5af7(0x199)](_0x3e7910,_0x1a9d3f),_0x2f87a2=this[_0x3f5af7(0xeb)](_0x444aa8),_0x548543={'merchant_point_id':this[_0x3f5af7(0xf1)],'method':'status','info':_0x2baa7d,'key':_0x513ce3,'sign':_0x2f87a2,'lang':'en'};loggerService_1[_0x3f5af7(0xee)]['logWhiteDomainRequest'](_0x3f5af7(0x183),_0x3f5af7(0x15c),_0x3f5af7(0x12b),{'merchant_point_id':this['merchantPointId'],'method':'status','lang':'en'});const _0x2af6d2=Date[_0x3f5af7(0x133)](),_0x173eeb=await fetch(this['apiUrl'],{'method':_0x3f5af7(0x12b),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x3f5af7(0x1c1)},'body':JSON[_0x3f5af7(0x159)](_0x548543)}),_0x44d8de=Date['now']()-_0x2af6d2;if(!_0x173eeb['ok']){const _0x585086=await _0x173eeb['text']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3f5af7(0x183),_0x3f5af7(0x1a3),_0x173eeb['status'],_0x585086,_0x44d8de);throw new Error(_0x3f5af7(0x130)+_0x173eeb[_0x3f5af7(0xdf)]);}const _0xc4c512=await _0x173eeb[_0x3f5af7(0x1bd)]();loggerService_1['loggerService'][_0x3f5af7(0x12e)](_0x3f5af7(0x183),_0x3f5af7(0x1a3),_0x173eeb[_0x3f5af7(0xdf)],_0xc4c512,_0x44d8de);let _0x59b8d=_0xc4c512;if(_0xc4c512[_0x3f5af7(0x156)]&&_0xc4c512[_0x3f5af7(0x11c)]&&_0xc4c512[_0x3f5af7(0xd8)]){console[_0x3f5af7(0x148)](_0x3f5af7(0x15d));try{const _0x152cfd=this[_0x3f5af7(0x111)](_0xc4c512['info'],_0xc4c512[_0x3f5af7(0x11c)]);_0x59b8d=JSON[_0x3f5af7(0xf2)](_0x152cfd),console['log']('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3f5af7(0x183),_0x3f5af7(0x10e),_0x173eeb[_0x3f5af7(0xdf)],_0x59b8d,_0x44d8de),console[_0x3f5af7(0x148)](_0x3f5af7(0x12a));}catch(_0x513f6b){console[_0x3f5af7(0x141)](_0x3f5af7(0x1a5),_0x513f6b),loggerService_1[_0x3f5af7(0xee)]['logWhiteDomainError']('mastercard',_0x3f5af7(0x108),_0x3f5af7(0xef)+_0x513f6b),_0x59b8d=_0xc4c512;}}else loggerService_1[_0x3f5af7(0xee)][_0x3f5af7(0x12e)](_0x3f5af7(0x183),_0x3f5af7(0x10e),_0x173eeb[_0x3f5af7(0xdf)],_0x59b8d,_0x44d8de),console[_0x3f5af7(0x148)](_0x3f5af7(0x176));console[_0x3f5af7(0x148)](_0x3f5af7(0x188),{'status':_0x59b8d['status'],'final':_0x59b8d[_0x3f5af7(0x10f)],'payment_id':_0x59b8d['payment_id'],'desc':_0x59b8d['desc']});let _0x3b9e1d='PENDING';if(_0x59b8d[_0x3f5af7(0xdf)]===0x1&&_0x59b8d[_0x3f5af7(0x10f)]===0x1)_0x3b9e1d=_0x3f5af7(0x154);else _0x59b8d[_0x3f5af7(0xdf)]===0x0&&_0x59b8d[_0x3f5af7(0x10f)]===0x0?_0x3b9e1d='PENDING':_0x3b9e1d=_0x3f5af7(0x1a1);return{'status':_0x3b9e1d,'final':_0x59b8d['final']===0x1,'amount':_0x59b8d[_0x3f5af7(0xda)],'currency':_0x59b8d['currency'],'date_success':_0x59b8d[_0x3f5af7(0x1b0)],'description':_0x59b8d[_0x3f5af7(0xe5)]};}catch(_0x34abc6){console[_0x3f5af7(0x141)](_0x3f5af7(0x18b),_0x34abc6),loggerService_1[_0x3f5af7(0xee)]['logWhiteDomainError'](_0x3f5af7(0x183),_0x3f5af7(0x15c),_0x34abc6);throw new Error(_0x3f5af7(0x121)+(_0x34abc6 instanceof Error?_0x34abc6['message']:_0x3f5af7(0x107)));}}[a42_0x57f4ac(0x169)](_0x30817f,_0x1bf65f,_0x2f221a){const _0x387efb=a42_0x57f4ac;console[_0x387efb(0x148)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0x30817f+'\x20('+_0x2f221a+')'),this['clearStatusTimers'](_0x30817f);const _0x49d1d9=[],_0x52ab04=0x5*0x3c*0x3e8,_0x36a0a6=0x2*0x3c*0x3c*0x3e8,_0x1aef32=Math[_0x387efb(0x101)](_0x36a0a6/_0x52ab04);console[_0x387efb(0x148)](_0x387efb(0x11b)+_0x1aef32+_0x387efb(0xfa));for(let _0x43780c=0x1;_0x43780c<=_0x1aef32;_0x43780c++){const _0x1956cb=setTimeout(async()=>{const _0x491ac5=_0x387efb;console[_0x491ac5(0x148)]('🔍\x20MasterCard\x20status\x20check\x20#'+_0x43780c+'/'+_0x1aef32+_0x491ac5(0x17e)+_0x30817f);try{const _0x3ce534=await this[_0x491ac5(0x1ab)](_0x2f221a,_0x1bf65f);console[_0x491ac5(0x148)](_0x491ac5(0x151)+_0x43780c+_0x491ac5(0x14c),_0x3ce534),_0x3ce534[_0x491ac5(0x10f)]&&(console['log'](_0x491ac5(0x181)+_0x30817f+'\x20is\x20final\x20('+_0x3ce534[_0x491ac5(0xdf)]+_0x491ac5(0x11d)),this['clearStatusTimers'](_0x30817f),await this[_0x491ac5(0x11e)](_0x30817f,_0x3ce534[_0x491ac5(0xdf)],_0x3ce534));}catch(_0x21a813){console['error'](_0x491ac5(0x1bc)+_0x43780c+'\x20failed\x20for\x20payment\x20'+_0x30817f+':',_0x21a813);}},_0x43780c*_0x52ab04);_0x49d1d9[_0x387efb(0x173)](_0x1956cb);}this['statusCheckTimers']['set'](_0x30817f,_0x49d1d9),console['log'](_0x387efb(0x1a9)+_0x1aef32+_0x387efb(0x16e)+_0x30817f);}[a42_0x57f4ac(0xf5)](_0x48afba){const _0x2b87e6=a42_0x57f4ac,_0x3328a2=this[_0x2b87e6(0x16b)][_0x2b87e6(0x1aa)](_0x48afba);_0x3328a2&&(console[_0x2b87e6(0x148)](_0x2b87e6(0x172)+_0x3328a2[_0x2b87e6(0x131)]+_0x2b87e6(0x1a4)+_0x48afba),_0x3328a2[_0x2b87e6(0x105)]((_0x50ed0e,_0x32eab3)=>{clearTimeout(_0x50ed0e);}),this['statusCheckTimers'][_0x2b87e6(0xfd)](_0x48afba));}async['updatePaymentStatus'](_0x2aaf18,_0x163a58,_0x555165){const _0x4130c8=a42_0x57f4ac;try{const _0x4b77c4=(await Promise['resolve']()[_0x4130c8(0x171)](()=>__importStar(require(_0x4130c8(0x17a)))))[_0x4130c8(0xe7)],_0x14c422={'status':_0x163a58[_0x4130c8(0xf6)](),'updatedAt':new Date(),'statusChangedBy':_0x4130c8(0x13b),'statusChangedAt':new Date()};_0x163a58==='PAID'&&(_0x14c422[_0x4130c8(0x196)]=new Date()),_0x555165[_0x4130c8(0xe2)]&&(_0x14c422[_0x4130c8(0x1a2)]=_0x4130c8(0x155)+_0x555165['description']),await _0x4b77c4[_0x4130c8(0x186)]['update']({'where':{'id':_0x2aaf18},'data':_0x14c422}),console[_0x4130c8(0x148)]('✅\x20Payment\x20'+_0x2aaf18+_0x4130c8(0xd9)+_0x163a58),await this[_0x4130c8(0x104)](_0x2aaf18,_0x163a58);}catch(_0x2d732b){console[_0x4130c8(0x141)]('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x2aaf18+':',_0x2d732b);}}async[a42_0x57f4ac(0x104)](_0x37342b,_0x1b2fa5){const _0xea68aa=a42_0x57f4ac;try{const _0x516dc9=(await Promise[_0xea68aa(0x100)]()[_0xea68aa(0x171)](()=>__importStar(require(_0xea68aa(0x17a)))))[_0xea68aa(0xe7)],{telegramBotService:_0x1c554d}=await Promise['resolve']()[_0xea68aa(0x171)](()=>__importStar(require(_0xea68aa(0x162)))),_0x460919=await _0x516dc9['payment'][_0xea68aa(0x189)]({'where':{'id':_0x37342b},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x460919)return;const _0xc1abbe={'PAID':'paid','FAILED':'failed'},_0x3c227b=_0xc1abbe[_0x1b2fa5];_0x3c227b&&await _0x1c554d[_0xea68aa(0x19c)](_0x460919[_0xea68aa(0xcc)],_0x460919,_0x3c227b),await this[_0xea68aa(0x1b6)](_0x460919,_0x1b2fa5);}catch(_0x835a42){console['error'](_0xea68aa(0x128),_0x835a42);}}async[a42_0x57f4ac(0x1b6)](_0x3d7fd4,_0x4da5e1){const _0x4398b1=a42_0x57f4ac,_0x453298=Date[_0x4398b1(0x133)]();try{const _0xca62ac=_0x3d7fd4[_0x4398b1(0x10b)],_0x2b6ae1=_0xca62ac[_0x4398b1(0x113)];if(!_0x2b6ae1?.[_0x4398b1(0xed)]){console[_0x4398b1(0x148)](_0x4398b1(0x1b4)+_0xca62ac['id']);return;}const _0x41f2cb=_0x4da5e1===_0x4398b1(0x154)?_0x4398b1(0x1c4):_0x4398b1(0x180);let _0x645831=[];if(_0x2b6ae1['webhookEvents'])try{_0x645831=Array[_0x4398b1(0xdd)](_0x2b6ae1[_0x4398b1(0x167)])?_0x2b6ae1[_0x4398b1(0x167)]:JSON[_0x4398b1(0xf2)](_0x2b6ae1['webhookEvents']);}catch(_0x11601d){console[_0x4398b1(0x141)]('Error\x20parsing\x20webhook\x20events:',_0x11601d),_0x645831=[];}if(!_0x645831['includes'](_0x41f2cb)){console[_0x4398b1(0x148)]('Webhook\x20event\x20'+_0x41f2cb+'\x20not\x20enabled\x20for\x20shop\x20'+_0xca62ac['id']);return;}const _0x2ff153={'event':_0x41f2cb,'payment':{'id':_0x3d7fd4['id'],'order_id':_0x3d7fd4[_0x4398b1(0x144)],'gateway_order_id':_0x3d7fd4[_0x4398b1(0x19b)],'gateway':_0x4398b1(0x14d),'amount':_0x3d7fd4[_0x4398b1(0xda)],'currency':_0x3d7fd4[_0x4398b1(0x109)],'status':_0x4da5e1[_0x4398b1(0x17f)](),'customer_email':_0x3d7fd4['customerEmail'],'customer_name':_0x3d7fd4[_0x4398b1(0x125)],'created_at':_0x3d7fd4[_0x4398b1(0x119)],'updated_at':new Date()}},_0x28b11f=await fetch(_0x2b6ae1[_0x4398b1(0xed)],{'method':_0x4398b1(0x12b),'headers':{'Content-Type':_0x4398b1(0x165),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(MasterCard)'},'body':JSON[_0x4398b1(0x159)](_0x2ff153)}),_0xa15e7b=Date['now']()-_0x453298;loggerService_1[_0x4398b1(0xee)][_0x4398b1(0xd2)](_0x3d7fd4[_0x4398b1(0xcc)],_0x2b6ae1[_0x4398b1(0xed)],_0x41f2cb,_0x28b11f['status'],_0xa15e7b,_0x2ff153),console[_0x4398b1(0x148)](_0x4398b1(0x132)+_0x2b6ae1['webhookUrl']+_0x4398b1(0x11f)+_0x28b11f[_0x4398b1(0xdf)]+'\x20('+_0xa15e7b+_0x4398b1(0x157));}catch(_0x10539c){console[_0x4398b1(0x141)](_0x4398b1(0x14a),_0x10539c),loggerService_1[_0x4398b1(0xee)][_0x4398b1(0x1a6)](_0x3d7fd4[_0x4398b1(0xcc)],_0x3d7fd4[_0x4398b1(0x10b)]?.[_0x4398b1(0x113)]?.[_0x4398b1(0xed)]||_0x4398b1(0x14e),_0x4398b1(0x150),_0x10539c,{});}}[a42_0x57f4ac(0xce)](_0xb7a448){const _0x25a6ed=a42_0x57f4ac,_0x5ede97=_0xb7a448[_0x25a6ed(0x143)](/[\s-]/g,'');if(_0x5ede97[_0x25a6ed(0x131)]<0x4)return'****';return'****\x20****\x20****\x20'+_0x5ede97[_0x25a6ed(0x168)](-0x4);}async[a42_0x57f4ac(0x17d)](_0x35f020){const _0x1e08ee=a42_0x57f4ac;console[_0x1e08ee(0x148)](_0x1e08ee(0x145),_0x35f020);let _0x466632=_0x1e08ee(0x1b2);if(_0x35f020[_0x1e08ee(0xdf)]===0x1&&_0x35f020[_0x1e08ee(0x10f)]===0x1)_0x466632=_0x1e08ee(0x154);else _0x35f020[_0x1e08ee(0xdf)]===0x0&&_0x35f020[_0x1e08ee(0x10f)]===0x0?_0x466632=_0x1e08ee(0x1b2):_0x466632=_0x1e08ee(0x1a1);return{'paymentId':_0x35f020[_0x1e08ee(0x1a0)]||'','status':_0x466632,'amount':_0x35f020[_0x1e08ee(0xda)],'currency':_0x35f020[_0x1e08ee(0x109)]};}[a42_0x57f4ac(0x13e)](){const _0x3e4591=a42_0x57f4ac;console[_0x3e4591(0x148)]('🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...');const _0x3a6593=this[_0x3e4591(0x16b)][_0x3e4591(0xd6)];for(const [_0x57311d]of this['statusCheckTimers']){this[_0x3e4591(0xf5)](_0x57311d);}console[_0x3e4591(0x148)](_0x3e4591(0xc8)+_0x3a6593+_0x3e4591(0x1af));}}exports['MasterCardService']=MasterCardService;