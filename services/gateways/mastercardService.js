'use strict';const a49_0x1a39f3=a49_0x1ad6;function a49_0x1ad6(_0x2d6c4f,_0x27fa1f){const _0x25f8a7=a49_0x25f8();return a49_0x1ad6=function(_0x1ad6c5,_0x1aa0dc){_0x1ad6c5=_0x1ad6c5-0x11e;let _0x2531dc=_0x25f8a7[_0x1ad6c5];return _0x2531dc;},a49_0x1ad6(_0x2d6c4f,_0x27fa1f);}(function(_0x255424,_0x3baccc){const _0x2eb325=a49_0x1ad6,_0x5b7939=_0x255424();while(!![]){try{const _0x964e5a=-parseInt(_0x2eb325(0x148))/0x1*(-parseInt(_0x2eb325(0x1cb))/0x2)+-parseInt(_0x2eb325(0x244))/0x3+-parseInt(_0x2eb325(0x11f))/0x4*(-parseInt(_0x2eb325(0x26f))/0x5)+-parseInt(_0x2eb325(0x215))/0x6*(parseInt(_0x2eb325(0x17d))/0x7)+parseInt(_0x2eb325(0x276))/0x8+-parseInt(_0x2eb325(0x1e6))/0x9*(parseInt(_0x2eb325(0x173))/0xa)+-parseInt(_0x2eb325(0x259))/0xb*(-parseInt(_0x2eb325(0x1c1))/0xc);if(_0x964e5a===_0x3baccc)break;else _0x5b7939['push'](_0x5b7939['shift']());}catch(_0x15c417){_0x5b7939['push'](_0x5b7939['shift']());}}}(a49_0x25f8,0x253a2));function a49_0x25f8(){const _0x488c72=['scheduleStatusChecks','masterCardApiUrl','✅\x20Payment\x20','\x20\x20\x20Amount:\x20','Payment\x20cancellation\x20is\x20being\x20processed','-----END','\x20(from:\x20status=','VISA/MasterCard\x20payment\x20successful','Return\x20URL:','logWhiteDomainError','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','hasOwnProperty','Payment\x20is\x20being\x20processed','Card\x20Holder:','/charge_raw','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','readFileSync','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','keys','apiUrl','__createBinding','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','3DS\x20URL:','MasterCard\x20webhook\x20sent\x20to\x20','set','Captcha\x20confirmation\x20awaited','order_id','payment','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','Order\x20ID:','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','3ds_url','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','60FHvzvf','✅\x20Scheduled\x20','utf8','🔐\x20RSA\x20signing\x20successful','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','join','\x20characters','number','createdAt','1465674vgQKId','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','\x20order_id\x20for\x20search:\x20','delete','🔐\x20AES\x20key\x20and\x20IV\x20generated','getDetailedErrorMessage','\x20status\x20check\x20error:','substring','===\x20PARSED\x20API\x20RESPONSE\x20===','💳\x20VISA/MasterCard\x20service\x20initialized','LookUp\x20code\x20sent','Final:','checkPaymentStatus','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','),\x20defaulting\x20to\x20MasterCard','Amount:','🔐\x20VISA\x20Private\x20key\x20length:\x20','desc','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','length','text','Payment\x20confirmation\x20time\x20has\x20expired','🔍\x20Using\x20','🔐\x20VISA\x20API\x20URL:','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','visaPrivateKeyPath','stopAllStatusChecks','HTTP\x20Status:','findUnique','toLowerCase','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','sendPaymentNotification','\x20\x20\x20Status:\x20','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','__importStar','🔐\x20VISA\x20Private\x20key\x20path:','Request\x20data\x20error','logShopWebhookSent',',\x20id=','Failed\x20to\x20check\x20','\x20\x20\x20-\x20lang:\x20en','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','/status_decrypted','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully',',\x20Final:\x20','1111','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','PAID','privateKeyPath','gatewayOrderId','The\x20card\x20is\x20lost\x20or\x20stolen','update','\x20is\x20final\x20(','__esModule','resolve','__importDefault','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','🔐\x20Data\x20encrypted\x20with\x20AES','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','encryptAES','info','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','🎯\x20Using\x20','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','The\x20card\x20does\x20not\x20exist','Status\x20decryption\x20failed:\x20','\x20result:','expire_year','12EZIwUw','defineProperty','decryptResponsePhp','visa_public.pem','📝\x20Data\x20length:','\x20\x20\x20-\x20method:\x20charge','payment.success','payment_id','❌\x20Data\x20being\x20signed:','\x20\x20\x20-\x20merchant_point_id:','22BiDKHl','\x20\x20\x20-\x20key\x20length:','decryptResponse','Payment\x20System/1.0\x20(MasterCard)','/status','Status\x20','cvv','decryptAES','sendShopWebhook','ms)','create','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','Payment\x20returned','POST','push','final','shopId','parse','logWhiteDomainResponse','visaMerchantPointId','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','-----BEGIN','path','🔐\x20Data\x20signed\x20with\x20RSA',',\x20final=','VisaMasterCardService','Response\x20Time:','240021JlisRg','slice','Webhook\x20event\x20','VISA','writable','VISA/MasterCard','message','publicKeyPath','📝\x20Encrypted\x20data\x20length:','HTTP\x20error!\x20status:\x20','existsSync','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','generateAESKey','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','includes','🔍\x20Using\x20provided\x20card\x20type:\x20','🛑\x20Stopped\x20','Failed\x20to\x20decrypt\x20response','toUpperCase','Payment\x20pending\x20verification','===\x20API\x20RESPONSE\x20===','encryptRSA','\x20payment\x20status:\x20','errorMessage','settings','🔍\x20','\x20MasterCard\x20status\x20check\x20timers','🔐\x20MasterCard\x20API\x20URL:','Sender\x20information\x20required','logWhiteDomainRequest','Insufficient\x20funds\x20on\x20the\x20card','crypto','default','Decryption\x20failed:\x20','sendPaymentNotifications','../telegramBotService','🧹\x20Clearing\x20','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','application/json','charge','statusCheckTimers','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','PHP\x20decryptor\x20error','isFinalStatus','stringify','Status:','6tjpHWn','📝\x20Signature\x20length:','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','private.pem','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','💾\x20Saving\x20failure\x20message:\x20','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','\x20with\x20status\x20','webhookEvents','toString','floor','privateDecrypt','shop',',\x20payment_id=','Unsuccessful\x20payment','FAILED','configurable','📝\x20Decrypted\x20webhook\x20data:','HTTP\x20','\x20status\x20check\x20#','❌\x20Detailed\x20failure\x20description:\x20','validateKeyFiles','Failed\x20payment','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','Unknown\x20error','isArray','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','getOwnPropertyNames','createCipheriv','\x20\x20\x20Payment\x20ID:\x20','status',',\x20Desc:\x20','📊\x20Status\x20check\x20result:',',\x20body:\x20','warn','),\x20stopping\x20status\x20checks','\x20\x20Original:\x20\x22','\x20payment_id\x20for\x20search:\x20','Card\x20Number:','constants','Payment\x20prohibited','https://api2.trapay.uk/decrypt.php','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','No\x20Error\x20executing\x20request','Payment\x20System/1.0','Error\x20details:','762855nDCERu','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','paidAt','paid','getOwnPropertyDescriptor','signRSA','log','/status_raw',',\x20orderId=','Awaiting\x20confirmation\x20by\x20ivr\x20call','Another\x20unknown\x20error','✅\x20Payment\x20successful','error','base64','Method\x20not\x20allowed','logShopWebhookError','MASTERCARD','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','🔐\x20Using\x20keys:\x20','psp_public.pem','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','7283078AZsuLr','Failed\x20to\x20send\x20payment\x20notifications:','replace','\x20\x20\x20Currency:\x20','failed','Number\x20of\x20attempts\x20exceeded','❌\x20RSA\x20signing\x20failed:','masterCardMerchantPointId','from','last_name','/charge_decrypted','updatePaymentStatus','LookUp\x20code\x20verified','Awaiting\x20confirmation\x20in\x20the\x20application','getCardTypeAndApi','❌\x20PHP\x20decryptor\x20request\x20failed:','end','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','unknown','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','****\x20****\x20****\x20','5285JMfbQQ','randomBytes','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','key','📊\x20','sign','aes-256-ctr','771136ETOLYV','maskCardNumber','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','paymentId','5000000000000000','Response\x20Body:','cardType','json','first_name','🔐\x203DS\x20verification\x20required','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','\x20status\x20checks\x20for\x20payment\x20','date_success','createSign','\x20(from:\x20order_id=','28wftoUx','trim','visaApiUrl','paymentStatuses','webhook_send','orderId','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','visa/mastercard','merchantPointId','amount','Cash\x20payment\x20is\x20expected\x20at\x20TCO','cwd','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Error\x20parsing\x20webhook\x20events:','PENDING','Transaction\x20limit\x20exceeded','card_type','now','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','Invalid\x20expiration\x20date','Sender\x27s\x20CVV\x20card\x20is\x20required','✅\x20VISA\x20key\x20files\x20validated\x20successfully','get','Payment\x20confirmation\x20required','🧹\x20Card\x20holder\x20names\x20cleaned:','clearStatusTimers','3DS\x20verification\x20required','../../config/database','https://api.paydmeth.com/api','loggerService','createDecipheriv','webhookUrl','visa_private.pem','\x20API:\x20','then','⏰\x20Scheduling\x20status\x20checks\x20for\x20','✅\x20Status\x20response\x20decrypted\x20successfully','📊\x20Checking\x20','visaPublicKeyPath','system','\x22\x20|\x20\x22','934yXotod','currency','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','Payment\x20ID:','description','../loggerService','payment.failed','charAt','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','publicEncrypt'];a49_0x25f8=function(){return _0x488c72;};return a49_0x25f8();}var __createBinding=this&&this[a49_0x1a39f3(0x166)]||(Object[a49_0x1a39f3(0x1d5)]?function(_0x2cfc8c,_0x4c7784,_0x7b6929,_0x1bd75d){const _0x5c1728=a49_0x1a39f3;if(_0x1bd75d===undefined)_0x1bd75d=_0x7b6929;var _0x206dad=Object[_0x5c1728(0x248)](_0x4c7784,_0x7b6929);(!_0x206dad||(_0x5c1728(0x135)in _0x206dad?!_0x4c7784[_0x5c1728(0x1b2)]:_0x206dad[_0x5c1728(0x1ea)]||_0x206dad[_0x5c1728(0x226)]))&&(_0x206dad={'enumerable':!![],'get':function(){return _0x4c7784[_0x7b6929];}}),Object[_0x5c1728(0x1c2)](_0x2cfc8c,_0x1bd75d,_0x206dad);}:function(_0x5e4d81,_0x4ba754,_0x4b4069,_0x99aac6){if(_0x99aac6===undefined)_0x99aac6=_0x4b4069;_0x5e4d81[_0x99aac6]=_0x4ba754[_0x4b4069];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a49_0x1a39f3(0x1d5)]?function(_0x26a7c1,_0x5cdb72){const _0x394062=a49_0x1a39f3;Object[_0x394062(0x1c2)](_0x26a7c1,'default',{'enumerable':!![],'value':_0x5cdb72});}:function(_0x31de54,_0x2f9780){_0x31de54['default']=_0x2f9780;}),__importStar=this&&this[a49_0x1a39f3(0x19f)]||(function(){var _0x20bc69=function(_0x3e580a){const _0x5ed25e=a49_0x1ad6;return _0x20bc69=Object[_0x5ed25e(0x231)]||function(_0x337f13){const _0x44382e=_0x5ed25e;var _0x2d4bd1=[];for(var _0x116ccb in _0x337f13)if(Object['prototype'][_0x44382e(0x15d)]['call'](_0x337f13,_0x116ccb))_0x2d4bd1[_0x2d4bd1['length']]=_0x116ccb;return _0x2d4bd1;},_0x20bc69(_0x3e580a);};return function(_0x22f0a0){const _0x462784=a49_0x1ad6;if(_0x22f0a0&&_0x22f0a0[_0x462784(0x1b2)])return _0x22f0a0;var _0x42ea12={};if(_0x22f0a0!=null){for(var _0x3b904d=_0x20bc69(_0x22f0a0),_0x507f6e=0x0;_0x507f6e<_0x3b904d[_0x462784(0x190)];_0x507f6e++)if(_0x3b904d[_0x507f6e]!==_0x462784(0x207))__createBinding(_0x42ea12,_0x22f0a0,_0x3b904d[_0x507f6e]);}return __setModuleDefault(_0x42ea12,_0x22f0a0),_0x42ea12;};}()),__importDefault=this&&this[a49_0x1a39f3(0x1b4)]||function(_0x2f0d08){const _0x20d78c=a49_0x1a39f3;return _0x2f0d08&&_0x2f0d08[_0x20d78c(0x1b2)]?_0x2f0d08:{'default':_0x2f0d08};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['VisaMasterCardService']=void 0x0;const crypto_1=__importDefault(require(a49_0x1a39f3(0x206))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x1a39f3(0x1e1))),loggerService_1=require(a49_0x1a39f3(0x14d));class VisaMasterCardService{constructor(){const _0x1b3db0=a49_0x1a39f3;this[_0x1b3db0(0x20f)]=new Map(),this[_0x1b3db0(0x122)]={0x0:{'final':![],'description':'No\x20New\x20payment'},0x1:{'final':![],'description':_0x1b3db0(0x241)},0x2:{'final':!![],'description':_0x1b3db0(0x1a1)},0x3:{'final':!![],'description':_0x1b3db0(0x24e)},0x4:{'final':!![],'description':'Unsuccessful\x20payment'},0x5:{'final':!![],'description':_0x1b3db0(0x170)},0x6:{'final':!![],'description':_0x1b3db0(0x1d7)},0x7:{'final':!![],'description':'Test\x20payment'},0x8:{'final':![],'description':'Client\x20OTP\x20confirmation\x20required'},0x9:{'final':![],'description':_0x1b3db0(0x139)},0xa:{'final':![],'description':_0x1b3db0(0x133)},0xb:{'final':![],'description':_0x1b3db0(0x203)},0xc:{'final':![],'description':'Recipient\x20data\x20required'},0xd:{'final':![],'description':_0x1b3db0(0x26d)},0xe:{'final':![],'description':_0x1b3db0(0x24d)},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':_0x1b3db0(0x16b)},0x11:{'final':![],'description':_0x1b3db0(0x280)},0x12:{'final':![],'description':_0x1b3db0(0x266)},0x13:{'final':![],'description':_0x1b3db0(0x15e)},0x14:{'final':![],'description':_0x1b3db0(0x20c)},0x15:{'final':![],'description':'Expected\x20bitcoin\x20transfer\x20from\x20client'},0x16:{'final':![],'description':_0x1b3db0(0x1fa)},0x18:{'final':![],'description':_0x1b3db0(0x1ab)},0x19:{'final':![],'description':_0x1b3db0(0x1bc)},0x1a:{'final':!![],'description':_0x1b3db0(0x129)},0x1b:{'final':![],'description':_0x1b3db0(0x161)},0x1c:{'final':![],'description':_0x1b3db0(0x21c)},0x1d:{'final':![],'description':_0x1b3db0(0x21a)},0x1f:{'final':![],'description':_0x1b3db0(0x16e)},0x20:{'final':![],'description':_0x1b3db0(0x240)},0x23:{'final':![],'description':'Sender\x27s\x20card\x20details\x20are\x20required'},0x24:{'final':!![],'description':_0x1b3db0(0x192)},0x25:{'final':!![],'description':_0x1b3db0(0x23e)},0x26:{'final':!![],'description':_0x1b3db0(0x26a)},0x27:{'final':!![],'description':_0x1b3db0(0x205)},0x28:{'final':!![],'description':_0x1b3db0(0x1bd)},0x29:{'final':!![],'description':_0x1b3db0(0x1af)},0x2a:{'final':!![],'description':_0x1b3db0(0x132)},0x2b:{'final':!![],'description':_0x1b3db0(0x12e)},0x2c:{'final':!![],'description':'The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank'},0x2d:{'final':!![],'description':_0x1b3db0(0x22c)},0x2e:{'final':!![],'description':_0x1b3db0(0x224)},0x2f:{'final':!![],'description':_0x1b3db0(0x224)},0x30:{'final':!![],'description':'Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled'},0x31:{'final':![],'description':_0x1b3db0(0x136)},0x32:{'final':!![],'description':_0x1b3db0(0x252)},0x33:{'final':!![],'description':_0x1b3db0(0x22c)},0x34:{'final':!![],'description':_0x1b3db0(0x22c)},0x35:{'final':!![],'description':_0x1b3db0(0x22c)},0x36:{'final':!![],'description':_0x1b3db0(0x22c)},0x37:{'final':!![],'description':_0x1b3db0(0x22c)},0x38:{'final':!![],'description':'Cancellation\x20is\x20not\x20possible'},0x39:{'final':![],'description':_0x1b3db0(0x219)},0x3a:{'final':![],'description':_0x1b3db0(0x187)},0x3b:{'final':!![],'description':_0x1b3db0(0x265)},0x3c:{'final':!![],'description':_0x1b3db0(0x25e)},0x3d:{'final':!![],'description':'Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible'},0x3e:{'final':!![],'description':_0x1b3db0(0x195)},0x3f:{'final':!![],'description':_0x1b3db0(0x1d7)},0x40:{'final':![],'description':'LookUp\x20not\x20confirmed'},0x41:{'final':!![],'description':'LookUp\x20number\x20of\x20attempts\x20exceeded'},0x42:{'final':![],'description':_0x1b3db0(0x156)},0x43:{'final':!![],'description':_0x1b3db0(0x1f2)},0x44:{'final':![],'description':_0x1b3db0(0x139)},0x45:{'final':!![],'description':_0x1b3db0(0x22c)},0x46:{'final':!![],'description':_0x1b3db0(0x22c)},0x47:{'final':!![],'description':'Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details'},0x64:{'final':!![],'description':'Operation\x20completed\x20successfully'}},this[_0x1b3db0(0x153)]=_0x1b3db0(0x13b),this['masterCardMerchantPointId']=0x6e4,this['privateKeyPath']=path_1[_0x1b3db0(0x207)][_0x1b3db0(0x179)](process[_0x1b3db0(0x12a)](),_0x1b3db0(0x164),_0x1b3db0(0x218)),this[_0x1b3db0(0x1ed)]=path_1[_0x1b3db0(0x207)][_0x1b3db0(0x179)](process[_0x1b3db0(0x12a)](),_0x1b3db0(0x164),_0x1b3db0(0x257)),this[_0x1b3db0(0x121)]=_0x1b3db0(0x13b),this[_0x1b3db0(0x1de)]=0x6b7,this['visaPrivateKeyPath']=path_1[_0x1b3db0(0x207)][_0x1b3db0(0x179)](process[_0x1b3db0(0x12a)](),_0x1b3db0(0x164),_0x1b3db0(0x13f)),this[_0x1b3db0(0x145)]=path_1[_0x1b3db0(0x207)][_0x1b3db0(0x179)](process[_0x1b3db0(0x12a)](),'keys',_0x1b3db0(0x1c4)),console[_0x1b3db0(0x24a)](_0x1b3db0(0x186)),console[_0x1b3db0(0x24a)](_0x1b3db0(0x202),this['masterCardApiUrl']),console[_0x1b3db0(0x24a)](_0x1b3db0(0x194),this[_0x1b3db0(0x121)]),console[_0x1b3db0(0x24a)]('🔐\x20MasterCard\x20Private\x20key\x20path:',this[_0x1b3db0(0x1ad)]),console[_0x1b3db0(0x24a)]('🔐\x20MasterCard\x20Public\x20key\x20path:',this[_0x1b3db0(0x1ed)]),console[_0x1b3db0(0x24a)](_0x1b3db0(0x1a0),this['visaPrivateKeyPath']),console[_0x1b3db0(0x24a)]('🔐\x20VISA\x20Public\x20key\x20path:',this[_0x1b3db0(0x145)]),this[_0x1b3db0(0x22b)]();}[a49_0x1a39f3(0x182)](_0x549100,_0x2f8ea4){const _0x414594=a49_0x1a39f3,_0x20af40=this[_0x414594(0x122)][_0x549100];let _0x1bf350='';_0x20af40?_0x1bf350=_0x414594(0x1d0)+_0x549100+':\x20'+_0x20af40[_0x414594(0x14c)]:_0x1bf350='Status\x20'+_0x549100+':\x20Unknown\x20status\x20code';if(_0x2f8ea4&&_0x2f8ea4['trim']()){const _0x1145e3=_0x2f8ea4['trim']();(!_0x20af40||_0x1145e3[_0x414594(0x19a)]()!==_0x20af40[_0x414594(0x14c)][_0x414594(0x19a)]())&&(_0x1bf350+='\x20|\x20Response:\x20'+_0x1145e3);}return _0x1bf350;}[a49_0x1a39f3(0x212)](_0x3f58cb){const _0x5e4f91=a49_0x1a39f3,_0x4136b4=this['paymentStatuses'][_0x3f58cb];return _0x4136b4?_0x4136b4[_0x5e4f91(0x1da)]:!![];}[a49_0x1a39f3(0x267)](_0x264f83){const _0x44532e=a49_0x1a39f3,_0x5553c4=_0x264f83[_0x44532e(0x14f)](0x0);if(_0x5553c4==='4')return console[_0x44532e(0x24a)](_0x44532e(0x22d)),{'cardType':_0x44532e(0x1e9),'apiUrl':this[_0x44532e(0x121)],'privateKeyPath':this[_0x44532e(0x196)],'publicKeyPath':this[_0x44532e(0x145)],'merchantPointId':this[_0x44532e(0x1de)]};else return _0x5553c4==='5'?(console['log'](_0x44532e(0x150)),{'cardType':_0x44532e(0x254),'apiUrl':this[_0x44532e(0x153)],'privateKeyPath':this[_0x44532e(0x1ad)],'publicKeyPath':this[_0x44532e(0x1ed)],'merchantPointId':this[_0x44532e(0x260)]}):(console['log'](_0x44532e(0x278)+_0x5553c4+_0x44532e(0x18b)),{'cardType':_0x44532e(0x254),'apiUrl':this[_0x44532e(0x153)],'privateKeyPath':this[_0x44532e(0x1ad)],'publicKeyPath':this[_0x44532e(0x1ed)],'merchantPointId':this[_0x44532e(0x260)]});}[a49_0x1a39f3(0x22b)](){const _0xddcd94=a49_0x1a39f3;try{if(!fs_1[_0xddcd94(0x207)]['existsSync'](this['privateKeyPath']))throw new Error(_0xddcd94(0x125)+this[_0xddcd94(0x1ad)]);if(!fs_1[_0xddcd94(0x207)][_0xddcd94(0x1f0)](this['publicKeyPath']))throw new Error(_0xddcd94(0x258)+this[_0xddcd94(0x1ed)]);const _0xd9d4d2=fs_1['default'][_0xddcd94(0x162)](this['privateKeyPath'],'utf8')['trim'](),_0x41cd1a=fs_1[_0xddcd94(0x207)][_0xddcd94(0x162)](this['publicKeyPath'],'utf8')[_0xddcd94(0x120)]();if(!_0xd9d4d2[_0xddcd94(0x1f5)]('-----BEGIN')||!_0xd9d4d2[_0xddcd94(0x1f5)]('-----END'))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x41cd1a[_0xddcd94(0x1f5)](_0xddcd94(0x1e0))||!_0x41cd1a['includes'](_0xddcd94(0x157)))throw new Error(_0xddcd94(0x1b5));console[_0xddcd94(0x24a)](_0xddcd94(0x1a8)),console[_0xddcd94(0x24a)](_0xddcd94(0x178)+_0xd9d4d2['length']+_0xddcd94(0x17a)),console['log']('🔐\x20MasterCard\x20Public\x20key\x20length:\x20'+_0x41cd1a[_0xddcd94(0x190)]+'\x20characters');if(fs_1[_0xddcd94(0x207)]['existsSync'](this['visaPrivateKeyPath'])&&fs_1['default'][_0xddcd94(0x1f0)](this[_0xddcd94(0x145)])){const _0x14ddc2=fs_1[_0xddcd94(0x207)]['readFileSync'](this[_0xddcd94(0x196)],_0xddcd94(0x175))[_0xddcd94(0x120)](),_0x48e315=fs_1[_0xddcd94(0x207)][_0xddcd94(0x162)](this['visaPublicKeyPath'],_0xddcd94(0x175))[_0xddcd94(0x120)]();(!_0x14ddc2[_0xddcd94(0x1f5)]('-----BEGIN')||!_0x14ddc2['includes'](_0xddcd94(0x157)))&&console[_0xddcd94(0x238)](_0xddcd94(0x18a)),(!_0x48e315[_0xddcd94(0x1f5)](_0xddcd94(0x1e0))||!_0x48e315[_0xddcd94(0x1f5)]('-----END'))&&console[_0xddcd94(0x238)](_0xddcd94(0x26b)),console[_0xddcd94(0x24a)](_0xddcd94(0x134)),console[_0xddcd94(0x24a)](_0xddcd94(0x18d)+_0x14ddc2['length']+_0xddcd94(0x17a)),console[_0xddcd94(0x24a)]('🔐\x20VISA\x20Public\x20key\x20length:\x20'+_0x48e315[_0xddcd94(0x190)]+_0xddcd94(0x17a));}else console[_0xddcd94(0x238)](_0xddcd94(0x1f1)),console[_0xddcd94(0x238)](_0xddcd94(0x230)+this[_0xddcd94(0x196)]),console[_0xddcd94(0x238)](_0xddcd94(0x17e)+this[_0xddcd94(0x145)]);}catch(_0x20e807){console[_0xddcd94(0x250)](_0xddcd94(0x1b7),_0x20e807);throw _0x20e807;}}[a49_0x1a39f3(0x1f3)](){const _0x1e6f71=a49_0x1a39f3,_0x554f7b=crypto_1[_0x1e6f71(0x207)]['randomBytes'](0x20),_0x81803a=crypto_1[_0x1e6f71(0x207)][_0x1e6f71(0x270)](0x10);return{'key':_0x554f7b,'iv':_0x81803a};}[a49_0x1a39f3(0x1b8)](_0x471dec,_0x6df8e7,_0x21ef83){const _0x1e9e40=a49_0x1a39f3,_0x355f65=crypto_1[_0x1e9e40(0x207)][_0x1e9e40(0x232)](_0x1e9e40(0x275),_0x6df8e7,_0x21ef83);let _0x3a0d97=_0x355f65[_0x1e9e40(0x1b0)](_0x471dec,_0x1e9e40(0x175),_0x1e9e40(0x251));return _0x3a0d97+=_0x355f65[_0x1e9e40(0x1da)]('base64'),_0x3a0d97;}[a49_0x1a39f3(0x1fc)](_0x1a825d,_0x55a6c2,_0x404c3e){const _0x3564db=a49_0x1a39f3;try{const _0x464474=fs_1[_0x3564db(0x207)][_0x3564db(0x162)](_0x404c3e,_0x3564db(0x175))[_0x3564db(0x120)](),_0xdef034={'iv':_0x55a6c2[_0x3564db(0x21f)](_0x3564db(0x251)),'key':_0x1a825d[_0x3564db(0x21f)](_0x3564db(0x251))},_0x276ec7=JSON[_0x3564db(0x213)](_0xdef034);console[_0x3564db(0x24a)](_0x3564db(0x163),_0x276ec7[_0x3564db(0x190)]);const _0x5fa86a=crypto_1[_0x3564db(0x207)][_0x3564db(0x151)]({'key':_0x464474,'padding':crypto_1['default'][_0x3564db(0x23d)]['RSA_PKCS1_PADDING']},Buffer['from'](_0x276ec7));return console[_0x3564db(0x24a)](_0x3564db(0x19e),_0x5fa86a[_0x3564db(0x190)]),_0x5fa86a['toString'](_0x3564db(0x251));}catch(_0x336a00){console[_0x3564db(0x250)]('❌\x20RSA\x20encryption\x20failed:',_0x336a00);throw new Error(_0x3564db(0x1ba));}}[a49_0x1a39f3(0x249)](_0x45c93e,_0x249546){const _0x677e2c=a49_0x1a39f3;try{const _0x36f278=fs_1[_0x677e2c(0x207)]['readFileSync'](_0x249546,_0x677e2c(0x175))['trim'](),_0x383ca1=crypto_1['default'][_0x677e2c(0x283)]('SHA256');_0x383ca1[_0x677e2c(0x1b0)](_0x45c93e),_0x383ca1[_0x677e2c(0x269)]();const _0x46af96=_0x383ca1[_0x677e2c(0x274)](_0x36f278,_0x677e2c(0x251));return console[_0x677e2c(0x24a)](_0x677e2c(0x176)),console['log']('📝\x20Data\x20to\x20sign\x20length:',_0x45c93e[_0x677e2c(0x190)]),console[_0x677e2c(0x24a)](_0x677e2c(0x216),_0x46af96['length']),_0x46af96;}catch(_0x49d836){console[_0x677e2c(0x250)](_0x677e2c(0x25f),_0x49d836),console[_0x677e2c(0x250)](_0x677e2c(0x1c9),_0x45c93e[_0x677e2c(0x184)](0x0,0xc8)+'...');throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}['decryptAES'](_0x5e4970,_0x468d01,_0x43365e){const _0x31dde1=a49_0x1a39f3,_0x37c79f=crypto_1[_0x31dde1(0x207)][_0x31dde1(0x13d)](_0x31dde1(0x275),_0x468d01,_0x43365e);let _0x40ee02=_0x37c79f[_0x31dde1(0x1b0)](_0x5e4970,_0x31dde1(0x251),_0x31dde1(0x175));return _0x40ee02+=_0x37c79f[_0x31dde1(0x1da)](_0x31dde1(0x175)),_0x40ee02;}async['decryptResponsePhp'](_0x555b1c,_0x12ef3a,_0x30d826=a49_0x1a39f3(0x254)){const _0x59553c=a49_0x1a39f3;try{const _0x43e2ac=await fetch(_0x59553c(0x23f),{'method':_0x59553c(0x1d8),'headers':{'Content-Type':_0x59553c(0x20d)},'body':JSON[_0x59553c(0x213)]({'info':_0x555b1c,'key':_0x12ef3a,'card_type':_0x30d826[_0x59553c(0x19a)]()})});if(!_0x43e2ac['ok'])throw new Error(_0x59553c(0x211));return await _0x43e2ac[_0x59553c(0x191)]();}catch(_0x60d2ce){console[_0x59553c(0x250)](_0x59553c(0x268),_0x60d2ce);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a49_0x1a39f3(0x1cd)](_0x44dd0f,_0x346ca3){const _0x2e2ca8=a49_0x1a39f3;try{const _0x54115c=fs_1['default'][_0x2e2ca8(0x162)](this['privateKeyPath'],'utf8')[_0x2e2ca8(0x120)](),_0x165826=crypto_1[_0x2e2ca8(0x207)][_0x2e2ca8(0x221)](_0x54115c,Buffer[_0x2e2ca8(0x261)](_0x346ca3,'base64')),_0x373c4a=JSON[_0x2e2ca8(0x1dc)](_0x165826[_0x2e2ca8(0x21f)]()),_0x329a47=Buffer['from'](_0x373c4a[_0x2e2ca8(0x272)],_0x2e2ca8(0x251)),_0x1e912b=Buffer['from'](_0x373c4a['iv'],_0x2e2ca8(0x251));return this[_0x2e2ca8(0x1d2)](_0x44dd0f,_0x329a47,_0x1e912b);}catch(_0x41fff6){throw new Error(_0x2e2ca8(0x1f8));}}async['processCardPayment'](_0x3c14c5){const _0x244746=a49_0x1a39f3,{paymentId:_0x324f0f,orderId:_0x97ae0d,amount:_0x216ec9,currency:_0x26f81e,cardData:_0x5927e6,resultUrl:_0x2edb03,returnUrl:_0x1dbc30,cardHolder:_0x4c52d0,browser:_0x41811c}=_0x3c14c5;console[_0x244746(0x24a)](_0x244746(0x1d6)),console[_0x244746(0x24a)]('Payment\x20ID:',_0x324f0f),console['log'](_0x244746(0x16f),_0x97ae0d),console[_0x244746(0x24a)](_0x244746(0x18c),_0x216ec9,_0x26f81e),console['log'](_0x244746(0x23c),this[_0x244746(0x277)](_0x5927e6[_0x244746(0x17b)])),console[_0x244746(0x24a)](_0x244746(0x15f),_0x4c52d0['first_name']+'\x20'+_0x4c52d0['last_name']),console[_0x244746(0x24a)](_0x244746(0x15a),_0x1dbc30),console[_0x244746(0x24a)]('Result\x20URL:',_0x2edb03);const _0x3c9478=this[_0x244746(0x267)](_0x5927e6[_0x244746(0x17b)]);console[_0x244746(0x24a)](_0x244746(0x1bb)+_0x3c9478[_0x244746(0x27c)]+_0x244746(0x140)+_0x3c9478['apiUrl']),console[_0x244746(0x24a)](_0x244746(0x256)+_0x3c9478[_0x244746(0x1ad)]+',\x20'+_0x3c9478[_0x244746(0x1ed)]);const _0x5e5729={..._0x4c52d0,'first_name':_0x4c52d0['first_name']?.[_0x244746(0x25b)](/[\t\n\r\f\v]/g,'\x20')['trim']()||'','last_name':_0x4c52d0[_0x244746(0x262)]?.[_0x244746(0x25b)](/[\t\n\r\f\v]/g,'\x20')[_0x244746(0x120)]()||''};console['log'](_0x244746(0x137)),console['log'](_0x244746(0x23a)+_0x4c52d0[_0x244746(0x27e)]+_0x244746(0x147)+_0x4c52d0[_0x244746(0x262)]+'\x22'),console[_0x244746(0x24a)]('\x20\x20Cleaned:\x20\x20\x22'+_0x5e5729['first_name']+_0x244746(0x147)+_0x5e5729['last_name']+'\x22');const _0x1894f2={'amount':_0x216ec9,'currency':_0x26f81e[_0x244746(0x1f9)](),'order_id':_0x97ae0d,'result_url':_0x2edb03,'return_url':_0x1dbc30,'country':'','card':{'number':_0x5927e6[_0x244746(0x17b)],'expire_month':_0x5927e6['expire_month'],'expire_year':_0x5927e6[_0x244746(0x1c0)],'cvv':_0x5927e6[_0x244746(0x1d1)]},'card_holder':_0x5e5729,'browser':_0x41811c},_0x450f51=JSON['stringify'](_0x1894f2);console[_0x244746(0x24a)]('💾\x20Payment\x20data\x20prepared'),console[_0x244746(0x24a)](_0x244746(0x177)),console[_0x244746(0x24a)](_0x450f51),console[_0x244746(0x24a)](_0x244746(0x1c5),_0x450f51[_0x244746(0x190)]);try{const {key:_0x28b28f,iv:_0x54c4b4}=this['generateAESKey']();console['log'](_0x244746(0x181)),console[_0x244746(0x24a)]('🔐\x20AES\x20key\x20length:',_0x28b28f[_0x244746(0x190)]),console[_0x244746(0x24a)]('🔐\x20AES\x20IV\x20length:',_0x54c4b4[_0x244746(0x190)]);const _0x45cde1=this[_0x244746(0x1b8)](_0x450f51,_0x28b28f,_0x54c4b4);console[_0x244746(0x24a)](_0x244746(0x1b6)),console['log'](_0x244746(0x1ee),_0x45cde1[_0x244746(0x190)]);const _0x4087c3=this[_0x244746(0x1fc)](_0x28b28f,_0x54c4b4,_0x3c9478[_0x244746(0x1ed)]);console[_0x244746(0x24a)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x244746(0x24a)]('📝\x20Encrypted\x20key\x20length:',_0x4087c3[_0x244746(0x190)]);const _0xefaf04=this[_0x244746(0x249)](_0x450f51,_0x3c9478[_0x244746(0x1ad)]);console[_0x244746(0x24a)](_0x244746(0x1e2)),console[_0x244746(0x24a)](_0x244746(0x216),_0xefaf04[_0x244746(0x190)]);const _0x6849e9={'merchant_point_id':_0x3c9478[_0x244746(0x127)],'method':_0x244746(0x20e),'info':_0x45cde1,'key':_0x4087c3,'sign':_0xefaf04,'lang':'en'};console['log']('📤\x20Sending\x20request\x20to\x20API...'),console[_0x244746(0x24a)]('📝\x20Final\x20request\x20structure:'),console['log'](_0x244746(0x1ca),_0x3c9478[_0x244746(0x127)]),console[_0x244746(0x24a)](_0x244746(0x1c6)),console[_0x244746(0x24a)]('\x20\x20\x20-\x20info\x20length:',_0x45cde1['length']),console['log'](_0x244746(0x1cc),_0x4087c3[_0x244746(0x190)]),console[_0x244746(0x24a)]('\x20\x20\x20-\x20sign\x20length:',_0xefaf04[_0x244746(0x190)]),console['log'](_0x244746(0x1a5)),loggerService_1[_0x244746(0x13c)][_0x244746(0x204)](_0x3c9478[_0x244746(0x27c)][_0x244746(0x19a)](),'/charge',_0x244746(0x1d8),{'merchant_point_id':_0x3c9478['merchantPointId'],'method':'charge','lang':'en'});const _0x5c255a=Date[_0x244746(0x130)](),_0x160ef5=await fetch(_0x3c9478[_0x244746(0x165)],{'method':_0x244746(0x1d8),'headers':{'Content-Type':_0x244746(0x20d),'Accept':_0x244746(0x20d),'User-Agent':_0x244746(0x242)},'body':JSON[_0x244746(0x213)](_0x6849e9)}),_0x4714b7=Date['now']()-_0x5c255a;console[_0x244746(0x24a)](_0x244746(0x1fb)),console[_0x244746(0x24a)](_0x244746(0x214),_0x160ef5[_0x244746(0x234)]),console[_0x244746(0x24a)](_0x244746(0x1e5),_0x4714b7+'ms');if(!_0x160ef5['ok']){const _0xdb2a3d=await _0x160ef5['text']();console[_0x244746(0x250)](_0x244746(0x198),_0x160ef5[_0x244746(0x234)]),console[_0x244746(0x250)](_0x244746(0x27b),_0xdb2a3d),loggerService_1[_0x244746(0x13c)][_0x244746(0x1dd)](_0x3c9478[_0x244746(0x27c)][_0x244746(0x19a)](),'/charge_raw',_0x160ef5[_0x244746(0x234)],_0xdb2a3d,_0x4714b7),loggerService_1[_0x244746(0x13c)][_0x244746(0x15b)](_0x3c9478[_0x244746(0x27c)][_0x244746(0x19a)](),'/charge',_0x244746(0x228)+_0x160ef5[_0x244746(0x234)]+':\x20'+_0xdb2a3d);throw new Error(_0x244746(0x1ef)+_0x160ef5[_0x244746(0x234)]+_0x244746(0x237)+_0xdb2a3d);}const _0x47a2cf=await _0x160ef5[_0x244746(0x27d)]();loggerService_1[_0x244746(0x13c)][_0x244746(0x1dd)](_0x3c9478[_0x244746(0x27c)][_0x244746(0x19a)](),_0x244746(0x160),_0x160ef5['status'],_0x47a2cf,_0x4714b7),console[_0x244746(0x24a)](_0x244746(0x185));let _0x25a0ea=_0x47a2cf;if(_0x47a2cf[_0x244746(0x1b9)]&&_0x47a2cf[_0x244746(0x272)]&&_0x47a2cf['sign']){console[_0x244746(0x24a)](_0x244746(0x210));try{const _0x2fb871=await this['decryptResponsePhp'](_0x47a2cf['info'],_0x47a2cf[_0x244746(0x272)],_0x3c9478[_0x244746(0x27c)]);_0x25a0ea=JSON[_0x244746(0x1dc)](_0x2fb871),console[_0x244746(0x24a)]('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1['loggerService'][_0x244746(0x1dd)](_0x3c9478[_0x244746(0x27c)][_0x244746(0x19a)](),_0x244746(0x263),_0x160ef5[_0x244746(0x234)],_0x25a0ea,_0x4714b7),console['log'](_0x244746(0x12b));}catch(_0x3e5caf){console['error']('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x3e5caf),loggerService_1['loggerService'][_0x244746(0x15b)](_0x3c9478[_0x244746(0x27c)][_0x244746(0x19a)](),'/charge_decrypt',_0x244746(0x208)+_0x3e5caf),_0x25a0ea=_0x47a2cf;}}else loggerService_1['loggerService'][_0x244746(0x1dd)](_0x3c9478[_0x244746(0x27c)]['toLowerCase'](),_0x244746(0x263),_0x160ef5[_0x244746(0x234)],_0x25a0ea,_0x4714b7),console['log']('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x244746(0x24a)](_0x244746(0x214),_0x25a0ea[_0x244746(0x234)]),console['log'](_0x244746(0x188),_0x25a0ea['final']),console[_0x244746(0x24a)](_0x244746(0x14b),_0x25a0ea['payment_id']),console[_0x244746(0x24a)](_0x244746(0x168),_0x25a0ea[_0x244746(0x171)]||'none');if(_0x25a0ea['status']===0x64&&_0x25a0ea[_0x244746(0x1da)]===0x1)return console[_0x244746(0x24a)](_0x244746(0x24f)),{'gateway_payment_id':_0x25a0ea[_0x244746(0x1c8)]?.[_0x244746(0x21f)](),'payment_url':_0x1dbc30,'requires_3ds':![],'status':_0x244746(0x1ac),'final':!![]};if(_0x25a0ea[_0x244746(0x171)])return console[_0x244746(0x24a)](_0x244746(0x27f)),this[_0x244746(0x152)](_0x324f0f,_0x97ae0d,_0x25a0ea[_0x244746(0x1c8)]?.[_0x244746(0x21f)]()||_0x97ae0d,_0x3c9478[_0x244746(0x27c)]),{'gateway_payment_id':_0x25a0ea[_0x244746(0x1c8)]?.[_0x244746(0x21f)](),'payment_url':_0x25a0ea[_0x244746(0x171)],'requires_3ds':!![],'threeds_url':_0x25a0ea['3ds_url'],'status':_0x244746(0x12d),'final':![]};let _0x474230=this[_0x244746(0x182)](_0x25a0ea[_0x244746(0x234)],_0x25a0ea[_0x244746(0x18e)]||_0x25a0ea[_0x244746(0x1ec)]),_0x462b34=_0x25a0ea[_0x244746(0x234)],_0x1d0de5=this[_0x244746(0x212)](_0x25a0ea['status']);return console[_0x244746(0x24a)](_0x244746(0x245)+_0x462b34+_0x244746(0x1a9)+_0x1d0de5+_0x244746(0x235)+_0x474230),{'gateway_payment_id':_0x25a0ea['payment_id']?.[_0x244746(0x21f)](),'payment_url':_0x1dbc30,'requires_3ds':![],'status':_0x244746(0x225),'final':!![],'errorMessage':_0x474230};}catch(_0xfbf1fe){console['error'](_0x244746(0x167)),console[_0x244746(0x250)](_0x244746(0x243),_0xfbf1fe),loggerService_1['loggerService'][_0x244746(0x15b)](_0x244746(0x126),'/charge',_0xfbf1fe);throw new Error(_0x244746(0x255)+(_0xfbf1fe instanceof Error?_0xfbf1fe['message']:'Unknown\x20error'));}}async['checkPaymentStatus'](_0x35d4e2,_0x108b7b,_0x41f35c='VISA'){const _0x21ea8f=a49_0x1a39f3;console[_0x21ea8f(0x24a)](_0x21ea8f(0x144)+_0x41f35c+_0x21ea8f(0x1fd)+_0x35d4e2+'\x20('+_0x108b7b+')');try{const _0x3329cb={'payment_id':_0x35d4e2,'order_id':_0x108b7b},_0x474180=JSON[_0x21ea8f(0x213)](_0x3329cb),_0x5d98de=this[_0x21ea8f(0x267)](_0x41f35c===_0x21ea8f(0x1e9)?'4000000000000000':_0x21ea8f(0x27a)),{key:_0x416519,iv:_0x2f1610}=this[_0x21ea8f(0x1f3)](),_0x15194b=this['encryptAES'](_0x474180,_0x416519,_0x2f1610),_0x3de03a=this[_0x21ea8f(0x1fc)](_0x416519,_0x2f1610,_0x5d98de[_0x21ea8f(0x1ed)]),_0x4d9420=this[_0x21ea8f(0x249)](_0x474180,_0x5d98de[_0x21ea8f(0x1ad)]),_0x5ed71c={'merchant_point_id':_0x5d98de[_0x21ea8f(0x127)],'method':_0x21ea8f(0x234),'info':_0x15194b,'key':_0x3de03a,'sign':_0x4d9420,'lang':'en'};loggerService_1[_0x21ea8f(0x13c)][_0x21ea8f(0x204)](_0x41f35c[_0x21ea8f(0x19a)](),'/status','POST',{'merchant_point_id':_0x5d98de[_0x21ea8f(0x127)],'method':'status','lang':'en'});const _0x181ea9=Date[_0x21ea8f(0x130)](),_0x1f2320=await fetch(_0x5d98de['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x21ea8f(0x20d),'Accept':_0x21ea8f(0x20d),'User-Agent':_0x21ea8f(0x242)},'body':JSON[_0x21ea8f(0x213)](_0x5ed71c)}),_0x17a541=Date[_0x21ea8f(0x130)]()-_0x181ea9;if(!_0x1f2320['ok']){const _0x32aa94=await _0x1f2320[_0x21ea8f(0x191)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x41f35c['toLowerCase'](),_0x21ea8f(0x24b),_0x1f2320[_0x21ea8f(0x234)],_0x32aa94,_0x17a541);throw new Error(_0x21ea8f(0x1ef)+_0x1f2320[_0x21ea8f(0x234)]);}const _0x5ab09c=await _0x1f2320[_0x21ea8f(0x27d)]();loggerService_1['loggerService'][_0x21ea8f(0x1dd)](_0x41f35c[_0x21ea8f(0x19a)](),'/status_raw',_0x1f2320[_0x21ea8f(0x234)],_0x5ab09c,_0x17a541);let _0x5d7d68=_0x5ab09c;if(_0x5ab09c[_0x21ea8f(0x1b9)]&&_0x5ab09c[_0x21ea8f(0x272)]&&_0x5ab09c[_0x21ea8f(0x274)]){console['log'](_0x21ea8f(0x1f4));try{const _0x1730f4=await this[_0x21ea8f(0x1c3)](_0x5ab09c[_0x21ea8f(0x1b9)],_0x5ab09c[_0x21ea8f(0x272)],_0x41f35c);_0x5d7d68=JSON['parse'](_0x1730f4),console['log'](_0x21ea8f(0x143)),loggerService_1[_0x21ea8f(0x13c)][_0x21ea8f(0x1dd)](_0x41f35c[_0x21ea8f(0x19a)](),_0x21ea8f(0x1a7),_0x1f2320['status'],_0x5d7d68,_0x17a541),console[_0x21ea8f(0x24a)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x43f147){console[_0x21ea8f(0x250)](_0x21ea8f(0x131),_0x43f147),loggerService_1[_0x21ea8f(0x13c)][_0x21ea8f(0x15b)](_0x41f35c['toLowerCase'](),'/status_decrypt',_0x21ea8f(0x1be)+_0x43f147),_0x5d7d68=_0x5ab09c;}}else loggerService_1['loggerService'][_0x21ea8f(0x1dd)](_0x41f35c[_0x21ea8f(0x19a)](),'/status_decrypted',_0x1f2320['status'],_0x5d7d68,_0x17a541),console[_0x21ea8f(0x24a)](_0x21ea8f(0x217));console[_0x21ea8f(0x24a)](_0x21ea8f(0x236),{'status':_0x5d7d68[_0x21ea8f(0x234)],'final':_0x5d7d68[_0x21ea8f(0x1da)],'payment_id':_0x5d7d68[_0x21ea8f(0x1c8)],'desc':_0x5d7d68[_0x21ea8f(0x18e)]});let _0x23c691='PENDING';if(_0x5d7d68[_0x21ea8f(0x234)]===0x64&&_0x5d7d68[_0x21ea8f(0x1da)]===0x1)_0x23c691=_0x21ea8f(0x1ac);else{if(_0x5d7d68['final']===0x0||!this[_0x21ea8f(0x212)](_0x5d7d68['status']))_0x23c691=_0x21ea8f(0x12d);else _0x5d7d68[_0x21ea8f(0x1da)]===0x1||this[_0x21ea8f(0x212)](_0x5d7d68['status'])?_0x23c691=_0x21ea8f(0x225):_0x23c691=_0x21ea8f(0x12d);}const _0x365c51=this[_0x21ea8f(0x182)](_0x5d7d68[_0x21ea8f(0x234)],_0x5d7d68[_0x21ea8f(0x18e)]);return{'status':_0x23c691,'final':this['isFinalStatus'](_0x5d7d68[_0x21ea8f(0x234)]),'amount':_0x5d7d68['amount'],'currency':_0x5d7d68['currency'],'date_success':_0x5d7d68[_0x21ea8f(0x282)],'description':_0x365c51};}catch(_0x309677){console['error'](_0x41f35c+_0x21ea8f(0x183),_0x309677),loggerService_1[_0x21ea8f(0x13c)][_0x21ea8f(0x15b)](_0x41f35c[_0x21ea8f(0x19a)](),_0x21ea8f(0x1cf),_0x309677);throw new Error(_0x21ea8f(0x1a4)+_0x41f35c+_0x21ea8f(0x1fd)+(_0x309677 instanceof Error?_0x309677['message']:_0x21ea8f(0x22e)));}}['scheduleStatusChecks'](_0x41a966,_0x5893f3,_0x2009e1,_0x42042d){const _0x36d86c=a49_0x1a39f3;console[_0x36d86c(0x24a)](_0x36d86c(0x142)+_0x42042d+'\x20payment:\x20'+_0x41a966+'\x20('+_0x2009e1+')'),this[_0x36d86c(0x138)](_0x41a966);const _0x1a0148=[],_0x179de5=0x5*0x3c*0x3e8,_0xb5a84f=0x2*0x3c*0x3c*0x3e8,_0x1ffaab=Math[_0x36d86c(0x220)](_0xb5a84f/_0x179de5);console[_0x36d86c(0x24a)]('⏰\x20Will\x20check\x20status\x20'+_0x1ffaab+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x579869=0x1;_0x579869<=_0x1ffaab;_0x579869++){const _0x5cc3ff=setTimeout(async()=>{const _0x369716=_0x36d86c;console['log'](_0x369716(0x200)+_0x42042d+_0x369716(0x229)+_0x579869+'/'+_0x1ffaab+'\x20for\x20payment\x20'+_0x41a966);try{const _0x1b2816=await this[_0x369716(0x189)](_0x2009e1,_0x5893f3,_0x42042d);console[_0x369716(0x24a)]('📊\x20Status\x20check\x20#'+_0x579869+_0x369716(0x1bf),_0x1b2816),_0x1b2816[_0x369716(0x1da)]&&(console[_0x369716(0x24a)](_0x369716(0x154)+_0x41a966+_0x369716(0x1b1)+_0x1b2816['status']+_0x369716(0x239)),this[_0x369716(0x138)](_0x41a966),await this[_0x369716(0x264)](_0x41a966,_0x1b2816['status'],_0x1b2816));}catch(_0x17127b){console['error']('❌\x20Status\x20check\x20#'+_0x579869+'\x20failed\x20for\x20payment\x20'+_0x41a966+':',_0x17127b);}},_0x579869*_0x179de5);_0x1a0148[_0x36d86c(0x1d9)](_0x5cc3ff);}this[_0x36d86c(0x20f)][_0x36d86c(0x16a)](_0x41a966,_0x1a0148),console[_0x36d86c(0x24a)](_0x36d86c(0x174)+_0x1ffaab+_0x36d86c(0x281)+_0x41a966);}['clearStatusTimers'](_0x25c007){const _0x592120=a49_0x1a39f3,_0x439dff=this['statusCheckTimers']['get'](_0x25c007);_0x439dff&&(console['log'](_0x592120(0x20b)+_0x439dff['length']+'\x20status\x20timers\x20for\x20payment\x20'+_0x25c007),_0x439dff['forEach']((_0x8c6eae,_0x39b817)=>{clearTimeout(_0x8c6eae);}),this[_0x592120(0x20f)][_0x592120(0x180)](_0x25c007));}async[a49_0x1a39f3(0x264)](_0x2555c5,_0x598683,_0x2c2e91){const _0x143292=a49_0x1a39f3;try{const _0x46b658=(await Promise[_0x143292(0x1b3)]()[_0x143292(0x141)](()=>__importStar(require(_0x143292(0x13a)))))['default'],_0x412ec6={'status':_0x598683['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x143292(0x146),'statusChangedAt':new Date()};_0x598683===_0x143292(0x1ac)&&(_0x412ec6[_0x143292(0x246)]=new Date()),_0x598683===_0x143292(0x225)&&_0x2c2e91['description']&&(_0x412ec6['failureMessage']=_0x2c2e91[_0x143292(0x14c)],console[_0x143292(0x24a)](_0x143292(0x21b)+_0x2c2e91[_0x143292(0x14c)])),_0x2c2e91['description']&&(_0x412ec6['adminNotes']=(_0x598683===_0x143292(0x1ac)?_0x143292(0x159):_0x143292(0x1eb))+':\x20'+_0x2c2e91['description']),await _0x46b658[_0x143292(0x16d)]['update']({'where':{'id':_0x2555c5},'data':_0x412ec6}),console[_0x143292(0x24a)](_0x143292(0x154)+_0x2555c5+'\x20status\x20updated\x20to\x20'+_0x598683),await this[_0x143292(0x209)](_0x2555c5,_0x598683);}catch(_0xe4679d){console['error']('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x2555c5+':',_0xe4679d);}}async[a49_0x1a39f3(0x209)](_0x39866a,_0x1a5efd){const _0x13e36f=a49_0x1a39f3;try{const _0xa16946=(await Promise[_0x13e36f(0x1b3)]()[_0x13e36f(0x141)](()=>__importStar(require('../../config/database'))))[_0x13e36f(0x207)],{telegramBotService:_0x40749e}=await Promise[_0x13e36f(0x1b3)]()[_0x13e36f(0x141)](()=>__importStar(require(_0x13e36f(0x20a)))),_0x43a163=await _0xa16946[_0x13e36f(0x16d)][_0x13e36f(0x199)]({'where':{'id':_0x39866a},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x43a163)return;const _0x38a93f={'PAID':_0x13e36f(0x247),'FAILED':_0x13e36f(0x25d)},_0x262d1d=_0x38a93f[_0x1a5efd];_0x262d1d&&await _0x40749e[_0x13e36f(0x19c)](_0x43a163[_0x13e36f(0x1db)],_0x43a163,_0x262d1d),await this['sendShopWebhook'](_0x43a163,_0x1a5efd);}catch(_0xd069f3){console[_0x13e36f(0x250)](_0x13e36f(0x25a),_0xd069f3);}}async[a49_0x1a39f3(0x1d3)](_0x6180d8,_0x1fb7ae){const _0x339d35=a49_0x1a39f3,_0xff2e05=Date[_0x339d35(0x130)]();try{const _0x5a564e=_0x6180d8['shop'],_0x1c8098=_0x5a564e['settings'];if(!_0x1c8098?.[_0x339d35(0x13e)]){console[_0x339d35(0x24a)](_0x339d35(0x18f)+_0x5a564e['id']);return;}const _0x122c7f=_0x1fb7ae==='PAID'?_0x339d35(0x1c7):_0x339d35(0x14e);let _0xe55406=[];if(_0x1c8098[_0x339d35(0x21e)])try{_0xe55406=Array[_0x339d35(0x22f)](_0x1c8098[_0x339d35(0x21e)])?_0x1c8098[_0x339d35(0x21e)]:JSON[_0x339d35(0x1dc)](_0x1c8098[_0x339d35(0x21e)]);}catch(_0x447930){console[_0x339d35(0x250)](_0x339d35(0x12c),_0x447930),_0xe55406=[];}if(!_0xe55406[_0x339d35(0x1f5)](_0x122c7f)){console[_0x339d35(0x24a)](_0x339d35(0x1e8)+_0x122c7f+'\x20not\x20enabled\x20for\x20shop\x20'+_0x5a564e['id']);return;}const _0x54ba42={'event':_0x122c7f,'payment':{'id':_0x6180d8['id'],'order_id':_0x6180d8['orderId'],'gateway_order_id':_0x6180d8[_0x339d35(0x1ae)],'gateway':_0x339d35(0x1aa),'amount':_0x6180d8[_0x339d35(0x128)],'currency':_0x6180d8[_0x339d35(0x149)],'status':_0x1fb7ae[_0x339d35(0x19a)](),'customer_email':_0x6180d8['customerEmail'],'customer_name':_0x6180d8['customerName'],'created_at':_0x6180d8[_0x339d35(0x17c)],'updated_at':new Date()}},_0x3e2f7d=await fetch(_0x1c8098[_0x339d35(0x13e)],{'method':_0x339d35(0x1d8),'headers':{'Content-Type':_0x339d35(0x20d),'User-Agent':_0x339d35(0x1ce)},'body':JSON[_0x339d35(0x213)](_0x54ba42)}),_0x702031=Date[_0x339d35(0x130)]()-_0xff2e05;loggerService_1['loggerService'][_0x339d35(0x1a2)](_0x6180d8[_0x339d35(0x1db)],_0x1c8098['webhookUrl'],_0x122c7f,_0x3e2f7d['status'],_0x702031,_0x54ba42),console['log'](_0x339d35(0x169)+_0x1c8098['webhookUrl']+_0x339d35(0x21d)+_0x3e2f7d[_0x339d35(0x234)]+'\x20('+_0x702031+_0x339d35(0x1d4));}catch(_0x4beeab){console['error']('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x4beeab),loggerService_1[_0x339d35(0x13c)][_0x339d35(0x253)](_0x6180d8[_0x339d35(0x1db)],_0x6180d8[_0x339d35(0x222)]?.[_0x339d35(0x1ff)]?.['webhookUrl']||_0x339d35(0x26c),_0x339d35(0x123),_0x4beeab,{});}}[a49_0x1a39f3(0x277)](_0x190e6e){const _0x5f4173=a49_0x1a39f3,_0x25becd=_0x190e6e[_0x5f4173(0x25b)](/[\s-]/g,'');if(_0x25becd[_0x5f4173(0x190)]<0x4)return'****';return _0x5f4173(0x26e)+_0x25becd[_0x5f4173(0x1e7)](-0x4);}async['processWebhook'](_0xca839,_0x355ab4=a49_0x1a39f3(0x254)){const _0x5d68fb=a49_0x1a39f3;console[_0x5d68fb(0x24a)](_0x5d68fb(0x1df),JSON[_0x5d68fb(0x213)](_0xca839,null,0x2));let _0x16e687=_0xca839,_0x3bd120=_0x355ab4;_0xca839[_0x5d68fb(0x12f)]?(_0x3bd120=_0xca839[_0x5d68fb(0x12f)]['toUpperCase']()==='VISA'?_0x5d68fb(0x1e9):_0x5d68fb(0x254),console[_0x5d68fb(0x24a)](_0x5d68fb(0x271)+_0x3bd120)):console[_0x5d68fb(0x24a)](_0x5d68fb(0x1f6)+_0x3bd120);if(_0xca839[_0x5d68fb(0x1b9)]&&_0xca839['key']&&_0xca839[_0x5d68fb(0x274)]){console[_0x5d68fb(0x24a)]('🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...');try{const _0x3774de=await this['decryptResponsePhp'](_0xca839[_0x5d68fb(0x1b9)],_0xca839[_0x5d68fb(0x272)],_0x3bd120);_0x16e687=JSON[_0x5d68fb(0x1dc)](_0x3774de),console[_0x5d68fb(0x24a)](_0x5d68fb(0x1a6)),console[_0x5d68fb(0x24a)](_0x5d68fb(0x227),JSON[_0x5d68fb(0x213)](_0x16e687,null,0x2));}catch(_0x45cba1){console['error'](_0x5d68fb(0x15c),_0x45cba1),console[_0x5d68fb(0x24a)](_0x5d68fb(0x14a)),_0x16e687=_0xca839;}}else console[_0x5d68fb(0x24a)]('📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0x3e884b='PENDING';if(_0x16e687['status']===0x64&&_0x16e687['final']===0x1)_0x3e884b=_0x5d68fb(0x1ac);else{if(_0x16e687['final']===0x0||!this[_0x5d68fb(0x212)](_0x16e687['status']))_0x3e884b=_0x5d68fb(0x12d);else _0x16e687[_0x5d68fb(0x1da)]===0x1||this[_0x5d68fb(0x212)](_0x16e687[_0x5d68fb(0x234)])?_0x3e884b=_0x5d68fb(0x225):_0x3e884b=_0x5d68fb(0x12d);}let _0x50b69f='';if(_0x16e687[_0x5d68fb(0x16c)])_0x50b69f=_0x16e687[_0x5d68fb(0x16c)]['toString'](),console[_0x5d68fb(0x24a)](_0x5d68fb(0x193)+_0x3bd120+_0x5d68fb(0x17f)+_0x50b69f);else _0x16e687[_0x5d68fb(0x1c8)]?(_0x50b69f=_0x16e687[_0x5d68fb(0x1c8)]['toString'](),console[_0x5d68fb(0x24a)](_0x5d68fb(0x193)+_0x3bd120+_0x5d68fb(0x23b)+_0x50b69f)):(_0x50b69f=_0x16e687['orderId']||_0x16e687[_0x5d68fb(0x279)]||_0x16e687['id']||'',console[_0x5d68fb(0x24a)](_0x5d68fb(0x19b)+_0x50b69f));console[_0x5d68fb(0x24a)](_0x5d68fb(0x273)+_0x3bd120+'\x20webhook\x20extracted\x20data:'),console['log'](_0x5d68fb(0x233)+_0x50b69f+_0x5d68fb(0x11e)+_0x16e687[_0x5d68fb(0x16c)]+_0x5d68fb(0x24c)+_0x16e687[_0x5d68fb(0x124)]+_0x5d68fb(0x223)+_0x16e687['payment_id']+',\x20paymentId='+_0x16e687['paymentId']+_0x5d68fb(0x1a3)+_0x16e687['id']+')'),console[_0x5d68fb(0x24a)](_0x5d68fb(0x19d)+_0x3e884b+_0x5d68fb(0x158)+_0x16e687['status']+_0x5d68fb(0x1e3)+_0x16e687[_0x5d68fb(0x1da)]+')'),console[_0x5d68fb(0x24a)](_0x5d68fb(0x155)+_0x16e687[_0x5d68fb(0x128)]),console[_0x5d68fb(0x24a)](_0x5d68fb(0x25c)+_0x16e687[_0x5d68fb(0x149)]);let _0x4ed479;_0x3e884b==='FAILED'&&(_0x4ed479=this[_0x5d68fb(0x182)](_0x16e687[_0x5d68fb(0x234)],_0x16e687[_0x5d68fb(0x18e)]),console[_0x5d68fb(0x24a)](_0x5d68fb(0x22a)+_0x4ed479));const _0x169a0f={'paymentId':_0x50b69f,'status':_0x3e884b,'amount':_0x16e687[_0x5d68fb(0x128)],'currency':_0x16e687[_0x5d68fb(0x149)]};return _0x4ed479&&(_0x169a0f[_0x5d68fb(0x1fe)]=_0x4ed479),_0x169a0f;}[a49_0x1a39f3(0x197)](){const _0x4cd833=a49_0x1a39f3;console['log'](_0x4cd833(0x172));const _0xfd53db=this[_0x4cd833(0x20f)]['size'];for(const [_0x3f1f5b]of this[_0x4cd833(0x20f)]){this[_0x4cd833(0x138)](_0x3f1f5b);}console[_0x4cd833(0x24a)](_0x4cd833(0x1f7)+_0xfd53db+_0x4cd833(0x201));}}exports[a49_0x1a39f3(0x1e4)]=VisaMasterCardService;