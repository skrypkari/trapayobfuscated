'use strict';const a57_0x5e14bf=a57_0x36d8;(function(_0x57d2be,_0x42ae89){const _0x2e002c=a57_0x36d8,_0xa2852b=_0x57d2be();while(!![]){try{const _0x206243=parseInt(_0x2e002c(0x2a3))/0x1*(-parseInt(_0x2e002c(0x278))/0x2)+parseInt(_0x2e002c(0x25a))/0x3*(-parseInt(_0x2e002c(0x1fe))/0x4)+-parseInt(_0x2e002c(0x27f))/0x5*(parseInt(_0x2e002c(0x218))/0x6)+-parseInt(_0x2e002c(0x2e1))/0x7+parseInt(_0x2e002c(0x306))/0x8*(-parseInt(_0x2e002c(0x26b))/0x9)+parseInt(_0x2e002c(0x27e))/0xa+parseInt(_0x2e002c(0x2fc))/0xb;if(_0x206243===_0x42ae89)break;else _0xa2852b['push'](_0xa2852b['shift']());}catch(_0x53e65b){_0xa2852b['push'](_0xa2852b['shift']());}}}(a57_0x296a,0x72077));function a57_0x296a(){const _0x49ddc4=['charAt','last_name','HTTP\x20error!\x20status:\x20','first_name','\x20MasterCard\x20status\x20check\x20timers','processWebhook','===\x20API\x20RESPONSE\x20===','Failed\x20to\x20decrypt\x20response',',\x20id=','6496378tyaJzz','loggerService','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','üìù\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','toUpperCase','üîê\x20VISA\x20Private\x20key\x20length:\x20','\x20with\x20status\x20','Status\x20Text:','POST','maskCardNumber','statusCheckTimers','description','Another\x20unknown\x20error','‚ùå\x20RSA\x20signing\x20failed:','Card\x20Holder:',',\x20paymentId=','Unsuccessful\x20payment','then','3DS\x20verification\x20required','Final:','üîê\x20AES\x20key\x20and\x20IV\x20generated','includes','‚ùå\x20Failed\x20to\x20decrypt\x20status\x20response:','Invalid\x20expiration\x20date','\x20\x20Cleaned:\x20\x20\x22','masterCardMerchantPointId','The\x20card\x20is\x20lost\x20or\x20stolen','31341970EkYegC','Payment\x20pending\x20verification','\x20(from:\x20status=','Payment\x20is\x20being\x20processed','Webhook\x20event\x20','number','üîê\x20Data\x20encrypted\x20with\x20AES','üîê\x20AES\x20IV\x20length:','createSign','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','16KAnKcT','now','customerName','üßπ\x20Clearing\x20','createDecipheriv','slice','Awaiting\x20confirmation\x20by\x20ivr\x20call','shopId','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','settings','utf8','text','üîç\x20Using\x20','‚ùå\x20RSA\x20encryption\x20failed:','\x20\x20\x20Currency:\x20',':\x20Unknown\x20status\x20code','logWhiteDomainResponse','configurable','trim','base64','\x20payment\x20status:\x20','üîê\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','LookUp\x20number\x20of\x20attempts\x20exceeded','__setModuleDefault','üõë\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','üîç\x20Using\x20provided\x20card\x20type:\x20','parse','Order\x20ID:','Amount:','Payment\x20System/1.0','üí≥\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','sendPaymentNotifications','get','Payment\x20System/1.0\x20(MasterCard)','error','from','create','warn','charge','\x20\x20\x20Payment\x20ID:\x20','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','üìù\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','decryptResponsePhp','substring','statusText','‚ùå\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','üîç\x20','RSA_PKCS1_PADDING','unknown','üìù\x20Decrypted\x20webhook\x20data:',',\x20payment_id=','info','logShopWebhookSent','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','forEach',',\x20Final:\x20','‚ö†Ô∏è\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Recipient\x20data\x20required','logWhiteDomainError','clearStatusTimers','VisaMasterCardService','none','length','PAID','/charge','PENDING','üìù\x20Encrypted\x20key\x20length:','üìù\x20Final\x20request\x20structure:','generateAESKey','‚è∞\x20Will\x20check\x20status\x20','FAILED','__createBinding','signRSA','masterCardApiUrl','webhookUrl','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','merchantPointId','failed',',\x20body:\x20','üí≥\x20Unknown\x20card\x20type\x20(starts\x20with\x20','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','aes-256-ctr','getDetailedErrorMessage','\x20is\x20final\x20(','Decryption\x20failed:\x20','\x20|\x20Response:\x20','Payment\x20confirmation\x20required','HTTP\x20','64JECdgB','end','‚úÖ\x20Status\x20response\x20decrypted\x20successfully','\x20\x20\x20-\x20merchant_point_id:','paid','readFileSync','üîê\x20MasterCard\x20API\x20URL:','Number\x20of\x20attempts\x20exceeded','headers','currency','Operation\x20completed\x20successfully','customerEmail','logShopWebhookError','üìù\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','order_id','üîê\x20VISA\x20Public\x20key\x20length:\x20','Payment\x20prohibited','psp_public.pem','stopAllStatusChecks','Cancellation\x20is\x20not\x20possible','PHP\x20decryptor\x20error','Request\x20data\x20error','LookUp\x20code\x20verified','path','üì¶\x20FULL\x20RESPONSE\x20BODY:','****\x20****\x20****\x20','252yPJLCR','validateKeyFiles','üîê\x20RSA\x20signing\x20successful','üîê\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','webhookEvents','/status_decrypt','===\x20PARSED\x20API\x20RESPONSE\x20===','publicKeyPath','‚ö†Ô∏è\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','Response\x20Headers:','/status','Error\x20parsing\x20webhook\x20events:','encryptAES','Return\x20URL:','3DS\x20URL:','expire_month','üìù\x20Signature\x20length:','\x20for\x20payment\x20','Sender\x27s\x20CVV\x20card\x20is\x20required','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','5000000000000000','status','The\x20card\x20does\x20not\x20exist','application/json','resolve','final','üîê\x20Data\x20signed\x20with\x20RSA','Test\x20payment','/status_decrypted','json','MASTERCARD','decryptAES','payment.failed','\x20\x20\x20-\x20info\x20length:','‚úÖ\x20MasterCard\x20key\x20files\x20validated\x20successfully','Cash\x20payment\x20is\x20expected\x20at\x20TCO','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','\x20(from:\x20order_id=','date_success','encryptRSA','Payment\x20returned','visaPrivateKeyPath','üîê\x20MasterCard\x20Private\x20key\x20length:\x20','private.pem','üìä\x20Status\x20check\x20#','defineProperty','post_code','isFinalStatus','visaMerchantPointId','LookUp\x20code\x20sent','\x20not\x20enabled\x20for\x20shop\x20','shop','Sender\x20information\x20required','amount','../telegramBotService','scheduleStatusChecks','/charge_raw','No\x20Error\x20executing\x20request','üîê\x20Response\x20is\x20encrypted,\x20decrypting...','sendShopWebhook','../loggerService','card_type','update','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','getCardTypeAndApi','39588NfpHHd','üîê\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','createCipheriv','üéØ\x20Using\x20','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','expire_year','\x20\x20\x20Amount:\x20','Unknown\x20error','visaPublicKeyPath','üí≥\x20VISA/MasterCard\x20service\x20initialized','VISA','\x20\x20\x20-\x20lang:\x20en','payment_id','payment.success','Card\x20Number:','üìä\x20Status\x20check\x20result:','Client\x20OTP\x20confirmation\x20required','1488429sZeWli','apiUrl','-----END','stringify','sign','üîê\x20AES\x20key\x20length:','toLowerCase','decryptResponse','constants','üîÑ\x20Processing\x20MasterCard\x20webhook\x20data:','checkPaymentStatus','üîê\x20VISA\x20Public\x20key\x20path:','Payment\x20cancellation\x20is\x20being\x20processed','18vRPaah','üìù\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','üßπ\x20Card\x20holder\x20names\x20cleaned:','logWhiteDomainRequest','üîê\x20VISA\x20API\x20URL:','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','2548080cHAqFd','84365JUytcd','paidAt','hasOwnProperty','existsSync','üìä\x20Checking\x20','payment','),\x20stopping\x20status\x20checks','call','Payment\x20ID:','message','Status\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','paymentStatuses','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','/charge_decrypted','paymentId','findUnique','\x20failed\x20for\x20payment\x20','join','Payment\x20confirmation\x20time\x20has\x20expired','__esModule','\x20\x20\x20Status:\x20','updatePaymentStatus','‚úÖ\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','üìù\x20Data\x20length:','‚ùå\x20PHP\x20decryptor\x20request\x20failed:','cwd','key','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','https://api.paydmeth.com/api','...','keys','-----BEGIN','toString','üîç\x20Using\x20fallback\x20fields\x20for\x20search:\x20','50933gQvaMQ','Failed\x20payment','Method\x20not\x20allowed','createdAt','\x20webhook\x20extracted\x20data:','Sender\x27s\x20card\x20details\x20are\x20required','3ds_url','getOwnPropertyDescriptor','‚ùå\x20Detailed\x20failure\x20description:\x20','\x20payment_id\x20for\x20search:\x20','\x20characters','orderId','failureMessage','),\x20defaulting\x20to\x20MasterCard','/status_raw','\x22\x20|\x20\x22','Status:','prototype','\x20result:','üîÑ\x20Converted\x20postcode\x20to\x20post_code:\x20','‚úÖ\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','push','cardType','postcode','Result\x20URL:','üìù\x20Data\x20to\x20sign\x20length:','__importStar','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','publicEncrypt','SHA256','‚ùå\x20Data\x20being\x20signed:','Error\x20details:','Failed\x20to\x20check\x20','randomBytes','sendPaymentNotification','üîç\x20Detected\x20card\x20type\x20from\x20webhook:\x20','\x20status\x20updated\x20to\x20','‚ö†Ô∏è\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','üîê\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','privateKeyPath','visaApiUrl','default','Expected\x20bitcoin\x20transfer\x20from\x20client','Captcha\x20confirmation\x20awaited','log','visa/mastercard','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','\x20status\x20timers\x20for\x20payment\x20','Insufficient\x20funds\x20on\x20the\x20card','\x20\x20\x20-\x20key\x20length:','cvv','üõë\x20Stopped\x20','replace'];a57_0x296a=function(){return _0x49ddc4;};return a57_0x296a();}var __createBinding=this&&this[a57_0x5e14bf(0x1ec)]||(Object[a57_0x5e14bf(0x32a)]?function(_0x21aadc,_0x3d8039,_0x526abf,_0x1a3cce){const _0x1b2a1c=a57_0x5e14bf;if(_0x1a3cce===undefined)_0x1a3cce=_0x526abf;var _0x52192c=Object[_0x1b2a1c(0x2aa)](_0x3d8039,_0x526abf);(!_0x52192c||('get'in _0x52192c?!_0x3d8039[_0x1b2a1c(0x294)]:_0x52192c['writable']||_0x52192c[_0x1b2a1c(0x317)]))&&(_0x52192c={'enumerable':!![],'get':function(){return _0x3d8039[_0x526abf];}}),Object[_0x1b2a1c(0x245)](_0x21aadc,_0x1a3cce,_0x52192c);}:function(_0x3d54db,_0x4a6bf2,_0x4973fb,_0x1e5782){if(_0x1e5782===undefined)_0x1e5782=_0x4973fb;_0x3d54db[_0x1e5782]=_0x4a6bf2[_0x4973fb];}),__setModuleDefault=this&&this[a57_0x5e14bf(0x31d)]||(Object[a57_0x5e14bf(0x32a)]?function(_0x4062ab,_0x5adeae){Object['defineProperty'](_0x4062ab,'default',{'enumerable':!![],'value':_0x5adeae});}:function(_0x3e751e,_0x33aaa5){const _0x5e1cda=a57_0x5e14bf;_0x3e751e[_0x5e1cda(0x2cc)]=_0x33aaa5;}),__importStar=this&&this[a57_0x5e14bf(0x2bd)]||(function(){var _0x2f9e3b=function(_0x5450cf){return _0x2f9e3b=Object['getOwnPropertyNames']||function(_0xdf308a){const _0x310487=a57_0x36d8;var _0x5dab18=[];for(var _0x45c008 in _0xdf308a)if(Object[_0x310487(0x2b4)][_0x310487(0x281)][_0x310487(0x286)](_0xdf308a,_0x45c008))_0x5dab18[_0x5dab18[_0x310487(0x1e3)]]=_0x45c008;return _0x5dab18;},_0x2f9e3b(_0x5450cf);};return function(_0xcf0565){const _0x182282=a57_0x36d8;if(_0xcf0565&&_0xcf0565['__esModule'])return _0xcf0565;var _0x4b4991={};if(_0xcf0565!=null){for(var _0x460fd8=_0x2f9e3b(_0xcf0565),_0x168e4a=0x0;_0x168e4a<_0x460fd8[_0x182282(0x1e3)];_0x168e4a++)if(_0x460fd8[_0x168e4a]!==_0x182282(0x2cc))__createBinding(_0x4b4991,_0xcf0565,_0x460fd8[_0x168e4a]);}return __setModuleDefault(_0x4b4991,_0xcf0565),_0x4b4991;};}()),__importDefault=this&&this['__importDefault']||function(_0xeb952){const _0x56230f=a57_0x5e14bf;return _0xeb952&&_0xeb952[_0x56230f(0x294)]?_0xeb952:{'default':_0xeb952};};function a57_0x36d8(_0x1aabec,_0x34a09b){_0x1aabec=_0x1aabec-0x1e1;const _0x296a3b=a57_0x296a();let _0x36d8a9=_0x296a3b[_0x1aabec];return _0x36d8a9;}Object['defineProperty'](exports,a57_0x5e14bf(0x294),{'value':!![]}),exports[a57_0x5e14bf(0x1e1)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a57_0x5e14bf(0x215))),loggerService_1=require(a57_0x5e14bf(0x254));class VisaMasterCardService{constructor(){const _0x2fcdfb=a57_0x5e14bf;this[_0x2fcdfb(0x2eb)]=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':'No\x20New\x20payment'},0x1:{'final':![],'description':_0x2fcdfb(0x251)},0x2:{'final':!![],'description':_0x2fcdfb(0x213)},0x3:{'final':!![],'description':_0x2fcdfb(0x2ed)},0x4:{'final':!![],'description':_0x2fcdfb(0x2f1)},0x5:{'final':!![],'description':_0x2fcdfb(0x258)},0x6:{'final':!![],'description':_0x2fcdfb(0x240)},0x7:{'final':!![],'description':_0x2fcdfb(0x233)},0x8:{'final':![],'description':_0x2fcdfb(0x26a)},0x9:{'final':![],'description':_0x2fcdfb(0x2f3)},0xa:{'final':![],'description':_0x2fcdfb(0x22a)},0xb:{'final':![],'description':_0x2fcdfb(0x24c)},0xc:{'final':![],'description':_0x2fcdfb(0x33f)},0xd:{'final':![],'description':_0x2fcdfb(0x30e)},0xe:{'final':![],'description':_0x2fcdfb(0x30c)},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':_0x2fcdfb(0x2ce)},0x11:{'final':![],'description':'Awaiting\x20confirmation\x20of\x20the\x20login\x20password'},0x12:{'final':![],'description':'Awaiting\x20confirmation\x20in\x20the\x20application'},0x13:{'final':![],'description':_0x2fcdfb(0x2ff)},0x14:{'final':![],'description':_0x2fcdfb(0x29c)},0x15:{'final':![],'description':_0x2fcdfb(0x2cd)},0x16:{'final':![],'description':_0x2fcdfb(0x2fd)},0x18:{'final':![],'description':_0x2fcdfb(0x1f0)},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':_0x2fcdfb(0x23b)},0x1b:{'final':![],'description':_0x2fcdfb(0x2d1)},0x1c:{'final':![],'description':_0x2fcdfb(0x1f6)},0x1d:{'final':![],'description':_0x2fcdfb(0x32e)},0x1f:{'final':![],'description':_0x2fcdfb(0x25e)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':_0x2fcdfb(0x2a8)},0x24:{'final':!![],'description':_0x2fcdfb(0x293)},0x25:{'final':!![],'description':_0x2fcdfb(0x20e)},0x26:{'final':!![],'description':'The\x20payment\x20status\x20must\x20be\x20clarified\x20manually'},0x27:{'final':!![],'description':_0x2fcdfb(0x2d3)},0x28:{'final':!![],'description':_0x2fcdfb(0x22e)},0x29:{'final':!![],'description':_0x2fcdfb(0x2fb)},0x2a:{'final':!![],'description':_0x2fcdfb(0x2f8)},0x2b:{'final':!![],'description':'Transaction\x20limit\x20exceeded'},0x2c:{'final':!![],'description':_0x2fcdfb(0x23c)},0x2d:{'final':!![],'description':_0x2fcdfb(0x2a4)},0x2e:{'final':!![],'description':_0x2fcdfb(0x2f1)},0x2f:{'final':!![],'description':_0x2fcdfb(0x2f1)},0x30:{'final':!![],'description':_0x2fcdfb(0x1f5)},0x31:{'final':![],'description':_0x2fcdfb(0x1fc)},0x32:{'final':!![],'description':_0x2fcdfb(0x2a5)},0x33:{'final':!![],'description':_0x2fcdfb(0x2a4)},0x34:{'final':!![],'description':'Failed\x20payment'},0x35:{'final':!![],'description':_0x2fcdfb(0x2a4)},0x36:{'final':!![],'description':_0x2fcdfb(0x2a4)},0x37:{'final':!![],'description':_0x2fcdfb(0x2a4)},0x38:{'final':!![],'description':_0x2fcdfb(0x211)},0x39:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank'},0x3a:{'final':![],'description':_0x2fcdfb(0x249)},0x3b:{'final':!![],'description':_0x2fcdfb(0x214)},0x3c:{'final':!![],'description':_0x2fcdfb(0x205)},0x3d:{'final':!![],'description':'Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible'},0x3e:{'final':!![],'description':_0x2fcdfb(0x2e3)},0x3f:{'final':!![],'description':_0x2fcdfb(0x240)},0x40:{'final':![],'description':'LookUp\x20not\x20confirmed'},0x41:{'final':!![],'description':_0x2fcdfb(0x31c)},0x42:{'final':![],'description':_0x2fcdfb(0x277)},0x43:{'final':!![],'description':_0x2fcdfb(0x257)},0x44:{'final':![],'description':'3DS\x20verification\x20required'},0x45:{'final':!![],'description':'Failed\x20payment'},0x46:{'final':!![],'description':_0x2fcdfb(0x2a4)},0x47:{'final':!![],'description':'Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details'},0x64:{'final':!![],'description':_0x2fcdfb(0x208)}},this[_0x2fcdfb(0x1ee)]='https://api.myatranz.com/api',this[_0x2fcdfb(0x2fa)]=0x50ca,this[_0x2fcdfb(0x2ca)]=path_1['default'][_0x2fcdfb(0x292)](process[_0x2fcdfb(0x29a)](),_0x2fcdfb(0x29f),_0x2fcdfb(0x243)),this['publicKeyPath']=path_1['default'][_0x2fcdfb(0x292)](process[_0x2fcdfb(0x29a)](),_0x2fcdfb(0x29f),_0x2fcdfb(0x20f)),this[_0x2fcdfb(0x2cb)]=_0x2fcdfb(0x29d),this[_0x2fcdfb(0x248)]=0x6b7,this[_0x2fcdfb(0x241)]=path_1[_0x2fcdfb(0x2cc)][_0x2fcdfb(0x292)](process[_0x2fcdfb(0x29a)](),_0x2fcdfb(0x29f),'visa_private.pem'),this['visaPublicKeyPath']=path_1['default'][_0x2fcdfb(0x292)](process[_0x2fcdfb(0x29a)](),'keys','visa_public.pem'),console['log'](_0x2fcdfb(0x263)),console['log'](_0x2fcdfb(0x204),this[_0x2fcdfb(0x1ee)]),console[_0x2fcdfb(0x2cf)](_0x2fcdfb(0x27c),this['visaApiUrl']),console[_0x2fcdfb(0x2cf)]('üîê\x20MasterCard\x20Private\x20key\x20path:',this[_0x2fcdfb(0x2ca)]),console[_0x2fcdfb(0x2cf)]('üîê\x20MasterCard\x20Public\x20key\x20path:',this[_0x2fcdfb(0x21f)]),console[_0x2fcdfb(0x2cf)]('üîê\x20VISA\x20Private\x20key\x20path:',this[_0x2fcdfb(0x241)]),console[_0x2fcdfb(0x2cf)](_0x2fcdfb(0x276),this[_0x2fcdfb(0x262)]),this[_0x2fcdfb(0x219)]();}[a57_0x5e14bf(0x1f8)](_0x414f63,_0x1c148e){const _0x457fff=a57_0x5e14bf,_0x56b467=this[_0x457fff(0x28b)][_0x414f63];let _0x171a07='';_0x56b467?_0x171a07=_0x457fff(0x289)+_0x414f63+':\x20'+_0x56b467[_0x457fff(0x2ec)]:_0x171a07=_0x457fff(0x289)+_0x414f63+_0x457fff(0x315);if(_0x1c148e&&_0x1c148e[_0x457fff(0x318)]()){const _0x248461=_0x1c148e[_0x457fff(0x318)]();(!_0x56b467||_0x248461[_0x457fff(0x271)]()!==_0x56b467[_0x457fff(0x2ec)][_0x457fff(0x271)]())&&(_0x171a07+=_0x457fff(0x1fb)+_0x248461);}return _0x171a07;}[a57_0x5e14bf(0x247)](_0x99a336){const _0x5d5300=a57_0x5e14bf,_0x9316e4=this[_0x5d5300(0x28b)][_0x99a336];return _0x9316e4?_0x9316e4['final']:!![];}['getCardTypeAndApi'](_0x3a0d9b){const _0x532517=a57_0x5e14bf,_0xbc3b91=_0x3a0d9b[_0x532517(0x2d8)](0x0);if(_0xbc3b91==='4')return console['log'](_0x532517(0x324)),{'cardType':_0x532517(0x264),'apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x532517(0x241)],'publicKeyPath':this[_0x532517(0x262)],'merchantPointId':this[_0x532517(0x248)]};else return _0xbc3b91==='5'?(console['log']('üí≥\x20Detected\x20MasterCard\x20(starts\x20with\x205)'),{'cardType':_0x532517(0x236),'apiUrl':this[_0x532517(0x1ee)],'privateKeyPath':this[_0x532517(0x2ca)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x532517(0x2fa)]}):(console[_0x532517(0x2cf)](_0x532517(0x1f4)+_0xbc3b91+_0x532517(0x2b0)),{'cardType':_0x532517(0x236),'apiUrl':this[_0x532517(0x1ee)],'privateKeyPath':this[_0x532517(0x2ca)],'publicKeyPath':this[_0x532517(0x21f)],'merchantPointId':this['masterCardMerchantPointId']});}[a57_0x5e14bf(0x219)](){const _0x5eb5c8=a57_0x5e14bf;try{if(!fs_1[_0x5eb5c8(0x2cc)][_0x5eb5c8(0x282)](this[_0x5eb5c8(0x2ca)]))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this[_0x5eb5c8(0x2ca)]);if(!fs_1[_0x5eb5c8(0x2cc)][_0x5eb5c8(0x282)](this['publicKeyPath']))throw new Error(_0x5eb5c8(0x22b)+this['publicKeyPath']);const _0x318104=fs_1[_0x5eb5c8(0x2cc)]['readFileSync'](this[_0x5eb5c8(0x2ca)],'utf8')['trim'](),_0x21b00c=fs_1[_0x5eb5c8(0x2cc)]['readFileSync'](this[_0x5eb5c8(0x21f)],'utf8')[_0x5eb5c8(0x318)]();if(!_0x318104['includes']('-----BEGIN')||!_0x318104[_0x5eb5c8(0x2f6)](_0x5eb5c8(0x26d)))throw new Error(_0x5eb5c8(0x305));if(!_0x21b00c['includes'](_0x5eb5c8(0x2a0))||!_0x21b00c[_0x5eb5c8(0x2f6)](_0x5eb5c8(0x26d)))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x5eb5c8(0x2cf)](_0x5eb5c8(0x23a)),console['log'](_0x5eb5c8(0x242)+_0x318104['length']+_0x5eb5c8(0x2ad)),console[_0x5eb5c8(0x2cf)]('üîê\x20MasterCard\x20Public\x20key\x20length:\x20'+_0x21b00c[_0x5eb5c8(0x1e3)]+_0x5eb5c8(0x2ad));if(fs_1[_0x5eb5c8(0x2cc)]['existsSync'](this['visaPrivateKeyPath'])&&fs_1['default'][_0x5eb5c8(0x282)](this['visaPublicKeyPath'])){const _0x4a61d2=fs_1[_0x5eb5c8(0x2cc)][_0x5eb5c8(0x203)](this[_0x5eb5c8(0x241)],_0x5eb5c8(0x310))[_0x5eb5c8(0x318)](),_0x384ae1=fs_1[_0x5eb5c8(0x2cc)][_0x5eb5c8(0x203)](this[_0x5eb5c8(0x262)],'utf8')[_0x5eb5c8(0x318)]();(!_0x4a61d2[_0x5eb5c8(0x2f6)](_0x5eb5c8(0x2a0))||!_0x4a61d2[_0x5eb5c8(0x2f6)](_0x5eb5c8(0x26d)))&&console[_0x5eb5c8(0x32b)](_0x5eb5c8(0x33e)),(!_0x384ae1[_0x5eb5c8(0x2f6)]('-----BEGIN')||!_0x384ae1['includes'](_0x5eb5c8(0x26d)))&&console['warn'](_0x5eb5c8(0x2c8)),console[_0x5eb5c8(0x2cf)]('‚úÖ\x20VISA\x20key\x20files\x20validated\x20successfully'),console[_0x5eb5c8(0x2cf)](_0x5eb5c8(0x2e6)+_0x4a61d2[_0x5eb5c8(0x1e3)]+_0x5eb5c8(0x2ad)),console[_0x5eb5c8(0x2cf)](_0x5eb5c8(0x20d)+_0x384ae1['length']+_0x5eb5c8(0x2ad));}else console[_0x5eb5c8(0x32b)](_0x5eb5c8(0x220)),console['warn']('‚ö†Ô∏è\x20Expected\x20VISA\x20private\x20key:\x20'+this['visaPrivateKeyPath']),console['warn']('‚ö†Ô∏è\x20Expected\x20VISA\x20public\x20key:\x20'+this[_0x5eb5c8(0x262)]);}catch(_0x1e0240){console[_0x5eb5c8(0x328)]('‚ùå\x20VISA/MasterCard\x20key\x20validation\x20failed:',_0x1e0240);throw _0x1e0240;}}[a57_0x5e14bf(0x1e9)](){const _0x4cf3a3=a57_0x5e14bf,_0x5a428c=crypto_1[_0x4cf3a3(0x2cc)]['randomBytes'](0x20),_0x3da5d4=crypto_1[_0x4cf3a3(0x2cc)][_0x4cf3a3(0x2c4)](0x10);return{'key':_0x5a428c,'iv':_0x3da5d4};}[a57_0x5e14bf(0x224)](_0x187036,_0x437a92,_0x70502a){const _0x1f3032=a57_0x5e14bf,_0x4fde74=crypto_1[_0x1f3032(0x2cc)][_0x1f3032(0x25c)](_0x1f3032(0x1f7),_0x437a92,_0x70502a);let _0x3bd99f=_0x4fde74[_0x1f3032(0x256)](_0x187036,'utf8','base64');return _0x3bd99f+=_0x4fde74[_0x1f3032(0x231)]('base64'),_0x3bd99f;}[a57_0x5e14bf(0x23f)](_0x448e99,_0x1f6e45,_0x36a3a6){const _0x3476cb=a57_0x5e14bf;try{const _0x99f105=fs_1[_0x3476cb(0x2cc)][_0x3476cb(0x203)](_0x36a3a6,_0x3476cb(0x310))['trim'](),_0x365e5f={'iv':_0x1f6e45[_0x3476cb(0x2a1)](_0x3476cb(0x319)),'key':_0x448e99[_0x3476cb(0x2a1)]('base64')},_0x25f501=JSON[_0x3476cb(0x26e)](_0x365e5f);console[_0x3476cb(0x2cf)](_0x3476cb(0x25b),_0x25f501[_0x3476cb(0x1e3)]);const _0x3ca4df=crypto_1[_0x3476cb(0x2cc)][_0x3476cb(0x2bf)]({'key':_0x99f105,'padding':crypto_1[_0x3476cb(0x2cc)][_0x3476cb(0x273)][_0x3476cb(0x335)]},Buffer[_0x3476cb(0x329)](_0x25f501));return console['log'](_0x3476cb(0x297),_0x3ca4df['length']),_0x3ca4df[_0x3476cb(0x2a1)](_0x3476cb(0x319));}catch(_0x5af685){console[_0x3476cb(0x328)](_0x3476cb(0x313),_0x5af685);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a57_0x5e14bf(0x1ed)](_0x4e0d7f,_0x3e8e26){const _0x594544=a57_0x5e14bf;try{const _0x2a8653=fs_1[_0x594544(0x2cc)][_0x594544(0x203)](_0x3e8e26,'utf8')[_0x594544(0x318)](),_0x146f59=crypto_1[_0x594544(0x2cc)][_0x594544(0x304)](_0x594544(0x2c0));_0x146f59[_0x594544(0x256)](_0x4e0d7f),_0x146f59[_0x594544(0x1ff)]();const _0x32758d=_0x146f59['sign'](_0x2a8653,_0x594544(0x319));return console[_0x594544(0x2cf)](_0x594544(0x21a)),console[_0x594544(0x2cf)](_0x594544(0x2bc),_0x4e0d7f[_0x594544(0x1e3)]),console[_0x594544(0x2cf)](_0x594544(0x228),_0x32758d[_0x594544(0x1e3)]),_0x32758d;}catch(_0x4db997){console['error'](_0x594544(0x2ee),_0x4db997),console['error'](_0x594544(0x2c1),_0x4e0d7f[_0x594544(0x331)](0x0,0xc8)+_0x594544(0x29e));throw new Error(_0x594544(0x28d));}}['decryptAES'](_0x32b2be,_0x287b3e,_0x4f76a8){const _0x16cbca=a57_0x5e14bf,_0x4ac375=crypto_1[_0x16cbca(0x2cc)][_0x16cbca(0x30a)](_0x16cbca(0x1f7),_0x287b3e,_0x4f76a8);let _0x122117=_0x4ac375['update'](_0x32b2be,_0x16cbca(0x319),_0x16cbca(0x310));return _0x122117+=_0x4ac375[_0x16cbca(0x231)](_0x16cbca(0x310)),_0x122117;}async['decryptResponsePhp'](_0x5f31b4,_0x3c2b4a,_0x4feb4b=a57_0x5e14bf(0x236)){const _0x3625a2=a57_0x5e14bf;try{const _0x1cbe32=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x3625a2(0x2e9),'headers':{'Content-Type':_0x3625a2(0x22f)},'body':JSON[_0x3625a2(0x26e)]({'info':_0x5f31b4,'key':_0x3c2b4a,'card_type':_0x4feb4b[_0x3625a2(0x271)]()})});if(!_0x1cbe32['ok'])throw new Error(_0x3625a2(0x212));return await _0x1cbe32[_0x3625a2(0x311)]();}catch(_0x5489f6){console[_0x3625a2(0x328)](_0x3625a2(0x299),_0x5489f6);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a57_0x5e14bf(0x272)](_0x522d77,_0x5c3e6a){const _0x5a0892=a57_0x5e14bf;try{const _0x19965b=fs_1[_0x5a0892(0x2cc)][_0x5a0892(0x203)](this[_0x5a0892(0x2ca)],'utf8')[_0x5a0892(0x318)](),_0x533e2c=crypto_1['default']['privateDecrypt'](_0x19965b,Buffer[_0x5a0892(0x329)](_0x5c3e6a,_0x5a0892(0x319))),_0x5a8621=JSON[_0x5a0892(0x320)](_0x533e2c['toString']()),_0x1be299=Buffer[_0x5a0892(0x329)](_0x5a8621[_0x5a0892(0x29b)],'base64'),_0x4b2a58=Buffer[_0x5a0892(0x329)](_0x5a8621['iv'],'base64');return this[_0x5a0892(0x237)](_0x522d77,_0x1be299,_0x4b2a58);}catch(_0x59f73a){throw new Error(_0x5a0892(0x2df));}}async['processCardPayment'](_0x5c348c){const _0x506087=a57_0x5e14bf,{paymentId:_0x321cbc,orderId:_0x2edc9c,amount:_0x5580c3,currency:_0x46f583,cardData:_0x1a4718,resultUrl:_0x212217,returnUrl:_0x4a187b,cardHolder:_0x11b8d3,browser:_0x17ee1d}=_0x5c348c;console['log'](_0x506087(0x2be)),console['log'](_0x506087(0x287),_0x321cbc),console['log'](_0x506087(0x321),_0x2edc9c),console[_0x506087(0x2cf)](_0x506087(0x322),_0x5580c3,_0x46f583),console[_0x506087(0x2cf)](_0x506087(0x268),this[_0x506087(0x2ea)](_0x1a4718[_0x506087(0x301)])),console[_0x506087(0x2cf)](_0x506087(0x2ef),_0x11b8d3[_0x506087(0x2db)]+'\x20'+_0x11b8d3[_0x506087(0x2d9)]),console[_0x506087(0x2cf)](_0x506087(0x225),_0x4a187b),console['log'](_0x506087(0x2bb),_0x212217);const _0x476e39=this['getCardTypeAndApi'](_0x1a4718[_0x506087(0x301)]);console['log'](_0x506087(0x25d)+_0x476e39['cardType']+'\x20API:\x20'+_0x476e39[_0x506087(0x26c)]),console[_0x506087(0x2cf)]('üîê\x20Using\x20keys:\x20'+_0x476e39['privateKeyPath']+',\x20'+_0x476e39[_0x506087(0x21f)]);const _0x1b470b={..._0x11b8d3,'first_name':_0x11b8d3[_0x506087(0x2db)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x506087(0x318)]()||'','last_name':_0x11b8d3[_0x506087(0x2d9)]?.[_0x506087(0x2d7)](/[\t\n\r\f\v]/g,'\x20')[_0x506087(0x318)]()||''};'postcode'in _0x1b470b&&!(_0x506087(0x246)in _0x1b470b)&&(_0x1b470b[_0x506087(0x246)]=_0x1b470b['postcode'],delete _0x1b470b[_0x506087(0x2ba)],console[_0x506087(0x2cf)](_0x506087(0x2b6)+_0x1b470b[_0x506087(0x246)]));console[_0x506087(0x2cf)](_0x506087(0x27a)),console[_0x506087(0x2cf)]('\x20\x20Original:\x20\x22'+_0x11b8d3[_0x506087(0x2db)]+_0x506087(0x2b2)+_0x11b8d3[_0x506087(0x2d9)]+'\x22'),console[_0x506087(0x2cf)](_0x506087(0x2f9)+_0x1b470b[_0x506087(0x2db)]+_0x506087(0x2b2)+_0x1b470b[_0x506087(0x2d9)]+'\x22'),console[_0x506087(0x2cf)]('üìç\x20Full\x20card\x20holder\x20data:',JSON[_0x506087(0x26e)](_0x1b470b,null,0x2));const _0x4e9a6f={'amount':_0x5580c3,'currency':_0x46f583[_0x506087(0x2e5)](),'order_id':_0x2edc9c,'result_url':_0x212217,'return_url':_0x4a187b,'country':'','card':{'number':_0x1a4718[_0x506087(0x301)],'expire_month':_0x1a4718[_0x506087(0x227)],'expire_year':_0x1a4718[_0x506087(0x25f)],'cvv':_0x1a4718[_0x506087(0x2d5)]},'card_holder':_0x1b470b,'browser':_0x17ee1d},_0xc6c715=JSON[_0x506087(0x26e)](_0x4e9a6f);console[_0x506087(0x2cf)]('üíæ\x20Payment\x20data\x20prepared'),console[_0x506087(0x2cf)](_0x506087(0x2e4)),console['log'](_0xc6c715),console[_0x506087(0x2cf)](_0x506087(0x298),_0xc6c715[_0x506087(0x1e3)]);try{const {key:_0x1c24af,iv:_0x152a00}=this[_0x506087(0x1e9)]();console[_0x506087(0x2cf)](_0x506087(0x2f5)),console[_0x506087(0x2cf)](_0x506087(0x270),_0x1c24af[_0x506087(0x1e3)]),console['log'](_0x506087(0x303),_0x152a00[_0x506087(0x1e3)]);const _0xa34f95=this[_0x506087(0x224)](_0xc6c715,_0x1c24af,_0x152a00);console['log'](_0x506087(0x302)),console[_0x506087(0x2cf)]('üìù\x20Encrypted\x20data\x20length:',_0xa34f95[_0x506087(0x1e3)]);const _0x31f39c=this['encryptRSA'](_0x1c24af,_0x152a00,_0x476e39['publicKeyPath']);console['log'](_0x506087(0x31b)),console[_0x506087(0x2cf)](_0x506087(0x1e7),_0x31f39c[_0x506087(0x1e3)]);const _0x42b65f=this[_0x506087(0x1ed)](_0xc6c715,_0x476e39[_0x506087(0x2ca)]);console['log'](_0x506087(0x232)),console[_0x506087(0x2cf)](_0x506087(0x228),_0x42b65f[_0x506087(0x1e3)]);const _0x34499e={'merchant_point_id':_0x476e39[_0x506087(0x1f1)],'method':'charge','info':_0xa34f95,'key':_0x31f39c,'sign':_0x42b65f,'lang':'en'};console['log']('üì§\x20Sending\x20request\x20to\x20API...'),console[_0x506087(0x2cf)](_0x506087(0x1e8)),console['log'](_0x506087(0x201),_0x476e39[_0x506087(0x1f1)]),console[_0x506087(0x2cf)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x506087(0x2cf)](_0x506087(0x239),_0xa34f95[_0x506087(0x1e3)]),console[_0x506087(0x2cf)](_0x506087(0x2d4),_0x31f39c[_0x506087(0x1e3)]),console[_0x506087(0x2cf)]('\x20\x20\x20-\x20sign\x20length:',_0x42b65f[_0x506087(0x1e3)]),console[_0x506087(0x2cf)](_0x506087(0x265)),console[_0x506087(0x2cf)](''),console['log']('üì¶\x20FULL\x20REQUEST\x20JSON:'),console[_0x506087(0x2cf)](JSON[_0x506087(0x26e)](_0x34499e,null,0x2)),console[_0x506087(0x2cf)](''),loggerService_1[_0x506087(0x2e2)][_0x506087(0x27b)](_0x476e39[_0x506087(0x2b9)][_0x506087(0x271)](),_0x506087(0x1e5),_0x506087(0x2e9),{'merchant_point_id':_0x476e39[_0x506087(0x1f1)],'method':_0x506087(0x32c),'lang':'en'});const _0x1c781d=Date[_0x506087(0x307)](),_0x32531d=await fetch(_0x476e39['apiUrl'],{'method':_0x506087(0x2e9),'headers':{'Content-Type':_0x506087(0x22f),'Accept':_0x506087(0x22f),'User-Agent':_0x506087(0x323)},'body':JSON[_0x506087(0x26e)](_0x34499e)}),_0x3590e5=Date[_0x506087(0x307)]()-_0x1c781d;console[_0x506087(0x2cf)](_0x506087(0x2de)),console['log'](_0x506087(0x2b3),_0x32531d[_0x506087(0x22d)]),console[_0x506087(0x2cf)](_0x506087(0x2e8),_0x32531d[_0x506087(0x332)]),console[_0x506087(0x2cf)]('Response\x20Time:',_0x3590e5+'ms'),console[_0x506087(0x2cf)](_0x506087(0x221)),_0x32531d[_0x506087(0x206)]['forEach']((_0x73f628,_0x3978d2)=>{const _0x37be39=_0x506087;console[_0x37be39(0x2cf)]('\x20\x20\x20'+_0x3978d2+':\x20'+_0x73f628);}),console[_0x506087(0x2cf)]('');if(!_0x32531d['ok']){const _0x1f5629=await _0x32531d['text']();console[_0x506087(0x328)]('HTTP\x20Status:',_0x32531d[_0x506087(0x22d)]),console['error'](_0x506087(0x216)),console[_0x506087(0x328)](_0x1f5629),console[_0x506087(0x328)](''),loggerService_1[_0x506087(0x2e2)][_0x506087(0x316)](_0x476e39[_0x506087(0x2b9)][_0x506087(0x271)](),'/charge_raw',_0x32531d[_0x506087(0x22d)],_0x1f5629,_0x3590e5),loggerService_1['loggerService'][_0x506087(0x340)](_0x476e39['cardType'][_0x506087(0x271)](),_0x506087(0x1e5),_0x506087(0x1fd)+_0x32531d[_0x506087(0x22d)]+':\x20'+_0x1f5629);throw new Error(_0x506087(0x2da)+_0x32531d[_0x506087(0x22d)]+_0x506087(0x1f3)+_0x1f5629);}const _0x3abcf2=await _0x32531d[_0x506087(0x235)]();console[_0x506087(0x2cf)]('üì¶\x20FULL\x20RESPONSE\x20JSON:'),console[_0x506087(0x2cf)](JSON[_0x506087(0x26e)](_0x3abcf2,null,0x2)),console[_0x506087(0x2cf)](''),loggerService_1[_0x506087(0x2e2)][_0x506087(0x316)](_0x476e39[_0x506087(0x2b9)][_0x506087(0x271)](),_0x506087(0x250),_0x32531d['status'],_0x3abcf2,_0x3590e5),console[_0x506087(0x2cf)](_0x506087(0x21e));let _0x13220e=_0x3abcf2;if(_0x3abcf2[_0x506087(0x339)]&&_0x3abcf2['key']&&_0x3abcf2[_0x506087(0x26f)]){console[_0x506087(0x2cf)](_0x506087(0x252));try{const _0x1fca00=await this[_0x506087(0x330)](_0x3abcf2[_0x506087(0x339)],_0x3abcf2['key'],_0x476e39[_0x506087(0x2b9)]);_0x13220e=JSON[_0x506087(0x320)](_0x1fca00),console[_0x506087(0x2cf)]('‚úÖ\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0x506087(0x2e2)][_0x506087(0x316)](_0x476e39[_0x506087(0x2b9)][_0x506087(0x271)](),'/charge_decrypted',_0x32531d[_0x506087(0x22d)],_0x13220e,_0x3590e5),console[_0x506087(0x2cf)](_0x506087(0x32f));}catch(_0xb05250){console[_0x506087(0x328)]('‚ùå\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0xb05250),loggerService_1[_0x506087(0x2e2)][_0x506087(0x340)](_0x476e39[_0x506087(0x2b9)][_0x506087(0x271)](),'/charge_decrypt',_0x506087(0x1fa)+_0xb05250),_0x13220e=_0x3abcf2;}}else loggerService_1[_0x506087(0x2e2)][_0x506087(0x316)](_0x476e39[_0x506087(0x2b9)][_0x506087(0x271)](),_0x506087(0x28e),_0x32531d[_0x506087(0x22d)],_0x13220e,_0x3590e5),console[_0x506087(0x2cf)]('üìù\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x506087(0x2cf)](_0x506087(0x2b3),_0x13220e['status']),console[_0x506087(0x2cf)](_0x506087(0x2f4),_0x13220e[_0x506087(0x231)]),console[_0x506087(0x2cf)](_0x506087(0x287),_0x13220e[_0x506087(0x266)]),console[_0x506087(0x2cf)](_0x506087(0x226),_0x13220e['3ds_url']||_0x506087(0x1e2));if(_0x13220e[_0x506087(0x22d)]===0x64&&_0x13220e[_0x506087(0x231)]===0x1)return console[_0x506087(0x2cf)]('‚úÖ\x20Payment\x20successful'),{'gateway_payment_id':_0x13220e['payment_id']?.[_0x506087(0x2a1)](),'payment_url':_0x4a187b,'requires_3ds':![],'status':_0x506087(0x1e4),'final':!![]};if(_0x13220e[_0x506087(0x2a9)])return console['log']('üîê\x203DS\x20verification\x20required'),this[_0x506087(0x24f)](_0x321cbc,_0x2edc9c,_0x13220e[_0x506087(0x266)]?.[_0x506087(0x2a1)]()||_0x2edc9c,_0x476e39['cardType']),{'gateway_payment_id':_0x13220e['payment_id']?.['toString'](),'payment_url':_0x13220e[_0x506087(0x2a9)],'requires_3ds':!![],'threeds_url':_0x13220e[_0x506087(0x2a9)],'status':'PENDING','final':![]};let _0x3b2693=this[_0x506087(0x1f8)](_0x13220e['status'],_0x13220e['desc']||_0x13220e['message']),_0x158504=_0x13220e[_0x506087(0x22d)],_0x3b2d4d=this[_0x506087(0x247)](_0x13220e[_0x506087(0x22d)]);return console[_0x506087(0x2cf)]('‚ùå\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x158504+_0x506087(0x33d)+_0x3b2d4d+',\x20Desc:\x20'+_0x3b2693),{'gateway_payment_id':_0x13220e[_0x506087(0x266)]?.['toString'](),'payment_url':_0x4a187b,'requires_3ds':![],'status':_0x506087(0x1eb),'final':!![],'errorMessage':_0x3b2693};}catch(_0x4c23ff){console[_0x506087(0x328)](_0x506087(0x27d)),console[_0x506087(0x328)](_0x506087(0x2c2),_0x4c23ff),loggerService_1[_0x506087(0x2e2)]['logWhiteDomainError'](_0x506087(0x2d0),'/charge',_0x4c23ff);throw new Error(_0x506087(0x28c)+(_0x4c23ff instanceof Error?_0x4c23ff[_0x506087(0x288)]:_0x506087(0x261)));}}async[a57_0x5e14bf(0x275)](_0x303f26,_0x2812dd,_0x2c0bb7=a57_0x5e14bf(0x264)){const _0x5e7577=a57_0x5e14bf;console[_0x5e7577(0x2cf)](_0x5e7577(0x283)+_0x2c0bb7+'\x20payment\x20status:\x20'+_0x303f26+'\x20('+_0x2812dd+')');try{const _0x29a369={'payment_id':_0x303f26,'order_id':_0x2812dd},_0x2b3356=JSON[_0x5e7577(0x26e)](_0x29a369),_0x5a0cf=this[_0x5e7577(0x259)](_0x2c0bb7===_0x5e7577(0x264)?'4000000000000000':_0x5e7577(0x22c)),{key:_0x2f0e43,iv:_0x373bb4}=this[_0x5e7577(0x1e9)](),_0x155e4d=this[_0x5e7577(0x224)](_0x2b3356,_0x2f0e43,_0x373bb4),_0x4f0b43=this['encryptRSA'](_0x2f0e43,_0x373bb4,_0x5a0cf[_0x5e7577(0x21f)]),_0x1a8fba=this[_0x5e7577(0x1ed)](_0x2b3356,_0x5a0cf[_0x5e7577(0x2ca)]),_0x1fcc00={'merchant_point_id':_0x5a0cf[_0x5e7577(0x1f1)],'method':_0x5e7577(0x22d),'info':_0x155e4d,'key':_0x4f0b43,'sign':_0x1a8fba,'lang':'en'};loggerService_1[_0x5e7577(0x2e2)]['logWhiteDomainRequest'](_0x2c0bb7[_0x5e7577(0x271)](),_0x5e7577(0x222),_0x5e7577(0x2e9),{'merchant_point_id':_0x5a0cf[_0x5e7577(0x1f1)],'method':_0x5e7577(0x22d),'lang':'en'});const _0x490a2d=Date[_0x5e7577(0x307)](),_0x1f2a22=await fetch(_0x5a0cf[_0x5e7577(0x26c)],{'method':'POST','headers':{'Content-Type':_0x5e7577(0x22f),'Accept':_0x5e7577(0x22f),'User-Agent':_0x5e7577(0x323)},'body':JSON[_0x5e7577(0x26e)](_0x1fcc00)}),_0x48d86a=Date[_0x5e7577(0x307)]()-_0x490a2d;if(!_0x1f2a22['ok']){const _0x1fff97=await _0x1f2a22[_0x5e7577(0x311)]();loggerService_1[_0x5e7577(0x2e2)][_0x5e7577(0x316)](_0x2c0bb7['toLowerCase'](),'/status_raw',_0x1f2a22[_0x5e7577(0x22d)],_0x1fff97,_0x48d86a);throw new Error(_0x5e7577(0x2da)+_0x1f2a22[_0x5e7577(0x22d)]);}const _0x2f88d2=await _0x1f2a22[_0x5e7577(0x235)]();loggerService_1[_0x5e7577(0x2e2)][_0x5e7577(0x316)](_0x2c0bb7[_0x5e7577(0x271)](),_0x5e7577(0x2b1),_0x1f2a22[_0x5e7577(0x22d)],_0x2f88d2,_0x48d86a);let _0x24e0a6=_0x2f88d2;if(_0x2f88d2[_0x5e7577(0x339)]&&_0x2f88d2[_0x5e7577(0x29b)]&&_0x2f88d2[_0x5e7577(0x26f)]){console['log'](_0x5e7577(0x21b));try{const _0x2c087c=await this['decryptResponsePhp'](_0x2f88d2['info'],_0x2f88d2['key'],_0x2c0bb7);_0x24e0a6=JSON[_0x5e7577(0x320)](_0x2c087c),console[_0x5e7577(0x2cf)](_0x5e7577(0x200)),loggerService_1[_0x5e7577(0x2e2)][_0x5e7577(0x316)](_0x2c0bb7['toLowerCase'](),_0x5e7577(0x234),_0x1f2a22['status'],_0x24e0a6,_0x48d86a),console[_0x5e7577(0x2cf)](_0x5e7577(0x20b));}catch(_0x572deb){console[_0x5e7577(0x328)](_0x5e7577(0x2f7),_0x572deb),loggerService_1['loggerService'][_0x5e7577(0x340)](_0x2c0bb7[_0x5e7577(0x271)](),_0x5e7577(0x21d),'Status\x20decryption\x20failed:\x20'+_0x572deb),_0x24e0a6=_0x2f88d2;}}else loggerService_1['loggerService'][_0x5e7577(0x316)](_0x2c0bb7[_0x5e7577(0x271)](),_0x5e7577(0x234),_0x1f2a22[_0x5e7577(0x22d)],_0x24e0a6,_0x48d86a),console[_0x5e7577(0x2cf)](_0x5e7577(0x279));console[_0x5e7577(0x2cf)](_0x5e7577(0x269),{'status':_0x24e0a6[_0x5e7577(0x22d)],'final':_0x24e0a6[_0x5e7577(0x231)],'payment_id':_0x24e0a6[_0x5e7577(0x266)],'desc':_0x24e0a6['desc']});let _0x418997=_0x5e7577(0x1e6);if(_0x24e0a6[_0x5e7577(0x22d)]===0x64&&_0x24e0a6['final']===0x1)_0x418997=_0x5e7577(0x1e4);else{if(_0x24e0a6['final']===0x0||!this[_0x5e7577(0x247)](_0x24e0a6[_0x5e7577(0x22d)]))_0x418997='PENDING';else _0x24e0a6[_0x5e7577(0x231)]===0x1||this[_0x5e7577(0x247)](_0x24e0a6[_0x5e7577(0x22d)])?_0x418997=_0x5e7577(0x1eb):_0x418997=_0x5e7577(0x1e6);}const _0x33c8d2=this[_0x5e7577(0x1f8)](_0x24e0a6[_0x5e7577(0x22d)],_0x24e0a6['desc']);return{'status':_0x418997,'final':this[_0x5e7577(0x247)](_0x24e0a6[_0x5e7577(0x22d)]),'amount':_0x24e0a6[_0x5e7577(0x24d)],'currency':_0x24e0a6[_0x5e7577(0x207)],'date_success':_0x24e0a6[_0x5e7577(0x23e)],'description':_0x33c8d2};}catch(_0x2d7176){console[_0x5e7577(0x328)](_0x2c0bb7+'\x20status\x20check\x20error:',_0x2d7176),loggerService_1[_0x5e7577(0x2e2)][_0x5e7577(0x340)](_0x2c0bb7[_0x5e7577(0x271)](),_0x5e7577(0x222),_0x2d7176);throw new Error(_0x5e7577(0x2c3)+_0x2c0bb7+_0x5e7577(0x31a)+(_0x2d7176 instanceof Error?_0x2d7176[_0x5e7577(0x288)]:_0x5e7577(0x261)));}}[a57_0x5e14bf(0x24f)](_0x427d88,_0x161279,_0x5316c5,_0x4205c7){const _0x86b5a0=a57_0x5e14bf;console[_0x86b5a0(0x2cf)]('‚è∞\x20Scheduling\x20status\x20checks\x20for\x20'+_0x4205c7+'\x20payment:\x20'+_0x427d88+'\x20('+_0x5316c5+')'),this[_0x86b5a0(0x341)](_0x427d88);const _0x53a601=[],_0x5dd4ee=0x5*0x3c*0x3e8,_0x3bfa8f=0x2*0x3c*0x3c*0x3e8,_0x1796b8=Math['floor'](_0x3bfa8f/_0x5dd4ee);console['log'](_0x86b5a0(0x1ea)+_0x1796b8+_0x86b5a0(0x33b));for(let _0x5d1ade=0x1;_0x5d1ade<=_0x1796b8;_0x5d1ade++){const _0x541c07=setTimeout(async()=>{const _0xb8544a=_0x86b5a0;console['log'](_0xb8544a(0x334)+_0x4205c7+'\x20status\x20check\x20#'+_0x5d1ade+'/'+_0x1796b8+_0xb8544a(0x229)+_0x427d88);try{const _0x45346d=await this[_0xb8544a(0x275)](_0x5316c5,_0x161279,_0x4205c7);console[_0xb8544a(0x2cf)](_0xb8544a(0x244)+_0x5d1ade+_0xb8544a(0x2b5),_0x45346d),_0x45346d[_0xb8544a(0x231)]&&(console['log']('‚úÖ\x20Payment\x20'+_0x427d88+_0xb8544a(0x1f9)+_0x45346d[_0xb8544a(0x22d)]+_0xb8544a(0x285)),this[_0xb8544a(0x341)](_0x427d88),await this['updatePaymentStatus'](_0x427d88,_0x45346d['status'],_0x45346d));}catch(_0x4aadbd){console[_0xb8544a(0x328)]('‚ùå\x20Status\x20check\x20#'+_0x5d1ade+_0xb8544a(0x291)+_0x427d88+':',_0x4aadbd);}},_0x5d1ade*_0x5dd4ee);_0x53a601[_0x86b5a0(0x2b8)](_0x541c07);}this[_0x86b5a0(0x2eb)]['set'](_0x427d88,_0x53a601),console['log']('‚úÖ\x20Scheduled\x20'+_0x1796b8+'\x20status\x20checks\x20for\x20payment\x20'+_0x427d88);}[a57_0x5e14bf(0x341)](_0x9c3e5f){const _0x4d7309=a57_0x5e14bf,_0x8a0276=this[_0x4d7309(0x2eb)][_0x4d7309(0x326)](_0x9c3e5f);_0x8a0276&&(console[_0x4d7309(0x2cf)](_0x4d7309(0x309)+_0x8a0276[_0x4d7309(0x1e3)]+_0x4d7309(0x2d2)+_0x9c3e5f),_0x8a0276[_0x4d7309(0x33c)]((_0x884a8a,_0x6b94e9)=>{clearTimeout(_0x884a8a);}),this[_0x4d7309(0x2eb)]['delete'](_0x9c3e5f));}async[a57_0x5e14bf(0x296)](_0x857179,_0x2d542d,_0x42a766){const _0x5b1808=a57_0x5e14bf;try{const _0x367927=(await Promise['resolve']()[_0x5b1808(0x2f2)](()=>__importStar(require('../../config/database'))))[_0x5b1808(0x2cc)],_0x21e57b={'status':_0x2d542d[_0x5b1808(0x2e5)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x2d542d===_0x5b1808(0x1e4)&&(_0x21e57b[_0x5b1808(0x280)]=new Date()),_0x2d542d===_0x5b1808(0x1eb)&&_0x42a766['description']&&(_0x21e57b[_0x5b1808(0x2af)]=_0x42a766[_0x5b1808(0x2ec)],console[_0x5b1808(0x2cf)]('üíæ\x20Saving\x20failure\x20message:\x20'+_0x42a766[_0x5b1808(0x2ec)])),await _0x367927['payment']['update']({'where':{'id':_0x857179},'data':_0x21e57b}),console[_0x5b1808(0x2cf)]('‚úÖ\x20Payment\x20'+_0x857179+_0x5b1808(0x2c7)+_0x2d542d),await this['sendPaymentNotifications'](_0x857179,_0x2d542d);}catch(_0x287f05){console[_0x5b1808(0x328)](_0x5b1808(0x333)+_0x857179+':',_0x287f05);}}async[a57_0x5e14bf(0x325)](_0x6a0f25,_0x3a546b){const _0x2821f6=a57_0x5e14bf;try{const _0x21fe64=(await Promise[_0x2821f6(0x230)]()[_0x2821f6(0x2f2)](()=>__importStar(require('../../config/database'))))[_0x2821f6(0x2cc)],{telegramBotService:_0x1bc9f1}=await Promise[_0x2821f6(0x230)]()[_0x2821f6(0x2f2)](()=>__importStar(require(_0x2821f6(0x24e)))),_0x2fe730=await _0x21fe64[_0x2821f6(0x284)][_0x2821f6(0x290)]({'where':{'id':_0x6a0f25},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x2fe730)return;const _0x14c2a0={'PAID':_0x2821f6(0x202),'FAILED':_0x2821f6(0x1f2)},_0x356d42=_0x14c2a0[_0x3a546b];_0x356d42&&await _0x1bc9f1[_0x2821f6(0x2c5)](_0x2fe730[_0x2821f6(0x30d)],_0x2fe730,_0x356d42),await this[_0x2821f6(0x253)](_0x2fe730,_0x3a546b);}catch(_0x385357){console[_0x2821f6(0x328)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x385357);}}async['sendShopWebhook'](_0x522280,_0x3cb066){const _0x45f00f=a57_0x5e14bf,_0x4ab494=Date[_0x45f00f(0x307)]();try{const _0x904989=_0x522280[_0x45f00f(0x24b)],_0x547a93=_0x904989[_0x45f00f(0x30f)];if(!_0x547a93?.['webhookUrl']){console[_0x45f00f(0x2cf)](_0x45f00f(0x28a)+_0x904989['id']);return;}const _0x10e08f=_0x3cb066===_0x45f00f(0x1e4)?_0x45f00f(0x267):_0x45f00f(0x238);let _0x5b5446=[];if(_0x547a93[_0x45f00f(0x21c)])try{_0x5b5446=Array['isArray'](_0x547a93['webhookEvents'])?_0x547a93[_0x45f00f(0x21c)]:JSON['parse'](_0x547a93[_0x45f00f(0x21c)]);}catch(_0x26e360){console[_0x45f00f(0x328)](_0x45f00f(0x223),_0x26e360),_0x5b5446=[];}if(!_0x5b5446[_0x45f00f(0x2f6)](_0x10e08f)){console['log'](_0x45f00f(0x300)+_0x10e08f+_0x45f00f(0x24a)+_0x904989['id']);return;}const _0x19d3de={'event':_0x10e08f,'payment':{'id':_0x522280['id'],'order_id':_0x522280['orderId'],'gateway_order_id':_0x522280['gatewayOrderId'],'gateway':'1111','amount':_0x522280['amount'],'currency':_0x522280[_0x45f00f(0x207)],'status':_0x3cb066[_0x45f00f(0x271)](),'customer_email':_0x522280[_0x45f00f(0x209)],'customer_name':_0x522280[_0x45f00f(0x308)],'created_at':_0x522280[_0x45f00f(0x2a6)],'updated_at':new Date()}},_0x1e4f91=await fetch(_0x547a93['webhookUrl'],{'method':'POST','headers':{'Content-Type':_0x45f00f(0x22f),'User-Agent':_0x45f00f(0x327)},'body':JSON['stringify'](_0x19d3de)}),_0x4a29b2=Date[_0x45f00f(0x307)]()-_0x4ab494;loggerService_1[_0x45f00f(0x2e2)][_0x45f00f(0x33a)](_0x522280[_0x45f00f(0x30d)],_0x547a93[_0x45f00f(0x1ef)],_0x10e08f,_0x1e4f91[_0x45f00f(0x22d)],_0x4a29b2,_0x19d3de),console[_0x45f00f(0x2cf)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x547a93[_0x45f00f(0x1ef)]+_0x45f00f(0x2e7)+_0x1e4f91[_0x45f00f(0x22d)]+'\x20('+_0x4a29b2+'ms)');}catch(_0x351847){console['error']('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x351847),loggerService_1[_0x45f00f(0x2e2)][_0x45f00f(0x20a)](_0x522280[_0x45f00f(0x30d)],_0x522280[_0x45f00f(0x24b)]?.['settings']?.['webhookUrl']||_0x45f00f(0x336),'webhook_send',_0x351847,{});}}[a57_0x5e14bf(0x2ea)](_0x5034df){const _0x2bf599=a57_0x5e14bf,_0x350b1f=_0x5034df[_0x2bf599(0x2d7)](/[\s-]/g,'');if(_0x350b1f['length']<0x4)return'****';return _0x2bf599(0x217)+_0x350b1f[_0x2bf599(0x30b)](-0x4);}async[a57_0x5e14bf(0x2dd)](_0x99808c,_0x5c2488=a57_0x5e14bf(0x236)){const _0x1e6469=a57_0x5e14bf;console[_0x1e6469(0x2cf)](_0x1e6469(0x274),JSON[_0x1e6469(0x26e)](_0x99808c,null,0x2));let _0x2e27a3=_0x99808c,_0x2d43d9=_0x5c2488;_0x99808c[_0x1e6469(0x255)]?(_0x2d43d9=_0x99808c[_0x1e6469(0x255)]['toUpperCase']()===_0x1e6469(0x264)?_0x1e6469(0x264):'MASTERCARD',console[_0x1e6469(0x2cf)](_0x1e6469(0x2c6)+_0x2d43d9)):console[_0x1e6469(0x2cf)](_0x1e6469(0x31f)+_0x2d43d9);if(_0x99808c[_0x1e6469(0x339)]&&_0x99808c[_0x1e6469(0x29b)]&&_0x99808c[_0x1e6469(0x26f)]){console[_0x1e6469(0x2cf)](_0x1e6469(0x2c9));try{const _0x21ae31=await this[_0x1e6469(0x330)](_0x99808c[_0x1e6469(0x339)],_0x99808c[_0x1e6469(0x29b)],_0x2d43d9);_0x2e27a3=JSON[_0x1e6469(0x320)](_0x21ae31),console[_0x1e6469(0x2cf)](_0x1e6469(0x2b7)),console[_0x1e6469(0x2cf)](_0x1e6469(0x337),JSON[_0x1e6469(0x26e)](_0x2e27a3,null,0x2));}catch(_0x380c13){console[_0x1e6469(0x328)]('‚ùå\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:',_0x380c13),console[_0x1e6469(0x2cf)]('‚ö†Ô∏è\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted'),_0x2e27a3=_0x99808c;}}else console['log']('üìù\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0xf1313e=_0x1e6469(0x1e6);if(_0x2e27a3[_0x1e6469(0x22d)]===0x64&&_0x2e27a3[_0x1e6469(0x231)]===0x1)_0xf1313e=_0x1e6469(0x1e4);else{if(_0x2e27a3[_0x1e6469(0x231)]===0x0||!this[_0x1e6469(0x247)](_0x2e27a3[_0x1e6469(0x22d)]))_0xf1313e='PENDING';else _0x2e27a3[_0x1e6469(0x231)]===0x1||this[_0x1e6469(0x247)](_0x2e27a3[_0x1e6469(0x22d)])?_0xf1313e=_0x1e6469(0x1eb):_0xf1313e=_0x1e6469(0x1e6);}let _0x5ead2e='';if(_0x2e27a3[_0x1e6469(0x20c)])_0x5ead2e=_0x2e27a3[_0x1e6469(0x20c)]['toString'](),console[_0x1e6469(0x2cf)](_0x1e6469(0x312)+_0x2d43d9+'\x20order_id\x20for\x20search:\x20'+_0x5ead2e);else _0x2e27a3['payment_id']?(_0x5ead2e=_0x2e27a3['payment_id']['toString'](),console[_0x1e6469(0x2cf)](_0x1e6469(0x312)+_0x2d43d9+_0x1e6469(0x2ac)+_0x5ead2e)):(_0x5ead2e=_0x2e27a3[_0x1e6469(0x2ae)]||_0x2e27a3['paymentId']||_0x2e27a3['id']||'',console['log'](_0x1e6469(0x2a2)+_0x5ead2e));console['log']('üìä\x20'+_0x2d43d9+_0x1e6469(0x2a7)),console[_0x1e6469(0x2cf)](_0x1e6469(0x32d)+_0x5ead2e+_0x1e6469(0x23d)+_0x2e27a3[_0x1e6469(0x20c)]+',\x20orderId='+_0x2e27a3[_0x1e6469(0x2ae)]+_0x1e6469(0x338)+_0x2e27a3[_0x1e6469(0x266)]+_0x1e6469(0x2f0)+_0x2e27a3[_0x1e6469(0x28f)]+_0x1e6469(0x2e0)+_0x2e27a3['id']+')'),console[_0x1e6469(0x2cf)](_0x1e6469(0x295)+_0xf1313e+_0x1e6469(0x2fe)+_0x2e27a3[_0x1e6469(0x22d)]+',\x20final='+_0x2e27a3[_0x1e6469(0x231)]+')'),console['log'](_0x1e6469(0x260)+_0x2e27a3[_0x1e6469(0x24d)]),console[_0x1e6469(0x2cf)](_0x1e6469(0x314)+_0x2e27a3[_0x1e6469(0x207)]);let _0x3b6815;_0xf1313e==='FAILED'&&(_0x3b6815=this[_0x1e6469(0x1f8)](_0x2e27a3[_0x1e6469(0x22d)],_0x2e27a3['desc']),console[_0x1e6469(0x2cf)](_0x1e6469(0x2ab)+_0x3b6815));const _0x2017bb={'paymentId':_0x5ead2e,'status':_0xf1313e,'amount':_0x2e27a3[_0x1e6469(0x24d)],'currency':_0x2e27a3['currency']};return _0x3b6815&&(_0x2017bb['errorMessage']=_0x3b6815),_0x2017bb;}[a57_0x5e14bf(0x210)](){const _0x34b9c4=a57_0x5e14bf;console[_0x34b9c4(0x2cf)](_0x34b9c4(0x31e));const _0x8732b1=this[_0x34b9c4(0x2eb)]['size'];for(const [_0x4fa59c]of this[_0x34b9c4(0x2eb)]){this[_0x34b9c4(0x341)](_0x4fa59c);}console[_0x34b9c4(0x2cf)](_0x34b9c4(0x2d6)+_0x8732b1+_0x34b9c4(0x2dc));}}exports[a57_0x5e14bf(0x1e1)]=VisaMasterCardService;