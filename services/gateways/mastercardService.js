'use strict';function a49_0x2828(_0x190f6d,_0xac88ff){const _0x3dc79a=a49_0x3dc7();return a49_0x2828=function(_0x2828b9,_0x579ac5){_0x2828b9=_0x2828b9-0x1bf;let _0xede744=_0x3dc79a[_0x2828b9];return _0xede744;},a49_0x2828(_0x190f6d,_0xac88ff);}const a49_0x39aca4=a49_0x2828;(function(_0x1094e0,_0x9dffa2){const _0x397aa1=a49_0x2828,_0x12459c=_0x1094e0();while(!![]){try{const _0x110b02=-parseInt(_0x397aa1(0x300))/0x1*(-parseInt(_0x397aa1(0x2f1))/0x2)+parseInt(_0x397aa1(0x1d4))/0x3*(-parseInt(_0x397aa1(0x1f6))/0x4)+-parseInt(_0x397aa1(0x24a))/0x5+-parseInt(_0x397aa1(0x217))/0x6*(-parseInt(_0x397aa1(0x271))/0x7)+-parseInt(_0x397aa1(0x209))/0x8*(parseInt(_0x397aa1(0x253))/0x9)+-parseInt(_0x397aa1(0x2a0))/0xa*(parseInt(_0x397aa1(0x1d5))/0xb)+parseInt(_0x397aa1(0x1c7))/0xc;if(_0x110b02===_0x9dffa2)break;else _0x12459c['push'](_0x12459c['shift']());}catch(_0x5b7b0d){_0x12459c['push'](_0x12459c['shift']());}}}(a49_0x3dc7,0x3d16a));var __createBinding=this&&this[a49_0x39aca4(0x1d1)]||(Object[a49_0x39aca4(0x2f8)]?function(_0x3f44df,_0xb133a6,_0x4afd0a,_0x1cfd35){const _0x55c6fd=a49_0x39aca4;if(_0x1cfd35===undefined)_0x1cfd35=_0x4afd0a;var _0x715dff=Object['getOwnPropertyDescriptor'](_0xb133a6,_0x4afd0a);(!_0x715dff||(_0x55c6fd(0x2f0)in _0x715dff?!_0xb133a6['__esModule']:_0x715dff['writable']||_0x715dff['configurable']))&&(_0x715dff={'enumerable':!![],'get':function(){return _0xb133a6[_0x4afd0a];}}),Object['defineProperty'](_0x3f44df,_0x1cfd35,_0x715dff);}:function(_0x4f07f8,_0x210ffc,_0x3273ec,_0x25d43f){if(_0x25d43f===undefined)_0x25d43f=_0x3273ec;_0x4f07f8[_0x25d43f]=_0x210ffc[_0x3273ec];}),__setModuleDefault=this&&this[a49_0x39aca4(0x287)]||(Object[a49_0x39aca4(0x2f8)]?function(_0x42ecbd,_0x1a95b3){const _0x3dcc31=a49_0x39aca4;Object[_0x3dcc31(0x234)](_0x42ecbd,_0x3dcc31(0x20e),{'enumerable':!![],'value':_0x1a95b3});}:function(_0x4ea83e,_0x574f39){const _0x50910f=a49_0x39aca4;_0x4ea83e[_0x50910f(0x20e)]=_0x574f39;}),__importStar=this&&this[a49_0x39aca4(0x2e8)]||(function(){var _0x12a0be=function(_0x10763){return _0x12a0be=Object['getOwnPropertyNames']||function(_0x3054f8){const _0x4691b3=a49_0x2828;var _0xb6fb9f=[];for(var _0x27599e in _0x3054f8)if(Object[_0x4691b3(0x2dc)][_0x4691b3(0x1f9)][_0x4691b3(0x2a9)](_0x3054f8,_0x27599e))_0xb6fb9f[_0xb6fb9f[_0x4691b3(0x21e)]]=_0x27599e;return _0xb6fb9f;},_0x12a0be(_0x10763);};return function(_0x2bf271){const _0x355a52=a49_0x2828;if(_0x2bf271&&_0x2bf271[_0x355a52(0x232)])return _0x2bf271;var _0xa1b1f6={};if(_0x2bf271!=null){for(var _0x18d56a=_0x12a0be(_0x2bf271),_0x394211=0x0;_0x394211<_0x18d56a[_0x355a52(0x21e)];_0x394211++)if(_0x18d56a[_0x394211]!==_0x355a52(0x20e))__createBinding(_0xa1b1f6,_0x2bf271,_0x18d56a[_0x394211]);}return __setModuleDefault(_0xa1b1f6,_0x2bf271),_0xa1b1f6;};}()),__importDefault=this&&this[a49_0x39aca4(0x28a)]||function(_0xa50216){const _0x5ca471=a49_0x39aca4;return _0xa50216&&_0xa50216[_0x5ca471(0x232)]?_0xa50216:{'default':_0xa50216};};function a49_0x3dc7(){const _0x551790=['\x20\x20\x20Payment\x20ID:\x20','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','🔐\x203DS\x20verification\x20required','webhookUrl','🔐\x20MasterCard\x20API\x20URL:','json','message',',\x20payment_id=','settings','\x22\x20|\x20\x22','psp_public.pem','https://api2.trapay.uk/decrypt.php','🔐\x20Using\x20keys:\x20','🔐\x20VISA\x20Private\x20key\x20path:','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','✅\x20Status\x20response\x20decrypted\x20successfully','then','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','2291990YsaKjG','Cash\x20payment\x20is\x20expected\x20at\x20TCO','card_type',',\x20Desc:\x20','-----END','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','charge','📝\x20Encrypted\x20key\x20length:','clearStatusTimers','call','Number\x20of\x20attempts\x20exceeded','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','/status_raw','generateAESKey','/charge_raw','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','\x20payment\x20status:\x20','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','Webhook\x20event\x20','trim','\x20|\x20Response:\x20','expire_month','📤\x20Sending\x20request\x20to\x20API...','delete',',\x20id=','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','order_id','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','apiUrl','💳\x20VISA/MasterCard\x20service\x20initialized','❌\x20RSA\x20encryption\x20failed:','🧹\x20Card\x20holder\x20names\x20cleaned:','1111','Failed\x20payment','\x20\x20\x20-\x20key\x20length:','decryptAES','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','\x20\x20\x20Status:\x20','Card\x20Number:','Request\x20data\x20error','createCipheriv','),\x20stopping\x20status\x20checks','replace','\x20status\x20updated\x20to\x20','createSign','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','createdAt','🔐\x20AES\x20key\x20and\x20IV\x20generated','\x20characters','📊\x20Checking\x20','from','utf8','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','Amount:',',\x20orderId=','Unsuccessful\x20payment','slice','prototype','forEach','key','logShopWebhookSent','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','📝\x20Encrypted\x20data\x20length:','toString','charAt','last_name','toUpperCase','statusCheckTimers','constants','__importStar','decryptResponse','stringify','Invalid\x20expiration\x20date','Failed\x20to\x20check\x20','logWhiteDomainError','scheduleStatusChecks','payment_id','get','2RCjyFE','randomBytes','masterCardApiUrl','3DS\x20verification\x20required','cvv','expire_year','loggerService','create','webhookEvents','POST','/status','No\x20Error\x20executing\x20request','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','⏰\x20Will\x20check\x20status\x20','visaPublicKeyPath','30321xXWtqc','updatePaymentStatus','/charge_decrypted','\x20payment:\x20','PENDING','VisaMasterCardService','merchantPointId','now','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','PAID','getCardTypeAndApi','Cancellation\x20is\x20not\x20possible','adminNotes','cwd','first_name','✅\x20Payment\x20successful','📝\x20Final\x20request\x20structure:','Response\x20Body:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','orderId','shopId','\x20(from:\x20order_id=','sendPaymentNotification','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','RSA_PKCS1_PADDING','Status\x20decryption\x20failed:\x20','https://api.paydmeth.com/api','❌\x20RSA\x20signing\x20failed:','\x20\x20\x20-\x20info\x20length:','/charge_decrypt','currency','encryptAES','info','Payment\x20pending\x20verification','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','Error\x20details:','MASTERCARD','encryptRSA','VISA/MasterCard','decryptResponsePhp','15431988CfWDaj','errorMessage','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Order\x20ID:','\x20for\x20payment\x20','logWhiteDomainResponse','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','PIN\x20code\x20confirmation\x20awaited','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Payment\x20System/1.0','__createBinding','sign','🎯\x20Using\x20','1797UCPXpQ','11uWHezT','signRSA','****\x20****\x20****\x20','3ds_url','error','warn',':\x20Unknown\x20status\x20code','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','description','HTTP\x20Status:','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','****','\x20payment_id\x20for\x20search:\x20','logShopWebhookError','Unknown\x20error','\x20not\x20enabled\x20for\x20shop\x20','Error\x20parsing\x20webhook\x20events:','path','SHA256','Payment\x20cancellation\x20is\x20being\x20processed','🛑\x20Stopped\x20','Awaiting\x20confirmation\x20in\x20the\x20application','),\x20defaulting\x20to\x20MasterCard','sendPaymentNotifications','LookUp\x20number\x20of\x20attempts\x20exceeded','Status\x20','visa/mastercard','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','❌\x20Status\x20check\x20#','💾\x20Saving\x20failure\x20message:\x20','size','632HwoKNG','paidAt','Payment\x20ID:','hasOwnProperty','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','stopAllStatusChecks','join','🔐\x20MasterCard\x20Private\x20key\x20path:','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','🔐\x20AES\x20key\x20length:','\x20API:\x20','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','sendShopWebhook',',\x20Final:\x20','base64','status','...','FAILED','MasterCard\x20webhook\x20sent\x20to\x20','8IaTLHs','🧹\x20Clearing\x20','\x20status\x20timers\x20for\x20payment\x20','/status_decrypted','Sender\x20information\x20required','default','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','private.pem','Insufficient\x20funds\x20on\x20the\x20card','🔐\x20VISA\x20Public\x20key\x20path:','visaMerchantPointId','\x20\x20Cleaned:\x20\x20\x22','6trEvRr','application/json','VISA/MasterCard\x20payment\x20successful','LookUp\x20code\x20verified','toLowerCase','Captcha\x20confirmation\x20awaited','checkPaymentStatus','length','\x20\x20\x20-\x20method:\x20charge','Awaiting\x20confirmation\x20by\x20ivr\x20call','findUnique','🔐\x20Data\x20encrypted\x20with\x20AES','Payment\x20System/1.0\x20(MasterCard)','masterCardMerchantPointId','final','crypto','parse','✅\x20Scheduled\x20','failureMessage','processCardPayment','Return\x20URL:','push','\x20result:','none','readFileSync','Card\x20Holder:','paymentId','__esModule','validateKeyFiles','defineProperty','desc','🔍\x20Using\x20provided\x20card\x20type:\x20','\x20\x20Original:\x20\x22','🔍\x20','keys','===\x20PARSED\x20API\x20RESPONSE\x20===','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','Status:','publicKeyPath','logWhiteDomainRequest','🔐\x20RSA\x20signing\x20successful','\x20\x20\x20Currency:\x20','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','📊\x20Status\x20check\x20result:','visaApiUrl','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','HTTP\x20error!\x20status:\x20','3DS\x20URL:','📊\x20Status\x20check\x20#','customerEmail','visaPrivateKeyPath','2357970ThcXDp','resolve','../../config/database','LookUp\x20code\x20sent','existsSync','getDetailedErrorMessage','Failed\x20to\x20send\x20MasterCard\x20webhook:','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','customerName','3150594hFWIVd','🔍\x20Using\x20','includes','cardType','shop','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','privateKeyPath','amount','processWebhook','isFinalStatus','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','📝\x20Data\x20length:','VISA','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','Payment\x20confirmation\x20time\x20has\x20expired','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','visa_public.pem','❌\x20PHP\x20decryptor\x20request\x20failed:','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','5000000000000000','aes-256-ctr','maskCardNumber','privateDecrypt','\x20order_id\x20for\x20search:\x20','visa_private.pem','No\x20New\x20payment','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','system','Recipient\x20data\x20required','555793vLiWCk','\x20MasterCard\x20status\x20check\x20timers','update','\x20webhook\x20extracted\x20data:','LookUp\x20not\x20confirmed','paid','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','isArray','Failed\x20to\x20decrypt\x20response','Payment\x20prohibited','number','log','Payment\x20returned','Method\x20not\x20allowed','gatewayOrderId','failed','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','🔐\x20MasterCard\x20Public\x20key\x20path:','PHP\x20decryptor\x20error','-----BEGIN','🔐\x20Data\x20signed\x20with\x20RSA','❌\x20Data\x20being\x20signed:','__setModuleDefault','text','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','__importDefault','❌\x20Detailed\x20failure\x20description:\x20','📝\x20Signature\x20length:','Decryption\x20failed:\x20'];a49_0x3dc7=function(){return _0x551790;};return a49_0x3dc7();}Object[a49_0x39aca4(0x234)](exports,'__esModule',{'value':!![]}),exports[a49_0x39aca4(0x305)]=void 0x0;const crypto_1=__importDefault(require(a49_0x39aca4(0x226))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x39aca4(0x1e8))),loggerService_1=require('../loggerService');class VisaMasterCardService{constructor(){const _0x300755=a49_0x39aca4;this[_0x300755(0x2e6)]=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0x300755(0x26c)},0x1:{'final':![],'description':_0x300755(0x2fc)},0x2:{'final':!![],'description':_0x300755(0x2c9)},0x3:{'final':!![],'description':'Another\x20unknown\x20error'},0x4:{'final':!![],'description':_0x300755(0x2da)},0x5:{'final':!![],'description':_0x300755(0x26e)},0x6:{'final':!![],'description':_0x300755(0x27d)},0x7:{'final':!![],'description':'Test\x20payment'},0x8:{'final':![],'description':'Client\x20OTP\x20confirmation\x20required'},0x9:{'final':![],'description':'3DS\x20verification\x20required'},0xa:{'final':![],'description':'Sender\x27s\x20CVV\x20card\x20is\x20required'},0xb:{'final':![],'description':_0x300755(0x20d)},0xc:{'final':![],'description':_0x300755(0x270)},0xd:{'final':![],'description':_0x300755(0x317)},0xe:{'final':![],'description':_0x300755(0x220)},0xf:{'final':![],'description':_0x300755(0x1ce)},0x10:{'final':![],'description':_0x300755(0x21c)},0x11:{'final':![],'description':_0x300755(0x2bb)},0x12:{'final':![],'description':_0x300755(0x1ec)},0x13:{'final':![],'description':'Payment\x20is\x20being\x20processed'},0x14:{'final':![],'description':'The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender'},0x15:{'final':![],'description':'Expected\x20bitcoin\x20transfer\x20from\x20client'},0x16:{'final':![],'description':_0x300755(0x1c0)},0x18:{'final':![],'description':'The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'},0x19:{'final':![],'description':_0x300755(0x241)},0x1a:{'final':!![],'description':_0x300755(0x2a1)},0x1b:{'final':![],'description':_0x300755(0x2e0)},0x1c:{'final':![],'description':'Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application'},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':_0x300755(0x1c1)},0x20:{'final':![],'description':_0x300755(0x262)},0x23:{'final':![],'description':'Sender\x27s\x20card\x20details\x20are\x20required'},0x24:{'final':!![],'description':_0x300755(0x261)},0x25:{'final':!![],'description':_0x300755(0x27a)},0x26:{'final':!![],'description':_0x300755(0x2d7)},0x27:{'final':!![],'description':_0x300755(0x213)},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':'The\x20card\x20is\x20lost\x20or\x20stolen'},0x2a:{'final':!![],'description':_0x300755(0x2eb)},0x2b:{'final':!![],'description':'Transaction\x20limit\x20exceeded'},0x2c:{'final':!![],'description':'The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank'},0x2d:{'final':!![],'description':_0x300755(0x2c3)},0x2e:{'final':!![],'description':_0x300755(0x2da)},0x2f:{'final':!![],'description':_0x300755(0x2da)},0x30:{'final':!![],'description':_0x300755(0x258)},0x31:{'final':![],'description':'Payment\x20confirmation\x20required'},0x32:{'final':!![],'description':_0x300755(0x27e)},0x33:{'final':!![],'description':_0x300755(0x2c3)},0x34:{'final':!![],'description':_0x300755(0x2c3)},0x35:{'final':!![],'description':_0x300755(0x2c3)},0x36:{'final':!![],'description':_0x300755(0x2c3)},0x37:{'final':!![],'description':_0x300755(0x2c3)},0x38:{'final':!![],'description':_0x300755(0x30b)},0x39:{'final':![],'description':_0x300755(0x1e1)},0x3a:{'final':![],'description':_0x300755(0x24d)},0x3b:{'final':!![],'description':_0x300755(0x21a)},0x3c:{'final':!![],'description':_0x300755(0x2aa)},0x3d:{'final':!![],'description':_0x300755(0x23b)},0x3e:{'final':!![],'description':'Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID'},0x3f:{'final':!![],'description':_0x300755(0x27d)},0x40:{'final':![],'description':_0x300755(0x275)},0x41:{'final':!![],'description':_0x300755(0x1ef)},0x42:{'final':![],'description':_0x300755(0x1ea)},0x43:{'final':!![],'description':'Technical\x20limit,\x20contact\x20your\x20personal\x20manager'},0x44:{'final':![],'description':_0x300755(0x2f4)},0x45:{'final':!![],'description':'Failed\x20payment'},0x46:{'final':!![],'description':'Failed\x20payment'},0x47:{'final':!![],'description':_0x300755(0x1de)},0x64:{'final':!![],'description':'Operation\x20completed\x20successfully'}},this['masterCardApiUrl']=_0x300755(0x31a),this['masterCardMerchantPointId']=0x6e4,this[_0x300755(0x259)]=path_1[_0x300755(0x20e)][_0x300755(0x1fc)](process[_0x300755(0x30d)](),'keys',_0x300755(0x212)),this[_0x300755(0x23d)]=path_1['default'][_0x300755(0x1fc)](process[_0x300755(0x30d)](),'keys',_0x300755(0x298)),this[_0x300755(0x243)]='https://api.paydmeth.com/api',this[_0x300755(0x215)]=0x6b7,this['visaPrivateKeyPath']=path_1[_0x300755(0x20e)][_0x300755(0x1fc)](process['cwd'](),_0x300755(0x239),_0x300755(0x26b)),this['visaPublicKeyPath']=path_1[_0x300755(0x20e)][_0x300755(0x1fc)](process[_0x300755(0x30d)](),_0x300755(0x239),_0x300755(0x263)),console[_0x300755(0x27c)](_0x300755(0x2bf)),console[_0x300755(0x27c)](_0x300755(0x292),this[_0x300755(0x2f3)]),console[_0x300755(0x27c)]('🔐\x20VISA\x20API\x20URL:',this['visaApiUrl']),console['log'](_0x300755(0x1fd),this[_0x300755(0x259)]),console[_0x300755(0x27c)](_0x300755(0x282),this[_0x300755(0x23d)]),console[_0x300755(0x27c)](_0x300755(0x29b),this['visaPrivateKeyPath']),console['log'](_0x300755(0x214),this[_0x300755(0x2ff)]),this[_0x300755(0x233)]();}[a49_0x39aca4(0x24f)](_0x4abeb2,_0x29d425){const _0x2f35aa=a49_0x39aca4,_0x578392=this['paymentStatuses'][_0x4abeb2];let _0xf2c6cf='';_0x578392?_0xf2c6cf=_0x2f35aa(0x1f0)+_0x4abeb2+':\x20'+_0x578392['description']:_0xf2c6cf='Status\x20'+_0x4abeb2+_0x2f35aa(0x1db);if(_0x29d425&&_0x29d425['trim']()){const _0x1f1ec1=_0x29d425[_0x2f35aa(0x2b4)]();(!_0x578392||_0x1f1ec1['toLowerCase']()!==_0x578392['description'][_0x2f35aa(0x21b)]())&&(_0xf2c6cf+=_0x2f35aa(0x2b5)+_0x1f1ec1);}return _0xf2c6cf;}[a49_0x39aca4(0x25c)](_0x3d1137){const _0x2d719c=a49_0x39aca4,_0x2480d7=this['paymentStatuses'][_0x3d1137];return _0x2480d7?_0x2480d7[_0x2d719c(0x225)]:!![];}['getCardTypeAndApi'](_0x3f0100){const _0x4d18bf=a49_0x39aca4,_0x1feefe=_0x3f0100[_0x4d18bf(0x2e3)](0x0);if(_0x1feefe==='4')return console[_0x4d18bf(0x27c)](_0x4d18bf(0x1fe)),{'cardType':_0x4d18bf(0x25f),'apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x4d18bf(0x249)],'publicKeyPath':this[_0x4d18bf(0x2ff)],'merchantPointId':this['visaMerchantPointId']};else return _0x1feefe==='5'?(console['log'](_0x4d18bf(0x277)),{'cardType':'MASTERCARD','apiUrl':this[_0x4d18bf(0x2f3)],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x4d18bf(0x224)]}):(console[_0x4d18bf(0x27c)](_0x4d18bf(0x1cd)+_0x1feefe+_0x4d18bf(0x1ed)),{'cardType':_0x4d18bf(0x1c3),'apiUrl':this[_0x4d18bf(0x2f3)],'privateKeyPath':this[_0x4d18bf(0x259)],'publicKeyPath':this[_0x4d18bf(0x23d)],'merchantPointId':this[_0x4d18bf(0x224)]});}['validateKeyFiles'](){const _0x3d2e04=a49_0x39aca4;try{if(!fs_1['default'][_0x3d2e04(0x24e)](this[_0x3d2e04(0x259)]))throw new Error(_0x3d2e04(0x2ab)+this['privateKeyPath']);if(!fs_1[_0x3d2e04(0x20e)][_0x3d2e04(0x24e)](this[_0x3d2e04(0x23d)]))throw new Error(_0x3d2e04(0x2af)+this[_0x3d2e04(0x23d)]);const _0x1696c0=fs_1[_0x3d2e04(0x20e)][_0x3d2e04(0x22f)](this[_0x3d2e04(0x259)],_0x3d2e04(0x2d5))[_0x3d2e04(0x2b4)](),_0x27a283=fs_1[_0x3d2e04(0x20e)][_0x3d2e04(0x22f)](this[_0x3d2e04(0x23d)],_0x3d2e04(0x2d5))[_0x3d2e04(0x2b4)]();if(!_0x1696c0['includes'](_0x3d2e04(0x284))||!_0x1696c0[_0x3d2e04(0x255)](_0x3d2e04(0x2a4)))throw new Error(_0x3d2e04(0x1c9));if(!_0x27a283[_0x3d2e04(0x255)](_0x3d2e04(0x284))||!_0x27a283['includes'](_0x3d2e04(0x2a4)))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x3d2e04(0x27c)](_0x3d2e04(0x2c6)),console['log'](_0x3d2e04(0x2bd)+_0x1696c0['length']+_0x3d2e04(0x2d2)),console[_0x3d2e04(0x27c)](_0x3d2e04(0x1fa)+_0x27a283[_0x3d2e04(0x21e)]+_0x3d2e04(0x2d2));if(fs_1[_0x3d2e04(0x20e)][_0x3d2e04(0x24e)](this[_0x3d2e04(0x249)])&&fs_1[_0x3d2e04(0x20e)][_0x3d2e04(0x24e)](this['visaPublicKeyPath'])){const _0x6d5f3d=fs_1[_0x3d2e04(0x20e)][_0x3d2e04(0x22f)](this[_0x3d2e04(0x249)],'utf8')[_0x3d2e04(0x2b4)](),_0xd020ed=fs_1['default'][_0x3d2e04(0x22f)](this[_0x3d2e04(0x2ff)],_0x3d2e04(0x2d5))[_0x3d2e04(0x2b4)]();(!_0x6d5f3d[_0x3d2e04(0x255)](_0x3d2e04(0x284))||!_0x6d5f3d['includes'](_0x3d2e04(0x2a4)))&&console[_0x3d2e04(0x1da)](_0x3d2e04(0x281)),(!_0xd020ed[_0x3d2e04(0x255)](_0x3d2e04(0x284))||!_0xd020ed[_0x3d2e04(0x255)](_0x3d2e04(0x2a4)))&&console[_0x3d2e04(0x1da)]('⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),console[_0x3d2e04(0x27c)]('✅\x20VISA\x20key\x20files\x20validated\x20successfully'),console['log']('🔐\x20VISA\x20Private\x20key\x20length:\x20'+_0x6d5f3d[_0x3d2e04(0x21e)]+_0x3d2e04(0x2d2)),console['log']('🔐\x20VISA\x20Public\x20key\x20length:\x20'+_0xd020ed[_0x3d2e04(0x21e)]+_0x3d2e04(0x2d2));}else console[_0x3d2e04(0x1da)](_0x3d2e04(0x260)),console[_0x3d2e04(0x1da)](_0x3d2e04(0x201)+this[_0x3d2e04(0x249)]),console['warn'](_0x3d2e04(0x2a5)+this[_0x3d2e04(0x2ff)]);}catch(_0xa4ab7){console['error'](_0x3d2e04(0x1f2),_0xa4ab7);throw _0xa4ab7;}}[a49_0x39aca4(0x2ad)](){const _0x234833=a49_0x39aca4,_0x34982e=crypto_1[_0x234833(0x20e)][_0x234833(0x2f2)](0x20),_0x56c2d9=crypto_1['default'][_0x234833(0x2f2)](0x10);return{'key':_0x34982e,'iv':_0x56c2d9};}[a49_0x39aca4(0x31f)](_0x5c5013,_0x2ead90,_0x1139a2){const _0x575862=a49_0x39aca4,_0x5e6dc9=crypto_1[_0x575862(0x20e)][_0x575862(0x2ca)](_0x575862(0x267),_0x2ead90,_0x1139a2);let _0x3e7de7=_0x5e6dc9[_0x575862(0x273)](_0x5c5013,_0x575862(0x2d5),_0x575862(0x204));return _0x3e7de7+=_0x5e6dc9['final'](_0x575862(0x204)),_0x3e7de7;}[a49_0x39aca4(0x1c4)](_0xa90f70,_0x3c0932,_0x308784){const _0x11dcba=a49_0x39aca4;try{const _0x5c4a01=fs_1['default'][_0x11dcba(0x22f)](_0x308784,_0x11dcba(0x2d5))[_0x11dcba(0x2b4)](),_0x253924={'iv':_0x3c0932[_0x11dcba(0x2e2)](_0x11dcba(0x204)),'key':_0xa90f70[_0x11dcba(0x2e2)]('base64')},_0x747dc9=JSON[_0x11dcba(0x2ea)](_0x253924);console[_0x11dcba(0x27c)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x747dc9[_0x11dcba(0x21e)]);const _0x3e008d=crypto_1[_0x11dcba(0x20e)]['publicEncrypt']({'key':_0x5c4a01,'padding':crypto_1['default'][_0x11dcba(0x2e7)][_0x11dcba(0x318)]},Buffer[_0x11dcba(0x2d4)](_0x747dc9));return console[_0x11dcba(0x27c)]('✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x3e008d[_0x11dcba(0x21e)]),_0x3e008d[_0x11dcba(0x2e2)](_0x11dcba(0x204));}catch(_0x5e930d){console['error'](_0x11dcba(0x2c0),_0x5e930d);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}['signRSA'](_0x188d5b,_0x4deec7){const _0x4e7dcd=a49_0x39aca4;try{const _0x594830=fs_1['default'][_0x4e7dcd(0x22f)](_0x4deec7,_0x4e7dcd(0x2d5))[_0x4e7dcd(0x2b4)](),_0x39c5ae=crypto_1[_0x4e7dcd(0x20e)][_0x4e7dcd(0x2ce)](_0x4e7dcd(0x1e9));_0x39c5ae[_0x4e7dcd(0x273)](_0x188d5b),_0x39c5ae['end']();const _0x367f06=_0x39c5ae[_0x4e7dcd(0x1d2)](_0x594830,'base64');return console[_0x4e7dcd(0x27c)](_0x4e7dcd(0x23f)),console[_0x4e7dcd(0x27c)]('📝\x20Data\x20to\x20sign\x20length:',_0x188d5b[_0x4e7dcd(0x21e)]),console[_0x4e7dcd(0x27c)](_0x4e7dcd(0x28c),_0x367f06[_0x4e7dcd(0x21e)]),_0x367f06;}catch(_0x522958){console[_0x4e7dcd(0x1d9)](_0x4e7dcd(0x31b),_0x522958),console[_0x4e7dcd(0x1d9)](_0x4e7dcd(0x286),_0x188d5b['substring'](0x0,0xc8)+_0x4e7dcd(0x206));throw new Error(_0x4e7dcd(0x308));}}[a49_0x39aca4(0x2c5)](_0x3d1448,_0x2bba4a,_0x16cc15){const _0x3aeff6=a49_0x39aca4,_0x39a212=crypto_1['default']['createDecipheriv'](_0x3aeff6(0x267),_0x2bba4a,_0x16cc15);let _0x351bda=_0x39a212[_0x3aeff6(0x273)](_0x3d1448,_0x3aeff6(0x204),'utf8');return _0x351bda+=_0x39a212['final']('utf8'),_0x351bda;}async[a49_0x39aca4(0x1c6)](_0x2dfe56,_0x1a5d4f,_0x244801=a49_0x39aca4(0x1c3)){const _0x56bc78=a49_0x39aca4;try{const _0x58077e=await fetch(_0x56bc78(0x299),{'method':'POST','headers':{'Content-Type':_0x56bc78(0x218)},'body':JSON[_0x56bc78(0x2ea)]({'info':_0x2dfe56,'key':_0x1a5d4f,'card_type':_0x244801[_0x56bc78(0x21b)]()})});if(!_0x58077e['ok'])throw new Error(_0x56bc78(0x283));return await _0x58077e[_0x56bc78(0x288)]();}catch(_0x296263){console[_0x56bc78(0x1d9)](_0x56bc78(0x264),_0x296263);throw new Error(_0x56bc78(0x29c));}}[a49_0x39aca4(0x2e9)](_0x502a09,_0x19bb41){const _0x198ab8=a49_0x39aca4;try{const _0x135219=fs_1[_0x198ab8(0x20e)][_0x198ab8(0x22f)](this[_0x198ab8(0x259)],_0x198ab8(0x2d5))[_0x198ab8(0x2b4)](),_0x1fc6d8=crypto_1['default'][_0x198ab8(0x269)](_0x135219,Buffer[_0x198ab8(0x2d4)](_0x19bb41,_0x198ab8(0x204))),_0x129400=JSON[_0x198ab8(0x227)](_0x1fc6d8[_0x198ab8(0x2e2)]()),_0x1ad78a=Buffer['from'](_0x129400[_0x198ab8(0x2de)],_0x198ab8(0x204)),_0x464cc5=Buffer['from'](_0x129400['iv'],'base64');return this[_0x198ab8(0x2c5)](_0x502a09,_0x1ad78a,_0x464cc5);}catch(_0x3747f2){throw new Error(_0x198ab8(0x279));}}async[a49_0x39aca4(0x22a)](_0x4893df){const _0x191cd2=a49_0x39aca4,{paymentId:_0x100e8d,orderId:_0x33e43b,amount:_0x23e24e,currency:_0x6af89d,cardData:_0x2c1d86,resultUrl:_0x4e72ba,returnUrl:_0x5d212c,cardHolder:_0x48151d,browser:_0x3dbad4}=_0x4893df;console[_0x191cd2(0x27c)](_0x191cd2(0x26d)),console[_0x191cd2(0x27c)]('Payment\x20ID:',_0x100e8d),console[_0x191cd2(0x27c)](_0x191cd2(0x1ca),_0x33e43b),console[_0x191cd2(0x27c)](_0x191cd2(0x2d8),_0x23e24e,_0x6af89d),console[_0x191cd2(0x27c)](_0x191cd2(0x2c8),this['maskCardNumber'](_0x2c1d86['number'])),console[_0x191cd2(0x27c)](_0x191cd2(0x230),_0x48151d[_0x191cd2(0x30e)]+'\x20'+_0x48151d[_0x191cd2(0x2e4)]),console[_0x191cd2(0x27c)](_0x191cd2(0x22b),_0x5d212c),console[_0x191cd2(0x27c)]('Result\x20URL:',_0x4e72ba);const _0xa3dce4=this['getCardTypeAndApi'](_0x2c1d86[_0x191cd2(0x27b)]);console[_0x191cd2(0x27c)](_0x191cd2(0x1d3)+_0xa3dce4['cardType']+_0x191cd2(0x200)+_0xa3dce4['apiUrl']),console[_0x191cd2(0x27c)](_0x191cd2(0x29a)+_0xa3dce4[_0x191cd2(0x259)]+',\x20'+_0xa3dce4[_0x191cd2(0x23d)]);const _0x17c0fd={..._0x48151d,'first_name':_0x48151d[_0x191cd2(0x30e)]?.[_0x191cd2(0x2cc)](/[\t\n\r\f\v]/g,'\x20')['trim']()||'','last_name':_0x48151d[_0x191cd2(0x2e4)]?.[_0x191cd2(0x2cc)](/[\t\n\r\f\v]/g,'\x20')[_0x191cd2(0x2b4)]()||''};console[_0x191cd2(0x27c)](_0x191cd2(0x2c1)),console['log'](_0x191cd2(0x237)+_0x48151d['first_name']+_0x191cd2(0x297)+_0x48151d[_0x191cd2(0x2e4)]+'\x22'),console[_0x191cd2(0x27c)](_0x191cd2(0x216)+_0x17c0fd[_0x191cd2(0x30e)]+_0x191cd2(0x297)+_0x17c0fd[_0x191cd2(0x2e4)]+'\x22');const _0xed5af1={'amount':_0x23e24e,'currency':_0x6af89d[_0x191cd2(0x2e5)](),'order_id':_0x33e43b,'result_url':_0x4e72ba,'return_url':_0x5d212c,'country':'','card':{'number':_0x2c1d86[_0x191cd2(0x27b)],'expire_month':_0x2c1d86[_0x191cd2(0x2b6)],'expire_year':_0x2c1d86[_0x191cd2(0x2f6)],'cvv':_0x2c1d86[_0x191cd2(0x2f5)]},'card_holder':_0x17c0fd,'browser':_0x3dbad4},_0x28820f=JSON[_0x191cd2(0x2ea)](_0xed5af1);console[_0x191cd2(0x27c)]('💾\x20Payment\x20data\x20prepared'),console[_0x191cd2(0x27c)](_0x191cd2(0x2ba)),console[_0x191cd2(0x27c)](_0x28820f),console[_0x191cd2(0x27c)](_0x191cd2(0x25e),_0x28820f[_0x191cd2(0x21e)]);try{const {key:_0x292614,iv:_0x222592}=this[_0x191cd2(0x2ad)]();console[_0x191cd2(0x27c)](_0x191cd2(0x2d1)),console['log'](_0x191cd2(0x1ff),_0x292614[_0x191cd2(0x21e)]),console['log']('🔐\x20AES\x20IV\x20length:',_0x222592[_0x191cd2(0x21e)]);const _0x448435=this[_0x191cd2(0x31f)](_0x28820f,_0x292614,_0x222592);console[_0x191cd2(0x27c)](_0x191cd2(0x222)),console[_0x191cd2(0x27c)](_0x191cd2(0x2e1),_0x448435['length']);const _0x1fb87f=this['encryptRSA'](_0x292614,_0x222592,_0xa3dce4[_0x191cd2(0x23d)]);console[_0x191cd2(0x27c)](_0x191cd2(0x2d6)),console[_0x191cd2(0x27c)](_0x191cd2(0x2a7),_0x1fb87f['length']);const _0x39ac94=this[_0x191cd2(0x1d6)](_0x28820f,_0xa3dce4['privateKeyPath']);console[_0x191cd2(0x27c)](_0x191cd2(0x285)),console[_0x191cd2(0x27c)]('📝\x20Signature\x20length:',_0x39ac94[_0x191cd2(0x21e)]);const _0x2b90cb={'merchant_point_id':_0xa3dce4['merchantPointId'],'method':'charge','info':_0x448435,'key':_0x1fb87f,'sign':_0x39ac94,'lang':'en'};console[_0x191cd2(0x27c)](_0x191cd2(0x2b7)),console[_0x191cd2(0x27c)](_0x191cd2(0x310)),console['log']('\x20\x20\x20-\x20merchant_point_id:',_0xa3dce4[_0x191cd2(0x306)]),console[_0x191cd2(0x27c)](_0x191cd2(0x21f)),console['log'](_0x191cd2(0x31c),_0x448435[_0x191cd2(0x21e)]),console[_0x191cd2(0x27c)](_0x191cd2(0x2c4),_0x1fb87f['length']),console[_0x191cd2(0x27c)]('\x20\x20\x20-\x20sign\x20length:',_0x39ac94['length']),console['log']('\x20\x20\x20-\x20lang:\x20en'),loggerService_1['loggerService'][_0x191cd2(0x23e)](_0xa3dce4[_0x191cd2(0x256)]['toLowerCase'](),'/charge',_0x191cd2(0x2fa),{'merchant_point_id':_0xa3dce4[_0x191cd2(0x306)],'method':_0x191cd2(0x2a6),'lang':'en'});const _0x3483bf=Date['now'](),_0x38c43d=await fetch(_0xa3dce4[_0x191cd2(0x2be)],{'method':_0x191cd2(0x2fa),'headers':{'Content-Type':_0x191cd2(0x218),'Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON['stringify'](_0x2b90cb)}),_0x1f081f=Date[_0x191cd2(0x307)]()-_0x3483bf;console['log']('===\x20API\x20RESPONSE\x20==='),console[_0x191cd2(0x27c)](_0x191cd2(0x23c),_0x38c43d[_0x191cd2(0x205)]),console[_0x191cd2(0x27c)]('Response\x20Time:',_0x1f081f+'ms');if(!_0x38c43d['ok']){const _0x1e1b34=await _0x38c43d[_0x191cd2(0x288)]();console['error'](_0x191cd2(0x1e0),_0x38c43d[_0x191cd2(0x205)]),console['error'](_0x191cd2(0x311),_0x1e1b34),loggerService_1[_0x191cd2(0x2f7)][_0x191cd2(0x1cc)](_0xa3dce4[_0x191cd2(0x256)][_0x191cd2(0x21b)](),_0x191cd2(0x2ae),_0x38c43d[_0x191cd2(0x205)],_0x1e1b34,_0x1f081f),loggerService_1[_0x191cd2(0x2f7)][_0x191cd2(0x2ed)](_0xa3dce4[_0x191cd2(0x256)][_0x191cd2(0x21b)](),'/charge','HTTP\x20'+_0x38c43d['status']+':\x20'+_0x1e1b34);throw new Error(_0x191cd2(0x245)+_0x38c43d[_0x191cd2(0x205)]+',\x20body:\x20'+_0x1e1b34);}const _0x2db361=await _0x38c43d[_0x191cd2(0x293)]();loggerService_1[_0x191cd2(0x2f7)][_0x191cd2(0x1cc)](_0xa3dce4[_0x191cd2(0x256)][_0x191cd2(0x21b)](),_0x191cd2(0x2ae),_0x38c43d[_0x191cd2(0x205)],_0x2db361,_0x1f081f),console[_0x191cd2(0x27c)](_0x191cd2(0x23a));let _0x1f290f=_0x2db361;if(_0x2db361[_0x191cd2(0x1bf)]&&_0x2db361[_0x191cd2(0x2de)]&&_0x2db361[_0x191cd2(0x1d2)]){console[_0x191cd2(0x27c)](_0x191cd2(0x2b0));try{const _0x70bf31=await this[_0x191cd2(0x1c6)](_0x2db361[_0x191cd2(0x1bf)],_0x2db361[_0x191cd2(0x2de)],_0xa3dce4[_0x191cd2(0x256)]);_0x1f290f=JSON[_0x191cd2(0x227)](_0x70bf31),console[_0x191cd2(0x27c)](_0x191cd2(0x29f)),loggerService_1[_0x191cd2(0x2f7)][_0x191cd2(0x1cc)](_0xa3dce4[_0x191cd2(0x256)][_0x191cd2(0x21b)](),_0x191cd2(0x302),_0x38c43d[_0x191cd2(0x205)],_0x1f290f,_0x1f081f),console[_0x191cd2(0x27c)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x31c465){console['error']('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x31c465),loggerService_1[_0x191cd2(0x2f7)][_0x191cd2(0x2ed)](_0xa3dce4[_0x191cd2(0x256)][_0x191cd2(0x21b)](),_0x191cd2(0x31d),_0x191cd2(0x28d)+_0x31c465),_0x1f290f=_0x2db361;}}else loggerService_1['loggerService']['logWhiteDomainResponse'](_0xa3dce4[_0x191cd2(0x256)]['toLowerCase'](),_0x191cd2(0x302),_0x38c43d['status'],_0x1f290f,_0x1f081f),console[_0x191cd2(0x27c)](_0x191cd2(0x1cf));console[_0x191cd2(0x27c)](_0x191cd2(0x23c),_0x1f290f[_0x191cd2(0x205)]),console[_0x191cd2(0x27c)]('Final:',_0x1f290f[_0x191cd2(0x225)]),console[_0x191cd2(0x27c)](_0x191cd2(0x1f8),_0x1f290f[_0x191cd2(0x2ef)]),console['log'](_0x191cd2(0x246),_0x1f290f[_0x191cd2(0x1d8)]||_0x191cd2(0x22e));if(_0x1f290f[_0x191cd2(0x205)]===0x64&&_0x1f290f[_0x191cd2(0x225)]===0x1)return console[_0x191cd2(0x27c)](_0x191cd2(0x30f)),{'gateway_payment_id':_0x1f290f[_0x191cd2(0x2ef)]?.[_0x191cd2(0x2e2)](),'payment_url':_0x5d212c,'requires_3ds':![],'status':_0x191cd2(0x309),'final':!![]};if(_0x1f290f['3ds_url'])return console[_0x191cd2(0x27c)](_0x191cd2(0x290)),this[_0x191cd2(0x2ee)](_0x100e8d,_0x33e43b,_0x1f290f[_0x191cd2(0x2ef)]?.['toString']()||_0x33e43b,_0xa3dce4[_0x191cd2(0x256)]),{'gateway_payment_id':_0x1f290f[_0x191cd2(0x2ef)]?.[_0x191cd2(0x2e2)](),'payment_url':_0x1f290f[_0x191cd2(0x1d8)],'requires_3ds':!![],'threeds_url':_0x1f290f[_0x191cd2(0x1d8)],'status':_0x191cd2(0x304),'final':![]};let _0x3ed9fe=this[_0x191cd2(0x24f)](_0x1f290f[_0x191cd2(0x205)],_0x1f290f[_0x191cd2(0x235)]||_0x1f290f[_0x191cd2(0x294)]),_0x4e97c0=_0x1f290f[_0x191cd2(0x205)],_0x14e6f8=this[_0x191cd2(0x25c)](_0x1f290f[_0x191cd2(0x205)]);return console[_0x191cd2(0x27c)]('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x4e97c0+_0x191cd2(0x203)+_0x14e6f8+_0x191cd2(0x2a3)+_0x3ed9fe),{'gateway_payment_id':_0x1f290f['payment_id']?.[_0x191cd2(0x2e2)](),'payment_url':_0x5d212c,'requires_3ds':![],'status':_0x191cd2(0x207),'final':!![],'errorMessage':_0x3ed9fe};}catch(_0x4cfd04){console[_0x191cd2(0x1d9)](_0x191cd2(0x289)),console[_0x191cd2(0x1d9)](_0x191cd2(0x1c2),_0x4cfd04),loggerService_1[_0x191cd2(0x2f7)]['logWhiteDomainError'](_0x191cd2(0x1f1),'/charge',_0x4cfd04);throw new Error(_0x191cd2(0x1dd)+(_0x4cfd04 instanceof Error?_0x4cfd04['message']:_0x191cd2(0x1e5)));}}async[a49_0x39aca4(0x21d)](_0xe048ed,_0x32dce6,_0x4619e7='VISA'){const _0x14adea=a49_0x39aca4;console[_0x14adea(0x27c)](_0x14adea(0x2d3)+_0x4619e7+_0x14adea(0x2b1)+_0xe048ed+'\x20('+_0x32dce6+')');try{const _0x3f41d4={'payment_id':_0xe048ed,'order_id':_0x32dce6},_0x3bc083=JSON[_0x14adea(0x2ea)](_0x3f41d4),_0x5f3f35=this[_0x14adea(0x30a)](_0x4619e7===_0x14adea(0x25f)?'4000000000000000':_0x14adea(0x266)),{key:_0x1f3138,iv:_0xee2dae}=this['generateAESKey'](),_0x2c4f5e=this[_0x14adea(0x31f)](_0x3bc083,_0x1f3138,_0xee2dae),_0xfe9d84=this[_0x14adea(0x1c4)](_0x1f3138,_0xee2dae,_0x5f3f35[_0x14adea(0x23d)]),_0x582b91=this['signRSA'](_0x3bc083,_0x5f3f35['privateKeyPath']),_0xcde770={'merchant_point_id':_0x5f3f35[_0x14adea(0x306)],'method':_0x14adea(0x205),'info':_0x2c4f5e,'key':_0xfe9d84,'sign':_0x582b91,'lang':'en'};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x4619e7['toLowerCase'](),_0x14adea(0x2fb),_0x14adea(0x2fa),{'merchant_point_id':_0x5f3f35[_0x14adea(0x306)],'method':_0x14adea(0x205),'lang':'en'});const _0x5eedb6=Date[_0x14adea(0x307)](),_0x4d8752=await fetch(_0x5f3f35[_0x14adea(0x2be)],{'method':_0x14adea(0x2fa),'headers':{'Content-Type':_0x14adea(0x218),'Accept':_0x14adea(0x218),'User-Agent':_0x14adea(0x1d0)},'body':JSON[_0x14adea(0x2ea)](_0xcde770)}),_0x1b0e96=Date[_0x14adea(0x307)]()-_0x5eedb6;if(!_0x4d8752['ok']){const _0x37415f=await _0x4d8752[_0x14adea(0x288)]();loggerService_1[_0x14adea(0x2f7)][_0x14adea(0x1cc)](_0x4619e7[_0x14adea(0x21b)](),_0x14adea(0x2ac),_0x4d8752['status'],_0x37415f,_0x1b0e96);throw new Error(_0x14adea(0x245)+_0x4d8752[_0x14adea(0x205)]);}const _0x21126c=await _0x4d8752[_0x14adea(0x293)]();loggerService_1[_0x14adea(0x2f7)]['logWhiteDomainResponse'](_0x4619e7[_0x14adea(0x21b)](),_0x14adea(0x2ac),_0x4d8752[_0x14adea(0x205)],_0x21126c,_0x1b0e96);let _0x34412d=_0x21126c;if(_0x21126c[_0x14adea(0x1bf)]&&_0x21126c['key']&&_0x21126c['sign']){console[_0x14adea(0x27c)]('🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0x1a8cbb=await this[_0x14adea(0x1c6)](_0x21126c[_0x14adea(0x1bf)],_0x21126c['key'],_0x4619e7);_0x34412d=JSON[_0x14adea(0x227)](_0x1a8cbb),console[_0x14adea(0x27c)](_0x14adea(0x29d)),loggerService_1[_0x14adea(0x2f7)][_0x14adea(0x1cc)](_0x4619e7['toLowerCase'](),'/status_decrypted',_0x4d8752[_0x14adea(0x205)],_0x34412d,_0x1b0e96),console[_0x14adea(0x27c)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x2d125c){console[_0x14adea(0x1d9)](_0x14adea(0x265),_0x2d125c),loggerService_1['loggerService'][_0x14adea(0x2ed)](_0x4619e7[_0x14adea(0x21b)](),'/status_decrypt',_0x14adea(0x319)+_0x2d125c),_0x34412d=_0x21126c;}}else loggerService_1['loggerService'][_0x14adea(0x1cc)](_0x4619e7['toLowerCase'](),_0x14adea(0x20c),_0x4d8752[_0x14adea(0x205)],_0x34412d,_0x1b0e96),console['log'](_0x14adea(0x20f));console[_0x14adea(0x27c)](_0x14adea(0x242),{'status':_0x34412d['status'],'final':_0x34412d['final'],'payment_id':_0x34412d['payment_id'],'desc':_0x34412d[_0x14adea(0x235)]});let _0x1c856a=_0x14adea(0x304);if(_0x34412d[_0x14adea(0x205)]===0x64&&_0x34412d[_0x14adea(0x225)]===0x1)_0x1c856a=_0x14adea(0x309);else{if(_0x34412d[_0x14adea(0x225)]===0x0||!this[_0x14adea(0x25c)](_0x34412d['status']))_0x1c856a=_0x14adea(0x304);else _0x34412d[_0x14adea(0x225)]===0x1||this['isFinalStatus'](_0x34412d[_0x14adea(0x205)])?_0x1c856a=_0x14adea(0x207):_0x1c856a=_0x14adea(0x304);}const _0x3ed376=this[_0x14adea(0x24f)](_0x34412d[_0x14adea(0x205)],_0x34412d[_0x14adea(0x235)]);return{'status':_0x1c856a,'final':this['isFinalStatus'](_0x34412d[_0x14adea(0x205)]),'amount':_0x34412d[_0x14adea(0x25a)],'currency':_0x34412d[_0x14adea(0x31e)],'date_success':_0x34412d['date_success'],'description':_0x3ed376};}catch(_0x36e0ac){console['error'](_0x4619e7+'\x20status\x20check\x20error:',_0x36e0ac),loggerService_1[_0x14adea(0x2f7)][_0x14adea(0x2ed)](_0x4619e7[_0x14adea(0x21b)](),'/status',_0x36e0ac);throw new Error(_0x14adea(0x2ec)+_0x4619e7+_0x14adea(0x2b1)+(_0x36e0ac instanceof Error?_0x36e0ac[_0x14adea(0x294)]:_0x14adea(0x1e5)));}}[a49_0x39aca4(0x2ee)](_0x366a40,_0x4583a2,_0x3bc25f,_0x40dd66){const _0x4eb43a=a49_0x39aca4;console[_0x4eb43a(0x27c)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20'+_0x40dd66+_0x4eb43a(0x303)+_0x366a40+'\x20('+_0x3bc25f+')'),this[_0x4eb43a(0x2a8)](_0x366a40);const _0x111dc5=[],_0x2d5995=0x5*0x3c*0x3e8,_0x50c363=0x2*0x3c*0x3c*0x3e8,_0x155b5b=Math['floor'](_0x50c363/_0x2d5995);console['log'](_0x4eb43a(0x2fe)+_0x155b5b+_0x4eb43a(0x2cf));for(let _0x4ebfdb=0x1;_0x4ebfdb<=_0x155b5b;_0x4ebfdb++){const _0x19b105=setTimeout(async()=>{const _0x365cdf=_0x4eb43a;console[_0x365cdf(0x27c)](_0x365cdf(0x238)+_0x40dd66+'\x20status\x20check\x20#'+_0x4ebfdb+'/'+_0x155b5b+_0x365cdf(0x1cb)+_0x366a40);try{const _0x4ff33c=await this[_0x365cdf(0x21d)](_0x3bc25f,_0x4583a2,_0x40dd66);console['log'](_0x365cdf(0x247)+_0x4ebfdb+_0x365cdf(0x22d),_0x4ff33c),_0x4ff33c[_0x365cdf(0x225)]&&(console[_0x365cdf(0x27c)]('✅\x20Payment\x20'+_0x366a40+'\x20is\x20final\x20('+_0x4ff33c[_0x365cdf(0x205)]+_0x365cdf(0x2cb)),this[_0x365cdf(0x2a8)](_0x366a40),await this[_0x365cdf(0x301)](_0x366a40,_0x4ff33c[_0x365cdf(0x205)],_0x4ff33c));}catch(_0x227871){console[_0x365cdf(0x1d9)](_0x365cdf(0x1f3)+_0x4ebfdb+'\x20failed\x20for\x20payment\x20'+_0x366a40+':',_0x227871);}},_0x4ebfdb*_0x2d5995);_0x111dc5[_0x4eb43a(0x22c)](_0x19b105);}this[_0x4eb43a(0x2e6)]['set'](_0x366a40,_0x111dc5),console[_0x4eb43a(0x27c)](_0x4eb43a(0x228)+_0x155b5b+'\x20status\x20checks\x20for\x20payment\x20'+_0x366a40);}[a49_0x39aca4(0x2a8)](_0x58b581){const _0xa7763=a49_0x39aca4,_0x5ef010=this[_0xa7763(0x2e6)][_0xa7763(0x2f0)](_0x58b581);_0x5ef010&&(console['log'](_0xa7763(0x20a)+_0x5ef010['length']+_0xa7763(0x20b)+_0x58b581),_0x5ef010[_0xa7763(0x2dd)]((_0x198a85,_0x32bef1)=>{clearTimeout(_0x198a85);}),this['statusCheckTimers'][_0xa7763(0x2b8)](_0x58b581));}async[a49_0x39aca4(0x301)](_0x1367a2,_0x7e9ddf,_0xeb915d){const _0x526720=a49_0x39aca4;try{const _0x269cde=(await Promise[_0x526720(0x24b)]()[_0x526720(0x29e)](()=>__importStar(require('../../config/database'))))[_0x526720(0x20e)],_0x2c7626={'status':_0x7e9ddf['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x526720(0x26f),'statusChangedAt':new Date()};_0x7e9ddf===_0x526720(0x309)&&(_0x2c7626[_0x526720(0x1f7)]=new Date()),_0x7e9ddf==='FAILED'&&_0xeb915d[_0x526720(0x1df)]&&(_0x2c7626[_0x526720(0x229)]=_0xeb915d['description'],console[_0x526720(0x27c)](_0x526720(0x1f4)+_0xeb915d['description'])),_0xeb915d[_0x526720(0x1df)]&&(_0x2c7626[_0x526720(0x30c)]=(_0x7e9ddf===_0x526720(0x309)?_0x526720(0x219):_0x526720(0x1c5))+':\x20'+_0xeb915d[_0x526720(0x1df)]),await _0x269cde['payment'][_0x526720(0x273)]({'where':{'id':_0x1367a2},'data':_0x2c7626}),console['log']('✅\x20Payment\x20'+_0x1367a2+_0x526720(0x2cd)+_0x7e9ddf),await this[_0x526720(0x1ee)](_0x1367a2,_0x7e9ddf);}catch(_0x1ffa3b){console[_0x526720(0x1d9)](_0x526720(0x251)+_0x1367a2+':',_0x1ffa3b);}}async[a49_0x39aca4(0x1ee)](_0x243302,_0x399e0e){const _0x3c79ba=a49_0x39aca4;try{const _0x493d6b=(await Promise[_0x3c79ba(0x24b)]()['then'](()=>__importStar(require(_0x3c79ba(0x24c)))))[_0x3c79ba(0x20e)],{telegramBotService:_0x3a9035}=await Promise[_0x3c79ba(0x24b)]()['then'](()=>__importStar(require('../telegramBotService'))),_0x535240=await _0x493d6b['payment'][_0x3c79ba(0x221)]({'where':{'id':_0x243302},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x535240)return;const _0x437e09={'PAID':_0x3c79ba(0x276),'FAILED':_0x3c79ba(0x280)},_0x3b7e11=_0x437e09[_0x399e0e];_0x3b7e11&&await _0x3a9035[_0x3c79ba(0x316)](_0x535240[_0x3c79ba(0x314)],_0x535240,_0x3b7e11),await this[_0x3c79ba(0x202)](_0x535240,_0x399e0e);}catch(_0x57eb0e){console[_0x3c79ba(0x1d9)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x57eb0e);}}async['sendShopWebhook'](_0x4ac33b,_0x43b3e8){const _0x5b1341=a49_0x39aca4,_0x29ab28=Date['now']();try{const _0x1b69ab=_0x4ac33b[_0x5b1341(0x257)],_0x36b68a=_0x1b69ab[_0x5b1341(0x296)];if(!_0x36b68a?.[_0x5b1341(0x291)]){console[_0x5b1341(0x27c)](_0x5b1341(0x2fd)+_0x1b69ab['id']);return;}const _0x1ab855=_0x43b3e8===_0x5b1341(0x309)?'payment.success':'payment.failed';let _0x41750f=[];if(_0x36b68a[_0x5b1341(0x2f9)])try{_0x41750f=Array[_0x5b1341(0x278)](_0x36b68a[_0x5b1341(0x2f9)])?_0x36b68a[_0x5b1341(0x2f9)]:JSON[_0x5b1341(0x227)](_0x36b68a[_0x5b1341(0x2f9)]);}catch(_0x14feb3){console['error'](_0x5b1341(0x1e7),_0x14feb3),_0x41750f=[];}if(!_0x41750f[_0x5b1341(0x255)](_0x1ab855)){console['log'](_0x5b1341(0x2b3)+_0x1ab855+_0x5b1341(0x1e6)+_0x1b69ab['id']);return;}const _0x2de8f0={'event':_0x1ab855,'payment':{'id':_0x4ac33b['id'],'order_id':_0x4ac33b[_0x5b1341(0x313)],'gateway_order_id':_0x4ac33b[_0x5b1341(0x27f)],'gateway':_0x5b1341(0x2c2),'amount':_0x4ac33b['amount'],'currency':_0x4ac33b['currency'],'status':_0x43b3e8['toLowerCase'](),'customer_email':_0x4ac33b[_0x5b1341(0x248)],'customer_name':_0x4ac33b[_0x5b1341(0x252)],'created_at':_0x4ac33b[_0x5b1341(0x2d0)],'updated_at':new Date()}},_0x2508a5=await fetch(_0x36b68a[_0x5b1341(0x291)],{'method':_0x5b1341(0x2fa),'headers':{'Content-Type':_0x5b1341(0x218),'User-Agent':_0x5b1341(0x223)},'body':JSON[_0x5b1341(0x2ea)](_0x2de8f0)}),_0x263aea=Date['now']()-_0x29ab28;loggerService_1['loggerService'][_0x5b1341(0x2df)](_0x4ac33b[_0x5b1341(0x314)],_0x36b68a[_0x5b1341(0x291)],_0x1ab855,_0x2508a5[_0x5b1341(0x205)],_0x263aea,_0x2de8f0),console[_0x5b1341(0x27c)](_0x5b1341(0x208)+_0x36b68a[_0x5b1341(0x291)]+'\x20with\x20status\x20'+_0x2508a5[_0x5b1341(0x205)]+'\x20('+_0x263aea+'ms)');}catch(_0x151b58){console[_0x5b1341(0x1d9)](_0x5b1341(0x250),_0x151b58),loggerService_1[_0x5b1341(0x2f7)][_0x5b1341(0x1e4)](_0x4ac33b[_0x5b1341(0x314)],_0x4ac33b[_0x5b1341(0x257)]?.[_0x5b1341(0x296)]?.[_0x5b1341(0x291)]||'unknown','webhook_send',_0x151b58,{});}}[a49_0x39aca4(0x268)](_0xc424d7){const _0x2583b4=a49_0x39aca4,_0x53badb=_0xc424d7['replace'](/[\s-]/g,'');if(_0x53badb[_0x2583b4(0x21e)]<0x4)return _0x2583b4(0x1e2);return _0x2583b4(0x1d7)+_0x53badb[_0x2583b4(0x2db)](-0x4);}async[a49_0x39aca4(0x25b)](_0x5c5260,_0x997631='MASTERCARD'){const _0x254c6d=a49_0x39aca4;console[_0x254c6d(0x27c)](_0x254c6d(0x2b2),JSON[_0x254c6d(0x2ea)](_0x5c5260,null,0x2));let _0xbfdebd=_0x5c5260,_0x3a7c21=_0x997631;_0x5c5260[_0x254c6d(0x2a2)]?(_0x3a7c21=_0x5c5260['card_type']['toUpperCase']()==='VISA'?_0x254c6d(0x25f):'MASTERCARD',console[_0x254c6d(0x27c)]('🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20'+_0x3a7c21)):console[_0x254c6d(0x27c)](_0x254c6d(0x236)+_0x3a7c21);if(_0x5c5260[_0x254c6d(0x1bf)]&&_0x5c5260[_0x254c6d(0x2de)]&&_0x5c5260[_0x254c6d(0x1d2)]){console[_0x254c6d(0x27c)](_0x254c6d(0x210));try{const _0x520e8a=await this[_0x254c6d(0x1c6)](_0x5c5260[_0x254c6d(0x1bf)],_0x5c5260[_0x254c6d(0x2de)],_0x3a7c21);_0xbfdebd=JSON['parse'](_0x520e8a),console[_0x254c6d(0x27c)](_0x254c6d(0x211)),console['log']('📝\x20Decrypted\x20webhook\x20data:',JSON[_0x254c6d(0x2ea)](_0xbfdebd,null,0x2));}catch(_0x591e8b){console[_0x254c6d(0x1d9)](_0x254c6d(0x25d),_0x591e8b),console[_0x254c6d(0x27c)](_0x254c6d(0x244)),_0xbfdebd=_0x5c5260;}}else console['log'](_0x254c6d(0x28f));let _0x36d44a='PENDING';if(_0xbfdebd['status']===0x64&&_0xbfdebd[_0x254c6d(0x225)]===0x1)_0x36d44a=_0x254c6d(0x309);else{if(_0xbfdebd[_0x254c6d(0x225)]===0x0||!this[_0x254c6d(0x25c)](_0xbfdebd[_0x254c6d(0x205)]))_0x36d44a=_0x254c6d(0x304);else _0xbfdebd[_0x254c6d(0x225)]===0x1||this[_0x254c6d(0x25c)](_0xbfdebd[_0x254c6d(0x205)])?_0x36d44a='FAILED':_0x36d44a='PENDING';}let _0x1578f9='';if(_0xbfdebd[_0x254c6d(0x2bc)])_0x1578f9=_0xbfdebd['order_id'][_0x254c6d(0x2e2)](),console[_0x254c6d(0x27c)](_0x254c6d(0x254)+_0x3a7c21+_0x254c6d(0x26a)+_0x1578f9);else _0xbfdebd['payment_id']?(_0x1578f9=_0xbfdebd['payment_id']['toString'](),console[_0x254c6d(0x27c)]('🔍\x20Using\x20'+_0x3a7c21+_0x254c6d(0x1e3)+_0x1578f9)):(_0x1578f9=_0xbfdebd[_0x254c6d(0x313)]||_0xbfdebd['paymentId']||_0xbfdebd['id']||'',console[_0x254c6d(0x27c)](_0x254c6d(0x1dc)+_0x1578f9));console[_0x254c6d(0x27c)]('📊\x20'+_0x3a7c21+_0x254c6d(0x274)),console[_0x254c6d(0x27c)](_0x254c6d(0x28e)+_0x1578f9+_0x254c6d(0x315)+_0xbfdebd['order_id']+_0x254c6d(0x2d9)+_0xbfdebd[_0x254c6d(0x313)]+_0x254c6d(0x295)+_0xbfdebd[_0x254c6d(0x2ef)]+',\x20paymentId='+_0xbfdebd[_0x254c6d(0x231)]+_0x254c6d(0x2b9)+_0xbfdebd['id']+')'),console['log'](_0x254c6d(0x2c7)+_0x36d44a+'\x20(from:\x20status='+_0xbfdebd[_0x254c6d(0x205)]+',\x20final='+_0xbfdebd['final']+')'),console[_0x254c6d(0x27c)]('\x20\x20\x20Amount:\x20'+_0xbfdebd[_0x254c6d(0x25a)]),console[_0x254c6d(0x27c)](_0x254c6d(0x240)+_0xbfdebd[_0x254c6d(0x31e)]);let _0x5a12b4;_0x36d44a===_0x254c6d(0x207)&&(_0x5a12b4=this[_0x254c6d(0x24f)](_0xbfdebd[_0x254c6d(0x205)],_0xbfdebd[_0x254c6d(0x235)]),console[_0x254c6d(0x27c)](_0x254c6d(0x28b)+_0x5a12b4));const _0x38a723={'paymentId':_0x1578f9,'status':_0x36d44a,'amount':_0xbfdebd[_0x254c6d(0x25a)],'currency':_0xbfdebd['currency']};return _0x5a12b4&&(_0x38a723[_0x254c6d(0x1c8)]=_0x5a12b4),_0x38a723;}[a49_0x39aca4(0x1fb)](){const _0x54b732=a49_0x39aca4;console['log'](_0x54b732(0x312));const _0x357cdf=this[_0x54b732(0x2e6)][_0x54b732(0x1f5)];for(const [_0x344776]of this['statusCheckTimers']){this[_0x54b732(0x2a8)](_0x344776);}console[_0x54b732(0x27c)](_0x54b732(0x1eb)+_0x357cdf+_0x54b732(0x272));}}exports[a49_0x39aca4(0x305)]=VisaMasterCardService;