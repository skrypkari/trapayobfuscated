'use strict';const a42_0x88f09=a42_0x3a15;(function(_0x25bf6a,_0x1be063){const _0xa9d2c0=a42_0x3a15,_0x2c2146=_0x25bf6a();while(!![]){try{const _0x32250f=-parseInt(_0xa9d2c0(0x1a4))/0x1+parseInt(_0xa9d2c0(0x196))/0x2+parseInt(_0xa9d2c0(0x12b))/0x3*(-parseInt(_0xa9d2c0(0x145))/0x4)+-parseInt(_0xa9d2c0(0x1fa))/0x5+parseInt(_0xa9d2c0(0x1ae))/0x6+parseInt(_0xa9d2c0(0x140))/0x7+-parseInt(_0xa9d2c0(0x167))/0x8*(-parseInt(_0xa9d2c0(0x14c))/0x9);if(_0x32250f===_0x1be063)break;else _0x2c2146['push'](_0x2c2146['shift']());}catch(_0x3514d6){_0x2c2146['push'](_0x2c2146['shift']());}}}(a42_0x5e9a,0xd83df));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x42e9ac,_0x3a15c9,_0x3477a2,_0x43eb77){const _0x659d33=a42_0x3a15;if(_0x43eb77===undefined)_0x43eb77=_0x3477a2;var _0xf3bf52=Object['getOwnPropertyDescriptor'](_0x3a15c9,_0x3477a2);(!_0xf3bf52||(_0x659d33(0x12a)in _0xf3bf52?!_0x3a15c9[_0x659d33(0x194)]:_0xf3bf52['writable']||_0xf3bf52['configurable']))&&(_0xf3bf52={'enumerable':!![],'get':function(){return _0x3a15c9[_0x3477a2];}}),Object[_0x659d33(0x1e0)](_0x42e9ac,_0x43eb77,_0xf3bf52);}:function(_0x2e7bab,_0xc905f7,_0x440a8e,_0x43ab2f){if(_0x43ab2f===undefined)_0x43ab2f=_0x440a8e;_0x2e7bab[_0x43ab2f]=_0xc905f7[_0x440a8e];}),__setModuleDefault=this&&this[a42_0x88f09(0x16e)]||(Object[a42_0x88f09(0x117)]?function(_0x1c723b,_0x2d7f8b){const _0xee62e3=a42_0x88f09;Object[_0xee62e3(0x1e0)](_0x1c723b,'default',{'enumerable':!![],'value':_0x2d7f8b});}:function(_0x1057a5,_0x22854c){_0x1057a5['default']=_0x22854c;}),__importStar=this&&this[a42_0x88f09(0x153)]||(function(){var _0x5b8184=function(_0x597774){const _0x2beb83=a42_0x3a15;return _0x5b8184=Object[_0x2beb83(0x1a5)]||function(_0xaff58f){const _0xd22fc=_0x2beb83;var _0x2791a4=[];for(var _0x48a95f in _0xaff58f)if(Object[_0xd22fc(0x131)][_0xd22fc(0x1ec)][_0xd22fc(0x15b)](_0xaff58f,_0x48a95f))_0x2791a4[_0x2791a4[_0xd22fc(0x172)]]=_0x48a95f;return _0x2791a4;},_0x5b8184(_0x597774);};return function(_0x43ab66){const _0x17bafa=a42_0x3a15;if(_0x43ab66&&_0x43ab66['__esModule'])return _0x43ab66;var _0x27c0db={};if(_0x43ab66!=null){for(var _0x13bb1a=_0x5b8184(_0x43ab66),_0xfdbbee=0x0;_0xfdbbee<_0x13bb1a[_0x17bafa(0x172)];_0xfdbbee++)if(_0x13bb1a[_0xfdbbee]!==_0x17bafa(0x1a3))__createBinding(_0x27c0db,_0x43ab66,_0x13bb1a[_0xfdbbee]);}return __setModuleDefault(_0x27c0db,_0x43ab66),_0x27c0db;};}()),__importDefault=this&&this[a42_0x88f09(0x1a0)]||function(_0x58ccaf){return _0x58ccaf&&_0x58ccaf['__esModule']?_0x58ccaf:{'default':_0x58ccaf};};Object[a42_0x88f09(0x1e0)](exports,a42_0x88f09(0x194),{'value':!![]}),exports['MasterCardService']=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x88f09(0x1b3))),loggerService_1=require(a42_0x88f09(0x179));function a42_0x3a15(_0x338631,_0x2da166){const _0x5e9a69=a42_0x5e9a();return a42_0x3a15=function(_0x3a151d,_0x12cba3){_0x3a151d=_0x3a151d-0x116;let _0x1853aa=_0x5e9a69[_0x3a151d];return _0x1853aa;},a42_0x3a15(_0x338631,_0x2da166);}class MasterCardService{constructor(){const _0x5bcb7a=a42_0x88f09;this[_0x5bcb7a(0x18e)]=new Map(),this[_0x5bcb7a(0x151)]=_0x5bcb7a(0x1af),this[_0x5bcb7a(0x200)]=0x67c,this[_0x5bcb7a(0x18a)]=path_1[_0x5bcb7a(0x1a3)][_0x5bcb7a(0x12f)](process[_0x5bcb7a(0x1d3)](),_0x5bcb7a(0x130),_0x5bcb7a(0x15d)),this['publicKeyPath']=path_1[_0x5bcb7a(0x1a3)][_0x5bcb7a(0x12f)](process[_0x5bcb7a(0x1d3)](),_0x5bcb7a(0x130),_0x5bcb7a(0x1e3)),console[_0x5bcb7a(0x181)](_0x5bcb7a(0x11a)),console[_0x5bcb7a(0x181)](_0x5bcb7a(0x1fd),this[_0x5bcb7a(0x18a)]),console[_0x5bcb7a(0x181)](_0x5bcb7a(0x1c3),this[_0x5bcb7a(0x143)]),this[_0x5bcb7a(0x1d1)]();}[a42_0x88f09(0x1d1)](){const _0x5f5ce1=a42_0x88f09;try{if(!fs_1[_0x5f5ce1(0x1a3)]['existsSync'](this['privateKeyPath']))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this[_0x5f5ce1(0x18a)]);if(!fs_1[_0x5f5ce1(0x1a3)][_0x5f5ce1(0x208)](this['publicKeyPath']))throw new Error(_0x5f5ce1(0x160)+this[_0x5f5ce1(0x143)]);const _0x365a3b=fs_1[_0x5f5ce1(0x1a3)][_0x5f5ce1(0x1c9)](this[_0x5f5ce1(0x18a)],_0x5f5ce1(0x1c7))['trim'](),_0x148ec6=fs_1[_0x5f5ce1(0x1a3)][_0x5f5ce1(0x1c9)](this[_0x5f5ce1(0x143)],_0x5f5ce1(0x1c7))[_0x5f5ce1(0x189)]();if(!_0x365a3b[_0x5f5ce1(0x148)](_0x5f5ce1(0x1f4))||!_0x365a3b['includes'](_0x5f5ce1(0x1c0)))throw new Error(_0x5f5ce1(0x169));if(!_0x148ec6[_0x5f5ce1(0x148)](_0x5f5ce1(0x1f4))||!_0x148ec6[_0x5f5ce1(0x148)]('-----END'))throw new Error(_0x5f5ce1(0x175));console[_0x5f5ce1(0x181)](_0x5f5ce1(0x147)),console[_0x5f5ce1(0x181)]('🔐\x20Private\x20key\x20length:\x20'+_0x365a3b['length']+_0x5f5ce1(0x15a)),console[_0x5f5ce1(0x181)](_0x5f5ce1(0x1d4)+_0x148ec6[_0x5f5ce1(0x172)]+_0x5f5ce1(0x15a));}catch(_0x1910be){console[_0x5f5ce1(0x128)]('❌\x20MasterCard\x20key\x20validation\x20failed:',_0x1910be);throw _0x1910be;}}[a42_0x88f09(0x19d)](){const _0x2bd4af=a42_0x88f09,_0x5e90b4=crypto_1[_0x2bd4af(0x1a3)][_0x2bd4af(0x15f)](0x20),_0x7b6b90=crypto_1[_0x2bd4af(0x1a3)][_0x2bd4af(0x15f)](0x10);return{'key':_0x5e90b4,'iv':_0x7b6b90};}[a42_0x88f09(0x1d5)](_0x15b189,_0x269d10,_0x383ceb){const _0x55808f=a42_0x88f09,_0x386cbc=crypto_1[_0x55808f(0x1a3)]['createCipheriv'](_0x55808f(0x201),_0x269d10,_0x383ceb);let _0x5c4f41=_0x386cbc[_0x55808f(0x1c8)](_0x15b189,'utf8','base64');return _0x5c4f41+=_0x386cbc[_0x55808f(0x13a)](_0x55808f(0x158)),_0x5c4f41;}[a42_0x88f09(0x1e7)](_0xf2d653,_0x29ae8e){const _0x4afe83=a42_0x88f09;try{const _0x58dce6=fs_1[_0x4afe83(0x1a3)][_0x4afe83(0x1c9)](this[_0x4afe83(0x143)],'utf8')['trim'](),_0x3f2c92={'iv':_0x29ae8e[_0x4afe83(0x11c)](_0x4afe83(0x158)),'key':_0xf2d653[_0x4afe83(0x11c)](_0x4afe83(0x158))},_0x1e8452=JSON[_0x4afe83(0x1cb)](_0x3f2c92);console[_0x4afe83(0x181)](_0x4afe83(0x17a),_0x1e8452[_0x4afe83(0x172)]);const _0x1611a5=crypto_1['default'][_0x4afe83(0x152)]({'key':_0x58dce6,'padding':crypto_1[_0x4afe83(0x1a3)][_0x4afe83(0x1b2)][_0x4afe83(0x1a9)]},Buffer['from'](_0x1e8452));return console[_0x4afe83(0x181)](_0x4afe83(0x11b),_0x1611a5[_0x4afe83(0x172)]),_0x1611a5[_0x4afe83(0x11c)]('base64');}catch(_0x5da315){console[_0x4afe83(0x128)](_0x4afe83(0x14a),_0x5da315);throw new Error(_0x4afe83(0x12c));}}[a42_0x88f09(0x14d)](_0x42b933){const _0x4d5c67=a42_0x88f09;try{const _0x4f5b34=fs_1[_0x4d5c67(0x1a3)][_0x4d5c67(0x1c9)](this['privateKeyPath'],_0x4d5c67(0x1c7))[_0x4d5c67(0x189)](),_0x36eaad=crypto_1[_0x4d5c67(0x1a3)][_0x4d5c67(0x1ea)](_0x4d5c67(0x1ee));_0x36eaad[_0x4d5c67(0x1c8)](_0x42b933),_0x36eaad[_0x4d5c67(0x170)]();const _0x3846c7=_0x36eaad[_0x4d5c67(0x17e)](_0x4f5b34,'base64');return console['log'](_0x4d5c67(0x16b)),console['log'](_0x4d5c67(0x13e),_0x42b933[_0x4d5c67(0x172)]),console[_0x4d5c67(0x181)](_0x4d5c67(0x1b4),_0x3846c7[_0x4d5c67(0x172)]),_0x3846c7;}catch(_0x3fd1a4){console['error'](_0x4d5c67(0x1f5),_0x3fd1a4),console[_0x4d5c67(0x128)](_0x4d5c67(0x17b),_0x42b933['substring'](0x0,0xc8)+_0x4d5c67(0x16c));throw new Error(_0x4d5c67(0x1da));}}[a42_0x88f09(0x1c5)](_0x248513,_0x59fbee,_0x15f83f){const _0x3a1de9=a42_0x88f09,_0x4d0c9a=crypto_1[_0x3a1de9(0x1a3)]['createDecipheriv'](_0x3a1de9(0x201),_0x59fbee,_0x15f83f);let _0x48ec71=_0x4d0c9a[_0x3a1de9(0x1c8)](_0x248513,_0x3a1de9(0x158),_0x3a1de9(0x1c7));return _0x48ec71+=_0x4d0c9a[_0x3a1de9(0x13a)]('utf8'),_0x48ec71;}async['decryptResponsePhp'](_0x7559fa,_0x33826e){const _0x48308e=a42_0x88f09;try{const _0x53a242=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x48308e(0x12e),'headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'info':_0x7559fa,'key':_0x33826e})});if(!_0x53a242['ok'])throw new Error(_0x48308e(0x1ff));return await _0x53a242[_0x48308e(0x1dc)]();}catch(_0x949d10){console[_0x48308e(0x128)](_0x48308e(0x177),_0x949d10);throw new Error(_0x48308e(0x1b8));}}[a42_0x88f09(0x1d6)](_0x5216a8,_0x3fe67f){const _0x3aefab=a42_0x88f09;try{const _0x323fdf=fs_1[_0x3aefab(0x1a3)][_0x3aefab(0x1c9)](this[_0x3aefab(0x18a)],_0x3aefab(0x1c7))[_0x3aefab(0x189)](),_0x282881=crypto_1[_0x3aefab(0x1a3)][_0x3aefab(0x1ef)](_0x323fdf,Buffer['from'](_0x3fe67f,'base64')),_0x23cfff=JSON[_0x3aefab(0x1f3)](_0x282881[_0x3aefab(0x11c)]()),_0x546da8=Buffer[_0x3aefab(0x150)](_0x23cfff[_0x3aefab(0x1b7)],_0x3aefab(0x158)),_0x14b5c7=Buffer['from'](_0x23cfff['iv'],'base64');return this[_0x3aefab(0x1c5)](_0x5216a8,_0x546da8,_0x14b5c7);}catch(_0x5bea8e){throw new Error(_0x3aefab(0x125));}}async[a42_0x88f09(0x133)](_0x240743){const _0x400a49=a42_0x88f09,{paymentId:_0x334403,orderId:_0x286af0,amount:_0x3ec95c,currency:_0x12d3bf,cardData:_0x3b05f8,resultUrl:_0x20b891,returnUrl:_0x36bdf0,cardHolder:_0x3b2e4c,browser:_0x38cd30}=_0x240743;console[_0x400a49(0x181)](_0x400a49(0x1b9)),console[_0x400a49(0x181)](_0x400a49(0x187),_0x334403),console[_0x400a49(0x181)]('Order\x20ID:',_0x286af0),console[_0x400a49(0x181)](_0x400a49(0x1c4),_0x3ec95c,_0x12d3bf),console[_0x400a49(0x181)](_0x400a49(0x156),this[_0x400a49(0x1cc)](_0x3b05f8[_0x400a49(0x1ed)])),console['log']('Card\x20Holder:',_0x3b2e4c[_0x400a49(0x149)]+'\x20'+_0x3b2e4c[_0x400a49(0x197)]),console[_0x400a49(0x181)]('Return\x20URL:',_0x36bdf0),console['log'](_0x400a49(0x191),_0x20b891);const _0x27a2d1={'amount':_0x3ec95c,'currency':_0x12d3bf[_0x400a49(0x1b6)](),'order_id':_0x286af0,'result_url':_0x20b891,'return_url':_0x36bdf0,'card':{'number':_0x3b05f8[_0x400a49(0x1ed)],'expire_month':_0x3b05f8[_0x400a49(0x186)],'expire_year':_0x3b05f8[_0x400a49(0x1f0)],'cvv':_0x3b05f8['cvv']},'card_holder':_0x3b2e4c,'browser':_0x38cd30},_0x5af250=JSON[_0x400a49(0x1cb)](_0x27a2d1);console[_0x400a49(0x181)](_0x400a49(0x142)),console['log'](_0x400a49(0x188)),console[_0x400a49(0x181)](_0x5af250),console[_0x400a49(0x181)](_0x400a49(0x118),_0x5af250[_0x400a49(0x172)]);try{const {key:_0x49f672,iv:_0x206b4a}=this[_0x400a49(0x19d)]();console[_0x400a49(0x181)](_0x400a49(0x12d)),console[_0x400a49(0x181)]('🔐\x20AES\x20key\x20length:',_0x49f672[_0x400a49(0x172)]),console[_0x400a49(0x181)](_0x400a49(0x154),_0x206b4a[_0x400a49(0x172)]);const _0x2140ae=this['encryptAES'](_0x5af250,_0x49f672,_0x206b4a);console[_0x400a49(0x181)](_0x400a49(0x19e)),console[_0x400a49(0x181)](_0x400a49(0x14b),_0x2140ae[_0x400a49(0x172)]);const _0x3ab3ee=this['encryptRSA'](_0x49f672,_0x206b4a);console[_0x400a49(0x181)](_0x400a49(0x126)),console['log']('📝\x20Encrypted\x20key\x20length:',_0x3ab3ee[_0x400a49(0x172)]);const _0x15df95=this['signRSA'](_0x5af250);console['log']('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x400a49(0x181)](_0x400a49(0x1b4),_0x15df95[_0x400a49(0x172)]);const _0x1af98a={'merchant_point_id':this[_0x400a49(0x200)],'method':_0x400a49(0x180),'info':_0x2140ae,'key':_0x3ab3ee,'sign':_0x15df95,'lang':'en'};console['log'](_0x400a49(0x198)),console[_0x400a49(0x181)](_0x400a49(0x1be)),console[_0x400a49(0x181)](_0x400a49(0x1e6),this[_0x400a49(0x200)]),console['log'](_0x400a49(0x1c1)),console['log']('\x20\x20\x20-\x20info\x20length:',_0x2140ae[_0x400a49(0x172)]),console[_0x400a49(0x181)](_0x400a49(0x11d),_0x3ab3ee[_0x400a49(0x172)]),console[_0x400a49(0x181)](_0x400a49(0x176),_0x15df95[_0x400a49(0x172)]),console[_0x400a49(0x181)](_0x400a49(0x137)),loggerService_1['loggerService'][_0x400a49(0x1de)](_0x400a49(0x13b),_0x400a49(0x1eb),_0x400a49(0x12e),{'merchant_point_id':this[_0x400a49(0x200)],'method':_0x400a49(0x180),'lang':'en'});const _0x1f440a=Date['now'](),_0x4c01a2=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x400a49(0x16d),'User-Agent':_0x400a49(0x162)},'body':JSON[_0x400a49(0x1cb)](_0x1af98a)}),_0x50dccb=Date[_0x400a49(0x18b)]()-_0x1f440a;console['log']('===\x20MASTERCARD\x20API\x20RESPONSE\x20==='),console['log'](_0x400a49(0x171),_0x4c01a2[_0x400a49(0x1d8)]),console[_0x400a49(0x181)](_0x400a49(0x1fc),_0x50dccb+'ms');if(!_0x4c01a2['ok']){const _0x4ecf7c=await _0x4c01a2[_0x400a49(0x1dc)]();console[_0x400a49(0x128)](_0x400a49(0x116),_0x4c01a2[_0x400a49(0x1d8)]),console[_0x400a49(0x128)]('Response\x20Body:',_0x4ecf7c),loggerService_1[_0x400a49(0x1ce)]['logWhiteDomainResponse'](_0x400a49(0x13b),_0x400a49(0x13c),_0x4c01a2[_0x400a49(0x1d8)],_0x4ecf7c,_0x50dccb),loggerService_1[_0x400a49(0x1ce)][_0x400a49(0x195)]('mastercard',_0x400a49(0x1eb),_0x400a49(0x144)+_0x4c01a2[_0x400a49(0x1d8)]+':\x20'+_0x4ecf7c);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4c01a2[_0x400a49(0x1d8)]+_0x400a49(0x1df)+_0x4ecf7c);}const _0x211410=await _0x4c01a2[_0x400a49(0x192)]();loggerService_1[_0x400a49(0x1ce)][_0x400a49(0x207)](_0x400a49(0x13b),'/charge_raw',_0x4c01a2[_0x400a49(0x1d8)],_0x211410,_0x50dccb),console[_0x400a49(0x181)](_0x400a49(0x1d7));let _0x4d06d1=_0x211410;if(_0x211410[_0x400a49(0x16a)]&&_0x211410[_0x400a49(0x1b7)]&&_0x211410[_0x400a49(0x17e)]){console[_0x400a49(0x181)](_0x400a49(0x11e));try{const _0x4e09c9=await this[_0x400a49(0x173)](_0x211410[_0x400a49(0x16a)],_0x211410[_0x400a49(0x1b7)]);_0x4d06d1=JSON[_0x400a49(0x1f3)](_0x4e09c9),console['log'](_0x400a49(0x1f6)),loggerService_1['loggerService'][_0x400a49(0x207)](_0x400a49(0x13b),'/charge_decrypted',_0x4c01a2[_0x400a49(0x1d8)],_0x4d06d1,_0x50dccb),console[_0x400a49(0x181)](_0x400a49(0x136));}catch(_0x163ec5){console[_0x400a49(0x128)](_0x400a49(0x124),_0x163ec5),loggerService_1[_0x400a49(0x1ce)][_0x400a49(0x195)](_0x400a49(0x13b),'/charge_decrypt',_0x400a49(0x19c)+_0x163ec5),_0x4d06d1=_0x211410;}}else loggerService_1[_0x400a49(0x1ce)]['logWhiteDomainResponse']('mastercard',_0x400a49(0x1ab),_0x4c01a2[_0x400a49(0x1d8)],_0x4d06d1,_0x50dccb),console[_0x400a49(0x181)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x400a49(0x181)](_0x400a49(0x171),_0x4d06d1['status']),console['log'](_0x400a49(0x19a),_0x4d06d1[_0x400a49(0x13a)]),console[_0x400a49(0x181)](_0x400a49(0x187),_0x4d06d1[_0x400a49(0x166)]),console['log'](_0x400a49(0x1aa),_0x4d06d1['3ds_url']||_0x400a49(0x165));if(_0x4d06d1[_0x400a49(0x1d8)]===0x64&&_0x4d06d1[_0x400a49(0x13a)]===0x1)return console[_0x400a49(0x181)](_0x400a49(0x14e)),{'gateway_payment_id':_0x4d06d1[_0x400a49(0x166)]?.[_0x400a49(0x11c)](),'payment_url':_0x36bdf0,'requires_3ds':![],'status':_0x400a49(0x20a),'final':!![]};if(_0x4d06d1[_0x400a49(0x157)])return console[_0x400a49(0x181)]('🔐\x203DS\x20verification\x20required'),this[_0x400a49(0x209)](_0x334403,_0x286af0,_0x4d06d1[_0x400a49(0x166)]?.['toString']()||_0x286af0),{'gateway_payment_id':_0x4d06d1[_0x400a49(0x166)]?.[_0x400a49(0x11c)](),'payment_url':_0x4d06d1['3ds_url'],'requires_3ds':!![],'threeds_url':_0x4d06d1['3ds_url'],'status':_0x400a49(0x13f),'final':![]};let _0x187abd=_0x4d06d1[_0x400a49(0x193)]||_0x4d06d1['message']||_0x400a49(0x1ba),_0xea9c99=_0x4d06d1['status'],_0x529d01=_0x4d06d1[_0x400a49(0x13a)];return console[_0x400a49(0x181)](_0x400a49(0x121)+_0xea9c99+_0x400a49(0x1a7)+_0x529d01+_0x400a49(0x1f7)+_0x187abd),{'gateway_payment_id':_0x4d06d1[_0x400a49(0x166)]?.['toString'](),'payment_url':_0x36bdf0,'requires_3ds':![],'status':_0x400a49(0x15c),'final':!![]};}catch(_0x4b797b){console[_0x400a49(0x128)]('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console[_0x400a49(0x128)]('Error\x20details:',_0x4b797b),loggerService_1[_0x400a49(0x1ce)][_0x400a49(0x195)](_0x400a49(0x13b),_0x400a49(0x1eb),_0x4b797b);throw new Error(_0x400a49(0x1cd)+(_0x4b797b instanceof Error?_0x4b797b[_0x400a49(0x1b1)]:_0x400a49(0x1ba)));}}async[a42_0x88f09(0x1db)](_0x2c8e81,_0x577656){const _0x3a392d=a42_0x88f09;console[_0x3a392d(0x181)](_0x3a392d(0x17c)+_0x2c8e81+'\x20('+_0x577656+')');try{const _0x4dfbd7={'payment_id':_0x2c8e81,'order_id':_0x577656},_0x4ba417=JSON[_0x3a392d(0x1cb)](_0x4dfbd7),{key:_0x54e4d8,iv:_0x2b3a25}=this[_0x3a392d(0x19d)](),_0x40da64=this['encryptAES'](_0x4ba417,_0x54e4d8,_0x2b3a25),_0x404456=this['encryptRSA'](_0x54e4d8,_0x2b3a25),_0x359f28=this[_0x3a392d(0x14d)](_0x4ba417),_0x311aa5={'merchant_point_id':this[_0x3a392d(0x200)],'method':'status','info':_0x40da64,'key':_0x404456,'sign':_0x359f28,'lang':'en'};loggerService_1['loggerService'][_0x3a392d(0x1de)](_0x3a392d(0x13b),_0x3a392d(0x16f),_0x3a392d(0x12e),{'merchant_point_id':this[_0x3a392d(0x200)],'method':'status','lang':'en'});const _0x34e5dc=Date[_0x3a392d(0x18b)](),_0x557cf6=await fetch(this['apiUrl'],{'method':_0x3a392d(0x12e),'headers':{'Content-Type':_0x3a392d(0x16d),'Accept':_0x3a392d(0x16d),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x3a392d(0x1cb)](_0x311aa5)}),_0x1dc7ec=Date[_0x3a392d(0x18b)]()-_0x34e5dc;if(!_0x557cf6['ok']){const _0x49b6be=await _0x557cf6[_0x3a392d(0x1dc)]();loggerService_1[_0x3a392d(0x1ce)]['logWhiteDomainResponse'](_0x3a392d(0x13b),_0x3a392d(0x138),_0x557cf6[_0x3a392d(0x1d8)],_0x49b6be,_0x1dc7ec);throw new Error(_0x3a392d(0x17f)+_0x557cf6[_0x3a392d(0x1d8)]);}const _0x1037be=await _0x557cf6[_0x3a392d(0x192)]();loggerService_1['loggerService'][_0x3a392d(0x207)](_0x3a392d(0x13b),_0x3a392d(0x138),_0x557cf6[_0x3a392d(0x1d8)],_0x1037be,_0x1dc7ec);let _0x2c3877=_0x1037be;if(_0x1037be['info']&&_0x1037be[_0x3a392d(0x1b7)]&&_0x1037be[_0x3a392d(0x17e)]){console[_0x3a392d(0x181)]('🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0x5c6cdb=this[_0x3a392d(0x1d6)](_0x1037be['info'],_0x1037be[_0x3a392d(0x1b7)]);_0x2c3877=JSON[_0x3a392d(0x1f3)](_0x5c6cdb),console['log'](_0x3a392d(0x1f9)),loggerService_1[_0x3a392d(0x1ce)][_0x3a392d(0x207)]('mastercard','/status_decrypted',_0x557cf6[_0x3a392d(0x1d8)],_0x2c3877,_0x1dc7ec),console['log']('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x14e0f1){console['error'](_0x3a392d(0x135),_0x14e0f1),loggerService_1['loggerService'][_0x3a392d(0x195)]('mastercard',_0x3a392d(0x161),_0x3a392d(0x168)+_0x14e0f1),_0x2c3877=_0x1037be;}}else loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3a392d(0x13b),_0x3a392d(0x1d2),_0x557cf6[_0x3a392d(0x1d8)],_0x2c3877,_0x1dc7ec),console[_0x3a392d(0x181)]('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x3a392d(0x181)](_0x3a392d(0x1f8),{'status':_0x2c3877[_0x3a392d(0x1d8)],'final':_0x2c3877['final'],'payment_id':_0x2c3877[_0x3a392d(0x166)],'desc':_0x2c3877[_0x3a392d(0x193)]});let _0x5d9f21=_0x3a392d(0x13f);if(_0x2c3877['status']===0x1&&_0x2c3877[_0x3a392d(0x13a)]===0x1)_0x5d9f21='PAID';else _0x2c3877['status']===0x0&&_0x2c3877[_0x3a392d(0x13a)]===0x0?_0x5d9f21=_0x3a392d(0x13f):_0x5d9f21=_0x3a392d(0x15c);return{'status':_0x5d9f21,'final':_0x2c3877['final']===0x1,'amount':_0x2c3877[_0x3a392d(0x20d)],'currency':_0x2c3877[_0x3a392d(0x18f)],'date_success':_0x2c3877['date_success'],'description':_0x2c3877[_0x3a392d(0x193)]};}catch(_0x309f05){console['error'](_0x3a392d(0x1e9),_0x309f05),loggerService_1[_0x3a392d(0x1ce)]['logWhiteDomainError'](_0x3a392d(0x13b),_0x3a392d(0x16f),_0x309f05);throw new Error(_0x3a392d(0x1b0)+(_0x309f05 instanceof Error?_0x309f05[_0x3a392d(0x1b1)]:_0x3a392d(0x1ba)));}}[a42_0x88f09(0x209)](_0x322db9,_0x333479,_0x146342){const _0x1c340a=a42_0x88f09;console['log'](_0x1c340a(0x164)+_0x322db9+'\x20('+_0x146342+')'),this[_0x1c340a(0x1bd)](_0x322db9);const _0x20a625=[],_0x2cef58=0x5*0x3c*0x3e8,_0x45a347=0x2*0x3c*0x3c*0x3e8,_0x5628ab=Math['floor'](_0x45a347/_0x2cef58);console[_0x1c340a(0x181)]('⏰\x20Will\x20check\x20status\x20'+_0x5628ab+_0x1c340a(0x159));for(let _0x3fe873=0x1;_0x3fe873<=_0x5628ab;_0x3fe873++){const _0x581f48=setTimeout(async()=>{const _0x3f776d=_0x1c340a;console[_0x3f776d(0x181)]('🔍\x20MasterCard\x20status\x20check\x20#'+_0x3fe873+'/'+_0x5628ab+_0x3f776d(0x202)+_0x322db9);try{const _0x42de39=await this[_0x3f776d(0x1db)](_0x146342,_0x333479);console['log']('📊\x20Status\x20check\x20#'+_0x3fe873+_0x3f776d(0x120),_0x42de39),_0x42de39[_0x3f776d(0x13a)]&&(console['log'](_0x3f776d(0x1a1)+_0x322db9+_0x3f776d(0x15e)+_0x42de39[_0x3f776d(0x1d8)]+_0x3f776d(0x1bf)),this[_0x3f776d(0x1bd)](_0x322db9),await this[_0x3f776d(0x178)](_0x322db9,_0x42de39[_0x3f776d(0x1d8)],_0x42de39));}catch(_0x565dc4){console[_0x3f776d(0x128)](_0x3f776d(0x1bc)+_0x3fe873+_0x3f776d(0x13d)+_0x322db9+':',_0x565dc4);}},_0x3fe873*_0x2cef58);_0x20a625[_0x1c340a(0x185)](_0x581f48);}this[_0x1c340a(0x18e)][_0x1c340a(0x1cf)](_0x322db9,_0x20a625),console['log']('✅\x20Scheduled\x20'+_0x5628ab+_0x1c340a(0x1a8)+_0x322db9);}[a42_0x88f09(0x1bd)](_0x3d6672){const _0x2f17e1=a42_0x88f09,_0x1b6be2=this['statusCheckTimers'][_0x2f17e1(0x12a)](_0x3d6672);_0x1b6be2&&(console[_0x2f17e1(0x181)](_0x2f17e1(0x14f)+_0x1b6be2[_0x2f17e1(0x172)]+_0x2f17e1(0x18d)+_0x3d6672),_0x1b6be2[_0x2f17e1(0x18c)]((_0x19fe59,_0x4dfebc)=>{clearTimeout(_0x19fe59);}),this[_0x2f17e1(0x18e)]['delete'](_0x3d6672));}async[a42_0x88f09(0x178)](_0x73ae28,_0x4c992c,_0x75871c){const _0x2d78b6=a42_0x88f09;try{const _0x4336e7=(await Promise[_0x2d78b6(0x1fb)]()['then'](()=>__importStar(require('../../config/database'))))[_0x2d78b6(0x1a3)],_0x509beb={'status':_0x4c992c[_0x2d78b6(0x1b6)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x4c992c===_0x2d78b6(0x20a)&&(_0x509beb[_0x2d78b6(0x174)]=new Date()),_0x75871c[_0x2d78b6(0x1f1)]&&(_0x509beb[_0x2d78b6(0x1a2)]=_0x2d78b6(0x1c6)+_0x75871c[_0x2d78b6(0x1f1)]),await _0x4336e7[_0x2d78b6(0x1fe)][_0x2d78b6(0x1c8)]({'where':{'id':_0x73ae28},'data':_0x509beb}),console[_0x2d78b6(0x181)](_0x2d78b6(0x1a1)+_0x73ae28+_0x2d78b6(0x203)+_0x4c992c),await this[_0x2d78b6(0x132)](_0x73ae28,_0x4c992c);}catch(_0x21c0e2){console[_0x2d78b6(0x128)](_0x2d78b6(0x1d9)+_0x73ae28+':',_0x21c0e2);}}async[a42_0x88f09(0x132)](_0x35ec8b,_0x1d356d){const _0x4e93fa=a42_0x88f09;try{const _0x2e219d=(await Promise[_0x4e93fa(0x1fb)]()[_0x4e93fa(0x1dd)](()=>__importStar(require(_0x4e93fa(0x122)))))['default'],{telegramBotService:_0xd38c91}=await Promise[_0x4e93fa(0x1fb)]()[_0x4e93fa(0x1dd)](()=>__importStar(require(_0x4e93fa(0x199)))),_0x470473=await _0x2e219d[_0x4e93fa(0x1fe)][_0x4e93fa(0x134)]({'where':{'id':_0x35ec8b},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x470473)return;const _0x39bfdc={'PAID':'paid','FAILED':_0x4e93fa(0x1ca)},_0x3b734b=_0x39bfdc[_0x1d356d];_0x3b734b&&await _0xd38c91['sendPaymentNotification'](_0x470473[_0x4e93fa(0x1e4)],_0x470473,_0x3b734b),await this[_0x4e93fa(0x1f2)](_0x470473,_0x1d356d);}catch(_0x4135d2){console[_0x4e93fa(0x128)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x4135d2);}}async['sendShopWebhook'](_0x754343,_0x15249f){const _0x3bf985=a42_0x88f09,_0x5aaf69=Date[_0x3bf985(0x18b)]();try{const _0x51fe57=_0x754343[_0x3bf985(0x19b)],_0x388873=_0x51fe57['settings'];if(!_0x388873?.['webhookUrl']){console[_0x3bf985(0x181)](_0x3bf985(0x129)+_0x51fe57['id']);return;}const _0x494f17=_0x15249f===_0x3bf985(0x20a)?_0x3bf985(0x1a6):'payment.failed';let _0x491d3b=[];if(_0x388873['webhookEvents'])try{_0x491d3b=Array[_0x3bf985(0x1e2)](_0x388873[_0x3bf985(0x123)])?_0x388873[_0x3bf985(0x123)]:JSON[_0x3bf985(0x1f3)](_0x388873[_0x3bf985(0x123)]);}catch(_0x497c84){console[_0x3bf985(0x128)](_0x3bf985(0x1e1),_0x497c84),_0x491d3b=[];}if(!_0x491d3b[_0x3bf985(0x148)](_0x494f17)){console[_0x3bf985(0x181)](_0x3bf985(0x1d0)+_0x494f17+_0x3bf985(0x11f)+_0x51fe57['id']);return;}const _0x25af5d={'event':_0x494f17,'payment':{'id':_0x754343['id'],'order_id':_0x754343[_0x3bf985(0x19f)],'gateway_order_id':_0x754343[_0x3bf985(0x127)],'gateway':_0x3bf985(0x1ac),'amount':_0x754343[_0x3bf985(0x20d)],'currency':_0x754343[_0x3bf985(0x18f)],'status':_0x15249f[_0x3bf985(0x1ad)](),'customer_email':_0x754343[_0x3bf985(0x163)],'customer_name':_0x754343[_0x3bf985(0x17d)],'created_at':_0x754343[_0x3bf985(0x146)],'updated_at':new Date()}},_0x517f17=await fetch(_0x388873[_0x3bf985(0x1e5)],{'method':'POST','headers':{'Content-Type':_0x3bf985(0x16d),'User-Agent':_0x3bf985(0x1c2)},'body':JSON['stringify'](_0x25af5d)}),_0x314020=Date['now']()-_0x5aaf69;loggerService_1[_0x3bf985(0x1ce)]['logShopWebhookSent'](_0x754343['shopId'],_0x388873['webhookUrl'],_0x494f17,_0x517f17[_0x3bf985(0x1d8)],_0x314020,_0x25af5d),console[_0x3bf985(0x181)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x388873[_0x3bf985(0x1e5)]+_0x3bf985(0x141)+_0x517f17[_0x3bf985(0x1d8)]+'\x20('+_0x314020+_0x3bf985(0x139));}catch(_0x453484){console[_0x3bf985(0x128)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x453484),loggerService_1['loggerService'][_0x3bf985(0x1bb)](_0x754343[_0x3bf985(0x1e4)],_0x754343[_0x3bf985(0x19b)]?.[_0x3bf985(0x1b5)]?.['webhookUrl']||_0x3bf985(0x184),'webhook_send',_0x453484,{});}}[a42_0x88f09(0x1cc)](_0x56bf04){const _0x1e03ad=a42_0x88f09,_0x513f43=_0x56bf04['replace'](/[\s-]/g,'');if(_0x513f43[_0x1e03ad(0x172)]<0x4)return _0x1e03ad(0x206);return _0x1e03ad(0x183)+_0x513f43[_0x1e03ad(0x190)](-0x4);}async['processWebhook'](_0x3a594c){const _0x110688=a42_0x88f09;console[_0x110688(0x181)](_0x110688(0x205),_0x3a594c);let _0x1fb792=_0x110688(0x13f);if(_0x3a594c[_0x110688(0x1d8)]===0x1&&_0x3a594c[_0x110688(0x13a)]===0x1)_0x1fb792=_0x110688(0x20a);else _0x3a594c['status']===0x0&&_0x3a594c[_0x110688(0x13a)]===0x0?_0x1fb792='PENDING':_0x1fb792=_0x110688(0x15c);return{'paymentId':_0x3a594c[_0x110688(0x204)]||'','status':_0x1fb792,'amount':_0x3a594c[_0x110688(0x20d)],'currency':_0x3a594c[_0x110688(0x18f)]};}[a42_0x88f09(0x20c)](){const _0x2fd9ed=a42_0x88f09;console[_0x2fd9ed(0x181)](_0x2fd9ed(0x1e8));const _0x47ccc8=this['statusCheckTimers'][_0x2fd9ed(0x155)];for(const [_0x5f4602]of this[_0x2fd9ed(0x18e)]){this['clearStatusTimers'](_0x5f4602);}console[_0x2fd9ed(0x181)](_0x2fd9ed(0x119)+_0x47ccc8+_0x2fd9ed(0x20b));}}function a42_0x5e9a(){const _0x1ababd=['maskCardNumber','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','loggerService','set','Webhook\x20event\x20','validateKeyFiles','/status_decrypted','cwd','🔐\x20Public\x20key\x20length:\x20','encryptAES','decryptResponse','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','status','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','checkPaymentStatus','text','then','logWhiteDomainRequest',',\x20body:\x20','defineProperty','Error\x20parsing\x20webhook\x20events:','isArray','psp_public.pem','shopId','webhookUrl','\x20\x20\x20-\x20merchant_point_id:','encryptRSA','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','MasterCard\x20status\x20check\x20error:','createSign','/charge','hasOwnProperty','number','SHA256','privateDecrypt','expire_year','description','sendShopWebhook','parse','-----BEGIN','❌\x20RSA\x20signing\x20failed:','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)',',\x20Desc:\x20','📊\x20Status\x20check\x20result:','✅\x20Status\x20response\x20decrypted\x20successfully','1400955KFhNTo','resolve','Response\x20Time:','🔐\x20Private\x20key\x20path:','payment','PHP\x20decryptor\x20error','merchantPointId','aes-256-ctr','\x20for\x20payment\x20','\x20status\x20updated\x20to\x20','order_id','Processing\x20MasterCard\x20webhook:','****','logWhiteDomainResponse','existsSync','scheduleStatusChecks','PAID','\x20MasterCard\x20status\x20check\x20timers','stopAllStatusChecks','amount','HTTP\x20Status:','create','📝\x20Data\x20length:','🛑\x20Stopped\x20','💳\x20MasterCard\x20service\x20initialized','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','toString','\x20\x20\x20-\x20key\x20length:','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','\x20not\x20enabled\x20for\x20shop\x20','\x20result:','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','../../config/database','webhookEvents','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','Failed\x20to\x20decrypt\x20response','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','gatewayOrderId','error','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','get','33351mBDhXV','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','🔐\x20AES\x20key\x20and\x20IV\x20generated','POST','join','keys','prototype','sendPaymentNotifications','processCardPayment','findUnique','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','\x20\x20\x20-\x20lang:\x20en','/status_raw','ms)','final','mastercard','/charge_raw','\x20failed\x20for\x20payment\x20','📝\x20Data\x20to\x20sign\x20length:','PENDING','3879708RdUUpM','\x20with\x20status\x20','💾\x20Payment\x20data\x20prepared','publicKeyPath','HTTP\x20','372HAKvbn','createdAt','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','includes','first_name','❌\x20RSA\x20encryption\x20failed:','📝\x20Encrypted\x20data\x20length:','140796OhXlXa','signRSA','✅\x20Payment\x20successful','🧹\x20Clearing\x20','from','apiUrl','publicEncrypt','__importStar','🔐\x20AES\x20IV\x20length:','size','Card\x20Number:','3ds_url','base64','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','\x20characters','call','FAILED','private.pem','\x20is\x20final\x20(','randomBytes','Public\x20key\x20file\x20not\x20found:\x20','/status_decrypt','TesSoft\x20Payment\x20System/1.0','customerEmail','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','none','payment_id','976CTaujz','Status\x20decryption\x20failed:\x20','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','info','🔐\x20RSA\x20signing\x20successful','...','application/json','__setModuleDefault','/status','end','Status:','length','decryptResponsePhp','paidAt','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','\x20\x20\x20-\x20sign\x20length:','❌\x20PHP\x20decryptor\x20request\x20failed:','updatePaymentStatus','../loggerService','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','❌\x20Data\x20being\x20signed:','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','customerName','sign','HTTP\x20error!\x20status:\x20','charge','log','MasterCardService','****\x20****\x20****\x20','unknown','push','expire_month','Payment\x20ID:','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','trim','privateKeyPath','now','forEach','\x20status\x20timers\x20for\x20payment\x20','statusCheckTimers','currency','slice','Result\x20URL:','json','desc','__esModule','logWhiteDomainError','1043830nwwUIf','last_name','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','../telegramBotService','Final:','shop','Decryption\x20failed:\x20','generateAESKey','🔐\x20Data\x20encrypted\x20with\x20AES','orderId','__importDefault','✅\x20Payment\x20','adminNotes','default','1021679SIkLol','getOwnPropertyNames','payment.success',',\x20Final:\x20','\x20status\x20checks\x20for\x20payment\x20','RSA_PKCS1_PADDING','3DS\x20URL:','/charge_decrypted','1111','toLowerCase','1420506xsKSAA','https://api.paydmeth.com/api','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','message','constants','path','📝\x20Signature\x20length:','settings','toUpperCase','key','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','Unknown\x20error','logShopWebhookError','❌\x20Status\x20check\x20#','clearStatusTimers','📝\x20Final\x20request\x20structure:','),\x20stopping\x20status\x20checks','-----END','\x20\x20\x20-\x20method:\x20charge','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','🔐\x20Public\x20key\x20path:','Amount:','decryptAES','MasterCard:\x20','utf8','update','readFileSync','failed','stringify'];a42_0x5e9a=function(){return _0x1ababd;};return a42_0x5e9a();}exports[a42_0x88f09(0x182)]=MasterCardService;