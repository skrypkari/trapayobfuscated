'use strict';const a42_0x49f16a=a42_0x20f8;(function(_0x9c7004,_0x354d1d){const _0x57d786=a42_0x20f8,_0x1a8d8e=_0x9c7004();while(!![]){try{const _0x4f7a32=parseInt(_0x57d786(0x1c1))/0x1+-parseInt(_0x57d786(0x1f2))/0x2+-parseInt(_0x57d786(0x1a8))/0x3*(-parseInt(_0x57d786(0x222))/0x4)+parseInt(_0x57d786(0x1d2))/0x5+parseInt(_0x57d786(0x141))/0x6+-parseInt(_0x57d786(0x204))/0x7+parseInt(_0x57d786(0x21d))/0x8;if(_0x4f7a32===_0x354d1d)break;else _0x1a8d8e['push'](_0x1a8d8e['shift']());}catch(_0xf2b1e5){_0x1a8d8e['push'](_0x1a8d8e['shift']());}}}(a42_0x3c5b,0x44ff1));var __createBinding=this&&this[a42_0x49f16a(0x1e2)]||(Object[a42_0x49f16a(0x190)]?function(_0x50826d,_0x27ccaf,_0x3a00d6,_0x410299){const _0x5bde60=a42_0x49f16a;if(_0x410299===undefined)_0x410299=_0x3a00d6;var _0x338353=Object[_0x5bde60(0x1ef)](_0x27ccaf,_0x3a00d6);(!_0x338353||(_0x5bde60(0x1e0)in _0x338353?!_0x27ccaf['__esModule']:_0x338353['writable']||_0x338353['configurable']))&&(_0x338353={'enumerable':!![],'get':function(){return _0x27ccaf[_0x3a00d6];}}),Object[_0x5bde60(0x19f)](_0x50826d,_0x410299,_0x338353);}:function(_0x5dafb8,_0xb9dfd1,_0x5e7d93,_0x245e41){if(_0x245e41===undefined)_0x245e41=_0x5e7d93;_0x5dafb8[_0x245e41]=_0xb9dfd1[_0x5e7d93];}),__setModuleDefault=this&&this[a42_0x49f16a(0x213)]||(Object['create']?function(_0x1d30ed,_0x183233){const _0x109f12=a42_0x49f16a;Object[_0x109f12(0x19f)](_0x1d30ed,'default',{'enumerable':!![],'value':_0x183233});}:function(_0x2a6a24,_0x2e6356){const _0x831cd7=a42_0x49f16a;_0x2a6a24[_0x831cd7(0x1ea)]=_0x2e6356;}),__importStar=this&&this[a42_0x49f16a(0x1ad)]||(function(){var _0x2571de=function(_0x4e79f3){const _0x138efb=a42_0x20f8;return _0x2571de=Object[_0x138efb(0x230)]||function(_0x560da5){const _0x287798=_0x138efb;var _0x55e514=[];for(var _0x44f24f in _0x560da5)if(Object[_0x287798(0x16a)][_0x287798(0x1b1)][_0x287798(0x22c)](_0x560da5,_0x44f24f))_0x55e514[_0x55e514['length']]=_0x44f24f;return _0x55e514;},_0x2571de(_0x4e79f3);};return function(_0xdfa7ec){const _0x43cfb0=a42_0x20f8;if(_0xdfa7ec&&_0xdfa7ec['__esModule'])return _0xdfa7ec;var _0x3bd823={};if(_0xdfa7ec!=null){for(var _0x23783a=_0x2571de(_0xdfa7ec),_0x37cbcd=0x0;_0x37cbcd<_0x23783a[_0x43cfb0(0x180)];_0x37cbcd++)if(_0x23783a[_0x37cbcd]!==_0x43cfb0(0x1ea))__createBinding(_0x3bd823,_0xdfa7ec,_0x23783a[_0x37cbcd]);}return __setModuleDefault(_0x3bd823,_0xdfa7ec),_0x3bd823;};}()),__importDefault=this&&this['__importDefault']||function(_0x1965b5){const _0x2e8c83=a42_0x49f16a;return _0x1965b5&&_0x1965b5[_0x2e8c83(0x224)]?_0x1965b5:{'default':_0x1965b5};};Object[a42_0x49f16a(0x19f)](exports,a42_0x49f16a(0x224),{'value':!![]}),exports['MasterCardService']=void 0x0;const crypto_1=__importDefault(require(a42_0x49f16a(0x181))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x49f16a(0x197))),loggerService_1=require(a42_0x49f16a(0x1c0));function a42_0x20f8(_0x466b5e,_0xda4aa7){const _0x3c5bb5=a42_0x3c5b();return a42_0x20f8=function(_0x20f8ab,_0x457bc6){_0x20f8ab=_0x20f8ab-0x13e;let _0x26f3ce=_0x3c5bb5[_0x20f8ab];return _0x26f3ce;},a42_0x20f8(_0x466b5e,_0xda4aa7);}class MasterCardService{constructor(){const _0x5dc435=a42_0x49f16a;this['statusCheckTimers']=new Map(),this[_0x5dc435(0x1ed)]='https://api.psp-release.net/api',this[_0x5dc435(0x14a)]=0x3e8,this[_0x5dc435(0x1ee)]=path_1[_0x5dc435(0x1ea)][_0x5dc435(0x149)](process[_0x5dc435(0x1fb)](),_0x5dc435(0x1b9),'private.pem'),this[_0x5dc435(0x1bd)]=path_1['default'][_0x5dc435(0x149)](process['cwd'](),_0x5dc435(0x1b9),_0x5dc435(0x1ff)),console[_0x5dc435(0x1f6)](_0x5dc435(0x1c3)),console[_0x5dc435(0x1f6)]('🔐\x20Private\x20key\x20path:',this[_0x5dc435(0x1ee)]),console[_0x5dc435(0x1f6)](_0x5dc435(0x165),this[_0x5dc435(0x1bd)]),this[_0x5dc435(0x1d0)]();}['validateKeyFiles'](){const _0x2c02ad=a42_0x49f16a;try{if(!fs_1[_0x2c02ad(0x1ea)][_0x2c02ad(0x226)](this[_0x2c02ad(0x1ee)]))throw new Error(_0x2c02ad(0x155)+this[_0x2c02ad(0x1ee)]);if(!fs_1[_0x2c02ad(0x1ea)]['existsSync'](this[_0x2c02ad(0x1bd)]))throw new Error(_0x2c02ad(0x1af)+this['publicKeyPath']);const _0x4e130b=fs_1[_0x2c02ad(0x1ea)][_0x2c02ad(0x1f5)](this['privateKeyPath'],_0x2c02ad(0x183))[_0x2c02ad(0x1ce)](),_0x366c36=fs_1[_0x2c02ad(0x1ea)][_0x2c02ad(0x1f5)](this['publicKeyPath'],_0x2c02ad(0x183))[_0x2c02ad(0x1ce)]();if(!_0x4e130b[_0x2c02ad(0x1d7)](_0x2c02ad(0x153))||!_0x4e130b[_0x2c02ad(0x1d7)](_0x2c02ad(0x1f8)))throw new Error('Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x366c36['includes']('-----BEGIN')||!_0x366c36[_0x2c02ad(0x1d7)](_0x2c02ad(0x1f8)))throw new Error('Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console['log'](_0x2c02ad(0x210)),console[_0x2c02ad(0x1f6)](_0x2c02ad(0x212)+_0x4e130b[_0x2c02ad(0x180)]+_0x2c02ad(0x172)),console[_0x2c02ad(0x1f6)](_0x2c02ad(0x1c5)+_0x366c36[_0x2c02ad(0x180)]+_0x2c02ad(0x172));}catch(_0x5a2588){console[_0x2c02ad(0x1f3)](_0x2c02ad(0x184),_0x5a2588);throw _0x5a2588;}}[a42_0x49f16a(0x158)](){const _0x42ad23=a42_0x49f16a,_0xf1564d=crypto_1['default']['randomBytes'](0x20),_0x279291=crypto_1[_0x42ad23(0x1ea)][_0x42ad23(0x20e)](0x10);return{'key':_0xf1564d,'iv':_0x279291};}[a42_0x49f16a(0x16f)](_0x588646,_0x2412d8,_0x1995f2){const _0x382747=a42_0x49f16a,_0x52463c=crypto_1[_0x382747(0x1ea)][_0x382747(0x1ca)](_0x382747(0x20a),_0x2412d8,_0x1995f2);let _0x13ea1b=_0x52463c[_0x382747(0x1c8)](_0x588646,_0x382747(0x183),_0x382747(0x1b0));return _0x13ea1b+=_0x52463c['final'](_0x382747(0x1b0)),_0x13ea1b;}[a42_0x49f16a(0x1df)](_0x43ec73,_0x40c962){const _0x51773b=a42_0x49f16a;try{const _0x5afd9d=fs_1[_0x51773b(0x1ea)][_0x51773b(0x1f5)](this[_0x51773b(0x1bd)],_0x51773b(0x183))[_0x51773b(0x1ce)](),_0x21ed94={'iv':_0x40c962['toString'](_0x51773b(0x1b0)),'key':_0x43ec73[_0x51773b(0x150)](_0x51773b(0x1b0))},_0x130a55=JSON[_0x51773b(0x1aa)](_0x21ed94);console[_0x51773b(0x1f6)](_0x51773b(0x186),_0x130a55['length']);const _0x47cf22=crypto_1[_0x51773b(0x1ea)]['publicEncrypt']({'key':_0x5afd9d,'padding':crypto_1[_0x51773b(0x1ea)][_0x51773b(0x1a5)][_0x51773b(0x1d1)]},Buffer[_0x51773b(0x1a0)](_0x130a55));return console['log']('✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x47cf22[_0x51773b(0x180)]),_0x47cf22[_0x51773b(0x150)](_0x51773b(0x1b0));}catch(_0x55bee5){console[_0x51773b(0x1f3)](_0x51773b(0x203),_0x55bee5);throw new Error(_0x51773b(0x1d3));}}[a42_0x49f16a(0x191)](_0x402c03){const _0x3c74a1=a42_0x49f16a;try{const _0x27db16=fs_1[_0x3c74a1(0x1ea)][_0x3c74a1(0x1f5)](this[_0x3c74a1(0x1ee)],_0x3c74a1(0x183))[_0x3c74a1(0x1ce)](),_0x2a9c84=crypto_1[_0x3c74a1(0x1ea)][_0x3c74a1(0x1ba)](_0x3c74a1(0x1f4));_0x2a9c84[_0x3c74a1(0x1c8)](_0x402c03),_0x2a9c84[_0x3c74a1(0x163)]();const _0x56a769=_0x2a9c84[_0x3c74a1(0x1b3)](_0x27db16,_0x3c74a1(0x1b0));return console[_0x3c74a1(0x1f6)](_0x3c74a1(0x198)),console[_0x3c74a1(0x1f6)](_0x3c74a1(0x176),_0x402c03[_0x3c74a1(0x180)]),console['log'](_0x3c74a1(0x177),_0x56a769[_0x3c74a1(0x180)]),_0x56a769;}catch(_0x53e50c){console[_0x3c74a1(0x1f3)](_0x3c74a1(0x223),_0x53e50c),console[_0x3c74a1(0x1f3)](_0x3c74a1(0x20b),_0x402c03[_0x3c74a1(0x16c)](0x0,0xc8)+_0x3c74a1(0x1e4));throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}[a42_0x49f16a(0x1a2)](_0x5c0ebc,_0x550295,_0x2dcb42){const _0x4f821a=a42_0x49f16a,_0x348a39=crypto_1[_0x4f821a(0x1ea)]['createDecipheriv'](_0x4f821a(0x20a),_0x550295,_0x2dcb42);let _0x451833=_0x348a39[_0x4f821a(0x1c8)](_0x5c0ebc,_0x4f821a(0x1b0),_0x4f821a(0x183));return _0x451833+=_0x348a39['final'](_0x4f821a(0x183)),_0x451833;}async[a42_0x49f16a(0x1e5)](_0x4303f1,_0x2354da){const _0x1cf92a=a42_0x49f16a;try{const _0x5f05c5=await fetch(_0x1cf92a(0x22f),{'method':'POST','headers':{'Content-Type':'application/json'},'body':JSON[_0x1cf92a(0x1aa)]({'info':_0x4303f1,'key':_0x2354da})});if(!_0x5f05c5['ok'])throw new Error(_0x1cf92a(0x209));return await _0x5f05c5['text']();}catch(_0x3fca8b){console['error'](_0x1cf92a(0x18d),_0x3fca8b);throw new Error(_0x1cf92a(0x205));}}[a42_0x49f16a(0x1e9)](_0x3dbeb0,_0x58b1e4){const _0x3efdaf=a42_0x49f16a;try{const _0x5587ad=fs_1['default']['readFileSync'](this[_0x3efdaf(0x1ee)],_0x3efdaf(0x183))[_0x3efdaf(0x1ce)](),_0x5f31f3=crypto_1[_0x3efdaf(0x1ea)][_0x3efdaf(0x216)](_0x5587ad,Buffer[_0x3efdaf(0x1a0)](_0x58b1e4,_0x3efdaf(0x1b0))),_0x5c5e84=JSON[_0x3efdaf(0x193)](_0x5f31f3[_0x3efdaf(0x150)]()),_0x17a90e=Buffer[_0x3efdaf(0x1a0)](_0x5c5e84[_0x3efdaf(0x1c6)],_0x3efdaf(0x1b0)),_0x43f3a3=Buffer[_0x3efdaf(0x1a0)](_0x5c5e84['iv'],_0x3efdaf(0x1b0));return this[_0x3efdaf(0x1a2)](_0x3dbeb0,_0x17a90e,_0x43f3a3);}catch(_0x583c37){throw new Error(_0x3efdaf(0x218));}}async['processCardPayment'](_0xd219a0){const _0x2ff156=a42_0x49f16a,{paymentId:_0x2b041f,orderId:_0x2d5a0d,amount:_0x28a320,currency:_0x2417f8,cardData:_0x7874ea,resultUrl:_0x358669,returnUrl:_0x539f00,cardHolder:_0x87e778,browser:_0x259512}=_0xd219a0;console['log']('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console['log'](_0x2ff156(0x178),_0x2b041f),console[_0x2ff156(0x1f6)]('Order\x20ID:',_0x2d5a0d),console[_0x2ff156(0x1f6)]('Amount:',_0x28a320,_0x2417f8),console[_0x2ff156(0x1f6)](_0x2ff156(0x1e8),this[_0x2ff156(0x192)](_0x7874ea[_0x2ff156(0x196)])),console[_0x2ff156(0x1f6)](_0x2ff156(0x1f1),_0x87e778[_0x2ff156(0x1e3)]+'\x20'+_0x87e778[_0x2ff156(0x151)]),console[_0x2ff156(0x1f6)]('Return\x20URL:',_0x539f00),console['log'](_0x2ff156(0x20d),_0x358669);const _0xad75b5={'amount':_0x28a320,'currency':_0x2417f8[_0x2ff156(0x1da)](),'order_id':_0x2d5a0d,'result_url':_0x358669,'return_url':_0x539f00,'card':{'number':_0x7874ea['number'],'expire_month':_0x7874ea[_0x2ff156(0x1d6)],'expire_year':_0x7874ea[_0x2ff156(0x15e)],'cvv':_0x7874ea[_0x2ff156(0x1eb)]},'card_holder':_0x87e778,'browser':_0x259512},_0x30649e=JSON[_0x2ff156(0x1aa)](_0xad75b5);console[_0x2ff156(0x1f6)]('💾\x20Payment\x20data\x20prepared'),console[_0x2ff156(0x1f6)](_0x2ff156(0x1cc)),console[_0x2ff156(0x1f6)](_0x30649e),console[_0x2ff156(0x1f6)](_0x2ff156(0x171),_0x30649e[_0x2ff156(0x180)]);try{const {key:_0x243433,iv:_0x2974ca}=this[_0x2ff156(0x158)]();console[_0x2ff156(0x1f6)](_0x2ff156(0x152)),console[_0x2ff156(0x1f6)]('🔐\x20AES\x20key\x20length:',_0x243433['length']),console['log'](_0x2ff156(0x15a),_0x2974ca['length']);const _0x3ed401=this[_0x2ff156(0x16f)](_0x30649e,_0x243433,_0x2974ca);console['log'](_0x2ff156(0x1fd)),console[_0x2ff156(0x1f6)](_0x2ff156(0x1f0),_0x3ed401[_0x2ff156(0x180)]);const _0x7b46d0=this['encryptRSA'](_0x243433,_0x2974ca);console[_0x2ff156(0x1f6)](_0x2ff156(0x145)),console[_0x2ff156(0x1f6)](_0x2ff156(0x201),_0x7b46d0['length']);const _0x1cb5e9=this[_0x2ff156(0x191)](_0x30649e);console[_0x2ff156(0x1f6)](_0x2ff156(0x17c)),console['log'](_0x2ff156(0x177),_0x1cb5e9[_0x2ff156(0x180)]);const _0x4d657d={'merchant_point_id':this[_0x2ff156(0x14a)],'method':_0x2ff156(0x1b8),'info':_0x3ed401,'key':_0x7b46d0,'sign':_0x1cb5e9,'lang':'en'};console[_0x2ff156(0x1f6)](_0x2ff156(0x1db)),console[_0x2ff156(0x1f6)]('📝\x20Final\x20request\x20structure:'),console[_0x2ff156(0x1f6)](_0x2ff156(0x1bc),this[_0x2ff156(0x14a)]),console['log'](_0x2ff156(0x200)),console['log'](_0x2ff156(0x1ac),_0x3ed401[_0x2ff156(0x180)]),console['log'](_0x2ff156(0x18f),_0x7b46d0[_0x2ff156(0x180)]),console[_0x2ff156(0x1f6)](_0x2ff156(0x1c2),_0x1cb5e9[_0x2ff156(0x180)]),console[_0x2ff156(0x1f6)](_0x2ff156(0x1b7)),loggerService_1[_0x2ff156(0x1ec)][_0x2ff156(0x1cf)](_0x2ff156(0x217),_0x2ff156(0x17a),_0x2ff156(0x1bb),{'merchant_point_id':this[_0x2ff156(0x14a)],'method':_0x2ff156(0x1b8),'lang':'en'});const _0x2dcabb=Date['now'](),_0x46d810=await fetch(this[_0x2ff156(0x1ed)],{'method':_0x2ff156(0x1bb),'headers':{'Content-Type':_0x2ff156(0x142),'Accept':_0x2ff156(0x142),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x2ff156(0x1aa)](_0x4d657d)}),_0x1d49d2=Date[_0x2ff156(0x161)]()-_0x2dcabb;console['log'](_0x2ff156(0x1e1)),console[_0x2ff156(0x1f6)](_0x2ff156(0x207),_0x46d810[_0x2ff156(0x146)]),console['log']('Response\x20Time:',_0x1d49d2+'ms');if(!_0x46d810['ok']){const _0x36d9aa=await _0x46d810[_0x2ff156(0x1a1)]();console['error'](_0x2ff156(0x1cb),_0x46d810[_0x2ff156(0x146)]),console[_0x2ff156(0x1f3)]('Response\x20Body:',_0x36d9aa),loggerService_1[_0x2ff156(0x1ec)][_0x2ff156(0x185)](_0x2ff156(0x217),_0x2ff156(0x15c),_0x46d810[_0x2ff156(0x146)],_0x36d9aa,_0x1d49d2),loggerService_1[_0x2ff156(0x1ec)]['logWhiteDomainError'](_0x2ff156(0x217),_0x2ff156(0x17a),'HTTP\x20'+_0x46d810[_0x2ff156(0x146)]+':\x20'+_0x36d9aa);throw new Error('HTTP\x20error!\x20status:\x20'+_0x46d810[_0x2ff156(0x146)]+_0x2ff156(0x1d9)+_0x36d9aa);}const _0x496c1c=await _0x46d810[_0x2ff156(0x208)]();loggerService_1[_0x2ff156(0x1ec)][_0x2ff156(0x185)](_0x2ff156(0x217),'/charge_raw',_0x46d810[_0x2ff156(0x146)],_0x496c1c,_0x1d49d2),console[_0x2ff156(0x1f6)](_0x2ff156(0x219));let _0x33130d=_0x496c1c;if(_0x496c1c[_0x2ff156(0x1b5)]&&_0x496c1c['key']&&_0x496c1c[_0x2ff156(0x1b3)]){console[_0x2ff156(0x1f6)](_0x2ff156(0x18a));try{const _0x1eaa32=await this[_0x2ff156(0x1e5)](_0x496c1c['info'],_0x496c1c[_0x2ff156(0x1c6)]);_0x33130d=JSON[_0x2ff156(0x193)](_0x1eaa32),console['log']('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0x2ff156(0x1ec)][_0x2ff156(0x185)]('mastercard',_0x2ff156(0x148),_0x46d810[_0x2ff156(0x146)],_0x33130d,_0x1d49d2),console[_0x2ff156(0x1f6)](_0x2ff156(0x173));}catch(_0x2e4cc8){console[_0x2ff156(0x1f3)](_0x2ff156(0x206),_0x2e4cc8),loggerService_1[_0x2ff156(0x1ec)][_0x2ff156(0x14f)](_0x2ff156(0x217),'/charge_decrypt',_0x2ff156(0x20c)+_0x2e4cc8),_0x33130d=_0x496c1c;}}else loggerService_1[_0x2ff156(0x1ec)][_0x2ff156(0x185)](_0x2ff156(0x217),_0x2ff156(0x148),_0x46d810[_0x2ff156(0x146)],_0x33130d,_0x1d49d2),console[_0x2ff156(0x1f6)](_0x2ff156(0x157));console[_0x2ff156(0x1f6)](_0x2ff156(0x207),_0x33130d[_0x2ff156(0x146)]),console['log'](_0x2ff156(0x19e),_0x33130d[_0x2ff156(0x1c4)]),console[_0x2ff156(0x1f6)](_0x2ff156(0x178),_0x33130d['payment_id']),console[_0x2ff156(0x1f6)]('3DS\x20URL:',_0x33130d[_0x2ff156(0x225)]||_0x2ff156(0x1e7));if(_0x33130d[_0x2ff156(0x146)]===0x1&&_0x33130d['final']===0x1)return console[_0x2ff156(0x1f6)](_0x2ff156(0x1c9)),{'gateway_payment_id':_0x33130d['payment_id']?.[_0x2ff156(0x150)](),'payment_url':_0x539f00,'requires_3ds':![],'status':_0x2ff156(0x1e6),'final':!![]};else return _0x33130d[_0x2ff156(0x225)]?(console[_0x2ff156(0x1f6)](_0x2ff156(0x1fa)),this[_0x2ff156(0x14c)](_0x2b041f,_0x2d5a0d,_0x33130d[_0x2ff156(0x1dd)]?.[_0x2ff156(0x150)]()||_0x2d5a0d),{'gateway_payment_id':_0x33130d[_0x2ff156(0x1dd)]?.[_0x2ff156(0x150)](),'payment_url':_0x33130d[_0x2ff156(0x225)],'requires_3ds':!![],'threeds_url':_0x33130d[_0x2ff156(0x225)],'status':_0x2ff156(0x17e),'final':![]}):(console[_0x2ff156(0x1f6)](_0x2ff156(0x19c)),{'gateway_payment_id':_0x33130d[_0x2ff156(0x1dd)]?.[_0x2ff156(0x150)](),'payment_url':_0x539f00,'requires_3ds':![],'status':'FAILED','final':!![]});}catch(_0x437c11){console[_0x2ff156(0x1f3)](_0x2ff156(0x169)),console[_0x2ff156(0x1f3)](_0x2ff156(0x156),_0x437c11),loggerService_1[_0x2ff156(0x1ec)][_0x2ff156(0x14f)]('mastercard',_0x2ff156(0x17a),_0x437c11);throw new Error(_0x2ff156(0x17b)+(_0x437c11 instanceof Error?_0x437c11[_0x2ff156(0x194)]:_0x2ff156(0x18b)));}}async['checkPaymentStatus'](_0x15e73e,_0x29473e){const _0xbcf6f0=a42_0x49f16a;console[_0xbcf6f0(0x1f6)](_0xbcf6f0(0x14b)+_0x15e73e+'\x20('+_0x29473e+')');try{const _0x2c9e6b={'payment_id':_0x15e73e,'order_id':_0x29473e},_0x5c899d=JSON[_0xbcf6f0(0x1aa)](_0x2c9e6b),{key:_0x58def1,iv:_0xf3e7f0}=this['generateAESKey'](),_0x1fe7b2=this['encryptAES'](_0x5c899d,_0x58def1,_0xf3e7f0),_0x51dc28=this[_0xbcf6f0(0x1df)](_0x58def1,_0xf3e7f0),_0xe4b198=this[_0xbcf6f0(0x191)](_0x5c899d),_0x24681d={'merchant_point_id':this[_0xbcf6f0(0x14a)],'method':'status','info':_0x1fe7b2,'key':_0x51dc28,'sign':_0xe4b198,'lang':'en'};loggerService_1[_0xbcf6f0(0x1ec)][_0xbcf6f0(0x1cf)]('mastercard','/status',_0xbcf6f0(0x1bb),{'merchant_point_id':this[_0xbcf6f0(0x14a)],'method':_0xbcf6f0(0x146),'lang':'en'});const _0x4a79d6=Date[_0xbcf6f0(0x161)](),_0x4c1144=await fetch(this[_0xbcf6f0(0x1ed)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0xbcf6f0(0x142),'User-Agent':_0xbcf6f0(0x1a4)},'body':JSON[_0xbcf6f0(0x1aa)](_0x24681d)}),_0x298dc0=Date[_0xbcf6f0(0x161)]()-_0x4a79d6;if(!_0x4c1144['ok']){const _0x15263f=await _0x4c1144['text']();loggerService_1[_0xbcf6f0(0x1ec)]['logWhiteDomainResponse'](_0xbcf6f0(0x217),_0xbcf6f0(0x221),_0x4c1144[_0xbcf6f0(0x146)],_0x15263f,_0x298dc0);throw new Error(_0xbcf6f0(0x1b4)+_0x4c1144[_0xbcf6f0(0x146)]);}const _0x1b0502=await _0x4c1144['json']();loggerService_1['loggerService']['logWhiteDomainResponse']('mastercard',_0xbcf6f0(0x221),_0x4c1144['status'],_0x1b0502,_0x298dc0);let _0x1dbec4=_0x1b0502;if(_0x1b0502[_0xbcf6f0(0x1b5)]&&_0x1b0502[_0xbcf6f0(0x1c6)]&&_0x1b0502[_0xbcf6f0(0x1b3)]){console[_0xbcf6f0(0x1f6)](_0xbcf6f0(0x1fc));try{const _0x4426f9=this[_0xbcf6f0(0x1e9)](_0x1b0502[_0xbcf6f0(0x1b5)],_0x1b0502[_0xbcf6f0(0x1c6)]);_0x1dbec4=JSON[_0xbcf6f0(0x193)](_0x4426f9),console[_0xbcf6f0(0x1f6)](_0xbcf6f0(0x1be)),loggerService_1[_0xbcf6f0(0x1ec)][_0xbcf6f0(0x185)](_0xbcf6f0(0x217),'/status_decrypted',_0x4c1144[_0xbcf6f0(0x146)],_0x1dbec4,_0x298dc0),console[_0xbcf6f0(0x1f6)](_0xbcf6f0(0x19d));}catch(_0x2e39ab){console['error'](_0xbcf6f0(0x22a),_0x2e39ab),loggerService_1['loggerService']['logWhiteDomainError']('mastercard',_0xbcf6f0(0x21c),'Status\x20decryption\x20failed:\x20'+_0x2e39ab),_0x1dbec4=_0x1b0502;}}else loggerService_1[_0xbcf6f0(0x1ec)][_0xbcf6f0(0x185)]('mastercard',_0xbcf6f0(0x166),_0x4c1144[_0xbcf6f0(0x146)],_0x1dbec4,_0x298dc0),console[_0xbcf6f0(0x1f6)](_0xbcf6f0(0x19a));console[_0xbcf6f0(0x1f6)]('📊\x20Status\x20check\x20result:',{'status':_0x1dbec4[_0xbcf6f0(0x146)],'final':_0x1dbec4[_0xbcf6f0(0x1c4)],'payment_id':_0x1dbec4[_0xbcf6f0(0x1dd)],'desc':_0x1dbec4[_0xbcf6f0(0x14e)]});let _0x14c9d8='PENDING';if(_0x1dbec4[_0xbcf6f0(0x146)]===0x1&&_0x1dbec4[_0xbcf6f0(0x1c4)]===0x1)_0x14c9d8=_0xbcf6f0(0x1e6);else _0x1dbec4[_0xbcf6f0(0x146)]===0x0&&_0x1dbec4[_0xbcf6f0(0x1c4)]===0x0?_0x14c9d8=_0xbcf6f0(0x17e):_0x14c9d8=_0xbcf6f0(0x22b);return{'status':_0x14c9d8,'final':_0x1dbec4[_0xbcf6f0(0x1c4)]===0x1,'amount':_0x1dbec4[_0xbcf6f0(0x220)],'currency':_0x1dbec4['currency'],'date_success':_0x1dbec4[_0xbcf6f0(0x17d)],'description':_0x1dbec4[_0xbcf6f0(0x14e)]};}catch(_0x3d3306){console[_0xbcf6f0(0x1f3)]('MasterCard\x20status\x20check\x20error:',_0x3d3306),loggerService_1[_0xbcf6f0(0x1ec)][_0xbcf6f0(0x14f)](_0xbcf6f0(0x217),_0xbcf6f0(0x1dc),_0x3d3306);throw new Error(_0xbcf6f0(0x1b6)+(_0x3d3306 instanceof Error?_0x3d3306[_0xbcf6f0(0x194)]:'Unknown\x20error'));}}['scheduleStatusChecks'](_0x5d83cb,_0x2a3f1b,_0x52c372){const _0x336272=a42_0x49f16a;console[_0x336272(0x1f6)](_0x336272(0x15b)+_0x5d83cb+'\x20('+_0x52c372+')'),this[_0x336272(0x179)](_0x5d83cb);const _0x4908ec=[],_0x16c718=0x5*0x3c*0x3e8,_0x38af44=0x2*0x3c*0x3c*0x3e8,_0x4b82dc=Math[_0x336272(0x202)](_0x38af44/_0x16c718);console[_0x336272(0x1f6)](_0x336272(0x22e)+_0x4b82dc+_0x336272(0x162));for(let _0x5db9a9=0x1;_0x5db9a9<=_0x4b82dc;_0x5db9a9++){const _0x11b6b9=setTimeout(async()=>{const _0x27b59d=_0x336272;console['log'](_0x27b59d(0x1ab)+_0x5db9a9+'/'+_0x4b82dc+_0x27b59d(0x1a9)+_0x5d83cb);try{const _0x1916fe=await this[_0x27b59d(0x229)](_0x52c372,_0x2a3f1b);console['log'](_0x27b59d(0x22d)+_0x5db9a9+_0x27b59d(0x1a3),_0x1916fe),_0x1916fe[_0x27b59d(0x1c4)]&&(console[_0x27b59d(0x1f6)]('✅\x20Payment\x20'+_0x5d83cb+_0x27b59d(0x175)+_0x1916fe[_0x27b59d(0x146)]+_0x27b59d(0x1b2)),this[_0x27b59d(0x179)](_0x5d83cb),await this['updatePaymentStatus'](_0x5d83cb,_0x1916fe[_0x27b59d(0x146)],_0x1916fe));}catch(_0x2aa268){console[_0x27b59d(0x1f3)]('❌\x20Status\x20check\x20#'+_0x5db9a9+'\x20failed\x20for\x20payment\x20'+_0x5d83cb+':',_0x2aa268);}},_0x5db9a9*_0x16c718);_0x4908ec[_0x336272(0x215)](_0x11b6b9);}this[_0x336272(0x160)][_0x336272(0x189)](_0x5d83cb,_0x4908ec),console[_0x336272(0x1f6)](_0x336272(0x143)+_0x4b82dc+_0x336272(0x188)+_0x5d83cb);}[a42_0x49f16a(0x179)](_0x3e303b){const _0x30f331=a42_0x49f16a,_0x2ebfa5=this[_0x30f331(0x160)][_0x30f331(0x1e0)](_0x3e303b);_0x2ebfa5&&(console[_0x30f331(0x1f6)](_0x30f331(0x168)+_0x2ebfa5['length']+_0x30f331(0x1fe)+_0x3e303b),_0x2ebfa5[_0x30f331(0x13e)]((_0x52eed6,_0x9c6722)=>{clearTimeout(_0x52eed6);}),this[_0x30f331(0x160)]['delete'](_0x3e303b));}async[a42_0x49f16a(0x211)](_0x573188,_0x566cc5,_0x5406fd){const _0x1d9c8e=a42_0x49f16a;try{const _0x1177f3=(await Promise[_0x1d9c8e(0x15f)]()[_0x1d9c8e(0x144)](()=>__importStar(require(_0x1d9c8e(0x18e)))))[_0x1d9c8e(0x1ea)],_0x1f344b={'status':_0x566cc5['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x1d9c8e(0x187),'statusChangedAt':new Date()};_0x566cc5==='PAID'&&(_0x1f344b['paidAt']=new Date()),_0x5406fd['description']&&(_0x1f344b[_0x1d9c8e(0x15d)]=_0x1d9c8e(0x167)+_0x5406fd[_0x1d9c8e(0x231)]),await _0x1177f3[_0x1d9c8e(0x1cd)][_0x1d9c8e(0x1c8)]({'where':{'id':_0x573188},'data':_0x1f344b}),console[_0x1d9c8e(0x1f6)](_0x1d9c8e(0x1a7)+_0x573188+_0x1d9c8e(0x1c7)+_0x566cc5),await this[_0x1d9c8e(0x1de)](_0x573188,_0x566cc5);}catch(_0x4ee970){console[_0x1d9c8e(0x1f3)](_0x1d9c8e(0x214)+_0x573188+':',_0x4ee970);}}async[a42_0x49f16a(0x1de)](_0xad3d81,_0x46bd91){const _0x18e84f=a42_0x49f16a;try{const _0xed447f=(await Promise[_0x18e84f(0x15f)]()[_0x18e84f(0x144)](()=>__importStar(require(_0x18e84f(0x18e)))))[_0x18e84f(0x1ea)],{telegramBotService:_0x4f1eb0}=await Promise[_0x18e84f(0x15f)]()[_0x18e84f(0x144)](()=>__importStar(require(_0x18e84f(0x228)))),_0x1f33e2=await _0xed447f['payment'][_0x18e84f(0x1d4)]({'where':{'id':_0xad3d81},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x1f33e2)return;const _0x83e315={'PAID':'paid','FAILED':'failed'},_0x5150e1=_0x83e315[_0x46bd91];_0x5150e1&&await _0x4f1eb0[_0x18e84f(0x16b)](_0x1f33e2[_0x18e84f(0x1d8)],_0x1f33e2,_0x5150e1),await this[_0x18e84f(0x1f7)](_0x1f33e2,_0x46bd91);}catch(_0x23b47c){console[_0x18e84f(0x1f3)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x23b47c);}}async[a42_0x49f16a(0x1f7)](_0x7229cb,_0x326570){const _0xe2c4a4=a42_0x49f16a,_0x4ee735=Date[_0xe2c4a4(0x161)]();try{const _0x23202e=_0x7229cb[_0xe2c4a4(0x154)],_0x2cbcb6=_0x23202e[_0xe2c4a4(0x21f)];if(!_0x2cbcb6?.[_0xe2c4a4(0x1f9)]){console[_0xe2c4a4(0x1f6)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x23202e['id']);return;}const _0x1967da=_0x326570===_0xe2c4a4(0x1e6)?_0xe2c4a4(0x20f):_0xe2c4a4(0x16d);let _0x186fee=[];if(_0x2cbcb6[_0xe2c4a4(0x14d)])try{_0x186fee=Array[_0xe2c4a4(0x21a)](_0x2cbcb6[_0xe2c4a4(0x14d)])?_0x2cbcb6['webhookEvents']:JSON[_0xe2c4a4(0x193)](_0x2cbcb6[_0xe2c4a4(0x14d)]);}catch(_0xca9ce1){console[_0xe2c4a4(0x1f3)](_0xe2c4a4(0x140),_0xca9ce1),_0x186fee=[];}if(!_0x186fee[_0xe2c4a4(0x1d7)](_0x1967da)){console['log'](_0xe2c4a4(0x19b)+_0x1967da+_0xe2c4a4(0x13f)+_0x23202e['id']);return;}const _0x406787={'event':_0x1967da,'payment':{'id':_0x7229cb['id'],'order_id':_0x7229cb['orderId'],'gateway_order_id':_0x7229cb['gatewayOrderId'],'gateway':'1111','amount':_0x7229cb[_0xe2c4a4(0x220)],'currency':_0x7229cb[_0xe2c4a4(0x182)],'status':_0x326570[_0xe2c4a4(0x1d5)](),'customer_email':_0x7229cb['customerEmail'],'customer_name':_0x7229cb[_0xe2c4a4(0x199)],'created_at':_0x7229cb[_0xe2c4a4(0x16e)],'updated_at':new Date()}},_0x101d42=await fetch(_0x2cbcb6[_0xe2c4a4(0x1f9)],{'method':'POST','headers':{'Content-Type':_0xe2c4a4(0x142),'User-Agent':_0xe2c4a4(0x174)},'body':JSON[_0xe2c4a4(0x1aa)](_0x406787)}),_0x1991d8=Date[_0xe2c4a4(0x161)]()-_0x4ee735;loggerService_1[_0xe2c4a4(0x1ec)]['logShopWebhookSent'](_0x7229cb[_0xe2c4a4(0x1d8)],_0x2cbcb6[_0xe2c4a4(0x1f9)],_0x1967da,_0x101d42[_0xe2c4a4(0x146)],_0x1991d8,_0x406787),console[_0xe2c4a4(0x1f6)](_0xe2c4a4(0x1a6)+_0x2cbcb6[_0xe2c4a4(0x1f9)]+'\x20with\x20status\x20'+_0x101d42[_0xe2c4a4(0x146)]+'\x20('+_0x1991d8+_0xe2c4a4(0x21b));}catch(_0xead0fc){console[_0xe2c4a4(0x1f3)](_0xe2c4a4(0x21e),_0xead0fc),loggerService_1[_0xe2c4a4(0x1ec)][_0xe2c4a4(0x195)](_0x7229cb[_0xe2c4a4(0x1d8)],_0x7229cb['shop']?.[_0xe2c4a4(0x21f)]?.['webhookUrl']||_0xe2c4a4(0x18c),_0xe2c4a4(0x170),_0xead0fc,{});}}[a42_0x49f16a(0x192)](_0x442212){const _0x49f2b2=a42_0x49f16a,_0x3b0a7d=_0x442212[_0x49f2b2(0x1bf)](/[\s-]/g,'');if(_0x3b0a7d[_0x49f2b2(0x180)]<0x4)return'****';return _0x49f2b2(0x147)+_0x3b0a7d[_0x49f2b2(0x227)](-0x4);}async['processWebhook'](_0x1ff939){const _0x4108b6=a42_0x49f16a;console[_0x4108b6(0x1f6)]('Processing\x20MasterCard\x20webhook:',_0x1ff939);let _0x4c21e3='PENDING';if(_0x1ff939[_0x4108b6(0x146)]===0x1&&_0x1ff939[_0x4108b6(0x1c4)]===0x1)_0x4c21e3=_0x4108b6(0x1e6);else _0x1ff939[_0x4108b6(0x146)]===0x0&&_0x1ff939[_0x4108b6(0x1c4)]===0x0?_0x4c21e3=_0x4108b6(0x17e):_0x4c21e3=_0x4108b6(0x22b);return{'paymentId':_0x1ff939[_0x4108b6(0x1ae)]||'','status':_0x4c21e3,'amount':_0x1ff939[_0x4108b6(0x220)],'currency':_0x1ff939['currency']};}['stopAllStatusChecks'](){const _0x4cf83e=a42_0x49f16a;console['log'](_0x4cf83e(0x17f));const _0x3a712d=this[_0x4cf83e(0x160)]['size'];for(const [_0x326dde]of this[_0x4cf83e(0x160)]){this[_0x4cf83e(0x179)](_0x326dde);}console[_0x4cf83e(0x1f6)](_0x4cf83e(0x159)+_0x3a712d+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a42_0x49f16a(0x164)]=MasterCardService;function a42_0x3c5b(){const _0x427110=['publicKeyPath','✅\x20Status\x20response\x20decrypted\x20successfully','replace','../loggerService','490769CtLFxn','\x20\x20\x20-\x20sign\x20length:','💳\x20MasterCard\x20service\x20initialized','final','🔐\x20Public\x20key\x20length:\x20','key','\x20status\x20updated\x20to\x20','update','✅\x20Payment\x20successful\x20without\x203DS','createCipheriv','HTTP\x20Status:','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','payment','trim','logWhiteDomainRequest','validateKeyFiles','RSA_PKCS1_PADDING','1970VauCQn','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','findUnique','toLowerCase','expire_month','includes','shopId',',\x20body:\x20','toUpperCase','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','/status','payment_id','sendPaymentNotifications','encryptRSA','get','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','__createBinding','first_name','...','decryptResponsePhp','PAID','none','Card\x20Number:','decryptResponse','default','cvv','loggerService','apiUrl','privateKeyPath','getOwnPropertyDescriptor','📝\x20Encrypted\x20data\x20length:','Card\x20Holder:','905972ZjaQYq','error','SHA256','readFileSync','log','sendShopWebhook','-----END','webhookUrl','🔐\x203DS\x20verification\x20required','cwd','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','🔐\x20Data\x20encrypted\x20with\x20AES','\x20status\x20timers\x20for\x20payment\x20','psp_public.pem','\x20\x20\x20-\x20method:\x20charge','📝\x20Encrypted\x20key\x20length:','floor','❌\x20RSA\x20encryption\x20failed:','1783341oDHuAM','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','Status:','json','PHP\x20decryptor\x20error','aes-256-ctr','❌\x20Data\x20being\x20signed:','Decryption\x20failed:\x20','Result\x20URL:','randomBytes','payment.success','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','updatePaymentStatus','🔐\x20Private\x20key\x20length:\x20','__setModuleDefault','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','push','privateDecrypt','mastercard','Failed\x20to\x20decrypt\x20response','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','isArray','ms)','/status_decrypt','519800VvqKDl','Failed\x20to\x20send\x20MasterCard\x20webhook:','settings','amount','/status_raw','4VkSvlV','❌\x20RSA\x20signing\x20failed:','__esModule','3ds_url','existsSync','slice','../telegramBotService','checkPaymentStatus','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','FAILED','call','📊\x20Status\x20check\x20#','⏰\x20Will\x20check\x20status\x20','https://api2.trapay.uk/decrypt.php','getOwnPropertyNames','description','forEach','\x20not\x20enabled\x20for\x20shop\x20','Error\x20parsing\x20webhook\x20events:','237318rWhilQ','application/json','✅\x20Scheduled\x20','then','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','status','****\x20****\x20****\x20','/charge_decrypted','join','merchantPointId','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','scheduleStatusChecks','webhookEvents','desc','logWhiteDomainError','toString','last_name','🔐\x20AES\x20key\x20and\x20IV\x20generated','-----BEGIN','shop','Private\x20key\x20file\x20not\x20found:\x20','Error\x20details:','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','generateAESKey','🛑\x20Stopped\x20','🔐\x20AES\x20IV\x20length:','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','/charge_raw','adminNotes','expire_year','resolve','statusCheckTimers','now','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','end','MasterCardService','🔐\x20Public\x20key\x20path:','/status_decrypted','MasterCard:\x20','🧹\x20Clearing\x20','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','prototype','sendPaymentNotification','substring','payment.failed','createdAt','encryptAES','webhook_send','📝\x20Data\x20length:','\x20characters','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','\x20is\x20final\x20(','📝\x20Data\x20to\x20sign\x20length:','📝\x20Signature\x20length:','Payment\x20ID:','clearStatusTimers','/charge','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','🔐\x20Data\x20signed\x20with\x20RSA','date_success','PENDING','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','length','crypto','currency','utf8','❌\x20MasterCard\x20key\x20validation\x20failed:','logWhiteDomainResponse','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','system','\x20status\x20checks\x20for\x20payment\x20','set','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','Unknown\x20error','unknown','❌\x20PHP\x20decryptor\x20request\x20failed:','../../config/database','\x20\x20\x20-\x20key\x20length:','create','signRSA','maskCardNumber','parse','message','logShopWebhookError','number','path','🔐\x20RSA\x20signing\x20successful','customerName','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','Webhook\x20event\x20','❌\x20Payment\x20failed\x20or\x20declined','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','Final:','defineProperty','from','text','decryptAES','\x20result:','TesSoft\x20Payment\x20System/1.0','constants','MasterCard\x20webhook\x20sent\x20to\x20','✅\x20Payment\x20','1184001pYrXSp','\x20for\x20payment\x20','stringify','🔍\x20MasterCard\x20status\x20check\x20#','\x20\x20\x20-\x20info\x20length:','__importStar','order_id','Public\x20key\x20file\x20not\x20found:\x20','base64','hasOwnProperty','),\x20stopping\x20status\x20checks','sign','HTTP\x20error!\x20status:\x20','info','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','\x20\x20\x20-\x20lang:\x20en','charge','keys','createSign','POST','\x20\x20\x20-\x20merchant_point_id:'];a42_0x3c5b=function(){return _0x427110;};return a42_0x3c5b();}