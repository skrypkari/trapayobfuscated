'use strict';const a51_0x46cbc9=a51_0x1957;(function(_0x56aa3a,_0x3ab161){const _0x39f0c4=a51_0x1957,_0x3d6e82=_0x56aa3a();while(!![]){try{const _0x4e286e=-parseInt(_0x39f0c4(0x1f0))/0x1+-parseInt(_0x39f0c4(0x20f))/0x2*(-parseInt(_0x39f0c4(0x22b))/0x3)+parseInt(_0x39f0c4(0x136))/0x4*(-parseInt(_0x39f0c4(0x235))/0x5)+-parseInt(_0x39f0c4(0x248))/0x6*(-parseInt(_0x39f0c4(0x27c))/0x7)+-parseInt(_0x39f0c4(0x16a))/0x8*(parseInt(_0x39f0c4(0x227))/0x9)+-parseInt(_0x39f0c4(0x23e))/0xa*(-parseInt(_0x39f0c4(0x1b8))/0xb)+parseInt(_0x39f0c4(0x1ae))/0xc*(parseInt(_0x39f0c4(0x22e))/0xd);if(_0x4e286e===_0x3ab161)break;else _0x3d6e82['push'](_0x3d6e82['shift']());}catch(_0x422a0e){_0x3d6e82['push'](_0x3d6e82['shift']());}}}(a51_0x43cf,0x4290b));function a51_0x43cf(){const _0x55b84b=['cardType','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','readFileSync','merchantPointId','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','application/json','The\x20card\x20is\x20lost\x20or\x20stolen','RSA_PKCS1_PADDING','\x20for\x20payment\x20','createSign','\x20\x20\x20Amount:\x20','toString','visaMerchantPointId','Payment\x20System/1.0\x20(MasterCard)','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','warn','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','🔐\x20Data\x20signed\x20with\x20RSA','🎯\x20Using\x20','visaPublicKeyPath',',\x20paymentId=','error','Number\x20of\x20attempts\x20exceeded','webhookEvents','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','No\x20Error\x20executing\x20request','resolve','substring','charAt','293222HGRpna','floor','\x20\x20\x20Status:\x20','shop','stringify','amount','then','psp_public.pem',',\x20body:\x20','🔐\x20VISA\x20Public\x20key\x20path:','📝\x20Data\x20length:','\x20payment:\x20','Invalid\x20expiration\x20date','Failed\x20payment','Failed\x20to\x20decrypt\x20response','scheduleStatusChecks','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','configurable','🔐\x20VISA\x20Private\x20key\x20length:\x20','paymentStatuses','sendPaymentNotifications','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','/status_decrypted','payment','376803IcXcdu','getOwnPropertyNames','📝\x20Signature\x20length:','log','3ywvxnO','Status\x20','statusCheckTimers','845AnsdfE','includes','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','🔐\x20MasterCard\x20Public\x20key\x20path:','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','payment.failed','LookUp\x20number\x20of\x20attempts\x20exceeded','1567805DwVLqr','\x20\x20\x20-\x20lang:\x20en','===\x20API\x20RESPONSE\x20===','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','description','\x20webhook\x20extracted\x20data:','3DS\x20verification\x20required','Operation\x20completed\x20successfully','⏰\x20Scheduling\x20status\x20checks\x20for\x20','30cGtInR','Payment\x20confirmation\x20time\x20has\x20expired','Failed\x20to\x20send\x20MasterCard\x20webhook:','message','🔐\x20AES\x20key\x20and\x20IV\x20generated','visaPrivateKeyPath','clearStatusTimers','⏰\x20Will\x20check\x20status\x20','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','__importDefault','660966OUSBtG','\x20\x20\x20-\x20info\x20length:','🔐\x20MasterCard\x20Private\x20key\x20path:','findUnique','LookUp\x20not\x20confirmed','masterCardMerchantPointId','🔍\x20','/charge_decrypt','📊\x20Checking\x20','****','encryptRSA','__esModule','💾\x20Payment\x20data\x20prepared','currency','getOwnPropertyDescriptor','✅\x20Status\x20response\x20decrypted\x20successfully','Payment\x20System/1.0',':\x20Unknown\x20status\x20code','https://api2.trapay.uk/decrypt.php',',\x20Desc:\x20',',\x20Final:\x20','logWhiteDomainRequest',',\x20orderId=','errorMessage','customerEmail','❌\x20RSA\x20signing\x20failed:','✅\x20Scheduled\x20','Payment\x20pending\x20verification','decryptResponsePhp','cvv','create','decryptAES','visa_private.pem','No\x20New\x20payment','Request\x20data\x20error','validateKeyFiles','\x20characters','VISA','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','/charge','PAID','\x20result:','visa/mastercard','Method\x20not\x20allowed','visaApiUrl','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','\x20\x20\x20-\x20sign\x20length:','payment.success','default','Return\x20URL:','toLowerCase','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','7pZtnfr','number','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','Client\x20OTP\x20confirmation\x20required','\x20is\x20final\x20(','FAILED','final','\x20failed\x20for\x20payment\x20','delete','Failed\x20to\x20check\x20','slice','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','PIN\x20code\x20confirmation\x20awaited','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','Awaiting\x20confirmation\x20in\x20the\x20application','createdAt','decryptResponse','4000000000000000','📝\x20Encrypted\x20data\x20length:','/status','❌\x20Detailed\x20failure\x20description:\x20','🔐\x20RSA\x20signing\x20successful','5000000000000000','getCardTypeAndApi','trim','🧹\x20Clearing\x20','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','publicKeyPath','===\x20PARSED\x20API\x20RESPONSE\x20===','VisaMasterCardService','cwd','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','🔍\x20Using\x20','4tWgGRM','private.pem','Card\x20Number:','📝\x20Final\x20request\x20structure:','VISA/MasterCard\x20payment\x20successful','parse','utf8','/status_raw','createDecipheriv',',\x20final=','update','paid','Insufficient\x20funds\x20on\x20the\x20card','/status_decrypt','call','length','info','../../config/database','webhookUrl','\x20status\x20check\x20#','/charge_raw','HTTP\x20Status:','LookUp\x20code\x20verified','paymentId','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','Unsuccessful\x20payment','getDetailedErrorMessage',',\x20id=','Final:','toUpperCase','1111','✅\x20Payment\x20','Sender\x27s\x20CVV\x20card\x20is\x20required','publicEncrypt','Amount:','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','🔐\x203DS\x20verification\x20required','masterCardApiUrl','\x20not\x20enabled\x20for\x20shop\x20','join','failed','customerName','replace','existsSync','📤\x20Sending\x20request\x20to\x20API...','privateKeyPath','get','MASTERCARD','Payment\x20is\x20being\x20processed','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','88pXnuqx','\x20(from:\x20status=','3ds_url','randomBytes','orderId','logShopWebhookSent','🔐\x20MasterCard\x20API\x20URL:','processWebhook','🔐\x20AES\x20key\x20length:','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','expire_month','🔍\x20Using\x20provided\x20card\x20type:\x20','🔐\x20VISA\x20Private\x20key\x20path:','base64','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','keys','now','Expected\x20bitcoin\x20transfer\x20from\x20client','Cancellation\x20is\x20not\x20possible','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','\x20\x20\x20-\x20merchant_point_id:','****\x20****\x20****\x20','loggerService','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','📝\x20Decrypted\x20webhook\x20data:','system','aes-256-ctr','isArray','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','🔐\x20Data\x20encrypted\x20with\x20AES','end','set','Card\x20Holder:','PENDING','gatewayOrderId','sign','Sender\x27s\x20card\x20details\x20are\x20required','LookUp\x20code\x20sent','POST','from','HTTP\x20error!\x20status:\x20','apiUrl','writable','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','stopAllStatusChecks','Result\x20URL:','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','card_type','forEach','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','generateAESKey','Response\x20Time:','push','📝\x20Encrypted\x20key\x20length:','Another\x20unknown\x20error','❌\x20Data\x20being\x20signed:','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','Sender\x20information\x20required','🔐\x20VISA\x20Public\x20key\x20length:\x20','payment_id','status','unknown','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','Awaiting\x20confirmation\x20by\x20ivr\x20call','defineProperty','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','../telegramBotService','123132EbWRZi','logWhiteDomainError','sendShopWebhook','\x20API:\x20','\x20payment\x20status:\x20','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','VISA/MasterCard','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','Status\x20decryption\x20failed:\x20','path','1911811xJLFHs','),\x20defaulting\x20to\x20MasterCard','Payment\x20ID:','encryptAES','adminNotes','maskCardNumber','\x22\x20|\x20\x22','updatePaymentStatus','📊\x20','Failed\x20to\x20send\x20payment\x20notifications:','text','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','logShopWebhookError','visa_public.pem','Test\x20payment','-----BEGIN','https://api.paydmeth.com/api','✅\x20Payment\x20successful','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','shopId','signRSA','processCardPayment','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','logWhiteDomainResponse','webhook_send','Payment\x20confirmation\x20required','date_success','none','isFinalStatus','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','first_name','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','order_id','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','charge','Status:','\x20MasterCard\x20status\x20check\x20timers','Payment\x20cancellation\x20is\x20being\x20processed','desc','\x20\x20\x20-\x20method:\x20charge','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','...','settings','last_name','🔐\x20Using\x20keys:\x20','Error\x20parsing\x20webhook\x20events:','HTTP\x20','Payment\x20returned','key','\x20status\x20updated\x20to\x20','-----END','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','398391QZOAnb'];a51_0x43cf=function(){return _0x55b84b;};return a51_0x43cf();}function a51_0x1957(_0x137f22,_0x31c334){const _0x43cf05=a51_0x43cf();return a51_0x1957=function(_0x1957b6,_0x362091){_0x1957b6=_0x1957b6-0x132;let _0xe02bef=_0x43cf05[_0x1957b6];return _0xe02bef;},a51_0x1957(_0x137f22,_0x31c334);}var __createBinding=this&&this['__createBinding']||(Object[a51_0x46cbc9(0x266)]?function(_0x35abc5,_0x56c879,_0xea297,_0x55d024){const _0x44d394=a51_0x46cbc9;if(_0x55d024===undefined)_0x55d024=_0xea297;var _0x1b5bd1=Object[_0x44d394(0x256)](_0x56c879,_0xea297);(!_0x1b5bd1||(_0x44d394(0x166)in _0x1b5bd1?!_0x56c879[_0x44d394(0x253)]:_0x1b5bd1[_0x44d394(0x194)]||_0x1b5bd1[_0x44d394(0x220)]))&&(_0x1b5bd1={'enumerable':!![],'get':function(){return _0x56c879[_0xea297];}}),Object[_0x44d394(0x1ab)](_0x35abc5,_0x55d024,_0x1b5bd1);}:function(_0x2e5f13,_0x48293c,_0x526706,_0x3efaff){if(_0x3efaff===undefined)_0x3efaff=_0x526706;_0x2e5f13[_0x3efaff]=_0x48293c[_0x526706];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a51_0x46cbc9(0x266)]?function(_0x596a8e,_0x29d397){const _0x6a4a=a51_0x46cbc9;Object[_0x6a4a(0x1ab)](_0x596a8e,_0x6a4a(0x278),{'enumerable':!![],'value':_0x29d397});}:function(_0x37af7e,_0x440dfb){_0x37af7e['default']=_0x440dfb;}),__importStar=this&&this['__importStar']||(function(){var _0x55199e=function(_0x43dc85){const _0x25d51a=a51_0x1957;return _0x55199e=Object[_0x25d51a(0x228)]||function(_0x6dd338){const _0x513975=_0x25d51a;var _0x3d1cf9=[];for(var _0x33c61a in _0x6dd338)if(Object['prototype']['hasOwnProperty'][_0x513975(0x144)](_0x6dd338,_0x33c61a))_0x3d1cf9[_0x3d1cf9[_0x513975(0x145)]]=_0x33c61a;return _0x3d1cf9;},_0x55199e(_0x43dc85);};return function(_0x4312fc){const _0x1c80c6=a51_0x1957;if(_0x4312fc&&_0x4312fc[_0x1c80c6(0x253)])return _0x4312fc;var _0x2301ea={};if(_0x4312fc!=null){for(var _0x4a0000=_0x55199e(_0x4312fc),_0x52cd9c=0x0;_0x52cd9c<_0x4a0000['length'];_0x52cd9c++)if(_0x4a0000[_0x52cd9c]!==_0x1c80c6(0x278))__createBinding(_0x2301ea,_0x4312fc,_0x4a0000[_0x52cd9c]);}return __setModuleDefault(_0x2301ea,_0x4312fc),_0x2301ea;};}()),__importDefault=this&&this[a51_0x46cbc9(0x247)]||function(_0x484b4c){const _0x30f954=a51_0x46cbc9;return _0x484b4c&&_0x484b4c[_0x30f954(0x253)]?_0x484b4c:{'default':_0x484b4c};};Object['defineProperty'](exports,a51_0x46cbc9(0x253),{'value':!![]}),exports[a51_0x46cbc9(0x132)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x46cbc9(0x1b7))),loggerService_1=require('../loggerService');class VisaMasterCardService{constructor(){const _0x4e9be8=a51_0x46cbc9;this[_0x4e9be8(0x22d)]=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0x4e9be8(0x269)},0x1:{'final':![],'description':_0x4e9be8(0x20b)},0x2:{'final':!![],'description':_0x4e9be8(0x26a)},0x3:{'final':!![],'description':_0x4e9be8(0x1a1)},0x4:{'final':!![],'description':'Unsuccessful\x20payment'},0x5:{'final':!![],'description':_0x4e9be8(0x1ac)},0x6:{'final':!![],'description':'Payment\x20returned'},0x7:{'final':!![],'description':_0x4e9be8(0x1c6)},0x8:{'final':![],'description':_0x4e9be8(0x27f)},0x9:{'final':![],'description':_0x4e9be8(0x23b)},0xa:{'final':![],'description':_0x4e9be8(0x157)},0xb:{'final':![],'description':_0x4e9be8(0x1a4)},0xc:{'final':![],'description':'Recipient\x20data\x20required'},0xd:{'final':![],'description':_0x4e9be8(0x19c)},0xe:{'final':![],'description':_0x4e9be8(0x1aa)},0xf:{'final':![],'description':_0x4e9be8(0x288)},0x10:{'final':![],'description':'Captcha\x20confirmation\x20awaited'},0x11:{'final':![],'description':'Awaiting\x20confirmation\x20of\x20the\x20login\x20password'},0x12:{'final':![],'description':_0x4e9be8(0x28a)},0x13:{'final':![],'description':_0x4e9be8(0x168)},0x14:{'final':![],'description':_0x4e9be8(0x15a)},0x15:{'final':![],'description':_0x4e9be8(0x17b)},0x16:{'final':![],'description':_0x4e9be8(0x263)},0x18:{'final':![],'description':'The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':'Cash\x20payment\x20is\x20expected\x20at\x20TCO'},0x1b:{'final':![],'description':_0x4e9be8(0x1c3)},0x1c:{'final':![],'description':_0x4e9be8(0x1a9)},0x1d:{'final':![],'description':_0x4e9be8(0x20a)},0x1f:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending'},0x20:{'final':![],'description':_0x4e9be8(0x1ef)},0x23:{'final':![],'description':_0x4e9be8(0x18e)},0x24:{'final':!![],'description':_0x4e9be8(0x23f)},0x25:{'final':!![],'description':'Payment\x20prohibited'},0x26:{'final':!![],'description':_0x4e9be8(0x202)},0x27:{'final':!![],'description':_0x4e9be8(0x142)},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':_0x4e9be8(0x1f8)},0x2a:{'final':!![],'description':_0x4e9be8(0x21b)},0x2b:{'final':!![],'description':'Transaction\x20limit\x20exceeded'},0x2c:{'final':!![],'description':_0x4e9be8(0x173)},0x2d:{'final':!![],'description':_0x4e9be8(0x21c)},0x2e:{'final':!![],'description':'Unsuccessful\x20payment'},0x2f:{'final':!![],'description':_0x4e9be8(0x150)},0x30:{'final':!![],'description':'Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled'},0x31:{'final':![],'description':_0x4e9be8(0x1d1)},0x32:{'final':!![],'description':_0x4e9be8(0x273)},0x33:{'final':!![],'description':_0x4e9be8(0x21c)},0x34:{'final':!![],'description':'Failed\x20payment'},0x35:{'final':!![],'description':'Failed\x20payment'},0x36:{'final':!![],'description':_0x4e9be8(0x21c)},0x37:{'final':!![],'description':_0x4e9be8(0x21c)},0x38:{'final':!![],'description':_0x4e9be8(0x17c)},0x39:{'final':![],'description':_0x4e9be8(0x1db)},0x3a:{'final':![],'description':_0x4e9be8(0x18f)},0x3b:{'final':!![],'description':_0x4e9be8(0x14c)},0x3c:{'final':!![],'description':_0x4e9be8(0x208)},0x3d:{'final':!![],'description':_0x4e9be8(0x296)},0x3e:{'final':!![],'description':_0x4e9be8(0x15b)},0x3f:{'final':!![],'description':_0x4e9be8(0x1eb)},0x40:{'final':![],'description':_0x4e9be8(0x24c)},0x41:{'final':!![],'description':_0x4e9be8(0x234)},0x42:{'final':![],'description':_0x4e9be8(0x1df)},0x43:{'final':!![],'description':_0x4e9be8(0x14e)},0x44:{'final':![],'description':_0x4e9be8(0x23b)},0x45:{'final':!![],'description':_0x4e9be8(0x21c)},0x46:{'final':!![],'description':_0x4e9be8(0x21c)},0x47:{'final':!![],'description':'Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details'},0x64:{'final':!![],'description':_0x4e9be8(0x23c)}},this[_0x4e9be8(0x15d)]='https://api.paydmeth.com/api',this['masterCardMerchantPointId']=0x6e4,this[_0x4e9be8(0x165)]=path_1[_0x4e9be8(0x278)][_0x4e9be8(0x15f)](process[_0x4e9be8(0x133)](),'keys',_0x4e9be8(0x137)),this[_0x4e9be8(0x297)]=path_1['default'][_0x4e9be8(0x15f)](process[_0x4e9be8(0x133)](),_0x4e9be8(0x179),_0x4e9be8(0x216)),this[_0x4e9be8(0x274)]=_0x4e9be8(0x1c8),this[_0x4e9be8(0x1fe)]=0x6b7,this[_0x4e9be8(0x243)]=path_1['default'][_0x4e9be8(0x15f)](process[_0x4e9be8(0x133)](),_0x4e9be8(0x179),_0x4e9be8(0x268)),this[_0x4e9be8(0x205)]=path_1[_0x4e9be8(0x278)]['join'](process[_0x4e9be8(0x133)](),_0x4e9be8(0x179),_0x4e9be8(0x1c5)),console['log']('💳\x20VISA/MasterCard\x20service\x20initialized'),console[_0x4e9be8(0x22a)](_0x4e9be8(0x170),this['masterCardApiUrl']),console[_0x4e9be8(0x22a)]('🔐\x20VISA\x20API\x20URL:',this[_0x4e9be8(0x274)]),console['log'](_0x4e9be8(0x24a),this[_0x4e9be8(0x165)]),console[_0x4e9be8(0x22a)](_0x4e9be8(0x231),this[_0x4e9be8(0x297)]),console[_0x4e9be8(0x22a)](_0x4e9be8(0x176),this[_0x4e9be8(0x243)]),console[_0x4e9be8(0x22a)](_0x4e9be8(0x218),this['visaPublicKeyPath']),this[_0x4e9be8(0x26b)]();}['getDetailedErrorMessage'](_0x28ca16,_0x546cc4){const _0x12ccb8=a51_0x46cbc9,_0x4e6a0b=this[_0x12ccb8(0x222)][_0x28ca16];let _0x1d8d53='';_0x4e6a0b?_0x1d8d53=_0x12ccb8(0x22c)+_0x28ca16+':\x20'+_0x4e6a0b[_0x12ccb8(0x239)]:_0x1d8d53='Status\x20'+_0x28ca16+_0x12ccb8(0x259);if(_0x546cc4&&_0x546cc4[_0x12ccb8(0x294)]()){const _0x35f794=_0x546cc4[_0x12ccb8(0x294)]();(!_0x4e6a0b||_0x35f794[_0x12ccb8(0x27a)]()!==_0x4e6a0b[_0x12ccb8(0x239)][_0x12ccb8(0x27a)]())&&(_0x1d8d53+='\x20|\x20Response:\x20'+_0x35f794);}return _0x1d8d53;}[a51_0x46cbc9(0x1d4)](_0x20063e){const _0x5a688e=a51_0x46cbc9,_0xc91f2f=this['paymentStatuses'][_0x20063e];return _0xc91f2f?_0xc91f2f[_0x5a688e(0x282)]:!![];}['getCardTypeAndApi'](_0xabf798){const _0x5de17c=a51_0x46cbc9,_0x14dc3d=_0xabf798[_0x5de17c(0x20e)](0x0);if(_0x14dc3d==='4')return console['log'](_0x5de17c(0x14f)),{'cardType':_0x5de17c(0x26d),'apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x5de17c(0x243)],'publicKeyPath':this[_0x5de17c(0x205)],'merchantPointId':this[_0x5de17c(0x1fe)]};else return _0x14dc3d==='5'?(console[_0x5de17c(0x22a)](_0x5de17c(0x1f2)),{'cardType':_0x5de17c(0x167),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x5de17c(0x165)],'publicKeyPath':this[_0x5de17c(0x297)],'merchantPointId':this[_0x5de17c(0x24d)]}):(console[_0x5de17c(0x22a)](_0x5de17c(0x238)+_0x14dc3d+_0x5de17c(0x1b9)),{'cardType':'MASTERCARD','apiUrl':this[_0x5de17c(0x15d)],'privateKeyPath':this[_0x5de17c(0x165)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x5de17c(0x24d)]});}['validateKeyFiles'](){const _0x1adadc=a51_0x46cbc9;try{if(!fs_1[_0x1adadc(0x278)][_0x1adadc(0x163)](this[_0x1adadc(0x165)]))throw new Error(_0x1adadc(0x1e2)+this[_0x1adadc(0x165)]);if(!fs_1['default'][_0x1adadc(0x163)](this[_0x1adadc(0x297)]))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this[_0x1adadc(0x297)]);const _0x34913f=fs_1[_0x1adadc(0x278)][_0x1adadc(0x1f3)](this['privateKeyPath'],_0x1adadc(0x13c))[_0x1adadc(0x294)](),_0x34f021=fs_1[_0x1adadc(0x278)][_0x1adadc(0x1f3)](this[_0x1adadc(0x297)],_0x1adadc(0x13c))[_0x1adadc(0x294)]();if(!_0x34913f[_0x1adadc(0x22f)](_0x1adadc(0x1c7))||!_0x34913f['includes'](_0x1adadc(0x1ee)))throw new Error(_0x1adadc(0x287));if(!_0x34f021['includes'](_0x1adadc(0x1c7))||!_0x34f021[_0x1adadc(0x22f)](_0x1adadc(0x1ee)))throw new Error(_0x1adadc(0x26e));console['log'](_0x1adadc(0x134)),console['log'](_0x1adadc(0x169)+_0x34913f['length']+_0x1adadc(0x26c)),console['log'](_0x1adadc(0x1b5)+_0x34f021[_0x1adadc(0x145)]+_0x1adadc(0x26c));if(fs_1[_0x1adadc(0x278)][_0x1adadc(0x163)](this[_0x1adadc(0x243)])&&fs_1[_0x1adadc(0x278)][_0x1adadc(0x163)](this[_0x1adadc(0x205)])){const _0x1bdd2a=fs_1[_0x1adadc(0x278)][_0x1adadc(0x1f3)](this[_0x1adadc(0x243)],'utf8')['trim'](),_0x12fddc=fs_1['default']['readFileSync'](this['visaPublicKeyPath'],_0x1adadc(0x13c))[_0x1adadc(0x294)]();(!_0x1bdd2a[_0x1adadc(0x22f)](_0x1adadc(0x1c7))||!_0x1bdd2a[_0x1adadc(0x22f)]('-----END'))&&console['warn']('⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),(!_0x12fddc[_0x1adadc(0x22f)](_0x1adadc(0x1c7))||!_0x12fddc[_0x1adadc(0x22f)](_0x1adadc(0x1ee)))&&console['warn'](_0x1adadc(0x1d8)),console['log']('✅\x20VISA\x20key\x20files\x20validated\x20successfully'),console[_0x1adadc(0x22a)](_0x1adadc(0x221)+_0x1bdd2a[_0x1adadc(0x145)]+_0x1adadc(0x26c)),console['log'](_0x1adadc(0x1a5)+_0x12fddc[_0x1adadc(0x145)]+_0x1adadc(0x26c));}else console[_0x1adadc(0x201)](_0x1adadc(0x21f)),console[_0x1adadc(0x201)](_0x1adadc(0x1ce)+this['visaPrivateKeyPath']),console[_0x1adadc(0x201)](_0x1adadc(0x181)+this['visaPublicKeyPath']);}catch(_0x30b6a6){console[_0x1adadc(0x207)](_0x1adadc(0x1d9),_0x30b6a6);throw _0x30b6a6;}}[a51_0x46cbc9(0x19d)](){const _0x40bc47=a51_0x46cbc9,_0x3cab98=crypto_1[_0x40bc47(0x278)][_0x40bc47(0x16d)](0x20),_0x1749fc=crypto_1['default'][_0x40bc47(0x16d)](0x10);return{'key':_0x3cab98,'iv':_0x1749fc};}['encryptAES'](_0x56dedd,_0x1e0919,_0x4f6db9){const _0x4864d2=a51_0x46cbc9,_0x166c97=crypto_1['default']['createCipheriv'](_0x4864d2(0x184),_0x1e0919,_0x4f6db9);let _0x2f8dd8=_0x166c97[_0x4864d2(0x140)](_0x56dedd,_0x4864d2(0x13c),_0x4864d2(0x177));return _0x2f8dd8+=_0x166c97[_0x4864d2(0x282)](_0x4864d2(0x177)),_0x2f8dd8;}['encryptRSA'](_0x467eaa,_0x5edea9,_0xfe84c8){const _0x8b52f3=a51_0x46cbc9;try{const _0x1642f1=fs_1['default']['readFileSync'](_0xfe84c8,'utf8')[_0x8b52f3(0x294)](),_0x35a9bd={'iv':_0x5edea9[_0x8b52f3(0x1fd)](_0x8b52f3(0x177)),'key':_0x467eaa[_0x8b52f3(0x1fd)](_0x8b52f3(0x177))},_0x1b5231=JSON[_0x8b52f3(0x213)](_0x35a9bd);console[_0x8b52f3(0x22a)](_0x8b52f3(0x196),_0x1b5231[_0x8b52f3(0x145)]);const _0x24b7c3=crypto_1[_0x8b52f3(0x278)][_0x8b52f3(0x158)]({'key':_0x1642f1,'padding':crypto_1[_0x8b52f3(0x278)]['constants'][_0x8b52f3(0x1f9)]},Buffer['from'](_0x1b5231));return console['log'](_0x8b52f3(0x1a3),_0x24b7c3[_0x8b52f3(0x145)]),_0x24b7c3['toString'](_0x8b52f3(0x177));}catch(_0x2512cc){console[_0x8b52f3(0x207)]('❌\x20RSA\x20encryption\x20failed:',_0x2512cc);throw new Error(_0x8b52f3(0x17d));}}[a51_0x46cbc9(0x1cc)](_0x26db76,_0x2dc660){const _0x5a7b62=a51_0x46cbc9;try{const _0x484e23=fs_1[_0x5a7b62(0x278)]['readFileSync'](_0x2dc660,_0x5a7b62(0x13c))[_0x5a7b62(0x294)](),_0x5bf677=crypto_1[_0x5a7b62(0x278)][_0x5a7b62(0x1fb)]('SHA256');_0x5bf677[_0x5a7b62(0x140)](_0x26db76),_0x5bf677[_0x5a7b62(0x188)]();const _0x1d98e2=_0x5bf677[_0x5a7b62(0x18d)](_0x484e23,_0x5a7b62(0x177));return console[_0x5a7b62(0x22a)](_0x5a7b62(0x291)),console[_0x5a7b62(0x22a)]('📝\x20Data\x20to\x20sign\x20length:',_0x26db76['length']),console['log']('📝\x20Signature\x20length:',_0x1d98e2[_0x5a7b62(0x145)]),_0x1d98e2;}catch(_0x5585ac){console['error'](_0x5a7b62(0x261),_0x5585ac),console[_0x5a7b62(0x207)](_0x5a7b62(0x1a2),_0x26db76[_0x5a7b62(0x20d)](0x0,0xc8)+_0x5a7b62(0x1e5));throw new Error(_0x5a7b62(0x27e));}}['decryptAES'](_0x51147d,_0x209624,_0x1a4de7){const _0xbc789f=a51_0x46cbc9,_0x2eea4c=crypto_1['default'][_0xbc789f(0x13e)](_0xbc789f(0x184),_0x209624,_0x1a4de7);let _0x23bb5f=_0x2eea4c[_0xbc789f(0x140)](_0x51147d,_0xbc789f(0x177),_0xbc789f(0x13c));return _0x23bb5f+=_0x2eea4c[_0xbc789f(0x282)]('utf8'),_0x23bb5f;}async[a51_0x46cbc9(0x264)](_0x314f0c,_0x25cc9c,_0xffb19d=a51_0x46cbc9(0x167)){const _0x2c62e1=a51_0x46cbc9;try{const _0x4d644d=await fetch(_0x2c62e1(0x25a),{'method':_0x2c62e1(0x190),'headers':{'Content-Type':'application/json'},'body':JSON[_0x2c62e1(0x213)]({'info':_0x314f0c,'key':_0x25cc9c,'card_type':_0xffb19d[_0x2c62e1(0x27a)]()})});if(!_0x4d644d['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x4d644d[_0x2c62e1(0x1c2)]();}catch(_0x164f3b){console['error']('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x164f3b);throw new Error(_0x2c62e1(0x27b));}}[a51_0x46cbc9(0x28c)](_0x18d7fa,_0x425da1){const _0x3d686e=a51_0x46cbc9;try{const _0x24f772=fs_1[_0x3d686e(0x278)]['readFileSync'](this[_0x3d686e(0x165)],_0x3d686e(0x13c))[_0x3d686e(0x294)](),_0x6b7b5d=crypto_1[_0x3d686e(0x278)]['privateDecrypt'](_0x24f772,Buffer[_0x3d686e(0x191)](_0x425da1,'base64')),_0x47da8a=JSON[_0x3d686e(0x13b)](_0x6b7b5d[_0x3d686e(0x1fd)]()),_0x4d34d6=Buffer['from'](_0x47da8a[_0x3d686e(0x1ec)],_0x3d686e(0x177)),_0x3ac07c=Buffer[_0x3d686e(0x191)](_0x47da8a['iv'],_0x3d686e(0x177));return this[_0x3d686e(0x267)](_0x18d7fa,_0x4d34d6,_0x3ac07c);}catch(_0x39f9c4){throw new Error(_0x3d686e(0x21d));}}async[a51_0x46cbc9(0x1cd)](_0x126f2d){const _0x5aba18=a51_0x46cbc9,{paymentId:_0x314f77,orderId:_0xac6bdf,amount:_0x4b2171,currency:_0x5d47d7,cardData:_0x2dc189,resultUrl:_0x209679,returnUrl:_0x1f028e,cardHolder:_0x72066a,browser:_0x713dbf}=_0x126f2d;console[_0x5aba18(0x22a)]('===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console['log']('Payment\x20ID:',_0x314f77),console['log']('Order\x20ID:',_0xac6bdf),console[_0x5aba18(0x22a)](_0x5aba18(0x159),_0x4b2171,_0x5d47d7),console['log'](_0x5aba18(0x138),this[_0x5aba18(0x1bd)](_0x2dc189[_0x5aba18(0x27d)])),console['log'](_0x5aba18(0x18a),_0x72066a[_0x5aba18(0x1d7)]+'\x20'+_0x72066a['last_name']),console[_0x5aba18(0x22a)](_0x5aba18(0x279),_0x1f028e),console[_0x5aba18(0x22a)](_0x5aba18(0x198),_0x209679);const _0x217dfd=this[_0x5aba18(0x293)](_0x2dc189['number']);console[_0x5aba18(0x22a)](_0x5aba18(0x204)+_0x217dfd['cardType']+_0x5aba18(0x1b1)+_0x217dfd[_0x5aba18(0x193)]),console[_0x5aba18(0x22a)](_0x5aba18(0x1e8)+_0x217dfd[_0x5aba18(0x165)]+',\x20'+_0x217dfd['publicKeyPath']);const _0x3c3b3a={..._0x72066a,'first_name':_0x72066a['first_name']?.[_0x5aba18(0x162)](/[\t\n\r\f\v]/g,'\x20')[_0x5aba18(0x294)]()||'','last_name':_0x72066a[_0x5aba18(0x1e7)]?.[_0x5aba18(0x162)](/[\t\n\r\f\v]/g,'\x20')[_0x5aba18(0x294)]()||''};console['log']('🧹\x20Card\x20holder\x20names\x20cleaned:'),console['log']('\x20\x20Original:\x20\x22'+_0x72066a[_0x5aba18(0x1d7)]+_0x5aba18(0x1be)+_0x72066a[_0x5aba18(0x1e7)]+'\x22'),console['log']('\x20\x20Cleaned:\x20\x20\x22'+_0x3c3b3a[_0x5aba18(0x1d7)]+'\x22\x20|\x20\x22'+_0x3c3b3a[_0x5aba18(0x1e7)]+'\x22');const _0x2d6667={'amount':_0x4b2171,'currency':_0x5d47d7[_0x5aba18(0x154)](),'order_id':_0xac6bdf,'result_url':_0x209679,'return_url':_0x1f028e,'country':'','card':{'number':_0x2dc189['number'],'expire_month':_0x2dc189[_0x5aba18(0x174)],'expire_year':_0x2dc189['expire_year'],'cvv':_0x2dc189[_0x5aba18(0x265)]},'card_holder':_0x3c3b3a,'browser':_0x713dbf},_0x5e5148=JSON[_0x5aba18(0x213)](_0x2d6667);console['log'](_0x5aba18(0x254)),console[_0x5aba18(0x22a)](_0x5aba18(0x186)),console[_0x5aba18(0x22a)](_0x5e5148),console[_0x5aba18(0x22a)](_0x5aba18(0x219),_0x5e5148['length']);try{const {key:_0x164898,iv:_0x1e8a24}=this[_0x5aba18(0x19d)]();console['log'](_0x5aba18(0x242)),console['log'](_0x5aba18(0x172),_0x164898[_0x5aba18(0x145)]),console[_0x5aba18(0x22a)]('🔐\x20AES\x20IV\x20length:',_0x1e8a24[_0x5aba18(0x145)]);const _0x5df27e=this[_0x5aba18(0x1bb)](_0x5e5148,_0x164898,_0x1e8a24);console[_0x5aba18(0x22a)](_0x5aba18(0x187)),console[_0x5aba18(0x22a)](_0x5aba18(0x28e),_0x5df27e[_0x5aba18(0x145)]);const _0x388a05=this[_0x5aba18(0x252)](_0x164898,_0x1e8a24,_0x217dfd['publicKeyPath']);console[_0x5aba18(0x22a)](_0x5aba18(0x1f5)),console[_0x5aba18(0x22a)](_0x5aba18(0x1a0),_0x388a05[_0x5aba18(0x145)]);const _0x311013=this[_0x5aba18(0x1cc)](_0x5e5148,_0x217dfd['privateKeyPath']);console[_0x5aba18(0x22a)](_0x5aba18(0x203)),console['log'](_0x5aba18(0x229),_0x311013[_0x5aba18(0x145)]);const _0x84bb79={'merchant_point_id':_0x217dfd[_0x5aba18(0x1f4)],'method':_0x5aba18(0x1dc),'info':_0x5df27e,'key':_0x388a05,'sign':_0x311013,'lang':'en'};console[_0x5aba18(0x22a)](_0x5aba18(0x164)),console['log'](_0x5aba18(0x139)),console[_0x5aba18(0x22a)](_0x5aba18(0x17e),_0x217dfd[_0x5aba18(0x1f4)]),console[_0x5aba18(0x22a)](_0x5aba18(0x1e1)),console[_0x5aba18(0x22a)](_0x5aba18(0x249),_0x5df27e[_0x5aba18(0x145)]),console[_0x5aba18(0x22a)]('\x20\x20\x20-\x20key\x20length:',_0x388a05[_0x5aba18(0x145)]),console[_0x5aba18(0x22a)](_0x5aba18(0x276),_0x311013[_0x5aba18(0x145)]),console[_0x5aba18(0x22a)](_0x5aba18(0x236)),loggerService_1[_0x5aba18(0x180)][_0x5aba18(0x25d)](_0x217dfd[_0x5aba18(0x1f1)][_0x5aba18(0x27a)](),_0x5aba18(0x26f),'POST',{'merchant_point_id':_0x217dfd[_0x5aba18(0x1f4)],'method':_0x5aba18(0x1dc),'lang':'en'});const _0x4ceca0=Date[_0x5aba18(0x17a)](),_0x5b04d3=await fetch(_0x217dfd[_0x5aba18(0x193)],{'method':'POST','headers':{'Content-Type':_0x5aba18(0x1f7),'Accept':_0x5aba18(0x1f7),'User-Agent':_0x5aba18(0x258)},'body':JSON[_0x5aba18(0x213)](_0x84bb79)}),_0x10dcd9=Date[_0x5aba18(0x17a)]()-_0x4ceca0;console[_0x5aba18(0x22a)](_0x5aba18(0x237)),console['log'](_0x5aba18(0x1dd),_0x5b04d3['status']),console['log'](_0x5aba18(0x19e),_0x10dcd9+'ms');if(!_0x5b04d3['ok']){const _0x23708c=await _0x5b04d3[_0x5aba18(0x1c2)]();console[_0x5aba18(0x207)](_0x5aba18(0x14b),_0x5b04d3[_0x5aba18(0x1a7)]),console[_0x5aba18(0x207)]('Response\x20Body:',_0x23708c),loggerService_1[_0x5aba18(0x180)][_0x5aba18(0x1cf)](_0x217dfd['cardType']['toLowerCase'](),_0x5aba18(0x14a),_0x5b04d3[_0x5aba18(0x1a7)],_0x23708c,_0x10dcd9),loggerService_1[_0x5aba18(0x180)][_0x5aba18(0x1af)](_0x217dfd['cardType'][_0x5aba18(0x27a)](),_0x5aba18(0x26f),_0x5aba18(0x1ea)+_0x5b04d3['status']+':\x20'+_0x23708c);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5b04d3['status']+_0x5aba18(0x217)+_0x23708c);}const _0x4d1210=await _0x5b04d3['json']();loggerService_1[_0x5aba18(0x180)]['logWhiteDomainResponse'](_0x217dfd[_0x5aba18(0x1f1)]['toLowerCase'](),_0x5aba18(0x14a),_0x5b04d3[_0x5aba18(0x1a7)],_0x4d1210,_0x10dcd9),console[_0x5aba18(0x22a)](_0x5aba18(0x298));let _0x216225=_0x4d1210;if(_0x4d1210[_0x5aba18(0x146)]&&_0x4d1210['key']&&_0x4d1210[_0x5aba18(0x18d)]){console['log'](_0x5aba18(0x1ca));try{const _0x564e62=await this[_0x5aba18(0x264)](_0x4d1210[_0x5aba18(0x146)],_0x4d1210[_0x5aba18(0x1ec)],_0x217dfd[_0x5aba18(0x1f1)]);_0x216225=JSON['parse'](_0x564e62),console[_0x5aba18(0x22a)](_0x5aba18(0x199)),loggerService_1['loggerService'][_0x5aba18(0x1cf)](_0x217dfd[_0x5aba18(0x1f1)][_0x5aba18(0x27a)](),'/charge_decrypted',_0x5b04d3[_0x5aba18(0x1a7)],_0x216225,_0x10dcd9),console['log']('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x5c8b82){console[_0x5aba18(0x207)](_0x5aba18(0x195),_0x5c8b82),loggerService_1[_0x5aba18(0x180)]['logWhiteDomainError'](_0x217dfd['cardType'][_0x5aba18(0x27a)](),_0x5aba18(0x24f),'Decryption\x20failed:\x20'+_0x5c8b82),_0x216225=_0x4d1210;}}else loggerService_1[_0x5aba18(0x180)][_0x5aba18(0x1cf)](_0x217dfd[_0x5aba18(0x1f1)][_0x5aba18(0x27a)](),'/charge_decrypted',_0x5b04d3[_0x5aba18(0x1a7)],_0x216225,_0x10dcd9),console[_0x5aba18(0x22a)](_0x5aba18(0x275));console[_0x5aba18(0x22a)]('Status:',_0x216225[_0x5aba18(0x1a7)]),console['log'](_0x5aba18(0x153),_0x216225[_0x5aba18(0x282)]),console[_0x5aba18(0x22a)](_0x5aba18(0x1ba),_0x216225[_0x5aba18(0x1a6)]),console[_0x5aba18(0x22a)]('3DS\x20URL:',_0x216225[_0x5aba18(0x16c)]||_0x5aba18(0x1d3));if(_0x216225['status']===0x64&&_0x216225[_0x5aba18(0x282)]===0x1)return console['log'](_0x5aba18(0x1c9)),{'gateway_payment_id':_0x216225[_0x5aba18(0x1a6)]?.[_0x5aba18(0x1fd)](),'payment_url':_0x1f028e,'requires_3ds':![],'status':_0x5aba18(0x270),'final':!![]};if(_0x216225[_0x5aba18(0x16c)])return console[_0x5aba18(0x22a)](_0x5aba18(0x15c)),this[_0x5aba18(0x21e)](_0x314f77,_0xac6bdf,_0x216225[_0x5aba18(0x1a6)]?.[_0x5aba18(0x1fd)]()||_0xac6bdf,_0x217dfd[_0x5aba18(0x1f1)]),{'gateway_payment_id':_0x216225[_0x5aba18(0x1a6)]?.[_0x5aba18(0x1fd)](),'payment_url':_0x216225[_0x5aba18(0x16c)],'requires_3ds':!![],'threeds_url':_0x216225['3ds_url'],'status':_0x5aba18(0x18b),'final':![]};let _0x14c5a7=this[_0x5aba18(0x151)](_0x216225['status'],_0x216225[_0x5aba18(0x1e0)]||_0x216225['message']),_0x84d5e3=_0x216225[_0x5aba18(0x1a7)],_0x10c119=this[_0x5aba18(0x1d4)](_0x216225[_0x5aba18(0x1a7)]);return console[_0x5aba18(0x22a)](_0x5aba18(0x246)+_0x84d5e3+_0x5aba18(0x25c)+_0x10c119+_0x5aba18(0x25b)+_0x14c5a7),{'gateway_payment_id':_0x216225[_0x5aba18(0x1a6)]?.[_0x5aba18(0x1fd)](),'payment_url':_0x1f028e,'requires_3ds':![],'status':'FAILED','final':!![],'errorMessage':_0x14c5a7};}catch(_0x3fb1ba){console[_0x5aba18(0x207)](_0x5aba18(0x1d6)),console[_0x5aba18(0x207)]('Error\x20details:',_0x3fb1ba),loggerService_1['loggerService'][_0x5aba18(0x1af)](_0x5aba18(0x272),_0x5aba18(0x26f),_0x3fb1ba);throw new Error(_0x5aba18(0x1b3)+(_0x3fb1ba instanceof Error?_0x3fb1ba[_0x5aba18(0x241)]:'Unknown\x20error'));}}async['checkPaymentStatus'](_0x3ed75c,_0x5d4ea2,_0x18f537=a51_0x46cbc9(0x26d)){const _0x56cc0e=a51_0x46cbc9;console[_0x56cc0e(0x22a)](_0x56cc0e(0x250)+_0x18f537+'\x20payment\x20status:\x20'+_0x3ed75c+'\x20('+_0x5d4ea2+')');try{const _0x54e682={'payment_id':_0x3ed75c,'order_id':_0x5d4ea2},_0x49238d=JSON[_0x56cc0e(0x213)](_0x54e682),_0x3900c6=this['getCardTypeAndApi'](_0x18f537===_0x56cc0e(0x26d)?_0x56cc0e(0x28d):_0x56cc0e(0x292)),{key:_0xc28f04,iv:_0x3e35a}=this[_0x56cc0e(0x19d)](),_0x30a700=this[_0x56cc0e(0x1bb)](_0x49238d,_0xc28f04,_0x3e35a),_0x54e3f8=this[_0x56cc0e(0x252)](_0xc28f04,_0x3e35a,_0x3900c6[_0x56cc0e(0x297)]),_0x4e118a=this['signRSA'](_0x49238d,_0x3900c6[_0x56cc0e(0x165)]),_0x343693={'merchant_point_id':_0x3900c6[_0x56cc0e(0x1f4)],'method':'status','info':_0x30a700,'key':_0x54e3f8,'sign':_0x4e118a,'lang':'en'};loggerService_1[_0x56cc0e(0x180)][_0x56cc0e(0x25d)](_0x18f537[_0x56cc0e(0x27a)](),_0x56cc0e(0x28f),_0x56cc0e(0x190),{'merchant_point_id':_0x3900c6[_0x56cc0e(0x1f4)],'method':_0x56cc0e(0x1a7),'lang':'en'});const _0x4c00c3=Date[_0x56cc0e(0x17a)](),_0x3ab219=await fetch(_0x3900c6[_0x56cc0e(0x193)],{'method':_0x56cc0e(0x190),'headers':{'Content-Type':_0x56cc0e(0x1f7),'Accept':'application/json','User-Agent':_0x56cc0e(0x258)},'body':JSON[_0x56cc0e(0x213)](_0x343693)}),_0x38d6c6=Date['now']()-_0x4c00c3;if(!_0x3ab219['ok']){const _0x34a4cb=await _0x3ab219[_0x56cc0e(0x1c2)]();loggerService_1[_0x56cc0e(0x180)][_0x56cc0e(0x1cf)](_0x18f537[_0x56cc0e(0x27a)](),_0x56cc0e(0x13d),_0x3ab219[_0x56cc0e(0x1a7)],_0x34a4cb,_0x38d6c6);throw new Error(_0x56cc0e(0x192)+_0x3ab219['status']);}const _0x2aea1b=await _0x3ab219['json']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x18f537[_0x56cc0e(0x27a)](),_0x56cc0e(0x13d),_0x3ab219[_0x56cc0e(0x1a7)],_0x2aea1b,_0x38d6c6);let _0x6cbcaf=_0x2aea1b;if(_0x2aea1b[_0x56cc0e(0x146)]&&_0x2aea1b['key']&&_0x2aea1b[_0x56cc0e(0x18d)]){console[_0x56cc0e(0x22a)]('🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0xb38bea=await this[_0x56cc0e(0x264)](_0x2aea1b['info'],_0x2aea1b['key'],_0x18f537);_0x6cbcaf=JSON['parse'](_0xb38bea),console[_0x56cc0e(0x22a)](_0x56cc0e(0x257)),loggerService_1['loggerService'][_0x56cc0e(0x1cf)](_0x18f537[_0x56cc0e(0x27a)](),_0x56cc0e(0x225),_0x3ab219['status'],_0x6cbcaf,_0x38d6c6),console['log'](_0x56cc0e(0x232));}catch(_0x3df2fd){console[_0x56cc0e(0x207)](_0x56cc0e(0x230),_0x3df2fd),loggerService_1['loggerService'][_0x56cc0e(0x1af)](_0x18f537[_0x56cc0e(0x27a)](),_0x56cc0e(0x143),_0x56cc0e(0x1b6)+_0x3df2fd),_0x6cbcaf=_0x2aea1b;}}else loggerService_1[_0x56cc0e(0x180)][_0x56cc0e(0x1cf)](_0x18f537['toLowerCase'](),_0x56cc0e(0x225),_0x3ab219[_0x56cc0e(0x1a7)],_0x6cbcaf,_0x38d6c6),console[_0x56cc0e(0x22a)](_0x56cc0e(0x1e4));console[_0x56cc0e(0x22a)]('📊\x20Status\x20check\x20result:',{'status':_0x6cbcaf[_0x56cc0e(0x1a7)],'final':_0x6cbcaf[_0x56cc0e(0x282)],'payment_id':_0x6cbcaf[_0x56cc0e(0x1a6)],'desc':_0x6cbcaf[_0x56cc0e(0x1e0)]});let _0xefeb13=_0x56cc0e(0x18b);if(_0x6cbcaf['status']===0x64&&_0x6cbcaf[_0x56cc0e(0x282)]===0x1)_0xefeb13=_0x56cc0e(0x270);else{if(_0x6cbcaf[_0x56cc0e(0x282)]===0x0||!this[_0x56cc0e(0x1d4)](_0x6cbcaf['status']))_0xefeb13=_0x56cc0e(0x18b);else _0x6cbcaf[_0x56cc0e(0x282)]===0x1||this[_0x56cc0e(0x1d4)](_0x6cbcaf['status'])?_0xefeb13=_0x56cc0e(0x281):_0xefeb13=_0x56cc0e(0x18b);}const _0x4c53f5=this[_0x56cc0e(0x151)](_0x6cbcaf[_0x56cc0e(0x1a7)],_0x6cbcaf['desc']);return{'status':_0xefeb13,'final':this[_0x56cc0e(0x1d4)](_0x6cbcaf[_0x56cc0e(0x1a7)]),'amount':_0x6cbcaf[_0x56cc0e(0x214)],'currency':_0x6cbcaf[_0x56cc0e(0x255)],'date_success':_0x6cbcaf[_0x56cc0e(0x1d2)],'description':_0x4c53f5};}catch(_0x52de7a){console[_0x56cc0e(0x207)](_0x18f537+'\x20status\x20check\x20error:',_0x52de7a),loggerService_1['loggerService'][_0x56cc0e(0x1af)](_0x18f537[_0x56cc0e(0x27a)](),_0x56cc0e(0x28f),_0x52de7a);throw new Error(_0x56cc0e(0x285)+_0x18f537+_0x56cc0e(0x1b2)+(_0x52de7a instanceof Error?_0x52de7a[_0x56cc0e(0x241)]:'Unknown\x20error'));}}[a51_0x46cbc9(0x21e)](_0x5e1702,_0x4a4e8f,_0x5bfd89,_0x4c021f){const _0xd1fe6a=a51_0x46cbc9;console[_0xd1fe6a(0x22a)](_0xd1fe6a(0x23d)+_0x4c021f+_0xd1fe6a(0x21a)+_0x5e1702+'\x20('+_0x5bfd89+')'),this[_0xd1fe6a(0x244)](_0x5e1702);const _0x5dd95e=[],_0x1c84c3=0x5*0x3c*0x3e8,_0x3be85c=0x2*0x3c*0x3c*0x3e8,_0x3511a7=Math[_0xd1fe6a(0x210)](_0x3be85c/_0x1c84c3);console[_0xd1fe6a(0x22a)](_0xd1fe6a(0x245)+_0x3511a7+_0xd1fe6a(0x1d5));for(let _0x389893=0x1;_0x389893<=_0x3511a7;_0x389893++){const _0x469ad7=setTimeout(async()=>{const _0x12c70f=_0xd1fe6a;console[_0x12c70f(0x22a)](_0x12c70f(0x24e)+_0x4c021f+_0x12c70f(0x149)+_0x389893+'/'+_0x3511a7+_0x12c70f(0x1fa)+_0x5e1702);try{const _0x16c8bd=await this['checkPaymentStatus'](_0x5bfd89,_0x4a4e8f,_0x4c021f);console[_0x12c70f(0x22a)]('📊\x20Status\x20check\x20#'+_0x389893+_0x12c70f(0x271),_0x16c8bd),_0x16c8bd[_0x12c70f(0x282)]&&(console[_0x12c70f(0x22a)](_0x12c70f(0x156)+_0x5e1702+_0x12c70f(0x280)+_0x16c8bd['status']+'),\x20stopping\x20status\x20checks'),this[_0x12c70f(0x244)](_0x5e1702),await this[_0x12c70f(0x1bf)](_0x5e1702,_0x16c8bd[_0x12c70f(0x1a7)],_0x16c8bd));}catch(_0x5e5ddc){console[_0x12c70f(0x207)]('❌\x20Status\x20check\x20#'+_0x389893+_0x12c70f(0x283)+_0x5e1702+':',_0x5e5ddc);}},_0x389893*_0x1c84c3);_0x5dd95e[_0xd1fe6a(0x19f)](_0x469ad7);}this['statusCheckTimers'][_0xd1fe6a(0x189)](_0x5e1702,_0x5dd95e),console[_0xd1fe6a(0x22a)](_0xd1fe6a(0x262)+_0x3511a7+'\x20status\x20checks\x20for\x20payment\x20'+_0x5e1702);}[a51_0x46cbc9(0x244)](_0x2e0949){const _0x4400dc=a51_0x46cbc9,_0x31fa06=this[_0x4400dc(0x22d)][_0x4400dc(0x166)](_0x2e0949);_0x31fa06&&(console[_0x4400dc(0x22a)](_0x4400dc(0x295)+_0x31fa06['length']+'\x20status\x20timers\x20for\x20payment\x20'+_0x2e0949),_0x31fa06[_0x4400dc(0x19b)]((_0x2d723e,_0x8ccd8b)=>{clearTimeout(_0x2d723e);}),this[_0x4400dc(0x22d)][_0x4400dc(0x284)](_0x2e0949));}async[a51_0x46cbc9(0x1bf)](_0x565030,_0x438dd4,_0x27bfd5){const _0x11d046=a51_0x46cbc9;try{const _0x5e363f=(await Promise['resolve']()['then'](()=>__importStar(require(_0x11d046(0x147)))))[_0x11d046(0x278)],_0x5de499={'status':_0x438dd4[_0x11d046(0x154)](),'updatedAt':new Date(),'statusChangedBy':_0x11d046(0x183),'statusChangedAt':new Date()};_0x438dd4===_0x11d046(0x270)&&(_0x5de499['paidAt']=new Date()),_0x438dd4===_0x11d046(0x281)&&_0x27bfd5['description']&&(_0x5de499['failureMessage']=_0x27bfd5[_0x11d046(0x239)],console['log']('💾\x20Saving\x20failure\x20message:\x20'+_0x27bfd5['description'])),_0x27bfd5[_0x11d046(0x239)]&&(_0x5de499[_0x11d046(0x1bc)]=(_0x438dd4===_0x11d046(0x270)?_0x11d046(0x13a):_0x11d046(0x1b4))+':\x20'+_0x27bfd5['description']),await _0x5e363f['payment'][_0x11d046(0x140)]({'where':{'id':_0x565030},'data':_0x5de499}),console[_0x11d046(0x22a)](_0x11d046(0x156)+_0x565030+_0x11d046(0x1ed)+_0x438dd4),await this[_0x11d046(0x223)](_0x565030,_0x438dd4);}catch(_0x1893b9){console['error']('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x565030+':',_0x1893b9);}}async[a51_0x46cbc9(0x223)](_0x3105cf,_0x5b7b35){const _0x347d3e=a51_0x46cbc9;try{const _0x4596f5=(await Promise['resolve']()[_0x347d3e(0x215)](()=>__importStar(require(_0x347d3e(0x147)))))['default'],{telegramBotService:_0x19d5c3}=await Promise[_0x347d3e(0x20c)]()[_0x347d3e(0x215)](()=>__importStar(require(_0x347d3e(0x1ad)))),_0x3bac84=await _0x4596f5[_0x347d3e(0x226)][_0x347d3e(0x24b)]({'where':{'id':_0x3105cf},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x3bac84)return;const _0x4f60d0={'PAID':_0x347d3e(0x141),'FAILED':_0x347d3e(0x160)},_0x4513ec=_0x4f60d0[_0x5b7b35];_0x4513ec&&await _0x19d5c3['sendPaymentNotification'](_0x3bac84[_0x347d3e(0x1cb)],_0x3bac84,_0x4513ec),await this['sendShopWebhook'](_0x3bac84,_0x5b7b35);}catch(_0x22302b){console[_0x347d3e(0x207)](_0x347d3e(0x1c1),_0x22302b);}}async[a51_0x46cbc9(0x1b0)](_0x5325aa,_0x110c91){const _0x4d07e7=a51_0x46cbc9,_0x2afabe=Date[_0x4d07e7(0x17a)]();try{const _0x3f2230=_0x5325aa[_0x4d07e7(0x212)],_0x31124b=_0x3f2230[_0x4d07e7(0x1e6)];if(!_0x31124b?.[_0x4d07e7(0x148)]){console['log']('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x3f2230['id']);return;}const _0x4e785c=_0x110c91===_0x4d07e7(0x270)?_0x4d07e7(0x277):_0x4d07e7(0x233);let _0x1597d1=[];if(_0x31124b[_0x4d07e7(0x209)])try{_0x1597d1=Array[_0x4d07e7(0x185)](_0x31124b[_0x4d07e7(0x209)])?_0x31124b['webhookEvents']:JSON[_0x4d07e7(0x13b)](_0x31124b[_0x4d07e7(0x209)]);}catch(_0x24a198){console[_0x4d07e7(0x207)](_0x4d07e7(0x1e9),_0x24a198),_0x1597d1=[];}if(!_0x1597d1['includes'](_0x4e785c)){console[_0x4d07e7(0x22a)]('Webhook\x20event\x20'+_0x4e785c+_0x4d07e7(0x15e)+_0x3f2230['id']);return;}const _0x18fdca={'event':_0x4e785c,'payment':{'id':_0x5325aa['id'],'order_id':_0x5325aa['orderId'],'gateway_order_id':_0x5325aa[_0x4d07e7(0x18c)],'gateway':_0x4d07e7(0x155),'amount':_0x5325aa['amount'],'currency':_0x5325aa[_0x4d07e7(0x255)],'status':_0x110c91[_0x4d07e7(0x27a)](),'customer_email':_0x5325aa[_0x4d07e7(0x260)],'customer_name':_0x5325aa[_0x4d07e7(0x161)],'created_at':_0x5325aa[_0x4d07e7(0x28b)],'updated_at':new Date()}},_0x2f581c=await fetch(_0x31124b[_0x4d07e7(0x148)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x4d07e7(0x1ff)},'body':JSON[_0x4d07e7(0x213)](_0x18fdca)}),_0x1003a2=Date[_0x4d07e7(0x17a)]()-_0x2afabe;loggerService_1[_0x4d07e7(0x180)][_0x4d07e7(0x16f)](_0x5325aa['shopId'],_0x31124b[_0x4d07e7(0x148)],_0x4e785c,_0x2f581c[_0x4d07e7(0x1a7)],_0x1003a2,_0x18fdca),console['log']('MasterCard\x20webhook\x20sent\x20to\x20'+_0x31124b[_0x4d07e7(0x148)]+'\x20with\x20status\x20'+_0x2f581c[_0x4d07e7(0x1a7)]+'\x20('+_0x1003a2+'ms)');}catch(_0x1cb82d){console[_0x4d07e7(0x207)](_0x4d07e7(0x240),_0x1cb82d),loggerService_1[_0x4d07e7(0x180)][_0x4d07e7(0x1c4)](_0x5325aa['shopId'],_0x5325aa['shop']?.[_0x4d07e7(0x1e6)]?.[_0x4d07e7(0x148)]||_0x4d07e7(0x1a8),_0x4d07e7(0x1d0),_0x1cb82d,{});}}['maskCardNumber'](_0x2a0443){const _0x34d1d3=a51_0x46cbc9,_0x38199b=_0x2a0443[_0x34d1d3(0x162)](/[\s-]/g,'');if(_0x38199b['length']<0x4)return _0x34d1d3(0x251);return _0x34d1d3(0x17f)+_0x38199b[_0x34d1d3(0x286)](-0x4);}async[a51_0x46cbc9(0x171)](_0x387e9b,_0x48e3b3=a51_0x46cbc9(0x167)){const _0x1db4fe=a51_0x46cbc9;console[_0x1db4fe(0x22a)](_0x1db4fe(0x1e3),JSON[_0x1db4fe(0x213)](_0x387e9b,null,0x2));let _0x1b5ea2=_0x387e9b,_0x34f1e3=_0x48e3b3;_0x387e9b[_0x1db4fe(0x19a)]?(_0x34f1e3=_0x387e9b['card_type']['toUpperCase']()===_0x1db4fe(0x26d)?_0x1db4fe(0x26d):_0x1db4fe(0x167),console[_0x1db4fe(0x22a)](_0x1db4fe(0x289)+_0x34f1e3)):console[_0x1db4fe(0x22a)](_0x1db4fe(0x175)+_0x34f1e3);if(_0x387e9b[_0x1db4fe(0x146)]&&_0x387e9b[_0x1db4fe(0x1ec)]&&_0x387e9b[_0x1db4fe(0x18d)]){console[_0x1db4fe(0x22a)]('🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...');try{const _0x16a8c0=await this['decryptResponsePhp'](_0x387e9b[_0x1db4fe(0x146)],_0x387e9b[_0x1db4fe(0x1ec)],_0x34f1e3);_0x1b5ea2=JSON[_0x1db4fe(0x13b)](_0x16a8c0),console[_0x1db4fe(0x22a)]('✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP'),console[_0x1db4fe(0x22a)](_0x1db4fe(0x182),JSON[_0x1db4fe(0x213)](_0x1b5ea2,null,0x2));}catch(_0x5d4194){console['error']('❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:',_0x5d4194),console[_0x1db4fe(0x22a)](_0x1db4fe(0x200)),_0x1b5ea2=_0x387e9b;}}else console[_0x1db4fe(0x22a)](_0x1db4fe(0x1f6));let _0x382e5d='PENDING';if(_0x1b5ea2[_0x1db4fe(0x1a7)]===0x64&&_0x1b5ea2[_0x1db4fe(0x282)]===0x1)_0x382e5d='PAID';else{if(_0x1b5ea2[_0x1db4fe(0x282)]===0x0||!this[_0x1db4fe(0x1d4)](_0x1b5ea2[_0x1db4fe(0x1a7)]))_0x382e5d='PENDING';else _0x1b5ea2[_0x1db4fe(0x282)]===0x1||this[_0x1db4fe(0x1d4)](_0x1b5ea2[_0x1db4fe(0x1a7)])?_0x382e5d='FAILED':_0x382e5d=_0x1db4fe(0x18b);}let _0x5746f7='';if(_0x1b5ea2[_0x1db4fe(0x1da)])_0x5746f7=_0x1b5ea2[_0x1db4fe(0x1da)][_0x1db4fe(0x1fd)](),console['log'](_0x1db4fe(0x135)+_0x34f1e3+'\x20order_id\x20for\x20search:\x20'+_0x5746f7);else _0x1b5ea2[_0x1db4fe(0x1a6)]?(_0x5746f7=_0x1b5ea2[_0x1db4fe(0x1a6)]['toString'](),console[_0x1db4fe(0x22a)](_0x1db4fe(0x135)+_0x34f1e3+'\x20payment_id\x20for\x20search:\x20'+_0x5746f7)):(_0x5746f7=_0x1b5ea2[_0x1db4fe(0x16e)]||_0x1b5ea2[_0x1db4fe(0x14d)]||_0x1b5ea2['id']||'',console['log'](_0x1db4fe(0x224)+_0x5746f7));console[_0x1db4fe(0x22a)](_0x1db4fe(0x1c0)+_0x34f1e3+_0x1db4fe(0x23a)),console['log']('\x20\x20\x20Payment\x20ID:\x20'+_0x5746f7+'\x20(from:\x20order_id='+_0x1b5ea2[_0x1db4fe(0x1da)]+_0x1db4fe(0x25e)+_0x1b5ea2[_0x1db4fe(0x16e)]+',\x20payment_id='+_0x1b5ea2['payment_id']+_0x1db4fe(0x206)+_0x1b5ea2[_0x1db4fe(0x14d)]+_0x1db4fe(0x152)+_0x1b5ea2['id']+')'),console[_0x1db4fe(0x22a)](_0x1db4fe(0x211)+_0x382e5d+_0x1db4fe(0x16b)+_0x1b5ea2[_0x1db4fe(0x1a7)]+_0x1db4fe(0x13f)+_0x1b5ea2[_0x1db4fe(0x282)]+')'),console[_0x1db4fe(0x22a)](_0x1db4fe(0x1fc)+_0x1b5ea2[_0x1db4fe(0x214)]),console['log']('\x20\x20\x20Currency:\x20'+_0x1b5ea2[_0x1db4fe(0x255)]);let _0x1a1ca1;_0x382e5d==='FAILED'&&(_0x1a1ca1=this[_0x1db4fe(0x151)](_0x1b5ea2[_0x1db4fe(0x1a7)],_0x1b5ea2['desc']),console[_0x1db4fe(0x22a)](_0x1db4fe(0x290)+_0x1a1ca1));const _0x1457c0={'paymentId':_0x5746f7,'status':_0x382e5d,'amount':_0x1b5ea2['amount'],'currency':_0x1b5ea2[_0x1db4fe(0x255)]};return _0x1a1ca1&&(_0x1457c0[_0x1db4fe(0x25f)]=_0x1a1ca1),_0x1457c0;}[a51_0x46cbc9(0x197)](){const _0x3bcb57=a51_0x46cbc9;console['log'](_0x3bcb57(0x178));const _0xea3003=this[_0x3bcb57(0x22d)]['size'];for(const [_0x134882]of this[_0x3bcb57(0x22d)]){this[_0x3bcb57(0x244)](_0x134882);}console[_0x3bcb57(0x22a)]('🛑\x20Stopped\x20'+_0xea3003+_0x3bcb57(0x1de));}}exports[a51_0x46cbc9(0x132)]=VisaMasterCardService;