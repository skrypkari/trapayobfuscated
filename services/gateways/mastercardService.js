'use strict';function a42_0x39ab(){const _0x226bb5=['3ds_url','key','https://api2.trapay.uk/decrypt.php','1722965kJKWAy','RSA_PKCS1_PADDING','privateKeyPath','📝\x20Data\x20to\x20sign\x20length:','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','date_success','2744399GBqcWi','logShopWebhookError','📝\x20Signature\x20length:','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','final','stopAllStatusChecks','Response\x20Body:','set','Failed\x20to\x20send\x20MasterCard\x20webhook:','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','constants','****','logWhiteDomainResponse','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','readFileSync','currency','length','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','decryptResponsePhp','📝\x20Final\x20request\x20structure:','payment.failed','FAILED','unknown','then','124gfihHx','🔐\x20Private\x20key\x20path:','createCipheriv','📊\x20Status\x20check\x20#','keys','generateAESKey','now','-----BEGIN','updatePaymentStatus','cvv','Processing\x20MasterCard\x20webhook:','💾\x20Payment\x20data\x20prepared','text','shopId','sendShopWebhook','statusCheckTimers','❌\x20RSA\x20encryption\x20failed:','../telegramBotService','base64','get',',\x20Desc:\x20','__esModule','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','__setModuleDefault','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','\x20failed\x20for\x20payment\x20','TesSoft\x20Payment\x20System/1.0','from','Payment\x20ID:','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','194418ZEinkY','apiUrl','join','\x20is\x20final\x20(','4301vLoolb','prototype','logWhiteDomainRequest','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','/charge','existsSync','❌\x20PHP\x20decryptor\x20request\x20failed:','webhookUrl','\x20\x20\x20-\x20info\x20length:','order_id','first_name','trim','../../config/database','📝\x20Encrypted\x20key\x20length:','defineProperty','6xZYBrQ','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','webhook_send','../loggerService','⏰\x20Will\x20check\x20status\x20','✅\x20Status\x20response\x20decrypted\x20successfully','info','/status_raw','POST','isArray','parse','last_name','Final:','push','✅\x20Payment\x20','\x20characters','hasOwnProperty','size','publicEncrypt','❌\x20Data\x20being\x20signed:','aes-256-ctr','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','logShopWebhookSent','🔐\x20AES\x20key\x20length:','clearStatusTimers','\x20\x20\x20-\x20key\x20length:','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','1687744lVbBoT','maskCardNumber','loggerService','Order\x20ID:','1111','log','psp_public.pem','privateDecrypt','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','error','shop','includes','🔐\x20Public\x20key\x20length:\x20','Unknown\x20error','merchantPointId','https://api.paydmeth.com/api','update','payment_id','Status\x20decryption\x20failed:\x20','createDecipheriv','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','mastercard','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','charge','floor','🔐\x20RSA\x20signing\x20successful','message','Status:','toLowerCase','\x20result:','description','SHA256','json','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','default','Private\x20key\x20file\x20not\x20found:\x20','failed','slice','📊\x20Status\x20check\x20result:','settings','delete','-----END','private.pem','signRSA','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','****\x20****\x20****\x20','getOwnPropertyNames','147993nOQeTy','/status_decrypt','\x20\x20\x20-\x20method:\x20charge','utf8','🔐\x20Data\x20signed\x20with\x20RSA','392gsgvJw','🧹\x20Clearing\x20','🔐\x20Private\x20key\x20length:\x20','Error\x20parsing\x20webhook\x20events:','scheduleStatusChecks','MasterCard\x20webhook\x20sent\x20to\x20','sendPaymentNotifications','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','webhookEvents','call','🔍\x20MasterCard\x20status\x20check\x20#','\x20with\x20status\x20','createSign','encryptRSA','🔐\x20Data\x20encrypted\x20with\x20AES','🔐\x203DS\x20verification\x20required','HTTP\x20error!\x20status:\x20','encryptAES','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','customerName','\x20\x20\x20-\x20sign\x20length:','decryptResponse','application/json','system','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','stringify','expire_month','3DS\x20URL:','\x20status\x20checks\x20for\x20payment\x20','processCardPayment','replace','💳\x20MasterCard\x20service\x20initialized','🔐\x20AES\x20IV\x20length:','✅\x20Scheduled\x20','Error\x20details:','/charge_decrypted','Decryption\x20failed:\x20','95510pDfVVl','HTTP\x20','📝\x20Data\x20length:','checkPaymentStatus','\x20\x20\x20-\x20lang:\x20en','decryptAES',',\x20body:\x20','resolve','Card\x20Holder:','status','sendPaymentNotification','sign','✅\x20Payment\x20successful','PENDING','Amount:','),\x20stopping\x20status\x20checks','findUnique','processWebhook','Return\x20URL:','Result\x20URL:','crypto','PAID','configurable','publicKeyPath','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','🔐\x20AES\x20key\x20and\x20IV\x20generated','toUpperCase','__importStar','/status_decrypted','number','desc','\x20\x20\x20-\x20merchant_point_id:','MasterCard:\x20','logWhiteDomainError','expire_year','payment.success','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','ms)','Card\x20Number:','toString','426974SROhJi','PHP\x20decryptor\x20error','amount','MasterCardService','paidAt','randomBytes','Failed\x20to\x20send\x20payment\x20notifications:','HTTP\x20Status:','validateKeyFiles'];a42_0x39ab=function(){return _0x226bb5;};return a42_0x39ab();}const a42_0x13d110=a42_0x458b;(function(_0x207c08,_0x5072ef){const _0x46f47d=a42_0x458b,_0x4871bd=_0x207c08();while(!![]){try{const _0x509045=parseInt(_0x46f47d(0x1e4))/0x1+-parseInt(_0x46f47d(0x25b))/0x2+parseInt(_0x46f47d(0x28b))/0x3*(-parseInt(_0x46f47d(0x20e))/0x4)+parseInt(_0x46f47d(0x1f0))/0x5*(-parseInt(_0x46f47d(0x23f))/0x6)+parseInt(_0x46f47d(0x1f6))/0x7+-parseInt(_0x46f47d(0x290))/0x8*(parseInt(_0x46f47d(0x22c))/0x9)+parseInt(_0x46f47d(0x1bc))/0xa*(parseInt(_0x46f47d(0x230))/0xb);if(_0x509045===_0x5072ef)break;else _0x4871bd['push'](_0x4871bd['shift']());}catch(_0xc39013){_0x4871bd['push'](_0x4871bd['shift']());}}}(a42_0x39ab,0xbdc20));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x570325,_0xe11838,_0x2a5c19,_0x495db3){const _0x2b5fd5=a42_0x458b;if(_0x495db3===undefined)_0x495db3=_0x2a5c19;var _0x4053e7=Object['getOwnPropertyDescriptor'](_0xe11838,_0x2a5c19);(!_0x4053e7||(_0x2b5fd5(0x221)in _0x4053e7?!_0xe11838[_0x2b5fd5(0x223)]:_0x4053e7['writable']||_0x4053e7[_0x2b5fd5(0x1d2)]))&&(_0x4053e7={'enumerable':!![],'get':function(){return _0xe11838[_0x2a5c19];}}),Object[_0x2b5fd5(0x23e)](_0x570325,_0x495db3,_0x4053e7);}:function(_0x289f6f,_0x46a44c,_0x473c76,_0x5276c3){if(_0x5276c3===undefined)_0x5276c3=_0x473c76;_0x289f6f[_0x5276c3]=_0x46a44c[_0x473c76];}),__setModuleDefault=this&&this[a42_0x13d110(0x225)]||(Object['create']?function(_0x2ba8ad,_0x5e3cd0){const _0x5ed2bb=a42_0x13d110;Object[_0x5ed2bb(0x23e)](_0x2ba8ad,_0x5ed2bb(0x27e),{'enumerable':!![],'value':_0x5e3cd0});}:function(_0x36b569,_0x2e2f79){const _0x4992ec=a42_0x13d110;_0x36b569[_0x4992ec(0x27e)]=_0x2e2f79;}),__importStar=this&&this[a42_0x13d110(0x1d7)]||(function(){var _0x2e2385=function(_0x1627dd){const _0x1804a1=a42_0x458b;return _0x2e2385=Object[_0x1804a1(0x28a)]||function(_0x4b5592){const _0xbb131b=_0x1804a1;var _0x34633d=[];for(var _0x213d3b in _0x4b5592)if(Object[_0xbb131b(0x231)][_0xbb131b(0x250)][_0xbb131b(0x299)](_0x4b5592,_0x213d3b))_0x34633d[_0x34633d[_0xbb131b(0x206)]]=_0x213d3b;return _0x34633d;},_0x2e2385(_0x1627dd);};return function(_0x26f40b){const _0x25b093=a42_0x458b;if(_0x26f40b&&_0x26f40b[_0x25b093(0x223)])return _0x26f40b;var _0x1ba63c={};if(_0x26f40b!=null){for(var _0x1ff1d7=_0x2e2385(_0x26f40b),_0x3517a2=0x0;_0x3517a2<_0x1ff1d7[_0x25b093(0x206)];_0x3517a2++)if(_0x1ff1d7[_0x3517a2]!==_0x25b093(0x27e))__createBinding(_0x1ba63c,_0x26f40b,_0x1ff1d7[_0x3517a2]);}return __setModuleDefault(_0x1ba63c,_0x26f40b),_0x1ba63c;};}()),__importDefault=this&&this['__importDefault']||function(_0xd8e893){const _0x3feaae=a42_0x13d110;return _0xd8e893&&_0xd8e893[_0x3feaae(0x223)]?_0xd8e893:{'default':_0xd8e893};};function a42_0x458b(_0x1c6a28,_0x3484d8){const _0x39ab55=a42_0x39ab();return a42_0x458b=function(_0x458b67,_0x5dcc13){_0x458b67=_0x458b67-0x1a8;let _0xa49c3=_0x39ab55[_0x458b67];return _0xa49c3;},a42_0x458b(_0x1c6a28,_0x3484d8);}Object[a42_0x13d110(0x23e)](exports,a42_0x13d110(0x223),{'value':!![]}),exports[a42_0x13d110(0x1e7)]=void 0x0;const crypto_1=__importDefault(require(a42_0x13d110(0x1d0))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a42_0x13d110(0x243));class MasterCardService{constructor(){const _0xe2d5fa=a42_0x13d110;this[_0xe2d5fa(0x21d)]=new Map(),this[_0xe2d5fa(0x22d)]=_0xe2d5fa(0x26a),this['merchantPointId']=0x67c,this[_0xe2d5fa(0x1f2)]=path_1[_0xe2d5fa(0x27e)][_0xe2d5fa(0x22e)](process['cwd'](),_0xe2d5fa(0x212),_0xe2d5fa(0x286)),this[_0xe2d5fa(0x1d3)]=path_1[_0xe2d5fa(0x27e)][_0xe2d5fa(0x22e)](process['cwd'](),_0xe2d5fa(0x212),_0xe2d5fa(0x261)),console[_0xe2d5fa(0x260)](_0xe2d5fa(0x1b6)),console['log'](_0xe2d5fa(0x20f),this[_0xe2d5fa(0x1f2)]),console[_0xe2d5fa(0x260)]('🔐\x20Public\x20key\x20path:',this[_0xe2d5fa(0x1d3)]),this[_0xe2d5fa(0x1ec)]();}[a42_0x13d110(0x1ec)](){const _0x1147fe=a42_0x13d110;try{if(!fs_1['default'][_0x1147fe(0x235)](this[_0x1147fe(0x1f2)]))throw new Error(_0x1147fe(0x27f)+this[_0x1147fe(0x1f2)]);if(!fs_1[_0x1147fe(0x27e)][_0x1147fe(0x235)](this['publicKeyPath']))throw new Error('Public\x20key\x20file\x20not\x20found:\x20'+this[_0x1147fe(0x1d3)]);const _0x5c2ae1=fs_1['default'][_0x1147fe(0x204)](this[_0x1147fe(0x1f2)],'utf8')['trim'](),_0x3da80a=fs_1[_0x1147fe(0x27e)]['readFileSync'](this[_0x1147fe(0x1d3)],_0x1147fe(0x28e))['trim']();if(!_0x5c2ae1['includes'](_0x1147fe(0x215))||!_0x5c2ae1[_0x1147fe(0x266)](_0x1147fe(0x285)))throw new Error(_0x1147fe(0x1ae));if(!_0x3da80a[_0x1147fe(0x266)]('-----BEGIN')||!_0x3da80a[_0x1147fe(0x266)](_0x1147fe(0x285)))throw new Error('Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console['log'](_0x1147fe(0x1af)),console[_0x1147fe(0x260)](_0x1147fe(0x292)+_0x5c2ae1[_0x1147fe(0x206)]+_0x1147fe(0x24f)),console[_0x1147fe(0x260)](_0x1147fe(0x267)+_0x3da80a[_0x1147fe(0x206)]+_0x1147fe(0x24f));}catch(_0x3bc5e4){console['error']('❌\x20MasterCard\x20key\x20validation\x20failed:',_0x3bc5e4);throw _0x3bc5e4;}}['generateAESKey'](){const _0x5d55cf=a42_0x13d110,_0x32e812=crypto_1[_0x5d55cf(0x27e)][_0x5d55cf(0x1e9)](0x20),_0x5d0b87=crypto_1[_0x5d55cf(0x27e)][_0x5d55cf(0x1e9)](0x10);return{'key':_0x32e812,'iv':_0x5d0b87};}['encryptAES'](_0x5dbe4b,_0x239357,_0x572308){const _0x2b56c5=a42_0x13d110,_0x31da57=crypto_1[_0x2b56c5(0x27e)][_0x2b56c5(0x210)](_0x2b56c5(0x254),_0x239357,_0x572308);let _0x795255=_0x31da57[_0x2b56c5(0x26b)](_0x5dbe4b,_0x2b56c5(0x28e),_0x2b56c5(0x220));return _0x795255+=_0x31da57['final'](_0x2b56c5(0x220)),_0x795255;}['encryptRSA'](_0x104a18,_0x46c6eb){const _0x1cb6a4=a42_0x13d110;try{const _0x19dcb1=fs_1[_0x1cb6a4(0x27e)][_0x1cb6a4(0x204)](this[_0x1cb6a4(0x1d3)],_0x1cb6a4(0x28e))[_0x1cb6a4(0x23b)](),_0x4cdf48={'iv':_0x46c6eb['toString'](_0x1cb6a4(0x220)),'key':_0x104a18[_0x1cb6a4(0x1e3)](_0x1cb6a4(0x220))},_0x2b34e8=JSON[_0x1cb6a4(0x1b0)](_0x4cdf48);console[_0x1cb6a4(0x260)](_0x1cb6a4(0x203),_0x2b34e8['length']);const _0x112724=crypto_1[_0x1cb6a4(0x27e)][_0x1cb6a4(0x252)]({'key':_0x19dcb1,'padding':crypto_1[_0x1cb6a4(0x27e)][_0x1cb6a4(0x200)][_0x1cb6a4(0x1f1)]},Buffer[_0x1cb6a4(0x229)](_0x2b34e8));return console[_0x1cb6a4(0x260)](_0x1cb6a4(0x263),_0x112724[_0x1cb6a4(0x206)]),_0x112724[_0x1cb6a4(0x1e3)](_0x1cb6a4(0x220));}catch(_0x39b8ec){console[_0x1cb6a4(0x264)](_0x1cb6a4(0x21e),_0x39b8ec);throw new Error(_0x1cb6a4(0x297));}}[a42_0x13d110(0x287)](_0x21700f){const _0x57600b=a42_0x13d110;try{const _0x11b39e=fs_1[_0x57600b(0x27e)]['readFileSync'](this[_0x57600b(0x1f2)],_0x57600b(0x28e))[_0x57600b(0x23b)](),_0x4a45b5=crypto_1[_0x57600b(0x27e)][_0x57600b(0x29c)](_0x57600b(0x27a));_0x4a45b5[_0x57600b(0x26b)](_0x21700f),_0x4a45b5['end']();const _0x492933=_0x4a45b5[_0x57600b(0x1c7)](_0x11b39e,'base64');return console[_0x57600b(0x260)](_0x57600b(0x274)),console['log'](_0x57600b(0x1f3),_0x21700f['length']),console['log'](_0x57600b(0x1f8),_0x492933[_0x57600b(0x206)]),_0x492933;}catch(_0x22bdb3){console['error']('❌\x20RSA\x20signing\x20failed:',_0x22bdb3),console[_0x57600b(0x264)](_0x57600b(0x253),_0x21700f['substring'](0x0,0xc8)+'...');throw new Error(_0x57600b(0x1a8));}}[a42_0x13d110(0x1c1)](_0x320e5a,_0x1c8ce6,_0xf4731){const _0x57df63=a42_0x13d110,_0x3181ae=crypto_1[_0x57df63(0x27e)][_0x57df63(0x26e)]('aes-256-ctr',_0x1c8ce6,_0xf4731);let _0xc6f4fb=_0x3181ae['update'](_0x320e5a,'base64',_0x57df63(0x28e));return _0xc6f4fb+=_0x3181ae[_0x57df63(0x1fa)](_0x57df63(0x28e)),_0xc6f4fb;}async[a42_0x13d110(0x208)](_0x55ffa0,_0x5d9a34){const _0x1ed388=a42_0x13d110;try{const _0x32a2c2=await fetch(_0x1ed388(0x1ef),{'method':_0x1ed388(0x248),'headers':{'Content-Type':_0x1ed388(0x1ac)},'body':JSON['stringify']({'info':_0x55ffa0,'key':_0x5d9a34})});if(!_0x32a2c2['ok'])throw new Error(_0x1ed388(0x1e5));return await _0x32a2c2['text']();}catch(_0x1c08a7){console['error'](_0x1ed388(0x236),_0x1c08a7);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}['decryptResponse'](_0x29e0c2,_0x28d14a){const _0x5e45c6=a42_0x13d110;try{const _0x299c8b=fs_1[_0x5e45c6(0x27e)][_0x5e45c6(0x204)](this['privateKeyPath'],'utf8')[_0x5e45c6(0x23b)](),_0xcd3e7f=crypto_1[_0x5e45c6(0x27e)][_0x5e45c6(0x262)](_0x299c8b,Buffer[_0x5e45c6(0x229)](_0x28d14a,_0x5e45c6(0x220))),_0x406d6f=JSON[_0x5e45c6(0x24a)](_0xcd3e7f[_0x5e45c6(0x1e3)]()),_0x1ba146=Buffer[_0x5e45c6(0x229)](_0x406d6f['key'],_0x5e45c6(0x220)),_0x196ea4=Buffer[_0x5e45c6(0x229)](_0x406d6f['iv'],_0x5e45c6(0x220));return this[_0x5e45c6(0x1c1)](_0x29e0c2,_0x1ba146,_0x196ea4);}catch(_0x3cc1b2){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a42_0x13d110(0x1b4)](_0x5eef9c){const _0x3ff97a=a42_0x13d110,{paymentId:_0x273376,orderId:_0x38e6fd,amount:_0x44be80,currency:_0x5cd4a5,cardData:_0x318002,resultUrl:_0xd89834,returnUrl:_0x489167,cardHolder:_0x3795c7,browser:_0x29a75f}=_0x5eef9c;console['log']('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console['log'](_0x3ff97a(0x22a),_0x273376),console[_0x3ff97a(0x260)](_0x3ff97a(0x25e),_0x38e6fd),console[_0x3ff97a(0x260)](_0x3ff97a(0x1ca),_0x44be80,_0x5cd4a5),console[_0x3ff97a(0x260)](_0x3ff97a(0x1e2),this[_0x3ff97a(0x25c)](_0x318002[_0x3ff97a(0x1d9)])),console[_0x3ff97a(0x260)](_0x3ff97a(0x1c4),_0x3795c7[_0x3ff97a(0x23a)]+'\x20'+_0x3795c7[_0x3ff97a(0x24b)]),console['log'](_0x3ff97a(0x1ce),_0x489167),console['log'](_0x3ff97a(0x1cf),_0xd89834);const _0x7a9092={'amount':_0x44be80,'currency':_0x5cd4a5[_0x3ff97a(0x1d6)](),'order_id':_0x38e6fd,'result_url':_0xd89834,'return_url':_0x489167,'card':{'number':_0x318002['number'],'expire_month':_0x318002[_0x3ff97a(0x1b1)],'expire_year':_0x318002[_0x3ff97a(0x1de)],'cvv':_0x318002[_0x3ff97a(0x217)]},'card_holder':_0x3795c7,'browser':_0x29a75f},_0x2da053=JSON[_0x3ff97a(0x1b0)](_0x7a9092);console[_0x3ff97a(0x260)](_0x3ff97a(0x219)),console['log'](_0x3ff97a(0x233)),console[_0x3ff97a(0x260)](_0x2da053),console[_0x3ff97a(0x260)](_0x3ff97a(0x1be),_0x2da053['length']);try{const {key:_0x3f78fe,iv:_0xbc93c2}=this[_0x3ff97a(0x213)]();console[_0x3ff97a(0x260)](_0x3ff97a(0x1d5)),console['log'](_0x3ff97a(0x257),_0x3f78fe['length']),console[_0x3ff97a(0x260)](_0x3ff97a(0x1b7),_0xbc93c2[_0x3ff97a(0x206)]);const _0x17b270=this[_0x3ff97a(0x2a1)](_0x2da053,_0x3f78fe,_0xbc93c2);console['log'](_0x3ff97a(0x29e)),console[_0x3ff97a(0x260)]('📝\x20Encrypted\x20data\x20length:',_0x17b270['length']);const _0x184348=this[_0x3ff97a(0x29d)](_0x3f78fe,_0xbc93c2);console[_0x3ff97a(0x260)](_0x3ff97a(0x255)),console[_0x3ff97a(0x260)](_0x3ff97a(0x23d),_0x184348[_0x3ff97a(0x206)]);const _0x4a9cc3=this['signRSA'](_0x2da053);console[_0x3ff97a(0x260)](_0x3ff97a(0x28f)),console['log'](_0x3ff97a(0x1f8),_0x4a9cc3[_0x3ff97a(0x206)]);const _0x27d80b={'merchant_point_id':this[_0x3ff97a(0x269)],'method':_0x3ff97a(0x272),'info':_0x17b270,'key':_0x184348,'sign':_0x4a9cc3,'lang':'en'};console[_0x3ff97a(0x260)]('📤\x20Sending\x20request\x20to\x20MasterCard\x20API...'),console['log'](_0x3ff97a(0x209)),console['log'](_0x3ff97a(0x1db),this[_0x3ff97a(0x269)]),console[_0x3ff97a(0x260)](_0x3ff97a(0x28d)),console[_0x3ff97a(0x260)](_0x3ff97a(0x238),_0x17b270[_0x3ff97a(0x206)]),console[_0x3ff97a(0x260)](_0x3ff97a(0x259),_0x184348['length']),console[_0x3ff97a(0x260)](_0x3ff97a(0x1aa),_0x4a9cc3['length']),console[_0x3ff97a(0x260)](_0x3ff97a(0x1c0)),loggerService_1[_0x3ff97a(0x25d)][_0x3ff97a(0x232)](_0x3ff97a(0x270),_0x3ff97a(0x234),'POST',{'merchant_point_id':this['merchantPointId'],'method':_0x3ff97a(0x272),'lang':'en'});const _0x3d9cef=Date[_0x3ff97a(0x214)](),_0x3b9e87=await fetch(this[_0x3ff97a(0x22d)],{'method':'POST','headers':{'Content-Type':_0x3ff97a(0x1ac),'Accept':_0x3ff97a(0x1ac),'User-Agent':_0x3ff97a(0x228)},'body':JSON[_0x3ff97a(0x1b0)](_0x27d80b)}),_0x36885f=Date[_0x3ff97a(0x214)]()-_0x3d9cef;console[_0x3ff97a(0x260)](_0x3ff97a(0x288)),console[_0x3ff97a(0x260)](_0x3ff97a(0x276),_0x3b9e87[_0x3ff97a(0x1c5)]),console[_0x3ff97a(0x260)]('Response\x20Time:',_0x36885f+'ms');if(!_0x3b9e87['ok']){const _0x2855fc=await _0x3b9e87['text']();console['error'](_0x3ff97a(0x1eb),_0x3b9e87[_0x3ff97a(0x1c5)]),console[_0x3ff97a(0x264)](_0x3ff97a(0x1fc),_0x2855fc),loggerService_1[_0x3ff97a(0x25d)][_0x3ff97a(0x202)](_0x3ff97a(0x270),'/charge_raw',_0x3b9e87[_0x3ff97a(0x1c5)],_0x2855fc,_0x36885f),loggerService_1[_0x3ff97a(0x25d)][_0x3ff97a(0x1dd)](_0x3ff97a(0x270),_0x3ff97a(0x234),_0x3ff97a(0x1bd)+_0x3b9e87[_0x3ff97a(0x1c5)]+':\x20'+_0x2855fc);throw new Error(_0x3ff97a(0x2a0)+_0x3b9e87[_0x3ff97a(0x1c5)]+_0x3ff97a(0x1c2)+_0x2855fc);}const _0x2d77ee=await _0x3b9e87[_0x3ff97a(0x27b)]();loggerService_1[_0x3ff97a(0x25d)][_0x3ff97a(0x202)](_0x3ff97a(0x270),'/charge_raw',_0x3b9e87[_0x3ff97a(0x1c5)],_0x2d77ee,_0x36885f),console[_0x3ff97a(0x260)](_0x3ff97a(0x207));let _0x46e57c=_0x2d77ee;if(_0x2d77ee[_0x3ff97a(0x246)]&&_0x2d77ee[_0x3ff97a(0x1ee)]&&_0x2d77ee['sign']){console[_0x3ff97a(0x260)]('🔐\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x4fbcfe=await this[_0x3ff97a(0x208)](_0x2d77ee[_0x3ff97a(0x246)],_0x2d77ee[_0x3ff97a(0x1ee)]);_0x46e57c=JSON[_0x3ff97a(0x24a)](_0x4fbcfe),console['log'](_0x3ff97a(0x240)),loggerService_1[_0x3ff97a(0x25d)][_0x3ff97a(0x202)]('mastercard',_0x3ff97a(0x1ba),_0x3b9e87[_0x3ff97a(0x1c5)],_0x46e57c,_0x36885f),console[_0x3ff97a(0x260)](_0x3ff97a(0x25a));}catch(_0x54ddd1){console[_0x3ff97a(0x264)]('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x54ddd1),loggerService_1[_0x3ff97a(0x25d)]['logWhiteDomainError'](_0x3ff97a(0x270),'/charge_decrypt',_0x3ff97a(0x1bb)+_0x54ddd1),_0x46e57c=_0x2d77ee;}}else loggerService_1[_0x3ff97a(0x25d)][_0x3ff97a(0x202)]('mastercard','/charge_decrypted',_0x3b9e87['status'],_0x46e57c,_0x36885f),console[_0x3ff97a(0x260)](_0x3ff97a(0x1f4));console[_0x3ff97a(0x260)]('Status:',_0x46e57c[_0x3ff97a(0x1c5)]),console[_0x3ff97a(0x260)](_0x3ff97a(0x24c),_0x46e57c[_0x3ff97a(0x1fa)]),console['log'](_0x3ff97a(0x22a),_0x46e57c[_0x3ff97a(0x26c)]),console[_0x3ff97a(0x260)](_0x3ff97a(0x1b2),_0x46e57c[_0x3ff97a(0x1ed)]||'none');if(_0x46e57c[_0x3ff97a(0x1c5)]===0x64&&_0x46e57c[_0x3ff97a(0x1fa)]===0x1)return console['log'](_0x3ff97a(0x1c8)),{'gateway_payment_id':_0x46e57c[_0x3ff97a(0x26c)]?.[_0x3ff97a(0x1e3)](),'payment_url':_0x489167,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x46e57c[_0x3ff97a(0x1ed)])return console['log'](_0x3ff97a(0x29f)),this[_0x3ff97a(0x294)](_0x273376,_0x38e6fd,_0x46e57c[_0x3ff97a(0x26c)]?.[_0x3ff97a(0x1e3)]()||_0x38e6fd),{'gateway_payment_id':_0x46e57c[_0x3ff97a(0x26c)]?.[_0x3ff97a(0x1e3)](),'payment_url':_0x46e57c['3ds_url'],'requires_3ds':!![],'threeds_url':_0x46e57c['3ds_url'],'status':'PENDING','final':![]};let _0xbb3aa8=_0x46e57c[_0x3ff97a(0x1da)]||_0x46e57c[_0x3ff97a(0x275)]||_0x3ff97a(0x268),_0x14a539=_0x46e57c[_0x3ff97a(0x1c5)],_0x419301=_0x46e57c[_0x3ff97a(0x1fa)];return console[_0x3ff97a(0x260)]('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x14a539+',\x20Final:\x20'+_0x419301+_0x3ff97a(0x222)+_0xbb3aa8),{'gateway_payment_id':_0x46e57c[_0x3ff97a(0x26c)]?.[_0x3ff97a(0x1e3)](),'payment_url':_0x489167,'requires_3ds':![],'status':'FAILED','final':!![]};}catch(_0x412d86){console[_0x3ff97a(0x264)](_0x3ff97a(0x1ff)),console[_0x3ff97a(0x264)](_0x3ff97a(0x1b9),_0x412d86),loggerService_1[_0x3ff97a(0x25d)]['logWhiteDomainError']('mastercard',_0x3ff97a(0x234),_0x412d86);throw new Error('Failed\x20to\x20process\x20MasterCard\x20payment:\x20'+(_0x412d86 instanceof Error?_0x412d86[_0x3ff97a(0x275)]:_0x3ff97a(0x268)));}}async[a42_0x13d110(0x1bf)](_0x263944,_0x1025b1){const _0x50b18=a42_0x13d110;console[_0x50b18(0x260)](_0x50b18(0x1f9)+_0x263944+'\x20('+_0x1025b1+')');try{const _0x1bc638={'payment_id':_0x263944,'order_id':_0x1025b1},_0x13f81a=JSON[_0x50b18(0x1b0)](_0x1bc638),{key:_0xfa8bfc,iv:_0x5495eb}=this[_0x50b18(0x213)](),_0x29d1c1=this['encryptAES'](_0x13f81a,_0xfa8bfc,_0x5495eb),_0x4374b6=this[_0x50b18(0x29d)](_0xfa8bfc,_0x5495eb),_0xd14bf1=this[_0x50b18(0x287)](_0x13f81a),_0x57696c={'merchant_point_id':this[_0x50b18(0x269)],'method':_0x50b18(0x1c5),'info':_0x29d1c1,'key':_0x4374b6,'sign':_0xd14bf1,'lang':'en'};loggerService_1[_0x50b18(0x25d)]['logWhiteDomainRequest'](_0x50b18(0x270),'/status',_0x50b18(0x248),{'merchant_point_id':this[_0x50b18(0x269)],'method':_0x50b18(0x1c5),'lang':'en'});const _0x6aedaf=Date[_0x50b18(0x214)](),_0x411061=await fetch(this['apiUrl'],{'method':_0x50b18(0x248),'headers':{'Content-Type':'application/json','Accept':_0x50b18(0x1ac),'User-Agent':_0x50b18(0x228)},'body':JSON[_0x50b18(0x1b0)](_0x57696c)}),_0x4749bd=Date[_0x50b18(0x214)]()-_0x6aedaf;if(!_0x411061['ok']){const _0x4e87da=await _0x411061[_0x50b18(0x21a)]();loggerService_1[_0x50b18(0x25d)][_0x50b18(0x202)](_0x50b18(0x270),_0x50b18(0x247),_0x411061[_0x50b18(0x1c5)],_0x4e87da,_0x4749bd);throw new Error(_0x50b18(0x2a0)+_0x411061['status']);}const _0x3ab967=await _0x411061['json']();loggerService_1[_0x50b18(0x25d)]['logWhiteDomainResponse'](_0x50b18(0x270),_0x50b18(0x247),_0x411061[_0x50b18(0x1c5)],_0x3ab967,_0x4749bd);let _0x1431ce=_0x3ab967;if(_0x3ab967[_0x50b18(0x246)]&&_0x3ab967[_0x50b18(0x1ee)]&&_0x3ab967['sign']){console[_0x50b18(0x260)](_0x50b18(0x1e0));try{const _0xfa2bd5=this[_0x50b18(0x1ab)](_0x3ab967[_0x50b18(0x246)],_0x3ab967['key']);_0x1431ce=JSON[_0x50b18(0x24a)](_0xfa2bd5),console[_0x50b18(0x260)](_0x50b18(0x245)),loggerService_1[_0x50b18(0x25d)][_0x50b18(0x202)](_0x50b18(0x270),_0x50b18(0x1d8),_0x411061[_0x50b18(0x1c5)],_0x1431ce,_0x4749bd),console[_0x50b18(0x260)](_0x50b18(0x26f));}catch(_0x174f76){console[_0x50b18(0x264)](_0x50b18(0x27c),_0x174f76),loggerService_1['loggerService']['logWhiteDomainError'](_0x50b18(0x270),_0x50b18(0x28c),_0x50b18(0x26d)+_0x174f76),_0x1431ce=_0x3ab967;}}else loggerService_1[_0x50b18(0x25d)][_0x50b18(0x202)](_0x50b18(0x270),'/status_decrypted',_0x411061[_0x50b18(0x1c5)],_0x1431ce,_0x4749bd),console['log']('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x50b18(0x260)](_0x50b18(0x282),{'status':_0x1431ce[_0x50b18(0x1c5)],'final':_0x1431ce[_0x50b18(0x1fa)],'payment_id':_0x1431ce[_0x50b18(0x26c)],'desc':_0x1431ce['desc']});let _0x28505b=_0x50b18(0x1c9);if(_0x1431ce[_0x50b18(0x1c5)]===0x1&&_0x1431ce[_0x50b18(0x1fa)]===0x1)_0x28505b=_0x50b18(0x1d1);else _0x1431ce[_0x50b18(0x1c5)]===0x0&&_0x1431ce[_0x50b18(0x1fa)]===0x0?_0x28505b=_0x50b18(0x1c9):_0x28505b=_0x50b18(0x20b);return{'status':_0x28505b,'final':_0x1431ce['final']===0x1,'amount':_0x1431ce[_0x50b18(0x1e6)],'currency':_0x1431ce[_0x50b18(0x205)],'date_success':_0x1431ce[_0x50b18(0x1f5)],'description':_0x1431ce[_0x50b18(0x1da)]};}catch(_0x5c43a2){console[_0x50b18(0x264)]('MasterCard\x20status\x20check\x20error:',_0x5c43a2),loggerService_1[_0x50b18(0x25d)][_0x50b18(0x1dd)]('mastercard','/status',_0x5c43a2);throw new Error(_0x50b18(0x224)+(_0x5c43a2 instanceof Error?_0x5c43a2[_0x50b18(0x275)]:'Unknown\x20error'));}}['scheduleStatusChecks'](_0x1aa84a,_0x5ca59b,_0x57be4b){const _0x5ca0ad=a42_0x13d110;console[_0x5ca0ad(0x260)](_0x5ca0ad(0x226)+_0x1aa84a+'\x20('+_0x57be4b+')'),this[_0x5ca0ad(0x258)](_0x1aa84a);const _0x5aeed8=[],_0x1e1589=0x5*0x3c*0x3e8,_0x1bfb64=0x2*0x3c*0x3c*0x3e8,_0xe181df=Math[_0x5ca0ad(0x273)](_0x1bfb64/_0x1e1589);console['log'](_0x5ca0ad(0x244)+_0xe181df+_0x5ca0ad(0x22b));for(let _0x17dbda=0x1;_0x17dbda<=_0xe181df;_0x17dbda++){const _0x22c03a=setTimeout(async()=>{const _0x575900=_0x5ca0ad;console['log'](_0x575900(0x29a)+_0x17dbda+'/'+_0xe181df+'\x20for\x20payment\x20'+_0x1aa84a);try{const _0x35f846=await this[_0x575900(0x1bf)](_0x57be4b,_0x5ca59b);console[_0x575900(0x260)](_0x575900(0x211)+_0x17dbda+_0x575900(0x278),_0x35f846),_0x35f846[_0x575900(0x1fa)]&&(console[_0x575900(0x260)](_0x575900(0x24e)+_0x1aa84a+_0x575900(0x22f)+_0x35f846['status']+_0x575900(0x1cb)),this[_0x575900(0x258)](_0x1aa84a),await this[_0x575900(0x216)](_0x1aa84a,_0x35f846[_0x575900(0x1c5)],_0x35f846));}catch(_0x285a0d){console[_0x575900(0x264)]('❌\x20Status\x20check\x20#'+_0x17dbda+_0x575900(0x227)+_0x1aa84a+':',_0x285a0d);}},_0x17dbda*_0x1e1589);_0x5aeed8[_0x5ca0ad(0x24d)](_0x22c03a);}this[_0x5ca0ad(0x21d)][_0x5ca0ad(0x1fd)](_0x1aa84a,_0x5aeed8),console[_0x5ca0ad(0x260)](_0x5ca0ad(0x1b8)+_0xe181df+_0x5ca0ad(0x1b3)+_0x1aa84a);}['clearStatusTimers'](_0x1d1cc7){const _0x39a368=a42_0x13d110,_0x16042e=this[_0x39a368(0x21d)][_0x39a368(0x221)](_0x1d1cc7);_0x16042e&&(console['log'](_0x39a368(0x291)+_0x16042e[_0x39a368(0x206)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x1d1cc7),_0x16042e['forEach']((_0x2aff2b,_0x2bb177)=>{clearTimeout(_0x2aff2b);}),this[_0x39a368(0x21d)][_0x39a368(0x284)](_0x1d1cc7));}async['updatePaymentStatus'](_0x36e3ae,_0x4c0c06,_0x43564a){const _0x59dc58=a42_0x13d110;try{const _0x199bc3=(await Promise[_0x59dc58(0x1c3)]()['then'](()=>__importStar(require(_0x59dc58(0x23c)))))['default'],_0xb4e525={'status':_0x4c0c06[_0x59dc58(0x1d6)](),'updatedAt':new Date(),'statusChangedBy':_0x59dc58(0x1ad),'statusChangedAt':new Date()};_0x4c0c06===_0x59dc58(0x1d1)&&(_0xb4e525[_0x59dc58(0x1e8)]=new Date()),_0x43564a[_0x59dc58(0x279)]&&(_0xb4e525['adminNotes']=_0x59dc58(0x1dc)+_0x43564a['description']),await _0x199bc3['payment'][_0x59dc58(0x26b)]({'where':{'id':_0x36e3ae},'data':_0xb4e525}),console[_0x59dc58(0x260)](_0x59dc58(0x24e)+_0x36e3ae+'\x20status\x20updated\x20to\x20'+_0x4c0c06),await this[_0x59dc58(0x296)](_0x36e3ae,_0x4c0c06);}catch(_0x1b5e36){console[_0x59dc58(0x264)](_0x59dc58(0x271)+_0x36e3ae+':',_0x1b5e36);}}async[a42_0x13d110(0x296)](_0x31b5dd,_0x3ed56a){const _0x5158b6=a42_0x13d110;try{const _0x296473=(await Promise[_0x5158b6(0x1c3)]()[_0x5158b6(0x20d)](()=>__importStar(require(_0x5158b6(0x23c)))))[_0x5158b6(0x27e)],{telegramBotService:_0x38fbdd}=await Promise[_0x5158b6(0x1c3)]()[_0x5158b6(0x20d)](()=>__importStar(require(_0x5158b6(0x21f)))),_0x4c66d8=await _0x296473['payment'][_0x5158b6(0x1cc)]({'where':{'id':_0x31b5dd},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x4c66d8)return;const _0x25780c={'PAID':'paid','FAILED':_0x5158b6(0x280)},_0x4486eb=_0x25780c[_0x3ed56a];_0x4486eb&&await _0x38fbdd[_0x5158b6(0x1c6)](_0x4c66d8[_0x5158b6(0x21b)],_0x4c66d8,_0x4486eb),await this[_0x5158b6(0x21c)](_0x4c66d8,_0x3ed56a);}catch(_0x1a097c){console[_0x5158b6(0x264)](_0x5158b6(0x1ea),_0x1a097c);}}async[a42_0x13d110(0x21c)](_0x4715ed,_0x1b4a90){const _0x37ea37=a42_0x13d110,_0x2428de=Date[_0x37ea37(0x214)]();try{const _0xbbf83b=_0x4715ed['shop'],_0x36f190=_0xbbf83b[_0x37ea37(0x283)];if(!_0x36f190?.[_0x37ea37(0x237)]){console[_0x37ea37(0x260)](_0x37ea37(0x241)+_0xbbf83b['id']);return;}const _0x5d29bf=_0x1b4a90===_0x37ea37(0x1d1)?_0x37ea37(0x1df):_0x37ea37(0x20a);let _0x1ddcb0=[];if(_0x36f190[_0x37ea37(0x298)])try{_0x1ddcb0=Array[_0x37ea37(0x249)](_0x36f190[_0x37ea37(0x298)])?_0x36f190[_0x37ea37(0x298)]:JSON[_0x37ea37(0x24a)](_0x36f190['webhookEvents']);}catch(_0x243d76){console[_0x37ea37(0x264)](_0x37ea37(0x293),_0x243d76),_0x1ddcb0=[];}if(!_0x1ddcb0[_0x37ea37(0x266)](_0x5d29bf)){console['log']('Webhook\x20event\x20'+_0x5d29bf+'\x20not\x20enabled\x20for\x20shop\x20'+_0xbbf83b['id']);return;}const _0x4f28d2={'event':_0x5d29bf,'payment':{'id':_0x4715ed['id'],'order_id':_0x4715ed['orderId'],'gateway_order_id':_0x4715ed['gatewayOrderId'],'gateway':_0x37ea37(0x25f),'amount':_0x4715ed[_0x37ea37(0x1e6)],'currency':_0x4715ed[_0x37ea37(0x205)],'status':_0x1b4a90[_0x37ea37(0x277)](),'customer_email':_0x4715ed['customerEmail'],'customer_name':_0x4715ed[_0x37ea37(0x1a9)],'created_at':_0x4715ed['createdAt'],'updated_at':new Date()}},_0x3750b8=await fetch(_0x36f190[_0x37ea37(0x237)],{'method':_0x37ea37(0x248),'headers':{'Content-Type':'application/json','User-Agent':_0x37ea37(0x1d4)},'body':JSON[_0x37ea37(0x1b0)](_0x4f28d2)}),_0x535a9c=Date[_0x37ea37(0x214)]()-_0x2428de;loggerService_1[_0x37ea37(0x25d)][_0x37ea37(0x256)](_0x4715ed['shopId'],_0x36f190[_0x37ea37(0x237)],_0x5d29bf,_0x3750b8[_0x37ea37(0x1c5)],_0x535a9c,_0x4f28d2),console['log'](_0x37ea37(0x295)+_0x36f190[_0x37ea37(0x237)]+_0x37ea37(0x29b)+_0x3750b8[_0x37ea37(0x1c5)]+'\x20('+_0x535a9c+_0x37ea37(0x1e1));}catch(_0x48895f){console[_0x37ea37(0x264)](_0x37ea37(0x1fe),_0x48895f),loggerService_1[_0x37ea37(0x25d)][_0x37ea37(0x1f7)](_0x4715ed[_0x37ea37(0x21b)],_0x4715ed[_0x37ea37(0x265)]?.[_0x37ea37(0x283)]?.[_0x37ea37(0x237)]||_0x37ea37(0x20c),_0x37ea37(0x242),_0x48895f,{});}}[a42_0x13d110(0x25c)](_0x371d7c){const _0x2a52ac=a42_0x13d110,_0x31fd3b=_0x371d7c[_0x2a52ac(0x1b5)](/[\s-]/g,'');if(_0x31fd3b[_0x2a52ac(0x206)]<0x4)return _0x2a52ac(0x201);return _0x2a52ac(0x289)+_0x31fd3b[_0x2a52ac(0x281)](-0x4);}async[a42_0x13d110(0x1cd)](_0x58982b){const _0x3732f9=a42_0x13d110;console['log'](_0x3732f9(0x218),_0x58982b);let _0x22af70=_0x3732f9(0x1c9);if(_0x58982b[_0x3732f9(0x1c5)]===0x1&&_0x58982b[_0x3732f9(0x1fa)]===0x1)_0x22af70=_0x3732f9(0x1d1);else _0x58982b[_0x3732f9(0x1c5)]===0x0&&_0x58982b[_0x3732f9(0x1fa)]===0x0?_0x22af70=_0x3732f9(0x1c9):_0x22af70=_0x3732f9(0x20b);return{'paymentId':_0x58982b[_0x3732f9(0x239)]||'','status':_0x22af70,'amount':_0x58982b['amount'],'currency':_0x58982b[_0x3732f9(0x205)]};}[a42_0x13d110(0x1fb)](){const _0x870655=a42_0x13d110;console['log'](_0x870655(0x27d));const _0x3d119a=this[_0x870655(0x21d)][_0x870655(0x251)];for(const [_0x21fe14]of this['statusCheckTimers']){this[_0x870655(0x258)](_0x21fe14);}console[_0x870655(0x260)]('🛑\x20Stopped\x20'+_0x3d119a+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a42_0x13d110(0x1e7)]=MasterCardService;