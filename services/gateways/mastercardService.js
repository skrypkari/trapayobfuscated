'use strict';const a42_0x559554=a42_0x157f;(function(_0x208bf5,_0x2e01d6){const _0x34e7a5=a42_0x157f,_0x51129d=_0x208bf5();while(!![]){try{const _0x2a2116=parseInt(_0x34e7a5(0x173))/0x1+-parseInt(_0x34e7a5(0x13a))/0x2+-parseInt(_0x34e7a5(0x16a))/0x3*(-parseInt(_0x34e7a5(0xec))/0x4)+-parseInt(_0x34e7a5(0x15d))/0x5*(parseInt(_0x34e7a5(0x147))/0x6)+-parseInt(_0x34e7a5(0x12f))/0x7+parseInt(_0x34e7a5(0x19d))/0x8*(-parseInt(_0x34e7a5(0x198))/0x9)+parseInt(_0x34e7a5(0x1b8))/0xa;if(_0x2a2116===_0x2e01d6)break;else _0x51129d['push'](_0x51129d['shift']());}catch(_0x376e72){_0x51129d['push'](_0x51129d['shift']());}}}(a42_0x4b02,0x7488b));function a42_0x4b02(){const _0x72a561=['MasterCard\x20status\x20check\x20error:','sendPaymentNotification','validateKeyFiles','📝\x20Data\x20length:','/status','335IGcwer','❌\x20Status\x20check\x20#','application/json','Return\x20URL:','Status:','encryptAES','private.pem','parse','HTTP\x20error!\x20status:\x20','slice','logWhiteDomainRequest','statusCheckTimers','randomBytes','1205826LdQnar','failed','/charge','🔐\x20Public\x20key\x20length:\x20','date_success','),\x20stopping\x20status\x20checks','decryptResponse','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','✅\x20Status\x20response\x20decrypted\x20successfully','58369qEeQpu','POST','number','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','forEach','constants','🛑\x20Stopped\x20','cwd','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','Response\x20Body:','shopId','PAID','MasterCardService','generateAESKey','__setModuleDefault','📝\x20Encrypted\x20key\x20length:','sendPaymentNotifications','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','set','https://api2.trapay.uk/decrypt.php','paid','scheduleStatusChecks','Public\x20key\x20file\x20not\x20found:\x20','settings','currency','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','final','❌\x20RSA\x20signing\x20failed:','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','PENDING','📝\x20Signature\x20length:','SHA256','__importDefault','\x20not\x20enabled\x20for\x20shop\x20','join','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','__createBinding','34002iVrlfv',',\x20Desc:\x20','replace','🔐\x20AES\x20IV\x20length:','\x20with\x20status\x20','1088ewnyGh','payment.success','orderId','keys','aes-256-ctr','📊\x20Status\x20check\x20#','decryptResponsePhp','Response\x20Time:','findUnique','📝\x20Encrypted\x20data\x20length:','text','HTTP\x20','Payment\x20ID:','Processing\x20MasterCard\x20webhook:','loggerService','charge','HTTP\x20Status:','Card\x20Number:','encryptRSA','psp_public.pem','Private\x20key\x20file\x20not\x20found:\x20','PHP\x20decryptor\x20error','/charge_decrypt','\x20for\x20payment\x20','expire_year','-----END','🔍\x20MasterCard\x20status\x20check\x20#','18356260iaTgRh','paidAt','\x20status\x20timers\x20for\x20payment\x20','size','✅\x20Payment\x20','customerEmail','createCipheriv','existsSync','readFileSync','logWhiteDomainResponse','stringify','privateKeyPath','update','\x20result:','cvv','gatewayOrderId','🔐\x20Data\x20encrypted\x20with\x20AES','maskCardNumber','\x20MasterCard\x20status\x20check\x20timers','sendShopWebhook','payment.failed','trim','processWebhook','desc','apiUrl','expire_month','FAILED','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','\x20\x20\x20-\x20merchant_point_id:','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','🧹\x20Clearing\x20','message','payment_id','includes','publicKeyPath','prototype','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','first_name','\x20status\x20updated\x20to\x20','Order\x20ID:','🔐\x203DS\x20verification\x20required','RSA_PKCS1_PADDING','MasterCard:\x20','key','last_name','8MRXQgU','delete','logShopWebhookSent','/charge_decrypted','then','length','Error\x20parsing\x20webhook\x20events:','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','crypto','Amount:','../../config/database','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','utf8','\x20\x20\x20-\x20lang:\x20en','path','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','payment','🔐\x20Data\x20signed\x20with\x20RSA','updatePaymentStatus','✅\x20Scheduled\x20','****','stopAllStatusChecks','TesSoft\x20Payment\x20System/1.0','\x20\x20\x20-\x20key\x20length:','📝\x20Final\x20request\x20structure:','mastercard','processCardPayment','\x20\x20\x20-\x20sign\x20length:','info','\x20\x20\x20-\x20info\x20length:','🔐\x20Public\x20key\x20path:','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','privateDecrypt','sign','status','-----BEGIN','\x20failed\x20for\x20payment\x20','Decryption\x20failed:\x20','🔐\x20AES\x20key\x20length:','log','decryptAES','https://api.paydmeth.com/api','❌\x20MasterCard\x20key\x20validation\x20failed:','../loggerService','/status_decrypt','from','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','🔐\x20Private\x20key\x20path:','floor','MasterCard\x20webhook\x20sent\x20to\x20','create','amount','defineProperty','Card\x20Holder:','get','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','Status\x20decryption\x20failed:\x20','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','/charge_raw','shop','customerName','publicEncrypt','base64','\x20status\x20checks\x20for\x20payment\x20','6514214tTPhtL','now','💾\x20Payment\x20data\x20prepared','checkPaymentStatus','💳\x20MasterCard\x20service\x20initialized','push','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','webhookUrl','3DS\x20URL:','Failed\x20to\x20decrypt\x20response','getOwnPropertyDescriptor','392254emkzEf','ms)','Error\x20details:','3ds_url','merchantPointId','toString','default','Result\x20URL:','hasOwnProperty','🔐\x20RSA\x20signing\x20successful','system','toLowerCase','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','51942atdLif','\x20characters','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','webhookEvents','logWhiteDomainError','clearStatusTimers','Failed\x20to\x20send\x20MasterCard\x20webhook:','/status_decrypted','__esModule','error','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','signRSA','❌\x20Data\x20being\x20signed:','resolve','Unknown\x20error','createDecipheriv'];a42_0x4b02=function(){return _0x72a561;};return a42_0x4b02();}var __createBinding=this&&this[a42_0x559554(0x197)]||(Object[a42_0x559554(0x121)]?function(_0x17d6c5,_0x305c13,_0x3cbb10,_0x328937){const _0x5c0d2d=a42_0x559554;if(_0x328937===undefined)_0x328937=_0x3cbb10;var _0x1ac3b5=Object[_0x5c0d2d(0x139)](_0x305c13,_0x3cbb10);(!_0x1ac3b5||('get'in _0x1ac3b5?!_0x305c13['__esModule']:_0x1ac3b5['writable']||_0x1ac3b5['configurable']))&&(_0x1ac3b5={'enumerable':!![],'get':function(){return _0x305c13[_0x3cbb10];}}),Object[_0x5c0d2d(0x123)](_0x17d6c5,_0x328937,_0x1ac3b5);}:function(_0x8b5335,_0x486f3e,_0xf73a1a,_0x1349db){if(_0x1349db===undefined)_0x1349db=_0xf73a1a;_0x8b5335[_0x1349db]=_0x486f3e[_0xf73a1a];}),__setModuleDefault=this&&this[a42_0x559554(0x181)]||(Object[a42_0x559554(0x121)]?function(_0x54893b,_0x373c08){const _0x317b6f=a42_0x559554;Object['defineProperty'](_0x54893b,_0x317b6f(0x140),{'enumerable':!![],'value':_0x373c08});}:function(_0x4d0ec3,_0x54bf7a){const _0x25e8a8=a42_0x559554;_0x4d0ec3[_0x25e8a8(0x140)]=_0x54bf7a;}),__importStar=this&&this['__importStar']||(function(){var _0x481a86=function(_0x31859d){return _0x481a86=Object['getOwnPropertyNames']||function(_0x3fee38){const _0x1ae6f6=a42_0x157f;var _0x2e43de=[];for(var _0x4f7988 in _0x3fee38)if(Object[_0x1ae6f6(0x1db)][_0x1ae6f6(0x142)]['call'](_0x3fee38,_0x4f7988))_0x2e43de[_0x2e43de[_0x1ae6f6(0xf1)]]=_0x4f7988;return _0x2e43de;},_0x481a86(_0x31859d);};return function(_0x3c8816){const _0x4f5d0e=a42_0x157f;if(_0x3c8816&&_0x3c8816[_0x4f5d0e(0x150)])return _0x3c8816;var _0x1f848c={};if(_0x3c8816!=null){for(var _0x35acfd=_0x481a86(_0x3c8816),_0x3926e0=0x0;_0x3926e0<_0x35acfd[_0x4f5d0e(0xf1)];_0x3926e0++)if(_0x35acfd[_0x3926e0]!==_0x4f5d0e(0x140))__createBinding(_0x1f848c,_0x3c8816,_0x35acfd[_0x3926e0]);}return __setModuleDefault(_0x1f848c,_0x3c8816),_0x1f848c;};}()),__importDefault=this&&this[a42_0x559554(0x193)]||function(_0x10bada){return _0x10bada&&_0x10bada['__esModule']?_0x10bada:{'default':_0x10bada};};function a42_0x157f(_0x50e739,_0x49b893){const _0x4b020d=a42_0x4b02();return a42_0x157f=function(_0x157ff8,_0x3266a8){_0x157ff8=_0x157ff8-0xe4;let _0x17ad60=_0x4b020d[_0x157ff8];return _0x17ad60;},a42_0x157f(_0x50e739,_0x49b893);}Object[a42_0x559554(0x123)](exports,a42_0x559554(0x150),{'value':!![]}),exports['MasterCardService']=void 0x0;const crypto_1=__importDefault(require(a42_0x559554(0xf4))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x559554(0xfa))),loggerService_1=require(a42_0x559554(0x119));class MasterCardService{constructor(){const _0x58a04c=a42_0x559554;this[_0x58a04c(0x168)]=new Map(),this['apiUrl']=_0x58a04c(0x117),this[_0x58a04c(0x13e)]=0x67c,this[_0x58a04c(0x1c3)]=path_1[_0x58a04c(0x140)][_0x58a04c(0x195)](process['cwd'](),_0x58a04c(0x1a0),_0x58a04c(0x163)),this[_0x58a04c(0x1da)]=path_1[_0x58a04c(0x140)][_0x58a04c(0x195)](process[_0x58a04c(0x17a)](),_0x58a04c(0x1a0),_0x58a04c(0x1b0)),console[_0x58a04c(0x115)](_0x58a04c(0x133)),console[_0x58a04c(0x115)](_0x58a04c(0x11e),this[_0x58a04c(0x1c3)]),console[_0x58a04c(0x115)](_0x58a04c(0x10a),this[_0x58a04c(0x1da)]),this[_0x58a04c(0x15a)]();}[a42_0x559554(0x15a)](){const _0x4adeb9=a42_0x559554;try{if(!fs_1[_0x4adeb9(0x140)][_0x4adeb9(0x1bf)](this[_0x4adeb9(0x1c3)]))throw new Error(_0x4adeb9(0x1b1)+this[_0x4adeb9(0x1c3)]);if(!fs_1[_0x4adeb9(0x140)][_0x4adeb9(0x1bf)](this[_0x4adeb9(0x1da)]))throw new Error(_0x4adeb9(0x189)+this[_0x4adeb9(0x1da)]);const _0x432975=fs_1[_0x4adeb9(0x140)][_0x4adeb9(0x1c0)](this[_0x4adeb9(0x1c3)],_0x4adeb9(0xf8))['trim'](),_0x2007ab=fs_1[_0x4adeb9(0x140)]['readFileSync'](this[_0x4adeb9(0x1da)],_0x4adeb9(0xf8))['trim']();if(!_0x432975[_0x4adeb9(0x1d9)]('-----BEGIN')||!_0x432975['includes'](_0x4adeb9(0x1b6)))throw new Error(_0x4adeb9(0xfb));if(!_0x2007ab['includes'](_0x4adeb9(0x111))||!_0x2007ab['includes'](_0x4adeb9(0x1b6)))throw new Error(_0x4adeb9(0x128));console['log'](_0x4adeb9(0x10c)),console[_0x4adeb9(0x115)]('🔐\x20Private\x20key\x20length:\x20'+_0x432975[_0x4adeb9(0xf1)]+_0x4adeb9(0x148)),console['log'](_0x4adeb9(0x16d)+_0x2007ab[_0x4adeb9(0xf1)]+_0x4adeb9(0x148));}catch(_0x2ca8b7){console[_0x4adeb9(0x151)](_0x4adeb9(0x118),_0x2ca8b7);throw _0x2ca8b7;}}[a42_0x559554(0x180)](){const _0x21275b=a42_0x559554,_0x507220=crypto_1[_0x21275b(0x140)][_0x21275b(0x169)](0x20),_0x5b9750=crypto_1[_0x21275b(0x140)][_0x21275b(0x169)](0x10);return{'key':_0x507220,'iv':_0x5b9750};}[a42_0x559554(0x162)](_0x1eedea,_0x343a76,_0x1e685e){const _0xcdb199=a42_0x559554,_0x571c5d=crypto_1[_0xcdb199(0x140)][_0xcdb199(0x1be)](_0xcdb199(0x1a1),_0x343a76,_0x1e685e);let _0x4337f8=_0x571c5d[_0xcdb199(0x1c4)](_0x1eedea,_0xcdb199(0xf8),_0xcdb199(0x12d));return _0x4337f8+=_0x571c5d[_0xcdb199(0x18d)](_0xcdb199(0x12d)),_0x4337f8;}[a42_0x559554(0x1af)](_0x3880d3,_0x54e5e4){const _0x333d51=a42_0x559554;try{const _0x5877a1=fs_1[_0x333d51(0x140)][_0x333d51(0x1c0)](this['publicKeyPath'],'utf8')[_0x333d51(0x1cd)](),_0x352371={'iv':_0x54e5e4[_0x333d51(0x13f)]('base64'),'key':_0x3880d3[_0x333d51(0x13f)](_0x333d51(0x12d))},_0x4ae175=JSON[_0x333d51(0x1c2)](_0x352371);console[_0x333d51(0x115)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x4ae175['length']);const _0x34ab27=crypto_1[_0x333d51(0x140)][_0x333d51(0x12c)]({'key':_0x5877a1,'padding':crypto_1['default'][_0x333d51(0x178)][_0x333d51(0xe8)]},Buffer['from'](_0x4ae175));return console[_0x333d51(0x115)]('✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x34ab27[_0x333d51(0xf1)]),_0x34ab27['toString'](_0x333d51(0x12d));}catch(_0x100cec){console[_0x333d51(0x151)]('❌\x20RSA\x20encryption\x20failed:',_0x100cec);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a42_0x559554(0x153)](_0x1a4f74){const _0x238d0e=a42_0x559554;try{const _0x5a90e4=fs_1[_0x238d0e(0x140)][_0x238d0e(0x1c0)](this[_0x238d0e(0x1c3)],_0x238d0e(0xf8))[_0x238d0e(0x1cd)](),_0x4f1f5c=crypto_1[_0x238d0e(0x140)]['createSign'](_0x238d0e(0x192));_0x4f1f5c[_0x238d0e(0x1c4)](_0x1a4f74),_0x4f1f5c['end']();const _0x518641=_0x4f1f5c[_0x238d0e(0x10f)](_0x5a90e4,'base64');return console[_0x238d0e(0x115)](_0x238d0e(0x143)),console[_0x238d0e(0x115)]('📝\x20Data\x20to\x20sign\x20length:',_0x1a4f74[_0x238d0e(0xf1)]),console['log'](_0x238d0e(0x191),_0x518641[_0x238d0e(0xf1)]),_0x518641;}catch(_0x67f3e0){console[_0x238d0e(0x151)](_0x238d0e(0x18e),_0x67f3e0),console[_0x238d0e(0x151)](_0x238d0e(0x154),_0x1a4f74['substring'](0x0,0xc8)+'...');throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}[a42_0x559554(0x116)](_0x5485cc,_0x5178c4,_0x2a04a9){const _0x1c15f5=a42_0x559554,_0x1b72b4=crypto_1[_0x1c15f5(0x140)][_0x1c15f5(0x157)](_0x1c15f5(0x1a1),_0x5178c4,_0x2a04a9);let _0x34c1f1=_0x1b72b4[_0x1c15f5(0x1c4)](_0x5485cc,'base64','utf8');return _0x34c1f1+=_0x1b72b4['final']('utf8'),_0x34c1f1;}async['decryptResponsePhp'](_0x58cb1b,_0x1db9d5){const _0x247750=a42_0x559554;try{const _0x27ad2c=await fetch(_0x247750(0x186),{'method':_0x247750(0x174),'headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'info':_0x58cb1b,'key':_0x1db9d5})});if(!_0x27ad2c['ok'])throw new Error(_0x247750(0x1b2));return await _0x27ad2c[_0x247750(0x1a7)]();}catch(_0x4f0900){console[_0x247750(0x151)]('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x4f0900);throw new Error(_0x247750(0x1d5));}}['decryptResponse'](_0x309cf6,_0xf9e046){const _0x2f45d6=a42_0x559554;try{const _0x185578=fs_1['default']['readFileSync'](this[_0x2f45d6(0x1c3)],_0x2f45d6(0xf8))[_0x2f45d6(0x1cd)](),_0x51294f=crypto_1[_0x2f45d6(0x140)][_0x2f45d6(0x10e)](_0x185578,Buffer[_0x2f45d6(0x11b)](_0xf9e046,'base64')),_0x211afe=JSON[_0x2f45d6(0x164)](_0x51294f[_0x2f45d6(0x13f)]()),_0x47cbd1=Buffer[_0x2f45d6(0x11b)](_0x211afe[_0x2f45d6(0xea)],_0x2f45d6(0x12d)),_0x831afe=Buffer[_0x2f45d6(0x11b)](_0x211afe['iv'],_0x2f45d6(0x12d));return this[_0x2f45d6(0x116)](_0x309cf6,_0x47cbd1,_0x831afe);}catch(_0xe8a5c5){throw new Error(_0x2f45d6(0x138));}}async[a42_0x559554(0x106)](_0x16dfdb){const _0x9499cc=a42_0x559554,{paymentId:_0x26300b,orderId:_0x1acc94,amount:_0x4f8602,currency:_0x16305e,cardData:_0x3aa421,resultUrl:_0x281892,returnUrl:_0x2cbdba,cardHolder:_0x192eb7,browser:_0x40475a}=_0x16dfdb;console[_0x9499cc(0x115)](_0x9499cc(0x17b)),console[_0x9499cc(0x115)]('Payment\x20ID:',_0x26300b),console[_0x9499cc(0x115)](_0x9499cc(0xe6),_0x1acc94),console[_0x9499cc(0x115)](_0x9499cc(0xf5),_0x4f8602,_0x16305e),console[_0x9499cc(0x115)](_0x9499cc(0x1ae),this[_0x9499cc(0x1c9)](_0x3aa421[_0x9499cc(0x175)])),console[_0x9499cc(0x115)](_0x9499cc(0x124),_0x192eb7[_0x9499cc(0xe4)]+'\x20'+_0x192eb7[_0x9499cc(0xeb)]),console[_0x9499cc(0x115)](_0x9499cc(0x160),_0x2cbdba),console[_0x9499cc(0x115)](_0x9499cc(0x141),_0x281892);const _0x346e3b={'amount':_0x4f8602,'currency':_0x16305e['toUpperCase'](),'order_id':_0x1acc94,'result_url':_0x281892,'return_url':_0x2cbdba,'card':{'number':_0x3aa421[_0x9499cc(0x175)],'expire_month':_0x3aa421[_0x9499cc(0x1d1)],'expire_year':_0x3aa421[_0x9499cc(0x1b5)],'cvv':_0x3aa421[_0x9499cc(0x1c6)]},'card_holder':_0x192eb7,'browser':_0x40475a},_0x429774=JSON[_0x9499cc(0x1c2)](_0x346e3b);console[_0x9499cc(0x115)](_0x9499cc(0x131)),console['log'](_0x9499cc(0x10b)),console[_0x9499cc(0x115)](_0x429774),console[_0x9499cc(0x115)](_0x9499cc(0x15b),_0x429774[_0x9499cc(0xf1)]);try{const {key:_0x1e67f7,iv:_0x405004}=this[_0x9499cc(0x180)]();console[_0x9499cc(0x115)]('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console[_0x9499cc(0x115)](_0x9499cc(0x114),_0x1e67f7[_0x9499cc(0xf1)]),console[_0x9499cc(0x115)](_0x9499cc(0x19b),_0x405004['length']);const _0x4da7da=this[_0x9499cc(0x162)](_0x429774,_0x1e67f7,_0x405004);console[_0x9499cc(0x115)](_0x9499cc(0x1c8)),console['log'](_0x9499cc(0x1a6),_0x4da7da['length']);const _0x43b3f4=this[_0x9499cc(0x1af)](_0x1e67f7,_0x405004);console['log'](_0x9499cc(0x135)),console[_0x9499cc(0x115)](_0x9499cc(0x182),_0x43b3f4[_0x9499cc(0xf1)]);const _0x47ba61=this['signRSA'](_0x429774);console[_0x9499cc(0x115)](_0x9499cc(0xfd)),console[_0x9499cc(0x115)](_0x9499cc(0x191),_0x47ba61[_0x9499cc(0xf1)]);const _0x1c88df={'merchant_point_id':this[_0x9499cc(0x13e)],'method':_0x9499cc(0x1ac),'info':_0x4da7da,'key':_0x43b3f4,'sign':_0x47ba61,'lang':'en'};console['log'](_0x9499cc(0x126)),console[_0x9499cc(0x115)](_0x9499cc(0x104)),console['log'](_0x9499cc(0x1d4),this['merchantPointId']),console[_0x9499cc(0x115)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x9499cc(0x115)](_0x9499cc(0x109),_0x4da7da[_0x9499cc(0xf1)]),console[_0x9499cc(0x115)](_0x9499cc(0x103),_0x43b3f4[_0x9499cc(0xf1)]),console[_0x9499cc(0x115)](_0x9499cc(0x107),_0x47ba61[_0x9499cc(0xf1)]),console[_0x9499cc(0x115)](_0x9499cc(0xf9)),loggerService_1[_0x9499cc(0x1ab)][_0x9499cc(0x167)](_0x9499cc(0x105),'/charge','POST',{'merchant_point_id':this['merchantPointId'],'method':'charge','lang':'en'});const _0x187fef=Date['now'](),_0x57016a=await fetch(this[_0x9499cc(0x1d0)],{'method':_0x9499cc(0x174),'headers':{'Content-Type':_0x9499cc(0x15f),'Accept':_0x9499cc(0x15f),'User-Agent':_0x9499cc(0x102)},'body':JSON[_0x9499cc(0x1c2)](_0x1c88df)}),_0x4ea698=Date[_0x9499cc(0x130)]()-_0x187fef;console['log']('===\x20MASTERCARD\x20API\x20RESPONSE\x20==='),console[_0x9499cc(0x115)]('Status:',_0x57016a[_0x9499cc(0x110)]),console['log'](_0x9499cc(0x1a4),_0x4ea698+'ms');if(!_0x57016a['ok']){const _0x3b9154=await _0x57016a[_0x9499cc(0x1a7)]();console[_0x9499cc(0x151)](_0x9499cc(0x1ad),_0x57016a['status']),console[_0x9499cc(0x151)](_0x9499cc(0x17c),_0x3b9154),loggerService_1[_0x9499cc(0x1ab)][_0x9499cc(0x1c1)](_0x9499cc(0x105),_0x9499cc(0x129),_0x57016a[_0x9499cc(0x110)],_0x3b9154,_0x4ea698),loggerService_1[_0x9499cc(0x1ab)]['logWhiteDomainError'](_0x9499cc(0x105),_0x9499cc(0x16c),_0x9499cc(0x1a8)+_0x57016a[_0x9499cc(0x110)]+':\x20'+_0x3b9154);throw new Error('HTTP\x20error!\x20status:\x20'+_0x57016a[_0x9499cc(0x110)]+',\x20body:\x20'+_0x3b9154);}const _0x428fd6=await _0x57016a['json']();loggerService_1['loggerService'][_0x9499cc(0x1c1)](_0x9499cc(0x105),_0x9499cc(0x129),_0x57016a[_0x9499cc(0x110)],_0x428fd6,_0x4ea698),console[_0x9499cc(0x115)](_0x9499cc(0x18c));let _0x4f9f6a=_0x428fd6;if(_0x428fd6['info']&&_0x428fd6[_0x9499cc(0xea)]&&_0x428fd6['sign']){console['log'](_0x9499cc(0xf7));try{const _0x2d4313=await this[_0x9499cc(0x1a3)](_0x428fd6[_0x9499cc(0x108)],_0x428fd6[_0x9499cc(0xea)]);_0x4f9f6a=JSON[_0x9499cc(0x164)](_0x2d4313),console[_0x9499cc(0x115)](_0x9499cc(0x1dc)),loggerService_1['loggerService'][_0x9499cc(0x1c1)]('mastercard',_0x9499cc(0xef),_0x57016a[_0x9499cc(0x110)],_0x4f9f6a,_0x4ea698),console[_0x9499cc(0x115)](_0x9499cc(0x149));}catch(_0x24960d){console[_0x9499cc(0x151)](_0x9499cc(0x184),_0x24960d),loggerService_1[_0x9499cc(0x1ab)][_0x9499cc(0x14c)]('mastercard',_0x9499cc(0x1b3),_0x9499cc(0x113)+_0x24960d),_0x4f9f6a=_0x428fd6;}}else loggerService_1[_0x9499cc(0x1ab)]['logWhiteDomainResponse']('mastercard',_0x9499cc(0xef),_0x57016a['status'],_0x4f9f6a,_0x4ea698),console[_0x9499cc(0x115)](_0x9499cc(0x11c));console[_0x9499cc(0x115)](_0x9499cc(0x161),_0x4f9f6a[_0x9499cc(0x110)]),console[_0x9499cc(0x115)]('Final:',_0x4f9f6a[_0x9499cc(0x18d)]),console['log'](_0x9499cc(0x1a9),_0x4f9f6a[_0x9499cc(0x1d8)]),console['log'](_0x9499cc(0x137),_0x4f9f6a[_0x9499cc(0x13d)]||'none');if(_0x4f9f6a[_0x9499cc(0x110)]===0x64&&_0x4f9f6a[_0x9499cc(0x18d)]===0x1)return console[_0x9499cc(0x115)]('✅\x20Payment\x20successful'),{'gateway_payment_id':_0x4f9f6a[_0x9499cc(0x1d8)]?.[_0x9499cc(0x13f)](),'payment_url':_0x2cbdba,'requires_3ds':![],'status':_0x9499cc(0x17e),'final':!![]};if(_0x4f9f6a[_0x9499cc(0x13d)])return console[_0x9499cc(0x115)](_0x9499cc(0xe7)),this[_0x9499cc(0x188)](_0x26300b,_0x1acc94,_0x4f9f6a[_0x9499cc(0x1d8)]?.['toString']()||_0x1acc94),{'gateway_payment_id':_0x4f9f6a[_0x9499cc(0x1d8)]?.[_0x9499cc(0x13f)](),'payment_url':_0x4f9f6a[_0x9499cc(0x13d)],'requires_3ds':!![],'threeds_url':_0x4f9f6a[_0x9499cc(0x13d)],'status':_0x9499cc(0x190),'final':![]};let _0x5bf31b=_0x4f9f6a['desc']||_0x4f9f6a[_0x9499cc(0x1d7)]||_0x9499cc(0x156),_0x30f455=_0x4f9f6a[_0x9499cc(0x110)],_0x5696ed=_0x4f9f6a[_0x9499cc(0x18d)];return console[_0x9499cc(0x115)](_0x9499cc(0x176)+_0x30f455+',\x20Final:\x20'+_0x5696ed+_0x9499cc(0x199)+_0x5bf31b),{'gateway_payment_id':_0x4f9f6a['payment_id']?.[_0x9499cc(0x13f)](),'payment_url':_0x2cbdba,'requires_3ds':![],'status':'FAILED','final':!![]};}catch(_0x3a0e1e){console[_0x9499cc(0x151)](_0x9499cc(0x18f)),console[_0x9499cc(0x151)](_0x9499cc(0x13c),_0x3a0e1e),loggerService_1['loggerService'][_0x9499cc(0x14c)](_0x9499cc(0x105),'/charge',_0x3a0e1e);throw new Error(_0x9499cc(0x1d3)+(_0x3a0e1e instanceof Error?_0x3a0e1e[_0x9499cc(0x1d7)]:'Unknown\x20error'));}}async[a42_0x559554(0x132)](_0x2fc4f1,_0x3dd86a){const _0x4d1efa=a42_0x559554;console['log'](_0x4d1efa(0x14a)+_0x2fc4f1+'\x20('+_0x3dd86a+')');try{const _0x2a2adb={'payment_id':_0x2fc4f1,'order_id':_0x3dd86a},_0x3a2593=JSON[_0x4d1efa(0x1c2)](_0x2a2adb),{key:_0x308e97,iv:_0x466bf8}=this[_0x4d1efa(0x180)](),_0x583113=this['encryptAES'](_0x3a2593,_0x308e97,_0x466bf8),_0x362d8d=this[_0x4d1efa(0x1af)](_0x308e97,_0x466bf8),_0x4782a9=this['signRSA'](_0x3a2593),_0x1cf857={'merchant_point_id':this['merchantPointId'],'method':_0x4d1efa(0x110),'info':_0x583113,'key':_0x362d8d,'sign':_0x4782a9,'lang':'en'};loggerService_1[_0x4d1efa(0x1ab)]['logWhiteDomainRequest'](_0x4d1efa(0x105),_0x4d1efa(0x15c),_0x4d1efa(0x174),{'merchant_point_id':this['merchantPointId'],'method':'status','lang':'en'});const _0x2f2b3f=Date[_0x4d1efa(0x130)](),_0x5a1bc8=await fetch(this['apiUrl'],{'method':_0x4d1efa(0x174),'headers':{'Content-Type':'application/json','Accept':_0x4d1efa(0x15f),'User-Agent':_0x4d1efa(0x102)},'body':JSON[_0x4d1efa(0x1c2)](_0x1cf857)}),_0x2c2b89=Date['now']()-_0x2f2b3f;if(!_0x5a1bc8['ok']){const _0x1b12c3=await _0x5a1bc8[_0x4d1efa(0x1a7)]();loggerService_1[_0x4d1efa(0x1ab)][_0x4d1efa(0x1c1)]('mastercard','/status_raw',_0x5a1bc8[_0x4d1efa(0x110)],_0x1b12c3,_0x2c2b89);throw new Error(_0x4d1efa(0x165)+_0x5a1bc8[_0x4d1efa(0x110)]);}const _0x325542=await _0x5a1bc8['json']();loggerService_1[_0x4d1efa(0x1ab)][_0x4d1efa(0x1c1)](_0x4d1efa(0x105),'/status_raw',_0x5a1bc8[_0x4d1efa(0x110)],_0x325542,_0x2c2b89);let _0x474992=_0x325542;if(_0x325542['info']&&_0x325542['key']&&_0x325542['sign']){console[_0x4d1efa(0x115)]('🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0x4ae5d7=this[_0x4d1efa(0x170)](_0x325542[_0x4d1efa(0x108)],_0x325542['key']);_0x474992=JSON[_0x4d1efa(0x164)](_0x4ae5d7),console[_0x4d1efa(0x115)](_0x4d1efa(0x172)),loggerService_1[_0x4d1efa(0x1ab)][_0x4d1efa(0x1c1)](_0x4d1efa(0x105),_0x4d1efa(0x14f),_0x5a1bc8['status'],_0x474992,_0x2c2b89),console[_0x4d1efa(0x115)](_0x4d1efa(0xf3));}catch(_0x24d4e0){console['error'](_0x4d1efa(0x152),_0x24d4e0),loggerService_1['loggerService'][_0x4d1efa(0x14c)](_0x4d1efa(0x105),_0x4d1efa(0x11a),_0x4d1efa(0x127)+_0x24d4e0),_0x474992=_0x325542;}}else loggerService_1[_0x4d1efa(0x1ab)][_0x4d1efa(0x1c1)](_0x4d1efa(0x105),_0x4d1efa(0x14f),_0x5a1bc8['status'],_0x474992,_0x2c2b89),console['log'](_0x4d1efa(0x196));console[_0x4d1efa(0x115)]('📊\x20Status\x20check\x20result:',{'status':_0x474992[_0x4d1efa(0x110)],'final':_0x474992[_0x4d1efa(0x18d)],'payment_id':_0x474992[_0x4d1efa(0x1d8)],'desc':_0x474992[_0x4d1efa(0x1cf)]});let _0x4972e7=_0x4d1efa(0x190);if(_0x474992[_0x4d1efa(0x110)]===0x1&&_0x474992['final']===0x1)_0x4972e7=_0x4d1efa(0x17e);else _0x474992[_0x4d1efa(0x110)]===0x0&&_0x474992[_0x4d1efa(0x18d)]===0x0?_0x4972e7=_0x4d1efa(0x190):_0x4972e7=_0x4d1efa(0x1d2);return{'status':_0x4972e7,'final':_0x474992[_0x4d1efa(0x18d)]===0x1,'amount':_0x474992['amount'],'currency':_0x474992[_0x4d1efa(0x18b)],'date_success':_0x474992[_0x4d1efa(0x16e)],'description':_0x474992[_0x4d1efa(0x1cf)]};}catch(_0x54db6c){console[_0x4d1efa(0x151)](_0x4d1efa(0x158),_0x54db6c),loggerService_1[_0x4d1efa(0x1ab)][_0x4d1efa(0x14c)](_0x4d1efa(0x105),_0x4d1efa(0x15c),_0x54db6c);throw new Error('Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20'+(_0x54db6c instanceof Error?_0x54db6c[_0x4d1efa(0x1d7)]:_0x4d1efa(0x156)));}}['scheduleStatusChecks'](_0x13d039,_0x2715a7,_0x55d885){const _0x448f2=a42_0x559554;console[_0x448f2(0x115)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0x13d039+'\x20('+_0x55d885+')'),this['clearStatusTimers'](_0x13d039);const _0x1a919b=[],_0x87ba06=0x5*0x3c*0x3e8,_0x21118e=0x2*0x3c*0x3c*0x3e8,_0x1c9cd2=Math[_0x448f2(0x11f)](_0x21118e/_0x87ba06);console[_0x448f2(0x115)]('⏰\x20Will\x20check\x20status\x20'+_0x1c9cd2+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x42cce7=0x1;_0x42cce7<=_0x1c9cd2;_0x42cce7++){const _0x292057=setTimeout(async()=>{const _0xa0bf57=_0x448f2;console[_0xa0bf57(0x115)](_0xa0bf57(0x1b7)+_0x42cce7+'/'+_0x1c9cd2+_0xa0bf57(0x1b4)+_0x13d039);try{const _0x5bc53a=await this['checkPaymentStatus'](_0x55d885,_0x2715a7);console[_0xa0bf57(0x115)](_0xa0bf57(0x1a2)+_0x42cce7+_0xa0bf57(0x1c5),_0x5bc53a),_0x5bc53a[_0xa0bf57(0x18d)]&&(console['log'](_0xa0bf57(0x1bc)+_0x13d039+'\x20is\x20final\x20('+_0x5bc53a[_0xa0bf57(0x110)]+_0xa0bf57(0x16f)),this[_0xa0bf57(0x14d)](_0x13d039),await this[_0xa0bf57(0xfe)](_0x13d039,_0x5bc53a[_0xa0bf57(0x110)],_0x5bc53a));}catch(_0x13b055){console[_0xa0bf57(0x151)](_0xa0bf57(0x15e)+_0x42cce7+_0xa0bf57(0x112)+_0x13d039+':',_0x13b055);}},_0x42cce7*_0x87ba06);_0x1a919b[_0x448f2(0x134)](_0x292057);}this[_0x448f2(0x168)][_0x448f2(0x185)](_0x13d039,_0x1a919b),console['log'](_0x448f2(0xff)+_0x1c9cd2+_0x448f2(0x12e)+_0x13d039);}[a42_0x559554(0x14d)](_0x4ad38e){const _0x14cb86=a42_0x559554,_0x2d6d34=this[_0x14cb86(0x168)][_0x14cb86(0x125)](_0x4ad38e);_0x2d6d34&&(console[_0x14cb86(0x115)](_0x14cb86(0x1d6)+_0x2d6d34[_0x14cb86(0xf1)]+_0x14cb86(0x1ba)+_0x4ad38e),_0x2d6d34[_0x14cb86(0x177)]((_0x200b94,_0x51e1e2)=>{clearTimeout(_0x200b94);}),this['statusCheckTimers'][_0x14cb86(0xed)](_0x4ad38e));}async[a42_0x559554(0xfe)](_0x141a87,_0x393ef0,_0x16fd20){const _0x26e34e=a42_0x559554;try{const _0x599dad=(await Promise[_0x26e34e(0x155)]()[_0x26e34e(0xf0)](()=>__importStar(require(_0x26e34e(0xf6)))))[_0x26e34e(0x140)],_0x54fafe={'status':_0x393ef0['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x26e34e(0x144),'statusChangedAt':new Date()};_0x393ef0===_0x26e34e(0x17e)&&(_0x54fafe[_0x26e34e(0x1b9)]=new Date()),_0x16fd20['description']&&(_0x54fafe['adminNotes']=_0x26e34e(0xe9)+_0x16fd20['description']),await _0x599dad[_0x26e34e(0xfc)]['update']({'where':{'id':_0x141a87},'data':_0x54fafe}),console[_0x26e34e(0x115)]('✅\x20Payment\x20'+_0x141a87+_0x26e34e(0xe5)+_0x393ef0),await this[_0x26e34e(0x183)](_0x141a87,_0x393ef0);}catch(_0x1f171e){console[_0x26e34e(0x151)](_0x26e34e(0x146)+_0x141a87+':',_0x1f171e);}}async[a42_0x559554(0x183)](_0x23a053,_0x1f0ba3){const _0x193052=a42_0x559554;try{const _0x520bd1=(await Promise['resolve']()[_0x193052(0xf0)](()=>__importStar(require(_0x193052(0xf6)))))['default'],{telegramBotService:_0x4f3283}=await Promise[_0x193052(0x155)]()[_0x193052(0xf0)](()=>__importStar(require('../telegramBotService'))),_0x3cd488=await _0x520bd1[_0x193052(0xfc)][_0x193052(0x1a5)]({'where':{'id':_0x23a053},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x3cd488)return;const _0x3d5fe0={'PAID':_0x193052(0x187),'FAILED':_0x193052(0x16b)},_0x47221f=_0x3d5fe0[_0x1f0ba3];_0x47221f&&await _0x4f3283[_0x193052(0x159)](_0x3cd488['shopId'],_0x3cd488,_0x47221f),await this[_0x193052(0x1cb)](_0x3cd488,_0x1f0ba3);}catch(_0x2c8f6d){console[_0x193052(0x151)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x2c8f6d);}}async[a42_0x559554(0x1cb)](_0x4bd768,_0x1d59e3){const _0xa94519=a42_0x559554,_0x312fd7=Date[_0xa94519(0x130)]();try{const _0x51cda1=_0x4bd768[_0xa94519(0x12a)],_0x556745=_0x51cda1[_0xa94519(0x18a)];if(!_0x556745?.[_0xa94519(0x136)]){console[_0xa94519(0x115)](_0xa94519(0x11d)+_0x51cda1['id']);return;}const _0x3527eb=_0x1d59e3===_0xa94519(0x17e)?_0xa94519(0x19e):_0xa94519(0x1cc);let _0x2b83f3=[];if(_0x556745['webhookEvents'])try{_0x2b83f3=Array['isArray'](_0x556745[_0xa94519(0x14b)])?_0x556745['webhookEvents']:JSON[_0xa94519(0x164)](_0x556745[_0xa94519(0x14b)]);}catch(_0x452ae2){console['error'](_0xa94519(0xf2),_0x452ae2),_0x2b83f3=[];}if(!_0x2b83f3[_0xa94519(0x1d9)](_0x3527eb)){console[_0xa94519(0x115)]('Webhook\x20event\x20'+_0x3527eb+_0xa94519(0x194)+_0x51cda1['id']);return;}const _0x2f7990={'event':_0x3527eb,'payment':{'id':_0x4bd768['id'],'order_id':_0x4bd768[_0xa94519(0x19f)],'gateway_order_id':_0x4bd768[_0xa94519(0x1c7)],'gateway':'1111','amount':_0x4bd768[_0xa94519(0x122)],'currency':_0x4bd768[_0xa94519(0x18b)],'status':_0x1d59e3[_0xa94519(0x145)](),'customer_email':_0x4bd768[_0xa94519(0x1bd)],'customer_name':_0x4bd768[_0xa94519(0x12b)],'created_at':_0x4bd768['createdAt'],'updated_at':new Date()}},_0x198823=await fetch(_0x556745[_0xa94519(0x136)],{'method':_0xa94519(0x174),'headers':{'Content-Type':'application/json','User-Agent':_0xa94519(0x10d)},'body':JSON['stringify'](_0x2f7990)}),_0x4ffdef=Date[_0xa94519(0x130)]()-_0x312fd7;loggerService_1['loggerService'][_0xa94519(0xee)](_0x4bd768['shopId'],_0x556745['webhookUrl'],_0x3527eb,_0x198823[_0xa94519(0x110)],_0x4ffdef,_0x2f7990),console[_0xa94519(0x115)](_0xa94519(0x120)+_0x556745[_0xa94519(0x136)]+_0xa94519(0x19c)+_0x198823['status']+'\x20('+_0x4ffdef+_0xa94519(0x13b));}catch(_0x524e96){console[_0xa94519(0x151)](_0xa94519(0x14e),_0x524e96),loggerService_1[_0xa94519(0x1ab)]['logShopWebhookError'](_0x4bd768[_0xa94519(0x17d)],_0x4bd768[_0xa94519(0x12a)]?.[_0xa94519(0x18a)]?.[_0xa94519(0x136)]||'unknown','webhook_send',_0x524e96,{});}}[a42_0x559554(0x1c9)](_0x2ce7a4){const _0x2c75f8=a42_0x559554,_0x2ff200=_0x2ce7a4[_0x2c75f8(0x19a)](/[\s-]/g,'');if(_0x2ff200['length']<0x4)return _0x2c75f8(0x100);return'****\x20****\x20****\x20'+_0x2ff200[_0x2c75f8(0x166)](-0x4);}async[a42_0x559554(0x1ce)](_0x2f7d81){const _0x1d6b34=a42_0x559554;console[_0x1d6b34(0x115)](_0x1d6b34(0x1aa),_0x2f7d81);let _0x17b245=_0x1d6b34(0x190);if(_0x2f7d81[_0x1d6b34(0x110)]===0x1&&_0x2f7d81[_0x1d6b34(0x18d)]===0x1)_0x17b245=_0x1d6b34(0x17e);else _0x2f7d81['status']===0x0&&_0x2f7d81[_0x1d6b34(0x18d)]===0x0?_0x17b245=_0x1d6b34(0x190):_0x17b245='FAILED';return{'paymentId':_0x2f7d81['order_id']||'','status':_0x17b245,'amount':_0x2f7d81[_0x1d6b34(0x122)],'currency':_0x2f7d81[_0x1d6b34(0x18b)]};}[a42_0x559554(0x101)](){const _0x175887=a42_0x559554;console[_0x175887(0x115)](_0x175887(0x171));const _0x4afda0=this[_0x175887(0x168)][_0x175887(0x1bb)];for(const [_0x9935ec]of this[_0x175887(0x168)]){this[_0x175887(0x14d)](_0x9935ec);}console[_0x175887(0x115)](_0x175887(0x179)+_0x4afda0+_0x175887(0x1ca));}}exports[a42_0x559554(0x17f)]=MasterCardService;