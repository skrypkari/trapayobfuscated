'use strict';function a42_0x2369(_0x1b2032,_0x344baf){const _0xadc3a7=a42_0xadc3();return a42_0x2369=function(_0x2369a8,_0x333bac){_0x2369a8=_0x2369a8-0x9d;let _0x3e0da7=_0xadc3a7[_0x2369a8];return _0x3e0da7;},a42_0x2369(_0x1b2032,_0x344baf);}const a42_0x4c39ef=a42_0x2369;(function(_0x370b31,_0x3743ba){const _0x562562=a42_0x2369,_0x5259c9=_0x370b31();while(!![]){try{const _0xe6edd5=-parseInt(_0x562562(0x107))/0x1*(parseInt(_0x562562(0xf2))/0x2)+-parseInt(_0x562562(0x134))/0x3*(-parseInt(_0x562562(0x163))/0x4)+parseInt(_0x562562(0x161))/0x5+-parseInt(_0x562562(0xf8))/0x6+parseInt(_0x562562(0xd3))/0x7+parseInt(_0x562562(0x15e))/0x8+-parseInt(_0x562562(0xa0))/0x9;if(_0xe6edd5===_0x3743ba)break;else _0x5259c9['push'](_0x5259c9['shift']());}catch(_0x1b3e77){_0x5259c9['push'](_0x5259c9['shift']());}}}(a42_0xadc3,0x43e7f));var __createBinding=this&&this[a42_0x4c39ef(0xd4)]||(Object[a42_0x4c39ef(0x13a)]?function(_0x1e6736,_0x5702b0,_0x30e72c,_0x5a5311){const _0x99d95d=a42_0x4c39ef;if(_0x5a5311===undefined)_0x5a5311=_0x30e72c;var _0x4329ac=Object['getOwnPropertyDescriptor'](_0x5702b0,_0x30e72c);(!_0x4329ac||(_0x99d95d(0x153)in _0x4329ac?!_0x5702b0[_0x99d95d(0x135)]:_0x4329ac[_0x99d95d(0x17f)]||_0x4329ac[_0x99d95d(0xf0)]))&&(_0x4329ac={'enumerable':!![],'get':function(){return _0x5702b0[_0x30e72c];}}),Object['defineProperty'](_0x1e6736,_0x5a5311,_0x4329ac);}:function(_0xba7dec,_0x12ae9c,_0xf5bdba,_0x2594b5){if(_0x2594b5===undefined)_0x2594b5=_0xf5bdba;_0xba7dec[_0x2594b5]=_0x12ae9c[_0xf5bdba];}),__setModuleDefault=this&&this[a42_0x4c39ef(0x159)]||(Object['create']?function(_0x491d64,_0x5da513){const _0x4c1db2=a42_0x4c39ef;Object['defineProperty'](_0x491d64,_0x4c1db2(0x14e),{'enumerable':!![],'value':_0x5da513});}:function(_0x1f2472,_0x5a353e){const _0x5c2562=a42_0x4c39ef;_0x1f2472[_0x5c2562(0x14e)]=_0x5a353e;}),__importStar=this&&this[a42_0x4c39ef(0x160)]||(function(){var _0x6b3ce3=function(_0x51285c){const _0x392309=a42_0x2369;return _0x6b3ce3=Object[_0x392309(0xff)]||function(_0x1cfa3a){const _0x311ec4=_0x392309;var _0x1dfa47=[];for(var _0xff7a4b in _0x1cfa3a)if(Object['prototype']['hasOwnProperty'][_0x311ec4(0x105)](_0x1cfa3a,_0xff7a4b))_0x1dfa47[_0x1dfa47[_0x311ec4(0xd8)]]=_0xff7a4b;return _0x1dfa47;},_0x6b3ce3(_0x51285c);};return function(_0xdb4055){const _0x575c7a=a42_0x2369;if(_0xdb4055&&_0xdb4055[_0x575c7a(0x135)])return _0xdb4055;var _0x2b9925={};if(_0xdb4055!=null){for(var _0x7619c2=_0x6b3ce3(_0xdb4055),_0x1dda56=0x0;_0x1dda56<_0x7619c2['length'];_0x1dda56++)if(_0x7619c2[_0x1dda56]!==_0x575c7a(0x14e))__createBinding(_0x2b9925,_0xdb4055,_0x7619c2[_0x1dda56]);}return __setModuleDefault(_0x2b9925,_0xdb4055),_0x2b9925;};}()),__importDefault=this&&this[a42_0x4c39ef(0x18d)]||function(_0x5df5ac){return _0x5df5ac&&_0x5df5ac['__esModule']?_0x5df5ac:{'default':_0x5df5ac};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a42_0x4c39ef(0x14b)]=void 0x0;const crypto_1=__importDefault(require(a42_0x4c39ef(0xb5))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a42_0x4c39ef(0x141));class MasterCardService{constructor(){const _0x422adb=a42_0x4c39ef;this['statusCheckTimers']=new Map(),this[_0x422adb(0xc9)]=_0x422adb(0x12b),this[_0x422adb(0xf6)]=0x67c,this[_0x422adb(0x112)]=path_1[_0x422adb(0x14e)][_0x422adb(0xc3)](process[_0x422adb(0xb1)](),_0x422adb(0xbd),_0x422adb(0xc7)),this[_0x422adb(0xd6)]=path_1[_0x422adb(0x14e)][_0x422adb(0xc3)](process[_0x422adb(0xb1)](),_0x422adb(0xbd),_0x422adb(0x108)),console[_0x422adb(0xfd)](_0x422adb(0x170)),console['log']('🔐\x20Private\x20key\x20path:',this['privateKeyPath']),console[_0x422adb(0xfd)](_0x422adb(0x143),this['publicKeyPath']),this[_0x422adb(0xab)]();}[a42_0x4c39ef(0xab)](){const _0x8f9f79=a42_0x4c39ef;try{if(!fs_1[_0x8f9f79(0x14e)][_0x8f9f79(0x16c)](this[_0x8f9f79(0x112)]))throw new Error(_0x8f9f79(0x121)+this['privateKeyPath']);if(!fs_1[_0x8f9f79(0x14e)][_0x8f9f79(0x16c)](this[_0x8f9f79(0xd6)]))throw new Error(_0x8f9f79(0x14c)+this[_0x8f9f79(0xd6)]);const _0x18f67d=fs_1[_0x8f9f79(0x14e)][_0x8f9f79(0x16a)](this[_0x8f9f79(0x112)],_0x8f9f79(0xcb))[_0x8f9f79(0x185)](),_0x43e895=fs_1[_0x8f9f79(0x14e)][_0x8f9f79(0x16a)](this['publicKeyPath'],_0x8f9f79(0xcb))[_0x8f9f79(0x185)]();if(!_0x18f67d[_0x8f9f79(0x118)]('-----BEGIN')||!_0x18f67d['includes'](_0x8f9f79(0x139)))throw new Error(_0x8f9f79(0x15f));if(!_0x43e895[_0x8f9f79(0x118)](_0x8f9f79(0x11b))||!_0x43e895[_0x8f9f79(0x118)](_0x8f9f79(0x139)))throw new Error(_0x8f9f79(0x148));console['log'](_0x8f9f79(0x11c)),console['log'](_0x8f9f79(0x131)+_0x18f67d['length']+_0x8f9f79(0x158)),console['log']('🔐\x20Public\x20key\x20length:\x20'+_0x43e895[_0x8f9f79(0xd8)]+_0x8f9f79(0x158));}catch(_0x31491a){console['error'](_0x8f9f79(0x171),_0x31491a);throw _0x31491a;}}['generateAESKey'](){const _0x40145c=a42_0x4c39ef,_0x583049=crypto_1[_0x40145c(0x14e)][_0x40145c(0xb7)](0x20),_0x585f0b=crypto_1['default']['randomBytes'](0x10);return{'key':_0x583049,'iv':_0x585f0b};}[a42_0x4c39ef(0x186)](_0x26cb31,_0xc21c95,_0x26595b){const _0xf15850=a42_0x4c39ef,_0x1e8a6d=crypto_1[_0xf15850(0x14e)][_0xf15850(0xfc)](_0xf15850(0xf5),_0xc21c95,_0x26595b);let _0x27bb55=_0x1e8a6d[_0xf15850(0xe4)](_0x26cb31,_0xf15850(0xcb),_0xf15850(0xca));return _0x27bb55+=_0x1e8a6d['final']('base64'),_0x27bb55;}[a42_0x4c39ef(0x178)](_0x5e9ed3,_0xeba307){const _0x24e022=a42_0x4c39ef;try{const _0x4987ae=fs_1[_0x24e022(0x14e)][_0x24e022(0x16a)](this[_0x24e022(0xd6)],_0x24e022(0xcb))[_0x24e022(0x185)](),_0x411afe={'iv':_0xeba307[_0x24e022(0xec)]('base64'),'key':_0x5e9ed3[_0x24e022(0xec)]('base64')},_0xff73e8=JSON[_0x24e022(0x164)](_0x411afe);console[_0x24e022(0xfd)](_0x24e022(0x9d),_0xff73e8['length']);const _0x1743f6=crypto_1[_0x24e022(0x14e)][_0x24e022(0xc1)]({'key':_0x4987ae,'padding':crypto_1[_0x24e022(0x14e)][_0x24e022(0xa5)]['RSA_PKCS1_PADDING']},Buffer[_0x24e022(0xfe)](_0xff73e8));return console[_0x24e022(0xfd)](_0x24e022(0xf3),_0x1743f6[_0x24e022(0xd8)]),_0x1743f6[_0x24e022(0xec)](_0x24e022(0xca));}catch(_0x5a039c){console[_0x24e022(0x152)](_0x24e022(0x115),_0x5a039c);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a42_0x4c39ef(0xdd)](_0x3c9078){const _0x36e3f7=a42_0x4c39ef;try{const _0x35a8bc=fs_1['default'][_0x36e3f7(0x16a)](this[_0x36e3f7(0x112)],_0x36e3f7(0xcb))[_0x36e3f7(0x185)](),_0x3d1321=crypto_1[_0x36e3f7(0x14e)][_0x36e3f7(0x174)](_0x36e3f7(0xd0));_0x3d1321[_0x36e3f7(0xe4)](_0x3c9078),_0x3d1321[_0x36e3f7(0xe7)]();const _0xdfec30=_0x3d1321[_0x36e3f7(0x137)](_0x35a8bc,_0x36e3f7(0xca));return console[_0x36e3f7(0xfd)](_0x36e3f7(0x184)),console[_0x36e3f7(0xfd)]('📝\x20Data\x20to\x20sign\x20length:',_0x3c9078[_0x36e3f7(0xd8)]),console[_0x36e3f7(0xfd)](_0x36e3f7(0x151),_0xdfec30[_0x36e3f7(0xd8)]),_0xdfec30;}catch(_0x1401a9){console['error'](_0x36e3f7(0x147),_0x1401a9),console[_0x36e3f7(0x152)](_0x36e3f7(0x14d),_0x3c9078[_0x36e3f7(0xe6)](0x0,0xc8)+_0x36e3f7(0xac));throw new Error(_0x36e3f7(0x14f));}}['decryptAES'](_0x3a1af0,_0x24f4b3,_0x3090dc){const _0x2d85ea=a42_0x4c39ef,_0x5d3226=crypto_1['default'][_0x2d85ea(0xa8)](_0x2d85ea(0xf5),_0x24f4b3,_0x3090dc);let _0x461369=_0x5d3226[_0x2d85ea(0xe4)](_0x3a1af0,_0x2d85ea(0xca),'utf8');return _0x461369+=_0x5d3226[_0x2d85ea(0x167)](_0x2d85ea(0xcb)),_0x461369;}async[a42_0x4c39ef(0x123)](_0x199157,_0x14202a){const _0x19d512=a42_0x4c39ef;try{const _0x2bfe74=await fetch(_0x19d512(0xa9),{'method':'POST','headers':{'Content-Type':_0x19d512(0x10c)},'body':JSON['stringify']({'info':_0x199157,'key':_0x14202a})});if(!_0x2bfe74['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x2bfe74[_0x19d512(0xcf)]();}catch(_0x2855ce){console[_0x19d512(0x152)](_0x19d512(0x11f),_0x2855ce);throw new Error(_0x19d512(0xaa));}}[a42_0x4c39ef(0x17d)](_0x3d4418,_0x119e94){const _0x266c51=a42_0x4c39ef;try{const _0x2c16ef=fs_1[_0x266c51(0x14e)][_0x266c51(0x16a)](this['privateKeyPath'],'utf8')[_0x266c51(0x185)](),_0x24c6e8=crypto_1[_0x266c51(0x14e)][_0x266c51(0xf7)](_0x2c16ef,Buffer[_0x266c51(0xfe)](_0x119e94,'base64')),_0xc65ff5=JSON[_0x266c51(0x106)](_0x24c6e8[_0x266c51(0xec)]()),_0x4d2c20=Buffer[_0x266c51(0xfe)](_0xc65ff5[_0x266c51(0x10e)],_0x266c51(0xca)),_0x1de92c=Buffer[_0x266c51(0xfe)](_0xc65ff5['iv'],_0x266c51(0xca));return this[_0x266c51(0xcc)](_0x3d4418,_0x4d2c20,_0x1de92c);}catch(_0x44a2a3){throw new Error(_0x266c51(0xbe));}}async[a42_0x4c39ef(0xb0)](_0x4e4992){const _0x37642e=a42_0x4c39ef,{paymentId:_0x1b4ea6,orderId:_0x1e395f,amount:_0x335b52,currency:_0x56060f,cardData:_0x5f0afd,resultUrl:_0x18ef6d,returnUrl:_0x51431c,cardHolder:_0x92dd6d,browser:_0x212ae6}=_0x4e4992;console[_0x37642e(0xfd)](_0x37642e(0x11a)),console[_0x37642e(0xfd)]('Payment\x20ID:',_0x1b4ea6),console['log'](_0x37642e(0x15b),_0x1e395f),console[_0x37642e(0xfd)](_0x37642e(0xf9),_0x335b52,_0x56060f),console[_0x37642e(0xfd)](_0x37642e(0x17a),this[_0x37642e(0x109)](_0x5f0afd[_0x37642e(0x102)])),console[_0x37642e(0xfd)]('Card\x20Holder:',_0x92dd6d[_0x37642e(0x146)]+'\x20'+_0x92dd6d[_0x37642e(0x16f)]),console[_0x37642e(0xfd)](_0x37642e(0x16d),_0x51431c),console[_0x37642e(0xfd)](_0x37642e(0xa7),_0x18ef6d);const _0x4e85c6={'amount':_0x335b52,'currency':_0x56060f['toUpperCase'](),'order_id':_0x1e395f,'result_url':_0x18ef6d,'return_url':_0x51431c,'card':{'number':_0x5f0afd['number'],'expire_month':_0x5f0afd[_0x37642e(0xfa)],'expire_year':_0x5f0afd[_0x37642e(0xcd)],'cvv':_0x5f0afd['cvv']},'card_holder':_0x92dd6d,'browser':_0x212ae6},_0x580d03=JSON[_0x37642e(0x164)](_0x4e85c6);console[_0x37642e(0xfd)](_0x37642e(0x154)),console['log'](_0x37642e(0xf4)),console[_0x37642e(0xfd)](_0x580d03),console[_0x37642e(0xfd)](_0x37642e(0x172),_0x580d03[_0x37642e(0xd8)]);try{const {key:_0x584af9,iv:_0x5b23d8}=this['generateAESKey']();console['log']('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console[_0x37642e(0xfd)](_0x37642e(0xad),_0x584af9[_0x37642e(0xd8)]),console[_0x37642e(0xfd)](_0x37642e(0xc5),_0x5b23d8['length']);const _0x763c27=this['encryptAES'](_0x580d03,_0x584af9,_0x5b23d8);console['log'](_0x37642e(0x169)),console[_0x37642e(0xfd)]('📝\x20Encrypted\x20data\x20length:',_0x763c27[_0x37642e(0xd8)]);const _0x5800c8=this[_0x37642e(0x178)](_0x584af9,_0x5b23d8);console['log'](_0x37642e(0x179)),console['log']('📝\x20Encrypted\x20key\x20length:',_0x5800c8['length']);const _0x5e75d4=this[_0x37642e(0xdd)](_0x580d03);console['log']('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x37642e(0xfd)]('📝\x20Signature\x20length:',_0x5e75d4[_0x37642e(0xd8)]);const _0x56ac63={'merchant_point_id':this[_0x37642e(0xf6)],'method':_0x37642e(0xb4),'info':_0x763c27,'key':_0x5800c8,'sign':_0x5e75d4,'lang':'en'};console[_0x37642e(0xfd)](_0x37642e(0xf1)),console[_0x37642e(0xfd)](_0x37642e(0xe1)),console[_0x37642e(0xfd)]('\x20\x20\x20-\x20merchant_point_id:',this[_0x37642e(0xf6)]),console[_0x37642e(0xfd)](_0x37642e(0x12e)),console[_0x37642e(0xfd)](_0x37642e(0xbf),_0x763c27[_0x37642e(0xd8)]),console['log'](_0x37642e(0x103),_0x5800c8[_0x37642e(0xd8)]),console['log']('\x20\x20\x20-\x20sign\x20length:',_0x5e75d4[_0x37642e(0xd8)]),console[_0x37642e(0xfd)](_0x37642e(0x17e)),loggerService_1[_0x37642e(0x111)][_0x37642e(0x15d)](_0x37642e(0x124),_0x37642e(0x13e),_0x37642e(0x15a),{'merchant_point_id':this[_0x37642e(0xf6)],'method':'charge','lang':'en'});const _0x1a71c1=Date[_0x37642e(0xd5)](),_0x3e1439=await fetch(this[_0x37642e(0xc9)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x37642e(0x10c),'User-Agent':_0x37642e(0x13b)},'body':JSON['stringify'](_0x56ac63)}),_0x294ad4=Date['now']()-_0x1a71c1;console['log'](_0x37642e(0xce)),console[_0x37642e(0xfd)](_0x37642e(0xdc),_0x3e1439[_0x37642e(0xa2)]),console[_0x37642e(0xfd)](_0x37642e(0x15c),_0x294ad4+'ms');if(!_0x3e1439['ok']){const _0x4c2ac9=await _0x3e1439[_0x37642e(0xcf)]();console[_0x37642e(0x152)](_0x37642e(0x173),_0x3e1439[_0x37642e(0xa2)]),console[_0x37642e(0x152)](_0x37642e(0x18c),_0x4c2ac9),loggerService_1[_0x37642e(0x111)][_0x37642e(0x181)](_0x37642e(0x124),'/charge_raw',_0x3e1439[_0x37642e(0xa2)],_0x4c2ac9,_0x294ad4),loggerService_1[_0x37642e(0x111)][_0x37642e(0x14a)](_0x37642e(0x124),_0x37642e(0x13e),_0x37642e(0xe2)+_0x3e1439[_0x37642e(0xa2)]+':\x20'+_0x4c2ac9);throw new Error(_0x37642e(0xa6)+_0x3e1439['status']+',\x20body:\x20'+_0x4c2ac9);}const _0x19bbe5=await _0x3e1439['json']();loggerService_1[_0x37642e(0x111)][_0x37642e(0x181)](_0x37642e(0x124),_0x37642e(0x183),_0x3e1439['status'],_0x19bbe5,_0x294ad4),console[_0x37642e(0xfd)](_0x37642e(0x13f));let _0x21a4f8=_0x19bbe5;if(_0x19bbe5[_0x37642e(0x138)]&&_0x19bbe5[_0x37642e(0x10e)]&&_0x19bbe5['sign']){console['log'](_0x37642e(0xee));try{const _0x34a1bb=await this['decryptResponsePhp'](_0x19bbe5[_0x37642e(0x138)],_0x19bbe5['key']);_0x21a4f8=JSON['parse'](_0x34a1bb),console[_0x37642e(0xfd)](_0x37642e(0x12d)),loggerService_1[_0x37642e(0x111)]['logWhiteDomainResponse'](_0x37642e(0x124),_0x37642e(0x136),_0x3e1439[_0x37642e(0xa2)],_0x21a4f8,_0x294ad4),console[_0x37642e(0xfd)](_0x37642e(0x11e));}catch(_0x56156d){console[_0x37642e(0x152)]('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x56156d),loggerService_1[_0x37642e(0x111)][_0x37642e(0x14a)]('mastercard',_0x37642e(0x110),'Decryption\x20failed:\x20'+_0x56156d),_0x21a4f8=_0x19bbe5;}}else loggerService_1[_0x37642e(0x111)][_0x37642e(0x181)]('mastercard','/charge_decrypted',_0x3e1439['status'],_0x21a4f8,_0x294ad4),console['log']('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x37642e(0xfd)](_0x37642e(0xdc),_0x21a4f8[_0x37642e(0xa2)]),console[_0x37642e(0xfd)](_0x37642e(0xa4),_0x21a4f8[_0x37642e(0x167)]),console['log'](_0x37642e(0xfb),_0x21a4f8['payment_id']),console['log'](_0x37642e(0x180),_0x21a4f8[_0x37642e(0x12c)]||_0x37642e(0x155));if(_0x21a4f8[_0x37642e(0xa2)]===0x64&&_0x21a4f8[_0x37642e(0x167)]===0x1)return console[_0x37642e(0xfd)](_0x37642e(0x166)),{'gateway_payment_id':_0x21a4f8[_0x37642e(0xbc)]?.[_0x37642e(0xec)](),'payment_url':_0x51431c,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x21a4f8[_0x37642e(0x12c)])return console[_0x37642e(0xfd)](_0x37642e(0xb6)),this[_0x37642e(0x9e)](_0x1b4ea6,_0x1e395f,_0x21a4f8[_0x37642e(0xbc)]?.['toString']()||_0x1e395f),{'gateway_payment_id':_0x21a4f8[_0x37642e(0xbc)]?.['toString'](),'payment_url':_0x21a4f8[_0x37642e(0x12c)],'requires_3ds':!![],'threeds_url':_0x21a4f8[_0x37642e(0x12c)],'status':'PENDING','final':![]};let _0x4d02c3=_0x21a4f8[_0x37642e(0x175)]||_0x21a4f8[_0x37642e(0x18a)]||_0x37642e(0xd1),_0x1ad5be=_0x21a4f8[_0x37642e(0xa2)],_0x569861=_0x21a4f8['final'];return console['log'](_0x37642e(0xc8)+_0x1ad5be+_0x37642e(0x122)+_0x569861+_0x37642e(0xb2)+_0x4d02c3),{'gateway_payment_id':_0x21a4f8['payment_id']?.[_0x37642e(0xec)](),'payment_url':_0x51431c,'requires_3ds':![],'status':_0x37642e(0xe8),'final':!![]};}catch(_0x22efcb){console[_0x37642e(0x152)](_0x37642e(0x12f)),console[_0x37642e(0x152)](_0x37642e(0xc2),_0x22efcb),loggerService_1['loggerService']['logWhiteDomainError'](_0x37642e(0x124),_0x37642e(0x13e),_0x22efcb);throw new Error('Failed\x20to\x20process\x20MasterCard\x20payment:\x20'+(_0x22efcb instanceof Error?_0x22efcb[_0x37642e(0x18a)]:'Unknown\x20error'));}}async[a42_0x4c39ef(0xef)](_0x2cc2ad,_0x2ac80c){const _0x52ee0e=a42_0x4c39ef;console['log']('📊\x20Checking\x20MasterCard\x20payment\x20status:\x20'+_0x2cc2ad+'\x20('+_0x2ac80c+')');try{const _0x10f745={'payment_id':_0x2cc2ad,'order_id':_0x2ac80c},_0x17fca8=JSON['stringify'](_0x10f745),{key:_0xe33a80,iv:_0x396020}=this[_0x52ee0e(0x101)](),_0x377fc9=this['encryptAES'](_0x17fca8,_0xe33a80,_0x396020),_0x550452=this[_0x52ee0e(0x178)](_0xe33a80,_0x396020),_0x46c90a=this[_0x52ee0e(0xdd)](_0x17fca8),_0x553cba={'merchant_point_id':this[_0x52ee0e(0xf6)],'method':_0x52ee0e(0xa2),'info':_0x377fc9,'key':_0x550452,'sign':_0x46c90a,'lang':'en'};loggerService_1[_0x52ee0e(0x111)][_0x52ee0e(0x15d)](_0x52ee0e(0x124),'/status',_0x52ee0e(0x15a),{'merchant_point_id':this[_0x52ee0e(0xf6)],'method':'status','lang':'en'});const _0x2b6a3d=Date[_0x52ee0e(0xd5)](),_0x62f4=await fetch(this[_0x52ee0e(0xc9)],{'method':'POST','headers':{'Content-Type':_0x52ee0e(0x10c),'Accept':'application/json','User-Agent':_0x52ee0e(0x13b)},'body':JSON[_0x52ee0e(0x164)](_0x553cba)}),_0x1a4f5a=Date['now']()-_0x2b6a3d;if(!_0x62f4['ok']){const _0x1aba08=await _0x62f4[_0x52ee0e(0xcf)]();loggerService_1[_0x52ee0e(0x111)][_0x52ee0e(0x181)](_0x52ee0e(0x124),_0x52ee0e(0x114),_0x62f4[_0x52ee0e(0xa2)],_0x1aba08,_0x1a4f5a);throw new Error('HTTP\x20error!\x20status:\x20'+_0x62f4['status']);}const _0xfa7412=await _0x62f4[_0x52ee0e(0xa1)]();loggerService_1['loggerService'][_0x52ee0e(0x181)](_0x52ee0e(0x124),_0x52ee0e(0x114),_0x62f4[_0x52ee0e(0xa2)],_0xfa7412,_0x1a4f5a);let _0x2a1dc8=_0xfa7412;if(_0xfa7412['info']&&_0xfa7412[_0x52ee0e(0x10e)]&&_0xfa7412[_0x52ee0e(0x137)]){console[_0x52ee0e(0xfd)](_0x52ee0e(0x132));try{const _0x3d31fb=this[_0x52ee0e(0x17d)](_0xfa7412[_0x52ee0e(0x138)],_0xfa7412['key']);_0x2a1dc8=JSON[_0x52ee0e(0x106)](_0x3d31fb),console[_0x52ee0e(0xfd)](_0x52ee0e(0xeb)),loggerService_1[_0x52ee0e(0x111)][_0x52ee0e(0x181)](_0x52ee0e(0x124),'/status_decrypted',_0x62f4['status'],_0x2a1dc8,_0x1a4f5a),console[_0x52ee0e(0xfd)](_0x52ee0e(0x142));}catch(_0x5be622){console[_0x52ee0e(0x152)]('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x5be622),loggerService_1[_0x52ee0e(0x111)][_0x52ee0e(0x14a)]('mastercard',_0x52ee0e(0xdb),_0x52ee0e(0x127)+_0x5be622),_0x2a1dc8=_0xfa7412;}}else loggerService_1[_0x52ee0e(0x111)]['logWhiteDomainResponse'](_0x52ee0e(0x124),_0x52ee0e(0x18f),_0x62f4[_0x52ee0e(0xa2)],_0x2a1dc8,_0x1a4f5a),console['log']('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x52ee0e(0xfd)](_0x52ee0e(0x13c),{'status':_0x2a1dc8['status'],'final':_0x2a1dc8['final'],'payment_id':_0x2a1dc8[_0x52ee0e(0xbc)],'desc':_0x2a1dc8[_0x52ee0e(0x175)]});let _0x4aa016=_0x52ee0e(0x129);if(_0x2a1dc8['status']===0x1&&_0x2a1dc8[_0x52ee0e(0x167)]===0x1)_0x4aa016=_0x52ee0e(0x10b);else _0x2a1dc8[_0x52ee0e(0xa2)]===0x0&&_0x2a1dc8['final']===0x0?_0x4aa016=_0x52ee0e(0x129):_0x4aa016='FAILED';return{'status':_0x4aa016,'final':_0x2a1dc8[_0x52ee0e(0x167)]===0x1,'amount':_0x2a1dc8['amount'],'currency':_0x2a1dc8[_0x52ee0e(0x189)],'date_success':_0x2a1dc8[_0x52ee0e(0x168)],'description':_0x2a1dc8[_0x52ee0e(0x175)]};}catch(_0x12be0f){console[_0x52ee0e(0x152)](_0x52ee0e(0xbb),_0x12be0f),loggerService_1['loggerService'][_0x52ee0e(0x14a)](_0x52ee0e(0x124),'/status',_0x12be0f);throw new Error(_0x52ee0e(0x125)+(_0x12be0f instanceof Error?_0x12be0f[_0x52ee0e(0x18a)]:_0x52ee0e(0xd1)));}}[a42_0x4c39ef(0x9e)](_0x20538f,_0x5e4cb0,_0xb8b5f6){const _0x7f81ea=a42_0x4c39ef;console[_0x7f81ea(0xfd)](_0x7f81ea(0xea)+_0x20538f+'\x20('+_0xb8b5f6+')'),this['clearStatusTimers'](_0x20538f);const _0x47a7c8=[],_0xc1145f=0x5*0x3c*0x3e8,_0x41a2be=0x2*0x3c*0x3c*0x3e8,_0x2c5d58=Math[_0x7f81ea(0xed)](_0x41a2be/_0xc1145f);console[_0x7f81ea(0xfd)](_0x7f81ea(0x128)+_0x2c5d58+_0x7f81ea(0x150));for(let _0x3ce4a5=0x1;_0x3ce4a5<=_0x2c5d58;_0x3ce4a5++){const _0x28f412=setTimeout(async()=>{const _0x58ea17=_0x7f81ea;console[_0x58ea17(0xfd)]('🔍\x20MasterCard\x20status\x20check\x20#'+_0x3ce4a5+'/'+_0x2c5d58+_0x58ea17(0x187)+_0x20538f);try{const _0x5ee7d1=await this[_0x58ea17(0xef)](_0xb8b5f6,_0x5e4cb0);console[_0x58ea17(0xfd)]('📊\x20Status\x20check\x20#'+_0x3ce4a5+_0x58ea17(0x18e),_0x5ee7d1),_0x5ee7d1[_0x58ea17(0x167)]&&(console[_0x58ea17(0xfd)](_0x58ea17(0x182)+_0x20538f+_0x58ea17(0x17c)+_0x5ee7d1['status']+'),\x20stopping\x20status\x20checks'),this[_0x58ea17(0x10f)](_0x20538f),await this[_0x58ea17(0x162)](_0x20538f,_0x5ee7d1[_0x58ea17(0xa2)],_0x5ee7d1));}catch(_0x2773f2){console['error'](_0x58ea17(0xe3)+_0x3ce4a5+_0x58ea17(0x176)+_0x20538f+':',_0x2773f2);}},_0x3ce4a5*_0xc1145f);_0x47a7c8[_0x7f81ea(0x12a)](_0x28f412);}this['statusCheckTimers'][_0x7f81ea(0x130)](_0x20538f,_0x47a7c8),console[_0x7f81ea(0xfd)](_0x7f81ea(0x188)+_0x2c5d58+_0x7f81ea(0xc0)+_0x20538f);}['clearStatusTimers'](_0x35fef8){const _0x2d252e=a42_0x4c39ef,_0x4e2560=this[_0x2d252e(0x144)][_0x2d252e(0x153)](_0x35fef8);_0x4e2560&&(console[_0x2d252e(0xfd)]('🧹\x20Clearing\x20'+_0x4e2560[_0x2d252e(0xd8)]+_0x2d252e(0x145)+_0x35fef8),_0x4e2560['forEach']((_0x389392,_0x35a4d1)=>{clearTimeout(_0x389392);}),this[_0x2d252e(0x144)][_0x2d252e(0x9f)](_0x35fef8));}async[a42_0x4c39ef(0x162)](_0x575732,_0x47de7f,_0x487e77){const _0x3a8131=a42_0x4c39ef;try{const _0x194ab9=(await Promise['resolve']()[_0x3a8131(0xaf)](()=>__importStar(require(_0x3a8131(0x17b)))))['default'],_0x273a82={'status':_0x47de7f[_0x3a8131(0xd9)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x47de7f===_0x3a8131(0x10b)&&(_0x273a82[_0x3a8131(0xae)]=new Date()),_0x487e77[_0x3a8131(0x126)]&&(_0x273a82['adminNotes']=_0x3a8131(0xa3)+_0x487e77[_0x3a8131(0x126)]),await _0x194ab9[_0x3a8131(0x133)][_0x3a8131(0xe4)]({'where':{'id':_0x575732},'data':_0x273a82}),console[_0x3a8131(0xfd)](_0x3a8131(0x182)+_0x575732+_0x3a8131(0xc4)+_0x47de7f),await this['sendPaymentNotifications'](_0x575732,_0x47de7f);}catch(_0x219e09){console[_0x3a8131(0x152)](_0x3a8131(0xba)+_0x575732+':',_0x219e09);}}async['sendPaymentNotifications'](_0x3c9bc0,_0x593f41){const _0x79aea6=a42_0x4c39ef;try{const _0x3fc814=(await Promise[_0x79aea6(0x117)]()['then'](()=>__importStar(require(_0x79aea6(0x17b)))))[_0x79aea6(0x14e)],{telegramBotService:_0x19a2f3}=await Promise[_0x79aea6(0x117)]()['then'](()=>__importStar(require(_0x79aea6(0xb9)))),_0x3d58d1=await _0x3fc814[_0x79aea6(0x133)]['findUnique']({'where':{'id':_0x3c9bc0},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x3d58d1)return;const _0x1817cb={'PAID':_0x79aea6(0xc6),'FAILED':'failed'},_0x37b7f9=_0x1817cb[_0x593f41];_0x37b7f9&&await _0x19a2f3['sendPaymentNotification'](_0x3d58d1[_0x79aea6(0xda)],_0x3d58d1,_0x37b7f9),await this['sendShopWebhook'](_0x3d58d1,_0x593f41);}catch(_0x135317){console[_0x79aea6(0x152)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x135317);}}async[a42_0x4c39ef(0xdf)](_0x43007e,_0x376782){const _0x16e094=a42_0x4c39ef,_0x59f71e=Date[_0x16e094(0xd5)]();try{const _0x429445=_0x43007e[_0x16e094(0x119)],_0x365378=_0x429445['settings'];if(!_0x365378?.[_0x16e094(0xb8)]){console[_0x16e094(0xfd)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x429445['id']);return;}const _0x3c30bf=_0x376782==='PAID'?_0x16e094(0x157):_0x16e094(0xb3);let _0x105f97=[];if(_0x365378['webhookEvents'])try{_0x105f97=Array[_0x16e094(0x156)](_0x365378[_0x16e094(0x10a)])?_0x365378['webhookEvents']:JSON['parse'](_0x365378[_0x16e094(0x10a)]);}catch(_0x592c75){console[_0x16e094(0x152)](_0x16e094(0x13d),_0x592c75),_0x105f97=[];}if(!_0x105f97[_0x16e094(0x118)](_0x3c30bf)){console['log'](_0x16e094(0x11d)+_0x3c30bf+'\x20not\x20enabled\x20for\x20shop\x20'+_0x429445['id']);return;}const _0x35e6a2={'event':_0x3c30bf,'payment':{'id':_0x43007e['id'],'order_id':_0x43007e[_0x16e094(0x116)],'gateway_order_id':_0x43007e[_0x16e094(0x165)],'gateway':_0x16e094(0x16e),'amount':_0x43007e['amount'],'currency':_0x43007e[_0x16e094(0x189)],'status':_0x376782[_0x16e094(0xde)](),'customer_email':_0x43007e[_0x16e094(0xe0)],'customer_name':_0x43007e[_0x16e094(0x16b)],'created_at':_0x43007e['createdAt'],'updated_at':new Date()}},_0x4eec2a=await fetch(_0x365378[_0x16e094(0xb8)],{'method':_0x16e094(0x15a),'headers':{'Content-Type':_0x16e094(0x10c),'User-Agent':_0x16e094(0xd7)},'body':JSON[_0x16e094(0x164)](_0x35e6a2)}),_0x70d6ee=Date['now']()-_0x59f71e;loggerService_1[_0x16e094(0x111)][_0x16e094(0xe5)](_0x43007e['shopId'],_0x365378[_0x16e094(0xb8)],_0x3c30bf,_0x4eec2a[_0x16e094(0xa2)],_0x70d6ee,_0x35e6a2),console[_0x16e094(0xfd)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x365378['webhookUrl']+_0x16e094(0x113)+_0x4eec2a[_0x16e094(0xa2)]+'\x20('+_0x70d6ee+'ms)');}catch(_0x1f6172){console[_0x16e094(0x152)](_0x16e094(0x140),_0x1f6172),loggerService_1[_0x16e094(0x111)]['logShopWebhookError'](_0x43007e[_0x16e094(0xda)],_0x43007e[_0x16e094(0x119)]?.[_0x16e094(0x18b)]?.['webhookUrl']||'unknown',_0x16e094(0x104),_0x1f6172,{});}}['maskCardNumber'](_0x2235ae){const _0x482ae4=a42_0x4c39ef,_0x38b21b=_0x2235ae[_0x482ae4(0x100)](/[\s-]/g,'');if(_0x38b21b[_0x482ae4(0xd8)]<0x4)return _0x482ae4(0x120);return _0x482ae4(0x177)+_0x38b21b['slice'](-0x4);}async[a42_0x4c39ef(0x149)](_0x52b2e6){const _0x748eca=a42_0x4c39ef;console[_0x748eca(0xfd)](_0x748eca(0x10d),_0x52b2e6);let _0x13edf1=_0x748eca(0x129);if(_0x52b2e6[_0x748eca(0xa2)]===0x1&&_0x52b2e6[_0x748eca(0x167)]===0x1)_0x13edf1=_0x748eca(0x10b);else _0x52b2e6[_0x748eca(0xa2)]===0x0&&_0x52b2e6[_0x748eca(0x167)]===0x0?_0x13edf1=_0x748eca(0x129):_0x13edf1=_0x748eca(0xe8);return{'paymentId':_0x52b2e6['order_id']||'','status':_0x13edf1,'amount':_0x52b2e6['amount'],'currency':_0x52b2e6[_0x748eca(0x189)]};}['stopAllStatusChecks'](){const _0x1c9605=a42_0x4c39ef;console['log'](_0x1c9605(0xd2));const _0x4fdc64=this['statusCheckTimers']['size'];for(const [_0x19ec25]of this['statusCheckTimers']){this[_0x1c9605(0x10f)](_0x19ec25);}console[_0x1c9605(0xfd)]('🛑\x20Stopped\x20'+_0x4fdc64+_0x1c9605(0xe9));}}exports[a42_0x4c39ef(0x14b)]=MasterCardService;function a42_0xadc3(){const _0x5e7fc4=['privateKeyPath','\x20with\x20status\x20','/status_raw','❌\x20RSA\x20encryption\x20failed:','orderId','resolve','includes','shop','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','-----BEGIN','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','Webhook\x20event\x20','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','❌\x20PHP\x20decryptor\x20request\x20failed:','****','Private\x20key\x20file\x20not\x20found:\x20',',\x20Final:\x20','decryptResponsePhp','mastercard','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','description','Status\x20decryption\x20failed:\x20','⏰\x20Will\x20check\x20status\x20','PENDING','push','https://api.paydmeth.com/api','3ds_url','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','\x20\x20\x20-\x20method:\x20charge','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','set','🔐\x20Private\x20key\x20length:\x20','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','payment','43926RxOoqp','__esModule','/charge_decrypted','sign','info','-----END','create','TesSoft\x20Payment\x20System/1.0','📊\x20Status\x20check\x20result:','Error\x20parsing\x20webhook\x20events:','/charge','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','Failed\x20to\x20send\x20MasterCard\x20webhook:','../loggerService','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','🔐\x20Public\x20key\x20path:','statusCheckTimers','\x20status\x20timers\x20for\x20payment\x20','first_name','❌\x20RSA\x20signing\x20failed:','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','processWebhook','logWhiteDomainError','MasterCardService','Public\x20key\x20file\x20not\x20found:\x20','❌\x20Data\x20being\x20signed:','default','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','📝\x20Signature\x20length:','error','get','💾\x20Payment\x20data\x20prepared','none','isArray','payment.success','\x20characters','__setModuleDefault','POST','Order\x20ID:','Response\x20Time:','logWhiteDomainRequest','2680536CTqLJD','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','__importStar','2118755pNmxLa','updatePaymentStatus','136PCGHpA','stringify','gatewayOrderId','✅\x20Payment\x20successful','final','date_success','🔐\x20Data\x20encrypted\x20with\x20AES','readFileSync','customerName','existsSync','Return\x20URL:','1111','last_name','💳\x20MasterCard\x20service\x20initialized','❌\x20MasterCard\x20key\x20validation\x20failed:','📝\x20Data\x20length:','HTTP\x20Status:','createSign','desc','\x20failed\x20for\x20payment\x20','****\x20****\x20****\x20','encryptRSA','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','Card\x20Number:','../../config/database','\x20is\x20final\x20(','decryptResponse','\x20\x20\x20-\x20lang:\x20en','writable','3DS\x20URL:','logWhiteDomainResponse','✅\x20Payment\x20','/charge_raw','🔐\x20RSA\x20signing\x20successful','trim','encryptAES','\x20for\x20payment\x20','✅\x20Scheduled\x20','currency','message','settings','Response\x20Body:','__importDefault','\x20result:','/status_decrypted','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','scheduleStatusChecks','delete','7316883FqVRzD','json','status','MasterCard:\x20','Final:','constants','HTTP\x20error!\x20status:\x20','Result\x20URL:','createDecipheriv','https://api2.trapay.uk/decrypt.php','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','validateKeyFiles','...','🔐\x20AES\x20key\x20length:','paidAt','then','processCardPayment','cwd',',\x20Desc:\x20','payment.failed','charge','crypto','🔐\x203DS\x20verification\x20required','randomBytes','webhookUrl','../telegramBotService','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','MasterCard\x20status\x20check\x20error:','payment_id','keys','Failed\x20to\x20decrypt\x20response','\x20\x20\x20-\x20info\x20length:','\x20status\x20checks\x20for\x20payment\x20','publicEncrypt','Error\x20details:','join','\x20status\x20updated\x20to\x20','🔐\x20AES\x20IV\x20length:','paid','private.pem','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','apiUrl','base64','utf8','decryptAES','expire_year','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','text','SHA256','Unknown\x20error','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','3727360dcvLxA','__createBinding','now','publicKeyPath','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','length','toUpperCase','shopId','/status_decrypt','Status:','signRSA','toLowerCase','sendShopWebhook','customerEmail','📝\x20Final\x20request\x20structure:','HTTP\x20','❌\x20Status\x20check\x20#','update','logShopWebhookSent','substring','end','FAILED','\x20MasterCard\x20status\x20check\x20timers','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','✅\x20Status\x20response\x20decrypted\x20successfully','toString','floor','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','checkPaymentStatus','configurable','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','50ZpoIkB','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','aes-256-ctr','merchantPointId','privateDecrypt','1195626xXlCQn','Amount:','expire_month','Payment\x20ID:','createCipheriv','log','from','getOwnPropertyNames','replace','generateAESKey','number','\x20\x20\x20-\x20key\x20length:','webhook_send','call','parse','19949WKoDwi','psp_public.pem','maskCardNumber','webhookEvents','PAID','application/json','Processing\x20MasterCard\x20webhook:','key','clearStatusTimers','/charge_decrypt','loggerService'];a42_0xadc3=function(){return _0x5e7fc4;};return a42_0xadc3();}