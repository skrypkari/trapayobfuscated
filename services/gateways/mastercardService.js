'use strict';const a42_0x2a5d16=a42_0x1546;(function(_0x3b48f4,_0x357756){const _0x31256f=a42_0x1546,_0x1e7e59=_0x3b48f4();while(!![]){try{const _0x2133e0=parseInt(_0x31256f(0x16e))/0x1*(parseInt(_0x31256f(0x1bb))/0x2)+-parseInt(_0x31256f(0x15b))/0x3+parseInt(_0x31256f(0x17a))/0x4*(parseInt(_0x31256f(0x1f0))/0x5)+-parseInt(_0x31256f(0x162))/0x6+parseInt(_0x31256f(0x104))/0x7+-parseInt(_0x31256f(0x18a))/0x8*(-parseInt(_0x31256f(0x1db))/0x9)+-parseInt(_0x31256f(0x176))/0xa;if(_0x2133e0===_0x357756)break;else _0x1e7e59['push'](_0x1e7e59['shift']());}catch(_0x4fdff3){_0x1e7e59['push'](_0x1e7e59['shift']());}}}(a42_0x3f07,0xad923));function a42_0x1546(_0x3181c9,_0x33856f){const _0x3f0794=a42_0x3f07();return a42_0x1546=function(_0x154650,_0x491729){_0x154650=_0x154650-0x100;let _0x55f661=_0x3f0794[_0x154650];return _0x55f661;},a42_0x1546(_0x3181c9,_0x33856f);}var __createBinding=this&&this[a42_0x2a5d16(0x1ea)]||(Object[a42_0x2a5d16(0x1cf)]?function(_0x3ae4c8,_0x2a5412,_0x4234de,_0xa66804){const _0x4c990d=a42_0x2a5d16;if(_0xa66804===undefined)_0xa66804=_0x4234de;var _0x30a195=Object[_0x4c990d(0x101)](_0x2a5412,_0x4234de);(!_0x30a195||(_0x4c990d(0x131)in _0x30a195?!_0x2a5412[_0x4c990d(0x167)]:_0x30a195[_0x4c990d(0x1b2)]||_0x30a195[_0x4c990d(0x1cc)]))&&(_0x30a195={'enumerable':!![],'get':function(){return _0x2a5412[_0x4234de];}}),Object['defineProperty'](_0x3ae4c8,_0xa66804,_0x30a195);}:function(_0x4edd29,_0x1f560b,_0xa568ba,_0x15da29){if(_0x15da29===undefined)_0x15da29=_0xa568ba;_0x4edd29[_0x15da29]=_0x1f560b[_0xa568ba];}),__setModuleDefault=this&&this[a42_0x2a5d16(0x1be)]||(Object[a42_0x2a5d16(0x1cf)]?function(_0x4df624,_0x2fba44){const _0xa7567e=a42_0x2a5d16;Object['defineProperty'](_0x4df624,_0xa7567e(0x11f),{'enumerable':!![],'value':_0x2fba44});}:function(_0x475e68,_0x3aee69){const _0x5e57c8=a42_0x2a5d16;_0x475e68[_0x5e57c8(0x11f)]=_0x3aee69;}),__importStar=this&&this[a42_0x2a5d16(0x19d)]||(function(){var _0x3876a9=function(_0x18271c){const _0x4b1051=a42_0x1546;return _0x3876a9=Object[_0x4b1051(0x1e6)]||function(_0xa61f67){const _0x532a2d=_0x4b1051;var _0x3c3324=[];for(var _0xa95b82 in _0xa61f67)if(Object['prototype'][_0x532a2d(0x1a2)][_0x532a2d(0x129)](_0xa61f67,_0xa95b82))_0x3c3324[_0x3c3324[_0x532a2d(0x157)]]=_0xa95b82;return _0x3c3324;},_0x3876a9(_0x18271c);};return function(_0x5e8950){const _0x5e3ac2=a42_0x1546;if(_0x5e8950&&_0x5e8950[_0x5e3ac2(0x167)])return _0x5e8950;var _0xf71cc1={};if(_0x5e8950!=null){for(var _0x5be446=_0x3876a9(_0x5e8950),_0x54a78a=0x0;_0x54a78a<_0x5be446[_0x5e3ac2(0x157)];_0x54a78a++)if(_0x5be446[_0x54a78a]!==_0x5e3ac2(0x11f))__createBinding(_0xf71cc1,_0x5e8950,_0x5be446[_0x54a78a]);}return __setModuleDefault(_0xf71cc1,_0x5e8950),_0xf71cc1;};}()),__importDefault=this&&this[a42_0x2a5d16(0x19b)]||function(_0x15970a){const _0x7d1c56=a42_0x2a5d16;return _0x15970a&&_0x15970a[_0x7d1c56(0x167)]?_0x15970a:{'default':_0x15970a};};Object[a42_0x2a5d16(0x119)](exports,a42_0x2a5d16(0x167),{'value':!![]}),exports[a42_0x2a5d16(0x1d5)]=void 0x0;function a42_0x3f07(){const _0x254565=['Status:','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','error','resolve','❌\x20PHP\x20decryptor\x20request\x20failed:','validateKeyFiles','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','replace','MasterCard\x20webhook\x20sent\x20to\x20','../../config/database','floor','isArray','📝\x20Data\x20length:','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','/status_raw','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','/status','toUpperCase','🔐\x20AES\x20key\x20and\x20IV\x20generated','),\x20stopping\x20status\x20checks','Failed\x20to\x20send\x20payment\x20notifications:','payment.failed',',\x20Final:\x20','createSign','length','now','final','description','814566PGiESy','...','🔐\x20Public\x20key\x20length:\x20','generateAESKey','POST','trim','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','4953972TmCSlm','publicEncrypt','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','createCipheriv','constants','__esModule','PENDING','toString','sendShopWebhook','size','customerEmail','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','87973PigjCv','Processing\x20MasterCard\x20webhook:','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','🔍\x20MasterCard\x20status\x20check\x20#','expire_month','gatewayOrderId','base64','🔐\x20Private\x20key\x20path:','1796230BeDAHw','Status\x20decryption\x20failed:\x20','https://api2.trapay.uk/decrypt.php','HTTP\x20','84244lDcxVq','🛑\x20Stopped\x20','json','encryptRSA','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',',\x20body:\x20','🔐\x20AES\x20IV\x20length:','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','logWhiteDomainResponse','orderId','processWebhook','updatePaymentStatus','/status_decrypt','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','sendPaymentNotification','Payment\x20ID:','408968OSrmOk','Webhook\x20event\x20','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','then','webhookUrl','\x20for\x20payment\x20','📝\x20Encrypted\x20data\x20length:','Error\x20parsing\x20webhook\x20events:','info','Card\x20Holder:','createdAt','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','TesSoft\x20Payment\x20System/1.0','logShopWebhookError','cvv','status','text','__importDefault','\x20MasterCard\x20status\x20check\x20timers','__importStar','merchantPointId','🔐\x20Data\x20encrypted\x20with\x20AES','🧹\x20Clearing\x20','payment.success','hasOwnProperty','PHP\x20decryptor\x20error','createDecipheriv','Private\x20key\x20file\x20not\x20found:\x20','sendPaymentNotifications','Unknown\x20error','✅\x20Payment\x20successful','../loggerService','decryptResponsePhp','signRSA','/charge_decrypted','application/json','../telegramBotService','🔐\x20RSA\x20signing\x20successful','processCardPayment','/charge_raw','writable','sign','\x20not\x20enabled\x20for\x20shop\x20','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','logShopWebhookSent','PAID','cwd','Public\x20key\x20file\x20not\x20found:\x20','stopAllStatusChecks','6yEeYDL','privateKeyPath','desc','__setModuleDefault','date_success','3ds_url','webhook_send','MasterCard\x20status\x20check\x20error:','paid','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','update','clearStatusTimers','3DS\x20URL:','Result\x20URL:','findUnique','stringify','configurable','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','❌\x20Data\x20being\x20signed:','create','end','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','https://api.paydmeth.com/api','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','set','MasterCardService','\x20status\x20checks\x20for\x20payment\x20','last_name','amount','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','207maEWaS','-----BEGIN','logWhiteDomainRequest','RSA_PKCS1_PADDING','✅\x20Payment\x20','Failed\x20to\x20send\x20MasterCard\x20webhook:','📝\x20Encrypted\x20key\x20length:','📝\x20Signature\x20length:','📝\x20Final\x20request\x20structure:','/status_decrypted','HTTP\x20error!\x20status:\x20','getOwnPropertyNames','adminNotes','scheduleStatusChecks','Failed\x20to\x20decrypt\x20response','__createBinding','payment','logWhiteDomainError','loggerService','mastercard','decryptResponse','115HaeMGs','✅\x20Scheduled\x20','-----END','🔐\x20Data\x20signed\x20with\x20RSA','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','none','****\x20****\x20****\x20','aes-256-ctr','webhookEvents','getOwnPropertyDescriptor','FAILED','shopId','445543vfpriF','MasterCard:\x20','parse','substring','/charge','📝\x20Data\x20to\x20sign\x20length:','publicKeyPath','join','forEach','⏰\x20Will\x20check\x20status\x20','message','payment_id','expire_year','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','maskCardNumber','apiUrl','randomBytes','HTTP\x20Status:','charge','existsSync','log','defineProperty','currency','readFileSync','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','❌\x20RSA\x20encryption\x20failed:','\x20failed\x20for\x20payment\x20','default','statusCheckTimers','🔐\x20Public\x20key\x20path:','Response\x20Time:','Card\x20Number:','\x20\x20\x20-\x20info\x20length:','\x20characters','from','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','Decryption\x20failed:\x20','call','path','settings','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','slice','\x20with\x20status\x20','privateDecrypt','order_id','get','ms)','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','first_name','decryptAES','utf8','key','number','includes','keys','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','/charge_decrypt','✅\x20Status\x20response\x20decrypted\x20successfully','customerName'];a42_0x3f07=function(){return _0x254565;};return a42_0x3f07();}const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x2a5d16(0x12a))),loggerService_1=require(a42_0x2a5d16(0x1a9));class MasterCardService{constructor(){const _0x1149ce=a42_0x2a5d16;this[_0x1149ce(0x120)]=new Map(),this[_0x1149ce(0x113)]=_0x1149ce(0x1d2),this[_0x1149ce(0x19e)]=0x67c,this[_0x1149ce(0x1bc)]=path_1[_0x1149ce(0x11f)][_0x1149ce(0x10b)](process[_0x1149ce(0x1b8)](),_0x1149ce(0x13a),'private.pem'),this[_0x1149ce(0x10a)]=path_1[_0x1149ce(0x11f)][_0x1149ce(0x10b)](process['cwd'](),_0x1149ce(0x13a),'psp_public.pem'),console['log']('💳\x20MasterCard\x20service\x20initialized'),console[_0x1149ce(0x118)](_0x1149ce(0x175),this['privateKeyPath']),console[_0x1149ce(0x118)](_0x1149ce(0x121),this[_0x1149ce(0x10a)]),this[_0x1149ce(0x144)]();}['validateKeyFiles'](){const _0x21226a=a42_0x2a5d16;try{if(!fs_1[_0x21226a(0x11f)][_0x21226a(0x117)](this['privateKeyPath']))throw new Error(_0x21226a(0x1a5)+this[_0x21226a(0x1bc)]);if(!fs_1['default'][_0x21226a(0x117)](this[_0x21226a(0x10a)]))throw new Error(_0x21226a(0x1b9)+this['publicKeyPath']);const _0x2474b9=fs_1['default'][_0x21226a(0x11b)](this[_0x21226a(0x1bc)],_0x21226a(0x136))[_0x21226a(0x160)](),_0x879db8=fs_1[_0x21226a(0x11f)][_0x21226a(0x11b)](this[_0x21226a(0x10a)],'utf8')[_0x21226a(0x160)]();if(!_0x2474b9['includes'](_0x21226a(0x1dc))||!_0x2474b9[_0x21226a(0x139)](_0x21226a(0x1f2)))throw new Error(_0x21226a(0x13b));if(!_0x879db8['includes'](_0x21226a(0x1dc))||!_0x879db8[_0x21226a(0x139)]('-----END'))throw new Error('Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x21226a(0x118)](_0x21226a(0x11c)),console['log']('🔐\x20Private\x20key\x20length:\x20'+_0x2474b9[_0x21226a(0x157)]+_0x21226a(0x125)),console[_0x21226a(0x118)](_0x21226a(0x15d)+_0x879db8[_0x21226a(0x157)]+_0x21226a(0x125));}catch(_0x32aea4){console[_0x21226a(0x141)]('❌\x20MasterCard\x20key\x20validation\x20failed:',_0x32aea4);throw _0x32aea4;}}[a42_0x2a5d16(0x15e)](){const _0x54855b=a42_0x2a5d16,_0x42e0f7=crypto_1[_0x54855b(0x11f)]['randomBytes'](0x20),_0x5ae47c=crypto_1[_0x54855b(0x11f)][_0x54855b(0x114)](0x10);return{'key':_0x42e0f7,'iv':_0x5ae47c};}['encryptAES'](_0x2ffb35,_0x1dadab,_0x3290da){const _0x52144b=a42_0x2a5d16,_0xe91585=crypto_1[_0x52144b(0x11f)][_0x52144b(0x165)](_0x52144b(0x1f7),_0x1dadab,_0x3290da);let _0x441854=_0xe91585[_0x52144b(0x1c6)](_0x2ffb35,_0x52144b(0x136),'base64');return _0x441854+=_0xe91585['final'](_0x52144b(0x174)),_0x441854;}['encryptRSA'](_0x818f7c,_0x4449e4){const _0x8b9f34=a42_0x2a5d16;try{const _0x19607e=fs_1[_0x8b9f34(0x11f)][_0x8b9f34(0x11b)](this[_0x8b9f34(0x10a)],'utf8')[_0x8b9f34(0x160)](),_0x4ce46f={'iv':_0x4449e4[_0x8b9f34(0x169)](_0x8b9f34(0x174)),'key':_0x818f7c[_0x8b9f34(0x169)](_0x8b9f34(0x174))},_0x425d64=JSON['stringify'](_0x4ce46f);console[_0x8b9f34(0x118)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x425d64[_0x8b9f34(0x157)]);const _0x1789a3=crypto_1[_0x8b9f34(0x11f)][_0x8b9f34(0x163)]({'key':_0x19607e,'padding':crypto_1['default'][_0x8b9f34(0x166)][_0x8b9f34(0x1de)]},Buffer['from'](_0x425d64));return console[_0x8b9f34(0x118)](_0x8b9f34(0x16d),_0x1789a3[_0x8b9f34(0x157)]),_0x1789a3['toString'](_0x8b9f34(0x174));}catch(_0x2d9c7f){console[_0x8b9f34(0x141)](_0x8b9f34(0x11d),_0x2d9c7f);throw new Error(_0x8b9f34(0x1da));}}[a42_0x2a5d16(0x1ab)](_0x14e623){const _0x29af8b=a42_0x2a5d16;try{const _0x12b66f=fs_1['default'][_0x29af8b(0x11b)](this[_0x29af8b(0x1bc)],_0x29af8b(0x136))[_0x29af8b(0x160)](),_0x14d6e6=crypto_1['default'][_0x29af8b(0x156)]('SHA256');_0x14d6e6['update'](_0x14e623),_0x14d6e6[_0x29af8b(0x1d0)]();const _0x8a5b55=_0x14d6e6[_0x29af8b(0x1b3)](_0x12b66f,_0x29af8b(0x174));return console[_0x29af8b(0x118)](_0x29af8b(0x1af)),console[_0x29af8b(0x118)](_0x29af8b(0x109),_0x14e623[_0x29af8b(0x157)]),console[_0x29af8b(0x118)](_0x29af8b(0x1e2),_0x8a5b55['length']),_0x8a5b55;}catch(_0x773c86){console[_0x29af8b(0x141)]('❌\x20RSA\x20signing\x20failed:',_0x773c86),console[_0x29af8b(0x141)](_0x29af8b(0x1ce),_0x14e623[_0x29af8b(0x107)](0x0,0xc8)+_0x29af8b(0x15c));throw new Error(_0x29af8b(0x133));}}['decryptAES'](_0x367b18,_0xa7af7d,_0x3303c7){const _0x43329d=a42_0x2a5d16,_0x31eb2f=crypto_1['default'][_0x43329d(0x1a4)]('aes-256-ctr',_0xa7af7d,_0x3303c7);let _0x3f507a=_0x31eb2f[_0x43329d(0x1c6)](_0x367b18,_0x43329d(0x174),_0x43329d(0x136));return _0x3f507a+=_0x31eb2f[_0x43329d(0x159)](_0x43329d(0x136)),_0x3f507a;}async[a42_0x2a5d16(0x1aa)](_0x163a45,_0x1612d9){const _0x21ea5a=a42_0x2a5d16;try{const _0x579c3f=await fetch(_0x21ea5a(0x178),{'method':_0x21ea5a(0x15f),'headers':{'Content-Type':'application/json'},'body':JSON[_0x21ea5a(0x1cb)]({'info':_0x163a45,'key':_0x1612d9})});if(!_0x579c3f['ok'])throw new Error(_0x21ea5a(0x1a3));return await _0x579c3f[_0x21ea5a(0x19a)]();}catch(_0x130da6){console[_0x21ea5a(0x141)](_0x21ea5a(0x143),_0x130da6);throw new Error(_0x21ea5a(0x14e));}}[a42_0x2a5d16(0x1ef)](_0x32bb57,_0xa118fc){const _0x45926f=a42_0x2a5d16;try{const _0x1282aa=fs_1['default'][_0x45926f(0x11b)](this[_0x45926f(0x1bc)],_0x45926f(0x136))[_0x45926f(0x160)](),_0x40d041=crypto_1['default'][_0x45926f(0x12f)](_0x1282aa,Buffer['from'](_0xa118fc,_0x45926f(0x174))),_0x7471cb=JSON[_0x45926f(0x106)](_0x40d041[_0x45926f(0x169)]()),_0x599c55=Buffer[_0x45926f(0x126)](_0x7471cb[_0x45926f(0x137)],_0x45926f(0x174)),_0x1d49f0=Buffer['from'](_0x7471cb['iv'],_0x45926f(0x174));return this[_0x45926f(0x135)](_0x32bb57,_0x599c55,_0x1d49f0);}catch(_0x376f33){throw new Error(_0x45926f(0x1e9));}}async[a42_0x2a5d16(0x1b0)](_0xc4adcc){const _0x7f76c1=a42_0x2a5d16,{paymentId:_0x1ab71b,orderId:_0x2330ed,amount:_0x5a3c68,currency:_0x3d2f10,cardData:_0x36a470,resultUrl:_0xa74d72,returnUrl:_0x220796,cardHolder:_0x49ba54,browser:_0x92afd2}=_0xc4adcc;console['log'](_0x7f76c1(0x14c)),console[_0x7f76c1(0x118)]('Payment\x20ID:',_0x1ab71b),console[_0x7f76c1(0x118)]('Order\x20ID:',_0x2330ed),console[_0x7f76c1(0x118)]('Amount:',_0x5a3c68,_0x3d2f10),console[_0x7f76c1(0x118)](_0x7f76c1(0x123),this['maskCardNumber'](_0x36a470[_0x7f76c1(0x138)])),console['log'](_0x7f76c1(0x193),_0x49ba54[_0x7f76c1(0x134)]+'\x20'+_0x49ba54[_0x7f76c1(0x1d7)]),console[_0x7f76c1(0x118)]('Return\x20URL:',_0x220796),console[_0x7f76c1(0x118)](_0x7f76c1(0x1c9),_0xa74d72);const _0x1408fc={'amount':_0x5a3c68,'currency':_0x3d2f10[_0x7f76c1(0x150)](),'order_id':_0x2330ed,'result_url':_0xa74d72,'return_url':_0x220796,'card':{'number':_0x36a470[_0x7f76c1(0x138)],'expire_month':_0x36a470[_0x7f76c1(0x172)],'expire_year':_0x36a470[_0x7f76c1(0x110)],'cvv':_0x36a470[_0x7f76c1(0x198)]},'card_holder':_0x49ba54,'browser':_0x92afd2},_0x194970=JSON['stringify'](_0x1408fc);console[_0x7f76c1(0x118)]('💾\x20Payment\x20data\x20prepared'),console[_0x7f76c1(0x118)](_0x7f76c1(0x1b5)),console[_0x7f76c1(0x118)](_0x194970),console[_0x7f76c1(0x118)](_0x7f76c1(0x14b),_0x194970[_0x7f76c1(0x157)]);try{const {key:_0x4ef42a,iv:_0x2c7253}=this['generateAESKey']();console[_0x7f76c1(0x118)](_0x7f76c1(0x151)),console[_0x7f76c1(0x118)]('🔐\x20AES\x20key\x20length:',_0x4ef42a[_0x7f76c1(0x157)]),console['log'](_0x7f76c1(0x180),_0x2c7253[_0x7f76c1(0x157)]);const _0x4fc2f3=this['encryptAES'](_0x194970,_0x4ef42a,_0x2c7253);console['log'](_0x7f76c1(0x19f)),console[_0x7f76c1(0x118)](_0x7f76c1(0x190),_0x4fc2f3[_0x7f76c1(0x157)]);const _0x27e6f3=this[_0x7f76c1(0x17d)](_0x4ef42a,_0x2c7253);console['log'](_0x7f76c1(0x170)),console[_0x7f76c1(0x118)](_0x7f76c1(0x1e1),_0x27e6f3[_0x7f76c1(0x157)]);const _0x2a6d28=this[_0x7f76c1(0x1ab)](_0x194970);console['log'](_0x7f76c1(0x1f3)),console[_0x7f76c1(0x118)]('📝\x20Signature\x20length:',_0x2a6d28['length']);const _0x3764f0={'merchant_point_id':this[_0x7f76c1(0x19e)],'method':_0x7f76c1(0x116),'info':_0x4fc2f3,'key':_0x27e6f3,'sign':_0x2a6d28,'lang':'en'};console['log'](_0x7f76c1(0x195)),console[_0x7f76c1(0x118)](_0x7f76c1(0x1e3)),console[_0x7f76c1(0x118)]('\x20\x20\x20-\x20merchant_point_id:',this[_0x7f76c1(0x19e)]),console[_0x7f76c1(0x118)]('\x20\x20\x20-\x20method:\x20charge'),console['log'](_0x7f76c1(0x124),_0x4fc2f3[_0x7f76c1(0x157)]),console[_0x7f76c1(0x118)]('\x20\x20\x20-\x20key\x20length:',_0x27e6f3[_0x7f76c1(0x157)]),console['log']('\x20\x20\x20-\x20sign\x20length:',_0x2a6d28[_0x7f76c1(0x157)]),console[_0x7f76c1(0x118)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x7f76c1(0x1ed)][_0x7f76c1(0x1dd)](_0x7f76c1(0x1ee),_0x7f76c1(0x108),_0x7f76c1(0x15f),{'merchant_point_id':this[_0x7f76c1(0x19e)],'method':_0x7f76c1(0x116),'lang':'en'});const _0x2b1254=Date['now'](),_0x117617=await fetch(this[_0x7f76c1(0x113)],{'method':_0x7f76c1(0x15f),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x7f76c1(0x196)},'body':JSON[_0x7f76c1(0x1cb)](_0x3764f0)}),_0x380815=Date[_0x7f76c1(0x158)]()-_0x2b1254;console['log'](_0x7f76c1(0x181)),console[_0x7f76c1(0x118)](_0x7f76c1(0x13f),_0x117617[_0x7f76c1(0x199)]),console[_0x7f76c1(0x118)](_0x7f76c1(0x122),_0x380815+'ms');if(!_0x117617['ok']){const _0x34f273=await _0x117617[_0x7f76c1(0x19a)]();console[_0x7f76c1(0x141)](_0x7f76c1(0x115),_0x117617[_0x7f76c1(0x199)]),console['error']('Response\x20Body:',_0x34f273),loggerService_1['loggerService'][_0x7f76c1(0x182)](_0x7f76c1(0x1ee),_0x7f76c1(0x1b1),_0x117617[_0x7f76c1(0x199)],_0x34f273,_0x380815),loggerService_1[_0x7f76c1(0x1ed)][_0x7f76c1(0x1ec)]('mastercard',_0x7f76c1(0x108),_0x7f76c1(0x179)+_0x117617['status']+':\x20'+_0x34f273);throw new Error(_0x7f76c1(0x1e5)+_0x117617['status']+_0x7f76c1(0x17f)+_0x34f273);}const _0x1490c1=await _0x117617[_0x7f76c1(0x17c)]();loggerService_1['loggerService'][_0x7f76c1(0x182)](_0x7f76c1(0x1ee),'/charge_raw',_0x117617[_0x7f76c1(0x199)],_0x1490c1,_0x380815),console['log']('===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===');let _0x26482d=_0x1490c1;if(_0x1490c1[_0x7f76c1(0x192)]&&_0x1490c1[_0x7f76c1(0x137)]&&_0x1490c1['sign']){console['log'](_0x7f76c1(0x187));try{const _0x3de4a9=await this['decryptResponsePhp'](_0x1490c1[_0x7f76c1(0x192)],_0x1490c1[_0x7f76c1(0x137)]);_0x26482d=JSON['parse'](_0x3de4a9),console[_0x7f76c1(0x118)](_0x7f76c1(0x1f4)),loggerService_1[_0x7f76c1(0x1ed)][_0x7f76c1(0x182)]('mastercard',_0x7f76c1(0x1ac),_0x117617[_0x7f76c1(0x199)],_0x26482d,_0x380815),console['log'](_0x7f76c1(0x1c4));}catch(_0x18e746){console[_0x7f76c1(0x141)](_0x7f76c1(0x17e),_0x18e746),loggerService_1[_0x7f76c1(0x1ed)][_0x7f76c1(0x1ec)](_0x7f76c1(0x1ee),_0x7f76c1(0x13c),_0x7f76c1(0x128)+_0x18e746),_0x26482d=_0x1490c1;}}else loggerService_1[_0x7f76c1(0x1ed)][_0x7f76c1(0x182)](_0x7f76c1(0x1ee),_0x7f76c1(0x1ac),_0x117617['status'],_0x26482d,_0x380815),console[_0x7f76c1(0x118)](_0x7f76c1(0x111));console[_0x7f76c1(0x118)](_0x7f76c1(0x13f),_0x26482d[_0x7f76c1(0x199)]),console[_0x7f76c1(0x118)]('Final:',_0x26482d[_0x7f76c1(0x159)]),console['log'](_0x7f76c1(0x189),_0x26482d[_0x7f76c1(0x10f)]),console['log'](_0x7f76c1(0x1c8),_0x26482d['3ds_url']||_0x7f76c1(0x1f5));if(_0x26482d['status']===0x64&&_0x26482d[_0x7f76c1(0x159)]===0x1)return console[_0x7f76c1(0x118)](_0x7f76c1(0x1a8)),{'gateway_payment_id':_0x26482d[_0x7f76c1(0x10f)]?.['toString'](),'payment_url':_0x220796,'requires_3ds':![],'status':_0x7f76c1(0x1b7),'final':!![]};if(_0x26482d['3ds_url'])return console['log']('🔐\x203DS\x20verification\x20required'),this[_0x7f76c1(0x1e8)](_0x1ab71b,_0x2330ed,_0x26482d['payment_id']?.[_0x7f76c1(0x169)]()||_0x2330ed),{'gateway_payment_id':_0x26482d[_0x7f76c1(0x10f)]?.['toString'](),'payment_url':_0x26482d['3ds_url'],'requires_3ds':!![],'threeds_url':_0x26482d[_0x7f76c1(0x1c0)],'status':'PENDING','final':![]};let _0x1174c4=_0x26482d['desc']||_0x26482d['message']||_0x7f76c1(0x1a7),_0x2bac61=_0x26482d[_0x7f76c1(0x199)],_0x1d5e80=_0x26482d['final'];return console['log']('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x2bac61+_0x7f76c1(0x155)+_0x1d5e80+',\x20Desc:\x20'+_0x1174c4),{'gateway_payment_id':_0x26482d[_0x7f76c1(0x10f)]?.['toString'](),'payment_url':_0x220796,'requires_3ds':![],'status':_0x7f76c1(0x102),'final':!![]};}catch(_0x4bdf61){console[_0x7f76c1(0x141)]('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console[_0x7f76c1(0x141)]('Error\x20details:',_0x4bdf61),loggerService_1['loggerService']['logWhiteDomainError'](_0x7f76c1(0x1ee),_0x7f76c1(0x108),_0x4bdf61);throw new Error(_0x7f76c1(0x18c)+(_0x4bdf61 instanceof Error?_0x4bdf61[_0x7f76c1(0x10e)]:_0x7f76c1(0x1a7)));}}async['checkPaymentStatus'](_0x49b548,_0x3b6de6){const _0x316347=a42_0x2a5d16;console[_0x316347(0x118)]('📊\x20Checking\x20MasterCard\x20payment\x20status:\x20'+_0x49b548+'\x20('+_0x3b6de6+')');try{const _0x227fe9={'payment_id':_0x49b548,'order_id':_0x3b6de6},_0x54abdc=JSON[_0x316347(0x1cb)](_0x227fe9),{key:_0x3a9c9f,iv:_0x32eb54}=this[_0x316347(0x15e)](),_0x23097f=this['encryptAES'](_0x54abdc,_0x3a9c9f,_0x32eb54),_0x3be7eb=this['encryptRSA'](_0x3a9c9f,_0x32eb54),_0x52e82a=this[_0x316347(0x1ab)](_0x54abdc),_0x1a9bfa={'merchant_point_id':this[_0x316347(0x19e)],'method':_0x316347(0x199),'info':_0x23097f,'key':_0x3be7eb,'sign':_0x52e82a,'lang':'en'};loggerService_1[_0x316347(0x1ed)][_0x316347(0x1dd)]('mastercard',_0x316347(0x14f),_0x316347(0x15f),{'merchant_point_id':this[_0x316347(0x19e)],'method':_0x316347(0x199),'lang':'en'});const _0x256217=Date[_0x316347(0x158)](),_0x809c67=await fetch(this[_0x316347(0x113)],{'method':_0x316347(0x15f),'headers':{'Content-Type':_0x316347(0x1ad),'Accept':_0x316347(0x1ad),'User-Agent':_0x316347(0x196)},'body':JSON['stringify'](_0x1a9bfa)}),_0x531d56=Date['now']()-_0x256217;if(!_0x809c67['ok']){const _0x4d54ff=await _0x809c67['text']();loggerService_1[_0x316347(0x1ed)]['logWhiteDomainResponse'](_0x316347(0x1ee),_0x316347(0x14d),_0x809c67[_0x316347(0x199)],_0x4d54ff,_0x531d56);throw new Error('HTTP\x20error!\x20status:\x20'+_0x809c67[_0x316347(0x199)]);}const _0x3a15c4=await _0x809c67[_0x316347(0x17c)]();loggerService_1[_0x316347(0x1ed)]['logWhiteDomainResponse']('mastercard',_0x316347(0x14d),_0x809c67[_0x316347(0x199)],_0x3a15c4,_0x531d56);let _0x5ae891=_0x3a15c4;if(_0x3a15c4[_0x316347(0x192)]&&_0x3a15c4[_0x316347(0x137)]&&_0x3a15c4['sign']){console[_0x316347(0x118)](_0x316347(0x1d3));try{const _0x4dbf0a=this[_0x316347(0x1ef)](_0x3a15c4[_0x316347(0x192)],_0x3a15c4['key']);_0x5ae891=JSON[_0x316347(0x106)](_0x4dbf0a),console[_0x316347(0x118)](_0x316347(0x13d)),loggerService_1[_0x316347(0x1ed)][_0x316347(0x182)](_0x316347(0x1ee),_0x316347(0x1e4),_0x809c67[_0x316347(0x199)],_0x5ae891,_0x531d56),console[_0x316347(0x118)](_0x316347(0x164));}catch(_0x1d64db){console[_0x316347(0x141)](_0x316347(0x1d9),_0x1d64db),loggerService_1[_0x316347(0x1ed)][_0x316347(0x1ec)]('mastercard',_0x316347(0x186),_0x316347(0x177)+_0x1d64db),_0x5ae891=_0x3a15c4;}}else loggerService_1[_0x316347(0x1ed)][_0x316347(0x182)]('mastercard',_0x316347(0x1e4),_0x809c67[_0x316347(0x199)],_0x5ae891,_0x531d56),console['log'](_0x316347(0x12c));console[_0x316347(0x118)]('📊\x20Status\x20check\x20result:',{'status':_0x5ae891[_0x316347(0x199)],'final':_0x5ae891[_0x316347(0x159)],'payment_id':_0x5ae891[_0x316347(0x10f)],'desc':_0x5ae891[_0x316347(0x1bd)]});let _0x1bd8ba='PENDING';if(_0x5ae891['status']===0x1&&_0x5ae891['final']===0x1)_0x1bd8ba=_0x316347(0x1b7);else _0x5ae891['status']===0x0&&_0x5ae891['final']===0x0?_0x1bd8ba=_0x316347(0x168):_0x1bd8ba=_0x316347(0x102);return{'status':_0x1bd8ba,'final':_0x5ae891[_0x316347(0x159)]===0x1,'amount':_0x5ae891[_0x316347(0x1d8)],'currency':_0x5ae891[_0x316347(0x11a)],'date_success':_0x5ae891[_0x316347(0x1bf)],'description':_0x5ae891[_0x316347(0x1bd)]};}catch(_0x2ab62d){console['error'](_0x316347(0x1c2),_0x2ab62d),loggerService_1['loggerService']['logWhiteDomainError'](_0x316347(0x1ee),_0x316347(0x14f),_0x2ab62d);throw new Error(_0x316347(0x161)+(_0x2ab62d instanceof Error?_0x2ab62d['message']:'Unknown\x20error'));}}[a42_0x2a5d16(0x1e8)](_0x4e27cb,_0x44ea06,_0x3f8bf7){const _0x540d9a=a42_0x2a5d16;console[_0x540d9a(0x118)](_0x540d9a(0x1c5)+_0x4e27cb+'\x20('+_0x3f8bf7+')'),this[_0x540d9a(0x1c7)](_0x4e27cb);const _0x47985a=[],_0x5cff2c=0x5*0x3c*0x3e8,_0x541fc9=0x2*0x3c*0x3c*0x3e8,_0x498f8b=Math[_0x540d9a(0x149)](_0x541fc9/_0x5cff2c);console['log'](_0x540d9a(0x10d)+_0x498f8b+_0x540d9a(0x1d1));for(let _0x3b1e47=0x1;_0x3b1e47<=_0x498f8b;_0x3b1e47++){const _0x198d6d=setTimeout(async()=>{const _0xc67e61=_0x540d9a;console[_0xc67e61(0x118)](_0xc67e61(0x171)+_0x3b1e47+'/'+_0x498f8b+_0xc67e61(0x18f)+_0x4e27cb);try{const _0x1b1882=await this['checkPaymentStatus'](_0x3f8bf7,_0x44ea06);console[_0xc67e61(0x118)]('📊\x20Status\x20check\x20#'+_0x3b1e47+'\x20result:',_0x1b1882),_0x1b1882[_0xc67e61(0x159)]&&(console[_0xc67e61(0x118)](_0xc67e61(0x1df)+_0x4e27cb+'\x20is\x20final\x20('+_0x1b1882[_0xc67e61(0x199)]+_0xc67e61(0x152)),this[_0xc67e61(0x1c7)](_0x4e27cb),await this[_0xc67e61(0x185)](_0x4e27cb,_0x1b1882[_0xc67e61(0x199)],_0x1b1882));}catch(_0x39cf78){console['error']('❌\x20Status\x20check\x20#'+_0x3b1e47+_0xc67e61(0x11e)+_0x4e27cb+':',_0x39cf78);}},_0x3b1e47*_0x5cff2c);_0x47985a['push'](_0x198d6d);}this[_0x540d9a(0x120)][_0x540d9a(0x1d4)](_0x4e27cb,_0x47985a),console['log'](_0x540d9a(0x1f1)+_0x498f8b+_0x540d9a(0x1d6)+_0x4e27cb);}[a42_0x2a5d16(0x1c7)](_0x2897b8){const _0x51e672=a42_0x2a5d16,_0x430307=this[_0x51e672(0x120)][_0x51e672(0x131)](_0x2897b8);_0x430307&&(console[_0x51e672(0x118)](_0x51e672(0x1a0)+_0x430307[_0x51e672(0x157)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x2897b8),_0x430307[_0x51e672(0x10c)]((_0x1cd4b1,_0x17d5c8)=>{clearTimeout(_0x1cd4b1);}),this[_0x51e672(0x120)]['delete'](_0x2897b8));}async[a42_0x2a5d16(0x185)](_0x394d36,_0x24832d,_0x28a515){const _0x55b715=a42_0x2a5d16;try{const _0x12d97f=(await Promise['resolve']()[_0x55b715(0x18d)](()=>__importStar(require(_0x55b715(0x148)))))[_0x55b715(0x11f)],_0x3590e9={'status':_0x24832d[_0x55b715(0x150)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x24832d===_0x55b715(0x1b7)&&(_0x3590e9['paidAt']=new Date()),_0x28a515[_0x55b715(0x15a)]&&(_0x3590e9[_0x55b715(0x1e7)]=_0x55b715(0x105)+_0x28a515[_0x55b715(0x15a)]),await _0x12d97f[_0x55b715(0x1eb)][_0x55b715(0x1c6)]({'where':{'id':_0x394d36},'data':_0x3590e9}),console[_0x55b715(0x118)]('✅\x20Payment\x20'+_0x394d36+'\x20status\x20updated\x20to\x20'+_0x24832d),await this[_0x55b715(0x1a6)](_0x394d36,_0x24832d);}catch(_0x262885){console[_0x55b715(0x141)](_0x55b715(0x145)+_0x394d36+':',_0x262885);}}async['sendPaymentNotifications'](_0x40918a,_0x322c9c){const _0x696160=a42_0x2a5d16;try{const _0x6f6385=(await Promise[_0x696160(0x142)]()[_0x696160(0x18d)](()=>__importStar(require(_0x696160(0x148)))))[_0x696160(0x11f)],{telegramBotService:_0xa6b085}=await Promise['resolve']()[_0x696160(0x18d)](()=>__importStar(require(_0x696160(0x1ae)))),_0x10796c=await _0x6f6385[_0x696160(0x1eb)][_0x696160(0x1ca)]({'where':{'id':_0x40918a},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x10796c)return;const _0x4db2bd={'PAID':_0x696160(0x1c3),'FAILED':'failed'},_0x5a5b06=_0x4db2bd[_0x322c9c];_0x5a5b06&&await _0xa6b085[_0x696160(0x188)](_0x10796c[_0x696160(0x103)],_0x10796c,_0x5a5b06),await this[_0x696160(0x16a)](_0x10796c,_0x322c9c);}catch(_0x4cde06){console[_0x696160(0x141)](_0x696160(0x153),_0x4cde06);}}async[a42_0x2a5d16(0x16a)](_0x445501,_0x5c0750){const _0x3bd185=a42_0x2a5d16,_0x50d968=Date['now']();try{const _0x669246=_0x445501['shop'],_0x2f982e=_0x669246[_0x3bd185(0x12b)];if(!_0x2f982e?.[_0x3bd185(0x18e)]){console[_0x3bd185(0x118)](_0x3bd185(0x140)+_0x669246['id']);return;}const _0x78bcab=_0x5c0750===_0x3bd185(0x1b7)?_0x3bd185(0x1a1):_0x3bd185(0x154);let _0x584c66=[];if(_0x2f982e[_0x3bd185(0x100)])try{_0x584c66=Array[_0x3bd185(0x14a)](_0x2f982e[_0x3bd185(0x100)])?_0x2f982e['webhookEvents']:JSON[_0x3bd185(0x106)](_0x2f982e[_0x3bd185(0x100)]);}catch(_0x41f837){console[_0x3bd185(0x141)](_0x3bd185(0x191),_0x41f837),_0x584c66=[];}if(!_0x584c66[_0x3bd185(0x139)](_0x78bcab)){console[_0x3bd185(0x118)](_0x3bd185(0x18b)+_0x78bcab+_0x3bd185(0x1b4)+_0x669246['id']);return;}const _0x424f59={'event':_0x78bcab,'payment':{'id':_0x445501['id'],'order_id':_0x445501[_0x3bd185(0x183)],'gateway_order_id':_0x445501[_0x3bd185(0x173)],'gateway':'1111','amount':_0x445501[_0x3bd185(0x1d8)],'currency':_0x445501[_0x3bd185(0x11a)],'status':_0x5c0750['toLowerCase'](),'customer_email':_0x445501[_0x3bd185(0x16c)],'customer_name':_0x445501[_0x3bd185(0x13e)],'created_at':_0x445501[_0x3bd185(0x194)],'updated_at':new Date()}},_0x5da469=await fetch(_0x2f982e[_0x3bd185(0x18e)],{'method':'POST','headers':{'Content-Type':_0x3bd185(0x1ad),'User-Agent':_0x3bd185(0x127)},'body':JSON[_0x3bd185(0x1cb)](_0x424f59)}),_0xe9ebca=Date[_0x3bd185(0x158)]()-_0x50d968;loggerService_1[_0x3bd185(0x1ed)][_0x3bd185(0x1b6)](_0x445501[_0x3bd185(0x103)],_0x2f982e[_0x3bd185(0x18e)],_0x78bcab,_0x5da469[_0x3bd185(0x199)],_0xe9ebca,_0x424f59),console[_0x3bd185(0x118)](_0x3bd185(0x147)+_0x2f982e[_0x3bd185(0x18e)]+_0x3bd185(0x12e)+_0x5da469['status']+'\x20('+_0xe9ebca+_0x3bd185(0x132));}catch(_0x35f63e){console[_0x3bd185(0x141)](_0x3bd185(0x1e0),_0x35f63e),loggerService_1[_0x3bd185(0x1ed)][_0x3bd185(0x197)](_0x445501[_0x3bd185(0x103)],_0x445501['shop']?.[_0x3bd185(0x12b)]?.[_0x3bd185(0x18e)]||'unknown',_0x3bd185(0x1c1),_0x35f63e,{});}}[a42_0x2a5d16(0x112)](_0x239e5b){const _0x31b153=a42_0x2a5d16,_0x3b0059=_0x239e5b[_0x31b153(0x146)](/[\s-]/g,'');if(_0x3b0059[_0x31b153(0x157)]<0x4)return'****';return _0x31b153(0x1f6)+_0x3b0059[_0x31b153(0x12d)](-0x4);}async[a42_0x2a5d16(0x184)](_0x23c5ee){const _0x7cdab6=a42_0x2a5d16;console[_0x7cdab6(0x118)](_0x7cdab6(0x16f),_0x23c5ee);let _0x1a6ce2=_0x7cdab6(0x168);if(_0x23c5ee[_0x7cdab6(0x199)]===0x1&&_0x23c5ee[_0x7cdab6(0x159)]===0x1)_0x1a6ce2=_0x7cdab6(0x1b7);else _0x23c5ee[_0x7cdab6(0x199)]===0x0&&_0x23c5ee[_0x7cdab6(0x159)]===0x0?_0x1a6ce2=_0x7cdab6(0x168):_0x1a6ce2='FAILED';return{'paymentId':_0x23c5ee[_0x7cdab6(0x130)]||'','status':_0x1a6ce2,'amount':_0x23c5ee['amount'],'currency':_0x23c5ee[_0x7cdab6(0x11a)]};}[a42_0x2a5d16(0x1ba)](){const _0x451d87=a42_0x2a5d16;console['log'](_0x451d87(0x1cd));const _0x518ac4=this['statusCheckTimers'][_0x451d87(0x16b)];for(const [_0x1b77b8]of this[_0x451d87(0x120)]){this['clearStatusTimers'](_0x1b77b8);}console[_0x451d87(0x118)](_0x451d87(0x17b)+_0x518ac4+_0x451d87(0x19c));}}exports['MasterCardService']=MasterCardService;