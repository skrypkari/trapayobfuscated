'use strict';const a46_0x360640=a46_0x25b5;(function(_0x38634f,_0x1c2c85){const _0x2c0cef=a46_0x25b5,_0x33ab7a=_0x38634f();while(!![]){try{const _0x148f0a=-parseInt(_0x2c0cef(0x29d))/0x1+parseInt(_0x2c0cef(0x1de))/0x2*(-parseInt(_0x2c0cef(0x1d3))/0x3)+parseInt(_0x2c0cef(0x26e))/0x4+parseInt(_0x2c0cef(0x261))/0x5*(-parseInt(_0x2c0cef(0x2d9))/0x6)+parseInt(_0x2c0cef(0x2a3))/0x7*(parseInt(_0x2c0cef(0x1c9))/0x8)+parseInt(_0x2c0cef(0x2c5))/0x9+parseInt(_0x2c0cef(0x1f9))/0xa;if(_0x148f0a===_0x1c2c85)break;else _0x33ab7a['push'](_0x33ab7a['shift']());}catch(_0x596747){_0x33ab7a['push'](_0x33ab7a['shift']());}}}(a46_0x14bf,0x3cbfb));var __createBinding=this&&this[a46_0x360640(0x1c6)]||(Object[a46_0x360640(0x22e)]?function(_0x32d680,_0x7fe144,_0x4f74ba,_0x559d6b){const _0x47ca45=a46_0x360640;if(_0x559d6b===undefined)_0x559d6b=_0x4f74ba;var _0x14c377=Object[_0x47ca45(0x29a)](_0x7fe144,_0x4f74ba);(!_0x14c377||(_0x47ca45(0x210)in _0x14c377?!_0x7fe144['__esModule']:_0x14c377[_0x47ca45(0x244)]||_0x14c377['configurable']))&&(_0x14c377={'enumerable':!![],'get':function(){return _0x7fe144[_0x4f74ba];}}),Object[_0x47ca45(0x229)](_0x32d680,_0x559d6b,_0x14c377);}:function(_0x40396c,_0x518b39,_0x963d58,_0x88eb7){if(_0x88eb7===undefined)_0x88eb7=_0x963d58;_0x40396c[_0x88eb7]=_0x518b39[_0x963d58];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a46_0x360640(0x22e)]?function(_0x38f075,_0x121533){const _0x1010ee=a46_0x360640;Object['defineProperty'](_0x38f075,_0x1010ee(0x1ce),{'enumerable':!![],'value':_0x121533});}:function(_0x3db9a6,_0x1d3fd4){const _0x22ce2d=a46_0x360640;_0x3db9a6[_0x22ce2d(0x1ce)]=_0x1d3fd4;}),__importStar=this&&this[a46_0x360640(0x27b)]||(function(){var _0x2f0141=function(_0x4addf5){const _0x37e849=a46_0x25b5;return _0x2f0141=Object[_0x37e849(0x21c)]||function(_0x433880){const _0x2d9f70=_0x37e849;var _0x58cd7f=[];for(var _0x4f824f in _0x433880)if(Object[_0x2d9f70(0x23f)][_0x2d9f70(0x252)][_0x2d9f70(0x29e)](_0x433880,_0x4f824f))_0x58cd7f[_0x58cd7f[_0x2d9f70(0x1e1)]]=_0x4f824f;return _0x58cd7f;},_0x2f0141(_0x4addf5);};return function(_0x5f4007){const _0x572d5e=a46_0x25b5;if(_0x5f4007&&_0x5f4007[_0x572d5e(0x279)])return _0x5f4007;var _0x4c27f9={};if(_0x5f4007!=null){for(var _0x25020d=_0x2f0141(_0x5f4007),_0x4daba4=0x0;_0x4daba4<_0x25020d['length'];_0x4daba4++)if(_0x25020d[_0x4daba4]!==_0x572d5e(0x1ce))__createBinding(_0x4c27f9,_0x5f4007,_0x25020d[_0x4daba4]);}return __setModuleDefault(_0x4c27f9,_0x5f4007),_0x4c27f9;};}()),__importDefault=this&&this['__importDefault']||function(_0x43488a){const _0x2e4d93=a46_0x360640;return _0x43488a&&_0x43488a[_0x2e4d93(0x279)]?_0x43488a:{'default':_0x43488a};};Object[a46_0x360640(0x229)](exports,a46_0x360640(0x279),{'value':!![]}),exports[a46_0x360640(0x26b)]=void 0x0;function a46_0x25b5(_0x3505c0,_0x580ecf){const _0x14bfaf=a46_0x14bf();return a46_0x25b5=function(_0x25b50e,_0x1e6108){_0x25b50e=_0x25b50e-0x1ac;let _0x44a62d=_0x14bfaf[_0x25b50e];return _0x44a62d;},a46_0x25b5(_0x3505c0,_0x580ecf);}const crypto_1=__importDefault(require(a46_0x360640(0x21f))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a46_0x360640(0x254))),loggerService_1=require(a46_0x360640(0x1c1));function a46_0x14bf(){const _0x2b27e6=['toLowerCase','Payment\x20ID:','webhookUrl','set','first_name','cwd','POST','\x20payment_id\x20for\x20search:\x20','\x20payment:\x20','visaApiUrl','Failed\x20to\x20decrypt\x20response','adminNotes','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','🔐\x20VISA\x20Private\x20key\x20length:\x20','constants','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','66qWHhby','encryptRSA','existsSync','info','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','❌\x20PHP\x20decryptor\x20request\x20failed:','charAt','customerEmail','https://api.paydmeth.com/api','\x20(from:\x20status=','Card\x20Holder:','warn','PAID','❌\x20RSA\x20signing\x20failed:','stringify','publicEncrypt','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','MASTERCARD','💾\x20Payment\x20data\x20prepared','VISA','\x20for\x20payment\x20','../loggerService','isArray','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','\x20API:\x20','/charge_decrypt','__createBinding','\x20\x20\x20-\x20sign\x20length:','paidAt','189192iQUOip','key','failed','🛑\x20Stopped\x20','from','default','size','\x20MasterCard\x20status\x20check\x20timers','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','maskCardNumber','123MEsikE','❌\x20RSA\x20encryption\x20failed:','/status','updatePaymentStatus','),\x20stopping\x20status\x20checks','\x20not\x20enabled\x20for\x20shop\x20','🔐\x20MasterCard\x20Public\x20key\x20path:','none','description','update','\x20status\x20check\x20error:','11546ebAfWd','desc','✅\x20Status\x20response\x20decrypted\x20successfully','length','\x20is\x20final\x20(','includes','decryptResponsePhp','✅\x20VISA\x20key\x20files\x20validated\x20successfully','HTTP\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20failed\x20for\x20payment\x20','✅\x20Payment\x20',',\x20paymentId=','masterCardApiUrl','encryptAES','json','gatewayOrderId','validateKeyFiles','RSA_PKCS1_PADDING','forEach','/status_decrypt','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','💾\x20Saving\x20failure\x20message:\x20','replace','\x20payment\x20status:\x20','end','logShopWebhookError','7711970WWucsj','Webhook\x20event\x20','/status_decrypted','decryptResponse','Final:','🔐\x20VISA\x20Private\x20key\x20path:','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','card_type','getCardTypeAndApi','\x20webhook\x20extracted\x20data:','****','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','🔐\x20MasterCard\x20API\x20URL:','substring','merchantPointId','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','text','logWhiteDomainRequest','paymentId','payment.failed','logWhiteDomainResponse','visa_public.pem','get','FAILED','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','unknown','order_id','createDecipheriv','createdAt','\x20status\x20checks\x20for\x20payment\x20','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===',',\x20Desc:\x20','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','getOwnPropertyNames','📊\x20Status\x20check\x20result:','🔐\x20MasterCard\x20Private\x20key\x20path:','crypto','cvv','join','signRSA','slice','findUnique','\x20characters','number','ms)',',\x20payment_id=','defineProperty','PENDING','visaPublicKeyPath','🔐\x20VISA\x20Public\x20key\x20length:\x20','Status:','create','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','visaMerchantPointId','Error\x20parsing\x20webhook\x20events:','\x20with\x20status\x20','⏰\x20Will\x20check\x20status\x20',',\x20orderId=','\x20result:','https://api2.trapay.uk/decrypt.php','\x20(from:\x20order_id=','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','🎯\x20Using\x20','webhook_send','../telegramBotService','psp_public.pem','statusCheckTimers','failureMessage','prototype','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','SHA256','🔐\x203DS\x20verification\x20required','📤\x20Sending\x20request\x20to\x20API...','writable','scheduleStatusChecks','Decryption\x20failed:\x20','masterCardMerchantPointId','HTTP\x20Status:','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','),\x20defaulting\x20to\x20MasterCard','settings','visa_private.pem','\x20\x20\x20Amount:\x20','Return\x20URL:','decryptAES','shopId','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','hasOwnProperty','🔐\x20AES\x20key\x20length:','path','loggerService','💳\x20VISA/MasterCard\x20service\x20initialized','status','readFileSync','base64','📊\x20','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','orderId','Response\x20Time:','resolve','🔍\x20Using\x20','\x20status\x20updated\x20to\x20','214585hvdUOW','expire_month','aes-256-ctr','sendPaymentNotifications','Response\x20Body:','logWhiteDomainError','===\x20API\x20RESPONSE\x20===','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','paid','log','VisaMasterCardService','private.pem','shop','358056eCDWhC','MasterCard\x20webhook\x20sent\x20to\x20','error','📝\x20Final\x20request\x20structure:','-----END','payment.success','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','floor','final','/status_raw','date_success','__esModule','utf8','__importStar',',\x20body:\x20','last_name','🔍\x20','privateKeyPath','toUpperCase','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','currency','keys',',\x20Final:\x20','payment','publicKeyPath','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','sign','TesSoft\x20Payment\x20System/1.0','customerName','\x20\x20\x20Currency:\x20','📝\x20Encrypted\x20key\x20length:','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','1111','apiUrl','🔐\x20Data\x20signed\x20with\x20RSA','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','clearStatusTimers','createSign','checkPaymentStatus','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','message',',\x20final=','getOwnPropertyDescriptor','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','📊\x20Checking\x20','47153DDynGM','call','parse','toString','Amount:','then','14pLKElw','createCipheriv','🔐\x20VISA\x20Public\x20key\x20path:','🧹\x20Clearing\x20','randomBytes','application/json','expire_year','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','generateAESKey','❌\x20Data\x20being\x20signed:','/charge_decrypted','charge','\x20\x20\x20-\x20lang:\x20en','now','logShopWebhookSent','/charge_raw','cardType','PHP\x20decryptor\x20error','amount','Order\x20ID:','visaPrivateKeyPath','3ds_url','webhookEvents','-----BEGIN','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','Failed\x20to\x20send\x20MasterCard\x20webhook:','📝\x20Signature\x20length:','❌\x20Status\x20check\x20#','trim','Failed\x20to\x20check\x20','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','/charge','HTTP\x20error!\x20status:\x20','870759Wrdjku','Unknown\x20error','payment_id','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'];a46_0x14bf=function(){return _0x2b27e6;};return a46_0x14bf();}class VisaMasterCardService{constructor(){const _0x1ab378=a46_0x360640;this[_0x1ab378(0x23d)]=new Map(),this['masterCardApiUrl']=_0x1ab378(0x1b3),this[_0x1ab378(0x247)]=0x6a7,this['privateKeyPath']=path_1['default'][_0x1ab378(0x221)](process[_0x1ab378(0x2ce)](),_0x1ab378(0x285),_0x1ab378(0x26c)),this['publicKeyPath']=path_1[_0x1ab378(0x1ce)]['join'](process['cwd'](),'keys',_0x1ab378(0x23c)),this[_0x1ab378(0x2d2)]=_0x1ab378(0x1b3),this[_0x1ab378(0x230)]=0x6b7,this[_0x1ab378(0x2b8)]=path_1[_0x1ab378(0x1ce)][_0x1ab378(0x221)](process['cwd'](),_0x1ab378(0x285),_0x1ab378(0x24c)),this['visaPublicKeyPath']=path_1['default'][_0x1ab378(0x221)](process[_0x1ab378(0x2ce)](),_0x1ab378(0x285),_0x1ab378(0x20f)),console[_0x1ab378(0x26a)](_0x1ab378(0x256)),console['log'](_0x1ab378(0x206),this['masterCardApiUrl']),console[_0x1ab378(0x26a)]('🔐\x20VISA\x20API\x20URL:',this[_0x1ab378(0x2d2)]),console[_0x1ab378(0x26a)](_0x1ab378(0x21e),this['privateKeyPath']),console[_0x1ab378(0x26a)](_0x1ab378(0x1d9),this[_0x1ab378(0x288)]),console[_0x1ab378(0x26a)](_0x1ab378(0x1fe),this[_0x1ab378(0x2b8)]),console[_0x1ab378(0x26a)](_0x1ab378(0x2a5),this[_0x1ab378(0x22b)]),this[_0x1ab378(0x1ef)]();}[a46_0x360640(0x202)](_0x1d1e40){const _0x320d7b=a46_0x360640,_0x12f6a7=_0x1d1e40[_0x320d7b(0x1b1)](0x0);if(_0x12f6a7==='4')return console[_0x320d7b(0x26a)](_0x320d7b(0x1f3)),{'cardType':_0x320d7b(0x1bf),'apiUrl':this[_0x320d7b(0x2d2)],'privateKeyPath':this['visaPrivateKeyPath'],'publicKeyPath':this[_0x320d7b(0x22b)],'merchantPointId':this[_0x320d7b(0x230)]};else return _0x12f6a7==='5'?(console[_0x320d7b(0x26a)](_0x320d7b(0x1af)),{'cardType':_0x320d7b(0x1bd),'apiUrl':this[_0x320d7b(0x1eb)],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x320d7b(0x288)],'merchantPointId':this[_0x320d7b(0x247)]}):(console[_0x320d7b(0x26a)](_0x320d7b(0x1ff)+_0x12f6a7+_0x320d7b(0x24a)),{'cardType':'MASTERCARD','apiUrl':this[_0x320d7b(0x1eb)],'privateKeyPath':this[_0x320d7b(0x27f)],'publicKeyPath':this[_0x320d7b(0x288)],'merchantPointId':this[_0x320d7b(0x247)]});}[a46_0x360640(0x1ef)](){const _0x64ca93=a46_0x360640;try{if(!fs_1[_0x64ca93(0x1ce)][_0x64ca93(0x1ad)](this['privateKeyPath']))throw new Error(_0x64ca93(0x249)+this['privateKeyPath']);if(!fs_1[_0x64ca93(0x1ce)][_0x64ca93(0x1ad)](this[_0x64ca93(0x288)]))throw new Error(_0x64ca93(0x2d5)+this[_0x64ca93(0x288)]);const _0x22a8c3=fs_1[_0x64ca93(0x1ce)][_0x64ca93(0x258)](this[_0x64ca93(0x27f)],_0x64ca93(0x27a))[_0x64ca93(0x2c0)](),_0xf3e68=fs_1[_0x64ca93(0x1ce)][_0x64ca93(0x258)](this[_0x64ca93(0x288)],_0x64ca93(0x27a))[_0x64ca93(0x2c0)]();if(!_0x22a8c3['includes'](_0x64ca93(0x2bb))||!_0x22a8c3[_0x64ca93(0x1e3)](_0x64ca93(0x272)))throw new Error(_0x64ca93(0x21a));if(!_0xf3e68[_0x64ca93(0x1e3)](_0x64ca93(0x2bb))||!_0xf3e68[_0x64ca93(0x1e3)](_0x64ca93(0x272)))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x64ca93(0x26a)](_0x64ca93(0x2bc)),console[_0x64ca93(0x26a)](_0x64ca93(0x205)+_0x22a8c3[_0x64ca93(0x1e1)]+'\x20characters'),console[_0x64ca93(0x26a)](_0x64ca93(0x1c3)+_0xf3e68['length']+'\x20characters');if(fs_1[_0x64ca93(0x1ce)][_0x64ca93(0x1ad)](this[_0x64ca93(0x2b8)])&&fs_1[_0x64ca93(0x1ce)][_0x64ca93(0x1ad)](this[_0x64ca93(0x22b)])){const _0x11ba4a=fs_1[_0x64ca93(0x1ce)][_0x64ca93(0x258)](this[_0x64ca93(0x2b8)],'utf8')[_0x64ca93(0x2c0)](),_0x34538d=fs_1[_0x64ca93(0x1ce)][_0x64ca93(0x258)](this[_0x64ca93(0x22b)],_0x64ca93(0x27a))[_0x64ca93(0x2c0)]();(!_0x11ba4a['includes'](_0x64ca93(0x2bb))||!_0x11ba4a[_0x64ca93(0x1e3)]('-----END'))&&console[_0x64ca93(0x1b6)](_0x64ca93(0x25b)),(!_0x34538d[_0x64ca93(0x1e3)](_0x64ca93(0x2bb))||!_0x34538d[_0x64ca93(0x1e3)](_0x64ca93(0x272)))&&console[_0x64ca93(0x1b6)]('⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),console[_0x64ca93(0x26a)](_0x64ca93(0x1e5)),console['log'](_0x64ca93(0x2d6)+_0x11ba4a[_0x64ca93(0x1e1)]+_0x64ca93(0x225)),console[_0x64ca93(0x26a)](_0x64ca93(0x22c)+_0x34538d[_0x64ca93(0x1e1)]+_0x64ca93(0x225));}else console[_0x64ca93(0x1b6)](_0x64ca93(0x209)),console[_0x64ca93(0x1b6)]('⚠️\x20Expected\x20VISA\x20private\x20key:\x20'+this[_0x64ca93(0x2b8)]),console['warn']('⚠️\x20Expected\x20VISA\x20public\x20key:\x20'+this[_0x64ca93(0x22b)]);}catch(_0x451caf){console[_0x64ca93(0x270)](_0x64ca93(0x297),_0x451caf);throw _0x451caf;}}[a46_0x360640(0x2ac)](){const _0x2d5825=a46_0x360640,_0x1a85ba=crypto_1[_0x2d5825(0x1ce)][_0x2d5825(0x2a7)](0x20),_0x36f976=crypto_1[_0x2d5825(0x1ce)][_0x2d5825(0x2a7)](0x10);return{'key':_0x1a85ba,'iv':_0x36f976};}['encryptAES'](_0x481b47,_0x3ad272,_0x346a55){const _0xcd4ded=a46_0x360640,_0x2cbe04=crypto_1[_0xcd4ded(0x1ce)][_0xcd4ded(0x2a4)](_0xcd4ded(0x263),_0x3ad272,_0x346a55);let _0x3953b3=_0x2cbe04[_0xcd4ded(0x1dc)](_0x481b47,_0xcd4ded(0x27a),'base64');return _0x3953b3+=_0x2cbe04[_0xcd4ded(0x276)]('base64'),_0x3953b3;}['encryptRSA'](_0x46303d,_0x6fd839,_0x483e11){const _0x1a818f=a46_0x360640;try{const _0x592b95=fs_1[_0x1a818f(0x1ce)][_0x1a818f(0x258)](_0x483e11,'utf8')[_0x1a818f(0x2c0)](),_0x54fd02={'iv':_0x6fd839['toString'](_0x1a818f(0x259)),'key':_0x46303d[_0x1a818f(0x2a0)]('base64')},_0x468009=JSON[_0x1a818f(0x1b9)](_0x54fd02);console[_0x1a818f(0x26a)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x468009[_0x1a818f(0x1e1)]);const _0x4e0cc8=crypto_1['default'][_0x1a818f(0x1ba)]({'key':_0x592b95,'padding':crypto_1[_0x1a818f(0x1ce)][_0x1a818f(0x2d7)][_0x1a818f(0x1f0)]},Buffer[_0x1a818f(0x1cd)](_0x468009));return console['log'](_0x1a818f(0x29b),_0x4e0cc8[_0x1a818f(0x1e1)]),_0x4e0cc8[_0x1a818f(0x2a0)](_0x1a818f(0x259));}catch(_0x525aef){console[_0x1a818f(0x270)](_0x1a818f(0x1d4),_0x525aef);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a46_0x360640(0x222)](_0x456df1,_0x488919){const _0x138257=a46_0x360640;try{const _0x36858a=fs_1[_0x138257(0x1ce)][_0x138257(0x258)](_0x488919,_0x138257(0x27a))['trim'](),_0x46ca5e=crypto_1['default'][_0x138257(0x295)](_0x138257(0x241));_0x46ca5e[_0x138257(0x1dc)](_0x456df1),_0x46ca5e[_0x138257(0x1f7)]();const _0x5b1924=_0x46ca5e['sign'](_0x36858a,_0x138257(0x259));return console['log']('🔐\x20RSA\x20signing\x20successful'),console[_0x138257(0x26a)]('📝\x20Data\x20to\x20sign\x20length:',_0x456df1['length']),console[_0x138257(0x26a)](_0x138257(0x2be),_0x5b1924['length']),_0x5b1924;}catch(_0x38a3fd){console['error'](_0x138257(0x1b8),_0x38a3fd),console['error'](_0x138257(0x2ad),_0x456df1[_0x138257(0x207)](0x0,0xc8)+'...');throw new Error(_0x138257(0x238));}}['decryptAES'](_0x4b06d8,_0x1e4640,_0x32b7ab){const _0x3bbf6b=a46_0x360640,_0x40f7da=crypto_1[_0x3bbf6b(0x1ce)][_0x3bbf6b(0x215)](_0x3bbf6b(0x263),_0x1e4640,_0x32b7ab);let _0x3a0e3c=_0x40f7da['update'](_0x4b06d8,'base64',_0x3bbf6b(0x27a));return _0x3a0e3c+=_0x40f7da['final']('utf8'),_0x3a0e3c;}async[a46_0x360640(0x1e4)](_0x4f0cdb,_0xbce0b2,_0x1cff0b='MASTERCARD'){const _0x38c6e3=a46_0x360640;try{const _0x5ee73f=await fetch(_0x38c6e3(0x236),{'method':'POST','headers':{'Content-Type':_0x38c6e3(0x2a8)},'body':JSON[_0x38c6e3(0x1b9)]({'info':_0x4f0cdb,'key':_0xbce0b2,'card_type':_0x1cff0b[_0x38c6e3(0x2c9)]()})});if(!_0x5ee73f['ok'])throw new Error(_0x38c6e3(0x2b5));return await _0x5ee73f[_0x38c6e3(0x20a)]();}catch(_0x4104c2){console[_0x38c6e3(0x270)](_0x38c6e3(0x1b0),_0x4104c2);throw new Error(_0x38c6e3(0x283));}}[a46_0x360640(0x1fc)](_0x260395,_0x1ed62b){const _0x40c451=a46_0x360640;try{const _0x33dc09=fs_1[_0x40c451(0x1ce)]['readFileSync'](this[_0x40c451(0x27f)],'utf8')[_0x40c451(0x2c0)](),_0x504cbc=crypto_1[_0x40c451(0x1ce)]['privateDecrypt'](_0x33dc09,Buffer[_0x40c451(0x1cd)](_0x1ed62b,_0x40c451(0x259))),_0x17a9ae=JSON[_0x40c451(0x29f)](_0x504cbc[_0x40c451(0x2a0)]()),_0x4f23ed=Buffer[_0x40c451(0x1cd)](_0x17a9ae[_0x40c451(0x1ca)],_0x40c451(0x259)),_0xf27404=Buffer[_0x40c451(0x1cd)](_0x17a9ae['iv'],_0x40c451(0x259));return this[_0x40c451(0x24f)](_0x260395,_0x4f23ed,_0xf27404);}catch(_0x5bf880){throw new Error(_0x40c451(0x2d3));}}async['processCardPayment'](_0x456912){const _0x3189c1=a46_0x360640,{paymentId:_0x4db71e,orderId:_0x259fb9,amount:_0x16dc56,currency:_0x3ae072,cardData:_0x226110,resultUrl:_0x195155,returnUrl:_0x47c553,cardHolder:_0xb86c37,browser:_0x44dfe0}=_0x456912;console[_0x3189c1(0x26a)](_0x3189c1(0x251)),console[_0x3189c1(0x26a)](_0x3189c1(0x2ca),_0x4db71e),console[_0x3189c1(0x26a)](_0x3189c1(0x2b7),_0x259fb9),console['log'](_0x3189c1(0x2a1),_0x16dc56,_0x3ae072),console[_0x3189c1(0x26a)]('Card\x20Number:',this[_0x3189c1(0x1d2)](_0x226110[_0x3189c1(0x226)])),console[_0x3189c1(0x26a)](_0x3189c1(0x1b5),_0xb86c37[_0x3189c1(0x2cd)]+'\x20'+_0xb86c37[_0x3189c1(0x27d)]),console[_0x3189c1(0x26a)](_0x3189c1(0x24e),_0x47c553),console['log']('Result\x20URL:',_0x195155);const _0x1d6c4c=this[_0x3189c1(0x202)](_0x226110[_0x3189c1(0x226)]);console[_0x3189c1(0x26a)](_0x3189c1(0x239)+_0x1d6c4c[_0x3189c1(0x2b4)]+_0x3189c1(0x1c4)+_0x1d6c4c[_0x3189c1(0x291)]),console[_0x3189c1(0x26a)]('🔐\x20Using\x20keys:\x20'+_0x1d6c4c['privateKeyPath']+',\x20'+_0x1d6c4c[_0x3189c1(0x288)]);const _0xf5d955={'amount':_0x16dc56,'currency':_0x3ae072[_0x3189c1(0x280)](),'order_id':_0x259fb9,'result_url':_0x195155,'return_url':_0x47c553,'country':'','card':{'number':_0x226110['number'],'expire_month':_0x226110[_0x3189c1(0x262)],'expire_year':_0x226110[_0x3189c1(0x2a9)],'cvv':_0x226110[_0x3189c1(0x220)]},'card_holder':_0xb86c37,'browser':_0x44dfe0},_0x1ed25a=JSON[_0x3189c1(0x1b9)](_0xf5d955);console[_0x3189c1(0x26a)](_0x3189c1(0x1be)),console['log']('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console[_0x3189c1(0x26a)](_0x1ed25a),console[_0x3189c1(0x26a)]('📝\x20Data\x20length:',_0x1ed25a[_0x3189c1(0x1e1)]);try{const {key:_0x23a37c,iv:_0x22d316}=this[_0x3189c1(0x2ac)]();console['log']('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console[_0x3189c1(0x26a)](_0x3189c1(0x253),_0x23a37c[_0x3189c1(0x1e1)]),console[_0x3189c1(0x26a)]('🔐\x20AES\x20IV\x20length:',_0x22d316['length']);const _0x3503ac=this['encryptAES'](_0x1ed25a,_0x23a37c,_0x22d316);console['log']('🔐\x20Data\x20encrypted\x20with\x20AES'),console['log']('📝\x20Encrypted\x20data\x20length:',_0x3503ac['length']);const _0xdcccb1=this[_0x3189c1(0x1ac)](_0x23a37c,_0x22d316,_0x1d6c4c['publicKeyPath']);console['log'](_0x3189c1(0x240)),console[_0x3189c1(0x26a)](_0x3189c1(0x28e),_0xdcccb1[_0x3189c1(0x1e1)]);const _0x1c8356=this[_0x3189c1(0x222)](_0x1ed25a,_0x1d6c4c['privateKeyPath']);console[_0x3189c1(0x26a)](_0x3189c1(0x292)),console[_0x3189c1(0x26a)](_0x3189c1(0x2be),_0x1c8356[_0x3189c1(0x1e1)]);const _0x47ce04={'merchant_point_id':_0x1d6c4c[_0x3189c1(0x208)],'method':_0x3189c1(0x2af),'info':_0x3503ac,'key':_0xdcccb1,'sign':_0x1c8356,'lang':'en'};console[_0x3189c1(0x26a)](_0x3189c1(0x243)),console[_0x3189c1(0x26a)](_0x3189c1(0x271)),console['log']('\x20\x20\x20-\x20merchant_point_id:',_0x1d6c4c[_0x3189c1(0x208)]),console[_0x3189c1(0x26a)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x3189c1(0x26a)]('\x20\x20\x20-\x20info\x20length:',_0x3503ac[_0x3189c1(0x1e1)]),console[_0x3189c1(0x26a)]('\x20\x20\x20-\x20key\x20length:',_0xdcccb1[_0x3189c1(0x1e1)]),console[_0x3189c1(0x26a)](_0x3189c1(0x1c7),_0x1c8356[_0x3189c1(0x1e1)]),console['log'](_0x3189c1(0x2b0)),loggerService_1[_0x3189c1(0x255)][_0x3189c1(0x20b)](_0x1d6c4c[_0x3189c1(0x2b4)][_0x3189c1(0x2c9)](),'/charge',_0x3189c1(0x2cf),{'merchant_point_id':_0x1d6c4c[_0x3189c1(0x208)],'method':_0x3189c1(0x2af),'lang':'en'});const _0x212979=Date['now'](),_0x516524=await fetch(_0x1d6c4c['apiUrl'],{'method':_0x3189c1(0x2cf),'headers':{'Content-Type':_0x3189c1(0x2a8),'Accept':_0x3189c1(0x2a8),'User-Agent':_0x3189c1(0x28b)},'body':JSON[_0x3189c1(0x1b9)](_0x47ce04)}),_0x4d9cde=Date[_0x3189c1(0x2b1)]()-_0x212979;console[_0x3189c1(0x26a)](_0x3189c1(0x267)),console[_0x3189c1(0x26a)]('Status:',_0x516524[_0x3189c1(0x257)]),console[_0x3189c1(0x26a)](_0x3189c1(0x25d),_0x4d9cde+'ms');if(!_0x516524['ok']){const _0x109af6=await _0x516524[_0x3189c1(0x20a)]();console[_0x3189c1(0x270)](_0x3189c1(0x248),_0x516524[_0x3189c1(0x257)]),console[_0x3189c1(0x270)](_0x3189c1(0x265),_0x109af6),loggerService_1[_0x3189c1(0x255)][_0x3189c1(0x20e)](_0x1d6c4c[_0x3189c1(0x2b4)]['toLowerCase'](),_0x3189c1(0x2b3),_0x516524[_0x3189c1(0x257)],_0x109af6,_0x4d9cde),loggerService_1[_0x3189c1(0x255)][_0x3189c1(0x266)](_0x1d6c4c[_0x3189c1(0x2b4)][_0x3189c1(0x2c9)](),_0x3189c1(0x2c3),_0x3189c1(0x1e6)+_0x516524[_0x3189c1(0x257)]+':\x20'+_0x109af6);throw new Error(_0x3189c1(0x2c4)+_0x516524[_0x3189c1(0x257)]+_0x3189c1(0x27c)+_0x109af6);}const _0x5ea89b=await _0x516524[_0x3189c1(0x1ed)]();loggerService_1[_0x3189c1(0x255)]['logWhiteDomainResponse'](_0x1d6c4c[_0x3189c1(0x2b4)][_0x3189c1(0x2c9)](),_0x3189c1(0x2b3),_0x516524[_0x3189c1(0x257)],_0x5ea89b,_0x4d9cde),console[_0x3189c1(0x26a)]('===\x20PARSED\x20API\x20RESPONSE\x20===');let _0x12704c=_0x5ea89b;if(_0x5ea89b['info']&&_0x5ea89b['key']&&_0x5ea89b[_0x3189c1(0x28a)]){console[_0x3189c1(0x26a)](_0x3189c1(0x2aa));try{const _0x408cfe=await this[_0x3189c1(0x1e4)](_0x5ea89b['info'],_0x5ea89b[_0x3189c1(0x1ca)],_0x1d6c4c[_0x3189c1(0x2b4)]);_0x12704c=JSON[_0x3189c1(0x29f)](_0x408cfe),console[_0x3189c1(0x26a)](_0x3189c1(0x212)),loggerService_1[_0x3189c1(0x255)][_0x3189c1(0x20e)](_0x1d6c4c[_0x3189c1(0x2b4)]['toLowerCase'](),_0x3189c1(0x2ae),_0x516524[_0x3189c1(0x257)],_0x12704c,_0x4d9cde),console[_0x3189c1(0x26a)](_0x3189c1(0x293));}catch(_0x57ff7b){console[_0x3189c1(0x270)]('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x57ff7b),loggerService_1[_0x3189c1(0x255)][_0x3189c1(0x266)](_0x1d6c4c[_0x3189c1(0x2b4)]['toLowerCase'](),_0x3189c1(0x1c5),_0x3189c1(0x246)+_0x57ff7b),_0x12704c=_0x5ea89b;}}else loggerService_1[_0x3189c1(0x255)][_0x3189c1(0x20e)](_0x1d6c4c[_0x3189c1(0x2b4)]['toLowerCase'](),_0x3189c1(0x2ae),_0x516524['status'],_0x12704c,_0x4d9cde),console[_0x3189c1(0x26a)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x3189c1(0x26a)](_0x3189c1(0x22d),_0x12704c[_0x3189c1(0x257)]),console[_0x3189c1(0x26a)](_0x3189c1(0x1fd),_0x12704c['final']),console[_0x3189c1(0x26a)](_0x3189c1(0x2ca),_0x12704c[_0x3189c1(0x2c7)]),console[_0x3189c1(0x26a)]('3DS\x20URL:',_0x12704c[_0x3189c1(0x2b9)]||_0x3189c1(0x1da));if(_0x12704c[_0x3189c1(0x257)]===0x64&&_0x12704c[_0x3189c1(0x276)]===0x1)return console['log']('✅\x20Payment\x20successful'),{'gateway_payment_id':_0x12704c['payment_id']?.['toString'](),'payment_url':_0x47c553,'requires_3ds':![],'status':_0x3189c1(0x1b7),'final':!![]};if(_0x12704c[_0x3189c1(0x2b9)])return console[_0x3189c1(0x26a)](_0x3189c1(0x242)),this[_0x3189c1(0x245)](_0x4db71e,_0x259fb9,_0x12704c['payment_id']?.[_0x3189c1(0x2a0)]()||_0x259fb9,_0x1d6c4c[_0x3189c1(0x2b4)]),{'gateway_payment_id':_0x12704c[_0x3189c1(0x2c7)]?.[_0x3189c1(0x2a0)](),'payment_url':_0x12704c['3ds_url'],'requires_3ds':!![],'threeds_url':_0x12704c[_0x3189c1(0x2b9)],'status':_0x3189c1(0x22a),'final':![]};let _0xdc4426=_0x12704c[_0x3189c1(0x1df)]||_0x12704c['message']||_0x3189c1(0x2c6),_0x2dabc6=_0x12704c[_0x3189c1(0x257)],_0x1e9c6b=_0x12704c[_0x3189c1(0x276)];return console[_0x3189c1(0x26a)](_0x3189c1(0x200)+_0x2dabc6+_0x3189c1(0x286)+_0x1e9c6b+_0x3189c1(0x219)+_0xdc4426),{'gateway_payment_id':_0x12704c[_0x3189c1(0x2c7)]?.[_0x3189c1(0x2a0)](),'payment_url':_0x47c553,'requires_3ds':![],'status':_0x3189c1(0x211),'final':!![]};}catch(_0x1b09db){console['error'](_0x3189c1(0x218)),console[_0x3189c1(0x270)]('Error\x20details:',_0x1b09db),loggerService_1['loggerService'][_0x3189c1(0x266)]('visa/mastercard',_0x3189c1(0x2c3),_0x1b09db);throw new Error(_0x3189c1(0x2c8)+(_0x1b09db instanceof Error?_0x1b09db['message']:_0x3189c1(0x2c6)));}}async[a46_0x360640(0x296)](_0x2cbb6a,_0x29ced4,_0x24c956=a46_0x360640(0x1bf)){const _0x239e1b=a46_0x360640;console['log'](_0x239e1b(0x29c)+_0x24c956+_0x239e1b(0x1f6)+_0x2cbb6a+'\x20('+_0x29ced4+')');try{const _0x30db6a={'payment_id':_0x2cbb6a,'order_id':_0x29ced4},_0x129723=JSON[_0x239e1b(0x1b9)](_0x30db6a),_0x2aca2e=this[_0x239e1b(0x202)](_0x24c956==='VISA'?'4000000000000000':'5000000000000000'),{key:_0x513b45,iv:_0x22f8b3}=this[_0x239e1b(0x2ac)](),_0x3a8233=this[_0x239e1b(0x1ec)](_0x129723,_0x513b45,_0x22f8b3),_0x3a5eca=this[_0x239e1b(0x1ac)](_0x513b45,_0x22f8b3,_0x2aca2e['publicKeyPath']),_0x9101e5=this[_0x239e1b(0x222)](_0x129723,_0x2aca2e[_0x239e1b(0x27f)]),_0x531a14={'merchant_point_id':_0x2aca2e[_0x239e1b(0x208)],'method':'status','info':_0x3a8233,'key':_0x3a5eca,'sign':_0x9101e5,'lang':'en'};loggerService_1[_0x239e1b(0x255)][_0x239e1b(0x20b)](_0x24c956[_0x239e1b(0x2c9)](),_0x239e1b(0x1d5),_0x239e1b(0x2cf),{'merchant_point_id':_0x2aca2e[_0x239e1b(0x208)],'method':_0x239e1b(0x257),'lang':'en'});const _0x4d17e6=Date['now'](),_0x3b0755=await fetch(_0x2aca2e[_0x239e1b(0x291)],{'method':_0x239e1b(0x2cf),'headers':{'Content-Type':_0x239e1b(0x2a8),'Accept':_0x239e1b(0x2a8),'User-Agent':_0x239e1b(0x28b)},'body':JSON['stringify'](_0x531a14)}),_0x1b7424=Date[_0x239e1b(0x2b1)]()-_0x4d17e6;if(!_0x3b0755['ok']){const _0x28ba87=await _0x3b0755[_0x239e1b(0x20a)]();loggerService_1[_0x239e1b(0x255)]['logWhiteDomainResponse'](_0x24c956[_0x239e1b(0x2c9)](),_0x239e1b(0x277),_0x3b0755[_0x239e1b(0x257)],_0x28ba87,_0x1b7424);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3b0755[_0x239e1b(0x257)]);}const _0x40d57c=await _0x3b0755[_0x239e1b(0x1ed)]();loggerService_1[_0x239e1b(0x255)][_0x239e1b(0x20e)](_0x24c956[_0x239e1b(0x2c9)](),_0x239e1b(0x277),_0x3b0755[_0x239e1b(0x257)],_0x40d57c,_0x1b7424);let _0x18a582=_0x40d57c;if(_0x40d57c[_0x239e1b(0x1ae)]&&_0x40d57c[_0x239e1b(0x1ca)]&&_0x40d57c[_0x239e1b(0x28a)]){console[_0x239e1b(0x26a)](_0x239e1b(0x21b));try{const _0x211fb3=await this['decryptResponsePhp'](_0x40d57c['info'],_0x40d57c[_0x239e1b(0x1ca)],_0x24c956);_0x18a582=JSON[_0x239e1b(0x29f)](_0x211fb3),console[_0x239e1b(0x26a)](_0x239e1b(0x1e0)),loggerService_1[_0x239e1b(0x255)][_0x239e1b(0x20e)](_0x24c956[_0x239e1b(0x2c9)](),_0x239e1b(0x1fb),_0x3b0755['status'],_0x18a582,_0x1b7424),console[_0x239e1b(0x26a)](_0x239e1b(0x2c2));}catch(_0x138dbd){console[_0x239e1b(0x270)](_0x239e1b(0x274),_0x138dbd),loggerService_1[_0x239e1b(0x255)][_0x239e1b(0x266)](_0x24c956[_0x239e1b(0x2c9)](),_0x239e1b(0x1f2),'Status\x20decryption\x20failed:\x20'+_0x138dbd),_0x18a582=_0x40d57c;}}else loggerService_1[_0x239e1b(0x255)][_0x239e1b(0x20e)](_0x24c956[_0x239e1b(0x2c9)](),_0x239e1b(0x1fb),_0x3b0755[_0x239e1b(0x257)],_0x18a582,_0x1b7424),console[_0x239e1b(0x26a)](_0x239e1b(0x289));console[_0x239e1b(0x26a)](_0x239e1b(0x21d),{'status':_0x18a582[_0x239e1b(0x257)],'final':_0x18a582[_0x239e1b(0x276)],'payment_id':_0x18a582[_0x239e1b(0x2c7)],'desc':_0x18a582['desc']});let _0x1ca95e=_0x239e1b(0x22a);if(_0x18a582['status']===0x64&&_0x18a582[_0x239e1b(0x276)]===0x1)_0x1ca95e=_0x239e1b(0x1b7);else{if(_0x18a582['final']===0x0)_0x1ca95e=_0x239e1b(0x22a);else _0x18a582[_0x239e1b(0x276)]===0x1&&_0x18a582[_0x239e1b(0x257)]!==0x64?_0x1ca95e='FAILED':_0x1ca95e='PENDING';}return{'status':_0x1ca95e,'final':_0x18a582[_0x239e1b(0x276)]===0x1,'amount':_0x18a582['amount'],'currency':_0x18a582[_0x239e1b(0x284)],'date_success':_0x18a582[_0x239e1b(0x278)],'description':_0x18a582[_0x239e1b(0x1df)]};}catch(_0x1334f0){console[_0x239e1b(0x270)](_0x24c956+_0x239e1b(0x1dd),_0x1334f0),loggerService_1['loggerService']['logWhiteDomainError'](_0x24c956[_0x239e1b(0x2c9)](),'/status',_0x1334f0);throw new Error(_0x239e1b(0x2c1)+_0x24c956+_0x239e1b(0x1f6)+(_0x1334f0 instanceof Error?_0x1334f0[_0x239e1b(0x298)]:_0x239e1b(0x2c6)));}}[a46_0x360640(0x245)](_0x249061,_0x3dee3a,_0x5a048d,_0x880fdd){const _0x1c550f=a46_0x360640;console[_0x1c550f(0x26a)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20'+_0x880fdd+_0x1c550f(0x2d1)+_0x249061+'\x20('+_0x5a048d+')'),this[_0x1c550f(0x294)](_0x249061);const _0x1769e3=[],_0x4d3f5a=0x5*0x3c*0x3e8,_0x2f2d06=0x2*0x3c*0x3c*0x3e8,_0xcb289f=Math[_0x1c550f(0x275)](_0x2f2d06/_0x4d3f5a);console[_0x1c550f(0x26a)](_0x1c550f(0x233)+_0xcb289f+_0x1c550f(0x1d1));for(let _0x1fe718=0x1;_0x1fe718<=_0xcb289f;_0x1fe718++){const _0x2a14cd=setTimeout(async()=>{const _0x47897b=_0x1c550f;console[_0x47897b(0x26a)](_0x47897b(0x27e)+_0x880fdd+'\x20status\x20check\x20#'+_0x1fe718+'/'+_0xcb289f+_0x47897b(0x1c0)+_0x249061);try{const _0x1ce395=await this['checkPaymentStatus'](_0x5a048d,_0x3dee3a,_0x880fdd);console[_0x47897b(0x26a)]('📊\x20Status\x20check\x20#'+_0x1fe718+_0x47897b(0x235),_0x1ce395),_0x1ce395[_0x47897b(0x276)]&&(console[_0x47897b(0x26a)]('✅\x20Payment\x20'+_0x249061+_0x47897b(0x1e2)+_0x1ce395['status']+_0x47897b(0x1d7)),this[_0x47897b(0x294)](_0x249061),await this[_0x47897b(0x1d6)](_0x249061,_0x1ce395[_0x47897b(0x257)],_0x1ce395));}catch(_0x2619c0){console[_0x47897b(0x270)](_0x47897b(0x2bf)+_0x1fe718+_0x47897b(0x1e8)+_0x249061+':',_0x2619c0);}},_0x1fe718*_0x4d3f5a);_0x1769e3['push'](_0x2a14cd);}this[_0x1c550f(0x23d)][_0x1c550f(0x2cc)](_0x249061,_0x1769e3),console[_0x1c550f(0x26a)]('✅\x20Scheduled\x20'+_0xcb289f+_0x1c550f(0x217)+_0x249061);}['clearStatusTimers'](_0x5956c3){const _0x2e2d00=a46_0x360640,_0x4a55dc=this['statusCheckTimers']['get'](_0x5956c3);_0x4a55dc&&(console['log'](_0x2e2d00(0x2a6)+_0x4a55dc[_0x2e2d00(0x1e1)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x5956c3),_0x4a55dc[_0x2e2d00(0x1f1)]((_0xd94318,_0x51e715)=>{clearTimeout(_0xd94318);}),this[_0x2e2d00(0x23d)]['delete'](_0x5956c3));}async[a46_0x360640(0x1d6)](_0x1daae4,_0xd8194b,_0x5f4468){const _0x14b302=a46_0x360640;try{const _0x16ecd9=(await Promise[_0x14b302(0x25e)]()[_0x14b302(0x2a2)](()=>__importStar(require('../../config/database'))))[_0x14b302(0x1ce)],_0x1db4ee={'status':_0xd8194b[_0x14b302(0x280)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0xd8194b===_0x14b302(0x1b7)&&(_0x1db4ee[_0x14b302(0x1c8)]=new Date()),_0xd8194b==='FAILED'&&_0x5f4468['description']&&(_0x1db4ee[_0x14b302(0x23e)]=_0x5f4468['description'],console[_0x14b302(0x26a)](_0x14b302(0x1f4)+_0x5f4468[_0x14b302(0x1db)])),_0x5f4468[_0x14b302(0x1db)]&&(_0x1db4ee[_0x14b302(0x2d4)]=(_0xd8194b===_0x14b302(0x1b7)?'VISA/MasterCard\x20payment\x20successful':'VISA/MasterCard')+':\x20'+_0x5f4468[_0x14b302(0x1db)]),await _0x16ecd9[_0x14b302(0x287)][_0x14b302(0x1dc)]({'where':{'id':_0x1daae4},'data':_0x1db4ee}),console[_0x14b302(0x26a)](_0x14b302(0x1e9)+_0x1daae4+_0x14b302(0x260)+_0xd8194b),await this[_0x14b302(0x264)](_0x1daae4,_0xd8194b);}catch(_0x26bad7){console['error'](_0x14b302(0x28f)+_0x1daae4+':',_0x26bad7);}}async[a46_0x360640(0x264)](_0x4df1b6,_0x3b932a){const _0x574ba1=a46_0x360640;try{const _0x45cbf3=(await Promise['resolve']()[_0x574ba1(0x2a2)](()=>__importStar(require('../../config/database'))))[_0x574ba1(0x1ce)],{telegramBotService:_0x266785}=await Promise[_0x574ba1(0x25e)]()[_0x574ba1(0x2a2)](()=>__importStar(require(_0x574ba1(0x23b)))),_0x225550=await _0x45cbf3[_0x574ba1(0x287)][_0x574ba1(0x224)]({'where':{'id':_0x4df1b6},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x225550)return;const _0x5165da={'PAID':_0x574ba1(0x269),'FAILED':_0x574ba1(0x1cb)},_0x4bd8f5=_0x5165da[_0x3b932a];_0x4bd8f5&&await _0x266785['sendPaymentNotification'](_0x225550[_0x574ba1(0x250)],_0x225550,_0x4bd8f5),await this['sendShopWebhook'](_0x225550,_0x3b932a);}catch(_0x1f0676){console[_0x574ba1(0x270)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x1f0676);}}async['sendShopWebhook'](_0x1eb9c1,_0x20c9c8){const _0x50a126=a46_0x360640,_0x439cd8=Date[_0x50a126(0x2b1)]();try{const _0x268add=_0x1eb9c1[_0x50a126(0x26d)],_0x513b91=_0x268add[_0x50a126(0x24b)];if(!_0x513b91?.[_0x50a126(0x2cb)]){console[_0x50a126(0x26a)](_0x50a126(0x1e7)+_0x268add['id']);return;}const _0x3b85fb=_0x20c9c8===_0x50a126(0x1b7)?_0x50a126(0x273):_0x50a126(0x20d);let _0x565d20=[];if(_0x513b91[_0x50a126(0x2ba)])try{_0x565d20=Array[_0x50a126(0x1c2)](_0x513b91['webhookEvents'])?_0x513b91[_0x50a126(0x2ba)]:JSON[_0x50a126(0x29f)](_0x513b91[_0x50a126(0x2ba)]);}catch(_0xd177b2){console[_0x50a126(0x270)](_0x50a126(0x231),_0xd177b2),_0x565d20=[];}if(!_0x565d20[_0x50a126(0x1e3)](_0x3b85fb)){console[_0x50a126(0x26a)](_0x50a126(0x1fa)+_0x3b85fb+_0x50a126(0x1d8)+_0x268add['id']);return;}const _0x2fc836={'event':_0x3b85fb,'payment':{'id':_0x1eb9c1['id'],'order_id':_0x1eb9c1['orderId'],'gateway_order_id':_0x1eb9c1[_0x50a126(0x1ee)],'gateway':_0x50a126(0x290),'amount':_0x1eb9c1[_0x50a126(0x2b6)],'currency':_0x1eb9c1[_0x50a126(0x284)],'status':_0x20c9c8[_0x50a126(0x2c9)](),'customer_email':_0x1eb9c1[_0x50a126(0x1b2)],'customer_name':_0x1eb9c1[_0x50a126(0x28c)],'created_at':_0x1eb9c1[_0x50a126(0x216)],'updated_at':new Date()}},_0x3570a0=await fetch(_0x513b91[_0x50a126(0x2cb)],{'method':_0x50a126(0x2cf),'headers':{'Content-Type':_0x50a126(0x2a8),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(MasterCard)'},'body':JSON[_0x50a126(0x1b9)](_0x2fc836)}),_0x28cc07=Date[_0x50a126(0x2b1)]()-_0x439cd8;loggerService_1[_0x50a126(0x255)][_0x50a126(0x2b2)](_0x1eb9c1[_0x50a126(0x250)],_0x513b91['webhookUrl'],_0x3b85fb,_0x3570a0[_0x50a126(0x257)],_0x28cc07,_0x2fc836),console[_0x50a126(0x26a)](_0x50a126(0x26f)+_0x513b91['webhookUrl']+_0x50a126(0x232)+_0x3570a0[_0x50a126(0x257)]+'\x20('+_0x28cc07+_0x50a126(0x227));}catch(_0x2b89bd){console[_0x50a126(0x270)](_0x50a126(0x2bd),_0x2b89bd),loggerService_1[_0x50a126(0x255)][_0x50a126(0x1f8)](_0x1eb9c1[_0x50a126(0x250)],_0x1eb9c1[_0x50a126(0x26d)]?.['settings']?.[_0x50a126(0x2cb)]||_0x50a126(0x213),_0x50a126(0x23a),_0x2b89bd,{});}}['maskCardNumber'](_0x4766e0){const _0x55db3b=a46_0x360640,_0x135b00=_0x4766e0[_0x55db3b(0x1f5)](/[\s-]/g,'');if(_0x135b00[_0x55db3b(0x1e1)]<0x4)return _0x55db3b(0x204);return'****\x20****\x20****\x20'+_0x135b00[_0x55db3b(0x223)](-0x4);}async['processWebhook'](_0xe482a3,_0x2fd2a2=a46_0x360640(0x1bd)){const _0x5b6666=a46_0x360640;console['log'](_0x5b6666(0x281),JSON[_0x5b6666(0x1b9)](_0xe482a3,null,0x2));let _0x13aa8=_0xe482a3,_0x1e2f23=_0x2fd2a2;_0xe482a3['card_type']?(_0x1e2f23=_0xe482a3[_0x5b6666(0x201)]['toUpperCase']()===_0x5b6666(0x1bf)?_0x5b6666(0x1bf):_0x5b6666(0x1bd),console[_0x5b6666(0x26a)](_0x5b6666(0x22f)+_0x1e2f23)):console[_0x5b6666(0x26a)]('🔍\x20Using\x20provided\x20card\x20type:\x20'+_0x1e2f23);if(_0xe482a3['info']&&_0xe482a3[_0x5b6666(0x1ca)]&&_0xe482a3[_0x5b6666(0x28a)]){console[_0x5b6666(0x26a)](_0x5b6666(0x1bc));try{const _0x5baab5=await this[_0x5b6666(0x1e4)](_0xe482a3[_0x5b6666(0x1ae)],_0xe482a3[_0x5b6666(0x1ca)],_0x1e2f23);_0x13aa8=JSON[_0x5b6666(0x29f)](_0x5baab5),console[_0x5b6666(0x26a)](_0x5b6666(0x2ab)),console[_0x5b6666(0x26a)]('📝\x20Decrypted\x20webhook\x20data:',JSON[_0x5b6666(0x1b9)](_0x13aa8,null,0x2));}catch(_0x49a5b6){console['error'](_0x5b6666(0x2d8),_0x49a5b6),console[_0x5b6666(0x26a)](_0x5b6666(0x282)),_0x13aa8=_0xe482a3;}}else console[_0x5b6666(0x26a)](_0x5b6666(0x268));let _0x469d50='PENDING';if(_0x13aa8[_0x5b6666(0x257)]===0x64&&_0x13aa8[_0x5b6666(0x276)]===0x1)_0x469d50=_0x5b6666(0x1b7);else{if(_0x13aa8['final']===0x0)_0x469d50='PENDING';else _0x13aa8['final']===0x1&&_0x13aa8[_0x5b6666(0x257)]!==0x64?_0x469d50=_0x5b6666(0x211):_0x469d50=_0x5b6666(0x22a);}let _0x3d813f='';if(_0x13aa8[_0x5b6666(0x214)])_0x3d813f=_0x13aa8[_0x5b6666(0x214)][_0x5b6666(0x2a0)](),console['log']('🔍\x20Using\x20'+_0x1e2f23+'\x20order_id\x20for\x20search:\x20'+_0x3d813f);else _0x13aa8[_0x5b6666(0x2c7)]?(_0x3d813f=_0x13aa8[_0x5b6666(0x2c7)]['toString'](),console[_0x5b6666(0x26a)](_0x5b6666(0x25f)+_0x1e2f23+_0x5b6666(0x2d0)+_0x3d813f)):(_0x3d813f=_0x13aa8['orderId']||_0x13aa8[_0x5b6666(0x20c)]||_0x13aa8['id']||'',console['log']('🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20'+_0x3d813f));console[_0x5b6666(0x26a)](_0x5b6666(0x25a)+_0x1e2f23+_0x5b6666(0x203)),console['log']('\x20\x20\x20Payment\x20ID:\x20'+_0x3d813f+_0x5b6666(0x237)+_0x13aa8[_0x5b6666(0x214)]+_0x5b6666(0x234)+_0x13aa8[_0x5b6666(0x25c)]+_0x5b6666(0x228)+_0x13aa8[_0x5b6666(0x2c7)]+_0x5b6666(0x1ea)+_0x13aa8['paymentId']+',\x20id='+_0x13aa8['id']+')'),console[_0x5b6666(0x26a)]('\x20\x20\x20Status:\x20'+_0x469d50+_0x5b6666(0x1b4)+_0x13aa8[_0x5b6666(0x257)]+_0x5b6666(0x299)+_0x13aa8[_0x5b6666(0x276)]+')'),console[_0x5b6666(0x26a)](_0x5b6666(0x24d)+_0x13aa8[_0x5b6666(0x2b6)]),console[_0x5b6666(0x26a)](_0x5b6666(0x28d)+_0x13aa8[_0x5b6666(0x284)]);let _0x235e5e;_0x469d50===_0x5b6666(0x211)&&_0x13aa8[_0x5b6666(0x1df)]&&(_0x235e5e=_0x13aa8[_0x5b6666(0x1df)],console[_0x5b6666(0x26a)]('❌\x20Failure\x20description:\x20'+_0x235e5e));const _0x4a5559={'paymentId':_0x3d813f,'status':_0x469d50,'amount':_0x13aa8['amount'],'currency':_0x13aa8[_0x5b6666(0x284)]};return _0x235e5e&&(_0x4a5559[_0x5b6666(0x23e)]=_0x235e5e),_0x4a5559;}['stopAllStatusChecks'](){const _0x39fd4e=a46_0x360640;console['log'](_0x39fd4e(0x1bb));const _0x142a3c=this['statusCheckTimers'][_0x39fd4e(0x1cf)];for(const [_0x332452]of this[_0x39fd4e(0x23d)]){this[_0x39fd4e(0x294)](_0x332452);}console[_0x39fd4e(0x26a)](_0x39fd4e(0x1cc)+_0x142a3c+_0x39fd4e(0x1d0));}}exports[a46_0x360640(0x26b)]=VisaMasterCardService;