'use strict';const a51_0x18e050=a51_0x2f4b;(function(_0x313e08,_0x479c24){const _0x10ceab=a51_0x2f4b,_0xa46121=_0x313e08();while(!![]){try{const _0x21d50d=-parseInt(_0x10ceab(0x2ba))/0x1*(-parseInt(_0x10ceab(0x31e))/0x2)+-parseInt(_0x10ceab(0x241))/0x3*(-parseInt(_0x10ceab(0x270))/0x4)+parseInt(_0x10ceab(0x31d))/0x5+-parseInt(_0x10ceab(0x26e))/0x6+parseInt(_0x10ceab(0x30b))/0x7+parseInt(_0x10ceab(0x29b))/0x8+-parseInt(_0x10ceab(0x2f1))/0x9;if(_0x21d50d===_0x479c24)break;else _0xa46121['push'](_0xa46121['shift']());}catch(_0x3e169e){_0xa46121['push'](_0xa46121['shift']());}}}(a51_0x23bc,0x57f78));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x4e5d47,_0x3ae4f2,_0x5c5da2,_0x37edb4){const _0x317d38=a51_0x2f4b;if(_0x37edb4===undefined)_0x37edb4=_0x5c5da2;var _0x2fa313=Object['getOwnPropertyDescriptor'](_0x3ae4f2,_0x5c5da2);(!_0x2fa313||(_0x317d38(0x2b6)in _0x2fa313?!_0x3ae4f2['__esModule']:_0x2fa313[_0x317d38(0x1e8)]||_0x2fa313['configurable']))&&(_0x2fa313={'enumerable':!![],'get':function(){return _0x3ae4f2[_0x5c5da2];}}),Object[_0x317d38(0x286)](_0x4e5d47,_0x37edb4,_0x2fa313);}:function(_0xb7a4e7,_0x4064ef,_0x2220c3,_0x337974){if(_0x337974===undefined)_0x337974=_0x2220c3;_0xb7a4e7[_0x337974]=_0x4064ef[_0x2220c3];}),__setModuleDefault=this&&this[a51_0x18e050(0x1e7)]||(Object[a51_0x18e050(0x2ef)]?function(_0x29875a,_0x1327b3){const _0x1b2706=a51_0x18e050;Object['defineProperty'](_0x29875a,_0x1b2706(0x1de),{'enumerable':!![],'value':_0x1327b3});}:function(_0x24f7f4,_0x48030a){const _0x2b6538=a51_0x18e050;_0x24f7f4[_0x2b6538(0x1de)]=_0x48030a;}),__importStar=this&&this['__importStar']||(function(){var _0x19a949=function(_0x105ab1){const _0x3f2a8c=a51_0x2f4b;return _0x19a949=Object[_0x3f2a8c(0x22e)]||function(_0x3e936e){const _0x11409a=_0x3f2a8c;var _0xdd4753=[];for(var _0x1ab7d2 in _0x3e936e)if(Object[_0x11409a(0x2b7)][_0x11409a(0x21e)][_0x11409a(0x263)](_0x3e936e,_0x1ab7d2))_0xdd4753[_0xdd4753[_0x11409a(0x2de)]]=_0x1ab7d2;return _0xdd4753;},_0x19a949(_0x105ab1);};return function(_0x264fe9){const _0x26e922=a51_0x2f4b;if(_0x264fe9&&_0x264fe9['__esModule'])return _0x264fe9;var _0xf55c2a={};if(_0x264fe9!=null){for(var _0x2a7483=_0x19a949(_0x264fe9),_0x5827db=0x0;_0x5827db<_0x2a7483[_0x26e922(0x2de)];_0x5827db++)if(_0x2a7483[_0x5827db]!==_0x26e922(0x1de))__createBinding(_0xf55c2a,_0x264fe9,_0x2a7483[_0x5827db]);}return __setModuleDefault(_0xf55c2a,_0x264fe9),_0xf55c2a;};}()),__importDefault=this&&this[a51_0x18e050(0x326)]||function(_0x2edfcd){const _0x549ce2=a51_0x18e050;return _0x2edfcd&&_0x2edfcd[_0x549ce2(0x277)]?_0x2edfcd:{'default':_0x2edfcd};};Object[a51_0x18e050(0x286)](exports,'__esModule',{'value':!![]}),exports[a51_0x18e050(0x283)]=void 0x0;function a51_0x2f4b(_0x56a11e,_0x59b0b4){const _0x23bccd=a51_0x23bc();return a51_0x2f4b=function(_0x2f4b15,_0x201052){_0x2f4b15=_0x2f4b15-0x1c9;let _0x319f9c=_0x23bccd[_0x2f4b15];return _0x319f9c;},a51_0x2f4b(_0x56a11e,_0x59b0b4);}function a51_0x23bc(){const _0x4419ff=['🔐\x20Response\x20is\x20encrypted,\x20decrypting...','https://api2.trapay.uk/decrypt.php','expire_month','PENDING','🔍\x20Using\x20provided\x20card\x20type:\x20','Payment\x20System/1.0','No\x20New\x20payment','sendShopWebhook','The\x20card\x20does\x20not\x20exist','Payment\x20prohibited','\x20\x20Cleaned:\x20\x20\x22','first_name','system','Method\x20not\x20allowed','default','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','🔐\x20Data\x20signed\x20with\x20RSA','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','order_id','LookUp\x20not\x20confirmed','No\x20Error\x20executing\x20request','Payment\x20cancellation\x20is\x20being\x20processed','/charge','__setModuleDefault','writable','visaPublicKeyPath','loggerService','❌\x20Detailed\x20failure\x20description:\x20',',\x20paymentId=','text','\x20failed\x20for\x20payment\x20','decryptResponse','/charge_decrypted','HTTP\x20Status:','Request\x20data\x20error','Failed\x20to\x20check\x20','🔐\x20VISA\x20Public\x20key\x20length:\x20','\x20not\x20enabled\x20for\x20shop\x20','logWhiteDomainRequest','\x20characters','🔍\x20Using\x20','Unsuccessful\x20payment','The\x20card\x20is\x20lost\x20or\x20stolen','Sender\x27s\x20card\x20details\x20are\x20required','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','Decryption\x20failed:\x20','Error\x20parsing\x20webhook\x20events:','../loggerService','substring','Cash\x20payment\x20is\x20expected\x20at\x20TCO','logShopWebhookError','signRSA','merchantPointId','📝\x20Signature\x20length:','\x20\x20\x20Status:\x20','visaPrivateKeyPath','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','3ds_url',',\x20orderId=','...','date_success','validateKeyFiles','desc','checkPaymentStatus','set','/status','Card\x20Holder:','Failed\x20payment','unknown','paidAt','apiUrl','encryptAES','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','🔍\x20','join','getCardTypeAndApi',',\x20id=','isArray','hasOwnProperty','scheduleStatusChecks','🔐\x20AES\x20IV\x20length:','masterCardMerchantPointId','🔐\x20Using\x20keys:\x20','-----END','Response\x20Time:','🧹\x20Clearing\x20','🔐\x20AES\x20key\x20length:','Failed\x20to\x20send\x20MasterCard\x20webhook:','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','now','ms)','Sender\x27s\x20CVV\x20card\x20is\x20required','payment.failed','getOwnPropertyNames','✅\x20Status\x20response\x20decrypted\x20successfully','📊\x20','gatewayOrderId','-----BEGIN','base64','then','last_name','amount','push','/status_decrypted','application/json','Failed\x20to\x20decrypt\x20response','VISA/MasterCard\x20payment\x20successful','crypto','end',',\x20Desc:\x20','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','🔐\x20VISA\x20Private\x20key\x20length:\x20','1185leCcyo','\x20payment:\x20','\x20payment_id\x20for\x20search:\x20','\x20\x20\x20-\x20method:\x20charge','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','Order\x20ID:','\x20status\x20updated\x20to\x20','charAt','Payment\x20ID:','===\x20PARSED\x20API\x20RESPONSE\x20===','Status\x20','decryptAES','✅\x20Scheduled\x20','shop','currency','warn','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','generateAESKey','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20',',\x20Final:\x20','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','payment_id','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','🎯\x20Using\x20','clearStatusTimers','✅\x20Payment\x20successful','webhook_send','/charge_raw','❌\x20RSA\x20encryption\x20failed:','statusCheckTimers','call','aes-256-ctr','❌\x20Status\x20check\x20#','Unknown\x20error','****','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','readFileSync','replace','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','none','json','191646HWtLHq','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','5668FoyuPw','randomBytes','Status\x20decryption\x20failed:\x20','description','logWhiteDomainError','forEach','publicKeyPath','__esModule','trim','****\x20****\x20****\x20','Payment\x20System/1.0\x20(MasterCard)','\x20for\x20payment\x20','info','💾\x20Saving\x20failure\x20message:\x20','❌\x20PHP\x20decryptor\x20request\x20failed:','⏰\x20Scheduling\x20status\x20checks\x20for\x20','sendPaymentNotification','📝\x20Data\x20length:','parse','VisaMasterCardService','\x20\x20\x20Amount:\x20','\x20result:','defineProperty','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','🔐\x203DS\x20verification\x20required','createDecipheriv','POST','\x22\x20|\x20\x22','stopAllStatusChecks','\x20with\x20status\x20','visaApiUrl','\x20status\x20check\x20#','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','key','includes','processCardPayment','webhookUrl','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','Recipient\x20data\x20required','stringify','Expected\x20bitcoin\x20transfer\x20from\x20client','number','2637176wzpYuL','charge','visaMerchantPointId','sign','settings','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','Response\x20Body:','📝\x20Final\x20request\x20structure:','path','📊\x20Status\x20check\x20result:','card_type','VISA/MasterCard','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','/status_raw','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','LookUp\x20code\x20sent','createdAt','FAILED','customerEmail','decryptResponsePhp','existsSync',',\x20body:\x20','utf8','Cancellation\x20is\x20not\x20possible','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','Client\x20OTP\x20confirmation\x20required','get','prototype','LookUp\x20number\x20of\x20attempts\x20exceeded','status','127541Dxhwrn','🔐\x20AES\x20key\x20and\x20IV\x20generated','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','3DS\x20verification\x20required','shopId','✅\x20Payment\x20','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','https://api.paydmeth.com/api','💳\x20VISA/MasterCard\x20service\x20initialized','\x20MasterCard\x20status\x20check\x20timers','LookUp\x20code\x20verified','🔐\x20MasterCard\x20Public\x20key\x20path:','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','cwd','failed','Sender\x20information\x20required','toLowerCase',',\x20final=','🧹\x20Card\x20holder\x20names\x20cleaned:','HTTP\x20error!\x20status:\x20','/charge_decrypt','\x20\x20\x20-\x20merchant_point_id:','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','cardType','webhookEvents','log','getDetailedErrorMessage','\x20\x20\x20Payment\x20ID:\x20','\x20\x20\x20Currency:\x20','⏰\x20Will\x20check\x20status\x20','🔐\x20MasterCard\x20API\x20URL:','createCipheriv','📊\x20Status\x20check\x20#','failureMessage','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','keys','length','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','Status:','logWhiteDomainResponse','),\x20defaulting\x20to\x20MasterCard','Number\x20of\x20attempts\x20exceeded','update','Card\x20Number:','VISA','\x20payment\x20status:\x20','private.pem','Another\x20unknown\x20error','privateDecrypt','💾\x20Payment\x20data\x20prepared','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','error','create','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','15452829qtQXai','Payment\x20confirmation\x20required','processWebhook','paymentId','❌\x20Data\x20being\x20signed:','\x20|\x20Response:\x20','constants','PIN\x20code\x20confirmation\x20awaited','Error\x20details:','expire_year','\x20\x20\x20-\x20info\x20length:','findUnique','updatePaymentStatus','\x20webhook\x20extracted\x20data:','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','visa_public.pem','\x20\x20\x20-\x20key\x20length:','MasterCard\x20webhook\x20sent\x20to\x20','Test\x20payment','final','3DS\x20URL:','isFinalStatus','paid','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','📊\x20Checking\x20','payment','2241134gfcLRe','encryptRSA','resolve','Payment\x20returned','PAID','toUpperCase','Operation\x20completed\x20successfully','from','Webhook\x20event\x20','createSign','orderId','masterCardApiUrl','privateKeyPath','floor','🔐\x20RSA\x20signing\x20successful','🛑\x20Stopped\x20','MASTERCARD','toString','1947730CinzzK','8gJxqbS','RSA_PKCS1_PADDING','Captcha\x20confirmation\x20awaited','\x20is\x20final\x20(','HTTP\x20','\x20\x20Original:\x20\x22','../../config/database','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','__importDefault','customerName','paymentStatuses','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','Awaiting\x20confirmation\x20by\x20ivr\x20call','\x20(from:\x20order_id=','🔐\x20Data\x20encrypted\x20with\x20AES','visa_private.pem','Payment\x20is\x20being\x20processed','message','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','🔐\x20VISA\x20API\x20URL:','Transaction\x20limit\x20exceeded'];a51_0x23bc=function(){return _0x4419ff;};return a51_0x23bc();}const crypto_1=__importDefault(require(a51_0x18e050(0x23c))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x18e050(0x2a3))),loggerService_1=require(a51_0x18e050(0x1ff));class VisaMasterCardService{constructor(){const _0x514009=a51_0x18e050;this[_0x514009(0x262)]=new Map(),this[_0x514009(0x328)]={0x0:{'final':![],'description':_0x514009(0x1d6)},0x1:{'final':![],'description':_0x514009(0x1e4)},0x2:{'final':!![],'description':_0x514009(0x1f2)},0x3:{'final':!![],'description':_0x514009(0x2e9)},0x4:{'final':!![],'description':_0x514009(0x1f9)},0x5:{'final':!![],'description':_0x514009(0x2a7)},0x6:{'final':!![],'description':_0x514009(0x30e)},0x7:{'final':!![],'description':_0x514009(0x303)},0x8:{'final':![],'description':_0x514009(0x2b5)},0x9:{'final':![],'description':_0x514009(0x2bd)},0xa:{'final':![],'description':_0x514009(0x22c)},0xb:{'final':![],'description':_0x514009(0x2c9)},0xc:{'final':![],'description':_0x514009(0x297)},0xd:{'final':![],'description':_0x514009(0x1df)},0xe:{'final':![],'description':_0x514009(0x32a)},0xf:{'final':![],'description':_0x514009(0x2f8)},0x10:{'final':![],'description':_0x514009(0x320)},0x11:{'final':![],'description':_0x514009(0x253)},0x12:{'final':![],'description':'Awaiting\x20confirmation\x20in\x20the\x20application'},0x13:{'final':![],'description':_0x514009(0x1cb)},0x14:{'final':![],'description':_0x514009(0x1cd)},0x15:{'final':![],'description':_0x514009(0x299)},0x16:{'final':![],'description':'Payment\x20pending\x20verification'},0x18:{'final':![],'description':_0x514009(0x2f0)},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':_0x514009(0x201)},0x1b:{'final':![],'description':_0x514009(0x258)},0x1c:{'final':![],'description':_0x514009(0x208)},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':_0x514009(0x2ed)},0x20:{'final':![],'description':_0x514009(0x2ff)},0x23:{'final':![],'description':_0x514009(0x1fb)},0x24:{'final':!![],'description':'Payment\x20confirmation\x20time\x20has\x20expired'},0x25:{'final':!![],'description':_0x514009(0x1d9)},0x26:{'final':!![],'description':_0x514009(0x2ec)},0x27:{'final':!![],'description':'Insufficient\x20funds\x20on\x20the\x20card'},0x28:{'final':!![],'description':_0x514009(0x1d8)},0x29:{'final':!![],'description':_0x514009(0x1fa)},0x2a:{'final':!![],'description':'Invalid\x20expiration\x20date'},0x2b:{'final':!![],'description':_0x514009(0x1cf)},0x2c:{'final':!![],'description':_0x514009(0x308)},0x2d:{'final':!![],'description':_0x514009(0x213)},0x2e:{'final':!![],'description':_0x514009(0x1f9)},0x2f:{'final':!![],'description':'Unsuccessful\x20payment'},0x30:{'final':!![],'description':_0x514009(0x2dc)},0x31:{'final':![],'description':_0x514009(0x2f2)},0x32:{'final':!![],'description':_0x514009(0x1dd)},0x33:{'final':!![],'description':_0x514009(0x213)},0x34:{'final':!![],'description':'Failed\x20payment'},0x35:{'final':!![],'description':_0x514009(0x213)},0x36:{'final':!![],'description':_0x514009(0x213)},0x37:{'final':!![],'description':_0x514009(0x213)},0x38:{'final':!![],'description':_0x514009(0x2b3)},0x39:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank'},0x3a:{'final':![],'description':_0x514009(0x2ab)},0x3b:{'final':!![],'description':_0x514009(0x2c4)},0x3c:{'final':!![],'description':_0x514009(0x2e3)},0x3d:{'final':!![],'description':_0x514009(0x2c6)},0x3e:{'final':!![],'description':_0x514009(0x2aa)},0x3f:{'final':!![],'description':'Payment\x20returned'},0x40:{'final':![],'description':_0x514009(0x1e3)},0x41:{'final':!![],'description':_0x514009(0x2b8)},0x42:{'final':![],'description':_0x514009(0x1e5)},0x43:{'final':!![],'description':_0x514009(0x218)},0x44:{'final':![],'description':_0x514009(0x2bd)},0x45:{'final':!![],'description':_0x514009(0x213)},0x46:{'final':!![],'description':_0x514009(0x213)},0x47:{'final':!![],'description':'Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details'},0x64:{'final':!![],'description':_0x514009(0x311)}},this[_0x514009(0x316)]=_0x514009(0x2c1),this['masterCardMerchantPointId']=0x6e4,this['privateKeyPath']=path_1['default'][_0x514009(0x21a)](process[_0x514009(0x2c7)](),'keys',_0x514009(0x2e8)),this[_0x514009(0x276)]=path_1[_0x514009(0x1de)]['join'](process['cwd'](),_0x514009(0x2dd),'psp_public.pem'),this[_0x514009(0x28e)]='https://api.paydmeth.com/api',this[_0x514009(0x29d)]=0x6b7,this[_0x514009(0x207)]=path_1[_0x514009(0x1de)][_0x514009(0x21a)](process[_0x514009(0x2c7)](),_0x514009(0x2dd),_0x514009(0x1ca)),this[_0x514009(0x1e9)]=path_1['default'][_0x514009(0x21a)](process['cwd'](),_0x514009(0x2dd),_0x514009(0x300)),console[_0x514009(0x2d3)](_0x514009(0x2c2)),console[_0x514009(0x2d3)](_0x514009(0x2d8),this[_0x514009(0x316)]),console[_0x514009(0x2d3)](_0x514009(0x1ce),this[_0x514009(0x28e)]),console['log']('🔐\x20MasterCard\x20Private\x20key\x20path:',this[_0x514009(0x317)]),console[_0x514009(0x2d3)](_0x514009(0x2c5),this[_0x514009(0x276)]),console[_0x514009(0x2d3)]('🔐\x20VISA\x20Private\x20key\x20path:',this[_0x514009(0x207)]),console['log']('🔐\x20VISA\x20Public\x20key\x20path:',this[_0x514009(0x1e9)]),this[_0x514009(0x20d)]();}[a51_0x18e050(0x2d4)](_0x5947a3,_0x47d720){const _0x113c93=a51_0x18e050,_0xfb315a=this[_0x113c93(0x328)][_0x5947a3];let _0x58447b='';_0xfb315a?_0x58447b=_0x113c93(0x24d)+_0x5947a3+':\x20'+_0xfb315a[_0x113c93(0x273)]:_0x58447b=_0x113c93(0x24d)+_0x5947a3+':\x20Unknown\x20status\x20code';if(_0x47d720&&_0x47d720[_0x113c93(0x278)]()){const _0x1ca49f=_0x47d720[_0x113c93(0x278)]();(!_0xfb315a||_0x1ca49f[_0x113c93(0x2ca)]()!==_0xfb315a[_0x113c93(0x273)][_0x113c93(0x2ca)]())&&(_0x58447b+=_0x113c93(0x2f6)+_0x1ca49f);}return _0x58447b;}[a51_0x18e050(0x306)](_0x47273d){const _0x409ff3=a51_0x18e050,_0x4e6c0d=this['paymentStatuses'][_0x47273d];return _0x4e6c0d?_0x4e6c0d[_0x409ff3(0x304)]:!![];}[a51_0x18e050(0x21b)](_0x22a676){const _0x5cf4c=a51_0x18e050,_0x11d577=_0x22a676[_0x5cf4c(0x24a)](0x0);if(_0x11d577==='4')return console[_0x5cf4c(0x2d3)]('💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)'),{'cardType':_0x5cf4c(0x2e6),'apiUrl':this[_0x5cf4c(0x28e)],'privateKeyPath':this[_0x5cf4c(0x207)],'publicKeyPath':this[_0x5cf4c(0x1e9)],'merchantPointId':this['visaMerchantPointId']};else return _0x11d577==='5'?(console[_0x5cf4c(0x2d3)](_0x5cf4c(0x2a9)),{'cardType':_0x5cf4c(0x31b),'apiUrl':this[_0x5cf4c(0x316)],'privateKeyPath':this[_0x5cf4c(0x317)],'publicKeyPath':this[_0x5cf4c(0x276)],'merchantPointId':this[_0x5cf4c(0x221)]}):(console['log'](_0x5cf4c(0x246)+_0x11d577+_0x5cf4c(0x2e2)),{'cardType':_0x5cf4c(0x31b),'apiUrl':this[_0x5cf4c(0x316)],'privateKeyPath':this[_0x5cf4c(0x317)],'publicKeyPath':this[_0x5cf4c(0x276)],'merchantPointId':this['masterCardMerchantPointId']});}[a51_0x18e050(0x20d)](){const _0x3f67f5=a51_0x18e050;try{if(!fs_1[_0x3f67f5(0x1de)]['existsSync'](this[_0x3f67f5(0x317)]))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this[_0x3f67f5(0x317)]);if(!fs_1[_0x3f67f5(0x1de)][_0x3f67f5(0x2b0)](this['publicKeyPath']))throw new Error(_0x3f67f5(0x2d0)+this[_0x3f67f5(0x276)]);const _0x1820b9=fs_1['default'][_0x3f67f5(0x269)](this[_0x3f67f5(0x317)],'utf8')[_0x3f67f5(0x278)](),_0x2e5165=fs_1[_0x3f67f5(0x1de)][_0x3f67f5(0x269)](this[_0x3f67f5(0x276)],_0x3f67f5(0x2b2))[_0x3f67f5(0x278)]();if(!_0x1820b9[_0x3f67f5(0x293)](_0x3f67f5(0x232))||!_0x1820b9[_0x3f67f5(0x293)]('-----END'))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x2e5165[_0x3f67f5(0x293)]('-----BEGIN')||!_0x2e5165[_0x3f67f5(0x293)](_0x3f67f5(0x223)))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x3f67f5(0x2d3)]('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console[_0x3f67f5(0x2d3)]('🔐\x20MasterCard\x20Private\x20key\x20length:\x20'+_0x1820b9['length']+_0x3f67f5(0x1f7)),console[_0x3f67f5(0x2d3)](_0x3f67f5(0x23f)+_0x2e5165[_0x3f67f5(0x2de)]+'\x20characters');if(fs_1[_0x3f67f5(0x1de)][_0x3f67f5(0x2b0)](this[_0x3f67f5(0x207)])&&fs_1['default'][_0x3f67f5(0x2b0)](this['visaPublicKeyPath'])){const _0x28878a=fs_1['default']['readFileSync'](this[_0x3f67f5(0x207)],_0x3f67f5(0x2b2))[_0x3f67f5(0x278)](),_0x3e9ca0=fs_1[_0x3f67f5(0x1de)][_0x3f67f5(0x269)](this['visaPublicKeyPath'],_0x3f67f5(0x2b2))[_0x3f67f5(0x278)]();(!_0x28878a[_0x3f67f5(0x293)](_0x3f67f5(0x232))||!_0x28878a[_0x3f67f5(0x293)](_0x3f67f5(0x223)))&&console[_0x3f67f5(0x252)]('⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),(!_0x3e9ca0['includes'](_0x3f67f5(0x232))||!_0x3e9ca0[_0x3f67f5(0x293)](_0x3f67f5(0x223)))&&console['warn'](_0x3f67f5(0x229)),console[_0x3f67f5(0x2d3)]('✅\x20VISA\x20key\x20files\x20validated\x20successfully'),console['log'](_0x3f67f5(0x240)+_0x28878a[_0x3f67f5(0x2de)]+_0x3f67f5(0x1f7)),console[_0x3f67f5(0x2d3)](_0x3f67f5(0x1f4)+_0x3e9ca0[_0x3f67f5(0x2de)]+_0x3f67f5(0x1f7));}else console[_0x3f67f5(0x252)](_0x3f67f5(0x25a)),console[_0x3f67f5(0x252)]('⚠️\x20Expected\x20VISA\x20private\x20key:\x20'+this['visaPrivateKeyPath']),console[_0x3f67f5(0x252)](_0x3f67f5(0x329)+this[_0x3f67f5(0x1e9)]);}catch(_0x34e6bc){console['error'](_0x3f67f5(0x287),_0x34e6bc);throw _0x34e6bc;}}[a51_0x18e050(0x254)](){const _0x18fafc=a51_0x18e050,_0x2b4a86=crypto_1['default']['randomBytes'](0x20),_0x37121c=crypto_1[_0x18fafc(0x1de)][_0x18fafc(0x271)](0x10);return{'key':_0x2b4a86,'iv':_0x37121c};}[a51_0x18e050(0x217)](_0x4c2c3d,_0x3d652b,_0x1da830){const _0x490782=a51_0x18e050,_0x5c8425=crypto_1[_0x490782(0x1de)][_0x490782(0x2d9)](_0x490782(0x264),_0x3d652b,_0x1da830);let _0x20e158=_0x5c8425[_0x490782(0x2e4)](_0x4c2c3d,_0x490782(0x2b2),_0x490782(0x233));return _0x20e158+=_0x5c8425['final'](_0x490782(0x233)),_0x20e158;}[a51_0x18e050(0x30c)](_0x43540c,_0x264d1d,_0x1b4f91){const _0x488fc2=a51_0x18e050;try{const _0x2ab74e=fs_1[_0x488fc2(0x1de)][_0x488fc2(0x269)](_0x1b4f91,_0x488fc2(0x2b2))[_0x488fc2(0x278)](),_0x4ce493={'iv':_0x264d1d[_0x488fc2(0x31c)]('base64'),'key':_0x43540c[_0x488fc2(0x31c)]('base64')},_0x1f53cd=JSON['stringify'](_0x4ce493);console['log'](_0x488fc2(0x1fc),_0x1f53cd[_0x488fc2(0x2de)]);const _0x1f2aa3=crypto_1[_0x488fc2(0x1de)]['publicEncrypt']({'key':_0x2ab74e,'padding':crypto_1[_0x488fc2(0x1de)][_0x488fc2(0x2f7)][_0x488fc2(0x31f)]},Buffer[_0x488fc2(0x312)](_0x1f53cd));return console[_0x488fc2(0x2d3)]('✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x1f2aa3[_0x488fc2(0x2de)]),_0x1f2aa3[_0x488fc2(0x31c)](_0x488fc2(0x233));}catch(_0x3ff97f){console[_0x488fc2(0x2ee)](_0x488fc2(0x261),_0x3ff97f);throw new Error(_0x488fc2(0x1e1));}}[a51_0x18e050(0x203)](_0x3c8263,_0x5ece28){const _0xa6435d=a51_0x18e050;try{const _0xc3f4ec=fs_1['default'][_0xa6435d(0x269)](_0x5ece28,'utf8')[_0xa6435d(0x278)](),_0x5e393b=crypto_1[_0xa6435d(0x1de)][_0xa6435d(0x314)]('SHA256');_0x5e393b[_0xa6435d(0x2e4)](_0x3c8263),_0x5e393b[_0xa6435d(0x23d)]();const _0x417a6d=_0x5e393b[_0xa6435d(0x29e)](_0xc3f4ec,'base64');return console[_0xa6435d(0x2d3)](_0xa6435d(0x319)),console['log']('📝\x20Data\x20to\x20sign\x20length:',_0x3c8263['length']),console[_0xa6435d(0x2d3)](_0xa6435d(0x205),_0x417a6d[_0xa6435d(0x2de)]),_0x417a6d;}catch(_0x574776){console['error']('❌\x20RSA\x20signing\x20failed:',_0x574776),console[_0xa6435d(0x2ee)](_0xa6435d(0x2f5),_0x3c8263[_0xa6435d(0x200)](0x0,0xc8)+_0xa6435d(0x20b));throw new Error(_0xa6435d(0x2b4));}}['decryptAES'](_0x2397a1,_0xad703e,_0x4807c6){const _0x3df39b=a51_0x18e050,_0x855d3=crypto_1[_0x3df39b(0x1de)][_0x3df39b(0x289)](_0x3df39b(0x264),_0xad703e,_0x4807c6);let _0x4a03b2=_0x855d3[_0x3df39b(0x2e4)](_0x2397a1,_0x3df39b(0x233),_0x3df39b(0x2b2));return _0x4a03b2+=_0x855d3[_0x3df39b(0x304)](_0x3df39b(0x2b2)),_0x4a03b2;}async[a51_0x18e050(0x2af)](_0x322f68,_0xd6688d,_0xed1488=a51_0x18e050(0x31b)){const _0x5798f2=a51_0x18e050;try{const _0x273a6c=await fetch(_0x5798f2(0x1d1),{'method':_0x5798f2(0x28a),'headers':{'Content-Type':'application/json'},'body':JSON[_0x5798f2(0x298)]({'info':_0x322f68,'key':_0xd6688d,'card_type':_0xed1488[_0x5798f2(0x2ca)]()})});if(!_0x273a6c['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x273a6c['text']();}catch(_0x514ca3){console[_0x5798f2(0x2ee)](_0x5798f2(0x27e),_0x514ca3);throw new Error(_0x5798f2(0x26b));}}[a51_0x18e050(0x1ef)](_0x2372fc,_0x2104f4){const _0x3d6e82=a51_0x18e050;try{const _0x4586e2=fs_1['default']['readFileSync'](this[_0x3d6e82(0x317)],_0x3d6e82(0x2b2))['trim'](),_0x30e4c8=crypto_1[_0x3d6e82(0x1de)][_0x3d6e82(0x2ea)](_0x4586e2,Buffer[_0x3d6e82(0x312)](_0x2104f4,_0x3d6e82(0x233))),_0x5792e8=JSON[_0x3d6e82(0x282)](_0x30e4c8[_0x3d6e82(0x31c)]()),_0x8f7ae5=Buffer[_0x3d6e82(0x312)](_0x5792e8[_0x3d6e82(0x292)],_0x3d6e82(0x233)),_0x13d5dc=Buffer[_0x3d6e82(0x312)](_0x5792e8['iv'],_0x3d6e82(0x233));return this[_0x3d6e82(0x24e)](_0x2372fc,_0x8f7ae5,_0x13d5dc);}catch(_0x467032){throw new Error(_0x3d6e82(0x23a));}}async[a51_0x18e050(0x294)](_0xd05fee){const _0x5340a3=a51_0x18e050,{paymentId:_0x22b531,orderId:_0x35565b,amount:_0x3322de,currency:_0x5411b7,cardData:_0x10dbfb,resultUrl:_0xa3053e,returnUrl:_0x55e4a1,cardHolder:_0x57e6aa,browser:_0x4d8645}=_0xd05fee;console[_0x5340a3(0x2d3)](_0x5340a3(0x2bc)),console[_0x5340a3(0x2d3)](_0x5340a3(0x24b),_0x22b531),console[_0x5340a3(0x2d3)](_0x5340a3(0x248),_0x35565b),console['log']('Amount:',_0x3322de,_0x5411b7),console['log'](_0x5340a3(0x2e5),this['maskCardNumber'](_0x10dbfb[_0x5340a3(0x29a)])),console[_0x5340a3(0x2d3)](_0x5340a3(0x212),_0x57e6aa[_0x5340a3(0x1db)]+'\x20'+_0x57e6aa[_0x5340a3(0x235)]),console[_0x5340a3(0x2d3)]('Return\x20URL:',_0x55e4a1),console['log']('Result\x20URL:',_0xa3053e);const _0x24e623=this[_0x5340a3(0x21b)](_0x10dbfb[_0x5340a3(0x29a)]);console['log'](_0x5340a3(0x25c)+_0x24e623[_0x5340a3(0x2d1)]+'\x20API:\x20'+_0x24e623[_0x5340a3(0x216)]),console['log'](_0x5340a3(0x222)+_0x24e623[_0x5340a3(0x317)]+',\x20'+_0x24e623[_0x5340a3(0x276)]);const _0x2ac787={..._0x57e6aa,'first_name':_0x57e6aa[_0x5340a3(0x1db)]?.[_0x5340a3(0x26a)](/[\t\n\r\f\v]/g,'\x20')[_0x5340a3(0x278)]()||'','last_name':_0x57e6aa[_0x5340a3(0x235)]?.[_0x5340a3(0x26a)](/[\t\n\r\f\v]/g,'\x20')[_0x5340a3(0x278)]()||''};console['log'](_0x5340a3(0x2cc)),console[_0x5340a3(0x2d3)](_0x5340a3(0x323)+_0x57e6aa[_0x5340a3(0x1db)]+_0x5340a3(0x28b)+_0x57e6aa[_0x5340a3(0x235)]+'\x22'),console['log'](_0x5340a3(0x1da)+_0x2ac787['first_name']+_0x5340a3(0x28b)+_0x2ac787['last_name']+'\x22');const _0x754d14={'amount':_0x3322de,'currency':_0x5411b7[_0x5340a3(0x310)](),'order_id':_0x35565b,'result_url':_0xa3053e,'return_url':_0x55e4a1,'country':'','card':{'number':_0x10dbfb[_0x5340a3(0x29a)],'expire_month':_0x10dbfb[_0x5340a3(0x1d2)],'expire_year':_0x10dbfb[_0x5340a3(0x2fa)],'cvv':_0x10dbfb['cvv']},'card_holder':_0x2ac787,'browser':_0x4d8645},_0x69487=JSON[_0x5340a3(0x298)](_0x754d14);console[_0x5340a3(0x2d3)](_0x5340a3(0x2eb)),console['log'](_0x5340a3(0x2a0)),console['log'](_0x69487),console['log'](_0x5340a3(0x281),_0x69487['length']);try{const {key:_0x56b145,iv:_0x5eaf7d}=this['generateAESKey']();console[_0x5340a3(0x2d3)](_0x5340a3(0x2bb)),console['log'](_0x5340a3(0x226),_0x56b145[_0x5340a3(0x2de)]),console['log'](_0x5340a3(0x220),_0x5eaf7d[_0x5340a3(0x2de)]);const _0x1f9195=this['encryptAES'](_0x69487,_0x56b145,_0x5eaf7d);console[_0x5340a3(0x2d3)](_0x5340a3(0x1c9)),console['log']('📝\x20Encrypted\x20data\x20length:',_0x1f9195[_0x5340a3(0x2de)]);const _0x14e017=this[_0x5340a3(0x30c)](_0x56b145,_0x5eaf7d,_0x24e623[_0x5340a3(0x276)]);console[_0x5340a3(0x2d3)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console['log']('📝\x20Encrypted\x20key\x20length:',_0x14e017[_0x5340a3(0x2de)]);const _0x1142c9=this[_0x5340a3(0x203)](_0x69487,_0x24e623[_0x5340a3(0x317)]);console['log'](_0x5340a3(0x1e0)),console[_0x5340a3(0x2d3)](_0x5340a3(0x205),_0x1142c9[_0x5340a3(0x2de)]);const _0x274a63={'merchant_point_id':_0x24e623[_0x5340a3(0x204)],'method':_0x5340a3(0x29c),'info':_0x1f9195,'key':_0x14e017,'sign':_0x1142c9,'lang':'en'};console['log']('📤\x20Sending\x20request\x20to\x20API...'),console[_0x5340a3(0x2d3)](_0x5340a3(0x2a2)),console['log'](_0x5340a3(0x2cf),_0x24e623[_0x5340a3(0x204)]),console[_0x5340a3(0x2d3)](_0x5340a3(0x244)),console[_0x5340a3(0x2d3)](_0x5340a3(0x2fb),_0x1f9195[_0x5340a3(0x2de)]),console['log'](_0x5340a3(0x301),_0x14e017[_0x5340a3(0x2de)]),console[_0x5340a3(0x2d3)]('\x20\x20\x20-\x20sign\x20length:',_0x1142c9[_0x5340a3(0x2de)]),console['log']('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x5340a3(0x1ea)]['logWhiteDomainRequest'](_0x24e623[_0x5340a3(0x2d1)][_0x5340a3(0x2ca)](),_0x5340a3(0x1e6),_0x5340a3(0x28a),{'merchant_point_id':_0x24e623[_0x5340a3(0x204)],'method':_0x5340a3(0x29c),'lang':'en'});const _0x17eea0=Date['now'](),_0x300c31=await fetch(_0x24e623[_0x5340a3(0x216)],{'method':'POST','headers':{'Content-Type':_0x5340a3(0x239),'Accept':'application/json','User-Agent':_0x5340a3(0x1d5)},'body':JSON['stringify'](_0x274a63)}),_0x5bbd17=Date[_0x5340a3(0x22a)]()-_0x17eea0;console[_0x5340a3(0x2d3)]('===\x20API\x20RESPONSE\x20==='),console[_0x5340a3(0x2d3)](_0x5340a3(0x2e0),_0x300c31[_0x5340a3(0x2b9)]),console['log'](_0x5340a3(0x224),_0x5bbd17+'ms');if(!_0x300c31['ok']){const _0x43635c=await _0x300c31[_0x5340a3(0x1ed)]();console[_0x5340a3(0x2ee)](_0x5340a3(0x1f1),_0x300c31[_0x5340a3(0x2b9)]),console[_0x5340a3(0x2ee)](_0x5340a3(0x2a1),_0x43635c),loggerService_1[_0x5340a3(0x1ea)][_0x5340a3(0x2e1)](_0x24e623[_0x5340a3(0x2d1)]['toLowerCase'](),_0x5340a3(0x260),_0x300c31['status'],_0x43635c,_0x5bbd17),loggerService_1['loggerService']['logWhiteDomainError'](_0x24e623['cardType']['toLowerCase'](),'/charge',_0x5340a3(0x322)+_0x300c31[_0x5340a3(0x2b9)]+':\x20'+_0x43635c);throw new Error(_0x5340a3(0x2cd)+_0x300c31[_0x5340a3(0x2b9)]+_0x5340a3(0x2b1)+_0x43635c);}const _0x50f518=await _0x300c31['json']();loggerService_1[_0x5340a3(0x1ea)][_0x5340a3(0x2e1)](_0x24e623[_0x5340a3(0x2d1)][_0x5340a3(0x2ca)](),'/charge_raw',_0x300c31['status'],_0x50f518,_0x5bbd17),console[_0x5340a3(0x2d3)](_0x5340a3(0x24c));let _0x518b73=_0x50f518;if(_0x50f518[_0x5340a3(0x27c)]&&_0x50f518[_0x5340a3(0x292)]&&_0x50f518[_0x5340a3(0x29e)]){console[_0x5340a3(0x2d3)](_0x5340a3(0x1d0));try{const _0x4ada7f=await this[_0x5340a3(0x2af)](_0x50f518['info'],_0x50f518[_0x5340a3(0x292)],_0x24e623[_0x5340a3(0x2d1)]);_0x518b73=JSON[_0x5340a3(0x282)](_0x4ada7f),console[_0x5340a3(0x2d3)](_0x5340a3(0x268)),loggerService_1[_0x5340a3(0x1ea)][_0x5340a3(0x2e1)](_0x24e623[_0x5340a3(0x2d1)][_0x5340a3(0x2ca)](),_0x5340a3(0x1f0),_0x300c31[_0x5340a3(0x2b9)],_0x518b73,_0x5bbd17),console[_0x5340a3(0x2d3)](_0x5340a3(0x325));}catch(_0x153973){console['error'](_0x5340a3(0x247),_0x153973),loggerService_1[_0x5340a3(0x1ea)]['logWhiteDomainError'](_0x24e623[_0x5340a3(0x2d1)][_0x5340a3(0x2ca)](),_0x5340a3(0x2ce),_0x5340a3(0x1fd)+_0x153973),_0x518b73=_0x50f518;}}else loggerService_1[_0x5340a3(0x1ea)][_0x5340a3(0x2e1)](_0x24e623[_0x5340a3(0x2d1)][_0x5340a3(0x2ca)](),_0x5340a3(0x1f0),_0x300c31[_0x5340a3(0x2b9)],_0x518b73,_0x5bbd17),console[_0x5340a3(0x2d3)](_0x5340a3(0x245));console[_0x5340a3(0x2d3)](_0x5340a3(0x2e0),_0x518b73[_0x5340a3(0x2b9)]),console[_0x5340a3(0x2d3)]('Final:',_0x518b73['final']),console[_0x5340a3(0x2d3)](_0x5340a3(0x24b),_0x518b73[_0x5340a3(0x259)]),console[_0x5340a3(0x2d3)](_0x5340a3(0x305),_0x518b73[_0x5340a3(0x209)]||_0x5340a3(0x26c));if(_0x518b73[_0x5340a3(0x2b9)]===0x64&&_0x518b73[_0x5340a3(0x304)]===0x1)return console[_0x5340a3(0x2d3)](_0x5340a3(0x25e)),{'gateway_payment_id':_0x518b73[_0x5340a3(0x259)]?.[_0x5340a3(0x31c)](),'payment_url':_0x55e4a1,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x518b73['3ds_url'])return console[_0x5340a3(0x2d3)](_0x5340a3(0x288)),this[_0x5340a3(0x21f)](_0x22b531,_0x35565b,_0x518b73[_0x5340a3(0x259)]?.[_0x5340a3(0x31c)]()||_0x35565b,_0x24e623[_0x5340a3(0x2d1)]),{'gateway_payment_id':_0x518b73['payment_id']?.[_0x5340a3(0x31c)](),'payment_url':_0x518b73['3ds_url'],'requires_3ds':!![],'threeds_url':_0x518b73[_0x5340a3(0x209)],'status':_0x5340a3(0x1d3),'final':![]};let _0x558753=this[_0x5340a3(0x2d4)](_0x518b73[_0x5340a3(0x2b9)],_0x518b73[_0x5340a3(0x20e)]||_0x518b73[_0x5340a3(0x1cc)]),_0x58e9c7=_0x518b73['status'],_0x40f42b=this[_0x5340a3(0x306)](_0x518b73[_0x5340a3(0x2b9)]);return console[_0x5340a3(0x2d3)]('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x58e9c7+_0x5340a3(0x257)+_0x40f42b+_0x5340a3(0x23e)+_0x558753),{'gateway_payment_id':_0x518b73[_0x5340a3(0x259)]?.[_0x5340a3(0x31c)](),'payment_url':_0x55e4a1,'requires_3ds':![],'status':'FAILED','final':!![],'errorMessage':_0x558753};}catch(_0x49bb0f){console[_0x5340a3(0x2ee)]('===\x20PAYMENT\x20SERVICE\x20ERROR\x20==='),console[_0x5340a3(0x2ee)](_0x5340a3(0x2f9),_0x49bb0f),loggerService_1[_0x5340a3(0x1ea)][_0x5340a3(0x274)]('visa/mastercard',_0x5340a3(0x1e6),_0x49bb0f);throw new Error(_0x5340a3(0x2c0)+(_0x49bb0f instanceof Error?_0x49bb0f['message']:_0x5340a3(0x266)));}}async[a51_0x18e050(0x20f)](_0x2b9e85,_0x42bd7c,_0x4b30fb=a51_0x18e050(0x2e6)){const _0x3b738a=a51_0x18e050;console['log'](_0x3b738a(0x309)+_0x4b30fb+_0x3b738a(0x2e7)+_0x2b9e85+'\x20('+_0x42bd7c+')');try{const _0x3aa948={'payment_id':_0x2b9e85,'order_id':_0x42bd7c},_0x1f0cbc=JSON[_0x3b738a(0x298)](_0x3aa948),_0x39ca92=this[_0x3b738a(0x21b)](_0x4b30fb===_0x3b738a(0x2e6)?'4000000000000000':'5000000000000000'),{key:_0x11d8e4,iv:_0x43ce0e}=this[_0x3b738a(0x254)](),_0x509898=this[_0x3b738a(0x217)](_0x1f0cbc,_0x11d8e4,_0x43ce0e),_0x45a914=this[_0x3b738a(0x30c)](_0x11d8e4,_0x43ce0e,_0x39ca92[_0x3b738a(0x276)]),_0x404e19=this[_0x3b738a(0x203)](_0x1f0cbc,_0x39ca92[_0x3b738a(0x317)]),_0x4a9e92={'merchant_point_id':_0x39ca92['merchantPointId'],'method':_0x3b738a(0x2b9),'info':_0x509898,'key':_0x45a914,'sign':_0x404e19,'lang':'en'};loggerService_1[_0x3b738a(0x1ea)][_0x3b738a(0x1f6)](_0x4b30fb[_0x3b738a(0x2ca)](),_0x3b738a(0x211),_0x3b738a(0x28a),{'merchant_point_id':_0x39ca92['merchantPointId'],'method':_0x3b738a(0x2b9),'lang':'en'});const _0x2ae453=Date[_0x3b738a(0x22a)](),_0xad05df=await fetch(_0x39ca92[_0x3b738a(0x216)],{'method':_0x3b738a(0x28a),'headers':{'Content-Type':_0x3b738a(0x239),'Accept':_0x3b738a(0x239),'User-Agent':_0x3b738a(0x1d5)},'body':JSON[_0x3b738a(0x298)](_0x4a9e92)}),_0x2789e0=Date[_0x3b738a(0x22a)]()-_0x2ae453;if(!_0xad05df['ok']){const _0x2ec547=await _0xad05df[_0x3b738a(0x1ed)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4b30fb[_0x3b738a(0x2ca)](),_0x3b738a(0x2a8),_0xad05df[_0x3b738a(0x2b9)],_0x2ec547,_0x2789e0);throw new Error('HTTP\x20error!\x20status:\x20'+_0xad05df[_0x3b738a(0x2b9)]);}const _0x52d8c2=await _0xad05df[_0x3b738a(0x26d)]();loggerService_1[_0x3b738a(0x1ea)][_0x3b738a(0x2e1)](_0x4b30fb[_0x3b738a(0x2ca)](),'/status_raw',_0xad05df[_0x3b738a(0x2b9)],_0x52d8c2,_0x2789e0);let _0x40513e=_0x52d8c2;if(_0x52d8c2[_0x3b738a(0x27c)]&&_0x52d8c2['key']&&_0x52d8c2[_0x3b738a(0x29e)]){console['log'](_0x3b738a(0x290));try{const _0x47e856=await this['decryptResponsePhp'](_0x52d8c2[_0x3b738a(0x27c)],_0x52d8c2[_0x3b738a(0x292)],_0x4b30fb);_0x40513e=JSON['parse'](_0x47e856),console[_0x3b738a(0x2d3)](_0x3b738a(0x22f)),loggerService_1[_0x3b738a(0x1ea)]['logWhiteDomainResponse'](_0x4b30fb[_0x3b738a(0x2ca)](),_0x3b738a(0x238),_0xad05df[_0x3b738a(0x2b9)],_0x40513e,_0x2789e0),console[_0x3b738a(0x2d3)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x110e15){console['error'](_0x3b738a(0x296),_0x110e15),loggerService_1[_0x3b738a(0x1ea)][_0x3b738a(0x274)](_0x4b30fb[_0x3b738a(0x2ca)](),'/status_decrypt',_0x3b738a(0x272)+_0x110e15),_0x40513e=_0x52d8c2;}}else loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4b30fb[_0x3b738a(0x2ca)](),_0x3b738a(0x238),_0xad05df[_0x3b738a(0x2b9)],_0x40513e,_0x2789e0),console['log'](_0x3b738a(0x228));console[_0x3b738a(0x2d3)](_0x3b738a(0x2a4),{'status':_0x40513e[_0x3b738a(0x2b9)],'final':_0x40513e[_0x3b738a(0x304)],'payment_id':_0x40513e['payment_id'],'desc':_0x40513e[_0x3b738a(0x20e)]});let _0x4fc381=_0x3b738a(0x1d3);if(_0x40513e[_0x3b738a(0x2b9)]===0x64&&_0x40513e[_0x3b738a(0x304)]===0x1)_0x4fc381=_0x3b738a(0x30f);else{if(_0x40513e['final']===0x0||!this[_0x3b738a(0x306)](_0x40513e[_0x3b738a(0x2b9)]))_0x4fc381='PENDING';else _0x40513e[_0x3b738a(0x304)]===0x1||this[_0x3b738a(0x306)](_0x40513e[_0x3b738a(0x2b9)])?_0x4fc381=_0x3b738a(0x2ad):_0x4fc381=_0x3b738a(0x1d3);}const _0x280b88=this['getDetailedErrorMessage'](_0x40513e['status'],_0x40513e[_0x3b738a(0x20e)]);return{'status':_0x4fc381,'final':this[_0x3b738a(0x306)](_0x40513e['status']),'amount':_0x40513e[_0x3b738a(0x236)],'currency':_0x40513e[_0x3b738a(0x251)],'date_success':_0x40513e[_0x3b738a(0x20c)],'description':_0x280b88};}catch(_0x5883b9){console['error'](_0x4b30fb+'\x20status\x20check\x20error:',_0x5883b9),loggerService_1[_0x3b738a(0x1ea)][_0x3b738a(0x274)](_0x4b30fb[_0x3b738a(0x2ca)](),'/status',_0x5883b9);throw new Error(_0x3b738a(0x1f3)+_0x4b30fb+_0x3b738a(0x2e7)+(_0x5883b9 instanceof Error?_0x5883b9[_0x3b738a(0x1cc)]:_0x3b738a(0x266)));}}[a51_0x18e050(0x21f)](_0x515c81,_0x2be516,_0x178228,_0x21e845){const _0x1aac64=a51_0x18e050;console[_0x1aac64(0x2d3)](_0x1aac64(0x27f)+_0x21e845+_0x1aac64(0x242)+_0x515c81+'\x20('+_0x178228+')'),this[_0x1aac64(0x25d)](_0x515c81);const _0x41b7d4=[],_0x4e1f7b=0x5*0x3c*0x3e8,_0x54d40a=0x2*0x3c*0x3c*0x3e8,_0x417dba=Math[_0x1aac64(0x318)](_0x54d40a/_0x4e1f7b);console['log'](_0x1aac64(0x2d7)+_0x417dba+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x513e8c=0x1;_0x513e8c<=_0x417dba;_0x513e8c++){const _0x848f6b=setTimeout(async()=>{const _0x10e60e=_0x1aac64;console[_0x10e60e(0x2d3)](_0x10e60e(0x219)+_0x21e845+_0x10e60e(0x28f)+_0x513e8c+'/'+_0x417dba+_0x10e60e(0x27b)+_0x515c81);try{const _0x15771f=await this['checkPaymentStatus'](_0x178228,_0x2be516,_0x21e845);console[_0x10e60e(0x2d3)](_0x10e60e(0x2da)+_0x513e8c+_0x10e60e(0x285),_0x15771f),_0x15771f[_0x10e60e(0x304)]&&(console[_0x10e60e(0x2d3)]('✅\x20Payment\x20'+_0x515c81+_0x10e60e(0x321)+_0x15771f['status']+'),\x20stopping\x20status\x20checks'),this['clearStatusTimers'](_0x515c81),await this[_0x10e60e(0x2fd)](_0x515c81,_0x15771f[_0x10e60e(0x2b9)],_0x15771f));}catch(_0x170da7){console[_0x10e60e(0x2ee)](_0x10e60e(0x265)+_0x513e8c+_0x10e60e(0x1ee)+_0x515c81+':',_0x170da7);}},_0x513e8c*_0x4e1f7b);_0x41b7d4[_0x1aac64(0x237)](_0x848f6b);}this[_0x1aac64(0x262)][_0x1aac64(0x210)](_0x515c81,_0x41b7d4),console[_0x1aac64(0x2d3)](_0x1aac64(0x24f)+_0x417dba+'\x20status\x20checks\x20for\x20payment\x20'+_0x515c81);}[a51_0x18e050(0x25d)](_0x49f1d1){const _0x542768=a51_0x18e050,_0x1db922=this[_0x542768(0x262)][_0x542768(0x2b6)](_0x49f1d1);_0x1db922&&(console['log'](_0x542768(0x225)+_0x1db922[_0x542768(0x2de)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x49f1d1),_0x1db922[_0x542768(0x275)]((_0x3e7f33,_0x13f643)=>{clearTimeout(_0x3e7f33);}),this['statusCheckTimers']['delete'](_0x49f1d1));}async['updatePaymentStatus'](_0x4bbfcb,_0x38217c,_0x59607a){const _0x5a982d=a51_0x18e050;try{const _0x247485=(await Promise[_0x5a982d(0x30d)]()[_0x5a982d(0x234)](()=>__importStar(require(_0x5a982d(0x324)))))['default'],_0x145da2={'status':_0x38217c[_0x5a982d(0x310)](),'updatedAt':new Date(),'statusChangedBy':_0x5a982d(0x1dc),'statusChangedAt':new Date()};_0x38217c===_0x5a982d(0x30f)&&(_0x145da2[_0x5a982d(0x215)]=new Date()),_0x38217c===_0x5a982d(0x2ad)&&_0x59607a[_0x5a982d(0x273)]&&(_0x145da2[_0x5a982d(0x2db)]=_0x59607a['description'],console[_0x5a982d(0x2d3)](_0x5a982d(0x27d)+_0x59607a[_0x5a982d(0x273)])),_0x59607a[_0x5a982d(0x273)]&&(_0x145da2['adminNotes']=(_0x38217c===_0x5a982d(0x30f)?_0x5a982d(0x23b):_0x5a982d(0x2a6))+':\x20'+_0x59607a[_0x5a982d(0x273)]),await _0x247485['payment'][_0x5a982d(0x2e4)]({'where':{'id':_0x4bbfcb},'data':_0x145da2}),console[_0x5a982d(0x2d3)](_0x5a982d(0x2bf)+_0x4bbfcb+_0x5a982d(0x249)+_0x38217c),await this['sendPaymentNotifications'](_0x4bbfcb,_0x38217c);}catch(_0x71ec96){console[_0x5a982d(0x2ee)](_0x5a982d(0x256)+_0x4bbfcb+':',_0x71ec96);}}async['sendPaymentNotifications'](_0x3e3dcc,_0x48d3cc){const _0x20f5d6=a51_0x18e050;try{const _0x2a47db=(await Promise[_0x20f5d6(0x30d)]()[_0x20f5d6(0x234)](()=>__importStar(require('../../config/database'))))[_0x20f5d6(0x1de)],{telegramBotService:_0x35a72d}=await Promise['resolve']()[_0x20f5d6(0x234)](()=>__importStar(require('../telegramBotService'))),_0x2816e0=await _0x2a47db[_0x20f5d6(0x30a)][_0x20f5d6(0x2fc)]({'where':{'id':_0x3e3dcc},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x2816e0)return;const _0x133003={'PAID':_0x20f5d6(0x307),'FAILED':_0x20f5d6(0x2c8)},_0x5fef19=_0x133003[_0x48d3cc];_0x5fef19&&await _0x35a72d[_0x20f5d6(0x280)](_0x2816e0[_0x20f5d6(0x2be)],_0x2816e0,_0x5fef19),await this['sendShopWebhook'](_0x2816e0,_0x48d3cc);}catch(_0x17868b){console[_0x20f5d6(0x2ee)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x17868b);}}async[a51_0x18e050(0x1d7)](_0x5b2d52,_0x1c9b2b){const _0x29ee3e=a51_0x18e050,_0x3d1e97=Date['now']();try{const _0x28626b=_0x5b2d52['shop'],_0x3d21d4=_0x28626b[_0x29ee3e(0x29f)];if(!_0x3d21d4?.[_0x29ee3e(0x295)]){console[_0x29ee3e(0x2d3)](_0x29ee3e(0x26f)+_0x28626b['id']);return;}const _0x2dea01=_0x1c9b2b==='PAID'?'payment.success':_0x29ee3e(0x22d);let _0x34d4cb=[];if(_0x3d21d4[_0x29ee3e(0x2d2)])try{_0x34d4cb=Array[_0x29ee3e(0x21d)](_0x3d21d4[_0x29ee3e(0x2d2)])?_0x3d21d4['webhookEvents']:JSON['parse'](_0x3d21d4['webhookEvents']);}catch(_0x296d83){console['error'](_0x29ee3e(0x1fe),_0x296d83),_0x34d4cb=[];}if(!_0x34d4cb['includes'](_0x2dea01)){console['log'](_0x29ee3e(0x313)+_0x2dea01+_0x29ee3e(0x1f5)+_0x28626b['id']);return;}const _0x4198fe={'event':_0x2dea01,'payment':{'id':_0x5b2d52['id'],'order_id':_0x5b2d52[_0x29ee3e(0x315)],'gateway_order_id':_0x5b2d52[_0x29ee3e(0x231)],'gateway':'1111','amount':_0x5b2d52[_0x29ee3e(0x236)],'currency':_0x5b2d52[_0x29ee3e(0x251)],'status':_0x1c9b2b[_0x29ee3e(0x2ca)](),'customer_email':_0x5b2d52[_0x29ee3e(0x2ae)],'customer_name':_0x5b2d52[_0x29ee3e(0x327)],'created_at':_0x5b2d52[_0x29ee3e(0x2ac)],'updated_at':new Date()}},_0x5c55a2=await fetch(_0x3d21d4[_0x29ee3e(0x295)],{'method':_0x29ee3e(0x28a),'headers':{'Content-Type':_0x29ee3e(0x239),'User-Agent':_0x29ee3e(0x27a)},'body':JSON['stringify'](_0x4198fe)}),_0x45474e=Date[_0x29ee3e(0x22a)]()-_0x3d1e97;loggerService_1['loggerService']['logShopWebhookSent'](_0x5b2d52[_0x29ee3e(0x2be)],_0x3d21d4[_0x29ee3e(0x295)],_0x2dea01,_0x5c55a2[_0x29ee3e(0x2b9)],_0x45474e,_0x4198fe),console['log'](_0x29ee3e(0x302)+_0x3d21d4[_0x29ee3e(0x295)]+_0x29ee3e(0x28d)+_0x5c55a2[_0x29ee3e(0x2b9)]+'\x20('+_0x45474e+_0x29ee3e(0x22b));}catch(_0x3e53a4){console[_0x29ee3e(0x2ee)](_0x29ee3e(0x227),_0x3e53a4),loggerService_1['loggerService'][_0x29ee3e(0x202)](_0x5b2d52[_0x29ee3e(0x2be)],_0x5b2d52[_0x29ee3e(0x250)]?.[_0x29ee3e(0x29f)]?.[_0x29ee3e(0x295)]||_0x29ee3e(0x214),_0x29ee3e(0x25f),_0x3e53a4,{});}}['maskCardNumber'](_0x5c53fb){const _0x377a7e=a51_0x18e050,_0x531c8c=_0x5c53fb[_0x377a7e(0x26a)](/[\s-]/g,'');if(_0x531c8c[_0x377a7e(0x2de)]<0x4)return _0x377a7e(0x267);return _0x377a7e(0x279)+_0x531c8c['slice'](-0x4);}async[a51_0x18e050(0x2f3)](_0x2d3c92,_0x414ad2=a51_0x18e050(0x31b)){const _0xd6224f=a51_0x18e050;console[_0xd6224f(0x2d3)]('🔄\x20Processing\x20MasterCard\x20webhook\x20data:',JSON[_0xd6224f(0x298)](_0x2d3c92,null,0x2));let _0xfef07b=_0x2d3c92,_0x2cfdee=_0x414ad2;_0x2d3c92[_0xd6224f(0x2a5)]?(_0x2cfdee=_0x2d3c92[_0xd6224f(0x2a5)][_0xd6224f(0x310)]()===_0xd6224f(0x2e6)?'VISA':_0xd6224f(0x31b),console[_0xd6224f(0x2d3)](_0xd6224f(0x25b)+_0x2cfdee)):console[_0xd6224f(0x2d3)](_0xd6224f(0x1d4)+_0x2cfdee);if(_0x2d3c92[_0xd6224f(0x27c)]&&_0x2d3c92[_0xd6224f(0x292)]&&_0x2d3c92[_0xd6224f(0x29e)]){console['log']('🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...');try{const _0x319b20=await this['decryptResponsePhp'](_0x2d3c92['info'],_0x2d3c92[_0xd6224f(0x292)],_0x2cfdee);_0xfef07b=JSON[_0xd6224f(0x282)](_0x319b20),console[_0xd6224f(0x2d3)](_0xd6224f(0x2df)),console[_0xd6224f(0x2d3)]('📝\x20Decrypted\x20webhook\x20data:',JSON[_0xd6224f(0x298)](_0xfef07b,null,0x2));}catch(_0x47d317){console[_0xd6224f(0x2ee)]('❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:',_0x47d317),console[_0xd6224f(0x2d3)](_0xd6224f(0x291)),_0xfef07b=_0x2d3c92;}}else console[_0xd6224f(0x2d3)](_0xd6224f(0x255));let _0x23189c=_0xd6224f(0x1d3);if(_0xfef07b[_0xd6224f(0x2b9)]===0x64&&_0xfef07b['final']===0x1)_0x23189c=_0xd6224f(0x30f);else{if(_0xfef07b[_0xd6224f(0x304)]===0x0||!this[_0xd6224f(0x306)](_0xfef07b[_0xd6224f(0x2b9)]))_0x23189c=_0xd6224f(0x1d3);else _0xfef07b[_0xd6224f(0x304)]===0x1||this[_0xd6224f(0x306)](_0xfef07b[_0xd6224f(0x2b9)])?_0x23189c=_0xd6224f(0x2ad):_0x23189c=_0xd6224f(0x1d3);}let _0x3fa83c='';if(_0xfef07b[_0xd6224f(0x1e2)])_0x3fa83c=_0xfef07b[_0xd6224f(0x1e2)]['toString'](),console['log']('🔍\x20Using\x20'+_0x2cfdee+'\x20order_id\x20for\x20search:\x20'+_0x3fa83c);else _0xfef07b['payment_id']?(_0x3fa83c=_0xfef07b[_0xd6224f(0x259)]['toString'](),console[_0xd6224f(0x2d3)](_0xd6224f(0x1f8)+_0x2cfdee+_0xd6224f(0x243)+_0x3fa83c)):(_0x3fa83c=_0xfef07b['orderId']||_0xfef07b[_0xd6224f(0x2f4)]||_0xfef07b['id']||'',console[_0xd6224f(0x2d3)]('🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20'+_0x3fa83c));console[_0xd6224f(0x2d3)](_0xd6224f(0x230)+_0x2cfdee+_0xd6224f(0x2fe)),console[_0xd6224f(0x2d3)](_0xd6224f(0x2d5)+_0x3fa83c+_0xd6224f(0x32b)+_0xfef07b[_0xd6224f(0x1e2)]+_0xd6224f(0x20a)+_0xfef07b['orderId']+',\x20payment_id='+_0xfef07b[_0xd6224f(0x259)]+_0xd6224f(0x1ec)+_0xfef07b['paymentId']+_0xd6224f(0x21c)+_0xfef07b['id']+')'),console[_0xd6224f(0x2d3)](_0xd6224f(0x206)+_0x23189c+'\x20(from:\x20status='+_0xfef07b[_0xd6224f(0x2b9)]+_0xd6224f(0x2cb)+_0xfef07b[_0xd6224f(0x304)]+')'),console['log'](_0xd6224f(0x284)+_0xfef07b[_0xd6224f(0x236)]),console[_0xd6224f(0x2d3)](_0xd6224f(0x2d6)+_0xfef07b[_0xd6224f(0x251)]);let _0x5f0a95;_0x23189c===_0xd6224f(0x2ad)&&(_0x5f0a95=this[_0xd6224f(0x2d4)](_0xfef07b[_0xd6224f(0x2b9)],_0xfef07b[_0xd6224f(0x20e)]),console['log'](_0xd6224f(0x1eb)+_0x5f0a95));const _0x32dcce={'paymentId':_0x3fa83c,'status':_0x23189c,'amount':_0xfef07b[_0xd6224f(0x236)],'currency':_0xfef07b['currency']};return _0x5f0a95&&(_0x32dcce['errorMessage']=_0x5f0a95),_0x32dcce;}[a51_0x18e050(0x28c)](){const _0x377a72=a51_0x18e050;console[_0x377a72(0x2d3)]('🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...');const _0x28bf4a=this['statusCheckTimers']['size'];for(const [_0x1edbea]of this[_0x377a72(0x262)]){this[_0x377a72(0x25d)](_0x1edbea);}console[_0x377a72(0x2d3)](_0x377a72(0x31a)+_0x28bf4a+_0x377a72(0x2c3));}}exports['VisaMasterCardService']=VisaMasterCardService;