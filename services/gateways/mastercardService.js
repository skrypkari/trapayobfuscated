'use strict';const a42_0x47b01b=a42_0x7048;(function(_0xdf95db,_0x374903){const _0x14edfe=a42_0x7048,_0x3d1a74=_0xdf95db();while(!![]){try{const _0xfd43c5=-parseInt(_0x14edfe(0x1ca))/0x1+parseInt(_0x14edfe(0x20b))/0x2+-parseInt(_0x14edfe(0x1c5))/0x3*(-parseInt(_0x14edfe(0x191))/0x4)+-parseInt(_0x14edfe(0x189))/0x5*(-parseInt(_0x14edfe(0x142))/0x6)+-parseInt(_0x14edfe(0x145))/0x7*(parseInt(_0x14edfe(0x205))/0x8)+-parseInt(_0x14edfe(0x20d))/0x9*(parseInt(_0x14edfe(0x1c3))/0xa)+parseInt(_0x14edfe(0x158))/0xb;if(_0xfd43c5===_0x374903)break;else _0x3d1a74['push'](_0x3d1a74['shift']());}catch(_0x4eb5dc){_0x3d1a74['push'](_0x3d1a74['shift']());}}}(a42_0x2e91,0xec5a9));var __createBinding=this&&this[a42_0x47b01b(0x183)]||(Object[a42_0x47b01b(0x1a2)]?function(_0x222fea,_0x2fff02,_0x39494b,_0x192b03){const _0x38e920=a42_0x47b01b;if(_0x192b03===undefined)_0x192b03=_0x39494b;var _0x4c9bdb=Object[_0x38e920(0x214)](_0x2fff02,_0x39494b);(!_0x4c9bdb||(_0x38e920(0x18d)in _0x4c9bdb?!_0x2fff02[_0x38e920(0x163)]:_0x4c9bdb[_0x38e920(0x1b1)]||_0x4c9bdb['configurable']))&&(_0x4c9bdb={'enumerable':!![],'get':function(){return _0x2fff02[_0x39494b];}}),Object[_0x38e920(0x1c6)](_0x222fea,_0x192b03,_0x4c9bdb);}:function(_0x4d64bc,_0x283e40,_0x7c8bd7,_0x3cfa33){if(_0x3cfa33===undefined)_0x3cfa33=_0x7c8bd7;_0x4d64bc[_0x3cfa33]=_0x283e40[_0x7c8bd7];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a42_0x47b01b(0x1a2)]?function(_0x4bf655,_0x47a0b2){const _0x4d6a12=a42_0x47b01b;Object[_0x4d6a12(0x1c6)](_0x4bf655,_0x4d6a12(0x1d8),{'enumerable':!![],'value':_0x47a0b2});}:function(_0x7c0f77,_0x1422f9){const _0x14dd9f=a42_0x47b01b;_0x7c0f77[_0x14dd9f(0x1d8)]=_0x1422f9;}),__importStar=this&&this[a42_0x47b01b(0x1a0)]||(function(){var _0x300bfe=function(_0x506d38){const _0x10dead=a42_0x7048;return _0x300bfe=Object[_0x10dead(0x128)]||function(_0x58c617){const _0x151edb=_0x10dead;var _0x7f2712=[];for(var _0x4f457d in _0x58c617)if(Object['prototype'][_0x151edb(0x159)]['call'](_0x58c617,_0x4f457d))_0x7f2712[_0x7f2712[_0x151edb(0x15f)]]=_0x4f457d;return _0x7f2712;},_0x300bfe(_0x506d38);};return function(_0x4df84f){const _0x3833e6=a42_0x7048;if(_0x4df84f&&_0x4df84f['__esModule'])return _0x4df84f;var _0x13f9f4={};if(_0x4df84f!=null){for(var _0x1f9be3=_0x300bfe(_0x4df84f),_0x41b55=0x0;_0x41b55<_0x1f9be3[_0x3833e6(0x15f)];_0x41b55++)if(_0x1f9be3[_0x41b55]!=='default')__createBinding(_0x13f9f4,_0x4df84f,_0x1f9be3[_0x41b55]);}return __setModuleDefault(_0x13f9f4,_0x4df84f),_0x13f9f4;};}()),__importDefault=this&&this[a42_0x47b01b(0x151)]||function(_0x5a3deb){const _0x1d7593=a42_0x47b01b;return _0x5a3deb&&_0x5a3deb[_0x1d7593(0x163)]?_0x5a3deb:{'default':_0x5a3deb};};Object['defineProperty'](exports,a42_0x47b01b(0x163),{'value':!![]}),exports['MasterCardService']=void 0x0;const crypto_1=__importDefault(require(a42_0x47b01b(0x1d9))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x47b01b(0x1ac))),loggerService_1=require(a42_0x47b01b(0x16f));class MasterCardService{constructor(){const _0x182f52=a42_0x47b01b;this[_0x182f52(0x1b7)]=new Map(),this[_0x182f52(0x136)]=_0x182f52(0x17b),this[_0x182f52(0x123)]=0x67c,this[_0x182f52(0x1d0)]=path_1[_0x182f52(0x1d8)][_0x182f52(0x164)](process[_0x182f52(0x1cb)](),_0x182f52(0x13a),'private.pem'),this[_0x182f52(0x1bd)]=path_1[_0x182f52(0x1d8)][_0x182f52(0x164)](process[_0x182f52(0x1cb)](),_0x182f52(0x13a),_0x182f52(0x1d7)),console['log'](_0x182f52(0x1f5)),console['log'](_0x182f52(0x133),this[_0x182f52(0x1d0)]),console['log'](_0x182f52(0x1dd),this[_0x182f52(0x1bd)]),this[_0x182f52(0x15c)]();}[a42_0x47b01b(0x15c)](){const _0x422ef8=a42_0x47b01b;try{if(!fs_1['default'][_0x422ef8(0x167)](this[_0x422ef8(0x1d0)]))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this['privateKeyPath']);if(!fs_1['default']['existsSync'](this['publicKeyPath']))throw new Error('Public\x20key\x20file\x20not\x20found:\x20'+this[_0x422ef8(0x1bd)]);const _0x2f9a6d=fs_1[_0x422ef8(0x1d8)][_0x422ef8(0x1c0)](this[_0x422ef8(0x1d0)],_0x422ef8(0x1ed))[_0x422ef8(0x177)](),_0x20cc8a=fs_1[_0x422ef8(0x1d8)][_0x422ef8(0x1c0)](this[_0x422ef8(0x1bd)],'utf8')['trim']();if(!_0x2f9a6d[_0x422ef8(0x146)](_0x422ef8(0x16c))||!_0x2f9a6d[_0x422ef8(0x146)](_0x422ef8(0x178)))throw new Error('Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x20cc8a[_0x422ef8(0x146)]('-----BEGIN')||!_0x20cc8a[_0x422ef8(0x146)](_0x422ef8(0x178)))throw new Error(_0x422ef8(0x195));console[_0x422ef8(0x13e)](_0x422ef8(0x1e2)),console['log']('🔐\x20Private\x20key\x20length:\x20'+_0x2f9a6d[_0x422ef8(0x15f)]+_0x422ef8(0x1ba)),console[_0x422ef8(0x13e)](_0x422ef8(0x1e0)+_0x20cc8a[_0x422ef8(0x15f)]+_0x422ef8(0x1ba));}catch(_0x1375f3){console[_0x422ef8(0x12e)](_0x422ef8(0x185),_0x1375f3);throw _0x1375f3;}}[a42_0x47b01b(0x170)](){const _0x1e4afc=a42_0x47b01b,_0x70e2db=crypto_1['default']['randomBytes'](0x20),_0x36245b=crypto_1[_0x1e4afc(0x1d8)]['randomBytes'](0x10);return{'key':_0x70e2db,'iv':_0x36245b};}[a42_0x47b01b(0x192)](_0x15a6be,_0x45ff8f,_0x135795){const _0x4db6f8=a42_0x47b01b,_0x55c9b6=crypto_1[_0x4db6f8(0x1d8)]['createCipheriv'](_0x4db6f8(0x1de),_0x45ff8f,_0x135795);let _0x4151fc=_0x55c9b6['update'](_0x15a6be,'utf8','base64');return _0x4151fc+=_0x55c9b6[_0x4db6f8(0x14a)](_0x4db6f8(0x204)),_0x4151fc;}['encryptRSA'](_0x4115f2,_0x4e5f3e){const _0x2bb56d=a42_0x47b01b;try{const _0x540c16=fs_1[_0x2bb56d(0x1d8)][_0x2bb56d(0x1c0)](this[_0x2bb56d(0x1bd)],_0x2bb56d(0x1ed))[_0x2bb56d(0x177)](),_0x31ae04={'iv':_0x4e5f3e['toString'](_0x2bb56d(0x204)),'key':_0x4115f2[_0x2bb56d(0x213)](_0x2bb56d(0x204))},_0x408a9c=JSON['stringify'](_0x31ae04);console['log'](_0x2bb56d(0x17e),_0x408a9c['length']);const _0x26fbe7=crypto_1[_0x2bb56d(0x1d8)][_0x2bb56d(0x13d)]({'key':_0x540c16,'padding':crypto_1[_0x2bb56d(0x1d8)][_0x2bb56d(0x1a5)][_0x2bb56d(0x19e)]},Buffer['from'](_0x408a9c));return console['log'](_0x2bb56d(0x194),_0x26fbe7[_0x2bb56d(0x15f)]),_0x26fbe7[_0x2bb56d(0x213)](_0x2bb56d(0x204));}catch(_0x58e390){console[_0x2bb56d(0x12e)](_0x2bb56d(0x17d),_0x58e390);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a42_0x47b01b(0x18f)](_0x4057e0){const _0x28cf95=a42_0x47b01b;try{const _0x252610=fs_1[_0x28cf95(0x1d8)][_0x28cf95(0x1c0)](this[_0x28cf95(0x1d0)],_0x28cf95(0x1ed))[_0x28cf95(0x177)](),_0x59f8de=crypto_1[_0x28cf95(0x1d8)][_0x28cf95(0x165)]('SHA256');_0x59f8de[_0x28cf95(0x15a)](_0x4057e0),_0x59f8de[_0x28cf95(0x161)]();const _0xfdcfe7=_0x59f8de[_0x28cf95(0x124)](_0x252610,_0x28cf95(0x204));return console[_0x28cf95(0x13e)](_0x28cf95(0x12a)),console[_0x28cf95(0x13e)]('📝\x20Data\x20to\x20sign\x20length:',_0x4057e0[_0x28cf95(0x15f)]),console[_0x28cf95(0x13e)](_0x28cf95(0x156),_0xfdcfe7['length']),_0xfdcfe7;}catch(_0x73cad2){console[_0x28cf95(0x12e)]('❌\x20RSA\x20signing\x20failed:',_0x73cad2),console[_0x28cf95(0x12e)](_0x28cf95(0x138),_0x4057e0[_0x28cf95(0x182)](0x0,0xc8)+_0x28cf95(0x15e));throw new Error(_0x28cf95(0x1a1));}}['decryptAES'](_0x5cfe2e,_0x3f7454,_0x2a6061){const _0x37b6a7=a42_0x47b01b,_0x3cbf3b=crypto_1[_0x37b6a7(0x1d8)][_0x37b6a7(0x1ea)](_0x37b6a7(0x1de),_0x3f7454,_0x2a6061);let _0x15242c=_0x3cbf3b[_0x37b6a7(0x15a)](_0x5cfe2e,'base64',_0x37b6a7(0x1ed));return _0x15242c+=_0x3cbf3b[_0x37b6a7(0x14a)](_0x37b6a7(0x1ed)),_0x15242c;}async[a42_0x47b01b(0x1ab)](_0x179a9b,_0x9f49d4){const _0x4bbad2=a42_0x47b01b;try{const _0x51a1f2=await fetch(_0x4bbad2(0x1b3),{'method':_0x4bbad2(0x179),'headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'info':_0x179a9b,'key':_0x9f49d4})});if(!_0x51a1f2['ok'])throw new Error(_0x4bbad2(0x1a9));return await _0x51a1f2[_0x4bbad2(0x1b5)]();}catch(_0x5e612c){console[_0x4bbad2(0x12e)](_0x4bbad2(0x206),_0x5e612c);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a42_0x47b01b(0x129)](_0x4eb3e7,_0x354a8a){const _0x2b1a43=a42_0x47b01b;try{const _0x47711d=fs_1['default']['readFileSync'](this[_0x2b1a43(0x1d0)],'utf8')[_0x2b1a43(0x177)](),_0x4a27d4=crypto_1[_0x2b1a43(0x1d8)]['privateDecrypt'](_0x47711d,Buffer[_0x2b1a43(0x20c)](_0x354a8a,_0x2b1a43(0x204))),_0xcc448b=JSON[_0x2b1a43(0x1cc)](_0x4a27d4[_0x2b1a43(0x213)]()),_0x2e9cc8=Buffer['from'](_0xcc448b[_0x2b1a43(0x181)],_0x2b1a43(0x204)),_0x1bc1c4=Buffer[_0x2b1a43(0x20c)](_0xcc448b['iv'],'base64');return this[_0x2b1a43(0x12c)](_0x4eb3e7,_0x2e9cc8,_0x1bc1c4);}catch(_0x787416){throw new Error('Failed\x20to\x20decrypt\x20response');}}async['processCardPayment'](_0x1a6d29){const _0x48885b=a42_0x47b01b,{paymentId:_0x126771,orderId:_0x4f9567,amount:_0x2238c2,currency:_0x3a1a2d,cardData:_0x53365c,resultUrl:_0x587475,returnUrl:_0x3163db,cardHolder:_0xa808a0,browser:_0x28def2}=_0x1a6d29;console[_0x48885b(0x13e)]('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console['log'](_0x48885b(0x176),_0x126771),console[_0x48885b(0x13e)](_0x48885b(0x1b6),_0x4f9567),console[_0x48885b(0x13e)](_0x48885b(0x14c),_0x2238c2,_0x3a1a2d),console[_0x48885b(0x13e)](_0x48885b(0x1ad),this[_0x48885b(0x1e6)](_0x53365c[_0x48885b(0x127)])),console[_0x48885b(0x13e)](_0x48885b(0x12b),_0xa808a0['first_name']+'\x20'+_0xa808a0[_0x48885b(0x207)]),console[_0x48885b(0x13e)](_0x48885b(0x1be),_0x3163db),console[_0x48885b(0x13e)](_0x48885b(0x122),_0x587475);const _0x16a4db={'amount':_0x2238c2,'currency':_0x3a1a2d[_0x48885b(0x17a)](),'order_id':_0x4f9567,'result_url':_0x587475,'return_url':_0x3163db,'card':{'number':_0x53365c[_0x48885b(0x127)],'expire_month':_0x53365c[_0x48885b(0x1fe)],'expire_year':_0x53365c[_0x48885b(0x134)],'cvv':_0x53365c[_0x48885b(0x1d4)]},'card_holder':_0xa808a0,'browser':_0x28def2},_0x45b88b=JSON[_0x48885b(0x148)](_0x16a4db);console[_0x48885b(0x13e)](_0x48885b(0x187)),console[_0x48885b(0x13e)](_0x48885b(0x20a)),console[_0x48885b(0x13e)](_0x45b88b),console[_0x48885b(0x13e)](_0x48885b(0x1f1),_0x45b88b[_0x48885b(0x15f)]);try{const {key:_0x4587cd,iv:_0x4de643}=this[_0x48885b(0x170)]();console[_0x48885b(0x13e)](_0x48885b(0x1aa)),console['log'](_0x48885b(0x1c1),_0x4587cd[_0x48885b(0x15f)]),console[_0x48885b(0x13e)](_0x48885b(0x1db),_0x4de643[_0x48885b(0x15f)]);const _0x1cef16=this[_0x48885b(0x192)](_0x45b88b,_0x4587cd,_0x4de643);console[_0x48885b(0x13e)](_0x48885b(0x1b2)),console[_0x48885b(0x13e)](_0x48885b(0x157),_0x1cef16[_0x48885b(0x15f)]);const _0x14dd71=this[_0x48885b(0x17c)](_0x4587cd,_0x4de643);console[_0x48885b(0x13e)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x48885b(0x13e)](_0x48885b(0x1a3),_0x14dd71[_0x48885b(0x15f)]);const _0x54aca3=this[_0x48885b(0x18f)](_0x45b88b);console[_0x48885b(0x13e)](_0x48885b(0x1f7)),console[_0x48885b(0x13e)](_0x48885b(0x156),_0x54aca3[_0x48885b(0x15f)]);const _0x501603={'merchant_point_id':this['merchantPointId'],'method':'charge','info':_0x1cef16,'key':_0x14dd71,'sign':_0x54aca3,'lang':'en'};console[_0x48885b(0x13e)](_0x48885b(0x1bf)),console['log'](_0x48885b(0x209)),console['log'](_0x48885b(0x19a),this['merchantPointId']),console[_0x48885b(0x13e)]('\x20\x20\x20-\x20method:\x20charge'),console['log'](_0x48885b(0x1fb),_0x1cef16[_0x48885b(0x15f)]),console[_0x48885b(0x13e)]('\x20\x20\x20-\x20key\x20length:',_0x14dd71[_0x48885b(0x15f)]),console[_0x48885b(0x13e)](_0x48885b(0x160),_0x54aca3['length']),console[_0x48885b(0x13e)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x48885b(0x14f)]['logWhiteDomainRequest']('mastercard',_0x48885b(0x153),_0x48885b(0x179),{'merchant_point_id':this[_0x48885b(0x123)],'method':_0x48885b(0x1b0),'lang':'en'});const _0x31f54e=Date[_0x48885b(0x1a7)](),_0x1856cf=await fetch(this[_0x48885b(0x136)],{'method':_0x48885b(0x179),'headers':{'Content-Type':'application/json','Accept':_0x48885b(0x131),'User-Agent':_0x48885b(0x1d1)},'body':JSON['stringify'](_0x501603)}),_0x1e04bf=Date[_0x48885b(0x1a7)]()-_0x31f54e;console[_0x48885b(0x13e)]('===\x20MASTERCARD\x20API\x20RESPONSE\x20==='),console[_0x48885b(0x13e)](_0x48885b(0x18a),_0x1856cf[_0x48885b(0x19b)]),console[_0x48885b(0x13e)]('Response\x20Time:',_0x1e04bf+'ms');if(!_0x1856cf['ok']){const _0x5e95cc=await _0x1856cf[_0x48885b(0x1b5)]();console[_0x48885b(0x12e)](_0x48885b(0x1b4),_0x1856cf[_0x48885b(0x19b)]),console[_0x48885b(0x12e)](_0x48885b(0x198),_0x5e95cc),loggerService_1[_0x48885b(0x14f)]['logWhiteDomainResponse'](_0x48885b(0x1fd),_0x48885b(0x188),_0x1856cf['status'],_0x5e95cc,_0x1e04bf),loggerService_1[_0x48885b(0x14f)][_0x48885b(0x202)](_0x48885b(0x1fd),_0x48885b(0x153),_0x48885b(0x1f9)+_0x1856cf['status']+':\x20'+_0x5e95cc);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1856cf[_0x48885b(0x19b)]+_0x48885b(0x15b)+_0x5e95cc);}const _0xbb275d=await _0x1856cf[_0x48885b(0x175)]();loggerService_1[_0x48885b(0x14f)][_0x48885b(0x1c2)](_0x48885b(0x1fd),'/charge_raw',_0x1856cf[_0x48885b(0x19b)],_0xbb275d,_0x1e04bf),console[_0x48885b(0x13e)](_0x48885b(0x1e9));let _0x4f3e15=_0xbb275d;if(_0xbb275d[_0x48885b(0x180)]&&_0xbb275d[_0x48885b(0x181)]&&_0xbb275d[_0x48885b(0x124)]){console[_0x48885b(0x13e)](_0x48885b(0x1a8));try{const _0x13f5ef=await this[_0x48885b(0x1ab)](_0xbb275d[_0x48885b(0x180)],_0xbb275d['key']);_0x4f3e15=JSON[_0x48885b(0x1cc)](_0x13f5ef),console[_0x48885b(0x13e)](_0x48885b(0x144)),loggerService_1[_0x48885b(0x14f)][_0x48885b(0x1c2)](_0x48885b(0x1fd),_0x48885b(0x19f),_0x1856cf[_0x48885b(0x19b)],_0x4f3e15,_0x1e04bf),console[_0x48885b(0x13e)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x101330){console[_0x48885b(0x12e)]('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x101330),loggerService_1[_0x48885b(0x14f)][_0x48885b(0x202)](_0x48885b(0x1fd),_0x48885b(0x186),'Decryption\x20failed:\x20'+_0x101330),_0x4f3e15=_0xbb275d;}}else loggerService_1[_0x48885b(0x14f)]['logWhiteDomainResponse']('mastercard',_0x48885b(0x19f),_0x1856cf['status'],_0x4f3e15,_0x1e04bf),console[_0x48885b(0x13e)](_0x48885b(0x1da));console['log'](_0x48885b(0x18a),_0x4f3e15[_0x48885b(0x19b)]),console[_0x48885b(0x13e)](_0x48885b(0x14e),_0x4f3e15[_0x48885b(0x14a)]),console[_0x48885b(0x13e)](_0x48885b(0x176),_0x4f3e15[_0x48885b(0x200)]),console[_0x48885b(0x13e)](_0x48885b(0x1e3),_0x4f3e15[_0x48885b(0x172)]||'none');if(_0x4f3e15[_0x48885b(0x19b)]===0x64&&_0x4f3e15['final']===0x1)return console['log'](_0x48885b(0x1af)),{'gateway_payment_id':_0x4f3e15[_0x48885b(0x200)]?.['toString'](),'payment_url':_0x3163db,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x4f3e15[_0x48885b(0x172)])return console[_0x48885b(0x13e)](_0x48885b(0x155)),this[_0x48885b(0x1fc)](_0x126771,_0x4f9567,_0x4f3e15['payment_id']?.[_0x48885b(0x213)]()||_0x4f9567),{'gateway_payment_id':_0x4f3e15[_0x48885b(0x200)]?.[_0x48885b(0x213)](),'payment_url':_0x4f3e15[_0x48885b(0x172)],'requires_3ds':!![],'threeds_url':_0x4f3e15[_0x48885b(0x172)],'status':_0x48885b(0x1fa),'final':![]};let _0xf06988=_0x4f3e15[_0x48885b(0x1ee)]||_0x4f3e15['message']||'Unknown\x20error',_0xeadb96=_0x4f3e15[_0x48885b(0x19b)],_0x12502b=_0x4f3e15['final'];return console['log'](_0x48885b(0x1bb)+_0xeadb96+',\x20Final:\x20'+_0x12502b+_0x48885b(0x147)+_0xf06988),{'gateway_payment_id':_0x4f3e15[_0x48885b(0x200)]?.[_0x48885b(0x213)](),'payment_url':_0x3163db,'requires_3ds':![],'status':_0x48885b(0x18e),'final':!![]};}catch(_0x4f2e91){console[_0x48885b(0x12e)](_0x48885b(0x19d)),console[_0x48885b(0x12e)](_0x48885b(0x162),_0x4f2e91),loggerService_1['loggerService']['logWhiteDomainError'](_0x48885b(0x1fd),_0x48885b(0x153),_0x4f2e91);throw new Error('Failed\x20to\x20process\x20MasterCard\x20payment:\x20'+(_0x4f2e91 instanceof Error?_0x4f2e91[_0x48885b(0x12f)]:'Unknown\x20error'));}}async['checkPaymentStatus'](_0x45c03c,_0x1806e2){const _0x49731a=a42_0x47b01b;console[_0x49731a(0x13e)](_0x49731a(0x120)+_0x45c03c+'\x20('+_0x1806e2+')');try{const _0x4f8a50={'payment_id':_0x45c03c,'order_id':_0x1806e2},_0x25071b=JSON[_0x49731a(0x148)](_0x4f8a50),{key:_0x1469fb,iv:_0x4d8c9a}=this['generateAESKey'](),_0x21b51b=this[_0x49731a(0x192)](_0x25071b,_0x1469fb,_0x4d8c9a),_0x3e21b0=this['encryptRSA'](_0x1469fb,_0x4d8c9a),_0x1f7832=this[_0x49731a(0x18f)](_0x25071b),_0x153a3d={'merchant_point_id':this[_0x49731a(0x123)],'method':_0x49731a(0x19b),'info':_0x21b51b,'key':_0x3e21b0,'sign':_0x1f7832,'lang':'en'};loggerService_1['loggerService'][_0x49731a(0x141)]('mastercard',_0x49731a(0x1dc),_0x49731a(0x179),{'merchant_point_id':this[_0x49731a(0x123)],'method':_0x49731a(0x19b),'lang':'en'});const _0x5c841b=Date['now'](),_0x49d846=await fetch(this['apiUrl'],{'method':_0x49731a(0x179),'headers':{'Content-Type':'application/json','Accept':_0x49731a(0x131),'User-Agent':_0x49731a(0x1d1)},'body':JSON[_0x49731a(0x148)](_0x153a3d)}),_0x1822fc=Date['now']()-_0x5c841b;if(!_0x49d846['ok']){const _0x815e60=await _0x49d846[_0x49731a(0x1b5)]();loggerService_1['loggerService'][_0x49731a(0x1c2)](_0x49731a(0x1fd),'/status_raw',_0x49d846[_0x49731a(0x19b)],_0x815e60,_0x1822fc);throw new Error(_0x49731a(0x1ae)+_0x49d846[_0x49731a(0x19b)]);}const _0x4819a7=await _0x49d846[_0x49731a(0x175)]();loggerService_1[_0x49731a(0x14f)][_0x49731a(0x1c2)](_0x49731a(0x1fd),_0x49731a(0x1ef),_0x49d846[_0x49731a(0x19b)],_0x4819a7,_0x1822fc);let _0x212c61=_0x4819a7;if(_0x4819a7[_0x49731a(0x180)]&&_0x4819a7[_0x49731a(0x181)]&&_0x4819a7[_0x49731a(0x124)]){console[_0x49731a(0x13e)]('🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0x1b0530=this[_0x49731a(0x129)](_0x4819a7[_0x49731a(0x180)],_0x4819a7['key']);_0x212c61=JSON[_0x49731a(0x1cc)](_0x1b0530),console['log'](_0x49731a(0x190)),loggerService_1[_0x49731a(0x14f)][_0x49731a(0x1c2)](_0x49731a(0x1fd),_0x49731a(0x149),_0x49d846[_0x49731a(0x19b)],_0x212c61,_0x1822fc),console[_0x49731a(0x13e)](_0x49731a(0x203));}catch(_0x4f0164){console[_0x49731a(0x12e)](_0x49731a(0x1cf),_0x4f0164),loggerService_1[_0x49731a(0x14f)][_0x49731a(0x202)](_0x49731a(0x1fd),_0x49731a(0x169),_0x49731a(0x1c8)+_0x4f0164),_0x212c61=_0x4819a7;}}else loggerService_1[_0x49731a(0x14f)][_0x49731a(0x1c2)](_0x49731a(0x1fd),_0x49731a(0x149),_0x49d846[_0x49731a(0x19b)],_0x212c61,_0x1822fc),console[_0x49731a(0x13e)](_0x49731a(0x126));console[_0x49731a(0x13e)](_0x49731a(0x12d),{'status':_0x212c61[_0x49731a(0x19b)],'final':_0x212c61['final'],'payment_id':_0x212c61[_0x49731a(0x200)],'desc':_0x212c61[_0x49731a(0x1ee)]});let _0x16338d=_0x49731a(0x1fa);if(_0x212c61[_0x49731a(0x19b)]===0x1&&_0x212c61[_0x49731a(0x14a)]===0x1)_0x16338d=_0x49731a(0x174);else _0x212c61[_0x49731a(0x19b)]===0x0&&_0x212c61[_0x49731a(0x14a)]===0x0?_0x16338d=_0x49731a(0x1fa):_0x16338d='FAILED';return{'status':_0x16338d,'final':_0x212c61[_0x49731a(0x14a)]===0x1,'amount':_0x212c61[_0x49731a(0x17f)],'currency':_0x212c61[_0x49731a(0x16a)],'date_success':_0x212c61[_0x49731a(0x137)],'description':_0x212c61[_0x49731a(0x1ee)]};}catch(_0x5783d1){console[_0x49731a(0x12e)]('MasterCard\x20status\x20check\x20error:',_0x5783d1),loggerService_1[_0x49731a(0x14f)][_0x49731a(0x202)]('mastercard',_0x49731a(0x1dc),_0x5783d1);throw new Error('Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20'+(_0x5783d1 instanceof Error?_0x5783d1[_0x49731a(0x12f)]:_0x49731a(0x1d6)));}}['scheduleStatusChecks'](_0x24c810,_0x2986f7,_0x1da281){const _0x37c727=a42_0x47b01b;console['log']('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0x24c810+'\x20('+_0x1da281+')'),this[_0x37c727(0x154)](_0x24c810);const _0x2a23b8=[],_0x4c2963=0x5*0x3c*0x3e8,_0x29b713=0x2*0x3c*0x3c*0x3e8,_0x5d9117=Math[_0x37c727(0x1e4)](_0x29b713/_0x4c2963);console['log'](_0x37c727(0x143)+_0x5d9117+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x35e8b7=0x1;_0x35e8b7<=_0x5d9117;_0x35e8b7++){const _0x22952e=setTimeout(async()=>{const _0x15f545=_0x37c727;console[_0x15f545(0x13e)](_0x15f545(0x13b)+_0x35e8b7+'/'+_0x5d9117+_0x15f545(0x1d3)+_0x24c810);try{const _0x5e7355=await this[_0x15f545(0x1f0)](_0x1da281,_0x2986f7);console[_0x15f545(0x13e)]('📊\x20Status\x20check\x20#'+_0x35e8b7+_0x15f545(0x166),_0x5e7355),_0x5e7355[_0x15f545(0x14a)]&&(console[_0x15f545(0x13e)](_0x15f545(0x15d)+_0x24c810+_0x15f545(0x16e)+_0x5e7355[_0x15f545(0x19b)]+'),\x20stopping\x20status\x20checks'),this[_0x15f545(0x154)](_0x24c810),await this[_0x15f545(0x125)](_0x24c810,_0x5e7355[_0x15f545(0x19b)],_0x5e7355));}catch(_0x39c302){console[_0x15f545(0x12e)](_0x15f545(0x1eb)+_0x35e8b7+_0x15f545(0x1c9)+_0x24c810+':',_0x39c302);}},_0x35e8b7*_0x4c2963);_0x2a23b8[_0x37c727(0x1d2)](_0x22952e);}this[_0x37c727(0x1b7)][_0x37c727(0x1ec)](_0x24c810,_0x2a23b8),console[_0x37c727(0x13e)](_0x37c727(0x168)+_0x5d9117+_0x37c727(0x16d)+_0x24c810);}[a42_0x47b01b(0x154)](_0x2f221b){const _0x280e82=a42_0x47b01b,_0x3e83e9=this['statusCheckTimers']['get'](_0x2f221b);_0x3e83e9&&(console['log'](_0x280e82(0x13f)+_0x3e83e9[_0x280e82(0x15f)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x2f221b),_0x3e83e9[_0x280e82(0x196)]((_0x55120b,_0x4a8829)=>{clearTimeout(_0x55120b);}),this[_0x280e82(0x1b7)]['delete'](_0x2f221b));}async['updatePaymentStatus'](_0x23146d,_0x295a8e,_0x1f99a8){const _0x6593cd=a42_0x47b01b;try{const _0x3a4dcf=(await Promise['resolve']()[_0x6593cd(0x139)](()=>__importStar(require(_0x6593cd(0x18c)))))[_0x6593cd(0x1d8)],_0x4c4152={'status':_0x295a8e[_0x6593cd(0x17a)](),'updatedAt':new Date(),'statusChangedBy':_0x6593cd(0x184),'statusChangedAt':new Date()};_0x295a8e===_0x6593cd(0x174)&&(_0x4c4152[_0x6593cd(0x1e5)]=new Date()),_0x1f99a8['description']&&(_0x4c4152[_0x6593cd(0x1f4)]=_0x6593cd(0x1f2)+_0x1f99a8[_0x6593cd(0x140)]),await _0x3a4dcf[_0x6593cd(0x208)][_0x6593cd(0x15a)]({'where':{'id':_0x23146d},'data':_0x4c4152}),console['log'](_0x6593cd(0x15d)+_0x23146d+'\x20status\x20updated\x20to\x20'+_0x295a8e),await this[_0x6593cd(0x211)](_0x23146d,_0x295a8e);}catch(_0x37faff){console[_0x6593cd(0x12e)](_0x6593cd(0x1a6)+_0x23146d+':',_0x37faff);}}async[a42_0x47b01b(0x211)](_0x2bccdd,_0x20282e){const _0x1740a7=a42_0x47b01b;try{const _0xc35271=(await Promise['resolve']()[_0x1740a7(0x139)](()=>__importStar(require(_0x1740a7(0x18c)))))[_0x1740a7(0x1d8)],{telegramBotService:_0x41d512}=await Promise[_0x1740a7(0x1b8)]()[_0x1740a7(0x139)](()=>__importStar(require(_0x1740a7(0x201)))),_0xf57d4c=await _0xc35271[_0x1740a7(0x208)][_0x1740a7(0x1f6)]({'where':{'id':_0x2bccdd},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0xf57d4c)return;const _0x49bf28={'PAID':_0x1740a7(0x16b),'FAILED':_0x1740a7(0x171)},_0x1cf142=_0x49bf28[_0x20282e];_0x1cf142&&await _0x41d512[_0x1740a7(0x132)](_0xf57d4c['shopId'],_0xf57d4c,_0x1cf142),await this['sendShopWebhook'](_0xf57d4c,_0x20282e);}catch(_0x83c036){console['error'](_0x1740a7(0x1f3),_0x83c036);}}async[a42_0x47b01b(0x130)](_0xd2a6ea,_0x57dc6d){const _0x5c3bec=a42_0x47b01b,_0x4f90f0=Date[_0x5c3bec(0x1a7)]();try{const _0x451d9e=_0xd2a6ea['shop'],_0x1b7a45=_0x451d9e[_0x5c3bec(0x1e1)];if(!_0x1b7a45?.['webhookUrl']){console[_0x5c3bec(0x13e)](_0x5c3bec(0x212)+_0x451d9e['id']);return;}const _0x2992cc=_0x57dc6d==='PAID'?_0x5c3bec(0x1df):_0x5c3bec(0x20e);let _0x54d892=[];if(_0x1b7a45[_0x5c3bec(0x1e8)])try{_0x54d892=Array[_0x5c3bec(0x1a4)](_0x1b7a45[_0x5c3bec(0x1e8)])?_0x1b7a45[_0x5c3bec(0x1e8)]:JSON[_0x5c3bec(0x1cc)](_0x1b7a45[_0x5c3bec(0x1e8)]);}catch(_0x3816a8){console[_0x5c3bec(0x12e)](_0x5c3bec(0x14d),_0x3816a8),_0x54d892=[];}if(!_0x54d892['includes'](_0x2992cc)){console[_0x5c3bec(0x13e)](_0x5c3bec(0x173)+_0x2992cc+_0x5c3bec(0x152)+_0x451d9e['id']);return;}const _0x5a3a8f={'event':_0x2992cc,'payment':{'id':_0xd2a6ea['id'],'order_id':_0xd2a6ea[_0x5c3bec(0x1f8)],'gateway_order_id':_0xd2a6ea['gatewayOrderId'],'gateway':'1111','amount':_0xd2a6ea[_0x5c3bec(0x17f)],'currency':_0xd2a6ea['currency'],'status':_0x57dc6d[_0x5c3bec(0x20f)](),'customer_email':_0xd2a6ea[_0x5c3bec(0x1ff)],'customer_name':_0xd2a6ea[_0x5c3bec(0x135)],'created_at':_0xd2a6ea[_0x5c3bec(0x1e7)],'updated_at':new Date()}},_0x5d7ab9=await fetch(_0x1b7a45[_0x5c3bec(0x1d5)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x5c3bec(0x1cd)},'body':JSON[_0x5c3bec(0x148)](_0x5a3a8f)}),_0x3d77e0=Date['now']()-_0x4f90f0;loggerService_1[_0x5c3bec(0x14f)][_0x5c3bec(0x121)](_0xd2a6ea['shopId'],_0x1b7a45[_0x5c3bec(0x1d5)],_0x2992cc,_0x5d7ab9['status'],_0x3d77e0,_0x5a3a8f),console[_0x5c3bec(0x13e)](_0x5c3bec(0x13c)+_0x1b7a45['webhookUrl']+'\x20with\x20status\x20'+_0x5d7ab9[_0x5c3bec(0x19b)]+'\x20('+_0x3d77e0+_0x5c3bec(0x1c4));}catch(_0x2c67b0){console['error'](_0x5c3bec(0x19c),_0x2c67b0),loggerService_1[_0x5c3bec(0x14f)][_0x5c3bec(0x150)](_0xd2a6ea[_0x5c3bec(0x197)],_0xd2a6ea[_0x5c3bec(0x193)]?.[_0x5c3bec(0x1e1)]?.[_0x5c3bec(0x1d5)]||_0x5c3bec(0x1c7),_0x5c3bec(0x210),_0x2c67b0,{});}}[a42_0x47b01b(0x1e6)](_0x53e905){const _0x5ee753=a42_0x47b01b,_0x2f00ea=_0x53e905[_0x5ee753(0x199)](/[\s-]/g,'');if(_0x2f00ea[_0x5ee753(0x15f)]<0x4)return'****';return'****\x20****\x20****\x20'+_0x2f00ea[_0x5ee753(0x1b9)](-0x4);}async[a42_0x47b01b(0x18b)](_0x187b02){const _0x385bfe=a42_0x47b01b;console['log'](_0x385bfe(0x1bc),_0x187b02);let _0x867ee5=_0x385bfe(0x1fa);if(_0x187b02[_0x385bfe(0x19b)]===0x1&&_0x187b02[_0x385bfe(0x14a)]===0x1)_0x867ee5=_0x385bfe(0x174);else _0x187b02[_0x385bfe(0x19b)]===0x0&&_0x187b02[_0x385bfe(0x14a)]===0x0?_0x867ee5=_0x385bfe(0x1fa):_0x867ee5=_0x385bfe(0x18e);return{'paymentId':_0x187b02[_0x385bfe(0x14b)]||'','status':_0x867ee5,'amount':_0x187b02[_0x385bfe(0x17f)],'currency':_0x187b02['currency']};}['stopAllStatusChecks'](){const _0x1a270c=a42_0x47b01b;console[_0x1a270c(0x13e)](_0x1a270c(0x215));const _0x1d9d8b=this[_0x1a270c(0x1b7)]['size'];for(const [_0x3c90bb]of this[_0x1a270c(0x1b7)]){this[_0x1a270c(0x154)](_0x3c90bb);}console[_0x1a270c(0x13e)](_0x1a270c(0x1ce)+_0x1d9d8b+'\x20MasterCard\x20status\x20check\x20timers');}}function a42_0x7048(_0x4b5a13,_0x588e19){const _0x2e91c5=a42_0x2e91();return a42_0x7048=function(_0x704845,_0x1a8e13){_0x704845=_0x704845-0x120;let _0x1e5f25=_0x2e91c5[_0x704845];return _0x1e5f25;},a42_0x7048(_0x4b5a13,_0x588e19);}exports['MasterCardService']=MasterCardService;function a42_0x2e91(){const _0x2242be=['json','Payment\x20ID:','trim','-----END','POST','toUpperCase','https://api.paydmeth.com/api','encryptRSA','❌\x20RSA\x20encryption\x20failed:','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','amount','info','key','substring','__createBinding','system','❌\x20MasterCard\x20key\x20validation\x20failed:','/charge_decrypt','💾\x20Payment\x20data\x20prepared','/charge_raw','43275fBnRjs','Status:','processWebhook','../../config/database','get','FAILED','signRSA','✅\x20Status\x20response\x20decrypted\x20successfully','4tJnTOP','encryptAES','shop','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','forEach','shopId','Response\x20Body:','replace','\x20\x20\x20-\x20merchant_point_id:','status','Failed\x20to\x20send\x20MasterCard\x20webhook:','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','RSA_PKCS1_PADDING','/charge_decrypted','__importStar','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','create','📝\x20Encrypted\x20key\x20length:','isArray','constants','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','now','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','PHP\x20decryptor\x20error','🔐\x20AES\x20key\x20and\x20IV\x20generated','decryptResponsePhp','path','Card\x20Number:','HTTP\x20error!\x20status:\x20','✅\x20Payment\x20successful','charge','writable','🔐\x20Data\x20encrypted\x20with\x20AES','https://api2.trapay.uk/decrypt.php','HTTP\x20Status:','text','Order\x20ID:','statusCheckTimers','resolve','slice','\x20characters','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','Processing\x20MasterCard\x20webhook:','publicKeyPath','Return\x20URL:','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','readFileSync','🔐\x20AES\x20key\x20length:','logWhiteDomainResponse','1281110mSVAqQ','ms)','5557497pAeaUO','defineProperty','unknown','Status\x20decryption\x20failed:\x20','\x20failed\x20for\x20payment\x20','619650ClvRsF','cwd','parse','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','🛑\x20Stopped\x20','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','privateKeyPath','TesSoft\x20Payment\x20System/1.0','push','\x20for\x20payment\x20','cvv','webhookUrl','Unknown\x20error','psp_public.pem','default','crypto','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','🔐\x20AES\x20IV\x20length:','/status','🔐\x20Public\x20key\x20path:','aes-256-ctr','payment.success','🔐\x20Public\x20key\x20length:\x20','settings','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','3DS\x20URL:','floor','paidAt','maskCardNumber','createdAt','webhookEvents','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','createDecipheriv','❌\x20Status\x20check\x20#','set','utf8','desc','/status_raw','checkPaymentStatus','📝\x20Data\x20length:','MasterCard:\x20','Failed\x20to\x20send\x20payment\x20notifications:','adminNotes','💳\x20MasterCard\x20service\x20initialized','findUnique','🔐\x20Data\x20signed\x20with\x20RSA','orderId','HTTP\x20','PENDING','\x20\x20\x20-\x20info\x20length:','scheduleStatusChecks','mastercard','expire_month','customerEmail','payment_id','../telegramBotService','logWhiteDomainError','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','base64','2952sEfNim','❌\x20PHP\x20decryptor\x20request\x20failed:','last_name','payment','📝\x20Final\x20request\x20structure:','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','2419996IBpIMx','from','54mbUekj','payment.failed','toLowerCase','webhook_send','sendPaymentNotifications','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','toString','getOwnPropertyDescriptor','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','logShopWebhookSent','Result\x20URL:','merchantPointId','sign','updatePaymentStatus','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','number','getOwnPropertyNames','decryptResponse','🔐\x20RSA\x20signing\x20successful','Card\x20Holder:','decryptAES','📊\x20Status\x20check\x20result:','error','message','sendShopWebhook','application/json','sendPaymentNotification','🔐\x20Private\x20key\x20path:','expire_year','customerName','apiUrl','date_success','❌\x20Data\x20being\x20signed:','then','keys','🔍\x20MasterCard\x20status\x20check\x20#','MasterCard\x20webhook\x20sent\x20to\x20','publicEncrypt','log','🧹\x20Clearing\x20','description','logWhiteDomainRequest','114lHJiqB','⏰\x20Will\x20check\x20status\x20','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','29428LYVtYO','includes',',\x20Desc:\x20','stringify','/status_decrypted','final','order_id','Amount:','Error\x20parsing\x20webhook\x20events:','Final:','loggerService','logShopWebhookError','__importDefault','\x20not\x20enabled\x20for\x20shop\x20','/charge','clearStatusTimers','🔐\x203DS\x20verification\x20required','📝\x20Signature\x20length:','📝\x20Encrypted\x20data\x20length:','7488305XPoPrB','hasOwnProperty','update',',\x20body:\x20','validateKeyFiles','✅\x20Payment\x20','...','length','\x20\x20\x20-\x20sign\x20length:','end','Error\x20details:','__esModule','join','createSign','\x20result:','existsSync','✅\x20Scheduled\x20','/status_decrypt','currency','paid','-----BEGIN','\x20status\x20checks\x20for\x20payment\x20','\x20is\x20final\x20(','../loggerService','generateAESKey','failed','3ds_url','Webhook\x20event\x20','PAID'];a42_0x2e91=function(){return _0x2242be;};return a42_0x2e91();}