'use strict';const a49_0x3fd47e=a49_0x5bc9;(function(_0x3a90fe,_0x54bbaf){const _0x43098e=a49_0x5bc9,_0x876df4=_0x3a90fe();while(!![]){try{const _0x18c1de=-parseInt(_0x43098e(0xf4))/0x1+parseInt(_0x43098e(0x10f))/0x2*(parseInt(_0x43098e(0x1a2))/0x3)+-parseInt(_0x43098e(0x1d5))/0x4+-parseInt(_0x43098e(0x117))/0x5*(parseInt(_0x43098e(0x174))/0x6)+-parseInt(_0x43098e(0x1d8))/0x7*(parseInt(_0x43098e(0x1b4))/0x8)+parseInt(_0x43098e(0x255))/0x9+-parseInt(_0x43098e(0x18f))/0xa*(-parseInt(_0x43098e(0x1e9))/0xb);if(_0x18c1de===_0x54bbaf)break;else _0x876df4['push'](_0x876df4['shift']());}catch(_0x2a7bad){_0x876df4['push'](_0x876df4['shift']());}}}(a49_0x3315,0x77efd));var __createBinding=this&&this[a49_0x3fd47e(0x109)]||(Object[a49_0x3fd47e(0x111)]?function(_0x44a8b1,_0x21c36e,_0x21ec3e,_0x44a82c){const _0x4be050=a49_0x3fd47e;if(_0x44a82c===undefined)_0x44a82c=_0x21ec3e;var _0x1c1b2e=Object[_0x4be050(0x1e2)](_0x21c36e,_0x21ec3e);(!_0x1c1b2e||('get'in _0x1c1b2e?!_0x21c36e['__esModule']:_0x1c1b2e[_0x4be050(0x1db)]||_0x1c1b2e[_0x4be050(0x210)]))&&(_0x1c1b2e={'enumerable':!![],'get':function(){return _0x21c36e[_0x21ec3e];}}),Object[_0x4be050(0x21b)](_0x44a8b1,_0x44a82c,_0x1c1b2e);}:function(_0x3869f2,_0x4ae8b8,_0x4ac376,_0x33a8d9){if(_0x33a8d9===undefined)_0x33a8d9=_0x4ac376;_0x3869f2[_0x33a8d9]=_0x4ae8b8[_0x4ac376];}),__setModuleDefault=this&&this[a49_0x3fd47e(0x22d)]||(Object['create']?function(_0x425765,_0x3fda80){const _0x2e2b0a=a49_0x3fd47e;Object['defineProperty'](_0x425765,_0x2e2b0a(0x126),{'enumerable':!![],'value':_0x3fda80});}:function(_0x57d8c6,_0x1a4a3b){const _0x4e6283=a49_0x3fd47e;_0x57d8c6[_0x4e6283(0x126)]=_0x1a4a3b;}),__importStar=this&&this['__importStar']||(function(){var _0x4f9503=function(_0x553e86){const _0x1a6fb1=a49_0x5bc9;return _0x4f9503=Object[_0x1a6fb1(0x160)]||function(_0x1ce6a2){const _0x276dc2=_0x1a6fb1;var _0x2f0c9f=[];for(var _0x38ea1c in _0x1ce6a2)if(Object[_0x276dc2(0x118)][_0x276dc2(0x199)][_0x276dc2(0x21a)](_0x1ce6a2,_0x38ea1c))_0x2f0c9f[_0x2f0c9f[_0x276dc2(0x250)]]=_0x38ea1c;return _0x2f0c9f;},_0x4f9503(_0x553e86);};return function(_0x593d3e){const _0x4bbd6e=a49_0x5bc9;if(_0x593d3e&&_0x593d3e[_0x4bbd6e(0x238)])return _0x593d3e;var _0x13665a={};if(_0x593d3e!=null){for(var _0x3199ba=_0x4f9503(_0x593d3e),_0x68966c=0x0;_0x68966c<_0x3199ba[_0x4bbd6e(0x250)];_0x68966c++)if(_0x3199ba[_0x68966c]!==_0x4bbd6e(0x126))__createBinding(_0x13665a,_0x593d3e,_0x3199ba[_0x68966c]);}return __setModuleDefault(_0x13665a,_0x593d3e),_0x13665a;};}()),__importDefault=this&&this[a49_0x3fd47e(0x154)]||function(_0x462ffe){const _0x55d4dc=a49_0x3fd47e;return _0x462ffe&&_0x462ffe[_0x55d4dc(0x238)]?_0x462ffe:{'default':_0x462ffe};};Object[a49_0x3fd47e(0x21b)](exports,a49_0x3fd47e(0x238),{'value':!![]}),exports['VisaMasterCardService']=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require('../loggerService');function a49_0x3315(){const _0x26ebe3=['error','\x20\x20\x20-\x20merchant_point_id:','❌\x20RSA\x20encryption\x20failed:','length','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','cwd','readFileSync','7709679IxEmJX','warn','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','\x20status\x20updated\x20to\x20','errorMessage','set','\x20is\x20final\x20(','📊\x20Status\x20check\x20#','📤\x20Sending\x20request\x20to\x20API...','json','LookUp\x20code\x20sent','gatewayOrderId','Method\x20not\x20allowed','960135upirIW','update','✅\x20Payment\x20','encryptAES','\x20order_id\x20for\x20search:\x20','\x20status\x20check\x20error:','Failed\x20to\x20send\x20MasterCard\x20webhook:','5000000000000000','text','FAILED','RSA_PKCS1_PADDING','/status_raw','now','VISA','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','customerName','resolve','toUpperCase','failureMessage','Client\x20OTP\x20confirmation\x20required','VISA/MasterCard','__createBinding','/status','webhookUrl','cvv','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','3646UwlbKy','Error\x20details:','create','PIN\x20code\x20confirmation\x20awaited','merchantPointId','\x20failed\x20for\x20payment\x20','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','description','115OgeHGy','prototype','❌\x20Status\x20check\x20#','Order\x20ID:','settings','logShopWebhookError','aes-256-ctr','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','adminNotes','📝\x20Data\x20length:','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','🔐\x20MasterCard\x20API\x20URL:','\x20MasterCard\x20status\x20check\x20timers','🔍\x20Using\x20','default','📊\x20Checking\x20','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','trim','MASTERCARD','sendPaymentNotifications','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','POST','The\x20card\x20does\x20not\x20exist','Status\x20decryption\x20failed:\x20','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','Payment\x20confirmation\x20time\x20has\x20expired','shopId','card_type','ms)','payment.failed','shop','Payment\x20System/1.0','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','\x20payment\x20status:\x20','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','payment','Sender\x27s\x20CVV\x20card\x20is\x20required','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','Awaiting\x20confirmation\x20by\x20ivr\x20call','Payment\x20cancellation\x20is\x20being\x20processed','3ds_url',',\x20final=','Card\x20Holder:','\x20status\x20checks\x20for\x20payment\x20','HTTP\x20error!\x20status:\x20','\x20not\x20enabled\x20for\x20shop\x20','PHP\x20decryptor\x20error','-----BEGIN','substring','parse','\x20\x20\x20Currency:\x20','existsSync','https://api2.trapay.uk/decrypt.php','Failed\x20to\x20check\x20','Cash\x20payment\x20is\x20expected\x20at\x20TCO','\x20\x20\x20Payment\x20ID:\x20','****','Final:','__importDefault','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','first_name','Transaction\x20limit\x20exceeded','Cancellation\x20is\x20not\x20possible','checkPaymentStatus','visa/mastercard','Payment\x20prohibited','\x20payment:\x20','Sender\x20information\x20required','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','\x20API:\x20','getOwnPropertyNames','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','amount','paymentStatuses','🔐\x20VISA\x20Private\x20key\x20length:\x20','includes','Payment\x20confirmation\x20required','No\x20New\x20payment','toLowerCase','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','🔐\x20VISA\x20Private\x20key\x20path:','statusCheckTimers','\x20|\x20Response:\x20','delete','Status:','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','charge','🔐\x20Using\x20keys:\x20','createDecipheriv','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','245538wbuQJw','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===',',\x20Desc:\x20','VisaMasterCardService','sendShopWebhook','Decryption\x20failed:\x20','📝\x20Final\x20request\x20structure:','Failed\x20to\x20send\x20payment\x20notifications:','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','Awaiting\x20confirmation\x20in\x20the\x20application','payment_id','===\x20API\x20RESPONSE\x20===','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','💾\x20Saving\x20failure\x20message:\x20','paid','****\x20****\x20****\x20','\x20(from:\x20status=','✅\x20VISA\x20key\x20files\x20validated\x20successfully','Response\x20Time:','📝\x20Encrypted\x20data\x20length:','LookUp\x20number\x20of\x20attempts\x20exceeded','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20\x20Original:\x20\x22','keys','order_id','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','10NVFxbx','date_success','🔐\x20VISA\x20Public\x20key\x20path:',',\x20body:\x20','-----END','signRSA','🔍\x20Using\x20provided\x20card\x20type:\x20','Another\x20unknown\x20error','from','apiUrl','hasOwnProperty','\x20\x20Cleaned:\x20\x20\x22','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','paymentId','🔐\x20MasterCard\x20Public\x20key\x20path:','Payment\x20ID:','/charge_decrypted','encryptRSA','Response\x20Body:','801GegEQH','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','Insufficient\x20funds\x20on\x20the\x20card','key','stringify',',\x20payment_id=','generateAESKey','\x20characters','Amount:','then','utf8','final','🔐\x20AES\x20IV\x20length:','findUnique','🧹\x20Card\x20holder\x20names\x20cleaned:','publicKeyPath','❌\x20PHP\x20decryptor\x20request\x20failed:','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','8GHSakr','stopAllStatusChecks','No\x20Error\x20executing\x20request','💾\x20Payment\x20data\x20prepared','validateKeyFiles','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','⏰\x20Will\x20check\x20status\x20','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','loggerService','toString','base64','🔐\x20RSA\x20signing\x20successful','number','Error\x20parsing\x20webhook\x20events:','getDetailedErrorMessage','failed','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','⏰\x20Scheduling\x20status\x20checks\x20for\x20','\x20result:','isArray','visa_private.pem','\x20status\x20timers\x20for\x20payment\x20','MasterCard\x20webhook\x20sent\x20to\x20','Payment\x20returned','\x20for\x20payment\x20','masterCardMerchantPointId','📝\x20Encrypted\x20key\x20length:','https://api.paydmeth.com/api','paidAt','payment.success','❌\x20Detailed\x20failure\x20description:\x20','../../config/database','1230664IPpaMe','last_name','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','5448394KDEIEH','\x20\x20\x20-\x20key\x20length:','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','writable','createdAt','webhook_send','LookUp\x20not\x20confirmed','sign','join','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','getOwnPropertyDescriptor','\x20\x20\x20-\x20info\x20length:','logWhiteDomainResponse','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','maskCardNumber','23487871iHebXg','expire_month','application/json','info','cardType','desc','randomBytes','none','/status_decrypted','LookUp\x20code\x20verified','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','/charge_raw','🔍\x20','get',',\x20orderId=','visaPrivateKeyPath','===\x20PARSED\x20API\x20RESPONSE\x20===','VISA/MasterCard\x20payment\x20successful','Test\x20payment','system','Result\x20URL:','size','charAt','psp_public.pem','orderId','🎯\x20Using\x20','Sender\x27s\x20card\x20details\x20are\x20required','\x20\x20\x20Amount:\x20','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','PAID','Status\x20','scheduleStatusChecks','Payment\x20is\x20being\x20processed','✅\x20Scheduled\x20','💳\x20VISA/MasterCard\x20service\x20initialized','isFinalStatus','Unknown\x20error','visaMerchantPointId','\x20with\x20status\x20','configurable','replace','Return\x20URL:','visaApiUrl','status','❌\x20Data\x20being\x20signed:','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','✅\x20Status\x20response\x20decrypted\x20successfully','📊\x20','📝\x20Signature\x20length:','call','defineProperty','log','updatePaymentStatus','🧹\x20Clearing\x20','Request\x20data\x20error','📊\x20Status\x20check\x20result:','/charge_decrypt','4000000000000000','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','Unsuccessful\x20payment','\x20\x20\x20Status:\x20','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','\x20\x20\x20-\x20sign\x20length:','decryptAES','webhookEvents','PENDING','currency','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','__setModuleDefault','sendPaymentNotification','\x20(from:\x20order_id=','\x20\x20\x20-\x20method:\x20charge','constants','Failed\x20payment','message','visaPublicKeyPath','logWhiteDomainError','logWhiteDomainRequest','🔐\x203DS\x20verification\x20required','__esModule','Recipient\x20data\x20required','clearStatusTimers','🔐\x20Data\x20signed\x20with\x20RSA','HTTP\x20Status:','decryptResponsePhp','Payment\x20pending\x20verification','Operation\x20completed\x20successfully','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','expire_year','visa_public.pem','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','✅\x20Payment\x20successful','The\x20card\x20is\x20lost\x20or\x20stolen','privateKeyPath','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','masterCardApiUrl','/status_decrypt','/charge','Captcha\x20confirmation\x20awaited','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:'];a49_0x3315=function(){return _0x26ebe3;};return a49_0x3315();}function a49_0x5bc9(_0x20538a,_0x422299){const _0x3315d5=a49_0x3315();return a49_0x5bc9=function(_0x5bc9e8,_0x51b227){_0x5bc9e8=_0x5bc9e8-0xf0;let _0x463cbc=_0x3315d5[_0x5bc9e8];return _0x463cbc;},a49_0x5bc9(_0x20538a,_0x422299);}class VisaMasterCardService{constructor(){const _0x1021ea=a49_0x3fd47e;this[_0x1021ea(0x16b)]=new Map(),this[_0x1021ea(0x163)]={0x0:{'final':![],'description':_0x1021ea(0x167)},0x1:{'final':![],'description':_0x1021ea(0x1b6)},0x2:{'final':!![],'description':_0x1021ea(0x21f)},0x3:{'final':!![],'description':_0x1021ea(0x196)},0x4:{'final':!![],'description':_0x1021ea(0x224)},0x5:{'final':!![],'description':_0x1021ea(0x1e6)},0x6:{'final':!![],'description':_0x1021ea(0x1cc)},0x7:{'final':!![],'description':_0x1021ea(0x1fb)},0x8:{'final':![],'description':_0x1021ea(0x107)},0x9:{'final':![],'description':'3DS\x20verification\x20required'},0xa:{'final':![],'description':_0x1021ea(0x13e)},0xb:{'final':![],'description':_0x1021ea(0x15d)},0xc:{'final':![],'description':_0x1021ea(0x239)},0xd:{'final':![],'description':_0x1021ea(0x13f)},0xe:{'final':![],'description':_0x1021ea(0x140)},0xf:{'final':![],'description':_0x1021ea(0x112)},0x10:{'final':![],'description':_0x1021ea(0x24b)},0x11:{'final':![],'description':_0x1021ea(0x15e)},0x12:{'final':![],'description':_0x1021ea(0x17d)},0x13:{'final':![],'description':_0x1021ea(0x209)},0x14:{'final':![],'description':_0x1021ea(0x13c)},0x15:{'final':![],'description':'Expected\x20bitcoin\x20transfer\x20from\x20client'},0x16:{'final':![],'description':_0x1021ea(0x23e)},0x18:{'final':![],'description':_0x1021ea(0x1e1)},0x19:{'final':![],'description':_0x1021ea(0x122)},0x1a:{'final':!![],'description':_0x1021ea(0x150)},0x1b:{'final':![],'description':_0x1021ea(0x131)},0x1c:{'final':![],'description':_0x1021ea(0x252)},0x1d:{'final':![],'description':_0x1021ea(0x1da)},0x1f:{'final':![],'description':_0x1021ea(0x223)},0x20:{'final':![],'description':_0x1021ea(0x139)},0x23:{'final':![],'description':_0x1021ea(0x203)},0x24:{'final':!![],'description':_0x1021ea(0x132)},0x25:{'final':!![],'description':_0x1021ea(0x15b)},0x26:{'final':!![],'description':_0x1021ea(0x251)},0x27:{'final':!![],'description':_0x1021ea(0x1a4)},0x28:{'final':!![],'description':_0x1021ea(0x12f)},0x29:{'final':!![],'description':_0x1021ea(0x245)},0x2a:{'final':!![],'description':'Invalid\x20expiration\x20date'},0x2b:{'final':!![],'description':_0x1021ea(0x157)},0x2c:{'final':!![],'description':_0x1021ea(0x1c5)},0x2d:{'final':!![],'description':_0x1021ea(0x232)},0x2e:{'final':!![],'description':_0x1021ea(0x224)},0x2f:{'final':!![],'description':_0x1021ea(0x224)},0x30:{'final':!![],'description':_0x1021ea(0x1c4)},0x31:{'final':![],'description':_0x1021ea(0x166)},0x32:{'final':!![],'description':_0x1021ea(0xf3)},0x33:{'final':!![],'description':_0x1021ea(0x232)},0x34:{'final':!![],'description':_0x1021ea(0x232)},0x35:{'final':!![],'description':_0x1021ea(0x232)},0x36:{'final':!![],'description':'Failed\x20payment'},0x37:{'final':!![],'description':'Failed\x20payment'},0x38:{'final':!![],'description':_0x1021ea(0x158)},0x39:{'final':![],'description':_0x1021ea(0x161)},0x3a:{'final':![],'description':_0x1021ea(0xf1)},0x3b:{'final':!![],'description':_0x1021ea(0x1f2)},0x3c:{'final':!![],'description':'Number\x20of\x20attempts\x20exceeded'},0x3d:{'final':!![],'description':_0x1021ea(0x247)},0x3e:{'final':!![],'description':_0x1021ea(0x180)},0x3f:{'final':!![],'description':_0x1021ea(0x1cc)},0x40:{'final':![],'description':_0x1021ea(0x1de)},0x41:{'final':!![],'description':_0x1021ea(0x188)},0x42:{'final':![],'description':_0x1021ea(0x141)},0x43:{'final':!![],'description':_0x1021ea(0x1a3)},0x44:{'final':![],'description':'3DS\x20verification\x20required'},0x45:{'final':!![],'description':_0x1021ea(0x232)},0x46:{'final':!![],'description':_0x1021ea(0x232)},0x47:{'final':!![],'description':_0x1021ea(0x13a)},0x64:{'final':!![],'description':_0x1021ea(0x23f)}},this[_0x1021ea(0x248)]=_0x1021ea(0x1d0),this[_0x1021ea(0x1ce)]=0x6e4,this[_0x1021ea(0x246)]=path_1[_0x1021ea(0x126)][_0x1021ea(0x1e0)](process[_0x1021ea(0x253)](),_0x1021ea(0x18c),'private.pem'),this[_0x1021ea(0x1b1)]=path_1[_0x1021ea(0x126)][_0x1021ea(0x1e0)](process[_0x1021ea(0x253)](),_0x1021ea(0x18c),_0x1021ea(0x200)),this[_0x1021ea(0x213)]=_0x1021ea(0x1d0),this[_0x1021ea(0x20e)]=0x6b7,this[_0x1021ea(0x1f8)]=path_1[_0x1021ea(0x126)][_0x1021ea(0x1e0)](process['cwd'](),_0x1021ea(0x18c),_0x1021ea(0x1c9)),this[_0x1021ea(0x234)]=path_1['default'][_0x1021ea(0x1e0)](process[_0x1021ea(0x253)](),_0x1021ea(0x18c),_0x1021ea(0x242)),console[_0x1021ea(0x21c)](_0x1021ea(0x20b)),console[_0x1021ea(0x21c)](_0x1021ea(0x123),this['masterCardApiUrl']),console['log']('🔐\x20VISA\x20API\x20URL:',this[_0x1021ea(0x213)]),console[_0x1021ea(0x21c)]('🔐\x20MasterCard\x20Private\x20key\x20path:',this[_0x1021ea(0x246)]),console[_0x1021ea(0x21c)](_0x1021ea(0x19d),this[_0x1021ea(0x1b1)]),console[_0x1021ea(0x21c)](_0x1021ea(0x16a),this[_0x1021ea(0x1f8)]),console[_0x1021ea(0x21c)](_0x1021ea(0x191),this[_0x1021ea(0x234)]),this[_0x1021ea(0x1b8)]();}['getDetailedErrorMessage'](_0x1e2661,_0x282e53){const _0x2393aa=a49_0x3fd47e,_0x11b663=this[_0x2393aa(0x163)][_0x1e2661];let _0x107c8b='';_0x11b663?_0x107c8b='Status\x20'+_0x1e2661+':\x20'+_0x11b663[_0x2393aa(0x116)]:_0x107c8b=_0x2393aa(0x207)+_0x1e2661+':\x20Unknown\x20status\x20code';if(_0x282e53&&_0x282e53[_0x2393aa(0x12a)]()){const _0x194b03=_0x282e53[_0x2393aa(0x12a)]();(!_0x11b663||_0x194b03[_0x2393aa(0x168)]()!==_0x11b663[_0x2393aa(0x116)][_0x2393aa(0x168)]())&&(_0x107c8b+=_0x2393aa(0x16c)+_0x194b03);}return _0x107c8b;}[a49_0x3fd47e(0x20c)](_0x11e4ac){const _0x2686de=this['paymentStatuses'][_0x11e4ac];return _0x2686de?_0x2686de['final']:!![];}['getCardTypeAndApi'](_0x108967){const _0x34d2ea=a49_0x3fd47e,_0xe1f330=_0x108967[_0x34d2ea(0x1ff)](0x0);if(_0xe1f330==='4')return console[_0x34d2ea(0x21c)](_0x34d2ea(0x173)),{'cardType':_0x34d2ea(0x101),'apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x34d2ea(0x1f8)],'publicKeyPath':this[_0x34d2ea(0x234)],'merchantPointId':this[_0x34d2ea(0x20e)]};else return _0xe1f330==='5'?(console['log']('💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)'),{'cardType':'MASTERCARD','apiUrl':this['masterCardApiUrl'],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x34d2ea(0x1ce)]}):(console['log'](_0x34d2ea(0x10e)+_0xe1f330+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':_0x34d2ea(0x12b),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x34d2ea(0x246)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x34d2ea(0x1ce)]});}[a49_0x3fd47e(0x1b8)](){const _0x5fc485=a49_0x3fd47e;try{if(!fs_1['default'][_0x5fc485(0x14d)](this[_0x5fc485(0x246)]))throw new Error(_0x5fc485(0x205)+this[_0x5fc485(0x246)]);if(!fs_1['default'][_0x5fc485(0x14d)](this[_0x5fc485(0x1b1)]))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this[_0x5fc485(0x1b1)]);const _0x5ca3cd=fs_1['default'][_0x5fc485(0x254)](this[_0x5fc485(0x246)],'utf8')['trim'](),_0x376d75=fs_1[_0x5fc485(0x126)][_0x5fc485(0x254)](this['publicKeyPath'],_0x5fc485(0x1ac))[_0x5fc485(0x12a)]();if(!_0x5ca3cd[_0x5fc485(0x165)](_0x5fc485(0x149))||!_0x5ca3cd[_0x5fc485(0x165)](_0x5fc485(0x193)))throw new Error(_0x5fc485(0x189));if(!_0x376d75['includes']('-----BEGIN')||!_0x376d75[_0x5fc485(0x165)](_0x5fc485(0x193)))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console['log'](_0x5fc485(0x102)),console[_0x5fc485(0x21c)](_0x5fc485(0x1e5)+_0x5ca3cd[_0x5fc485(0x250)]+'\x20characters'),console[_0x5fc485(0x21c)](_0x5fc485(0x1bb)+_0x376d75['length']+_0x5fc485(0x1a9));if(fs_1[_0x5fc485(0x126)]['existsSync'](this[_0x5fc485(0x1f8)])&&fs_1[_0x5fc485(0x126)][_0x5fc485(0x14d)](this['visaPublicKeyPath'])){const _0x44ff57=fs_1[_0x5fc485(0x126)][_0x5fc485(0x254)](this[_0x5fc485(0x1f8)],_0x5fc485(0x1ac))[_0x5fc485(0x12a)](),_0x11c76d=fs_1['default'][_0x5fc485(0x254)](this['visaPublicKeyPath'],'utf8')[_0x5fc485(0x12a)]();(!_0x44ff57[_0x5fc485(0x165)]('-----BEGIN')||!_0x44ff57[_0x5fc485(0x165)]('-----END'))&&console[_0x5fc485(0x256)](_0x5fc485(0x115)),(!_0x11c76d[_0x5fc485(0x165)](_0x5fc485(0x149))||!_0x11c76d[_0x5fc485(0x165)](_0x5fc485(0x193)))&&console[_0x5fc485(0x256)](_0x5fc485(0x22c)),console[_0x5fc485(0x21c)](_0x5fc485(0x185)),console[_0x5fc485(0x21c)](_0x5fc485(0x164)+_0x44ff57[_0x5fc485(0x250)]+'\x20characters'),console[_0x5fc485(0x21c)]('🔐\x20VISA\x20Public\x20key\x20length:\x20'+_0x11c76d['length']+'\x20characters');}else console['warn'](_0x5fc485(0x240)),console['warn'](_0x5fc485(0x129)+this[_0x5fc485(0x1f8)]),console[_0x5fc485(0x256)]('⚠️\x20Expected\x20VISA\x20public\x20key:\x20'+this[_0x5fc485(0x234)]);}catch(_0x21ceec){console['error'](_0x5fc485(0x1e7),_0x21ceec);throw _0x21ceec;}}[a49_0x3fd47e(0x1a8)](){const _0x54bb88=a49_0x3fd47e,_0x559e3d=crypto_1[_0x54bb88(0x126)][_0x54bb88(0x1ef)](0x20),_0x464c3f=crypto_1[_0x54bb88(0x126)][_0x54bb88(0x1ef)](0x10);return{'key':_0x559e3d,'iv':_0x464c3f};}[a49_0x3fd47e(0xf7)](_0xc9748e,_0xc44cb1,_0x1d6bc9){const _0x143268=a49_0x3fd47e,_0x54d9ec=crypto_1['default']['createCipheriv'](_0x143268(0x11d),_0xc44cb1,_0x1d6bc9);let _0x5d8db7=_0x54d9ec[_0x143268(0xf5)](_0xc9748e,_0x143268(0x1ac),_0x143268(0x1be));return _0x5d8db7+=_0x54d9ec['final'](_0x143268(0x1be)),_0x5d8db7;}[a49_0x3fd47e(0x1a0)](_0x4a5e7a,_0x3b89fb,_0x11e447){const _0x2e9bc0=a49_0x3fd47e;try{const _0x4dc3a1=fs_1['default'][_0x2e9bc0(0x254)](_0x11e447,_0x2e9bc0(0x1ac))[_0x2e9bc0(0x12a)](),_0x23263e={'iv':_0x3b89fb[_0x2e9bc0(0x1bd)](_0x2e9bc0(0x1be)),'key':_0x4a5e7a[_0x2e9bc0(0x1bd)]('base64')},_0x4ad431=JSON[_0x2e9bc0(0x1a6)](_0x23263e);console[_0x2e9bc0(0x21c)](_0x2e9bc0(0x226),_0x4ad431[_0x2e9bc0(0x250)]);const _0x20afbd=crypto_1[_0x2e9bc0(0x126)]['publicEncrypt']({'key':_0x4dc3a1,'padding':crypto_1[_0x2e9bc0(0x126)][_0x2e9bc0(0x231)][_0x2e9bc0(0xfe)]},Buffer[_0x2e9bc0(0x197)](_0x4ad431));return console['log'](_0x2e9bc0(0x24c),_0x20afbd['length']),_0x20afbd[_0x2e9bc0(0x1bd)](_0x2e9bc0(0x1be));}catch(_0x3ac47d){console[_0x2e9bc0(0x24d)](_0x2e9bc0(0x24f),_0x3ac47d);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a49_0x3fd47e(0x194)](_0x4c3cf5,_0x209e09){const _0x123009=a49_0x3fd47e;try{const _0x2e0a49=fs_1[_0x123009(0x126)][_0x123009(0x254)](_0x209e09,'utf8')[_0x123009(0x12a)](),_0x3e3d46=crypto_1[_0x123009(0x126)]['createSign']('SHA256');_0x3e3d46[_0x123009(0xf5)](_0x4c3cf5),_0x3e3d46['end']();const _0x1d0a67=_0x3e3d46[_0x123009(0x1df)](_0x2e0a49,'base64');return console['log'](_0x123009(0x1bf)),console[_0x123009(0x21c)]('📝\x20Data\x20to\x20sign\x20length:',_0x4c3cf5[_0x123009(0x250)]),console['log'](_0x123009(0x219),_0x1d0a67['length']),_0x1d0a67;}catch(_0x945ab3){console[_0x123009(0x24d)]('❌\x20RSA\x20signing\x20failed:',_0x945ab3),console[_0x123009(0x24d)](_0x123009(0x215),_0x4c3cf5[_0x123009(0x14a)](0x0,0xc8)+'...');throw new Error(_0x123009(0x1f3));}}[a49_0x3fd47e(0x228)](_0x38f6eb,_0x1ed236,_0x2d4272){const _0x42f528=a49_0x3fd47e,_0x467688=crypto_1['default'][_0x42f528(0x172)](_0x42f528(0x11d),_0x1ed236,_0x2d4272);let _0x8b06a4=_0x467688[_0x42f528(0xf5)](_0x38f6eb,_0x42f528(0x1be),_0x42f528(0x1ac));return _0x8b06a4+=_0x467688[_0x42f528(0x1ad)](_0x42f528(0x1ac)),_0x8b06a4;}async['decryptResponsePhp'](_0x59e26e,_0x10e56d,_0x21fca4=a49_0x3fd47e(0x12b)){const _0x38b5bd=a49_0x3fd47e;try{const _0x4093a4=await fetch(_0x38b5bd(0x14e),{'method':_0x38b5bd(0x12e),'headers':{'Content-Type':_0x38b5bd(0x1eb)},'body':JSON[_0x38b5bd(0x1a6)]({'info':_0x59e26e,'key':_0x10e56d,'card_type':_0x21fca4[_0x38b5bd(0x168)]()})});if(!_0x4093a4['ok'])throw new Error(_0x38b5bd(0x148));return await _0x4093a4[_0x38b5bd(0xfc)]();}catch(_0x3a4de2){console[_0x38b5bd(0x24d)](_0x38b5bd(0x1b2),_0x3a4de2);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}['decryptResponse'](_0x237c65,_0x2fdeb3){const _0xe2547=a49_0x3fd47e;try{const _0x34b515=fs_1[_0xe2547(0x126)][_0xe2547(0x254)](this['privateKeyPath'],'utf8')[_0xe2547(0x12a)](),_0xecbbae=crypto_1[_0xe2547(0x126)]['privateDecrypt'](_0x34b515,Buffer[_0xe2547(0x197)](_0x2fdeb3,_0xe2547(0x1be))),_0x56d834=JSON[_0xe2547(0x14b)](_0xecbbae[_0xe2547(0x1bd)]()),_0x589089=Buffer[_0xe2547(0x197)](_0x56d834[_0xe2547(0x1a5)],_0xe2547(0x1be)),_0x3f653c=Buffer['from'](_0x56d834['iv'],_0xe2547(0x1be));return this['decryptAES'](_0x237c65,_0x589089,_0x3f653c);}catch(_0x18d44f){throw new Error('Failed\x20to\x20decrypt\x20response');}}async['processCardPayment'](_0x32022d){const _0x486f73=a49_0x3fd47e,{paymentId:_0xa8a3e6,orderId:_0x228bdb,amount:_0x30c294,currency:_0x57d611,cardData:_0x52bceb,resultUrl:_0x29caa1,returnUrl:_0x287bf1,cardHolder:_0x12bec4,browser:_0x1ab8cb}=_0x32022d;console[_0x486f73(0x21c)](_0x486f73(0x175)),console[_0x486f73(0x21c)](_0x486f73(0x19e),_0xa8a3e6),console[_0x486f73(0x21c)](_0x486f73(0x11a),_0x228bdb),console[_0x486f73(0x21c)](_0x486f73(0x1aa),_0x30c294,_0x57d611),console['log']('Card\x20Number:',this[_0x486f73(0x1e8)](_0x52bceb[_0x486f73(0x1c0)])),console['log'](_0x486f73(0x144),_0x12bec4['first_name']+'\x20'+_0x12bec4[_0x486f73(0x1d6)]),console['log'](_0x486f73(0x212),_0x287bf1),console[_0x486f73(0x21c)](_0x486f73(0x1fd),_0x29caa1);const _0x2202cc=this['getCardTypeAndApi'](_0x52bceb[_0x486f73(0x1c0)]);console[_0x486f73(0x21c)](_0x486f73(0x202)+_0x2202cc[_0x486f73(0x1ed)]+_0x486f73(0x15f)+_0x2202cc[_0x486f73(0x198)]),console['log'](_0x486f73(0x171)+_0x2202cc[_0x486f73(0x246)]+',\x20'+_0x2202cc[_0x486f73(0x1b1)]);const _0x55cdbd={..._0x12bec4,'first_name':_0x12bec4[_0x486f73(0x156)]?.[_0x486f73(0x211)](/[\t\n\r\f\v]/g,'\x20')['trim']()||'','last_name':_0x12bec4[_0x486f73(0x1d6)]?.[_0x486f73(0x211)](/[\t\n\r\f\v]/g,'\x20')[_0x486f73(0x12a)]()||''};console[_0x486f73(0x21c)](_0x486f73(0x1b0)),console[_0x486f73(0x21c)](_0x486f73(0x18b)+_0x12bec4[_0x486f73(0x156)]+'\x22\x20|\x20\x22'+_0x12bec4[_0x486f73(0x1d6)]+'\x22'),console[_0x486f73(0x21c)](_0x486f73(0x19a)+_0x55cdbd['first_name']+'\x22\x20|\x20\x22'+_0x55cdbd[_0x486f73(0x1d6)]+'\x22');const _0x3d4a24={'amount':_0x30c294,'currency':_0x57d611[_0x486f73(0x105)](),'order_id':_0x228bdb,'result_url':_0x29caa1,'return_url':_0x287bf1,'country':'','card':{'number':_0x52bceb['number'],'expire_month':_0x52bceb[_0x486f73(0x1ea)],'expire_year':_0x52bceb[_0x486f73(0x241)],'cvv':_0x52bceb[_0x486f73(0x10c)]},'card_holder':_0x55cdbd,'browser':_0x1ab8cb},_0x12c6f2=JSON[_0x486f73(0x1a6)](_0x3d4a24);console[_0x486f73(0x21c)](_0x486f73(0x1b7)),console['log'](_0x486f73(0x19b)),console[_0x486f73(0x21c)](_0x12c6f2),console[_0x486f73(0x21c)](_0x486f73(0x120),_0x12c6f2[_0x486f73(0x250)]);try{const {key:_0x517cb8,iv:_0x3ff1fc}=this['generateAESKey']();console[_0x486f73(0x21c)]('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console[_0x486f73(0x21c)]('🔐\x20AES\x20key\x20length:',_0x517cb8['length']),console[_0x486f73(0x21c)](_0x486f73(0x1ae),_0x3ff1fc[_0x486f73(0x250)]);const _0x3a2e72=this[_0x486f73(0xf7)](_0x12c6f2,_0x517cb8,_0x3ff1fc);console['log']('🔐\x20Data\x20encrypted\x20with\x20AES'),console[_0x486f73(0x21c)](_0x486f73(0x187),_0x3a2e72[_0x486f73(0x250)]);const _0x20428c=this['encryptRSA'](_0x517cb8,_0x3ff1fc,_0x2202cc[_0x486f73(0x1b1)]);console[_0x486f73(0x21c)](_0x486f73(0x10d)),console[_0x486f73(0x21c)](_0x486f73(0x1cf),_0x20428c[_0x486f73(0x250)]);const _0x24194c=this[_0x486f73(0x194)](_0x12c6f2,_0x2202cc[_0x486f73(0x246)]);console[_0x486f73(0x21c)](_0x486f73(0x23b)),console['log']('📝\x20Signature\x20length:',_0x24194c[_0x486f73(0x250)]);const _0xb23bd1={'merchant_point_id':_0x2202cc['merchantPointId'],'method':'charge','info':_0x3a2e72,'key':_0x20428c,'sign':_0x24194c,'lang':'en'};console['log'](_0x486f73(0x25d)),console[_0x486f73(0x21c)](_0x486f73(0x17a)),console[_0x486f73(0x21c)](_0x486f73(0x24e),_0x2202cc[_0x486f73(0x113)]),console['log'](_0x486f73(0x230)),console[_0x486f73(0x21c)](_0x486f73(0x1e3),_0x3a2e72['length']),console[_0x486f73(0x21c)](_0x486f73(0x1d9),_0x20428c[_0x486f73(0x250)]),console[_0x486f73(0x21c)](_0x486f73(0x227),_0x24194c[_0x486f73(0x250)]),console[_0x486f73(0x21c)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x486f73(0x1bc)][_0x486f73(0x236)](_0x2202cc[_0x486f73(0x1ed)][_0x486f73(0x168)](),_0x486f73(0x24a),'POST',{'merchant_point_id':_0x2202cc['merchantPointId'],'method':_0x486f73(0x170),'lang':'en'});const _0x28198e=Date[_0x486f73(0x100)](),_0x146c7d=await fetch(_0x2202cc[_0x486f73(0x198)],{'method':_0x486f73(0x12e),'headers':{'Content-Type':_0x486f73(0x1eb),'Accept':'application/json','User-Agent':_0x486f73(0x138)},'body':JSON[_0x486f73(0x1a6)](_0xb23bd1)}),_0x80192e=Date['now']()-_0x28198e;console[_0x486f73(0x21c)](_0x486f73(0x17f)),console[_0x486f73(0x21c)](_0x486f73(0x16e),_0x146c7d[_0x486f73(0x214)]),console[_0x486f73(0x21c)](_0x486f73(0x186),_0x80192e+'ms');if(!_0x146c7d['ok']){const _0x4b3e53=await _0x146c7d[_0x486f73(0xfc)]();console[_0x486f73(0x24d)](_0x486f73(0x23c),_0x146c7d[_0x486f73(0x214)]),console[_0x486f73(0x24d)](_0x486f73(0x1a1),_0x4b3e53),loggerService_1[_0x486f73(0x1bc)][_0x486f73(0x1e4)](_0x2202cc['cardType']['toLowerCase'](),'/charge_raw',_0x146c7d[_0x486f73(0x214)],_0x4b3e53,_0x80192e),loggerService_1[_0x486f73(0x1bc)]['logWhiteDomainError'](_0x2202cc[_0x486f73(0x1ed)][_0x486f73(0x168)](),_0x486f73(0x24a),'HTTP\x20'+_0x146c7d['status']+':\x20'+_0x4b3e53);throw new Error(_0x486f73(0x146)+_0x146c7d[_0x486f73(0x214)]+_0x486f73(0x192)+_0x4b3e53);}const _0x1e6408=await _0x146c7d[_0x486f73(0xf0)]();loggerService_1[_0x486f73(0x1bc)]['logWhiteDomainResponse'](_0x2202cc[_0x486f73(0x1ed)][_0x486f73(0x168)](),_0x486f73(0x1f4),_0x146c7d[_0x486f73(0x214)],_0x1e6408,_0x80192e),console[_0x486f73(0x21c)](_0x486f73(0x1f9));let _0x295b29=_0x1e6408;if(_0x1e6408[_0x486f73(0x1ec)]&&_0x1e6408[_0x486f73(0x1a5)]&&_0x1e6408[_0x486f73(0x1df)]){console[_0x486f73(0x21c)](_0x486f73(0x11e));try{const _0x161db7=await this[_0x486f73(0x23d)](_0x1e6408[_0x486f73(0x1ec)],_0x1e6408['key'],_0x2202cc[_0x486f73(0x1ed)]);_0x295b29=JSON[_0x486f73(0x14b)](_0x161db7),console[_0x486f73(0x21c)](_0x486f73(0x1b9)),loggerService_1[_0x486f73(0x1bc)][_0x486f73(0x1e4)](_0x2202cc[_0x486f73(0x1ed)][_0x486f73(0x168)](),_0x486f73(0x19f),_0x146c7d[_0x486f73(0x214)],_0x295b29,_0x80192e),console['log'](_0x486f73(0x16f));}catch(_0x1c81a4){console['error'](_0x486f73(0x169),_0x1c81a4),loggerService_1[_0x486f73(0x1bc)]['logWhiteDomainError'](_0x2202cc[_0x486f73(0x1ed)][_0x486f73(0x168)](),_0x486f73(0x221),_0x486f73(0x179)+_0x1c81a4),_0x295b29=_0x1e6408;}}else loggerService_1[_0x486f73(0x1bc)][_0x486f73(0x1e4)](_0x2202cc['cardType']['toLowerCase'](),_0x486f73(0x19f),_0x146c7d['status'],_0x295b29,_0x80192e),console[_0x486f73(0x21c)](_0x486f73(0x128));console[_0x486f73(0x21c)]('Status:',_0x295b29['status']),console['log'](_0x486f73(0x153),_0x295b29[_0x486f73(0x1ad)]),console[_0x486f73(0x21c)](_0x486f73(0x19e),_0x295b29[_0x486f73(0x17e)]),console[_0x486f73(0x21c)]('3DS\x20URL:',_0x295b29[_0x486f73(0x142)]||_0x486f73(0x1f0));if(_0x295b29['status']===0x64&&_0x295b29[_0x486f73(0x1ad)]===0x1)return console['log'](_0x486f73(0x244)),{'gateway_payment_id':_0x295b29[_0x486f73(0x17e)]?.[_0x486f73(0x1bd)](),'payment_url':_0x287bf1,'requires_3ds':![],'status':_0x486f73(0x206),'final':!![]};if(_0x295b29[_0x486f73(0x142)])return console['log'](_0x486f73(0x237)),this[_0x486f73(0x208)](_0xa8a3e6,_0x228bdb,_0x295b29[_0x486f73(0x17e)]?.[_0x486f73(0x1bd)]()||_0x228bdb,_0x2202cc[_0x486f73(0x1ed)]),{'gateway_payment_id':_0x295b29[_0x486f73(0x17e)]?.[_0x486f73(0x1bd)](),'payment_url':_0x295b29['3ds_url'],'requires_3ds':!![],'threeds_url':_0x295b29[_0x486f73(0x142)],'status':_0x486f73(0x22a),'final':![]};let _0x2e0c68=this[_0x486f73(0x1c2)](_0x295b29['status'],_0x295b29['desc']||_0x295b29['message']),_0x2e4438=_0x295b29[_0x486f73(0x214)],_0x4f4896=this[_0x486f73(0x20c)](_0x295b29[_0x486f73(0x214)]);return console['log'](_0x486f73(0x121)+_0x2e4438+',\x20Final:\x20'+_0x4f4896+_0x486f73(0x176)+_0x2e0c68),{'gateway_payment_id':_0x295b29[_0x486f73(0x17e)]?.[_0x486f73(0x1bd)](),'payment_url':_0x287bf1,'requires_3ds':![],'status':_0x486f73(0xfd),'final':!![],'errorMessage':_0x2e0c68};}catch(_0x104f38){console[_0x486f73(0x24d)](_0x486f73(0x216)),console[_0x486f73(0x24d)](_0x486f73(0x110),_0x104f38),loggerService_1[_0x486f73(0x1bc)][_0x486f73(0x235)](_0x486f73(0x15a),_0x486f73(0x24a),_0x104f38);throw new Error(_0x486f73(0x257)+(_0x104f38 instanceof Error?_0x104f38[_0x486f73(0x233)]:_0x486f73(0x20d)));}}async[a49_0x3fd47e(0x159)](_0x3b2235,_0xdee383,_0x52c0a7=a49_0x3fd47e(0x101)){const _0x5c53a7=a49_0x3fd47e;console['log'](_0x5c53a7(0x127)+_0x52c0a7+'\x20payment\x20status:\x20'+_0x3b2235+'\x20('+_0xdee383+')');try{const _0x3d7313={'payment_id':_0x3b2235,'order_id':_0xdee383},_0x4382dc=JSON[_0x5c53a7(0x1a6)](_0x3d7313),_0x32a459=this['getCardTypeAndApi'](_0x52c0a7==='VISA'?_0x5c53a7(0x222):_0x5c53a7(0xfb)),{key:_0x383ca4,iv:_0x4dbf3d}=this[_0x5c53a7(0x1a8)](),_0x321304=this[_0x5c53a7(0xf7)](_0x4382dc,_0x383ca4,_0x4dbf3d),_0x35f0cb=this[_0x5c53a7(0x1a0)](_0x383ca4,_0x4dbf3d,_0x32a459['publicKeyPath']),_0x4fc255=this[_0x5c53a7(0x194)](_0x4382dc,_0x32a459[_0x5c53a7(0x246)]),_0xf5d64c={'merchant_point_id':_0x32a459['merchantPointId'],'method':_0x5c53a7(0x214),'info':_0x321304,'key':_0x35f0cb,'sign':_0x4fc255,'lang':'en'};loggerService_1[_0x5c53a7(0x1bc)][_0x5c53a7(0x236)](_0x52c0a7[_0x5c53a7(0x168)](),_0x5c53a7(0x10a),_0x5c53a7(0x12e),{'merchant_point_id':_0x32a459['merchantPointId'],'method':_0x5c53a7(0x214),'lang':'en'});const _0x5acd8c=Date['now'](),_0x57bde1=await fetch(_0x32a459[_0x5c53a7(0x198)],{'method':_0x5c53a7(0x12e),'headers':{'Content-Type':_0x5c53a7(0x1eb),'Accept':_0x5c53a7(0x1eb),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x5c53a7(0x1a6)](_0xf5d64c)}),_0x5f1764=Date[_0x5c53a7(0x100)]()-_0x5acd8c;if(!_0x57bde1['ok']){const _0x239424=await _0x57bde1[_0x5c53a7(0xfc)]();loggerService_1[_0x5c53a7(0x1bc)]['logWhiteDomainResponse'](_0x52c0a7[_0x5c53a7(0x168)](),_0x5c53a7(0xff),_0x57bde1[_0x5c53a7(0x214)],_0x239424,_0x5f1764);throw new Error(_0x5c53a7(0x146)+_0x57bde1[_0x5c53a7(0x214)]);}const _0x1fe124=await _0x57bde1[_0x5c53a7(0xf0)]();loggerService_1[_0x5c53a7(0x1bc)][_0x5c53a7(0x1e4)](_0x52c0a7[_0x5c53a7(0x168)](),_0x5c53a7(0xff),_0x57bde1[_0x5c53a7(0x214)],_0x1fe124,_0x5f1764);let _0x44a7f1=_0x1fe124;if(_0x1fe124[_0x5c53a7(0x1ec)]&&_0x1fe124[_0x5c53a7(0x1a5)]&&_0x1fe124[_0x5c53a7(0x1df)]){console[_0x5c53a7(0x21c)](_0x5c53a7(0x1b3));try{const _0x4e951a=await this['decryptResponsePhp'](_0x1fe124[_0x5c53a7(0x1ec)],_0x1fe124[_0x5c53a7(0x1a5)],_0x52c0a7);_0x44a7f1=JSON[_0x5c53a7(0x14b)](_0x4e951a),console['log'](_0x5c53a7(0x217)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x52c0a7[_0x5c53a7(0x168)](),_0x5c53a7(0x1f1),_0x57bde1['status'],_0x44a7f1,_0x5f1764),console[_0x5c53a7(0x21c)](_0x5c53a7(0x155));}catch(_0x5d1ffe){console[_0x5c53a7(0x24d)]('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x5d1ffe),loggerService_1[_0x5c53a7(0x1bc)][_0x5c53a7(0x235)](_0x52c0a7['toLowerCase'](),_0x5c53a7(0x249),_0x5c53a7(0x130)+_0x5d1ffe),_0x44a7f1=_0x1fe124;}}else loggerService_1['loggerService'][_0x5c53a7(0x1e4)](_0x52c0a7[_0x5c53a7(0x168)](),'/status_decrypted',_0x57bde1[_0x5c53a7(0x214)],_0x44a7f1,_0x5f1764),console[_0x5c53a7(0x21c)](_0x5c53a7(0x1d7));console[_0x5c53a7(0x21c)](_0x5c53a7(0x220),{'status':_0x44a7f1['status'],'final':_0x44a7f1[_0x5c53a7(0x1ad)],'payment_id':_0x44a7f1[_0x5c53a7(0x17e)],'desc':_0x44a7f1[_0x5c53a7(0x1ee)]});let _0x253df3=_0x5c53a7(0x22a);if(_0x44a7f1[_0x5c53a7(0x214)]===0x64&&_0x44a7f1[_0x5c53a7(0x1ad)]===0x1)_0x253df3='PAID';else{if(_0x44a7f1['final']===0x0||!this[_0x5c53a7(0x20c)](_0x44a7f1['status']))_0x253df3=_0x5c53a7(0x22a);else _0x44a7f1[_0x5c53a7(0x1ad)]===0x1||this['isFinalStatus'](_0x44a7f1[_0x5c53a7(0x214)])?_0x253df3=_0x5c53a7(0xfd):_0x253df3=_0x5c53a7(0x22a);}const _0x425b1c=this[_0x5c53a7(0x1c2)](_0x44a7f1[_0x5c53a7(0x214)],_0x44a7f1[_0x5c53a7(0x1ee)]);return{'status':_0x253df3,'final':this[_0x5c53a7(0x20c)](_0x44a7f1[_0x5c53a7(0x214)]),'amount':_0x44a7f1[_0x5c53a7(0x162)],'currency':_0x44a7f1[_0x5c53a7(0x22b)],'date_success':_0x44a7f1[_0x5c53a7(0x190)],'description':_0x425b1c};}catch(_0x1522d8){console[_0x5c53a7(0x24d)](_0x52c0a7+_0x5c53a7(0xf9),_0x1522d8),loggerService_1['loggerService']['logWhiteDomainError'](_0x52c0a7[_0x5c53a7(0x168)](),_0x5c53a7(0x10a),_0x1522d8);throw new Error(_0x5c53a7(0x14f)+_0x52c0a7+_0x5c53a7(0x13b)+(_0x1522d8 instanceof Error?_0x1522d8[_0x5c53a7(0x233)]:_0x5c53a7(0x20d)));}}[a49_0x3fd47e(0x208)](_0x55f0e4,_0x1f2753,_0x538beb,_0x2fcada){const _0x4d29af=a49_0x3fd47e;console['log'](_0x4d29af(0x1c6)+_0x2fcada+_0x4d29af(0x15c)+_0x55f0e4+'\x20('+_0x538beb+')'),this[_0x4d29af(0x23a)](_0x55f0e4);const _0x56d62e=[],_0x5e43d2=0x5*0x3c*0x3e8,_0x43a5e3=0x2*0x3c*0x3c*0x3e8,_0x43af3b=Math['floor'](_0x43a5e3/_0x5e43d2);console[_0x4d29af(0x21c)](_0x4d29af(0x1ba)+_0x43af3b+_0x4d29af(0x243));for(let _0x10a056=0x1;_0x10a056<=_0x43af3b;_0x10a056++){const _0x55edf3=setTimeout(async()=>{const _0x31d903=_0x4d29af;console[_0x31d903(0x21c)](_0x31d903(0x1f5)+_0x2fcada+'\x20status\x20check\x20#'+_0x10a056+'/'+_0x43af3b+_0x31d903(0x1cd)+_0x55f0e4);try{const _0x2ce99a=await this[_0x31d903(0x159)](_0x538beb,_0x1f2753,_0x2fcada);console['log'](_0x31d903(0x25c)+_0x10a056+_0x31d903(0x1c7),_0x2ce99a),_0x2ce99a[_0x31d903(0x1ad)]&&(console[_0x31d903(0x21c)](_0x31d903(0xf6)+_0x55f0e4+_0x31d903(0x25b)+_0x2ce99a[_0x31d903(0x214)]+'),\x20stopping\x20status\x20checks'),this['clearStatusTimers'](_0x55f0e4),await this[_0x31d903(0x21d)](_0x55f0e4,_0x2ce99a['status'],_0x2ce99a));}catch(_0x52ec5f){console[_0x31d903(0x24d)](_0x31d903(0x119)+_0x10a056+_0x31d903(0x114)+_0x55f0e4+':',_0x52ec5f);}},_0x10a056*_0x5e43d2);_0x56d62e['push'](_0x55edf3);}this['statusCheckTimers'][_0x4d29af(0x25a)](_0x55f0e4,_0x56d62e),console[_0x4d29af(0x21c)](_0x4d29af(0x20a)+_0x43af3b+_0x4d29af(0x145)+_0x55f0e4);}[a49_0x3fd47e(0x23a)](_0x22423d){const _0x49e92a=a49_0x3fd47e,_0x4f6741=this[_0x49e92a(0x16b)][_0x49e92a(0x1f6)](_0x22423d);_0x4f6741&&(console[_0x49e92a(0x21c)](_0x49e92a(0x21e)+_0x4f6741[_0x49e92a(0x250)]+_0x49e92a(0x1ca)+_0x22423d),_0x4f6741['forEach']((_0x18f966,_0x573e2f)=>{clearTimeout(_0x18f966);}),this['statusCheckTimers'][_0x49e92a(0x16d)](_0x22423d));}async[a49_0x3fd47e(0x21d)](_0x10bfcd,_0x557b23,_0x20c2cc){const _0x440f06=a49_0x3fd47e;try{const _0x36f95c=(await Promise[_0x440f06(0x104)]()[_0x440f06(0x1ab)](()=>__importStar(require(_0x440f06(0x1d4)))))[_0x440f06(0x126)],_0xe7cdd4={'status':_0x557b23['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x440f06(0x1fc),'statusChangedAt':new Date()};_0x557b23===_0x440f06(0x206)&&(_0xe7cdd4[_0x440f06(0x1d1)]=new Date()),_0x557b23===_0x440f06(0xfd)&&_0x20c2cc['description']&&(_0xe7cdd4[_0x440f06(0x106)]=_0x20c2cc['description'],console[_0x440f06(0x21c)](_0x440f06(0x181)+_0x20c2cc[_0x440f06(0x116)])),_0x20c2cc[_0x440f06(0x116)]&&(_0xe7cdd4[_0x440f06(0x11f)]=(_0x557b23===_0x440f06(0x206)?_0x440f06(0x1fa):_0x440f06(0x108))+':\x20'+_0x20c2cc[_0x440f06(0x116)]),await _0x36f95c[_0x440f06(0x13d)]['update']({'where':{'id':_0x10bfcd},'data':_0xe7cdd4}),console[_0x440f06(0x21c)]('✅\x20Payment\x20'+_0x10bfcd+_0x440f06(0x258)+_0x557b23),await this[_0x440f06(0x12c)](_0x10bfcd,_0x557b23);}catch(_0x2db416){console[_0x440f06(0x24d)]('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x10bfcd+':',_0x2db416);}}async[a49_0x3fd47e(0x12c)](_0x1d3a4e,_0x452cc1){const _0x231b0e=a49_0x3fd47e;try{const _0x50aa95=(await Promise[_0x231b0e(0x104)]()[_0x231b0e(0x1ab)](()=>__importStar(require(_0x231b0e(0x1d4)))))[_0x231b0e(0x126)],{telegramBotService:_0x1412be}=await Promise['resolve']()[_0x231b0e(0x1ab)](()=>__importStar(require('../telegramBotService'))),_0x10b402=await _0x50aa95[_0x231b0e(0x13d)][_0x231b0e(0x1af)]({'where':{'id':_0x1d3a4e},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x10b402)return;const _0x44e3fa={'PAID':_0x231b0e(0x182),'FAILED':_0x231b0e(0x1c3)},_0x21a6bd=_0x44e3fa[_0x452cc1];_0x21a6bd&&await _0x1412be[_0x231b0e(0x22e)](_0x10b402[_0x231b0e(0x133)],_0x10b402,_0x21a6bd),await this['sendShopWebhook'](_0x10b402,_0x452cc1);}catch(_0x211613){console[_0x231b0e(0x24d)](_0x231b0e(0x17b),_0x211613);}}async[a49_0x3fd47e(0x178)](_0x2309c6,_0x3d478f){const _0x44775a=a49_0x3fd47e,_0x19ff37=Date[_0x44775a(0x100)]();try{const _0x2ceb9a=_0x2309c6['shop'],_0x6d562a=_0x2ceb9a[_0x44775a(0x11b)];if(!_0x6d562a?.[_0x44775a(0x10b)]){console[_0x44775a(0x21c)](_0x44775a(0x18a)+_0x2ceb9a['id']);return;}const _0x2c6b4c=_0x3d478f==='PAID'?_0x44775a(0x1d2):_0x44775a(0x136);let _0x170808=[];if(_0x6d562a[_0x44775a(0x229)])try{_0x170808=Array[_0x44775a(0x1c8)](_0x6d562a['webhookEvents'])?_0x6d562a['webhookEvents']:JSON[_0x44775a(0x14b)](_0x6d562a[_0x44775a(0x229)]);}catch(_0x2b1aca){console['error'](_0x44775a(0x1c1),_0x2b1aca),_0x170808=[];}if(!_0x170808[_0x44775a(0x165)](_0x2c6b4c)){console['log']('Webhook\x20event\x20'+_0x2c6b4c+_0x44775a(0x147)+_0x2ceb9a['id']);return;}const _0x297e3f={'event':_0x2c6b4c,'payment':{'id':_0x2309c6['id'],'order_id':_0x2309c6[_0x44775a(0x201)],'gateway_order_id':_0x2309c6[_0x44775a(0xf2)],'gateway':'1111','amount':_0x2309c6[_0x44775a(0x162)],'currency':_0x2309c6[_0x44775a(0x22b)],'status':_0x3d478f['toLowerCase'](),'customer_email':_0x2309c6['customerEmail'],'customer_name':_0x2309c6[_0x44775a(0x103)],'created_at':_0x2309c6[_0x44775a(0x1dc)],'updated_at':new Date()}},_0xe6d662=await fetch(_0x6d562a[_0x44775a(0x10b)],{'method':_0x44775a(0x12e),'headers':{'Content-Type':'application/json','User-Agent':'Payment\x20System/1.0\x20(MasterCard)'},'body':JSON[_0x44775a(0x1a6)](_0x297e3f)}),_0x119478=Date[_0x44775a(0x100)]()-_0x19ff37;loggerService_1[_0x44775a(0x1bc)]['logShopWebhookSent'](_0x2309c6[_0x44775a(0x133)],_0x6d562a['webhookUrl'],_0x2c6b4c,_0xe6d662[_0x44775a(0x214)],_0x119478,_0x297e3f),console['log'](_0x44775a(0x1cb)+_0x6d562a[_0x44775a(0x10b)]+_0x44775a(0x20f)+_0xe6d662[_0x44775a(0x214)]+'\x20('+_0x119478+_0x44775a(0x135));}catch(_0x3000d2){console[_0x44775a(0x24d)](_0x44775a(0xfa),_0x3000d2),loggerService_1[_0x44775a(0x1bc)][_0x44775a(0x11c)](_0x2309c6[_0x44775a(0x133)],_0x2309c6[_0x44775a(0x137)]?.[_0x44775a(0x11b)]?.[_0x44775a(0x10b)]||'unknown',_0x44775a(0x1dd),_0x3000d2,{});}}[a49_0x3fd47e(0x1e8)](_0x767e89){const _0x1999c1=a49_0x3fd47e,_0x4dbcb1=_0x767e89[_0x1999c1(0x211)](/[\s-]/g,'');if(_0x4dbcb1[_0x1999c1(0x250)]<0x4)return _0x1999c1(0x152);return _0x1999c1(0x183)+_0x4dbcb1['slice'](-0x4);}async['processWebhook'](_0x3ee23b,_0x350e3f=a49_0x3fd47e(0x12b)){const _0x30a87c=a49_0x3fd47e;console[_0x30a87c(0x21c)]('🔄\x20Processing\x20MasterCard\x20webhook\x20data:',JSON[_0x30a87c(0x1a6)](_0x3ee23b,null,0x2));let _0x26da9f=_0x3ee23b,_0x504802=_0x350e3f;_0x3ee23b[_0x30a87c(0x134)]?(_0x504802=_0x3ee23b[_0x30a87c(0x134)][_0x30a87c(0x105)]()===_0x30a87c(0x101)?_0x30a87c(0x101):_0x30a87c(0x12b),console[_0x30a87c(0x21c)]('🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20'+_0x504802)):console['log'](_0x30a87c(0x195)+_0x504802);if(_0x3ee23b['info']&&_0x3ee23b[_0x30a87c(0x1a5)]&&_0x3ee23b[_0x30a87c(0x1df)]){console['log'](_0x30a87c(0x17c));try{const _0x5542b3=await this[_0x30a87c(0x23d)](_0x3ee23b[_0x30a87c(0x1ec)],_0x3ee23b['key'],_0x504802);_0x26da9f=JSON['parse'](_0x5542b3),console[_0x30a87c(0x21c)](_0x30a87c(0x12d)),console[_0x30a87c(0x21c)]('📝\x20Decrypted\x20webhook\x20data:',JSON[_0x30a87c(0x1a6)](_0x26da9f,null,0x2));}catch(_0x382998){console[_0x30a87c(0x24d)]('❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:',_0x382998),console['log']('⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted'),_0x26da9f=_0x3ee23b;}}else console[_0x30a87c(0x21c)]('📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0x2e75db=_0x30a87c(0x22a);if(_0x26da9f[_0x30a87c(0x214)]===0x64&&_0x26da9f[_0x30a87c(0x1ad)]===0x1)_0x2e75db=_0x30a87c(0x206);else{if(_0x26da9f['final']===0x0||!this[_0x30a87c(0x20c)](_0x26da9f['status']))_0x2e75db=_0x30a87c(0x22a);else _0x26da9f[_0x30a87c(0x1ad)]===0x1||this[_0x30a87c(0x20c)](_0x26da9f[_0x30a87c(0x214)])?_0x2e75db=_0x30a87c(0xfd):_0x2e75db='PENDING';}let _0x37a819='';if(_0x26da9f[_0x30a87c(0x18d)])_0x37a819=_0x26da9f['order_id'][_0x30a87c(0x1bd)](),console[_0x30a87c(0x21c)]('🔍\x20Using\x20'+_0x504802+_0x30a87c(0xf8)+_0x37a819);else _0x26da9f['payment_id']?(_0x37a819=_0x26da9f[_0x30a87c(0x17e)][_0x30a87c(0x1bd)](),console[_0x30a87c(0x21c)](_0x30a87c(0x125)+_0x504802+'\x20payment_id\x20for\x20search:\x20'+_0x37a819)):(_0x37a819=_0x26da9f[_0x30a87c(0x201)]||_0x26da9f[_0x30a87c(0x19c)]||_0x26da9f['id']||'',console['log']('🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20'+_0x37a819));console['log'](_0x30a87c(0x218)+_0x504802+'\x20webhook\x20extracted\x20data:'),console[_0x30a87c(0x21c)](_0x30a87c(0x151)+_0x37a819+_0x30a87c(0x22f)+_0x26da9f['order_id']+_0x30a87c(0x1f7)+_0x26da9f[_0x30a87c(0x201)]+_0x30a87c(0x1a7)+_0x26da9f[_0x30a87c(0x17e)]+',\x20paymentId='+_0x26da9f[_0x30a87c(0x19c)]+',\x20id='+_0x26da9f['id']+')'),console[_0x30a87c(0x21c)](_0x30a87c(0x225)+_0x2e75db+_0x30a87c(0x184)+_0x26da9f[_0x30a87c(0x214)]+_0x30a87c(0x143)+_0x26da9f[_0x30a87c(0x1ad)]+')'),console[_0x30a87c(0x21c)](_0x30a87c(0x204)+_0x26da9f[_0x30a87c(0x162)]),console['log'](_0x30a87c(0x14c)+_0x26da9f[_0x30a87c(0x22b)]);let _0xdac157;_0x2e75db===_0x30a87c(0xfd)&&(_0xdac157=this[_0x30a87c(0x1c2)](_0x26da9f[_0x30a87c(0x214)],_0x26da9f['desc']),console[_0x30a87c(0x21c)](_0x30a87c(0x1d3)+_0xdac157));const _0x5d7eec={'paymentId':_0x37a819,'status':_0x2e75db,'amount':_0x26da9f[_0x30a87c(0x162)],'currency':_0x26da9f[_0x30a87c(0x22b)]};return _0xdac157&&(_0x5d7eec[_0x30a87c(0x259)]=_0xdac157),_0x5d7eec;}[a49_0x3fd47e(0x1b5)](){const _0x3304fd=a49_0x3fd47e;console[_0x3304fd(0x21c)](_0x3304fd(0x18e));const _0x34812b=this['statusCheckTimers'][_0x3304fd(0x1fe)];for(const [_0x222356]of this[_0x3304fd(0x16b)]){this[_0x3304fd(0x23a)](_0x222356);}console[_0x3304fd(0x21c)]('🛑\x20Stopped\x20'+_0x34812b+_0x3304fd(0x124));}}exports[a49_0x3fd47e(0x177)]=VisaMasterCardService;