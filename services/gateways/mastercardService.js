'use strict';const a42_0x40fa60=a42_0x2439;(function(_0x29d2fc,_0xe3a731){const _0x903038=a42_0x2439,_0x22438e=_0x29d2fc();while(!![]){try{const _0x3b6417=-parseInt(_0x903038(0x1b9))/0x1+parseInt(_0x903038(0x20a))/0x2*(-parseInt(_0x903038(0x17f))/0x3)+parseInt(_0x903038(0x130))/0x4+-parseInt(_0x903038(0x150))/0x5*(parseInt(_0x903038(0x1ab))/0x6)+-parseInt(_0x903038(0x1b1))/0x7+-parseInt(_0x903038(0x203))/0x8*(-parseInt(_0x903038(0x177))/0x9)+parseInt(_0x903038(0x184))/0xa;if(_0x3b6417===_0xe3a731)break;else _0x22438e['push'](_0x22438e['shift']());}catch(_0x4077ce){_0x22438e['push'](_0x22438e['shift']());}}}(a42_0x2586,0xc5275));var __createBinding=this&&this[a42_0x40fa60(0x1eb)]||(Object[a42_0x40fa60(0x117)]?function(_0x4df15d,_0x2a58d6,_0x1e3f5e,_0x159cfb){const _0x4fd773=a42_0x40fa60;if(_0x159cfb===undefined)_0x159cfb=_0x1e3f5e;var _0x2c6bb9=Object['getOwnPropertyDescriptor'](_0x2a58d6,_0x1e3f5e);(!_0x2c6bb9||(_0x4fd773(0x187)in _0x2c6bb9?!_0x2a58d6[_0x4fd773(0x12a)]:_0x2c6bb9[_0x4fd773(0x185)]||_0x2c6bb9['configurable']))&&(_0x2c6bb9={'enumerable':!![],'get':function(){return _0x2a58d6[_0x1e3f5e];}}),Object[_0x4fd773(0x16b)](_0x4df15d,_0x159cfb,_0x2c6bb9);}:function(_0x477b92,_0x36c347,_0xde3238,_0x5ac870){if(_0x5ac870===undefined)_0x5ac870=_0xde3238;_0x477b92[_0x5ac870]=_0x36c347[_0xde3238];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x123d46,_0x5dd60d){Object['defineProperty'](_0x123d46,'default',{'enumerable':!![],'value':_0x5dd60d});}:function(_0x584ac8,_0x2725c3){const _0x856af=a42_0x40fa60;_0x584ac8[_0x856af(0x1d8)]=_0x2725c3;}),__importStar=this&&this['__importStar']||(function(){var _0x5a980e=function(_0x5a9a3d){const _0x5cf67e=a42_0x2439;return _0x5a980e=Object[_0x5cf67e(0x1a6)]||function(_0x3a9240){const _0x375b1c=_0x5cf67e;var _0x500a15=[];for(var _0x50ced2 in _0x3a9240)if(Object['prototype']['hasOwnProperty'][_0x375b1c(0x182)](_0x3a9240,_0x50ced2))_0x500a15[_0x500a15[_0x375b1c(0x198)]]=_0x50ced2;return _0x500a15;},_0x5a980e(_0x5a9a3d);};return function(_0x50688b){const _0x2d8d20=a42_0x2439;if(_0x50688b&&_0x50688b[_0x2d8d20(0x12a)])return _0x50688b;var _0x22abc0={};if(_0x50688b!=null){for(var _0xc22b2=_0x5a980e(_0x50688b),_0x2e43d4=0x0;_0x2e43d4<_0xc22b2[_0x2d8d20(0x198)];_0x2e43d4++)if(_0xc22b2[_0x2e43d4]!=='default')__createBinding(_0x22abc0,_0x50688b,_0xc22b2[_0x2e43d4]);}return __setModuleDefault(_0x22abc0,_0x50688b),_0x22abc0;};}()),__importDefault=this&&this[a42_0x40fa60(0x204)]||function(_0x5e6a6e){const _0x2d42e3=a42_0x40fa60;return _0x5e6a6e&&_0x5e6a6e[_0x2d42e3(0x12a)]?_0x5e6a6e:{'default':_0x5e6a6e};};Object[a42_0x40fa60(0x16b)](exports,'__esModule',{'value':!![]}),exports[a42_0x40fa60(0x171)]=void 0x0;const crypto_1=__importDefault(require(a42_0x40fa60(0x1cc))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x40fa60(0x193))),loggerService_1=require(a42_0x40fa60(0x1dc));function a42_0x2586(){const _0x290c7f=['trim','\x20\x20\x20-\x20key\x20length:','\x20failed\x20for\x20payment\x20','💾\x20Payment\x20data\x20prepared','path','end','payment','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','stopAllStatusChecks','length','encryptAES','size','info','sendPaymentNotifications','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','aes-256-ctr','/charge_decrypted','utf8','validateKeyFiles','existsSync','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','keys','getOwnPropertyNames','logWhiteDomainRequest','createdAt','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','statusCheckTimers','216FnNgBG','🔐\x203DS\x20verification\x20required','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','toUpperCase','randomBytes','10620379cNIPvH','📝\x20Final\x20request\x20structure:','\x20\x20\x20-\x20sign\x20length:','clearStatusTimers','now','delete','Failed\x20to\x20send\x20payment\x20notifications:','🛑\x20Stopped\x20','1090757XNOolq','-----END','HTTP\x20','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','sendShopWebhook','log','📝\x20Signature\x20length:','/status_decrypt','3ds_url','Response\x20Body:','parse','3DS\x20URL:','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','adminNotes','publicEncrypt','****\x20****\x20****\x20','Webhook\x20event\x20','Processing\x20MasterCard\x20webhook:','🧹\x20Clearing\x20','crypto','desc','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','Card\x20Holder:','/charge_raw','\x20status\x20updated\x20to\x20','createDecipheriv','\x20with\x20status\x20','MasterCard:\x20','description','status','webhookUrl','default','🔐\x20Data\x20encrypted\x20with\x20AES','MasterCard\x20webhook\x20sent\x20to\x20','\x20MasterCard\x20status\x20check\x20timers','../loggerService','includes','findUnique','update','❌\x20RSA\x20signing\x20failed:','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','decryptAES','🔐\x20AES\x20IV\x20length:','Public\x20key\x20file\x20not\x20found:\x20','SHA256','\x20\x20\x20-\x20merchant_point_id:','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','Status:','readFileSync','unknown','__createBinding','/status_decrypted','customerName','application/json','\x20characters','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','amount','settings','HTTP\x20Status:','publicKeyPath','shop','📝\x20Encrypted\x20key\x20length:','final','✅\x20Payment\x20successful','PENDING','Error\x20details:','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','gatewayOrderId','🔐\x20RSA\x20signing\x20successful','resolve','processCardPayment','Amount:','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','📝\x20Data\x20length:','8PldECO','__importDefault','join','signRSA','apiUrl','Private\x20key\x20file\x20not\x20found:\x20','paidAt','643460JPrUCo','\x20not\x20enabled\x20for\x20shop\x20','✅\x20Payment\x20','📝\x20Data\x20to\x20sign\x20length:','❌\x20MasterCard\x20key\x20validation\x20failed:','order_id','Return\x20URL:','Unknown\x20error','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','sign','create','✅\x20Status\x20response\x20decrypted\x20successfully','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','webhookEvents','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','payment.success','charge','loggerService','json','logWhiteDomainError','date_success','🔐\x20AES\x20key\x20and\x20IV\x20generated','\x20\x20\x20-\x20method:\x20charge','toLowerCase','),\x20stopping\x20status\x20checks','logWhiteDomainResponse','\x20for\x20payment\x20','psp_public.pem','🔐\x20Public\x20key\x20path:','__esModule','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','key','logShopWebhookSent','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted',',\x20Final:\x20','5498056YlVwtS','-----BEGIN','maskCardNumber','\x20status\x20checks\x20for\x20payment\x20','floor','TesSoft\x20Payment\x20System/1.0','payment_id','FAILED','stringify','processWebhook','decryptResponse','Response\x20Time:','scheduleStatusChecks','POST','mastercard','\x20status\x20timers\x20for\x20payment\x20','updatePaymentStatus','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','HTTP\x20error!\x20status:\x20','\x20\x20\x20-\x20info\x20length:','slice','sendPaymentNotification','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','✅\x20Scheduled\x20','createSign','substring','🔐\x20AES\x20key\x20length:','\x20result:','webhook_send','failed','🔐\x20Public\x20key\x20length:\x20','encryptRSA','185635HUxDTL','Order\x20ID:','privateKeyPath','📝\x20Encrypted\x20data\x20length:','../../config/database','🔐\x20Private\x20key\x20length:\x20',',\x20Desc:\x20','then','set','private.pem','\x20is\x20final\x20(','/status','📊\x20Status\x20check\x20#','payment.failed','checkPaymentStatus','💳\x20MasterCard\x20service\x20initialized','/status_raw','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','replace','push','generateAESKey','/charge','text','privateDecrypt','PHP\x20decryptor\x20error','defineProperty','customerEmail','message','Failed\x20to\x20send\x20MasterCard\x20webhook:','orderId','error','MasterCardService','RSA_PKCS1_PADDING','createCipheriv','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','toString','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','3763638nBxibL','PAID','🔐\x20Private\x20key\x20path:','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','from','merchantPointId','⏰\x20Will\x20check\x20status\x20','📊\x20Status\x20check\x20result:','15gaEwQp','currency','number','call','🔍\x20MasterCard\x20status\x20check\x20#','45680210UdxrVG','writable','paid','get','shopId','❌\x20Status\x20check\x20#','\x20\x20\x20-\x20lang:\x20en','isArray','first_name','base64','Final:'];a42_0x2586=function(){return _0x290c7f;};return a42_0x2586();}class MasterCardService{constructor(){const _0x5f355f=a42_0x40fa60;this[_0x5f355f(0x1aa)]=new Map(),this['apiUrl']='https://api.paydmeth.com/api',this[_0x5f355f(0x17c)]=0x67c,this[_0x5f355f(0x152)]=path_1[_0x5f355f(0x1d8)][_0x5f355f(0x205)](process['cwd'](),_0x5f355f(0x1a5),_0x5f355f(0x159)),this[_0x5f355f(0x1f4)]=path_1[_0x5f355f(0x1d8)][_0x5f355f(0x205)](process['cwd'](),_0x5f355f(0x1a5),_0x5f355f(0x128)),console[_0x5f355f(0x1be)](_0x5f355f(0x15f)),console[_0x5f355f(0x1be)](_0x5f355f(0x179),this['privateKeyPath']),console['log'](_0x5f355f(0x129),this[_0x5f355f(0x1f4)]),this[_0x5f355f(0x1a1)]();}[a42_0x40fa60(0x1a1)](){const _0x415dfd=a42_0x40fa60;try{if(!fs_1[_0x415dfd(0x1d8)][_0x415dfd(0x1a2)](this[_0x415dfd(0x152)]))throw new Error(_0x415dfd(0x208)+this[_0x415dfd(0x152)]);if(!fs_1[_0x415dfd(0x1d8)][_0x415dfd(0x1a2)](this[_0x415dfd(0x1f4)]))throw new Error(_0x415dfd(0x1e4)+this[_0x415dfd(0x1f4)]);const _0x468c5f=fs_1[_0x415dfd(0x1d8)][_0x415dfd(0x1e9)](this[_0x415dfd(0x152)],_0x415dfd(0x1a0))[_0x415dfd(0x18f)](),_0x1b9c37=fs_1[_0x415dfd(0x1d8)][_0x415dfd(0x1e9)](this[_0x415dfd(0x1f4)],_0x415dfd(0x1a0))[_0x415dfd(0x18f)]();if(!_0x468c5f[_0x415dfd(0x1dd)](_0x415dfd(0x131))||!_0x468c5f[_0x415dfd(0x1dd)](_0x415dfd(0x1ba)))throw new Error(_0x415dfd(0x163));if(!_0x1b9c37[_0x415dfd(0x1dd)](_0x415dfd(0x131))||!_0x1b9c37[_0x415dfd(0x1dd)](_0x415dfd(0x1ba)))throw new Error(_0x415dfd(0x1ad));console[_0x415dfd(0x1be)](_0x415dfd(0x174)),console[_0x415dfd(0x1be)](_0x415dfd(0x155)+_0x468c5f[_0x415dfd(0x198)]+_0x415dfd(0x1ef)),console[_0x415dfd(0x1be)](_0x415dfd(0x14e)+_0x1b9c37[_0x415dfd(0x198)]+'\x20characters');}catch(_0x48e27f){console[_0x415dfd(0x170)](_0x415dfd(0x20e),_0x48e27f);throw _0x48e27f;}}['generateAESKey'](){const _0x585fef=a42_0x40fa60,_0x29481b=crypto_1['default'][_0x585fef(0x1b0)](0x20),_0x4c2464=crypto_1[_0x585fef(0x1d8)]['randomBytes'](0x10);return{'key':_0x29481b,'iv':_0x4c2464};}[a42_0x40fa60(0x199)](_0xbc63c9,_0x43c830,_0x324d06){const _0x165682=a42_0x40fa60,_0x3152dd=crypto_1[_0x165682(0x1d8)][_0x165682(0x173)]('aes-256-ctr',_0x43c830,_0x324d06);let _0xb2f761=_0x3152dd['update'](_0xbc63c9,_0x165682(0x1a0),'base64');return _0xb2f761+=_0x3152dd['final'](_0x165682(0x18d)),_0xb2f761;}[a42_0x40fa60(0x14f)](_0x59272b,_0x3927ed){const _0x1b3978=a42_0x40fa60;try{const _0x554423=fs_1['default']['readFileSync'](this['publicKeyPath'],_0x1b3978(0x1a0))['trim'](),_0x1a3e3d={'iv':_0x3927ed[_0x1b3978(0x175)](_0x1b3978(0x18d)),'key':_0x59272b[_0x1b3978(0x175)](_0x1b3978(0x18d))},_0x53c74f=JSON[_0x1b3978(0x138)](_0x1a3e3d);console[_0x1b3978(0x1be)](_0x1b3978(0x119),_0x53c74f[_0x1b3978(0x198)]);const _0x5a8005=crypto_1[_0x1b3978(0x1d8)][_0x1b3978(0x1c7)]({'key':_0x554423,'padding':crypto_1[_0x1b3978(0x1d8)]['constants'][_0x1b3978(0x172)]},Buffer[_0x1b3978(0x17b)](_0x53c74f));return console[_0x1b3978(0x1be)](_0x1b3978(0x1bc),_0x5a8005[_0x1b3978(0x198)]),_0x5a8005[_0x1b3978(0x175)](_0x1b3978(0x18d));}catch(_0x5846b5){console[_0x1b3978(0x170)]('❌\x20RSA\x20encryption\x20failed:',_0x5846b5);throw new Error(_0x1b3978(0x1a3));}}['signRSA'](_0x7b194c){const _0x2337f6=a42_0x40fa60;try{const _0x202a46=fs_1[_0x2337f6(0x1d8)]['readFileSync'](this[_0x2337f6(0x152)],_0x2337f6(0x1a0))[_0x2337f6(0x18f)](),_0x5a2444=crypto_1[_0x2337f6(0x1d8)][_0x2337f6(0x148)](_0x2337f6(0x1e5));_0x5a2444['update'](_0x7b194c),_0x5a2444[_0x2337f6(0x194)]();const _0x5183d8=_0x5a2444[_0x2337f6(0x116)](_0x202a46,_0x2337f6(0x18d));return console[_0x2337f6(0x1be)](_0x2337f6(0x1fd)),console[_0x2337f6(0x1be)](_0x2337f6(0x20d),_0x7b194c['length']),console[_0x2337f6(0x1be)]('📝\x20Signature\x20length:',_0x5183d8[_0x2337f6(0x198)]),_0x5183d8;}catch(_0x1d55cd){console[_0x2337f6(0x170)](_0x2337f6(0x1e0),_0x1d55cd),console['error']('❌\x20Data\x20being\x20signed:',_0x7b194c[_0x2337f6(0x149)](0x0,0xc8)+'...');throw new Error(_0x2337f6(0x1c5));}}['decryptAES'](_0x27209b,_0x5774a8,_0x6f8424){const _0x18a26a=a42_0x40fa60,_0x15eb7b=crypto_1[_0x18a26a(0x1d8)][_0x18a26a(0x1d2)](_0x18a26a(0x19e),_0x5774a8,_0x6f8424);let _0x27f2b2=_0x15eb7b['update'](_0x27209b,'base64',_0x18a26a(0x1a0));return _0x27f2b2+=_0x15eb7b[_0x18a26a(0x1f7)](_0x18a26a(0x1a0)),_0x27f2b2;}async['decryptResponsePhp'](_0x93b474,_0x5da225){const _0x479780=a42_0x40fa60;try{const _0x5d1938=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x479780(0x13d),'headers':{'Content-Type':'application/json'},'body':JSON[_0x479780(0x138)]({'info':_0x93b474,'key':_0x5da225})});if(!_0x5d1938['ok'])throw new Error(_0x479780(0x16a));return await _0x5d1938[_0x479780(0x168)]();}catch(_0x5ab9bf){console[_0x479780(0x170)]('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x5ab9bf);throw new Error(_0x479780(0x162));}}[a42_0x40fa60(0x13a)](_0x1f80d6,_0x40de07){const _0x5c82b0=a42_0x40fa60;try{const _0x5b0fd1=fs_1[_0x5c82b0(0x1d8)][_0x5c82b0(0x1e9)](this['privateKeyPath'],_0x5c82b0(0x1a0))[_0x5c82b0(0x18f)](),_0x365a52=crypto_1[_0x5c82b0(0x1d8)][_0x5c82b0(0x169)](_0x5b0fd1,Buffer[_0x5c82b0(0x17b)](_0x40de07,_0x5c82b0(0x18d))),_0x4f9c65=JSON[_0x5c82b0(0x1c3)](_0x365a52[_0x5c82b0(0x175)]()),_0x74d857=Buffer[_0x5c82b0(0x17b)](_0x4f9c65['key'],_0x5c82b0(0x18d)),_0x539e79=Buffer[_0x5c82b0(0x17b)](_0x4f9c65['iv'],_0x5c82b0(0x18d));return this[_0x5c82b0(0x1e2)](_0x1f80d6,_0x74d857,_0x539e79);}catch(_0x55709c){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a42_0x40fa60(0x1ff)](_0x2d589d){const _0x346777=a42_0x40fa60,{paymentId:_0x13c8a6,orderId:_0x4abe03,amount:_0x383ad1,currency:_0x163912,cardData:_0x67a3cb,resultUrl:_0x59a297,returnUrl:_0x4ed53b,cardHolder:_0x37a5e4,browser:_0x324d3b}=_0x2d589d;console['log'](_0x346777(0x17a)),console[_0x346777(0x1be)]('Payment\x20ID:',_0x13c8a6),console['log'](_0x346777(0x151),_0x4abe03),console[_0x346777(0x1be)](_0x346777(0x200),_0x383ad1,_0x163912),console['log']('Card\x20Number:',this[_0x346777(0x132)](_0x67a3cb[_0x346777(0x181)])),console[_0x346777(0x1be)](_0x346777(0x1cf),_0x37a5e4[_0x346777(0x18c)]+'\x20'+_0x37a5e4['last_name']),console[_0x346777(0x1be)](_0x346777(0x210),_0x4ed53b),console[_0x346777(0x1be)]('Result\x20URL:',_0x59a297);const _0x115c6f={'amount':_0x383ad1,'currency':_0x163912[_0x346777(0x1af)](),'order_id':_0x4abe03,'result_url':_0x59a297,'return_url':_0x4ed53b,'card':{'number':_0x67a3cb[_0x346777(0x181)],'expire_month':_0x67a3cb['expire_month'],'expire_year':_0x67a3cb['expire_year'],'cvv':_0x67a3cb['cvv']},'card_holder':_0x37a5e4,'browser':_0x324d3b},_0x1d10b4=JSON[_0x346777(0x138)](_0x115c6f);console[_0x346777(0x1be)](_0x346777(0x192)),console[_0x346777(0x1be)](_0x346777(0x1a9)),console[_0x346777(0x1be)](_0x1d10b4),console['log'](_0x346777(0x202),_0x1d10b4[_0x346777(0x198)]);try{const {key:_0x39551c,iv:_0x1eee46}=this[_0x346777(0x166)]();console[_0x346777(0x1be)](_0x346777(0x122)),console[_0x346777(0x1be)](_0x346777(0x14a),_0x39551c['length']),console[_0x346777(0x1be)](_0x346777(0x1e3),_0x1eee46['length']);const _0x29249e=this[_0x346777(0x199)](_0x1d10b4,_0x39551c,_0x1eee46);console[_0x346777(0x1be)](_0x346777(0x1d9)),console['log'](_0x346777(0x153),_0x29249e[_0x346777(0x198)]);const _0x348ca6=this['encryptRSA'](_0x39551c,_0x1eee46);console['log']('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console['log'](_0x346777(0x1f6),_0x348ca6[_0x346777(0x198)]);const _0x4f21f0=this[_0x346777(0x206)](_0x1d10b4);console[_0x346777(0x1be)]('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x346777(0x1be)](_0x346777(0x1bf),_0x4f21f0[_0x346777(0x198)]);const _0x4dc3e4={'merchant_point_id':this[_0x346777(0x17c)],'method':_0x346777(0x11d),'info':_0x29249e,'key':_0x348ca6,'sign':_0x4f21f0,'lang':'en'};console[_0x346777(0x1be)](_0x346777(0x1ae)),console[_0x346777(0x1be)](_0x346777(0x1b2)),console[_0x346777(0x1be)](_0x346777(0x1e6),this[_0x346777(0x17c)]),console[_0x346777(0x1be)](_0x346777(0x123)),console[_0x346777(0x1be)](_0x346777(0x143),_0x29249e[_0x346777(0x198)]),console[_0x346777(0x1be)](_0x346777(0x190),_0x348ca6[_0x346777(0x198)]),console[_0x346777(0x1be)](_0x346777(0x1b3),_0x4f21f0[_0x346777(0x198)]),console[_0x346777(0x1be)](_0x346777(0x18a)),loggerService_1['loggerService'][_0x346777(0x1a7)](_0x346777(0x13e),_0x346777(0x167),_0x346777(0x13d),{'merchant_point_id':this[_0x346777(0x17c)],'method':_0x346777(0x11d),'lang':'en'});const _0x3ce4ce=Date[_0x346777(0x1b5)](),_0x4a9dbd=await fetch(this[_0x346777(0x207)],{'method':_0x346777(0x13d),'headers':{'Content-Type':'application/json','Accept':_0x346777(0x1ee),'User-Agent':_0x346777(0x135)},'body':JSON[_0x346777(0x138)](_0x4dc3e4)}),_0x10dcd4=Date[_0x346777(0x1b5)]()-_0x3ce4ce;console[_0x346777(0x1be)](_0x346777(0x1a4)),console['log'](_0x346777(0x1e8),_0x4a9dbd['status']),console[_0x346777(0x1be)](_0x346777(0x13b),_0x10dcd4+'ms');if(!_0x4a9dbd['ok']){const _0x231815=await _0x4a9dbd['text']();console[_0x346777(0x170)](_0x346777(0x1f3),_0x4a9dbd['status']),console[_0x346777(0x170)](_0x346777(0x1c2),_0x231815),loggerService_1[_0x346777(0x11e)][_0x346777(0x126)](_0x346777(0x13e),_0x346777(0x1d0),_0x4a9dbd['status'],_0x231815,_0x10dcd4),loggerService_1[_0x346777(0x11e)][_0x346777(0x120)](_0x346777(0x13e),_0x346777(0x167),_0x346777(0x1bb)+_0x4a9dbd[_0x346777(0x1d6)]+':\x20'+_0x231815);throw new Error(_0x346777(0x142)+_0x4a9dbd[_0x346777(0x1d6)]+',\x20body:\x20'+_0x231815);}const _0x5d46f0=await _0x4a9dbd[_0x346777(0x11f)]();loggerService_1[_0x346777(0x11e)][_0x346777(0x126)](_0x346777(0x13e),'/charge_raw',_0x4a9dbd[_0x346777(0x1d6)],_0x5d46f0,_0x10dcd4),console[_0x346777(0x1be)](_0x346777(0x161));let _0x24cdbe=_0x5d46f0;if(_0x5d46f0[_0x346777(0x19b)]&&_0x5d46f0[_0x346777(0x12c)]&&_0x5d46f0[_0x346777(0x116)]){console[_0x346777(0x1be)](_0x346777(0x1ce));try{const _0x20d326=await this['decryptResponsePhp'](_0x5d46f0[_0x346777(0x19b)],_0x5d46f0[_0x346777(0x12c)]);_0x24cdbe=JSON[_0x346777(0x1c3)](_0x20d326),console[_0x346777(0x1be)](_0x346777(0x146)),loggerService_1['loggerService'][_0x346777(0x126)](_0x346777(0x13e),_0x346777(0x19f),_0x4a9dbd[_0x346777(0x1d6)],_0x24cdbe,_0x10dcd4),console[_0x346777(0x1be)](_0x346777(0x1fb));}catch(_0x570350){console[_0x346777(0x170)](_0x346777(0x196),_0x570350),loggerService_1[_0x346777(0x11e)][_0x346777(0x120)]('mastercard','/charge_decrypt','Decryption\x20failed:\x20'+_0x570350),_0x24cdbe=_0x5d46f0;}}else loggerService_1[_0x346777(0x11e)][_0x346777(0x126)](_0x346777(0x13e),_0x346777(0x19f),_0x4a9dbd[_0x346777(0x1d6)],_0x24cdbe,_0x10dcd4),console['log']('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console['log'](_0x346777(0x1e8),_0x24cdbe[_0x346777(0x1d6)]),console[_0x346777(0x1be)](_0x346777(0x18e),_0x24cdbe[_0x346777(0x1f7)]),console[_0x346777(0x1be)]('Payment\x20ID:',_0x24cdbe['payment_id']),console[_0x346777(0x1be)](_0x346777(0x1c4),_0x24cdbe['3ds_url']||'none');if(_0x24cdbe['status']===0x64&&_0x24cdbe[_0x346777(0x1f7)]===0x1)return console['log'](_0x346777(0x1f8)),{'gateway_payment_id':_0x24cdbe[_0x346777(0x136)]?.[_0x346777(0x175)](),'payment_url':_0x4ed53b,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x24cdbe['3ds_url'])return console[_0x346777(0x1be)](_0x346777(0x1ac)),this[_0x346777(0x13c)](_0x13c8a6,_0x4abe03,_0x24cdbe[_0x346777(0x136)]?.[_0x346777(0x175)]()||_0x4abe03),{'gateway_payment_id':_0x24cdbe[_0x346777(0x136)]?.[_0x346777(0x175)](),'payment_url':_0x24cdbe[_0x346777(0x1c1)],'requires_3ds':!![],'threeds_url':_0x24cdbe[_0x346777(0x1c1)],'status':'PENDING','final':![]};let _0xbafba0=_0x24cdbe[_0x346777(0x1cd)]||_0x24cdbe['message']||_0x346777(0x114),_0x3e8a2c=_0x24cdbe['status'],_0x572f35=_0x24cdbe[_0x346777(0x1f7)];return console[_0x346777(0x1be)](_0x346777(0x12b)+_0x3e8a2c+_0x346777(0x12f)+_0x572f35+_0x346777(0x156)+_0xbafba0),{'gateway_payment_id':_0x24cdbe[_0x346777(0x136)]?.['toString'](),'payment_url':_0x4ed53b,'requires_3ds':![],'status':_0x346777(0x137),'final':!![]};}catch(_0x471007){console[_0x346777(0x170)]('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console[_0x346777(0x170)](_0x346777(0x1fa),_0x471007),loggerService_1['loggerService'][_0x346777(0x120)](_0x346777(0x13e),_0x346777(0x167),_0x471007);throw new Error('Failed\x20to\x20process\x20MasterCard\x20payment:\x20'+(_0x471007 instanceof Error?_0x471007[_0x346777(0x16d)]:_0x346777(0x114)));}}async[a42_0x40fa60(0x15e)](_0x10b558,_0x1ed54e){const _0x998e4=a42_0x40fa60;console[_0x998e4(0x1be)](_0x998e4(0x1e7)+_0x10b558+'\x20('+_0x1ed54e+')');try{const _0x14014d={'payment_id':_0x10b558,'order_id':_0x1ed54e},_0x20c261=JSON[_0x998e4(0x138)](_0x14014d),{key:_0x257f25,iv:_0x59a738}=this[_0x998e4(0x166)](),_0x136701=this[_0x998e4(0x199)](_0x20c261,_0x257f25,_0x59a738),_0x30ec92=this[_0x998e4(0x14f)](_0x257f25,_0x59a738),_0x5dbdef=this['signRSA'](_0x20c261),_0x33db24={'merchant_point_id':this[_0x998e4(0x17c)],'method':'status','info':_0x136701,'key':_0x30ec92,'sign':_0x5dbdef,'lang':'en'};loggerService_1[_0x998e4(0x11e)][_0x998e4(0x1a7)](_0x998e4(0x13e),_0x998e4(0x15b),_0x998e4(0x13d),{'merchant_point_id':this['merchantPointId'],'method':_0x998e4(0x1d6),'lang':'en'});const _0x27c04b=Date[_0x998e4(0x1b5)](),_0x5b3010=await fetch(this[_0x998e4(0x207)],{'method':_0x998e4(0x13d),'headers':{'Content-Type':'application/json','Accept':_0x998e4(0x1ee),'User-Agent':_0x998e4(0x135)},'body':JSON[_0x998e4(0x138)](_0x33db24)}),_0x5aaa31=Date[_0x998e4(0x1b5)]()-_0x27c04b;if(!_0x5b3010['ok']){const _0x4dffab=await _0x5b3010[_0x998e4(0x168)]();loggerService_1[_0x998e4(0x11e)][_0x998e4(0x126)](_0x998e4(0x13e),_0x998e4(0x160),_0x5b3010[_0x998e4(0x1d6)],_0x4dffab,_0x5aaa31);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5b3010[_0x998e4(0x1d6)]);}const _0x58d340=await _0x5b3010['json']();loggerService_1[_0x998e4(0x11e)]['logWhiteDomainResponse']('mastercard',_0x998e4(0x160),_0x5b3010[_0x998e4(0x1d6)],_0x58d340,_0x5aaa31);let _0x48ebb9=_0x58d340;if(_0x58d340['info']&&_0x58d340[_0x998e4(0x12c)]&&_0x58d340['sign']){console[_0x998e4(0x1be)](_0x998e4(0x1f0));try{const _0x540ce9=this['decryptResponse'](_0x58d340[_0x998e4(0x19b)],_0x58d340[_0x998e4(0x12c)]);_0x48ebb9=JSON[_0x998e4(0x1c3)](_0x540ce9),console[_0x998e4(0x1be)](_0x998e4(0x118)),loggerService_1['loggerService'][_0x998e4(0x126)](_0x998e4(0x13e),'/status_decrypted',_0x5b3010['status'],_0x48ebb9,_0x5aaa31),console[_0x998e4(0x1be)](_0x998e4(0x19d));}catch(_0x57f977){console[_0x998e4(0x170)]('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x57f977),loggerService_1[_0x998e4(0x11e)][_0x998e4(0x120)]('mastercard',_0x998e4(0x1c0),'Status\x20decryption\x20failed:\x20'+_0x57f977),_0x48ebb9=_0x58d340;}}else loggerService_1[_0x998e4(0x11e)][_0x998e4(0x126)](_0x998e4(0x13e),_0x998e4(0x1ec),_0x5b3010[_0x998e4(0x1d6)],_0x48ebb9,_0x5aaa31),console['log'](_0x998e4(0x12e));console[_0x998e4(0x1be)](_0x998e4(0x17e),{'status':_0x48ebb9[_0x998e4(0x1d6)],'final':_0x48ebb9['final'],'payment_id':_0x48ebb9[_0x998e4(0x136)],'desc':_0x48ebb9[_0x998e4(0x1cd)]});let _0xf06c60=_0x998e4(0x1f9);if(_0x48ebb9[_0x998e4(0x1d6)]===0x1&&_0x48ebb9[_0x998e4(0x1f7)]===0x1)_0xf06c60=_0x998e4(0x178);else _0x48ebb9[_0x998e4(0x1d6)]===0x0&&_0x48ebb9[_0x998e4(0x1f7)]===0x0?_0xf06c60=_0x998e4(0x1f9):_0xf06c60=_0x998e4(0x137);return{'status':_0xf06c60,'final':_0x48ebb9[_0x998e4(0x1f7)]===0x1,'amount':_0x48ebb9['amount'],'currency':_0x48ebb9[_0x998e4(0x180)],'date_success':_0x48ebb9[_0x998e4(0x121)],'description':_0x48ebb9[_0x998e4(0x1cd)]};}catch(_0x5ed0f1){console[_0x998e4(0x170)]('MasterCard\x20status\x20check\x20error:',_0x5ed0f1),loggerService_1[_0x998e4(0x11e)][_0x998e4(0x120)](_0x998e4(0x13e),_0x998e4(0x15b),_0x5ed0f1);throw new Error('Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20'+(_0x5ed0f1 instanceof Error?_0x5ed0f1[_0x998e4(0x16d)]:_0x998e4(0x114)));}}[a42_0x40fa60(0x13c)](_0x5be713,_0x308696,_0x4eca2e){const _0x45455c=a42_0x40fa60;console[_0x45455c(0x1be)](_0x45455c(0x11b)+_0x5be713+'\x20('+_0x4eca2e+')'),this['clearStatusTimers'](_0x5be713);const _0x5d06da=[],_0x349f47=0x5*0x3c*0x3e8,_0x3f89d8=0x2*0x3c*0x3c*0x3e8,_0x5cfb3c=Math[_0x45455c(0x134)](_0x3f89d8/_0x349f47);console[_0x45455c(0x1be)](_0x45455c(0x17d)+_0x5cfb3c+_0x45455c(0x115));for(let _0x218e66=0x1;_0x218e66<=_0x5cfb3c;_0x218e66++){const _0x12ab2b=setTimeout(async()=>{const _0x282abe=_0x45455c;console[_0x282abe(0x1be)](_0x282abe(0x183)+_0x218e66+'/'+_0x5cfb3c+_0x282abe(0x127)+_0x5be713);try{const _0x2630cd=await this[_0x282abe(0x15e)](_0x4eca2e,_0x308696);console[_0x282abe(0x1be)](_0x282abe(0x15c)+_0x218e66+_0x282abe(0x14b),_0x2630cd),_0x2630cd[_0x282abe(0x1f7)]&&(console[_0x282abe(0x1be)](_0x282abe(0x20c)+_0x5be713+_0x282abe(0x15a)+_0x2630cd[_0x282abe(0x1d6)]+_0x282abe(0x125)),this['clearStatusTimers'](_0x5be713),await this[_0x282abe(0x140)](_0x5be713,_0x2630cd[_0x282abe(0x1d6)],_0x2630cd));}catch(_0x1a7399){console['error'](_0x282abe(0x189)+_0x218e66+_0x282abe(0x191)+_0x5be713+':',_0x1a7399);}},_0x218e66*_0x349f47);_0x5d06da[_0x45455c(0x165)](_0x12ab2b);}this[_0x45455c(0x1aa)][_0x45455c(0x158)](_0x5be713,_0x5d06da),console[_0x45455c(0x1be)](_0x45455c(0x147)+_0x5cfb3c+_0x45455c(0x133)+_0x5be713);}[a42_0x40fa60(0x1b4)](_0x282c21){const _0x13f00f=a42_0x40fa60,_0x4e18e4=this[_0x13f00f(0x1aa)][_0x13f00f(0x187)](_0x282c21);_0x4e18e4&&(console[_0x13f00f(0x1be)](_0x13f00f(0x1cb)+_0x4e18e4[_0x13f00f(0x198)]+_0x13f00f(0x13f)+_0x282c21),_0x4e18e4['forEach']((_0x401c5f,_0x341bc3)=>{clearTimeout(_0x401c5f);}),this['statusCheckTimers'][_0x13f00f(0x1b6)](_0x282c21));}async['updatePaymentStatus'](_0x3c461b,_0x350c12,_0x53ea81){const _0x58d61d=a42_0x40fa60;try{const _0x2358cb=(await Promise['resolve']()[_0x58d61d(0x157)](()=>__importStar(require(_0x58d61d(0x154)))))['default'],_0x3ffc38={'status':_0x350c12[_0x58d61d(0x1af)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x350c12===_0x58d61d(0x178)&&(_0x3ffc38[_0x58d61d(0x209)]=new Date()),_0x53ea81['description']&&(_0x3ffc38[_0x58d61d(0x1c6)]=_0x58d61d(0x1d4)+_0x53ea81[_0x58d61d(0x1d5)]),await _0x2358cb[_0x58d61d(0x195)][_0x58d61d(0x1df)]({'where':{'id':_0x3c461b},'data':_0x3ffc38}),console[_0x58d61d(0x1be)](_0x58d61d(0x20c)+_0x3c461b+_0x58d61d(0x1d1)+_0x350c12),await this[_0x58d61d(0x19c)](_0x3c461b,_0x350c12);}catch(_0x2aa5b1){console[_0x58d61d(0x170)](_0x58d61d(0x141)+_0x3c461b+':',_0x2aa5b1);}}async[a42_0x40fa60(0x19c)](_0x2455fd,_0x179bdf){const _0xadce59=a42_0x40fa60;try{const _0x5ba961=(await Promise[_0xadce59(0x1fe)]()['then'](()=>__importStar(require(_0xadce59(0x154)))))[_0xadce59(0x1d8)],{telegramBotService:_0x14e4c6}=await Promise[_0xadce59(0x1fe)]()['then'](()=>__importStar(require('../telegramBotService'))),_0x56f415=await _0x5ba961[_0xadce59(0x195)][_0xadce59(0x1de)]({'where':{'id':_0x2455fd},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x56f415)return;const _0xae6eeb={'PAID':_0xadce59(0x186),'FAILED':_0xadce59(0x14d)},_0x179d0f=_0xae6eeb[_0x179bdf];_0x179d0f&&await _0x14e4c6[_0xadce59(0x145)](_0x56f415[_0xadce59(0x188)],_0x56f415,_0x179d0f),await this['sendShopWebhook'](_0x56f415,_0x179bdf);}catch(_0x27727e){console[_0xadce59(0x170)](_0xadce59(0x1b7),_0x27727e);}}async[a42_0x40fa60(0x1bd)](_0x172b17,_0x22c0c2){const _0x4f3774=a42_0x40fa60,_0x109453=Date['now']();try{const _0x188366=_0x172b17['shop'],_0x3cb661=_0x188366[_0x4f3774(0x1f2)];if(!_0x3cb661?.['webhookUrl']){console['log'](_0x4f3774(0x176)+_0x188366['id']);return;}const _0x3c3b9f=_0x22c0c2===_0x4f3774(0x178)?_0x4f3774(0x11c):_0x4f3774(0x15d);let _0x16bebc=[];if(_0x3cb661[_0x4f3774(0x11a)])try{_0x16bebc=Array[_0x4f3774(0x18b)](_0x3cb661[_0x4f3774(0x11a)])?_0x3cb661['webhookEvents']:JSON[_0x4f3774(0x1c3)](_0x3cb661[_0x4f3774(0x11a)]);}catch(_0x2c2d53){console[_0x4f3774(0x170)]('Error\x20parsing\x20webhook\x20events:',_0x2c2d53),_0x16bebc=[];}if(!_0x16bebc[_0x4f3774(0x1dd)](_0x3c3b9f)){console['log'](_0x4f3774(0x1c9)+_0x3c3b9f+_0x4f3774(0x20b)+_0x188366['id']);return;}const _0x115f61={'event':_0x3c3b9f,'payment':{'id':_0x172b17['id'],'order_id':_0x172b17[_0x4f3774(0x16f)],'gateway_order_id':_0x172b17[_0x4f3774(0x1fc)],'gateway':'1111','amount':_0x172b17[_0x4f3774(0x1f1)],'currency':_0x172b17[_0x4f3774(0x180)],'status':_0x22c0c2[_0x4f3774(0x124)](),'customer_email':_0x172b17[_0x4f3774(0x16c)],'customer_name':_0x172b17[_0x4f3774(0x1ed)],'created_at':_0x172b17[_0x4f3774(0x1a8)],'updated_at':new Date()}},_0x13a53d=await fetch(_0x3cb661['webhookUrl'],{'method':'POST','headers':{'Content-Type':_0x4f3774(0x1ee),'User-Agent':_0x4f3774(0x201)},'body':JSON[_0x4f3774(0x138)](_0x115f61)}),_0xdf219b=Date[_0x4f3774(0x1b5)]()-_0x109453;loggerService_1[_0x4f3774(0x11e)][_0x4f3774(0x12d)](_0x172b17[_0x4f3774(0x188)],_0x3cb661[_0x4f3774(0x1d7)],_0x3c3b9f,_0x13a53d[_0x4f3774(0x1d6)],_0xdf219b,_0x115f61),console['log'](_0x4f3774(0x1da)+_0x3cb661[_0x4f3774(0x1d7)]+_0x4f3774(0x1d3)+_0x13a53d[_0x4f3774(0x1d6)]+'\x20('+_0xdf219b+'ms)');}catch(_0x2350c1){console[_0x4f3774(0x170)](_0x4f3774(0x16e),_0x2350c1),loggerService_1[_0x4f3774(0x11e)]['logShopWebhookError'](_0x172b17[_0x4f3774(0x188)],_0x172b17[_0x4f3774(0x1f5)]?.[_0x4f3774(0x1f2)]?.[_0x4f3774(0x1d7)]||_0x4f3774(0x1ea),_0x4f3774(0x14c),_0x2350c1,{});}}[a42_0x40fa60(0x132)](_0x283cc6){const _0x33d276=a42_0x40fa60,_0x45686e=_0x283cc6[_0x33d276(0x164)](/[\s-]/g,'');if(_0x45686e['length']<0x4)return'****';return _0x33d276(0x1c8)+_0x45686e[_0x33d276(0x144)](-0x4);}async[a42_0x40fa60(0x139)](_0x2a6f10){const _0x478840=a42_0x40fa60;console['log'](_0x478840(0x1ca),_0x2a6f10);let _0x20b6cf=_0x478840(0x1f9);if(_0x2a6f10[_0x478840(0x1d6)]===0x1&&_0x2a6f10[_0x478840(0x1f7)]===0x1)_0x20b6cf=_0x478840(0x178);else _0x2a6f10['status']===0x0&&_0x2a6f10[_0x478840(0x1f7)]===0x0?_0x20b6cf=_0x478840(0x1f9):_0x20b6cf=_0x478840(0x137);return{'paymentId':_0x2a6f10[_0x478840(0x20f)]||'','status':_0x20b6cf,'amount':_0x2a6f10[_0x478840(0x1f1)],'currency':_0x2a6f10[_0x478840(0x180)]};}[a42_0x40fa60(0x197)](){const _0x3737e3=a42_0x40fa60;console['log'](_0x3737e3(0x1e1));const _0x2329f4=this['statusCheckTimers'][_0x3737e3(0x19a)];for(const [_0x32cbc5]of this['statusCheckTimers']){this[_0x3737e3(0x1b4)](_0x32cbc5);}console[_0x3737e3(0x1be)](_0x3737e3(0x1b8)+_0x2329f4+_0x3737e3(0x1db));}}function a42_0x2439(_0x4901ad,_0x45dd51){const _0x258616=a42_0x2586();return a42_0x2439=function(_0x24391c,_0x45858c){_0x24391c=_0x24391c-0x114;let _0x700247=_0x258616[_0x24391c];return _0x700247;},a42_0x2439(_0x4901ad,_0x45dd51);}exports[a42_0x40fa60(0x171)]=MasterCardService;