'use strict';const a60_0x12d171=a60_0xb2ea;function a60_0x3f55(){const _0x274096=['üîê\x20MasterCard\x20Public\x20key\x20length:\x20','üéØ\x20Using\x20','‚ö†Ô∏è\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Sender\x27s\x20card\x20details\x20are\x20required','Test\x20payment','visa/mastercard','/charge_decrypted','Payment\x20ID:','text','../../config/database','üìù\x20Final\x20request\x20structure:','‚ùå\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','‚úÖ\x20Payment\x20','toUpperCase','orderId','‚úÖ\x20Scheduled\x20','‚ùå\x20RSA\x20signing\x20failed:','ms)','MasterCard\x20webhook\x20sent\x20to\x20','headers','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','visaApiUrl','get','shopId','logWhiteDomainError','amount','üìç\x20Full\x20card\x20holder\x20data:','üìù\x20Signature\x20length:','üîÑ\x20Converted\x20postcode\x20to\x20post_code:\x20','now','===\x20API\x20RESPONSE\x20===','description','default','‚ùå\x20Failed\x20to\x20decrypt\x20status\x20response:','Payment\x20System/1.0','Card\x20Holder:','\x20status\x20timers\x20for\x20payment\x20','üîê\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','key','üõë\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','Operation\x20completed\x20successfully','/charge_decrypt','cwd','application/json','expire_month','Payment\x20cancellation\x20is\x20being\x20processed','__setModuleDefault','FAILED','aes-256-ctr','Another\x20unknown\x20error','order_id','payment','===\x20PARSED\x20API\x20RESPONSE\x20===','POST','paymentId','üì¶\x20FULL\x20REQUEST\x20JSON:','‚ùå\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','\x20\x20\x20Payment\x20ID:\x20','\x20\x20\x20Amount:\x20','\x20\x20\x20Currency:\x20','\x20not\x20enabled\x20for\x20shop\x20','webhookUrl','expire_year','HTTP\x20','currency','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','1111','getOwnPropertyDescriptor','\x20payment_id\x20for\x20search:\x20','üîê\x20AES\x20key\x20length:','Failed\x20to\x20send\x20MasterCard\x20webhook:','trim','\x20characters','https://api.myatranz.com/api','üîê\x20Using\x20keys:\x20','Unsuccessful\x20payment','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','Payment\x20returned','crypto','‚úÖ\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','create','Number\x20of\x20attempts\x20exceeded','LookUp\x20number\x20of\x20attempts\x20exceeded','‚ùå\x20VISA/MasterCard\x20key\x20validation\x20failed:','üìù\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','/status_decrypted','updatePaymentStatus','Response\x20Headers:','3ds_url','744bNWUjM','‚ö†Ô∏è\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','Transaction\x20limit\x20exceeded','processWebhook','Amount:','slice','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','üîê\x20AES\x20IV\x20length:','PENDING','üìä\x20','\x20\x20\x20-\x20method:\x20charge','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','1839432ifgddQ','publicKeyPath','private.pem','generateAESKey','isFinalStatus','toString','üìù\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','from','üîê\x20VISA\x20Public\x20key\x20path:','parse','8344014oKDFUE','signRSA','encryptAES','Sender\x20information\x20required','Payment\x20System/1.0\x20(MasterCard)','sendPaymentNotification','\x20\x20\x20-\x20key\x20length:','stringify','end','üßπ\x20Clearing\x20','üìä\x20Status\x20check\x20#','‚è∞\x20Will\x20check\x20status\x20','forEach','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','substring','/charge','paid','settings','join','defineProperty','floor','paidAt','update','-----END','sendPaymentNotifications','../loggerService','Response\x20Time:','loggerService','visa_private.pem','\x20MasterCard\x20status\x20check\x20timers','3DS\x20verification\x20required','apiUrl','system','üìù\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','üîê\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','Payment\x20pending\x20verification','4000000000000000','sendShopWebhook','configurable','‚úÖ\x20Status\x20response\x20decrypted\x20successfully','),\x20stopping\x20status\x20checks','payment.failed','logWhiteDomainResponse','visaPrivateKeyPath','__createBinding','payment_id','processCardPayment','customerEmail','The\x20card\x20is\x20lost\x20or\x20stolen','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','delete','createCipheriv','card_type','‚ö†Ô∏è\x20Expected\x20VISA\x20public\x20key:\x20','Unknown\x20error','\x20API:\x20','base64','charAt','‚ùå\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','warn','üîç\x20Using\x20fallback\x20fields\x20for\x20search:\x20','resolve','136070oMWPSj','checkPaymentStatus','sign','masterCardMerchantPointId','then','webhook_send','590128dcCDaX','Order\x20ID:','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','),\x20defaulting\x20to\x20MasterCard','\x20\x20\x20-\x20sign\x20length:','gatewayOrderId','charge','üîê\x20MasterCard\x20Private\x20key\x20path:','MASTERCARD','‚úÖ\x20VISA\x20key\x20files\x20validated\x20successfully','payment.success','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','\x20for\x20payment\x20','/status','length','‚ö†Ô∏è\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','üîê\x20MasterCard\x20Private\x20key\x20length:\x20','üì¶\x20FULL\x20RESPONSE\x20BODY:',',\x20paymentId=','keys','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','set','Payment\x20is\x20being\x20processed','merchantPointId','writable','Method\x20not\x20allowed','replace','unknown','‚ö†Ô∏è\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','log','5337VHpOxt','1228TyYqkz',',\x20body:\x20','üí≥\x20VISA/MasterCard\x20service\x20initialized','Failed\x20to\x20send\x20payment\x20notifications:','\x20with\x20status\x20','Status\x20Text:','logShopWebhookSent','../telegramBotService','Status\x20','failed','‚ö†Ô∏è\x20Expected\x20VISA\x20private\x20key:\x20','3DS\x20URL:',',\x20id=','error','webhookEvents','path','Request\x20data\x20error','Failed\x20payment','json','paymentStatuses','‚è∞\x20Scheduling\x20status\x20checks\x20for\x20','üìù\x20Encrypted\x20data\x20length:','masterCardApiUrl','\x20status\x20check\x20error:','toLowerCase','post_code','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','message','LookUp\x20not\x20confirmed','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','\x20\x20\x20','constants','-----BEGIN','üí≥\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','Cash\x20payment\x20is\x20expected\x20at\x20TCO','Status:','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','****',',\x20orderId=','üìù\x20Encrypted\x20key\x20length:','logWhiteDomainRequest','Status\x20decryption\x20failed:\x20',',\x20Desc:\x20','/status_decrypt','4736ZmXfSU','statusCheckTimers','36735IMcmxx','Final:','VisaMasterCardService','https://api.paydmeth.com/api','‚ùå\x20PHP\x20decryptor\x20request\x20failed:','failureMessage','üîê\x20AES\x20key\x20and\x20IV\x20generated','No\x20New\x20payment','LookUp\x20code\x20verified','No\x20Error\x20executing\x20request','PAID','cardType','‚ùå\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','\x20(from:\x20order_id=','getCardTypeAndApi','Awaiting\x20confirmation\x20in\x20the\x20application','__importStar','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','üîç\x20Using\x20provided\x20card\x20type:\x20','includes','üîê\x20VISA\x20API\x20URL:','decryptResponsePhp','HTTP\x20Status:','Expected\x20bitcoin\x20transfer\x20from\x20client','hasOwnProperty','‚úÖ\x20MasterCard\x20key\x20files\x20validated\x20successfully','date_success','Client\x20OTP\x20confirmation\x20required','info','createSign','readFileSync','üîç\x20Using\x20','\x20payment\x20status:\x20','first_name','üí≥\x20Detected\x20MasterCard\x20(starts\x20with\x205)','stopAllStatusChecks','decryptAES','none','\x20failed\x20for\x20payment\x20','Return\x20URL:','size','maskCardNumber','utf8','üíæ\x20Payment\x20data\x20prepared','VISA','__esModule','encryptRSA','\x20(from:\x20status=','üîê\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','decryptResponse','\x22\x20|\x20\x22','number','getDetailedErrorMessage','randomBytes','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','customerName','\x20payment:\x20','/charge_raw','7773KzRWSM','scheduleStatusChecks','visaPublicKeyPath','status','üîê\x20VISA\x20Private\x20key\x20length:\x20','üìù\x20Data\x20length:','Invalid\x20expiration\x20date','postcode','SHA256','prototype','‚ùå\x20Data\x20being\x20signed:','Error\x20details:','\x20\x20\x20-\x20merchant_point_id:',':\x20Unknown\x20status\x20code','üîê\x20MasterCard\x20API\x20URL:','10duEZlD','üîê\x203DS\x20verification\x20required','visaMerchantPointId','\x20status\x20check\x20#','PHP\x20decryptor\x20error','cvv','privateKeyPath','RSA_PKCS1_PADDING','üíæ\x20Saving\x20failure\x20message:\x20','\x20\x20\x20-\x20lang:\x20en','shop','üìù\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','final','Payment\x20prohibited','üîê\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','Failed\x20to\x20decrypt\x20response','üìä\x20Checking\x20','üîê\x20Data\x20signed\x20with\x20RSA','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','statusText','Failed\x20to\x20check\x20','privateDecrypt','/status_raw','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','clearStatusTimers','existsSync','LookUp\x20code\x20sent','publicEncrypt','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','...','üîç\x20Detected\x20card\x20type\x20from\x20webhook:\x20','desc','HTTP\x20error!\x20status:\x20','last_name','‚ùå\x20Status\x20check\x20#','üîê\x20VISA\x20Public\x20key\x20length:\x20','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','Decryption\x20failed:\x20'];a60_0x3f55=function(){return _0x274096;};return a60_0x3f55();}(function(_0x560905,_0x53ba69){const _0x29d381=a60_0xb2ea,_0x2f2ed2=_0x560905();while(!![]){try{const _0x46f825=parseInt(_0x29d381(0x91))/0x1+parseInt(_0x29d381(0x1b4))/0x2+parseInt(_0x29d381(0x119))/0x3*(-parseInt(_0x29d381(0xb0))/0x4)+parseInt(_0x29d381(0xde))/0x5*(parseInt(_0x29d381(0x1a8))/0x6)+-parseInt(_0x29d381(0x1be))/0x7+parseInt(_0x29d381(0xdc))/0x8*(parseInt(_0x29d381(0xaf))/0x9)+parseInt(_0x29d381(0x128))/0xa*(-parseInt(_0x29d381(0x8b))/0xb);if(_0x46f825===_0x53ba69)break;else _0x2f2ed2['push'](_0x2f2ed2['shift']());}catch(_0x4dcfe8){_0x2f2ed2['push'](_0x2f2ed2['shift']());}}}(a60_0x3f55,0xbc817));var __createBinding=this&&this[a60_0x12d171(0x78)]||(Object[a60_0x12d171(0x19f)]?function(_0x159be5,_0xcc9cec,_0x1ad620,_0x1ecde3){const _0x3b2909=a60_0x12d171;if(_0x1ecde3===undefined)_0x1ecde3=_0x1ad620;var _0x414b4c=Object[_0x3b2909(0x192)](_0xcc9cec,_0x1ad620);(!_0x414b4c||('get'in _0x414b4c?!_0xcc9cec[_0x3b2909(0x10b)]:_0x414b4c[_0x3b2909(0xa9)]||_0x414b4c[_0x3b2909(0x72)]))&&(_0x414b4c={'enumerable':!![],'get':function(){return _0xcc9cec[_0x1ad620];}}),Object[_0x3b2909(0x1d1)](_0x159be5,_0x1ecde3,_0x414b4c);}:function(_0x19fd77,_0x578d4d,_0xdecea6,_0x3a34e0){if(_0x3a34e0===undefined)_0x3a34e0=_0xdecea6;_0x19fd77[_0x3a34e0]=_0x578d4d[_0xdecea6];}),__setModuleDefault=this&&this[a60_0x12d171(0x17d)]||(Object[a60_0x12d171(0x19f)]?function(_0x340c64,_0x3ab046){const _0x47700c=a60_0x12d171;Object[_0x47700c(0x1d1)](_0x340c64,_0x47700c(0x16f),{'enumerable':!![],'value':_0x3ab046});}:function(_0xe6f55d,_0x306e46){const _0x15e77a=a60_0x12d171;_0xe6f55d[_0x15e77a(0x16f)]=_0x306e46;}),__importStar=this&&this[a60_0x12d171(0xee)]||(function(){var _0x1c8b9d=function(_0x1cbe18){return _0x1c8b9d=Object['getOwnPropertyNames']||function(_0x18718c){const _0x1c12e0=a60_0xb2ea;var _0x53f19f=[];for(var _0xb307b4 in _0x18718c)if(Object[_0x1c12e0(0x122)][_0x1c12e0(0xf6)]['call'](_0x18718c,_0xb307b4))_0x53f19f[_0x53f19f[_0x1c12e0(0x9f)]]=_0xb307b4;return _0x53f19f;},_0x1c8b9d(_0x1cbe18);};return function(_0x226059){const _0x1c69d6=a60_0xb2ea;if(_0x226059&&_0x226059[_0x1c69d6(0x10b)])return _0x226059;var _0x51db5f={};if(_0x226059!=null){for(var _0x111893=_0x1c8b9d(_0x226059),_0x55c899=0x0;_0x55c899<_0x111893['length'];_0x55c899++)if(_0x111893[_0x55c899]!==_0x1c69d6(0x16f))__createBinding(_0x51db5f,_0x226059,_0x111893[_0x55c899]);}return __setModuleDefault(_0x51db5f,_0x226059),_0x51db5f;};}()),__importDefault=this&&this['__importDefault']||function(_0x358199){const _0x21a790=a60_0x12d171;return _0x358199&&_0x358199[_0x21a790(0x10b)]?_0x358199:{'default':_0x358199};};Object[a60_0x12d171(0x1d1)](exports,a60_0x12d171(0x10b),{'value':!![]}),exports[a60_0x12d171(0xe0)]=void 0x0;function a60_0xb2ea(_0x373b98,_0x671321){_0x373b98=_0x373b98-0x66;const _0x3f55de=a60_0x3f55();let _0xb2ea4c=_0x3f55de[_0x373b98];return _0xb2ea4c;}const crypto_1=__importDefault(require(a60_0x12d171(0x19d))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a60_0x12d171(0xbf))),loggerService_1=require(a60_0x12d171(0x1d7));class VisaMasterCardService{constructor(){const _0xf94087=a60_0x12d171;this[_0xf94087(0xdd)]=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0xf94087(0xe5)},0x1:{'final':![],'description':_0xf94087(0xe7)},0x2:{'final':!![],'description':_0xf94087(0xc0)},0x3:{'final':!![],'description':_0xf94087(0x180)},0x4:{'final':!![],'description':_0xf94087(0x19a)},0x5:{'final':!![],'description':_0xf94087(0x93)},0x6:{'final':!![],'description':_0xf94087(0x19c)},0x7:{'final':!![],'description':_0xf94087(0x153)},0x8:{'final':![],'description':_0xf94087(0xf9)},0x9:{'final':![],'description':_0xf94087(0x6a)},0xa:{'final':![],'description':'Sender\x27s\x20CVV\x20card\x20is\x20required'},0xb:{'final':![],'description':_0xf94087(0x1c1)},0xc:{'final':![],'description':'Recipient\x20data\x20required'},0xd:{'final':![],'description':'Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number'},0xe:{'final':![],'description':'Awaiting\x20confirmation\x20by\x20ivr\x20call'},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':'Captcha\x20confirmation\x20awaited'},0x11:{'final':![],'description':_0xf94087(0x14d)},0x12:{'final':![],'description':_0xf94087(0xed)},0x13:{'final':![],'description':_0xf94087(0xa7)},0x14:{'final':![],'description':_0xf94087(0x13b)},0x15:{'final':![],'description':_0xf94087(0xf5)},0x16:{'final':![],'description':_0xf94087(0x6f)},0x18:{'final':![],'description':'The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'},0x19:{'final':![],'description':_0xf94087(0x1cb)},0x1a:{'final':!![],'description':_0xf94087(0xd2)},0x1b:{'final':![],'description':_0xf94087(0x7d)},0x1c:{'final':![],'description':'Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application'},0x1d:{'final':![],'description':_0xf94087(0xa5)},0x1f:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending'},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':_0xf94087(0x152)},0x24:{'final':!![],'description':'Payment\x20confirmation\x20time\x20has\x20expired'},0x25:{'final':!![],'description':_0xf94087(0x136)},0x26:{'final':!![],'description':_0xf94087(0x114)},0x27:{'final':!![],'description':'Insufficient\x20funds\x20on\x20the\x20card'},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':_0xf94087(0x7c)},0x2a:{'final':!![],'description':_0xf94087(0x11f)},0x2b:{'final':!![],'description':_0xf94087(0x1aa)},0x2c:{'final':!![],'description':_0xf94087(0x87)},0x2d:{'final':!![],'description':_0xf94087(0xc1)},0x2e:{'final':!![],'description':_0xf94087(0x19a)},0x2f:{'final':!![],'description':'Unsuccessful\x20payment'},0x30:{'final':!![],'description':_0xf94087(0x1ae)},0x31:{'final':![],'description':'Payment\x20confirmation\x20required'},0x32:{'final':!![],'description':_0xf94087(0xaa)},0x33:{'final':!![],'description':'Failed\x20payment'},0x34:{'final':!![],'description':'Failed\x20payment'},0x35:{'final':!![],'description':_0xf94087(0xc1)},0x36:{'final':!![],'description':'Failed\x20payment'},0x37:{'final':!![],'description':_0xf94087(0xc1)},0x38:{'final':!![],'description':'Cancellation\x20is\x20not\x20possible'},0x39:{'final':![],'description':_0xf94087(0xd4)},0x3a:{'final':![],'description':_0xf94087(0x143)},0x3b:{'final':!![],'description':_0xf94087(0xe6)},0x3c:{'final':!![],'description':_0xf94087(0x1a0)},0x3d:{'final':!![],'description':'Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible'},0x3e:{'final':!![],'description':_0xf94087(0x115)},0x3f:{'final':!![],'description':_0xf94087(0x19c)},0x40:{'final':![],'description':_0xf94087(0xcc)},0x41:{'final':!![],'description':_0xf94087(0x1a1)},0x42:{'final':![],'description':_0xf94087(0x17c)},0x43:{'final':!![],'description':_0xf94087(0xca)},0x44:{'final':![],'description':'3DS\x20verification\x20required'},0x45:{'final':!![],'description':'Failed\x20payment'},0x46:{'final':!![],'description':_0xf94087(0xc1)},0x47:{'final':!![],'description':_0xf94087(0xcd)},0x64:{'final':!![],'description':_0xf94087(0x177)}},this[_0xf94087(0xc6)]=_0xf94087(0x198),this['masterCardMerchantPointId']=0x50ca,this[_0xf94087(0x12e)]=path_1['default'][_0xf94087(0x1d0)](process[_0xf94087(0x179)](),_0xf94087(0xa4),_0xf94087(0x1b6)),this[_0xf94087(0x1b5)]=path_1['default']['join'](process['cwd'](),_0xf94087(0xa4),'psp_public.pem'),this[_0xf94087(0x164)]=_0xf94087(0xe1),this[_0xf94087(0x12a)]=0x6b7,this[_0xf94087(0x77)]=path_1[_0xf94087(0x16f)][_0xf94087(0x1d0)](process[_0xf94087(0x179)](),_0xf94087(0xa4),_0xf94087(0x68)),this[_0xf94087(0x11b)]=path_1[_0xf94087(0x16f)]['join'](process[_0xf94087(0x179)](),_0xf94087(0xa4),'visa_public.pem'),console[_0xf94087(0xae)](_0xf94087(0xb2)),console['log'](_0xf94087(0x127),this[_0xf94087(0xc6)]),console[_0xf94087(0xae)](_0xf94087(0xf2),this['visaApiUrl']),console[_0xf94087(0xae)](_0xf94087(0x98),this[_0xf94087(0x12e)]),console['log']('üîê\x20MasterCard\x20Public\x20key\x20path:',this[_0xf94087(0x1b5)]),console['log']('üîê\x20VISA\x20Private\x20key\x20path:',this[_0xf94087(0x77)]),console[_0xf94087(0xae)](_0xf94087(0x1bc),this['visaPublicKeyPath']),this['validateKeyFiles']();}[a60_0x12d171(0x112)](_0x4def78,_0x33d632){const _0x4c4629=a60_0x12d171,_0x5be547=this[_0x4c4629(0xc3)][_0x4def78];let _0x4e63ee='';_0x5be547?_0x4e63ee=_0x4c4629(0xb8)+_0x4def78+':\x20'+_0x5be547[_0x4c4629(0x16e)]:_0x4e63ee=_0x4c4629(0xb8)+_0x4def78+_0x4c4629(0x126);if(_0x33d632&&_0x33d632[_0x4c4629(0x196)]()){const _0x23612e=_0x33d632[_0x4c4629(0x196)]();(!_0x5be547||_0x23612e[_0x4c4629(0xc8)]()!==_0x5be547['description'][_0x4c4629(0xc8)]())&&(_0x4e63ee+='\x20|\x20Response:\x20'+_0x23612e);}return _0x4e63ee;}[a60_0x12d171(0x1b8)](_0x38bc5e){const _0x57c983=a60_0x12d171,_0x291a7f=this[_0x57c983(0xc3)][_0x38bc5e];return _0x291a7f?_0x291a7f[_0x57c983(0x135)]:!![];}[a60_0x12d171(0xec)](_0x523c4b){const _0x42adea=a60_0x12d171,_0x4b5d07=_0x523c4b[_0x42adea(0x85)](0x0);if(_0x4b5d07==='4')return console['log'](_0x42adea(0xd1)),{'cardType':'VISA','apiUrl':this[_0x42adea(0x164)],'privateKeyPath':this[_0x42adea(0x77)],'publicKeyPath':this[_0x42adea(0x11b)],'merchantPointId':this[_0x42adea(0x12a)]};else return _0x4b5d07==='5'?(console[_0x42adea(0xae)](_0x42adea(0x100)),{'cardType':'MASTERCARD','apiUrl':this['masterCardApiUrl'],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x42adea(0x1b5)],'merchantPointId':this[_0x42adea(0x8e)]}):(console['log']('üí≥\x20Unknown\x20card\x20type\x20(starts\x20with\x20'+_0x4b5d07+_0x42adea(0x94)),{'cardType':_0x42adea(0x99),'apiUrl':this[_0x42adea(0xc6)],'privateKeyPath':this[_0x42adea(0x12e)],'publicKeyPath':this[_0x42adea(0x1b5)],'merchantPointId':this[_0x42adea(0x8e)]});}['validateKeyFiles'](){const _0x4a0fe1=a60_0x12d171;try{if(!fs_1[_0x4a0fe1(0x16f)][_0x4a0fe1(0x142)](this[_0x4a0fe1(0x12e)]))throw new Error(_0x4a0fe1(0x163)+this[_0x4a0fe1(0x12e)]);if(!fs_1[_0x4a0fe1(0x16f)]['existsSync'](this[_0x4a0fe1(0x1b5)]))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this[_0x4a0fe1(0x1b5)]);const _0x32cde5=fs_1['default']['readFileSync'](this[_0x4a0fe1(0x12e)],_0x4a0fe1(0x108))[_0x4a0fe1(0x196)](),_0x1d76fe=fs_1[_0x4a0fe1(0x16f)][_0x4a0fe1(0xfc)](this['publicKeyPath'],'utf8')[_0x4a0fe1(0x196)]();if(!_0x32cde5[_0x4a0fe1(0xf1)]('-----BEGIN')||!_0x32cde5[_0x4a0fe1(0xf1)](_0x4a0fe1(0x1d5)))throw new Error(_0x4a0fe1(0x134));if(!_0x1d76fe[_0x4a0fe1(0xf1)]('-----BEGIN')||!_0x1d76fe[_0x4a0fe1(0xf1)](_0x4a0fe1(0x1d5)))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console['log'](_0x4a0fe1(0xf7)),console[_0x4a0fe1(0xae)](_0x4a0fe1(0xa1)+_0x32cde5[_0x4a0fe1(0x9f)]+_0x4a0fe1(0x197)),console['log'](_0x4a0fe1(0x14f)+_0x1d76fe[_0x4a0fe1(0x9f)]+_0x4a0fe1(0x197));if(fs_1['default'][_0x4a0fe1(0x142)](this['visaPrivateKeyPath'])&&fs_1[_0x4a0fe1(0x16f)][_0x4a0fe1(0x142)](this[_0x4a0fe1(0x11b)])){const _0x2d42d5=fs_1[_0x4a0fe1(0x16f)][_0x4a0fe1(0xfc)](this[_0x4a0fe1(0x77)],_0x4a0fe1(0x108))[_0x4a0fe1(0x196)](),_0x290baf=fs_1[_0x4a0fe1(0x16f)][_0x4a0fe1(0xfc)](this['visaPublicKeyPath'],_0x4a0fe1(0x108))['trim']();(!_0x2d42d5[_0x4a0fe1(0xf1)](_0x4a0fe1(0xd0))||!_0x2d42d5[_0x4a0fe1(0xf1)](_0x4a0fe1(0x1d5)))&&console[_0x4a0fe1(0x88)](_0x4a0fe1(0x151)),(!_0x290baf[_0x4a0fe1(0xf1)]('-----BEGIN')||!_0x290baf['includes']('-----END'))&&console[_0x4a0fe1(0x88)](_0x4a0fe1(0xad)),console[_0x4a0fe1(0xae)](_0x4a0fe1(0x9a)),console[_0x4a0fe1(0xae)](_0x4a0fe1(0x11d)+_0x2d42d5[_0x4a0fe1(0x9f)]+_0x4a0fe1(0x197)),console[_0x4a0fe1(0xae)](_0x4a0fe1(0x14c)+_0x290baf['length']+_0x4a0fe1(0x197));}else console['warn'](_0x4a0fe1(0x1a9)),console[_0x4a0fe1(0x88)](_0x4a0fe1(0xba)+this[_0x4a0fe1(0x77)]),console[_0x4a0fe1(0x88)](_0x4a0fe1(0x81)+this['visaPublicKeyPath']);}catch(_0x4dd8e7){console['error'](_0x4a0fe1(0x1a2),_0x4dd8e7);throw _0x4dd8e7;}}[a60_0x12d171(0x1b7)](){const _0x21b60a=a60_0x12d171,_0x252a85=crypto_1[_0x21b60a(0x16f)][_0x21b60a(0x113)](0x20),_0x10c5af=crypto_1[_0x21b60a(0x16f)][_0x21b60a(0x113)](0x10);return{'key':_0x252a85,'iv':_0x10c5af};}[a60_0x12d171(0x1c0)](_0x4c951c,_0x492be2,_0xf396eb){const _0xa842bb=a60_0x12d171,_0xfb6761=crypto_1[_0xa842bb(0x16f)][_0xa842bb(0x7f)]('aes-256-ctr',_0x492be2,_0xf396eb);let _0x48b51b=_0xfb6761[_0xa842bb(0x1d4)](_0x4c951c,'utf8',_0xa842bb(0x84));return _0x48b51b+=_0xfb6761[_0xa842bb(0x135)]('base64'),_0x48b51b;}['encryptRSA'](_0x415428,_0x22561a,_0x57d994){const _0x3be970=a60_0x12d171;try{const _0x16d97e=fs_1[_0x3be970(0x16f)][_0x3be970(0xfc)](_0x57d994,_0x3be970(0x108))[_0x3be970(0x196)](),_0xe6d5ea={'iv':_0x22561a[_0x3be970(0x1b9)]('base64'),'key':_0x415428[_0x3be970(0x1b9)](_0x3be970(0x84))},_0x43be46=JSON[_0x3be970(0x1c5)](_0xe6d5ea);console['log'](_0x3be970(0x6e),_0x43be46[_0x3be970(0x9f)]);const _0x2e8468=crypto_1[_0x3be970(0x16f)][_0x3be970(0x144)]({'key':_0x16d97e,'padding':crypto_1[_0x3be970(0x16f)][_0x3be970(0xcf)][_0x3be970(0x12f)]},Buffer[_0x3be970(0x1bb)](_0x43be46));return console[_0x3be970(0xae)]('‚úÖ\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x2e8468[_0x3be970(0x9f)]),_0x2e8468['toString'](_0x3be970(0x84));}catch(_0x3cb6f7){console[_0x3be970(0xbd)]('‚ùå\x20RSA\x20encryption\x20failed:',_0x3cb6f7);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a60_0x12d171(0x1bf)](_0x205d17,_0x4463ab){const _0x3d670b=a60_0x12d171;try{const _0x1ab346=fs_1[_0x3d670b(0x16f)][_0x3d670b(0xfc)](_0x4463ab,'utf8')['trim'](),_0x5cdb32=crypto_1[_0x3d670b(0x16f)][_0x3d670b(0xfb)](_0x3d670b(0x121));_0x5cdb32[_0x3d670b(0x1d4)](_0x205d17),_0x5cdb32[_0x3d670b(0x1c6)]();const _0x242142=_0x5cdb32[_0x3d670b(0x8d)](_0x1ab346,'base64');return console[_0x3d670b(0xae)]('üîê\x20RSA\x20signing\x20successful'),console[_0x3d670b(0xae)]('üìù\x20Data\x20to\x20sign\x20length:',_0x205d17[_0x3d670b(0x9f)]),console[_0x3d670b(0xae)](_0x3d670b(0x16a),_0x242142[_0x3d670b(0x9f)]),_0x242142;}catch(_0xb6605a){console['error'](_0x3d670b(0x15f),_0xb6605a),console[_0x3d670b(0xbd)](_0x3d670b(0x123),_0x205d17[_0x3d670b(0x1cc)](0x0,0xc8)+_0x3d670b(0x146));throw new Error(_0x3d670b(0x9c));}}[a60_0x12d171(0x102)](_0x2baecd,_0x5a646e,_0x2d0db2){const _0x2e265e=a60_0x12d171,_0x1b222f=crypto_1[_0x2e265e(0x16f)]['createDecipheriv'](_0x2e265e(0x17f),_0x5a646e,_0x2d0db2);let _0x1626ce=_0x1b222f[_0x2e265e(0x1d4)](_0x2baecd,_0x2e265e(0x84),_0x2e265e(0x108));return _0x1626ce+=_0x1b222f[_0x2e265e(0x135)](_0x2e265e(0x108)),_0x1626ce;}async[a60_0x12d171(0xf3)](_0x55f142,_0x3c6431,_0x789ae5='MASTERCARD'){const _0x870523=a60_0x12d171;try{const _0x5676e3=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x870523(0x184),'headers':{'Content-Type':_0x870523(0x17a)},'body':JSON['stringify']({'info':_0x55f142,'key':_0x3c6431,'card_type':_0x789ae5[_0x870523(0xc8)]()})});if(!_0x5676e3['ok'])throw new Error(_0x870523(0x12c));return await _0x5676e3['text']();}catch(_0xb135c){console[_0x870523(0xbd)](_0x870523(0xe2),_0xb135c);throw new Error(_0x870523(0x140));}}[a60_0x12d171(0x10f)](_0x1f111d,_0x1f26ae){const _0x2e3691=a60_0x12d171;try{const _0x416a53=fs_1['default'][_0x2e3691(0xfc)](this['privateKeyPath'],'utf8')['trim'](),_0x539e1e=crypto_1['default'][_0x2e3691(0x13e)](_0x416a53,Buffer[_0x2e3691(0x1bb)](_0x1f26ae,_0x2e3691(0x84))),_0x3bc09d=JSON[_0x2e3691(0x1bd)](_0x539e1e['toString']()),_0x207637=Buffer[_0x2e3691(0x1bb)](_0x3bc09d[_0x2e3691(0x175)],_0x2e3691(0x84)),_0x1c4353=Buffer[_0x2e3691(0x1bb)](_0x3bc09d['iv'],_0x2e3691(0x84));return this[_0x2e3691(0x102)](_0x1f111d,_0x207637,_0x1c4353);}catch(_0xcf5fd3){throw new Error(_0x2e3691(0x138));}}async[a60_0x12d171(0x7a)](_0x42f495){const _0x3572bd=a60_0x12d171,{paymentId:_0x1fa658,orderId:_0xd1d59f,amount:_0x736d68,currency:_0x5b088f,cardData:_0x1fd77d,resultUrl:_0x54a8df,returnUrl:_0x3f0fee,cardHolder:_0x5ee8a2,browser:_0x1700ab}=_0x42f495;console['log'](_0x3572bd(0x19b)),console['log'](_0x3572bd(0x156),_0x1fa658),console[_0x3572bd(0xae)](_0x3572bd(0x92),_0xd1d59f),console['log'](_0x3572bd(0x1ac),_0x736d68,_0x5b088f),console[_0x3572bd(0xae)]('Card\x20Number:',this['maskCardNumber'](_0x1fd77d[_0x3572bd(0x111)])),console['log'](_0x3572bd(0x172),_0x5ee8a2[_0x3572bd(0xff)]+'\x20'+_0x5ee8a2[_0x3572bd(0x14a)]),console[_0x3572bd(0xae)](_0x3572bd(0x105),_0x3f0fee),console['log']('Result\x20URL:',_0x54a8df);const _0x417d09=this['getCardTypeAndApi'](_0x1fd77d['number']);console['log'](_0x3572bd(0x150)+_0x417d09[_0x3572bd(0xe9)]+_0x3572bd(0x83)+_0x417d09[_0x3572bd(0x6b)]),console[_0x3572bd(0xae)](_0x3572bd(0x199)+_0x417d09[_0x3572bd(0x12e)]+',\x20'+_0x417d09[_0x3572bd(0x1b5)]);const _0x2d2fc5={..._0x5ee8a2,'first_name':_0x5ee8a2[_0x3572bd(0xff)]?.[_0x3572bd(0xab)](/[\t\n\r\f\v]/g,'\x20')['trim']()||'','last_name':_0x5ee8a2[_0x3572bd(0x14a)]?.[_0x3572bd(0xab)](/[\t\n\r\f\v]/g,'\x20')[_0x3572bd(0x196)]()||''};'postcode'in _0x2d2fc5&&!(_0x3572bd(0xc9)in _0x2d2fc5)&&(_0x2d2fc5[_0x3572bd(0xc9)]=_0x2d2fc5[_0x3572bd(0x120)],delete _0x2d2fc5[_0x3572bd(0x120)],console['log'](_0x3572bd(0x16b)+_0x2d2fc5[_0x3572bd(0xc9)]));console['log']('üßπ\x20Card\x20holder\x20names\x20cleaned:'),console[_0x3572bd(0xae)]('\x20\x20Original:\x20\x22'+_0x5ee8a2[_0x3572bd(0xff)]+_0x3572bd(0x110)+_0x5ee8a2['last_name']+'\x22'),console['log']('\x20\x20Cleaned:\x20\x20\x22'+_0x2d2fc5[_0x3572bd(0xff)]+_0x3572bd(0x110)+_0x2d2fc5[_0x3572bd(0x14a)]+'\x22'),console[_0x3572bd(0xae)](_0x3572bd(0x169),JSON[_0x3572bd(0x1c5)](_0x2d2fc5,null,0x2));const _0x2494c7={'amount':_0x736d68,'currency':_0x5b088f[_0x3572bd(0x15c)](),'order_id':_0xd1d59f,'result_url':_0x54a8df,'return_url':_0x3f0fee,'country':'','card':{'number':_0x1fd77d[_0x3572bd(0x111)],'expire_month':_0x1fd77d[_0x3572bd(0x17b)],'expire_year':_0x1fd77d[_0x3572bd(0x18d)],'cvv':_0x1fd77d[_0x3572bd(0x12d)]},'card_holder':_0x2d2fc5,'browser':_0x1700ab},_0x32c64b=JSON[_0x3572bd(0x1c5)](_0x2494c7);console['log'](_0x3572bd(0x109)),console[_0x3572bd(0xae)]('üìù\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console['log'](_0x32c64b),console[_0x3572bd(0xae)](_0x3572bd(0x11e),_0x32c64b[_0x3572bd(0x9f)]);try{const {key:_0x4c3be8,iv:_0x2ab2be}=this['generateAESKey']();console[_0x3572bd(0xae)](_0x3572bd(0xe4)),console[_0x3572bd(0xae)](_0x3572bd(0x194),_0x4c3be8[_0x3572bd(0x9f)]),console[_0x3572bd(0xae)](_0x3572bd(0x1af),_0x2ab2be['length']);const _0x2085c7=this[_0x3572bd(0x1c0)](_0x32c64b,_0x4c3be8,_0x2ab2be);console[_0x3572bd(0xae)]('üîê\x20Data\x20encrypted\x20with\x20AES'),console[_0x3572bd(0xae)](_0x3572bd(0xc5),_0x2085c7[_0x3572bd(0x9f)]);const _0x1e42a0=this['encryptRSA'](_0x4c3be8,_0x2ab2be,_0x417d09[_0x3572bd(0x1b5)]);console[_0x3572bd(0xae)](_0x3572bd(0x137)),console[_0x3572bd(0xae)](_0x3572bd(0xd7),_0x1e42a0[_0x3572bd(0x9f)]);const _0x8308f8=this[_0x3572bd(0x1bf)](_0x32c64b,_0x417d09[_0x3572bd(0x12e)]);console[_0x3572bd(0xae)](_0x3572bd(0x13a)),console[_0x3572bd(0xae)](_0x3572bd(0x16a),_0x8308f8[_0x3572bd(0x9f)]);const _0x122b88={'merchant_point_id':_0x417d09['merchantPointId'],'method':_0x3572bd(0x97),'info':_0x2085c7,'key':_0x1e42a0,'sign':_0x8308f8,'lang':'en'};console['log']('üì§\x20Sending\x20request\x20to\x20API...'),console[_0x3572bd(0xae)](_0x3572bd(0x159)),console[_0x3572bd(0xae)](_0x3572bd(0x125),_0x417d09['merchantPointId']),console['log'](_0x3572bd(0x1b2)),console[_0x3572bd(0xae)]('\x20\x20\x20-\x20info\x20length:',_0x2085c7[_0x3572bd(0x9f)]),console[_0x3572bd(0xae)](_0x3572bd(0x1c4),_0x1e42a0[_0x3572bd(0x9f)]),console[_0x3572bd(0xae)](_0x3572bd(0x95),_0x8308f8[_0x3572bd(0x9f)]),console[_0x3572bd(0xae)](_0x3572bd(0x131)),console['log'](''),console[_0x3572bd(0xae)](_0x3572bd(0x186)),console[_0x3572bd(0xae)](JSON[_0x3572bd(0x1c5)](_0x122b88,null,0x2)),console[_0x3572bd(0xae)](''),loggerService_1[_0x3572bd(0x67)][_0x3572bd(0xd8)](_0x417d09[_0x3572bd(0xe9)][_0x3572bd(0xc8)](),_0x3572bd(0x1cd),'POST',{'merchant_point_id':_0x417d09[_0x3572bd(0xa8)],'method':_0x3572bd(0x97),'lang':'en'});const _0x46515c=Date[_0x3572bd(0x16c)](),_0x2731e9=await fetch(_0x417d09[_0x3572bd(0x6b)],{'method':_0x3572bd(0x184),'headers':{'Content-Type':'application/json','Accept':_0x3572bd(0x17a),'User-Agent':_0x3572bd(0x171)},'body':JSON['stringify'](_0x122b88)}),_0x178b19=Date['now']()-_0x46515c;console['log'](_0x3572bd(0x16d)),console['log'](_0x3572bd(0xd3),_0x2731e9[_0x3572bd(0x11c)]),console[_0x3572bd(0xae)](_0x3572bd(0xb5),_0x2731e9[_0x3572bd(0x13c)]),console[_0x3572bd(0xae)](_0x3572bd(0x66),_0x178b19+'ms'),console[_0x3572bd(0xae)](_0x3572bd(0x1a6)),_0x2731e9[_0x3572bd(0x162)][_0x3572bd(0x1ca)]((_0xc461f1,_0x329356)=>{const _0x22db83=_0x3572bd;console['log'](_0x22db83(0xce)+_0x329356+':\x20'+_0xc461f1);}),console[_0x3572bd(0xae)]('');if(!_0x2731e9['ok']){const _0x37bbf8=await _0x2731e9['text']();console[_0x3572bd(0xbd)](_0x3572bd(0xf4),_0x2731e9[_0x3572bd(0x11c)]),console[_0x3572bd(0xbd)](_0x3572bd(0xa2)),console[_0x3572bd(0xbd)](_0x37bbf8),console['error'](''),loggerService_1['loggerService'][_0x3572bd(0x76)](_0x417d09[_0x3572bd(0xe9)][_0x3572bd(0xc8)](),'/charge_raw',_0x2731e9[_0x3572bd(0x11c)],_0x37bbf8,_0x178b19),loggerService_1[_0x3572bd(0x67)]['logWhiteDomainError'](_0x417d09[_0x3572bd(0xe9)][_0x3572bd(0xc8)](),_0x3572bd(0x1cd),_0x3572bd(0x18e)+_0x2731e9[_0x3572bd(0x11c)]+':\x20'+_0x37bbf8);throw new Error(_0x3572bd(0x149)+_0x2731e9[_0x3572bd(0x11c)]+_0x3572bd(0xb1)+_0x37bbf8);}const _0x564c52=await _0x2731e9['json']();console[_0x3572bd(0xae)]('üì¶\x20FULL\x20RESPONSE\x20JSON:'),console['log'](JSON[_0x3572bd(0x1c5)](_0x564c52,null,0x2)),console[_0x3572bd(0xae)](''),loggerService_1['loggerService'][_0x3572bd(0x76)](_0x417d09[_0x3572bd(0xe9)]['toLowerCase'](),_0x3572bd(0x118),_0x2731e9['status'],_0x564c52,_0x178b19),console['log'](_0x3572bd(0x183));let _0x1912f8=_0x564c52;if(_0x564c52[_0x3572bd(0xfa)]&&_0x564c52[_0x3572bd(0x175)]&&_0x564c52[_0x3572bd(0x8d)]){console[_0x3572bd(0xae)]('üîê\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0xfb3542=await this[_0x3572bd(0xf3)](_0x564c52[_0x3572bd(0xfa)],_0x564c52[_0x3572bd(0x175)],_0x417d09[_0x3572bd(0xe9)]);_0x1912f8=JSON[_0x3572bd(0x1bd)](_0xfb3542),console[_0x3572bd(0xae)](_0x3572bd(0x19e)),loggerService_1[_0x3572bd(0x67)]['logWhiteDomainResponse'](_0x417d09[_0x3572bd(0xe9)]['toLowerCase'](),_0x3572bd(0x155),_0x2731e9[_0x3572bd(0x11c)],_0x1912f8,_0x178b19),console[_0x3572bd(0xae)](_0x3572bd(0x133));}catch(_0x29a61f){console[_0x3572bd(0xbd)](_0x3572bd(0x187),_0x29a61f),loggerService_1[_0x3572bd(0x67)][_0x3572bd(0x167)](_0x417d09[_0x3572bd(0xe9)][_0x3572bd(0xc8)](),_0x3572bd(0x178),_0x3572bd(0x14e)+_0x29a61f),_0x1912f8=_0x564c52;}}else loggerService_1[_0x3572bd(0x67)][_0x3572bd(0x76)](_0x417d09[_0x3572bd(0xe9)][_0x3572bd(0xc8)](),_0x3572bd(0x155),_0x2731e9[_0x3572bd(0x11c)],_0x1912f8,_0x178b19),console[_0x3572bd(0xae)](_0x3572bd(0x1a3));console[_0x3572bd(0xae)](_0x3572bd(0xd3),_0x1912f8[_0x3572bd(0x11c)]),console[_0x3572bd(0xae)](_0x3572bd(0xdf),_0x1912f8[_0x3572bd(0x135)]),console[_0x3572bd(0xae)]('Payment\x20ID:',_0x1912f8[_0x3572bd(0x79)]),console[_0x3572bd(0xae)](_0x3572bd(0xbb),_0x1912f8[_0x3572bd(0x1a7)]||_0x3572bd(0x103));if(_0x1912f8['status']===0x64&&_0x1912f8[_0x3572bd(0x135)]===0x1)return console[_0x3572bd(0xae)]('‚úÖ\x20Payment\x20successful'),{'gateway_payment_id':_0x1912f8[_0x3572bd(0x79)]?.[_0x3572bd(0x1b9)](),'payment_url':_0x3f0fee,'requires_3ds':![],'status':_0x3572bd(0xe8),'final':!![]};if(_0x1912f8['3ds_url'])return console[_0x3572bd(0xae)](_0x3572bd(0x129)),this[_0x3572bd(0x11a)](_0x1fa658,_0xd1d59f,_0x1912f8[_0x3572bd(0x79)]?.[_0x3572bd(0x1b9)]()||_0xd1d59f,_0x417d09['cardType']),{'gateway_payment_id':_0x1912f8[_0x3572bd(0x79)]?.[_0x3572bd(0x1b9)](),'payment_url':_0x1912f8[_0x3572bd(0x1a7)],'requires_3ds':!![],'threeds_url':_0x1912f8['3ds_url'],'status':_0x3572bd(0x1b0),'final':![]};let _0x55a452=this[_0x3572bd(0x112)](_0x1912f8['status'],_0x1912f8[_0x3572bd(0x148)]||_0x1912f8[_0x3572bd(0xcb)]),_0x261059=_0x1912f8[_0x3572bd(0x11c)],_0x26144a=this['isFinalStatus'](_0x1912f8[_0x3572bd(0x11c)]);return console[_0x3572bd(0xae)](_0x3572bd(0x15a)+_0x261059+',\x20Final:\x20'+_0x26144a+_0x3572bd(0xda)+_0x55a452),{'gateway_payment_id':_0x1912f8[_0x3572bd(0x79)]?.[_0x3572bd(0x1b9)](),'payment_url':_0x3f0fee,'requires_3ds':![],'status':_0x3572bd(0x17e),'final':!![],'errorMessage':_0x55a452};}catch(_0x1a149e){console[_0x3572bd(0xbd)](_0x3572bd(0xef)),console['error'](_0x3572bd(0x124),_0x1a149e),loggerService_1[_0x3572bd(0x67)][_0x3572bd(0x167)](_0x3572bd(0x154),_0x3572bd(0x1cd),_0x1a149e);throw new Error(_0x3572bd(0x1b3)+(_0x1a149e instanceof Error?_0x1a149e['message']:_0x3572bd(0x82)));}}async[a60_0x12d171(0x8c)](_0xc6e524,_0x60e458,_0x25a17b=a60_0x12d171(0x10a)){const _0x3ec46c=a60_0x12d171;console[_0x3ec46c(0xae)](_0x3ec46c(0x139)+_0x25a17b+_0x3ec46c(0xfe)+_0xc6e524+'\x20('+_0x60e458+')');try{const _0x49770c={'payment_id':_0xc6e524,'order_id':_0x60e458},_0x3d9b69=JSON['stringify'](_0x49770c),_0xb258ce=this['getCardTypeAndApi'](_0x25a17b==='VISA'?_0x3ec46c(0x70):'5000000000000000'),{key:_0x31f873,iv:_0xce1567}=this[_0x3ec46c(0x1b7)](),_0x55d344=this['encryptAES'](_0x3d9b69,_0x31f873,_0xce1567),_0x33d1d5=this[_0x3ec46c(0x10c)](_0x31f873,_0xce1567,_0xb258ce['publicKeyPath']),_0x4b67fc=this['signRSA'](_0x3d9b69,_0xb258ce[_0x3ec46c(0x12e)]),_0x17e4ee={'merchant_point_id':_0xb258ce[_0x3ec46c(0xa8)],'method':_0x3ec46c(0x11c),'info':_0x55d344,'key':_0x33d1d5,'sign':_0x4b67fc,'lang':'en'};loggerService_1['loggerService'][_0x3ec46c(0xd8)](_0x25a17b[_0x3ec46c(0xc8)](),'/status',_0x3ec46c(0x184),{'merchant_point_id':_0xb258ce[_0x3ec46c(0xa8)],'method':_0x3ec46c(0x11c),'lang':'en'});const _0x491eea=Date[_0x3ec46c(0x16c)](),_0x56bd24=await fetch(_0xb258ce['apiUrl'],{'method':_0x3ec46c(0x184),'headers':{'Content-Type':_0x3ec46c(0x17a),'Accept':_0x3ec46c(0x17a),'User-Agent':_0x3ec46c(0x171)},'body':JSON[_0x3ec46c(0x1c5)](_0x17e4ee)}),_0x510432=Date[_0x3ec46c(0x16c)]()-_0x491eea;if(!_0x56bd24['ok']){const _0x25414b=await _0x56bd24[_0x3ec46c(0x157)]();loggerService_1[_0x3ec46c(0x67)]['logWhiteDomainResponse'](_0x25a17b[_0x3ec46c(0xc8)](),_0x3ec46c(0x13f),_0x56bd24[_0x3ec46c(0x11c)],_0x25414b,_0x510432);throw new Error(_0x3ec46c(0x149)+_0x56bd24[_0x3ec46c(0x11c)]);}const _0x1d99a1=await _0x56bd24[_0x3ec46c(0xc2)]();loggerService_1[_0x3ec46c(0x67)][_0x3ec46c(0x76)](_0x25a17b[_0x3ec46c(0xc8)](),_0x3ec46c(0x13f),_0x56bd24[_0x3ec46c(0x11c)],_0x1d99a1,_0x510432);let _0xbab2b2=_0x1d99a1;if(_0x1d99a1[_0x3ec46c(0xfa)]&&_0x1d99a1[_0x3ec46c(0x175)]&&_0x1d99a1[_0x3ec46c(0x8d)]){console[_0x3ec46c(0xae)](_0x3ec46c(0x10e));try{const _0x3e815f=await this[_0x3ec46c(0xf3)](_0x1d99a1[_0x3ec46c(0xfa)],_0x1d99a1[_0x3ec46c(0x175)],_0x25a17b);_0xbab2b2=JSON[_0x3ec46c(0x1bd)](_0x3e815f),console[_0x3ec46c(0xae)](_0x3ec46c(0x73)),loggerService_1[_0x3ec46c(0x67)][_0x3ec46c(0x76)](_0x25a17b[_0x3ec46c(0xc8)](),_0x3ec46c(0x1a4),_0x56bd24[_0x3ec46c(0x11c)],_0xbab2b2,_0x510432),console[_0x3ec46c(0xae)]('üìù\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x1ab44c){console[_0x3ec46c(0xbd)](_0x3ec46c(0x170),_0x1ab44c),loggerService_1[_0x3ec46c(0x67)][_0x3ec46c(0x167)](_0x25a17b[_0x3ec46c(0xc8)](),_0x3ec46c(0xdb),_0x3ec46c(0xd9)+_0x1ab44c),_0xbab2b2=_0x1d99a1;}}else loggerService_1['loggerService'][_0x3ec46c(0x76)](_0x25a17b[_0x3ec46c(0xc8)](),_0x3ec46c(0x1a4),_0x56bd24[_0x3ec46c(0x11c)],_0xbab2b2,_0x510432),console[_0x3ec46c(0xae)](_0x3ec46c(0x6d));console[_0x3ec46c(0xae)]('üìä\x20Status\x20check\x20result:',{'status':_0xbab2b2[_0x3ec46c(0x11c)],'final':_0xbab2b2[_0x3ec46c(0x135)],'payment_id':_0xbab2b2[_0x3ec46c(0x79)],'desc':_0xbab2b2[_0x3ec46c(0x148)]});let _0x4b634d=_0x3ec46c(0x1b0);if(_0xbab2b2[_0x3ec46c(0x11c)]===0x64&&_0xbab2b2[_0x3ec46c(0x135)]===0x1)_0x4b634d=_0x3ec46c(0xe8);else{if(_0xbab2b2[_0x3ec46c(0x135)]===0x0||!this['isFinalStatus'](_0xbab2b2[_0x3ec46c(0x11c)]))_0x4b634d=_0x3ec46c(0x1b0);else _0xbab2b2[_0x3ec46c(0x135)]===0x1||this[_0x3ec46c(0x1b8)](_0xbab2b2[_0x3ec46c(0x11c)])?_0x4b634d=_0x3ec46c(0x17e):_0x4b634d=_0x3ec46c(0x1b0);}const _0x4329af=this[_0x3ec46c(0x112)](_0xbab2b2[_0x3ec46c(0x11c)],_0xbab2b2['desc']);return{'status':_0x4b634d,'final':this[_0x3ec46c(0x1b8)](_0xbab2b2[_0x3ec46c(0x11c)]),'amount':_0xbab2b2[_0x3ec46c(0x168)],'currency':_0xbab2b2[_0x3ec46c(0x18f)],'date_success':_0xbab2b2[_0x3ec46c(0xf8)],'description':_0x4329af};}catch(_0xfe5713){console['error'](_0x25a17b+_0x3ec46c(0xc7),_0xfe5713),loggerService_1['loggerService']['logWhiteDomainError'](_0x25a17b[_0x3ec46c(0xc8)](),_0x3ec46c(0x9e),_0xfe5713);throw new Error(_0x3ec46c(0x13d)+_0x25a17b+_0x3ec46c(0xfe)+(_0xfe5713 instanceof Error?_0xfe5713['message']:_0x3ec46c(0x82)));}}[a60_0x12d171(0x11a)](_0x9ce040,_0x56cfbb,_0x404633,_0x1c4806){const _0x1ae9ba=a60_0x12d171;console[_0x1ae9ba(0xae)](_0x1ae9ba(0xc4)+_0x1c4806+_0x1ae9ba(0x117)+_0x9ce040+'\x20('+_0x404633+')'),this[_0x1ae9ba(0x141)](_0x9ce040);const _0x482ee4=[],_0x27bda6=0x5*0x3c*0x3e8,_0x203106=0x2*0x3c*0x3c*0x3e8,_0x58e245=Math[_0x1ae9ba(0x1d2)](_0x203106/_0x27bda6);console['log'](_0x1ae9ba(0x1c9)+_0x58e245+_0x1ae9ba(0x190));for(let _0x440e57=0x1;_0x440e57<=_0x58e245;_0x440e57++){const _0x56c850=setTimeout(async()=>{const _0x2cbe18=_0x1ae9ba;console['log']('üîç\x20'+_0x1c4806+_0x2cbe18(0x12b)+_0x440e57+'/'+_0x58e245+_0x2cbe18(0x9d)+_0x9ce040);try{const _0x232d90=await this[_0x2cbe18(0x8c)](_0x404633,_0x56cfbb,_0x1c4806);console[_0x2cbe18(0xae)](_0x2cbe18(0x1c8)+_0x440e57+'\x20result:',_0x232d90),_0x232d90[_0x2cbe18(0x135)]&&(console[_0x2cbe18(0xae)](_0x2cbe18(0x15b)+_0x9ce040+'\x20is\x20final\x20('+_0x232d90[_0x2cbe18(0x11c)]+_0x2cbe18(0x74)),this['clearStatusTimers'](_0x9ce040),await this[_0x2cbe18(0x1a5)](_0x9ce040,_0x232d90[_0x2cbe18(0x11c)],_0x232d90));}catch(_0x13bf91){console['error'](_0x2cbe18(0x14b)+_0x440e57+_0x2cbe18(0x104)+_0x9ce040+':',_0x13bf91);}},_0x440e57*_0x27bda6);_0x482ee4['push'](_0x56c850);}this[_0x1ae9ba(0xdd)][_0x1ae9ba(0xa6)](_0x9ce040,_0x482ee4),console[_0x1ae9ba(0xae)](_0x1ae9ba(0x15e)+_0x58e245+'\x20status\x20checks\x20for\x20payment\x20'+_0x9ce040);}[a60_0x12d171(0x141)](_0x1ea68a){const _0x49c1a2=a60_0x12d171,_0x35ebb6=this['statusCheckTimers'][_0x49c1a2(0x165)](_0x1ea68a);_0x35ebb6&&(console[_0x49c1a2(0xae)](_0x49c1a2(0x1c7)+_0x35ebb6[_0x49c1a2(0x9f)]+_0x49c1a2(0x173)+_0x1ea68a),_0x35ebb6['forEach']((_0x11bfb2,_0x37bf40)=>{clearTimeout(_0x11bfb2);}),this[_0x49c1a2(0xdd)][_0x49c1a2(0x7e)](_0x1ea68a));}async[a60_0x12d171(0x1a5)](_0x3b6fe6,_0x2906cc,_0x2a327f){const _0x5e77b5=a60_0x12d171;try{const _0x710241=(await Promise['resolve']()[_0x5e77b5(0x8f)](()=>__importStar(require(_0x5e77b5(0x158)))))['default'],_0x270799={'status':_0x2906cc[_0x5e77b5(0x15c)](),'updatedAt':new Date(),'statusChangedBy':_0x5e77b5(0x6c),'statusChangedAt':new Date()};_0x2906cc===_0x5e77b5(0xe8)&&(_0x270799[_0x5e77b5(0x1d3)]=new Date()),_0x2906cc===_0x5e77b5(0x17e)&&_0x2a327f[_0x5e77b5(0x16e)]&&(_0x270799[_0x5e77b5(0xe3)]=_0x2a327f[_0x5e77b5(0x16e)],console[_0x5e77b5(0xae)](_0x5e77b5(0x130)+_0x2a327f[_0x5e77b5(0x16e)])),await _0x710241[_0x5e77b5(0x182)]['update']({'where':{'id':_0x3b6fe6},'data':_0x270799}),console[_0x5e77b5(0xae)](_0x5e77b5(0x15b)+_0x3b6fe6+'\x20status\x20updated\x20to\x20'+_0x2906cc),await this[_0x5e77b5(0x1d6)](_0x3b6fe6,_0x2906cc);}catch(_0x31deb6){console[_0x5e77b5(0xbd)](_0x5e77b5(0xea)+_0x3b6fe6+':',_0x31deb6);}}async['sendPaymentNotifications'](_0x351b0e,_0x5a5a62){const _0x3b7595=a60_0x12d171;try{const _0x139350=(await Promise[_0x3b7595(0x8a)]()[_0x3b7595(0x8f)](()=>__importStar(require(_0x3b7595(0x158)))))[_0x3b7595(0x16f)],{telegramBotService:_0xac227e}=await Promise[_0x3b7595(0x8a)]()[_0x3b7595(0x8f)](()=>__importStar(require(_0x3b7595(0xb7)))),_0x2d43a0=await _0x139350[_0x3b7595(0x182)]['findUnique']({'where':{'id':_0x351b0e},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x2d43a0)return;const _0x359c76={'PAID':_0x3b7595(0x1ce),'FAILED':_0x3b7595(0xb9)},_0x3eed0d=_0x359c76[_0x5a5a62];_0x3eed0d&&await _0xac227e[_0x3b7595(0x1c3)](_0x2d43a0[_0x3b7595(0x166)],_0x2d43a0,_0x3eed0d),await this['sendShopWebhook'](_0x2d43a0,_0x5a5a62);}catch(_0x55fec4){console['error'](_0x3b7595(0xb3),_0x55fec4);}}async[a60_0x12d171(0x71)](_0x5d58c1,_0x378f90){const _0x2df21e=a60_0x12d171,_0x350175=Date[_0x2df21e(0x16c)]();try{const _0x7ce9fd=_0x5d58c1[_0x2df21e(0x132)],_0x53d80f=_0x7ce9fd[_0x2df21e(0x1cf)];if(!_0x53d80f?.[_0x2df21e(0x18c)]){console['log'](_0x2df21e(0x145)+_0x7ce9fd['id']);return;}const _0x48e384=_0x378f90===_0x2df21e(0xe8)?_0x2df21e(0x9b):_0x2df21e(0x75);let _0x58b599=[];if(_0x53d80f[_0x2df21e(0xbe)])try{_0x58b599=Array['isArray'](_0x53d80f[_0x2df21e(0xbe)])?_0x53d80f['webhookEvents']:JSON[_0x2df21e(0x1bd)](_0x53d80f[_0x2df21e(0xbe)]);}catch(_0x5172bd){console[_0x2df21e(0xbd)]('Error\x20parsing\x20webhook\x20events:',_0x5172bd),_0x58b599=[];}if(!_0x58b599[_0x2df21e(0xf1)](_0x48e384)){console[_0x2df21e(0xae)]('Webhook\x20event\x20'+_0x48e384+_0x2df21e(0x18b)+_0x7ce9fd['id']);return;}const _0x8d543f={'event':_0x48e384,'payment':{'id':_0x5d58c1['id'],'order_id':_0x5d58c1[_0x2df21e(0x15d)],'gateway_order_id':_0x5d58c1[_0x2df21e(0x96)],'gateway':_0x2df21e(0x191),'amount':_0x5d58c1['amount'],'currency':_0x5d58c1[_0x2df21e(0x18f)],'status':_0x378f90['toLowerCase'](),'customer_email':_0x5d58c1[_0x2df21e(0x7b)],'customer_name':_0x5d58c1[_0x2df21e(0x116)],'created_at':_0x5d58c1['createdAt'],'updated_at':new Date()}},_0x1e915b=await fetch(_0x53d80f[_0x2df21e(0x18c)],{'method':_0x2df21e(0x184),'headers':{'Content-Type':_0x2df21e(0x17a),'User-Agent':_0x2df21e(0x1c2)},'body':JSON[_0x2df21e(0x1c5)](_0x8d543f)}),_0x4560ae=Date['now']()-_0x350175;loggerService_1[_0x2df21e(0x67)][_0x2df21e(0xb6)](_0x5d58c1['shopId'],_0x53d80f[_0x2df21e(0x18c)],_0x48e384,_0x1e915b[_0x2df21e(0x11c)],_0x4560ae,_0x8d543f),console[_0x2df21e(0xae)](_0x2df21e(0x161)+_0x53d80f[_0x2df21e(0x18c)]+_0x2df21e(0xb4)+_0x1e915b[_0x2df21e(0x11c)]+'\x20('+_0x4560ae+_0x2df21e(0x160));}catch(_0x115495){console[_0x2df21e(0xbd)](_0x2df21e(0x195),_0x115495),loggerService_1[_0x2df21e(0x67)]['logShopWebhookError'](_0x5d58c1[_0x2df21e(0x166)],_0x5d58c1[_0x2df21e(0x132)]?.[_0x2df21e(0x1cf)]?.[_0x2df21e(0x18c)]||_0x2df21e(0xac),_0x2df21e(0x90),_0x115495,{});}}[a60_0x12d171(0x107)](_0x44eb70){const _0x54ca8c=a60_0x12d171,_0x28324c=_0x44eb70[_0x54ca8c(0xab)](/[\s-]/g,'');if(_0x28324c[_0x54ca8c(0x9f)]<0x4)return _0x54ca8c(0xd5);return'****\x20****\x20****\x20'+_0x28324c[_0x54ca8c(0x1ad)](-0x4);}async[a60_0x12d171(0x1ab)](_0x93d5b3,_0x170590=a60_0x12d171(0x99)){const _0x40ab17=a60_0x12d171;console[_0x40ab17(0xae)]('üîÑ\x20Processing\x20MasterCard\x20webhook\x20data:',JSON[_0x40ab17(0x1c5)](_0x93d5b3,null,0x2));let _0x11d92b=_0x93d5b3,_0x57d2b4=_0x170590;_0x93d5b3[_0x40ab17(0x80)]?(_0x57d2b4=_0x93d5b3[_0x40ab17(0x80)][_0x40ab17(0x15c)]()===_0x40ab17(0x10a)?_0x40ab17(0x10a):_0x40ab17(0x99),console[_0x40ab17(0xae)](_0x40ab17(0x147)+_0x57d2b4)):console[_0x40ab17(0xae)](_0x40ab17(0xf0)+_0x57d2b4);if(_0x93d5b3['info']&&_0x93d5b3[_0x40ab17(0x175)]&&_0x93d5b3[_0x40ab17(0x8d)]){console['log'](_0x40ab17(0x174));try{const _0x69bdca=await this['decryptResponsePhp'](_0x93d5b3[_0x40ab17(0xfa)],_0x93d5b3['key'],_0x57d2b4);_0x11d92b=JSON[_0x40ab17(0x1bd)](_0x69bdca),console['log']('‚úÖ\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP'),console[_0x40ab17(0xae)]('üìù\x20Decrypted\x20webhook\x20data:',JSON[_0x40ab17(0x1c5)](_0x11d92b,null,0x2));}catch(_0x6388dc){console[_0x40ab17(0xbd)](_0x40ab17(0x86),_0x6388dc),console[_0x40ab17(0xae)](_0x40ab17(0xa0)),_0x11d92b=_0x93d5b3;}}else console[_0x40ab17(0xae)](_0x40ab17(0x1ba));let _0x41c6fd=_0x40ab17(0x1b0);if(_0x11d92b[_0x40ab17(0x11c)]===0x64&&_0x11d92b[_0x40ab17(0x135)]===0x1)_0x41c6fd='PAID';else{if(_0x11d92b[_0x40ab17(0x135)]===0x0||!this[_0x40ab17(0x1b8)](_0x11d92b['status']))_0x41c6fd=_0x40ab17(0x1b0);else _0x11d92b['final']===0x1||this['isFinalStatus'](_0x11d92b[_0x40ab17(0x11c)])?_0x41c6fd=_0x40ab17(0x17e):_0x41c6fd=_0x40ab17(0x1b0);}let _0xeb40b2='';if(_0x11d92b['order_id'])_0xeb40b2=_0x11d92b[_0x40ab17(0x181)]['toString'](),console[_0x40ab17(0xae)](_0x40ab17(0xfd)+_0x57d2b4+'\x20order_id\x20for\x20search:\x20'+_0xeb40b2);else _0x11d92b[_0x40ab17(0x79)]?(_0xeb40b2=_0x11d92b[_0x40ab17(0x79)][_0x40ab17(0x1b9)](),console[_0x40ab17(0xae)](_0x40ab17(0xfd)+_0x57d2b4+_0x40ab17(0x193)+_0xeb40b2)):(_0xeb40b2=_0x11d92b[_0x40ab17(0x15d)]||_0x11d92b[_0x40ab17(0x185)]||_0x11d92b['id']||'',console['log'](_0x40ab17(0x89)+_0xeb40b2));console['log'](_0x40ab17(0x1b1)+_0x57d2b4+'\x20webhook\x20extracted\x20data:'),console[_0x40ab17(0xae)](_0x40ab17(0x188)+_0xeb40b2+_0x40ab17(0xeb)+_0x11d92b[_0x40ab17(0x181)]+_0x40ab17(0xd6)+_0x11d92b[_0x40ab17(0x15d)]+',\x20payment_id='+_0x11d92b[_0x40ab17(0x79)]+_0x40ab17(0xa3)+_0x11d92b[_0x40ab17(0x185)]+_0x40ab17(0xbc)+_0x11d92b['id']+')'),console[_0x40ab17(0xae)]('\x20\x20\x20Status:\x20'+_0x41c6fd+_0x40ab17(0x10d)+_0x11d92b[_0x40ab17(0x11c)]+',\x20final='+_0x11d92b[_0x40ab17(0x135)]+')'),console[_0x40ab17(0xae)](_0x40ab17(0x189)+_0x11d92b[_0x40ab17(0x168)]),console[_0x40ab17(0xae)](_0x40ab17(0x18a)+_0x11d92b[_0x40ab17(0x18f)]);let _0x2f3f82;_0x41c6fd===_0x40ab17(0x17e)&&(_0x2f3f82=this['getDetailedErrorMessage'](_0x11d92b[_0x40ab17(0x11c)],_0x11d92b[_0x40ab17(0x148)]),console[_0x40ab17(0xae)]('‚ùå\x20Detailed\x20failure\x20description:\x20'+_0x2f3f82));const _0x48ba5c={'paymentId':_0xeb40b2,'status':_0x41c6fd,'amount':_0x11d92b[_0x40ab17(0x168)],'currency':_0x11d92b[_0x40ab17(0x18f)]};return _0x2f3f82&&(_0x48ba5c['errorMessage']=_0x2f3f82),_0x48ba5c;}[a60_0x12d171(0x101)](){const _0x594a52=a60_0x12d171;console['log'](_0x594a52(0x176));const _0x307f62=this['statusCheckTimers'][_0x594a52(0x106)];for(const [_0x2eb53f]of this[_0x594a52(0xdd)]){this[_0x594a52(0x141)](_0x2eb53f);}console[_0x594a52(0xae)]('üõë\x20Stopped\x20'+_0x307f62+_0x594a52(0x69));}}exports[a60_0x12d171(0xe0)]=VisaMasterCardService;