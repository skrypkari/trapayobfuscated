'use strict';const a51_0xd4e5ef=a51_0x450b;(function(_0x3583a0,_0x599fe3){const _0x2443a8=a51_0x450b,_0x387a13=_0x3583a0();while(!![]){try{const _0x3ae89e=-parseInt(_0x2443a8(0x157))/0x1*(parseInt(_0x2443a8(0x23c))/0x2)+-parseInt(_0x2443a8(0x1d2))/0x3+-parseInt(_0x2443a8(0x1b7))/0x4*(-parseInt(_0x2443a8(0x1dd))/0x5)+-parseInt(_0x2443a8(0x245))/0x6+-parseInt(_0x2443a8(0x225))/0x7+-parseInt(_0x2443a8(0x1f9))/0x8*(-parseInt(_0x2443a8(0x257))/0x9)+parseInt(_0x2443a8(0x21f))/0xa*(parseInt(_0x2443a8(0x227))/0xb);if(_0x3ae89e===_0x599fe3)break;else _0x387a13['push'](_0x387a13['shift']());}catch(_0x1be2ca){_0x387a13['push'](_0x387a13['shift']());}}}(a51_0x5902,0xbe378));function a51_0x5902(){const _0x204c8b=['\x20\x20Cleaned:\x20\x20\x22','webhookEvents','maskCardNumber','Return\x20URL:','sendPaymentNotifications','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x22\x20|\x20\x22','findUnique','defineProperty','logWhiteDomainResponse','delete','4UZsXDf','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','Payment\x20System/1.0\x20(MasterCard)','application/json','Sender\x27s\x20card\x20details\x20are\x20required','\x20payment:\x20','Amount:','visaMerchantPointId','order_id','Error\x20details:','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','Number\x20of\x20attempts\x20exceeded','Status:','merchantPointId','stopAllStatusChecks','HTTP\x20','currency','3DS\x20verification\x20required','Final:','https://api.paydmeth.com/api','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','Request\x20data\x20error','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','SHA256','Response\x20Time:','decryptAES','paid','3053382gZCWUQ','end','createDecipheriv','paymentId','HTTP\x20error!\x20status:\x20','Payment\x20is\x20being\x20processed','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','logShopWebhookError','Failed\x20to\x20send\x20MasterCard\x20webhook:','visaPublicKeyPath','__createBinding','2387855PIzlwJ','/charge','LookUp\x20code\x20verified','Error\x20parsing\x20webhook\x20events:','/status','desc','getCardTypeAndApi','join','VisaMasterCardService','✅\x20VISA\x20key\x20files\x20validated\x20successfully','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','expire_year','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','Payment\x20cancellation\x20is\x20being\x20processed','date_success','constants','📤\x20Sending\x20request\x20to\x20API...','forEach','webhookUrl','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',',\x20id=','keys','clearStatusTimers','❌\x20RSA\x20encryption\x20failed:','📝\x20Signature\x20length:','resolve','\x20payment_id\x20for\x20search:\x20','\x20\x20\x20Amount:\x20','8200zUskos','Card\x20Number:','first_name','includes','validateKeyFiles','logWhiteDomainError','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','private.pem','../../config/database','webhook_send','gatewayOrderId','cvv','visaApiUrl','❌\x20RSA\x20signing\x20failed:','../loggerService','),\x20defaulting\x20to\x20MasterCard','),\x20stopping\x20status\x20checks','get','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','default','\x20is\x20final\x20(','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','log','Awaiting\x20confirmation\x20by\x20ivr\x20call','now','🔐\x203DS\x20verification\x20required','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','✅\x20Status\x20response\x20decrypted\x20successfully','writable','visaPrivateKeyPath','key','Payment\x20prohibited','hasOwnProperty','\x20result:','\x20with\x20status\x20','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','set','2110mkYDuJ','unknown','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','stringify','🔐\x20Data\x20encrypted\x20with\x20AES','180362JtPItt','1111','70741QyzXyI','📝\x20Data\x20to\x20sign\x20length:','🔐\x20MasterCard\x20Private\x20key\x20path:','Another\x20unknown\x20error','payment.failed','json','cwd','\x20\x20\x20-\x20method:\x20charge','loggerService','Result\x20URL:','__setModuleDefault','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','4000000000000000','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','🔍\x20','charAt','readFileSync','Failed\x20payment','paidAt','Order\x20ID:','🔐\x20VISA\x20API\x20URL:','84970vGWiyl','❌\x20Detailed\x20failure\x20description:\x20','processWebhook','create','\x20(from:\x20status=','Payment\x20confirmation\x20required','masterCardApiUrl','💾\x20Payment\x20data\x20prepared','🔐\x20Using\x20keys:\x20','1579974viOJBD','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details',',\x20Desc:\x20','📊\x20Status\x20check\x20result:','card_type','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','shopId','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','createCipheriv','visa_private.pem','amount','No\x20New\x20payment','message','base64','utf8','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours',',\x20orderId=','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','8550yllDnL','payment.success','text','Payment\x20System/1.0','__esModule','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','HTTP\x20Status:','error','aes-256-ctr','toUpperCase','number','\x20|\x20Response:\x20','-----END','-----BEGIN','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','🔐\x20RSA\x20signing\x20successful','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','privateKeyPath','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','Invalid\x20expiration\x20date','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','✅\x20Scheduled\x20','payment','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','✅\x20Payment\x20','sendPaymentNotification','charge','Payment\x20returned','/charge_raw','Payment\x20ID:','sign','****','🧹\x20Card\x20holder\x20names\x20cleaned:','\x20status\x20check\x20#','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited',',\x20final=','⏰\x20Will\x20check\x20status\x20','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','🎯\x20Using\x20','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','configurable','Insufficient\x20funds\x20on\x20the\x20card','📝\x20Final\x20request\x20structure:','warn','\x20MasterCard\x20status\x20check\x20timers','existsSync','signRSA','Payment\x20pending\x20verification','📊\x20Status\x20check\x20#','/status_raw','call','getOwnPropertyDescriptor','Captcha\x20confirmation\x20awaited','\x20failed\x20for\x20payment\x20','🔐\x20VISA\x20Public\x20key\x20length:\x20',':\x20Unknown\x20status\x20code','PIN\x20code\x20confirmation\x20awaited','masterCardMerchantPointId','/charge_decrypted','\x20not\x20enabled\x20for\x20shop\x20','📝\x20Encrypted\x20data\x20length:','LookUp\x20code\x20sent','Method\x20not\x20allowed','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','MASTERCARD','Webhook\x20event\x20','logShopWebhookSent','generateAESKey','🔐\x20VISA\x20Public\x20key\x20path:','PAID','🔐\x20AES\x20key\x20length:','publicKeyPath','processCardPayment','3ds_url','__importStar','isFinalStatus','logWhiteDomainRequest','toLowerCase',',\x20paymentId=','\x20status\x20checks\x20for\x20payment\x20','🔐\x20VISA\x20Private\x20key\x20length:\x20','push','checkPaymentStatus','🔍\x20Using\x20provided\x20card\x20type:\x20','===\x20PARSED\x20API\x20RESPONSE\x20===','\x20API:\x20','replace','from','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','POST','LookUp\x20number\x20of\x20attempts\x20exceeded','https://api2.trapay.uk/decrypt.php','🔐\x20AES\x20IV\x20length:','Sender\x27s\x20CVV\x20card\x20is\x20required','info','none','\x20\x20\x20Status:\x20','\x20status\x20check\x20error:','../telegramBotService','customerEmail',',\x20Final:\x20','status','\x20payment\x20status:\x20','17NqJEAT','Payment\x20confirmation\x20time\x20has\x20expired','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','statusCheckTimers','❌\x20Data\x20being\x20signed:','PENDING','🔐\x20MasterCard\x20Public\x20key\x20path:','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','then','📝\x20Data\x20length:','visa/mastercard','💳\x20VISA/MasterCard\x20service\x20initialized','toString','payment_id','📝\x20Decrypted\x20webhook\x20data:','path','🔐\x20Data\x20signed\x20with\x20RSA','\x20characters','description','❌\x20PHP\x20decryptor\x20request\x20failed:','🔐\x20AES\x20key\x20and\x20IV\x20generated','paymentStatuses','📝\x20Encrypted\x20key\x20length:','createdAt','FAILED','encryptRSA','Cancellation\x20is\x20not\x20possible','\x20(from:\x20order_id=','Expected\x20bitcoin\x20transfer\x20from\x20client','\x20for\x20payment\x20','Unsuccessful\x20payment','orderId','Failed\x20to\x20send\x20payment\x20notifications:','/status_decrypted','parse','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','\x20\x20\x20Currency:\x20','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','length','trim','Transaction\x20limit\x20exceeded','createSign','__importDefault','settings','Status\x20','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','getOwnPropertyNames','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','\x20\x20\x20-\x20info\x20length:','Operation\x20completed\x20successfully','privateDecrypt','❌\x20Status\x20check\x20#','Awaiting\x20confirmation\x20in\x20the\x20application','getDetailedErrorMessage','cardType','final','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','size','\x20\x20\x20-\x20key\x20length:','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','slice','shop','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','decryptResponsePhp','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','Status\x20decryption\x20failed:\x20','🔐\x20VISA\x20Private\x20key\x20path:','sendShopWebhook','Cash\x20payment\x20is\x20expected\x20at\x20TCO','\x20\x20Original:\x20\x22','VISA','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','🔍\x20Using\x20',',\x20payment_id=','\x20\x20\x20-\x20sign\x20length:','⏰\x20Scheduling\x20status\x20checks\x20for\x20','prototype','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','last_name','update','publicEncrypt','apiUrl'];a51_0x5902=function(){return _0x204c8b;};return a51_0x5902();}function a51_0x450b(_0x378915,_0x46df50){const _0x590236=a51_0x5902();return a51_0x450b=function(_0x450b7f,_0x11fafb){_0x450b7f=_0x450b7f-0x124;let _0x284135=_0x590236[_0x450b7f];return _0x284135;},a51_0x450b(_0x378915,_0x46df50);}var __createBinding=this&&this[a51_0xd4e5ef(0x1dc)]||(Object[a51_0xd4e5ef(0x23f)]?function(_0x22b6ec,_0x2b36fe,_0x49cbb7,_0x4b6b18){const _0x2432f1=a51_0xd4e5ef;if(_0x4b6b18===undefined)_0x4b6b18=_0x49cbb7;var _0x3ae59e=Object[_0x2432f1(0x28b)](_0x2b36fe,_0x49cbb7);(!_0x3ae59e||(_0x2432f1(0x20a)in _0x3ae59e?!_0x2b36fe['__esModule']:_0x3ae59e[_0x2432f1(0x216)]||_0x3ae59e[_0x2432f1(0x280)]))&&(_0x3ae59e={'enumerable':!![],'get':function(){return _0x2b36fe[_0x49cbb7];}}),Object['defineProperty'](_0x22b6ec,_0x4b6b18,_0x3ae59e);}:function(_0x5dfb29,_0x393023,_0x2d7bc2,_0x1ab835){if(_0x1ab835===undefined)_0x1ab835=_0x2d7bc2;_0x5dfb29[_0x1ab835]=_0x393023[_0x2d7bc2];}),__setModuleDefault=this&&this[a51_0xd4e5ef(0x231)]||(Object['create']?function(_0x2838e8,_0x22e24d){const _0x222ef6=a51_0xd4e5ef;Object[_0x222ef6(0x1b4)](_0x2838e8,_0x222ef6(0x20d),{'enumerable':!![],'value':_0x22e24d});}:function(_0x6775c6,_0x581755){_0x6775c6['default']=_0x581755;}),__importStar=this&&this[a51_0xd4e5ef(0x13a)]||(function(){var _0x262620=function(_0x470cb5){const _0x49ec8b=a51_0x450b;return _0x262620=Object[_0x49ec8b(0x188)]||function(_0x5bc738){const _0x1fb96f=_0x49ec8b;var _0x29560b=[];for(var _0x5779e2 in _0x5bc738)if(Object[_0x1fb96f(0x1a6)][_0x1fb96f(0x21a)][_0x1fb96f(0x28a)](_0x5bc738,_0x5779e2))_0x29560b[_0x29560b['length']]=_0x5779e2;return _0x29560b;},_0x262620(_0x470cb5);};return function(_0xf4373d){const _0x1ff6a2=a51_0x450b;if(_0xf4373d&&_0xf4373d[_0x1ff6a2(0x25b)])return _0xf4373d;var _0x1b70a7={};if(_0xf4373d!=null){for(var _0x382fc9=_0x262620(_0xf4373d),_0x3a8dd6=0x0;_0x3a8dd6<_0x382fc9[_0x1ff6a2(0x17f)];_0x3a8dd6++)if(_0x382fc9[_0x3a8dd6]!==_0x1ff6a2(0x20d))__createBinding(_0x1b70a7,_0xf4373d,_0x382fc9[_0x3a8dd6]);}return __setModuleDefault(_0x1b70a7,_0xf4373d),_0x1b70a7;};}()),__importDefault=this&&this[a51_0xd4e5ef(0x183)]||function(_0x5bbb37){const _0x1632ef=a51_0xd4e5ef;return _0x5bbb37&&_0x5bbb37[_0x1632ef(0x25b)]?_0x5bbb37:{'default':_0x5bbb37};};Object[a51_0xd4e5ef(0x1b4)](exports,a51_0xd4e5ef(0x25b),{'value':!![]}),exports[a51_0xd4e5ef(0x1e5)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0xd4e5ef(0x167))),loggerService_1=require(a51_0xd4e5ef(0x207));class VisaMasterCardService{constructor(){const _0x3b2817=a51_0xd4e5ef;this[_0x3b2817(0x15b)]=new Map(),this[_0x3b2817(0x16d)]={0x0:{'final':![],'description':_0x3b2817(0x250)},0x1:{'final':![],'description':'No\x20Error\x20executing\x20request'},0x2:{'final':!![],'description':_0x3b2817(0x1cc)},0x3:{'final':!![],'description':_0x3b2817(0x22a)},0x4:{'final':!![],'description':_0x3b2817(0x176)},0x5:{'final':!![],'description':_0x3b2817(0x26a)},0x6:{'final':!![],'description':_0x3b2817(0x273)},0x7:{'final':!![],'description':'Test\x20payment'},0x8:{'final':![],'description':'Client\x20OTP\x20confirmation\x20required'},0x9:{'final':![],'description':'3DS\x20verification\x20required'},0xa:{'final':![],'description':_0x3b2817(0x14d)},0xb:{'final':![],'description':'Sender\x20information\x20required'},0xc:{'final':![],'description':'Recipient\x20data\x20required'},0xd:{'final':![],'description':_0x3b2817(0x192)},0xe:{'final':![],'description':_0x3b2817(0x211)},0xf:{'final':![],'description':_0x3b2817(0x128)},0x10:{'final':![],'description':_0x3b2817(0x124)},0x11:{'final':![],'description':'Awaiting\x20confirmation\x20of\x20the\x20login\x20password'},0x12:{'final':![],'description':_0x3b2817(0x18e)},0x13:{'final':![],'description':_0x3b2817(0x1d7)},0x14:{'final':![],'description':_0x3b2817(0x232)},0x15:{'final':![],'description':_0x3b2817(0x174)},0x16:{'final':![],'description':_0x3b2817(0x287)},0x18:{'final':![],'description':_0x3b2817(0x27a)},0x19:{'final':![],'description':_0x3b2817(0x234)},0x1a:{'final':!![],'description':_0x3b2817(0x19e)},0x1b:{'final':![],'description':_0x3b2817(0x214)},0x1c:{'final':![],'description':_0x3b2817(0x21d)},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':_0x3b2817(0x148)},0x20:{'final':![],'description':_0x3b2817(0x187)},0x23:{'final':![],'description':_0x3b2817(0x1bb)},0x24:{'final':!![],'description':_0x3b2817(0x158)},0x25:{'final':!![],'description':_0x3b2817(0x219)},0x26:{'final':!![],'description':_0x3b2817(0x26c)},0x27:{'final':!![],'description':_0x3b2817(0x281)},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':'The\x20card\x20is\x20lost\x20or\x20stolen'},0x2a:{'final':!![],'description':_0x3b2817(0x26b)},0x2b:{'final':!![],'description':_0x3b2817(0x181)},0x2c:{'final':!![],'description':'The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank'},0x2d:{'final':!![],'description':_0x3b2817(0x238)},0x2e:{'final':!![],'description':_0x3b2817(0x176)},0x2f:{'final':!![],'description':'Unsuccessful\x20payment'},0x30:{'final':!![],'description':_0x3b2817(0x198)},0x31:{'final':![],'description':_0x3b2817(0x241)},0x32:{'final':!![],'description':_0x3b2817(0x12e)},0x33:{'final':!![],'description':_0x3b2817(0x238)},0x34:{'final':!![],'description':'Failed\x20payment'},0x35:{'final':!![],'description':_0x3b2817(0x238)},0x36:{'final':!![],'description':_0x3b2817(0x238)},0x37:{'final':!![],'description':_0x3b2817(0x238)},0x38:{'final':!![],'description':_0x3b2817(0x172)},0x39:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank'},0x3a:{'final':![],'description':_0x3b2817(0x12d)},0x3b:{'final':!![],'description':_0x3b2817(0x1df)},0x3c:{'final':!![],'description':_0x3b2817(0x1c2)},0x3d:{'final':!![],'description':_0x3b2817(0x25c)},0x3e:{'final':!![],'description':_0x3b2817(0x1a1)},0x3f:{'final':!![],'description':_0x3b2817(0x273)},0x40:{'final':![],'description':'LookUp\x20not\x20confirmed'},0x41:{'final':!![],'description':_0x3b2817(0x14a)},0x42:{'final':![],'description':_0x3b2817(0x1ea)},0x43:{'final':!![],'description':_0x3b2817(0x159)},0x44:{'final':![],'description':_0x3b2817(0x1c8)},0x45:{'final':!![],'description':_0x3b2817(0x238)},0x46:{'final':!![],'description':_0x3b2817(0x238)},0x47:{'final':!![],'description':_0x3b2817(0x246)},0x64:{'final':!![],'description':_0x3b2817(0x18b)}},this[_0x3b2817(0x242)]=_0x3b2817(0x1ca),this[_0x3b2817(0x129)]=0x6e4,this['privateKeyPath']=path_1['default']['join'](process['cwd'](),_0x3b2817(0x1f2),_0x3b2817(0x200)),this[_0x3b2817(0x137)]=path_1[_0x3b2817(0x20d)]['join'](process[_0x3b2817(0x22d)](),'keys','psp_public.pem'),this[_0x3b2817(0x205)]=_0x3b2817(0x1ca),this['visaMerchantPointId']=0x6b7,this['visaPrivateKeyPath']=path_1[_0x3b2817(0x20d)]['join'](process[_0x3b2817(0x22d)](),_0x3b2817(0x1f2),_0x3b2817(0x24e)),this[_0x3b2817(0x1db)]=path_1[_0x3b2817(0x20d)][_0x3b2817(0x1e4)](process[_0x3b2817(0x22d)](),_0x3b2817(0x1f2),'visa_public.pem'),console['log'](_0x3b2817(0x163)),console[_0x3b2817(0x210)]('🔐\x20MasterCard\x20API\x20URL:',this[_0x3b2817(0x242)]),console['log'](_0x3b2817(0x23b),this[_0x3b2817(0x205)]),console['log'](_0x3b2817(0x229),this[_0x3b2817(0x269)]),console[_0x3b2817(0x210)](_0x3b2817(0x15e),this[_0x3b2817(0x137)]),console[_0x3b2817(0x210)](_0x3b2817(0x19c),this[_0x3b2817(0x217)]),console[_0x3b2817(0x210)](_0x3b2817(0x134),this[_0x3b2817(0x1db)]),this['validateKeyFiles']();}[a51_0xd4e5ef(0x18f)](_0x34c968,_0x11cb8b){const _0x163c85=a51_0xd4e5ef,_0x221237=this['paymentStatuses'][_0x34c968];let _0x140fdd='';_0x221237?_0x140fdd=_0x163c85(0x185)+_0x34c968+':\x20'+_0x221237[_0x163c85(0x16a)]:_0x140fdd=_0x163c85(0x185)+_0x34c968+_0x163c85(0x127);if(_0x11cb8b&&_0x11cb8b['trim']()){const _0x3092a8=_0x11cb8b[_0x163c85(0x180)]();(!_0x221237||_0x3092a8[_0x163c85(0x13d)]()!==_0x221237[_0x163c85(0x16a)][_0x163c85(0x13d)]())&&(_0x140fdd+=_0x163c85(0x263)+_0x3092a8);}return _0x140fdd;}['isFinalStatus'](_0x462a79){const _0x2eb31f=a51_0xd4e5ef,_0x344ba1=this[_0x2eb31f(0x16d)][_0x462a79];return _0x344ba1?_0x344ba1[_0x2eb31f(0x191)]:!![];}[a51_0xd4e5ef(0x1e3)](_0xa6f896){const _0x5de1c5=a51_0xd4e5ef,_0x85cda1=_0xa6f896[_0x5de1c5(0x236)](0x0);if(_0x85cda1==='4')return console[_0x5de1c5(0x210)](_0x5de1c5(0x256)),{'cardType':_0x5de1c5(0x1a0),'apiUrl':this['visaApiUrl'],'privateKeyPath':this['visaPrivateKeyPath'],'publicKeyPath':this[_0x5de1c5(0x1db)],'merchantPointId':this[_0x5de1c5(0x1be)]};else return _0x85cda1==='5'?(console[_0x5de1c5(0x210)]('💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)'),{'cardType':'MASTERCARD','apiUrl':this[_0x5de1c5(0x242)],'privateKeyPath':this[_0x5de1c5(0x269)],'publicKeyPath':this[_0x5de1c5(0x137)],'merchantPointId':this[_0x5de1c5(0x129)]}):(console[_0x5de1c5(0x210)]('💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20'+_0x85cda1+_0x5de1c5(0x208)),{'cardType':_0x5de1c5(0x130),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x5de1c5(0x269)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x5de1c5(0x129)]});}[a51_0xd4e5ef(0x1fd)](){const _0x1352d1=a51_0xd4e5ef;try{if(!fs_1['default'][_0x1352d1(0x285)](this[_0x1352d1(0x269)]))throw new Error(_0x1352d1(0x24c)+this[_0x1352d1(0x269)]);if(!fs_1[_0x1352d1(0x20d)][_0x1352d1(0x285)](this[_0x1352d1(0x137)]))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this[_0x1352d1(0x137)]);const _0x3c21a5=fs_1[_0x1352d1(0x20d)][_0x1352d1(0x237)](this[_0x1352d1(0x269)],_0x1352d1(0x253))['trim'](),_0x90e3d1=fs_1[_0x1352d1(0x20d)][_0x1352d1(0x237)](this[_0x1352d1(0x137)],_0x1352d1(0x253))[_0x1352d1(0x180)]();if(!_0x3c21a5['includes'](_0x1352d1(0x265))||!_0x3c21a5[_0x1352d1(0x1fc)](_0x1352d1(0x264)))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x90e3d1['includes'](_0x1352d1(0x265))||!_0x90e3d1[_0x1352d1(0x1fc)]('-----END'))throw new Error(_0x1352d1(0x195));console['log']('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console[_0x1352d1(0x210)](_0x1352d1(0x20f)+_0x3c21a5[_0x1352d1(0x17f)]+_0x1352d1(0x169)),console[_0x1352d1(0x210)]('🔐\x20MasterCard\x20Public\x20key\x20length:\x20'+_0x90e3d1[_0x1352d1(0x17f)]+_0x1352d1(0x169));if(fs_1[_0x1352d1(0x20d)][_0x1352d1(0x285)](this[_0x1352d1(0x217)])&&fs_1[_0x1352d1(0x20d)][_0x1352d1(0x285)](this[_0x1352d1(0x1db)])){const _0x5c7c18=fs_1[_0x1352d1(0x20d)][_0x1352d1(0x237)](this[_0x1352d1(0x217)],_0x1352d1(0x253))[_0x1352d1(0x180)](),_0x47eb2e=fs_1[_0x1352d1(0x20d)][_0x1352d1(0x237)](this[_0x1352d1(0x1db)],_0x1352d1(0x253))[_0x1352d1(0x180)]();(!_0x5c7c18[_0x1352d1(0x1fc)](_0x1352d1(0x265))||!_0x5c7c18[_0x1352d1(0x1fc)](_0x1352d1(0x264)))&&console[_0x1352d1(0x283)](_0x1352d1(0x266)),(!_0x47eb2e[_0x1352d1(0x1fc)](_0x1352d1(0x265))||!_0x47eb2e['includes']('-----END'))&&console['warn'](_0x1352d1(0x221)),console['log'](_0x1352d1(0x1e6)),console['log'](_0x1352d1(0x140)+_0x5c7c18[_0x1352d1(0x17f)]+_0x1352d1(0x169)),console[_0x1352d1(0x210)](_0x1352d1(0x126)+_0x47eb2e[_0x1352d1(0x17f)]+_0x1352d1(0x169));}else console[_0x1352d1(0x283)](_0x1352d1(0x186)),console[_0x1352d1(0x283)](_0x1352d1(0x1e7)+this['visaPrivateKeyPath']),console[_0x1352d1(0x283)](_0x1352d1(0x1cd)+this[_0x1352d1(0x1db)]);}catch(_0x2f4766){console['error'](_0x1352d1(0x1ff),_0x2f4766);throw _0x2f4766;}}[a51_0xd4e5ef(0x133)](){const _0x1527f8=crypto_1['default']['randomBytes'](0x20),_0x285701=crypto_1['default']['randomBytes'](0x10);return{'key':_0x1527f8,'iv':_0x285701};}['encryptAES'](_0x52714b,_0x270248,_0x33cbdc){const _0x55e159=a51_0xd4e5ef,_0x215aaf=crypto_1[_0x55e159(0x20d)][_0x55e159(0x24d)](_0x55e159(0x260),_0x270248,_0x33cbdc);let _0x3b8242=_0x215aaf[_0x55e159(0x1a9)](_0x52714b,_0x55e159(0x253),_0x55e159(0x252));return _0x3b8242+=_0x215aaf[_0x55e159(0x191)](_0x55e159(0x252)),_0x3b8242;}[a51_0xd4e5ef(0x171)](_0x4de575,_0x36acfa,_0x293cbf){const _0x30c9c8=a51_0xd4e5ef;try{const _0x36419f=fs_1[_0x30c9c8(0x20d)]['readFileSync'](_0x293cbf,'utf8')['trim'](),_0x4db29b={'iv':_0x36acfa[_0x30c9c8(0x164)](_0x30c9c8(0x252)),'key':_0x4de575[_0x30c9c8(0x164)]('base64')},_0x4136b6=JSON['stringify'](_0x4db29b);console[_0x30c9c8(0x210)](_0x30c9c8(0x26f),_0x4136b6[_0x30c9c8(0x17f)]);const _0x24cd37=crypto_1[_0x30c9c8(0x20d)][_0x30c9c8(0x1aa)]({'key':_0x36419f,'padding':crypto_1[_0x30c9c8(0x20d)][_0x30c9c8(0x1ec)]['RSA_PKCS1_PADDING']},Buffer[_0x30c9c8(0x147)](_0x4136b6));return console['log'](_0x30c9c8(0x1f0),_0x24cd37[_0x30c9c8(0x17f)]),_0x24cd37[_0x30c9c8(0x164)](_0x30c9c8(0x252));}catch(_0x550282){console[_0x30c9c8(0x25f)](_0x30c9c8(0x1f4),_0x550282);throw new Error(_0x30c9c8(0x222));}}['signRSA'](_0x3273fe,_0x5c910e){const _0x5387f6=a51_0xd4e5ef;try{const _0x9ea194=fs_1[_0x5387f6(0x20d)][_0x5387f6(0x237)](_0x5c910e,_0x5387f6(0x253))[_0x5387f6(0x180)](),_0x133bbc=crypto_1[_0x5387f6(0x20d)][_0x5387f6(0x182)](_0x5387f6(0x1ce));_0x133bbc[_0x5387f6(0x1a9)](_0x3273fe),_0x133bbc[_0x5387f6(0x1d3)]();const _0x2c6c85=_0x133bbc['sign'](_0x9ea194,_0x5387f6(0x252));return console[_0x5387f6(0x210)](_0x5387f6(0x267)),console['log'](_0x5387f6(0x228),_0x3273fe[_0x5387f6(0x17f)]),console[_0x5387f6(0x210)](_0x5387f6(0x1f5),_0x2c6c85[_0x5387f6(0x17f)]),_0x2c6c85;}catch(_0x1af48e){console[_0x5387f6(0x25f)](_0x5387f6(0x206),_0x1af48e),console[_0x5387f6(0x25f)](_0x5387f6(0x15c),_0x3273fe['substring'](0x0,0xc8)+'...');throw new Error(_0x5387f6(0x15f));}}['decryptAES'](_0x39ba7b,_0x1b0112,_0xff9181){const _0x53fafa=a51_0xd4e5ef,_0x520b0f=crypto_1[_0x53fafa(0x20d)][_0x53fafa(0x1d4)](_0x53fafa(0x260),_0x1b0112,_0xff9181);let _0x2c2b88=_0x520b0f[_0x53fafa(0x1a9)](_0x39ba7b,_0x53fafa(0x252),_0x53fafa(0x253));return _0x2c2b88+=_0x520b0f[_0x53fafa(0x191)](_0x53fafa(0x253)),_0x2c2b88;}async[a51_0xd4e5ef(0x199)](_0xb86310,_0x3c34b5,_0x3792cf=a51_0xd4e5ef(0x130)){const _0x403e47=a51_0xd4e5ef;try{const _0x1ac3bc=await fetch(_0x403e47(0x14b),{'method':_0x403e47(0x149),'headers':{'Content-Type':_0x403e47(0x1ba)},'body':JSON['stringify']({'info':_0xb86310,'key':_0x3c34b5,'card_type':_0x3792cf['toLowerCase']()})});if(!_0x1ac3bc['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x1ac3bc[_0x403e47(0x259)]();}catch(_0x4b7477){console[_0x403e47(0x25f)](_0x403e47(0x16b),_0x4b7477);throw new Error(_0x403e47(0x1e9));}}['decryptResponse'](_0x26fd88,_0x36becb){const _0x594822=a51_0xd4e5ef;try{const _0x1178ab=fs_1['default'][_0x594822(0x237)](this[_0x594822(0x269)],_0x594822(0x253))[_0x594822(0x180)](),_0x117eb6=crypto_1[_0x594822(0x20d)][_0x594822(0x18c)](_0x1178ab,Buffer[_0x594822(0x147)](_0x36becb,'base64')),_0x18f71b=JSON['parse'](_0x117eb6['toString']()),_0x72360a=Buffer['from'](_0x18f71b[_0x594822(0x218)],'base64'),_0x1526df=Buffer[_0x594822(0x147)](_0x18f71b['iv'],_0x594822(0x252));return this[_0x594822(0x1d0)](_0x26fd88,_0x72360a,_0x1526df);}catch(_0x4d8973){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a51_0xd4e5ef(0x138)](_0x41fd67){const _0x36afa0=a51_0xd4e5ef,{paymentId:_0x3b68a7,orderId:_0x2b06b2,amount:_0x24d0d5,currency:_0x2f7b61,cardData:_0x2c498f,resultUrl:_0x3686e6,returnUrl:_0x595dcd,cardHolder:_0x44a3e4,browser:_0x2585f1}=_0x41fd67;console[_0x36afa0(0x210)](_0x36afa0(0x27f)),console[_0x36afa0(0x210)](_0x36afa0(0x275),_0x3b68a7),console[_0x36afa0(0x210)](_0x36afa0(0x23a),_0x2b06b2),console[_0x36afa0(0x210)](_0x36afa0(0x1bd),_0x24d0d5,_0x2f7b61),console[_0x36afa0(0x210)](_0x36afa0(0x1fa),this[_0x36afa0(0x1ae)](_0x2c498f[_0x36afa0(0x262)])),console['log']('Card\x20Holder:',_0x44a3e4['first_name']+'\x20'+_0x44a3e4['last_name']),console['log'](_0x36afa0(0x1af),_0x595dcd),console[_0x36afa0(0x210)](_0x36afa0(0x230),_0x3686e6);const _0x5e6f3a=this['getCardTypeAndApi'](_0x2c498f['number']);console[_0x36afa0(0x210)](_0x36afa0(0x27e)+_0x5e6f3a['cardType']+_0x36afa0(0x145)+_0x5e6f3a[_0x36afa0(0x1ab)]),console['log'](_0x36afa0(0x244)+_0x5e6f3a['privateKeyPath']+',\x20'+_0x5e6f3a[_0x36afa0(0x137)]);const _0x5de06e={..._0x44a3e4,'first_name':_0x44a3e4['first_name']?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x36afa0(0x180)]()||'','last_name':_0x44a3e4[_0x36afa0(0x1a8)]?.[_0x36afa0(0x146)](/[\t\n\r\f\v]/g,'\x20')[_0x36afa0(0x180)]()||''};console['log'](_0x36afa0(0x278)),console[_0x36afa0(0x210)](_0x36afa0(0x19f)+_0x44a3e4[_0x36afa0(0x1fb)]+_0x36afa0(0x1b2)+_0x44a3e4[_0x36afa0(0x1a8)]+'\x22'),console[_0x36afa0(0x210)](_0x36afa0(0x1ac)+_0x5de06e[_0x36afa0(0x1fb)]+_0x36afa0(0x1b2)+_0x5de06e[_0x36afa0(0x1a8)]+'\x22');const _0x2e8bc0={'amount':_0x24d0d5,'currency':_0x2f7b61[_0x36afa0(0x261)](),'order_id':_0x2b06b2,'result_url':_0x3686e6,'return_url':_0x595dcd,'country':'','card':{'number':_0x2c498f['number'],'expire_month':_0x2c498f['expire_month'],'expire_year':_0x2c498f[_0x36afa0(0x1e8)],'cvv':_0x2c498f[_0x36afa0(0x204)]},'card_holder':_0x5de06e,'browser':_0x2585f1},_0x8030ed=JSON['stringify'](_0x2e8bc0);console[_0x36afa0(0x210)](_0x36afa0(0x243)),console[_0x36afa0(0x210)](_0x36afa0(0x268)),console['log'](_0x8030ed),console[_0x36afa0(0x210)](_0x36afa0(0x161),_0x8030ed['length']);try{const {key:_0x437777,iv:_0x4eb8ab}=this[_0x36afa0(0x133)]();console[_0x36afa0(0x210)](_0x36afa0(0x16c)),console[_0x36afa0(0x210)](_0x36afa0(0x136),_0x437777[_0x36afa0(0x17f)]),console['log'](_0x36afa0(0x14c),_0x4eb8ab['length']);const _0x3dd7e1=this['encryptAES'](_0x8030ed,_0x437777,_0x4eb8ab);console['log'](_0x36afa0(0x224)),console[_0x36afa0(0x210)](_0x36afa0(0x12c),_0x3dd7e1[_0x36afa0(0x17f)]);const _0x570b8f=this['encryptRSA'](_0x437777,_0x4eb8ab,_0x5e6f3a['publicKeyPath']);console['log'](_0x36afa0(0x20c)),console[_0x36afa0(0x210)](_0x36afa0(0x16e),_0x570b8f[_0x36afa0(0x17f)]);const _0x32c719=this[_0x36afa0(0x286)](_0x8030ed,_0x5e6f3a['privateKeyPath']);console[_0x36afa0(0x210)](_0x36afa0(0x168)),console[_0x36afa0(0x210)](_0x36afa0(0x1f5),_0x32c719[_0x36afa0(0x17f)]);const _0x2f171c={'merchant_point_id':_0x5e6f3a[_0x36afa0(0x1c4)],'method':_0x36afa0(0x272),'info':_0x3dd7e1,'key':_0x570b8f,'sign':_0x32c719,'lang':'en'};console[_0x36afa0(0x210)](_0x36afa0(0x1ed)),console[_0x36afa0(0x210)](_0x36afa0(0x282)),console[_0x36afa0(0x210)]('\x20\x20\x20-\x20merchant_point_id:',_0x5e6f3a[_0x36afa0(0x1c4)]),console[_0x36afa0(0x210)](_0x36afa0(0x22e)),console[_0x36afa0(0x210)](_0x36afa0(0x18a),_0x3dd7e1[_0x36afa0(0x17f)]),console[_0x36afa0(0x210)](_0x36afa0(0x194),_0x570b8f[_0x36afa0(0x17f)]),console[_0x36afa0(0x210)](_0x36afa0(0x1a4),_0x32c719[_0x36afa0(0x17f)]),console[_0x36afa0(0x210)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x5e6f3a['cardType'][_0x36afa0(0x13d)](),_0x36afa0(0x1de),_0x36afa0(0x149),{'merchant_point_id':_0x5e6f3a['merchantPointId'],'method':_0x36afa0(0x272),'lang':'en'});const _0x4f3ae7=Date[_0x36afa0(0x212)](),_0x1fec64=await fetch(_0x5e6f3a[_0x36afa0(0x1ab)],{'method':_0x36afa0(0x149),'headers':{'Content-Type':'application/json','Accept':_0x36afa0(0x1ba),'User-Agent':_0x36afa0(0x25a)},'body':JSON[_0x36afa0(0x223)](_0x2f171c)}),_0x113568=Date[_0x36afa0(0x212)]()-_0x4f3ae7;console['log']('===\x20API\x20RESPONSE\x20==='),console[_0x36afa0(0x210)](_0x36afa0(0x1c3),_0x1fec64[_0x36afa0(0x155)]),console[_0x36afa0(0x210)](_0x36afa0(0x1cf),_0x113568+'ms');if(!_0x1fec64['ok']){const _0x20d765=await _0x1fec64['text']();console[_0x36afa0(0x25f)](_0x36afa0(0x25e),_0x1fec64[_0x36afa0(0x155)]),console[_0x36afa0(0x25f)]('Response\x20Body:',_0x20d765),loggerService_1[_0x36afa0(0x22f)]['logWhiteDomainResponse'](_0x5e6f3a[_0x36afa0(0x190)]['toLowerCase'](),_0x36afa0(0x274),_0x1fec64[_0x36afa0(0x155)],_0x20d765,_0x113568),loggerService_1['loggerService'][_0x36afa0(0x1fe)](_0x5e6f3a[_0x36afa0(0x190)]['toLowerCase'](),_0x36afa0(0x1de),_0x36afa0(0x1c6)+_0x1fec64['status']+':\x20'+_0x20d765);throw new Error(_0x36afa0(0x1d6)+_0x1fec64[_0x36afa0(0x155)]+',\x20body:\x20'+_0x20d765);}const _0x606556=await _0x1fec64[_0x36afa0(0x22c)]();loggerService_1[_0x36afa0(0x22f)][_0x36afa0(0x1b5)](_0x5e6f3a[_0x36afa0(0x190)]['toLowerCase'](),'/charge_raw',_0x1fec64['status'],_0x606556,_0x113568),console[_0x36afa0(0x210)](_0x36afa0(0x144));let _0x3a539b=_0x606556;if(_0x606556[_0x36afa0(0x14e)]&&_0x606556[_0x36afa0(0x218)]&&_0x606556['sign']){console[_0x36afa0(0x210)](_0x36afa0(0x1c1));try{const _0x1b326a=await this['decryptResponsePhp'](_0x606556[_0x36afa0(0x14e)],_0x606556[_0x36afa0(0x218)],_0x5e6f3a['cardType']);_0x3a539b=JSON[_0x36afa0(0x17a)](_0x1b326a),console[_0x36afa0(0x210)](_0x36afa0(0x17c)),loggerService_1[_0x36afa0(0x22f)][_0x36afa0(0x1b5)](_0x5e6f3a[_0x36afa0(0x190)][_0x36afa0(0x13d)](),_0x36afa0(0x12a),_0x1fec64[_0x36afa0(0x155)],_0x3a539b,_0x113568),console[_0x36afa0(0x210)](_0x36afa0(0x1a7));}catch(_0x46450c){console[_0x36afa0(0x25f)]('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x46450c),loggerService_1['loggerService'][_0x36afa0(0x1fe)](_0x5e6f3a[_0x36afa0(0x190)][_0x36afa0(0x13d)](),'/charge_decrypt','Decryption\x20failed:\x20'+_0x46450c),_0x3a539b=_0x606556;}}else loggerService_1[_0x36afa0(0x22f)][_0x36afa0(0x1b5)](_0x5e6f3a[_0x36afa0(0x190)]['toLowerCase'](),_0x36afa0(0x12a),_0x1fec64[_0x36afa0(0x155)],_0x3a539b,_0x113568),console[_0x36afa0(0x210)](_0x36afa0(0x27d));console[_0x36afa0(0x210)](_0x36afa0(0x1c3),_0x3a539b[_0x36afa0(0x155)]),console[_0x36afa0(0x210)](_0x36afa0(0x1c9),_0x3a539b[_0x36afa0(0x191)]),console['log']('Payment\x20ID:',_0x3a539b[_0x36afa0(0x165)]),console['log']('3DS\x20URL:',_0x3a539b['3ds_url']||_0x36afa0(0x14f));if(_0x3a539b['status']===0x64&&_0x3a539b[_0x36afa0(0x191)]===0x1)return console['log']('✅\x20Payment\x20successful'),{'gateway_payment_id':_0x3a539b[_0x36afa0(0x165)]?.[_0x36afa0(0x164)](),'payment_url':_0x595dcd,'requires_3ds':![],'status':_0x36afa0(0x135),'final':!![]};if(_0x3a539b[_0x36afa0(0x139)])return console['log'](_0x36afa0(0x213)),this['scheduleStatusChecks'](_0x3b68a7,_0x2b06b2,_0x3a539b[_0x36afa0(0x165)]?.[_0x36afa0(0x164)]()||_0x2b06b2,_0x5e6f3a[_0x36afa0(0x190)]),{'gateway_payment_id':_0x3a539b[_0x36afa0(0x165)]?.[_0x36afa0(0x164)](),'payment_url':_0x3a539b[_0x36afa0(0x139)],'requires_3ds':!![],'threeds_url':_0x3a539b[_0x36afa0(0x139)],'status':_0x36afa0(0x15d),'final':![]};let _0x59315a=this['getDetailedErrorMessage'](_0x3a539b[_0x36afa0(0x155)],_0x3a539b[_0x36afa0(0x1e2)]||_0x3a539b[_0x36afa0(0x251)]),_0x21c571=_0x3a539b[_0x36afa0(0x155)],_0x1a0166=this['isFinalStatus'](_0x3a539b[_0x36afa0(0x155)]);return console[_0x36afa0(0x210)](_0x36afa0(0x17b)+_0x21c571+_0x36afa0(0x154)+_0x1a0166+_0x36afa0(0x247)+_0x59315a),{'gateway_payment_id':_0x3a539b['payment_id']?.[_0x36afa0(0x164)](),'payment_url':_0x595dcd,'requires_3ds':![],'status':'FAILED','final':!![],'errorMessage':_0x59315a};}catch(_0x4cd026){console[_0x36afa0(0x25f)](_0x36afa0(0x15a)),console[_0x36afa0(0x25f)](_0x36afa0(0x1c0),_0x4cd026),loggerService_1[_0x36afa0(0x22f)][_0x36afa0(0x1fe)](_0x36afa0(0x162),_0x36afa0(0x1de),_0x4cd026);throw new Error('Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'+(_0x4cd026 instanceof Error?_0x4cd026['message']:'Unknown\x20error'));}}async[a51_0xd4e5ef(0x142)](_0x40040f,_0x570cf5,_0xd03bf8='VISA'){const _0x1a993a=a51_0xd4e5ef;console['log']('📊\x20Checking\x20'+_0xd03bf8+_0x1a993a(0x156)+_0x40040f+'\x20('+_0x570cf5+')');try{const _0x1ef1d5={'payment_id':_0x40040f,'order_id':_0x570cf5},_0x56036d=JSON[_0x1a993a(0x223)](_0x1ef1d5),_0xfd5f38=this[_0x1a993a(0x1e3)](_0xd03bf8===_0x1a993a(0x1a0)?_0x1a993a(0x233):'5000000000000000'),{key:_0x1144df,iv:_0x318439}=this[_0x1a993a(0x133)](),_0x476f05=this['encryptAES'](_0x56036d,_0x1144df,_0x318439),_0x53b6ab=this[_0x1a993a(0x171)](_0x1144df,_0x318439,_0xfd5f38[_0x1a993a(0x137)]),_0x11bf72=this['signRSA'](_0x56036d,_0xfd5f38[_0x1a993a(0x269)]),_0x10e300={'merchant_point_id':_0xfd5f38[_0x1a993a(0x1c4)],'method':_0x1a993a(0x155),'info':_0x476f05,'key':_0x53b6ab,'sign':_0x11bf72,'lang':'en'};loggerService_1[_0x1a993a(0x22f)][_0x1a993a(0x13c)](_0xd03bf8['toLowerCase'](),'/status',_0x1a993a(0x149),{'merchant_point_id':_0xfd5f38[_0x1a993a(0x1c4)],'method':_0x1a993a(0x155),'lang':'en'});const _0x305282=Date[_0x1a993a(0x212)](),_0x446bb2=await fetch(_0xfd5f38[_0x1a993a(0x1ab)],{'method':_0x1a993a(0x149),'headers':{'Content-Type':_0x1a993a(0x1ba),'Accept':_0x1a993a(0x1ba),'User-Agent':_0x1a993a(0x25a)},'body':JSON[_0x1a993a(0x223)](_0x10e300)}),_0x4ed88e=Date['now']()-_0x305282;if(!_0x446bb2['ok']){const _0x3025c3=await _0x446bb2['text']();loggerService_1['loggerService'][_0x1a993a(0x1b5)](_0xd03bf8[_0x1a993a(0x13d)](),_0x1a993a(0x289),_0x446bb2[_0x1a993a(0x155)],_0x3025c3,_0x4ed88e);throw new Error(_0x1a993a(0x1d6)+_0x446bb2[_0x1a993a(0x155)]);}const _0xe5f279=await _0x446bb2['json']();loggerService_1[_0x1a993a(0x22f)][_0x1a993a(0x1b5)](_0xd03bf8['toLowerCase'](),'/status_raw',_0x446bb2['status'],_0xe5f279,_0x4ed88e);let _0x14a3c4=_0xe5f279;if(_0xe5f279[_0x1a993a(0x14e)]&&_0xe5f279[_0x1a993a(0x218)]&&_0xe5f279[_0x1a993a(0x276)]){console[_0x1a993a(0x210)](_0x1a993a(0x12f));try{const _0x472d07=await this[_0x1a993a(0x199)](_0xe5f279[_0x1a993a(0x14e)],_0xe5f279[_0x1a993a(0x218)],_0xd03bf8);_0x14a3c4=JSON[_0x1a993a(0x17a)](_0x472d07),console[_0x1a993a(0x210)](_0x1a993a(0x215)),loggerService_1['loggerService'][_0x1a993a(0x1b5)](_0xd03bf8[_0x1a993a(0x13d)](),_0x1a993a(0x179),_0x446bb2[_0x1a993a(0x155)],_0x14a3c4,_0x4ed88e),console[_0x1a993a(0x210)](_0x1a993a(0x19a));}catch(_0x12c4d3){console[_0x1a993a(0x25f)](_0x1a993a(0x1d8),_0x12c4d3),loggerService_1['loggerService'][_0x1a993a(0x1fe)](_0xd03bf8['toLowerCase'](),'/status_decrypt',_0x1a993a(0x19b)+_0x12c4d3),_0x14a3c4=_0xe5f279;}}else loggerService_1[_0x1a993a(0x22f)]['logWhiteDomainResponse'](_0xd03bf8[_0x1a993a(0x13d)](),'/status_decrypted',_0x446bb2[_0x1a993a(0x155)],_0x14a3c4,_0x4ed88e),console[_0x1a993a(0x210)](_0x1a993a(0x24a));console['log'](_0x1a993a(0x248),{'status':_0x14a3c4[_0x1a993a(0x155)],'final':_0x14a3c4[_0x1a993a(0x191)],'payment_id':_0x14a3c4[_0x1a993a(0x165)],'desc':_0x14a3c4[_0x1a993a(0x1e2)]});let _0x398380='PENDING';if(_0x14a3c4[_0x1a993a(0x155)]===0x64&&_0x14a3c4[_0x1a993a(0x191)]===0x1)_0x398380=_0x1a993a(0x135);else{if(_0x14a3c4[_0x1a993a(0x191)]===0x0||!this[_0x1a993a(0x13b)](_0x14a3c4[_0x1a993a(0x155)]))_0x398380=_0x1a993a(0x15d);else _0x14a3c4[_0x1a993a(0x191)]===0x1||this['isFinalStatus'](_0x14a3c4[_0x1a993a(0x155)])?_0x398380=_0x1a993a(0x170):_0x398380=_0x1a993a(0x15d);}const _0x319b4d=this[_0x1a993a(0x18f)](_0x14a3c4[_0x1a993a(0x155)],_0x14a3c4[_0x1a993a(0x1e2)]);return{'status':_0x398380,'final':this[_0x1a993a(0x13b)](_0x14a3c4[_0x1a993a(0x155)]),'amount':_0x14a3c4[_0x1a993a(0x24f)],'currency':_0x14a3c4[_0x1a993a(0x1c7)],'date_success':_0x14a3c4[_0x1a993a(0x1eb)],'description':_0x319b4d};}catch(_0x53c43c){console[_0x1a993a(0x25f)](_0xd03bf8+_0x1a993a(0x151),_0x53c43c),loggerService_1['loggerService'][_0x1a993a(0x1fe)](_0xd03bf8[_0x1a993a(0x13d)](),_0x1a993a(0x1e1),_0x53c43c);throw new Error('Failed\x20to\x20check\x20'+_0xd03bf8+_0x1a993a(0x156)+(_0x53c43c instanceof Error?_0x53c43c[_0x1a993a(0x251)]:'Unknown\x20error'));}}['scheduleStatusChecks'](_0x5e0d7e,_0x29b6b9,_0x3fb6c1,_0x56998c){const _0x47e231=a51_0xd4e5ef;console[_0x47e231(0x210)](_0x47e231(0x1a5)+_0x56998c+_0x47e231(0x1bc)+_0x5e0d7e+'\x20('+_0x3fb6c1+')'),this[_0x47e231(0x1f3)](_0x5e0d7e);const _0x182b32=[],_0x5ca76b=0x5*0x3c*0x3e8,_0x339ccc=0x2*0x3c*0x3c*0x3e8,_0x3ad68d=Math['floor'](_0x339ccc/_0x5ca76b);console[_0x47e231(0x210)](_0x47e231(0x27c)+_0x3ad68d+_0x47e231(0x254));for(let _0x1da4bf=0x1;_0x1da4bf<=_0x3ad68d;_0x1da4bf++){const _0x2ed6fd=setTimeout(async()=>{const _0x3cf70d=_0x47e231;console[_0x3cf70d(0x210)](_0x3cf70d(0x235)+_0x56998c+_0x3cf70d(0x279)+_0x1da4bf+'/'+_0x3ad68d+_0x3cf70d(0x175)+_0x5e0d7e);try{const _0xaee9ab=await this[_0x3cf70d(0x142)](_0x3fb6c1,_0x29b6b9,_0x56998c);console[_0x3cf70d(0x210)](_0x3cf70d(0x288)+_0x1da4bf+_0x3cf70d(0x21b),_0xaee9ab),_0xaee9ab[_0x3cf70d(0x191)]&&(console[_0x3cf70d(0x210)](_0x3cf70d(0x270)+_0x5e0d7e+_0x3cf70d(0x20e)+_0xaee9ab[_0x3cf70d(0x155)]+_0x3cf70d(0x209)),this[_0x3cf70d(0x1f3)](_0x5e0d7e),await this['updatePaymentStatus'](_0x5e0d7e,_0xaee9ab[_0x3cf70d(0x155)],_0xaee9ab));}catch(_0x3fdce6){console['error'](_0x3cf70d(0x18d)+_0x1da4bf+_0x3cf70d(0x125)+_0x5e0d7e+':',_0x3fdce6);}},_0x1da4bf*_0x5ca76b);_0x182b32[_0x47e231(0x141)](_0x2ed6fd);}this[_0x47e231(0x15b)][_0x47e231(0x21e)](_0x5e0d7e,_0x182b32),console[_0x47e231(0x210)](_0x47e231(0x26d)+_0x3ad68d+_0x47e231(0x13f)+_0x5e0d7e);}[a51_0xd4e5ef(0x1f3)](_0x4340bd){const _0x47fb0b=a51_0xd4e5ef,_0x59e8f3=this[_0x47fb0b(0x15b)][_0x47fb0b(0x20a)](_0x4340bd);_0x59e8f3&&(console[_0x47fb0b(0x210)]('🧹\x20Clearing\x20'+_0x59e8f3['length']+'\x20status\x20timers\x20for\x20payment\x20'+_0x4340bd),_0x59e8f3[_0x47fb0b(0x1ee)]((_0x35458e,_0x3b64c7)=>{clearTimeout(_0x35458e);}),this[_0x47fb0b(0x15b)][_0x47fb0b(0x1b6)](_0x4340bd));}async['updatePaymentStatus'](_0x4503c5,_0x5f2667,_0x3921ff){const _0x18b656=a51_0xd4e5ef;try{const _0x58acaf=(await Promise[_0x18b656(0x1f6)]()[_0x18b656(0x160)](()=>__importStar(require('../../config/database'))))[_0x18b656(0x20d)],_0x46d6a1={'status':_0x5f2667[_0x18b656(0x261)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x5f2667===_0x18b656(0x135)&&(_0x46d6a1[_0x18b656(0x239)]=new Date()),_0x5f2667===_0x18b656(0x170)&&_0x3921ff[_0x18b656(0x16a)]&&(_0x46d6a1['failureMessage']=_0x3921ff['description'],console[_0x18b656(0x210)]('💾\x20Saving\x20failure\x20message:\x20'+_0x3921ff[_0x18b656(0x16a)])),_0x3921ff['description']&&(_0x46d6a1['adminNotes']=(_0x5f2667===_0x18b656(0x135)?'VISA/MasterCard\x20payment\x20successful':'VISA/MasterCard')+':\x20'+_0x3921ff[_0x18b656(0x16a)]),await _0x58acaf[_0x18b656(0x26e)][_0x18b656(0x1a9)]({'where':{'id':_0x4503c5},'data':_0x46d6a1}),console[_0x18b656(0x210)](_0x18b656(0x270)+_0x4503c5+'\x20status\x20updated\x20to\x20'+_0x5f2667),await this['sendPaymentNotifications'](_0x4503c5,_0x5f2667);}catch(_0x14021b){console['error'](_0x18b656(0x20b)+_0x4503c5+':',_0x14021b);}}async[a51_0xd4e5ef(0x1b0)](_0x482d90,_0x4e4102){const _0x5151ed=a51_0xd4e5ef;try{const _0x2764a6=(await Promise[_0x5151ed(0x1f6)]()[_0x5151ed(0x160)](()=>__importStar(require(_0x5151ed(0x201)))))[_0x5151ed(0x20d)],{telegramBotService:_0x569b48}=await Promise[_0x5151ed(0x1f6)]()[_0x5151ed(0x160)](()=>__importStar(require(_0x5151ed(0x152)))),_0xa13894=await _0x2764a6[_0x5151ed(0x26e)][_0x5151ed(0x1b3)]({'where':{'id':_0x482d90},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0xa13894)return;const _0x2a03e0={'PAID':_0x5151ed(0x1d1),'FAILED':'failed'},_0x1de755=_0x2a03e0[_0x4e4102];_0x1de755&&await _0x569b48[_0x5151ed(0x271)](_0xa13894[_0x5151ed(0x24b)],_0xa13894,_0x1de755),await this[_0x5151ed(0x19d)](_0xa13894,_0x4e4102);}catch(_0x11b743){console[_0x5151ed(0x25f)](_0x5151ed(0x178),_0x11b743);}}async[a51_0xd4e5ef(0x19d)](_0xee90c2,_0x40da62){const _0x5c31fb=a51_0xd4e5ef,_0x2bae7e=Date[_0x5c31fb(0x212)]();try{const _0x425c45=_0xee90c2['shop'],_0x431319=_0x425c45[_0x5c31fb(0x184)];if(!_0x431319?.['webhookUrl']){console['log'](_0x5c31fb(0x1b1)+_0x425c45['id']);return;}const _0xfdd692=_0x40da62===_0x5c31fb(0x135)?_0x5c31fb(0x258):_0x5c31fb(0x22b);let _0x58844b=[];if(_0x431319[_0x5c31fb(0x1ad)])try{_0x58844b=Array['isArray'](_0x431319[_0x5c31fb(0x1ad)])?_0x431319[_0x5c31fb(0x1ad)]:JSON[_0x5c31fb(0x17a)](_0x431319['webhookEvents']);}catch(_0x58b543){console['error'](_0x5c31fb(0x1e0),_0x58b543),_0x58844b=[];}if(!_0x58844b['includes'](_0xfdd692)){console[_0x5c31fb(0x210)](_0x5c31fb(0x131)+_0xfdd692+_0x5c31fb(0x12b)+_0x425c45['id']);return;}const _0x9c8293={'event':_0xfdd692,'payment':{'id':_0xee90c2['id'],'order_id':_0xee90c2[_0x5c31fb(0x177)],'gateway_order_id':_0xee90c2[_0x5c31fb(0x203)],'gateway':_0x5c31fb(0x226),'amount':_0xee90c2[_0x5c31fb(0x24f)],'currency':_0xee90c2[_0x5c31fb(0x1c7)],'status':_0x40da62[_0x5c31fb(0x13d)](),'customer_email':_0xee90c2[_0x5c31fb(0x153)],'customer_name':_0xee90c2['customerName'],'created_at':_0xee90c2[_0x5c31fb(0x16f)],'updated_at':new Date()}},_0x353180=await fetch(_0x431319['webhookUrl'],{'method':_0x5c31fb(0x149),'headers':{'Content-Type':_0x5c31fb(0x1ba),'User-Agent':_0x5c31fb(0x1b9)},'body':JSON[_0x5c31fb(0x223)](_0x9c8293)}),_0x2b95a4=Date[_0x5c31fb(0x212)]()-_0x2bae7e;loggerService_1[_0x5c31fb(0x22f)][_0x5c31fb(0x132)](_0xee90c2['shopId'],_0x431319['webhookUrl'],_0xfdd692,_0x353180['status'],_0x2b95a4,_0x9c8293),console['log']('MasterCard\x20webhook\x20sent\x20to\x20'+_0x431319[_0x5c31fb(0x1ef)]+_0x5c31fb(0x21c)+_0x353180[_0x5c31fb(0x155)]+'\x20('+_0x2b95a4+'ms)');}catch(_0x473fe5){console['error'](_0x5c31fb(0x1da),_0x473fe5),loggerService_1[_0x5c31fb(0x22f)][_0x5c31fb(0x1d9)](_0xee90c2[_0x5c31fb(0x24b)],_0xee90c2[_0x5c31fb(0x197)]?.[_0x5c31fb(0x184)]?.[_0x5c31fb(0x1ef)]||_0x5c31fb(0x220),_0x5c31fb(0x202),_0x473fe5,{});}}[a51_0xd4e5ef(0x1ae)](_0x1176a1){const _0xfce725=a51_0xd4e5ef,_0x491db5=_0x1176a1[_0xfce725(0x146)](/[\s-]/g,'');if(_0x491db5['length']<0x4)return _0xfce725(0x277);return'****\x20****\x20****\x20'+_0x491db5[_0xfce725(0x196)](-0x4);}async[a51_0xd4e5ef(0x23e)](_0xfd44ce,_0x445b34=a51_0xd4e5ef(0x130)){const _0x4a7580=a51_0xd4e5ef;console[_0x4a7580(0x210)](_0x4a7580(0x17e),JSON[_0x4a7580(0x223)](_0xfd44ce,null,0x2));let _0xea4f9e=_0xfd44ce,_0x365835=_0x445b34;_0xfd44ce[_0x4a7580(0x249)]?(_0x365835=_0xfd44ce['card_type'][_0x4a7580(0x261)]()===_0x4a7580(0x1a0)?'VISA':_0x4a7580(0x130),console[_0x4a7580(0x210)]('🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20'+_0x365835)):console[_0x4a7580(0x210)](_0x4a7580(0x143)+_0x365835);if(_0xfd44ce['info']&&_0xfd44ce[_0x4a7580(0x218)]&&_0xfd44ce[_0x4a7580(0x276)]){console[_0x4a7580(0x210)](_0x4a7580(0x1cb));try{const _0x277431=await this[_0x4a7580(0x199)](_0xfd44ce['info'],_0xfd44ce[_0x4a7580(0x218)],_0x365835);_0xea4f9e=JSON[_0x4a7580(0x17a)](_0x277431),console['log'](_0x4a7580(0x25d)),console[_0x4a7580(0x210)](_0x4a7580(0x166),JSON['stringify'](_0xea4f9e,null,0x2));}catch(_0x1a4027){console[_0x4a7580(0x25f)](_0x4a7580(0x189),_0x1a4027),console['log'](_0x4a7580(0x1b8)),_0xea4f9e=_0xfd44ce;}}else console[_0x4a7580(0x210)]('📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0x3624fd=_0x4a7580(0x15d);if(_0xea4f9e[_0x4a7580(0x155)]===0x64&&_0xea4f9e['final']===0x1)_0x3624fd=_0x4a7580(0x135);else{if(_0xea4f9e['final']===0x0||!this[_0x4a7580(0x13b)](_0xea4f9e[_0x4a7580(0x155)]))_0x3624fd=_0x4a7580(0x15d);else _0xea4f9e[_0x4a7580(0x191)]===0x1||this[_0x4a7580(0x13b)](_0xea4f9e['status'])?_0x3624fd=_0x4a7580(0x170):_0x3624fd=_0x4a7580(0x15d);}let _0x172626='';if(_0xea4f9e['order_id'])_0x172626=_0xea4f9e[_0x4a7580(0x1bf)]['toString'](),console['log']('🔍\x20Using\x20'+_0x365835+'\x20order_id\x20for\x20search:\x20'+_0x172626);else _0xea4f9e[_0x4a7580(0x165)]?(_0x172626=_0xea4f9e[_0x4a7580(0x165)][_0x4a7580(0x164)](),console['log'](_0x4a7580(0x1a2)+_0x365835+_0x4a7580(0x1f7)+_0x172626)):(_0x172626=_0xea4f9e[_0x4a7580(0x177)]||_0xea4f9e[_0x4a7580(0x1d5)]||_0xea4f9e['id']||'',console[_0x4a7580(0x210)]('🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20'+_0x172626));console[_0x4a7580(0x210)]('📊\x20'+_0x365835+'\x20webhook\x20extracted\x20data:'),console['log']('\x20\x20\x20Payment\x20ID:\x20'+_0x172626+_0x4a7580(0x173)+_0xea4f9e[_0x4a7580(0x1bf)]+_0x4a7580(0x255)+_0xea4f9e[_0x4a7580(0x177)]+_0x4a7580(0x1a3)+_0xea4f9e[_0x4a7580(0x165)]+_0x4a7580(0x13e)+_0xea4f9e[_0x4a7580(0x1d5)]+_0x4a7580(0x1f1)+_0xea4f9e['id']+')'),console['log'](_0x4a7580(0x150)+_0x3624fd+_0x4a7580(0x240)+_0xea4f9e[_0x4a7580(0x155)]+_0x4a7580(0x27b)+_0xea4f9e[_0x4a7580(0x191)]+')'),console[_0x4a7580(0x210)](_0x4a7580(0x1f8)+_0xea4f9e[_0x4a7580(0x24f)]),console[_0x4a7580(0x210)](_0x4a7580(0x17d)+_0xea4f9e[_0x4a7580(0x1c7)]);let _0x34eb85;_0x3624fd===_0x4a7580(0x170)&&(_0x34eb85=this[_0x4a7580(0x18f)](_0xea4f9e[_0x4a7580(0x155)],_0xea4f9e[_0x4a7580(0x1e2)]),console['log'](_0x4a7580(0x23d)+_0x34eb85));const _0x410938={'paymentId':_0x172626,'status':_0x3624fd,'amount':_0xea4f9e[_0x4a7580(0x24f)],'currency':_0xea4f9e[_0x4a7580(0x1c7)]};return _0x34eb85&&(_0x410938['errorMessage']=_0x34eb85),_0x410938;}[a51_0xd4e5ef(0x1c5)](){const _0x506ac8=a51_0xd4e5ef;console['log']('🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...');const _0x5cde45=this[_0x506ac8(0x15b)][_0x506ac8(0x193)];for(const [_0x1467d6]of this[_0x506ac8(0x15b)]){this[_0x506ac8(0x1f3)](_0x1467d6);}console[_0x506ac8(0x210)]('🛑\x20Stopped\x20'+_0x5cde45+_0x506ac8(0x284));}}exports[a51_0xd4e5ef(0x1e5)]=VisaMasterCardService;