'use strict';const a51_0xefc8bc=a51_0x502d;(function(_0x596338,_0x7648ab){const _0x16a9d7=a51_0x502d,_0x3667a8=_0x596338();while(!![]){try{const _0xde30d3=parseInt(_0x16a9d7(0xa5))/0x1+parseInt(_0x16a9d7(0x161))/0x2*(parseInt(_0x16a9d7(0x15d))/0x3)+-parseInt(_0x16a9d7(0xc3))/0x4*(-parseInt(_0x16a9d7(0xd5))/0x5)+parseInt(_0x16a9d7(0x17d))/0x6*(-parseInt(_0x16a9d7(0xb1))/0x7)+-parseInt(_0x16a9d7(0x15a))/0x8*(-parseInt(_0x16a9d7(0x89))/0x9)+-parseInt(_0x16a9d7(0x129))/0xa+-parseInt(_0x16a9d7(0xd7))/0xb;if(_0xde30d3===_0x7648ab)break;else _0x3667a8['push'](_0x3667a8['shift']());}catch(_0x117065){_0x3667a8['push'](_0x3667a8['shift']());}}}(a51_0x454b,0xf23d6));function a51_0x502d(_0x42a8bb,_0x103f41){const _0x454bce=a51_0x454b();return a51_0x502d=function(_0x502dfb,_0x3f7088){_0x502dfb=_0x502dfb-0x67;let _0x2ec4cc=_0x454bce[_0x502dfb];return _0x2ec4cc;},a51_0x502d(_0x42a8bb,_0x103f41);}var __createBinding=this&&this[a51_0xefc8bc(0xe9)]||(Object['create']?function(_0x1e3331,_0x201c19,_0x70a6de,_0x559f29){const _0x27467f=a51_0xefc8bc;if(_0x559f29===undefined)_0x559f29=_0x70a6de;var _0x2528b2=Object[_0x27467f(0x119)](_0x201c19,_0x70a6de);(!_0x2528b2||(_0x27467f(0x15e)in _0x2528b2?!_0x201c19[_0x27467f(0xe6)]:_0x2528b2['writable']||_0x2528b2[_0x27467f(0x135)]))&&(_0x2528b2={'enumerable':!![],'get':function(){return _0x201c19[_0x70a6de];}}),Object[_0x27467f(0xa9)](_0x1e3331,_0x559f29,_0x2528b2);}:function(_0x4d94f0,_0x5e2867,_0x3b06dd,_0x541c28){if(_0x541c28===undefined)_0x541c28=_0x3b06dd;_0x4d94f0[_0x541c28]=_0x5e2867[_0x3b06dd];}),__setModuleDefault=this&&this[a51_0xefc8bc(0x16e)]||(Object[a51_0xefc8bc(0xe0)]?function(_0x3991e1,_0x41768f){const _0x57620d=a51_0xefc8bc;Object[_0x57620d(0xa9)](_0x3991e1,_0x57620d(0xaa),{'enumerable':!![],'value':_0x41768f});}:function(_0x19f201,_0x20eefc){_0x19f201['default']=_0x20eefc;}),__importStar=this&&this[a51_0xefc8bc(0xde)]||(function(){var _0x15b632=function(_0x2ffc1b){const _0x5bfe05=a51_0x502d;return _0x15b632=Object[_0x5bfe05(0x15b)]||function(_0xdbdd2){const _0x578a6e=_0x5bfe05;var _0x58eebc=[];for(var _0x481983 in _0xdbdd2)if(Object[_0x578a6e(0x104)]['hasOwnProperty'][_0x578a6e(0xfd)](_0xdbdd2,_0x481983))_0x58eebc[_0x58eebc['length']]=_0x481983;return _0x58eebc;},_0x15b632(_0x2ffc1b);};return function(_0x513824){const _0x45759c=a51_0x502d;if(_0x513824&&_0x513824['__esModule'])return _0x513824;var _0x259661={};if(_0x513824!=null){for(var _0x2c0494=_0x15b632(_0x513824),_0x464ef9=0x0;_0x464ef9<_0x2c0494[_0x45759c(0xec)];_0x464ef9++)if(_0x2c0494[_0x464ef9]!=='default')__createBinding(_0x259661,_0x513824,_0x2c0494[_0x464ef9]);}return __setModuleDefault(_0x259661,_0x513824),_0x259661;};}()),__importDefault=this&&this[a51_0xefc8bc(0x132)]||function(_0x481ebf){const _0x71d08e=a51_0xefc8bc;return _0x481ebf&&_0x481ebf[_0x71d08e(0xe6)]?_0x481ebf:{'default':_0x481ebf};};Object[a51_0xefc8bc(0xa9)](exports,a51_0xefc8bc(0xe6),{'value':!![]}),exports[a51_0xefc8bc(0x14f)]=void 0x0;const crypto_1=__importDefault(require(a51_0xefc8bc(0xc0))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0xefc8bc(0x160))),loggerService_1=require('../loggerService');class VisaMasterCardService{constructor(){const _0x1138ae=a51_0xefc8bc;this['statusCheckTimers']=new Map(),this[_0x1138ae(0xd1)]={0x0:{'final':![],'description':_0x1138ae(0xa0)},0x1:{'final':![],'description':_0x1138ae(0xd8)},0x2:{'final':!![],'description':'Request\x20data\x20error'},0x3:{'final':!![],'description':'Another\x20unknown\x20error'},0x4:{'final':!![],'description':'Unsuccessful\x20payment'},0x5:{'final':!![],'description':_0x1138ae(0xd0)},0x6:{'final':!![],'description':_0x1138ae(0x19d)},0x7:{'final':!![],'description':_0x1138ae(0x188)},0x8:{'final':![],'description':'Client\x20OTP\x20confirmation\x20required'},0x9:{'final':![],'description':_0x1138ae(0x130)},0xa:{'final':![],'description':_0x1138ae(0x151)},0xb:{'final':![],'description':_0x1138ae(0x6e)},0xc:{'final':![],'description':_0x1138ae(0xaf)},0xd:{'final':![],'description':'Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number'},0xe:{'final':![],'description':_0x1138ae(0x121)},0xf:{'final':![],'description':_0x1138ae(0x181)},0x10:{'final':![],'description':_0x1138ae(0x100)},0x11:{'final':![],'description':_0x1138ae(0x9c)},0x12:{'final':![],'description':'Awaiting\x20confirmation\x20in\x20the\x20application'},0x13:{'final':![],'description':_0x1138ae(0xce)},0x14:{'final':![],'description':'The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender'},0x15:{'final':![],'description':_0x1138ae(0x1a4)},0x16:{'final':![],'description':'Payment\x20pending\x20verification'},0x18:{'final':![],'description':_0x1138ae(0x147)},0x19:{'final':![],'description':_0x1138ae(0x14a)},0x1a:{'final':!![],'description':'Cash\x20payment\x20is\x20expected\x20at\x20TCO'},0x1b:{'final':![],'description':_0x1138ae(0x9d)},0x1c:{'final':![],'description':_0x1138ae(0x6f)},0x1d:{'final':![],'description':_0x1138ae(0x7a)},0x1f:{'final':![],'description':_0x1138ae(0x16d)},0x20:{'final':![],'description':_0x1138ae(0xb9)},0x23:{'final':![],'description':_0x1138ae(0x1b4)},0x24:{'final':!![],'description':_0x1138ae(0x71)},0x25:{'final':!![],'description':'Payment\x20prohibited'},0x26:{'final':!![],'description':'The\x20payment\x20status\x20must\x20be\x20clarified\x20manually'},0x27:{'final':!![],'description':'Insufficient\x20funds\x20on\x20the\x20card'},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':_0x1138ae(0x1a6)},0x2a:{'final':!![],'description':'Invalid\x20expiration\x20date'},0x2b:{'final':!![],'description':_0x1138ae(0x19f)},0x2c:{'final':!![],'description':'The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank'},0x2d:{'final':!![],'description':_0x1138ae(0x1a9)},0x2e:{'final':!![],'description':_0x1138ae(0x1a8)},0x2f:{'final':!![],'description':_0x1138ae(0x1a8)},0x30:{'final':!![],'description':_0x1138ae(0x187)},0x31:{'final':![],'description':_0x1138ae(0x13e)},0x32:{'final':!![],'description':_0x1138ae(0x157)},0x33:{'final':!![],'description':_0x1138ae(0x1a9)},0x34:{'final':!![],'description':_0x1138ae(0x1a9)},0x35:{'final':!![],'description':_0x1138ae(0x1a9)},0x36:{'final':!![],'description':_0x1138ae(0x1a9)},0x37:{'final':!![],'description':_0x1138ae(0x1a9)},0x38:{'final':!![],'description':'Cancellation\x20is\x20not\x20possible'},0x39:{'final':![],'description':_0x1138ae(0x93)},0x3a:{'final':![],'description':'LookUp\x20code\x20sent'},0x3b:{'final':!![],'description':_0x1138ae(0x1b0)},0x3c:{'final':!![],'description':_0x1138ae(0x125)},0x3d:{'final':!![],'description':'Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible'},0x3e:{'final':!![],'description':_0x1138ae(0xf9)},0x3f:{'final':!![],'description':_0x1138ae(0x19d)},0x40:{'final':![],'description':_0x1138ae(0x17e)},0x41:{'final':!![],'description':'LookUp\x20number\x20of\x20attempts\x20exceeded'},0x42:{'final':![],'description':'Payment\x20cancellation\x20is\x20being\x20processed'},0x43:{'final':!![],'description':_0x1138ae(0xba)},0x44:{'final':![],'description':_0x1138ae(0x130)},0x45:{'final':!![],'description':_0x1138ae(0x1a9)},0x46:{'final':!![],'description':'Failed\x20payment'},0x47:{'final':!![],'description':'Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details'},0x64:{'final':!![],'description':_0x1138ae(0x123)}},this['masterCardApiUrl']=_0x1138ae(0x128),this[_0x1138ae(0x1af)]=0x6e4,this['privateKeyPath']=path_1['default']['join'](process[_0x1138ae(0x73)](),_0x1138ae(0x174),_0x1138ae(0xae)),this[_0x1138ae(0x107)]=path_1[_0x1138ae(0xaa)][_0x1138ae(0xc1)](process[_0x1138ae(0x73)](),_0x1138ae(0x174),'psp_public.pem'),this[_0x1138ae(0x155)]=_0x1138ae(0x128),this[_0x1138ae(0x6c)]=0x6b7,this['visaPrivateKeyPath']=path_1[_0x1138ae(0xaa)]['join'](process['cwd'](),_0x1138ae(0x174),_0x1138ae(0x180)),this['visaPublicKeyPath']=path_1[_0x1138ae(0xaa)]['join'](process[_0x1138ae(0x73)](),_0x1138ae(0x174),_0x1138ae(0x138)),console[_0x1138ae(0x198)](_0x1138ae(0x193)),console['log'](_0x1138ae(0x83),this['masterCardApiUrl']),console[_0x1138ae(0x198)](_0x1138ae(0xc4),this[_0x1138ae(0x155)]),console['log'](_0x1138ae(0xc8),this['privateKeyPath']),console[_0x1138ae(0x198)]('🔐\x20MasterCard\x20Public\x20key\x20path:',this[_0x1138ae(0x107)]),console['log']('🔐\x20VISA\x20Private\x20key\x20path:',this[_0x1138ae(0x1b3)]),console[_0x1138ae(0x198)](_0x1138ae(0xcb),this[_0x1138ae(0x1ac)]),this[_0x1138ae(0x146)]();}[a51_0xefc8bc(0x99)](_0x141f9b,_0x20ec65){const _0x308fda=a51_0xefc8bc,_0x41c538=this['paymentStatuses'][_0x141f9b];let _0x4b8f41='';_0x41c538?_0x4b8f41=_0x308fda(0xa8)+_0x141f9b+':\x20'+_0x41c538[_0x308fda(0x90)]:_0x4b8f41='Status\x20'+_0x141f9b+_0x308fda(0xc5);if(_0x20ec65&&_0x20ec65[_0x308fda(0x16a)]()){const _0x1f2902=_0x20ec65['trim']();(!_0x41c538||_0x1f2902['toLowerCase']()!==_0x41c538[_0x308fda(0x90)][_0x308fda(0x173)]())&&(_0x4b8f41+=_0x308fda(0x95)+_0x1f2902);}return _0x4b8f41;}[a51_0xefc8bc(0x118)](_0x28bc64){const _0x51a81f=a51_0xefc8bc,_0x381bce=this[_0x51a81f(0xd1)][_0x28bc64];return _0x381bce?_0x381bce[_0x51a81f(0x17c)]:!![];}['getCardTypeAndApi'](_0x5225fd){const _0x17e094=a51_0xefc8bc,_0x5337f0=_0x5225fd['charAt'](0x0);if(_0x5337f0==='4')return console['log'](_0x17e094(0x1a7)),{'cardType':_0x17e094(0xdb),'apiUrl':this['visaApiUrl'],'privateKeyPath':this['visaPrivateKeyPath'],'publicKeyPath':this[_0x17e094(0x1ac)],'merchantPointId':this[_0x17e094(0x6c)]};else return _0x5337f0==='5'?(console[_0x17e094(0x198)](_0x17e094(0x1b8)),{'cardType':'MASTERCARD','apiUrl':this[_0x17e094(0xc7)],'privateKeyPath':this[_0x17e094(0x120)],'publicKeyPath':this[_0x17e094(0x107)],'merchantPointId':this[_0x17e094(0x1af)]}):(console[_0x17e094(0x198)](_0x17e094(0x17f)+_0x5337f0+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':'MASTERCARD','apiUrl':this['masterCardApiUrl'],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x17e094(0x107)],'merchantPointId':this['masterCardMerchantPointId']});}[a51_0xefc8bc(0x146)](){const _0x42ef6d=a51_0xefc8bc;try{if(!fs_1[_0x42ef6d(0xaa)][_0x42ef6d(0x175)](this[_0x42ef6d(0x120)]))throw new Error(_0x42ef6d(0x94)+this['privateKeyPath']);if(!fs_1[_0x42ef6d(0xaa)][_0x42ef6d(0x175)](this[_0x42ef6d(0x107)]))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this['publicKeyPath']);const _0x41d0e2=fs_1['default']['readFileSync'](this[_0x42ef6d(0x120)],'utf8')['trim'](),_0x14b13f=fs_1['default'][_0x42ef6d(0xdd)](this['publicKeyPath'],_0x42ef6d(0x77))['trim']();if(!_0x41d0e2[_0x42ef6d(0x182)](_0x42ef6d(0x1a3))||!_0x41d0e2['includes'](_0x42ef6d(0x15c)))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x14b13f['includes'](_0x42ef6d(0x1a3))||!_0x14b13f['includes']('-----END'))throw new Error(_0x42ef6d(0x122));console['log']('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console[_0x42ef6d(0x198)](_0x42ef6d(0x79)+_0x41d0e2['length']+'\x20characters'),console['log']('🔐\x20MasterCard\x20Public\x20key\x20length:\x20'+_0x14b13f[_0x42ef6d(0xec)]+_0x42ef6d(0x6d));if(fs_1[_0x42ef6d(0xaa)][_0x42ef6d(0x175)](this[_0x42ef6d(0x1b3)])&&fs_1[_0x42ef6d(0xaa)][_0x42ef6d(0x175)](this[_0x42ef6d(0x1ac)])){const _0x73aba1=fs_1[_0x42ef6d(0xaa)][_0x42ef6d(0xdd)](this[_0x42ef6d(0x1b3)],_0x42ef6d(0x77))[_0x42ef6d(0x16a)](),_0xfbeea6=fs_1[_0x42ef6d(0xaa)][_0x42ef6d(0xdd)](this[_0x42ef6d(0x1ac)],'utf8')['trim']();(!_0x73aba1[_0x42ef6d(0x182)]('-----BEGIN')||!_0x73aba1[_0x42ef6d(0x182)]('-----END'))&&console[_0x42ef6d(0x14e)](_0x42ef6d(0xfe)),(!_0xfbeea6[_0x42ef6d(0x182)](_0x42ef6d(0x1a3))||!_0xfbeea6[_0x42ef6d(0x182)](_0x42ef6d(0x15c)))&&console['warn'](_0x42ef6d(0x1b2)),console[_0x42ef6d(0x198)](_0x42ef6d(0x1b1)),console['log'](_0x42ef6d(0xed)+_0x73aba1[_0x42ef6d(0xec)]+_0x42ef6d(0x6d)),console['log'](_0x42ef6d(0x1be)+_0xfbeea6[_0x42ef6d(0xec)]+'\x20characters');}else console[_0x42ef6d(0x14e)](_0x42ef6d(0xa2)),console[_0x42ef6d(0x14e)](_0x42ef6d(0x141)+this['visaPrivateKeyPath']),console['warn'](_0x42ef6d(0xd2)+this[_0x42ef6d(0x1ac)]);}catch(_0x1b799f){console['error'](_0x42ef6d(0x7e),_0x1b799f);throw _0x1b799f;}}[a51_0xefc8bc(0x84)](){const _0xb9ad22=a51_0xefc8bc,_0xd38e01=crypto_1[_0xb9ad22(0xaa)]['randomBytes'](0x20),_0x128c5f=crypto_1['default'][_0xb9ad22(0xf0)](0x10);return{'key':_0xd38e01,'iv':_0x128c5f};}[a51_0xefc8bc(0x7c)](_0x34eb01,_0x3f57c2,_0x370caf){const _0x59842d=a51_0xefc8bc,_0x2db675=crypto_1[_0x59842d(0xaa)]['createCipheriv'](_0x59842d(0x81),_0x3f57c2,_0x370caf);let _0x51676f=_0x2db675['update'](_0x34eb01,'utf8',_0x59842d(0x167));return _0x51676f+=_0x2db675[_0x59842d(0x17c)](_0x59842d(0x167)),_0x51676f;}[a51_0xefc8bc(0x19e)](_0x1ff95a,_0x3c4a46,_0xcabd61){const _0x32018a=a51_0xefc8bc;try{const _0x12f51b=fs_1[_0x32018a(0xaa)][_0x32018a(0xdd)](_0xcabd61,_0x32018a(0x77))[_0x32018a(0x16a)](),_0x3de770={'iv':_0x3c4a46['toString'](_0x32018a(0x167)),'key':_0x1ff95a['toString'](_0x32018a(0x167))},_0xb4b31f=JSON[_0x32018a(0x13c)](_0x3de770);console['log']('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0xb4b31f[_0x32018a(0xec)]);const _0x106263=crypto_1[_0x32018a(0xaa)]['publicEncrypt']({'key':_0x12f51b,'padding':crypto_1[_0x32018a(0xaa)][_0x32018a(0x13b)][_0x32018a(0x69)]},Buffer[_0x32018a(0x12a)](_0xb4b31f));return console[_0x32018a(0x198)](_0x32018a(0xdf),_0x106263[_0x32018a(0xec)]),_0x106263[_0x32018a(0xbb)](_0x32018a(0x167));}catch(_0x4e1d4e){console['error']('❌\x20RSA\x20encryption\x20failed:',_0x4e1d4e);throw new Error(_0x32018a(0x1b7));}}[a51_0xefc8bc(0xe1)](_0x5f6a4b,_0x2db47a){const _0x449cdd=a51_0xefc8bc;try{const _0x30646d=fs_1['default'][_0x449cdd(0xdd)](_0x2db47a,_0x449cdd(0x77))[_0x449cdd(0x16a)](),_0x2542f3=crypto_1[_0x449cdd(0xaa)][_0x449cdd(0x16f)](_0x449cdd(0x166));_0x2542f3[_0x449cdd(0xb2)](_0x5f6a4b),_0x2542f3[_0x449cdd(0x177)]();const _0x3f8b7a=_0x2542f3[_0x449cdd(0x91)](_0x30646d,_0x449cdd(0x167));return console[_0x449cdd(0x198)](_0x449cdd(0x163)),console[_0x449cdd(0x198)]('📝\x20Data\x20to\x20sign\x20length:',_0x5f6a4b[_0x449cdd(0xec)]),console[_0x449cdd(0x198)](_0x449cdd(0xa3),_0x3f8b7a['length']),_0x3f8b7a;}catch(_0x41b95){console['error'](_0x449cdd(0x7b),_0x41b95),console[_0x449cdd(0x87)](_0x449cdd(0x12d),_0x5f6a4b['substring'](0x0,0xc8)+_0x449cdd(0x80));throw new Error(_0x449cdd(0x139));}}[a51_0xefc8bc(0xdc)](_0x11cd43,_0x5126ee,_0x150ac5){const _0x4f44b5=a51_0xefc8bc,_0x442249=crypto_1[_0x4f44b5(0xaa)][_0x4f44b5(0x190)]('aes-256-ctr',_0x5126ee,_0x150ac5);let _0x1e88df=_0x442249[_0x4f44b5(0xb2)](_0x11cd43,_0x4f44b5(0x167),_0x4f44b5(0x77));return _0x1e88df+=_0x442249[_0x4f44b5(0x17c)](_0x4f44b5(0x77)),_0x1e88df;}async['decryptResponsePhp'](_0x54dff0,_0x474374,_0xc92c5d='MASTERCARD'){const _0x318cfd=a51_0xefc8bc;try{const _0x4dc381=await fetch(_0x318cfd(0x67),{'method':_0x318cfd(0xbc),'headers':{'Content-Type':'application/json'},'body':JSON[_0x318cfd(0x13c)]({'info':_0x54dff0,'key':_0x474374,'card_type':_0xc92c5d[_0x318cfd(0x173)]()})});if(!_0x4dc381['ok'])throw new Error(_0x318cfd(0x17b));return await _0x4dc381[_0x318cfd(0x15f)]();}catch(_0x388a64){console[_0x318cfd(0x87)]('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x388a64);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a51_0xefc8bc(0x8e)](_0x2e5813,_0x4d3187){const _0x36ae45=a51_0xefc8bc;try{const _0x35fa6a=fs_1[_0x36ae45(0xaa)][_0x36ae45(0xdd)](this['privateKeyPath'],'utf8')[_0x36ae45(0x16a)](),_0x42c2f2=crypto_1[_0x36ae45(0xaa)][_0x36ae45(0x10d)](_0x35fa6a,Buffer[_0x36ae45(0x12a)](_0x4d3187,_0x36ae45(0x167))),_0x5b819e=JSON[_0x36ae45(0xfc)](_0x42c2f2['toString']()),_0x4b434d=Buffer[_0x36ae45(0x12a)](_0x5b819e[_0x36ae45(0x1ad)],_0x36ae45(0x167)),_0xc0babb=Buffer[_0x36ae45(0x12a)](_0x5b819e['iv'],_0x36ae45(0x167));return this[_0x36ae45(0xdc)](_0x2e5813,_0x4b434d,_0xc0babb);}catch(_0x4e95b1){throw new Error(_0x36ae45(0xf2));}}async[a51_0xefc8bc(0x197)](_0x5cf616){const _0x4ad583=a51_0xefc8bc,{paymentId:_0x15b97f,orderId:_0x54c58b,amount:_0x57d683,currency:_0x5a3581,cardData:_0x5ae0cb,resultUrl:_0x48f035,returnUrl:_0x363635,cardHolder:_0x4c9b1e,browser:_0x17ec6a}=_0x5cf616;console[_0x4ad583(0x198)](_0x4ad583(0x133)),console[_0x4ad583(0x198)](_0x4ad583(0xf8),_0x15b97f),console[_0x4ad583(0x198)](_0x4ad583(0x109),_0x54c58b),console[_0x4ad583(0x198)](_0x4ad583(0xda),_0x57d683,_0x5a3581),console[_0x4ad583(0x198)](_0x4ad583(0x11d),this['maskCardNumber'](_0x5ae0cb[_0x4ad583(0x68)])),console['log']('Card\x20Holder:',_0x4c9b1e[_0x4ad583(0x86)]+'\x20'+_0x4c9b1e[_0x4ad583(0xef)]),console[_0x4ad583(0x198)](_0x4ad583(0x9f),_0x363635),console[_0x4ad583(0x198)](_0x4ad583(0x170),_0x48f035);const _0x4acff0=this[_0x4ad583(0xeb)](_0x5ae0cb[_0x4ad583(0x68)]);console[_0x4ad583(0x198)](_0x4ad583(0x18f)+_0x4acff0[_0x4ad583(0x16c)]+_0x4ad583(0xf5)+_0x4acff0[_0x4ad583(0x199)]),console[_0x4ad583(0x198)]('🔐\x20Using\x20keys:\x20'+_0x4acff0['privateKeyPath']+',\x20'+_0x4acff0[_0x4ad583(0x107)]);const _0x529404={..._0x4c9b1e,'first_name':_0x4c9b1e[_0x4ad583(0x86)]?.[_0x4ad583(0xb7)](/[\t\n\r\f\v]/g,'\x20')[_0x4ad583(0x16a)]()||'','last_name':_0x4c9b1e[_0x4ad583(0xef)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x4ad583(0x16a)]()||''};console[_0x4ad583(0x198)](_0x4ad583(0x17a)),console[_0x4ad583(0x198)](_0x4ad583(0x1aa)+_0x4c9b1e[_0x4ad583(0x86)]+_0x4ad583(0x92)+_0x4c9b1e[_0x4ad583(0xef)]+'\x22'),console[_0x4ad583(0x198)](_0x4ad583(0x74)+_0x529404['first_name']+_0x4ad583(0x92)+_0x529404[_0x4ad583(0xef)]+'\x22');const _0x18d44d={'amount':_0x57d683,'currency':_0x5a3581['toUpperCase'](),'order_id':_0x54c58b,'result_url':_0x48f035,'return_url':_0x363635,'country':'','card':{'number':_0x5ae0cb[_0x4ad583(0x68)],'expire_month':_0x5ae0cb['expire_month'],'expire_year':_0x5ae0cb[_0x4ad583(0xc9)],'cvv':_0x5ae0cb[_0x4ad583(0x82)]},'card_holder':_0x529404,'browser':_0x17ec6a},_0x486545=JSON[_0x4ad583(0x13c)](_0x18d44d);console['log'](_0x4ad583(0xca)),console['log'](_0x4ad583(0xbf)),console[_0x4ad583(0x198)](_0x486545),console[_0x4ad583(0x198)]('📝\x20Data\x20length:',_0x486545[_0x4ad583(0xec)]);try{const {key:_0x4368a8,iv:_0xc7d7e5}=this['generateAESKey']();console[_0x4ad583(0x198)](_0x4ad583(0xbd)),console[_0x4ad583(0x198)](_0x4ad583(0xf7),_0x4368a8[_0x4ad583(0xec)]),console[_0x4ad583(0x198)](_0x4ad583(0x110),_0xc7d7e5['length']);const _0x155a5c=this[_0x4ad583(0x7c)](_0x486545,_0x4368a8,_0xc7d7e5);console[_0x4ad583(0x198)](_0x4ad583(0x1bc)),console[_0x4ad583(0x198)](_0x4ad583(0xc6),_0x155a5c[_0x4ad583(0xec)]);const _0x481ac2=this[_0x4ad583(0x19e)](_0x4368a8,_0xc7d7e5,_0x4acff0[_0x4ad583(0x107)]);console[_0x4ad583(0x198)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x4ad583(0x198)](_0x4ad583(0xe5),_0x481ac2[_0x4ad583(0xec)]);const _0xe4d9f6=this[_0x4ad583(0xe1)](_0x486545,_0x4acff0[_0x4ad583(0x120)]);console[_0x4ad583(0x198)](_0x4ad583(0x124)),console['log']('📝\x20Signature\x20length:',_0xe4d9f6[_0x4ad583(0xec)]);const _0x249db8={'merchant_point_id':_0x4acff0[_0x4ad583(0x195)],'method':_0x4ad583(0x126),'info':_0x155a5c,'key':_0x481ac2,'sign':_0xe4d9f6,'lang':'en'};console[_0x4ad583(0x198)](_0x4ad583(0x145)),console['log'](_0x4ad583(0x184)),console[_0x4ad583(0x198)]('\x20\x20\x20-\x20merchant_point_id:',_0x4acff0[_0x4ad583(0x195)]),console['log']('\x20\x20\x20-\x20method:\x20charge'),console[_0x4ad583(0x198)](_0x4ad583(0x156),_0x155a5c[_0x4ad583(0xec)]),console['log'](_0x4ad583(0xe4),_0x481ac2['length']),console[_0x4ad583(0x198)](_0x4ad583(0x176),_0xe4d9f6[_0x4ad583(0xec)]),console[_0x4ad583(0x198)](_0x4ad583(0x11e)),loggerService_1[_0x4ad583(0x12e)]['logWhiteDomainRequest'](_0x4acff0[_0x4ad583(0x16c)][_0x4ad583(0x173)](),'/charge','POST',{'merchant_point_id':_0x4acff0['merchantPointId'],'method':_0x4ad583(0x126),'lang':'en'});const _0x4315bc=Date['now'](),_0x7c63fb=await fetch(_0x4acff0['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x4ad583(0x106),'Accept':_0x4ad583(0x106),'User-Agent':_0x4ad583(0xb5)},'body':JSON['stringify'](_0x249db8)}),_0x40453a=Date[_0x4ad583(0x159)]()-_0x4315bc;console[_0x4ad583(0x198)](_0x4ad583(0x98)),console[_0x4ad583(0x198)](_0x4ad583(0x162),_0x7c63fb[_0x4ad583(0x136)]),console[_0x4ad583(0x198)]('Response\x20Time:',_0x40453a+'ms');if(!_0x7c63fb['ok']){const _0x1774ea=await _0x7c63fb['text']();console['error'](_0x4ad583(0x16b),_0x7c63fb[_0x4ad583(0x136)]),console[_0x4ad583(0x87)](_0x4ad583(0x179),_0x1774ea),loggerService_1[_0x4ad583(0x12e)][_0x4ad583(0x115)](_0x4acff0[_0x4ad583(0x16c)][_0x4ad583(0x173)](),'/charge_raw',_0x7c63fb['status'],_0x1774ea,_0x40453a),loggerService_1[_0x4ad583(0x12e)]['logWhiteDomainError'](_0x4acff0[_0x4ad583(0x16c)]['toLowerCase'](),_0x4ad583(0x8f),_0x4ad583(0xcf)+_0x7c63fb['status']+':\x20'+_0x1774ea);throw new Error(_0x4ad583(0x19a)+_0x7c63fb[_0x4ad583(0x136)]+_0x4ad583(0xd6)+_0x1774ea);}const _0x2ccf49=await _0x7c63fb['json']();loggerService_1[_0x4ad583(0x12e)][_0x4ad583(0x115)](_0x4acff0['cardType']['toLowerCase'](),_0x4ad583(0x14d),_0x7c63fb['status'],_0x2ccf49,_0x40453a),console[_0x4ad583(0x198)](_0x4ad583(0x149));let _0x26cc75=_0x2ccf49;if(_0x2ccf49[_0x4ad583(0x13a)]&&_0x2ccf49['key']&&_0x2ccf49[_0x4ad583(0x91)]){console[_0x4ad583(0x198)](_0x4ad583(0x153));try{const _0x16c811=await this[_0x4ad583(0xff)](_0x2ccf49[_0x4ad583(0x13a)],_0x2ccf49['key'],_0x4acff0[_0x4ad583(0x16c)]);_0x26cc75=JSON['parse'](_0x16c811),console[_0x4ad583(0x198)](_0x4ad583(0xea)),loggerService_1[_0x4ad583(0x12e)][_0x4ad583(0x115)](_0x4acff0[_0x4ad583(0x16c)][_0x4ad583(0x173)](),_0x4ad583(0xfa),_0x7c63fb[_0x4ad583(0x136)],_0x26cc75,_0x40453a),console[_0x4ad583(0x198)](_0x4ad583(0x1bd));}catch(_0x12f1a5){console['error'](_0x4ad583(0x1a1),_0x12f1a5),loggerService_1['loggerService'][_0x4ad583(0x88)](_0x4acff0['cardType'][_0x4ad583(0x173)](),_0x4ad583(0x171),_0x4ad583(0xa4)+_0x12f1a5),_0x26cc75=_0x2ccf49;}}else loggerService_1[_0x4ad583(0x12e)][_0x4ad583(0x115)](_0x4acff0[_0x4ad583(0x16c)][_0x4ad583(0x173)](),_0x4ad583(0xfa),_0x7c63fb['status'],_0x26cc75,_0x40453a),console[_0x4ad583(0x198)](_0x4ad583(0x76));console['log'](_0x4ad583(0x162),_0x26cc75[_0x4ad583(0x136)]),console[_0x4ad583(0x198)](_0x4ad583(0x1bb),_0x26cc75[_0x4ad583(0x17c)]),console[_0x4ad583(0x198)](_0x4ad583(0xf8),_0x26cc75['payment_id']),console[_0x4ad583(0x198)]('3DS\x20URL:',_0x26cc75[_0x4ad583(0x7d)]||_0x4ad583(0x172));if(_0x26cc75['status']===0x64&&_0x26cc75[_0x4ad583(0x17c)]===0x1)return console[_0x4ad583(0x198)]('✅\x20Payment\x20successful'),{'gateway_payment_id':_0x26cc75[_0x4ad583(0x154)]?.['toString'](),'payment_url':_0x363635,'requires_3ds':![],'status':_0x4ad583(0x189),'final':!![]};if(_0x26cc75[_0x4ad583(0x7d)])return console[_0x4ad583(0x198)](_0x4ad583(0xf4)),this[_0x4ad583(0x10f)](_0x15b97f,_0x54c58b,_0x26cc75[_0x4ad583(0x154)]?.[_0x4ad583(0xbb)]()||_0x54c58b,_0x4acff0[_0x4ad583(0x16c)]),{'gateway_payment_id':_0x26cc75['payment_id']?.[_0x4ad583(0xbb)](),'payment_url':_0x26cc75[_0x4ad583(0x7d)],'requires_3ds':!![],'threeds_url':_0x26cc75['3ds_url'],'status':_0x4ad583(0x8c),'final':![]};let _0x2e921e=this[_0x4ad583(0x99)](_0x26cc75['status'],_0x26cc75['desc']||_0x26cc75[_0x4ad583(0x18c)]),_0x6fb827=_0x26cc75[_0x4ad583(0x136)],_0x5b3a85=this[_0x4ad583(0x118)](_0x26cc75[_0x4ad583(0x136)]);return console[_0x4ad583(0x198)](_0x4ad583(0x185)+_0x6fb827+',\x20Final:\x20'+_0x5b3a85+_0x4ad583(0xa1)+_0x2e921e),{'gateway_payment_id':_0x26cc75[_0x4ad583(0x154)]?.[_0x4ad583(0xbb)](),'payment_url':_0x363635,'requires_3ds':![],'status':_0x4ad583(0x7f),'final':!![],'errorMessage':_0x2e921e};}catch(_0x2ba4dc){console[_0x4ad583(0x87)](_0x4ad583(0xb0)),console[_0x4ad583(0x87)](_0x4ad583(0xa6),_0x2ba4dc),loggerService_1['loggerService'][_0x4ad583(0x88)](_0x4ad583(0x12b),_0x4ad583(0x8f),_0x2ba4dc);throw new Error(_0x4ad583(0xcd)+(_0x2ba4dc instanceof Error?_0x2ba4dc[_0x4ad583(0x18c)]:_0x4ad583(0x13d)));}}async[a51_0xefc8bc(0x18a)](_0x55882d,_0x5c1e6f,_0x206c0e=a51_0xefc8bc(0xdb)){const _0x574cfd=a51_0xefc8bc;console[_0x574cfd(0x198)](_0x574cfd(0x152)+_0x206c0e+'\x20payment\x20status:\x20'+_0x55882d+'\x20('+_0x5c1e6f+')');try{const _0x31dacd={'payment_id':_0x55882d,'order_id':_0x5c1e6f},_0x22b187=JSON[_0x574cfd(0x13c)](_0x31dacd),_0x10922a=this['getCardTypeAndApi'](_0x206c0e===_0x574cfd(0xdb)?_0x574cfd(0x78):_0x574cfd(0x18b)),{key:_0x37936f,iv:_0x356ff3}=this[_0x574cfd(0x84)](),_0x66dfae=this[_0x574cfd(0x7c)](_0x22b187,_0x37936f,_0x356ff3),_0x41ffc5=this[_0x574cfd(0x19e)](_0x37936f,_0x356ff3,_0x10922a[_0x574cfd(0x107)]),_0x36634d=this[_0x574cfd(0xe1)](_0x22b187,_0x10922a[_0x574cfd(0x120)]),_0x3dfd28={'merchant_point_id':_0x10922a[_0x574cfd(0x195)],'method':_0x574cfd(0x136),'info':_0x66dfae,'key':_0x41ffc5,'sign':_0x36634d,'lang':'en'};loggerService_1[_0x574cfd(0x12e)]['logWhiteDomainRequest'](_0x206c0e[_0x574cfd(0x173)](),_0x574cfd(0x191),_0x574cfd(0xbc),{'merchant_point_id':_0x10922a[_0x574cfd(0x195)],'method':_0x574cfd(0x136),'lang':'en'});const _0x6798da=Date[_0x574cfd(0x159)](),_0x4f610d=await fetch(_0x10922a[_0x574cfd(0x199)],{'method':_0x574cfd(0xbc),'headers':{'Content-Type':_0x574cfd(0x106),'Accept':_0x574cfd(0x106),'User-Agent':_0x574cfd(0xb5)},'body':JSON[_0x574cfd(0x13c)](_0x3dfd28)}),_0x3ac8a0=Date['now']()-_0x6798da;if(!_0x4f610d['ok']){const _0x26cd94=await _0x4f610d[_0x574cfd(0x15f)]();loggerService_1['loggerService'][_0x574cfd(0x115)](_0x206c0e[_0x574cfd(0x173)](),_0x574cfd(0x1bf),_0x4f610d['status'],_0x26cd94,_0x3ac8a0);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4f610d[_0x574cfd(0x136)]);}const _0x60bcab=await _0x4f610d['json']();loggerService_1[_0x574cfd(0x12e)][_0x574cfd(0x115)](_0x206c0e['toLowerCase'](),_0x574cfd(0x1bf),_0x4f610d[_0x574cfd(0x136)],_0x60bcab,_0x3ac8a0);let _0x126c85=_0x60bcab;if(_0x60bcab[_0x574cfd(0x13a)]&&_0x60bcab['key']&&_0x60bcab[_0x574cfd(0x91)]){console['log'](_0x574cfd(0x19b));try{const _0x1fa69f=await this['decryptResponsePhp'](_0x60bcab[_0x574cfd(0x13a)],_0x60bcab[_0x574cfd(0x1ad)],_0x206c0e);_0x126c85=JSON['parse'](_0x1fa69f),console['log']('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1['loggerService'][_0x574cfd(0x115)](_0x206c0e['toLowerCase'](),'/status_decrypted',_0x4f610d[_0x574cfd(0x136)],_0x126c85,_0x3ac8a0),console[_0x574cfd(0x198)](_0x574cfd(0x1b5));}catch(_0x4a4a93){console['error']('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x4a4a93),loggerService_1['loggerService']['logWhiteDomainError'](_0x206c0e[_0x574cfd(0x173)](),_0x574cfd(0x75),_0x574cfd(0x194)+_0x4a4a93),_0x126c85=_0x60bcab;}}else loggerService_1['loggerService']['logWhiteDomainResponse'](_0x206c0e[_0x574cfd(0x173)](),_0x574cfd(0x103),_0x4f610d['status'],_0x126c85,_0x3ac8a0),console[_0x574cfd(0x198)](_0x574cfd(0x143));console[_0x574cfd(0x198)](_0x574cfd(0x14c),{'status':_0x126c85[_0x574cfd(0x136)],'final':_0x126c85[_0x574cfd(0x17c)],'payment_id':_0x126c85[_0x574cfd(0x154)],'desc':_0x126c85[_0x574cfd(0x14b)]});let _0x1b5050=_0x574cfd(0x8c);if(_0x126c85[_0x574cfd(0x136)]===0x64&&_0x126c85[_0x574cfd(0x17c)]===0x1)_0x1b5050=_0x574cfd(0x189);else{if(_0x126c85[_0x574cfd(0x17c)]===0x0||!this[_0x574cfd(0x118)](_0x126c85[_0x574cfd(0x136)]))_0x1b5050=_0x574cfd(0x8c);else _0x126c85[_0x574cfd(0x17c)]===0x1||this[_0x574cfd(0x118)](_0x126c85[_0x574cfd(0x136)])?_0x1b5050=_0x574cfd(0x7f):_0x1b5050=_0x574cfd(0x8c);}const _0x1adfb1=this[_0x574cfd(0x99)](_0x126c85[_0x574cfd(0x136)],_0x126c85[_0x574cfd(0x14b)]);return{'status':_0x1b5050,'final':this[_0x574cfd(0x118)](_0x126c85['status']),'amount':_0x126c85[_0x574cfd(0x10c)],'currency':_0x126c85['currency'],'date_success':_0x126c85[_0x574cfd(0x9b)],'description':_0x1adfb1};}catch(_0x44c444){console[_0x574cfd(0x87)](_0x206c0e+_0x574cfd(0x144),_0x44c444),loggerService_1['loggerService']['logWhiteDomainError'](_0x206c0e['toLowerCase'](),_0x574cfd(0x191),_0x44c444);throw new Error(_0x574cfd(0xb8)+_0x206c0e+_0x574cfd(0x1ab)+(_0x44c444 instanceof Error?_0x44c444[_0x574cfd(0x18c)]:_0x574cfd(0x13d)));}}[a51_0xefc8bc(0x10f)](_0x53feeb,_0x2acadc,_0xae7dc4,_0x8a28fc){const _0x5e03f4=a51_0xefc8bc;console[_0x5e03f4(0x198)](_0x5e03f4(0xf6)+_0x8a28fc+'\x20payment:\x20'+_0x53feeb+'\x20('+_0xae7dc4+')'),this[_0x5e03f4(0x1a0)](_0x53feeb);const _0x409ba5=[],_0x58e1ad=0x5*0x3c*0x3e8,_0x5469af=0x2*0x3c*0x3c*0x3e8,_0xb7f8b6=Math['floor'](_0x5469af/_0x58e1ad);console[_0x5e03f4(0x198)]('⏰\x20Will\x20check\x20status\x20'+_0xb7f8b6+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x22c457=0x1;_0x22c457<=_0xb7f8b6;_0x22c457++){const _0x326515=setTimeout(async()=>{const _0x426ea6=_0x5e03f4;console['log']('🔍\x20'+_0x8a28fc+_0x426ea6(0x183)+_0x22c457+'/'+_0xb7f8b6+'\x20for\x20payment\x20'+_0x53feeb);try{const _0x3960d2=await this[_0x426ea6(0x18a)](_0xae7dc4,_0x2acadc,_0x8a28fc);console['log']('📊\x20Status\x20check\x20#'+_0x22c457+_0x426ea6(0x1a2),_0x3960d2),_0x3960d2[_0x426ea6(0x17c)]&&(console[_0x426ea6(0x198)](_0x426ea6(0xb6)+_0x53feeb+_0x426ea6(0x9a)+_0x3960d2[_0x426ea6(0x136)]+'),\x20stopping\x20status\x20checks'),this['clearStatusTimers'](_0x53feeb),await this[_0x426ea6(0xd4)](_0x53feeb,_0x3960d2['status'],_0x3960d2));}catch(_0xb8302c){console[_0x426ea6(0x87)](_0x426ea6(0x165)+_0x22c457+'\x20failed\x20for\x20payment\x20'+_0x53feeb+':',_0xb8302c);}},_0x22c457*_0x58e1ad);_0x409ba5[_0x5e03f4(0xad)](_0x326515);}this['statusCheckTimers'][_0x5e03f4(0x19c)](_0x53feeb,_0x409ba5),console['log'](_0x5e03f4(0x1a5)+_0xb7f8b6+_0x5e03f4(0x168)+_0x53feeb);}[a51_0xefc8bc(0x1a0)](_0x17d14b){const _0x5b44e2=a51_0xefc8bc,_0x3d4715=this[_0x5b44e2(0x111)]['get'](_0x17d14b);_0x3d4715&&(console[_0x5b44e2(0x198)](_0x5b44e2(0x85)+_0x3d4715[_0x5b44e2(0xec)]+_0x5b44e2(0x8a)+_0x17d14b),_0x3d4715[_0x5b44e2(0xbe)]((_0x188353,_0x4971f9)=>{clearTimeout(_0x188353);}),this['statusCheckTimers'][_0x5b44e2(0x134)](_0x17d14b));}async[a51_0xefc8bc(0xd4)](_0x4e1fd6,_0x3dd218,_0x3f7c94){const _0x3dcce5=a51_0xefc8bc;try{const _0x24f314=(await Promise[_0x3dcce5(0x10a)]()[_0x3dcce5(0x18e)](()=>__importStar(require('../../config/database'))))[_0x3dcce5(0xaa)],_0x2265f0={'status':_0x3dd218['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x3dd218===_0x3dcce5(0x189)&&(_0x2265f0['paidAt']=new Date()),_0x3dd218===_0x3dcce5(0x7f)&&_0x3f7c94['description']&&(_0x2265f0[_0x3dcce5(0xab)]=_0x3f7c94[_0x3dcce5(0x90)],console[_0x3dcce5(0x198)](_0x3dcce5(0x105)+_0x3f7c94[_0x3dcce5(0x90)])),_0x3f7c94[_0x3dcce5(0x90)]&&(_0x2265f0[_0x3dcce5(0x112)]=(_0x3dd218===_0x3dcce5(0x189)?_0x3dcce5(0x186):'VISA/MasterCard')+':\x20'+_0x3f7c94['description']),await _0x24f314['payment']['update']({'where':{'id':_0x4e1fd6},'data':_0x2265f0}),console[_0x3dcce5(0x198)]('✅\x20Payment\x20'+_0x4e1fd6+_0x3dcce5(0xb4)+_0x3dd218),await this[_0x3dcce5(0x116)](_0x4e1fd6,_0x3dd218);}catch(_0x4cc6d8){console[_0x3dcce5(0x87)]('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x4e1fd6+':',_0x4cc6d8);}}async[a51_0xefc8bc(0x116)](_0x487114,_0x5b1f99){const _0x401af2=a51_0xefc8bc;try{const _0x25294b=(await Promise[_0x401af2(0x10a)]()['then'](()=>__importStar(require(_0x401af2(0x1b9)))))['default'],{telegramBotService:_0x59f155}=await Promise[_0x401af2(0x10a)]()[_0x401af2(0x18e)](()=>__importStar(require('../telegramBotService'))),_0x4fd513=await _0x25294b['payment']['findUnique']({'where':{'id':_0x487114},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x4fd513)return;const _0x5b2877={'PAID':_0x401af2(0xd3),'FAILED':_0x401af2(0x8d)},_0x3f38a0=_0x5b2877[_0x5b1f99];_0x3f38a0&&await _0x59f155[_0x401af2(0x12f)](_0x4fd513[_0x401af2(0x131)],_0x4fd513,_0x3f38a0),await this[_0x401af2(0xf3)](_0x4fd513,_0x5b1f99);}catch(_0x3b70e4){console[_0x401af2(0x87)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x3b70e4);}}async['sendShopWebhook'](_0x290052,_0x292634){const _0x434e4a=a51_0xefc8bc,_0x4693c0=Date['now']();try{const _0x3c29df=_0x290052['shop'],_0x939831=_0x3c29df[_0x434e4a(0xe3)];if(!_0x939831?.['webhookUrl']){console[_0x434e4a(0x198)](_0x434e4a(0x137)+_0x3c29df['id']);return;}const _0x521319=_0x292634==='PAID'?_0x434e4a(0x1c0):_0x434e4a(0x8b);let _0x405781=[];if(_0x939831['webhookEvents'])try{_0x405781=Array[_0x434e4a(0x1ba)](_0x939831[_0x434e4a(0x13f)])?_0x939831[_0x434e4a(0x13f)]:JSON[_0x434e4a(0xfc)](_0x939831['webhookEvents']);}catch(_0x417a08){console[_0x434e4a(0x87)]('Error\x20parsing\x20webhook\x20events:',_0x417a08),_0x405781=[];}if(!_0x405781['includes'](_0x521319)){console[_0x434e4a(0x198)](_0x434e4a(0xe7)+_0x521319+_0x434e4a(0x97)+_0x3c29df['id']);return;}const _0x1e434d={'event':_0x521319,'payment':{'id':_0x290052['id'],'order_id':_0x290052[_0x434e4a(0xe8)],'gateway_order_id':_0x290052[_0x434e4a(0x70)],'gateway':_0x434e4a(0x6a),'amount':_0x290052[_0x434e4a(0x10c)],'currency':_0x290052[_0x434e4a(0x108)],'status':_0x292634[_0x434e4a(0x173)](),'customer_email':_0x290052[_0x434e4a(0x148)],'customer_name':_0x290052[_0x434e4a(0xc2)],'created_at':_0x290052[_0x434e4a(0x142)],'updated_at':new Date()}},_0x53279e=await fetch(_0x939831['webhookUrl'],{'method':'POST','headers':{'Content-Type':_0x434e4a(0x106),'User-Agent':'Payment\x20System/1.0\x20(MasterCard)'},'body':JSON[_0x434e4a(0x13c)](_0x1e434d)}),_0x55ccb0=Date[_0x434e4a(0x159)]()-_0x4693c0;loggerService_1[_0x434e4a(0x12e)][_0x434e4a(0xe2)](_0x290052[_0x434e4a(0x131)],_0x939831[_0x434e4a(0x9e)],_0x521319,_0x53279e[_0x434e4a(0x136)],_0x55ccb0,_0x1e434d),console[_0x434e4a(0x198)](_0x434e4a(0x127)+_0x939831[_0x434e4a(0x9e)]+_0x434e4a(0x11f)+_0x53279e[_0x434e4a(0x136)]+'\x20('+_0x55ccb0+_0x434e4a(0x1ae));}catch(_0x179ecf){console[_0x434e4a(0x87)](_0x434e4a(0x192),_0x179ecf),loggerService_1['loggerService'][_0x434e4a(0x18d)](_0x290052[_0x434e4a(0x131)],_0x290052[_0x434e4a(0x178)]?.['settings']?.['webhookUrl']||'unknown',_0x434e4a(0x140),_0x179ecf,{});}}['maskCardNumber'](_0x2b5bf3){const _0x1f2c81=a51_0xefc8bc,_0x28a1d5=_0x2b5bf3[_0x1f2c81(0xb7)](/[\s-]/g,'');if(_0x28a1d5['length']<0x4)return'****';return _0x1f2c81(0xac)+_0x28a1d5[_0x1f2c81(0xfb)](-0x4);}async[a51_0xefc8bc(0x164)](_0x165a3f,_0x28cf14='MASTERCARD'){const _0x37fc99=a51_0xefc8bc;console[_0x37fc99(0x198)]('🔄\x20Processing\x20MasterCard\x20webhook\x20data:',JSON[_0x37fc99(0x13c)](_0x165a3f,null,0x2));let _0x1c666e=_0x165a3f,_0x12aac0=_0x28cf14;_0x165a3f[_0x37fc99(0x1b6)]?(_0x12aac0=_0x165a3f[_0x37fc99(0x1b6)][_0x37fc99(0x96)]()===_0x37fc99(0xdb)?_0x37fc99(0xdb):'MASTERCARD',console[_0x37fc99(0x198)](_0x37fc99(0x114)+_0x12aac0)):console[_0x37fc99(0x198)](_0x37fc99(0xcc)+_0x12aac0);if(_0x165a3f[_0x37fc99(0x13a)]&&_0x165a3f[_0x37fc99(0x1ad)]&&_0x165a3f[_0x37fc99(0x91)]){console[_0x37fc99(0x198)](_0x37fc99(0x196));try{const _0x5b7bde=await this[_0x37fc99(0xff)](_0x165a3f[_0x37fc99(0x13a)],_0x165a3f[_0x37fc99(0x1ad)],_0x12aac0);_0x1c666e=JSON[_0x37fc99(0xfc)](_0x5b7bde),console[_0x37fc99(0x198)]('✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP'),console[_0x37fc99(0x198)](_0x37fc99(0xee),JSON[_0x37fc99(0x13c)](_0x1c666e,null,0x2));}catch(_0x128f9b){console[_0x37fc99(0x87)](_0x37fc99(0x72),_0x128f9b),console['log']('⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted'),_0x1c666e=_0x165a3f;}}else console['log'](_0x37fc99(0x6b));let _0x3cae35=_0x37fc99(0x8c);if(_0x1c666e[_0x37fc99(0x136)]===0x64&&_0x1c666e[_0x37fc99(0x17c)]===0x1)_0x3cae35=_0x37fc99(0x189);else{if(_0x1c666e[_0x37fc99(0x17c)]===0x0||!this[_0x37fc99(0x118)](_0x1c666e[_0x37fc99(0x136)]))_0x3cae35='PENDING';else _0x1c666e[_0x37fc99(0x17c)]===0x1||this['isFinalStatus'](_0x1c666e['status'])?_0x3cae35=_0x37fc99(0x7f):_0x3cae35=_0x37fc99(0x8c);}let _0x2700f6='';if(_0x1c666e['order_id'])_0x2700f6=_0x1c666e[_0x37fc99(0x10b)]['toString'](),console['log']('🔍\x20Using\x20'+_0x12aac0+_0x37fc99(0x158)+_0x2700f6);else _0x1c666e[_0x37fc99(0x154)]?(_0x2700f6=_0x1c666e[_0x37fc99(0x154)][_0x37fc99(0xbb)](),console[_0x37fc99(0x198)](_0x37fc99(0xa7)+_0x12aac0+_0x37fc99(0x11a)+_0x2700f6)):(_0x2700f6=_0x1c666e['orderId']||_0x1c666e[_0x37fc99(0x113)]||_0x1c666e['id']||'',console['log'](_0x37fc99(0x10e)+_0x2700f6));console[_0x37fc99(0x198)]('📊\x20'+_0x12aac0+'\x20webhook\x20extracted\x20data:'),console[_0x37fc99(0x198)]('\x20\x20\x20Payment\x20ID:\x20'+_0x2700f6+_0x37fc99(0x12c)+_0x1c666e[_0x37fc99(0x10b)]+',\x20orderId='+_0x1c666e[_0x37fc99(0xe8)]+',\x20payment_id='+_0x1c666e[_0x37fc99(0x154)]+_0x37fc99(0x169)+_0x1c666e[_0x37fc99(0x113)]+_0x37fc99(0x117)+_0x1c666e['id']+')'),console[_0x37fc99(0x198)](_0x37fc99(0x101)+_0x3cae35+'\x20(from:\x20status='+_0x1c666e[_0x37fc99(0x136)]+_0x37fc99(0xf1)+_0x1c666e[_0x37fc99(0x17c)]+')'),console[_0x37fc99(0x198)]('\x20\x20\x20Amount:\x20'+_0x1c666e['amount']),console['log']('\x20\x20\x20Currency:\x20'+_0x1c666e[_0x37fc99(0x108)]);let _0x164f97;_0x3cae35==='FAILED'&&(_0x164f97=this[_0x37fc99(0x99)](_0x1c666e['status'],_0x1c666e[_0x37fc99(0x14b)]),console[_0x37fc99(0x198)](_0x37fc99(0xd9)+_0x164f97));const _0x3bf92f={'paymentId':_0x2700f6,'status':_0x3cae35,'amount':_0x1c666e['amount'],'currency':_0x1c666e[_0x37fc99(0x108)]};return _0x164f97&&(_0x3bf92f[_0x37fc99(0x11b)]=_0x164f97),_0x3bf92f;}[a51_0xefc8bc(0x11c)](){const _0x4cdc23=a51_0xefc8bc;console[_0x4cdc23(0x198)](_0x4cdc23(0xb3));const _0x3746da=this[_0x4cdc23(0x111)]['size'];for(const [_0x5406a2]of this[_0x4cdc23(0x111)]){this['clearStatusTimers'](_0x5406a2);}console[_0x4cdc23(0x198)](_0x4cdc23(0x102)+_0x3746da+_0x4cdc23(0x150));}}function a51_0x454b(){const _0x458e80=['shopId','__importDefault','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','delete','configurable','status','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','visa_public.pem','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','info','constants','stringify','Unknown\x20error','Payment\x20confirmation\x20required','webhookEvents','webhook_send','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','createdAt','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','\x20status\x20check\x20error:','📤\x20Sending\x20request\x20to\x20API...','validateKeyFiles','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','customerEmail','===\x20PARSED\x20API\x20RESPONSE\x20===','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','desc','📊\x20Status\x20check\x20result:','/charge_raw','warn','VisaMasterCardService','\x20MasterCard\x20status\x20check\x20timers','Sender\x27s\x20CVV\x20card\x20is\x20required','📊\x20Checking\x20','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','payment_id','visaApiUrl','\x20\x20\x20-\x20info\x20length:','Method\x20not\x20allowed','\x20order_id\x20for\x20search:\x20','now','1192bfPyMe','getOwnPropertyNames','-----END','1177989fAUMTS','get','text','path','4AyAWcB','Status:','🔐\x20RSA\x20signing\x20successful','processWebhook','❌\x20Status\x20check\x20#','SHA256','base64','\x20status\x20checks\x20for\x20payment\x20',',\x20paymentId=','trim','HTTP\x20Status:','cardType','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','__setModuleDefault','createSign','Result\x20URL:','/charge_decrypt','none','toLowerCase','keys','existsSync','\x20\x20\x20-\x20sign\x20length:','end','shop','Response\x20Body:','🧹\x20Card\x20holder\x20names\x20cleaned:','PHP\x20decryptor\x20error','final','11761476lfzTOS','LookUp\x20not\x20confirmed','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','visa_private.pem','PIN\x20code\x20confirmation\x20awaited','includes','\x20status\x20check\x20#','📝\x20Final\x20request\x20structure:','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','VISA/MasterCard\x20payment\x20successful','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','Test\x20payment','PAID','checkPaymentStatus','5000000000000000','message','logShopWebhookError','then','🎯\x20Using\x20','createDecipheriv','/status','Failed\x20to\x20send\x20MasterCard\x20webhook:','💳\x20VISA/MasterCard\x20service\x20initialized','Status\x20decryption\x20failed:\x20','merchantPointId','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','processCardPayment','log','apiUrl','HTTP\x20error!\x20status:\x20','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','set','Payment\x20returned','encryptRSA','Transaction\x20limit\x20exceeded','clearStatusTimers','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','\x20result:','-----BEGIN','Expected\x20bitcoin\x20transfer\x20from\x20client','✅\x20Scheduled\x20','The\x20card\x20is\x20lost\x20or\x20stolen','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','Unsuccessful\x20payment','Failed\x20payment','\x20\x20Original:\x20\x22','\x20payment\x20status:\x20','visaPublicKeyPath','key','ms)','masterCardMerchantPointId','LookUp\x20code\x20verified','✅\x20VISA\x20key\x20files\x20validated\x20successfully','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','visaPrivateKeyPath','Sender\x27s\x20card\x20details\x20are\x20required','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','card_type','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','../../config/database','isArray','Final:','🔐\x20Data\x20encrypted\x20with\x20AES','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','🔐\x20VISA\x20Public\x20key\x20length:\x20','/status_raw','payment.success','https://api2.trapay.uk/decrypt.php','number','RSA_PKCS1_PADDING','1111','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','visaMerchantPointId','\x20characters','Sender\x20information\x20required','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','gatewayOrderId','Payment\x20confirmation\x20time\x20has\x20expired','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','cwd','\x20\x20Cleaned:\x20\x20\x22','/status_decrypt','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','utf8','4000000000000000','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','❌\x20RSA\x20signing\x20failed:','encryptAES','3ds_url','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','FAILED','...','aes-256-ctr','cvv','🔐\x20MasterCard\x20API\x20URL:','generateAESKey','🧹\x20Clearing\x20','first_name','error','logWhiteDomainError','39753NJqJsD','\x20status\x20timers\x20for\x20payment\x20','payment.failed','PENDING','failed','decryptResponse','/charge','description','sign','\x22\x20|\x20\x22','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','\x20|\x20Response:\x20','toUpperCase','\x20not\x20enabled\x20for\x20shop\x20','===\x20API\x20RESPONSE\x20===','getDetailedErrorMessage','\x20is\x20final\x20(','date_success','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','webhookUrl','Return\x20URL:','No\x20New\x20payment',',\x20Desc:\x20','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','📝\x20Signature\x20length:','Decryption\x20failed:\x20','1828035rljLbU','Error\x20details:','🔍\x20Using\x20','Status\x20','defineProperty','default','failureMessage','****\x20****\x20****\x20','push','private.pem','Recipient\x20data\x20required','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','7xwrMHp','update','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','\x20status\x20updated\x20to\x20','Payment\x20System/1.0','✅\x20Payment\x20','replace','Failed\x20to\x20check\x20','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','toString','POST','🔐\x20AES\x20key\x20and\x20IV\x20generated','forEach','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','crypto','join','customerName','32RQtMhh','🔐\x20VISA\x20API\x20URL:',':\x20Unknown\x20status\x20code','📝\x20Encrypted\x20data\x20length:','masterCardApiUrl','🔐\x20MasterCard\x20Private\x20key\x20path:','expire_year','💾\x20Payment\x20data\x20prepared','🔐\x20VISA\x20Public\x20key\x20path:','🔍\x20Using\x20provided\x20card\x20type:\x20','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','Payment\x20is\x20being\x20processed','HTTP\x20','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','paymentStatuses','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','paid','updatePaymentStatus','196495uVYsUL',',\x20body:\x20','1384174JHvDvW','No\x20Error\x20executing\x20request','❌\x20Detailed\x20failure\x20description:\x20','Amount:','VISA','decryptAES','readFileSync','__importStar','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','create','signRSA','logShopWebhookSent','settings','\x20\x20\x20-\x20key\x20length:','📝\x20Encrypted\x20key\x20length:','__esModule','Webhook\x20event\x20','orderId','__createBinding','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','getCardTypeAndApi','length','🔐\x20VISA\x20Private\x20key\x20length:\x20','📝\x20Decrypted\x20webhook\x20data:','last_name','randomBytes',',\x20final=','Failed\x20to\x20decrypt\x20response','sendShopWebhook','🔐\x203DS\x20verification\x20required','\x20API:\x20','⏰\x20Scheduling\x20status\x20checks\x20for\x20','🔐\x20AES\x20key\x20length:','Payment\x20ID:','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','/charge_decrypted','slice','parse','call','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','decryptResponsePhp','Captcha\x20confirmation\x20awaited','\x20\x20\x20Status:\x20','🛑\x20Stopped\x20','/status_decrypted','prototype','💾\x20Saving\x20failure\x20message:\x20','application/json','publicKeyPath','currency','Order\x20ID:','resolve','order_id','amount','privateDecrypt','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','scheduleStatusChecks','🔐\x20AES\x20IV\x20length:','statusCheckTimers','adminNotes','paymentId','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','logWhiteDomainResponse','sendPaymentNotifications',',\x20id=','isFinalStatus','getOwnPropertyDescriptor','\x20payment_id\x20for\x20search:\x20','errorMessage','stopAllStatusChecks','Card\x20Number:','\x20\x20\x20-\x20lang:\x20en','\x20with\x20status\x20','privateKeyPath','Awaiting\x20confirmation\x20by\x20ivr\x20call','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Operation\x20completed\x20successfully','🔐\x20Data\x20signed\x20with\x20RSA','Number\x20of\x20attempts\x20exceeded','charge','MasterCard\x20webhook\x20sent\x20to\x20','https://api.paydmeth.com/api','5075920aQEbVv','from','visa/mastercard','\x20(from:\x20order_id=','❌\x20Data\x20being\x20signed:','loggerService','sendPaymentNotification','3DS\x20verification\x20required'];a51_0x454b=function(){return _0x458e80;};return a51_0x454b();}exports['VisaMasterCardService']=VisaMasterCardService;