'use strict';const a42_0xe94280=a42_0x55c2;(function(_0x19139e,_0xee9cb4){const _0x185f3a=a42_0x55c2,_0x308366=_0x19139e();while(!![]){try{const _0x81f8f=parseInt(_0x185f3a(0x185))/0x1*(parseInt(_0x185f3a(0x11d))/0x2)+-parseInt(_0x185f3a(0x101))/0x3*(-parseInt(_0x185f3a(0xc4))/0x4)+-parseInt(_0x185f3a(0x10e))/0x5+-parseInt(_0x185f3a(0xe3))/0x6*(-parseInt(_0x185f3a(0xd9))/0x7)+-parseInt(_0x185f3a(0x127))/0x8*(parseInt(_0x185f3a(0x114))/0x9)+parseInt(_0x185f3a(0xb9))/0xa+-parseInt(_0x185f3a(0xc5))/0xb*(parseInt(_0x185f3a(0xaf))/0xc);if(_0x81f8f===_0xee9cb4)break;else _0x308366['push'](_0x308366['shift']());}catch(_0x54b38a){_0x308366['push'](_0x308366['shift']());}}}(a42_0x1725,0x233c6));function a42_0x55c2(_0x2bed88,_0x2f2097){const _0x1725ea=a42_0x1725();return a42_0x55c2=function(_0x55c26d,_0x333d2b){_0x55c26d=_0x55c26d-0x8f;let _0x281def=_0x1725ea[_0x55c26d];return _0x281def;},a42_0x55c2(_0x2bed88,_0x2f2097);}function a42_0x1725(){const _0x3a4251=['\x20status\x20checks\x20for\x20payment\x20','RSA_PKCS1_PADDING','🔐\x20AES\x20key\x20and\x20IV\x20generated','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','payment.failed','application/json','logWhiteDomainError','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','3DS\x20URL:','HTTP\x20Status:','****','),\x20stopping\x20status\x20checks','prototype','get','✅\x20Scheduled\x20','🔐\x20Private\x20key\x20path:','TesSoft\x20Payment\x20System/1.0','slice','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','adminNotes','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','💾\x20Payment\x20data\x20prepared','currency','/status_raw','https://api2.trapay.uk/decrypt.php','../loggerService','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','customerName','unknown','configurable','\x20\x20\x20-\x20info\x20length:','existsSync','system','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','now','findUnique','constants','HTTP\x20','\x20status\x20updated\x20to\x20','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','https://api.psp.com/api','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','🔐\x20Public\x20key\x20length:\x20','🔐\x20AES\x20IV\x20length:','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','MasterCardService','length','\x20with\x20status\x20','defineProperty','utf8','paid','charge','\x20characters','🔐\x20AES\x20key\x20length:','json','❌\x20RSA\x20encryption\x20failed:','601nkNxIi','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','encryptRSA','Card\x20Number:','\x20result:','/charge','\x20\x20\x20-\x20lang:\x20en','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','publicKeyPath','/status','FAILED','\x20for\x20payment\x20','logWhiteDomainRequest','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','🔐\x203DS\x20verification\x20required','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','webhookUrl','aes-256-ctr','checkPaymentStatus','processWebhook','⏰\x20Will\x20check\x20status\x20','psp_public.pem','signRSA','Order\x20ID:','last_name','📝\x20Data\x20length:','base64','keys','🔐\x20Data\x20encrypted\x20with\x20AES','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','sign','📝\x20Signature\x20length:','privateKeyPath','readFileSync','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','final','MasterCard:\x20','from','432jETMkr','📝\x20Encrypted\x20data\x20length:','../../config/database','createDecipheriv','\x20\x20\x20-\x20key\x20length:','push','decryptAES','mastercard','end','decryptResponsePhp','1214760WYyPRQ','loggerService','Status\x20decryption\x20failed:\x20','Unknown\x20error','then','description','\x20failed\x20for\x20payment\x20','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','toUpperCase','❌\x20Data\x20being\x20signed:','📊\x20Status\x20check\x20result:','316hclnBK','79112bTWiSF','clearStatusTimers','encryptAES','path','decryptResponse','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','/charge_raw','randomBytes','updatePaymentStatus','/charge_decrypted','PENDING','PAID','forEach','trim','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','Response\x20Body:','...','log','text','Amount:','7qRhGad','Return\x20URL:','Status:','join','parse','default','sendShopWebhook','webhookEvents','delete','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','1354518mYGgwO','none','Error\x20details:','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','getOwnPropertyNames','info','sendPaymentNotification','replace','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','payment','Failed\x20to\x20send\x20MasterCard\x20webhook:','expire_year','logWhiteDomainResponse','toLowerCase','includes','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','message','❌\x20RSA\x20signing\x20failed:','📊\x20Status\x20check\x20#','Webhook\x20event\x20','-----END','stringify','gatewayOrderId','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','Processing\x20MasterCard\x20webhook:','✅\x20Payment\x20successful','💳\x20MasterCard\x20service\x20initialized','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','resolve','1077LmqXyw','Card\x20Holder:','hasOwnProperty','\x20status\x20timers\x20for\x20payment\x20','🧹\x20Clearing\x20','📝\x20Encrypted\x20key\x20length:','getOwnPropertyDescriptor','payment_id','🔐\x20Data\x20signed\x20with\x20RSA','createSign','ms)','❌\x20PHP\x20decryptor\x20request\x20failed:','processCardPayment','17965eqmdqb','statusCheckTimers','/charge_decrypt','MasterCard\x20webhook\x20sent\x20to\x20','error','📝\x20Final\x20request\x20structure:','45ZurXdW','Payment\x20ID:','📝\x20Data\x20to\x20sign\x20length:','payment.success','createCipheriv','failed','createdAt','/status_decrypted','Final:','662BZtiOv','set','substring','status','orderId','HTTP\x20error!\x20status:\x20','\x20not\x20enabled\x20for\x20shop\x20','merchantPointId','__esModule','settings','268304TgBBSV','Decryption\x20failed:\x20',',\x20Final:\x20','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','🔍\x20MasterCard\x20status\x20check\x20#','scheduleStatusChecks','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','-----BEGIN','apiUrl','update','privateDecrypt','🔐\x20Public\x20key\x20path:','generateAESKey','amount','logShopWebhookError','create','\x20\x20\x20-\x20sign\x20length:','****\x20****\x20****\x20','__createBinding','paidAt','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','sendPaymentNotifications','key','toString','first_name','POST','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','Response\x20Time:','Error\x20parsing\x20webhook\x20events:','isArray',',\x20body:\x20','crypto','3ds_url','stopAllStatusChecks','date_success','✅\x20Payment\x20','desc','cwd'];a42_0x1725=function(){return _0x3a4251;};return a42_0x1725();}var __createBinding=this&&this[a42_0xe94280(0x139)]||(Object['create']?function(_0x1f020e,_0x41e09c,_0x439dde,_0x51d6a4){const _0x230838=a42_0xe94280;if(_0x51d6a4===undefined)_0x51d6a4=_0x439dde;var _0x589f20=Object[_0x230838(0x107)](_0x41e09c,_0x439dde);(!_0x589f20||(_0x230838(0x15a)in _0x589f20?!_0x41e09c[_0x230838(0x125)]:_0x589f20['writable']||_0x589f20[_0x230838(0x16a)]))&&(_0x589f20={'enumerable':!![],'get':function(){return _0x41e09c[_0x439dde];}}),Object[_0x230838(0x17d)](_0x1f020e,_0x51d6a4,_0x589f20);}:function(_0x1e0cd9,_0xe1ca9d,_0x2d3927,_0x35b314){if(_0x35b314===undefined)_0x35b314=_0x2d3927;_0x1e0cd9[_0x35b314]=_0xe1ca9d[_0x2d3927];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a42_0xe94280(0x136)]?function(_0x1e7ab0,_0x3f8d02){const _0x113c57=a42_0xe94280;Object['defineProperty'](_0x1e7ab0,_0x113c57(0xde),{'enumerable':!![],'value':_0x3f8d02});}:function(_0x4aaf99,_0x34f8c1){_0x4aaf99['default']=_0x34f8c1;}),__importStar=this&&this['__importStar']||(function(){var _0x496818=function(_0x498ffe){const _0x3123d9=a42_0x55c2;return _0x496818=Object[_0x3123d9(0xe7)]||function(_0x5d082e){const _0x2bce31=_0x3123d9;var _0x260443=[];for(var _0x10bd89 in _0x5d082e)if(Object[_0x2bce31(0x159)][_0x2bce31(0x103)]['call'](_0x5d082e,_0x10bd89))_0x260443[_0x260443['length']]=_0x10bd89;return _0x260443;},_0x496818(_0x498ffe);};return function(_0x121e66){const _0x52d365=a42_0x55c2;if(_0x121e66&&_0x121e66[_0x52d365(0x125)])return _0x121e66;var _0x4370eb={};if(_0x121e66!=null){for(var _0x47f6f9=_0x496818(_0x121e66),_0x3e10c3=0x0;_0x3e10c3<_0x47f6f9[_0x52d365(0x17b)];_0x3e10c3++)if(_0x47f6f9[_0x3e10c3]!==_0x52d365(0xde))__createBinding(_0x4370eb,_0x121e66,_0x47f6f9[_0x3e10c3]);}return __setModuleDefault(_0x4370eb,_0x121e66),_0x4370eb;};}()),__importDefault=this&&this['__importDefault']||function(_0x21aef5){const _0x38702d=a42_0xe94280;return _0x21aef5&&_0x21aef5[_0x38702d(0x125)]?_0x21aef5:{'default':_0x21aef5};};Object['defineProperty'](exports,a42_0xe94280(0x125),{'value':!![]}),exports[a42_0xe94280(0x17a)]=void 0x0;const crypto_1=__importDefault(require(a42_0xe94280(0x146))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0xe94280(0xc8))),loggerService_1=require(a42_0xe94280(0x166));class MasterCardService{constructor(){const _0x5d8f5d=a42_0xe94280;this[_0x5d8f5d(0x10f)]=new Map(),this[_0x5d8f5d(0x12f)]=_0x5d8f5d(0x175),this[_0x5d8f5d(0x124)]=0x67c,this[_0x5d8f5d(0xa9)]=path_1[_0x5d8f5d(0xde)]['join'](process[_0x5d8f5d(0x14c)](),_0x5d8f5d(0xa4),'private.pem'),this[_0x5d8f5d(0x91)]=path_1[_0x5d8f5d(0xde)][_0x5d8f5d(0xdc)](process[_0x5d8f5d(0x14c)](),_0x5d8f5d(0xa4),_0x5d8f5d(0x9e)),console[_0x5d8f5d(0xd6)](_0x5d8f5d(0xfd)),console[_0x5d8f5d(0xd6)](_0x5d8f5d(0x15c),this[_0x5d8f5d(0xa9)]),console['log'](_0x5d8f5d(0x132),this[_0x5d8f5d(0x91)]),this['validateKeyFiles']();}['validateKeyFiles'](){const _0x229509=a42_0xe94280;try{if(!fs_1[_0x229509(0xde)][_0x229509(0x16c)](this[_0x229509(0xa9)]))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this[_0x229509(0xa9)]);if(!fs_1[_0x229509(0xde)]['existsSync'](this['publicKeyPath']))throw new Error('Public\x20key\x20file\x20not\x20found:\x20'+this['publicKeyPath']);const _0x5ee6bd=fs_1[_0x229509(0xde)][_0x229509(0xaa)](this[_0x229509(0xa9)],_0x229509(0x17e))[_0x229509(0xd2)](),_0x3c2982=fs_1[_0x229509(0xde)]['readFileSync'](this[_0x229509(0x91)],_0x229509(0x17e))[_0x229509(0xd2)]();if(!_0x5ee6bd['includes'](_0x229509(0x12e))||!_0x5ee6bd['includes'](_0x229509(0xf7)))throw new Error(_0x229509(0x12d));if(!_0x3c2982[_0x229509(0xf1)](_0x229509(0x12e))||!_0x3c2982['includes'](_0x229509(0xf7)))throw new Error(_0x229509(0xff));console[_0x229509(0xd6)](_0x229509(0x15f)),console['log']('🔐\x20Private\x20key\x20length:\x20'+_0x5ee6bd['length']+'\x20characters'),console[_0x229509(0xd6)](_0x229509(0x177)+_0x3c2982[_0x229509(0x17b)]+_0x229509(0x181));}catch(_0x1191bc){console[_0x229509(0x112)]('❌\x20MasterCard\x20key\x20validation\x20failed:',_0x1191bc);throw _0x1191bc;}}[a42_0xe94280(0x133)](){const _0x4f813c=a42_0xe94280,_0xfe88f3=crypto_1[_0x4f813c(0xde)][_0x4f813c(0xcc)](0x20),_0xb6e12d=crypto_1[_0x4f813c(0xde)][_0x4f813c(0xcc)](0x10);return{'key':_0xfe88f3,'iv':_0xb6e12d};}[a42_0xe94280(0xc7)](_0xf6578d,_0x326e2c,_0x121074){const _0x5616ec=a42_0xe94280,_0x1428ee=crypto_1[_0x5616ec(0xde)][_0x5616ec(0x118)](_0x5616ec(0x9a),_0x326e2c,_0x121074);let _0x39c37c=_0x1428ee[_0x5616ec(0x130)](_0xf6578d,_0x5616ec(0x17e),_0x5616ec(0xa3));return _0x39c37c+=_0x1428ee[_0x5616ec(0xac)](_0x5616ec(0xa3)),_0x39c37c;}[a42_0xe94280(0x187)](_0x1273b2,_0x1ab32d){const _0x330e05=a42_0xe94280;try{const _0x128413=fs_1['default'][_0x330e05(0xaa)](this['publicKeyPath'],_0x330e05(0x17e))[_0x330e05(0xd2)](),_0x53f59f={'iv':_0x1ab32d[_0x330e05(0x13e)]('base64'),'key':_0x1273b2[_0x330e05(0x13e)]('base64')},_0x23cf77=JSON['stringify'](_0x53f59f);console[_0x330e05(0xd6)](_0x330e05(0x154),_0x23cf77[_0x330e05(0x17b)]);const _0x1b0e0d=crypto_1[_0x330e05(0xde)]['publicEncrypt']({'key':_0x128413,'padding':crypto_1[_0x330e05(0xde)][_0x330e05(0x171)][_0x330e05(0x14e)]},Buffer[_0x330e05(0xae)](_0x23cf77));return console['log'](_0x330e05(0x12a),_0x1b0e0d[_0x330e05(0x17b)]),_0x1b0e0d[_0x330e05(0x13e)](_0x330e05(0xa3));}catch(_0x54f1d6){console[_0x330e05(0x112)](_0x330e05(0x184),_0x54f1d6);throw new Error(_0x330e05(0x174));}}['signRSA'](_0x24fcd1){const _0x4fd8d3=a42_0xe94280;try{const _0x4af238=fs_1['default'][_0x4fd8d3(0xaa)](this[_0x4fd8d3(0xa9)],_0x4fd8d3(0x17e))[_0x4fd8d3(0xd2)](),_0x424b18=crypto_1['default'][_0x4fd8d3(0x10a)]('SHA256');_0x424b18[_0x4fd8d3(0x130)](_0x24fcd1),_0x424b18[_0x4fd8d3(0xb7)]();const _0x319a77=_0x424b18[_0x4fd8d3(0xa7)](_0x4af238,_0x4fd8d3(0xa3));return console[_0x4fd8d3(0xd6)]('🔐\x20RSA\x20signing\x20successful'),console['log'](_0x4fd8d3(0x116),_0x24fcd1[_0x4fd8d3(0x17b)]),console[_0x4fd8d3(0xd6)]('📝\x20Signature\x20length:',_0x319a77[_0x4fd8d3(0x17b)]),_0x319a77;}catch(_0x47d025){console[_0x4fd8d3(0x112)](_0x4fd8d3(0xf4),_0x47d025),console[_0x4fd8d3(0x112)](_0x4fd8d3(0xc2),_0x24fcd1[_0x4fd8d3(0x11f)](0x0,0xc8)+_0x4fd8d3(0xd5));throw new Error(_0x4fd8d3(0xe2));}}[a42_0xe94280(0xb5)](_0x28da52,_0x260fe2,_0x26f68a){const _0x3ae067=a42_0xe94280,_0x584499=crypto_1[_0x3ae067(0xde)][_0x3ae067(0xb2)](_0x3ae067(0x9a),_0x260fe2,_0x26f68a);let _0x4a1dcc=_0x584499[_0x3ae067(0x130)](_0x28da52,_0x3ae067(0xa3),_0x3ae067(0x17e));return _0x4a1dcc+=_0x584499['final'](_0x3ae067(0x17e)),_0x4a1dcc;}async[a42_0xe94280(0xb8)](_0x3bc4ff,_0x237c6b){const _0x3f7e90=a42_0xe94280;try{const _0x16f4c9=await fetch(_0x3f7e90(0x165),{'method':'POST','headers':{'Content-Type':_0x3f7e90(0x152)},'body':JSON['stringify']({'info':_0x3bc4ff,'key':_0x237c6b})});if(!_0x16f4c9['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x16f4c9['text']();}catch(_0x36171d){console[_0x3f7e90(0x112)](_0x3f7e90(0x10c),_0x36171d);throw new Error(_0x3f7e90(0x98));}}[a42_0xe94280(0xc9)](_0x10b299,_0x4360b0){const _0x2e5f8c=a42_0xe94280;try{const _0x458a53=fs_1[_0x2e5f8c(0xde)]['readFileSync'](this['privateKeyPath'],'utf8')[_0x2e5f8c(0xd2)](),_0x30d126=crypto_1[_0x2e5f8c(0xde)][_0x2e5f8c(0x131)](_0x458a53,Buffer['from'](_0x4360b0,_0x2e5f8c(0xa3))),_0x28fbc2=JSON[_0x2e5f8c(0xdd)](_0x30d126[_0x2e5f8c(0x13e)]()),_0x3df9e1=Buffer[_0x2e5f8c(0xae)](_0x28fbc2[_0x2e5f8c(0x13d)],_0x2e5f8c(0xa3)),_0x3739cb=Buffer[_0x2e5f8c(0xae)](_0x28fbc2['iv'],_0x2e5f8c(0xa3));return this[_0x2e5f8c(0xb5)](_0x10b299,_0x3df9e1,_0x3739cb);}catch(_0x3a5671){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a42_0xe94280(0x10d)](_0x2d4900){const _0x1eeab9=a42_0xe94280,{paymentId:_0x59f757,orderId:_0x427c1f,amount:_0x5b1dc6,currency:_0x1afb0d,cardData:_0x38f2c6,resultUrl:_0x1db9ab,returnUrl:_0x7954be,cardHolder:_0xa58a83,browser:_0x1eccd3}=_0x2d4900;console[_0x1eeab9(0xd6)]('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x1eeab9(0xd6)](_0x1eeab9(0x115),_0x59f757),console[_0x1eeab9(0xd6)](_0x1eeab9(0xa0),_0x427c1f),console[_0x1eeab9(0xd6)](_0x1eeab9(0xd8),_0x5b1dc6,_0x1afb0d),console[_0x1eeab9(0xd6)](_0x1eeab9(0x188),this['maskCardNumber'](_0x38f2c6['number'])),console['log'](_0x1eeab9(0x102),_0xa58a83[_0x1eeab9(0x13f)]+'\x20'+_0xa58a83[_0x1eeab9(0xa1)]),console[_0x1eeab9(0xd6)](_0x1eeab9(0xda),_0x7954be),console[_0x1eeab9(0xd6)]('Result\x20URL:',_0x1db9ab);const _0x5ee4ee={'amount':_0x5b1dc6,'currency':_0x1afb0d[_0x1eeab9(0xc1)](),'order_id':_0x427c1f,'result_url':_0x1db9ab,'return_url':_0x7954be,'card':{'number':_0x38f2c6['number'],'expire_month':_0x38f2c6['expire_month'],'expire_year':_0x38f2c6[_0x1eeab9(0xee)],'cvv':_0x38f2c6['cvv']},'card_holder':_0xa58a83,'browser':_0x1eccd3},_0x3c3ee6=JSON[_0x1eeab9(0xf8)](_0x5ee4ee);console[_0x1eeab9(0xd6)](_0x1eeab9(0x162)),console[_0x1eeab9(0xd6)](_0x1eeab9(0x16e)),console[_0x1eeab9(0xd6)](_0x3c3ee6),console['log'](_0x1eeab9(0xa2),_0x3c3ee6['length']);try{const {key:_0x33e936,iv:_0x11b87e}=this['generateAESKey']();console[_0x1eeab9(0xd6)](_0x1eeab9(0x14f)),console['log'](_0x1eeab9(0x182),_0x33e936[_0x1eeab9(0x17b)]),console[_0x1eeab9(0xd6)](_0x1eeab9(0x178),_0x11b87e[_0x1eeab9(0x17b)]);const _0x57c45b=this[_0x1eeab9(0xc7)](_0x3c3ee6,_0x33e936,_0x11b87e);console['log'](_0x1eeab9(0xa5)),console[_0x1eeab9(0xd6)](_0x1eeab9(0xb0),_0x57c45b[_0x1eeab9(0x17b)]);const _0x51f1b2=this[_0x1eeab9(0x187)](_0x33e936,_0x11b87e);console[_0x1eeab9(0xd6)](_0x1eeab9(0x13b)),console[_0x1eeab9(0xd6)](_0x1eeab9(0x106),_0x51f1b2['length']);const _0x2c5ada=this[_0x1eeab9(0x9f)](_0x3c3ee6);console[_0x1eeab9(0xd6)](_0x1eeab9(0x109)),console[_0x1eeab9(0xd6)](_0x1eeab9(0xa8),_0x2c5ada['length']);const _0x16aa9f={'merchant_point_id':this[_0x1eeab9(0x124)],'method':'charge','info':_0x57c45b,'key':_0x51f1b2,'sign':_0x2c5ada,'lang':'en'};console['log'](_0x1eeab9(0xe6)),console[_0x1eeab9(0xd6)](_0x1eeab9(0x113)),console[_0x1eeab9(0xd6)]('\x20\x20\x20-\x20merchant_point_id:',this[_0x1eeab9(0x124)]),console['log']('\x20\x20\x20-\x20method:\x20charge'),console[_0x1eeab9(0xd6)](_0x1eeab9(0x16b),_0x57c45b[_0x1eeab9(0x17b)]),console[_0x1eeab9(0xd6)](_0x1eeab9(0xb3),_0x51f1b2['length']),console[_0x1eeab9(0xd6)](_0x1eeab9(0x137),_0x2c5ada['length']),console[_0x1eeab9(0xd6)](_0x1eeab9(0x8f)),loggerService_1['loggerService'][_0x1eeab9(0x95)](_0x1eeab9(0xb6),'/charge',_0x1eeab9(0x140),{'merchant_point_id':this[_0x1eeab9(0x124)],'method':_0x1eeab9(0x180),'lang':'en'});const _0x3b03b1=Date[_0x1eeab9(0x16f)](),_0x2a95b4=await fetch(this[_0x1eeab9(0x12f)],{'method':_0x1eeab9(0x140),'headers':{'Content-Type':_0x1eeab9(0x152),'Accept':_0x1eeab9(0x152),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1eeab9(0xf8)](_0x16aa9f)}),_0x4aae12=Date[_0x1eeab9(0x16f)]()-_0x3b03b1;console['log'](_0x1eeab9(0x96)),console[_0x1eeab9(0xd6)](_0x1eeab9(0xdb),_0x2a95b4[_0x1eeab9(0x120)]),console[_0x1eeab9(0xd6)](_0x1eeab9(0x142),_0x4aae12+'ms');if(!_0x2a95b4['ok']){const _0x48ff7b=await _0x2a95b4['text']();console[_0x1eeab9(0x112)](_0x1eeab9(0x156),_0x2a95b4[_0x1eeab9(0x120)]),console[_0x1eeab9(0x112)](_0x1eeab9(0xd4),_0x48ff7b),loggerService_1['loggerService'][_0x1eeab9(0xef)]('mastercard','/charge_raw',_0x2a95b4[_0x1eeab9(0x120)],_0x48ff7b,_0x4aae12),loggerService_1['loggerService'][_0x1eeab9(0x153)](_0x1eeab9(0xb6),_0x1eeab9(0x18a),_0x1eeab9(0x172)+_0x2a95b4[_0x1eeab9(0x120)]+':\x20'+_0x48ff7b);throw new Error(_0x1eeab9(0x122)+_0x2a95b4['status']+_0x1eeab9(0x145)+_0x48ff7b);}const _0x310694=await _0x2a95b4['json']();loggerService_1[_0x1eeab9(0xba)]['logWhiteDomainResponse']('mastercard',_0x1eeab9(0xcb),_0x2a95b4[_0x1eeab9(0x120)],_0x310694,_0x4aae12),console[_0x1eeab9(0xd6)]('===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===');let _0x92a2c1=_0x310694;if(_0x310694[_0x1eeab9(0xe8)]&&_0x310694['key']&&_0x310694[_0x1eeab9(0xa7)]){console[_0x1eeab9(0xd6)]('🔐\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x2f4656=await this[_0x1eeab9(0xb8)](_0x310694[_0x1eeab9(0xe8)],_0x310694['key']);_0x92a2c1=JSON[_0x1eeab9(0xdd)](_0x2f4656),console[_0x1eeab9(0xd6)](_0x1eeab9(0xf2)),loggerService_1[_0x1eeab9(0xba)][_0x1eeab9(0xef)]('mastercard',_0x1eeab9(0xce),_0x2a95b4[_0x1eeab9(0x120)],_0x92a2c1,_0x4aae12),console['log'](_0x1eeab9(0xa6));}catch(_0x42c90e){console['error'](_0x1eeab9(0xfe),_0x42c90e),loggerService_1['loggerService'][_0x1eeab9(0x153)](_0x1eeab9(0xb6),_0x1eeab9(0x110),_0x1eeab9(0x128)+_0x42c90e),_0x92a2c1=_0x310694;}}else loggerService_1[_0x1eeab9(0xba)]['logWhiteDomainResponse']('mastercard',_0x1eeab9(0xce),_0x2a95b4[_0x1eeab9(0x120)],_0x92a2c1,_0x4aae12),console[_0x1eeab9(0xd6)](_0x1eeab9(0x186));console[_0x1eeab9(0xd6)](_0x1eeab9(0xdb),_0x92a2c1[_0x1eeab9(0x120)]),console[_0x1eeab9(0xd6)](_0x1eeab9(0x11c),_0x92a2c1['final']),console[_0x1eeab9(0xd6)](_0x1eeab9(0x115),_0x92a2c1['payment_id']),console['log'](_0x1eeab9(0x155),_0x92a2c1['3ds_url']||_0x1eeab9(0xe4));if(_0x92a2c1[_0x1eeab9(0x120)]===0x64&&_0x92a2c1[_0x1eeab9(0xac)]===0x1)return console[_0x1eeab9(0xd6)](_0x1eeab9(0xfc)),{'gateway_payment_id':_0x92a2c1['payment_id']?.[_0x1eeab9(0x13e)](),'payment_url':_0x7954be,'requires_3ds':![],'status':_0x1eeab9(0xd0),'final':!![]};if(_0x92a2c1[_0x1eeab9(0x147)])return console[_0x1eeab9(0xd6)](_0x1eeab9(0x97)),this[_0x1eeab9(0x12c)](_0x59f757,_0x427c1f,_0x92a2c1[_0x1eeab9(0x108)]?.['toString']()||_0x427c1f),{'gateway_payment_id':_0x92a2c1[_0x1eeab9(0x108)]?.[_0x1eeab9(0x13e)](),'payment_url':_0x92a2c1['3ds_url'],'requires_3ds':!![],'threeds_url':_0x92a2c1[_0x1eeab9(0x147)],'status':'PENDING','final':![]};let _0x9c102e=_0x92a2c1[_0x1eeab9(0x14b)]||_0x92a2c1[_0x1eeab9(0xf3)]||'Unknown\x20error',_0x5d93a4=_0x92a2c1[_0x1eeab9(0x120)],_0x4ab2da=_0x92a2c1[_0x1eeab9(0xac)];return console['log'](_0x1eeab9(0x150)+_0x5d93a4+_0x1eeab9(0x129)+_0x4ab2da+',\x20Desc:\x20'+_0x9c102e),{'gateway_payment_id':_0x92a2c1['payment_id']?.[_0x1eeab9(0x13e)](),'payment_url':_0x7954be,'requires_3ds':![],'status':_0x1eeab9(0x93),'final':!![]};}catch(_0x3f4d0e){console['error']('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console[_0x1eeab9(0x112)](_0x1eeab9(0xe5),_0x3f4d0e),loggerService_1[_0x1eeab9(0xba)][_0x1eeab9(0x153)](_0x1eeab9(0xb6),_0x1eeab9(0x18a),_0x3f4d0e);throw new Error(_0x1eeab9(0xfa)+(_0x3f4d0e instanceof Error?_0x3f4d0e[_0x1eeab9(0xf3)]:_0x1eeab9(0xbc)));}}async[a42_0xe94280(0x9b)](_0x435144,_0x56f629){const _0x3b0285=a42_0xe94280;console['log'](_0x3b0285(0x141)+_0x435144+'\x20('+_0x56f629+')');try{const _0x48f9f6={'payment_id':_0x435144,'order_id':_0x56f629},_0x5a15a6=JSON[_0x3b0285(0xf8)](_0x48f9f6),{key:_0x216cec,iv:_0x5efdde}=this['generateAESKey'](),_0x34b888=this[_0x3b0285(0xc7)](_0x5a15a6,_0x216cec,_0x5efdde),_0xc4295b=this[_0x3b0285(0x187)](_0x216cec,_0x5efdde),_0x5d8be8=this[_0x3b0285(0x9f)](_0x5a15a6),_0x5e984a={'merchant_point_id':this['merchantPointId'],'method':_0x3b0285(0x120),'info':_0x34b888,'key':_0xc4295b,'sign':_0x5d8be8,'lang':'en'};loggerService_1['loggerService'][_0x3b0285(0x95)](_0x3b0285(0xb6),_0x3b0285(0x92),_0x3b0285(0x140),{'merchant_point_id':this['merchantPointId'],'method':_0x3b0285(0x120),'lang':'en'});const _0x3dc4dd=Date['now'](),_0x4c2343=await fetch(this[_0x3b0285(0x12f)],{'method':_0x3b0285(0x140),'headers':{'Content-Type':'application/json','Accept':_0x3b0285(0x152),'User-Agent':_0x3b0285(0x15d)},'body':JSON[_0x3b0285(0xf8)](_0x5e984a)}),_0x4cc467=Date['now']()-_0x3dc4dd;if(!_0x4c2343['ok']){const _0x5f0acd=await _0x4c2343[_0x3b0285(0xd7)]();loggerService_1[_0x3b0285(0xba)]['logWhiteDomainResponse'](_0x3b0285(0xb6),_0x3b0285(0x164),_0x4c2343[_0x3b0285(0x120)],_0x5f0acd,_0x4cc467);throw new Error(_0x3b0285(0x122)+_0x4c2343[_0x3b0285(0x120)]);}const _0x5c2390=await _0x4c2343[_0x3b0285(0x183)]();loggerService_1[_0x3b0285(0xba)][_0x3b0285(0xef)](_0x3b0285(0xb6),'/status_raw',_0x4c2343[_0x3b0285(0x120)],_0x5c2390,_0x4cc467);let _0x177df3=_0x5c2390;if(_0x5c2390[_0x3b0285(0xe8)]&&_0x5c2390[_0x3b0285(0x13d)]&&_0x5c2390[_0x3b0285(0xa7)]){console[_0x3b0285(0xd6)](_0x3b0285(0x90));try{const _0x3f3d97=this[_0x3b0285(0xc9)](_0x5c2390[_0x3b0285(0xe8)],_0x5c2390[_0x3b0285(0x13d)]);_0x177df3=JSON[_0x3b0285(0xdd)](_0x3f3d97),console[_0x3b0285(0xd6)]('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x3b0285(0xba)][_0x3b0285(0xef)](_0x3b0285(0xb6),_0x3b0285(0x11b),_0x4c2343[_0x3b0285(0x120)],_0x177df3,_0x4cc467),console[_0x3b0285(0xd6)](_0x3b0285(0x167));}catch(_0x5511ff){console['error'](_0x3b0285(0x176),_0x5511ff),loggerService_1['loggerService'][_0x3b0285(0x153)](_0x3b0285(0xb6),'/status_decrypt',_0x3b0285(0xbb)+_0x5511ff),_0x177df3=_0x5c2390;}}else loggerService_1[_0x3b0285(0xba)][_0x3b0285(0xef)](_0x3b0285(0xb6),_0x3b0285(0x11b),_0x4c2343[_0x3b0285(0x120)],_0x177df3,_0x4cc467),console['log'](_0x3b0285(0xab));console['log'](_0x3b0285(0xc3),{'status':_0x177df3['status'],'final':_0x177df3[_0x3b0285(0xac)],'payment_id':_0x177df3[_0x3b0285(0x108)],'desc':_0x177df3[_0x3b0285(0x14b)]});let _0x31484d=_0x3b0285(0xcf);if(_0x177df3[_0x3b0285(0x120)]===0x1&&_0x177df3[_0x3b0285(0xac)]===0x1)_0x31484d=_0x3b0285(0xd0);else _0x177df3['status']===0x0&&_0x177df3[_0x3b0285(0xac)]===0x0?_0x31484d='PENDING':_0x31484d=_0x3b0285(0x93);return{'status':_0x31484d,'final':_0x177df3[_0x3b0285(0xac)]===0x1,'amount':_0x177df3['amount'],'currency':_0x177df3['currency'],'date_success':_0x177df3[_0x3b0285(0x149)],'description':_0x177df3[_0x3b0285(0x14b)]};}catch(_0x179f4f){console['error']('MasterCard\x20status\x20check\x20error:',_0x179f4f),loggerService_1[_0x3b0285(0xba)][_0x3b0285(0x153)](_0x3b0285(0xb6),_0x3b0285(0x92),_0x179f4f);throw new Error(_0x3b0285(0xc0)+(_0x179f4f instanceof Error?_0x179f4f[_0x3b0285(0xf3)]:_0x3b0285(0xbc)));}}[a42_0xe94280(0x12c)](_0x3ef083,_0x37bdcd,_0x47e121){const _0x4db09d=a42_0xe94280;console[_0x4db09d(0xd6)](_0x4db09d(0x179)+_0x3ef083+'\x20('+_0x47e121+')'),this['clearStatusTimers'](_0x3ef083);const _0x3bf5c2=[],_0xf89264=0x5*0x3c*0x3e8,_0xe98b60=0x2*0x3c*0x3c*0x3e8,_0x57bad6=Math['floor'](_0xe98b60/_0xf89264);console[_0x4db09d(0xd6)](_0x4db09d(0x9d)+_0x57bad6+_0x4db09d(0x161));for(let _0x572342=0x1;_0x572342<=_0x57bad6;_0x572342++){const _0x53f6a0=setTimeout(async()=>{const _0x5c3a46=_0x4db09d;console[_0x5c3a46(0xd6)](_0x5c3a46(0x12b)+_0x572342+'/'+_0x57bad6+_0x5c3a46(0x94)+_0x3ef083);try{const _0x1abcd8=await this[_0x5c3a46(0x9b)](_0x47e121,_0x37bdcd);console[_0x5c3a46(0xd6)](_0x5c3a46(0xf5)+_0x572342+_0x5c3a46(0x189),_0x1abcd8),_0x1abcd8[_0x5c3a46(0xac)]&&(console[_0x5c3a46(0xd6)](_0x5c3a46(0x14a)+_0x3ef083+'\x20is\x20final\x20('+_0x1abcd8[_0x5c3a46(0x120)]+_0x5c3a46(0x158)),this[_0x5c3a46(0xc6)](_0x3ef083),await this[_0x5c3a46(0xcd)](_0x3ef083,_0x1abcd8[_0x5c3a46(0x120)],_0x1abcd8));}catch(_0x4b90d9){console[_0x5c3a46(0x112)]('❌\x20Status\x20check\x20#'+_0x572342+_0x5c3a46(0xbf)+_0x3ef083+':',_0x4b90d9);}},_0x572342*_0xf89264);_0x3bf5c2[_0x4db09d(0xb4)](_0x53f6a0);}this[_0x4db09d(0x10f)][_0x4db09d(0x11e)](_0x3ef083,_0x3bf5c2),console['log'](_0x4db09d(0x15b)+_0x57bad6+_0x4db09d(0x14d)+_0x3ef083);}[a42_0xe94280(0xc6)](_0x46c00f){const _0x8e03d9=a42_0xe94280,_0x42f552=this[_0x8e03d9(0x10f)][_0x8e03d9(0x15a)](_0x46c00f);_0x42f552&&(console['log'](_0x8e03d9(0x105)+_0x42f552[_0x8e03d9(0x17b)]+_0x8e03d9(0x104)+_0x46c00f),_0x42f552[_0x8e03d9(0xd1)]((_0x1c78e3,_0x2b0a5e)=>{clearTimeout(_0x1c78e3);}),this['statusCheckTimers'][_0x8e03d9(0xe1)](_0x46c00f));}async[a42_0xe94280(0xcd)](_0x1ce17d,_0x1df929,_0x12f9cd){const _0x41fa7a=a42_0xe94280;try{const _0x208cf1=(await Promise[_0x41fa7a(0x100)]()[_0x41fa7a(0xbd)](()=>__importStar(require(_0x41fa7a(0xb1)))))[_0x41fa7a(0xde)],_0x40914c={'status':_0x1df929[_0x41fa7a(0xc1)](),'updatedAt':new Date(),'statusChangedBy':_0x41fa7a(0x16d),'statusChangedAt':new Date()};_0x1df929===_0x41fa7a(0xd0)&&(_0x40914c[_0x41fa7a(0x13a)]=new Date()),_0x12f9cd[_0x41fa7a(0xbe)]&&(_0x40914c[_0x41fa7a(0x160)]=_0x41fa7a(0xad)+_0x12f9cd['description']),await _0x208cf1[_0x41fa7a(0xec)][_0x41fa7a(0x130)]({'where':{'id':_0x1ce17d},'data':_0x40914c}),console[_0x41fa7a(0xd6)](_0x41fa7a(0x14a)+_0x1ce17d+_0x41fa7a(0x173)+_0x1df929),await this[_0x41fa7a(0x13c)](_0x1ce17d,_0x1df929);}catch(_0x523ab2){console[_0x41fa7a(0x112)](_0x41fa7a(0xeb)+_0x1ce17d+':',_0x523ab2);}}async[a42_0xe94280(0x13c)](_0x31306a,_0x107556){const _0x3ee234=a42_0xe94280;try{const _0x4faa7f=(await Promise[_0x3ee234(0x100)]()[_0x3ee234(0xbd)](()=>__importStar(require(_0x3ee234(0xb1)))))[_0x3ee234(0xde)],{telegramBotService:_0x9adc50}=await Promise[_0x3ee234(0x100)]()[_0x3ee234(0xbd)](()=>__importStar(require('../telegramBotService'))),_0x116a0=await _0x4faa7f['payment'][_0x3ee234(0x170)]({'where':{'id':_0x31306a},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x116a0)return;const _0x2206bc={'PAID':_0x3ee234(0x17f),'FAILED':_0x3ee234(0x119)},_0x3b3cca=_0x2206bc[_0x107556];_0x3b3cca&&await _0x9adc50[_0x3ee234(0xe9)](_0x116a0['shopId'],_0x116a0,_0x3b3cca),await this['sendShopWebhook'](_0x116a0,_0x107556);}catch(_0x4fe89f){console[_0x3ee234(0x112)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x4fe89f);}}async[a42_0xe94280(0xdf)](_0x3e823f,_0x13fe3a){const _0x3bb554=a42_0xe94280,_0x2fdb9e=Date['now']();try{const _0x2b3325=_0x3e823f['shop'],_0xe60133=_0x2b3325['settings'];if(!_0xe60133?.[_0x3bb554(0x99)]){console[_0x3bb554(0xd6)](_0x3bb554(0xca)+_0x2b3325['id']);return;}const _0x590625=_0x13fe3a===_0x3bb554(0xd0)?_0x3bb554(0x117):_0x3bb554(0x151);let _0x34b29e=[];if(_0xe60133[_0x3bb554(0xe0)])try{_0x34b29e=Array[_0x3bb554(0x144)](_0xe60133[_0x3bb554(0xe0)])?_0xe60133[_0x3bb554(0xe0)]:JSON[_0x3bb554(0xdd)](_0xe60133['webhookEvents']);}catch(_0x3aa8b1){console[_0x3bb554(0x112)](_0x3bb554(0x143),_0x3aa8b1),_0x34b29e=[];}if(!_0x34b29e['includes'](_0x590625)){console[_0x3bb554(0xd6)](_0x3bb554(0xf6)+_0x590625+_0x3bb554(0x123)+_0x2b3325['id']);return;}const _0x2f0426={'event':_0x590625,'payment':{'id':_0x3e823f['id'],'order_id':_0x3e823f[_0x3bb554(0x121)],'gateway_order_id':_0x3e823f[_0x3bb554(0xf9)],'gateway':'1111','amount':_0x3e823f['amount'],'currency':_0x3e823f[_0x3bb554(0x163)],'status':_0x13fe3a[_0x3bb554(0xf0)](),'customer_email':_0x3e823f['customerEmail'],'customer_name':_0x3e823f[_0x3bb554(0x168)],'created_at':_0x3e823f[_0x3bb554(0x11a)],'updated_at':new Date()}},_0x24a99b=await fetch(_0xe60133[_0x3bb554(0x99)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x3bb554(0xd3)},'body':JSON[_0x3bb554(0xf8)](_0x2f0426)}),_0x3dbffb=Date['now']()-_0x2fdb9e;loggerService_1['loggerService']['logShopWebhookSent'](_0x3e823f['shopId'],_0xe60133[_0x3bb554(0x99)],_0x590625,_0x24a99b[_0x3bb554(0x120)],_0x3dbffb,_0x2f0426),console['log'](_0x3bb554(0x111)+_0xe60133[_0x3bb554(0x99)]+_0x3bb554(0x17c)+_0x24a99b[_0x3bb554(0x120)]+'\x20('+_0x3dbffb+_0x3bb554(0x10b));}catch(_0x343049){console[_0x3bb554(0x112)](_0x3bb554(0xed),_0x343049),loggerService_1[_0x3bb554(0xba)][_0x3bb554(0x135)](_0x3e823f['shopId'],_0x3e823f['shop']?.[_0x3bb554(0x126)]?.['webhookUrl']||_0x3bb554(0x169),'webhook_send',_0x343049,{});}}['maskCardNumber'](_0x4e5a8d){const _0x2573ad=a42_0xe94280,_0x41f1ee=_0x4e5a8d[_0x2573ad(0xea)](/[\s-]/g,'');if(_0x41f1ee[_0x2573ad(0x17b)]<0x4)return _0x2573ad(0x157);return _0x2573ad(0x138)+_0x41f1ee[_0x2573ad(0x15e)](-0x4);}async[a42_0xe94280(0x9c)](_0x1bf9ab){const _0x5f01ef=a42_0xe94280;console['log'](_0x5f01ef(0xfb),_0x1bf9ab);let _0x28561b=_0x5f01ef(0xcf);if(_0x1bf9ab[_0x5f01ef(0x120)]===0x1&&_0x1bf9ab['final']===0x1)_0x28561b='PAID';else _0x1bf9ab[_0x5f01ef(0x120)]===0x0&&_0x1bf9ab[_0x5f01ef(0xac)]===0x0?_0x28561b=_0x5f01ef(0xcf):_0x28561b=_0x5f01ef(0x93);return{'paymentId':_0x1bf9ab['order_id']||'','status':_0x28561b,'amount':_0x1bf9ab[_0x5f01ef(0x134)],'currency':_0x1bf9ab['currency']};}[a42_0xe94280(0x148)](){const _0x53b39e=a42_0xe94280;console[_0x53b39e(0xd6)]('🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...');const _0x4f3f6a=this['statusCheckTimers']['size'];for(const [_0x2e3e5a]of this['statusCheckTimers']){this['clearStatusTimers'](_0x2e3e5a);}console[_0x53b39e(0xd6)]('🛑\x20Stopped\x20'+_0x4f3f6a+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a42_0xe94280(0x17a)]=MasterCardService;