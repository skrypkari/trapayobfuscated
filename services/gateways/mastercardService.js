'use strict';function a57_0x303b(_0x13ba6f,_0xcc66d7){_0x13ba6f=_0x13ba6f-0x8b;const _0x1d4cbf=a57_0x1d4c();let _0x303b5d=_0x1d4cbf[_0x13ba6f];return _0x303b5d;}function a57_0x1d4c(){const _0xd79c70=['2912riUneB','number','privateKeyPath','****','constants','get','visaPublicKeyPath','),\x20defaulting\x20to\x20MasterCard','clearStatusTimers','desc','logWhiteDomainResponse','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','710GagEvn','ğŸ“¤\x20Sending\x20request\x20to\x20API...','defineProperty','ğŸ›‘\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','order_id','utf8','PHP\x20decryptor\x20error','3ds_url','/status_decrypt','checkPaymentStatus','settings','ğŸ“\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','Failed\x20payment','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','writable','Payment\x20confirmation\x20time\x20has\x20expired','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','first_name','shopId','configurable','description','getDetailedErrorMessage','createDecipheriv','isFinalStatus','floor','psp_public.pem','charAt','keys','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','ğŸ’³\x20Detected\x20MasterCard\x20(starts\x20with\x205)','https://api.paydmeth.com/api','webhook_send','ğŸ“\x20Encrypted\x20key\x20length:','ğŸ”\x20RSA\x20signing\x20successful','âœ…\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','HTTP\x20Status:','LookUp\x20not\x20confirmed','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','resolve','Expected\x20bitcoin\x20transfer\x20from\x20client','Number\x20of\x20attempts\x20exceeded','Method\x20not\x20allowed','Webhook\x20event\x20','text','â°\x20Will\x20check\x20status\x20','createCipheriv','Status\x20decryption\x20failed:\x20','ğŸ”\x20Detected\x20card\x20type\x20from\x20webhook:\x20','amount','Another\x20unknown\x20error','ğŸ“Š\x20','webhookEvents','===\x20API\x20RESPONSE\x20===','Payment\x20is\x20being\x20processed','push','Cancellation\x20is\x20not\x20possible','âœ…\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','111GpwUEf','PAID','create','expire_month','Order\x20ID:','ğŸ“\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','\x20order_id\x20for\x20search:\x20','aes-256-ctr','ğŸ”\x20VISA\x20Private\x20key\x20path:','402TGeYjQ','path','LookUp\x20code\x20verified','ms)','\x20payment:\x20','decryptResponsePhp','Card\x20Holder:','currency','default','Payment\x20System/1.0','Operation\x20completed\x20successfully','../loggerService','ğŸ”\x20AES\x20key\x20length:','cwd','âš ï¸\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','randomBytes','__importDefault','logWhiteDomainError','ğŸ“\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','ğŸ’³\x20Unknown\x20card\x20type\x20(starts\x20with\x20','decryptResponse','system','ğŸ”\x20AES\x20IV\x20length:','toString','paidAt','âœ…\x20Payment\x20successful',',\x20final=','VisaMasterCardService','getCardTypeAndApi','join','MASTERCARD','unknown','5000000000000000','ğŸ”\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','payment.success','Failed\x20to\x20check\x20','Unknown\x20error','FAILED','\x20\x20\x20Amount:\x20','Request\x20data\x20error','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','âŒ\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','now','\x20status\x20check\x20#','cardType','ğŸ”\x20','statusCheckTimers',':\x20Unknown\x20status\x20code','base64','toUpperCase','failureMessage','Amount:','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','visaApiUrl','ğŸ”\x20Using\x20provided\x20card\x20type:\x20','decryptAES','Decryption\x20failed:\x20','/status',',\x20paymentId=','Response\x20Body:','payment_id','ğŸ“\x20Decrypted\x20webhook\x20data:','482582FhAlKE','visa_private.pem','gatewayOrderId','last_name','includes','3DS\x20verification\x20required','createdAt','card_type','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','\x20API:\x20','shop','ğŸ”\x20MasterCard\x20Private\x20key\x20length:\x20','final','ğŸ”\x20MasterCard\x20API\x20URL:','sendShopWebhook','\x20\x20Cleaned:\x20\x20\x22','ğŸ”\x20VISA\x20Public\x20key\x20length:\x20','Awaiting\x20confirmation\x20in\x20the\x20application','ğŸ“Š\x20Status\x20check\x20#','__setModuleDefault','error','maskCardNumber','payment','ğŸ”\x20AES\x20key\x20and\x20IV\x20generated','\x20status\x20updated\x20to\x20','Error\x20parsing\x20webhook\x20events:','sign','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','Return\x20URL:','Cash\x20payment\x20is\x20expected\x20at\x20TCO','../../config/database','ğŸ”\x203DS\x20verification\x20required','\x20status\x20check\x20error:','publicKeyPath','Unsuccessful\x20payment','===\x20PARSED\x20API\x20RESPONSE\x20===','9608604DaeNBF','ğŸ“\x20Data\x20to\x20sign\x20length:','ğŸ”\x20VISA\x20API\x20URL:','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','end','ğŸ“\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','visaPrivateKeyPath','key','__importStar','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','visaMerchantPointId','slice','Sender\x20information\x20required','processWebhook','paymentStatuses','masterCardApiUrl','date_success','sendPaymentNotifications','ğŸ”„\x20Processing\x20MasterCard\x20webhook\x20data:','logWhiteDomainRequest','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','Payment\x20confirmation\x20required','then','Awaiting\x20confirmation\x20by\x20ivr\x20call','ğŸ”\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','\x20\x20\x20Status:\x20','status','âŒ\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','\x20result:','info','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','1111','ğŸ”\x20Using\x20fallback\x20fields\x20for\x20search:\x20','ğŸ”\x20Data\x20signed\x20with\x20RSA','\x20\x20Original:\x20\x22','18005fCRFkS','paymentId','length','paid','\x20payment_id\x20for\x20search:\x20','Recipient\x20data\x20required','customerEmail','-----END','âš ï¸\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','Payment\x20returned','ğŸ”\x20Using\x20keys:\x20','\x20|\x20Response:\x20','ğŸ“Š\x20Status\x20check\x20result:','call','PENDING','findUnique','4000000000000000','Error\x20details:','20284qaUVNq','warn','Captcha\x20confirmation\x20awaited','encryptAES','visa_public.pem','âŒ\x20Failed\x20to\x20decrypt\x20status\x20response:','masterCardMerchantPointId','ğŸ”\x20Using\x20','signRSA','\x20for\x20payment\x20','ğŸ”\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','getOwnPropertyNames','ğŸ”\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','ğŸ›‘\x20Stopped\x20','3DS\x20URL:','__esModule','generateAESKey','\x20(from:\x20status=','parse','\x20\x20\x20-\x20sign\x20length:','HTTP\x20error!\x20status:\x20','ğŸ”\x20VISA\x20Private\x20key\x20length:\x20','toLowerCase','1813iiYUlb','publicEncrypt','visa/mastercard','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited',',\x20id=','âœ…\x20Payment\x20',',\x20Desc:\x20','message','VISA','Transaction\x20limit\x20exceeded','âŒ\x20VISA/MasterCard\x20key\x20validation\x20failed:','1KMkuMF','scheduleStatusChecks','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','Card\x20Number:','****\x20****\x20****\x20','getOwnPropertyDescriptor','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','orderId','âŒ\x20RSA\x20signing\x20failed:','Client\x20OTP\x20confirmation\x20required','Payment\x20prohibited','application/json','existsSync','charge','Payment\x20ID:','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','Failed\x20to\x20send\x20payment\x20notifications:','-----BEGIN','customerName','trim','âš ï¸\x20Expected\x20VISA\x20private\x20key:\x20','/charge_decrypt','apiUrl',',\x20body:\x20','merchantPointId','\x20\x20\x20-\x20merchant_point_id:','\x20\x20\x20-\x20key\x20length:','replace','6201vxDhbr','ğŸ”\x20MasterCard\x20Public\x20key\x20path:','payment.failed','ğŸ“\x20Signature\x20length:','sendPaymentNotification','Status:','/status_decrypted','failed','Status\x20','forEach','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','ğŸ§¹\x20Card\x20holder\x20names\x20cleaned:','RSA_PKCS1_PADDING','\x20\x20\x20Payment\x20ID:\x20','POST','loggerService','\x22\x20|\x20\x22','ğŸ”\x20Response\x20is\x20encrypted,\x20decrypting...','stringify','âŒ\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','No\x20Error\x20executing\x20request','webhookUrl','1292808NSBkMZ','\x20payment\x20status:\x20','hasOwnProperty','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','\x20characters','ğŸ”\x20MasterCard\x20Public\x20key\x20length:\x20','readFileSync','\x20status\x20checks\x20for\x20payment\x20','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','logShopWebhookSent','log','encryptRSA','prototype','from','Payment\x20pending\x20verification','/charge','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','LookUp\x20code\x20sent','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','ğŸ’³\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','ğŸ’¾\x20Payment\x20data\x20prepared','âœ…\x20Scheduled\x20','updatePaymentStatus','âš ï¸\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','json','\x20not\x20enabled\x20for\x20shop\x20','update','âŒ\x20PHP\x20decryptor\x20request\x20failed:','\x20MasterCard\x20status\x20check\x20timers','âŒ\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','ğŸ“\x20Final\x20request\x20structure:','/charge_raw','/status_raw','isArray','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','__createBinding','Final:','logShopWebhookError','Response\x20Time:','private.pem','cvv'];a57_0x1d4c=function(){return _0xd79c70;};return a57_0x1d4c();}const a57_0x33dd50=a57_0x303b;(function(_0x4d405e,_0x6e161d){const _0x158bec=a57_0x303b,_0x5114b0=_0x4d405e();while(!![]){try{const _0x20bafb=parseInt(_0x158bec(0x11e))/0x1*(parseInt(_0x158bec(0xa3))/0x2)+parseInt(_0x158bec(0x1be))/0x3*(parseInt(_0x158bec(0xfc))/0x4)+parseInt(_0x158bec(0xea))/0x5*(parseInt(_0x158bec(0x1c7))/0x6)+parseInt(_0x158bec(0x113))/0x7*(parseInt(_0x158bec(0x179))/0x8)+-parseInt(_0x158bec(0x13a))/0x9*(-parseInt(_0x158bec(0x185))/0xa)+parseInt(_0x158bec(0x150))/0xb+-parseInt(_0x158bec(0xc7))/0xc;if(_0x20bafb===_0x6e161d)break;else _0x5114b0['push'](_0x5114b0['shift']());}catch(_0x1eb3a7){_0x5114b0['push'](_0x5114b0['shift']());}}}(a57_0x1d4c,0x1fc8f));var __createBinding=this&&this[a57_0x33dd50(0x173)]||(Object['create']?function(_0xe0995f,_0x412579,_0x4dfd74,_0x2ea9fc){const _0x4bddf3=a57_0x33dd50;if(_0x2ea9fc===undefined)_0x2ea9fc=_0x4dfd74;var _0x5dd1f1=Object[_0x4bddf3(0x123)](_0x412579,_0x4dfd74);(!_0x5dd1f1||(_0x4bddf3(0x17e)in _0x5dd1f1?!_0x412579[_0x4bddf3(0x10b)]:_0x5dd1f1[_0x4bddf3(0x193)]||_0x5dd1f1[_0x4bddf3(0x198)]))&&(_0x5dd1f1={'enumerable':!![],'get':function(){return _0x412579[_0x4dfd74];}}),Object[_0x4bddf3(0x187)](_0xe0995f,_0x2ea9fc,_0x5dd1f1);}:function(_0x58cac6,_0x3371cb,_0x25ad46,_0x14d798){if(_0x14d798===undefined)_0x14d798=_0x25ad46;_0x58cac6[_0x14d798]=_0x3371cb[_0x25ad46];}),__setModuleDefault=this&&this[a57_0x33dd50(0xb6)]||(Object[a57_0x33dd50(0x1c0)]?function(_0x2f5e23,_0x3d4832){const _0x5d17e4=a57_0x33dd50;Object[_0x5d17e4(0x187)](_0x2f5e23,_0x5d17e4(0x1cf),{'enumerable':!![],'value':_0x3d4832});}:function(_0x22b618,_0x286cc2){const _0x1af731=a57_0x33dd50;_0x22b618[_0x1af731(0x1cf)]=_0x286cc2;}),__importStar=this&&this[a57_0x33dd50(0xcf)]||(function(){var _0x3f4bef=function(_0x509ea7){const _0x1779c9=a57_0x303b;return _0x3f4bef=Object[_0x1779c9(0x107)]||function(_0x151e45){const _0x2c7ad4=_0x1779c9;var _0x6a9541=[];for(var _0x1e9269 in _0x151e45)if(Object[_0x2c7ad4(0x15c)][_0x2c7ad4(0x152)][_0x2c7ad4(0xf7)](_0x151e45,_0x1e9269))_0x6a9541[_0x6a9541[_0x2c7ad4(0xec)]]=_0x1e9269;return _0x6a9541;},_0x3f4bef(_0x509ea7);};return function(_0x322894){const _0x52c0c1=a57_0x303b;if(_0x322894&&_0x322894['__esModule'])return _0x322894;var _0x19431c={};if(_0x322894!=null){for(var _0x5e2ac3=_0x3f4bef(_0x322894),_0x35ac3e=0x0;_0x35ac3e<_0x5e2ac3[_0x52c0c1(0xec)];_0x35ac3e++)if(_0x5e2ac3[_0x35ac3e]!==_0x52c0c1(0x1cf))__createBinding(_0x19431c,_0x322894,_0x5e2ac3[_0x35ac3e]);}return __setModuleDefault(_0x19431c,_0x322894),_0x19431c;};}()),__importDefault=this&&this[a57_0x33dd50(0x1d7)]||function(_0x3a3cd9){return _0x3a3cd9&&_0x3a3cd9['__esModule']?_0x3a3cd9:{'default':_0x3a3cd9};};Object[a57_0x33dd50(0x187)](exports,a57_0x33dd50(0x10b),{'value':!![]}),exports['VisaMasterCardService']=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a57_0x33dd50(0x1c8))),loggerService_1=require(a57_0x33dd50(0x1d2));class VisaMasterCardService{constructor(){const _0x3f7dbf=a57_0x33dd50;this[_0x3f7dbf(0x93)]=new Map(),this[_0x3f7dbf(0xd5)]={0x0:{'final':![],'description':'No\x20New\x20payment'},0x1:{'final':![],'description':_0x3f7dbf(0x14e)},0x2:{'final':!![],'description':_0x3f7dbf(0x8c)},0x3:{'final':!![],'description':_0x3f7dbf(0x1b6)},0x4:{'final':!![],'description':_0x3f7dbf(0xc5)},0x5:{'final':!![],'description':_0x3f7dbf(0x160)},0x6:{'final':!![],'description':_0x3f7dbf(0xf3)},0x7:{'final':!![],'description':'Test\x20payment'},0x8:{'final':![],'description':_0x3f7dbf(0x127)},0x9:{'final':![],'description':_0x3f7dbf(0xa8)},0xa:{'final':![],'description':'Sender\x27s\x20CVV\x20card\x20is\x20required'},0xb:{'final':![],'description':_0x3f7dbf(0xd3)},0xc:{'final':![],'description':_0x3f7dbf(0xef)},0xd:{'final':![],'description':'Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number'},0xe:{'final':![],'description':_0x3f7dbf(0xde)},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':_0x3f7dbf(0xfe)},0x11:{'final':![],'description':_0x3f7dbf(0x192)},0x12:{'final':![],'description':_0x3f7dbf(0xb4)},0x13:{'final':![],'description':_0x3f7dbf(0x1ba)},0x14:{'final':![],'description':_0x3f7dbf(0x153)},0x15:{'final':![],'description':_0x3f7dbf(0x1ac)},0x16:{'final':![],'description':_0x3f7dbf(0x15e)},0x18:{'final':![],'description':_0x3f7dbf(0x116)},0x19:{'final':![],'description':_0x3f7dbf(0x124)},0x1a:{'final':!![],'description':_0x3f7dbf(0xc0)},0x1b:{'final':![],'description':'Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code'},0x1c:{'final':![],'description':_0x3f7dbf(0x184)},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':_0x3f7dbf(0xab)},0x20:{'final':![],'description':_0x3f7dbf(0xca)},0x23:{'final':![],'description':'Sender\x27s\x20card\x20details\x20are\x20required'},0x24:{'final':!![],'description':_0x3f7dbf(0x194)},0x25:{'final':!![],'description':_0x3f7dbf(0x128)},0x26:{'final':!![],'description':'The\x20payment\x20status\x20must\x20be\x20clarified\x20manually'},0x27:{'final':!![],'description':'Insufficient\x20funds\x20on\x20the\x20card'},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':'The\x20card\x20is\x20lost\x20or\x20stolen'},0x2a:{'final':!![],'description':'Invalid\x20expiration\x20date'},0x2b:{'final':!![],'description':_0x3f7dbf(0x11c)},0x2c:{'final':!![],'description':_0x3f7dbf(0x172)},0x2d:{'final':!![],'description':_0x3f7dbf(0x191)},0x2e:{'final':!![],'description':_0x3f7dbf(0xc5)},0x2f:{'final':!![],'description':'Unsuccessful\x20payment'},0x30:{'final':!![],'description':_0x3f7dbf(0x120)},0x31:{'final':![],'description':_0x3f7dbf(0xdc)},0x32:{'final':!![],'description':_0x3f7dbf(0x1ae)},0x33:{'final':!![],'description':'Failed\x20payment'},0x34:{'final':!![],'description':_0x3f7dbf(0x191)},0x35:{'final':!![],'description':_0x3f7dbf(0x191)},0x36:{'final':!![],'description':_0x3f7dbf(0x191)},0x37:{'final':!![],'description':_0x3f7dbf(0x191)},0x38:{'final':!![],'description':_0x3f7dbf(0x1bc)},0x39:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank'},0x3a:{'final':![],'description':_0x3f7dbf(0x161)},0x3b:{'final':!![],'description':_0x3f7dbf(0x1c9)},0x3c:{'final':!![],'description':_0x3f7dbf(0x1ad)},0x3d:{'final':!![],'description':_0x3f7dbf(0x99)},0x3e:{'final':!![],'description':'Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID'},0x3f:{'final':!![],'description':'Payment\x20returned'},0x40:{'final':![],'description':_0x3f7dbf(0x1a9)},0x41:{'final':!![],'description':'LookUp\x20number\x20of\x20attempts\x20exceeded'},0x42:{'final':![],'description':'Payment\x20cancellation\x20is\x20being\x20processed'},0x43:{'final':!![],'description':_0x3f7dbf(0xdb)},0x44:{'final':![],'description':_0x3f7dbf(0xa8)},0x45:{'final':!![],'description':_0x3f7dbf(0x191)},0x46:{'final':!![],'description':_0x3f7dbf(0x191)},0x47:{'final':!![],'description':_0x3f7dbf(0x1aa)},0x64:{'final':!![],'description':_0x3f7dbf(0x1d1)}},this[_0x3f7dbf(0xd6)]=_0x3f7dbf(0x1a3),this[_0x3f7dbf(0x102)]=0x744,this[_0x3f7dbf(0x17b)]=path_1[_0x3f7dbf(0x1cf)]['join'](process[_0x3f7dbf(0x1d4)](),'keys',_0x3f7dbf(0x177)),this[_0x3f7dbf(0xc4)]=path_1[_0x3f7dbf(0x1cf)][_0x3f7dbf(0x1e4)](process[_0x3f7dbf(0x1d4)](),'keys',_0x3f7dbf(0x19e)),this['visaApiUrl']=_0x3f7dbf(0x1a3),this[_0x3f7dbf(0xd1)]=0x6b7,this[_0x3f7dbf(0xcd)]=path_1[_0x3f7dbf(0x1cf)]['join'](process[_0x3f7dbf(0x1d4)](),'keys',_0x3f7dbf(0xa4)),this[_0x3f7dbf(0x17f)]=path_1['default']['join'](process[_0x3f7dbf(0x1d4)](),_0x3f7dbf(0x1a0),_0x3f7dbf(0x100)),console[_0x3f7dbf(0x15a)]('ğŸ’³\x20VISA/MasterCard\x20service\x20initialized'),console[_0x3f7dbf(0x15a)](_0x3f7dbf(0xb0),this[_0x3f7dbf(0xd6)]),console[_0x3f7dbf(0x15a)](_0x3f7dbf(0xc9),this[_0x3f7dbf(0x9a)]),console[_0x3f7dbf(0x15a)]('ğŸ”\x20MasterCard\x20Private\x20key\x20path:',this[_0x3f7dbf(0x17b)]),console[_0x3f7dbf(0x15a)](_0x3f7dbf(0x13b),this[_0x3f7dbf(0xc4)]),console[_0x3f7dbf(0x15a)](_0x3f7dbf(0x1c6),this[_0x3f7dbf(0xcd)]),console[_0x3f7dbf(0x15a)]('ğŸ”\x20VISA\x20Public\x20key\x20path:',this[_0x3f7dbf(0x17f)]),this['validateKeyFiles']();}[a57_0x33dd50(0x19a)](_0x24bc75,_0x433209){const _0x3fd18b=a57_0x33dd50,_0x4e1d99=this[_0x3fd18b(0xd5)][_0x24bc75];let _0x1964df='';_0x4e1d99?_0x1964df=_0x3fd18b(0x142)+_0x24bc75+':\x20'+_0x4e1d99[_0x3fd18b(0x199)]:_0x1964df='Status\x20'+_0x24bc75+_0x3fd18b(0x94);if(_0x433209&&_0x433209[_0x3fd18b(0x131)]()){const _0x2cd3bf=_0x433209[_0x3fd18b(0x131)]();(!_0x4e1d99||_0x2cd3bf['toLowerCase']()!==_0x4e1d99[_0x3fd18b(0x199)][_0x3fd18b(0x112)]())&&(_0x1964df+=_0x3fd18b(0xf5)+_0x2cd3bf);}return _0x1964df;}[a57_0x33dd50(0x19c)](_0x3fb160){const _0x1f8886=a57_0x33dd50,_0x55e301=this[_0x1f8886(0xd5)][_0x3fb160];return _0x55e301?_0x55e301[_0x1f8886(0xaf)]:!![];}[a57_0x33dd50(0x1e3)](_0x573289){const _0x36c9e5=a57_0x33dd50,_0x1e8cd9=_0x573289[_0x36c9e5(0x19f)](0x0);if(_0x1e8cd9==='4')return console['log'](_0x36c9e5(0x163)),{'cardType':_0x36c9e5(0x11b),'apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x36c9e5(0xcd)],'publicKeyPath':this[_0x36c9e5(0x17f)],'merchantPointId':this[_0x36c9e5(0xd1)]};else return _0x1e8cd9==='5'?(console[_0x36c9e5(0x15a)](_0x36c9e5(0x1a2)),{'cardType':_0x36c9e5(0x1e5),'apiUrl':this[_0x36c9e5(0xd6)],'privateKeyPath':this[_0x36c9e5(0x17b)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x36c9e5(0x102)]}):(console[_0x36c9e5(0x15a)](_0x36c9e5(0x1da)+_0x1e8cd9+_0x36c9e5(0x180)),{'cardType':_0x36c9e5(0x1e5),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x36c9e5(0x17b)],'publicKeyPath':this[_0x36c9e5(0xc4)],'merchantPointId':this[_0x36c9e5(0x102)]});}['validateKeyFiles'](){const _0x326578=a57_0x33dd50;try{if(!fs_1[_0x326578(0x1cf)]['existsSync'](this[_0x326578(0x17b)]))throw new Error(_0x326578(0x158)+this[_0x326578(0x17b)]);if(!fs_1[_0x326578(0x1cf)][_0x326578(0x12a)](this[_0x326578(0xc4)]))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this[_0x326578(0xc4)]);const _0x304b6e=fs_1[_0x326578(0x1cf)][_0x326578(0x156)](this[_0x326578(0x17b)],_0x326578(0x18a))[_0x326578(0x131)](),_0x91dfbb=fs_1['default'][_0x326578(0x156)](this[_0x326578(0xc4)],_0x326578(0x18a))[_0x326578(0x131)]();if(!_0x304b6e['includes']('-----BEGIN')||!_0x304b6e[_0x326578(0xa7)](_0x326578(0xf1)))throw new Error(_0x326578(0xd0));if(!_0x91dfbb[_0x326578(0xa7)](_0x326578(0x12f))||!_0x91dfbb[_0x326578(0xa7)](_0x326578(0xf1)))throw new Error(_0x326578(0x8d));console[_0x326578(0x15a)]('âœ…\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console['log'](_0x326578(0xae)+_0x304b6e[_0x326578(0xec)]+_0x326578(0x154)),console['log'](_0x326578(0x155)+_0x91dfbb[_0x326578(0xec)]+_0x326578(0x154));if(fs_1['default']['existsSync'](this[_0x326578(0xcd)])&&fs_1['default']['existsSync'](this[_0x326578(0x17f)])){const _0x21c654=fs_1[_0x326578(0x1cf)]['readFileSync'](this['visaPrivateKeyPath'],_0x326578(0x18a))['trim'](),_0x5405c6=fs_1[_0x326578(0x1cf)][_0x326578(0x156)](this[_0x326578(0x17f)],'utf8')[_0x326578(0x131)]();(!_0x21c654[_0x326578(0xa7)](_0x326578(0x12f))||!_0x21c654[_0x326578(0xa7)]('-----END'))&&console[_0x326578(0xfd)](_0x326578(0x1d5)),(!_0x5405c6[_0x326578(0xa7)](_0x326578(0x12f))||!_0x5405c6[_0x326578(0xa7)](_0x326578(0xf1)))&&console[_0x326578(0xfd)](_0x326578(0x167)),console[_0x326578(0x15a)]('âœ…\x20VISA\x20key\x20files\x20validated\x20successfully'),console[_0x326578(0x15a)](_0x326578(0x111)+_0x21c654[_0x326578(0xec)]+_0x326578(0x154)),console[_0x326578(0x15a)](_0x326578(0xb3)+_0x5405c6[_0x326578(0xec)]+_0x326578(0x154));}else console[_0x326578(0xfd)](_0x326578(0xf2)),console['warn'](_0x326578(0x132)+this['visaPrivateKeyPath']),console[_0x326578(0xfd)]('âš ï¸\x20Expected\x20VISA\x20public\x20key:\x20'+this[_0x326578(0x17f)]);}catch(_0x27d14b){console[_0x326578(0xb7)](_0x326578(0x11d),_0x27d14b);throw _0x27d14b;}}[a57_0x33dd50(0x10c)](){const _0x1a2e56=a57_0x33dd50,_0x281d20=crypto_1['default'][_0x1a2e56(0x1d6)](0x20),_0x3664c2=crypto_1[_0x1a2e56(0x1cf)]['randomBytes'](0x10);return{'key':_0x281d20,'iv':_0x3664c2};}[a57_0x33dd50(0xff)](_0x3fe4c9,_0x2b5b15,_0x57b541){const _0x200756=a57_0x33dd50,_0x43c92c=crypto_1['default'][_0x200756(0x1b2)]('aes-256-ctr',_0x2b5b15,_0x57b541);let _0x4a3e64=_0x43c92c[_0x200756(0x16a)](_0x3fe4c9,_0x200756(0x18a),'base64');return _0x4a3e64+=_0x43c92c[_0x200756(0xaf)](_0x200756(0x95)),_0x4a3e64;}['encryptRSA'](_0x5dadda,_0x3d3155,_0x134d06){const _0x3c659d=a57_0x33dd50;try{const _0x8a572d=fs_1['default'][_0x3c659d(0x156)](_0x134d06,_0x3c659d(0x18a))[_0x3c659d(0x131)](),_0x35be4c={'iv':_0x3d3155[_0x3c659d(0x1de)](_0x3c659d(0x95)),'key':_0x5dadda[_0x3c659d(0x1de)](_0x3c659d(0x95))},_0x1d63e8=JSON[_0x3c659d(0x14c)](_0x35be4c);console[_0x3c659d(0x15a)](_0x3c659d(0x108),_0x1d63e8[_0x3c659d(0xec)]);const _0x38a27e=crypto_1[_0x3c659d(0x1cf)][_0x3c659d(0x114)]({'key':_0x8a572d,'padding':crypto_1[_0x3c659d(0x1cf)][_0x3c659d(0x17d)][_0x3c659d(0x146)]},Buffer[_0x3c659d(0x15d)](_0x1d63e8));return console[_0x3c659d(0x15a)](_0x3c659d(0x1a7),_0x38a27e[_0x3c659d(0xec)]),_0x38a27e[_0x3c659d(0x1de)](_0x3c659d(0x95));}catch(_0x8be05f){console[_0x3c659d(0xb7)]('âŒ\x20RSA\x20encryption\x20failed:',_0x8be05f);throw new Error(_0x3c659d(0x1a1));}}[a57_0x33dd50(0x104)](_0x5c057a,_0x570bca){const _0x563878=a57_0x33dd50;try{const _0x3691ab=fs_1['default'][_0x563878(0x156)](_0x570bca,'utf8')['trim'](),_0x2c19d2=crypto_1['default']['createSign']('SHA256');_0x2c19d2['update'](_0x5c057a),_0x2c19d2[_0x563878(0xcb)]();const _0x267610=_0x2c19d2[_0x563878(0xbd)](_0x3691ab,_0x563878(0x95));return console[_0x563878(0x15a)](_0x563878(0x1a6)),console[_0x563878(0x15a)](_0x563878(0xc8),_0x5c057a['length']),console['log'](_0x563878(0x13d),_0x267610[_0x563878(0xec)]),_0x267610;}catch(_0x265d67){console[_0x563878(0xb7)](_0x563878(0x126),_0x265d67),console[_0x563878(0xb7)]('âŒ\x20Data\x20being\x20signed:',_0x5c057a['substring'](0x0,0xc8)+'...');throw new Error(_0x563878(0x144));}}[a57_0x33dd50(0x9c)](_0x4a4722,_0x393fd8,_0x10c097){const _0x13c181=a57_0x33dd50,_0x2be1c9=crypto_1[_0x13c181(0x1cf)][_0x13c181(0x19b)](_0x13c181(0x1c5),_0x393fd8,_0x10c097);let _0x2ae16b=_0x2be1c9[_0x13c181(0x16a)](_0x4a4722,_0x13c181(0x95),_0x13c181(0x18a));return _0x2ae16b+=_0x2be1c9[_0x13c181(0xaf)]('utf8'),_0x2ae16b;}async[a57_0x33dd50(0x1cc)](_0x312740,_0x13fe4c,_0xdde03b=a57_0x33dd50(0x1e5)){const _0x454902=a57_0x33dd50;try{const _0xfa9448=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x454902(0x148),'headers':{'Content-Type':_0x454902(0x129)},'body':JSON[_0x454902(0x14c)]({'info':_0x312740,'key':_0x13fe4c,'card_type':_0xdde03b[_0x454902(0x112)]()})});if(!_0xfa9448['ok'])throw new Error(_0x454902(0x18b));return await _0xfa9448[_0x454902(0x1b0)]();}catch(_0x1c2b78){console['error'](_0x454902(0x16b),_0x1c2b78);throw new Error(_0x454902(0x195));}}[a57_0x33dd50(0x1db)](_0x531ffa,_0x36e3dd){const _0x2a8178=a57_0x33dd50;try{const _0x18be16=fs_1[_0x2a8178(0x1cf)][_0x2a8178(0x156)](this['privateKeyPath'],_0x2a8178(0x18a))[_0x2a8178(0x131)](),_0x5a5626=crypto_1[_0x2a8178(0x1cf)]['privateDecrypt'](_0x18be16,Buffer[_0x2a8178(0x15d)](_0x36e3dd,'base64')),_0x228eb3=JSON[_0x2a8178(0x10e)](_0x5a5626[_0x2a8178(0x1de)]()),_0x2bcbe6=Buffer[_0x2a8178(0x15d)](_0x228eb3[_0x2a8178(0xce)],_0x2a8178(0x95)),_0xafe5ac=Buffer[_0x2a8178(0x15d)](_0x228eb3['iv'],_0x2a8178(0x95));return this['decryptAES'](_0x531ffa,_0x2bcbe6,_0xafe5ac);}catch(_0x57d64a){throw new Error('Failed\x20to\x20decrypt\x20response');}}async['processCardPayment'](_0x401bf1){const _0x506f66=a57_0x33dd50,{paymentId:_0x13d741,orderId:_0x13f1d9,amount:_0x13e22f,currency:_0x4ea8a0,cardData:_0x2153e4,resultUrl:_0x15006a,returnUrl:_0x4f04aa,cardHolder:_0x2387b3,browser:_0x3bf031}=_0x401bf1;console[_0x506f66(0x15a)](_0x506f66(0x12d)),console[_0x506f66(0x15a)](_0x506f66(0x12c),_0x13d741),console['log'](_0x506f66(0x1c2),_0x13f1d9),console[_0x506f66(0x15a)](_0x506f66(0x98),_0x13e22f,_0x4ea8a0),console[_0x506f66(0x15a)](_0x506f66(0x121),this[_0x506f66(0xb8)](_0x2153e4[_0x506f66(0x17a)])),console[_0x506f66(0x15a)](_0x506f66(0x1cd),_0x2387b3[_0x506f66(0x196)]+'\x20'+_0x2387b3[_0x506f66(0xa6)]),console[_0x506f66(0x15a)](_0x506f66(0xbf),_0x4f04aa),console['log']('Result\x20URL:',_0x15006a);const _0x5c5741=this['getCardTypeAndApi'](_0x2153e4[_0x506f66(0x17a)]);console[_0x506f66(0x15a)]('ğŸ¯\x20Using\x20'+_0x5c5741['cardType']+_0x506f66(0xac)+_0x5c5741[_0x506f66(0x134)]),console[_0x506f66(0x15a)](_0x506f66(0xf4)+_0x5c5741[_0x506f66(0x17b)]+',\x20'+_0x5c5741[_0x506f66(0xc4)]);const _0x3e82c2={..._0x2387b3,'first_name':_0x2387b3['first_name']?.[_0x506f66(0x139)](/[\t\n\r\f\v]/g,'\x20')[_0x506f66(0x131)]()||'','last_name':_0x2387b3[_0x506f66(0xa6)]?.[_0x506f66(0x139)](/[\t\n\r\f\v]/g,'\x20')[_0x506f66(0x131)]()||''};console[_0x506f66(0x15a)](_0x506f66(0x145)),console[_0x506f66(0x15a)](_0x506f66(0xe9)+_0x2387b3[_0x506f66(0x196)]+'\x22\x20|\x20\x22'+_0x2387b3[_0x506f66(0xa6)]+'\x22'),console[_0x506f66(0x15a)](_0x506f66(0xb2)+_0x3e82c2[_0x506f66(0x196)]+_0x506f66(0x14a)+_0x3e82c2[_0x506f66(0xa6)]+'\x22');const _0x32a4b3={'amount':_0x13e22f,'currency':_0x4ea8a0[_0x506f66(0x96)](),'order_id':_0x13f1d9,'result_url':_0x15006a,'return_url':_0x4f04aa,'country':'','card':{'number':_0x2153e4[_0x506f66(0x17a)],'expire_month':_0x2153e4[_0x506f66(0x1c1)],'expire_year':_0x2153e4['expire_year'],'cvv':_0x2153e4[_0x506f66(0x178)]},'card_holder':_0x3e82c2,'browser':_0x3bf031},_0x16148a=JSON[_0x506f66(0x14c)](_0x32a4b3);console[_0x506f66(0x15a)](_0x506f66(0x164)),console[_0x506f66(0x15a)](_0x506f66(0x1d9)),console['log'](_0x16148a),console[_0x506f66(0x15a)]('ğŸ“\x20Data\x20length:',_0x16148a[_0x506f66(0xec)]);try{const {key:_0x34aa74,iv:_0x685656}=this['generateAESKey']();console['log'](_0x506f66(0xba)),console['log'](_0x506f66(0x1d3),_0x34aa74['length']),console[_0x506f66(0x15a)](_0x506f66(0x1dd),_0x685656['length']);const _0x36aacb=this[_0x506f66(0xff)](_0x16148a,_0x34aa74,_0x685656);console['log']('ğŸ”\x20Data\x20encrypted\x20with\x20AES'),console[_0x506f66(0x15a)]('ğŸ“\x20Encrypted\x20data\x20length:',_0x36aacb[_0x506f66(0xec)]);const _0x2a75e9=this[_0x506f66(0x15b)](_0x34aa74,_0x685656,_0x5c5741[_0x506f66(0xc4)]);console[_0x506f66(0x15a)](_0x506f66(0x106)),console[_0x506f66(0x15a)](_0x506f66(0x1a5),_0x2a75e9['length']);const _0x45f144=this[_0x506f66(0x104)](_0x16148a,_0x5c5741[_0x506f66(0x17b)]);console[_0x506f66(0x15a)](_0x506f66(0xe8)),console[_0x506f66(0x15a)]('ğŸ“\x20Signature\x20length:',_0x45f144[_0x506f66(0xec)]);const _0x37a9f7={'merchant_point_id':_0x5c5741[_0x506f66(0x136)],'method':'charge','info':_0x36aacb,'key':_0x2a75e9,'sign':_0x45f144,'lang':'en'};console[_0x506f66(0x15a)](_0x506f66(0x186)),console[_0x506f66(0x15a)](_0x506f66(0x16e)),console[_0x506f66(0x15a)](_0x506f66(0x137),_0x5c5741[_0x506f66(0x136)]),console['log']('\x20\x20\x20-\x20method:\x20charge'),console['log']('\x20\x20\x20-\x20info\x20length:',_0x36aacb[_0x506f66(0xec)]),console[_0x506f66(0x15a)](_0x506f66(0x138),_0x2a75e9[_0x506f66(0xec)]),console[_0x506f66(0x15a)](_0x506f66(0x10f),_0x45f144['length']),console['log']('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x506f66(0x149)]['logWhiteDomainRequest'](_0x5c5741[_0x506f66(0x91)][_0x506f66(0x112)](),_0x506f66(0x15f),_0x506f66(0x148),{'merchant_point_id':_0x5c5741[_0x506f66(0x136)],'method':_0x506f66(0x12b),'lang':'en'});const _0x304a46=Date[_0x506f66(0x8f)](),_0x3e5d79=await fetch(_0x5c5741[_0x506f66(0x134)],{'method':_0x506f66(0x148),'headers':{'Content-Type':_0x506f66(0x129),'Accept':'application/json','User-Agent':_0x506f66(0x1d0)},'body':JSON[_0x506f66(0x14c)](_0x37a9f7)}),_0x1b6258=Date[_0x506f66(0x8f)]()-_0x304a46;console[_0x506f66(0x15a)](_0x506f66(0x1b9)),console[_0x506f66(0x15a)](_0x506f66(0x13f),_0x3e5d79[_0x506f66(0xe1)]),console[_0x506f66(0x15a)](_0x506f66(0x176),_0x1b6258+'ms');if(!_0x3e5d79['ok']){const _0x3fae82=await _0x3e5d79[_0x506f66(0x1b0)]();console[_0x506f66(0xb7)](_0x506f66(0x1a8),_0x3e5d79[_0x506f66(0xe1)]),console[_0x506f66(0xb7)](_0x506f66(0xa0),_0x3fae82),loggerService_1[_0x506f66(0x149)]['logWhiteDomainResponse'](_0x5c5741[_0x506f66(0x91)][_0x506f66(0x112)](),_0x506f66(0x16f),_0x3e5d79[_0x506f66(0xe1)],_0x3fae82,_0x1b6258),loggerService_1[_0x506f66(0x149)][_0x506f66(0x1d8)](_0x5c5741[_0x506f66(0x91)][_0x506f66(0x112)](),'/charge','HTTP\x20'+_0x3e5d79[_0x506f66(0xe1)]+':\x20'+_0x3fae82);throw new Error(_0x506f66(0x110)+_0x3e5d79['status']+_0x506f66(0x135)+_0x3fae82);}const _0x45d382=await _0x3e5d79[_0x506f66(0x168)]();loggerService_1[_0x506f66(0x149)]['logWhiteDomainResponse'](_0x5c5741['cardType'][_0x506f66(0x112)](),_0x506f66(0x16f),_0x3e5d79[_0x506f66(0xe1)],_0x45d382,_0x1b6258),console[_0x506f66(0x15a)](_0x506f66(0xc6));let _0x52a304=_0x45d382;if(_0x45d382[_0x506f66(0xe4)]&&_0x45d382[_0x506f66(0xce)]&&_0x45d382['sign']){console['log'](_0x506f66(0x14b));try{const _0x1bec39=await this[_0x506f66(0x1cc)](_0x45d382['info'],_0x45d382[_0x506f66(0xce)],_0x5c5741[_0x506f66(0x91)]);_0x52a304=JSON[_0x506f66(0x10e)](_0x1bec39),console['log']('âœ…\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0x506f66(0x149)][_0x506f66(0x183)](_0x5c5741[_0x506f66(0x91)][_0x506f66(0x112)](),'/charge_decrypted',_0x3e5d79[_0x506f66(0xe1)],_0x52a304,_0x1b6258),console[_0x506f66(0x15a)](_0x506f66(0x1c3));}catch(_0x193bc8){console[_0x506f66(0xb7)](_0x506f66(0x8e),_0x193bc8),loggerService_1['loggerService']['logWhiteDomainError'](_0x5c5741[_0x506f66(0x91)][_0x506f66(0x112)](),_0x506f66(0x133),_0x506f66(0x9d)+_0x193bc8),_0x52a304=_0x45d382;}}else loggerService_1[_0x506f66(0x149)]['logWhiteDomainResponse'](_0x5c5741[_0x506f66(0x91)][_0x506f66(0x112)](),'/charge_decrypted',_0x3e5d79[_0x506f66(0xe1)],_0x52a304,_0x1b6258),console['log']('ğŸ“\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x506f66(0x15a)](_0x506f66(0x13f),_0x52a304['status']),console[_0x506f66(0x15a)](_0x506f66(0x174),_0x52a304[_0x506f66(0xaf)]),console[_0x506f66(0x15a)]('Payment\x20ID:',_0x52a304[_0x506f66(0xa1)]),console['log'](_0x506f66(0x10a),_0x52a304[_0x506f66(0x18c)]||'none');if(_0x52a304[_0x506f66(0xe1)]===0x64&&_0x52a304['final']===0x1)return console[_0x506f66(0x15a)](_0x506f66(0x1e0)),{'gateway_payment_id':_0x52a304[_0x506f66(0xa1)]?.[_0x506f66(0x1de)](),'payment_url':_0x4f04aa,'requires_3ds':![],'status':_0x506f66(0x1bf),'final':!![]};if(_0x52a304[_0x506f66(0x18c)])return console[_0x506f66(0x15a)](_0x506f66(0xc2)),this[_0x506f66(0x11f)](_0x13d741,_0x13f1d9,_0x52a304[_0x506f66(0xa1)]?.[_0x506f66(0x1de)]()||_0x13f1d9,_0x5c5741[_0x506f66(0x91)]),{'gateway_payment_id':_0x52a304['payment_id']?.[_0x506f66(0x1de)](),'payment_url':_0x52a304[_0x506f66(0x18c)],'requires_3ds':!![],'threeds_url':_0x52a304['3ds_url'],'status':_0x506f66(0xf8),'final':![]};let _0x5e9e82=this['getDetailedErrorMessage'](_0x52a304[_0x506f66(0xe1)],_0x52a304['desc']||_0x52a304[_0x506f66(0x11a)]),_0x83fd91=_0x52a304['status'],_0x1e28de=this[_0x506f66(0x19c)](_0x52a304[_0x506f66(0xe1)]);return console['log'](_0x506f66(0xe2)+_0x83fd91+',\x20Final:\x20'+_0x1e28de+_0x506f66(0x119)+_0x5e9e82),{'gateway_payment_id':_0x52a304[_0x506f66(0xa1)]?.[_0x506f66(0x1de)](),'payment_url':_0x4f04aa,'requires_3ds':![],'status':'FAILED','final':!![],'errorMessage':_0x5e9e82};}catch(_0x515dd7){console[_0x506f66(0xb7)](_0x506f66(0x162)),console[_0x506f66(0xb7)](_0x506f66(0xfb),_0x515dd7),loggerService_1[_0x506f66(0x149)]['logWhiteDomainError'](_0x506f66(0x115),_0x506f66(0x15f),_0x515dd7);throw new Error(_0x506f66(0xe5)+(_0x515dd7 instanceof Error?_0x515dd7['message']:_0x506f66(0x1eb)));}}async[a57_0x33dd50(0x18e)](_0x1373d6,_0x152d0c,_0x2e1473=a57_0x33dd50(0x11b)){const _0x5606fc=a57_0x33dd50;console[_0x5606fc(0x15a)]('ğŸ“Š\x20Checking\x20'+_0x2e1473+_0x5606fc(0x151)+_0x1373d6+'\x20('+_0x152d0c+')');try{const _0x413791={'payment_id':_0x1373d6,'order_id':_0x152d0c},_0x75dc01=JSON[_0x5606fc(0x14c)](_0x413791),_0x1b53f1=this[_0x5606fc(0x1e3)](_0x2e1473===_0x5606fc(0x11b)?_0x5606fc(0xfa):_0x5606fc(0x1e7)),{key:_0x1224f1,iv:_0xf8a9b4}=this['generateAESKey'](),_0x36e463=this[_0x5606fc(0xff)](_0x75dc01,_0x1224f1,_0xf8a9b4),_0x53cf53=this[_0x5606fc(0x15b)](_0x1224f1,_0xf8a9b4,_0x1b53f1[_0x5606fc(0xc4)]),_0xff2e2=this[_0x5606fc(0x104)](_0x75dc01,_0x1b53f1[_0x5606fc(0x17b)]),_0xbc2510={'merchant_point_id':_0x1b53f1[_0x5606fc(0x136)],'method':_0x5606fc(0xe1),'info':_0x36e463,'key':_0x53cf53,'sign':_0xff2e2,'lang':'en'};loggerService_1[_0x5606fc(0x149)][_0x5606fc(0xda)](_0x2e1473['toLowerCase'](),_0x5606fc(0x9e),_0x5606fc(0x148),{'merchant_point_id':_0x1b53f1[_0x5606fc(0x136)],'method':'status','lang':'en'});const _0x1c9462=Date['now'](),_0x4f89b0=await fetch(_0x1b53f1['apiUrl'],{'method':_0x5606fc(0x148),'headers':{'Content-Type':_0x5606fc(0x129),'Accept':_0x5606fc(0x129),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x5606fc(0x14c)](_0xbc2510)}),_0x53e764=Date[_0x5606fc(0x8f)]()-_0x1c9462;if(!_0x4f89b0['ok']){const _0x2a21b3=await _0x4f89b0[_0x5606fc(0x1b0)]();loggerService_1[_0x5606fc(0x149)][_0x5606fc(0x183)](_0x2e1473[_0x5606fc(0x112)](),_0x5606fc(0x170),_0x4f89b0[_0x5606fc(0xe1)],_0x2a21b3,_0x53e764);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4f89b0[_0x5606fc(0xe1)]);}const _0x24ff3f=await _0x4f89b0['json']();loggerService_1[_0x5606fc(0x149)][_0x5606fc(0x183)](_0x2e1473[_0x5606fc(0x112)](),_0x5606fc(0x170),_0x4f89b0['status'],_0x24ff3f,_0x53e764);let _0x504ce1=_0x24ff3f;if(_0x24ff3f['info']&&_0x24ff3f['key']&&_0x24ff3f[_0x5606fc(0xbd)]){console[_0x5606fc(0x15a)](_0x5606fc(0x1e8));try{const _0x45a5d2=await this['decryptResponsePhp'](_0x24ff3f[_0x5606fc(0xe4)],_0x24ff3f[_0x5606fc(0xce)],_0x2e1473);_0x504ce1=JSON[_0x5606fc(0x10e)](_0x45a5d2),console['log']('âœ…\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x5606fc(0x149)][_0x5606fc(0x183)](_0x2e1473[_0x5606fc(0x112)](),_0x5606fc(0x140),_0x4f89b0['status'],_0x504ce1,_0x53e764),console[_0x5606fc(0x15a)](_0x5606fc(0xcc));}catch(_0x27a979){console[_0x5606fc(0xb7)](_0x5606fc(0x101),_0x27a979),loggerService_1['loggerService'][_0x5606fc(0x1d8)](_0x2e1473[_0x5606fc(0x112)](),_0x5606fc(0x18d),_0x5606fc(0x1b3)+_0x27a979),_0x504ce1=_0x24ff3f;}}else loggerService_1[_0x5606fc(0x149)][_0x5606fc(0x183)](_0x2e1473[_0x5606fc(0x112)](),_0x5606fc(0x140),_0x4f89b0['status'],_0x504ce1,_0x53e764),console['log']('ğŸ“\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console['log'](_0x5606fc(0xf6),{'status':_0x504ce1['status'],'final':_0x504ce1[_0x5606fc(0xaf)],'payment_id':_0x504ce1[_0x5606fc(0xa1)],'desc':_0x504ce1[_0x5606fc(0x182)]});let _0x516cf0=_0x5606fc(0xf8);if(_0x504ce1['status']===0x64&&_0x504ce1[_0x5606fc(0xaf)]===0x1)_0x516cf0=_0x5606fc(0x1bf);else{if(_0x504ce1[_0x5606fc(0xaf)]===0x0||!this['isFinalStatus'](_0x504ce1[_0x5606fc(0xe1)]))_0x516cf0=_0x5606fc(0xf8);else _0x504ce1['final']===0x1||this[_0x5606fc(0x19c)](_0x504ce1['status'])?_0x516cf0=_0x5606fc(0x1ec):_0x516cf0=_0x5606fc(0xf8);}const _0x24a268=this['getDetailedErrorMessage'](_0x504ce1['status'],_0x504ce1['desc']);return{'status':_0x516cf0,'final':this[_0x5606fc(0x19c)](_0x504ce1['status']),'amount':_0x504ce1[_0x5606fc(0x1b5)],'currency':_0x504ce1[_0x5606fc(0x1ce)],'date_success':_0x504ce1[_0x5606fc(0xd7)],'description':_0x24a268};}catch(_0x2bcdd4){console[_0x5606fc(0xb7)](_0x2e1473+_0x5606fc(0xc3),_0x2bcdd4),loggerService_1[_0x5606fc(0x149)][_0x5606fc(0x1d8)](_0x2e1473[_0x5606fc(0x112)](),'/status',_0x2bcdd4);throw new Error(_0x5606fc(0x1ea)+_0x2e1473+_0x5606fc(0x151)+(_0x2bcdd4 instanceof Error?_0x2bcdd4[_0x5606fc(0x11a)]:_0x5606fc(0x1eb)));}}[a57_0x33dd50(0x11f)](_0x3f29dd,_0x1667e3,_0x5377ed,_0x3e5793){const _0x2026f4=a57_0x33dd50;console[_0x2026f4(0x15a)]('â°\x20Scheduling\x20status\x20checks\x20for\x20'+_0x3e5793+_0x2026f4(0x1cb)+_0x3f29dd+'\x20('+_0x5377ed+')'),this[_0x2026f4(0x181)](_0x3f29dd);const _0x444f2c=[],_0x2c16c5=0x5*0x3c*0x3e8,_0x4d2510=0x2*0x3c*0x3c*0x3e8,_0x434239=Math[_0x2026f4(0x19d)](_0x4d2510/_0x2c16c5);console[_0x2026f4(0x15a)](_0x2026f4(0x1b1)+_0x434239+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x1e819c=0x1;_0x1e819c<=_0x434239;_0x1e819c++){const _0x35acf0=setTimeout(async()=>{const _0x2b6acb=_0x2026f4;console['log'](_0x2b6acb(0x92)+_0x3e5793+_0x2b6acb(0x90)+_0x1e819c+'/'+_0x434239+_0x2b6acb(0x105)+_0x3f29dd);try{const _0x367efa=await this[_0x2b6acb(0x18e)](_0x5377ed,_0x1667e3,_0x3e5793);console['log'](_0x2b6acb(0xb5)+_0x1e819c+_0x2b6acb(0xe3),_0x367efa),_0x367efa['final']&&(console['log'](_0x2b6acb(0x118)+_0x3f29dd+'\x20is\x20final\x20('+_0x367efa[_0x2b6acb(0xe1)]+'),\x20stopping\x20status\x20checks'),this[_0x2b6acb(0x181)](_0x3f29dd),await this[_0x2b6acb(0x166)](_0x3f29dd,_0x367efa[_0x2b6acb(0xe1)],_0x367efa));}catch(_0x5e40f3){console[_0x2b6acb(0xb7)]('âŒ\x20Status\x20check\x20#'+_0x1e819c+'\x20failed\x20for\x20payment\x20'+_0x3f29dd+':',_0x5e40f3);}},_0x1e819c*_0x2c16c5);_0x444f2c[_0x2026f4(0x1bb)](_0x35acf0);}this[_0x2026f4(0x93)]['set'](_0x3f29dd,_0x444f2c),console[_0x2026f4(0x15a)](_0x2026f4(0x165)+_0x434239+_0x2026f4(0x157)+_0x3f29dd);}[a57_0x33dd50(0x181)](_0xd27894){const _0x27cc99=a57_0x33dd50,_0x324002=this[_0x27cc99(0x93)][_0x27cc99(0x17e)](_0xd27894);_0x324002&&(console[_0x27cc99(0x15a)]('ğŸ§¹\x20Clearing\x20'+_0x324002[_0x27cc99(0xec)]+'\x20status\x20timers\x20for\x20payment\x20'+_0xd27894),_0x324002[_0x27cc99(0x143)]((_0x3c9a89,_0x17be24)=>{clearTimeout(_0x3c9a89);}),this[_0x27cc99(0x93)]['delete'](_0xd27894));}async['updatePaymentStatus'](_0x3c511e,_0x3a7260,_0x5d98ad){const _0x4d6c91=a57_0x33dd50;try{const _0xbbea76=(await Promise[_0x4d6c91(0x1ab)]()[_0x4d6c91(0xdd)](()=>__importStar(require(_0x4d6c91(0xc1)))))[_0x4d6c91(0x1cf)],_0x54122c={'status':_0x3a7260['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x4d6c91(0x1dc),'statusChangedAt':new Date()};_0x3a7260===_0x4d6c91(0x1bf)&&(_0x54122c[_0x4d6c91(0x1df)]=new Date()),_0x3a7260==='FAILED'&&_0x5d98ad[_0x4d6c91(0x199)]&&(_0x54122c[_0x4d6c91(0x97)]=_0x5d98ad['description'],console['log']('ğŸ’¾\x20Saving\x20failure\x20message:\x20'+_0x5d98ad[_0x4d6c91(0x199)])),await _0xbbea76[_0x4d6c91(0xb9)][_0x4d6c91(0x16a)]({'where':{'id':_0x3c511e},'data':_0x54122c}),console[_0x4d6c91(0x15a)](_0x4d6c91(0x118)+_0x3c511e+_0x4d6c91(0xbb)+_0x3a7260),await this[_0x4d6c91(0xd8)](_0x3c511e,_0x3a7260);}catch(_0x1b46a0){console['error'](_0x4d6c91(0x16d)+_0x3c511e+':',_0x1b46a0);}}async[a57_0x33dd50(0xd8)](_0x4daf49,_0x25d189){const _0xd2b2c2=a57_0x33dd50;try{const _0x33ab30=(await Promise[_0xd2b2c2(0x1ab)]()[_0xd2b2c2(0xdd)](()=>__importStar(require(_0xd2b2c2(0xc1)))))['default'],{telegramBotService:_0x1be992}=await Promise[_0xd2b2c2(0x1ab)]()[_0xd2b2c2(0xdd)](()=>__importStar(require('../telegramBotService'))),_0x44b063=await _0x33ab30[_0xd2b2c2(0xb9)][_0xd2b2c2(0xf9)]({'where':{'id':_0x4daf49},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x44b063)return;const _0x2aa811={'PAID':_0xd2b2c2(0xed),'FAILED':_0xd2b2c2(0x141)},_0x57a506=_0x2aa811[_0x25d189];_0x57a506&&await _0x1be992[_0xd2b2c2(0x13e)](_0x44b063[_0xd2b2c2(0x197)],_0x44b063,_0x57a506),await this[_0xd2b2c2(0xb1)](_0x44b063,_0x25d189);}catch(_0x569f4a){console[_0xd2b2c2(0xb7)](_0xd2b2c2(0x12e),_0x569f4a);}}async[a57_0x33dd50(0xb1)](_0x3668c0,_0x31adbb){const _0x9e0d29=a57_0x33dd50,_0xb04d04=Date['now']();try{const _0x3e90f9=_0x3668c0[_0x9e0d29(0xad)],_0x4b41a0=_0x3e90f9[_0x9e0d29(0x18f)];if(!_0x4b41a0?.[_0x9e0d29(0x14f)]){console['log'](_0x9e0d29(0xbe)+_0x3e90f9['id']);return;}const _0x3f1f7d=_0x31adbb===_0x9e0d29(0x1bf)?_0x9e0d29(0x1e9):_0x9e0d29(0x13c);let _0x3360a0=[];if(_0x4b41a0[_0x9e0d29(0x1b8)])try{_0x3360a0=Array[_0x9e0d29(0x171)](_0x4b41a0['webhookEvents'])?_0x4b41a0[_0x9e0d29(0x1b8)]:JSON[_0x9e0d29(0x10e)](_0x4b41a0[_0x9e0d29(0x1b8)]);}catch(_0x55f804){console[_0x9e0d29(0xb7)](_0x9e0d29(0xbc),_0x55f804),_0x3360a0=[];}if(!_0x3360a0[_0x9e0d29(0xa7)](_0x3f1f7d)){console[_0x9e0d29(0x15a)](_0x9e0d29(0x1af)+_0x3f1f7d+_0x9e0d29(0x169)+_0x3e90f9['id']);return;}const _0x3c1628={'event':_0x3f1f7d,'payment':{'id':_0x3668c0['id'],'order_id':_0x3668c0[_0x9e0d29(0x125)],'gateway_order_id':_0x3668c0[_0x9e0d29(0xa5)],'gateway':_0x9e0d29(0xe6),'amount':_0x3668c0[_0x9e0d29(0x1b5)],'currency':_0x3668c0[_0x9e0d29(0x1ce)],'status':_0x31adbb['toLowerCase'](),'customer_email':_0x3668c0[_0x9e0d29(0xf0)],'customer_name':_0x3668c0[_0x9e0d29(0x130)],'created_at':_0x3668c0[_0x9e0d29(0xa9)],'updated_at':new Date()}},_0x51cfd5=await fetch(_0x4b41a0[_0x9e0d29(0x14f)],{'method':_0x9e0d29(0x148),'headers':{'Content-Type':_0x9e0d29(0x129),'User-Agent':'Payment\x20System/1.0\x20(MasterCard)'},'body':JSON[_0x9e0d29(0x14c)](_0x3c1628)}),_0x4cfd72=Date[_0x9e0d29(0x8f)]()-_0xb04d04;loggerService_1[_0x9e0d29(0x149)][_0x9e0d29(0x159)](_0x3668c0[_0x9e0d29(0x197)],_0x4b41a0[_0x9e0d29(0x14f)],_0x3f1f7d,_0x51cfd5['status'],_0x4cfd72,_0x3c1628),console[_0x9e0d29(0x15a)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x4b41a0[_0x9e0d29(0x14f)]+'\x20with\x20status\x20'+_0x51cfd5[_0x9e0d29(0xe1)]+'\x20('+_0x4cfd72+_0x9e0d29(0x1ca));}catch(_0xce3e91){console[_0x9e0d29(0xb7)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0xce3e91),loggerService_1[_0x9e0d29(0x149)][_0x9e0d29(0x175)](_0x3668c0[_0x9e0d29(0x197)],_0x3668c0[_0x9e0d29(0xad)]?.[_0x9e0d29(0x18f)]?.['webhookUrl']||_0x9e0d29(0x1e6),_0x9e0d29(0x1a4),_0xce3e91,{});}}[a57_0x33dd50(0xb8)](_0x5a1c22){const _0x444274=a57_0x33dd50,_0x150a63=_0x5a1c22[_0x444274(0x139)](/[\s-]/g,'');if(_0x150a63['length']<0x4)return _0x444274(0x17c);return _0x444274(0x122)+_0x150a63[_0x444274(0xd2)](-0x4);}async[a57_0x33dd50(0xd4)](_0x58b172,_0xb1e897=a57_0x33dd50(0x1e5)){const _0x3839ed=a57_0x33dd50;console[_0x3839ed(0x15a)](_0x3839ed(0xd9),JSON[_0x3839ed(0x14c)](_0x58b172,null,0x2));let _0x822170=_0x58b172,_0x24402b=_0xb1e897;_0x58b172[_0x3839ed(0xaa)]?(_0x24402b=_0x58b172[_0x3839ed(0xaa)]['toUpperCase']()===_0x3839ed(0x11b)?'VISA':'MASTERCARD',console[_0x3839ed(0x15a)](_0x3839ed(0x1b4)+_0x24402b)):console[_0x3839ed(0x15a)](_0x3839ed(0x9b)+_0x24402b);if(_0x58b172[_0x3839ed(0xe4)]&&_0x58b172['key']&&_0x58b172[_0x3839ed(0xbd)]){console['log'](_0x3839ed(0xdf));try{const _0x14015b=await this[_0x3839ed(0x1cc)](_0x58b172['info'],_0x58b172['key'],_0x24402b);_0x822170=JSON[_0x3839ed(0x10e)](_0x14015b),console[_0x3839ed(0x15a)](_0x3839ed(0x1bd)),console[_0x3839ed(0x15a)](_0x3839ed(0xa2),JSON['stringify'](_0x822170,null,0x2));}catch(_0x2b1cb0){console[_0x3839ed(0xb7)](_0x3839ed(0x14d),_0x2b1cb0),console[_0x3839ed(0x15a)]('âš ï¸\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted'),_0x822170=_0x58b172;}}else console[_0x3839ed(0x15a)](_0x3839ed(0x190));let _0x29e27b=_0x3839ed(0xf8);if(_0x822170[_0x3839ed(0xe1)]===0x64&&_0x822170[_0x3839ed(0xaf)]===0x1)_0x29e27b=_0x3839ed(0x1bf);else{if(_0x822170['final']===0x0||!this[_0x3839ed(0x19c)](_0x822170['status']))_0x29e27b='PENDING';else _0x822170[_0x3839ed(0xaf)]===0x1||this[_0x3839ed(0x19c)](_0x822170[_0x3839ed(0xe1)])?_0x29e27b=_0x3839ed(0x1ec):_0x29e27b=_0x3839ed(0xf8);}let _0x2c78ed='';if(_0x822170[_0x3839ed(0x189)])_0x2c78ed=_0x822170[_0x3839ed(0x189)][_0x3839ed(0x1de)](),console['log'](_0x3839ed(0x103)+_0x24402b+_0x3839ed(0x1c4)+_0x2c78ed);else _0x822170['payment_id']?(_0x2c78ed=_0x822170[_0x3839ed(0xa1)][_0x3839ed(0x1de)](),console[_0x3839ed(0x15a)](_0x3839ed(0x103)+_0x24402b+_0x3839ed(0xee)+_0x2c78ed)):(_0x2c78ed=_0x822170[_0x3839ed(0x125)]||_0x822170[_0x3839ed(0xeb)]||_0x822170['id']||'',console['log'](_0x3839ed(0xe7)+_0x2c78ed));console[_0x3839ed(0x15a)](_0x3839ed(0x1b7)+_0x24402b+'\x20webhook\x20extracted\x20data:'),console[_0x3839ed(0x15a)](_0x3839ed(0x147)+_0x2c78ed+'\x20(from:\x20order_id='+_0x822170[_0x3839ed(0x189)]+',\x20orderId='+_0x822170[_0x3839ed(0x125)]+',\x20payment_id='+_0x822170[_0x3839ed(0xa1)]+_0x3839ed(0x9f)+_0x822170[_0x3839ed(0xeb)]+_0x3839ed(0x117)+_0x822170['id']+')'),console[_0x3839ed(0x15a)](_0x3839ed(0xe0)+_0x29e27b+_0x3839ed(0x10d)+_0x822170[_0x3839ed(0xe1)]+_0x3839ed(0x1e1)+_0x822170[_0x3839ed(0xaf)]+')'),console[_0x3839ed(0x15a)](_0x3839ed(0x8b)+_0x822170[_0x3839ed(0x1b5)]),console[_0x3839ed(0x15a)]('\x20\x20\x20Currency:\x20'+_0x822170[_0x3839ed(0x1ce)]);let _0x44cb6c;_0x29e27b===_0x3839ed(0x1ec)&&(_0x44cb6c=this[_0x3839ed(0x19a)](_0x822170[_0x3839ed(0xe1)],_0x822170[_0x3839ed(0x182)]),console[_0x3839ed(0x15a)]('âŒ\x20Detailed\x20failure\x20description:\x20'+_0x44cb6c));const _0x18f97c={'paymentId':_0x2c78ed,'status':_0x29e27b,'amount':_0x822170[_0x3839ed(0x1b5)],'currency':_0x822170[_0x3839ed(0x1ce)]};return _0x44cb6c&&(_0x18f97c['errorMessage']=_0x44cb6c),_0x18f97c;}['stopAllStatusChecks'](){const _0x21aa30=a57_0x33dd50;console[_0x21aa30(0x15a)](_0x21aa30(0x188));const _0x10aadc=this[_0x21aa30(0x93)]['size'];for(const [_0x4f82f3]of this[_0x21aa30(0x93)]){this[_0x21aa30(0x181)](_0x4f82f3);}console['log'](_0x21aa30(0x109)+_0x10aadc+_0x21aa30(0x16c));}}exports[a57_0x33dd50(0x1e2)]=VisaMasterCardService;