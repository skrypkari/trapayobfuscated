'use strict';const a42_0x2e51eb=a42_0x1a91;(function(_0x27318f,_0x5d0015){const _0x454831=a42_0x1a91,_0x4041c2=_0x27318f();while(!![]){try{const _0x3253c2=-parseInt(_0x454831(0x1ba))/0x1*(-parseInt(_0x454831(0x211))/0x2)+-parseInt(_0x454831(0x1de))/0x3+-parseInt(_0x454831(0x1f9))/0x4+-parseInt(_0x454831(0x150))/0x5+-parseInt(_0x454831(0x212))/0x6+parseInt(_0x454831(0x1a4))/0x7+parseInt(_0x454831(0x16e))/0x8*(parseInt(_0x454831(0x166))/0x9);if(_0x3253c2===_0x5d0015)break;else _0x4041c2['push'](_0x4041c2['shift']());}catch(_0x32ec6e){_0x4041c2['push'](_0x4041c2['shift']());}}}(a42_0x3f66,0x4b60a));var __createBinding=this&&this[a42_0x2e51eb(0x1b9)]||(Object[a42_0x2e51eb(0x1c9)]?function(_0x116425,_0x341aa8,_0x29e887,_0x5edf8b){const _0x151646=a42_0x2e51eb;if(_0x5edf8b===undefined)_0x5edf8b=_0x29e887;var _0x2a58c3=Object[_0x151646(0x223)](_0x341aa8,_0x29e887);(!_0x2a58c3||(_0x151646(0x157)in _0x2a58c3?!_0x341aa8['__esModule']:_0x2a58c3[_0x151646(0x1e8)]||_0x2a58c3[_0x151646(0x1b8)]))&&(_0x2a58c3={'enumerable':!![],'get':function(){return _0x341aa8[_0x29e887];}}),Object[_0x151646(0x1d4)](_0x116425,_0x5edf8b,_0x2a58c3);}:function(_0x455c54,_0x15deda,_0x1b0b4b,_0x38f95c){if(_0x38f95c===undefined)_0x38f95c=_0x1b0b4b;_0x455c54[_0x38f95c]=_0x15deda[_0x1b0b4b];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a42_0x2e51eb(0x1c9)]?function(_0x2df6fe,_0x2ca85e){const _0x587a30=a42_0x2e51eb;Object['defineProperty'](_0x2df6fe,_0x587a30(0x232),{'enumerable':!![],'value':_0x2ca85e});}:function(_0x9a519e,_0x379e39){const _0x156dad=a42_0x2e51eb;_0x9a519e[_0x156dad(0x232)]=_0x379e39;}),__importStar=this&&this[a42_0x2e51eb(0x154)]||(function(){var _0x1ed9b8=function(_0x4e415c){const _0x31d9bc=a42_0x1a91;return _0x1ed9b8=Object[_0x31d9bc(0x164)]||function(_0x538f0d){const _0x1e2aa1=_0x31d9bc;var _0x134690=[];for(var _0x29da57 in _0x538f0d)if(Object[_0x1e2aa1(0x186)]['hasOwnProperty'][_0x1e2aa1(0x1f1)](_0x538f0d,_0x29da57))_0x134690[_0x134690[_0x1e2aa1(0x1b0)]]=_0x29da57;return _0x134690;},_0x1ed9b8(_0x4e415c);};return function(_0x14bdb3){const _0xba16e4=a42_0x1a91;if(_0x14bdb3&&_0x14bdb3[_0xba16e4(0x217)])return _0x14bdb3;var _0x2ac372={};if(_0x14bdb3!=null){for(var _0x4a67b7=_0x1ed9b8(_0x14bdb3),_0x46273e=0x0;_0x46273e<_0x4a67b7[_0xba16e4(0x1b0)];_0x46273e++)if(_0x4a67b7[_0x46273e]!==_0xba16e4(0x232))__createBinding(_0x2ac372,_0x14bdb3,_0x4a67b7[_0x46273e]);}return __setModuleDefault(_0x2ac372,_0x14bdb3),_0x2ac372;};}()),__importDefault=this&&this[a42_0x2e51eb(0x1c4)]||function(_0x50cf3e){return _0x50cf3e&&_0x50cf3e['__esModule']?_0x50cf3e:{'default':_0x50cf3e};};function a42_0x1a91(_0x3642d6,_0x5e5ac4){const _0x3f6667=a42_0x3f66();return a42_0x1a91=function(_0x1a914c,_0x1304c0){_0x1a914c=_0x1a914c-0x145;let _0x4fe015=_0x3f6667[_0x1a914c];return _0x4fe015;},a42_0x1a91(_0x3642d6,_0x5e5ac4);}function a42_0x3f66(){const _0x51439f=['scheduleStatusChecks','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','unknown','call','stringify','FAILED','/status','/charge','/status_decrypt','isArray','https://api2.trapay.uk/decrypt.php','927180qgXeTu','webhookUrl','settings','❌\x20Data\x20being\x20signed:','sendPaymentNotifications','Status:','push','Webhook\x20event\x20','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','charge','logWhiteDomainRequest','/charge_decrypt','payment.failed','key','TesSoft\x20Payment\x20System/1.0','parse','decryptResponsePhp','number','✅\x20Payment\x20','❌\x20PHP\x20decryptor\x20request\x20failed:','from','createDecipheriv',',\x20Final:\x20','🔐\x20AES\x20IV\x20length:','2vTxsPt','1019118rnKyao','Return\x20URL:','Order\x20ID:','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','toString','__esModule','keys','SHA256','Payment\x20ID:','json','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','POST','info','\x20status\x20timers\x20for\x20payment\x20','📊\x20Status\x20check\x20#','Response\x20Body:','publicKeyPath','getOwnPropertyDescriptor','Response\x20Time:','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','mastercard','../../config/database','processWebhook','../loggerService','path','MasterCard\x20webhook\x20sent\x20to\x20','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','expire_month','\x20\x20\x20-\x20merchant_point_id:','loggerService','none','replace','default','statusCheckTimers','Unknown\x20error','****','shopId','decryptAES','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','log','\x20with\x20status\x20','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','webhookEvents','readFileSync','encryptRSA','floor','\x20\x20\x20-\x20lang:\x20en','clearStatusTimers','2788020KKRVCC','Decryption\x20failed:\x20','order_id','🔐\x20Private\x20key\x20length:\x20','__importStar','date_success','3ds_url','get','📝\x20Data\x20to\x20sign\x20length:','sign','\x20for\x20payment\x20','private.pem','🔐\x20Public\x20key\x20length:\x20','🔐\x20Data\x20encrypted\x20with\x20AES','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','\x20\x20\x20-\x20key\x20length:','desc','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','Failed\x20to\x20send\x20MasterCard\x20webhook:','payment.success','getOwnPropertyNames','❌\x20Status\x20check\x20#','45UAjAFA','📝\x20Signature\x20length:','\x20\x20\x20-\x20sign\x20length:','HTTP\x20','decryptResponse','\x20is\x20final\x20(','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','💳\x20MasterCard\x20service\x20initialized','1855288kAGZnE','gatewayOrderId','sendPaymentNotification','encryptAES','message','PHP\x20decryptor\x20error','generateAESKey','existsSync','HTTP\x20error!\x20status:\x20','payment_id','❌\x20MasterCard\x20key\x20validation\x20failed:','updatePaymentStatus','🔐\x20Private\x20key\x20path:','then','PENDING','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','PAID','🔐\x20RSA\x20signing\x20successful','sendShopWebhook','Result\x20URL:','text','\x20failed\x20for\x20payment\x20','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','📊\x20Status\x20check\x20result:','prototype','system','\x20\x20\x20-\x20method:\x20charge','set','❌\x20RSA\x20signing\x20failed:','🧹\x20Clearing\x20','Error\x20parsing\x20webhook\x20events:','📝\x20Data\x20length:','Public\x20key\x20file\x20not\x20found:\x20','Processing\x20MasterCard\x20webhook:','base64','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','\x20result:','signRSA','slice','failed','status','cwd','shop','🔍\x20MasterCard\x20status\x20check\x20#','adminNotes','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','createCipheriv','-----BEGIN','🔐\x20Data\x20signed\x20with\x20RSA','❌\x20RSA\x20encryption\x20failed:','ms)','webhook_send','now','3437000Peuqiw','error','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','Error\x20details:','logWhiteDomainError','HTTP\x20Status:','Amount:','delete','🔐\x20Public\x20key\x20path:','description','stopAllStatusChecks','logWhiteDomainResponse','length','aes-256-ctr','last_name','...','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','RSA_PKCS1_PADDING','Card\x20Number:','payment','configurable','__createBinding','82571myzXHp','currency','constants','findUnique','Card\x20Holder:','\x20MasterCard\x20status\x20check\x20timers','\x20not\x20enabled\x20for\x20shop\x20','../telegramBotService','forEach','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','__importDefault','includes','merchantPointId','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','📝\x20Final\x20request\x20structure:','create','apiUrl','Failed\x20to\x20send\x20payment\x20notifications:','maskCardNumber',',\x20Desc:\x20','✅\x20Scheduled\x20','/charge_raw','/status_raw','update','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','defineProperty','🔐\x20AES\x20key\x20length:','\x20characters','size','\x20status\x20updated\x20to\x20','-----END','trim','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','/status_decrypted','utf8','1395384ENDfMT','checkPaymentStatus','randomBytes','application/json','processCardPayment','privateKeyPath','3DS\x20URL:','Private\x20key\x20file\x20not\x20found:\x20','resolve','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','writable','crypto','final','\x20\x20\x20-\x20info\x20length:','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...'];a42_0x3f66=function(){return _0x51439f;};return a42_0x3f66();}Object[a42_0x2e51eb(0x1d4)](exports,'__esModule',{'value':!![]}),exports['MasterCardService']=void 0x0;const crypto_1=__importDefault(require(a42_0x2e51eb(0x1e9))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x2e51eb(0x22a))),loggerService_1=require(a42_0x2e51eb(0x229));class MasterCardService{constructor(){const _0x283f0d=a42_0x2e51eb;this[_0x283f0d(0x233)]=new Map(),this[_0x283f0d(0x1ca)]='https://api.paydmeth.com/api',this[_0x283f0d(0x1c6)]=0x67c,this['privateKeyPath']=path_1['default']['join'](process[_0x283f0d(0x197)](),'keys',_0x283f0d(0x15b)),this['publicKeyPath']=path_1[_0x283f0d(0x232)]['join'](process[_0x283f0d(0x197)](),_0x283f0d(0x218),'psp_public.pem'),console[_0x283f0d(0x147)](_0x283f0d(0x16d)),console[_0x283f0d(0x147)](_0x283f0d(0x17a),this['privateKeyPath']),console[_0x283f0d(0x147)](_0x283f0d(0x1ac),this['publicKeyPath']),this['validateKeyFiles']();}['validateKeyFiles'](){const _0x3643f9=a42_0x2e51eb;try{if(!fs_1[_0x3643f9(0x232)][_0x3643f9(0x175)](this[_0x3643f9(0x1e3)]))throw new Error(_0x3643f9(0x1e5)+this[_0x3643f9(0x1e3)]);if(!fs_1[_0x3643f9(0x232)][_0x3643f9(0x175)](this['publicKeyPath']))throw new Error(_0x3643f9(0x18e)+this[_0x3643f9(0x222)]);const _0xa03ec4=fs_1[_0x3643f9(0x232)]['readFileSync'](this[_0x3643f9(0x1e3)],'utf8')[_0x3643f9(0x1da)](),_0x4d645f=fs_1[_0x3643f9(0x232)]['readFileSync'](this[_0x3643f9(0x222)],_0x3643f9(0x1dd))[_0x3643f9(0x1da)]();if(!_0xa03ec4[_0x3643f9(0x1c5)](_0x3643f9(0x19e))||!_0xa03ec4['includes'](_0x3643f9(0x1d9)))throw new Error(_0x3643f9(0x17d));if(!_0x4d645f[_0x3643f9(0x1c5)](_0x3643f9(0x19e))||!_0x4d645f[_0x3643f9(0x1c5)](_0x3643f9(0x1d9)))throw new Error(_0x3643f9(0x1d3));console[_0x3643f9(0x147)]('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console[_0x3643f9(0x147)](_0x3643f9(0x153)+_0xa03ec4['length']+'\x20characters'),console[_0x3643f9(0x147)](_0x3643f9(0x15c)+_0x4d645f[_0x3643f9(0x1b0)]+_0x3643f9(0x1d6));}catch(_0x3b32ba){console['error'](_0x3643f9(0x178),_0x3b32ba);throw _0x3b32ba;}}[a42_0x2e51eb(0x174)](){const _0x13a0fd=a42_0x2e51eb,_0x140076=crypto_1['default']['randomBytes'](0x20),_0x5cdb3f=crypto_1[_0x13a0fd(0x232)][_0x13a0fd(0x1e0)](0x10);return{'key':_0x140076,'iv':_0x5cdb3f};}['encryptAES'](_0x22dfcb,_0x3fdf30,_0x434733){const _0x26fb43=a42_0x2e51eb,_0x170859=crypto_1['default'][_0x26fb43(0x19d)](_0x26fb43(0x1b1),_0x3fdf30,_0x434733);let _0x4e1c60=_0x170859['update'](_0x22dfcb,_0x26fb43(0x1dd),_0x26fb43(0x190));return _0x4e1c60+=_0x170859[_0x26fb43(0x1ea)](_0x26fb43(0x190)),_0x4e1c60;}[a42_0x2e51eb(0x14c)](_0x50a4e7,_0x1a2aa6){const _0x286db0=a42_0x2e51eb;try{const _0x5284c3=fs_1[_0x286db0(0x232)]['readFileSync'](this[_0x286db0(0x222)],_0x286db0(0x1dd))[_0x286db0(0x1da)](),_0x1214a5={'iv':_0x1a2aa6[_0x286db0(0x216)](_0x286db0(0x190)),'key':_0x50a4e7[_0x286db0(0x216)]('base64')},_0x526742=JSON[_0x286db0(0x1f2)](_0x1214a5);console[_0x286db0(0x147)](_0x286db0(0x1d2),_0x526742['length']);const _0x1efd68=crypto_1[_0x286db0(0x232)]['publicEncrypt']({'key':_0x5284c3,'padding':crypto_1['default'][_0x286db0(0x1bc)][_0x286db0(0x1b5)]},Buffer['from'](_0x526742));return console[_0x286db0(0x147)]('✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x1efd68[_0x286db0(0x1b0)]),_0x1efd68[_0x286db0(0x216)](_0x286db0(0x190));}catch(_0x5c10a6){console[_0x286db0(0x1a5)](_0x286db0(0x1a0),_0x5c10a6);throw new Error(_0x286db0(0x184));}}['signRSA'](_0x1decaa){const _0x3a2ed2=a42_0x2e51eb;try{const _0x1792ec=fs_1[_0x3a2ed2(0x232)]['readFileSync'](this['privateKeyPath'],_0x3a2ed2(0x1dd))[_0x3a2ed2(0x1da)](),_0x5205f9=crypto_1[_0x3a2ed2(0x232)]['createSign'](_0x3a2ed2(0x219));_0x5205f9['update'](_0x1decaa),_0x5205f9['end']();const _0x2be189=_0x5205f9[_0x3a2ed2(0x159)](_0x1792ec,_0x3a2ed2(0x190));return console[_0x3a2ed2(0x147)](_0x3a2ed2(0x17f)),console[_0x3a2ed2(0x147)](_0x3a2ed2(0x158),_0x1decaa[_0x3a2ed2(0x1b0)]),console[_0x3a2ed2(0x147)]('📝\x20Signature\x20length:',_0x2be189[_0x3a2ed2(0x1b0)]),_0x2be189;}catch(_0xcf2471){console['error'](_0x3a2ed2(0x18a),_0xcf2471),console[_0x3a2ed2(0x1a5)](_0x3a2ed2(0x1fc),_0x1decaa['substring'](0x0,0xc8)+_0x3a2ed2(0x1b3));throw new Error(_0x3a2ed2(0x22c));}}[a42_0x2e51eb(0x145)](_0x10c5ab,_0xdeb250,_0x58c91d){const _0x9820a6=a42_0x2e51eb,_0x429d40=crypto_1[_0x9820a6(0x232)][_0x9820a6(0x20e)](_0x9820a6(0x1b1),_0xdeb250,_0x58c91d);let _0x1cf2e8=_0x429d40[_0x9820a6(0x1d1)](_0x10c5ab,_0x9820a6(0x190),_0x9820a6(0x1dd));return _0x1cf2e8+=_0x429d40[_0x9820a6(0x1ea)]('utf8'),_0x1cf2e8;}async[a42_0x2e51eb(0x209)](_0x3b7ee2,_0x284a73){const _0xe0ffff=a42_0x2e51eb;try{const _0x4e7c5f=await fetch(_0xe0ffff(0x1f8),{'method':'POST','headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'info':_0x3b7ee2,'key':_0x284a73})});if(!_0x4e7c5f['ok'])throw new Error(_0xe0ffff(0x173));return await _0x4e7c5f[_0xe0ffff(0x182)]();}catch(_0x281ada){console[_0xe0ffff(0x1a5)](_0xe0ffff(0x20c),_0x281ada);throw new Error(_0xe0ffff(0x191));}}[a42_0x2e51eb(0x16a)](_0x1b8781,_0x133d55){const _0x9c49f2=a42_0x2e51eb;try{const _0x3231b3=fs_1[_0x9c49f2(0x232)][_0x9c49f2(0x14b)](this[_0x9c49f2(0x1e3)],'utf8')[_0x9c49f2(0x1da)](),_0x3d5b72=crypto_1[_0x9c49f2(0x232)]['privateDecrypt'](_0x3231b3,Buffer[_0x9c49f2(0x20d)](_0x133d55,_0x9c49f2(0x190))),_0x2d464f=JSON[_0x9c49f2(0x208)](_0x3d5b72['toString']()),_0x52ac9f=Buffer[_0x9c49f2(0x20d)](_0x2d464f[_0x9c49f2(0x206)],'base64'),_0x57e6fe=Buffer[_0x9c49f2(0x20d)](_0x2d464f['iv'],_0x9c49f2(0x190));return this[_0x9c49f2(0x145)](_0x1b8781,_0x52ac9f,_0x57e6fe);}catch(_0x5c364f){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a42_0x2e51eb(0x1e2)](_0x5915d8){const _0x45fd0f=a42_0x2e51eb,{paymentId:_0x37c98f,orderId:_0x3e1d46,amount:_0x386f8b,currency:_0x6f735a,cardData:_0x561636,resultUrl:_0x30567f,returnUrl:_0x4a6084,cardHolder:_0x21a9cc,browser:_0x45fff5}=_0x5915d8;console[_0x45fd0f(0x147)]('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console['log']('Payment\x20ID:',_0x37c98f),console['log'](_0x45fd0f(0x214),_0x3e1d46),console['log'](_0x45fd0f(0x1aa),_0x386f8b,_0x6f735a),console[_0x45fd0f(0x147)](_0x45fd0f(0x1b6),this[_0x45fd0f(0x1cc)](_0x561636[_0x45fd0f(0x20a)])),console[_0x45fd0f(0x147)](_0x45fd0f(0x1be),_0x21a9cc['first_name']+'\x20'+_0x21a9cc[_0x45fd0f(0x1b2)]),console[_0x45fd0f(0x147)](_0x45fd0f(0x213),_0x4a6084),console[_0x45fd0f(0x147)](_0x45fd0f(0x181),_0x30567f);const _0x4f8701={'amount':_0x386f8b,'currency':_0x6f735a['toUpperCase'](),'order_id':_0x3e1d46,'result_url':_0x30567f,'return_url':_0x4a6084,'card':{'number':_0x561636[_0x45fd0f(0x20a)],'expire_month':_0x561636[_0x45fd0f(0x22d)],'expire_year':_0x561636['expire_year'],'cvv':_0x561636['cvv']},'card_holder':_0x21a9cc,'browser':_0x45fff5},_0x5dd59f=JSON[_0x45fd0f(0x1f2)](_0x4f8701);console[_0x45fd0f(0x147)]('💾\x20Payment\x20data\x20prepared'),console[_0x45fd0f(0x147)](_0x45fd0f(0x1ef)),console['log'](_0x5dd59f),console[_0x45fd0f(0x147)](_0x45fd0f(0x18d),_0x5dd59f['length']);try{const {key:_0x100b85,iv:_0x38f630}=this['generateAESKey']();console['log']('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console['log'](_0x45fd0f(0x1d5),_0x100b85[_0x45fd0f(0x1b0)]),console[_0x45fd0f(0x147)](_0x45fd0f(0x210),_0x38f630[_0x45fd0f(0x1b0)]);const _0x4ab5cd=this[_0x45fd0f(0x171)](_0x5dd59f,_0x100b85,_0x38f630);console[_0x45fd0f(0x147)](_0x45fd0f(0x15d)),console[_0x45fd0f(0x147)]('📝\x20Encrypted\x20data\x20length:',_0x4ab5cd[_0x45fd0f(0x1b0)]);const _0x5458d1=this[_0x45fd0f(0x14c)](_0x100b85,_0x38f630);console[_0x45fd0f(0x147)](_0x45fd0f(0x225)),console[_0x45fd0f(0x147)]('📝\x20Encrypted\x20key\x20length:',_0x5458d1[_0x45fd0f(0x1b0)]);const _0x19966f=this['signRSA'](_0x5dd59f);console[_0x45fd0f(0x147)](_0x45fd0f(0x19f)),console[_0x45fd0f(0x147)](_0x45fd0f(0x167),_0x19966f[_0x45fd0f(0x1b0)]);const _0x5e7bf1={'merchant_point_id':this[_0x45fd0f(0x1c6)],'method':_0x45fd0f(0x202),'info':_0x4ab5cd,'key':_0x5458d1,'sign':_0x19966f,'lang':'en'};console[_0x45fd0f(0x147)](_0x45fd0f(0x149)),console[_0x45fd0f(0x147)](_0x45fd0f(0x1c8)),console[_0x45fd0f(0x147)](_0x45fd0f(0x22e),this['merchantPointId']),console[_0x45fd0f(0x147)](_0x45fd0f(0x188)),console['log'](_0x45fd0f(0x1eb),_0x4ab5cd[_0x45fd0f(0x1b0)]),console['log'](_0x45fd0f(0x15f),_0x5458d1['length']),console[_0x45fd0f(0x147)](_0x45fd0f(0x168),_0x19966f[_0x45fd0f(0x1b0)]),console[_0x45fd0f(0x147)](_0x45fd0f(0x14e)),loggerService_1[_0x45fd0f(0x22f)]['logWhiteDomainRequest'](_0x45fd0f(0x226),'/charge',_0x45fd0f(0x21d),{'merchant_point_id':this[_0x45fd0f(0x1c6)],'method':'charge','lang':'en'});const _0x4e1c90=Date[_0x45fd0f(0x1a3)](),_0x43e839=await fetch(this[_0x45fd0f(0x1ca)],{'method':_0x45fd0f(0x21d),'headers':{'Content-Type':_0x45fd0f(0x1e1),'Accept':'application/json','User-Agent':_0x45fd0f(0x207)},'body':JSON[_0x45fd0f(0x1f2)](_0x5e7bf1)}),_0x2fa2ba=Date[_0x45fd0f(0x1a3)]()-_0x4e1c90;console[_0x45fd0f(0x147)](_0x45fd0f(0x1a6)),console[_0x45fd0f(0x147)](_0x45fd0f(0x1fe),_0x43e839[_0x45fd0f(0x196)]),console['log'](_0x45fd0f(0x224),_0x2fa2ba+'ms');if(!_0x43e839['ok']){const _0x2a5a9b=await _0x43e839['text']();console['error'](_0x45fd0f(0x1a9),_0x43e839['status']),console[_0x45fd0f(0x1a5)](_0x45fd0f(0x221),_0x2a5a9b),loggerService_1['loggerService'][_0x45fd0f(0x1af)](_0x45fd0f(0x226),_0x45fd0f(0x1cf),_0x43e839[_0x45fd0f(0x196)],_0x2a5a9b,_0x2fa2ba),loggerService_1[_0x45fd0f(0x22f)][_0x45fd0f(0x1a8)](_0x45fd0f(0x226),'/charge',_0x45fd0f(0x169)+_0x43e839[_0x45fd0f(0x196)]+':\x20'+_0x2a5a9b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x43e839[_0x45fd0f(0x196)]+',\x20body:\x20'+_0x2a5a9b);}const _0x931e6=await _0x43e839[_0x45fd0f(0x21b)]();loggerService_1[_0x45fd0f(0x22f)][_0x45fd0f(0x1af)](_0x45fd0f(0x226),_0x45fd0f(0x1cf),_0x43e839[_0x45fd0f(0x196)],_0x931e6,_0x2fa2ba),console['log'](_0x45fd0f(0x15e));let _0x7ed332=_0x931e6;if(_0x931e6[_0x45fd0f(0x21e)]&&_0x931e6[_0x45fd0f(0x206)]&&_0x931e6[_0x45fd0f(0x159)]){console[_0x45fd0f(0x147)]('🔐\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x37207d=await this['decryptResponsePhp'](_0x931e6[_0x45fd0f(0x21e)],_0x931e6[_0x45fd0f(0x206)]);_0x7ed332=JSON[_0x45fd0f(0x208)](_0x37207d),console[_0x45fd0f(0x147)](_0x45fd0f(0x1db)),loggerService_1[_0x45fd0f(0x22f)][_0x45fd0f(0x1af)](_0x45fd0f(0x226),'/charge_decrypted',_0x43e839['status'],_0x7ed332,_0x2fa2ba),console['log'](_0x45fd0f(0x19b));}catch(_0x1dc710){console[_0x45fd0f(0x1a5)](_0x45fd0f(0x161),_0x1dc710),loggerService_1['loggerService']['logWhiteDomainError'](_0x45fd0f(0x226),_0x45fd0f(0x204),_0x45fd0f(0x151)+_0x1dc710),_0x7ed332=_0x931e6;}}else loggerService_1[_0x45fd0f(0x22f)]['logWhiteDomainResponse'](_0x45fd0f(0x226),'/charge_decrypted',_0x43e839[_0x45fd0f(0x196)],_0x7ed332,_0x2fa2ba),console[_0x45fd0f(0x147)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console['log']('Status:',_0x7ed332['status']),console[_0x45fd0f(0x147)]('Final:',_0x7ed332['final']),console[_0x45fd0f(0x147)](_0x45fd0f(0x21a),_0x7ed332[_0x45fd0f(0x177)]),console[_0x45fd0f(0x147)](_0x45fd0f(0x1e4),_0x7ed332[_0x45fd0f(0x156)]||_0x45fd0f(0x230));if(_0x7ed332[_0x45fd0f(0x196)]===0x64&&_0x7ed332['final']===0x1)return console[_0x45fd0f(0x147)]('✅\x20Payment\x20successful'),{'gateway_payment_id':_0x7ed332[_0x45fd0f(0x177)]?.[_0x45fd0f(0x216)](),'payment_url':_0x4a6084,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x7ed332['3ds_url'])return console['log']('🔐\x203DS\x20verification\x20required'),this['scheduleStatusChecks'](_0x37c98f,_0x3e1d46,_0x7ed332[_0x45fd0f(0x177)]?.[_0x45fd0f(0x216)]()||_0x3e1d46),{'gateway_payment_id':_0x7ed332[_0x45fd0f(0x177)]?.[_0x45fd0f(0x216)](),'payment_url':_0x7ed332[_0x45fd0f(0x156)],'requires_3ds':!![],'threeds_url':_0x7ed332[_0x45fd0f(0x156)],'status':_0x45fd0f(0x17c),'final':![]};let _0x1898a6=_0x7ed332['desc']||_0x7ed332[_0x45fd0f(0x172)]||'Unknown\x20error',_0x1d6d15=_0x7ed332['status'],_0x502e8d=_0x7ed332[_0x45fd0f(0x1ea)];return console[_0x45fd0f(0x147)]('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x1d6d15+_0x45fd0f(0x20f)+_0x502e8d+_0x45fd0f(0x1cd)+_0x1898a6),{'gateway_payment_id':_0x7ed332['payment_id']?.[_0x45fd0f(0x216)](),'payment_url':_0x4a6084,'requires_3ds':![],'status':_0x45fd0f(0x1f3),'final':!![]};}catch(_0x2bc6bc){console[_0x45fd0f(0x1a5)]('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console[_0x45fd0f(0x1a5)](_0x45fd0f(0x1a7),_0x2bc6bc),loggerService_1[_0x45fd0f(0x22f)][_0x45fd0f(0x1a8)](_0x45fd0f(0x226),_0x45fd0f(0x1f5),_0x2bc6bc);throw new Error(_0x45fd0f(0x146)+(_0x2bc6bc instanceof Error?_0x2bc6bc[_0x45fd0f(0x172)]:'Unknown\x20error'));}}async['checkPaymentStatus'](_0x5d82c9,_0x335e73){const _0x3cc1f4=a42_0x2e51eb;console['log'](_0x3cc1f4(0x16c)+_0x5d82c9+'\x20('+_0x335e73+')');try{const _0x4837cf={'payment_id':_0x5d82c9,'order_id':_0x335e73},_0x38ae6e=JSON['stringify'](_0x4837cf),{key:_0x3d5cb5,iv:_0xe810e4}=this[_0x3cc1f4(0x174)](),_0x31acad=this[_0x3cc1f4(0x171)](_0x38ae6e,_0x3d5cb5,_0xe810e4),_0x43fd14=this[_0x3cc1f4(0x14c)](_0x3d5cb5,_0xe810e4),_0x1f2a6d=this[_0x3cc1f4(0x193)](_0x38ae6e),_0x315e93={'merchant_point_id':this[_0x3cc1f4(0x1c6)],'method':'status','info':_0x31acad,'key':_0x43fd14,'sign':_0x1f2a6d,'lang':'en'};loggerService_1[_0x3cc1f4(0x22f)][_0x3cc1f4(0x203)](_0x3cc1f4(0x226),_0x3cc1f4(0x1f4),_0x3cc1f4(0x21d),{'merchant_point_id':this[_0x3cc1f4(0x1c6)],'method':_0x3cc1f4(0x196),'lang':'en'});const _0x87cba5=Date['now'](),_0x10fbae=await fetch(this[_0x3cc1f4(0x1ca)],{'method':_0x3cc1f4(0x21d),'headers':{'Content-Type':_0x3cc1f4(0x1e1),'Accept':_0x3cc1f4(0x1e1),'User-Agent':_0x3cc1f4(0x207)},'body':JSON[_0x3cc1f4(0x1f2)](_0x315e93)}),_0x17ed73=Date[_0x3cc1f4(0x1a3)]()-_0x87cba5;if(!_0x10fbae['ok']){const _0x146870=await _0x10fbae[_0x3cc1f4(0x182)]();loggerService_1['loggerService'][_0x3cc1f4(0x1af)](_0x3cc1f4(0x226),_0x3cc1f4(0x1d0),_0x10fbae[_0x3cc1f4(0x196)],_0x146870,_0x17ed73);throw new Error(_0x3cc1f4(0x176)+_0x10fbae['status']);}const _0x533e9b=await _0x10fbae[_0x3cc1f4(0x21b)]();loggerService_1[_0x3cc1f4(0x22f)]['logWhiteDomainResponse'](_0x3cc1f4(0x226),_0x3cc1f4(0x1d0),_0x10fbae[_0x3cc1f4(0x196)],_0x533e9b,_0x17ed73);let _0x366107=_0x533e9b;if(_0x533e9b[_0x3cc1f4(0x21e)]&&_0x533e9b[_0x3cc1f4(0x206)]&&_0x533e9b[_0x3cc1f4(0x159)]){console['log'](_0x3cc1f4(0x21c));try{const _0x379fd4=this['decryptResponse'](_0x533e9b[_0x3cc1f4(0x21e)],_0x533e9b[_0x3cc1f4(0x206)]);_0x366107=JSON[_0x3cc1f4(0x208)](_0x379fd4),console[_0x3cc1f4(0x147)]('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x3cc1f4(0x22f)][_0x3cc1f4(0x1af)]('mastercard',_0x3cc1f4(0x1dc),_0x10fbae[_0x3cc1f4(0x196)],_0x366107,_0x17ed73),console[_0x3cc1f4(0x147)](_0x3cc1f4(0x1e7));}catch(_0x155e43){console[_0x3cc1f4(0x1a5)](_0x3cc1f4(0x19c),_0x155e43),loggerService_1[_0x3cc1f4(0x22f)][_0x3cc1f4(0x1a8)]('mastercard',_0x3cc1f4(0x1f6),'Status\x20decryption\x20failed:\x20'+_0x155e43),_0x366107=_0x533e9b;}}else loggerService_1['loggerService'][_0x3cc1f4(0x1af)](_0x3cc1f4(0x226),_0x3cc1f4(0x1dc),_0x10fbae[_0x3cc1f4(0x196)],_0x366107,_0x17ed73),console['log'](_0x3cc1f4(0x1c7));console[_0x3cc1f4(0x147)](_0x3cc1f4(0x185),{'status':_0x366107[_0x3cc1f4(0x196)],'final':_0x366107['final'],'payment_id':_0x366107[_0x3cc1f4(0x177)],'desc':_0x366107[_0x3cc1f4(0x160)]});let _0x1242e5=_0x3cc1f4(0x17c);if(_0x366107[_0x3cc1f4(0x196)]===0x1&&_0x366107[_0x3cc1f4(0x1ea)]===0x1)_0x1242e5=_0x3cc1f4(0x17e);else _0x366107[_0x3cc1f4(0x196)]===0x0&&_0x366107[_0x3cc1f4(0x1ea)]===0x0?_0x1242e5='PENDING':_0x1242e5=_0x3cc1f4(0x1f3);return{'status':_0x1242e5,'final':_0x366107[_0x3cc1f4(0x1ea)]===0x1,'amount':_0x366107['amount'],'currency':_0x366107[_0x3cc1f4(0x1bb)],'date_success':_0x366107[_0x3cc1f4(0x155)],'description':_0x366107[_0x3cc1f4(0x160)]};}catch(_0x1d4b73){console[_0x3cc1f4(0x1a5)]('MasterCard\x20status\x20check\x20error:',_0x1d4b73),loggerService_1['loggerService']['logWhiteDomainError'](_0x3cc1f4(0x226),_0x3cc1f4(0x1f4),_0x1d4b73);throw new Error('Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20'+(_0x1d4b73 instanceof Error?_0x1d4b73['message']:_0x3cc1f4(0x234)));}}[a42_0x2e51eb(0x1ee)](_0x583153,_0x2eef0d,_0x3f097f){const _0x386c97=a42_0x2e51eb;console[_0x386c97(0x147)](_0x386c97(0x201)+_0x583153+'\x20('+_0x3f097f+')'),this[_0x386c97(0x14f)](_0x583153);const _0x182424=[],_0x5118d4=0x5*0x3c*0x3e8,_0x246d78=0x2*0x3c*0x3c*0x3e8,_0x3e35a1=Math[_0x386c97(0x14d)](_0x246d78/_0x5118d4);console[_0x386c97(0x147)]('⏰\x20Will\x20check\x20status\x20'+_0x3e35a1+_0x386c97(0x1c3));for(let _0x297517=0x1;_0x297517<=_0x3e35a1;_0x297517++){const _0xadaff2=setTimeout(async()=>{const _0x250c25=_0x386c97;console[_0x250c25(0x147)](_0x250c25(0x199)+_0x297517+'/'+_0x3e35a1+_0x250c25(0x15a)+_0x583153);try{const _0x2ca174=await this[_0x250c25(0x1df)](_0x3f097f,_0x2eef0d);console['log'](_0x250c25(0x220)+_0x297517+_0x250c25(0x192),_0x2ca174),_0x2ca174[_0x250c25(0x1ea)]&&(console[_0x250c25(0x147)](_0x250c25(0x20b)+_0x583153+_0x250c25(0x16b)+_0x2ca174[_0x250c25(0x196)]+'),\x20stopping\x20status\x20checks'),this[_0x250c25(0x14f)](_0x583153),await this[_0x250c25(0x179)](_0x583153,_0x2ca174[_0x250c25(0x196)],_0x2ca174));}catch(_0x35406b){console[_0x250c25(0x1a5)](_0x250c25(0x165)+_0x297517+_0x250c25(0x183)+_0x583153+':',_0x35406b);}},_0x297517*_0x5118d4);_0x182424[_0x386c97(0x1ff)](_0xadaff2);}this[_0x386c97(0x233)][_0x386c97(0x189)](_0x583153,_0x182424),console[_0x386c97(0x147)](_0x386c97(0x1ce)+_0x3e35a1+'\x20status\x20checks\x20for\x20payment\x20'+_0x583153);}[a42_0x2e51eb(0x14f)](_0x445b4d){const _0x2b82ce=a42_0x2e51eb,_0x26f629=this[_0x2b82ce(0x233)][_0x2b82ce(0x157)](_0x445b4d);_0x26f629&&(console[_0x2b82ce(0x147)](_0x2b82ce(0x18b)+_0x26f629[_0x2b82ce(0x1b0)]+_0x2b82ce(0x21f)+_0x445b4d),_0x26f629[_0x2b82ce(0x1c2)]((_0x1ce6f8,_0x4e19ee)=>{clearTimeout(_0x1ce6f8);}),this[_0x2b82ce(0x233)][_0x2b82ce(0x1ab)](_0x445b4d));}async[a42_0x2e51eb(0x179)](_0x1ebabd,_0x2a2b00,_0x4facdd){const _0x348a40=a42_0x2e51eb;try{const _0x14f6ce=(await Promise['resolve']()[_0x348a40(0x17b)](()=>__importStar(require(_0x348a40(0x227)))))['default'],_0x619fcc={'status':_0x2a2b00['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x348a40(0x187),'statusChangedAt':new Date()};_0x2a2b00==='PAID'&&(_0x619fcc['paidAt']=new Date()),_0x4facdd['description']&&(_0x619fcc[_0x348a40(0x19a)]='MasterCard:\x20'+_0x4facdd[_0x348a40(0x1ad)]),await _0x14f6ce[_0x348a40(0x1b7)][_0x348a40(0x1d1)]({'where':{'id':_0x1ebabd},'data':_0x619fcc}),console[_0x348a40(0x147)](_0x348a40(0x20b)+_0x1ebabd+_0x348a40(0x1d8)+_0x2a2b00),await this['sendPaymentNotifications'](_0x1ebabd,_0x2a2b00);}catch(_0x457f75){console[_0x348a40(0x1a5)](_0x348a40(0x215)+_0x1ebabd+':',_0x457f75);}}async[a42_0x2e51eb(0x1fd)](_0x35cc18,_0x176e13){const _0x1d8c81=a42_0x2e51eb;try{const _0x19cc2d=(await Promise[_0x1d8c81(0x1e6)]()[_0x1d8c81(0x17b)](()=>__importStar(require(_0x1d8c81(0x227)))))[_0x1d8c81(0x232)],{telegramBotService:_0x30c849}=await Promise[_0x1d8c81(0x1e6)]()[_0x1d8c81(0x17b)](()=>__importStar(require(_0x1d8c81(0x1c1)))),_0x122a35=await _0x19cc2d[_0x1d8c81(0x1b7)][_0x1d8c81(0x1bd)]({'where':{'id':_0x35cc18},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x122a35)return;const _0x5eaf10={'PAID':'paid','FAILED':_0x1d8c81(0x195)},_0x4759b3=_0x5eaf10[_0x176e13];_0x4759b3&&await _0x30c849[_0x1d8c81(0x170)](_0x122a35[_0x1d8c81(0x236)],_0x122a35,_0x4759b3),await this['sendShopWebhook'](_0x122a35,_0x176e13);}catch(_0x47ecd4){console[_0x1d8c81(0x1a5)](_0x1d8c81(0x1cb),_0x47ecd4);}}async[a42_0x2e51eb(0x180)](_0x614b66,_0x3f206e){const _0x4a9eed=a42_0x2e51eb,_0x55e522=Date[_0x4a9eed(0x1a3)]();try{const _0x511959=_0x614b66[_0x4a9eed(0x198)],_0x520fa1=_0x511959[_0x4a9eed(0x1fb)];if(!_0x520fa1?.[_0x4a9eed(0x1fa)]){console[_0x4a9eed(0x147)](_0x4a9eed(0x1b4)+_0x511959['id']);return;}const _0x4e6ca3=_0x3f206e==='PAID'?_0x4a9eed(0x163):_0x4a9eed(0x205);let _0x237191=[];if(_0x520fa1['webhookEvents'])try{_0x237191=Array[_0x4a9eed(0x1f7)](_0x520fa1[_0x4a9eed(0x14a)])?_0x520fa1[_0x4a9eed(0x14a)]:JSON[_0x4a9eed(0x208)](_0x520fa1[_0x4a9eed(0x14a)]);}catch(_0x510b82){console['error'](_0x4a9eed(0x18c),_0x510b82),_0x237191=[];}if(!_0x237191[_0x4a9eed(0x1c5)](_0x4e6ca3)){console[_0x4a9eed(0x147)](_0x4a9eed(0x200)+_0x4e6ca3+_0x4a9eed(0x1c0)+_0x511959['id']);return;}const _0x4de4e8={'event':_0x4e6ca3,'payment':{'id':_0x614b66['id'],'order_id':_0x614b66['orderId'],'gateway_order_id':_0x614b66[_0x4a9eed(0x16f)],'gateway':'1111','amount':_0x614b66['amount'],'currency':_0x614b66[_0x4a9eed(0x1bb)],'status':_0x3f206e['toLowerCase'](),'customer_email':_0x614b66['customerEmail'],'customer_name':_0x614b66['customerName'],'created_at':_0x614b66['createdAt'],'updated_at':new Date()}},_0x384b85=await fetch(_0x520fa1[_0x4a9eed(0x1fa)],{'method':_0x4a9eed(0x21d),'headers':{'Content-Type':_0x4a9eed(0x1e1),'User-Agent':_0x4a9eed(0x1ec)},'body':JSON[_0x4a9eed(0x1f2)](_0x4de4e8)}),_0x545e20=Date[_0x4a9eed(0x1a3)]()-_0x55e522;loggerService_1[_0x4a9eed(0x22f)]['logShopWebhookSent'](_0x614b66[_0x4a9eed(0x236)],_0x520fa1[_0x4a9eed(0x1fa)],_0x4e6ca3,_0x384b85['status'],_0x545e20,_0x4de4e8),console[_0x4a9eed(0x147)](_0x4a9eed(0x22b)+_0x520fa1['webhookUrl']+_0x4a9eed(0x148)+_0x384b85[_0x4a9eed(0x196)]+'\x20('+_0x545e20+_0x4a9eed(0x1a1));}catch(_0x25f313){console[_0x4a9eed(0x1a5)](_0x4a9eed(0x162),_0x25f313),loggerService_1[_0x4a9eed(0x22f)]['logShopWebhookError'](_0x614b66[_0x4a9eed(0x236)],_0x614b66[_0x4a9eed(0x198)]?.[_0x4a9eed(0x1fb)]?.[_0x4a9eed(0x1fa)]||_0x4a9eed(0x1f0),_0x4a9eed(0x1a2),_0x25f313,{});}}[a42_0x2e51eb(0x1cc)](_0x47912c){const _0x4c6867=a42_0x2e51eb,_0x5d9a6b=_0x47912c[_0x4c6867(0x231)](/[\s-]/g,'');if(_0x5d9a6b[_0x4c6867(0x1b0)]<0x4)return _0x4c6867(0x235);return'****\x20****\x20****\x20'+_0x5d9a6b[_0x4c6867(0x194)](-0x4);}async[a42_0x2e51eb(0x228)](_0x263ba7){const _0x32e12a=a42_0x2e51eb;console[_0x32e12a(0x147)](_0x32e12a(0x18f),_0x263ba7);let _0x39735d=_0x32e12a(0x17c);if(_0x263ba7['status']===0x1&&_0x263ba7['final']===0x1)_0x39735d=_0x32e12a(0x17e);else _0x263ba7[_0x32e12a(0x196)]===0x0&&_0x263ba7[_0x32e12a(0x1ea)]===0x0?_0x39735d=_0x32e12a(0x17c):_0x39735d=_0x32e12a(0x1f3);return{'paymentId':_0x263ba7[_0x32e12a(0x152)]||'','status':_0x39735d,'amount':_0x263ba7['amount'],'currency':_0x263ba7[_0x32e12a(0x1bb)]};}[a42_0x2e51eb(0x1ae)](){const _0x29cb77=a42_0x2e51eb;console[_0x29cb77(0x147)](_0x29cb77(0x1ed));const _0x17f275=this[_0x29cb77(0x233)][_0x29cb77(0x1d7)];for(const [_0x293a66]of this[_0x29cb77(0x233)]){this['clearStatusTimers'](_0x293a66);}console[_0x29cb77(0x147)]('🛑\x20Stopped\x20'+_0x17f275+_0x29cb77(0x1bf));}}exports['MasterCardService']=MasterCardService;