'use strict';const a60_0x2d31b2=a60_0x212f;(function(_0x574c74,_0x4471a8){const _0x47457b=a60_0x212f,_0x3e2bbe=_0x574c74();while(!![]){try{const _0x4cf893=-parseInt(_0x47457b(0x2df))/0x1+-parseInt(_0x47457b(0x262))/0x2*(-parseInt(_0x47457b(0x2d9))/0x3)+parseInt(_0x47457b(0x240))/0x4+parseInt(_0x47457b(0x276))/0x5+parseInt(_0x47457b(0x2b1))/0x6+-parseInt(_0x47457b(0x2b6))/0x7*(parseInt(_0x47457b(0x26b))/0x8)+-parseInt(_0x47457b(0x1ce))/0x9;if(_0x4cf893===_0x4471a8)break;else _0x3e2bbe['push'](_0x3e2bbe['shift']());}catch(_0x3076f0){_0x3e2bbe['push'](_0x3e2bbe['shift']());}}}(a60_0x4ca6,0xc0b55));var __createBinding=this&&this[a60_0x2d31b2(0x2f0)]||(Object[a60_0x2d31b2(0x1e3)]?function(_0x1d194d,_0x3f08e2,_0x544a61,_0x200b87){const _0x139573=a60_0x2d31b2;if(_0x200b87===undefined)_0x200b87=_0x544a61;var _0x45a767=Object[_0x139573(0x191)](_0x3f08e2,_0x544a61);(!_0x45a767||(_0x139573(0x2c9)in _0x45a767?!_0x3f08e2[_0x139573(0x25e)]:_0x45a767[_0x139573(0x1ba)]||_0x45a767[_0x139573(0x279)]))&&(_0x45a767={'enumerable':!![],'get':function(){return _0x3f08e2[_0x544a61];}}),Object['defineProperty'](_0x1d194d,_0x200b87,_0x45a767);}:function(_0x2604f3,_0xfef39b,_0x14d79b,_0x414410){if(_0x414410===undefined)_0x414410=_0x14d79b;_0x2604f3[_0x414410]=_0xfef39b[_0x14d79b];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a60_0x2d31b2(0x1e3)]?function(_0x4c9694,_0x5175fe){const _0x4a7c89=a60_0x2d31b2;Object[_0x4a7c89(0x1bd)](_0x4c9694,'default',{'enumerable':!![],'value':_0x5175fe});}:function(_0x3a66ad,_0x4f4d44){const _0x3bda12=a60_0x2d31b2;_0x3a66ad[_0x3bda12(0x1eb)]=_0x4f4d44;}),__importStar=this&&this[a60_0x2d31b2(0x2d1)]||(function(){var _0x3917ac=function(_0x4e51da){const _0x52f0c2=a60_0x212f;return _0x3917ac=Object[_0x52f0c2(0x273)]||function(_0xb03d8b){const _0x3e91d2=_0x52f0c2;var _0x39a485=[];for(var _0xdf7ca9 in _0xb03d8b)if(Object[_0x3e91d2(0x1ed)][_0x3e91d2(0x210)][_0x3e91d2(0x22f)](_0xb03d8b,_0xdf7ca9))_0x39a485[_0x39a485[_0x3e91d2(0x267)]]=_0xdf7ca9;return _0x39a485;},_0x3917ac(_0x4e51da);};return function(_0x4c9a24){const _0x12e185=a60_0x212f;if(_0x4c9a24&&_0x4c9a24[_0x12e185(0x25e)])return _0x4c9a24;var _0x43bb68={};if(_0x4c9a24!=null){for(var _0x577c52=_0x3917ac(_0x4c9a24),_0x5b4052=0x0;_0x5b4052<_0x577c52[_0x12e185(0x267)];_0x5b4052++)if(_0x577c52[_0x5b4052]!=='default')__createBinding(_0x43bb68,_0x4c9a24,_0x577c52[_0x5b4052]);}return __setModuleDefault(_0x43bb68,_0x4c9a24),_0x43bb68;};}()),__importDefault=this&&this[a60_0x2d31b2(0x2de)]||function(_0x38bbf2){const _0x2bea87=a60_0x2d31b2;return _0x38bbf2&&_0x38bbf2[_0x2bea87(0x25e)]?_0x38bbf2:{'default':_0x38bbf2};};Object[a60_0x2d31b2(0x1bd)](exports,a60_0x2d31b2(0x25e),{'value':!![]}),exports[a60_0x2d31b2(0x2a6)]=void 0x0;const crypto_1=__importDefault(require(a60_0x2d31b2(0x2f1))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a60_0x2d31b2(0x250));function a60_0x4ca6(){const _0x3325f3=['\x20payment_id\x20for\x20search:\x20','üîê\x20AES\x20IV\x20length:','createDecipheriv','__importStar','‚úÖ\x20VISA\x20key\x20files\x20validated\x20successfully','‚ùå\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','visa/mastercard','‚úÖ\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','/charge','Failed\x20to\x20send\x20MasterCard\x20webhook:','207750lWHMlo','üìù\x20Final\x20request\x20structure:','HTTP\x20Status:','encryptRSA','set','__importDefault','1346785cDroSY','üîê\x20MasterCard\x20API\x20URL:','floor','üìù\x20Decrypted\x20webhook\x20data:','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application',',\x20Final:\x20',':\x20Unknown\x20status\x20code','orderId','logWhiteDomainRequest','sendShopWebhook','\x20\x20Original:\x20\x22','üîç\x20Using\x20','charge','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20',',\x20id=','Payment\x20System/1.0','amount','__createBinding','crypto','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','expire_month','toUpperCase','expire_year','visaApiUrl','Order\x20ID:','üì¶\x20FULL\x20RESPONSE\x20BODY:','visaMerchantPointId','\x20with\x20status\x20','üîê\x20MasterCard\x20Private\x20key\x20path:','none','masterCardMerchantPointId','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','/charge_decrypted','getOwnPropertyDescriptor','Status:','last_name','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','‚ùå\x20Failed\x20to\x20decrypt\x20status\x20response:','üîê\x20Data\x20signed\x20with\x20RSA','sendPaymentNotification','\x20\x20\x20-\x20lang:\x20en','Expected\x20bitcoin\x20transfer\x20from\x20client','Sender\x27s\x20card\x20details\x20are\x20required','üîê\x20Using\x20keys:\x20','VISA','gatewayOrderId',',\x20final=','üìä\x20Checking\x20','),\x20stopping\x20status\x20checks','\x20webhook\x20extracted\x20data:','üîç\x20Detected\x20card\x20type\x20from\x20webhook:\x20','constants','Card\x20Holder:','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','description','randomBytes','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','‚ùå\x20Status\x20check\x20#','private.pem','apiUrl','‚ùå\x20RSA\x20signing\x20failed:','decryptAES','\x20status\x20updated\x20to\x20','3ds_url','publicEncrypt','‚ùå\x20Data\x20being\x20signed:','\x22\x20|\x20\x22','isFinalStatus','üõë\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','Another\x20unknown\x20error','toLowerCase','Method\x20not\x20allowed','üí≥\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','writable','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','‚úÖ\x20Payment\x20','defineProperty','Failed\x20to\x20send\x20payment\x20notifications:','No\x20Error\x20executing\x20request','===\x20API\x20RESPONSE\x20===','\x20\x20Cleaned:\x20\x20\x22','‚ùå\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','cwd','isArray','stringify','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','join','\x20payment:\x20','\x20API:\x20','warn','Failed\x20to\x20decrypt\x20response','getDetailedErrorMessage','üîê\x20MasterCard\x20Public\x20key\x20path:','2304207rMGNyA','shopId','****','Error\x20parsing\x20webhook\x20events:','parse','error','üí≥\x20VISA/MasterCard\x20service\x20initialized','üîê\x20MasterCard\x20Public\x20key\x20length:\x20','masterCardApiUrl','application/json','trim','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','Failed\x20to\x20check\x20','LookUp\x20code\x20sent','\x20status\x20check\x20error:','FAILED','PENDING','üìù\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','sign','Result\x20URL:','create','\x20\x20\x20-\x20merchant_point_id:','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','‚úÖ\x20Status\x20response\x20decrypted\x20successfully','encryptAES','üîê\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','webhookUrl','default','\x20\x20\x20Amount:\x20','prototype','üßπ\x20Clearing\x20','decryptResponsePhp','date_success','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','base64','üîê\x203DS\x20verification\x20required','replace','aes-256-ctr','üí≥\x20Unknown\x20card\x20type\x20(starts\x20with\x20','üîç\x20Using\x20fallback\x20fields\x20for\x20search:\x20','Failed\x20payment','MASTERCARD','https://api.myatranz.com/api','Insufficient\x20funds\x20on\x20the\x20card','‚ùå\x20PHP\x20decryptor\x20request\x20failed:','üîê\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','Payment\x20prohibited','privateKeyPath','Test\x20payment','customerName','decryptResponse','payment','resolve','cardType','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','\x20status\x20check\x20#','üìç\x20Full\x20card\x20holder\x20data:','settings','Transaction\x20limit\x20exceeded','üìù\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','üîç\x20','üéØ\x20Using\x20','text','Amount:','hasOwnProperty','üîê\x20VISA\x20Public\x20key\x20length:\x20','üßπ\x20Card\x20holder\x20names\x20cleaned:','number','Captcha\x20confirmation\x20awaited','shop','\x20characters','from','customerEmail','sendPaymentNotifications','****\x20****\x20****\x20','getCardTypeAndApi','includes','postcode','key','now','üîê\x20AES\x20key\x20length:','headers','üìù\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','end','unknown','\x20payment\x20status:\x20','charAt','‚úÖ\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP',',\x20orderId=','message','‚úÖ\x20MasterCard\x20key\x20files\x20validated\x20successfully','‚úÖ\x20Payment\x20successful','../../config/database','üì¶\x20FULL\x20REQUEST\x20JSON:','createdAt','call','‚ùå\x20RSA\x20encryption\x20failed:','desc','failureMessage','üìä\x20','Webhook\x20event\x20','Payment\x20confirmation\x20time\x20has\x20expired','üîê\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','Payment\x20confirmation\x20required','‚ùå\x20VISA/MasterCard\x20key\x20validation\x20failed:','Operation\x20completed\x20successfully','statusCheckTimers','Payment\x20ID:','-----END','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','...','payment_id','5078020ccEjAJ','stopAllStatusChecks','logWhiteDomainError','HTTP\x20error!\x20status:\x20','PIN\x20code\x20confirmation\x20awaited','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Payment\x20System/1.0\x20(MasterCard)','payment.success','\x20for\x20payment\x20','keys','paymentStatuses','card_type','failed','\x20MasterCard\x20status\x20check\x20timers','Response\x20Time:','errorMessage','../loggerService','logShopWebhookError','updatePaymentStatus','first_name','logWhiteDomainResponse','PAID','final','\x20\x20\x20-\x20info\x20length:','currency','processCardPayment','The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established','merchantPointId','üìù\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','checkPaymentStatus','__esModule','Sender\x27s\x20CVV\x20card\x20is\x20required','‚ùå\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','Payment\x20cancellation\x20is\x20being\x20processed','10flWzev','signRSA','üìù\x20Signature\x20length:','‚úÖ\x20Scheduled\x20','üìù\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','length','publicKeyPath','Awaiting\x20confirmation\x20in\x20the\x20application','‚ö†Ô∏è\x20Expected\x20VISA\x20private\x20key:\x20','517784UAuYmY','scheduleStatusChecks','üîê\x20RSA\x20signing\x20successful','../telegramBotService','/status','toString','‚ö†Ô∏è\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','1111','getOwnPropertyNames','\x20(from:\x20order_id=','5000000000000000','2053720cgtskR','visaPublicKeyPath','/status_raw','configurable','paidAt','\x20order_id\x20for\x20search:\x20','‚ùå\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','Invalid\x20expiration\x20date','webhook_send','info','generateAESKey','LookUp\x20code\x20verified','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Request\x20data\x20error','Payment\x20is\x20being\x20processed','üì§\x20Sending\x20request\x20to\x20API...','visa_public.pem','\x20is\x20final\x20(','‚ö†Ô∏è\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','privateDecrypt','visaPrivateKeyPath','log','No\x20New\x20payment','HTTP\x20','\x20\x20\x20Currency:\x20','/status_decrypted','findUnique','üìù\x20Data\x20to\x20sign\x20length:','json','üìä\x20Status\x20check\x20result:','ms)','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','Number\x20of\x20attempts\x20exceeded','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','existsSync','Response\x20Headers:','3DS\x20verification\x20required','\x20result:','webhookEvents','RSA_PKCS1_PADDING','‚è∞\x20Will\x20check\x20status\x20','Status\x20','/charge_raw','post_code','\x20\x20\x20-\x20sign\x20length:','maskCardNumber','üîê\x20Data\x20encrypted\x20with\x20AES','VisaMasterCardService','üìù\x20Data\x20length:','‚ö†Ô∏è\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','Unsuccessful\x20payment','https://api.paydmeth.com/api','processWebhook','\x20(from:\x20status=','update','Payment\x20returned','clearStatusTimers','status','4135542UzXvwH','üîê\x20VISA\x20Private\x20key\x20path:','utf8','Return\x20URL:','\x20\x20\x20Status:\x20','35VmdSOq','POST','Final:','then','Status\x20Text:','push','validateKeyFiles','https://api2.trapay.uk/decrypt.php',',\x20payment_id=','Unknown\x20error','-----BEGIN','paymentId','üîê\x20Response\x20is\x20encrypted,\x20decrypting...','\x20\x20\x20Payment\x20ID:\x20','üîê\x20MasterCard\x20Private\x20key\x20length:\x20','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','Card\x20Number:','slice','order_id','get','Payment\x20pending\x20verification','loggerService','readFileSync',',\x20paymentId='];a60_0x4ca6=function(){return _0x3325f3;};return a60_0x4ca6();}class VisaMasterCardService{constructor(){const _0x25d493=a60_0x2d31b2;this[_0x25d493(0x23a)]=new Map(),this[_0x25d493(0x24a)]={0x0:{'final':![],'description':_0x25d493(0x28d)},0x1:{'final':![],'description':_0x25d493(0x1bf)},0x2:{'final':!![],'description':_0x25d493(0x283)},0x3:{'final':!![],'description':_0x25d493(0x1b6)},0x4:{'final':!![],'description':'Unsuccessful\x20payment'},0x5:{'final':!![],'description':_0x25d493(0x1e5)},0x6:{'final':!![],'description':_0x25d493(0x2ae)},0x7:{'final':!![],'description':_0x25d493(0x200)},0x8:{'final':![],'description':'Client\x20OTP\x20confirmation\x20required'},0x9:{'final':![],'description':_0x25d493(0x29b)},0xa:{'final':![],'description':_0x25d493(0x25f)},0xb:{'final':![],'description':'Sender\x20information\x20required'},0xc:{'final':![],'description':'Recipient\x20data\x20required'},0xd:{'final':![],'description':'Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number'},0xe:{'final':![],'description':'Awaiting\x20confirmation\x20by\x20ivr\x20call'},0xf:{'final':![],'description':_0x25d493(0x244)},0x10:{'final':![],'description':_0x25d493(0x214)},0x11:{'final':![],'description':_0x25d493(0x2d4)},0x12:{'final':![],'description':_0x25d493(0x269)},0x13:{'final':![],'description':_0x25d493(0x284)},0x14:{'final':![],'description':_0x25d493(0x289)},0x15:{'final':![],'description':_0x25d493(0x199)},0x16:{'final':![],'description':_0x25d493(0x2ca)},0x18:{'final':![],'description':_0x25d493(0x2f3)},0x19:{'final':![],'description':_0x25d493(0x1a5)},0x1a:{'final':!![],'description':'Cash\x20payment\x20is\x20expected\x20at\x20TCO'},0x1b:{'final':![],'description':_0x25d493(0x1a8)},0x1c:{'final':![],'description':_0x25d493(0x298)},0x1d:{'final':![],'description':_0x25d493(0x25a)},0x1f:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending'},0x20:{'final':![],'description':_0x25d493(0x2e3)},0x23:{'final':![],'description':_0x25d493(0x19a)},0x24:{'final':!![],'description':_0x25d493(0x235)},0x25:{'final':!![],'description':_0x25d493(0x1fe)},0x26:{'final':!![],'description':_0x25d493(0x206)},0x27:{'final':!![],'description':_0x25d493(0x1fb)},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':'The\x20card\x20is\x20lost\x20or\x20stolen'},0x2a:{'final':!![],'description':_0x25d493(0x27d)},0x2b:{'final':!![],'description':_0x25d493(0x20a)},0x2c:{'final':!![],'description':'The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank'},0x2d:{'final':!![],'description':_0x25d493(0x1f8)},0x2e:{'final':!![],'description':_0x25d493(0x2a9)},0x2f:{'final':!![],'description':'Unsuccessful\x20payment'},0x30:{'final':!![],'description':_0x25d493(0x1e6)},0x31:{'final':![],'description':_0x25d493(0x237)},0x32:{'final':!![],'description':_0x25d493(0x1b8)},0x33:{'final':!![],'description':_0x25d493(0x1f8)},0x34:{'final':!![],'description':_0x25d493(0x1f8)},0x35:{'final':!![],'description':_0x25d493(0x1f8)},0x36:{'final':!![],'description':'Failed\x20payment'},0x37:{'final':!![],'description':_0x25d493(0x1f8)},0x38:{'final':!![],'description':'Cancellation\x20is\x20not\x20possible'},0x39:{'final':![],'description':_0x25d493(0x296)},0x3a:{'final':![],'description':_0x25d493(0x1dc)},0x3b:{'final':!![],'description':_0x25d493(0x281)},0x3c:{'final':!![],'description':_0x25d493(0x297)},0x3d:{'final':!![],'description':_0x25d493(0x1f1)},0x3e:{'final':!![],'description':_0x25d493(0x1da)},0x3f:{'final':!![],'description':'Payment\x20returned'},0x40:{'final':![],'description':'LookUp\x20not\x20confirmed'},0x41:{'final':!![],'description':'LookUp\x20number\x20of\x20attempts\x20exceeded'},0x42:{'final':![],'description':_0x25d493(0x261)},0x43:{'final':!![],'description':_0x25d493(0x23d)},0x44:{'final':![],'description':_0x25d493(0x29b)},0x45:{'final':!![],'description':_0x25d493(0x1f8)},0x46:{'final':!![],'description':'Failed\x20payment'},0x47:{'final':!![],'description':_0x25d493(0x194)},0x64:{'final':!![],'description':_0x25d493(0x239)}},this['masterCardApiUrl']=_0x25d493(0x1fa),this[_0x25d493(0x2fe)]=0x50ca,this[_0x25d493(0x1ff)]=path_1[_0x25d493(0x1eb)][_0x25d493(0x1c7)](process[_0x25d493(0x1c3)](),_0x25d493(0x249),_0x25d493(0x1aa)),this[_0x25d493(0x268)]=path_1['default'][_0x25d493(0x1c7)](process[_0x25d493(0x1c3)](),'keys','psp_public.pem'),this['visaApiUrl']=_0x25d493(0x2aa),this[_0x25d493(0x2fa)]=0x6b7,this['visaPrivateKeyPath']=path_1[_0x25d493(0x1eb)][_0x25d493(0x1c7)](process[_0x25d493(0x1c3)](),_0x25d493(0x249),'visa_private.pem'),this[_0x25d493(0x277)]=path_1['default'][_0x25d493(0x1c7)](process['cwd'](),'keys',_0x25d493(0x286)),console[_0x25d493(0x28c)](_0x25d493(0x1d4)),console['log'](_0x25d493(0x2e0),this['masterCardApiUrl']),console['log']('üîê\x20VISA\x20API\x20URL:',this[_0x25d493(0x2f7)]),console[_0x25d493(0x28c)](_0x25d493(0x2fc),this['privateKeyPath']),console[_0x25d493(0x28c)](_0x25d493(0x1cd),this[_0x25d493(0x268)]),console[_0x25d493(0x28c)](_0x25d493(0x2b2),this[_0x25d493(0x28b)]),console[_0x25d493(0x28c)]('üîê\x20VISA\x20Public\x20key\x20path:',this['visaPublicKeyPath']),this[_0x25d493(0x2bc)]();}[a60_0x2d31b2(0x1cc)](_0x11507e,_0xd725ad){const _0x16141a=a60_0x2d31b2,_0x1d50db=this[_0x16141a(0x24a)][_0x11507e];let _0x813c61='';_0x1d50db?_0x813c61='Status\x20'+_0x11507e+':\x20'+_0x1d50db[_0x16141a(0x1a6)]:_0x813c61=_0x16141a(0x2a0)+_0x11507e+_0x16141a(0x2e5);if(_0xd725ad&&_0xd725ad['trim']()){const _0x4de4b2=_0xd725ad[_0x16141a(0x1d8)]();(!_0x1d50db||_0x4de4b2[_0x16141a(0x1b7)]()!==_0x1d50db[_0x16141a(0x1a6)][_0x16141a(0x1b7)]())&&(_0x813c61+='\x20|\x20Response:\x20'+_0x4de4b2);}return _0x813c61;}[a60_0x2d31b2(0x1b3)](_0x4172c6){const _0x2ad977=a60_0x2d31b2,_0x1f2db4=this['paymentStatuses'][_0x4172c6];return _0x1f2db4?_0x1f2db4[_0x2ad977(0x256)]:!![];}[a60_0x2d31b2(0x21b)](_0x4262e9){const _0x5b8ff8=a60_0x2d31b2,_0x371d84=_0x4262e9[_0x5b8ff8(0x226)](0x0);if(_0x371d84==='4')return console['log'](_0x5b8ff8(0x1b9)),{'cardType':'VISA','apiUrl':this[_0x5b8ff8(0x2f7)],'privateKeyPath':this['visaPrivateKeyPath'],'publicKeyPath':this[_0x5b8ff8(0x277)],'merchantPointId':this[_0x5b8ff8(0x2fa)]};else return _0x371d84==='5'?(console['log']('üí≥\x20Detected\x20MasterCard\x20(starts\x20with\x205)'),{'cardType':_0x5b8ff8(0x1f9),'apiUrl':this[_0x5b8ff8(0x1d6)],'privateKeyPath':this[_0x5b8ff8(0x1ff)],'publicKeyPath':this[_0x5b8ff8(0x268)],'merchantPointId':this[_0x5b8ff8(0x2fe)]}):(console[_0x5b8ff8(0x28c)](_0x5b8ff8(0x1f6)+_0x371d84+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':_0x5b8ff8(0x1f9),'apiUrl':this[_0x5b8ff8(0x1d6)],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x5b8ff8(0x2fe)]});}[a60_0x2d31b2(0x2bc)](){const _0x320451=a60_0x2d31b2;try{if(!fs_1[_0x320451(0x1eb)][_0x320451(0x299)](this[_0x320451(0x1ff)]))throw new Error(_0x320451(0x1c6)+this[_0x320451(0x1ff)]);if(!fs_1[_0x320451(0x1eb)][_0x320451(0x299)](this[_0x320451(0x268)]))throw new Error(_0x320451(0x2c5)+this[_0x320451(0x268)]);const _0x42cae7=fs_1[_0x320451(0x1eb)][_0x320451(0x2cc)](this['privateKeyPath'],_0x320451(0x2b3))[_0x320451(0x1d8)](),_0x1c065c=fs_1[_0x320451(0x1eb)]['readFileSync'](this[_0x320451(0x268)],'utf8')[_0x320451(0x1d8)]();if(!_0x42cae7[_0x320451(0x21c)](_0x320451(0x2c0))||!_0x42cae7[_0x320451(0x21c)](_0x320451(0x23c)))throw new Error(_0x320451(0x282));if(!_0x1c065c[_0x320451(0x21c)](_0x320451(0x2c0))||!_0x1c065c[_0x320451(0x21c)]('-----END'))throw new Error(_0x320451(0x245));console['log'](_0x320451(0x22a)),console[_0x320451(0x28c)](_0x320451(0x2c4)+_0x42cae7['length']+_0x320451(0x216)),console[_0x320451(0x28c)](_0x320451(0x1d5)+_0x1c065c[_0x320451(0x267)]+'\x20characters');if(fs_1['default'][_0x320451(0x299)](this['visaPrivateKeyPath'])&&fs_1[_0x320451(0x1eb)][_0x320451(0x299)](this[_0x320451(0x277)])){const _0xc61b00=fs_1[_0x320451(0x1eb)][_0x320451(0x2cc)](this[_0x320451(0x28b)],_0x320451(0x2b3))['trim'](),_0xfb6f65=fs_1[_0x320451(0x1eb)]['readFileSync'](this[_0x320451(0x277)],_0x320451(0x2b3))[_0x320451(0x1d8)]();(!_0xc61b00[_0x320451(0x21c)](_0x320451(0x2c0))||!_0xc61b00[_0x320451(0x21c)](_0x320451(0x23c)))&&console[_0x320451(0x1ca)]('‚ö†Ô∏è\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),(!_0xfb6f65[_0x320451(0x21c)]('-----BEGIN')||!_0xfb6f65[_0x320451(0x21c)](_0x320451(0x23c)))&&console['warn'](_0x320451(0x271)),console[_0x320451(0x28c)](_0x320451(0x2d2)),console[_0x320451(0x28c)]('üîê\x20VISA\x20Private\x20key\x20length:\x20'+_0xc61b00[_0x320451(0x267)]+'\x20characters'),console[_0x320451(0x28c)](_0x320451(0x211)+_0xfb6f65['length']+'\x20characters');}else console['warn'](_0x320451(0x288)),console[_0x320451(0x1ca)](_0x320451(0x26a)+this[_0x320451(0x28b)]),console[_0x320451(0x1ca)]('‚ö†Ô∏è\x20Expected\x20VISA\x20public\x20key:\x20'+this[_0x320451(0x277)]);}catch(_0x3da18a){console[_0x320451(0x1d3)](_0x320451(0x238),_0x3da18a);throw _0x3da18a;}}[a60_0x2d31b2(0x280)](){const _0x54bdbb=a60_0x2d31b2,_0x58ef2a=crypto_1[_0x54bdbb(0x1eb)]['randomBytes'](0x20),_0x2d3fb8=crypto_1['default'][_0x54bdbb(0x1a7)](0x10);return{'key':_0x58ef2a,'iv':_0x2d3fb8};}[a60_0x2d31b2(0x1e8)](_0x475fba,_0x452d62,_0x215648){const _0x12be99=a60_0x2d31b2,_0x2477eb=crypto_1[_0x12be99(0x1eb)]['createCipheriv'](_0x12be99(0x1f5),_0x452d62,_0x215648);let _0x494817=_0x2477eb[_0x12be99(0x2ad)](_0x475fba,_0x12be99(0x2b3),_0x12be99(0x1f2));return _0x494817+=_0x2477eb[_0x12be99(0x256)](_0x12be99(0x1f2)),_0x494817;}[a60_0x2d31b2(0x2dc)](_0x102031,_0x3bdd0c,_0x424ccd){const _0x215f20=a60_0x2d31b2;try{const _0x9308a=fs_1[_0x215f20(0x1eb)]['readFileSync'](_0x424ccd,_0x215f20(0x2b3))['trim'](),_0x584725={'iv':_0x3bdd0c[_0x215f20(0x270)]('base64'),'key':_0x102031[_0x215f20(0x270)](_0x215f20(0x1f2))},_0x3ad118=JSON[_0x215f20(0x1c5)](_0x584725);console['log']('üîê\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x3ad118[_0x215f20(0x267)]);const _0x11aa5c=crypto_1[_0x215f20(0x1eb)][_0x215f20(0x1b0)]({'key':_0x9308a,'padding':crypto_1[_0x215f20(0x1eb)][_0x215f20(0x1a3)][_0x215f20(0x29e)]},Buffer['from'](_0x3ad118));return console[_0x215f20(0x28c)](_0x215f20(0x2d6),_0x11aa5c[_0x215f20(0x267)]),_0x11aa5c['toString'](_0x215f20(0x1f2));}catch(_0x4a6a4c){console[_0x215f20(0x1d3)](_0x215f20(0x230),_0x4a6a4c);throw new Error(_0x215f20(0x2ff));}}[a60_0x2d31b2(0x263)](_0x2f51df,_0x2a8e40){const _0x38028c=a60_0x2d31b2;try{const _0x520f84=fs_1['default'][_0x38028c(0x2cc)](_0x2a8e40,_0x38028c(0x2b3))['trim'](),_0x3a559a=crypto_1[_0x38028c(0x1eb)]['createSign']('SHA256');_0x3a559a['update'](_0x2f51df),_0x3a559a[_0x38028c(0x223)]();const _0x5ca57a=_0x3a559a[_0x38028c(0x1e1)](_0x520f84,'base64');return console[_0x38028c(0x28c)](_0x38028c(0x26d)),console['log'](_0x38028c(0x292),_0x2f51df[_0x38028c(0x267)]),console[_0x38028c(0x28c)](_0x38028c(0x264),_0x5ca57a[_0x38028c(0x267)]),_0x5ca57a;}catch(_0x4fd28b){console['error'](_0x38028c(0x1ac),_0x4fd28b),console[_0x38028c(0x1d3)](_0x38028c(0x1b1),_0x2f51df['substring'](0x0,0xc8)+_0x38028c(0x23e));throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}[a60_0x2d31b2(0x1ad)](_0x419cfe,_0x23130a,_0x154233){const _0x4bc2cd=a60_0x2d31b2,_0x2efb26=crypto_1[_0x4bc2cd(0x1eb)][_0x4bc2cd(0x2d0)](_0x4bc2cd(0x1f5),_0x23130a,_0x154233);let _0x13404f=_0x2efb26['update'](_0x419cfe,_0x4bc2cd(0x1f2),_0x4bc2cd(0x2b3));return _0x13404f+=_0x2efb26[_0x4bc2cd(0x256)](_0x4bc2cd(0x2b3)),_0x13404f;}async[a60_0x2d31b2(0x1ef)](_0x291dd3,_0x2e0024,_0x3cf1f6='MASTERCARD'){const _0x405acf=a60_0x2d31b2;try{const _0x511c51=await fetch(_0x405acf(0x2bd),{'method':_0x405acf(0x2b7),'headers':{'Content-Type':_0x405acf(0x1d7)},'body':JSON[_0x405acf(0x1c5)]({'info':_0x291dd3,'key':_0x2e0024,'card_type':_0x3cf1f6[_0x405acf(0x1b7)]()})});if(!_0x511c51['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x511c51[_0x405acf(0x20e)]();}catch(_0x64d0eb){console['error'](_0x405acf(0x1fc),_0x64d0eb);throw new Error(_0x405acf(0x1bb));}}[a60_0x2d31b2(0x202)](_0x5d17b5,_0x297937){const _0xd4a985=a60_0x2d31b2;try{const _0x4c6206=fs_1[_0xd4a985(0x1eb)][_0xd4a985(0x2cc)](this[_0xd4a985(0x1ff)],_0xd4a985(0x2b3))['trim'](),_0x16dab7=crypto_1[_0xd4a985(0x1eb)][_0xd4a985(0x28a)](_0x4c6206,Buffer[_0xd4a985(0x217)](_0x297937,_0xd4a985(0x1f2))),_0x2aefcf=JSON[_0xd4a985(0x1d2)](_0x16dab7[_0xd4a985(0x270)]()),_0x2774d8=Buffer['from'](_0x2aefcf[_0xd4a985(0x21e)],_0xd4a985(0x1f2)),_0x3e0ace=Buffer[_0xd4a985(0x217)](_0x2aefcf['iv'],'base64');return this[_0xd4a985(0x1ad)](_0x5d17b5,_0x2774d8,_0x3e0ace);}catch(_0x24185c){throw new Error(_0xd4a985(0x1cb));}}async[a60_0x2d31b2(0x259)](_0x385a02){const _0x12144f=a60_0x2d31b2,{paymentId:_0x13f24c,orderId:_0x339521,amount:_0x1e62c,currency:_0xd20162,cardData:_0x34c37f,resultUrl:_0x36b519,returnUrl:_0x2d4504,cardHolder:_0x4ae99c,browser:_0x342ce0}=_0x385a02;console[_0x12144f(0x28c)](_0x12144f(0x2f2)),console['log'](_0x12144f(0x23b),_0x13f24c),console[_0x12144f(0x28c)](_0x12144f(0x2f8),_0x339521),console[_0x12144f(0x28c)](_0x12144f(0x20f),_0x1e62c,_0xd20162),console[_0x12144f(0x28c)](_0x12144f(0x2c6),this['maskCardNumber'](_0x34c37f[_0x12144f(0x213)])),console[_0x12144f(0x28c)](_0x12144f(0x1a4),_0x4ae99c[_0x12144f(0x253)]+'\x20'+_0x4ae99c[_0x12144f(0x193)]),console[_0x12144f(0x28c)](_0x12144f(0x2b4),_0x2d4504),console[_0x12144f(0x28c)](_0x12144f(0x1e2),_0x36b519);const _0x482853=this[_0x12144f(0x21b)](_0x34c37f[_0x12144f(0x213)]);console[_0x12144f(0x28c)](_0x12144f(0x20d)+_0x482853[_0x12144f(0x205)]+_0x12144f(0x1c9)+_0x482853[_0x12144f(0x1ab)]),console['log'](_0x12144f(0x19b)+_0x482853['privateKeyPath']+',\x20'+_0x482853[_0x12144f(0x268)]);const _0x3a3431={..._0x4ae99c,'first_name':_0x4ae99c[_0x12144f(0x253)]?.[_0x12144f(0x1f4)](/[\t\n\r\f\v]/g,'\x20')['trim']()||'','last_name':_0x4ae99c['last_name']?.[_0x12144f(0x1f4)](/[\t\n\r\f\v]/g,'\x20')[_0x12144f(0x1d8)]()||''};_0x12144f(0x21d)in _0x3a3431&&!('post_code'in _0x3a3431)&&(_0x3a3431[_0x12144f(0x2a2)]=_0x3a3431['postcode'],delete _0x3a3431[_0x12144f(0x21d)],console[_0x12144f(0x28c)]('üîÑ\x20Converted\x20postcode\x20to\x20post_code:\x20'+_0x3a3431[_0x12144f(0x2a2)]));console[_0x12144f(0x28c)](_0x12144f(0x212)),console[_0x12144f(0x28c)](_0x12144f(0x2e9)+_0x4ae99c['first_name']+_0x12144f(0x1b2)+_0x4ae99c['last_name']+'\x22'),console[_0x12144f(0x28c)](_0x12144f(0x1c1)+_0x3a3431[_0x12144f(0x253)]+_0x12144f(0x1b2)+_0x3a3431[_0x12144f(0x193)]+'\x22'),console[_0x12144f(0x28c)](_0x12144f(0x208),JSON[_0x12144f(0x1c5)](_0x3a3431,null,0x2));const _0x1356b2={'amount':_0x1e62c,'currency':_0xd20162['toUpperCase'](),'order_id':_0x339521,'result_url':_0x36b519,'return_url':_0x2d4504,'country':'','card':{'number':_0x34c37f[_0x12144f(0x213)],'expire_month':_0x34c37f[_0x12144f(0x2f4)],'expire_year':_0x34c37f[_0x12144f(0x2f6)],'cvv':_0x34c37f['cvv']},'card_holder':_0x3a3431,'browser':_0x342ce0},_0xee93c1=JSON['stringify'](_0x1356b2);console['log']('üíæ\x20Payment\x20data\x20prepared'),console['log'](_0x12144f(0x1e0)),console['log'](_0xee93c1),console[_0x12144f(0x28c)](_0x12144f(0x2a7),_0xee93c1[_0x12144f(0x267)]);try{const {key:_0x3c4e15,iv:_0x594377}=this['generateAESKey']();console['log']('üîê\x20AES\x20key\x20and\x20IV\x20generated'),console[_0x12144f(0x28c)](_0x12144f(0x220),_0x3c4e15[_0x12144f(0x267)]),console[_0x12144f(0x28c)](_0x12144f(0x2cf),_0x594377['length']);const _0x43747a=this[_0x12144f(0x1e8)](_0xee93c1,_0x3c4e15,_0x594377);console['log'](_0x12144f(0x2a5)),console[_0x12144f(0x28c)]('üìù\x20Encrypted\x20data\x20length:',_0x43747a[_0x12144f(0x267)]);const _0x43ce2f=this[_0x12144f(0x2dc)](_0x3c4e15,_0x594377,_0x482853['publicKeyPath']);console['log'](_0x12144f(0x1fd)),console['log']('üìù\x20Encrypted\x20key\x20length:',_0x43ce2f[_0x12144f(0x267)]);const _0xee029b=this[_0x12144f(0x263)](_0xee93c1,_0x482853[_0x12144f(0x1ff)]);console[_0x12144f(0x28c)](_0x12144f(0x196)),console[_0x12144f(0x28c)](_0x12144f(0x264),_0xee029b[_0x12144f(0x267)]);const _0x15434a={'merchant_point_id':_0x482853[_0x12144f(0x25b)],'method':_0x12144f(0x2eb),'info':_0x43747a,'key':_0x43ce2f,'sign':_0xee029b,'lang':'en'};console[_0x12144f(0x28c)](_0x12144f(0x285)),console['log'](_0x12144f(0x2da)),console[_0x12144f(0x28c)](_0x12144f(0x1e4),_0x482853[_0x12144f(0x25b)]),console['log']('\x20\x20\x20-\x20method:\x20charge'),console[_0x12144f(0x28c)](_0x12144f(0x257),_0x43747a[_0x12144f(0x267)]),console[_0x12144f(0x28c)]('\x20\x20\x20-\x20key\x20length:',_0x43ce2f[_0x12144f(0x267)]),console[_0x12144f(0x28c)](_0x12144f(0x2a3),_0xee029b[_0x12144f(0x267)]),console[_0x12144f(0x28c)](_0x12144f(0x198)),console[_0x12144f(0x28c)](''),console[_0x12144f(0x28c)](_0x12144f(0x22d)),console[_0x12144f(0x28c)](JSON[_0x12144f(0x1c5)](_0x15434a,null,0x2)),console['log'](''),loggerService_1[_0x12144f(0x2cb)]['logWhiteDomainRequest'](_0x482853[_0x12144f(0x205)][_0x12144f(0x1b7)](),_0x12144f(0x2d7),_0x12144f(0x2b7),{'merchant_point_id':_0x482853['merchantPointId'],'method':_0x12144f(0x2eb),'lang':'en'});const _0xb6357f=Date[_0x12144f(0x21f)](),_0x95322c=await fetch(_0x482853[_0x12144f(0x1ab)],{'method':_0x12144f(0x2b7),'headers':{'Content-Type':_0x12144f(0x1d7),'Accept':_0x12144f(0x1d7),'User-Agent':_0x12144f(0x2ee)},'body':JSON[_0x12144f(0x1c5)](_0x15434a)}),_0x153667=Date[_0x12144f(0x21f)]()-_0xb6357f;console[_0x12144f(0x28c)](_0x12144f(0x1c0)),console[_0x12144f(0x28c)](_0x12144f(0x192),_0x95322c['status']),console[_0x12144f(0x28c)](_0x12144f(0x2ba),_0x95322c['statusText']),console[_0x12144f(0x28c)](_0x12144f(0x24e),_0x153667+'ms'),console['log'](_0x12144f(0x29a)),_0x95322c[_0x12144f(0x221)]['forEach']((_0x1f58d9,_0x109afe)=>{const _0x47cf0d=_0x12144f;console[_0x47cf0d(0x28c)]('\x20\x20\x20'+_0x109afe+':\x20'+_0x1f58d9);}),console[_0x12144f(0x28c)]('');if(!_0x95322c['ok']){const _0x187212=await _0x95322c[_0x12144f(0x20e)]();console[_0x12144f(0x1d3)](_0x12144f(0x2db),_0x95322c['status']),console[_0x12144f(0x1d3)](_0x12144f(0x2f9)),console[_0x12144f(0x1d3)](_0x187212),console['error'](''),loggerService_1[_0x12144f(0x2cb)][_0x12144f(0x254)](_0x482853[_0x12144f(0x205)][_0x12144f(0x1b7)](),_0x12144f(0x2a1),_0x95322c['status'],_0x187212,_0x153667),loggerService_1[_0x12144f(0x2cb)][_0x12144f(0x242)](_0x482853[_0x12144f(0x205)][_0x12144f(0x1b7)](),_0x12144f(0x2d7),_0x12144f(0x28e)+_0x95322c[_0x12144f(0x2b0)]+':\x20'+_0x187212);throw new Error(_0x12144f(0x243)+_0x95322c[_0x12144f(0x2b0)]+',\x20body:\x20'+_0x187212);}const _0x165ab7=await _0x95322c[_0x12144f(0x293)]();console[_0x12144f(0x28c)]('üì¶\x20FULL\x20RESPONSE\x20JSON:'),console[_0x12144f(0x28c)](JSON['stringify'](_0x165ab7,null,0x2)),console[_0x12144f(0x28c)](''),loggerService_1[_0x12144f(0x2cb)][_0x12144f(0x254)](_0x482853[_0x12144f(0x205)][_0x12144f(0x1b7)](),'/charge_raw',_0x95322c['status'],_0x165ab7,_0x153667),console[_0x12144f(0x28c)]('===\x20PARSED\x20API\x20RESPONSE\x20===');let _0x5eb180=_0x165ab7;if(_0x165ab7[_0x12144f(0x27f)]&&_0x165ab7['key']&&_0x165ab7[_0x12144f(0x1e1)]){console['log'](_0x12144f(0x2c2));try{const _0x46104c=await this[_0x12144f(0x1ef)](_0x165ab7['info'],_0x165ab7[_0x12144f(0x21e)],_0x482853['cardType']);_0x5eb180=JSON[_0x12144f(0x1d2)](_0x46104c),console[_0x12144f(0x28c)]('‚úÖ\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1['loggerService'][_0x12144f(0x254)](_0x482853['cardType']['toLowerCase'](),_0x12144f(0x190),_0x95322c[_0x12144f(0x2b0)],_0x5eb180,_0x153667),console[_0x12144f(0x28c)]('üìù\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x45580d){console[_0x12144f(0x1d3)](_0x12144f(0x2d3),_0x45580d),loggerService_1['loggerService'][_0x12144f(0x242)](_0x482853['cardType'][_0x12144f(0x1b7)](),'/charge_decrypt','Decryption\x20failed:\x20'+_0x45580d),_0x5eb180=_0x165ab7;}}else loggerService_1[_0x12144f(0x2cb)][_0x12144f(0x254)](_0x482853[_0x12144f(0x205)][_0x12144f(0x1b7)](),_0x12144f(0x190),_0x95322c[_0x12144f(0x2b0)],_0x5eb180,_0x153667),console[_0x12144f(0x28c)](_0x12144f(0x25c));console[_0x12144f(0x28c)](_0x12144f(0x192),_0x5eb180[_0x12144f(0x2b0)]),console['log'](_0x12144f(0x2b8),_0x5eb180[_0x12144f(0x256)]),console[_0x12144f(0x28c)](_0x12144f(0x23b),_0x5eb180[_0x12144f(0x23f)]),console[_0x12144f(0x28c)]('3DS\x20URL:',_0x5eb180[_0x12144f(0x1af)]||_0x12144f(0x2fd));if(_0x5eb180[_0x12144f(0x2b0)]===0x64&&_0x5eb180[_0x12144f(0x256)]===0x1)return console[_0x12144f(0x28c)](_0x12144f(0x22b)),{'gateway_payment_id':_0x5eb180[_0x12144f(0x23f)]?.[_0x12144f(0x270)](),'payment_url':_0x2d4504,'requires_3ds':![],'status':_0x12144f(0x255),'final':!![]};if(_0x5eb180['3ds_url'])return console[_0x12144f(0x28c)](_0x12144f(0x1f3)),this['scheduleStatusChecks'](_0x13f24c,_0x339521,_0x5eb180[_0x12144f(0x23f)]?.[_0x12144f(0x270)]()||_0x339521,_0x482853[_0x12144f(0x205)]),{'gateway_payment_id':_0x5eb180['payment_id']?.[_0x12144f(0x270)](),'payment_url':_0x5eb180[_0x12144f(0x1af)],'requires_3ds':!![],'threeds_url':_0x5eb180[_0x12144f(0x1af)],'status':'PENDING','final':![]};let _0x124ec8=this[_0x12144f(0x1cc)](_0x5eb180[_0x12144f(0x2b0)],_0x5eb180['desc']||_0x5eb180[_0x12144f(0x229)]),_0x7a6ad6=_0x5eb180[_0x12144f(0x2b0)],_0x1d099f=this['isFinalStatus'](_0x5eb180[_0x12144f(0x2b0)]);return console[_0x12144f(0x28c)](_0x12144f(0x1c2)+_0x7a6ad6+_0x12144f(0x2e4)+_0x1d099f+',\x20Desc:\x20'+_0x124ec8),{'gateway_payment_id':_0x5eb180[_0x12144f(0x23f)]?.[_0x12144f(0x270)](),'payment_url':_0x2d4504,'requires_3ds':![],'status':_0x12144f(0x1de),'final':!![],'errorMessage':_0x124ec8};}catch(_0x2ad3ab){console[_0x12144f(0x1d3)](_0x12144f(0x1b5)),console[_0x12144f(0x1d3)]('Error\x20details:',_0x2ad3ab),loggerService_1[_0x12144f(0x2cb)][_0x12144f(0x242)](_0x12144f(0x2d5),'/charge',_0x2ad3ab);throw new Error(_0x12144f(0x2ec)+(_0x2ad3ab instanceof Error?_0x2ad3ab['message']:_0x12144f(0x2bf)));}}async[a60_0x2d31b2(0x25d)](_0x35fe8e,_0x2f8fdd,_0x4de962='VISA'){const _0x16c404=a60_0x2d31b2;console[_0x16c404(0x28c)](_0x16c404(0x19f)+_0x4de962+_0x16c404(0x225)+_0x35fe8e+'\x20('+_0x2f8fdd+')');try{const _0x574453={'payment_id':_0x35fe8e,'order_id':_0x2f8fdd},_0x14e7f0=JSON[_0x16c404(0x1c5)](_0x574453),_0x2e57b1=this[_0x16c404(0x21b)](_0x4de962===_0x16c404(0x19c)?'4000000000000000':_0x16c404(0x275)),{key:_0x595118,iv:_0xbe9f14}=this[_0x16c404(0x280)](),_0xab4607=this['encryptAES'](_0x14e7f0,_0x595118,_0xbe9f14),_0x48a995=this[_0x16c404(0x2dc)](_0x595118,_0xbe9f14,_0x2e57b1['publicKeyPath']),_0x4d0d3f=this[_0x16c404(0x263)](_0x14e7f0,_0x2e57b1[_0x16c404(0x1ff)]),_0x358424={'merchant_point_id':_0x2e57b1[_0x16c404(0x25b)],'method':_0x16c404(0x2b0),'info':_0xab4607,'key':_0x48a995,'sign':_0x4d0d3f,'lang':'en'};loggerService_1[_0x16c404(0x2cb)][_0x16c404(0x2e7)](_0x4de962[_0x16c404(0x1b7)](),'/status','POST',{'merchant_point_id':_0x2e57b1[_0x16c404(0x25b)],'method':_0x16c404(0x2b0),'lang':'en'});const _0x57d0c9=Date['now'](),_0x3eba66=await fetch(_0x2e57b1[_0x16c404(0x1ab)],{'method':'POST','headers':{'Content-Type':_0x16c404(0x1d7),'Accept':_0x16c404(0x1d7),'User-Agent':_0x16c404(0x2ee)},'body':JSON[_0x16c404(0x1c5)](_0x358424)}),_0x514291=Date[_0x16c404(0x21f)]()-_0x57d0c9;if(!_0x3eba66['ok']){const _0x35e111=await _0x3eba66['text']();loggerService_1[_0x16c404(0x2cb)][_0x16c404(0x254)](_0x4de962[_0x16c404(0x1b7)](),'/status_raw',_0x3eba66[_0x16c404(0x2b0)],_0x35e111,_0x514291);throw new Error(_0x16c404(0x243)+_0x3eba66[_0x16c404(0x2b0)]);}const _0x4b9f72=await _0x3eba66[_0x16c404(0x293)]();loggerService_1[_0x16c404(0x2cb)]['logWhiteDomainResponse'](_0x4de962['toLowerCase'](),_0x16c404(0x278),_0x3eba66[_0x16c404(0x2b0)],_0x4b9f72,_0x514291);let _0x4423ea=_0x4b9f72;if(_0x4b9f72[_0x16c404(0x27f)]&&_0x4b9f72['key']&&_0x4b9f72['sign']){console[_0x16c404(0x28c)](_0x16c404(0x236));try{const _0x50e232=await this[_0x16c404(0x1ef)](_0x4b9f72[_0x16c404(0x27f)],_0x4b9f72[_0x16c404(0x21e)],_0x4de962);_0x4423ea=JSON[_0x16c404(0x1d2)](_0x50e232),console[_0x16c404(0x28c)](_0x16c404(0x1e7)),loggerService_1[_0x16c404(0x2cb)][_0x16c404(0x254)](_0x4de962[_0x16c404(0x1b7)](),_0x16c404(0x290),_0x3eba66[_0x16c404(0x2b0)],_0x4423ea,_0x514291),console[_0x16c404(0x28c)](_0x16c404(0x222));}catch(_0xe70827){console[_0x16c404(0x1d3)](_0x16c404(0x195),_0xe70827),loggerService_1['loggerService'][_0x16c404(0x242)](_0x4de962[_0x16c404(0x1b7)](),'/status_decrypt','Status\x20decryption\x20failed:\x20'+_0xe70827),_0x4423ea=_0x4b9f72;}}else loggerService_1[_0x16c404(0x2cb)][_0x16c404(0x254)](_0x4de962[_0x16c404(0x1b7)](),'/status_decrypted',_0x3eba66[_0x16c404(0x2b0)],_0x4423ea,_0x514291),console[_0x16c404(0x28c)](_0x16c404(0x20b));console[_0x16c404(0x28c)](_0x16c404(0x294),{'status':_0x4423ea[_0x16c404(0x2b0)],'final':_0x4423ea[_0x16c404(0x256)],'payment_id':_0x4423ea[_0x16c404(0x23f)],'desc':_0x4423ea[_0x16c404(0x231)]});let _0x398513=_0x16c404(0x1df);if(_0x4423ea[_0x16c404(0x2b0)]===0x64&&_0x4423ea[_0x16c404(0x256)]===0x1)_0x398513=_0x16c404(0x255);else{if(_0x4423ea[_0x16c404(0x256)]===0x0||!this[_0x16c404(0x1b3)](_0x4423ea[_0x16c404(0x2b0)]))_0x398513='PENDING';else _0x4423ea[_0x16c404(0x256)]===0x1||this[_0x16c404(0x1b3)](_0x4423ea[_0x16c404(0x2b0)])?_0x398513=_0x16c404(0x1de):_0x398513=_0x16c404(0x1df);}const _0x5ba5d4=this[_0x16c404(0x1cc)](_0x4423ea[_0x16c404(0x2b0)],_0x4423ea[_0x16c404(0x231)]);return{'status':_0x398513,'final':this[_0x16c404(0x1b3)](_0x4423ea[_0x16c404(0x2b0)]),'amount':_0x4423ea[_0x16c404(0x2ef)],'currency':_0x4423ea['currency'],'date_success':_0x4423ea[_0x16c404(0x1f0)],'description':_0x5ba5d4};}catch(_0x3b6465){console[_0x16c404(0x1d3)](_0x4de962+_0x16c404(0x1dd),_0x3b6465),loggerService_1['loggerService'][_0x16c404(0x242)](_0x4de962[_0x16c404(0x1b7)](),_0x16c404(0x26f),_0x3b6465);throw new Error(_0x16c404(0x1db)+_0x4de962+_0x16c404(0x225)+(_0x3b6465 instanceof Error?_0x3b6465[_0x16c404(0x229)]:_0x16c404(0x2bf)));}}[a60_0x2d31b2(0x26c)](_0x162847,_0x1bb1eb,_0x353aeb,_0xd11624){const _0xf5dfab=a60_0x2d31b2;console[_0xf5dfab(0x28c)]('‚è∞\x20Scheduling\x20status\x20checks\x20for\x20'+_0xd11624+_0xf5dfab(0x1c8)+_0x162847+'\x20('+_0x353aeb+')'),this['clearStatusTimers'](_0x162847);const _0x4dae85=[],_0x5d7379=0x5*0x3c*0x3e8,_0x2625db=0x2*0x3c*0x3c*0x3e8,_0x1f5542=Math[_0xf5dfab(0x2e1)](_0x2625db/_0x5d7379);console['log'](_0xf5dfab(0x29f)+_0x1f5542+_0xf5dfab(0x1d9));for(let _0x4ae5b6=0x1;_0x4ae5b6<=_0x1f5542;_0x4ae5b6++){const _0x141448=setTimeout(async()=>{const _0xd19f89=_0xf5dfab;console[_0xd19f89(0x28c)](_0xd19f89(0x20c)+_0xd11624+_0xd19f89(0x207)+_0x4ae5b6+'/'+_0x1f5542+_0xd19f89(0x248)+_0x162847);try{const _0x3bfb51=await this[_0xd19f89(0x25d)](_0x353aeb,_0x1bb1eb,_0xd11624);console[_0xd19f89(0x28c)]('üìä\x20Status\x20check\x20#'+_0x4ae5b6+_0xd19f89(0x29c),_0x3bfb51),_0x3bfb51[_0xd19f89(0x256)]&&(console[_0xd19f89(0x28c)](_0xd19f89(0x1bc)+_0x162847+_0xd19f89(0x287)+_0x3bfb51[_0xd19f89(0x2b0)]+_0xd19f89(0x1a0)),this[_0xd19f89(0x2af)](_0x162847),await this[_0xd19f89(0x252)](_0x162847,_0x3bfb51['status'],_0x3bfb51));}catch(_0x2fb497){console[_0xd19f89(0x1d3)](_0xd19f89(0x1a9)+_0x4ae5b6+'\x20failed\x20for\x20payment\x20'+_0x162847+':',_0x2fb497);}},_0x4ae5b6*_0x5d7379);_0x4dae85[_0xf5dfab(0x2bb)](_0x141448);}this['statusCheckTimers'][_0xf5dfab(0x2dd)](_0x162847,_0x4dae85),console[_0xf5dfab(0x28c)](_0xf5dfab(0x265)+_0x1f5542+'\x20status\x20checks\x20for\x20payment\x20'+_0x162847);}['clearStatusTimers'](_0x20d405){const _0x560a10=a60_0x2d31b2,_0x4f6d17=this['statusCheckTimers'][_0x560a10(0x2c9)](_0x20d405);_0x4f6d17&&(console[_0x560a10(0x28c)](_0x560a10(0x1ee)+_0x4f6d17['length']+'\x20status\x20timers\x20for\x20payment\x20'+_0x20d405),_0x4f6d17['forEach']((_0x5b2446,_0x3bec38)=>{clearTimeout(_0x5b2446);}),this[_0x560a10(0x23a)]['delete'](_0x20d405));}async[a60_0x2d31b2(0x252)](_0x251dc6,_0xfc78f4,_0x2aeb01){const _0x435131=a60_0x2d31b2;try{const _0x38cb07=(await Promise[_0x435131(0x204)]()[_0x435131(0x2b9)](()=>__importStar(require(_0x435131(0x22c)))))[_0x435131(0x1eb)],_0x2912f7={'status':_0xfc78f4['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0xfc78f4===_0x435131(0x255)&&(_0x2912f7[_0x435131(0x27a)]=new Date()),_0xfc78f4==='FAILED'&&_0x2aeb01[_0x435131(0x1a6)]&&(_0x2912f7[_0x435131(0x232)]=_0x2aeb01[_0x435131(0x1a6)],console[_0x435131(0x28c)]('üíæ\x20Saving\x20failure\x20message:\x20'+_0x2aeb01[_0x435131(0x1a6)])),await _0x38cb07[_0x435131(0x203)][_0x435131(0x2ad)]({'where':{'id':_0x251dc6},'data':_0x2912f7}),console[_0x435131(0x28c)](_0x435131(0x1bc)+_0x251dc6+_0x435131(0x1ae)+_0xfc78f4),await this[_0x435131(0x219)](_0x251dc6,_0xfc78f4);}catch(_0x169f80){console['error'](_0x435131(0x27c)+_0x251dc6+':',_0x169f80);}}async[a60_0x2d31b2(0x219)](_0x44a7ed,_0x2f6f7b){const _0x4becb9=a60_0x2d31b2;try{const _0x2bb281=(await Promise['resolve']()['then'](()=>__importStar(require(_0x4becb9(0x22c)))))[_0x4becb9(0x1eb)],{telegramBotService:_0x57c41b}=await Promise[_0x4becb9(0x204)]()[_0x4becb9(0x2b9)](()=>__importStar(require(_0x4becb9(0x26e)))),_0x3572c7=await _0x2bb281[_0x4becb9(0x203)][_0x4becb9(0x291)]({'where':{'id':_0x44a7ed},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x3572c7)return;const _0x203e53={'PAID':'paid','FAILED':_0x4becb9(0x24c)},_0x1c5c0c=_0x203e53[_0x2f6f7b];_0x1c5c0c&&await _0x57c41b[_0x4becb9(0x197)](_0x3572c7[_0x4becb9(0x1cf)],_0x3572c7,_0x1c5c0c),await this[_0x4becb9(0x2e8)](_0x3572c7,_0x2f6f7b);}catch(_0x2dcb6f){console[_0x4becb9(0x1d3)](_0x4becb9(0x1be),_0x2dcb6f);}}async[a60_0x2d31b2(0x2e8)](_0x3fdab8,_0x142b46){const _0x4feb70=a60_0x2d31b2,_0x57cb5b=Date['now']();try{const _0x1e14ac=_0x3fdab8[_0x4feb70(0x215)],_0x40a54c=_0x1e14ac[_0x4feb70(0x209)];if(!_0x40a54c?.['webhookUrl']){console[_0x4feb70(0x28c)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x1e14ac['id']);return;}const _0x49f21a=_0x142b46===_0x4feb70(0x255)?_0x4feb70(0x247):'payment.failed';let _0x523be0=[];if(_0x40a54c[_0x4feb70(0x29d)])try{_0x523be0=Array[_0x4feb70(0x1c4)](_0x40a54c[_0x4feb70(0x29d)])?_0x40a54c[_0x4feb70(0x29d)]:JSON[_0x4feb70(0x1d2)](_0x40a54c[_0x4feb70(0x29d)]);}catch(_0x443e7e){console[_0x4feb70(0x1d3)](_0x4feb70(0x1d1),_0x443e7e),_0x523be0=[];}if(!_0x523be0[_0x4feb70(0x21c)](_0x49f21a)){console[_0x4feb70(0x28c)](_0x4feb70(0x234)+_0x49f21a+'\x20not\x20enabled\x20for\x20shop\x20'+_0x1e14ac['id']);return;}const _0x412a47={'event':_0x49f21a,'payment':{'id':_0x3fdab8['id'],'order_id':_0x3fdab8[_0x4feb70(0x2e6)],'gateway_order_id':_0x3fdab8[_0x4feb70(0x19d)],'gateway':_0x4feb70(0x272),'amount':_0x3fdab8[_0x4feb70(0x2ef)],'currency':_0x3fdab8[_0x4feb70(0x258)],'status':_0x142b46[_0x4feb70(0x1b7)](),'customer_email':_0x3fdab8[_0x4feb70(0x218)],'customer_name':_0x3fdab8[_0x4feb70(0x201)],'created_at':_0x3fdab8[_0x4feb70(0x22e)],'updated_at':new Date()}},_0x1e43c0=await fetch(_0x40a54c[_0x4feb70(0x1ea)],{'method':'POST','headers':{'Content-Type':_0x4feb70(0x1d7),'User-Agent':_0x4feb70(0x246)},'body':JSON[_0x4feb70(0x1c5)](_0x412a47)}),_0x55a771=Date[_0x4feb70(0x21f)]()-_0x57cb5b;loggerService_1[_0x4feb70(0x2cb)]['logShopWebhookSent'](_0x3fdab8['shopId'],_0x40a54c[_0x4feb70(0x1ea)],_0x49f21a,_0x1e43c0[_0x4feb70(0x2b0)],_0x55a771,_0x412a47),console[_0x4feb70(0x28c)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x40a54c[_0x4feb70(0x1ea)]+_0x4feb70(0x2fb)+_0x1e43c0['status']+'\x20('+_0x55a771+_0x4feb70(0x295));}catch(_0x1d896b){console[_0x4feb70(0x1d3)](_0x4feb70(0x2d8),_0x1d896b),loggerService_1['loggerService'][_0x4feb70(0x251)](_0x3fdab8[_0x4feb70(0x1cf)],_0x3fdab8[_0x4feb70(0x215)]?.[_0x4feb70(0x209)]?.[_0x4feb70(0x1ea)]||_0x4feb70(0x224),_0x4feb70(0x27e),_0x1d896b,{});}}[a60_0x2d31b2(0x2a4)](_0xea0d19){const _0x33a53c=a60_0x2d31b2,_0x1b496c=_0xea0d19[_0x33a53c(0x1f4)](/[\s-]/g,'');if(_0x1b496c[_0x33a53c(0x267)]<0x4)return _0x33a53c(0x1d0);return _0x33a53c(0x21a)+_0x1b496c[_0x33a53c(0x2c7)](-0x4);}async[a60_0x2d31b2(0x2ab)](_0xf201b2,_0x14ce4a='MASTERCARD'){const _0x516d02=a60_0x2d31b2;console['log']('üîÑ\x20Processing\x20MasterCard\x20webhook\x20data:',JSON[_0x516d02(0x1c5)](_0xf201b2,null,0x2));let _0x366e39=_0xf201b2,_0x57eb71=_0x14ce4a;_0xf201b2[_0x516d02(0x24b)]?(_0x57eb71=_0xf201b2[_0x516d02(0x24b)][_0x516d02(0x2f5)]()===_0x516d02(0x19c)?_0x516d02(0x19c):_0x516d02(0x1f9),console[_0x516d02(0x28c)](_0x516d02(0x1a2)+_0x57eb71)):console[_0x516d02(0x28c)]('üîç\x20Using\x20provided\x20card\x20type:\x20'+_0x57eb71);if(_0xf201b2[_0x516d02(0x27f)]&&_0xf201b2[_0x516d02(0x21e)]&&_0xf201b2[_0x516d02(0x1e1)]){console[_0x516d02(0x28c)](_0x516d02(0x1e9));try{const _0x58b287=await this['decryptResponsePhp'](_0xf201b2[_0x516d02(0x27f)],_0xf201b2[_0x516d02(0x21e)],_0x57eb71);_0x366e39=JSON[_0x516d02(0x1d2)](_0x58b287),console['log'](_0x516d02(0x227)),console[_0x516d02(0x28c)](_0x516d02(0x2e2),JSON[_0x516d02(0x1c5)](_0x366e39,null,0x2));}catch(_0xdfe112){console[_0x516d02(0x1d3)](_0x516d02(0x260),_0xdfe112),console['log'](_0x516d02(0x2a8)),_0x366e39=_0xf201b2;}}else console['log'](_0x516d02(0x266));let _0x2b15fc=_0x516d02(0x1df);if(_0x366e39[_0x516d02(0x2b0)]===0x64&&_0x366e39[_0x516d02(0x256)]===0x1)_0x2b15fc=_0x516d02(0x255);else{if(_0x366e39[_0x516d02(0x256)]===0x0||!this['isFinalStatus'](_0x366e39['status']))_0x2b15fc=_0x516d02(0x1df);else _0x366e39['final']===0x1||this[_0x516d02(0x1b3)](_0x366e39[_0x516d02(0x2b0)])?_0x2b15fc=_0x516d02(0x1de):_0x2b15fc=_0x516d02(0x1df);}let _0x30b68b='';if(_0x366e39[_0x516d02(0x2c8)])_0x30b68b=_0x366e39[_0x516d02(0x2c8)][_0x516d02(0x270)](),console[_0x516d02(0x28c)]('üîç\x20Using\x20'+_0x57eb71+_0x516d02(0x27b)+_0x30b68b);else _0x366e39[_0x516d02(0x23f)]?(_0x30b68b=_0x366e39[_0x516d02(0x23f)][_0x516d02(0x270)](),console['log'](_0x516d02(0x2ea)+_0x57eb71+_0x516d02(0x2ce)+_0x30b68b)):(_0x30b68b=_0x366e39[_0x516d02(0x2e6)]||_0x366e39[_0x516d02(0x2c1)]||_0x366e39['id']||'',console[_0x516d02(0x28c)](_0x516d02(0x1f7)+_0x30b68b));console['log'](_0x516d02(0x233)+_0x57eb71+_0x516d02(0x1a1)),console[_0x516d02(0x28c)](_0x516d02(0x2c3)+_0x30b68b+_0x516d02(0x274)+_0x366e39['order_id']+_0x516d02(0x228)+_0x366e39[_0x516d02(0x2e6)]+_0x516d02(0x2be)+_0x366e39['payment_id']+_0x516d02(0x2cd)+_0x366e39[_0x516d02(0x2c1)]+_0x516d02(0x2ed)+_0x366e39['id']+')'),console[_0x516d02(0x28c)](_0x516d02(0x2b5)+_0x2b15fc+_0x516d02(0x2ac)+_0x366e39[_0x516d02(0x2b0)]+_0x516d02(0x19e)+_0x366e39[_0x516d02(0x256)]+')'),console[_0x516d02(0x28c)](_0x516d02(0x1ec)+_0x366e39[_0x516d02(0x2ef)]),console[_0x516d02(0x28c)](_0x516d02(0x28f)+_0x366e39[_0x516d02(0x258)]);let _0x163134;_0x2b15fc===_0x516d02(0x1de)&&(_0x163134=this[_0x516d02(0x1cc)](_0x366e39[_0x516d02(0x2b0)],_0x366e39[_0x516d02(0x231)]),console['log']('‚ùå\x20Detailed\x20failure\x20description:\x20'+_0x163134));const _0x1c42ae={'paymentId':_0x30b68b,'status':_0x2b15fc,'amount':_0x366e39[_0x516d02(0x2ef)],'currency':_0x366e39[_0x516d02(0x258)],'cardBrand':_0x57eb71};return _0x163134&&(_0x1c42ae[_0x516d02(0x24f)]=_0x163134),_0x1c42ae;}[a60_0x2d31b2(0x241)](){const _0x275d96=a60_0x2d31b2;console[_0x275d96(0x28c)](_0x275d96(0x1b4));const _0x7c6ae2=this[_0x275d96(0x23a)]['size'];for(const [_0xb884bc]of this[_0x275d96(0x23a)]){this[_0x275d96(0x2af)](_0xb884bc);}console[_0x275d96(0x28c)]('üõë\x20Stopped\x20'+_0x7c6ae2+_0x275d96(0x24d));}}function a60_0x212f(_0x25aea2,_0x3adca2){_0x25aea2=_0x25aea2-0x190;const _0x4ca651=a60_0x4ca6();let _0x212f99=_0x4ca651[_0x25aea2];return _0x212f99;}exports[a60_0x2d31b2(0x2a6)]=VisaMasterCardService;