'use strict';const a51_0x4fc1a4=a51_0x443f;(function(_0x154702,_0x16d7b0){const _0x245d0f=a51_0x443f,_0x4d4e52=_0x154702();while(!![]){try{const _0x388269=parseInt(_0x245d0f(0x1b7))/0x1*(parseInt(_0x245d0f(0x148))/0x2)+-parseInt(_0x245d0f(0x176))/0x3+parseInt(_0x245d0f(0x1bd))/0x4*(parseInt(_0x245d0f(0x1f7))/0x5)+-parseInt(_0x245d0f(0x1b0))/0x6+parseInt(_0x245d0f(0x19a))/0x7+parseInt(_0x245d0f(0x11e))/0x8+parseInt(_0x245d0f(0x150))/0x9*(-parseInt(_0x245d0f(0x155))/0xa);if(_0x388269===_0x16d7b0)break;else _0x4d4e52['push'](_0x4d4e52['shift']());}catch(_0x14e19f){_0x4d4e52['push'](_0x4d4e52['shift']());}}}(a51_0x355c,0x80ba0));function a51_0x443f(_0x12913e,_0x4c0394){const _0x355c95=a51_0x355c();return a51_0x443f=function(_0x443f05,_0x166f28){_0x443f05=_0x443f05-0xf7;let _0x2090ab=_0x355c95[_0x443f05];return _0x2090ab;},a51_0x443f(_0x12913e,_0x4c0394);}var __createBinding=this&&this[a51_0x4fc1a4(0x13b)]||(Object[a51_0x4fc1a4(0x227)]?function(_0x342616,_0x456e1d,_0x22c1a3,_0x3eaca6){const _0x346f40=a51_0x4fc1a4;if(_0x3eaca6===undefined)_0x3eaca6=_0x22c1a3;var _0x20a8c8=Object['getOwnPropertyDescriptor'](_0x456e1d,_0x22c1a3);(!_0x20a8c8||(_0x346f40(0x18d)in _0x20a8c8?!_0x456e1d[_0x346f40(0x1cf)]:_0x20a8c8[_0x346f40(0x185)]||_0x20a8c8[_0x346f40(0x16c)]))&&(_0x20a8c8={'enumerable':!![],'get':function(){return _0x456e1d[_0x22c1a3];}}),Object[_0x346f40(0x209)](_0x342616,_0x3eaca6,_0x20a8c8);}:function(_0x41222e,_0x4a7053,_0x3572bf,_0x3f968f){if(_0x3f968f===undefined)_0x3f968f=_0x3572bf;_0x41222e[_0x3f968f]=_0x4a7053[_0x3572bf];}),__setModuleDefault=this&&this[a51_0x4fc1a4(0x131)]||(Object[a51_0x4fc1a4(0x227)]?function(_0x444e46,_0x6c84a8){const _0x53cf51=a51_0x4fc1a4;Object[_0x53cf51(0x209)](_0x444e46,_0x53cf51(0x174),{'enumerable':!![],'value':_0x6c84a8});}:function(_0x2f8f44,_0x4d8cbe){const _0x15c6e8=a51_0x4fc1a4;_0x2f8f44[_0x15c6e8(0x174)]=_0x4d8cbe;}),__importStar=this&&this[a51_0x4fc1a4(0x175)]||(function(){var _0x3a7ed7=function(_0x595543){const _0xb3123b=a51_0x443f;return _0x3a7ed7=Object[_0xb3123b(0x14d)]||function(_0x143d07){const _0x38fa4f=_0xb3123b;var _0x558715=[];for(var _0x212fa2 in _0x143d07)if(Object[_0x38fa4f(0x182)][_0x38fa4f(0x24b)]['call'](_0x143d07,_0x212fa2))_0x558715[_0x558715['length']]=_0x212fa2;return _0x558715;},_0x3a7ed7(_0x595543);};return function(_0x1e72d3){const _0x14ed95=a51_0x443f;if(_0x1e72d3&&_0x1e72d3['__esModule'])return _0x1e72d3;var _0x442153={};if(_0x1e72d3!=null){for(var _0x2c572b=_0x3a7ed7(_0x1e72d3),_0x54f544=0x0;_0x54f544<_0x2c572b[_0x14ed95(0x1d6)];_0x54f544++)if(_0x2c572b[_0x54f544]!==_0x14ed95(0x174))__createBinding(_0x442153,_0x1e72d3,_0x2c572b[_0x54f544]);}return __setModuleDefault(_0x442153,_0x1e72d3),_0x442153;};}()),__importDefault=this&&this[a51_0x4fc1a4(0x23f)]||function(_0x1a979d){const _0x23963f=a51_0x4fc1a4;return _0x1a979d&&_0x1a979d[_0x23963f(0x1cf)]?_0x1a979d:{'default':_0x1a979d};};function a51_0x355c(){const _0x9d4d2c=['logWhiteDomainError','replace','paidAt','number','PENDING','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','3DS\x20verification\x20required','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','📝\x20Signature\x20length:','\x20\x20Cleaned:\x20\x20\x22','3906546ouivBB','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','publicEncrypt','Number\x20of\x20attempts\x20exceeded','Payment\x20returned','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','HTTP\x20error!\x20status:\x20','\x20(from:\x20order_id=','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','isArray','getDetailedErrorMessage','✅\x20Payment\x20','\x20status\x20check\x20#','/status_decrypted','createdAt','Payment\x20confirmation\x20required','🔐\x20VISA\x20Public\x20key\x20path:','/charge_decrypt','logWhiteDomainRequest','1417236aFBzZN','\x20status\x20timers\x20for\x20payment\x20','visa_private.pem','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','sign','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format',',\x20orderId=','3QCervc','Recipient\x20data\x20required','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','payment','\x20for\x20payment\x20','/status_raw','10852WRWrvO','application/json','Webhook\x20event\x20','charge','💾\x20Payment\x20data\x20prepared','✅\x20VISA\x20key\x20files\x20validated\x20successfully','Return\x20URL:','POST','visaPrivateKeyPath','set','📊\x20Status\x20check\x20result:','from','masterCardApiUrl','updatePaymentStatus','\x20\x20\x20Currency:\x20','📝\x20Final\x20request\x20structure:','HTTP\x20','),\x20stopping\x20status\x20checks','__esModule','Error\x20details:','trim','\x20status\x20checks\x20for\x20payment\x20','delete','1111','card_type','length','end','Test\x20payment','paymentStatuses','error','findUnique','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','HTTP\x20Status:','webhookUrl','Expected\x20bitcoin\x20transfer\x20from\x20client','then','📊\x20Checking\x20','🛑\x20Stopped\x20','toLowerCase','sendShopWebhook','\x20result:','MASTERCARD','currency','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','errorMessage','slice','text','payment_id','3ds_url','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','resolve','includes','\x20status\x20updated\x20to\x20','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20',',\x20Desc:\x20','visa_public.pem','300kjRCmD','===\x20API\x20RESPONSE\x20===','message','isFinalStatus','Invalid\x20expiration\x20date','\x20payment:\x20','Card\x20Number:','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','payment.failed','log','\x20\x20Original:\x20\x22','publicKeyPath','readFileSync','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','📝\x20Encrypted\x20data\x20length:','3DS\x20URL:',',\x20paymentId=','constants','defineProperty','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','🔐\x20VISA\x20Private\x20key\x20length:\x20','size','forEach','Cancellation\x20is\x20not\x20possible','key','Status\x20','🔍\x20Using\x20','\x20payment_id\x20for\x20search:\x20','failed','💳\x20VISA/MasterCard\x20service\x20initialized','clearStatusTimers','path','Payment\x20confirmation\x20time\x20has\x20expired','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','Status\x20decryption\x20failed:\x20','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','LookUp\x20code\x20sent','privateDecrypt','apiUrl','),\x20defaulting\x20to\x20MasterCard','🔐\x20MasterCard\x20Private\x20key\x20path:','private.pem','createDecipheriv','RSA_PKCS1_PADDING','\x20characters','\x20payment\x20status:\x20','create','final','Order\x20ID:','❌\x20Status\x20check\x20#','masterCardMerchantPointId','../telegramBotService','Response\x20Time:','/charge_raw','info','\x20|\x20Response:\x20','-----BEGIN','/status_decrypt','encryptRSA','\x20MasterCard\x20status\x20check\x20timers','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','Result\x20URL:','orderId','Failed\x20payment','Unknown\x20error','FAILED','date_success','order_id','LookUp\x20not\x20confirmed','checkPaymentStatus','__importDefault','🔐\x203DS\x20verification\x20required','settings','🔐\x20VISA\x20Private\x20key\x20path:','aes-256-ctr','Awaiting\x20confirmation\x20in\x20the\x20application','\x20\x20\x20Amount:\x20','scheduleStatusChecks','Failed\x20to\x20decrypt\x20response','last_name','⏰\x20Will\x20check\x20status\x20','processWebhook','hasOwnProperty','🔍\x20Using\x20provided\x20card\x20type:\x20','Unsuccessful\x20payment','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','****','visaPublicKeyPath','validateKeyFiles','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','-----END','/charge','/charge_decrypted','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','VISA','getCardTypeAndApi','...','LookUp\x20number\x20of\x20attempts\x20exceeded','description','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','toString','expire_month','logWhiteDomainResponse','LookUp\x20code\x20verified','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','shop','stopAllStatusChecks','cardType','📊\x20','****\x20****\x20****\x20','statusCheckTimers','\x20status\x20check\x20error:','🔐\x20AES\x20IV\x20length:','Decryption\x20failed:\x20','webhookEvents','update','https://api.paydmeth.com/api','Response\x20Body:','❌\x20Detailed\x20failure\x20description:\x20','✅\x20Status\x20response\x20decrypted\x20successfully','cvv','📝\x20Decrypted\x20webhook\x20data:','cwd','../loggerService','📊\x20Status\x20check\x20#','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','4000000000000000','📝\x20Encrypted\x20key\x20length:','createCipheriv','8102704GnVxhB','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','https://api2.trapay.uk/decrypt.php','\x20API:\x20','MasterCard\x20webhook\x20sent\x20to\x20','expire_year','randomBytes','The\x20card\x20is\x20lost\x20or\x20stolen','merchantPointId','encryptAES','Method\x20not\x20allowed','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','customerName','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','🔐\x20VISA\x20API\x20URL:','Captcha\x20confirmation\x20awaited','🎯\x20Using\x20','now','maskCardNumber','__setModuleDefault','\x20\x20\x20-\x20key\x20length:','\x20(from:\x20status=','Payment\x20System/1.0\x20(MasterCard)','\x22\x20|\x20\x22','stringify','base64','loggerService','\x20\x20\x20Payment\x20ID:\x20','✅\x20Payment\x20successful','__createBinding','===\x20PARSED\x20API\x20RESPONSE\x20===','💾\x20Saving\x20failure\x20message:\x20','first_name','signRSA','PAID','join','gatewayOrderId','❌\x20Data\x20being\x20signed:','keys','VisaMasterCardService','🔐\x20AES\x20key\x20and\x20IV\x20generated','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','67688GiJKdD','parse','🔐\x20MasterCard\x20API\x20URL:','decryptAES','psp_public.pem','getOwnPropertyNames','The\x20card\x20does\x20not\x20exist',',\x20id=','4356819bWePYR','utf8','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available',',\x20Final:\x20','privateKeyPath','10IzdDmx','\x20\x20\x20-\x20merchant_point_id:','visaApiUrl','Payment\x20System/1.0','sendPaymentNotifications','Another\x20unknown\x20error','decryptResponsePhp',':\x20Unknown\x20status\x20code','Final:','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','visa/mastercard','payment.success','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','system','warn','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','toUpperCase','amount','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20',',\x20final=','🔐\x20VISA\x20Public\x20key\x20length:\x20','configurable','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','Failed\x20to\x20check\x20',',\x20body:\x20','📝\x20Data\x20to\x20sign\x20length:','\x20failed\x20for\x20payment\x20','Client\x20OTP\x20confirmation\x20required','\x20\x20\x20-\x20info\x20length:','default','__importStar','1763001vhTggC','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','desc','🔐\x20RSA\x20signing\x20successful','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','crypto','decryptResponse','🔐\x20AES\x20key\x20length:','No\x20Error\x20executing\x20request','Operation\x20completed\x20successfully','paid','prototype','Sender\x27s\x20CVV\x20card\x20is\x20required','generateAESKey','writable','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','status','❌\x20RSA\x20signing\x20failed:','❌\x20RSA\x20encryption\x20failed:','Status:','paymentId','get','\x20is\x20final\x20(',',\x20payment_id='];a51_0x355c=function(){return _0x9d4d2c;};return a51_0x355c();}Object['defineProperty'](exports,a51_0x4fc1a4(0x1cf),{'value':!![]}),exports[a51_0x4fc1a4(0x145)]=void 0x0;const crypto_1=__importDefault(require(a51_0x4fc1a4(0x17c))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a51_0x4fc1a4(0x217))),loggerService_1=require(a51_0x4fc1a4(0x118));class VisaMasterCardService{constructor(){const _0x7b2b26=a51_0x4fc1a4;this['statusCheckTimers']=new Map(),this[_0x7b2b26(0x1d9)]={0x0:{'final':![],'description':'No\x20New\x20payment'},0x1:{'final':![],'description':_0x7b2b26(0x17f)},0x2:{'final':!![],'description':'Request\x20data\x20error'},0x3:{'final':!![],'description':_0x7b2b26(0x15a)},0x4:{'final':!![],'description':_0x7b2b26(0x24d)},0x5:{'final':!![],'description':_0x7b2b26(0x19e)},0x6:{'final':!![],'description':'Payment\x20returned'},0x7:{'final':!![],'description':_0x7b2b26(0x1d8)},0x8:{'final':![],'description':_0x7b2b26(0x172)},0x9:{'final':![],'description':_0x7b2b26(0x196)},0xa:{'final':![],'description':_0x7b2b26(0x183)},0xb:{'final':![],'description':'Sender\x20information\x20required'},0xc:{'final':![],'description':_0x7b2b26(0x1b8)},0xd:{'final':![],'description':'Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number'},0xe:{'final':![],'description':'Awaiting\x20confirmation\x20by\x20ivr\x20call'},0xf:{'final':![],'description':'PIN\x20code\x20confirmation\x20awaited'},0x10:{'final':![],'description':_0x7b2b26(0x12d)},0x11:{'final':![],'description':_0x7b2b26(0x1a5)},0x12:{'final':![],'description':_0x7b2b26(0x244)},0x13:{'final':![],'description':'Payment\x20is\x20being\x20processed'},0x14:{'final':![],'description':_0x7b2b26(0x20b)},0x15:{'final':![],'description':_0x7b2b26(0x1df)},0x16:{'final':![],'description':'Payment\x20pending\x20verification'},0x18:{'final':![],'description':'The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':'Cash\x20payment\x20is\x20expected\x20at\x20TCO'},0x1b:{'final':![],'description':_0x7b2b26(0x252)},0x1c:{'final':![],'description':_0x7b2b26(0x17b)},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':_0x7b2b26(0x19d)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':'Sender\x27s\x20card\x20details\x20are\x20required'},0x24:{'final':!![],'description':_0x7b2b26(0x218)},0x25:{'final':!![],'description':'Payment\x20prohibited'},0x26:{'final':!![],'description':'The\x20payment\x20status\x20must\x20be\x20clarified\x20manually'},0x27:{'final':!![],'description':'Insufficient\x20funds\x20on\x20the\x20card'},0x28:{'final':!![],'description':_0x7b2b26(0x14e)},0x29:{'final':!![],'description':_0x7b2b26(0x125)},0x2a:{'final':!![],'description':_0x7b2b26(0x1fb)},0x2b:{'final':!![],'description':'Transaction\x20limit\x20exceeded'},0x2c:{'final':!![],'description':_0x7b2b26(0x24e)},0x2d:{'final':!![],'description':_0x7b2b26(0x238)},0x2e:{'final':!![],'description':_0x7b2b26(0x24d)},0x2f:{'final':!![],'description':_0x7b2b26(0x24d)},0x30:{'final':!![],'description':_0x7b2b26(0x1e9)},0x31:{'final':![],'description':_0x7b2b26(0x1ac)},0x32:{'final':!![],'description':_0x7b2b26(0x128)},0x33:{'final':!![],'description':_0x7b2b26(0x238)},0x34:{'final':!![],'description':_0x7b2b26(0x238)},0x35:{'final':!![],'description':'Failed\x20payment'},0x36:{'final':!![],'description':_0x7b2b26(0x238)},0x37:{'final':!![],'description':_0x7b2b26(0x238)},0x38:{'final':!![],'description':_0x7b2b26(0x20f)},0x39:{'final':![],'description':_0x7b2b26(0x19c)},0x3a:{'final':![],'description':_0x7b2b26(0x21d)},0x3b:{'final':!![],'description':_0x7b2b26(0x104)},0x3c:{'final':!![],'description':_0x7b2b26(0x1a0)},0x3d:{'final':!![],'description':_0x7b2b26(0x186)},0x3e:{'final':!![],'description':_0x7b2b26(0x204)},0x3f:{'final':!![],'description':_0x7b2b26(0x1a1)},0x40:{'final':![],'description':_0x7b2b26(0x23d)},0x41:{'final':!![],'description':_0x7b2b26(0xfe)},0x42:{'final':![],'description':'Payment\x20cancellation\x20is\x20being\x20processed'},0x43:{'final':!![],'description':_0x7b2b26(0x161)},0x44:{'final':![],'description':'3DS\x20verification\x20required'},0x45:{'final':!![],'description':'Failed\x20payment'},0x46:{'final':!![],'description':_0x7b2b26(0x238)},0x47:{'final':!![],'description':_0x7b2b26(0x1e8)},0x64:{'final':!![],'description':_0x7b2b26(0x180)}},this[_0x7b2b26(0x1c9)]='https://api.paydmeth.com/api',this[_0x7b2b26(0x22b)]=0x6e4,this['privateKeyPath']=path_1[_0x7b2b26(0x174)][_0x7b2b26(0x141)](process[_0x7b2b26(0x117)](),_0x7b2b26(0x144),_0x7b2b26(0x222)),this[_0x7b2b26(0x202)]=path_1[_0x7b2b26(0x174)][_0x7b2b26(0x141)](process[_0x7b2b26(0x117)](),_0x7b2b26(0x144),_0x7b2b26(0x14c)),this[_0x7b2b26(0x157)]=_0x7b2b26(0x111),this['visaMerchantPointId']=0x6b7,this[_0x7b2b26(0x1c5)]=path_1[_0x7b2b26(0x174)][_0x7b2b26(0x141)](process[_0x7b2b26(0x117)](),_0x7b2b26(0x144),_0x7b2b26(0x1b2)),this[_0x7b2b26(0x250)]=path_1[_0x7b2b26(0x174)]['join'](process[_0x7b2b26(0x117)](),_0x7b2b26(0x144),_0x7b2b26(0x1f6)),console[_0x7b2b26(0x200)](_0x7b2b26(0x215)),console['log'](_0x7b2b26(0x14a),this[_0x7b2b26(0x1c9)]),console[_0x7b2b26(0x200)](_0x7b2b26(0x12c),this['visaApiUrl']),console[_0x7b2b26(0x200)](_0x7b2b26(0x221),this[_0x7b2b26(0x154)]),console[_0x7b2b26(0x200)]('🔐\x20MasterCard\x20Public\x20key\x20path:',this['publicKeyPath']),console[_0x7b2b26(0x200)](_0x7b2b26(0x242),this[_0x7b2b26(0x1c5)]),console[_0x7b2b26(0x200)](_0x7b2b26(0x1ad),this['visaPublicKeyPath']),this[_0x7b2b26(0x251)]();}[a51_0x4fc1a4(0x1a7)](_0x1dd32d,_0x2f86a6){const _0x3a79a0=a51_0x4fc1a4,_0x1ab5b9=this['paymentStatuses'][_0x1dd32d];let _0x4b1508='';_0x1ab5b9?_0x4b1508=_0x3a79a0(0x211)+_0x1dd32d+':\x20'+_0x1ab5b9[_0x3a79a0(0xff)]:_0x4b1508=_0x3a79a0(0x211)+_0x1dd32d+_0x3a79a0(0x15c);if(_0x2f86a6&&_0x2f86a6[_0x3a79a0(0x1d1)]()){const _0x55af3c=_0x2f86a6[_0x3a79a0(0x1d1)]();(!_0x1ab5b9||_0x55af3c['toLowerCase']()!==_0x1ab5b9[_0x3a79a0(0xff)][_0x3a79a0(0x1e3)]())&&(_0x4b1508+=_0x3a79a0(0x230)+_0x55af3c);}return _0x4b1508;}[a51_0x4fc1a4(0x1fa)](_0x1f6fe3){const _0x2ea363=a51_0x4fc1a4,_0x2c80a5=this['paymentStatuses'][_0x1f6fe3];return _0x2c80a5?_0x2c80a5[_0x2ea363(0x228)]:!![];}[a51_0x4fc1a4(0xfc)](_0x196694){const _0x266a90=a51_0x4fc1a4,_0x20689a=_0x196694['charAt'](0x0);if(_0x20689a==='4')return console['log']('💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)'),{'cardType':_0x266a90(0xfb),'apiUrl':this[_0x266a90(0x157)],'privateKeyPath':this[_0x266a90(0x1c5)],'publicKeyPath':this[_0x266a90(0x250)],'merchantPointId':this['visaMerchantPointId']};else return _0x20689a==='5'?(console['log'](_0x266a90(0x1fe)),{'cardType':_0x266a90(0x1e6),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x266a90(0x202)],'merchantPointId':this[_0x266a90(0x22b)]}):(console[_0x266a90(0x200)]('💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20'+_0x20689a+_0x266a90(0x220)),{'cardType':_0x266a90(0x1e6),'apiUrl':this[_0x266a90(0x1c9)],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x266a90(0x202)],'merchantPointId':this[_0x266a90(0x22b)]});}[a51_0x4fc1a4(0x251)](){const _0x275404=a51_0x4fc1a4;try{if(!fs_1[_0x275404(0x174)]['existsSync'](this[_0x275404(0x154)]))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this[_0x275404(0x154)]);if(!fs_1[_0x275404(0x174)]['existsSync'](this['publicKeyPath']))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this[_0x275404(0x202)]);const _0x7d6a82=fs_1['default'][_0x275404(0x203)](this['privateKeyPath'],'utf8')[_0x275404(0x1d1)](),_0x501bdb=fs_1['default'][_0x275404(0x203)](this[_0x275404(0x202)],_0x275404(0x151))[_0x275404(0x1d1)]();if(!_0x7d6a82['includes'](_0x275404(0x231))||!_0x7d6a82[_0x275404(0x1f1)](_0x275404(0xf7)))throw new Error(_0x275404(0x1b3));if(!_0x501bdb[_0x275404(0x1f1)]('-----BEGIN')||!_0x501bdb[_0x275404(0x1f1)](_0x275404(0xf7)))throw new Error(_0x275404(0x100));console[_0x275404(0x200)](_0x275404(0x1f3)),console[_0x275404(0x200)](_0x275404(0x166)+_0x7d6a82['length']+'\x20characters'),console['log']('🔐\x20MasterCard\x20Public\x20key\x20length:\x20'+_0x501bdb[_0x275404(0x1d6)]+'\x20characters');if(fs_1[_0x275404(0x174)]['existsSync'](this[_0x275404(0x1c5)])&&fs_1[_0x275404(0x174)]['existsSync'](this[_0x275404(0x250)])){const _0x335b67=fs_1[_0x275404(0x174)]['readFileSync'](this[_0x275404(0x1c5)],_0x275404(0x151))[_0x275404(0x1d1)](),_0x2ac6fe=fs_1[_0x275404(0x174)][_0x275404(0x203)](this[_0x275404(0x250)],_0x275404(0x151))[_0x275404(0x1d1)]();(!_0x335b67['includes'](_0x275404(0x231))||!_0x335b67['includes'](_0x275404(0xf7)))&&console[_0x275404(0x165)](_0x275404(0x1b5)),(!_0x2ac6fe[_0x275404(0x1f1)](_0x275404(0x231))||!_0x2ac6fe['includes'](_0x275404(0xf7)))&&console['warn'](_0x275404(0x147)),console[_0x275404(0x200)](_0x275404(0x1c2)),console[_0x275404(0x200)](_0x275404(0x20c)+_0x335b67[_0x275404(0x1d6)]+_0x275404(0x225)),console[_0x275404(0x200)](_0x275404(0x16b)+_0x2ac6fe[_0x275404(0x1d6)]+'\x20characters');}else console['warn'](_0x275404(0x152)),console[_0x275404(0x165)](_0x275404(0x21c)+this[_0x275404(0x1c5)]),console[_0x275404(0x165)](_0x275404(0x162)+this[_0x275404(0x250)]);}catch(_0xf53d48){console['error'](_0x275404(0x19b),_0xf53d48);throw _0xf53d48;}}['generateAESKey'](){const _0x58527f=a51_0x4fc1a4,_0x56852e=crypto_1[_0x58527f(0x174)]['randomBytes'](0x20),_0x5787ca=crypto_1[_0x58527f(0x174)][_0x58527f(0x124)](0x10);return{'key':_0x56852e,'iv':_0x5787ca};}[a51_0x4fc1a4(0x127)](_0x10305e,_0xfc558b,_0x5dba7a){const _0x54ba5e=a51_0x4fc1a4,_0x5c722c=crypto_1[_0x54ba5e(0x174)][_0x54ba5e(0x11d)](_0x54ba5e(0x243),_0xfc558b,_0x5dba7a);let _0x12d908=_0x5c722c['update'](_0x10305e,_0x54ba5e(0x151),_0x54ba5e(0x137));return _0x12d908+=_0x5c722c[_0x54ba5e(0x228)](_0x54ba5e(0x137)),_0x12d908;}[a51_0x4fc1a4(0x233)](_0x43a54a,_0x2937a0,_0xae810d){const _0x374db4=a51_0x4fc1a4;try{const _0x3bd48a=fs_1[_0x374db4(0x174)]['readFileSync'](_0xae810d,_0x374db4(0x151))[_0x374db4(0x1d1)](),_0x44bfd5={'iv':_0x2937a0[_0x374db4(0x101)](_0x374db4(0x137)),'key':_0x43a54a['toString'](_0x374db4(0x137))},_0x339dce=JSON[_0x374db4(0x136)](_0x44bfd5);console[_0x374db4(0x200)](_0x374db4(0x11a),_0x339dce['length']);const _0x5c4769=crypto_1[_0x374db4(0x174)][_0x374db4(0x19f)]({'key':_0x3bd48a,'padding':crypto_1[_0x374db4(0x174)][_0x374db4(0x208)][_0x374db4(0x224)]},Buffer['from'](_0x339dce));return console['log'](_0x374db4(0xfa),_0x5c4769[_0x374db4(0x1d6)]),_0x5c4769[_0x374db4(0x101)](_0x374db4(0x137));}catch(_0x2376f7){console[_0x374db4(0x1da)](_0x374db4(0x18a),_0x2376f7);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a51_0x4fc1a4(0x13f)](_0x3624e8,_0x5bf5e1){const _0x57d2e9=a51_0x4fc1a4;try{const _0x4f0bf2=fs_1[_0x57d2e9(0x174)][_0x57d2e9(0x203)](_0x5bf5e1,_0x57d2e9(0x151))[_0x57d2e9(0x1d1)](),_0x3b933d=crypto_1['default']['createSign']('SHA256');_0x3b933d[_0x57d2e9(0x110)](_0x3624e8),_0x3b933d[_0x57d2e9(0x1d7)]();const _0x55161c=_0x3b933d[_0x57d2e9(0x1b4)](_0x4f0bf2,_0x57d2e9(0x137));return console[_0x57d2e9(0x200)](_0x57d2e9(0x17a)),console[_0x57d2e9(0x200)](_0x57d2e9(0x170),_0x3624e8['length']),console[_0x57d2e9(0x200)](_0x57d2e9(0x198),_0x55161c[_0x57d2e9(0x1d6)]),_0x55161c;}catch(_0x234224){console[_0x57d2e9(0x1da)](_0x57d2e9(0x189),_0x234224),console[_0x57d2e9(0x1da)](_0x57d2e9(0x143),_0x3624e8['substring'](0x0,0xc8)+_0x57d2e9(0xfd));throw new Error(_0x57d2e9(0x1b9));}}[a51_0x4fc1a4(0x14b)](_0x4925c9,_0x17a6dc,_0x53b431){const _0x4810ab=a51_0x4fc1a4,_0x2a96a7=crypto_1[_0x4810ab(0x174)][_0x4810ab(0x223)](_0x4810ab(0x243),_0x17a6dc,_0x53b431);let _0x5d9c9c=_0x2a96a7['update'](_0x4925c9,_0x4810ab(0x137),_0x4810ab(0x151));return _0x5d9c9c+=_0x2a96a7[_0x4810ab(0x228)](_0x4810ab(0x151)),_0x5d9c9c;}async['decryptResponsePhp'](_0x46a3ce,_0x56d741,_0x49ed17=a51_0x4fc1a4(0x1e6)){const _0x32cd6a=a51_0x4fc1a4;try{const _0x3fcfd4=await fetch(_0x32cd6a(0x120),{'method':_0x32cd6a(0x1c4),'headers':{'Content-Type':'application/json'},'body':JSON[_0x32cd6a(0x136)]({'info':_0x46a3ce,'key':_0x56d741,'card_type':_0x49ed17[_0x32cd6a(0x1e3)]()})});if(!_0x3fcfd4['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x3fcfd4[_0x32cd6a(0x1ec)]();}catch(_0x509ac9){console[_0x32cd6a(0x1da)]('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x509ac9);throw new Error(_0x32cd6a(0x177));}}[a51_0x4fc1a4(0x17d)](_0xee8c6,_0x29ba4d){const _0x5cc685=a51_0x4fc1a4;try{const _0x25c4da=fs_1[_0x5cc685(0x174)][_0x5cc685(0x203)](this[_0x5cc685(0x154)],_0x5cc685(0x151))[_0x5cc685(0x1d1)](),_0x47b420=crypto_1['default'][_0x5cc685(0x21e)](_0x25c4da,Buffer['from'](_0x29ba4d,_0x5cc685(0x137))),_0x32c981=JSON['parse'](_0x47b420[_0x5cc685(0x101)]()),_0x2e5154=Buffer[_0x5cc685(0x1c8)](_0x32c981['key'],_0x5cc685(0x137)),_0x590346=Buffer[_0x5cc685(0x1c8)](_0x32c981['iv'],'base64');return this['decryptAES'](_0xee8c6,_0x2e5154,_0x590346);}catch(_0x5430a6){throw new Error(_0x5cc685(0x247));}}async['processCardPayment'](_0x36db3c){const _0x302cbb=a51_0x4fc1a4,{paymentId:_0x3cb513,orderId:_0x805041,amount:_0x32f7c5,currency:_0x20b50a,cardData:_0x3611ec,resultUrl:_0x42d20e,returnUrl:_0x4c83f8,cardHolder:_0x20fa19,browser:_0x378dd3}=_0x36db3c;console[_0x302cbb(0x200)](_0x302cbb(0x163)),console['log']('Payment\x20ID:',_0x3cb513),console[_0x302cbb(0x200)](_0x302cbb(0x229),_0x805041),console[_0x302cbb(0x200)]('Amount:',_0x32f7c5,_0x20b50a),console[_0x302cbb(0x200)](_0x302cbb(0x1fd),this[_0x302cbb(0x130)](_0x3611ec[_0x302cbb(0x193)])),console[_0x302cbb(0x200)]('Card\x20Holder:',_0x20fa19['first_name']+'\x20'+_0x20fa19[_0x302cbb(0x248)]),console[_0x302cbb(0x200)](_0x302cbb(0x1c3),_0x4c83f8),console[_0x302cbb(0x200)](_0x302cbb(0x236),_0x42d20e);const _0x1644b7=this[_0x302cbb(0xfc)](_0x3611ec['number']);console[_0x302cbb(0x200)](_0x302cbb(0x12e)+_0x1644b7['cardType']+_0x302cbb(0x121)+_0x1644b7['apiUrl']),console['log']('🔐\x20Using\x20keys:\x20'+_0x1644b7[_0x302cbb(0x154)]+',\x20'+_0x1644b7[_0x302cbb(0x202)]);const _0x113d76={..._0x20fa19,'first_name':_0x20fa19[_0x302cbb(0x13e)]?.[_0x302cbb(0x191)](/[\t\n\r\f\v]/g,'\x20')[_0x302cbb(0x1d1)]()||'','last_name':_0x20fa19['last_name']?.[_0x302cbb(0x191)](/[\t\n\r\f\v]/g,'\x20')[_0x302cbb(0x1d1)]()||''};console['log']('🧹\x20Card\x20holder\x20names\x20cleaned:'),console[_0x302cbb(0x200)](_0x302cbb(0x201)+_0x20fa19[_0x302cbb(0x13e)]+_0x302cbb(0x135)+_0x20fa19['last_name']+'\x22'),console[_0x302cbb(0x200)](_0x302cbb(0x199)+_0x113d76[_0x302cbb(0x13e)]+'\x22\x20|\x20\x22'+_0x113d76[_0x302cbb(0x248)]+'\x22');const _0x38780a={'amount':_0x32f7c5,'currency':_0x20b50a[_0x302cbb(0x167)](),'order_id':_0x805041,'result_url':_0x42d20e,'return_url':_0x4c83f8,'country':'','card':{'number':_0x3611ec['number'],'expire_month':_0x3611ec[_0x302cbb(0x102)],'expire_year':_0x3611ec[_0x302cbb(0x123)],'cvv':_0x3611ec[_0x302cbb(0x115)]},'card_holder':_0x113d76,'browser':_0x378dd3},_0x15a675=JSON[_0x302cbb(0x136)](_0x38780a);console['log'](_0x302cbb(0x1c1)),console[_0x302cbb(0x200)]('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console[_0x302cbb(0x200)](_0x15a675),console[_0x302cbb(0x200)]('📝\x20Data\x20length:',_0x15a675[_0x302cbb(0x1d6)]);try{const {key:_0x560e91,iv:_0xf2c1f}=this[_0x302cbb(0x184)]();console[_0x302cbb(0x200)](_0x302cbb(0x146)),console[_0x302cbb(0x200)](_0x302cbb(0x17e),_0x560e91[_0x302cbb(0x1d6)]),console[_0x302cbb(0x200)](_0x302cbb(0x10d),_0xf2c1f[_0x302cbb(0x1d6)]);const _0x9f0873=this[_0x302cbb(0x127)](_0x15a675,_0x560e91,_0xf2c1f);console['log']('🔐\x20Data\x20encrypted\x20with\x20AES'),console[_0x302cbb(0x200)](_0x302cbb(0x205),_0x9f0873[_0x302cbb(0x1d6)]);const _0x342ffb=this[_0x302cbb(0x233)](_0x560e91,_0xf2c1f,_0x1644b7[_0x302cbb(0x202)]);console[_0x302cbb(0x200)](_0x302cbb(0x16d)),console['log'](_0x302cbb(0x11c),_0x342ffb['length']);const _0x32da50=this['signRSA'](_0x15a675,_0x1644b7[_0x302cbb(0x154)]);console['log']('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x302cbb(0x200)]('📝\x20Signature\x20length:',_0x32da50[_0x302cbb(0x1d6)]);const _0x189a4f={'merchant_point_id':_0x1644b7[_0x302cbb(0x126)],'method':_0x302cbb(0x1c0),'info':_0x9f0873,'key':_0x342ffb,'sign':_0x32da50,'lang':'en'};console[_0x302cbb(0x200)]('📤\x20Sending\x20request\x20to\x20API...'),console[_0x302cbb(0x200)](_0x302cbb(0x1cc)),console[_0x302cbb(0x200)](_0x302cbb(0x156),_0x1644b7['merchantPointId']),console[_0x302cbb(0x200)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x302cbb(0x200)](_0x302cbb(0x173),_0x9f0873['length']),console[_0x302cbb(0x200)](_0x302cbb(0x132),_0x342ffb['length']),console[_0x302cbb(0x200)]('\x20\x20\x20-\x20sign\x20length:',_0x32da50[_0x302cbb(0x1d6)]),console[_0x302cbb(0x200)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x302cbb(0x138)][_0x302cbb(0x1af)](_0x1644b7[_0x302cbb(0x108)][_0x302cbb(0x1e3)](),'/charge',_0x302cbb(0x1c4),{'merchant_point_id':_0x1644b7[_0x302cbb(0x126)],'method':_0x302cbb(0x1c0),'lang':'en'});const _0x979dc0=Date[_0x302cbb(0x12f)](),_0x15d782=await fetch(_0x1644b7[_0x302cbb(0x21f)],{'method':_0x302cbb(0x1c4),'headers':{'Content-Type':_0x302cbb(0x1be),'Accept':_0x302cbb(0x1be),'User-Agent':_0x302cbb(0x158)},'body':JSON[_0x302cbb(0x136)](_0x189a4f)}),_0x2f6773=Date['now']()-_0x979dc0;console[_0x302cbb(0x200)](_0x302cbb(0x1f8)),console[_0x302cbb(0x200)](_0x302cbb(0x18b),_0x15d782['status']),console[_0x302cbb(0x200)](_0x302cbb(0x22d),_0x2f6773+'ms');if(!_0x15d782['ok']){const _0x4511d8=await _0x15d782[_0x302cbb(0x1ec)]();console[_0x302cbb(0x1da)](_0x302cbb(0x1dd),_0x15d782[_0x302cbb(0x188)]),console[_0x302cbb(0x1da)](_0x302cbb(0x112),_0x4511d8),loggerService_1[_0x302cbb(0x138)][_0x302cbb(0x103)](_0x1644b7[_0x302cbb(0x108)]['toLowerCase'](),_0x302cbb(0x22e),_0x15d782[_0x302cbb(0x188)],_0x4511d8,_0x2f6773),loggerService_1[_0x302cbb(0x138)][_0x302cbb(0x190)](_0x1644b7['cardType'][_0x302cbb(0x1e3)](),_0x302cbb(0xf8),_0x302cbb(0x1cd)+_0x15d782[_0x302cbb(0x188)]+':\x20'+_0x4511d8);throw new Error(_0x302cbb(0x1a3)+_0x15d782[_0x302cbb(0x188)]+_0x302cbb(0x16f)+_0x4511d8);}const _0x44cd6d=await _0x15d782['json']();loggerService_1[_0x302cbb(0x138)][_0x302cbb(0x103)](_0x1644b7[_0x302cbb(0x108)][_0x302cbb(0x1e3)](),_0x302cbb(0x22e),_0x15d782[_0x302cbb(0x188)],_0x44cd6d,_0x2f6773),console[_0x302cbb(0x200)](_0x302cbb(0x13c));let _0xd0b3d9=_0x44cd6d;if(_0x44cd6d[_0x302cbb(0x22f)]&&_0x44cd6d['key']&&_0x44cd6d[_0x302cbb(0x1b4)]){console['log'](_0x302cbb(0x235));try{const _0x4fd4e1=await this[_0x302cbb(0x15b)](_0x44cd6d[_0x302cbb(0x22f)],_0x44cd6d[_0x302cbb(0x210)],_0x1644b7[_0x302cbb(0x108)]);_0xd0b3d9=JSON['parse'](_0x4fd4e1),console[_0x302cbb(0x200)](_0x302cbb(0x1ef)),loggerService_1[_0x302cbb(0x138)]['logWhiteDomainResponse'](_0x1644b7[_0x302cbb(0x108)][_0x302cbb(0x1e3)](),'/charge_decrypted',_0x15d782[_0x302cbb(0x188)],_0xd0b3d9,_0x2f6773),console[_0x302cbb(0x200)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x56c876){console[_0x302cbb(0x1da)](_0x302cbb(0x197),_0x56c876),loggerService_1[_0x302cbb(0x138)][_0x302cbb(0x190)](_0x1644b7[_0x302cbb(0x108)][_0x302cbb(0x1e3)](),_0x302cbb(0x1ae),_0x302cbb(0x10e)+_0x56c876),_0xd0b3d9=_0x44cd6d;}}else loggerService_1[_0x302cbb(0x138)][_0x302cbb(0x103)](_0x1644b7['cardType'][_0x302cbb(0x1e3)](),_0x302cbb(0xf9),_0x15d782[_0x302cbb(0x188)],_0xd0b3d9,_0x2f6773),console[_0x302cbb(0x200)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x302cbb(0x200)](_0x302cbb(0x18b),_0xd0b3d9[_0x302cbb(0x188)]),console[_0x302cbb(0x200)](_0x302cbb(0x15d),_0xd0b3d9[_0x302cbb(0x228)]),console[_0x302cbb(0x200)]('Payment\x20ID:',_0xd0b3d9[_0x302cbb(0x1ed)]),console[_0x302cbb(0x200)](_0x302cbb(0x206),_0xd0b3d9[_0x302cbb(0x1ee)]||'none');if(_0xd0b3d9['status']===0x64&&_0xd0b3d9['final']===0x1)return console[_0x302cbb(0x200)](_0x302cbb(0x13a)),{'gateway_payment_id':_0xd0b3d9[_0x302cbb(0x1ed)]?.[_0x302cbb(0x101)](),'payment_url':_0x4c83f8,'requires_3ds':![],'status':_0x302cbb(0x140),'final':!![]};if(_0xd0b3d9['3ds_url'])return console['log'](_0x302cbb(0x240)),this[_0x302cbb(0x246)](_0x3cb513,_0x805041,_0xd0b3d9[_0x302cbb(0x1ed)]?.[_0x302cbb(0x101)]()||_0x805041,_0x1644b7[_0x302cbb(0x108)]),{'gateway_payment_id':_0xd0b3d9[_0x302cbb(0x1ed)]?.[_0x302cbb(0x101)](),'payment_url':_0xd0b3d9[_0x302cbb(0x1ee)],'requires_3ds':!![],'threeds_url':_0xd0b3d9[_0x302cbb(0x1ee)],'status':_0x302cbb(0x194),'final':![]};let _0x197acd=this[_0x302cbb(0x1a7)](_0xd0b3d9[_0x302cbb(0x188)],_0xd0b3d9[_0x302cbb(0x179)]||_0xd0b3d9[_0x302cbb(0x1f9)]),_0x1cbff0=_0xd0b3d9[_0x302cbb(0x188)],_0xd63d60=this[_0x302cbb(0x1fa)](_0xd0b3d9[_0x302cbb(0x188)]);return console[_0x302cbb(0x200)](_0x302cbb(0x219)+_0x1cbff0+_0x302cbb(0x153)+_0xd63d60+_0x302cbb(0x1f5)+_0x197acd),{'gateway_payment_id':_0xd0b3d9[_0x302cbb(0x1ed)]?.[_0x302cbb(0x101)](),'payment_url':_0x4c83f8,'requires_3ds':![],'status':_0x302cbb(0x23a),'final':!![],'errorMessage':_0x197acd};}catch(_0x3928d9){console[_0x302cbb(0x1da)]('===\x20PAYMENT\x20SERVICE\x20ERROR\x20==='),console[_0x302cbb(0x1da)](_0x302cbb(0x1d0),_0x3928d9),loggerService_1[_0x302cbb(0x138)][_0x302cbb(0x190)](_0x302cbb(0x15f),'/charge',_0x3928d9);throw new Error('Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'+(_0x3928d9 instanceof Error?_0x3928d9[_0x302cbb(0x1f9)]:_0x302cbb(0x239)));}}async['checkPaymentStatus'](_0x20a8b6,_0x33afc7,_0x3f2c64=a51_0x4fc1a4(0xfb)){const _0x4b8d05=a51_0x4fc1a4;console[_0x4b8d05(0x200)](_0x4b8d05(0x1e1)+_0x3f2c64+_0x4b8d05(0x226)+_0x20a8b6+'\x20('+_0x33afc7+')');try{const _0x3ae89e={'payment_id':_0x20a8b6,'order_id':_0x33afc7},_0x310eb7=JSON[_0x4b8d05(0x136)](_0x3ae89e),_0x51b3b1=this[_0x4b8d05(0xfc)](_0x3f2c64===_0x4b8d05(0xfb)?_0x4b8d05(0x11b):'5000000000000000'),{key:_0x1ed92f,iv:_0x279b7c}=this[_0x4b8d05(0x184)](),_0x5979d7=this[_0x4b8d05(0x127)](_0x310eb7,_0x1ed92f,_0x279b7c),_0x97222f=this[_0x4b8d05(0x233)](_0x1ed92f,_0x279b7c,_0x51b3b1[_0x4b8d05(0x202)]),_0x5eb274=this[_0x4b8d05(0x13f)](_0x310eb7,_0x51b3b1[_0x4b8d05(0x154)]),_0x18ae4d={'merchant_point_id':_0x51b3b1[_0x4b8d05(0x126)],'method':_0x4b8d05(0x188),'info':_0x5979d7,'key':_0x97222f,'sign':_0x5eb274,'lang':'en'};loggerService_1[_0x4b8d05(0x138)][_0x4b8d05(0x1af)](_0x3f2c64[_0x4b8d05(0x1e3)](),'/status',_0x4b8d05(0x1c4),{'merchant_point_id':_0x51b3b1[_0x4b8d05(0x126)],'method':_0x4b8d05(0x188),'lang':'en'});const _0x16b5e2=Date[_0x4b8d05(0x12f)](),_0xdd93b4=await fetch(_0x51b3b1['apiUrl'],{'method':_0x4b8d05(0x1c4),'headers':{'Content-Type':_0x4b8d05(0x1be),'Accept':_0x4b8d05(0x1be),'User-Agent':_0x4b8d05(0x158)},'body':JSON[_0x4b8d05(0x136)](_0x18ae4d)}),_0x3e4f65=Date[_0x4b8d05(0x12f)]()-_0x16b5e2;if(!_0xdd93b4['ok']){const _0x2db37c=await _0xdd93b4[_0x4b8d05(0x1ec)]();loggerService_1[_0x4b8d05(0x138)]['logWhiteDomainResponse'](_0x3f2c64[_0x4b8d05(0x1e3)](),_0x4b8d05(0x1bc),_0xdd93b4[_0x4b8d05(0x188)],_0x2db37c,_0x3e4f65);throw new Error(_0x4b8d05(0x1a3)+_0xdd93b4[_0x4b8d05(0x188)]);}const _0x24955e=await _0xdd93b4['json']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3f2c64['toLowerCase'](),_0x4b8d05(0x1bc),_0xdd93b4[_0x4b8d05(0x188)],_0x24955e,_0x3e4f65);let _0x4c4af1=_0x24955e;if(_0x24955e['info']&&_0x24955e[_0x4b8d05(0x210)]&&_0x24955e[_0x4b8d05(0x1b4)]){console[_0x4b8d05(0x200)](_0x4b8d05(0x1dc));try{const _0x2b453b=await this[_0x4b8d05(0x15b)](_0x24955e['info'],_0x24955e['key'],_0x3f2c64);_0x4c4af1=JSON[_0x4b8d05(0x149)](_0x2b453b),console[_0x4b8d05(0x200)](_0x4b8d05(0x114)),loggerService_1[_0x4b8d05(0x138)][_0x4b8d05(0x103)](_0x3f2c64[_0x4b8d05(0x1e3)](),'/status_decrypted',_0xdd93b4[_0x4b8d05(0x188)],_0x4c4af1,_0x3e4f65),console[_0x4b8d05(0x200)](_0x4b8d05(0x21b));}catch(_0x1a7915){console['error'](_0x4b8d05(0x15e),_0x1a7915),loggerService_1['loggerService'][_0x4b8d05(0x190)](_0x3f2c64[_0x4b8d05(0x1e3)](),_0x4b8d05(0x232),_0x4b8d05(0x21a)+_0x1a7915),_0x4c4af1=_0x24955e;}}else loggerService_1[_0x4b8d05(0x138)][_0x4b8d05(0x103)](_0x3f2c64[_0x4b8d05(0x1e3)](),_0x4b8d05(0x1aa),_0xdd93b4[_0x4b8d05(0x188)],_0x4c4af1,_0x3e4f65),console[_0x4b8d05(0x200)](_0x4b8d05(0x195));console[_0x4b8d05(0x200)](_0x4b8d05(0x1c7),{'status':_0x4c4af1[_0x4b8d05(0x188)],'final':_0x4c4af1[_0x4b8d05(0x228)],'payment_id':_0x4c4af1[_0x4b8d05(0x1ed)],'desc':_0x4c4af1[_0x4b8d05(0x179)]});let _0x26318a=_0x4b8d05(0x194);if(_0x4c4af1[_0x4b8d05(0x188)]===0x64&&_0x4c4af1['final']===0x1)_0x26318a=_0x4b8d05(0x140);else{if(_0x4c4af1[_0x4b8d05(0x228)]===0x0||!this['isFinalStatus'](_0x4c4af1[_0x4b8d05(0x188)]))_0x26318a='PENDING';else _0x4c4af1[_0x4b8d05(0x228)]===0x1||this[_0x4b8d05(0x1fa)](_0x4c4af1['status'])?_0x26318a='FAILED':_0x26318a=_0x4b8d05(0x194);}const _0x4607bf=this[_0x4b8d05(0x1a7)](_0x4c4af1[_0x4b8d05(0x188)],_0x4c4af1[_0x4b8d05(0x179)]);return{'status':_0x26318a,'final':this['isFinalStatus'](_0x4c4af1[_0x4b8d05(0x188)]),'amount':_0x4c4af1[_0x4b8d05(0x168)],'currency':_0x4c4af1[_0x4b8d05(0x1e7)],'date_success':_0x4c4af1[_0x4b8d05(0x23b)],'description':_0x4607bf};}catch(_0x31b890){console['error'](_0x3f2c64+_0x4b8d05(0x10c),_0x31b890),loggerService_1[_0x4b8d05(0x138)]['logWhiteDomainError'](_0x3f2c64['toLowerCase'](),'/status',_0x31b890);throw new Error(_0x4b8d05(0x16e)+_0x3f2c64+_0x4b8d05(0x226)+(_0x31b890 instanceof Error?_0x31b890['message']:_0x4b8d05(0x239)));}}[a51_0x4fc1a4(0x246)](_0x47141b,_0x37351d,_0x3c42f6,_0x5b2090){const _0x323f22=a51_0x4fc1a4;console[_0x323f22(0x200)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20'+_0x5b2090+_0x323f22(0x1fc)+_0x47141b+'\x20('+_0x3c42f6+')'),this[_0x323f22(0x216)](_0x47141b);const _0x3178c4=[],_0xb337e0=0x5*0x3c*0x3e8,_0x1ff60b=0x2*0x3c*0x3c*0x3e8,_0x17e274=Math['floor'](_0x1ff60b/_0xb337e0);console[_0x323f22(0x200)](_0x323f22(0x249)+_0x17e274+_0x323f22(0x105));for(let _0x99f0e2=0x1;_0x99f0e2<=_0x17e274;_0x99f0e2++){const _0x52da70=setTimeout(async()=>{const _0x2b7b54=_0x323f22;console[_0x2b7b54(0x200)]('🔍\x20'+_0x5b2090+_0x2b7b54(0x1a9)+_0x99f0e2+'/'+_0x17e274+_0x2b7b54(0x1bb)+_0x47141b);try{const _0x142ed6=await this[_0x2b7b54(0x23e)](_0x3c42f6,_0x37351d,_0x5b2090);console[_0x2b7b54(0x200)](_0x2b7b54(0x119)+_0x99f0e2+_0x2b7b54(0x1e5),_0x142ed6),_0x142ed6[_0x2b7b54(0x228)]&&(console['log'](_0x2b7b54(0x1a8)+_0x47141b+_0x2b7b54(0x18e)+_0x142ed6[_0x2b7b54(0x188)]+_0x2b7b54(0x1ce)),this[_0x2b7b54(0x216)](_0x47141b),await this[_0x2b7b54(0x1ca)](_0x47141b,_0x142ed6[_0x2b7b54(0x188)],_0x142ed6));}catch(_0xbf3efe){console[_0x2b7b54(0x1da)](_0x2b7b54(0x22a)+_0x99f0e2+_0x2b7b54(0x171)+_0x47141b+':',_0xbf3efe);}},_0x99f0e2*_0xb337e0);_0x3178c4['push'](_0x52da70);}this[_0x323f22(0x10b)][_0x323f22(0x1c6)](_0x47141b,_0x3178c4),console['log']('✅\x20Scheduled\x20'+_0x17e274+_0x323f22(0x1d2)+_0x47141b);}['clearStatusTimers'](_0x5ae146){const _0x538762=a51_0x4fc1a4,_0xe1389=this[_0x538762(0x10b)][_0x538762(0x18d)](_0x5ae146);_0xe1389&&(console[_0x538762(0x200)]('🧹\x20Clearing\x20'+_0xe1389[_0x538762(0x1d6)]+_0x538762(0x1b1)+_0x5ae146),_0xe1389[_0x538762(0x20e)]((_0x583916,_0x65e35a)=>{clearTimeout(_0x583916);}),this[_0x538762(0x10b)][_0x538762(0x1d3)](_0x5ae146));}async[a51_0x4fc1a4(0x1ca)](_0x1e28a1,_0x22861a,_0x4cec3b){const _0x4d723f=a51_0x4fc1a4;try{const _0x40f4a2=(await Promise[_0x4d723f(0x1f0)]()[_0x4d723f(0x1e0)](()=>__importStar(require('../../config/database'))))[_0x4d723f(0x174)],_0xdb6490={'status':_0x22861a[_0x4d723f(0x167)](),'updatedAt':new Date(),'statusChangedBy':_0x4d723f(0x164),'statusChangedAt':new Date()};_0x22861a==='PAID'&&(_0xdb6490[_0x4d723f(0x192)]=new Date()),_0x22861a===_0x4d723f(0x23a)&&_0x4cec3b[_0x4d723f(0xff)]&&(_0xdb6490['failureMessage']=_0x4cec3b[_0x4d723f(0xff)],console[_0x4d723f(0x200)](_0x4d723f(0x13d)+_0x4cec3b['description'])),await _0x40f4a2[_0x4d723f(0x1ba)][_0x4d723f(0x110)]({'where':{'id':_0x1e28a1},'data':_0xdb6490}),console[_0x4d723f(0x200)](_0x4d723f(0x1a8)+_0x1e28a1+_0x4d723f(0x1f2)+_0x22861a),await this[_0x4d723f(0x159)](_0x1e28a1,_0x22861a);}catch(_0xece5df){console[_0x4d723f(0x1da)](_0x4d723f(0x169)+_0x1e28a1+':',_0xece5df);}}async[a51_0x4fc1a4(0x159)](_0x25eacc,_0x414b5b){const _0x3138bf=a51_0x4fc1a4;try{const _0x3e61e7=(await Promise[_0x3138bf(0x1f0)]()[_0x3138bf(0x1e0)](()=>__importStar(require('../../config/database'))))[_0x3138bf(0x174)],{telegramBotService:_0x2135ce}=await Promise['resolve']()[_0x3138bf(0x1e0)](()=>__importStar(require(_0x3138bf(0x22c)))),_0x3ae863=await _0x3e61e7[_0x3138bf(0x1ba)][_0x3138bf(0x1db)]({'where':{'id':_0x25eacc},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x3ae863)return;const _0x5c85c3={'PAID':_0x3138bf(0x181),'FAILED':_0x3138bf(0x214)},_0x9c1876=_0x5c85c3[_0x414b5b];_0x9c1876&&await _0x2135ce['sendPaymentNotification'](_0x3ae863['shopId'],_0x3ae863,_0x9c1876),await this['sendShopWebhook'](_0x3ae863,_0x414b5b);}catch(_0x1216fe){console[_0x3138bf(0x1da)]('Failed\x20to\x20send\x20payment\x20notifications:',_0x1216fe);}}async[a51_0x4fc1a4(0x1e4)](_0x1ddc76,_0x2096f4){const _0x1d9939=a51_0x4fc1a4,_0x2bdbf4=Date[_0x1d9939(0x12f)]();try{const _0x34b55e=_0x1ddc76[_0x1d9939(0x106)],_0x1ef599=_0x34b55e[_0x1d9939(0x241)];if(!_0x1ef599?.[_0x1d9939(0x1de)]){console[_0x1d9939(0x200)](_0x1d9939(0x20a)+_0x34b55e['id']);return;}const _0x181545=_0x2096f4===_0x1d9939(0x140)?_0x1d9939(0x160):_0x1d9939(0x1ff);let _0x2df83c=[];if(_0x1ef599[_0x1d9939(0x10f)])try{_0x2df83c=Array[_0x1d9939(0x1a6)](_0x1ef599[_0x1d9939(0x10f)])?_0x1ef599['webhookEvents']:JSON[_0x1d9939(0x149)](_0x1ef599[_0x1d9939(0x10f)]);}catch(_0x4ce627){console[_0x1d9939(0x1da)]('Error\x20parsing\x20webhook\x20events:',_0x4ce627),_0x2df83c=[];}if(!_0x2df83c[_0x1d9939(0x1f1)](_0x181545)){console[_0x1d9939(0x200)](_0x1d9939(0x1bf)+_0x181545+'\x20not\x20enabled\x20for\x20shop\x20'+_0x34b55e['id']);return;}const _0x364816={'event':_0x181545,'payment':{'id':_0x1ddc76['id'],'order_id':_0x1ddc76[_0x1d9939(0x237)],'gateway_order_id':_0x1ddc76[_0x1d9939(0x142)],'gateway':_0x1d9939(0x1d4),'amount':_0x1ddc76['amount'],'currency':_0x1ddc76['currency'],'status':_0x2096f4[_0x1d9939(0x1e3)](),'customer_email':_0x1ddc76['customerEmail'],'customer_name':_0x1ddc76[_0x1d9939(0x12a)],'created_at':_0x1ddc76[_0x1d9939(0x1ab)],'updated_at':new Date()}},_0x4185ea=await fetch(_0x1ef599['webhookUrl'],{'method':_0x1d9939(0x1c4),'headers':{'Content-Type':_0x1d9939(0x1be),'User-Agent':_0x1d9939(0x134)},'body':JSON[_0x1d9939(0x136)](_0x364816)}),_0x26265f=Date[_0x1d9939(0x12f)]()-_0x2bdbf4;loggerService_1['loggerService']['logShopWebhookSent'](_0x1ddc76['shopId'],_0x1ef599[_0x1d9939(0x1de)],_0x181545,_0x4185ea[_0x1d9939(0x188)],_0x26265f,_0x364816),console[_0x1d9939(0x200)](_0x1d9939(0x122)+_0x1ef599[_0x1d9939(0x1de)]+'\x20with\x20status\x20'+_0x4185ea[_0x1d9939(0x188)]+'\x20('+_0x26265f+'ms)');}catch(_0x2a75b2){console[_0x1d9939(0x1da)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x2a75b2),loggerService_1[_0x1d9939(0x138)]['logShopWebhookError'](_0x1ddc76['shopId'],_0x1ddc76['shop']?.['settings']?.['webhookUrl']||'unknown','webhook_send',_0x2a75b2,{});}}[a51_0x4fc1a4(0x130)](_0x4baa62){const _0x2b1bc9=a51_0x4fc1a4,_0x1b53bc=_0x4baa62[_0x2b1bc9(0x191)](/[\s-]/g,'');if(_0x1b53bc['length']<0x4)return _0x2b1bc9(0x24f);return _0x2b1bc9(0x10a)+_0x1b53bc[_0x2b1bc9(0x1eb)](-0x4);}async[a51_0x4fc1a4(0x24a)](_0x1106cd,_0x2ecfca=a51_0x4fc1a4(0x1e6)){const _0x5d956c=a51_0x4fc1a4;console[_0x5d956c(0x200)](_0x5d956c(0x178),JSON['stringify'](_0x1106cd,null,0x2));let _0x4979fc=_0x1106cd,_0x59233a=_0x2ecfca;_0x1106cd[_0x5d956c(0x1d5)]?(_0x59233a=_0x1106cd[_0x5d956c(0x1d5)]['toUpperCase']()==='VISA'?'VISA':_0x5d956c(0x1e6),console[_0x5d956c(0x200)](_0x5d956c(0x1f4)+_0x59233a)):console[_0x5d956c(0x200)](_0x5d956c(0x24c)+_0x59233a);if(_0x1106cd[_0x5d956c(0x22f)]&&_0x1106cd['key']&&_0x1106cd['sign']){console['log'](_0x5d956c(0x1a2));try{const _0x3c058e=await this['decryptResponsePhp'](_0x1106cd[_0x5d956c(0x22f)],_0x1106cd['key'],_0x59233a);_0x4979fc=JSON[_0x5d956c(0x149)](_0x3c058e),console[_0x5d956c(0x200)](_0x5d956c(0x129)),console[_0x5d956c(0x200)](_0x5d956c(0x116),JSON[_0x5d956c(0x136)](_0x4979fc,null,0x2));}catch(_0x2a2eea){console[_0x5d956c(0x1da)]('❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:',_0x2a2eea),console[_0x5d956c(0x200)](_0x5d956c(0x11f)),_0x4979fc=_0x1106cd;}}else console[_0x5d956c(0x200)](_0x5d956c(0x12b));let _0x2e4694=_0x5d956c(0x194);if(_0x4979fc[_0x5d956c(0x188)]===0x64&&_0x4979fc[_0x5d956c(0x228)]===0x1)_0x2e4694=_0x5d956c(0x140);else{if(_0x4979fc[_0x5d956c(0x228)]===0x0||!this[_0x5d956c(0x1fa)](_0x4979fc['status']))_0x2e4694=_0x5d956c(0x194);else _0x4979fc[_0x5d956c(0x228)]===0x1||this[_0x5d956c(0x1fa)](_0x4979fc['status'])?_0x2e4694=_0x5d956c(0x23a):_0x2e4694=_0x5d956c(0x194);}let _0x6b5e97='';if(_0x4979fc['order_id'])_0x6b5e97=_0x4979fc[_0x5d956c(0x23c)][_0x5d956c(0x101)](),console[_0x5d956c(0x200)](_0x5d956c(0x212)+_0x59233a+'\x20order_id\x20for\x20search:\x20'+_0x6b5e97);else _0x4979fc[_0x5d956c(0x1ed)]?(_0x6b5e97=_0x4979fc[_0x5d956c(0x1ed)][_0x5d956c(0x101)](),console[_0x5d956c(0x200)](_0x5d956c(0x212)+_0x59233a+_0x5d956c(0x213)+_0x6b5e97)):(_0x6b5e97=_0x4979fc[_0x5d956c(0x237)]||_0x4979fc[_0x5d956c(0x18c)]||_0x4979fc['id']||'',console['log'](_0x5d956c(0x187)+_0x6b5e97));console[_0x5d956c(0x200)](_0x5d956c(0x109)+_0x59233a+'\x20webhook\x20extracted\x20data:'),console['log'](_0x5d956c(0x139)+_0x6b5e97+_0x5d956c(0x1a4)+_0x4979fc['order_id']+_0x5d956c(0x1b6)+_0x4979fc[_0x5d956c(0x237)]+_0x5d956c(0x18f)+_0x4979fc[_0x5d956c(0x1ed)]+_0x5d956c(0x207)+_0x4979fc[_0x5d956c(0x18c)]+_0x5d956c(0x14f)+_0x4979fc['id']+')'),console[_0x5d956c(0x200)]('\x20\x20\x20Status:\x20'+_0x2e4694+_0x5d956c(0x133)+_0x4979fc[_0x5d956c(0x188)]+_0x5d956c(0x16a)+_0x4979fc[_0x5d956c(0x228)]+')'),console[_0x5d956c(0x200)](_0x5d956c(0x245)+_0x4979fc[_0x5d956c(0x168)]),console[_0x5d956c(0x200)](_0x5d956c(0x1cb)+_0x4979fc['currency']);let _0x2f5771;_0x2e4694===_0x5d956c(0x23a)&&(_0x2f5771=this[_0x5d956c(0x1a7)](_0x4979fc['status'],_0x4979fc[_0x5d956c(0x179)]),console[_0x5d956c(0x200)](_0x5d956c(0x113)+_0x2f5771));const _0x54d91a={'paymentId':_0x6b5e97,'status':_0x2e4694,'amount':_0x4979fc[_0x5d956c(0x168)],'currency':_0x4979fc[_0x5d956c(0x1e7)]};return _0x2f5771&&(_0x54d91a[_0x5d956c(0x1ea)]=_0x2f5771),_0x54d91a;}[a51_0x4fc1a4(0x107)](){const _0x2afd9f=a51_0x4fc1a4;console['log']('🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...');const _0x2f88f4=this['statusCheckTimers'][_0x2afd9f(0x20d)];for(const [_0x168252]of this[_0x2afd9f(0x10b)]){this['clearStatusTimers'](_0x168252);}console[_0x2afd9f(0x200)](_0x2afd9f(0x1e2)+_0x2f88f4+_0x2afd9f(0x234));}}exports[a51_0x4fc1a4(0x145)]=VisaMasterCardService;