'use strict';const a48_0x3017bd=a48_0x4198;function a48_0x4198(_0x53d3b4,_0x505e69){const _0x1433be=a48_0x1433();return a48_0x4198=function(_0x419875,_0x42f72b){_0x419875=_0x419875-0x164;let _0x5d21c6=_0x1433be[_0x419875];return _0x5d21c6;},a48_0x4198(_0x53d3b4,_0x505e69);}(function(_0x591e69,_0x539c72){const _0x5b575f=a48_0x4198,_0xe1bf35=_0x591e69();while(!![]){try{const _0x2b7b7f=-parseInt(_0x5b575f(0x237))/0x1+-parseInt(_0x5b575f(0x1bc))/0x2+-parseInt(_0x5b575f(0x1fa))/0x3*(parseInt(_0x5b575f(0x1ad))/0x4)+-parseInt(_0x5b575f(0x241))/0x5+-parseInt(_0x5b575f(0x283))/0x6+-parseInt(_0x5b575f(0x186))/0x7*(parseInt(_0x5b575f(0x229))/0x8)+parseInt(_0x5b575f(0x21e))/0x9*(parseInt(_0x5b575f(0x1ce))/0xa);if(_0x2b7b7f===_0x539c72)break;else _0xe1bf35['push'](_0xe1bf35['shift']());}catch(_0x22b697){_0xe1bf35['push'](_0xe1bf35['shift']());}}}(a48_0x1433,0xf3f71));var __createBinding=this&&this[a48_0x3017bd(0x1fe)]||(Object[a48_0x3017bd(0x272)]?function(_0x4d2e30,_0x4f7df0,_0x4af708,_0x2fb71e){const _0x4b0f37=a48_0x3017bd;if(_0x2fb71e===undefined)_0x2fb71e=_0x4af708;var _0x9b11fd=Object[_0x4b0f37(0x261)](_0x4f7df0,_0x4af708);(!_0x9b11fd||('get'in _0x9b11fd?!_0x4f7df0[_0x4b0f37(0x199)]:_0x9b11fd[_0x4b0f37(0x171)]||_0x9b11fd[_0x4b0f37(0x167)]))&&(_0x9b11fd={'enumerable':!![],'get':function(){return _0x4f7df0[_0x4af708];}}),Object['defineProperty'](_0x4d2e30,_0x2fb71e,_0x9b11fd);}:function(_0x3cf1ad,_0x31b7af,_0x21d714,_0x1a24fc){if(_0x1a24fc===undefined)_0x1a24fc=_0x21d714;_0x3cf1ad[_0x1a24fc]=_0x31b7af[_0x21d714];}),__setModuleDefault=this&&this[a48_0x3017bd(0x224)]||(Object[a48_0x3017bd(0x272)]?function(_0x48250a,_0x3659f5){const _0xe1f0db=a48_0x3017bd;Object[_0xe1f0db(0x271)](_0x48250a,_0xe1f0db(0x24d),{'enumerable':!![],'value':_0x3659f5});}:function(_0x1e4ff1,_0x2cc93b){_0x1e4ff1['default']=_0x2cc93b;}),__importStar=this&&this[a48_0x3017bd(0x276)]||(function(){var _0x317f97=function(_0x378000){return _0x317f97=Object['getOwnPropertyNames']||function(_0x245fed){const _0x1309a4=a48_0x4198;var _0x27c910=[];for(var _0x43ac1d in _0x245fed)if(Object[_0x1309a4(0x16e)]['hasOwnProperty']['call'](_0x245fed,_0x43ac1d))_0x27c910[_0x27c910['length']]=_0x43ac1d;return _0x27c910;},_0x317f97(_0x378000);};return function(_0x2d8c50){const _0x3e03fb=a48_0x4198;if(_0x2d8c50&&_0x2d8c50[_0x3e03fb(0x199)])return _0x2d8c50;var _0x4d7d07={};if(_0x2d8c50!=null){for(var _0x104e5d=_0x317f97(_0x2d8c50),_0x21c9a7=0x0;_0x21c9a7<_0x104e5d[_0x3e03fb(0x247)];_0x21c9a7++)if(_0x104e5d[_0x21c9a7]!==_0x3e03fb(0x24d))__createBinding(_0x4d7d07,_0x2d8c50,_0x104e5d[_0x21c9a7]);}return __setModuleDefault(_0x4d7d07,_0x2d8c50),_0x4d7d07;};}()),__importDefault=this&&this[a48_0x3017bd(0x168)]||function(_0xc81031){return _0xc81031&&_0xc81031['__esModule']?_0xc81031:{'default':_0xc81031};};Object[a48_0x3017bd(0x271)](exports,a48_0x3017bd(0x199),{'value':!![]}),exports[a48_0x3017bd(0x22a)]=void 0x0;const crypto_1=__importDefault(require(a48_0x3017bd(0x21f))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x3017bd(0x206))),loggerService_1=require(a48_0x3017bd(0x19e));function a48_0x1433(){const _0x58e59b=['/status_decrypted','VISA/MasterCard','error','Failed\x20to\x20send\x20payment\x20notifications:','description','...',',\x20body:\x20',',\x20orderId=','📊\x20','/charge_raw','🔍\x20','createCipheriv','VISA/MasterCard\x20payment\x20successful','3404049bzDKWV','visa/mastercard','visaPrivateKeyPath','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','__createBinding','createSign','desc','encryptAES','Card\x20Holder:','substring','floor','stringify','path','Result\x20URL:','\x20\x20\x20Payment\x20ID:\x20','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','resolve','🔐\x20VISA\x20Private\x20key\x20path:','/charge','/charge_decrypted','payment.success','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','application/json','replace','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','\x20\x20\x20-\x20key\x20length:','\x20API:\x20','system','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','\x20payment_id\x20for\x20search:\x20','number',',\x20id=','slice','❌\x20Status\x20check\x20#','9rRlMCG','crypto','\x20status\x20check\x20#','🔐\x20AES\x20key\x20and\x20IV\x20generated','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','Decryption\x20failed:\x20','__setModuleDefault','/charge_decrypt','sign','3ds_url','Unknown\x20error','640LwfcjU','VisaMasterCardService','first_name','private.pem','✅\x20Payment\x20','masterCardMerchantPointId','\x20\x20\x20Status:\x20','checkPaymentStatus','\x20status\x20timers\x20for\x20payment\x20','then','🔐\x20VISA\x20Public\x20key\x20path:','Payment\x20ID:','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','statusCheckTimers','662087JislBz','signRSA','toLowerCase','decryptAES','\x20\x20\x20-\x20sign\x20length:','1111','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','💾\x20Payment\x20data\x20prepared','Status:','5112135mfKofT','settings','scheduleStatusChecks','===\x20PARSED\x20API\x20RESPONSE\x20===','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','⏰\x20Will\x20check\x20status\x20','length','warn','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','charAt','ms)','🔐\x20MasterCard\x20API\x20URL:','default','createdAt','TesSoft\x20Payment\x20System/1.0','❌\x20RSA\x20signing\x20failed:','info','\x20status\x20checks\x20for\x20payment\x20','from','📝\x20Data\x20length:','\x20with\x20status\x20','paymentId','⏰\x20Scheduling\x20status\x20checks\x20for\x20','createDecipheriv','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','❌\x20Data\x20being\x20signed:','status','Failed\x20to\x20decrypt\x20response','stopAllStatusChecks','POST','MasterCard\x20webhook\x20sent\x20to\x20','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','getOwnPropertyDescriptor','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','includes','encryptRSA','\x20is\x20final\x20(','publicEncrypt','text','visaMerchantPointId','Error\x20parsing\x20webhook\x20events:','payment','visaPublicKeyPath','\x20result:','toUpperCase','loggerService','Response\x20Body:','trim','defineProperty','create','/status_decrypt','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','HTTP\x20error!\x20status:\x20','__importStar','===\x20API\x20RESPONSE\x20===','\x20status\x20check\x20error:','cardType','sendPaymentNotifications','customerEmail','set','/status_raw','Order\x20ID:','\x20\x20\x20-\x20method:\x20charge','❌\x20Failure\x20description:\x20','-----END','\x20for\x20payment\x20','1040520ZrRsCU','amount','../../config/database','log','order_id','\x20order_id\x20for\x20search:\x20','cwd','failureMessage','\x20status\x20updated\x20to\x20','join','merchantPointId','unknown','configurable','__importDefault','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','\x20payment:\x20','key','✅\x20Payment\x20successful','prototype','🔐\x20MasterCard\x20Public\x20key\x20path:','generateAESKey','writable','gatewayOrderId','apiUrl','🔐\x20VISA\x20Private\x20key\x20length:\x20','paid','/status','MASTERCARD','now','get','last_name','decryptResponsePhp','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','randomBytes','keys','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','currency','shopId','shop','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','psp_public.pem','Response\x20Time:','41671SfnhKk','json','base64','📝\x20Signature\x20length:','🔐\x20Data\x20encrypted\x20with\x20AES','🔐\x20Using\x20keys:\x20','expire_year','****','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','utf8','privateDecrypt','\x20payment\x20status:\x20','-----BEGIN','\x20\x20\x20-\x20merchant_point_id:',',\x20payment_id=','logWhiteDomainError','__esModule','📝\x20Decrypted\x20webhook\x20data:','🧹\x20Clearing\x20','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','payment_id','../loggerService','payment.failed','validateKeyFiles','constants','📊\x20Status\x20check\x20#','visaApiUrl','maskCardNumber','end','../telegramBotService','PENDING','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','Failed\x20to\x20check\x20','visa_private.pem','Status\x20decryption\x20failed:\x20','\x20\x20\x20Amount:\x20','4eanenn','parse','expire_month','final','🔍\x20Using\x20','webhookUrl','\x20MasterCard\x20status\x20check\x20timers','📝\x20Final\x20request\x20structure:','message','📝\x20Encrypted\x20data\x20length:','paidAt','delete','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','HTTP\x20','Webhook\x20event\x20','1825128HbaqzD','toString','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format',',\x20Desc:\x20','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','none','),\x20defaulting\x20to\x20MasterCard','sendPaymentNotification','privateKeyPath','FAILED','\x20characters','existsSync','3DS\x20URL:','webhook_send','clearStatusTimers','Amount:',',\x20final=','card_type','53807020yfgQeV','PAID','webhookEvents','processWebhook','publicKeyPath','\x20not\x20enabled\x20for\x20shop\x20','https://api.paydmeth.com/api','Failed\x20to\x20send\x20MasterCard\x20webhook:','****\x20****\x20****\x20','🔐\x20MasterCard\x20Private\x20key\x20path:','VISA','date_success','update','🔐\x203DS\x20verification\x20required','logWhiteDomainResponse','getCardTypeAndApi','masterCardApiUrl','updatePaymentStatus','charge','customerName','🎯\x20Using\x20','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','4000000000000000','isArray','orderId','forEach','🔐\x20AES\x20key\x20length:','readFileSync','logWhiteDomainRequest','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is'];a48_0x1433=function(){return _0x58e59b;};return a48_0x1433();}class VisaMasterCardService{constructor(){const _0x21161b=a48_0x3017bd;this[_0x21161b(0x236)]=new Map(),this[_0x21161b(0x1de)]=_0x21161b(0x1d4),this[_0x21161b(0x22e)]=0x6a7,this[_0x21161b(0x1c4)]=path_1[_0x21161b(0x24d)]['join'](process[_0x21161b(0x289)](),_0x21161b(0x17e),_0x21161b(0x22c)),this[_0x21161b(0x1d2)]=path_1['default'][_0x21161b(0x164)](process[_0x21161b(0x289)](),_0x21161b(0x17e),_0x21161b(0x184)),this[_0x21161b(0x1a3)]=_0x21161b(0x1d4),this[_0x21161b(0x268)]=0x6b7,this[_0x21161b(0x1fc)]=path_1[_0x21161b(0x24d)][_0x21161b(0x164)](process[_0x21161b(0x289)](),_0x21161b(0x17e),_0x21161b(0x1aa)),this[_0x21161b(0x26b)]=path_1[_0x21161b(0x24d)]['join'](process['cwd'](),_0x21161b(0x17e),'visa_public.pem'),console['log']('💳\x20VISA/MasterCard\x20service\x20initialized'),console['log'](_0x21161b(0x24c),this[_0x21161b(0x1de)]),console[_0x21161b(0x286)]('🔐\x20VISA\x20API\x20URL:',this[_0x21161b(0x1a3)]),console[_0x21161b(0x286)](_0x21161b(0x1d7),this[_0x21161b(0x1c4)]),console[_0x21161b(0x286)](_0x21161b(0x16f),this[_0x21161b(0x1d2)]),console[_0x21161b(0x286)](_0x21161b(0x20b),this['visaPrivateKeyPath']),console[_0x21161b(0x286)](_0x21161b(0x233),this[_0x21161b(0x26b)]),this[_0x21161b(0x1a0)]();}[a48_0x3017bd(0x1dd)](_0x2b72f9){const _0x273d59=a48_0x3017bd,_0x529d34=_0x2b72f9[_0x273d59(0x24a)](0x0);if(_0x529d34==='4')return console['log']('💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)'),{'cardType':_0x273d59(0x1d8),'apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x273d59(0x1fc)],'publicKeyPath':this[_0x273d59(0x26b)],'merchantPointId':this[_0x273d59(0x268)]};else return _0x529d34==='5'?(console['log']('💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)'),{'cardType':_0x273d59(0x177),'apiUrl':this[_0x273d59(0x1de)],'privateKeyPath':this[_0x273d59(0x1c4)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this['masterCardMerchantPointId']}):(console[_0x273d59(0x286)]('💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20'+_0x529d34+_0x273d59(0x1c2)),{'cardType':_0x273d59(0x177),'apiUrl':this[_0x273d59(0x1de)],'privateKeyPath':this[_0x273d59(0x1c4)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x273d59(0x22e)]});}[a48_0x3017bd(0x1a0)](){const _0xffce1e=a48_0x3017bd;try{if(!fs_1[_0xffce1e(0x24d)][_0xffce1e(0x1c7)](this[_0xffce1e(0x1c4)]))throw new Error(_0xffce1e(0x245)+this[_0xffce1e(0x1c4)]);if(!fs_1['default'][_0xffce1e(0x1c7)](this['publicKeyPath']))throw new Error(_0xffce1e(0x214)+this['publicKeyPath']);const _0x494590=fs_1[_0xffce1e(0x24d)][_0xffce1e(0x1e9)](this['privateKeyPath'],_0xffce1e(0x192))[_0xffce1e(0x270)](),_0x4ff860=fs_1[_0xffce1e(0x24d)][_0xffce1e(0x1e9)](this[_0xffce1e(0x1d2)],_0xffce1e(0x192))[_0xffce1e(0x270)]();if(!_0x494590['includes'](_0xffce1e(0x195))||!_0x494590['includes']('-----END'))throw new Error(_0xffce1e(0x183));if(!_0x4ff860['includes']('-----BEGIN')||!_0x4ff860[_0xffce1e(0x263)](_0xffce1e(0x281)))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console['log'](_0xffce1e(0x1eb)),console['log'](_0xffce1e(0x213)+_0x494590[_0xffce1e(0x247)]+_0xffce1e(0x1c6)),console[_0xffce1e(0x286)](_0xffce1e(0x1fd)+_0x4ff860[_0xffce1e(0x247)]+_0xffce1e(0x1c6));if(fs_1[_0xffce1e(0x24d)][_0xffce1e(0x1c7)](this[_0xffce1e(0x1fc)])&&fs_1[_0xffce1e(0x24d)][_0xffce1e(0x1c7)](this[_0xffce1e(0x26b)])){const _0x4b7161=fs_1['default']['readFileSync'](this[_0xffce1e(0x1fc)],_0xffce1e(0x192))[_0xffce1e(0x270)](),_0x21f619=fs_1[_0xffce1e(0x24d)][_0xffce1e(0x1e9)](this['visaPublicKeyPath'],_0xffce1e(0x192))[_0xffce1e(0x270)]();(!_0x4b7161['includes'](_0xffce1e(0x195))||!_0x4b7161[_0xffce1e(0x263)](_0xffce1e(0x281)))&&console[_0xffce1e(0x248)](_0xffce1e(0x1be)),(!_0x21f619[_0xffce1e(0x263)](_0xffce1e(0x195))||!_0x21f619['includes'](_0xffce1e(0x281)))&&console[_0xffce1e(0x248)]('⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),console['log']('✅\x20VISA\x20key\x20files\x20validated\x20successfully'),console[_0xffce1e(0x286)](_0xffce1e(0x174)+_0x4b7161[_0xffce1e(0x247)]+_0xffce1e(0x1c6)),console[_0xffce1e(0x286)]('🔐\x20VISA\x20Public\x20key\x20length:\x20'+_0x21f619['length']+_0xffce1e(0x1c6));}else console[_0xffce1e(0x248)](_0xffce1e(0x18e)),console[_0xffce1e(0x248)](_0xffce1e(0x169)+this['visaPrivateKeyPath']),console[_0xffce1e(0x248)](_0xffce1e(0x212)+this[_0xffce1e(0x26b)]);}catch(_0x2b5903){console[_0xffce1e(0x1ef)](_0xffce1e(0x249),_0x2b5903);throw _0x2b5903;}}[a48_0x3017bd(0x170)](){const _0x583b16=a48_0x3017bd,_0x12e278=crypto_1[_0x583b16(0x24d)][_0x583b16(0x17d)](0x20),_0x33be1a=crypto_1[_0x583b16(0x24d)][_0x583b16(0x17d)](0x10);return{'key':_0x12e278,'iv':_0x33be1a};}[a48_0x3017bd(0x201)](_0x4692e2,_0x92d2e1,_0xea2da){const _0x4ba723=a48_0x3017bd,_0x30f392=crypto_1[_0x4ba723(0x24d)][_0x4ba723(0x1f8)]('aes-256-ctr',_0x92d2e1,_0xea2da);let _0x4041e7=_0x30f392[_0x4ba723(0x1da)](_0x4692e2,'utf8',_0x4ba723(0x188));return _0x4041e7+=_0x30f392[_0x4ba723(0x1b0)]('base64'),_0x4041e7;}[a48_0x3017bd(0x264)](_0x4aa575,_0x342908,_0x1c0073){const _0x5c185c=a48_0x3017bd;try{const _0x41a96b=fs_1['default'][_0x5c185c(0x1e9)](_0x1c0073,_0x5c185c(0x192))[_0x5c185c(0x270)](),_0x419a52={'iv':_0x342908['toString'](_0x5c185c(0x188)),'key':_0x4aa575[_0x5c185c(0x1bd)](_0x5c185c(0x188))},_0x2cdcc9=JSON[_0x5c185c(0x205)](_0x419a52);console[_0x5c185c(0x286)](_0x5c185c(0x1b9),_0x2cdcc9['length']);const _0x5a8fd5=crypto_1[_0x5c185c(0x24d)][_0x5c185c(0x266)]({'key':_0x41a96b,'padding':crypto_1[_0x5c185c(0x24d)][_0x5c185c(0x1a1)]['RSA_PKCS1_PADDING']},Buffer[_0x5c185c(0x253)](_0x2cdcc9));return console['log'](_0x5c185c(0x23e),_0x5a8fd5[_0x5c185c(0x247)]),_0x5a8fd5['toString'](_0x5c185c(0x188));}catch(_0x16b68c){console[_0x5c185c(0x1ef)]('❌\x20RSA\x20encryption\x20failed:',_0x16b68c);throw new Error(_0x5c185c(0x222));}}[a48_0x3017bd(0x238)](_0x2851ce,_0x40a7d8){const _0x4d2d41=a48_0x3017bd;try{const _0x5134f1=fs_1['default']['readFileSync'](_0x40a7d8,_0x4d2d41(0x192))[_0x4d2d41(0x270)](),_0x13a498=crypto_1[_0x4d2d41(0x24d)][_0x4d2d41(0x1ff)]('SHA256');_0x13a498[_0x4d2d41(0x1da)](_0x2851ce),_0x13a498[_0x4d2d41(0x1a5)]();const _0x2c1b5c=_0x13a498[_0x4d2d41(0x226)](_0x5134f1,'base64');return console[_0x4d2d41(0x286)]('🔐\x20RSA\x20signing\x20successful'),console[_0x4d2d41(0x286)]('📝\x20Data\x20to\x20sign\x20length:',_0x2851ce[_0x4d2d41(0x247)]),console[_0x4d2d41(0x286)]('📝\x20Signature\x20length:',_0x2c1b5c[_0x4d2d41(0x247)]),_0x2c1b5c;}catch(_0x51397a){console[_0x4d2d41(0x1ef)](_0x4d2d41(0x250),_0x51397a),console[_0x4d2d41(0x1ef)](_0x4d2d41(0x25a),_0x2851ce[_0x4d2d41(0x203)](0x0,0xc8)+_0x4d2d41(0x1f2));throw new Error(_0x4d2d41(0x259));}}['decryptAES'](_0x1b3ada,_0x576cfc,_0x1ecffd){const _0x41caac=a48_0x3017bd,_0x2584be=crypto_1[_0x41caac(0x24d)][_0x41caac(0x258)]('aes-256-ctr',_0x576cfc,_0x1ecffd);let _0x2038bf=_0x2584be[_0x41caac(0x1da)](_0x1b3ada,_0x41caac(0x188),_0x41caac(0x192));return _0x2038bf+=_0x2584be[_0x41caac(0x1b0)](_0x41caac(0x192)),_0x2038bf;}async[a48_0x3017bd(0x17b)](_0x36861b,_0x489d8a,_0xe30980=a48_0x3017bd(0x177)){const _0x3c1ce5=a48_0x3017bd;try{const _0xb080af=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x3c1ce5(0x25e),'headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'info':_0x36861b,'key':_0x489d8a,'card_type':_0xe30980[_0x3c1ce5(0x239)]()})});if(!_0xb080af['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0xb080af[_0x3c1ce5(0x267)]();}catch(_0x4b07c1){console[_0x3c1ce5(0x1ef)]('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x4b07c1);throw new Error(_0x3c1ce5(0x260));}}['decryptResponse'](_0x37d20f,_0x2c755d){const _0x1ed315=a48_0x3017bd;try{const _0xda6061=fs_1[_0x1ed315(0x24d)]['readFileSync'](this[_0x1ed315(0x1c4)],_0x1ed315(0x192))[_0x1ed315(0x270)](),_0x4a4146=crypto_1[_0x1ed315(0x24d)][_0x1ed315(0x193)](_0xda6061,Buffer[_0x1ed315(0x253)](_0x2c755d,_0x1ed315(0x188))),_0x225cbd=JSON[_0x1ed315(0x1ae)](_0x4a4146[_0x1ed315(0x1bd)]()),_0x30d679=Buffer[_0x1ed315(0x253)](_0x225cbd[_0x1ed315(0x16c)],_0x1ed315(0x188)),_0x2d4902=Buffer['from'](_0x225cbd['iv'],_0x1ed315(0x188));return this[_0x1ed315(0x23a)](_0x37d20f,_0x30d679,_0x2d4902);}catch(_0x22291f){throw new Error(_0x1ed315(0x25c));}}async['processCardPayment'](_0x3214b0){const _0x53438d=a48_0x3017bd,{paymentId:_0x450d74,orderId:_0xe02349,amount:_0x10d2b8,currency:_0x49a7ea,cardData:_0x414467,resultUrl:_0x11dc7d,returnUrl:_0x13e4f2,cardHolder:_0x1b3395,browser:_0x2bb083}=_0x3214b0;console[_0x53438d(0x286)]('===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console['log'](_0x53438d(0x234),_0x450d74),console[_0x53438d(0x286)](_0x53438d(0x27e),_0xe02349),console[_0x53438d(0x286)](_0x53438d(0x1cb),_0x10d2b8,_0x49a7ea),console[_0x53438d(0x286)]('Card\x20Number:',this[_0x53438d(0x1a4)](_0x414467[_0x53438d(0x21a)])),console[_0x53438d(0x286)](_0x53438d(0x202),_0x1b3395[_0x53438d(0x22b)]+'\x20'+_0x1b3395[_0x53438d(0x17a)]),console[_0x53438d(0x286)]('Return\x20URL:',_0x13e4f2),console['log'](_0x53438d(0x207),_0x11dc7d);const _0x30ab1d=this[_0x53438d(0x1dd)](_0x414467[_0x53438d(0x21a)]);console[_0x53438d(0x286)](_0x53438d(0x1e2)+_0x30ab1d[_0x53438d(0x279)]+_0x53438d(0x216)+_0x30ab1d[_0x53438d(0x173)]),console[_0x53438d(0x286)](_0x53438d(0x18b)+_0x30ab1d[_0x53438d(0x1c4)]+',\x20'+_0x30ab1d[_0x53438d(0x1d2)]);const _0x500ebc={'amount':_0x10d2b8,'currency':_0x49a7ea[_0x53438d(0x26d)](),'order_id':_0xe02349,'result_url':_0x11dc7d,'return_url':_0x13e4f2,'country':'','card':{'number':_0x414467[_0x53438d(0x21a)],'expire_month':_0x414467[_0x53438d(0x1af)],'expire_year':_0x414467[_0x53438d(0x18c)],'cvv':_0x414467['cvv']},'card_holder':_0x1b3395,'browser':_0x2bb083},_0x4fb00c=JSON[_0x53438d(0x205)](_0x500ebc);console[_0x53438d(0x286)](_0x53438d(0x23f)),console[_0x53438d(0x286)](_0x53438d(0x23d)),console[_0x53438d(0x286)](_0x4fb00c),console[_0x53438d(0x286)](_0x53438d(0x254),_0x4fb00c[_0x53438d(0x247)]);try{const {key:_0x346caf,iv:_0x8d6072}=this[_0x53438d(0x170)]();console['log'](_0x53438d(0x221)),console['log'](_0x53438d(0x1e8),_0x346caf['length']),console[_0x53438d(0x286)]('🔐\x20AES\x20IV\x20length:',_0x8d6072['length']);const _0x451d50=this[_0x53438d(0x201)](_0x4fb00c,_0x346caf,_0x8d6072);console[_0x53438d(0x286)](_0x53438d(0x18a)),console[_0x53438d(0x286)](_0x53438d(0x1b6),_0x451d50[_0x53438d(0x247)]);const _0x401ce=this['encryptRSA'](_0x346caf,_0x8d6072,_0x30ab1d[_0x53438d(0x1d2)]);console[_0x53438d(0x286)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x53438d(0x286)]('📝\x20Encrypted\x20key\x20length:',_0x401ce[_0x53438d(0x247)]);const _0x2f09b3=this[_0x53438d(0x238)](_0x4fb00c,_0x30ab1d[_0x53438d(0x1c4)]);console[_0x53438d(0x286)]('🔐\x20Data\x20signed\x20with\x20RSA'),console['log'](_0x53438d(0x189),_0x2f09b3[_0x53438d(0x247)]);const _0xd551d5={'merchant_point_id':_0x30ab1d[_0x53438d(0x165)],'method':'charge','info':_0x451d50,'key':_0x401ce,'sign':_0x2f09b3,'lang':'en'};console['log']('📤\x20Sending\x20request\x20to\x20API...'),console[_0x53438d(0x286)](_0x53438d(0x1b4)),console[_0x53438d(0x286)](_0x53438d(0x196),_0x30ab1d['merchantPointId']),console[_0x53438d(0x286)](_0x53438d(0x27f)),console[_0x53438d(0x286)]('\x20\x20\x20-\x20info\x20length:',_0x451d50[_0x53438d(0x247)]),console[_0x53438d(0x286)](_0x53438d(0x215),_0x401ce[_0x53438d(0x247)]),console[_0x53438d(0x286)](_0x53438d(0x23b),_0x2f09b3[_0x53438d(0x247)]),console[_0x53438d(0x286)]('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x53438d(0x26e)][_0x53438d(0x1ea)](_0x30ab1d[_0x53438d(0x279)][_0x53438d(0x239)](),_0x53438d(0x20c),'POST',{'merchant_point_id':_0x30ab1d[_0x53438d(0x165)],'method':_0x53438d(0x1e0),'lang':'en'});const _0x4434ae=Date[_0x53438d(0x178)](),_0x2c540b=await fetch(_0x30ab1d[_0x53438d(0x173)],{'method':_0x53438d(0x25e),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x53438d(0x24f)},'body':JSON[_0x53438d(0x205)](_0xd551d5)}),_0x4c2f6f=Date[_0x53438d(0x178)]()-_0x4434ae;console[_0x53438d(0x286)](_0x53438d(0x277)),console['log']('Status:',_0x2c540b[_0x53438d(0x25b)]),console[_0x53438d(0x286)](_0x53438d(0x185),_0x4c2f6f+'ms');if(!_0x2c540b['ok']){const _0x3fbef1=await _0x2c540b[_0x53438d(0x267)]();console[_0x53438d(0x1ef)]('HTTP\x20Status:',_0x2c540b[_0x53438d(0x25b)]),console[_0x53438d(0x1ef)](_0x53438d(0x26f),_0x3fbef1),loggerService_1[_0x53438d(0x26e)]['logWhiteDomainResponse'](_0x30ab1d[_0x53438d(0x279)][_0x53438d(0x239)](),_0x53438d(0x1f6),_0x2c540b[_0x53438d(0x25b)],_0x3fbef1,_0x4c2f6f),loggerService_1['loggerService']['logWhiteDomainError'](_0x30ab1d[_0x53438d(0x279)][_0x53438d(0x239)](),_0x53438d(0x20c),_0x53438d(0x1ba)+_0x2c540b[_0x53438d(0x25b)]+':\x20'+_0x3fbef1);throw new Error(_0x53438d(0x275)+_0x2c540b[_0x53438d(0x25b)]+_0x53438d(0x1f3)+_0x3fbef1);}const _0x3de88d=await _0x2c540b[_0x53438d(0x187)]();loggerService_1[_0x53438d(0x26e)][_0x53438d(0x1dc)](_0x30ab1d[_0x53438d(0x279)][_0x53438d(0x239)](),'/charge_raw',_0x2c540b[_0x53438d(0x25b)],_0x3de88d,_0x4c2f6f),console[_0x53438d(0x286)](_0x53438d(0x244));let _0x5871a8=_0x3de88d;if(_0x3de88d[_0x53438d(0x251)]&&_0x3de88d['key']&&_0x3de88d['sign']){console['log'](_0x53438d(0x17f));try{const _0x4722be=await this[_0x53438d(0x17b)](_0x3de88d['info'],_0x3de88d[_0x53438d(0x16c)],_0x30ab1d[_0x53438d(0x279)]);_0x5871a8=JSON[_0x53438d(0x1ae)](_0x4722be),console[_0x53438d(0x286)]('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x30ab1d[_0x53438d(0x279)][_0x53438d(0x239)](),_0x53438d(0x20d),_0x2c540b[_0x53438d(0x25b)],_0x5871a8,_0x4c2f6f),console['log'](_0x53438d(0x20f));}catch(_0x6ccc39){console[_0x53438d(0x1ef)](_0x53438d(0x17c),_0x6ccc39),loggerService_1[_0x53438d(0x26e)][_0x53438d(0x198)](_0x30ab1d['cardType'][_0x53438d(0x239)](),_0x53438d(0x225),_0x53438d(0x223)+_0x6ccc39),_0x5871a8=_0x3de88d;}}else loggerService_1[_0x53438d(0x26e)][_0x53438d(0x1dc)](_0x30ab1d[_0x53438d(0x279)][_0x53438d(0x239)](),_0x53438d(0x20d),_0x2c540b['status'],_0x5871a8,_0x4c2f6f),console[_0x53438d(0x286)](_0x53438d(0x190));console[_0x53438d(0x286)](_0x53438d(0x240),_0x5871a8[_0x53438d(0x25b)]),console['log']('Final:',_0x5871a8['final']),console[_0x53438d(0x286)](_0x53438d(0x234),_0x5871a8[_0x53438d(0x19d)]),console[_0x53438d(0x286)](_0x53438d(0x1c8),_0x5871a8[_0x53438d(0x227)]||_0x53438d(0x1c1));if(_0x5871a8['status']===0x64&&_0x5871a8[_0x53438d(0x1b0)]===0x1)return console[_0x53438d(0x286)](_0x53438d(0x16d)),{'gateway_payment_id':_0x5871a8['payment_id']?.[_0x53438d(0x1bd)](),'payment_url':_0x13e4f2,'requires_3ds':![],'status':_0x53438d(0x1cf),'final':!![]};if(_0x5871a8[_0x53438d(0x227)])return console[_0x53438d(0x286)](_0x53438d(0x1db)),this[_0x53438d(0x243)](_0x450d74,_0xe02349,_0x5871a8['payment_id']?.['toString']()||_0xe02349,_0x30ab1d[_0x53438d(0x279)]),{'gateway_payment_id':_0x5871a8[_0x53438d(0x19d)]?.[_0x53438d(0x1bd)](),'payment_url':_0x5871a8[_0x53438d(0x227)],'requires_3ds':!![],'threeds_url':_0x5871a8[_0x53438d(0x227)],'status':_0x53438d(0x1a7),'final':![]};let _0xa2a9a2=_0x5871a8[_0x53438d(0x200)]||_0x5871a8[_0x53438d(0x1b5)]||'Unknown\x20error',_0xf8bf1f=_0x5871a8['status'],_0x1391a4=_0x5871a8[_0x53438d(0x1b0)];return console[_0x53438d(0x286)](_0x53438d(0x1c0)+_0xf8bf1f+',\x20Final:\x20'+_0x1391a4+_0x53438d(0x1bf)+_0xa2a9a2),{'gateway_payment_id':_0x5871a8[_0x53438d(0x19d)]?.[_0x53438d(0x1bd)](),'payment_url':_0x13e4f2,'requires_3ds':![],'status':'FAILED','final':!![]};}catch(_0x5a24c0){console[_0x53438d(0x1ef)]('===\x20PAYMENT\x20SERVICE\x20ERROR\x20==='),console['error']('Error\x20details:',_0x5a24c0),loggerService_1[_0x53438d(0x26e)]['logWhiteDomainError'](_0x53438d(0x1fb),'/charge',_0x5a24c0);throw new Error('Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'+(_0x5a24c0 instanceof Error?_0x5a24c0[_0x53438d(0x1b5)]:_0x53438d(0x228)));}}async[a48_0x3017bd(0x230)](_0x5cb4da,_0x267339,_0x395e9a='VISA'){const _0x42d916=a48_0x3017bd;console[_0x42d916(0x286)]('📊\x20Checking\x20'+_0x395e9a+_0x42d916(0x194)+_0x5cb4da+'\x20('+_0x267339+')');try{const _0x2adcad={'payment_id':_0x5cb4da,'order_id':_0x267339},_0x2684ae=JSON[_0x42d916(0x205)](_0x2adcad),_0x24980a=this[_0x42d916(0x1dd)](_0x395e9a===_0x42d916(0x1d8)?_0x42d916(0x1e4):'5000000000000000'),{key:_0x147a3a,iv:_0x218bbc}=this['generateAESKey'](),_0x2f7e64=this['encryptAES'](_0x2684ae,_0x147a3a,_0x218bbc),_0x1fe29b=this[_0x42d916(0x264)](_0x147a3a,_0x218bbc,_0x24980a[_0x42d916(0x1d2)]),_0x21a5fe=this['signRSA'](_0x2684ae,_0x24980a['privateKeyPath']),_0x455b0f={'merchant_point_id':_0x24980a['merchantPointId'],'method':'status','info':_0x2f7e64,'key':_0x1fe29b,'sign':_0x21a5fe,'lang':'en'};loggerService_1['loggerService'][_0x42d916(0x1ea)](_0x395e9a[_0x42d916(0x239)](),'/status',_0x42d916(0x25e),{'merchant_point_id':_0x24980a['merchantPointId'],'method':'status','lang':'en'});const _0x2c7dc2=Date[_0x42d916(0x178)](),_0x1b932e=await fetch(_0x24980a[_0x42d916(0x173)],{'method':_0x42d916(0x25e),'headers':{'Content-Type':_0x42d916(0x210),'Accept':_0x42d916(0x210),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x42d916(0x205)](_0x455b0f)}),_0x2f7193=Date[_0x42d916(0x178)]()-_0x2c7dc2;if(!_0x1b932e['ok']){const _0x57454d=await _0x1b932e[_0x42d916(0x267)]();loggerService_1[_0x42d916(0x26e)]['logWhiteDomainResponse'](_0x395e9a[_0x42d916(0x239)](),_0x42d916(0x27d),_0x1b932e[_0x42d916(0x25b)],_0x57454d,_0x2f7193);throw new Error(_0x42d916(0x275)+_0x1b932e[_0x42d916(0x25b)]);}const _0x580308=await _0x1b932e[_0x42d916(0x187)]();loggerService_1['loggerService'][_0x42d916(0x1dc)](_0x395e9a[_0x42d916(0x239)](),_0x42d916(0x27d),_0x1b932e[_0x42d916(0x25b)],_0x580308,_0x2f7193);let _0x169ef5=_0x580308;if(_0x580308['info']&&_0x580308[_0x42d916(0x16c)]&&_0x580308[_0x42d916(0x226)]){console[_0x42d916(0x286)](_0x42d916(0x19c));try{const _0x5a3485=await this[_0x42d916(0x17b)](_0x580308[_0x42d916(0x251)],_0x580308['key'],_0x395e9a);_0x169ef5=JSON['parse'](_0x5a3485),console[_0x42d916(0x286)]('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x42d916(0x26e)]['logWhiteDomainResponse'](_0x395e9a[_0x42d916(0x239)](),_0x42d916(0x1ed),_0x1b932e[_0x42d916(0x25b)],_0x169ef5,_0x2f7193),console[_0x42d916(0x286)](_0x42d916(0x16a));}catch(_0x8150d8){console[_0x42d916(0x1ef)](_0x42d916(0x218),_0x8150d8),loggerService_1['loggerService'][_0x42d916(0x198)](_0x395e9a[_0x42d916(0x239)](),_0x42d916(0x273),_0x42d916(0x1ab)+_0x8150d8),_0x169ef5=_0x580308;}}else loggerService_1['loggerService'][_0x42d916(0x1dc)](_0x395e9a[_0x42d916(0x239)](),'/status_decrypted',_0x1b932e['status'],_0x169ef5,_0x2f7193),console[_0x42d916(0x286)]('📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');console[_0x42d916(0x286)]('📊\x20Status\x20check\x20result:',{'status':_0x169ef5[_0x42d916(0x25b)],'final':_0x169ef5['final'],'payment_id':_0x169ef5[_0x42d916(0x19d)],'desc':_0x169ef5[_0x42d916(0x200)]});let _0xd5e8da=_0x42d916(0x1a7);if(_0x169ef5[_0x42d916(0x25b)]===0x64&&_0x169ef5[_0x42d916(0x1b0)]===0x1)_0xd5e8da=_0x42d916(0x1cf);else{if(_0x169ef5[_0x42d916(0x1b0)]===0x0)_0xd5e8da=_0x42d916(0x1a7);else _0x169ef5[_0x42d916(0x1b0)]===0x1&&_0x169ef5[_0x42d916(0x25b)]!==0x64?_0xd5e8da='FAILED':_0xd5e8da='PENDING';}return{'status':_0xd5e8da,'final':_0x169ef5[_0x42d916(0x1b0)]===0x1,'amount':_0x169ef5[_0x42d916(0x284)],'currency':_0x169ef5[_0x42d916(0x180)],'date_success':_0x169ef5[_0x42d916(0x1d9)],'description':_0x169ef5[_0x42d916(0x200)]};}catch(_0x1c8f13){console[_0x42d916(0x1ef)](_0x395e9a+_0x42d916(0x278),_0x1c8f13),loggerService_1[_0x42d916(0x26e)]['logWhiteDomainError'](_0x395e9a[_0x42d916(0x239)](),_0x42d916(0x176),_0x1c8f13);throw new Error(_0x42d916(0x1a9)+_0x395e9a+_0x42d916(0x194)+(_0x1c8f13 instanceof Error?_0x1c8f13[_0x42d916(0x1b5)]:_0x42d916(0x228)));}}[a48_0x3017bd(0x243)](_0x426f19,_0x1e4a73,_0x468965,_0x1aa038){const _0x5f2d43=a48_0x3017bd;console[_0x5f2d43(0x286)](_0x5f2d43(0x257)+_0x1aa038+_0x5f2d43(0x16b)+_0x426f19+'\x20('+_0x468965+')'),this[_0x5f2d43(0x1ca)](_0x426f19);const _0x4f7ac9=[],_0xa6eeb0=0x5*0x3c*0x3e8,_0x19a1a2=0x2*0x3c*0x3c*0x3e8,_0x348cf9=Math[_0x5f2d43(0x204)](_0x19a1a2/_0xa6eeb0);console[_0x5f2d43(0x286)](_0x5f2d43(0x246)+_0x348cf9+_0x5f2d43(0x262));for(let _0x377fff=0x1;_0x377fff<=_0x348cf9;_0x377fff++){const _0x28d7f7=setTimeout(async()=>{const _0x49cd21=_0x5f2d43;console[_0x49cd21(0x286)](_0x49cd21(0x1f7)+_0x1aa038+_0x49cd21(0x220)+_0x377fff+'/'+_0x348cf9+_0x49cd21(0x282)+_0x426f19);try{const _0x32e29b=await this[_0x49cd21(0x230)](_0x468965,_0x1e4a73,_0x1aa038);console['log'](_0x49cd21(0x1a2)+_0x377fff+_0x49cd21(0x26c),_0x32e29b),_0x32e29b['final']&&(console['log'](_0x49cd21(0x22d)+_0x426f19+_0x49cd21(0x265)+_0x32e29b[_0x49cd21(0x25b)]+'),\x20stopping\x20status\x20checks'),this[_0x49cd21(0x1ca)](_0x426f19),await this[_0x49cd21(0x1df)](_0x426f19,_0x32e29b[_0x49cd21(0x25b)],_0x32e29b));}catch(_0xedc1d2){console[_0x49cd21(0x1ef)](_0x49cd21(0x21d)+_0x377fff+'\x20failed\x20for\x20payment\x20'+_0x426f19+':',_0xedc1d2);}},_0x377fff*_0xa6eeb0);_0x4f7ac9['push'](_0x28d7f7);}this['statusCheckTimers'][_0x5f2d43(0x27c)](_0x426f19,_0x4f7ac9),console[_0x5f2d43(0x286)]('✅\x20Scheduled\x20'+_0x348cf9+_0x5f2d43(0x252)+_0x426f19);}[a48_0x3017bd(0x1ca)](_0x29891b){const _0x54933e=a48_0x3017bd,_0x545462=this[_0x54933e(0x236)][_0x54933e(0x179)](_0x29891b);_0x545462&&(console[_0x54933e(0x286)](_0x54933e(0x19b)+_0x545462['length']+_0x54933e(0x231)+_0x29891b),_0x545462[_0x54933e(0x1e7)]((_0x5a914b,_0x1244e6)=>{clearTimeout(_0x5a914b);}),this['statusCheckTimers'][_0x54933e(0x1b8)](_0x29891b));}async['updatePaymentStatus'](_0x56301b,_0x39b46e,_0x1d0ba1){const _0x5e9b0d=a48_0x3017bd;try{const _0x86b6a8=(await Promise[_0x5e9b0d(0x20a)]()[_0x5e9b0d(0x232)](()=>__importStar(require(_0x5e9b0d(0x285)))))[_0x5e9b0d(0x24d)],_0x522183={'status':_0x39b46e['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x5e9b0d(0x217),'statusChangedAt':new Date()};_0x39b46e==='PAID'&&(_0x522183[_0x5e9b0d(0x1b7)]=new Date()),_0x39b46e===_0x5e9b0d(0x1c5)&&_0x1d0ba1['description']&&(_0x522183[_0x5e9b0d(0x28a)]=_0x1d0ba1[_0x5e9b0d(0x1f1)],console[_0x5e9b0d(0x286)]('💾\x20Saving\x20failure\x20message:\x20'+_0x1d0ba1['description'])),_0x1d0ba1[_0x5e9b0d(0x1f1)]&&(_0x522183['adminNotes']=(_0x39b46e===_0x5e9b0d(0x1cf)?_0x5e9b0d(0x1f9):_0x5e9b0d(0x1ee))+':\x20'+_0x1d0ba1['description']),await _0x86b6a8[_0x5e9b0d(0x26a)]['update']({'where':{'id':_0x56301b},'data':_0x522183}),console[_0x5e9b0d(0x286)](_0x5e9b0d(0x22d)+_0x56301b+_0x5e9b0d(0x28b)+_0x39b46e),await this[_0x5e9b0d(0x27a)](_0x56301b,_0x39b46e);}catch(_0x9467e2){console[_0x5e9b0d(0x1ef)](_0x5e9b0d(0x235)+_0x56301b+':',_0x9467e2);}}async[a48_0x3017bd(0x27a)](_0x1046d8,_0x524ae9){const _0x52cc9c=a48_0x3017bd;try{const _0x156eae=(await Promise[_0x52cc9c(0x20a)]()[_0x52cc9c(0x232)](()=>__importStar(require('../../config/database'))))[_0x52cc9c(0x24d)],{telegramBotService:_0x23453f}=await Promise['resolve']()[_0x52cc9c(0x232)](()=>__importStar(require(_0x52cc9c(0x1a6)))),_0x2b1d76=await _0x156eae[_0x52cc9c(0x26a)]['findUnique']({'where':{'id':_0x1046d8},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x2b1d76)return;const _0x31dbdc={'PAID':_0x52cc9c(0x175),'FAILED':'failed'},_0x46ef0f=_0x31dbdc[_0x524ae9];_0x46ef0f&&await _0x23453f[_0x52cc9c(0x1c3)](_0x2b1d76['shopId'],_0x2b1d76,_0x46ef0f),await this['sendShopWebhook'](_0x2b1d76,_0x524ae9);}catch(_0x49d3fe){console['error'](_0x52cc9c(0x1f0),_0x49d3fe);}}async['sendShopWebhook'](_0x2bccf4,_0x358649){const _0x273421=a48_0x3017bd,_0xad64f1=Date[_0x273421(0x178)]();try{const _0x2c2958=_0x2bccf4[_0x273421(0x182)],_0x17ee18=_0x2c2958[_0x273421(0x242)];if(!_0x17ee18?.['webhookUrl']){console[_0x273421(0x286)](_0x273421(0x1a8)+_0x2c2958['id']);return;}const _0x6bcc9f=_0x358649===_0x273421(0x1cf)?_0x273421(0x20e):_0x273421(0x19f);let _0x2e8a25=[];if(_0x17ee18[_0x273421(0x1d0)])try{_0x2e8a25=Array[_0x273421(0x1e5)](_0x17ee18['webhookEvents'])?_0x17ee18[_0x273421(0x1d0)]:JSON[_0x273421(0x1ae)](_0x17ee18[_0x273421(0x1d0)]);}catch(_0x1c9de8){console[_0x273421(0x1ef)](_0x273421(0x269),_0x1c9de8),_0x2e8a25=[];}if(!_0x2e8a25[_0x273421(0x263)](_0x6bcc9f)){console['log'](_0x273421(0x1bb)+_0x6bcc9f+_0x273421(0x1d3)+_0x2c2958['id']);return;}const _0x141ad9={'event':_0x6bcc9f,'payment':{'id':_0x2bccf4['id'],'order_id':_0x2bccf4['orderId'],'gateway_order_id':_0x2bccf4[_0x273421(0x172)],'gateway':_0x273421(0x23c),'amount':_0x2bccf4[_0x273421(0x284)],'currency':_0x2bccf4[_0x273421(0x180)],'status':_0x358649[_0x273421(0x239)](),'customer_email':_0x2bccf4[_0x273421(0x27b)],'customer_name':_0x2bccf4[_0x273421(0x1e1)],'created_at':_0x2bccf4[_0x273421(0x24e)],'updated_at':new Date()}},_0x274509=await fetch(_0x17ee18[_0x273421(0x1b2)],{'method':'POST','headers':{'Content-Type':_0x273421(0x210),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(MasterCard)'},'body':JSON[_0x273421(0x205)](_0x141ad9)}),_0x30b60d=Date[_0x273421(0x178)]()-_0xad64f1;loggerService_1['loggerService']['logShopWebhookSent'](_0x2bccf4[_0x273421(0x181)],_0x17ee18['webhookUrl'],_0x6bcc9f,_0x274509['status'],_0x30b60d,_0x141ad9),console[_0x273421(0x286)](_0x273421(0x25f)+_0x17ee18[_0x273421(0x1b2)]+_0x273421(0x255)+_0x274509[_0x273421(0x25b)]+'\x20('+_0x30b60d+_0x273421(0x24b));}catch(_0x7392fe){console[_0x273421(0x1ef)](_0x273421(0x1d5),_0x7392fe),loggerService_1[_0x273421(0x26e)]['logShopWebhookError'](_0x2bccf4['shopId'],_0x2bccf4['shop']?.[_0x273421(0x242)]?.[_0x273421(0x1b2)]||_0x273421(0x166),_0x273421(0x1c9),_0x7392fe,{});}}[a48_0x3017bd(0x1a4)](_0x42f455){const _0x4b93d8=a48_0x3017bd,_0x4e0c53=_0x42f455[_0x4b93d8(0x211)](/[\s-]/g,'');if(_0x4e0c53[_0x4b93d8(0x247)]<0x4)return _0x4b93d8(0x18d);return _0x4b93d8(0x1d6)+_0x4e0c53[_0x4b93d8(0x21c)](-0x4);}async[a48_0x3017bd(0x1d1)](_0x24acc3,_0x5e54e8=a48_0x3017bd(0x177)){const _0x15b12f=a48_0x3017bd;console[_0x15b12f(0x286)](_0x15b12f(0x274),JSON[_0x15b12f(0x205)](_0x24acc3,null,0x2));let _0x42b10e=_0x24acc3,_0x5ecdee=_0x5e54e8;_0x24acc3[_0x15b12f(0x1cd)]?(_0x5ecdee=_0x24acc3[_0x15b12f(0x1cd)][_0x15b12f(0x26d)]()==='VISA'?_0x15b12f(0x1d8):_0x15b12f(0x177),console[_0x15b12f(0x286)]('🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20'+_0x5ecdee)):console['log']('🔍\x20Using\x20provided\x20card\x20type:\x20'+_0x5ecdee);if(_0x24acc3[_0x15b12f(0x251)]&&_0x24acc3[_0x15b12f(0x16c)]&&_0x24acc3[_0x15b12f(0x226)]){console[_0x15b12f(0x286)](_0x15b12f(0x1e3));try{const _0x561039=await this[_0x15b12f(0x17b)](_0x24acc3[_0x15b12f(0x251)],_0x24acc3['key'],_0x5ecdee);_0x42b10e=JSON[_0x15b12f(0x1ae)](_0x561039),console['log'](_0x15b12f(0x18f)),console[_0x15b12f(0x286)](_0x15b12f(0x19a),JSON[_0x15b12f(0x205)](_0x42b10e,null,0x2));}catch(_0x504e32){console[_0x15b12f(0x1ef)]('❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:',_0x504e32),console[_0x15b12f(0x286)](_0x15b12f(0x209)),_0x42b10e=_0x24acc3;}}else console[_0x15b12f(0x286)](_0x15b12f(0x1ec));let _0x319947='PENDING';if(_0x42b10e[_0x15b12f(0x25b)]===0x64&&_0x42b10e['final']===0x1)_0x319947=_0x15b12f(0x1cf);else{if(_0x42b10e[_0x15b12f(0x1b0)]===0x0)_0x319947=_0x15b12f(0x1a7);else _0x42b10e['final']===0x1&&_0x42b10e[_0x15b12f(0x25b)]!==0x64?_0x319947='FAILED':_0x319947=_0x15b12f(0x1a7);}let _0x531263='';if(_0x42b10e[_0x15b12f(0x287)])_0x531263=_0x42b10e['order_id'][_0x15b12f(0x1bd)](),console[_0x15b12f(0x286)](_0x15b12f(0x1b1)+_0x5ecdee+_0x15b12f(0x288)+_0x531263);else _0x42b10e[_0x15b12f(0x19d)]?(_0x531263=_0x42b10e[_0x15b12f(0x19d)][_0x15b12f(0x1bd)](),console[_0x15b12f(0x286)](_0x15b12f(0x1b1)+_0x5ecdee+_0x15b12f(0x219)+_0x531263)):(_0x531263=_0x42b10e[_0x15b12f(0x1e6)]||_0x42b10e['paymentId']||_0x42b10e['id']||'',console[_0x15b12f(0x286)](_0x15b12f(0x191)+_0x531263));console[_0x15b12f(0x286)](_0x15b12f(0x1f5)+_0x5ecdee+'\x20webhook\x20extracted\x20data:'),console[_0x15b12f(0x286)](_0x15b12f(0x208)+_0x531263+'\x20(from:\x20order_id='+_0x42b10e['order_id']+_0x15b12f(0x1f4)+_0x42b10e[_0x15b12f(0x1e6)]+_0x15b12f(0x197)+_0x42b10e[_0x15b12f(0x19d)]+',\x20paymentId='+_0x42b10e[_0x15b12f(0x256)]+_0x15b12f(0x21b)+_0x42b10e['id']+')'),console[_0x15b12f(0x286)](_0x15b12f(0x22f)+_0x319947+'\x20(from:\x20status='+_0x42b10e['status']+_0x15b12f(0x1cc)+_0x42b10e['final']+')'),console[_0x15b12f(0x286)](_0x15b12f(0x1ac)+_0x42b10e[_0x15b12f(0x284)]),console[_0x15b12f(0x286)]('\x20\x20\x20Currency:\x20'+_0x42b10e[_0x15b12f(0x180)]);let _0xad524d;_0x319947===_0x15b12f(0x1c5)&&_0x42b10e['desc']&&(_0xad524d=_0x42b10e['desc'],console[_0x15b12f(0x286)](_0x15b12f(0x280)+_0xad524d));const _0x145ccc={'paymentId':_0x531263,'status':_0x319947,'amount':_0x42b10e[_0x15b12f(0x284)],'currency':_0x42b10e[_0x15b12f(0x180)]};return _0xad524d&&(_0x145ccc['failureMessage']=_0xad524d),_0x145ccc;}[a48_0x3017bd(0x25d)](){const _0x4a99f1=a48_0x3017bd;console[_0x4a99f1(0x286)]('🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...');const _0x447871=this[_0x4a99f1(0x236)]['size'];for(const [_0x1d23c6]of this[_0x4a99f1(0x236)]){this['clearStatusTimers'](_0x1d23c6);}console[_0x4a99f1(0x286)]('🛑\x20Stopped\x20'+_0x447871+_0x4a99f1(0x1b3));}}exports[a48_0x3017bd(0x22a)]=VisaMasterCardService;