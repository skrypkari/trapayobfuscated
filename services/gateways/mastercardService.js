'use strict';const a68_0x1ca0c9=a68_0x4543;(function(_0x21b086,_0x248ef1){const _0x476ebd=a68_0x4543,_0x58d4e9=_0x21b086();while(!![]){try{const _0x436432=parseInt(_0x476ebd(0x157))/0x1*(-parseInt(_0x476ebd(0x163))/0x2)+-parseInt(_0x476ebd(0x100))/0x3*(-parseInt(_0x476ebd(0xfc))/0x4)+-parseInt(_0x476ebd(0xff))/0x5*(parseInt(_0x476ebd(0xbd))/0x6)+-parseInt(_0x476ebd(0x1cf))/0x7+-parseInt(_0x476ebd(0xd3))/0x8*(parseInt(_0x476ebd(0x186))/0x9)+parseInt(_0x476ebd(0x156))/0xa+-parseInt(_0x476ebd(0x165))/0xb*(-parseInt(_0x476ebd(0x161))/0xc);if(_0x436432===_0x248ef1)break;else _0x58d4e9['push'](_0x58d4e9['shift']());}catch(_0x1c9a25){_0x58d4e9['push'](_0x58d4e9['shift']());}}}(a68_0x311b,0xc78fd));function a68_0x311b(){const _0x2d6cd0=['\x20\x20Cleaned:\x20\x20\x22','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','üîç\x20Using\x20','publicKeyPath','default',',\x20body:\x20','checkPaymentStatus','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','PIN\x20code\x20confirmation\x20awaited','visaPublicKeyPath','üìä\x20Checking\x20','privateKeyPath','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','üîê\x20MasterCard\x20API\x20URL:','application/json','unknown','push','visaPrivateKeyPath','üìù\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','üîê\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','üîê\x20AES\x20key\x20and\x20IV\x20generated','üìä\x20Status\x20check\x20#','\x20\x20\x20-\x20key\x20length:','Cash\x20payment\x20is\x20expected\x20at\x20TCO','Payment\x20returned','\x20status\x20timers\x20for\x20payment\x20','logWhiteDomainError','4000000000000000','‚úÖ\x20Payment\x20successful','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','),\x20stopping\x20status\x20checks','createCipheriv','currency','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','Sender\x27s\x20CVV\x20card\x20is\x20required','‚ö†Ô∏è\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','3ds_url','üîê\x20MasterCard\x20Public\x20key\x20length:\x20','Failed\x20to\x20send\x20MasterCard\x20webhook:',',\x20final=','Final:','toString','card_type','Client\x20OTP\x20confirmation\x20required','create','Failed\x20payment','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','Error\x20parsing\x20webhook\x20events:','updatePaymentStatus','Cancellation\x20is\x20not\x20possible','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','üîê\x20AES\x20IV\x20length:','getDetailedErrorMessage','scheduleStatusChecks','first_name','üí≥\x20VISA/MasterCard\x20service\x20initialized','charge','üì¶\x20FULL\x20RESPONSE\x20BODY:','hasOwnProperty','../loggerService','payment','6IJzomM','‚è∞\x20Scheduling\x20status\x20checks\x20for\x20','üíæ\x20Payment\x20data\x20prepared','../../config/database','\x20\x20\x20-\x20method:\x20charge','getOwnPropertyNames','secretKey',',\x20paymentId=','path','webhookUrl','sign','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','country','üîê\x20MasterCard\x20Public\x20key\x20path:','‚úÖ\x20MasterCard\x20key\x20files\x20validated\x20successfully','\x20webhook\x20extracted\x20data:','\x20failed\x20for\x20payment\x20','readFileSync','length','https://api2.trapay.uk/decrypt.php','visa/mastercard','cvv','24xYBcDw','paymentStatuses','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','3DS\x20URL:','includes','PAID','settings','createdAt','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','Payment\x20confirmation\x20required','paymentId','üìù\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','\x20status\x20check\x20#',',\x20Desc:\x20','Status\x20decryption\x20failed:\x20','Sender\x20information\x20required','psp_public.pem','maskCardNumber','expire_year','__createBinding','Response\x20Headers:','sendPaymentNotifications','‚ùå\x20Failed\x20to\x20decrypt\x20status\x20response:','stringify','3DS\x20verification\x20required','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','errorMessage','LookUp\x20number\x20of\x20attempts\x20exceeded','shop','toUpperCase','isFinalStatus','customerName','üì¶\x20FULL\x20RESPONSE\x20JSON:','masterCardMerchantPointId','üßπ\x20Card\x20holder\x20names\x20cleaned:','\x20order_id\x20for\x20search:\x20','‚ö†Ô∏è\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','‚ùå\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','1111','üîê\x20VISA\x20API\x20URL:','charAt','964QtdOlX','/charge','createSign','6341050goVnzD','13965UIJPet','payment.failed','logWhiteDomainResponse','\x20\x20\x20Currency:\x20','desc','cwd','join','/status_raw','configurable','base64','floor','writable','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','payment.success','‚ùå\x20Data\x20being\x20signed:','log','encryptAES','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','Order\x20ID:','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','Recipient\x20data\x20required','warn',',\x20Final:\x20','decryptResponsePhp','Unknown\x20error','randomBytes','POST','now','‚úÖ\x20Status\x20response\x20decrypted\x20successfully','defineProperty','../telegramBotService','digest','\x20for\x20payment\x20','üîê\x20VISA\x20Private\x20key\x20length:\x20','utf8','Payment\x20System/1.0','FAILED','crypto','****\x20****\x20****\x20','===\x20API\x20RESPONSE\x20===','‚úÖ\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','/charge_raw','RSA_PKCS1_PADDING','‚è∞\x20Will\x20check\x20status\x20','üéØ\x20Using\x20','decryptAES','get','Invalid\x20expiration\x20date','üìù\x20Decrypted\x20webhook\x20data:','Payment\x20pending\x20verification','error','LookUp\x20code\x20verified','‚úÖ\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','logWhiteDomainRequest','visaApiUrl','info','replace','\x20characters','/charge_decrypt','logShopWebhookError','üìä\x20Status\x20check\x20result:','Status\x20Text:','description','üìù\x20Encrypted\x20key\x20length:','Failed\x20to\x20send\x20payment\x20notifications:','üßπ\x20Clearing\x20','status','final','merchantPointId','getCardTypeAndApi','cardType','aes-256-ctr','Sender\x27s\x20card\x20details\x20are\x20required','The\x20card\x20does\x20not\x20exist','statusText','5000000000000000','Payment\x20ID:','‚ùå\x20PHP\x20decryptor\x20request\x20failed:','\x20\x20\x20Status:\x20','VisaMasterCardService','üõë\x20Stopped\x20','üîÑ\x20Processing\x20MasterCard\x20webhook\x20data:','slice','from','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','üìù\x20Final\x20request\x20structure:','10132500aApMPN','6wmPpoZ','****','key','üîê\x20Response\x20is\x20encrypted,\x20decrypting...','publicEncrypt','Unsuccessful\x20payment','stopAllStatusChecks','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','constants','LookUp\x20code\x20sent','864jYVBDg','Test\x20payment','76106tkuPha','set','293689DboQoV','Operation\x20completed\x20successfully','getOwnPropertyDescriptor','signRSA','Webhook\x20event\x20','message','===\x20PARSED\x20API\x20RESPONSE\x20===','validateKeyFiles','decryptResponse','Result\x20URL:','existsSync','hex','isArray','üìù\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','/status','end','Failed\x20to\x20check\x20','__esModule','üîç\x20Using\x20provided\x20card\x20type:\x20','\x20payment_id\x20for\x20search:\x20','Payment\x20confirmation\x20time\x20has\x20expired','üìù\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','üîê\x20VISA\x20Public\x20key\x20path:','Status\x20','json','üìù\x20Data\x20length:','MasterCard\x20webhook\x20sent\x20to\x20','‚ö†Ô∏è\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','Expected\x20bitcoin\x20transfer\x20from\x20client','number','üìù\x20Signature\x20length:','statusCheckTimers','Awaiting\x20confirmation\x20in\x20the\x20application','4467897aDxKWF','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','parse','/charge_decrypted','date_success','‚úÖ\x20Scheduled\x20','privateDecrypt','delete','Captcha\x20confirmation\x20awaited','‚úÖ\x20Payment\x20','Error\x20details:',',\x20id=','üìç\x20Full\x20card\x20holder\x20data:','No\x20New\x20payment','size','keys','last_name','apiUrl','üîê\x20RSA\x20signing\x20successful','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','\x20status\x20updated\x20to\x20','processWebhook','webhook_send','üìù\x20Encrypted\x20data\x20length:','üîê\x20AES\x20key\x20length:','shopId','\x20\x20\x20-\x20sign\x20length:','\x20(from:\x20order_id=','text','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','üîê\x20Data\x20signed\x20with\x20RSA','trim','masterCardApiUrl','order_id','resolve','\x20(from:\x20status=','VISA','webhookEvents','Status:','üîê\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','/status_decrypted','\x22\x20|\x20\x22','\x20payment\x20status:\x20','amount','üìä\x20',',\x20orderId=','encryptRSA','\x20is\x20final\x20(','üì¶\x20FULL\x20REQUEST\x20JSON:','üîê\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','toLowerCase','generateAESKey','üîê\x20Data\x20encrypted\x20with\x20AES','Card\x20Holder:','üîç\x20Detected\x20card\x20type\x20from\x20webhook:\x20','Return\x20URL:','ms)','PHP\x20decryptor\x20error','https://api.paydmeth.com/api','Payment\x20System/1.0\x20(MasterCard)','orderId','paid','forEach','\x20with\x20status\x20','payment_id','üîÑ\x20Converted\x20postcode\x20to\x20post_code:\x20','Awaiting\x20confirmation\x20by\x20ivr\x20call','then','prototype','update','üîç\x20','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','\x20\x20\x20-\x20lang:\x20en','1779407LQYkJJ','substring','__importDefault','üìù\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','createDecipheriv','HTTP\x20error!\x20status:\x20','\x20\x20\x20','customerEmail','https://api.myatranz.com/api','MASTERCARD','createHmac','PENDING','‚úÖ\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','findUnique','\x20\x20\x20-\x20info\x20length:','post_code','private.pem','loggerService','üîê\x20MasterCard\x20Private\x20key\x20length:\x20','expire_month','Insufficient\x20funds\x20on\x20the\x20card','üíæ\x20Saving\x20failure\x20message:\x20','-----END','-----BEGIN','\x20status\x20check\x20error:','‚ùå\x20RSA\x20signing\x20failed:','clearStatusTimers','system','Number\x20of\x20attempts\x20exceeded','üîê\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','‚úÖ\x20VISA\x20key\x20files\x20validated\x20successfully'];a68_0x311b=function(){return _0x2d6cd0;};return a68_0x311b();}function a68_0x4543(_0x29128c,_0x11ef1c){_0x29128c=_0x29128c-0x76;const _0x311bb9=a68_0x311b();let _0x454333=_0x311bb9[_0x29128c];return _0x454333;}var __createBinding=this&&this[a68_0x1ca0c9(0xe6)]||(Object['create']?function(_0x512d4d,_0x6ee594,_0x2445f1,_0x116cca){const _0x1a20bf=a68_0x1ca0c9;if(_0x116cca===undefined)_0x116cca=_0x2445f1;var _0x5d7e4b=Object[_0x1a20bf(0x167)](_0x6ee594,_0x2445f1);(!_0x5d7e4b||(_0x1a20bf(0x12e)in _0x5d7e4b?!_0x6ee594[_0x1a20bf(0x176)]:_0x5d7e4b[_0x1a20bf(0x10b)]||_0x5d7e4b[_0x1a20bf(0x108)]))&&(_0x5d7e4b={'enumerable':!![],'get':function(){return _0x6ee594[_0x2445f1];}}),Object[_0x1a20bf(0x11d)](_0x512d4d,_0x116cca,_0x5d7e4b);}:function(_0x174c3b,_0x22a52f,_0x70c7b3,_0x52c70c){if(_0x52c70c===undefined)_0x52c70c=_0x70c7b3;_0x174c3b[_0x52c70c]=_0x22a52f[_0x70c7b3];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a68_0x1ca0c9(0xac)]?function(_0x288015,_0x5e0e77){const _0x30c74=a68_0x1ca0c9;Object[_0x30c74(0x11d)](_0x288015,_0x30c74(0x83),{'enumerable':!![],'value':_0x5e0e77});}:function(_0x4e572b,_0x10c3fb){const _0xc439a6=a68_0x1ca0c9;_0x4e572b[_0xc439a6(0x83)]=_0x10c3fb;}),__importStar=this&&this['__importStar']||(function(){var _0x44dee0=function(_0xd0036f){const _0x1f7cde=a68_0x4543;return _0x44dee0=Object[_0x1f7cde(0xc2)]||function(_0x6e67e3){const _0x5ad64e=_0x1f7cde;var _0x4b5c54=[];for(var _0xdb0880 in _0x6e67e3)if(Object[_0x5ad64e(0x1ca)][_0x5ad64e(0xba)]['call'](_0x6e67e3,_0xdb0880))_0x4b5c54[_0x4b5c54[_0x5ad64e(0xcf)]]=_0xdb0880;return _0x4b5c54;},_0x44dee0(_0xd0036f);};return function(_0x38e639){const _0x4d45e4=a68_0x4543;if(_0x38e639&&_0x38e639['__esModule'])return _0x38e639;var _0x20ad09={};if(_0x38e639!=null){for(var _0xf63e00=_0x44dee0(_0x38e639),_0x43afdd=0x0;_0x43afdd<_0xf63e00[_0x4d45e4(0xcf)];_0x43afdd++)if(_0xf63e00[_0x43afdd]!==_0x4d45e4(0x83))__createBinding(_0x20ad09,_0x38e639,_0xf63e00[_0x43afdd]);}return __setModuleDefault(_0x20ad09,_0x38e639),_0x20ad09;};}()),__importDefault=this&&this[a68_0x1ca0c9(0x1d1)]||function(_0x126181){const _0x516968=a68_0x1ca0c9;return _0x126181&&_0x126181[_0x516968(0x176)]?_0x126181:{'default':_0x126181};};Object['defineProperty'](exports,a68_0x1ca0c9(0x176),{'value':!![]}),exports[a68_0x1ca0c9(0x14f)]=void 0x0;const crypto_1=__importDefault(require(a68_0x1ca0c9(0x125))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a68_0x1ca0c9(0xc5))),loggerService_1=require(a68_0x1ca0c9(0xbb));class VisaMasterCardService{constructor(){const _0x4d54d6=a68_0x1ca0c9;this[_0x4d54d6(0x184)]=new Map(),this[_0x4d54d6(0xd4)]={0x0:{'final':![],'description':_0x4d54d6(0x193)},0x1:{'final':![],'description':'No\x20Error\x20executing\x20request'},0x2:{'final':!![],'description':'Request\x20data\x20error'},0x3:{'final':!![],'description':'Another\x20unknown\x20error'},0x4:{'final':!![],'description':_0x4d54d6(0x15c)},0x5:{'final':!![],'description':_0x4d54d6(0xae)},0x6:{'final':!![],'description':_0x4d54d6(0x98)},0x7:{'final':!![],'description':_0x4d54d6(0x162)},0x8:{'final':![],'description':_0x4d54d6(0xab)},0x9:{'final':![],'description':_0x4d54d6(0xeb)},0xa:{'final':![],'description':_0x4d54d6(0xa2)},0xb:{'final':![],'description':_0x4d54d6(0xe2)},0xc:{'final':![],'description':_0x4d54d6(0x114)},0xd:{'final':![],'description':_0x4d54d6(0x10c)},0xe:{'final':![],'description':_0x4d54d6(0x1c8)},0xf:{'final':![],'description':_0x4d54d6(0x88)},0x10:{'final':![],'description':_0x4d54d6(0x18e)},0x11:{'final':![],'description':_0x4d54d6(0xec)},0x12:{'final':![],'description':_0x4d54d6(0x185)},0x13:{'final':![],'description':'Payment\x20is\x20being\x20processed'},0x14:{'final':![],'description':_0x4d54d6(0x86)},0x15:{'final':![],'description':_0x4d54d6(0x181)},0x16:{'final':![],'description':_0x4d54d6(0x131)},0x18:{'final':![],'description':'The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'},0x19:{'final':![],'description':_0x4d54d6(0x111)},0x1a:{'final':!![],'description':_0x4d54d6(0x97)},0x1b:{'final':![],'description':'Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code'},0x1c:{'final':![],'description':_0x4d54d6(0x87)},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':_0x4d54d6(0x15e)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':_0x4d54d6(0x148)},0x24:{'final':!![],'description':_0x4d54d6(0x179)},0x25:{'final':!![],'description':'Payment\x20prohibited'},0x26:{'final':!![],'description':_0x4d54d6(0x199)},0x27:{'final':!![],'description':_0x4d54d6(0x1e3)},0x28:{'final':!![],'description':_0x4d54d6(0x149)},0x29:{'final':!![],'description':'The\x20card\x20is\x20lost\x20or\x20stolen'},0x2a:{'final':!![],'description':_0x4d54d6(0x12f)},0x2b:{'final':!![],'description':'Transaction\x20limit\x20exceeded'},0x2c:{'final':!![],'description':'The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank'},0x2d:{'final':!![],'description':_0x4d54d6(0xad)},0x2e:{'final':!![],'description':_0x4d54d6(0x15c)},0x2f:{'final':!![],'description':_0x4d54d6(0x15c)},0x30:{'final':!![],'description':_0x4d54d6(0x1cd)},0x31:{'final':![],'description':_0x4d54d6(0xdc)},0x32:{'final':!![],'description':'Method\x20not\x20allowed'},0x33:{'final':!![],'description':_0x4d54d6(0xad)},0x34:{'final':!![],'description':_0x4d54d6(0xad)},0x35:{'final':!![],'description':_0x4d54d6(0xad)},0x36:{'final':!![],'description':_0x4d54d6(0xad)},0x37:{'final':!![],'description':_0x4d54d6(0xad)},0x38:{'final':!![],'description':_0x4d54d6(0xb1)},0x39:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank'},0x3a:{'final':![],'description':_0x4d54d6(0x160)},0x3b:{'final':!![],'description':_0x4d54d6(0x133)},0x3c:{'final':!![],'description':_0x4d54d6(0x7c)},0x3d:{'final':!![],'description':_0x4d54d6(0xb2)},0x3e:{'final':!![],'description':'Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID'},0x3f:{'final':!![],'description':_0x4d54d6(0x98)},0x40:{'final':![],'description':'LookUp\x20not\x20confirmed'},0x41:{'final':!![],'description':_0x4d54d6(0xee)},0x42:{'final':![],'description':'Payment\x20cancellation\x20is\x20being\x20processed'},0x43:{'final':!![],'description':_0x4d54d6(0x1a3)},0x44:{'final':![],'description':_0x4d54d6(0xeb)},0x45:{'final':!![],'description':'Failed\x20payment'},0x46:{'final':!![],'description':'Failed\x20payment'},0x47:{'final':!![],'description':_0x4d54d6(0x154)},0x64:{'final':!![],'description':_0x4d54d6(0x166)}},this['masterCardApiUrl']=_0x4d54d6(0x1d7),this[_0x4d54d6(0xf4)]=0x50ca,this[_0x4d54d6(0x8b)]=path_1[_0x4d54d6(0x83)][_0x4d54d6(0x106)](process['cwd'](),_0x4d54d6(0x195),_0x4d54d6(0x1df)),this[_0x4d54d6(0x82)]=path_1[_0x4d54d6(0x83)]['join'](process['cwd'](),'keys',_0x4d54d6(0xe3)),this['visaApiUrl']=_0x4d54d6(0x1c0),this['visaMerchantPointId']=0x6b7,this[_0x4d54d6(0x91)]=path_1['default']['join'](process['cwd'](),'keys','visa_private.pem'),this[_0x4d54d6(0x89)]=path_1[_0x4d54d6(0x83)]['join'](process[_0x4d54d6(0x105)](),_0x4d54d6(0x195),'visa_public.pem'),console['log'](_0x4d54d6(0xb7)),console[_0x4d54d6(0x10f)](_0x4d54d6(0x8d),this[_0x4d54d6(0x1a6)]),console[_0x4d54d6(0x10f)](_0x4d54d6(0xfa),this[_0x4d54d6(0x136)]),console['log']('üîê\x20MasterCard\x20Private\x20key\x20path:',this['privateKeyPath']),console['log'](_0x4d54d6(0xca),this[_0x4d54d6(0x82)]),console['log']('üîê\x20VISA\x20Private\x20key\x20path:',this[_0x4d54d6(0x91)]),console[_0x4d54d6(0x10f)](_0x4d54d6(0x17b),this[_0x4d54d6(0x89)]),this['validateKeyFiles']();}['getDetailedErrorMessage'](_0x29a496,_0x29bd4a){const _0x4be679=a68_0x1ca0c9,_0x3c05e0=this[_0x4be679(0xd4)][_0x29a496];let _0x1e03ca='';_0x3c05e0?_0x1e03ca=_0x4be679(0x17c)+_0x29a496+':\x20'+_0x3c05e0[_0x4be679(0x13e)]:_0x1e03ca='Status\x20'+_0x29a496+':\x20Unknown\x20status\x20code';if(_0x29bd4a&&_0x29bd4a[_0x4be679(0x1a5)]()){const _0x44c5a0=_0x29bd4a['trim']();(!_0x3c05e0||_0x44c5a0['toLowerCase']()!==_0x3c05e0[_0x4be679(0x13e)][_0x4be679(0x1b8)]())&&(_0x1e03ca+='\x20|\x20Response:\x20'+_0x44c5a0);}return _0x1e03ca;}[a68_0x1ca0c9(0xf1)](_0x5596c0){const _0x27ca06=a68_0x1ca0c9,_0x4cce48=this[_0x27ca06(0xd4)][_0x5596c0];return _0x4cce48?_0x4cce48[_0x27ca06(0x143)]:!![];}[a68_0x1ca0c9(0x145)](_0x276c41){const _0x5bccc9=a68_0x1ca0c9,_0x1baf75=_0x276c41[_0x5bccc9(0xfb)](0x0);if(_0x1baf75==='4')return console['log']('üí≥\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)'),{'cardType':'VISA','apiUrl':this['visaApiUrl'],'privateKeyPath':this[_0x5bccc9(0x91)],'publicKeyPath':this['visaPublicKeyPath'],'merchantPointId':this['visaMerchantPointId']};else return _0x1baf75==='5'?(console[_0x5bccc9(0x10f)]('üí≥\x20Detected\x20MasterCard\x20(starts\x20with\x205)'),{'cardType':'MASTERCARD','apiUrl':this[_0x5bccc9(0x1a6)],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x5bccc9(0x82)],'merchantPointId':this[_0x5bccc9(0xf4)]}):(console[_0x5bccc9(0x10f)]('üí≥\x20Unknown\x20card\x20type\x20(starts\x20with\x20'+_0x1baf75+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':_0x5bccc9(0x1d8),'apiUrl':this[_0x5bccc9(0x1a6)],'privateKeyPath':this[_0x5bccc9(0x8b)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this['masterCardMerchantPointId']});}[a68_0x1ca0c9(0x16c)](){const _0x4cfc9d=a68_0x1ca0c9;try{if(!fs_1[_0x4cfc9d(0x83)][_0x4cfc9d(0x16f)](this['privateKeyPath']))throw new Error(_0x4cfc9d(0x187)+this[_0x4cfc9d(0x8b)]);if(!fs_1[_0x4cfc9d(0x83)][_0x4cfc9d(0x16f)](this['publicKeyPath']))throw new Error(_0x4cfc9d(0xa1)+this['publicKeyPath']);const _0x58257c=fs_1[_0x4cfc9d(0x83)]['readFileSync'](this[_0x4cfc9d(0x8b)],_0x4cfc9d(0x122))[_0x4cfc9d(0x1a5)](),_0x321da4=fs_1[_0x4cfc9d(0x83)][_0x4cfc9d(0xce)](this[_0x4cfc9d(0x82)],_0x4cfc9d(0x122))[_0x4cfc9d(0x1a5)]();if(!_0x58257c[_0x4cfc9d(0xd7)]('-----BEGIN')||!_0x58257c[_0x4cfc9d(0xd7)](_0x4cfc9d(0x76)))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x321da4[_0x4cfc9d(0xd7)](_0x4cfc9d(0x77))||!_0x321da4['includes'](_0x4cfc9d(0x76)))throw new Error(_0x4cfc9d(0xd5));console[_0x4cfc9d(0x10f)](_0x4cfc9d(0xcb)),console[_0x4cfc9d(0x10f)](_0x4cfc9d(0x1e1)+_0x58257c[_0x4cfc9d(0xcf)]+_0x4cfc9d(0x139)),console['log'](_0x4cfc9d(0xa5)+_0x321da4[_0x4cfc9d(0xcf)]+_0x4cfc9d(0x139));if(fs_1[_0x4cfc9d(0x83)][_0x4cfc9d(0x16f)](this[_0x4cfc9d(0x91)])&&fs_1[_0x4cfc9d(0x83)][_0x4cfc9d(0x16f)](this[_0x4cfc9d(0x89)])){const _0x4d28e6=fs_1[_0x4cfc9d(0x83)][_0x4cfc9d(0xce)](this[_0x4cfc9d(0x91)],_0x4cfc9d(0x122))[_0x4cfc9d(0x1a5)](),_0xfac0e3=fs_1[_0x4cfc9d(0x83)][_0x4cfc9d(0xce)](this['visaPublicKeyPath'],_0x4cfc9d(0x122))[_0x4cfc9d(0x1a5)]();(!_0x4d28e6['includes'](_0x4cfc9d(0x77))||!_0x4d28e6[_0x4cfc9d(0xd7)](_0x4cfc9d(0x76)))&&console[_0x4cfc9d(0x115)](_0x4cfc9d(0xf7)),(!_0xfac0e3[_0x4cfc9d(0xd7)]('-----BEGIN')||!_0xfac0e3[_0x4cfc9d(0xd7)](_0x4cfc9d(0x76)))&&console[_0x4cfc9d(0x115)]('‚ö†Ô∏è\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format'),console[_0x4cfc9d(0x10f)](_0x4cfc9d(0x7e)),console[_0x4cfc9d(0x10f)](_0x4cfc9d(0x121)+_0x4d28e6[_0x4cfc9d(0xcf)]+_0x4cfc9d(0x139)),console[_0x4cfc9d(0x10f)]('üîê\x20VISA\x20Public\x20key\x20length:\x20'+_0xfac0e3[_0x4cfc9d(0xcf)]+'\x20characters');}else console['warn'](_0x4cfc9d(0x180)),console[_0x4cfc9d(0x115)]('‚ö†Ô∏è\x20Expected\x20VISA\x20private\x20key:\x20'+this[_0x4cfc9d(0x91)]),console[_0x4cfc9d(0x115)]('‚ö†Ô∏è\x20Expected\x20VISA\x20public\x20key:\x20'+this[_0x4cfc9d(0x89)]);}catch(_0x5a5e03){console[_0x4cfc9d(0x132)]('‚ùå\x20VISA/MasterCard\x20key\x20validation\x20failed:',_0x5a5e03);throw _0x5a5e03;}}['generateAESKey'](){const _0x72d224=a68_0x1ca0c9,_0x4a6b4c=crypto_1['default'][_0x72d224(0x119)](0x20),_0x24d1bb=crypto_1[_0x72d224(0x83)]['randomBytes'](0x10);return{'key':_0x4a6b4c,'iv':_0x24d1bb};}[a68_0x1ca0c9(0x110)](_0x198dc2,_0x294098,_0x40bff3){const _0x4f467b=a68_0x1ca0c9,_0x116508=crypto_1[_0x4f467b(0x83)][_0x4f467b(0x9f)](_0x4f467b(0x147),_0x294098,_0x40bff3);let _0x3f9673=_0x116508[_0x4f467b(0x1cb)](_0x198dc2,'utf8','base64');return _0x3f9673+=_0x116508[_0x4f467b(0x143)](_0x4f467b(0x109)),_0x3f9673;}[a68_0x1ca0c9(0x1b4)](_0x4a504d,_0x15b983,_0x1e4f0f){const _0xa35f54=a68_0x1ca0c9;try{const _0x28d0f6=fs_1[_0xa35f54(0x83)][_0xa35f54(0xce)](_0x1e4f0f,'utf8')[_0xa35f54(0x1a5)](),_0xa8cc9c={'iv':_0x15b983[_0xa35f54(0xa9)](_0xa35f54(0x109)),'key':_0x4a504d[_0xa35f54(0xa9)](_0xa35f54(0x109))},_0x2f938c=JSON[_0xa35f54(0xea)](_0xa8cc9c);console['log'](_0xa35f54(0x1ad),_0x2f938c[_0xa35f54(0xcf)]);const _0x7ea2b=crypto_1['default'][_0xa35f54(0x15b)]({'key':_0x28d0f6,'padding':crypto_1[_0xa35f54(0x83)][_0xa35f54(0x15f)][_0xa35f54(0x12a)]},Buffer[_0xa35f54(0x153)](_0x2f938c));return console[_0xa35f54(0x10f)](_0xa35f54(0x128),_0x7ea2b[_0xa35f54(0xcf)]),_0x7ea2b[_0xa35f54(0xa9)]('base64');}catch(_0x301ab2){console[_0xa35f54(0x132)]('‚ùå\x20RSA\x20encryption\x20failed:',_0x301ab2);throw new Error(_0xa35f54(0x8c));}}[a68_0x1ca0c9(0x168)](_0x374e67,_0x498565){const _0x248656=a68_0x1ca0c9;try{const _0x4a6aee=fs_1[_0x248656(0x83)][_0x248656(0xce)](_0x498565,_0x248656(0x122))['trim'](),_0x536afb=crypto_1[_0x248656(0x83)][_0x248656(0xfe)]('SHA256');_0x536afb[_0x248656(0x1cb)](_0x374e67),_0x536afb[_0x248656(0x174)]();const _0x12419c=_0x536afb[_0x248656(0xc7)](_0x4a6aee,_0x248656(0x109));return console['log'](_0x248656(0x198)),console['log']('üìù\x20Data\x20to\x20sign\x20length:',_0x374e67[_0x248656(0xcf)]),console['log'](_0x248656(0x183),_0x12419c[_0x248656(0xcf)]),_0x12419c;}catch(_0x5768aa){console[_0x248656(0x132)](_0x248656(0x79),_0x5768aa),console[_0x248656(0x132)](_0x248656(0x10e),_0x374e67[_0x248656(0x1d0)](0x0,0xc8)+'...');throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}[a68_0x1ca0c9(0x12d)](_0x9cd8d9,_0xf92039,_0xde8bc){const _0x3fdb99=a68_0x1ca0c9,_0x309a1c=crypto_1[_0x3fdb99(0x83)][_0x3fdb99(0x1d3)](_0x3fdb99(0x147),_0xf92039,_0xde8bc);let _0x37203a=_0x309a1c[_0x3fdb99(0x1cb)](_0x9cd8d9,_0x3fdb99(0x109),_0x3fdb99(0x122));return _0x37203a+=_0x309a1c[_0x3fdb99(0x143)](_0x3fdb99(0x122)),_0x37203a;}async[a68_0x1ca0c9(0x117)](_0x51c747,_0xe315e8,_0x33746f=a68_0x1ca0c9(0x1d8)){const _0x551d2f=a68_0x1ca0c9;try{const _0x19a1fc=await fetch(_0x551d2f(0xd0),{'method':_0x551d2f(0x11a),'headers':{'Content-Type':_0x551d2f(0x8e)},'body':JSON[_0x551d2f(0xea)]({'info':_0x51c747,'key':_0xe315e8,'card_type':_0x33746f[_0x551d2f(0x1b8)]()})});if(!_0x19a1fc['ok'])throw new Error(_0x551d2f(0x1bf));return await _0x19a1fc[_0x551d2f(0x1a2)]();}catch(_0x1ec97f){console[_0x551d2f(0x132)](_0x551d2f(0x14d),_0x1ec97f);throw new Error(_0x551d2f(0x113));}}[a68_0x1ca0c9(0x16d)](_0x137a5c,_0x10b4a7){const _0x3209ae=a68_0x1ca0c9;try{const _0x435a22=fs_1[_0x3209ae(0x83)][_0x3209ae(0xce)](this[_0x3209ae(0x8b)],_0x3209ae(0x122))[_0x3209ae(0x1a5)](),_0x544e3e=crypto_1['default'][_0x3209ae(0x18c)](_0x435a22,Buffer[_0x3209ae(0x153)](_0x10b4a7,_0x3209ae(0x109))),_0xf224df=JSON[_0x3209ae(0x188)](_0x544e3e[_0x3209ae(0xa9)]()),_0x1e57f4=Buffer['from'](_0xf224df[_0x3209ae(0x159)],_0x3209ae(0x109)),_0x3e652e=Buffer[_0x3209ae(0x153)](_0xf224df['iv'],_0x3209ae(0x109));return this[_0x3209ae(0x12d)](_0x137a5c,_0x1e57f4,_0x3e652e);}catch(_0x5571b9){throw new Error('Failed\x20to\x20decrypt\x20response');}}async['processCardPayment'](_0x2c6707){const _0x20e650=a68_0x1ca0c9,{paymentId:_0x4d221d,orderId:_0x186d9c,amount:_0x27a46b,currency:_0x3789fb,cardData:_0x13fdb6,resultUrl:_0x4b4dd6,returnUrl:_0x2849b7,cardHolder:_0x2eb744,browser:_0x57a07e}=_0x2c6707;console[_0x20e650(0x10f)](_0x20e650(0x9d)),console[_0x20e650(0x10f)](_0x20e650(0x14c),_0x4d221d),console[_0x20e650(0x10f)](_0x20e650(0x112),_0x186d9c),console['log']('Amount:',_0x27a46b,_0x3789fb),console[_0x20e650(0x10f)]('Card\x20Number:',this[_0x20e650(0xe4)](_0x13fdb6['number'])),console[_0x20e650(0x10f)](_0x20e650(0x1bb),_0x2eb744[_0x20e650(0xb6)]+'\x20'+_0x2eb744['last_name']),console[_0x20e650(0x10f)](_0x20e650(0x1bd),_0x2849b7),console[_0x20e650(0x10f)](_0x20e650(0x16e),_0x4b4dd6);const _0x3d70d7=this[_0x20e650(0x145)](_0x13fdb6[_0x20e650(0x182)]);console[_0x20e650(0x10f)](_0x20e650(0x12c)+_0x3d70d7[_0x20e650(0x146)]+'\x20API:\x20'+_0x3d70d7['apiUrl']),console[_0x20e650(0x10f)]('üîê\x20Using\x20keys:\x20'+_0x3d70d7['privateKeyPath']+',\x20'+_0x3d70d7[_0x20e650(0x82)]);const _0x12a38c={..._0x2eb744,'first_name':_0x2eb744['first_name']?.[_0x20e650(0x138)](/[\t\n\r\f\v]/g,'\x20')[_0x20e650(0x1a5)]()||'','last_name':_0x2eb744[_0x20e650(0x196)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x20e650(0x1a5)]()||''};'postcode'in _0x12a38c&&!('post_code'in _0x12a38c)&&(_0x12a38c[_0x20e650(0x1de)]=_0x12a38c['postcode'],delete _0x12a38c['postcode'],console['log'](_0x20e650(0x1c7)+_0x12a38c[_0x20e650(0x1de)]));console[_0x20e650(0x10f)](_0x20e650(0xf5)),console[_0x20e650(0x10f)]('\x20\x20Original:\x20\x22'+_0x2eb744['first_name']+_0x20e650(0x1af)+_0x2eb744[_0x20e650(0x196)]+'\x22'),console[_0x20e650(0x10f)](_0x20e650(0x7f)+_0x12a38c['first_name']+_0x20e650(0x1af)+_0x12a38c[_0x20e650(0x196)]+'\x22'),console[_0x20e650(0x10f)](_0x20e650(0x192),JSON[_0x20e650(0xea)](_0x12a38c,null,0x2));const _0x4d7bce={'amount':_0x27a46b,'currency':_0x3789fb['toUpperCase'](),'order_id':_0x186d9c,'result_url':_0x4b4dd6,'return_url':_0x2849b7,'country':_0x12a38c[_0x20e650(0xc9)]||'','card':{'number':_0x13fdb6[_0x20e650(0x182)],'expire_month':_0x13fdb6[_0x20e650(0x1e2)],'expire_year':_0x13fdb6[_0x20e650(0xe5)],'cvv':_0x13fdb6[_0x20e650(0xd2)]},'card_holder':_0x12a38c,'browser':_0x57a07e},_0x10b79c=JSON[_0x20e650(0xea)](_0x4d7bce);console[_0x20e650(0x10f)](_0x20e650(0xbf)),console[_0x20e650(0x10f)](_0x20e650(0x1d2)),console[_0x20e650(0x10f)](_0x10b79c),console[_0x20e650(0x10f)](_0x20e650(0x17e),_0x10b79c[_0x20e650(0xcf)]);try{const {key:_0x1a7be5,iv:_0x29f084}=this[_0x20e650(0x1b9)]();console[_0x20e650(0x10f)](_0x20e650(0x94)),console[_0x20e650(0x10f)](_0x20e650(0x19e),_0x1a7be5[_0x20e650(0xcf)]),console['log'](_0x20e650(0xb3),_0x29f084[_0x20e650(0xcf)]);const _0x5c9fe1=this[_0x20e650(0x110)](_0x10b79c,_0x1a7be5,_0x29f084);console['log'](_0x20e650(0x1ba)),console['log'](_0x20e650(0x19d),_0x5c9fe1[_0x20e650(0xcf)]);const _0x223717=this[_0x20e650(0x1b4)](_0x1a7be5,_0x29f084,_0x3d70d7[_0x20e650(0x82)]);console['log'](_0x20e650(0x93)),console['log'](_0x20e650(0x13f),_0x223717[_0x20e650(0xcf)]);const _0x48adb1=this[_0x20e650(0x168)](_0x10b79c,_0x3d70d7[_0x20e650(0x8b)]);console[_0x20e650(0x10f)](_0x20e650(0x1a4)),console[_0x20e650(0x10f)](_0x20e650(0x183),_0x48adb1[_0x20e650(0xcf)]);const _0x5adedb={'merchant_point_id':_0x3d70d7[_0x20e650(0x144)],'method':_0x20e650(0xb8),'info':_0x5c9fe1,'key':_0x223717,'sign':_0x48adb1,'lang':'en'};console[_0x20e650(0x10f)]('üì§\x20Sending\x20request\x20to\x20API...'),console[_0x20e650(0x10f)](_0x20e650(0x155)),console[_0x20e650(0x10f)]('\x20\x20\x20-\x20merchant_point_id:',_0x3d70d7['merchantPointId']),console[_0x20e650(0x10f)](_0x20e650(0xc1)),console['log'](_0x20e650(0x1dd),_0x5c9fe1['length']),console[_0x20e650(0x10f)](_0x20e650(0x96),_0x223717[_0x20e650(0xcf)]),console[_0x20e650(0x10f)](_0x20e650(0x1a0),_0x48adb1['length']),console[_0x20e650(0x10f)](_0x20e650(0x1ce)),console[_0x20e650(0x10f)](''),console[_0x20e650(0x10f)](_0x20e650(0x1b6)),console[_0x20e650(0x10f)](JSON[_0x20e650(0xea)](_0x5adedb,null,0x2)),console[_0x20e650(0x10f)](''),loggerService_1['loggerService'][_0x20e650(0x135)](_0x3d70d7[_0x20e650(0x146)][_0x20e650(0x1b8)](),'/charge',_0x20e650(0x11a),{'merchant_point_id':_0x3d70d7[_0x20e650(0x144)],'method':_0x20e650(0xb8),'lang':'en'});const _0x5f5004=Date[_0x20e650(0x11b)](),_0x36072e=await fetch(_0x3d70d7[_0x20e650(0x197)],{'method':_0x20e650(0x11a),'headers':{'Content-Type':'application/json','Accept':_0x20e650(0x8e),'User-Agent':_0x20e650(0x123)},'body':JSON[_0x20e650(0xea)](_0x5adedb)}),_0x469ace=Date[_0x20e650(0x11b)]()-_0x5f5004;console['log'](_0x20e650(0x127)),console[_0x20e650(0x10f)](_0x20e650(0x1ac),_0x36072e[_0x20e650(0x142)]),console[_0x20e650(0x10f)](_0x20e650(0x13d),_0x36072e[_0x20e650(0x14a)]),console[_0x20e650(0x10f)]('Response\x20Time:',_0x469ace+'ms'),console[_0x20e650(0x10f)](_0x20e650(0xe7)),_0x36072e['headers']['forEach']((_0x5d6c61,_0x4a3993)=>{const _0x12a9d2=_0x20e650;console[_0x12a9d2(0x10f)](_0x12a9d2(0x1d5)+_0x4a3993+':\x20'+_0x5d6c61);}),console[_0x20e650(0x10f)]('');if(!_0x36072e['ok']){const _0x41eaf1=await _0x36072e[_0x20e650(0x1a2)]();console['error']('HTTP\x20Status:',_0x36072e[_0x20e650(0x142)]),console[_0x20e650(0x132)](_0x20e650(0xb9)),console[_0x20e650(0x132)](_0x41eaf1),console[_0x20e650(0x132)](''),loggerService_1[_0x20e650(0x1e0)]['logWhiteDomainResponse'](_0x3d70d7['cardType']['toLowerCase'](),_0x20e650(0x129),_0x36072e[_0x20e650(0x142)],_0x41eaf1,_0x469ace),loggerService_1[_0x20e650(0x1e0)][_0x20e650(0x9a)](_0x3d70d7['cardType'][_0x20e650(0x1b8)](),'/charge','HTTP\x20'+_0x36072e[_0x20e650(0x142)]+':\x20'+_0x41eaf1);throw new Error(_0x20e650(0x1d4)+_0x36072e['status']+_0x20e650(0x84)+_0x41eaf1);}const _0x46a608=await _0x36072e[_0x20e650(0x17d)]();console[_0x20e650(0x10f)](_0x20e650(0xf3)),console[_0x20e650(0x10f)](JSON[_0x20e650(0xea)](_0x46a608,null,0x2)),console[_0x20e650(0x10f)](''),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3d70d7[_0x20e650(0x146)]['toLowerCase'](),_0x20e650(0x129),_0x36072e[_0x20e650(0x142)],_0x46a608,_0x469ace),console[_0x20e650(0x10f)](_0x20e650(0x16b));let _0x14e9f1=_0x46a608;if(_0x46a608[_0x20e650(0x137)]&&_0x46a608[_0x20e650(0x159)]&&_0x46a608[_0x20e650(0xc7)]){console['log'](_0x20e650(0x15a));try{const _0x138ee9=await this['decryptResponsePhp'](_0x46a608[_0x20e650(0x137)],_0x46a608[_0x20e650(0x159)],_0x3d70d7['cardType']);_0x14e9f1=JSON[_0x20e650(0x188)](_0x138ee9),console[_0x20e650(0x10f)](_0x20e650(0x134)),loggerService_1[_0x20e650(0x1e0)]['logWhiteDomainResponse'](_0x3d70d7[_0x20e650(0x146)][_0x20e650(0x1b8)](),_0x20e650(0x189),_0x36072e[_0x20e650(0x142)],_0x14e9f1,_0x469ace),console[_0x20e650(0x10f)](_0x20e650(0x17a));}catch(_0x9d2027){console[_0x20e650(0x132)]('‚ùå\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x9d2027),loggerService_1['loggerService'][_0x20e650(0x9a)](_0x3d70d7['cardType'][_0x20e650(0x1b8)](),_0x20e650(0x13a),'Decryption\x20failed:\x20'+_0x9d2027),_0x14e9f1=_0x46a608;}}else loggerService_1[_0x20e650(0x1e0)][_0x20e650(0x102)](_0x3d70d7[_0x20e650(0x146)][_0x20e650(0x1b8)](),'/charge_decrypted',_0x36072e[_0x20e650(0x142)],_0x14e9f1,_0x469ace),console['log']('üìù\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x20e650(0x10f)](_0x20e650(0x1ac),_0x14e9f1['status']),console[_0x20e650(0x10f)](_0x20e650(0xa8),_0x14e9f1[_0x20e650(0x143)]),console[_0x20e650(0x10f)](_0x20e650(0x14c),_0x14e9f1[_0x20e650(0x1c6)]),console[_0x20e650(0x10f)](_0x20e650(0xd6),_0x14e9f1[_0x20e650(0xa4)]||'none');if(_0x14e9f1[_0x20e650(0x142)]===0x64&&_0x14e9f1[_0x20e650(0x143)]===0x1)return console[_0x20e650(0x10f)](_0x20e650(0x9c)),{'gateway_payment_id':_0x14e9f1[_0x20e650(0x1c6)]?.[_0x20e650(0xa9)](),'payment_url':_0x2849b7,'requires_3ds':![],'status':_0x20e650(0xd8),'final':!![]};if(_0x14e9f1[_0x20e650(0xa4)])return console[_0x20e650(0x10f)]('üîê\x203DS\x20verification\x20required'),this[_0x20e650(0xb5)](_0x4d221d,_0x186d9c,_0x14e9f1['payment_id']?.[_0x20e650(0xa9)]()||_0x186d9c,_0x3d70d7[_0x20e650(0x146)]),{'gateway_payment_id':_0x14e9f1[_0x20e650(0x1c6)]?.[_0x20e650(0xa9)](),'payment_url':_0x14e9f1[_0x20e650(0xa4)],'requires_3ds':!![],'threeds_url':_0x14e9f1['3ds_url'],'status':_0x20e650(0x1da),'final':![]};let _0x34251b=this[_0x20e650(0xb4)](_0x14e9f1[_0x20e650(0x142)],_0x14e9f1[_0x20e650(0x104)]||_0x14e9f1[_0x20e650(0x16a)]),_0x30f01a=_0x14e9f1[_0x20e650(0x142)],_0x20f7b8=this['isFinalStatus'](_0x14e9f1[_0x20e650(0x142)]);return console[_0x20e650(0x10f)]('‚ùå\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x30f01a+_0x20e650(0x116)+_0x20f7b8+_0x20e650(0xe0)+_0x34251b),{'gateway_payment_id':_0x14e9f1[_0x20e650(0x1c6)]?.['toString'](),'payment_url':_0x2849b7,'requires_3ds':![],'status':_0x20e650(0x124),'final':!![],'errorMessage':_0x34251b};}catch(_0x1b3b21){console['error'](_0x20e650(0x80)),console[_0x20e650(0x132)](_0x20e650(0x190),_0x1b3b21),loggerService_1[_0x20e650(0x1e0)][_0x20e650(0x9a)](_0x20e650(0xd1),_0x20e650(0xfd),_0x1b3b21);throw new Error(_0x20e650(0xc8)+(_0x1b3b21 instanceof Error?_0x1b3b21[_0x20e650(0x16a)]:_0x20e650(0x118)));}}async[a68_0x1ca0c9(0x85)](_0x51dbb8,_0x464964,_0x3c379a=a68_0x1ca0c9(0x1aa)){const _0xff3d28=a68_0x1ca0c9;console[_0xff3d28(0x10f)](_0xff3d28(0x8a)+_0x3c379a+_0xff3d28(0x1b0)+_0x51dbb8+'\x20('+_0x464964+')');try{const _0xfca4df={'payment_id':_0x51dbb8,'order_id':_0x464964},_0x3d99e6=JSON[_0xff3d28(0xea)](_0xfca4df),_0x231bef=this['getCardTypeAndApi'](_0x3c379a==='VISA'?_0xff3d28(0x9b):_0xff3d28(0x14b)),{key:_0x1b6a10,iv:_0x30b805}=this[_0xff3d28(0x1b9)](),_0x249f50=this['encryptAES'](_0x3d99e6,_0x1b6a10,_0x30b805),_0x32ff9e=this[_0xff3d28(0x1b4)](_0x1b6a10,_0x30b805,_0x231bef[_0xff3d28(0x82)]),_0x257c21=this[_0xff3d28(0x168)](_0x3d99e6,_0x231bef['privateKeyPath']),_0x2dc0e5={'merchant_point_id':_0x231bef[_0xff3d28(0x144)],'method':_0xff3d28(0x142),'info':_0x249f50,'key':_0x32ff9e,'sign':_0x257c21,'lang':'en'};loggerService_1[_0xff3d28(0x1e0)][_0xff3d28(0x135)](_0x3c379a[_0xff3d28(0x1b8)](),'/status',_0xff3d28(0x11a),{'merchant_point_id':_0x231bef[_0xff3d28(0x144)],'method':_0xff3d28(0x142),'lang':'en'});const _0x402906=Date[_0xff3d28(0x11b)](),_0xa84101=await fetch(_0x231bef['apiUrl'],{'method':_0xff3d28(0x11a),'headers':{'Content-Type':_0xff3d28(0x8e),'Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON[_0xff3d28(0xea)](_0x2dc0e5)}),_0x3b1e41=Date[_0xff3d28(0x11b)]()-_0x402906;if(!_0xa84101['ok']){const _0x12e1be=await _0xa84101[_0xff3d28(0x1a2)]();loggerService_1[_0xff3d28(0x1e0)][_0xff3d28(0x102)](_0x3c379a[_0xff3d28(0x1b8)](),_0xff3d28(0x107),_0xa84101[_0xff3d28(0x142)],_0x12e1be,_0x3b1e41);throw new Error(_0xff3d28(0x1d4)+_0xa84101[_0xff3d28(0x142)]);}const _0x114a4a=await _0xa84101[_0xff3d28(0x17d)]();loggerService_1['loggerService'][_0xff3d28(0x102)](_0x3c379a[_0xff3d28(0x1b8)](),_0xff3d28(0x107),_0xa84101[_0xff3d28(0x142)],_0x114a4a,_0x3b1e41);let _0xb16e14=_0x114a4a;if(_0x114a4a[_0xff3d28(0x137)]&&_0x114a4a[_0xff3d28(0x159)]&&_0x114a4a[_0xff3d28(0xc7)]){console['log'](_0xff3d28(0x7d));try{const _0xd4fe83=await this[_0xff3d28(0x117)](_0x114a4a[_0xff3d28(0x137)],_0x114a4a['key'],_0x3c379a);_0xb16e14=JSON[_0xff3d28(0x188)](_0xd4fe83),console[_0xff3d28(0x10f)](_0xff3d28(0x11c)),loggerService_1[_0xff3d28(0x1e0)][_0xff3d28(0x102)](_0x3c379a[_0xff3d28(0x1b8)](),_0xff3d28(0x1ae),_0xa84101[_0xff3d28(0x142)],_0xb16e14,_0x3b1e41),console[_0xff3d28(0x10f)](_0xff3d28(0xde));}catch(_0x2ce644){console[_0xff3d28(0x132)](_0xff3d28(0xe9),_0x2ce644),loggerService_1[_0xff3d28(0x1e0)][_0xff3d28(0x9a)](_0x3c379a['toLowerCase'](),'/status_decrypt',_0xff3d28(0xe1)+_0x2ce644),_0xb16e14=_0x114a4a;}}else loggerService_1[_0xff3d28(0x1e0)]['logWhiteDomainResponse'](_0x3c379a[_0xff3d28(0x1b8)](),_0xff3d28(0x1ae),_0xa84101[_0xff3d28(0x142)],_0xb16e14,_0x3b1e41),console[_0xff3d28(0x10f)](_0xff3d28(0x172));console['log'](_0xff3d28(0x13c),{'status':_0xb16e14[_0xff3d28(0x142)],'final':_0xb16e14[_0xff3d28(0x143)],'payment_id':_0xb16e14[_0xff3d28(0x1c6)],'desc':_0xb16e14[_0xff3d28(0x104)]});let _0x3a64f2=_0xff3d28(0x1da);if(_0xb16e14[_0xff3d28(0x142)]===0x64&&_0xb16e14[_0xff3d28(0x143)]===0x1)_0x3a64f2='PAID';else{if(_0xb16e14[_0xff3d28(0x143)]===0x0||!this[_0xff3d28(0xf1)](_0xb16e14['status']))_0x3a64f2='PENDING';else _0xb16e14['final']===0x1||this[_0xff3d28(0xf1)](_0xb16e14['status'])?_0x3a64f2=_0xff3d28(0x124):_0x3a64f2=_0xff3d28(0x1da);}const _0x472204=this[_0xff3d28(0xb4)](_0xb16e14[_0xff3d28(0x142)],_0xb16e14[_0xff3d28(0x104)]);return{'status':_0x3a64f2,'final':this[_0xff3d28(0xf1)](_0xb16e14[_0xff3d28(0x142)]),'amount':_0xb16e14[_0xff3d28(0x1b1)],'currency':_0xb16e14[_0xff3d28(0xa0)],'date_success':_0xb16e14[_0xff3d28(0x18a)],'description':_0x472204};}catch(_0x4b3a88){console[_0xff3d28(0x132)](_0x3c379a+_0xff3d28(0x78),_0x4b3a88),loggerService_1[_0xff3d28(0x1e0)][_0xff3d28(0x9a)](_0x3c379a[_0xff3d28(0x1b8)](),_0xff3d28(0x173),_0x4b3a88);throw new Error(_0xff3d28(0x175)+_0x3c379a+_0xff3d28(0x1b0)+(_0x4b3a88 instanceof Error?_0x4b3a88['message']:'Unknown\x20error'));}}[a68_0x1ca0c9(0xb5)](_0x4be990,_0x1dc6d7,_0x2fbb5a,_0x183aba){const _0x580f25=a68_0x1ca0c9;console[_0x580f25(0x10f)](_0x580f25(0xbe)+_0x183aba+'\x20payment:\x20'+_0x4be990+'\x20('+_0x2fbb5a+')'),this[_0x580f25(0x7a)](_0x4be990);const _0x53dc89=[],_0x4b5c4a=0x5*0x3c*0x3e8,_0x525b9a=0x2*0x3c*0x3c*0x3e8,_0x123393=Math[_0x580f25(0x10a)](_0x525b9a/_0x4b5c4a);console['log'](_0x580f25(0x12b)+_0x123393+_0x580f25(0xdb));for(let _0x3238e7=0x1;_0x3238e7<=_0x123393;_0x3238e7++){const _0x2cf144=setTimeout(async()=>{const _0x32e01b=_0x580f25;console[_0x32e01b(0x10f)](_0x32e01b(0x1cc)+_0x183aba+_0x32e01b(0xdf)+_0x3238e7+'/'+_0x123393+_0x32e01b(0x120)+_0x4be990);try{const _0x4317e6=await this[_0x32e01b(0x85)](_0x2fbb5a,_0x1dc6d7,_0x183aba);console[_0x32e01b(0x10f)](_0x32e01b(0x95)+_0x3238e7+'\x20result:',_0x4317e6),_0x4317e6['final']&&(console[_0x32e01b(0x10f)]('‚úÖ\x20Payment\x20'+_0x4be990+_0x32e01b(0x1b5)+_0x4317e6[_0x32e01b(0x142)]+_0x32e01b(0x9e)),this['clearStatusTimers'](_0x4be990),await this[_0x32e01b(0xb0)](_0x4be990,_0x4317e6['status'],_0x4317e6));}catch(_0x34f782){console[_0x32e01b(0x132)]('‚ùå\x20Status\x20check\x20#'+_0x3238e7+_0x32e01b(0xcd)+_0x4be990+':',_0x34f782);}},_0x3238e7*_0x4b5c4a);_0x53dc89[_0x580f25(0x90)](_0x2cf144);}this['statusCheckTimers'][_0x580f25(0x164)](_0x4be990,_0x53dc89),console[_0x580f25(0x10f)](_0x580f25(0x18b)+_0x123393+'\x20status\x20checks\x20for\x20payment\x20'+_0x4be990);}['clearStatusTimers'](_0x158c5a){const _0x4e736c=a68_0x1ca0c9,_0x18a326=this[_0x4e736c(0x184)][_0x4e736c(0x12e)](_0x158c5a);_0x18a326&&(console['log'](_0x4e736c(0x141)+_0x18a326['length']+_0x4e736c(0x99)+_0x158c5a),_0x18a326[_0x4e736c(0x1c4)]((_0x24b008,_0x2f7091)=>{clearTimeout(_0x24b008);}),this['statusCheckTimers'][_0x4e736c(0x18d)](_0x158c5a));}async['updatePaymentStatus'](_0x246536,_0x495028,_0x3ce307){const _0x57a1de=a68_0x1ca0c9;try{const _0x254cb7=(await Promise[_0x57a1de(0x1a8)]()['then'](()=>__importStar(require(_0x57a1de(0xc0)))))[_0x57a1de(0x83)],_0x5c2e68={'status':_0x495028[_0x57a1de(0xf0)](),'updatedAt':new Date(),'statusChangedBy':_0x57a1de(0x7b),'statusChangedAt':new Date()};_0x495028==='PAID'&&(_0x5c2e68['paidAt']=new Date()),_0x495028==='FAILED'&&_0x3ce307[_0x57a1de(0x13e)]&&(_0x5c2e68['failureMessage']=_0x3ce307[_0x57a1de(0x13e)],console[_0x57a1de(0x10f)](_0x57a1de(0x1e4)+_0x3ce307[_0x57a1de(0x13e)])),await _0x254cb7[_0x57a1de(0xbc)]['update']({'where':{'id':_0x246536},'data':_0x5c2e68}),console[_0x57a1de(0x10f)](_0x57a1de(0x18f)+_0x246536+_0x57a1de(0x19a)+_0x495028),await this[_0x57a1de(0xe8)](_0x246536,_0x495028);}catch(_0x25b166){console[_0x57a1de(0x132)]('‚ùå\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x246536+':',_0x25b166);}}async['sendPaymentNotifications'](_0x36e116,_0xdf2a84){const _0x133d7f=a68_0x1ca0c9;try{const _0x57738f=(await Promise['resolve']()[_0x133d7f(0x1c9)](()=>__importStar(require(_0x133d7f(0xc0)))))[_0x133d7f(0x83)],{telegramBotService:_0x5e04a8}=await Promise[_0x133d7f(0x1a8)]()[_0x133d7f(0x1c9)](()=>__importStar(require(_0x133d7f(0x11e)))),_0x903079=await _0x57738f[_0x133d7f(0xbc)][_0x133d7f(0x1dc)]({'where':{'id':_0x36e116},'include':{'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':!![]}}}});if(!_0x903079)return;const _0x4d28b1={'PAID':_0x133d7f(0x1c3),'FAILED':'failed'},_0x67864f=_0x4d28b1[_0xdf2a84];_0x67864f&&await _0x5e04a8['sendPaymentNotification'](_0x903079[_0x133d7f(0x19f)],_0x903079,_0x67864f),await this['sendShopWebhook'](_0x903079,_0xdf2a84);}catch(_0xfe6542){console[_0x133d7f(0x132)](_0x133d7f(0x140),_0xfe6542);}}async['sendShopWebhook'](_0x361b2a,_0x35ce19){const _0x38d18a=a68_0x1ca0c9,_0x4dec19=Date[_0x38d18a(0x11b)]();try{const _0xc4590c=_0x361b2a['shop'],_0x196e0b=_0xc4590c[_0x38d18a(0xd9)];if(!_0x196e0b?.[_0x38d18a(0xc6)]){console[_0x38d18a(0x10f)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0xc4590c['id']);return;}const _0x2e094e=_0x35ce19==='PAID'?_0x38d18a(0x10d):_0x38d18a(0x101);let _0xadbf19=[];if(_0x196e0b['webhookEvents'])try{_0xadbf19=Array[_0x38d18a(0x171)](_0x196e0b[_0x38d18a(0x1ab)])?_0x196e0b[_0x38d18a(0x1ab)]:JSON[_0x38d18a(0x188)](_0x196e0b[_0x38d18a(0x1ab)]);}catch(_0x32923a){console[_0x38d18a(0x132)](_0x38d18a(0xaf),_0x32923a),_0xadbf19=[];}if(!_0xadbf19[_0x38d18a(0xd7)](_0x2e094e)){console['log'](_0x38d18a(0x169)+_0x2e094e+'\x20not\x20enabled\x20for\x20shop\x20'+_0xc4590c['id']);return;}const _0x1c4dc0={'event':_0x2e094e,'payment':{'id':_0x361b2a['id'],'order_id':_0x361b2a[_0x38d18a(0x1c2)],'gateway_order_id':_0x361b2a['gatewayOrderId'],'gateway':_0x38d18a(0xf9),'amount':_0x361b2a[_0x38d18a(0x1b1)],'currency':_0x361b2a[_0x38d18a(0xa0)],'status':_0x35ce19[_0x38d18a(0x1b8)](),'customer_email':_0x361b2a[_0x38d18a(0x1d6)],'customer_name':_0x361b2a[_0x38d18a(0xf2)],'created_at':_0x361b2a[_0x38d18a(0xda)],'updated_at':new Date()}},_0x4ac840=JSON[_0x38d18a(0xea)](_0x1c4dc0),_0x45f5d6=crypto_1[_0x38d18a(0x83)][_0x38d18a(0x1d9)]('sha256',_0xc4590c[_0x38d18a(0xc3)])['update'](_0x4ac840)[_0x38d18a(0x11f)](_0x38d18a(0x170)),_0x4dd8a1=await fetch(_0x196e0b['webhookUrl'],{'method':_0x38d18a(0x11a),'headers':{'Content-Type':'application/json','User-Agent':_0x38d18a(0x1c1),'X-Webhook-Signature':_0x45f5d6},'body':_0x4ac840}),_0x2156a5=Date['now']()-_0x4dec19;loggerService_1[_0x38d18a(0x1e0)]['logShopWebhookSent'](_0x361b2a[_0x38d18a(0x19f)],_0x196e0b[_0x38d18a(0xc6)],_0x2e094e,_0x4dd8a1[_0x38d18a(0x142)],_0x2156a5,_0x1c4dc0),console[_0x38d18a(0x10f)](_0x38d18a(0x17f)+_0x196e0b[_0x38d18a(0xc6)]+_0x38d18a(0x1c5)+_0x4dd8a1['status']+'\x20('+_0x2156a5+_0x38d18a(0x1be));}catch(_0x2c2626){console[_0x38d18a(0x132)](_0x38d18a(0xa6),_0x2c2626),loggerService_1['loggerService'][_0x38d18a(0x13b)](_0x361b2a['shopId'],_0x361b2a[_0x38d18a(0xef)]?.[_0x38d18a(0xd9)]?.[_0x38d18a(0xc6)]||_0x38d18a(0x8f),_0x38d18a(0x19c),_0x2c2626,{});}}[a68_0x1ca0c9(0xe4)](_0x2cfab2){const _0x325627=a68_0x1ca0c9,_0x40479a=_0x2cfab2['replace'](/[\s-]/g,'');if(_0x40479a['length']<0x4)return _0x325627(0x158);return _0x325627(0x126)+_0x40479a[_0x325627(0x152)](-0x4);}async[a68_0x1ca0c9(0x19b)](_0xaf1c21,_0x32be4f='MASTERCARD'){const _0x52c869=a68_0x1ca0c9;console['log'](_0x52c869(0x151),JSON[_0x52c869(0xea)](_0xaf1c21,null,0x2));let _0x57984e=_0xaf1c21,_0x39a46f=_0x32be4f;_0xaf1c21[_0x52c869(0xaa)]?(_0x39a46f=_0xaf1c21[_0x52c869(0xaa)]['toUpperCase']()===_0x52c869(0x1aa)?_0x52c869(0x1aa):'MASTERCARD',console[_0x52c869(0x10f)](_0x52c869(0x1bc)+_0x39a46f)):console[_0x52c869(0x10f)](_0x52c869(0x177)+_0x39a46f);if(_0xaf1c21[_0x52c869(0x137)]&&_0xaf1c21[_0x52c869(0x159)]&&_0xaf1c21[_0x52c869(0xc7)]){console[_0x52c869(0x10f)](_0x52c869(0x1b7));try{const _0xeb5fd5=await this['decryptResponsePhp'](_0xaf1c21[_0x52c869(0x137)],_0xaf1c21[_0x52c869(0x159)],_0x39a46f);_0x57984e=JSON[_0x52c869(0x188)](_0xeb5fd5),console['log'](_0x52c869(0x1db)),console['log'](_0x52c869(0x130),JSON[_0x52c869(0xea)](_0x57984e,null,0x2));}catch(_0xa70063){console[_0x52c869(0x132)](_0x52c869(0xf8),_0xa70063),console[_0x52c869(0x10f)](_0x52c869(0xa3)),_0x57984e=_0xaf1c21;}}else console[_0x52c869(0x10f)](_0x52c869(0x92));let _0x587d11=_0x52c869(0x1da);if(_0x57984e[_0x52c869(0x142)]===0x64&&_0x57984e[_0x52c869(0x143)]===0x1)_0x587d11='PAID';else{if(_0x57984e[_0x52c869(0x143)]===0x0||!this[_0x52c869(0xf1)](_0x57984e['status']))_0x587d11=_0x52c869(0x1da);else _0x57984e[_0x52c869(0x143)]===0x1||this[_0x52c869(0xf1)](_0x57984e[_0x52c869(0x142)])?_0x587d11=_0x52c869(0x124):_0x587d11=_0x52c869(0x1da);}let _0x526bb0='';if(_0x57984e['order_id'])_0x526bb0=_0x57984e['order_id'][_0x52c869(0xa9)](),console[_0x52c869(0x10f)](_0x52c869(0x81)+_0x39a46f+_0x52c869(0xf6)+_0x526bb0);else _0x57984e[_0x52c869(0x1c6)]?(_0x526bb0=_0x57984e['payment_id'][_0x52c869(0xa9)](),console[_0x52c869(0x10f)](_0x52c869(0x81)+_0x39a46f+_0x52c869(0x178)+_0x526bb0)):(_0x526bb0=_0x57984e[_0x52c869(0x1c2)]||_0x57984e[_0x52c869(0xdd)]||_0x57984e['id']||'',console[_0x52c869(0x10f)]('üîç\x20Using\x20fallback\x20fields\x20for\x20search:\x20'+_0x526bb0));console[_0x52c869(0x10f)](_0x52c869(0x1b2)+_0x39a46f+_0x52c869(0xcc)),console[_0x52c869(0x10f)]('\x20\x20\x20Payment\x20ID:\x20'+_0x526bb0+_0x52c869(0x1a1)+_0x57984e[_0x52c869(0x1a7)]+_0x52c869(0x1b3)+_0x57984e[_0x52c869(0x1c2)]+',\x20payment_id='+_0x57984e[_0x52c869(0x1c6)]+_0x52c869(0xc4)+_0x57984e[_0x52c869(0xdd)]+_0x52c869(0x191)+_0x57984e['id']+')'),console[_0x52c869(0x10f)](_0x52c869(0x14e)+_0x587d11+_0x52c869(0x1a9)+_0x57984e[_0x52c869(0x142)]+_0x52c869(0xa7)+_0x57984e[_0x52c869(0x143)]+')'),console[_0x52c869(0x10f)]('\x20\x20\x20Amount:\x20'+_0x57984e[_0x52c869(0x1b1)]),console['log'](_0x52c869(0x103)+_0x57984e['currency']);let _0x1a7898;_0x587d11==='FAILED'&&(_0x1a7898=this['getDetailedErrorMessage'](_0x57984e['status'],_0x57984e['desc']),console[_0x52c869(0x10f)]('‚ùå\x20Detailed\x20failure\x20description:\x20'+_0x1a7898));const _0x8fa2c1={'paymentId':_0x526bb0,'status':_0x587d11,'amount':_0x57984e['amount'],'currency':_0x57984e[_0x52c869(0xa0)],'cardBrand':_0x39a46f};return _0x1a7898&&(_0x8fa2c1[_0x52c869(0xed)]=_0x1a7898),_0x8fa2c1;}[a68_0x1ca0c9(0x15d)](){const _0x26bc71=a68_0x1ca0c9;console[_0x26bc71(0x10f)]('üõë\x20Stopping\x20all\x20MasterCard\x20status\x20checks...');const _0x10d819=this[_0x26bc71(0x184)][_0x26bc71(0x194)];for(const [_0x2ef372]of this[_0x26bc71(0x184)]){this['clearStatusTimers'](_0x2ef372);}console[_0x26bc71(0x10f)](_0x26bc71(0x150)+_0x10d819+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a68_0x1ca0c9(0x14f)]=VisaMasterCardService;