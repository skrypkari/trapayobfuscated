'use strict';const a46_0x3532b5=a46_0x1203;(function(_0x30be95,_0xeb629c){const _0x5ab890=a46_0x1203,_0x21bd7d=_0x30be95();while(!![]){try{const _0x3584da=parseInt(_0x5ab890(0x16d))/0x1*(parseInt(_0x5ab890(0x164))/0x2)+parseInt(_0x5ab890(0x211))/0x3+-parseInt(_0x5ab890(0x1e1))/0x4*(-parseInt(_0x5ab890(0x1e7))/0x5)+parseInt(_0x5ab890(0x24b))/0x6*(parseInt(_0x5ab890(0x18a))/0x7)+-parseInt(_0x5ab890(0x1f8))/0x8+-parseInt(_0x5ab890(0x187))/0x9+-parseInt(_0x5ab890(0x253))/0xa;if(_0x3584da===_0xeb629c)break;else _0x21bd7d['push'](_0x21bd7d['shift']());}catch(_0x4fa9d3){_0x21bd7d['push'](_0x21bd7d['shift']());}}}(a46_0x56db,0xa0dbe));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x424581,_0x34f081,_0x2d3177,_0x5505ac){const _0x1bf4fc=a46_0x1203;if(_0x5505ac===undefined)_0x5505ac=_0x2d3177;var _0x50bea4=Object[_0x1bf4fc(0x148)](_0x34f081,_0x2d3177);(!_0x50bea4||(_0x1bf4fc(0x170)in _0x50bea4?!_0x34f081['__esModule']:_0x50bea4[_0x1bf4fc(0x24a)]||_0x50bea4[_0x1bf4fc(0x214)]))&&(_0x50bea4={'enumerable':!![],'get':function(){return _0x34f081[_0x2d3177];}}),Object['defineProperty'](_0x424581,_0x5505ac,_0x50bea4);}:function(_0x18491e,_0x46599b,_0x398ba5,_0x5e5efd){if(_0x5e5efd===undefined)_0x5e5efd=_0x398ba5;_0x18491e[_0x5e5efd]=_0x46599b[_0x398ba5];}),__setModuleDefault=this&&this[a46_0x3532b5(0x194)]||(Object['create']?function(_0x39100f,_0x4e5537){const _0x26f70d=a46_0x3532b5;Object[_0x26f70d(0x1a7)](_0x39100f,_0x26f70d(0x1af),{'enumerable':!![],'value':_0x4e5537});}:function(_0x2e30ef,_0x145208){const _0x55c4cc=a46_0x3532b5;_0x2e30ef[_0x55c4cc(0x1af)]=_0x145208;}),__importStar=this&&this['__importStar']||(function(){var _0x5aeeb4=function(_0x491e68){const _0x51cb31=a46_0x1203;return _0x5aeeb4=Object[_0x51cb31(0x25a)]||function(_0x586a0d){const _0x2e0df8=_0x51cb31;var _0x30a8e4=[];for(var _0x1a626f in _0x586a0d)if(Object[_0x2e0df8(0x174)][_0x2e0df8(0x234)][_0x2e0df8(0x182)](_0x586a0d,_0x1a626f))_0x30a8e4[_0x30a8e4['length']]=_0x1a626f;return _0x30a8e4;},_0x5aeeb4(_0x491e68);};return function(_0x47da42){if(_0x47da42&&_0x47da42['__esModule'])return _0x47da42;var _0x3e6c08={};if(_0x47da42!=null){for(var _0x2fb87d=_0x5aeeb4(_0x47da42),_0x5d2e30=0x0;_0x5d2e30<_0x2fb87d['length'];_0x5d2e30++)if(_0x2fb87d[_0x5d2e30]!=='default')__createBinding(_0x3e6c08,_0x47da42,_0x2fb87d[_0x5d2e30]);}return __setModuleDefault(_0x3e6c08,_0x47da42),_0x3e6c08;};}()),__importDefault=this&&this['__importDefault']||function(_0x3b1566){const _0x24784f=a46_0x3532b5;return _0x3b1566&&_0x3b1566[_0x24784f(0x22d)]?_0x3b1566:{'default':_0x3b1566};};Object[a46_0x3532b5(0x1a7)](exports,a46_0x3532b5(0x22d),{'value':!![]}),exports[a46_0x3532b5(0x22f)]=void 0x0;function a46_0x56db(){const _0x50b46b=['Failed\x20to\x20send\x20payment\x20notifications:','signRSA','Decryption\x20failed:\x20','shop','RSA_PKCS1_PADDING','utf8','stringify','writable','6JdWZPw','createdAt','✅\x20Status\x20response\x20decrypted\x20successfully','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','logShopWebhookSent','delete','unknown','toUpperCase','9901370Gytmrw','\x20characters','🔐\x20Data\x20encrypted\x20with\x20AES','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','visa_private.pem','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','failureMessage','getOwnPropertyNames','/charge_decrypted','final','encryptRSA','\x20webhook\x20extracted\x20data:','❌\x20Status\x20check\x20#','\x20\x20\x20Currency:\x20','set','logWhiteDomainResponse','\x20status\x20check\x20#','\x20(from:\x20order_id=','Card\x20Holder:','status','\x20status\x20check\x20error:','ms)','length','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','sendShopWebhook','decryptResponse','📝\x20Signature\x20length:','system','size','\x20payment_id\x20for\x20search:\x20','webhookEvents','📊\x20Checking\x20','✅\x20Payment\x20','✅\x20VISA\x20key\x20files\x20validated\x20successfully','paymentId','\x20is\x20final\x20(','📤\x20Sending\x20request\x20to\x20API...','customerEmail','cwd','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','clearStatusTimers','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','🔐\x20VISA\x20Private\x20key\x20path:','getOwnPropertyDescriptor','date_success','****\x20****\x20****\x20','\x20\x20\x20-\x20info\x20length:','4000000000000000','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','POST','Status\x20decryption\x20failed:\x20','base64','then','HTTP\x20','maskCardNumber','description','\x20\x20\x20-\x20sign\x20length:','FAILED','from','/status_decrypted','📝\x20Decrypted\x20webhook\x20data:','masterCardMerchantPointId','visaPublicKeyPath','...','slice','push','checkPaymentStatus','Payment\x20ID:','publicKeyPath','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','259134GqCbyq','/status_raw','failed','===\x20API\x20RESPONSE\x20===','paid','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','⏰\x20Will\x20check\x20status\x20','merchantPointId','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','9KgKAzh','🔐\x20VISA\x20Public\x20key\x20length:\x20','Card\x20Number:','get','Response\x20Body:','resolve','payment.success','prototype','text','sign','visaPrivateKeyPath',',\x20payment_id=','🔐\x203DS\x20verification\x20required','cardType','Webhook\x20event\x20','\x20failed\x20for\x20payment\x20','Unknown\x20error','📝\x20Data\x20to\x20sign\x20length:','🔐\x20RSA\x20signing\x20successful','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','HTTP\x20Status:','call','forEach','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','Result\x20URL:','logShopWebhookError','6039882vshxDl','/charge','visaApiUrl','7641627pwrpLh','🔐\x20MasterCard\x20API\x20URL:','\x20\x20\x20Amount:\x20','info','\x20\x20\x20-\x20method:\x20charge','includes','\x20status\x20checks\x20for\x20payment\x20','HTTP\x20error!\x20status:\x20','PAID','decryptResponsePhp','__setModuleDefault','\x20(from:\x20status=','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','Final:','\x20with\x20status\x20','isArray','log','card_type','customerName','🔐\x20AES\x20IV\x20length:','gatewayOrderId','update','\x20\x20\x20-\x20lang:\x20en','path','🔐\x20AES\x20key\x20length:','sendPaymentNotification','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','privateKeyPath','defineProperty','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','currency','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','3ds_url','payment_id','getCardTypeAndApi','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','default','updatePaymentStatus','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','decryptAES',',\x20body:\x20','substring','❌\x20Failure\x20description:\x20','Response\x20Time:','3DS\x20URL:','🔐\x20Using\x20keys:\x20','===\x20PARSED\x20API\x20RESPONSE\x20===','paidAt','json','VISA','sendPaymentNotifications','amount','first_name','visaMerchantPointId','charAt','encryptAES','cvv','SHA256','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','number','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','statusCheckTimers','https://api.paydmeth.com/api','visa_public.pem','aes-256-ctr','/status','🔐\x20MasterCard\x20Private\x20key\x20path:','parse','🔐\x20VISA\x20Public\x20key\x20path:','createDecipheriv','🔐\x20MasterCard\x20Public\x20key\x20path:','\x20\x20\x20Payment\x20ID:\x20','1111','Error\x20details:','logWhiteDomainRequest','📊\x20Status\x20check\x20#','scheduleStatusChecks',',\x20final=','loggerService','-----END','../telegramBotService','Status:','generateAESKey','/charge_raw','existsSync','📝\x20Data\x20length:','4JSrOBv','🔍\x20Using\x20provided\x20card\x20type:\x20','-----BEGIN','webhookUrl','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','MasterCard\x20webhook\x20sent\x20to\x20','5058775eEzPoa','toString','🔐\x20VISA\x20API\x20URL:','processCardPayment','crypto','\x20MasterCard\x20status\x20check\x20timers','shopId','payment','💾\x20Saving\x20failure\x20message:\x20','PENDING','privateDecrypt','✅\x20Scheduled\x20','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20',',\x20Final:\x20','📊\x20','message','warn','8370864eMkLah','💾\x20Payment\x20data\x20prepared','readFileSync','last_name','keys','logWhiteDomainError','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','../loggerService','❌\x20RSA\x20signing\x20failed:','apiUrl','createSign','),\x20stopping\x20status\x20checks','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','🔍\x20','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available',',\x20paymentId=','desc','🔍\x20Using\x20','../../config/database','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','key','application/json','randomBytes','❌\x20RSA\x20encryption\x20failed:',',\x20orderId=','290856Fdzlmb','trim','Error\x20parsing\x20webhook\x20events:','configurable','validateKeyFiles','🛑\x20Stopped\x20','expire_month','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','orderId','error','PHP\x20decryptor\x20error','VISA/MasterCard','),\x20defaulting\x20to\x20MasterCard','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','\x20payment:\x20','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','createCipheriv','\x20API:\x20','masterCardApiUrl','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','order_id','📝\x20Final\x20request\x20structure:','stopAllStatusChecks','floor','🧹\x20Clearing\x20','replace','\x20\x20\x20-\x20key\x20length:','__esModule','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','VisaMasterCardService','🔄\x20Processing\x20MasterCard\x20webhook\x20data:',',\x20Desc:\x20','https://api2.trapay.uk/decrypt.php','🔐\x20Data\x20signed\x20with\x20RSA','hasOwnProperty','\x20payment\x20status:\x20','join','charge','Return\x20URL:','\x20result:','expire_year','MASTERCARD','📝\x20Encrypted\x20key\x20length:','settings','now','❌\x20PHP\x20decryptor\x20request\x20failed:','visa/mastercard','toLowerCase','\x20\x20\x20Status:\x20'];a46_0x56db=function(){return _0x50b46b;};return a46_0x56db();}const crypto_1=__importDefault(require(a46_0x3532b5(0x1eb))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a46_0x3532b5(0x1a2))),loggerService_1=require(a46_0x3532b5(0x1ff));class VisaMasterCardService{constructor(){const _0x1ba7d0=a46_0x3532b5;this['statusCheckTimers']=new Map(),this['masterCardApiUrl']='https://api.paydmeth.com/api',this['masterCardMerchantPointId']=0x6a7,this[_0x1ba7d0(0x1a6)]=path_1['default'][_0x1ba7d0(0x236)](process[_0x1ba7d0(0x143)](),_0x1ba7d0(0x1fc),'private.pem'),this[_0x1ba7d0(0x162)]=path_1[_0x1ba7d0(0x1af)][_0x1ba7d0(0x236)](process[_0x1ba7d0(0x143)](),_0x1ba7d0(0x1fc),'psp_public.pem'),this['visaApiUrl']=_0x1ba7d0(0x1c9),this[_0x1ba7d0(0x1c0)]=0x6b7,this[_0x1ba7d0(0x177)]=path_1[_0x1ba7d0(0x1af)][_0x1ba7d0(0x236)](process[_0x1ba7d0(0x143)](),_0x1ba7d0(0x1fc),_0x1ba7d0(0x257)),this[_0x1ba7d0(0x15c)]=path_1[_0x1ba7d0(0x1af)]['join'](process[_0x1ba7d0(0x143)](),'keys',_0x1ba7d0(0x1ca)),console[_0x1ba7d0(0x19b)]('💳\x20VISA/MasterCard\x20service\x20initialized'),console[_0x1ba7d0(0x19b)](_0x1ba7d0(0x18b),this[_0x1ba7d0(0x223)]),console[_0x1ba7d0(0x19b)](_0x1ba7d0(0x1e9),this[_0x1ba7d0(0x189)]),console[_0x1ba7d0(0x19b)](_0x1ba7d0(0x1cd),this[_0x1ba7d0(0x1a6)]),console['log'](_0x1ba7d0(0x1d1),this[_0x1ba7d0(0x162)]),console[_0x1ba7d0(0x19b)](_0x1ba7d0(0x147),this[_0x1ba7d0(0x177)]),console[_0x1ba7d0(0x19b)](_0x1ba7d0(0x1cf),this[_0x1ba7d0(0x15c)]),this[_0x1ba7d0(0x215)]();}[a46_0x3532b5(0x1ad)](_0x599e79){const _0x4a84d6=a46_0x3532b5,_0x5cc403=_0x599e79[_0x4a84d6(0x1c1)](0x0);if(_0x5cc403==='4')return console['log'](_0x4a84d6(0x197)),{'cardType':_0x4a84d6(0x1bc),'apiUrl':this[_0x4a84d6(0x189)],'privateKeyPath':this[_0x4a84d6(0x177)],'publicKeyPath':this[_0x4a84d6(0x15c)],'merchantPointId':this[_0x4a84d6(0x1c0)]};else return _0x5cc403==='5'?(console[_0x4a84d6(0x19b)](_0x4a84d6(0x134)),{'cardType':_0x4a84d6(0x23b),'apiUrl':this[_0x4a84d6(0x223)],'privateKeyPath':this[_0x4a84d6(0x1a6)],'publicKeyPath':this[_0x4a84d6(0x162)],'merchantPointId':this[_0x4a84d6(0x15b)]}):(console[_0x4a84d6(0x19b)]('💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20'+_0x5cc403+_0x4a84d6(0x21d)),{'cardType':_0x4a84d6(0x23b),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this[_0x4a84d6(0x162)],'merchantPointId':this['masterCardMerchantPointId']});}[a46_0x3532b5(0x215)](){const _0x4fe0a3=a46_0x3532b5;try{if(!fs_1[_0x4fe0a3(0x1af)][_0x4fe0a3(0x1df)](this['privateKeyPath']))throw new Error(_0x4fe0a3(0x1f3)+this[_0x4fe0a3(0x1a6)]);if(!fs_1[_0x4fe0a3(0x1af)][_0x4fe0a3(0x1df)](this[_0x4fe0a3(0x162)]))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this['publicKeyPath']);const _0x44fa0a=fs_1[_0x4fe0a3(0x1af)]['readFileSync'](this[_0x4fe0a3(0x1a6)],'utf8')['trim'](),_0x256a5b=fs_1[_0x4fe0a3(0x1af)][_0x4fe0a3(0x1fa)](this[_0x4fe0a3(0x162)],'utf8')[_0x4fe0a3(0x212)]();if(!_0x44fa0a[_0x4fe0a3(0x18f)](_0x4fe0a3(0x1e3))||!_0x44fa0a['includes'](_0x4fe0a3(0x1da)))throw new Error(_0x4fe0a3(0x24e));if(!_0x256a5b[_0x4fe0a3(0x18f)]('-----BEGIN')||!_0x256a5b[_0x4fe0a3(0x18f)](_0x4fe0a3(0x1da)))throw new Error(_0x4fe0a3(0x14e));console[_0x4fe0a3(0x19b)]('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console[_0x4fe0a3(0x19b)](_0x4fe0a3(0x218)+_0x44fa0a[_0x4fe0a3(0x133)]+_0x4fe0a3(0x254)),console[_0x4fe0a3(0x19b)](_0x4fe0a3(0x1e5)+_0x256a5b[_0x4fe0a3(0x133)]+_0x4fe0a3(0x254));if(fs_1[_0x4fe0a3(0x1af)][_0x4fe0a3(0x1df)](this['visaPrivateKeyPath'])&&fs_1[_0x4fe0a3(0x1af)]['existsSync'](this['visaPublicKeyPath'])){const _0x1a219c=fs_1['default'][_0x4fe0a3(0x1fa)](this[_0x4fe0a3(0x177)],'utf8')['trim'](),_0x57a06a=fs_1[_0x4fe0a3(0x1af)][_0x4fe0a3(0x1fa)](this[_0x4fe0a3(0x15c)],_0x4fe0a3(0x248))[_0x4fe0a3(0x212)]();(!_0x1a219c[_0x4fe0a3(0x18f)](_0x4fe0a3(0x1e3))||!_0x1a219c[_0x4fe0a3(0x18f)](_0x4fe0a3(0x1da)))&&console['warn'](_0x4fe0a3(0x220)),(!_0x57a06a['includes'](_0x4fe0a3(0x1e3))||!_0x57a06a['includes'](_0x4fe0a3(0x1da)))&&console[_0x4fe0a3(0x1f7)](_0x4fe0a3(0x163)),console['log'](_0x4fe0a3(0x13e)),console[_0x4fe0a3(0x19b)]('🔐\x20VISA\x20Private\x20key\x20length:\x20'+_0x1a219c[_0x4fe0a3(0x133)]+_0x4fe0a3(0x254)),console[_0x4fe0a3(0x19b)](_0x4fe0a3(0x16e)+_0x57a06a['length']+_0x4fe0a3(0x254));}else console[_0x4fe0a3(0x1f7)](_0x4fe0a3(0x206)),console[_0x4fe0a3(0x1f7)](_0x4fe0a3(0x144)+this[_0x4fe0a3(0x177)]),console[_0x4fe0a3(0x1f7)](_0x4fe0a3(0x1ae)+this['visaPublicKeyPath']);}catch(_0x38f3bd){console[_0x4fe0a3(0x21a)](_0x4fe0a3(0x21e),_0x38f3bd);throw _0x38f3bd;}}[a46_0x3532b5(0x1dd)](){const _0x426599=a46_0x3532b5,_0x155ad9=crypto_1[_0x426599(0x1af)][_0x426599(0x20e)](0x20),_0x2321ab=crypto_1['default']['randomBytes'](0x10);return{'key':_0x155ad9,'iv':_0x2321ab};}[a46_0x3532b5(0x1c2)](_0x339b54,_0x351506,_0x1edad2){const _0x8e60ea=a46_0x3532b5,_0x43df22=crypto_1['default'][_0x8e60ea(0x221)]('aes-256-ctr',_0x351506,_0x1edad2);let _0x5d9f86=_0x43df22[_0x8e60ea(0x1a0)](_0x339b54,_0x8e60ea(0x248),_0x8e60ea(0x151));return _0x5d9f86+=_0x43df22[_0x8e60ea(0x126)](_0x8e60ea(0x151)),_0x5d9f86;}['encryptRSA'](_0x3dea93,_0x2b06f7,_0x506878){const _0x3b8770=a46_0x3532b5;try{const _0x5172e9=fs_1['default'][_0x3b8770(0x1fa)](_0x506878,_0x3b8770(0x248))[_0x3b8770(0x212)](),_0x43b2ef={'iv':_0x2b06f7[_0x3b8770(0x1e8)](_0x3b8770(0x151)),'key':_0x3dea93['toString'](_0x3b8770(0x151))},_0x568989=JSON[_0x3b8770(0x249)](_0x43b2ef);console[_0x3b8770(0x19b)]('🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x568989[_0x3b8770(0x133)]);const _0x3c6c22=crypto_1['default']['publicEncrypt']({'key':_0x5172e9,'padding':crypto_1[_0x3b8770(0x1af)]['constants'][_0x3b8770(0x247)]},Buffer[_0x3b8770(0x158)](_0x568989));return console[_0x3b8770(0x19b)](_0x3b8770(0x169),_0x3c6c22['length']),_0x3c6c22[_0x3b8770(0x1e8)](_0x3b8770(0x151));}catch(_0xdbede0){console['error'](_0x3b8770(0x20f),_0xdbede0);throw new Error(_0x3b8770(0x16c));}}[a46_0x3532b5(0x244)](_0x59a1b1,_0x2aca13){const _0x2540ec=a46_0x3532b5;try{const _0x370162=fs_1['default'][_0x2540ec(0x1fa)](_0x2aca13,_0x2540ec(0x248))[_0x2540ec(0x212)](),_0x7332bc=crypto_1[_0x2540ec(0x1af)][_0x2540ec(0x202)](_0x2540ec(0x1c4));_0x7332bc[_0x2540ec(0x1a0)](_0x59a1b1),_0x7332bc['end']();const _0xa9852e=_0x7332bc[_0x2540ec(0x176)](_0x370162,_0x2540ec(0x151));return console['log'](_0x2540ec(0x17f)),console['log'](_0x2540ec(0x17e),_0x59a1b1[_0x2540ec(0x133)]),console[_0x2540ec(0x19b)](_0x2540ec(0x137),_0xa9852e[_0x2540ec(0x133)]),_0xa9852e;}catch(_0x5a5a35){console[_0x2540ec(0x21a)](_0x2540ec(0x200),_0x5a5a35),console['error']('❌\x20Data\x20being\x20signed:',_0x59a1b1[_0x2540ec(0x1b4)](0x0,0xc8)+_0x2540ec(0x15d));throw new Error(_0x2540ec(0x184));}}[a46_0x3532b5(0x1b2)](_0x3892db,_0x31c70a,_0x5ada4b){const _0x4ed558=a46_0x3532b5,_0x401e5e=crypto_1[_0x4ed558(0x1af)][_0x4ed558(0x1d0)](_0x4ed558(0x1cb),_0x31c70a,_0x5ada4b);let _0x1a4791=_0x401e5e[_0x4ed558(0x1a0)](_0x3892db,_0x4ed558(0x151),'utf8');return _0x1a4791+=_0x401e5e[_0x4ed558(0x126)](_0x4ed558(0x248)),_0x1a4791;}async[a46_0x3532b5(0x193)](_0x15bfbd,_0x3a7db7,_0x1204cf=a46_0x3532b5(0x23b)){const _0x294048=a46_0x3532b5;try{const _0x3eeb8e=await fetch(_0x294048(0x232),{'method':'POST','headers':{'Content-Type':_0x294048(0x20d)},'body':JSON['stringify']({'info':_0x15bfbd,'key':_0x3a7db7,'card_type':_0x1204cf[_0x294048(0x241)]()})});if(!_0x3eeb8e['ok'])throw new Error(_0x294048(0x21b));return await _0x3eeb8e[_0x294048(0x175)]();}catch(_0x1f8cf7){console[_0x294048(0x21a)](_0x294048(0x23f),_0x1f8cf7);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a46_0x3532b5(0x136)](_0x2a82f2,_0x403966){const _0x4dba4c=a46_0x3532b5;try{const _0x237707=fs_1[_0x4dba4c(0x1af)][_0x4dba4c(0x1fa)](this[_0x4dba4c(0x1a6)],_0x4dba4c(0x248))[_0x4dba4c(0x212)](),_0x5a2206=crypto_1[_0x4dba4c(0x1af)][_0x4dba4c(0x1f1)](_0x237707,Buffer[_0x4dba4c(0x158)](_0x403966,'base64')),_0x1f937a=JSON[_0x4dba4c(0x1ce)](_0x5a2206['toString']()),_0x1ee053=Buffer['from'](_0x1f937a[_0x4dba4c(0x20c)],_0x4dba4c(0x151)),_0x20fa71=Buffer[_0x4dba4c(0x158)](_0x1f937a['iv'],_0x4dba4c(0x151));return this[_0x4dba4c(0x1b2)](_0x2a82f2,_0x1ee053,_0x20fa71);}catch(_0x134c17){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a46_0x3532b5(0x1ea)](_0x263207){const _0x5ef9d1=a46_0x3532b5,{paymentId:_0x4678c0,orderId:_0x757c2f,amount:_0x58d60a,currency:_0x43b229,cardData:_0x396466,resultUrl:_0x4879a6,returnUrl:_0x212f01,cardHolder:_0x657d17,browser:_0x297387}=_0x263207;console['log']('===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x161),_0x4678c0),console['log']('Order\x20ID:',_0x757c2f),console[_0x5ef9d1(0x19b)]('Amount:',_0x58d60a,_0x43b229),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x16f),this['maskCardNumber'](_0x396466[_0x5ef9d1(0x1c6)])),console['log'](_0x5ef9d1(0x12f),_0x657d17[_0x5ef9d1(0x1bf)]+'\x20'+_0x657d17[_0x5ef9d1(0x1fb)]),console['log'](_0x5ef9d1(0x238),_0x212f01),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x185),_0x4879a6);const _0x59517a=this[_0x5ef9d1(0x1ad)](_0x396466[_0x5ef9d1(0x1c6)]);console[_0x5ef9d1(0x19b)]('🎯\x20Using\x20'+_0x59517a[_0x5ef9d1(0x17a)]+_0x5ef9d1(0x222)+_0x59517a[_0x5ef9d1(0x201)]),console['log'](_0x5ef9d1(0x1b8)+_0x59517a['privateKeyPath']+',\x20'+_0x59517a[_0x5ef9d1(0x162)]);const _0x50cf51={'amount':_0x58d60a,'currency':_0x43b229[_0x5ef9d1(0x252)](),'order_id':_0x757c2f,'result_url':_0x4879a6,'return_url':_0x212f01,'country':'','card':{'number':_0x396466[_0x5ef9d1(0x1c6)],'expire_month':_0x396466[_0x5ef9d1(0x217)],'expire_year':_0x396466[_0x5ef9d1(0x23a)],'cvv':_0x396466[_0x5ef9d1(0x1c3)]},'card_holder':_0x657d17,'browser':_0x297387},_0x496731=JSON[_0x5ef9d1(0x249)](_0x50cf51);console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x1f9)),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x20b)),console[_0x5ef9d1(0x19b)](_0x496731),console['log'](_0x5ef9d1(0x1e0),_0x496731[_0x5ef9d1(0x133)]);try{const {key:_0x24f06d,iv:_0x505748}=this[_0x5ef9d1(0x1dd)]();console['log']('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console['log'](_0x5ef9d1(0x1a3),_0x24f06d[_0x5ef9d1(0x133)]),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x19e),_0x505748[_0x5ef9d1(0x133)]);const _0x3c45d4=this[_0x5ef9d1(0x1c2)](_0x496731,_0x24f06d,_0x505748);console['log'](_0x5ef9d1(0x255)),console['log']('📝\x20Encrypted\x20data\x20length:',_0x3c45d4[_0x5ef9d1(0x133)]);const _0x35c5f6=this[_0x5ef9d1(0x127)](_0x24f06d,_0x505748,_0x59517a[_0x5ef9d1(0x162)]);console[_0x5ef9d1(0x19b)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x23c),_0x35c5f6[_0x5ef9d1(0x133)]);const _0x5405bc=this[_0x5ef9d1(0x244)](_0x496731,_0x59517a[_0x5ef9d1(0x1a6)]);console['log'](_0x5ef9d1(0x233)),console['log'](_0x5ef9d1(0x137),_0x5405bc[_0x5ef9d1(0x133)]);const _0x4a4743={'merchant_point_id':_0x59517a['merchantPointId'],'method':_0x5ef9d1(0x237),'info':_0x3c45d4,'key':_0x35c5f6,'sign':_0x5405bc,'lang':'en'};console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x141)),console['log'](_0x5ef9d1(0x227)),console[_0x5ef9d1(0x19b)]('\x20\x20\x20-\x20merchant_point_id:',_0x59517a[_0x5ef9d1(0x16b)]),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x18e)),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x14b),_0x3c45d4[_0x5ef9d1(0x133)]),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x22c),_0x35c5f6[_0x5ef9d1(0x133)]),console['log'](_0x5ef9d1(0x156),_0x5405bc[_0x5ef9d1(0x133)]),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x1a1)),loggerService_1[_0x5ef9d1(0x1d9)][_0x5ef9d1(0x1d5)](_0x59517a[_0x5ef9d1(0x17a)][_0x5ef9d1(0x241)](),_0x5ef9d1(0x188),'POST',{'merchant_point_id':_0x59517a['merchantPointId'],'method':_0x5ef9d1(0x237),'lang':'en'});const _0x2a0de1=Date[_0x5ef9d1(0x23e)](),_0x478760=await fetch(_0x59517a[_0x5ef9d1(0x201)],{'method':_0x5ef9d1(0x14f),'headers':{'Content-Type':_0x5ef9d1(0x20d),'Accept':_0x5ef9d1(0x20d),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x5ef9d1(0x249)](_0x4a4743)}),_0x77c62=Date[_0x5ef9d1(0x23e)]()-_0x2a0de1;console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x167)),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x1dc),_0x478760['status']),console['log'](_0x5ef9d1(0x1b6),_0x77c62+'ms');if(!_0x478760['ok']){const _0x1f5c1a=await _0x478760['text']();console[_0x5ef9d1(0x21a)](_0x5ef9d1(0x181),_0x478760['status']),console[_0x5ef9d1(0x21a)](_0x5ef9d1(0x171),_0x1f5c1a),loggerService_1[_0x5ef9d1(0x1d9)][_0x5ef9d1(0x12c)](_0x59517a[_0x5ef9d1(0x17a)][_0x5ef9d1(0x241)](),_0x5ef9d1(0x1de),_0x478760['status'],_0x1f5c1a,_0x77c62),loggerService_1['loggerService'][_0x5ef9d1(0x1fd)](_0x59517a[_0x5ef9d1(0x17a)][_0x5ef9d1(0x241)](),'/charge',_0x5ef9d1(0x153)+_0x478760[_0x5ef9d1(0x130)]+':\x20'+_0x1f5c1a);throw new Error(_0x5ef9d1(0x191)+_0x478760[_0x5ef9d1(0x130)]+_0x5ef9d1(0x1b3)+_0x1f5c1a);}const _0x1c3e50=await _0x478760[_0x5ef9d1(0x1bb)]();loggerService_1[_0x5ef9d1(0x1d9)][_0x5ef9d1(0x12c)](_0x59517a[_0x5ef9d1(0x17a)][_0x5ef9d1(0x241)](),_0x5ef9d1(0x1de),_0x478760[_0x5ef9d1(0x130)],_0x1c3e50,_0x77c62),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x1b9));let _0x246343=_0x1c3e50;if(_0x1c3e50[_0x5ef9d1(0x18d)]&&_0x1c3e50[_0x5ef9d1(0x20c)]&&_0x1c3e50['sign']){console[_0x5ef9d1(0x19b)]('🔐\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x265aa2=await this['decryptResponsePhp'](_0x1c3e50['info'],_0x1c3e50[_0x5ef9d1(0x20c)],_0x59517a['cardType']);_0x246343=JSON['parse'](_0x265aa2),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x1a5)),loggerService_1[_0x5ef9d1(0x1d9)][_0x5ef9d1(0x12c)](_0x59517a[_0x5ef9d1(0x17a)][_0x5ef9d1(0x241)](),_0x5ef9d1(0x125),_0x478760[_0x5ef9d1(0x130)],_0x246343,_0x77c62),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x1c5));}catch(_0x196531){console[_0x5ef9d1(0x21a)](_0x5ef9d1(0x258),_0x196531),loggerService_1[_0x5ef9d1(0x1d9)][_0x5ef9d1(0x1fd)](_0x59517a[_0x5ef9d1(0x17a)][_0x5ef9d1(0x241)](),'/charge_decrypt',_0x5ef9d1(0x245)+_0x196531),_0x246343=_0x1c3e50;}}else loggerService_1[_0x5ef9d1(0x1d9)]['logWhiteDomainResponse'](_0x59517a[_0x5ef9d1(0x17a)]['toLowerCase'](),_0x5ef9d1(0x125),_0x478760[_0x5ef9d1(0x130)],_0x246343,_0x77c62),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x1c7));console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x1dc),_0x246343['status']),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x198),_0x246343['final']),console[_0x5ef9d1(0x19b)]('Payment\x20ID:',_0x246343[_0x5ef9d1(0x1ac)]),console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x1b7),_0x246343[_0x5ef9d1(0x1ab)]||'none');if(_0x246343[_0x5ef9d1(0x130)]===0x64&&_0x246343['final']===0x1)return console[_0x5ef9d1(0x19b)]('✅\x20Payment\x20successful'),{'gateway_payment_id':_0x246343['payment_id']?.[_0x5ef9d1(0x1e8)](),'payment_url':_0x212f01,'requires_3ds':![],'status':_0x5ef9d1(0x192),'final':!![]};if(_0x246343[_0x5ef9d1(0x1ab)])return console['log'](_0x5ef9d1(0x179)),this[_0x5ef9d1(0x1d7)](_0x4678c0,_0x757c2f,_0x246343[_0x5ef9d1(0x1ac)]?.['toString']()||_0x757c2f,_0x59517a[_0x5ef9d1(0x17a)]),{'gateway_payment_id':_0x246343['payment_id']?.[_0x5ef9d1(0x1e8)](),'payment_url':_0x246343[_0x5ef9d1(0x1ab)],'requires_3ds':!![],'threeds_url':_0x246343[_0x5ef9d1(0x1ab)],'status':'PENDING','final':![]};let _0x1afc22=_0x246343['desc']||_0x246343[_0x5ef9d1(0x1f6)]||'Unknown\x20error',_0x9457d9=_0x246343[_0x5ef9d1(0x130)],_0x3804e5=_0x246343[_0x5ef9d1(0x126)];return console[_0x5ef9d1(0x19b)](_0x5ef9d1(0x14d)+_0x9457d9+_0x5ef9d1(0x1f4)+_0x3804e5+_0x5ef9d1(0x231)+_0x1afc22),{'gateway_payment_id':_0x246343[_0x5ef9d1(0x1ac)]?.[_0x5ef9d1(0x1e8)](),'payment_url':_0x212f01,'requires_3ds':![],'status':_0x5ef9d1(0x157),'final':!![]};}catch(_0x20787c){console[_0x5ef9d1(0x21a)]('===\x20PAYMENT\x20SERVICE\x20ERROR\x20==='),console['error'](_0x5ef9d1(0x1d4),_0x20787c),loggerService_1['loggerService'][_0x5ef9d1(0x1fd)](_0x5ef9d1(0x240),_0x5ef9d1(0x188),_0x20787c);throw new Error('Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'+(_0x20787c instanceof Error?_0x20787c['message']:_0x5ef9d1(0x17d)));}}async[a46_0x3532b5(0x160)](_0x4b23fd,_0x5d89ad,_0x351ba1=a46_0x3532b5(0x1bc)){const _0x5ce875=a46_0x3532b5;console[_0x5ce875(0x19b)](_0x5ce875(0x13c)+_0x351ba1+_0x5ce875(0x235)+_0x4b23fd+'\x20('+_0x5d89ad+')');try{const _0x346ee2={'payment_id':_0x4b23fd,'order_id':_0x5d89ad},_0x35f013=JSON['stringify'](_0x346ee2),_0x4f1b5f=this[_0x5ce875(0x1ad)](_0x351ba1==='VISA'?_0x5ce875(0x14c):'5000000000000000'),{key:_0x40f887,iv:_0xbcb42a}=this['generateAESKey'](),_0xd50fef=this[_0x5ce875(0x1c2)](_0x35f013,_0x40f887,_0xbcb42a),_0xca35f=this['encryptRSA'](_0x40f887,_0xbcb42a,_0x4f1b5f[_0x5ce875(0x162)]),_0x3ba2d1=this['signRSA'](_0x35f013,_0x4f1b5f['privateKeyPath']),_0x128541={'merchant_point_id':_0x4f1b5f[_0x5ce875(0x16b)],'method':_0x5ce875(0x130),'info':_0xd50fef,'key':_0xca35f,'sign':_0x3ba2d1,'lang':'en'};loggerService_1[_0x5ce875(0x1d9)][_0x5ce875(0x1d5)](_0x351ba1[_0x5ce875(0x241)](),_0x5ce875(0x1cc),_0x5ce875(0x14f),{'merchant_point_id':_0x4f1b5f[_0x5ce875(0x16b)],'method':_0x5ce875(0x130),'lang':'en'});const _0x16d353=Date[_0x5ce875(0x23e)](),_0x5105f1=await fetch(_0x4f1b5f[_0x5ce875(0x201)],{'method':_0x5ce875(0x14f),'headers':{'Content-Type':_0x5ce875(0x20d),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x5ce875(0x249)](_0x128541)}),_0x2941fe=Date[_0x5ce875(0x23e)]()-_0x16d353;if(!_0x5105f1['ok']){const _0x3bf504=await _0x5105f1[_0x5ce875(0x175)]();loggerService_1[_0x5ce875(0x1d9)][_0x5ce875(0x12c)](_0x351ba1[_0x5ce875(0x241)](),_0x5ce875(0x165),_0x5105f1[_0x5ce875(0x130)],_0x3bf504,_0x2941fe);throw new Error(_0x5ce875(0x191)+_0x5105f1[_0x5ce875(0x130)]);}const _0x10cf41=await _0x5105f1[_0x5ce875(0x1bb)]();loggerService_1[_0x5ce875(0x1d9)][_0x5ce875(0x12c)](_0x351ba1[_0x5ce875(0x241)](),_0x5ce875(0x165),_0x5105f1['status'],_0x10cf41,_0x2941fe);let _0x2c99cf=_0x10cf41;if(_0x10cf41[_0x5ce875(0x18d)]&&_0x10cf41[_0x5ce875(0x20c)]&&_0x10cf41['sign']){console['log']('🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0x3e5576=await this['decryptResponsePhp'](_0x10cf41['info'],_0x10cf41['key'],_0x351ba1);_0x2c99cf=JSON['parse'](_0x3e5576),console[_0x5ce875(0x19b)](_0x5ce875(0x24d)),loggerService_1[_0x5ce875(0x1d9)][_0x5ce875(0x12c)](_0x351ba1[_0x5ce875(0x241)](),_0x5ce875(0x159),_0x5105f1['status'],_0x2c99cf,_0x2941fe),console[_0x5ce875(0x19b)](_0x5ce875(0x204));}catch(_0x498145){console[_0x5ce875(0x21a)]('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x498145),loggerService_1['loggerService'][_0x5ce875(0x1fd)](_0x351ba1[_0x5ce875(0x241)](),'/status_decrypt',_0x5ce875(0x150)+_0x498145),_0x2c99cf=_0x10cf41;}}else loggerService_1[_0x5ce875(0x1d9)][_0x5ce875(0x12c)](_0x351ba1[_0x5ce875(0x241)](),'/status_decrypted',_0x5105f1[_0x5ce875(0x130)],_0x2c99cf,_0x2941fe),console['log'](_0x5ce875(0x225));console['log']('📊\x20Status\x20check\x20result:',{'status':_0x2c99cf[_0x5ce875(0x130)],'final':_0x2c99cf[_0x5ce875(0x126)],'payment_id':_0x2c99cf[_0x5ce875(0x1ac)],'desc':_0x2c99cf['desc']});let _0x58ac6e=_0x5ce875(0x1f0);if(_0x2c99cf['status']===0x64&&_0x2c99cf[_0x5ce875(0x126)]===0x1)_0x58ac6e='PAID';else{if(_0x2c99cf[_0x5ce875(0x126)]===0x0)_0x58ac6e=_0x5ce875(0x1f0);else _0x2c99cf[_0x5ce875(0x126)]===0x1&&_0x2c99cf[_0x5ce875(0x130)]!==0x64?_0x58ac6e=_0x5ce875(0x157):_0x58ac6e=_0x5ce875(0x1f0);}return{'status':_0x58ac6e,'final':_0x2c99cf['final']===0x1,'amount':_0x2c99cf[_0x5ce875(0x1be)],'currency':_0x2c99cf['currency'],'date_success':_0x2c99cf[_0x5ce875(0x149)],'description':_0x2c99cf['desc']};}catch(_0x5e232b){console[_0x5ce875(0x21a)](_0x351ba1+_0x5ce875(0x131),_0x5e232b),loggerService_1[_0x5ce875(0x1d9)][_0x5ce875(0x1fd)](_0x351ba1['toLowerCase'](),'/status',_0x5e232b);throw new Error('Failed\x20to\x20check\x20'+_0x351ba1+'\x20payment\x20status:\x20'+(_0x5e232b instanceof Error?_0x5e232b[_0x5ce875(0x1f6)]:_0x5ce875(0x17d)));}}[a46_0x3532b5(0x1d7)](_0x2250fc,_0x476551,_0xe7c67,_0x14a4bc){const _0x5f3712=a46_0x3532b5;console[_0x5f3712(0x19b)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20'+_0x14a4bc+_0x5f3712(0x21f)+_0x2250fc+'\x20('+_0xe7c67+')'),this[_0x5f3712(0x145)](_0x2250fc);const _0x265865=[],_0x1d3dc5=0x5*0x3c*0x3e8,_0x4e5b75=0x2*0x3c*0x3c*0x3e8,_0x3cf1dc=Math[_0x5f3712(0x229)](_0x4e5b75/_0x1d3dc5);console[_0x5f3712(0x19b)](_0x5f3712(0x16a)+_0x3cf1dc+_0x5f3712(0x22e));for(let _0x2e3e16=0x1;_0x2e3e16<=_0x3cf1dc;_0x2e3e16++){const _0x575a13=setTimeout(async()=>{const _0x1fafb1=_0x5f3712;console[_0x1fafb1(0x19b)](_0x1fafb1(0x205)+_0x14a4bc+_0x1fafb1(0x12d)+_0x2e3e16+'/'+_0x3cf1dc+'\x20for\x20payment\x20'+_0x2250fc);try{const _0x58deb0=await this['checkPaymentStatus'](_0xe7c67,_0x476551,_0x14a4bc);console['log'](_0x1fafb1(0x1d6)+_0x2e3e16+_0x1fafb1(0x239),_0x58deb0),_0x58deb0['final']&&(console[_0x1fafb1(0x19b)](_0x1fafb1(0x13d)+_0x2250fc+_0x1fafb1(0x140)+_0x58deb0['status']+_0x1fafb1(0x203)),this[_0x1fafb1(0x145)](_0x2250fc),await this[_0x1fafb1(0x1b0)](_0x2250fc,_0x58deb0[_0x1fafb1(0x130)],_0x58deb0));}catch(_0x47b21a){console[_0x1fafb1(0x21a)](_0x1fafb1(0x129)+_0x2e3e16+_0x1fafb1(0x17c)+_0x2250fc+':',_0x47b21a);}},_0x2e3e16*_0x1d3dc5);_0x265865[_0x5f3712(0x15f)](_0x575a13);}this[_0x5f3712(0x1c8)][_0x5f3712(0x12b)](_0x2250fc,_0x265865),console['log'](_0x5f3712(0x1f2)+_0x3cf1dc+_0x5f3712(0x190)+_0x2250fc);}[a46_0x3532b5(0x145)](_0x3419de){const _0x599ab1=a46_0x3532b5,_0x5b19e7=this['statusCheckTimers'][_0x599ab1(0x170)](_0x3419de);_0x5b19e7&&(console[_0x599ab1(0x19b)](_0x599ab1(0x22a)+_0x5b19e7[_0x599ab1(0x133)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x3419de),_0x5b19e7[_0x599ab1(0x183)]((_0x315dc2,_0x591df8)=>{clearTimeout(_0x315dc2);}),this[_0x599ab1(0x1c8)][_0x599ab1(0x250)](_0x3419de));}async['updatePaymentStatus'](_0x1a11ec,_0x4e59c0,_0x25927e){const _0x29d090=a46_0x3532b5;try{const _0x2e5929=(await Promise[_0x29d090(0x172)]()[_0x29d090(0x152)](()=>__importStar(require('../../config/database'))))[_0x29d090(0x1af)],_0x3f6845={'status':_0x4e59c0['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x29d090(0x138),'statusChangedAt':new Date()};_0x4e59c0===_0x29d090(0x192)&&(_0x3f6845[_0x29d090(0x1ba)]=new Date()),_0x4e59c0===_0x29d090(0x157)&&_0x25927e[_0x29d090(0x155)]&&(_0x3f6845[_0x29d090(0x259)]=_0x25927e[_0x29d090(0x155)],console[_0x29d090(0x19b)](_0x29d090(0x1ef)+_0x25927e['description'])),_0x25927e[_0x29d090(0x155)]&&(_0x3f6845['adminNotes']=(_0x4e59c0===_0x29d090(0x192)?'VISA/MasterCard\x20payment\x20successful':_0x29d090(0x21c))+':\x20'+_0x25927e[_0x29d090(0x155)]),await _0x2e5929[_0x29d090(0x1ee)][_0x29d090(0x1a0)]({'where':{'id':_0x1a11ec},'data':_0x3f6845}),console[_0x29d090(0x19b)](_0x29d090(0x13d)+_0x1a11ec+'\x20status\x20updated\x20to\x20'+_0x4e59c0),await this[_0x29d090(0x1bd)](_0x1a11ec,_0x4e59c0);}catch(_0x3bdc5c){console[_0x29d090(0x21a)](_0x29d090(0x1fe)+_0x1a11ec+':',_0x3bdc5c);}}async[a46_0x3532b5(0x1bd)](_0x2d6640,_0x50370a){const _0x1ffaa5=a46_0x3532b5;try{const _0x1d89c5=(await Promise['resolve']()['then'](()=>__importStar(require(_0x1ffaa5(0x20a)))))[_0x1ffaa5(0x1af)],{telegramBotService:_0x4c0554}=await Promise[_0x1ffaa5(0x172)]()[_0x1ffaa5(0x152)](()=>__importStar(require(_0x1ffaa5(0x1db)))),_0x5cb379=await _0x1d89c5['payment']['findUnique']({'where':{'id':_0x2d6640},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x5cb379)return;const _0x586e68={'PAID':_0x1ffaa5(0x168),'FAILED':_0x1ffaa5(0x166)},_0x54a3af=_0x586e68[_0x50370a];_0x54a3af&&await _0x4c0554[_0x1ffaa5(0x1a4)](_0x5cb379[_0x1ffaa5(0x1ed)],_0x5cb379,_0x54a3af),await this[_0x1ffaa5(0x135)](_0x5cb379,_0x50370a);}catch(_0x43be47){console[_0x1ffaa5(0x21a)](_0x1ffaa5(0x243),_0x43be47);}}async['sendShopWebhook'](_0xa77183,_0x38f2a3){const _0x4c5068=a46_0x3532b5,_0x5bed04=Date[_0x4c5068(0x23e)]();try{const _0xd5f18=_0xa77183[_0x4c5068(0x246)],_0x37d53d=_0xd5f18[_0x4c5068(0x23d)];if(!_0x37d53d?.['webhookUrl']){console[_0x4c5068(0x19b)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0xd5f18['id']);return;}const _0x1edbec=_0x38f2a3==='PAID'?_0x4c5068(0x173):'payment.failed';let _0x18f863=[];if(_0x37d53d[_0x4c5068(0x13b)])try{_0x18f863=Array[_0x4c5068(0x19a)](_0x37d53d[_0x4c5068(0x13b)])?_0x37d53d['webhookEvents']:JSON[_0x4c5068(0x1ce)](_0x37d53d[_0x4c5068(0x13b)]);}catch(_0x56299b){console[_0x4c5068(0x21a)](_0x4c5068(0x213),_0x56299b),_0x18f863=[];}if(!_0x18f863[_0x4c5068(0x18f)](_0x1edbec)){console['log'](_0x4c5068(0x17b)+_0x1edbec+'\x20not\x20enabled\x20for\x20shop\x20'+_0xd5f18['id']);return;}const _0x281b7b={'event':_0x1edbec,'payment':{'id':_0xa77183['id'],'order_id':_0xa77183[_0x4c5068(0x219)],'gateway_order_id':_0xa77183[_0x4c5068(0x19f)],'gateway':_0x4c5068(0x1d3),'amount':_0xa77183[_0x4c5068(0x1be)],'currency':_0xa77183['currency'],'status':_0x38f2a3[_0x4c5068(0x241)](),'customer_email':_0xa77183[_0x4c5068(0x142)],'customer_name':_0xa77183[_0x4c5068(0x19d)],'created_at':_0xa77183[_0x4c5068(0x24c)],'updated_at':new Date()}},_0x312d5c=await fetch(_0x37d53d[_0x4c5068(0x1e4)],{'method':_0x4c5068(0x14f),'headers':{'Content-Type':_0x4c5068(0x20d),'User-Agent':_0x4c5068(0x256)},'body':JSON['stringify'](_0x281b7b)}),_0x121458=Date['now']()-_0x5bed04;loggerService_1[_0x4c5068(0x1d9)][_0x4c5068(0x24f)](_0xa77183[_0x4c5068(0x1ed)],_0x37d53d[_0x4c5068(0x1e4)],_0x1edbec,_0x312d5c[_0x4c5068(0x130)],_0x121458,_0x281b7b),console[_0x4c5068(0x19b)](_0x4c5068(0x1e6)+_0x37d53d[_0x4c5068(0x1e4)]+_0x4c5068(0x199)+_0x312d5c[_0x4c5068(0x130)]+'\x20('+_0x121458+_0x4c5068(0x132));}catch(_0x59e1eb){console[_0x4c5068(0x21a)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x59e1eb),loggerService_1[_0x4c5068(0x1d9)][_0x4c5068(0x186)](_0xa77183['shopId'],_0xa77183[_0x4c5068(0x246)]?.[_0x4c5068(0x23d)]?.[_0x4c5068(0x1e4)]||_0x4c5068(0x251),'webhook_send',_0x59e1eb,{});}}[a46_0x3532b5(0x154)](_0x174259){const _0x519edc=a46_0x3532b5,_0x28014d=_0x174259[_0x519edc(0x22b)](/[\s-]/g,'');if(_0x28014d[_0x519edc(0x133)]<0x4)return'****';return _0x519edc(0x14a)+_0x28014d[_0x519edc(0x15e)](-0x4);}async['processWebhook'](_0x1c6a8b,_0x2ed2fc='MASTERCARD'){const _0x4e16d4=a46_0x3532b5;console[_0x4e16d4(0x19b)](_0x4e16d4(0x230),JSON[_0x4e16d4(0x249)](_0x1c6a8b,null,0x2));let _0x234ed6=_0x1c6a8b,_0x530a5a=_0x2ed2fc;_0x1c6a8b[_0x4e16d4(0x19c)]?(_0x530a5a=_0x1c6a8b[_0x4e16d4(0x19c)]['toUpperCase']()===_0x4e16d4(0x1bc)?_0x4e16d4(0x1bc):_0x4e16d4(0x23b),console[_0x4e16d4(0x19b)](_0x4e16d4(0x1aa)+_0x530a5a)):console[_0x4e16d4(0x19b)](_0x4e16d4(0x1e2)+_0x530a5a);if(_0x1c6a8b[_0x4e16d4(0x18d)]&&_0x1c6a8b['key']&&_0x1c6a8b['sign']){console[_0x4e16d4(0x19b)](_0x4e16d4(0x1a8));try{const _0x13b924=await this[_0x4e16d4(0x193)](_0x1c6a8b['info'],_0x1c6a8b['key'],_0x530a5a);_0x234ed6=JSON[_0x4e16d4(0x1ce)](_0x13b924),console[_0x4e16d4(0x19b)](_0x4e16d4(0x180)),console[_0x4e16d4(0x19b)](_0x4e16d4(0x15a),JSON[_0x4e16d4(0x249)](_0x234ed6,null,0x2));}catch(_0x3e415e){console[_0x4e16d4(0x21a)](_0x4e16d4(0x146),_0x3e415e),console['log'](_0x4e16d4(0x224)),_0x234ed6=_0x1c6a8b;}}else console['log']('📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0x5a0c54=_0x4e16d4(0x1f0);if(_0x234ed6[_0x4e16d4(0x130)]===0x64&&_0x234ed6[_0x4e16d4(0x126)]===0x1)_0x5a0c54=_0x4e16d4(0x192);else{if(_0x234ed6[_0x4e16d4(0x126)]===0x0)_0x5a0c54=_0x4e16d4(0x1f0);else _0x234ed6[_0x4e16d4(0x126)]===0x1&&_0x234ed6[_0x4e16d4(0x130)]!==0x64?_0x5a0c54=_0x4e16d4(0x157):_0x5a0c54=_0x4e16d4(0x1f0);}let _0x5042f='';if(_0x234ed6[_0x4e16d4(0x226)])_0x5042f=_0x234ed6[_0x4e16d4(0x226)][_0x4e16d4(0x1e8)](),console[_0x4e16d4(0x19b)](_0x4e16d4(0x209)+_0x530a5a+'\x20order_id\x20for\x20search:\x20'+_0x5042f);else _0x234ed6[_0x4e16d4(0x1ac)]?(_0x5042f=_0x234ed6[_0x4e16d4(0x1ac)][_0x4e16d4(0x1e8)](),console[_0x4e16d4(0x19b)](_0x4e16d4(0x209)+_0x530a5a+_0x4e16d4(0x13a)+_0x5042f)):(_0x5042f=_0x234ed6[_0x4e16d4(0x219)]||_0x234ed6[_0x4e16d4(0x13f)]||_0x234ed6['id']||'',console['log'](_0x4e16d4(0x1b1)+_0x5042f));console[_0x4e16d4(0x19b)](_0x4e16d4(0x1f5)+_0x530a5a+_0x4e16d4(0x128)),console[_0x4e16d4(0x19b)](_0x4e16d4(0x1d2)+_0x5042f+_0x4e16d4(0x12e)+_0x234ed6[_0x4e16d4(0x226)]+_0x4e16d4(0x210)+_0x234ed6['orderId']+_0x4e16d4(0x178)+_0x234ed6[_0x4e16d4(0x1ac)]+_0x4e16d4(0x207)+_0x234ed6['paymentId']+',\x20id='+_0x234ed6['id']+')'),console[_0x4e16d4(0x19b)](_0x4e16d4(0x242)+_0x5a0c54+_0x4e16d4(0x195)+_0x234ed6['status']+_0x4e16d4(0x1d8)+_0x234ed6['final']+')'),console[_0x4e16d4(0x19b)](_0x4e16d4(0x18c)+_0x234ed6[_0x4e16d4(0x1be)]),console['log'](_0x4e16d4(0x12a)+_0x234ed6[_0x4e16d4(0x1a9)]);let _0x430458;_0x5a0c54==='FAILED'&&_0x234ed6[_0x4e16d4(0x208)]&&(_0x430458=_0x234ed6[_0x4e16d4(0x208)],console[_0x4e16d4(0x19b)](_0x4e16d4(0x1b5)+_0x430458));const _0x2e7d2f={'paymentId':_0x5042f,'status':_0x5a0c54,'amount':_0x234ed6[_0x4e16d4(0x1be)],'currency':_0x234ed6[_0x4e16d4(0x1a9)]};return _0x430458&&(_0x2e7d2f[_0x4e16d4(0x259)]=_0x430458),_0x2e7d2f;}[a46_0x3532b5(0x228)](){const _0x35b962=a46_0x3532b5;console[_0x35b962(0x19b)](_0x35b962(0x196));const _0x39df51=this[_0x35b962(0x1c8)][_0x35b962(0x139)];for(const [_0x2df80e]of this['statusCheckTimers']){this[_0x35b962(0x145)](_0x2df80e);}console[_0x35b962(0x19b)](_0x35b962(0x216)+_0x39df51+_0x35b962(0x1ec));}}function a46_0x1203(_0x3037bd,_0x5ba31d){const _0x56dbca=a46_0x56db();return a46_0x1203=function(_0x12034d,_0x3c3217){_0x12034d=_0x12034d-0x125;let _0x838c4c=_0x56dbca[_0x12034d];return _0x838c4c;},a46_0x1203(_0x3037bd,_0x5ba31d);}exports['VisaMasterCardService']=VisaMasterCardService;