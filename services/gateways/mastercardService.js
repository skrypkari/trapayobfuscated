'use strict';const a42_0x2a25b3=a42_0x3179;(function(_0x43c37e,_0x54aee4){const _0x5aed36=a42_0x3179,_0x54d851=_0x43c37e();while(!![]){try{const _0xa39458=-parseInt(_0x5aed36(0x1b5))/0x1*(parseInt(_0x5aed36(0x177))/0x2)+-parseInt(_0x5aed36(0x15e))/0x3*(-parseInt(_0x5aed36(0x139))/0x4)+parseInt(_0x5aed36(0x1ac))/0x5+parseInt(_0x5aed36(0x1c9))/0x6*(-parseInt(_0x5aed36(0x1e2))/0x7)+parseInt(_0x5aed36(0x1a8))/0x8+parseInt(_0x5aed36(0x1c2))/0x9*(-parseInt(_0x5aed36(0x141))/0xa)+parseInt(_0x5aed36(0x198))/0xb;if(_0xa39458===_0x54aee4)break;else _0x54d851['push'](_0x54d851['shift']());}catch(_0x198a9c){_0x54d851['push'](_0x54d851['shift']());}}}(a42_0x15d9,0xcb2e9));function a42_0x15d9(){const _0x413ee8=['writable','3ds_url','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','createSign','paid','1111','sendPaymentNotifications','...','processWebhook','slice','244150rfDNbJ','Result\x20URL:','3DS\x20URL:','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','✅\x20Payment\x20','🛑\x20Stopped\x20','merchantPointId','\x20\x20\x20-\x20merchant_point_id:','cvv','🔐\x20Private\x20key\x20length:\x20','now','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','log','psp_public.pem','📝\x20Encrypted\x20key\x20length:','updatePaymentStatus','parse','default','signRSA','/charge_decrypt','expire_year','last_name','clearStatusTimers','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','stopAllStatusChecks','),\x20stopping\x20status\x20checks','shop','error','logWhiteDomainError','base64','customerEmail','❌\x20RSA\x20encryption\x20failed:','7588812owkJWV','🔐\x20Data\x20signed\x20with\x20RSA','cwd','currency',',\x20Final:\x20','-----END','\x20status\x20timers\x20for\x20payment\x20',',\x20Desc:\x20','statusCheckTimers','__setModuleDefault','__esModule','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','🔐\x20Private\x20key\x20path:','✅\x20Status\x20response\x20decrypted\x20successfully','Error\x20parsing\x20webhook\x20events:','\x20for\x20payment\x20','10461336BaKsmv','update','Card\x20Holder:','logWhiteDomainResponse','1626760bGFGTU','Response\x20Time:','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','✅\x20Scheduled\x20','Order\x20ID:','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','logShopWebhookSent','webhookUrl','createCipheriv','13HJNAWE','toString','readFileSync','Unknown\x20error','https://api2.trapay.uk/decrypt.php','****','paidAt','aes-256-ctr','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','MasterCard\x20webhook\x20sent\x20to\x20','final','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','validateKeyFiles','126891Mtwize','failed','webhookEvents','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','\x20\x20\x20-\x20info\x20length:','2580aIqtIV','includes','size','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','join','privateKeyPath','/status','\x20\x20\x20-\x20method:\x20charge','../loggerService','\x20status\x20checks\x20for\x20payment\x20','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','📝\x20Data\x20to\x20sign\x20length:','charge','desc','❌\x20PHP\x20decryptor\x20request\x20failed:','constants','📊\x20Status\x20check\x20result:','PENDING','payment','/charge','ms)','payment.failed','sendShopWebhook','🔐\x20AES\x20IV\x20length:','7301PVmnwd','../../config/database','MasterCard\x20status\x20check\x20error:','Status:','publicKeyPath','/charge_raw','createDecipheriv','isArray','FAILED','🔐\x20Data\x20encrypted\x20with\x20AES','path','floor','apiUrl','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','💳\x20MasterCard\x20service\x20initialized','utf8','RSA_PKCS1_PADDING','customerName','configurable','decryptResponse','text','info','Processing\x20MasterCard\x20webhook:','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','checkPaymentStatus','decryptAES','Failed\x20to\x20decrypt\x20response','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','amount','📝\x20Data\x20length:','📊\x20Status\x20check\x20#','findUnique','encryptRSA','payment.success','getOwnPropertyDescriptor','status','/status_decrypted','logWhiteDomainRequest','sendPaymentNotification','length','⏰\x20Will\x20check\x20status\x20','https://api.paydmeth.com/api','🔐\x20AES\x20key\x20length:','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','📝\x20Signature\x20length:','Status\x20decryption\x20failed:\x20','Final:','trim','\x20not\x20enabled\x20for\x20shop\x20','decryptResponsePhp','message','HTTP\x20','then','__importDefault','📝\x20Encrypted\x20data\x20length:','createdAt','crypto','publicEncrypt','\x20failed\x20for\x20payment\x20','Failed\x20to\x20send\x20payment\x20notifications:','\x20\x20\x20-\x20sign\x20length:','create','sign','number','/status_raw','from','processCardPayment','encryptAES','key','-----BEGIN','PHP\x20decryptor\x20error','💾\x20Payment\x20data\x20prepared','Failed\x20to\x20send\x20MasterCard\x20webhook:','randomBytes','mastercard','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','TesSoft\x20Payment\x20System/1.0','Public\x20key\x20file\x20not\x20found:\x20','../telegramBotService','604GVaDyX','\x20\x20\x20-\x20lang:\x20en','defineProperty','maskCardNumber','get','/charge_decrypted','push','toUpperCase','570KwdFlg','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20with\x20status\x20','orderId','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','prototype','logShopWebhookError','POST','call','payment_id','stringify','generateAESKey','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','settings','unknown','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','PAID','❌\x20Status\x20check\x20#','loggerService','existsSync','Return\x20URL:','Private\x20key\x20file\x20not\x20found:\x20','privateDecrypt','🔐\x20AES\x20key\x20and\x20IV\x20generated','date_success','\x20MasterCard\x20status\x20check\x20timers','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','resolve','26790BKeoam','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','__importStar','substring','✅\x20Payment\x20successful','webhook_send','/status_decrypt','replace','application/json','Payment\x20ID:','Webhook\x20event\x20','❌\x20RSA\x20signing\x20failed:','MasterCardService','❌\x20MasterCard\x20key\x20validation\x20failed:','🧹\x20Clearing\x20'];a42_0x15d9=function(){return _0x413ee8;};return a42_0x15d9();}var __createBinding=this&&this['__createBinding']||(Object[a42_0x2a25b3(0x127)]?function(_0x16af34,_0x520463,_0x4668bd,_0x4e8f80){const _0x158313=a42_0x2a25b3;if(_0x4e8f80===undefined)_0x4e8f80=_0x4668bd;var _0x2eafe9=Object[_0x158313(0x10c)](_0x520463,_0x4668bd);(!_0x2eafe9||('get'in _0x2eafe9?!_0x520463['__esModule']:_0x2eafe9[_0x158313(0x16d)]||_0x2eafe9[_0x158313(0xfc)]))&&(_0x2eafe9={'enumerable':!![],'get':function(){return _0x520463[_0x4668bd];}}),Object[_0x158313(0x13b)](_0x16af34,_0x4e8f80,_0x2eafe9);}:function(_0x3d23c8,_0x3e86d8,_0xef909f,_0x322c53){if(_0x322c53===undefined)_0x322c53=_0xef909f;_0x3d23c8[_0x322c53]=_0x3e86d8[_0xef909f];}),__setModuleDefault=this&&this[a42_0x2a25b3(0x1a1)]||(Object[a42_0x2a25b3(0x127)]?function(_0x5885bb,_0x8004ad){const _0x159dae=a42_0x2a25b3;Object['defineProperty'](_0x5885bb,_0x159dae(0x188),{'enumerable':!![],'value':_0x8004ad});}:function(_0x504875,_0x23b066){const _0x4b4b46=a42_0x2a25b3;_0x504875[_0x4b4b46(0x188)]=_0x23b066;}),__importStar=this&&this[a42_0x2a25b3(0x160)]||(function(){var _0x150d42=function(_0x4966c2){return _0x150d42=Object['getOwnPropertyNames']||function(_0x58e637){const _0x2f3349=a42_0x3179;var _0x35dbef=[];for(var _0x3975a1 in _0x58e637)if(Object[_0x2f3349(0x146)]['hasOwnProperty'][_0x2f3349(0x149)](_0x58e637,_0x3975a1))_0x35dbef[_0x35dbef[_0x2f3349(0x111)]]=_0x3975a1;return _0x35dbef;},_0x150d42(_0x4966c2);};return function(_0x45d083){const _0x37ae8c=a42_0x3179;if(_0x45d083&&_0x45d083[_0x37ae8c(0x1a2)])return _0x45d083;var _0x13b164={};if(_0x45d083!=null){for(var _0x34da1c=_0x150d42(_0x45d083),_0x655f5a=0x0;_0x655f5a<_0x34da1c[_0x37ae8c(0x111)];_0x655f5a++)if(_0x34da1c[_0x655f5a]!=='default')__createBinding(_0x13b164,_0x45d083,_0x34da1c[_0x655f5a]);}return __setModuleDefault(_0x13b164,_0x45d083),_0x13b164;};}()),__importDefault=this&&this[a42_0x2a25b3(0x11f)]||function(_0xc8e07e){const _0x5b6a22=a42_0x2a25b3;return _0xc8e07e&&_0xc8e07e[_0x5b6a22(0x1a2)]?_0xc8e07e:{'default':_0xc8e07e};};Object['defineProperty'](exports,a42_0x2a25b3(0x1a2),{'value':!![]}),exports[a42_0x2a25b3(0x16a)]=void 0x0;const crypto_1=__importDefault(require(a42_0x2a25b3(0x122))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x2a25b3(0x1ec))),loggerService_1=require(a42_0x2a25b3(0x1d2));class MasterCardService{constructor(){const _0x478127=a42_0x2a25b3;this[_0x478127(0x1a0)]=new Map(),this[_0x478127(0x1ee)]=_0x478127(0x113),this[_0x478127(0x17d)]=0x67c,this[_0x478127(0x1cf)]=path_1['default'][_0x478127(0x1ce)](process[_0x478127(0x19a)](),'keys','private.pem'),this[_0x478127(0x1e6)]=path_1[_0x478127(0x188)][_0x478127(0x1ce)](process['cwd'](),'keys',_0x478127(0x184)),console[_0x478127(0x183)](_0x478127(0x1f0)),console[_0x478127(0x183)](_0x478127(0x1a4),this['privateKeyPath']),console[_0x478127(0x183)]('🔐\x20Public\x20key\x20path:',this[_0x478127(0x1e6)]),this['validateKeyFiles']();}[a42_0x2a25b3(0x1c1)](){const _0x309def=a42_0x2a25b3;try{if(!fs_1[_0x309def(0x188)][_0x309def(0x154)](this[_0x309def(0x1cf)]))throw new Error(_0x309def(0x156)+this[_0x309def(0x1cf)]);if(!fs_1[_0x309def(0x188)][_0x309def(0x154)](this[_0x309def(0x1e6)]))throw new Error(_0x309def(0x137)+this[_0x309def(0x1e6)]);const _0x13e1c2=fs_1[_0x309def(0x188)][_0x309def(0x1b7)](this[_0x309def(0x1cf)],_0x309def(0xf9))[_0x309def(0x119)](),_0x1e4b07=fs_1['default'][_0x309def(0x1b7)](this[_0x309def(0x1e6)],_0x309def(0xf9))['trim']();if(!_0x13e1c2[_0x309def(0x1ca)]('-----BEGIN')||!_0x13e1c2[_0x309def(0x1ca)](_0x309def(0x19d)))throw new Error(_0x309def(0x145));if(!_0x1e4b07['includes'](_0x309def(0x12f))||!_0x1e4b07[_0x309def(0x1ca)](_0x309def(0x19d)))throw new Error(_0x309def(0x14d));console[_0x309def(0x183)](_0x309def(0x105)),console[_0x309def(0x183)](_0x309def(0x180)+_0x13e1c2['length']+'\x20characters'),console[_0x309def(0x183)]('🔐\x20Public\x20key\x20length:\x20'+_0x1e4b07['length']+'\x20characters');}catch(_0x45eb9e){console[_0x309def(0x193)](_0x309def(0x16b),_0x45eb9e);throw _0x45eb9e;}}[a42_0x2a25b3(0x14c)](){const _0x19d672=a42_0x2a25b3,_0x44048d=crypto_1[_0x19d672(0x188)][_0x19d672(0x133)](0x20),_0x2dda32=crypto_1[_0x19d672(0x188)][_0x19d672(0x133)](0x10);return{'key':_0x44048d,'iv':_0x2dda32};}[a42_0x2a25b3(0x12d)](_0x11536c,_0x38f278,_0x582899){const _0x2f0218=a42_0x2a25b3,_0x301294=crypto_1[_0x2f0218(0x188)][_0x2f0218(0x1b4)](_0x2f0218(0x1bc),_0x38f278,_0x582899);let _0x385cfd=_0x301294[_0x2f0218(0x1a9)](_0x11536c,_0x2f0218(0xf9),_0x2f0218(0x195));return _0x385cfd+=_0x301294[_0x2f0218(0x1bf)](_0x2f0218(0x195)),_0x385cfd;}[a42_0x2a25b3(0x10a)](_0x45873b,_0x357300){const _0x3d898f=a42_0x2a25b3;try{const _0x55b417=fs_1['default'][_0x3d898f(0x1b7)](this['publicKeyPath'],'utf8')[_0x3d898f(0x119)](),_0x215ad3={'iv':_0x357300['toString'](_0x3d898f(0x195)),'key':_0x45873b[_0x3d898f(0x1b6)]('base64')},_0x863b95=JSON[_0x3d898f(0x14b)](_0x215ad3);console[_0x3d898f(0x183)](_0x3d898f(0x1bd),_0x863b95[_0x3d898f(0x111)]);const _0x568320=crypto_1[_0x3d898f(0x188)][_0x3d898f(0x123)]({'key':_0x55b417,'padding':crypto_1[_0x3d898f(0x188)][_0x3d898f(0x1d9)][_0x3d898f(0xfa)]},Buffer['from'](_0x863b95));return console[_0x3d898f(0x183)]('✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x568320['length']),_0x568320[_0x3d898f(0x1b6)]('base64');}catch(_0x550f8f){console[_0x3d898f(0x193)](_0x3d898f(0x197),_0x550f8f);throw new Error(_0x3d898f(0x182));}}['signRSA'](_0xdb5bf4){const _0x26e2d9=a42_0x2a25b3;try{const _0x166316=fs_1[_0x26e2d9(0x188)][_0x26e2d9(0x1b7)](this[_0x26e2d9(0x1cf)],_0x26e2d9(0xf9))['trim'](),_0x2b1057=crypto_1[_0x26e2d9(0x188)][_0x26e2d9(0x170)]('SHA256');_0x2b1057[_0x26e2d9(0x1a9)](_0xdb5bf4),_0x2b1057['end']();const _0x264dd1=_0x2b1057['sign'](_0x166316,_0x26e2d9(0x195));return console[_0x26e2d9(0x183)]('🔐\x20RSA\x20signing\x20successful'),console[_0x26e2d9(0x183)](_0x26e2d9(0x1d5),_0xdb5bf4[_0x26e2d9(0x111)]),console[_0x26e2d9(0x183)](_0x26e2d9(0x116),_0x264dd1[_0x26e2d9(0x111)]),_0x264dd1;}catch(_0x206422){console[_0x26e2d9(0x193)](_0x26e2d9(0x169),_0x206422),console[_0x26e2d9(0x193)]('❌\x20Data\x20being\x20signed:',_0xdb5bf4[_0x26e2d9(0x161)](0x0,0xc8)+_0x26e2d9(0x174));throw new Error(_0x26e2d9(0x1d4));}}['decryptAES'](_0xa7485a,_0x14a83f,_0x558094){const _0xb0fb99=a42_0x2a25b3,_0x791ca4=crypto_1['default'][_0xb0fb99(0x1e8)](_0xb0fb99(0x1bc),_0x14a83f,_0x558094);let _0x3e82e1=_0x791ca4[_0xb0fb99(0x1a9)](_0xa7485a,_0xb0fb99(0x195),'utf8');return _0x3e82e1+=_0x791ca4[_0xb0fb99(0x1bf)]('utf8'),_0x3e82e1;}async[a42_0x2a25b3(0x11b)](_0x1182f4,_0x46bc00){const _0x461ac9=a42_0x2a25b3;try{const _0x24bc69=await fetch(_0x461ac9(0x1b9),{'method':_0x461ac9(0x148),'headers':{'Content-Type':'application/json'},'body':JSON[_0x461ac9(0x14b)]({'info':_0x1182f4,'key':_0x46bc00})});if(!_0x24bc69['ok'])throw new Error(_0x461ac9(0x130));return await _0x24bc69[_0x461ac9(0xfe)]();}catch(_0x8b08e){console[_0x461ac9(0x193)](_0x461ac9(0x1d8),_0x8b08e);throw new Error(_0x461ac9(0x1ae));}}[a42_0x2a25b3(0xfd)](_0x39cdd2,_0xf286e){const _0x1507d6=a42_0x2a25b3;try{const _0x52a242=fs_1['default']['readFileSync'](this[_0x1507d6(0x1cf)],_0x1507d6(0xf9))['trim'](),_0x2bb49e=crypto_1['default'][_0x1507d6(0x157)](_0x52a242,Buffer[_0x1507d6(0x12b)](_0xf286e,_0x1507d6(0x195))),_0x4f7051=JSON[_0x1507d6(0x187)](_0x2bb49e[_0x1507d6(0x1b6)]()),_0x270f60=Buffer['from'](_0x4f7051[_0x1507d6(0x12e)],_0x1507d6(0x195)),_0x499638=Buffer[_0x1507d6(0x12b)](_0x4f7051['iv'],_0x1507d6(0x195));return this[_0x1507d6(0x103)](_0x39cdd2,_0x270f60,_0x499638);}catch(_0x3b93c4){throw new Error(_0x1507d6(0x104));}}async[a42_0x2a25b3(0x12c)](_0x5a1c48){const _0x180728=a42_0x2a25b3,{paymentId:_0x290f23,orderId:_0x2620de,amount:_0x3f51e0,currency:_0x48ccb9,cardData:_0x32f4d1,resultUrl:_0x5384c4,returnUrl:_0x2b9f3,cardHolder:_0x47f375,browser:_0x1f2039}=_0x5a1c48;console['log'](_0x180728(0x18e)),console['log'](_0x180728(0x167),_0x290f23),console[_0x180728(0x183)](_0x180728(0x1b0),_0x2620de),console[_0x180728(0x183)]('Amount:',_0x3f51e0,_0x48ccb9),console['log']('Card\x20Number:',this[_0x180728(0x13c)](_0x32f4d1[_0x180728(0x129)])),console[_0x180728(0x183)](_0x180728(0x1aa),_0x47f375['first_name']+'\x20'+_0x47f375[_0x180728(0x18c)]),console[_0x180728(0x183)](_0x180728(0x155),_0x2b9f3),console[_0x180728(0x183)](_0x180728(0x178),_0x5384c4);const _0xb066b6={'amount':_0x3f51e0,'currency':_0x48ccb9['toUpperCase'](),'order_id':_0x2620de,'result_url':_0x5384c4,'return_url':_0x2b9f3,'card':{'number':_0x32f4d1[_0x180728(0x129)],'expire_month':_0x32f4d1['expire_month'],'expire_year':_0x32f4d1[_0x180728(0x18b)],'cvv':_0x32f4d1[_0x180728(0x17f)]},'card_holder':_0x47f375,'browser':_0x1f2039},_0x13a0f5=JSON[_0x180728(0x14b)](_0xb066b6);console[_0x180728(0x183)](_0x180728(0x131)),console['log'](_0x180728(0x101)),console[_0x180728(0x183)](_0x13a0f5),console['log'](_0x180728(0x107),_0x13a0f5[_0x180728(0x111)]);try{const {key:_0x467013,iv:_0x2b1c8a}=this[_0x180728(0x14c)]();console[_0x180728(0x183)](_0x180728(0x158)),console[_0x180728(0x183)](_0x180728(0x114),_0x467013[_0x180728(0x111)]),console[_0x180728(0x183)](_0x180728(0x1e1),_0x2b1c8a[_0x180728(0x111)]);const _0x37acfc=this['encryptAES'](_0x13a0f5,_0x467013,_0x2b1c8a);console[_0x180728(0x183)](_0x180728(0x1eb)),console[_0x180728(0x183)](_0x180728(0x120),_0x37acfc[_0x180728(0x111)]);const _0xbb9e2b=this[_0x180728(0x10a)](_0x467013,_0x2b1c8a);console[_0x180728(0x183)](_0x180728(0x1c7)),console[_0x180728(0x183)](_0x180728(0x185),_0xbb9e2b['length']);const _0x2ff5e9=this[_0x180728(0x189)](_0x13a0f5);console[_0x180728(0x183)](_0x180728(0x199)),console[_0x180728(0x183)](_0x180728(0x116),_0x2ff5e9[_0x180728(0x111)]);const _0x3f4fd1={'merchant_point_id':this['merchantPointId'],'method':_0x180728(0x1d6),'info':_0x37acfc,'key':_0xbb9e2b,'sign':_0x2ff5e9,'lang':'en'};console['log'](_0x180728(0x115)),console['log']('📝\x20Final\x20request\x20structure:'),console[_0x180728(0x183)](_0x180728(0x17e),this[_0x180728(0x17d)]),console[_0x180728(0x183)](_0x180728(0x1d1)),console[_0x180728(0x183)](_0x180728(0x1c8),_0x37acfc[_0x180728(0x111)]),console[_0x180728(0x183)]('\x20\x20\x20-\x20key\x20length:',_0xbb9e2b[_0x180728(0x111)]),console[_0x180728(0x183)](_0x180728(0x126),_0x2ff5e9[_0x180728(0x111)]),console[_0x180728(0x183)](_0x180728(0x13a)),loggerService_1['loggerService'][_0x180728(0x10f)](_0x180728(0x134),'/charge',_0x180728(0x148),{'merchant_point_id':this[_0x180728(0x17d)],'method':_0x180728(0x1d6),'lang':'en'});const _0x300aa7=Date['now'](),_0x38966b=await fetch(this[_0x180728(0x1ee)],{'method':_0x180728(0x148),'headers':{'Content-Type':_0x180728(0x166),'Accept':_0x180728(0x166),'User-Agent':_0x180728(0x136)},'body':JSON[_0x180728(0x14b)](_0x3f4fd1)}),_0x55ea80=Date['now']()-_0x300aa7;console[_0x180728(0x183)](_0x180728(0x1cd)),console[_0x180728(0x183)](_0x180728(0x1e5),_0x38966b['status']),console[_0x180728(0x183)](_0x180728(0x1ad),_0x55ea80+'ms');if(!_0x38966b['ok']){const _0x3207b1=await _0x38966b[_0x180728(0xfe)]();console[_0x180728(0x193)]('HTTP\x20Status:',_0x38966b[_0x180728(0x10d)]),console['error']('Response\x20Body:',_0x3207b1),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x180728(0x134),_0x180728(0x1e7),_0x38966b['status'],_0x3207b1,_0x55ea80),loggerService_1[_0x180728(0x153)][_0x180728(0x194)](_0x180728(0x134),_0x180728(0x1dd),_0x180728(0x11d)+_0x38966b[_0x180728(0x10d)]+':\x20'+_0x3207b1);throw new Error('HTTP\x20error!\x20status:\x20'+_0x38966b[_0x180728(0x10d)]+',\x20body:\x20'+_0x3207b1);}const _0x5d2420=await _0x38966b['json']();loggerService_1[_0x180728(0x153)][_0x180728(0x1ab)]('mastercard',_0x180728(0x1e7),_0x38966b[_0x180728(0x10d)],_0x5d2420,_0x55ea80),console[_0x180728(0x183)]('===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===');let _0x38b36b=_0x5d2420;if(_0x5d2420['info']&&_0x5d2420[_0x180728(0x12e)]&&_0x5d2420[_0x180728(0x128)]){console[_0x180728(0x183)]('🔐\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x2332d4=await this[_0x180728(0x11b)](_0x5d2420[_0x180728(0xff)],_0x5d2420[_0x180728(0x12e)]);_0x38b36b=JSON[_0x180728(0x187)](_0x2332d4),console[_0x180728(0x183)](_0x180728(0x150)),loggerService_1[_0x180728(0x153)][_0x180728(0x1ab)](_0x180728(0x134),_0x180728(0x13e),_0x38966b[_0x180728(0x10d)],_0x38b36b,_0x55ea80),console['log'](_0x180728(0x135));}catch(_0x4fe793){console['error'](_0x180728(0x1b1),_0x4fe793),loggerService_1[_0x180728(0x153)][_0x180728(0x194)](_0x180728(0x134),_0x180728(0x18a),'Decryption\x20failed:\x20'+_0x4fe793),_0x38b36b=_0x5d2420;}}else loggerService_1[_0x180728(0x153)][_0x180728(0x1ab)](_0x180728(0x134),_0x180728(0x13e),_0x38966b['status'],_0x38b36b,_0x55ea80),console[_0x180728(0x183)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x180728(0x183)](_0x180728(0x1e5),_0x38b36b[_0x180728(0x10d)]),console[_0x180728(0x183)](_0x180728(0x118),_0x38b36b[_0x180728(0x1bf)]),console[_0x180728(0x183)](_0x180728(0x167),_0x38b36b['payment_id']),console[_0x180728(0x183)](_0x180728(0x179),_0x38b36b['3ds_url']||'none');if(_0x38b36b['status']===0x64&&_0x38b36b['final']===0x1)return console[_0x180728(0x183)](_0x180728(0x162)),{'gateway_payment_id':_0x38b36b[_0x180728(0x14a)]?.['toString'](),'payment_url':_0x2b9f3,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x38b36b[_0x180728(0x16e)])return console[_0x180728(0x183)]('🔐\x203DS\x20verification\x20required'),this['scheduleStatusChecks'](_0x290f23,_0x2620de,_0x38b36b[_0x180728(0x14a)]?.[_0x180728(0x1b6)]()||_0x2620de),{'gateway_payment_id':_0x38b36b[_0x180728(0x14a)]?.[_0x180728(0x1b6)](),'payment_url':_0x38b36b[_0x180728(0x16e)],'requires_3ds':!![],'threeds_url':_0x38b36b[_0x180728(0x16e)],'status':_0x180728(0x1db),'final':![]};let _0x19a577=_0x38b36b['desc']||_0x38b36b[_0x180728(0x11c)]||_0x180728(0x1b8),_0x24fe70=_0x38b36b[_0x180728(0x10d)],_0x55ca98=_0x38b36b[_0x180728(0x1bf)];return console[_0x180728(0x183)](_0x180728(0x16f)+_0x24fe70+_0x180728(0x19c)+_0x55ca98+_0x180728(0x19f)+_0x19a577),{'gateway_payment_id':_0x38b36b['payment_id']?.[_0x180728(0x1b6)](),'payment_url':_0x2b9f3,'requires_3ds':![],'status':_0x180728(0x1ea),'final':!![]};}catch(_0x57fd2d){console[_0x180728(0x193)](_0x180728(0x1c5)),console[_0x180728(0x193)]('Error\x20details:',_0x57fd2d),loggerService_1[_0x180728(0x153)][_0x180728(0x194)]('mastercard',_0x180728(0x1dd),_0x57fd2d);throw new Error('Failed\x20to\x20process\x20MasterCard\x20payment:\x20'+(_0x57fd2d instanceof Error?_0x57fd2d[_0x180728(0x11c)]:_0x180728(0x1b8)));}}async[a42_0x2a25b3(0x102)](_0x4d1410,_0x4e25a8){const _0x6d98c9=a42_0x2a25b3;console[_0x6d98c9(0x183)](_0x6d98c9(0x15c)+_0x4d1410+'\x20('+_0x4e25a8+')');try{const _0x56a055={'payment_id':_0x4d1410,'order_id':_0x4e25a8},_0x32ccf3=JSON[_0x6d98c9(0x14b)](_0x56a055),{key:_0x3711db,iv:_0x349c48}=this[_0x6d98c9(0x14c)](),_0x2054d4=this[_0x6d98c9(0x12d)](_0x32ccf3,_0x3711db,_0x349c48),_0x44fa84=this[_0x6d98c9(0x10a)](_0x3711db,_0x349c48),_0x5ecef2=this[_0x6d98c9(0x189)](_0x32ccf3),_0x2389a5={'merchant_point_id':this[_0x6d98c9(0x17d)],'method':_0x6d98c9(0x10d),'info':_0x2054d4,'key':_0x44fa84,'sign':_0x5ecef2,'lang':'en'};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x6d98c9(0x134),_0x6d98c9(0x1d0),'POST',{'merchant_point_id':this['merchantPointId'],'method':_0x6d98c9(0x10d),'lang':'en'});const _0x41b959=Date[_0x6d98c9(0x181)](),_0x5621cb=await fetch(this[_0x6d98c9(0x1ee)],{'method':_0x6d98c9(0x148),'headers':{'Content-Type':_0x6d98c9(0x166),'Accept':'application/json','User-Agent':_0x6d98c9(0x136)},'body':JSON[_0x6d98c9(0x14b)](_0x2389a5)}),_0x2948c5=Date[_0x6d98c9(0x181)]()-_0x41b959;if(!_0x5621cb['ok']){const _0x10714c=await _0x5621cb[_0x6d98c9(0xfe)]();loggerService_1[_0x6d98c9(0x153)][_0x6d98c9(0x1ab)](_0x6d98c9(0x134),_0x6d98c9(0x12a),_0x5621cb[_0x6d98c9(0x10d)],_0x10714c,_0x2948c5);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5621cb[_0x6d98c9(0x10d)]);}const _0x2a2cca=await _0x5621cb['json']();loggerService_1['loggerService'][_0x6d98c9(0x1ab)](_0x6d98c9(0x134),'/status_raw',_0x5621cb[_0x6d98c9(0x10d)],_0x2a2cca,_0x2948c5);let _0x15b880=_0x2a2cca;if(_0x2a2cca[_0x6d98c9(0xff)]&&_0x2a2cca[_0x6d98c9(0x12e)]&&_0x2a2cca[_0x6d98c9(0x128)]){console[_0x6d98c9(0x183)](_0x6d98c9(0x1cc));try{const _0x145bd9=this[_0x6d98c9(0xfd)](_0x2a2cca['info'],_0x2a2cca[_0x6d98c9(0x12e)]);_0x15b880=JSON[_0x6d98c9(0x187)](_0x145bd9),console[_0x6d98c9(0x183)](_0x6d98c9(0x1a5)),loggerService_1['loggerService'][_0x6d98c9(0x1ab)](_0x6d98c9(0x134),'/status_decrypted',_0x5621cb[_0x6d98c9(0x10d)],_0x15b880,_0x2948c5),console[_0x6d98c9(0x183)](_0x6d98c9(0x1a3));}catch(_0x51f407){console[_0x6d98c9(0x193)](_0x6d98c9(0x17a),_0x51f407),loggerService_1[_0x6d98c9(0x153)][_0x6d98c9(0x194)](_0x6d98c9(0x134),_0x6d98c9(0x164),_0x6d98c9(0x117)+_0x51f407),_0x15b880=_0x2a2cca;}}else loggerService_1[_0x6d98c9(0x153)]['logWhiteDomainResponse'](_0x6d98c9(0x134),_0x6d98c9(0x10e),_0x5621cb[_0x6d98c9(0x10d)],_0x15b880,_0x2948c5),console[_0x6d98c9(0x183)](_0x6d98c9(0x1c0));console[_0x6d98c9(0x183)](_0x6d98c9(0x1da),{'status':_0x15b880[_0x6d98c9(0x10d)],'final':_0x15b880['final'],'payment_id':_0x15b880[_0x6d98c9(0x14a)],'desc':_0x15b880[_0x6d98c9(0x1d7)]});let _0x4f317e='PENDING';if(_0x15b880[_0x6d98c9(0x10d)]===0x1&&_0x15b880[_0x6d98c9(0x1bf)]===0x1)_0x4f317e=_0x6d98c9(0x151);else _0x15b880[_0x6d98c9(0x10d)]===0x0&&_0x15b880[_0x6d98c9(0x1bf)]===0x0?_0x4f317e=_0x6d98c9(0x1db):_0x4f317e=_0x6d98c9(0x1ea);return{'status':_0x4f317e,'final':_0x15b880[_0x6d98c9(0x1bf)]===0x1,'amount':_0x15b880[_0x6d98c9(0x106)],'currency':_0x15b880[_0x6d98c9(0x19b)],'date_success':_0x15b880[_0x6d98c9(0x159)],'description':_0x15b880[_0x6d98c9(0x1d7)]};}catch(_0x21b6bb){console[_0x6d98c9(0x193)](_0x6d98c9(0x1e4),_0x21b6bb),loggerService_1['loggerService'][_0x6d98c9(0x194)]('mastercard',_0x6d98c9(0x1d0),_0x21b6bb);throw new Error(_0x6d98c9(0x18f)+(_0x21b6bb instanceof Error?_0x21b6bb[_0x6d98c9(0x11c)]:_0x6d98c9(0x1b8)));}}['scheduleStatusChecks'](_0x9aaa5a,_0x26dbba,_0x368659){const _0x463e75=a42_0x2a25b3;console['log'](_0x463e75(0x15b)+_0x9aaa5a+'\x20('+_0x368659+')'),this[_0x463e75(0x18d)](_0x9aaa5a);const _0x2a529f=[],_0x18afc3=0x5*0x3c*0x3e8,_0x4a2b45=0x2*0x3c*0x3c*0x3e8,_0xf7e711=Math[_0x463e75(0x1ed)](_0x4a2b45/_0x18afc3);console[_0x463e75(0x183)](_0x463e75(0x112)+_0xf7e711+_0x463e75(0x1ef));for(let _0x4ecbad=0x1;_0x4ecbad<=_0xf7e711;_0x4ecbad++){const _0x253d05=setTimeout(async()=>{const _0x45e748=_0x463e75;console[_0x45e748(0x183)]('🔍\x20MasterCard\x20status\x20check\x20#'+_0x4ecbad+'/'+_0xf7e711+_0x45e748(0x1a7)+_0x9aaa5a);try{const _0x1aa7c5=await this['checkPaymentStatus'](_0x368659,_0x26dbba);console['log'](_0x45e748(0x108)+_0x4ecbad+'\x20result:',_0x1aa7c5),_0x1aa7c5[_0x45e748(0x1bf)]&&(console[_0x45e748(0x183)]('✅\x20Payment\x20'+_0x9aaa5a+'\x20is\x20final\x20('+_0x1aa7c5[_0x45e748(0x10d)]+_0x45e748(0x191)),this[_0x45e748(0x18d)](_0x9aaa5a),await this[_0x45e748(0x186)](_0x9aaa5a,_0x1aa7c5['status'],_0x1aa7c5));}catch(_0x448ffa){console[_0x45e748(0x193)](_0x45e748(0x152)+_0x4ecbad+_0x45e748(0x124)+_0x9aaa5a+':',_0x448ffa);}},_0x4ecbad*_0x18afc3);_0x2a529f[_0x463e75(0x13f)](_0x253d05);}this[_0x463e75(0x1a0)]['set'](_0x9aaa5a,_0x2a529f),console['log'](_0x463e75(0x1af)+_0xf7e711+_0x463e75(0x1d3)+_0x9aaa5a);}[a42_0x2a25b3(0x18d)](_0x81a303){const _0x3bde92=a42_0x2a25b3,_0x1a32d6=this[_0x3bde92(0x1a0)][_0x3bde92(0x13d)](_0x81a303);_0x1a32d6&&(console['log'](_0x3bde92(0x16c)+_0x1a32d6['length']+_0x3bde92(0x19e)+_0x81a303),_0x1a32d6['forEach']((_0x38436a,_0x47af72)=>{clearTimeout(_0x38436a);}),this[_0x3bde92(0x1a0)]['delete'](_0x81a303));}async[a42_0x2a25b3(0x186)](_0x58be6a,_0x305172,_0x2066d4){const _0x24d3b3=a42_0x2a25b3;try{const _0x421d4b=(await Promise[_0x24d3b3(0x15d)]()['then'](()=>__importStar(require(_0x24d3b3(0x1e3)))))[_0x24d3b3(0x188)],_0x487b72={'status':_0x305172[_0x24d3b3(0x140)](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x305172===_0x24d3b3(0x151)&&(_0x487b72[_0x24d3b3(0x1bb)]=new Date()),_0x2066d4['description']&&(_0x487b72['adminNotes']='MasterCard:\x20'+_0x2066d4['description']),await _0x421d4b[_0x24d3b3(0x1dc)][_0x24d3b3(0x1a9)]({'where':{'id':_0x58be6a},'data':_0x487b72}),console[_0x24d3b3(0x183)](_0x24d3b3(0x17b)+_0x58be6a+'\x20status\x20updated\x20to\x20'+_0x305172),await this['sendPaymentNotifications'](_0x58be6a,_0x305172);}catch(_0x138fa3){console[_0x24d3b3(0x193)](_0x24d3b3(0x15f)+_0x58be6a+':',_0x138fa3);}}async[a42_0x2a25b3(0x173)](_0x189378,_0x43c381){const _0x5c40e5=a42_0x2a25b3;try{const _0x45b10a=(await Promise[_0x5c40e5(0x15d)]()[_0x5c40e5(0x11e)](()=>__importStar(require(_0x5c40e5(0x1e3)))))[_0x5c40e5(0x188)],{telegramBotService:_0x5a1b21}=await Promise['resolve']()[_0x5c40e5(0x11e)](()=>__importStar(require(_0x5c40e5(0x138)))),_0x4f6b04=await _0x45b10a[_0x5c40e5(0x1dc)][_0x5c40e5(0x109)]({'where':{'id':_0x189378},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x4f6b04)return;const _0x1c1a6e={'PAID':_0x5c40e5(0x171),'FAILED':_0x5c40e5(0x1c3)},_0x247eba=_0x1c1a6e[_0x43c381];_0x247eba&&await _0x5a1b21[_0x5c40e5(0x110)](_0x4f6b04['shopId'],_0x4f6b04,_0x247eba),await this[_0x5c40e5(0x1e0)](_0x4f6b04,_0x43c381);}catch(_0x46ca8e){console['error'](_0x5c40e5(0x125),_0x46ca8e);}}async[a42_0x2a25b3(0x1e0)](_0xba0f06,_0x3bda3c){const _0x405845=a42_0x2a25b3,_0x4260a5=Date[_0x405845(0x181)]();try{const _0x4444ad=_0xba0f06[_0x405845(0x192)],_0xea26e6=_0x4444ad[_0x405845(0x14e)];if(!_0xea26e6?.[_0x405845(0x1b3)]){console[_0x405845(0x183)](_0x405845(0x142)+_0x4444ad['id']);return;}const _0x3a27e5=_0x3bda3c===_0x405845(0x151)?_0x405845(0x10b):_0x405845(0x1df);let _0x318dc5=[];if(_0xea26e6[_0x405845(0x1c4)])try{_0x318dc5=Array[_0x405845(0x1e9)](_0xea26e6['webhookEvents'])?_0xea26e6[_0x405845(0x1c4)]:JSON[_0x405845(0x187)](_0xea26e6[_0x405845(0x1c4)]);}catch(_0x3b09cc){console[_0x405845(0x193)](_0x405845(0x1a6),_0x3b09cc),_0x318dc5=[];}if(!_0x318dc5[_0x405845(0x1ca)](_0x3a27e5)){console[_0x405845(0x183)](_0x405845(0x168)+_0x3a27e5+_0x405845(0x11a)+_0x4444ad['id']);return;}const _0x1ccd46={'event':_0x3a27e5,'payment':{'id':_0xba0f06['id'],'order_id':_0xba0f06[_0x405845(0x144)],'gateway_order_id':_0xba0f06['gatewayOrderId'],'gateway':_0x405845(0x172),'amount':_0xba0f06[_0x405845(0x106)],'currency':_0xba0f06['currency'],'status':_0x3bda3c['toLowerCase'](),'customer_email':_0xba0f06[_0x405845(0x196)],'customer_name':_0xba0f06[_0x405845(0xfb)],'created_at':_0xba0f06[_0x405845(0x121)],'updated_at':new Date()}},_0x31a0c3=await fetch(_0xea26e6['webhookUrl'],{'method':'POST','headers':{'Content-Type':_0x405845(0x166),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(MasterCard)'},'body':JSON[_0x405845(0x14b)](_0x1ccd46)}),_0x447cce=Date['now']()-_0x4260a5;loggerService_1[_0x405845(0x153)][_0x405845(0x1b2)](_0xba0f06['shopId'],_0xea26e6[_0x405845(0x1b3)],_0x3a27e5,_0x31a0c3['status'],_0x447cce,_0x1ccd46),console[_0x405845(0x183)](_0x405845(0x1be)+_0xea26e6['webhookUrl']+_0x405845(0x143)+_0x31a0c3[_0x405845(0x10d)]+'\x20('+_0x447cce+_0x405845(0x1de));}catch(_0x1f0287){console[_0x405845(0x193)](_0x405845(0x132),_0x1f0287),loggerService_1[_0x405845(0x153)][_0x405845(0x147)](_0xba0f06['shopId'],_0xba0f06[_0x405845(0x192)]?.[_0x405845(0x14e)]?.[_0x405845(0x1b3)]||_0x405845(0x14f),_0x405845(0x163),_0x1f0287,{});}}[a42_0x2a25b3(0x13c)](_0x52c54a){const _0xbc4514=a42_0x2a25b3,_0x185dd9=_0x52c54a[_0xbc4514(0x165)](/[\s-]/g,'');if(_0x185dd9[_0xbc4514(0x111)]<0x4)return _0xbc4514(0x1ba);return'****\x20****\x20****\x20'+_0x185dd9[_0xbc4514(0x176)](-0x4);}async[a42_0x2a25b3(0x175)](_0xc9141c){const _0x4e9b1e=a42_0x2a25b3;console[_0x4e9b1e(0x183)](_0x4e9b1e(0x100),_0xc9141c);let _0x3d4489=_0x4e9b1e(0x1db);if(_0xc9141c['status']===0x1&&_0xc9141c[_0x4e9b1e(0x1bf)]===0x1)_0x3d4489='PAID';else _0xc9141c[_0x4e9b1e(0x10d)]===0x0&&_0xc9141c['final']===0x0?_0x3d4489='PENDING':_0x3d4489=_0x4e9b1e(0x1ea);return{'paymentId':_0xc9141c['order_id']||'','status':_0x3d4489,'amount':_0xc9141c[_0x4e9b1e(0x106)],'currency':_0xc9141c['currency']};}[a42_0x2a25b3(0x190)](){const _0x54f19e=a42_0x2a25b3;console[_0x54f19e(0x183)](_0x54f19e(0x1c6));const _0x35b18d=this['statusCheckTimers'][_0x54f19e(0x1cb)];for(const [_0x15774b]of this[_0x54f19e(0x1a0)]){this['clearStatusTimers'](_0x15774b);}console['log'](_0x54f19e(0x17c)+_0x35b18d+_0x54f19e(0x15a));}}function a42_0x3179(_0x40e0a2,_0x85d90){const _0x15d975=a42_0x15d9();return a42_0x3179=function(_0x3179af,_0x50fcab){_0x3179af=_0x3179af-0xf9;let _0x3b4633=_0x15d975[_0x3179af];return _0x3b4633;},a42_0x3179(_0x40e0a2,_0x85d90);}exports['MasterCardService']=MasterCardService;