'use strict';function a42_0x62a7(){const _0x253678=['shop','last_name','stringify','POST','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','MasterCardService','\x20is\x20final\x20(','7654662xRIsZg','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','🔐\x20Public\x20key\x20length:\x20','desc','🔐\x203DS\x20verification\x20required','slice','trim','💾\x20Payment\x20data\x20prepared','processCardPayment','decryptAES','payment.success','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','call','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','🔐\x20Data\x20encrypted\x20with\x20AES','prototype','📝\x20Data\x20to\x20sign\x20length:','set','),\x20stopping\x20status\x20checks','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','logWhiteDomainResponse','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','readFileSync','expire_year','⏰\x20Will\x20check\x20status\x20','delete','description','statusCheckTimers','getOwnPropertyDescriptor','text','🧹\x20Clearing\x20','path','decryptResponse','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','default','customerEmail','✅\x20Scheduled\x20','base64','MasterCard\x20webhook\x20sent\x20to\x20','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','end','adminNotes','../../config/database','Private\x20key\x20file\x20not\x20found:\x20','writable','webhook_send','none','/status','https://api2.trapay.uk/decrypt.php','https://api.paydmeth.com/api','generateAESKey','/charge_decrypted','511254EjfXAH',',\x20body:\x20','\x20\x20\x20-\x20method:\x20charge','isArray','3DS\x20URL:','\x20characters','../loggerService','❌\x20PHP\x20decryptor\x20request\x20failed:','encryptAES','customerName','payment','createCipheriv','randomBytes','PENDING','push','...','HTTP\x20error!\x20status:\x20','create','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','HTTP\x20','createdAt','size','\x20\x20\x20-\x20merchant_point_id:','❌\x20RSA\x20encryption\x20failed:','/status_decrypted','****','20CUbLGM','🔐\x20AES\x20IV\x20length:','status','❌\x20Data\x20being\x20signed:','amount','\x20status\x20checks\x20for\x20payment\x20','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','1072512HdAbbZ','942113szhari','clearStatusTimers','__createBinding','-----BEGIN','sendPaymentNotifications','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','join','aes-256-ctr','🔐\x20Public\x20key\x20path:','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','\x20with\x20status\x20','toUpperCase','findUnique','expire_month','Public\x20key\x20file\x20not\x20found:\x20','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','private.pem','Failed\x20to\x20decrypt\x20response','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','forEach','scheduleStatusChecks','error','Unknown\x20error','logWhiteDomainRequest','publicKeyPath','\x20\x20\x20-\x20info\x20length:','from','final','hasOwnProperty','🔐\x20Private\x20key\x20path:','processWebhook','configurable','\x20not\x20enabled\x20for\x20shop\x20','toString','stopAllStatusChecks','cvv','📝\x20Data\x20length:','🔐\x20RSA\x20signing\x20successful','❌\x20MasterCard\x20key\x20validation\x20failed:','substring','unknown','now','defineProperty','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','key','MasterCard\x20status\x20check\x20error:','sign','✅\x20Payment\x20successful','encryptRSA','number','28GIhNml','currency','logShopWebhookSent','✅\x20Payment\x20','📊\x20Status\x20check\x20#','Order\x20ID:','FAILED','system','/charge','webhookUrl','RSA_PKCS1_PADDING','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','failed','first_name','Card\x20Number:','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','\x20MasterCard\x20status\x20check\x20timers','/status_raw','ms)','mastercard','Response\x20Body:','loggerService','3ds_url',',\x20Final:\x20','/charge_raw','paid','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','update','\x20\x20\x20-\x20lang:\x20en','23775796WkZzOg','PAID','Processing\x20MasterCard\x20webhook:','✅\x20Status\x20response\x20decrypted\x20successfully','maskCardNumber','sendShopWebhook','resolve','updatePaymentStatus','order_id','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','\x20status\x20updated\x20to\x20','length','info','json','log','\x20failed\x20for\x20payment\x20','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','settings','Error\x20details:','2153259SEuxYU','includes','10KxVpcc','merchantPointId','shopId','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','crypto','376413YrBTmV','logWhiteDomainError','utf8','decryptResponsePhp','TesSoft\x20Payment\x20System/1.0','then','Failed\x20to\x20send\x20MasterCard\x20webhook:','charge','cwd','webhookEvents','existsSync','Payment\x20ID:','\x20\x20\x20-\x20sign\x20length:','__setModuleDefault','\x20result:','/charge_decrypt','Final:','privateKeyPath','parse','logShopWebhookError','__esModule','🔐\x20AES\x20key\x20length:','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','gatewayOrderId','date_success','-----END','constants','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','validateKeyFiles','paidAt','payment_id','payment.failed','📝\x20Signature\x20length:','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','apiUrl','Response\x20Time:','message','5TIWlkR','get','Status:','application/json','Failed\x20to\x20process\x20MasterCard\x20payment:\x20'];a42_0x62a7=function(){return _0x253678;};return a42_0x62a7();}function a42_0x3f5f(_0x6c7ab1,_0x5db5ef){const _0x62a7c2=a42_0x62a7();return a42_0x3f5f=function(_0x3f5fb1,_0x418311){_0x3f5fb1=_0x3f5fb1-0x17e;let _0x3da00f=_0x62a7c2[_0x3f5fb1];return _0x3da00f;},a42_0x3f5f(_0x6c7ab1,_0x5db5ef);}const a42_0x5df48b=a42_0x3f5f;(function(_0x4890a4,_0x34af32){const _0x2c658b=a42_0x3f5f,_0x2da63c=_0x4890a4();while(!![]){try{const _0x33e307=parseInt(_0x2c658b(0x22b))/0x1+-parseInt(_0x2c658b(0x208))/0x2+-parseInt(_0x2c658b(0x1a3))/0x3*(-parseInt(_0x2c658b(0x222))/0x4)+-parseInt(_0x2c658b(0x1c8))/0x5*(-parseInt(_0x2c658b(0x1d4))/0x6)+parseInt(_0x2c658b(0x25d))/0x7*(parseInt(_0x2c658b(0x22a))/0x8)+parseInt(_0x2c658b(0x19c))/0x9*(-parseInt(_0x2c658b(0x19e))/0xa)+-parseInt(_0x2c658b(0x189))/0xb;if(_0x33e307===_0x34af32)break;else _0x2da63c['push'](_0x2da63c['shift']());}catch(_0x4bebf0){_0x2da63c['push'](_0x2da63c['shift']());}}}(a42_0x62a7,0xb10c3));var __createBinding=this&&this[a42_0x5df48b(0x22d)]||(Object[a42_0x5df48b(0x219)]?function(_0x8be659,_0x596da7,_0x2d86a8,_0x1f2168){const _0x5b80fd=a42_0x5df48b;if(_0x1f2168===undefined)_0x1f2168=_0x2d86a8;var _0x14e84=Object[_0x5b80fd(0x1f0)](_0x596da7,_0x2d86a8);(!_0x14e84||(_0x5b80fd(0x1c9)in _0x14e84?!_0x596da7[_0x5b80fd(0x1b7)]:_0x14e84[_0x5b80fd(0x200)]||_0x14e84[_0x5b80fd(0x24a)]))&&(_0x14e84={'enumerable':!![],'get':function(){return _0x596da7[_0x2d86a8];}}),Object[_0x5b80fd(0x255)](_0x8be659,_0x1f2168,_0x14e84);}:function(_0x54b0cd,_0x1ed5b6,_0x3adabe,_0x2de8ef){if(_0x2de8ef===undefined)_0x2de8ef=_0x3adabe;_0x54b0cd[_0x2de8ef]=_0x1ed5b6[_0x3adabe];}),__setModuleDefault=this&&this[a42_0x5df48b(0x1b0)]||(Object[a42_0x5df48b(0x219)]?function(_0x53d001,_0x3e62bc){const _0x2b1ab9=a42_0x5df48b;Object[_0x2b1ab9(0x255)](_0x53d001,_0x2b1ab9(0x1f6),{'enumerable':!![],'value':_0x3e62bc});}:function(_0x3b0cc2,_0x705a22){const _0x4749f3=a42_0x5df48b;_0x3b0cc2[_0x4749f3(0x1f6)]=_0x705a22;}),__importStar=this&&this['__importStar']||(function(){var _0x308a47=function(_0x10ab69){return _0x308a47=Object['getOwnPropertyNames']||function(_0x2a4adc){const _0xaaf83c=a42_0x3f5f;var _0x4f6a01=[];for(var _0x4a0c72 in _0x2a4adc)if(Object[_0xaaf83c(0x1e3)][_0xaaf83c(0x247)][_0xaaf83c(0x1e0)](_0x2a4adc,_0x4a0c72))_0x4f6a01[_0x4f6a01[_0xaaf83c(0x194)]]=_0x4a0c72;return _0x4f6a01;},_0x308a47(_0x10ab69);};return function(_0x4a8ae7){const _0x52ae29=a42_0x3f5f;if(_0x4a8ae7&&_0x4a8ae7['__esModule'])return _0x4a8ae7;var _0x31b942={};if(_0x4a8ae7!=null){for(var _0x582c76=_0x308a47(_0x4a8ae7),_0x2192a7=0x0;_0x2192a7<_0x582c76[_0x52ae29(0x194)];_0x2192a7++)if(_0x582c76[_0x2192a7]!==_0x52ae29(0x1f6))__createBinding(_0x31b942,_0x4a8ae7,_0x582c76[_0x2192a7]);}return __setModuleDefault(_0x31b942,_0x4a8ae7),_0x31b942;};}()),__importDefault=this&&this['__importDefault']||function(_0x39e3fb){return _0x39e3fb&&_0x39e3fb['__esModule']?_0x39e3fb:{'default':_0x39e3fb};};Object[a42_0x5df48b(0x255)](exports,a42_0x5df48b(0x1b7),{'value':!![]}),exports[a42_0x5df48b(0x1d2)]=void 0x0;const crypto_1=__importDefault(require(a42_0x5df48b(0x1a2))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x5df48b(0x1f3))),loggerService_1=require(a42_0x5df48b(0x20e));class MasterCardService{constructor(){const _0x1b62b4=a42_0x5df48b;this[_0x1b62b4(0x1ef)]=new Map(),this[_0x1b62b4(0x1c5)]=_0x1b62b4(0x205),this['merchantPointId']=0x67c,this[_0x1b62b4(0x1b4)]=path_1['default'][_0x1b62b4(0x231)](process['cwd'](),'keys',_0x1b62b4(0x23b)),this[_0x1b62b4(0x243)]=path_1[_0x1b62b4(0x1f6)]['join'](process[_0x1b62b4(0x1ab)](),'keys','psp_public.pem'),console['log']('💳\x20MasterCard\x20service\x20initialized'),console[_0x1b62b4(0x197)](_0x1b62b4(0x248),this['privateKeyPath']),console['log'](_0x1b62b4(0x233),this['publicKeyPath']),this[_0x1b62b4(0x1bf)]();}['validateKeyFiles'](){const _0x4cd15c=a42_0x5df48b;try{if(!fs_1['default'][_0x4cd15c(0x1ad)](this['privateKeyPath']))throw new Error(_0x4cd15c(0x1ff)+this[_0x4cd15c(0x1b4)]);if(!fs_1[_0x4cd15c(0x1f6)][_0x4cd15c(0x1ad)](this[_0x4cd15c(0x243)]))throw new Error(_0x4cd15c(0x239)+this['publicKeyPath']);const _0x4ddf49=fs_1[_0x4cd15c(0x1f6)][_0x4cd15c(0x1ea)](this[_0x4cd15c(0x1b4)],_0x4cd15c(0x1a5))[_0x4cd15c(0x1da)](),_0x5a9922=fs_1['default'][_0x4cd15c(0x1ea)](this[_0x4cd15c(0x243)],_0x4cd15c(0x1a5))[_0x4cd15c(0x1da)]();if(!_0x4ddf49[_0x4cd15c(0x19d)]('-----BEGIN')||!_0x4ddf49['includes'](_0x4cd15c(0x1bc)))throw new Error('Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x5a9922[_0x4cd15c(0x19d)](_0x4cd15c(0x22e))||!_0x5a9922[_0x4cd15c(0x19d)](_0x4cd15c(0x1bc)))throw new Error(_0x4cd15c(0x1d1));console['log']('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console[_0x4cd15c(0x197)]('🔐\x20Private\x20key\x20length:\x20'+_0x4ddf49['length']+_0x4cd15c(0x20d)),console[_0x4cd15c(0x197)](_0x4cd15c(0x1d6)+_0x5a9922['length']+_0x4cd15c(0x20d));}catch(_0x34b947){console[_0x4cd15c(0x240)](_0x4cd15c(0x251),_0x34b947);throw _0x34b947;}}[a42_0x5df48b(0x206)](){const _0x3913a4=a42_0x5df48b,_0x2f94f4=crypto_1[_0x3913a4(0x1f6)][_0x3913a4(0x214)](0x20),_0x37d5f1=crypto_1[_0x3913a4(0x1f6)]['randomBytes'](0x10);return{'key':_0x2f94f4,'iv':_0x37d5f1};}[a42_0x5df48b(0x210)](_0x2a4904,_0x3e9ee2,_0x49dd74){const _0x4e590b=a42_0x5df48b,_0x51c58c=crypto_1[_0x4e590b(0x1f6)][_0x4e590b(0x213)](_0x4e590b(0x232),_0x3e9ee2,_0x49dd74);let _0x11e931=_0x51c58c['update'](_0x2a4904,'utf8',_0x4e590b(0x1f9));return _0x11e931+=_0x51c58c[_0x4e590b(0x246)]('base64'),_0x11e931;}['encryptRSA'](_0x1f929a,_0x299a8e){const _0x18fe44=a42_0x5df48b;try{const _0xa26545=fs_1[_0x18fe44(0x1f6)]['readFileSync'](this['publicKeyPath'],_0x18fe44(0x1a5))[_0x18fe44(0x1da)](),_0x4994d2={'iv':_0x299a8e['toString'](_0x18fe44(0x1f9)),'key':_0x1f929a[_0x18fe44(0x24c)](_0x18fe44(0x1f9))},_0x53d608=JSON[_0x18fe44(0x1cf)](_0x4994d2);console[_0x18fe44(0x197)](_0x18fe44(0x186),_0x53d608[_0x18fe44(0x194)]);const _0x143293=crypto_1['default']['publicEncrypt']({'key':_0xa26545,'padding':crypto_1[_0x18fe44(0x1f6)][_0x18fe44(0x1bd)][_0x18fe44(0x267)]},Buffer['from'](_0x53d608));return console[_0x18fe44(0x197)](_0x18fe44(0x1e1),_0x143293[_0x18fe44(0x194)]),_0x143293[_0x18fe44(0x24c)](_0x18fe44(0x1f9));}catch(_0x2a29db){console['error'](_0x18fe44(0x21f),_0x2a29db);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}['signRSA'](_0x3e78a5){const _0x535f30=a42_0x5df48b;try{const _0x180f9d=fs_1[_0x535f30(0x1f6)][_0x535f30(0x1ea)](this[_0x535f30(0x1b4)],_0x535f30(0x1a5))[_0x535f30(0x1da)](),_0x203fa1=crypto_1[_0x535f30(0x1f6)]['createSign']('SHA256');_0x203fa1['update'](_0x3e78a5),_0x203fa1[_0x535f30(0x1fc)]();const _0x39e543=_0x203fa1['sign'](_0x180f9d,_0x535f30(0x1f9));return console[_0x535f30(0x197)](_0x535f30(0x250)),console[_0x535f30(0x197)](_0x535f30(0x1e4),_0x3e78a5[_0x535f30(0x194)]),console['log'](_0x535f30(0x1c3),_0x39e543[_0x535f30(0x194)]),_0x39e543;}catch(_0x2f9802){console[_0x535f30(0x240)]('❌\x20RSA\x20signing\x20failed:',_0x2f9802),console['error'](_0x535f30(0x225),_0x3e78a5[_0x535f30(0x252)](0x0,0xc8)+_0x535f30(0x217));throw new Error(_0x535f30(0x228));}}[a42_0x5df48b(0x1dd)](_0x4f9ff1,_0x5c280e,_0x1a302f){const _0x35cdb8=a42_0x5df48b,_0x1b8ef4=crypto_1[_0x35cdb8(0x1f6)]['createDecipheriv'](_0x35cdb8(0x232),_0x5c280e,_0x1a302f);let _0x48af8a=_0x1b8ef4[_0x35cdb8(0x187)](_0x4f9ff1,_0x35cdb8(0x1f9),_0x35cdb8(0x1a5));return _0x48af8a+=_0x1b8ef4[_0x35cdb8(0x246)](_0x35cdb8(0x1a5)),_0x48af8a;}async[a42_0x5df48b(0x1a6)](_0x2fab12,_0x146ba6){const _0x4b2bd8=a42_0x5df48b;try{const _0x128f9f=await fetch(_0x4b2bd8(0x204),{'method':_0x4b2bd8(0x1d0),'headers':{'Content-Type':_0x4b2bd8(0x1cb)},'body':JSON[_0x4b2bd8(0x1cf)]({'info':_0x2fab12,'key':_0x146ba6})});if(!_0x128f9f['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x128f9f[_0x4b2bd8(0x1f1)]();}catch(_0x1400da){console[_0x4b2bd8(0x240)](_0x4b2bd8(0x20f),_0x1400da);throw new Error(_0x4b2bd8(0x256));}}[a42_0x5df48b(0x1f4)](_0x23d607,_0x4ca690){const _0x4b7a12=a42_0x5df48b;try{const _0xda333e=fs_1[_0x4b7a12(0x1f6)]['readFileSync'](this[_0x4b7a12(0x1b4)],'utf8')[_0x4b7a12(0x1da)](),_0xf02d39=crypto_1[_0x4b7a12(0x1f6)]['privateDecrypt'](_0xda333e,Buffer[_0x4b7a12(0x245)](_0x4ca690,_0x4b7a12(0x1f9))),_0x4d62fb=JSON[_0x4b7a12(0x1b5)](_0xf02d39[_0x4b7a12(0x24c)]()),_0xf6018=Buffer[_0x4b7a12(0x245)](_0x4d62fb[_0x4b7a12(0x257)],_0x4b7a12(0x1f9)),_0x5dbf51=Buffer[_0x4b7a12(0x245)](_0x4d62fb['iv'],_0x4b7a12(0x1f9));return this[_0x4b7a12(0x1dd)](_0x23d607,_0xf6018,_0x5dbf51);}catch(_0x101235){throw new Error(_0x4b7a12(0x23c));}}async[a42_0x5df48b(0x1dc)](_0x2cb829){const _0x3b33a6=a42_0x5df48b,{paymentId:_0x18716d,orderId:_0x3e792d,amount:_0x4df9cd,currency:_0x584c3f,cardData:_0x14b07b,resultUrl:_0xb86627,returnUrl:_0x1d4aad,cardHolder:_0x1a3953,browser:_0x105507}=_0x2cb829;console['log']('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console['log'](_0x3b33a6(0x1ae),_0x18716d),console['log'](_0x3b33a6(0x262),_0x3e792d),console[_0x3b33a6(0x197)]('Amount:',_0x4df9cd,_0x584c3f),console[_0x3b33a6(0x197)](_0x3b33a6(0x26b),this[_0x3b33a6(0x18d)](_0x14b07b[_0x3b33a6(0x25c)])),console[_0x3b33a6(0x197)]('Card\x20Holder:',_0x1a3953[_0x3b33a6(0x26a)]+'\x20'+_0x1a3953[_0x3b33a6(0x1ce)]),console[_0x3b33a6(0x197)]('Return\x20URL:',_0x1d4aad),console[_0x3b33a6(0x197)]('Result\x20URL:',_0xb86627);const _0x3f101e={'amount':_0x4df9cd,'currency':_0x584c3f['toUpperCase'](),'order_id':_0x3e792d,'result_url':_0xb86627,'return_url':_0x1d4aad,'card':{'number':_0x14b07b[_0x3b33a6(0x25c)],'expire_month':_0x14b07b[_0x3b33a6(0x238)],'expire_year':_0x14b07b[_0x3b33a6(0x1eb)],'cvv':_0x14b07b[_0x3b33a6(0x24e)]},'card_holder':_0x1a3953,'browser':_0x105507},_0x33ecbd=JSON[_0x3b33a6(0x1cf)](_0x3f101e);console['log'](_0x3b33a6(0x1db)),console[_0x3b33a6(0x197)]('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console[_0x3b33a6(0x197)](_0x33ecbd),console[_0x3b33a6(0x197)](_0x3b33a6(0x24f),_0x33ecbd[_0x3b33a6(0x194)]);try{const {key:_0x186fa3,iv:_0x50fab8}=this[_0x3b33a6(0x206)]();console[_0x3b33a6(0x197)]('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console[_0x3b33a6(0x197)](_0x3b33a6(0x1b8),_0x186fa3[_0x3b33a6(0x194)]),console[_0x3b33a6(0x197)](_0x3b33a6(0x223),_0x50fab8[_0x3b33a6(0x194)]);const _0x2005d5=this[_0x3b33a6(0x210)](_0x33ecbd,_0x186fa3,_0x50fab8);console[_0x3b33a6(0x197)](_0x3b33a6(0x1e2)),console[_0x3b33a6(0x197)]('📝\x20Encrypted\x20data\x20length:',_0x2005d5['length']);const _0x153e38=this[_0x3b33a6(0x25b)](_0x186fa3,_0x50fab8);console[_0x3b33a6(0x197)](_0x3b33a6(0x192)),console[_0x3b33a6(0x197)]('📝\x20Encrypted\x20key\x20length:',_0x153e38['length']);const _0x333177=this['signRSA'](_0x33ecbd);console['log']('🔐\x20Data\x20signed\x20with\x20RSA'),console['log'](_0x3b33a6(0x1c3),_0x333177[_0x3b33a6(0x194)]);const _0x35785e={'merchant_point_id':this['merchantPointId'],'method':_0x3b33a6(0x1aa),'info':_0x2005d5,'key':_0x153e38,'sign':_0x333177,'lang':'en'};console[_0x3b33a6(0x197)]('📤\x20Sending\x20request\x20to\x20MasterCard\x20API...'),console['log']('📝\x20Final\x20request\x20structure:'),console['log'](_0x3b33a6(0x21e),this[_0x3b33a6(0x19f)]),console[_0x3b33a6(0x197)](_0x3b33a6(0x20a)),console[_0x3b33a6(0x197)](_0x3b33a6(0x244),_0x2005d5[_0x3b33a6(0x194)]),console[_0x3b33a6(0x197)]('\x20\x20\x20-\x20key\x20length:',_0x153e38['length']),console[_0x3b33a6(0x197)](_0x3b33a6(0x1af),_0x333177['length']),console[_0x3b33a6(0x197)](_0x3b33a6(0x188)),loggerService_1[_0x3b33a6(0x181)][_0x3b33a6(0x242)](_0x3b33a6(0x17f),'/charge',_0x3b33a6(0x1d0),{'merchant_point_id':this[_0x3b33a6(0x19f)],'method':_0x3b33a6(0x1aa),'lang':'en'});const _0x50569b=Date[_0x3b33a6(0x254)](),_0x282619=await fetch(this[_0x3b33a6(0x1c5)],{'method':_0x3b33a6(0x1d0),'headers':{'Content-Type':_0x3b33a6(0x1cb),'Accept':_0x3b33a6(0x1cb),'User-Agent':_0x3b33a6(0x1a7)},'body':JSON[_0x3b33a6(0x1cf)](_0x35785e)}),_0x398357=Date[_0x3b33a6(0x254)]()-_0x50569b;console[_0x3b33a6(0x197)](_0x3b33a6(0x229)),console[_0x3b33a6(0x197)](_0x3b33a6(0x1ca),_0x282619[_0x3b33a6(0x224)]),console[_0x3b33a6(0x197)](_0x3b33a6(0x1c6),_0x398357+'ms');if(!_0x282619['ok']){const _0x50f41b=await _0x282619['text']();console[_0x3b33a6(0x240)]('HTTP\x20Status:',_0x282619[_0x3b33a6(0x224)]),console[_0x3b33a6(0x240)](_0x3b33a6(0x180),_0x50f41b),loggerService_1['loggerService'][_0x3b33a6(0x1e8)](_0x3b33a6(0x17f),'/charge_raw',_0x282619[_0x3b33a6(0x224)],_0x50f41b,_0x398357),loggerService_1[_0x3b33a6(0x181)][_0x3b33a6(0x1a4)]('mastercard',_0x3b33a6(0x265),_0x3b33a6(0x21b)+_0x282619[_0x3b33a6(0x224)]+':\x20'+_0x50f41b);throw new Error(_0x3b33a6(0x218)+_0x282619['status']+_0x3b33a6(0x209)+_0x50f41b);}const _0x3d8805=await _0x282619['json']();loggerService_1[_0x3b33a6(0x181)][_0x3b33a6(0x1e8)](_0x3b33a6(0x17f),_0x3b33a6(0x184),_0x282619[_0x3b33a6(0x224)],_0x3d8805,_0x398357),console[_0x3b33a6(0x197)](_0x3b33a6(0x1fb));let _0x52b826=_0x3d8805;if(_0x3d8805['info']&&_0x3d8805[_0x3b33a6(0x257)]&&_0x3d8805[_0x3b33a6(0x259)]){console[_0x3b33a6(0x197)]('🔐\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x4e1797=await this['decryptResponsePhp'](_0x3d8805[_0x3b33a6(0x195)],_0x3d8805['key']);_0x52b826=JSON['parse'](_0x4e1797),console[_0x3b33a6(0x197)](_0x3b33a6(0x23a)),loggerService_1[_0x3b33a6(0x181)][_0x3b33a6(0x1e8)]('mastercard',_0x3b33a6(0x207),_0x282619[_0x3b33a6(0x224)],_0x52b826,_0x398357),console[_0x3b33a6(0x197)](_0x3b33a6(0x1b9));}catch(_0x3933a7){console[_0x3b33a6(0x240)](_0x3b33a6(0x23d),_0x3933a7),loggerService_1[_0x3b33a6(0x181)][_0x3b33a6(0x1a4)](_0x3b33a6(0x17f),_0x3b33a6(0x1b2),'Decryption\x20failed:\x20'+_0x3933a7),_0x52b826=_0x3d8805;}}else loggerService_1[_0x3b33a6(0x181)]['logWhiteDomainResponse']('mastercard','/charge_decrypted',_0x282619[_0x3b33a6(0x224)],_0x52b826,_0x398357),console[_0x3b33a6(0x197)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console['log'](_0x3b33a6(0x1ca),_0x52b826[_0x3b33a6(0x224)]),console[_0x3b33a6(0x197)](_0x3b33a6(0x1b3),_0x52b826['final']),console[_0x3b33a6(0x197)](_0x3b33a6(0x1ae),_0x52b826[_0x3b33a6(0x1c1)]),console[_0x3b33a6(0x197)](_0x3b33a6(0x20c),_0x52b826['3ds_url']||_0x3b33a6(0x202));if(_0x52b826[_0x3b33a6(0x224)]===0x64&&_0x52b826[_0x3b33a6(0x246)]===0x1)return console[_0x3b33a6(0x197)](_0x3b33a6(0x25a)),{'gateway_payment_id':_0x52b826[_0x3b33a6(0x1c1)]?.[_0x3b33a6(0x24c)](),'payment_url':_0x1d4aad,'requires_3ds':![],'status':_0x3b33a6(0x18a),'final':!![]};if(_0x52b826[_0x3b33a6(0x182)])return console[_0x3b33a6(0x197)](_0x3b33a6(0x1d8)),this[_0x3b33a6(0x23f)](_0x18716d,_0x3e792d,_0x52b826[_0x3b33a6(0x1c1)]?.[_0x3b33a6(0x24c)]()||_0x3e792d),{'gateway_payment_id':_0x52b826['payment_id']?.[_0x3b33a6(0x24c)](),'payment_url':_0x52b826['3ds_url'],'requires_3ds':!![],'threeds_url':_0x52b826['3ds_url'],'status':_0x3b33a6(0x215),'final':![]};let _0x5a33b4=_0x52b826[_0x3b33a6(0x1d7)]||_0x52b826[_0x3b33a6(0x1c7)]||_0x3b33a6(0x241),_0x54175f=_0x52b826[_0x3b33a6(0x224)],_0x1ba5f4=_0x52b826[_0x3b33a6(0x246)];return console[_0x3b33a6(0x197)](_0x3b33a6(0x1df)+_0x54175f+_0x3b33a6(0x183)+_0x1ba5f4+',\x20Desc:\x20'+_0x5a33b4),{'gateway_payment_id':_0x52b826[_0x3b33a6(0x1c1)]?.[_0x3b33a6(0x24c)](),'payment_url':_0x1d4aad,'requires_3ds':![],'status':_0x3b33a6(0x263),'final':!![]};}catch(_0x24f1f8){console[_0x3b33a6(0x240)](_0x3b33a6(0x230)),console[_0x3b33a6(0x240)](_0x3b33a6(0x19b),_0x24f1f8),loggerService_1[_0x3b33a6(0x181)][_0x3b33a6(0x1a4)](_0x3b33a6(0x17f),_0x3b33a6(0x265),_0x24f1f8);throw new Error(_0x3b33a6(0x1cc)+(_0x24f1f8 instanceof Error?_0x24f1f8[_0x3b33a6(0x1c7)]:_0x3b33a6(0x241)));}}async['checkPaymentStatus'](_0x4600ac,_0x40a025){const _0x189c69=a42_0x5df48b;console[_0x189c69(0x197)](_0x189c69(0x21a)+_0x4600ac+'\x20('+_0x40a025+')');try{const _0x229bf8={'payment_id':_0x4600ac,'order_id':_0x40a025},_0x2c506e=JSON['stringify'](_0x229bf8),{key:_0x40dabc,iv:_0xfb54c7}=this['generateAESKey'](),_0x3efa3d=this['encryptAES'](_0x2c506e,_0x40dabc,_0xfb54c7),_0x4b3e71=this[_0x189c69(0x25b)](_0x40dabc,_0xfb54c7),_0x2ee646=this['signRSA'](_0x2c506e),_0xa10b07={'merchant_point_id':this[_0x189c69(0x19f)],'method':'status','info':_0x3efa3d,'key':_0x4b3e71,'sign':_0x2ee646,'lang':'en'};loggerService_1[_0x189c69(0x181)][_0x189c69(0x242)](_0x189c69(0x17f),_0x189c69(0x203),_0x189c69(0x1d0),{'merchant_point_id':this[_0x189c69(0x19f)],'method':_0x189c69(0x224),'lang':'en'});const _0x341cd6=Date[_0x189c69(0x254)](),_0x26e2d9=await fetch(this[_0x189c69(0x1c5)],{'method':_0x189c69(0x1d0),'headers':{'Content-Type':_0x189c69(0x1cb),'Accept':_0x189c69(0x1cb),'User-Agent':_0x189c69(0x1a7)},'body':JSON['stringify'](_0xa10b07)}),_0x4f5319=Date[_0x189c69(0x254)]()-_0x341cd6;if(!_0x26e2d9['ok']){const _0x14b891=await _0x26e2d9[_0x189c69(0x1f1)]();loggerService_1[_0x189c69(0x181)][_0x189c69(0x1e8)](_0x189c69(0x17f),_0x189c69(0x26e),_0x26e2d9[_0x189c69(0x224)],_0x14b891,_0x4f5319);throw new Error('HTTP\x20error!\x20status:\x20'+_0x26e2d9[_0x189c69(0x224)]);}const _0x518e07=await _0x26e2d9[_0x189c69(0x196)]();loggerService_1[_0x189c69(0x181)]['logWhiteDomainResponse']('mastercard','/status_raw',_0x26e2d9[_0x189c69(0x224)],_0x518e07,_0x4f5319);let _0x49a3a6=_0x518e07;if(_0x518e07[_0x189c69(0x195)]&&_0x518e07[_0x189c69(0x257)]&&_0x518e07[_0x189c69(0x259)]){console['log'](_0x189c69(0x1a1));try{const _0x1e5e89=this[_0x189c69(0x1f4)](_0x518e07[_0x189c69(0x195)],_0x518e07['key']);_0x49a3a6=JSON[_0x189c69(0x1b5)](_0x1e5e89),console[_0x189c69(0x197)](_0x189c69(0x18c)),loggerService_1[_0x189c69(0x181)][_0x189c69(0x1e8)](_0x189c69(0x17f),'/status_decrypted',_0x26e2d9[_0x189c69(0x224)],_0x49a3a6,_0x4f5319),console[_0x189c69(0x197)](_0x189c69(0x1c4));}catch(_0x59b3a8){console[_0x189c69(0x240)](_0x189c69(0x1be),_0x59b3a8),loggerService_1[_0x189c69(0x181)]['logWhiteDomainError'](_0x189c69(0x17f),'/status_decrypt','Status\x20decryption\x20failed:\x20'+_0x59b3a8),_0x49a3a6=_0x518e07;}}else loggerService_1[_0x189c69(0x181)]['logWhiteDomainResponse'](_0x189c69(0x17f),_0x189c69(0x220),_0x26e2d9[_0x189c69(0x224)],_0x49a3a6,_0x4f5319),console[_0x189c69(0x197)](_0x189c69(0x1d5));console['log']('📊\x20Status\x20check\x20result:',{'status':_0x49a3a6[_0x189c69(0x224)],'final':_0x49a3a6[_0x189c69(0x246)],'payment_id':_0x49a3a6['payment_id'],'desc':_0x49a3a6[_0x189c69(0x1d7)]});let _0x5bb086='PENDING';if(_0x49a3a6[_0x189c69(0x224)]===0x1&&_0x49a3a6[_0x189c69(0x246)]===0x1)_0x5bb086=_0x189c69(0x18a);else _0x49a3a6['status']===0x0&&_0x49a3a6['final']===0x0?_0x5bb086=_0x189c69(0x215):_0x5bb086=_0x189c69(0x263);return{'status':_0x5bb086,'final':_0x49a3a6['final']===0x1,'amount':_0x49a3a6[_0x189c69(0x226)],'currency':_0x49a3a6[_0x189c69(0x25e)],'date_success':_0x49a3a6[_0x189c69(0x1bb)],'description':_0x49a3a6[_0x189c69(0x1d7)]};}catch(_0xbd8fef){console[_0x189c69(0x240)](_0x189c69(0x258),_0xbd8fef),loggerService_1[_0x189c69(0x181)][_0x189c69(0x1a4)](_0x189c69(0x17f),_0x189c69(0x203),_0xbd8fef);throw new Error(_0x189c69(0x234)+(_0xbd8fef instanceof Error?_0xbd8fef[_0x189c69(0x1c7)]:_0x189c69(0x241)));}}[a42_0x5df48b(0x23f)](_0x594fb2,_0x3f701e,_0x572a2e){const _0x53d9c7=a42_0x5df48b;console[_0x53d9c7(0x197)](_0x53d9c7(0x268)+_0x594fb2+'\x20('+_0x572a2e+')'),this[_0x53d9c7(0x22c)](_0x594fb2);const _0xcdb9d6=[],_0x19febe=0x5*0x3c*0x3e8,_0x11ee2e=0x2*0x3c*0x3c*0x3e8,_0x1823c5=Math['floor'](_0x11ee2e/_0x19febe);console['log'](_0x53d9c7(0x1ec)+_0x1823c5+_0x53d9c7(0x1e9));for(let _0x259b0c=0x1;_0x259b0c<=_0x1823c5;_0x259b0c++){const _0x2e9fca=setTimeout(async()=>{const _0x5a5bce=_0x53d9c7;console[_0x5a5bce(0x197)]('🔍\x20MasterCard\x20status\x20check\x20#'+_0x259b0c+'/'+_0x1823c5+'\x20for\x20payment\x20'+_0x594fb2);try{const _0x492e44=await this['checkPaymentStatus'](_0x572a2e,_0x3f701e);console['log'](_0x5a5bce(0x261)+_0x259b0c+_0x5a5bce(0x1b1),_0x492e44),_0x492e44[_0x5a5bce(0x246)]&&(console[_0x5a5bce(0x197)](_0x5a5bce(0x260)+_0x594fb2+_0x5a5bce(0x1d3)+_0x492e44['status']+_0x5a5bce(0x1e6)),this['clearStatusTimers'](_0x594fb2),await this[_0x5a5bce(0x190)](_0x594fb2,_0x492e44[_0x5a5bce(0x224)],_0x492e44));}catch(_0x35d95b){console['error']('❌\x20Status\x20check\x20#'+_0x259b0c+_0x5a5bce(0x198)+_0x594fb2+':',_0x35d95b);}},_0x259b0c*_0x19febe);_0xcdb9d6[_0x53d9c7(0x216)](_0x2e9fca);}this[_0x53d9c7(0x1ef)][_0x53d9c7(0x1e5)](_0x594fb2,_0xcdb9d6),console[_0x53d9c7(0x197)](_0x53d9c7(0x1f8)+_0x1823c5+_0x53d9c7(0x227)+_0x594fb2);}['clearStatusTimers'](_0x174f2a){const _0x42a4cb=a42_0x5df48b,_0x30a06e=this[_0x42a4cb(0x1ef)][_0x42a4cb(0x1c9)](_0x174f2a);_0x30a06e&&(console[_0x42a4cb(0x197)](_0x42a4cb(0x1f2)+_0x30a06e[_0x42a4cb(0x194)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x174f2a),_0x30a06e[_0x42a4cb(0x23e)]((_0x1c1333,_0x2f7215)=>{clearTimeout(_0x1c1333);}),this[_0x42a4cb(0x1ef)][_0x42a4cb(0x1ed)](_0x174f2a));}async[a42_0x5df48b(0x190)](_0x2527b8,_0x182a1b,_0x8658ab){const _0x22c731=a42_0x5df48b;try{const _0x38e262=(await Promise[_0x22c731(0x18f)]()[_0x22c731(0x1a8)](()=>__importStar(require('../../config/database'))))[_0x22c731(0x1f6)],_0x5a7430={'status':_0x182a1b[_0x22c731(0x236)](),'updatedAt':new Date(),'statusChangedBy':_0x22c731(0x264),'statusChangedAt':new Date()};_0x182a1b==='PAID'&&(_0x5a7430[_0x22c731(0x1c0)]=new Date()),_0x8658ab['description']&&(_0x5a7430[_0x22c731(0x1fd)]='MasterCard:\x20'+_0x8658ab[_0x22c731(0x1ee)]),await _0x38e262[_0x22c731(0x212)][_0x22c731(0x187)]({'where':{'id':_0x2527b8},'data':_0x5a7430}),console['log'](_0x22c731(0x260)+_0x2527b8+_0x22c731(0x193)+_0x182a1b),await this[_0x22c731(0x22f)](_0x2527b8,_0x182a1b);}catch(_0x1664a8){console[_0x22c731(0x240)](_0x22c731(0x1e7)+_0x2527b8+':',_0x1664a8);}}async[a42_0x5df48b(0x22f)](_0x4865b4,_0x4ab60d){const _0x1cce93=a42_0x5df48b;try{const _0x1e0949=(await Promise[_0x1cce93(0x18f)]()['then'](()=>__importStar(require(_0x1cce93(0x1fe)))))[_0x1cce93(0x1f6)],{telegramBotService:_0x2f49cc}=await Promise[_0x1cce93(0x18f)]()[_0x1cce93(0x1a8)](()=>__importStar(require('../telegramBotService'))),_0x544af8=await _0x1e0949[_0x1cce93(0x212)][_0x1cce93(0x237)]({'where':{'id':_0x4865b4},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x544af8)return;const _0x3e1c04={'PAID':_0x1cce93(0x185),'FAILED':_0x1cce93(0x269)},_0x1eaf47=_0x3e1c04[_0x4ab60d];_0x1eaf47&&await _0x2f49cc['sendPaymentNotification'](_0x544af8[_0x1cce93(0x1a0)],_0x544af8,_0x1eaf47),await this['sendShopWebhook'](_0x544af8,_0x4ab60d);}catch(_0x5c3f14){console['error']('Failed\x20to\x20send\x20payment\x20notifications:',_0x5c3f14);}}async[a42_0x5df48b(0x18e)](_0x193ae5,_0xd4b647){const _0x48baa5=a42_0x5df48b,_0x1faa45=Date[_0x48baa5(0x254)]();try{const _0x1d9a3f=_0x193ae5[_0x48baa5(0x1cd)],_0x211352=_0x1d9a3f[_0x48baa5(0x19a)];if(!_0x211352?.[_0x48baa5(0x266)]){console['log'](_0x48baa5(0x1f5)+_0x1d9a3f['id']);return;}const _0x24d2d9=_0xd4b647===_0x48baa5(0x18a)?_0x48baa5(0x1de):_0x48baa5(0x1c2);let _0x3291f6=[];if(_0x211352[_0x48baa5(0x1ac)])try{_0x3291f6=Array[_0x48baa5(0x20b)](_0x211352[_0x48baa5(0x1ac)])?_0x211352['webhookEvents']:JSON[_0x48baa5(0x1b5)](_0x211352[_0x48baa5(0x1ac)]);}catch(_0x436a8f){console[_0x48baa5(0x240)]('Error\x20parsing\x20webhook\x20events:',_0x436a8f),_0x3291f6=[];}if(!_0x3291f6[_0x48baa5(0x19d)](_0x24d2d9)){console[_0x48baa5(0x197)]('Webhook\x20event\x20'+_0x24d2d9+_0x48baa5(0x24b)+_0x1d9a3f['id']);return;}const _0x2f5850={'event':_0x24d2d9,'payment':{'id':_0x193ae5['id'],'order_id':_0x193ae5['orderId'],'gateway_order_id':_0x193ae5[_0x48baa5(0x1ba)],'gateway':'1111','amount':_0x193ae5[_0x48baa5(0x226)],'currency':_0x193ae5['currency'],'status':_0xd4b647['toLowerCase'](),'customer_email':_0x193ae5[_0x48baa5(0x1f7)],'customer_name':_0x193ae5[_0x48baa5(0x211)],'created_at':_0x193ae5[_0x48baa5(0x21c)],'updated_at':new Date()}},_0x31f272=await fetch(_0x211352['webhookUrl'],{'method':_0x48baa5(0x1d0),'headers':{'Content-Type':_0x48baa5(0x1cb),'User-Agent':_0x48baa5(0x26c)},'body':JSON[_0x48baa5(0x1cf)](_0x2f5850)}),_0x135417=Date[_0x48baa5(0x254)]()-_0x1faa45;loggerService_1[_0x48baa5(0x181)][_0x48baa5(0x25f)](_0x193ae5['shopId'],_0x211352[_0x48baa5(0x266)],_0x24d2d9,_0x31f272[_0x48baa5(0x224)],_0x135417,_0x2f5850),console['log'](_0x48baa5(0x1fa)+_0x211352[_0x48baa5(0x266)]+_0x48baa5(0x235)+_0x31f272[_0x48baa5(0x224)]+'\x20('+_0x135417+_0x48baa5(0x17e));}catch(_0x3fcb50){console[_0x48baa5(0x240)](_0x48baa5(0x1a9),_0x3fcb50),loggerService_1[_0x48baa5(0x181)][_0x48baa5(0x1b6)](_0x193ae5[_0x48baa5(0x1a0)],_0x193ae5[_0x48baa5(0x1cd)]?.[_0x48baa5(0x19a)]?.[_0x48baa5(0x266)]||_0x48baa5(0x253),_0x48baa5(0x201),_0x3fcb50,{});}}['maskCardNumber'](_0x49acea){const _0x15e54f=a42_0x5df48b,_0x304d8b=_0x49acea['replace'](/[\s-]/g,'');if(_0x304d8b[_0x15e54f(0x194)]<0x4)return _0x15e54f(0x221);return'****\x20****\x20****\x20'+_0x304d8b[_0x15e54f(0x1d9)](-0x4);}async[a42_0x5df48b(0x249)](_0x3d9dab){const _0x418d85=a42_0x5df48b;console['log'](_0x418d85(0x18b),_0x3d9dab);let _0x2df683='PENDING';if(_0x3d9dab['status']===0x1&&_0x3d9dab[_0x418d85(0x246)]===0x1)_0x2df683=_0x418d85(0x18a);else _0x3d9dab[_0x418d85(0x224)]===0x0&&_0x3d9dab[_0x418d85(0x246)]===0x0?_0x2df683='PENDING':_0x2df683=_0x418d85(0x263);return{'paymentId':_0x3d9dab[_0x418d85(0x191)]||'','status':_0x2df683,'amount':_0x3d9dab[_0x418d85(0x226)],'currency':_0x3d9dab[_0x418d85(0x25e)]};}[a42_0x5df48b(0x24d)](){const _0x2bd626=a42_0x5df48b;console[_0x2bd626(0x197)](_0x2bd626(0x199));const _0x47c2dd=this['statusCheckTimers'][_0x2bd626(0x21d)];for(const [_0x151725]of this[_0x2bd626(0x1ef)]){this[_0x2bd626(0x22c)](_0x151725);}console[_0x2bd626(0x197)]('🛑\x20Stopped\x20'+_0x47c2dd+_0x2bd626(0x26d));}}exports['MasterCardService']=MasterCardService;