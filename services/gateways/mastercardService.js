'use strict';const a68_0x1cb155=a68_0x2483;(function(_0x4dac3a,_0x35ac22){const _0x55e804=a68_0x2483,_0x18c53c=_0x4dac3a();while(!![]){try{const _0x133b42=-parseInt(_0x55e804(0x20f))/0x1+parseInt(_0x55e804(0x136))/0x2+parseInt(_0x55e804(0x17f))/0x3+-parseInt(_0x55e804(0x180))/0x4*(-parseInt(_0x55e804(0x1bf))/0x5)+-parseInt(_0x55e804(0x137))/0x6+parseInt(_0x55e804(0xe0))/0x7*(parseInt(_0x55e804(0x1ac))/0x8)+parseInt(_0x55e804(0x12d))/0x9*(-parseInt(_0x55e804(0x1da))/0xa);if(_0x133b42===_0x35ac22)break;else _0x18c53c['push'](_0x18c53c['shift']());}catch(_0x484c0){_0x18c53c['push'](_0x18c53c['shift']());}}}(a68_0x14e0,0x19bc9));function a68_0x14e0(){const _0x39398e=['visa_public.pem','paymentId','\x20failed\x20for\x20payment\x20','Operation\x20completed\x20successfully','üìù\x20Decrypted\x20webhook\x20data:','last_name','\x20MasterCard\x20status\x20check\x20timers','get','__importDefault','üîê\x20AES\x20key\x20length:','MASTERCARD','‚ö†Ô∏è\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','LookUp\x20not\x20confirmed','../../config/database','now','amount','validateKeyFiles','Client\x20OTP\x20confirmation\x20required','üì¶\x20FULL\x20RESPONSE\x20BODY:','logWhiteDomainRequest','first_name','checkPaymentStatus','Failed\x20to\x20decrypt\x20response','‚ö†Ô∏è\x20Expected\x20VISA\x20private\x20key:\x20','===\x20PARSED\x20API\x20RESPONSE\x20===','üìä\x20Status\x20check\x20result:','\x20payment:\x20','/status','üìù\x20Data\x20length:','Failed\x20to\x20send\x20payment\x20notifications:','getDetailedErrorMessage','Insufficient\x20funds\x20on\x20the\x20card','length','base64','logShopWebhookError','final','\x20\x20\x20Currency:\x20','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','crypto','üîç\x20Using\x20','üíæ\x20Saving\x20failure\x20message:\x20','charge','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','createDecipheriv','HTTP\x20','unknown','keys','\x22\x20|\x20\x22','üîê\x20AES\x20key\x20and\x20IV\x20generated','üîê\x20VISA\x20Public\x20key\x20length:\x20','\x20\x20Original:\x20\x22','Captcha\x20confirmation\x20awaited','üìù\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','constants','settings','statusCheckTimers','üìä\x20','sign','payment_id','\x20(from:\x20order_id=','56646cgQFOp','../telegramBotService','/charge_raw','‚úÖ\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','sendPaymentNotifications','decryptResponse','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','call','\x20status\x20updated\x20to\x20','334714yrkRon','698622huRnbY','publicKeyPath','Awaiting\x20confirmation\x20by\x20ivr\x20call','__createBinding','customerName','decryptAES',',\x20paymentId=','Card\x20Holder:',':\x20Unknown\x20status\x20code','trim','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','‚ùå\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','payment','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','/charge_decrypted','replace','‚è∞\x20Will\x20check\x20status\x20','/status_raw','‚úÖ\x20Payment\x20','FAILED','expire_year','üîê\x20MasterCard\x20Public\x20key\x20length:\x20','Cash\x20payment\x20is\x20expected\x20at\x20TCO','parse','üîç\x20Detected\x20card\x20type\x20from\x20webhook:\x20','merchantPointId','slice','LookUp\x20code\x20verified','‚úÖ\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','psp_public.pem','Awaiting\x20confirmation\x20in\x20the\x20application','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','\x20|\x20Response:\x20','4000000000000000','‚ùå\x20Data\x20being\x20signed:','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','https://api.myatranz.com/api','createCipheriv','card_type','size','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','),\x20defaulting\x20to\x20MasterCard','üîê\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','üîê\x20Data\x20encrypted\x20with\x20AES','\x20order_id\x20for\x20search:\x20','Transaction\x20limit\x20exceeded','shop','‚úÖ\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','message','5000000000000000','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','toUpperCase','Result\x20URL:','üìù\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','Decryption\x20failed:\x20','publicEncrypt','default','cwd','No\x20New\x20payment','delete','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','headers','Error\x20details:','Card\x20Number:','Sender\x27s\x20CVV\x20card\x20is\x20required','HTTP\x20error!\x20status:\x20','visaPrivateKeyPath','end','üîç\x20','145422AQbjNr','453800VuvWjV','status','sendShopWebhook','The\x20card\x20does\x20not\x20exist','\x20\x20\x20-\x20key\x20length:','Number\x20of\x20attempts\x20exceeded','üìù\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','\x20status\x20check\x20error:','update','‚ùå\x20Detailed\x20failure\x20description:\x20','üìù\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','push','üßπ\x20Clearing\x20','key','toLowerCase','Expected\x20bitcoin\x20transfer\x20from\x20client','existsSync','webhookUrl','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','Sender\x20information\x20required','‚ö†Ô∏è\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','stringify','üìä\x20Status\x20check\x20#','üîê\x20VISA\x20Private\x20key\x20path:','Error\x20parsing\x20webhook\x20events:','Sender\x27s\x20card\x20details\x20are\x20required','from','Response\x20Headers:','/charge','Payment\x20confirmation\x20time\x20has\x20expired','post_code','üíæ\x20Payment\x20data\x20prepared','encryptRSA','aes-256-ctr','Final:','floor','üîê\x20Data\x20signed\x20with\x20RSA','Unknown\x20error','\x20webhook\x20extracted\x20data:','Payment\x20System/1.0\x20(MasterCard)','-----END','3DS\x20verification\x20required','LookUp\x20number\x20of\x20attempts\x20exceeded','‚úÖ\x20MasterCard\x20key\x20files\x20validated\x20successfully','2488qfEqbN','logWhiteDomainError',',\x20payment_id=','paidAt','join','üîê\x20VISA\x20Public\x20key\x20path:','\x20payment_id\x20for\x20search:\x20','Payment\x20is\x20being\x20processed','The\x20card\x20is\x20lost\x20or\x20stolen','üí≥\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','\x20not\x20enabled\x20for\x20shop\x20','payment.success','Cancellation\x20is\x20not\x20possible','üîç\x20Using\x20provided\x20card\x20type:\x20','üîê\x20VISA\x20Private\x20key\x20length:\x20','description','\x20payment\x20status:\x20','‚úÖ\x20VISA\x20key\x20files\x20validated\x20successfully','üìù\x20Encrypted\x20data\x20length:','5nZsowB','\x20\x20\x20-\x20sign\x20length:','Unsuccessful\x20payment','toString','apiUrl','Payment\x20confirmation\x20required','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','\x20is\x20final\x20(','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','üîê\x20RSA\x20signing\x20successful','updatePaymentStatus','‚è∞\x20Scheduling\x20status\x20checks\x20for\x20','generateAESKey','getCardTypeAndApi','writable','\x20\x20\x20-\x20lang:\x20en','Response\x20Time:','üîê\x20MasterCard\x20API\x20URL:','üîê\x20Response\x20is\x20encrypted,\x20decrypting...','createdAt','‚ùå\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','üîê\x20MasterCard\x20Private\x20key\x20length:\x20','PENDING','path','forEach','loggerService','\x20result:','20hlWLgv','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','üõë\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','info','Invalid\x20expiration\x20date','masterCardMerchantPointId','number','clearStatusTimers','masterCardApiUrl','set','scheduleStatusChecks','****','getOwnPropertyNames','create','digest','****\x20****\x20****\x20','https://api2.trapay.uk/decrypt.php','desc','configurable','includes','Payment\x20cancellation\x20is\x20being\x20processed','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','createSign','none','isArray','\x20characters','visa_private.pem','Status:','‚ùå\x20Status\x20check\x20#','ms)','Failed\x20payment','‚úÖ\x20Payment\x20successful','signRSA','__esModule','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','3DS\x20URL:','Payment\x20ID:','failureMessage','Return\x20URL:','-----BEGIN','currency','privateKeyPath','paymentStatuses','then','decryptResponsePhp','../loggerService','webhook_send','maskCardNumber','\x20for\x20payment\x20','‚ùå\x20VISA/MasterCard\x20key\x20validation\x20failed:','üîÑ\x20Processing\x20MasterCard\x20webhook\x20data:','https://api.paydmeth.com/api','172900dNmEjd','warn','üìù\x20Data\x20to\x20sign\x20length:','üìç\x20Full\x20card\x20holder\x20data:','PIN\x20code\x20confirmation\x20awaited','createHmac','\x20\x20\x20Payment\x20ID:\x20','POST','üì§\x20Sending\x20request\x20to\x20API...','Test\x20payment','Payment\x20returned','text','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','Method\x20not\x20allowed','readFileSync','üìù\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','\x20with\x20status\x20','encryptAES','Payment\x20System/1.0','Payment\x20pending\x20verification','/status_decrypt','cardType','sha256','visaApiUrl','private.pem','),\x20stopping\x20status\x20checks','processWebhook','postcode','shopId','üìù\x20Signature\x20length:','3ds_url','orderId','VisaMasterCardService','json','VISA','üì¶\x20FULL\x20RESPONSE\x20JSON:','\x20\x20\x20-\x20info\x20length:','SHA256','log','isFinalStatus','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','\x20\x20\x20Status:\x20','‚ö†Ô∏è\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','error','\x20status\x20check\x20#','üîê\x20VISA\x20API\x20URL:','Failed\x20to\x20send\x20MasterCard\x20webhook:',',\x20Desc:\x20','HTTP\x20Status:','utf8','webhookEvents','Status\x20','findUnique',',\x20orderId=','‚ùå\x20Failed\x20to\x20decrypt\x20status\x20response:','üìù\x20Final\x20request\x20structure:','__setModuleDefault','Status\x20Text:','application/json','1757MkZdwv','logWhiteDomainResponse','üìä\x20Checking\x20','order_id','country','‚ö†Ô∏è\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','Failed\x20to\x20check\x20','PAID',',\x20Final:\x20','üéØ\x20Using\x20','randomBytes','visaPublicKeyPath','Another\x20unknown\x20error','resolve','defineProperty','expire_month'];a68_0x14e0=function(){return _0x39398e;};return a68_0x14e0();}var __createBinding=this&&this[a68_0x1cb155(0x13a)]||(Object[a68_0x1cb155(0x1e8)]?function(_0x162fb5,_0x5690f9,_0x2a455e,_0x1af516){const _0x4323e0=a68_0x1cb155;if(_0x1af516===undefined)_0x1af516=_0x2a455e;var _0x1a03b8=Object['getOwnPropertyDescriptor'](_0x5690f9,_0x2a455e);(!_0x1a03b8||(_0x4323e0(0xf8)in _0x1a03b8?!_0x5690f9['__esModule']:_0x1a03b8[_0x4323e0(0x1cd)]||_0x1a03b8[_0x4323e0(0x1ed)]))&&(_0x1a03b8={'enumerable':!![],'get':function(){return _0x5690f9[_0x2a455e];}}),Object[_0x4323e0(0xef)](_0x162fb5,_0x1af516,_0x1a03b8);}:function(_0x3c1156,_0x323377,_0x1d0627,_0x29bee5){if(_0x29bee5===undefined)_0x29bee5=_0x1d0627;_0x3c1156[_0x29bee5]=_0x323377[_0x1d0627];}),__setModuleDefault=this&&this[a68_0x1cb155(0xdd)]||(Object[a68_0x1cb155(0x1e8)]?function(_0x5d68a1,_0x416a1d){const _0x56204f=a68_0x1cb155;Object[_0x56204f(0xef)](_0x5d68a1,_0x56204f(0x171),{'enumerable':!![],'value':_0x416a1d});}:function(_0x23e3a6,_0x16680c){const _0xeae030=a68_0x1cb155;_0x23e3a6[_0xeae030(0x171)]=_0x16680c;}),__importStar=this&&this['__importStar']||(function(){var _0x224c3a=function(_0x329ba0){const _0x6fafcb=a68_0x2483;return _0x224c3a=Object[_0x6fafcb(0x1e7)]||function(_0x4c0432){const _0x5422e7=_0x6fafcb;var _0x2d6fd7=[];for(var _0x4adf24 in _0x4c0432)if(Object['prototype']['hasOwnProperty'][_0x5422e7(0x134)](_0x4c0432,_0x4adf24))_0x2d6fd7[_0x2d6fd7[_0x5422e7(0x111)]]=_0x4adf24;return _0x2d6fd7;},_0x224c3a(_0x329ba0);};return function(_0x64de91){const _0x587e3d=a68_0x2483;if(_0x64de91&&_0x64de91[_0x587e3d(0x1fc)])return _0x64de91;var _0x315489={};if(_0x64de91!=null){for(var _0x111f43=_0x224c3a(_0x64de91),_0x2b5071=0x0;_0x2b5071<_0x111f43[_0x587e3d(0x111)];_0x2b5071++)if(_0x111f43[_0x2b5071]!==_0x587e3d(0x171))__createBinding(_0x315489,_0x64de91,_0x111f43[_0x2b5071]);}return __setModuleDefault(_0x315489,_0x64de91),_0x315489;};}()),__importDefault=this&&this[a68_0x1cb155(0xf9)]||function(_0x3b1ae1){const _0x150833=a68_0x1cb155;return _0x3b1ae1&&_0x3b1ae1[_0x150833(0x1fc)]?_0x3b1ae1:{'default':_0x3b1ae1};};Object[a68_0x1cb155(0xef)](exports,'__esModule',{'value':!![]}),exports[a68_0x1cb155(0x22f)]=void 0x0;const crypto_1=__importDefault(require(a68_0x1cb155(0x117))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a68_0x1cb155(0x1d6))),loggerService_1=require(a68_0x1cb155(0x208));class VisaMasterCardService{constructor(){const _0x495d74=a68_0x1cb155;this['statusCheckTimers']=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0x495d74(0x173)},0x1:{'final':![],'description':'No\x20Error\x20executing\x20request'},0x2:{'final':!![],'description':'Request\x20data\x20error'},0x3:{'final':!![],'description':_0x495d74(0xed)},0x4:{'final':!![],'description':'Unsuccessful\x20payment'},0x5:{'final':!![],'description':_0x495d74(0x116)},0x6:{'final':!![],'description':_0x495d74(0x219)},0x7:{'final':!![],'description':_0x495d74(0x218)},0x8:{'final':![],'description':_0x495d74(0x102)},0x9:{'final':![],'description':_0x495d74(0x1a9)},0xa:{'final':![],'description':_0x495d74(0x17a)},0xb:{'final':![],'description':_0x495d74(0x193)},0xc:{'final':![],'description':'Recipient\x20data\x20required'},0xd:{'final':![],'description':_0x495d74(0x1c7)},0xe:{'final':![],'description':_0x495d74(0x139)},0xf:{'final':![],'description':_0x495d74(0x213)},0x10:{'final':![],'description':_0x495d74(0x124)},0x11:{'final':![],'description':_0x495d74(0x16b)},0x12:{'final':![],'description':_0x495d74(0x155)},0x13:{'final':![],'description':_0x495d74(0x1b3)},0x14:{'final':![],'description':_0x495d74(0x16a)},0x15:{'final':![],'description':_0x495d74(0x18f)},0x16:{'final':![],'description':_0x495d74(0x222)},0x18:{'final':![],'description':'The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited'},0x19:{'final':![],'description':_0x495d74(0x15a)},0x1a:{'final':!![],'description':_0x495d74(0x14d)},0x1b:{'final':![],'description':'Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code'},0x1c:{'final':![],'description':_0x495d74(0x141)},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':_0x495d74(0x1c5)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':_0x495d74(0x199)},0x24:{'final':!![],'description':_0x495d74(0x19d)},0x25:{'final':!![],'description':'Payment\x20prohibited'},0x26:{'final':!![],'description':_0x495d74(0x11b)},0x27:{'final':!![],'description':_0x495d74(0x110)},0x28:{'final':!![],'description':_0x495d74(0x183)},0x29:{'final':!![],'description':_0x495d74(0x1b4)},0x2a:{'final':!![],'description':_0x495d74(0x1df)},0x2b:{'final':!![],'description':_0x495d74(0x165)},0x2c:{'final':!![],'description':_0x495d74(0x1fd)},0x2d:{'final':!![],'description':_0x495d74(0x1f9)},0x2e:{'final':!![],'description':_0x495d74(0x1c1)},0x2f:{'final':!![],'description':_0x495d74(0x1c1)},0x30:{'final':!![],'description':_0x495d74(0x192)},0x31:{'final':![],'description':_0x495d74(0x1c4)},0x32:{'final':!![],'description':_0x495d74(0x21c)},0x33:{'final':!![],'description':_0x495d74(0x1f9)},0x34:{'final':!![],'description':_0x495d74(0x1f9)},0x35:{'final':!![],'description':_0x495d74(0x1f9)},0x36:{'final':!![],'description':_0x495d74(0x1f9)},0x37:{'final':!![],'description':_0x495d74(0x1f9)},0x38:{'final':!![],'description':_0x495d74(0x1b8)},0x39:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank'},0x3a:{'final':![],'description':'LookUp\x20code\x20sent'},0x3b:{'final':!![],'description':_0x495d74(0x152)},0x3c:{'final':!![],'description':_0x495d74(0x185)},0x3d:{'final':!![],'description':_0x495d74(0x15f)},0x3e:{'final':!![],'description':_0x495d74(0x133)},0x3f:{'final':!![],'description':_0x495d74(0x219)},0x40:{'final':![],'description':_0x495d74(0xfd)},0x41:{'final':!![],'description':_0x495d74(0x1aa)},0x42:{'final':![],'description':_0x495d74(0x1ef)},0x43:{'final':!![],'description':_0x495d74(0x144)},0x44:{'final':![],'description':_0x495d74(0x1a9)},0x45:{'final':!![],'description':'Failed\x20payment'},0x46:{'final':!![],'description':'Failed\x20payment'},0x47:{'final':!![],'description':_0x495d74(0x237)},0x64:{'final':!![],'description':_0x495d74(0xf4)}},this[_0x495d74(0x1e3)]=_0x495d74(0x15b),this[_0x495d74(0x1e0)]=0x50ca,this[_0x495d74(0x204)]=path_1[_0x495d74(0x171)]['join'](process[_0x495d74(0x172)](),'keys',_0x495d74(0x227)),this[_0x495d74(0x138)]=path_1[_0x495d74(0x171)]['join'](process['cwd'](),_0x495d74(0x11f),_0x495d74(0x154)),this[_0x495d74(0x226)]=_0x495d74(0x20e),this['visaMerchantPointId']=0x6b7,this[_0x495d74(0x17c)]=path_1[_0x495d74(0x171)][_0x495d74(0x1b0)](process[_0x495d74(0x172)](),'keys',_0x495d74(0x1f5)),this[_0x495d74(0xec)]=path_1[_0x495d74(0x171)]['join'](process[_0x495d74(0x172)](),'keys',_0x495d74(0xf1)),console['log']('üí≥\x20VISA/MasterCard\x20service\x20initialized'),console['log'](_0x495d74(0x1d0),this[_0x495d74(0x1e3)]),console['log'](_0x495d74(0x23c),this['visaApiUrl']),console[_0x495d74(0x235)]('üîê\x20MasterCard\x20Private\x20key\x20path:',this['privateKeyPath']),console[_0x495d74(0x235)]('üîê\x20MasterCard\x20Public\x20key\x20path:',this['publicKeyPath']),console['log'](_0x495d74(0x197),this[_0x495d74(0x17c)]),console[_0x495d74(0x235)](_0x495d74(0x1b1),this[_0x495d74(0xec)]),this[_0x495d74(0x101)]();}[a68_0x1cb155(0x10f)](_0xe07e94,_0x189801){const _0x45305a=a68_0x1cb155,_0x1ab393=this[_0x45305a(0x205)][_0xe07e94];let _0x3682f4='';_0x1ab393?_0x3682f4='Status\x20'+_0xe07e94+':\x20'+_0x1ab393[_0x45305a(0x1bb)]:_0x3682f4=_0x45305a(0x242)+_0xe07e94+_0x45305a(0x13f);if(_0x189801&&_0x189801['trim']()){const _0x37561e=_0x189801[_0x45305a(0x140)]();(!_0x1ab393||_0x37561e['toLowerCase']()!==_0x1ab393[_0x45305a(0x1bb)][_0x45305a(0x18e)]())&&(_0x3682f4+=_0x45305a(0x157)+_0x37561e);}return _0x3682f4;}[a68_0x1cb155(0x236)](_0x2603e9){const _0xfd4d6e=a68_0x1cb155,_0xdf703=this[_0xfd4d6e(0x205)][_0x2603e9];return _0xdf703?_0xdf703[_0xfd4d6e(0x114)]:!![];}[a68_0x1cb155(0x1cc)](_0x1ae336){const _0x5d224a=a68_0x1cb155,_0x3a66fc=_0x1ae336['charAt'](0x0);if(_0x3a66fc==='4')return console[_0x5d224a(0x235)](_0x5d224a(0x1b5)),{'cardType':_0x5d224a(0x231),'apiUrl':this[_0x5d224a(0x226)],'privateKeyPath':this[_0x5d224a(0x17c)],'publicKeyPath':this[_0x5d224a(0xec)],'merchantPointId':this['visaMerchantPointId']};else return _0x3a66fc==='5'?(console['log']('üí≥\x20Detected\x20MasterCard\x20(starts\x20with\x205)'),{'cardType':_0x5d224a(0xfb),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x5d224a(0x204)],'publicKeyPath':this[_0x5d224a(0x138)],'merchantPointId':this[_0x5d224a(0x1e0)]}):(console['log']('üí≥\x20Unknown\x20card\x20type\x20(starts\x20with\x20'+_0x3a66fc+_0x5d224a(0x160)),{'cardType':_0x5d224a(0xfb),'apiUrl':this[_0x5d224a(0x1e3)],'privateKeyPath':this['privateKeyPath'],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x5d224a(0x1e0)]});}[a68_0x1cb155(0x101)](){const _0x5c618e=a68_0x1cb155;try{if(!fs_1[_0x5c618e(0x171)][_0x5c618e(0x190)](this[_0x5c618e(0x204)]))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this['privateKeyPath']);if(!fs_1[_0x5c618e(0x171)]['existsSync'](this[_0x5c618e(0x138)]))throw new Error('MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20'+this[_0x5c618e(0x138)]);const _0xda4d15=fs_1[_0x5c618e(0x171)][_0x5c618e(0x21d)](this['privateKeyPath'],_0x5c618e(0x240))[_0x5c618e(0x140)](),_0x53bd74=fs_1[_0x5c618e(0x171)][_0x5c618e(0x21d)](this[_0x5c618e(0x138)],_0x5c618e(0x240))[_0x5c618e(0x140)]();if(!_0xda4d15['includes']('-----BEGIN')||!_0xda4d15[_0x5c618e(0x1ee)](_0x5c618e(0x1a8)))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x53bd74[_0x5c618e(0x1ee)](_0x5c618e(0x202))||!_0x53bd74[_0x5c618e(0x1ee)]('-----END'))throw new Error(_0x5c618e(0x1db));console[_0x5c618e(0x235)](_0x5c618e(0x1ab)),console['log'](_0x5c618e(0x1d4)+_0xda4d15['length']+_0x5c618e(0x1f4)),console[_0x5c618e(0x235)](_0x5c618e(0x14c)+_0x53bd74[_0x5c618e(0x111)]+'\x20characters');if(fs_1[_0x5c618e(0x171)][_0x5c618e(0x190)](this['visaPrivateKeyPath'])&&fs_1['default'][_0x5c618e(0x190)](this[_0x5c618e(0xec)])){const _0x58c886=fs_1[_0x5c618e(0x171)][_0x5c618e(0x21d)](this[_0x5c618e(0x17c)],_0x5c618e(0x240))[_0x5c618e(0x140)](),_0x508634=fs_1['default'][_0x5c618e(0x21d)](this[_0x5c618e(0xec)],'utf8')[_0x5c618e(0x140)]();(!_0x58c886[_0x5c618e(0x1ee)](_0x5c618e(0x202))||!_0x58c886[_0x5c618e(0x1ee)](_0x5c618e(0x1a8)))&&console[_0x5c618e(0x210)](_0x5c618e(0xe5)),(!_0x508634[_0x5c618e(0x1ee)]('-----BEGIN')||!_0x508634[_0x5c618e(0x1ee)](_0x5c618e(0x1a8)))&&console[_0x5c618e(0x210)](_0x5c618e(0x239)),console[_0x5c618e(0x235)](_0x5c618e(0x1bd)),console[_0x5c618e(0x235)](_0x5c618e(0x1ba)+_0x58c886['length']+_0x5c618e(0x1f4)),console[_0x5c618e(0x235)](_0x5c618e(0x122)+_0x508634[_0x5c618e(0x111)]+_0x5c618e(0x1f4));}else console[_0x5c618e(0x210)](_0x5c618e(0x194)),console[_0x5c618e(0x210)](_0x5c618e(0x108)+this[_0x5c618e(0x17c)]),console[_0x5c618e(0x210)]('‚ö†Ô∏è\x20Expected\x20VISA\x20public\x20key:\x20'+this[_0x5c618e(0xec)]);}catch(_0x20bf19){console['error'](_0x5c618e(0x20c),_0x20bf19);throw _0x20bf19;}}[a68_0x1cb155(0x1cb)](){const _0x2ed04c=a68_0x1cb155,_0x122b35=crypto_1[_0x2ed04c(0x171)][_0x2ed04c(0xeb)](0x20),_0x100d50=crypto_1[_0x2ed04c(0x171)][_0x2ed04c(0xeb)](0x10);return{'key':_0x122b35,'iv':_0x100d50};}['encryptAES'](_0x25d673,_0xcab3d9,_0x327988){const _0x364a94=a68_0x1cb155,_0x4fe941=crypto_1[_0x364a94(0x171)][_0x364a94(0x15c)](_0x364a94(0x1a1),_0xcab3d9,_0x327988);let _0x4e6cdb=_0x4fe941[_0x364a94(0x188)](_0x25d673,_0x364a94(0x240),'base64');return _0x4e6cdb+=_0x4fe941[_0x364a94(0x114)](_0x364a94(0x112)),_0x4e6cdb;}[a68_0x1cb155(0x1a0)](_0x116955,_0x1afef4,_0x518771){const _0x53bf72=a68_0x1cb155;try{const _0x566f3a=fs_1[_0x53bf72(0x171)][_0x53bf72(0x21d)](_0x518771,_0x53bf72(0x240))[_0x53bf72(0x140)](),_0x9714b4={'iv':_0x1afef4['toString'](_0x53bf72(0x112)),'key':_0x116955[_0x53bf72(0x1c2)](_0x53bf72(0x112))},_0x146dee=JSON[_0x53bf72(0x195)](_0x9714b4);console[_0x53bf72(0x235)]('üîê\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x146dee[_0x53bf72(0x111)]);const _0x584183=crypto_1['default'][_0x53bf72(0x170)]({'key':_0x566f3a,'padding':crypto_1[_0x53bf72(0x171)][_0x53bf72(0x126)]['RSA_PKCS1_PADDING']},Buffer[_0x53bf72(0x19a)](_0x146dee));return console['log'](_0x53bf72(0x167),_0x584183[_0x53bf72(0x111)]),_0x584183[_0x53bf72(0x1c2)](_0x53bf72(0x112));}catch(_0x1bfc3f){console[_0x53bf72(0x23a)]('‚ùå\x20RSA\x20encryption\x20failed:',_0x1bfc3f);throw new Error(_0x53bf72(0x1f0));}}[a68_0x1cb155(0x1fb)](_0x3099a3,_0x3c9779){const _0x5d8143=a68_0x1cb155;try{const _0x25db38=fs_1[_0x5d8143(0x171)][_0x5d8143(0x21d)](_0x3c9779,_0x5d8143(0x240))[_0x5d8143(0x140)](),_0x22b287=crypto_1[_0x5d8143(0x171)][_0x5d8143(0x1f1)](_0x5d8143(0x234));_0x22b287['update'](_0x3099a3),_0x22b287[_0x5d8143(0x17d)]();const _0x2d737e=_0x22b287['sign'](_0x25db38,_0x5d8143(0x112));return console[_0x5d8143(0x235)](_0x5d8143(0x1c8)),console[_0x5d8143(0x235)](_0x5d8143(0x211),_0x3099a3[_0x5d8143(0x111)]),console['log'](_0x5d8143(0x22c),_0x2d737e['length']),_0x2d737e;}catch(_0xfe2653){console[_0x5d8143(0x23a)]('‚ùå\x20RSA\x20signing\x20failed:',_0xfe2653),console['error'](_0x5d8143(0x159),_0x3099a3['substring'](0x0,0xc8)+'...');throw new Error(_0x5d8143(0xe6));}}[a68_0x1cb155(0x13c)](_0x144312,_0x36bd3e,_0x3b5d5d){const _0x24bf2b=a68_0x1cb155,_0x88dd11=crypto_1[_0x24bf2b(0x171)][_0x24bf2b(0x11c)](_0x24bf2b(0x1a1),_0x36bd3e,_0x3b5d5d);let _0x4f20ae=_0x88dd11['update'](_0x144312,_0x24bf2b(0x112),_0x24bf2b(0x240));return _0x4f20ae+=_0x88dd11['final'](_0x24bf2b(0x240)),_0x4f20ae;}async[a68_0x1cb155(0x207)](_0x4594a1,_0x2d15d3,_0x10595a=a68_0x1cb155(0xfb)){const _0x4fb379=a68_0x1cb155;try{const _0x3dfd7b=await fetch(_0x4fb379(0x1eb),{'method':_0x4fb379(0x216),'headers':{'Content-Type':_0x4fb379(0xdf)},'body':JSON['stringify']({'info':_0x4594a1,'key':_0x2d15d3,'card_type':_0x10595a[_0x4fb379(0x18e)]()})});if(!_0x3dfd7b['ok'])throw new Error('PHP\x20decryptor\x20error');return await _0x3dfd7b[_0x4fb379(0x21a)]();}catch(_0xec75e8){console['error']('‚ùå\x20PHP\x20decryptor\x20request\x20failed:',_0xec75e8);throw new Error(_0x4fb379(0x156));}}[a68_0x1cb155(0x132)](_0x28a4ba,_0x5926e6){const _0x50f66e=a68_0x1cb155;try{const _0x443818=fs_1[_0x50f66e(0x171)][_0x50f66e(0x21d)](this[_0x50f66e(0x204)],_0x50f66e(0x240))[_0x50f66e(0x140)](),_0x5e0102=crypto_1[_0x50f66e(0x171)]['privateDecrypt'](_0x443818,Buffer['from'](_0x5926e6,'base64')),_0x737506=JSON[_0x50f66e(0x14e)](_0x5e0102[_0x50f66e(0x1c2)]()),_0x2ac1a9=Buffer[_0x50f66e(0x19a)](_0x737506[_0x50f66e(0x18d)],_0x50f66e(0x112)),_0x51b8da=Buffer[_0x50f66e(0x19a)](_0x737506['iv'],'base64');return this[_0x50f66e(0x13c)](_0x28a4ba,_0x2ac1a9,_0x51b8da);}catch(_0x2b05bc){throw new Error(_0x50f66e(0x107));}}async['processCardPayment'](_0x4f77d0){const _0x3bb13d=a68_0x1cb155,{paymentId:_0x158f6b,orderId:_0x26fa9f,amount:_0x1ca123,currency:_0x49f17b,cardData:_0x53bb69,resultUrl:_0x3685b6,returnUrl:_0x546385,cardHolder:_0x2de474,browser:_0x2dae79}=_0x4f77d0;console[_0x3bb13d(0x235)](_0x3bb13d(0x1dc)),console[_0x3bb13d(0x235)](_0x3bb13d(0x1ff),_0x158f6b),console[_0x3bb13d(0x235)]('Order\x20ID:',_0x26fa9f),console['log']('Amount:',_0x1ca123,_0x49f17b),console[_0x3bb13d(0x235)](_0x3bb13d(0x179),this[_0x3bb13d(0x20a)](_0x53bb69['number'])),console[_0x3bb13d(0x235)](_0x3bb13d(0x13e),_0x2de474[_0x3bb13d(0x105)]+'\x20'+_0x2de474['last_name']),console[_0x3bb13d(0x235)](_0x3bb13d(0x201),_0x546385),console[_0x3bb13d(0x235)](_0x3bb13d(0x16d),_0x3685b6);const _0x3511b0=this[_0x3bb13d(0x1cc)](_0x53bb69[_0x3bb13d(0x1e1)]);console[_0x3bb13d(0x235)](_0x3bb13d(0xea)+_0x3511b0['cardType']+'\x20API:\x20'+_0x3511b0[_0x3bb13d(0x1c3)]),console[_0x3bb13d(0x235)]('üîê\x20Using\x20keys:\x20'+_0x3511b0['privateKeyPath']+',\x20'+_0x3511b0[_0x3bb13d(0x138)]);const _0x3e98d6={..._0x2de474,'first_name':_0x2de474[_0x3bb13d(0x105)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')['trim']()||'','last_name':_0x2de474[_0x3bb13d(0xf6)]?.[_0x3bb13d(0x146)](/[\t\n\r\f\v]/g,'\x20')['trim']()||''};_0x3bb13d(0x22a)in _0x3e98d6&&!(_0x3bb13d(0x19e)in _0x3e98d6)&&(_0x3e98d6[_0x3bb13d(0x19e)]=_0x3e98d6[_0x3bb13d(0x22a)],delete _0x3e98d6[_0x3bb13d(0x22a)],console[_0x3bb13d(0x235)]('üîÑ\x20Converted\x20postcode\x20to\x20post_code:\x20'+_0x3e98d6[_0x3bb13d(0x19e)]));console[_0x3bb13d(0x235)]('üßπ\x20Card\x20holder\x20names\x20cleaned:'),console[_0x3bb13d(0x235)](_0x3bb13d(0x123)+_0x2de474[_0x3bb13d(0x105)]+_0x3bb13d(0x120)+_0x2de474['last_name']+'\x22'),console[_0x3bb13d(0x235)]('\x20\x20Cleaned:\x20\x20\x22'+_0x3e98d6[_0x3bb13d(0x105)]+_0x3bb13d(0x120)+_0x3e98d6[_0x3bb13d(0xf6)]+'\x22'),console[_0x3bb13d(0x235)](_0x3bb13d(0x212),JSON[_0x3bb13d(0x195)](_0x3e98d6,null,0x2));const _0x1e21a9={'amount':_0x1ca123,'currency':_0x49f17b[_0x3bb13d(0x16c)](),'order_id':_0x26fa9f,'result_url':_0x3685b6,'return_url':_0x546385,'country':_0x3e98d6[_0x3bb13d(0xe4)]||'','card':{'number':_0x53bb69[_0x3bb13d(0x1e1)],'expire_month':_0x53bb69[_0x3bb13d(0xf0)],'expire_year':_0x53bb69[_0x3bb13d(0x14b)],'cvv':_0x53bb69['cvv']},'card_holder':_0x3e98d6,'browser':_0x2dae79},_0x4f7c73=JSON['stringify'](_0x1e21a9);console[_0x3bb13d(0x235)](_0x3bb13d(0x19f)),console[_0x3bb13d(0x235)](_0x3bb13d(0x186)),console[_0x3bb13d(0x235)](_0x4f7c73),console[_0x3bb13d(0x235)](_0x3bb13d(0x10d),_0x4f7c73[_0x3bb13d(0x111)]);try{const {key:_0x1f3ccd,iv:_0x539ed6}=this[_0x3bb13d(0x1cb)]();console[_0x3bb13d(0x235)](_0x3bb13d(0x121)),console[_0x3bb13d(0x235)](_0x3bb13d(0xfa),_0x1f3ccd[_0x3bb13d(0x111)]),console[_0x3bb13d(0x235)]('üîê\x20AES\x20IV\x20length:',_0x539ed6[_0x3bb13d(0x111)]);const _0x3aa2fe=this[_0x3bb13d(0x220)](_0x4f7c73,_0x1f3ccd,_0x539ed6);console[_0x3bb13d(0x235)](_0x3bb13d(0x163)),console[_0x3bb13d(0x235)](_0x3bb13d(0x1be),_0x3aa2fe['length']);const _0x1ecf34=this[_0x3bb13d(0x1a0)](_0x1f3ccd,_0x539ed6,_0x3511b0['publicKeyPath']);console[_0x3bb13d(0x235)]('üîê\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x3bb13d(0x235)]('üìù\x20Encrypted\x20key\x20length:',_0x1ecf34[_0x3bb13d(0x111)]);const _0x21bb14=this[_0x3bb13d(0x1fb)](_0x4f7c73,_0x3511b0[_0x3bb13d(0x204)]);console[_0x3bb13d(0x235)](_0x3bb13d(0x1a4)),console[_0x3bb13d(0x235)]('üìù\x20Signature\x20length:',_0x21bb14['length']);const _0x45dbc6={'merchant_point_id':_0x3511b0[_0x3bb13d(0x150)],'method':_0x3bb13d(0x11a),'info':_0x3aa2fe,'key':_0x1ecf34,'sign':_0x21bb14,'lang':'en'};console[_0x3bb13d(0x235)](_0x3bb13d(0x217)),console[_0x3bb13d(0x235)](_0x3bb13d(0x246)),console[_0x3bb13d(0x235)]('\x20\x20\x20-\x20merchant_point_id:',_0x3511b0[_0x3bb13d(0x150)]),console[_0x3bb13d(0x235)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x3bb13d(0x235)](_0x3bb13d(0x233),_0x3aa2fe[_0x3bb13d(0x111)]),console[_0x3bb13d(0x235)](_0x3bb13d(0x184),_0x1ecf34[_0x3bb13d(0x111)]),console[_0x3bb13d(0x235)](_0x3bb13d(0x1c0),_0x21bb14['length']),console['log'](_0x3bb13d(0x1ce)),console['log'](''),console[_0x3bb13d(0x235)]('üì¶\x20FULL\x20REQUEST\x20JSON:'),console[_0x3bb13d(0x235)](JSON[_0x3bb13d(0x195)](_0x45dbc6,null,0x2)),console[_0x3bb13d(0x235)](''),loggerService_1[_0x3bb13d(0x1d8)][_0x3bb13d(0x104)](_0x3511b0['cardType'][_0x3bb13d(0x18e)](),'/charge',_0x3bb13d(0x216),{'merchant_point_id':_0x3511b0['merchantPointId'],'method':'charge','lang':'en'});const _0x2bab9c=Date[_0x3bb13d(0xff)](),_0x12b3a1=await fetch(_0x3511b0['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x3bb13d(0xdf),'Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x3bb13d(0x195)](_0x45dbc6)}),_0x62e7f=Date[_0x3bb13d(0xff)]()-_0x2bab9c;console[_0x3bb13d(0x235)]('===\x20API\x20RESPONSE\x20==='),console[_0x3bb13d(0x235)](_0x3bb13d(0x1f6),_0x12b3a1[_0x3bb13d(0x181)]),console['log'](_0x3bb13d(0xde),_0x12b3a1['statusText']),console[_0x3bb13d(0x235)](_0x3bb13d(0x1cf),_0x62e7f+'ms'),console['log'](_0x3bb13d(0x19b)),_0x12b3a1[_0x3bb13d(0x177)]['forEach']((_0x4e8dd8,_0x791701)=>{const _0x5c1567=_0x3bb13d;console[_0x5c1567(0x235)]('\x20\x20\x20'+_0x791701+':\x20'+_0x4e8dd8);}),console['log']('');if(!_0x12b3a1['ok']){const _0x34cf6d=await _0x12b3a1[_0x3bb13d(0x21a)]();console[_0x3bb13d(0x23a)](_0x3bb13d(0x23f),_0x12b3a1['status']),console[_0x3bb13d(0x23a)](_0x3bb13d(0x103)),console[_0x3bb13d(0x23a)](_0x34cf6d),console['error'](''),loggerService_1['loggerService'][_0x3bb13d(0xe1)](_0x3511b0[_0x3bb13d(0x224)][_0x3bb13d(0x18e)](),_0x3bb13d(0x12f),_0x12b3a1['status'],_0x34cf6d,_0x62e7f),loggerService_1[_0x3bb13d(0x1d8)][_0x3bb13d(0x1ad)](_0x3511b0[_0x3bb13d(0x224)][_0x3bb13d(0x18e)](),_0x3bb13d(0x19c),_0x3bb13d(0x11d)+_0x12b3a1[_0x3bb13d(0x181)]+':\x20'+_0x34cf6d);throw new Error(_0x3bb13d(0x17b)+_0x12b3a1['status']+',\x20body:\x20'+_0x34cf6d);}const _0x3fc9bb=await _0x12b3a1[_0x3bb13d(0x230)]();console['log'](_0x3bb13d(0x232)),console['log'](JSON[_0x3bb13d(0x195)](_0x3fc9bb,null,0x2)),console[_0x3bb13d(0x235)](''),loggerService_1[_0x3bb13d(0x1d8)][_0x3bb13d(0xe1)](_0x3511b0[_0x3bb13d(0x224)][_0x3bb13d(0x18e)](),_0x3bb13d(0x12f),_0x12b3a1[_0x3bb13d(0x181)],_0x3fc9bb,_0x62e7f),console['log'](_0x3bb13d(0x109));let _0x149bc7=_0x3fc9bb;if(_0x3fc9bb[_0x3bb13d(0x1de)]&&_0x3fc9bb[_0x3bb13d(0x18d)]&&_0x3fc9bb[_0x3bb13d(0x12a)]){console[_0x3bb13d(0x235)](_0x3bb13d(0x1d1));try{const _0x5830de=await this[_0x3bb13d(0x207)](_0x3fc9bb['info'],_0x3fc9bb['key'],_0x3511b0[_0x3bb13d(0x224)]);_0x149bc7=JSON['parse'](_0x5830de),console[_0x3bb13d(0x235)](_0x3bb13d(0x153)),loggerService_1[_0x3bb13d(0x1d8)]['logWhiteDomainResponse'](_0x3511b0[_0x3bb13d(0x224)]['toLowerCase'](),_0x3bb13d(0x145),_0x12b3a1[_0x3bb13d(0x181)],_0x149bc7,_0x62e7f),console[_0x3bb13d(0x235)](_0x3bb13d(0x125));}catch(_0x5b2b09){console[_0x3bb13d(0x23a)]('‚ùå\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x5b2b09),loggerService_1['loggerService'][_0x3bb13d(0x1ad)](_0x3511b0[_0x3bb13d(0x224)][_0x3bb13d(0x18e)](),'/charge_decrypt',_0x3bb13d(0x16f)+_0x5b2b09),_0x149bc7=_0x3fc9bb;}}else loggerService_1['loggerService'][_0x3bb13d(0xe1)](_0x3511b0['cardType'][_0x3bb13d(0x18e)](),'/charge_decrypted',_0x12b3a1[_0x3bb13d(0x181)],_0x149bc7,_0x62e7f),console[_0x3bb13d(0x235)]('üìù\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x3bb13d(0x235)](_0x3bb13d(0x1f6),_0x149bc7[_0x3bb13d(0x181)]),console[_0x3bb13d(0x235)](_0x3bb13d(0x1a2),_0x149bc7[_0x3bb13d(0x114)]),console[_0x3bb13d(0x235)](_0x3bb13d(0x1ff),_0x149bc7['payment_id']),console[_0x3bb13d(0x235)](_0x3bb13d(0x1fe),_0x149bc7[_0x3bb13d(0x22d)]||_0x3bb13d(0x1f2));if(_0x149bc7[_0x3bb13d(0x181)]===0x64&&_0x149bc7[_0x3bb13d(0x114)]===0x1)return console[_0x3bb13d(0x235)](_0x3bb13d(0x1fa)),{'gateway_payment_id':_0x149bc7[_0x3bb13d(0x12b)]?.[_0x3bb13d(0x1c2)](),'payment_url':_0x546385,'requires_3ds':![],'status':_0x3bb13d(0xe8),'final':!![]};if(_0x149bc7[_0x3bb13d(0x22d)])return console['log']('üîê\x203DS\x20verification\x20required'),this[_0x3bb13d(0x1e5)](_0x158f6b,_0x26fa9f,_0x149bc7[_0x3bb13d(0x12b)]?.[_0x3bb13d(0x1c2)]()||_0x26fa9f,_0x3511b0[_0x3bb13d(0x224)]),{'gateway_payment_id':_0x149bc7['payment_id']?.['toString'](),'payment_url':_0x149bc7[_0x3bb13d(0x22d)],'requires_3ds':!![],'threeds_url':_0x149bc7[_0x3bb13d(0x22d)],'status':_0x3bb13d(0x1d5),'final':![]};let _0x4e5881=this[_0x3bb13d(0x10f)](_0x149bc7[_0x3bb13d(0x181)],_0x149bc7[_0x3bb13d(0x1ec)]||_0x149bc7[_0x3bb13d(0x168)]),_0x378fcb=_0x149bc7['status'],_0x28fa2=this[_0x3bb13d(0x236)](_0x149bc7[_0x3bb13d(0x181)]);return console[_0x3bb13d(0x235)](_0x3bb13d(0x142)+_0x378fcb+_0x3bb13d(0xe9)+_0x28fa2+_0x3bb13d(0x23e)+_0x4e5881),{'gateway_payment_id':_0x149bc7[_0x3bb13d(0x12b)]?.[_0x3bb13d(0x1c2)](),'payment_url':_0x546385,'requires_3ds':![],'status':_0x3bb13d(0x14a),'final':!![],'errorMessage':_0x4e5881};}catch(_0x140dfa){console[_0x3bb13d(0x23a)](_0x3bb13d(0x175)),console['error'](_0x3bb13d(0x178),_0x140dfa),loggerService_1['loggerService']['logWhiteDomainError']('visa/mastercard','/charge',_0x140dfa);throw new Error(_0x3bb13d(0x162)+(_0x140dfa instanceof Error?_0x140dfa['message']:_0x3bb13d(0x1a5)));}}async['checkPaymentStatus'](_0x462a97,_0x47fe71,_0x599f2c=a68_0x1cb155(0x231)){const _0xd43fed=a68_0x1cb155;console['log'](_0xd43fed(0xe2)+_0x599f2c+_0xd43fed(0x1bc)+_0x462a97+'\x20('+_0x47fe71+')');try{const _0x328764={'payment_id':_0x462a97,'order_id':_0x47fe71},_0x2aa908=JSON[_0xd43fed(0x195)](_0x328764),_0x11cfee=this[_0xd43fed(0x1cc)](_0x599f2c===_0xd43fed(0x231)?_0xd43fed(0x158):_0xd43fed(0x169)),{key:_0x40114d,iv:_0xa4486b}=this[_0xd43fed(0x1cb)](),_0x2bd729=this[_0xd43fed(0x220)](_0x2aa908,_0x40114d,_0xa4486b),_0x22ce58=this['encryptRSA'](_0x40114d,_0xa4486b,_0x11cfee[_0xd43fed(0x138)]),_0x4dd8bd=this[_0xd43fed(0x1fb)](_0x2aa908,_0x11cfee[_0xd43fed(0x204)]),_0x13d453={'merchant_point_id':_0x11cfee[_0xd43fed(0x150)],'method':_0xd43fed(0x181),'info':_0x2bd729,'key':_0x22ce58,'sign':_0x4dd8bd,'lang':'en'};loggerService_1[_0xd43fed(0x1d8)][_0xd43fed(0x104)](_0x599f2c[_0xd43fed(0x18e)](),'/status',_0xd43fed(0x216),{'merchant_point_id':_0x11cfee['merchantPointId'],'method':_0xd43fed(0x181),'lang':'en'});const _0x2ffd12=Date['now'](),_0x453098=await fetch(_0x11cfee[_0xd43fed(0x1c3)],{'method':'POST','headers':{'Content-Type':_0xd43fed(0xdf),'Accept':_0xd43fed(0xdf),'User-Agent':_0xd43fed(0x221)},'body':JSON['stringify'](_0x13d453)}),_0x10ec13=Date[_0xd43fed(0xff)]()-_0x2ffd12;if(!_0x453098['ok']){const _0x1d23e5=await _0x453098['text']();loggerService_1[_0xd43fed(0x1d8)]['logWhiteDomainResponse'](_0x599f2c['toLowerCase'](),'/status_raw',_0x453098['status'],_0x1d23e5,_0x10ec13);throw new Error(_0xd43fed(0x17b)+_0x453098[_0xd43fed(0x181)]);}const _0x5b2f74=await _0x453098[_0xd43fed(0x230)]();loggerService_1[_0xd43fed(0x1d8)][_0xd43fed(0xe1)](_0x599f2c['toLowerCase'](),_0xd43fed(0x148),_0x453098[_0xd43fed(0x181)],_0x5b2f74,_0x10ec13);let _0x789feb=_0x5b2f74;if(_0x5b2f74['info']&&_0x5b2f74[_0xd43fed(0x18d)]&&_0x5b2f74['sign']){console[_0xd43fed(0x235)](_0xd43fed(0x161));try{const _0x24066c=await this[_0xd43fed(0x207)](_0x5b2f74['info'],_0x5b2f74[_0xd43fed(0x18d)],_0x599f2c);_0x789feb=JSON['parse'](_0x24066c),console[_0xd43fed(0x235)]('‚úÖ\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0xd43fed(0x1d8)][_0xd43fed(0xe1)](_0x599f2c[_0xd43fed(0x18e)](),'/status_decrypted',_0x453098['status'],_0x789feb,_0x10ec13),console['log'](_0xd43fed(0x16e));}catch(_0xffdae5){console[_0xd43fed(0x23a)](_0xd43fed(0x245),_0xffdae5),loggerService_1[_0xd43fed(0x1d8)][_0xd43fed(0x1ad)](_0x599f2c[_0xd43fed(0x18e)](),_0xd43fed(0x223),'Status\x20decryption\x20failed:\x20'+_0xffdae5),_0x789feb=_0x5b2f74;}}else loggerService_1['loggerService']['logWhiteDomainResponse'](_0x599f2c[_0xd43fed(0x18e)](),'/status_decrypted',_0x453098[_0xd43fed(0x181)],_0x789feb,_0x10ec13),console[_0xd43fed(0x235)](_0xd43fed(0x18a));console[_0xd43fed(0x235)](_0xd43fed(0x10a),{'status':_0x789feb[_0xd43fed(0x181)],'final':_0x789feb[_0xd43fed(0x114)],'payment_id':_0x789feb[_0xd43fed(0x12b)],'desc':_0x789feb['desc']});let _0x1b7db6=_0xd43fed(0x1d5);if(_0x789feb[_0xd43fed(0x181)]===0x64&&_0x789feb['final']===0x1)_0x1b7db6=_0xd43fed(0xe8);else{if(_0x789feb[_0xd43fed(0x114)]===0x0||!this['isFinalStatus'](_0x789feb['status']))_0x1b7db6='PENDING';else _0x789feb['final']===0x1||this[_0xd43fed(0x236)](_0x789feb[_0xd43fed(0x181)])?_0x1b7db6='FAILED':_0x1b7db6=_0xd43fed(0x1d5);}const _0xe4bf11=this[_0xd43fed(0x10f)](_0x789feb[_0xd43fed(0x181)],_0x789feb[_0xd43fed(0x1ec)]);return{'status':_0x1b7db6,'final':this[_0xd43fed(0x236)](_0x789feb[_0xd43fed(0x181)]),'amount':_0x789feb['amount'],'currency':_0x789feb[_0xd43fed(0x203)],'date_success':_0x789feb['date_success'],'description':_0xe4bf11};}catch(_0x39d0e6){console[_0xd43fed(0x23a)](_0x599f2c+_0xd43fed(0x187),_0x39d0e6),loggerService_1[_0xd43fed(0x1d8)][_0xd43fed(0x1ad)](_0x599f2c[_0xd43fed(0x18e)](),_0xd43fed(0x10c),_0x39d0e6);throw new Error(_0xd43fed(0xe7)+_0x599f2c+_0xd43fed(0x1bc)+(_0x39d0e6 instanceof Error?_0x39d0e6[_0xd43fed(0x168)]:_0xd43fed(0x1a5)));}}[a68_0x1cb155(0x1e5)](_0xac0c0f,_0x4b44fc,_0x727b3b,_0x15c8f4){const _0x3edfd5=a68_0x1cb155;console[_0x3edfd5(0x235)](_0x3edfd5(0x1ca)+_0x15c8f4+_0x3edfd5(0x10b)+_0xac0c0f+'\x20('+_0x727b3b+')'),this[_0x3edfd5(0x1e2)](_0xac0c0f);const _0x354b00=[],_0x3981b2=0x5*0x3c*0x3e8,_0x1ef57f=0x2*0x3c*0x3c*0x3e8,_0x485991=Math[_0x3edfd5(0x1a3)](_0x1ef57f/_0x3981b2);console[_0x3edfd5(0x235)](_0x3edfd5(0x147)+_0x485991+_0x3edfd5(0x176));for(let _0x4b3e43=0x1;_0x4b3e43<=_0x485991;_0x4b3e43++){const _0x28b5b1=setTimeout(async()=>{const _0x434116=_0x3edfd5;console[_0x434116(0x235)](_0x434116(0x17e)+_0x15c8f4+_0x434116(0x23b)+_0x4b3e43+'/'+_0x485991+_0x434116(0x20b)+_0xac0c0f);try{const _0xdf068f=await this[_0x434116(0x106)](_0x727b3b,_0x4b44fc,_0x15c8f4);console[_0x434116(0x235)](_0x434116(0x196)+_0x4b3e43+_0x434116(0x1d9),_0xdf068f),_0xdf068f[_0x434116(0x114)]&&(console[_0x434116(0x235)](_0x434116(0x149)+_0xac0c0f+_0x434116(0x1c6)+_0xdf068f[_0x434116(0x181)]+_0x434116(0x228)),this[_0x434116(0x1e2)](_0xac0c0f),await this[_0x434116(0x1c9)](_0xac0c0f,_0xdf068f[_0x434116(0x181)],_0xdf068f));}catch(_0x33b85b){console[_0x434116(0x23a)](_0x434116(0x1f7)+_0x4b3e43+_0x434116(0xf3)+_0xac0c0f+':',_0x33b85b);}},_0x4b3e43*_0x3981b2);_0x354b00[_0x3edfd5(0x18b)](_0x28b5b1);}this[_0x3edfd5(0x128)][_0x3edfd5(0x1e4)](_0xac0c0f,_0x354b00),console[_0x3edfd5(0x235)]('‚úÖ\x20Scheduled\x20'+_0x485991+'\x20status\x20checks\x20for\x20payment\x20'+_0xac0c0f);}[a68_0x1cb155(0x1e2)](_0x65ebb4){const _0x13be54=a68_0x1cb155,_0x293df4=this['statusCheckTimers'][_0x13be54(0xf8)](_0x65ebb4);_0x293df4&&(console[_0x13be54(0x235)](_0x13be54(0x18c)+_0x293df4[_0x13be54(0x111)]+'\x20status\x20timers\x20for\x20payment\x20'+_0x65ebb4),_0x293df4[_0x13be54(0x1d7)]((_0x2a7f36,_0x4bc556)=>{clearTimeout(_0x2a7f36);}),this[_0x13be54(0x128)][_0x13be54(0x174)](_0x65ebb4));}async[a68_0x1cb155(0x1c9)](_0x15e3e2,_0x955628,_0x44bb07){const _0x2ef97d=a68_0x1cb155;try{const _0x617fc6=(await Promise[_0x2ef97d(0xee)]()['then'](()=>__importStar(require(_0x2ef97d(0xfe)))))[_0x2ef97d(0x171)],_0x1e3a0c={'status':_0x955628['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x955628==='PAID'&&(_0x1e3a0c[_0x2ef97d(0x1af)]=new Date()),_0x955628===_0x2ef97d(0x14a)&&_0x44bb07[_0x2ef97d(0x1bb)]&&(_0x1e3a0c[_0x2ef97d(0x200)]=_0x44bb07[_0x2ef97d(0x1bb)],console[_0x2ef97d(0x235)](_0x2ef97d(0x119)+_0x44bb07[_0x2ef97d(0x1bb)])),await _0x617fc6[_0x2ef97d(0x143)][_0x2ef97d(0x188)]({'where':{'id':_0x15e3e2},'data':_0x1e3a0c}),console[_0x2ef97d(0x235)](_0x2ef97d(0x149)+_0x15e3e2+_0x2ef97d(0x135)+_0x955628),await this[_0x2ef97d(0x131)](_0x15e3e2,_0x955628);}catch(_0x31b8f2){console[_0x2ef97d(0x23a)]('‚ùå\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x15e3e2+':',_0x31b8f2);}}async[a68_0x1cb155(0x131)](_0x28dc1f,_0x113344){const _0x39e6fc=a68_0x1cb155;try{const _0x2418bd=(await Promise[_0x39e6fc(0xee)]()[_0x39e6fc(0x206)](()=>__importStar(require(_0x39e6fc(0xfe)))))[_0x39e6fc(0x171)],{telegramBotService:_0x3227d9}=await Promise['resolve']()[_0x39e6fc(0x206)](()=>__importStar(require(_0x39e6fc(0x12e)))),_0x1a76c1=await _0x2418bd['payment'][_0x39e6fc(0x243)]({'where':{'id':_0x28dc1f},'include':{'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':!![]}}}});if(!_0x1a76c1)return;const _0x425078={'PAID':'paid','FAILED':'failed'},_0x28e820=_0x425078[_0x113344];_0x28e820&&await _0x3227d9['sendPaymentNotification'](_0x1a76c1['shopId'],_0x1a76c1,_0x28e820),await this[_0x39e6fc(0x182)](_0x1a76c1,_0x113344);}catch(_0x556abc){console['error'](_0x39e6fc(0x10e),_0x556abc);}}async[a68_0x1cb155(0x182)](_0x55e1f5,_0x1bc044){const _0x2c8cc1=a68_0x1cb155,_0x1f17bb=Date[_0x2c8cc1(0xff)]();try{const _0xdd75bc=_0x55e1f5[_0x2c8cc1(0x166)],_0x137279=_0xdd75bc[_0x2c8cc1(0x127)];if(!_0x137279?.[_0x2c8cc1(0x191)]){console[_0x2c8cc1(0x235)](_0x2c8cc1(0x21b)+_0xdd75bc['id']);return;}const _0x4d21c4=_0x1bc044==='PAID'?_0x2c8cc1(0x1b7):'payment.failed';let _0x24434a=[];if(_0x137279[_0x2c8cc1(0x241)])try{_0x24434a=Array[_0x2c8cc1(0x1f3)](_0x137279[_0x2c8cc1(0x241)])?_0x137279['webhookEvents']:JSON['parse'](_0x137279[_0x2c8cc1(0x241)]);}catch(_0x574dd6){console[_0x2c8cc1(0x23a)](_0x2c8cc1(0x198),_0x574dd6),_0x24434a=[];}if(!_0x24434a[_0x2c8cc1(0x1ee)](_0x4d21c4)){console['log']('Webhook\x20event\x20'+_0x4d21c4+_0x2c8cc1(0x1b6)+_0xdd75bc['id']);return;}const _0x333e33={'event':_0x4d21c4,'payment':{'id':_0x55e1f5['id'],'order_id':_0x55e1f5[_0x2c8cc1(0x22e)],'gateway_order_id':_0x55e1f5['gatewayOrderId'],'gateway':'1111','amount':_0x55e1f5['amount'],'currency':_0x55e1f5[_0x2c8cc1(0x203)],'status':_0x1bc044[_0x2c8cc1(0x18e)](),'customer_email':_0x55e1f5['customerEmail'],'customer_name':_0x55e1f5[_0x2c8cc1(0x13b)],'created_at':_0x55e1f5[_0x2c8cc1(0x1d2)],'updated_at':new Date()}},_0x15f202=JSON[_0x2c8cc1(0x195)](_0x333e33),_0x578926=crypto_1['default'][_0x2c8cc1(0x214)](_0x2c8cc1(0x225),_0xdd75bc['secretKey'])[_0x2c8cc1(0x188)](_0x15f202)[_0x2c8cc1(0x1e9)]('hex'),_0x28a387=await fetch(_0x137279[_0x2c8cc1(0x191)],{'method':_0x2c8cc1(0x216),'headers':{'Content-Type':_0x2c8cc1(0xdf),'User-Agent':_0x2c8cc1(0x1a7),'X-Webhook-Signature':_0x578926},'body':_0x15f202}),_0x4aa315=Date[_0x2c8cc1(0xff)]()-_0x1f17bb;loggerService_1[_0x2c8cc1(0x1d8)]['logShopWebhookSent'](_0x55e1f5[_0x2c8cc1(0x22b)],_0x137279[_0x2c8cc1(0x191)],_0x4d21c4,_0x28a387[_0x2c8cc1(0x181)],_0x4aa315,_0x333e33),console[_0x2c8cc1(0x235)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x137279['webhookUrl']+_0x2c8cc1(0x21f)+_0x28a387['status']+'\x20('+_0x4aa315+_0x2c8cc1(0x1f8));}catch(_0x1b46fb){console[_0x2c8cc1(0x23a)](_0x2c8cc1(0x23d),_0x1b46fb),loggerService_1[_0x2c8cc1(0x1d8)][_0x2c8cc1(0x113)](_0x55e1f5[_0x2c8cc1(0x22b)],_0x55e1f5['shop']?.['settings']?.['webhookUrl']||_0x2c8cc1(0x11e),_0x2c8cc1(0x209),_0x1b46fb,{});}}[a68_0x1cb155(0x20a)](_0x1320b1){const _0x4f36f9=a68_0x1cb155,_0x81776a=_0x1320b1[_0x4f36f9(0x146)](/[\s-]/g,'');if(_0x81776a[_0x4f36f9(0x111)]<0x4)return _0x4f36f9(0x1e6);return _0x4f36f9(0x1ea)+_0x81776a[_0x4f36f9(0x151)](-0x4);}async[a68_0x1cb155(0x229)](_0x37e88f,_0x49e36d=a68_0x1cb155(0xfb)){const _0x5840d8=a68_0x1cb155;console[_0x5840d8(0x235)](_0x5840d8(0x20d),JSON['stringify'](_0x37e88f,null,0x2));let _0x677316=_0x37e88f,_0x1d1d43=_0x49e36d;_0x37e88f[_0x5840d8(0x15d)]?(_0x1d1d43=_0x37e88f[_0x5840d8(0x15d)][_0x5840d8(0x16c)]()===_0x5840d8(0x231)?'VISA':_0x5840d8(0xfb),console['log'](_0x5840d8(0x14f)+_0x1d1d43)):console[_0x5840d8(0x235)](_0x5840d8(0x1b9)+_0x1d1d43);if(_0x37e88f['info']&&_0x37e88f[_0x5840d8(0x18d)]&&_0x37e88f['sign']){console[_0x5840d8(0x235)]('üîê\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...');try{const _0x235fcd=await this[_0x5840d8(0x207)](_0x37e88f[_0x5840d8(0x1de)],_0x37e88f['key'],_0x1d1d43);_0x677316=JSON[_0x5840d8(0x14e)](_0x235fcd),console[_0x5840d8(0x235)](_0x5840d8(0x130)),console['log'](_0x5840d8(0xf5),JSON[_0x5840d8(0x195)](_0x677316,null,0x2));}catch(_0x501d36){console[_0x5840d8(0x23a)](_0x5840d8(0x1d3),_0x501d36),console['log'](_0x5840d8(0xfc)),_0x677316=_0x37e88f;}}else console[_0x5840d8(0x235)](_0x5840d8(0x21e));let _0x37599c='PENDING';if(_0x677316['status']===0x64&&_0x677316[_0x5840d8(0x114)]===0x1)_0x37599c=_0x5840d8(0xe8);else{if(_0x677316[_0x5840d8(0x114)]===0x0||!this[_0x5840d8(0x236)](_0x677316[_0x5840d8(0x181)]))_0x37599c=_0x5840d8(0x1d5);else _0x677316['final']===0x1||this[_0x5840d8(0x236)](_0x677316[_0x5840d8(0x181)])?_0x37599c=_0x5840d8(0x14a):_0x37599c=_0x5840d8(0x1d5);}let _0x4f4859='';if(_0x677316[_0x5840d8(0xe3)])_0x4f4859=_0x677316['order_id'][_0x5840d8(0x1c2)](),console[_0x5840d8(0x235)](_0x5840d8(0x118)+_0x1d1d43+_0x5840d8(0x164)+_0x4f4859);else _0x677316[_0x5840d8(0x12b)]?(_0x4f4859=_0x677316[_0x5840d8(0x12b)]['toString'](),console[_0x5840d8(0x235)]('üîç\x20Using\x20'+_0x1d1d43+_0x5840d8(0x1b2)+_0x4f4859)):(_0x4f4859=_0x677316['orderId']||_0x677316['paymentId']||_0x677316['id']||'',console[_0x5840d8(0x235)]('üîç\x20Using\x20fallback\x20fields\x20for\x20search:\x20'+_0x4f4859));console[_0x5840d8(0x235)](_0x5840d8(0x129)+_0x1d1d43+_0x5840d8(0x1a6)),console['log'](_0x5840d8(0x215)+_0x4f4859+_0x5840d8(0x12c)+_0x677316[_0x5840d8(0xe3)]+_0x5840d8(0x244)+_0x677316[_0x5840d8(0x22e)]+_0x5840d8(0x1ae)+_0x677316[_0x5840d8(0x12b)]+_0x5840d8(0x13d)+_0x677316[_0x5840d8(0xf2)]+',\x20id='+_0x677316['id']+')'),console[_0x5840d8(0x235)](_0x5840d8(0x238)+_0x37599c+'\x20(from:\x20status='+_0x677316['status']+',\x20final='+_0x677316[_0x5840d8(0x114)]+')'),console[_0x5840d8(0x235)]('\x20\x20\x20Amount:\x20'+_0x677316[_0x5840d8(0x100)]),console[_0x5840d8(0x235)](_0x5840d8(0x115)+_0x677316['currency']);let _0x4331a0;_0x37599c===_0x5840d8(0x14a)&&(_0x4331a0=this[_0x5840d8(0x10f)](_0x677316[_0x5840d8(0x181)],_0x677316[_0x5840d8(0x1ec)]),console['log'](_0x5840d8(0x189)+_0x4331a0));const _0x3a807a={'paymentId':_0x4f4859,'status':_0x37599c,'amount':_0x677316[_0x5840d8(0x100)],'currency':_0x677316[_0x5840d8(0x203)],'cardBrand':_0x1d1d43};return _0x4331a0&&(_0x3a807a['errorMessage']=_0x4331a0),_0x3a807a;}['stopAllStatusChecks'](){const _0x256782=a68_0x1cb155;console[_0x256782(0x235)](_0x256782(0x1dd));const _0x25b442=this[_0x256782(0x128)][_0x256782(0x15e)];for(const [_0x2ee1f3]of this['statusCheckTimers']){this[_0x256782(0x1e2)](_0x2ee1f3);}console[_0x256782(0x235)]('üõë\x20Stopped\x20'+_0x25b442+_0x256782(0xf7));}}function a68_0x2483(_0x46e42c,_0x3f5b79){_0x46e42c=_0x46e42c-0xdd;const _0x14e0bb=a68_0x14e0();let _0x248369=_0x14e0bb[_0x46e42c];return _0x248369;}exports[a68_0x1cb155(0x22f)]=VisaMasterCardService;