'use strict';const a42_0x4fdb68=a42_0x2aea;function a42_0x2aea(_0x2cce63,_0x50c670){const _0x616439=a42_0x6164();return a42_0x2aea=function(_0x2aea7f,_0x316f25){_0x2aea7f=_0x2aea7f-0xee;let _0x2c4b99=_0x616439[_0x2aea7f];return _0x2c4b99;},a42_0x2aea(_0x2cce63,_0x50c670);}function a42_0x6164(){const _0x5c5a02=['base64','utf8','update','4151CzbPSy','publicKeyPath','logWhiteDomainError','SHA256','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','FAILED','\x20\x20\x20-\x20merchant_point_id:','slice','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','join','path','Unknown\x20error','1111','constants','substring','charge','PENDING','__importDefault','🔐\x20Public\x20key\x20path:','📝\x20Data\x20length:','Failed\x20to\x20decrypt\x20response','🔐\x20AES\x20key\x20length:','statusCheckTimers','📊\x20Status\x20check\x20#','paid','3ds_url','currency','****','shopId','\x20not\x20enabled\x20for\x20shop\x20','✅\x20Status\x20response\x20decrypted\x20successfully','__esModule','trim','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','📝\x20Data\x20to\x20sign\x20length:','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','toUpperCase','Amount:','customerEmail','replace','184517jZDACt','Return\x20URL:','Error\x20details:','\x20\x20\x20-\x20method:\x20charge','payment_id','\x20status\x20checks\x20for\x20payment\x20','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','application/json','psp_public.pem','clearStatusTimers','\x20\x20\x20-\x20lang:\x20en','readFileSync','parse','__createBinding','),\x20stopping\x20status\x20checks','keys','push','\x20for\x20payment\x20','text','encryptRSA','🔐\x20Public\x20key\x20length:\x20','end','call','🔍\x20MasterCard\x20status\x20check\x20#','⏰\x20Will\x20check\x20status\x20','webhookUrl','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','Status\x20decryption\x20failed:\x20','order_id','webhook_send','MasterCardService','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','decryptAES','❌\x20RSA\x20signing\x20failed:','maskCardNumber','size','encryptAES','last_name','Card\x20Holder:','sendPaymentNotifications','isArray','getOwnPropertyDescriptor','✅\x20Scheduled\x20','loggerService','now','ms)','gatewayOrderId','312MKwuEG','get','length','expire_month','publicEncrypt','Failed\x20to\x20send\x20MasterCard\x20webhook:','apiUrl','Status:','createSign','https://api2.trapay.uk/decrypt.php','-----END','paidAt','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','6311160Odcgzi',',\x20Final:\x20','Failed\x20to\x20send\x20payment\x20notifications:','📝\x20Encrypted\x20key\x20length:','includes','__importStar','RSA_PKCS1_PADDING','existsSync','PAID','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','system','status','generateAESKey','\x20is\x20final\x20(','/status_decrypted','number','createCipheriv','logWhiteDomainResponse','TesSoft\x20Payment\x20System/1.0','updatePaymentStatus','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','key','first_name','14XTuhxh','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','\x20status\x20updated\x20to\x20','Result\x20URL:','../../config/database','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','cvv','❌\x20Status\x20check\x20#','prototype','amount','decryptResponsePhp','logShopWebhookError','message','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format',',\x20body:\x20','error','resolve','650VvWuCp','from','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','payment.success','scheduleStatusChecks','signRSA','HTTP\x20error!\x20status:\x20','920703TXEsoe','hasOwnProperty','crypto','date_success','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','info','desc','/charge','MasterCard\x20webhook\x20sent\x20to\x20','merchantPointId','Processing\x20MasterCard\x20webhook:','Card\x20Number:','description','🛑\x20Stopped\x20','📝\x20Final\x20request\x20structure:','🔐\x20Data\x20encrypted\x20with\x20AES','create','/charge_decrypted','\x20result:','🔐\x20AES\x20key\x20and\x20IV\x20generated','\x20failed\x20for\x20payment\x20','decryptResponse','PHP\x20decryptor\x20error','private.pem','json','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','default','\x20\x20\x20-\x20sign\x20length:','floor','Decryption\x20failed:\x20','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','📊\x20Status\x20check\x20result:','payment','sign','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','randomBytes','set','💾\x20Payment\x20data\x20prepared','privateDecrypt','-----BEGIN','🔐\x203DS\x20verification\x20required','privateKeyPath','getOwnPropertyNames','POST','...','mastercard','Response\x20Body:','\x20with\x20status\x20','****\x20****\x20****\x20','MasterCard:\x20','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','stringify','checkPaymentStatus','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','defineProperty','sendShopWebhook','toString','adminNotes','toLowerCase','❌\x20RSA\x20encryption\x20failed:','8694mdbCTe','webhookEvents','/charge_raw','settings','/status_raw','configurable','findUnique','Public\x20key\x20file\x20not\x20found:\x20','then','✅\x20Payment\x20','none','aes-256-ctr','\x20status\x20timers\x20for\x20payment\x20','sendPaymentNotification','❌\x20MasterCard\x20key\x20validation\x20failed:','/charge_decrypt','\x20characters','8QDggfu','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','12584YxffLY','createdAt','writable','final','Payment\x20ID:','Order\x20ID:','103824rfYyHk','🧹\x20Clearing\x20','📝\x20Signature\x20length:','stopAllStatusChecks','10015fDDZdg','cwd','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','log'];a42_0x6164=function(){return _0x5c5a02;};return a42_0x6164();}(function(_0x47113b,_0x373f58){const _0x499c5c=a42_0x2aea,_0x4e9de2=_0x47113b();while(!![]){try{const _0x555461=parseInt(_0x499c5c(0x19d))/0x1*(-parseInt(_0x499c5c(0xfb))/0x2)+parseInt(_0x499c5c(0x113))/0x3+-parseInt(_0x499c5c(0x161))/0x4*(-parseInt(_0x499c5c(0x16d))/0x5)+-parseInt(_0x499c5c(0x150))/0x6*(-parseInt(_0x499c5c(0x175))/0x7)+parseInt(_0x499c5c(0x1cd))/0x8*(parseInt(_0x499c5c(0x169))/0x9)+-parseInt(_0x499c5c(0x10c))/0xa*(parseInt(_0x499c5c(0x163))/0xb)+parseInt(_0x499c5c(0x1da))/0xc;if(_0x555461===_0x373f58)break;else _0x4e9de2['push'](_0x4e9de2['shift']());}catch(_0x1c4a54){_0x4e9de2['push'](_0x4e9de2['shift']());}}}(a42_0x6164,0xbe6f3));var __createBinding=this&&this[a42_0x4fdb68(0x1aa)]||(Object['create']?function(_0x105e28,_0x464451,_0x1d4f11,_0x148168){const _0x53e95d=a42_0x4fdb68;if(_0x148168===undefined)_0x148168=_0x1d4f11;var _0x5b6ee3=Object[_0x53e95d(0x1c7)](_0x464451,_0x1d4f11);(!_0x5b6ee3||(_0x53e95d(0x1ce)in _0x5b6ee3?!_0x464451[_0x53e95d(0x194)]:_0x5b6ee3[_0x53e95d(0x165)]||_0x5b6ee3[_0x53e95d(0x155)]))&&(_0x5b6ee3={'enumerable':!![],'get':function(){return _0x464451[_0x1d4f11];}}),Object['defineProperty'](_0x105e28,_0x148168,_0x5b6ee3);}:function(_0x210f21,_0x3f23fa,_0x340ae1,_0x5af2b5){if(_0x5af2b5===undefined)_0x5af2b5=_0x340ae1;_0x210f21[_0x5af2b5]=_0x3f23fa[_0x340ae1];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a42_0x4fdb68(0x124)]?function(_0x290ddb,_0x3404e8){const _0x3563cf=a42_0x4fdb68;Object[_0x3563cf(0x14a)](_0x290ddb,_0x3563cf(0x12e),{'enumerable':!![],'value':_0x3404e8});}:function(_0x501bc1,_0x582229){const _0x46f31f=a42_0x4fdb68;_0x501bc1[_0x46f31f(0x12e)]=_0x582229;}),__importStar=this&&this[a42_0x4fdb68(0x1df)]||(function(){var _0x541fc7=function(_0x265e8c){const _0x28b8b8=a42_0x2aea;return _0x541fc7=Object[_0x28b8b8(0x13e)]||function(_0x145a2c){const _0x469fc4=_0x28b8b8;var _0x2620cf=[];for(var _0x34ff6c in _0x145a2c)if(Object[_0x469fc4(0x103)][_0x469fc4(0x114)][_0x469fc4(0x1b3)](_0x145a2c,_0x34ff6c))_0x2620cf[_0x2620cf['length']]=_0x34ff6c;return _0x2620cf;},_0x541fc7(_0x265e8c);};return function(_0x3147f9){const _0x388fe2=a42_0x2aea;if(_0x3147f9&&_0x3147f9[_0x388fe2(0x194)])return _0x3147f9;var _0x4459aa={};if(_0x3147f9!=null){for(var _0x3f3a7c=_0x541fc7(_0x3147f9),_0x11d8db=0x0;_0x11d8db<_0x3f3a7c[_0x388fe2(0x1cf)];_0x11d8db++)if(_0x3f3a7c[_0x11d8db]!==_0x388fe2(0x12e))__createBinding(_0x4459aa,_0x3147f9,_0x3f3a7c[_0x11d8db]);}return __setModuleDefault(_0x4459aa,_0x3147f9),_0x4459aa;};}()),__importDefault=this&&this[a42_0x4fdb68(0x186)]||function(_0x59a596){const _0x39dfbd=a42_0x4fdb68;return _0x59a596&&_0x59a596[_0x39dfbd(0x194)]?_0x59a596:{'default':_0x59a596};};Object[a42_0x4fdb68(0x14a)](exports,a42_0x4fdb68(0x194),{'value':!![]}),exports[a42_0x4fdb68(0x1bc)]=void 0x0;const crypto_1=__importDefault(require(a42_0x4fdb68(0x115))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x4fdb68(0x17f))),loggerService_1=require('../loggerService');class MasterCardService{constructor(){const _0x3e3e7d=a42_0x4fdb68;this['statusCheckTimers']=new Map(),this[_0x3e3e7d(0x1d3)]='https://api.paydmeth.com/api',this[_0x3e3e7d(0x11d)]=0x67c,this[_0x3e3e7d(0x13d)]=path_1[_0x3e3e7d(0x12e)][_0x3e3e7d(0x17e)](process[_0x3e3e7d(0x16e)](),_0x3e3e7d(0x1ac),_0x3e3e7d(0x12b)),this[_0x3e3e7d(0x176)]=path_1[_0x3e3e7d(0x12e)]['join'](process[_0x3e3e7d(0x16e)](),_0x3e3e7d(0x1ac),_0x3e3e7d(0x1a5)),console[_0x3e3e7d(0x171)]('💳\x20MasterCard\x20service\x20initialized'),console[_0x3e3e7d(0x171)]('🔐\x20Private\x20key\x20path:',this[_0x3e3e7d(0x13d)]),console[_0x3e3e7d(0x171)](_0x3e3e7d(0x187),this[_0x3e3e7d(0x176)]),this['validateKeyFiles']();}['validateKeyFiles'](){const _0x4c9481=a42_0x4fdb68;try{if(!fs_1['default'][_0x4c9481(0x1e1)](this['privateKeyPath']))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this[_0x4c9481(0x13d)]);if(!fs_1['default'][_0x4c9481(0x1e1)](this[_0x4c9481(0x176)]))throw new Error(_0x4c9481(0x157)+this['publicKeyPath']);const _0x564ef3=fs_1[_0x4c9481(0x12e)][_0x4c9481(0x1a8)](this[_0x4c9481(0x13d)],_0x4c9481(0x173))[_0x4c9481(0x195)](),_0xb1f818=fs_1[_0x4c9481(0x12e)][_0x4c9481(0x1a8)](this['publicKeyPath'],_0x4c9481(0x173))[_0x4c9481(0x195)]();if(!_0x564ef3[_0x4c9481(0x1de)](_0x4c9481(0x13b))||!_0x564ef3['includes'](_0x4c9481(0x1d7)))throw new Error(_0x4c9481(0x1d9));if(!_0xb1f818['includes'](_0x4c9481(0x13b))||!_0xb1f818['includes'](_0x4c9481(0x1d7)))throw new Error(_0x4c9481(0x108));console['log']('✅\x20MasterCard\x20key\x20files\x20validated\x20successfully'),console['log']('🔐\x20Private\x20key\x20length:\x20'+_0x564ef3[_0x4c9481(0x1cf)]+_0x4c9481(0x160)),console[_0x4c9481(0x171)](_0x4c9481(0x1b1)+_0xb1f818[_0x4c9481(0x1cf)]+_0x4c9481(0x160));}catch(_0x4313d0){console[_0x4c9481(0x10a)](_0x4c9481(0x15e),_0x4313d0);throw _0x4313d0;}}[a42_0x4fdb68(0xf0)](){const _0x4058b4=a42_0x4fdb68,_0x130a39=crypto_1[_0x4058b4(0x12e)]['randomBytes'](0x20),_0x2e82b4=crypto_1['default'][_0x4058b4(0x137)](0x10);return{'key':_0x130a39,'iv':_0x2e82b4};}[a42_0x4fdb68(0x1c2)](_0x5a08c5,_0x2bcdb8,_0x41a36c){const _0x532361=a42_0x4fdb68,_0x4aa152=crypto_1[_0x532361(0x12e)][_0x532361(0xf4)]('aes-256-ctr',_0x2bcdb8,_0x41a36c);let _0x599193=_0x4aa152[_0x532361(0x174)](_0x5a08c5,_0x532361(0x173),_0x532361(0x172));return _0x599193+=_0x4aa152['final'](_0x532361(0x172)),_0x599193;}[a42_0x4fdb68(0x1b0)](_0x4a7ce6,_0x4ce6e0){const _0xbdc4ea=a42_0x4fdb68;try{const _0x4cdff5=fs_1[_0xbdc4ea(0x12e)]['readFileSync'](this[_0xbdc4ea(0x176)],_0xbdc4ea(0x173))['trim'](),_0x53ae7e={'iv':_0x4ce6e0[_0xbdc4ea(0x14c)](_0xbdc4ea(0x172)),'key':_0x4a7ce6[_0xbdc4ea(0x14c)](_0xbdc4ea(0x172))},_0x17738e=JSON['stringify'](_0x53ae7e);console['log'](_0xbdc4ea(0x196),_0x17738e[_0xbdc4ea(0x1cf)]);const _0x583db0=crypto_1[_0xbdc4ea(0x12e)][_0xbdc4ea(0x1d1)]({'key':_0x4cdff5,'padding':crypto_1[_0xbdc4ea(0x12e)][_0xbdc4ea(0x182)][_0xbdc4ea(0x1e0)]},Buffer[_0xbdc4ea(0x10d)](_0x17738e));return console[_0xbdc4ea(0x171)](_0xbdc4ea(0x198),_0x583db0[_0xbdc4ea(0x1cf)]),_0x583db0[_0xbdc4ea(0x14c)](_0xbdc4ea(0x172));}catch(_0x40b9cb){console[_0xbdc4ea(0x10a)](_0xbdc4ea(0x14f),_0x40b9cb);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a42_0x4fdb68(0x111)](_0x49ce08){const _0x215095=a42_0x4fdb68;try{const _0x48d620=fs_1[_0x215095(0x12e)][_0x215095(0x1a8)](this[_0x215095(0x13d)],_0x215095(0x173))[_0x215095(0x195)](),_0x5f3e83=crypto_1[_0x215095(0x12e)][_0x215095(0x1d5)](_0x215095(0x178));_0x5f3e83[_0x215095(0x174)](_0x49ce08),_0x5f3e83[_0x215095(0x1b2)]();const _0x12a45a=_0x5f3e83['sign'](_0x48d620,_0x215095(0x172));return console[_0x215095(0x171)]('🔐\x20RSA\x20signing\x20successful'),console[_0x215095(0x171)](_0x215095(0x197),_0x49ce08[_0x215095(0x1cf)]),console[_0x215095(0x171)](_0x215095(0x16b),_0x12a45a[_0x215095(0x1cf)]),_0x12a45a;}catch(_0x24222f){console[_0x215095(0x10a)](_0x215095(0x1bf),_0x24222f),console['error']('❌\x20Data\x20being\x20signed:',_0x49ce08[_0x215095(0x183)](0x0,0xc8)+_0x215095(0x140));throw new Error(_0x215095(0x10e));}}[a42_0x4fdb68(0x1be)](_0x24814c,_0x1d947d,_0x254379){const _0x42f4a3=a42_0x4fdb68,_0x2d8b92=crypto_1[_0x42f4a3(0x12e)]['createDecipheriv'](_0x42f4a3(0x15b),_0x1d947d,_0x254379);let _0x2dfc91=_0x2d8b92[_0x42f4a3(0x174)](_0x24814c,_0x42f4a3(0x172),_0x42f4a3(0x173));return _0x2dfc91+=_0x2d8b92[_0x42f4a3(0x166)]('utf8'),_0x2dfc91;}async[a42_0x4fdb68(0x105)](_0x535a30,_0x10dfb4){const _0x3c3a37=a42_0x4fdb68;try{const _0x2274c9=await fetch(_0x3c3a37(0x1d6),{'method':_0x3c3a37(0x13f),'headers':{'Content-Type':'application/json'},'body':JSON[_0x3c3a37(0x147)]({'info':_0x535a30,'key':_0x10dfb4})});if(!_0x2274c9['ok'])throw new Error(_0x3c3a37(0x12a));return await _0x2274c9[_0x3c3a37(0x1af)]();}catch(_0x26f487){console['error']('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x26f487);throw new Error(_0x3c3a37(0x117));}}[a42_0x4fdb68(0x129)](_0x4ee976,_0x190a8b){const _0x2073a2=a42_0x4fdb68;try{const _0x12509e=fs_1[_0x2073a2(0x12e)][_0x2073a2(0x1a8)](this['privateKeyPath'],'utf8')[_0x2073a2(0x195)](),_0x5689cf=crypto_1[_0x2073a2(0x12e)][_0x2073a2(0x13a)](_0x12509e,Buffer[_0x2073a2(0x10d)](_0x190a8b,_0x2073a2(0x172))),_0x4c4541=JSON[_0x2073a2(0x1a9)](_0x5689cf[_0x2073a2(0x14c)]()),_0x22c58f=Buffer['from'](_0x4c4541[_0x2073a2(0xf9)],_0x2073a2(0x172)),_0x5b547a=Buffer[_0x2073a2(0x10d)](_0x4c4541['iv'],_0x2073a2(0x172));return this[_0x2073a2(0x1be)](_0x4ee976,_0x22c58f,_0x5b547a);}catch(_0x15c305){throw new Error(_0x2073a2(0x189));}}async['processCardPayment'](_0x38ea63){const _0x48275a=a42_0x4fdb68,{paymentId:_0x992833,orderId:_0x422e1f,amount:_0x18b23f,currency:_0x201159,cardData:_0x164d6b,resultUrl:_0x2a2126,returnUrl:_0x2f6afa,cardHolder:_0x488450,browser:_0x56cb01}=_0x38ea63;console[_0x48275a(0x171)]('===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x48275a(0x171)](_0x48275a(0x167),_0x992833),console[_0x48275a(0x171)](_0x48275a(0x168),_0x422e1f),console['log'](_0x48275a(0x19a),_0x18b23f,_0x201159),console[_0x48275a(0x171)](_0x48275a(0x11f),this[_0x48275a(0x1c0)](_0x164d6b[_0x48275a(0xf3)])),console[_0x48275a(0x171)](_0x48275a(0x1c4),_0x488450[_0x48275a(0xfa)]+'\x20'+_0x488450[_0x48275a(0x1c3)]),console[_0x48275a(0x171)](_0x48275a(0x19e),_0x2f6afa),console[_0x48275a(0x171)](_0x48275a(0xfe),_0x2a2126);const _0x3c88e9={'amount':_0x18b23f,'currency':_0x201159[_0x48275a(0x199)](),'order_id':_0x422e1f,'result_url':_0x2a2126,'return_url':_0x2f6afa,'card':{'number':_0x164d6b[_0x48275a(0xf3)],'expire_month':_0x164d6b[_0x48275a(0x1d0)],'expire_year':_0x164d6b['expire_year'],'cvv':_0x164d6b[_0x48275a(0x101)]},'card_holder':_0x488450,'browser':_0x56cb01},_0x19ccfa=JSON[_0x48275a(0x147)](_0x3c88e9);console['log'](_0x48275a(0x139)),console[_0x48275a(0x171)](_0x48275a(0x16f)),console['log'](_0x19ccfa),console[_0x48275a(0x171)](_0x48275a(0x188),_0x19ccfa[_0x48275a(0x1cf)]);try{const {key:_0x289c18,iv:_0x223930}=this[_0x48275a(0xf0)]();console[_0x48275a(0x171)](_0x48275a(0x127)),console[_0x48275a(0x171)](_0x48275a(0x18a),_0x289c18[_0x48275a(0x1cf)]),console[_0x48275a(0x171)]('🔐\x20AES\x20IV\x20length:',_0x223930[_0x48275a(0x1cf)]);const _0x272b66=this['encryptAES'](_0x19ccfa,_0x289c18,_0x223930);console[_0x48275a(0x171)](_0x48275a(0x123)),console[_0x48275a(0x171)]('📝\x20Encrypted\x20data\x20length:',_0x272b66[_0x48275a(0x1cf)]);const _0x3fea78=this[_0x48275a(0x1b0)](_0x289c18,_0x223930);console[_0x48275a(0x171)](_0x48275a(0x149)),console[_0x48275a(0x171)](_0x48275a(0x1dd),_0x3fea78[_0x48275a(0x1cf)]);const _0xe00562=this[_0x48275a(0x111)](_0x19ccfa);console[_0x48275a(0x171)]('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x48275a(0x171)](_0x48275a(0x16b),_0xe00562['length']);const _0x7a7dd3={'merchant_point_id':this['merchantPointId'],'method':_0x48275a(0x184),'info':_0x272b66,'key':_0x3fea78,'sign':_0xe00562,'lang':'en'};console[_0x48275a(0x171)](_0x48275a(0x1b8)),console[_0x48275a(0x171)](_0x48275a(0x122)),console[_0x48275a(0x171)](_0x48275a(0x17b),this[_0x48275a(0x11d)]),console['log'](_0x48275a(0x1a0)),console[_0x48275a(0x171)]('\x20\x20\x20-\x20info\x20length:',_0x272b66['length']),console[_0x48275a(0x171)]('\x20\x20\x20-\x20key\x20length:',_0x3fea78[_0x48275a(0x1cf)]),console['log'](_0x48275a(0x12f),_0xe00562['length']),console[_0x48275a(0x171)](_0x48275a(0x1a7)),loggerService_1[_0x48275a(0x1c9)]['logWhiteDomainRequest']('mastercard',_0x48275a(0x11b),'POST',{'merchant_point_id':this[_0x48275a(0x11d)],'method':_0x48275a(0x184),'lang':'en'});const _0x3d1c11=Date['now'](),_0x5026e4=await fetch(this[_0x48275a(0x1d3)],{'method':_0x48275a(0x13f),'headers':{'Content-Type':'application/json','Accept':_0x48275a(0x1a4),'User-Agent':_0x48275a(0xf6)},'body':JSON[_0x48275a(0x147)](_0x7a7dd3)}),_0x514830=Date[_0x48275a(0x1ca)]()-_0x3d1c11;console[_0x48275a(0x171)](_0x48275a(0x100)),console[_0x48275a(0x171)]('Status:',_0x5026e4[_0x48275a(0xef)]),console[_0x48275a(0x171)]('Response\x20Time:',_0x514830+'ms');if(!_0x5026e4['ok']){const _0x9b60e4=await _0x5026e4[_0x48275a(0x1af)]();console[_0x48275a(0x10a)]('HTTP\x20Status:',_0x5026e4[_0x48275a(0xef)]),console['error'](_0x48275a(0x142),_0x9b60e4),loggerService_1['loggerService'][_0x48275a(0xf5)](_0x48275a(0x141),_0x48275a(0x152),_0x5026e4['status'],_0x9b60e4,_0x514830),loggerService_1[_0x48275a(0x1c9)][_0x48275a(0x177)]('mastercard',_0x48275a(0x11b),'HTTP\x20'+_0x5026e4[_0x48275a(0xef)]+':\x20'+_0x9b60e4);throw new Error(_0x48275a(0x112)+_0x5026e4[_0x48275a(0xef)]+_0x48275a(0x109)+_0x9b60e4);}const _0x2e7549=await _0x5026e4[_0x48275a(0x12c)]();loggerService_1[_0x48275a(0x1c9)]['logWhiteDomainResponse']('mastercard',_0x48275a(0x152),_0x5026e4[_0x48275a(0xef)],_0x2e7549,_0x514830),console[_0x48275a(0x171)](_0x48275a(0x12d));let _0x3a620c=_0x2e7549;if(_0x2e7549[_0x48275a(0x119)]&&_0x2e7549[_0x48275a(0xf9)]&&_0x2e7549[_0x48275a(0x135)]){console['log']('🔐\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x1d12e6=await this[_0x48275a(0x105)](_0x2e7549[_0x48275a(0x119)],_0x2e7549[_0x48275a(0xf9)]);_0x3a620c=JSON[_0x48275a(0x1a9)](_0x1d12e6),console[_0x48275a(0x171)](_0x48275a(0x1a3)),loggerService_1[_0x48275a(0x1c9)][_0x48275a(0xf5)]('mastercard',_0x48275a(0x125),_0x5026e4[_0x48275a(0xef)],_0x3a620c,_0x514830),console['log']('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x2574e4){console[_0x48275a(0x10a)](_0x48275a(0x1e3),_0x2574e4),loggerService_1[_0x48275a(0x1c9)][_0x48275a(0x177)](_0x48275a(0x141),_0x48275a(0x15f),_0x48275a(0x131)+_0x2574e4),_0x3a620c=_0x2e7549;}}else loggerService_1[_0x48275a(0x1c9)][_0x48275a(0xf5)]('mastercard',_0x48275a(0x125),_0x5026e4[_0x48275a(0xef)],_0x3a620c,_0x514830),console['log'](_0x48275a(0x136));console[_0x48275a(0x171)](_0x48275a(0x1d4),_0x3a620c['status']),console[_0x48275a(0x171)]('Final:',_0x3a620c[_0x48275a(0x166)]),console[_0x48275a(0x171)](_0x48275a(0x167),_0x3a620c[_0x48275a(0x1a1)]),console[_0x48275a(0x171)]('3DS\x20URL:',_0x3a620c[_0x48275a(0x18e)]||_0x48275a(0x15a));if(_0x3a620c[_0x48275a(0xef)]===0x64&&_0x3a620c[_0x48275a(0x166)]===0x1)return console['log']('✅\x20Payment\x20successful'),{'gateway_payment_id':_0x3a620c[_0x48275a(0x1a1)]?.[_0x48275a(0x14c)](),'payment_url':_0x2f6afa,'requires_3ds':![],'status':_0x48275a(0x1e2),'final':!![]};if(_0x3a620c['3ds_url'])return console[_0x48275a(0x171)](_0x48275a(0x13c)),this['scheduleStatusChecks'](_0x992833,_0x422e1f,_0x3a620c['payment_id']?.['toString']()||_0x422e1f),{'gateway_payment_id':_0x3a620c['payment_id']?.[_0x48275a(0x14c)](),'payment_url':_0x3a620c['3ds_url'],'requires_3ds':!![],'threeds_url':_0x3a620c[_0x48275a(0x18e)],'status':_0x48275a(0x185),'final':![]};let _0xa28d47=_0x3a620c[_0x48275a(0x11a)]||_0x3a620c[_0x48275a(0x107)]||_0x48275a(0x180),_0x1dfad6=_0x3a620c[_0x48275a(0xef)],_0x11153a=_0x3a620c[_0x48275a(0x166)];return console[_0x48275a(0x171)]('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x1dfad6+_0x48275a(0x1db)+_0x11153a+',\x20Desc:\x20'+_0xa28d47),{'gateway_payment_id':_0x3a620c[_0x48275a(0x1a1)]?.[_0x48275a(0x14c)](),'payment_url':_0x2f6afa,'requires_3ds':![],'status':'FAILED','final':!![]};}catch(_0x4bc2e3){console[_0x48275a(0x10a)](_0x48275a(0xf8)),console[_0x48275a(0x10a)](_0x48275a(0x19f),_0x4bc2e3),loggerService_1['loggerService']['logWhiteDomainError'](_0x48275a(0x141),'/charge',_0x4bc2e3);throw new Error(_0x48275a(0x1b7)+(_0x4bc2e3 instanceof Error?_0x4bc2e3[_0x48275a(0x107)]:_0x48275a(0x180)));}}async[a42_0x4fdb68(0x148)](_0x5c3a17,_0x534e9f){const _0x4de0f8=a42_0x4fdb68;console[_0x4de0f8(0x171)]('📊\x20Checking\x20MasterCard\x20payment\x20status:\x20'+_0x5c3a17+'\x20('+_0x534e9f+')');try{const _0x1b457c={'payment_id':_0x5c3a17,'order_id':_0x534e9f},_0x1aaab8=JSON['stringify'](_0x1b457c),{key:_0x1a0850,iv:_0x28a7cc}=this[_0x4de0f8(0xf0)](),_0x3024f2=this['encryptAES'](_0x1aaab8,_0x1a0850,_0x28a7cc),_0x3e978e=this[_0x4de0f8(0x1b0)](_0x1a0850,_0x28a7cc),_0x1378e7=this[_0x4de0f8(0x111)](_0x1aaab8),_0x423820={'merchant_point_id':this[_0x4de0f8(0x11d)],'method':_0x4de0f8(0xef),'info':_0x3024f2,'key':_0x3e978e,'sign':_0x1378e7,'lang':'en'};loggerService_1[_0x4de0f8(0x1c9)]['logWhiteDomainRequest'](_0x4de0f8(0x141),'/status','POST',{'merchant_point_id':this['merchantPointId'],'method':_0x4de0f8(0xef),'lang':'en'});const _0xbd87b5=Date[_0x4de0f8(0x1ca)](),_0x33e108=await fetch(this[_0x4de0f8(0x1d3)],{'method':_0x4de0f8(0x13f),'headers':{'Content-Type':'application/json','Accept':_0x4de0f8(0x1a4),'User-Agent':_0x4de0f8(0xf6)},'body':JSON['stringify'](_0x423820)}),_0x23eaed=Date[_0x4de0f8(0x1ca)]()-_0xbd87b5;if(!_0x33e108['ok']){const _0x47d09c=await _0x33e108[_0x4de0f8(0x1af)]();loggerService_1[_0x4de0f8(0x1c9)]['logWhiteDomainResponse'](_0x4de0f8(0x141),_0x4de0f8(0x154),_0x33e108[_0x4de0f8(0xef)],_0x47d09c,_0x23eaed);throw new Error('HTTP\x20error!\x20status:\x20'+_0x33e108[_0x4de0f8(0xef)]);}const _0x5223f5=await _0x33e108[_0x4de0f8(0x12c)]();loggerService_1[_0x4de0f8(0x1c9)][_0x4de0f8(0xf5)](_0x4de0f8(0x141),_0x4de0f8(0x154),_0x33e108['status'],_0x5223f5,_0x23eaed);let _0x2a71ae=_0x5223f5;if(_0x5223f5['info']&&_0x5223f5['key']&&_0x5223f5[_0x4de0f8(0x135)]){console['log'](_0x4de0f8(0x17d));try{const _0xeb1e21=this[_0x4de0f8(0x129)](_0x5223f5[_0x4de0f8(0x119)],_0x5223f5['key']);_0x2a71ae=JSON[_0x4de0f8(0x1a9)](_0xeb1e21),console[_0x4de0f8(0x171)](_0x4de0f8(0x193)),loggerService_1[_0x4de0f8(0x1c9)][_0x4de0f8(0xf5)](_0x4de0f8(0x141),_0x4de0f8(0xf2),_0x33e108[_0x4de0f8(0xef)],_0x2a71ae,_0x23eaed),console[_0x4de0f8(0x171)](_0x4de0f8(0x132));}catch(_0x38e959){console[_0x4de0f8(0x10a)](_0x4de0f8(0x118),_0x38e959),loggerService_1['loggerService'][_0x4de0f8(0x177)](_0x4de0f8(0x141),'/status_decrypt',_0x4de0f8(0x1b9)+_0x38e959),_0x2a71ae=_0x5223f5;}}else loggerService_1[_0x4de0f8(0x1c9)]['logWhiteDomainResponse']('mastercard',_0x4de0f8(0xf2),_0x33e108[_0x4de0f8(0xef)],_0x2a71ae,_0x23eaed),console[_0x4de0f8(0x171)](_0x4de0f8(0x170));console[_0x4de0f8(0x171)](_0x4de0f8(0x133),{'status':_0x2a71ae['status'],'final':_0x2a71ae[_0x4de0f8(0x166)],'payment_id':_0x2a71ae[_0x4de0f8(0x1a1)],'desc':_0x2a71ae[_0x4de0f8(0x11a)]});let _0xf540c7='PENDING';if(_0x2a71ae[_0x4de0f8(0xef)]===0x1&&_0x2a71ae[_0x4de0f8(0x166)]===0x1)_0xf540c7=_0x4de0f8(0x1e2);else _0x2a71ae[_0x4de0f8(0xef)]===0x0&&_0x2a71ae[_0x4de0f8(0x166)]===0x0?_0xf540c7='PENDING':_0xf540c7=_0x4de0f8(0x17a);return{'status':_0xf540c7,'final':_0x2a71ae[_0x4de0f8(0x166)]===0x1,'amount':_0x2a71ae[_0x4de0f8(0x104)],'currency':_0x2a71ae[_0x4de0f8(0x18f)],'date_success':_0x2a71ae[_0x4de0f8(0x116)],'description':_0x2a71ae[_0x4de0f8(0x11a)]};}catch(_0x267ce8){console[_0x4de0f8(0x10a)]('MasterCard\x20status\x20check\x20error:',_0x267ce8),loggerService_1[_0x4de0f8(0x1c9)][_0x4de0f8(0x177)](_0x4de0f8(0x141),'/status',_0x267ce8);throw new Error(_0x4de0f8(0xfc)+(_0x267ce8 instanceof Error?_0x267ce8['message']:'Unknown\x20error'));}}[a42_0x4fdb68(0x110)](_0x4aad3b,_0x3655e3,_0x395ead){const _0x2e7b59=a42_0x4fdb68;console[_0x2e7b59(0x171)](_0x2e7b59(0x179)+_0x4aad3b+'\x20('+_0x395ead+')'),this[_0x2e7b59(0x1a6)](_0x4aad3b);const _0x59e75d=[],_0x22e95c=0x5*0x3c*0x3e8,_0x3c0f16=0x2*0x3c*0x3c*0x3e8,_0x412651=Math[_0x2e7b59(0x130)](_0x3c0f16/_0x22e95c);console[_0x2e7b59(0x171)](_0x2e7b59(0x1b5)+_0x412651+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x37c516=0x1;_0x37c516<=_0x412651;_0x37c516++){const _0x4ea91=setTimeout(async()=>{const _0x56cf29=_0x2e7b59;console['log'](_0x56cf29(0x1b4)+_0x37c516+'/'+_0x412651+_0x56cf29(0x1ae)+_0x4aad3b);try{const _0x2fd0eb=await this[_0x56cf29(0x148)](_0x395ead,_0x3655e3);console[_0x56cf29(0x171)](_0x56cf29(0x18c)+_0x37c516+_0x56cf29(0x126),_0x2fd0eb),_0x2fd0eb[_0x56cf29(0x166)]&&(console[_0x56cf29(0x171)](_0x56cf29(0x159)+_0x4aad3b+_0x56cf29(0xf1)+_0x2fd0eb['status']+_0x56cf29(0x1ab)),this[_0x56cf29(0x1a6)](_0x4aad3b),await this[_0x56cf29(0xf7)](_0x4aad3b,_0x2fd0eb[_0x56cf29(0xef)],_0x2fd0eb));}catch(_0x2329bc){console[_0x56cf29(0x10a)](_0x56cf29(0x102)+_0x37c516+_0x56cf29(0x128)+_0x4aad3b+':',_0x2329bc);}},_0x37c516*_0x22e95c);_0x59e75d[_0x2e7b59(0x1ad)](_0x4ea91);}this[_0x2e7b59(0x18b)][_0x2e7b59(0x138)](_0x4aad3b,_0x59e75d),console[_0x2e7b59(0x171)](_0x2e7b59(0x1c8)+_0x412651+_0x2e7b59(0x1a2)+_0x4aad3b);}['clearStatusTimers'](_0x2d189a){const _0x2a3625=a42_0x4fdb68,_0x204423=this[_0x2a3625(0x18b)][_0x2a3625(0x1ce)](_0x2d189a);_0x204423&&(console[_0x2a3625(0x171)](_0x2a3625(0x16a)+_0x204423[_0x2a3625(0x1cf)]+_0x2a3625(0x15c)+_0x2d189a),_0x204423['forEach']((_0x45ba64,_0x4ba29c)=>{clearTimeout(_0x45ba64);}),this[_0x2a3625(0x18b)]['delete'](_0x2d189a));}async['updatePaymentStatus'](_0x338c89,_0x115b62,_0x3a5e80){const _0x50b6ce=a42_0x4fdb68;try{const _0x452189=(await Promise[_0x50b6ce(0x10b)]()['then'](()=>__importStar(require(_0x50b6ce(0xff)))))[_0x50b6ce(0x12e)],_0x154038={'status':_0x115b62[_0x50b6ce(0x199)](),'updatedAt':new Date(),'statusChangedBy':_0x50b6ce(0xee),'statusChangedAt':new Date()};_0x115b62===_0x50b6ce(0x1e2)&&(_0x154038[_0x50b6ce(0x1d8)]=new Date()),_0x3a5e80[_0x50b6ce(0x120)]&&(_0x154038[_0x50b6ce(0x14d)]=_0x50b6ce(0x145)+_0x3a5e80[_0x50b6ce(0x120)]),await _0x452189[_0x50b6ce(0x134)][_0x50b6ce(0x174)]({'where':{'id':_0x338c89},'data':_0x154038}),console[_0x50b6ce(0x171)](_0x50b6ce(0x159)+_0x338c89+_0x50b6ce(0xfd)+_0x115b62),await this[_0x50b6ce(0x1c5)](_0x338c89,_0x115b62);}catch(_0x5579d1){console[_0x50b6ce(0x10a)]('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x338c89+':',_0x5579d1);}}async[a42_0x4fdb68(0x1c5)](_0xbf4bf8,_0x1cd80d){const _0x595135=a42_0x4fdb68;try{const _0x2c1bc6=(await Promise[_0x595135(0x10b)]()[_0x595135(0x158)](()=>__importStar(require(_0x595135(0xff)))))[_0x595135(0x12e)],{telegramBotService:_0x8396fa}=await Promise[_0x595135(0x10b)]()['then'](()=>__importStar(require('../telegramBotService'))),_0x47fe23=await _0x2c1bc6['payment'][_0x595135(0x156)]({'where':{'id':_0xbf4bf8},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x47fe23)return;const _0x3830bb={'PAID':_0x595135(0x18d),'FAILED':'failed'},_0x2bbea3=_0x3830bb[_0x1cd80d];_0x2bbea3&&await _0x8396fa[_0x595135(0x15d)](_0x47fe23[_0x595135(0x191)],_0x47fe23,_0x2bbea3),await this[_0x595135(0x14b)](_0x47fe23,_0x1cd80d);}catch(_0x525449){console['error'](_0x595135(0x1dc),_0x525449);}}async[a42_0x4fdb68(0x14b)](_0x184cda,_0x4c467a){const _0xc66cf5=a42_0x4fdb68,_0x45f9ca=Date[_0xc66cf5(0x1ca)]();try{const _0x270cff=_0x184cda['shop'],_0x7e0060=_0x270cff[_0xc66cf5(0x153)];if(!_0x7e0060?.[_0xc66cf5(0x1b6)]){console[_0xc66cf5(0x171)](_0xc66cf5(0x162)+_0x270cff['id']);return;}const _0x41d72d=_0x4c467a==='PAID'?_0xc66cf5(0x10f):'payment.failed';let _0x5a4f4b=[];if(_0x7e0060[_0xc66cf5(0x151)])try{_0x5a4f4b=Array[_0xc66cf5(0x1c6)](_0x7e0060[_0xc66cf5(0x151)])?_0x7e0060[_0xc66cf5(0x151)]:JSON['parse'](_0x7e0060[_0xc66cf5(0x151)]);}catch(_0x5cf018){console['error']('Error\x20parsing\x20webhook\x20events:',_0x5cf018),_0x5a4f4b=[];}if(!_0x5a4f4b[_0xc66cf5(0x1de)](_0x41d72d)){console[_0xc66cf5(0x171)]('Webhook\x20event\x20'+_0x41d72d+_0xc66cf5(0x192)+_0x270cff['id']);return;}const _0x5baf63={'event':_0x41d72d,'payment':{'id':_0x184cda['id'],'order_id':_0x184cda['orderId'],'gateway_order_id':_0x184cda[_0xc66cf5(0x1cc)],'gateway':_0xc66cf5(0x181),'amount':_0x184cda[_0xc66cf5(0x104)],'currency':_0x184cda[_0xc66cf5(0x18f)],'status':_0x4c467a[_0xc66cf5(0x14e)](),'customer_email':_0x184cda[_0xc66cf5(0x19b)],'customer_name':_0x184cda['customerName'],'created_at':_0x184cda[_0xc66cf5(0x164)],'updated_at':new Date()}},_0x2a35ac=await fetch(_0x7e0060[_0xc66cf5(0x1b6)],{'method':_0xc66cf5(0x13f),'headers':{'Content-Type':_0xc66cf5(0x1a4),'User-Agent':_0xc66cf5(0x1bd)},'body':JSON['stringify'](_0x5baf63)}),_0x61e0da=Date[_0xc66cf5(0x1ca)]()-_0x45f9ca;loggerService_1[_0xc66cf5(0x1c9)]['logShopWebhookSent'](_0x184cda[_0xc66cf5(0x191)],_0x7e0060[_0xc66cf5(0x1b6)],_0x41d72d,_0x2a35ac[_0xc66cf5(0xef)],_0x61e0da,_0x5baf63),console['log'](_0xc66cf5(0x11c)+_0x7e0060[_0xc66cf5(0x1b6)]+_0xc66cf5(0x143)+_0x2a35ac['status']+'\x20('+_0x61e0da+_0xc66cf5(0x1cb));}catch(_0x4e504d){console[_0xc66cf5(0x10a)](_0xc66cf5(0x1d2),_0x4e504d),loggerService_1[_0xc66cf5(0x1c9)][_0xc66cf5(0x106)](_0x184cda[_0xc66cf5(0x191)],_0x184cda['shop']?.[_0xc66cf5(0x153)]?.[_0xc66cf5(0x1b6)]||'unknown',_0xc66cf5(0x1bb),_0x4e504d,{});}}[a42_0x4fdb68(0x1c0)](_0x224719){const _0x2b5ea5=a42_0x4fdb68,_0x167b3c=_0x224719[_0x2b5ea5(0x19c)](/[\s-]/g,'');if(_0x167b3c[_0x2b5ea5(0x1cf)]<0x4)return _0x2b5ea5(0x190);return _0x2b5ea5(0x144)+_0x167b3c[_0x2b5ea5(0x17c)](-0x4);}async['processWebhook'](_0x32fee2){const _0xb31da9=a42_0x4fdb68;console['log'](_0xb31da9(0x11e),_0x32fee2);let _0x1cc956=_0xb31da9(0x185);if(_0x32fee2[_0xb31da9(0xef)]===0x1&&_0x32fee2[_0xb31da9(0x166)]===0x1)_0x1cc956=_0xb31da9(0x1e2);else _0x32fee2['status']===0x0&&_0x32fee2[_0xb31da9(0x166)]===0x0?_0x1cc956=_0xb31da9(0x185):_0x1cc956=_0xb31da9(0x17a);return{'paymentId':_0x32fee2[_0xb31da9(0x1ba)]||'','status':_0x1cc956,'amount':_0x32fee2[_0xb31da9(0x104)],'currency':_0x32fee2[_0xb31da9(0x18f)]};}[a42_0x4fdb68(0x16c)](){const _0xc656c5=a42_0x4fdb68;console[_0xc656c5(0x171)](_0xc656c5(0x146));const _0x91fde1=this[_0xc656c5(0x18b)][_0xc656c5(0x1c1)];for(const [_0x29d743]of this[_0xc656c5(0x18b)]){this[_0xc656c5(0x1a6)](_0x29d743);}console['log'](_0xc656c5(0x121)+_0x91fde1+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a42_0x4fdb68(0x1bc)]=MasterCardService;