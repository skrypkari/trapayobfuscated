'use strict';const a42_0x160cac=a42_0x162c;(function(_0x5b74be,_0x38c9da){const _0x558eb6=a42_0x162c,_0x253861=_0x5b74be();while(!![]){try{const _0x432702=-parseInt(_0x558eb6(0x20f))/0x1+parseInt(_0x558eb6(0x1e8))/0x2*(parseInt(_0x558eb6(0x13c))/0x3)+parseInt(_0x558eb6(0x204))/0x4+parseInt(_0x558eb6(0x1f0))/0x5+parseInt(_0x558eb6(0x17a))/0x6+parseInt(_0x558eb6(0x1c8))/0x7+-parseInt(_0x558eb6(0x1ed))/0x8;if(_0x432702===_0x38c9da)break;else _0x253861['push'](_0x253861['shift']());}catch(_0x515c1b){_0x253861['push'](_0x253861['shift']());}}}(a42_0x3f9d,0xe9b33));function a42_0x162c(_0x1f1f82,_0x37c831){const _0x3f9df8=a42_0x3f9d();return a42_0x162c=function(_0x162c42,_0x306003){_0x162c42=_0x162c42-0x12f;let _0x12adaa=_0x3f9df8[_0x162c42];return _0x12adaa;},a42_0x162c(_0x1f1f82,_0x37c831);}var __createBinding=this&&this[a42_0x160cac(0x1ef)]||(Object[a42_0x160cac(0x1f9)]?function(_0x4f6800,_0x37a248,_0x1df3c9,_0x386e5a){const _0x316989=a42_0x160cac;if(_0x386e5a===undefined)_0x386e5a=_0x1df3c9;var _0x1c1d1c=Object[_0x316989(0x214)](_0x37a248,_0x1df3c9);(!_0x1c1d1c||(_0x316989(0x1b1)in _0x1c1d1c?!_0x37a248['__esModule']:_0x1c1d1c[_0x316989(0x20a)]||_0x1c1d1c[_0x316989(0x17d)]))&&(_0x1c1d1c={'enumerable':!![],'get':function(){return _0x37a248[_0x1df3c9];}}),Object[_0x316989(0x130)](_0x4f6800,_0x386e5a,_0x1c1d1c);}:function(_0x3e1633,_0x3076c6,_0x69493c,_0x45c851){if(_0x45c851===undefined)_0x45c851=_0x69493c;_0x3e1633[_0x45c851]=_0x3076c6[_0x69493c];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a42_0x160cac(0x1f9)]?function(_0x3e81ba,_0x2d8c33){const _0xc2c5fe=a42_0x160cac;Object[_0xc2c5fe(0x130)](_0x3e81ba,'default',{'enumerable':!![],'value':_0x2d8c33});}:function(_0x6bb6c,_0x5c2f14){const _0x2c7da5=a42_0x160cac;_0x6bb6c[_0x2c7da5(0x1dc)]=_0x5c2f14;}),__importStar=this&&this['__importStar']||(function(){var _0x29920e=function(_0x24b74f){return _0x29920e=Object['getOwnPropertyNames']||function(_0x3cbc40){const _0x4a65e8=a42_0x162c;var _0x496477=[];for(var _0x25c890 in _0x3cbc40)if(Object[_0x4a65e8(0x18c)]['hasOwnProperty'][_0x4a65e8(0x164)](_0x3cbc40,_0x25c890))_0x496477[_0x496477[_0x4a65e8(0x141)]]=_0x25c890;return _0x496477;},_0x29920e(_0x24b74f);};return function(_0x4bff52){const _0x3cceb8=a42_0x162c;if(_0x4bff52&&_0x4bff52[_0x3cceb8(0x131)])return _0x4bff52;var _0xf3f66e={};if(_0x4bff52!=null){for(var _0x2492c8=_0x29920e(_0x4bff52),_0x56f979=0x0;_0x56f979<_0x2492c8[_0x3cceb8(0x141)];_0x56f979++)if(_0x2492c8[_0x56f979]!==_0x3cceb8(0x1dc))__createBinding(_0xf3f66e,_0x4bff52,_0x2492c8[_0x56f979]);}return __setModuleDefault(_0xf3f66e,_0x4bff52),_0xf3f66e;};}()),__importDefault=this&&this[a42_0x160cac(0x147)]||function(_0x44daa8){const _0x28a711=a42_0x160cac;return _0x44daa8&&_0x44daa8[_0x28a711(0x131)]?_0x44daa8:{'default':_0x44daa8};};function a42_0x3f9d(){const _0x2ca3c0=['🔐\x20Private\x20key\x20length:\x20','validateKeyFiles','existsSync','decryptResponse','currency','prototype','MasterCard:\x20','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','private.pem','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','Public\x20key\x20file\x20not\x20found:\x20','parse','end','📝\x20Data\x20to\x20sign\x20length:','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','createCipheriv','json','sendPaymentNotifications','ms)','https://api.paydmeth.com/api','📝\x20Encrypted\x20key\x20length:','❌\x20PHP\x20decryptor\x20request\x20failed:','🔐\x20Data\x20encrypted\x20with\x20AES','Private\x20key\x20file\x20not\x20found:\x20','Card\x20Holder:','last_name','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','sendPaymentNotification','stopAllStatusChecks','Return\x20URL:','webhookUrl','Failed\x20to\x20send\x20payment\x20notifications:','scheduleStatusChecks','findUnique','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','****','paid','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','substring','trim','Failed\x20to\x20decrypt\x20response','Payment\x20ID:','get','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','generateAESKey','\x20\x20\x20-\x20key\x20length:','set','/charge_decrypted','🔍\x20MasterCard\x20status\x20check\x20#','forEach','\x20\x20\x20-\x20lang:\x20en','❌\x20RSA\x20encryption\x20failed:','date_success','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','toUpperCase','log','/status_raw','Response\x20Time:','cvv','TesSoft\x20Payment\x20System/1.0','decryptAES','then','failed','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','6587427IUzZFY','webhook_send','Result\x20URL:','constants','psp_public.pem','updatePaymentStatus','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','Webhook\x20event\x20','createdAt','text','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','loggerService','RSA_PKCS1_PADDING','publicEncrypt','MasterCardService','publicKeyPath','logWhiteDomainResponse','webhookEvents','key','Card\x20Number:','default','sendShopWebhook','delete','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','maskCardNumber','HTTP\x20','...','desc','💾\x20Payment\x20data\x20prepared','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','\x20not\x20enabled\x20for\x20shop\x20','6iomNXh','join','🔐\x20Private\x20key\x20path:','SHA256','push','24537928NaNLAE','stringify','__createBinding','5347560rMIGqV','📊\x20Status\x20check\x20result:','payment','⏰\x20Will\x20check\x20status\x20','update','payment.failed','\x20with\x20status\x20','slice','🔐\x20Public\x20key\x20length:\x20','create','status','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','❌\x20RSA\x20signing\x20failed:','🔐\x20AES\x20IV\x20length:','createSign','logShopWebhookSent','shopId','📝\x20Final\x20request\x20structure:','payment_id','https://api2.trapay.uk/decrypt.php','5021132KuFlfR','\x20is\x20final\x20(','Status\x20decryption\x20failed:\x20','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','customerEmail','❌\x20Status\x20check\x20#','writable','from','/status','Processing\x20MasterCard\x20webhook:','utf8','760814IGEkLc','/charge_raw','🔐\x203DS\x20verification\x20required','Amount:','../loggerService','getOwnPropertyDescriptor','shop','/charge','paidAt','encryptRSA','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','clearStatusTimers','****\x20****\x20****\x20','merchantPointId','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','amount','Failed\x20to\x20send\x20MasterCard\x20webhook:','info','checkPaymentStatus','FAILED',',\x20body:\x20','logShopWebhookError','MasterCard\x20status\x20check\x20error:',',\x20Desc:\x20','aes-256-ctr','adminNotes','defineProperty','__esModule','encryptAES','✅\x20Payment\x20successful','🔐\x20AES\x20key\x20and\x20IV\x20generated','❌\x20Data\x20being\x20signed:','randomBytes','-----END','cwd','🔐\x20Data\x20signed\x20with\x20RSA','statusCheckTimers','\x20failed\x20for\x20payment\x20','1385553auSZSF','includes','\x20status\x20timers\x20for\x20payment\x20','payment.success','error','length','resolve','\x20status\x20updated\x20to\x20','processWebhook','now','PAID','__importDefault','✅\x20Payment\x20','gatewayOrderId','message','unknown','/status_decrypted','3ds_url','replace','❌\x20MasterCard\x20key\x20validation\x20failed:','✅\x20Status\x20response\x20decrypted\x20successfully','readFileSync','📝\x20Data\x20length:','application/json','description','\x20for\x20payment\x20','\x20\x20\x20-\x20info\x20length:','logWhiteDomainError','toLowerCase','apiUrl','toString','📝\x20Signature\x20length:','orderId','mastercard','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','signRSA','base64','customerName','🛑\x20Stopped\x20','-----BEGIN','call','PHP\x20decryptor\x20error','keys','floor','sign','POST','HTTP\x20error!\x20status:\x20','number','HTTP\x20Status:','privateDecrypt','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','Error\x20details:','🧹\x20Clearing\x20','\x20characters','Status:','decryptResponsePhp','isArray','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','PENDING','/charge_decrypt','🔐\x20Public\x20key\x20path:','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','803286EZOsBa','../../config/database','privateKeyPath','configurable','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','),\x20stopping\x20status\x20checks','Unknown\x20error','first_name','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','final','path','system','\x20result:'];a42_0x3f9d=function(){return _0x2ca3c0;};return a42_0x3f9d();}Object['defineProperty'](exports,a42_0x160cac(0x131),{'value':!![]}),exports[a42_0x160cac(0x1d6)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x160cac(0x184))),loggerService_1=require(a42_0x160cac(0x213));class MasterCardService{constructor(){const _0x4243d6=a42_0x160cac;this[_0x4243d6(0x13a)]=new Map(),this[_0x4243d6(0x159)]=_0x4243d6(0x19a),this[_0x4243d6(0x21c)]=0x67c,this['privateKeyPath']=path_1[_0x4243d6(0x1dc)][_0x4243d6(0x1e9)](process[_0x4243d6(0x138)](),_0x4243d6(0x166),_0x4243d6(0x18f)),this[_0x4243d6(0x1d7)]=path_1[_0x4243d6(0x1dc)][_0x4243d6(0x1e9)](process[_0x4243d6(0x138)](),_0x4243d6(0x166),_0x4243d6(0x1cc)),console[_0x4243d6(0x1be)]('💳\x20MasterCard\x20service\x20initialized'),console[_0x4243d6(0x1be)](_0x4243d6(0x1ea),this[_0x4243d6(0x17c)]),console[_0x4243d6(0x1be)](_0x4243d6(0x178),this['publicKeyPath']),this[_0x4243d6(0x188)]();}[a42_0x160cac(0x188)](){const _0x140fde=a42_0x160cac;try{if(!fs_1['default']['existsSync'](this[_0x140fde(0x17c)]))throw new Error(_0x140fde(0x19e)+this[_0x140fde(0x17c)]);if(!fs_1[_0x140fde(0x1dc)][_0x140fde(0x189)](this['publicKeyPath']))throw new Error(_0x140fde(0x191)+this[_0x140fde(0x1d7)]);const _0x1aa1ae=fs_1[_0x140fde(0x1dc)][_0x140fde(0x151)](this['privateKeyPath'],'utf8')[_0x140fde(0x1ae)](),_0x5bceb8=fs_1['default'][_0x140fde(0x151)](this[_0x140fde(0x1d7)],'utf8')[_0x140fde(0x1ae)]();if(!_0x1aa1ae['includes'](_0x140fde(0x163))||!_0x1aa1ae['includes'](_0x140fde(0x137)))throw new Error(_0x140fde(0x15e));if(!_0x5bceb8[_0x140fde(0x13d)](_0x140fde(0x163))||!_0x5bceb8[_0x140fde(0x13d)](_0x140fde(0x137)))throw new Error(_0x140fde(0x1c7));console[_0x140fde(0x1be)](_0x140fde(0x190)),console[_0x140fde(0x1be)](_0x140fde(0x187)+_0x1aa1ae['length']+'\x20characters'),console['log'](_0x140fde(0x1f8)+_0x5bceb8['length']+_0x140fde(0x171));}catch(_0x15655f){console['error'](_0x140fde(0x14f),_0x15655f);throw _0x15655f;}}[a42_0x160cac(0x1b3)](){const _0x5eab82=a42_0x160cac,_0x3709d2=crypto_1[_0x5eab82(0x1dc)][_0x5eab82(0x136)](0x20),_0x488e0c=crypto_1[_0x5eab82(0x1dc)][_0x5eab82(0x136)](0x10);return{'key':_0x3709d2,'iv':_0x488e0c};}[a42_0x160cac(0x132)](_0x1d9b1a,_0x39dff4,_0x18f8df){const _0x230fa5=a42_0x160cac,_0x1ca1a2=crypto_1['default'][_0x230fa5(0x196)]('aes-256-ctr',_0x39dff4,_0x18f8df);let _0x57a9b7=_0x1ca1a2[_0x230fa5(0x1f4)](_0x1d9b1a,_0x230fa5(0x20e),'base64');return _0x57a9b7+=_0x1ca1a2[_0x230fa5(0x183)](_0x230fa5(0x160)),_0x57a9b7;}['encryptRSA'](_0x33a81c,_0x143026){const _0x59b605=a42_0x160cac;try{const _0x5c757f=fs_1[_0x59b605(0x1dc)][_0x59b605(0x151)](this[_0x59b605(0x1d7)],_0x59b605(0x20e))[_0x59b605(0x1ae)](),_0x4b5169={'iv':_0x143026[_0x59b605(0x15a)](_0x59b605(0x160)),'key':_0x33a81c[_0x59b605(0x15a)](_0x59b605(0x160))},_0x49a135=JSON[_0x59b605(0x1ee)](_0x4b5169);console['log'](_0x59b605(0x1c6),_0x49a135['length']);const _0x38e1d9=crypto_1['default'][_0x59b605(0x1d5)]({'key':_0x5c757f,'padding':crypto_1[_0x59b605(0x1dc)][_0x59b605(0x1cb)][_0x59b605(0x1d4)]},Buffer[_0x59b605(0x20b)](_0x49a135));return console[_0x59b605(0x1be)](_0x59b605(0x1b2),_0x38e1d9['length']),_0x38e1d9[_0x59b605(0x15a)](_0x59b605(0x160));}catch(_0x4993e9){console[_0x59b605(0x140)](_0x59b605(0x1ba),_0x4993e9);throw new Error(_0x59b605(0x182));}}[a42_0x160cac(0x15f)](_0x410996){const _0x259402=a42_0x160cac;try{const _0xd55278=fs_1[_0x259402(0x1dc)][_0x259402(0x151)](this[_0x259402(0x17c)],_0x259402(0x20e))[_0x259402(0x1ae)](),_0x506ab2=crypto_1['default'][_0x259402(0x1fe)](_0x259402(0x1eb));_0x506ab2[_0x259402(0x1f4)](_0x410996),_0x506ab2[_0x259402(0x193)]();const _0x4f0f1f=_0x506ab2['sign'](_0xd55278,_0x259402(0x160));return console[_0x259402(0x1be)]('🔐\x20RSA\x20signing\x20successful'),console['log'](_0x259402(0x194),_0x410996[_0x259402(0x141)]),console[_0x259402(0x1be)](_0x259402(0x15b),_0x4f0f1f[_0x259402(0x141)]),_0x4f0f1f;}catch(_0x1effc7){console[_0x259402(0x140)](_0x259402(0x1fc),_0x1effc7),console[_0x259402(0x140)](_0x259402(0x135),_0x410996[_0x259402(0x1ad)](0x0,0xc8)+_0x259402(0x1e2));throw new Error(_0x259402(0x1df));}}[a42_0x160cac(0x1c3)](_0x160bf6,_0x475340,_0xa0ff75){const _0x1fa61d=a42_0x160cac,_0xf16a7b=crypto_1['default']['createDecipheriv'](_0x1fa61d(0x228),_0x475340,_0xa0ff75);let _0x41b584=_0xf16a7b[_0x1fa61d(0x1f4)](_0x160bf6,'base64',_0x1fa61d(0x20e));return _0x41b584+=_0xf16a7b[_0x1fa61d(0x183)](_0x1fa61d(0x20e)),_0x41b584;}async['decryptResponsePhp'](_0x843b7d,_0x26749a){const _0x4429a6=a42_0x160cac;try{const _0x4b1edf=await fetch(_0x4429a6(0x203),{'method':_0x4429a6(0x169),'headers':{'Content-Type':_0x4429a6(0x153)},'body':JSON[_0x4429a6(0x1ee)]({'info':_0x843b7d,'key':_0x26749a})});if(!_0x4b1edf['ok'])throw new Error(_0x4429a6(0x165));return await _0x4b1edf[_0x4429a6(0x1d1)]();}catch(_0x566390){console[_0x4429a6(0x140)](_0x4429a6(0x19c),_0x566390);throw new Error(_0x4429a6(0x1e6));}}[a42_0x160cac(0x18a)](_0xe3f1dd,_0x213aba){const _0x310d86=a42_0x160cac;try{const _0x20fa58=fs_1[_0x310d86(0x1dc)][_0x310d86(0x151)](this[_0x310d86(0x17c)],_0x310d86(0x20e))['trim'](),_0x5373de=crypto_1['default'][_0x310d86(0x16d)](_0x20fa58,Buffer['from'](_0x213aba,_0x310d86(0x160))),_0x139de9=JSON['parse'](_0x5373de['toString']()),_0x454e64=Buffer[_0x310d86(0x20b)](_0x139de9[_0x310d86(0x1da)],'base64'),_0x3dcf41=Buffer[_0x310d86(0x20b)](_0x139de9['iv'],'base64');return this[_0x310d86(0x1c3)](_0xe3f1dd,_0x454e64,_0x3dcf41);}catch(_0x3fb056){throw new Error(_0x310d86(0x1af));}}async['processCardPayment'](_0x2b9557){const _0x487d8d=a42_0x160cac,{paymentId:_0x5c7780,orderId:_0x59fe0e,amount:_0x3fd02f,currency:_0x3d6849,cardData:_0x15ba11,resultUrl:_0x3a7ebe,returnUrl:_0x4b0792,cardHolder:_0x5112f8,browser:_0x3db62b}=_0x2b9557;console[_0x487d8d(0x1be)](_0x487d8d(0x1a9)),console[_0x487d8d(0x1be)](_0x487d8d(0x1b0),_0x5c7780),console[_0x487d8d(0x1be)]('Order\x20ID:',_0x59fe0e),console['log'](_0x487d8d(0x212),_0x3fd02f,_0x3d6849),console[_0x487d8d(0x1be)](_0x487d8d(0x1db),this[_0x487d8d(0x1e0)](_0x15ba11['number'])),console[_0x487d8d(0x1be)](_0x487d8d(0x19f),_0x5112f8[_0x487d8d(0x181)]+'\x20'+_0x5112f8[_0x487d8d(0x1a0)]),console['log'](_0x487d8d(0x1a4),_0x4b0792),console[_0x487d8d(0x1be)](_0x487d8d(0x1ca),_0x3a7ebe);const _0x60efd9={'amount':_0x3fd02f,'currency':_0x3d6849['toUpperCase'](),'order_id':_0x59fe0e,'result_url':_0x3a7ebe,'return_url':_0x4b0792,'card':{'number':_0x15ba11[_0x487d8d(0x16b)],'expire_month':_0x15ba11['expire_month'],'expire_year':_0x15ba11['expire_year'],'cvv':_0x15ba11[_0x487d8d(0x1c1)]},'card_holder':_0x5112f8,'browser':_0x3db62b},_0x33d80d=JSON[_0x487d8d(0x1ee)](_0x60efd9);console[_0x487d8d(0x1be)](_0x487d8d(0x1e4)),console[_0x487d8d(0x1be)](_0x487d8d(0x1ac)),console['log'](_0x33d80d),console[_0x487d8d(0x1be)](_0x487d8d(0x152),_0x33d80d[_0x487d8d(0x141)]);try{const {key:_0x6f07f1,iv:_0x1681b9}=this[_0x487d8d(0x1b3)]();console[_0x487d8d(0x1be)](_0x487d8d(0x134)),console['log']('🔐\x20AES\x20key\x20length:',_0x6f07f1[_0x487d8d(0x141)]),console['log'](_0x487d8d(0x1fd),_0x1681b9[_0x487d8d(0x141)]);const _0x1eea9b=this[_0x487d8d(0x132)](_0x33d80d,_0x6f07f1,_0x1681b9);console[_0x487d8d(0x1be)](_0x487d8d(0x19d)),console['log']('📝\x20Encrypted\x20data\x20length:',_0x1eea9b[_0x487d8d(0x141)]);const _0x44871d=this[_0x487d8d(0x218)](_0x6f07f1,_0x1681b9);console['log'](_0x487d8d(0x1a1)),console[_0x487d8d(0x1be)](_0x487d8d(0x19b),_0x44871d['length']);const _0x62c671=this[_0x487d8d(0x15f)](_0x33d80d);console['log'](_0x487d8d(0x139)),console[_0x487d8d(0x1be)](_0x487d8d(0x15b),_0x62c671['length']);const _0x53044b={'merchant_point_id':this[_0x487d8d(0x21c)],'method':'charge','info':_0x1eea9b,'key':_0x44871d,'sign':_0x62c671,'lang':'en'};console[_0x487d8d(0x1be)]('📤\x20Sending\x20request\x20to\x20MasterCard\x20API...'),console[_0x487d8d(0x1be)](_0x487d8d(0x201)),console['log']('\x20\x20\x20-\x20merchant_point_id:',this[_0x487d8d(0x21c)]),console[_0x487d8d(0x1be)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x487d8d(0x1be)](_0x487d8d(0x156),_0x1eea9b['length']),console[_0x487d8d(0x1be)](_0x487d8d(0x1b4),_0x44871d[_0x487d8d(0x141)]),console[_0x487d8d(0x1be)]('\x20\x20\x20-\x20sign\x20length:',_0x62c671[_0x487d8d(0x141)]),console[_0x487d8d(0x1be)](_0x487d8d(0x1b9)),loggerService_1[_0x487d8d(0x1d3)]['logWhiteDomainRequest'](_0x487d8d(0x15d),_0x487d8d(0x216),_0x487d8d(0x169),{'merchant_point_id':this[_0x487d8d(0x21c)],'method':'charge','lang':'en'});const _0x5b6057=Date[_0x487d8d(0x145)](),_0x2ba614=await fetch(this[_0x487d8d(0x159)],{'method':_0x487d8d(0x169),'headers':{'Content-Type':_0x487d8d(0x153),'Accept':'application/json','User-Agent':_0x487d8d(0x1c2)},'body':JSON[_0x487d8d(0x1ee)](_0x53044b)}),_0x2d0f21=Date['now']()-_0x5b6057;console['log'](_0x487d8d(0x18e)),console[_0x487d8d(0x1be)]('Status:',_0x2ba614[_0x487d8d(0x1fa)]),console[_0x487d8d(0x1be)](_0x487d8d(0x1c0),_0x2d0f21+'ms');if(!_0x2ba614['ok']){const _0x54364a=await _0x2ba614['text']();console[_0x487d8d(0x140)](_0x487d8d(0x16c),_0x2ba614['status']),console[_0x487d8d(0x140)]('Response\x20Body:',_0x54364a),loggerService_1['loggerService'][_0x487d8d(0x1d8)](_0x487d8d(0x15d),_0x487d8d(0x210),_0x2ba614['status'],_0x54364a,_0x2d0f21),loggerService_1['loggerService'][_0x487d8d(0x157)](_0x487d8d(0x15d),_0x487d8d(0x216),_0x487d8d(0x1e1)+_0x2ba614[_0x487d8d(0x1fa)]+':\x20'+_0x54364a);throw new Error(_0x487d8d(0x16a)+_0x2ba614[_0x487d8d(0x1fa)]+_0x487d8d(0x224)+_0x54364a);}const _0x394df3=await _0x2ba614[_0x487d8d(0x197)]();loggerService_1[_0x487d8d(0x1d3)][_0x487d8d(0x1d8)](_0x487d8d(0x15d),'/charge_raw',_0x2ba614[_0x487d8d(0x1fa)],_0x394df3,_0x2d0f21),console['log'](_0x487d8d(0x175));let _0x472b62=_0x394df3;if(_0x394df3[_0x487d8d(0x221)]&&_0x394df3['key']&&_0x394df3[_0x487d8d(0x168)]){console[_0x487d8d(0x1be)](_0x487d8d(0x21d));try{const _0x23cfad=await this[_0x487d8d(0x173)](_0x394df3[_0x487d8d(0x221)],_0x394df3['key']);_0x472b62=JSON[_0x487d8d(0x192)](_0x23cfad),console[_0x487d8d(0x1be)]('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0x487d8d(0x1d3)][_0x487d8d(0x1d8)](_0x487d8d(0x15d),_0x487d8d(0x1b6),_0x2ba614[_0x487d8d(0x1fa)],_0x472b62,_0x2d0f21),console[_0x487d8d(0x1be)](_0x487d8d(0x1fb));}catch(_0x4c992b){console[_0x487d8d(0x140)]('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x4c992b),loggerService_1[_0x487d8d(0x1d3)][_0x487d8d(0x157)]('mastercard',_0x487d8d(0x177),'Decryption\x20failed:\x20'+_0x4c992b),_0x472b62=_0x394df3;}}else loggerService_1[_0x487d8d(0x1d3)][_0x487d8d(0x1d8)](_0x487d8d(0x15d),_0x487d8d(0x1b6),_0x2ba614[_0x487d8d(0x1fa)],_0x472b62,_0x2d0f21),console[_0x487d8d(0x1be)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x487d8d(0x1be)](_0x487d8d(0x172),_0x472b62[_0x487d8d(0x1fa)]),console['log']('Final:',_0x472b62['final']),console[_0x487d8d(0x1be)](_0x487d8d(0x1b0),_0x472b62['payment_id']),console[_0x487d8d(0x1be)]('3DS\x20URL:',_0x472b62[_0x487d8d(0x14d)]||'none');if(_0x472b62[_0x487d8d(0x1fa)]===0x64&&_0x472b62[_0x487d8d(0x183)]===0x1)return console[_0x487d8d(0x1be)](_0x487d8d(0x133)),{'gateway_payment_id':_0x472b62[_0x487d8d(0x202)]?.[_0x487d8d(0x15a)](),'payment_url':_0x4b0792,'requires_3ds':![],'status':_0x487d8d(0x146),'final':!![]};if(_0x472b62['3ds_url'])return console['log'](_0x487d8d(0x211)),this[_0x487d8d(0x1a7)](_0x5c7780,_0x59fe0e,_0x472b62['payment_id']?.[_0x487d8d(0x15a)]()||_0x59fe0e),{'gateway_payment_id':_0x472b62[_0x487d8d(0x202)]?.[_0x487d8d(0x15a)](),'payment_url':_0x472b62['3ds_url'],'requires_3ds':!![],'threeds_url':_0x472b62[_0x487d8d(0x14d)],'status':_0x487d8d(0x176),'final':![]};let _0x5174bd=_0x472b62[_0x487d8d(0x1e3)]||_0x472b62['message']||_0x487d8d(0x180),_0x5a4ce1=_0x472b62[_0x487d8d(0x1fa)],_0x3d0a02=_0x472b62['final'];return console[_0x487d8d(0x1be)](_0x487d8d(0x179)+_0x5a4ce1+',\x20Final:\x20'+_0x3d0a02+_0x487d8d(0x227)+_0x5174bd),{'gateway_payment_id':_0x472b62[_0x487d8d(0x202)]?.[_0x487d8d(0x15a)](),'payment_url':_0x4b0792,'requires_3ds':![],'status':'FAILED','final':!![]};}catch(_0x23d015){console['error'](_0x487d8d(0x1ce)),console['error'](_0x487d8d(0x16f),_0x23d015),loggerService_1[_0x487d8d(0x1d3)]['logWhiteDomainError'](_0x487d8d(0x15d),_0x487d8d(0x216),_0x23d015);throw new Error('Failed\x20to\x20process\x20MasterCard\x20payment:\x20'+(_0x23d015 instanceof Error?_0x23d015[_0x487d8d(0x14a)]:_0x487d8d(0x180)));}}async[a42_0x160cac(0x222)](_0xcf5361,_0x53cc44){const _0x3c2aa3=a42_0x160cac;console[_0x3c2aa3(0x1be)]('📊\x20Checking\x20MasterCard\x20payment\x20status:\x20'+_0xcf5361+'\x20('+_0x53cc44+')');try{const _0x2bae47={'payment_id':_0xcf5361,'order_id':_0x53cc44},_0xe3ceb1=JSON[_0x3c2aa3(0x1ee)](_0x2bae47),{key:_0x125623,iv:_0x5df36b}=this[_0x3c2aa3(0x1b3)](),_0x1e3e0d=this['encryptAES'](_0xe3ceb1,_0x125623,_0x5df36b),_0x1b4d07=this[_0x3c2aa3(0x218)](_0x125623,_0x5df36b),_0x54acc1=this[_0x3c2aa3(0x15f)](_0xe3ceb1),_0x2f42f1={'merchant_point_id':this['merchantPointId'],'method':_0x3c2aa3(0x1fa),'info':_0x1e3e0d,'key':_0x1b4d07,'sign':_0x54acc1,'lang':'en'};loggerService_1[_0x3c2aa3(0x1d3)]['logWhiteDomainRequest'](_0x3c2aa3(0x15d),_0x3c2aa3(0x20c),'POST',{'merchant_point_id':this['merchantPointId'],'method':'status','lang':'en'});const _0x4dd77f=Date[_0x3c2aa3(0x145)](),_0x3baf3b=await fetch(this['apiUrl'],{'method':_0x3c2aa3(0x169),'headers':{'Content-Type':'application/json','Accept':_0x3c2aa3(0x153),'User-Agent':_0x3c2aa3(0x1c2)},'body':JSON[_0x3c2aa3(0x1ee)](_0x2f42f1)}),_0x5dc688=Date[_0x3c2aa3(0x145)]()-_0x4dd77f;if(!_0x3baf3b['ok']){const _0x45e8b2=await _0x3baf3b['text']();loggerService_1[_0x3c2aa3(0x1d3)]['logWhiteDomainResponse']('mastercard','/status_raw',_0x3baf3b[_0x3c2aa3(0x1fa)],_0x45e8b2,_0x5dc688);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3baf3b[_0x3c2aa3(0x1fa)]);}const _0x2e91b5=await _0x3baf3b[_0x3c2aa3(0x197)]();loggerService_1[_0x3c2aa3(0x1d3)]['logWhiteDomainResponse'](_0x3c2aa3(0x15d),_0x3c2aa3(0x1bf),_0x3baf3b[_0x3c2aa3(0x1fa)],_0x2e91b5,_0x5dc688);let _0x198561=_0x2e91b5;if(_0x2e91b5['info']&&_0x2e91b5[_0x3c2aa3(0x1da)]&&_0x2e91b5['sign']){console[_0x3c2aa3(0x1be)](_0x3c2aa3(0x219));try{const _0x1713ca=this[_0x3c2aa3(0x18a)](_0x2e91b5[_0x3c2aa3(0x221)],_0x2e91b5['key']);_0x198561=JSON[_0x3c2aa3(0x192)](_0x1713ca),console['log'](_0x3c2aa3(0x150)),loggerService_1['loggerService'][_0x3c2aa3(0x1d8)](_0x3c2aa3(0x15d),_0x3c2aa3(0x14c),_0x3baf3b[_0x3c2aa3(0x1fa)],_0x198561,_0x5dc688),console[_0x3c2aa3(0x1be)](_0x3c2aa3(0x1d2));}catch(_0x14450d){console['error'](_0x3c2aa3(0x17e),_0x14450d),loggerService_1[_0x3c2aa3(0x1d3)][_0x3c2aa3(0x157)](_0x3c2aa3(0x15d),'/status_decrypt',_0x3c2aa3(0x206)+_0x14450d),_0x198561=_0x2e91b5;}}else loggerService_1[_0x3c2aa3(0x1d3)][_0x3c2aa3(0x1d8)]('mastercard',_0x3c2aa3(0x14c),_0x3baf3b[_0x3c2aa3(0x1fa)],_0x198561,_0x5dc688),console['log'](_0x3c2aa3(0x1bc));console[_0x3c2aa3(0x1be)](_0x3c2aa3(0x1f1),{'status':_0x198561[_0x3c2aa3(0x1fa)],'final':_0x198561[_0x3c2aa3(0x183)],'payment_id':_0x198561[_0x3c2aa3(0x202)],'desc':_0x198561[_0x3c2aa3(0x1e3)]});let _0x2e75c8='PENDING';if(_0x198561[_0x3c2aa3(0x1fa)]===0x1&&_0x198561[_0x3c2aa3(0x183)]===0x1)_0x2e75c8='PAID';else _0x198561['status']===0x0&&_0x198561['final']===0x0?_0x2e75c8=_0x3c2aa3(0x176):_0x2e75c8=_0x3c2aa3(0x223);return{'status':_0x2e75c8,'final':_0x198561['final']===0x1,'amount':_0x198561[_0x3c2aa3(0x21f)],'currency':_0x198561[_0x3c2aa3(0x18b)],'date_success':_0x198561[_0x3c2aa3(0x1bb)],'description':_0x198561[_0x3c2aa3(0x1e3)]};}catch(_0x151e01){console['error'](_0x3c2aa3(0x226),_0x151e01),loggerService_1[_0x3c2aa3(0x1d3)][_0x3c2aa3(0x157)](_0x3c2aa3(0x15d),_0x3c2aa3(0x20c),_0x151e01);throw new Error(_0x3c2aa3(0x21e)+(_0x151e01 instanceof Error?_0x151e01[_0x3c2aa3(0x14a)]:_0x3c2aa3(0x180)));}}[a42_0x160cac(0x1a7)](_0x1f8396,_0x1a6c51,_0x44405c){const _0x4dd76d=a42_0x160cac;console[_0x4dd76d(0x1be)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0x1f8396+'\x20('+_0x44405c+')'),this[_0x4dd76d(0x21a)](_0x1f8396);const _0x84e37c=[],_0x1ecfcb=0x5*0x3c*0x3e8,_0x105f8e=0x2*0x3c*0x3c*0x3e8,_0x16861f=Math[_0x4dd76d(0x167)](_0x105f8e/_0x1ecfcb);console[_0x4dd76d(0x1be)](_0x4dd76d(0x1f3)+_0x16861f+_0x4dd76d(0x207));for(let _0xb5e172=0x1;_0xb5e172<=_0x16861f;_0xb5e172++){const _0x4a3ad4=setTimeout(async()=>{const _0x4bc82d=_0x4dd76d;console[_0x4bc82d(0x1be)](_0x4bc82d(0x1b7)+_0xb5e172+'/'+_0x16861f+_0x4bc82d(0x155)+_0x1f8396);try{const _0x210470=await this[_0x4bc82d(0x222)](_0x44405c,_0x1a6c51);console[_0x4bc82d(0x1be)]('📊\x20Status\x20check\x20#'+_0xb5e172+_0x4bc82d(0x186),_0x210470),_0x210470[_0x4bc82d(0x183)]&&(console[_0x4bc82d(0x1be)](_0x4bc82d(0x148)+_0x1f8396+_0x4bc82d(0x205)+_0x210470['status']+_0x4bc82d(0x17f)),this[_0x4bc82d(0x21a)](_0x1f8396),await this[_0x4bc82d(0x1cd)](_0x1f8396,_0x210470[_0x4bc82d(0x1fa)],_0x210470));}catch(_0x5e6d2f){console[_0x4bc82d(0x140)](_0x4bc82d(0x209)+_0xb5e172+_0x4bc82d(0x13b)+_0x1f8396+':',_0x5e6d2f);}},_0xb5e172*_0x1ecfcb);_0x84e37c[_0x4dd76d(0x1ec)](_0x4a3ad4);}this[_0x4dd76d(0x13a)][_0x4dd76d(0x1b5)](_0x1f8396,_0x84e37c),console[_0x4dd76d(0x1be)]('✅\x20Scheduled\x20'+_0x16861f+'\x20status\x20checks\x20for\x20payment\x20'+_0x1f8396);}[a42_0x160cac(0x21a)](_0x2b7f59){const _0x47c213=a42_0x160cac,_0x4675a5=this[_0x47c213(0x13a)][_0x47c213(0x1b1)](_0x2b7f59);_0x4675a5&&(console[_0x47c213(0x1be)](_0x47c213(0x170)+_0x4675a5['length']+_0x47c213(0x13e)+_0x2b7f59),_0x4675a5[_0x47c213(0x1b8)]((_0x44359b,_0x2cabdb)=>{clearTimeout(_0x44359b);}),this[_0x47c213(0x13a)][_0x47c213(0x1de)](_0x2b7f59));}async[a42_0x160cac(0x1cd)](_0x3434fd,_0x4b28ea,_0x4922bd){const _0x4828a7=a42_0x160cac;try{const _0x5dd502=(await Promise['resolve']()[_0x4828a7(0x1c4)](()=>__importStar(require(_0x4828a7(0x17b)))))[_0x4828a7(0x1dc)],_0x550454={'status':_0x4b28ea[_0x4828a7(0x1bd)](),'updatedAt':new Date(),'statusChangedBy':_0x4828a7(0x185),'statusChangedAt':new Date()};_0x4b28ea==='PAID'&&(_0x550454[_0x4828a7(0x217)]=new Date()),_0x4922bd[_0x4828a7(0x154)]&&(_0x550454[_0x4828a7(0x12f)]=_0x4828a7(0x18d)+_0x4922bd['description']),await _0x5dd502['payment'][_0x4828a7(0x1f4)]({'where':{'id':_0x3434fd},'data':_0x550454}),console['log'](_0x4828a7(0x148)+_0x3434fd+_0x4828a7(0x143)+_0x4b28ea),await this[_0x4828a7(0x198)](_0x3434fd,_0x4b28ea);}catch(_0x2c1bb6){console[_0x4828a7(0x140)](_0x4828a7(0x195)+_0x3434fd+':',_0x2c1bb6);}}async[a42_0x160cac(0x198)](_0x2e4818,_0x43c0ea){const _0x171a3b=a42_0x160cac;try{const _0x18c9f6=(await Promise[_0x171a3b(0x142)]()[_0x171a3b(0x1c4)](()=>__importStar(require(_0x171a3b(0x17b)))))[_0x171a3b(0x1dc)],{telegramBotService:_0xa31517}=await Promise[_0x171a3b(0x142)]()[_0x171a3b(0x1c4)](()=>__importStar(require('../telegramBotService'))),_0x2cf15e=await _0x18c9f6[_0x171a3b(0x1f2)][_0x171a3b(0x1a8)]({'where':{'id':_0x2e4818},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x2cf15e)return;const _0x3663d4={'PAID':_0x171a3b(0x1ab),'FAILED':_0x171a3b(0x1c5)},_0x337b73=_0x3663d4[_0x43c0ea];_0x337b73&&await _0xa31517[_0x171a3b(0x1a2)](_0x2cf15e[_0x171a3b(0x200)],_0x2cf15e,_0x337b73),await this[_0x171a3b(0x1dd)](_0x2cf15e,_0x43c0ea);}catch(_0x1f0b63){console[_0x171a3b(0x140)](_0x171a3b(0x1a6),_0x1f0b63);}}async[a42_0x160cac(0x1dd)](_0x540968,_0x180923){const _0x13d12f=a42_0x160cac,_0x3ac55d=Date[_0x13d12f(0x145)]();try{const _0x14b4af=_0x540968[_0x13d12f(0x215)],_0x37af12=_0x14b4af['settings'];if(!_0x37af12?.[_0x13d12f(0x1a5)]){console[_0x13d12f(0x1be)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x14b4af['id']);return;}const _0x149faf=_0x180923===_0x13d12f(0x146)?_0x13d12f(0x13f):_0x13d12f(0x1f5);let _0x554e3a=[];if(_0x37af12[_0x13d12f(0x1d9)])try{_0x554e3a=Array[_0x13d12f(0x174)](_0x37af12[_0x13d12f(0x1d9)])?_0x37af12['webhookEvents']:JSON[_0x13d12f(0x192)](_0x37af12[_0x13d12f(0x1d9)]);}catch(_0x19efa4){console['error']('Error\x20parsing\x20webhook\x20events:',_0x19efa4),_0x554e3a=[];}if(!_0x554e3a['includes'](_0x149faf)){console[_0x13d12f(0x1be)](_0x13d12f(0x1cf)+_0x149faf+_0x13d12f(0x1e7)+_0x14b4af['id']);return;}const _0x4dee4b={'event':_0x149faf,'payment':{'id':_0x540968['id'],'order_id':_0x540968[_0x13d12f(0x15c)],'gateway_order_id':_0x540968[_0x13d12f(0x149)],'gateway':'1111','amount':_0x540968['amount'],'currency':_0x540968[_0x13d12f(0x18b)],'status':_0x180923[_0x13d12f(0x158)](),'customer_email':_0x540968[_0x13d12f(0x208)],'customer_name':_0x540968[_0x13d12f(0x161)],'created_at':_0x540968[_0x13d12f(0x1d0)],'updated_at':new Date()}},_0x37c9a7=await fetch(_0x37af12[_0x13d12f(0x1a5)],{'method':'POST','headers':{'Content-Type':_0x13d12f(0x153),'User-Agent':_0x13d12f(0x16e)},'body':JSON[_0x13d12f(0x1ee)](_0x4dee4b)}),_0x170a2a=Date['now']()-_0x3ac55d;loggerService_1['loggerService'][_0x13d12f(0x1ff)](_0x540968['shopId'],_0x37af12['webhookUrl'],_0x149faf,_0x37c9a7[_0x13d12f(0x1fa)],_0x170a2a,_0x4dee4b),console['log']('MasterCard\x20webhook\x20sent\x20to\x20'+_0x37af12[_0x13d12f(0x1a5)]+_0x13d12f(0x1f6)+_0x37c9a7[_0x13d12f(0x1fa)]+'\x20('+_0x170a2a+_0x13d12f(0x199));}catch(_0x10026c){console[_0x13d12f(0x140)](_0x13d12f(0x220),_0x10026c),loggerService_1[_0x13d12f(0x1d3)][_0x13d12f(0x225)](_0x540968['shopId'],_0x540968['shop']?.['settings']?.[_0x13d12f(0x1a5)]||_0x13d12f(0x14b),_0x13d12f(0x1c9),_0x10026c,{});}}[a42_0x160cac(0x1e0)](_0x1ef437){const _0x5d4ec9=a42_0x160cac,_0x16b3bd=_0x1ef437[_0x5d4ec9(0x14e)](/[\s-]/g,'');if(_0x16b3bd[_0x5d4ec9(0x141)]<0x4)return _0x5d4ec9(0x1aa);return _0x5d4ec9(0x21b)+_0x16b3bd[_0x5d4ec9(0x1f7)](-0x4);}async[a42_0x160cac(0x144)](_0x365b61){const _0x16147e=a42_0x160cac;console['log'](_0x16147e(0x20d),_0x365b61);let _0x1d036d=_0x16147e(0x176);if(_0x365b61[_0x16147e(0x1fa)]===0x1&&_0x365b61[_0x16147e(0x183)]===0x1)_0x1d036d='PAID';else _0x365b61[_0x16147e(0x1fa)]===0x0&&_0x365b61[_0x16147e(0x183)]===0x0?_0x1d036d=_0x16147e(0x176):_0x1d036d=_0x16147e(0x223);return{'paymentId':_0x365b61['order_id']||'','status':_0x1d036d,'amount':_0x365b61[_0x16147e(0x21f)],'currency':_0x365b61[_0x16147e(0x18b)]};}[a42_0x160cac(0x1a3)](){const _0x51b9c7=a42_0x160cac;console['log'](_0x51b9c7(0x1e5));const _0x53fa87=this[_0x51b9c7(0x13a)]['size'];for(const [_0x10af15]of this[_0x51b9c7(0x13a)]){this[_0x51b9c7(0x21a)](_0x10af15);}console[_0x51b9c7(0x1be)](_0x51b9c7(0x162)+_0x53fa87+'\x20MasterCard\x20status\x20check\x20timers');}}exports[a42_0x160cac(0x1d6)]=MasterCardService;