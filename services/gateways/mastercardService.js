'use strict';function a49_0x3e9a(){const _0x27bb87=['FAILED','-----END','log','\x20not\x20enabled\x20for\x20shop\x20','paymentId','findUnique','logWhiteDomainRequest','masterCardMerchantPointId','card_type','✅\x20Payment\x20','key','\x20result:','end','createSign','getOwnPropertyDescriptor',',\x20Desc:\x20','Payment\x20confirmation\x20time\x20has\x20expired','31782HRsGqK','visaPrivateKeyPath','\x20status\x20check\x20#','✅\x20Scheduled\x20','decryptResponsePhp','call','replace','❌\x20RSA\x20encryption\x20failed:',',\x20payment_id=','Payment\x20ID:','Failed\x20to\x20send\x20MasterCard\x20webhook:','stringify','Cash\x20payment\x20is\x20expected\x20at\x20TCO','\x20\x20\x20-\x20lang:\x20en','private.pem','message','****\x20****\x20****\x20','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank','Sender\x20information\x20required','shopId','\x20\x20\x20Amount:\x20','webhookUrl','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','../telegramBotService','/charge','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','length','cardType','❌\x20Status\x20check\x20#','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','✅\x20Status\x20response\x20decrypted\x20successfully','228942IblDyo','🔐\x20AES\x20key\x20and\x20IV\x20generated','from','warn','status','none','PENDING','📤\x20Sending\x20request\x20to\x20API...','Webhook\x20event\x20','Card\x20Number:','description','crypto','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','/charge_decrypt','base64','settings','Payment\x20is\x20being\x20processed','🔐\x20Data\x20encrypted\x20with\x20AES','keys','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','Payment\x20System/1.0','Status:','logWhiteDomainResponse','readFileSync','__importStar','toUpperCase','🔍\x20Using\x20provided\x20card\x20type:\x20','publicKeyPath','🔐\x20AES\x20IV\x20length:','⏰\x20Will\x20check\x20status\x20','visa_private.pem','VisaMasterCardService','configurable','❌\x20RSA\x20signing\x20failed:','visaMerchantPointId','\x20payment\x20status:\x20','\x20\x20Original:\x20\x22','Final:','Invalid\x20expiration\x20date','visaApiUrl','RSA_PKCS1_PADDING','hasOwnProperty','decryptResponse','\x20\x20\x20Currency:\x20','orderId','POST','last_name','defineProperty','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','masterCardApiUrl','psp_public.pem','\x20(from:\x20order_id=','first_name','/charge_raw','toLowerCase','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','sendPaymentNotification','maskCardNumber','update','Failed\x20payment','PIN\x20code\x20confirmation\x20awaited','getCardTypeAndApi','🔍\x20','system','parse','randomBytes','payment.success','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','apiUrl','Payment\x20pending\x20verification','get','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','\x20order_id\x20for\x20search:\x20','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','validateKeyFiles','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','📊\x20','🎯\x20Using\x20','visa/mastercard','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','Decryption\x20failed:\x20','No\x20New\x20payment','existsSync','Payment\x20returned','clearStatusTimers','3ds_url',',\x20final=','🧹\x20Clearing\x20','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','🛑\x20Stopped\x20','loggerService','statusCheckTimers','565724DWvCKb','\x20characters','encryptAES','charge','\x20status\x20timers\x20for\x20payment\x20','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','\x20\x20\x20Status:\x20','signRSA','VISA/MasterCard','ms)','4000000000000000','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','info','../../config/database','prototype','includes','visa_public.pem','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','default','HTTP\x20error!\x20status:\x20','VISA/MasterCard\x20payment\x20successful','3902095EhxCtq','trim','number','updatePaymentStatus','),\x20defaulting\x20to\x20MasterCard','checkPaymentStatus','set','encryptRSA','🔐\x20AES\x20key\x20length:','🔐\x20MasterCard\x20Private\x20key\x20length:\x20','Return\x20URL:','paidAt','/charge_decrypted','path','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','payment_id','\x20is\x20final\x20(','21CUBzuC','Error\x20details:','🔐\x20RSA\x20signing\x20successful','\x20\x20Cleaned:\x20\x20\x22','writable','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','now','LookUp\x20code\x20verified','cvv','Method\x20not\x20allowed','/status_decrypted','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','🧹\x20Card\x20holder\x20names\x20cleaned:','Error\x20parsing\x20webhook\x20events:','🔍\x20Using\x20','__importDefault','13408336gACLoK','📝\x20Decrypted\x20webhook\x20data:','📝\x20Final\x20request\x20structure:','customerName','Unsuccessful\x20payment','\x20payment:\x20','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','VISA','paymentStatuses','error','privateKeyPath','publicEncrypt','failureMessage','join','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','Payment\x20confirmation\x20required','charAt','desc','\x20payment_id\x20for\x20search:\x20','Unknown\x20error','scheduleStatusChecks','Response\x20Body:','customerEmail','/status','resolve','errorMessage','📝\x20Signature\x20length:','Client\x20OTP\x20confirmation\x20required','decryptAES','💳\x20VISA/MasterCard\x20service\x20initialized','📊\x20Status\x20check\x20#',',\x20paymentId=','https://api.paydmeth.com/api','webhookEvents','\x20with\x20status\x20','Awaiting\x20confirmation\x20by\x20ivr\x20call','sendPaymentNotifications','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','🔐\x20MasterCard\x20Public\x20key\x20path:','\x20webhook\x20extracted\x20data:','visaPublicKeyPath','Captcha\x20confirmation\x20awaited','then','****','payment','aes-256-ctr','Status\x20decryption\x20failed:\x20','\x20|\x20Response:\x20','\x20status\x20check\x20error:','PAID','__createBinding','utf8','9bxNrwo','3DS\x20verification\x20required','\x20\x20\x20Payment\x20ID:\x20','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','logWhiteDomainError','\x20\x20\x20-\x20sign\x20length:','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','Sender\x27s\x20CVV\x20card\x20is\x20required','currency','size','Insufficient\x20funds\x20on\x20the\x20card','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','-----BEGIN','📝\x20Data\x20length:','\x20for\x20payment\x20','merchantPointId','Result\x20URL:','Amount:','🔐\x203DS\x20verification\x20required','/status_raw','The\x20card\x20is\x20lost\x20or\x20stolen','3DS\x20URL:','application/json','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','createCipheriv','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','text','MASTERCARD','push','order_id','...','final','delete',':\x20Unknown\x20status\x20code','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','\x20API:\x20','toString','\x20\x20\x20-\x20info\x20length:','isFinalStatus','createdAt','Payment\x20System/1.0\x20(MasterCard)','/status_decrypt','No\x20Error\x20executing\x20request','\x20\x20\x20-\x20key\x20length:','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','json','Status\x20','\x20MasterCard\x20status\x20check\x20timers','LookUp\x20number\x20of\x20attempts\x20exceeded','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','amount','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','💾\x20Saving\x20failure\x20message:\x20','Failed\x20to\x20decrypt\x20response','===\x20PARSED\x20API\x20RESPONSE\x20===','LookUp\x20not\x20confirmed',',\x20id=','Payment\x20cancellation\x20is\x20being\x20processed','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','Card\x20Holder:','🔐\x20Data\x20signed\x20with\x20RSA','getDetailedErrorMessage','✅\x20Payment\x20successful','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','sign','950397YsDixO','\x20(from:\x20status=','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','shop','Awaiting\x20confirmation\x20in\x20the\x20application','cwd','Cancellation\x20is\x20not\x20possible','\x22\x20|\x20\x22','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','HTTP\x20','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','1111','processWebhook','sendShopWebhook',',\x20Final:\x20','✅\x20VISA\x20key\x20files\x20validated\x20successfully','Transaction\x20limit\x20exceeded','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','Failed\x20to\x20send\x20payment\x20notifications:','Response\x20Time:','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','generateAESKey','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','2266386gKWNXT','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','PHP\x20decryptor\x20error','__esModule'];a49_0x3e9a=function(){return _0x27bb87;};return a49_0x3e9a();}function a49_0x5e2c(_0x1682ff,_0x50110a){const _0x3e9aef=a49_0x3e9a();return a49_0x5e2c=function(_0x5e2c3b,_0x2e972c){_0x5e2c3b=_0x5e2c3b-0x179;let _0x5ebdf3=_0x3e9aef[_0x5e2c3b];return _0x5ebdf3;},a49_0x5e2c(_0x1682ff,_0x50110a);}const a49_0x279b59=a49_0x5e2c;(function(_0x5cd231,_0x42ada2){const _0x4296ec=a49_0x5e2c,_0x597211=_0x5cd231();while(!![]){try{const _0x575e13=-parseInt(_0x4296ec(0x1af))/0x1+-parseInt(_0x4296ec(0x1c9))/0x2+parseInt(_0x4296ec(0x1fe))/0x3+parseInt(_0x4296ec(0x25c))/0x4+parseInt(_0x4296ec(0x271))/0x5+parseInt(_0x4296ec(0x1de))/0x6*(-parseInt(_0x4296ec(0x282))/0x7)+parseInt(_0x4296ec(0x292))/0x8*(parseInt(_0x4296ec(0x2c6))/0x9);if(_0x575e13===_0x42ada2)break;else _0x597211['push'](_0x597211['shift']());}catch(_0x358e22){_0x597211['push'](_0x597211['shift']());}}}(a49_0x3e9a,0x8c505));var __createBinding=this&&this[a49_0x279b59(0x2c4)]||(Object['create']?function(_0x232502,_0x133fb3,_0xd8da64,_0x98c2d7){const _0x3b974f=a49_0x279b59;if(_0x98c2d7===undefined)_0x98c2d7=_0xd8da64;var _0x5b8083=Object[_0x3b974f(0x1db)](_0x133fb3,_0xd8da64);(!_0x5b8083||(_0x3b974f(0x244)in _0x5b8083?!_0x133fb3[_0x3b974f(0x1cc)]:_0x5b8083[_0x3b974f(0x286)]||_0x5b8083[_0x3b974f(0x21e)]))&&(_0x5b8083={'enumerable':!![],'get':function(){return _0x133fb3[_0xd8da64];}}),Object[_0x3b974f(0x22d)](_0x232502,_0x98c2d7,_0x5b8083);}:function(_0x15cb66,_0x3b2d34,_0x2d5269,_0x72aa91){if(_0x72aa91===undefined)_0x72aa91=_0x2d5269;_0x15cb66[_0x72aa91]=_0x3b2d34[_0x2d5269];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0xdf6315,_0x56414f){const _0x4ec9bd=a49_0x279b59;Object[_0x4ec9bd(0x22d)](_0xdf6315,_0x4ec9bd(0x26e),{'enumerable':!![],'value':_0x56414f});}:function(_0x1b4440,_0x53a0d3){const _0x31afe6=a49_0x279b59;_0x1b4440[_0x31afe6(0x26e)]=_0x53a0d3;}),__importStar=this&&this[a49_0x279b59(0x216)]||(function(){var _0xa73657=function(_0x332fe6){return _0xa73657=Object['getOwnPropertyNames']||function(_0x1730d4){const _0x487fed=a49_0x5e2c;var _0x5a362a=[];for(var _0x1cc386 in _0x1730d4)if(Object[_0x487fed(0x26a)][_0x487fed(0x227)][_0x487fed(0x1e3)](_0x1730d4,_0x1cc386))_0x5a362a[_0x5a362a[_0x487fed(0x1f9)]]=_0x1cc386;return _0x5a362a;},_0xa73657(_0x332fe6);};return function(_0x529bfc){const _0x5cde0b=a49_0x5e2c;if(_0x529bfc&&_0x529bfc[_0x5cde0b(0x1cc)])return _0x529bfc;var _0x4ea0cd={};if(_0x529bfc!=null){for(var _0x4e8139=_0xa73657(_0x529bfc),_0x14c983=0x0;_0x14c983<_0x4e8139[_0x5cde0b(0x1f9)];_0x14c983++)if(_0x4e8139[_0x14c983]!==_0x5cde0b(0x26e))__createBinding(_0x4ea0cd,_0x529bfc,_0x4e8139[_0x14c983]);}return __setModuleDefault(_0x4ea0cd,_0x529bfc),_0x4ea0cd;};}()),__importDefault=this&&this[a49_0x279b59(0x291)]||function(_0x537423){const _0x3c66db=a49_0x279b59;return _0x537423&&_0x537423[_0x3c66db(0x1cc)]?_0x537423:{'default':_0x537423};};Object[a49_0x279b59(0x22d)](exports,'__esModule',{'value':!![]}),exports[a49_0x279b59(0x21d)]=void 0x0;const crypto_1=__importDefault(require(a49_0x279b59(0x209))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a49_0x279b59(0x27e))),loggerService_1=require('../loggerService');class VisaMasterCardService{constructor(){const _0x27f0b6=a49_0x279b59;this[_0x27f0b6(0x25b)]=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0x27f0b6(0x251)},0x1:{'final':![],'description':_0x27f0b6(0x198)},0x2:{'final':!![],'description':'Request\x20data\x20error'},0x3:{'final':!![],'description':'Another\x20unknown\x20error'},0x4:{'final':!![],'description':_0x27f0b6(0x296)},0x5:{'final':!![],'description':_0x27f0b6(0x2cc)},0x6:{'final':!![],'description':_0x27f0b6(0x253)},0x7:{'final':!![],'description':'Test\x20payment'},0x8:{'final':![],'description':_0x27f0b6(0x2ad)},0x9:{'final':![],'description':_0x27f0b6(0x2c7)},0xa:{'final':![],'description':_0x27f0b6(0x2cd)},0xb:{'final':![],'description':_0x27f0b6(0x1f0)},0xc:{'final':![],'description':'Recipient\x20data\x20required'},0xd:{'final':![],'description':_0x27f0b6(0x1b1)},0xe:{'final':![],'description':_0x27f0b6(0x2b5)},0xf:{'final':![],'description':_0x27f0b6(0x23a)},0x10:{'final':![],'description':_0x27f0b6(0x2bb)},0x11:{'final':![],'description':_0x27f0b6(0x26d)},0x12:{'final':![],'description':_0x27f0b6(0x1b5)},0x13:{'final':![],'description':_0x27f0b6(0x20e)},0x14:{'final':![],'description':_0x27f0b6(0x298)},0x15:{'final':![],'description':'Expected\x20bitcoin\x20transfer\x20from\x20client'},0x16:{'final':![],'description':_0x27f0b6(0x243)},0x18:{'final':![],'description':_0x27f0b6(0x20a)},0x19:{'final':![],'description':'The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account'},0x1a:{'final':!![],'description':_0x27f0b6(0x1ea)},0x1b:{'final':![],'description':_0x27f0b6(0x185)},0x1c:{'final':![],'description':'Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application'},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':_0x27f0b6(0x2c9)},0x20:{'final':![],'description':'Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application'},0x23:{'final':![],'description':'Sender\x27s\x20card\x20details\x20are\x20required'},0x24:{'final':!![],'description':_0x27f0b6(0x1dd)},0x25:{'final':!![],'description':'Payment\x20prohibited'},0x26:{'final':!![],'description':_0x27f0b6(0x2a0)},0x27:{'final':!![],'description':_0x27f0b6(0x2d0)},0x28:{'final':!![],'description':'The\x20card\x20does\x20not\x20exist'},0x29:{'final':!![],'description':_0x27f0b6(0x182)},0x2a:{'final':!![],'description':_0x27f0b6(0x224)},0x2b:{'final':!![],'description':_0x27f0b6(0x1c1)},0x2c:{'final':!![],'description':_0x27f0b6(0x24a)},0x2d:{'final':!![],'description':_0x27f0b6(0x239)},0x2e:{'final':!![],'description':_0x27f0b6(0x296)},0x2f:{'final':!![],'description':_0x27f0b6(0x296)},0x30:{'final':!![],'description':_0x27f0b6(0x1f4)},0x31:{'final':![],'description':_0x27f0b6(0x2a1)},0x32:{'final':!![],'description':_0x27f0b6(0x28b)},0x33:{'final':!![],'description':_0x27f0b6(0x239)},0x34:{'final':!![],'description':_0x27f0b6(0x239)},0x35:{'final':!![],'description':_0x27f0b6(0x239)},0x36:{'final':!![],'description':_0x27f0b6(0x239)},0x37:{'final':!![],'description':_0x27f0b6(0x239)},0x38:{'final':!![],'description':_0x27f0b6(0x1b7)},0x39:{'final':![],'description':_0x27f0b6(0x1ef)},0x3a:{'final':![],'description':'LookUp\x20code\x20sent'},0x3b:{'final':!![],'description':_0x27f0b6(0x289)},0x3c:{'final':!![],'description':'Number\x20of\x20attempts\x20exceeded'},0x3d:{'final':!![],'description':_0x27f0b6(0x1ad)},0x3e:{'final':!![],'description':_0x27f0b6(0x19a)},0x3f:{'final':!![],'description':_0x27f0b6(0x253)},0x40:{'final':![],'description':_0x27f0b6(0x1a5)},0x41:{'final':!![],'description':_0x27f0b6(0x19e)},0x42:{'final':![],'description':_0x27f0b6(0x1a7)},0x43:{'final':!![],'description':_0x27f0b6(0x22e)},0x44:{'final':![],'description':'3DS\x20verification\x20required'},0x45:{'final':!![],'description':_0x27f0b6(0x239)},0x46:{'final':!![],'description':'Failed\x20payment'},0x47:{'final':!![],'description':_0x27f0b6(0x1b2)},0x64:{'final':!![],'description':'Operation\x20completed\x20successfully'}},this['masterCardApiUrl']=_0x27f0b6(0x2b2),this['masterCardMerchantPointId']=0x6e4,this['privateKeyPath']=path_1['default']['join'](process[_0x27f0b6(0x1b6)](),_0x27f0b6(0x210),_0x27f0b6(0x1ec)),this[_0x27f0b6(0x219)]=path_1['default'][_0x27f0b6(0x29f)](process[_0x27f0b6(0x1b6)](),_0x27f0b6(0x210),_0x27f0b6(0x230)),this[_0x27f0b6(0x225)]=_0x27f0b6(0x2b2),this['visaMerchantPointId']=0x6b7,this['visaPrivateKeyPath']=path_1['default'][_0x27f0b6(0x29f)](process[_0x27f0b6(0x1b6)](),_0x27f0b6(0x210),_0x27f0b6(0x21c)),this[_0x27f0b6(0x2ba)]=path_1['default'][_0x27f0b6(0x29f)](process['cwd'](),_0x27f0b6(0x210),_0x27f0b6(0x26c)),console[_0x27f0b6(0x1cf)](_0x27f0b6(0x2af)),console[_0x27f0b6(0x1cf)]('🔐\x20MasterCard\x20API\x20URL:',this['masterCardApiUrl']),console[_0x27f0b6(0x1cf)]('🔐\x20VISA\x20API\x20URL:',this['visaApiUrl']),console['log']('🔐\x20MasterCard\x20Private\x20key\x20path:',this[_0x27f0b6(0x29c)]),console[_0x27f0b6(0x1cf)](_0x27f0b6(0x2b8),this[_0x27f0b6(0x219)]),console[_0x27f0b6(0x1cf)]('🔐\x20VISA\x20Private\x20key\x20path:',this[_0x27f0b6(0x1df)]),console[_0x27f0b6(0x1cf)]('🔐\x20VISA\x20Public\x20key\x20path:',this['visaPublicKeyPath']),this[_0x27f0b6(0x249)]();}[a49_0x279b59(0x1ab)](_0x587389,_0x11354d){const _0x2a68a3=a49_0x279b59,_0x2353a3=this[_0x2a68a3(0x29a)][_0x587389];let _0x362683='';_0x2353a3?_0x362683='Status\x20'+_0x587389+':\x20'+_0x2353a3['description']:_0x362683=_0x2a68a3(0x19c)+_0x587389+_0x2a68a3(0x18f);if(_0x11354d&&_0x11354d['trim']()){const _0x2ba992=_0x11354d[_0x2a68a3(0x272)]();(!_0x2353a3||_0x2ba992[_0x2a68a3(0x234)]()!==_0x2353a3[_0x2a68a3(0x208)][_0x2a68a3(0x234)]())&&(_0x362683+=_0x2a68a3(0x2c1)+_0x2ba992);}return _0x362683;}[a49_0x279b59(0x194)](_0x568440){const _0x140869=a49_0x279b59,_0x1bd8a2=this[_0x140869(0x29a)][_0x568440];return _0x1bd8a2?_0x1bd8a2['final']:!![];}[a49_0x279b59(0x23b)](_0x1c33a5){const _0x5e1373=a49_0x279b59,_0x1a8654=_0x1c33a5[_0x5e1373(0x2a2)](0x0);if(_0x1a8654==='4')return console['log']('💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)'),{'cardType':_0x5e1373(0x299),'apiUrl':this[_0x5e1373(0x225)],'privateKeyPath':this[_0x5e1373(0x1df)],'publicKeyPath':this[_0x5e1373(0x2ba)],'merchantPointId':this[_0x5e1373(0x220)]};else return _0x1a8654==='5'?(console[_0x5e1373(0x1cf)](_0x5e1373(0x28d)),{'cardType':_0x5e1373(0x189),'apiUrl':this[_0x5e1373(0x22f)],'privateKeyPath':this[_0x5e1373(0x29c)],'publicKeyPath':this[_0x5e1373(0x219)],'merchantPointId':this['masterCardMerchantPointId']}):(console[_0x5e1373(0x1cf)]('💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20'+_0x1a8654+_0x5e1373(0x275)),{'cardType':_0x5e1373(0x189),'apiUrl':this[_0x5e1373(0x22f)],'privateKeyPath':this[_0x5e1373(0x29c)],'publicKeyPath':this[_0x5e1373(0x219)],'merchantPointId':this[_0x5e1373(0x1d4)]});}[a49_0x279b59(0x249)](){const _0x569d99=a49_0x279b59;try{if(!fs_1[_0x569d99(0x26e)][_0x569d99(0x252)](this[_0x569d99(0x29c)]))throw new Error('MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20'+this[_0x569d99(0x29c)]);if(!fs_1[_0x569d99(0x26e)]['existsSync'](this[_0x569d99(0x219)]))throw new Error(_0x569d99(0x1ca)+this[_0x569d99(0x219)]);const _0x131ef1=fs_1[_0x569d99(0x26e)][_0x569d99(0x215)](this[_0x569d99(0x29c)],'utf8')[_0x569d99(0x272)](),_0x551fb8=fs_1[_0x569d99(0x26e)]['readFileSync'](this['publicKeyPath'],_0x569d99(0x2c5))['trim']();if(!_0x131ef1[_0x569d99(0x26b)]('-----BEGIN')||!_0x131ef1['includes'](_0x569d99(0x1ce)))throw new Error(_0x569d99(0x1c5));if(!_0x551fb8[_0x569d99(0x26b)](_0x569d99(0x17a))||!_0x551fb8[_0x569d99(0x26b)](_0x569d99(0x1ce)))throw new Error(_0x569d99(0x1b3));console['log'](_0x569d99(0x235)),console[_0x569d99(0x1cf)](_0x569d99(0x27a)+_0x131ef1[_0x569d99(0x1f9)]+'\x20characters'),console[_0x569d99(0x1cf)]('🔐\x20MasterCard\x20Public\x20key\x20length:\x20'+_0x551fb8[_0x569d99(0x1f9)]+_0x569d99(0x25d));if(fs_1[_0x569d99(0x26e)][_0x569d99(0x252)](this[_0x569d99(0x1df)])&&fs_1[_0x569d99(0x26e)][_0x569d99(0x252)](this[_0x569d99(0x2ba)])){const _0x227f5c=fs_1[_0x569d99(0x26e)][_0x569d99(0x215)](this['visaPrivateKeyPath'],'utf8')['trim'](),_0xb0c42d=fs_1[_0x569d99(0x26e)][_0x569d99(0x215)](this['visaPublicKeyPath'],_0x569d99(0x2c5))['trim']();(!_0x227f5c[_0x569d99(0x26b)](_0x569d99(0x17a))||!_0x227f5c['includes'](_0x569d99(0x1ce)))&&console['warn'](_0x569d99(0x19f)),(!_0xb0c42d[_0x569d99(0x26b)](_0x569d99(0x17a))||!_0xb0c42d[_0x569d99(0x26b)](_0x569d99(0x1ce)))&&console[_0x569d99(0x201)](_0x569d99(0x246)),console[_0x569d99(0x1cf)](_0x569d99(0x1c0)),console['log']('🔐\x20VISA\x20Private\x20key\x20length:\x20'+_0x227f5c[_0x569d99(0x1f9)]+_0x569d99(0x25d)),console[_0x569d99(0x1cf)]('🔐\x20VISA\x20Public\x20key\x20length:\x20'+_0xb0c42d[_0x569d99(0x1f9)]+_0x569d99(0x25d));}else console['warn'](_0x569d99(0x190)),console[_0x569d99(0x201)](_0x569d99(0x241)+this[_0x569d99(0x1df)]),console[_0x569d99(0x201)](_0x569d99(0x258)+this[_0x569d99(0x2ba)]);}catch(_0x4e0a42){console[_0x569d99(0x29b)](_0x569d99(0x1a8),_0x4e0a42);throw _0x4e0a42;}}[a49_0x279b59(0x1c6)](){const _0x6e888e=a49_0x279b59,_0x297b11=crypto_1[_0x6e888e(0x26e)][_0x6e888e(0x23f)](0x20),_0x3e6f71=crypto_1['default'][_0x6e888e(0x23f)](0x10);return{'key':_0x297b11,'iv':_0x3e6f71};}[a49_0x279b59(0x25e)](_0x279d01,_0x3185b5,_0x47f06e){const _0x59e09e=a49_0x279b59,_0x3ce744=crypto_1['default'][_0x59e09e(0x186)](_0x59e09e(0x2bf),_0x3185b5,_0x47f06e);let _0x3fbd7e=_0x3ce744[_0x59e09e(0x238)](_0x279d01,_0x59e09e(0x2c5),'base64');return _0x3fbd7e+=_0x3ce744[_0x59e09e(0x18d)](_0x59e09e(0x20c)),_0x3fbd7e;}['encryptRSA'](_0x304b69,_0xc099f8,_0x5c04cb){const _0x148ed3=a49_0x279b59;try{const _0x1ef889=fs_1[_0x148ed3(0x26e)]['readFileSync'](_0x5c04cb,_0x148ed3(0x2c5))[_0x148ed3(0x272)](),_0x55942d={'iv':_0xc099f8[_0x148ed3(0x192)](_0x148ed3(0x20c)),'key':_0x304b69[_0x148ed3(0x192)](_0x148ed3(0x20c))},_0x37613e=JSON['stringify'](_0x55942d);console[_0x148ed3(0x1cf)](_0x148ed3(0x267),_0x37613e[_0x148ed3(0x1f9)]);const _0xec3927=crypto_1['default'][_0x148ed3(0x29d)]({'key':_0x1ef889,'padding':crypto_1[_0x148ed3(0x26e)]['constants'][_0x148ed3(0x226)]},Buffer[_0x148ed3(0x200)](_0x37613e));return console['log'](_0x148ed3(0x261),_0xec3927[_0x148ed3(0x1f9)]),_0xec3927['toString'](_0x148ed3(0x20c));}catch(_0x27cf6b){console['error'](_0x148ed3(0x1e5),_0x27cf6b);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}['signRSA'](_0x14cfcb,_0x335135){const _0x5815bb=a49_0x279b59;try{const _0x3c2586=fs_1[_0x5815bb(0x26e)][_0x5815bb(0x215)](_0x335135,_0x5815bb(0x2c5))[_0x5815bb(0x272)](),_0x1bc41f=crypto_1[_0x5815bb(0x26e)][_0x5815bb(0x1da)]('SHA256');_0x1bc41f['update'](_0x14cfcb),_0x1bc41f[_0x5815bb(0x1d9)]();const _0x1f2265=_0x1bc41f[_0x5815bb(0x1ae)](_0x3c2586,_0x5815bb(0x20c));return console['log'](_0x5815bb(0x284)),console[_0x5815bb(0x1cf)]('📝\x20Data\x20to\x20sign\x20length:',_0x14cfcb[_0x5815bb(0x1f9)]),console[_0x5815bb(0x1cf)]('📝\x20Signature\x20length:',_0x1f2265[_0x5815bb(0x1f9)]),_0x1f2265;}catch(_0x6eb065){console[_0x5815bb(0x29b)](_0x5815bb(0x21f),_0x6eb065),console[_0x5815bb(0x29b)]('❌\x20Data\x20being\x20signed:',_0x14cfcb['substring'](0x0,0xc8)+_0x5815bb(0x18c));throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}[a49_0x279b59(0x2ae)](_0x39a24f,_0xe996a6,_0x484fb6){const _0x303ead=a49_0x279b59,_0x27f21e=crypto_1[_0x303ead(0x26e)]['createDecipheriv'](_0x303ead(0x2bf),_0xe996a6,_0x484fb6);let _0x1ec4f6=_0x27f21e[_0x303ead(0x238)](_0x39a24f,_0x303ead(0x20c),_0x303ead(0x2c5));return _0x1ec4f6+=_0x27f21e[_0x303ead(0x18d)]('utf8'),_0x1ec4f6;}async['decryptResponsePhp'](_0x212762,_0x29ff48,_0x20095f=a49_0x279b59(0x189)){const _0x2a1a80=a49_0x279b59;try{const _0x46e158=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x2a1a80(0x22b),'headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'info':_0x212762,'key':_0x29ff48,'card_type':_0x20095f[_0x2a1a80(0x234)]()})});if(!_0x46e158['ok'])throw new Error(_0x2a1a80(0x1cb));return await _0x46e158[_0x2a1a80(0x188)]();}catch(_0x217e24){console[_0x2a1a80(0x29b)]('❌\x20PHP\x20decryptor\x20request\x20failed:',_0x217e24);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a49_0x279b59(0x228)](_0xee873b,_0x2d378b){const _0xebe9d=a49_0x279b59;try{const _0x1c7382=fs_1['default'][_0xebe9d(0x215)](this['privateKeyPath'],_0xebe9d(0x2c5))['trim'](),_0x3dbda7=crypto_1['default']['privateDecrypt'](_0x1c7382,Buffer[_0xebe9d(0x200)](_0x2d378b,'base64')),_0x4eaf3a=JSON[_0xebe9d(0x23e)](_0x3dbda7[_0xebe9d(0x192)]()),_0x9c791b=Buffer[_0xebe9d(0x200)](_0x4eaf3a[_0xebe9d(0x1d7)],_0xebe9d(0x20c)),_0x28542d=Buffer['from'](_0x4eaf3a['iv'],_0xebe9d(0x20c));return this[_0xebe9d(0x2ae)](_0xee873b,_0x9c791b,_0x28542d);}catch(_0x516101){throw new Error(_0xebe9d(0x1a3));}}async['processCardPayment'](_0x3cf67b){const _0x59a482=a49_0x279b59,{paymentId:_0x15b429,orderId:_0x4ed945,amount:_0x24348a,currency:_0x146e4d,cardData:_0x2ccdf2,resultUrl:_0x2553ae,returnUrl:_0x2aeaa4,cardHolder:_0x15fc3c,browser:_0x536e41}=_0x3cf67b;console['log']('===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console['log']('Payment\x20ID:',_0x15b429),console[_0x59a482(0x1cf)]('Order\x20ID:',_0x4ed945),console[_0x59a482(0x1cf)](_0x59a482(0x17f),_0x24348a,_0x146e4d),console[_0x59a482(0x1cf)](_0x59a482(0x207),this[_0x59a482(0x237)](_0x2ccdf2['number'])),console[_0x59a482(0x1cf)](_0x59a482(0x1a9),_0x15fc3c['first_name']+'\x20'+_0x15fc3c[_0x59a482(0x22c)]),console['log'](_0x59a482(0x27b),_0x2aeaa4),console['log'](_0x59a482(0x17e),_0x2553ae);const _0x3067d6=this['getCardTypeAndApi'](_0x2ccdf2[_0x59a482(0x273)]);console[_0x59a482(0x1cf)](_0x59a482(0x24d)+_0x3067d6[_0x59a482(0x1fa)]+_0x59a482(0x191)+_0x3067d6['apiUrl']),console[_0x59a482(0x1cf)]('🔐\x20Using\x20keys:\x20'+_0x3067d6[_0x59a482(0x29c)]+',\x20'+_0x3067d6[_0x59a482(0x219)]);const _0x56564e={..._0x15fc3c,'first_name':_0x15fc3c[_0x59a482(0x232)]?.[_0x59a482(0x1e4)](/[\t\n\r\f\v]/g,'\x20')['trim']()||'','last_name':_0x15fc3c[_0x59a482(0x22c)]?.[_0x59a482(0x1e4)](/[\t\n\r\f\v]/g,'\x20')['trim']()||''};console['log'](_0x59a482(0x28e)),console[_0x59a482(0x1cf)](_0x59a482(0x222)+_0x15fc3c[_0x59a482(0x232)]+_0x59a482(0x1b8)+_0x15fc3c[_0x59a482(0x22c)]+'\x22'),console[_0x59a482(0x1cf)](_0x59a482(0x285)+_0x56564e[_0x59a482(0x232)]+_0x59a482(0x1b8)+_0x56564e[_0x59a482(0x22c)]+'\x22');const _0x35b892={'amount':_0x24348a,'currency':_0x146e4d['toUpperCase'](),'order_id':_0x4ed945,'result_url':_0x2553ae,'return_url':_0x2aeaa4,'country':'','card':{'number':_0x2ccdf2[_0x59a482(0x273)],'expire_month':_0x2ccdf2['expire_month'],'expire_year':_0x2ccdf2['expire_year'],'cvv':_0x2ccdf2[_0x59a482(0x28a)]},'card_holder':_0x56564e,'browser':_0x536e41},_0x38ab1f=JSON[_0x59a482(0x1e9)](_0x35b892);console[_0x59a482(0x1cf)]('💾\x20Payment\x20data\x20prepared'),console[_0x59a482(0x1cf)](_0x59a482(0x1a1)),console[_0x59a482(0x1cf)](_0x38ab1f),console[_0x59a482(0x1cf)](_0x59a482(0x17b),_0x38ab1f[_0x59a482(0x1f9)]);try{const {key:_0x467066,iv:_0x3ab59b}=this[_0x59a482(0x1c6)]();console[_0x59a482(0x1cf)](_0x59a482(0x1ff)),console['log'](_0x59a482(0x279),_0x467066[_0x59a482(0x1f9)]),console[_0x59a482(0x1cf)](_0x59a482(0x21a),_0x3ab59b[_0x59a482(0x1f9)]);const _0x1c4e90=this['encryptAES'](_0x38ab1f,_0x467066,_0x3ab59b);console[_0x59a482(0x1cf)](_0x59a482(0x20f)),console['log']('📝\x20Encrypted\x20data\x20length:',_0x1c4e90[_0x59a482(0x1f9)]);const _0x3f37cc=this[_0x59a482(0x278)](_0x467066,_0x3ab59b,_0x3067d6[_0x59a482(0x219)]);console[_0x59a482(0x1cf)]('🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x59a482(0x1cf)]('📝\x20Encrypted\x20key\x20length:',_0x3f37cc[_0x59a482(0x1f9)]);const _0x511cc0=this[_0x59a482(0x263)](_0x38ab1f,_0x3067d6[_0x59a482(0x29c)]);console[_0x59a482(0x1cf)](_0x59a482(0x1aa)),console[_0x59a482(0x1cf)](_0x59a482(0x2ac),_0x511cc0[_0x59a482(0x1f9)]);const _0xb13efd={'merchant_point_id':_0x3067d6[_0x59a482(0x17d)],'method':_0x59a482(0x25f),'info':_0x1c4e90,'key':_0x3f37cc,'sign':_0x511cc0,'lang':'en'};console[_0x59a482(0x1cf)](_0x59a482(0x205)),console[_0x59a482(0x1cf)](_0x59a482(0x294)),console[_0x59a482(0x1cf)]('\x20\x20\x20-\x20merchant_point_id:',_0x3067d6[_0x59a482(0x17d)]),console[_0x59a482(0x1cf)]('\x20\x20\x20-\x20method:\x20charge'),console['log'](_0x59a482(0x193),_0x1c4e90[_0x59a482(0x1f9)]),console[_0x59a482(0x1cf)](_0x59a482(0x199),_0x3f37cc['length']),console[_0x59a482(0x1cf)](_0x59a482(0x2cb),_0x511cc0[_0x59a482(0x1f9)]),console[_0x59a482(0x1cf)](_0x59a482(0x1eb)),loggerService_1[_0x59a482(0x25a)][_0x59a482(0x1d3)](_0x3067d6[_0x59a482(0x1fa)][_0x59a482(0x234)](),_0x59a482(0x1f6),_0x59a482(0x22b),{'merchant_point_id':_0x3067d6['merchantPointId'],'method':_0x59a482(0x25f),'lang':'en'});const _0x44f4bc=Date[_0x59a482(0x288)](),_0xbdaf82=await fetch(_0x3067d6['apiUrl'],{'method':_0x59a482(0x22b),'headers':{'Content-Type':_0x59a482(0x184),'Accept':_0x59a482(0x184),'User-Agent':_0x59a482(0x212)},'body':JSON[_0x59a482(0x1e9)](_0xb13efd)}),_0x35aad2=Date[_0x59a482(0x288)]()-_0x44f4bc;console[_0x59a482(0x1cf)]('===\x20API\x20RESPONSE\x20==='),console[_0x59a482(0x1cf)](_0x59a482(0x213),_0xbdaf82['status']),console[_0x59a482(0x1cf)](_0x59a482(0x1c4),_0x35aad2+'ms');if(!_0xbdaf82['ok']){const _0xc85e70=await _0xbdaf82[_0x59a482(0x188)]();console[_0x59a482(0x29b)]('HTTP\x20Status:',_0xbdaf82['status']),console[_0x59a482(0x29b)](_0x59a482(0x2a7),_0xc85e70),loggerService_1[_0x59a482(0x25a)][_0x59a482(0x214)](_0x3067d6[_0x59a482(0x1fa)][_0x59a482(0x234)](),_0x59a482(0x233),_0xbdaf82[_0x59a482(0x202)],_0xc85e70,_0x35aad2),loggerService_1[_0x59a482(0x25a)][_0x59a482(0x2ca)](_0x3067d6[_0x59a482(0x1fa)]['toLowerCase'](),_0x59a482(0x1f6),_0x59a482(0x1ba)+_0xbdaf82['status']+':\x20'+_0xc85e70);throw new Error('HTTP\x20error!\x20status:\x20'+_0xbdaf82['status']+',\x20body:\x20'+_0xc85e70);}const _0x36cdc8=await _0xbdaf82['json']();loggerService_1[_0x59a482(0x25a)][_0x59a482(0x214)](_0x3067d6[_0x59a482(0x1fa)]['toLowerCase'](),'/charge_raw',_0xbdaf82['status'],_0x36cdc8,_0x35aad2),console[_0x59a482(0x1cf)](_0x59a482(0x1a4));let _0x22f644=_0x36cdc8;if(_0x36cdc8[_0x59a482(0x268)]&&_0x36cdc8[_0x59a482(0x1d7)]&&_0x36cdc8[_0x59a482(0x1ae)]){console['log'](_0x59a482(0x1b9));try{const _0x2fcfed=await this['decryptResponsePhp'](_0x36cdc8[_0x59a482(0x268)],_0x36cdc8[_0x59a482(0x1d7)],_0x3067d6[_0x59a482(0x1fa)]);_0x22f644=JSON[_0x59a482(0x23e)](_0x2fcfed),console[_0x59a482(0x1cf)](_0x59a482(0x179)),loggerService_1[_0x59a482(0x25a)][_0x59a482(0x214)](_0x3067d6['cardType']['toLowerCase'](),_0x59a482(0x27d),_0xbdaf82[_0x59a482(0x202)],_0x22f644,_0x35aad2),console[_0x59a482(0x1cf)]('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x3e6f98){console[_0x59a482(0x29b)](_0x59a482(0x1c2),_0x3e6f98),loggerService_1[_0x59a482(0x25a)][_0x59a482(0x2ca)](_0x3067d6[_0x59a482(0x1fa)][_0x59a482(0x234)](),_0x59a482(0x20b),_0x59a482(0x250)+_0x3e6f98),_0x22f644=_0x36cdc8;}}else loggerService_1[_0x59a482(0x25a)][_0x59a482(0x214)](_0x3067d6[_0x59a482(0x1fa)]['toLowerCase'](),_0x59a482(0x27d),_0xbdaf82['status'],_0x22f644,_0x35aad2),console[_0x59a482(0x1cf)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x59a482(0x1cf)](_0x59a482(0x213),_0x22f644[_0x59a482(0x202)]),console['log'](_0x59a482(0x223),_0x22f644['final']),console[_0x59a482(0x1cf)](_0x59a482(0x1e7),_0x22f644['payment_id']),console[_0x59a482(0x1cf)](_0x59a482(0x183),_0x22f644[_0x59a482(0x255)]||_0x59a482(0x203));if(_0x22f644[_0x59a482(0x202)]===0x64&&_0x22f644[_0x59a482(0x18d)]===0x1)return console[_0x59a482(0x1cf)](_0x59a482(0x1ac)),{'gateway_payment_id':_0x22f644[_0x59a482(0x280)]?.['toString'](),'payment_url':_0x2aeaa4,'requires_3ds':![],'status':_0x59a482(0x2c3),'final':!![]};if(_0x22f644[_0x59a482(0x255)])return console['log'](_0x59a482(0x180)),this[_0x59a482(0x2a6)](_0x15b429,_0x4ed945,_0x22f644['payment_id']?.[_0x59a482(0x192)]()||_0x4ed945,_0x3067d6[_0x59a482(0x1fa)]),{'gateway_payment_id':_0x22f644[_0x59a482(0x280)]?.['toString'](),'payment_url':_0x22f644['3ds_url'],'requires_3ds':!![],'threeds_url':_0x22f644[_0x59a482(0x255)],'status':_0x59a482(0x204),'final':![]};let _0x5218e2=this['getDetailedErrorMessage'](_0x22f644[_0x59a482(0x202)],_0x22f644[_0x59a482(0x2a3)]||_0x22f644[_0x59a482(0x1ed)]),_0x37d34b=_0x22f644[_0x59a482(0x202)],_0x43c812=this[_0x59a482(0x194)](_0x22f644[_0x59a482(0x202)]);return console[_0x59a482(0x1cf)](_0x59a482(0x1c7)+_0x37d34b+_0x59a482(0x1bf)+_0x43c812+_0x59a482(0x1dc)+_0x5218e2),{'gateway_payment_id':_0x22f644[_0x59a482(0x280)]?.[_0x59a482(0x192)](),'payment_url':_0x2aeaa4,'requires_3ds':![],'status':_0x59a482(0x1cd),'final':!![],'errorMessage':_0x5218e2};}catch(_0x4ea12c){console[_0x59a482(0x29b)](_0x59a482(0x211)),console[_0x59a482(0x29b)](_0x59a482(0x283),_0x4ea12c),loggerService_1[_0x59a482(0x25a)][_0x59a482(0x2ca)](_0x59a482(0x24e),_0x59a482(0x1f6),_0x4ea12c);throw new Error(_0x59a482(0x24f)+(_0x4ea12c instanceof Error?_0x4ea12c[_0x59a482(0x1ed)]:_0x59a482(0x2a5)));}}async[a49_0x279b59(0x276)](_0x40ab65,_0x661eee,_0x4245f2=a49_0x279b59(0x299)){const _0x5e6340=a49_0x279b59;console[_0x5e6340(0x1cf)]('📊\x20Checking\x20'+_0x4245f2+_0x5e6340(0x221)+_0x40ab65+'\x20('+_0x661eee+')');try{const _0x36d015={'payment_id':_0x40ab65,'order_id':_0x661eee},_0x2c1a28=JSON[_0x5e6340(0x1e9)](_0x36d015),_0x3702d0=this['getCardTypeAndApi'](_0x4245f2==='VISA'?_0x5e6340(0x266):'5000000000000000'),{key:_0x1eb26a,iv:_0x2c4bc0}=this['generateAESKey'](),_0xf2ccdf=this[_0x5e6340(0x25e)](_0x2c1a28,_0x1eb26a,_0x2c4bc0),_0x5c58a3=this[_0x5e6340(0x278)](_0x1eb26a,_0x2c4bc0,_0x3702d0['publicKeyPath']),_0x4af453=this[_0x5e6340(0x263)](_0x2c1a28,_0x3702d0[_0x5e6340(0x29c)]),_0x29123e={'merchant_point_id':_0x3702d0[_0x5e6340(0x17d)],'method':_0x5e6340(0x202),'info':_0xf2ccdf,'key':_0x5c58a3,'sign':_0x4af453,'lang':'en'};loggerService_1[_0x5e6340(0x25a)][_0x5e6340(0x1d3)](_0x4245f2[_0x5e6340(0x234)](),_0x5e6340(0x2a9),'POST',{'merchant_point_id':_0x3702d0[_0x5e6340(0x17d)],'method':'status','lang':'en'});const _0x4e90ca=Date[_0x5e6340(0x288)](),_0x170567=await fetch(_0x3702d0[_0x5e6340(0x242)],{'method':_0x5e6340(0x22b),'headers':{'Content-Type':_0x5e6340(0x184),'Accept':_0x5e6340(0x184),'User-Agent':_0x5e6340(0x212)},'body':JSON['stringify'](_0x29123e)}),_0x384ac0=Date[_0x5e6340(0x288)]()-_0x4e90ca;if(!_0x170567['ok']){const _0x24155c=await _0x170567['text']();loggerService_1[_0x5e6340(0x25a)][_0x5e6340(0x214)](_0x4245f2[_0x5e6340(0x234)](),'/status_raw',_0x170567['status'],_0x24155c,_0x384ac0);throw new Error(_0x5e6340(0x26f)+_0x170567[_0x5e6340(0x202)]);}const _0x3aaa99=await _0x170567[_0x5e6340(0x19b)]();loggerService_1[_0x5e6340(0x25a)][_0x5e6340(0x214)](_0x4245f2['toLowerCase'](),_0x5e6340(0x181),_0x170567[_0x5e6340(0x202)],_0x3aaa99,_0x384ac0);let _0x4562d0=_0x3aaa99;if(_0x3aaa99[_0x5e6340(0x268)]&&_0x3aaa99['key']&&_0x3aaa99[_0x5e6340(0x1ae)]){console[_0x5e6340(0x1cf)](_0x5e6340(0x248));try{const _0x2d4ee1=await this[_0x5e6340(0x1e2)](_0x3aaa99[_0x5e6340(0x268)],_0x3aaa99[_0x5e6340(0x1d7)],_0x4245f2);_0x4562d0=JSON[_0x5e6340(0x23e)](_0x2d4ee1),console['log'](_0x5e6340(0x1fd)),loggerService_1[_0x5e6340(0x25a)][_0x5e6340(0x214)](_0x4245f2[_0x5e6340(0x234)](),'/status_decrypted',_0x170567[_0x5e6340(0x202)],_0x4562d0,_0x384ac0),console[_0x5e6340(0x1cf)](_0x5e6340(0x1fc));}catch(_0x1dc43f){console['error']('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x1dc43f),loggerService_1[_0x5e6340(0x25a)][_0x5e6340(0x2ca)](_0x4245f2[_0x5e6340(0x234)](),_0x5e6340(0x197),_0x5e6340(0x2c0)+_0x1dc43f),_0x4562d0=_0x3aaa99;}}else loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4245f2[_0x5e6340(0x234)](),_0x5e6340(0x28c),_0x170567[_0x5e6340(0x202)],_0x4562d0,_0x384ac0),console[_0x5e6340(0x1cf)](_0x5e6340(0x27f));console[_0x5e6340(0x1cf)]('📊\x20Status\x20check\x20result:',{'status':_0x4562d0['status'],'final':_0x4562d0['final'],'payment_id':_0x4562d0[_0x5e6340(0x280)],'desc':_0x4562d0[_0x5e6340(0x2a3)]});let _0x17ac2f=_0x5e6340(0x204);if(_0x4562d0[_0x5e6340(0x202)]===0x64&&_0x4562d0[_0x5e6340(0x18d)]===0x1)_0x17ac2f='PAID';else{if(_0x4562d0[_0x5e6340(0x18d)]===0x0||!this[_0x5e6340(0x194)](_0x4562d0['status']))_0x17ac2f='PENDING';else _0x4562d0[_0x5e6340(0x18d)]===0x1||this['isFinalStatus'](_0x4562d0[_0x5e6340(0x202)])?_0x17ac2f=_0x5e6340(0x1cd):_0x17ac2f=_0x5e6340(0x204);}const _0x38a99f=this[_0x5e6340(0x1ab)](_0x4562d0[_0x5e6340(0x202)],_0x4562d0[_0x5e6340(0x2a3)]);return{'status':_0x17ac2f,'final':this[_0x5e6340(0x194)](_0x4562d0[_0x5e6340(0x202)]),'amount':_0x4562d0[_0x5e6340(0x1a0)],'currency':_0x4562d0[_0x5e6340(0x2ce)],'date_success':_0x4562d0['date_success'],'description':_0x38a99f};}catch(_0x5b74d6){console[_0x5e6340(0x29b)](_0x4245f2+_0x5e6340(0x2c2),_0x5b74d6),loggerService_1[_0x5e6340(0x25a)][_0x5e6340(0x2ca)](_0x4245f2['toLowerCase'](),_0x5e6340(0x2a9),_0x5b74d6);throw new Error('Failed\x20to\x20check\x20'+_0x4245f2+'\x20payment\x20status:\x20'+(_0x5b74d6 instanceof Error?_0x5b74d6[_0x5e6340(0x1ed)]:_0x5e6340(0x2a5)));}}[a49_0x279b59(0x2a6)](_0x61bccf,_0x155b25,_0x2a1a07,_0x34cbf7){const _0x3270d9=a49_0x279b59;console[_0x3270d9(0x1cf)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20'+_0x34cbf7+_0x3270d9(0x297)+_0x61bccf+'\x20('+_0x2a1a07+')'),this[_0x3270d9(0x254)](_0x61bccf);const _0x134b9a=[],_0xd42eeb=0x5*0x3c*0x3e8,_0x1b389f=0x2*0x3c*0x3c*0x3e8,_0x172a54=Math['floor'](_0x1b389f/_0xd42eeb);console[_0x3270d9(0x1cf)](_0x3270d9(0x21b)+_0x172a54+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x44275b=0x1;_0x44275b<=_0x172a54;_0x44275b++){const _0x45bfec=setTimeout(async()=>{const _0x7366c8=_0x3270d9;console[_0x7366c8(0x1cf)](_0x7366c8(0x23c)+_0x34cbf7+_0x7366c8(0x1e0)+_0x44275b+'/'+_0x172a54+_0x7366c8(0x17c)+_0x61bccf);try{const _0x3c74a8=await this['checkPaymentStatus'](_0x2a1a07,_0x155b25,_0x34cbf7);console[_0x7366c8(0x1cf)](_0x7366c8(0x2b0)+_0x44275b+_0x7366c8(0x1d8),_0x3c74a8),_0x3c74a8[_0x7366c8(0x18d)]&&(console[_0x7366c8(0x1cf)](_0x7366c8(0x1d6)+_0x61bccf+_0x7366c8(0x281)+_0x3c74a8['status']+'),\x20stopping\x20status\x20checks'),this[_0x7366c8(0x254)](_0x61bccf),await this['updatePaymentStatus'](_0x61bccf,_0x3c74a8['status'],_0x3c74a8));}catch(_0x1c6467){console[_0x7366c8(0x29b)](_0x7366c8(0x1fb)+_0x44275b+'\x20failed\x20for\x20payment\x20'+_0x61bccf+':',_0x1c6467);}},_0x44275b*_0xd42eeb);_0x134b9a[_0x3270d9(0x18a)](_0x45bfec);}this['statusCheckTimers'][_0x3270d9(0x277)](_0x61bccf,_0x134b9a),console[_0x3270d9(0x1cf)](_0x3270d9(0x1e1)+_0x172a54+'\x20status\x20checks\x20for\x20payment\x20'+_0x61bccf);}[a49_0x279b59(0x254)](_0x30e53f){const _0x1bf988=a49_0x279b59,_0x2e5f2c=this[_0x1bf988(0x25b)][_0x1bf988(0x244)](_0x30e53f);_0x2e5f2c&&(console[_0x1bf988(0x1cf)](_0x1bf988(0x257)+_0x2e5f2c['length']+_0x1bf988(0x260)+_0x30e53f),_0x2e5f2c['forEach']((_0x351a46,_0xb7eda2)=>{clearTimeout(_0x351a46);}),this[_0x1bf988(0x25b)][_0x1bf988(0x18e)](_0x30e53f));}async[a49_0x279b59(0x274)](_0xbb92a0,_0x3d41da,_0x584793){const _0x20da6d=a49_0x279b59;try{const _0x5bf044=(await Promise['resolve']()['then'](()=>__importStar(require(_0x20da6d(0x269)))))[_0x20da6d(0x26e)],_0x5d3afb={'status':_0x3d41da['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x20da6d(0x23d),'statusChangedAt':new Date()};_0x3d41da==='PAID'&&(_0x5d3afb[_0x20da6d(0x27c)]=new Date()),_0x3d41da===_0x20da6d(0x1cd)&&_0x584793[_0x20da6d(0x208)]&&(_0x5d3afb[_0x20da6d(0x29e)]=_0x584793[_0x20da6d(0x208)],console[_0x20da6d(0x1cf)](_0x20da6d(0x1a2)+_0x584793['description'])),_0x584793[_0x20da6d(0x208)]&&(_0x5d3afb['adminNotes']=(_0x3d41da===_0x20da6d(0x2c3)?_0x20da6d(0x270):_0x20da6d(0x264))+':\x20'+_0x584793[_0x20da6d(0x208)]),await _0x5bf044['payment'][_0x20da6d(0x238)]({'where':{'id':_0xbb92a0},'data':_0x5d3afb}),console[_0x20da6d(0x1cf)](_0x20da6d(0x1d6)+_0xbb92a0+'\x20status\x20updated\x20to\x20'+_0x3d41da),await this[_0x20da6d(0x2b6)](_0xbb92a0,_0x3d41da);}catch(_0x4e8b2f){console[_0x20da6d(0x29b)](_0x20da6d(0x245)+_0xbb92a0+':',_0x4e8b2f);}}async[a49_0x279b59(0x2b6)](_0x227627,_0x286295){const _0x32f0f0=a49_0x279b59;try{const _0x4af2ae=(await Promise[_0x32f0f0(0x2aa)]()[_0x32f0f0(0x2bc)](()=>__importStar(require('../../config/database'))))[_0x32f0f0(0x26e)],{telegramBotService:_0x4e24b6}=await Promise[_0x32f0f0(0x2aa)]()[_0x32f0f0(0x2bc)](()=>__importStar(require(_0x32f0f0(0x1f5)))),_0x1df1e7=await _0x4af2ae[_0x32f0f0(0x2be)][_0x32f0f0(0x1d2)]({'where':{'id':_0x227627},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x1df1e7)return;const _0x50bd7b={'PAID':'paid','FAILED':'failed'},_0x4511e9=_0x50bd7b[_0x286295];_0x4511e9&&await _0x4e24b6[_0x32f0f0(0x236)](_0x1df1e7[_0x32f0f0(0x1f1)],_0x1df1e7,_0x4511e9),await this[_0x32f0f0(0x1be)](_0x1df1e7,_0x286295);}catch(_0x38afea){console[_0x32f0f0(0x29b)](_0x32f0f0(0x1c3),_0x38afea);}}async[a49_0x279b59(0x1be)](_0x4b9ad5,_0x5026c1){const _0x2704cc=a49_0x279b59,_0x5ac00d=Date[_0x2704cc(0x288)]();try{const _0x39ae14=_0x4b9ad5[_0x2704cc(0x1b4)],_0x1afd69=_0x39ae14[_0x2704cc(0x20d)];if(!_0x1afd69?.[_0x2704cc(0x1f3)]){console['log'](_0x2704cc(0x1f8)+_0x39ae14['id']);return;}const _0xbe8468=_0x5026c1==='PAID'?_0x2704cc(0x240):'payment.failed';let _0x392181=[];if(_0x1afd69[_0x2704cc(0x2b3)])try{_0x392181=Array['isArray'](_0x1afd69[_0x2704cc(0x2b3)])?_0x1afd69[_0x2704cc(0x2b3)]:JSON[_0x2704cc(0x23e)](_0x1afd69[_0x2704cc(0x2b3)]);}catch(_0x138b05){console['error'](_0x2704cc(0x28f),_0x138b05),_0x392181=[];}if(!_0x392181[_0x2704cc(0x26b)](_0xbe8468)){console[_0x2704cc(0x1cf)](_0x2704cc(0x206)+_0xbe8468+_0x2704cc(0x1d0)+_0x39ae14['id']);return;}const _0x2cd875={'event':_0xbe8468,'payment':{'id':_0x4b9ad5['id'],'order_id':_0x4b9ad5['orderId'],'gateway_order_id':_0x4b9ad5['gatewayOrderId'],'gateway':_0x2704cc(0x1bc),'amount':_0x4b9ad5[_0x2704cc(0x1a0)],'currency':_0x4b9ad5['currency'],'status':_0x5026c1[_0x2704cc(0x234)](),'customer_email':_0x4b9ad5[_0x2704cc(0x2a8)],'customer_name':_0x4b9ad5[_0x2704cc(0x295)],'created_at':_0x4b9ad5[_0x2704cc(0x195)],'updated_at':new Date()}},_0x42afdb=await fetch(_0x1afd69[_0x2704cc(0x1f3)],{'method':_0x2704cc(0x22b),'headers':{'Content-Type':_0x2704cc(0x184),'User-Agent':_0x2704cc(0x196)},'body':JSON[_0x2704cc(0x1e9)](_0x2cd875)}),_0x1ee4d5=Date[_0x2704cc(0x288)]()-_0x5ac00d;loggerService_1[_0x2704cc(0x25a)]['logShopWebhookSent'](_0x4b9ad5[_0x2704cc(0x1f1)],_0x1afd69[_0x2704cc(0x1f3)],_0xbe8468,_0x42afdb['status'],_0x1ee4d5,_0x2cd875),console[_0x2704cc(0x1cf)]('MasterCard\x20webhook\x20sent\x20to\x20'+_0x1afd69['webhookUrl']+_0x2704cc(0x2b4)+_0x42afdb[_0x2704cc(0x202)]+'\x20('+_0x1ee4d5+_0x2704cc(0x265));}catch(_0xd64070){console[_0x2704cc(0x29b)](_0x2704cc(0x1e8),_0xd64070),loggerService_1[_0x2704cc(0x25a)]['logShopWebhookError'](_0x4b9ad5[_0x2704cc(0x1f1)],_0x4b9ad5[_0x2704cc(0x1b4)]?.[_0x2704cc(0x20d)]?.['webhookUrl']||'unknown','webhook_send',_0xd64070,{});}}[a49_0x279b59(0x237)](_0x58f8ea){const _0x4394c2=a49_0x279b59,_0x4a8239=_0x58f8ea[_0x4394c2(0x1e4)](/[\s-]/g,'');if(_0x4a8239[_0x4394c2(0x1f9)]<0x4)return _0x4394c2(0x2bd);return _0x4394c2(0x1ee)+_0x4a8239['slice'](-0x4);}async[a49_0x279b59(0x1bd)](_0x3be9ac,_0x24b4af=a49_0x279b59(0x189)){const _0x2d1c14=a49_0x279b59;console[_0x2d1c14(0x1cf)](_0x2d1c14(0x1c8),JSON[_0x2d1c14(0x1e9)](_0x3be9ac,null,0x2));let _0x1ffdae=_0x3be9ac,_0x40b21a=_0x24b4af;_0x3be9ac[_0x2d1c14(0x1d5)]?(_0x40b21a=_0x3be9ac[_0x2d1c14(0x1d5)][_0x2d1c14(0x217)]()===_0x2d1c14(0x299)?_0x2d1c14(0x299):_0x2d1c14(0x189),console[_0x2d1c14(0x1cf)](_0x2d1c14(0x1bb)+_0x40b21a)):console['log'](_0x2d1c14(0x218)+_0x40b21a);if(_0x3be9ac[_0x2d1c14(0x268)]&&_0x3be9ac[_0x2d1c14(0x1d7)]&&_0x3be9ac[_0x2d1c14(0x1ae)]){console['log'](_0x2d1c14(0x1f7));try{const _0x4bff27=await this[_0x2d1c14(0x1e2)](_0x3be9ac['info'],_0x3be9ac[_0x2d1c14(0x1d7)],_0x40b21a);_0x1ffdae=JSON[_0x2d1c14(0x23e)](_0x4bff27),console[_0x2d1c14(0x1cf)]('✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP'),console[_0x2d1c14(0x1cf)](_0x2d1c14(0x293),JSON['stringify'](_0x1ffdae,null,0x2));}catch(_0x1af163){console['error'](_0x2d1c14(0x287),_0x1af163),console[_0x2d1c14(0x1cf)](_0x2d1c14(0x187)),_0x1ffdae=_0x3be9ac;}}else console['log']('📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is');let _0x186d76=_0x2d1c14(0x204);if(_0x1ffdae['status']===0x64&&_0x1ffdae[_0x2d1c14(0x18d)]===0x1)_0x186d76=_0x2d1c14(0x2c3);else{if(_0x1ffdae[_0x2d1c14(0x18d)]===0x0||!this[_0x2d1c14(0x194)](_0x1ffdae[_0x2d1c14(0x202)]))_0x186d76=_0x2d1c14(0x204);else _0x1ffdae['final']===0x1||this[_0x2d1c14(0x194)](_0x1ffdae['status'])?_0x186d76=_0x2d1c14(0x1cd):_0x186d76=_0x2d1c14(0x204);}let _0x321556='';if(_0x1ffdae[_0x2d1c14(0x18b)])_0x321556=_0x1ffdae[_0x2d1c14(0x18b)][_0x2d1c14(0x192)](),console[_0x2d1c14(0x1cf)](_0x2d1c14(0x290)+_0x40b21a+_0x2d1c14(0x247)+_0x321556);else _0x1ffdae[_0x2d1c14(0x280)]?(_0x321556=_0x1ffdae['payment_id']['toString'](),console[_0x2d1c14(0x1cf)]('🔍\x20Using\x20'+_0x40b21a+_0x2d1c14(0x2a4)+_0x321556)):(_0x321556=_0x1ffdae[_0x2d1c14(0x22a)]||_0x1ffdae['paymentId']||_0x1ffdae['id']||'',console[_0x2d1c14(0x1cf)](_0x2d1c14(0x24b)+_0x321556));console['log'](_0x2d1c14(0x24c)+_0x40b21a+_0x2d1c14(0x2b9)),console[_0x2d1c14(0x1cf)](_0x2d1c14(0x2c8)+_0x321556+_0x2d1c14(0x231)+_0x1ffdae[_0x2d1c14(0x18b)]+',\x20orderId='+_0x1ffdae['orderId']+_0x2d1c14(0x1e6)+_0x1ffdae[_0x2d1c14(0x280)]+_0x2d1c14(0x2b1)+_0x1ffdae[_0x2d1c14(0x1d1)]+_0x2d1c14(0x1a6)+_0x1ffdae['id']+')'),console[_0x2d1c14(0x1cf)](_0x2d1c14(0x262)+_0x186d76+_0x2d1c14(0x1b0)+_0x1ffdae['status']+_0x2d1c14(0x256)+_0x1ffdae[_0x2d1c14(0x18d)]+')'),console['log'](_0x2d1c14(0x1f2)+_0x1ffdae[_0x2d1c14(0x1a0)]),console[_0x2d1c14(0x1cf)](_0x2d1c14(0x229)+_0x1ffdae[_0x2d1c14(0x2ce)]);let _0x3cb1fa;_0x186d76===_0x2d1c14(0x1cd)&&(_0x3cb1fa=this[_0x2d1c14(0x1ab)](_0x1ffdae['status'],_0x1ffdae['desc']),console[_0x2d1c14(0x1cf)]('❌\x20Detailed\x20failure\x20description:\x20'+_0x3cb1fa));const _0x1c9f49={'paymentId':_0x321556,'status':_0x186d76,'amount':_0x1ffdae[_0x2d1c14(0x1a0)],'currency':_0x1ffdae[_0x2d1c14(0x2ce)]};return _0x3cb1fa&&(_0x1c9f49[_0x2d1c14(0x2ab)]=_0x3cb1fa),_0x1c9f49;}['stopAllStatusChecks'](){const _0x3973b5=a49_0x279b59;console[_0x3973b5(0x1cf)](_0x3973b5(0x2b7));const _0x5ece33=this['statusCheckTimers'][_0x3973b5(0x2cf)];for(const [_0x2c4df8]of this[_0x3973b5(0x25b)]){this[_0x3973b5(0x254)](_0x2c4df8);}console['log'](_0x3973b5(0x259)+_0x5ece33+_0x3973b5(0x19d));}}exports[a49_0x279b59(0x21d)]=VisaMasterCardService;