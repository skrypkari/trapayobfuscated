'use strict';const a42_0x409b9a=a42_0x797b;function a42_0x797b(_0x246f01,_0x4959fd){const _0x48e984=a42_0x48e9();return a42_0x797b=function(_0x797b7a,_0x2e8055){_0x797b7a=_0x797b7a-0xbd;let _0x198e45=_0x48e984[_0x797b7a];return _0x198e45;},a42_0x797b(_0x246f01,_0x4959fd);}(function(_0x65392f,_0x5d5389){const _0x176a2c=a42_0x797b,_0x3340ad=_0x65392f();while(!![]){try{const _0x5c2df7=parseInt(_0x176a2c(0xdf))/0x1*(parseInt(_0x176a2c(0x190))/0x2)+parseInt(_0x176a2c(0x107))/0x3*(parseInt(_0x176a2c(0x1a2))/0x4)+-parseInt(_0x176a2c(0x160))/0x5*(-parseInt(_0x176a2c(0x171))/0x6)+-parseInt(_0x176a2c(0x185))/0x7+parseInt(_0x176a2c(0x128))/0x8*(parseInt(_0x176a2c(0x129))/0x9)+parseInt(_0x176a2c(0x135))/0xa+-parseInt(_0x176a2c(0xe3))/0xb;if(_0x5c2df7===_0x5d5389)break;else _0x3340ad['push'](_0x3340ad['shift']());}catch(_0x502897){_0x3340ad['push'](_0x3340ad['shift']());}}}(a42_0x48e9,0xd0d3e));var __createBinding=this&&this['__createBinding']||(Object[a42_0x409b9a(0xee)]?function(_0x46e9c2,_0x428ea7,_0x135d04,_0x255171){const _0x167abb=a42_0x409b9a;if(_0x255171===undefined)_0x255171=_0x135d04;var _0x1dc4d3=Object['getOwnPropertyDescriptor'](_0x428ea7,_0x135d04);(!_0x1dc4d3||(_0x167abb(0x15d)in _0x1dc4d3?!_0x428ea7['__esModule']:_0x1dc4d3[_0x167abb(0xe2)]||_0x1dc4d3['configurable']))&&(_0x1dc4d3={'enumerable':!![],'get':function(){return _0x428ea7[_0x135d04];}}),Object[_0x167abb(0xf0)](_0x46e9c2,_0x255171,_0x1dc4d3);}:function(_0x26746d,_0x19dc86,_0x85cacf,_0x4a5da7){if(_0x4a5da7===undefined)_0x4a5da7=_0x85cacf;_0x26746d[_0x4a5da7]=_0x19dc86[_0x85cacf];}),__setModuleDefault=this&&this[a42_0x409b9a(0xd2)]||(Object[a42_0x409b9a(0xee)]?function(_0x151482,_0x578969){const _0x1c8527=a42_0x409b9a;Object[_0x1c8527(0xf0)](_0x151482,_0x1c8527(0x11d),{'enumerable':!![],'value':_0x578969});}:function(_0x218ef6,_0x507ff9){const _0xc8d791=a42_0x409b9a;_0x218ef6[_0xc8d791(0x11d)]=_0x507ff9;}),__importStar=this&&this[a42_0x409b9a(0x148)]||(function(){var _0x113138=function(_0x26cf24){const _0x1d00e7=a42_0x797b;return _0x113138=Object[_0x1d00e7(0xce)]||function(_0x25499c){const _0x5a5435=_0x1d00e7;var _0x3d0bd9=[];for(var _0x32d60a in _0x25499c)if(Object[_0x5a5435(0xd8)][_0x5a5435(0x142)][_0x5a5435(0xe1)](_0x25499c,_0x32d60a))_0x3d0bd9[_0x3d0bd9[_0x5a5435(0x18a)]]=_0x32d60a;return _0x3d0bd9;},_0x113138(_0x26cf24);};return function(_0x173898){const _0x42e436=a42_0x797b;if(_0x173898&&_0x173898[_0x42e436(0x151)])return _0x173898;var _0x9e958e={};if(_0x173898!=null){for(var _0x224ac0=_0x113138(_0x173898),_0x3f0b6b=0x0;_0x3f0b6b<_0x224ac0[_0x42e436(0x18a)];_0x3f0b6b++)if(_0x224ac0[_0x3f0b6b]!==_0x42e436(0x11d))__createBinding(_0x9e958e,_0x173898,_0x224ac0[_0x3f0b6b]);}return __setModuleDefault(_0x9e958e,_0x173898),_0x9e958e;};}()),__importDefault=this&&this[a42_0x409b9a(0xfc)]||function(_0x13ef09){const _0x2de1e5=a42_0x409b9a;return _0x13ef09&&_0x13ef09[_0x2de1e5(0x151)]?_0x13ef09:{'default':_0x13ef09};};function a42_0x48e9(){const _0x140868=['Failed\x20to\x20send\x20MasterCard\x20webhook:','existsSync','create','last_name','defineProperty','randomBytes','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','\x20\x20\x20-\x20method:\x20charge','webhookEvents','unknown','POST','delete','scheduleStatusChecks','failed','sign','Card\x20Holder:','__importDefault','❌\x20PHP\x20decryptor\x20request\x20failed:','toLowerCase','/charge','📊\x20Status\x20check\x20result:','replace','logShopWebhookSent','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','maskCardNumber','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','Response\x20Body:','3288hLHpYK','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','❌\x20Data\x20being\x20signed:','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','clearStatusTimers','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','📊\x20Status\x20check\x20#','RSA_PKCS1_PADDING','⏰\x20Will\x20check\x20status\x20','\x20characters','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','text','Return\x20URL:','🔐\x20Data\x20signed\x20with\x20RSA','size','payment.success','🔐\x203DS\x20verification\x20required','aes-256-ctr','charge','shopId','🔐\x20Public\x20key\x20length:\x20','message','default','customerEmail','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','validateKeyFiles','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','json','📝\x20Encrypted\x20key\x20length:','1111','🔐\x20AES\x20IV\x20length:','keys','🔐\x20AES\x20key\x20and\x20IV\x20generated','4472UipEuQ','5931aHRqqj','expire_month','\x20not\x20enabled\x20for\x20shop\x20','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','\x20status\x20timers\x20for\x20payment\x20','stringify','HTTP\x20error!\x20status:\x20','❌\x20Status\x20check\x20#','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','signRSA','TesSoft\x20Payment\x20System/1.0','readFileSync','13452230iGMQMG','Response\x20Time:','encryptRSA','payment_id','../../config/database','✅\x20Payment\x20successful','****\x20****\x20****\x20','📝\x20Signature\x20length:','loggerService','webhookUrl','\x20with\x20status\x20','publicEncrypt','PAID','hasOwnProperty','slice','PHP\x20decryptor\x20error','\x20for\x20payment\x20','/status_raw','update','__importStar','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','system','encryptAES','),\x20stopping\x20status\x20checks','parse','✅\x20Payment\x20','sendPaymentNotifications','__esModule','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','Error\x20details:','📝\x20Final\x20request\x20structure:','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','-----BEGIN','💳\x20MasterCard\x20service\x20initialized','merchantPointId','substring','base64','ms)','from','get','Payment\x20ID:','MasterCard:\x20','87740gWayEg','updatePaymentStatus','FAILED','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','log','📝\x20Data\x20to\x20sign\x20length:','final','currency','logWhiteDomainRequest','toUpperCase','Result\x20URL:','description','resolve','/charge_decrypt','psp_public.pem','Status\x20decryption\x20failed:\x20','privateKeyPath','42XZNQDI','path','HTTP\x20Status:','checkPaymentStatus','\x20failed\x20for\x20payment\x20','customerName','publicKeyPath','private.pem','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','cwd','crypto','mastercard','🔐\x20Private\x20key\x20length:\x20','settings','\x20\x20\x20-\x20lang:\x20en','❌\x20MasterCard\x20key\x20validation\x20failed:','/status','status','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','Error\x20parsing\x20webhook\x20events:','1052681mTtfiN','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','🔐\x20Private\x20key\x20path:','Failed\x20to\x20send\x20payment\x20notifications:','length','decryptResponsePhp','privateDecrypt','application/json','logWhiteDomainError','\x20\x20\x20-\x20key\x20length:','3280826PbUpUS','statusCheckTimers','SHA256','none','-----END','Amount:','gatewayOrderId','decryptResponse','apiUrl','✅\x20Scheduled\x20','join','push',',\x20body:\x20','/charge_decrypted','🛑\x20Stopped\x20','\x20is\x20final\x20(','logWhiteDomainResponse','/status_decrypted','2476aSUQfH','trim',',\x20Final:\x20','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','adminNotes','error','🔐\x20Data\x20encrypted\x20with\x20AES','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','Processing\x20MasterCard\x20webhook:','\x20status\x20updated\x20to\x20','payment',',\x20Desc:\x20','Order\x20ID:','payment.failed','includes','Unknown\x20error','decryptAES','===\x20MASTERCARD\x20SERVICE\x20ERROR\x20===','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','generateAESKey','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','🔐\x20Public\x20key\x20path:','Card\x20Number:','paidAt','https://api.paydmeth.com/api','key','shop','\x20MasterCard\x20status\x20check\x20timers','webhook_send','🔐\x20AES\x20key\x20length:','stopAllStatusChecks','getOwnPropertyNames','desc','number','🔍\x20MasterCard\x20status\x20check\x20#','__setModuleDefault','❌\x20RSA\x20encryption\x20failed:','now','3ds_url','constants','PENDING','prototype','then','🔐\x20RSA\x20signing\x20successful','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','utf8','Decryption\x20failed:\x20','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','1rDGnSM','🧹\x20Clearing\x20','call','writable','34644896wqsmIE','sendShopWebhook','amount','toString','📝\x20Data\x20length:','set','MasterCardService','info','createdAt'];a42_0x48e9=function(){return _0x140868;};return a42_0x48e9();}Object[a42_0x409b9a(0xf0)](exports,a42_0x409b9a(0x151),{'value':!![]}),exports['MasterCardService']=void 0x0;const crypto_1=__importDefault(require(a42_0x409b9a(0x17b))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x409b9a(0x172))),loggerService_1=require('../loggerService');class MasterCardService{constructor(){const _0x2da77f=a42_0x409b9a;this[_0x2da77f(0x191)]=new Map(),this['apiUrl']=_0x2da77f(0xc7),this[_0x2da77f(0x158)]=0x67c,this[_0x2da77f(0x170)]=path_1[_0x2da77f(0x11d)][_0x2da77f(0x19a)](process[_0x2da77f(0x17a)](),_0x2da77f(0x126),_0x2da77f(0x178)),this[_0x2da77f(0x177)]=path_1[_0x2da77f(0x11d)][_0x2da77f(0x19a)](process[_0x2da77f(0x17a)](),_0x2da77f(0x126),_0x2da77f(0x16e)),console[_0x2da77f(0x164)](_0x2da77f(0x157)),console['log'](_0x2da77f(0x188),this[_0x2da77f(0x170)]),console[_0x2da77f(0x164)](_0x2da77f(0xc4),this[_0x2da77f(0x177)]),this[_0x2da77f(0x120)]();}[a42_0x409b9a(0x120)](){const _0x379195=a42_0x409b9a;try{if(!fs_1[_0x379195(0x11d)][_0x379195(0xed)](this[_0x379195(0x170)]))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this[_0x379195(0x170)]);if(!fs_1['default'][_0x379195(0xed)](this[_0x379195(0x177)]))throw new Error('Public\x20key\x20file\x20not\x20found:\x20'+this[_0x379195(0x177)]);const _0x46a146=fs_1['default']['readFileSync'](this[_0x379195(0x170)],_0x379195(0xdc))['trim'](),_0xd54a19=fs_1['default'][_0x379195(0x134)](this[_0x379195(0x177)],_0x379195(0xdc))[_0x379195(0x1a3)]();if(!_0x46a146[_0x379195(0xbd)](_0x379195(0x156))||!_0x46a146['includes'](_0x379195(0x194)))throw new Error(_0x379195(0x163));if(!_0xd54a19[_0x379195(0xbd)]('-----BEGIN')||!_0xd54a19[_0x379195(0xbd)](_0x379195(0x194)))throw new Error(_0x379195(0xc1));console['log'](_0x379195(0x111)),console[_0x379195(0x164)](_0x379195(0x17d)+_0x46a146[_0x379195(0x18a)]+_0x379195(0x110)),console['log'](_0x379195(0x11b)+_0xd54a19[_0x379195(0x18a)]+_0x379195(0x110));}catch(_0x5e6b5c){console[_0x379195(0x1a7)](_0x379195(0x180),_0x5e6b5c);throw _0x5e6b5c;}}[a42_0x409b9a(0xc2)](){const _0x1dd6a6=a42_0x409b9a,_0x2b5ab9=crypto_1[_0x1dd6a6(0x11d)][_0x1dd6a6(0xf1)](0x20),_0x4c5384=crypto_1[_0x1dd6a6(0x11d)][_0x1dd6a6(0xf1)](0x10);return{'key':_0x2b5ab9,'iv':_0x4c5384};}['encryptAES'](_0x48843b,_0x36e746,_0x1208a1){const _0x1be62d=a42_0x409b9a,_0x5ccc64=crypto_1['default']['createCipheriv'](_0x1be62d(0x118),_0x36e746,_0x1208a1);let _0x2925f3=_0x5ccc64[_0x1be62d(0x147)](_0x48843b,_0x1be62d(0xdc),_0x1be62d(0x15a));return _0x2925f3+=_0x5ccc64[_0x1be62d(0x166)]('base64'),_0x2925f3;}['encryptRSA'](_0xbc3049,_0x4280f1){const _0x17e855=a42_0x409b9a;try{const _0x5bba88=fs_1['default'][_0x17e855(0x134)](this[_0x17e855(0x177)],_0x17e855(0xdc))[_0x17e855(0x1a3)](),_0x457ada={'iv':_0x4280f1[_0x17e855(0xe6)]('base64'),'key':_0xbc3049[_0x17e855(0xe6)]('base64')},_0x168905=JSON[_0x17e855(0x12e)](_0x457ada);console[_0x17e855(0x164)](_0x17e855(0x149),_0x168905[_0x17e855(0x18a)]);const _0x799218=crypto_1['default'][_0x17e855(0x140)]({'key':_0x5bba88,'padding':crypto_1[_0x17e855(0x11d)][_0x17e855(0xd6)][_0x17e855(0x10e)]},Buffer[_0x17e855(0x15c)](_0x168905));return console[_0x17e855(0x164)](_0x17e855(0x1a5),_0x799218[_0x17e855(0x18a)]),_0x799218[_0x17e855(0xe6)](_0x17e855(0x15a));}catch(_0x2569b9){console[_0x17e855(0x1a7)](_0x17e855(0xd3),_0x2569b9);throw new Error('Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key');}}[a42_0x409b9a(0x132)](_0xc04ad0){const _0x11cfc0=a42_0x409b9a;try{const _0x170400=fs_1[_0x11cfc0(0x11d)][_0x11cfc0(0x134)](this[_0x11cfc0(0x170)],_0x11cfc0(0xdc))[_0x11cfc0(0x1a3)](),_0x502c6c=crypto_1[_0x11cfc0(0x11d)]['createSign'](_0x11cfc0(0x192));_0x502c6c[_0x11cfc0(0x147)](_0xc04ad0),_0x502c6c['end']();const _0x43c89e=_0x502c6c[_0x11cfc0(0xfa)](_0x170400,'base64');return console[_0x11cfc0(0x164)](_0x11cfc0(0xda)),console[_0x11cfc0(0x164)](_0x11cfc0(0x165),_0xc04ad0[_0x11cfc0(0x18a)]),console[_0x11cfc0(0x164)](_0x11cfc0(0x13c),_0x43c89e[_0x11cfc0(0x18a)]),_0x43c89e;}catch(_0x39342b){console[_0x11cfc0(0x1a7)]('❌\x20RSA\x20signing\x20failed:',_0x39342b),console[_0x11cfc0(0x1a7)](_0x11cfc0(0x109),_0xc04ad0[_0x11cfc0(0x159)](0x0,0xc8)+'...');throw new Error(_0x11cfc0(0x108));}}['decryptAES'](_0x16628a,_0x4ec1c1,_0x331494){const _0x41f3ea=a42_0x409b9a,_0x5cd0c7=crypto_1[_0x41f3ea(0x11d)]['createDecipheriv'](_0x41f3ea(0x118),_0x4ec1c1,_0x331494);let _0x4f5d9c=_0x5cd0c7[_0x41f3ea(0x147)](_0x16628a,_0x41f3ea(0x15a),_0x41f3ea(0xdc));return _0x4f5d9c+=_0x5cd0c7[_0x41f3ea(0x166)](_0x41f3ea(0xdc)),_0x4f5d9c;}async[a42_0x409b9a(0x18b)](_0xa1ac6,_0x36dec0){const _0x4f6a90=a42_0x409b9a;try{const _0x316963=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x4f6a90(0xf6),'headers':{'Content-Type':_0x4f6a90(0x18d)},'body':JSON[_0x4f6a90(0x12e)]({'info':_0xa1ac6,'key':_0x36dec0})});if(!_0x316963['ok'])throw new Error(_0x4f6a90(0x144));return await _0x316963[_0x4f6a90(0x112)]();}catch(_0xf55825){console[_0x4f6a90(0x1a7)](_0x4f6a90(0xfd),_0xf55825);throw new Error(_0x4f6a90(0x186));}}[a42_0x409b9a(0x197)](_0x1dd11e,_0x216566){const _0x433cea=a42_0x409b9a;try{const _0x168572=fs_1['default'][_0x433cea(0x134)](this['privateKeyPath'],_0x433cea(0xdc))['trim'](),_0x1c0cef=crypto_1['default'][_0x433cea(0x18c)](_0x168572,Buffer[_0x433cea(0x15c)](_0x216566,_0x433cea(0x15a))),_0x11ea02=JSON[_0x433cea(0x14e)](_0x1c0cef[_0x433cea(0xe6)]()),_0x25dffe=Buffer[_0x433cea(0x15c)](_0x11ea02[_0x433cea(0xc8)],_0x433cea(0x15a)),_0x915b95=Buffer[_0x433cea(0x15c)](_0x11ea02['iv'],_0x433cea(0x15a));return this[_0x433cea(0xbf)](_0x1dd11e,_0x25dffe,_0x915b95);}catch(_0x5cf8c8){throw new Error('Failed\x20to\x20decrypt\x20response');}}async['processCardPayment'](_0x3314d1){const _0x2e24f7=a42_0x409b9a,{paymentId:_0x43a46e,orderId:_0x5c7259,amount:_0x2a135b,currency:_0x4d902c,cardData:_0x5ef7f7,resultUrl:_0x9defa4,returnUrl:_0x5a10d3,cardHolder:_0x5e7cb4,browser:_0x337966}=_0x3314d1;console[_0x2e24f7(0x164)](_0x2e24f7(0x187)),console[_0x2e24f7(0x164)]('Payment\x20ID:',_0x43a46e),console[_0x2e24f7(0x164)](_0x2e24f7(0x1af),_0x5c7259),console[_0x2e24f7(0x164)](_0x2e24f7(0x195),_0x2a135b,_0x4d902c),console[_0x2e24f7(0x164)](_0x2e24f7(0xc5),this['maskCardNumber'](_0x5ef7f7[_0x2e24f7(0xd0)])),console[_0x2e24f7(0x164)](_0x2e24f7(0xfb),_0x5e7cb4['first_name']+'\x20'+_0x5e7cb4[_0x2e24f7(0xef)]),console['log'](_0x2e24f7(0x113),_0x5a10d3),console[_0x2e24f7(0x164)](_0x2e24f7(0x16a),_0x9defa4);const _0x123b47={'amount':_0x2a135b,'currency':_0x4d902c[_0x2e24f7(0x169)](),'order_id':_0x5c7259,'result_url':_0x9defa4,'return_url':_0x5a10d3,'card':{'number':_0x5ef7f7[_0x2e24f7(0xd0)],'expire_month':_0x5ef7f7[_0x2e24f7(0x12a)],'expire_year':_0x5ef7f7['expire_year'],'cvv':_0x5ef7f7['cvv']},'card_holder':_0x5e7cb4,'browser':_0x337966},_0x389116=JSON[_0x2e24f7(0x12e)](_0x123b47);console[_0x2e24f7(0x164)]('💾\x20Payment\x20data\x20prepared'),console['log'](_0x2e24f7(0xde)),console[_0x2e24f7(0x164)](_0x389116),console[_0x2e24f7(0x164)](_0x2e24f7(0xe7),_0x389116[_0x2e24f7(0x18a)]);try{const {key:_0x463d80,iv:_0x444d10}=this[_0x2e24f7(0xc2)]();console[_0x2e24f7(0x164)](_0x2e24f7(0x127)),console[_0x2e24f7(0x164)](_0x2e24f7(0xcc),_0x463d80['length']),console[_0x2e24f7(0x164)](_0x2e24f7(0x125),_0x444d10[_0x2e24f7(0x18a)]);const _0x2ef30f=this['encryptAES'](_0x389116,_0x463d80,_0x444d10);console['log'](_0x2e24f7(0x1a8)),console['log']('📝\x20Encrypted\x20data\x20length:',_0x2ef30f['length']);const _0x13e603=this['encryptRSA'](_0x463d80,_0x444d10);console[_0x2e24f7(0x164)](_0x2e24f7(0x155)),console['log'](_0x2e24f7(0x123),_0x13e603[_0x2e24f7(0x18a)]);const _0x6196ea=this['signRSA'](_0x389116);console[_0x2e24f7(0x164)](_0x2e24f7(0x114)),console[_0x2e24f7(0x164)](_0x2e24f7(0x13c),_0x6196ea[_0x2e24f7(0x18a)]);const _0x271d17={'merchant_point_id':this[_0x2e24f7(0x158)],'method':_0x2e24f7(0x119),'info':_0x2ef30f,'key':_0x13e603,'sign':_0x6196ea,'lang':'en'};console[_0x2e24f7(0x164)](_0x2e24f7(0x131)),console[_0x2e24f7(0x164)](_0x2e24f7(0x154)),console[_0x2e24f7(0x164)]('\x20\x20\x20-\x20merchant_point_id:',this[_0x2e24f7(0x158)]),console['log'](_0x2e24f7(0xf3)),console[_0x2e24f7(0x164)]('\x20\x20\x20-\x20info\x20length:',_0x2ef30f['length']),console[_0x2e24f7(0x164)](_0x2e24f7(0x18f),_0x13e603[_0x2e24f7(0x18a)]),console[_0x2e24f7(0x164)]('\x20\x20\x20-\x20sign\x20length:',_0x6196ea[_0x2e24f7(0x18a)]),console[_0x2e24f7(0x164)](_0x2e24f7(0x17f)),loggerService_1[_0x2e24f7(0x13d)][_0x2e24f7(0x168)](_0x2e24f7(0x17c),'/charge',_0x2e24f7(0xf6),{'merchant_point_id':this['merchantPointId'],'method':_0x2e24f7(0x119),'lang':'en'});const _0x10f044=Date[_0x2e24f7(0xd4)](),_0x5c4c57=await fetch(this[_0x2e24f7(0x198)],{'method':'POST','headers':{'Content-Type':_0x2e24f7(0x18d),'Accept':_0x2e24f7(0x18d),'User-Agent':_0x2e24f7(0x133)},'body':JSON[_0x2e24f7(0x12e)](_0x271d17)}),_0x943809=Date['now']()-_0x10f044;console[_0x2e24f7(0x164)](_0x2e24f7(0x1a9)),console[_0x2e24f7(0x164)]('Status:',_0x5c4c57[_0x2e24f7(0x182)]),console['log'](_0x2e24f7(0x136),_0x943809+'ms');if(!_0x5c4c57['ok']){const _0x1afd0e=await _0x5c4c57['text']();console[_0x2e24f7(0x1a7)](_0x2e24f7(0x173),_0x5c4c57[_0x2e24f7(0x182)]),console[_0x2e24f7(0x1a7)](_0x2e24f7(0x106),_0x1afd0e),loggerService_1[_0x2e24f7(0x13d)][_0x2e24f7(0x1a0)](_0x2e24f7(0x17c),'/charge_raw',_0x5c4c57[_0x2e24f7(0x182)],_0x1afd0e,_0x943809),loggerService_1[_0x2e24f7(0x13d)]['logWhiteDomainError'](_0x2e24f7(0x17c),_0x2e24f7(0xff),'HTTP\x20'+_0x5c4c57[_0x2e24f7(0x182)]+':\x20'+_0x1afd0e);throw new Error(_0x2e24f7(0x12f)+_0x5c4c57[_0x2e24f7(0x182)]+_0x2e24f7(0x19c)+_0x1afd0e);}const _0x6b1fa8=await _0x5c4c57[_0x2e24f7(0x122)]();loggerService_1[_0x2e24f7(0x13d)]['logWhiteDomainResponse']('mastercard','/charge_raw',_0x5c4c57[_0x2e24f7(0x182)],_0x6b1fa8,_0x943809),console['log'](_0x2e24f7(0x12c));let _0x388ca7=_0x6b1fa8;if(_0x6b1fa8[_0x2e24f7(0xea)]&&_0x6b1fa8[_0x2e24f7(0xc8)]&&_0x6b1fa8[_0x2e24f7(0xfa)]){console[_0x2e24f7(0x164)]('🔐\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0xde7dd9=await this['decryptResponsePhp'](_0x6b1fa8['info'],_0x6b1fa8[_0x2e24f7(0xc8)]);_0x388ca7=JSON['parse'](_0xde7dd9),console[_0x2e24f7(0x164)](_0x2e24f7(0xdb)),loggerService_1[_0x2e24f7(0x13d)][_0x2e24f7(0x1a0)](_0x2e24f7(0x17c),'/charge_decrypted',_0x5c4c57['status'],_0x388ca7,_0x943809),console[_0x2e24f7(0x164)](_0x2e24f7(0x179));}catch(_0x239dd8){console['error']('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x239dd8),loggerService_1[_0x2e24f7(0x13d)]['logWhiteDomainError'](_0x2e24f7(0x17c),_0x2e24f7(0x16d),_0x2e24f7(0xdd)+_0x239dd8),_0x388ca7=_0x6b1fa8;}}else loggerService_1['loggerService'][_0x2e24f7(0x1a0)]('mastercard',_0x2e24f7(0x19d),_0x5c4c57['status'],_0x388ca7,_0x943809),console[_0x2e24f7(0x164)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x2e24f7(0x164)]('Status:',_0x388ca7[_0x2e24f7(0x182)]),console[_0x2e24f7(0x164)]('Final:',_0x388ca7[_0x2e24f7(0x166)]),console[_0x2e24f7(0x164)](_0x2e24f7(0x15e),_0x388ca7[_0x2e24f7(0x138)]),console[_0x2e24f7(0x164)]('3DS\x20URL:',_0x388ca7[_0x2e24f7(0xd5)]||_0x2e24f7(0x193));if(_0x388ca7[_0x2e24f7(0x182)]===0x64&&_0x388ca7[_0x2e24f7(0x166)]===0x1)return console[_0x2e24f7(0x164)](_0x2e24f7(0x13a)),{'gateway_payment_id':_0x388ca7[_0x2e24f7(0x138)]?.[_0x2e24f7(0xe6)](),'payment_url':_0x5a10d3,'requires_3ds':![],'status':_0x2e24f7(0x141),'final':!![]};if(_0x388ca7[_0x2e24f7(0xd5)])return console[_0x2e24f7(0x164)](_0x2e24f7(0x117)),this[_0x2e24f7(0xf8)](_0x43a46e,_0x5c7259,_0x388ca7[_0x2e24f7(0x138)]?.[_0x2e24f7(0xe6)]()||_0x5c7259),{'gateway_payment_id':_0x388ca7[_0x2e24f7(0x138)]?.['toString'](),'payment_url':_0x388ca7['3ds_url'],'requires_3ds':!![],'threeds_url':_0x388ca7['3ds_url'],'status':_0x2e24f7(0xd7),'final':![]};let _0x5bb331=_0x388ca7[_0x2e24f7(0xcf)]||_0x388ca7['message']||'Unknown\x20error',_0xae015a=_0x388ca7[_0x2e24f7(0x182)],_0x200008=_0x388ca7['final'];return console['log'](_0x2e24f7(0x11f)+_0xae015a+_0x2e24f7(0x1a4)+_0x200008+_0x2e24f7(0x1ae)+_0x5bb331),{'gateway_payment_id':_0x388ca7[_0x2e24f7(0x138)]?.[_0x2e24f7(0xe6)](),'payment_url':_0x5a10d3,'requires_3ds':![],'status':_0x2e24f7(0x162),'final':!![]};}catch(_0x43fc8c){console[_0x2e24f7(0x1a7)](_0x2e24f7(0xc0)),console[_0x2e24f7(0x1a7)](_0x2e24f7(0x153),_0x43fc8c),loggerService_1[_0x2e24f7(0x13d)][_0x2e24f7(0x18e)](_0x2e24f7(0x17c),'/charge',_0x43fc8c);throw new Error(_0x2e24f7(0x152)+(_0x43fc8c instanceof Error?_0x43fc8c[_0x2e24f7(0x11c)]:'Unknown\x20error'));}}async[a42_0x409b9a(0x174)](_0x44e120,_0x5b63ac){const _0x10987a=a42_0x409b9a;console['log']('📊\x20Checking\x20MasterCard\x20payment\x20status:\x20'+_0x44e120+'\x20('+_0x5b63ac+')');try{const _0x73aea3={'payment_id':_0x44e120,'order_id':_0x5b63ac},_0x16f54e=JSON[_0x10987a(0x12e)](_0x73aea3),{key:_0x8017db,iv:_0xfca6d7}=this[_0x10987a(0xc2)](),_0x284d1f=this[_0x10987a(0x14c)](_0x16f54e,_0x8017db,_0xfca6d7),_0x24103e=this[_0x10987a(0x137)](_0x8017db,_0xfca6d7),_0x536a71=this[_0x10987a(0x132)](_0x16f54e),_0x5264e0={'merchant_point_id':this[_0x10987a(0x158)],'method':_0x10987a(0x182),'info':_0x284d1f,'key':_0x24103e,'sign':_0x536a71,'lang':'en'};loggerService_1[_0x10987a(0x13d)]['logWhiteDomainRequest'](_0x10987a(0x17c),'/status',_0x10987a(0xf6),{'merchant_point_id':this[_0x10987a(0x158)],'method':'status','lang':'en'});const _0x293e41=Date['now'](),_0x4b7678=await fetch(this[_0x10987a(0x198)],{'method':_0x10987a(0xf6),'headers':{'Content-Type':'application/json','Accept':_0x10987a(0x18d),'User-Agent':_0x10987a(0x133)},'body':JSON[_0x10987a(0x12e)](_0x5264e0)}),_0x19c473=Date['now']()-_0x293e41;if(!_0x4b7678['ok']){const _0xf230c2=await _0x4b7678[_0x10987a(0x112)]();loggerService_1[_0x10987a(0x13d)]['logWhiteDomainResponse'](_0x10987a(0x17c),_0x10987a(0x146),_0x4b7678[_0x10987a(0x182)],_0xf230c2,_0x19c473);throw new Error(_0x10987a(0x12f)+_0x4b7678[_0x10987a(0x182)]);}const _0x3e96bc=await _0x4b7678[_0x10987a(0x122)]();loggerService_1[_0x10987a(0x13d)]['logWhiteDomainResponse'](_0x10987a(0x17c),_0x10987a(0x146),_0x4b7678[_0x10987a(0x182)],_0x3e96bc,_0x19c473);let _0x4bd441=_0x3e96bc;if(_0x3e96bc[_0x10987a(0xea)]&&_0x3e96bc[_0x10987a(0xc8)]&&_0x3e96bc[_0x10987a(0xfa)]){console[_0x10987a(0x164)](_0x10987a(0x10c));try{const _0x3ae4ff=this[_0x10987a(0x197)](_0x3e96bc[_0x10987a(0xea)],_0x3e96bc[_0x10987a(0xc8)]);_0x4bd441=JSON[_0x10987a(0x14e)](_0x3ae4ff),console['log']('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x10987a(0x13d)]['logWhiteDomainResponse'](_0x10987a(0x17c),'/status_decrypted',_0x4b7678[_0x10987a(0x182)],_0x4bd441,_0x19c473),console[_0x10987a(0x164)](_0x10987a(0x183));}catch(_0x2cb101){console[_0x10987a(0x1a7)](_0x10987a(0x14a),_0x2cb101),loggerService_1[_0x10987a(0x13d)][_0x10987a(0x18e)]('mastercard','/status_decrypt',_0x10987a(0x16f)+_0x2cb101),_0x4bd441=_0x3e96bc;}}else loggerService_1[_0x10987a(0x13d)][_0x10987a(0x1a0)](_0x10987a(0x17c),_0x10987a(0x1a1),_0x4b7678[_0x10987a(0x182)],_0x4bd441,_0x19c473),console[_0x10987a(0x164)](_0x10987a(0x1aa));console[_0x10987a(0x164)](_0x10987a(0x100),{'status':_0x4bd441[_0x10987a(0x182)],'final':_0x4bd441[_0x10987a(0x166)],'payment_id':_0x4bd441['payment_id'],'desc':_0x4bd441['desc']});let _0x14f033=_0x10987a(0xd7);if(_0x4bd441[_0x10987a(0x182)]===0x1&&_0x4bd441[_0x10987a(0x166)]===0x1)_0x14f033=_0x10987a(0x141);else _0x4bd441[_0x10987a(0x182)]===0x0&&_0x4bd441[_0x10987a(0x166)]===0x0?_0x14f033=_0x10987a(0xd7):_0x14f033='FAILED';return{'status':_0x14f033,'final':_0x4bd441['final']===0x1,'amount':_0x4bd441[_0x10987a(0xe5)],'currency':_0x4bd441[_0x10987a(0x167)],'date_success':_0x4bd441['date_success'],'description':_0x4bd441[_0x10987a(0xcf)]};}catch(_0x55deb9){console[_0x10987a(0x1a7)]('MasterCard\x20status\x20check\x20error:',_0x55deb9),loggerService_1[_0x10987a(0x13d)]['logWhiteDomainError'](_0x10987a(0x17c),_0x10987a(0x181),_0x55deb9);throw new Error('Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20'+(_0x55deb9 instanceof Error?_0x55deb9[_0x10987a(0x11c)]:_0x10987a(0xbe)));}}['scheduleStatusChecks'](_0x35cf5a,_0x3e6ead,_0x187ac4){const _0x4507f3=a42_0x409b9a;console['log'](_0x4507f3(0x121)+_0x35cf5a+'\x20('+_0x187ac4+')'),this[_0x4507f3(0x10b)](_0x35cf5a);const _0x58d3a8=[],_0x136de1=0x5*0x3c*0x3e8,_0x543f13=0x2*0x3c*0x3c*0x3e8,_0x517dad=Math['floor'](_0x543f13/_0x136de1);console[_0x4507f3(0x164)](_0x4507f3(0x10f)+_0x517dad+_0x4507f3(0xf2));for(let _0x8ea634=0x1;_0x8ea634<=_0x517dad;_0x8ea634++){const _0x265bf0=setTimeout(async()=>{const _0x1dcec1=_0x4507f3;console[_0x1dcec1(0x164)](_0x1dcec1(0xd1)+_0x8ea634+'/'+_0x517dad+_0x1dcec1(0x145)+_0x35cf5a);try{const _0x3cc676=await this[_0x1dcec1(0x174)](_0x187ac4,_0x3e6ead);console[_0x1dcec1(0x164)](_0x1dcec1(0x10d)+_0x8ea634+'\x20result:',_0x3cc676),_0x3cc676[_0x1dcec1(0x166)]&&(console[_0x1dcec1(0x164)](_0x1dcec1(0x14f)+_0x35cf5a+_0x1dcec1(0x19f)+_0x3cc676[_0x1dcec1(0x182)]+_0x1dcec1(0x14d)),this['clearStatusTimers'](_0x35cf5a),await this[_0x1dcec1(0x161)](_0x35cf5a,_0x3cc676[_0x1dcec1(0x182)],_0x3cc676));}catch(_0x256165){console[_0x1dcec1(0x1a7)](_0x1dcec1(0x130)+_0x8ea634+_0x1dcec1(0x175)+_0x35cf5a+':',_0x256165);}},_0x8ea634*_0x136de1);_0x58d3a8[_0x4507f3(0x19b)](_0x265bf0);}this[_0x4507f3(0x191)][_0x4507f3(0xe8)](_0x35cf5a,_0x58d3a8),console[_0x4507f3(0x164)](_0x4507f3(0x199)+_0x517dad+'\x20status\x20checks\x20for\x20payment\x20'+_0x35cf5a);}[a42_0x409b9a(0x10b)](_0x447072){const _0x4f7eb5=a42_0x409b9a,_0x84910d=this[_0x4f7eb5(0x191)][_0x4f7eb5(0x15d)](_0x447072);_0x84910d&&(console['log'](_0x4f7eb5(0xe0)+_0x84910d[_0x4f7eb5(0x18a)]+_0x4f7eb5(0x12d)+_0x447072),_0x84910d['forEach']((_0x3b4388,_0xe05c6d)=>{clearTimeout(_0x3b4388);}),this[_0x4f7eb5(0x191)][_0x4f7eb5(0xf7)](_0x447072));}async[a42_0x409b9a(0x161)](_0xc84235,_0x396466,_0x4b5e8d){const _0x2cf3bb=a42_0x409b9a;try{const _0x1cfa82=(await Promise[_0x2cf3bb(0x16c)]()[_0x2cf3bb(0xd9)](()=>__importStar(require('../../config/database'))))[_0x2cf3bb(0x11d)],_0x1ff442={'status':_0x396466['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0x2cf3bb(0x14b),'statusChangedAt':new Date()};_0x396466===_0x2cf3bb(0x141)&&(_0x1ff442[_0x2cf3bb(0xc6)]=new Date()),_0x4b5e8d[_0x2cf3bb(0x16b)]&&(_0x1ff442[_0x2cf3bb(0x1a6)]=_0x2cf3bb(0x15f)+_0x4b5e8d[_0x2cf3bb(0x16b)]),await _0x1cfa82['payment'][_0x2cf3bb(0x147)]({'where':{'id':_0xc84235},'data':_0x1ff442}),console['log'](_0x2cf3bb(0x14f)+_0xc84235+_0x2cf3bb(0x1ac)+_0x396466),await this[_0x2cf3bb(0x150)](_0xc84235,_0x396466);}catch(_0x5cbd12){console[_0x2cf3bb(0x1a7)](_0x2cf3bb(0x103)+_0xc84235+':',_0x5cbd12);}}async[a42_0x409b9a(0x150)](_0x42afb1,_0x46c5b6){const _0x592044=a42_0x409b9a;try{const _0x402df1=(await Promise[_0x592044(0x16c)]()[_0x592044(0xd9)](()=>__importStar(require(_0x592044(0x139)))))[_0x592044(0x11d)],{telegramBotService:_0x182e2c}=await Promise['resolve']()[_0x592044(0xd9)](()=>__importStar(require('../telegramBotService'))),_0x1cd70d=await _0x402df1[_0x592044(0x1ad)]['findUnique']({'where':{'id':_0x42afb1},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x1cd70d)return;const _0x374149={'PAID':'paid','FAILED':_0x592044(0xf9)},_0x2aa55f=_0x374149[_0x46c5b6];_0x2aa55f&&await _0x182e2c['sendPaymentNotification'](_0x1cd70d['shopId'],_0x1cd70d,_0x2aa55f),await this['sendShopWebhook'](_0x1cd70d,_0x46c5b6);}catch(_0x2250c6){console[_0x592044(0x1a7)](_0x592044(0x189),_0x2250c6);}}async[a42_0x409b9a(0xe4)](_0x4b9ec8,_0x4d0c49){const _0x5d090d=a42_0x409b9a,_0x339c1e=Date[_0x5d090d(0xd4)]();try{const _0x546ad8=_0x4b9ec8[_0x5d090d(0xc9)],_0x2c3720=_0x546ad8[_0x5d090d(0x17e)];if(!_0x2c3720?.['webhookUrl']){console[_0x5d090d(0x164)](_0x5d090d(0x10a)+_0x546ad8['id']);return;}const _0x4b805d=_0x4d0c49===_0x5d090d(0x141)?_0x5d090d(0x116):_0x5d090d(0x1b0);let _0x74f12b=[];if(_0x2c3720['webhookEvents'])try{_0x74f12b=Array['isArray'](_0x2c3720[_0x5d090d(0xf4)])?_0x2c3720[_0x5d090d(0xf4)]:JSON['parse'](_0x2c3720[_0x5d090d(0xf4)]);}catch(_0x55d2c6){console['error'](_0x5d090d(0x184),_0x55d2c6),_0x74f12b=[];}if(!_0x74f12b[_0x5d090d(0xbd)](_0x4b805d)){console[_0x5d090d(0x164)]('Webhook\x20event\x20'+_0x4b805d+_0x5d090d(0x12b)+_0x546ad8['id']);return;}const _0x197098={'event':_0x4b805d,'payment':{'id':_0x4b9ec8['id'],'order_id':_0x4b9ec8['orderId'],'gateway_order_id':_0x4b9ec8[_0x5d090d(0x196)],'gateway':_0x5d090d(0x124),'amount':_0x4b9ec8[_0x5d090d(0xe5)],'currency':_0x4b9ec8[_0x5d090d(0x167)],'status':_0x4d0c49[_0x5d090d(0xfe)](),'customer_email':_0x4b9ec8[_0x5d090d(0x11e)],'customer_name':_0x4b9ec8[_0x5d090d(0x176)],'created_at':_0x4b9ec8[_0x5d090d(0xeb)],'updated_at':new Date()}},_0x41fba1=await fetch(_0x2c3720['webhookUrl'],{'method':_0x5d090d(0xf6),'headers':{'Content-Type':_0x5d090d(0x18d),'User-Agent':_0x5d090d(0x105)},'body':JSON[_0x5d090d(0x12e)](_0x197098)}),_0xa6674f=Date[_0x5d090d(0xd4)]()-_0x339c1e;loggerService_1[_0x5d090d(0x13d)][_0x5d090d(0x102)](_0x4b9ec8[_0x5d090d(0x11a)],_0x2c3720[_0x5d090d(0x13e)],_0x4b805d,_0x41fba1[_0x5d090d(0x182)],_0xa6674f,_0x197098),console['log']('MasterCard\x20webhook\x20sent\x20to\x20'+_0x2c3720[_0x5d090d(0x13e)]+_0x5d090d(0x13f)+_0x41fba1[_0x5d090d(0x182)]+'\x20('+_0xa6674f+_0x5d090d(0x15b));}catch(_0x5716f3){console[_0x5d090d(0x1a7)](_0x5d090d(0xec),_0x5716f3),loggerService_1['loggerService']['logShopWebhookError'](_0x4b9ec8[_0x5d090d(0x11a)],_0x4b9ec8[_0x5d090d(0xc9)]?.[_0x5d090d(0x17e)]?.[_0x5d090d(0x13e)]||_0x5d090d(0xf5),_0x5d090d(0xcb),_0x5716f3,{});}}[a42_0x409b9a(0x104)](_0x48e2dd){const _0x4469af=a42_0x409b9a,_0x4d9ffe=_0x48e2dd[_0x4469af(0x101)](/[\s-]/g,'');if(_0x4d9ffe[_0x4469af(0x18a)]<0x4)return'****';return _0x4469af(0x13b)+_0x4d9ffe[_0x4469af(0x143)](-0x4);}async['processWebhook'](_0x35e33c){const _0x17baef=a42_0x409b9a;console[_0x17baef(0x164)](_0x17baef(0x1ab),_0x35e33c);let _0x35ebae=_0x17baef(0xd7);if(_0x35e33c[_0x17baef(0x182)]===0x1&&_0x35e33c[_0x17baef(0x166)]===0x1)_0x35ebae=_0x17baef(0x141);else _0x35e33c['status']===0x0&&_0x35e33c[_0x17baef(0x166)]===0x0?_0x35ebae='PENDING':_0x35ebae=_0x17baef(0x162);return{'paymentId':_0x35e33c['order_id']||'','status':_0x35ebae,'amount':_0x35e33c[_0x17baef(0xe5)],'currency':_0x35e33c[_0x17baef(0x167)]};}[a42_0x409b9a(0xcd)](){const _0x10572c=a42_0x409b9a;console[_0x10572c(0x164)](_0x10572c(0xc3));const _0xf909e9=this[_0x10572c(0x191)][_0x10572c(0x115)];for(const [_0x437eb8]of this[_0x10572c(0x191)]){this[_0x10572c(0x10b)](_0x437eb8);}console[_0x10572c(0x164)](_0x10572c(0x19e)+_0xf909e9+_0x10572c(0xca));}}exports[a42_0x409b9a(0xe9)]=MasterCardService;