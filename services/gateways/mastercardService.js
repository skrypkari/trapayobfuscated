'use strict';const a48_0x462bd7=a48_0x55a5;(function(_0x5c907e,_0x39bbb2){const _0x2d100c=a48_0x55a5,_0x3ab8df=_0x5c907e();while(!![]){try{const _0x5b355f=-parseInt(_0x2d100c(0xf7))/0x1*(-parseInt(_0x2d100c(0x118))/0x2)+parseInt(_0x2d100c(0xe0))/0x3*(parseInt(_0x2d100c(0x1df))/0x4)+-parseInt(_0x2d100c(0x144))/0x5+-parseInt(_0x2d100c(0x11f))/0x6*(parseInt(_0x2d100c(0x1d3))/0x7)+-parseInt(_0x2d100c(0xfd))/0x8+parseInt(_0x2d100c(0x159))/0x9*(-parseInt(_0x2d100c(0x1ea))/0xa)+parseInt(_0x2d100c(0x188))/0xb*(-parseInt(_0x2d100c(0x131))/0xc);if(_0x5b355f===_0x39bbb2)break;else _0x3ab8df['push'](_0x3ab8df['shift']());}catch(_0x5958ab){_0x3ab8df['push'](_0x3ab8df['shift']());}}}(a48_0x3f3e,0x2c352));function a48_0x55a5(_0x3c1f5a,_0x3e765f){const _0x3f3e82=a48_0x3f3e();return a48_0x55a5=function(_0x55a513,_0xb3deb7){_0x55a513=_0x55a513-0xaa;let _0x5e0f42=_0x3f3e82[_0x55a513];return _0x5e0f42;},a48_0x55a5(_0x3c1f5a,_0x3e765f);}var __createBinding=this&&this[a48_0x462bd7(0x1de)]||(Object[a48_0x462bd7(0x1ba)]?function(_0x44702b,_0x7b6983,_0xfcfaf5,_0x361ad9){const _0xf16c6=a48_0x462bd7;if(_0x361ad9===undefined)_0x361ad9=_0xfcfaf5;var _0x4bc463=Object[_0xf16c6(0xea)](_0x7b6983,_0xfcfaf5);(!_0x4bc463||(_0xf16c6(0x10e)in _0x4bc463?!_0x7b6983[_0xf16c6(0x1bb)]:_0x4bc463[_0xf16c6(0x10c)]||_0x4bc463[_0xf16c6(0xb1)]))&&(_0x4bc463={'enumerable':!![],'get':function(){return _0x7b6983[_0xfcfaf5];}}),Object[_0xf16c6(0x179)](_0x44702b,_0x361ad9,_0x4bc463);}:function(_0x3e26fd,_0x12af45,_0x4020c1,_0x4b2cb0){if(_0x4b2cb0===undefined)_0x4b2cb0=_0x4020c1;_0x3e26fd[_0x4b2cb0]=_0x12af45[_0x4020c1];}),__setModuleDefault=this&&this[a48_0x462bd7(0xaf)]||(Object[a48_0x462bd7(0x1ba)]?function(_0x2e12be,_0x3b1809){const _0xeae616=a48_0x462bd7;Object[_0xeae616(0x179)](_0x2e12be,_0xeae616(0x1bd),{'enumerable':!![],'value':_0x3b1809});}:function(_0x5a65b9,_0xe00fd8){const _0x176f7e=a48_0x462bd7;_0x5a65b9[_0x176f7e(0x1bd)]=_0xe00fd8;}),__importStar=this&&this['__importStar']||(function(){var _0x28e7d2=function(_0x317b4c){const _0x2802f8=a48_0x55a5;return _0x28e7d2=Object[_0x2802f8(0x110)]||function(_0x1793b6){const _0x2a8b44=_0x2802f8;var _0xdb160b=[];for(var _0x1a33a7 in _0x1793b6)if(Object[_0x2a8b44(0x1e9)][_0x2a8b44(0x137)][_0x2a8b44(0x1c4)](_0x1793b6,_0x1a33a7))_0xdb160b[_0xdb160b[_0x2a8b44(0x13a)]]=_0x1a33a7;return _0xdb160b;},_0x28e7d2(_0x317b4c);};return function(_0x41f32a){const _0x1e623b=a48_0x55a5;if(_0x41f32a&&_0x41f32a[_0x1e623b(0x1bb)])return _0x41f32a;var _0x7b9b3c={};if(_0x41f32a!=null){for(var _0x3ee2cd=_0x28e7d2(_0x41f32a),_0xf4cd29=0x0;_0xf4cd29<_0x3ee2cd[_0x1e623b(0x13a)];_0xf4cd29++)if(_0x3ee2cd[_0xf4cd29]!==_0x1e623b(0x1bd))__createBinding(_0x7b9b3c,_0x41f32a,_0x3ee2cd[_0xf4cd29]);}return __setModuleDefault(_0x7b9b3c,_0x41f32a),_0x7b9b3c;};}()),__importDefault=this&&this[a48_0x462bd7(0x19b)]||function(_0x12ac9f){const _0x10c6fb=a48_0x462bd7;return _0x12ac9f&&_0x12ac9f[_0x10c6fb(0x1bb)]?_0x12ac9f:{'default':_0x12ac9f};};Object[a48_0x462bd7(0x179)](exports,a48_0x462bd7(0x1bb),{'value':!![]}),exports[a48_0x462bd7(0xee)]=void 0x0;function a48_0x3f3e(){const _0x2fced2=['📝\x20Data\x20length:','PAID','Failed\x20to\x20check\x20','/status','❌\x20Failure\x20description:\x20','info','charAt','logShopWebhookError','\x20\x20\x20Amount:\x20','\x20\x20\x20-\x20lang:\x20en','randomBytes','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','4743aCgqVX','webhookUrl','order_id','publicEncrypt','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','forEach','clearStatusTimers','statusCheckTimers','logWhiteDomainError','updatePaymentStatus','sendPaymentNotifications','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','\x20order_id\x20for\x20search:\x20','findUnique','MASTERCARD','\x20status\x20updated\x20to\x20','✅\x20Scheduled\x20','MasterCard\x20webhook\x20sent\x20to\x20','sendShopWebhook','signRSA','cardType','visaMerchantPointId','5000000000000000','push','path','none','💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)','application/json','cwd','visaPrivateKeyPath','\x20status\x20checks\x20for\x20payment\x20','\x20\x20\x20-\x20sign\x20length:','defineProperty','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','🔐\x20Data\x20encrypted\x20with\x20AES','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','Card\x20Holder:','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','cvv','Amount:','HTTP\x20error!\x20status:\x20','\x20MasterCard\x20status\x20check\x20timers','RSA_PKCS1_PADDING','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','****\x20****\x20****\x20','shop','11CrgmII','psp_public.pem','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','\x20payment:\x20','json','🔐\x20VISA\x20Public\x20key\x20length:\x20','../../config/database','\x20characters','📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:','unknown','🔐\x20MasterCard\x20Public\x20key\x20path:','🔐\x20VISA\x20Private\x20key\x20length:\x20','🛑\x20Stopped\x20','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','from','✅\x20VISA\x20key\x20files\x20validated\x20successfully','🔐\x20VISA\x20Private\x20key\x20path:','replace','\x20(from:\x20order_id=','__importDefault','substring','aes-256-ctr','status','update','🔐\x20MasterCard\x20API\x20URL:','../loggerService','crypto','\x20\x20\x20-\x20method:\x20charge','Failed\x20to\x20send\x20MasterCard\x20webhook:','🔐\x203DS\x20verification\x20required','✅\x20Payment\x20','/charge_raw','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','toString','now',',\x20body:\x20','\x20API:\x20','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','❌\x20Status\x20check\x20#','trim','===\x20API\x20RESPONSE\x20===','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',',\x20final=','size','\x20\x20\x20-\x20info\x20length:','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','join','Status:','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','💳\x20VISA/MasterCard\x20service\x20initialized','create','__esModule','\x20failed\x20for\x20payment\x20','default','scheduleStatusChecks','stringify','Final:','getCardTypeAndApi','text','set','call','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','shopId','createDecipheriv','webhookEvents','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','payment','\x20(from:\x20status=','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','/charge_decrypted','amount','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','maskCardNumber','POST','1687tgdpoT','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','generateAESKey','💾\x20Payment\x20data\x20prepared','🔐\x20AES\x20key\x20and\x20IV\x20generated','📝\x20Signature\x20length:','💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)','Status\x20decryption\x20failed:\x20','Failed\x20to\x20decrypt\x20response','\x20is\x20final\x20(','gatewayOrderId','__createBinding','4blFAdI','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','\x20webhook\x20extracted\x20data:','3DS\x20URL:','\x20result:','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','error','failureMessage','logWhiteDomainRequest','masterCardMerchantPointId','prototype','170XCqcRP','/status_raw','number','SHA256','Error\x20parsing\x20webhook\x20events:','merchantPointId','__setModuleDefault','📝\x20Final\x20request\x20structure:','configurable','base64','🔐\x20MasterCard\x20Private\x20key\x20path:','date_success','includes','🔐\x20RSA\x20signing\x20successful','🔐\x20Data\x20signed\x20with\x20RSA','❌\x20VISA/MasterCard\x20key\x20validation\x20failed:','end',',\x20orderId=','delete','FAILED','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','webhook_send','parse','❌\x20RSA\x20encryption\x20failed:','resolve','logWhiteDomainResponse','📝\x20Data\x20to\x20sign\x20length:','HTTP\x20Status:','private.pem','last_name','payment.failed','🔐\x20VISA\x20Public\x20key\x20path:','🎯\x20Using\x20','payment.success','publicKeyPath','final','/charge_decrypt','warn','settings','HTTP\x20','existsSync','\x20\x20\x20-\x20key\x20length:','checkPaymentStatus','customerName','Response\x20Body:','❌\x20PHP\x20decryptor\x20request\x20failed:','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','createdAt','privateDecrypt','****','decryptAES','then','https://api.paydmeth.com/api','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','currency','1061571bCcPsi','\x20\x20\x20Payment\x20ID:\x20','log','masterCardApiUrl','\x20not\x20enabled\x20for\x20shop\x20','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','paymentId','📊\x20Status\x20check\x20#','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','🧹\x20Clearing\x20','getOwnPropertyDescriptor','===\x20PARSED\x20API\x20RESPONSE\x20===','/charge',',\x20paymentId=','VisaMasterCardService','-----END',',\x20id=','🔍\x20Using\x20provided\x20card\x20type:\x20','\x20status\x20timers\x20for\x20payment\x20','keys','createCipheriv','floor','desc','8GusvAZ',',\x20Final:\x20','card_type','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','\x20\x20\x20Currency:\x20','visa/mastercard','779096GYIYtQ','TesSoft\x20Payment\x20System/1.0','apiUrl','encryptRSA','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','-----BEGIN','❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:','\x20for\x20payment\x20','/status_decrypt','sign','4000000000000000','privateKeyPath','PENDING','expire_year','/status_decrypted','writable','description','get','🔐\x20AES\x20key\x20length:','getOwnPropertyNames','https://api2.trapay.uk/decrypt.php','🔍\x20Using\x20','readFileSync','Payment\x20ID:','1111','\x20status\x20check\x20#','Decryption\x20failed:\x20','77492YutbOs','utf8','Webhook\x20event\x20','🔐\x20Using\x20keys:\x20','✅\x20Payment\x20successful','📝\x20Encrypted\x20key\x20length:','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','4398jOacIg','encryptAES','key','charge','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','Return\x20URL:','❌\x20RSA\x20signing\x20failed:','...','Unknown\x20error','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','payment_id','📊\x20Checking\x20','✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','),\x20stopping\x20status\x20checks','visa_public.pem','logShopWebhookSent','message','decryptResponse','1213428qYOJtV','toLowerCase','expire_month','Error\x20details:','visaApiUrl','visaPublicKeyPath','hasOwnProperty','system','📊\x20','length','PHP\x20decryptor\x20error','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','orderId','⏰\x20Will\x20check\x20status\x20','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','\x20status\x20check\x20error:','\x20\x20\x20-\x20merchant_point_id:',',\x20Desc:\x20','\x20payment\x20status:\x20','493165AyQFnJ','decryptResponsePhp','VISA','sendPaymentNotification','3ds_url','VISA/MasterCard','loggerService','constants','Failed\x20to\x20send\x20payment\x20notifications:'];a48_0x3f3e=function(){return _0x2fced2;};return a48_0x3f3e();}const crypto_1=__importDefault(require(a48_0x462bd7(0x1a2))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x462bd7(0x171))),loggerService_1=require(a48_0x462bd7(0x1a1));class VisaMasterCardService{constructor(){const _0x5312c9=a48_0x462bd7;this[_0x5312c9(0x160)]=new Map(),this['masterCardApiUrl']='https://api.paydmeth.com/api',this[_0x5312c9(0x1e8)]=0x6a7,this[_0x5312c9(0x108)]=path_1[_0x5312c9(0x1bd)]['join'](process[_0x5312c9(0x175)](),_0x5312c9(0xf3),_0x5312c9(0xc5)),this[_0x5312c9(0xcb)]=path_1[_0x5312c9(0x1bd)][_0x5312c9(0x1b6)](process['cwd'](),'keys',_0x5312c9(0x189)),this[_0x5312c9(0x135)]=_0x5312c9(0xdd),this[_0x5312c9(0x16e)]=0x6b7,this['visaPrivateKeyPath']=path_1[_0x5312c9(0x1bd)][_0x5312c9(0x1b6)](process[_0x5312c9(0x175)](),_0x5312c9(0xf3),'visa_private.pem'),this['visaPublicKeyPath']=path_1[_0x5312c9(0x1bd)][_0x5312c9(0x1b6)](process['cwd'](),_0x5312c9(0xf3),_0x5312c9(0x12d)),console['log'](_0x5312c9(0x1b9)),console['log'](_0x5312c9(0x1a0),this['masterCardApiUrl']),console[_0x5312c9(0xe2)]('🔐\x20VISA\x20API\x20URL:',this['visaApiUrl']),console[_0x5312c9(0xe2)](_0x5312c9(0xb3),this[_0x5312c9(0x108)]),console[_0x5312c9(0xe2)](_0x5312c9(0x192),this[_0x5312c9(0xcb)]),console[_0x5312c9(0xe2)](_0x5312c9(0x198),this[_0x5312c9(0x176)]),console[_0x5312c9(0xe2)](_0x5312c9(0xc8),this[_0x5312c9(0x136)]),this['validateKeyFiles']();}[a48_0x462bd7(0x1c1)](_0x2b9245){const _0x7ce672=a48_0x462bd7,_0x41b594=_0x2b9245[_0x7ce672(0x153)](0x0);if(_0x41b594==='4')return console[_0x7ce672(0xe2)](_0x7ce672(0x173)),{'cardType':'VISA','apiUrl':this[_0x7ce672(0x135)],'privateKeyPath':this[_0x7ce672(0x176)],'publicKeyPath':this[_0x7ce672(0x136)],'merchantPointId':this[_0x7ce672(0x16e)]};else return _0x41b594==='5'?(console[_0x7ce672(0xe2)](_0x7ce672(0x1d9)),{'cardType':_0x7ce672(0x167),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x7ce672(0x108)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this['masterCardMerchantPointId']}):(console['log']('💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20'+_0x41b594+'),\x20defaulting\x20to\x20MasterCard'),{'cardType':_0x7ce672(0x167),'apiUrl':this[_0x7ce672(0xe3)],'privateKeyPath':this[_0x7ce672(0x108)],'publicKeyPath':this[_0x7ce672(0xcb)],'merchantPointId':this[_0x7ce672(0x1e8)]});}['validateKeyFiles'](){const _0x307566=a48_0x462bd7;try{if(!fs_1['default'][_0x307566(0xd1)](this[_0x307566(0x108)]))throw new Error(_0x307566(0x13c)+this[_0x307566(0x108)]);if(!fs_1[_0x307566(0x1bd)][_0x307566(0xd1)](this[_0x307566(0xcb)]))throw new Error(_0x307566(0x128)+this['publicKeyPath']);const _0x403e3d=fs_1[_0x307566(0x1bd)][_0x307566(0x113)](this[_0x307566(0x108)],'utf8')[_0x307566(0x1af)](),_0x2fedf4=fs_1[_0x307566(0x1bd)][_0x307566(0x113)](this[_0x307566(0xcb)],'utf8')[_0x307566(0x1af)]();if(!_0x403e3d[_0x307566(0xb5)](_0x307566(0x102))||!_0x403e3d[_0x307566(0xb5)](_0x307566(0xef)))throw new Error(_0x307566(0x1b8));if(!_0x2fedf4[_0x307566(0xb5)]('-----BEGIN')||!_0x2fedf4['includes'](_0x307566(0xef)))throw new Error('MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');console[_0x307566(0xe2)](_0x307566(0x1c9)),console[_0x307566(0xe2)]('🔐\x20MasterCard\x20Private\x20key\x20length:\x20'+_0x403e3d[_0x307566(0x13a)]+_0x307566(0x18f)),console[_0x307566(0xe2)](_0x307566(0x1cd)+_0x2fedf4[_0x307566(0x13a)]+_0x307566(0x18f));if(fs_1[_0x307566(0x1bd)][_0x307566(0xd1)](this[_0x307566(0x176)])&&fs_1[_0x307566(0x1bd)][_0x307566(0xd1)](this[_0x307566(0x136)])){const _0x3efb3c=fs_1['default'][_0x307566(0x113)](this[_0x307566(0x176)],'utf8')['trim'](),_0x130687=fs_1[_0x307566(0x1bd)][_0x307566(0x113)](this['visaPublicKeyPath'],_0x307566(0x119))[_0x307566(0x1af)]();(!_0x3efb3c[_0x307566(0xb5)](_0x307566(0x102))||!_0x3efb3c[_0x307566(0xb5)](_0x307566(0xef)))&&console[_0x307566(0xce)](_0x307566(0x17f)),(!_0x130687[_0x307566(0xb5)](_0x307566(0x102))||!_0x130687[_0x307566(0xb5)](_0x307566(0xef)))&&console['warn'](_0x307566(0x1a8)),console['log'](_0x307566(0x197)),console['log'](_0x307566(0x193)+_0x3efb3c[_0x307566(0x13a)]+_0x307566(0x18f)),console[_0x307566(0xe2)](_0x307566(0x18d)+_0x130687[_0x307566(0x13a)]+'\x20characters');}else console[_0x307566(0xce)](_0x307566(0x1cc)),console['warn'](_0x307566(0x164)+this[_0x307566(0x176)]),console['warn'](_0x307566(0xe5)+this[_0x307566(0x136)]);}catch(_0x3a6cfd){console[_0x307566(0x1e5)](_0x307566(0xb8),_0x3a6cfd);throw _0x3a6cfd;}}['generateAESKey'](){const _0x472732=a48_0x462bd7,_0x42b98f=crypto_1[_0x472732(0x1bd)][_0x472732(0x157)](0x20),_0x4da55f=crypto_1[_0x472732(0x1bd)][_0x472732(0x157)](0x10);return{'key':_0x42b98f,'iv':_0x4da55f};}[a48_0x462bd7(0x120)](_0x28766e,_0x45f1e6,_0x12530c){const _0xd4997e=a48_0x462bd7,_0xb90e53=crypto_1[_0xd4997e(0x1bd)][_0xd4997e(0xf4)](_0xd4997e(0x19d),_0x45f1e6,_0x12530c);let _0x23ce43=_0xb90e53[_0xd4997e(0x19f)](_0x28766e,_0xd4997e(0x119),_0xd4997e(0xb2));return _0x23ce43+=_0xb90e53[_0xd4997e(0xcc)]('base64'),_0x23ce43;}['encryptRSA'](_0xa6ba7b,_0x17b9eb,_0x222a2e){const _0x1363a2=a48_0x462bd7;try{const _0x20d011=fs_1[_0x1363a2(0x1bd)][_0x1363a2(0x113)](_0x222a2e,'utf8')[_0x1363a2(0x1af)](),_0x17f150={'iv':_0x17b9eb[_0x1363a2(0x1a9)](_0x1363a2(0xb2)),'key':_0xa6ba7b['toString']('base64')},_0x866669=JSON[_0x1363a2(0x1bf)](_0x17f150);console[_0x1363a2(0xe2)](_0x1363a2(0xfa),_0x866669[_0x1363a2(0x13a)]);const _0x41d213=crypto_1[_0x1363a2(0x1bd)][_0x1363a2(0x15c)]({'key':_0x20d011,'padding':crypto_1[_0x1363a2(0x1bd)][_0x1363a2(0x14b)][_0x1363a2(0x184)]},Buffer[_0x1363a2(0x196)](_0x866669));return console[_0x1363a2(0xe2)](_0x1363a2(0x1d4),_0x41d213[_0x1363a2(0x13a)]),_0x41d213['toString'](_0x1363a2(0xb2));}catch(_0x420540){console[_0x1363a2(0x1e5)](_0x1363a2(0xc0),_0x420540);throw new Error(_0x1363a2(0xde));}}[a48_0x462bd7(0x16c)](_0x27ba68,_0xe72006){const _0xaa90cc=a48_0x462bd7;try{const _0x2c1b10=fs_1[_0xaa90cc(0x1bd)][_0xaa90cc(0x113)](_0xe72006,_0xaa90cc(0x119))['trim'](),_0x1ac1a7=crypto_1[_0xaa90cc(0x1bd)]['createSign'](_0xaa90cc(0xac));_0x1ac1a7[_0xaa90cc(0x19f)](_0x27ba68),_0x1ac1a7[_0xaa90cc(0xb9)]();const _0xe52f50=_0x1ac1a7[_0xaa90cc(0x106)](_0x2c1b10,_0xaa90cc(0xb2));return console[_0xaa90cc(0xe2)](_0xaa90cc(0xb6)),console['log'](_0xaa90cc(0xc3),_0x27ba68[_0xaa90cc(0x13a)]),console[_0xaa90cc(0xe2)]('📝\x20Signature\x20length:',_0xe52f50[_0xaa90cc(0x13a)]),_0xe52f50;}catch(_0x2e80d5){console[_0xaa90cc(0x1e5)](_0xaa90cc(0x125),_0x2e80d5),console[_0xaa90cc(0x1e5)]('❌\x20Data\x20being\x20signed:',_0x27ba68[_0xaa90cc(0x19c)](0x0,0xc8)+_0xaa90cc(0x126));throw new Error(_0xaa90cc(0x17d));}}[a48_0x462bd7(0xdb)](_0x243813,_0x1592c2,_0x3dd0b8){const _0x2d50cc=a48_0x462bd7,_0x5ec3b0=crypto_1[_0x2d50cc(0x1bd)][_0x2d50cc(0x1c7)](_0x2d50cc(0x19d),_0x1592c2,_0x3dd0b8);let _0x176720=_0x5ec3b0[_0x2d50cc(0x19f)](_0x243813,_0x2d50cc(0xb2),_0x2d50cc(0x119));return _0x176720+=_0x5ec3b0[_0x2d50cc(0xcc)]('utf8'),_0x176720;}async[a48_0x462bd7(0x145)](_0x1a02d2,_0x35e81b,_0x29a30d=a48_0x462bd7(0x167)){const _0x119a8f=a48_0x462bd7;try{const _0x424f2a=await fetch(_0x119a8f(0x111),{'method':'POST','headers':{'Content-Type':_0x119a8f(0x174)},'body':JSON[_0x119a8f(0x1bf)]({'info':_0x1a02d2,'key':_0x35e81b,'card_type':_0x29a30d[_0x119a8f(0x132)]()})});if(!_0x424f2a['ok'])throw new Error(_0x119a8f(0x13b));return await _0x424f2a[_0x119a8f(0x1c2)]();}catch(_0x5b8140){console[_0x119a8f(0x1e5)](_0x119a8f(0xd6),_0x5b8140);throw new Error(_0x119a8f(0xbd));}}[a48_0x462bd7(0x130)](_0x4032d1,_0x26ee55){const _0x306f42=a48_0x462bd7;try{const _0x45670d=fs_1[_0x306f42(0x1bd)][_0x306f42(0x113)](this['privateKeyPath'],'utf8')[_0x306f42(0x1af)](),_0x53440f=crypto_1[_0x306f42(0x1bd)][_0x306f42(0xd9)](_0x45670d,Buffer['from'](_0x26ee55,_0x306f42(0xb2))),_0x3a63c2=JSON['parse'](_0x53440f[_0x306f42(0x1a9)]()),_0x249228=Buffer[_0x306f42(0x196)](_0x3a63c2[_0x306f42(0x121)],_0x306f42(0xb2)),_0x2bdf65=Buffer[_0x306f42(0x196)](_0x3a63c2['iv'],'base64');return this[_0x306f42(0xdb)](_0x4032d1,_0x249228,_0x2bdf65);}catch(_0x4d1b58){throw new Error(_0x306f42(0x1db));}}async['processCardPayment'](_0x1e5c5e){const _0x459631=a48_0x462bd7,{paymentId:_0x3f80fd,orderId:_0x5783a5,amount:_0xc8e518,currency:_0x53422d,cardData:_0x43949c,resultUrl:_0xdfbd9d,returnUrl:_0x15149d,cardHolder:_0x2cc29b,browser:_0x41681b}=_0x1e5c5e;console[_0x459631(0xe2)](_0x459631(0x101)),console['log'](_0x459631(0x114),_0x3f80fd),console[_0x459631(0xe2)]('Order\x20ID:',_0x5783a5),console[_0x459631(0xe2)](_0x459631(0x181),_0xc8e518,_0x53422d),console[_0x459631(0xe2)]('Card\x20Number:',this[_0x459631(0x1d1)](_0x43949c['number'])),console[_0x459631(0xe2)](_0x459631(0x17e),_0x2cc29b['first_name']+'\x20'+_0x2cc29b[_0x459631(0xc6)]),console['log'](_0x459631(0x124),_0x15149d),console[_0x459631(0xe2)]('Result\x20URL:',_0xdfbd9d);const _0xb14337=this[_0x459631(0x1c1)](_0x43949c[_0x459631(0xab)]);console[_0x459631(0xe2)](_0x459631(0xc9)+_0xb14337[_0x459631(0x16d)]+_0x459631(0x1ac)+_0xb14337[_0x459631(0xff)]),console[_0x459631(0xe2)](_0x459631(0x11b)+_0xb14337[_0x459631(0x108)]+',\x20'+_0xb14337[_0x459631(0xcb)]);const _0x4c4d99={'amount':_0xc8e518,'currency':_0x53422d['toUpperCase'](),'order_id':_0x5783a5,'result_url':_0xdfbd9d,'return_url':_0x15149d,'country':'','card':{'number':_0x43949c[_0x459631(0xab)],'expire_month':_0x43949c[_0x459631(0x133)],'expire_year':_0x43949c[_0x459631(0x10a)],'cvv':_0x43949c[_0x459631(0x180)]},'card_holder':_0x2cc29b,'browser':_0x41681b},_0x3e15e4=JSON[_0x459631(0x1bf)](_0x4c4d99);console['log'](_0x459631(0x1d6)),console[_0x459631(0xe2)](_0x459631(0x190)),console[_0x459631(0xe2)](_0x3e15e4),console[_0x459631(0xe2)](_0x459631(0x14d),_0x3e15e4['length']);try{const {key:_0x1ed267,iv:_0x597df9}=this['generateAESKey']();console[_0x459631(0xe2)](_0x459631(0x1d7)),console[_0x459631(0xe2)](_0x459631(0x10f),_0x1ed267['length']),console['log']('🔐\x20AES\x20IV\x20length:',_0x597df9[_0x459631(0x13a)]);const _0x2cdf71=this[_0x459631(0x120)](_0x3e15e4,_0x1ed267,_0x597df9);console[_0x459631(0xe2)](_0x459631(0x17b)),console['log']('📝\x20Encrypted\x20data\x20length:',_0x2cdf71[_0x459631(0x13a)]);const _0x2dcbab=this[_0x459631(0x100)](_0x1ed267,_0x597df9,_0xb14337[_0x459631(0xcb)]);console[_0x459631(0xe2)](_0x459631(0x1e4)),console[_0x459631(0xe2)](_0x459631(0x11d),_0x2dcbab[_0x459631(0x13a)]);const _0x469be8=this[_0x459631(0x16c)](_0x3e15e4,_0xb14337['privateKeyPath']);console['log'](_0x459631(0xb7)),console[_0x459631(0xe2)](_0x459631(0x1d8),_0x469be8[_0x459631(0x13a)]);const _0x59ca6a={'merchant_point_id':_0xb14337[_0x459631(0xae)],'method':_0x459631(0x122),'info':_0x2cdf71,'key':_0x2dcbab,'sign':_0x469be8,'lang':'en'};console['log']('📤\x20Sending\x20request\x20to\x20API...'),console[_0x459631(0xe2)](_0x459631(0xb0)),console['log'](_0x459631(0x141),_0xb14337['merchantPointId']),console[_0x459631(0xe2)](_0x459631(0x1a3)),console[_0x459631(0xe2)](_0x459631(0x1b4),_0x2cdf71[_0x459631(0x13a)]),console[_0x459631(0xe2)](_0x459631(0xd2),_0x2dcbab['length']),console[_0x459631(0xe2)](_0x459631(0x178),_0x469be8[_0x459631(0x13a)]),console[_0x459631(0xe2)](_0x459631(0x156)),loggerService_1[_0x459631(0x14a)][_0x459631(0x1e7)](_0xb14337[_0x459631(0x16d)][_0x459631(0x132)](),_0x459631(0xec),_0x459631(0x1d2),{'merchant_point_id':_0xb14337['merchantPointId'],'method':'charge','lang':'en'});const _0x1f8534=Date[_0x459631(0x1aa)](),_0xd645b0=await fetch(_0xb14337['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x459631(0x174),'User-Agent':_0x459631(0xfe)},'body':JSON[_0x459631(0x1bf)](_0x59ca6a)}),_0x3ab4a7=Date[_0x459631(0x1aa)]()-_0x1f8534;console[_0x459631(0xe2)](_0x459631(0x1b0)),console['log'](_0x459631(0x1b7),_0xd645b0['status']),console['log']('Response\x20Time:',_0x3ab4a7+'ms');if(!_0xd645b0['ok']){const _0x6f5e39=await _0xd645b0['text']();console[_0x459631(0x1e5)](_0x459631(0xc4),_0xd645b0[_0x459631(0x19e)]),console[_0x459631(0x1e5)](_0x459631(0xd5),_0x6f5e39),loggerService_1[_0x459631(0x14a)][_0x459631(0xc2)](_0xb14337[_0x459631(0x16d)]['toLowerCase'](),_0x459631(0x1a7),_0xd645b0['status'],_0x6f5e39,_0x3ab4a7),loggerService_1['loggerService']['logWhiteDomainError'](_0xb14337[_0x459631(0x16d)][_0x459631(0x132)](),'/charge',_0x459631(0xd0)+_0xd645b0[_0x459631(0x19e)]+':\x20'+_0x6f5e39);throw new Error(_0x459631(0x182)+_0xd645b0[_0x459631(0x19e)]+_0x459631(0x1ab)+_0x6f5e39);}const _0x21a7e1=await _0xd645b0[_0x459631(0x18c)]();loggerService_1['loggerService'][_0x459631(0xc2)](_0xb14337[_0x459631(0x16d)][_0x459631(0x132)](),_0x459631(0x1a7),_0xd645b0[_0x459631(0x19e)],_0x21a7e1,_0x3ab4a7),console[_0x459631(0xe2)](_0x459631(0xeb));let _0x11710b=_0x21a7e1;if(_0x21a7e1[_0x459631(0x152)]&&_0x21a7e1[_0x459631(0x121)]&&_0x21a7e1[_0x459631(0x106)]){console[_0x459631(0xe2)](_0x459631(0x15d));try{const _0x452382=await this[_0x459631(0x145)](_0x21a7e1[_0x459631(0x152)],_0x21a7e1['key'],_0xb14337[_0x459631(0x16d)]);_0x11710b=JSON['parse'](_0x452382),console[_0x459631(0xe2)](_0x459631(0x17c)),loggerService_1[_0x459631(0x14a)]['logWhiteDomainResponse'](_0xb14337['cardType'][_0x459631(0x132)](),_0x459631(0x1ce),_0xd645b0[_0x459631(0x19e)],_0x11710b,_0x3ab4a7),console[_0x459631(0xe2)](_0x459631(0xe8));}catch(_0x82f2bd){console[_0x459631(0x1e5)](_0x459631(0x1b1),_0x82f2bd),loggerService_1[_0x459631(0x14a)][_0x459631(0x161)](_0xb14337[_0x459631(0x16d)][_0x459631(0x132)](),_0x459631(0xcd),_0x459631(0x117)+_0x82f2bd),_0x11710b=_0x21a7e1;}}else loggerService_1['loggerService']['logWhiteDomainResponse'](_0xb14337[_0x459631(0x16d)][_0x459631(0x132)](),_0x459631(0x1ce),_0xd645b0[_0x459631(0x19e)],_0x11710b,_0x3ab4a7),console[_0x459631(0xe2)](_0x459631(0x1c5));console[_0x459631(0xe2)](_0x459631(0x1b7),_0x11710b[_0x459631(0x19e)]),console[_0x459631(0xe2)](_0x459631(0x1c0),_0x11710b[_0x459631(0xcc)]),console['log'](_0x459631(0x114),_0x11710b[_0x459631(0x129)]),console[_0x459631(0xe2)](_0x459631(0x1e2),_0x11710b[_0x459631(0x148)]||_0x459631(0x172));if(_0x11710b[_0x459631(0x19e)]===0x64&&_0x11710b['final']===0x1)return console[_0x459631(0xe2)](_0x459631(0x11c)),{'gateway_payment_id':_0x11710b[_0x459631(0x129)]?.[_0x459631(0x1a9)](),'payment_url':_0x15149d,'requires_3ds':![],'status':'PAID','final':!![]};if(_0x11710b[_0x459631(0x148)])return console[_0x459631(0xe2)](_0x459631(0x1a5)),this[_0x459631(0x1be)](_0x3f80fd,_0x5783a5,_0x11710b['payment_id']?.[_0x459631(0x1a9)]()||_0x5783a5,_0xb14337['cardType']),{'gateway_payment_id':_0x11710b[_0x459631(0x129)]?.[_0x459631(0x1a9)](),'payment_url':_0x11710b[_0x459631(0x148)],'requires_3ds':!![],'threeds_url':_0x11710b[_0x459631(0x148)],'status':_0x459631(0x109),'final':![]};let _0xda7cd3=_0x11710b['desc']||_0x11710b[_0x459631(0x12f)]||_0x459631(0x127),_0x3d6f18=_0x11710b[_0x459631(0x19e)],_0x5c236b=_0x11710b[_0x459631(0xcc)];return console['log']('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x3d6f18+_0x459631(0xf8)+_0x5c236b+_0x459631(0x142)+_0xda7cd3),{'gateway_payment_id':_0x11710b[_0x459631(0x129)]?.[_0x459631(0x1a9)](),'payment_url':_0x15149d,'requires_3ds':![],'status':_0x459631(0xbc),'final':!![]};}catch(_0x5c5f38){console[_0x459631(0x1e5)](_0x459631(0x1e0)),console[_0x459631(0x1e5)](_0x459631(0x134),_0x5c5f38),loggerService_1['loggerService'][_0x459631(0x161)](_0x459631(0xfc),'/charge',_0x5c5f38);throw new Error(_0x459631(0x1d0)+(_0x5c5f38 instanceof Error?_0x5c5f38[_0x459631(0x12f)]:'Unknown\x20error'));}}async['checkPaymentStatus'](_0x168b8f,_0x3d2625,_0x2f4b12=a48_0x462bd7(0x146)){const _0x424d8e=a48_0x462bd7;console['log'](_0x424d8e(0x12a)+_0x2f4b12+_0x424d8e(0x143)+_0x168b8f+'\x20('+_0x3d2625+')');try{const _0x5497ca={'payment_id':_0x168b8f,'order_id':_0x3d2625},_0x5a4b64=JSON[_0x424d8e(0x1bf)](_0x5497ca),_0x52a4b0=this['getCardTypeAndApi'](_0x2f4b12==='VISA'?_0x424d8e(0x107):_0x424d8e(0x16f)),{key:_0x20a54e,iv:_0x38c08f}=this[_0x424d8e(0x1d5)](),_0x17f8c1=this[_0x424d8e(0x120)](_0x5a4b64,_0x20a54e,_0x38c08f),_0x1c5a98=this['encryptRSA'](_0x20a54e,_0x38c08f,_0x52a4b0[_0x424d8e(0xcb)]),_0x58181b=this[_0x424d8e(0x16c)](_0x5a4b64,_0x52a4b0['privateKeyPath']),_0x4b55fc={'merchant_point_id':_0x52a4b0[_0x424d8e(0xae)],'method':_0x424d8e(0x19e),'info':_0x17f8c1,'key':_0x1c5a98,'sign':_0x58181b,'lang':'en'};loggerService_1[_0x424d8e(0x14a)][_0x424d8e(0x1e7)](_0x2f4b12['toLowerCase'](),'/status',_0x424d8e(0x1d2),{'merchant_point_id':_0x52a4b0[_0x424d8e(0xae)],'method':_0x424d8e(0x19e),'lang':'en'});const _0x30d398=Date[_0x424d8e(0x1aa)](),_0x20b234=await fetch(_0x52a4b0[_0x424d8e(0xff)],{'method':'POST','headers':{'Content-Type':_0x424d8e(0x174),'Accept':_0x424d8e(0x174),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x424d8e(0x1bf)](_0x4b55fc)}),_0x198abe=Date[_0x424d8e(0x1aa)]()-_0x30d398;if(!_0x20b234['ok']){const _0x2a7b0f=await _0x20b234[_0x424d8e(0x1c2)]();loggerService_1[_0x424d8e(0x14a)][_0x424d8e(0xc2)](_0x2f4b12[_0x424d8e(0x132)](),_0x424d8e(0xaa),_0x20b234[_0x424d8e(0x19e)],_0x2a7b0f,_0x198abe);throw new Error(_0x424d8e(0x182)+_0x20b234['status']);}const _0x5ad923=await _0x20b234[_0x424d8e(0x18c)]();loggerService_1['loggerService'][_0x424d8e(0xc2)](_0x2f4b12[_0x424d8e(0x132)](),_0x424d8e(0xaa),_0x20b234[_0x424d8e(0x19e)],_0x5ad923,_0x198abe);let _0x24a6e2=_0x5ad923;if(_0x5ad923['info']&&_0x5ad923[_0x424d8e(0x121)]&&_0x5ad923[_0x424d8e(0x106)]){console[_0x424d8e(0xe2)]('🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0xbc1d87=await this['decryptResponsePhp'](_0x5ad923[_0x424d8e(0x152)],_0x5ad923[_0x424d8e(0x121)],_0x2f4b12);_0x24a6e2=JSON[_0x424d8e(0xbf)](_0xbc1d87),console[_0x424d8e(0xe2)]('✅\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0x424d8e(0x14a)][_0x424d8e(0xc2)](_0x2f4b12[_0x424d8e(0x132)](),_0x424d8e(0x10b),_0x20b234['status'],_0x24a6e2,_0x198abe),console[_0x424d8e(0xe2)](_0x424d8e(0x13f));}catch(_0x29d3e6){console['error'](_0x424d8e(0x11e),_0x29d3e6),loggerService_1['loggerService']['logWhiteDomainError'](_0x2f4b12['toLowerCase'](),_0x424d8e(0x105),_0x424d8e(0x1da)+_0x29d3e6),_0x24a6e2=_0x5ad923;}}else loggerService_1[_0x424d8e(0x14a)][_0x424d8e(0xc2)](_0x2f4b12['toLowerCase'](),_0x424d8e(0x10b),_0x20b234[_0x424d8e(0x19e)],_0x24a6e2,_0x198abe),console[_0x424d8e(0xe2)](_0x424d8e(0xd7));console['log']('📊\x20Status\x20check\x20result:',{'status':_0x24a6e2[_0x424d8e(0x19e)],'final':_0x24a6e2[_0x424d8e(0xcc)],'payment_id':_0x24a6e2[_0x424d8e(0x129)],'desc':_0x24a6e2[_0x424d8e(0xf6)]});let _0x3a53cc=_0x424d8e(0x109);if(_0x24a6e2[_0x424d8e(0x19e)]===0x64&&_0x24a6e2[_0x424d8e(0xcc)]===0x1)_0x3a53cc=_0x424d8e(0x14e);else{if(_0x24a6e2[_0x424d8e(0xcc)]===0x0)_0x3a53cc='PENDING';else _0x24a6e2[_0x424d8e(0xcc)]===0x1&&_0x24a6e2[_0x424d8e(0x19e)]!==0x64?_0x3a53cc=_0x424d8e(0xbc):_0x3a53cc=_0x424d8e(0x109);}return{'status':_0x3a53cc,'final':_0x24a6e2[_0x424d8e(0xcc)]===0x1,'amount':_0x24a6e2[_0x424d8e(0x1cf)],'currency':_0x24a6e2[_0x424d8e(0xdf)],'date_success':_0x24a6e2[_0x424d8e(0xb4)],'description':_0x24a6e2[_0x424d8e(0xf6)]};}catch(_0x3bc2ea){console[_0x424d8e(0x1e5)](_0x2f4b12+_0x424d8e(0x140),_0x3bc2ea),loggerService_1[_0x424d8e(0x14a)][_0x424d8e(0x161)](_0x2f4b12[_0x424d8e(0x132)](),_0x424d8e(0x150),_0x3bc2ea);throw new Error(_0x424d8e(0x14f)+_0x2f4b12+_0x424d8e(0x143)+(_0x3bc2ea instanceof Error?_0x3bc2ea[_0x424d8e(0x12f)]:'Unknown\x20error'));}}[a48_0x462bd7(0x1be)](_0x2f57c2,_0x4c4593,_0x2ac92a,_0x2c8fe1){const _0x1e53ab=a48_0x462bd7;console[_0x1e53ab(0xe2)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20'+_0x2c8fe1+_0x1e53ab(0x18b)+_0x2f57c2+'\x20('+_0x2ac92a+')'),this['clearStatusTimers'](_0x2f57c2);const _0x3e9525=[],_0x3d5b30=0x5*0x3c*0x3e8,_0x57845e=0x2*0x3c*0x3c*0x3e8,_0xebd9d7=Math[_0x1e53ab(0xf5)](_0x57845e/_0x3d5b30);console[_0x1e53ab(0xe2)](_0x1e53ab(0x13e)+_0xebd9d7+_0x1e53ab(0x18a));for(let _0x4c7f9d=0x1;_0x4c7f9d<=_0xebd9d7;_0x4c7f9d++){const _0x3ace66=setTimeout(async()=>{const _0x571b73=_0x1e53ab;console[_0x571b73(0xe2)]('🔍\x20'+_0x2c8fe1+_0x571b73(0x116)+_0x4c7f9d+'/'+_0xebd9d7+_0x571b73(0x104)+_0x2f57c2);try{const _0x2ab48a=await this[_0x571b73(0xd3)](_0x2ac92a,_0x4c4593,_0x2c8fe1);console['log'](_0x571b73(0xe7)+_0x4c7f9d+_0x571b73(0x1e3),_0x2ab48a),_0x2ab48a[_0x571b73(0xcc)]&&(console[_0x571b73(0xe2)](_0x571b73(0x1a6)+_0x2f57c2+_0x571b73(0x1dc)+_0x2ab48a['status']+_0x571b73(0x12c)),this['clearStatusTimers'](_0x2f57c2),await this[_0x571b73(0x162)](_0x2f57c2,_0x2ab48a['status'],_0x2ab48a));}catch(_0x4f5f35){console[_0x571b73(0x1e5)](_0x571b73(0x1ae)+_0x4c7f9d+_0x571b73(0x1bc)+_0x2f57c2+':',_0x4f5f35);}},_0x4c7f9d*_0x3d5b30);_0x3e9525[_0x1e53ab(0x170)](_0x3ace66);}this[_0x1e53ab(0x160)][_0x1e53ab(0x1c3)](_0x2f57c2,_0x3e9525),console[_0x1e53ab(0xe2)](_0x1e53ab(0x169)+_0xebd9d7+_0x1e53ab(0x177)+_0x2f57c2);}[a48_0x462bd7(0x15f)](_0x5bd4a1){const _0x5620f2=a48_0x462bd7,_0x2d7701=this['statusCheckTimers'][_0x5620f2(0x10e)](_0x5bd4a1);_0x2d7701&&(console[_0x5620f2(0xe2)](_0x5620f2(0xe9)+_0x2d7701[_0x5620f2(0x13a)]+_0x5620f2(0xf2)+_0x5bd4a1),_0x2d7701[_0x5620f2(0x15e)]((_0x3091d7,_0xe5b049)=>{clearTimeout(_0x3091d7);}),this[_0x5620f2(0x160)][_0x5620f2(0xbb)](_0x5bd4a1));}async[a48_0x462bd7(0x162)](_0x2b4522,_0x46a52a,_0x283a11){const _0xc48340=a48_0x462bd7;try{const _0x360f70=(await Promise[_0xc48340(0xc1)]()['then'](()=>__importStar(require('../../config/database'))))[_0xc48340(0x1bd)],_0x442252={'status':_0x46a52a['toUpperCase'](),'updatedAt':new Date(),'statusChangedBy':_0xc48340(0x138),'statusChangedAt':new Date()};_0x46a52a===_0xc48340(0x14e)&&(_0x442252['paidAt']=new Date()),_0x46a52a===_0xc48340(0xbc)&&_0x283a11[_0xc48340(0x10d)]&&(_0x442252[_0xc48340(0x1e6)]=_0x283a11['description'],console['log']('💾\x20Saving\x20failure\x20message:\x20'+_0x283a11[_0xc48340(0x10d)])),_0x283a11[_0xc48340(0x10d)]&&(_0x442252['adminNotes']=(_0x46a52a===_0xc48340(0x14e)?'VISA/MasterCard\x20payment\x20successful':_0xc48340(0x149))+':\x20'+_0x283a11[_0xc48340(0x10d)]),await _0x360f70['payment'][_0xc48340(0x19f)]({'where':{'id':_0x2b4522},'data':_0x442252}),console[_0xc48340(0xe2)](_0xc48340(0x1a6)+_0x2b4522+_0xc48340(0x168)+_0x46a52a),await this[_0xc48340(0x163)](_0x2b4522,_0x46a52a);}catch(_0x3c3eb0){console[_0xc48340(0x1e5)](_0xc48340(0x185)+_0x2b4522+':',_0x3c3eb0);}}async['sendPaymentNotifications'](_0x588445,_0x507f5e){const _0x13b577=a48_0x462bd7;try{const _0x35413c=(await Promise[_0x13b577(0xc1)]()['then'](()=>__importStar(require(_0x13b577(0x18e)))))['default'],{telegramBotService:_0x1def83}=await Promise[_0x13b577(0xc1)]()[_0x13b577(0xdc)](()=>__importStar(require('../telegramBotService'))),_0x389b83=await _0x35413c[_0x13b577(0x1ca)][_0x13b577(0x166)]({'where':{'id':_0x588445},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x389b83)return;const _0x11758e={'PAID':'paid','FAILED':'failed'},_0x49130c=_0x11758e[_0x507f5e];_0x49130c&&await _0x1def83[_0x13b577(0x147)](_0x389b83[_0x13b577(0x1c6)],_0x389b83,_0x49130c),await this[_0x13b577(0x16b)](_0x389b83,_0x507f5e);}catch(_0x12e78a){console[_0x13b577(0x1e5)](_0x13b577(0x14c),_0x12e78a);}}async[a48_0x462bd7(0x16b)](_0x342633,_0x3b5120){const _0x2a3395=a48_0x462bd7,_0x1405ff=Date[_0x2a3395(0x1aa)]();try{const _0x1ba62e=_0x342633[_0x2a3395(0x187)],_0x1c62fc=_0x1ba62e[_0x2a3395(0xcf)];if(!_0x1c62fc?.[_0x2a3395(0x15a)]){console[_0x2a3395(0xe2)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x1ba62e['id']);return;}const _0x327780=_0x3b5120==='PAID'?_0x2a3395(0xca):_0x2a3395(0xc7);let _0x3a265e=[];if(_0x1c62fc[_0x2a3395(0x1c8)])try{_0x3a265e=Array['isArray'](_0x1c62fc['webhookEvents'])?_0x1c62fc[_0x2a3395(0x1c8)]:JSON[_0x2a3395(0xbf)](_0x1c62fc[_0x2a3395(0x1c8)]);}catch(_0x2cd7b3){console[_0x2a3395(0x1e5)](_0x2a3395(0xad),_0x2cd7b3),_0x3a265e=[];}if(!_0x3a265e[_0x2a3395(0xb5)](_0x327780)){console[_0x2a3395(0xe2)](_0x2a3395(0x11a)+_0x327780+_0x2a3395(0xe4)+_0x1ba62e['id']);return;}const _0xef1701={'event':_0x327780,'payment':{'id':_0x342633['id'],'order_id':_0x342633['orderId'],'gateway_order_id':_0x342633[_0x2a3395(0x1dd)],'gateway':_0x2a3395(0x115),'amount':_0x342633[_0x2a3395(0x1cf)],'currency':_0x342633[_0x2a3395(0xdf)],'status':_0x3b5120['toLowerCase'](),'customer_email':_0x342633['customerEmail'],'customer_name':_0x342633[_0x2a3395(0xd4)],'created_at':_0x342633[_0x2a3395(0xd8)],'updated_at':new Date()}},_0xb102b6=await fetch(_0x1c62fc[_0x2a3395(0x15a)],{'method':_0x2a3395(0x1d2),'headers':{'Content-Type':_0x2a3395(0x174),'User-Agent':_0x2a3395(0x1ad)},'body':JSON['stringify'](_0xef1701)}),_0x73b483=Date['now']()-_0x1405ff;loggerService_1['loggerService'][_0x2a3395(0x12e)](_0x342633[_0x2a3395(0x1c6)],_0x1c62fc[_0x2a3395(0x15a)],_0x327780,_0xb102b6[_0x2a3395(0x19e)],_0x73b483,_0xef1701),console[_0x2a3395(0xe2)](_0x2a3395(0x16a)+_0x1c62fc[_0x2a3395(0x15a)]+'\x20with\x20status\x20'+_0xb102b6[_0x2a3395(0x19e)]+'\x20('+_0x73b483+'ms)');}catch(_0x2451fa){console[_0x2a3395(0x1e5)](_0x2a3395(0x1a4),_0x2451fa),loggerService_1[_0x2a3395(0x14a)][_0x2a3395(0x154)](_0x342633['shopId'],_0x342633['shop']?.[_0x2a3395(0xcf)]?.[_0x2a3395(0x15a)]||_0x2a3395(0x191),_0x2a3395(0xbe),_0x2451fa,{});}}['maskCardNumber'](_0xebd772){const _0x39f126=a48_0x462bd7,_0x4b3143=_0xebd772[_0x39f126(0x199)](/[\s-]/g,'');if(_0x4b3143[_0x39f126(0x13a)]<0x4)return _0x39f126(0xda);return _0x39f126(0x186)+_0x4b3143['slice'](-0x4);}async['processWebhook'](_0x2f1c80,_0x4df97d='MASTERCARD'){const _0x39b8a3=a48_0x462bd7;console[_0x39b8a3(0xe2)](_0x39b8a3(0x1b5),JSON[_0x39b8a3(0x1bf)](_0x2f1c80,null,0x2));let _0x2c9080=_0x2f1c80,_0x588ab0=_0x4df97d;_0x2f1c80[_0x39b8a3(0xf9)]?(_0x588ab0=_0x2f1c80['card_type']['toUpperCase']()===_0x39b8a3(0x146)?_0x39b8a3(0x146):_0x39b8a3(0x167),console[_0x39b8a3(0xe2)](_0x39b8a3(0x17a)+_0x588ab0)):console[_0x39b8a3(0xe2)](_0x39b8a3(0xf1)+_0x588ab0);if(_0x2f1c80[_0x39b8a3(0x152)]&&_0x2f1c80[_0x39b8a3(0x121)]&&_0x2f1c80[_0x39b8a3(0x106)]){console[_0x39b8a3(0xe2)]('🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...');try{const _0x448a03=await this['decryptResponsePhp'](_0x2f1c80['info'],_0x2f1c80[_0x39b8a3(0x121)],_0x588ab0);_0x2c9080=JSON[_0x39b8a3(0xbf)](_0x448a03),console[_0x39b8a3(0xe2)](_0x39b8a3(0x12b)),console[_0x39b8a3(0xe2)]('📝\x20Decrypted\x20webhook\x20data:',JSON[_0x39b8a3(0x1bf)](_0x2c9080,null,0x2));}catch(_0x2f7eb8){console[_0x39b8a3(0x1e5)](_0x39b8a3(0x103),_0x2f7eb8),console['log'](_0x39b8a3(0x158)),_0x2c9080=_0x2f1c80;}}else console[_0x39b8a3(0xe2)](_0x39b8a3(0x123));let _0x77200d=_0x39b8a3(0x109);if(_0x2c9080[_0x39b8a3(0x19e)]===0x64&&_0x2c9080[_0x39b8a3(0xcc)]===0x1)_0x77200d='PAID';else{if(_0x2c9080[_0x39b8a3(0xcc)]===0x0)_0x77200d='PENDING';else _0x2c9080[_0x39b8a3(0xcc)]===0x1&&_0x2c9080['status']!==0x64?_0x77200d=_0x39b8a3(0xbc):_0x77200d=_0x39b8a3(0x109);}let _0x17eeb9='';if(_0x2c9080['order_id'])_0x17eeb9=_0x2c9080[_0x39b8a3(0x15b)][_0x39b8a3(0x1a9)](),console['log'](_0x39b8a3(0x112)+_0x588ab0+_0x39b8a3(0x165)+_0x17eeb9);else _0x2c9080['payment_id']?(_0x17eeb9=_0x2c9080[_0x39b8a3(0x129)][_0x39b8a3(0x1a9)](),console[_0x39b8a3(0xe2)](_0x39b8a3(0x112)+_0x588ab0+'\x20payment_id\x20for\x20search:\x20'+_0x17eeb9)):(_0x17eeb9=_0x2c9080['orderId']||_0x2c9080['paymentId']||_0x2c9080['id']||'',console['log']('🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20'+_0x17eeb9));console['log'](_0x39b8a3(0x139)+_0x588ab0+_0x39b8a3(0x1e1)),console['log'](_0x39b8a3(0xe1)+_0x17eeb9+_0x39b8a3(0x19a)+_0x2c9080[_0x39b8a3(0x15b)]+_0x39b8a3(0xba)+_0x2c9080[_0x39b8a3(0x13d)]+',\x20payment_id='+_0x2c9080[_0x39b8a3(0x129)]+_0x39b8a3(0xed)+_0x2c9080[_0x39b8a3(0xe6)]+_0x39b8a3(0xf0)+_0x2c9080['id']+')'),console[_0x39b8a3(0xe2)]('\x20\x20\x20Status:\x20'+_0x77200d+_0x39b8a3(0x1cb)+_0x2c9080[_0x39b8a3(0x19e)]+_0x39b8a3(0x1b2)+_0x2c9080[_0x39b8a3(0xcc)]+')'),console[_0x39b8a3(0xe2)](_0x39b8a3(0x155)+_0x2c9080['amount']),console[_0x39b8a3(0xe2)](_0x39b8a3(0xfb)+_0x2c9080[_0x39b8a3(0xdf)]);let _0x1d0e92;_0x77200d===_0x39b8a3(0xbc)&&_0x2c9080[_0x39b8a3(0xf6)]&&(_0x1d0e92=_0x2c9080['desc'],console[_0x39b8a3(0xe2)](_0x39b8a3(0x151)+_0x1d0e92));const _0x507f16={'paymentId':_0x17eeb9,'status':_0x77200d,'amount':_0x2c9080[_0x39b8a3(0x1cf)],'currency':_0x2c9080[_0x39b8a3(0xdf)]};return _0x1d0e92&&(_0x507f16[_0x39b8a3(0x1e6)]=_0x1d0e92),_0x507f16;}['stopAllStatusChecks'](){const _0x4189f1=a48_0x462bd7;console[_0x4189f1(0xe2)](_0x4189f1(0x195));const _0xa97ae0=this[_0x4189f1(0x160)][_0x4189f1(0x1b3)];for(const [_0x3e78bc]of this['statusCheckTimers']){this[_0x4189f1(0x15f)](_0x3e78bc);}console[_0x4189f1(0xe2)](_0x4189f1(0x194)+_0xa97ae0+_0x4189f1(0x183));}}exports[a48_0x462bd7(0xee)]=VisaMasterCardService;