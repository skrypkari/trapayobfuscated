'use strict';const a68_0x408993=a68_0x3c73;(function(_0x476327,_0x309a04){const _0x314e00=a68_0x3c73,_0x214a8f=_0x476327();while(!![]){try{const _0x43a888=parseInt(_0x314e00(0x1dd))/0x1+-parseInt(_0x314e00(0xb4))/0x2*(parseInt(_0x314e00(0x155))/0x3)+-parseInt(_0x314e00(0x1aa))/0x4*(parseInt(_0x314e00(0x179))/0x5)+parseInt(_0x314e00(0x152))/0x6+-parseInt(_0x314e00(0xe7))/0x7+-parseInt(_0x314e00(0xd0))/0x8+parseInt(_0x314e00(0xd1))/0x9;if(_0x43a888===_0x309a04)break;else _0x214a8f['push'](_0x214a8f['shift']());}catch(_0x5186fe){_0x214a8f['push'](_0x214a8f['shift']());}}}(a68_0x2c54,0x8ee49));var __createBinding=this&&this[a68_0x408993(0x129)]||(Object['create']?function(_0x19f6c4,_0x100918,_0x3ade7d,_0x476f0b){const _0x2895a4=a68_0x408993;if(_0x476f0b===undefined)_0x476f0b=_0x3ade7d;var _0x349add=Object[_0x2895a4(0xae)](_0x100918,_0x3ade7d);(!_0x349add||(_0x2895a4(0x1f7)in _0x349add?!_0x100918['__esModule']:_0x349add[_0x2895a4(0x1f5)]||_0x349add[_0x2895a4(0x1ee)]))&&(_0x349add={'enumerable':!![],'get':function(){return _0x100918[_0x3ade7d];}}),Object['defineProperty'](_0x19f6c4,_0x476f0b,_0x349add);}:function(_0x3113cd,_0x381d6e,_0x51a6ba,_0x475c08){if(_0x475c08===undefined)_0x475c08=_0x51a6ba;_0x3113cd[_0x475c08]=_0x381d6e[_0x51a6ba];}),__setModuleDefault=this&&this[a68_0x408993(0x1bc)]||(Object['create']?function(_0xfdfcbb,_0x36dd67){const _0x5aef24=a68_0x408993;Object['defineProperty'](_0xfdfcbb,_0x5aef24(0xbd),{'enumerable':!![],'value':_0x36dd67});}:function(_0x543148,_0x287301){const _0x4db1a3=a68_0x408993;_0x543148[_0x4db1a3(0xbd)]=_0x287301;}),__importStar=this&&this['__importStar']||(function(){var _0x4cf4e7=function(_0x51d556){const _0x1a1961=a68_0x3c73;return _0x4cf4e7=Object[_0x1a1961(0x14e)]||function(_0x5b7f7a){const _0x162fdf=_0x1a1961;var _0x139987=[];for(var _0x8fd61a in _0x5b7f7a)if(Object[_0x162fdf(0x19f)][_0x162fdf(0x13d)][_0x162fdf(0xd3)](_0x5b7f7a,_0x8fd61a))_0x139987[_0x139987[_0x162fdf(0x15b)]]=_0x8fd61a;return _0x139987;},_0x4cf4e7(_0x51d556);};return function(_0x33938c){const _0x7b7880=a68_0x3c73;if(_0x33938c&&_0x33938c[_0x7b7880(0x147)])return _0x33938c;var _0x380a6d={};if(_0x33938c!=null){for(var _0x431abe=_0x4cf4e7(_0x33938c),_0x480197=0x0;_0x480197<_0x431abe[_0x7b7880(0x15b)];_0x480197++)if(_0x431abe[_0x480197]!==_0x7b7880(0xbd))__createBinding(_0x380a6d,_0x33938c,_0x431abe[_0x480197]);}return __setModuleDefault(_0x380a6d,_0x33938c),_0x380a6d;};}()),__importDefault=this&&this[a68_0x408993(0x1e9)]||function(_0x5aaa2b){const _0x58148e=a68_0x408993;return _0x5aaa2b&&_0x5aaa2b[_0x58148e(0x147)]?_0x5aaa2b:{'default':_0x5aaa2b};};function a68_0x2c54(){const _0x7b53d1=['Request\x20data\x20error','existsSync','loggerService','/charge_decrypt','\x20|\x20Response:\x20','üîê\x20VISA\x20Public\x20key\x20length:\x20','PENDING','6183919CPKeQu','Sender\x27s\x20CVV\x20card\x20is\x20required','decryptResponsePhp','apiUrl','/status_decrypted','4000000000000000','order_id','‚ö†Ô∏è\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','üí≥\x20VISA/MasterCard\x20service\x20initialized','masterCardApiUrl','getDetailedErrorMessage','3DS\x20verification\x20required','text','üîê\x20VISA\x20Private\x20key\x20path:','Number\x20of\x20attempts\x20exceeded','‚ùå\x20RSA\x20signing\x20failed:','\x22\x20|\x20\x22','customerEmail','error','Payment\x20System/1.0','then','‚úÖ\x20MasterCard\x20key\x20files\x20validated\x20successfully','\x20status\x20check\x20#','SHA256','webhookUrl','Payment\x20pending\x20verification','\x20\x20\x20Amount:\x20','unknown','‚úÖ\x20Payment\x20','Error\x20details:','\x20status\x20check\x20error:','delete','paymentStatuses','The\x20card\x20does\x20not\x20exist','\x20(from:\x20status=','warn','üîê\x20VISA\x20API\x20URL:','failed','\x20characters','LookUp\x20not\x20confirmed','üìä\x20','expire_month','getCardTypeAndApi','logShopWebhookSent','Payment\x20funds\x20are\x20reserved\x20for\x20refunding\x20a\x20previously\x20submitted\x20application','üìù\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','Payment\x20ID:','toUpperCase','paid','Failed\x20to\x20check\x20','/status_decrypt','The\x20transaction\x20is\x20not\x20authorized\x20by\x20the\x20issuing\x20bank','üìä\x20Status\x20check\x20result:','stringify','last_name','privateKeyPath','visaMerchantPointId','HTTP\x20error!\x20status:\x20','üìù\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','‚ùå\x20Data\x20being\x20signed:','psp_public.pem','\x20status\x20updated\x20to\x20','secretKey','Status\x20','üßπ\x20Card\x20holder\x20names\x20cleaned:','merchantPointId','__createBinding','Amount:','includes','VisaMasterCardService','üîÑ\x20Processing\x20MasterCard\x20webhook\x20data:','../loggerService','/charge','PHP\x20decryptor\x20error','Waiting\x20for\x20the\x20customer\x20to\x20scan\x20the\x20QR\x20code','toString','üîê\x20Data\x20encrypted\x20with\x20AES','payment_id','Awaiting\x20confirmation\x20of\x20the\x20login\x20password','\x20payment\x20status:\x20','üîê\x203DS\x20verification\x20required','\x20MasterCard\x20status\x20check\x20timers','‚úÖ\x20Scheduled\x20','),\x20defaulting\x20to\x20MasterCard','Card\x20Number:','defineProperty','hasOwnProperty','\x20\x20\x20-\x20method:\x20charge','signRSA','date_success','gatewayOrderId','card_type','decryptResponse','VISA',',\x20final=','Decryption\x20failed:\x20','__esModule','maskCardNumber','Failed\x20to\x20send\x20payment\x20notifications:','Awaiting\x20confirmation\x20by\x20ivr\x20call','\x20is\x20final\x20(','application/json','Invalid\x20expiration\x20date','getOwnPropertyNames','PAID','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','The\x20amount\x20has\x20been\x20successfully\x20blocked\x20on\x20the\x20sender\x27s\x20account','6032214IUvrng','‚ö†Ô∏è\x20Expected\x20VISA\x20public\x20key:\x20','statusCheckTimers','1993293yfzxOj','üîê\x20Response\x20is\x20encrypted,\x20decrypting...','final','masterCardMerchantPointId','üí≥\x20Detected\x20MasterCard\x20(starts\x20with\x205)','json','length','MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Another\x20unknown\x20error','üîç\x20Detected\x20card\x20type\x20from\x20webhook:\x20','decryptAES','üì¶\x20FULL\x20REQUEST\x20JSON:','visa_private.pem','üîê\x20MasterCard\x20Private\x20key\x20length:\x20','‚ùå\x20PHP\x20decryptor\x20request\x20failed:','none','sendShopWebhook','charge','‚úÖ\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','trim','****\x20****\x20****\x20','key','‚úÖ\x20VISA\x20key\x20files\x20validated\x20successfully','‚úÖ\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','\x20\x20\x20Status:\x20','Technical\x20limit,\x20contact\x20your\x20personal\x20manager','üõë\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','customerName','currency','Payment\x20confirmation\x20required','\x20\x20\x20-\x20info\x20length:','Payment\x20without\x203DS\x20is\x20prohibited,\x20payment\x20will\x20be\x20canceled','crypto','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','statusText','logWhiteDomainResponse','910iyFEFt','/status_raw','sha256','status','üîê\x20MasterCard\x20Private\x20key\x20path:','Error\x20parsing\x20webhook\x20events:','processWebhook','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','üìä\x20Checking\x20','\x20payment:\x20','cwd','\x20webhook\x20extracted\x20data:','üíæ\x20Payment\x20data\x20prepared','visa/mastercard','Result\x20URL:','message','\x20(from:\x20order_id=','visaPrivateKeyPath','Operation\x20completed\x20successfully','encryptRSA',',\x20body:\x20','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20',',\x20orderId=','https://api.paydmeth.com/api','clearStatusTimers','‚ùå\x20Status\x20check\x20#','charAt','first_name','üîê\x20Data\x20signed\x20with\x20RSA','visa_public.pem','\x20\x20\x20-\x20key\x20length:','The\x20card\x20is\x20lost\x20or\x20stolen',':\x20Unknown\x20status\x20code','üìä\x20Status\x20check\x20#','HTTP\x20','PIN\x20code\x20confirmation\x20awaited','),\x20stopping\x20status\x20checks','post_code','prototype','The\x20client\x27s\x20money\x20has\x20been\x20debited,\x20confirmation\x20of\x20delivery\x20of\x20the\x20goods\x20is\x20awaited','üìù\x20Data\x20to\x20sign\x20length:','postcode','slice','RSA_PKCS1_PADDING','üìç\x20Full\x20card\x20holder\x20data:','info','-----END','randomBytes','payment.failed','8884xoYXBH','description','validateKeyFiles','MasterCard\x20webhook\x20sent\x20to\x20','Client\x20OTP\x20confirmation\x20required','üîê\x20MasterCard\x20API\x20URL:','isArray','encryptAES','Payment\x20confirmation\x20time\x20has\x20expired','POST','paymentId','expire_year','Recipient\x20data\x20required','üîç\x20','‚úÖ\x20Payment\x20successful','Order\x20ID:','‚ö†Ô∏è\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','amount','__setModuleDefault','settings','‚ö†Ô∏è\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','../telegramBotService','\x20\x20Original:\x20\x22','visaApiUrl','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','-----BEGIN','\x20API:\x20','Expected\x20bitcoin\x20transfer\x20from\x20client','üîç\x20Using\x20fallback\x20fields\x20for\x20search:\x20','\x20order_id\x20for\x20search:\x20','set','join','createHmac',',\x20Final:\x20','Cash\x20payment\x20is\x20expected\x20at\x20TCO','Status\x20decryption\x20failed:\x20','‚ö†Ô∏è\x20Expected\x20VISA\x20private\x20key:\x20','updatePaymentStatus','createdAt','‚ùå\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','===\x20PARSED\x20API\x20RESPONSE\x20===','utf8','resolve','publicEncrypt','payment','../../config/database','‚ùå\x20Detailed\x20failure\x20description:\x20','Test\x20payment','webhookEvents','/status','from','151383NdDGfI','isFinalStatus','sign','toLowerCase','Sender\x27s\x20card\x20details\x20are\x20required','No\x20New\x20payment','aes-256-ctr','replace','üîÑ\x20Converted\x20postcode\x20to\x20post_code:\x20','****','Response\x20Time:','ms)','__importDefault','forEach','path','‚ùå\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','The\x20payment\x20status\x20must\x20be\x20clarified\x20manually','configurable','Payment\x20returned','===\x20API\x20RESPONSE\x20===','\x20\x20\x20Currency:\x20','\x20\x20\x20','https://api.myatranz.com/api','The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending','writable','üîç\x20Using\x20provided\x20card\x20type:\x20','get','üìù\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','Status:','Status\x20Text:','\x20\x20\x20-\x20sign\x20length:','1111','‚è∞\x20Will\x20check\x20status\x20','üîê\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','üíæ\x20Saving\x20failure\x20message:\x20','keys','Failed\x20to\x20send\x20MasterCard\x20webhook:','Waiting\x20for\x20confirmation\x20of\x20payment\x20by\x20the\x20client\x20in\x20the\x20application','...','\x20payment_id\x20for\x20search:\x20','processCardPayment','hex','Waiting\x20for\x20client\x20to\x20enter\x20phone\x20number','log','\x20not\x20enabled\x20for\x20shop\x20','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','update','üîê\x20Using\x20keys:\x20',',\x20Desc:\x20','errorMessage',',\x20paymentId=','checkPaymentStatus','Cancellation\x20is\x20not\x20possible','Payment\x20using\x20the\x20specified\x20details\x20is\x20no\x20longer\x20possible','Payment\x20System/1.0\x20(MasterCard)','base64','Payment\x20returned,\x20carried\x20out\x20under\x20a\x20different\x20ID','Failed\x20payment','üéØ\x20Using\x20','webhook_send','system','shop','Final:','üìù\x20Final\x20request\x20structure:','MASTERCARD','Payment\x20prohibited','\x20\x20\x20-\x20merchant_point_id:','getOwnPropertyDescriptor','payment.success','/charge_raw','üîç\x20Using\x20','üí≥\x20Unknown\x20card\x20type\x20(starts\x20with\x20','The\x20payment\x20has\x20been\x20created\x20and\x20is\x20awaiting\x20completion\x20by\x20the\x20sender','2VmqkbE','üõë\x20Stopped\x20','üìù\x20Data\x20length:','now','üîê\x20AES\x20key\x20and\x20IV\x20generated','FAILED','Return\x20URL:','LookUp\x20code\x20verified','substring','default','generateAESKey','cvv','orderId','\x20status\x20timers\x20for\x20payment\x20','Payment\x20not\x20found\x20using\x20the\x20specified\x20details','scheduleStatusChecks','logWhiteDomainRequest','‚úÖ\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP','üì§\x20Sending\x20request\x20to\x20API...','publicKeyPath','/charge_decrypted','parse','cardType','Unsuccessful\x20payment','sendPaymentNotifications','Unknown\x20error','3ds_url','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','1758320RzHOHs','14403573mmFSHf','üìù\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','call','üìù\x20Decrypted\x20webhook\x20data:','Response\x20Headers:','‚ùå\x20Failed\x20to\x20decrypt\x20status\x20response:','readFileSync','üîê\x20VISA\x20Private\x20key\x20length:\x20','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','üßπ\x20Clearing\x20','paidAt','No\x20Error\x20executing\x20request','visaPublicKeyPath','üîê\x20MasterCard\x20Public\x20key\x20length:\x20','logWhiteDomainError'];a68_0x2c54=function(){return _0x7b53d1;};return a68_0x2c54();}Object[a68_0x408993(0x13c)](exports,a68_0x408993(0x147),{'value':!![]}),exports[a68_0x408993(0x12c)]=void 0x0;const crypto_1=__importDefault(require(a68_0x408993(0x175))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a68_0x408993(0x1eb))),loggerService_1=require(a68_0x408993(0x12e));class VisaMasterCardService{constructor(){const _0x27a637=a68_0x408993;this[_0x27a637(0x154)]=new Map(),this['paymentStatuses']={0x0:{'final':![],'description':_0x27a637(0x1e2)},0x1:{'final':![],'description':_0x27a637(0xdc)},0x2:{'final':!![],'description':_0x27a637(0xe0)},0x3:{'final':!![],'description':_0x27a637(0x15d)},0x4:{'final':!![],'description':_0x27a637(0xcb)},0x5:{'final':!![],'description':_0x27a637(0xc2)},0x6:{'final':!![],'description':'Payment\x20returned'},0x7:{'final':!![],'description':_0x27a637(0x1d9)},0x8:{'final':![],'description':_0x27a637(0x1ae)},0x9:{'final':![],'description':_0x27a637(0xf2)},0xa:{'final':![],'description':_0x27a637(0xe8)},0xb:{'final':![],'description':'Sender\x20information\x20required'},0xc:{'final':![],'description':_0x27a637(0x1b6)},0xd:{'final':![],'description':_0x27a637(0x207)},0xe:{'final':![],'description':_0x27a637(0x14a)},0xf:{'final':![],'description':_0x27a637(0x19c)},0x10:{'final':![],'description':'Captcha\x20confirmation\x20awaited'},0x11:{'final':![],'description':_0x27a637(0x135)},0x12:{'final':![],'description':'Awaiting\x20confirmation\x20in\x20the\x20application'},0x13:{'final':![],'description':'Payment\x20is\x20being\x20processed'},0x14:{'final':![],'description':_0x27a637(0xb3)},0x15:{'final':![],'description':_0x27a637(0x1c5)},0x16:{'final':![],'description':_0x27a637(0x100)},0x18:{'final':![],'description':_0x27a637(0x1a0)},0x19:{'final':![],'description':_0x27a637(0x151)},0x1a:{'final':!![],'description':_0x27a637(0x1cc)},0x1b:{'final':![],'description':_0x27a637(0x131)},0x1c:{'final':![],'description':_0x27a637(0x202)},0x1d:{'final':![],'description':'The\x20method\x20of\x20reimbursement\x20from\x20the\x20recipient\x20has\x20not\x20been\x20established'},0x1f:{'final':![],'description':_0x27a637(0x1f4)},0x20:{'final':![],'description':_0x27a637(0x113)},0x23:{'final':![],'description':_0x27a637(0x1e1)},0x24:{'final':!![],'description':_0x27a637(0x1b2)},0x25:{'final':!![],'description':_0x27a637(0xac)},0x26:{'final':!![],'description':_0x27a637(0x1ed)},0x27:{'final':!![],'description':'Insufficient\x20funds\x20on\x20the\x20card'},0x28:{'final':!![],'description':_0x27a637(0x108)},0x29:{'final':!![],'description':_0x27a637(0x198)},0x2a:{'final':!![],'description':_0x27a637(0x14d)},0x2b:{'final':!![],'description':'Transaction\x20limit\x20exceeded'},0x2c:{'final':!![],'description':_0x27a637(0x11a)},0x2d:{'final':!![],'description':'Failed\x20payment'},0x2e:{'final':!![],'description':'Unsuccessful\x20payment'},0x2f:{'final':!![],'description':'Unsuccessful\x20payment'},0x30:{'final':!![],'description':_0x27a637(0x174)},0x31:{'final':![],'description':_0x27a637(0x172)},0x32:{'final':!![],'description':'Method\x20not\x20allowed'},0x33:{'final':!![],'description':_0x27a637(0xa4)},0x34:{'final':!![],'description':_0x27a637(0xa4)},0x35:{'final':!![],'description':_0x27a637(0xa4)},0x36:{'final':!![],'description':_0x27a637(0xa4)},0x37:{'final':!![],'description':_0x27a637(0xa4)},0x38:{'final':!![],'description':_0x27a637(0x211)},0x39:{'final':![],'description':'The\x20invoice\x20was\x20created\x20successfully,\x20payment\x20is\x20pending\x20at\x20the\x20bank'},0x3a:{'final':![],'description':'LookUp\x20code\x20sent'},0x3b:{'final':!![],'description':_0x27a637(0xbb)},0x3c:{'final':!![],'description':_0x27a637(0xf5)},0x3d:{'final':!![],'description':_0x27a637(0x212)},0x3e:{'final':!![],'description':_0x27a637(0xa3)},0x3f:{'final':!![],'description':_0x27a637(0x1ef)},0x40:{'final':![],'description':_0x27a637(0x10e)},0x41:{'final':!![],'description':'LookUp\x20number\x20of\x20attempts\x20exceeded'},0x42:{'final':![],'description':'Payment\x20cancellation\x20is\x20being\x20processed'},0x43:{'final':!![],'description':_0x27a637(0x16e)},0x44:{'final':![],'description':'3DS\x20verification\x20required'},0x45:{'final':!![],'description':_0x27a637(0xa4)},0x46:{'final':!![],'description':_0x27a637(0xa4)},0x47:{'final':!![],'description':'Card\x20token\x20was\x20not\x20found\x20using\x20the\x20specified\x20details'},0x64:{'final':!![],'description':_0x27a637(0x18b)}},this[_0x27a637(0xf0)]=_0x27a637(0x1f3),this['masterCardMerchantPointId']=0x50ca,this[_0x27a637(0x11e)]=path_1[_0x27a637(0xbd)][_0x27a637(0x1c9)](process['cwd'](),_0x27a637(0x200),'private.pem'),this['publicKeyPath']=path_1[_0x27a637(0xbd)][_0x27a637(0x1c9)](process[_0x27a637(0x183)](),_0x27a637(0x200),_0x27a637(0x123)),this[_0x27a637(0x1c1)]=_0x27a637(0x190),this['visaMerchantPointId']=0x6b7,this[_0x27a637(0x18a)]=path_1[_0x27a637(0xbd)][_0x27a637(0x1c9)](process[_0x27a637(0x183)](),'keys',_0x27a637(0x161)),this[_0x27a637(0xdd)]=path_1['default'][_0x27a637(0x1c9)](process[_0x27a637(0x183)](),_0x27a637(0x200),_0x27a637(0x196)),console[_0x27a637(0x208)](_0x27a637(0xef)),console['log'](_0x27a637(0x1af),this[_0x27a637(0xf0)]),console[_0x27a637(0x208)](_0x27a637(0x10b),this[_0x27a637(0x1c1)]),console[_0x27a637(0x208)](_0x27a637(0x17d),this[_0x27a637(0x11e)]),console[_0x27a637(0x208)]('üîê\x20MasterCard\x20Public\x20key\x20path:',this[_0x27a637(0xc7)]),console[_0x27a637(0x208)](_0x27a637(0xf4),this[_0x27a637(0x18a)]),console['log']('üîê\x20VISA\x20Public\x20key\x20path:',this[_0x27a637(0xdd)]),this[_0x27a637(0x1ac)]();}[a68_0x408993(0xf1)](_0x280bdf,_0x48d496){const _0x2ce0aa=a68_0x408993,_0x3d64f8=this[_0x2ce0aa(0x107)][_0x280bdf];let _0x495b6e='';_0x3d64f8?_0x495b6e='Status\x20'+_0x280bdf+':\x20'+_0x3d64f8[_0x2ce0aa(0x1ab)]:_0x495b6e=_0x2ce0aa(0x126)+_0x280bdf+_0x2ce0aa(0x199);if(_0x48d496&&_0x48d496[_0x2ce0aa(0x168)]()){const _0x12c969=_0x48d496[_0x2ce0aa(0x168)]();(!_0x3d64f8||_0x12c969[_0x2ce0aa(0x1e0)]()!==_0x3d64f8[_0x2ce0aa(0x1ab)]['toLowerCase']())&&(_0x495b6e+=_0x2ce0aa(0xe4)+_0x12c969);}return _0x495b6e;}[a68_0x408993(0x1de)](_0x19c67c){const _0x419c57=a68_0x408993,_0x299152=this[_0x419c57(0x107)][_0x19c67c];return _0x299152?_0x299152[_0x419c57(0x157)]:!![];}[a68_0x408993(0x111)](_0x3e01b9){const _0x3c1259=a68_0x408993,_0x1a00ab=_0x3e01b9[_0x3c1259(0x193)](0x0);if(_0x1a00ab==='4')return console[_0x3c1259(0x208)]('üí≥\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)'),{'cardType':_0x3c1259(0x144),'apiUrl':this[_0x3c1259(0x1c1)],'privateKeyPath':this[_0x3c1259(0x18a)],'publicKeyPath':this[_0x3c1259(0xdd)],'merchantPointId':this[_0x3c1259(0x11f)]};else return _0x1a00ab==='5'?(console[_0x3c1259(0x208)](_0x3c1259(0x159)),{'cardType':_0x3c1259(0xab),'apiUrl':this[_0x3c1259(0xf0)],'privateKeyPath':this[_0x3c1259(0x11e)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this[_0x3c1259(0x158)]}):(console[_0x3c1259(0x208)](_0x3c1259(0xb2)+_0x1a00ab+_0x3c1259(0x13a)),{'cardType':_0x3c1259(0xab),'apiUrl':this[_0x3c1259(0xf0)],'privateKeyPath':this[_0x3c1259(0x11e)],'publicKeyPath':this[_0x3c1259(0xc7)],'merchantPointId':this[_0x3c1259(0x158)]});}[a68_0x408993(0x1ac)](){const _0xc87227=a68_0x408993;try{if(!fs_1[_0xc87227(0xbd)][_0xc87227(0xe1)](this[_0xc87227(0x11e)]))throw new Error(_0xc87227(0x18e)+this['privateKeyPath']);if(!fs_1['default'][_0xc87227(0xe1)](this[_0xc87227(0xc7)]))throw new Error(_0xc87227(0xd9)+this[_0xc87227(0xc7)]);const _0x4d6754=fs_1[_0xc87227(0xbd)]['readFileSync'](this[_0xc87227(0x11e)],'utf8')[_0xc87227(0x168)](),_0x162b76=fs_1[_0xc87227(0xbd)][_0xc87227(0xd7)](this[_0xc87227(0xc7)],_0xc87227(0x1d3))[_0xc87227(0x168)]();if(!_0x4d6754[_0xc87227(0x12b)]('-----BEGIN')||!_0x4d6754[_0xc87227(0x12b)](_0xc87227(0x1a7)))throw new Error(_0xc87227(0x15c));if(!_0x162b76['includes'](_0xc87227(0x1c3))||!_0x162b76[_0xc87227(0x12b)](_0xc87227(0x1a7)))throw new Error(_0xc87227(0x150));console[_0xc87227(0x208)](_0xc87227(0xfc)),console['log'](_0xc87227(0x162)+_0x4d6754['length']+_0xc87227(0x10d)),console[_0xc87227(0x208)](_0xc87227(0xde)+_0x162b76[_0xc87227(0x15b)]+'\x20characters');if(fs_1[_0xc87227(0xbd)][_0xc87227(0xe1)](this[_0xc87227(0x18a)])&&fs_1['default']['existsSync'](this['visaPublicKeyPath'])){const _0x34e9d3=fs_1[_0xc87227(0xbd)][_0xc87227(0xd7)](this[_0xc87227(0x18a)],_0xc87227(0x1d3))[_0xc87227(0x168)](),_0x776ad9=fs_1['default']['readFileSync'](this[_0xc87227(0xdd)],_0xc87227(0x1d3))[_0xc87227(0x168)]();(!_0x34e9d3[_0xc87227(0x12b)](_0xc87227(0x1c3))||!_0x34e9d3[_0xc87227(0x12b)](_0xc87227(0x1a7)))&&console[_0xc87227(0x10a)](_0xc87227(0xee)),(!_0x776ad9[_0xc87227(0x12b)](_0xc87227(0x1c3))||!_0x776ad9['includes'](_0xc87227(0x1a7)))&&console[_0xc87227(0x10a)](_0xc87227(0x1be)),console[_0xc87227(0x208)](_0xc87227(0x16b)),console[_0xc87227(0x208)](_0xc87227(0xd8)+_0x34e9d3[_0xc87227(0x15b)]+_0xc87227(0x10d)),console[_0xc87227(0x208)](_0xc87227(0xe5)+_0x776ad9[_0xc87227(0x15b)]+_0xc87227(0x10d));}else console['warn']('‚ö†Ô∏è\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available'),console[_0xc87227(0x10a)](_0xc87227(0x1ce)+this[_0xc87227(0x18a)]),console['warn'](_0xc87227(0x153)+this[_0xc87227(0xdd)]);}catch(_0x50d0e9){console[_0xc87227(0xf9)]('‚ùå\x20VISA/MasterCard\x20key\x20validation\x20failed:',_0x50d0e9);throw _0x50d0e9;}}['generateAESKey'](){const _0xd0a13e=a68_0x408993,_0x273635=crypto_1['default'][_0xd0a13e(0x1a8)](0x20),_0x33b311=crypto_1[_0xd0a13e(0xbd)][_0xd0a13e(0x1a8)](0x10);return{'key':_0x273635,'iv':_0x33b311};}[a68_0x408993(0x1b1)](_0x3d29a0,_0x57fd58,_0x279a9c){const _0x221d01=a68_0x408993,_0x258319=crypto_1['default']['createCipheriv'](_0x221d01(0x1e3),_0x57fd58,_0x279a9c);let _0x146114=_0x258319[_0x221d01(0x20b)](_0x3d29a0,_0x221d01(0x1d3),'base64');return _0x146114+=_0x258319[_0x221d01(0x157)](_0x221d01(0xa2)),_0x146114;}[a68_0x408993(0x18c)](_0xe40644,_0x282212,_0xc01cc9){const _0x3901fa=a68_0x408993;try{const _0x42ebfb=fs_1['default'][_0x3901fa(0xd7)](_0xc01cc9,_0x3901fa(0x1d3))[_0x3901fa(0x168)](),_0x452309={'iv':_0x282212[_0x3901fa(0x132)](_0x3901fa(0xa2)),'key':_0xe40644['toString'](_0x3901fa(0xa2))},_0x1a5378=JSON[_0x3901fa(0x11c)](_0x452309);console['log']('üîê\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:',_0x1a5378[_0x3901fa(0x15b)]);const _0x1f830b=crypto_1[_0x3901fa(0xbd)][_0x3901fa(0x1d5)]({'key':_0x42ebfb,'padding':crypto_1[_0x3901fa(0xbd)]['constants'][_0x3901fa(0x1a4)]},Buffer[_0x3901fa(0x1dc)](_0x1a5378));return console['log'](_0x3901fa(0x16c),_0x1f830b['length']),_0x1f830b[_0x3901fa(0x132)](_0x3901fa(0xa2));}catch(_0xd2dd4f){console['error']('‚ùå\x20RSA\x20encryption\x20failed:',_0xd2dd4f);throw new Error(_0x3901fa(0xcf));}}[a68_0x408993(0x13f)](_0x10d534,_0x5e0438){const _0x739215=a68_0x408993;try{const _0x235181=fs_1[_0x739215(0xbd)][_0x739215(0xd7)](_0x5e0438,_0x739215(0x1d3))['trim'](),_0x2ce56a=crypto_1[_0x739215(0xbd)]['createSign'](_0x739215(0xfe));_0x2ce56a[_0x739215(0x20b)](_0x10d534),_0x2ce56a['end']();const _0x17993b=_0x2ce56a[_0x739215(0x1df)](_0x235181,_0x739215(0xa2));return console[_0x739215(0x208)]('üîê\x20RSA\x20signing\x20successful'),console[_0x739215(0x208)](_0x739215(0x1a1),_0x10d534['length']),console[_0x739215(0x208)]('üìù\x20Signature\x20length:',_0x17993b['length']),_0x17993b;}catch(_0x115bba){console[_0x739215(0xf9)](_0x739215(0xf6),_0x115bba),console[_0x739215(0xf9)](_0x739215(0x122),_0x10d534[_0x739215(0xbc)](0x0,0xc8)+_0x739215(0x203));throw new Error(_0x739215(0x176));}}['decryptAES'](_0x5a63b5,_0xfa3140,_0x2f8d0c){const _0x2dbeeb=a68_0x408993,_0x1cd5fa=crypto_1[_0x2dbeeb(0xbd)]['createDecipheriv'](_0x2dbeeb(0x1e3),_0xfa3140,_0x2f8d0c);let _0x288a73=_0x1cd5fa[_0x2dbeeb(0x20b)](_0x5a63b5,_0x2dbeeb(0xa2),'utf8');return _0x288a73+=_0x1cd5fa[_0x2dbeeb(0x157)](_0x2dbeeb(0x1d3)),_0x288a73;}async['decryptResponsePhp'](_0x156875,_0x277d66,_0x10dc84=a68_0x408993(0xab)){const _0x3beb80=a68_0x408993;try{const _0x2192fd=await fetch('https://api2.trapay.uk/decrypt.php',{'method':_0x3beb80(0x1b3),'headers':{'Content-Type':_0x3beb80(0x14c)},'body':JSON[_0x3beb80(0x11c)]({'info':_0x156875,'key':_0x277d66,'card_type':_0x10dc84[_0x3beb80(0x1e0)]()})});if(!_0x2192fd['ok'])throw new Error(_0x3beb80(0x130));return await _0x2192fd[_0x3beb80(0xf3)]();}catch(_0x3ae649){console['error'](_0x3beb80(0x163),_0x3ae649);throw new Error(_0x3beb80(0x20a));}}[a68_0x408993(0x143)](_0x3f99e4,_0x35f959){const _0x2a5706=a68_0x408993;try{const _0x576853=fs_1[_0x2a5706(0xbd)][_0x2a5706(0xd7)](this[_0x2a5706(0x11e)],_0x2a5706(0x1d3))[_0x2a5706(0x168)](),_0x4e96ff=crypto_1[_0x2a5706(0xbd)]['privateDecrypt'](_0x576853,Buffer[_0x2a5706(0x1dc)](_0x35f959,_0x2a5706(0xa2))),_0x1ba730=JSON[_0x2a5706(0xc9)](_0x4e96ff[_0x2a5706(0x132)]()),_0x2ffbaa=Buffer[_0x2a5706(0x1dc)](_0x1ba730['key'],'base64'),_0x307061=Buffer[_0x2a5706(0x1dc)](_0x1ba730['iv'],_0x2a5706(0xa2));return this[_0x2a5706(0x15f)](_0x3f99e4,_0x2ffbaa,_0x307061);}catch(_0xec47c3){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a68_0x408993(0x205)](_0x442851){const _0x180c12=a68_0x408993,{paymentId:_0x312359,orderId:_0x37c066,amount:_0x371337,currency:_0x97867d,cardData:_0x55e21c,resultUrl:_0x1bd6ec,returnUrl:_0x3409cc,cardHolder:_0x461382,browser:_0x3c856d}=_0x442851;console[_0x180c12(0x208)]('===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20==='),console[_0x180c12(0x208)](_0x180c12(0x115),_0x312359),console[_0x180c12(0x208)](_0x180c12(0x1b9),_0x37c066),console['log'](_0x180c12(0x12a),_0x371337,_0x97867d),console[_0x180c12(0x208)](_0x180c12(0x13b),this[_0x180c12(0x148)](_0x55e21c['number'])),console[_0x180c12(0x208)]('Card\x20Holder:',_0x461382['first_name']+'\x20'+_0x461382['last_name']),console[_0x180c12(0x208)](_0x180c12(0xba),_0x3409cc),console[_0x180c12(0x208)](_0x180c12(0x187),_0x1bd6ec);const _0x5a86e9=this[_0x180c12(0x111)](_0x55e21c['number']);console['log'](_0x180c12(0xa5)+_0x5a86e9['cardType']+_0x180c12(0x1c4)+_0x5a86e9[_0x180c12(0xea)]),console[_0x180c12(0x208)](_0x180c12(0x20c)+_0x5a86e9[_0x180c12(0x11e)]+',\x20'+_0x5a86e9['publicKeyPath']);const _0x9c44cc={..._0x461382,'first_name':_0x461382['first_name']?.[_0x180c12(0x1e4)](/[\t\n\r\f\v]/g,'\x20')[_0x180c12(0x168)]()||'','last_name':_0x461382['last_name']?.[_0x180c12(0x1e4)](/[\t\n\r\f\v]/g,'\x20')[_0x180c12(0x168)]()||''};_0x180c12(0x1a2)in _0x9c44cc&&!('post_code'in _0x9c44cc)&&(_0x9c44cc[_0x180c12(0x19e)]=_0x9c44cc[_0x180c12(0x1a2)],delete _0x9c44cc[_0x180c12(0x1a2)],console['log'](_0x180c12(0x1e5)+_0x9c44cc[_0x180c12(0x19e)]));console['log'](_0x180c12(0x127)),console[_0x180c12(0x208)](_0x180c12(0x1c0)+_0x461382['first_name']+_0x180c12(0xf7)+_0x461382['last_name']+'\x22'),console['log']('\x20\x20Cleaned:\x20\x20\x22'+_0x9c44cc[_0x180c12(0x194)]+'\x22\x20|\x20\x22'+_0x9c44cc[_0x180c12(0x11d)]+'\x22'),console[_0x180c12(0x208)](_0x180c12(0x1a5),JSON[_0x180c12(0x11c)](_0x9c44cc,null,0x2));const _0x30abb7={'amount':_0x371337,'currency':_0x97867d[_0x180c12(0x116)](),'order_id':_0x37c066,'result_url':_0x1bd6ec,'return_url':_0x3409cc,'country':_0x9c44cc['country']||'','card':{'number':_0x55e21c['number'],'expire_month':_0x55e21c[_0x180c12(0x110)],'expire_year':_0x55e21c[_0x180c12(0x1b5)],'cvv':_0x55e21c[_0x180c12(0xbf)]},'card_holder':_0x9c44cc,'browser':_0x3c856d},_0x5dde14=JSON[_0x180c12(0x11c)](_0x30abb7);console[_0x180c12(0x208)](_0x180c12(0x185)),console['log']('üìù\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console[_0x180c12(0x208)](_0x5dde14),console['log'](_0x180c12(0xb6),_0x5dde14[_0x180c12(0x15b)]);try{const {key:_0x50d98b,iv:_0x25f533}=this[_0x180c12(0xbe)]();console['log'](_0x180c12(0xb8)),console[_0x180c12(0x208)]('üîê\x20AES\x20key\x20length:',_0x50d98b[_0x180c12(0x15b)]),console[_0x180c12(0x208)]('üîê\x20AES\x20IV\x20length:',_0x25f533['length']);const _0x41b07a=this[_0x180c12(0x1b1)](_0x5dde14,_0x50d98b,_0x25f533);console[_0x180c12(0x208)](_0x180c12(0x133)),console[_0x180c12(0x208)]('üìù\x20Encrypted\x20data\x20length:',_0x41b07a['length']);const _0x3bb6c8=this['encryptRSA'](_0x50d98b,_0x25f533,_0x5a86e9['publicKeyPath']);console[_0x180c12(0x208)]('üîê\x20AES\x20key+IV\x20encrypted\x20with\x20RSA'),console[_0x180c12(0x208)]('üìù\x20Encrypted\x20key\x20length:',_0x3bb6c8['length']);const _0x3a98ef=this['signRSA'](_0x5dde14,_0x5a86e9[_0x180c12(0x11e)]);console['log'](_0x180c12(0x195)),console['log']('üìù\x20Signature\x20length:',_0x3a98ef[_0x180c12(0x15b)]);const _0x583be7={'merchant_point_id':_0x5a86e9[_0x180c12(0x128)],'method':_0x180c12(0x166),'info':_0x41b07a,'key':_0x3bb6c8,'sign':_0x3a98ef,'lang':'en'};console[_0x180c12(0x208)](_0x180c12(0xc6)),console[_0x180c12(0x208)](_0x180c12(0xaa)),console[_0x180c12(0x208)](_0x180c12(0xad),_0x5a86e9[_0x180c12(0x128)]),console[_0x180c12(0x208)](_0x180c12(0x13e)),console[_0x180c12(0x208)](_0x180c12(0x173),_0x41b07a[_0x180c12(0x15b)]),console[_0x180c12(0x208)](_0x180c12(0x197),_0x3bb6c8[_0x180c12(0x15b)]),console[_0x180c12(0x208)](_0x180c12(0x1fb),_0x3a98ef['length']),console[_0x180c12(0x208)]('\x20\x20\x20-\x20lang:\x20en'),console[_0x180c12(0x208)](''),console['log'](_0x180c12(0x160)),console[_0x180c12(0x208)](JSON['stringify'](_0x583be7,null,0x2)),console[_0x180c12(0x208)](''),loggerService_1[_0x180c12(0xe2)][_0x180c12(0xc4)](_0x5a86e9[_0x180c12(0xca)][_0x180c12(0x1e0)](),_0x180c12(0x12f),_0x180c12(0x1b3),{'merchant_point_id':_0x5a86e9['merchantPointId'],'method':_0x180c12(0x166),'lang':'en'});const _0x34774f=Date[_0x180c12(0xb7)](),_0x1d61a8=await fetch(_0x5a86e9[_0x180c12(0xea)],{'method':_0x180c12(0x1b3),'headers':{'Content-Type':'application/json','Accept':_0x180c12(0x14c),'User-Agent':_0x180c12(0xfa)},'body':JSON['stringify'](_0x583be7)}),_0x4f524d=Date[_0x180c12(0xb7)]()-_0x34774f;console[_0x180c12(0x208)](_0x180c12(0x1f0)),console['log']('Status:',_0x1d61a8['status']),console[_0x180c12(0x208)](_0x180c12(0x1fa),_0x1d61a8[_0x180c12(0x177)]),console['log'](_0x180c12(0x1e7),_0x4f524d+'ms'),console[_0x180c12(0x208)](_0x180c12(0xd5)),_0x1d61a8['headers'][_0x180c12(0x1ea)]((_0x3925da,_0x499ccf)=>{const _0x495e18=_0x180c12;console[_0x495e18(0x208)](_0x495e18(0x1f2)+_0x499ccf+':\x20'+_0x3925da);}),console[_0x180c12(0x208)]('');if(!_0x1d61a8['ok']){const _0x1ffd05=await _0x1d61a8['text']();console[_0x180c12(0xf9)]('HTTP\x20Status:',_0x1d61a8['status']),console[_0x180c12(0xf9)]('üì¶\x20FULL\x20RESPONSE\x20BODY:'),console['error'](_0x1ffd05),console[_0x180c12(0xf9)](''),loggerService_1[_0x180c12(0xe2)][_0x180c12(0x178)](_0x5a86e9[_0x180c12(0xca)][_0x180c12(0x1e0)](),_0x180c12(0xb0),_0x1d61a8['status'],_0x1ffd05,_0x4f524d),loggerService_1['loggerService'][_0x180c12(0xdf)](_0x5a86e9[_0x180c12(0xca)][_0x180c12(0x1e0)](),'/charge',_0x180c12(0x19b)+_0x1d61a8[_0x180c12(0x17c)]+':\x20'+_0x1ffd05);throw new Error(_0x180c12(0x120)+_0x1d61a8[_0x180c12(0x17c)]+_0x180c12(0x18d)+_0x1ffd05);}const _0x119b07=await _0x1d61a8['json']();console['log']('üì¶\x20FULL\x20RESPONSE\x20JSON:'),console[_0x180c12(0x208)](JSON[_0x180c12(0x11c)](_0x119b07,null,0x2)),console['log'](''),loggerService_1[_0x180c12(0xe2)][_0x180c12(0x178)](_0x5a86e9[_0x180c12(0xca)]['toLowerCase'](),'/charge_raw',_0x1d61a8[_0x180c12(0x17c)],_0x119b07,_0x4f524d),console['log'](_0x180c12(0x1d2));let _0x374f3c=_0x119b07;if(_0x119b07['info']&&_0x119b07[_0x180c12(0x16a)]&&_0x119b07[_0x180c12(0x1df)]){console[_0x180c12(0x208)](_0x180c12(0x156));try{const _0x1ef11a=await this[_0x180c12(0xe9)](_0x119b07[_0x180c12(0x1a6)],_0x119b07[_0x180c12(0x16a)],_0x5a86e9[_0x180c12(0xca)]);_0x374f3c=JSON[_0x180c12(0xc9)](_0x1ef11a),console[_0x180c12(0x208)](_0x180c12(0x167)),loggerService_1[_0x180c12(0xe2)][_0x180c12(0x178)](_0x5a86e9['cardType'][_0x180c12(0x1e0)](),'/charge_decrypted',_0x1d61a8[_0x180c12(0x17c)],_0x374f3c,_0x4f524d),console[_0x180c12(0x208)](_0x180c12(0x1f8));}catch(_0x26af8f){console['error'](_0x180c12(0x1ec),_0x26af8f),loggerService_1[_0x180c12(0xe2)][_0x180c12(0xdf)](_0x5a86e9[_0x180c12(0xca)]['toLowerCase'](),_0x180c12(0xe3),_0x180c12(0x146)+_0x26af8f),_0x374f3c=_0x119b07;}}else loggerService_1[_0x180c12(0xe2)][_0x180c12(0x178)](_0x5a86e9['cardType'][_0x180c12(0x1e0)](),_0x180c12(0xc8),_0x1d61a8['status'],_0x374f3c,_0x4f524d),console[_0x180c12(0x208)]('üìù\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console[_0x180c12(0x208)](_0x180c12(0x1f9),_0x374f3c[_0x180c12(0x17c)]),console[_0x180c12(0x208)](_0x180c12(0xa9),_0x374f3c[_0x180c12(0x157)]),console[_0x180c12(0x208)]('Payment\x20ID:',_0x374f3c['payment_id']),console[_0x180c12(0x208)]('3DS\x20URL:',_0x374f3c['3ds_url']||_0x180c12(0x164));if(_0x374f3c[_0x180c12(0x17c)]===0x64&&_0x374f3c[_0x180c12(0x157)]===0x1)return console[_0x180c12(0x208)](_0x180c12(0x1b8)),{'gateway_payment_id':_0x374f3c[_0x180c12(0x134)]?.[_0x180c12(0x132)](),'payment_url':_0x3409cc,'requires_3ds':![],'status':_0x180c12(0x14f),'final':!![]};if(_0x374f3c[_0x180c12(0xce)])return console[_0x180c12(0x208)](_0x180c12(0x137)),this[_0x180c12(0xc3)](_0x312359,_0x37c066,_0x374f3c[_0x180c12(0x134)]?.['toString']()||_0x37c066,_0x5a86e9[_0x180c12(0xca)]),{'gateway_payment_id':_0x374f3c[_0x180c12(0x134)]?.[_0x180c12(0x132)](),'payment_url':_0x374f3c['3ds_url'],'requires_3ds':!![],'threeds_url':_0x374f3c[_0x180c12(0xce)],'status':'PENDING','final':![]};let _0x1f4138=this[_0x180c12(0xf1)](_0x374f3c[_0x180c12(0x17c)],_0x374f3c['desc']||_0x374f3c[_0x180c12(0x188)]),_0x1bacc0=_0x374f3c['status'],_0x508527=this[_0x180c12(0x1de)](_0x374f3c['status']);return console[_0x180c12(0x208)](_0x180c12(0x1d1)+_0x1bacc0+_0x180c12(0x1cb)+_0x508527+_0x180c12(0x20d)+_0x1f4138),{'gateway_payment_id':_0x374f3c[_0x180c12(0x134)]?.[_0x180c12(0x132)](),'payment_url':_0x3409cc,'requires_3ds':![],'status':'FAILED','final':!![],'errorMessage':_0x1f4138};}catch(_0x52f028){console[_0x180c12(0xf9)](_0x180c12(0x1c2)),console[_0x180c12(0xf9)](_0x180c12(0x104),_0x52f028),loggerService_1[_0x180c12(0xe2)][_0x180c12(0xdf)](_0x180c12(0x186),_0x180c12(0x12f),_0x52f028);throw new Error('Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20'+(_0x52f028 instanceof Error?_0x52f028[_0x180c12(0x188)]:_0x180c12(0xcd)));}}async[a68_0x408993(0x210)](_0x4262af,_0x1c0262,_0x46ac80=a68_0x408993(0x144)){const _0xf423db=a68_0x408993;console['log'](_0xf423db(0x181)+_0x46ac80+'\x20payment\x20status:\x20'+_0x4262af+'\x20('+_0x1c0262+')');try{const _0x3c85cb={'payment_id':_0x4262af,'order_id':_0x1c0262},_0x20c529=JSON[_0xf423db(0x11c)](_0x3c85cb),_0x33d25b=this[_0xf423db(0x111)](_0x46ac80===_0xf423db(0x144)?_0xf423db(0xec):'5000000000000000'),{key:_0x51615c,iv:_0x46d3e1}=this[_0xf423db(0xbe)](),_0x34b54a=this[_0xf423db(0x1b1)](_0x20c529,_0x51615c,_0x46d3e1),_0x352781=this[_0xf423db(0x18c)](_0x51615c,_0x46d3e1,_0x33d25b[_0xf423db(0xc7)]),_0x441661=this[_0xf423db(0x13f)](_0x20c529,_0x33d25b[_0xf423db(0x11e)]),_0x47d69d={'merchant_point_id':_0x33d25b[_0xf423db(0x128)],'method':_0xf423db(0x17c),'info':_0x34b54a,'key':_0x352781,'sign':_0x441661,'lang':'en'};loggerService_1[_0xf423db(0xe2)][_0xf423db(0xc4)](_0x46ac80[_0xf423db(0x1e0)](),_0xf423db(0x1db),'POST',{'merchant_point_id':_0x33d25b[_0xf423db(0x128)],'method':_0xf423db(0x17c),'lang':'en'});const _0x546ca9=Date['now'](),_0x24b92b=await fetch(_0x33d25b['apiUrl'],{'method':'POST','headers':{'Content-Type':_0xf423db(0x14c),'Accept':_0xf423db(0x14c),'User-Agent':_0xf423db(0xfa)},'body':JSON[_0xf423db(0x11c)](_0x47d69d)}),_0x2e5346=Date[_0xf423db(0xb7)]()-_0x546ca9;if(!_0x24b92b['ok']){const _0x4437db=await _0x24b92b[_0xf423db(0xf3)]();loggerService_1['loggerService'][_0xf423db(0x178)](_0x46ac80['toLowerCase'](),_0xf423db(0x17a),_0x24b92b[_0xf423db(0x17c)],_0x4437db,_0x2e5346);throw new Error(_0xf423db(0x120)+_0x24b92b[_0xf423db(0x17c)]);}const _0x349159=await _0x24b92b[_0xf423db(0x15a)]();loggerService_1['loggerService'][_0xf423db(0x178)](_0x46ac80[_0xf423db(0x1e0)](),_0xf423db(0x17a),_0x24b92b[_0xf423db(0x17c)],_0x349159,_0x2e5346);let _0x8d06d1=_0x349159;if(_0x349159[_0xf423db(0x1a6)]&&_0x349159['key']&&_0x349159[_0xf423db(0x1df)]){console[_0xf423db(0x208)]('üîê\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0x1e0376=await this['decryptResponsePhp'](_0x349159[_0xf423db(0x1a6)],_0x349159[_0xf423db(0x16a)],_0x46ac80);_0x8d06d1=JSON[_0xf423db(0xc9)](_0x1e0376),console[_0xf423db(0x208)]('‚úÖ\x20Status\x20response\x20decrypted\x20successfully'),loggerService_1[_0xf423db(0xe2)][_0xf423db(0x178)](_0x46ac80[_0xf423db(0x1e0)](),_0xf423db(0xeb),_0x24b92b['status'],_0x8d06d1,_0x2e5346),console[_0xf423db(0x208)](_0xf423db(0x114));}catch(_0x50baae){console[_0xf423db(0xf9)](_0xf423db(0xd6),_0x50baae),loggerService_1[_0xf423db(0xe2)][_0xf423db(0xdf)](_0x46ac80[_0xf423db(0x1e0)](),_0xf423db(0x119),_0xf423db(0x1cd)+_0x50baae),_0x8d06d1=_0x349159;}}else loggerService_1[_0xf423db(0xe2)]['logWhiteDomainResponse'](_0x46ac80['toLowerCase'](),_0xf423db(0xeb),_0x24b92b['status'],_0x8d06d1,_0x2e5346),console[_0xf423db(0x208)](_0xf423db(0xd2));console['log'](_0xf423db(0x11b),{'status':_0x8d06d1[_0xf423db(0x17c)],'final':_0x8d06d1['final'],'payment_id':_0x8d06d1[_0xf423db(0x134)],'desc':_0x8d06d1['desc']});let _0x50c01c='PENDING';if(_0x8d06d1[_0xf423db(0x17c)]===0x64&&_0x8d06d1['final']===0x1)_0x50c01c='PAID';else{if(_0x8d06d1[_0xf423db(0x157)]===0x0||!this[_0xf423db(0x1de)](_0x8d06d1['status']))_0x50c01c='PENDING';else _0x8d06d1['final']===0x1||this[_0xf423db(0x1de)](_0x8d06d1[_0xf423db(0x17c)])?_0x50c01c=_0xf423db(0xb9):_0x50c01c=_0xf423db(0xe6);}const _0x5cbd2b=this[_0xf423db(0xf1)](_0x8d06d1[_0xf423db(0x17c)],_0x8d06d1['desc']);return{'status':_0x50c01c,'final':this[_0xf423db(0x1de)](_0x8d06d1['status']),'amount':_0x8d06d1['amount'],'currency':_0x8d06d1[_0xf423db(0x171)],'date_success':_0x8d06d1[_0xf423db(0x140)],'description':_0x5cbd2b};}catch(_0x12fef7){console[_0xf423db(0xf9)](_0x46ac80+_0xf423db(0x105),_0x12fef7),loggerService_1[_0xf423db(0xe2)][_0xf423db(0xdf)](_0x46ac80[_0xf423db(0x1e0)](),_0xf423db(0x1db),_0x12fef7);throw new Error(_0xf423db(0x118)+_0x46ac80+_0xf423db(0x136)+(_0x12fef7 instanceof Error?_0x12fef7[_0xf423db(0x188)]:_0xf423db(0xcd)));}}[a68_0x408993(0xc3)](_0x4734e7,_0x376d41,_0x40c213,_0x252459){const _0x87a64a=a68_0x408993;console[_0x87a64a(0x208)]('‚è∞\x20Scheduling\x20status\x20checks\x20for\x20'+_0x252459+_0x87a64a(0x182)+_0x4734e7+'\x20('+_0x40c213+')'),this[_0x87a64a(0x191)](_0x4734e7);const _0x1eac8e=[],_0x4761e1=0x5*0x3c*0x3e8,_0x22e783=0x2*0x3c*0x3c*0x3e8,_0x481e7d=Math['floor'](_0x22e783/_0x4761e1);console[_0x87a64a(0x208)](_0x87a64a(0x1fd)+_0x481e7d+'\x20times\x20every\x205\x20minutes\x20for\x202\x20hours');for(let _0x204570=0x1;_0x204570<=_0x481e7d;_0x204570++){const _0x58aa9f=setTimeout(async()=>{const _0x49320b=_0x87a64a;console[_0x49320b(0x208)](_0x49320b(0x1b7)+_0x252459+_0x49320b(0xfd)+_0x204570+'/'+_0x481e7d+'\x20for\x20payment\x20'+_0x4734e7);try{const _0x2c1341=await this[_0x49320b(0x210)](_0x40c213,_0x376d41,_0x252459);console['log'](_0x49320b(0x19a)+_0x204570+'\x20result:',_0x2c1341),_0x2c1341[_0x49320b(0x157)]&&(console[_0x49320b(0x208)](_0x49320b(0x103)+_0x4734e7+_0x49320b(0x14b)+_0x2c1341[_0x49320b(0x17c)]+_0x49320b(0x19d)),this[_0x49320b(0x191)](_0x4734e7),await this[_0x49320b(0x1cf)](_0x4734e7,_0x2c1341[_0x49320b(0x17c)],_0x2c1341));}catch(_0x5c608b){console[_0x49320b(0xf9)](_0x49320b(0x192)+_0x204570+'\x20failed\x20for\x20payment\x20'+_0x4734e7+':',_0x5c608b);}},_0x204570*_0x4761e1);_0x1eac8e['push'](_0x58aa9f);}this[_0x87a64a(0x154)][_0x87a64a(0x1c8)](_0x4734e7,_0x1eac8e),console['log'](_0x87a64a(0x139)+_0x481e7d+'\x20status\x20checks\x20for\x20payment\x20'+_0x4734e7);}[a68_0x408993(0x191)](_0x149b14){const _0xaff9cb=a68_0x408993,_0x5e92b6=this['statusCheckTimers']['get'](_0x149b14);_0x5e92b6&&(console['log'](_0xaff9cb(0xda)+_0x5e92b6['length']+_0xaff9cb(0xc1)+_0x149b14),_0x5e92b6[_0xaff9cb(0x1ea)]((_0xf8ff74,_0x2c8ab3)=>{clearTimeout(_0xf8ff74);}),this[_0xaff9cb(0x154)][_0xaff9cb(0x106)](_0x149b14));}async[a68_0x408993(0x1cf)](_0x5698ec,_0x3772a1,_0x4d73c8){const _0x16535f=a68_0x408993;try{const _0x5a95b8=(await Promise[_0x16535f(0x1d4)]()[_0x16535f(0xfb)](()=>__importStar(require(_0x16535f(0x1d7)))))[_0x16535f(0xbd)],_0x1fa888={'status':_0x3772a1[_0x16535f(0x116)](),'updatedAt':new Date(),'statusChangedBy':_0x16535f(0xa7),'statusChangedAt':new Date()};_0x3772a1===_0x16535f(0x14f)&&(_0x1fa888[_0x16535f(0xdb)]=new Date()),_0x3772a1===_0x16535f(0xb9)&&_0x4d73c8[_0x16535f(0x1ab)]&&(_0x1fa888['failureMessage']=_0x4d73c8[_0x16535f(0x1ab)],console[_0x16535f(0x208)](_0x16535f(0x1ff)+_0x4d73c8[_0x16535f(0x1ab)])),await _0x5a95b8[_0x16535f(0x1d6)]['update']({'where':{'id':_0x5698ec},'data':_0x1fa888}),console[_0x16535f(0x208)](_0x16535f(0x103)+_0x5698ec+_0x16535f(0x124)+_0x3772a1),await this['sendPaymentNotifications'](_0x5698ec,_0x3772a1);}catch(_0xd2799e){console[_0x16535f(0xf9)]('‚ùå\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x5698ec+':',_0xd2799e);}}async[a68_0x408993(0xcc)](_0x4a2b95,_0x5e0723){const _0x78e3a5=a68_0x408993;try{const _0x21b91e=(await Promise[_0x78e3a5(0x1d4)]()[_0x78e3a5(0xfb)](()=>__importStar(require('../../config/database'))))[_0x78e3a5(0xbd)],{telegramBotService:_0x2da50c}=await Promise[_0x78e3a5(0x1d4)]()[_0x78e3a5(0xfb)](()=>__importStar(require(_0x78e3a5(0x1bf)))),_0x392d15=await _0x21b91e[_0x78e3a5(0x1d6)]['findUnique']({'where':{'id':_0x4a2b95},'include':{'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':!![]}}}});if(!_0x392d15)return;const _0x34f35c={'PAID':_0x78e3a5(0x117),'FAILED':_0x78e3a5(0x10c)},_0x23e874=_0x34f35c[_0x5e0723];_0x23e874&&await _0x2da50c['sendPaymentNotification'](_0x392d15['shopId'],_0x392d15,_0x23e874),await this[_0x78e3a5(0x165)](_0x392d15,_0x5e0723);}catch(_0x204dff){console[_0x78e3a5(0xf9)](_0x78e3a5(0x149),_0x204dff);}}async[a68_0x408993(0x165)](_0x3a2ac8,_0x1cd6d7){const _0x1251ba=a68_0x408993,_0x3f4afd=Date[_0x1251ba(0xb7)]();try{const _0x33aa30=_0x3a2ac8[_0x1251ba(0xa8)],_0x3d8ed6=_0x33aa30['settings'];if(!_0x3d8ed6?.[_0x1251ba(0xff)]){console[_0x1251ba(0x208)](_0x1251ba(0x180)+_0x33aa30['id']);return;}const _0x5a83b7=_0x1cd6d7==='PAID'?_0x1251ba(0xaf):_0x1251ba(0x1a9);let _0x124f41=[];if(_0x3d8ed6[_0x1251ba(0x1da)])try{_0x124f41=Array[_0x1251ba(0x1b0)](_0x3d8ed6['webhookEvents'])?_0x3d8ed6[_0x1251ba(0x1da)]:JSON[_0x1251ba(0xc9)](_0x3d8ed6[_0x1251ba(0x1da)]);}catch(_0x3a261b){console['error'](_0x1251ba(0x17e),_0x3a261b),_0x124f41=[];}if(!_0x124f41['includes'](_0x5a83b7)){console['log']('Webhook\x20event\x20'+_0x5a83b7+_0x1251ba(0x209)+_0x33aa30['id']);return;}const _0x147086={'event':_0x5a83b7,'payment':{'id':_0x3a2ac8['id'],'order_id':_0x3a2ac8[_0x1251ba(0xc0)],'gateway_order_id':_0x3a2ac8[_0x1251ba(0x141)],'gateway':_0x1251ba(0x1fc),'amount':_0x3a2ac8[_0x1251ba(0x1bb)],'currency':_0x3a2ac8[_0x1251ba(0x171)],'status':_0x1cd6d7[_0x1251ba(0x1e0)](),'customer_email':_0x3a2ac8[_0x1251ba(0xf8)],'customer_name':_0x3a2ac8[_0x1251ba(0x170)],'created_at':_0x3a2ac8[_0x1251ba(0x1d0)],'updated_at':new Date()}},_0x5b6da6=JSON[_0x1251ba(0x11c)](_0x147086),_0x39bc06=crypto_1[_0x1251ba(0xbd)][_0x1251ba(0x1ca)](_0x1251ba(0x17b),_0x33aa30[_0x1251ba(0x125)])['update'](_0x5b6da6)['digest'](_0x1251ba(0x206)),_0x2e95a0=await fetch(_0x3d8ed6[_0x1251ba(0xff)],{'method':_0x1251ba(0x1b3),'headers':{'Content-Type':_0x1251ba(0x14c),'User-Agent':_0x1251ba(0xa1),'X-Webhook-Signature':_0x39bc06},'body':_0x5b6da6}),_0x331e0b=Date[_0x1251ba(0xb7)]()-_0x3f4afd;loggerService_1['loggerService'][_0x1251ba(0x112)](_0x3a2ac8['shopId'],_0x3d8ed6['webhookUrl'],_0x5a83b7,_0x2e95a0['status'],_0x331e0b,_0x147086),console[_0x1251ba(0x208)](_0x1251ba(0x1ad)+_0x3d8ed6[_0x1251ba(0xff)]+'\x20with\x20status\x20'+_0x2e95a0[_0x1251ba(0x17c)]+'\x20('+_0x331e0b+_0x1251ba(0x1e8));}catch(_0x225f31){console[_0x1251ba(0xf9)](_0x1251ba(0x201),_0x225f31),loggerService_1[_0x1251ba(0xe2)]['logShopWebhookError'](_0x3a2ac8['shopId'],_0x3a2ac8[_0x1251ba(0xa8)]?.[_0x1251ba(0x1bd)]?.[_0x1251ba(0xff)]||_0x1251ba(0x102),_0x1251ba(0xa6),_0x225f31,{});}}[a68_0x408993(0x148)](_0xd3525d){const _0x1d6908=a68_0x408993,_0x27d644=_0xd3525d[_0x1d6908(0x1e4)](/[\s-]/g,'');if(_0x27d644[_0x1d6908(0x15b)]<0x4)return _0x1d6908(0x1e6);return _0x1d6908(0x169)+_0x27d644[_0x1d6908(0x1a3)](-0x4);}async[a68_0x408993(0x17f)](_0x5c0dc5,_0x58fdfb='MASTERCARD'){const _0x274c59=a68_0x408993;console[_0x274c59(0x208)](_0x274c59(0x12d),JSON[_0x274c59(0x11c)](_0x5c0dc5,null,0x2));let _0x3d5f83=_0x5c0dc5,_0x153a0e=_0x58fdfb;_0x5c0dc5[_0x274c59(0x142)]?(_0x153a0e=_0x5c0dc5['card_type'][_0x274c59(0x116)]()==='VISA'?'VISA':_0x274c59(0xab),console['log'](_0x274c59(0x15e)+_0x153a0e)):console[_0x274c59(0x208)](_0x274c59(0x1f6)+_0x153a0e);if(_0x5c0dc5[_0x274c59(0x1a6)]&&_0x5c0dc5[_0x274c59(0x16a)]&&_0x5c0dc5[_0x274c59(0x1df)]){console[_0x274c59(0x208)](_0x274c59(0x1fe));try{const _0x2f0951=await this[_0x274c59(0xe9)](_0x5c0dc5[_0x274c59(0x1a6)],_0x5c0dc5[_0x274c59(0x16a)],_0x153a0e);_0x3d5f83=JSON[_0x274c59(0xc9)](_0x2f0951),console[_0x274c59(0x208)](_0x274c59(0xc5)),console[_0x274c59(0x208)](_0x274c59(0xd4),JSON[_0x274c59(0x11c)](_0x3d5f83,null,0x2));}catch(_0x59c2bc){console[_0x274c59(0xf9)]('‚ùå\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:',_0x59c2bc),console[_0x274c59(0x208)](_0x274c59(0x1ba)),_0x3d5f83=_0x5c0dc5;}}else console[_0x274c59(0x208)](_0x274c59(0x121));let _0x45f63f='PENDING';if(_0x3d5f83[_0x274c59(0x17c)]===0x64&&_0x3d5f83['final']===0x1)_0x45f63f=_0x274c59(0x14f);else{if(_0x3d5f83['final']===0x0||!this['isFinalStatus'](_0x3d5f83[_0x274c59(0x17c)]))_0x45f63f='PENDING';else _0x3d5f83[_0x274c59(0x157)]===0x1||this[_0x274c59(0x1de)](_0x3d5f83[_0x274c59(0x17c)])?_0x45f63f='FAILED':_0x45f63f='PENDING';}let _0x31edd3='';if(_0x3d5f83[_0x274c59(0xed)])_0x31edd3=_0x3d5f83[_0x274c59(0xed)][_0x274c59(0x132)](),console[_0x274c59(0x208)](_0x274c59(0xb1)+_0x153a0e+_0x274c59(0x1c7)+_0x31edd3);else _0x3d5f83[_0x274c59(0x134)]?(_0x31edd3=_0x3d5f83[_0x274c59(0x134)][_0x274c59(0x132)](),console[_0x274c59(0x208)](_0x274c59(0xb1)+_0x153a0e+_0x274c59(0x204)+_0x31edd3)):(_0x31edd3=_0x3d5f83['orderId']||_0x3d5f83['paymentId']||_0x3d5f83['id']||'',console[_0x274c59(0x208)](_0x274c59(0x1c6)+_0x31edd3));console[_0x274c59(0x208)](_0x274c59(0x10f)+_0x153a0e+_0x274c59(0x184)),console[_0x274c59(0x208)]('\x20\x20\x20Payment\x20ID:\x20'+_0x31edd3+_0x274c59(0x189)+_0x3d5f83[_0x274c59(0xed)]+_0x274c59(0x18f)+_0x3d5f83['orderId']+',\x20payment_id='+_0x3d5f83[_0x274c59(0x134)]+_0x274c59(0x20f)+_0x3d5f83[_0x274c59(0x1b4)]+',\x20id='+_0x3d5f83['id']+')'),console[_0x274c59(0x208)](_0x274c59(0x16d)+_0x45f63f+_0x274c59(0x109)+_0x3d5f83[_0x274c59(0x17c)]+_0x274c59(0x145)+_0x3d5f83[_0x274c59(0x157)]+')'),console[_0x274c59(0x208)](_0x274c59(0x101)+_0x3d5f83[_0x274c59(0x1bb)]),console[_0x274c59(0x208)](_0x274c59(0x1f1)+_0x3d5f83[_0x274c59(0x171)]);let _0x87154;_0x45f63f===_0x274c59(0xb9)&&(_0x87154=this[_0x274c59(0xf1)](_0x3d5f83[_0x274c59(0x17c)],_0x3d5f83['desc']),console['log'](_0x274c59(0x1d8)+_0x87154));const _0x17ed34={'paymentId':_0x31edd3,'status':_0x45f63f,'amount':_0x3d5f83[_0x274c59(0x1bb)],'currency':_0x3d5f83['currency'],'cardBrand':_0x153a0e};return _0x87154&&(_0x17ed34[_0x274c59(0x20e)]=_0x87154),_0x17ed34;}['stopAllStatusChecks'](){const _0x5b8799=a68_0x408993;console[_0x5b8799(0x208)](_0x5b8799(0x16f));const _0x4b040d=this['statusCheckTimers']['size'];for(const [_0x501df2]of this[_0x5b8799(0x154)]){this['clearStatusTimers'](_0x501df2);}console[_0x5b8799(0x208)](_0x5b8799(0xb5)+_0x4b040d+_0x5b8799(0x138));}}function a68_0x3c73(_0x23e6c9,_0x5e6ef3){_0x23e6c9=_0x23e6c9-0xa1;const _0x2c549e=a68_0x2c54();let _0x3c7372=_0x2c549e[_0x23e6c9];return _0x3c7372;}exports[a68_0x408993(0x12c)]=VisaMasterCardService;