'use strict';const a42_0x24555e=a42_0x4b3e;(function(_0x1347cd,_0x1e3c5a){const _0x5a2e07=a42_0x4b3e,_0x45e643=_0x1347cd();while(!![]){try{const _0x251bb6=-parseInt(_0x5a2e07(0x106))/0x1*(-parseInt(_0x5a2e07(0x1d8))/0x2)+parseInt(_0x5a2e07(0x14d))/0x3*(parseInt(_0x5a2e07(0x19b))/0x4)+parseInt(_0x5a2e07(0x10a))/0x5*(-parseInt(_0x5a2e07(0x15e))/0x6)+-parseInt(_0x5a2e07(0x195))/0x7*(-parseInt(_0x5a2e07(0x17c))/0x8)+parseInt(_0x5a2e07(0x13d))/0x9+-parseInt(_0x5a2e07(0x15d))/0xa+-parseInt(_0x5a2e07(0x12e))/0xb;if(_0x251bb6===_0x1e3c5a)break;else _0x45e643['push'](_0x45e643['shift']());}catch(_0x124f48){_0x45e643['push'](_0x45e643['shift']());}}}(a42_0x3895,0xcd308));function a42_0x3895(){const _0x4840b2=['HTTP\x20error!\x20status:\x20','decryptResponse','createCipheriv','call','privateKeyPath','stringify','last_name','PHP\x20decryptor\x20error','🔐\x20Data\x20signed\x20with\x20RSA','RSA_PKCS1_PADDING','statusCheckTimers','Response\x20Time:','✅\x20Scheduled\x20','1623831nlblOb','number','MasterCardService','from','trim','\x20\x20\x20-\x20key\x20length:','Public\x20key\x20file\x20not\x20found:\x20','Return\x20URL:','🔐\x20Public\x20key\x20length:\x20','psp_public.pem','adminNotes','delete','-----BEGIN','hasOwnProperty','processWebhook','14306202bgPcil','keys','/charge','📝\x20Data\x20to\x20sign\x20length:','error','\x20characters','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','****\x20****\x20****\x20','payment.success','webhookUrl','Error\x20details:','decryptAES','💳\x20MasterCard\x20service\x20initialized','clearStatusTimers','paid','📝\x20Encrypted\x20data\x20length:','3jqVsFH','/charge_decrypted','\x20\x20\x20-\x20lang:\x20en','createdAt','includes','\x20failed\x20for\x20payment\x20','expire_month','🔐\x20Public\x20key\x20path:','payment_id','logShopWebhookError','📝\x20Signature\x20length:','logWhiteDomainResponse','update','FAILED','apiUrl','../telegramBotService','3653240gtlYjk','2263326USnJaC','webhookEvents','Amount:','https://api2.trapay.uk/decrypt.php','defineProperty','__importStar','\x20\x20\x20-\x20sign\x20length:','then','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','3DS\x20URL:','orderId','-----END','description','utf8','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','Unknown\x20error','isArray','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','publicEncrypt','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','🔐\x20Private\x20key\x20path:','cvv','gatewayOrderId','getOwnPropertyNames','===\x20MASTERCARD\x20API\x20RESPONSE\x20===','PENDING','\x20MasterCard\x20status\x20check\x20timers','Webhook\x20event\x20','amount','payment.failed','40ZIcrJt','sign','__createBinding','encryptRSA','text','✅\x20Payment\x20successful','❌\x20MasterCard\x20key\x20validation\x20failed:','final','resolve','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','/charge_decrypt','createSign','updatePaymentStatus','get','logWhiteDomainRequest','),\x20stopping\x20status\x20checks','log','1111','logWhiteDomainError','loggerService','/status','maskCardNumber','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','\x20with\x20status\x20','shopId','510377WKuzAF','/status_raw','🔐\x203DS\x20verification\x20required','crypto','Status\x20decryption\x20failed:\x20','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','1276244fkGvfR','toUpperCase','default','3ds_url','order_id','randomBytes','\x20\x20\x20-\x20method:\x20charge','cwd','currency','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','mastercard','toString','settings','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','getOwnPropertyDescriptor','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','⏰\x20Will\x20check\x20status\x20','writable','customerEmail','Processing\x20MasterCard\x20webhook:','❌\x20RSA\x20encryption\x20failed:','🔐\x20RSA\x20signing\x20successful','\x20status\x20checks\x20for\x20payment\x20','parse','****','🔐\x20AES\x20IV\x20length:','size','✅\x20Status\x20response\x20decrypted\x20successfully','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','💾\x20Payment\x20data\x20prepared','__esModule','length','Payment\x20ID:','Status:','📝\x20Encrypted\x20key\x20length:','Failed\x20to\x20send\x20payment\x20notifications:','system','validateKeyFiles','\x20for\x20payment\x20','first_name','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','❌\x20Data\x20being\x20signed:','message','ms)','configurable','✅\x20Payment\x20','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','info','desc','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','merchantPointId','none','\x20status\x20updated\x20to\x20','__setModuleDefault','sendPaymentNotification','privateDecrypt','decryptResponsePhp','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','2yWTYhj','POST','Error\x20parsing\x20webhook\x20events:','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','Response\x20Body:','charge','join','create','sendShopWebhook',',\x20Final:\x20','payment','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','base64','generateAESKey','SHA256','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','set','existsSync','signRSA','sendPaymentNotifications','json','Order\x20ID:','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','checkPaymentStatus','shop','Card\x20Holder:','__importDefault','status','589091FvpBfe','toLowerCase','🧹\x20Clearing\x20','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','20iGIZLb','/charge_raw','PAID','application/json','readFileSync','❌\x20PHP\x20decryptor\x20request\x20failed:','now','Result\x20URL:','HTTP\x20Status:','private.pem','\x20status\x20timers\x20for\x20payment\x20','https://api.paydmeth.com/api','TesSoft\x20Payment\x20System/1.0','key','encryptAES','🔍\x20MasterCard\x20status\x20check\x20#','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','Failed\x20to\x20decrypt\x20response','scheduleStatusChecks','publicKeyPath','constants','slice','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20==='];a42_0x3895=function(){return _0x4840b2;};return a42_0x3895();}function a42_0x4b3e(_0x37b4c6,_0x371397){const _0x389511=a42_0x3895();return a42_0x4b3e=function(_0x4b3e2d,_0x37fdf5){_0x4b3e2d=_0x4b3e2d-0xeb;let _0x39c0ca=_0x389511[_0x4b3e2d];return _0x39c0ca;},a42_0x4b3e(_0x37b4c6,_0x371397);}var __createBinding=this&&this[a42_0x24555e(0x17e)]||(Object['create']?function(_0xa80656,_0x14b6ac,_0x1a306c,_0x123a82){const _0x497df2=a42_0x24555e;if(_0x123a82===undefined)_0x123a82=_0x1a306c;var _0x12767b=Object[_0x497df2(0x1a9)](_0x14b6ac,_0x1a306c);(!_0x12767b||(_0x497df2(0x189)in _0x12767b?!_0x14b6ac[_0x497df2(0x1ba)]:_0x12767b[_0x497df2(0x1ac)]||_0x12767b[_0x497df2(0x1c8)]))&&(_0x12767b={'enumerable':!![],'get':function(){return _0x14b6ac[_0x1a306c];}}),Object[_0x497df2(0x162)](_0xa80656,_0x123a82,_0x12767b);}:function(_0x288aca,_0x1da6a9,_0x46f711,_0x10c690){if(_0x10c690===undefined)_0x10c690=_0x46f711;_0x288aca[_0x10c690]=_0x1da6a9[_0x46f711];}),__setModuleDefault=this&&this[a42_0x24555e(0x1d2)]||(Object[a42_0x24555e(0xf1)]?function(_0x1859eb,_0x930034){const _0x58a0c0=a42_0x24555e;Object['defineProperty'](_0x1859eb,_0x58a0c0(0x19d),{'enumerable':!![],'value':_0x930034});}:function(_0x15caa6,_0x3de78b){const _0x2a7b13=a42_0x24555e;_0x15caa6[_0x2a7b13(0x19d)]=_0x3de78b;}),__importStar=this&&this[a42_0x24555e(0x163)]||(function(){var _0x40003f=function(_0x2b4d7c){const _0xc00269=a42_0x4b3e;return _0x40003f=Object[_0xc00269(0x175)]||function(_0x18b723){const _0x339f5d=_0xc00269;var _0x22b370=[];for(var _0x25d458 in _0x18b723)if(Object['prototype'][_0x339f5d(0x13b)][_0x339f5d(0x124)](_0x18b723,_0x25d458))_0x22b370[_0x22b370[_0x339f5d(0x1bb)]]=_0x25d458;return _0x22b370;},_0x40003f(_0x2b4d7c);};return function(_0x1ea928){const _0x25095a=a42_0x4b3e;if(_0x1ea928&&_0x1ea928['__esModule'])return _0x1ea928;var _0x20de31={};if(_0x1ea928!=null){for(var _0x2426c2=_0x40003f(_0x1ea928),_0x47df1e=0x0;_0x47df1e<_0x2426c2[_0x25095a(0x1bb)];_0x47df1e++)if(_0x2426c2[_0x47df1e]!=='default')__createBinding(_0x20de31,_0x1ea928,_0x2426c2[_0x47df1e]);}return __setModuleDefault(_0x20de31,_0x1ea928),_0x20de31;};}()),__importDefault=this&&this[a42_0x24555e(0x104)]||function(_0x19dc93){const _0x1fb0c4=a42_0x24555e;return _0x19dc93&&_0x19dc93[_0x1fb0c4(0x1ba)]?_0x19dc93:{'default':_0x19dc93};};Object[a42_0x24555e(0x162)](exports,a42_0x24555e(0x1ba),{'value':!![]}),exports[a42_0x24555e(0x130)]=void 0x0;const crypto_1=__importDefault(require(a42_0x24555e(0x198))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require('../loggerService');class MasterCardService{constructor(){const _0x2d2cf8=a42_0x24555e;this[_0x2d2cf8(0x12b)]=new Map(),this[_0x2d2cf8(0x15b)]=_0x2d2cf8(0x115),this[_0x2d2cf8(0x1cf)]=0x67c,this[_0x2d2cf8(0x125)]=path_1[_0x2d2cf8(0x19d)][_0x2d2cf8(0xf0)](process[_0x2d2cf8(0x1a2)](),'keys',_0x2d2cf8(0x113)),this[_0x2d2cf8(0x11d)]=path_1[_0x2d2cf8(0x19d)][_0x2d2cf8(0xf0)](process['cwd'](),_0x2d2cf8(0x13e),_0x2d2cf8(0x137)),console['log'](_0x2d2cf8(0x149)),console[_0x2d2cf8(0x18c)](_0x2d2cf8(0x172),this[_0x2d2cf8(0x125)]),console['log'](_0x2d2cf8(0x154),this[_0x2d2cf8(0x11d)]),this[_0x2d2cf8(0x1c1)]();}[a42_0x24555e(0x1c1)](){const _0x2d2ebd=a42_0x24555e;try{if(!fs_1[_0x2d2ebd(0x19d)][_0x2d2ebd(0xfb)](this[_0x2d2ebd(0x125)]))throw new Error('Private\x20key\x20file\x20not\x20found:\x20'+this[_0x2d2ebd(0x125)]);if(!fs_1[_0x2d2ebd(0x19d)][_0x2d2ebd(0xfb)](this[_0x2d2ebd(0x11d)]))throw new Error(_0x2d2ebd(0x134)+this[_0x2d2ebd(0x11d)]);const _0x4ddb0e=fs_1[_0x2d2ebd(0x19d)][_0x2d2ebd(0x10e)](this[_0x2d2ebd(0x125)],_0x2d2ebd(0x16b))[_0x2d2ebd(0x132)](),_0x1c3ba2=fs_1['default'][_0x2d2ebd(0x10e)](this['publicKeyPath'],_0x2d2ebd(0x16b))[_0x2d2ebd(0x132)]();if(!_0x4ddb0e[_0x2d2ebd(0x151)]('-----BEGIN')||!_0x4ddb0e[_0x2d2ebd(0x151)]('-----END'))throw new Error(_0x2d2ebd(0x1a8));if(!_0x1c3ba2[_0x2d2ebd(0x151)](_0x2d2ebd(0x13a))||!_0x1c3ba2[_0x2d2ebd(0x151)](_0x2d2ebd(0x169)))throw new Error(_0x2d2ebd(0x1d7));console['log'](_0x2d2ebd(0xf5)),console[_0x2d2ebd(0x18c)]('🔐\x20Private\x20key\x20length:\x20'+_0x4ddb0e[_0x2d2ebd(0x1bb)]+_0x2d2ebd(0x142)),console[_0x2d2ebd(0x18c)](_0x2d2ebd(0x136)+_0x1c3ba2[_0x2d2ebd(0x1bb)]+_0x2d2ebd(0x142));}catch(_0x12fed3){console[_0x2d2ebd(0x141)](_0x2d2ebd(0x182),_0x12fed3);throw _0x12fed3;}}[a42_0x24555e(0xf7)](){const _0x40915f=a42_0x24555e,_0xe61d40=crypto_1[_0x40915f(0x19d)][_0x40915f(0x1a0)](0x20),_0x433dec=crypto_1[_0x40915f(0x19d)][_0x40915f(0x1a0)](0x10);return{'key':_0xe61d40,'iv':_0x433dec};}[a42_0x24555e(0x118)](_0x24be64,_0x584592,_0x126208){const _0x367c1c=a42_0x24555e,_0x14527e=crypto_1[_0x367c1c(0x19d)][_0x367c1c(0x123)]('aes-256-ctr',_0x584592,_0x126208);let _0x282933=_0x14527e[_0x367c1c(0x159)](_0x24be64,_0x367c1c(0x16b),'base64');return _0x282933+=_0x14527e[_0x367c1c(0x183)](_0x367c1c(0xf6)),_0x282933;}[a42_0x24555e(0x17f)](_0x16a602,_0x3067d8){const _0x155790=a42_0x24555e;try{const _0xdb4a1a=fs_1['default']['readFileSync'](this['publicKeyPath'],_0x155790(0x16b))[_0x155790(0x132)](),_0x357bf8={'iv':_0x3067d8['toString'](_0x155790(0xf6)),'key':_0x16a602[_0x155790(0x1a6)]('base64')},_0x55f878=JSON[_0x155790(0x126)](_0x357bf8);console[_0x155790(0x18c)](_0x155790(0x109),_0x55f878[_0x155790(0x1bb)]);const _0x53c4c8=crypto_1[_0x155790(0x19d)][_0x155790(0x170)]({'key':_0xdb4a1a,'padding':crypto_1[_0x155790(0x19d)][_0x155790(0x11e)][_0x155790(0x12a)]},Buffer[_0x155790(0x131)](_0x55f878));return console[_0x155790(0x18c)](_0x155790(0x1ce),_0x53c4c8[_0x155790(0x1bb)]),_0x53c4c8[_0x155790(0x1a6)](_0x155790(0xf6));}catch(_0xab159b){console[_0x155790(0x141)](_0x155790(0x1af),_0xab159b);throw new Error(_0x155790(0x1a4));}}[a42_0x24555e(0xfc)](_0x3d539a){const _0xcce42a=a42_0x24555e;try{const _0x143fe2=fs_1[_0xcce42a(0x19d)]['readFileSync'](this[_0xcce42a(0x125)],_0xcce42a(0x16b))[_0xcce42a(0x132)](),_0x1788fa=crypto_1['default'][_0xcce42a(0x187)](_0xcce42a(0xf8));_0x1788fa[_0xcce42a(0x159)](_0x3d539a),_0x1788fa['end']();const _0x2df1b2=_0x1788fa[_0xcce42a(0x17d)](_0x143fe2,_0xcce42a(0xf6));return console['log'](_0xcce42a(0x1b0)),console[_0xcce42a(0x18c)](_0xcce42a(0x140),_0x3d539a[_0xcce42a(0x1bb)]),console[_0xcce42a(0x18c)](_0xcce42a(0x157),_0x2df1b2[_0xcce42a(0x1bb)]),_0x2df1b2;}catch(_0x1b5902){console[_0xcce42a(0x141)]('❌\x20RSA\x20signing\x20failed:',_0x1b5902),console[_0xcce42a(0x141)](_0xcce42a(0x1c5),_0x3d539a['substring'](0x0,0xc8)+'...');throw new Error(_0xcce42a(0x11a));}}[a42_0x24555e(0x148)](_0xc4bae,_0x442ad9,_0x359f9f){const _0xfe4a01=a42_0x24555e,_0x16768d=crypto_1[_0xfe4a01(0x19d)]['createDecipheriv']('aes-256-ctr',_0x442ad9,_0x359f9f);let _0x1c671c=_0x16768d[_0xfe4a01(0x159)](_0xc4bae,_0xfe4a01(0xf6),_0xfe4a01(0x16b));return _0x1c671c+=_0x16768d[_0xfe4a01(0x183)](_0xfe4a01(0x16b)),_0x1c671c;}async[a42_0x24555e(0x1d5)](_0x4e7054,_0x5de573){const _0x56aa77=a42_0x24555e;try{const _0x1d7255=await fetch(_0x56aa77(0x161),{'method':_0x56aa77(0xeb),'headers':{'Content-Type':_0x56aa77(0x10d)},'body':JSON[_0x56aa77(0x126)]({'info':_0x4e7054,'key':_0x5de573})});if(!_0x1d7255['ok'])throw new Error(_0x56aa77(0x128));return await _0x1d7255[_0x56aa77(0x180)]();}catch(_0x4eab62){console['error'](_0x56aa77(0x10f),_0x4eab62);throw new Error(_0x56aa77(0x1b7));}}['decryptResponse'](_0x37499a,_0x525918){const _0xee922a=a42_0x24555e;try{const _0x13b382=fs_1[_0xee922a(0x19d)]['readFileSync'](this[_0xee922a(0x125)],'utf8')[_0xee922a(0x132)](),_0x147f47=crypto_1[_0xee922a(0x19d)][_0xee922a(0x1d4)](_0x13b382,Buffer['from'](_0x525918,_0xee922a(0xf6))),_0x3b2560=JSON['parse'](_0x147f47['toString']()),_0x352275=Buffer[_0xee922a(0x131)](_0x3b2560[_0xee922a(0x117)],_0xee922a(0xf6)),_0x3a4e9c=Buffer[_0xee922a(0x131)](_0x3b2560['iv'],'base64');return this[_0xee922a(0x148)](_0x37499a,_0x352275,_0x3a4e9c);}catch(_0x542127){throw new Error(_0xee922a(0x11b));}}async['processCardPayment'](_0x55fd26){const _0x271587=a42_0x24555e,{paymentId:_0x32b991,orderId:_0x27d242,amount:_0xdcc91a,currency:_0x53edc8,cardData:_0x3642e2,resultUrl:_0x190c8f,returnUrl:_0x424263,cardHolder:_0x539ce3,browser:_0x2714c2}=_0x55fd26;console['log'](_0x271587(0x1b8)),console[_0x271587(0x18c)](_0x271587(0x1bc),_0x32b991),console[_0x271587(0x18c)](_0x271587(0xff),_0x27d242),console['log'](_0x271587(0x160),_0xdcc91a,_0x53edc8),console[_0x271587(0x18c)]('Card\x20Number:',this[_0x271587(0x191)](_0x3642e2[_0x271587(0x12f)])),console['log'](_0x271587(0x103),_0x539ce3[_0x271587(0x1c3)]+'\x20'+_0x539ce3[_0x271587(0x127)]),console[_0x271587(0x18c)](_0x271587(0x135),_0x424263),console[_0x271587(0x18c)](_0x271587(0x111),_0x190c8f);const _0x4bf863={'amount':_0xdcc91a,'currency':_0x53edc8[_0x271587(0x19c)](),'order_id':_0x27d242,'result_url':_0x190c8f,'return_url':_0x424263,'card':{'number':_0x3642e2['number'],'expire_month':_0x3642e2[_0x271587(0x153)],'expire_year':_0x3642e2['expire_year'],'cvv':_0x3642e2[_0x271587(0x173)]},'card_holder':_0x539ce3,'browser':_0x2714c2},_0x242bc2=JSON[_0x271587(0x126)](_0x4bf863);console[_0x271587(0x18c)](_0x271587(0x1b9)),console[_0x271587(0x18c)]('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console[_0x271587(0x18c)](_0x242bc2),console[_0x271587(0x18c)]('📝\x20Data\x20length:',_0x242bc2[_0x271587(0x1bb)]);try{const {key:_0x490b5c,iv:_0x2342cd}=this[_0x271587(0xf7)]();console[_0x271587(0x18c)]('🔐\x20AES\x20key\x20and\x20IV\x20generated'),console['log']('🔐\x20AES\x20key\x20length:',_0x490b5c[_0x271587(0x1bb)]),console[_0x271587(0x18c)](_0x271587(0x1b4),_0x2342cd[_0x271587(0x1bb)]);const _0x3c5de1=this[_0x271587(0x118)](_0x242bc2,_0x490b5c,_0x2342cd);console[_0x271587(0x18c)]('🔐\x20Data\x20encrypted\x20with\x20AES'),console[_0x271587(0x18c)](_0x271587(0x14c),_0x3c5de1[_0x271587(0x1bb)]);const _0x54b4c6=this[_0x271587(0x17f)](_0x490b5c,_0x2342cd);console[_0x271587(0x18c)](_0x271587(0x1ca)),console['log'](_0x271587(0x1be),_0x54b4c6[_0x271587(0x1bb)]);const _0x3e57b8=this[_0x271587(0xfc)](_0x242bc2);console['log'](_0x271587(0x129)),console['log'](_0x271587(0x157),_0x3e57b8[_0x271587(0x1bb)]);const _0x5b763d={'merchant_point_id':this[_0x271587(0x1cf)],'method':_0x271587(0xef),'info':_0x3c5de1,'key':_0x54b4c6,'sign':_0x3e57b8,'lang':'en'};console['log'](_0x271587(0x19a)),console[_0x271587(0x18c)]('📝\x20Final\x20request\x20structure:'),console[_0x271587(0x18c)]('\x20\x20\x20-\x20merchant_point_id:',this['merchantPointId']),console[_0x271587(0x18c)](_0x271587(0x1a1)),console['log']('\x20\x20\x20-\x20info\x20length:',_0x3c5de1[_0x271587(0x1bb)]),console[_0x271587(0x18c)](_0x271587(0x133),_0x54b4c6[_0x271587(0x1bb)]),console[_0x271587(0x18c)](_0x271587(0x164),_0x3e57b8['length']),console['log'](_0x271587(0x14f)),loggerService_1[_0x271587(0x18f)][_0x271587(0x18a)]('mastercard',_0x271587(0x13f),'POST',{'merchant_point_id':this[_0x271587(0x1cf)],'method':_0x271587(0xef),'lang':'en'});const _0x4d8a88=Date[_0x271587(0x110)](),_0x339d89=await fetch(this['apiUrl'],{'method':_0x271587(0xeb),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x271587(0x116)},'body':JSON['stringify'](_0x5b763d)}),_0x205fca=Date[_0x271587(0x110)]()-_0x4d8a88;console['log'](_0x271587(0x176)),console[_0x271587(0x18c)](_0x271587(0x1bd),_0x339d89[_0x271587(0x105)]),console[_0x271587(0x18c)](_0x271587(0x12c),_0x205fca+'ms');if(!_0x339d89['ok']){const _0x5a1edd=await _0x339d89['text']();console[_0x271587(0x141)](_0x271587(0x112),_0x339d89[_0x271587(0x105)]),console[_0x271587(0x141)](_0x271587(0xee),_0x5a1edd),loggerService_1[_0x271587(0x18f)][_0x271587(0x158)]('mastercard',_0x271587(0x10b),_0x339d89['status'],_0x5a1edd,_0x205fca),loggerService_1[_0x271587(0x18f)][_0x271587(0x18e)](_0x271587(0x1a5),_0x271587(0x13f),'HTTP\x20'+_0x339d89['status']+':\x20'+_0x5a1edd);throw new Error(_0x271587(0x121)+_0x339d89[_0x271587(0x105)]+',\x20body:\x20'+_0x5a1edd);}const _0x4d8b5f=await _0x339d89[_0x271587(0xfe)]();loggerService_1[_0x271587(0x18f)][_0x271587(0x158)](_0x271587(0x1a5),_0x271587(0x10b),_0x339d89[_0x271587(0x105)],_0x4d8b5f,_0x205fca),console['log'](_0x271587(0x120));let _0x45930e=_0x4d8b5f;if(_0x4d8b5f[_0x271587(0x1cc)]&&_0x4d8b5f[_0x271587(0x117)]&&_0x4d8b5f[_0x271587(0x17d)]){console['log'](_0x271587(0x192));try{const _0x480421=await this[_0x271587(0x1d5)](_0x4d8b5f['info'],_0x4d8b5f[_0x271587(0x117)]);_0x45930e=JSON[_0x271587(0x1b2)](_0x480421),console[_0x271587(0x18c)]('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0x271587(0x18f)]['logWhiteDomainResponse']('mastercard',_0x271587(0x14e),_0x339d89[_0x271587(0x105)],_0x45930e,_0x205fca),console['log']('📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');}catch(_0x14ad34){console[_0x271587(0x141)]('❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):',_0x14ad34),loggerService_1[_0x271587(0x18f)][_0x271587(0x18e)](_0x271587(0x1a5),_0x271587(0x186),'Decryption\x20failed:\x20'+_0x14ad34),_0x45930e=_0x4d8b5f;}}else loggerService_1[_0x271587(0x18f)][_0x271587(0x158)]('mastercard','/charge_decrypted',_0x339d89[_0x271587(0x105)],_0x45930e,_0x205fca),console['log'](_0x271587(0x1c4));console['log'](_0x271587(0x1bd),_0x45930e['status']),console[_0x271587(0x18c)]('Final:',_0x45930e[_0x271587(0x183)]),console[_0x271587(0x18c)]('Payment\x20ID:',_0x45930e['payment_id']),console[_0x271587(0x18c)](_0x271587(0x167),_0x45930e['3ds_url']||_0x271587(0x1d0));if(_0x45930e[_0x271587(0x105)]===0x64&&_0x45930e['final']===0x1)return console[_0x271587(0x18c)](_0x271587(0x181)),{'gateway_payment_id':_0x45930e[_0x271587(0x155)]?.[_0x271587(0x1a6)](),'payment_url':_0x424263,'requires_3ds':![],'status':_0x271587(0x10c),'final':!![]};if(_0x45930e[_0x271587(0x19e)])return console[_0x271587(0x18c)](_0x271587(0x197)),this[_0x271587(0x11c)](_0x32b991,_0x27d242,_0x45930e['payment_id']?.[_0x271587(0x1a6)]()||_0x27d242),{'gateway_payment_id':_0x45930e[_0x271587(0x155)]?.[_0x271587(0x1a6)](),'payment_url':_0x45930e['3ds_url'],'requires_3ds':!![],'threeds_url':_0x45930e['3ds_url'],'status':_0x271587(0x177),'final':![]};let _0x4e9122=_0x45930e[_0x271587(0x1cd)]||_0x45930e[_0x271587(0x1c6)]||'Unknown\x20error',_0xb680b4=_0x45930e[_0x271587(0x105)],_0x3145bc=_0x45930e[_0x271587(0x183)];return console[_0x271587(0x18c)](_0x271587(0x185)+_0xb680b4+_0x271587(0xf3)+_0x3145bc+',\x20Desc:\x20'+_0x4e9122),{'gateway_payment_id':_0x45930e[_0x271587(0x155)]?.[_0x271587(0x1a6)](),'payment_url':_0x424263,'requires_3ds':![],'status':_0x271587(0x15a),'final':!![]};}catch(_0x15f559){console['error']('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console[_0x271587(0x141)](_0x271587(0x147),_0x15f559),loggerService_1[_0x271587(0x18f)][_0x271587(0x18e)](_0x271587(0x1a5),'/charge',_0x15f559);throw new Error(_0x271587(0x1d6)+(_0x15f559 instanceof Error?_0x15f559['message']:_0x271587(0x16d)));}}async[a42_0x24555e(0x101)](_0x5cc307,_0x2937d4){const _0x188c37=a42_0x24555e;console[_0x188c37(0x18c)](_0x188c37(0xf9)+_0x5cc307+'\x20('+_0x2937d4+')');try{const _0x16ac73={'payment_id':_0x5cc307,'order_id':_0x2937d4},_0x470df7=JSON[_0x188c37(0x126)](_0x16ac73),{key:_0x20ae64,iv:_0x23fe87}=this['generateAESKey'](),_0x16a3e1=this[_0x188c37(0x118)](_0x470df7,_0x20ae64,_0x23fe87),_0xdce2be=this['encryptRSA'](_0x20ae64,_0x23fe87),_0x2f2a2a=this[_0x188c37(0xfc)](_0x470df7),_0x4c933b={'merchant_point_id':this[_0x188c37(0x1cf)],'method':_0x188c37(0x105),'info':_0x16a3e1,'key':_0xdce2be,'sign':_0x2f2a2a,'lang':'en'};loggerService_1[_0x188c37(0x18f)][_0x188c37(0x18a)](_0x188c37(0x1a5),_0x188c37(0x190),_0x188c37(0xeb),{'merchant_point_id':this['merchantPointId'],'method':_0x188c37(0x105),'lang':'en'});const _0x3607e1=Date['now'](),_0x5f566f=await fetch(this[_0x188c37(0x15b)],{'method':_0x188c37(0xeb),'headers':{'Content-Type':_0x188c37(0x10d),'Accept':'application/json','User-Agent':_0x188c37(0x116)},'body':JSON[_0x188c37(0x126)](_0x4c933b)}),_0x5a7416=Date[_0x188c37(0x110)]()-_0x3607e1;if(!_0x5f566f['ok']){const _0x3f92a6=await _0x5f566f['text']();loggerService_1[_0x188c37(0x18f)][_0x188c37(0x158)](_0x188c37(0x1a5),_0x188c37(0x196),_0x5f566f[_0x188c37(0x105)],_0x3f92a6,_0x5a7416);throw new Error(_0x188c37(0x121)+_0x5f566f[_0x188c37(0x105)]);}const _0x3d1574=await _0x5f566f[_0x188c37(0xfe)]();loggerService_1[_0x188c37(0x18f)]['logWhiteDomainResponse'](_0x188c37(0x1a5),_0x188c37(0x196),_0x5f566f[_0x188c37(0x105)],_0x3d1574,_0x5a7416);let _0x5d0437=_0x3d1574;if(_0x3d1574['info']&&_0x3d1574[_0x188c37(0x117)]&&_0x3d1574['sign']){console[_0x188c37(0x18c)](_0x188c37(0x100));try{const _0x304118=this[_0x188c37(0x122)](_0x3d1574[_0x188c37(0x1cc)],_0x3d1574[_0x188c37(0x117)]);_0x5d0437=JSON[_0x188c37(0x1b2)](_0x304118),console[_0x188c37(0x18c)](_0x188c37(0x1b6)),loggerService_1[_0x188c37(0x18f)][_0x188c37(0x158)]('mastercard','/status_decrypted',_0x5f566f[_0x188c37(0x105)],_0x5d0437,_0x5a7416),console[_0x188c37(0x18c)](_0x188c37(0x166));}catch(_0x3cbc1d){console[_0x188c37(0x141)]('❌\x20Failed\x20to\x20decrypt\x20status\x20response:',_0x3cbc1d),loggerService_1['loggerService'][_0x188c37(0x18e)]('mastercard','/status_decrypt',_0x188c37(0x199)+_0x3cbc1d),_0x5d0437=_0x3d1574;}}else loggerService_1[_0x188c37(0x18f)][_0x188c37(0x158)](_0x188c37(0x1a5),'/status_decrypted',_0x5f566f[_0x188c37(0x105)],_0x5d0437,_0x5a7416),console[_0x188c37(0x18c)](_0x188c37(0x171));console[_0x188c37(0x18c)]('📊\x20Status\x20check\x20result:',{'status':_0x5d0437['status'],'final':_0x5d0437['final'],'payment_id':_0x5d0437[_0x188c37(0x155)],'desc':_0x5d0437[_0x188c37(0x1cd)]});let _0x2dfb90=_0x188c37(0x177);if(_0x5d0437[_0x188c37(0x105)]===0x1&&_0x5d0437[_0x188c37(0x183)]===0x1)_0x2dfb90=_0x188c37(0x10c);else _0x5d0437[_0x188c37(0x105)]===0x0&&_0x5d0437[_0x188c37(0x183)]===0x0?_0x2dfb90='PENDING':_0x2dfb90=_0x188c37(0x15a);return{'status':_0x2dfb90,'final':_0x5d0437['final']===0x1,'amount':_0x5d0437['amount'],'currency':_0x5d0437[_0x188c37(0x1a3)],'date_success':_0x5d0437['date_success'],'description':_0x5d0437[_0x188c37(0x1cd)]};}catch(_0x204865){console[_0x188c37(0x141)]('MasterCard\x20status\x20check\x20error:',_0x204865),loggerService_1[_0x188c37(0x18f)]['logWhiteDomainError']('mastercard',_0x188c37(0x190),_0x204865);throw new Error(_0x188c37(0x143)+(_0x204865 instanceof Error?_0x204865[_0x188c37(0x1c6)]:'Unknown\x20error'));}}['scheduleStatusChecks'](_0x1b4095,_0x2d6fa0,_0x2d2f8c){const _0x408c61=a42_0x24555e;console[_0x408c61(0x18c)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20'+_0x1b4095+'\x20('+_0x2d2f8c+')'),this[_0x408c61(0x14a)](_0x1b4095);const _0x312a10=[],_0x1c3bc2=0x5*0x3c*0x3e8,_0xd4f1d2=0x2*0x3c*0x3c*0x3e8,_0x5a239e=Math['floor'](_0xd4f1d2/_0x1c3bc2);console[_0x408c61(0x18c)](_0x408c61(0x1ab)+_0x5a239e+_0x408c61(0x16f));for(let _0x21b728=0x1;_0x21b728<=_0x5a239e;_0x21b728++){const _0x4f889d=setTimeout(async()=>{const _0x465739=_0x408c61;console['log'](_0x465739(0x119)+_0x21b728+'/'+_0x5a239e+_0x465739(0x1c2)+_0x1b4095);try{const _0x3ed3b8=await this[_0x465739(0x101)](_0x2d2f8c,_0x2d6fa0);console[_0x465739(0x18c)]('📊\x20Status\x20check\x20#'+_0x21b728+'\x20result:',_0x3ed3b8),_0x3ed3b8[_0x465739(0x183)]&&(console[_0x465739(0x18c)]('✅\x20Payment\x20'+_0x1b4095+'\x20is\x20final\x20('+_0x3ed3b8['status']+_0x465739(0x18b)),this[_0x465739(0x14a)](_0x1b4095),await this[_0x465739(0x188)](_0x1b4095,_0x3ed3b8['status'],_0x3ed3b8));}catch(_0x4e360e){console['error']('❌\x20Status\x20check\x20#'+_0x21b728+_0x465739(0x152)+_0x1b4095+':',_0x4e360e);}},_0x21b728*_0x1c3bc2);_0x312a10['push'](_0x4f889d);}this[_0x408c61(0x12b)][_0x408c61(0xfa)](_0x1b4095,_0x312a10),console[_0x408c61(0x18c)](_0x408c61(0x12d)+_0x5a239e+_0x408c61(0x1b1)+_0x1b4095);}['clearStatusTimers'](_0x553713){const _0x1379e0=a42_0x24555e,_0x2ffeff=this[_0x1379e0(0x12b)][_0x1379e0(0x189)](_0x553713);_0x2ffeff&&(console['log'](_0x1379e0(0x108)+_0x2ffeff[_0x1379e0(0x1bb)]+_0x1379e0(0x114)+_0x553713),_0x2ffeff['forEach']((_0x31e9cb,_0x483bfd)=>{clearTimeout(_0x31e9cb);}),this['statusCheckTimers'][_0x1379e0(0x139)](_0x553713));}async[a42_0x24555e(0x188)](_0x188b75,_0x126325,_0x1abaf7){const _0x3eeac7=a42_0x24555e;try{const _0x18d3ec=(await Promise['resolve']()[_0x3eeac7(0x165)](()=>__importStar(require('../../config/database'))))[_0x3eeac7(0x19d)],_0x1b10bf={'status':_0x126325[_0x3eeac7(0x19c)](),'updatedAt':new Date(),'statusChangedBy':_0x3eeac7(0x1c0),'statusChangedAt':new Date()};_0x126325===_0x3eeac7(0x10c)&&(_0x1b10bf['paidAt']=new Date()),_0x1abaf7['description']&&(_0x1b10bf[_0x3eeac7(0x138)]='MasterCard:\x20'+_0x1abaf7[_0x3eeac7(0x16a)]),await _0x18d3ec[_0x3eeac7(0xf4)][_0x3eeac7(0x159)]({'where':{'id':_0x188b75},'data':_0x1b10bf}),console['log'](_0x3eeac7(0x1c9)+_0x188b75+_0x3eeac7(0x1d1)+_0x126325),await this['sendPaymentNotifications'](_0x188b75,_0x126325);}catch(_0x24a288){console[_0x3eeac7(0x141)](_0x3eeac7(0x1cb)+_0x188b75+':',_0x24a288);}}async[a42_0x24555e(0xfd)](_0x707029,_0x59ecfd){const _0x1277e2=a42_0x24555e;try{const _0x9ee918=(await Promise[_0x1277e2(0x184)]()[_0x1277e2(0x165)](()=>__importStar(require('../../config/database'))))['default'],{telegramBotService:_0x2732bd}=await Promise['resolve']()[_0x1277e2(0x165)](()=>__importStar(require(_0x1277e2(0x15c)))),_0x268a14=await _0x9ee918[_0x1277e2(0xf4)]['findUnique']({'where':{'id':_0x707029},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x268a14)return;const _0x35212d={'PAID':_0x1277e2(0x14b),'FAILED':'failed'},_0x9c46af=_0x35212d[_0x59ecfd];_0x9c46af&&await _0x2732bd[_0x1277e2(0x1d3)](_0x268a14[_0x1277e2(0x194)],_0x268a14,_0x9c46af),await this[_0x1277e2(0xf2)](_0x268a14,_0x59ecfd);}catch(_0xd3da94){console[_0x1277e2(0x141)](_0x1277e2(0x1bf),_0xd3da94);}}async[a42_0x24555e(0xf2)](_0x43bb93,_0xc345c2){const _0x20e6b6=a42_0x24555e,_0x133a62=Date[_0x20e6b6(0x110)]();try{const _0x49d64e=_0x43bb93[_0x20e6b6(0x102)],_0x530090=_0x49d64e['settings'];if(!_0x530090?.[_0x20e6b6(0x146)]){console[_0x20e6b6(0x18c)](_0x20e6b6(0xed)+_0x49d64e['id']);return;}const _0x4a5f31=_0xc345c2==='PAID'?_0x20e6b6(0x145):_0x20e6b6(0x17b);let _0xe7f58a=[];if(_0x530090[_0x20e6b6(0x15f)])try{_0xe7f58a=Array[_0x20e6b6(0x16e)](_0x530090[_0x20e6b6(0x15f)])?_0x530090[_0x20e6b6(0x15f)]:JSON['parse'](_0x530090[_0x20e6b6(0x15f)]);}catch(_0x416aaa){console[_0x20e6b6(0x141)](_0x20e6b6(0xec),_0x416aaa),_0xe7f58a=[];}if(!_0xe7f58a[_0x20e6b6(0x151)](_0x4a5f31)){console[_0x20e6b6(0x18c)](_0x20e6b6(0x179)+_0x4a5f31+'\x20not\x20enabled\x20for\x20shop\x20'+_0x49d64e['id']);return;}const _0x33cee4={'event':_0x4a5f31,'payment':{'id':_0x43bb93['id'],'order_id':_0x43bb93[_0x20e6b6(0x168)],'gateway_order_id':_0x43bb93[_0x20e6b6(0x174)],'gateway':_0x20e6b6(0x18d),'amount':_0x43bb93[_0x20e6b6(0x17a)],'currency':_0x43bb93['currency'],'status':_0xc345c2[_0x20e6b6(0x107)](),'customer_email':_0x43bb93[_0x20e6b6(0x1ad)],'customer_name':_0x43bb93['customerName'],'created_at':_0x43bb93[_0x20e6b6(0x150)],'updated_at':new Date()}},_0x50c29e=await fetch(_0x530090[_0x20e6b6(0x146)],{'method':_0x20e6b6(0xeb),'headers':{'Content-Type':_0x20e6b6(0x10d),'User-Agent':_0x20e6b6(0x16c)},'body':JSON[_0x20e6b6(0x126)](_0x33cee4)}),_0x56906d=Date[_0x20e6b6(0x110)]()-_0x133a62;loggerService_1[_0x20e6b6(0x18f)]['logShopWebhookSent'](_0x43bb93['shopId'],_0x530090[_0x20e6b6(0x146)],_0x4a5f31,_0x50c29e[_0x20e6b6(0x105)],_0x56906d,_0x33cee4),console['log']('MasterCard\x20webhook\x20sent\x20to\x20'+_0x530090['webhookUrl']+_0x20e6b6(0x193)+_0x50c29e[_0x20e6b6(0x105)]+'\x20('+_0x56906d+_0x20e6b6(0x1c7));}catch(_0x364176){console[_0x20e6b6(0x141)]('Failed\x20to\x20send\x20MasterCard\x20webhook:',_0x364176),loggerService_1[_0x20e6b6(0x18f)][_0x20e6b6(0x156)](_0x43bb93[_0x20e6b6(0x194)],_0x43bb93['shop']?.[_0x20e6b6(0x1a7)]?.[_0x20e6b6(0x146)]||'unknown','webhook_send',_0x364176,{});}}[a42_0x24555e(0x191)](_0x10d5c3){const _0x4646e9=a42_0x24555e,_0x17ad4d=_0x10d5c3['replace'](/[\s-]/g,'');if(_0x17ad4d['length']<0x4)return _0x4646e9(0x1b3);return _0x4646e9(0x144)+_0x17ad4d[_0x4646e9(0x11f)](-0x4);}async[a42_0x24555e(0x13c)](_0x1ca4d1){const _0x542d13=a42_0x24555e;console[_0x542d13(0x18c)](_0x542d13(0x1ae),_0x1ca4d1);let _0x441d7f=_0x542d13(0x177);if(_0x1ca4d1[_0x542d13(0x105)]===0x1&&_0x1ca4d1[_0x542d13(0x183)]===0x1)_0x441d7f='PAID';else _0x1ca4d1['status']===0x0&&_0x1ca4d1['final']===0x0?_0x441d7f=_0x542d13(0x177):_0x441d7f=_0x542d13(0x15a);return{'paymentId':_0x1ca4d1[_0x542d13(0x19f)]||'','status':_0x441d7f,'amount':_0x1ca4d1[_0x542d13(0x17a)],'currency':_0x1ca4d1[_0x542d13(0x1a3)]};}['stopAllStatusChecks'](){const _0x587df3=a42_0x24555e;console[_0x587df3(0x18c)](_0x587df3(0x1aa));const _0x4d1da7=this['statusCheckTimers'][_0x587df3(0x1b5)];for(const [_0x114f10]of this[_0x587df3(0x12b)]){this[_0x587df3(0x14a)](_0x114f10);}console['log']('🛑\x20Stopped\x20'+_0x4d1da7+_0x587df3(0x178));}}exports['MasterCardService']=MasterCardService;