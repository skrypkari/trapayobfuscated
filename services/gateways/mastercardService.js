'use strict';const a42_0x37a556=a42_0xa029;(function(_0x59b78b,_0x4ab718){const _0x2ae110=a42_0xa029,_0xd20a65=_0x59b78b();while(!![]){try{const _0x495711=parseInt(_0x2ae110(0x130))/0x1*(parseInt(_0x2ae110(0x13c))/0x2)+parseInt(_0x2ae110(0x1a7))/0x3*(-parseInt(_0x2ae110(0x1f2))/0x4)+parseInt(_0x2ae110(0x1ac))/0x5*(parseInt(_0x2ae110(0x17e))/0x6)+-parseInt(_0x2ae110(0x1cb))/0x7*(parseInt(_0x2ae110(0x18f))/0x8)+parseInt(_0x2ae110(0x14e))/0x9*(-parseInt(_0x2ae110(0x1bd))/0xa)+-parseInt(_0x2ae110(0x182))/0xb+parseInt(_0x2ae110(0x16a))/0xc;if(_0x495711===_0x4ab718)break;else _0xd20a65['push'](_0xd20a65['shift']());}catch(_0x1ac382){_0xd20a65['push'](_0xd20a65['shift']());}}}(a42_0x14b2,0x20fbe));var __createBinding=this&&this[a42_0x37a556(0x178)]||(Object[a42_0x37a556(0x11e)]?function(_0x353baf,_0x2596a0,_0x5a05b6,_0xd3979){const _0x520fd5=a42_0x37a556;if(_0xd3979===undefined)_0xd3979=_0x5a05b6;var _0x59e349=Object['getOwnPropertyDescriptor'](_0x2596a0,_0x5a05b6);(!_0x59e349||(_0x520fd5(0x1a4)in _0x59e349?!_0x2596a0['__esModule']:_0x59e349['writable']||_0x59e349[_0x520fd5(0x1ef)]))&&(_0x59e349={'enumerable':!![],'get':function(){return _0x2596a0[_0x5a05b6];}}),Object[_0x520fd5(0x11a)](_0x353baf,_0xd3979,_0x59e349);}:function(_0x4196fa,_0xbe58b5,_0x438c24,_0x81546a){if(_0x81546a===undefined)_0x81546a=_0x438c24;_0x4196fa[_0x81546a]=_0xbe58b5[_0x438c24];}),__setModuleDefault=this&&this[a42_0x37a556(0x111)]||(Object[a42_0x37a556(0x11e)]?function(_0x4c4bcc,_0x47b517){const _0xe19cfb=a42_0x37a556;Object[_0xe19cfb(0x11a)](_0x4c4bcc,_0xe19cfb(0x106),{'enumerable':!![],'value':_0x47b517});}:function(_0x183266,_0x9384f5){const _0x47e7b5=a42_0x37a556;_0x183266[_0x47e7b5(0x106)]=_0x9384f5;}),__importStar=this&&this[a42_0x37a556(0x129)]||(function(){var _0x3c8a84=function(_0x4d7beb){return _0x3c8a84=Object['getOwnPropertyNames']||function(_0x4ecefc){const _0x369bf2=a42_0xa029;var _0x5c0fb7=[];for(var _0x4bc347 in _0x4ecefc)if(Object[_0x369bf2(0x19d)][_0x369bf2(0x1ee)][_0x369bf2(0x18a)](_0x4ecefc,_0x4bc347))_0x5c0fb7[_0x5c0fb7[_0x369bf2(0x1b6)]]=_0x4bc347;return _0x5c0fb7;},_0x3c8a84(_0x4d7beb);};return function(_0x1ac652){const _0x3dffb2=a42_0xa029;if(_0x1ac652&&_0x1ac652[_0x3dffb2(0x1c1)])return _0x1ac652;var _0x45f586={};if(_0x1ac652!=null){for(var _0x5b4053=_0x3c8a84(_0x1ac652),_0x1cb895=0x0;_0x1cb895<_0x5b4053[_0x3dffb2(0x1b6)];_0x1cb895++)if(_0x5b4053[_0x1cb895]!==_0x3dffb2(0x106))__createBinding(_0x45f586,_0x1ac652,_0x5b4053[_0x1cb895]);}return __setModuleDefault(_0x45f586,_0x1ac652),_0x45f586;};}()),__importDefault=this&&this[a42_0x37a556(0x1dc)]||function(_0x820971){const _0x2ce0f4=a42_0x37a556;return _0x820971&&_0x820971[_0x2ce0f4(0x1c1)]?_0x820971:{'default':_0x820971};};Object[a42_0x37a556(0x11a)](exports,'__esModule',{'value':!![]}),exports[a42_0x37a556(0x11c)]=void 0x0;function a42_0xa029(_0x2db529,_0x2399ca){const _0x14b2dd=a42_0x14b2();return a42_0xa029=function(_0xa02990,_0x4c2b19){_0xa02990=_0xa02990-0xfe;let _0x286b41=_0x14b2dd[_0xa02990];return _0x286b41;},a42_0xa029(_0x2db529,_0x2399ca);}const crypto_1=__importDefault(require(a42_0x37a556(0x1d2))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a42_0x37a556(0x1da))),loggerService_1=require(a42_0x37a556(0x1a1));class MasterCardService{constructor(){const _0x2fc7d0=a42_0x37a556;this[_0x2fc7d0(0x135)]=new Map(),this[_0x2fc7d0(0x1cc)]=_0x2fc7d0(0x1c8),this[_0x2fc7d0(0x199)]=0x67c,this[_0x2fc7d0(0x1de)]=path_1[_0x2fc7d0(0x106)][_0x2fc7d0(0x186)](process[_0x2fc7d0(0x1f8)](),'keys','private.pem'),this['publicKeyPath']=path_1[_0x2fc7d0(0x106)][_0x2fc7d0(0x186)](process['cwd'](),_0x2fc7d0(0x103),_0x2fc7d0(0x122)),console[_0x2fc7d0(0x15b)](_0x2fc7d0(0x1f1)),console['log'](_0x2fc7d0(0x165),this[_0x2fc7d0(0x1de)]),console[_0x2fc7d0(0x15b)](_0x2fc7d0(0x184),this['publicKeyPath']),this[_0x2fc7d0(0x1a2)]();}[a42_0x37a556(0x1a2)](){const _0x439757=a42_0x37a556;try{if(!fs_1[_0x439757(0x106)][_0x439757(0x16f)](this[_0x439757(0x1de)]))throw new Error(_0x439757(0x149)+this[_0x439757(0x1de)]);if(!fs_1[_0x439757(0x106)]['existsSync'](this['publicKeyPath']))throw new Error(_0x439757(0x1aa)+this[_0x439757(0x1f9)]);const _0x4a2de8=fs_1[_0x439757(0x106)]['readFileSync'](this['privateKeyPath'],_0x439757(0x10a))['trim'](),_0x2fac98=fs_1['default'][_0x439757(0x189)](this[_0x439757(0x1f9)],_0x439757(0x10a))[_0x439757(0x1fd)]();if(!_0x4a2de8[_0x439757(0x1b5)](_0x439757(0x148))||!_0x4a2de8['includes'](_0x439757(0x1f3)))throw new Error(_0x439757(0x1e9));if(!_0x2fac98[_0x439757(0x1b5)](_0x439757(0x148))||!_0x2fac98['includes'](_0x439757(0x1f3)))throw new Error(_0x439757(0x169));console['log'](_0x439757(0x16d)),console[_0x439757(0x15b)]('🔐\x20Private\x20key\x20length:\x20'+_0x4a2de8[_0x439757(0x1b6)]+_0x439757(0x167)),console[_0x439757(0x15b)]('🔐\x20Public\x20key\x20length:\x20'+_0x2fac98[_0x439757(0x1b6)]+_0x439757(0x167));}catch(_0xbad6b8){console[_0x439757(0x170)](_0x439757(0x13e),_0xbad6b8);throw _0xbad6b8;}}[a42_0x37a556(0x175)](){const _0x5d26b7=a42_0x37a556,_0x7eb6e7=crypto_1[_0x5d26b7(0x106)]['randomBytes'](0x20),_0xe4852d=crypto_1[_0x5d26b7(0x106)]['randomBytes'](0x10);return{'key':_0x7eb6e7,'iv':_0xe4852d};}[a42_0x37a556(0x12f)](_0x1c5732,_0x4fa64d,_0x26f73e){const _0x38e85c=a42_0x37a556,_0x596863=crypto_1[_0x38e85c(0x106)][_0x38e85c(0x160)](_0x38e85c(0x18d),_0x4fa64d,_0x26f73e);let _0x20735c=_0x596863[_0x38e85c(0x14b)](_0x1c5732,_0x38e85c(0x10a),_0x38e85c(0x162));return _0x20735c+=_0x596863[_0x38e85c(0x180)](_0x38e85c(0x162)),_0x20735c;}[a42_0x37a556(0x17b)](_0x3a8bba,_0x26642c){const _0x2f777d=a42_0x37a556;try{const _0x3282c9=fs_1[_0x2f777d(0x106)][_0x2f777d(0x189)](this[_0x2f777d(0x1f9)],'utf8')[_0x2f777d(0x1fd)](),_0x26a61a={'iv':_0x26642c[_0x2f777d(0x141)](_0x2f777d(0x162)),'key':_0x3a8bba[_0x2f777d(0x141)]('base64')},_0x72a1a0=JSON[_0x2f777d(0x1b8)](_0x26a61a);console[_0x2f777d(0x15b)](_0x2f777d(0x1d7),_0x72a1a0['length']);const _0x17b660=crypto_1[_0x2f777d(0x106)][_0x2f777d(0x1c5)]({'key':_0x3282c9,'padding':crypto_1[_0x2f777d(0x106)][_0x2f777d(0x177)][_0x2f777d(0x112)]},Buffer['from'](_0x72a1a0));return console[_0x2f777d(0x15b)]('✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:',_0x17b660['length']),_0x17b660[_0x2f777d(0x141)]('base64');}catch(_0x140fbb){console[_0x2f777d(0x170)]('❌\x20RSA\x20encryption\x20failed:',_0x140fbb);throw new Error(_0x2f777d(0x179));}}[a42_0x37a556(0x1e2)](_0x427d15){const _0x2e23bb=a42_0x37a556;try{const _0x24535d=fs_1[_0x2e23bb(0x106)]['readFileSync'](this[_0x2e23bb(0x1de)],_0x2e23bb(0x10a))[_0x2e23bb(0x1fd)](),_0x1ed09c=crypto_1[_0x2e23bb(0x106)][_0x2e23bb(0x12b)](_0x2e23bb(0x19a));_0x1ed09c['update'](_0x427d15),_0x1ed09c[_0x2e23bb(0x183)]();const _0x411116=_0x1ed09c[_0x2e23bb(0x1bc)](_0x24535d,_0x2e23bb(0x162));return console[_0x2e23bb(0x15b)](_0x2e23bb(0x154)),console[_0x2e23bb(0x15b)](_0x2e23bb(0x161),_0x427d15[_0x2e23bb(0x1b6)]),console[_0x2e23bb(0x15b)](_0x2e23bb(0x147),_0x411116['length']),_0x411116;}catch(_0x343ff1){console[_0x2e23bb(0x170)]('❌\x20RSA\x20signing\x20failed:',_0x343ff1),console[_0x2e23bb(0x170)](_0x2e23bb(0x1ad),_0x427d15[_0x2e23bb(0x14c)](0x0,0xc8)+_0x2e23bb(0x197));throw new Error('Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key');}}['decryptAES'](_0x225b37,_0x2a5315,_0x1ea674){const _0x4939a4=a42_0x37a556,_0x18ab5c=crypto_1[_0x4939a4(0x106)][_0x4939a4(0x1eb)]('aes-256-ctr',_0x2a5315,_0x1ea674);let _0x377d15=_0x18ab5c['update'](_0x225b37,_0x4939a4(0x162),_0x4939a4(0x10a));return _0x377d15+=_0x18ab5c[_0x4939a4(0x180)](_0x4939a4(0x10a)),_0x377d15;}async['decryptResponsePhp'](_0x227613,_0x331c71){const _0x18f430=a42_0x37a556;try{const _0x331af0=await fetch(_0x18f430(0x1d4),{'method':_0x18f430(0x1ab),'headers':{'Content-Type':_0x18f430(0x134)},'body':JSON['stringify']({'info':_0x227613,'key':_0x331c71})});if(!_0x331af0['ok'])throw new Error(_0x18f430(0x1c0));return await _0x331af0['text']();}catch(_0x379ce1){console[_0x18f430(0x170)](_0x18f430(0x118),_0x379ce1);throw new Error('Failed\x20to\x20decrypt\x20response\x20via\x20PHP');}}[a42_0x37a556(0x131)](_0x4e1391,_0x42633d){const _0xb6e30f=a42_0x37a556;try{const _0x2c8201=fs_1[_0xb6e30f(0x106)][_0xb6e30f(0x189)](this[_0xb6e30f(0x1de)],_0xb6e30f(0x10a))[_0xb6e30f(0x1fd)](),_0x33b95a=crypto_1[_0xb6e30f(0x106)][_0xb6e30f(0x137)](_0x2c8201,Buffer[_0xb6e30f(0x1a0)](_0x42633d,_0xb6e30f(0x162))),_0x10457d=JSON[_0xb6e30f(0x136)](_0x33b95a[_0xb6e30f(0x141)]()),_0x674118=Buffer[_0xb6e30f(0x1a0)](_0x10457d[_0xb6e30f(0x11d)],_0xb6e30f(0x162)),_0x552405=Buffer[_0xb6e30f(0x1a0)](_0x10457d['iv'],_0xb6e30f(0x162));return this[_0xb6e30f(0x109)](_0x4e1391,_0x674118,_0x552405);}catch(_0x1a72f8){throw new Error(_0xb6e30f(0x1d6));}}async[a42_0x37a556(0x176)](_0x24dd5e){const _0x3d58d2=a42_0x37a556,{paymentId:_0xab40dc,orderId:_0x2d88ab,amount:_0x38201a,currency:_0x3c8a97,cardData:_0x1d9d51,resultUrl:_0x5b02e9,returnUrl:_0x37b7a4,cardHolder:_0x4b5c00,browser:_0x364d1b}=_0x24dd5e;console[_0x3d58d2(0x15b)](_0x3d58d2(0x146)),console['log'](_0x3d58d2(0x10d),_0xab40dc),console[_0x3d58d2(0x15b)](_0x3d58d2(0x12e),_0x2d88ab),console['log']('Amount:',_0x38201a,_0x3c8a97),console[_0x3d58d2(0x15b)](_0x3d58d2(0x1ea),this['maskCardNumber'](_0x1d9d51[_0x3d58d2(0x1d1)])),console[_0x3d58d2(0x15b)]('Card\x20Holder:',_0x4b5c00[_0x3d58d2(0x133)]+'\x20'+_0x4b5c00[_0x3d58d2(0x173)]),console[_0x3d58d2(0x15b)](_0x3d58d2(0x1db),_0x37b7a4),console[_0x3d58d2(0x15b)](_0x3d58d2(0x187),_0x5b02e9);const _0x4de052={'amount':_0x38201a,'currency':_0x3c8a97['toUpperCase'](),'order_id':_0x2d88ab,'result_url':_0x5b02e9,'return_url':_0x37b7a4,'card':{'number':_0x1d9d51['number'],'expire_month':_0x1d9d51['expire_month'],'expire_year':_0x1d9d51[_0x3d58d2(0x17c)],'cvv':_0x1d9d51[_0x3d58d2(0x198)]},'card_holder':_0x4b5c00,'browser':_0x364d1b},_0x4666e2=JSON[_0x3d58d2(0x1b8)](_0x4de052);console['log'](_0x3d58d2(0x1b2)),console['log']('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console[_0x3d58d2(0x15b)](_0x4666e2),console['log']('📝\x20Data\x20length:',_0x4666e2[_0x3d58d2(0x1b6)]);try{const {key:_0x3a699e,iv:_0x22b3b0}=this[_0x3d58d2(0x175)]();console[_0x3d58d2(0x15b)](_0x3d58d2(0x15f)),console[_0x3d58d2(0x15b)](_0x3d58d2(0x1a3),_0x3a699e['length']),console[_0x3d58d2(0x15b)](_0x3d58d2(0x110),_0x22b3b0['length']);const _0x1a3627=this[_0x3d58d2(0x12f)](_0x4666e2,_0x3a699e,_0x22b3b0);console['log'](_0x3d58d2(0x117)),console['log'](_0x3d58d2(0x174),_0x1a3627[_0x3d58d2(0x1b6)]);const _0x52956a=this[_0x3d58d2(0x17b)](_0x3a699e,_0x22b3b0);console[_0x3d58d2(0x15b)](_0x3d58d2(0x101)),console['log'](_0x3d58d2(0x108),_0x52956a[_0x3d58d2(0x1b6)]);const _0x5e456b=this['signRSA'](_0x4666e2);console[_0x3d58d2(0x15b)](_0x3d58d2(0x1bf)),console[_0x3d58d2(0x15b)]('📝\x20Signature\x20length:',_0x5e456b[_0x3d58d2(0x1b6)]);const _0x81f300={'merchant_point_id':this[_0x3d58d2(0x199)],'method':'charge','info':_0x1a3627,'key':_0x52956a,'sign':_0x5e456b,'lang':'en'};console[_0x3d58d2(0x15b)](_0x3d58d2(0x102)),console[_0x3d58d2(0x15b)]('📝\x20Final\x20request\x20structure:'),console[_0x3d58d2(0x15b)](_0x3d58d2(0x157),this[_0x3d58d2(0x199)]),console[_0x3d58d2(0x15b)]('\x20\x20\x20-\x20method:\x20charge'),console[_0x3d58d2(0x15b)](_0x3d58d2(0x104),_0x1a3627[_0x3d58d2(0x1b6)]),console[_0x3d58d2(0x15b)]('\x20\x20\x20-\x20key\x20length:',_0x52956a[_0x3d58d2(0x1b6)]),console['log']('\x20\x20\x20-\x20sign\x20length:',_0x5e456b[_0x3d58d2(0x1b6)]),console['log'](_0x3d58d2(0x1fb)),loggerService_1[_0x3d58d2(0x142)][_0x3d58d2(0x19b)]('mastercard',_0x3d58d2(0x126),_0x3d58d2(0x1ab),{'merchant_point_id':this['merchantPointId'],'method':_0x3d58d2(0x1a6),'lang':'en'});const _0x322fd7=Date[_0x3d58d2(0x1c2)](),_0x3bee4b=await fetch(this[_0x3d58d2(0x1cc)],{'method':_0x3d58d2(0x1ab),'headers':{'Content-Type':'application/json','Accept':_0x3d58d2(0x134),'User-Agent':_0x3d58d2(0x116)},'body':JSON[_0x3d58d2(0x1b8)](_0x81f300)}),_0x2877ca=Date[_0x3d58d2(0x1c2)]()-_0x322fd7;console[_0x3d58d2(0x15b)]('===\x20MASTERCARD\x20API\x20RESPONSE\x20==='),console[_0x3d58d2(0x15b)]('Status:',_0x3bee4b[_0x3d58d2(0x168)]),console[_0x3d58d2(0x15b)]('Response\x20Time:',_0x2877ca+'ms');if(!_0x3bee4b['ok']){const _0x76cb19=await _0x3bee4b[_0x3d58d2(0x1c7)]();console[_0x3d58d2(0x170)](_0x3d58d2(0x1b9),_0x3bee4b['status']),console[_0x3d58d2(0x170)](_0x3d58d2(0x17f),_0x76cb19),loggerService_1[_0x3d58d2(0x142)][_0x3d58d2(0x166)](_0x3d58d2(0x1ce),_0x3d58d2(0x119),_0x3bee4b['status'],_0x76cb19,_0x2877ca),loggerService_1[_0x3d58d2(0x142)][_0x3d58d2(0x123)](_0x3d58d2(0x1ce),'/charge',_0x3d58d2(0x1e0)+_0x3bee4b[_0x3d58d2(0x168)]+':\x20'+_0x76cb19);throw new Error(_0x3d58d2(0x1c4)+_0x3bee4b['status']+',\x20body:\x20'+_0x76cb19);}const _0x24e56c=await _0x3bee4b['json']();loggerService_1[_0x3d58d2(0x142)][_0x3d58d2(0x166)]('mastercard',_0x3d58d2(0x119),_0x3bee4b[_0x3d58d2(0x168)],_0x24e56c,_0x2877ca),console[_0x3d58d2(0x15b)](_0x3d58d2(0x1a8));let _0x48782f=_0x24e56c;if(_0x24e56c[_0x3d58d2(0x1d8)]&&_0x24e56c[_0x3d58d2(0x11d)]&&_0x24e56c[_0x3d58d2(0x1bc)]){console[_0x3d58d2(0x15b)](_0x3d58d2(0x159));try{const _0x1ce2d0=await this['decryptResponsePhp'](_0x24e56c[_0x3d58d2(0x1d8)],_0x24e56c[_0x3d58d2(0x11d)]);_0x48782f=JSON['parse'](_0x1ce2d0),console[_0x3d58d2(0x15b)](_0x3d58d2(0x16b)),loggerService_1[_0x3d58d2(0x142)]['logWhiteDomainResponse'](_0x3d58d2(0x1ce),'/charge_decrypted',_0x3bee4b[_0x3d58d2(0x168)],_0x48782f,_0x2877ca),console[_0x3d58d2(0x15b)](_0x3d58d2(0x113));}catch(_0x4cfadf){console['error'](_0x3d58d2(0x1f4),_0x4cfadf),loggerService_1['loggerService']['logWhiteDomainError'](_0x3d58d2(0x1ce),'/charge_decrypt',_0x3d58d2(0xff)+_0x4cfadf),_0x48782f=_0x24e56c;}}else loggerService_1[_0x3d58d2(0x142)][_0x3d58d2(0x166)](_0x3d58d2(0x1ce),_0x3d58d2(0x1b1),_0x3bee4b['status'],_0x48782f,_0x2877ca),console[_0x3d58d2(0x15b)](_0x3d58d2(0x19e));console[_0x3d58d2(0x15b)](_0x3d58d2(0x1e8),_0x48782f[_0x3d58d2(0x168)]),console[_0x3d58d2(0x15b)](_0x3d58d2(0x1fc),_0x48782f[_0x3d58d2(0x180)]),console['log']('Payment\x20ID:',_0x48782f[_0x3d58d2(0x13b)]),console['log']('3DS\x20URL:',_0x48782f[_0x3d58d2(0x1b3)]||_0x3d58d2(0x1e1));if(_0x48782f['status']===0x64&&_0x48782f[_0x3d58d2(0x180)]===0x1)return console[_0x3d58d2(0x15b)](_0x3d58d2(0x124)),{'gateway_payment_id':_0x48782f[_0x3d58d2(0x13b)]?.[_0x3d58d2(0x141)](),'payment_url':_0x37b7a4,'requires_3ds':![],'status':_0x3d58d2(0x153),'final':!![]};if(_0x48782f[_0x3d58d2(0x1b3)])return console[_0x3d58d2(0x15b)](_0x3d58d2(0x192)),this[_0x3d58d2(0x138)](_0xab40dc,_0x2d88ab,_0x48782f[_0x3d58d2(0x13b)]?.['toString']()||_0x2d88ab),{'gateway_payment_id':_0x48782f['payment_id']?.[_0x3d58d2(0x141)](),'payment_url':_0x48782f[_0x3d58d2(0x1b3)],'requires_3ds':!![],'threeds_url':_0x48782f[_0x3d58d2(0x1b3)],'status':_0x3d58d2(0x1ae),'final':![]};let _0x1fc053=_0x48782f[_0x3d58d2(0x12d)]||_0x48782f[_0x3d58d2(0x10c)]||_0x3d58d2(0x16c),_0x5bb49a=_0x48782f[_0x3d58d2(0x168)],_0x5cbf9c=_0x48782f['final'];return console[_0x3d58d2(0x15b)]('❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20'+_0x5bb49a+_0x3d58d2(0x17a)+_0x5cbf9c+_0x3d58d2(0x195)+_0x1fc053),{'gateway_payment_id':_0x48782f[_0x3d58d2(0x13b)]?.['toString'](),'payment_url':_0x37b7a4,'requires_3ds':![],'status':'FAILED','final':!![]};}catch(_0x1f0d9a){console['error']('===\x20MASTERCARD\x20SERVICE\x20ERROR\x20==='),console[_0x3d58d2(0x170)](_0x3d58d2(0x1e6),_0x1f0d9a),loggerService_1['loggerService'][_0x3d58d2(0x123)](_0x3d58d2(0x1ce),_0x3d58d2(0x126),_0x1f0d9a);throw new Error(_0x3d58d2(0x17d)+(_0x1f0d9a instanceof Error?_0x1f0d9a[_0x3d58d2(0x10c)]:_0x3d58d2(0x16c)));}}async[a42_0x37a556(0x1ca)](_0x5169a7,_0x47e04e){const _0x39f49c=a42_0x37a556;console[_0x39f49c(0x15b)](_0x39f49c(0x15e)+_0x5169a7+'\x20('+_0x47e04e+')');try{const _0x430a6b={'payment_id':_0x5169a7,'order_id':_0x47e04e},_0x491bde=JSON[_0x39f49c(0x1b8)](_0x430a6b),{key:_0x5961b1,iv:_0x584273}=this[_0x39f49c(0x175)](),_0x44e806=this[_0x39f49c(0x12f)](_0x491bde,_0x5961b1,_0x584273),_0x53ee99=this['encryptRSA'](_0x5961b1,_0x584273),_0x58a6ee=this[_0x39f49c(0x1e2)](_0x491bde),_0x42e857={'merchant_point_id':this[_0x39f49c(0x199)],'method':_0x39f49c(0x168),'info':_0x44e806,'key':_0x53ee99,'sign':_0x58a6ee,'lang':'en'};loggerService_1[_0x39f49c(0x142)][_0x39f49c(0x19b)](_0x39f49c(0x1ce),'/status',_0x39f49c(0x1ab),{'merchant_point_id':this['merchantPointId'],'method':'status','lang':'en'});const _0x32cb0f=Date[_0x39f49c(0x1c2)](),_0x46f0a0=await fetch(this[_0x39f49c(0x1cc)],{'method':'POST','headers':{'Content-Type':_0x39f49c(0x134),'Accept':_0x39f49c(0x134),'User-Agent':_0x39f49c(0x116)},'body':JSON[_0x39f49c(0x1b8)](_0x42e857)}),_0x32005a=Date[_0x39f49c(0x1c2)]()-_0x32cb0f;if(!_0x46f0a0['ok']){const _0x184ad2=await _0x46f0a0[_0x39f49c(0x1c7)]();loggerService_1[_0x39f49c(0x142)][_0x39f49c(0x166)](_0x39f49c(0x1ce),_0x39f49c(0x18e),_0x46f0a0[_0x39f49c(0x168)],_0x184ad2,_0x32005a);throw new Error(_0x39f49c(0x1c4)+_0x46f0a0[_0x39f49c(0x168)]);}const _0xb512f8=await _0x46f0a0[_0x39f49c(0x185)]();loggerService_1['loggerService'][_0x39f49c(0x166)](_0x39f49c(0x1ce),_0x39f49c(0x18e),_0x46f0a0[_0x39f49c(0x168)],_0xb512f8,_0x32005a);let _0x5e2484=_0xb512f8;if(_0xb512f8[_0x39f49c(0x1d8)]&&_0xb512f8['key']&&_0xb512f8[_0x39f49c(0x1bc)]){console[_0x39f49c(0x15b)]('🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...');try{const _0x188301=this[_0x39f49c(0x131)](_0xb512f8[_0x39f49c(0x1d8)],_0xb512f8[_0x39f49c(0x11d)]);_0x5e2484=JSON['parse'](_0x188301),console[_0x39f49c(0x15b)](_0x39f49c(0x1b0)),loggerService_1[_0x39f49c(0x142)][_0x39f49c(0x166)](_0x39f49c(0x1ce),_0x39f49c(0x1fa),_0x46f0a0['status'],_0x5e2484,_0x32005a),console[_0x39f49c(0x15b)](_0x39f49c(0x18c));}catch(_0xcec38d){console[_0x39f49c(0x170)](_0x39f49c(0x1e7),_0xcec38d),loggerService_1[_0x39f49c(0x142)][_0x39f49c(0x123)](_0x39f49c(0x1ce),_0x39f49c(0x107),'Status\x20decryption\x20failed:\x20'+_0xcec38d),_0x5e2484=_0xb512f8;}}else loggerService_1[_0x39f49c(0x142)][_0x39f49c(0x166)](_0x39f49c(0x1ce),_0x39f49c(0x1fa),_0x46f0a0[_0x39f49c(0x168)],_0x5e2484,_0x32005a),console[_0x39f49c(0x15b)](_0x39f49c(0x128));console[_0x39f49c(0x15b)](_0x39f49c(0x10f),{'status':_0x5e2484[_0x39f49c(0x168)],'final':_0x5e2484['final'],'payment_id':_0x5e2484['payment_id'],'desc':_0x5e2484[_0x39f49c(0x12d)]});let _0x54286c=_0x39f49c(0x1ae);if(_0x5e2484[_0x39f49c(0x168)]===0x1&&_0x5e2484['final']===0x1)_0x54286c=_0x39f49c(0x153);else _0x5e2484[_0x39f49c(0x168)]===0x0&&_0x5e2484[_0x39f49c(0x180)]===0x0?_0x54286c=_0x39f49c(0x1ae):_0x54286c=_0x39f49c(0x163);return{'status':_0x54286c,'final':_0x5e2484[_0x39f49c(0x180)]===0x1,'amount':_0x5e2484[_0x39f49c(0x1bb)],'currency':_0x5e2484[_0x39f49c(0x13f)],'date_success':_0x5e2484[_0x39f49c(0x1f0)],'description':_0x5e2484[_0x39f49c(0x12d)]};}catch(_0x31699b){console[_0x39f49c(0x170)]('MasterCard\x20status\x20check\x20error:',_0x31699b),loggerService_1[_0x39f49c(0x142)][_0x39f49c(0x123)](_0x39f49c(0x1ce),_0x39f49c(0x18b),_0x31699b);throw new Error(_0x39f49c(0x143)+(_0x31699b instanceof Error?_0x31699b['message']:_0x39f49c(0x16c)));}}[a42_0x37a556(0x138)](_0x39b391,_0x5a4f8e,_0x3490ae){const _0x47bab8=a42_0x37a556;console[_0x47bab8(0x15b)](_0x47bab8(0x193)+_0x39b391+'\x20('+_0x3490ae+')'),this['clearStatusTimers'](_0x39b391);const _0x381569=[],_0x2533d8=0x5*0x3c*0x3e8,_0x1b19c0=0x2*0x3c*0x3c*0x3e8,_0x2aa215=Math['floor'](_0x1b19c0/_0x2533d8);console[_0x47bab8(0x15b)](_0x47bab8(0x144)+_0x2aa215+_0x47bab8(0x164));for(let _0x49d446=0x1;_0x49d446<=_0x2aa215;_0x49d446++){const _0x79698=setTimeout(async()=>{const _0x240059=_0x47bab8;console['log'](_0x240059(0x1cd)+_0x49d446+'/'+_0x2aa215+_0x240059(0x172)+_0x39b391);try{const _0x34f94e=await this['checkPaymentStatus'](_0x3490ae,_0x5a4f8e);console[_0x240059(0x15b)](_0x240059(0x10e)+_0x49d446+_0x240059(0x151),_0x34f94e),_0x34f94e['final']&&(console[_0x240059(0x15b)](_0x240059(0x1af)+_0x39b391+_0x240059(0x140)+_0x34f94e['status']+_0x240059(0x1d9)),this['clearStatusTimers'](_0x39b391),await this[_0x240059(0x125)](_0x39b391,_0x34f94e[_0x240059(0x168)],_0x34f94e));}catch(_0x2e69f6){console['error'](_0x240059(0x10b)+_0x49d446+'\x20failed\x20for\x20payment\x20'+_0x39b391+':',_0x2e69f6);}},_0x49d446*_0x2533d8);_0x381569['push'](_0x79698);}this[_0x47bab8(0x135)][_0x47bab8(0x145)](_0x39b391,_0x381569),console[_0x47bab8(0x15b)](_0x47bab8(0x19c)+_0x2aa215+'\x20status\x20checks\x20for\x20payment\x20'+_0x39b391);}[a42_0x37a556(0x1ba)](_0x2b8525){const _0x32d356=a42_0x37a556,_0x407f04=this[_0x32d356(0x135)][_0x32d356(0x1a4)](_0x2b8525);_0x407f04&&(console[_0x32d356(0x15b)](_0x32d356(0x1a9)+_0x407f04['length']+_0x32d356(0x156)+_0x2b8525),_0x407f04[_0x32d356(0x15c)]((_0x4385ce,_0x321fb0)=>{clearTimeout(_0x4385ce);}),this[_0x32d356(0x135)][_0x32d356(0x1be)](_0x2b8525));}async[a42_0x37a556(0x125)](_0x512736,_0x3fe1ee,_0x4f4953){const _0x8520e0=a42_0x37a556;try{const _0xa3f7c=(await Promise[_0x8520e0(0x1d3)]()[_0x8520e0(0x16e)](()=>__importStar(require(_0x8520e0(0x100)))))[_0x8520e0(0x106)],_0xe67c3f={'status':_0x3fe1ee[_0x8520e0(0x190)](),'updatedAt':new Date(),'statusChangedBy':_0x8520e0(0x127),'statusChangedAt':new Date()};_0x3fe1ee===_0x8520e0(0x153)&&(_0xe67c3f[_0x8520e0(0x1b7)]=new Date()),_0x4f4953[_0x8520e0(0x121)]&&(_0xe67c3f[_0x8520e0(0x152)]=_0x8520e0(0x1b4)+_0x4f4953[_0x8520e0(0x121)]),await _0xa3f7c[_0x8520e0(0x15a)]['update']({'where':{'id':_0x512736},'data':_0xe67c3f}),console[_0x8520e0(0x15b)]('✅\x20Payment\x20'+_0x512736+_0x8520e0(0x1df)+_0x3fe1ee),await this[_0x8520e0(0x132)](_0x512736,_0x3fe1ee);}catch(_0x52b837){console[_0x8520e0(0x170)](_0x8520e0(0x1e5)+_0x512736+':',_0x52b837);}}async[a42_0x37a556(0x132)](_0x30f66c,_0x2c4c7c){const _0x373a61=a42_0x37a556;try{const _0xd15ca=(await Promise[_0x373a61(0x1d3)]()[_0x373a61(0x16e)](()=>__importStar(require(_0x373a61(0x100)))))['default'],{telegramBotService:_0x5599c3}=await Promise['resolve']()[_0x373a61(0x16e)](()=>__importStar(require(_0x373a61(0x1d0)))),_0x4df2f5=await _0xd15ca[_0x373a61(0x15a)][_0x373a61(0x139)]({'where':{'id':_0x30f66c},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x4df2f5)return;const _0x4979ea={'PAID':'paid','FAILED':_0x373a61(0x1f5)},_0x52d084=_0x4979ea[_0x2c4c7c];_0x52d084&&await _0x5599c3[_0x373a61(0x158)](_0x4df2f5[_0x373a61(0x1ed)],_0x4df2f5,_0x52d084),await this[_0x373a61(0x150)](_0x4df2f5,_0x2c4c7c);}catch(_0x3c8015){console[_0x373a61(0x170)](_0x373a61(0x191),_0x3c8015);}}async['sendShopWebhook'](_0xb3df8,_0x187acf){const _0x403d8f=a42_0x37a556,_0x3301e6=Date[_0x403d8f(0x1c2)]();try{const _0x171241=_0xb3df8[_0x403d8f(0x120)],_0x525abd=_0x171241['settings'];if(!_0x525abd?.[_0x403d8f(0x1dd)]){console['log'](_0x403d8f(0x1a5)+_0x171241['id']);return;}const _0x522721=_0x187acf==='PAID'?_0x403d8f(0x11f):_0x403d8f(0x1ec);let _0x2da714=[];if(_0x525abd[_0x403d8f(0x1f7)])try{_0x2da714=Array[_0x403d8f(0x13d)](_0x525abd[_0x403d8f(0x1f7)])?_0x525abd['webhookEvents']:JSON[_0x403d8f(0x136)](_0x525abd['webhookEvents']);}catch(_0x5cedc0){console[_0x403d8f(0x170)](_0x403d8f(0x105),_0x5cedc0),_0x2da714=[];}if(!_0x2da714[_0x403d8f(0x1b5)](_0x522721)){console[_0x403d8f(0x15b)](_0x403d8f(0x155)+_0x522721+_0x403d8f(0x12a)+_0x171241['id']);return;}const _0x1cecbd={'event':_0x522721,'payment':{'id':_0xb3df8['id'],'order_id':_0xb3df8[_0x403d8f(0x15d)],'gateway_order_id':_0xb3df8['gatewayOrderId'],'gateway':_0x403d8f(0x1cf),'amount':_0xb3df8[_0x403d8f(0x1bb)],'currency':_0xb3df8[_0x403d8f(0x13f)],'status':_0x187acf[_0x403d8f(0x171)](),'customer_email':_0xb3df8[_0x403d8f(0x14a)],'customer_name':_0xb3df8[_0x403d8f(0x11b)],'created_at':_0xb3df8[_0x403d8f(0x14d)],'updated_at':new Date()}},_0x2fa62e=await fetch(_0x525abd[_0x403d8f(0x1dd)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x403d8f(0x19f)},'body':JSON[_0x403d8f(0x1b8)](_0x1cecbd)}),_0x53c7da=Date[_0x403d8f(0x1c2)]()-_0x3301e6;loggerService_1[_0x403d8f(0x142)][_0x403d8f(0x13a)](_0xb3df8[_0x403d8f(0x1ed)],_0x525abd[_0x403d8f(0x1dd)],_0x522721,_0x2fa62e[_0x403d8f(0x168)],_0x53c7da,_0x1cecbd),console[_0x403d8f(0x15b)](_0x403d8f(0x1c3)+_0x525abd['webhookUrl']+_0x403d8f(0x1e3)+_0x2fa62e['status']+'\x20('+_0x53c7da+_0x403d8f(0x1c9));}catch(_0x47b558){console['error'](_0x403d8f(0x194),_0x47b558),loggerService_1['loggerService'][_0x403d8f(0x196)](_0xb3df8[_0x403d8f(0x1ed)],_0xb3df8[_0x403d8f(0x120)]?.[_0x403d8f(0x14f)]?.[_0x403d8f(0x1dd)]||_0x403d8f(0x12c),_0x403d8f(0x188),_0x47b558,{});}}[a42_0x37a556(0xfe)](_0x39ba97){const _0x35a02a=a42_0x37a556,_0xe400fd=_0x39ba97['replace'](/[\s-]/g,'');if(_0xe400fd[_0x35a02a(0x1b6)]<0x4)return'****';return'****\x20****\x20****\x20'+_0xe400fd[_0x35a02a(0x1d5)](-0x4);}async[a42_0x37a556(0x114)](_0x112c5a){const _0x517950=a42_0x37a556;console[_0x517950(0x15b)](_0x517950(0x181),_0x112c5a);let _0x5e9a8f='PENDING';if(_0x112c5a[_0x517950(0x168)]===0x1&&_0x112c5a['final']===0x1)_0x5e9a8f=_0x517950(0x153);else _0x112c5a[_0x517950(0x168)]===0x0&&_0x112c5a['final']===0x0?_0x5e9a8f=_0x517950(0x1ae):_0x5e9a8f=_0x517950(0x163);return{'paymentId':_0x112c5a['order_id']||'','status':_0x5e9a8f,'amount':_0x112c5a[_0x517950(0x1bb)],'currency':_0x112c5a['currency']};}[a42_0x37a556(0x115)](){const _0x32b4f3=a42_0x37a556;console['log'](_0x32b4f3(0x1c6));const _0x27d4dc=this[_0x32b4f3(0x135)]['size'];for(const [_0x4b17ba]of this[_0x32b4f3(0x135)]){this[_0x32b4f3(0x1ba)](_0x4b17ba);}console[_0x32b4f3(0x15b)](_0x32b4f3(0x1f6)+_0x27d4dc+_0x32b4f3(0x1e4));}}exports[a42_0x37a556(0x11c)]=MasterCardService;function a42_0x14b2(){const _0x29509b=['substring','createdAt','45eXWQfA','settings','sendShopWebhook','\x20result:','adminNotes','PAID','🔐\x20RSA\x20signing\x20successful','Webhook\x20event\x20','\x20status\x20timers\x20for\x20payment\x20','\x20\x20\x20-\x20merchant_point_id:','sendPaymentNotification','🔐\x20Response\x20is\x20encrypted,\x20decrypting...','payment','log','forEach','orderId','📊\x20Checking\x20MasterCard\x20payment\x20status:\x20','🔐\x20AES\x20key\x20and\x20IV\x20generated','createCipheriv','📝\x20Data\x20to\x20sign\x20length:','base64','FAILED','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','🔐\x20Private\x20key\x20path:','logWhiteDomainResponse','\x20characters','status','Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','9580452VGxItz','✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)','Unknown\x20error','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','then','existsSync','error','toLowerCase','\x20for\x20payment\x20','last_name','📝\x20Encrypted\x20data\x20length:','generateAESKey','processCardPayment','constants','__createBinding','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key',',\x20Final:\x20','encryptRSA','expire_year','Failed\x20to\x20process\x20MasterCard\x20payment:\x20','227382eJiuZp','Response\x20Body:','final','Processing\x20MasterCard\x20webhook:','2299946vDKnMg','end','🔐\x20Public\x20key\x20path:','json','join','Result\x20URL:','webhook_send','readFileSync','call','/status','📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','aes-256-ctr','/status_raw','8uuygag','toUpperCase','Failed\x20to\x20send\x20payment\x20notifications:','🔐\x203DS\x20verification\x20required','⏰\x20Scheduling\x20status\x20checks\x20for\x20MasterCard\x20payment:\x20','Failed\x20to\x20send\x20MasterCard\x20webhook:',',\x20Desc:\x20','logShopWebhookError','...','cvv','merchantPointId','SHA256','logWhiteDomainRequest','✅\x20Scheduled\x20','prototype','📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','TesSoft\x20Payment\x20System/1.0\x20(MasterCard)','from','../loggerService','validateKeyFiles','🔐\x20AES\x20key\x20length:','get','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','charge','392568QCJobL','===\x20PARSED\x20MASTERCARD\x20RESPONSE\x20===','🧹\x20Clearing\x20','Public\x20key\x20file\x20not\x20found:\x20','POST','10rPVMTB','❌\x20Data\x20being\x20signed:','PENDING','✅\x20Payment\x20','✅\x20Status\x20response\x20decrypted\x20successfully','/charge_decrypted','💾\x20Payment\x20data\x20prepared','3ds_url','MasterCard:\x20','includes','length','paidAt','stringify','HTTP\x20Status:','clearStatusTimers','amount','sign','255770YFIxUI','delete','🔐\x20Data\x20signed\x20with\x20RSA','PHP\x20decryptor\x20error','__esModule','now','MasterCard\x20webhook\x20sent\x20to\x20','HTTP\x20error!\x20status:\x20','publicEncrypt','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','text','https://api.paydmeth.com/api','ms)','checkPaymentStatus','1185828NgyBTa','apiUrl','🔍\x20MasterCard\x20status\x20check\x20#','mastercard','1111','../telegramBotService','number','crypto','resolve','https://api2.trapay.uk/decrypt.php','slice','Failed\x20to\x20decrypt\x20response','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','info','),\x20stopping\x20status\x20checks','path','Return\x20URL:','__importDefault','webhookUrl','privateKeyPath','\x20status\x20updated\x20to\x20','HTTP\x20','none','signRSA','\x20with\x20status\x20','\x20MasterCard\x20status\x20check\x20timers','❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20','Error\x20details:','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','Status:','Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','Card\x20Number:','createDecipheriv','payment.failed','shopId','hasOwnProperty','configurable','date_success','💳\x20MasterCard\x20service\x20initialized','8itmrfE','-----END','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','failed','🛑\x20Stopped\x20','webhookEvents','cwd','publicKeyPath','/status_decrypted','\x20\x20\x20-\x20lang:\x20en','Final:','trim','maskCardNumber','Decryption\x20failed:\x20','../../config/database','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','📤\x20Sending\x20request\x20to\x20MasterCard\x20API...','keys','\x20\x20\x20-\x20info\x20length:','Error\x20parsing\x20webhook\x20events:','default','/status_decrypt','📝\x20Encrypted\x20key\x20length:','decryptAES','utf8','❌\x20Status\x20check\x20#','message','Payment\x20ID:','📊\x20Status\x20check\x20#','📊\x20Status\x20check\x20result:','🔐\x20AES\x20IV\x20length:','__setModuleDefault','RSA_PKCS1_PADDING','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','processWebhook','stopAllStatusChecks','TesSoft\x20Payment\x20System/1.0','🔐\x20Data\x20encrypted\x20with\x20AES','❌\x20PHP\x20decryptor\x20request\x20failed:','/charge_raw','defineProperty','customerName','MasterCardService','key','create','payment.success','shop','description','psp_public.pem','logWhiteDomainError','✅\x20Payment\x20successful','updatePaymentStatus','/charge','system','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','__importStar','\x20not\x20enabled\x20for\x20shop\x20','createSign','unknown','desc','Order\x20ID:','encryptAES','907pJDYEA','decryptResponse','sendPaymentNotifications','first_name','application/json','statusCheckTimers','parse','privateDecrypt','scheduleStatusChecks','findUnique','logShopWebhookSent','payment_id','64CpTKgN','isArray','❌\x20MasterCard\x20key\x20validation\x20failed:','currency','\x20is\x20final\x20(','toString','loggerService','Failed\x20to\x20check\x20MasterCard\x20payment\x20status:\x20','⏰\x20Will\x20check\x20status\x20','set','===\x20MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','📝\x20Signature\x20length:','-----BEGIN','Private\x20key\x20file\x20not\x20found:\x20','customerEmail','update'];a42_0x14b2=function(){return _0x29509b;};return a42_0x14b2();}