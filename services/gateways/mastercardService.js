'use strict';const a46_0x4645ff=a46_0x56be;(function(_0x1c4b29,_0x2311f2){const _0x341c80=a46_0x56be,_0x59558c=_0x1c4b29();while(!![]){try{const _0x3f966d=parseInt(_0x341c80(0x284))/0x1+parseInt(_0x341c80(0x22a))/0x2*(parseInt(_0x341c80(0x2ad))/0x3)+parseInt(_0x341c80(0x238))/0x4*(-parseInt(_0x341c80(0x23f))/0x5)+parseInt(_0x341c80(0x253))/0x6+-parseInt(_0x341c80(0x256))/0x7+-parseInt(_0x341c80(0x286))/0x8+-parseInt(_0x341c80(0x243))/0x9*(-parseInt(_0x341c80(0x2db))/0xa);if(_0x3f966d===_0x2311f2)break;else _0x59558c['push'](_0x59558c['shift']());}catch(_0x1f6175){_0x59558c['push'](_0x59558c['shift']());}}}(a46_0x39fd,0xc3718));function a46_0x39fd(){const _0x218e3d=['get','🔐\x20AES\x20key+IV\x20encrypted\x20with\x20RSA','encryptRSA','\x20\x20\x20-\x20sign\x20length:','❌\x20PHP\x20decryptor\x20request\x20failed:','date_success','validateKeyFiles','slice','getCardTypeAndApi','sendPaymentNotifications','end','delete','../telegramBotService','updatePaymentStatus','⚠️\x20VISA\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','❌\x20Failed\x20to\x20decrypt\x20status\x20response:','\x20result:','❌\x20Payment\x20failed\x20or\x20declined.\x20Status:\x20','sendShopWebhook','currency','📝\x20Webhook\x20data\x20is\x20not\x20encrypted,\x20processing\x20as-is','🔐\x20VISA\x20Private\x20key\x20length:\x20','key','💾\x20Saving\x20failure\x20message:\x20','info','\x20status\x20timers\x20for\x20payment\x20','from','statusCheckTimers','stringify','🔐\x20VISA\x20Private\x20key\x20path:','52986dDCQaA','🔍\x20Using\x20','12540392KJgTxz','now','createSign','\x20(from:\x20status=','status','🛑\x20Stopping\x20all\x20MasterCard\x20status\x20checks...','Decryption\x20failed:\x20','paymentId','size','🔐\x20AES\x20IV\x20length:','visa/mastercard','\x20(from:\x20order_id=','visa_private.pem','readFileSync','logWhiteDomainError','Final:','shopId','shop','keys','SHA256','update','privateDecrypt','\x20payment:\x20','failureMessage','webhookUrl','⚠️\x20VISA\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','createDecipheriv','3ds_url','Failed\x20to\x20send\x20MasterCard\x20webhook:','⚠️\x20Expected\x20VISA\x20private\x20key:\x20','logWhiteDomainRequest','⚠️\x20Falling\x20back\x20to\x20treating\x20data\x20as\x20unencrypted','-----BEGIN','\x20times\x20every\x205\x20minutes\x20for\x202\x20hours','⏰\x20Will\x20check\x20status\x20','\x20status\x20check\x20#','/status_decrypt','configurable','🔍\x20Using\x20fallback\x20fields\x20for\x20search:\x20','67701glgirH','🧹\x20Clearing\x20','Payment\x20ID:','🔐\x20VISA\x20Public\x20key\x20path:','Amount:','forEach','masterCardApiUrl',',\x20body:\x20','publicKeyPath','message','Result\x20URL:','🔐\x20MasterCard\x20Private\x20key\x20path:','log','🔐\x20MasterCard\x20Private\x20key\x20length:\x20',',\x20final=','processCardPayment','/charge','\x20\x20\x20Amount:\x20','VisaMasterCardService',',\x20paymentId=','🔐\x20VISA\x20API\x20URL:','trim','💾\x20Payment\x20data\x20prepared','json','decryptResponsePhp','existsSync','⚠️\x20VISA\x20key\x20files\x20not\x20found\x20-\x20VISA\x20processing\x20will\x20not\x20be\x20available','❌\x20Failed\x20to\x20decrypt\x20response\x20(PHP):','warn','🔄\x20Processing\x20MasterCard\x20webhook\x20data:','Webhook\x20event\x20','getOwnPropertyDescriptor','clearStatusTimers','publicEncrypt','order_id','🔐\x20MasterCard\x20API\x20URL:','then','🔐\x20Webhook\x20data\x20is\x20encrypted,\x20decrypting\x20via\x20PHP...','4000000000000000','📤\x20Sending\x20request\x20to\x20API...','\x20\x20\x20-\x20key\x20length:','toUpperCase','loggerService','📝\x20Final\x20request\x20structure:','orderId','✅\x20RSA\x20encryption\x20successful,\x20encrypted\x20length:','66580COlMYV','processWebhook','RSA_PKCS1_PADDING','MasterCard\x20Private\x20key\x20file\x20not\x20found:\x20','resolve','getOwnPropertyNames','psp_public.pem','set','logShopWebhookSent','/charge_raw','\x20characters','\x20payment\x20status:\x20','Failed\x20to\x20send\x20payment\x20notifications:','paidAt','\x20is\x20final\x20(','toLowerCase','\x20failed\x20for\x20payment\x20','Failed\x20to\x20sign\x20with\x20RSA\x20private\x20key','https://api2.trapay.uk/decrypt.php','signRSA','visaMerchantPointId','❌\x20Data\x20being\x20signed:','constants','\x20status\x20updated\x20to\x20','error','Error\x20parsing\x20webhook\x20events:','1111','../../config/database','/charge_decrypted','Return\x20URL:','/status','📊\x20Status\x20check\x20#','webhook_send','💳\x20VISA/MasterCard\x20service\x20initialized','\x20for\x20payment\x20','system','Response\x20Time:','randomBytes','PENDING',',\x20orderId=','HTTP\x20error!\x20status:\x20','🔐\x20MasterCard\x20Public\x20key\x20length:\x20','payment.failed','paid','visaPrivateKeyPath','parse','\x20webhook\x20extracted\x20data:','💳\x20Unknown\x20card\x20type\x20(starts\x20with\x20','...','final','🔐\x20RSA\x20signing\x20successful','MasterCard\x20Public\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format','🔐\x20AES\x20key\x20length:','✅\x20MasterCard\x20key\x20files\x20validated\x20successfully','\x20\x20\x20Payment\x20ID:\x20','ms)','\x20order_id\x20for\x20search:\x20','🔐\x20Status\x20response\x20is\x20encrypted,\x20decrypting...','failed','includes','📊\x20Checking\x20','\x20\x20\x20-\x20info\x20length:','visaPublicKeyPath','checkPaymentStatus','\x20\x20\x20Status:\x20','encryptAES','⚠️\x20Expected\x20VISA\x20public\x20key:\x20','\x20MasterCard\x20status\x20check\x20timers','===\x20VISA/MASTERCARD\x20PAYMENT\x20PROCESSING\x20===','📝\x20Data\x20length:','logWhiteDomainResponse','charge','),\x20defaulting\x20to\x20MasterCard','🔐\x20RSA\x20encryption\x20-\x20Key\x20structure\x20JSON\x20length:','visa_public.pem','\x20\x20\x20Currency:\x20','🔐\x20Data\x20encrypted\x20with\x20AES','merchantPointId','join','\x20status\x20checks\x20for\x20payment\x20','private.pem','masterCardMerchantPointId','gatewayOrderId',',\x20payment_id=','FAILED','\x20\x20\x20-\x20merchant_point_id:','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','Order\x20ID:','✅\x20Status\x20response\x20decrypted\x20successfully','✅\x20Payment\x20','MasterCard\x20Public\x20key\x20file\x20not\x20found:\x20','customerEmail','prototype','🔐\x20AES\x20key\x20and\x20IV\x20generated','privateKeyPath','MasterCard\x20webhook\x20sent\x20to\x20','toString','__createBinding','first_name','expire_year','apiUrl','description','\x20status\x20check\x20error:','📝\x20Unencrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted','Status\x20decryption\x20failed:\x20','VISA','HTTP\x20Status:','maskCardNumber','__setModuleDefault','Card\x20Holder:','amount','📝\x20Encrypted\x20key\x20length:','/charge_decrypt','card_type','📝\x20Encrypted\x20data\x20length:','Failed\x20to\x20encrypt\x20with\x20RSA\x20public\x20key','===\x20PAYMENT\x20SERVICE\x20ERROR\x20===','MASTERCARD','application/json','unknown','Unknown\x20error','create','__esModule','===\x20API\x20RESPONSE\x20===','https://api.paydmeth.com/api','106KDyysR','payment_id','Status:','none','📝\x20Decrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted','/status_decrypted','Failed\x20to\x20decrypt\x20response\x20via\x20PHP','isArray','cwd','🔍\x20Using\x20provided\x20card\x20type:\x20','defineProperty','🔐\x20VISA\x20Public\x20key\x20length:\x20','length','generateAESKey','8ruhQqI','base64','📝\x20Decrypted\x20webhook\x20data:','sign','Failed\x20to\x20process\x20VISA/MasterCard\x20payment:\x20','\x20payment_id\x20for\x20search:\x20','PAID','3841300bDmLFy','aes-256-ctr','PHP\x20decryptor\x20error','floor','4113BsVWZq','settings','✅\x20Scheduled\x20','5000000000000000','📝\x20Signature\x20length:','****\x20****\x20****\x20','decryptAES','desc','utf8','/status_raw','-----END','stopAllStatusChecks','writable','🔐\x20Using\x20keys:\x20','sendPaymentNotification','❌\x20RSA\x20signing\x20failed:','5958894alzQRs','findUnique','text','9662009ZYlpSm','Failed\x20to\x20check\x20','adminNotes','🔐\x20MasterCard\x20Public\x20key\x20path:','expire_month','🔍\x20Detected\x20card\x20type\x20from\x20webhook:\x20','cardType','scheduleStatusChecks','cvv','webhookEvents','number','VISA/MasterCard','visaApiUrl','default','../loggerService','POST'];a46_0x39fd=function(){return _0x218e3d;};return a46_0x39fd();}function a46_0x56be(_0x38b6ca,_0x3e3cdb){const _0x39fdba=a46_0x39fd();return a46_0x56be=function(_0x56be89,_0x49b357){_0x56be89=_0x56be89-0x1e1;let _0x58e4ff=_0x39fdba[_0x56be89];return _0x58e4ff;},a46_0x56be(_0x38b6ca,_0x3e3cdb);}var __createBinding=this&&this[a46_0x4645ff(0x20e)]||(Object['create']?function(_0x1f4670,_0x14d107,_0x3adc3d,_0x1a5d6f){const _0xb5d1f0=a46_0x4645ff;if(_0x1a5d6f===undefined)_0x1a5d6f=_0x3adc3d;var _0x2edcc7=Object[_0xb5d1f0(0x2cc)](_0x14d107,_0x3adc3d);(!_0x2edcc7||(_0xb5d1f0(0x266)in _0x2edcc7?!_0x14d107[_0xb5d1f0(0x227)]:_0x2edcc7[_0xb5d1f0(0x24f)]||_0x2edcc7[_0xb5d1f0(0x2ab)]))&&(_0x2edcc7={'enumerable':!![],'get':function(){return _0x14d107[_0x3adc3d];}}),Object[_0xb5d1f0(0x234)](_0x1f4670,_0x1a5d6f,_0x2edcc7);}:function(_0x547672,_0x495a19,_0x4fe55e,_0x37c604){if(_0x37c604===undefined)_0x37c604=_0x4fe55e;_0x547672[_0x37c604]=_0x495a19[_0x4fe55e];}),__setModuleDefault=this&&this[a46_0x4645ff(0x219)]||(Object[a46_0x4645ff(0x226)]?function(_0x4462e1,_0xa70a01){const _0x97bba8=a46_0x4645ff;Object[_0x97bba8(0x234)](_0x4462e1,_0x97bba8(0x263),{'enumerable':!![],'value':_0xa70a01});}:function(_0x44dc35,_0x33fe80){const _0xfb3635=a46_0x4645ff;_0x44dc35[_0xfb3635(0x263)]=_0x33fe80;}),__importStar=this&&this['__importStar']||(function(){var _0x39a517=function(_0x33d6ee){const _0x50c06b=a46_0x56be;return _0x39a517=Object[_0x50c06b(0x2e0)]||function(_0xa76d90){const _0x43a946=_0x50c06b;var _0x8b70d1=[];for(var _0x3fe782 in _0xa76d90)if(Object[_0x43a946(0x209)]['hasOwnProperty']['call'](_0xa76d90,_0x3fe782))_0x8b70d1[_0x8b70d1[_0x43a946(0x236)]]=_0x3fe782;return _0x8b70d1;},_0x39a517(_0x33d6ee);};return function(_0x3ca3f8){const _0x273315=a46_0x56be;if(_0x3ca3f8&&_0x3ca3f8[_0x273315(0x227)])return _0x3ca3f8;var _0x5aaa0f={};if(_0x3ca3f8!=null){for(var _0x34a8a9=_0x39a517(_0x3ca3f8),_0x4ae26f=0x0;_0x4ae26f<_0x34a8a9['length'];_0x4ae26f++)if(_0x34a8a9[_0x4ae26f]!=='default')__createBinding(_0x5aaa0f,_0x3ca3f8,_0x34a8a9[_0x4ae26f]);}return __setModuleDefault(_0x5aaa0f,_0x3ca3f8),_0x5aaa0f;};}()),__importDefault=this&&this['__importDefault']||function(_0x10cbd1){const _0x7bbbe2=a46_0x4645ff;return _0x10cbd1&&_0x10cbd1[_0x7bbbe2(0x227)]?_0x10cbd1:{'default':_0x10cbd1};};Object[a46_0x4645ff(0x234)](exports,a46_0x4645ff(0x227),{'value':!![]}),exports[a46_0x4645ff(0x2bf)]=void 0x0;const crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),loggerService_1=require(a46_0x4645ff(0x264));class VisaMasterCardService{constructor(){const _0x5b0dec=a46_0x4645ff;this[_0x5b0dec(0x281)]=new Map(),this[_0x5b0dec(0x2b3)]=_0x5b0dec(0x229),this[_0x5b0dec(0x1fe)]=0x6a7,this[_0x5b0dec(0x20b)]=path_1[_0x5b0dec(0x263)][_0x5b0dec(0x1fb)](process['cwd'](),_0x5b0dec(0x298),_0x5b0dec(0x1fd)),this[_0x5b0dec(0x2b5)]=path_1[_0x5b0dec(0x263)][_0x5b0dec(0x1fb)](process[_0x5b0dec(0x232)](),'keys',_0x5b0dec(0x2e1)),this[_0x5b0dec(0x262)]=_0x5b0dec(0x229),this[_0x5b0dec(0x2ef)]=0x6b7,this['visaPrivateKeyPath']=path_1[_0x5b0dec(0x263)][_0x5b0dec(0x1fb)](process['cwd'](),_0x5b0dec(0x298),_0x5b0dec(0x292)),this['visaPublicKeyPath']=path_1['default']['join'](process[_0x5b0dec(0x232)](),'keys',_0x5b0dec(0x1f7)),console[_0x5b0dec(0x2b9)](_0x5b0dec(0x2fc)),console[_0x5b0dec(0x2b9)](_0x5b0dec(0x2d0),this[_0x5b0dec(0x2b3)]),console[_0x5b0dec(0x2b9)](_0x5b0dec(0x2c1),this['visaApiUrl']),console[_0x5b0dec(0x2b9)](_0x5b0dec(0x2b8),this[_0x5b0dec(0x20b)]),console['log'](_0x5b0dec(0x259),this[_0x5b0dec(0x2b5)]),console[_0x5b0dec(0x2b9)](_0x5b0dec(0x283),this[_0x5b0dec(0x307)]),console[_0x5b0dec(0x2b9)](_0x5b0dec(0x2b0),this[_0x5b0dec(0x1eb)]),this[_0x5b0dec(0x26c)]();}[a46_0x4645ff(0x26e)](_0x43acfb){const _0x47808b=a46_0x4645ff,_0x569411=_0x43acfb['charAt'](0x0);if(_0x569411==='4')return console[_0x47808b(0x2b9)]('💳\x20Detected\x20VISA\x20card\x20(starts\x20with\x204)'),{'cardType':'VISA','apiUrl':this[_0x47808b(0x262)],'privateKeyPath':this[_0x47808b(0x307)],'publicKeyPath':this[_0x47808b(0x1eb)],'merchantPointId':this[_0x47808b(0x2ef)]};else return _0x569411==='5'?(console['log']('💳\x20Detected\x20MasterCard\x20(starts\x20with\x205)'),{'cardType':_0x47808b(0x222),'apiUrl':this['masterCardApiUrl'],'privateKeyPath':this[_0x47808b(0x20b)],'publicKeyPath':this['publicKeyPath'],'merchantPointId':this['masterCardMerchantPointId']}):(console[_0x47808b(0x2b9)](_0x47808b(0x30a)+_0x569411+_0x47808b(0x1f5)),{'cardType':'MASTERCARD','apiUrl':this[_0x47808b(0x2b3)],'privateKeyPath':this[_0x47808b(0x20b)],'publicKeyPath':this[_0x47808b(0x2b5)],'merchantPointId':this[_0x47808b(0x1fe)]});}[a46_0x4645ff(0x26c)](){const _0x35cddc=a46_0x4645ff;try{if(!fs_1[_0x35cddc(0x263)][_0x35cddc(0x2c6)](this[_0x35cddc(0x20b)]))throw new Error(_0x35cddc(0x2de)+this[_0x35cddc(0x20b)]);if(!fs_1[_0x35cddc(0x263)][_0x35cddc(0x2c6)](this[_0x35cddc(0x2b5)]))throw new Error(_0x35cddc(0x207)+this[_0x35cddc(0x2b5)]);const _0x369433=fs_1['default']['readFileSync'](this[_0x35cddc(0x20b)],_0x35cddc(0x24b))[_0x35cddc(0x2c2)](),_0x32e79f=fs_1['default'][_0x35cddc(0x293)](this['publicKeyPath'],_0x35cddc(0x24b))[_0x35cddc(0x2c2)]();if(!_0x369433[_0x35cddc(0x1e8)]('-----BEGIN')||!_0x369433['includes']('-----END'))throw new Error('MasterCard\x20Private\x20key\x20file\x20does\x20not\x20appear\x20to\x20be\x20in\x20PEM\x20format');if(!_0x32e79f[_0x35cddc(0x1e8)]('-----BEGIN')||!_0x32e79f['includes']('-----END'))throw new Error(_0x35cddc(0x30e));console[_0x35cddc(0x2b9)](_0x35cddc(0x1e2)),console['log'](_0x35cddc(0x2ba)+_0x369433['length']+_0x35cddc(0x2e5)),console[_0x35cddc(0x2b9)](_0x35cddc(0x304)+_0x32e79f[_0x35cddc(0x236)]+'\x20characters');if(fs_1[_0x35cddc(0x263)][_0x35cddc(0x2c6)](this[_0x35cddc(0x307)])&&fs_1[_0x35cddc(0x263)][_0x35cddc(0x2c6)](this[_0x35cddc(0x1eb)])){const _0xc27901=fs_1[_0x35cddc(0x263)][_0x35cddc(0x293)](this[_0x35cddc(0x307)],_0x35cddc(0x24b))[_0x35cddc(0x2c2)](),_0x5d489d=fs_1[_0x35cddc(0x263)][_0x35cddc(0x293)](this['visaPublicKeyPath'],'utf8')[_0x35cddc(0x2c2)]();(!_0xc27901[_0x35cddc(0x1e8)](_0x35cddc(0x2a6))||!_0xc27901[_0x35cddc(0x1e8)](_0x35cddc(0x24d)))&&console[_0x35cddc(0x2c9)](_0x35cddc(0x29f)),(!_0x5d489d[_0x35cddc(0x1e8)](_0x35cddc(0x2a6))||!_0x5d489d[_0x35cddc(0x1e8)](_0x35cddc(0x24d)))&&console[_0x35cddc(0x2c9)](_0x35cddc(0x274)),console[_0x35cddc(0x2b9)]('✅\x20VISA\x20key\x20files\x20validated\x20successfully'),console[_0x35cddc(0x2b9)](_0x35cddc(0x27b)+_0xc27901[_0x35cddc(0x236)]+_0x35cddc(0x2e5)),console[_0x35cddc(0x2b9)](_0x35cddc(0x235)+_0x5d489d[_0x35cddc(0x236)]+_0x35cddc(0x2e5));}else console[_0x35cddc(0x2c9)](_0x35cddc(0x2c7)),console[_0x35cddc(0x2c9)](_0x35cddc(0x2a3)+this[_0x35cddc(0x307)]),console[_0x35cddc(0x2c9)](_0x35cddc(0x1ef)+this[_0x35cddc(0x1eb)]);}catch(_0x4e290f){console['error']('❌\x20VISA/MasterCard\x20key\x20validation\x20failed:',_0x4e290f);throw _0x4e290f;}}[a46_0x4645ff(0x237)](){const _0x4a2ee8=a46_0x4645ff,_0x591453=crypto_1[_0x4a2ee8(0x263)]['randomBytes'](0x20),_0x5c79c0=crypto_1['default'][_0x4a2ee8(0x300)](0x10);return{'key':_0x591453,'iv':_0x5c79c0};}[a46_0x4645ff(0x1ee)](_0x2c5f64,_0x3f19f0,_0xe1a4f7){const _0x97517c=a46_0x4645ff,_0x3bb5a6=crypto_1['default']['createCipheriv'](_0x97517c(0x240),_0x3f19f0,_0xe1a4f7);let _0x1a156b=_0x3bb5a6[_0x97517c(0x29a)](_0x2c5f64,'utf8',_0x97517c(0x239));return _0x1a156b+=_0x3bb5a6[_0x97517c(0x30c)](_0x97517c(0x239)),_0x1a156b;}[a46_0x4645ff(0x268)](_0x3ffaa1,_0x1e792d,_0x3cc452){const _0x231ac2=a46_0x4645ff;try{const _0xd9d851=fs_1[_0x231ac2(0x263)][_0x231ac2(0x293)](_0x3cc452,_0x231ac2(0x24b))[_0x231ac2(0x2c2)](),_0x20fc08={'iv':_0x1e792d['toString']('base64'),'key':_0x3ffaa1[_0x231ac2(0x20d)](_0x231ac2(0x239))},_0x40b1dc=JSON[_0x231ac2(0x282)](_0x20fc08);console['log'](_0x231ac2(0x1f6),_0x40b1dc[_0x231ac2(0x236)]);const _0x41e706=crypto_1[_0x231ac2(0x263)][_0x231ac2(0x2ce)]({'key':_0xd9d851,'padding':crypto_1['default'][_0x231ac2(0x2f1)][_0x231ac2(0x2dd)]},Buffer[_0x231ac2(0x280)](_0x40b1dc));return console['log'](_0x231ac2(0x2da),_0x41e706[_0x231ac2(0x236)]),_0x41e706[_0x231ac2(0x20d)](_0x231ac2(0x239));}catch(_0xc50051){console[_0x231ac2(0x2f3)]('❌\x20RSA\x20encryption\x20failed:',_0xc50051);throw new Error(_0x231ac2(0x220));}}['signRSA'](_0x585395,_0x3f4ef1){const _0xd9aeb8=a46_0x4645ff;try{const _0x50dfa1=fs_1[_0xd9aeb8(0x263)][_0xd9aeb8(0x293)](_0x3f4ef1,'utf8')['trim'](),_0x107c05=crypto_1[_0xd9aeb8(0x263)][_0xd9aeb8(0x288)](_0xd9aeb8(0x299));_0x107c05[_0xd9aeb8(0x29a)](_0x585395),_0x107c05[_0xd9aeb8(0x270)]();const _0x59de3a=_0x107c05[_0xd9aeb8(0x23b)](_0x50dfa1,_0xd9aeb8(0x239));return console[_0xd9aeb8(0x2b9)](_0xd9aeb8(0x30d)),console[_0xd9aeb8(0x2b9)]('📝\x20Data\x20to\x20sign\x20length:',_0x585395[_0xd9aeb8(0x236)]),console[_0xd9aeb8(0x2b9)](_0xd9aeb8(0x247),_0x59de3a['length']),_0x59de3a;}catch(_0x3545a6){console[_0xd9aeb8(0x2f3)](_0xd9aeb8(0x252),_0x3545a6),console[_0xd9aeb8(0x2f3)](_0xd9aeb8(0x2f0),_0x585395['substring'](0x0,0xc8)+_0xd9aeb8(0x30b));throw new Error(_0xd9aeb8(0x2ec));}}[a46_0x4645ff(0x249)](_0x2ea143,_0x1ef100,_0x237b18){const _0xb79734=a46_0x4645ff,_0x56e402=crypto_1[_0xb79734(0x263)][_0xb79734(0x2a0)]('aes-256-ctr',_0x1ef100,_0x237b18);let _0x15a9b6=_0x56e402[_0xb79734(0x29a)](_0x2ea143,_0xb79734(0x239),_0xb79734(0x24b));return _0x15a9b6+=_0x56e402['final']('utf8'),_0x15a9b6;}async[a46_0x4645ff(0x2c5)](_0x159592,_0x26ba51,_0x4a6f0f=a46_0x4645ff(0x222)){const _0xd20510=a46_0x4645ff;try{const _0x177578=await fetch(_0xd20510(0x2ed),{'method':'POST','headers':{'Content-Type':'application/json'},'body':JSON[_0xd20510(0x282)]({'info':_0x159592,'key':_0x26ba51,'card_type':_0x4a6f0f[_0xd20510(0x2ea)]()})});if(!_0x177578['ok'])throw new Error(_0xd20510(0x241));return await _0x177578[_0xd20510(0x255)]();}catch(_0x36aff4){console['error'](_0xd20510(0x26a),_0x36aff4);throw new Error(_0xd20510(0x230));}}['decryptResponse'](_0x1d3174,_0x52501a){const _0xcab30e=a46_0x4645ff;try{const _0x36e2ca=fs_1['default'][_0xcab30e(0x293)](this[_0xcab30e(0x20b)],_0xcab30e(0x24b))['trim'](),_0x268c83=crypto_1[_0xcab30e(0x263)][_0xcab30e(0x29b)](_0x36e2ca,Buffer[_0xcab30e(0x280)](_0x52501a,_0xcab30e(0x239))),_0x2cb153=JSON[_0xcab30e(0x308)](_0x268c83['toString']()),_0x30b31e=Buffer[_0xcab30e(0x280)](_0x2cb153[_0xcab30e(0x27c)],_0xcab30e(0x239)),_0x140bbe=Buffer[_0xcab30e(0x280)](_0x2cb153['iv'],'base64');return this['decryptAES'](_0x1d3174,_0x30b31e,_0x140bbe);}catch(_0x264a3f){throw new Error('Failed\x20to\x20decrypt\x20response');}}async[a46_0x4645ff(0x2bc)](_0x2bd5ce){const _0x1087a2=a46_0x4645ff,{paymentId:_0x59cc23,orderId:_0x4ba978,amount:_0x25f321,currency:_0x28762f,cardData:_0x521911,resultUrl:_0x23d317,returnUrl:_0x1bd33f,cardHolder:_0x24f10a,browser:_0x444437}=_0x2bd5ce;console[_0x1087a2(0x2b9)](_0x1087a2(0x1f1)),console[_0x1087a2(0x2b9)](_0x1087a2(0x2af),_0x59cc23),console[_0x1087a2(0x2b9)](_0x1087a2(0x204),_0x4ba978),console[_0x1087a2(0x2b9)](_0x1087a2(0x2b1),_0x25f321,_0x28762f),console[_0x1087a2(0x2b9)]('Card\x20Number:',this[_0x1087a2(0x218)](_0x521911['number'])),console[_0x1087a2(0x2b9)](_0x1087a2(0x21a),_0x24f10a[_0x1087a2(0x20f)]+'\x20'+_0x24f10a['last_name']),console[_0x1087a2(0x2b9)](_0x1087a2(0x2f8),_0x1bd33f),console[_0x1087a2(0x2b9)](_0x1087a2(0x2b7),_0x23d317);const _0x228362=this[_0x1087a2(0x26e)](_0x521911[_0x1087a2(0x260)]);console['log']('🎯\x20Using\x20'+_0x228362[_0x1087a2(0x25c)]+'\x20API:\x20'+_0x228362[_0x1087a2(0x211)]),console[_0x1087a2(0x2b9)](_0x1087a2(0x250)+_0x228362[_0x1087a2(0x20b)]+',\x20'+_0x228362[_0x1087a2(0x2b5)]);const _0x2d4d49={'amount':_0x25f321,'currency':_0x28762f[_0x1087a2(0x2d6)](),'order_id':_0x4ba978,'result_url':_0x23d317,'return_url':_0x1bd33f,'country':'','card':{'number':_0x521911[_0x1087a2(0x260)],'expire_month':_0x521911[_0x1087a2(0x25a)],'expire_year':_0x521911[_0x1087a2(0x210)],'cvv':_0x521911[_0x1087a2(0x25e)]},'card_holder':_0x24f10a,'browser':_0x444437},_0x430c7f=JSON[_0x1087a2(0x282)](_0x2d4d49);console[_0x1087a2(0x2b9)](_0x1087a2(0x2c3)),console['log']('📝\x20Data\x20to\x20be\x20signed\x20and\x20encrypted:'),console[_0x1087a2(0x2b9)](_0x430c7f),console[_0x1087a2(0x2b9)](_0x1087a2(0x1f2),_0x430c7f['length']);try{const {key:_0x47862f,iv:_0x9a38c1}=this[_0x1087a2(0x237)]();console[_0x1087a2(0x2b9)](_0x1087a2(0x20a)),console[_0x1087a2(0x2b9)](_0x1087a2(0x1e1),_0x47862f['length']),console[_0x1087a2(0x2b9)](_0x1087a2(0x28f),_0x9a38c1[_0x1087a2(0x236)]);const _0x1fffdd=this[_0x1087a2(0x1ee)](_0x430c7f,_0x47862f,_0x9a38c1);console['log'](_0x1087a2(0x1f9)),console[_0x1087a2(0x2b9)](_0x1087a2(0x21f),_0x1fffdd[_0x1087a2(0x236)]);const _0x3cfad0=this['encryptRSA'](_0x47862f,_0x9a38c1,_0x228362[_0x1087a2(0x2b5)]);console['log'](_0x1087a2(0x267)),console[_0x1087a2(0x2b9)](_0x1087a2(0x21c),_0x3cfad0[_0x1087a2(0x236)]);const _0x71d155=this[_0x1087a2(0x2ee)](_0x430c7f,_0x228362[_0x1087a2(0x20b)]);console[_0x1087a2(0x2b9)]('🔐\x20Data\x20signed\x20with\x20RSA'),console[_0x1087a2(0x2b9)](_0x1087a2(0x247),_0x71d155[_0x1087a2(0x236)]);const _0x5d4ff3={'merchant_point_id':_0x228362[_0x1087a2(0x1fa)],'method':_0x1087a2(0x1f4),'info':_0x1fffdd,'key':_0x3cfad0,'sign':_0x71d155,'lang':'en'};console['log'](_0x1087a2(0x2d4)),console['log'](_0x1087a2(0x2d8)),console[_0x1087a2(0x2b9)](_0x1087a2(0x202),_0x228362[_0x1087a2(0x1fa)]),console['log']('\x20\x20\x20-\x20method:\x20charge'),console['log'](_0x1087a2(0x1ea),_0x1fffdd[_0x1087a2(0x236)]),console[_0x1087a2(0x2b9)](_0x1087a2(0x2d5),_0x3cfad0[_0x1087a2(0x236)]),console[_0x1087a2(0x2b9)](_0x1087a2(0x269),_0x71d155[_0x1087a2(0x236)]),console['log']('\x20\x20\x20-\x20lang:\x20en'),loggerService_1[_0x1087a2(0x2d7)]['logWhiteDomainRequest'](_0x228362[_0x1087a2(0x25c)]['toLowerCase'](),_0x1087a2(0x2bd),'POST',{'merchant_point_id':_0x228362[_0x1087a2(0x1fa)],'method':_0x1087a2(0x1f4),'lang':'en'});const _0x35a76a=Date[_0x1087a2(0x287)](),_0x43bf13=await fetch(_0x228362[_0x1087a2(0x211)],{'method':'POST','headers':{'Content-Type':_0x1087a2(0x223),'Accept':_0x1087a2(0x223),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1087a2(0x282)](_0x5d4ff3)}),_0x2ac47c=Date[_0x1087a2(0x287)]()-_0x35a76a;console[_0x1087a2(0x2b9)](_0x1087a2(0x228)),console[_0x1087a2(0x2b9)](_0x1087a2(0x22c),_0x43bf13[_0x1087a2(0x28a)]),console['log'](_0x1087a2(0x2ff),_0x2ac47c+'ms');if(!_0x43bf13['ok']){const _0x56b91e=await _0x43bf13[_0x1087a2(0x255)]();console[_0x1087a2(0x2f3)](_0x1087a2(0x217),_0x43bf13[_0x1087a2(0x28a)]),console['error']('Response\x20Body:',_0x56b91e),loggerService_1[_0x1087a2(0x2d7)][_0x1087a2(0x1f3)](_0x228362[_0x1087a2(0x25c)][_0x1087a2(0x2ea)](),_0x1087a2(0x2e4),_0x43bf13[_0x1087a2(0x28a)],_0x56b91e,_0x2ac47c),loggerService_1[_0x1087a2(0x2d7)][_0x1087a2(0x294)](_0x228362[_0x1087a2(0x25c)][_0x1087a2(0x2ea)](),'/charge','HTTP\x20'+_0x43bf13['status']+':\x20'+_0x56b91e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x43bf13[_0x1087a2(0x28a)]+_0x1087a2(0x2b4)+_0x56b91e);}const _0x5d5303=await _0x43bf13['json']();loggerService_1[_0x1087a2(0x2d7)][_0x1087a2(0x1f3)](_0x228362[_0x1087a2(0x25c)]['toLowerCase'](),_0x1087a2(0x2e4),_0x43bf13[_0x1087a2(0x28a)],_0x5d5303,_0x2ac47c),console[_0x1087a2(0x2b9)]('===\x20PARSED\x20API\x20RESPONSE\x20===');let _0xe27a48=_0x5d5303;if(_0x5d5303[_0x1087a2(0x27e)]&&_0x5d5303['key']&&_0x5d5303['sign']){console[_0x1087a2(0x2b9)]('🔐\x20Response\x20is\x20encrypted,\x20decrypting...');try{const _0x2e78c7=await this['decryptResponsePhp'](_0x5d5303[_0x1087a2(0x27e)],_0x5d5303['key'],_0x228362[_0x1087a2(0x25c)]);_0xe27a48=JSON['parse'](_0x2e78c7),console[_0x1087a2(0x2b9)]('✅\x20Response\x20decrypted\x20successfully\x20(via\x20PHP)'),loggerService_1[_0x1087a2(0x2d7)][_0x1087a2(0x1f3)](_0x228362[_0x1087a2(0x25c)][_0x1087a2(0x2ea)](),_0x1087a2(0x2f7),_0x43bf13[_0x1087a2(0x28a)],_0xe27a48,_0x2ac47c),console['log'](_0x1087a2(0x22e));}catch(_0x31015a){console['error'](_0x1087a2(0x2c8),_0x31015a),loggerService_1[_0x1087a2(0x2d7)][_0x1087a2(0x294)](_0x228362[_0x1087a2(0x25c)][_0x1087a2(0x2ea)](),_0x1087a2(0x21d),_0x1087a2(0x28c)+_0x31015a),_0xe27a48=_0x5d5303;}}else loggerService_1['loggerService']['logWhiteDomainResponse'](_0x228362['cardType']['toLowerCase'](),_0x1087a2(0x2f7),_0x43bf13[_0x1087a2(0x28a)],_0xe27a48,_0x2ac47c),console[_0x1087a2(0x2b9)]('📝\x20Unencrypted\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/charge_decrypted');console['log'](_0x1087a2(0x22c),_0xe27a48[_0x1087a2(0x28a)]),console[_0x1087a2(0x2b9)](_0x1087a2(0x295),_0xe27a48[_0x1087a2(0x30c)]),console[_0x1087a2(0x2b9)](_0x1087a2(0x2af),_0xe27a48[_0x1087a2(0x22b)]),console[_0x1087a2(0x2b9)]('3DS\x20URL:',_0xe27a48['3ds_url']||_0x1087a2(0x22d));if(_0xe27a48['status']===0x64&&_0xe27a48[_0x1087a2(0x30c)]===0x1)return console[_0x1087a2(0x2b9)]('✅\x20Payment\x20successful'),{'gateway_payment_id':_0xe27a48[_0x1087a2(0x22b)]?.[_0x1087a2(0x20d)](),'payment_url':_0x1bd33f,'requires_3ds':![],'status':_0x1087a2(0x23e),'final':!![]};if(_0xe27a48['3ds_url'])return console['log']('🔐\x203DS\x20verification\x20required'),this[_0x1087a2(0x25d)](_0x59cc23,_0x4ba978,_0xe27a48[_0x1087a2(0x22b)]?.['toString']()||_0x4ba978,_0x228362['cardType']),{'gateway_payment_id':_0xe27a48[_0x1087a2(0x22b)]?.['toString'](),'payment_url':_0xe27a48[_0x1087a2(0x2a1)],'requires_3ds':!![],'threeds_url':_0xe27a48[_0x1087a2(0x2a1)],'status':_0x1087a2(0x301),'final':![]};let _0x37105c=_0xe27a48[_0x1087a2(0x24a)]||_0xe27a48[_0x1087a2(0x2b6)]||_0x1087a2(0x225),_0x297a7a=_0xe27a48[_0x1087a2(0x28a)],_0x1e9109=_0xe27a48['final'];return console['log'](_0x1087a2(0x277)+_0x297a7a+',\x20Final:\x20'+_0x1e9109+',\x20Desc:\x20'+_0x37105c),{'gateway_payment_id':_0xe27a48[_0x1087a2(0x22b)]?.['toString'](),'payment_url':_0x1bd33f,'requires_3ds':![],'status':_0x1087a2(0x201),'final':!![]};}catch(_0x275220){console[_0x1087a2(0x2f3)](_0x1087a2(0x221)),console['error']('Error\x20details:',_0x275220),loggerService_1['loggerService']['logWhiteDomainError'](_0x1087a2(0x290),'/charge',_0x275220);throw new Error(_0x1087a2(0x23c)+(_0x275220 instanceof Error?_0x275220['message']:_0x1087a2(0x225)));}}async[a46_0x4645ff(0x1ec)](_0xc9cde2,_0x28f5b3,_0x1af289='VISA'){const _0x569b64=a46_0x4645ff;console[_0x569b64(0x2b9)](_0x569b64(0x1e9)+_0x1af289+_0x569b64(0x2e6)+_0xc9cde2+'\x20('+_0x28f5b3+')');try{const _0x5c273b={'payment_id':_0xc9cde2,'order_id':_0x28f5b3},_0x24518f=JSON[_0x569b64(0x282)](_0x5c273b),_0x5f5119=this[_0x569b64(0x26e)](_0x1af289==='VISA'?_0x569b64(0x2d3):_0x569b64(0x246)),{key:_0x135ec4,iv:_0x277bf9}=this['generateAESKey'](),_0x5d7b0c=this[_0x569b64(0x1ee)](_0x24518f,_0x135ec4,_0x277bf9),_0x54e4eb=this['encryptRSA'](_0x135ec4,_0x277bf9,_0x5f5119[_0x569b64(0x2b5)]),_0x22f717=this['signRSA'](_0x24518f,_0x5f5119['privateKeyPath']),_0x465157={'merchant_point_id':_0x5f5119[_0x569b64(0x1fa)],'method':_0x569b64(0x28a),'info':_0x5d7b0c,'key':_0x54e4eb,'sign':_0x22f717,'lang':'en'};loggerService_1[_0x569b64(0x2d7)][_0x569b64(0x2a4)](_0x1af289[_0x569b64(0x2ea)](),_0x569b64(0x2f9),_0x569b64(0x265),{'merchant_point_id':_0x5f5119['merchantPointId'],'method':_0x569b64(0x28a),'lang':'en'});const _0x1e7817=Date[_0x569b64(0x287)](),_0x2d1338=await fetch(_0x5f5119[_0x569b64(0x211)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x569b64(0x223),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x569b64(0x282)](_0x465157)}),_0x41a94f=Date[_0x569b64(0x287)]()-_0x1e7817;if(!_0x2d1338['ok']){const _0x19f0bd=await _0x2d1338[_0x569b64(0x255)]();loggerService_1[_0x569b64(0x2d7)][_0x569b64(0x1f3)](_0x1af289[_0x569b64(0x2ea)](),_0x569b64(0x24c),_0x2d1338[_0x569b64(0x28a)],_0x19f0bd,_0x41a94f);throw new Error(_0x569b64(0x303)+_0x2d1338['status']);}const _0x3e6932=await _0x2d1338[_0x569b64(0x2c4)]();loggerService_1[_0x569b64(0x2d7)][_0x569b64(0x1f3)](_0x1af289[_0x569b64(0x2ea)](),'/status_raw',_0x2d1338[_0x569b64(0x28a)],_0x3e6932,_0x41a94f);let _0x36d2a8=_0x3e6932;if(_0x3e6932[_0x569b64(0x27e)]&&_0x3e6932[_0x569b64(0x27c)]&&_0x3e6932[_0x569b64(0x23b)]){console[_0x569b64(0x2b9)](_0x569b64(0x1e6));try{const _0x4857c3=await this[_0x569b64(0x2c5)](_0x3e6932[_0x569b64(0x27e)],_0x3e6932['key'],_0x1af289);_0x36d2a8=JSON['parse'](_0x4857c3),console[_0x569b64(0x2b9)](_0x569b64(0x205)),loggerService_1[_0x569b64(0x2d7)][_0x569b64(0x1f3)](_0x1af289[_0x569b64(0x2ea)](),_0x569b64(0x22f),_0x2d1338['status'],_0x36d2a8,_0x41a94f),console[_0x569b64(0x2b9)]('📝\x20Decrypted\x20status\x20response\x20logged\x20to\x20white_domain_responses\x20with\x20endpoint:\x20/status_decrypted');}catch(_0x1d7e32){console[_0x569b64(0x2f3)](_0x569b64(0x275),_0x1d7e32),loggerService_1['loggerService'][_0x569b64(0x294)](_0x1af289[_0x569b64(0x2ea)](),_0x569b64(0x2aa),_0x569b64(0x215)+_0x1d7e32),_0x36d2a8=_0x3e6932;}}else loggerService_1[_0x569b64(0x2d7)]['logWhiteDomainResponse'](_0x1af289['toLowerCase'](),'/status_decrypted',_0x2d1338['status'],_0x36d2a8,_0x41a94f),console['log'](_0x569b64(0x214));console[_0x569b64(0x2b9)]('📊\x20Status\x20check\x20result:',{'status':_0x36d2a8[_0x569b64(0x28a)],'final':_0x36d2a8[_0x569b64(0x30c)],'payment_id':_0x36d2a8[_0x569b64(0x22b)],'desc':_0x36d2a8['desc']});let _0x5f0f65=_0x569b64(0x301);if(_0x36d2a8[_0x569b64(0x28a)]===0x64&&_0x36d2a8[_0x569b64(0x30c)]===0x1)_0x5f0f65=_0x569b64(0x23e);else{if(_0x36d2a8['final']===0x0)_0x5f0f65=_0x569b64(0x301);else _0x36d2a8[_0x569b64(0x30c)]===0x1&&_0x36d2a8[_0x569b64(0x28a)]!==0x64?_0x5f0f65='FAILED':_0x5f0f65='PENDING';}return{'status':_0x5f0f65,'final':_0x36d2a8[_0x569b64(0x30c)]===0x1,'amount':_0x36d2a8[_0x569b64(0x21b)],'currency':_0x36d2a8['currency'],'date_success':_0x36d2a8[_0x569b64(0x26b)],'description':_0x36d2a8['desc']};}catch(_0x505b15){console[_0x569b64(0x2f3)](_0x1af289+_0x569b64(0x213),_0x505b15),loggerService_1[_0x569b64(0x2d7)][_0x569b64(0x294)](_0x1af289['toLowerCase'](),_0x569b64(0x2f9),_0x505b15);throw new Error(_0x569b64(0x257)+_0x1af289+_0x569b64(0x2e6)+(_0x505b15 instanceof Error?_0x505b15['message']:_0x569b64(0x225)));}}[a46_0x4645ff(0x25d)](_0x2c3843,_0x590b03,_0x4d6e14,_0x4b8957){const _0x455dd4=a46_0x4645ff;console[_0x455dd4(0x2b9)]('⏰\x20Scheduling\x20status\x20checks\x20for\x20'+_0x4b8957+_0x455dd4(0x29c)+_0x2c3843+'\x20('+_0x4d6e14+')'),this[_0x455dd4(0x2cd)](_0x2c3843);const _0x1f430a=[],_0x185a61=0x5*0x3c*0x3e8,_0x10a930=0x2*0x3c*0x3c*0x3e8,_0x8e2117=Math[_0x455dd4(0x242)](_0x10a930/_0x185a61);console[_0x455dd4(0x2b9)](_0x455dd4(0x2a8)+_0x8e2117+_0x455dd4(0x2a7));for(let _0x512796=0x1;_0x512796<=_0x8e2117;_0x512796++){const _0x4775fb=setTimeout(async()=>{const _0x4b0e82=_0x455dd4;console[_0x4b0e82(0x2b9)]('🔍\x20'+_0x4b8957+_0x4b0e82(0x2a9)+_0x512796+'/'+_0x8e2117+_0x4b0e82(0x2fd)+_0x2c3843);try{const _0x3d9b7a=await this[_0x4b0e82(0x1ec)](_0x4d6e14,_0x590b03,_0x4b8957);console[_0x4b0e82(0x2b9)](_0x4b0e82(0x2fa)+_0x512796+_0x4b0e82(0x276),_0x3d9b7a),_0x3d9b7a['final']&&(console['log'](_0x4b0e82(0x206)+_0x2c3843+_0x4b0e82(0x2e9)+_0x3d9b7a[_0x4b0e82(0x28a)]+'),\x20stopping\x20status\x20checks'),this[_0x4b0e82(0x2cd)](_0x2c3843),await this[_0x4b0e82(0x273)](_0x2c3843,_0x3d9b7a['status'],_0x3d9b7a));}catch(_0x12d92e){console[_0x4b0e82(0x2f3)]('❌\x20Status\x20check\x20#'+_0x512796+_0x4b0e82(0x2eb)+_0x2c3843+':',_0x12d92e);}},_0x512796*_0x185a61);_0x1f430a['push'](_0x4775fb);}this[_0x455dd4(0x281)][_0x455dd4(0x2e2)](_0x2c3843,_0x1f430a),console[_0x455dd4(0x2b9)](_0x455dd4(0x245)+_0x8e2117+_0x455dd4(0x1fc)+_0x2c3843);}[a46_0x4645ff(0x2cd)](_0x2f4aae){const _0x3ca400=a46_0x4645ff,_0x541868=this[_0x3ca400(0x281)]['get'](_0x2f4aae);_0x541868&&(console[_0x3ca400(0x2b9)](_0x3ca400(0x2ae)+_0x541868['length']+_0x3ca400(0x27f)+_0x2f4aae),_0x541868[_0x3ca400(0x2b2)]((_0x746bf1,_0x578cb4)=>{clearTimeout(_0x746bf1);}),this[_0x3ca400(0x281)][_0x3ca400(0x271)](_0x2f4aae));}async[a46_0x4645ff(0x273)](_0x211e39,_0x19514a,_0x3b86fe){const _0x230b7b=a46_0x4645ff;try{const _0x38a502=(await Promise[_0x230b7b(0x2df)]()[_0x230b7b(0x2d1)](()=>__importStar(require(_0x230b7b(0x2f6)))))['default'],_0xfbf229={'status':_0x19514a[_0x230b7b(0x2d6)](),'updatedAt':new Date(),'statusChangedBy':_0x230b7b(0x2fe),'statusChangedAt':new Date()};_0x19514a===_0x230b7b(0x23e)&&(_0xfbf229[_0x230b7b(0x2e8)]=new Date()),_0x19514a==='FAILED'&&_0x3b86fe[_0x230b7b(0x212)]&&(_0xfbf229[_0x230b7b(0x29d)]=_0x3b86fe['description'],console['log'](_0x230b7b(0x27d)+_0x3b86fe['description'])),_0x3b86fe[_0x230b7b(0x212)]&&(_0xfbf229[_0x230b7b(0x258)]=(_0x19514a===_0x230b7b(0x23e)?'VISA/MasterCard\x20payment\x20successful':_0x230b7b(0x261))+':\x20'+_0x3b86fe['description']),await _0x38a502['payment'][_0x230b7b(0x29a)]({'where':{'id':_0x211e39},'data':_0xfbf229}),console[_0x230b7b(0x2b9)](_0x230b7b(0x206)+_0x211e39+_0x230b7b(0x2f2)+_0x19514a),await this[_0x230b7b(0x26f)](_0x211e39,_0x19514a);}catch(_0xc897e8){console[_0x230b7b(0x2f3)]('❌\x20Failed\x20to\x20update\x20payment\x20status\x20for\x20'+_0x211e39+':',_0xc897e8);}}async[a46_0x4645ff(0x26f)](_0x46bb42,_0x336177){const _0x4b0b81=a46_0x4645ff;try{const _0x5cd842=(await Promise[_0x4b0b81(0x2df)]()[_0x4b0b81(0x2d1)](()=>__importStar(require(_0x4b0b81(0x2f6)))))[_0x4b0b81(0x263)],{telegramBotService:_0x119229}=await Promise[_0x4b0b81(0x2df)]()['then'](()=>__importStar(require(_0x4b0b81(0x272)))),_0x2b4d2d=await _0x5cd842['payment'][_0x4b0b81(0x254)]({'where':{'id':_0x46bb42},'include':{'shop':{'include':{'settings':!![]}}}});if(!_0x2b4d2d)return;const _0x47bbb3={'PAID':_0x4b0b81(0x306),'FAILED':_0x4b0b81(0x1e7)},_0x2921de=_0x47bbb3[_0x336177];_0x2921de&&await _0x119229[_0x4b0b81(0x251)](_0x2b4d2d[_0x4b0b81(0x296)],_0x2b4d2d,_0x2921de),await this[_0x4b0b81(0x278)](_0x2b4d2d,_0x336177);}catch(_0x10d1e8){console[_0x4b0b81(0x2f3)](_0x4b0b81(0x2e7),_0x10d1e8);}}async[a46_0x4645ff(0x278)](_0x268ad8,_0x524d6a){const _0x40e14b=a46_0x4645ff,_0x1f49bd=Date[_0x40e14b(0x287)]();try{const _0x316a38=_0x268ad8[_0x40e14b(0x297)],_0x4bd34a=_0x316a38[_0x40e14b(0x244)];if(!_0x4bd34a?.['webhookUrl']){console[_0x40e14b(0x2b9)](_0x40e14b(0x203)+_0x316a38['id']);return;}const _0x17d100=_0x524d6a===_0x40e14b(0x23e)?'payment.success':_0x40e14b(0x305);let _0x54b812=[];if(_0x4bd34a[_0x40e14b(0x25f)])try{_0x54b812=Array[_0x40e14b(0x231)](_0x4bd34a[_0x40e14b(0x25f)])?_0x4bd34a[_0x40e14b(0x25f)]:JSON[_0x40e14b(0x308)](_0x4bd34a[_0x40e14b(0x25f)]);}catch(_0xed847c){console[_0x40e14b(0x2f3)](_0x40e14b(0x2f4),_0xed847c),_0x54b812=[];}if(!_0x54b812[_0x40e14b(0x1e8)](_0x17d100)){console[_0x40e14b(0x2b9)](_0x40e14b(0x2cb)+_0x17d100+'\x20not\x20enabled\x20for\x20shop\x20'+_0x316a38['id']);return;}const _0x4513fa={'event':_0x17d100,'payment':{'id':_0x268ad8['id'],'order_id':_0x268ad8[_0x40e14b(0x2d9)],'gateway_order_id':_0x268ad8[_0x40e14b(0x1ff)],'gateway':_0x40e14b(0x2f5),'amount':_0x268ad8['amount'],'currency':_0x268ad8[_0x40e14b(0x279)],'status':_0x524d6a[_0x40e14b(0x2ea)](),'customer_email':_0x268ad8[_0x40e14b(0x208)],'customer_name':_0x268ad8['customerName'],'created_at':_0x268ad8['createdAt'],'updated_at':new Date()}},_0x176e9a=await fetch(_0x4bd34a[_0x40e14b(0x29e)],{'method':_0x40e14b(0x265),'headers':{'Content-Type':_0x40e14b(0x223),'User-Agent':'TesSoft\x20Payment\x20System/1.0\x20(MasterCard)'},'body':JSON['stringify'](_0x4513fa)}),_0x23b77e=Date['now']()-_0x1f49bd;loggerService_1['loggerService'][_0x40e14b(0x2e3)](_0x268ad8['shopId'],_0x4bd34a[_0x40e14b(0x29e)],_0x17d100,_0x176e9a[_0x40e14b(0x28a)],_0x23b77e,_0x4513fa),console[_0x40e14b(0x2b9)](_0x40e14b(0x20c)+_0x4bd34a['webhookUrl']+'\x20with\x20status\x20'+_0x176e9a['status']+'\x20('+_0x23b77e+_0x40e14b(0x1e4));}catch(_0x1489e3){console[_0x40e14b(0x2f3)](_0x40e14b(0x2a2),_0x1489e3),loggerService_1[_0x40e14b(0x2d7)]['logShopWebhookError'](_0x268ad8[_0x40e14b(0x296)],_0x268ad8[_0x40e14b(0x297)]?.[_0x40e14b(0x244)]?.[_0x40e14b(0x29e)]||_0x40e14b(0x224),_0x40e14b(0x2fb),_0x1489e3,{});}}[a46_0x4645ff(0x218)](_0x50b3c9){const _0x4a5056=a46_0x4645ff,_0x2899ac=_0x50b3c9['replace'](/[\s-]/g,'');if(_0x2899ac[_0x4a5056(0x236)]<0x4)return'****';return _0x4a5056(0x248)+_0x2899ac[_0x4a5056(0x26d)](-0x4);}async[a46_0x4645ff(0x2dc)](_0x4e922e,_0x5199f5=a46_0x4645ff(0x222)){const _0x4dc88e=a46_0x4645ff;console['log'](_0x4dc88e(0x2ca),JSON[_0x4dc88e(0x282)](_0x4e922e,null,0x2));let _0x39d5fd=_0x4e922e,_0x92e199=_0x5199f5;_0x4e922e[_0x4dc88e(0x21e)]?(_0x92e199=_0x4e922e[_0x4dc88e(0x21e)]['toUpperCase']()===_0x4dc88e(0x216)?_0x4dc88e(0x216):_0x4dc88e(0x222),console[_0x4dc88e(0x2b9)](_0x4dc88e(0x25b)+_0x92e199)):console['log'](_0x4dc88e(0x233)+_0x92e199);if(_0x4e922e[_0x4dc88e(0x27e)]&&_0x4e922e[_0x4dc88e(0x27c)]&&_0x4e922e[_0x4dc88e(0x23b)]){console[_0x4dc88e(0x2b9)](_0x4dc88e(0x2d2));try{const _0x152b17=await this[_0x4dc88e(0x2c5)](_0x4e922e[_0x4dc88e(0x27e)],_0x4e922e[_0x4dc88e(0x27c)],_0x92e199);_0x39d5fd=JSON[_0x4dc88e(0x308)](_0x152b17),console['log']('✅\x20Webhook\x20data\x20decrypted\x20successfully\x20via\x20PHP'),console[_0x4dc88e(0x2b9)](_0x4dc88e(0x23a),JSON[_0x4dc88e(0x282)](_0x39d5fd,null,0x2));}catch(_0x436042){console[_0x4dc88e(0x2f3)]('❌\x20Failed\x20to\x20decrypt\x20webhook\x20data\x20via\x20PHP:',_0x436042),console[_0x4dc88e(0x2b9)](_0x4dc88e(0x2a5)),_0x39d5fd=_0x4e922e;}}else console[_0x4dc88e(0x2b9)](_0x4dc88e(0x27a));let _0x5e71de=_0x4dc88e(0x301);if(_0x39d5fd[_0x4dc88e(0x28a)]===0x64&&_0x39d5fd[_0x4dc88e(0x30c)]===0x1)_0x5e71de='PAID';else{if(_0x39d5fd['final']===0x0)_0x5e71de=_0x4dc88e(0x301);else _0x39d5fd[_0x4dc88e(0x30c)]===0x1&&_0x39d5fd[_0x4dc88e(0x28a)]!==0x64?_0x5e71de=_0x4dc88e(0x201):_0x5e71de=_0x4dc88e(0x301);}let _0x515d5c='';if(_0x39d5fd['order_id'])_0x515d5c=_0x39d5fd['order_id'][_0x4dc88e(0x20d)](),console[_0x4dc88e(0x2b9)](_0x4dc88e(0x285)+_0x92e199+_0x4dc88e(0x1e5)+_0x515d5c);else _0x39d5fd[_0x4dc88e(0x22b)]?(_0x515d5c=_0x39d5fd[_0x4dc88e(0x22b)][_0x4dc88e(0x20d)](),console['log']('🔍\x20Using\x20'+_0x92e199+_0x4dc88e(0x23d)+_0x515d5c)):(_0x515d5c=_0x39d5fd['orderId']||_0x39d5fd[_0x4dc88e(0x28d)]||_0x39d5fd['id']||'',console['log'](_0x4dc88e(0x2ac)+_0x515d5c));console[_0x4dc88e(0x2b9)]('📊\x20'+_0x92e199+_0x4dc88e(0x309)),console['log'](_0x4dc88e(0x1e3)+_0x515d5c+_0x4dc88e(0x291)+_0x39d5fd[_0x4dc88e(0x2cf)]+_0x4dc88e(0x302)+_0x39d5fd[_0x4dc88e(0x2d9)]+_0x4dc88e(0x200)+_0x39d5fd[_0x4dc88e(0x22b)]+_0x4dc88e(0x2c0)+_0x39d5fd[_0x4dc88e(0x28d)]+',\x20id='+_0x39d5fd['id']+')'),console[_0x4dc88e(0x2b9)](_0x4dc88e(0x1ed)+_0x5e71de+_0x4dc88e(0x289)+_0x39d5fd[_0x4dc88e(0x28a)]+_0x4dc88e(0x2bb)+_0x39d5fd[_0x4dc88e(0x30c)]+')'),console[_0x4dc88e(0x2b9)](_0x4dc88e(0x2be)+_0x39d5fd[_0x4dc88e(0x21b)]),console[_0x4dc88e(0x2b9)](_0x4dc88e(0x1f8)+_0x39d5fd[_0x4dc88e(0x279)]);let _0x5f5988;_0x5e71de==='FAILED'&&_0x39d5fd[_0x4dc88e(0x24a)]&&(_0x5f5988=_0x39d5fd['desc'],console[_0x4dc88e(0x2b9)]('❌\x20Failure\x20description:\x20'+_0x5f5988));const _0x585e38={'paymentId':_0x515d5c,'status':_0x5e71de,'amount':_0x39d5fd[_0x4dc88e(0x21b)],'currency':_0x39d5fd[_0x4dc88e(0x279)]};return _0x5f5988&&(_0x585e38[_0x4dc88e(0x29d)]=_0x5f5988),_0x585e38;}[a46_0x4645ff(0x24e)](){const _0x3ffd1c=a46_0x4645ff;console[_0x3ffd1c(0x2b9)](_0x3ffd1c(0x28b));const _0x44beee=this[_0x3ffd1c(0x281)][_0x3ffd1c(0x28e)];for(const [_0x1aff64]of this['statusCheckTimers']){this[_0x3ffd1c(0x2cd)](_0x1aff64);}console[_0x3ffd1c(0x2b9)]('🛑\x20Stopped\x20'+_0x44beee+_0x3ffd1c(0x1f0));}}exports['VisaMasterCardService']=VisaMasterCardService;