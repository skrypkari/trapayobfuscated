'use strict';const a67_0xa4718=a67_0x54f3;(function(_0x39aad8,_0x2ccaf1){const _0x5cc6c1=a67_0x54f3,_0x569412=_0x39aad8();while(!![]){try{const _0x528796=parseInt(_0x5cc6c1(0x13b))/0x1+-parseInt(_0x5cc6c1(0x133))/0x2+-parseInt(_0x5cc6c1(0x10f))/0x3*(-parseInt(_0x5cc6c1(0x151))/0x4)+parseInt(_0x5cc6c1(0x146))/0x5+-parseInt(_0x5cc6c1(0xd2))/0x6+-parseInt(_0x5cc6c1(0x14b))/0x7*(-parseInt(_0x5cc6c1(0x126))/0x8)+parseInt(_0x5cc6c1(0x105))/0x9;if(_0x528796===_0x2ccaf1)break;else _0x569412['push'](_0x569412['shift']());}catch(_0x5e28a6){_0x569412['push'](_0x569412['shift']());}}}(a67_0x4867,0x7851e));var __createBinding=this&&this[a67_0xa4718(0x102)]||(Object['create']?function(_0x5719fa,_0x2943c5,_0x235cf4,_0x19b97e){const _0x29e8c8=a67_0xa4718;if(_0x19b97e===undefined)_0x19b97e=_0x235cf4;var _0x3627f0=Object[_0x29e8c8(0x123)](_0x2943c5,_0x235cf4);(!_0x3627f0||(_0x29e8c8(0x12b)in _0x3627f0?!_0x2943c5[_0x29e8c8(0x107)]:_0x3627f0[_0x29e8c8(0x100)]||_0x3627f0['configurable']))&&(_0x3627f0={'enumerable':!![],'get':function(){return _0x2943c5[_0x235cf4];}}),Object[_0x29e8c8(0x108)](_0x5719fa,_0x19b97e,_0x3627f0);}:function(_0x2c6ce8,_0x19f9ec,_0x2a83fe,_0x388020){if(_0x388020===undefined)_0x388020=_0x2a83fe;_0x2c6ce8[_0x388020]=_0x19f9ec[_0x2a83fe];}),__setModuleDefault=this&&this[a67_0xa4718(0xf1)]||(Object[a67_0xa4718(0xe9)]?function(_0x56a3ab,_0x262e31){const _0x1931b0=a67_0xa4718;Object[_0x1931b0(0x108)](_0x56a3ab,_0x1931b0(0x136),{'enumerable':!![],'value':_0x262e31});}:function(_0x44c906,_0x388397){_0x44c906['default']=_0x388397;}),__importStar=this&&this['__importStar']||(function(){var _0x2e8fcd=function(_0x316d91){const _0xa6545d=a67_0x54f3;return _0x2e8fcd=Object[_0xa6545d(0xd4)]||function(_0x5df786){const _0x2c6ba3=_0xa6545d;var _0x3a06cb=[];for(var _0x42e472 in _0x5df786)if(Object[_0x2c6ba3(0xc6)][_0x2c6ba3(0x10b)][_0x2c6ba3(0xdd)](_0x5df786,_0x42e472))_0x3a06cb[_0x3a06cb['length']]=_0x42e472;return _0x3a06cb;},_0x2e8fcd(_0x316d91);};return function(_0x5c9aeb){const _0x1cc127=a67_0x54f3;if(_0x5c9aeb&&_0x5c9aeb[_0x1cc127(0x107)])return _0x5c9aeb;var _0xe04438={};if(_0x5c9aeb!=null){for(var _0x2bab2=_0x2e8fcd(_0x5c9aeb),_0x325095=0x0;_0x325095<_0x2bab2[_0x1cc127(0x13e)];_0x325095++)if(_0x2bab2[_0x325095]!==_0x1cc127(0x136))__createBinding(_0xe04438,_0x5c9aeb,_0x2bab2[_0x325095]);}return __setModuleDefault(_0xe04438,_0x5c9aeb),_0xe04438;};}());Object[a67_0xa4718(0x108)](exports,'__esModule',{'value':!![]}),exports[a67_0xa4718(0xd9)]=void 0x0;function a67_0x54f3(_0x28c6b7,_0x1c9d53){_0x28c6b7=_0x28c6b7-0xc3;const _0x486717=a67_0x4867();let _0x54f337=_0x486717[_0x28c6b7];return _0x54f337;}const loggerService_1=require(a67_0xa4718(0x152));class KlymeService{constructor(){const _0x4eaf6b=a67_0xa4718;this[_0x4eaf6b(0xde)]='https://tesoft.uk/gateway/klyme/',console[_0x4eaf6b(0xfa)]('üí≥\x20KLYME\x20service\x20initialized\x20with\x20unified\x20white\x20domain\x20proxy\x20for\x20all\x20regions');}['validateCurrencyForRegion'](_0x2f91db,_0x2229f4){const _0x5afa58=a67_0xa4718,_0x55f0f7=_0x2f91db[_0x5afa58(0xff)]();switch(_0x2229f4){case'EU':if(_0x55f0f7!==_0x5afa58(0xf0))throw new Error(_0x5afa58(0x14e)+_0x55f0f7);break;case'GB':if(_0x55f0f7!==_0x5afa58(0x141))throw new Error(_0x5afa58(0xd3)+_0x55f0f7);break;case'DE':if(_0x55f0f7!==_0x5afa58(0xf0))throw new Error(_0x5afa58(0x14c)+_0x55f0f7);break;default:throw new Error(_0x5afa58(0x11a)+_0x2229f4);}}async[a67_0xa4718(0x12a)](){const _0x496ba0=a67_0xa4718,_0x2995e0=(await Promise['resolve']()[_0x496ba0(0x12e)](()=>__importStar(require(_0x496ba0(0x154)))))[_0x496ba0(0x136)];let _0x292b42,_0x1b669e=0x0;const _0x7e696=0xa;do{const _0x54fbd9=()=>{const _0x4e24eb=_0x496ba0;return Math['floor'](Math[_0x4e24eb(0x149)]()*0x5f5e100)[_0x4e24eb(0x144)]()['padStart'](0x8,'0');};_0x292b42=_0x54fbd9()+'-'+_0x54fbd9();const _0x2da775=await _0x2995e0['payment'][_0x496ba0(0xda)]({'where':{'gatewayOrderId':_0x292b42}});if(!_0x2da775)break;_0x1b669e++,console['log']('‚ö†Ô∏è\x20KLYME\x20reference\x20'+_0x292b42+'\x20already\x20exists,\x20generating\x20new\x20one\x20(attempt\x20'+_0x1b669e+')');}while(_0x1b669e<_0x7e696);if(_0x1b669e>=_0x7e696)throw new Error(_0x496ba0(0xf2));return _0x292b42;}async[a67_0xa4718(0x10d)](_0x450ffb){const _0x181fed=a67_0xa4718,{orderId:_0x8cc0ea,amount:_0x3b736c,currency:_0x3a8076,region:_0x340cde}=_0x450ffb;if(_0x340cde!=='EU'&&_0x340cde!=='GB'&&_0x340cde!=='DE')throw new Error(_0x181fed(0x10a)+_0x340cde);this['validateCurrencyForRegion'](_0x3a8076,_0x340cde);const _0xad82cc=_0x3a8076[_0x181fed(0xff)]();console['log'](_0x181fed(0x11b)+_0x340cde+_0x181fed(0x120)+_0xad82cc);const _0x3095c5=await this[_0x181fed(0x12a)]();console[_0x181fed(0xfa)](_0x181fed(0xe0)+_0x3095c5+'\x20(8digits-8digits\x20format\x20for\x20'+_0x340cde+')');const _0x28a78b='https://tesoft.uk/gateway/pending.php?id='+_0x8cc0ea,_0x2c0880={'amount':_0x3b736c,'currency':_0xad82cc,'redirectUrl':_0x28a78b,'reference':_0x3095c5,'geo':_0x340cde},_0x1e9bbf=Date[_0x181fed(0xd5)]();try{console[_0x181fed(0xfa)](_0x181fed(0x143)+_0x340cde+_0x181fed(0x13d)),console[_0x181fed(0xfa)]('URL:',this[_0x181fed(0xde)]),console['log'](_0x181fed(0xe1),JSON[_0x181fed(0x111)](_0x2c0880,null,0x2)),console['log'](_0x181fed(0xe7),_0x340cde),console[_0x181fed(0xfa)]('Currency:',_0xad82cc,_0x181fed(0x109)+_0x340cde+')'),console[_0x181fed(0xfa)](_0x181fed(0x11f),_0x3095c5,_0x181fed(0x132)),console[_0x181fed(0xfa)](_0x181fed(0xe8),_0x28a78b),loggerService_1[_0x181fed(0xf9)][_0x181fed(0xee)](_0x181fed(0x12c)+_0x340cde[_0x181fed(0x112)](),_0x181fed(0x131),_0x181fed(0x11e),_0x2c0880);const _0x3005ac=await fetch(this[_0x181fed(0xde)],{'method':_0x181fed(0x11e),'headers':{'Content-Type':_0x181fed(0x129),'Accept':_0x181fed(0x129),'User-Agent':_0x181fed(0x130)},'body':JSON['stringify'](_0x2c0880)}),_0x1f7865=Date[_0x181fed(0xd5)]()-_0x1e9bbf;console[_0x181fed(0xfa)](_0x181fed(0x143)+_0x340cde+_0x181fed(0xcf)),console[_0x181fed(0xfa)](_0x181fed(0xf6),_0x3005ac[_0x181fed(0x110)]),console[_0x181fed(0xfa)](_0x181fed(0x121),_0x3005ac[_0x181fed(0xfe)]),console['log'](_0x181fed(0x147),Object['fromEntries'](_0x3005ac[_0x181fed(0xcc)]['entries']())),console['log'](_0x181fed(0xd1),_0x1f7865+'ms');const _0x44129e=await _0x3005ac[_0x181fed(0xc4)]();console[_0x181fed(0xfa)](_0x181fed(0x103),_0x44129e);if(!_0x3005ac['ok']){console[_0x181fed(0xea)](_0x181fed(0x143)+_0x340cde+_0x181fed(0x13f)),console[_0x181fed(0xea)](_0x181fed(0xc5),_0x3005ac[_0x181fed(0x110)]),console['error'](_0x181fed(0x106),_0x44129e),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x181fed(0x12c)+_0x340cde[_0x181fed(0x112)](),_0x181fed(0x131),_0x3005ac[_0x181fed(0x110)],_0x44129e,_0x1f7865),loggerService_1[_0x181fed(0xf9)][_0x181fed(0xca)](_0x181fed(0x12c)+_0x340cde[_0x181fed(0x112)](),_0x181fed(0x131),_0x181fed(0xc7)+_0x3005ac[_0x181fed(0x110)]+':\x20'+_0x44129e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3005ac['status']+_0x181fed(0x12d)+_0x44129e);}let _0x5cf98b;try{_0x5cf98b=JSON[_0x181fed(0xc3)](_0x44129e);}catch(_0x27f2e0){console[_0x181fed(0xea)](_0x181fed(0x128),_0x27f2e0),loggerService_1[_0x181fed(0xf9)][_0x181fed(0xca)](_0x181fed(0x12c)+_0x340cde[_0x181fed(0x112)](),'/create',_0x181fed(0xf3)+_0x27f2e0);throw new Error(_0x181fed(0x139)+_0x340cde+_0x181fed(0xeb)+_0x44129e);}console['log'](_0x181fed(0x137)+_0x340cde+_0x181fed(0x11d)),console['log']('Parsed\x20Result:',JSON[_0x181fed(0x111)](_0x5cf98b,null,0x2)),loggerService_1[_0x181fed(0xf9)][_0x181fed(0x104)](_0x181fed(0x12c)+_0x340cde[_0x181fed(0x112)](),_0x181fed(0x131),_0x3005ac[_0x181fed(0x110)],_0x5cf98b,_0x1f7865);if(_0x5cf98b[_0x181fed(0xea)]||_0x5cf98b[_0x181fed(0x113)]){const _0x1ade73=_0x5cf98b[_0x181fed(0x12f)]||_0x5cf98b[_0x181fed(0xea)]||_0x181fed(0x134)+_0x340cde+_0x181fed(0x145);console[_0x181fed(0xea)](_0x181fed(0x143)+_0x340cde+_0x181fed(0x153)),console[_0x181fed(0xea)](_0x181fed(0xe5),_0x1ade73),console[_0x181fed(0xea)](_0x181fed(0xd0),_0x5cf98b[_0x181fed(0x113)]),loggerService_1[_0x181fed(0xf9)][_0x181fed(0xca)]('klyme_'+_0x340cde[_0x181fed(0x112)](),_0x181fed(0x131),_0x181fed(0xfb)+_0x1ade73);throw new Error(_0x181fed(0x142)+_0x340cde+'\x20API\x20error:\x20'+_0x1ade73);}let _0x18344e,_0x3b5226;if(_0x5cf98b[_0x181fed(0xf4)]&&_0x5cf98b[_0x181fed(0x119)])_0x18344e=_0x5cf98b['uuid'],_0x3b5226=_0x5cf98b[_0x181fed(0x119)],console[_0x181fed(0xfa)](_0x181fed(0x143)+_0x340cde+_0x181fed(0xe2)),console['log']('UUID:',_0x5cf98b[_0x181fed(0xf4)]),console['log'](_0x181fed(0xe8),_0x5cf98b['redirect_url']);else{if(_0x5cf98b[_0x181fed(0xc8)])_0x18344e=_0x3095c5,_0x3b5226=_0x5cf98b['authUrl'],console[_0x181fed(0xfa)](_0x181fed(0x143)+_0x340cde+_0x181fed(0x13c)),console[_0x181fed(0xfa)]('Auth\x20URL:',_0x5cf98b[_0x181fed(0xc8)]),console[_0x181fed(0xfa)](_0x181fed(0x14d),_0x3095c5);else{console[_0x181fed(0xea)]('===\x20KLYME\x20'+_0x340cde+_0x181fed(0x124)),console[_0x181fed(0xea)](_0x181fed(0xd6)),console[_0x181fed(0xea)](_0x181fed(0x115),_0x5cf98b),loggerService_1[_0x181fed(0xf9)][_0x181fed(0xca)](_0x181fed(0x12c)+_0x340cde['toLowerCase'](),_0x181fed(0x131),_0x181fed(0x114));throw new Error(_0x181fed(0x127)+_0x340cde+'\x20API:\x20missing\x20payment\x20data');}}return console[_0x181fed(0xfa)](_0x181fed(0xc9),_0xad82cc,'('+_0x340cde+_0x181fed(0x150)),console[_0x181fed(0xfa)]('Reference\x20Used:',_0x3095c5,_0x181fed(0x132)),console[_0x181fed(0xfa)](_0x181fed(0x13a),_0x340cde),{'gateway_payment_id':_0x18344e,'payment_url':_0x3b5226};}catch(_0x94a305){console[_0x181fed(0xea)]('===\x20KLYME\x20'+_0x340cde+_0x181fed(0xe4)),console['error']('Error\x20details:',_0x94a305),loggerService_1[_0x181fed(0xf9)][_0x181fed(0xca)](_0x181fed(0x12c)+_0x340cde[_0x181fed(0x112)](),_0x181fed(0x131),_0x94a305);if(_0x94a305 instanceof Error){console[_0x181fed(0xea)](_0x181fed(0xcd),_0x94a305[_0x181fed(0x12f)]),console['error'](_0x181fed(0x14a),_0x94a305[_0x181fed(0xd7)]);throw new Error(_0x181fed(0xce)+_0x340cde+_0x181fed(0xdc)+_0x94a305[_0x181fed(0x12f)]);}throw new Error(_0x181fed(0xce)+_0x340cde+'\x20payment\x20link:\x20Unknown\x20error');}}async['verifyPayment'](_0x1f09a2,_0x2aba43){const _0x41fc37=a67_0xa4718,_0x29a277=Date[_0x41fc37(0xd5)]();try{const _0x139437={'gatewayPaymentId':_0x1f09a2,'geo':_0x2aba43};loggerService_1[_0x41fc37(0xf9)][_0x41fc37(0xee)](_0x41fc37(0x12c)+_0x2aba43[_0x41fc37(0x112)](),_0x41fc37(0x148)+_0x1f09a2,'POST',_0x139437);const _0x48209c=await fetch(this['apiUrl'],{'method':_0x41fc37(0x11e),'headers':{'Content-Type':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x41fc37(0x111)](_0x139437)}),_0x412c43=Date['now']()-_0x29a277;if(!_0x48209c['ok']){const _0x18b011=await _0x48209c[_0x41fc37(0xc4)]();loggerService_1['loggerService'][_0x41fc37(0x104)]('klyme_'+_0x2aba43[_0x41fc37(0x112)](),_0x41fc37(0x148)+_0x1f09a2,_0x48209c['status'],_0x18b011,_0x412c43);throw new Error(_0x41fc37(0xe6)+_0x48209c['status']);}const _0x5c4412=await _0x48209c[_0x41fc37(0x101)]();loggerService_1[_0x41fc37(0xf9)]['logWhiteDomainResponse'](_0x41fc37(0x12c)+_0x2aba43[_0x41fc37(0x112)](),'/verify/'+_0x1f09a2,_0x48209c[_0x41fc37(0x110)],_0x5c4412,_0x412c43);if(_0x5c4412[_0x41fc37(0xea)]||_0x5c4412[_0x41fc37(0x113)]){loggerService_1[_0x41fc37(0xf9)][_0x41fc37(0xca)](_0x41fc37(0x12c)+_0x2aba43[_0x41fc37(0x112)](),_0x41fc37(0x148)+_0x1f09a2,_0x41fc37(0x142)+_0x2aba43+_0x41fc37(0xdb)+(_0x5c4412[_0x41fc37(0x12f)]||_0x5c4412[_0x41fc37(0xea)]||_0x41fc37(0xfc)));throw new Error(_0x41fc37(0x142)+_0x2aba43+_0x41fc37(0xdb)+(_0x5c4412[_0x41fc37(0x12f)]||_0x5c4412[_0x41fc37(0xea)]||_0x41fc37(0xfc)));}let _0x4146dc=_0x41fc37(0xcb);return{'status':_0x4146dc};}catch(_0x3bc376){console[_0x41fc37(0xea)](_0x41fc37(0x142)+_0x2aba43+'\x20payment\x20verification\x20error:',_0x3bc376),loggerService_1[_0x41fc37(0xf9)][_0x41fc37(0xca)](_0x41fc37(0x12c)+_0x2aba43[_0x41fc37(0x112)](),_0x41fc37(0x148)+_0x1f09a2,_0x3bc376);throw new Error(_0x41fc37(0x118)+_0x2aba43+'\x20payment:\x20'+(_0x3bc376 instanceof Error?_0x3bc376[_0x41fc37(0x12f)]:_0x41fc37(0xfc)));}}async[a67_0xa4718(0x122)](_0x144a77){const _0x124133=a67_0xa4718;console[_0x124133(0xfa)]('Processing\x20KLYME\x20webhook:',_0x144a77);let _0x525ecd=_0x124133(0xcb);switch(_0x144a77['status']?.[_0x124133(0x112)]()){case _0x124133(0x14f):case _0x124133(0x11c):case _0x124133(0x135):case'success':case'successful':_0x525ecd=_0x124133(0xfd);break;case'cancelled':case _0x124133(0x140):case _0x124133(0x10c):case _0x124133(0xea):case _0x124133(0xdf):_0x525ecd=_0x124133(0x125);break;case _0x124133(0xe3):case _0x124133(0x117):_0x525ecd=_0x124133(0x116);break;case'pending':case _0x124133(0x10e):case'active':case _0x124133(0x138):case _0x124133(0xd8):default:_0x525ecd=_0x124133(0xcb);break;}return{'paymentId':_0x144a77[_0x124133(0xf7)]||_0x144a77[_0x124133(0xed)]||_0x144a77[_0x124133(0xf8)],'status':_0x525ecd,'amount':_0x144a77[_0x124133(0xf5)],'currency':_0x144a77['currency'],'region':_0x144a77[_0x124133(0xec)],'additionalInfo':{'payment_method':_0x144a77[_0x124133(0xef)],'transaction_id':_0x144a77['transaction_id']}};}}exports['KlymeService']=KlymeService;function a67_0x4867(){const _0x220e0d=['KLYME\x20DE\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20','Reference\x20Used\x20as\x20ID:','KLYME\x20EU\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20','paid','\x20validated)','8yUcuqf','../loggerService','\x20API\x20BUSINESS\x20ERROR\x20===','../../config/database','parse','text','HTTP\x20Status:','prototype','HTTP\x20','authUrl','Currency\x20Used:','logWhiteDomainError','PENDING','headers','Error\x20message:','Failed\x20to\x20create\x20KLYME\x20','\x20API\x20RESPONSE\x20(Unified\x20Route)\x20===','Status\x20Code:','Response\x20Time:','2816964OtyHNl','KLYME\x20GB\x20accepts\x20only\x20GBP\x20currency,\x20got:\x20','getOwnPropertyNames','now','Missing\x20uuid/redirect_url\x20or\x20authUrl\x20in\x20response','stack','in_progress','KlymeService','findFirst','\x20API\x20error:\x20','\x20payment\x20link:\x20','call','apiUrl','rejected','üéØ\x20Generated\x20unique\x20KLYME\x20reference:\x20','Request\x20Body:','\x20SUCCESS\x20(New\x20Format)\x20===','expired','\x20SERVICE\x20ERROR\x20===','Error\x20Message:','HTTP\x20error!\x20status:\x20','Region\x20(geo):','Redirect\x20URL:','create','error','\x20API:\x20','region','order_id','logWhiteDomainRequest','payment_method','EUR','__setModuleDefault','Failed\x20to\x20generate\x20unique\x20KLYME\x20reference\x20after\x20maximum\x20attempts','JSON\x20Parse\x20Error:\x20','uuid','amount','Status:','reference','payment_id','loggerService','log','Business\x20Error:\x20','Unknown\x20error','PAID','statusText','toUpperCase','writable','json','__createBinding','Raw\x20Response\x20Body:','logWhiteDomainResponse','3926187ZmboZW','Response\x20Body:','__esModule','defineProperty','(validated\x20for\x20','KLYME\x20payment\x20creation\x20is\x20supported\x20for\x20EU,\x20GB\x20and\x20DE\x20regions,\x20got:\x20','hasOwnProperty','failed','createPaymentLink','created','717087lHwRgt','status','stringify','toLowerCase','statusCode','Incomplete\x20response:\x20missing\x20uuid/redirect_url\x20or\x20authUrl','Response\x20data:','EXPIRED','timeout','Failed\x20to\x20verify\x20KLYME\x20','redirect_url','Unsupported\x20KLYME\x20region:\x20','üí≥\x20KLYME\x20','completed','\x20RESPONSE\x20===','POST','Reference:','\x20currency\x20validation\x20passed:\x20','Status\x20Text:','processWebhook','getOwnPropertyDescriptor','\x20API\x20INCOMPLETE\x20RESPONSE\x20===','FAILED','8TzmzpW','Invalid\x20response\x20from\x20KLYME\x20','Failed\x20to\x20parse\x20JSON\x20response:','application/json','generateUniqueReference','get','klyme_',',\x20body:\x20','then','message','Payment\x20System/1.0','/create','(8digits-8digits\x20format)','1828656ihPOTM','Unknown\x20error\x20from\x20KLYME\x20','confirmed','default','===\x20PARSED\x20KLYME\x20','processing','Invalid\x20JSON\x20response\x20from\x20KLYME\x20','Geo\x20Parameter:','657044cvAxTu','\x20SUCCESS\x20(Legacy\x20Format)\x20===','\x20API\x20REQUEST\x20(Unified\x20Route\x20with\x20Geo)\x20===','length','\x20API\x20ERROR\x20===','canceled','GBP','KLYME\x20','===\x20KLYME\x20','toString','\x20API','874760hQxbtn','Headers:','/verify/','random','Error\x20stack:','912485QkElne'];a67_0x4867=function(){return _0x220e0d;};return a67_0x4867();}