'use strict';function a48_0x3e45(){const _0x1da1ef=['validateCurrencyForRegion','Processing\x20KLYME\x20webhook:','created','rejected','URL:','../../config/database','EXPIRED','verifyPayment','confirmed','KlymeService','4omNqKp','__esModule','üí≥\x20KLYME\x20service\x20initialized\x20with\x20unified\x20white\x20domain\x20proxy\x20for\x20all\x20regions','fromEntries','amount','758360IgaagU','Response\x20Body:','GBP','log','apiUrl','FAILED','(validated\x20for\x20','headers','POST','Failed\x20to\x20create\x20KLYME\x20','createPaymentLink','failed','Request\x20Body:','payment','Error\x20Message:','KLYME\x20EU\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20','\x20payment\x20link:\x20Unknown\x20error','currency','klyme_','Currency:','Error\x20message:','json','(8digits-8digits\x20format)','\x20validated)','stack','statusText','active','Reference\x20Used\x20as\x20ID:','Invalid\x20response\x20from\x20KLYME\x20','logWhiteDomainResponse','toUpperCase','statusCode','489396PJzrrI','\x20(8digits-8digits\x20format\x20for\x20','Auth\x20URL:','8BoxDcs','\x20API:\x20missing\x20payment\x20data','length','\x20API\x20error:\x20','Unknown\x20error','prototype','UUID:','cancelled','__createBinding','logWhiteDomainError','Redirect\x20URL:','logWhiteDomainRequest','Parsed\x20Result:','parse','Status:','\x20API\x20REQUEST\x20(Unified\x20Route\x20with\x20Geo)\x20===','resolve','Payment\x20System/1.0',',\x20body:\x20','PENDING','\x20RESPONSE\x20===','Missing\x20uuid/redirect_url\x20or\x20authUrl\x20in\x20response','3982125DgpVTq','Response\x20data:','application/json','reference','331997KEtUpc','padStart','KLYME\x20','__setModuleDefault','1309515WwkHZT','paid','\x20API\x20ERROR\x20===','message','generateUniqueReference','379236iCehpl','Incomplete\x20response:\x20missing\x20uuid/redirect_url\x20or\x20authUrl','\x20payment\x20verification\x20error:','Unknown\x20error\x20from\x20KLYME\x20','toLowerCase','Status\x20Code:','/verify/','===\x20KLYME\x20','entries','region','Invalid\x20JSON\x20response\x20from\x20KLYME\x20','\x20already\x20exists,\x20generating\x20new\x20one\x20(attempt\x20','Headers:','timeout','12649590KqKuEa','now','getOwnPropertyNames','JSON\x20Parse\x20Error:\x20','Reference\x20Used:','Failed\x20to\x20parse\x20JSON\x20response:','call','\x20payment:\x20','stringify','KLYME\x20DE\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20','PAID','canceled','payment_id','__importStar','HTTP\x20','‚ö†Ô∏è\x20KLYME\x20reference\x20','Failed\x20to\x20verify\x20KLYME\x20','Response\x20Time:','random','order_id','Raw\x20Response\x20Body:','then','\x20SUCCESS\x20(New\x20Format)\x20===','Error\x20stack:','KLYME\x20payment\x20creation\x20is\x20supported\x20for\x20EU,\x20GB\x20and\x20DE\x20regions,\x20got:\x20','https://tesoft.uk/gateway/pending.php?id=','uuid','text','authUrl','expired','error','successful','Failed\x20to\x20generate\x20unique\x20KLYME\x20reference\x20after\x20maximum\x20attempts','default','hasOwnProperty','===\x20PARSED\x20KLYME\x20','HTTP\x20Status:','/create','floor','loggerService','create','HTTP\x20error!\x20status:\x20','https://tesoft.uk/gateway/klyme/','redirect_url','writable','EUR','status','get','\x20SUCCESS\x20(Legacy\x20Format)\x20===','Geo\x20Parameter:','defineProperty','\x20payment\x20link:\x20','findFirst','../loggerService','\x20currency\x20validation\x20passed:\x20','Region\x20(geo):','Reference:','63SpTZPY'];a48_0x3e45=function(){return _0x1da1ef;};return a48_0x3e45();}const a48_0x87590a=a48_0x42af;(function(_0x4dbb9f,_0x4d7bbb){const _0x3174e3=a48_0x42af,_0x5390d7=_0x4dbb9f();while(!![]){try{const _0x2ecc0c=parseInt(_0x3174e3(0xfc))/0x1*(parseInt(_0x3174e3(0x157))/0x2)+parseInt(_0x3174e3(0x17c))/0x3+parseInt(_0x3174e3(0x17f))/0x4*(-parseInt(_0x3174e3(0x100))/0x5)+parseInt(_0x3174e3(0x105))/0x6+parseInt(_0x3174e3(0xf8))/0x7+-parseInt(_0x3174e3(0x15c))/0x8*(-parseInt(_0x3174e3(0x14c))/0x9)+-parseInt(_0x3174e3(0x113))/0xa;if(_0x2ecc0c===_0x4d7bbb)break;else _0x5390d7['push'](_0x5390d7['shift']());}catch(_0x43eb7c){_0x5390d7['push'](_0x5390d7['shift']());}}}(a48_0x3e45,0x518b7));var __createBinding=this&&this[a48_0x87590a(0x187)]||(Object[a48_0x87590a(0x13b)]?function(_0x475e18,_0x23bca9,_0x5ba211,_0x954d57){const _0x430a4e=a48_0x87590a;if(_0x954d57===undefined)_0x954d57=_0x5ba211;var _0x1b0df4=Object['getOwnPropertyDescriptor'](_0x23bca9,_0x5ba211);(!_0x1b0df4||(_0x430a4e(0x142)in _0x1b0df4?!_0x23bca9['__esModule']:_0x1b0df4[_0x430a4e(0x13f)]||_0x1b0df4['configurable']))&&(_0x1b0df4={'enumerable':!![],'get':function(){return _0x23bca9[_0x5ba211];}}),Object[_0x430a4e(0x145)](_0x475e18,_0x954d57,_0x1b0df4);}:function(_0x563109,_0x5f4c3d,_0x47470e,_0x55de1c){if(_0x55de1c===undefined)_0x55de1c=_0x47470e;_0x563109[_0x55de1c]=_0x5f4c3d[_0x47470e];}),__setModuleDefault=this&&this[a48_0x87590a(0xff)]||(Object['create']?function(_0x1de014,_0xa7c8b7){const _0x50ba45=a48_0x87590a;Object['defineProperty'](_0x1de014,_0x50ba45(0x134),{'enumerable':!![],'value':_0xa7c8b7});}:function(_0x2e82be,_0x1c3558){_0x2e82be['default']=_0x1c3558;}),__importStar=this&&this[a48_0x87590a(0x120)]||(function(){var _0x1243fc=function(_0x5ad161){const _0x4100ad=a48_0x42af;return _0x1243fc=Object[_0x4100ad(0x115)]||function(_0x4dd4e8){const _0x4d36fc=_0x4100ad;var _0x1afed9=[];for(var _0x382719 in _0x4dd4e8)if(Object[_0x4d36fc(0x184)][_0x4d36fc(0x135)][_0x4d36fc(0x119)](_0x4dd4e8,_0x382719))_0x1afed9[_0x1afed9['length']]=_0x382719;return _0x1afed9;},_0x1243fc(_0x5ad161);};return function(_0x4f8353){const _0x49d8bd=a48_0x42af;if(_0x4f8353&&_0x4f8353[_0x49d8bd(0x158)])return _0x4f8353;var _0x1b3529={};if(_0x4f8353!=null){for(var _0x2b2107=_0x1243fc(_0x4f8353),_0x59a307=0x0;_0x59a307<_0x2b2107[_0x49d8bd(0x181)];_0x59a307++)if(_0x2b2107[_0x59a307]!=='default')__createBinding(_0x1b3529,_0x4f8353,_0x2b2107[_0x59a307]);}return __setModuleDefault(_0x1b3529,_0x4f8353),_0x1b3529;};}());Object[a48_0x87590a(0x145)](exports,a48_0x87590a(0x158),{'value':!![]}),exports[a48_0x87590a(0x156)]=void 0x0;const loggerService_1=require(a48_0x87590a(0x148));function a48_0x42af(_0x5d1a46,_0x5af56d){const _0x3e45c3=a48_0x3e45();return a48_0x42af=function(_0x42af2b,_0x225608){_0x42af2b=_0x42af2b-0xf2;let _0x13b6e6=_0x3e45c3[_0x42af2b];return _0x13b6e6;},a48_0x42af(_0x5d1a46,_0x5af56d);}class KlymeService{constructor(){const _0x3e2b2b=a48_0x87590a;this[_0x3e2b2b(0x160)]=_0x3e2b2b(0x13d),console[_0x3e2b2b(0x15f)](_0x3e2b2b(0x159));}[a48_0x87590a(0x14d)](_0x1ad0b0,_0x1383ef){const _0x68d547=a48_0x87590a,_0x3c5f3a=_0x1ad0b0[_0x68d547(0x17a)]();switch(_0x1383ef){case'EU':if(_0x3c5f3a!==_0x68d547(0x140))throw new Error(_0x68d547(0x16b)+_0x3c5f3a);break;case'GB':if(_0x3c5f3a!==_0x68d547(0x15e))throw new Error('KLYME\x20GB\x20accepts\x20only\x20GBP\x20currency,\x20got:\x20'+_0x3c5f3a);break;case'DE':if(_0x3c5f3a!==_0x68d547(0x140))throw new Error(_0x68d547(0x11c)+_0x3c5f3a);break;default:throw new Error('Unsupported\x20KLYME\x20region:\x20'+_0x1383ef);}}async[a48_0x87590a(0x104)](){const _0x49480a=a48_0x87590a,_0x54ef9c=(await Promise[_0x49480a(0xf2)]()[_0x49480a(0x128)](()=>__importStar(require(_0x49480a(0x152)))))[_0x49480a(0x134)];let _0x463832,_0x53bd8f=0x0;const _0xffa41c=0xa;do{const _0x5e3b06=()=>{const _0x176fe2=_0x49480a;return Math[_0x176fe2(0x139)](Math[_0x176fe2(0x125)]()*0x5f5e100)['toString']()[_0x176fe2(0xfd)](0x8,'0');};_0x463832=_0x5e3b06()+'-'+_0x5e3b06();const _0x4a15d8=await _0x54ef9c[_0x49480a(0x169)][_0x49480a(0x147)]({'where':{'gatewayOrderId':_0x463832}});if(!_0x4a15d8)break;_0x53bd8f++,console[_0x49480a(0x15f)](_0x49480a(0x122)+_0x463832+_0x49480a(0x110)+_0x53bd8f+')');}while(_0x53bd8f<_0xffa41c);if(_0x53bd8f>=_0xffa41c)throw new Error(_0x49480a(0x133));return _0x463832;}async[a48_0x87590a(0x166)](_0x4aac20){const _0x48e844=a48_0x87590a,{orderId:_0x40aae6,amount:_0x569653,currency:_0x59cb03,region:_0xa10c38}=_0x4aac20;if(_0xa10c38!=='EU'&&_0xa10c38!=='GB'&&_0xa10c38!=='DE')throw new Error(_0x48e844(0x12b)+_0xa10c38);this[_0x48e844(0x14d)](_0x59cb03,_0xa10c38);const _0x3e2a67=_0x59cb03[_0x48e844(0x17a)]();console[_0x48e844(0x15f)]('üí≥\x20KLYME\x20'+_0xa10c38+_0x48e844(0x149)+_0x3e2a67);const _0x1254f9=await this[_0x48e844(0x104)]();console[_0x48e844(0x15f)]('üéØ\x20Generated\x20unique\x20KLYME\x20reference:\x20'+_0x1254f9+_0x48e844(0x17d)+_0xa10c38+')');const _0x1c525c=_0x48e844(0x12c)+_0x40aae6,_0x5c7666={'amount':_0x569653,'currency':_0x3e2a67,'redirectUrl':_0x1c525c,'reference':_0x1254f9,'geo':_0xa10c38},_0x3cf33a=Date[_0x48e844(0x114)]();try{console['log'](_0x48e844(0x10c)+_0xa10c38+_0x48e844(0x18e)),console[_0x48e844(0x15f)](_0x48e844(0x151),this['apiUrl']),console['log'](_0x48e844(0x168),JSON[_0x48e844(0x11b)](_0x5c7666,null,0x2)),console['log'](_0x48e844(0x14a),_0xa10c38),console[_0x48e844(0x15f)](_0x48e844(0x16f),_0x3e2a67,_0x48e844(0x162)+_0xa10c38+')'),console['log'](_0x48e844(0x14b),_0x1254f9,_0x48e844(0x172)),console['log'](_0x48e844(0x189),_0x1c525c),loggerService_1[_0x48e844(0x13a)][_0x48e844(0x18a)]('klyme_'+_0xa10c38[_0x48e844(0x109)](),'/create','POST',_0x5c7666);const _0x5c7357=await fetch(this[_0x48e844(0x160)],{'method':_0x48e844(0x164),'headers':{'Content-Type':_0x48e844(0xfa),'Accept':_0x48e844(0xfa),'User-Agent':_0x48e844(0xf3)},'body':JSON[_0x48e844(0x11b)](_0x5c7666)}),_0x4d1aba=Date['now']()-_0x3cf33a;console[_0x48e844(0x15f)]('===\x20KLYME\x20'+_0xa10c38+'\x20API\x20RESPONSE\x20(Unified\x20Route)\x20==='),console[_0x48e844(0x15f)](_0x48e844(0x18d),_0x5c7357['status']),console[_0x48e844(0x15f)]('Status\x20Text:',_0x5c7357[_0x48e844(0x175)]),console['log'](_0x48e844(0x111),Object[_0x48e844(0x15a)](_0x5c7357[_0x48e844(0x163)][_0x48e844(0x10d)]())),console[_0x48e844(0x15f)](_0x48e844(0x124),_0x4d1aba+'ms');const _0x132da9=await _0x5c7357[_0x48e844(0x12e)]();console['log'](_0x48e844(0x127),_0x132da9);if(!_0x5c7357['ok']){console['error'](_0x48e844(0x10c)+_0xa10c38+_0x48e844(0x102)),console['error'](_0x48e844(0x137),_0x5c7357[_0x48e844(0x141)]),console[_0x48e844(0x131)](_0x48e844(0x15d),_0x132da9),loggerService_1[_0x48e844(0x13a)][_0x48e844(0x179)]('klyme_'+_0xa10c38[_0x48e844(0x109)](),_0x48e844(0x138),_0x5c7357[_0x48e844(0x141)],_0x132da9,_0x4d1aba),loggerService_1['loggerService']['logWhiteDomainError']('klyme_'+_0xa10c38['toLowerCase'](),_0x48e844(0x138),_0x48e844(0x121)+_0x5c7357[_0x48e844(0x141)]+':\x20'+_0x132da9);throw new Error(_0x48e844(0x13c)+_0x5c7357[_0x48e844(0x141)]+_0x48e844(0xf4)+_0x132da9);}let _0x177990;try{_0x177990=JSON[_0x48e844(0x18c)](_0x132da9);}catch(_0x44690e){console[_0x48e844(0x131)](_0x48e844(0x118),_0x44690e),loggerService_1[_0x48e844(0x13a)][_0x48e844(0x188)](_0x48e844(0x16e)+_0xa10c38['toLowerCase'](),_0x48e844(0x138),_0x48e844(0x116)+_0x44690e);throw new Error(_0x48e844(0x10f)+_0xa10c38+'\x20API:\x20'+_0x132da9);}console[_0x48e844(0x15f)](_0x48e844(0x136)+_0xa10c38+_0x48e844(0xf6)),console[_0x48e844(0x15f)](_0x48e844(0x18b),JSON[_0x48e844(0x11b)](_0x177990,null,0x2)),loggerService_1[_0x48e844(0x13a)]['logWhiteDomainResponse'](_0x48e844(0x16e)+_0xa10c38['toLowerCase'](),_0x48e844(0x138),_0x5c7357[_0x48e844(0x141)],_0x177990,_0x4d1aba);if(_0x177990[_0x48e844(0x131)]||_0x177990['statusCode']){const _0x53bd50=_0x177990['message']||_0x177990[_0x48e844(0x131)]||_0x48e844(0x108)+_0xa10c38+'\x20API';console[_0x48e844(0x131)](_0x48e844(0x10c)+_0xa10c38+'\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x48e844(0x131)](_0x48e844(0x16a),_0x53bd50),console[_0x48e844(0x131)](_0x48e844(0x10a),_0x177990[_0x48e844(0x17b)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x48e844(0x16e)+_0xa10c38[_0x48e844(0x109)](),_0x48e844(0x138),'Business\x20Error:\x20'+_0x53bd50);throw new Error(_0x48e844(0xfe)+_0xa10c38+_0x48e844(0x182)+_0x53bd50);}let _0x59256a,_0x13e7ab;if(_0x177990[_0x48e844(0x12d)]&&_0x177990[_0x48e844(0x13e)])_0x59256a=_0x177990['uuid'],_0x13e7ab=_0x177990[_0x48e844(0x13e)],console[_0x48e844(0x15f)](_0x48e844(0x10c)+_0xa10c38+_0x48e844(0x129)),console[_0x48e844(0x15f)](_0x48e844(0x185),_0x177990[_0x48e844(0x12d)]),console['log'](_0x48e844(0x189),_0x177990[_0x48e844(0x13e)]);else{if(_0x177990['authUrl'])_0x59256a=_0x1254f9,_0x13e7ab=_0x177990[_0x48e844(0x12f)],console[_0x48e844(0x15f)]('===\x20KLYME\x20'+_0xa10c38+_0x48e844(0x143)),console[_0x48e844(0x15f)](_0x48e844(0x17e),_0x177990['authUrl']),console[_0x48e844(0x15f)](_0x48e844(0x177),_0x1254f9);else{console[_0x48e844(0x131)]('===\x20KLYME\x20'+_0xa10c38+'\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x48e844(0xf7)),console[_0x48e844(0x131)](_0x48e844(0xf9),_0x177990),loggerService_1[_0x48e844(0x13a)]['logWhiteDomainError']('klyme_'+_0xa10c38[_0x48e844(0x109)](),_0x48e844(0x138),_0x48e844(0x106));throw new Error(_0x48e844(0x178)+_0xa10c38+_0x48e844(0x180));}}return console[_0x48e844(0x15f)]('Currency\x20Used:',_0x3e2a67,'('+_0xa10c38+_0x48e844(0x173)),console[_0x48e844(0x15f)](_0x48e844(0x117),_0x1254f9,'(8digits-8digits\x20format)'),console['log'](_0x48e844(0x144),_0xa10c38),{'gateway_payment_id':_0x59256a,'payment_url':_0x13e7ab};}catch(_0x43a969){console['error'](_0x48e844(0x10c)+_0xa10c38+'\x20SERVICE\x20ERROR\x20==='),console[_0x48e844(0x131)]('Error\x20details:',_0x43a969),loggerService_1[_0x48e844(0x13a)][_0x48e844(0x188)]('klyme_'+_0xa10c38[_0x48e844(0x109)](),_0x48e844(0x138),_0x43a969);if(_0x43a969 instanceof Error){console[_0x48e844(0x131)](_0x48e844(0x170),_0x43a969[_0x48e844(0x103)]),console[_0x48e844(0x131)](_0x48e844(0x12a),_0x43a969[_0x48e844(0x174)]);throw new Error(_0x48e844(0x165)+_0xa10c38+_0x48e844(0x146)+_0x43a969[_0x48e844(0x103)]);}throw new Error(_0x48e844(0x165)+_0xa10c38+_0x48e844(0x16c));}}async[a48_0x87590a(0x154)](_0x89e72b,_0x1633a4){const _0x430db2=a48_0x87590a,_0x3c320e=Date['now']();try{const _0x597b59={'gatewayPaymentId':_0x89e72b,'geo':_0x1633a4};loggerService_1['loggerService'][_0x430db2(0x18a)](_0x430db2(0x16e)+_0x1633a4['toLowerCase'](),_0x430db2(0x10b)+_0x89e72b,'POST',_0x597b59);const _0x8475e3=await fetch(this[_0x430db2(0x160)],{'method':_0x430db2(0x164),'headers':{'Content-Type':_0x430db2(0xfa),'User-Agent':_0x430db2(0xf3)},'body':JSON[_0x430db2(0x11b)](_0x597b59)}),_0x36bb1f=Date[_0x430db2(0x114)]()-_0x3c320e;if(!_0x8475e3['ok']){const _0x38c92e=await _0x8475e3['text']();loggerService_1[_0x430db2(0x13a)][_0x430db2(0x179)](_0x430db2(0x16e)+_0x1633a4[_0x430db2(0x109)](),_0x430db2(0x10b)+_0x89e72b,_0x8475e3[_0x430db2(0x141)],_0x38c92e,_0x36bb1f);throw new Error(_0x430db2(0x13c)+_0x8475e3[_0x430db2(0x141)]);}const _0x28fda8=await _0x8475e3[_0x430db2(0x171)]();loggerService_1['loggerService'][_0x430db2(0x179)](_0x430db2(0x16e)+_0x1633a4[_0x430db2(0x109)](),_0x430db2(0x10b)+_0x89e72b,_0x8475e3['status'],_0x28fda8,_0x36bb1f);if(_0x28fda8[_0x430db2(0x131)]||_0x28fda8[_0x430db2(0x17b)]){loggerService_1['loggerService'][_0x430db2(0x188)](_0x430db2(0x16e)+_0x1633a4[_0x430db2(0x109)](),_0x430db2(0x10b)+_0x89e72b,_0x430db2(0xfe)+_0x1633a4+_0x430db2(0x182)+(_0x28fda8[_0x430db2(0x103)]||_0x28fda8['error']||'Unknown\x20error'));throw new Error(_0x430db2(0xfe)+_0x1633a4+_0x430db2(0x182)+(_0x28fda8[_0x430db2(0x103)]||_0x28fda8[_0x430db2(0x131)]||_0x430db2(0x183)));}let _0x5cbf77=_0x430db2(0xf5);return{'status':_0x5cbf77};}catch(_0x1ea69c){console[_0x430db2(0x131)]('KLYME\x20'+_0x1633a4+_0x430db2(0x107),_0x1ea69c),loggerService_1[_0x430db2(0x13a)][_0x430db2(0x188)]('klyme_'+_0x1633a4[_0x430db2(0x109)](),_0x430db2(0x10b)+_0x89e72b,_0x1ea69c);throw new Error(_0x430db2(0x123)+_0x1633a4+_0x430db2(0x11a)+(_0x1ea69c instanceof Error?_0x1ea69c[_0x430db2(0x103)]:_0x430db2(0x183)));}}async['processWebhook'](_0x9422ef){const _0x50c41f=a48_0x87590a;console[_0x50c41f(0x15f)](_0x50c41f(0x14e),_0x9422ef);let _0x38a088=_0x50c41f(0xf5);switch(_0x9422ef[_0x50c41f(0x141)]?.[_0x50c41f(0x109)]()){case _0x50c41f(0x101):case'completed':case _0x50c41f(0x155):case'success':case _0x50c41f(0x132):_0x38a088=_0x50c41f(0x11d);break;case _0x50c41f(0x186):case _0x50c41f(0x11e):case _0x50c41f(0x167):case _0x50c41f(0x131):case _0x50c41f(0x150):_0x38a088=_0x50c41f(0x161);break;case _0x50c41f(0x130):case _0x50c41f(0x112):_0x38a088=_0x50c41f(0x153);break;case'pending':case _0x50c41f(0x14f):case _0x50c41f(0x176):case'processing':case'in_progress':default:_0x38a088=_0x50c41f(0xf5);break;}return{'paymentId':_0x9422ef[_0x50c41f(0xfb)]||_0x9422ef[_0x50c41f(0x126)]||_0x9422ef[_0x50c41f(0x11f)],'status':_0x38a088,'amount':_0x9422ef[_0x50c41f(0x15b)],'currency':_0x9422ef[_0x50c41f(0x16d)],'region':_0x9422ef[_0x50c41f(0x10e)],'additionalInfo':{'payment_method':_0x9422ef['payment_method'],'transaction_id':_0x9422ef['transaction_id']}};}}exports[a48_0x87590a(0x156)]=KlymeService;