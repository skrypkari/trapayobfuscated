'use strict';const a50_0x97e929=a50_0x467e;(function(_0x504a8e,_0x2d511f){const _0x35848a=a50_0x467e,_0x57b0f2=_0x504a8e();while(!![]){try{const _0x32a842=-parseInt(_0x35848a(0x271))/0x1+-parseInt(_0x35848a(0x207))/0x2*(parseInt(_0x35848a(0x279))/0x3)+parseInt(_0x35848a(0x25d))/0x4+-parseInt(_0x35848a(0x263))/0x5*(-parseInt(_0x35848a(0x275))/0x6)+parseInt(_0x35848a(0x209))/0x7+-parseInt(_0x35848a(0x210))/0x8+-parseInt(_0x35848a(0x257))/0x9;if(_0x32a842===_0x2d511f)break;else _0x57b0f2['push'](_0x57b0f2['shift']());}catch(_0x4556f4){_0x57b0f2['push'](_0x57b0f2['shift']());}}}(a50_0x909a,0xc35c8));var __createBinding=this&&this[a50_0x97e929(0x226)]||(Object[a50_0x97e929(0x27b)]?function(_0x31a80d,_0x5a8aa6,_0x3e7fd3,_0xd686ec){const _0x2b5850=a50_0x97e929;if(_0xd686ec===undefined)_0xd686ec=_0x3e7fd3;var _0x161e18=Object[_0x2b5850(0x20b)](_0x5a8aa6,_0x3e7fd3);(!_0x161e18||(_0x2b5850(0x265)in _0x161e18?!_0x5a8aa6['__esModule']:_0x161e18[_0x2b5850(0x225)]||_0x161e18[_0x2b5850(0x278)]))&&(_0x161e18={'enumerable':!![],'get':function(){return _0x5a8aa6[_0x3e7fd3];}}),Object['defineProperty'](_0x31a80d,_0xd686ec,_0x161e18);}:function(_0x21ead7,_0x58b1a9,_0x3786b6,_0x8d4ecd){if(_0x8d4ecd===undefined)_0x8d4ecd=_0x3786b6;_0x21ead7[_0x8d4ecd]=_0x58b1a9[_0x3786b6];}),__setModuleDefault=this&&this[a50_0x97e929(0x20c)]||(Object[a50_0x97e929(0x27b)]?function(_0x4009ae,_0x465b67){const _0xfe6cf=a50_0x97e929;Object[_0xfe6cf(0x27a)](_0x4009ae,_0xfe6cf(0x24e),{'enumerable':!![],'value':_0x465b67});}:function(_0x47327e,_0x4b2a87){_0x47327e['default']=_0x4b2a87;}),__importStar=this&&this[a50_0x97e929(0x235)]||(function(){var _0x14a818=function(_0x4427a9){return _0x14a818=Object['getOwnPropertyNames']||function(_0x539b37){const _0x344ee7=a50_0x467e;var _0x2f9422=[];for(var _0x1ed36c in _0x539b37)if(Object[_0x344ee7(0x22f)][_0x344ee7(0x285)][_0x344ee7(0x1f4)](_0x539b37,_0x1ed36c))_0x2f9422[_0x2f9422['length']]=_0x1ed36c;return _0x2f9422;},_0x14a818(_0x4427a9);};return function(_0x48025f){const _0x48e517=a50_0x467e;if(_0x48025f&&_0x48025f['__esModule'])return _0x48025f;var _0x5a5d0b={};if(_0x48025f!=null){for(var _0x22a000=_0x14a818(_0x48025f),_0x20ad36=0x0;_0x20ad36<_0x22a000[_0x48e517(0x1ef)];_0x20ad36++)if(_0x22a000[_0x20ad36]!=='default')__createBinding(_0x5a5d0b,_0x48025f,_0x22a000[_0x20ad36]);}return __setModuleDefault(_0x5a5d0b,_0x48025f),_0x5a5d0b;};}());Object[a50_0x97e929(0x27a)](exports,a50_0x97e929(0x249),{'value':!![]}),exports[a50_0x97e929(0x227)]=void 0x0;function a50_0x467e(_0x333d35,_0x113819){const _0x909a27=a50_0x909a();return a50_0x467e=function(_0x467e88,_0x2dc836){_0x467e88=_0x467e88-0x1ed;let _0x195dd4=_0x909a27[_0x467e88];return _0x195dd4;},a50_0x467e(_0x333d35,_0x113819);}const loggerService_1=require(a50_0x97e929(0x1f5));class KlymeService{constructor(){const _0x30ed53=a50_0x97e929;this[_0x30ed53(0x21d)]='https://tesoft.uk/gateway/klyme/',console[_0x30ed53(0x255)](_0x30ed53(0x236));}['validateCurrencyForRegion'](_0x1f1311,_0x1b0f10){const _0x3abf32=a50_0x97e929,_0x553379=_0x1f1311['toUpperCase']();switch(_0x1b0f10){case'EU':if(_0x553379!==_0x3abf32(0x1fc))throw new Error('KLYME\x20EU\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20'+_0x553379);break;case'GB':if(_0x553379!==_0x3abf32(0x231))throw new Error(_0x3abf32(0x268)+_0x553379);break;case'DE':if(_0x553379!==_0x3abf32(0x1fc))throw new Error(_0x3abf32(0x21f)+_0x553379);break;default:throw new Error(_0x3abf32(0x25b)+_0x1b0f10);}}async['generateUniqueReference'](){const _0x123e77=a50_0x97e929,_0x37f299=(await Promise['resolve']()[_0x123e77(0x23d)](()=>__importStar(require(_0x123e77(0x252)))))[_0x123e77(0x24e)];let _0x5e2668,_0x1ffc9e=0x0;const _0x3a4999=0xa;do{const _0x25c381=()=>{const _0x18aaa5=_0x123e77;return Math[_0x18aaa5(0x240)](Math[_0x18aaa5(0x27c)]()*0x5f5e100)[_0x18aaa5(0x247)]()[_0x18aaa5(0x258)](0x8,'0');};_0x5e2668=_0x25c381()+'-'+_0x25c381();const _0x220a6b=await _0x37f299[_0x123e77(0x22e)][_0x123e77(0x228)]({'where':{'gatewayOrderId':_0x5e2668}});if(!_0x220a6b)break;_0x1ffc9e++,console[_0x123e77(0x255)](_0x123e77(0x274)+_0x5e2668+_0x123e77(0x277)+_0x1ffc9e+')');}while(_0x1ffc9e<_0x3a4999);if(_0x1ffc9e>=_0x3a4999)throw new Error(_0x123e77(0x26d));return _0x5e2668;}async['createPaymentLink'](_0x4a9235){const _0x167108=a50_0x97e929,{orderId:_0x5d48ce,amount:_0x2a6fe6,currency:_0x1be51f,region:_0x41aff3}=_0x4a9235;if(_0x41aff3!=='EU'&&_0x41aff3!=='GB'&&_0x41aff3!=='DE')throw new Error(_0x167108(0x1ee)+_0x41aff3);this[_0x167108(0x1ff)](_0x1be51f,_0x41aff3);const _0x94f6b4=_0x1be51f[_0x167108(0x201)]();console['log'](_0x167108(0x219)+_0x41aff3+_0x167108(0x246)+_0x94f6b4);const _0x2e5654=await this[_0x167108(0x21b)]();console[_0x167108(0x255)](_0x167108(0x221)+_0x2e5654+'\x20(8digits-8digits\x20format\x20for\x20'+_0x41aff3+')');const _0x5298e0=_0x167108(0x24f)+_0x5d48ce,_0x36989f={'amount':_0x2a6fe6,'currency':_0x94f6b4,'redirectUrl':_0x5298e0,'reference':_0x2e5654,'geo':_0x41aff3},_0x2d9fc7=Date['now']();try{console[_0x167108(0x255)](_0x167108(0x1ed)+_0x41aff3+_0x167108(0x270)),console[_0x167108(0x255)](_0x167108(0x245),this['apiUrl']),console[_0x167108(0x255)]('Request\x20Body:',JSON[_0x167108(0x241)](_0x36989f,null,0x2)),console[_0x167108(0x255)](_0x167108(0x24d),_0x41aff3),console[_0x167108(0x255)](_0x167108(0x24b),_0x94f6b4,'(validated\x20for\x20'+_0x41aff3+')'),console[_0x167108(0x255)](_0x167108(0x26f),_0x2e5654,'(8digits-8digits\x20format)'),console[_0x167108(0x255)](_0x167108(0x20d),_0x5298e0),loggerService_1[_0x167108(0x280)][_0x167108(0x25f)](_0x167108(0x273)+_0x41aff3[_0x167108(0x212)](),_0x167108(0x237),'POST',_0x36989f);const _0x5ef063=await fetch(this[_0x167108(0x21d)],{'method':_0x167108(0x1fe),'headers':{'Content-Type':_0x167108(0x243),'Accept':_0x167108(0x243),'User-Agent':_0x167108(0x26a)},'body':JSON['stringify'](_0x36989f)}),_0x40247a=Date[_0x167108(0x204)]()-_0x2d9fc7;console[_0x167108(0x255)](_0x167108(0x1ed)+_0x41aff3+_0x167108(0x244)),console[_0x167108(0x255)](_0x167108(0x224),_0x5ef063[_0x167108(0x23b)]),console[_0x167108(0x255)](_0x167108(0x218),_0x5ef063[_0x167108(0x213)]),console[_0x167108(0x255)]('Headers:',Object[_0x167108(0x23e)](_0x5ef063[_0x167108(0x223)]['entries']())),console[_0x167108(0x255)](_0x167108(0x242),_0x40247a+'ms');const _0x56ec1c=await _0x5ef063[_0x167108(0x239)]();console[_0x167108(0x255)](_0x167108(0x208),_0x56ec1c);if(!_0x5ef063['ok']){console['error'](_0x167108(0x1ed)+_0x41aff3+_0x167108(0x282)),console['error']('HTTP\x20Status:',_0x5ef063['status']),console['error'](_0x167108(0x22a),_0x56ec1c),loggerService_1[_0x167108(0x280)]['logWhiteDomainResponse'](_0x167108(0x273)+_0x41aff3[_0x167108(0x212)](),_0x167108(0x237),_0x5ef063['status'],_0x56ec1c,_0x40247a),loggerService_1[_0x167108(0x280)][_0x167108(0x205)]('klyme_'+_0x41aff3[_0x167108(0x212)](),_0x167108(0x237),'HTTP\x20'+_0x5ef063[_0x167108(0x23b)]+':\x20'+_0x56ec1c);throw new Error(_0x167108(0x25e)+_0x5ef063[_0x167108(0x23b)]+',\x20body:\x20'+_0x56ec1c);}let _0x40667b;try{_0x40667b=JSON[_0x167108(0x284)](_0x56ec1c);}catch(_0x2b95da){console[_0x167108(0x281)](_0x167108(0x26b),_0x2b95da),loggerService_1[_0x167108(0x280)][_0x167108(0x205)](_0x167108(0x273)+_0x41aff3[_0x167108(0x212)](),'/create',_0x167108(0x27d)+_0x2b95da);throw new Error(_0x167108(0x22c)+_0x41aff3+_0x167108(0x276)+_0x56ec1c);}console[_0x167108(0x255)](_0x167108(0x269)+_0x41aff3+_0x167108(0x24a)),console['log']('Parsed\x20Result:',JSON[_0x167108(0x241)](_0x40667b,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x167108(0x273)+_0x41aff3[_0x167108(0x212)](),_0x167108(0x237),_0x5ef063[_0x167108(0x23b)],_0x40667b,_0x40247a);if(_0x40667b[_0x167108(0x281)]||_0x40667b[_0x167108(0x260)]){const _0x49e099=_0x40667b[_0x167108(0x26c)]||_0x40667b[_0x167108(0x281)]||'Unknown\x20error\x20from\x20KLYME\x20'+_0x41aff3+_0x167108(0x264);console[_0x167108(0x281)]('===\x20KLYME\x20'+_0x41aff3+_0x167108(0x230)),console['error']('Error\x20Message:',_0x49e099),console[_0x167108(0x281)](_0x167108(0x215),_0x40667b[_0x167108(0x260)]),loggerService_1[_0x167108(0x280)][_0x167108(0x205)]('klyme_'+_0x41aff3['toLowerCase'](),'/create',_0x167108(0x220)+_0x49e099);throw new Error(_0x167108(0x229)+_0x41aff3+_0x167108(0x1f0)+_0x49e099);}let _0x2f886c,_0x2f3710;if(_0x40667b[_0x167108(0x20e)]&&_0x40667b[_0x167108(0x262)])_0x2f886c=_0x40667b[_0x167108(0x20e)],_0x2f3710=_0x40667b[_0x167108(0x262)],console[_0x167108(0x255)](_0x167108(0x1ed)+_0x41aff3+_0x167108(0x267)),console[_0x167108(0x255)](_0x167108(0x24c),_0x40667b[_0x167108(0x20e)]),console[_0x167108(0x255)](_0x167108(0x20d),_0x40667b[_0x167108(0x262)]);else{if(_0x40667b[_0x167108(0x23a)])_0x2f886c=_0x2e5654,_0x2f3710=_0x40667b[_0x167108(0x23a)],console['log'](_0x167108(0x1ed)+_0x41aff3+_0x167108(0x216)),console[_0x167108(0x255)](_0x167108(0x283),_0x40667b[_0x167108(0x23a)]),console[_0x167108(0x255)](_0x167108(0x1fb),_0x2e5654);else{console['error'](_0x167108(0x1ed)+_0x41aff3+_0x167108(0x26e)),console['error'](_0x167108(0x254)),console['error']('Response\x20data:',_0x40667b),loggerService_1[_0x167108(0x280)][_0x167108(0x205)]('klyme_'+_0x41aff3[_0x167108(0x212)](),_0x167108(0x237),_0x167108(0x23c));throw new Error('Invalid\x20response\x20from\x20KLYME\x20'+_0x41aff3+_0x167108(0x256));}}return console[_0x167108(0x255)](_0x167108(0x20f),_0x94f6b4,'('+_0x41aff3+_0x167108(0x261)),console[_0x167108(0x255)]('Reference\x20Used:',_0x2e5654,_0x167108(0x259)),console[_0x167108(0x255)]('Geo\x20Parameter:',_0x41aff3),{'gateway_payment_id':_0x2f886c,'payment_url':_0x2f3710};}catch(_0x35688e){console[_0x167108(0x281)]('===\x20KLYME\x20'+_0x41aff3+_0x167108(0x27f)),console['error'](_0x167108(0x1f8),_0x35688e),loggerService_1[_0x167108(0x280)]['logWhiteDomainError']('klyme_'+_0x41aff3['toLowerCase'](),_0x167108(0x237),_0x35688e);if(_0x35688e instanceof Error){console['error']('Error\x20message:',_0x35688e['message']),console[_0x167108(0x281)](_0x167108(0x22d),_0x35688e[_0x167108(0x206)]);throw new Error(_0x167108(0x286)+_0x41aff3+_0x167108(0x21a)+_0x35688e['message']);}throw new Error(_0x167108(0x286)+_0x41aff3+_0x167108(0x27e));}}async[a50_0x97e929(0x21e)](_0x56a217,_0x1d309f){const _0x587e84=a50_0x97e929,_0x12a98f=Date[_0x587e84(0x204)]();try{const _0x56fb99={'gatewayPaymentId':_0x56a217,'geo':_0x1d309f};loggerService_1[_0x587e84(0x280)]['logWhiteDomainRequest'](_0x587e84(0x273)+_0x1d309f[_0x587e84(0x212)](),_0x587e84(0x253)+_0x56a217,_0x587e84(0x1fe),_0x56fb99);const _0x535105=await fetch(this['apiUrl'],{'method':_0x587e84(0x1fe),'headers':{'Content-Type':'application/json','User-Agent':_0x587e84(0x26a)},'body':JSON[_0x587e84(0x241)](_0x56fb99)}),_0x4167dd=Date[_0x587e84(0x204)]()-_0x12a98f;if(!_0x535105['ok']){const _0x1443cd=await _0x535105['text']();loggerService_1[_0x587e84(0x280)]['logWhiteDomainResponse']('klyme_'+_0x1d309f['toLowerCase'](),_0x587e84(0x253)+_0x56a217,_0x535105['status'],_0x1443cd,_0x4167dd);throw new Error(_0x587e84(0x25e)+_0x535105[_0x587e84(0x23b)]);}const _0x14e150=await _0x535105[_0x587e84(0x234)]();loggerService_1[_0x587e84(0x280)][_0x587e84(0x22b)](_0x587e84(0x273)+_0x1d309f[_0x587e84(0x212)](),'/verify/'+_0x56a217,_0x535105[_0x587e84(0x23b)],_0x14e150,_0x4167dd);if(_0x14e150['error']||_0x14e150[_0x587e84(0x260)]){loggerService_1[_0x587e84(0x280)]['logWhiteDomainError'](_0x587e84(0x273)+_0x1d309f[_0x587e84(0x212)](),_0x587e84(0x253)+_0x56a217,'KLYME\x20'+_0x1d309f+_0x587e84(0x1f0)+(_0x14e150[_0x587e84(0x26c)]||_0x14e150[_0x587e84(0x281)]||_0x587e84(0x214)));throw new Error('KLYME\x20'+_0x1d309f+_0x587e84(0x1f0)+(_0x14e150[_0x587e84(0x26c)]||_0x14e150[_0x587e84(0x281)]||_0x587e84(0x214)));}let _0x1c66a8=_0x587e84(0x248);return{'status':_0x1c66a8};}catch(_0x1405a3){console[_0x587e84(0x281)](_0x587e84(0x229)+_0x1d309f+_0x587e84(0x25c),_0x1405a3),loggerService_1['loggerService'][_0x587e84(0x205)](_0x587e84(0x273)+_0x1d309f[_0x587e84(0x212)](),'/verify/'+_0x56a217,_0x1405a3);throw new Error(_0x587e84(0x23f)+_0x1d309f+_0x587e84(0x1f2)+(_0x1405a3 instanceof Error?_0x1405a3[_0x587e84(0x26c)]:_0x587e84(0x214)));}}async[a50_0x97e929(0x1f9)](_0x242bb2){const _0x75159b=a50_0x97e929;console[_0x75159b(0x255)](_0x75159b(0x1f3),_0x242bb2);let _0x15a755=_0x75159b(0x248);switch(_0x242bb2[_0x75159b(0x23b)]?.[_0x75159b(0x212)]()){case _0x75159b(0x1f1):case'completed':case _0x75159b(0x217):case'success':case _0x75159b(0x1fa):_0x15a755=_0x75159b(0x203);break;case _0x75159b(0x233):case _0x75159b(0x21c):case _0x75159b(0x232):case _0x75159b(0x281):case _0x75159b(0x202):_0x15a755=_0x75159b(0x250);break;case _0x75159b(0x20a):case _0x75159b(0x200):_0x15a755=_0x75159b(0x251);break;case'pending':case _0x75159b(0x211):case _0x75159b(0x238):case'processing':case _0x75159b(0x1f7):default:_0x15a755='PENDING';break;}return{'paymentId':_0x242bb2[_0x75159b(0x272)]||_0x242bb2[_0x75159b(0x25a)]||_0x242bb2[_0x75159b(0x1fd)],'status':_0x15a755,'amount':_0x242bb2['amount'],'currency':_0x242bb2[_0x75159b(0x266)],'region':_0x242bb2['region'],'additionalInfo':{'payment_method':_0x242bb2[_0x75159b(0x222)],'transaction_id':_0x242bb2[_0x75159b(0x1f6)]}};}}exports['KlymeService']=KlymeService;function a50_0x909a(){const _0x352a5b=['getOwnPropertyDescriptor','__setModuleDefault','Redirect\x20URL:','uuid','Currency\x20Used:','9695048YtLBpQ','created','toLowerCase','statusText','Unknown\x20error','Status\x20Code:','\x20SUCCESS\x20(Legacy\x20Format)\x20===','confirmed','Status\x20Text:','💳\x20KLYME\x20','\x20payment\x20link:\x20','generateUniqueReference','canceled','apiUrl','verifyPayment','KLYME\x20DE\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20','Business\x20Error:\x20','🎯\x20Generated\x20unique\x20KLYME\x20reference:\x20','payment_method','headers','Status:','writable','__createBinding','KlymeService','findFirst','KLYME\x20','Response\x20Body:','logWhiteDomainResponse','Invalid\x20JSON\x20response\x20from\x20KLYME\x20','Error\x20stack:','payment','prototype','\x20API\x20BUSINESS\x20ERROR\x20===','GBP','failed','cancelled','json','__importStar','💳\x20KLYME\x20service\x20initialized\x20with\x20unified\x20white\x20domain\x20proxy\x20for\x20all\x20regions','/create','active','text','authUrl','status','Incomplete\x20response:\x20missing\x20uuid/redirect_url\x20or\x20authUrl','then','fromEntries','Failed\x20to\x20verify\x20KLYME\x20','floor','stringify','Response\x20Time:','application/json','\x20API\x20RESPONSE\x20(Unified\x20Route)\x20===','URL:','\x20currency\x20validation\x20passed:\x20','toString','PENDING','__esModule','\x20RESPONSE\x20===','Currency:','UUID:','Region\x20(geo):','default','https://tesoft.uk/gateway/pending.php?id=','FAILED','EXPIRED','../../config/database','/verify/','Missing\x20uuid/redirect_url\x20or\x20authUrl\x20in\x20response','log','\x20API:\x20missing\x20payment\x20data','433647WpBcwJ','padStart','(8digits-8digits\x20format)','order_id','Unsupported\x20KLYME\x20region:\x20','\x20payment\x20verification\x20error:','4008800JKaVju','HTTP\x20error!\x20status:\x20','logWhiteDomainRequest','statusCode','\x20validated)','redirect_url','32545nRpxAB','\x20API','get','currency','\x20SUCCESS\x20(New\x20Format)\x20===','KLYME\x20GB\x20accepts\x20only\x20GBP\x20currency,\x20got:\x20','===\x20PARSED\x20KLYME\x20','Payment\x20System/1.0','Failed\x20to\x20parse\x20JSON\x20response:','message','Failed\x20to\x20generate\x20unique\x20KLYME\x20reference\x20after\x20maximum\x20attempts','\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Reference:','\x20API\x20REQUEST\x20(Unified\x20Route\x20with\x20Geo)\x20===','285208sjLGKe','reference','klyme_','⚠️\x20KLYME\x20reference\x20','654xTIMNX','\x20API:\x20','\x20already\x20exists,\x20generating\x20new\x20one\x20(attempt\x20','configurable','6aoeTlQ','defineProperty','create','random','JSON\x20Parse\x20Error:\x20','\x20payment\x20link:\x20Unknown\x20error','\x20SERVICE\x20ERROR\x20===','loggerService','error','\x20API\x20ERROR\x20===','Auth\x20URL:','parse','hasOwnProperty','Failed\x20to\x20create\x20KLYME\x20','===\x20KLYME\x20','KLYME\x20payment\x20creation\x20is\x20supported\x20for\x20EU,\x20GB\x20and\x20DE\x20regions,\x20got:\x20','length','\x20API\x20error:\x20','paid','\x20payment:\x20','Processing\x20KLYME\x20webhook:','call','../loggerService','transaction_id','in_progress','Error\x20details:','processWebhook','successful','Reference\x20Used\x20as\x20ID:','EUR','payment_id','POST','validateCurrencyForRegion','timeout','toUpperCase','rejected','PAID','now','logWhiteDomainError','stack','373778CQRfNZ','Raw\x20Response\x20Body:','7052983HxMPah','expired'];a50_0x909a=function(){return _0x352a5b;};return a50_0x909a();}