'use strict';const a42_0x3ddbd5=a42_0x4863;(function(_0x892c5c,_0x3411a8){const _0x1190b6=a42_0x4863,_0x576353=_0x892c5c();while(!![]){try{const _0x52ef8a=-parseInt(_0x1190b6(0x170))/0x1*(-parseInt(_0x1190b6(0x11d))/0x2)+-parseInt(_0x1190b6(0x1ac))/0x3+parseInt(_0x1190b6(0x155))/0x4+-parseInt(_0x1190b6(0x191))/0x5+parseInt(_0x1190b6(0x1ae))/0x6*(parseInt(_0x1190b6(0x1b0))/0x7)+parseInt(_0x1190b6(0x1a4))/0x8*(-parseInt(_0x1190b6(0x19f))/0x9)+parseInt(_0x1190b6(0x188))/0xa*(parseInt(_0x1190b6(0x13c))/0xb);if(_0x52ef8a===_0x3411a8)break;else _0x576353['push'](_0x576353['shift']());}catch(_0x280fe9){_0x576353['push'](_0x576353['shift']());}}}(a42_0x5091,0x414e3));var __createBinding=this&&this[a42_0x3ddbd5(0x12d)]||(Object['create']?function(_0x4825dc,_0x210544,_0x51434f,_0xf8a566){const _0xa1cc2b=a42_0x3ddbd5;if(_0xf8a566===undefined)_0xf8a566=_0x51434f;var _0x2a278f=Object[_0xa1cc2b(0x1aa)](_0x210544,_0x51434f);(!_0x2a278f||(_0xa1cc2b(0x118)in _0x2a278f?!_0x210544[_0xa1cc2b(0x146)]:_0x2a278f[_0xa1cc2b(0x148)]||_0x2a278f[_0xa1cc2b(0x11a)]))&&(_0x2a278f={'enumerable':!![],'get':function(){return _0x210544[_0x51434f];}}),Object[_0xa1cc2b(0x152)](_0x4825dc,_0xf8a566,_0x2a278f);}:function(_0x56dfeb,_0x29dc0a,_0x299ca1,_0x26f3ce){if(_0x26f3ce===undefined)_0x26f3ce=_0x299ca1;_0x56dfeb[_0x26f3ce]=_0x29dc0a[_0x299ca1];}),__setModuleDefault=this&&this[a42_0x3ddbd5(0x11c)]||(Object[a42_0x3ddbd5(0x140)]?function(_0x5ae5d3,_0x3c0a22){const _0x4bbc00=a42_0x3ddbd5;Object[_0x4bbc00(0x152)](_0x5ae5d3,_0x4bbc00(0x141),{'enumerable':!![],'value':_0x3c0a22});}:function(_0x1f25f2,_0x4f3754){const _0x22b6c8=a42_0x3ddbd5;_0x1f25f2[_0x22b6c8(0x141)]=_0x4f3754;}),__importStar=this&&this['__importStar']||(function(){var _0x2d6b6b=function(_0x2fdb21){return _0x2d6b6b=Object['getOwnPropertyNames']||function(_0x2ba390){const _0x52d770=a42_0x4863;var _0x3085bf=[];for(var _0x6553a6 in _0x2ba390)if(Object[_0x52d770(0x1a3)][_0x52d770(0x134)][_0x52d770(0x198)](_0x2ba390,_0x6553a6))_0x3085bf[_0x3085bf['length']]=_0x6553a6;return _0x3085bf;},_0x2d6b6b(_0x2fdb21);};return function(_0x50292c){const _0x397885=a42_0x4863;if(_0x50292c&&_0x50292c[_0x397885(0x146)])return _0x50292c;var _0x20879f={};if(_0x50292c!=null){for(var _0x2be2b9=_0x2d6b6b(_0x50292c),_0x35b486=0x0;_0x35b486<_0x2be2b9[_0x397885(0x11e)];_0x35b486++)if(_0x2be2b9[_0x35b486]!==_0x397885(0x141))__createBinding(_0x20879f,_0x50292c,_0x2be2b9[_0x35b486]);}return __setModuleDefault(_0x20879f,_0x50292c),_0x20879f;};}());Object[a42_0x3ddbd5(0x152)](exports,'__esModule',{'value':!![]}),exports['KlymeService']=void 0x0;const loggerService_1=require('../loggerService');class KlymeService{constructor(){const _0x13d9af=a42_0x3ddbd5;this['apiUrl']=_0x13d9af(0x18a),console[_0x13d9af(0x161)](_0x13d9af(0x12c));}[a42_0x3ddbd5(0x18e)](_0x50a1f2,_0x103700){const _0x5a045c=a42_0x3ddbd5,_0x218fa2=_0x50a1f2['toUpperCase']();switch(_0x103700){case'EU':if(_0x218fa2!==_0x5a045c(0x139))throw new Error(_0x5a045c(0x1a5)+_0x218fa2);break;case'GB':if(_0x218fa2!==_0x5a045c(0x168))throw new Error(_0x5a045c(0x1ad)+_0x218fa2);break;case'DE':if(_0x218fa2!==_0x5a045c(0x139))throw new Error('KLYME\x20DE\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20'+_0x218fa2);break;default:throw new Error(_0x5a045c(0x157)+_0x103700);}}async['generateUniqueReference'](){const _0xac2990=a42_0x3ddbd5,_0x5dcd3b=(await Promise[_0xac2990(0x16c)]()[_0xac2990(0x138)](()=>__importStar(require(_0xac2990(0x19b)))))[_0xac2990(0x141)];let _0x3c4dde,_0x3ad8e0=0x0;const _0x5d2ff4=0xa;do{const _0x3f1fea=()=>{const _0x22ea40=_0xac2990;return Math[_0x22ea40(0x129)](Math[_0x22ea40(0x13e)]()*0x5f5e100)[_0x22ea40(0x1af)]()[_0x22ea40(0x1a8)](0x8,'0');};_0x3c4dde=_0x3f1fea()+'-'+_0x3f1fea();const _0x53bc60=await _0x5dcd3b[_0xac2990(0x142)]['findFirst']({'where':{'gatewayOrderId':_0x3c4dde}});if(!_0x53bc60)break;_0x3ad8e0++,console[_0xac2990(0x161)](_0xac2990(0x147)+_0x3c4dde+_0xac2990(0x18c)+_0x3ad8e0+')');}while(_0x3ad8e0<_0x5d2ff4);if(_0x3ad8e0>=_0x5d2ff4)throw new Error('Failed\x20to\x20generate\x20unique\x20KLYME\x20reference\x20after\x20maximum\x20attempts');return _0x3c4dde;}async[a42_0x3ddbd5(0x14e)](_0x31679f){const _0x23e01a=a42_0x3ddbd5,{orderId:_0x5da128,amount:_0x3f043d,currency:_0x551b71,region:_0x268306}=_0x31679f;if(_0x268306!=='EU'&&_0x268306!=='GB'&&_0x268306!=='DE')throw new Error(_0x23e01a(0x150)+_0x268306);this['validateCurrencyForRegion'](_0x551b71,_0x268306);const _0x25c3c6=_0x551b71[_0x23e01a(0x130)]();console['log']('💳\x20KLYME\x20'+_0x268306+_0x23e01a(0x199)+_0x25c3c6);const _0x4a220f=await this['generateUniqueReference']();console[_0x23e01a(0x161)](_0x23e01a(0x15a)+_0x4a220f+_0x23e01a(0x127)+_0x268306+')');const _0x5863af=_0x23e01a(0x172)+_0x5da128,_0x2f8996={'amount':_0x3f043d,'currency':_0x25c3c6,'redirectUrl':_0x5863af,'reference':_0x4a220f,'geo':_0x268306},_0x161582=Date[_0x23e01a(0x178)]();try{console[_0x23e01a(0x161)](_0x23e01a(0x162)+_0x268306+_0x23e01a(0x136)),console[_0x23e01a(0x161)](_0x23e01a(0x173),this[_0x23e01a(0x13d)]),console[_0x23e01a(0x161)](_0x23e01a(0x126),JSON[_0x23e01a(0x137)](_0x2f8996,null,0x2)),console[_0x23e01a(0x161)](_0x23e01a(0x1a0),_0x268306),console[_0x23e01a(0x161)](_0x23e01a(0x17f),_0x25c3c6,_0x23e01a(0x16e)+_0x268306+')'),console[_0x23e01a(0x161)]('Reference:',_0x4a220f,_0x23e01a(0x185)),console[_0x23e01a(0x161)]('Redirect\x20URL:',_0x5863af),loggerService_1[_0x23e01a(0x120)][_0x23e01a(0x186)](_0x23e01a(0x135)+_0x268306[_0x23e01a(0x119)](),_0x23e01a(0x14b),_0x23e01a(0x19a),_0x2f8996);const _0x3e6241=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x23e01a(0x1a1),'Accept':_0x23e01a(0x1a1),'User-Agent':_0x23e01a(0x19d)},'body':JSON['stringify'](_0x2f8996)}),_0xf5b3e=Date['now']()-_0x161582;console['log'](_0x23e01a(0x162)+_0x268306+_0x23e01a(0x156)),console[_0x23e01a(0x161)](_0x23e01a(0x149),_0x3e6241[_0x23e01a(0x164)]),console[_0x23e01a(0x161)](_0x23e01a(0x15d),_0x3e6241['statusText']),console[_0x23e01a(0x161)](_0x23e01a(0x117),Object[_0x23e01a(0x1a7)](_0x3e6241[_0x23e01a(0x166)]['entries']())),console['log'](_0x23e01a(0x1a6),_0xf5b3e+'ms');const _0x4c0d85=await _0x3e6241[_0x23e01a(0x16d)]();console['log'](_0x23e01a(0x12f),_0x4c0d85);if(!_0x3e6241['ok']){console[_0x23e01a(0x124)](_0x23e01a(0x162)+_0x268306+_0x23e01a(0x12a)),console[_0x23e01a(0x124)]('HTTP\x20Status:',_0x3e6241[_0x23e01a(0x164)]),console[_0x23e01a(0x124)]('Response\x20Body:',_0x4c0d85),loggerService_1[_0x23e01a(0x120)][_0x23e01a(0x1ab)](_0x23e01a(0x135)+_0x268306[_0x23e01a(0x119)](),_0x23e01a(0x14b),_0x3e6241[_0x23e01a(0x164)],_0x4c0d85,_0xf5b3e),loggerService_1['loggerService'][_0x23e01a(0x13f)](_0x23e01a(0x135)+_0x268306[_0x23e01a(0x119)](),_0x23e01a(0x14b),_0x23e01a(0x189)+_0x3e6241[_0x23e01a(0x164)]+':\x20'+_0x4c0d85);throw new Error(_0x23e01a(0x194)+_0x3e6241[_0x23e01a(0x164)]+_0x23e01a(0x15c)+_0x4c0d85);}let _0x28e058;try{_0x28e058=JSON[_0x23e01a(0x175)](_0x4c0d85);}catch(_0x108208){console[_0x23e01a(0x124)](_0x23e01a(0x16a),_0x108208),loggerService_1[_0x23e01a(0x120)]['logWhiteDomainError'](_0x23e01a(0x135)+_0x268306[_0x23e01a(0x119)](),_0x23e01a(0x14b),_0x23e01a(0x121)+_0x108208);throw new Error(_0x23e01a(0x17e)+_0x268306+_0x23e01a(0x180)+_0x4c0d85);}console[_0x23e01a(0x161)]('===\x20PARSED\x20KLYME\x20'+_0x268306+_0x23e01a(0x195)),console[_0x23e01a(0x161)](_0x23e01a(0x17d),JSON[_0x23e01a(0x137)](_0x28e058,null,0x2)),loggerService_1[_0x23e01a(0x120)][_0x23e01a(0x1ab)](_0x23e01a(0x135)+_0x268306[_0x23e01a(0x119)](),_0x23e01a(0x14b),_0x3e6241['status'],_0x28e058,_0xf5b3e);if(_0x28e058[_0x23e01a(0x124)]||_0x28e058[_0x23e01a(0x154)]){const _0x2a619b=_0x28e058[_0x23e01a(0x159)]||_0x28e058['error']||'Unknown\x20error\x20from\x20KLYME\x20'+_0x268306+_0x23e01a(0x133);console[_0x23e01a(0x124)](_0x23e01a(0x162)+_0x268306+_0x23e01a(0x18b)),console['error']('Error\x20Message:',_0x2a619b),console[_0x23e01a(0x124)](_0x23e01a(0x128),_0x28e058[_0x23e01a(0x154)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x23e01a(0x135)+_0x268306[_0x23e01a(0x119)](),_0x23e01a(0x14b),_0x23e01a(0x192)+_0x2a619b);throw new Error(_0x23e01a(0x171)+_0x268306+_0x23e01a(0x184)+_0x2a619b);}let _0x32543c,_0x2da6c3;if(_0x28e058['uuid']&&_0x28e058[_0x23e01a(0x12b)])_0x32543c=_0x28e058['uuid'],_0x2da6c3=_0x28e058[_0x23e01a(0x12b)],console['log'](_0x23e01a(0x162)+_0x268306+'\x20SUCCESS\x20(New\x20Format)\x20==='),console[_0x23e01a(0x161)](_0x23e01a(0x14d),_0x28e058['uuid']),console[_0x23e01a(0x161)](_0x23e01a(0x14a),_0x28e058[_0x23e01a(0x12b)]);else{if(_0x28e058[_0x23e01a(0x19c)])_0x32543c=_0x4a220f,_0x2da6c3=_0x28e058[_0x23e01a(0x19c)],console[_0x23e01a(0x161)](_0x23e01a(0x162)+_0x268306+_0x23e01a(0x1a2)),console[_0x23e01a(0x161)](_0x23e01a(0x14f),_0x28e058['authUrl']),console[_0x23e01a(0x161)]('Reference\x20Used\x20as\x20ID:',_0x4a220f);else{console[_0x23e01a(0x124)](_0x23e01a(0x162)+_0x268306+_0x23e01a(0x17c)),console[_0x23e01a(0x124)](_0x23e01a(0x176)),console['error'](_0x23e01a(0x11b),_0x28e058),loggerService_1[_0x23e01a(0x120)][_0x23e01a(0x13f)](_0x23e01a(0x135)+_0x268306[_0x23e01a(0x119)](),_0x23e01a(0x14b),_0x23e01a(0x11f));throw new Error(_0x23e01a(0x177)+_0x268306+'\x20API:\x20missing\x20payment\x20data');}}return console[_0x23e01a(0x161)](_0x23e01a(0x144),_0x25c3c6,'('+_0x268306+_0x23e01a(0x153)),console['log'](_0x23e01a(0x158),_0x4a220f,_0x23e01a(0x185)),console[_0x23e01a(0x161)]('Geo\x20Parameter:',_0x268306),{'gateway_payment_id':_0x32543c,'payment_url':_0x2da6c3};}catch(_0x309b27){console['error'](_0x23e01a(0x162)+_0x268306+_0x23e01a(0x17b)),console[_0x23e01a(0x124)](_0x23e01a(0x15e),_0x309b27),loggerService_1[_0x23e01a(0x120)]['logWhiteDomainError']('klyme_'+_0x268306['toLowerCase'](),_0x23e01a(0x14b),_0x309b27);if(_0x309b27 instanceof Error){console['error'](_0x23e01a(0x151),_0x309b27[_0x23e01a(0x159)]),console[_0x23e01a(0x124)](_0x23e01a(0x15b),_0x309b27[_0x23e01a(0x13b)]);throw new Error(_0x23e01a(0x131)+_0x268306+_0x23e01a(0x179)+_0x309b27[_0x23e01a(0x159)]);}throw new Error(_0x23e01a(0x131)+_0x268306+_0x23e01a(0x196));}}async[a42_0x3ddbd5(0x18d)](_0x11ee05,_0x470171){const _0x51f958=a42_0x3ddbd5,_0x590085=Date[_0x51f958(0x178)]();try{const _0x4d1bc1={'gatewayPaymentId':_0x11ee05,'geo':_0x470171};loggerService_1[_0x51f958(0x120)][_0x51f958(0x186)](_0x51f958(0x135)+_0x470171['toLowerCase'](),_0x51f958(0x1b1)+_0x11ee05,_0x51f958(0x19a),_0x4d1bc1);const _0x321fb9=await fetch(this['apiUrl'],{'method':_0x51f958(0x19a),'headers':{'Content-Type':'application/json','User-Agent':_0x51f958(0x19d)},'body':JSON['stringify'](_0x4d1bc1)}),_0x105073=Date[_0x51f958(0x178)]()-_0x590085;if(!_0x321fb9['ok']){const _0x6aea24=await _0x321fb9[_0x51f958(0x16d)]();loggerService_1['loggerService'][_0x51f958(0x1ab)](_0x51f958(0x135)+_0x470171[_0x51f958(0x119)](),'/verify/'+_0x11ee05,_0x321fb9[_0x51f958(0x164)],_0x6aea24,_0x105073);throw new Error(_0x51f958(0x194)+_0x321fb9[_0x51f958(0x164)]);}const _0x1d0cc8=await _0x321fb9[_0x51f958(0x143)]();loggerService_1[_0x51f958(0x120)][_0x51f958(0x1ab)](_0x51f958(0x135)+_0x470171[_0x51f958(0x119)](),'/verify/'+_0x11ee05,_0x321fb9[_0x51f958(0x164)],_0x1d0cc8,_0x105073);if(_0x1d0cc8[_0x51f958(0x124)]||_0x1d0cc8['statusCode']){loggerService_1[_0x51f958(0x120)]['logWhiteDomainError'](_0x51f958(0x135)+_0x470171[_0x51f958(0x119)](),_0x51f958(0x1b1)+_0x11ee05,'KLYME\x20'+_0x470171+_0x51f958(0x184)+(_0x1d0cc8[_0x51f958(0x159)]||_0x1d0cc8['error']||_0x51f958(0x132)));throw new Error(_0x51f958(0x171)+_0x470171+'\x20API\x20error:\x20'+(_0x1d0cc8[_0x51f958(0x159)]||_0x1d0cc8[_0x51f958(0x124)]||'Unknown\x20error'));}let _0x1e3b9e=_0x51f958(0x187);return{'status':_0x1e3b9e};}catch(_0x38526b){console['error'](_0x51f958(0x171)+_0x470171+'\x20payment\x20verification\x20error:',_0x38526b),loggerService_1[_0x51f958(0x120)][_0x51f958(0x13f)](_0x51f958(0x135)+_0x470171['toLowerCase'](),_0x51f958(0x1b1)+_0x11ee05,_0x38526b);throw new Error(_0x51f958(0x160)+_0x470171+_0x51f958(0x16b)+(_0x38526b instanceof Error?_0x38526b[_0x51f958(0x159)]:_0x51f958(0x132)));}}async[a42_0x3ddbd5(0x190)](_0x44657a){const _0x41d357=a42_0x3ddbd5;console['log'](_0x41d357(0x14c),_0x44657a);let _0x698929='PENDING';switch(_0x44657a[_0x41d357(0x164)]?.[_0x41d357(0x119)]()){case _0x41d357(0x1a9):case _0x41d357(0x174):case _0x41d357(0x197):case _0x41d357(0x181):case'successful':_0x698929='PAID';break;case _0x41d357(0x18f):case _0x41d357(0x19e):case _0x41d357(0x122):case _0x41d357(0x124):case _0x41d357(0x145):_0x698929=_0x41d357(0x16f);break;case _0x41d357(0x17a):case _0x41d357(0x165):_0x698929=_0x41d357(0x167);break;case _0x41d357(0x13a):case _0x41d357(0x15f):case'active':case'processing':case _0x41d357(0x12e):default:_0x698929=_0x41d357(0x187);break;}return{'paymentId':_0x44657a[_0x41d357(0x193)]||_0x44657a[_0x41d357(0x123)]||_0x44657a['payment_id'],'status':_0x698929,'amount':_0x44657a['amount'],'currency':_0x44657a[_0x41d357(0x169)],'region':_0x44657a[_0x41d357(0x183)],'additionalInfo':{'payment_method':_0x44657a[_0x41d357(0x163)],'transaction_id':_0x44657a[_0x41d357(0x182)]}};}}function a42_0x5091(){const _0x278fcb=['configurable','Response\x20data:','__setModuleDefault','34muKPup','length','Incomplete\x20response:\x20missing\x20uuid/redirect_url\x20or\x20authUrl','loggerService','JSON\x20Parse\x20Error:\x20','failed','order_id','error','KlymeService','Request\x20Body:','\x20(8digits-8digits\x20format\x20for\x20','Status\x20Code:','floor','\x20API\x20ERROR\x20===','redirect_url','💳\x20KLYME\x20service\x20initialized\x20with\x20unified\x20white\x20domain\x20proxy\x20for\x20all\x20regions','__createBinding','in_progress','Raw\x20Response\x20Body:','toUpperCase','Failed\x20to\x20create\x20KLYME\x20','Unknown\x20error','\x20API','hasOwnProperty','klyme_','\x20API\x20REQUEST\x20(Unified\x20Route\x20with\x20Geo)\x20===','stringify','then','EUR','pending','stack','22pjrIjP','apiUrl','random','logWhiteDomainError','create','default','payment','json','Currency\x20Used:','rejected','__esModule','⚠️\x20KLYME\x20reference\x20','writable','Status:','Redirect\x20URL:','/create','Processing\x20KLYME\x20webhook:','UUID:','createPaymentLink','Auth\x20URL:','KLYME\x20payment\x20creation\x20is\x20supported\x20for\x20EU,\x20GB\x20and\x20DE\x20regions,\x20got:\x20','Error\x20message:','defineProperty','\x20validated)','statusCode','296684XMweSP','\x20API\x20RESPONSE\x20(Unified\x20Route)\x20===','Unsupported\x20KLYME\x20region:\x20','Reference\x20Used:','message','🎯\x20Generated\x20unique\x20KLYME\x20reference:\x20','Error\x20stack:',',\x20body:\x20','Status\x20Text:','Error\x20details:','created','Failed\x20to\x20verify\x20KLYME\x20','log','===\x20KLYME\x20','payment_method','status','timeout','headers','EXPIRED','GBP','currency','Failed\x20to\x20parse\x20JSON\x20response:','\x20payment:\x20','resolve','text','(validated\x20for\x20','FAILED','25118jzkHXT','KLYME\x20','https://tesoft.uk/gateway/pending.php?id=','URL:','completed','parse','Missing\x20uuid/redirect_url\x20or\x20authUrl\x20in\x20response','Invalid\x20response\x20from\x20KLYME\x20','now','\x20payment\x20link:\x20','expired','\x20SERVICE\x20ERROR\x20===','\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Parsed\x20Result:','Invalid\x20JSON\x20response\x20from\x20KLYME\x20','Currency:','\x20API:\x20','success','transaction_id','region','\x20API\x20error:\x20','(8digits-8digits\x20format)','logWhiteDomainRequest','PENDING','3125610khdswh','HTTP\x20','https://tesoft.uk/gateway/klyme/','\x20API\x20BUSINESS\x20ERROR\x20===','\x20already\x20exists,\x20generating\x20new\x20one\x20(attempt\x20','verifyPayment','validateCurrencyForRegion','cancelled','processWebhook','2026480onRcgV','Business\x20Error:\x20','reference','HTTP\x20error!\x20status:\x20','\x20RESPONSE\x20===','\x20payment\x20link:\x20Unknown\x20error','confirmed','call','\x20currency\x20validation\x20passed:\x20','POST','../../config/database','authUrl','TesSoft\x20Payment\x20System/1.0','canceled','18acKPDm','Region\x20(geo):','application/json','\x20SUCCESS\x20(Legacy\x20Format)\x20===','prototype','1540696KtwvZG','KLYME\x20EU\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20','Response\x20Time:','fromEntries','padStart','paid','getOwnPropertyDescriptor','logWhiteDomainResponse','951840XORzMw','KLYME\x20GB\x20accepts\x20only\x20GBP\x20currency,\x20got:\x20','12pbQUTN','toString','871297NxZJOh','/verify/','Headers:','get','toLowerCase'];a42_0x5091=function(){return _0x278fcb;};return a42_0x5091();}function a42_0x4863(_0x383e95,_0x51dddb){const _0x509197=a42_0x5091();return a42_0x4863=function(_0x4863f0,_0x449f46){_0x4863f0=_0x4863f0-0x117;let _0xdcf721=_0x509197[_0x4863f0];return _0xdcf721;},a42_0x4863(_0x383e95,_0x51dddb);}exports[a42_0x3ddbd5(0x125)]=KlymeService;