'use strict';const a59_0x3203f7=a59_0x5463;function a59_0x5463(_0x11a257,_0x511fc6){_0x11a257=_0x11a257-0xab;const _0x589f4b=a59_0x589f();let _0x5463cb=_0x589f4b[_0x11a257];return _0x5463cb;}(function(_0x594786,_0x167836){const _0x5f4185=a59_0x5463,_0x29d676=_0x594786();while(!![]){try{const _0x23333f=-parseInt(_0x5f4185(0x135))/0x1*(-parseInt(_0x5f4185(0x125))/0x2)+parseInt(_0x5f4185(0xea))/0x3*(-parseInt(_0x5f4185(0xfb))/0x4)+-parseInt(_0x5f4185(0x117))/0x5*(parseInt(_0x5f4185(0xe5))/0x6)+parseInt(_0x5f4185(0xb6))/0x7+parseInt(_0x5f4185(0xd1))/0x8+-parseInt(_0x5f4185(0xf6))/0x9+parseInt(_0x5f4185(0xb5))/0xa;if(_0x23333f===_0x167836)break;else _0x29d676['push'](_0x29d676['shift']());}catch(_0x36a9f2){_0x29d676['push'](_0x29d676['shift']());}}}(a59_0x589f,0x954d6));var __createBinding=this&&this[a59_0x3203f7(0x107)]||(Object[a59_0x3203f7(0xce)]?function(_0x4f9221,_0x487351,_0x1c63cd,_0x2e0d9e){const _0x243e41=a59_0x3203f7;if(_0x2e0d9e===undefined)_0x2e0d9e=_0x1c63cd;var _0x4125be=Object[_0x243e41(0xf8)](_0x487351,_0x1c63cd);(!_0x4125be||(_0x243e41(0x133)in _0x4125be?!_0x487351[_0x243e41(0x12f)]:_0x4125be[_0x243e41(0xc8)]||_0x4125be['configurable']))&&(_0x4125be={'enumerable':!![],'get':function(){return _0x487351[_0x1c63cd];}}),Object['defineProperty'](_0x4f9221,_0x2e0d9e,_0x4125be);}:function(_0x11f7b6,_0x4a28ab,_0x36fb9e,_0x258af3){if(_0x258af3===undefined)_0x258af3=_0x36fb9e;_0x11f7b6[_0x258af3]=_0x4a28ab[_0x36fb9e];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a59_0x3203f7(0xce)]?function(_0x4a9cc5,_0x465c12){const _0x3192f3=a59_0x3203f7;Object[_0x3192f3(0x121)](_0x4a9cc5,'default',{'enumerable':!![],'value':_0x465c12});}:function(_0x470baf,_0x4e8a6f){const _0x526616=a59_0x3203f7;_0x470baf[_0x526616(0xe1)]=_0x4e8a6f;}),__importStar=this&&this['__importStar']||(function(){var _0x34273a=function(_0x200e5b){return _0x34273a=Object['getOwnPropertyNames']||function(_0x552703){const _0x880072=a59_0x5463;var _0x8125a0=[];for(var _0x432fd6 in _0x552703)if(Object[_0x880072(0x118)][_0x880072(0xcc)]['call'](_0x552703,_0x432fd6))_0x8125a0[_0x8125a0['length']]=_0x432fd6;return _0x8125a0;},_0x34273a(_0x200e5b);};return function(_0x54f7aa){const _0x2712ed=a59_0x5463;if(_0x54f7aa&&_0x54f7aa[_0x2712ed(0x12f)])return _0x54f7aa;var _0x5e83b8={};if(_0x54f7aa!=null){for(var _0x257da4=_0x34273a(_0x54f7aa),_0x2225e8=0x0;_0x2225e8<_0x257da4['length'];_0x2225e8++)if(_0x257da4[_0x2225e8]!==_0x2712ed(0xe1))__createBinding(_0x5e83b8,_0x54f7aa,_0x257da4[_0x2225e8]);}return __setModuleDefault(_0x5e83b8,_0x54f7aa),_0x5e83b8;};}());Object[a59_0x3203f7(0x121)](exports,'__esModule',{'value':!![]}),exports[a59_0x3203f7(0x126)]=void 0x0;const loggerService_1=require(a59_0x3203f7(0x10a));class KlymeService{constructor(){const _0xa416e3=a59_0x3203f7;this[_0xa416e3(0xda)]=_0xa416e3(0xe0),console[_0xa416e3(0xd7)]('üí≥\x20KLYME\x20service\x20initialized\x20with\x20unified\x20white\x20domain\x20proxy\x20for\x20all\x20regions');}[a59_0x3203f7(0xbe)](_0x55619a,_0x50e386){const _0x42be08=a59_0x3203f7,_0x473b02=_0x55619a[_0x42be08(0x123)]();switch(_0x50e386){case'EU':if(_0x473b02!==_0x42be08(0x12e))throw new Error('KLYME\x20EU\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20'+_0x473b02);break;case'GB':if(_0x473b02!==_0x42be08(0xf7))throw new Error(_0x42be08(0xd6)+_0x473b02);break;case'DE':if(_0x473b02!==_0x42be08(0x12e))throw new Error(_0x42be08(0x128)+_0x473b02);break;default:throw new Error(_0x42be08(0x136)+_0x50e386);}}async[a59_0x3203f7(0x106)](){const _0x4f5117=a59_0x3203f7,_0x5b069d=(await Promise[_0x4f5117(0x115)]()[_0x4f5117(0x129)](()=>__importStar(require(_0x4f5117(0xb1)))))[_0x4f5117(0xe1)];let _0x2f7ce4,_0x54d710=0x0;const _0x4a9e2f=0xa;do{const _0x51ca59=()=>{const _0x5b15d9=_0x4f5117;return Math[_0x5b15d9(0x10e)](Math[_0x5b15d9(0xd3)]()*0x5f5e100)[_0x5b15d9(0xf0)]()['padStart'](0x8,'0');};_0x2f7ce4=_0x51ca59()+'-'+_0x51ca59();const _0x155086=await _0x5b069d[_0x4f5117(0x10f)][_0x4f5117(0x110)]({'where':{'gatewayOrderId':_0x2f7ce4}});if(!_0x155086)break;_0x54d710++,console[_0x4f5117(0xd7)](_0x4f5117(0xcf)+_0x2f7ce4+_0x4f5117(0xbb)+_0x54d710+')');}while(_0x54d710<_0x4a9e2f);if(_0x54d710>=_0x4a9e2f)throw new Error(_0x4f5117(0xd2));return _0x2f7ce4;}async[a59_0x3203f7(0x113)](_0x516c81){const _0xedbc1=a59_0x3203f7,{orderId:_0x34f9b1,amount:_0x410275,currency:_0x33bfee,region:_0x302f42}=_0x516c81;if(_0x302f42!=='EU'&&_0x302f42!=='GB'&&_0x302f42!=='DE')throw new Error(_0xedbc1(0xec)+_0x302f42);this[_0xedbc1(0xbe)](_0x33bfee,_0x302f42);const _0x2fc740=_0x33bfee[_0xedbc1(0x123)]();console['log']('üí≥\x20KLYME\x20'+_0x302f42+_0xedbc1(0x12a)+_0x2fc740);const _0x475315=await this[_0xedbc1(0x106)]();console[_0xedbc1(0xd7)](_0xedbc1(0xb9)+_0x475315+_0xedbc1(0xba)+_0x302f42+')');const _0x131c5d='https://tesoft.uk/gateway/pending.php?id='+_0x34f9b1,_0x4eca60={'amount':_0x410275,'currency':_0x2fc740,'redirectUrl':_0x131c5d,'reference':_0x475315,'geo':_0x302f42},_0x123936=Date[_0xedbc1(0xcb)]();try{console[_0xedbc1(0xd7)](_0xedbc1(0xfd)+_0x302f42+'\x20API\x20REQUEST\x20(Unified\x20Route\x20with\x20Geo)\x20==='),console[_0xedbc1(0xd7)]('URL:',this['apiUrl']),console[_0xedbc1(0xd7)]('Request\x20Body:',JSON['stringify'](_0x4eca60,null,0x2)),console[_0xedbc1(0xd7)](_0xedbc1(0x10b),_0x302f42),console['log'](_0xedbc1(0xeb),_0x2fc740,'(validated\x20for\x20'+_0x302f42+')'),console['log']('Reference:',_0x475315,_0xedbc1(0x108)),console['log'](_0xedbc1(0xfc),_0x131c5d),loggerService_1['loggerService'][_0xedbc1(0x10d)]('klyme_'+_0x302f42['toLowerCase'](),_0xedbc1(0xe3),_0xedbc1(0x11d),_0x4eca60);const _0xa709c1=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0xedbc1(0x131),'Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON[_0xedbc1(0xd9)](_0x4eca60)}),_0x5584ef=Date[_0xedbc1(0xcb)]()-_0x123936;console['log'](_0xedbc1(0xfd)+_0x302f42+_0xedbc1(0x109)),console[_0xedbc1(0xd7)](_0xedbc1(0xe4),_0xa709c1[_0xedbc1(0xb0)]),console[_0xedbc1(0xd7)](_0xedbc1(0xdf),_0xa709c1[_0xedbc1(0x102)]),console['log'](_0xedbc1(0x12b),Object[_0xedbc1(0x122)](_0xa709c1['headers']['entries']())),console[_0xedbc1(0xd7)]('Response\x20Time:',_0x5584ef+'ms');const _0x209597=await _0xa709c1[_0xedbc1(0xef)]();console[_0xedbc1(0xd7)](_0xedbc1(0x10c),_0x209597);if(!_0xa709c1['ok']){console[_0xedbc1(0xac)](_0xedbc1(0xfd)+_0x302f42+_0xedbc1(0xd5)),console[_0xedbc1(0xac)](_0xedbc1(0xf3),_0xa709c1[_0xedbc1(0xb0)]),console[_0xedbc1(0xac)]('Response\x20Body:',_0x209597),loggerService_1[_0xedbc1(0xfe)][_0xedbc1(0x104)](_0xedbc1(0xde)+_0x302f42[_0xedbc1(0xae)](),_0xedbc1(0xe3),_0xa709c1[_0xedbc1(0xb0)],_0x209597,_0x5584ef),loggerService_1[_0xedbc1(0xfe)][_0xedbc1(0x111)](_0xedbc1(0xde)+_0x302f42[_0xedbc1(0xae)](),_0xedbc1(0xe3),_0xedbc1(0xbd)+_0xa709c1['status']+':\x20'+_0x209597);throw new Error(_0xedbc1(0xf4)+_0xa709c1[_0xedbc1(0xb0)]+_0xedbc1(0xe8)+_0x209597);}let _0xf9e53d;try{_0xf9e53d=JSON['parse'](_0x209597);}catch(_0x477a66){console[_0xedbc1(0xac)](_0xedbc1(0x120),_0x477a66),loggerService_1['loggerService'][_0xedbc1(0x111)]('klyme_'+_0x302f42[_0xedbc1(0xae)](),_0xedbc1(0xe3),_0xedbc1(0x114)+_0x477a66);throw new Error('Invalid\x20JSON\x20response\x20from\x20KLYME\x20'+_0x302f42+_0xedbc1(0xdc)+_0x209597);}console[_0xedbc1(0xd7)](_0xedbc1(0xb3)+_0x302f42+_0xedbc1(0xf9)),console['log'](_0xedbc1(0x11e),JSON[_0xedbc1(0xd9)](_0xf9e53d,null,0x2)),loggerService_1[_0xedbc1(0xfe)][_0xedbc1(0x104)](_0xedbc1(0xde)+_0x302f42[_0xedbc1(0xae)](),_0xedbc1(0xe3),_0xa709c1['status'],_0xf9e53d,_0x5584ef);if(_0xf9e53d[_0xedbc1(0xac)]||_0xf9e53d[_0xedbc1(0x11b)]){const _0x158b81=_0xf9e53d[_0xedbc1(0xc3)]||_0xf9e53d[_0xedbc1(0xac)]||_0xedbc1(0xb4)+_0x302f42+_0xedbc1(0x116);console['error'](_0xedbc1(0xfd)+_0x302f42+_0xedbc1(0x127)),console[_0xedbc1(0xac)](_0xedbc1(0xfa),_0x158b81),console['error'](_0xedbc1(0x11f),_0xf9e53d[_0xedbc1(0x11b)]),loggerService_1['loggerService']['logWhiteDomainError'](_0xedbc1(0xde)+_0x302f42[_0xedbc1(0xae)](),'/create','Business\x20Error:\x20'+_0x158b81);throw new Error(_0xedbc1(0xdb)+_0x302f42+_0xedbc1(0xe7)+_0x158b81);}let _0x5b0e21,_0x1ae2f3;if(_0xf9e53d[_0xedbc1(0x103)]&&_0xf9e53d[_0xedbc1(0xe9)])_0x5b0e21=_0xf9e53d[_0xedbc1(0x103)],_0x1ae2f3=_0xf9e53d[_0xedbc1(0xe9)],console[_0xedbc1(0xd7)](_0xedbc1(0xfd)+_0x302f42+_0xedbc1(0xaf)),console[_0xedbc1(0xd7)](_0xedbc1(0xc1),_0xf9e53d[_0xedbc1(0x103)]),console['log'](_0xedbc1(0xfc),_0xf9e53d[_0xedbc1(0xe9)]);else{if(_0xf9e53d[_0xedbc1(0xab)])_0x5b0e21=_0x475315,_0x1ae2f3=_0xf9e53d[_0xedbc1(0xab)],console[_0xedbc1(0xd7)](_0xedbc1(0xfd)+_0x302f42+'\x20SUCCESS\x20(Legacy\x20Format)\x20==='),console[_0xedbc1(0xd7)]('Auth\x20URL:',_0xf9e53d[_0xedbc1(0xab)]),console['log'](_0xedbc1(0xee),_0x475315);else{console[_0xedbc1(0xac)](_0xedbc1(0xfd)+_0x302f42+'\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0xedbc1(0xac)](_0xedbc1(0x11c)),console[_0xedbc1(0xac)](_0xedbc1(0xd0),_0xf9e53d),loggerService_1[_0xedbc1(0xfe)][_0xedbc1(0x111)](_0xedbc1(0xde)+_0x302f42[_0xedbc1(0xae)](),_0xedbc1(0xe3),'Incomplete\x20response:\x20missing\x20uuid/redirect_url\x20or\x20authUrl');throw new Error('Invalid\x20response\x20from\x20KLYME\x20'+_0x302f42+'\x20API:\x20missing\x20payment\x20data');}}return console[_0xedbc1(0xd7)](_0xedbc1(0xd8),_0x2fc740,'('+_0x302f42+'\x20validated)'),console[_0xedbc1(0xd7)](_0xedbc1(0x112),_0x475315,'(8digits-8digits\x20format)'),console[_0xedbc1(0xd7)](_0xedbc1(0xb8),_0x302f42),{'gateway_payment_id':_0x5b0e21,'payment_url':_0x1ae2f3};}catch(_0x5ca27a){console[_0xedbc1(0xac)](_0xedbc1(0xfd)+_0x302f42+_0xedbc1(0xb2)),console[_0xedbc1(0xac)]('Error\x20details:',_0x5ca27a),loggerService_1[_0xedbc1(0xfe)][_0xedbc1(0x111)](_0xedbc1(0xde)+_0x302f42['toLowerCase'](),'/create',_0x5ca27a);if(_0x5ca27a instanceof Error){console['error'](_0xedbc1(0xf1),_0x5ca27a[_0xedbc1(0xc3)]),console[_0xedbc1(0xac)](_0xedbc1(0xb7),_0x5ca27a['stack']);throw new Error(_0xedbc1(0xc5)+_0x302f42+'\x20payment\x20link:\x20'+_0x5ca27a[_0xedbc1(0xc3)]);}throw new Error(_0xedbc1(0xc5)+_0x302f42+_0xedbc1(0x100));}}async[a59_0x3203f7(0xc4)](_0x2112ae,_0x4ec261){const _0x541298=a59_0x3203f7,_0x2cacae=Date[_0x541298(0xcb)]();try{const _0x5f497a={'gatewayPaymentId':_0x2112ae,'geo':_0x4ec261};loggerService_1[_0x541298(0xfe)][_0x541298(0x10d)]('klyme_'+_0x4ec261[_0x541298(0xae)](),_0x541298(0x119)+_0x2112ae,'POST',_0x5f497a);const _0x5d04d9=await fetch(this[_0x541298(0xda)],{'method':_0x541298(0x11d),'headers':{'Content-Type':'application/json','User-Agent':_0x541298(0xdd)},'body':JSON['stringify'](_0x5f497a)}),_0x4f2064=Date[_0x541298(0xcb)]()-_0x2cacae;if(!_0x5d04d9['ok']){const _0x52c57e=await _0x5d04d9['text']();loggerService_1[_0x541298(0xfe)][_0x541298(0x104)](_0x541298(0xde)+_0x4ec261[_0x541298(0xae)](),_0x541298(0x119)+_0x2112ae,_0x5d04d9[_0x541298(0xb0)],_0x52c57e,_0x4f2064);throw new Error(_0x541298(0xf4)+_0x5d04d9['status']);}const _0x133aff=await _0x5d04d9['json']();loggerService_1[_0x541298(0xfe)]['logWhiteDomainResponse'](_0x541298(0xde)+_0x4ec261[_0x541298(0xae)](),'/verify/'+_0x2112ae,_0x5d04d9[_0x541298(0xb0)],_0x133aff,_0x4f2064);if(_0x133aff[_0x541298(0xac)]||_0x133aff[_0x541298(0x11b)]){loggerService_1[_0x541298(0xfe)][_0x541298(0x111)](_0x541298(0xde)+_0x4ec261[_0x541298(0xae)](),'/verify/'+_0x2112ae,_0x541298(0xdb)+_0x4ec261+_0x541298(0xe7)+(_0x133aff[_0x541298(0xc3)]||_0x133aff[_0x541298(0xac)]||_0x541298(0x130)));throw new Error(_0x541298(0xdb)+_0x4ec261+_0x541298(0xe7)+(_0x133aff[_0x541298(0xc3)]||_0x133aff[_0x541298(0xac)]||'Unknown\x20error'));}let _0x48d1f8='PENDING';return{'status':_0x48d1f8};}catch(_0x119746){console[_0x541298(0xac)](_0x541298(0xdb)+_0x4ec261+_0x541298(0xe2),_0x119746),loggerService_1[_0x541298(0xfe)][_0x541298(0x111)]('klyme_'+_0x4ec261[_0x541298(0xae)](),'/verify/'+_0x2112ae,_0x119746);throw new Error('Failed\x20to\x20verify\x20KLYME\x20'+_0x4ec261+'\x20payment:\x20'+(_0x119746 instanceof Error?_0x119746[_0x541298(0xc3)]:'Unknown\x20error'));}}async[a59_0x3203f7(0xcd)](_0x2ae920){const _0x4619c3=a59_0x3203f7;console[_0x4619c3(0xd7)](_0x4619c3(0x105),_0x2ae920);let _0xe0d053=_0x4619c3(0xc9);switch(_0x2ae920['status']?.[_0x4619c3(0xae)]()){case _0x4619c3(0x132):case _0x4619c3(0xed):case _0x4619c3(0xc6):case'success':case _0x4619c3(0x134):_0xe0d053=_0x4619c3(0xbc);break;case _0x4619c3(0xf5):case _0x4619c3(0xad):case _0x4619c3(0x12c):case _0x4619c3(0xac):case _0x4619c3(0xf2):_0xe0d053=_0x4619c3(0x12d);break;case _0x4619c3(0xbf):case'timeout':_0xe0d053=_0x4619c3(0x124);break;case _0x4619c3(0xc2):case _0x4619c3(0xc7):case _0x4619c3(0xc0):case'processing':case _0x4619c3(0x101):default:_0xe0d053=_0x4619c3(0xc9);break;}return{'paymentId':_0x2ae920[_0x4619c3(0xff)]||_0x2ae920['order_id']||_0x2ae920['payment_id'],'status':_0xe0d053,'amount':_0x2ae920[_0x4619c3(0x11a)],'currency':_0x2ae920[_0x4619c3(0xd4)],'region':_0x2ae920[_0x4619c3(0xca)],'additionalInfo':{'payment_method':_0x2ae920['payment_method'],'transaction_id':_0x2ae920[_0x4619c3(0xe6)]}};}}exports[a59_0x3203f7(0x126)]=KlymeService;function a59_0x589f(){const _0x268a58=['toString','Error\x20message:','rejected','HTTP\x20Status:','HTTP\x20error!\x20status:\x20','cancelled','1433466pkHRVG','GBP','getOwnPropertyDescriptor','\x20RESPONSE\x20===','Error\x20Message:','200084NnixWh','Redirect\x20URL:','===\x20KLYME\x20','loggerService','reference','\x20payment\x20link:\x20Unknown\x20error','in_progress','statusText','uuid','logWhiteDomainResponse','Processing\x20KLYME\x20webhook:','generateUniqueReference','__createBinding','(8digits-8digits\x20format)','\x20API\x20RESPONSE\x20(Unified\x20Route)\x20===','../loggerService','Region\x20(geo):','Raw\x20Response\x20Body:','logWhiteDomainRequest','floor','payment','findFirst','logWhiteDomainError','Reference\x20Used:','createPaymentLink','JSON\x20Parse\x20Error:\x20','resolve','\x20API','5hdmTVu','prototype','/verify/','amount','statusCode','Missing\x20uuid/redirect_url\x20or\x20authUrl\x20in\x20response','POST','Parsed\x20Result:','Status\x20Code:','Failed\x20to\x20parse\x20JSON\x20response:','defineProperty','fromEntries','toUpperCase','EXPIRED','1143312AWWTwp','KlymeService','\x20API\x20BUSINESS\x20ERROR\x20===','KLYME\x20DE\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20','then','\x20currency\x20validation\x20passed:\x20','Headers:','failed','FAILED','EUR','__esModule','Unknown\x20error','application/json','paid','get','successful','1VxiczO','Unsupported\x20KLYME\x20region:\x20','authUrl','error','canceled','toLowerCase','\x20SUCCESS\x20(New\x20Format)\x20===','status','../../config/database','\x20SERVICE\x20ERROR\x20===','===\x20PARSED\x20KLYME\x20','Unknown\x20error\x20from\x20KLYME\x20','17695880XyVpzd','1507569dBNmzh','Error\x20stack:','Geo\x20Parameter:','üéØ\x20Generated\x20unique\x20KLYME\x20reference:\x20','\x20(8digits-8digits\x20format\x20for\x20','\x20already\x20exists,\x20generating\x20new\x20one\x20(attempt\x20','PAID','HTTP\x20','validateCurrencyForRegion','expired','active','UUID:','pending','message','verifyPayment','Failed\x20to\x20create\x20KLYME\x20','confirmed','created','writable','PENDING','region','now','hasOwnProperty','processWebhook','create','‚ö†Ô∏è\x20KLYME\x20reference\x20','Response\x20data:','2872064ZjzZWv','Failed\x20to\x20generate\x20unique\x20KLYME\x20reference\x20after\x20maximum\x20attempts','random','currency','\x20API\x20ERROR\x20===','KLYME\x20GB\x20accepts\x20only\x20GBP\x20currency,\x20got:\x20','log','Currency\x20Used:','stringify','apiUrl','KLYME\x20','\x20API:\x20','Payment\x20System/1.0','klyme_','Status\x20Text:','https://tesoft.uk/gateway/klyme/','default','\x20payment\x20verification\x20error:','/create','Status:','5665794JGDCQA','transaction_id','\x20API\x20error:\x20',',\x20body:\x20','redirect_url','72jVOYJh','Currency:','KLYME\x20payment\x20creation\x20is\x20supported\x20for\x20EU,\x20GB\x20and\x20DE\x20regions,\x20got:\x20','completed','Reference\x20Used\x20as\x20ID:','text'];a59_0x589f=function(){return _0x268a58;};return a59_0x589f();}