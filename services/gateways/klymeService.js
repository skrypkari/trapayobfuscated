'use strict';const a41_0x10b8e8=a41_0xbd61;(function(_0x48c1b4,_0x2a7802){const _0x1ff211=a41_0xbd61,_0x24723c=_0x48c1b4();while(!![]){try{const _0x54ce60=parseInt(_0x1ff211(0x22d))/0x1+parseInt(_0x1ff211(0x1ff))/0x2+-parseInt(_0x1ff211(0x271))/0x3+-parseInt(_0x1ff211(0x213))/0x4+parseInt(_0x1ff211(0x217))/0x5*(-parseInt(_0x1ff211(0x1df))/0x6)+-parseInt(_0x1ff211(0x200))/0x7*(-parseInt(_0x1ff211(0x1e6))/0x8)+-parseInt(_0x1ff211(0x1f7))/0x9*(-parseInt(_0x1ff211(0x23e))/0xa);if(_0x54ce60===_0x2a7802)break;else _0x24723c['push'](_0x24723c['shift']());}catch(_0x1d1b2f){_0x24723c['push'](_0x24723c['shift']());}}}(a41_0x2090,0x1d73e));function a41_0x2090(){const _0x5e8fa2=['HTTP\x20','\x20API','verifyPayment','Failed\x20to\x20verify\x20KLYME\x20','\x20API\x20ERROR\x20===','Unknown\x20error\x20from\x20KLYME\x20','\x20API\x20RESPONSE\x20(Unified\x20Route)\x20===','payment_method','configurable','klyme_','Headers:','processing','timeout','\x20(8digits-8digits\x20format\x20for\x20','then','../loggerService','\x20SUCCESS\x20(Legacy\x20Format)\x20===','log','\x20API:\x20missing\x20payment\x20data','EXPIRED','476643wSvKnN','Failed\x20to\x20generate\x20unique\x20KLYME\x20reference\x20after\x20maximum\x20attempts','HTTP\x20error!\x20status:\x20','1437126KPrToF','canceled','expired','FAILED','Unsupported\x20KLYME\x20region:\x20','floor','toUpperCase','1872HICShw','Auth\x20URL:','getOwnPropertyNames','../../config/database','loggerService','writable','Region\x20(geo):','currency','status','findFirst','Status\x20Code:','\x20validated)','KlymeService','\x20API\x20INCOMPLETE\x20RESPONSE\x20===','toLowerCase','TesSoft\x20Payment\x20System/1.0','\x20payment\x20verification\x20error:','12753cNfPXG','logWhiteDomainResponse','random','successful','Response\x20Body:','\x20payment\x20link:\x20','__esModule','error','437884uaVdsH','7112uyZCde','JSON\x20Parse\x20Error:\x20','completed','Error\x20details:','parse','now','application/json','fromEntries','redirect_url','UUID:','hasOwnProperty','üí≥\x20KLYME\x20','Incomplete\x20response:\x20missing\x20uuid/redirect_url\x20or\x20authUrl','prototype','Geo\x20Parameter:','\x20already\x20exists,\x20generating\x20new\x20one\x20(attempt\x20','Request\x20Body:','Business\x20Error:\x20','Error\x20message:','936532aLXrZE','createPaymentLink','Unknown\x20error','cancelled','5mvReGC','statusText','(8digits-8digits\x20format)','Currency:','authUrl','\x20SUCCESS\x20(New\x20Format)\x20===','\x20payment:\x20','create','reference','\x20SERVICE\x20ERROR\x20===','KLYME\x20GB\x20accepts\x20only\x20GBP\x20currency,\x20got:\x20','EUR','KLYME\x20payment\x20creation\x20is\x20supported\x20for\x20EU,\x20GB\x20and\x20DE\x20regions,\x20got:\x20','apiUrl','logWhiteDomainRequest','Reference:','default','GBP','PENDING','KLYME\x20EU\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20','Redirect\x20URL:','\x20API:\x20','51346YnzBgx','entries','===\x20KLYME\x20','pending','paid','/verify/','transaction_id','in_progress','\x20API\x20error:\x20','POST','message','rejected','PAID','defineProperty','/create','processWebhook','\x20RESPONSE\x20===','1730CSwPBW','\x20payment\x20link:\x20Unknown\x20error','stringify','Failed\x20to\x20create\x20KLYME\x20','Response\x20data:','Response\x20Time:','Invalid\x20JSON\x20response\x20from\x20KLYME\x20','Status:','created','failed','uuid','__createBinding','Invalid\x20response\x20from\x20KLYME\x20','https://tesoft.uk/gateway/klyme/','generateUniqueReference','headers','Reference\x20Used:','text','length','logWhiteDomainError','\x20API\x20REQUEST\x20(Unified\x20Route\x20with\x20Geo)\x20===','__setModuleDefault','Error\x20Message:','Processing\x20KLYME\x20webhook:','call','getOwnPropertyDescriptor','statusCode','KLYME\x20','toString','Parsed\x20Result:','KLYME\x20DE\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20'];a41_0x2090=function(){return _0x5e8fa2;};return a41_0x2090();}var __createBinding=this&&this[a41_0x10b8e8(0x249)]||(Object[a41_0x10b8e8(0x21e)]?function(_0x3c1627,_0xc857de,_0x3d7788,_0xffdb69){const _0x167bf3=a41_0x10b8e8;if(_0xffdb69===undefined)_0xffdb69=_0x3d7788;var _0x3aada7=Object[_0x167bf3(0x257)](_0xc857de,_0x3d7788);(!_0x3aada7||('get'in _0x3aada7?!_0xc857de[_0x167bf3(0x1fd)]:_0x3aada7[_0x167bf3(0x1eb)]||_0x3aada7[_0x167bf3(0x265)]))&&(_0x3aada7={'enumerable':!![],'get':function(){return _0xc857de[_0x3d7788];}}),Object[_0x167bf3(0x23a)](_0x3c1627,_0xffdb69,_0x3aada7);}:function(_0x82fb68,_0x3d6ebe,_0x52a747,_0x1a4c28){if(_0x1a4c28===undefined)_0x1a4c28=_0x52a747;_0x82fb68[_0x1a4c28]=_0x3d6ebe[_0x52a747];}),__setModuleDefault=this&&this[a41_0x10b8e8(0x253)]||(Object[a41_0x10b8e8(0x21e)]?function(_0x42a0de,_0x3f55ac){const _0x230de4=a41_0x10b8e8;Object['defineProperty'](_0x42a0de,_0x230de4(0x227),{'enumerable':!![],'value':_0x3f55ac});}:function(_0x2af435,_0x1eed2f){_0x2af435['default']=_0x1eed2f;}),__importStar=this&&this['__importStar']||(function(){var _0x433c21=function(_0x165403){const _0x394981=a41_0xbd61;return _0x433c21=Object[_0x394981(0x1e8)]||function(_0x3729e5){const _0x3261ec=_0x394981;var _0x2e1e5b=[];for(var _0x292df8 in _0x3729e5)if(Object[_0x3261ec(0x20d)][_0x3261ec(0x20a)][_0x3261ec(0x256)](_0x3729e5,_0x292df8))_0x2e1e5b[_0x2e1e5b['length']]=_0x292df8;return _0x2e1e5b;},_0x433c21(_0x165403);};return function(_0x17cecb){const _0x13b330=a41_0xbd61;if(_0x17cecb&&_0x17cecb[_0x13b330(0x1fd)])return _0x17cecb;var _0x16a3ff={};if(_0x17cecb!=null){for(var _0x1551a4=_0x433c21(_0x17cecb),_0x293c52=0x0;_0x293c52<_0x1551a4[_0x13b330(0x250)];_0x293c52++)if(_0x1551a4[_0x293c52]!==_0x13b330(0x227))__createBinding(_0x16a3ff,_0x17cecb,_0x1551a4[_0x293c52]);}return __setModuleDefault(_0x16a3ff,_0x17cecb),_0x16a3ff;};}());Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a41_0x10b8e8(0x1f2)]=void 0x0;const loggerService_1=require(a41_0x10b8e8(0x26c));function a41_0xbd61(_0x1fb2ff,_0x2dc1d0){const _0x209096=a41_0x2090();return a41_0xbd61=function(_0xbd6182,_0x1162aa){_0xbd6182=_0xbd6182-0x1df;let _0x546f07=_0x209096[_0xbd6182];return _0x546f07;},a41_0xbd61(_0x1fb2ff,_0x2dc1d0);}class KlymeService{constructor(){const _0x3b2381=a41_0x10b8e8;this['apiUrl']=_0x3b2381(0x24b),console['log']('üí≥\x20KLYME\x20service\x20initialized\x20with\x20unified\x20white\x20domain\x20proxy\x20for\x20all\x20regions');}['validateCurrencyForRegion'](_0x49889d,_0x5eb5ca){const _0x19ebef=a41_0x10b8e8,_0x22e23d=_0x49889d[_0x19ebef(0x1e5)]();switch(_0x5eb5ca){case'EU':if(_0x22e23d!==_0x19ebef(0x222))throw new Error(_0x19ebef(0x22a)+_0x22e23d);break;case'GB':if(_0x22e23d!==_0x19ebef(0x228))throw new Error(_0x19ebef(0x221)+_0x22e23d);break;case'DE':if(_0x22e23d!==_0x19ebef(0x222))throw new Error(_0x19ebef(0x25c)+_0x22e23d);break;default:throw new Error(_0x19ebef(0x1e3)+_0x5eb5ca);}}async[a41_0x10b8e8(0x24c)](){const _0xf6a791=a41_0x10b8e8,_0xcaff30=(await Promise['resolve']()[_0xf6a791(0x26b)](()=>__importStar(require(_0xf6a791(0x1e9)))))[_0xf6a791(0x227)];let _0x14924c,_0x35bc1f=0x0;const _0x4d8e48=0xa;do{const _0x8e2604=()=>{const _0xd4462d=_0xf6a791;return Math[_0xd4462d(0x1e4)](Math[_0xd4462d(0x1f9)]()*0x5f5e100)[_0xd4462d(0x25a)]()['padStart'](0x8,'0');};_0x14924c=_0x8e2604()+'-'+_0x8e2604();const _0x277bbb=await _0xcaff30['payment'][_0xf6a791(0x1ef)]({'where':{'gatewayOrderId':_0x14924c}});if(!_0x277bbb)break;_0x35bc1f++,console[_0xf6a791(0x26e)]('‚ö†Ô∏è\x20KLYME\x20reference\x20'+_0x14924c+_0xf6a791(0x20f)+_0x35bc1f+')');}while(_0x35bc1f<_0x4d8e48);if(_0x35bc1f>=_0x4d8e48)throw new Error(_0xf6a791(0x272));return _0x14924c;}async[a41_0x10b8e8(0x214)](_0x327f0f){const _0x52143d=a41_0x10b8e8,{orderId:_0xbb6113,amount:_0x4898db,currency:_0x1b51ae,region:_0x14b3eb}=_0x327f0f;if(_0x14b3eb!=='EU'&&_0x14b3eb!=='GB'&&_0x14b3eb!=='DE')throw new Error(_0x52143d(0x223)+_0x14b3eb);this['validateCurrencyForRegion'](_0x1b51ae,_0x14b3eb);const _0x43a204=_0x1b51ae[_0x52143d(0x1e5)]();console[_0x52143d(0x26e)](_0x52143d(0x20b)+_0x14b3eb+'\x20currency\x20validation\x20passed:\x20'+_0x43a204);const _0x524f01=await this['generateUniqueReference']();console['log']('üéØ\x20Generated\x20unique\x20KLYME\x20reference:\x20'+_0x524f01+_0x52143d(0x26a)+_0x14b3eb+')');const _0x2a824c='https://tesoft.uk/gateway/pending.php?id='+_0xbb6113,_0xddeae4={'amount':_0x4898db,'currency':_0x43a204,'redirectUrl':_0x2a824c,'reference':_0x524f01,'geo':_0x14b3eb},_0x4e440b=Date[_0x52143d(0x205)]();try{console[_0x52143d(0x26e)](_0x52143d(0x22f)+_0x14b3eb+_0x52143d(0x252)),console['log']('URL:',this['apiUrl']),console['log'](_0x52143d(0x210),JSON[_0x52143d(0x240)](_0xddeae4,null,0x2)),console[_0x52143d(0x26e)](_0x52143d(0x1ec),_0x14b3eb),console[_0x52143d(0x26e)](_0x52143d(0x21a),_0x43a204,'(validated\x20for\x20'+_0x14b3eb+')'),console['log'](_0x52143d(0x226),_0x524f01,_0x52143d(0x219)),console[_0x52143d(0x26e)](_0x52143d(0x22b),_0x2a824c),loggerService_1['loggerService'][_0x52143d(0x225)](_0x52143d(0x266)+_0x14b3eb['toLowerCase'](),_0x52143d(0x23b),_0x52143d(0x236),_0xddeae4);const _0x260cfb=await fetch(this[_0x52143d(0x224)],{'method':_0x52143d(0x236),'headers':{'Content-Type':_0x52143d(0x206),'Accept':_0x52143d(0x206),'User-Agent':_0x52143d(0x1f5)},'body':JSON[_0x52143d(0x240)](_0xddeae4)}),_0x5cfb21=Date[_0x52143d(0x205)]()-_0x4e440b;console['log'](_0x52143d(0x22f)+_0x14b3eb+_0x52143d(0x263)),console[_0x52143d(0x26e)](_0x52143d(0x245),_0x260cfb['status']),console['log']('Status\x20Text:',_0x260cfb[_0x52143d(0x218)]),console[_0x52143d(0x26e)](_0x52143d(0x267),Object[_0x52143d(0x207)](_0x260cfb[_0x52143d(0x24d)][_0x52143d(0x22e)]())),console[_0x52143d(0x26e)](_0x52143d(0x243),_0x5cfb21+'ms');const _0x4ae7f5=await _0x260cfb[_0x52143d(0x24f)]();console[_0x52143d(0x26e)]('Raw\x20Response\x20Body:',_0x4ae7f5);if(!_0x260cfb['ok']){console[_0x52143d(0x1fe)]('===\x20KLYME\x20'+_0x14b3eb+_0x52143d(0x261)),console['error']('HTTP\x20Status:',_0x260cfb[_0x52143d(0x1ee)]),console[_0x52143d(0x1fe)](_0x52143d(0x1fb),_0x4ae7f5),loggerService_1['loggerService'][_0x52143d(0x1f8)]('klyme_'+_0x14b3eb[_0x52143d(0x1f4)](),'/create',_0x260cfb[_0x52143d(0x1ee)],_0x4ae7f5,_0x5cfb21),loggerService_1['loggerService']['logWhiteDomainError'](_0x52143d(0x266)+_0x14b3eb['toLowerCase'](),'/create',_0x52143d(0x25d)+_0x260cfb[_0x52143d(0x1ee)]+':\x20'+_0x4ae7f5);throw new Error(_0x52143d(0x273)+_0x260cfb['status']+',\x20body:\x20'+_0x4ae7f5);}let _0x330ea9;try{_0x330ea9=JSON[_0x52143d(0x204)](_0x4ae7f5);}catch(_0x270447){console[_0x52143d(0x1fe)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x270447),loggerService_1[_0x52143d(0x1ea)][_0x52143d(0x251)]('klyme_'+_0x14b3eb['toLowerCase'](),'/create',_0x52143d(0x201)+_0x270447);throw new Error(_0x52143d(0x244)+_0x14b3eb+_0x52143d(0x22c)+_0x4ae7f5);}console['log']('===\x20PARSED\x20KLYME\x20'+_0x14b3eb+_0x52143d(0x23d)),console[_0x52143d(0x26e)](_0x52143d(0x25b),JSON[_0x52143d(0x240)](_0x330ea9,null,0x2)),loggerService_1['loggerService'][_0x52143d(0x1f8)]('klyme_'+_0x14b3eb[_0x52143d(0x1f4)](),'/create',_0x260cfb['status'],_0x330ea9,_0x5cfb21);if(_0x330ea9[_0x52143d(0x1fe)]||_0x330ea9[_0x52143d(0x258)]){const _0x3d9d79=_0x330ea9['message']||_0x330ea9[_0x52143d(0x1fe)]||_0x52143d(0x262)+_0x14b3eb+_0x52143d(0x25e);console[_0x52143d(0x1fe)](_0x52143d(0x22f)+_0x14b3eb+'\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x52143d(0x254),_0x3d9d79),console['error'](_0x52143d(0x1f0),_0x330ea9['statusCode']),loggerService_1[_0x52143d(0x1ea)][_0x52143d(0x251)]('klyme_'+_0x14b3eb[_0x52143d(0x1f4)](),'/create',_0x52143d(0x211)+_0x3d9d79);throw new Error(_0x52143d(0x259)+_0x14b3eb+_0x52143d(0x235)+_0x3d9d79);}let _0x127fe5,_0x218d3b;if(_0x330ea9['uuid']&&_0x330ea9[_0x52143d(0x208)])_0x127fe5=_0x330ea9[_0x52143d(0x248)],_0x218d3b=_0x330ea9[_0x52143d(0x208)],console['log'](_0x52143d(0x22f)+_0x14b3eb+_0x52143d(0x21c)),console['log'](_0x52143d(0x209),_0x330ea9[_0x52143d(0x248)]),console[_0x52143d(0x26e)](_0x52143d(0x22b),_0x330ea9[_0x52143d(0x208)]);else{if(_0x330ea9['authUrl'])_0x127fe5=_0x524f01,_0x218d3b=_0x330ea9['authUrl'],console['log'](_0x52143d(0x22f)+_0x14b3eb+_0x52143d(0x26d)),console[_0x52143d(0x26e)](_0x52143d(0x1e7),_0x330ea9[_0x52143d(0x21b)]),console[_0x52143d(0x26e)]('Reference\x20Used\x20as\x20ID:',_0x524f01);else{console['error']('===\x20KLYME\x20'+_0x14b3eb+_0x52143d(0x1f3)),console[_0x52143d(0x1fe)]('Missing\x20uuid/redirect_url\x20or\x20authUrl\x20in\x20response'),console[_0x52143d(0x1fe)](_0x52143d(0x242),_0x330ea9),loggerService_1['loggerService'][_0x52143d(0x251)](_0x52143d(0x266)+_0x14b3eb[_0x52143d(0x1f4)](),_0x52143d(0x23b),_0x52143d(0x20c));throw new Error(_0x52143d(0x24a)+_0x14b3eb+_0x52143d(0x26f));}}return console['log']('Currency\x20Used:',_0x43a204,'('+_0x14b3eb+_0x52143d(0x1f1)),console[_0x52143d(0x26e)](_0x52143d(0x24e),_0x524f01,'(8digits-8digits\x20format)'),console[_0x52143d(0x26e)](_0x52143d(0x20e),_0x14b3eb),{'gateway_payment_id':_0x127fe5,'payment_url':_0x218d3b};}catch(_0x16d1f7){console['error']('===\x20KLYME\x20'+_0x14b3eb+_0x52143d(0x220)),console[_0x52143d(0x1fe)](_0x52143d(0x203),_0x16d1f7),loggerService_1[_0x52143d(0x1ea)][_0x52143d(0x251)](_0x52143d(0x266)+_0x14b3eb[_0x52143d(0x1f4)](),_0x52143d(0x23b),_0x16d1f7);if(_0x16d1f7 instanceof Error){console[_0x52143d(0x1fe)](_0x52143d(0x212),_0x16d1f7['message']),console[_0x52143d(0x1fe)]('Error\x20stack:',_0x16d1f7['stack']);throw new Error(_0x52143d(0x241)+_0x14b3eb+_0x52143d(0x1fc)+_0x16d1f7['message']);}throw new Error(_0x52143d(0x241)+_0x14b3eb+_0x52143d(0x23f));}}async[a41_0x10b8e8(0x25f)](_0x2b3edf,_0x18d2a0){const _0x267e9c=a41_0x10b8e8,_0x34a8e3=Date['now']();try{const _0x1885f8={'gatewayPaymentId':_0x2b3edf,'geo':_0x18d2a0};loggerService_1['loggerService'][_0x267e9c(0x225)](_0x267e9c(0x266)+_0x18d2a0[_0x267e9c(0x1f4)](),_0x267e9c(0x232)+_0x2b3edf,'POST',_0x1885f8);const _0x83eb6c=await fetch(this[_0x267e9c(0x224)],{'method':_0x267e9c(0x236),'headers':{'Content-Type':_0x267e9c(0x206),'User-Agent':_0x267e9c(0x1f5)},'body':JSON[_0x267e9c(0x240)](_0x1885f8)}),_0x168498=Date[_0x267e9c(0x205)]()-_0x34a8e3;if(!_0x83eb6c['ok']){const _0x139be9=await _0x83eb6c[_0x267e9c(0x24f)]();loggerService_1[_0x267e9c(0x1ea)][_0x267e9c(0x1f8)](_0x267e9c(0x266)+_0x18d2a0[_0x267e9c(0x1f4)](),_0x267e9c(0x232)+_0x2b3edf,_0x83eb6c[_0x267e9c(0x1ee)],_0x139be9,_0x168498);throw new Error('HTTP\x20error!\x20status:\x20'+_0x83eb6c[_0x267e9c(0x1ee)]);}const _0x815954=await _0x83eb6c['json']();loggerService_1[_0x267e9c(0x1ea)][_0x267e9c(0x1f8)](_0x267e9c(0x266)+_0x18d2a0['toLowerCase'](),_0x267e9c(0x232)+_0x2b3edf,_0x83eb6c[_0x267e9c(0x1ee)],_0x815954,_0x168498);if(_0x815954[_0x267e9c(0x1fe)]||_0x815954[_0x267e9c(0x258)]){loggerService_1[_0x267e9c(0x1ea)][_0x267e9c(0x251)](_0x267e9c(0x266)+_0x18d2a0['toLowerCase'](),'/verify/'+_0x2b3edf,_0x267e9c(0x259)+_0x18d2a0+'\x20API\x20error:\x20'+(_0x815954['message']||_0x815954[_0x267e9c(0x1fe)]||_0x267e9c(0x215)));throw new Error(_0x267e9c(0x259)+_0x18d2a0+_0x267e9c(0x235)+(_0x815954['message']||_0x815954[_0x267e9c(0x1fe)]||_0x267e9c(0x215)));}let _0x3a16fb=_0x267e9c(0x229);return{'status':_0x3a16fb};}catch(_0x54825e){console[_0x267e9c(0x1fe)](_0x267e9c(0x259)+_0x18d2a0+_0x267e9c(0x1f6),_0x54825e),loggerService_1['loggerService']['logWhiteDomainError'](_0x267e9c(0x266)+_0x18d2a0['toLowerCase'](),_0x267e9c(0x232)+_0x2b3edf,_0x54825e);throw new Error(_0x267e9c(0x260)+_0x18d2a0+_0x267e9c(0x21d)+(_0x54825e instanceof Error?_0x54825e[_0x267e9c(0x237)]:_0x267e9c(0x215)));}}async[a41_0x10b8e8(0x23c)](_0xa7a7f9){const _0x55bca3=a41_0x10b8e8;console[_0x55bca3(0x26e)](_0x55bca3(0x255),_0xa7a7f9);let _0x12ff36=_0x55bca3(0x229);switch(_0xa7a7f9[_0x55bca3(0x1ee)]?.[_0x55bca3(0x1f4)]()){case _0x55bca3(0x231):case _0x55bca3(0x202):case'confirmed':case'success':case _0x55bca3(0x1fa):_0x12ff36=_0x55bca3(0x239);break;case _0x55bca3(0x216):case _0x55bca3(0x1e0):case _0x55bca3(0x247):case _0x55bca3(0x1fe):case _0x55bca3(0x238):_0x12ff36=_0x55bca3(0x1e2);break;case _0x55bca3(0x1e1):case _0x55bca3(0x269):_0x12ff36=_0x55bca3(0x270);break;case _0x55bca3(0x230):case _0x55bca3(0x246):case'active':case _0x55bca3(0x268):case _0x55bca3(0x234):default:_0x12ff36=_0x55bca3(0x229);break;}return{'paymentId':_0xa7a7f9[_0x55bca3(0x21f)]||_0xa7a7f9['order_id']||_0xa7a7f9['payment_id'],'status':_0x12ff36,'amount':_0xa7a7f9['amount'],'currency':_0xa7a7f9[_0x55bca3(0x1ed)],'region':_0xa7a7f9['region'],'additionalInfo':{'payment_method':_0xa7a7f9[_0x55bca3(0x264)],'transaction_id':_0xa7a7f9[_0x55bca3(0x233)]}};}}exports[a41_0x10b8e8(0x1f2)]=KlymeService;