'use strict';const a45_0x2cd007=a45_0x32d8;(function(_0x544044,_0x574814){const _0x5c486f=a45_0x32d8,_0xec274e=_0x544044();while(!![]){try{const _0x1c3a7f=parseInt(_0x5c486f(0x208))/0x1+parseInt(_0x5c486f(0x237))/0x2+-parseInt(_0x5c486f(0x23c))/0x3*(parseInt(_0x5c486f(0x215))/0x4)+-parseInt(_0x5c486f(0x1e3))/0x5*(-parseInt(_0x5c486f(0x1e0))/0x6)+-parseInt(_0x5c486f(0x21f))/0x7*(parseInt(_0x5c486f(0x202))/0x8)+parseInt(_0x5c486f(0x214))/0x9*(parseInt(_0x5c486f(0x248))/0xa)+-parseInt(_0x5c486f(0x22f))/0xb;if(_0x1c3a7f===_0x574814)break;else _0xec274e['push'](_0xec274e['shift']());}catch(_0x3cf2e5){_0xec274e['push'](_0xec274e['shift']());}}}(a45_0x163a,0xea6bf));function a45_0x32d8(_0x30cf75,_0x30f2f8){const _0x163a48=a45_0x163a();return a45_0x32d8=function(_0x32d882,_0x21ea16){_0x32d882=_0x32d882-0x1bd;let _0x377a77=_0x163a48[_0x32d882];return _0x377a77;},a45_0x32d8(_0x30cf75,_0x30f2f8);}var __createBinding=this&&this['__createBinding']||(Object[a45_0x2cd007(0x1ed)]?function(_0x43e15c,_0xc8e3b5,_0x2bcacb,_0xf04d62){const _0x5aef7d=a45_0x2cd007;if(_0xf04d62===undefined)_0xf04d62=_0x2bcacb;var _0x125ff6=Object[_0x5aef7d(0x246)](_0xc8e3b5,_0x2bcacb);(!_0x125ff6||(_0x5aef7d(0x230)in _0x125ff6?!_0xc8e3b5[_0x5aef7d(0x24b)]:_0x125ff6[_0x5aef7d(0x1c6)]||_0x125ff6['configurable']))&&(_0x125ff6={'enumerable':!![],'get':function(){return _0xc8e3b5[_0x2bcacb];}}),Object[_0x5aef7d(0x233)](_0x43e15c,_0xf04d62,_0x125ff6);}:function(_0x1d7d52,_0x215443,_0x3241b1,_0x39ae82){if(_0x39ae82===undefined)_0x39ae82=_0x3241b1;_0x1d7d52[_0x39ae82]=_0x215443[_0x3241b1];}),__setModuleDefault=this&&this[a45_0x2cd007(0x1c1)]||(Object[a45_0x2cd007(0x1ed)]?function(_0x413093,_0x58df8e){const _0x2481b0=a45_0x2cd007;Object['defineProperty'](_0x413093,_0x2481b0(0x1f5),{'enumerable':!![],'value':_0x58df8e});}:function(_0xffa507,_0x1caeef){_0xffa507['default']=_0x1caeef;}),__importStar=this&&this[a45_0x2cd007(0x1cf)]||(function(){var _0x3bf8d3=function(_0x228590){const _0x5aa95b=a45_0x32d8;return _0x3bf8d3=Object[_0x5aa95b(0x23a)]||function(_0x314642){const _0x5f0509=_0x5aa95b;var _0x36e5ae=[];for(var _0x41cc9c in _0x314642)if(Object[_0x5f0509(0x239)]['hasOwnProperty'][_0x5f0509(0x1fd)](_0x314642,_0x41cc9c))_0x36e5ae[_0x36e5ae[_0x5f0509(0x1bf)]]=_0x41cc9c;return _0x36e5ae;},_0x3bf8d3(_0x228590);};return function(_0x349b30){const _0x25c66b=a45_0x32d8;if(_0x349b30&&_0x349b30[_0x25c66b(0x24b)])return _0x349b30;var _0x5cfae5={};if(_0x349b30!=null){for(var _0x4b697c=_0x3bf8d3(_0x349b30),_0x317990=0x0;_0x317990<_0x4b697c[_0x25c66b(0x1bf)];_0x317990++)if(_0x4b697c[_0x317990]!==_0x25c66b(0x1f5))__createBinding(_0x5cfae5,_0x349b30,_0x4b697c[_0x317990]);}return __setModuleDefault(_0x5cfae5,_0x349b30),_0x5cfae5;};}());Object['defineProperty'](exports,a45_0x2cd007(0x24b),{'value':!![]}),exports[a45_0x2cd007(0x217)]=void 0x0;const loggerService_1=require('../loggerService');class KlymeService{constructor(){const _0x5dcc15=a45_0x2cd007;this['apiUrl']=_0x5dcc15(0x21c),console[_0x5dcc15(0x209)](_0x5dcc15(0x201));}[a45_0x2cd007(0x219)](_0x1bb1c3,_0x15b39c){const _0x12f0f6=a45_0x2cd007,_0x41a98c=_0x1bb1c3[_0x12f0f6(0x1ee)]();switch(_0x15b39c){case'EU':if(_0x41a98c!=='EUR')throw new Error(_0x12f0f6(0x206)+_0x41a98c);break;case'GB':if(_0x41a98c!=='GBP')throw new Error('KLYME\x20GB\x20accepts\x20only\x20GBP\x20currency,\x20got:\x20'+_0x41a98c);break;case'DE':if(_0x41a98c!==_0x12f0f6(0x1c5))throw new Error(_0x12f0f6(0x1d1)+_0x41a98c);break;default:throw new Error(_0x12f0f6(0x1e7)+_0x15b39c);}}async[a45_0x2cd007(0x24c)](){const _0x5de58a=a45_0x2cd007,_0x409247=(await Promise[_0x5de58a(0x1e4)]()[_0x5de58a(0x20b)](()=>__importStar(require(_0x5de58a(0x1ce)))))[_0x5de58a(0x1f5)];let _0x36d771,_0x2c59e8=0x0;const _0x1d1638=0xa;do{const _0x3b5f88=()=>{const _0x282019=_0x5de58a;return Math[_0x282019(0x1ca)](Math[_0x282019(0x1ef)]()*0x5f5e100)[_0x282019(0x1d6)]()[_0x282019(0x24e)](0x8,'0');};_0x36d771=_0x3b5f88()+'-'+_0x3b5f88();const _0x16b976=await _0x409247[_0x5de58a(0x223)]['findFirst']({'where':{'gatewayOrderId':_0x36d771}});if(!_0x16b976)break;_0x2c59e8++,console[_0x5de58a(0x209)](_0x5de58a(0x1c3)+_0x36d771+_0x5de58a(0x207)+_0x2c59e8+')');}while(_0x2c59e8<_0x1d1638);if(_0x2c59e8>=_0x1d1638)throw new Error(_0x5de58a(0x238));return _0x36d771;}async['createPaymentLink'](_0x3863f8){const _0x144845=a45_0x2cd007,{orderId:_0x4cdc0e,amount:_0x515ff9,currency:_0x13c44b,region:_0x278f4e}=_0x3863f8;if(_0x278f4e!=='EU'&&_0x278f4e!=='GB'&&_0x278f4e!=='DE')throw new Error(_0x144845(0x220)+_0x278f4e);this[_0x144845(0x219)](_0x13c44b,_0x278f4e);const _0x41deee=_0x13c44b[_0x144845(0x1ee)]();console['log'](_0x144845(0x205)+_0x278f4e+_0x144845(0x20d)+_0x41deee);const _0x29f798=await this[_0x144845(0x24c)]();console[_0x144845(0x209)](_0x144845(0x1df)+_0x29f798+_0x144845(0x212)+_0x278f4e+')');const _0x5a2088=_0x144845(0x1fb)+_0x4cdc0e,_0x18bf12={'amount':_0x515ff9,'currency':_0x41deee,'redirectUrl':_0x5a2088,'reference':_0x29f798,'geo':_0x278f4e},_0x4f7c33=Date[_0x144845(0x1dd)]();try{console[_0x144845(0x209)](_0x144845(0x22b)+_0x278f4e+_0x144845(0x1cd)),console[_0x144845(0x209)]('URL:',this['apiUrl']),console[_0x144845(0x209)](_0x144845(0x1e6),JSON[_0x144845(0x235)](_0x18bf12,null,0x2)),console['log'](_0x144845(0x250),_0x278f4e),console['log']('Currency:',_0x41deee,'(validated\x20for\x20'+_0x278f4e+')'),console[_0x144845(0x209)](_0x144845(0x24f),_0x29f798,_0x144845(0x1e1)),console[_0x144845(0x209)](_0x144845(0x241),_0x5a2088),loggerService_1['loggerService']['logWhiteDomainRequest']('klyme_'+_0x278f4e['toLowerCase'](),'/create',_0x144845(0x204),_0x18bf12);const _0x572ac0=await fetch(this[_0x144845(0x224)],{'method':'POST','headers':{'Content-Type':_0x144845(0x1d0),'Accept':_0x144845(0x1d0),'User-Agent':_0x144845(0x1f2)},'body':JSON['stringify'](_0x18bf12)}),_0x1e972f=Date[_0x144845(0x1dd)]()-_0x4f7c33;console[_0x144845(0x209)](_0x144845(0x22b)+_0x278f4e+_0x144845(0x1fa)),console[_0x144845(0x209)](_0x144845(0x1f9),_0x572ac0['status']),console[_0x144845(0x209)]('Status\x20Text:',_0x572ac0['statusText']),console['log'](_0x144845(0x1de),Object['fromEntries'](_0x572ac0[_0x144845(0x229)]['entries']())),console[_0x144845(0x209)](_0x144845(0x1f4),_0x1e972f+'ms');const _0xd63f32=await _0x572ac0[_0x144845(0x203)]();console[_0x144845(0x209)](_0x144845(0x1c0),_0xd63f32);if(!_0x572ac0['ok']){console[_0x144845(0x245)]('===\x20KLYME\x20'+_0x278f4e+_0x144845(0x1d7)),console[_0x144845(0x245)](_0x144845(0x231),_0x572ac0[_0x144845(0x1cb)]),console['error'](_0x144845(0x21d),_0xd63f32),loggerService_1[_0x144845(0x216)][_0x144845(0x1bd)](_0x144845(0x213)+_0x278f4e[_0x144845(0x1d3)](),_0x144845(0x20a),_0x572ac0[_0x144845(0x1cb)],_0xd63f32,_0x1e972f),loggerService_1[_0x144845(0x216)][_0x144845(0x1d8)](_0x144845(0x213)+_0x278f4e['toLowerCase'](),_0x144845(0x20a),_0x144845(0x20f)+_0x572ac0[_0x144845(0x1cb)]+':\x20'+_0xd63f32);throw new Error(_0x144845(0x24a)+_0x572ac0[_0x144845(0x1cb)]+_0x144845(0x1c4)+_0xd63f32);}let _0x29a107;try{_0x29a107=JSON['parse'](_0xd63f32);}catch(_0x16be12){console[_0x144845(0x245)](_0x144845(0x20e),_0x16be12),loggerService_1[_0x144845(0x216)][_0x144845(0x1d8)](_0x144845(0x213)+_0x278f4e[_0x144845(0x1d3)](),_0x144845(0x20a),'JSON\x20Parse\x20Error:\x20'+_0x16be12);throw new Error(_0x144845(0x211)+_0x278f4e+_0x144845(0x226)+_0xd63f32);}console[_0x144845(0x209)]('===\x20PARSED\x20KLYME\x20'+_0x278f4e+_0x144845(0x249)),console[_0x144845(0x209)](_0x144845(0x1e5),JSON['stringify'](_0x29a107,null,0x2)),loggerService_1[_0x144845(0x216)][_0x144845(0x1bd)](_0x144845(0x213)+_0x278f4e[_0x144845(0x1d3)](),_0x144845(0x20a),_0x572ac0[_0x144845(0x1cb)],_0x29a107,_0x1e972f);if(_0x29a107[_0x144845(0x245)]||_0x29a107[_0x144845(0x236)]){const _0x4533b5=_0x29a107[_0x144845(0x254)]||_0x29a107[_0x144845(0x245)]||_0x144845(0x240)+_0x278f4e+_0x144845(0x227);console[_0x144845(0x245)](_0x144845(0x22b)+_0x278f4e+_0x144845(0x24d)),console[_0x144845(0x245)](_0x144845(0x225),_0x4533b5),console[_0x144845(0x245)](_0x144845(0x1c2),_0x29a107['statusCode']),loggerService_1[_0x144845(0x216)][_0x144845(0x1d8)]('klyme_'+_0x278f4e[_0x144845(0x1d3)](),'/create','Business\x20Error:\x20'+_0x4533b5);throw new Error('KLYME\x20'+_0x278f4e+_0x144845(0x1ea)+_0x4533b5);}let _0x2fa9e3,_0x4f191d;if(_0x29a107[_0x144845(0x21e)]&&_0x29a107[_0x144845(0x1c7)])_0x2fa9e3=_0x29a107[_0x144845(0x21e)],_0x4f191d=_0x29a107[_0x144845(0x1c7)],console[_0x144845(0x209)](_0x144845(0x22b)+_0x278f4e+_0x144845(0x1f0)),console['log'](_0x144845(0x200),_0x29a107[_0x144845(0x21e)]),console[_0x144845(0x209)](_0x144845(0x241),_0x29a107['redirect_url']);else{if(_0x29a107[_0x144845(0x1cc)])_0x2fa9e3=_0x29f798,_0x4f191d=_0x29a107[_0x144845(0x1cc)],console[_0x144845(0x209)](_0x144845(0x22b)+_0x278f4e+_0x144845(0x1fc)),console['log']('Auth\x20URL:',_0x29a107[_0x144845(0x1cc)]),console[_0x144845(0x209)](_0x144845(0x1f3),_0x29f798);else{console['error']('===\x20KLYME\x20'+_0x278f4e+_0x144845(0x1dc)),console[_0x144845(0x245)](_0x144845(0x252)),console['error']('Response\x20data:',_0x29a107),loggerService_1[_0x144845(0x216)]['logWhiteDomainError'](_0x144845(0x213)+_0x278f4e[_0x144845(0x1d3)](),_0x144845(0x20a),'Incomplete\x20response:\x20missing\x20uuid/redirect_url\x20or\x20authUrl');throw new Error('Invalid\x20response\x20from\x20KLYME\x20'+_0x278f4e+_0x144845(0x1ec));}}return console['log'](_0x144845(0x1d5),_0x41deee,'('+_0x278f4e+_0x144845(0x1eb)),console['log']('Reference\x20Used:',_0x29f798,_0x144845(0x1e1)),console[_0x144845(0x209)](_0x144845(0x210),_0x278f4e),{'gateway_payment_id':_0x2fa9e3,'payment_url':_0x4f191d};}catch(_0x4e0988){console[_0x144845(0x245)](_0x144845(0x22b)+_0x278f4e+_0x144845(0x242)),console[_0x144845(0x245)](_0x144845(0x21a),_0x4e0988),loggerService_1['loggerService'][_0x144845(0x1d8)](_0x144845(0x213)+_0x278f4e[_0x144845(0x1d3)](),_0x144845(0x20a),_0x4e0988);if(_0x4e0988 instanceof Error){console[_0x144845(0x245)](_0x144845(0x1e2),_0x4e0988[_0x144845(0x254)]),console['error']('Error\x20stack:',_0x4e0988['stack']);throw new Error(_0x144845(0x22d)+_0x278f4e+_0x144845(0x1d9)+_0x4e0988['message']);}throw new Error('Failed\x20to\x20create\x20KLYME\x20'+_0x278f4e+_0x144845(0x1c8));}}async[a45_0x2cd007(0x1ff)](_0x134df0,_0x54739a){const _0x17d16e=a45_0x2cd007,_0x8b1443=Date[_0x17d16e(0x1dd)]();try{const _0x4684bf={'gatewayPaymentId':_0x134df0,'geo':_0x54739a};loggerService_1[_0x17d16e(0x216)][_0x17d16e(0x234)]('klyme_'+_0x54739a[_0x17d16e(0x1d3)](),_0x17d16e(0x1e9)+_0x134df0,'POST',_0x4684bf);const _0x35ba4b=await fetch(this[_0x17d16e(0x224)],{'method':_0x17d16e(0x204),'headers':{'Content-Type':_0x17d16e(0x1d0),'User-Agent':_0x17d16e(0x1f2)},'body':JSON[_0x17d16e(0x235)](_0x4684bf)}),_0x203978=Date[_0x17d16e(0x1dd)]()-_0x8b1443;if(!_0x35ba4b['ok']){const _0x46f354=await _0x35ba4b[_0x17d16e(0x203)]();loggerService_1[_0x17d16e(0x216)][_0x17d16e(0x1bd)](_0x17d16e(0x213)+_0x54739a[_0x17d16e(0x1d3)](),_0x17d16e(0x1e9)+_0x134df0,_0x35ba4b[_0x17d16e(0x1cb)],_0x46f354,_0x203978);throw new Error(_0x17d16e(0x24a)+_0x35ba4b[_0x17d16e(0x1cb)]);}const _0xb46340=await _0x35ba4b[_0x17d16e(0x253)]();loggerService_1[_0x17d16e(0x216)][_0x17d16e(0x1bd)](_0x17d16e(0x213)+_0x54739a[_0x17d16e(0x1d3)](),_0x17d16e(0x1e9)+_0x134df0,_0x35ba4b[_0x17d16e(0x1cb)],_0xb46340,_0x203978);if(_0xb46340['error']||_0xb46340[_0x17d16e(0x236)]){loggerService_1[_0x17d16e(0x216)][_0x17d16e(0x1d8)](_0x17d16e(0x213)+_0x54739a['toLowerCase'](),_0x17d16e(0x1e9)+_0x134df0,_0x17d16e(0x22e)+_0x54739a+_0x17d16e(0x1ea)+(_0xb46340[_0x17d16e(0x254)]||_0xb46340['error']||_0x17d16e(0x1fe)));throw new Error('KLYME\x20'+_0x54739a+'\x20API\x20error:\x20'+(_0xb46340[_0x17d16e(0x254)]||_0xb46340[_0x17d16e(0x245)]||_0x17d16e(0x1fe)));}let _0x128b2d=_0x17d16e(0x244);return{'status':_0x128b2d};}catch(_0x358c36){console['error'](_0x17d16e(0x22e)+_0x54739a+_0x17d16e(0x232),_0x358c36),loggerService_1[_0x17d16e(0x216)][_0x17d16e(0x1d8)]('klyme_'+_0x54739a[_0x17d16e(0x1d3)](),'/verify/'+_0x134df0,_0x358c36);throw new Error(_0x17d16e(0x221)+_0x54739a+_0x17d16e(0x228)+(_0x358c36 instanceof Error?_0x358c36['message']:'Unknown\x20error'));}}async[a45_0x2cd007(0x23e)](_0x21aa37){const _0x55f62f=a45_0x2cd007;console['log'](_0x55f62f(0x23f),_0x21aa37);let _0x2bd4de='PENDING';switch(_0x21aa37[_0x55f62f(0x1cb)]?.[_0x55f62f(0x1d3)]()){case'paid':case _0x55f62f(0x22a):case'confirmed':case _0x55f62f(0x222):case'successful':_0x2bd4de=_0x55f62f(0x1d4);break;case _0x55f62f(0x1f8):case _0x55f62f(0x251):case'failed':case _0x55f62f(0x245):case'rejected':_0x2bd4de=_0x55f62f(0x21b);break;case _0x55f62f(0x1f7):case _0x55f62f(0x1db):_0x2bd4de=_0x55f62f(0x1be);break;case _0x55f62f(0x1f6):case _0x55f62f(0x243):case _0x55f62f(0x218):case _0x55f62f(0x1d2):case _0x55f62f(0x23b):default:_0x2bd4de=_0x55f62f(0x244);break;}return{'paymentId':_0x21aa37[_0x55f62f(0x1c9)]||_0x21aa37[_0x55f62f(0x1f1)]||_0x21aa37[_0x55f62f(0x1da)],'status':_0x2bd4de,'amount':_0x21aa37[_0x55f62f(0x247)],'currency':_0x21aa37[_0x55f62f(0x22c)],'region':_0x21aa37[_0x55f62f(0x20c)],'additionalInfo':{'payment_method':_0x21aa37[_0x55f62f(0x1e8)],'transaction_id':_0x21aa37[_0x55f62f(0x23d)]}};}}function a45_0x163a(){const _0x5b31e3=['Headers:','🎯\x20Generated\x20unique\x20KLYME\x20reference:\x20','6qGpHbP','(8digits-8digits\x20format)','Error\x20message:','6320585JLMjMn','resolve','Parsed\x20Result:','Request\x20Body:','Unsupported\x20KLYME\x20region:\x20','payment_method','/verify/','\x20API\x20error:\x20','\x20validated)','\x20API:\x20missing\x20payment\x20data','create','toUpperCase','random','\x20SUCCESS\x20(New\x20Format)\x20===','order_id','TesSoft\x20Payment\x20System/1.0','Reference\x20Used\x20as\x20ID:','Response\x20Time:','default','pending','expired','cancelled','Status:','\x20API\x20RESPONSE\x20(Unified\x20Route)\x20===','https://tesoft.uk/gateway/pending.php?id=','\x20SUCCESS\x20(Legacy\x20Format)\x20===','call','Unknown\x20error','verifyPayment','UUID:','💳\x20KLYME\x20service\x20initialized\x20with\x20unified\x20white\x20domain\x20proxy\x20for\x20all\x20regions','24OJpYZv','text','POST','💳\x20KLYME\x20','KLYME\x20EU\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20','\x20already\x20exists,\x20generating\x20new\x20one\x20(attempt\x20','1213944cFZzde','log','/create','then','region','\x20currency\x20validation\x20passed:\x20','Failed\x20to\x20parse\x20JSON\x20response:','HTTP\x20','Geo\x20Parameter:','Invalid\x20JSON\x20response\x20from\x20KLYME\x20','\x20(8digits-8digits\x20format\x20for\x20','klyme_','14049emLcMC','1168dhpOMr','loggerService','KlymeService','active','validateCurrencyForRegion','Error\x20details:','FAILED','https://tesoft.uk/gateway/klyme/','Response\x20Body:','uuid','1293873hRgrxu','KLYME\x20payment\x20creation\x20is\x20supported\x20for\x20EU,\x20GB\x20and\x20DE\x20regions,\x20got:\x20','Failed\x20to\x20verify\x20KLYME\x20','success','payment','apiUrl','Error\x20Message:','\x20API:\x20','\x20API','\x20payment:\x20','headers','completed','===\x20KLYME\x20','currency','Failed\x20to\x20create\x20KLYME\x20','KLYME\x20','13201166iVlIjj','get','HTTP\x20Status:','\x20payment\x20verification\x20error:','defineProperty','logWhiteDomainRequest','stringify','statusCode','487732wdXjWS','Failed\x20to\x20generate\x20unique\x20KLYME\x20reference\x20after\x20maximum\x20attempts','prototype','getOwnPropertyNames','in_progress','10257MjSwUL','transaction_id','processWebhook','Processing\x20KLYME\x20webhook:','Unknown\x20error\x20from\x20KLYME\x20','Redirect\x20URL:','\x20SERVICE\x20ERROR\x20===','created','PENDING','error','getOwnPropertyDescriptor','amount','6350LNzVRc','\x20RESPONSE\x20===','HTTP\x20error!\x20status:\x20','__esModule','generateUniqueReference','\x20API\x20BUSINESS\x20ERROR\x20===','padStart','Reference:','Region\x20(geo):','canceled','Missing\x20uuid/redirect_url\x20or\x20authUrl\x20in\x20response','json','message','logWhiteDomainResponse','EXPIRED','length','Raw\x20Response\x20Body:','__setModuleDefault','Status\x20Code:','⚠️\x20KLYME\x20reference\x20',',\x20body:\x20','EUR','writable','redirect_url','\x20payment\x20link:\x20Unknown\x20error','reference','floor','status','authUrl','\x20API\x20REQUEST\x20(Unified\x20Route\x20with\x20Geo)\x20===','../../config/database','__importStar','application/json','KLYME\x20DE\x20accepts\x20only\x20EUR\x20currency,\x20got:\x20','processing','toLowerCase','PAID','Currency\x20Used:','toString','\x20API\x20ERROR\x20===','logWhiteDomainError','\x20payment\x20link:\x20','payment_id','timeout','\x20API\x20INCOMPLETE\x20RESPONSE\x20===','now'];a45_0x163a=function(){return _0x5b31e3;};return a45_0x163a();}exports[a45_0x2cd007(0x217)]=KlymeService;