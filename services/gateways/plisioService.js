'use strict';const a41_0x5b7e6f=a41_0x1113;(function(_0x491dbf,_0x2b274d){const _0x420e56=a41_0x1113,_0x3750dc=_0x491dbf();while(!![]){try{const _0x6c5257=-parseInt(_0x420e56(0x194))/0x1+parseInt(_0x420e56(0x1b1))/0x2*(parseInt(_0x420e56(0x14c))/0x3)+parseInt(_0x420e56(0x15b))/0x4*(parseInt(_0x420e56(0x197))/0x5)+parseInt(_0x420e56(0x176))/0x6*(parseInt(_0x420e56(0x14b))/0x7)+parseInt(_0x420e56(0x158))/0x8+-parseInt(_0x420e56(0x166))/0x9*(parseInt(_0x420e56(0x153))/0xa)+parseInt(_0x420e56(0x179))/0xb*(-parseInt(_0x420e56(0x142))/0xc);if(_0x6c5257===_0x2b274d)break;else _0x3750dc['push'](_0x3750dc['shift']());}catch(_0x161993){_0x3750dc['push'](_0x3750dc['shift']());}}}(a41_0x36af,0x18c20));function a41_0x36af(){const _0x48e288=['Amount:','amount','68991bpeIhL','/invoices/new','Plisio\x20API\x20key\x20is\x20not\x20configured','611635IEbXWF','PLISIO_API_KEY','invoice_total_sum','HTTP\x20Status:','Raw\x20Response\x20Body:','Full\x20URL\x20(without\x20API\x20key):','parse','Parsed\x20Result:','===\x20PLISIO\x20API\x20ERROR\x20===','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Plisio\x20API\x20error:\x20','pending','data','success','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Error\x20details:','replace','Processing\x20Plisio\x20webhook:','message','PAID','application/json','Status\x20Text:','TesSoft\x20Payment\x20System/1.0','qr_code','(fiat\x20for\x20merchant)','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','85880qOzMbv','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','txn_id','logWhiteDomainResponse','12mEkkPh','JSON\x20Parse\x20Error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','error','Invoice\x20URL:','email','cancelled','fromEntries','HTTP\x20error!\x20status:\x20','147nLaVkG','12qAoiSm','/operations/','text','log','processWebhook','loggerService','Response\x20Body:','439710ZtPGUR','Error\x20stack:','apiKey','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','invoice_url','150080wtjMRM','statusText','Plisio\x20payment\x20verification\x20error:','4ljyjKe','qr_url','source_currency','stringify','PlisioService','env','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','entries','defineProperty','GET','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','9qDUaNz','apiUrl','Unknown\x20error','logWhiteDomainError','https://api.plisio.net/api/v1/operations/','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Response\x20data:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Business\x20Error:\x20','toString','Unknown\x20error\x20from\x20Plisio\x20API','Source\x20Currency:','mismatch','verifyPayment','FAILED','20442gqeUqk','plisio_direct','status','1870264QDQlwY','now','__esModule','https://api.trapay.uk/api/webhooks/gateway/plisio','order_number','HTTP\x20','append','currency','Error\x20message:','Transaction\x20ID:','PENDING','completed','Error\x20Message:','logWhiteDomainRequest','===\x20PLISIO\x20SUCCESS\x20===','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===',',\x20body:\x20','warn','Status:','toLowerCase','json','../loggerService','HIDDEN','expired','EXPIRED'];a41_0x36af=function(){return _0x48e288;};return a41_0x36af();}function a41_0x1113(_0x2f36d4,_0x141dd3){const _0x36aff8=a41_0x36af();return a41_0x1113=function(_0x111367,_0x529025){_0x111367=_0x111367-0x13f;let _0x126c1a=_0x36aff8[_0x111367];return _0x126c1a;},a41_0x1113(_0x2f36d4,_0x141dd3);}Object[a41_0x5b7e6f(0x163)](exports,a41_0x5b7e6f(0x17b),{'value':!![]}),exports[a41_0x5b7e6f(0x15f)]=void 0x0;const loggerService_1=require(a41_0x5b7e6f(0x18e));class PlisioService{constructor(){const _0x8f54ab=a41_0x5b7e6f;this[_0x8f54ab(0x167)]='https://api.plisio.net/api/v1/invoices/new',this['apiKey']=process[_0x8f54ab(0x160)][_0x8f54ab(0x198)]||'',!this['apiKey']?console[_0x8f54ab(0x18a)](_0x8f54ab(0x156)):console[_0x8f54ab(0x14f)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async['createPayment'](_0x5aa5b0){const _0x41b162=a41_0x5b7e6f,{orderId:_0x3fef8a,amount:_0x2182bd,currency:_0x58a8e2,productName:_0x1dc475,description:_0x2313a6,successUrl:_0x2462be,failUrl:_0x136447,customerEmail:_0x1f7525,customerName:_0x2c0be9,isSourceCurrency:_0x41d322,sourceCurrency:_0x53b746}=_0x5aa5b0;if(!this[_0x41b162(0x155)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x4419fa=new URLSearchParams({'api_key':this[_0x41b162(0x155)],'order_number':_0x3fef8a,'order_name':_0x1dc475,'description':_0x2313a6,'success_url':_0x2462be,'fail_url':_0x136447,'callback_url':_0x41b162(0x17c)});_0x53b746?(_0x4419fa[_0x41b162(0x17f)](_0x41b162(0x180),_0x53b746),_0x4419fa[_0x41b162(0x17f)](_0x41b162(0x15d),_0x58a8e2),_0x4419fa[_0x41b162(0x17f)]('source_amount',_0x2182bd[_0x41b162(0x170)]())):(_0x4419fa[_0x41b162(0x17f)]('currency',_0x58a8e2),_0x4419fa['append'](_0x41b162(0x193),_0x2182bd[_0x41b162(0x170)]()));_0x1f7525&&_0x4419fa['append'](_0x41b162(0x147),_0x1f7525);_0x2c0be9&&_0x4419fa['append']('name',_0x2c0be9);const _0x2b713c=this[_0x41b162(0x167)]+'?'+_0x4419fa[_0x41b162(0x170)](),_0x291d53=Date[_0x41b162(0x17a)]();try{console[_0x41b162(0x14f)](_0x41b162(0x16e)),console['log']('URL:',this[_0x41b162(0x167)]),console[_0x41b162(0x14f)]('Parameters:',Object[_0x41b162(0x149)](_0x4419fa[_0x41b162(0x162)]())),console['log'](_0x41b162(0x19c),_0x2b713c[_0x41b162(0x1a7)](this[_0x41b162(0x155)],_0x41b162(0x18f))),loggerService_1[_0x41b162(0x151)][_0x41b162(0x186)](_0x41b162(0x177),_0x41b162(0x195),_0x41b162(0x164),Object[_0x41b162(0x149)](_0x4419fa[_0x41b162(0x162)]()));const _0x503512=await fetch(_0x2b713c,{'method':_0x41b162(0x164),'headers':{'Accept':_0x41b162(0x1ab),'User-Agent':_0x41b162(0x1ad)}}),_0x4b73f6=Date[_0x41b162(0x17a)]()-_0x291d53;console[_0x41b162(0x14f)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x41b162(0x14f)](_0x41b162(0x18b),_0x503512[_0x41b162(0x178)]),console['log'](_0x41b162(0x1ac),_0x503512[_0x41b162(0x159)]),console[_0x41b162(0x14f)]('Response\x20Time:',_0x4b73f6+'ms');const _0x1d9bec=await _0x503512[_0x41b162(0x14e)]();console[_0x41b162(0x14f)](_0x41b162(0x19b),_0x1d9bec);if(!_0x503512['ok']){console[_0x41b162(0x145)](_0x41b162(0x19f)),console[_0x41b162(0x145)](_0x41b162(0x19a),_0x503512[_0x41b162(0x178)]),console[_0x41b162(0x145)](_0x41b162(0x152),_0x1d9bec),loggerService_1[_0x41b162(0x151)][_0x41b162(0x141)](_0x41b162(0x177),_0x41b162(0x195),_0x503512[_0x41b162(0x178)],_0x1d9bec,_0x4b73f6),loggerService_1['loggerService'][_0x41b162(0x169)](_0x41b162(0x177),_0x41b162(0x195),_0x41b162(0x17e)+_0x503512[_0x41b162(0x178)]+':\x20'+_0x1d9bec);throw new Error(_0x41b162(0x14a)+_0x503512[_0x41b162(0x178)]+_0x41b162(0x189)+_0x1d9bec);}let _0x3989ed;try{_0x3989ed=JSON[_0x41b162(0x19d)](_0x1d9bec);}catch(_0x2c4838){console[_0x41b162(0x145)](_0x41b162(0x144),_0x2c4838),loggerService_1[_0x41b162(0x151)]['logWhiteDomainError'](_0x41b162(0x177),_0x41b162(0x195),_0x41b162(0x143)+_0x2c4838);throw new Error(_0x41b162(0x161)+_0x1d9bec);}console['log'](_0x41b162(0x13f)),console[_0x41b162(0x14f)](_0x41b162(0x19e),JSON[_0x41b162(0x15e)](_0x3989ed,null,0x2)),loggerService_1['loggerService'][_0x41b162(0x141)](_0x41b162(0x177),'/invoices/new',_0x503512[_0x41b162(0x178)],_0x3989ed,_0x4b73f6);if(_0x3989ed[_0x41b162(0x178)]!==_0x41b162(0x1a4)){const _0x40ea96=_0x3989ed[_0x41b162(0x1a9)]||_0x3989ed[_0x41b162(0x145)]||_0x41b162(0x171);console['error'](_0x41b162(0x188)),console['error'](_0x41b162(0x185),_0x40ea96),loggerService_1[_0x41b162(0x151)][_0x41b162(0x169)](_0x41b162(0x177),_0x41b162(0x195),_0x41b162(0x16f)+_0x40ea96);throw new Error('Plisio\x20API\x20error:\x20'+_0x40ea96);}if(!_0x3989ed['data']?.['txn_id']||!_0x3989ed['data']?.['invoice_url']){console[_0x41b162(0x145)](_0x41b162(0x165)),console['error'](_0x41b162(0x1b0)),console[_0x41b162(0x145)](_0x41b162(0x16c),_0x3989ed['data']),loggerService_1[_0x41b162(0x151)][_0x41b162(0x169)]('plisio_direct',_0x41b162(0x195),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x41b162(0x16d));}return console[_0x41b162(0x14f)](_0x41b162(0x187)),console[_0x41b162(0x14f)](_0x41b162(0x182),_0x3989ed[_0x41b162(0x1a3)]['txn_id']),console[_0x41b162(0x14f)](_0x41b162(0x146),_0x3989ed[_0x41b162(0x1a3)][_0x41b162(0x157)]),console[_0x41b162(0x14f)](_0x41b162(0x192),_0x2182bd,_0x58a8e2),_0x53b746&&(console[_0x41b162(0x14f)](_0x41b162(0x172),_0x53b746,'(crypto\x20for\x20payment)'),console[_0x41b162(0x14f)]('Target\x20Currency:',_0x58a8e2,_0x41b162(0x1af))),{'gateway_payment_id':_0x3989ed[_0x41b162(0x1a3)][_0x41b162(0x140)],'payment_url':_0x3989ed[_0x41b162(0x1a3)][_0x41b162(0x157)],'invoice_total_sum':_0x3989ed[_0x41b162(0x1a3)][_0x41b162(0x199)],'qr_code':_0x3989ed[_0x41b162(0x1a3)][_0x41b162(0x1ae)],'qr_url':_0x3989ed[_0x41b162(0x1a3)][_0x41b162(0x15c)]};}catch(_0x29021f){console[_0x41b162(0x145)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x41b162(0x145)](_0x41b162(0x1a6),_0x29021f),loggerService_1[_0x41b162(0x151)][_0x41b162(0x169)](_0x41b162(0x177),_0x41b162(0x195),_0x29021f);if(_0x29021f instanceof Error){console[_0x41b162(0x145)](_0x41b162(0x181),_0x29021f[_0x41b162(0x1a9)]),console[_0x41b162(0x145)](_0x41b162(0x154),_0x29021f['stack']);throw new Error(_0x41b162(0x16b)+_0x29021f['message']);}throw new Error(_0x41b162(0x1a5));}}async[a41_0x5b7e6f(0x174)](_0x155e86){const _0x51a023=a41_0x5b7e6f,_0x42ef54=Date[_0x51a023(0x17a)]();try{if(!this[_0x51a023(0x155)])throw new Error(_0x51a023(0x196));const _0x202b23=new URLSearchParams({'api_key':this[_0x51a023(0x155)],'txn_id':_0x155e86}),_0x542fbb=_0x51a023(0x16a)+_0x155e86+'?'+_0x202b23[_0x51a023(0x170)]();loggerService_1[_0x51a023(0x151)][_0x51a023(0x186)](_0x51a023(0x177),'/operations/'+_0x155e86,_0x51a023(0x164),Object[_0x51a023(0x149)](_0x202b23[_0x51a023(0x162)]()));const _0x18cac4=await fetch(_0x542fbb,{'method':_0x51a023(0x164),'headers':{'Accept':_0x51a023(0x1ab),'User-Agent':_0x51a023(0x1ad)}}),_0x51d65d=Date[_0x51a023(0x17a)]()-_0x42ef54;if(!_0x18cac4['ok']){const _0x3e812d=await _0x18cac4[_0x51a023(0x14e)]();loggerService_1[_0x51a023(0x151)][_0x51a023(0x141)](_0x51a023(0x177),'/operations/'+_0x155e86,_0x18cac4['status'],_0x3e812d,_0x51d65d);throw new Error('HTTP\x20error!\x20status:\x20'+_0x18cac4[_0x51a023(0x178)]);}const _0x1a01b5=await _0x18cac4[_0x51a023(0x18d)]();loggerService_1[_0x51a023(0x151)][_0x51a023(0x141)](_0x51a023(0x177),_0x51a023(0x14d)+_0x155e86,_0x18cac4[_0x51a023(0x178)],_0x1a01b5,_0x51d65d);if(_0x1a01b5[_0x51a023(0x178)]!=='success'){loggerService_1[_0x51a023(0x151)]['logWhiteDomainError'](_0x51a023(0x177),'/operations/'+_0x155e86,_0x51a023(0x1a1)+(_0x1a01b5[_0x51a023(0x1a9)]||_0x1a01b5[_0x51a023(0x145)]||'Unknown\x20error'));throw new Error(_0x51a023(0x1a1)+(_0x1a01b5[_0x51a023(0x1a9)]||_0x1a01b5[_0x51a023(0x145)]||'Unknown\x20error'));}let _0x20842a=_0x51a023(0x183);return{'status':_0x20842a};}catch(_0x4b3c9f){console[_0x51a023(0x145)](_0x51a023(0x15a),_0x4b3c9f),loggerService_1[_0x51a023(0x151)]['logWhiteDomainError'](_0x51a023(0x177),_0x51a023(0x14d)+_0x155e86,_0x4b3c9f);throw new Error(_0x51a023(0x1a0)+(_0x4b3c9f instanceof Error?_0x4b3c9f[_0x51a023(0x1a9)]:_0x51a023(0x168)));}}async[a41_0x5b7e6f(0x150)](_0x528901){const _0x44799f=a41_0x5b7e6f;console['log'](_0x44799f(0x1a8),_0x528901);let _0x92dfb0=_0x44799f(0x183);switch(_0x528901['status']?.[_0x44799f(0x18c)]()){case _0x44799f(0x184):case _0x44799f(0x173):_0x92dfb0=_0x44799f(0x1aa);break;case _0x44799f(0x190):_0x92dfb0=_0x44799f(0x191);break;case _0x44799f(0x145):case _0x44799f(0x148):_0x92dfb0=_0x44799f(0x175);break;case'new':case _0x44799f(0x1a2):default:_0x92dfb0=_0x44799f(0x183);break;}return{'paymentId':_0x528901[_0x44799f(0x17d)]||'','status':_0x92dfb0,'amount':_0x528901['amount'],'currency':_0x528901[_0x44799f(0x180)]};}}exports[a41_0x5b7e6f(0x15f)]=PlisioService;