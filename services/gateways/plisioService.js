'use strict';const a45_0x2368d6=a45_0x2f7a;(function(_0x4b481a,_0x4ab425){const _0x215f98=a45_0x2f7a,_0x4733a1=_0x4b481a();while(!![]){try{const _0x5e98ed=-parseInt(_0x215f98(0x1db))/0x1+-parseInt(_0x215f98(0x1ba))/0x2+parseInt(_0x215f98(0x1e3))/0x3*(parseInt(_0x215f98(0x1b9))/0x4)+-parseInt(_0x215f98(0x1ef))/0x5*(-parseInt(_0x215f98(0x1eb))/0x6)+parseInt(_0x215f98(0x20c))/0x7+parseInt(_0x215f98(0x1b8))/0x8*(-parseInt(_0x215f98(0x1c5))/0x9)+parseInt(_0x215f98(0x1d9))/0xa*(parseInt(_0x215f98(0x1f3))/0xb);if(_0x5e98ed===_0x4ab425)break;else _0x4733a1['push'](_0x4733a1['shift']());}catch(_0x3b07c7){_0x4733a1['push'](_0x4733a1['shift']());}}}(a45_0x427f,0x7fa01));function a45_0x2f7a(_0x1d92f1,_0x2aa772){const _0x427f87=a45_0x427f();return a45_0x2f7a=function(_0x2f7a81,_0x4d88fd){_0x2f7a81=_0x2f7a81-0x1b6;let _0x358420=_0x427f87[_0x2f7a81];return _0x358420;},a45_0x2f7a(_0x1d92f1,_0x2aa772);}Object[a45_0x2368d6(0x1e2)](exports,a45_0x2368d6(0x223),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a45_0x2368d6(0x1fc));class PlisioService{constructor(){const _0xf47730=a45_0x2368d6;this[_0xf47730(0x1c0)]=_0xf47730(0x1ee),this[_0xf47730(0x1c9)]=process[_0xf47730(0x210)][_0xf47730(0x1f1)]||'',!this[_0xf47730(0x1c9)]?console[_0xf47730(0x218)](_0xf47730(0x224)):console['log'](_0xf47730(0x201));}async[a45_0x2368d6(0x1b6)](_0x20e71d){const _0x2e93fd=a45_0x2368d6,{orderId:_0x14f0bc,amount:_0x20473e,currency:_0xf79e73,productName:_0x228247,description:_0x2ddfd7,successUrl:_0x2e8360,failUrl:_0x2d77bd,customerEmail:_0x32daf1,customerName:_0x18a5e8,isSourceCurrency:_0x29c90e,sourceCurrency:_0x5e08c9}=_0x20e71d;if(!this['apiKey'])throw new Error(_0x2e93fd(0x1e5));const _0x331eec=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x14f0bc,'order_name':_0x228247,'description':_0x2ddfd7,'success_url':_0x2e8360,'fail_url':_0x2d77bd,'callback_url':_0x2e93fd(0x1cd)});_0x5e08c9?(_0x331eec['append']('currency',_0x5e08c9),_0x331eec[_0x2e93fd(0x1fe)](_0x2e93fd(0x1e8),_0xf79e73),_0x331eec[_0x2e93fd(0x1fe)]('source_amount',_0x20473e['toString']())):(_0x331eec['append'](_0x2e93fd(0x1ca),_0xf79e73),_0x331eec[_0x2e93fd(0x1fe)](_0x2e93fd(0x1c2),_0x20473e['toString']()));_0x32daf1&&_0x331eec['append'](_0x2e93fd(0x202),_0x32daf1);_0x18a5e8&&_0x331eec[_0x2e93fd(0x1fe)](_0x2e93fd(0x205),_0x18a5e8);const _0xb59f86=this['apiUrl']+'?'+_0x331eec[_0x2e93fd(0x1de)](),_0x33ee53=Date[_0x2e93fd(0x1c8)]();try{console[_0x2e93fd(0x1f5)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x2e93fd(0x1f5)](_0x2e93fd(0x1e6),this[_0x2e93fd(0x1c0)]),console[_0x2e93fd(0x1f5)]('Parameters:',Object[_0x2e93fd(0x222)](_0x331eec[_0x2e93fd(0x21a)]())),console['log'](_0x2e93fd(0x1d6),_0xb59f86[_0x2e93fd(0x1e1)](this[_0x2e93fd(0x1c9)],_0x2e93fd(0x1d3))),loggerService_1['loggerService'][_0x2e93fd(0x1f6)](_0x2e93fd(0x1fa),_0x2e93fd(0x1d2),'GET',Object['fromEntries'](_0x331eec['entries']()));const _0x5eaa19=await fetch(_0xb59f86,{'method':_0x2e93fd(0x20d),'headers':{'Accept':_0x2e93fd(0x1f2),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x2aa116=Date[_0x2e93fd(0x1c8)]()-_0x33ee53;console['log'](_0x2e93fd(0x21c)),console['log'](_0x2e93fd(0x213),_0x5eaa19['status']),console[_0x2e93fd(0x1f5)](_0x2e93fd(0x20e),_0x5eaa19[_0x2e93fd(0x1c7)]),console[_0x2e93fd(0x1f5)]('Response\x20Time:',_0x2aa116+'ms');const _0x2da468=await _0x5eaa19[_0x2e93fd(0x1e7)]();console['log']('Raw\x20Response\x20Body:',_0x2da468);if(!_0x5eaa19['ok']){console[_0x2e93fd(0x1e0)](_0x2e93fd(0x21e)),console[_0x2e93fd(0x1e0)](_0x2e93fd(0x1c1),_0x5eaa19[_0x2e93fd(0x21b)]),console[_0x2e93fd(0x1e0)](_0x2e93fd(0x1c3),_0x2da468),loggerService_1[_0x2e93fd(0x1d0)][_0x2e93fd(0x1bb)](_0x2e93fd(0x1fa),_0x2e93fd(0x1d2),_0x5eaa19[_0x2e93fd(0x21b)],_0x2da468,_0x2aa116),loggerService_1[_0x2e93fd(0x1d0)]['logWhiteDomainError']('plisio_direct','/invoices/new',_0x2e93fd(0x1f4)+_0x5eaa19['status']+':\x20'+_0x2da468);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5eaa19[_0x2e93fd(0x21b)]+_0x2e93fd(0x20b)+_0x2da468);}let _0x1b0cab;try{_0x1b0cab=JSON['parse'](_0x2da468);}catch(_0xbf3ae6){console['error'](_0x2e93fd(0x1ed),_0xbf3ae6),loggerService_1['loggerService']['logWhiteDomainError'](_0x2e93fd(0x1fa),_0x2e93fd(0x1d2),_0x2e93fd(0x1cf)+_0xbf3ae6);throw new Error(_0x2e93fd(0x1f7)+_0x2da468);}console[_0x2e93fd(0x1f5)](_0x2e93fd(0x211)),console['log'](_0x2e93fd(0x228),JSON[_0x2e93fd(0x209)](_0x1b0cab,null,0x2)),loggerService_1[_0x2e93fd(0x1d0)]['logWhiteDomainResponse'](_0x2e93fd(0x1fa),'/invoices/new',_0x5eaa19[_0x2e93fd(0x21b)],_0x1b0cab,_0x2aa116);if(_0x1b0cab[_0x2e93fd(0x21b)]!=='success'){const _0x14af0d=_0x1b0cab['message']||_0x1b0cab[_0x2e93fd(0x1e0)]||_0x2e93fd(0x215);console[_0x2e93fd(0x1e0)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x2e93fd(0x1e0)]('Error\x20Message:',_0x14af0d),loggerService_1[_0x2e93fd(0x1d0)][_0x2e93fd(0x1f8)](_0x2e93fd(0x1fa),_0x2e93fd(0x1d2),'Business\x20Error:\x20'+_0x14af0d);throw new Error('Plisio\x20API\x20error:\x20'+_0x14af0d);}if(!_0x1b0cab[_0x2e93fd(0x1cc)]?.['txn_id']||!_0x1b0cab['data']?.[_0x2e93fd(0x1ec)]){console['error']('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2e93fd(0x1e0)](_0x2e93fd(0x1da)),console['error'](_0x2e93fd(0x1dc),_0x1b0cab[_0x2e93fd(0x1cc)]),loggerService_1[_0x2e93fd(0x1d0)][_0x2e93fd(0x1f8)](_0x2e93fd(0x1fa),_0x2e93fd(0x1d2),_0x2e93fd(0x20f));throw new Error(_0x2e93fd(0x226));}return console[_0x2e93fd(0x1f5)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x2e93fd(0x1f5)]('Transaction\x20ID:',_0x1b0cab[_0x2e93fd(0x1cc)][_0x2e93fd(0x220)]),console[_0x2e93fd(0x1f5)]('Invoice\x20URL:',_0x1b0cab[_0x2e93fd(0x1cc)][_0x2e93fd(0x1ec)]),console[_0x2e93fd(0x1f5)](_0x2e93fd(0x1cb),_0x20473e,_0xf79e73),_0x5e08c9&&(console[_0x2e93fd(0x1f5)]('Source\x20Currency:',_0x5e08c9,'(crypto\x20for\x20payment)'),console[_0x2e93fd(0x1f5)](_0x2e93fd(0x212),_0xf79e73,_0x2e93fd(0x206))),{'gateway_payment_id':_0x1b0cab['data']['txn_id'],'payment_url':_0x1b0cab[_0x2e93fd(0x1cc)]['invoice_url'],'invoice_total_sum':_0x1b0cab[_0x2e93fd(0x1cc)][_0x2e93fd(0x20a)],'qr_code':_0x1b0cab['data']['qr_code'],'qr_url':_0x1b0cab[_0x2e93fd(0x1cc)][_0x2e93fd(0x21f)]};}catch(_0x349522){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x2e93fd(0x1e0)](_0x2e93fd(0x204),_0x349522),loggerService_1[_0x2e93fd(0x1d0)][_0x2e93fd(0x1f8)]('plisio_direct',_0x2e93fd(0x1d2),_0x349522);if(_0x349522 instanceof Error){console[_0x2e93fd(0x1e0)](_0x2e93fd(0x219),_0x349522[_0x2e93fd(0x1ea)]),console[_0x2e93fd(0x1e0)]('Error\x20stack:',_0x349522[_0x2e93fd(0x208)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x349522['message']);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a45_0x2368d6(0x203)](_0x5541b4){const _0x5ba661=a45_0x2368d6,_0x301ad8=Date[_0x5ba661(0x1c8)]();try{if(!this[_0x5ba661(0x1c9)])throw new Error(_0x5ba661(0x1e5));const _0x4b4bed=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x5541b4}),_0x39df0e='https://api.plisio.net/api/v1/operations/'+_0x5541b4+'?'+_0x4b4bed[_0x5ba661(0x1de)]();loggerService_1[_0x5ba661(0x1d0)][_0x5ba661(0x1f6)]('plisio_direct',_0x5ba661(0x1b7)+_0x5541b4,_0x5ba661(0x20d),Object[_0x5ba661(0x222)](_0x4b4bed[_0x5ba661(0x21a)]()));const _0x319867=await fetch(_0x39df0e,{'method':_0x5ba661(0x20d),'headers':{'Accept':_0x5ba661(0x1f2),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x4078a7=Date[_0x5ba661(0x1c8)]()-_0x301ad8;if(!_0x319867['ok']){const _0x556d1c=await _0x319867['text']();loggerService_1[_0x5ba661(0x1d0)]['logWhiteDomainResponse'](_0x5ba661(0x1fa),'/operations/'+_0x5541b4,_0x319867[_0x5ba661(0x21b)],_0x556d1c,_0x4078a7);throw new Error(_0x5ba661(0x1d7)+_0x319867[_0x5ba661(0x21b)]);}const _0x53b6dd=await _0x319867[_0x5ba661(0x1d4)]();loggerService_1[_0x5ba661(0x1d0)]['logWhiteDomainResponse'](_0x5ba661(0x1fa),_0x5ba661(0x1b7)+_0x5541b4,_0x319867['status'],_0x53b6dd,_0x4078a7);if(_0x53b6dd['status']!=='success'){loggerService_1[_0x5ba661(0x1d0)]['logWhiteDomainError'](_0x5ba661(0x1fa),_0x5ba661(0x1b7)+_0x5541b4,_0x5ba661(0x227)+(_0x53b6dd[_0x5ba661(0x1ea)]||_0x53b6dd[_0x5ba661(0x1e0)]||_0x5ba661(0x1bc)));throw new Error(_0x5ba661(0x227)+(_0x53b6dd['message']||_0x53b6dd[_0x5ba661(0x1e0)]||_0x5ba661(0x1bc)));}let _0x8708c2=_0x5ba661(0x21d);return{'status':_0x8708c2};}catch(_0x357172){console[_0x5ba661(0x1e0)](_0x5ba661(0x1e9),_0x357172),loggerService_1[_0x5ba661(0x1d0)][_0x5ba661(0x1f8)](_0x5ba661(0x1fa),_0x5ba661(0x1b7)+_0x5541b4,_0x357172);throw new Error(_0x5ba661(0x1e4)+(_0x357172 instanceof Error?_0x357172[_0x5ba661(0x1ea)]:_0x5ba661(0x1bc)));}}async['processWebhook'](_0x21cd33){const _0x3447ab=a45_0x2368d6;console['log'](_0x3447ab(0x1c4),_0x21cd33);let _0x420963=_0x3447ab(0x21d);switch(_0x21cd33[_0x3447ab(0x21b)]?.[_0x3447ab(0x1fb)]()){case _0x3447ab(0x1d1):case _0x3447ab(0x1f0):_0x420963='PAID';break;case _0x3447ab(0x1ff):_0x420963=_0x3447ab(0x217);break;case'error':case _0x3447ab(0x200):_0x420963=_0x3447ab(0x1bf);break;case _0x3447ab(0x1c6):_0x420963='PENDING';break;case _0x3447ab(0x1bd):_0x420963=_0x3447ab(0x1be);break;default:_0x420963=_0x3447ab(0x21d);break;}let _0x316258;if(_0x21cd33['tx_urls'])try{console[_0x3447ab(0x1f5)]('🔗\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x21cd33['tx_urls']);let _0x2de101;if(typeof _0x21cd33['tx_urls']==='string')_0x2de101=JSON[_0x3447ab(0x207)](_0x21cd33[_0x3447ab(0x214)]);else Array[_0x3447ab(0x1d8)](_0x21cd33[_0x3447ab(0x214)])?_0x2de101=_0x21cd33[_0x3447ab(0x214)]:_0x2de101=[];_0x316258=_0x2de101['map'](_0x4d68e6=>{const _0x6b0b2a=_0x3447ab,_0x3632a5=_0x4d68e6[_0x6b0b2a(0x1e1)](/\\/g,'');return console[_0x6b0b2a(0x1f5)](_0x6b0b2a(0x216)+_0x4d68e6+_0x6b0b2a(0x1d5)+_0x3632a5),_0x3632a5;}),console[_0x3447ab(0x1f5)]('✅\x20Processed\x20tx_urls:',_0x316258),_0x316258[_0x3447ab(0x1f9)]((_0x403386,_0x3ad497)=>{const _0x1ba7d4=_0x3447ab;try{new URL(_0x403386),console[_0x1ba7d4(0x1f5)](_0x1ba7d4(0x221)+(_0x3ad497+0x1)+_0x1ba7d4(0x1fd)+_0x403386);}catch(_0x500ca4){console[_0x1ba7d4(0x1e0)](_0x1ba7d4(0x1ce)+(_0x3ad497+0x1)+_0x1ba7d4(0x225)+_0x403386,_0x500ca4);}});}catch(_0x1ec9cf){console[_0x3447ab(0x1e0)]('❌\x20Failed\x20to\x20parse\x20tx_urls:',_0x1ec9cf),console[_0x3447ab(0x1e0)](_0x3447ab(0x1df),_0x21cd33[_0x3447ab(0x214)]),_0x316258=undefined;}return{'paymentId':_0x21cd33[_0x3447ab(0x1dd)]||'','status':_0x420963,'amount':_0x21cd33[_0x3447ab(0x1c2)],'currency':_0x21cd33[_0x3447ab(0x1ca)],'txUrls':_0x316258};}}exports['PlisioService']=PlisioService;function a45_0x427f(){const _0x37283e=['tx_urls','Unknown\x20error\x20from\x20Plisio\x20API','🔗\x20Formatted\x20URL:\x20','EXPIRED','warn','Error\x20message:','entries','status','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','PENDING','===\x20PLISIO\x20API\x20ERROR\x20===','qr_url','txn_id','✅\x20URL\x20','fromEntries','__esModule','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','\x20is\x20invalid:\x20','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Plisio\x20API\x20error:\x20','Parsed\x20Result:','createPayment','/operations/','1649328xxVjGJ','17628lDsDdc','1889896RKrFVc','logWhiteDomainResponse','Unknown\x20error','pending','PROCESSING','FAILED','apiUrl','HTTP\x20Status:','amount','Response\x20Body:','Processing\x20Plisio\x20webhook:','9OgySPL','new','statusText','now','apiKey','currency','Amount:','data','https://api.trapay.uk/api/webhooks/gateway/plisio','❌\x20URL\x20','JSON\x20Parse\x20Error:\x20','loggerService','completed','/invoices/new','HIDDEN','json','\x20->\x20','Full\x20URL\x20(without\x20API\x20key):','HTTP\x20error!\x20status:\x20','isArray','3991940XeWYjV','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','781394jqJpjY','Response\x20data:','order_number','toString','Raw\x20tx_urls\x20data:','error','replace','defineProperty','477WfVCkX','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','URL:','text','source_currency','Plisio\x20payment\x20verification\x20error:','message','6ygqDUD','invoice_url','Failed\x20to\x20parse\x20JSON\x20response:','https://api.plisio.net/api/v1/invoices/new','3164185DgerjP','mismatch','PLISIO_API_KEY','application/json','22CxGueA','HTTP\x20','log','logWhiteDomainRequest','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','logWhiteDomainError','forEach','plisio_direct','toLowerCase','../loggerService','\x20is\x20valid:\x20','append','expired','cancelled','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','email','verifyPayment','Error\x20details:','name','(fiat\x20for\x20merchant)','parse','stack','stringify','invoice_total_sum',',\x20body:\x20','2263261iHgIAA','GET','Status\x20Text:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','env','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Target\x20Currency:','Status:'];a45_0x427f=function(){return _0x37283e;};return a45_0x427f();}