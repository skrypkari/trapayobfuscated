'use strict';const a55_0x1f59fb=a55_0x4af7;(function(_0x2f298d,_0x2b67c0){const _0x17c8a=a55_0x4af7,_0x467c84=_0x2f298d();while(!![]){try{const _0xf73277=-parseInt(_0x17c8a(0x1fb))/0x1+-parseInt(_0x17c8a(0x213))/0x2+parseInt(_0x17c8a(0x234))/0x3*(parseInt(_0x17c8a(0x1d1))/0x4)+-parseInt(_0x17c8a(0x202))/0x5*(-parseInt(_0x17c8a(0x1da))/0x6)+parseInt(_0x17c8a(0x1e8))/0x7+-parseInt(_0x17c8a(0x1f9))/0x8+parseInt(_0x17c8a(0x204))/0x9;if(_0xf73277===_0x2b67c0)break;else _0x467c84['push'](_0x467c84['shift']());}catch(_0x527086){_0x467c84['push'](_0x467c84['shift']());}}}(a55_0x43b6,0x553d9));Object[a55_0x1f59fb(0x1d2)](exports,'__esModule',{'value':!![]}),exports[a55_0x1f59fb(0x239)]=void 0x0;function a55_0x43b6(){const _0x5713f8=['Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','stringify','verifyPayment','parse','Plisio\x20API\x20error:\x20','Plisio\x20payment\x20verification\x20error:','Parameters:','PAID','EXPIRED','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','===\x20PLISIO\x20SUCCESS\x20===','now','https://api.plisio.net/api/v1/invoices/new','completed','invoice_total_sum','(crypto\x20for\x20payment)','üîó\x20Formatted\x20URL:\x20','2463036beWCfQ','defineProperty','Error\x20Message:','PLISIO_API_KEY','map','‚úÖ\x20URL\x20','/invoices/new','warn','forEach','43986VKKCQt','\x20->\x20','Unknown\x20error\x20from\x20Plisio\x20API','Response\x20Time:','Amount:','Error\x20message:','string','https://api.trapay.uk/api/webhooks/gateway/plisio','/operations/','FAILED','currency','PENDING','status','entries','3600793cedzIZ','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','source_amount','expired','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','Plisio\x20API\x20key\x20is\x20not\x20configured','data','HTTP\x20','tx_urls','qr_code','logWhiteDomainRequest','HIDDEN','toString','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','apiUrl','Response\x20Body:','txn_id','4280064rFXfnQ','message','602384FWnuUG',',\x20body:\x20','Response\x20data:','loggerService','Status:','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','fromEntries','370rlTiDT','‚ùå\x20URL\x20','1778877LKlgbL','email','Invoice\x20URL:','json','https://api.plisio.net/api/v1/operations/','HTTP\x20error!\x20status:\x20','Status\x20Text:','Payment\x20System/1.0','Failed\x20to\x20create\x20Plisio\x20payment:\x20','append','apiKey','GET','order_number','log','Full\x20URL\x20(without\x20API\x20key):','767536oPPTBg','‚úÖ\x20Processed\x20tx_urls:','logWhiteDomainError','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Error\x20stack:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','amount','Parsed\x20Result:','Error\x20details:','error','Failed\x20to\x20parse\x20JSON\x20response:','\x20is\x20valid:\x20','replace','(fiat\x20for\x20merchant)','source_currency','invoice_url','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Transaction\x20ID:','Source\x20Currency:','env','Unknown\x20error','success','JSON\x20Parse\x20Error:\x20','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','application/json','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','processWebhook','stack','Processing\x20Plisio\x20webhook:','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainResponse','===\x20PLISIO\x20API\x20ERROR\x20===','plisio_direct','3zhjwyq','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','qr_url','text','PlisioService','pending'];a55_0x43b6=function(){return _0x5713f8;};return a55_0x43b6();}const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x2582f3=a55_0x1f59fb;this[_0x2582f3(0x1f6)]=_0x2582f3(0x1cc),this[_0x2582f3(0x20e)]=process[_0x2582f3(0x226)][_0x2582f3(0x1d4)]||'',!this['apiKey']?console[_0x2582f3(0x1d8)](_0x2582f3(0x1e9)):console[_0x2582f3(0x211)](_0x2582f3(0x1f5));}async['createPayment'](_0x450323){const _0x1838c1=a55_0x1f59fb,{orderId:_0x1e021d,amount:_0x2002dd,currency:_0x4d6049,productName:_0x490f6c,description:_0x5ca279,successUrl:_0x50b21b,failUrl:_0x1dd5bb,customerEmail:_0x2edbe5,customerName:_0x1ad709,isSourceCurrency:_0x8695d4,sourceCurrency:_0x19233b}=_0x450323;if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x119af0=new URLSearchParams({'api_key':this[_0x1838c1(0x20e)],'order_number':_0x1e021d,'order_name':_0x490f6c,'description':_0x5ca279,'success_url':_0x50b21b,'fail_url':_0x1dd5bb,'callback_url':_0x1838c1(0x1e1)});_0x19233b?(_0x119af0[_0x1838c1(0x20d)](_0x1838c1(0x1e4),_0x19233b),_0x119af0[_0x1838c1(0x20d)](_0x1838c1(0x221),_0x4d6049),_0x119af0[_0x1838c1(0x20d)](_0x1838c1(0x1ea),_0x2002dd[_0x1838c1(0x1f4)]())):(_0x119af0['append'](_0x1838c1(0x1e4),_0x4d6049),_0x119af0[_0x1838c1(0x20d)](_0x1838c1(0x219),_0x2002dd[_0x1838c1(0x1f4)]()));_0x2edbe5&&_0x119af0['append'](_0x1838c1(0x205),_0x2edbe5);_0x1ad709&&_0x119af0[_0x1838c1(0x20d)]('name',_0x1ad709);const _0x27fad0=this[_0x1838c1(0x1f6)]+'?'+_0x119af0[_0x1838c1(0x1f4)](),_0xdb9fd8=Date[_0x1838c1(0x1cb)]();try{console[_0x1838c1(0x211)](_0x1838c1(0x218)),console[_0x1838c1(0x211)]('URL:',this['apiUrl']),console[_0x1838c1(0x211)](_0x1838c1(0x1c6),Object[_0x1838c1(0x201)](_0x119af0['entries']())),console[_0x1838c1(0x211)](_0x1838c1(0x212),_0x27fad0[_0x1838c1(0x21f)](this[_0x1838c1(0x20e)],_0x1838c1(0x1f3))),loggerService_1['loggerService'][_0x1838c1(0x1f2)](_0x1838c1(0x233),_0x1838c1(0x1d7),_0x1838c1(0x20f),Object[_0x1838c1(0x201)](_0x119af0[_0x1838c1(0x1e7)]()));const _0x4ed946=await fetch(_0x27fad0,{'method':_0x1838c1(0x20f),'headers':{'Accept':_0x1838c1(0x22b),'User-Agent':_0x1838c1(0x20b)}}),_0x290b65=Date['now']()-_0xdb9fd8;console[_0x1838c1(0x211)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x1838c1(0x211)](_0x1838c1(0x1ff),_0x4ed946['status']),console['log'](_0x1838c1(0x20a),_0x4ed946['statusText']),console['log'](_0x1838c1(0x1dd),_0x290b65+'ms');const _0x28e4d8=await _0x4ed946['text']();console[_0x1838c1(0x211)]('Raw\x20Response\x20Body:',_0x28e4d8);if(!_0x4ed946['ok']){console[_0x1838c1(0x21c)](_0x1838c1(0x232)),console[_0x1838c1(0x21c)]('HTTP\x20Status:',_0x4ed946[_0x1838c1(0x1e6)]),console[_0x1838c1(0x21c)](_0x1838c1(0x1f7),_0x28e4d8),loggerService_1[_0x1838c1(0x1fe)][_0x1838c1(0x231)](_0x1838c1(0x233),_0x1838c1(0x1d7),_0x4ed946[_0x1838c1(0x1e6)],_0x28e4d8,_0x290b65),loggerService_1[_0x1838c1(0x1fe)][_0x1838c1(0x215)](_0x1838c1(0x233),_0x1838c1(0x1d7),_0x1838c1(0x1ef)+_0x4ed946[_0x1838c1(0x1e6)]+':\x20'+_0x28e4d8);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4ed946[_0x1838c1(0x1e6)]+_0x1838c1(0x1fc)+_0x28e4d8);}let _0xb0dc1b;try{_0xb0dc1b=JSON[_0x1838c1(0x23e)](_0x28e4d8);}catch(_0x5d7112){console[_0x1838c1(0x21c)](_0x1838c1(0x21d),_0x5d7112),loggerService_1[_0x1838c1(0x1fe)][_0x1838c1(0x215)]('plisio_direct',_0x1838c1(0x1d7),_0x1838c1(0x229)+_0x5d7112);throw new Error(_0x1838c1(0x1c9)+_0x28e4d8);}console['log'](_0x1838c1(0x200)),console[_0x1838c1(0x211)](_0x1838c1(0x21a),JSON[_0x1838c1(0x23c)](_0xb0dc1b,null,0x2)),loggerService_1[_0x1838c1(0x1fe)]['logWhiteDomainResponse'](_0x1838c1(0x233),_0x1838c1(0x1d7),_0x4ed946['status'],_0xb0dc1b,_0x290b65);if(_0xb0dc1b[_0x1838c1(0x1e6)]!==_0x1838c1(0x228)){const _0x42e48f=_0xb0dc1b[_0x1838c1(0x1fa)]||_0xb0dc1b[_0x1838c1(0x21c)]||_0x1838c1(0x1dc);console[_0x1838c1(0x21c)](_0x1838c1(0x223)),console[_0x1838c1(0x21c)](_0x1838c1(0x1d3),_0x42e48f),loggerService_1['loggerService'][_0x1838c1(0x215)]('plisio_direct',_0x1838c1(0x1d7),'Business\x20Error:\x20'+_0x42e48f);throw new Error(_0x1838c1(0x23f)+_0x42e48f);}if(!_0xb0dc1b['data']?.[_0x1838c1(0x1f8)]||!_0xb0dc1b[_0x1838c1(0x1ee)]?.[_0x1838c1(0x222)]){console[_0x1838c1(0x21c)](_0x1838c1(0x230)),console['error'](_0x1838c1(0x1ec)),console['error'](_0x1838c1(0x1fd),_0xb0dc1b['data']),loggerService_1[_0x1838c1(0x1fe)]['logWhiteDomainError'](_0x1838c1(0x233),_0x1838c1(0x1d7),_0x1838c1(0x216));throw new Error(_0x1838c1(0x23b));}return console[_0x1838c1(0x211)](_0x1838c1(0x1ca)),console[_0x1838c1(0x211)](_0x1838c1(0x224),_0xb0dc1b[_0x1838c1(0x1ee)][_0x1838c1(0x1f8)]),console[_0x1838c1(0x211)](_0x1838c1(0x206),_0xb0dc1b[_0x1838c1(0x1ee)][_0x1838c1(0x222)]),console[_0x1838c1(0x211)](_0x1838c1(0x1de),_0x2002dd,_0x4d6049),_0x19233b&&(console[_0x1838c1(0x211)](_0x1838c1(0x225),_0x19233b,_0x1838c1(0x1cf)),console[_0x1838c1(0x211)]('Target\x20Currency:',_0x4d6049,_0x1838c1(0x220))),{'gateway_payment_id':_0xb0dc1b[_0x1838c1(0x1ee)][_0x1838c1(0x1f8)],'payment_url':_0xb0dc1b[_0x1838c1(0x1ee)][_0x1838c1(0x222)],'invoice_total_sum':_0xb0dc1b[_0x1838c1(0x1ee)][_0x1838c1(0x1ce)],'qr_code':_0xb0dc1b[_0x1838c1(0x1ee)][_0x1838c1(0x1f1)],'qr_url':_0xb0dc1b['data'][_0x1838c1(0x237)]};}catch(_0xb47003){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x1838c1(0x21c)](_0x1838c1(0x21b),_0xb47003),loggerService_1[_0x1838c1(0x1fe)][_0x1838c1(0x215)]('plisio_direct',_0x1838c1(0x1d7),_0xb47003);if(_0xb47003 instanceof Error){console[_0x1838c1(0x21c)](_0x1838c1(0x1df),_0xb47003[_0x1838c1(0x1fa)]),console[_0x1838c1(0x21c)](_0x1838c1(0x217),_0xb47003[_0x1838c1(0x22e)]);throw new Error(_0x1838c1(0x20c)+_0xb47003[_0x1838c1(0x1fa)]);}throw new Error(_0x1838c1(0x236));}}async[a55_0x1f59fb(0x23d)](_0x61820){const _0xd246e6=a55_0x1f59fb,_0x2f0364=Date[_0xd246e6(0x1cb)]();try{if(!this[_0xd246e6(0x20e)])throw new Error(_0xd246e6(0x1ed));const _0x205af6=new URLSearchParams({'api_key':this[_0xd246e6(0x20e)],'txn_id':_0x61820}),_0x5be46c=_0xd246e6(0x208)+_0x61820+'?'+_0x205af6[_0xd246e6(0x1f4)]();loggerService_1[_0xd246e6(0x1fe)][_0xd246e6(0x1f2)](_0xd246e6(0x233),_0xd246e6(0x1e2)+_0x61820,_0xd246e6(0x20f),Object['fromEntries'](_0x205af6[_0xd246e6(0x1e7)]()));const _0x1672d9=await fetch(_0x5be46c,{'method':_0xd246e6(0x20f),'headers':{'Accept':'application/json','User-Agent':_0xd246e6(0x20b)}}),_0x535284=Date[_0xd246e6(0x1cb)]()-_0x2f0364;if(!_0x1672d9['ok']){const _0x583fd8=await _0x1672d9[_0xd246e6(0x238)]();loggerService_1[_0xd246e6(0x1fe)]['logWhiteDomainResponse'](_0xd246e6(0x233),'/operations/'+_0x61820,_0x1672d9[_0xd246e6(0x1e6)],_0x583fd8,_0x535284);throw new Error(_0xd246e6(0x209)+_0x1672d9[_0xd246e6(0x1e6)]);}const _0x1cc572=await _0x1672d9[_0xd246e6(0x207)]();loggerService_1[_0xd246e6(0x1fe)][_0xd246e6(0x231)]('plisio_direct','/operations/'+_0x61820,_0x1672d9[_0xd246e6(0x1e6)],_0x1cc572,_0x535284);if(_0x1cc572['status']!=='success'){loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct',_0xd246e6(0x1e2)+_0x61820,_0xd246e6(0x23f)+(_0x1cc572['message']||_0x1cc572[_0xd246e6(0x21c)]||_0xd246e6(0x227)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x1cc572[_0xd246e6(0x1fa)]||_0x1cc572[_0xd246e6(0x21c)]||_0xd246e6(0x227)));}let _0x3229db='PENDING';return{'status':_0x3229db};}catch(_0x392d42){console[_0xd246e6(0x21c)](_0xd246e6(0x240),_0x392d42),loggerService_1['loggerService'][_0xd246e6(0x215)](_0xd246e6(0x233),'/operations/'+_0x61820,_0x392d42);throw new Error(_0xd246e6(0x22c)+(_0x392d42 instanceof Error?_0x392d42[_0xd246e6(0x1fa)]:_0xd246e6(0x227)));}}async[a55_0x1f59fb(0x22d)](_0x4a3965){const _0xa070df=a55_0x1f59fb;console[_0xa070df(0x211)](_0xa070df(0x22f),_0x4a3965);let _0x1b0963=_0xa070df(0x1e5);switch(_0x4a3965['status']?.['toLowerCase']()){case _0xa070df(0x1cd):case'mismatch':_0x1b0963=_0xa070df(0x1c7);break;case _0xa070df(0x1eb):_0x1b0963=_0xa070df(0x1c8);break;case'error':case'cancelled':_0x1b0963=_0xa070df(0x1e3);break;case'new':_0x1b0963=_0xa070df(0x1e5);break;case _0xa070df(0x23a):_0x1b0963='PROCESSING';break;default:_0x1b0963='PENDING';break;}let _0x27faf4;if(_0x4a3965[_0xa070df(0x1f0)])try{console[_0xa070df(0x211)](_0xa070df(0x235),_0x4a3965[_0xa070df(0x1f0)]);let _0x1f494f;if(typeof _0x4a3965[_0xa070df(0x1f0)]===_0xa070df(0x1e0))_0x1f494f=JSON[_0xa070df(0x23e)](_0x4a3965[_0xa070df(0x1f0)]);else Array['isArray'](_0x4a3965[_0xa070df(0x1f0)])?_0x1f494f=_0x4a3965[_0xa070df(0x1f0)]:_0x1f494f=[];_0x27faf4=_0x1f494f[_0xa070df(0x1d5)](_0x4b85fb=>{const _0x183900=_0xa070df,_0x49f7ed=_0x4b85fb[_0x183900(0x21f)](/\\/g,'');return console[_0x183900(0x211)](_0x183900(0x1d0)+_0x4b85fb+_0x183900(0x1db)+_0x49f7ed),_0x49f7ed;}),console[_0xa070df(0x211)](_0xa070df(0x214),_0x27faf4),_0x27faf4[_0xa070df(0x1d9)]((_0x3515eb,_0x4707c3)=>{const _0x35956e=_0xa070df;try{new URL(_0x3515eb),console[_0x35956e(0x211)](_0x35956e(0x1d6)+(_0x4707c3+0x1)+_0x35956e(0x21e)+_0x3515eb);}catch(_0x417721){console[_0x35956e(0x21c)](_0x35956e(0x203)+(_0x4707c3+0x1)+'\x20is\x20invalid:\x20'+_0x3515eb,_0x417721);}});}catch(_0x12edf6){console[_0xa070df(0x21c)](_0xa070df(0x22a),_0x12edf6),console[_0xa070df(0x21c)]('Raw\x20tx_urls\x20data:',_0x4a3965[_0xa070df(0x1f0)]),_0x27faf4=undefined;}return{'paymentId':_0x4a3965[_0xa070df(0x210)]||'','status':_0x1b0963,'amount':_0x4a3965['amount'],'currency':_0x4a3965[_0xa070df(0x1e4)],'txUrls':_0x27faf4};}}function a55_0x4af7(_0x208101,_0x11a48c){const _0x43b690=a55_0x43b6();return a55_0x4af7=function(_0x4af79e,_0x621fd0){_0x4af79e=_0x4af79e-0x1c6;let _0x313e37=_0x43b690[_0x4af79e];return _0x313e37;},a55_0x4af7(_0x208101,_0x11a48c);}exports[a55_0x1f59fb(0x239)]=PlisioService;