'use strict';const a45_0x1f2435=a45_0x26ce;function a45_0x41cc(){const _0x59ecd6=['Parsed\x20Result:','apiKey','Status\x20Text:','text','../loggerService','apiUrl','logWhiteDomainRequest','129DWevSc','Plisio\x20API\x20key\x20is\x20not\x20configured','status','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','data','9oVHDEr','source_amount','❌\x20URL\x20','\x20is\x20valid:\x20','tx_urls','4937174xXyXLo','Raw\x20tx_urls\x20data:','Plisio\x20API\x20error:\x20','now','fromEntries','log','json','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','116UHeefQ','Error\x20details:','__esModule','replace','loggerService','email','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','logWhiteDomainResponse','Amount:','stringify','✅\x20Processed\x20tx_urls:','Response\x20Body:','3500330OwDoHg','pending','15406KAYctJ','qr_url','JSON\x20Parse\x20Error:\x20',',\x20body:\x20','URL:','defineProperty','Status:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Raw\x20Response\x20Body:','createPayment','Target\x20Currency:','application/json','(fiat\x20for\x20merchant)','✅\x20URL\x20','TesSoft\x20Payment\x20System/1.0','PlisioService','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','order_number','Full\x20URL\x20(without\x20API\x20key):','PAID','statusText','Failed\x20to\x20create\x20Plisio\x20payment:\x20','===\x20PLISIO\x20API\x20ERROR\x20===','GET','isArray','error','source_currency','Invoice\x20URL:','Response\x20data:','plisio_direct','Parameters:','forEach','success','6220LvizmU','100836SQpmiX','message','/operations/','txn_id','string','===\x20PLISIO\x20SUCCESS\x20===','Unknown\x20error','🔗\x20Formatted\x20URL:\x20','logWhiteDomainError','❌\x20Failed\x20to\x20parse\x20tx_urls:','10235768VdBNjV','14573qwGatz','invoice_total_sum','append','Business\x20Error:\x20','entries','PENDING','Transaction\x20ID:','invoice_url','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','HIDDEN','FAILED','Response\x20Time:','amount','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','PROCESSING','\x20is\x20invalid:\x20','expired','map','toString','completed','\x20->\x20','HTTP\x20error!\x20status:\x20','mismatch','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','4662NJiezt','7pYEXxe','18168RRRLzi','qr_code','Error\x20stack:','toLowerCase','/invoices/new','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','currency','Error\x20message:','===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='];a45_0x41cc=function(){return _0x59ecd6;};return a45_0x41cc();}(function(_0x8df346,_0xb1e9d1){const _0x3fafd6=a45_0x26ce,_0x4bd588=_0x8df346();while(!![]){try{const _0x428675=-parseInt(_0x3fafd6(0xf8))/0x1*(-parseInt(_0x3fafd6(0xa1))/0x2)+parseInt(_0x3fafd6(0xc3))/0x3*(parseInt(_0x3fafd6(0x93))/0x4)+-parseInt(_0x3fafd6(0xc2))/0x5*(parseInt(_0x3fafd6(0xe6))/0x6)+parseInt(_0x3fafd6(0xe7))/0x7*(parseInt(_0x3fafd6(0xcd))/0x8)+parseInt(_0x3fafd6(0x86))/0x9*(-parseInt(_0x3fafd6(0x9f))/0xa)+parseInt(_0x3fafd6(0x8b))/0xb+-parseInt(_0x3fafd6(0xe8))/0xc*(parseInt(_0x3fafd6(0xce))/0xd);if(_0x428675===_0xb1e9d1)break;else _0x4bd588['push'](_0x4bd588['shift']());}catch(_0x10a524){_0x4bd588['push'](_0x4bd588['shift']());}}}(a45_0x41cc,0xa6bad));Object[a45_0x1f2435(0xa6)](exports,a45_0x1f2435(0x95),{'value':!![]}),exports[a45_0x1f2435(0xb0)]=void 0x0;function a45_0x26ce(_0x290813,_0x2757f5){const _0x41cc03=a45_0x41cc();return a45_0x26ce=function(_0x26ce4a,_0x4eb5f8){_0x26ce4a=_0x26ce4a-0x83;let _0x14296e=_0x41cc03[_0x26ce4a];return _0x14296e;},a45_0x26ce(_0x290813,_0x2757f5);}const loggerService_1=require(a45_0x1f2435(0xf5));class PlisioService{constructor(){const _0xe78ec4=a45_0x1f2435;this['apiUrl']='https://api.plisio.net/api/v1/invoices/new',this['apiKey']=process['env']['PLISIO_API_KEY']||'',!this['apiKey']?console['warn'](_0xe78ec4(0x84)):console['log']('💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a45_0x1f2435(0xaa)](_0x50db41){const _0xcdd903=a45_0x1f2435,{orderId:_0x2180e7,amount:_0x189c52,currency:_0x569e6e,productName:_0x37c759,description:_0x2d56d8,successUrl:_0x1ef7f9,failUrl:_0x46cdbf,customerEmail:_0x5cd55e,customerName:_0x2507ad,isSourceCurrency:_0x2f4f25,sourceCurrency:_0x167a56}=_0x50db41;if(!this[_0xcdd903(0xf2)])throw new Error(_0xcdd903(0xf9));const _0x360300=new URLSearchParams({'api_key':this[_0xcdd903(0xf2)],'order_number':_0x2180e7,'order_name':_0x37c759,'description':_0x2d56d8,'success_url':_0x1ef7f9,'fail_url':_0x46cdbf,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x167a56?(_0x360300[_0xcdd903(0xd0)](_0xcdd903(0xee),_0x167a56),_0x360300[_0xcdd903(0xd0)](_0xcdd903(0xbb),_0x569e6e),_0x360300['append'](_0xcdd903(0x87),_0x189c52[_0xcdd903(0xe0)]())):(_0x360300[_0xcdd903(0xd0)](_0xcdd903(0xee),_0x569e6e),_0x360300[_0xcdd903(0xd0)](_0xcdd903(0xda),_0x189c52[_0xcdd903(0xe0)]()));_0x5cd55e&&_0x360300[_0xcdd903(0xd0)](_0xcdd903(0x98),_0x5cd55e);_0x2507ad&&_0x360300[_0xcdd903(0xd0)]('name',_0x2507ad);const _0x5922e7=this[_0xcdd903(0xf6)]+'?'+_0x360300[_0xcdd903(0xe0)](),_0x5eb4cf=Date['now']();try{console[_0xcdd903(0x90)](_0xcdd903(0xe5)),console[_0xcdd903(0x90)](_0xcdd903(0xa5),this[_0xcdd903(0xf6)]),console[_0xcdd903(0x90)](_0xcdd903(0xbf),Object[_0xcdd903(0x8f)](_0x360300['entries']())),console[_0xcdd903(0x90)](_0xcdd903(0xb3),_0x5922e7[_0xcdd903(0x96)](this[_0xcdd903(0xf2)],_0xcdd903(0xd7))),loggerService_1['loggerService'][_0xcdd903(0xf7)](_0xcdd903(0xbe),_0xcdd903(0xec),_0xcdd903(0xb8),Object['fromEntries'](_0x360300[_0xcdd903(0xd2)]()));const _0xfddf41=await fetch(_0x5922e7,{'method':'GET','headers':{'Accept':_0xcdd903(0xac),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x3f090c=Date[_0xcdd903(0x8e)]()-_0x5eb4cf;console['log'](_0xcdd903(0xdb)),console[_0xcdd903(0x90)](_0xcdd903(0xa7),_0xfddf41[_0xcdd903(0x83)]),console['log'](_0xcdd903(0xf3),_0xfddf41[_0xcdd903(0xb5)]),console['log'](_0xcdd903(0xd9),_0x3f090c+'ms');const _0xffbd9c=await _0xfddf41[_0xcdd903(0xf4)]();console[_0xcdd903(0x90)](_0xcdd903(0xa9),_0xffbd9c);if(!_0xfddf41['ok']){console[_0xcdd903(0xba)](_0xcdd903(0xb7)),console[_0xcdd903(0xba)]('HTTP\x20Status:',_0xfddf41[_0xcdd903(0x83)]),console[_0xcdd903(0xba)](_0xcdd903(0x9e),_0xffbd9c),loggerService_1[_0xcdd903(0x97)]['logWhiteDomainResponse']('plisio_direct','/invoices/new',_0xfddf41['status'],_0xffbd9c,_0x3f090c),loggerService_1['loggerService'][_0xcdd903(0xcb)]('plisio_direct',_0xcdd903(0xec),'HTTP\x20'+_0xfddf41[_0xcdd903(0x83)]+':\x20'+_0xffbd9c);throw new Error(_0xcdd903(0xe3)+_0xfddf41[_0xcdd903(0x83)]+_0xcdd903(0xa4)+_0xffbd9c);}let _0x6f992e;try{_0x6f992e=JSON['parse'](_0xffbd9c);}catch(_0x250d83){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x250d83),loggerService_1[_0xcdd903(0x97)][_0xcdd903(0xcb)]('plisio_direct',_0xcdd903(0xec),_0xcdd903(0xa3)+_0x250d83);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0xffbd9c);}console['log'](_0xcdd903(0xf0)),console[_0xcdd903(0x90)](_0xcdd903(0xf1),JSON[_0xcdd903(0x9c)](_0x6f992e,null,0x2)),loggerService_1[_0xcdd903(0x97)][_0xcdd903(0x9a)](_0xcdd903(0xbe),_0xcdd903(0xec),_0xfddf41[_0xcdd903(0x83)],_0x6f992e,_0x3f090c);if(_0x6f992e['status']!==_0xcdd903(0xc1)){const _0x29e29b=_0x6f992e[_0xcdd903(0xc4)]||_0x6f992e[_0xcdd903(0xba)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0xcdd903(0xba)](_0xcdd903(0xb1)),console[_0xcdd903(0xba)]('Error\x20Message:',_0x29e29b),loggerService_1[_0xcdd903(0x97)][_0xcdd903(0xcb)](_0xcdd903(0xbe),_0xcdd903(0xec),_0xcdd903(0xd1)+_0x29e29b);throw new Error('Plisio\x20API\x20error:\x20'+_0x29e29b);}if(!_0x6f992e['data']?.['txn_id']||!_0x6f992e[_0xcdd903(0x85)]?.[_0xcdd903(0xd5)]){console[_0xcdd903(0xba)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0xcdd903(0xba)](_0xcdd903(0x92)),console[_0xcdd903(0xba)](_0xcdd903(0xbd),_0x6f992e[_0xcdd903(0x85)]),loggerService_1[_0xcdd903(0x97)][_0xcdd903(0xcb)]('plisio_direct',_0xcdd903(0xec),_0xcdd903(0xa8));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0xcdd903(0x90)](_0xcdd903(0xc8)),console[_0xcdd903(0x90)](_0xcdd903(0xd4),_0x6f992e[_0xcdd903(0x85)][_0xcdd903(0xc6)]),console[_0xcdd903(0x90)](_0xcdd903(0xbc),_0x6f992e[_0xcdd903(0x85)][_0xcdd903(0xd5)]),console[_0xcdd903(0x90)](_0xcdd903(0x9b),_0x189c52,_0x569e6e),_0x167a56&&(console[_0xcdd903(0x90)]('Source\x20Currency:',_0x167a56,'(crypto\x20for\x20payment)'),console['log'](_0xcdd903(0xab),_0x569e6e,_0xcdd903(0xad))),{'gateway_payment_id':_0x6f992e[_0xcdd903(0x85)]['txn_id'],'payment_url':_0x6f992e[_0xcdd903(0x85)][_0xcdd903(0xd5)],'invoice_total_sum':_0x6f992e[_0xcdd903(0x85)][_0xcdd903(0xcf)],'qr_code':_0x6f992e[_0xcdd903(0x85)][_0xcdd903(0xe9)],'qr_url':_0x6f992e[_0xcdd903(0x85)][_0xcdd903(0xa2)]};}catch(_0x54bed0){console[_0xcdd903(0xba)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console['error'](_0xcdd903(0x94),_0x54bed0),loggerService_1['loggerService'][_0xcdd903(0xcb)](_0xcdd903(0xbe),_0xcdd903(0xec),_0x54bed0);if(_0x54bed0 instanceof Error){console[_0xcdd903(0xba)](_0xcdd903(0xef),_0x54bed0[_0xcdd903(0xc4)]),console['error'](_0xcdd903(0xea),_0x54bed0['stack']);throw new Error(_0xcdd903(0xb6)+_0x54bed0['message']);}throw new Error(_0xcdd903(0xed));}}async['verifyPayment'](_0x3e4f5d){const _0x53830d=a45_0x1f2435,_0x5a4619=Date[_0x53830d(0x8e)]();try{if(!this[_0x53830d(0xf2)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x5887ac=new URLSearchParams({'api_key':this[_0x53830d(0xf2)],'txn_id':_0x3e4f5d}),_0xf18aae='https://api.plisio.net/api/v1/operations/'+_0x3e4f5d+'?'+_0x5887ac[_0x53830d(0xe0)]();loggerService_1['loggerService']['logWhiteDomainRequest'](_0x53830d(0xbe),_0x53830d(0xc5)+_0x3e4f5d,_0x53830d(0xb8),Object[_0x53830d(0x8f)](_0x5887ac['entries']()));const _0x16a942=await fetch(_0xf18aae,{'method':'GET','headers':{'Accept':_0x53830d(0xac),'User-Agent':_0x53830d(0xaf)}}),_0x506fb9=Date[_0x53830d(0x8e)]()-_0x5a4619;if(!_0x16a942['ok']){const _0x4cf02f=await _0x16a942[_0x53830d(0xf4)]();loggerService_1['loggerService'][_0x53830d(0x9a)](_0x53830d(0xbe),_0x53830d(0xc5)+_0x3e4f5d,_0x16a942[_0x53830d(0x83)],_0x4cf02f,_0x506fb9);throw new Error(_0x53830d(0xe3)+_0x16a942['status']);}const _0x3e134f=await _0x16a942[_0x53830d(0x91)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x53830d(0xbe),'/operations/'+_0x3e4f5d,_0x16a942[_0x53830d(0x83)],_0x3e134f,_0x506fb9);if(_0x3e134f[_0x53830d(0x83)]!=='success'){loggerService_1['loggerService'][_0x53830d(0xcb)]('plisio_direct','/operations/'+_0x3e4f5d,_0x53830d(0x8d)+(_0x3e134f[_0x53830d(0xc4)]||_0x3e134f[_0x53830d(0xba)]||_0x53830d(0xc9)));throw new Error(_0x53830d(0x8d)+(_0x3e134f[_0x53830d(0xc4)]||_0x3e134f[_0x53830d(0xba)]||_0x53830d(0xc9)));}let _0x3dfa1c=_0x53830d(0xd3);return{'status':_0x3dfa1c};}catch(_0x5ec80e){console[_0x53830d(0xba)]('Plisio\x20payment\x20verification\x20error:',_0x5ec80e),loggerService_1['loggerService'][_0x53830d(0xcb)]('plisio_direct',_0x53830d(0xc5)+_0x3e4f5d,_0x5ec80e);throw new Error(_0x53830d(0xd6)+(_0x5ec80e instanceof Error?_0x5ec80e[_0x53830d(0xc4)]:'Unknown\x20error'));}}async['processWebhook'](_0x3286b6){const _0x562dfb=a45_0x1f2435;console[_0x562dfb(0x90)]('Processing\x20Plisio\x20webhook:',_0x3286b6);let _0x33e1e9=_0x562dfb(0xd3);switch(_0x3286b6['status']?.[_0x562dfb(0xeb)]()){case _0x562dfb(0xe1):case _0x562dfb(0xe4):_0x33e1e9=_0x562dfb(0xb4);break;case _0x562dfb(0xde):_0x33e1e9='EXPIRED';break;case'error':case'cancelled':_0x33e1e9=_0x562dfb(0xd8);break;case'new':_0x33e1e9=_0x562dfb(0xd3);break;case _0x562dfb(0xa0):_0x33e1e9=_0x562dfb(0xdc);break;default:_0x33e1e9=_0x562dfb(0xd3);break;}let _0x3f1ca9;if(_0x3286b6['tx_urls'])try{console[_0x562dfb(0x90)](_0x562dfb(0x99),_0x3286b6['tx_urls']);let _0x5855f0;if(typeof _0x3286b6['tx_urls']===_0x562dfb(0xc7))_0x5855f0=JSON['parse'](_0x3286b6[_0x562dfb(0x8a)]);else Array[_0x562dfb(0xb9)](_0x3286b6[_0x562dfb(0x8a)])?_0x5855f0=_0x3286b6['tx_urls']:_0x5855f0=[];_0x3f1ca9=_0x5855f0[_0x562dfb(0xdf)](_0x323af0=>{const _0x3aacec=_0x562dfb,_0x11858a=_0x323af0[_0x3aacec(0x96)](/\\/g,'');return console['log'](_0x3aacec(0xca)+_0x323af0+_0x3aacec(0xe2)+_0x11858a),_0x11858a;}),console[_0x562dfb(0x90)](_0x562dfb(0x9d),_0x3f1ca9),_0x3f1ca9[_0x562dfb(0xc0)]((_0x1e10f1,_0xd9666a)=>{const _0x2f8faa=_0x562dfb;try{new URL(_0x1e10f1),console[_0x2f8faa(0x90)](_0x2f8faa(0xae)+(_0xd9666a+0x1)+_0x2f8faa(0x89)+_0x1e10f1);}catch(_0x1401ac){console[_0x2f8faa(0xba)](_0x2f8faa(0x88)+(_0xd9666a+0x1)+_0x2f8faa(0xdd)+_0x1e10f1,_0x1401ac);}});}catch(_0x2fd229){console['error'](_0x562dfb(0xcc),_0x2fd229),console[_0x562dfb(0xba)](_0x562dfb(0x8c),_0x3286b6[_0x562dfb(0x8a)]),_0x3f1ca9=undefined;}return{'paymentId':_0x3286b6[_0x562dfb(0xb2)]||'','status':_0x33e1e9,'amount':_0x3286b6[_0x562dfb(0xda)],'currency':_0x3286b6['currency'],'txUrls':_0x3f1ca9};}}exports[a45_0x1f2435(0xb0)]=PlisioService;