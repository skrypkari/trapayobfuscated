'use strict';function a62_0x528e(){const _0x476563=['===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','expired','Response\x20data:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','json','\x20is\x20invalid:\x20','map','2447720QafMpA','log','env','tx_urls','toString','60pGYOfW','PENDING','213830pMUzle','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Parsed\x20Result:','toLowerCase','ðŸ”—\x20Formatted\x20URL:\x20','Failed\x20to\x20parse\x20JSON\x20response:','fromEntries','Error\x20stack:','PROCESSING','Full\x20URL\x20(without\x20API\x20key):','parse','Error\x20Message:','../loggerService','invoice_url','(crypto\x20for\x20payment)','/operations/','Source\x20Currency:','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Status:','9mlNmWA','Unknown\x20error','apiKey','new','87015bzfIPn','https://api.plisio.net/api/v1/operations/','string','98757jAjIgY','currency','__esModule','application/json','success','Raw\x20tx_urls\x20data:','append','/invoices/new','\x20->\x20','stringify','\x20is\x20valid:\x20','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','loggerService','email','JSON\x20Parse\x20Error:\x20','Plisio\x20API\x20error:\x20','===\x20PLISIO\x20SUCCESS\x20===','GET','amount','error','logWhiteDomainRequest','entries','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','now','(fiat\x20for\x20merchant)','7jAEATO','txn_id','2QMzElC','HTTP\x20','apiUrl','stack','mismatch','logWhiteDomainError','3bqkrFM','order_number','verifyPayment','Payment\x20System/1.0','âœ…\x20Processed\x20tx_urls:','URL:','isArray','message','source_currency','HIDDEN','https://api.plisio.net/api/v1/invoices/new','===\x20PLISIO\x20API\x20ERROR\x20===','âœ…\x20URL\x20','replace','âŒ\x20URL\x20','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Plisio\x20payment\x20verification\x20error:','987208biBGFU','Response\x20Body:','PlisioService','HTTP\x20error!\x20status:\x20','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','PAID','logWhiteDomainResponse','text','982556mGUHAr','Status\x20Text:','9102840zwMEje','defineProperty','FAILED','HTTP\x20Status:','qr_url','âŒ\x20Failed\x20to\x20parse\x20tx_urls:','plisio_direct','EXPIRED','data','Plisio\x20API\x20key\x20is\x20not\x20configured','completed','status','Processing\x20Plisio\x20webhook:','ðŸ”—\x20Raw\x20tx_urls\x20from\x20Plisio:','Amount:'];a62_0x528e=function(){return _0x476563;};return a62_0x528e();}const a62_0x206b1d=a62_0xc33b;function a62_0xc33b(_0x416999,_0x37ab33){_0x416999=_0x416999-0xaa;const _0x528ebd=a62_0x528e();let _0xc33b9d=_0x528ebd[_0x416999];return _0xc33b9d;}(function(_0x651f1a,_0x12a6e0){const _0x2ed24c=a62_0xc33b,_0x1836fd=_0x651f1a();while(!![]){try{const _0x270dfe=-parseInt(_0x2ed24c(0xbf))/0x1*(parseInt(_0x2ed24c(0xda))/0x2)+parseInt(_0x2ed24c(0xe0))/0x3*(-parseInt(_0x2ed24c(0xfa))/0x4)+parseInt(_0x2ed24c(0xbc))/0x5*(-parseInt(_0x2ed24c(0x117))/0x6)+-parseInt(_0x2ed24c(0xd8))/0x7*(-parseInt(_0x2ed24c(0xf2))/0x8)+parseInt(_0x2ed24c(0xb8))/0x9*(parseInt(_0x2ed24c(0x119))/0xa)+-parseInt(_0x2ed24c(0x112))/0xb+parseInt(_0x2ed24c(0xfc))/0xc;if(_0x270dfe===_0x12a6e0)break;else _0x1836fd['push'](_0x1836fd['shift']());}catch(_0x24724d){_0x1836fd['push'](_0x1836fd['shift']());}}}(a62_0x528e,0x27a68));Object[a62_0x206b1d(0xfd)](exports,a62_0x206b1d(0xc1),{'value':!![]}),exports[a62_0x206b1d(0xf4)]=void 0x0;const loggerService_1=require(a62_0x206b1d(0xb1));class PlisioService{constructor(){const _0x53490c=a62_0x206b1d;this[_0x53490c(0xdc)]=_0x53490c(0xea),this[_0x53490c(0xba)]=process[_0x53490c(0x114)]['PLISIO_API_KEY']||'',!this[_0x53490c(0xba)]?console['warn']('âš ï¸\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console['log']('ðŸ’°\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async['createPayment'](_0x295132){const _0x3f81e6=a62_0x206b1d,{orderId:_0x383216,amount:_0x54bba1,currency:_0x9e8d60,productName:_0x1b30fc,description:_0x71edf2,successUrl:_0x400b03,failUrl:_0x500736,customerEmail:_0x41b566,customerName:_0x54732c,isSourceCurrency:_0x1e1e10,sourceCurrency:_0x3dcb56}=_0x295132;if(!this[_0x3f81e6(0xba)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x5130d5=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x383216,'order_name':_0x1b30fc,'description':_0x71edf2,'success_url':_0x400b03,'fail_url':_0x500736,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x3dcb56?(_0x5130d5[_0x3f81e6(0xc5)](_0x3f81e6(0xc0),_0x3dcb56),_0x5130d5[_0x3f81e6(0xc5)](_0x3f81e6(0xe8),_0x9e8d60),_0x5130d5['append']('source_amount',_0x54bba1[_0x3f81e6(0x116)]())):(_0x5130d5['append'](_0x3f81e6(0xc0),_0x9e8d60),_0x5130d5['append'](_0x3f81e6(0xd1),_0x54bba1[_0x3f81e6(0x116)]()));_0x41b566&&_0x5130d5[_0x3f81e6(0xc5)](_0x3f81e6(0xcc),_0x41b566);_0x54732c&&_0x5130d5['append']('name',_0x54732c);const _0x12192e=this['apiUrl']+'?'+_0x5130d5['toString'](),_0x4d2350=Date[_0x3f81e6(0xd6)]();try{console[_0x3f81e6(0x113)](_0x3f81e6(0xf6)),console[_0x3f81e6(0x113)](_0x3f81e6(0xe5),this[_0x3f81e6(0xdc)]),console[_0x3f81e6(0x113)]('Parameters:',Object[_0x3f81e6(0xab)](_0x5130d5['entries']())),console[_0x3f81e6(0x113)](_0x3f81e6(0xae),_0x12192e[_0x3f81e6(0xed)](this[_0x3f81e6(0xba)],_0x3f81e6(0xe9))),loggerService_1[_0x3f81e6(0xcb)][_0x3f81e6(0xd3)](_0x3f81e6(0x102),'/invoices/new',_0x3f81e6(0xd0),Object[_0x3f81e6(0xab)](_0x5130d5[_0x3f81e6(0xd4)]()));const _0xa0edb0=await fetch(_0x12192e,{'method':_0x3f81e6(0xd0),'headers':{'Accept':_0x3f81e6(0xc2),'User-Agent':_0x3f81e6(0xe3)}}),_0x361372=Date[_0x3f81e6(0xd6)]()-_0x4d2350;console[_0x3f81e6(0x113)](_0x3f81e6(0x10e)),console['log'](_0x3f81e6(0xb7),_0xa0edb0[_0x3f81e6(0x107)]),console[_0x3f81e6(0x113)](_0x3f81e6(0xfb),_0xa0edb0['statusText']),console['log']('Response\x20Time:',_0x361372+'ms');const _0x3ada2e=await _0xa0edb0[_0x3f81e6(0xf9)]();console['log']('Raw\x20Response\x20Body:',_0x3ada2e);if(!_0xa0edb0['ok']){console['error'](_0x3f81e6(0xeb)),console[_0x3f81e6(0xd2)](_0x3f81e6(0xff),_0xa0edb0[_0x3f81e6(0x107)]),console[_0x3f81e6(0xd2)](_0x3f81e6(0xf3),_0x3ada2e),loggerService_1[_0x3f81e6(0xcb)][_0x3f81e6(0xf8)]('plisio_direct',_0x3f81e6(0xc6),_0xa0edb0[_0x3f81e6(0x107)],_0x3ada2e,_0x361372),loggerService_1[_0x3f81e6(0xcb)][_0x3f81e6(0xdf)](_0x3f81e6(0x102),_0x3f81e6(0xc6),_0x3f81e6(0xdb)+_0xa0edb0[_0x3f81e6(0x107)]+':\x20'+_0x3ada2e);throw new Error(_0x3f81e6(0xf5)+_0xa0edb0[_0x3f81e6(0x107)]+',\x20body:\x20'+_0x3ada2e);}let _0x566899;try{_0x566899=JSON[_0x3f81e6(0xaf)](_0x3ada2e);}catch(_0x1912f1){console['error'](_0x3f81e6(0xaa),_0x1912f1),loggerService_1[_0x3f81e6(0xcb)][_0x3f81e6(0xdf)](_0x3f81e6(0x102),_0x3f81e6(0xc6),_0x3f81e6(0xcd)+_0x1912f1);throw new Error(_0x3f81e6(0xca)+_0x3ada2e);}console['log'](_0x3f81e6(0xb6)),console[_0x3f81e6(0x113)](_0x3f81e6(0x11b),JSON[_0x3f81e6(0xc8)](_0x566899,null,0x2)),loggerService_1[_0x3f81e6(0xcb)][_0x3f81e6(0xf8)](_0x3f81e6(0x102),_0x3f81e6(0xc6),_0xa0edb0[_0x3f81e6(0x107)],_0x566899,_0x361372);if(_0x566899['status']!==_0x3f81e6(0xc3)){const _0x2a56af=_0x566899[_0x3f81e6(0xe7)]||_0x566899[_0x3f81e6(0xd2)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x3f81e6(0xd2)](_0x3f81e6(0x10b)),console[_0x3f81e6(0xd2)](_0x3f81e6(0xb0),_0x2a56af),loggerService_1[_0x3f81e6(0xcb)][_0x3f81e6(0xdf)](_0x3f81e6(0x102),_0x3f81e6(0xc6),'Business\x20Error:\x20'+_0x2a56af);throw new Error('Plisio\x20API\x20error:\x20'+_0x2a56af);}if(!_0x566899[_0x3f81e6(0x104)]?.['txn_id']||!_0x566899[_0x3f81e6(0x104)]?.['invoice_url']){console[_0x3f81e6(0xd2)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3f81e6(0xd2)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console['error'](_0x3f81e6(0x10d),_0x566899['data']),loggerService_1['loggerService'][_0x3f81e6(0xdf)](_0x3f81e6(0x102),_0x3f81e6(0xc6),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x3f81e6(0xef));}return console['log'](_0x3f81e6(0xcf)),console[_0x3f81e6(0x113)]('Transaction\x20ID:',_0x566899['data'][_0x3f81e6(0xd9)]),console[_0x3f81e6(0x113)]('Invoice\x20URL:',_0x566899[_0x3f81e6(0x104)][_0x3f81e6(0xb2)]),console['log'](_0x3f81e6(0x10a),_0x54bba1,_0x9e8d60),_0x3dcb56&&(console[_0x3f81e6(0x113)](_0x3f81e6(0xb5),_0x3dcb56,_0x3f81e6(0xb3)),console[_0x3f81e6(0x113)]('Target\x20Currency:',_0x9e8d60,_0x3f81e6(0xd7))),{'gateway_payment_id':_0x566899['data'][_0x3f81e6(0xd9)],'payment_url':_0x566899[_0x3f81e6(0x104)][_0x3f81e6(0xb2)],'invoice_total_sum':_0x566899[_0x3f81e6(0x104)]['invoice_total_sum'],'qr_code':_0x566899[_0x3f81e6(0x104)]['qr_code'],'qr_url':_0x566899['data'][_0x3f81e6(0x100)]};}catch(_0x58dcc3){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console['error']('Error\x20details:',_0x58dcc3),loggerService_1[_0x3f81e6(0xcb)][_0x3f81e6(0xdf)](_0x3f81e6(0x102),'/invoices/new',_0x58dcc3);if(_0x58dcc3 instanceof Error){console[_0x3f81e6(0xd2)]('Error\x20message:',_0x58dcc3[_0x3f81e6(0xe7)]),console[_0x3f81e6(0xd2)](_0x3f81e6(0xac),_0x58dcc3[_0x3f81e6(0xdd)]);throw new Error(_0x3f81e6(0x11a)+_0x58dcc3[_0x3f81e6(0xe7)]);}throw new Error(_0x3f81e6(0xf0));}}async[a62_0x206b1d(0xe2)](_0x2bf969){const _0x3a463e=a62_0x206b1d,_0x5efda3=Date[_0x3a463e(0xd6)]();try{if(!this[_0x3a463e(0xba)])throw new Error(_0x3a463e(0x105));const _0x3693bb=new URLSearchParams({'api_key':this[_0x3a463e(0xba)],'txn_id':_0x2bf969}),_0x259234=_0x3a463e(0xbd)+_0x2bf969+'?'+_0x3693bb[_0x3a463e(0x116)]();loggerService_1[_0x3a463e(0xcb)][_0x3a463e(0xd3)](_0x3a463e(0x102),_0x3a463e(0xb4)+_0x2bf969,_0x3a463e(0xd0),Object['fromEntries'](_0x3693bb['entries']()));const _0x126856=await fetch(_0x259234,{'method':_0x3a463e(0xd0),'headers':{'Accept':_0x3a463e(0xc2),'User-Agent':'Payment\x20System/1.0'}}),_0x5b83ae=Date['now']()-_0x5efda3;if(!_0x126856['ok']){const _0x4a0f91=await _0x126856['text']();loggerService_1[_0x3a463e(0xcb)][_0x3a463e(0xf8)]('plisio_direct',_0x3a463e(0xb4)+_0x2bf969,_0x126856['status'],_0x4a0f91,_0x5b83ae);throw new Error('HTTP\x20error!\x20status:\x20'+_0x126856[_0x3a463e(0x107)]);}const _0x447db2=await _0x126856[_0x3a463e(0x10f)]();loggerService_1['loggerService'][_0x3a463e(0xf8)](_0x3a463e(0x102),_0x3a463e(0xb4)+_0x2bf969,_0x126856['status'],_0x447db2,_0x5b83ae);if(_0x447db2[_0x3a463e(0x107)]!==_0x3a463e(0xc3)){loggerService_1[_0x3a463e(0xcb)][_0x3a463e(0xdf)](_0x3a463e(0x102),_0x3a463e(0xb4)+_0x2bf969,_0x3a463e(0xce)+(_0x447db2[_0x3a463e(0xe7)]||_0x447db2[_0x3a463e(0xd2)]||_0x3a463e(0xb9)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x447db2[_0x3a463e(0xe7)]||_0x447db2[_0x3a463e(0xd2)]||'Unknown\x20error'));}let _0x55620e=_0x3a463e(0x118);return{'status':_0x55620e};}catch(_0x249583){console[_0x3a463e(0xd2)](_0x3a463e(0xf1),_0x249583),loggerService_1[_0x3a463e(0xcb)][_0x3a463e(0xdf)](_0x3a463e(0x102),_0x3a463e(0xb4)+_0x2bf969,_0x249583);throw new Error(_0x3a463e(0xd5)+(_0x249583 instanceof Error?_0x249583[_0x3a463e(0xe7)]:_0x3a463e(0xb9)));}}async['processWebhook'](_0x3b814e){const _0x1da266=a62_0x206b1d;console[_0x1da266(0x113)](_0x1da266(0x108),_0x3b814e);let _0x440202=_0x1da266(0x118);switch(_0x3b814e[_0x1da266(0x107)]?.[_0x1da266(0x11c)]()){case _0x1da266(0x106):case _0x1da266(0xde):_0x440202=_0x1da266(0xf7);break;case _0x1da266(0x10c):_0x440202=_0x1da266(0x103);break;case _0x1da266(0xd2):case'cancelled':_0x440202=_0x1da266(0xfe);break;case _0x1da266(0xbb):_0x440202=_0x1da266(0x118);break;case'pending':_0x440202=_0x1da266(0xad);break;default:_0x440202=_0x1da266(0x118);break;}let _0x9c6407;if(_0x3b814e[_0x1da266(0x115)])try{console[_0x1da266(0x113)](_0x1da266(0x109),_0x3b814e[_0x1da266(0x115)]);let _0x21d084;if(typeof _0x3b814e[_0x1da266(0x115)]===_0x1da266(0xbe))_0x21d084=JSON[_0x1da266(0xaf)](_0x3b814e['tx_urls']);else Array[_0x1da266(0xe6)](_0x3b814e[_0x1da266(0x115)])?_0x21d084=_0x3b814e[_0x1da266(0x115)]:_0x21d084=[];_0x9c6407=_0x21d084[_0x1da266(0x111)](_0x2f52ea=>{const _0x4434a1=_0x1da266,_0x3c1d55=_0x2f52ea[_0x4434a1(0xed)](/\\/g,'');return console['log'](_0x4434a1(0x11d)+_0x2f52ea+_0x4434a1(0xc7)+_0x3c1d55),_0x3c1d55;}),console[_0x1da266(0x113)](_0x1da266(0xe4),_0x9c6407),_0x9c6407['forEach']((_0xda7dc,_0x4775b7)=>{const _0x58a63d=_0x1da266;try{new URL(_0xda7dc),console['log'](_0x58a63d(0xec)+(_0x4775b7+0x1)+_0x58a63d(0xc9)+_0xda7dc);}catch(_0xdaf25a){console[_0x58a63d(0xd2)](_0x58a63d(0xee)+(_0x4775b7+0x1)+_0x58a63d(0x110)+_0xda7dc,_0xdaf25a);}});}catch(_0x3efcae){console[_0x1da266(0xd2)](_0x1da266(0x101),_0x3efcae),console[_0x1da266(0xd2)](_0x1da266(0xc4),_0x3b814e['tx_urls']),_0x9c6407=undefined;}return{'paymentId':_0x3b814e[_0x1da266(0xe1)]||'','status':_0x440202,'amount':_0x3b814e['amount'],'currency':_0x3b814e[_0x1da266(0xc0)],'txUrls':_0x9c6407};}}exports[a62_0x206b1d(0xf4)]=PlisioService;