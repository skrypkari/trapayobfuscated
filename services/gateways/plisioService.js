'use strict';const a41_0x59d59f=a41_0x2ac0;(function(_0x4dbd9a,_0x5a0a49){const _0x5d585d=a41_0x2ac0,_0x32073f=_0x4dbd9a();while(!![]){try{const _0x3a89cb=-parseInt(_0x5d585d(0x17a))/0x1+-parseInt(_0x5d585d(0x188))/0x2+-parseInt(_0x5d585d(0x191))/0x3*(-parseInt(_0x5d585d(0x150))/0x4)+-parseInt(_0x5d585d(0x15c))/0x5+-parseInt(_0x5d585d(0x193))/0x6+-parseInt(_0x5d585d(0x18e))/0x7*(-parseInt(_0x5d585d(0x172))/0x8)+parseInt(_0x5d585d(0x145))/0x9;if(_0x3a89cb===_0x5a0a49)break;else _0x32073f['push'](_0x32073f['shift']());}catch(_0x24d888){_0x32073f['push'](_0x32073f['shift']());}}}(a41_0xfd17,0x1fe2b));function a41_0x2ac0(_0x5b43e8,_0x5e24e4){const _0xfd1704=a41_0xfd17();return a41_0x2ac0=function(_0x2ac0d3,_0x325530){_0x2ac0d3=_0x2ac0d3-0x132;let _0x45ddc5=_0xfd1704[_0x2ac0d3];return _0x45ddc5;},a41_0x2ac0(_0x5b43e8,_0x5e24e4);}Object['defineProperty'](exports,a41_0x59d59f(0x17c),{'value':!![]}),exports['PlisioService']=void 0x0;function a41_0xfd17(){const _0x2aed0a=['application/json','https://api.plisio.net/api/v1/invoices/new','24224pPCQMI','Error\x20stack:','Unknown\x20error\x20from\x20Plisio\x20API','HTTP\x20error!\x20status:\x20','Unknown\x20error','PENDING','Error\x20details:','source_currency','expired','TesSoft\x20Payment\x20System/1.0','(crypto\x20for\x20payment)','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','1150470ELvmHR','logWhiteDomainResponse','message','Response\x20data:','txn_id','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Plisio\x20API\x20error:\x20','FAILED','/operations/','amount','URL:','log','order_number','Error\x20Message:','Raw\x20Response\x20Body:','JSON\x20Parse\x20Error:\x20','env','cancelled','Plisio\x20API\x20key\x20is\x20not\x20configured','createPayment','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','40kuYhmQ','HIDDEN','apiUrl','stack','error','verifyPayment','Parsed\x20Result:','Error\x20message:','26573jeSIgF','apiKey','__esModule','currency','email','HTTP\x20Status:','logWhiteDomainRequest','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','status','Status\x20Text:','invoice_url','===\x20PLISIO\x20API\x20ERROR\x20===','HTTP\x20','https://api.trapay.uk/api/webhooks/gateway/plisio','101318FfYmTM','replace','invoice_total_sum','loggerService','../loggerService','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','241843pLYfIi','parse','https://api.plisio.net/api/v1/operations/','102pbYgqS','Parameters:','1296924BZdCRa','PLISIO_API_KEY','mismatch','append','fromEntries','success','completed','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','data','Full\x20URL\x20(without\x20API\x20key):','Transaction\x20ID:','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','now','(fiat\x20for\x20merchant)','name','Response\x20Body:','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','logWhiteDomainError','statusText','plisio_direct','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','entries','PlisioService','GET','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','2478906EmdPVT','Target\x20Currency:','toString','text','Amount:','Business\x20Error:\x20','PAID','/invoices/new','Invoice\x20URL:'];a41_0xfd17=function(){return _0x2aed0a;};return a41_0xfd17();}const loggerService_1=require(a41_0x59d59f(0x18c));class PlisioService{constructor(){const _0x9c1107=a41_0x59d59f;this[_0x9c1107(0x174)]=_0x9c1107(0x14f),this[_0x9c1107(0x17b)]=process[_0x9c1107(0x16c)][_0x9c1107(0x194)]||'',!this['apiKey']?console['warn']('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x9c1107(0x167)](_0x9c1107(0x18d));}async[a41_0x59d59f(0x16f)](_0x139c25){const _0x4cbc5b=a41_0x59d59f,{orderId:_0x4981ae,amount:_0x58a264,currency:_0x2b3789,productName:_0x4908bf,description:_0x30cd74,successUrl:_0x5dae11,failUrl:_0x5923d9,customerEmail:_0x461704,customerName:_0x34974d,isSourceCurrency:_0x1da3ad,sourceCurrency:_0x14f399}=_0x139c25;if(!this['apiKey'])throw new Error(_0x4cbc5b(0x16e));const _0xf4a832=new URLSearchParams({'api_key':this[_0x4cbc5b(0x17b)],'order_number':_0x4981ae,'order_name':_0x4908bf,'description':_0x30cd74,'success_url':_0x5dae11,'fail_url':_0x5923d9,'callback_url':_0x4cbc5b(0x187)});_0x14f399?(_0xf4a832[_0x4cbc5b(0x196)](_0x4cbc5b(0x17d),_0x14f399),_0xf4a832[_0x4cbc5b(0x196)](_0x4cbc5b(0x157),_0x2b3789),_0xf4a832[_0x4cbc5b(0x196)]('source_amount',_0x58a264[_0x4cbc5b(0x147)]())):(_0xf4a832[_0x4cbc5b(0x196)](_0x4cbc5b(0x17d),_0x2b3789),_0xf4a832[_0x4cbc5b(0x196)](_0x4cbc5b(0x165),_0x58a264['toString']()));_0x461704&&_0xf4a832[_0x4cbc5b(0x196)](_0x4cbc5b(0x17e),_0x461704);_0x34974d&&_0xf4a832[_0x4cbc5b(0x196)](_0x4cbc5b(0x139),_0x34974d);const _0x2d3389=this[_0x4cbc5b(0x174)]+'?'+_0xf4a832[_0x4cbc5b(0x147)](),_0x24914b=Date[_0x4cbc5b(0x137)]();try{console[_0x4cbc5b(0x167)](_0x4cbc5b(0x181)),console['log'](_0x4cbc5b(0x166),this['apiUrl']),console['log'](_0x4cbc5b(0x192),Object[_0x4cbc5b(0x197)](_0xf4a832[_0x4cbc5b(0x140)]())),console[_0x4cbc5b(0x167)](_0x4cbc5b(0x134),_0x2d3389[_0x4cbc5b(0x189)](this[_0x4cbc5b(0x17b)],_0x4cbc5b(0x173))),loggerService_1[_0x4cbc5b(0x18b)]['logWhiteDomainRequest'](_0x4cbc5b(0x13e),_0x4cbc5b(0x14c),_0x4cbc5b(0x142),Object[_0x4cbc5b(0x197)](_0xf4a832[_0x4cbc5b(0x140)]()));const _0x5dac29=await fetch(_0x2d3389,{'method':_0x4cbc5b(0x142),'headers':{'Accept':_0x4cbc5b(0x14e),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x51face=Date[_0x4cbc5b(0x137)]()-_0x24914b;console[_0x4cbc5b(0x167)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x4cbc5b(0x167)]('Status:',_0x5dac29[_0x4cbc5b(0x182)]),console[_0x4cbc5b(0x167)](_0x4cbc5b(0x183),_0x5dac29[_0x4cbc5b(0x13d)]),console[_0x4cbc5b(0x167)]('Response\x20Time:',_0x51face+'ms');const _0x1f7683=await _0x5dac29[_0x4cbc5b(0x148)]();console['log'](_0x4cbc5b(0x16a),_0x1f7683);if(!_0x5dac29['ok']){console[_0x4cbc5b(0x176)](_0x4cbc5b(0x185)),console[_0x4cbc5b(0x176)](_0x4cbc5b(0x17f),_0x5dac29[_0x4cbc5b(0x182)]),console[_0x4cbc5b(0x176)](_0x4cbc5b(0x13a),_0x1f7683),loggerService_1[_0x4cbc5b(0x18b)][_0x4cbc5b(0x15d)](_0x4cbc5b(0x13e),'/invoices/new',_0x5dac29[_0x4cbc5b(0x182)],_0x1f7683,_0x51face),loggerService_1['loggerService']['logWhiteDomainError'](_0x4cbc5b(0x13e),'/invoices/new',_0x4cbc5b(0x186)+_0x5dac29[_0x4cbc5b(0x182)]+':\x20'+_0x1f7683);throw new Error(_0x4cbc5b(0x153)+_0x5dac29[_0x4cbc5b(0x182)]+',\x20body:\x20'+_0x1f7683);}let _0x21bb3f;try{_0x21bb3f=JSON[_0x4cbc5b(0x18f)](_0x1f7683);}catch(_0x348cf5){console[_0x4cbc5b(0x176)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x348cf5),loggerService_1['loggerService'][_0x4cbc5b(0x13c)](_0x4cbc5b(0x13e),_0x4cbc5b(0x14c),_0x4cbc5b(0x16b)+_0x348cf5);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x1f7683);}console['log'](_0x4cbc5b(0x144)),console[_0x4cbc5b(0x167)](_0x4cbc5b(0x178),JSON['stringify'](_0x21bb3f,null,0x2)),loggerService_1[_0x4cbc5b(0x18b)][_0x4cbc5b(0x15d)]('plisio_direct',_0x4cbc5b(0x14c),_0x5dac29['status'],_0x21bb3f,_0x51face);if(_0x21bb3f[_0x4cbc5b(0x182)]!==_0x4cbc5b(0x198)){const _0x4d7ed7=_0x21bb3f[_0x4cbc5b(0x15e)]||_0x21bb3f[_0x4cbc5b(0x176)]||_0x4cbc5b(0x152);console[_0x4cbc5b(0x176)](_0x4cbc5b(0x161)),console['error'](_0x4cbc5b(0x169),_0x4d7ed7),loggerService_1['loggerService'][_0x4cbc5b(0x13c)]('plisio_direct',_0x4cbc5b(0x14c),_0x4cbc5b(0x14a)+_0x4d7ed7);throw new Error(_0x4cbc5b(0x162)+_0x4d7ed7);}if(!_0x21bb3f['data']?.[_0x4cbc5b(0x160)]||!_0x21bb3f[_0x4cbc5b(0x133)]?.['invoice_url']){console['error'](_0x4cbc5b(0x143)),console[_0x4cbc5b(0x176)](_0x4cbc5b(0x13f)),console[_0x4cbc5b(0x176)](_0x4cbc5b(0x15f),_0x21bb3f['data']),loggerService_1[_0x4cbc5b(0x18b)][_0x4cbc5b(0x13c)](_0x4cbc5b(0x13e),_0x4cbc5b(0x14c),_0x4cbc5b(0x132));throw new Error(_0x4cbc5b(0x15b));}return console[_0x4cbc5b(0x167)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x4cbc5b(0x167)](_0x4cbc5b(0x135),_0x21bb3f[_0x4cbc5b(0x133)]['txn_id']),console[_0x4cbc5b(0x167)](_0x4cbc5b(0x14d),_0x21bb3f[_0x4cbc5b(0x133)][_0x4cbc5b(0x184)]),console[_0x4cbc5b(0x167)](_0x4cbc5b(0x149),_0x58a264,_0x2b3789),_0x14f399&&(console[_0x4cbc5b(0x167)]('Source\x20Currency:',_0x14f399,_0x4cbc5b(0x15a)),console[_0x4cbc5b(0x167)](_0x4cbc5b(0x146),_0x2b3789,_0x4cbc5b(0x138))),{'gateway_payment_id':_0x21bb3f['data']['txn_id'],'payment_url':_0x21bb3f[_0x4cbc5b(0x133)][_0x4cbc5b(0x184)],'invoice_total_sum':_0x21bb3f['data'][_0x4cbc5b(0x18a)],'qr_code':_0x21bb3f['data']['qr_code'],'qr_url':_0x21bb3f['data']['qr_url']};}catch(_0x2a2327){console[_0x4cbc5b(0x176)](_0x4cbc5b(0x136)),console[_0x4cbc5b(0x176)](_0x4cbc5b(0x156),_0x2a2327),loggerService_1[_0x4cbc5b(0x18b)][_0x4cbc5b(0x13c)](_0x4cbc5b(0x13e),_0x4cbc5b(0x14c),_0x2a2327);if(_0x2a2327 instanceof Error){console[_0x4cbc5b(0x176)](_0x4cbc5b(0x179),_0x2a2327[_0x4cbc5b(0x15e)]),console['error'](_0x4cbc5b(0x151),_0x2a2327[_0x4cbc5b(0x175)]);throw new Error(_0x4cbc5b(0x170)+_0x2a2327['message']);}throw new Error(_0x4cbc5b(0x13b));}}async[a41_0x59d59f(0x177)](_0x54f752){const _0xc730e=a41_0x59d59f,_0x25392a=Date[_0xc730e(0x137)]();try{if(!this[_0xc730e(0x17b)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x916c26=new URLSearchParams({'api_key':this[_0xc730e(0x17b)],'txn_id':_0x54f752}),_0x26a3eb=_0xc730e(0x190)+_0x54f752+'?'+_0x916c26[_0xc730e(0x147)]();loggerService_1[_0xc730e(0x18b)][_0xc730e(0x180)](_0xc730e(0x13e),_0xc730e(0x164)+_0x54f752,_0xc730e(0x142),Object['fromEntries'](_0x916c26[_0xc730e(0x140)]()));const _0x114fd8=await fetch(_0x26a3eb,{'method':_0xc730e(0x142),'headers':{'Accept':_0xc730e(0x14e),'User-Agent':_0xc730e(0x159)}}),_0x4b81c3=Date['now']()-_0x25392a;if(!_0x114fd8['ok']){const _0x1ae6f5=await _0x114fd8['text']();loggerService_1['loggerService'][_0xc730e(0x15d)](_0xc730e(0x13e),_0xc730e(0x164)+_0x54f752,_0x114fd8[_0xc730e(0x182)],_0x1ae6f5,_0x4b81c3);throw new Error(_0xc730e(0x153)+_0x114fd8[_0xc730e(0x182)]);}const _0x5b58a8=await _0x114fd8['json']();loggerService_1['loggerService'][_0xc730e(0x15d)](_0xc730e(0x13e),_0xc730e(0x164)+_0x54f752,_0x114fd8[_0xc730e(0x182)],_0x5b58a8,_0x4b81c3);if(_0x5b58a8['status']!==_0xc730e(0x198)){loggerService_1[_0xc730e(0x18b)][_0xc730e(0x13c)](_0xc730e(0x13e),_0xc730e(0x164)+_0x54f752,'Plisio\x20API\x20error:\x20'+(_0x5b58a8[_0xc730e(0x15e)]||_0x5b58a8[_0xc730e(0x176)]||_0xc730e(0x154)));throw new Error(_0xc730e(0x162)+(_0x5b58a8[_0xc730e(0x15e)]||_0x5b58a8[_0xc730e(0x176)]||_0xc730e(0x154)));}let _0x53b86b='PENDING';return{'status':_0x53b86b};}catch(_0x1fe080){console[_0xc730e(0x176)]('Plisio\x20payment\x20verification\x20error:',_0x1fe080),loggerService_1['loggerService']['logWhiteDomainError'](_0xc730e(0x13e),_0xc730e(0x164)+_0x54f752,_0x1fe080);throw new Error(_0xc730e(0x171)+(_0x1fe080 instanceof Error?_0x1fe080[_0xc730e(0x15e)]:_0xc730e(0x154)));}}async['processWebhook'](_0x2cb912){const _0x5e5c72=a41_0x59d59f;console[_0x5e5c72(0x167)]('Processing\x20Plisio\x20webhook:',_0x2cb912);let _0x28f494=_0x5e5c72(0x155);switch(_0x2cb912[_0x5e5c72(0x182)]?.['toLowerCase']()){case _0x5e5c72(0x199):case _0x5e5c72(0x195):_0x28f494=_0x5e5c72(0x14b);break;case _0x5e5c72(0x158):_0x28f494='EXPIRED';break;case'error':case _0x5e5c72(0x16d):_0x28f494=_0x5e5c72(0x163);break;case'new':case'pending':default:_0x28f494=_0x5e5c72(0x155);break;}return{'paymentId':_0x2cb912[_0x5e5c72(0x168)]||'','status':_0x28f494,'amount':_0x2cb912[_0x5e5c72(0x165)],'currency':_0x2cb912[_0x5e5c72(0x17d)]};}}exports[a41_0x59d59f(0x141)]=PlisioService;