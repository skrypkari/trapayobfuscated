'use strict';const a45_0x24a06e=a45_0x4969;function a45_0x286a(){const _0x2cb188=['\x20->\x20','json','stringify','Response\x20data:','defineProperty','mismatch','20oDyyUa','Full\x20URL\x20(without\x20API\x20key):','PENDING','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','status','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Source\x20Currency:','pending','qr_url','toLowerCase','source_amount','parse','now','loggerService','fromEntries','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','warn','EXPIRED','üîó\x20Formatted\x20URL:\x20','apiUrl','TesSoft\x20Payment\x20System/1.0','processWebhook','5188975XudxYr','GET','__esModule','text','Business\x20Error:\x20','HIDDEN','verifyPayment','\x20is\x20valid:\x20','toString','/operations/','message','Parsed\x20Result:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','1pHVAyZ','application/json','(fiat\x20for\x20merchant)','Error\x20message:','env','Plisio\x20API\x20error:\x20','PAID','logWhiteDomainError','order_number','HTTP\x20','/invoices/new','isArray','expired','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','invoice_url','Status:','map','1976346BsizUz','Parameters:','error','3749454tBOEDt','string','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','forEach','currency','FAILED','64hKWxtR','cancelled','Raw\x20Response\x20Body:','HTTP\x20error!\x20status:\x20','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','completed','347148DBbTdb','Processing\x20Plisio\x20webhook:','qr_code','txn_id','entries','log','statusText','apiKey','‚úÖ\x20Processed\x20tx_urls:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Invoice\x20URL:','plisio_direct','new','===\x20PLISIO\x20SUCCESS\x20===','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Unknown\x20error','3615465BiIdqL','\x20is\x20invalid:\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','logWhiteDomainRequest','replace','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','4527310YJqkaY','‚ùå\x20URL\x20','Amount:','4csSaCj','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Error\x20details:','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','data','logWhiteDomainResponse','PlisioService','append','Target\x20Currency:','stack','https://api.trapay.uk/api/webhooks/gateway/plisio','884086usAAts','Error\x20stack:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','createPayment','Response\x20Body:','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Raw\x20tx_urls\x20data:','success','PROCESSING','Transaction\x20ID:','tx_urls'];a45_0x286a=function(){return _0x2cb188;};return a45_0x286a();}(function(_0x2555ac,_0x18bbd7){const _0x4828be=a45_0x4969,_0x3d682e=_0x2555ac();while(!![]){try{const _0x446b96=parseInt(_0x4828be(0x128))/0x1*(-parseInt(_0x4828be(0xf4))/0x2)+parseInt(_0x4828be(0x13c))/0x3+parseInt(_0x4828be(0x161))/0x4*(parseInt(_0x4828be(0x15e))/0x5)+-parseInt(_0x4828be(0x139))/0x6+parseInt(_0x4828be(0x158))/0x7+parseInt(_0x4828be(0x142))/0x8*(-parseInt(_0x4828be(0x148))/0x9)+-parseInt(_0x4828be(0x105))/0xa*(parseInt(_0x4828be(0x11b))/0xb);if(_0x446b96===_0x18bbd7)break;else _0x3d682e['push'](_0x3d682e['shift']());}catch(_0xcdb465){_0x3d682e['push'](_0x3d682e['shift']());}}}(a45_0x286a,0x9e47b));function a45_0x4969(_0xb88638,_0x35ef7b){const _0x286aee=a45_0x286a();return a45_0x4969=function(_0x4969d3,_0x41795a){_0x4969d3=_0x4969d3-0xed;let _0x3280de=_0x286aee[_0x4969d3];return _0x3280de;},a45_0x4969(_0xb88638,_0x35ef7b);}Object[a45_0x24a06e(0x103)](exports,a45_0x24a06e(0x11d),{'value':!![]}),exports[a45_0x24a06e(0xef)]=void 0x0;const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x54c2e6=a45_0x24a06e;this[_0x54c2e6(0x118)]='https://api.plisio.net/api/v1/invoices/new',this[_0x54c2e6(0x14f)]=process[_0x54c2e6(0x12c)]['PLISIO_API_KEY']||'',!this[_0x54c2e6(0x14f)]?console[_0x54c2e6(0x115)](_0x54c2e6(0x108)):console[_0x54c2e6(0x14d)](_0x54c2e6(0xf9));}async[a45_0x24a06e(0xf7)](_0x48a96c){const _0x3587c9=a45_0x24a06e,{orderId:_0x43b8cd,amount:_0x503be6,currency:_0x5d5b2e,productName:_0x27a76b,description:_0xd24b39,successUrl:_0x54a581,failUrl:_0x2d7040,customerEmail:_0x334a09,customerName:_0x40a094,isSourceCurrency:_0x7589dd,sourceCurrency:_0xacfbce}=_0x48a96c;if(!this[_0x3587c9(0x14f)])throw new Error(_0x3587c9(0x15a));const _0x3ab9f8=new URLSearchParams({'api_key':this[_0x3587c9(0x14f)],'order_number':_0x43b8cd,'order_name':_0x27a76b,'description':_0xd24b39,'success_url':_0x54a581,'fail_url':_0x2d7040,'callback_url':_0x3587c9(0xf3)});_0xacfbce?(_0x3ab9f8[_0x3587c9(0xf0)]('currency',_0xacfbce),_0x3ab9f8[_0x3587c9(0xf0)]('source_currency',_0x5d5b2e),_0x3ab9f8[_0x3587c9(0xf0)](_0x3587c9(0x10f),_0x503be6[_0x3587c9(0x123)]())):(_0x3ab9f8[_0x3587c9(0xf0)](_0x3587c9(0x140),_0x5d5b2e),_0x3ab9f8['append']('amount',_0x503be6[_0x3587c9(0x123)]()));_0x334a09&&_0x3ab9f8[_0x3587c9(0xf0)]('email',_0x334a09);_0x40a094&&_0x3ab9f8['append']('name',_0x40a094);const _0x157de5=this[_0x3587c9(0x118)]+'?'+_0x3ab9f8[_0x3587c9(0x123)](),_0x259243=Date[_0x3587c9(0x111)]();try{console[_0x3587c9(0x14d)](_0x3587c9(0x114)),console[_0x3587c9(0x14d)]('URL:',this['apiUrl']),console[_0x3587c9(0x14d)](_0x3587c9(0x13a),Object[_0x3587c9(0x113)](_0x3ab9f8['entries']())),console[_0x3587c9(0x14d)](_0x3587c9(0x106),_0x157de5['replace'](this[_0x3587c9(0x14f)],_0x3587c9(0x120))),loggerService_1[_0x3587c9(0x112)][_0x3587c9(0x15b)](_0x3587c9(0x153),_0x3587c9(0x132),_0x3587c9(0x11c),Object[_0x3587c9(0x113)](_0x3ab9f8[_0x3587c9(0x14c)]()));const _0x3b875c=await fetch(_0x157de5,{'method':_0x3587c9(0x11c),'headers':{'Accept':_0x3587c9(0x129),'User-Agent':_0x3587c9(0x119)}}),_0x49706b=Date[_0x3587c9(0x111)]()-_0x259243;console[_0x3587c9(0x14d)](_0x3587c9(0x162)),console[_0x3587c9(0x14d)](_0x3587c9(0x137),_0x3b875c[_0x3587c9(0x109)]),console[_0x3587c9(0x14d)]('Status\x20Text:',_0x3b875c[_0x3587c9(0x14e)]),console['log']('Response\x20Time:',_0x49706b+'ms');const _0x271f08=await _0x3b875c['text']();console[_0x3587c9(0x14d)](_0x3587c9(0x144),_0x271f08);if(!_0x3b875c['ok']){console[_0x3587c9(0x13b)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x3587c9(0x13b)]('HTTP\x20Status:',_0x3b875c[_0x3587c9(0x109)]),console[_0x3587c9(0x13b)](_0x3587c9(0xf8),_0x271f08),loggerService_1['loggerService'][_0x3587c9(0xee)]('plisio_direct',_0x3587c9(0x132),_0x3b875c['status'],_0x271f08,_0x49706b),loggerService_1[_0x3587c9(0x112)][_0x3587c9(0x12f)]('plisio_direct','/invoices/new',_0x3587c9(0x131)+_0x3b875c[_0x3587c9(0x109)]+':\x20'+_0x271f08);throw new Error(_0x3587c9(0x145)+_0x3b875c[_0x3587c9(0x109)]+',\x20body:\x20'+_0x271f08);}let _0x559815;try{_0x559815=JSON[_0x3587c9(0x110)](_0x271f08);}catch(_0x3e0e42){console[_0x3587c9(0x13b)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x3e0e42),loggerService_1[_0x3587c9(0x112)]['logWhiteDomainError']('plisio_direct','/invoices/new','JSON\x20Parse\x20Error:\x20'+_0x3e0e42);throw new Error(_0x3587c9(0x127)+_0x271f08);}console[_0x3587c9(0x14d)](_0x3587c9(0x146)),console[_0x3587c9(0x14d)](_0x3587c9(0x126),JSON[_0x3587c9(0x101)](_0x559815,null,0x2)),loggerService_1[_0x3587c9(0x112)][_0x3587c9(0xee)]('plisio_direct',_0x3587c9(0x132),_0x3b875c[_0x3587c9(0x109)],_0x559815,_0x49706b);if(_0x559815[_0x3587c9(0x109)]!==_0x3587c9(0xfb)){const _0x57ae91=_0x559815[_0x3587c9(0x125)]||_0x559815['error']||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x3587c9(0x13b)](_0x3587c9(0x165)),console[_0x3587c9(0x13b)]('Error\x20Message:',_0x57ae91),loggerService_1[_0x3587c9(0x112)][_0x3587c9(0x12f)](_0x3587c9(0x153),'/invoices/new',_0x3587c9(0x11f)+_0x57ae91);throw new Error(_0x3587c9(0x12d)+_0x57ae91);}if(!_0x559815['data']?.[_0x3587c9(0x14b)]||!_0x559815[_0x3587c9(0xed)]?.[_0x3587c9(0x136)]){console['error']('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x3587c9(0xf6)),console[_0x3587c9(0x13b)](_0x3587c9(0x102),_0x559815[_0x3587c9(0xed)]),loggerService_1[_0x3587c9(0x112)][_0x3587c9(0x12f)](_0x3587c9(0x153),_0x3587c9(0x132),_0x3587c9(0x151));throw new Error(_0x3587c9(0x156));}return console[_0x3587c9(0x14d)](_0x3587c9(0x155)),console['log'](_0x3587c9(0xfd),_0x559815[_0x3587c9(0xed)][_0x3587c9(0x14b)]),console[_0x3587c9(0x14d)](_0x3587c9(0x152),_0x559815[_0x3587c9(0xed)][_0x3587c9(0x136)]),console[_0x3587c9(0x14d)](_0x3587c9(0x160),_0x503be6,_0x5d5b2e),_0xacfbce&&(console[_0x3587c9(0x14d)](_0x3587c9(0x10b),_0xacfbce,'(crypto\x20for\x20payment)'),console['log'](_0x3587c9(0xf1),_0x5d5b2e,_0x3587c9(0x12a))),{'gateway_payment_id':_0x559815[_0x3587c9(0xed)]['txn_id'],'payment_url':_0x559815[_0x3587c9(0xed)]['invoice_url'],'invoice_total_sum':_0x559815[_0x3587c9(0xed)]['invoice_total_sum'],'qr_code':_0x559815[_0x3587c9(0xed)][_0x3587c9(0x14a)],'qr_url':_0x559815[_0x3587c9(0xed)][_0x3587c9(0x10d)]};}catch(_0x510831){console['error'](_0x3587c9(0x13e)),console['error'](_0x3587c9(0x164),_0x510831),loggerService_1['loggerService'][_0x3587c9(0x12f)](_0x3587c9(0x153),_0x3587c9(0x132),_0x510831);if(_0x510831 instanceof Error){console[_0x3587c9(0x13b)](_0x3587c9(0x12b),_0x510831[_0x3587c9(0x125)]),console[_0x3587c9(0x13b)](_0x3587c9(0xf5),_0x510831[_0x3587c9(0xf2)]);throw new Error(_0x3587c9(0x10a)+_0x510831[_0x3587c9(0x125)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a45_0x24a06e(0x121)](_0x380a0f){const _0x30e0ce=a45_0x24a06e,_0x2ca274=Date['now']();try{if(!this[_0x30e0ce(0x14f)])throw new Error(_0x30e0ce(0x15a));const _0x43d024=new URLSearchParams({'api_key':this[_0x30e0ce(0x14f)],'txn_id':_0x380a0f}),_0x109570='https://api.plisio.net/api/v1/operations/'+_0x380a0f+'?'+_0x43d024[_0x30e0ce(0x123)]();loggerService_1['loggerService'][_0x30e0ce(0x15b)](_0x30e0ce(0x153),_0x30e0ce(0x124)+_0x380a0f,_0x30e0ce(0x11c),Object['fromEntries'](_0x43d024[_0x30e0ce(0x14c)]()));const _0x3e0a13=await fetch(_0x109570,{'method':_0x30e0ce(0x11c),'headers':{'Accept':_0x30e0ce(0x129),'User-Agent':_0x30e0ce(0x119)}}),_0xe92270=Date[_0x30e0ce(0x111)]()-_0x2ca274;if(!_0x3e0a13['ok']){const _0x322d77=await _0x3e0a13[_0x30e0ce(0x11e)]();loggerService_1['loggerService'][_0x30e0ce(0xee)]('plisio_direct',_0x30e0ce(0x124)+_0x380a0f,_0x3e0a13[_0x30e0ce(0x109)],_0x322d77,_0xe92270);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3e0a13[_0x30e0ce(0x109)]);}const _0x544ea9=await _0x3e0a13[_0x30e0ce(0x100)]();loggerService_1[_0x30e0ce(0x112)]['logWhiteDomainResponse'](_0x30e0ce(0x153),_0x30e0ce(0x124)+_0x380a0f,_0x3e0a13['status'],_0x544ea9,_0xe92270);if(_0x544ea9[_0x30e0ce(0x109)]!==_0x30e0ce(0xfb)){loggerService_1[_0x30e0ce(0x112)][_0x30e0ce(0x12f)](_0x30e0ce(0x153),_0x30e0ce(0x124)+_0x380a0f,_0x30e0ce(0x12d)+(_0x544ea9[_0x30e0ce(0x125)]||_0x544ea9[_0x30e0ce(0x13b)]||_0x30e0ce(0x157)));throw new Error(_0x30e0ce(0x12d)+(_0x544ea9[_0x30e0ce(0x125)]||_0x544ea9[_0x30e0ce(0x13b)]||_0x30e0ce(0x157)));}let _0x510382=_0x30e0ce(0x107);return{'status':_0x510382};}catch(_0x281e09){console[_0x30e0ce(0x13b)]('Plisio\x20payment\x20verification\x20error:',_0x281e09),loggerService_1[_0x30e0ce(0x112)][_0x30e0ce(0x12f)](_0x30e0ce(0x153),'/operations/'+_0x380a0f,_0x281e09);throw new Error(_0x30e0ce(0x163)+(_0x281e09 instanceof Error?_0x281e09[_0x30e0ce(0x125)]:_0x30e0ce(0x157)));}}async[a45_0x24a06e(0x11a)](_0x45eea9){const _0x15c75c=a45_0x24a06e;console[_0x15c75c(0x14d)](_0x15c75c(0x149),_0x45eea9);let _0x1d4eda=_0x15c75c(0x107);switch(_0x45eea9[_0x15c75c(0x109)]?.[_0x15c75c(0x10e)]()){case _0x15c75c(0x147):case _0x15c75c(0x104):_0x1d4eda=_0x15c75c(0x12e);break;case _0x15c75c(0x134):_0x1d4eda=_0x15c75c(0x116);break;case _0x15c75c(0x13b):case _0x15c75c(0x143):_0x1d4eda=_0x15c75c(0x141);break;case _0x15c75c(0x154):_0x1d4eda=_0x15c75c(0x107);break;case _0x15c75c(0x10c):_0x1d4eda=_0x15c75c(0xfc);break;default:_0x1d4eda=_0x15c75c(0x107);break;}let _0x4a3dbc;if(_0x45eea9[_0x15c75c(0xfe)])try{console['log'](_0x15c75c(0x135),_0x45eea9[_0x15c75c(0xfe)]);let _0xd4347e;if(typeof _0x45eea9[_0x15c75c(0xfe)]===_0x15c75c(0x13d))_0xd4347e=JSON[_0x15c75c(0x110)](_0x45eea9[_0x15c75c(0xfe)]);else Array[_0x15c75c(0x133)](_0x45eea9[_0x15c75c(0xfe)])?_0xd4347e=_0x45eea9['tx_urls']:_0xd4347e=[];_0x4a3dbc=_0xd4347e[_0x15c75c(0x138)](_0x3ab7c2=>{const _0x32e1b7=_0x15c75c,_0x2db884=_0x3ab7c2[_0x32e1b7(0x15c)](/\\/g,'');return console[_0x32e1b7(0x14d)](_0x32e1b7(0x117)+_0x3ab7c2+_0x32e1b7(0xff)+_0x2db884),_0x2db884;}),console[_0x15c75c(0x14d)](_0x15c75c(0x150),_0x4a3dbc),_0x4a3dbc[_0x15c75c(0x13f)]((_0x3fa22e,_0x5661cf)=>{const _0x37b2b7=_0x15c75c;try{new URL(_0x3fa22e),console[_0x37b2b7(0x14d)]('‚úÖ\x20URL\x20'+(_0x5661cf+0x1)+_0x37b2b7(0x122)+_0x3fa22e);}catch(_0x1416d3){console['error'](_0x37b2b7(0x15f)+(_0x5661cf+0x1)+_0x37b2b7(0x159)+_0x3fa22e,_0x1416d3);}});}catch(_0x33d494){console[_0x15c75c(0x13b)](_0x15c75c(0x15d),_0x33d494),console['error'](_0x15c75c(0xfa),_0x45eea9[_0x15c75c(0xfe)]),_0x4a3dbc=undefined;}return{'paymentId':_0x45eea9[_0x15c75c(0x130)]||'','status':_0x1d4eda,'amount':_0x45eea9['amount'],'currency':_0x45eea9[_0x15c75c(0x140)],'txUrls':_0x4a3dbc};}}exports[a45_0x24a06e(0xef)]=PlisioService;