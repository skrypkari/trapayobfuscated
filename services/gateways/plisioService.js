'use strict';const a66_0x2fe702=a66_0x3d56;function a66_0x4161(){const _0x578a22=['1969533ZjNnaH','https://api.trapay.uk/api/webhooks/gateway/plisio','https://api.plisio.net/api/v1/invoices/new','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','status','===\x20PLISIO\x20API\x20ERROR\x20===','Error\x20details:','===\x20PLISIO\x20SUCCESS\x20===','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Payment\x20System/1.0','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','log','__esModule','json','Raw\x20Response\x20Body:','HTTP\x20Status:','6462064QEqXar','HTTP\x20','qr_url','stringify','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','üîó\x20Formatted\x20URL:\x20','cancelled','2009058mmHMkf','\x20is\x20valid:\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','qr_code','plisio_direct','30KxkKIJ','processWebhook','new','verifyPayment','Full\x20URL\x20(without\x20API\x20key):','stack','‚úÖ\x20URL\x20','parse','Target\x20Currency:','apiKey','error','1812IHRevD','5MJwMuO','Response\x20data:','/invoices/new','Processing\x20Plisio\x20webhook:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','26JwKnuW','(fiat\x20for\x20merchant)','1853691zgbAQT','FAILED','amount','statusText','logWhiteDomainError','Invoice\x20URL:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','680703jRHpQq','data','isArray','email','28259ipporO','Parsed\x20Result:','16xfFggH','4xkqcDU','loggerService',',\x20body:\x20','Business\x20Error:\x20','PLISIO_API_KEY','Error\x20stack:','string','URL:','Status\x20Text:','https://api.plisio.net/api/v1/operations/','Parameters:','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Error\x20message:','JSON\x20Parse\x20Error:\x20','HTTP\x20error!\x20status:\x20','../loggerService','source_amount','append','PlisioService','txn_id','now','invoice_url','EXPIRED','Failed\x20to\x20create\x20Plisio\x20payment:\x20','map','2wQtMzl','tx_urls','HIDDEN','/operations/','toString','success','Unknown\x20error','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','615345CjvgPg','warn','message','entries','order_number','text','application/json','logWhiteDomainRequest','‚úÖ\x20Processed\x20tx_urls:','replace','currency','env','PROCESSING','\x20is\x20invalid:\x20','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Status:','Plisio\x20API\x20error:\x20','pending','\x20->\x20','PENDING','GET','logWhiteDomainResponse','source_currency','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','forEach','Amount:','PAID','defineProperty','expired','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','(crypto\x20for\x20payment)','Source\x20Currency:','Response\x20Body:','fromEntries','Error\x20Message:','apiUrl','invoice_total_sum','name'];a66_0x4161=function(){return _0x578a22;};return a66_0x4161();}(function(_0x3eb3bb,_0x5172f1){const _0x1c8e21=a66_0x3d56,_0x1fbd91=_0x3eb3bb();while(!![]){try{const _0x5c5b79=-parseInt(_0x1c8e21(0xb7))/0x1*(parseInt(_0x1c8e21(0xaf))/0x2)+-parseInt(_0x1c8e21(0x115))/0x3*(-parseInt(_0x1c8e21(0x11c))/0x4)+parseInt(_0x1c8e21(0x107))/0x5*(parseInt(_0x1c8e21(0xf6))/0x6)+-parseInt(_0x1c8e21(0x10e))/0x7*(-parseInt(_0x1c8e21(0x11b))/0x8)+-parseInt(_0x1c8e21(0xde))/0x9*(parseInt(_0x1c8e21(0xfb))/0xa)+parseInt(_0x1c8e21(0x119))/0xb*(-parseInt(_0x1c8e21(0x106))/0xc)+parseInt(_0x1c8e21(0x10c))/0xd*(parseInt(_0x1c8e21(0xef))/0xe);if(_0x5c5b79===_0x5172f1)break;else _0x1fbd91['push'](_0x1fbd91['shift']());}catch(_0x35bb03){_0x1fbd91['push'](_0x1fbd91['shift']());}}}(a66_0x4161,0x569bb));Object[a66_0x2fe702(0xd3)](exports,a66_0x2fe702(0xeb),{'value':!![]}),exports[a66_0x2fe702(0xa8)]=void 0x0;const loggerService_1=require(a66_0x2fe702(0xa5));class PlisioService{constructor(){const _0x11a8ba=a66_0x2fe702;this[_0x11a8ba(0xdb)]=_0x11a8ba(0xe0),this[_0x11a8ba(0x104)]=process[_0x11a8ba(0xc2)][_0x11a8ba(0x120)]||'',!this[_0x11a8ba(0x104)]?console[_0x11a8ba(0xb8)](_0x11a8ba(0x127)):console['log'](_0x11a8ba(0xcf));}async['createPayment'](_0x2272da){const _0x408516=a66_0x2fe702,{orderId:_0x148952,amount:_0x24ebb9,currency:_0x66afc3,productName:_0x21d7e3,description:_0x396385,successUrl:_0x8dd50,failUrl:_0x5b05bd,customerEmail:_0x4ff9b3,customerName:_0x3c2717,isSourceCurrency:_0x224cd6,sourceCurrency:_0x20eac7}=_0x2272da;if(!this[_0x408516(0x104)])throw new Error(_0x408516(0xf8));const _0x3afcc2=new URLSearchParams({'api_key':this[_0x408516(0x104)],'order_number':_0x148952,'order_name':_0x21d7e3,'description':_0x396385,'success_url':_0x8dd50,'fail_url':_0x5b05bd,'callback_url':_0x408516(0xdf)});_0x20eac7?(_0x3afcc2['append'](_0x408516(0xc1),_0x20eac7),_0x3afcc2[_0x408516(0xa7)](_0x408516(0xce),_0x66afc3),_0x3afcc2[_0x408516(0xa7)](_0x408516(0xa6),_0x24ebb9['toString']())):(_0x3afcc2['append'](_0x408516(0xc1),_0x66afc3),_0x3afcc2[_0x408516(0xa7)](_0x408516(0x110),_0x24ebb9['toString']()));_0x4ff9b3&&_0x3afcc2[_0x408516(0xa7)](_0x408516(0x118),_0x4ff9b3);_0x3c2717&&_0x3afcc2['append'](_0x408516(0xdd),_0x3c2717);const _0x12ed35=this[_0x408516(0xdb)]+'?'+_0x3afcc2['toString'](),_0x1fe5c2=Date[_0x408516(0xaa)]();try{console['log'](_0x408516(0x10b)),console[_0x408516(0xea)](_0x408516(0x123),this[_0x408516(0xdb)]),console['log'](_0x408516(0x126),Object[_0x408516(0xd9)](_0x3afcc2['entries']())),console['log'](_0x408516(0xff),_0x12ed35[_0x408516(0xc0)](this[_0x408516(0x104)],_0x408516(0xb1))),loggerService_1[_0x408516(0x11d)][_0x408516(0xbe)]('plisio_direct',_0x408516(0x109),'GET',Object[_0x408516(0xd9)](_0x3afcc2[_0x408516(0xba)]()));const _0x2c42cb=await fetch(_0x12ed35,{'method':'GET','headers':{'Accept':_0x408516(0xbd),'User-Agent':'Payment\x20System/1.0'}}),_0x16bcdd=Date['now']()-_0x1fe5c2;console[_0x408516(0xea)](_0x408516(0xf3)),console[_0x408516(0xea)](_0x408516(0xc7),_0x2c42cb['status']),console[_0x408516(0xea)](_0x408516(0x124),_0x2c42cb[_0x408516(0x111)]),console['log']('Response\x20Time:',_0x16bcdd+'ms');const _0x1f5b7d=await _0x2c42cb[_0x408516(0xbc)]();console[_0x408516(0xea)](_0x408516(0xed),_0x1f5b7d);if(!_0x2c42cb['ok']){console[_0x408516(0x105)](_0x408516(0xe4)),console[_0x408516(0x105)](_0x408516(0xee),_0x2c42cb[_0x408516(0xe3)]),console[_0x408516(0x105)](_0x408516(0xd8),_0x1f5b7d),loggerService_1[_0x408516(0x11d)][_0x408516(0xcd)](_0x408516(0xfa),_0x408516(0x109),_0x2c42cb[_0x408516(0xe3)],_0x1f5b7d,_0x16bcdd),loggerService_1[_0x408516(0x11d)]['logWhiteDomainError'](_0x408516(0xfa),_0x408516(0x109),_0x408516(0xf0)+_0x2c42cb['status']+':\x20'+_0x1f5b7d);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2c42cb[_0x408516(0xe3)]+_0x408516(0x11e)+_0x1f5b7d);}let _0x58c132;try{_0x58c132=JSON['parse'](_0x1f5b7d);}catch(_0x1ff677){console[_0x408516(0x105)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x1ff677),loggerService_1[_0x408516(0x11d)]['logWhiteDomainError']('plisio_direct',_0x408516(0x109),_0x408516(0xa3)+_0x1ff677);throw new Error(_0x408516(0xe2)+_0x1f5b7d);}console[_0x408516(0xea)](_0x408516(0xc5)),console['log'](_0x408516(0x11a),JSON[_0x408516(0xf2)](_0x58c132,null,0x2)),loggerService_1[_0x408516(0x11d)][_0x408516(0xcd)](_0x408516(0xfa),_0x408516(0x109),_0x2c42cb[_0x408516(0xe3)],_0x58c132,_0x16bcdd);if(_0x58c132[_0x408516(0xe3)]!==_0x408516(0xb4)){const _0x5d086b=_0x58c132[_0x408516(0xb9)]||_0x58c132[_0x408516(0x105)]||'Unknown\x20error\x20from\x20Plisio\x20API';console['error'](_0x408516(0xb6)),console['error'](_0x408516(0xda),_0x5d086b),loggerService_1[_0x408516(0x11d)]['logWhiteDomainError']('plisio_direct',_0x408516(0x109),_0x408516(0x11f)+_0x5d086b);throw new Error('Plisio\x20API\x20error:\x20'+_0x5d086b);}if(!_0x58c132[_0x408516(0x116)]?.[_0x408516(0xa9)]||!_0x58c132[_0x408516(0x116)]?.[_0x408516(0xab)]){console[_0x408516(0x105)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x408516(0x105)](_0x408516(0x114)),console[_0x408516(0x105)](_0x408516(0x108),_0x58c132[_0x408516(0x116)]),loggerService_1[_0x408516(0x11d)][_0x408516(0x112)](_0x408516(0xfa),'/invoices/new',_0x408516(0xd5));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x408516(0xea)](_0x408516(0xe6)),console[_0x408516(0xea)]('Transaction\x20ID:',_0x58c132['data']['txn_id']),console[_0x408516(0xea)](_0x408516(0x113),_0x58c132[_0x408516(0x116)][_0x408516(0xab)]),console[_0x408516(0xea)](_0x408516(0xd1),_0x24ebb9,_0x66afc3),_0x20eac7&&(console[_0x408516(0xea)](_0x408516(0xd7),_0x20eac7,_0x408516(0xd6)),console[_0x408516(0xea)](_0x408516(0x103),_0x66afc3,_0x408516(0x10d))),{'gateway_payment_id':_0x58c132[_0x408516(0x116)][_0x408516(0xa9)],'payment_url':_0x58c132['data'][_0x408516(0xab)],'invoice_total_sum':_0x58c132[_0x408516(0x116)][_0x408516(0xdc)],'qr_code':_0x58c132[_0x408516(0x116)][_0x408516(0xf9)],'qr_url':_0x58c132[_0x408516(0x116)][_0x408516(0xf1)]};}catch(_0x3c33e4){console[_0x408516(0x105)](_0x408516(0xe7)),console[_0x408516(0x105)](_0x408516(0xe5),_0x3c33e4),loggerService_1[_0x408516(0x11d)][_0x408516(0x112)]('plisio_direct',_0x408516(0x109),_0x3c33e4);if(_0x3c33e4 instanceof Error){console[_0x408516(0x105)](_0x408516(0x128),_0x3c33e4[_0x408516(0xb9)]),console[_0x408516(0x105)](_0x408516(0x121),_0x3c33e4[_0x408516(0x100)]);throw new Error(_0x408516(0xad)+_0x3c33e4[_0x408516(0xb9)]);}throw new Error(_0x408516(0xc6));}}async[a66_0x2fe702(0xfe)](_0x3753d1){const _0x40ba7d=a66_0x2fe702,_0x13859b=Date[_0x40ba7d(0xaa)]();try{if(!this['apiKey'])throw new Error(_0x40ba7d(0xf8));const _0x5b39f0=new URLSearchParams({'api_key':this[_0x40ba7d(0x104)],'txn_id':_0x3753d1}),_0x165cd5=_0x40ba7d(0x125)+_0x3753d1+'?'+_0x5b39f0[_0x40ba7d(0xb3)]();loggerService_1[_0x40ba7d(0x11d)][_0x40ba7d(0xbe)](_0x40ba7d(0xfa),_0x40ba7d(0xb2)+_0x3753d1,_0x40ba7d(0xcc),Object['fromEntries'](_0x5b39f0[_0x40ba7d(0xba)]()));const _0x45a9d9=await fetch(_0x165cd5,{'method':_0x40ba7d(0xcc),'headers':{'Accept':_0x40ba7d(0xbd),'User-Agent':_0x40ba7d(0xe8)}}),_0x1fb4b5=Date[_0x40ba7d(0xaa)]()-_0x13859b;if(!_0x45a9d9['ok']){const _0x247ff5=await _0x45a9d9['text']();loggerService_1[_0x40ba7d(0x11d)][_0x40ba7d(0xcd)](_0x40ba7d(0xfa),'/operations/'+_0x3753d1,_0x45a9d9[_0x40ba7d(0xe3)],_0x247ff5,_0x1fb4b5);throw new Error(_0x40ba7d(0xa4)+_0x45a9d9[_0x40ba7d(0xe3)]);}const _0x115f3a=await _0x45a9d9[_0x40ba7d(0xec)]();loggerService_1[_0x40ba7d(0x11d)][_0x40ba7d(0xcd)](_0x40ba7d(0xfa),_0x40ba7d(0xb2)+_0x3753d1,_0x45a9d9['status'],_0x115f3a,_0x1fb4b5);if(_0x115f3a['status']!==_0x40ba7d(0xb4)){loggerService_1['loggerService']['logWhiteDomainError'](_0x40ba7d(0xfa),_0x40ba7d(0xb2)+_0x3753d1,'Plisio\x20API\x20error:\x20'+(_0x115f3a[_0x40ba7d(0xb9)]||_0x115f3a[_0x40ba7d(0x105)]||_0x40ba7d(0xb5)));throw new Error(_0x40ba7d(0xc8)+(_0x115f3a[_0x40ba7d(0xb9)]||_0x115f3a[_0x40ba7d(0x105)]||_0x40ba7d(0xb5)));}let _0x584ab9='PENDING';return{'status':_0x584ab9};}catch(_0x22303e){console[_0x40ba7d(0x105)]('Plisio\x20payment\x20verification\x20error:',_0x22303e),loggerService_1['loggerService']['logWhiteDomainError'](_0x40ba7d(0xfa),'/operations/'+_0x3753d1,_0x22303e);throw new Error(_0x40ba7d(0xe9)+(_0x22303e instanceof Error?_0x22303e[_0x40ba7d(0xb9)]:_0x40ba7d(0xb5)));}}async[a66_0x2fe702(0xfc)](_0x15c402){const _0x11d5db=a66_0x2fe702;console[_0x11d5db(0xea)](_0x11d5db(0x10a),_0x15c402);let _0x797ca6=_0x11d5db(0xcb);switch(_0x15c402[_0x11d5db(0xe3)]?.['toLowerCase']()){case'completed':case'mismatch':_0x797ca6=_0x11d5db(0xd2);break;case _0x11d5db(0xd4):_0x797ca6=_0x11d5db(0xac);break;case _0x11d5db(0x105):case _0x11d5db(0xf5):_0x797ca6=_0x11d5db(0x10f);break;case _0x11d5db(0xfd):_0x797ca6=_0x11d5db(0xcb);break;case _0x11d5db(0xc9):_0x797ca6=_0x11d5db(0xc3);break;default:_0x797ca6=_0x11d5db(0xcb);break;}let _0x294039;if(_0x15c402['tx_urls'])try{console['log']('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x15c402[_0x11d5db(0xb0)]);let _0x12cd03;if(typeof _0x15c402[_0x11d5db(0xb0)]===_0x11d5db(0x122))_0x12cd03=JSON[_0x11d5db(0x102)](_0x15c402[_0x11d5db(0xb0)]);else Array[_0x11d5db(0x117)](_0x15c402[_0x11d5db(0xb0)])?_0x12cd03=_0x15c402[_0x11d5db(0xb0)]:_0x12cd03=[];_0x294039=_0x12cd03[_0x11d5db(0xae)](_0xa3351e=>{const _0x36b0ee=_0x11d5db,_0x2593b1=_0xa3351e[_0x36b0ee(0xc0)](/\\/g,'');return console[_0x36b0ee(0xea)](_0x36b0ee(0xf4)+_0xa3351e+_0x36b0ee(0xca)+_0x2593b1),_0x2593b1;}),console[_0x11d5db(0xea)](_0x11d5db(0xbf),_0x294039),_0x294039[_0x11d5db(0xd0)]((_0x4619eb,_0x39acb2)=>{const _0x3a57fa=_0x11d5db;try{new URL(_0x4619eb),console['log'](_0x3a57fa(0x101)+(_0x39acb2+0x1)+_0x3a57fa(0xf7)+_0x4619eb);}catch(_0x523d3c){console[_0x3a57fa(0x105)]('‚ùå\x20URL\x20'+(_0x39acb2+0x1)+_0x3a57fa(0xc4)+_0x4619eb,_0x523d3c);}});}catch(_0x4ecd6f){console[_0x11d5db(0x105)](_0x11d5db(0xe1),_0x4ecd6f),console['error']('Raw\x20tx_urls\x20data:',_0x15c402['tx_urls']),_0x294039=undefined;}return{'paymentId':_0x15c402[_0x11d5db(0xbb)]||'','status':_0x797ca6,'amount':_0x15c402[_0x11d5db(0x110)],'currency':_0x15c402['currency'],'txUrls':_0x294039};}}function a66_0x3d56(_0x4b4cef,_0x44c5f0){_0x4b4cef=_0x4b4cef-0xa3;const _0x4161e6=a66_0x4161();let _0x3d56e9=_0x4161e6[_0x4b4cef];return _0x3d56e9;}exports['PlisioService']=PlisioService;