'use strict';const a55_0x59f106=a55_0x43e9;function a55_0x4eba(){const _0x529986=['invoice_total_sum','Amount:','903gHNLFJ','Error\x20details:','üîó\x20Formatted\x20URL:\x20','qr_code','entries','toLowerCase','env','logWhiteDomainError','completed','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','\x20is\x20valid:\x20','PAID','3447rUcMns','Plisio\x20API\x20error:\x20','source_currency','/operations/','replace','__esModule','apiUrl','amount','parse','Plisio\x20API\x20key\x20is\x20not\x20configured','json','status','error','Business\x20Error:\x20','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','HIDDEN','PlisioService','HTTP\x20','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','‚úÖ\x20URL\x20','10632853lISMiO','pending','invoice_url','HTTP\x20error!\x20status:\x20','194598eyPGhh','append','Parsed\x20Result:','‚ùå\x20URL\x20','isArray','forEach','3724iWMkca','HTTP\x20Status:','https://api.plisio.net/api/v1/operations/','qr_url','37656540wtfWjv','Parameters:','EXPIRED','URL:','text','PLISIO_API_KEY','===\x20PLISIO\x20API\x20ERROR\x20===','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Raw\x20Response\x20Body:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','/invoices/new','plisio_direct','name','Full\x20URL\x20(without\x20API\x20key):','message','../loggerService','verifyPayment','11BdmOPq','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','‚úÖ\x20Processed\x20tx_urls:','email','Processing\x20Plisio\x20webhook:','fromEntries','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','tx_urls','apiKey','Plisio\x20payment\x20verification\x20error:','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Status:','Unknown\x20error','statusText','processWebhook','12844940MwGayX','GET','2494waaUFI','order_number','(crypto\x20for\x20payment)','loggerService','Target\x20Currency:','warn',',\x20body:\x20','toString','FAILED','Status\x20Text:','stringify','Response\x20Time:','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Unknown\x20error\x20from\x20Plisio\x20API','Transaction\x20ID:','Failed\x20to\x20parse\x20JSON\x20response:','createPayment','now','new','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','mismatch','Failed\x20to\x20create\x20Plisio\x20payment:\x20','\x20is\x20invalid:\x20','string','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','PENDING','txn_id','1961405TcvoMd','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','6iPeCuH','currency','logWhiteDomainRequest','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','success','log','Raw\x20tx_urls\x20data:','data','272eRJrOp'];a55_0x4eba=function(){return _0x529986;};return a55_0x4eba();}(function(_0x2c0c40,_0x2416dd){const _0x46c94b=a55_0x43e9,_0x2ce1a5=_0x2c0c40();while(!![]){try{const _0x2de16b=parseInt(_0x46c94b(0xcd))/0x1*(-parseInt(_0x46c94b(0x11f))/0x2)+parseInt(_0x46c94b(0xd9))/0x3*(-parseInt(_0x46c94b(0xf7))/0x4)+parseInt(_0x46c94b(0xc0))/0x5*(parseInt(_0x46c94b(0xc2))/0x6)+parseInt(_0x46c94b(0xed))/0x7+parseInt(_0x46c94b(0xca))/0x8*(-parseInt(_0x46c94b(0xf1))/0x9)+-parseInt(_0x46c94b(0x11d))/0xa+-parseInt(_0x46c94b(0x10d))/0xb*(-parseInt(_0x46c94b(0xfb))/0xc);if(_0x2de16b===_0x2416dd)break;else _0x2ce1a5['push'](_0x2ce1a5['shift']());}catch(_0x1a7a06){_0x2ce1a5['push'](_0x2ce1a5['shift']());}}}(a55_0x4eba,0xcb96f));function a55_0x43e9(_0x13c87f,_0x2c0c73){const _0x4eba54=a55_0x4eba();return a55_0x43e9=function(_0x43e9d6,_0x31f13b){_0x43e9d6=_0x43e9d6-0xb6;let _0x73fe02=_0x4eba54[_0x43e9d6];return _0x73fe02;},a55_0x43e9(_0x13c87f,_0x2c0c73);}Object['defineProperty'](exports,a55_0x59f106(0xde),{'value':!![]}),exports[a55_0x59f106(0xe9)]=void 0x0;const loggerService_1=require(a55_0x59f106(0x10b));class PlisioService{constructor(){const _0x3a5132=a55_0x59f106;this[_0x3a5132(0xdf)]='https://api.plisio.net/api/v1/invoices/new',this[_0x3a5132(0x115)]=process[_0x3a5132(0xd3)][_0x3a5132(0x100)]||'',!this[_0x3a5132(0x115)]?console[_0x3a5132(0x124)](_0x3a5132(0x117)):console[_0x3a5132(0xc7)](_0x3a5132(0x105));}async[a55_0x59f106(0x12f)](_0x8d394d){const _0x12e5be=a55_0x59f106,{orderId:_0x585dd1,amount:_0x24e49d,currency:_0x1351b1,productName:_0x5f1ca5,description:_0x4d0578,successUrl:_0x3388b9,failUrl:_0x483455,customerEmail:_0x485f32,customerName:_0xf0771b,isSourceCurrency:_0x5e7419,sourceCurrency:_0x47bde7}=_0x8d394d;if(!this[_0x12e5be(0x115)])throw new Error(_0x12e5be(0xe2));const _0x135533=new URLSearchParams({'api_key':this[_0x12e5be(0x115)],'order_number':_0x585dd1,'order_name':_0x5f1ca5,'description':_0x4d0578,'success_url':_0x3388b9,'fail_url':_0x483455,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x47bde7?(_0x135533[_0x12e5be(0xf2)](_0x12e5be(0xc3),_0x47bde7),_0x135533[_0x12e5be(0xf2)](_0x12e5be(0xdb),_0x1351b1),_0x135533[_0x12e5be(0xf2)]('source_amount',_0x24e49d[_0x12e5be(0x126)]())):(_0x135533[_0x12e5be(0xf2)](_0x12e5be(0xc3),_0x1351b1),_0x135533[_0x12e5be(0xf2)](_0x12e5be(0xe0),_0x24e49d[_0x12e5be(0x126)]()));_0x485f32&&_0x135533[_0x12e5be(0xf2)](_0x12e5be(0x110),_0x485f32);_0xf0771b&&_0x135533[_0x12e5be(0xf2)](_0x12e5be(0x108),_0xf0771b);const _0x564e1c=this[_0x12e5be(0xdf)]+'?'+_0x135533[_0x12e5be(0x126)](),_0x570a18=Date[_0x12e5be(0xb6)]();try{console[_0x12e5be(0xc7)](_0x12e5be(0xd6)),console[_0x12e5be(0xc7)](_0x12e5be(0xfe),this[_0x12e5be(0xdf)]),console[_0x12e5be(0xc7)](_0x12e5be(0xfc),Object[_0x12e5be(0x112)](_0x135533[_0x12e5be(0xd1)]())),console[_0x12e5be(0xc7)](_0x12e5be(0x109),_0x564e1c['replace'](this[_0x12e5be(0x115)],_0x12e5be(0xe8))),loggerService_1[_0x12e5be(0x122)]['logWhiteDomainRequest'](_0x12e5be(0x107),'/invoices/new','GET',Object[_0x12e5be(0x112)](_0x135533['entries']()));const _0x4b5de3=await fetch(_0x564e1c,{'method':_0x12e5be(0x11e),'headers':{'Accept':'application/json','User-Agent':'Payment\x20System/1.0'}}),_0x22bfe8=Date[_0x12e5be(0xb6)]()-_0x570a18;console[_0x12e5be(0xc7)](_0x12e5be(0xc5)),console[_0x12e5be(0xc7)](_0x12e5be(0x119),_0x4b5de3[_0x12e5be(0xe4)]),console[_0x12e5be(0xc7)](_0x12e5be(0x128),_0x4b5de3[_0x12e5be(0x11b)]),console['log'](_0x12e5be(0x12a),_0x22bfe8+'ms');const _0x1e0714=await _0x4b5de3[_0x12e5be(0xff)]();console[_0x12e5be(0xc7)](_0x12e5be(0x103),_0x1e0714);if(!_0x4b5de3['ok']){console[_0x12e5be(0xe5)](_0x12e5be(0x101)),console[_0x12e5be(0xe5)](_0x12e5be(0xf8),_0x4b5de3[_0x12e5be(0xe4)]),console[_0x12e5be(0xe5)]('Response\x20Body:',_0x1e0714),loggerService_1[_0x12e5be(0x122)]['logWhiteDomainResponse'](_0x12e5be(0x107),_0x12e5be(0x106),_0x4b5de3[_0x12e5be(0xe4)],_0x1e0714,_0x22bfe8),loggerService_1[_0x12e5be(0x122)]['logWhiteDomainError'](_0x12e5be(0x107),_0x12e5be(0x106),_0x12e5be(0xea)+_0x4b5de3[_0x12e5be(0xe4)]+':\x20'+_0x1e0714);throw new Error(_0x12e5be(0xf0)+_0x4b5de3[_0x12e5be(0xe4)]+_0x12e5be(0x125)+_0x1e0714);}let _0xc97f62;try{_0xc97f62=JSON[_0x12e5be(0xe1)](_0x1e0714);}catch(_0x2af566){console['error'](_0x12e5be(0x12e),_0x2af566),loggerService_1[_0x12e5be(0x122)][_0x12e5be(0xd4)](_0x12e5be(0x107),'/invoices/new','JSON\x20Parse\x20Error:\x20'+_0x2af566);throw new Error(_0x12e5be(0x118)+_0x1e0714);}console[_0x12e5be(0xc7)](_0x12e5be(0xbd)),console[_0x12e5be(0xc7)](_0x12e5be(0xf3),JSON[_0x12e5be(0x129)](_0xc97f62,null,0x2)),loggerService_1[_0x12e5be(0x122)]['logWhiteDomainResponse']('plisio_direct','/invoices/new',_0x4b5de3['status'],_0xc97f62,_0x22bfe8);if(_0xc97f62[_0x12e5be(0xe4)]!=='success'){const _0xa266bc=_0xc97f62[_0x12e5be(0x10a)]||_0xc97f62[_0x12e5be(0xe5)]||_0x12e5be(0x12c);console[_0x12e5be(0xe5)](_0x12e5be(0x12b)),console[_0x12e5be(0xe5)]('Error\x20Message:',_0xa266bc),loggerService_1[_0x12e5be(0x122)][_0x12e5be(0xd4)](_0x12e5be(0x107),_0x12e5be(0x106),_0x12e5be(0xe6)+_0xa266bc);throw new Error('Plisio\x20API\x20error:\x20'+_0xa266bc);}if(!_0xc97f62[_0x12e5be(0xc9)]?.[_0x12e5be(0xbf)]||!_0xc97f62[_0x12e5be(0xc9)]?.[_0x12e5be(0xef)]){console[_0x12e5be(0xe5)](_0x12e5be(0x113)),console[_0x12e5be(0xe5)](_0x12e5be(0x104)),console[_0x12e5be(0xe5)]('Response\x20data:',_0xc97f62[_0x12e5be(0xc9)]),loggerService_1[_0x12e5be(0x122)][_0x12e5be(0xd4)]('plisio_direct',_0x12e5be(0x106),_0x12e5be(0xeb));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x12e5be(0xc7)]('===\x20PLISIO\x20SUCCESS\x20==='),console['log'](_0x12e5be(0x12d),_0xc97f62[_0x12e5be(0xc9)][_0x12e5be(0xbf)]),console[_0x12e5be(0xc7)]('Invoice\x20URL:',_0xc97f62[_0x12e5be(0xc9)][_0x12e5be(0xef)]),console[_0x12e5be(0xc7)](_0x12e5be(0xcc),_0x24e49d,_0x1351b1),_0x47bde7&&(console[_0x12e5be(0xc7)]('Source\x20Currency:',_0x47bde7,_0x12e5be(0x121)),console[_0x12e5be(0xc7)](_0x12e5be(0x123),_0x1351b1,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0xc97f62['data'][_0x12e5be(0xbf)],'payment_url':_0xc97f62['data']['invoice_url'],'invoice_total_sum':_0xc97f62[_0x12e5be(0xc9)][_0x12e5be(0xcb)],'qr_code':_0xc97f62['data'][_0x12e5be(0xd0)],'qr_url':_0xc97f62['data'][_0x12e5be(0xfa)]};}catch(_0x56097a){console[_0x12e5be(0xe5)](_0x12e5be(0xb8)),console[_0x12e5be(0xe5)](_0x12e5be(0xce),_0x56097a),loggerService_1[_0x12e5be(0x122)][_0x12e5be(0xd4)](_0x12e5be(0x107),'/invoices/new',_0x56097a);if(_0x56097a instanceof Error){console['error']('Error\x20message:',_0x56097a[_0x12e5be(0x10a)]),console[_0x12e5be(0xe5)]('Error\x20stack:',_0x56097a['stack']);throw new Error(_0x12e5be(0xba)+_0x56097a[_0x12e5be(0x10a)]);}throw new Error(_0x12e5be(0x102));}}async[a55_0x59f106(0x10c)](_0x51a68a){const _0x49ae0d=a55_0x59f106,_0x10657d=Date[_0x49ae0d(0xb6)]();try{if(!this[_0x49ae0d(0x115)])throw new Error(_0x49ae0d(0xe2));const _0x464860=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x51a68a}),_0x5c0cc9=_0x49ae0d(0xf9)+_0x51a68a+'?'+_0x464860['toString']();loggerService_1[_0x49ae0d(0x122)][_0x49ae0d(0xc4)](_0x49ae0d(0x107),_0x49ae0d(0xdc)+_0x51a68a,_0x49ae0d(0x11e),Object[_0x49ae0d(0x112)](_0x464860[_0x49ae0d(0xd1)]()));const _0x33fb7f=await fetch(_0x5c0cc9,{'method':_0x49ae0d(0x11e),'headers':{'Accept':'application/json','User-Agent':'Payment\x20System/1.0'}}),_0x410e9e=Date[_0x49ae0d(0xb6)]()-_0x10657d;if(!_0x33fb7f['ok']){const _0x354055=await _0x33fb7f[_0x49ae0d(0xff)]();loggerService_1[_0x49ae0d(0x122)]['logWhiteDomainResponse']('plisio_direct',_0x49ae0d(0xdc)+_0x51a68a,_0x33fb7f['status'],_0x354055,_0x410e9e);throw new Error(_0x49ae0d(0xf0)+_0x33fb7f[_0x49ae0d(0xe4)]);}const _0x47389c=await _0x33fb7f[_0x49ae0d(0xe3)]();loggerService_1[_0x49ae0d(0x122)]['logWhiteDomainResponse'](_0x49ae0d(0x107),_0x49ae0d(0xdc)+_0x51a68a,_0x33fb7f[_0x49ae0d(0xe4)],_0x47389c,_0x410e9e);if(_0x47389c[_0x49ae0d(0xe4)]!==_0x49ae0d(0xc6)){loggerService_1[_0x49ae0d(0x122)][_0x49ae0d(0xd4)](_0x49ae0d(0x107),'/operations/'+_0x51a68a,_0x49ae0d(0xda)+(_0x47389c['message']||_0x47389c[_0x49ae0d(0xe5)]||_0x49ae0d(0x11a)));throw new Error(_0x49ae0d(0xda)+(_0x47389c[_0x49ae0d(0x10a)]||_0x47389c[_0x49ae0d(0xe5)]||_0x49ae0d(0x11a)));}let _0x447c4=_0x49ae0d(0xbe);return{'status':_0x447c4};}catch(_0x5e1252){console[_0x49ae0d(0xe5)](_0x49ae0d(0x116),_0x5e1252),loggerService_1[_0x49ae0d(0x122)][_0x49ae0d(0xd4)](_0x49ae0d(0x107),_0x49ae0d(0xdc)+_0x51a68a,_0x5e1252);throw new Error(_0x49ae0d(0xe7)+(_0x5e1252 instanceof Error?_0x5e1252[_0x49ae0d(0x10a)]:_0x49ae0d(0x11a)));}}async[a55_0x59f106(0x11c)](_0x287999){const _0x244877=a55_0x59f106;console[_0x244877(0xc7)](_0x244877(0x111),_0x287999);let _0x1d7c35=_0x244877(0xbe);switch(_0x287999[_0x244877(0xe4)]?.[_0x244877(0xd2)]()){case _0x244877(0xd5):case _0x244877(0xb9):_0x1d7c35=_0x244877(0xd8);break;case'expired':_0x1d7c35=_0x244877(0xfd);break;case'error':case'cancelled':_0x1d7c35=_0x244877(0x127);break;case _0x244877(0xb7):_0x1d7c35=_0x244877(0xbe);break;case _0x244877(0xee):_0x1d7c35='PROCESSING';break;default:_0x1d7c35=_0x244877(0xbe);break;}let _0x39f156;if(_0x287999['tx_urls'])try{console['log'](_0x244877(0x10e),_0x287999[_0x244877(0x114)]);let _0x11e156;if(typeof _0x287999['tx_urls']===_0x244877(0xbc))_0x11e156=JSON[_0x244877(0xe1)](_0x287999[_0x244877(0x114)]);else Array[_0x244877(0xf5)](_0x287999['tx_urls'])?_0x11e156=_0x287999[_0x244877(0x114)]:_0x11e156=[];_0x39f156=_0x11e156['map'](_0x2b7498=>{const _0xba79e=_0x244877,_0x332e81=_0x2b7498[_0xba79e(0xdd)](/\\/g,'');return console[_0xba79e(0xc7)](_0xba79e(0xcf)+_0x2b7498+'\x20->\x20'+_0x332e81),_0x332e81;}),console[_0x244877(0xc7)](_0x244877(0x10f),_0x39f156),_0x39f156[_0x244877(0xf6)]((_0x112a95,_0x2c2df2)=>{const _0x1b1f70=_0x244877;try{new URL(_0x112a95),console[_0x1b1f70(0xc7)](_0x1b1f70(0xec)+(_0x2c2df2+0x1)+_0x1b1f70(0xd7)+_0x112a95);}catch(_0x2e1fc0){console[_0x1b1f70(0xe5)](_0x1b1f70(0xf4)+(_0x2c2df2+0x1)+_0x1b1f70(0xbb)+_0x112a95,_0x2e1fc0);}});}catch(_0x1273f6){console['error'](_0x244877(0xc1),_0x1273f6),console['error'](_0x244877(0xc8),_0x287999[_0x244877(0x114)]),_0x39f156=undefined;}return{'paymentId':_0x287999[_0x244877(0x120)]||'','status':_0x1d7c35,'amount':_0x287999[_0x244877(0xe0)],'currency':_0x287999[_0x244877(0xc3)],'txUrls':_0x39f156};}}exports['PlisioService']=PlisioService;