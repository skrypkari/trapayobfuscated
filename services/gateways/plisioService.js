'use strict';function a49_0x2f63(){const _0x5f5843=['HIDDEN','https://api.plisio.net/api/v1/operations/','520750OgEXuI','text','currency','HTTP\x20Status:','232PIrxvm','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','logWhiteDomainError','now','‚ùå\x20URL\x20',',\x20body:\x20','toLowerCase','113561VMCYit','PROCESSING','qr_url','expired','completed','PLISIO_API_KEY','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','email','Unknown\x20error','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','apiKey','4QgJpft','/invoices/new','‚úÖ\x20Processed\x20tx_urls:','(crypto\x20for\x20payment)','message','Full\x20URL\x20(without\x20API\x20key):','5UlvHaE','PlisioService','entries','replace','(fiat\x20for\x20merchant)','Error\x20stack:','pending','log','GET','mismatch','Error\x20details:','https://api.plisio.net/api/v1/invoices/new','logWhiteDomainRequest','stack','append','Plisio\x20API\x20error:\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','env','Target\x20Currency:','‚úÖ\x20URL\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','PAID','source_currency','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','164706XFqhLA','\x20is\x20invalid:\x20','2591922tDZXDO','Parameters:','application/json','PENDING','JSON\x20Parse\x20Error:\x20','Response\x20Body:','string','üîó\x20Formatted\x20URL:\x20','Status\x20Text:','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','loggerService','order_number','4501062HXblzD','fromEntries','FAILED','Source\x20Currency:','Error\x20message:','data','Raw\x20Response\x20Body:','logWhiteDomainResponse','forEach','EXPIRED','status','/operations/','isArray','source_amount','parse','cancelled','txn_id','Response\x20data:','warn','===\x20PLISIO\x20SUCCESS\x20===','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','===\x20PLISIO\x20API\x20ERROR\x20===','success','tx_urls','HTTP\x20error!\x20status:\x20','processWebhook','1531320zLVCNI','verifyPayment','Transaction\x20ID:','Raw\x20tx_urls\x20data:','statusText','Failed\x20to\x20create\x20Plisio\x20payment:\x20','invoice_url','../loggerService','Processing\x20Plisio\x20webhook:','Unknown\x20error\x20from\x20Plisio\x20API','Amount:','688134jsYDRL','error','Error\x20Message:','TesSoft\x20Payment\x20System/1.0','plisio_direct','map','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','toString','apiUrl','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','name','Business\x20Error:\x20'];a49_0x2f63=function(){return _0x5f5843;};return a49_0x2f63();}const a49_0x4d7ea2=a49_0x41db;(function(_0x435b90,_0x57dd60){const _0x2ab0f6=a49_0x41db,_0x550297=_0x435b90();while(!![]){try{const _0x3a188c=-parseInt(_0x2ab0f6(0x1ff))/0x1+parseInt(_0x2ab0f6(0x1e0))/0x2*(-parseInt(_0x2ab0f6(0x1bb))/0x3)+parseInt(_0x2ab0f6(0x1b0))/0x4+-parseInt(_0x2ab0f6(0x1e6))/0x5*(-parseInt(_0x2ab0f6(0x201))/0x6)+-parseInt(_0x2ab0f6(0x1d4))/0x7*(parseInt(_0x2ab0f6(0x1cd))/0x8)+parseInt(_0x2ab0f6(0x20d))/0x9+parseInt(_0x2ab0f6(0x1c9))/0xa;if(_0x3a188c===_0x57dd60)break;else _0x550297['push'](_0x550297['shift']());}catch(_0x336135){_0x550297['push'](_0x550297['shift']());}}}(a49_0x2f63,0x42ab9));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a49_0x4d7ea2(0x1e7)]=void 0x0;const loggerService_1=require(a49_0x4d7ea2(0x1b7));function a49_0x41db(_0x4c06d3,_0x52dcb1){const _0x2f6321=a49_0x2f63();return a49_0x41db=function(_0x41dbaf,_0x5e414b){_0x41dbaf=_0x41dbaf-0x19d;let _0x3f9da3=_0x2f6321[_0x41dbaf];return _0x3f9da3;},a49_0x41db(_0x4c06d3,_0x52dcb1);}class PlisioService{constructor(){const _0x3e2cc8=a49_0x4d7ea2;this[_0x3e2cc8(0x1c3)]=_0x3e2cc8(0x1f1),this['apiKey']=process[_0x3e2cc8(0x1f7)][_0x3e2cc8(0x1d9)]||'',!this[_0x3e2cc8(0x1df)]?console[_0x3e2cc8(0x1a8)](_0x3e2cc8(0x20a)):console[_0x3e2cc8(0x1ed)](_0x3e2cc8(0x1dd));}async['createPayment'](_0x662ac3){const _0x29757a=a49_0x4d7ea2,{orderId:_0x237855,amount:_0x801e51,currency:_0x535832,productName:_0x4c100a,description:_0x5b3ebf,successUrl:_0x49ad71,failUrl:_0x4a352e,customerEmail:_0x5f593d,customerName:_0x386345,isSourceCurrency:_0x486ac1,sourceCurrency:_0x3ddf69}=_0x662ac3;if(!this['apiKey'])throw new Error(_0x29757a(0x1f6));const _0xee8b81=new URLSearchParams({'api_key':this[_0x29757a(0x1df)],'order_number':_0x237855,'order_name':_0x4c100a,'description':_0x5b3ebf,'success_url':_0x49ad71,'fail_url':_0x4a352e,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x3ddf69?(_0xee8b81[_0x29757a(0x1f4)](_0x29757a(0x1cb),_0x3ddf69),_0xee8b81['append'](_0x29757a(0x1fc),_0x535832),_0xee8b81[_0x29757a(0x1f4)](_0x29757a(0x1a3),_0x801e51['toString']())):(_0xee8b81[_0x29757a(0x1f4)](_0x29757a(0x1cb),_0x535832),_0xee8b81[_0x29757a(0x1f4)]('amount',_0x801e51[_0x29757a(0x1c2)]()));_0x5f593d&&_0xee8b81[_0x29757a(0x1f4)](_0x29757a(0x1db),_0x5f593d);_0x386345&&_0xee8b81['append'](_0x29757a(0x1c5),_0x386345);const _0x3cdeda=this['apiUrl']+'?'+_0xee8b81[_0x29757a(0x1c2)](),_0x20615b=Date[_0x29757a(0x1d0)]();try{console[_0x29757a(0x1ed)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x29757a(0x1ed)]('URL:',this['apiUrl']),console[_0x29757a(0x1ed)](_0x29757a(0x202),Object['fromEntries'](_0xee8b81[_0x29757a(0x1e8)]())),console[_0x29757a(0x1ed)](_0x29757a(0x1e5),_0x3cdeda[_0x29757a(0x1e9)](this['apiKey'],_0x29757a(0x1c7))),loggerService_1[_0x29757a(0x20b)][_0x29757a(0x1f2)](_0x29757a(0x1bf),'/invoices/new',_0x29757a(0x1ee),Object[_0x29757a(0x20e)](_0xee8b81[_0x29757a(0x1e8)]()));const _0x158d8f=await fetch(_0x3cdeda,{'method':_0x29757a(0x1ee),'headers':{'Accept':_0x29757a(0x203),'User-Agent':_0x29757a(0x1be)}}),_0x48177b=Date[_0x29757a(0x1d0)]()-_0x20615b;console[_0x29757a(0x1ed)](_0x29757a(0x1ce)),console[_0x29757a(0x1ed)]('Status:',_0x158d8f[_0x29757a(0x1a0)]),console['log'](_0x29757a(0x209),_0x158d8f[_0x29757a(0x1b4)]),console[_0x29757a(0x1ed)]('Response\x20Time:',_0x48177b+'ms');const _0x20b5c6=await _0x158d8f[_0x29757a(0x1ca)]();console['log'](_0x29757a(0x213),_0x20b5c6);if(!_0x158d8f['ok']){console[_0x29757a(0x1bc)](_0x29757a(0x1ab)),console[_0x29757a(0x1bc)](_0x29757a(0x1cc),_0x158d8f[_0x29757a(0x1a0)]),console[_0x29757a(0x1bc)](_0x29757a(0x206),_0x20b5c6),loggerService_1['loggerService'][_0x29757a(0x19d)](_0x29757a(0x1bf),_0x29757a(0x1e1),_0x158d8f[_0x29757a(0x1a0)],_0x20b5c6,_0x48177b),loggerService_1['loggerService'][_0x29757a(0x1cf)](_0x29757a(0x1bf),'/invoices/new','HTTP\x20'+_0x158d8f[_0x29757a(0x1a0)]+':\x20'+_0x20b5c6);throw new Error('HTTP\x20error!\x20status:\x20'+_0x158d8f[_0x29757a(0x1a0)]+_0x29757a(0x1d2)+_0x20b5c6);}let _0x4ee17c;try{_0x4ee17c=JSON[_0x29757a(0x1a4)](_0x20b5c6);}catch(_0x287c8e){console[_0x29757a(0x1bc)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x287c8e),loggerService_1['loggerService'][_0x29757a(0x1cf)]('plisio_direct','/invoices/new',_0x29757a(0x205)+_0x287c8e);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x20b5c6);}console[_0x29757a(0x1ed)](_0x29757a(0x1da)),console[_0x29757a(0x1ed)]('Parsed\x20Result:',JSON['stringify'](_0x4ee17c,null,0x2)),loggerService_1[_0x29757a(0x20b)]['logWhiteDomainResponse'](_0x29757a(0x1bf),_0x29757a(0x1e1),_0x158d8f[_0x29757a(0x1a0)],_0x4ee17c,_0x48177b);if(_0x4ee17c[_0x29757a(0x1a0)]!==_0x29757a(0x1ac)){const _0x391b1b=_0x4ee17c[_0x29757a(0x1e4)]||_0x4ee17c['error']||_0x29757a(0x1b9);console[_0x29757a(0x1bc)](_0x29757a(0x1fd)),console[_0x29757a(0x1bc)](_0x29757a(0x1bd),_0x391b1b),loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct',_0x29757a(0x1e1),_0x29757a(0x1c6)+_0x391b1b);throw new Error(_0x29757a(0x1f5)+_0x391b1b);}if(!_0x4ee17c[_0x29757a(0x212)]?.[_0x29757a(0x1a6)]||!_0x4ee17c[_0x29757a(0x212)]?.[_0x29757a(0x1b6)]){console['error'](_0x29757a(0x1de)),console['error']('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x29757a(0x1bc)](_0x29757a(0x1a7),_0x4ee17c[_0x29757a(0x212)]),loggerService_1[_0x29757a(0x20b)]['logWhiteDomainError'](_0x29757a(0x1bf),_0x29757a(0x1e1),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x29757a(0x1aa));}return console[_0x29757a(0x1ed)](_0x29757a(0x1a9)),console[_0x29757a(0x1ed)](_0x29757a(0x1b2),_0x4ee17c[_0x29757a(0x212)][_0x29757a(0x1a6)]),console[_0x29757a(0x1ed)]('Invoice\x20URL:',_0x4ee17c[_0x29757a(0x212)][_0x29757a(0x1b6)]),console['log'](_0x29757a(0x1ba),_0x801e51,_0x535832),_0x3ddf69&&(console['log'](_0x29757a(0x210),_0x3ddf69,_0x29757a(0x1e3)),console[_0x29757a(0x1ed)](_0x29757a(0x1f8),_0x535832,_0x29757a(0x1ea))),{'gateway_payment_id':_0x4ee17c[_0x29757a(0x212)]['txn_id'],'payment_url':_0x4ee17c[_0x29757a(0x212)][_0x29757a(0x1b6)],'invoice_total_sum':_0x4ee17c[_0x29757a(0x212)]['invoice_total_sum'],'qr_code':_0x4ee17c[_0x29757a(0x212)]['qr_code'],'qr_url':_0x4ee17c[_0x29757a(0x212)][_0x29757a(0x1d6)]};}catch(_0x18f38a){console[_0x29757a(0x1bc)](_0x29757a(0x1fe)),console[_0x29757a(0x1bc)](_0x29757a(0x1f0),_0x18f38a),loggerService_1[_0x29757a(0x20b)][_0x29757a(0x1cf)]('plisio_direct',_0x29757a(0x1e1),_0x18f38a);if(_0x18f38a instanceof Error){console[_0x29757a(0x1bc)](_0x29757a(0x211),_0x18f38a['message']),console[_0x29757a(0x1bc)](_0x29757a(0x1eb),_0x18f38a[_0x29757a(0x1f3)]);throw new Error(_0x29757a(0x1b5)+_0x18f38a[_0x29757a(0x1e4)]);}throw new Error(_0x29757a(0x1fa));}}async[a49_0x4d7ea2(0x1b1)](_0x4d0c1a){const _0x436027=a49_0x4d7ea2,_0xd3f3fc=Date[_0x436027(0x1d0)]();try{if(!this['apiKey'])throw new Error(_0x436027(0x1f6));const _0xa07ae8=new URLSearchParams({'api_key':this[_0x436027(0x1df)],'txn_id':_0x4d0c1a}),_0x15a7a0=_0x436027(0x1c8)+_0x4d0c1a+'?'+_0xa07ae8[_0x436027(0x1c2)]();loggerService_1[_0x436027(0x20b)][_0x436027(0x1f2)]('plisio_direct',_0x436027(0x1a1)+_0x4d0c1a,_0x436027(0x1ee),Object[_0x436027(0x20e)](_0xa07ae8[_0x436027(0x1e8)]()));const _0x588d0b=await fetch(_0x15a7a0,{'method':_0x436027(0x1ee),'headers':{'Accept':_0x436027(0x203),'User-Agent':_0x436027(0x1be)}}),_0x1a5cbd=Date[_0x436027(0x1d0)]()-_0xd3f3fc;if(!_0x588d0b['ok']){const _0x4f0af2=await _0x588d0b[_0x436027(0x1ca)]();loggerService_1[_0x436027(0x20b)][_0x436027(0x19d)]('plisio_direct',_0x436027(0x1a1)+_0x4d0c1a,_0x588d0b['status'],_0x4f0af2,_0x1a5cbd);throw new Error(_0x436027(0x1ae)+_0x588d0b[_0x436027(0x1a0)]);}const _0x39530e=await _0x588d0b['json']();loggerService_1[_0x436027(0x20b)]['logWhiteDomainResponse'](_0x436027(0x1bf),'/operations/'+_0x4d0c1a,_0x588d0b[_0x436027(0x1a0)],_0x39530e,_0x1a5cbd);if(_0x39530e[_0x436027(0x1a0)]!==_0x436027(0x1ac)){loggerService_1['loggerService'][_0x436027(0x1cf)](_0x436027(0x1bf),_0x436027(0x1a1)+_0x4d0c1a,_0x436027(0x1f5)+(_0x39530e[_0x436027(0x1e4)]||_0x39530e[_0x436027(0x1bc)]||_0x436027(0x1dc)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x39530e['message']||_0x39530e[_0x436027(0x1bc)]||_0x436027(0x1dc)));}let _0x1fe77c='PENDING';return{'status':_0x1fe77c};}catch(_0x56f5a3){console[_0x436027(0x1bc)]('Plisio\x20payment\x20verification\x20error:',_0x56f5a3),loggerService_1[_0x436027(0x20b)][_0x436027(0x1cf)]('plisio_direct',_0x436027(0x1a1)+_0x4d0c1a,_0x56f5a3);throw new Error(_0x436027(0x1c4)+(_0x56f5a3 instanceof Error?_0x56f5a3[_0x436027(0x1e4)]:_0x436027(0x1dc)));}}async[a49_0x4d7ea2(0x1af)](_0x5d7a74){const _0x580963=a49_0x4d7ea2;console[_0x580963(0x1ed)](_0x580963(0x1b8),_0x5d7a74);let _0x6b2077=_0x580963(0x204);switch(_0x5d7a74['status']?.[_0x580963(0x1d3)]()){case _0x580963(0x1d8):case _0x580963(0x1ef):_0x6b2077=_0x580963(0x1fb);break;case _0x580963(0x1d7):_0x6b2077=_0x580963(0x19f);break;case _0x580963(0x1bc):case _0x580963(0x1a5):_0x6b2077=_0x580963(0x20f);break;case'new':_0x6b2077=_0x580963(0x204);break;case _0x580963(0x1ec):_0x6b2077=_0x580963(0x1d5);break;default:_0x6b2077='PENDING';break;}let _0x4a150f;if(_0x5d7a74[_0x580963(0x1ad)])try{console[_0x580963(0x1ed)]('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x5d7a74[_0x580963(0x1ad)]);let _0x4f2ffa;if(typeof _0x5d7a74['tx_urls']===_0x580963(0x207))_0x4f2ffa=JSON['parse'](_0x5d7a74[_0x580963(0x1ad)]);else Array[_0x580963(0x1a2)](_0x5d7a74[_0x580963(0x1ad)])?_0x4f2ffa=_0x5d7a74[_0x580963(0x1ad)]:_0x4f2ffa=[];_0x4a150f=_0x4f2ffa[_0x580963(0x1c0)](_0x1d04df=>{const _0x1fb206=_0x580963,_0x8323cc=_0x1d04df[_0x1fb206(0x1e9)](/\\/g,'');return console[_0x1fb206(0x1ed)](_0x1fb206(0x208)+_0x1d04df+'\x20->\x20'+_0x8323cc),_0x8323cc;}),console[_0x580963(0x1ed)](_0x580963(0x1e2),_0x4a150f),_0x4a150f[_0x580963(0x19e)]((_0x3bd241,_0xe8c9ab)=>{const _0x570ae5=_0x580963;try{new URL(_0x3bd241),console[_0x570ae5(0x1ed)](_0x570ae5(0x1f9)+(_0xe8c9ab+0x1)+'\x20is\x20valid:\x20'+_0x3bd241);}catch(_0x32cea3){console[_0x570ae5(0x1bc)](_0x570ae5(0x1d1)+(_0xe8c9ab+0x1)+_0x570ae5(0x200)+_0x3bd241,_0x32cea3);}});}catch(_0x269ac0){console[_0x580963(0x1bc)](_0x580963(0x1c1),_0x269ac0),console[_0x580963(0x1bc)](_0x580963(0x1b3),_0x5d7a74['tx_urls']),_0x4a150f=undefined;}return{'paymentId':_0x5d7a74[_0x580963(0x20c)]||'','status':_0x6b2077,'amount':_0x5d7a74['amount'],'currency':_0x5d7a74['currency'],'txUrls':_0x4a150f};}}exports[a49_0x4d7ea2(0x1e7)]=PlisioService;