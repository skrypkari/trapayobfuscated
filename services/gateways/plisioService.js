'use strict';const a45_0xca8a54=a45_0x1e43;(function(_0x390a8e,_0x5569d3){const _0x59f343=a45_0x1e43,_0xf9273f=_0x390a8e();while(!![]){try{const _0x204bec=-parseInt(_0x59f343(0x25c))/0x1+parseInt(_0x59f343(0x221))/0x2+-parseInt(_0x59f343(0x211))/0x3+parseInt(_0x59f343(0x220))/0x4+parseInt(_0x59f343(0x245))/0x5*(parseInt(_0x59f343(0x21f))/0x6)+-parseInt(_0x59f343(0x242))/0x7*(-parseInt(_0x59f343(0x222))/0x8)+-parseInt(_0x59f343(0x210))/0x9;if(_0x204bec===_0x5569d3)break;else _0xf9273f['push'](_0xf9273f['shift']());}catch(_0x5a3057){_0xf9273f['push'](_0xf9273f['shift']());}}}(a45_0x2bdf,0x7b2a2));function a45_0x1e43(_0x4357ad,_0x225c28){const _0x2bdf64=a45_0x2bdf();return a45_0x1e43=function(_0x1e4339,_0x5b9e42){_0x1e4339=_0x1e4339-0x1ee;let _0x49cc8e=_0x2bdf64[_0x1e4339];return _0x49cc8e;},a45_0x1e43(_0x4357ad,_0x225c28);}Object['defineProperty'](exports,a45_0xca8a54(0x21a),{'value':!![]}),exports[a45_0xca8a54(0x216)]=void 0x0;const loggerService_1=require(a45_0xca8a54(0x1fa));function a45_0x2bdf(){const _0x2d2ba2=['../loggerService','message','env','source_currency','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','createPayment','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','Error\x20message:','‚úÖ\x20Processed\x20tx_urls:','PROCESSING','TesSoft\x20Payment\x20System/1.0','log','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','currency','PENDING','/operations/','stringify','toString','parse','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','status','Unknown\x20error','5129757RfLgPe','879534tZgmyr','invoice_total_sum','success','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','logWhiteDomainResponse','PlisioService','GET','/invoices/new','logWhiteDomainRequest','__esModule','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Unknown\x20error\x20from\x20Plisio\x20API','replace','Response\x20data:','42qQxXuX','1164180QdqNyv','452706xbwEvB','248JHepMZ','FAILED','loggerService','invoice_url','Error\x20details:','Transaction\x20ID:','new','map','Response\x20Body:','Amount:','Business\x20Error:\x20','email','verifyPayment','Status\x20Text:','txn_id','===\x20PLISIO\x20SUCCESS\x20===','name','cancelled','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','‚ùå\x20URL\x20','(fiat\x20for\x20merchant)','qr_code','fromEntries','URL:','stack','Source\x20Currency:','entries','mismatch','append','https://api.trapay.uk/api/webhooks/gateway/plisio','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','tx_urls','129423aDgZoi','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Target\x20Currency:','616485LkTkVb','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Error\x20Message:','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','EXPIRED','apiUrl','source_amount','Parsed\x20Result:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','completed','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Parameters:','application/json','Plisio\x20API\x20error:\x20','https://api.plisio.net/api/v1/operations/','data','Failed\x20to\x20parse\x20JSON\x20response:','‚úÖ\x20URL\x20','plisio_direct','apiKey','Plisio\x20API\x20key\x20is\x20not\x20configured','now','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','586003ZtBSVt','json','\x20is\x20invalid:\x20','amount','===\x20PLISIO\x20API\x20ERROR\x20===','logWhiteDomainError','processWebhook','(crypto\x20for\x20payment)','pending','JSON\x20Parse\x20Error:\x20','Invoice\x20URL:','error','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','expired','Processing\x20Plisio\x20webhook:','HTTP\x20','üîó\x20Formatted\x20URL:\x20','HTTP\x20Status:'];a45_0x2bdf=function(){return _0x2d2ba2;};return a45_0x2bdf();}class PlisioService{constructor(){const _0x1c444f=a45_0xca8a54;this[_0x1c444f(0x24a)]='https://api.plisio.net/api/v1/invoices/new',this['apiKey']=process[_0x1c444f(0x1fc)]['PLISIO_API_KEY']||'',!this[_0x1c444f(0x258)]?console['warn'](_0x1c444f(0x206)):console['log'](_0x1c444f(0x24f));}async[a45_0xca8a54(0x1ff)](_0x309c63){const _0x163fd0=a45_0xca8a54,{orderId:_0x25cdea,amount:_0x4b0ad5,currency:_0x63a849,productName:_0x4bdd93,description:_0x42ae4d,successUrl:_0x55caf7,failUrl:_0x1d76d2,customerEmail:_0x14edec,customerName:_0xc26a5b,isSourceCurrency:_0x5625f5,sourceCurrency:_0x2a7e42}=_0x309c63;if(!this['apiKey'])throw new Error(_0x163fd0(0x259));const _0x3935b2=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x25cdea,'order_name':_0x4bdd93,'description':_0x42ae4d,'success_url':_0x55caf7,'fail_url':_0x1d76d2,'callback_url':_0x163fd0(0x23f)});_0x2a7e42?(_0x3935b2[_0x163fd0(0x23e)](_0x163fd0(0x207),_0x2a7e42),_0x3935b2[_0x163fd0(0x23e)](_0x163fd0(0x1fd),_0x63a849),_0x3935b2[_0x163fd0(0x23e)](_0x163fd0(0x24b),_0x4b0ad5[_0x163fd0(0x20b)]())):(_0x3935b2[_0x163fd0(0x23e)]('currency',_0x63a849),_0x3935b2[_0x163fd0(0x23e)](_0x163fd0(0x25f),_0x4b0ad5['toString']()));_0x14edec&&_0x3935b2[_0x163fd0(0x23e)](_0x163fd0(0x22d),_0x14edec);_0xc26a5b&&_0x3935b2[_0x163fd0(0x23e)](_0x163fd0(0x232),_0xc26a5b);const _0x3075d1=this['apiUrl']+'?'+_0x3935b2[_0x163fd0(0x20b)](),_0xab6f1f=Date[_0x163fd0(0x25a)]();try{console['log'](_0x163fd0(0x21b)),console[_0x163fd0(0x205)](_0x163fd0(0x239),this[_0x163fd0(0x24a)]),console[_0x163fd0(0x205)](_0x163fd0(0x250),Object[_0x163fd0(0x238)](_0x3935b2['entries']())),console[_0x163fd0(0x205)]('Full\x20URL\x20(without\x20API\x20key):',_0x3075d1[_0x163fd0(0x21d)](this[_0x163fd0(0x258)],'HIDDEN')),loggerService_1[_0x163fd0(0x224)][_0x163fd0(0x219)]('plisio_direct',_0x163fd0(0x218),_0x163fd0(0x217),Object['fromEntries'](_0x3935b2[_0x163fd0(0x23c)]()));const _0x1e0916=await fetch(_0x3075d1,{'method':_0x163fd0(0x217),'headers':{'Accept':_0x163fd0(0x251),'User-Agent':_0x163fd0(0x204)}}),_0x2e689a=Date[_0x163fd0(0x25a)]()-_0xab6f1f;console[_0x163fd0(0x205)](_0x163fd0(0x246)),console[_0x163fd0(0x205)]('Status:',_0x1e0916['status']),console['log'](_0x163fd0(0x22f),_0x1e0916['statusText']),console[_0x163fd0(0x205)]('Response\x20Time:',_0x2e689a+'ms');const _0x2e5038=await _0x1e0916['text']();console[_0x163fd0(0x205)]('Raw\x20Response\x20Body:',_0x2e5038);if(!_0x1e0916['ok']){console[_0x163fd0(0x1f3)](_0x163fd0(0x260)),console[_0x163fd0(0x1f3)](_0x163fd0(0x1f9),_0x1e0916['status']),console[_0x163fd0(0x1f3)](_0x163fd0(0x22a),_0x2e5038),loggerService_1['loggerService'][_0x163fd0(0x215)]('plisio_direct',_0x163fd0(0x218),_0x1e0916[_0x163fd0(0x20e)],_0x2e5038,_0x2e689a),loggerService_1[_0x163fd0(0x224)][_0x163fd0(0x261)](_0x163fd0(0x257),_0x163fd0(0x218),_0x163fd0(0x1f7)+_0x1e0916['status']+':\x20'+_0x2e5038);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1e0916['status']+',\x20body:\x20'+_0x2e5038);}let _0x4ac874;try{_0x4ac874=JSON[_0x163fd0(0x20c)](_0x2e5038);}catch(_0x358ac0){console['error'](_0x163fd0(0x255),_0x358ac0),loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct','/invoices/new',_0x163fd0(0x1f1)+_0x358ac0);throw new Error(_0x163fd0(0x243)+_0x2e5038);}console[_0x163fd0(0x205)](_0x163fd0(0x25b)),console[_0x163fd0(0x205)](_0x163fd0(0x24c),JSON[_0x163fd0(0x20a)](_0x4ac874,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x163fd0(0x257),_0x163fd0(0x218),_0x1e0916[_0x163fd0(0x20e)],_0x4ac874,_0x2e689a);if(_0x4ac874[_0x163fd0(0x20e)]!==_0x163fd0(0x213)){const _0x134c28=_0x4ac874[_0x163fd0(0x1fb)]||_0x4ac874[_0x163fd0(0x1f3)]||_0x163fd0(0x21c);console[_0x163fd0(0x1f3)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x163fd0(0x1f3)](_0x163fd0(0x247),_0x134c28),loggerService_1[_0x163fd0(0x224)][_0x163fd0(0x261)](_0x163fd0(0x257),'/invoices/new',_0x163fd0(0x22c)+_0x134c28);throw new Error(_0x163fd0(0x252)+_0x134c28);}if(!_0x4ac874[_0x163fd0(0x254)]?.[_0x163fd0(0x230)]||!_0x4ac874['data']?.['invoice_url']){console[_0x163fd0(0x1f3)](_0x163fd0(0x240)),console['error'](_0x163fd0(0x20d)),console[_0x163fd0(0x1f3)](_0x163fd0(0x21e),_0x4ac874[_0x163fd0(0x254)]),loggerService_1[_0x163fd0(0x224)][_0x163fd0(0x261)](_0x163fd0(0x257),_0x163fd0(0x218),_0x163fd0(0x24d));throw new Error(_0x163fd0(0x1fe));}return console['log'](_0x163fd0(0x231)),console['log'](_0x163fd0(0x227),_0x4ac874[_0x163fd0(0x254)][_0x163fd0(0x230)]),console['log'](_0x163fd0(0x1f2),_0x4ac874[_0x163fd0(0x254)][_0x163fd0(0x225)]),console[_0x163fd0(0x205)](_0x163fd0(0x22b),_0x4b0ad5,_0x63a849),_0x2a7e42&&(console[_0x163fd0(0x205)](_0x163fd0(0x23b),_0x2a7e42,_0x163fd0(0x1ef)),console[_0x163fd0(0x205)](_0x163fd0(0x244),_0x63a849,_0x163fd0(0x236))),{'gateway_payment_id':_0x4ac874[_0x163fd0(0x254)][_0x163fd0(0x230)],'payment_url':_0x4ac874[_0x163fd0(0x254)][_0x163fd0(0x225)],'invoice_total_sum':_0x4ac874[_0x163fd0(0x254)][_0x163fd0(0x212)],'qr_code':_0x4ac874[_0x163fd0(0x254)][_0x163fd0(0x237)],'qr_url':_0x4ac874['data']['qr_url']};}catch(_0x19bac0){console[_0x163fd0(0x1f3)](_0x163fd0(0x214)),console[_0x163fd0(0x1f3)](_0x163fd0(0x226),_0x19bac0),loggerService_1[_0x163fd0(0x224)][_0x163fd0(0x261)](_0x163fd0(0x257),_0x163fd0(0x218),_0x19bac0);if(_0x19bac0 instanceof Error){console[_0x163fd0(0x1f3)](_0x163fd0(0x201),_0x19bac0[_0x163fd0(0x1fb)]),console['error']('Error\x20stack:',_0x19bac0[_0x163fd0(0x23a)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x19bac0[_0x163fd0(0x1fb)]);}throw new Error(_0x163fd0(0x234));}}async[a45_0xca8a54(0x22e)](_0x2abf44){const _0x27e5b0=a45_0xca8a54,_0x3ca316=Date[_0x27e5b0(0x25a)]();try{if(!this[_0x27e5b0(0x258)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x1584f2=new URLSearchParams({'api_key':this[_0x27e5b0(0x258)],'txn_id':_0x2abf44}),_0x21ad10=_0x27e5b0(0x253)+_0x2abf44+'?'+_0x1584f2[_0x27e5b0(0x20b)]();loggerService_1[_0x27e5b0(0x224)]['logWhiteDomainRequest']('plisio_direct',_0x27e5b0(0x209)+_0x2abf44,_0x27e5b0(0x217),Object[_0x27e5b0(0x238)](_0x1584f2[_0x27e5b0(0x23c)]()));const _0xbf1090=await fetch(_0x21ad10,{'method':_0x27e5b0(0x217),'headers':{'Accept':_0x27e5b0(0x251),'User-Agent':_0x27e5b0(0x204)}}),_0xa80022=Date['now']()-_0x3ca316;if(!_0xbf1090['ok']){const _0x42fbca=await _0xbf1090['text']();loggerService_1['loggerService'][_0x27e5b0(0x215)](_0x27e5b0(0x257),_0x27e5b0(0x209)+_0x2abf44,_0xbf1090[_0x27e5b0(0x20e)],_0x42fbca,_0xa80022);throw new Error('HTTP\x20error!\x20status:\x20'+_0xbf1090[_0x27e5b0(0x20e)]);}const _0x1a1e27=await _0xbf1090[_0x27e5b0(0x25d)]();loggerService_1[_0x27e5b0(0x224)][_0x27e5b0(0x215)](_0x27e5b0(0x257),_0x27e5b0(0x209)+_0x2abf44,_0xbf1090[_0x27e5b0(0x20e)],_0x1a1e27,_0xa80022);if(_0x1a1e27[_0x27e5b0(0x20e)]!=='success'){loggerService_1['loggerService'][_0x27e5b0(0x261)](_0x27e5b0(0x257),_0x27e5b0(0x209)+_0x2abf44,_0x27e5b0(0x252)+(_0x1a1e27[_0x27e5b0(0x1fb)]||_0x1a1e27[_0x27e5b0(0x1f3)]||'Unknown\x20error'));throw new Error(_0x27e5b0(0x252)+(_0x1a1e27[_0x27e5b0(0x1fb)]||_0x1a1e27[_0x27e5b0(0x1f3)]||'Unknown\x20error'));}let _0x14ffcc=_0x27e5b0(0x208);return{'status':_0x14ffcc};}catch(_0x2b8719){console[_0x27e5b0(0x1f3)]('Plisio\x20payment\x20verification\x20error:',_0x2b8719),loggerService_1[_0x27e5b0(0x224)][_0x27e5b0(0x261)](_0x27e5b0(0x257),_0x27e5b0(0x209)+_0x2abf44,_0x2b8719);throw new Error(_0x27e5b0(0x248)+(_0x2b8719 instanceof Error?_0x2b8719[_0x27e5b0(0x1fb)]:_0x27e5b0(0x20f)));}}async[a45_0xca8a54(0x1ee)](_0x5bffe4){const _0xe941dd=a45_0xca8a54;console[_0xe941dd(0x205)](_0xe941dd(0x1f6),_0x5bffe4);let _0x3bd6fb=_0xe941dd(0x208);switch(_0x5bffe4[_0xe941dd(0x20e)]?.['toLowerCase']()){case _0xe941dd(0x24e):case _0xe941dd(0x23d):_0x3bd6fb='PAID';break;case _0xe941dd(0x1f5):_0x3bd6fb=_0xe941dd(0x249);break;case'error':case _0xe941dd(0x233):_0x3bd6fb=_0xe941dd(0x223);break;case _0xe941dd(0x228):_0x3bd6fb=_0xe941dd(0x208);break;case _0xe941dd(0x1f0):_0x3bd6fb=_0xe941dd(0x203);break;default:_0x3bd6fb=_0xe941dd(0x208);break;}let _0x443698;if(_0x5bffe4['tx_urls'])try{console[_0xe941dd(0x205)](_0xe941dd(0x1f4),_0x5bffe4[_0xe941dd(0x241)]);let _0x10fb72;if(typeof _0x5bffe4['tx_urls']==='string')_0x10fb72=JSON[_0xe941dd(0x20c)](_0x5bffe4[_0xe941dd(0x241)]);else Array['isArray'](_0x5bffe4[_0xe941dd(0x241)])?_0x10fb72=_0x5bffe4['tx_urls']:_0x10fb72=[];_0x443698=_0x10fb72[_0xe941dd(0x229)](_0x5332c7=>{const _0x14b1c1=_0xe941dd,_0x4ca8ef=_0x5332c7[_0x14b1c1(0x21d)](/\\/g,'');return console[_0x14b1c1(0x205)](_0x14b1c1(0x1f8)+_0x5332c7+'\x20->\x20'+_0x4ca8ef),_0x4ca8ef;}),console[_0xe941dd(0x205)](_0xe941dd(0x202),_0x443698),_0x443698['forEach']((_0x1cf605,_0x5d4ffc)=>{const _0x1e5b06=_0xe941dd;try{new URL(_0x1cf605),console['log'](_0x1e5b06(0x256)+(_0x5d4ffc+0x1)+'\x20is\x20valid:\x20'+_0x1cf605);}catch(_0x43e8c0){console[_0x1e5b06(0x1f3)](_0x1e5b06(0x235)+(_0x5d4ffc+0x1)+_0x1e5b06(0x25e)+_0x1cf605,_0x43e8c0);}});}catch(_0x4f0d4e){console[_0xe941dd(0x1f3)](_0xe941dd(0x200),_0x4f0d4e),console['error']('Raw\x20tx_urls\x20data:',_0x5bffe4[_0xe941dd(0x241)]),_0x443698=undefined;}return{'paymentId':_0x5bffe4['order_number']||'','status':_0x3bd6fb,'amount':_0x5bffe4[_0xe941dd(0x25f)],'currency':_0x5bffe4['currency'],'txUrls':_0x443698};}}exports[a45_0xca8a54(0x216)]=PlisioService;