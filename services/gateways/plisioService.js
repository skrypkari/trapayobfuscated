'use strict';function a52_0x5311(){const _0x50d3ac=['log','Response\x20Body:','‚úÖ\x20URL\x20','Error\x20Message:','829810bozCVa','stack','tx_urls','isArray','defineProperty','‚úÖ\x20Processed\x20tx_urls:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','EXPIRED','logWhiteDomainResponse','Unknown\x20error','3UmjeIg','cancelled','\x20is\x20invalid:\x20','Status:','qr_url','Plisio\x20API\x20error:\x20','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','status','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Status\x20Text:','logWhiteDomainError','19064spgvqM','URL:','Invoice\x20URL:','Raw\x20Response\x20Body:','JSON\x20Parse\x20Error:\x20','stringify','env','apiKey','message','apiUrl','276SjHTAH','now','11VMpEDU','(crypto\x20for\x20payment)','entries','invoice_total_sum','loggerService','amount','fromEntries','toString','forEach','processWebhook','Target\x20Currency:','txn_id','HIDDEN','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','GET','verifyPayment','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','new','2781276TORbvR','Business\x20Error:\x20','PROCESSING','text','email','Source\x20Currency:','qr_code','../loggerService','Parsed\x20Result:','__esModule','Payment\x20System/1.0','PENDING','application/json','\x20->\x20','success','72218vFaqmm','HTTP\x20Status:','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','/operations/','\x20is\x20valid:\x20','(fiat\x20for\x20merchant)','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','üîó\x20Formatted\x20URL:\x20','parse','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','13eLFjTr','292182PDtIaL','error','176sOdiLI','1542888dJsePI','PlisioService','Plisio\x20API\x20key\x20is\x20not\x20configured','source_amount','PAID','FAILED','order_number','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','append','name','Parameters:','/invoices/new','Amount:','plisio_direct','logWhiteDomainRequest','5qrWfjd','Raw\x20tx_urls\x20data:',',\x20body:\x20','json','statusText','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','mismatch','HTTP\x20error!\x20status:\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20','pending','data','Response\x20Time:','string','3990DrbuBy','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Transaction\x20ID:','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','currency','replace','Error\x20stack:','invoice_url'];a52_0x5311=function(){return _0x50d3ac;};return a52_0x5311();}const a52_0x3149af=a52_0x47c0;function a52_0x47c0(_0x1b6bb1,_0x4df631){const _0x53119d=a52_0x5311();return a52_0x47c0=function(_0x47c07a,_0x42c3f1){_0x47c07a=_0x47c07a-0x18d;let _0x553de4=_0x53119d[_0x47c07a];return _0x553de4;},a52_0x47c0(_0x1b6bb1,_0x4df631);}(function(_0x509ebc,_0x5a81b2){const _0x43cabc=a52_0x47c0,_0x4fbffe=_0x509ebc();while(!![]){try{const _0x382bd7=-parseInt(_0x43cabc(0x1c6))/0x1*(parseInt(_0x43cabc(0x1ff))/0x2)+parseInt(_0x43cabc(0x1db))/0x3*(parseInt(_0x43cabc(0x1d1))/0x4)+-parseInt(_0x43cabc(0x1a3))/0x5*(parseInt(_0x43cabc(0x191))/0x6)+parseInt(_0x43cabc(0x1b0))/0x7*(parseInt(_0x43cabc(0x193))/0x8)+-parseInt(_0x43cabc(0x194))/0x9+parseInt(_0x43cabc(0x1bc))/0xa*(-parseInt(_0x43cabc(0x1dd))/0xb)+-parseInt(_0x43cabc(0x1f0))/0xc*(-parseInt(_0x43cabc(0x190))/0xd);if(_0x382bd7===_0x5a81b2)break;else _0x4fbffe['push'](_0x4fbffe['shift']());}catch(_0x3914e3){_0x4fbffe['push'](_0x4fbffe['shift']());}}}(a52_0x5311,0x423f4));Object[a52_0x3149af(0x1c0)](exports,a52_0x3149af(0x1f9),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a52_0x3149af(0x1f7));class PlisioService{constructor(){const _0x3c6a84=a52_0x3149af;this['apiUrl']='https://api.plisio.net/api/v1/invoices/new',this['apiKey']=process[_0x3c6a84(0x1d7)]['PLISIO_API_KEY']||'',!this[_0x3c6a84(0x1d8)]?console['warn'](_0x3c6a84(0x1b3)):console[_0x3c6a84(0x1b8)](_0x3c6a84(0x1a8));}async['createPayment'](_0x458f85){const _0x52b73b=a52_0x3149af,{orderId:_0x48dce2,amount:_0xb18205,currency:_0xb6c310,productName:_0x2fd120,description:_0x2834bc,successUrl:_0x2ab31f,failUrl:_0x15f0a2,customerEmail:_0x47414a,customerName:_0x4a3176,isSourceCurrency:_0x45cf76,sourceCurrency:_0x57c438}=_0x458f85;if(!this['apiKey'])throw new Error(_0x52b73b(0x196));const _0x27d68f=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x48dce2,'order_name':_0x2fd120,'description':_0x2834bc,'success_url':_0x2ab31f,'fail_url':_0x15f0a2,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x57c438?(_0x27d68f['append'](_0x52b73b(0x1b4),_0x57c438),_0x27d68f['append']('source_currency',_0xb6c310),_0x27d68f['append'](_0x52b73b(0x197),_0xb18205[_0x52b73b(0x1e4)]())):(_0x27d68f['append']('currency',_0xb6c310),_0x27d68f[_0x52b73b(0x19c)](_0x52b73b(0x1e2),_0xb18205[_0x52b73b(0x1e4)]()));_0x47414a&&_0x27d68f[_0x52b73b(0x19c)](_0x52b73b(0x1f4),_0x47414a);_0x4a3176&&_0x27d68f[_0x52b73b(0x19c)](_0x52b73b(0x19d),_0x4a3176);const _0x35a6f3=this['apiUrl']+'?'+_0x27d68f[_0x52b73b(0x1e4)](),_0xeec47a=Date[_0x52b73b(0x1dc)]();try{console[_0x52b73b(0x1b8)](_0x52b73b(0x1eb)),console[_0x52b73b(0x1b8)](_0x52b73b(0x1d2),this[_0x52b73b(0x1da)]),console[_0x52b73b(0x1b8)](_0x52b73b(0x19e),Object[_0x52b73b(0x1e3)](_0x27d68f[_0x52b73b(0x1df)]())),console['log']('Full\x20URL\x20(without\x20API\x20key):',_0x35a6f3[_0x52b73b(0x1b5)](this[_0x52b73b(0x1d8)],_0x52b73b(0x1e9))),loggerService_1[_0x52b73b(0x1e1)]['logWhiteDomainRequest'](_0x52b73b(0x1a1),_0x52b73b(0x19f),_0x52b73b(0x1ec),Object[_0x52b73b(0x1e3)](_0x27d68f[_0x52b73b(0x1df)]()));const _0x593941=await fetch(_0x35a6f3,{'method':_0x52b73b(0x1ec),'headers':{'Accept':_0x52b73b(0x1fc),'User-Agent':_0x52b73b(0x1fa)}}),_0xeb41b5=Date['now']()-_0xeec47a;console[_0x52b73b(0x1b8)](_0x52b73b(0x1ee)),console[_0x52b73b(0x1b8)](_0x52b73b(0x1c9),_0x593941[_0x52b73b(0x1cd)]),console[_0x52b73b(0x1b8)](_0x52b73b(0x1cf),_0x593941[_0x52b73b(0x1a7)]),console[_0x52b73b(0x1b8)](_0x52b73b(0x1ae),_0xeb41b5+'ms');const _0x45f19a=await _0x593941['text']();console['log'](_0x52b73b(0x1d4),_0x45f19a);if(!_0x593941['ok']){console['error']('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error'](_0x52b73b(0x200),_0x593941[_0x52b73b(0x1cd)]),console['error'](_0x52b73b(0x1b9),_0x45f19a),loggerService_1[_0x52b73b(0x1e1)]['logWhiteDomainResponse'](_0x52b73b(0x1a1),'/invoices/new',_0x593941[_0x52b73b(0x1cd)],_0x45f19a,_0xeb41b5),loggerService_1[_0x52b73b(0x1e1)]['logWhiteDomainError']('plisio_direct',_0x52b73b(0x19f),'HTTP\x20'+_0x593941['status']+':\x20'+_0x45f19a);throw new Error(_0x52b73b(0x1aa)+_0x593941[_0x52b73b(0x1cd)]+_0x52b73b(0x1a5)+_0x45f19a);}let _0x1fa05d;try{_0x1fa05d=JSON['parse'](_0x45f19a);}catch(_0x1a21f0){console[_0x52b73b(0x192)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x1a21f0),loggerService_1[_0x52b73b(0x1e1)][_0x52b73b(0x1d0)]('plisio_direct',_0x52b73b(0x19f),_0x52b73b(0x1d5)+_0x1a21f0);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x45f19a);}console[_0x52b73b(0x1b8)](_0x52b73b(0x201)),console[_0x52b73b(0x1b8)](_0x52b73b(0x1f8),JSON[_0x52b73b(0x1d6)](_0x1fa05d,null,0x2)),loggerService_1[_0x52b73b(0x1e1)]['logWhiteDomainResponse'](_0x52b73b(0x1a1),_0x52b73b(0x19f),_0x593941[_0x52b73b(0x1cd)],_0x1fa05d,_0xeb41b5);if(_0x1fa05d[_0x52b73b(0x1cd)]!==_0x52b73b(0x1fe)){const _0x10c756=_0x1fa05d['message']||_0x1fa05d['error']||'Unknown\x20error\x20from\x20Plisio\x20API';console['error'](_0x52b73b(0x205)),console[_0x52b73b(0x192)](_0x52b73b(0x1bb),_0x10c756),loggerService_1[_0x52b73b(0x1e1)][_0x52b73b(0x1d0)]('plisio_direct','/invoices/new',_0x52b73b(0x1f1)+_0x10c756);throw new Error('Plisio\x20API\x20error:\x20'+_0x10c756);}if(!_0x1fa05d['data']?.[_0x52b73b(0x1e8)]||!_0x1fa05d[_0x52b73b(0x1ad)]?.[_0x52b73b(0x1b7)]){console['error'](_0x52b73b(0x18f)),console[_0x52b73b(0x192)](_0x52b73b(0x1c2)),console[_0x52b73b(0x192)]('Response\x20data:',_0x1fa05d['data']),loggerService_1[_0x52b73b(0x1e1)][_0x52b73b(0x1d0)]('plisio_direct',_0x52b73b(0x19f),_0x52b73b(0x19b));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x52b73b(0x1b8)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x52b73b(0x1b8)](_0x52b73b(0x1b2),_0x1fa05d[_0x52b73b(0x1ad)][_0x52b73b(0x1e8)]),console[_0x52b73b(0x1b8)](_0x52b73b(0x1d3),_0x1fa05d[_0x52b73b(0x1ad)][_0x52b73b(0x1b7)]),console['log'](_0x52b73b(0x1a0),_0xb18205,_0xb6c310),_0x57c438&&(console[_0x52b73b(0x1b8)](_0x52b73b(0x1f5),_0x57c438,_0x52b73b(0x1de)),console[_0x52b73b(0x1b8)](_0x52b73b(0x1e7),_0xb6c310,_0x52b73b(0x204))),{'gateway_payment_id':_0x1fa05d[_0x52b73b(0x1ad)][_0x52b73b(0x1e8)],'payment_url':_0x1fa05d[_0x52b73b(0x1ad)][_0x52b73b(0x1b7)],'invoice_total_sum':_0x1fa05d[_0x52b73b(0x1ad)][_0x52b73b(0x1e0)],'qr_code':_0x1fa05d['data'][_0x52b73b(0x1f6)],'qr_url':_0x1fa05d[_0x52b73b(0x1ad)][_0x52b73b(0x1ca)]};}catch(_0x1eedbd){console[_0x52b73b(0x192)](_0x52b73b(0x1ea)),console['error']('Error\x20details:',_0x1eedbd),loggerService_1[_0x52b73b(0x1e1)][_0x52b73b(0x1d0)](_0x52b73b(0x1a1),_0x52b73b(0x19f),_0x1eedbd);if(_0x1eedbd instanceof Error){console['error']('Error\x20message:',_0x1eedbd['message']),console['error'](_0x52b73b(0x1b6),_0x1eedbd[_0x52b73b(0x1bd)]);throw new Error(_0x52b73b(0x1ab)+_0x1eedbd[_0x52b73b(0x1d9)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a52_0x3149af(0x1ed)](_0x59b553){const _0x42fdf6=a52_0x3149af,_0x3b9481=Date[_0x42fdf6(0x1dc)]();try{if(!this[_0x42fdf6(0x1d8)])throw new Error(_0x42fdf6(0x196));const _0x2e9a94=new URLSearchParams({'api_key':this[_0x42fdf6(0x1d8)],'txn_id':_0x59b553}),_0x2cb950='https://api.plisio.net/api/v1/operations/'+_0x59b553+'?'+_0x2e9a94[_0x42fdf6(0x1e4)]();loggerService_1[_0x42fdf6(0x1e1)][_0x42fdf6(0x1a2)](_0x42fdf6(0x1a1),_0x42fdf6(0x202)+_0x59b553,'GET',Object[_0x42fdf6(0x1e3)](_0x2e9a94[_0x42fdf6(0x1df)]()));const _0x4692aa=await fetch(_0x2cb950,{'method':_0x42fdf6(0x1ec),'headers':{'Accept':_0x42fdf6(0x1fc),'User-Agent':_0x42fdf6(0x1fa)}}),_0x83cbc0=Date['now']()-_0x3b9481;if(!_0x4692aa['ok']){const _0x811f14=await _0x4692aa[_0x42fdf6(0x1f3)]();loggerService_1[_0x42fdf6(0x1e1)][_0x42fdf6(0x1c4)](_0x42fdf6(0x1a1),_0x42fdf6(0x202)+_0x59b553,_0x4692aa[_0x42fdf6(0x1cd)],_0x811f14,_0x83cbc0);throw new Error(_0x42fdf6(0x1aa)+_0x4692aa['status']);}const _0x3d9627=await _0x4692aa[_0x42fdf6(0x1a6)]();loggerService_1[_0x42fdf6(0x1e1)]['logWhiteDomainResponse'](_0x42fdf6(0x1a1),_0x42fdf6(0x202)+_0x59b553,_0x4692aa['status'],_0x3d9627,_0x83cbc0);if(_0x3d9627['status']!==_0x42fdf6(0x1fe)){loggerService_1[_0x42fdf6(0x1e1)][_0x42fdf6(0x1d0)](_0x42fdf6(0x1a1),_0x42fdf6(0x202)+_0x59b553,_0x42fdf6(0x1cb)+(_0x3d9627['message']||_0x3d9627[_0x42fdf6(0x192)]||_0x42fdf6(0x1c5)));throw new Error(_0x42fdf6(0x1cb)+(_0x3d9627[_0x42fdf6(0x1d9)]||_0x3d9627[_0x42fdf6(0x192)]||_0x42fdf6(0x1c5)));}let _0x59ae2a=_0x42fdf6(0x1fb);return{'status':_0x59ae2a};}catch(_0x3d9194){console['error']('Plisio\x20payment\x20verification\x20error:',_0x3d9194),loggerService_1[_0x42fdf6(0x1e1)][_0x42fdf6(0x1d0)]('plisio_direct',_0x42fdf6(0x202)+_0x59b553,_0x3d9194);throw new Error(_0x42fdf6(0x1b1)+(_0x3d9194 instanceof Error?_0x3d9194[_0x42fdf6(0x1d9)]:'Unknown\x20error'));}}async[a52_0x3149af(0x1e6)](_0x469a56){const _0x5b464e=a52_0x3149af;console[_0x5b464e(0x1b8)]('Processing\x20Plisio\x20webhook:',_0x469a56);let _0x833c34=_0x5b464e(0x1fb);switch(_0x469a56[_0x5b464e(0x1cd)]?.['toLowerCase']()){case'completed':case _0x5b464e(0x1a9):_0x833c34=_0x5b464e(0x198);break;case'expired':_0x833c34=_0x5b464e(0x1c3);break;case'error':case _0x5b464e(0x1c7):_0x833c34=_0x5b464e(0x199);break;case _0x5b464e(0x1ef):_0x833c34=_0x5b464e(0x1fb);break;case _0x5b464e(0x1ac):_0x833c34=_0x5b464e(0x1f2);break;default:_0x833c34='PENDING';break;}let _0x11e084;if(_0x469a56['tx_urls'])try{console['log'](_0x5b464e(0x1ce),_0x469a56['tx_urls']);let _0x4ef200;if(typeof _0x469a56['tx_urls']===_0x5b464e(0x1af))_0x4ef200=JSON[_0x5b464e(0x18e)](_0x469a56[_0x5b464e(0x1be)]);else Array[_0x5b464e(0x1bf)](_0x469a56[_0x5b464e(0x1be)])?_0x4ef200=_0x469a56[_0x5b464e(0x1be)]:_0x4ef200=[];_0x11e084=_0x4ef200['map'](_0x179283=>{const _0x2cfca6=_0x5b464e,_0x18cf4a=_0x179283['replace'](/\\/g,'');return console['log'](_0x2cfca6(0x18d)+_0x179283+_0x2cfca6(0x1fd)+_0x18cf4a),_0x18cf4a;}),console['log'](_0x5b464e(0x1c1),_0x11e084),_0x11e084[_0x5b464e(0x1e5)]((_0x489338,_0x4ed816)=>{const _0x5c093d=_0x5b464e;try{new URL(_0x489338),console['log'](_0x5c093d(0x1ba)+(_0x4ed816+0x1)+_0x5c093d(0x203)+_0x489338);}catch(_0x339f00){console[_0x5c093d(0x192)]('‚ùå\x20URL\x20'+(_0x4ed816+0x1)+_0x5c093d(0x1c8)+_0x489338,_0x339f00);}});}catch(_0x2e71e5){console[_0x5b464e(0x192)](_0x5b464e(0x1cc),_0x2e71e5),console[_0x5b464e(0x192)](_0x5b464e(0x1a4),_0x469a56['tx_urls']),_0x11e084=undefined;}return{'paymentId':_0x469a56[_0x5b464e(0x19a)]||'','status':_0x833c34,'amount':_0x469a56[_0x5b464e(0x1e2)],'currency':_0x469a56[_0x5b464e(0x1b4)],'txUrls':_0x11e084};}}exports[a52_0x3149af(0x195)]=PlisioService;