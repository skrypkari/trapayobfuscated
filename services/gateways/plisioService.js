'use strict';const a44_0x268960=a44_0x31ab;(function(_0x45a67e,_0x4bdced){const _0x1e7c0b=a44_0x31ab,_0x2cdfb5=_0x45a67e();while(!![]){try{const _0x2a9568=-parseInt(_0x1e7c0b(0xf5))/0x1*(parseInt(_0x1e7c0b(0x91))/0x2)+parseInt(_0x1e7c0b(0xee))/0x3*(-parseInt(_0x1e7c0b(0xcd))/0x4)+-parseInt(_0x1e7c0b(0xcf))/0x5*(parseInt(_0x1e7c0b(0xde))/0x6)+parseInt(_0x1e7c0b(0xba))/0x7*(parseInt(_0x1e7c0b(0xc0))/0x8)+-parseInt(_0x1e7c0b(0x7d))/0x9+parseInt(_0x1e7c0b(0x92))/0xa*(parseInt(_0x1e7c0b(0xdb))/0xb)+-parseInt(_0x1e7c0b(0x99))/0xc*(-parseInt(_0x1e7c0b(0xda))/0xd);if(_0x2a9568===_0x4bdced)break;else _0x2cdfb5['push'](_0x2cdfb5['shift']());}catch(_0x17d573){_0x2cdfb5['push'](_0x2cdfb5['shift']());}}}(a44_0x79e9,0x468ca));function a44_0x31ab(_0x5511f9,_0x54de48){const _0x79e99f=a44_0x79e9();return a44_0x31ab=function(_0x31ab37,_0x3453ca){_0x31ab37=_0x31ab37-0x79;let _0x379221=_0x79e99f[_0x31ab37];return _0x379221;},a44_0x31ab(_0x5511f9,_0x54de48);}function a44_0x79e9(){const _0x403ab4=['===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','cancelled','defineProperty','new','11324748ZraPRw','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','text','Error\x20message:','source_currency','PENDING','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','logWhiteDomainError','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','qr_code','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',',\x20body:\x20','processWebhook','Raw\x20Response\x20Body:','currency','toLowerCase','email','plisio_direct','toString','TesSoft\x20Payment\x20System/1.0','PlisioService','Failed\x20to\x20create\x20Plisio\x20payment:\x20','stringify','mismatch','Failed\x20to\x20parse\x20JSON\x20response:','FAILED','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','string','__esModule','HTTP\x20Status:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Status\x20Text:','statusText','224WLQzZy','expired','Target\x20Currency:','https://api.plisio.net/api/v1/invoices/new','message','EXPIRED','103264IOIWHR','apiUrl','append','HIDDEN','Response\x20data:','../loggerService','qr_url','data','invoice_url','entries','‚úÖ\x20Processed\x20tx_urls:','stack','logWhiteDomainResponse','2088652DthNYX','Full\x20URL\x20(without\x20API\x20key):','5hwjgwF','GET','Parsed\x20Result:','replace','Source\x20Currency:','forEach','source_amount','createPayment','PROCESSING','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','success','13LdynbX','67133KIjWwk','status','/invoices/new','3061536qxrGNf','‚úÖ\x20URL\x20','\x20->\x20','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','log','Plisio\x20API\x20error:\x20','warn','Response\x20Time:','map','Processing\x20Plisio\x20webhook:','‚ùå\x20URL\x20','name','\x20is\x20valid:\x20','invoice_total_sum','fromEntries','/operations/','3yJjWPN','Unknown\x20error\x20from\x20Plisio\x20API','application/json','now','Status:','verifyPayment','Response\x20Body:','2EgXqah','completed','URL:','logWhiteDomainRequest','order_number','1503657MrqRYO','Error\x20details:','loggerService','Transaction\x20ID:','amount','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','tx_urls','txn_id','pending','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','apiKey','HTTP\x20','Error\x20Message:','\x20is\x20invalid:\x20','Business\x20Error:\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','HTTP\x20error!\x20status:\x20','error','191782lBKYUS','530BJWvTS','parse','https://api.trapay.uk/api/webhooks/gateway/plisio'];a44_0x79e9=function(){return _0x403ab4;};return a44_0x79e9();}Object[a44_0x268960(0x97)](exports,a44_0x268960(0xb5),{'value':!![]}),exports[a44_0x268960(0xad)]=void 0x0;const loggerService_1=require(a44_0x268960(0xc5));class PlisioService{constructor(){const _0x2b0985=a44_0x268960;this[_0x2b0985(0xc1)]=_0x2b0985(0xbd),this['apiKey']=process['env']['PLISIO_API_KEY']||'',!this[_0x2b0985(0x89)]?console[_0x2b0985(0xe4)](_0x2b0985(0x86)):console[_0x2b0985(0xe2)](_0x2b0985(0x9a));}async[a44_0x268960(0xd6)](_0x15d47e){const _0x32e4c2=a44_0x268960,{orderId:_0x2449b7,amount:_0x3210c0,currency:_0x3c605b,productName:_0x191ee3,description:_0x1987d6,successUrl:_0xae80f2,failUrl:_0x4cad5e,customerEmail:_0x31be43,customerName:_0x9d18ab,isSourceCurrency:_0x52dd6e,sourceCurrency:_0x4dc815}=_0x15d47e;if(!this[_0x32e4c2(0x89)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x1c57ff=new URLSearchParams({'api_key':this[_0x32e4c2(0x89)],'order_number':_0x2449b7,'order_name':_0x191ee3,'description':_0x1987d6,'success_url':_0xae80f2,'fail_url':_0x4cad5e,'callback_url':_0x32e4c2(0x94)});_0x4dc815?(_0x1c57ff[_0x32e4c2(0xc2)]('currency',_0x4dc815),_0x1c57ff[_0x32e4c2(0xc2)](_0x32e4c2(0x9d),_0x3c605b),_0x1c57ff[_0x32e4c2(0xc2)](_0x32e4c2(0xd5),_0x3210c0[_0x32e4c2(0xab)]())):(_0x1c57ff[_0x32e4c2(0xc2)]('currency',_0x3c605b),_0x1c57ff[_0x32e4c2(0xc2)](_0x32e4c2(0x81),_0x3210c0[_0x32e4c2(0xab)]()));_0x31be43&&_0x1c57ff[_0x32e4c2(0xc2)](_0x32e4c2(0xa9),_0x31be43);_0x9d18ab&&_0x1c57ff[_0x32e4c2(0xc2)](_0x32e4c2(0xe9),_0x9d18ab);const _0x538546=this[_0x32e4c2(0xc1)]+'?'+_0x1c57ff[_0x32e4c2(0xab)](),_0x1b20c0=Date['now']();try{console[_0x32e4c2(0xe2)](_0x32e4c2(0xb7)),console[_0x32e4c2(0xe2)](_0x32e4c2(0x7a),this['apiUrl']),console[_0x32e4c2(0xe2)]('Parameters:',Object[_0x32e4c2(0xec)](_0x1c57ff[_0x32e4c2(0xc9)]())),console[_0x32e4c2(0xe2)](_0x32e4c2(0xce),_0x538546[_0x32e4c2(0xd2)](this['apiKey'],_0x32e4c2(0xc3))),loggerService_1['loggerService'][_0x32e4c2(0x7b)]('plisio_direct',_0x32e4c2(0xdd),_0x32e4c2(0xd0),Object[_0x32e4c2(0xec)](_0x1c57ff[_0x32e4c2(0xc9)]()));const _0x52fbe7=await fetch(_0x538546,{'method':'GET','headers':{'Accept':'application/json','User-Agent':_0x32e4c2(0xac)}}),_0x2ea636=Date[_0x32e4c2(0xf1)]()-_0x1b20c0;console['log']('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x32e4c2(0xe2)](_0x32e4c2(0xf2),_0x52fbe7[_0x32e4c2(0xdc)]),console[_0x32e4c2(0xe2)](_0x32e4c2(0xb8),_0x52fbe7[_0x32e4c2(0xb9)]),console[_0x32e4c2(0xe2)](_0x32e4c2(0xe5),_0x2ea636+'ms');const _0x21e6d0=await _0x52fbe7[_0x32e4c2(0x9b)]();console[_0x32e4c2(0xe2)](_0x32e4c2(0xa6),_0x21e6d0);if(!_0x52fbe7['ok']){console[_0x32e4c2(0x90)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x32e4c2(0x90)](_0x32e4c2(0xb6),_0x52fbe7[_0x32e4c2(0xdc)]),console[_0x32e4c2(0x90)](_0x32e4c2(0xf4),_0x21e6d0),loggerService_1['loggerService'][_0x32e4c2(0xcc)](_0x32e4c2(0xaa),_0x32e4c2(0xdd),_0x52fbe7[_0x32e4c2(0xdc)],_0x21e6d0,_0x2ea636),loggerService_1['loggerService']['logWhiteDomainError'](_0x32e4c2(0xaa),_0x32e4c2(0xdd),_0x32e4c2(0x8a)+_0x52fbe7['status']+':\x20'+_0x21e6d0);throw new Error(_0x32e4c2(0x8f)+_0x52fbe7['status']+_0x32e4c2(0xa4)+_0x21e6d0);}let _0x3699d8;try{_0x3699d8=JSON[_0x32e4c2(0x93)](_0x21e6d0);}catch(_0x38508a){console[_0x32e4c2(0x90)](_0x32e4c2(0xb1),_0x38508a),loggerService_1[_0x32e4c2(0x7f)][_0x32e4c2(0xa0)](_0x32e4c2(0xaa),_0x32e4c2(0xdd),'JSON\x20Parse\x20Error:\x20'+_0x38508a);throw new Error(_0x32e4c2(0x88)+_0x21e6d0);}console['log'](_0x32e4c2(0xb3)),console[_0x32e4c2(0xe2)](_0x32e4c2(0xd1),JSON[_0x32e4c2(0xaf)](_0x3699d8,null,0x2)),loggerService_1['loggerService'][_0x32e4c2(0xcc)](_0x32e4c2(0xaa),_0x32e4c2(0xdd),_0x52fbe7[_0x32e4c2(0xdc)],_0x3699d8,_0x2ea636);if(_0x3699d8['status']!==_0x32e4c2(0xd9)){const _0x431b3c=_0x3699d8[_0x32e4c2(0xbe)]||_0x3699d8['error']||_0x32e4c2(0xef);console[_0x32e4c2(0x90)](_0x32e4c2(0x82)),console[_0x32e4c2(0x90)](_0x32e4c2(0x8b),_0x431b3c),loggerService_1[_0x32e4c2(0x7f)][_0x32e4c2(0xa0)](_0x32e4c2(0xaa),'/invoices/new',_0x32e4c2(0x8d)+_0x431b3c);throw new Error(_0x32e4c2(0xe3)+_0x431b3c);}if(!_0x3699d8[_0x32e4c2(0xc7)]?.['txn_id']||!_0x3699d8[_0x32e4c2(0xc7)]?.[_0x32e4c2(0xc8)]){console[_0x32e4c2(0x90)](_0x32e4c2(0x95)),console[_0x32e4c2(0x90)](_0x32e4c2(0x87)),console[_0x32e4c2(0x90)](_0x32e4c2(0xc4),_0x3699d8[_0x32e4c2(0xc7)]),loggerService_1['loggerService'][_0x32e4c2(0xa0)](_0x32e4c2(0xaa),_0x32e4c2(0xdd),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x32e4c2(0x9f));}return console[_0x32e4c2(0xe2)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x32e4c2(0xe2)](_0x32e4c2(0x80),_0x3699d8[_0x32e4c2(0xc7)][_0x32e4c2(0x84)]),console[_0x32e4c2(0xe2)]('Invoice\x20URL:',_0x3699d8[_0x32e4c2(0xc7)][_0x32e4c2(0xc8)]),console[_0x32e4c2(0xe2)]('Amount:',_0x3210c0,_0x3c605b),_0x4dc815&&(console['log'](_0x32e4c2(0xd3),_0x4dc815,'(crypto\x20for\x20payment)'),console[_0x32e4c2(0xe2)](_0x32e4c2(0xbc),_0x3c605b,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x3699d8[_0x32e4c2(0xc7)][_0x32e4c2(0x84)],'payment_url':_0x3699d8[_0x32e4c2(0xc7)][_0x32e4c2(0xc8)],'invoice_total_sum':_0x3699d8[_0x32e4c2(0xc7)][_0x32e4c2(0xeb)],'qr_code':_0x3699d8[_0x32e4c2(0xc7)][_0x32e4c2(0xa2)],'qr_url':_0x3699d8['data'][_0x32e4c2(0xc6)]};}catch(_0x481bcf){console['error'](_0x32e4c2(0xd8)),console[_0x32e4c2(0x90)](_0x32e4c2(0x7e),_0x481bcf),loggerService_1[_0x32e4c2(0x7f)][_0x32e4c2(0xa0)]('plisio_direct',_0x32e4c2(0xdd),_0x481bcf);if(_0x481bcf instanceof Error){console[_0x32e4c2(0x90)](_0x32e4c2(0x9c),_0x481bcf[_0x32e4c2(0xbe)]),console[_0x32e4c2(0x90)]('Error\x20stack:',_0x481bcf[_0x32e4c2(0xcb)]);throw new Error(_0x32e4c2(0xae)+_0x481bcf[_0x32e4c2(0xbe)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a44_0x268960(0xf3)](_0x14183e){const _0x234324=a44_0x268960,_0x79d6ba=Date[_0x234324(0xf1)]();try{if(!this[_0x234324(0x89)])throw new Error(_0x234324(0x8e));const _0x115773=new URLSearchParams({'api_key':this[_0x234324(0x89)],'txn_id':_0x14183e}),_0x5a21d0='https://api.plisio.net/api/v1/operations/'+_0x14183e+'?'+_0x115773['toString']();loggerService_1[_0x234324(0x7f)][_0x234324(0x7b)](_0x234324(0xaa),'/operations/'+_0x14183e,_0x234324(0xd0),Object[_0x234324(0xec)](_0x115773[_0x234324(0xc9)]()));const _0x4d63b6=await fetch(_0x5a21d0,{'method':_0x234324(0xd0),'headers':{'Accept':_0x234324(0xf0),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x5dc39a=Date[_0x234324(0xf1)]()-_0x79d6ba;if(!_0x4d63b6['ok']){const _0x3fb377=await _0x4d63b6[_0x234324(0x9b)]();loggerService_1[_0x234324(0x7f)][_0x234324(0xcc)](_0x234324(0xaa),'/operations/'+_0x14183e,_0x4d63b6[_0x234324(0xdc)],_0x3fb377,_0x5dc39a);throw new Error(_0x234324(0x8f)+_0x4d63b6[_0x234324(0xdc)]);}const _0x56dcdd=await _0x4d63b6['json']();loggerService_1[_0x234324(0x7f)][_0x234324(0xcc)]('plisio_direct',_0x234324(0xed)+_0x14183e,_0x4d63b6['status'],_0x56dcdd,_0x5dc39a);if(_0x56dcdd[_0x234324(0xdc)]!=='success'){loggerService_1['loggerService'][_0x234324(0xa0)](_0x234324(0xaa),'/operations/'+_0x14183e,_0x234324(0xe3)+(_0x56dcdd['message']||_0x56dcdd[_0x234324(0x90)]||'Unknown\x20error'));throw new Error('Plisio\x20API\x20error:\x20'+(_0x56dcdd[_0x234324(0xbe)]||_0x56dcdd[_0x234324(0x90)]||'Unknown\x20error'));}let _0x180ca1=_0x234324(0x9e);return{'status':_0x180ca1};}catch(_0x9b514f){console[_0x234324(0x90)]('Plisio\x20payment\x20verification\x20error:',_0x9b514f),loggerService_1[_0x234324(0x7f)][_0x234324(0xa0)]('plisio_direct','/operations/'+_0x14183e,_0x9b514f);throw new Error(_0x234324(0xa1)+(_0x9b514f instanceof Error?_0x9b514f[_0x234324(0xbe)]:'Unknown\x20error'));}}async[a44_0x268960(0xa5)](_0x2450b0){const _0x24ea92=a44_0x268960;console[_0x24ea92(0xe2)](_0x24ea92(0xe7),_0x2450b0);let _0x46e575=_0x24ea92(0x9e);switch(_0x2450b0[_0x24ea92(0xdc)]?.[_0x24ea92(0xa8)]()){case _0x24ea92(0x79):case _0x24ea92(0xb0):_0x46e575='PAID';break;case _0x24ea92(0xbb):_0x46e575=_0x24ea92(0xbf);break;case _0x24ea92(0x90):case _0x24ea92(0x96):_0x46e575=_0x24ea92(0xb2);break;case _0x24ea92(0x98):_0x46e575=_0x24ea92(0x9e);break;case _0x24ea92(0x85):_0x46e575=_0x24ea92(0xd7);break;default:_0x46e575=_0x24ea92(0x9e);break;}let _0x5c8351;if(_0x2450b0[_0x24ea92(0x83)])try{console[_0x24ea92(0xe2)](_0x24ea92(0xe1),_0x2450b0[_0x24ea92(0x83)]);let _0x3c65d2;if(typeof _0x2450b0[_0x24ea92(0x83)]===_0x24ea92(0xb4))_0x3c65d2=JSON['parse'](_0x2450b0[_0x24ea92(0x83)]);else Array['isArray'](_0x2450b0[_0x24ea92(0x83)])?_0x3c65d2=_0x2450b0[_0x24ea92(0x83)]:_0x3c65d2=[];_0x5c8351=_0x3c65d2[_0x24ea92(0xe6)](_0x46ff13=>{const _0x293f52=_0x24ea92,_0x30e93d=_0x46ff13[_0x293f52(0xd2)](/\\/g,'');return console[_0x293f52(0xe2)]('üîó\x20Formatted\x20URL:\x20'+_0x46ff13+_0x293f52(0xe0)+_0x30e93d),_0x30e93d;}),console[_0x24ea92(0xe2)](_0x24ea92(0xca),_0x5c8351),_0x5c8351[_0x24ea92(0xd4)]((_0xd4653,_0x27dc22)=>{const _0x41f2fd=_0x24ea92;try{new URL(_0xd4653),console['log'](_0x41f2fd(0xdf)+(_0x27dc22+0x1)+_0x41f2fd(0xea)+_0xd4653);}catch(_0x5a635a){console[_0x41f2fd(0x90)](_0x41f2fd(0xe8)+(_0x27dc22+0x1)+_0x41f2fd(0x8c)+_0xd4653,_0x5a635a);}});}catch(_0x23bfea){console[_0x24ea92(0x90)](_0x24ea92(0xa3),_0x23bfea),console['error']('Raw\x20tx_urls\x20data:',_0x2450b0[_0x24ea92(0x83)]),_0x5c8351=undefined;}return{'paymentId':_0x2450b0[_0x24ea92(0x7c)]||'','status':_0x46e575,'amount':_0x2450b0[_0x24ea92(0x81)],'currency':_0x2450b0[_0x24ea92(0xa7)],'txUrls':_0x5c8351};}}exports[a44_0x268960(0xad)]=PlisioService;