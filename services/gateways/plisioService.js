'use strict';const a44_0x33c69d=a44_0x17ee;(function(_0x395557,_0x2e8f20){const _0x1d7057=a44_0x17ee,_0x759620=_0x395557();while(!![]){try{const _0x394544=parseInt(_0x1d7057(0x161))/0x1*(parseInt(_0x1d7057(0x186))/0x2)+parseInt(_0x1d7057(0x145))/0x3*(-parseInt(_0x1d7057(0x15e))/0x4)+-parseInt(_0x1d7057(0x178))/0x5+parseInt(_0x1d7057(0x149))/0x6*(parseInt(_0x1d7057(0x138))/0x7)+-parseInt(_0x1d7057(0x180))/0x8+-parseInt(_0x1d7057(0x12f))/0x9+parseInt(_0x1d7057(0x140))/0xa;if(_0x394544===_0x2e8f20)break;else _0x759620['push'](_0x759620['shift']());}catch(_0x24052c){_0x759620['push'](_0x759620['shift']());}}}(a44_0x4c9d,0x6d0f1));function a44_0x17ee(_0x39c828,_0x491771){const _0x4c9d1c=a44_0x4c9d();return a44_0x17ee=function(_0x17ee60,_0x5e596d){_0x17ee60=_0x17ee60-0x127;let _0x34f0fa=_0x4c9d1c[_0x17ee60];return _0x34f0fa;},a44_0x17ee(_0x39c828,_0x491771);}Object[a44_0x33c69d(0x132)](exports,'__esModule',{'value':!![]}),exports[a44_0x33c69d(0x141)]=void 0x0;const loggerService_1=require('../loggerService');function a44_0x4c9d(){const _0x2dd722=['Failed\x20to\x20parse\x20JSON\x20response:','Parameters:','plisio_direct','mismatch','data','Error\x20stack:','invoice_url','fromEntries','logWhiteDomainError','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','apiKey','FAILED','logWhiteDomainResponse','Invoice\x20URL:','===\x20PLISIO\x20SUCCESS\x20===','Unknown\x20error\x20from\x20Plisio\x20API','Amount:','HTTP\x20Status:','pending','application/json','5041800DSRjDn','createPayment','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','defineProperty','Raw\x20tx_urls\x20data:','message','/invoices/new','success','env','70nVHRfb','\x20is\x20invalid:\x20','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','expired','Target\x20Currency:','URL:','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','6559670JQVgFH','PlisioService','map','\x20->\x20','Plisio\x20payment\x20verification\x20error:','201hHMIsW','‚ùå\x20URL\x20','append','HTTP\x20error!\x20status:\x20','201072XeaeWd','GET','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','logWhiteDomainRequest','currency','completed','Response\x20Body:','Error\x20details:','toLowerCase','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Error\x20Message:','‚úÖ\x20Processed\x20tx_urls:','Full\x20URL\x20(without\x20API\x20key):','stringify','replace','entries','tx_urls','email','toString','Response\x20Time:','error','14836kpDMfy','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','log','3QPTCoy','Transaction\x20ID:','Processing\x20Plisio\x20webhook:','order_number','HTTP\x20','HIDDEN','‚úÖ\x20URL\x20','loggerService','Unknown\x20error','amount','Error\x20message:','PAID','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','qr_url','(fiat\x20for\x20merchant)','source_amount','Status\x20Text:','processWebhook','statusText','txn_id','Response\x20data:','new','2518485JWBzgC','Plisio\x20API\x20error:\x20','now','text',',\x20body:\x20','forEach','/operations/','===\x20PLISIO\x20API\x20ERROR\x20===','293208psZlQy','parse','EXPIRED','(crypto\x20for\x20payment)','Plisio\x20API\x20key\x20is\x20not\x20configured','status','536446POBnjI','PENDING','cancelled','https://api.plisio.net/api/v1/invoices/new','apiUrl','https://api.trapay.uk/api/webhooks/gateway/plisio','Raw\x20Response\x20Body:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','üîó\x20Formatted\x20URL:\x20'];a44_0x4c9d=function(){return _0x2dd722;};return a44_0x4c9d();}class PlisioService{constructor(){const _0x227fc7=a44_0x33c69d;this[_0x227fc7(0x18a)]=_0x227fc7(0x189),this[_0x227fc7(0x199)]=process[_0x227fc7(0x137)]['PLISIO_API_KEY']||'',!this[_0x227fc7(0x199)]?console['warn'](_0x227fc7(0x198)):console['log'](_0x227fc7(0x14b));}async[a44_0x33c69d(0x130)](_0x5154d0){const _0x2a97e5=a44_0x33c69d,{orderId:_0x164dc3,amount:_0x1c355d,currency:_0xca1975,productName:_0x4b1016,description:_0x56992c,successUrl:_0x5f194b,failUrl:_0x2ef8f1,customerEmail:_0x4408dc,customerName:_0x41e14e,isSourceCurrency:_0x5c5b36,sourceCurrency:_0x3eaa6b}=_0x5154d0;if(!this[_0x2a97e5(0x199)])throw new Error(_0x2a97e5(0x184));const _0x148dc3=new URLSearchParams({'api_key':this[_0x2a97e5(0x199)],'order_number':_0x164dc3,'order_name':_0x4b1016,'description':_0x56992c,'success_url':_0x5f194b,'fail_url':_0x2ef8f1,'callback_url':_0x2a97e5(0x18b)});_0x3eaa6b?(_0x148dc3[_0x2a97e5(0x147)](_0x2a97e5(0x14d),_0x3eaa6b),_0x148dc3[_0x2a97e5(0x147)]('source_currency',_0xca1975),_0x148dc3[_0x2a97e5(0x147)](_0x2a97e5(0x171),_0x1c355d[_0x2a97e5(0x15b)]())):(_0x148dc3[_0x2a97e5(0x147)](_0x2a97e5(0x14d),_0xca1975),_0x148dc3[_0x2a97e5(0x147)](_0x2a97e5(0x16a),_0x1c355d[_0x2a97e5(0x15b)]()));_0x4408dc&&_0x148dc3['append'](_0x2a97e5(0x15a),_0x4408dc);_0x41e14e&&_0x148dc3[_0x2a97e5(0x147)]('name',_0x41e14e);const _0x1f1f5c=this[_0x2a97e5(0x18a)]+'?'+_0x148dc3[_0x2a97e5(0x15b)](),_0x5400cd=Date[_0x2a97e5(0x17a)]();try{console['log'](_0x2a97e5(0x18d)),console[_0x2a97e5(0x160)](_0x2a97e5(0x13d),this['apiUrl']),console['log'](_0x2a97e5(0x190),Object[_0x2a97e5(0x196)](_0x148dc3[_0x2a97e5(0x158)]())),console[_0x2a97e5(0x160)](_0x2a97e5(0x155),_0x1f1f5c[_0x2a97e5(0x157)](this[_0x2a97e5(0x199)],_0x2a97e5(0x166))),loggerService_1[_0x2a97e5(0x168)][_0x2a97e5(0x14c)](_0x2a97e5(0x191),_0x2a97e5(0x135),_0x2a97e5(0x14a),Object[_0x2a97e5(0x196)](_0x148dc3[_0x2a97e5(0x158)]()));const _0x553b08=await fetch(_0x1f1f5c,{'method':_0x2a97e5(0x14a),'headers':{'Accept':_0x2a97e5(0x12e),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x39ad6a=Date[_0x2a97e5(0x17a)]()-_0x5400cd;console[_0x2a97e5(0x160)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x2a97e5(0x160)]('Status:',_0x553b08[_0x2a97e5(0x185)]),console[_0x2a97e5(0x160)](_0x2a97e5(0x172),_0x553b08[_0x2a97e5(0x174)]),console[_0x2a97e5(0x160)](_0x2a97e5(0x15c),_0x39ad6a+'ms');const _0x256596=await _0x553b08[_0x2a97e5(0x17b)]();console['log'](_0x2a97e5(0x18c),_0x256596);if(!_0x553b08['ok']){console[_0x2a97e5(0x15d)](_0x2a97e5(0x17f)),console['error'](_0x2a97e5(0x12c),_0x553b08[_0x2a97e5(0x185)]),console[_0x2a97e5(0x15d)](_0x2a97e5(0x14f),_0x256596),loggerService_1[_0x2a97e5(0x168)][_0x2a97e5(0x127)](_0x2a97e5(0x191),_0x2a97e5(0x135),_0x553b08[_0x2a97e5(0x185)],_0x256596,_0x39ad6a),loggerService_1[_0x2a97e5(0x168)][_0x2a97e5(0x197)](_0x2a97e5(0x191),_0x2a97e5(0x135),_0x2a97e5(0x165)+_0x553b08[_0x2a97e5(0x185)]+':\x20'+_0x256596);throw new Error(_0x2a97e5(0x148)+_0x553b08['status']+_0x2a97e5(0x17c)+_0x256596);}let _0x27f889;try{_0x27f889=JSON[_0x2a97e5(0x181)](_0x256596);}catch(_0x3dbc32){console[_0x2a97e5(0x15d)](_0x2a97e5(0x18f),_0x3dbc32),loggerService_1[_0x2a97e5(0x168)][_0x2a97e5(0x197)]('plisio_direct',_0x2a97e5(0x135),'JSON\x20Parse\x20Error:\x20'+_0x3dbc32);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x256596);}console[_0x2a97e5(0x160)](_0x2a97e5(0x13f)),console['log']('Parsed\x20Result:',JSON[_0x2a97e5(0x156)](_0x27f889,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse']('plisio_direct',_0x2a97e5(0x135),_0x553b08['status'],_0x27f889,_0x39ad6a);if(_0x27f889[_0x2a97e5(0x185)]!==_0x2a97e5(0x136)){const _0x33bb83=_0x27f889[_0x2a97e5(0x134)]||_0x27f889[_0x2a97e5(0x15d)]||_0x2a97e5(0x12a);console[_0x2a97e5(0x15d)](_0x2a97e5(0x16e)),console[_0x2a97e5(0x15d)](_0x2a97e5(0x153),_0x33bb83),loggerService_1[_0x2a97e5(0x168)][_0x2a97e5(0x197)](_0x2a97e5(0x191),_0x2a97e5(0x135),'Business\x20Error:\x20'+_0x33bb83);throw new Error(_0x2a97e5(0x179)+_0x33bb83);}if(!_0x27f889['data']?.[_0x2a97e5(0x175)]||!_0x27f889['data']?.[_0x2a97e5(0x195)]){console[_0x2a97e5(0x15d)](_0x2a97e5(0x16d)),console['error']('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x2a97e5(0x15d)](_0x2a97e5(0x176),_0x27f889[_0x2a97e5(0x193)]),loggerService_1[_0x2a97e5(0x168)][_0x2a97e5(0x197)](_0x2a97e5(0x191),_0x2a97e5(0x135),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x2a97e5(0x15f));}return console[_0x2a97e5(0x160)](_0x2a97e5(0x129)),console[_0x2a97e5(0x160)](_0x2a97e5(0x162),_0x27f889[_0x2a97e5(0x193)]['txn_id']),console[_0x2a97e5(0x160)](_0x2a97e5(0x128),_0x27f889[_0x2a97e5(0x193)][_0x2a97e5(0x195)]),console[_0x2a97e5(0x160)](_0x2a97e5(0x12b),_0x1c355d,_0xca1975),_0x3eaa6b&&(console['log']('Source\x20Currency:',_0x3eaa6b,_0x2a97e5(0x183)),console[_0x2a97e5(0x160)](_0x2a97e5(0x13c),_0xca1975,_0x2a97e5(0x170))),{'gateway_payment_id':_0x27f889[_0x2a97e5(0x193)][_0x2a97e5(0x175)],'payment_url':_0x27f889[_0x2a97e5(0x193)]['invoice_url'],'invoice_total_sum':_0x27f889[_0x2a97e5(0x193)]['invoice_total_sum'],'qr_code':_0x27f889[_0x2a97e5(0x193)]['qr_code'],'qr_url':_0x27f889[_0x2a97e5(0x193)][_0x2a97e5(0x16f)]};}catch(_0x12e78e){console[_0x2a97e5(0x15d)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x2a97e5(0x15d)](_0x2a97e5(0x150),_0x12e78e),loggerService_1[_0x2a97e5(0x168)][_0x2a97e5(0x197)](_0x2a97e5(0x191),_0x2a97e5(0x135),_0x12e78e);if(_0x12e78e instanceof Error){console[_0x2a97e5(0x15d)](_0x2a97e5(0x16b),_0x12e78e[_0x2a97e5(0x134)]),console[_0x2a97e5(0x15d)](_0x2a97e5(0x194),_0x12e78e['stack']);throw new Error(_0x2a97e5(0x152)+_0x12e78e['message']);}throw new Error(_0x2a97e5(0x131));}}async['verifyPayment'](_0x4e716b){const _0x5b0194=a44_0x33c69d,_0x2d7a7d=Date['now']();try{if(!this[_0x5b0194(0x199)])throw new Error(_0x5b0194(0x184));const _0x1a13a2=new URLSearchParams({'api_key':this[_0x5b0194(0x199)],'txn_id':_0x4e716b}),_0x2392c5='https://api.plisio.net/api/v1/operations/'+_0x4e716b+'?'+_0x1a13a2[_0x5b0194(0x15b)]();loggerService_1[_0x5b0194(0x168)][_0x5b0194(0x14c)]('plisio_direct',_0x5b0194(0x17e)+_0x4e716b,_0x5b0194(0x14a),Object[_0x5b0194(0x196)](_0x1a13a2[_0x5b0194(0x158)]()));const _0x212f7c=await fetch(_0x2392c5,{'method':_0x5b0194(0x14a),'headers':{'Accept':_0x5b0194(0x12e),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x1d3680=Date['now']()-_0x2d7a7d;if(!_0x212f7c['ok']){const _0x5a794b=await _0x212f7c[_0x5b0194(0x17b)]();loggerService_1[_0x5b0194(0x168)][_0x5b0194(0x127)]('plisio_direct',_0x5b0194(0x17e)+_0x4e716b,_0x212f7c[_0x5b0194(0x185)],_0x5a794b,_0x1d3680);throw new Error(_0x5b0194(0x148)+_0x212f7c[_0x5b0194(0x185)]);}const _0x23b3bb=await _0x212f7c['json']();loggerService_1[_0x5b0194(0x168)]['logWhiteDomainResponse'](_0x5b0194(0x191),'/operations/'+_0x4e716b,_0x212f7c[_0x5b0194(0x185)],_0x23b3bb,_0x1d3680);if(_0x23b3bb[_0x5b0194(0x185)]!==_0x5b0194(0x136)){loggerService_1[_0x5b0194(0x168)][_0x5b0194(0x197)](_0x5b0194(0x191),'/operations/'+_0x4e716b,'Plisio\x20API\x20error:\x20'+(_0x23b3bb[_0x5b0194(0x134)]||_0x23b3bb[_0x5b0194(0x15d)]||'Unknown\x20error'));throw new Error(_0x5b0194(0x179)+(_0x23b3bb[_0x5b0194(0x134)]||_0x23b3bb[_0x5b0194(0x15d)]||'Unknown\x20error'));}let _0x381544=_0x5b0194(0x187);return{'status':_0x381544};}catch(_0x3434b3){console[_0x5b0194(0x15d)](_0x5b0194(0x144),_0x3434b3),loggerService_1[_0x5b0194(0x168)][_0x5b0194(0x197)]('plisio_direct',_0x5b0194(0x17e)+_0x4e716b,_0x3434b3);throw new Error(_0x5b0194(0x13e)+(_0x3434b3 instanceof Error?_0x3434b3['message']:_0x5b0194(0x169)));}}async[a44_0x33c69d(0x173)](_0x585654){const _0x15a4ad=a44_0x33c69d;console[_0x15a4ad(0x160)](_0x15a4ad(0x163),_0x585654);let _0x3ebba4=_0x15a4ad(0x187);switch(_0x585654[_0x15a4ad(0x185)]?.[_0x15a4ad(0x151)]()){case _0x15a4ad(0x14e):case _0x15a4ad(0x192):_0x3ebba4=_0x15a4ad(0x16c);break;case _0x15a4ad(0x13b):_0x3ebba4=_0x15a4ad(0x182);break;case _0x15a4ad(0x15d):case _0x15a4ad(0x188):_0x3ebba4=_0x15a4ad(0x19a);break;case _0x15a4ad(0x177):case _0x15a4ad(0x12d):default:_0x3ebba4=_0x15a4ad(0x187);break;}let _0x1e88b1;if(_0x585654[_0x15a4ad(0x159)])try{console[_0x15a4ad(0x160)](_0x15a4ad(0x13a),_0x585654[_0x15a4ad(0x159)]);let _0x2c25c8;if(typeof _0x585654[_0x15a4ad(0x159)]==='string')_0x2c25c8=JSON['parse'](_0x585654[_0x15a4ad(0x159)]);else Array['isArray'](_0x585654[_0x15a4ad(0x159)])?_0x2c25c8=_0x585654[_0x15a4ad(0x159)]:_0x2c25c8=[];_0x1e88b1=_0x2c25c8[_0x15a4ad(0x142)](_0x47ee0a=>{const _0x2a0715=_0x15a4ad,_0xbfca0=_0x47ee0a[_0x2a0715(0x157)](/\\/g,'');return console[_0x2a0715(0x160)](_0x2a0715(0x18e)+_0x47ee0a+_0x2a0715(0x143)+_0xbfca0),_0xbfca0;}),console[_0x15a4ad(0x160)](_0x15a4ad(0x154),_0x1e88b1),_0x1e88b1[_0x15a4ad(0x17d)]((_0x58f3c9,_0x180dc6)=>{const _0x48f2d1=_0x15a4ad;try{new URL(_0x58f3c9),console[_0x48f2d1(0x160)](_0x48f2d1(0x167)+(_0x180dc6+0x1)+'\x20is\x20valid:\x20'+_0x58f3c9);}catch(_0x56c6c2){console['error'](_0x48f2d1(0x146)+(_0x180dc6+0x1)+_0x48f2d1(0x139)+_0x58f3c9,_0x56c6c2);}});}catch(_0x95b44f){console[_0x15a4ad(0x15d)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x95b44f),console[_0x15a4ad(0x15d)](_0x15a4ad(0x133),_0x585654['tx_urls']),_0x1e88b1=undefined;}return{'paymentId':_0x585654[_0x15a4ad(0x164)]||'','status':_0x3ebba4,'amount':_0x585654['amount'],'currency':_0x585654[_0x15a4ad(0x14d)],'txUrls':_0x1e88b1};}}exports[a44_0x33c69d(0x141)]=PlisioService;