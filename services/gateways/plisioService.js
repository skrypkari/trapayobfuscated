'use strict';const a68_0x2eda8a=a68_0x35ab;(function(_0x112ee5,_0xfcc4bb){const _0x25cfbe=a68_0x35ab,_0x68633=_0x112ee5();while(!![]){try{const _0x4962e1=parseInt(_0x25cfbe(0x144))/0x1*(parseInt(_0x25cfbe(0x198))/0x2)+-parseInt(_0x25cfbe(0x173))/0x3+-parseInt(_0x25cfbe(0x185))/0x4*(parseInt(_0x25cfbe(0x14b))/0x5)+parseInt(_0x25cfbe(0x1a7))/0x6*(-parseInt(_0x25cfbe(0x13c))/0x7)+-parseInt(_0x25cfbe(0x197))/0x8*(-parseInt(_0x25cfbe(0x1a0))/0x9)+-parseInt(_0x25cfbe(0x169))/0xa*(parseInt(_0x25cfbe(0x149))/0xb)+parseInt(_0x25cfbe(0x162))/0xc*(parseInt(_0x25cfbe(0x147))/0xd);if(_0x4962e1===_0xfcc4bb)break;else _0x68633['push'](_0x68633['shift']());}catch(_0x550101){_0x68633['push'](_0x68633['shift']());}}}(a68_0x300d,0x99ebc));function a68_0x300d(){const _0x16eeb6=['GET','URL:','https://api.trapay.uk/api/webhooks/gateway/plisio','toLowerCase','âŒ\x20Failed\x20to\x20parse\x20tx_urls:','Error\x20message:','/operations/','JSON\x20Parse\x20Error:\x20','156mPDTWQ','Plisio\x20payment\x20verification\x20error:','Response\x20Time:','Failed\x20to\x20create\x20Plisio\x20payment:\x20','now','Payment\x20System/1.0','Error\x20Message:','\x20->\x20','Status:','Processing\x20Plisio\x20webhook:','Response\x20data:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','apiUrl','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','processWebhook','mismatch','stack','logWhiteDomainResponse','6902312VMsmif','156034LFNnkF','ðŸ’°\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','../loggerService','âœ…\x20Processed\x20tx_urls:','qr_url','âŒ\x20URL\x20','data','https://api.plisio.net/api/v1/invoices/new','9WSLlUX','order_number','application/json','Unknown\x20error','text','Error\x20details:','PAID','29382xmmmkC','===\x20PLISIO\x20SUCCESS\x20===','(crypto\x20for\x20payment)','warn',',\x20body:\x20','expired','__esModule','logWhiteDomainError','apiKey','email','entries','verifyPayment','Response\x20Body:','toString','\x20is\x20valid:\x20','EXPIRED','7RJPvtW','log','HTTP\x20Status:','Parameters:','https://api.plisio.net/api/v1/operations/','txn_id','Source\x20Currency:','plisio_direct','2IKoqrn','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','Unknown\x20error\x20from\x20Plisio\x20API','3477643oFzhQc','qr_code','22gzYjgE','amount','87090TBuxkD','replace','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Business\x20Error:\x20','invoice_total_sum','tx_urls','isArray','status','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Error\x20stack:','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','defineProperty','cancelled','HTTP\x20error!\x20status:\x20','Status\x20Text:','logWhiteDomainRequest','success','===\x20PLISIO\x20API\x20ERROR\x20===','âš ï¸\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','invoice_url','\x20is\x20invalid:\x20','error','statusText','48XeuXwo','PlisioService','new','currency','completed','Plisio\x20API\x20error:\x20','loggerService','719740ybWFVq','json','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','message','string','fromEntries','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20','PENDING','Plisio\x20API\x20key\x20is\x20not\x20configured','1890780FDbQaF','parse','FAILED','/invoices/new','Parsed\x20Result:','name','append','ðŸ”—\x20Formatted\x20URL:\x20','source_currency','Invoice\x20URL:'];a68_0x300d=function(){return _0x16eeb6;};return a68_0x300d();}Object[a68_0x2eda8a(0x156)](exports,a68_0x2eda8a(0x132),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a68_0x2eda8a(0x19a));class PlisioService{constructor(){const _0x3815aa=a68_0x2eda8a;this[_0x3815aa(0x191)]=_0x3815aa(0x19f),this[_0x3815aa(0x134)]=process.env.PLISIO_API_KEY||'',!this[_0x3815aa(0x134)]?console[_0x3815aa(0x1aa)](_0x3815aa(0x15d)):console[_0x3815aa(0x13d)](_0x3815aa(0x199));}async['createPayment'](_0x4f31a9){const _0x26b4a3=a68_0x2eda8a,{orderId:_0x2c942b,amount:_0x50f3a6,currency:_0x48321f,productName:_0x2e8f9b,description:_0x1b98f4,successUrl:_0x9059f0,failUrl:_0x5188f5,customerEmail:_0xfb3d94,customerName:_0x171c5d,isSourceCurrency:_0x182f60,sourceCurrency:_0xd57345}=_0x4f31a9;if(!this[_0x26b4a3(0x134)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x48700a=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x2c942b,'order_name':_0x2e8f9b,'description':_0x1b98f4,'success_url':_0x9059f0,'fail_url':_0x5188f5,'callback_url':_0x26b4a3(0x17f)});_0xd57345?(_0x48700a[_0x26b4a3(0x179)](_0x26b4a3(0x165),_0xd57345),_0x48700a[_0x26b4a3(0x179)](_0x26b4a3(0x17b),_0x48321f),_0x48700a[_0x26b4a3(0x179)]('source_amount',_0x50f3a6[_0x26b4a3(0x139)]())):(_0x48700a[_0x26b4a3(0x179)](_0x26b4a3(0x165),_0x48321f),_0x48700a['append']('amount',_0x50f3a6[_0x26b4a3(0x139)]()));_0xfb3d94&&_0x48700a[_0x26b4a3(0x179)](_0x26b4a3(0x135),_0xfb3d94);_0x171c5d&&_0x48700a[_0x26b4a3(0x179)](_0x26b4a3(0x178),_0x171c5d);const _0xd594fa=this[_0x26b4a3(0x191)]+'?'+_0x48700a[_0x26b4a3(0x139)](),_0x25f852=Date[_0x26b4a3(0x189)]();try{console[_0x26b4a3(0x13d)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x26b4a3(0x13d)](_0x26b4a3(0x17e),this[_0x26b4a3(0x191)]),console[_0x26b4a3(0x13d)](_0x26b4a3(0x13f),Object[_0x26b4a3(0x16e)](_0x48700a[_0x26b4a3(0x136)]())),console['log']('Full\x20URL\x20(without\x20API\x20key):',_0xd594fa['replace'](this[_0x26b4a3(0x134)],'HIDDEN')),loggerService_1[_0x26b4a3(0x168)][_0x26b4a3(0x15a)]('plisio_direct',_0x26b4a3(0x176),_0x26b4a3(0x17d),Object['fromEntries'](_0x48700a[_0x26b4a3(0x136)]()));const _0x170dab=await fetch(_0xd594fa,{'method':_0x26b4a3(0x17d),'headers':{'Accept':_0x26b4a3(0x1a2),'User-Agent':_0x26b4a3(0x18a)}}),_0x1e626b=Date[_0x26b4a3(0x189)]()-_0x25f852;console[_0x26b4a3(0x13d)](_0x26b4a3(0x14d)),console['log'](_0x26b4a3(0x18d),_0x170dab[_0x26b4a3(0x152)]),console['log'](_0x26b4a3(0x159),_0x170dab[_0x26b4a3(0x161)]),console['log'](_0x26b4a3(0x187),_0x1e626b+'ms');const _0x5043d8=await _0x170dab['text']();console[_0x26b4a3(0x13d)]('Raw\x20Response\x20Body:',_0x5043d8);if(!_0x170dab['ok']){console[_0x26b4a3(0x160)](_0x26b4a3(0x15c)),console[_0x26b4a3(0x160)](_0x26b4a3(0x13e),_0x170dab[_0x26b4a3(0x152)]),console[_0x26b4a3(0x160)](_0x26b4a3(0x138),_0x5043d8),loggerService_1[_0x26b4a3(0x168)][_0x26b4a3(0x196)](_0x26b4a3(0x143),_0x26b4a3(0x176),_0x170dab[_0x26b4a3(0x152)],_0x5043d8,_0x1e626b),loggerService_1[_0x26b4a3(0x168)]['logWhiteDomainError'](_0x26b4a3(0x143),_0x26b4a3(0x176),_0x26b4a3(0x170)+_0x170dab[_0x26b4a3(0x152)]+':\x20'+_0x5043d8);throw new Error(_0x26b4a3(0x158)+_0x170dab['status']+_0x26b4a3(0x130)+_0x5043d8);}let _0x37fa22;try{_0x37fa22=JSON['parse'](_0x5043d8);}catch(_0x34154a){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x34154a),loggerService_1[_0x26b4a3(0x168)][_0x26b4a3(0x133)]('plisio_direct',_0x26b4a3(0x176),_0x26b4a3(0x184)+_0x34154a);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x5043d8);}console['log'](_0x26b4a3(0x155)),console[_0x26b4a3(0x13d)](_0x26b4a3(0x177),JSON['stringify'](_0x37fa22,null,0x2)),loggerService_1[_0x26b4a3(0x168)][_0x26b4a3(0x196)](_0x26b4a3(0x143),'/invoices/new',_0x170dab[_0x26b4a3(0x152)],_0x37fa22,_0x1e626b);if(_0x37fa22[_0x26b4a3(0x152)]!==_0x26b4a3(0x15b)){const _0x2fa587=_0x37fa22['message']||_0x37fa22[_0x26b4a3(0x160)]||_0x26b4a3(0x146);console[_0x26b4a3(0x160)](_0x26b4a3(0x16f)),console['error'](_0x26b4a3(0x18b),_0x2fa587),loggerService_1[_0x26b4a3(0x168)][_0x26b4a3(0x133)](_0x26b4a3(0x143),_0x26b4a3(0x176),_0x26b4a3(0x14e)+_0x2fa587);throw new Error('Plisio\x20API\x20error:\x20'+_0x2fa587);}if(!_0x37fa22[_0x26b4a3(0x19e)]?.[_0x26b4a3(0x141)]||!_0x37fa22[_0x26b4a3(0x19e)]?.[_0x26b4a3(0x15e)]){console['error'](_0x26b4a3(0x192)),console[_0x26b4a3(0x160)](_0x26b4a3(0x145)),console[_0x26b4a3(0x160)](_0x26b4a3(0x18f),_0x37fa22[_0x26b4a3(0x19e)]),loggerService_1[_0x26b4a3(0x168)]['logWhiteDomainError'](_0x26b4a3(0x143),_0x26b4a3(0x176),_0x26b4a3(0x153));throw new Error(_0x26b4a3(0x190));}return console[_0x26b4a3(0x13d)](_0x26b4a3(0x1a8)),console[_0x26b4a3(0x13d)]('Transaction\x20ID:',_0x37fa22[_0x26b4a3(0x19e)]['txn_id']),console[_0x26b4a3(0x13d)](_0x26b4a3(0x17c),_0x37fa22['data'][_0x26b4a3(0x15e)]),console[_0x26b4a3(0x13d)]('Amount:',_0x50f3a6,_0x48321f),_0xd57345&&(console['log'](_0x26b4a3(0x142),_0xd57345,_0x26b4a3(0x1a9)),console[_0x26b4a3(0x13d)]('Target\x20Currency:',_0x48321f,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x37fa22[_0x26b4a3(0x19e)]['txn_id'],'payment_url':_0x37fa22[_0x26b4a3(0x19e)][_0x26b4a3(0x15e)],'invoice_total_sum':_0x37fa22['data'][_0x26b4a3(0x14f)],'qr_code':_0x37fa22['data'][_0x26b4a3(0x148)],'qr_url':_0x37fa22[_0x26b4a3(0x19e)][_0x26b4a3(0x19c)]};}catch(_0x336032){console[_0x26b4a3(0x160)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x26b4a3(0x160)](_0x26b4a3(0x1a5),_0x336032),loggerService_1[_0x26b4a3(0x168)]['logWhiteDomainError'](_0x26b4a3(0x143),'/invoices/new',_0x336032);if(_0x336032 instanceof Error){console['error'](_0x26b4a3(0x182),_0x336032[_0x26b4a3(0x16c)]),console[_0x26b4a3(0x160)](_0x26b4a3(0x154),_0x336032[_0x26b4a3(0x195)]);throw new Error(_0x26b4a3(0x188)+_0x336032[_0x26b4a3(0x16c)]);}throw new Error(_0x26b4a3(0x16b));}}async[a68_0x2eda8a(0x137)](_0xefbb70){const _0x30bdb2=a68_0x2eda8a,_0x2b78cf=Date[_0x30bdb2(0x189)]();try{if(!this['apiKey'])throw new Error(_0x30bdb2(0x172));const _0x384d05=new URLSearchParams({'api_key':this[_0x30bdb2(0x134)],'txn_id':_0xefbb70}),_0x50daa6=_0x30bdb2(0x140)+_0xefbb70+'?'+_0x384d05[_0x30bdb2(0x139)]();loggerService_1['loggerService']['logWhiteDomainRequest'](_0x30bdb2(0x143),_0x30bdb2(0x183)+_0xefbb70,_0x30bdb2(0x17d),Object[_0x30bdb2(0x16e)](_0x384d05[_0x30bdb2(0x136)]()));const _0x225a99=await fetch(_0x50daa6,{'method':_0x30bdb2(0x17d),'headers':{'Accept':_0x30bdb2(0x1a2),'User-Agent':_0x30bdb2(0x18a)}}),_0xa0fc2c=Date['now']()-_0x2b78cf;if(!_0x225a99['ok']){const _0x25a89a=await _0x225a99[_0x30bdb2(0x1a4)]();loggerService_1[_0x30bdb2(0x168)][_0x30bdb2(0x196)](_0x30bdb2(0x143),_0x30bdb2(0x183)+_0xefbb70,_0x225a99[_0x30bdb2(0x152)],_0x25a89a,_0xa0fc2c);throw new Error(_0x30bdb2(0x158)+_0x225a99[_0x30bdb2(0x152)]);}const _0x4ddfa2=await _0x225a99[_0x30bdb2(0x16a)]();loggerService_1[_0x30bdb2(0x168)]['logWhiteDomainResponse']('plisio_direct',_0x30bdb2(0x183)+_0xefbb70,_0x225a99[_0x30bdb2(0x152)],_0x4ddfa2,_0xa0fc2c);if(_0x4ddfa2[_0x30bdb2(0x152)]!=='success'){loggerService_1['loggerService'][_0x30bdb2(0x133)](_0x30bdb2(0x143),_0x30bdb2(0x183)+_0xefbb70,_0x30bdb2(0x167)+(_0x4ddfa2[_0x30bdb2(0x16c)]||_0x4ddfa2[_0x30bdb2(0x160)]||'Unknown\x20error'));throw new Error(_0x30bdb2(0x167)+(_0x4ddfa2['message']||_0x4ddfa2[_0x30bdb2(0x160)]||_0x30bdb2(0x1a3)));}let _0x1811ba='PENDING';return{'status':_0x1811ba};}catch(_0x24a108){console[_0x30bdb2(0x160)](_0x30bdb2(0x186),_0x24a108),loggerService_1[_0x30bdb2(0x168)][_0x30bdb2(0x133)](_0x30bdb2(0x143),'/operations/'+_0xefbb70,_0x24a108);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x24a108 instanceof Error?_0x24a108['message']:_0x30bdb2(0x1a3)));}}async[a68_0x2eda8a(0x193)](_0x5087cb){const _0x58d6c3=a68_0x2eda8a;console[_0x58d6c3(0x13d)](_0x58d6c3(0x18e),_0x5087cb);let _0x575115='PENDING';switch(_0x5087cb[_0x58d6c3(0x152)]?.[_0x58d6c3(0x180)]()){case _0x58d6c3(0x166):case _0x58d6c3(0x194):_0x575115=_0x58d6c3(0x1a6);break;case _0x58d6c3(0x131):_0x575115=_0x58d6c3(0x13b);break;case _0x58d6c3(0x160):case _0x58d6c3(0x157):_0x575115=_0x58d6c3(0x175);break;case _0x58d6c3(0x164):_0x575115=_0x58d6c3(0x171);break;case'pending':_0x575115='PROCESSING';break;default:_0x575115=_0x58d6c3(0x171);break;}let _0x4ddb60;if(_0x5087cb[_0x58d6c3(0x150)])try{console['log']('ðŸ”—\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x5087cb[_0x58d6c3(0x150)]);let _0x3d1193;if(typeof _0x5087cb['tx_urls']===_0x58d6c3(0x16d))_0x3d1193=JSON[_0x58d6c3(0x174)](_0x5087cb[_0x58d6c3(0x150)]);else Array[_0x58d6c3(0x151)](_0x5087cb[_0x58d6c3(0x150)])?_0x3d1193=_0x5087cb[_0x58d6c3(0x150)]:_0x3d1193=[];_0x4ddb60=_0x3d1193['map'](_0x2ad020=>{const _0x376cf8=_0x58d6c3,_0x23d0c0=_0x2ad020[_0x376cf8(0x14c)](/\\/g,'');return console['log'](_0x376cf8(0x17a)+_0x2ad020+_0x376cf8(0x18c)+_0x23d0c0),_0x23d0c0;}),console[_0x58d6c3(0x13d)](_0x58d6c3(0x19b),_0x4ddb60),_0x4ddb60['forEach']((_0x43b2d8,_0x2cc20e)=>{const _0x21d9c3=_0x58d6c3;try{new URL(_0x43b2d8),console['log']('âœ…\x20URL\x20'+(_0x2cc20e+0x1)+_0x21d9c3(0x13a)+_0x43b2d8);}catch(_0x440824){console[_0x21d9c3(0x160)](_0x21d9c3(0x19d)+(_0x2cc20e+0x1)+_0x21d9c3(0x15f)+_0x43b2d8,_0x440824);}});}catch(_0x228344){console['error'](_0x58d6c3(0x181),_0x228344),console[_0x58d6c3(0x160)]('Raw\x20tx_urls\x20data:',_0x5087cb[_0x58d6c3(0x150)]),_0x4ddb60=undefined;}return{'paymentId':_0x5087cb[_0x58d6c3(0x1a1)]||'','status':_0x575115,'amount':_0x5087cb[_0x58d6c3(0x14a)],'currency':_0x5087cb['currency'],'txUrls':_0x4ddb60};}}function a68_0x35ab(_0x4bc3d6,_0x499088){_0x4bc3d6=_0x4bc3d6-0x130;const _0x300df3=a68_0x300d();let _0x35ab7d=_0x300df3[_0x4bc3d6];return _0x35ab7d;}exports[a68_0x2eda8a(0x163)]=PlisioService;