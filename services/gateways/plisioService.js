'use strict';const a44_0x18a371=a44_0x3caf;function a44_0x5ae0(){const _0x179798=['Status\x20Text:','Source\x20Currency:','Response\x20Time:','HTTP\x20Status:','qr_code','\x20->\x20','apiUrl','source_currency','plisio_direct','qr_url','HTTP\x20error!\x20status:\x20','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','replace','315919vWOxEJ','‚úÖ\x20URL\x20','PlisioService','defineProperty','Plisio\x20payment\x20verification\x20error:','Response\x20data:','now','invoice_url','/invoices/new','fromEntries','GET','URL:','‚úÖ\x20Processed\x20tx_urls:','statusText','application/json','Parameters:','\x20is\x20valid:\x20','../loggerService','status','Transaction\x20ID:','entries','===\x20PLISIO\x20SUCCESS\x20===','2394EsWeSh',',\x20body:\x20','JSON\x20Parse\x20Error:\x20','source_amount','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','log','email','Plisio\x20API\x20key\x20is\x20not\x20configured','Processing\x20Plisio\x20webhook:','Unknown\x20error','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','Full\x20URL\x20(without\x20API\x20key):','error','logWhiteDomainRequest','Status:','573447JKZkaX','json','/operations/','string','https://api.plisio.net/api/v1/invoices/new','591936tMnSoj','https://api.trapay.uk/api/webhooks/gateway/plisio','stringify','toLowerCase','cancelled','stack','10kpbHqg','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','toString','data','TesSoft\x20Payment\x20System/1.0','Plisio\x20API\x20error:\x20','PLISIO_API_KEY','processWebhook','success','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','currency','884024NPJADh','expired','createPayment','pending','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Raw\x20tx_urls\x20data:','Parsed\x20Result:','HTTP\x20','1432424QiRjXF','\x20is\x20invalid:\x20','__esModule','order_number','Target\x20Currency:','apiKey','‚ùå\x20URL\x20','Response\x20Body:','688NRGdcL','loggerService','logWhiteDomainError','Error\x20stack:','===\x20PLISIO\x20API\x20ERROR\x20===','Amount:','new','append','Error\x20message:','PENDING','tx_urls','(crypto\x20for\x20payment)','env','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Error\x20Message:','logWhiteDomainResponse','https://api.plisio.net/api/v1/operations/','üîó\x20Formatted\x20URL:\x20','map','parse','text','message','txn_id','amount','1543200EBpNEK','EXPIRED','Error\x20details:','Invoice\x20URL:'];a44_0x5ae0=function(){return _0x179798;};return a44_0x5ae0();}(function(_0x4bbb15,_0x427911){const _0x3a00fb=a44_0x3caf,_0x4e1a10=_0x4bbb15();while(!![]){try{const _0x49f141=-parseInt(_0x3a00fb(0xb6))/0x1+parseInt(_0x3a00fb(0x11c))/0x2+parseInt(_0x3a00fb(0xde))/0x3+-parseInt(_0x3a00fb(0xf4))/0x4+parseInt(_0x3a00fb(0xe9))/0x5*(parseInt(_0x3a00fb(0xe3))/0x6)+-parseInt(_0x3a00fb(0xfc))/0x7+parseInt(_0x3a00fb(0x104))/0x8*(parseInt(_0x3a00fb(0xcc))/0x9);if(_0x49f141===_0x427911)break;else _0x4e1a10['push'](_0x4e1a10['shift']());}catch(_0x14a9ce){_0x4e1a10['push'](_0x4e1a10['shift']());}}}(a44_0x5ae0,0x6bc24));Object[a44_0x18a371(0xb9)](exports,a44_0x18a371(0xfe),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a44_0x18a371(0xc7));function a44_0x3caf(_0x1eb5c2,_0x344cdb){const _0x5ae0d2=a44_0x5ae0();return a44_0x3caf=function(_0x3cafe1,_0x14345b){_0x3cafe1=_0x3cafe1-0xb5;let _0x34aaf8=_0x5ae0d2[_0x3cafe1];return _0x34aaf8;},a44_0x3caf(_0x1eb5c2,_0x344cdb);}class PlisioService{constructor(){const _0x2f4fea=a44_0x18a371;this[_0x2f4fea(0x126)]=_0x2f4fea(0xe2),this[_0x2f4fea(0x101)]=process[_0x2f4fea(0x110)][_0x2f4fea(0xef)]||'',!this[_0x2f4fea(0x101)]?console['warn'](_0x2f4fea(0x111)):console[_0x2f4fea(0xd4)](_0x2f4fea(0xd0));}async[a44_0x18a371(0xf6)](_0x29f250){const _0x182874=a44_0x18a371,{orderId:_0x4335b2,amount:_0x901db,currency:_0x2d391e,productName:_0x1c6850,description:_0x40698f,successUrl:_0x2784a3,failUrl:_0x559034,customerEmail:_0x5b9834,customerName:_0x424078,isSourceCurrency:_0x3dbb89,sourceCurrency:_0x32d009}=_0x29f250;if(!this[_0x182874(0x101)])throw new Error(_0x182874(0xd6));const _0x76b9b=new URLSearchParams({'api_key':this[_0x182874(0x101)],'order_number':_0x4335b2,'order_name':_0x1c6850,'description':_0x40698f,'success_url':_0x2784a3,'fail_url':_0x559034,'callback_url':_0x182874(0xe4)});_0x32d009?(_0x76b9b[_0x182874(0x10b)](_0x182874(0xf3),_0x32d009),_0x76b9b[_0x182874(0x10b)](_0x182874(0x127),_0x2d391e),_0x76b9b[_0x182874(0x10b)](_0x182874(0xcf),_0x901db['toString']())):(_0x76b9b[_0x182874(0x10b)](_0x182874(0xf3),_0x2d391e),_0x76b9b[_0x182874(0x10b)](_0x182874(0x11b),_0x901db[_0x182874(0xeb)]()));_0x5b9834&&_0x76b9b[_0x182874(0x10b)](_0x182874(0xd5),_0x5b9834);_0x424078&&_0x76b9b['append']('name',_0x424078);const _0xb5d3e=this[_0x182874(0x126)]+'?'+_0x76b9b[_0x182874(0xeb)](),_0x341bdc=Date['now']();try{console[_0x182874(0xd4)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x182874(0xd4)](_0x182874(0xc1),this[_0x182874(0x126)]),console[_0x182874(0xd4)](_0x182874(0xc5),Object[_0x182874(0xbf)](_0x76b9b['entries']())),console['log'](_0x182874(0xda),_0xb5d3e[_0x182874(0xb5)](this[_0x182874(0x101)],'HIDDEN')),loggerService_1['loggerService'][_0x182874(0xdc)]('plisio_direct','/invoices/new',_0x182874(0xc0),Object[_0x182874(0xbf)](_0x76b9b[_0x182874(0xca)]()));const _0x3bdccf=await fetch(_0xb5d3e,{'method':_0x182874(0xc0),'headers':{'Accept':_0x182874(0xc4),'User-Agent':_0x182874(0xed)}}),_0x25e2b5=Date[_0x182874(0xbc)]()-_0x341bdc;console[_0x182874(0xd4)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x182874(0xd4)](_0x182874(0xdd),_0x3bdccf[_0x182874(0xc8)]),console[_0x182874(0xd4)](_0x182874(0x120),_0x3bdccf[_0x182874(0xc3)]),console[_0x182874(0xd4)](_0x182874(0x122),_0x25e2b5+'ms');const _0x344cbc=await _0x3bdccf['text']();console[_0x182874(0xd4)]('Raw\x20Response\x20Body:',_0x344cbc);if(!_0x3bdccf['ok']){console[_0x182874(0xdb)](_0x182874(0x108)),console[_0x182874(0xdb)](_0x182874(0x123),_0x3bdccf[_0x182874(0xc8)]),console[_0x182874(0xdb)](_0x182874(0x103),_0x344cbc),loggerService_1[_0x182874(0x105)][_0x182874(0x113)]('plisio_direct',_0x182874(0xbe),_0x3bdccf['status'],_0x344cbc,_0x25e2b5),loggerService_1[_0x182874(0x105)][_0x182874(0x106)](_0x182874(0x128),_0x182874(0xbe),_0x182874(0xfb)+_0x3bdccf[_0x182874(0xc8)]+':\x20'+_0x344cbc);throw new Error(_0x182874(0x12a)+_0x3bdccf[_0x182874(0xc8)]+_0x182874(0xcd)+_0x344cbc);}let _0x482c1c;try{_0x482c1c=JSON[_0x182874(0x117)](_0x344cbc);}catch(_0x331771){console[_0x182874(0xdb)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x331771),loggerService_1[_0x182874(0x105)][_0x182874(0x106)](_0x182874(0x128),_0x182874(0xbe),_0x182874(0xce)+_0x331771);throw new Error(_0x182874(0xf8)+_0x344cbc);}console[_0x182874(0xd4)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x182874(0xd4)](_0x182874(0xfa),JSON[_0x182874(0xe5)](_0x482c1c,null,0x2)),loggerService_1[_0x182874(0x105)]['logWhiteDomainResponse'](_0x182874(0x128),_0x182874(0xbe),_0x3bdccf['status'],_0x482c1c,_0x25e2b5);if(_0x482c1c[_0x182874(0xc8)]!==_0x182874(0xf1)){const _0x206bbe=_0x482c1c[_0x182874(0x119)]||_0x482c1c[_0x182874(0xdb)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x182874(0xdb)](_0x182874(0xd3)),console[_0x182874(0xdb)](_0x182874(0x112),_0x206bbe),loggerService_1[_0x182874(0x105)][_0x182874(0x106)](_0x182874(0x128),_0x182874(0xbe),'Business\x20Error:\x20'+_0x206bbe);throw new Error('Plisio\x20API\x20error:\x20'+_0x206bbe);}if(!_0x482c1c[_0x182874(0xec)]?.[_0x182874(0x11a)]||!_0x482c1c[_0x182874(0xec)]?.[_0x182874(0xbd)]){console[_0x182874(0xdb)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x182874(0xdb)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x182874(0xdb)](_0x182874(0xbb),_0x482c1c[_0x182874(0xec)]),loggerService_1[_0x182874(0x105)][_0x182874(0x106)](_0x182874(0x128),'/invoices/new',_0x182874(0xd1));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x182874(0xd4)](_0x182874(0xcb)),console[_0x182874(0xd4)](_0x182874(0xc9),_0x482c1c[_0x182874(0xec)][_0x182874(0x11a)]),console['log'](_0x182874(0x11f),_0x482c1c[_0x182874(0xec)]['invoice_url']),console[_0x182874(0xd4)](_0x182874(0x109),_0x901db,_0x2d391e),_0x32d009&&(console[_0x182874(0xd4)](_0x182874(0x121),_0x32d009,_0x182874(0x10f)),console['log'](_0x182874(0x100),_0x2d391e,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x482c1c[_0x182874(0xec)][_0x182874(0x11a)],'payment_url':_0x482c1c['data'][_0x182874(0xbd)],'invoice_total_sum':_0x482c1c[_0x182874(0xec)]['invoice_total_sum'],'qr_code':_0x482c1c[_0x182874(0xec)][_0x182874(0x124)],'qr_url':_0x482c1c[_0x182874(0xec)][_0x182874(0x129)]};}catch(_0x471d1b){console[_0x182874(0xdb)](_0x182874(0x12b)),console['error'](_0x182874(0x11e),_0x471d1b),loggerService_1[_0x182874(0x105)][_0x182874(0x106)](_0x182874(0x128),_0x182874(0xbe),_0x471d1b);if(_0x471d1b instanceof Error){console['error'](_0x182874(0x10c),_0x471d1b[_0x182874(0x119)]),console['error'](_0x182874(0x107),_0x471d1b[_0x182874(0xe8)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x471d1b[_0x182874(0x119)]);}throw new Error(_0x182874(0xea));}}async['verifyPayment'](_0x4d1ceb){const _0x3c7afd=a44_0x18a371,_0x5b545d=Date[_0x3c7afd(0xbc)]();try{if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x100712=new URLSearchParams({'api_key':this[_0x3c7afd(0x101)],'txn_id':_0x4d1ceb}),_0x2daf04=_0x3c7afd(0x114)+_0x4d1ceb+'?'+_0x100712['toString']();loggerService_1['loggerService'][_0x3c7afd(0xdc)](_0x3c7afd(0x128),_0x3c7afd(0xe0)+_0x4d1ceb,'GET',Object['fromEntries'](_0x100712[_0x3c7afd(0xca)]()));const _0x45eb3f=await fetch(_0x2daf04,{'method':_0x3c7afd(0xc0),'headers':{'Accept':'application/json','User-Agent':_0x3c7afd(0xed)}}),_0x279eda=Date['now']()-_0x5b545d;if(!_0x45eb3f['ok']){const _0xa43c74=await _0x45eb3f[_0x3c7afd(0x118)]();loggerService_1[_0x3c7afd(0x105)][_0x3c7afd(0x113)](_0x3c7afd(0x128),_0x3c7afd(0xe0)+_0x4d1ceb,_0x45eb3f[_0x3c7afd(0xc8)],_0xa43c74,_0x279eda);throw new Error(_0x3c7afd(0x12a)+_0x45eb3f[_0x3c7afd(0xc8)]);}const _0x3d151c=await _0x45eb3f[_0x3c7afd(0xdf)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3c7afd(0x128),_0x3c7afd(0xe0)+_0x4d1ceb,_0x45eb3f[_0x3c7afd(0xc8)],_0x3d151c,_0x279eda);if(_0x3d151c[_0x3c7afd(0xc8)]!==_0x3c7afd(0xf1)){loggerService_1[_0x3c7afd(0x105)][_0x3c7afd(0x106)](_0x3c7afd(0x128),'/operations/'+_0x4d1ceb,_0x3c7afd(0xee)+(_0x3d151c[_0x3c7afd(0x119)]||_0x3d151c['error']||_0x3c7afd(0xd8)));throw new Error(_0x3c7afd(0xee)+(_0x3d151c[_0x3c7afd(0x119)]||_0x3d151c['error']||'Unknown\x20error'));}let _0x122509=_0x3c7afd(0x10d);return{'status':_0x122509};}catch(_0x5ec293){console[_0x3c7afd(0xdb)](_0x3c7afd(0xba),_0x5ec293),loggerService_1[_0x3c7afd(0x105)][_0x3c7afd(0x106)](_0x3c7afd(0x128),_0x3c7afd(0xe0)+_0x4d1ceb,_0x5ec293);throw new Error(_0x3c7afd(0xd2)+(_0x5ec293 instanceof Error?_0x5ec293[_0x3c7afd(0x119)]:_0x3c7afd(0xd8)));}}async[a44_0x18a371(0xf0)](_0x4b3aab){const _0x43ddb3=a44_0x18a371;console['log'](_0x43ddb3(0xd7),_0x4b3aab);let _0x540f70='PENDING';switch(_0x4b3aab[_0x43ddb3(0xc8)]?.[_0x43ddb3(0xe6)]()){case'completed':case'mismatch':_0x540f70='PAID';break;case _0x43ddb3(0xf5):_0x540f70=_0x43ddb3(0x11d);break;case'error':case _0x43ddb3(0xe7):_0x540f70='FAILED';break;case _0x43ddb3(0x10a):case _0x43ddb3(0xf7):default:_0x540f70=_0x43ddb3(0x10d);break;}let _0x2a981b;if(_0x4b3aab[_0x43ddb3(0x10e)])try{console[_0x43ddb3(0xd4)](_0x43ddb3(0xf2),_0x4b3aab[_0x43ddb3(0x10e)]);let _0x1cb71e;if(typeof _0x4b3aab[_0x43ddb3(0x10e)]===_0x43ddb3(0xe1))_0x1cb71e=JSON['parse'](_0x4b3aab['tx_urls']);else Array['isArray'](_0x4b3aab[_0x43ddb3(0x10e)])?_0x1cb71e=_0x4b3aab['tx_urls']:_0x1cb71e=[];_0x2a981b=_0x1cb71e[_0x43ddb3(0x116)](_0x24dcdd=>{const _0x1feac3=_0x43ddb3,_0x40e36f=_0x24dcdd[_0x1feac3(0xb5)](/\\/g,'');return console[_0x1feac3(0xd4)](_0x1feac3(0x115)+_0x24dcdd+_0x1feac3(0x125)+_0x40e36f),_0x40e36f;}),console[_0x43ddb3(0xd4)](_0x43ddb3(0xc2),_0x2a981b),_0x2a981b['forEach']((_0x4bed,_0x3d7f6a)=>{const _0x167e01=_0x43ddb3;try{new URL(_0x4bed),console[_0x167e01(0xd4)](_0x167e01(0xb7)+(_0x3d7f6a+0x1)+_0x167e01(0xc6)+_0x4bed);}catch(_0x3c991d){console[_0x167e01(0xdb)](_0x167e01(0x102)+(_0x3d7f6a+0x1)+_0x167e01(0xfd)+_0x4bed,_0x3c991d);}});}catch(_0x489df1){console['error'](_0x43ddb3(0xd9),_0x489df1),console[_0x43ddb3(0xdb)](_0x43ddb3(0xf9),_0x4b3aab[_0x43ddb3(0x10e)]),_0x2a981b=undefined;}return{'paymentId':_0x4b3aab[_0x43ddb3(0xff)]||'','status':_0x540f70,'amount':_0x4b3aab[_0x43ddb3(0x11b)],'currency':_0x4b3aab[_0x43ddb3(0xf3)],'txUrls':_0x2a981b};}}exports[a44_0x18a371(0xb8)]=PlisioService;