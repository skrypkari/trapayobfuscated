'use strict';const a66_0x52e1fb=a66_0x5720;(function(_0x23767e,_0x1db3e2){const _0x3b0340=a66_0x5720,_0x5a25c6=_0x23767e();while(!![]){try{const _0x210af5=parseInt(_0x3b0340(0x161))/0x1*(-parseInt(_0x3b0340(0x1bf))/0x2)+-parseInt(_0x3b0340(0x1c8))/0x3*(parseInt(_0x3b0340(0x1af))/0x4)+-parseInt(_0x3b0340(0x19d))/0x5+-parseInt(_0x3b0340(0x1ae))/0x6*(parseInt(_0x3b0340(0x17d))/0x7)+parseInt(_0x3b0340(0x1cb))/0x8+-parseInt(_0x3b0340(0x19e))/0x9+parseInt(_0x3b0340(0x196))/0xa*(parseInt(_0x3b0340(0x1b2))/0xb);if(_0x210af5===_0x1db3e2)break;else _0x5a25c6['push'](_0x5a25c6['shift']());}catch(_0x55b1de){_0x5a25c6['push'](_0x5a25c6['shift']());}}}(a66_0x4c21,0xba446));function a66_0x4c21(){const _0x4baf81=['Processing\x20Plisio\x20webhook:','JSON\x20Parse\x20Error:\x20','name','Status\x20Text:','Unknown\x20error','amount','__esModule','logWhiteDomainError','map','4361QvHgiW','/operations/','apiKey','(crypto\x20for\x20payment)','https://api.trapay.uk/api/webhooks/gateway/plisio','Full\x20URL\x20(without\x20API\x20key):','\x20->\x20','now','completed','data','\x20is\x20valid:\x20','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','invoice_url','json','string','forEach','txn_id','Target\x20Currency:','parse','PLISIO_API_KEY','===\x20PLISIO\x20API\x20ERROR\x20===','env','Parsed\x20Result:','status','isArray','5410tIHVOY','logWhiteDomainRequest','Raw\x20Response\x20Body:','append','new','âŒ\x20Failed\x20to\x20parse\x20tx_urls:','Raw\x20tx_urls\x20data:','6894770GYEnDy','65367TjoDAY','ðŸ”—\x20Raw\x20tx_urls\x20from\x20Plisio:','PAID','plisio_direct','Amount:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','log','loggerService','https://api.plisio.net/api/v1/operations/','stack','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','verifyPayment','invoice_total_sum','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','\x20is\x20invalid:\x20','warn','1242aBohMU','9032hsicvS','Invoice\x20URL:','âš ï¸\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','66011TBDvie','order_number','entries','qr_code','Failed\x20to\x20create\x20Plisio\x20payment:\x20','PENDING','GET','Plisio\x20API\x20key\x20is\x20not\x20configured','Response\x20Body:','success','(fiat\x20for\x20merchant)','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','mismatch','1568602hkjdvl','apiUrl','/invoices/new','error','PROCESSING','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','PlisioService','email','source_currency','699WeRQlD','message','Error\x20stack:','2736016VvBvRd','Payment\x20System/1.0','Unknown\x20error\x20from\x20Plisio\x20API','Plisio\x20API\x20error:\x20','HTTP\x20error!\x20status:\x20','HTTP\x20','currency','application/json','toString','1psrVHU','https://api.plisio.net/api/v1/invoices/new','text','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','pending','Source\x20Currency:','logWhiteDomainResponse','source_amount','toLowerCase','Plisio\x20payment\x20verification\x20error:','âŒ\x20URL\x20','URL:','statusText','cancelled','createPayment','replace','===\x20PLISIO\x20SUCCESS\x20===','stringify','tx_urls'];a66_0x4c21=function(){return _0x4baf81;};return a66_0x4c21();}Object['defineProperty'](exports,a66_0x52e1fb(0x17a),{'value':!![]}),exports[a66_0x52e1fb(0x1c5)]=void 0x0;function a66_0x5720(_0x3ba930,_0x5fd3bf){_0x3ba930=_0x3ba930-0x15f;const _0x4c2159=a66_0x4c21();let _0x5720c8=_0x4c2159[_0x3ba930];return _0x5720c8;}const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x1b8d17=a66_0x52e1fb;this[_0x1b8d17(0x1c0)]=_0x1b8d17(0x162),this[_0x1b8d17(0x17f)]=process[_0x1b8d17(0x192)][_0x1b8d17(0x190)]||'',!this[_0x1b8d17(0x17f)]?console[_0x1b8d17(0x1ad)](_0x1b8d17(0x1b1)):console[_0x1b8d17(0x1a4)]('ðŸ’°\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a66_0x52e1fb(0x16f)](_0x5a9105){const _0x382ae1=a66_0x52e1fb,{orderId:_0x3e05a2,amount:_0x222812,currency:_0x258c31,productName:_0x3fe03f,description:_0x540e96,successUrl:_0x126f86,failUrl:_0x51411c,customerEmail:_0xec0cb6,customerName:_0x2598f4,isSourceCurrency:_0x411059,sourceCurrency:_0x444c91}=_0x5a9105;if(!this[_0x382ae1(0x17f)])throw new Error(_0x382ae1(0x1b9));const _0x4f312d=new URLSearchParams({'api_key':this[_0x382ae1(0x17f)],'order_number':_0x3e05a2,'order_name':_0x3fe03f,'description':_0x540e96,'success_url':_0x126f86,'fail_url':_0x51411c,'callback_url':_0x382ae1(0x181)});_0x444c91?(_0x4f312d[_0x382ae1(0x199)](_0x382ae1(0x1d1),_0x444c91),_0x4f312d[_0x382ae1(0x199)](_0x382ae1(0x1c7),_0x258c31),_0x4f312d['append'](_0x382ae1(0x168),_0x222812[_0x382ae1(0x160)]())):(_0x4f312d[_0x382ae1(0x199)](_0x382ae1(0x1d1),_0x258c31),_0x4f312d[_0x382ae1(0x199)](_0x382ae1(0x179),_0x222812[_0x382ae1(0x160)]()));_0xec0cb6&&_0x4f312d[_0x382ae1(0x199)](_0x382ae1(0x1c6),_0xec0cb6);_0x2598f4&&_0x4f312d[_0x382ae1(0x199)](_0x382ae1(0x176),_0x2598f4);const _0x1690e9=this[_0x382ae1(0x1c0)]+'?'+_0x4f312d[_0x382ae1(0x160)](),_0x3b8d20=Date[_0x382ae1(0x184)]();try{console[_0x382ae1(0x1a4)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x382ae1(0x1a4)](_0x382ae1(0x16c),this[_0x382ae1(0x1c0)]),console['log']('Parameters:',Object['fromEntries'](_0x4f312d['entries']())),console[_0x382ae1(0x1a4)](_0x382ae1(0x182),_0x1690e9['replace'](this[_0x382ae1(0x17f)],'HIDDEN')),loggerService_1[_0x382ae1(0x1a5)][_0x382ae1(0x197)](_0x382ae1(0x1a1),_0x382ae1(0x1c1),_0x382ae1(0x1b8),Object['fromEntries'](_0x4f312d[_0x382ae1(0x1b4)]()));const _0x4e6740=await fetch(_0x1690e9,{'method':_0x382ae1(0x1b8),'headers':{'Accept':_0x382ae1(0x15f),'User-Agent':_0x382ae1(0x1cc)}}),_0x3e2dcb=Date[_0x382ae1(0x184)]()-_0x3b8d20;console[_0x382ae1(0x1a4)](_0x382ae1(0x188)),console[_0x382ae1(0x1a4)]('Status:',_0x4e6740[_0x382ae1(0x194)]),console[_0x382ae1(0x1a4)](_0x382ae1(0x177),_0x4e6740[_0x382ae1(0x16d)]),console[_0x382ae1(0x1a4)]('Response\x20Time:',_0x3e2dcb+'ms');const _0x3918df=await _0x4e6740[_0x382ae1(0x163)]();console['log'](_0x382ae1(0x198),_0x3918df);if(!_0x4e6740['ok']){console['error'](_0x382ae1(0x191)),console[_0x382ae1(0x1c2)]('HTTP\x20Status:',_0x4e6740[_0x382ae1(0x194)]),console['error'](_0x382ae1(0x1ba),_0x3918df),loggerService_1[_0x382ae1(0x1a5)][_0x382ae1(0x167)](_0x382ae1(0x1a1),_0x382ae1(0x1c1),_0x4e6740[_0x382ae1(0x194)],_0x3918df,_0x3e2dcb),loggerService_1[_0x382ae1(0x1a5)]['logWhiteDomainError']('plisio_direct',_0x382ae1(0x1c1),_0x382ae1(0x1d0)+_0x4e6740[_0x382ae1(0x194)]+':\x20'+_0x3918df);throw new Error(_0x382ae1(0x1cf)+_0x4e6740[_0x382ae1(0x194)]+',\x20body:\x20'+_0x3918df);}let _0x3c5968;try{_0x3c5968=JSON[_0x382ae1(0x18f)](_0x3918df);}catch(_0x54f517){console[_0x382ae1(0x1c2)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x54f517),loggerService_1['loggerService'][_0x382ae1(0x17b)]('plisio_direct',_0x382ae1(0x1c1),_0x382ae1(0x175)+_0x54f517);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x3918df);}console[_0x382ae1(0x1a4)](_0x382ae1(0x1c4)),console[_0x382ae1(0x1a4)](_0x382ae1(0x193),JSON[_0x382ae1(0x172)](_0x3c5968,null,0x2)),loggerService_1[_0x382ae1(0x1a5)]['logWhiteDomainResponse'](_0x382ae1(0x1a1),_0x382ae1(0x1c1),_0x4e6740['status'],_0x3c5968,_0x3e2dcb);if(_0x3c5968[_0x382ae1(0x194)]!==_0x382ae1(0x1bb)){const _0x155930=_0x3c5968['message']||_0x3c5968[_0x382ae1(0x1c2)]||_0x382ae1(0x1cd);console[_0x382ae1(0x1c2)](_0x382ae1(0x1a8)),console[_0x382ae1(0x1c2)]('Error\x20Message:',_0x155930),loggerService_1[_0x382ae1(0x1a5)][_0x382ae1(0x17b)](_0x382ae1(0x1a1),_0x382ae1(0x1c1),'Business\x20Error:\x20'+_0x155930);throw new Error(_0x382ae1(0x1ce)+_0x155930);}if(!_0x3c5968[_0x382ae1(0x186)]?.['txn_id']||!_0x3c5968[_0x382ae1(0x186)]?.[_0x382ae1(0x189)]){console[_0x382ae1(0x1c2)](_0x382ae1(0x1ab)),console[_0x382ae1(0x1c2)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console['error']('Response\x20data:',_0x3c5968[_0x382ae1(0x186)]),loggerService_1[_0x382ae1(0x1a5)][_0x382ae1(0x17b)](_0x382ae1(0x1a1),'/invoices/new','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x382ae1(0x1a3));}return console[_0x382ae1(0x1a4)](_0x382ae1(0x171)),console[_0x382ae1(0x1a4)]('Transaction\x20ID:',_0x3c5968[_0x382ae1(0x186)][_0x382ae1(0x18d)]),console['log'](_0x382ae1(0x1b0),_0x3c5968['data']['invoice_url']),console[_0x382ae1(0x1a4)](_0x382ae1(0x1a2),_0x222812,_0x258c31),_0x444c91&&(console[_0x382ae1(0x1a4)](_0x382ae1(0x166),_0x444c91,_0x382ae1(0x180)),console[_0x382ae1(0x1a4)](_0x382ae1(0x18e),_0x258c31,_0x382ae1(0x1bc))),{'gateway_payment_id':_0x3c5968[_0x382ae1(0x186)]['txn_id'],'payment_url':_0x3c5968[_0x382ae1(0x186)][_0x382ae1(0x189)],'invoice_total_sum':_0x3c5968['data'][_0x382ae1(0x1aa)],'qr_code':_0x3c5968['data'][_0x382ae1(0x1b5)],'qr_url':_0x3c5968['data']['qr_url']};}catch(_0x3129dc){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x382ae1(0x1c2)]('Error\x20details:',_0x3129dc),loggerService_1[_0x382ae1(0x1a5)][_0x382ae1(0x17b)](_0x382ae1(0x1a1),_0x382ae1(0x1c1),_0x3129dc);if(_0x3129dc instanceof Error){console[_0x382ae1(0x1c2)]('Error\x20message:',_0x3129dc[_0x382ae1(0x1c9)]),console['error'](_0x382ae1(0x1ca),_0x3129dc[_0x382ae1(0x1a7)]);throw new Error(_0x382ae1(0x1b6)+_0x3129dc[_0x382ae1(0x1c9)]);}throw new Error(_0x382ae1(0x1bd));}}async[a66_0x52e1fb(0x1a9)](_0x2f7a03){const _0x1a7f4c=a66_0x52e1fb,_0x5d2e98=Date['now']();try{if(!this['apiKey'])throw new Error(_0x1a7f4c(0x1b9));const _0x3e1f54=new URLSearchParams({'api_key':this[_0x1a7f4c(0x17f)],'txn_id':_0x2f7a03}),_0x3c2c8e=_0x1a7f4c(0x1a6)+_0x2f7a03+'?'+_0x3e1f54[_0x1a7f4c(0x160)]();loggerService_1[_0x1a7f4c(0x1a5)]['logWhiteDomainRequest'](_0x1a7f4c(0x1a1),_0x1a7f4c(0x17e)+_0x2f7a03,_0x1a7f4c(0x1b8),Object['fromEntries'](_0x3e1f54['entries']()));const _0x3c89e7=await fetch(_0x3c2c8e,{'method':_0x1a7f4c(0x1b8),'headers':{'Accept':_0x1a7f4c(0x15f),'User-Agent':_0x1a7f4c(0x1cc)}}),_0x2fa23b=Date['now']()-_0x5d2e98;if(!_0x3c89e7['ok']){const _0x1f018e=await _0x3c89e7[_0x1a7f4c(0x163)]();loggerService_1[_0x1a7f4c(0x1a5)][_0x1a7f4c(0x167)](_0x1a7f4c(0x1a1),_0x1a7f4c(0x17e)+_0x2f7a03,_0x3c89e7[_0x1a7f4c(0x194)],_0x1f018e,_0x2fa23b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3c89e7[_0x1a7f4c(0x194)]);}const _0xb6b9f9=await _0x3c89e7[_0x1a7f4c(0x18a)]();loggerService_1['loggerService'][_0x1a7f4c(0x167)](_0x1a7f4c(0x1a1),'/operations/'+_0x2f7a03,_0x3c89e7[_0x1a7f4c(0x194)],_0xb6b9f9,_0x2fa23b);if(_0xb6b9f9[_0x1a7f4c(0x194)]!==_0x1a7f4c(0x1bb)){loggerService_1[_0x1a7f4c(0x1a5)][_0x1a7f4c(0x17b)](_0x1a7f4c(0x1a1),_0x1a7f4c(0x17e)+_0x2f7a03,_0x1a7f4c(0x1ce)+(_0xb6b9f9[_0x1a7f4c(0x1c9)]||_0xb6b9f9[_0x1a7f4c(0x1c2)]||_0x1a7f4c(0x178)));throw new Error(_0x1a7f4c(0x1ce)+(_0xb6b9f9[_0x1a7f4c(0x1c9)]||_0xb6b9f9[_0x1a7f4c(0x1c2)]||_0x1a7f4c(0x178)));}let _0x56ff74=_0x1a7f4c(0x1b7);return{'status':_0x56ff74};}catch(_0x1da053){console['error'](_0x1a7f4c(0x16a),_0x1da053),loggerService_1[_0x1a7f4c(0x1a5)][_0x1a7f4c(0x17b)](_0x1a7f4c(0x1a1),'/operations/'+_0x2f7a03,_0x1da053);throw new Error(_0x1a7f4c(0x164)+(_0x1da053 instanceof Error?_0x1da053[_0x1a7f4c(0x1c9)]:'Unknown\x20error'));}}async['processWebhook'](_0x41fec4){const _0x371b7f=a66_0x52e1fb;console[_0x371b7f(0x1a4)](_0x371b7f(0x174),_0x41fec4);let _0x4aa808=_0x371b7f(0x1b7);switch(_0x41fec4[_0x371b7f(0x194)]?.[_0x371b7f(0x169)]()){case _0x371b7f(0x185):case _0x371b7f(0x1be):_0x4aa808=_0x371b7f(0x1a0);break;case'expired':_0x4aa808='EXPIRED';break;case _0x371b7f(0x1c2):case _0x371b7f(0x16e):_0x4aa808='FAILED';break;case _0x371b7f(0x19a):_0x4aa808=_0x371b7f(0x1b7);break;case _0x371b7f(0x165):_0x4aa808=_0x371b7f(0x1c3);break;default:_0x4aa808=_0x371b7f(0x1b7);break;}let _0x3fa212;if(_0x41fec4[_0x371b7f(0x173)])try{console['log'](_0x371b7f(0x19f),_0x41fec4[_0x371b7f(0x173)]);let _0x540772;if(typeof _0x41fec4[_0x371b7f(0x173)]===_0x371b7f(0x18b))_0x540772=JSON[_0x371b7f(0x18f)](_0x41fec4['tx_urls']);else Array[_0x371b7f(0x195)](_0x41fec4[_0x371b7f(0x173)])?_0x540772=_0x41fec4[_0x371b7f(0x173)]:_0x540772=[];_0x3fa212=_0x540772[_0x371b7f(0x17c)](_0x4f2d4e=>{const _0x4ba361=_0x371b7f,_0x5cab21=_0x4f2d4e[_0x4ba361(0x170)](/\\/g,'');return console[_0x4ba361(0x1a4)]('ðŸ”—\x20Formatted\x20URL:\x20'+_0x4f2d4e+_0x4ba361(0x183)+_0x5cab21),_0x5cab21;}),console[_0x371b7f(0x1a4)]('âœ…\x20Processed\x20tx_urls:',_0x3fa212),_0x3fa212[_0x371b7f(0x18c)]((_0x842212,_0x53f8e6)=>{const _0x38580b=_0x371b7f;try{new URL(_0x842212),console['log']('âœ…\x20URL\x20'+(_0x53f8e6+0x1)+_0x38580b(0x187)+_0x842212);}catch(_0xba7de4){console[_0x38580b(0x1c2)](_0x38580b(0x16b)+(_0x53f8e6+0x1)+_0x38580b(0x1ac)+_0x842212,_0xba7de4);}});}catch(_0xeb2fbd){console[_0x371b7f(0x1c2)](_0x371b7f(0x19b),_0xeb2fbd),console[_0x371b7f(0x1c2)](_0x371b7f(0x19c),_0x41fec4[_0x371b7f(0x173)]),_0x3fa212=undefined;}return{'paymentId':_0x41fec4[_0x371b7f(0x1b3)]||'','status':_0x4aa808,'amount':_0x41fec4['amount'],'currency':_0x41fec4[_0x371b7f(0x1d1)],'txUrls':_0x3fa212};}}exports[a66_0x52e1fb(0x1c5)]=PlisioService;