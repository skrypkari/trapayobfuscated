'use strict';const a47_0x38f763=a47_0x3caa;(function(_0x3261ae,_0x3bbb47){const _0xe930a3=a47_0x3caa,_0x13355c=_0x3261ae();while(!![]){try{const _0x5bfeaf=-parseInt(_0xe930a3(0x194))/0x1+parseInt(_0xe930a3(0x195))/0x2*(parseInt(_0xe930a3(0x1a2))/0x3)+parseInt(_0xe930a3(0x19c))/0x4+-parseInt(_0xe930a3(0x19f))/0x5+parseInt(_0xe930a3(0x16c))/0x6+-parseInt(_0xe930a3(0x199))/0x7+parseInt(_0xe930a3(0x1b7))/0x8*(parseInt(_0xe930a3(0x1c2))/0x9);if(_0x5bfeaf===_0x3bbb47)break;else _0x13355c['push'](_0x13355c['shift']());}catch(_0x2fc1e3){_0x13355c['push'](_0x13355c['shift']());}}}(a47_0x3daa,0x4678c));function a47_0x3caa(_0xea67a4,_0x1b3adf){const _0x3daaab=a47_0x3daa();return a47_0x3caa=function(_0x3caa7e,_0x1113b8){_0x3caa7e=_0x3caa7e-0x16c;let _0x338897=_0x3daaab[_0x3caa7e];return _0x338897;},a47_0x3caa(_0xea67a4,_0x1b3adf);}Object['defineProperty'](exports,a47_0x38f763(0x1c5),{'value':!![]}),exports[a47_0x38f763(0x1b8)]=void 0x0;const loggerService_1=require(a47_0x38f763(0x186));function a47_0x3daa(){const _0x5018e8=['PLISIO_API_KEY','env','invoice_total_sum','Parameters:','558152QaSmeB','2uBHWNb','GET','logWhiteDomainResponse','tx_urls','3510808nMrAiy','apiUrl','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','330980axtvVo','Plisio\x20API\x20key\x20is\x20not\x20configured','replace','1656615fYwpAM','qr_code','text','360309ojdUqi','TesSoft\x20Payment\x20System/1.0','Full\x20URL\x20(without\x20API\x20key):','Response\x20Time:','===\x20PLISIO\x20SUCCESS\x20===','Error\x20details:','Failed\x20to\x20parse\x20JSON\x20response:','https://api.plisio.net/api/v1/operations/','processWebhook','source_currency','expired','parse','entries','message','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','HIDDEN','Transaction\x20ID:',',\x20body:\x20','/operations/','data','log','16odawPY','PlisioService','error','Target\x20Currency:','currency','Plisio\x20API\x20error:\x20','\x20->\x20','Unknown\x20error\x20from\x20Plisio\x20API','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','apiKey','FAILED','5115303YdkLHZ','Raw\x20Response\x20Body:','EXPIRED','__esModule','name','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','warn','statusText','‚úÖ\x20Processed\x20tx_urls:','fromEntries','PROCESSING','Processing\x20Plisio\x20webhook:','now','toString','completed','logWhiteDomainError','logWhiteDomainRequest','Response\x20Body:','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Status:','Error\x20Message:','Source\x20Currency:','order_number','Raw\x20tx_urls\x20data:','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','pending','amount','plisio_direct','toLowerCase','‚ùå\x20URL\x20','/invoices/new','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','2040534oOaOqb','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','forEach','map','new','https://api.plisio.net/api/v1/invoices/new','source_amount','application/json','Failed\x20to\x20create\x20Plisio\x20payment:\x20','https://api.trapay.uk/api/webhooks/gateway/plisio','mismatch','HTTP\x20','json','PENDING','stringify','success','loggerService','PAID','status','Amount:','txn_id','verifyPayment','invoice_url','isArray','Business\x20Error:\x20','../loggerService','cancelled','createPayment','Unknown\x20error','append','\x20is\x20valid:\x20','üîó\x20Formatted\x20URL:\x20','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','\x20is\x20invalid:\x20','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'];a47_0x3daa=function(){return _0x5018e8;};return a47_0x3daa();}class PlisioService{constructor(){const _0x1f68c4=a47_0x38f763;this[_0x1f68c4(0x19a)]=_0x1f68c4(0x172),this[_0x1f68c4(0x1c0)]=process[_0x1f68c4(0x191)][_0x1f68c4(0x190)]||'',!this[_0x1f68c4(0x1c0)]?console[_0x1f68c4(0x1c8)]('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x1f68c4(0x1b6)](_0x1f68c4(0x19b));}async[a47_0x38f763(0x188)](_0x49c101){const _0x5fb325=a47_0x38f763,{orderId:_0x5884c7,amount:_0x16aeaf,currency:_0x3eab93,productName:_0x5a1590,description:_0x92aa22,successUrl:_0x210f5b,failUrl:_0x236a82,customerEmail:_0x27c16d,customerName:_0x487cc6,isSourceCurrency:_0x48cbc7,sourceCurrency:_0x258e29}=_0x49c101;if(!this[_0x5fb325(0x1c0)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x33fd79=new URLSearchParams({'api_key':this[_0x5fb325(0x1c0)],'order_number':_0x5884c7,'order_name':_0x5a1590,'description':_0x92aa22,'success_url':_0x210f5b,'fail_url':_0x236a82,'callback_url':_0x5fb325(0x176)});_0x258e29?(_0x33fd79['append'](_0x5fb325(0x1bb),_0x258e29),_0x33fd79[_0x5fb325(0x18a)](_0x5fb325(0x1ab),_0x3eab93),_0x33fd79[_0x5fb325(0x18a)](_0x5fb325(0x173),_0x16aeaf[_0x5fb325(0x1cf)]())):(_0x33fd79['append'](_0x5fb325(0x1bb),_0x3eab93),_0x33fd79[_0x5fb325(0x18a)]('amount',_0x16aeaf[_0x5fb325(0x1cf)]()));_0x27c16d&&_0x33fd79['append']('email',_0x27c16d);_0x487cc6&&_0x33fd79[_0x5fb325(0x18a)](_0x5fb325(0x1c6),_0x487cc6);const _0x16f3d5=this[_0x5fb325(0x19a)]+'?'+_0x33fd79[_0x5fb325(0x1cf)](),_0x514e30=Date[_0x5fb325(0x1ce)]();try{console[_0x5fb325(0x1b6)](_0x5fb325(0x1bf)),console[_0x5fb325(0x1b6)]('URL:',this[_0x5fb325(0x19a)]),console['log'](_0x5fb325(0x193),Object[_0x5fb325(0x1cb)](_0x33fd79[_0x5fb325(0x1ae)]())),console[_0x5fb325(0x1b6)](_0x5fb325(0x1a4),_0x16f3d5['replace'](this['apiKey'],_0x5fb325(0x1b1))),loggerService_1[_0x5fb325(0x17d)][_0x5fb325(0x1d2)](_0x5fb325(0x1de),_0x5fb325(0x1e1),'GET',Object[_0x5fb325(0x1cb)](_0x33fd79[_0x5fb325(0x1ae)]()));const _0x93384d=await fetch(_0x16f3d5,{'method':_0x5fb325(0x196),'headers':{'Accept':_0x5fb325(0x174),'User-Agent':_0x5fb325(0x1a3)}}),_0x3a0a39=Date[_0x5fb325(0x1ce)]()-_0x514e30;console[_0x5fb325(0x1b6)](_0x5fb325(0x1c7)),console[_0x5fb325(0x1b6)](_0x5fb325(0x1d5),_0x93384d['status']),console[_0x5fb325(0x1b6)]('Status\x20Text:',_0x93384d[_0x5fb325(0x1c9)]),console[_0x5fb325(0x1b6)](_0x5fb325(0x1a5),_0x3a0a39+'ms');const _0x164ef8=await _0x93384d[_0x5fb325(0x1a1)]();console['log'](_0x5fb325(0x1c3),_0x164ef8);if(!_0x93384d['ok']){console['error']('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x5fb325(0x1b9)]('HTTP\x20Status:',_0x93384d[_0x5fb325(0x17f)]),console[_0x5fb325(0x1b9)](_0x5fb325(0x1d3),_0x164ef8),loggerService_1[_0x5fb325(0x17d)][_0x5fb325(0x197)](_0x5fb325(0x1de),_0x5fb325(0x1e1),_0x93384d[_0x5fb325(0x17f)],_0x164ef8,_0x3a0a39),loggerService_1['loggerService'][_0x5fb325(0x1d1)](_0x5fb325(0x1de),_0x5fb325(0x1e1),_0x5fb325(0x178)+_0x93384d['status']+':\x20'+_0x164ef8);throw new Error('HTTP\x20error!\x20status:\x20'+_0x93384d[_0x5fb325(0x17f)]+_0x5fb325(0x1b3)+_0x164ef8);}let _0x9562b;try{_0x9562b=JSON[_0x5fb325(0x1ad)](_0x164ef8);}catch(_0x20b5b0){console[_0x5fb325(0x1b9)](_0x5fb325(0x1a8),_0x20b5b0),loggerService_1[_0x5fb325(0x17d)][_0x5fb325(0x1d1)](_0x5fb325(0x1de),'/invoices/new','JSON\x20Parse\x20Error:\x20'+_0x20b5b0);throw new Error(_0x5fb325(0x18f)+_0x164ef8);}console['log']('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x5fb325(0x1b6)]('Parsed\x20Result:',JSON[_0x5fb325(0x17b)](_0x9562b,null,0x2)),loggerService_1[_0x5fb325(0x17d)][_0x5fb325(0x197)](_0x5fb325(0x1de),_0x5fb325(0x1e1),_0x93384d[_0x5fb325(0x17f)],_0x9562b,_0x3a0a39);if(_0x9562b[_0x5fb325(0x17f)]!=='success'){const _0x4363a0=_0x9562b[_0x5fb325(0x1af)]||_0x9562b['error']||_0x5fb325(0x1be);console[_0x5fb325(0x1b9)](_0x5fb325(0x1d4)),console['error'](_0x5fb325(0x1d6),_0x4363a0),loggerService_1[_0x5fb325(0x17d)][_0x5fb325(0x1d1)](_0x5fb325(0x1de),_0x5fb325(0x1e1),_0x5fb325(0x185)+_0x4363a0);throw new Error(_0x5fb325(0x1bc)+_0x4363a0);}if(!_0x9562b[_0x5fb325(0x1b5)]?.[_0x5fb325(0x181)]||!_0x9562b[_0x5fb325(0x1b5)]?.[_0x5fb325(0x183)]){console['error'](_0x5fb325(0x1e2)),console[_0x5fb325(0x1b9)](_0x5fb325(0x18d)),console[_0x5fb325(0x1b9)]('Response\x20data:',_0x9562b['data']),loggerService_1[_0x5fb325(0x17d)][_0x5fb325(0x1d1)](_0x5fb325(0x1de),_0x5fb325(0x1e1),_0x5fb325(0x1b0));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x5fb325(0x1b6)](_0x5fb325(0x1a6)),console[_0x5fb325(0x1b6)](_0x5fb325(0x1b2),_0x9562b['data']['txn_id']),console['log']('Invoice\x20URL:',_0x9562b[_0x5fb325(0x1b5)][_0x5fb325(0x183)]),console[_0x5fb325(0x1b6)](_0x5fb325(0x180),_0x16aeaf,_0x3eab93),_0x258e29&&(console['log'](_0x5fb325(0x1d7),_0x258e29,'(crypto\x20for\x20payment)'),console[_0x5fb325(0x1b6)](_0x5fb325(0x1ba),_0x3eab93,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x9562b['data'][_0x5fb325(0x181)],'payment_url':_0x9562b['data']['invoice_url'],'invoice_total_sum':_0x9562b['data'][_0x5fb325(0x192)],'qr_code':_0x9562b[_0x5fb325(0x1b5)][_0x5fb325(0x1a0)],'qr_url':_0x9562b[_0x5fb325(0x1b5)]['qr_url']};}catch(_0x124eea){console['error'](_0x5fb325(0x16d)),console[_0x5fb325(0x1b9)](_0x5fb325(0x1a7),_0x124eea),loggerService_1[_0x5fb325(0x17d)][_0x5fb325(0x1d1)](_0x5fb325(0x1de),_0x5fb325(0x1e1),_0x124eea);if(_0x124eea instanceof Error){console['error']('Error\x20message:',_0x124eea[_0x5fb325(0x1af)]),console[_0x5fb325(0x1b9)]('Error\x20stack:',_0x124eea['stack']);throw new Error(_0x5fb325(0x175)+_0x124eea[_0x5fb325(0x1af)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a47_0x38f763(0x182)](_0x1214ec){const _0x5f409d=a47_0x38f763,_0x3084ac=Date[_0x5f409d(0x1ce)]();try{if(!this[_0x5f409d(0x1c0)])throw new Error(_0x5f409d(0x19d));const _0x440b5c=new URLSearchParams({'api_key':this[_0x5f409d(0x1c0)],'txn_id':_0x1214ec}),_0x40005c=_0x5f409d(0x1a9)+_0x1214ec+'?'+_0x440b5c['toString']();loggerService_1['loggerService'][_0x5f409d(0x1d2)](_0x5f409d(0x1de),_0x5f409d(0x1b4)+_0x1214ec,_0x5f409d(0x196),Object[_0x5f409d(0x1cb)](_0x440b5c[_0x5f409d(0x1ae)]()));const _0x2dec78=await fetch(_0x40005c,{'method':'GET','headers':{'Accept':_0x5f409d(0x174),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0xe9f1f5=Date[_0x5f409d(0x1ce)]()-_0x3084ac;if(!_0x2dec78['ok']){const _0x390ca7=await _0x2dec78[_0x5f409d(0x1a1)]();loggerService_1[_0x5f409d(0x17d)][_0x5f409d(0x197)](_0x5f409d(0x1de),_0x5f409d(0x1b4)+_0x1214ec,_0x2dec78[_0x5f409d(0x17f)],_0x390ca7,_0xe9f1f5);throw new Error(_0x5f409d(0x16e)+_0x2dec78[_0x5f409d(0x17f)]);}const _0x1cddc2=await _0x2dec78[_0x5f409d(0x179)]();loggerService_1[_0x5f409d(0x17d)][_0x5f409d(0x197)](_0x5f409d(0x1de),_0x5f409d(0x1b4)+_0x1214ec,_0x2dec78[_0x5f409d(0x17f)],_0x1cddc2,_0xe9f1f5);if(_0x1cddc2[_0x5f409d(0x17f)]!==_0x5f409d(0x17c)){loggerService_1['loggerService']['logWhiteDomainError'](_0x5f409d(0x1de),_0x5f409d(0x1b4)+_0x1214ec,_0x5f409d(0x1bc)+(_0x1cddc2[_0x5f409d(0x1af)]||_0x1cddc2[_0x5f409d(0x1b9)]||'Unknown\x20error'));throw new Error(_0x5f409d(0x1bc)+(_0x1cddc2[_0x5f409d(0x1af)]||_0x1cddc2['error']||'Unknown\x20error'));}let _0x57243e=_0x5f409d(0x17a);return{'status':_0x57243e};}catch(_0x24cfdd){console[_0x5f409d(0x1b9)]('Plisio\x20payment\x20verification\x20error:',_0x24cfdd),loggerService_1[_0x5f409d(0x17d)][_0x5f409d(0x1d1)](_0x5f409d(0x1de),_0x5f409d(0x1b4)+_0x1214ec,_0x24cfdd);throw new Error(_0x5f409d(0x1da)+(_0x24cfdd instanceof Error?_0x24cfdd['message']:_0x5f409d(0x189)));}}async[a47_0x38f763(0x1aa)](_0x38ed4d){const _0xdb60bf=a47_0x38f763;console[_0xdb60bf(0x1b6)](_0xdb60bf(0x1cd),_0x38ed4d);let _0x591913=_0xdb60bf(0x17a);switch(_0x38ed4d['status']?.[_0xdb60bf(0x1df)]()){case _0xdb60bf(0x1d0):case _0xdb60bf(0x177):_0x591913=_0xdb60bf(0x17e);break;case _0xdb60bf(0x1ac):_0x591913=_0xdb60bf(0x1c4);break;case _0xdb60bf(0x1b9):case _0xdb60bf(0x187):_0x591913=_0xdb60bf(0x1c1);break;case _0xdb60bf(0x171):_0x591913=_0xdb60bf(0x17a);break;case _0xdb60bf(0x1dc):_0x591913=_0xdb60bf(0x1cc);break;default:_0x591913=_0xdb60bf(0x17a);break;}let _0x4c5196;if(_0x38ed4d[_0xdb60bf(0x198)])try{console['log']('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x38ed4d[_0xdb60bf(0x198)]);let _0x377e6d;if(typeof _0x38ed4d['tx_urls']==='string')_0x377e6d=JSON['parse'](_0x38ed4d[_0xdb60bf(0x198)]);else Array[_0xdb60bf(0x184)](_0x38ed4d[_0xdb60bf(0x198)])?_0x377e6d=_0x38ed4d[_0xdb60bf(0x198)]:_0x377e6d=[];_0x4c5196=_0x377e6d[_0xdb60bf(0x170)](_0xf5117=>{const _0x47dd94=_0xdb60bf,_0x377210=_0xf5117[_0x47dd94(0x19e)](/\\/g,'');return console[_0x47dd94(0x1b6)](_0x47dd94(0x18c)+_0xf5117+_0x47dd94(0x1bd)+_0x377210),_0x377210;}),console[_0xdb60bf(0x1b6)](_0xdb60bf(0x1ca),_0x4c5196),_0x4c5196[_0xdb60bf(0x16f)]((_0x520fbd,_0x16d000)=>{const _0x516bfa=_0xdb60bf;try{new URL(_0x520fbd),console[_0x516bfa(0x1b6)]('‚úÖ\x20URL\x20'+(_0x16d000+0x1)+_0x516bfa(0x18b)+_0x520fbd);}catch(_0xa8836f){console[_0x516bfa(0x1b9)](_0x516bfa(0x1e0)+(_0x16d000+0x1)+_0x516bfa(0x18e)+_0x520fbd,_0xa8836f);}});}catch(_0x21180c){console[_0xdb60bf(0x1b9)](_0xdb60bf(0x1db),_0x21180c),console[_0xdb60bf(0x1b9)](_0xdb60bf(0x1d9),_0x38ed4d[_0xdb60bf(0x198)]),_0x4c5196=undefined;}return{'paymentId':_0x38ed4d[_0xdb60bf(0x1d8)]||'','status':_0x591913,'amount':_0x38ed4d[_0xdb60bf(0x1dd)],'currency':_0x38ed4d[_0xdb60bf(0x1bb)],'txUrls':_0x4c5196};}}exports[a47_0x38f763(0x1b8)]=PlisioService;