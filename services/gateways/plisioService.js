'use strict';const a44_0x5c4047=a44_0x2446;function a44_0x3a39(){const _0xc4ab9c=['HTTP\x20error!\x20status:\x20','name','__esModule','3uZROJj','PLISIO_API_KEY','238942qiaOyX','Failed\x20to\x20parse\x20JSON\x20response:','1430204cwVrXH','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','TesSoft\x20Payment\x20System/1.0','Error\x20details:','Plisio\x20API\x20key\x20is\x20not\x20configured','pending','env','2331276iwVOLO','now','verifyPayment','new','invoice_url','\x20is\x20valid:\x20','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status:','/operations/','Amount:','plisio_direct','Error\x20stack:','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','Failed\x20to\x20create\x20Plisio\x20payment:\x20','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','9aQIJvn','FAILED','parse','Unknown\x20error','warn','PAID','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','message','Invoice\x20URL:','tx_urls','toLowerCase','\x20is\x20invalid:\x20','PlisioService','apiKey','Processing\x20Plisio\x20webhook:','txn_id','logWhiteDomainRequest','email','1003335tozpvN','completed','/invoices/new','PENDING','defineProperty','apiUrl','Plisio\x20API\x20error:\x20','replace','1099576VqBovX','data','append','Business\x20Error:\x20','entries','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','logWhiteDomainResponse',',\x20body:\x20','Unknown\x20error\x20from\x20Plisio\x20API','success','4406090jMHWLf','11OrzGrF','../loggerService','HIDDEN','text','Parameters:','532219mePdpw','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Transaction\x20ID:','application/json','https://api.trapay.uk/api/webhooks/gateway/plisio','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','fromEntries','Status\x20Text:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','log','qr_url','✅\x20Processed\x20tx_urls:','EXPIRED','logWhiteDomainError','toString','source_amount','✅\x20URL\x20','string','Error\x20Message:','Raw\x20tx_urls\x20data:','currency','7cfLozs','invoice_total_sum','===\x20PLISIO\x20API\x20ERROR\x20===','🔗\x20Formatted\x20URL:\x20','HTTP\x20','GET','Raw\x20Response\x20Body:','Response\x20Body:','Response\x20Time:','https://api.plisio.net/api/v1/operations/','(crypto\x20for\x20payment)','Full\x20URL\x20(without\x20API\x20key):','order_number','Response\x20data:','error','\x20->\x20','loggerService','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','===\x20PLISIO\x20SUCCESS\x20===','stack','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','createPayment','JSON\x20Parse\x20Error:\x20','status','https://api.plisio.net/api/v1/invoices/new','map'];a44_0x3a39=function(){return _0xc4ab9c;};return a44_0x3a39();}(function(_0x7b80c,_0x211766){const _0x119c2d=a44_0x2446,_0x4fa2b8=_0x7b80c();while(!![]){try{const _0x550bb8=parseInt(_0x119c2d(0x19b))/0x1+parseInt(_0x119c2d(0x159))/0x2+parseInt(_0x119c2d(0x157))/0x3*(-parseInt(_0x119c2d(0x15b))/0x4)+-parseInt(_0x119c2d(0x183))/0x5+parseInt(_0x119c2d(0x162))/0x6*(-parseInt(_0x119c2d(0x1b1))/0x7)+-parseInt(_0x119c2d(0x18b))/0x8*(-parseInt(_0x119c2d(0x171))/0x9)+-parseInt(_0x119c2d(0x195))/0xa*(-parseInt(_0x119c2d(0x196))/0xb);if(_0x550bb8===_0x211766)break;else _0x4fa2b8['push'](_0x4fa2b8['shift']());}catch(_0x44dfcb){_0x4fa2b8['push'](_0x4fa2b8['shift']());}}}(a44_0x3a39,0x45166));Object[a44_0x5c4047(0x187)](exports,a44_0x5c4047(0x156),{'value':!![]}),exports[a44_0x5c4047(0x17d)]=void 0x0;function a44_0x2446(_0xda9c8e,_0x5bd893){const _0x3a3991=a44_0x3a39();return a44_0x2446=function(_0x24463a,_0x4ef07d){_0x24463a=_0x24463a-0x150;let _0x3c1a9a=_0x3a3991[_0x24463a];return _0x3c1a9a;},a44_0x2446(_0xda9c8e,_0x5bd893);}const loggerService_1=require(a44_0x5c4047(0x197));class PlisioService{constructor(){const _0x193ccb=a44_0x5c4047;this[_0x193ccb(0x188)]=_0x193ccb(0x152),this[_0x193ccb(0x17e)]=process[_0x193ccb(0x161)][_0x193ccb(0x158)]||'',!this['apiKey']?console[_0x193ccb(0x175)](_0x193ccb(0x177)):console[_0x193ccb(0x1a5)]('💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a44_0x5c4047(0x1c6)](_0x1cc15d){const _0xff360e=a44_0x5c4047,{orderId:_0x1aa3c7,amount:_0x27049f,currency:_0x185da6,productName:_0x128fda,description:_0x32e270,successUrl:_0xef09be,failUrl:_0xd4ae6d,customerEmail:_0x3b812d,customerName:_0x4f7998,isSourceCurrency:_0x3b16cb,sourceCurrency:_0x207fe0}=_0x1cc15d;if(!this[_0xff360e(0x17e)])throw new Error(_0xff360e(0x15f));const _0x442fdf=new URLSearchParams({'api_key':this[_0xff360e(0x17e)],'order_number':_0x1aa3c7,'order_name':_0x128fda,'description':_0x32e270,'success_url':_0xef09be,'fail_url':_0xd4ae6d,'callback_url':_0xff360e(0x19f)});_0x207fe0?(_0x442fdf[_0xff360e(0x18d)](_0xff360e(0x1b0),_0x207fe0),_0x442fdf[_0xff360e(0x18d)]('source_currency',_0x185da6),_0x442fdf[_0xff360e(0x18d)](_0xff360e(0x1ab),_0x27049f[_0xff360e(0x1aa)]())):(_0x442fdf[_0xff360e(0x18d)]('currency',_0x185da6),_0x442fdf['append']('amount',_0x27049f[_0xff360e(0x1aa)]()));_0x3b812d&&_0x442fdf[_0xff360e(0x18d)](_0xff360e(0x182),_0x3b812d);_0x4f7998&&_0x442fdf['append'](_0xff360e(0x155),_0x4f7998);const _0x2ce8a8=this[_0xff360e(0x188)]+'?'+_0x442fdf[_0xff360e(0x1aa)](),_0x4e6766=Date['now']();try{console[_0xff360e(0x1a5)](_0xff360e(0x19c)),console['log']('URL:',this[_0xff360e(0x188)]),console[_0xff360e(0x1a5)](_0xff360e(0x19a),Object[_0xff360e(0x1a2)](_0x442fdf[_0xff360e(0x18f)]())),console[_0xff360e(0x1a5)](_0xff360e(0x1bc),_0x2ce8a8[_0xff360e(0x18a)](this[_0xff360e(0x17e)],_0xff360e(0x198))),loggerService_1[_0xff360e(0x1c1)][_0xff360e(0x181)](_0xff360e(0x16c),_0xff360e(0x185),'GET',Object[_0xff360e(0x1a2)](_0x442fdf[_0xff360e(0x18f)]()));const _0x2e2d7c=await fetch(_0x2ce8a8,{'method':_0xff360e(0x1b6),'headers':{'Accept':_0xff360e(0x19e),'User-Agent':_0xff360e(0x15d)}}),_0x132d47=Date[_0xff360e(0x163)]()-_0x4e6766;console[_0xff360e(0x1a5)](_0xff360e(0x1a1)),console[_0xff360e(0x1a5)](_0xff360e(0x169),_0x2e2d7c[_0xff360e(0x151)]),console['log'](_0xff360e(0x1a3),_0x2e2d7c['statusText']),console[_0xff360e(0x1a5)](_0xff360e(0x1b9),_0x132d47+'ms');const _0x16ae03=await _0x2e2d7c[_0xff360e(0x199)]();console[_0xff360e(0x1a5)](_0xff360e(0x1b7),_0x16ae03);if(!_0x2e2d7c['ok']){console['error'](_0xff360e(0x1b3)),console['error']('HTTP\x20Status:',_0x2e2d7c[_0xff360e(0x151)]),console[_0xff360e(0x1bf)](_0xff360e(0x1b8),_0x16ae03),loggerService_1['loggerService'][_0xff360e(0x191)](_0xff360e(0x16c),_0xff360e(0x185),_0x2e2d7c['status'],_0x16ae03,_0x132d47),loggerService_1[_0xff360e(0x1c1)]['logWhiteDomainError'](_0xff360e(0x16c),'/invoices/new',_0xff360e(0x1b5)+_0x2e2d7c[_0xff360e(0x151)]+':\x20'+_0x16ae03);throw new Error(_0xff360e(0x154)+_0x2e2d7c['status']+_0xff360e(0x192)+_0x16ae03);}let _0x5aa5cd;try{_0x5aa5cd=JSON[_0xff360e(0x173)](_0x16ae03);}catch(_0x29721e){console[_0xff360e(0x1bf)](_0xff360e(0x15a),_0x29721e),loggerService_1[_0xff360e(0x1c1)][_0xff360e(0x1a9)](_0xff360e(0x16c),_0xff360e(0x185),_0xff360e(0x150)+_0x29721e);throw new Error(_0xff360e(0x1a0)+_0x16ae03);}console[_0xff360e(0x1a5)](_0xff360e(0x1c5)),console['log']('Parsed\x20Result:',JSON['stringify'](_0x5aa5cd,null,0x2)),loggerService_1['loggerService'][_0xff360e(0x191)](_0xff360e(0x16c),_0xff360e(0x185),_0x2e2d7c['status'],_0x5aa5cd,_0x132d47);if(_0x5aa5cd[_0xff360e(0x151)]!==_0xff360e(0x194)){const _0x454743=_0x5aa5cd[_0xff360e(0x178)]||_0x5aa5cd[_0xff360e(0x1bf)]||_0xff360e(0x193);console[_0xff360e(0x1bf)](_0xff360e(0x170)),console[_0xff360e(0x1bf)](_0xff360e(0x1ae),_0x454743),loggerService_1[_0xff360e(0x1c1)][_0xff360e(0x1a9)](_0xff360e(0x16c),_0xff360e(0x185),_0xff360e(0x18e)+_0x454743);throw new Error('Plisio\x20API\x20error:\x20'+_0x454743);}if(!_0x5aa5cd['data']?.[_0xff360e(0x180)]||!_0x5aa5cd['data']?.[_0xff360e(0x166)]){console[_0xff360e(0x1bf)](_0xff360e(0x168)),console[_0xff360e(0x1bf)](_0xff360e(0x1a4)),console[_0xff360e(0x1bf)](_0xff360e(0x1be),_0x5aa5cd['data']),loggerService_1[_0xff360e(0x1c1)][_0xff360e(0x1a9)]('plisio_direct',_0xff360e(0x185),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0xff360e(0x1c2));}return console[_0xff360e(0x1a5)](_0xff360e(0x1c3)),console[_0xff360e(0x1a5)](_0xff360e(0x19d),_0x5aa5cd['data'][_0xff360e(0x180)]),console['log'](_0xff360e(0x179),_0x5aa5cd[_0xff360e(0x18c)][_0xff360e(0x166)]),console[_0xff360e(0x1a5)](_0xff360e(0x16b),_0x27049f,_0x185da6),_0x207fe0&&(console['log']('Source\x20Currency:',_0x207fe0,_0xff360e(0x1bb)),console[_0xff360e(0x1a5)]('Target\x20Currency:',_0x185da6,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x5aa5cd[_0xff360e(0x18c)][_0xff360e(0x180)],'payment_url':_0x5aa5cd[_0xff360e(0x18c)][_0xff360e(0x166)],'invoice_total_sum':_0x5aa5cd[_0xff360e(0x18c)][_0xff360e(0x1b2)],'qr_code':_0x5aa5cd[_0xff360e(0x18c)]['qr_code'],'qr_url':_0x5aa5cd['data'][_0xff360e(0x1a6)]};}catch(_0x489ff6){console[_0xff360e(0x1bf)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0xff360e(0x1bf)](_0xff360e(0x15e),_0x489ff6),loggerService_1[_0xff360e(0x1c1)][_0xff360e(0x1a9)](_0xff360e(0x16c),'/invoices/new',_0x489ff6);if(_0x489ff6 instanceof Error){console[_0xff360e(0x1bf)]('Error\x20message:',_0x489ff6[_0xff360e(0x178)]),console['error'](_0xff360e(0x16d),_0x489ff6[_0xff360e(0x1c4)]);throw new Error(_0xff360e(0x16f)+_0x489ff6[_0xff360e(0x178)]);}throw new Error(_0xff360e(0x190));}}async[a44_0x5c4047(0x164)](_0x5dc3ce){const _0x92c223=a44_0x5c4047,_0x36d94c=Date[_0x92c223(0x163)]();try{if(!this[_0x92c223(0x17e)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x3e7ffa=new URLSearchParams({'api_key':this[_0x92c223(0x17e)],'txn_id':_0x5dc3ce}),_0x36c211=_0x92c223(0x1ba)+_0x5dc3ce+'?'+_0x3e7ffa[_0x92c223(0x1aa)]();loggerService_1[_0x92c223(0x1c1)][_0x92c223(0x181)]('plisio_direct','/operations/'+_0x5dc3ce,_0x92c223(0x1b6),Object[_0x92c223(0x1a2)](_0x3e7ffa[_0x92c223(0x18f)]()));const _0x25ce1c=await fetch(_0x36c211,{'method':'GET','headers':{'Accept':_0x92c223(0x19e),'User-Agent':_0x92c223(0x15d)}}),_0x46fd83=Date[_0x92c223(0x163)]()-_0x36d94c;if(!_0x25ce1c['ok']){const _0xc4862b=await _0x25ce1c[_0x92c223(0x199)]();loggerService_1[_0x92c223(0x1c1)][_0x92c223(0x191)]('plisio_direct','/operations/'+_0x5dc3ce,_0x25ce1c['status'],_0xc4862b,_0x46fd83);throw new Error(_0x92c223(0x154)+_0x25ce1c['status']);}const _0x3837b8=await _0x25ce1c['json']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x92c223(0x16c),_0x92c223(0x16a)+_0x5dc3ce,_0x25ce1c[_0x92c223(0x151)],_0x3837b8,_0x46fd83);if(_0x3837b8[_0x92c223(0x151)]!==_0x92c223(0x194)){loggerService_1[_0x92c223(0x1c1)]['logWhiteDomainError']('plisio_direct',_0x92c223(0x16a)+_0x5dc3ce,_0x92c223(0x189)+(_0x3837b8['message']||_0x3837b8[_0x92c223(0x1bf)]||_0x92c223(0x174)));throw new Error(_0x92c223(0x189)+(_0x3837b8[_0x92c223(0x178)]||_0x3837b8[_0x92c223(0x1bf)]||_0x92c223(0x174)));}let _0x5aa1b9=_0x92c223(0x186);return{'status':_0x5aa1b9};}catch(_0x26711c){console[_0x92c223(0x1bf)]('Plisio\x20payment\x20verification\x20error:',_0x26711c),loggerService_1[_0x92c223(0x1c1)]['logWhiteDomainError'](_0x92c223(0x16c),_0x92c223(0x16a)+_0x5dc3ce,_0x26711c);throw new Error(_0x92c223(0x15c)+(_0x26711c instanceof Error?_0x26711c[_0x92c223(0x178)]:_0x92c223(0x174)));}}async['processWebhook'](_0x5e4d81){const _0x1b0807=a44_0x5c4047;console[_0x1b0807(0x1a5)](_0x1b0807(0x17f),_0x5e4d81);let _0x2d5e1a=_0x1b0807(0x186);switch(_0x5e4d81['status']?.[_0x1b0807(0x17b)]()){case _0x1b0807(0x184):case'mismatch':_0x2d5e1a=_0x1b0807(0x176);break;case'expired':_0x2d5e1a=_0x1b0807(0x1a8);break;case _0x1b0807(0x1bf):case'cancelled':_0x2d5e1a=_0x1b0807(0x172);break;case _0x1b0807(0x165):_0x2d5e1a=_0x1b0807(0x186);break;case _0x1b0807(0x160):_0x2d5e1a='PROCESSING';break;default:_0x2d5e1a=_0x1b0807(0x186);break;}let _0x585fbd;if(_0x5e4d81[_0x1b0807(0x17a)])try{console[_0x1b0807(0x1a5)](_0x1b0807(0x16e),_0x5e4d81['tx_urls']);let _0x36bfe4;if(typeof _0x5e4d81['tx_urls']===_0x1b0807(0x1ad))_0x36bfe4=JSON[_0x1b0807(0x173)](_0x5e4d81[_0x1b0807(0x17a)]);else Array['isArray'](_0x5e4d81['tx_urls'])?_0x36bfe4=_0x5e4d81[_0x1b0807(0x17a)]:_0x36bfe4=[];_0x585fbd=_0x36bfe4[_0x1b0807(0x153)](_0x32b3d0=>{const _0x1b3ac7=_0x1b0807,_0x255a7b=_0x32b3d0[_0x1b3ac7(0x18a)](/\\/g,'');return console[_0x1b3ac7(0x1a5)](_0x1b3ac7(0x1b4)+_0x32b3d0+_0x1b3ac7(0x1c0)+_0x255a7b),_0x255a7b;}),console[_0x1b0807(0x1a5)](_0x1b0807(0x1a7),_0x585fbd),_0x585fbd['forEach']((_0xadccd6,_0x4db4a2)=>{const _0x5960f4=_0x1b0807;try{new URL(_0xadccd6),console[_0x5960f4(0x1a5)](_0x5960f4(0x1ac)+(_0x4db4a2+0x1)+_0x5960f4(0x167)+_0xadccd6);}catch(_0x494ed4){console[_0x5960f4(0x1bf)]('❌\x20URL\x20'+(_0x4db4a2+0x1)+_0x5960f4(0x17c)+_0xadccd6,_0x494ed4);}});}catch(_0x3b998c){console[_0x1b0807(0x1bf)]('❌\x20Failed\x20to\x20parse\x20tx_urls:',_0x3b998c),console[_0x1b0807(0x1bf)](_0x1b0807(0x1af),_0x5e4d81[_0x1b0807(0x17a)]),_0x585fbd=undefined;}return{'paymentId':_0x5e4d81[_0x1b0807(0x1bd)]||'','status':_0x2d5e1a,'amount':_0x5e4d81['amount'],'currency':_0x5e4d81['currency'],'txUrls':_0x585fbd};}}exports[a44_0x5c4047(0x17d)]=PlisioService;