'use strict';const a49_0x5d1f85=a49_0x4674;(function(_0x43a419,_0x19c128){const _0x285aa3=a49_0x4674,_0x433f38=_0x43a419();while(!![]){try{const _0x2ff774=-parseInt(_0x285aa3(0x195))/0x1*(-parseInt(_0x285aa3(0x1c5))/0x2)+-parseInt(_0x285aa3(0x1a1))/0x3*(-parseInt(_0x285aa3(0x163))/0x4)+-parseInt(_0x285aa3(0x15f))/0x5+-parseInt(_0x285aa3(0x1a8))/0x6+parseInt(_0x285aa3(0x19c))/0x7+parseInt(_0x285aa3(0x17b))/0x8*(parseInt(_0x285aa3(0x184))/0x9)+-parseInt(_0x285aa3(0x171))/0xa;if(_0x2ff774===_0x19c128)break;else _0x433f38['push'](_0x433f38['shift']());}catch(_0x4b7f47){_0x433f38['push'](_0x433f38['shift']());}}}(a49_0xa0e0,0x49580));Object[a49_0x5d1f85(0x1a4)](exports,a49_0x5d1f85(0x1bf),{'value':!![]}),exports[a49_0x5d1f85(0x1a2)]=void 0x0;function a49_0x4674(_0x5dd065,_0x5ca99b){const _0xa0e073=a49_0xa0e0();return a49_0x4674=function(_0x4674fe,_0x237405){_0x4674fe=_0x4674fe-0x15c;let _0xefe5=_0xa0e073[_0x4674fe];return _0xefe5;},a49_0x4674(_0x5dd065,_0x5ca99b);}const loggerService_1=require(a49_0x5d1f85(0x1b9));class PlisioService{constructor(){const _0x3b0160=a49_0x5d1f85;this[_0x3b0160(0x1b0)]=_0x3b0160(0x1c3),this[_0x3b0160(0x16a)]=process[_0x3b0160(0x1ba)][_0x3b0160(0x1b3)]||'',!this[_0x3b0160(0x16a)]?console[_0x3b0160(0x1c0)](_0x3b0160(0x199)):console[_0x3b0160(0x16e)](_0x3b0160(0x193));}async[a49_0x5d1f85(0x1ca)](_0x431070){const _0x2667c6=a49_0x5d1f85,{orderId:_0x15440e,amount:_0x4ef75b,currency:_0x353cef,productName:_0x23791e,description:_0x2b1ed6,successUrl:_0x2c5199,failUrl:_0x4afedb,customerEmail:_0x73584c,customerName:_0x989933,isSourceCurrency:_0x21393f,sourceCurrency:_0x4bfc2d}=_0x431070;if(!this[_0x2667c6(0x16a)])throw new Error(_0x2667c6(0x17e));const _0x11e32f=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x15440e,'order_name':_0x23791e,'description':_0x2b1ed6,'success_url':_0x2c5199,'fail_url':_0x4afedb,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x4bfc2d?(_0x11e32f[_0x2667c6(0x1b7)](_0x2667c6(0x174),_0x4bfc2d),_0x11e32f[_0x2667c6(0x1b7)](_0x2667c6(0x17d),_0x353cef),_0x11e32f[_0x2667c6(0x1b7)](_0x2667c6(0x180),_0x4ef75b[_0x2667c6(0x1bd)]())):(_0x11e32f['append'](_0x2667c6(0x174),_0x353cef),_0x11e32f[_0x2667c6(0x1b7)](_0x2667c6(0x17a),_0x4ef75b[_0x2667c6(0x1bd)]()));_0x73584c&&_0x11e32f['append']('email',_0x73584c);_0x989933&&_0x11e32f[_0x2667c6(0x1b7)]('name',_0x989933);const _0x3cd80f=this['apiUrl']+'?'+_0x11e32f['toString'](),_0xdc88a5=Date[_0x2667c6(0x19a)]();try{console['log'](_0x2667c6(0x190)),console[_0x2667c6(0x16e)](_0x2667c6(0x198),this['apiUrl']),console[_0x2667c6(0x16e)](_0x2667c6(0x173),Object[_0x2667c6(0x160)](_0x11e32f['entries']())),console[_0x2667c6(0x16e)]('Full\x20URL\x20(without\x20API\x20key):',_0x3cd80f['replace'](this['apiKey'],_0x2667c6(0x1c9))),loggerService_1[_0x2667c6(0x1b2)][_0x2667c6(0x1c1)](_0x2667c6(0x1c6),_0x2667c6(0x191),_0x2667c6(0x15d),Object[_0x2667c6(0x160)](_0x11e32f[_0x2667c6(0x161)]()));const _0x548b46=await fetch(_0x3cd80f,{'method':'GET','headers':{'Accept':'application/json','User-Agent':_0x2667c6(0x1c8)}}),_0x4ee17c=Date[_0x2667c6(0x19a)]()-_0xdc88a5;console['log'](_0x2667c6(0x172)),console[_0x2667c6(0x16e)](_0x2667c6(0x1a7),_0x548b46[_0x2667c6(0x187)]),console[_0x2667c6(0x16e)](_0x2667c6(0x1a9),_0x548b46['statusText']),console['log']('Response\x20Time:',_0x4ee17c+'ms');const _0x3654b7=await _0x548b46[_0x2667c6(0x1b8)]();console[_0x2667c6(0x16e)]('Raw\x20Response\x20Body:',_0x3654b7);if(!_0x548b46['ok']){console['error'](_0x2667c6(0x170)),console[_0x2667c6(0x1ac)]('HTTP\x20Status:',_0x548b46[_0x2667c6(0x187)]),console[_0x2667c6(0x1ac)](_0x2667c6(0x1ab),_0x3654b7),loggerService_1[_0x2667c6(0x1b2)][_0x2667c6(0x1aa)]('plisio_direct','/invoices/new',_0x548b46['status'],_0x3654b7,_0x4ee17c),loggerService_1[_0x2667c6(0x1b2)][_0x2667c6(0x1c4)]('plisio_direct',_0x2667c6(0x191),_0x2667c6(0x194)+_0x548b46['status']+':\x20'+_0x3654b7);throw new Error(_0x2667c6(0x188)+_0x548b46[_0x2667c6(0x187)]+_0x2667c6(0x15c)+_0x3654b7);}let _0x5ca456;try{_0x5ca456=JSON['parse'](_0x3654b7);}catch(_0x187582){console['error'](_0x2667c6(0x1bc),_0x187582),loggerService_1['loggerService'][_0x2667c6(0x1c4)]('plisio_direct',_0x2667c6(0x191),_0x2667c6(0x197)+_0x187582);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x3654b7);}console[_0x2667c6(0x16e)](_0x2667c6(0x1b4)),console[_0x2667c6(0x16e)](_0x2667c6(0x17c),JSON['stringify'](_0x5ca456,null,0x2)),loggerService_1[_0x2667c6(0x1b2)][_0x2667c6(0x1aa)]('plisio_direct','/invoices/new',_0x548b46[_0x2667c6(0x187)],_0x5ca456,_0x4ee17c);if(_0x5ca456[_0x2667c6(0x187)]!==_0x2667c6(0x192)){const _0x3c74b8=_0x5ca456[_0x2667c6(0x167)]||_0x5ca456['error']||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x2667c6(0x1ac)](_0x2667c6(0x19d)),console[_0x2667c6(0x1ac)]('Error\x20Message:',_0x3c74b8),loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct','/invoices/new',_0x2667c6(0x1a6)+_0x3c74b8);throw new Error(_0x2667c6(0x19b)+_0x3c74b8);}if(!_0x5ca456[_0x2667c6(0x18f)]?.[_0x2667c6(0x18e)]||!_0x5ca456[_0x2667c6(0x18f)]?.['invoice_url']){console[_0x2667c6(0x1ac)](_0x2667c6(0x185)),console[_0x2667c6(0x1ac)](_0x2667c6(0x1c2)),console[_0x2667c6(0x1ac)](_0x2667c6(0x175),_0x5ca456[_0x2667c6(0x18f)]),loggerService_1[_0x2667c6(0x1b2)][_0x2667c6(0x1c4)]('plisio_direct',_0x2667c6(0x191),_0x2667c6(0x1b6));throw new Error(_0x2667c6(0x18a));}return console[_0x2667c6(0x16e)](_0x2667c6(0x19f)),console[_0x2667c6(0x16e)](_0x2667c6(0x186),_0x5ca456['data'][_0x2667c6(0x18e)]),console['log']('Invoice\x20URL:',_0x5ca456[_0x2667c6(0x18f)][_0x2667c6(0x1af)]),console[_0x2667c6(0x16e)](_0x2667c6(0x189),_0x4ef75b,_0x353cef),_0x4bfc2d&&(console[_0x2667c6(0x16e)](_0x2667c6(0x179),_0x4bfc2d,_0x2667c6(0x1a5)),console[_0x2667c6(0x16e)]('Target\x20Currency:',_0x353cef,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x5ca456[_0x2667c6(0x18f)][_0x2667c6(0x18e)],'payment_url':_0x5ca456[_0x2667c6(0x18f)][_0x2667c6(0x1af)],'invoice_total_sum':_0x5ca456[_0x2667c6(0x18f)]['invoice_total_sum'],'qr_code':_0x5ca456['data'][_0x2667c6(0x16b)],'qr_url':_0x5ca456[_0x2667c6(0x18f)][_0x2667c6(0x166)]};}catch(_0x3eefac){console[_0x2667c6(0x1ac)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x2667c6(0x1ac)](_0x2667c6(0x1a0),_0x3eefac),loggerService_1[_0x2667c6(0x1b2)]['logWhiteDomainError'](_0x2667c6(0x1c6),_0x2667c6(0x191),_0x3eefac);if(_0x3eefac instanceof Error){console[_0x2667c6(0x1ac)](_0x2667c6(0x162),_0x3eefac['message']),console['error']('Error\x20stack:',_0x3eefac[_0x2667c6(0x168)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x3eefac[_0x2667c6(0x167)]);}throw new Error(_0x2667c6(0x1a3));}}async[a49_0x5d1f85(0x178)](_0x211c04){const _0x4bbd60=a49_0x5d1f85,_0x6c18bb=Date['now']();try{if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x29a58d=new URLSearchParams({'api_key':this[_0x4bbd60(0x16a)],'txn_id':_0x211c04}),_0x445f10=_0x4bbd60(0x165)+_0x211c04+'?'+_0x29a58d[_0x4bbd60(0x1bd)]();loggerService_1[_0x4bbd60(0x1b2)]['logWhiteDomainRequest'](_0x4bbd60(0x1c6),_0x4bbd60(0x16c)+_0x211c04,_0x4bbd60(0x15d),Object[_0x4bbd60(0x160)](_0x29a58d['entries']()));const _0x4221af=await fetch(_0x445f10,{'method':'GET','headers':{'Accept':_0x4bbd60(0x183),'User-Agent':_0x4bbd60(0x1c8)}}),_0x20b81c=Date['now']()-_0x6c18bb;if(!_0x4221af['ok']){const _0x5e0806=await _0x4221af[_0x4bbd60(0x1b8)]();loggerService_1[_0x4bbd60(0x1b2)]['logWhiteDomainResponse'](_0x4bbd60(0x1c6),_0x4bbd60(0x16c)+_0x211c04,_0x4221af[_0x4bbd60(0x187)],_0x5e0806,_0x20b81c);throw new Error(_0x4bbd60(0x188)+_0x4221af[_0x4bbd60(0x187)]);}const _0x48d71a=await _0x4221af[_0x4bbd60(0x169)]();loggerService_1[_0x4bbd60(0x1b2)]['logWhiteDomainResponse']('plisio_direct',_0x4bbd60(0x16c)+_0x211c04,_0x4221af[_0x4bbd60(0x187)],_0x48d71a,_0x20b81c);if(_0x48d71a[_0x4bbd60(0x187)]!==_0x4bbd60(0x192)){loggerService_1[_0x4bbd60(0x1b2)][_0x4bbd60(0x1c4)](_0x4bbd60(0x1c6),_0x4bbd60(0x16c)+_0x211c04,'Plisio\x20API\x20error:\x20'+(_0x48d71a[_0x4bbd60(0x167)]||_0x48d71a[_0x4bbd60(0x1ac)]||_0x4bbd60(0x164)));throw new Error(_0x4bbd60(0x19b)+(_0x48d71a[_0x4bbd60(0x167)]||_0x48d71a[_0x4bbd60(0x1ac)]||_0x4bbd60(0x164)));}let _0x26c543=_0x4bbd60(0x181);return{'status':_0x26c543};}catch(_0x347fb7){console['error']('Plisio\x20payment\x20verification\x20error:',_0x347fb7),loggerService_1['loggerService'][_0x4bbd60(0x1c4)](_0x4bbd60(0x1c6),_0x4bbd60(0x16c)+_0x211c04,_0x347fb7);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x347fb7 instanceof Error?_0x347fb7[_0x4bbd60(0x167)]:'Unknown\x20error'));}}async['processWebhook'](_0x3e4fdf){const _0x373e05=a49_0x5d1f85;console['log'](_0x373e05(0x1cb),_0x3e4fdf);let _0xcd96c9='PENDING';switch(_0x3e4fdf[_0x373e05(0x187)]?.['toLowerCase']()){case _0x373e05(0x1bb):case _0x373e05(0x18c):_0xcd96c9=_0x373e05(0x1b5);break;case _0x373e05(0x16d):_0xcd96c9=_0x373e05(0x1c7);break;case _0x373e05(0x1ac):case _0x373e05(0x1ad):_0xcd96c9=_0x373e05(0x16f);break;case'new':_0xcd96c9='PENDING';break;case _0x373e05(0x176):_0xcd96c9='PROCESSING';break;default:_0xcd96c9=_0x373e05(0x181);break;}let _0x231512;if(_0x3e4fdf['tx_urls'])try{console[_0x373e05(0x16e)](_0x373e05(0x18d),_0x3e4fdf[_0x373e05(0x182)]);let _0x307843;if(typeof _0x3e4fdf['tx_urls']===_0x373e05(0x17f))_0x307843=JSON[_0x373e05(0x1ae)](_0x3e4fdf['tx_urls']);else Array[_0x373e05(0x196)](_0x3e4fdf[_0x373e05(0x182)])?_0x307843=_0x3e4fdf['tx_urls']:_0x307843=[];_0x231512=_0x307843[_0x373e05(0x19e)](_0x143b30=>{const _0x2e10b4=_0x373e05,_0x1a82be=_0x143b30[_0x2e10b4(0x18b)](/\\/g,'');return console[_0x2e10b4(0x16e)](_0x2e10b4(0x1b1)+_0x143b30+'\x20->\x20'+_0x1a82be),_0x1a82be;}),console['log'](_0x373e05(0x15e),_0x231512),_0x231512['forEach']((_0x370eec,_0x17d186)=>{const _0x5180d0=_0x373e05;try{new URL(_0x370eec),console[_0x5180d0(0x16e)]('✅\x20URL\x20'+(_0x17d186+0x1)+'\x20is\x20valid:\x20'+_0x370eec);}catch(_0x18e1d9){console[_0x5180d0(0x1ac)]('❌\x20URL\x20'+(_0x17d186+0x1)+'\x20is\x20invalid:\x20'+_0x370eec,_0x18e1d9);}});}catch(_0x3120e9){console[_0x373e05(0x1ac)](_0x373e05(0x177),_0x3120e9),console[_0x373e05(0x1ac)](_0x373e05(0x1be),_0x3e4fdf['tx_urls']),_0x231512=undefined;}return{'paymentId':_0x3e4fdf['order_number']||'','status':_0xcd96c9,'amount':_0x3e4fdf[_0x373e05(0x17a)],'currency':_0x3e4fdf['currency'],'txUrls':_0x231512};}}exports[a49_0x5d1f85(0x1a2)]=PlisioService;function a49_0xa0e0(){const _0x264b12=['https://api.plisio.net/api/v1/invoices/new','logWhiteDomainError','20glwUKB','plisio_direct','EXPIRED','TesSoft\x20Payment\x20System/1.0','HIDDEN','createPayment','Processing\x20Plisio\x20webhook:',',\x20body:\x20','GET','✅\x20Processed\x20tx_urls:','1354615ewczRG','fromEntries','entries','Error\x20message:','20xHGhEN','Unknown\x20error','https://api.plisio.net/api/v1/operations/','qr_url','message','stack','json','apiKey','qr_code','/operations/','expired','log','FAILED','===\x20PLISIO\x20API\x20ERROR\x20===','7417240RpDnEV','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Parameters:','currency','Response\x20data:','pending','❌\x20Failed\x20to\x20parse\x20tx_urls:','verifyPayment','Source\x20Currency:','amount','3488lhnNgv','Parsed\x20Result:','source_currency','Plisio\x20API\x20key\x20is\x20not\x20configured','string','source_amount','PENDING','tx_urls','application/json','11646OCKKeH','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Transaction\x20ID:','status','HTTP\x20error!\x20status:\x20','Amount:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','replace','mismatch','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','txn_id','data','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','/invoices/new','success','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','HTTP\x20','38150pncDwt','isArray','JSON\x20Parse\x20Error:\x20','URL:','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','now','Plisio\x20API\x20error:\x20','1817858aoJibL','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','map','===\x20PLISIO\x20SUCCESS\x20===','Error\x20details:','203124HbMbvs','PlisioService','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','defineProperty','(crypto\x20for\x20payment)','Business\x20Error:\x20','Status:','1385130qXIvZZ','Status\x20Text:','logWhiteDomainResponse','Response\x20Body:','error','cancelled','parse','invoice_url','apiUrl','🔗\x20Formatted\x20URL:\x20','loggerService','PLISIO_API_KEY','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','PAID','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','append','text','../loggerService','env','completed','Failed\x20to\x20parse\x20JSON\x20response:','toString','Raw\x20tx_urls\x20data:','__esModule','warn','logWhiteDomainRequest','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'];a49_0xa0e0=function(){return _0x264b12;};return a49_0xa0e0();}