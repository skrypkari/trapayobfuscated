'use strict';function a45_0x2225(){const _0x120aab=['‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','source_currency','/invoices/new','/operations/','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','now','logWhiteDomainResponse','completed','\x20is\x20invalid:\x20','parse','Amount:','logWhiteDomainError','env','Plisio\x20API\x20key\x20is\x20not\x20configured','Status:','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','success','expired','‚úÖ\x20Processed\x20tx_urls:','Failed\x20to\x20parse\x20JSON\x20response:','2799885NHVUON','toString','isArray','invoice_url','HTTP\x20Status:','URL:','text','HTTP\x20error!\x20status:\x20','pending','data','‚ùå\x20URL\x20','JSON\x20Parse\x20Error:\x20','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','35168814dhEwoa','Plisio\x20payment\x20verification\x20error:','new','map','https://api.plisio.net/api/v1/operations/','amount','append','fromEntries','mismatch','Transaction\x20ID:','email','Full\x20URL\x20(without\x20API\x20key):','EXPIRED','‚úÖ\x20URL\x20','PROCESSING','Error\x20details:','Plisio\x20API\x20error:\x20','GET','Raw\x20Response\x20Body:','Parameters:','plisio_direct','https://api.trapay.uk/api/webhooks/gateway/plisio','PlisioService','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','Error\x20stack:','entries','invoice_total_sum','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','warn','===\x20PLISIO\x20API\x20ERROR\x20===','2dRZhnD','HIDDEN','qr_url','error','apiKey','1683935qiilmj','logWhiteDomainRequest','application/json','Business\x20Error:\x20','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','10mUYEmw','HTTP\x20','loggerService','Response\x20data:','status','log','10592280aGnNRR','replace','Unknown\x20error','PENDING','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','apiUrl','12258631pTwYeg','../loggerService','statusText','1528VziOQg','txn_id','currency','message','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Invoice\x20URL:','source_amount','14582264UtxgwR','Processing\x20Plisio\x20webhook:',',\x20body:\x20','https://api.plisio.net/api/v1/invoices/new','Parsed\x20Result:','Error\x20message:','7302xPoLcq','processWebhook','Response\x20Body:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','TesSoft\x20Payment\x20System/1.0','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Status\x20Text:','cancelled','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Response\x20Time:','FAILED','Raw\x20tx_urls\x20data:','(crypto\x20for\x20payment)','tx_urls','verifyPayment','forEach','stringify'];a45_0x2225=function(){return _0x120aab;};return a45_0x2225();}const a45_0x4da56d=a45_0x38d3;(function(_0x5beaa7,_0x3d3802){const _0x4e53c7=a45_0x38d3,_0x26ae09=_0x5beaa7();while(!![]){try{const _0x3d2b6b=-parseInt(_0x4e53c7(0x1d1))/0x1*(-parseInt(_0x4e53c7(0x1cc))/0x2)+parseInt(_0x4e53c7(0x1f2))/0x3*(parseInt(_0x4e53c7(0x1e5))/0x4)+parseInt(_0x4e53c7(0x218))/0x5+parseInt(_0x4e53c7(0x1dc))/0x6+parseInt(_0x4e53c7(0x1e2))/0x7+-parseInt(_0x4e53c7(0x1ec))/0x8+-parseInt(_0x4e53c7(0x225))/0x9*(parseInt(_0x4e53c7(0x1d6))/0xa);if(_0x3d2b6b===_0x3d3802)break;else _0x26ae09['push'](_0x26ae09['shift']());}catch(_0x13b4d5){_0x26ae09['push'](_0x26ae09['shift']());}}}(a45_0x2225,0xea58c));function a45_0x38d3(_0x1b8f32,_0x3e8406){const _0x22253c=a45_0x2225();return a45_0x38d3=function(_0x38d371,_0x210175){_0x38d371=_0x38d371-0x1c6;let _0x90df77=_0x22253c[_0x38d371];return _0x90df77;},a45_0x38d3(_0x1b8f32,_0x3e8406);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a45_0x4da56d(0x23b)]=void 0x0;const loggerService_1=require(a45_0x4da56d(0x1e3));class PlisioService{constructor(){const _0x5735c3=a45_0x4da56d;this['apiUrl']=_0x5735c3(0x1ef),this['apiKey']=process[_0x5735c3(0x210)]['PLISIO_API_KEY']||'',!this['apiKey']?console[_0x5735c3(0x1ca)]('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console['log'](_0x5735c3(0x1f7));}async['createPayment'](_0x4b8144){const _0x10f66e=a45_0x4da56d,{orderId:_0x37c34b,amount:_0x113a25,currency:_0xa766e1,productName:_0x14998c,description:_0x3c6b93,successUrl:_0x4a7d94,failUrl:_0x484a96,customerEmail:_0x42f161,customerName:_0x4165b9,isSourceCurrency:_0x2f732a,sourceCurrency:_0xf0d452}=_0x4b8144;if(!this[_0x10f66e(0x1d0)])throw new Error(_0x10f66e(0x211));const _0x2d2cd6=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x37c34b,'order_name':_0x14998c,'description':_0x3c6b93,'success_url':_0x4a7d94,'fail_url':_0x484a96,'callback_url':_0x10f66e(0x23a)});_0xf0d452?(_0x2d2cd6[_0x10f66e(0x22b)](_0x10f66e(0x1e7),_0xf0d452),_0x2d2cd6[_0x10f66e(0x22b)](_0x10f66e(0x205),_0xa766e1),_0x2d2cd6[_0x10f66e(0x22b)](_0x10f66e(0x1eb),_0x113a25[_0x10f66e(0x219)]())):(_0x2d2cd6[_0x10f66e(0x22b)]('currency',_0xa766e1),_0x2d2cd6[_0x10f66e(0x22b)]('amount',_0x113a25[_0x10f66e(0x219)]()));_0x42f161&&_0x2d2cd6[_0x10f66e(0x22b)](_0x10f66e(0x22f),_0x42f161);_0x4165b9&&_0x2d2cd6[_0x10f66e(0x22b)]('name',_0x4165b9);const _0x36e099=this[_0x10f66e(0x1e1)]+'?'+_0x2d2cd6[_0x10f66e(0x219)](),_0x37d8dd=Date[_0x10f66e(0x209)]();try{console[_0x10f66e(0x1db)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x10f66e(0x1db)](_0x10f66e(0x21d),this[_0x10f66e(0x1e1)]),console[_0x10f66e(0x1db)](_0x10f66e(0x238),Object['fromEntries'](_0x2d2cd6[_0x10f66e(0x1c7)]())),console[_0x10f66e(0x1db)](_0x10f66e(0x230),_0x36e099[_0x10f66e(0x1dd)](this[_0x10f66e(0x1d0)],_0x10f66e(0x1cd))),loggerService_1[_0x10f66e(0x1d8)][_0x10f66e(0x1d2)](_0x10f66e(0x239),'/invoices/new',_0x10f66e(0x236),Object[_0x10f66e(0x22c)](_0x2d2cd6['entries']()));const _0x21dd4c=await fetch(_0x36e099,{'method':_0x10f66e(0x236),'headers':{'Accept':_0x10f66e(0x1d3),'User-Agent':_0x10f66e(0x1f6)}}),_0x454ded=Date[_0x10f66e(0x209)]()-_0x37d8dd;console[_0x10f66e(0x1db)](_0x10f66e(0x1d5)),console['log'](_0x10f66e(0x212),_0x21dd4c[_0x10f66e(0x1da)]),console[_0x10f66e(0x1db)](_0x10f66e(0x1f9),_0x21dd4c[_0x10f66e(0x1e4)]),console[_0x10f66e(0x1db)](_0x10f66e(0x1fc),_0x454ded+'ms');const _0x36bffe=await _0x21dd4c[_0x10f66e(0x21e)]();console['log'](_0x10f66e(0x237),_0x36bffe);if(!_0x21dd4c['ok']){console[_0x10f66e(0x1cf)](_0x10f66e(0x1cb)),console[_0x10f66e(0x1cf)](_0x10f66e(0x21c),_0x21dd4c[_0x10f66e(0x1da)]),console[_0x10f66e(0x1cf)](_0x10f66e(0x1f4),_0x36bffe),loggerService_1[_0x10f66e(0x1d8)]['logWhiteDomainResponse'](_0x10f66e(0x239),_0x10f66e(0x206),_0x21dd4c[_0x10f66e(0x1da)],_0x36bffe,_0x454ded),loggerService_1[_0x10f66e(0x1d8)][_0x10f66e(0x20f)](_0x10f66e(0x239),_0x10f66e(0x206),_0x10f66e(0x1d7)+_0x21dd4c[_0x10f66e(0x1da)]+':\x20'+_0x36bffe);throw new Error(_0x10f66e(0x21f)+_0x21dd4c['status']+_0x10f66e(0x1ee)+_0x36bffe);}let _0x3555d4;try{_0x3555d4=JSON[_0x10f66e(0x20d)](_0x36bffe);}catch(_0x2a2014){console['error'](_0x10f66e(0x217),_0x2a2014),loggerService_1[_0x10f66e(0x1d8)][_0x10f66e(0x20f)](_0x10f66e(0x239),_0x10f66e(0x206),_0x10f66e(0x223)+_0x2a2014);throw new Error(_0x10f66e(0x1f5)+_0x36bffe);}console[_0x10f66e(0x1db)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x10f66e(0x1db)](_0x10f66e(0x1f0),JSON[_0x10f66e(0x203)](_0x3555d4,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x10f66e(0x239),'/invoices/new',_0x21dd4c[_0x10f66e(0x1da)],_0x3555d4,_0x454ded);if(_0x3555d4['status']!==_0x10f66e(0x214)){const _0x130d31=_0x3555d4['message']||_0x3555d4['error']||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x10f66e(0x1cf)](_0x10f66e(0x224)),console['error']('Error\x20Message:',_0x130d31),loggerService_1[_0x10f66e(0x1d8)]['logWhiteDomainError'](_0x10f66e(0x239),_0x10f66e(0x206),_0x10f66e(0x1d4)+_0x130d31);throw new Error(_0x10f66e(0x235)+_0x130d31);}if(!_0x3555d4[_0x10f66e(0x221)]?.['txn_id']||!_0x3555d4[_0x10f66e(0x221)]?.[_0x10f66e(0x21b)]){console[_0x10f66e(0x1cf)](_0x10f66e(0x1e0)),console['error'](_0x10f66e(0x23c)),console['error'](_0x10f66e(0x1d9),_0x3555d4[_0x10f66e(0x221)]),loggerService_1[_0x10f66e(0x1d8)][_0x10f66e(0x20f)](_0x10f66e(0x239),_0x10f66e(0x206),_0x10f66e(0x208));throw new Error(_0x10f66e(0x1e9));}return console[_0x10f66e(0x1db)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x10f66e(0x1db)](_0x10f66e(0x22e),_0x3555d4[_0x10f66e(0x221)][_0x10f66e(0x1e6)]),console[_0x10f66e(0x1db)](_0x10f66e(0x1ea),_0x3555d4['data'][_0x10f66e(0x21b)]),console['log'](_0x10f66e(0x20e),_0x113a25,_0xa766e1),_0xf0d452&&(console['log']('Source\x20Currency:',_0xf0d452,_0x10f66e(0x1ff)),console[_0x10f66e(0x1db)]('Target\x20Currency:',_0xa766e1,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x3555d4[_0x10f66e(0x221)]['txn_id'],'payment_url':_0x3555d4[_0x10f66e(0x221)][_0x10f66e(0x21b)],'invoice_total_sum':_0x3555d4[_0x10f66e(0x221)][_0x10f66e(0x1c8)],'qr_code':_0x3555d4[_0x10f66e(0x221)]['qr_code'],'qr_url':_0x3555d4[_0x10f66e(0x221)][_0x10f66e(0x1ce)]};}catch(_0x313f99){console[_0x10f66e(0x1cf)](_0x10f66e(0x1f8)),console[_0x10f66e(0x1cf)](_0x10f66e(0x234),_0x313f99),loggerService_1[_0x10f66e(0x1d8)][_0x10f66e(0x20f)](_0x10f66e(0x239),_0x10f66e(0x206),_0x313f99);if(_0x313f99 instanceof Error){console[_0x10f66e(0x1cf)](_0x10f66e(0x1f1),_0x313f99[_0x10f66e(0x1e8)]),console[_0x10f66e(0x1cf)](_0x10f66e(0x1c6),_0x313f99['stack']);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x313f99[_0x10f66e(0x1e8)]);}throw new Error(_0x10f66e(0x1c9));}}async[a45_0x4da56d(0x201)](_0x449dbe){const _0x518844=a45_0x4da56d,_0x36a21e=Date[_0x518844(0x209)]();try{if(!this[_0x518844(0x1d0)])throw new Error(_0x518844(0x211));const _0x3871f2=new URLSearchParams({'api_key':this[_0x518844(0x1d0)],'txn_id':_0x449dbe}),_0x116189=_0x518844(0x229)+_0x449dbe+'?'+_0x3871f2[_0x518844(0x219)]();loggerService_1[_0x518844(0x1d8)][_0x518844(0x1d2)](_0x518844(0x239),_0x518844(0x207)+_0x449dbe,_0x518844(0x236),Object[_0x518844(0x22c)](_0x3871f2[_0x518844(0x1c7)]()));const _0x5ed10b=await fetch(_0x116189,{'method':_0x518844(0x236),'headers':{'Accept':_0x518844(0x1d3),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x79396c=Date[_0x518844(0x209)]()-_0x36a21e;if(!_0x5ed10b['ok']){const _0x2db9ef=await _0x5ed10b[_0x518844(0x21e)]();loggerService_1[_0x518844(0x1d8)]['logWhiteDomainResponse'](_0x518844(0x239),'/operations/'+_0x449dbe,_0x5ed10b['status'],_0x2db9ef,_0x79396c);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5ed10b[_0x518844(0x1da)]);}const _0x1928d9=await _0x5ed10b['json']();loggerService_1[_0x518844(0x1d8)][_0x518844(0x20a)]('plisio_direct',_0x518844(0x207)+_0x449dbe,_0x5ed10b[_0x518844(0x1da)],_0x1928d9,_0x79396c);if(_0x1928d9[_0x518844(0x1da)]!==_0x518844(0x214)){loggerService_1[_0x518844(0x1d8)][_0x518844(0x20f)](_0x518844(0x239),_0x518844(0x207)+_0x449dbe,_0x518844(0x235)+(_0x1928d9['message']||_0x1928d9['error']||_0x518844(0x1de)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x1928d9['message']||_0x1928d9[_0x518844(0x1cf)]||'Unknown\x20error'));}let _0x17cd26=_0x518844(0x1df);return{'status':_0x17cd26};}catch(_0x41fe73){console[_0x518844(0x1cf)](_0x518844(0x226),_0x41fe73),loggerService_1['loggerService'][_0x518844(0x20f)](_0x518844(0x239),_0x518844(0x207)+_0x449dbe,_0x41fe73);throw new Error(_0x518844(0x213)+(_0x41fe73 instanceof Error?_0x41fe73[_0x518844(0x1e8)]:_0x518844(0x1de)));}}async[a45_0x4da56d(0x1f3)](_0x537eb3){const _0xb279ff=a45_0x4da56d;console[_0xb279ff(0x1db)](_0xb279ff(0x1ed),_0x537eb3);let _0x3331b1='PENDING';switch(_0x537eb3[_0xb279ff(0x1da)]?.['toLowerCase']()){case _0xb279ff(0x20b):case _0xb279ff(0x22d):_0x3331b1='PAID';break;case _0xb279ff(0x215):_0x3331b1=_0xb279ff(0x231);break;case'error':case _0xb279ff(0x1fa):_0x3331b1=_0xb279ff(0x1fd);break;case _0xb279ff(0x227):_0x3331b1='PENDING';break;case _0xb279ff(0x220):_0x3331b1=_0xb279ff(0x233);break;default:_0x3331b1=_0xb279ff(0x1df);break;}let _0x373511;if(_0x537eb3[_0xb279ff(0x200)])try{console['log'](_0xb279ff(0x1fb),_0x537eb3['tx_urls']);let _0x12b26a;if(typeof _0x537eb3[_0xb279ff(0x200)]==='string')_0x12b26a=JSON[_0xb279ff(0x20d)](_0x537eb3[_0xb279ff(0x200)]);else Array[_0xb279ff(0x21a)](_0x537eb3[_0xb279ff(0x200)])?_0x12b26a=_0x537eb3[_0xb279ff(0x200)]:_0x12b26a=[];_0x373511=_0x12b26a[_0xb279ff(0x228)](_0x2ba897=>{const _0x37e4f6=_0xb279ff,_0x490f4b=_0x2ba897[_0x37e4f6(0x1dd)](/\\/g,'');return console[_0x37e4f6(0x1db)]('üîó\x20Formatted\x20URL:\x20'+_0x2ba897+'\x20->\x20'+_0x490f4b),_0x490f4b;}),console[_0xb279ff(0x1db)](_0xb279ff(0x216),_0x373511),_0x373511[_0xb279ff(0x202)]((_0x515518,_0x2a5164)=>{const _0x24cb69=_0xb279ff;try{new URL(_0x515518),console[_0x24cb69(0x1db)](_0x24cb69(0x232)+(_0x2a5164+0x1)+'\x20is\x20valid:\x20'+_0x515518);}catch(_0x1f56ca){console[_0x24cb69(0x1cf)](_0x24cb69(0x222)+(_0x2a5164+0x1)+_0x24cb69(0x20c)+_0x515518,_0x1f56ca);}});}catch(_0x11dfc6){console['error'](_0xb279ff(0x204),_0x11dfc6),console[_0xb279ff(0x1cf)](_0xb279ff(0x1fe),_0x537eb3[_0xb279ff(0x200)]),_0x373511=undefined;}return{'paymentId':_0x537eb3['order_number']||'','status':_0x3331b1,'amount':_0x537eb3[_0xb279ff(0x22a)],'currency':_0x537eb3[_0xb279ff(0x1e7)],'txUrls':_0x373511};}}exports[a45_0x4da56d(0x23b)]=PlisioService;