'use strict';const a55_0x129830=a55_0x38dc;(function(_0x513c57,_0x46c10e){const _0x3aaffc=a55_0x38dc,_0xa24d0f=_0x513c57();while(!![]){try{const _0x94fd13=-parseInt(_0x3aaffc(0x13b))/0x1+-parseInt(_0x3aaffc(0x190))/0x2+parseInt(_0x3aaffc(0x17a))/0x3+-parseInt(_0x3aaffc(0x149))/0x4*(parseInt(_0x3aaffc(0x156))/0x5)+parseInt(_0x3aaffc(0x1a1))/0x6*(-parseInt(_0x3aaffc(0x14e))/0x7)+parseInt(_0x3aaffc(0x16e))/0x8+parseInt(_0x3aaffc(0x186))/0x9;if(_0x94fd13===_0x46c10e)break;else _0xa24d0f['push'](_0xa24d0f['shift']());}catch(_0x2831d2){_0xa24d0f['push'](_0xa24d0f['shift']());}}}(a55_0x3458,0xebe80));Object[a55_0x129830(0x14c)](exports,a55_0x129830(0x139),{'value':!![]}),exports[a55_0x129830(0x194)]=void 0x0;function a55_0x3458(){const _0x5bafd9=['isArray','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','message','amount','PAID','Business\x20Error:\x20','toString','5uGzjkt','expired','currency','status','Payment\x20System/1.0','/operations/','PROCESSING','txn_id','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','warn','Plisio\x20API\x20key\x20is\x20not\x20configured','new','entries','loggerService','processWebhook','Amount:','Error\x20stack:','logWhiteDomainRequest','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','/invoices/new','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','now','https://api.plisio.net/api/v1/invoices/new','email','1321888DvJgIK','Error\x20message:','map','Transaction\x20ID:','fromEntries','replace','HTTP\x20','\x20->\x20','Response\x20data:','statusText','order_number','Failed\x20to\x20parse\x20JSON\x20response:','2609799lEGYWp','Error\x20Message:','cancelled','verifyPayment','Unknown\x20error\x20from\x20Plisio\x20API','error','log','Plisio\x20API\x20error:\x20','parse','(crypto\x20for\x20payment)','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Raw\x20tx_urls\x20data:','37179099usEJlr','qr_code','Target\x20Currency:','===\x20PLISIO\x20SUCCESS\x20===','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','mismatch','üîó\x20Formatted\x20URL:\x20','apiKey','toLowerCase','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','3240356rvJpoQ','Parameters:','EXPIRED','tx_urls','PlisioService','append','source_amount','../loggerService','https://api.plisio.net/api/v1/operations/','https://api.trapay.uk/api/webhooks/gateway/plisio','name','env','Raw\x20Response\x20Body:','PENDING','invoice_url','‚úÖ\x20Processed\x20tx_urls:','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','6QpugJV','HTTP\x20error!\x20status:\x20','logWhiteDomainError','Invoice\x20URL:','\x20is\x20valid:\x20','Error\x20details:','apiUrl','json','GET','__esModule','application/json','1009030PTocFd','source_currency','\x20is\x20invalid:\x20','data','text','Unknown\x20error','logWhiteDomainResponse','plisio_direct','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','qr_url','createPayment','URL:','‚úÖ\x20URL\x20','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','6159396oxwktz','stack','Source\x20Currency:','defineProperty','===\x20PLISIO\x20API\x20ERROR\x20===','215957zFRqbt'];a55_0x3458=function(){return _0x5bafd9;};return a55_0x3458();}function a55_0x38dc(_0x4a046e,_0x32759f){const _0x345836=a55_0x3458();return a55_0x38dc=function(_0x38dc0b,_0x18013b){_0x38dc0b=_0x38dc0b-0x136;let _0x1d8e91=_0x345836[_0x38dc0b];return _0x1d8e91;},a55_0x38dc(_0x4a046e,_0x32759f);}const loggerService_1=require(a55_0x129830(0x197));class PlisioService{constructor(){const _0x3890b0=a55_0x129830;this[_0x3890b0(0x136)]=_0x3890b0(0x16c),this[_0x3890b0(0x18d)]=process[_0x3890b0(0x19b)]['PLISIO_API_KEY']||'',!this['apiKey']?console[_0x3890b0(0x15f)]('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console['log'](_0x3890b0(0x184));}async[a55_0x129830(0x145)](_0x2b3f47){const _0x3a7dfd=a55_0x129830,{orderId:_0x2cb064,amount:_0x13638b,currency:_0x1c8de5,productName:_0x4ec7a9,description:_0x251da9,successUrl:_0x1315cd,failUrl:_0x3a210b,customerEmail:_0x53bded,customerName:_0x5c3110,isSourceCurrency:_0x579d61,sourceCurrency:_0x44dd2e}=_0x2b3f47;if(!this[_0x3a7dfd(0x18d)])throw new Error(_0x3a7dfd(0x160));const _0x471b67=new URLSearchParams({'api_key':this[_0x3a7dfd(0x18d)],'order_number':_0x2cb064,'order_name':_0x4ec7a9,'description':_0x251da9,'success_url':_0x1315cd,'fail_url':_0x3a210b,'callback_url':_0x3a7dfd(0x199)});_0x44dd2e?(_0x471b67[_0x3a7dfd(0x195)](_0x3a7dfd(0x158),_0x44dd2e),_0x471b67['append'](_0x3a7dfd(0x13c),_0x1c8de5),_0x471b67[_0x3a7dfd(0x195)](_0x3a7dfd(0x196),_0x13638b[_0x3a7dfd(0x155)]())):(_0x471b67[_0x3a7dfd(0x195)](_0x3a7dfd(0x158),_0x1c8de5),_0x471b67['append'](_0x3a7dfd(0x152),_0x13638b[_0x3a7dfd(0x155)]()));_0x53bded&&_0x471b67[_0x3a7dfd(0x195)](_0x3a7dfd(0x16d),_0x53bded);_0x5c3110&&_0x471b67[_0x3a7dfd(0x195)](_0x3a7dfd(0x19a),_0x5c3110);const _0x1fe503=this[_0x3a7dfd(0x136)]+'?'+_0x471b67[_0x3a7dfd(0x155)](),_0x1d3eaf=Date['now']();try{console['log'](_0x3a7dfd(0x143)),console['log'](_0x3a7dfd(0x146),this[_0x3a7dfd(0x136)]),console[_0x3a7dfd(0x180)](_0x3a7dfd(0x191),Object[_0x3a7dfd(0x172)](_0x471b67[_0x3a7dfd(0x162)]())),console[_0x3a7dfd(0x180)]('Full\x20URL\x20(without\x20API\x20key):',_0x1fe503[_0x3a7dfd(0x173)](this['apiKey'],'HIDDEN')),loggerService_1[_0x3a7dfd(0x163)]['logWhiteDomainRequest'](_0x3a7dfd(0x142),'/invoices/new',_0x3a7dfd(0x138),Object[_0x3a7dfd(0x172)](_0x471b67['entries']()));const _0x142708=await fetch(_0x1fe503,{'method':_0x3a7dfd(0x138),'headers':{'Accept':_0x3a7dfd(0x13a),'User-Agent':_0x3a7dfd(0x15a)}}),_0x2c7263=Date['now']()-_0x1d3eaf;console[_0x3a7dfd(0x180)](_0x3a7dfd(0x15e)),console[_0x3a7dfd(0x180)]('Status:',_0x142708[_0x3a7dfd(0x159)]),console[_0x3a7dfd(0x180)]('Status\x20Text:',_0x142708[_0x3a7dfd(0x177)]),console[_0x3a7dfd(0x180)]('Response\x20Time:',_0x2c7263+'ms');const _0x40ce4d=await _0x142708[_0x3a7dfd(0x13f)]();console[_0x3a7dfd(0x180)](_0x3a7dfd(0x19c),_0x40ce4d);if(!_0x142708['ok']){console[_0x3a7dfd(0x17f)](_0x3a7dfd(0x14d)),console[_0x3a7dfd(0x17f)]('HTTP\x20Status:',_0x142708['status']),console[_0x3a7dfd(0x17f)]('Response\x20Body:',_0x40ce4d),loggerService_1[_0x3a7dfd(0x163)][_0x3a7dfd(0x141)](_0x3a7dfd(0x142),_0x3a7dfd(0x169),_0x142708['status'],_0x40ce4d,_0x2c7263),loggerService_1[_0x3a7dfd(0x163)][_0x3a7dfd(0x1a3)](_0x3a7dfd(0x142),'/invoices/new',_0x3a7dfd(0x174)+_0x142708['status']+':\x20'+_0x40ce4d);throw new Error(_0x3a7dfd(0x1a2)+_0x142708[_0x3a7dfd(0x159)]+',\x20body:\x20'+_0x40ce4d);}let _0x17755;try{_0x17755=JSON[_0x3a7dfd(0x182)](_0x40ce4d);}catch(_0x56e788){console['error'](_0x3a7dfd(0x179),_0x56e788),loggerService_1[_0x3a7dfd(0x163)][_0x3a7dfd(0x1a3)](_0x3a7dfd(0x142),'/invoices/new','JSON\x20Parse\x20Error:\x20'+_0x56e788);throw new Error(_0x3a7dfd(0x168)+_0x40ce4d);}console['log'](_0x3a7dfd(0x16a)),console[_0x3a7dfd(0x180)]('Parsed\x20Result:',JSON['stringify'](_0x17755,null,0x2)),loggerService_1[_0x3a7dfd(0x163)]['logWhiteDomainResponse']('plisio_direct',_0x3a7dfd(0x169),_0x142708[_0x3a7dfd(0x159)],_0x17755,_0x2c7263);if(_0x17755[_0x3a7dfd(0x159)]!=='success'){const _0xb0f236=_0x17755[_0x3a7dfd(0x151)]||_0x17755[_0x3a7dfd(0x17f)]||_0x3a7dfd(0x17e);console['error'](_0x3a7dfd(0x18f)),console[_0x3a7dfd(0x17f)](_0x3a7dfd(0x17b),_0xb0f236),loggerService_1[_0x3a7dfd(0x163)]['logWhiteDomainError']('plisio_direct',_0x3a7dfd(0x169),_0x3a7dfd(0x154)+_0xb0f236);throw new Error('Plisio\x20API\x20error:\x20'+_0xb0f236);}if(!_0x17755[_0x3a7dfd(0x13e)]?.[_0x3a7dfd(0x15d)]||!_0x17755['data']?.[_0x3a7dfd(0x19e)]){console['error']('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3a7dfd(0x17f)](_0x3a7dfd(0x18a)),console[_0x3a7dfd(0x17f)](_0x3a7dfd(0x176),_0x17755[_0x3a7dfd(0x13e)]),loggerService_1[_0x3a7dfd(0x163)][_0x3a7dfd(0x1a3)]('plisio_direct','/invoices/new','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x3a7dfd(0x180)](_0x3a7dfd(0x189)),console[_0x3a7dfd(0x180)](_0x3a7dfd(0x171),_0x17755[_0x3a7dfd(0x13e)][_0x3a7dfd(0x15d)]),console[_0x3a7dfd(0x180)](_0x3a7dfd(0x1a4),_0x17755[_0x3a7dfd(0x13e)][_0x3a7dfd(0x19e)]),console[_0x3a7dfd(0x180)](_0x3a7dfd(0x165),_0x13638b,_0x1c8de5),_0x44dd2e&&(console[_0x3a7dfd(0x180)](_0x3a7dfd(0x14b),_0x44dd2e,_0x3a7dfd(0x183)),console[_0x3a7dfd(0x180)](_0x3a7dfd(0x188),_0x1c8de5,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x17755[_0x3a7dfd(0x13e)][_0x3a7dfd(0x15d)],'payment_url':_0x17755[_0x3a7dfd(0x13e)][_0x3a7dfd(0x19e)],'invoice_total_sum':_0x17755[_0x3a7dfd(0x13e)]['invoice_total_sum'],'qr_code':_0x17755[_0x3a7dfd(0x13e)][_0x3a7dfd(0x187)],'qr_url':_0x17755['data'][_0x3a7dfd(0x144)]};}catch(_0x15d0c3){console[_0x3a7dfd(0x17f)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x3a7dfd(0x17f)](_0x3a7dfd(0x1a6),_0x15d0c3),loggerService_1[_0x3a7dfd(0x163)][_0x3a7dfd(0x1a3)](_0x3a7dfd(0x142),'/invoices/new',_0x15d0c3);if(_0x15d0c3 instanceof Error){console['error'](_0x3a7dfd(0x16f),_0x15d0c3[_0x3a7dfd(0x151)]),console[_0x3a7dfd(0x17f)](_0x3a7dfd(0x166),_0x15d0c3[_0x3a7dfd(0x14a)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x15d0c3[_0x3a7dfd(0x151)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a55_0x129830(0x17d)](_0x33833d){const _0xa40ee5=a55_0x129830,_0x16fa30=Date['now']();try{if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x729ab3=new URLSearchParams({'api_key':this[_0xa40ee5(0x18d)],'txn_id':_0x33833d}),_0x53f65b=_0xa40ee5(0x198)+_0x33833d+'?'+_0x729ab3[_0xa40ee5(0x155)]();loggerService_1[_0xa40ee5(0x163)][_0xa40ee5(0x167)](_0xa40ee5(0x142),'/operations/'+_0x33833d,_0xa40ee5(0x138),Object['fromEntries'](_0x729ab3['entries']()));const _0x2bba21=await fetch(_0x53f65b,{'method':_0xa40ee5(0x138),'headers':{'Accept':'application/json','User-Agent':_0xa40ee5(0x15a)}}),_0x32d1f6=Date[_0xa40ee5(0x16b)]()-_0x16fa30;if(!_0x2bba21['ok']){const _0x218f72=await _0x2bba21['text']();loggerService_1[_0xa40ee5(0x163)]['logWhiteDomainResponse'](_0xa40ee5(0x142),_0xa40ee5(0x15b)+_0x33833d,_0x2bba21['status'],_0x218f72,_0x32d1f6);throw new Error(_0xa40ee5(0x1a2)+_0x2bba21[_0xa40ee5(0x159)]);}const _0x48a58c=await _0x2bba21[_0xa40ee5(0x137)]();loggerService_1[_0xa40ee5(0x163)][_0xa40ee5(0x141)](_0xa40ee5(0x142),_0xa40ee5(0x15b)+_0x33833d,_0x2bba21['status'],_0x48a58c,_0x32d1f6);if(_0x48a58c[_0xa40ee5(0x159)]!=='success'){loggerService_1['loggerService'][_0xa40ee5(0x1a3)]('plisio_direct',_0xa40ee5(0x15b)+_0x33833d,_0xa40ee5(0x181)+(_0x48a58c[_0xa40ee5(0x151)]||_0x48a58c[_0xa40ee5(0x17f)]||_0xa40ee5(0x140)));throw new Error(_0xa40ee5(0x181)+(_0x48a58c['message']||_0x48a58c[_0xa40ee5(0x17f)]||_0xa40ee5(0x140)));}let _0x4418ef=_0xa40ee5(0x19d);return{'status':_0x4418ef};}catch(_0x21812b){console[_0xa40ee5(0x17f)]('Plisio\x20payment\x20verification\x20error:',_0x21812b),loggerService_1['loggerService']['logWhiteDomainError'](_0xa40ee5(0x142),_0xa40ee5(0x15b)+_0x33833d,_0x21812b);throw new Error(_0xa40ee5(0x1a0)+(_0x21812b instanceof Error?_0x21812b[_0xa40ee5(0x151)]:_0xa40ee5(0x140)));}}async[a55_0x129830(0x164)](_0x257a46){const _0x10372b=a55_0x129830;console[_0x10372b(0x180)]('Processing\x20Plisio\x20webhook:',_0x257a46);let _0x2b5574=_0x10372b(0x19d);switch(_0x257a46[_0x10372b(0x159)]?.[_0x10372b(0x18e)]()){case'completed':case _0x10372b(0x18b):_0x2b5574=_0x10372b(0x153);break;case _0x10372b(0x157):_0x2b5574=_0x10372b(0x192);break;case _0x10372b(0x17f):case _0x10372b(0x17c):_0x2b5574='FAILED';break;case _0x10372b(0x161):_0x2b5574=_0x10372b(0x19d);break;case'pending':_0x2b5574=_0x10372b(0x15c);break;default:_0x2b5574=_0x10372b(0x19d);break;}let _0x398526;if(_0x257a46[_0x10372b(0x193)])try{console[_0x10372b(0x180)](_0x10372b(0x150),_0x257a46['tx_urls']);let _0x3ddca0;if(typeof _0x257a46[_0x10372b(0x193)]==='string')_0x3ddca0=JSON[_0x10372b(0x182)](_0x257a46[_0x10372b(0x193)]);else Array[_0x10372b(0x14f)](_0x257a46['tx_urls'])?_0x3ddca0=_0x257a46[_0x10372b(0x193)]:_0x3ddca0=[];_0x398526=_0x3ddca0[_0x10372b(0x170)](_0x2d6197=>{const _0x55e2e9=_0x10372b,_0x333ec8=_0x2d6197['replace'](/\\/g,'');return console['log'](_0x55e2e9(0x18c)+_0x2d6197+_0x55e2e9(0x175)+_0x333ec8),_0x333ec8;}),console[_0x10372b(0x180)](_0x10372b(0x19f),_0x398526),_0x398526['forEach']((_0x5ec85e,_0x356735)=>{const _0x396c93=_0x10372b;try{new URL(_0x5ec85e),console[_0x396c93(0x180)](_0x396c93(0x147)+(_0x356735+0x1)+_0x396c93(0x1a5)+_0x5ec85e);}catch(_0x25d422){console[_0x396c93(0x17f)]('‚ùå\x20URL\x20'+(_0x356735+0x1)+_0x396c93(0x13d)+_0x5ec85e,_0x25d422);}});}catch(_0x11aaa6){console[_0x10372b(0x17f)](_0x10372b(0x148),_0x11aaa6),console[_0x10372b(0x17f)](_0x10372b(0x185),_0x257a46['tx_urls']),_0x398526=undefined;}return{'paymentId':_0x257a46[_0x10372b(0x178)]||'','status':_0x2b5574,'amount':_0x257a46[_0x10372b(0x152)],'currency':_0x257a46['currency'],'txUrls':_0x398526};}}exports[a55_0x129830(0x194)]=PlisioService;