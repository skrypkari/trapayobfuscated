'use strict';const a52_0x49bb8c=a52_0x3cc4;(function(_0x16c8ba,_0x22392b){const _0x1b5bd7=a52_0x3cc4,_0x55fdf4=_0x16c8ba();while(!![]){try{const _0x52d58b=-parseInt(_0x1b5bd7(0x123))/0x1+parseInt(_0x1b5bd7(0x14c))/0x2+parseInt(_0x1b5bd7(0x140))/0x3*(parseInt(_0x1b5bd7(0x162))/0x4)+-parseInt(_0x1b5bd7(0x15d))/0x5*(-parseInt(_0x1b5bd7(0x118))/0x6)+-parseInt(_0x1b5bd7(0x10f))/0x7+parseInt(_0x1b5bd7(0x122))/0x8+parseInt(_0x1b5bd7(0x16e))/0x9;if(_0x52d58b===_0x22392b)break;else _0x55fdf4['push'](_0x55fdf4['shift']());}catch(_0x20df6e){_0x55fdf4['push'](_0x55fdf4['shift']());}}}(a52_0x4e4d,0x4742a));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a52_0x49bb8c(0x158)]=void 0x0;const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x33c510=a52_0x49bb8c;this['apiUrl']='https://api.plisio.net/api/v1/invoices/new',this[_0x33c510(0x15e)]=process[_0x33c510(0x13a)][_0x33c510(0x116)]||'',!this['apiKey']?console[_0x33c510(0x139)](_0x33c510(0x172)):console[_0x33c510(0x16c)](_0x33c510(0x13d));}async[a52_0x49bb8c(0x110)](_0x4f2758){const _0x4e9be5=a52_0x49bb8c,{orderId:_0x1830ea,amount:_0x245b33,currency:_0xa5f797,productName:_0x52b913,description:_0x4c1054,successUrl:_0x3e69e7,failUrl:_0x583e65,customerEmail:_0x4defc2,customerName:_0x2614bc,isSourceCurrency:_0x391369,sourceCurrency:_0xc11a9f}=_0x4f2758;if(!this[_0x4e9be5(0x15e)])throw new Error(_0x4e9be5(0x12c));const _0x206aa4=new URLSearchParams({'api_key':this[_0x4e9be5(0x15e)],'order_number':_0x1830ea,'order_name':_0x52b913,'description':_0x4c1054,'success_url':_0x3e69e7,'fail_url':_0x583e65,'callback_url':_0x4e9be5(0x12f)});_0xc11a9f?(_0x206aa4['append'](_0x4e9be5(0x128),_0xc11a9f),_0x206aa4[_0x4e9be5(0x178)]('source_currency',_0xa5f797),_0x206aa4[_0x4e9be5(0x178)]('source_amount',_0x245b33[_0x4e9be5(0x10c)]())):(_0x206aa4['append'](_0x4e9be5(0x128),_0xa5f797),_0x206aa4['append']('amount',_0x245b33[_0x4e9be5(0x10c)]()));_0x4defc2&&_0x206aa4['append'](_0x4e9be5(0x134),_0x4defc2);_0x2614bc&&_0x206aa4[_0x4e9be5(0x178)]('name',_0x2614bc);const _0x325c25=this[_0x4e9be5(0x135)]+'?'+_0x206aa4[_0x4e9be5(0x10c)](),_0x54269a=Date[_0x4e9be5(0x157)]();try{console['log'](_0x4e9be5(0x165)),console[_0x4e9be5(0x16c)](_0x4e9be5(0x12a),this['apiUrl']),console['log'](_0x4e9be5(0x155),Object[_0x4e9be5(0x13f)](_0x206aa4[_0x4e9be5(0x136)]())),console[_0x4e9be5(0x16c)](_0x4e9be5(0x167),_0x325c25[_0x4e9be5(0x146)](this['apiKey'],_0x4e9be5(0x138))),loggerService_1[_0x4e9be5(0x151)][_0x4e9be5(0x11e)](_0x4e9be5(0x154),_0x4e9be5(0x144),_0x4e9be5(0x111),Object[_0x4e9be5(0x13f)](_0x206aa4[_0x4e9be5(0x136)]()));const _0x2871b4=await fetch(_0x325c25,{'method':_0x4e9be5(0x111),'headers':{'Accept':'application/json','User-Agent':'Payment\x20System/1.0'}}),_0x3cbe76=Date[_0x4e9be5(0x157)]()-_0x54269a;console['log'](_0x4e9be5(0x137)),console['log'](_0x4e9be5(0x148),_0x2871b4[_0x4e9be5(0x156)]),console[_0x4e9be5(0x16c)](_0x4e9be5(0x127),_0x2871b4[_0x4e9be5(0x12b)]),console[_0x4e9be5(0x16c)](_0x4e9be5(0x147),_0x3cbe76+'ms');const _0x4efdc2=await _0x2871b4[_0x4e9be5(0x161)]();console[_0x4e9be5(0x16c)](_0x4e9be5(0x169),_0x4efdc2);if(!_0x2871b4['ok']){console['error'](_0x4e9be5(0x14a)),console[_0x4e9be5(0x160)](_0x4e9be5(0x170),_0x2871b4[_0x4e9be5(0x156)]),console[_0x4e9be5(0x160)]('Response\x20Body:',_0x4efdc2),loggerService_1['loggerService'][_0x4e9be5(0x131)]('plisio_direct',_0x4e9be5(0x144),_0x2871b4[_0x4e9be5(0x156)],_0x4efdc2,_0x3cbe76),loggerService_1[_0x4e9be5(0x151)][_0x4e9be5(0x132)](_0x4e9be5(0x154),_0x4e9be5(0x144),_0x4e9be5(0x15a)+_0x2871b4[_0x4e9be5(0x156)]+':\x20'+_0x4efdc2);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2871b4[_0x4e9be5(0x156)]+_0x4e9be5(0x113)+_0x4efdc2);}let _0x1cf333;try{_0x1cf333=JSON[_0x4e9be5(0x121)](_0x4efdc2);}catch(_0x238ab){console['error'](_0x4e9be5(0x171),_0x238ab),loggerService_1['loggerService'][_0x4e9be5(0x132)](_0x4e9be5(0x154),'/invoices/new','JSON\x20Parse\x20Error:\x20'+_0x238ab);throw new Error(_0x4e9be5(0x126)+_0x4efdc2);}console[_0x4e9be5(0x16c)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x4e9be5(0x16c)](_0x4e9be5(0x17a),JSON[_0x4e9be5(0x176)](_0x1cf333,null,0x2)),loggerService_1[_0x4e9be5(0x151)][_0x4e9be5(0x131)]('plisio_direct',_0x4e9be5(0x144),_0x2871b4[_0x4e9be5(0x156)],_0x1cf333,_0x3cbe76);if(_0x1cf333[_0x4e9be5(0x156)]!=='success'){const _0x3159d9=_0x1cf333[_0x4e9be5(0x15f)]||_0x1cf333['error']||_0x4e9be5(0x11c);console[_0x4e9be5(0x160)](_0x4e9be5(0x175)),console[_0x4e9be5(0x160)]('Error\x20Message:',_0x3159d9),loggerService_1[_0x4e9be5(0x151)]['logWhiteDomainError']('plisio_direct',_0x4e9be5(0x144),_0x4e9be5(0x13b)+_0x3159d9);throw new Error(_0x4e9be5(0x142)+_0x3159d9);}if(!_0x1cf333[_0x4e9be5(0x115)]?.[_0x4e9be5(0x124)]||!_0x1cf333['data']?.['invoice_url']){console[_0x4e9be5(0x160)](_0x4e9be5(0x14e)),console[_0x4e9be5(0x160)](_0x4e9be5(0x114)),console[_0x4e9be5(0x160)]('Response\x20data:',_0x1cf333[_0x4e9be5(0x115)]),loggerService_1[_0x4e9be5(0x151)][_0x4e9be5(0x132)](_0x4e9be5(0x154),'/invoices/new',_0x4e9be5(0x10d));throw new Error(_0x4e9be5(0x117));}return console[_0x4e9be5(0x16c)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x4e9be5(0x16c)](_0x4e9be5(0x152),_0x1cf333['data'][_0x4e9be5(0x124)]),console[_0x4e9be5(0x16c)](_0x4e9be5(0x14d),_0x1cf333[_0x4e9be5(0x115)][_0x4e9be5(0x177)]),console[_0x4e9be5(0x16c)]('Amount:',_0x245b33,_0xa5f797),_0xc11a9f&&(console[_0x4e9be5(0x16c)](_0x4e9be5(0x10e),_0xc11a9f,_0x4e9be5(0x145)),console[_0x4e9be5(0x16c)](_0x4e9be5(0x149),_0xa5f797,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x1cf333['data'][_0x4e9be5(0x124)],'payment_url':_0x1cf333[_0x4e9be5(0x115)][_0x4e9be5(0x177)],'invoice_total_sum':_0x1cf333['data'][_0x4e9be5(0x112)],'qr_code':_0x1cf333[_0x4e9be5(0x115)][_0x4e9be5(0x119)],'qr_url':_0x1cf333[_0x4e9be5(0x115)][_0x4e9be5(0x16a)]};}catch(_0x189e04){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x4e9be5(0x160)]('Error\x20details:',_0x189e04),loggerService_1[_0x4e9be5(0x151)][_0x4e9be5(0x132)](_0x4e9be5(0x154),_0x4e9be5(0x144),_0x189e04);if(_0x189e04 instanceof Error){console[_0x4e9be5(0x160)]('Error\x20message:',_0x189e04['message']),console[_0x4e9be5(0x160)](_0x4e9be5(0x16d),_0x189e04[_0x4e9be5(0x125)]);throw new Error(_0x4e9be5(0x153)+_0x189e04[_0x4e9be5(0x15f)]);}throw new Error(_0x4e9be5(0x11d));}}async[a52_0x49bb8c(0x14f)](_0x3cce84){const _0x2d6714=a52_0x49bb8c,_0x54d754=Date[_0x2d6714(0x157)]();try{if(!this['apiKey'])throw new Error(_0x2d6714(0x12c));const _0x5ed65c=new URLSearchParams({'api_key':this[_0x2d6714(0x15e)],'txn_id':_0x3cce84}),_0x28e3fd=_0x2d6714(0x10b)+_0x3cce84+'?'+_0x5ed65c[_0x2d6714(0x10c)]();loggerService_1[_0x2d6714(0x151)][_0x2d6714(0x11e)]('plisio_direct','/operations/'+_0x3cce84,_0x2d6714(0x111),Object[_0x2d6714(0x13f)](_0x5ed65c[_0x2d6714(0x136)]()));const _0x5054cb=await fetch(_0x28e3fd,{'method':_0x2d6714(0x111),'headers':{'Accept':_0x2d6714(0x12d),'User-Agent':_0x2d6714(0x164)}}),_0x3801c2=Date['now']()-_0x54d754;if(!_0x5054cb['ok']){const _0x5f13f7=await _0x5054cb['text']();loggerService_1[_0x2d6714(0x151)][_0x2d6714(0x131)]('plisio_direct','/operations/'+_0x3cce84,_0x5054cb[_0x2d6714(0x156)],_0x5f13f7,_0x3801c2);throw new Error(_0x2d6714(0x11f)+_0x5054cb['status']);}const _0x562528=await _0x5054cb['json']();loggerService_1[_0x2d6714(0x151)][_0x2d6714(0x131)](_0x2d6714(0x154),'/operations/'+_0x3cce84,_0x5054cb['status'],_0x562528,_0x3801c2);if(_0x562528['status']!=='success'){loggerService_1['loggerService'][_0x2d6714(0x132)](_0x2d6714(0x154),_0x2d6714(0x14b)+_0x3cce84,_0x2d6714(0x142)+(_0x562528['message']||_0x562528['error']||_0x2d6714(0x130)));throw new Error(_0x2d6714(0x142)+(_0x562528[_0x2d6714(0x15f)]||_0x562528[_0x2d6714(0x160)]||_0x2d6714(0x130)));}let _0x27ec1a=_0x2d6714(0x133);return{'status':_0x27ec1a};}catch(_0x388065){console[_0x2d6714(0x160)]('Plisio\x20payment\x20verification\x20error:',_0x388065),loggerService_1[_0x2d6714(0x151)][_0x2d6714(0x132)](_0x2d6714(0x154),'/operations/'+_0x3cce84,_0x388065);throw new Error(_0x2d6714(0x15c)+(_0x388065 instanceof Error?_0x388065[_0x2d6714(0x15f)]:'Unknown\x20error'));}}async[a52_0x49bb8c(0x15b)](_0x3a1146){const _0x594072=a52_0x49bb8c;console[_0x594072(0x16c)]('Processing\x20Plisio\x20webhook:',_0x3a1146);let _0x2e9e0d='PENDING';switch(_0x3a1146['status']?.['toLowerCase']()){case'completed':case'mismatch':_0x2e9e0d=_0x594072(0x159);break;case _0x594072(0x141):_0x2e9e0d=_0x594072(0x179);break;case _0x594072(0x160):case _0x594072(0x168):_0x2e9e0d='FAILED';break;case'new':_0x2e9e0d=_0x594072(0x133);break;case _0x594072(0x150):_0x2e9e0d=_0x594072(0x16f);break;default:_0x2e9e0d=_0x594072(0x133);break;}let _0x546ddf;if(_0x3a1146[_0x594072(0x11b)])try{console['log'](_0x594072(0x163),_0x3a1146[_0x594072(0x11b)]);let _0x25fe3b;if(typeof _0x3a1146[_0x594072(0x11b)]===_0x594072(0x120))_0x25fe3b=JSON[_0x594072(0x121)](_0x3a1146[_0x594072(0x11b)]);else Array[_0x594072(0x13e)](_0x3a1146[_0x594072(0x11b)])?_0x25fe3b=_0x3a1146[_0x594072(0x11b)]:_0x25fe3b=[];_0x546ddf=_0x25fe3b['map'](_0xe71b5c=>{const _0xc7d087=_0x594072,_0x359ecb=_0xe71b5c['replace'](/\\/g,'');return console[_0xc7d087(0x16c)]('🔗\x20Formatted\x20URL:\x20'+_0xe71b5c+_0xc7d087(0x13c)+_0x359ecb),_0x359ecb;}),console['log'](_0x594072(0x166),_0x546ddf),_0x546ddf['forEach']((_0x561c1e,_0x5f07f3)=>{const _0x1f1d6d=_0x594072;try{new URL(_0x561c1e),console[_0x1f1d6d(0x16c)](_0x1f1d6d(0x174)+(_0x5f07f3+0x1)+_0x1f1d6d(0x11a)+_0x561c1e);}catch(_0x5beed3){console[_0x1f1d6d(0x160)](_0x1f1d6d(0x16b)+(_0x5f07f3+0x1)+'\x20is\x20invalid:\x20'+_0x561c1e,_0x5beed3);}});}catch(_0x4c8775){console[_0x594072(0x160)](_0x594072(0x143),_0x4c8775),console['error'](_0x594072(0x12e),_0x3a1146[_0x594072(0x11b)]),_0x546ddf=undefined;}return{'paymentId':_0x3a1146[_0x594072(0x129)]||'','status':_0x2e9e0d,'amount':_0x3a1146[_0x594072(0x173)],'currency':_0x3a1146[_0x594072(0x128)],'txUrls':_0x546ddf};}}function a52_0x3cc4(_0x11d590,_0x51ce70){const _0x4e4d76=a52_0x4e4d();return a52_0x3cc4=function(_0x3cc4b9,_0x438c20){_0x3cc4b9=_0x3cc4b9-0x10b;let _0x4e2ea8=_0x4e4d76[_0x3cc4b9];return _0x4e2ea8;},a52_0x3cc4(_0x11d590,_0x51ce70);}function a52_0x4e4d(){const _0x1a3169=['replace','Response\x20Time:','Status:','Target\x20Currency:','===\x20PLISIO\x20API\x20ERROR\x20===','/operations/','250902AIEYGt','Invoice\x20URL:','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','verifyPayment','pending','loggerService','Transaction\x20ID:','Failed\x20to\x20create\x20Plisio\x20payment:\x20','plisio_direct','Parameters:','status','now','PlisioService','PAID','HTTP\x20','processWebhook','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','265GPFsYs','apiKey','message','error','text','1440360zPJUPC','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','Payment\x20System/1.0','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','✅\x20Processed\x20tx_urls:','Full\x20URL\x20(without\x20API\x20key):','cancelled','Raw\x20Response\x20Body:','qr_url','❌\x20URL\x20','log','Error\x20stack:','1430244fZikMw','PROCESSING','HTTP\x20Status:','Failed\x20to\x20parse\x20JSON\x20response:','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','amount','✅\x20URL\x20','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','stringify','invoice_url','append','EXPIRED','Parsed\x20Result:','https://api.plisio.net/api/v1/operations/','toString','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Source\x20Currency:','3506909hJWAvX','createPayment','GET','invoice_total_sum',',\x20body:\x20','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','data','PLISIO_API_KEY','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','18282uaMNgY','qr_code','\x20is\x20valid:\x20','tx_urls','Unknown\x20error\x20from\x20Plisio\x20API','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','logWhiteDomainRequest','HTTP\x20error!\x20status:\x20','string','parse','178496FuHTKC','35391bHRGUl','txn_id','stack','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Status\x20Text:','currency','order_number','URL:','statusText','Plisio\x20API\x20key\x20is\x20not\x20configured','application/json','Raw\x20tx_urls\x20data:','https://api.trapay.uk/api/webhooks/gateway/plisio','Unknown\x20error','logWhiteDomainResponse','logWhiteDomainError','PENDING','email','apiUrl','entries','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','HIDDEN','warn','env','Business\x20Error:\x20','\x20->\x20','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','isArray','fromEntries','3VSTZwI','expired','Plisio\x20API\x20error:\x20','❌\x20Failed\x20to\x20parse\x20tx_urls:','/invoices/new','(crypto\x20for\x20payment)'];a52_0x4e4d=function(){return _0x1a3169;};return a52_0x4e4d();}exports[a52_0x49bb8c(0x158)]=PlisioService;