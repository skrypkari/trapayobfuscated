'use strict';function a52_0xf5c4(){const _0x5cef13=['===\x20PLISIO\x20API\x20ERROR\x20===','Status\x20Text:','Plisio\x20API\x20error:\x20','Amount:',',\x20body:\x20','üîó\x20Formatted\x20URL:\x20','Response\x20Time:','now','583332aJwDyj','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','logWhiteDomainRequest','qr_code','Status:','pending','Payment\x20System/1.0','apiKey','HTTP\x20','https://api.trapay.uk/api/webhooks/gateway/plisio','processWebhook','text','invoice_url','Unknown\x20error','\x20is\x20valid:\x20','append','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','HTTP\x20Status:','message','PlisioService','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Parameters:','\x20is\x20invalid:\x20','txn_id','Invoice\x20URL:','parse','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Plisio\x20API\x20key\x20is\x20not\x20configured','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','application/json','invoice_total_sum','fromEntries','Response\x20data:','EXPIRED','Failed\x20to\x20parse\x20JSON\x20response:','1310ccGYQE','statusText','tx_urls','Processing\x20Plisio\x20webhook:','Unknown\x20error\x20from\x20Plisio\x20API','2KEIkNT','isArray','===\x20PLISIO\x20SUCCESS\x20===','verifyPayment','‚úÖ\x20Processed\x20tx_urls:','26653gYpJGM','Source\x20Currency:','Failed\x20to\x20create\x20Plisio\x20payment:\x20','defineProperty','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','stringify','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','1381635LrrAXO','logWhiteDomainResponse','toString','274928yqDzwn','Error\x20stack:','GET','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','amount','toLowerCase','warn','source_currency','/operations/','replace','source_amount','expired','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','URL:','plisio_direct','forEach','PROCESSING','loggerService','Parsed\x20Result:','error','153aZXHoc','entries','/invoices/new','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','(crypto\x20for\x20payment)','Business\x20Error:\x20','8321556BMaxZv','completed','currency','4080924BCzmis','5caWXmp','Error\x20message:','Raw\x20tx_urls\x20data:','data','HTTP\x20error!\x20status:\x20','HIDDEN','3dAHARH','status','apiUrl','success','JSON\x20Parse\x20Error:\x20','__esModule','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Raw\x20Response\x20Body:','26jINFSC','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','1008623CSgHXH','qr_url','Target\x20Currency:','Full\x20URL\x20(without\x20API\x20key):','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','log','‚úÖ\x20URL\x20','PENDING','Response\x20Body:','logWhiteDomainError','../loggerService','email','json','env','string'];a52_0xf5c4=function(){return _0x5cef13;};return a52_0xf5c4();}const a52_0x291979=a52_0x396f;(function(_0x4310a9,_0x164c86){const _0x3af7b4=a52_0x396f,_0x46d9a5=_0x4310a9();while(!![]){try{const _0x2e49de=parseInt(_0x3af7b4(0x17e))/0x1*(parseInt(_0x3af7b4(0x172))/0x2)+parseInt(_0x3af7b4(0x128))/0x3*(-parseInt(_0x3af7b4(0x14a))/0x4)+parseInt(_0x3af7b4(0x122))/0x5*(parseInt(_0x3af7b4(0x11e))/0x6)+-parseInt(_0x3af7b4(0x132))/0x7+-parseInt(_0x3af7b4(0x181))/0x8*(parseInt(_0x3af7b4(0x118))/0x9)+parseInt(_0x3af7b4(0x16d))/0xa*(-parseInt(_0x3af7b4(0x177))/0xb)+-parseInt(_0x3af7b4(0x121))/0xc*(parseInt(_0x3af7b4(0x130))/0xd);if(_0x2e49de===_0x164c86)break;else _0x46d9a5['push'](_0x46d9a5['shift']());}catch(_0x1816c4){_0x46d9a5['push'](_0x46d9a5['shift']());}}}(a52_0xf5c4,0xdaf52));Object[a52_0x291979(0x17a)](exports,a52_0x291979(0x12d),{'value':!![]}),exports[a52_0x291979(0x15d)]=void 0x0;function a52_0x396f(_0x424032,_0x25f97a){const _0xf5c4d7=a52_0xf5c4();return a52_0x396f=function(_0x396fbf,_0x4245b6){_0x396fbf=_0x396fbf-0x10c;let _0x3d2d4b=_0xf5c4d7[_0x396fbf];return _0x3d2d4b;},a52_0x396f(_0x424032,_0x25f97a);}const loggerService_1=require(a52_0x291979(0x13d));class PlisioService{constructor(){const _0x549404=a52_0x291979;this['apiUrl']='https://api.plisio.net/api/v1/invoices/new',this['apiKey']=process[_0x549404(0x140)]['PLISIO_API_KEY']||'',!this[_0x549404(0x151)]?console[_0x549404(0x187)](_0x549404(0x15e)):console[_0x549404(0x138)](_0x549404(0x17d));}async['createPayment'](_0x2dea6d){const _0x51af63=a52_0x291979,{orderId:_0x428217,amount:_0x42354a,currency:_0x47ca6e,productName:_0x2a8b99,description:_0x53a376,successUrl:_0x244389,failUrl:_0x16ec00,customerEmail:_0x1c6bb4,customerName:_0x1bd3ec,isSourceCurrency:_0x316c95,sourceCurrency:_0x13030c}=_0x2dea6d;if(!this[_0x51af63(0x151)])throw new Error(_0x51af63(0x165));const _0x1484d6=new URLSearchParams({'api_key':this[_0x51af63(0x151)],'order_number':_0x428217,'order_name':_0x2a8b99,'description':_0x53a376,'success_url':_0x244389,'fail_url':_0x16ec00,'callback_url':_0x51af63(0x153)});_0x13030c?(_0x1484d6[_0x51af63(0x159)]('currency',_0x13030c),_0x1484d6[_0x51af63(0x159)](_0x51af63(0x188),_0x47ca6e),_0x1484d6['append'](_0x51af63(0x10d),_0x42354a['toString']())):(_0x1484d6[_0x51af63(0x159)](_0x51af63(0x120),_0x47ca6e),_0x1484d6['append'](_0x51af63(0x185),_0x42354a[_0x51af63(0x180)]()));_0x1c6bb4&&_0x1484d6[_0x51af63(0x159)](_0x51af63(0x13e),_0x1c6bb4);_0x1bd3ec&&_0x1484d6[_0x51af63(0x159)]('name',_0x1bd3ec);const _0x731b9a=this['apiUrl']+'?'+_0x1484d6[_0x51af63(0x180)](),_0x2313fd=Date['now']();try{console['log'](_0x51af63(0x136)),console[_0x51af63(0x138)](_0x51af63(0x111),this[_0x51af63(0x12a)]),console[_0x51af63(0x138)](_0x51af63(0x15f),Object[_0x51af63(0x169)](_0x1484d6['entries']())),console[_0x51af63(0x138)](_0x51af63(0x135),_0x731b9a[_0x51af63(0x10c)](this[_0x51af63(0x151)],_0x51af63(0x127))),loggerService_1[_0x51af63(0x115)]['logWhiteDomainRequest']('plisio_direct','/invoices/new','GET',Object[_0x51af63(0x169)](_0x1484d6[_0x51af63(0x119)]()));const _0x304113=await fetch(_0x731b9a,{'method':_0x51af63(0x183),'headers':{'Accept':_0x51af63(0x167),'User-Agent':_0x51af63(0x150)}}),_0x2ec8a7=Date[_0x51af63(0x149)]()-_0x2313fd;console[_0x51af63(0x138)](_0x51af63(0x15a)),console[_0x51af63(0x138)](_0x51af63(0x14e),_0x304113['status']),console[_0x51af63(0x138)](_0x51af63(0x143),_0x304113[_0x51af63(0x16e)]),console[_0x51af63(0x138)](_0x51af63(0x148),_0x2ec8a7+'ms');const _0x15e455=await _0x304113['text']();console['log'](_0x51af63(0x12f),_0x15e455);if(!_0x304113['ok']){console['error'](_0x51af63(0x142)),console[_0x51af63(0x117)](_0x51af63(0x15b),_0x304113[_0x51af63(0x129)]),console['error'](_0x51af63(0x13b),_0x15e455),loggerService_1[_0x51af63(0x115)][_0x51af63(0x17f)](_0x51af63(0x112),_0x51af63(0x11a),_0x304113['status'],_0x15e455,_0x2ec8a7),loggerService_1['loggerService'][_0x51af63(0x13c)](_0x51af63(0x112),_0x51af63(0x11a),_0x51af63(0x152)+_0x304113[_0x51af63(0x129)]+':\x20'+_0x15e455);throw new Error(_0x51af63(0x126)+_0x304113[_0x51af63(0x129)]+_0x51af63(0x146)+_0x15e455);}let _0xbd1fe2;try{_0xbd1fe2=JSON[_0x51af63(0x163)](_0x15e455);}catch(_0x253028){console['error'](_0x51af63(0x16c),_0x253028),loggerService_1[_0x51af63(0x115)]['logWhiteDomainError'](_0x51af63(0x112),_0x51af63(0x11a),_0x51af63(0x12c)+_0x253028);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x15e455);}console[_0x51af63(0x138)](_0x51af63(0x110)),console[_0x51af63(0x138)](_0x51af63(0x116),JSON[_0x51af63(0x17c)](_0xbd1fe2,null,0x2)),loggerService_1[_0x51af63(0x115)][_0x51af63(0x17f)](_0x51af63(0x112),'/invoices/new',_0x304113[_0x51af63(0x129)],_0xbd1fe2,_0x2ec8a7);if(_0xbd1fe2[_0x51af63(0x129)]!=='success'){const _0x588b33=_0xbd1fe2[_0x51af63(0x15c)]||_0xbd1fe2['error']||_0x51af63(0x171);console[_0x51af63(0x117)](_0x51af63(0x184)),console[_0x51af63(0x117)]('Error\x20Message:',_0x588b33),loggerService_1['loggerService'][_0x51af63(0x13c)](_0x51af63(0x112),_0x51af63(0x11a),_0x51af63(0x11d)+_0x588b33);throw new Error(_0x51af63(0x144)+_0x588b33);}if(!_0xbd1fe2[_0x51af63(0x125)]?.['txn_id']||!_0xbd1fe2[_0x51af63(0x125)]?.[_0x51af63(0x156)]){console[_0x51af63(0x117)](_0x51af63(0x10f)),console[_0x51af63(0x117)](_0x51af63(0x14b)),console['error'](_0x51af63(0x16a),_0xbd1fe2[_0x51af63(0x125)]),loggerService_1[_0x51af63(0x115)]['logWhiteDomainError'](_0x51af63(0x112),_0x51af63(0x11a),_0x51af63(0x12e));throw new Error(_0x51af63(0x164));}return console[_0x51af63(0x138)](_0x51af63(0x174)),console['log']('Transaction\x20ID:',_0xbd1fe2['data'][_0x51af63(0x161)]),console[_0x51af63(0x138)](_0x51af63(0x162),_0xbd1fe2['data'][_0x51af63(0x156)]),console[_0x51af63(0x138)](_0x51af63(0x145),_0x42354a,_0x47ca6e),_0x13030c&&(console[_0x51af63(0x138)](_0x51af63(0x178),_0x13030c,_0x51af63(0x11c)),console[_0x51af63(0x138)](_0x51af63(0x134),_0x47ca6e,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0xbd1fe2['data'][_0x51af63(0x161)],'payment_url':_0xbd1fe2[_0x51af63(0x125)][_0x51af63(0x156)],'invoice_total_sum':_0xbd1fe2[_0x51af63(0x125)][_0x51af63(0x168)],'qr_code':_0xbd1fe2[_0x51af63(0x125)][_0x51af63(0x14d)],'qr_url':_0xbd1fe2[_0x51af63(0x125)][_0x51af63(0x133)]};}catch(_0x1f3634){console[_0x51af63(0x117)](_0x51af63(0x166)),console[_0x51af63(0x117)]('Error\x20details:',_0x1f3634),loggerService_1[_0x51af63(0x115)][_0x51af63(0x13c)]('plisio_direct','/invoices/new',_0x1f3634);if(_0x1f3634 instanceof Error){console[_0x51af63(0x117)](_0x51af63(0x123),_0x1f3634[_0x51af63(0x15c)]),console['error'](_0x51af63(0x182),_0x1f3634['stack']);throw new Error(_0x51af63(0x179)+_0x1f3634['message']);}throw new Error(_0x51af63(0x131));}}async[a52_0x291979(0x175)](_0x389dc){const _0x5daafb=a52_0x291979,_0x92105c=Date[_0x5daafb(0x149)]();try{if(!this['apiKey'])throw new Error(_0x5daafb(0x165));const _0x522ecf=new URLSearchParams({'api_key':this[_0x5daafb(0x151)],'txn_id':_0x389dc}),_0x22c4da='https://api.plisio.net/api/v1/operations/'+_0x389dc+'?'+_0x522ecf[_0x5daafb(0x180)]();loggerService_1['loggerService'][_0x5daafb(0x14c)](_0x5daafb(0x112),'/operations/'+_0x389dc,_0x5daafb(0x183),Object[_0x5daafb(0x169)](_0x522ecf[_0x5daafb(0x119)]()));const _0x363d8c=await fetch(_0x22c4da,{'method':_0x5daafb(0x183),'headers':{'Accept':_0x5daafb(0x167),'User-Agent':'Payment\x20System/1.0'}}),_0x65434f=Date[_0x5daafb(0x149)]()-_0x92105c;if(!_0x363d8c['ok']){const _0x50e860=await _0x363d8c[_0x5daafb(0x155)]();loggerService_1[_0x5daafb(0x115)][_0x5daafb(0x17f)](_0x5daafb(0x112),_0x5daafb(0x189)+_0x389dc,_0x363d8c[_0x5daafb(0x129)],_0x50e860,_0x65434f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x363d8c[_0x5daafb(0x129)]);}const _0x564123=await _0x363d8c[_0x5daafb(0x13f)]();loggerService_1[_0x5daafb(0x115)][_0x5daafb(0x17f)](_0x5daafb(0x112),'/operations/'+_0x389dc,_0x363d8c[_0x5daafb(0x129)],_0x564123,_0x65434f);if(_0x564123['status']!==_0x5daafb(0x12b)){loggerService_1[_0x5daafb(0x115)][_0x5daafb(0x13c)](_0x5daafb(0x112),_0x5daafb(0x189)+_0x389dc,_0x5daafb(0x144)+(_0x564123[_0x5daafb(0x15c)]||_0x564123['error']||'Unknown\x20error'));throw new Error(_0x5daafb(0x144)+(_0x564123['message']||_0x564123['error']||'Unknown\x20error'));}let _0xa1809e=_0x5daafb(0x13a);return{'status':_0xa1809e};}catch(_0x220454){console[_0x5daafb(0x117)]('Plisio\x20payment\x20verification\x20error:',_0x220454),loggerService_1[_0x5daafb(0x115)][_0x5daafb(0x13c)]('plisio_direct','/operations/'+_0x389dc,_0x220454);throw new Error(_0x5daafb(0x17b)+(_0x220454 instanceof Error?_0x220454['message']:_0x5daafb(0x157)));}}async[a52_0x291979(0x154)](_0xee6a5d){const _0x3fa5bb=a52_0x291979;console[_0x3fa5bb(0x138)](_0x3fa5bb(0x170),_0xee6a5d);let _0x3db91a=_0x3fa5bb(0x13a);switch(_0xee6a5d[_0x3fa5bb(0x129)]?.[_0x3fa5bb(0x186)]()){case _0x3fa5bb(0x11f):case'mismatch':_0x3db91a='PAID';break;case _0x3fa5bb(0x10e):_0x3db91a=_0x3fa5bb(0x16b);break;case _0x3fa5bb(0x117):case'cancelled':_0x3db91a='FAILED';break;case'new':_0x3db91a=_0x3fa5bb(0x13a);break;case _0x3fa5bb(0x14f):_0x3db91a=_0x3fa5bb(0x114);break;default:_0x3db91a=_0x3fa5bb(0x13a);break;}let _0x3f0264;if(_0xee6a5d[_0x3fa5bb(0x16f)])try{console['log'](_0x3fa5bb(0x137),_0xee6a5d['tx_urls']);let _0x53ab21;if(typeof _0xee6a5d[_0x3fa5bb(0x16f)]===_0x3fa5bb(0x141))_0x53ab21=JSON[_0x3fa5bb(0x163)](_0xee6a5d[_0x3fa5bb(0x16f)]);else Array[_0x3fa5bb(0x173)](_0xee6a5d['tx_urls'])?_0x53ab21=_0xee6a5d[_0x3fa5bb(0x16f)]:_0x53ab21=[];_0x3f0264=_0x53ab21['map'](_0x357f4e=>{const _0x53956e=_0x3fa5bb,_0x563aee=_0x357f4e[_0x53956e(0x10c)](/\\/g,'');return console['log'](_0x53956e(0x147)+_0x357f4e+'\x20->\x20'+_0x563aee),_0x563aee;}),console[_0x3fa5bb(0x138)](_0x3fa5bb(0x176),_0x3f0264),_0x3f0264[_0x3fa5bb(0x113)]((_0x10defd,_0x25e1a6)=>{const _0x5bd1e3=_0x3fa5bb;try{new URL(_0x10defd),console[_0x5bd1e3(0x138)](_0x5bd1e3(0x139)+(_0x25e1a6+0x1)+_0x5bd1e3(0x158)+_0x10defd);}catch(_0x52f65b){console[_0x5bd1e3(0x117)]('‚ùå\x20URL\x20'+(_0x25e1a6+0x1)+_0x5bd1e3(0x160)+_0x10defd,_0x52f65b);}});}catch(_0xa228cc){console[_0x3fa5bb(0x117)](_0x3fa5bb(0x11b),_0xa228cc),console['error'](_0x3fa5bb(0x124),_0xee6a5d[_0x3fa5bb(0x16f)]),_0x3f0264=undefined;}return{'paymentId':_0xee6a5d['order_number']||'','status':_0x3db91a,'amount':_0xee6a5d[_0x3fa5bb(0x185)],'currency':_0xee6a5d['currency'],'txUrls':_0x3f0264};}}exports[a52_0x291979(0x15d)]=PlisioService;