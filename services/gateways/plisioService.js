'use strict';const a41_0x3eecb8=a41_0x5e38;(function(_0x1344a1,_0x5d961c){const _0x45033e=a41_0x5e38,_0x438b56=_0x1344a1();while(!![]){try{const _0x5a0102=parseInt(_0x45033e(0x192))/0x1+parseInt(_0x45033e(0x197))/0x2*(-parseInt(_0x45033e(0x16f))/0x3)+parseInt(_0x45033e(0x184))/0x4+parseInt(_0x45033e(0x1c6))/0x5*(parseInt(_0x45033e(0x191))/0x6)+parseInt(_0x45033e(0x1a8))/0x7*(-parseInt(_0x45033e(0x16b))/0x8)+-parseInt(_0x45033e(0x18b))/0x9+parseInt(_0x45033e(0x1da))/0xa;if(_0x5a0102===_0x5d961c)break;else _0x438b56['push'](_0x438b56['shift']());}catch(_0x2004c1){_0x438b56['push'](_0x438b56['shift']());}}}(a41_0x4118,0x324a5));function a41_0x5e38(_0x43c33b,_0x98fb59){const _0x41185b=a41_0x4118();return a41_0x5e38=function(_0x5e38fc,_0x49852f){_0x5e38fc=_0x5e38fc-0x167;let _0x3d22c4=_0x41185b[_0x5e38fc];return _0x3d22c4;},a41_0x5e38(_0x43c33b,_0x98fb59);}Object[a41_0x3eecb8(0x176)](exports,'__esModule',{'value':!![]}),exports[a41_0x3eecb8(0x19b)]=void 0x0;const loggerService_1=require('../loggerService');function a41_0x4118(){const _0x408098=['forEach','qr_code','Status:','3CoryQJ','parse','pending','data','Plisio\x20API\x20error:\x20','txn_id','verifyPayment','defineProperty','apiKey','now','json','stringify','HTTP\x20Status:','Response\x20data:','mismatch','Unknown\x20error\x20from\x20Plisio\x20API','logWhiteDomainRequest','Invoice\x20URL:','Source\x20Currency:','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','\x20is\x20invalid:\x20','763664HgLBwH','HTTP\x20','isArray','Raw\x20tx_urls\x20data:','PENDING','https://api.plisio.net/api/v1/operations/','replace','2812491TmEnkp','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','logWhiteDomainError','HTTP\x20error!\x20status:\x20','string','https://api.plisio.net/api/v1/invoices/new','5862pZpGyq','318775XogFkO','EXPIRED','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','entries','invoice_url','284150tyJmeX','(crypto\x20for\x20payment)','append','Target\x20Currency:','PlisioService','\x20is\x20valid:\x20','qr_url','name','completed','Error\x20message:','source_currency','Error\x20Message:','loggerService','HIDDEN','Failed\x20to\x20parse\x20JSON\x20response:','PLISIO_API_KEY','Unknown\x20error','25186tXNRyj','stack','log','Plisio\x20payment\x20verification\x20error:','cancelled','Business\x20Error:\x20','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','order_number','fromEntries','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Amount:','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','logWhiteDomainResponse','URL:','Full\x20URL\x20(without\x20API\x20key):','Error\x20stack:','apiUrl','Plisio\x20API\x20key\x20is\x20not\x20configured','text','GET','===\x20PLISIO\x20SUCCESS\x20===','env','Response\x20Body:','toString','üîó\x20Formatted\x20URL:\x20','Error\x20details:','Raw\x20Response\x20Body:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','map','===\x20PLISIO\x20API\x20ERROR\x20===','1055wYrDQW','statusText','/operations/','‚úÖ\x20URL\x20','message','email','amount','success','currency','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','JSON\x20Parse\x20Error:\x20','TesSoft\x20Payment\x20System/1.0','invoice_total_sum','(fiat\x20for\x20merchant)','tx_urls','/invoices/new','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','status','error','application/json','3333090frXkvv','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','source_amount','Transaction\x20ID:','plisio_direct','864qCYJbd'];a41_0x4118=function(){return _0x408098;};return a41_0x4118();}class PlisioService{constructor(){const _0x5544f3=a41_0x3eecb8;this['apiUrl']=_0x5544f3(0x190),this[_0x5544f3(0x177)]=process[_0x5544f3(0x1bd)][_0x5544f3(0x1a6)]||'',!this[_0x5544f3(0x177)]?console['warn']('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x5544f3(0x1aa)](_0x5544f3(0x194));}async['createPayment'](_0x5adca8){const _0x58c7a5=a41_0x3eecb8,{orderId:_0x2ea4f5,amount:_0x4607c3,currency:_0x1e581f,productName:_0x5c83ed,description:_0x1e99c1,successUrl:_0x1dc35e,failUrl:_0x1baf3b,customerEmail:_0x431ce2,customerName:_0x636cee,isSourceCurrency:_0x3912d7,sourceCurrency:_0x4c2916}=_0x5adca8;if(!this[_0x58c7a5(0x177)])throw new Error(_0x58c7a5(0x1b9));const _0x2971b4=new URLSearchParams({'api_key':this[_0x58c7a5(0x177)],'order_number':_0x2ea4f5,'order_name':_0x5c83ed,'description':_0x1e99c1,'success_url':_0x1dc35e,'fail_url':_0x1baf3b,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x4c2916?(_0x2971b4[_0x58c7a5(0x199)](_0x58c7a5(0x1ce),_0x4c2916),_0x2971b4[_0x58c7a5(0x199)](_0x58c7a5(0x1a1),_0x1e581f),_0x2971b4[_0x58c7a5(0x199)](_0x58c7a5(0x168),_0x4607c3['toString']())):(_0x2971b4[_0x58c7a5(0x199)](_0x58c7a5(0x1ce),_0x1e581f),_0x2971b4[_0x58c7a5(0x199)]('amount',_0x4607c3[_0x58c7a5(0x1bf)]()));_0x431ce2&&_0x2971b4[_0x58c7a5(0x199)](_0x58c7a5(0x1cb),_0x431ce2);_0x636cee&&_0x2971b4[_0x58c7a5(0x199)](_0x58c7a5(0x19e),_0x636cee);const _0x11fc28=this[_0x58c7a5(0x1b8)]+'?'+_0x2971b4[_0x58c7a5(0x1bf)](),_0x1f8b6e=Date['now']();try{console[_0x58c7a5(0x1aa)](_0x58c7a5(0x1d6)),console[_0x58c7a5(0x1aa)](_0x58c7a5(0x1b5),this[_0x58c7a5(0x1b8)]),console[_0x58c7a5(0x1aa)]('Parameters:',Object[_0x58c7a5(0x1b0)](_0x2971b4[_0x58c7a5(0x195)]())),console[_0x58c7a5(0x1aa)](_0x58c7a5(0x1b6),_0x11fc28[_0x58c7a5(0x18a)](this[_0x58c7a5(0x177)],_0x58c7a5(0x1a4))),loggerService_1[_0x58c7a5(0x1a3)]['logWhiteDomainRequest'](_0x58c7a5(0x16a),_0x58c7a5(0x1d5),'GET',Object[_0x58c7a5(0x1b0)](_0x2971b4[_0x58c7a5(0x195)]()));const _0xa6516=await fetch(_0x11fc28,{'method':_0x58c7a5(0x1bb),'headers':{'Accept':'application/json','User-Agent':_0x58c7a5(0x1d1)}}),_0x28b882=Date['now']()-_0x1f8b6e;console[_0x58c7a5(0x1aa)](_0x58c7a5(0x1ae)),console[_0x58c7a5(0x1aa)](_0x58c7a5(0x16e),_0xa6516[_0x58c7a5(0x1d7)]),console[_0x58c7a5(0x1aa)]('Status\x20Text:',_0xa6516[_0x58c7a5(0x1c7)]),console[_0x58c7a5(0x1aa)]('Response\x20Time:',_0x28b882+'ms');const _0x5e2eaf=await _0xa6516[_0x58c7a5(0x1ba)]();console['log'](_0x58c7a5(0x1c2),_0x5e2eaf);if(!_0xa6516['ok']){console[_0x58c7a5(0x1d8)](_0x58c7a5(0x1c5)),console[_0x58c7a5(0x1d8)](_0x58c7a5(0x17b),_0xa6516[_0x58c7a5(0x1d7)]),console['error'](_0x58c7a5(0x1be),_0x5e2eaf),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x58c7a5(0x16a),_0x58c7a5(0x1d5),_0xa6516['status'],_0x5e2eaf,_0x28b882),loggerService_1[_0x58c7a5(0x1a3)][_0x58c7a5(0x18d)]('plisio_direct',_0x58c7a5(0x1d5),_0x58c7a5(0x185)+_0xa6516[_0x58c7a5(0x1d7)]+':\x20'+_0x5e2eaf);throw new Error('HTTP\x20error!\x20status:\x20'+_0xa6516[_0x58c7a5(0x1d7)]+',\x20body:\x20'+_0x5e2eaf);}let _0x31acae;try{_0x31acae=JSON[_0x58c7a5(0x170)](_0x5e2eaf);}catch(_0xd94619){console[_0x58c7a5(0x1d8)](_0x58c7a5(0x1a5),_0xd94619),loggerService_1[_0x58c7a5(0x1a3)][_0x58c7a5(0x18d)](_0x58c7a5(0x16a),_0x58c7a5(0x1d5),_0x58c7a5(0x1d0)+_0xd94619);throw new Error(_0x58c7a5(0x1c3)+_0x5e2eaf);}console['log']('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x58c7a5(0x1aa)]('Parsed\x20Result:',JSON[_0x58c7a5(0x17a)](_0x31acae,null,0x2)),loggerService_1[_0x58c7a5(0x1a3)][_0x58c7a5(0x1b4)]('plisio_direct',_0x58c7a5(0x1d5),_0xa6516[_0x58c7a5(0x1d7)],_0x31acae,_0x28b882);if(_0x31acae[_0x58c7a5(0x1d7)]!==_0x58c7a5(0x1cd)){const _0x34d435=_0x31acae[_0x58c7a5(0x1ca)]||_0x31acae['error']||_0x58c7a5(0x17e);console[_0x58c7a5(0x1d8)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x58c7a5(0x1d8)](_0x58c7a5(0x1a2),_0x34d435),loggerService_1[_0x58c7a5(0x1a3)][_0x58c7a5(0x18d)](_0x58c7a5(0x16a),'/invoices/new',_0x58c7a5(0x1ad)+_0x34d435);throw new Error('Plisio\x20API\x20error:\x20'+_0x34d435);}if(!_0x31acae[_0x58c7a5(0x172)]?.[_0x58c7a5(0x174)]||!_0x31acae['data']?.[_0x58c7a5(0x196)]){console[_0x58c7a5(0x1d8)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x58c7a5(0x1d8)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x58c7a5(0x1d8)](_0x58c7a5(0x17c),_0x31acae['data']),loggerService_1[_0x58c7a5(0x1a3)][_0x58c7a5(0x18d)](_0x58c7a5(0x16a),_0x58c7a5(0x1d5),_0x58c7a5(0x1b1));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x58c7a5(0x1aa)](_0x58c7a5(0x1bc)),console[_0x58c7a5(0x1aa)](_0x58c7a5(0x169),_0x31acae[_0x58c7a5(0x172)]['txn_id']),console[_0x58c7a5(0x1aa)](_0x58c7a5(0x180),_0x31acae[_0x58c7a5(0x172)][_0x58c7a5(0x196)]),console[_0x58c7a5(0x1aa)](_0x58c7a5(0x1b2),_0x4607c3,_0x1e581f),_0x4c2916&&(console[_0x58c7a5(0x1aa)](_0x58c7a5(0x181),_0x4c2916,_0x58c7a5(0x198)),console['log'](_0x58c7a5(0x19a),_0x1e581f,_0x58c7a5(0x1d3))),{'gateway_payment_id':_0x31acae[_0x58c7a5(0x172)][_0x58c7a5(0x174)],'payment_url':_0x31acae[_0x58c7a5(0x172)][_0x58c7a5(0x196)],'invoice_total_sum':_0x31acae[_0x58c7a5(0x172)][_0x58c7a5(0x1d2)],'qr_code':_0x31acae[_0x58c7a5(0x172)][_0x58c7a5(0x16d)],'qr_url':_0x31acae[_0x58c7a5(0x172)][_0x58c7a5(0x19d)]};}catch(_0x1cf8f9){console['error'](_0x58c7a5(0x167)),console[_0x58c7a5(0x1d8)](_0x58c7a5(0x1c1),_0x1cf8f9),loggerService_1['loggerService'][_0x58c7a5(0x18d)](_0x58c7a5(0x16a),'/invoices/new',_0x1cf8f9);if(_0x1cf8f9 instanceof Error){console[_0x58c7a5(0x1d8)](_0x58c7a5(0x1a0),_0x1cf8f9['message']),console['error'](_0x58c7a5(0x1b7),_0x1cf8f9[_0x58c7a5(0x1a9)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x1cf8f9[_0x58c7a5(0x1ca)]);}throw new Error(_0x58c7a5(0x18c));}}async[a41_0x3eecb8(0x175)](_0x26d0f8){const _0x5c56d4=a41_0x3eecb8,_0xd064eb=Date[_0x5c56d4(0x178)]();try{if(!this[_0x5c56d4(0x177)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0xa37830=new URLSearchParams({'api_key':this[_0x5c56d4(0x177)],'txn_id':_0x26d0f8}),_0x4a36fa=_0x5c56d4(0x189)+_0x26d0f8+'?'+_0xa37830['toString']();loggerService_1[_0x5c56d4(0x1a3)][_0x5c56d4(0x17f)](_0x5c56d4(0x16a),'/operations/'+_0x26d0f8,_0x5c56d4(0x1bb),Object['fromEntries'](_0xa37830[_0x5c56d4(0x195)]()));const _0x177079=await fetch(_0x4a36fa,{'method':'GET','headers':{'Accept':_0x5c56d4(0x1d9),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0xb2a157=Date[_0x5c56d4(0x178)]()-_0xd064eb;if(!_0x177079['ok']){const _0x50fe35=await _0x177079['text']();loggerService_1[_0x5c56d4(0x1a3)]['logWhiteDomainResponse'](_0x5c56d4(0x16a),_0x5c56d4(0x1c8)+_0x26d0f8,_0x177079[_0x5c56d4(0x1d7)],_0x50fe35,_0xb2a157);throw new Error(_0x5c56d4(0x18e)+_0x177079['status']);}const _0xf0d30d=await _0x177079[_0x5c56d4(0x179)]();loggerService_1[_0x5c56d4(0x1a3)]['logWhiteDomainResponse'](_0x5c56d4(0x16a),_0x5c56d4(0x1c8)+_0x26d0f8,_0x177079[_0x5c56d4(0x1d7)],_0xf0d30d,_0xb2a157);if(_0xf0d30d[_0x5c56d4(0x1d7)]!==_0x5c56d4(0x1cd)){loggerService_1[_0x5c56d4(0x1a3)][_0x5c56d4(0x18d)]('plisio_direct',_0x5c56d4(0x1c8)+_0x26d0f8,_0x5c56d4(0x173)+(_0xf0d30d[_0x5c56d4(0x1ca)]||_0xf0d30d[_0x5c56d4(0x1d8)]||_0x5c56d4(0x1a7)));throw new Error(_0x5c56d4(0x173)+(_0xf0d30d[_0x5c56d4(0x1ca)]||_0xf0d30d[_0x5c56d4(0x1d8)]||_0x5c56d4(0x1a7)));}let _0x19db3b=_0x5c56d4(0x188);return{'status':_0x19db3b};}catch(_0x3b1a37){console['error'](_0x5c56d4(0x1ab),_0x3b1a37),loggerService_1['loggerService'][_0x5c56d4(0x18d)](_0x5c56d4(0x16a),_0x5c56d4(0x1c8)+_0x26d0f8,_0x3b1a37);throw new Error(_0x5c56d4(0x1b3)+(_0x3b1a37 instanceof Error?_0x3b1a37[_0x5c56d4(0x1ca)]:_0x5c56d4(0x1a7)));}}async['processWebhook'](_0x216972){const _0x416024=a41_0x3eecb8;console[_0x416024(0x1aa)]('Processing\x20Plisio\x20webhook:',_0x216972);let _0x3310a9=_0x416024(0x188);switch(_0x216972[_0x416024(0x1d7)]?.['toLowerCase']()){case _0x416024(0x19f):case _0x416024(0x17d):_0x3310a9='PAID';break;case'expired':_0x3310a9=_0x416024(0x193);break;case _0x416024(0x1d8):case _0x416024(0x1ac):_0x3310a9='FAILED';break;case'new':case _0x416024(0x171):default:_0x3310a9='PENDING';break;}let _0x18bd65;if(_0x216972[_0x416024(0x1d4)])try{console[_0x416024(0x1aa)](_0x416024(0x1cf),_0x216972[_0x416024(0x1d4)]);let _0x1d40e9;if(typeof _0x216972['tx_urls']===_0x416024(0x18f))_0x1d40e9=JSON[_0x416024(0x170)](_0x216972[_0x416024(0x1d4)]);else Array[_0x416024(0x186)](_0x216972[_0x416024(0x1d4)])?_0x1d40e9=_0x216972[_0x416024(0x1d4)]:_0x1d40e9=[];_0x18bd65=_0x1d40e9[_0x416024(0x1c4)](_0x257825=>{const _0x31b723=_0x416024,_0x56dd1f=_0x257825[_0x31b723(0x18a)](/\\/g,'');return console['log'](_0x31b723(0x1c0)+_0x257825+'\x20->\x20'+_0x56dd1f),_0x56dd1f;}),console[_0x416024(0x1aa)]('‚úÖ\x20Processed\x20tx_urls:',_0x18bd65),_0x18bd65[_0x416024(0x16c)]((_0x1971ae,_0x11002e)=>{const _0x444a9f=_0x416024;try{new URL(_0x1971ae),console[_0x444a9f(0x1aa)](_0x444a9f(0x1c9)+(_0x11002e+0x1)+_0x444a9f(0x19c)+_0x1971ae);}catch(_0xaab4c8){console[_0x444a9f(0x1d8)]('‚ùå\x20URL\x20'+(_0x11002e+0x1)+_0x444a9f(0x183)+_0x1971ae,_0xaab4c8);}});}catch(_0xada4b3){console[_0x416024(0x1d8)](_0x416024(0x182),_0xada4b3),console['error'](_0x416024(0x187),_0x216972[_0x416024(0x1d4)]),_0x18bd65=undefined;}return{'paymentId':_0x216972[_0x416024(0x1af)]||'','status':_0x3310a9,'amount':_0x216972[_0x416024(0x1cc)],'currency':_0x216972[_0x416024(0x1ce)],'txUrls':_0x18bd65};}}exports[a41_0x3eecb8(0x19b)]=PlisioService;