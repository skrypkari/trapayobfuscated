'use strict';function a55_0x4a3a(){const _0x1d80e3=['🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','20zImyET','error','order_number','https://api.plisio.net/api/v1/invoices/new','Full\x20URL\x20(without\x20API\x20key):','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','25366HdOcao','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','completed','GET','Parsed\x20Result:','===\x20PLISIO\x20API\x20ERROR\x20===','Response\x20data:','3761424qlAGWc','email','Target\x20Currency:','535165zvfqps','9705916Wnvizn','application/json','parse','invoice_url','https://api.plisio.net/api/v1/operations/','verifyPayment','../loggerService','🔗\x20Formatted\x20URL:\x20','HTTP\x20','\x20is\x20invalid:\x20','now','name','map','Status:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','expired','warn','qr_url','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','916956EIdtoy','JSON\x20Parse\x20Error:\x20','\x20->\x20','replace','text','PAID','Error\x20details:','FAILED','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','toString','logWhiteDomainError','Invoice\x20URL:','3994233nmdjyO','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','/invoices/new','Status\x20Text:','loggerService','data','stack','currency','json','Response\x20Time:','logWhiteDomainRequest','Payment\x20System/1.0','Unknown\x20error','Plisio\x20API\x20error:\x20','env','60AAvXME','isArray','tx_urls',',\x20body:\x20','Transaction\x20ID:','HIDDEN','toLowerCase','Error\x20message:','string','Plisio\x20API\x20key\x20is\x20not\x20configured','79DHlRbm','pending','Error\x20stack:','stringify','fromEntries','qr_code','PENDING','https://api.trapay.uk/api/webhooks/gateway/plisio','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','txn_id','HTTP\x20error!\x20status:\x20','apiKey','Error\x20Message:','14PORrji','Amount:','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','6757248lJqixG','/operations/','Plisio\x20payment\x20verification\x20error:','createPayment','EXPIRED','PlisioService','mismatch','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Raw\x20Response\x20Body:','processWebhook','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','amount','Raw\x20tx_urls\x20data:','source_currency','status','Failed\x20to\x20parse\x20JSON\x20response:','append','forEach','message','plisio_direct','Parameters:','Source\x20Currency:','apiUrl','logWhiteDomainResponse','success','log','entries','===\x20PLISIO\x20SUCCESS\x20===','Response\x20Body:'];a55_0x4a3a=function(){return _0x1d80e3;};return a55_0x4a3a();}const a55_0x27ddb5=a55_0x3f7d;(function(_0x336fed,_0x1ea355){const _0x10dd2e=a55_0x3f7d,_0x7c984e=_0x336fed();while(!![]){try{const _0x5e9ab7=parseInt(_0x10dd2e(0xe7))/0x1*(parseInt(_0x10dd2e(0xa4))/0x2)+-parseInt(_0x10dd2e(0xce))/0x3+-parseInt(_0x10dd2e(0xdd))/0x4*(parseInt(_0x10dd2e(0xae))/0x5)+parseInt(_0x10dd2e(0xf7))/0x6+-parseInt(_0x10dd2e(0xf4))/0x7*(-parseInt(_0x10dd2e(0xab))/0x8)+-parseInt(_0x10dd2e(0xc2))/0x9*(parseInt(_0x10dd2e(0x9e))/0xa)+parseInt(_0x10dd2e(0xaf))/0xb;if(_0x5e9ab7===_0x1ea355)break;else _0x7c984e['push'](_0x7c984e['shift']());}catch(_0x177b12){_0x7c984e['push'](_0x7c984e['shift']());}}}(a55_0x4a3a,0xc5cdb));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a55_0x27ddb5(0xb5));class PlisioService{constructor(){const _0x224612=a55_0x27ddb5;this[_0x224612(0x96)]=_0x224612(0xa1),this[_0x224612(0xf2)]=process[_0x224612(0xdc)]['PLISIO_API_KEY']||'',!this[_0x224612(0xf2)]?console[_0x224612(0xbf)](_0x224612(0xa3)):console[_0x224612(0x99)](_0x224612(0xc1));}async[a55_0x27ddb5(0xfa)](_0x11a846){const _0x57c3bb=a55_0x27ddb5,{orderId:_0x5c8607,amount:_0x3f5cf5,currency:_0x2b381a,productName:_0x5a0038,description:_0x47f1d0,successUrl:_0xe4d592,failUrl:_0x42577b,customerEmail:_0x43ac73,customerName:_0x4c8277,isSourceCurrency:_0x42cbc1,sourceCurrency:_0xf9838f}=_0x11a846;if(!this[_0x57c3bb(0xf2)])throw new Error(_0x57c3bb(0xe6));const _0x2b95e1=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x5c8607,'order_name':_0x5a0038,'description':_0x47f1d0,'success_url':_0xe4d592,'fail_url':_0x42577b,'callback_url':_0x57c3bb(0xee)});_0xf9838f?(_0x2b95e1[_0x57c3bb(0x90)](_0x57c3bb(0xd5),_0xf9838f),_0x2b95e1[_0x57c3bb(0x90)](_0x57c3bb(0x8d),_0x2b381a),_0x2b95e1['append']('source_amount',_0x3f5cf5[_0x57c3bb(0xcb)]())):(_0x2b95e1['append']('currency',_0x2b381a),_0x2b95e1['append'](_0x57c3bb(0x8b),_0x3f5cf5[_0x57c3bb(0xcb)]()));_0x43ac73&&_0x2b95e1[_0x57c3bb(0x90)](_0x57c3bb(0xac),_0x43ac73);_0x4c8277&&_0x2b95e1['append'](_0x57c3bb(0xba),_0x4c8277);const _0x227d74=this[_0x57c3bb(0x96)]+'?'+_0x2b95e1['toString'](),_0x544ba2=Date['now']();try{console['log'](_0x57c3bb(0x85)),console['log']('URL:',this[_0x57c3bb(0x96)]),console['log'](_0x57c3bb(0x94),Object[_0x57c3bb(0xeb)](_0x2b95e1[_0x57c3bb(0x9a)]())),console[_0x57c3bb(0x99)](_0x57c3bb(0xa2),_0x227d74['replace'](this['apiKey'],_0x57c3bb(0xe2))),loggerService_1[_0x57c3bb(0xd2)][_0x57c3bb(0xd8)](_0x57c3bb(0x93),_0x57c3bb(0xd0),_0x57c3bb(0xa7),Object[_0x57c3bb(0xeb)](_0x2b95e1[_0x57c3bb(0x9a)]()));const _0x2249e8=await fetch(_0x227d74,{'method':'GET','headers':{'Accept':_0x57c3bb(0xb0),'User-Agent':_0x57c3bb(0xd9)}}),_0x5e86e7=Date[_0x57c3bb(0xb9)]()-_0x544ba2;console['log'](_0x57c3bb(0xef)),console[_0x57c3bb(0x99)](_0x57c3bb(0xbc),_0x2249e8[_0x57c3bb(0x8e)]),console[_0x57c3bb(0x99)](_0x57c3bb(0xd1),_0x2249e8['statusText']),console[_0x57c3bb(0x99)](_0x57c3bb(0xd7),_0x5e86e7+'ms');const _0x27cbbc=await _0x2249e8[_0x57c3bb(0xc6)]();console[_0x57c3bb(0x99)](_0x57c3bb(0x86),_0x27cbbc);if(!_0x2249e8['ok']){console[_0x57c3bb(0x9f)](_0x57c3bb(0xa9)),console[_0x57c3bb(0x9f)]('HTTP\x20Status:',_0x2249e8[_0x57c3bb(0x8e)]),console[_0x57c3bb(0x9f)](_0x57c3bb(0x9c),_0x27cbbc),loggerService_1['loggerService'][_0x57c3bb(0x97)](_0x57c3bb(0x93),_0x57c3bb(0xd0),_0x2249e8[_0x57c3bb(0x8e)],_0x27cbbc,_0x5e86e7),loggerService_1[_0x57c3bb(0xd2)]['logWhiteDomainError'](_0x57c3bb(0x93),_0x57c3bb(0xd0),_0x57c3bb(0xb7)+_0x2249e8[_0x57c3bb(0x8e)]+':\x20'+_0x27cbbc);throw new Error(_0x57c3bb(0xf1)+_0x2249e8[_0x57c3bb(0x8e)]+_0x57c3bb(0xe0)+_0x27cbbc);}let _0x287ea9;try{_0x287ea9=JSON['parse'](_0x27cbbc);}catch(_0x50c490){console[_0x57c3bb(0x9f)](_0x57c3bb(0x8f),_0x50c490),loggerService_1['loggerService']['logWhiteDomainError'](_0x57c3bb(0x93),_0x57c3bb(0xd0),_0x57c3bb(0xc3)+_0x50c490);throw new Error(_0x57c3bb(0xbd)+_0x27cbbc);}console[_0x57c3bb(0x99)](_0x57c3bb(0xca)),console[_0x57c3bb(0x99)](_0x57c3bb(0xa8),JSON[_0x57c3bb(0xea)](_0x287ea9,null,0x2)),loggerService_1[_0x57c3bb(0xd2)][_0x57c3bb(0x97)](_0x57c3bb(0x93),_0x57c3bb(0xd0),_0x2249e8[_0x57c3bb(0x8e)],_0x287ea9,_0x5e86e7);if(_0x287ea9[_0x57c3bb(0x8e)]!==_0x57c3bb(0x98)){const _0x48fbcc=_0x287ea9['message']||_0x287ea9[_0x57c3bb(0x9f)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x57c3bb(0x9f)](_0x57c3bb(0xf6)),console[_0x57c3bb(0x9f)](_0x57c3bb(0xf3),_0x48fbcc),loggerService_1[_0x57c3bb(0xd2)][_0x57c3bb(0xcc)](_0x57c3bb(0x93),'/invoices/new','Business\x20Error:\x20'+_0x48fbcc);throw new Error(_0x57c3bb(0xdb)+_0x48fbcc);}if(!_0x287ea9['data']?.[_0x57c3bb(0xf0)]||!_0x287ea9[_0x57c3bb(0xd3)]?.['invoice_url']){console['error'](_0x57c3bb(0x8a)),console['error']('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x57c3bb(0x9f)](_0x57c3bb(0xaa),_0x287ea9['data']),loggerService_1[_0x57c3bb(0xd2)][_0x57c3bb(0xcc)](_0x57c3bb(0x93),_0x57c3bb(0xd0),_0x57c3bb(0xcf));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x57c3bb(0x99)](_0x57c3bb(0x9b)),console[_0x57c3bb(0x99)](_0x57c3bb(0xe1),_0x287ea9['data'][_0x57c3bb(0xf0)]),console[_0x57c3bb(0x99)](_0x57c3bb(0xcd),_0x287ea9[_0x57c3bb(0xd3)][_0x57c3bb(0xb2)]),console[_0x57c3bb(0x99)](_0x57c3bb(0xf5),_0x3f5cf5,_0x2b381a),_0xf9838f&&(console[_0x57c3bb(0x99)](_0x57c3bb(0x95),_0xf9838f,'(crypto\x20for\x20payment)'),console[_0x57c3bb(0x99)](_0x57c3bb(0xad),_0x2b381a,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x287ea9[_0x57c3bb(0xd3)][_0x57c3bb(0xf0)],'payment_url':_0x287ea9[_0x57c3bb(0xd3)][_0x57c3bb(0xb2)],'invoice_total_sum':_0x287ea9[_0x57c3bb(0xd3)]['invoice_total_sum'],'qr_code':_0x287ea9[_0x57c3bb(0xd3)][_0x57c3bb(0xec)],'qr_url':_0x287ea9['data'][_0x57c3bb(0xc0)]};}catch(_0x34ced4){console[_0x57c3bb(0x9f)](_0x57c3bb(0xa5)),console['error'](_0x57c3bb(0xc8),_0x34ced4),loggerService_1[_0x57c3bb(0xd2)][_0x57c3bb(0xcc)](_0x57c3bb(0x93),_0x57c3bb(0xd0),_0x34ced4);if(_0x34ced4 instanceof Error){console[_0x57c3bb(0x9f)](_0x57c3bb(0xe4),_0x34ced4[_0x57c3bb(0x92)]),console['error'](_0x57c3bb(0xe9),_0x34ced4[_0x57c3bb(0xd4)]);throw new Error(_0x57c3bb(0x88)+_0x34ced4[_0x57c3bb(0x92)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a55_0x27ddb5(0xb4)](_0x5de31c){const _0x2fd5de=a55_0x27ddb5,_0x53c6c5=Date[_0x2fd5de(0xb9)]();try{if(!this[_0x2fd5de(0xf2)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x2e8f0b=new URLSearchParams({'api_key':this[_0x2fd5de(0xf2)],'txn_id':_0x5de31c}),_0x4dd328=_0x2fd5de(0xb3)+_0x5de31c+'?'+_0x2e8f0b[_0x2fd5de(0xcb)]();loggerService_1['loggerService']['logWhiteDomainRequest'](_0x2fd5de(0x93),_0x2fd5de(0xf8)+_0x5de31c,'GET',Object['fromEntries'](_0x2e8f0b[_0x2fd5de(0x9a)]()));const _0x23466a=await fetch(_0x4dd328,{'method':_0x2fd5de(0xa7),'headers':{'Accept':_0x2fd5de(0xb0),'User-Agent':_0x2fd5de(0xd9)}}),_0x53b367=Date[_0x2fd5de(0xb9)]()-_0x53c6c5;if(!_0x23466a['ok']){const _0xfc0544=await _0x23466a[_0x2fd5de(0xc6)]();loggerService_1[_0x2fd5de(0xd2)][_0x2fd5de(0x97)]('plisio_direct',_0x2fd5de(0xf8)+_0x5de31c,_0x23466a['status'],_0xfc0544,_0x53b367);throw new Error(_0x2fd5de(0xf1)+_0x23466a[_0x2fd5de(0x8e)]);}const _0x313dc3=await _0x23466a[_0x2fd5de(0xd6)]();loggerService_1['loggerService'][_0x2fd5de(0x97)](_0x2fd5de(0x93),_0x2fd5de(0xf8)+_0x5de31c,_0x23466a[_0x2fd5de(0x8e)],_0x313dc3,_0x53b367);if(_0x313dc3[_0x2fd5de(0x8e)]!==_0x2fd5de(0x98)){loggerService_1[_0x2fd5de(0xd2)][_0x2fd5de(0xcc)](_0x2fd5de(0x93),_0x2fd5de(0xf8)+_0x5de31c,'Plisio\x20API\x20error:\x20'+(_0x313dc3[_0x2fd5de(0x92)]||_0x313dc3['error']||_0x2fd5de(0xda)));throw new Error(_0x2fd5de(0xdb)+(_0x313dc3['message']||_0x313dc3[_0x2fd5de(0x9f)]||_0x2fd5de(0xda)));}let _0x97f4b5=_0x2fd5de(0xed);return{'status':_0x97f4b5};}catch(_0x3f1adf){console['error'](_0x2fd5de(0xf9),_0x3f1adf),loggerService_1[_0x2fd5de(0xd2)]['logWhiteDomainError'](_0x2fd5de(0x93),_0x2fd5de(0xf8)+_0x5de31c,_0x3f1adf);throw new Error(_0x2fd5de(0x89)+(_0x3f1adf instanceof Error?_0x3f1adf[_0x2fd5de(0x92)]:_0x2fd5de(0xda)));}}async[a55_0x27ddb5(0x87)](_0xc0109f){const _0x384505=a55_0x27ddb5;console[_0x384505(0x99)]('Processing\x20Plisio\x20webhook:',_0xc0109f);let _0x5aec82=_0x384505(0xed);switch(_0xc0109f[_0x384505(0x8e)]?.[_0x384505(0xe3)]()){case _0x384505(0xa6):case _0x384505(0x84):_0x5aec82=_0x384505(0xc7);break;case _0x384505(0xbe):_0x5aec82=_0x384505(0xfb);break;case'error':case'cancelled':_0x5aec82=_0x384505(0xc9);break;case'new':_0x5aec82=_0x384505(0xed);break;case _0x384505(0xe8):_0x5aec82='PROCESSING';break;default:_0x5aec82=_0x384505(0xed);break;}let _0x3cfc42;if(_0xc0109f[_0x384505(0xdf)])try{console[_0x384505(0x99)](_0x384505(0x9d),_0xc0109f['tx_urls']);let _0x53df91;if(typeof _0xc0109f[_0x384505(0xdf)]===_0x384505(0xe5))_0x53df91=JSON[_0x384505(0xb1)](_0xc0109f[_0x384505(0xdf)]);else Array[_0x384505(0xde)](_0xc0109f['tx_urls'])?_0x53df91=_0xc0109f[_0x384505(0xdf)]:_0x53df91=[];_0x3cfc42=_0x53df91[_0x384505(0xbb)](_0x549cc4=>{const _0x42758d=_0x384505,_0x4a1487=_0x549cc4[_0x42758d(0xc5)](/\\/g,'');return console['log'](_0x42758d(0xb6)+_0x549cc4+_0x42758d(0xc4)+_0x4a1487),_0x4a1487;}),console[_0x384505(0x99)]('✅\x20Processed\x20tx_urls:',_0x3cfc42),_0x3cfc42[_0x384505(0x91)]((_0x139482,_0x2572e9)=>{const _0xeaa4a4=_0x384505;try{new URL(_0x139482),console[_0xeaa4a4(0x99)]('✅\x20URL\x20'+(_0x2572e9+0x1)+'\x20is\x20valid:\x20'+_0x139482);}catch(_0x153a27){console[_0xeaa4a4(0x9f)]('❌\x20URL\x20'+(_0x2572e9+0x1)+_0xeaa4a4(0xb8)+_0x139482,_0x153a27);}});}catch(_0x1ce96a){console[_0x384505(0x9f)]('❌\x20Failed\x20to\x20parse\x20tx_urls:',_0x1ce96a),console['error'](_0x384505(0x8c),_0xc0109f[_0x384505(0xdf)]),_0x3cfc42=undefined;}return{'paymentId':_0xc0109f[_0x384505(0xa0)]||'','status':_0x5aec82,'amount':_0xc0109f[_0x384505(0x8b)],'currency':_0xc0109f[_0x384505(0xd5)],'txUrls':_0x3cfc42};}}function a55_0x3f7d(_0xe0c520,_0x5a8cae){const _0x4a3a54=a55_0x4a3a();return a55_0x3f7d=function(_0x3f7ddf,_0x2a7ad2){_0x3f7ddf=_0x3f7ddf-0x83;let _0x175397=_0x4a3a54[_0x3f7ddf];return _0x175397;},a55_0x3f7d(_0xe0c520,_0x5a8cae);}exports[a55_0x27ddb5(0x83)]=PlisioService;