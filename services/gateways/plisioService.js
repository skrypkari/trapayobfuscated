'use strict';function a44_0x2f94(_0x44cd0f,_0x32e4dd){const _0x2602d4=a44_0x2602();return a44_0x2f94=function(_0x2f947f,_0x851cc8){_0x2f947f=_0x2f947f-0x192;let _0x14590b=_0x2602d4[_0x2f947f];return _0x14590b;},a44_0x2f94(_0x44cd0f,_0x32e4dd);}function a44_0x2602(){const _0x5659ca=['txn_id','expired','Raw\x20Response\x20Body:','env','\x20->\x20','8195UUbYac','text','new','log','application/json','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','apiKey','https://api.plisio.net/api/v1/invoices/new','processWebhook','HTTP\x20','status','Unknown\x20error','===\x20PLISIO\x20SUCCESS\x20===','‚úÖ\x20Processed\x20tx_urls:','Plisio\x20payment\x20verification\x20error:','entries','pending','üîó\x20Formatted\x20URL:\x20','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Response\x20data:','18PDChkc','email','‚ùå\x20URL\x20','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','success','source_currency','Unknown\x20error\x20from\x20Plisio\x20API','fromEntries','mismatch','replace','error','PAID','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','\x20is\x20invalid:\x20','data','statusText','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','Plisio\x20API\x20error:\x20','https://api.plisio.net/api/v1/operations/','URL:','plisio_direct','JSON\x20Parse\x20Error:\x20','Error\x20Message:','../loggerService','527670BbBnjU','parse','qr_code','Error\x20details:','1904scBccy','Status:','Status\x20Text:','message','Invoice\x20URL:','name','Error\x20stack:','logWhiteDomainResponse',',\x20body:\x20','FAILED','map','101270WyohQy','Failed\x20to\x20parse\x20JSON\x20response:','invoice_total_sum','===\x20PLISIO\x20API\x20ERROR\x20===','\x20is\x20valid:\x20','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','apiUrl','244bWuoRI','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','logWhiteDomainError','cancelled','stack','currency','PlisioService','invoice_url','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','/operations/','warn','109728wsINzp','logWhiteDomainRequest','Full\x20URL\x20(without\x20API\x20key):','EXPIRED','2044cjompw','loggerService','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Error\x20message:','63567cTxcrm','Parameters:','Source\x20Currency:','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','(crypto\x20for\x20payment)','verifyPayment','HIDDEN','forEach','createPayment','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Parsed\x20Result:','Amount:','232590MoOQss','tx_urls','Response\x20Time:','TesSoft\x20Payment\x20System/1.0','PENDING','HTTP\x20error!\x20status:\x20','__esModule','stringify','Plisio\x20API\x20key\x20is\x20not\x20configured','now','GET','/invoices/new','string','qr_url','append','https://apitest.trapay.uk/api/webhooks/gateway/plisio','amount','toString'];a44_0x2602=function(){return _0x5659ca;};return a44_0x2602();}const a44_0x22d5f7=a44_0x2f94;(function(_0xe15c29,_0x46d2ad){const _0x54a0a0=a44_0x2f94,_0x588521=_0xe15c29();while(!![]){try{const _0xe0eeca=parseInt(_0x54a0a0(0x1bf))/0x1+-parseInt(_0x54a0a0(0x1ab))/0x2+-parseInt(_0x54a0a0(0x1b3))/0x3+-parseInt(_0x54a0a0(0x1a0))/0x4*(-parseInt(_0x54a0a0(0x1d6))/0x5)+-parseInt(_0x54a0a0(0x202))/0x6+-parseInt(_0x54a0a0(0x1af))/0x7*(parseInt(_0x54a0a0(0x206))/0x8)+-parseInt(_0x54a0a0(0x1ea))/0x9*(-parseInt(_0x54a0a0(0x198))/0xa);if(_0xe0eeca===_0x46d2ad)break;else _0x588521['push'](_0x588521['shift']());}catch(_0x307178){_0x588521['push'](_0x588521['shift']());}}}(a44_0x2602,0x1d221));Object['defineProperty'](exports,a44_0x22d5f7(0x1c5),{'value':!![]}),exports[a44_0x22d5f7(0x1a6)]=void 0x0;const loggerService_1=require(a44_0x22d5f7(0x201));class PlisioService{constructor(){const _0x1d468c=a44_0x22d5f7;this['apiUrl']=_0x1d468c(0x1dd),this[_0x1d468c(0x1dc)]=process[_0x1d468c(0x1d4)]['PLISIO_API_KEY']||'',!this[_0x1d468c(0x1dc)]?console[_0x1d468c(0x1aa)](_0x1d468c(0x1f6)):console[_0x1d468c(0x1d9)](_0x1d468c(0x1a1));}async[a44_0x22d5f7(0x1bb)](_0x34dea7){const _0x4a7eb4=a44_0x22d5f7,{orderId:_0x1ea6ef,amount:_0x21ba3d,currency:_0x3d52c4,productName:_0x346d71,description:_0x47dc7a,successUrl:_0x47934e,failUrl:_0x2afea1,customerEmail:_0x1b6839,customerName:_0x60c80d,isSourceCurrency:_0xa87cd9,sourceCurrency:_0x450f8f}=_0x34dea7;if(!this['apiKey'])throw new Error(_0x4a7eb4(0x1c7));const _0x2e4dce=new URLSearchParams({'api_key':this[_0x4a7eb4(0x1dc)],'order_number':_0x1ea6ef,'order_name':_0x346d71,'description':_0x47dc7a,'success_url':_0x47934e,'fail_url':_0x2afea1,'callback_url':_0x4a7eb4(0x1ce)});_0x450f8f?(_0x2e4dce[_0x4a7eb4(0x1cd)](_0x4a7eb4(0x1a5),_0x450f8f),_0x2e4dce[_0x4a7eb4(0x1cd)](_0x4a7eb4(0x1ef),_0x3d52c4),_0x2e4dce[_0x4a7eb4(0x1cd)]('source_amount',_0x21ba3d['toString']())):(_0x2e4dce[_0x4a7eb4(0x1cd)](_0x4a7eb4(0x1a5),_0x3d52c4),_0x2e4dce['append'](_0x4a7eb4(0x1cf),_0x21ba3d[_0x4a7eb4(0x1d0)]()));_0x1b6839&&_0x2e4dce[_0x4a7eb4(0x1cd)](_0x4a7eb4(0x1eb),_0x1b6839);_0x60c80d&&_0x2e4dce['append'](_0x4a7eb4(0x192),_0x60c80d);const _0x1812ba=this['apiUrl']+'?'+_0x2e4dce[_0x4a7eb4(0x1d0)](),_0x3f5569=Date[_0x4a7eb4(0x1c8)]();try{console['log'](_0x4a7eb4(0x19d)),console['log'](_0x4a7eb4(0x1fd),this[_0x4a7eb4(0x19f)]),console[_0x4a7eb4(0x1d9)](_0x4a7eb4(0x1b4),Object[_0x4a7eb4(0x1f1)](_0x2e4dce[_0x4a7eb4(0x1e5)]())),console['log'](_0x4a7eb4(0x1ad),_0x1812ba[_0x4a7eb4(0x1f3)](this['apiKey'],_0x4a7eb4(0x1b9))),loggerService_1[_0x4a7eb4(0x1b0)][_0x4a7eb4(0x1ac)]('plisio_direct',_0x4a7eb4(0x1ca),_0x4a7eb4(0x1c9),Object[_0x4a7eb4(0x1f1)](_0x2e4dce[_0x4a7eb4(0x1e5)]()));const _0x37ffe4=await fetch(_0x1812ba,{'method':_0x4a7eb4(0x1c9),'headers':{'Accept':'application/json','User-Agent':_0x4a7eb4(0x1c2)}}),_0x54a239=Date[_0x4a7eb4(0x1c8)]()-_0x3f5569;console['log'](_0x4a7eb4(0x1a8)),console[_0x4a7eb4(0x1d9)](_0x4a7eb4(0x207),_0x37ffe4[_0x4a7eb4(0x1e0)]),console[_0x4a7eb4(0x1d9)](_0x4a7eb4(0x208),_0x37ffe4[_0x4a7eb4(0x1f9)]),console[_0x4a7eb4(0x1d9)](_0x4a7eb4(0x1c1),_0x54a239+'ms');const _0x5e7f87=await _0x37ffe4['text']();console[_0x4a7eb4(0x1d9)](_0x4a7eb4(0x1d3),_0x5e7f87);if(!_0x37ffe4['ok']){console['error'](_0x4a7eb4(0x19b)),console[_0x4a7eb4(0x1f4)]('HTTP\x20Status:',_0x37ffe4[_0x4a7eb4(0x1e0)]),console['error']('Response\x20Body:',_0x5e7f87),loggerService_1['loggerService'][_0x4a7eb4(0x194)](_0x4a7eb4(0x1fe),_0x4a7eb4(0x1ca),_0x37ffe4['status'],_0x5e7f87,_0x54a239),loggerService_1['loggerService']['logWhiteDomainError'](_0x4a7eb4(0x1fe),_0x4a7eb4(0x1ca),_0x4a7eb4(0x1df)+_0x37ffe4[_0x4a7eb4(0x1e0)]+':\x20'+_0x5e7f87);throw new Error(_0x4a7eb4(0x1c4)+_0x37ffe4[_0x4a7eb4(0x1e0)]+_0x4a7eb4(0x195)+_0x5e7f87);}let _0x1f971b;try{_0x1f971b=JSON[_0x4a7eb4(0x203)](_0x5e7f87);}catch(_0xe75fe7){console[_0x4a7eb4(0x1f4)](_0x4a7eb4(0x199),_0xe75fe7),loggerService_1[_0x4a7eb4(0x1b0)][_0x4a7eb4(0x1a2)](_0x4a7eb4(0x1fe),_0x4a7eb4(0x1ca),_0x4a7eb4(0x1ff)+_0xe75fe7);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x5e7f87);}console[_0x4a7eb4(0x1d9)](_0x4a7eb4(0x1db)),console['log'](_0x4a7eb4(0x1bd),JSON[_0x4a7eb4(0x1c6)](_0x1f971b,null,0x2)),loggerService_1[_0x4a7eb4(0x1b0)]['logWhiteDomainResponse']('plisio_direct',_0x4a7eb4(0x1ca),_0x37ffe4[_0x4a7eb4(0x1e0)],_0x1f971b,_0x54a239);if(_0x1f971b[_0x4a7eb4(0x1e0)]!==_0x4a7eb4(0x1ee)){const _0x379450=_0x1f971b[_0x4a7eb4(0x209)]||_0x1f971b['error']||_0x4a7eb4(0x1f0);console[_0x4a7eb4(0x1f4)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x4a7eb4(0x1f4)](_0x4a7eb4(0x200),_0x379450),loggerService_1[_0x4a7eb4(0x1b0)][_0x4a7eb4(0x1a2)](_0x4a7eb4(0x1fe),_0x4a7eb4(0x1ca),'Business\x20Error:\x20'+_0x379450);throw new Error('Plisio\x20API\x20error:\x20'+_0x379450);}if(!_0x1f971b[_0x4a7eb4(0x1f8)]?.['txn_id']||!_0x1f971b['data']?.[_0x4a7eb4(0x1a7)]){console[_0x4a7eb4(0x1f4)](_0x4a7eb4(0x1ed)),console[_0x4a7eb4(0x1f4)](_0x4a7eb4(0x1fa)),console[_0x4a7eb4(0x1f4)](_0x4a7eb4(0x1e9),_0x1f971b[_0x4a7eb4(0x1f8)]),loggerService_1[_0x4a7eb4(0x1b0)][_0x4a7eb4(0x1a2)](_0x4a7eb4(0x1fe),_0x4a7eb4(0x1ca),_0x4a7eb4(0x1bc));throw new Error(_0x4a7eb4(0x1e8));}return console[_0x4a7eb4(0x1d9)](_0x4a7eb4(0x1e2)),console[_0x4a7eb4(0x1d9)]('Transaction\x20ID:',_0x1f971b[_0x4a7eb4(0x1f8)][_0x4a7eb4(0x1d1)]),console[_0x4a7eb4(0x1d9)](_0x4a7eb4(0x20a),_0x1f971b[_0x4a7eb4(0x1f8)][_0x4a7eb4(0x1a7)]),console['log'](_0x4a7eb4(0x1be),_0x21ba3d,_0x3d52c4),_0x450f8f&&(console[_0x4a7eb4(0x1d9)](_0x4a7eb4(0x1b5),_0x450f8f,_0x4a7eb4(0x1b7)),console[_0x4a7eb4(0x1d9)]('Target\x20Currency:',_0x3d52c4,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x1f971b['data'][_0x4a7eb4(0x1d1)],'payment_url':_0x1f971b[_0x4a7eb4(0x1f8)][_0x4a7eb4(0x1a7)],'invoice_total_sum':_0x1f971b['data'][_0x4a7eb4(0x19a)],'qr_code':_0x1f971b['data'][_0x4a7eb4(0x204)],'qr_url':_0x1f971b['data'][_0x4a7eb4(0x1cc)]};}catch(_0x15eee0){console[_0x4a7eb4(0x1f4)](_0x4a7eb4(0x1b1)),console[_0x4a7eb4(0x1f4)](_0x4a7eb4(0x205),_0x15eee0),loggerService_1[_0x4a7eb4(0x1b0)]['logWhiteDomainError']('plisio_direct','/invoices/new',_0x15eee0);if(_0x15eee0 instanceof Error){console['error'](_0x4a7eb4(0x1b2),_0x15eee0[_0x4a7eb4(0x209)]),console[_0x4a7eb4(0x1f4)](_0x4a7eb4(0x193),_0x15eee0[_0x4a7eb4(0x1a4)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x15eee0[_0x4a7eb4(0x209)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a44_0x22d5f7(0x1b8)](_0x8da43d){const _0x7c963=a44_0x22d5f7,_0x4f8e1c=Date[_0x7c963(0x1c8)]();try{if(!this[_0x7c963(0x1dc)])throw new Error(_0x7c963(0x1c7));const _0x1bdb5f=new URLSearchParams({'api_key':this[_0x7c963(0x1dc)],'txn_id':_0x8da43d}),_0x45268d=_0x7c963(0x1fc)+_0x8da43d+'?'+_0x1bdb5f['toString']();loggerService_1[_0x7c963(0x1b0)][_0x7c963(0x1ac)]('plisio_direct',_0x7c963(0x1a9)+_0x8da43d,_0x7c963(0x1c9),Object[_0x7c963(0x1f1)](_0x1bdb5f[_0x7c963(0x1e5)]()));const _0x528f25=await fetch(_0x45268d,{'method':_0x7c963(0x1c9),'headers':{'Accept':_0x7c963(0x1da),'User-Agent':_0x7c963(0x1c2)}}),_0x234672=Date[_0x7c963(0x1c8)]()-_0x4f8e1c;if(!_0x528f25['ok']){const _0x4c043f=await _0x528f25[_0x7c963(0x1d7)]();loggerService_1[_0x7c963(0x1b0)][_0x7c963(0x194)](_0x7c963(0x1fe),_0x7c963(0x1a9)+_0x8da43d,_0x528f25[_0x7c963(0x1e0)],_0x4c043f,_0x234672);throw new Error('HTTP\x20error!\x20status:\x20'+_0x528f25[_0x7c963(0x1e0)]);}const _0x338e2c=await _0x528f25['json']();loggerService_1[_0x7c963(0x1b0)][_0x7c963(0x194)](_0x7c963(0x1fe),_0x7c963(0x1a9)+_0x8da43d,_0x528f25[_0x7c963(0x1e0)],_0x338e2c,_0x234672);if(_0x338e2c['status']!==_0x7c963(0x1ee)){loggerService_1['loggerService'][_0x7c963(0x1a2)](_0x7c963(0x1fe),_0x7c963(0x1a9)+_0x8da43d,_0x7c963(0x1fb)+(_0x338e2c[_0x7c963(0x209)]||_0x338e2c[_0x7c963(0x1f4)]||_0x7c963(0x1e1)));throw new Error(_0x7c963(0x1fb)+(_0x338e2c[_0x7c963(0x209)]||_0x338e2c[_0x7c963(0x1f4)]||'Unknown\x20error'));}let _0x21c1b7='PENDING';return{'status':_0x21c1b7};}catch(_0x7e7c42){console[_0x7c963(0x1f4)](_0x7c963(0x1e4),_0x7e7c42),loggerService_1['loggerService'][_0x7c963(0x1a2)](_0x7c963(0x1fe),_0x7c963(0x1a9)+_0x8da43d,_0x7e7c42);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x7e7c42 instanceof Error?_0x7e7c42[_0x7c963(0x209)]:_0x7c963(0x1e1)));}}async[a44_0x22d5f7(0x1de)](_0x1006c8){const _0x22952c=a44_0x22d5f7;console[_0x22952c(0x1d9)]('Processing\x20Plisio\x20webhook:',_0x1006c8);let _0x596168='PENDING';switch(_0x1006c8[_0x22952c(0x1e0)]?.['toLowerCase']()){case'completed':case _0x22952c(0x1f2):_0x596168=_0x22952c(0x1f5);break;case _0x22952c(0x1d2):_0x596168=_0x22952c(0x1ae);break;case'error':case _0x22952c(0x1a3):_0x596168=_0x22952c(0x196);break;case _0x22952c(0x1d8):case _0x22952c(0x1e6):default:_0x596168=_0x22952c(0x1c3);break;}let _0x5bcb7c;if(_0x1006c8[_0x22952c(0x1c0)])try{console[_0x22952c(0x1d9)](_0x22952c(0x1b6),_0x1006c8[_0x22952c(0x1c0)]);let _0x7ddb53;if(typeof _0x1006c8['tx_urls']===_0x22952c(0x1cb))_0x7ddb53=JSON[_0x22952c(0x203)](_0x1006c8[_0x22952c(0x1c0)]);else Array['isArray'](_0x1006c8[_0x22952c(0x1c0)])?_0x7ddb53=_0x1006c8[_0x22952c(0x1c0)]:_0x7ddb53=[];_0x5bcb7c=_0x7ddb53[_0x22952c(0x197)](_0x3b8d60=>{const _0x186431=_0x22952c,_0x40ae20=_0x3b8d60[_0x186431(0x1f3)](/\\/g,'');return console['log'](_0x186431(0x1e7)+_0x3b8d60+_0x186431(0x1d5)+_0x40ae20),_0x40ae20;}),console[_0x22952c(0x1d9)](_0x22952c(0x1e3),_0x5bcb7c),_0x5bcb7c[_0x22952c(0x1ba)]((_0x5ecd18,_0x27152c)=>{const _0x169dd5=_0x22952c;try{new URL(_0x5ecd18),console[_0x169dd5(0x1d9)]('‚úÖ\x20URL\x20'+(_0x27152c+0x1)+_0x169dd5(0x19c)+_0x5ecd18);}catch(_0x3020d4){console[_0x169dd5(0x1f4)](_0x169dd5(0x1ec)+(_0x27152c+0x1)+_0x169dd5(0x1f7)+_0x5ecd18,_0x3020d4);}});}catch(_0x279976){console['error'](_0x22952c(0x19e),_0x279976),console['error']('Raw\x20tx_urls\x20data:',_0x1006c8['tx_urls']),_0x5bcb7c=undefined;}return{'paymentId':_0x1006c8['order_number']||'','status':_0x596168,'amount':_0x1006c8['amount'],'currency':_0x1006c8[_0x22952c(0x1a5)],'txUrls':_0x5bcb7c};}}exports[a44_0x22d5f7(0x1a6)]=PlisioService;