'use strict';function a44_0x12c7(){const _0x333cdc=['apiUrl','application/json','../loggerService','entries','toString','now','currency','log','new','verifyPayment','(crypto\x20for\x20payment)','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Error\x20details:','forEach','message','Source\x20Currency:','üîó\x20Formatted\x20URL:\x20','Plisio\x20API\x20error:\x20','===\x20PLISIO\x20API\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','logWhiteDomainRequest','Response\x20data:','2136009jpkAzn','invoice_url','Raw\x20tx_urls\x20data:','json','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Unknown\x20error','expired','success','apiKey','Parsed\x20Result:','6459hhlSGn','https://api.trapay.uk/api/webhooks/gateway/plisio','Response\x20Body:','error','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','tx_urls','Error\x20stack:','Failed\x20to\x20parse\x20JSON\x20response:','‚úÖ\x20Processed\x20tx_urls:','qr_code','Amount:','270cfmGVl','plisio_direct','2767904qPpoZN','logWhiteDomainResponse','completed','__esModule','Plisio\x20API\x20key\x20is\x20not\x20configured','stack','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','54IvYXbZ','‚úÖ\x20URL\x20','PAID','Failed\x20to\x20create\x20Plisio\x20payment:\x20','text','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','createPayment','220581LPGHDo','invoice_total_sum','isArray','Target\x20Currency:','env','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','PLISIO_API_KEY','FAILED','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','parse','GET','(fiat\x20for\x20merchant)','txn_id','4BmmKyJ','statusText','append','TesSoft\x20Payment\x20System/1.0','URL:','name','/invoices/new','loggerService','HTTP\x20error!\x20status:\x20','/operations/','Unknown\x20error\x20from\x20Plisio\x20API','replace','PlisioService','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Error\x20Message:','2662255iCdRFN','\x20is\x20valid:\x20',',\x20body:\x20','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','55923Ztzpde','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','warn','map','Status:','EXPIRED','14cgpSgD','status','data','order_number','Status\x20Text:','Invoice\x20URL:','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Raw\x20Response\x20Body:','fromEntries','PENDING','HTTP\x20','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','2923041NeAOIQ','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','amount','cancelled','source_currency','logWhiteDomainError','email','Error\x20message:'];a44_0x12c7=function(){return _0x333cdc;};return a44_0x12c7();}const a44_0x43859a=a44_0x5cf9;(function(_0x11764d,_0x2e93c4){const _0x58c0b8=a44_0x5cf9,_0x1a4625=_0x11764d();while(!![]){try{const _0x1860c3=-parseInt(_0x58c0b8(0x159))/0x1*(-parseInt(_0x58c0b8(0x19a))/0x2)+-parseInt(_0x58c0b8(0x14f))/0x3*(parseInt(_0x58c0b8(0x181))/0x4)+parseInt(_0x58c0b8(0x190))/0x5+-parseInt(_0x58c0b8(0x16d))/0x6*(parseInt(_0x58c0b8(0x194))/0x7)+-parseInt(_0x58c0b8(0x166))/0x8+-parseInt(_0x58c0b8(0x174))/0x9*(-parseInt(_0x58c0b8(0x164))/0xa)+parseInt(_0x58c0b8(0x130))/0xb;if(_0x1860c3===_0x2e93c4)break;else _0x1a4625['push'](_0x1a4625['shift']());}catch(_0x3c5dfb){_0x1a4625['push'](_0x1a4625['shift']());}}}(a44_0x12c7,0x5b9ce));Object['defineProperty'](exports,a44_0x43859a(0x169),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a44_0x43859a(0x13a));class PlisioService{constructor(){const _0x41a537=a44_0x43859a;this[_0x41a537(0x138)]='https://api.plisio.net/api/v1/invoices/new',this[_0x41a537(0x157)]=process[_0x41a537(0x178)][_0x41a537(0x17a)]||'',!this[_0x41a537(0x157)]?console[_0x41a537(0x196)](_0x41a537(0x12a)):console[_0x41a537(0x13f)](_0x41a537(0x12f));}async[a44_0x43859a(0x173)](_0x31631e){const _0x108754=a44_0x43859a,{orderId:_0xb61482,amount:_0x190aa2,currency:_0x9651e0,productName:_0xc69e8,description:_0x1789b1,successUrl:_0xf5b9c7,failUrl:_0x32fe24,customerEmail:_0x53da6d,customerName:_0x36af16,isSourceCurrency:_0x2bbaf6,sourceCurrency:_0x4685d6}=_0x31631e;if(!this[_0x108754(0x157)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x4ce0fd=new URLSearchParams({'api_key':this[_0x108754(0x157)],'order_number':_0xb61482,'order_name':_0xc69e8,'description':_0x1789b1,'success_url':_0xf5b9c7,'fail_url':_0x32fe24,'callback_url':_0x108754(0x15a)});_0x4685d6?(_0x4ce0fd[_0x108754(0x183)](_0x108754(0x13e),_0x4685d6),_0x4ce0fd['append'](_0x108754(0x134),_0x9651e0),_0x4ce0fd[_0x108754(0x183)]('source_amount',_0x190aa2[_0x108754(0x13c)]())):(_0x4ce0fd[_0x108754(0x183)](_0x108754(0x13e),_0x9651e0),_0x4ce0fd[_0x108754(0x183)](_0x108754(0x132),_0x190aa2['toString']()));_0x53da6d&&_0x4ce0fd[_0x108754(0x183)](_0x108754(0x136),_0x53da6d);_0x36af16&&_0x4ce0fd['append'](_0x108754(0x186),_0x36af16);const _0x15c5b4=this[_0x108754(0x138)]+'?'+_0x4ce0fd[_0x108754(0x13c)](),_0x1ff512=Date['now']();try{console['log'](_0x108754(0x17c)),console[_0x108754(0x13f)](_0x108754(0x185),this[_0x108754(0x138)]),console[_0x108754(0x13f)]('Parameters:',Object[_0x108754(0x12c)](_0x4ce0fd[_0x108754(0x13b)]())),console[_0x108754(0x13f)]('Full\x20URL\x20(without\x20API\x20key):',_0x15c5b4[_0x108754(0x18c)](this['apiKey'],'HIDDEN')),loggerService_1[_0x108754(0x188)][_0x108754(0x14d)](_0x108754(0x165),_0x108754(0x187),'GET',Object['fromEntries'](_0x4ce0fd[_0x108754(0x13b)]()));const _0x36a369=await fetch(_0x15c5b4,{'method':_0x108754(0x17e),'headers':{'Accept':_0x108754(0x139),'User-Agent':_0x108754(0x184)}}),_0x4042ad=Date[_0x108754(0x13d)]()-_0x1ff512;console[_0x108754(0x13f)](_0x108754(0x16c)),console[_0x108754(0x13f)](_0x108754(0x198),_0x36a369[_0x108754(0x125)]),console[_0x108754(0x13f)](_0x108754(0x128),_0x36a369[_0x108754(0x182)]),console[_0x108754(0x13f)]('Response\x20Time:',_0x4042ad+'ms');const _0x31cdf1=await _0x36a369[_0x108754(0x171)]();console[_0x108754(0x13f)](_0x108754(0x12b),_0x31cdf1);if(!_0x36a369['ok']){console[_0x108754(0x15c)](_0x108754(0x14b)),console[_0x108754(0x15c)]('HTTP\x20Status:',_0x36a369[_0x108754(0x125)]),console['error'](_0x108754(0x15b),_0x31cdf1),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x108754(0x165),_0x108754(0x187),_0x36a369[_0x108754(0x125)],_0x31cdf1,_0x4042ad),loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct','/invoices/new',_0x108754(0x12e)+_0x36a369[_0x108754(0x125)]+':\x20'+_0x31cdf1);throw new Error(_0x108754(0x189)+_0x36a369['status']+_0x108754(0x192)+_0x31cdf1);}let _0x51fa31;try{_0x51fa31=JSON[_0x108754(0x17d)](_0x31cdf1);}catch(_0x16d890){console[_0x108754(0x15c)](_0x108754(0x160),_0x16d890),loggerService_1[_0x108754(0x188)]['logWhiteDomainError']('plisio_direct',_0x108754(0x187),'JSON\x20Parse\x20Error:\x20'+_0x16d890);throw new Error(_0x108754(0x14c)+_0x31cdf1);}console[_0x108754(0x13f)](_0x108754(0x131)),console[_0x108754(0x13f)](_0x108754(0x158),JSON['stringify'](_0x51fa31,null,0x2)),loggerService_1[_0x108754(0x188)][_0x108754(0x167)]('plisio_direct',_0x108754(0x187),_0x36a369[_0x108754(0x125)],_0x51fa31,_0x4042ad);if(_0x51fa31[_0x108754(0x125)]!=='success'){const _0x438d64=_0x51fa31[_0x108754(0x147)]||_0x51fa31[_0x108754(0x15c)]||_0x108754(0x18b);console[_0x108754(0x15c)](_0x108754(0x195)),console[_0x108754(0x15c)](_0x108754(0x18f),_0x438d64),loggerService_1[_0x108754(0x188)]['logWhiteDomainError']('plisio_direct',_0x108754(0x187),'Business\x20Error:\x20'+_0x438d64);throw new Error(_0x108754(0x14a)+_0x438d64);}if(!_0x51fa31['data']?.[_0x108754(0x180)]||!_0x51fa31[_0x108754(0x126)]?.[_0x108754(0x150)]){console['error'](_0x108754(0x193)),console[_0x108754(0x15c)](_0x108754(0x172)),console['error'](_0x108754(0x14e),_0x51fa31['data']),loggerService_1[_0x108754(0x188)]['logWhiteDomainError'](_0x108754(0x165),_0x108754(0x187),_0x108754(0x18e));throw new Error(_0x108754(0x144));}return console['log']('===\x20PLISIO\x20SUCCESS\x20==='),console['log']('Transaction\x20ID:',_0x51fa31['data'][_0x108754(0x180)]),console[_0x108754(0x13f)](_0x108754(0x129),_0x51fa31[_0x108754(0x126)]['invoice_url']),console[_0x108754(0x13f)](_0x108754(0x163),_0x190aa2,_0x9651e0),_0x4685d6&&(console['log'](_0x108754(0x148),_0x4685d6,_0x108754(0x142)),console['log'](_0x108754(0x177),_0x9651e0,_0x108754(0x17f))),{'gateway_payment_id':_0x51fa31[_0x108754(0x126)][_0x108754(0x180)],'payment_url':_0x51fa31[_0x108754(0x126)][_0x108754(0x150)],'invoice_total_sum':_0x51fa31[_0x108754(0x126)][_0x108754(0x175)],'qr_code':_0x51fa31[_0x108754(0x126)][_0x108754(0x162)],'qr_url':_0x51fa31[_0x108754(0x126)]['qr_url']};}catch(_0x3b22e4){console['error'](_0x108754(0x15d)),console[_0x108754(0x15c)](_0x108754(0x145),_0x3b22e4),loggerService_1['loggerService'][_0x108754(0x135)](_0x108754(0x165),'/invoices/new',_0x3b22e4);if(_0x3b22e4 instanceof Error){console[_0x108754(0x15c)](_0x108754(0x137),_0x3b22e4[_0x108754(0x147)]),console[_0x108754(0x15c)](_0x108754(0x15f),_0x3b22e4[_0x108754(0x16b)]);throw new Error(_0x108754(0x170)+_0x3b22e4['message']);}throw new Error(_0x108754(0x179));}}async[a44_0x43859a(0x141)](_0x2c72c7){const _0x4556f9=a44_0x43859a,_0x2001a5=Date['now']();try{if(!this[_0x4556f9(0x157)])throw new Error(_0x4556f9(0x16a));const _0x36f476=new URLSearchParams({'api_key':this[_0x4556f9(0x157)],'txn_id':_0x2c72c7}),_0x426d51='https://api.plisio.net/api/v1/operations/'+_0x2c72c7+'?'+_0x36f476[_0x4556f9(0x13c)]();loggerService_1[_0x4556f9(0x188)][_0x4556f9(0x14d)](_0x4556f9(0x165),_0x4556f9(0x18a)+_0x2c72c7,'GET',Object['fromEntries'](_0x36f476[_0x4556f9(0x13b)]()));const _0x298a3a=await fetch(_0x426d51,{'method':_0x4556f9(0x17e),'headers':{'Accept':_0x4556f9(0x139),'User-Agent':_0x4556f9(0x184)}}),_0x5ea83e=Date[_0x4556f9(0x13d)]()-_0x2001a5;if(!_0x298a3a['ok']){const _0x3a3c37=await _0x298a3a[_0x4556f9(0x171)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4556f9(0x165),_0x4556f9(0x18a)+_0x2c72c7,_0x298a3a[_0x4556f9(0x125)],_0x3a3c37,_0x5ea83e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x298a3a[_0x4556f9(0x125)]);}const _0x568040=await _0x298a3a[_0x4556f9(0x152)]();loggerService_1['loggerService'][_0x4556f9(0x167)](_0x4556f9(0x165),_0x4556f9(0x18a)+_0x2c72c7,_0x298a3a[_0x4556f9(0x125)],_0x568040,_0x5ea83e);if(_0x568040[_0x4556f9(0x125)]!==_0x4556f9(0x156)){loggerService_1[_0x4556f9(0x188)][_0x4556f9(0x135)]('plisio_direct',_0x4556f9(0x18a)+_0x2c72c7,_0x4556f9(0x14a)+(_0x568040[_0x4556f9(0x147)]||_0x568040[_0x4556f9(0x15c)]||_0x4556f9(0x154)));throw new Error(_0x4556f9(0x14a)+(_0x568040[_0x4556f9(0x147)]||_0x568040[_0x4556f9(0x15c)]||_0x4556f9(0x154)));}let _0x30e395='PENDING';return{'status':_0x30e395};}catch(_0x251769){console[_0x4556f9(0x15c)]('Plisio\x20payment\x20verification\x20error:',_0x251769),loggerService_1[_0x4556f9(0x188)][_0x4556f9(0x135)]('plisio_direct',_0x4556f9(0x18a)+_0x2c72c7,_0x251769);throw new Error(_0x4556f9(0x143)+(_0x251769 instanceof Error?_0x251769['message']:_0x4556f9(0x154)));}}async['processWebhook'](_0x55bdc7){const _0xa1d80=a44_0x43859a;console[_0xa1d80(0x13f)]('Processing\x20Plisio\x20webhook:',_0x55bdc7);let _0x1da4b0=_0xa1d80(0x12d);switch(_0x55bdc7[_0xa1d80(0x125)]?.['toLowerCase']()){case _0xa1d80(0x168):case'mismatch':_0x1da4b0=_0xa1d80(0x16f);break;case _0xa1d80(0x155):_0x1da4b0=_0xa1d80(0x199);break;case'error':case _0xa1d80(0x133):_0x1da4b0=_0xa1d80(0x17b);break;case _0xa1d80(0x140):case'pending':default:_0x1da4b0=_0xa1d80(0x12d);break;}let _0x254794;if(_0x55bdc7[_0xa1d80(0x15e)])try{console[_0xa1d80(0x13f)](_0xa1d80(0x153),_0x55bdc7[_0xa1d80(0x15e)]);let _0x5c7e4d;if(typeof _0x55bdc7['tx_urls']==='string')_0x5c7e4d=JSON['parse'](_0x55bdc7[_0xa1d80(0x15e)]);else Array[_0xa1d80(0x176)](_0x55bdc7[_0xa1d80(0x15e)])?_0x5c7e4d=_0x55bdc7[_0xa1d80(0x15e)]:_0x5c7e4d=[];_0x254794=_0x5c7e4d[_0xa1d80(0x197)](_0x32b71e=>{const _0x258c13=_0xa1d80,_0x162b83=_0x32b71e['replace'](/\\/g,'');return console[_0x258c13(0x13f)](_0x258c13(0x149)+_0x32b71e+'\x20->\x20'+_0x162b83),_0x162b83;}),console[_0xa1d80(0x13f)](_0xa1d80(0x161),_0x254794),_0x254794[_0xa1d80(0x146)]((_0x2da565,_0xe313a4)=>{const _0x5d5fa6=_0xa1d80;try{new URL(_0x2da565),console['log'](_0x5d5fa6(0x16e)+(_0xe313a4+0x1)+_0x5d5fa6(0x191)+_0x2da565);}catch(_0x5f5000){console[_0x5d5fa6(0x15c)]('‚ùå\x20URL\x20'+(_0xe313a4+0x1)+'\x20is\x20invalid:\x20'+_0x2da565,_0x5f5000);}});}catch(_0x2f9eaf){console[_0xa1d80(0x15c)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x2f9eaf),console['error'](_0xa1d80(0x151),_0x55bdc7['tx_urls']),_0x254794=undefined;}return{'paymentId':_0x55bdc7[_0xa1d80(0x127)]||'','status':_0x1da4b0,'amount':_0x55bdc7[_0xa1d80(0x132)],'currency':_0x55bdc7[_0xa1d80(0x13e)],'txUrls':_0x254794};}}function a44_0x5cf9(_0x10b79d,_0x2802cc){const _0x12c747=a44_0x12c7();return a44_0x5cf9=function(_0x5cf97b,_0x1bda9e){_0x5cf97b=_0x5cf97b-0x125;let _0xe0bf46=_0x12c747[_0x5cf97b];return _0xe0bf46;},a44_0x5cf9(_0x10b79d,_0x2802cc);}exports[a44_0x43859a(0x18d)]=PlisioService;