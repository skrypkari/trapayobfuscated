'use strict';const a44_0x3fb479=a44_0x5d0e;function a44_0x3ccd(){const _0x57ae99=['413690VVTLNf','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','processWebhook','\x20->\x20','logWhiteDomainRequest','164718XDjEfi','forEach','Status:','defineProperty','\x20is\x20valid:\x20','EXPIRED','isArray','createPayment','error','Plisio\x20API\x20error:\x20','249392kdzrLb','loggerService','(crypto\x20for\x20payment)','PlisioService','üîó\x20Formatted\x20URL:\x20','mismatch','Error\x20details:','new','https://api.trapay.uk/api/webhooks/gateway/plisio','Plisio\x20API\x20key\x20is\x20not\x20configured','4882318SpSGMx','JSON\x20Parse\x20Error:\x20','logWhiteDomainResponse','now','qr_url','stringify','entries','Response\x20Body:','order_number','220023PMHOpg','(fiat\x20for\x20merchant)','HIDDEN','Response\x20data:','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','tx_urls','96UzkhwG','invoice_url','‚úÖ\x20URL\x20','Unknown\x20error','5896rlSeRG','PROCESSING','Transaction\x20ID:','Parsed\x20Result:','apiKey','4RMhjqK','amount','currency','invoice_total_sum','stack','success','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','535179fmWzDU','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','PLISIO_API_KEY','status','expired','statusText','===\x20PLISIO\x20API\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','completed','replace','\x20is\x20invalid:\x20','logWhiteDomainError','log','apiUrl','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','json','Invoice\x20URL:','Error\x20Message:','Processing\x20Plisio\x20webhook:','Parameters:','Full\x20URL\x20(without\x20API\x20key):','/operations/','Response\x20Time:','plisio_direct','Raw\x20Response\x20Body:','map','‚úÖ\x20Processed\x20tx_urls:','source_amount','env','__esModule','data','Target\x20Currency:','PAID','application/json','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','fromEntries','HTTP\x20','10OHloov','Status\x20Text:','TesSoft\x20Payment\x20System/1.0','24910HGZSgF','../loggerService','https://api.plisio.net/api/v1/operations/','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','HTTP\x20error!\x20status:\x20','txn_id','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','PENDING','GET','verifyPayment','/invoices/new','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','URL:','message','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Raw\x20tx_urls\x20data:','Source\x20Currency:',',\x20body:\x20','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','text','HTTP\x20Status:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','append','https://api.plisio.net/api/v1/invoices/new','Unknown\x20error\x20from\x20Plisio\x20API','toLowerCase','toString','parse','FAILED','qr_code'];a44_0x3ccd=function(){return _0x57ae99;};return a44_0x3ccd();}(function(_0x5b3d9f,_0x2fed31){const _0x3e7ebf=a44_0x5d0e,_0x17563c=_0x5b3d9f();while(!![]){try{const _0x5933a2=parseInt(_0x3e7ebf(0x1ea))/0x1+-parseInt(_0x3e7ebf(0x19d))/0x2*(parseInt(_0x3e7ebf(0x1a4))/0x3)+parseInt(_0x3e7ebf(0x1f9))/0x4+parseInt(_0x3e7ebf(0x1c9))/0x5*(-parseInt(_0x3e7ebf(0x1ef))/0x6)+-parseInt(_0x3e7ebf(0x203))/0x7+parseInt(_0x3e7ebf(0x194))/0x8*(-parseInt(_0x3e7ebf(0x18e))/0x9)+-parseInt(_0x3e7ebf(0x1cc))/0xa*(-parseInt(_0x3e7ebf(0x198))/0xb);if(_0x5933a2===_0x2fed31)break;else _0x17563c['push'](_0x17563c['shift']());}catch(_0x11ae47){_0x17563c['push'](_0x17563c['shift']());}}}(a44_0x3ccd,0x63c6c));Object[a44_0x3fb479(0x1f2)](exports,a44_0x3fb479(0x1c1),{'value':!![]}),exports[a44_0x3fb479(0x1fc)]=void 0x0;const loggerService_1=require(a44_0x3fb479(0x1cd));function a44_0x5d0e(_0x16946e,_0xf73a7f){const _0x3ccd3f=a44_0x3ccd();return a44_0x5d0e=function(_0x5d0e5c,_0x5582f2){_0x5d0e5c=_0x5d0e5c-0x18e;let _0x3051fc=_0x3ccd3f[_0x5d0e5c];return _0x3051fc;},a44_0x5d0e(_0x16946e,_0xf73a7f);}class PlisioService{constructor(){const _0x22c0e1=a44_0x3fb479;this[_0x22c0e1(0x1b1)]=_0x22c0e1(0x1e3),this[_0x22c0e1(0x19c)]=process[_0x22c0e1(0x1c0)][_0x22c0e1(0x1a6)]||'',!this['apiKey']?console['warn'](_0x22c0e1(0x1b2)):console[_0x22c0e1(0x1b0)](_0x22c0e1(0x1a5));}async[a44_0x3fb479(0x1f6)](_0x17b4d0){const _0x59624e=a44_0x3fb479,{orderId:_0xeadc96,amount:_0x242cd9,currency:_0x5ecf30,productName:_0x2d47fd,description:_0x4bcd9a,successUrl:_0x4d786c,failUrl:_0x434a65,customerEmail:_0x19f1a9,customerName:_0x299d97,isSourceCurrency:_0x230d3a,sourceCurrency:_0x27a260}=_0x17b4d0;if(!this['apiKey'])throw new Error(_0x59624e(0x202));const _0x45eb64=new URLSearchParams({'api_key':this[_0x59624e(0x19c)],'order_number':_0xeadc96,'order_name':_0x2d47fd,'description':_0x4bcd9a,'success_url':_0x4d786c,'fail_url':_0x434a65,'callback_url':_0x59624e(0x201)});_0x27a260?(_0x45eb64[_0x59624e(0x1e2)]('currency',_0x27a260),_0x45eb64[_0x59624e(0x1e2)]('source_currency',_0x5ecf30),_0x45eb64[_0x59624e(0x1e2)](_0x59624e(0x1bf),_0x242cd9[_0x59624e(0x1e6)]())):(_0x45eb64[_0x59624e(0x1e2)](_0x59624e(0x19f),_0x5ecf30),_0x45eb64['append'](_0x59624e(0x19e),_0x242cd9[_0x59624e(0x1e6)]()));_0x19f1a9&&_0x45eb64[_0x59624e(0x1e2)]('email',_0x19f1a9);_0x299d97&&_0x45eb64[_0x59624e(0x1e2)]('name',_0x299d97);const _0x2fd694=this[_0x59624e(0x1b1)]+'?'+_0x45eb64[_0x59624e(0x1e6)](),_0x312bdd=Date[_0x59624e(0x206)]();try{console['log'](_0x59624e(0x1e1)),console[_0x59624e(0x1b0)](_0x59624e(0x1d8),this['apiUrl']),console[_0x59624e(0x1b0)](_0x59624e(0x1b7),Object['fromEntries'](_0x45eb64['entries']())),console[_0x59624e(0x1b0)](_0x59624e(0x1b8),_0x2fd694[_0x59624e(0x1ad)](this[_0x59624e(0x19c)],_0x59624e(0x190))),loggerService_1[_0x59624e(0x1fa)][_0x59624e(0x1ee)]('plisio_direct',_0x59624e(0x1d6),_0x59624e(0x1d4),Object[_0x59624e(0x1c7)](_0x45eb64[_0x59624e(0x209)]()));const _0x543d60=await fetch(_0x2fd694,{'method':_0x59624e(0x1d4),'headers':{'Accept':_0x59624e(0x1c5),'User-Agent':_0x59624e(0x1cb)}}),_0x5dd12f=Date[_0x59624e(0x206)]()-_0x312bdd;console[_0x59624e(0x1b0)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x59624e(0x1b0)](_0x59624e(0x1f1),_0x543d60['status']),console[_0x59624e(0x1b0)](_0x59624e(0x1ca),_0x543d60[_0x59624e(0x1a9)]),console['log'](_0x59624e(0x1ba),_0x5dd12f+'ms');const _0x22f83f=await _0x543d60[_0x59624e(0x1df)]();console[_0x59624e(0x1b0)](_0x59624e(0x1bc),_0x22f83f);if(!_0x543d60['ok']){console[_0x59624e(0x1f7)](_0x59624e(0x1aa)),console[_0x59624e(0x1f7)](_0x59624e(0x1e0),_0x543d60[_0x59624e(0x1a7)]),console['error'](_0x59624e(0x20a),_0x22f83f),loggerService_1[_0x59624e(0x1fa)][_0x59624e(0x205)](_0x59624e(0x1bb),_0x59624e(0x1d6),_0x543d60[_0x59624e(0x1a7)],_0x22f83f,_0x5dd12f),loggerService_1['loggerService']['logWhiteDomainError'](_0x59624e(0x1bb),_0x59624e(0x1d6),_0x59624e(0x1c8)+_0x543d60[_0x59624e(0x1a7)]+':\x20'+_0x22f83f);throw new Error(_0x59624e(0x1d0)+_0x543d60[_0x59624e(0x1a7)]+_0x59624e(0x1dd)+_0x22f83f);}let _0x1af422;try{_0x1af422=JSON[_0x59624e(0x1e7)](_0x22f83f);}catch(_0x5b8a87){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x5b8a87),loggerService_1[_0x59624e(0x1fa)][_0x59624e(0x1af)]('plisio_direct',_0x59624e(0x1d6),_0x59624e(0x204)+_0x5b8a87);throw new Error(_0x59624e(0x1ab)+_0x22f83f);}console[_0x59624e(0x1b0)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console['log'](_0x59624e(0x19b),JSON[_0x59624e(0x208)](_0x1af422,null,0x2)),loggerService_1[_0x59624e(0x1fa)][_0x59624e(0x205)]('plisio_direct','/invoices/new',_0x543d60[_0x59624e(0x1a7)],_0x1af422,_0x5dd12f);if(_0x1af422[_0x59624e(0x1a7)]!=='success'){const _0x29ee7d=_0x1af422[_0x59624e(0x1d9)]||_0x1af422[_0x59624e(0x1f7)]||_0x59624e(0x1e4);console[_0x59624e(0x1f7)](_0x59624e(0x1a3)),console[_0x59624e(0x1f7)](_0x59624e(0x1b5),_0x29ee7d),loggerService_1[_0x59624e(0x1fa)][_0x59624e(0x1af)](_0x59624e(0x1bb),'/invoices/new','Business\x20Error:\x20'+_0x29ee7d);throw new Error(_0x59624e(0x1f8)+_0x29ee7d);}if(!_0x1af422['data']?.[_0x59624e(0x1d1)]||!_0x1af422['data']?.[_0x59624e(0x195)]){console[_0x59624e(0x1f7)](_0x59624e(0x1de)),console[_0x59624e(0x1f7)](_0x59624e(0x1eb)),console[_0x59624e(0x1f7)](_0x59624e(0x191),_0x1af422[_0x59624e(0x1c2)]),loggerService_1[_0x59624e(0x1fa)][_0x59624e(0x1af)](_0x59624e(0x1bb),_0x59624e(0x1d6),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x59624e(0x1da));}return console['log']('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x59624e(0x1b0)](_0x59624e(0x19a),_0x1af422[_0x59624e(0x1c2)][_0x59624e(0x1d1)]),console['log'](_0x59624e(0x1b4),_0x1af422[_0x59624e(0x1c2)][_0x59624e(0x195)]),console['log']('Amount:',_0x242cd9,_0x5ecf30),_0x27a260&&(console[_0x59624e(0x1b0)](_0x59624e(0x1dc),_0x27a260,_0x59624e(0x1fb)),console[_0x59624e(0x1b0)](_0x59624e(0x1c3),_0x5ecf30,_0x59624e(0x18f))),{'gateway_payment_id':_0x1af422[_0x59624e(0x1c2)][_0x59624e(0x1d1)],'payment_url':_0x1af422['data'][_0x59624e(0x195)],'invoice_total_sum':_0x1af422[_0x59624e(0x1c2)][_0x59624e(0x1a0)],'qr_code':_0x1af422[_0x59624e(0x1c2)][_0x59624e(0x1e9)],'qr_url':_0x1af422[_0x59624e(0x1c2)][_0x59624e(0x207)]};}catch(_0x575127){console[_0x59624e(0x1f7)](_0x59624e(0x1d2)),console['error'](_0x59624e(0x1ff),_0x575127),loggerService_1[_0x59624e(0x1fa)][_0x59624e(0x1af)](_0x59624e(0x1bb),_0x59624e(0x1d6),_0x575127);if(_0x575127 instanceof Error){console[_0x59624e(0x1f7)]('Error\x20message:',_0x575127[_0x59624e(0x1d9)]),console[_0x59624e(0x1f7)]('Error\x20stack:',_0x575127[_0x59624e(0x1a1)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x575127[_0x59624e(0x1d9)]);}throw new Error(_0x59624e(0x1cf));}}async[a44_0x3fb479(0x1d5)](_0x27e99a){const _0x5108cb=a44_0x3fb479,_0x3bb4ba=Date[_0x5108cb(0x206)]();try{if(!this[_0x5108cb(0x19c)])throw new Error(_0x5108cb(0x202));const _0x33a7d2=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x27e99a}),_0x3369e1=_0x5108cb(0x1ce)+_0x27e99a+'?'+_0x33a7d2[_0x5108cb(0x1e6)]();loggerService_1[_0x5108cb(0x1fa)]['logWhiteDomainRequest'](_0x5108cb(0x1bb),_0x5108cb(0x1b9)+_0x27e99a,'GET',Object['fromEntries'](_0x33a7d2['entries']()));const _0x422aa4=await fetch(_0x3369e1,{'method':_0x5108cb(0x1d4),'headers':{'Accept':_0x5108cb(0x1c5),'User-Agent':_0x5108cb(0x1cb)}}),_0x2186d8=Date[_0x5108cb(0x206)]()-_0x3bb4ba;if(!_0x422aa4['ok']){const _0x213ccc=await _0x422aa4[_0x5108cb(0x1df)]();loggerService_1['loggerService'][_0x5108cb(0x205)](_0x5108cb(0x1bb),_0x5108cb(0x1b9)+_0x27e99a,_0x422aa4[_0x5108cb(0x1a7)],_0x213ccc,_0x2186d8);throw new Error(_0x5108cb(0x1d0)+_0x422aa4[_0x5108cb(0x1a7)]);}const _0x175ea9=await _0x422aa4[_0x5108cb(0x1b3)]();loggerService_1[_0x5108cb(0x1fa)]['logWhiteDomainResponse'](_0x5108cb(0x1bb),_0x5108cb(0x1b9)+_0x27e99a,_0x422aa4[_0x5108cb(0x1a7)],_0x175ea9,_0x2186d8);if(_0x175ea9['status']!==_0x5108cb(0x1a2)){loggerService_1[_0x5108cb(0x1fa)][_0x5108cb(0x1af)]('plisio_direct','/operations/'+_0x27e99a,_0x5108cb(0x1f8)+(_0x175ea9[_0x5108cb(0x1d9)]||_0x175ea9[_0x5108cb(0x1f7)]||_0x5108cb(0x197)));throw new Error(_0x5108cb(0x1f8)+(_0x175ea9['message']||_0x175ea9[_0x5108cb(0x1f7)]||_0x5108cb(0x197)));}let _0x366d3a=_0x5108cb(0x1d3);return{'status':_0x366d3a};}catch(_0x35344b){console[_0x5108cb(0x1f7)]('Plisio\x20payment\x20verification\x20error:',_0x35344b),loggerService_1['loggerService'][_0x5108cb(0x1af)](_0x5108cb(0x1bb),_0x5108cb(0x1b9)+_0x27e99a,_0x35344b);throw new Error(_0x5108cb(0x1c6)+(_0x35344b instanceof Error?_0x35344b[_0x5108cb(0x1d9)]:_0x5108cb(0x197)));}}async[a44_0x3fb479(0x1ec)](_0x41072a){const _0x23c331=a44_0x3fb479;console['log'](_0x23c331(0x1b6),_0x41072a);let _0x25cdab='PENDING';switch(_0x41072a['status']?.[_0x23c331(0x1e5)]()){case _0x23c331(0x1ac):case _0x23c331(0x1fe):_0x25cdab=_0x23c331(0x1c4);break;case _0x23c331(0x1a8):_0x25cdab=_0x23c331(0x1f4);break;case'error':case'cancelled':_0x25cdab=_0x23c331(0x1e8);break;case _0x23c331(0x200):_0x25cdab=_0x23c331(0x1d3);break;case'pending':_0x25cdab=_0x23c331(0x199);break;default:_0x25cdab=_0x23c331(0x1d3);break;}let _0x182f8c;if(_0x41072a[_0x23c331(0x193)])try{console[_0x23c331(0x1b0)](_0x23c331(0x192),_0x41072a[_0x23c331(0x193)]);let _0x1f338d;if(typeof _0x41072a[_0x23c331(0x193)]==='string')_0x1f338d=JSON['parse'](_0x41072a[_0x23c331(0x193)]);else Array[_0x23c331(0x1f5)](_0x41072a[_0x23c331(0x193)])?_0x1f338d=_0x41072a[_0x23c331(0x193)]:_0x1f338d=[];_0x182f8c=_0x1f338d[_0x23c331(0x1bd)](_0x3ba1a6=>{const _0xb7c9cb=_0x23c331,_0x4f5ea3=_0x3ba1a6[_0xb7c9cb(0x1ad)](/\\/g,'');return console[_0xb7c9cb(0x1b0)](_0xb7c9cb(0x1fd)+_0x3ba1a6+_0xb7c9cb(0x1ed)+_0x4f5ea3),_0x4f5ea3;}),console[_0x23c331(0x1b0)](_0x23c331(0x1be),_0x182f8c),_0x182f8c[_0x23c331(0x1f0)]((_0x457e14,_0x249f09)=>{const _0x45452c=_0x23c331;try{new URL(_0x457e14),console['log'](_0x45452c(0x196)+(_0x249f09+0x1)+_0x45452c(0x1f3)+_0x457e14);}catch(_0x180fa8){console[_0x45452c(0x1f7)]('‚ùå\x20URL\x20'+(_0x249f09+0x1)+_0x45452c(0x1ae)+_0x457e14,_0x180fa8);}});}catch(_0x295466){console[_0x23c331(0x1f7)](_0x23c331(0x1d7),_0x295466),console[_0x23c331(0x1f7)](_0x23c331(0x1db),_0x41072a[_0x23c331(0x193)]),_0x182f8c=undefined;}return{'paymentId':_0x41072a[_0x23c331(0x20b)]||'','status':_0x25cdab,'amount':_0x41072a['amount'],'currency':_0x41072a[_0x23c331(0x19f)],'txUrls':_0x182f8c};}}exports[a44_0x3fb479(0x1fc)]=PlisioService;