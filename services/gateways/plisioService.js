'use strict';function a49_0x1290(_0x532bad,_0x4f81fe){const _0x474138=a49_0x4741();return a49_0x1290=function(_0x129026,_0x49206e){_0x129026=_0x129026-0x13f;let _0x3803a4=_0x474138[_0x129026];return _0x3803a4;},a49_0x1290(_0x532bad,_0x4f81fe);}const a49_0x4dfb09=a49_0x1290;(function(_0x5ad5d9,_0x52d3a2){const _0x133670=a49_0x1290,_0x54589f=_0x5ad5d9();while(!![]){try{const _0x402750=parseInt(_0x133670(0x154))/0x1+-parseInt(_0x133670(0x185))/0x2+-parseInt(_0x133670(0x1b2))/0x3+parseInt(_0x133670(0x160))/0x4*(parseInt(_0x133670(0x156))/0x5)+parseInt(_0x133670(0x19c))/0x6*(-parseInt(_0x133670(0x18f))/0x7)+-parseInt(_0x133670(0x140))/0x8+-parseInt(_0x133670(0x16a))/0x9*(-parseInt(_0x133670(0x1ae))/0xa);if(_0x402750===_0x52d3a2)break;else _0x54589f['push'](_0x54589f['shift']());}catch(_0x4068dc){_0x54589f['push'](_0x54589f['shift']());}}}(a49_0x4741,0x1a506));Object['defineProperty'](exports,a49_0x4dfb09(0x16e),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a49_0x4dfb09(0x19e));class PlisioService{constructor(){const _0x1c8aab=a49_0x4dfb09;this[_0x1c8aab(0x18d)]='https://api.plisio.net/api/v1/invoices/new',this[_0x1c8aab(0x19b)]=process[_0x1c8aab(0x17c)]['PLISIO_API_KEY']||'',!this['apiKey']?console[_0x1c8aab(0x1a0)]('⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x1c8aab(0x174)](_0x1c8aab(0x1a8));}async[a49_0x4dfb09(0x15a)](_0x267037){const _0x475f58=a49_0x4dfb09,{orderId:_0xcedff1,amount:_0x163715,currency:_0x2f5815,productName:_0x536fc3,description:_0xe781a4,successUrl:_0x28929e,failUrl:_0x5c6de4,customerEmail:_0x3de22a,customerName:_0x4520ce,isSourceCurrency:_0x5e465a,sourceCurrency:_0x1c4703}=_0x267037;if(!this[_0x475f58(0x19b)])throw new Error(_0x475f58(0x183));const _0x58c0d0=new URLSearchParams({'api_key':this[_0x475f58(0x19b)],'order_number':_0xcedff1,'order_name':_0x536fc3,'description':_0xe781a4,'success_url':_0x28929e,'fail_url':_0x5c6de4,'callback_url':_0x475f58(0x148)});_0x1c4703?(_0x58c0d0[_0x475f58(0x13f)](_0x475f58(0x199),_0x1c4703),_0x58c0d0[_0x475f58(0x13f)](_0x475f58(0x1b3),_0x2f5815),_0x58c0d0[_0x475f58(0x13f)](_0x475f58(0x17a),_0x163715[_0x475f58(0x167)]())):(_0x58c0d0['append']('currency',_0x2f5815),_0x58c0d0['append']('amount',_0x163715['toString']()));_0x3de22a&&_0x58c0d0[_0x475f58(0x13f)]('email',_0x3de22a);_0x4520ce&&_0x58c0d0[_0x475f58(0x13f)](_0x475f58(0x196),_0x4520ce);const _0x2c6325=this[_0x475f58(0x18d)]+'?'+_0x58c0d0[_0x475f58(0x167)](),_0x317872=Date['now']();try{console['log'](_0x475f58(0x190)),console[_0x475f58(0x174)]('URL:',this[_0x475f58(0x18d)]),console[_0x475f58(0x174)](_0x475f58(0x16d),Object[_0x475f58(0x16c)](_0x58c0d0['entries']())),console[_0x475f58(0x174)]('Full\x20URL\x20(without\x20API\x20key):',_0x2c6325[_0x475f58(0x1a9)](this['apiKey'],_0x475f58(0x150))),loggerService_1[_0x475f58(0x173)][_0x475f58(0x157)]('plisio_direct',_0x475f58(0x146),_0x475f58(0x143),Object[_0x475f58(0x16c)](_0x58c0d0[_0x475f58(0x177)]()));const _0x232284=await fetch(_0x2c6325,{'method':_0x475f58(0x143),'headers':{'Accept':_0x475f58(0x168),'User-Agent':_0x475f58(0x14e)}}),_0x2c8360=Date['now']()-_0x317872;console[_0x475f58(0x174)](_0x475f58(0x16b)),console[_0x475f58(0x174)](_0x475f58(0x172),_0x232284[_0x475f58(0x178)]),console[_0x475f58(0x174)](_0x475f58(0x141),_0x232284[_0x475f58(0x15f)]),console[_0x475f58(0x174)](_0x475f58(0x1a2),_0x2c8360+'ms');const _0x4c6500=await _0x232284['text']();console[_0x475f58(0x174)](_0x475f58(0x187),_0x4c6500);if(!_0x232284['ok']){console[_0x475f58(0x159)](_0x475f58(0x15c)),console[_0x475f58(0x159)]('HTTP\x20Status:',_0x232284[_0x475f58(0x178)]),console['error'](_0x475f58(0x144),_0x4c6500),loggerService_1['loggerService'][_0x475f58(0x184)]('plisio_direct',_0x475f58(0x146),_0x232284[_0x475f58(0x178)],_0x4c6500,_0x2c8360),loggerService_1[_0x475f58(0x173)][_0x475f58(0x169)](_0x475f58(0x170),_0x475f58(0x146),_0x475f58(0x1b1)+_0x232284[_0x475f58(0x178)]+':\x20'+_0x4c6500);throw new Error('HTTP\x20error!\x20status:\x20'+_0x232284[_0x475f58(0x178)]+_0x475f58(0x19d)+_0x4c6500);}let _0x47e52c;try{_0x47e52c=JSON[_0x475f58(0x198)](_0x4c6500);}catch(_0x5ed1e2){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x5ed1e2),loggerService_1[_0x475f58(0x173)]['logWhiteDomainError']('plisio_direct',_0x475f58(0x146),_0x475f58(0x1a7)+_0x5ed1e2);throw new Error(_0x475f58(0x197)+_0x4c6500);}console[_0x475f58(0x174)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console['log'](_0x475f58(0x14b),JSON[_0x475f58(0x179)](_0x47e52c,null,0x2)),loggerService_1[_0x475f58(0x173)][_0x475f58(0x184)](_0x475f58(0x170),_0x475f58(0x146),_0x232284[_0x475f58(0x178)],_0x47e52c,_0x2c8360);if(_0x47e52c[_0x475f58(0x178)]!==_0x475f58(0x192)){const _0x326d4e=_0x47e52c[_0x475f58(0x175)]||_0x47e52c[_0x475f58(0x159)]||_0x475f58(0x14c);console[_0x475f58(0x159)](_0x475f58(0x1ac)),console[_0x475f58(0x159)](_0x475f58(0x145),_0x326d4e),loggerService_1[_0x475f58(0x173)][_0x475f58(0x169)]('plisio_direct',_0x475f58(0x146),_0x475f58(0x176)+_0x326d4e);throw new Error('Plisio\x20API\x20error:\x20'+_0x326d4e);}if(!_0x47e52c[_0x475f58(0x163)]?.[_0x475f58(0x155)]||!_0x47e52c['data']?.['invoice_url']){console[_0x475f58(0x159)](_0x475f58(0x182)),console[_0x475f58(0x159)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console['error'](_0x475f58(0x186),_0x47e52c[_0x475f58(0x163)]),loggerService_1[_0x475f58(0x173)][_0x475f58(0x169)](_0x475f58(0x170),'/invoices/new',_0x475f58(0x1aa));throw new Error(_0x475f58(0x1a6));}return console[_0x475f58(0x174)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x475f58(0x174)](_0x475f58(0x1ad),_0x47e52c['data'][_0x475f58(0x155)]),console[_0x475f58(0x174)]('Invoice\x20URL:',_0x47e52c[_0x475f58(0x163)][_0x475f58(0x14d)]),console[_0x475f58(0x174)](_0x475f58(0x152),_0x163715,_0x2f5815),_0x1c4703&&(console[_0x475f58(0x174)](_0x475f58(0x1a3),_0x1c4703,_0x475f58(0x147)),console[_0x475f58(0x174)](_0x475f58(0x151),_0x2f5815,_0x475f58(0x14f))),{'gateway_payment_id':_0x47e52c[_0x475f58(0x163)][_0x475f58(0x155)],'payment_url':_0x47e52c['data'][_0x475f58(0x14d)],'invoice_total_sum':_0x47e52c[_0x475f58(0x163)][_0x475f58(0x149)],'qr_code':_0x47e52c[_0x475f58(0x163)][_0x475f58(0x162)],'qr_url':_0x47e52c[_0x475f58(0x163)]['qr_url']};}catch(_0x3b8df8){console[_0x475f58(0x159)](_0x475f58(0x18e)),console[_0x475f58(0x159)]('Error\x20details:',_0x3b8df8),loggerService_1['loggerService'][_0x475f58(0x169)]('plisio_direct',_0x475f58(0x146),_0x3b8df8);if(_0x3b8df8 instanceof Error){console['error']('Error\x20message:',_0x3b8df8[_0x475f58(0x175)]),console[_0x475f58(0x159)](_0x475f58(0x171),_0x3b8df8[_0x475f58(0x1b4)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x3b8df8[_0x475f58(0x175)]);}throw new Error(_0x475f58(0x1b0));}}async['verifyPayment'](_0x84aecf){const _0xb57b93=a49_0x4dfb09,_0x3b3d12=Date[_0xb57b93(0x17b)]();try{if(!this['apiKey'])throw new Error(_0xb57b93(0x183));const _0x45788a=new URLSearchParams({'api_key':this[_0xb57b93(0x19b)],'txn_id':_0x84aecf}),_0x2c9ba7=_0xb57b93(0x181)+_0x84aecf+'?'+_0x45788a[_0xb57b93(0x167)]();loggerService_1[_0xb57b93(0x173)][_0xb57b93(0x157)](_0xb57b93(0x170),'/operations/'+_0x84aecf,'GET',Object['fromEntries'](_0x45788a[_0xb57b93(0x177)]()));const _0xeabb23=await fetch(_0x2c9ba7,{'method':_0xb57b93(0x143),'headers':{'Accept':_0xb57b93(0x168),'User-Agent':_0xb57b93(0x14e)}}),_0x14ab0f=Date[_0xb57b93(0x17b)]()-_0x3b3d12;if(!_0xeabb23['ok']){const _0x55c1e4=await _0xeabb23['text']();loggerService_1[_0xb57b93(0x173)][_0xb57b93(0x184)](_0xb57b93(0x170),_0xb57b93(0x1a4)+_0x84aecf,_0xeabb23[_0xb57b93(0x178)],_0x55c1e4,_0x14ab0f);throw new Error(_0xb57b93(0x19a)+_0xeabb23[_0xb57b93(0x178)]);}const _0x4c9cfc=await _0xeabb23[_0xb57b93(0x193)]();loggerService_1[_0xb57b93(0x173)][_0xb57b93(0x184)](_0xb57b93(0x170),_0xb57b93(0x1a4)+_0x84aecf,_0xeabb23[_0xb57b93(0x178)],_0x4c9cfc,_0x14ab0f);if(_0x4c9cfc[_0xb57b93(0x178)]!==_0xb57b93(0x192)){loggerService_1['loggerService']['logWhiteDomainError'](_0xb57b93(0x170),_0xb57b93(0x1a4)+_0x84aecf,'Plisio\x20API\x20error:\x20'+(_0x4c9cfc['message']||_0x4c9cfc['error']||_0xb57b93(0x158)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x4c9cfc[_0xb57b93(0x175)]||_0x4c9cfc[_0xb57b93(0x159)]||_0xb57b93(0x158)));}let _0x1e4366=_0xb57b93(0x194);return{'status':_0x1e4366};}catch(_0x227542){console[_0xb57b93(0x159)](_0xb57b93(0x180),_0x227542),loggerService_1['loggerService']['logWhiteDomainError'](_0xb57b93(0x170),'/operations/'+_0x84aecf,_0x227542);throw new Error(_0xb57b93(0x164)+(_0x227542 instanceof Error?_0x227542[_0xb57b93(0x175)]:_0xb57b93(0x158)));}}async[a49_0x4dfb09(0x1a1)](_0xd9620d){const _0x4e45b0=a49_0x4dfb09;console['log'](_0x4e45b0(0x195),_0xd9620d);let _0x5a825b=_0x4e45b0(0x194);switch(_0xd9620d['status']?.[_0x4e45b0(0x1ab)]()){case _0x4e45b0(0x15b):case _0x4e45b0(0x1a5):_0x5a825b=_0x4e45b0(0x18b);break;case'expired':_0x5a825b=_0x4e45b0(0x19f);break;case'error':case _0x4e45b0(0x191):_0x5a825b=_0x4e45b0(0x17f);break;case _0x4e45b0(0x16f):_0x5a825b=_0x4e45b0(0x194);break;case _0x4e45b0(0x15d):_0x5a825b=_0x4e45b0(0x1af);break;default:_0x5a825b='PENDING';break;}let _0x5d8fa5;if(_0xd9620d[_0x4e45b0(0x15e)])try{console[_0x4e45b0(0x174)](_0x4e45b0(0x17d),_0xd9620d[_0x4e45b0(0x15e)]);let _0x43cb4d;if(typeof _0xd9620d['tx_urls']===_0x4e45b0(0x142))_0x43cb4d=JSON[_0x4e45b0(0x198)](_0xd9620d[_0x4e45b0(0x15e)]);else Array['isArray'](_0xd9620d['tx_urls'])?_0x43cb4d=_0xd9620d[_0x4e45b0(0x15e)]:_0x43cb4d=[];_0x5d8fa5=_0x43cb4d[_0x4e45b0(0x17e)](_0x10e9d5=>{const _0x223526=_0x4e45b0,_0x36f0cd=_0x10e9d5[_0x223526(0x1a9)](/\\/g,'');return console[_0x223526(0x174)](_0x223526(0x189)+_0x10e9d5+_0x223526(0x161)+_0x36f0cd),_0x36f0cd;}),console[_0x4e45b0(0x174)](_0x4e45b0(0x153),_0x5d8fa5),_0x5d8fa5['forEach']((_0x4262d4,_0x2ea146)=>{const _0x42eb13=_0x4e45b0;try{new URL(_0x4262d4),console['log'](_0x42eb13(0x18c)+(_0x2ea146+0x1)+_0x42eb13(0x188)+_0x4262d4);}catch(_0x236106){console[_0x42eb13(0x159)](_0x42eb13(0x14a)+(_0x2ea146+0x1)+_0x42eb13(0x18a)+_0x4262d4,_0x236106);}});}catch(_0x5cd742){console[_0x4e45b0(0x159)](_0x4e45b0(0x165),_0x5cd742),console[_0x4e45b0(0x159)]('Raw\x20tx_urls\x20data:',_0xd9620d[_0x4e45b0(0x15e)]),_0x5d8fa5=undefined;}return{'paymentId':_0xd9620d['order_number']||'','status':_0x5a825b,'amount':_0xd9620d[_0x4e45b0(0x166)],'currency':_0xd9620d[_0x4e45b0(0x199)],'txUrls':_0x5d8fa5};}}function a49_0x4741(){const _0x42f35c=['env','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','map','FAILED','Plisio\x20payment\x20verification\x20error:','https://api.plisio.net/api/v1/operations/','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Plisio\x20API\x20key\x20is\x20not\x20configured','logWhiteDomainResponse','322034bdLlgc','Response\x20data:','Raw\x20Response\x20Body:','\x20is\x20valid:\x20','🔗\x20Formatted\x20URL:\x20','\x20is\x20invalid:\x20','PAID','✅\x20URL\x20','apiUrl','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','77WMyFHv','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','cancelled','success','json','PENDING','Processing\x20Plisio\x20webhook:','name','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','parse','currency','HTTP\x20error!\x20status:\x20','apiKey','46356rhpKFk',',\x20body:\x20','../loggerService','EXPIRED','warn','processWebhook','Response\x20Time:','Source\x20Currency:','/operations/','mismatch','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','JSON\x20Parse\x20Error:\x20','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','replace','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','toLowerCase','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Transaction\x20ID:','872070KxEPvi','PROCESSING','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','HTTP\x20','323247dmXgou','source_currency','stack','append','1560144WzZNgm','Status\x20Text:','string','GET','Response\x20Body:','Error\x20Message:','/invoices/new','(crypto\x20for\x20payment)','https://api.trapay.uk/api/webhooks/gateway/plisio','invoice_total_sum','❌\x20URL\x20','Parsed\x20Result:','Unknown\x20error\x20from\x20Plisio\x20API','invoice_url','TesSoft\x20Payment\x20System/1.0','(fiat\x20for\x20merchant)','HIDDEN','Target\x20Currency:','Amount:','✅\x20Processed\x20tx_urls:','143274RCWegy','txn_id','386215RyCita','logWhiteDomainRequest','Unknown\x20error','error','createPayment','completed','===\x20PLISIO\x20API\x20ERROR\x20===','pending','tx_urls','statusText','4RFnjDm','\x20->\x20','qr_code','data','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','❌\x20Failed\x20to\x20parse\x20tx_urls:','amount','toString','application/json','logWhiteDomainError','45MEPgAr','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','fromEntries','Parameters:','__esModule','new','plisio_direct','Error\x20stack:','Status:','loggerService','log','message','Business\x20Error:\x20','entries','status','stringify','source_amount','now'];a49_0x4741=function(){return _0x42f35c;};return a49_0x4741();}exports['PlisioService']=PlisioService;