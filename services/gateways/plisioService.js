'use strict';const a41_0x57b41e=a41_0x5486;(function(_0x1b316e,_0x450efd){const _0x130ef4=a41_0x5486,_0x39a76f=_0x1b316e();while(!![]){try{const _0x5833ff=parseInt(_0x130ef4(0x1ed))/0x1*(-parseInt(_0x130ef4(0x208))/0x2)+-parseInt(_0x130ef4(0x1f8))/0x3*(-parseInt(_0x130ef4(0x258))/0x4)+-parseInt(_0x130ef4(0x21b))/0x5+parseInt(_0x130ef4(0x264))/0x6+-parseInt(_0x130ef4(0x1f5))/0x7+-parseInt(_0x130ef4(0x23a))/0x8*(-parseInt(_0x130ef4(0x1ec))/0x9)+-parseInt(_0x130ef4(0x1fd))/0xa*(parseInt(_0x130ef4(0x214))/0xb);if(_0x5833ff===_0x450efd)break;else _0x39a76f['push'](_0x39a76f['shift']());}catch(_0x5da697){_0x39a76f['push'](_0x39a76f['shift']());}}}(a41_0x231a,0xb3787));Object['defineProperty'](exports,a41_0x57b41e(0x212),{'value':!![]}),exports['PlisioService']=void 0x0;function a41_0x5486(_0x380081,_0x51a437){const _0x231a0d=a41_0x231a();return a41_0x5486=function(_0x5486d0,_0x23b1f1){_0x5486d0=_0x5486d0-0x1ea;let _0x4c57d5=_0x231a0d[_0x5486d0];return _0x4c57d5;},a41_0x5486(_0x380081,_0x51a437);}const loggerService_1=require(a41_0x57b41e(0x21d));function a41_0x231a(){const _0x21bfc8=['552qbjnIc','Parsed\x20Result:','data','qr_url','logWhiteDomainResponse','Processing\x20Plisio\x20webhook:','/invoices/new','Response\x20Time:','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','Parameters:','\x20->\x20','verifyPayment','fromEntries','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','log','status','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','FAILED','HTTP\x20Status:','toString','parse','stringify','PlisioService','success','Plisio\x20payment\x20verification\x20error:','\x20is\x20valid:\x20','invoice_url','Invoice\x20URL:','append','4gToyCg','Business\x20Error:\x20','HTTP\x20error!\x20status:\x20','Plisio\x20API\x20error:\x20','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','cancelled','qr_code','createPayment','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','PLISIO_API_KEY','currency','Error\x20message:','7594350Twqdpb','Status:','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Response\x20Body:','135567pliHGM','163NhkDFj','expired','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','txn_id','https://api.plisio.net/api/v1/invoices/new','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','json','statusText','3944906Fjfgrr','error','logWhiteDomainError','1551444skgCsl','tx_urls','isArray','text','HTTP\x20','190pzrUJi','Error\x20details:','source_amount','https://api.plisio.net/api/v1/operations/','order_number','Transaction\x20ID:','source_currency','plisio_direct','Full\x20URL\x20(without\x20API\x20key):','===\x20PLISIO\x20SUCCESS\x20===','URL:','8462jyDiNl','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','map','/operations/','application/json','üîó\x20Formatted\x20URL:\x20','‚úÖ\x20URL\x20','===\x20PLISIO\x20API\x20ERROR\x20===','new',',\x20body:\x20','__esModule','Status\x20Text:','38027BfInpr','loggerService','now','Unknown\x20error','‚ùå\x20URL\x20','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','warn','3841075AfmRcN','Amount:','../loggerService','env','invoice_total_sum','Target\x20Currency:','PENDING','GET','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Plisio\x20API\x20key\x20is\x20not\x20configured','apiUrl','apiKey','completed','‚úÖ\x20Processed\x20tx_urls:','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','(crypto\x20for\x20payment)','Unknown\x20error\x20from\x20Plisio\x20API','Source\x20Currency:','Response\x20data:','(fiat\x20for\x20merchant)','entries','mismatch','logWhiteDomainRequest','string','message','JSON\x20Parse\x20Error:\x20','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Failed\x20to\x20parse\x20JSON\x20response:','Raw\x20Response\x20Body:','amount','PAID'];a41_0x231a=function(){return _0x21bfc8;};return a41_0x231a();}class PlisioService{constructor(){const _0x13b770=a41_0x57b41e;this[_0x13b770(0x225)]=_0x13b770(0x1f1),this['apiKey']=process[_0x13b770(0x21e)][_0x13b770(0x261)]||'',!this[_0x13b770(0x226)]?console[_0x13b770(0x21a)](_0x13b770(0x248)):console['log'](_0x13b770(0x235));}async[a41_0x57b41e(0x25f)](_0x4efd3e){const _0x4f978f=a41_0x57b41e,{orderId:_0x1d573f,amount:_0x133eed,currency:_0x22f762,productName:_0x55895b,description:_0x3498e3,successUrl:_0x5333ac,failUrl:_0x58c79a,customerEmail:_0x234f33,customerName:_0x4b3fbe,isSourceCurrency:_0x234bbc,sourceCurrency:_0x5b12df}=_0x4efd3e;if(!this['apiKey'])throw new Error(_0x4f978f(0x224));const _0x3da31d=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x1d573f,'order_name':_0x55895b,'description':_0x3498e3,'success_url':_0x5333ac,'fail_url':_0x58c79a,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x5b12df?(_0x3da31d[_0x4f978f(0x257)](_0x4f978f(0x262),_0x5b12df),_0x3da31d[_0x4f978f(0x257)](_0x4f978f(0x203),_0x22f762),_0x3da31d['append'](_0x4f978f(0x1ff),_0x133eed[_0x4f978f(0x24e)]())):(_0x3da31d[_0x4f978f(0x257)](_0x4f978f(0x262),_0x22f762),_0x3da31d['append'](_0x4f978f(0x238),_0x133eed['toString']()));_0x234f33&&_0x3da31d['append']('email',_0x234f33);_0x4b3fbe&&_0x3da31d['append']('name',_0x4b3fbe);const _0x10f02c=this['apiUrl']+'?'+_0x3da31d[_0x4f978f(0x24e)](),_0x1b7c1c=Date[_0x4f978f(0x216)]();try{console['log'](_0x4f978f(0x223)),console[_0x4f978f(0x249)](_0x4f978f(0x207),this[_0x4f978f(0x225)]),console[_0x4f978f(0x249)](_0x4f978f(0x243),Object['fromEntries'](_0x3da31d[_0x4f978f(0x22f)]())),console[_0x4f978f(0x249)](_0x4f978f(0x205),_0x10f02c['replace'](this[_0x4f978f(0x226)],'HIDDEN')),loggerService_1[_0x4f978f(0x215)][_0x4f978f(0x231)](_0x4f978f(0x204),_0x4f978f(0x240),_0x4f978f(0x222),Object['fromEntries'](_0x3da31d[_0x4f978f(0x22f)]()));const _0x2b21ac=await fetch(_0x10f02c,{'method':_0x4f978f(0x222),'headers':{'Accept':_0x4f978f(0x20c),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x18812b=Date[_0x4f978f(0x216)]()-_0x1b7c1c;console[_0x4f978f(0x249)](_0x4f978f(0x25c)),console[_0x4f978f(0x249)](_0x4f978f(0x265),_0x2b21ac['status']),console[_0x4f978f(0x249)](_0x4f978f(0x213),_0x2b21ac[_0x4f978f(0x1f4)]),console[_0x4f978f(0x249)](_0x4f978f(0x241),_0x18812b+'ms');const _0x230b48=await _0x2b21ac[_0x4f978f(0x1fb)]();console[_0x4f978f(0x249)](_0x4f978f(0x237),_0x230b48);if(!_0x2b21ac['ok']){console[_0x4f978f(0x1f6)](_0x4f978f(0x20f)),console[_0x4f978f(0x1f6)](_0x4f978f(0x24d),_0x2b21ac[_0x4f978f(0x24a)]),console[_0x4f978f(0x1f6)](_0x4f978f(0x1eb),_0x230b48),loggerService_1[_0x4f978f(0x215)][_0x4f978f(0x23e)](_0x4f978f(0x204),_0x4f978f(0x240),_0x2b21ac['status'],_0x230b48,_0x18812b),loggerService_1['loggerService'][_0x4f978f(0x1f7)](_0x4f978f(0x204),'/invoices/new',_0x4f978f(0x1fc)+_0x2b21ac[_0x4f978f(0x24a)]+':\x20'+_0x230b48);throw new Error(_0x4f978f(0x25a)+_0x2b21ac['status']+_0x4f978f(0x211)+_0x230b48);}let _0x336c04;try{_0x336c04=JSON['parse'](_0x230b48);}catch(_0x3030b5){console[_0x4f978f(0x1f6)](_0x4f978f(0x236),_0x3030b5),loggerService_1[_0x4f978f(0x215)]['logWhiteDomainError'](_0x4f978f(0x204),'/invoices/new',_0x4f978f(0x234)+_0x3030b5);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x230b48);}console[_0x4f978f(0x249)](_0x4f978f(0x1f2)),console[_0x4f978f(0x249)](_0x4f978f(0x23b),JSON[_0x4f978f(0x250)](_0x336c04,null,0x2)),loggerService_1['loggerService'][_0x4f978f(0x23e)](_0x4f978f(0x204),_0x4f978f(0x240),_0x2b21ac[_0x4f978f(0x24a)],_0x336c04,_0x18812b);if(_0x336c04['status']!==_0x4f978f(0x252)){const _0x4e8410=_0x336c04['message']||_0x336c04['error']||_0x4f978f(0x22b);console[_0x4f978f(0x1f6)](_0x4f978f(0x219)),console['error']('Error\x20Message:',_0x4e8410),loggerService_1[_0x4f978f(0x215)][_0x4f978f(0x1f7)](_0x4f978f(0x204),_0x4f978f(0x240),_0x4f978f(0x259)+_0x4e8410);throw new Error(_0x4f978f(0x25b)+_0x4e8410);}if(!_0x336c04[_0x4f978f(0x23c)]?.[_0x4f978f(0x1f0)]||!_0x336c04[_0x4f978f(0x23c)]?.[_0x4f978f(0x255)]){console['error'](_0x4f978f(0x247)),console[_0x4f978f(0x1f6)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x4f978f(0x1f6)](_0x4f978f(0x22d),_0x336c04[_0x4f978f(0x23c)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x4f978f(0x204),'/invoices/new',_0x4f978f(0x24b));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console['log'](_0x4f978f(0x206)),console['log'](_0x4f978f(0x202),_0x336c04[_0x4f978f(0x23c)][_0x4f978f(0x1f0)]),console[_0x4f978f(0x249)](_0x4f978f(0x256),_0x336c04[_0x4f978f(0x23c)][_0x4f978f(0x255)]),console[_0x4f978f(0x249)](_0x4f978f(0x21c),_0x133eed,_0x22f762),_0x5b12df&&(console[_0x4f978f(0x249)](_0x4f978f(0x22c),_0x5b12df,_0x4f978f(0x22a)),console[_0x4f978f(0x249)](_0x4f978f(0x220),_0x22f762,_0x4f978f(0x22e))),{'gateway_payment_id':_0x336c04[_0x4f978f(0x23c)][_0x4f978f(0x1f0)],'payment_url':_0x336c04[_0x4f978f(0x23c)][_0x4f978f(0x255)],'invoice_total_sum':_0x336c04[_0x4f978f(0x23c)][_0x4f978f(0x21f)],'qr_code':_0x336c04['data'][_0x4f978f(0x25e)],'qr_url':_0x336c04[_0x4f978f(0x23c)][_0x4f978f(0x23d)]};}catch(_0x5bb7e6){console['error'](_0x4f978f(0x229)),console[_0x4f978f(0x1f6)](_0x4f978f(0x1fe),_0x5bb7e6),loggerService_1[_0x4f978f(0x215)][_0x4f978f(0x1f7)](_0x4f978f(0x204),_0x4f978f(0x240),_0x5bb7e6);if(_0x5bb7e6 instanceof Error){console['error'](_0x4f978f(0x263),_0x5bb7e6[_0x4f978f(0x233)]),console[_0x4f978f(0x1f6)]('Error\x20stack:',_0x5bb7e6['stack']);throw new Error(_0x4f978f(0x1ea)+_0x5bb7e6['message']);}throw new Error(_0x4f978f(0x209));}}async[a41_0x57b41e(0x245)](_0x33c989){const _0x1ef73c=a41_0x57b41e,_0x51d6d1=Date[_0x1ef73c(0x216)]();try{if(!this[_0x1ef73c(0x226)])throw new Error(_0x1ef73c(0x224));const _0x1a2c26=new URLSearchParams({'api_key':this[_0x1ef73c(0x226)],'txn_id':_0x33c989}),_0x5abdee=_0x1ef73c(0x200)+_0x33c989+'?'+_0x1a2c26[_0x1ef73c(0x24e)]();loggerService_1[_0x1ef73c(0x215)]['logWhiteDomainRequest'](_0x1ef73c(0x204),_0x1ef73c(0x20b)+_0x33c989,_0x1ef73c(0x222),Object[_0x1ef73c(0x246)](_0x1a2c26[_0x1ef73c(0x22f)]()));const _0xba9a93=await fetch(_0x5abdee,{'method':_0x1ef73c(0x222),'headers':{'Accept':_0x1ef73c(0x20c),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x2496b8=Date['now']()-_0x51d6d1;if(!_0xba9a93['ok']){const _0x2c43f8=await _0xba9a93[_0x1ef73c(0x1fb)]();loggerService_1['loggerService'][_0x1ef73c(0x23e)](_0x1ef73c(0x204),_0x1ef73c(0x20b)+_0x33c989,_0xba9a93[_0x1ef73c(0x24a)],_0x2c43f8,_0x2496b8);throw new Error('HTTP\x20error!\x20status:\x20'+_0xba9a93[_0x1ef73c(0x24a)]);}const _0x40a1cd=await _0xba9a93[_0x1ef73c(0x1f3)]();loggerService_1[_0x1ef73c(0x215)]['logWhiteDomainResponse']('plisio_direct',_0x1ef73c(0x20b)+_0x33c989,_0xba9a93[_0x1ef73c(0x24a)],_0x40a1cd,_0x2496b8);if(_0x40a1cd['status']!==_0x1ef73c(0x252)){loggerService_1['loggerService'][_0x1ef73c(0x1f7)](_0x1ef73c(0x204),_0x1ef73c(0x20b)+_0x33c989,'Plisio\x20API\x20error:\x20'+(_0x40a1cd[_0x1ef73c(0x233)]||_0x40a1cd[_0x1ef73c(0x1f6)]||'Unknown\x20error'));throw new Error(_0x1ef73c(0x25b)+(_0x40a1cd[_0x1ef73c(0x233)]||_0x40a1cd[_0x1ef73c(0x1f6)]||_0x1ef73c(0x217)));}let _0x144a0b=_0x1ef73c(0x221);return{'status':_0x144a0b};}catch(_0x2c7044){console[_0x1ef73c(0x1f6)](_0x1ef73c(0x253),_0x2c7044),loggerService_1[_0x1ef73c(0x215)][_0x1ef73c(0x1f7)]('plisio_direct',_0x1ef73c(0x20b)+_0x33c989,_0x2c7044);throw new Error(_0x1ef73c(0x260)+(_0x2c7044 instanceof Error?_0x2c7044[_0x1ef73c(0x233)]:_0x1ef73c(0x217)));}}async['processWebhook'](_0x2301a7){const _0x448c6e=a41_0x57b41e;console[_0x448c6e(0x249)](_0x448c6e(0x23f),_0x2301a7);let _0x977f4f=_0x448c6e(0x221);switch(_0x2301a7[_0x448c6e(0x24a)]?.['toLowerCase']()){case _0x448c6e(0x227):case _0x448c6e(0x230):_0x977f4f=_0x448c6e(0x239);break;case _0x448c6e(0x1ee):_0x977f4f='EXPIRED';break;case'error':case _0x448c6e(0x25d):_0x977f4f=_0x448c6e(0x24c);break;case _0x448c6e(0x210):case'pending':default:_0x977f4f=_0x448c6e(0x221);break;}let _0x2af3f;if(_0x2301a7[_0x448c6e(0x1f9)])try{console[_0x448c6e(0x249)](_0x448c6e(0x1ef),_0x2301a7[_0x448c6e(0x1f9)]);let _0x986382;if(typeof _0x2301a7[_0x448c6e(0x1f9)]===_0x448c6e(0x232))_0x986382=JSON[_0x448c6e(0x24f)](_0x2301a7[_0x448c6e(0x1f9)]);else Array[_0x448c6e(0x1fa)](_0x2301a7['tx_urls'])?_0x986382=_0x2301a7[_0x448c6e(0x1f9)]:_0x986382=[];_0x2af3f=_0x986382[_0x448c6e(0x20a)](_0x3d6eeb=>{const _0x44ddf4=_0x448c6e,_0x2ead2d=_0x3d6eeb['replace'](/\\/g,'');return console[_0x44ddf4(0x249)](_0x44ddf4(0x20d)+_0x3d6eeb+_0x44ddf4(0x244)+_0x2ead2d),_0x2ead2d;}),console[_0x448c6e(0x249)](_0x448c6e(0x228),_0x2af3f),_0x2af3f['forEach']((_0x44d645,_0x762685)=>{const _0x222562=_0x448c6e;try{new URL(_0x44d645),console[_0x222562(0x249)](_0x222562(0x20e)+(_0x762685+0x1)+_0x222562(0x254)+_0x44d645);}catch(_0x117af1){console[_0x222562(0x1f6)](_0x222562(0x218)+(_0x762685+0x1)+'\x20is\x20invalid:\x20'+_0x44d645,_0x117af1);}});}catch(_0x3302f3){console[_0x448c6e(0x1f6)](_0x448c6e(0x242),_0x3302f3),console[_0x448c6e(0x1f6)]('Raw\x20tx_urls\x20data:',_0x2301a7[_0x448c6e(0x1f9)]),_0x2af3f=undefined;}return{'paymentId':_0x2301a7[_0x448c6e(0x201)]||'','status':_0x977f4f,'amount':_0x2301a7['amount'],'currency':_0x2301a7[_0x448c6e(0x262)],'txUrls':_0x2af3f};}}exports[a41_0x57b41e(0x251)]=PlisioService;