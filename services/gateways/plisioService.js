'use strict';const a45_0x4d93aa=a45_0x2fe6;(function(_0x938d5a,_0x14406f){const _0xbc66a0=a45_0x2fe6,_0x390ca6=_0x938d5a();while(!![]){try{const _0x1f8fc6=parseInt(_0xbc66a0(0xc4))/0x1*(parseInt(_0xbc66a0(0xdd))/0x2)+parseInt(_0xbc66a0(0xb5))/0x3*(-parseInt(_0xbc66a0(0xf8))/0x4)+-parseInt(_0xbc66a0(0x100))/0x5*(parseInt(_0xbc66a0(0xb7))/0x6)+parseInt(_0xbc66a0(0xb4))/0x7*(parseInt(_0xbc66a0(0xa7))/0x8)+-parseInt(_0xbc66a0(0xdb))/0x9*(-parseInt(_0xbc66a0(0xa8))/0xa)+-parseInt(_0xbc66a0(0xf6))/0xb*(parseInt(_0xbc66a0(0x109))/0xc)+parseInt(_0xbc66a0(0xc7))/0xd;if(_0x1f8fc6===_0x14406f)break;else _0x390ca6['push'](_0x390ca6['shift']());}catch(_0x4a99ea){_0x390ca6['push'](_0x390ca6['shift']());}}}(a45_0x45be,0xcce39));function a45_0x45be(){const _0x2cc3fe=['Raw\x20tx_urls\x20data:','Raw\x20Response\x20Body:','Error\x20message:','HTTP\x20error!\x20status:\x20','map','source_currency','https://api.plisio.net/api/v1/invoices/new','Unknown\x20error\x20from\x20Plisio\x20API','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','text','apiKey','parse','Error\x20stack:','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','FAILED','GET','loggerService','Status:','isArray','===\x20PLISIO\x20API\x20ERROR\x20===','Plisio\x20API\x20key\x20is\x20not\x20configured','(crypto\x20for\x20payment)','50192HNTGbQ','202440CtvVdr','apiUrl','new','expired','PlisioService','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Parsed\x20Result:','Business\x20Error:\x20','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','‚ùå\x20URL\x20','env','1358UvOlUV','3ndHhPc','/operations/','7762662SsYzAi','name','append','invoice_url','__esModule','application/json','entries','Unknown\x20error','Response\x20Time:','toString','forEach','defineProperty','pending','39SFqnAj','tx_urls','stack','7549581ezXwJN','Transaction\x20ID:','verifyPayment','Processing\x20Plisio\x20webhook:','Response\x20Body:','error','PENDING','PLISIO_API_KEY','logWhiteDomainError','\x20->\x20','(fiat\x20for\x20merchant)','log','Failed\x20to\x20parse\x20JSON\x20response:','currency','URL:','success','../loggerService','txn_id','logWhiteDomainResponse','https://api.plisio.net/api/v1/operations/','630ekYtEM','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','67426TSORZN','warn','string','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','‚úÖ\x20URL\x20','Plisio\x20payment\x20verification\x20error:','stringify','PAID','toLowerCase','completed','source_amount','data','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','status',',\x20body:\x20','fromEntries','HIDDEN','statusText','EXPIRED','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Response\x20data:','cancelled','Amount:','11LrkKCi','message','6604748PhbzRB','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Plisio\x20API\x20error:\x20','Error\x20Message:','TesSoft\x20Payment\x20System/1.0','replace','Parameters:','Status\x20Text:','5pIvbTp','https://api.trapay.uk/api/webhooks/gateway/plisio','order_number','amount','Target\x20Currency:','now','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','mismatch','qr_code','8947092cTvYmY','‚úÖ\x20Processed\x20tx_urls:','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','createPayment','Error\x20details:','plisio_direct','/invoices/new','JSON\x20Parse\x20Error:\x20'];a45_0x45be=function(){return _0x2cc3fe;};return a45_0x45be();}Object[a45_0x4d93aa(0xc2)](exports,a45_0x4d93aa(0xbb),{'value':!![]}),exports[a45_0x4d93aa(0xac)]=void 0x0;function a45_0x2fe6(_0x1e81d9,_0x42c2b8){const _0x45bed8=a45_0x45be();return a45_0x2fe6=function(_0x2fe657,_0x30625d){_0x2fe657=_0x2fe657-0xa6;let _0x583f9b=_0x45bed8[_0x2fe657];return _0x583f9b;},a45_0x2fe6(_0x1e81d9,_0x42c2b8);}const loggerService_1=require(a45_0x4d93aa(0xd7));class PlisioService{constructor(){const _0x51eb33=a45_0x4d93aa;this[_0x51eb33(0xa9)]=_0x51eb33(0x117),this[_0x51eb33(0x11b)]=process[_0x51eb33(0xb3)][_0x51eb33(0xce)]||'',!this[_0x51eb33(0x11b)]?console[_0x51eb33(0xde)](_0x51eb33(0xf9)):console[_0x51eb33(0xd2)](_0x51eb33(0xf1));}async[a45_0x4d93aa(0x10c)](_0x53c398){const _0x172349=a45_0x4d93aa,{orderId:_0x18f0c5,amount:_0x3bee3b,currency:_0x205d2a,productName:_0x11fc32,description:_0x2aa747,successUrl:_0x5a62a9,failUrl:_0x2b1097,customerEmail:_0x460dca,customerName:_0x5d5e1c,isSourceCurrency:_0x50d967,sourceCurrency:_0x1bea1b}=_0x53c398;if(!this[_0x172349(0x11b)])throw new Error(_0x172349(0x125));const _0x541e56=new URLSearchParams({'api_key':this[_0x172349(0x11b)],'order_number':_0x18f0c5,'order_name':_0x11fc32,'description':_0x2aa747,'success_url':_0x5a62a9,'fail_url':_0x2b1097,'callback_url':_0x172349(0x101)});_0x1bea1b?(_0x541e56[_0x172349(0xb9)](_0x172349(0xd4),_0x1bea1b),_0x541e56['append'](_0x172349(0x116),_0x205d2a),_0x541e56[_0x172349(0xb9)](_0x172349(0xe7),_0x3bee3b[_0x172349(0xc0)]())):(_0x541e56[_0x172349(0xb9)](_0x172349(0xd4),_0x205d2a),_0x541e56[_0x172349(0xb9)](_0x172349(0x103),_0x3bee3b[_0x172349(0xc0)]()));_0x460dca&&_0x541e56[_0x172349(0xb9)]('email',_0x460dca);_0x5d5e1c&&_0x541e56['append'](_0x172349(0xb8),_0x5d5e1c);const _0x30cab8=this[_0x172349(0xa9)]+'?'+_0x541e56[_0x172349(0xc0)](),_0x1df09d=Date[_0x172349(0x105)]();try{console[_0x172349(0xd2)](_0x172349(0xb1)),console[_0x172349(0xd2)](_0x172349(0xd5),this[_0x172349(0xa9)]),console[_0x172349(0xd2)](_0x172349(0xfe),Object[_0x172349(0xed)](_0x541e56[_0x172349(0xbd)]())),console[_0x172349(0xd2)]('Full\x20URL\x20(without\x20API\x20key):',_0x30cab8[_0x172349(0xfd)](this[_0x172349(0x11b)],_0x172349(0xee))),loggerService_1[_0x172349(0x121)]['logWhiteDomainRequest'](_0x172349(0x10e),'/invoices/new',_0x172349(0x120),Object[_0x172349(0xed)](_0x541e56['entries']()));const _0x2531a5=await fetch(_0x30cab8,{'method':_0x172349(0x120),'headers':{'Accept':_0x172349(0xbc),'User-Agent':_0x172349(0xfc)}}),_0x31d8c2=Date['now']()-_0x1df09d;console[_0x172349(0xd2)](_0x172349(0xea)),console[_0x172349(0xd2)](_0x172349(0x122),_0x2531a5[_0x172349(0xeb)]),console['log'](_0x172349(0xff),_0x2531a5[_0x172349(0xef)]),console[_0x172349(0xd2)](_0x172349(0xbf),_0x31d8c2+'ms');const _0x4cc848=await _0x2531a5[_0x172349(0x11a)]();console[_0x172349(0xd2)](_0x172349(0x112),_0x4cc848);if(!_0x2531a5['ok']){console[_0x172349(0xcc)](_0x172349(0x124)),console[_0x172349(0xcc)]('HTTP\x20Status:',_0x2531a5[_0x172349(0xeb)]),console[_0x172349(0xcc)](_0x172349(0xcb),_0x4cc848),loggerService_1[_0x172349(0x121)][_0x172349(0xd9)](_0x172349(0x10e),_0x172349(0x10f),_0x2531a5['status'],_0x4cc848,_0x31d8c2),loggerService_1[_0x172349(0x121)]['logWhiteDomainError'](_0x172349(0x10e),_0x172349(0x10f),'HTTP\x20'+_0x2531a5[_0x172349(0xeb)]+':\x20'+_0x4cc848);throw new Error(_0x172349(0x114)+_0x2531a5[_0x172349(0xeb)]+_0x172349(0xec)+_0x4cc848);}let _0x23723c;try{_0x23723c=JSON[_0x172349(0x11c)](_0x4cc848);}catch(_0x415d17){console[_0x172349(0xcc)](_0x172349(0xd3),_0x415d17),loggerService_1[_0x172349(0x121)][_0x172349(0xcf)](_0x172349(0x10e),_0x172349(0x10f),_0x172349(0x110)+_0x415d17);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x4cc848);}console[_0x172349(0xd2)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x172349(0xd2)](_0x172349(0xae),JSON[_0x172349(0xe3)](_0x23723c,null,0x2)),loggerService_1[_0x172349(0x121)]['logWhiteDomainResponse']('plisio_direct',_0x172349(0x10f),_0x2531a5[_0x172349(0xeb)],_0x23723c,_0x31d8c2);if(_0x23723c[_0x172349(0xeb)]!==_0x172349(0xd6)){const _0x37ce59=_0x23723c[_0x172349(0xf7)]||_0x23723c['error']||_0x172349(0x118);console[_0x172349(0xcc)](_0x172349(0xf2)),console[_0x172349(0xcc)](_0x172349(0xfb),_0x37ce59),loggerService_1[_0x172349(0x121)][_0x172349(0xcf)](_0x172349(0x10e),_0x172349(0x10f),_0x172349(0xaf)+_0x37ce59);throw new Error('Plisio\x20API\x20error:\x20'+_0x37ce59);}if(!_0x23723c[_0x172349(0xe8)]?.[_0x172349(0xd8)]||!_0x23723c[_0x172349(0xe8)]?.['invoice_url']){console[_0x172349(0xcc)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x172349(0xcc)](_0x172349(0xb0)),console[_0x172349(0xcc)](_0x172349(0xf3),_0x23723c[_0x172349(0xe8)]),loggerService_1[_0x172349(0x121)][_0x172349(0xcf)](_0x172349(0x10e),_0x172349(0x10f),_0x172349(0xe0));throw new Error(_0x172349(0x119));}return console[_0x172349(0xd2)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x172349(0xd2)](_0x172349(0xc8),_0x23723c[_0x172349(0xe8)][_0x172349(0xd8)]),console['log']('Invoice\x20URL:',_0x23723c[_0x172349(0xe8)][_0x172349(0xba)]),console[_0x172349(0xd2)](_0x172349(0xf5),_0x3bee3b,_0x205d2a),_0x1bea1b&&(console[_0x172349(0xd2)]('Source\x20Currency:',_0x1bea1b,_0x172349(0xa6)),console[_0x172349(0xd2)](_0x172349(0x104),_0x205d2a,_0x172349(0xd1))),{'gateway_payment_id':_0x23723c[_0x172349(0xe8)][_0x172349(0xd8)],'payment_url':_0x23723c[_0x172349(0xe8)][_0x172349(0xba)],'invoice_total_sum':_0x23723c[_0x172349(0xe8)]['invoice_total_sum'],'qr_code':_0x23723c['data'][_0x172349(0x108)],'qr_url':_0x23723c[_0x172349(0xe8)]['qr_url']};}catch(_0x844656){console[_0x172349(0xcc)](_0x172349(0xdc)),console['error'](_0x172349(0x10d),_0x844656),loggerService_1[_0x172349(0x121)][_0x172349(0xcf)](_0x172349(0x10e),'/invoices/new',_0x844656);if(_0x844656 instanceof Error){console[_0x172349(0xcc)](_0x172349(0x113),_0x844656[_0x172349(0xf7)]),console[_0x172349(0xcc)](_0x172349(0x11d),_0x844656[_0x172349(0xc6)]);throw new Error(_0x172349(0xad)+_0x844656[_0x172349(0xf7)]);}throw new Error(_0x172349(0xe9));}}async[a45_0x4d93aa(0xc9)](_0x50f783){const _0x35800e=a45_0x4d93aa,_0x3ed76d=Date[_0x35800e(0x105)]();try{if(!this[_0x35800e(0x11b)])throw new Error(_0x35800e(0x125));const _0x53cb61=new URLSearchParams({'api_key':this[_0x35800e(0x11b)],'txn_id':_0x50f783}),_0x44e6c1=_0x35800e(0xda)+_0x50f783+'?'+_0x53cb61[_0x35800e(0xc0)]();loggerService_1[_0x35800e(0x121)]['logWhiteDomainRequest'](_0x35800e(0x10e),'/operations/'+_0x50f783,_0x35800e(0x120),Object[_0x35800e(0xed)](_0x53cb61[_0x35800e(0xbd)]()));const _0x1971b3=await fetch(_0x44e6c1,{'method':_0x35800e(0x120),'headers':{'Accept':_0x35800e(0xbc),'User-Agent':_0x35800e(0xfc)}}),_0x252cd6=Date[_0x35800e(0x105)]()-_0x3ed76d;if(!_0x1971b3['ok']){const _0x1e3537=await _0x1971b3[_0x35800e(0x11a)]();loggerService_1[_0x35800e(0x121)][_0x35800e(0xd9)](_0x35800e(0x10e),'/operations/'+_0x50f783,_0x1971b3[_0x35800e(0xeb)],_0x1e3537,_0x252cd6);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1971b3[_0x35800e(0xeb)]);}const _0x36f7a2=await _0x1971b3['json']();loggerService_1[_0x35800e(0x121)]['logWhiteDomainResponse'](_0x35800e(0x10e),_0x35800e(0xb6)+_0x50f783,_0x1971b3[_0x35800e(0xeb)],_0x36f7a2,_0x252cd6);if(_0x36f7a2[_0x35800e(0xeb)]!==_0x35800e(0xd6)){loggerService_1[_0x35800e(0x121)]['logWhiteDomainError'](_0x35800e(0x10e),_0x35800e(0xb6)+_0x50f783,_0x35800e(0xfa)+(_0x36f7a2[_0x35800e(0xf7)]||_0x36f7a2[_0x35800e(0xcc)]||_0x35800e(0xbe)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x36f7a2['message']||_0x36f7a2[_0x35800e(0xcc)]||_0x35800e(0xbe)));}let _0x44b6c2='PENDING';return{'status':_0x44b6c2};}catch(_0x354ffa){console['error'](_0x35800e(0xe2),_0x354ffa),loggerService_1['loggerService'][_0x35800e(0xcf)]('plisio_direct','/operations/'+_0x50f783,_0x354ffa);throw new Error(_0x35800e(0x11e)+(_0x354ffa instanceof Error?_0x354ffa[_0x35800e(0xf7)]:_0x35800e(0xbe)));}}async['processWebhook'](_0x2eecf7){const _0x5ba494=a45_0x4d93aa;console[_0x5ba494(0xd2)](_0x5ba494(0xca),_0x2eecf7);let _0x5d330b='PENDING';switch(_0x2eecf7[_0x5ba494(0xeb)]?.[_0x5ba494(0xe5)]()){case _0x5ba494(0xe6):case _0x5ba494(0x107):_0x5d330b=_0x5ba494(0xe4);break;case _0x5ba494(0xab):_0x5d330b=_0x5ba494(0xf0);break;case _0x5ba494(0xcc):case _0x5ba494(0xf4):_0x5d330b=_0x5ba494(0x11f);break;case _0x5ba494(0xaa):_0x5d330b=_0x5ba494(0xcd);break;case _0x5ba494(0xc3):_0x5d330b='PROCESSING';break;default:_0x5d330b=_0x5ba494(0xcd);break;}let _0x47da15;if(_0x2eecf7[_0x5ba494(0xc5)])try{console['log'](_0x5ba494(0x106),_0x2eecf7[_0x5ba494(0xc5)]);let _0x267235;if(typeof _0x2eecf7[_0x5ba494(0xc5)]===_0x5ba494(0xdf))_0x267235=JSON['parse'](_0x2eecf7[_0x5ba494(0xc5)]);else Array[_0x5ba494(0x123)](_0x2eecf7['tx_urls'])?_0x267235=_0x2eecf7[_0x5ba494(0xc5)]:_0x267235=[];_0x47da15=_0x267235[_0x5ba494(0x115)](_0x1dbcaa=>{const _0x893f62=_0x5ba494,_0x55ccf1=_0x1dbcaa[_0x893f62(0xfd)](/\\/g,'');return console[_0x893f62(0xd2)]('üîó\x20Formatted\x20URL:\x20'+_0x1dbcaa+_0x893f62(0xd0)+_0x55ccf1),_0x55ccf1;}),console['log'](_0x5ba494(0x10a),_0x47da15),_0x47da15[_0x5ba494(0xc1)]((_0x3bd08d,_0x450575)=>{const _0xfa67a0=_0x5ba494;try{new URL(_0x3bd08d),console['log'](_0xfa67a0(0xe1)+(_0x450575+0x1)+'\x20is\x20valid:\x20'+_0x3bd08d);}catch(_0x11f657){console[_0xfa67a0(0xcc)](_0xfa67a0(0xb2)+(_0x450575+0x1)+'\x20is\x20invalid:\x20'+_0x3bd08d,_0x11f657);}});}catch(_0x325cb8){console['error'](_0x5ba494(0x10b),_0x325cb8),console[_0x5ba494(0xcc)](_0x5ba494(0x111),_0x2eecf7[_0x5ba494(0xc5)]),_0x47da15=undefined;}return{'paymentId':_0x2eecf7[_0x5ba494(0x102)]||'','status':_0x5d330b,'amount':_0x2eecf7['amount'],'currency':_0x2eecf7['currency'],'txUrls':_0x47da15};}}exports['PlisioService']=PlisioService;