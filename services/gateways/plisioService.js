'use strict';const a44_0x5701c9=a44_0x2242;function a44_0x2242(_0x29b83c,_0x5eb8f9){const _0x3a8256=a44_0x3a82();return a44_0x2242=function(_0x224219,_0x44e7ef){_0x224219=_0x224219-0x8f;let _0x661642=_0x3a8256[_0x224219];return _0x661642;},a44_0x2242(_0x29b83c,_0x5eb8f9);}(function(_0x1e7906,_0x3c75d4){const _0x155e6a=a44_0x2242,_0x5dab82=_0x1e7906();while(!![]){try{const _0x2f0d41=-parseInt(_0x155e6a(0x97))/0x1*(parseInt(_0x155e6a(0xfe))/0x2)+parseInt(_0x155e6a(0x9a))/0x3*(parseInt(_0x155e6a(0xce))/0x4)+parseInt(_0x155e6a(0xe9))/0x5*(parseInt(_0x155e6a(0x95))/0x6)+-parseInt(_0x155e6a(0xc3))/0x7+parseInt(_0x155e6a(0xc7))/0x8+parseInt(_0x155e6a(0xd3))/0x9*(-parseInt(_0x155e6a(0x9c))/0xa)+-parseInt(_0x155e6a(0xda))/0xb;if(_0x2f0d41===_0x3c75d4)break;else _0x5dab82['push'](_0x5dab82['shift']());}catch(_0x1941c3){_0x5dab82['push'](_0x5dab82['shift']());}}}(a44_0x3a82,0xba7ad));Object[a44_0x5701c9(0xaf)](exports,a44_0x5701c9(0xe1),{'value':!![]}),exports[a44_0x5701c9(0xff)]=void 0x0;const loggerService_1=require(a44_0x5701c9(0xdd));class PlisioService{constructor(){const _0x2a34ee=a44_0x5701c9;this[_0x2a34ee(0xa9)]=_0x2a34ee(0xcd),this[_0x2a34ee(0xc4)]=process[_0x2a34ee(0xac)][_0x2a34ee(0xaa)]||'',!this[_0x2a34ee(0xc4)]?console[_0x2a34ee(0xb3)](_0x2a34ee(0xb4)):console[_0x2a34ee(0x100)](_0x2a34ee(0xd0));}async['createPayment'](_0x3793a0){const _0x3ad686=a44_0x5701c9,{orderId:_0x2d5cfd,amount:_0x3c45f9,currency:_0x2bf35e,productName:_0x36f6c6,description:_0x146434,successUrl:_0x36b9a7,failUrl:_0x163c1b,customerEmail:_0x24d4e6,customerName:_0x11f6a7,isSourceCurrency:_0x2e24db,sourceCurrency:_0x46beee}=_0x3793a0;if(!this['apiKey'])throw new Error(_0x3ad686(0xcc));const _0x567b0c=new URLSearchParams({'api_key':this[_0x3ad686(0xc4)],'order_number':_0x2d5cfd,'order_name':_0x36f6c6,'description':_0x146434,'success_url':_0x36b9a7,'fail_url':_0x163c1b,'callback_url':_0x3ad686(0x9f)});_0x46beee?(_0x567b0c[_0x3ad686(0xf4)](_0x3ad686(0xd7),_0x46beee),_0x567b0c[_0x3ad686(0xf4)]('source_currency',_0x2bf35e),_0x567b0c[_0x3ad686(0xf4)]('source_amount',_0x3c45f9[_0x3ad686(0xb9)]())):(_0x567b0c['append'](_0x3ad686(0xd7),_0x2bf35e),_0x567b0c[_0x3ad686(0xf4)](_0x3ad686(0xfc),_0x3c45f9[_0x3ad686(0xb9)]()));_0x24d4e6&&_0x567b0c[_0x3ad686(0xf4)]('email',_0x24d4e6);_0x11f6a7&&_0x567b0c[_0x3ad686(0xf4)](_0x3ad686(0xfd),_0x11f6a7);const _0x2f6f25=this[_0x3ad686(0xa9)]+'?'+_0x567b0c[_0x3ad686(0xb9)](),_0x2507a2=Date[_0x3ad686(0xc5)]();try{console['log'](_0x3ad686(0xd4)),console['log']('URL:',this[_0x3ad686(0xa9)]),console[_0x3ad686(0x100)]('Parameters:',Object['fromEntries'](_0x567b0c[_0x3ad686(0xdc)]())),console[_0x3ad686(0x100)](_0x3ad686(0x104),_0x2f6f25[_0x3ad686(0x105)](this[_0x3ad686(0xc4)],_0x3ad686(0xd6))),loggerService_1['loggerService'][_0x3ad686(0xfa)](_0x3ad686(0xb0),_0x3ad686(0x9d),_0x3ad686(0x94),Object[_0x3ad686(0xa1)](_0x567b0c[_0x3ad686(0xdc)]()));const _0x26a989=await fetch(_0x2f6f25,{'method':'GET','headers':{'Accept':'application/json','User-Agent':_0x3ad686(0xb6)}}),_0x48f0a8=Date['now']()-_0x2507a2;console[_0x3ad686(0x100)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x3ad686(0x100)](_0x3ad686(0xdf),_0x26a989[_0x3ad686(0x103)]),console[_0x3ad686(0x100)](_0x3ad686(0xbe),_0x26a989['statusText']),console[_0x3ad686(0x100)](_0x3ad686(0x99),_0x48f0a8+'ms');const _0x3e32f7=await _0x26a989[_0x3ad686(0x9e)]();console['log'](_0x3ad686(0xa3),_0x3e32f7);if(!_0x26a989['ok']){console[_0x3ad686(0x106)](_0x3ad686(0x91)),console[_0x3ad686(0x106)](_0x3ad686(0xb8),_0x26a989[_0x3ad686(0x103)]),console[_0x3ad686(0x106)](_0x3ad686(0xea),_0x3e32f7),loggerService_1[_0x3ad686(0xc2)][_0x3ad686(0xb2)]('plisio_direct','/invoices/new',_0x26a989[_0x3ad686(0x103)],_0x3e32f7,_0x48f0a8),loggerService_1[_0x3ad686(0xc2)][_0x3ad686(0xf9)](_0x3ad686(0xb0),_0x3ad686(0x9d),_0x3ad686(0xf8)+_0x26a989['status']+':\x20'+_0x3e32f7);throw new Error(_0x3ad686(0x9b)+_0x26a989[_0x3ad686(0x103)]+_0x3ad686(0xa6)+_0x3e32f7);}let _0xa0c802;try{_0xa0c802=JSON[_0x3ad686(0xb7)](_0x3e32f7);}catch(_0x22f124){console[_0x3ad686(0x106)](_0x3ad686(0xe2),_0x22f124),loggerService_1[_0x3ad686(0xc2)][_0x3ad686(0xf9)](_0x3ad686(0xb0),'/invoices/new',_0x3ad686(0xf2)+_0x22f124);throw new Error(_0x3ad686(0xd8)+_0x3e32f7);}console[_0x3ad686(0x100)](_0x3ad686(0xca)),console[_0x3ad686(0x100)](_0x3ad686(0xef),JSON[_0x3ad686(0xa0)](_0xa0c802,null,0x2)),loggerService_1[_0x3ad686(0xc2)]['logWhiteDomainResponse'](_0x3ad686(0xb0),_0x3ad686(0x9d),_0x26a989[_0x3ad686(0x103)],_0xa0c802,_0x48f0a8);if(_0xa0c802[_0x3ad686(0x103)]!=='success'){const _0x6af419=_0xa0c802[_0x3ad686(0xd9)]||_0xa0c802['error']||_0x3ad686(0xd1);console[_0x3ad686(0x106)](_0x3ad686(0xf7)),console[_0x3ad686(0x106)](_0x3ad686(0xbd),_0x6af419),loggerService_1[_0x3ad686(0xc2)][_0x3ad686(0xf9)](_0x3ad686(0xb0),_0x3ad686(0x9d),'Business\x20Error:\x20'+_0x6af419);throw new Error(_0x3ad686(0xde)+_0x6af419);}if(!_0xa0c802['data']?.[_0x3ad686(0xe8)]||!_0xa0c802[_0x3ad686(0xa8)]?.['invoice_url']){console[_0x3ad686(0x106)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3ad686(0x106)](_0x3ad686(0xf3)),console[_0x3ad686(0x106)]('Response\x20data:',_0xa0c802[_0x3ad686(0xa8)]),loggerService_1[_0x3ad686(0xc2)][_0x3ad686(0xf9)](_0x3ad686(0xb0),_0x3ad686(0x9d),_0x3ad686(0x102));throw new Error(_0x3ad686(0x107));}return console[_0x3ad686(0x100)](_0x3ad686(0xbb)),console[_0x3ad686(0x100)](_0x3ad686(0x92),_0xa0c802[_0x3ad686(0xa8)][_0x3ad686(0xe8)]),console[_0x3ad686(0x100)](_0x3ad686(0x96),_0xa0c802[_0x3ad686(0xa8)][_0x3ad686(0xe5)]),console[_0x3ad686(0x100)](_0x3ad686(0xe4),_0x3c45f9,_0x2bf35e),_0x46beee&&(console['log'](_0x3ad686(0xeb),_0x46beee,_0x3ad686(0xae)),console['log']('Target\x20Currency:',_0x2bf35e,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0xa0c802['data'][_0x3ad686(0xe8)],'payment_url':_0xa0c802[_0x3ad686(0xa8)]['invoice_url'],'invoice_total_sum':_0xa0c802[_0x3ad686(0xa8)]['invoice_total_sum'],'qr_code':_0xa0c802[_0x3ad686(0xa8)][_0x3ad686(0xcf)],'qr_url':_0xa0c802[_0x3ad686(0xa8)]['qr_url']};}catch(_0x34491a){console[_0x3ad686(0x106)](_0x3ad686(0xec)),console[_0x3ad686(0x106)]('Error\x20details:',_0x34491a),loggerService_1[_0x3ad686(0xc2)][_0x3ad686(0xf9)](_0x3ad686(0xb0),_0x3ad686(0x9d),_0x34491a);if(_0x34491a instanceof Error){console[_0x3ad686(0x106)](_0x3ad686(0xd2),_0x34491a[_0x3ad686(0xd9)]),console[_0x3ad686(0x106)]('Error\x20stack:',_0x34491a[_0x3ad686(0xa5)]);throw new Error(_0x3ad686(0xa4)+_0x34491a[_0x3ad686(0xd9)]);}throw new Error(_0x3ad686(0xe6));}}async[a44_0x5701c9(0xbc)](_0x4b3cab){const _0x23e5ee=a44_0x5701c9,_0x111e31=Date['now']();try{if(!this[_0x23e5ee(0xc4)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x4ac5bc=new URLSearchParams({'api_key':this[_0x23e5ee(0xc4)],'txn_id':_0x4b3cab}),_0x49e098=_0x23e5ee(0xb5)+_0x4b3cab+'?'+_0x4ac5bc[_0x23e5ee(0xb9)]();loggerService_1[_0x23e5ee(0xc2)][_0x23e5ee(0xfa)](_0x23e5ee(0xb0),_0x23e5ee(0xee)+_0x4b3cab,_0x23e5ee(0x94),Object[_0x23e5ee(0xa1)](_0x4ac5bc[_0x23e5ee(0xdc)]()));const _0x49eea0=await fetch(_0x49e098,{'method':'GET','headers':{'Accept':_0x23e5ee(0x90),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x140d19=Date[_0x23e5ee(0xc5)]()-_0x111e31;if(!_0x49eea0['ok']){const _0x294604=await _0x49eea0[_0x23e5ee(0x9e)]();loggerService_1[_0x23e5ee(0xc2)][_0x23e5ee(0xb2)]('plisio_direct','/operations/'+_0x4b3cab,_0x49eea0['status'],_0x294604,_0x140d19);throw new Error(_0x23e5ee(0x9b)+_0x49eea0[_0x23e5ee(0x103)]);}const _0x44d7c1=await _0x49eea0[_0x23e5ee(0xc1)]();loggerService_1[_0x23e5ee(0xc2)][_0x23e5ee(0xb2)](_0x23e5ee(0xb0),'/operations/'+_0x4b3cab,_0x49eea0[_0x23e5ee(0x103)],_0x44d7c1,_0x140d19);if(_0x44d7c1[_0x23e5ee(0x103)]!==_0x23e5ee(0xbf)){loggerService_1[_0x23e5ee(0xc2)][_0x23e5ee(0xf9)](_0x23e5ee(0xb0),_0x23e5ee(0xee)+_0x4b3cab,'Plisio\x20API\x20error:\x20'+(_0x44d7c1[_0x23e5ee(0xd9)]||_0x44d7c1[_0x23e5ee(0x106)]||_0x23e5ee(0xf6)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x44d7c1[_0x23e5ee(0xd9)]||_0x44d7c1['error']||_0x23e5ee(0xf6)));}let _0x1599fd='PENDING';return{'status':_0x1599fd};}catch(_0x5952f7){console[_0x23e5ee(0x106)](_0x23e5ee(0xc0),_0x5952f7),loggerService_1[_0x23e5ee(0xc2)]['logWhiteDomainError'](_0x23e5ee(0xb0),'/operations/'+_0x4b3cab,_0x5952f7);throw new Error(_0x23e5ee(0xdb)+(_0x5952f7 instanceof Error?_0x5952f7[_0x23e5ee(0xd9)]:'Unknown\x20error'));}}async[a44_0x5701c9(0xf1)](_0x56b8af){const _0x238233=a44_0x5701c9;console[_0x238233(0x100)](_0x238233(0xd5),_0x56b8af);let _0x23f2d1=_0x238233(0xa7);switch(_0x56b8af[_0x238233(0x103)]?.[_0x238233(0x93)]()){case _0x238233(0xad):case _0x238233(0xe3):_0x23f2d1='PAID';break;case _0x238233(0xb1):_0x23f2d1=_0x238233(0xe7);break;case _0x238233(0x106):case'cancelled':_0x23f2d1=_0x238233(0xcb);break;case'new':_0x23f2d1=_0x238233(0xa7);break;case _0x238233(0xf5):_0x23f2d1=_0x238233(0xab);break;default:_0x23f2d1=_0x238233(0xa7);break;}let _0x437750;if(_0x56b8af['tx_urls'])try{console[_0x238233(0x100)]('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x56b8af[_0x238233(0xe0)]);let _0x432bd9;if(typeof _0x56b8af[_0x238233(0xe0)]==='string')_0x432bd9=JSON[_0x238233(0xb7)](_0x56b8af[_0x238233(0xe0)]);else Array[_0x238233(0x8f)](_0x56b8af[_0x238233(0xe0)])?_0x432bd9=_0x56b8af[_0x238233(0xe0)]:_0x432bd9=[];_0x437750=_0x432bd9[_0x238233(0xfb)](_0x22bddb=>{const _0x3f0c90=_0x238233,_0xb85253=_0x22bddb[_0x3f0c90(0x105)](/\\/g,'');return console[_0x3f0c90(0x100)](_0x3f0c90(0xf0)+_0x22bddb+_0x3f0c90(0x101)+_0xb85253),_0xb85253;}),console[_0x238233(0x100)](_0x238233(0xc8),_0x437750),_0x437750[_0x238233(0xc9)]((_0x357ae4,_0x4ac08c)=>{const _0x43071b=_0x238233;try{new URL(_0x357ae4),console['log'](_0x43071b(0xba)+(_0x4ac08c+0x1)+_0x43071b(0xc6)+_0x357ae4);}catch(_0x24b0d1){console[_0x43071b(0x106)]('‚ùå\x20URL\x20'+(_0x4ac08c+0x1)+'\x20is\x20invalid:\x20'+_0x357ae4,_0x24b0d1);}});}catch(_0x4d92b3){console[_0x238233(0x106)](_0x238233(0xa2),_0x4d92b3),console[_0x238233(0x106)](_0x238233(0x98),_0x56b8af[_0x238233(0xe0)]),_0x437750=undefined;}return{'paymentId':_0x56b8af[_0x238233(0xed)]||'','status':_0x23f2d1,'amount':_0x56b8af[_0x238233(0xfc)],'currency':_0x56b8af[_0x238233(0xd7)],'txUrls':_0x437750};}}function a44_0x3a82(){const _0x4df9b4=['json','loggerService','6061720HvBZkc','apiKey','now','\x20is\x20valid:\x20','1482640ABuzmM','‚úÖ\x20Processed\x20tx_urls:','forEach','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','FAILED','Plisio\x20API\x20key\x20is\x20not\x20configured','https://api.plisio.net/api/v1/invoices/new','5098492DIJThQ','qr_code','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Unknown\x20error\x20from\x20Plisio\x20API','Error\x20message:','18cSZLwQ','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Processing\x20Plisio\x20webhook:','HIDDEN','currency','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','message','3379772IDJpsM','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','entries','../loggerService','Plisio\x20API\x20error:\x20','Status:','tx_urls','__esModule','Failed\x20to\x20parse\x20JSON\x20response:','mismatch','Amount:','invoice_url','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','EXPIRED','txn_id','105oLTtvX','Response\x20Body:','Source\x20Currency:','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','order_number','/operations/','Parsed\x20Result:','üîó\x20Formatted\x20URL:\x20','processWebhook','JSON\x20Parse\x20Error:\x20','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','append','pending','Unknown\x20error','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20','logWhiteDomainError','logWhiteDomainRequest','map','amount','name','18076VwUQTZ','PlisioService','log','\x20->\x20','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','status','Full\x20URL\x20(without\x20API\x20key):','replace','error','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','isArray','application/json','===\x20PLISIO\x20API\x20ERROR\x20===','Transaction\x20ID:','toLowerCase','GET','292872HztefS','Invoice\x20URL:','45SAdeFZ','Raw\x20tx_urls\x20data:','Response\x20Time:','3rNpQQJ','HTTP\x20error!\x20status:\x20','706310sMdNHI','/invoices/new','text','https://api.trapay.uk/api/webhooks/gateway/plisio','stringify','fromEntries','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','Raw\x20Response\x20Body:','Failed\x20to\x20create\x20Plisio\x20payment:\x20','stack',',\x20body:\x20','PENDING','data','apiUrl','PLISIO_API_KEY','PROCESSING','env','completed','(crypto\x20for\x20payment)','defineProperty','plisio_direct','expired','logWhiteDomainResponse','warn','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','https://api.plisio.net/api/v1/operations/','TesSoft\x20Payment\x20System/1.0','parse','HTTP\x20Status:','toString','‚úÖ\x20URL\x20','===\x20PLISIO\x20SUCCESS\x20===','verifyPayment','Error\x20Message:','Status\x20Text:','success','Plisio\x20payment\x20verification\x20error:'];a44_0x3a82=function(){return _0x4df9b4;};return a44_0x3a82();}exports[a44_0x5701c9(0xff)]=PlisioService;