'use strict';function a41_0x2dd6(_0x40bff9,_0x227b47){const _0x244ef5=a41_0x244e();return a41_0x2dd6=function(_0x2dd608,_0x5037f4){_0x2dd608=_0x2dd608-0x1bc;let _0x9be327=_0x244ef5[_0x2dd608];return _0x9be327;},a41_0x2dd6(_0x40bff9,_0x227b47);}const a41_0x2b601b=a41_0x2dd6;(function(_0x54ed72,_0x4d0d6c){const _0x2bd4bb=a41_0x2dd6,_0x22fcff=_0x54ed72();while(!![]){try{const _0x1a5e32=parseInt(_0x2bd4bb(0x1f9))/0x1+-parseInt(_0x2bd4bb(0x1eb))/0x2+-parseInt(_0x2bd4bb(0x1da))/0x3*(-parseInt(_0x2bd4bb(0x1e0))/0x4)+-parseInt(_0x2bd4bb(0x1dc))/0x5*(parseInt(_0x2bd4bb(0x21f))/0x6)+-parseInt(_0x2bd4bb(0x1bd))/0x7*(parseInt(_0x2bd4bb(0x1bc))/0x8)+parseInt(_0x2bd4bb(0x1f6))/0x9*(parseInt(_0x2bd4bb(0x209))/0xa)+-parseInt(_0x2bd4bb(0x1e6))/0xb*(-parseInt(_0x2bd4bb(0x1db))/0xc);if(_0x1a5e32===_0x4d0d6c)break;else _0x22fcff['push'](_0x22fcff['shift']());}catch(_0x3d2dfe){_0x22fcff['push'](_0x22fcff['shift']());}}}(a41_0x244e,0xcf8b5));Object[a41_0x2b601b(0x20f)](exports,a41_0x2b601b(0x1c4),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a41_0x2b601b(0x1c3));function a41_0x244e(){const _0x21983c=['Unknown\x20error\x20from\x20Plisio\x20API','log','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','../loggerService','__esModule','amount','PENDING','PAID','Status:','Status\x20Text:','Response\x20Time:','Full\x20URL\x20(without\x20API\x20key):','Plisio\x20API\x20error:\x20','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','qr_url','cancelled','source_amount','order_number','EXPIRED','GET','toString','status','Amount:','Business\x20Error:\x20','fromEntries','entries','117vqOISr','376284EGwvTM','85cplbzO','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','invoice_url','stringify','64196PwNDFc','apiKey','TesSoft\x20Payment\x20System/1.0','createPayment','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Invoice\x20URL:','1067Vprbcy','(crypto\x20for\x20payment)','statusText','message','Error\x20stack:','2083672zuYmrQ','Plisio\x20payment\x20verification\x20error:','Error\x20Message:','HTTP\x20error!\x20status:\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','env','FAILED','source_currency','data','Parsed\x20Result:','error','8809128cMZhRZ','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Response\x20Body:','232011DCuXkI','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','mismatch','name','processWebhook','Parameters:','HIDDEN','expired','Target\x20Currency:','Failed\x20to\x20parse\x20JSON\x20response:','===\x20PLISIO\x20SUCCESS\x20===','URL:','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','apiUrl','https://api.plisio.net/api/v1/operations/','/operations/','10POJmIk','text','now','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainResponse','defineProperty','replace','/invoices/new','Transaction\x20ID:','txn_id','qr_code','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Source\x20Currency:','loggerService','PLISIO_API_KEY','logWhiteDomainError','https://api.trapay.uk/api/webhooks/gateway/plisio','email','Unknown\x20error','Raw\x20Response\x20Body:','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','593286fjgQDb','(fiat\x20for\x20merchant)','PlisioService','plisio_direct','verifyPayment','currency','warn','append','HTTP\x20','Processing\x20Plisio\x20webhook:','application/json','stack','Error\x20message:','completed','HTTP\x20Status:','3481144rSrvtp','21ZaiFQY','new','pending'];a41_0x244e=function(){return _0x21983c;};return a41_0x244e();}class PlisioService{constructor(){const _0xd90db7=a41_0x2b601b;this[_0xd90db7(0x206)]='https://api.plisio.net/api/v1/invoices/new',this[_0xd90db7(0x1e1)]=process[_0xd90db7(0x1f0)][_0xd90db7(0x218)]||'',!this[_0xd90db7(0x1e1)]?console[_0xd90db7(0x225)](_0xd90db7(0x1fa)):console['log']('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a41_0x2b601b(0x1e3)](_0xceeaa8){const _0x231b73=a41_0x2b601b,{orderId:_0x280ad3,amount:_0x12124e,currency:_0xe982ce,productName:_0x26e1e4,description:_0x3d5d53,successUrl:_0x45b00b,failUrl:_0x578591,customerEmail:_0x2e0e65,customerName:_0x64b615,isSourceCurrency:_0x1ac3bc,sourceCurrency:_0x11ba18}=_0xceeaa8;if(!this[_0x231b73(0x1e1)])throw new Error(_0x231b73(0x1ef));const _0x1da1e8=new URLSearchParams({'api_key':this[_0x231b73(0x1e1)],'order_number':_0x280ad3,'order_name':_0x26e1e4,'description':_0x3d5d53,'success_url':_0x45b00b,'fail_url':_0x578591,'callback_url':_0x231b73(0x21a)});_0x11ba18?(_0x1da1e8['append'](_0x231b73(0x224),_0x11ba18),_0x1da1e8[_0x231b73(0x226)](_0x231b73(0x1f2),_0xe982ce),_0x1da1e8[_0x231b73(0x226)](_0x231b73(0x1d0),_0x12124e[_0x231b73(0x1d4)]())):(_0x1da1e8[_0x231b73(0x226)]('currency',_0xe982ce),_0x1da1e8[_0x231b73(0x226)]('amount',_0x12124e[_0x231b73(0x1d4)]()));_0x2e0e65&&_0x1da1e8[_0x231b73(0x226)](_0x231b73(0x21b),_0x2e0e65);_0x64b615&&_0x1da1e8['append'](_0x231b73(0x1fc),_0x64b615);const _0x5c1fc7=this[_0x231b73(0x206)]+'?'+_0x1da1e8[_0x231b73(0x1d4)](),_0x441a8a=Date[_0x231b73(0x20b)]();try{console[_0x231b73(0x1c1)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x231b73(0x1c1)](_0x231b73(0x204),this[_0x231b73(0x206)]),console[_0x231b73(0x1c1)](_0x231b73(0x1fe),Object[_0x231b73(0x1d8)](_0x1da1e8['entries']())),console[_0x231b73(0x1c1)](_0x231b73(0x1cb),_0x5c1fc7[_0x231b73(0x210)](this['apiKey'],_0x231b73(0x1ff))),loggerService_1[_0x231b73(0x217)]['logWhiteDomainRequest'](_0x231b73(0x222),_0x231b73(0x211),_0x231b73(0x1d3),Object[_0x231b73(0x1d8)](_0x1da1e8[_0x231b73(0x1d9)]()));const _0x274105=await fetch(_0x5c1fc7,{'method':_0x231b73(0x1d3),'headers':{'Accept':'application/json','User-Agent':_0x231b73(0x1e2)}}),_0x2eeb43=Date[_0x231b73(0x20b)]()-_0x441a8a;console['log'](_0x231b73(0x20c)),console[_0x231b73(0x1c1)](_0x231b73(0x1c8),_0x274105[_0x231b73(0x1d5)]),console[_0x231b73(0x1c1)](_0x231b73(0x1c9),_0x274105[_0x231b73(0x1e8)]),console[_0x231b73(0x1c1)](_0x231b73(0x1ca),_0x2eeb43+'ms');const _0x4bf4b5=await _0x274105[_0x231b73(0x20a)]();console[_0x231b73(0x1c1)](_0x231b73(0x21d),_0x4bf4b5);if(!_0x274105['ok']){console[_0x231b73(0x1f5)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x231b73(0x1f5)](_0x231b73(0x22d),_0x274105['status']),console['error'](_0x231b73(0x1f8),_0x4bf4b5),loggerService_1[_0x231b73(0x217)][_0x231b73(0x20e)]('plisio_direct',_0x231b73(0x211),_0x274105['status'],_0x4bf4b5,_0x2eeb43),loggerService_1[_0x231b73(0x217)][_0x231b73(0x219)](_0x231b73(0x222),_0x231b73(0x211),_0x231b73(0x227)+_0x274105[_0x231b73(0x1d5)]+':\x20'+_0x4bf4b5);throw new Error('HTTP\x20error!\x20status:\x20'+_0x274105['status']+',\x20body:\x20'+_0x4bf4b5);}let _0x38b49a;try{_0x38b49a=JSON['parse'](_0x4bf4b5);}catch(_0x18fda3){console[_0x231b73(0x1f5)](_0x231b73(0x202),_0x18fda3),loggerService_1[_0x231b73(0x217)][_0x231b73(0x219)](_0x231b73(0x222),'/invoices/new','JSON\x20Parse\x20Error:\x20'+_0x18fda3);throw new Error(_0x231b73(0x1dd)+_0x4bf4b5);}console[_0x231b73(0x1c1)](_0x231b73(0x205)),console[_0x231b73(0x1c1)](_0x231b73(0x1f4),JSON[_0x231b73(0x1df)](_0x38b49a,null,0x2)),loggerService_1[_0x231b73(0x217)][_0x231b73(0x20e)](_0x231b73(0x222),_0x231b73(0x211),_0x274105[_0x231b73(0x1d5)],_0x38b49a,_0x2eeb43);if(_0x38b49a[_0x231b73(0x1d5)]!=='success'){const _0x2de67c=_0x38b49a[_0x231b73(0x1e9)]||_0x38b49a[_0x231b73(0x1f5)]||_0x231b73(0x1c0);console[_0x231b73(0x1f5)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x231b73(0x1ed),_0x2de67c),loggerService_1[_0x231b73(0x217)][_0x231b73(0x219)]('plisio_direct',_0x231b73(0x211),_0x231b73(0x1d7)+_0x2de67c);throw new Error(_0x231b73(0x1cc)+_0x2de67c);}if(!_0x38b49a[_0x231b73(0x1f3)]?.[_0x231b73(0x213)]||!_0x38b49a[_0x231b73(0x1f3)]?.[_0x231b73(0x1de)]){console[_0x231b73(0x1f5)](_0x231b73(0x20d)),console[_0x231b73(0x1f5)](_0x231b73(0x1cd)),console[_0x231b73(0x1f5)]('Response\x20data:',_0x38b49a[_0x231b73(0x1f3)]),loggerService_1[_0x231b73(0x217)][_0x231b73(0x219)](_0x231b73(0x222),'/invoices/new',_0x231b73(0x1f7));throw new Error(_0x231b73(0x1c2));}return console[_0x231b73(0x1c1)](_0x231b73(0x203)),console[_0x231b73(0x1c1)](_0x231b73(0x212),_0x38b49a['data'][_0x231b73(0x213)]),console[_0x231b73(0x1c1)](_0x231b73(0x1e5),_0x38b49a[_0x231b73(0x1f3)]['invoice_url']),console['log'](_0x231b73(0x1d6),_0x12124e,_0xe982ce),_0x11ba18&&(console['log'](_0x231b73(0x216),_0x11ba18,_0x231b73(0x1e7)),console[_0x231b73(0x1c1)](_0x231b73(0x201),_0xe982ce,_0x231b73(0x220))),{'gateway_payment_id':_0x38b49a[_0x231b73(0x1f3)][_0x231b73(0x213)],'payment_url':_0x38b49a[_0x231b73(0x1f3)]['invoice_url'],'invoice_total_sum':_0x38b49a[_0x231b73(0x1f3)]['invoice_total_sum'],'qr_code':_0x38b49a[_0x231b73(0x1f3)][_0x231b73(0x214)],'qr_url':_0x38b49a[_0x231b73(0x1f3)][_0x231b73(0x1ce)]};}catch(_0x4e342b){console[_0x231b73(0x1f5)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x231b73(0x1f5)]('Error\x20details:',_0x4e342b),loggerService_1[_0x231b73(0x217)][_0x231b73(0x219)](_0x231b73(0x222),_0x231b73(0x211),_0x4e342b);if(_0x4e342b instanceof Error){console[_0x231b73(0x1f5)](_0x231b73(0x22b),_0x4e342b[_0x231b73(0x1e9)]),console['error'](_0x231b73(0x1ea),_0x4e342b[_0x231b73(0x22a)]);throw new Error(_0x231b73(0x215)+_0x4e342b[_0x231b73(0x1e9)]);}throw new Error(_0x231b73(0x1e4));}}async[a41_0x2b601b(0x223)](_0x4d82fc){const _0x96e778=a41_0x2b601b,_0x4bd699=Date[_0x96e778(0x20b)]();try{if(!this['apiKey'])throw new Error(_0x96e778(0x1ef));const _0x243db5=new URLSearchParams({'api_key':this[_0x96e778(0x1e1)],'txn_id':_0x4d82fc}),_0x4dd698=_0x96e778(0x207)+_0x4d82fc+'?'+_0x243db5[_0x96e778(0x1d4)]();loggerService_1[_0x96e778(0x217)]['logWhiteDomainRequest']('plisio_direct','/operations/'+_0x4d82fc,_0x96e778(0x1d3),Object['fromEntries'](_0x243db5[_0x96e778(0x1d9)]()));const _0x26ce1e=await fetch(_0x4dd698,{'method':_0x96e778(0x1d3),'headers':{'Accept':_0x96e778(0x229),'User-Agent':_0x96e778(0x1e2)}}),_0xebe7c7=Date[_0x96e778(0x20b)]()-_0x4bd699;if(!_0x26ce1e['ok']){const _0xa3827=await _0x26ce1e[_0x96e778(0x20a)]();loggerService_1[_0x96e778(0x217)]['logWhiteDomainResponse'](_0x96e778(0x222),_0x96e778(0x208)+_0x4d82fc,_0x26ce1e[_0x96e778(0x1d5)],_0xa3827,_0xebe7c7);throw new Error(_0x96e778(0x1ee)+_0x26ce1e['status']);}const _0x223bb8=await _0x26ce1e['json']();loggerService_1[_0x96e778(0x217)][_0x96e778(0x20e)](_0x96e778(0x222),'/operations/'+_0x4d82fc,_0x26ce1e[_0x96e778(0x1d5)],_0x223bb8,_0xebe7c7);if(_0x223bb8[_0x96e778(0x1d5)]!=='success'){loggerService_1['loggerService'][_0x96e778(0x219)](_0x96e778(0x222),_0x96e778(0x208)+_0x4d82fc,'Plisio\x20API\x20error:\x20'+(_0x223bb8[_0x96e778(0x1e9)]||_0x223bb8[_0x96e778(0x1f5)]||'Unknown\x20error'));throw new Error(_0x96e778(0x1cc)+(_0x223bb8[_0x96e778(0x1e9)]||_0x223bb8['error']||_0x96e778(0x21c)));}let _0x9baa9a=_0x96e778(0x1c6);return{'status':_0x9baa9a};}catch(_0x18372c){console['error'](_0x96e778(0x1ec),_0x18372c),loggerService_1[_0x96e778(0x217)][_0x96e778(0x219)]('plisio_direct','/operations/'+_0x4d82fc,_0x18372c);throw new Error(_0x96e778(0x21e)+(_0x18372c instanceof Error?_0x18372c[_0x96e778(0x1e9)]:_0x96e778(0x21c)));}}async[a41_0x2b601b(0x1fd)](_0x7fec1c){const _0x9e42dd=a41_0x2b601b;console[_0x9e42dd(0x1c1)](_0x9e42dd(0x228),_0x7fec1c);let _0x1efc55='PENDING';switch(_0x7fec1c[_0x9e42dd(0x1d5)]?.['toLowerCase']()){case _0x9e42dd(0x22c):case _0x9e42dd(0x1fb):_0x1efc55=_0x9e42dd(0x1c7);break;case _0x9e42dd(0x200):_0x1efc55=_0x9e42dd(0x1d2);break;case'error':case _0x9e42dd(0x1cf):_0x1efc55=_0x9e42dd(0x1f1);break;case _0x9e42dd(0x1be):case _0x9e42dd(0x1bf):default:_0x1efc55='PENDING';break;}return{'paymentId':_0x7fec1c[_0x9e42dd(0x1d1)]||'','status':_0x1efc55,'amount':_0x7fec1c[_0x9e42dd(0x1c5)],'currency':_0x7fec1c[_0x9e42dd(0x224)]};}}exports[a41_0x2b601b(0x221)]=PlisioService;