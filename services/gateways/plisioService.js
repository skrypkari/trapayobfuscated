'use strict';const a41_0x428332=a41_0x45e5;(function(_0x30e632,_0x69f41b){const _0x2337fc=a41_0x45e5,_0x2205f5=_0x30e632();while(!![]){try{const _0x314ac1=-parseInt(_0x2337fc(0xe7))/0x1*(-parseInt(_0x2337fc(0xe2))/0x2)+-parseInt(_0x2337fc(0xc3))/0x3+parseInt(_0x2337fc(0xe9))/0x4*(parseInt(_0x2337fc(0xa7))/0x5)+parseInt(_0x2337fc(0xbc))/0x6+-parseInt(_0x2337fc(0xbb))/0x7*(-parseInt(_0x2337fc(0xc5))/0x8)+parseInt(_0x2337fc(0xb5))/0x9*(-parseInt(_0x2337fc(0xe5))/0xa)+-parseInt(_0x2337fc(0xc0))/0xb;if(_0x314ac1===_0x69f41b)break;else _0x2205f5['push'](_0x2205f5['shift']());}catch(_0x27e77e){_0x2205f5['push'](_0x2205f5['shift']());}}}(a41_0x3cb4,0x36423));function a41_0x45e5(_0x2e972b,_0x1e0f3d){const _0x3cb4ec=a41_0x3cb4();return a41_0x45e5=function(_0x45e5cc,_0x4d7d43){_0x45e5cc=_0x45e5cc-0x8a;let _0xfc6474=_0x3cb4ec[_0x45e5cc];return _0xfc6474;},a41_0x45e5(_0x2e972b,_0x1e0f3d);}Object[a41_0x428332(0x98)](exports,a41_0x428332(0xcd),{'value':!![]}),exports[a41_0x428332(0xcb)]=void 0x0;const loggerService_1=require(a41_0x428332(0xba));function a41_0x3cb4(){const _0x4eca17=['expired','fromEntries','application/json','Error\x20stack:','https://api.trapay.uk/api/webhooks/gateway/plisio','Target\x20Currency:','Transaction\x20ID:','820lQzUru','currency','createPayment','523910yIVCqk','Response\x20Time:','743zfCWkR','/operations/','5908aWTnlC','amount','Response\x20data:','error','Unknown\x20error','===\x20PLISIO\x20API\x20ERROR\x20===','Response\x20Body:','Status:','===\x20PLISIO\x20SUCCESS\x20===','plisio_direct','order_number','Raw\x20Response\x20Body:','PAID','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','source_currency','Error\x20details:','toString','apiKey','log','name','invoice_url','defineProperty','data','HTTP\x20','HTTP\x20error!\x20status:\x20','(crypto\x20for\x20payment)','Processing\x20Plisio\x20webhook:','/invoices/new','Plisio\x20API\x20key\x20is\x20not\x20configured','verifyPayment','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','logWhiteDomainError','parse','https://api.plisio.net/api/v1/invoices/new','status','445aDjrjY','replace','Error\x20message:','message','TesSoft\x20Payment\x20System/1.0','Plisio\x20API\x20error:\x20','https://api.plisio.net/api/v1/operations/','mismatch','loggerService','success','apiUrl','completed','qr_code','HTTP\x20Status:','63kCPUFB','Business\x20Error:\x20','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','entries','logWhiteDomainResponse','../loggerService','7VczfAX','2448816jTZGNX','txn_id','PENDING','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','2968636ywnCMp','Failed\x20to\x20parse\x20JSON\x20response:','processWebhook','157362mcmbEm','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','536728obDZNT','text','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','toLowerCase','logWhiteDomainRequest','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','PlisioService','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','__esModule','new','append','Error\x20Message:','URL:','source_amount','Parameters:','GET','JSON\x20Parse\x20Error:\x20','Invoice\x20URL:','email','Unknown\x20error\x20from\x20Plisio\x20API','now',',\x20body:\x20'];a41_0x3cb4=function(){return _0x4eca17;};return a41_0x3cb4();}class PlisioService{constructor(){const _0x28aab2=a41_0x428332;this[_0x28aab2(0xb1)]=_0x28aab2(0xa5),this[_0x28aab2(0x94)]=process['env']['PLISIO_API_KEY']||'',!this[_0x28aab2(0x94)]?console['warn']('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console['log'](_0x28aab2(0xbf));}async[a41_0x428332(0xe4)](_0x5c4c3d){const _0x125c0e=a41_0x428332,{orderId:_0x54c9c4,amount:_0x3f6185,currency:_0x5edc52,productName:_0x134cbb,description:_0x4e9977,successUrl:_0x7dd47b,failUrl:_0x3ac897,customerEmail:_0x5ed1c7,customerName:_0x3dfa22,isSourceCurrency:_0x5f4cca,sourceCurrency:_0x38c582}=_0x5c4c3d;if(!this['apiKey'])throw new Error(_0x125c0e(0x9f));const _0xab9a3f=new URLSearchParams({'api_key':this[_0x125c0e(0x94)],'order_number':_0x54c9c4,'order_name':_0x134cbb,'description':_0x4e9977,'success_url':_0x7dd47b,'fail_url':_0x3ac897,'callback_url':_0x125c0e(0xdf)});_0x38c582?(_0xab9a3f['append']('currency',_0x38c582),_0xab9a3f[_0x125c0e(0xcf)](_0x125c0e(0x91),_0x5edc52),_0xab9a3f[_0x125c0e(0xcf)](_0x125c0e(0xd2),_0x3f6185[_0x125c0e(0x93)]())):(_0xab9a3f[_0x125c0e(0xcf)](_0x125c0e(0xe3),_0x5edc52),_0xab9a3f[_0x125c0e(0xcf)]('amount',_0x3f6185[_0x125c0e(0x93)]()));_0x5ed1c7&&_0xab9a3f[_0x125c0e(0xcf)](_0x125c0e(0xd7),_0x5ed1c7);_0x3dfa22&&_0xab9a3f['append'](_0x125c0e(0x96),_0x3dfa22);const _0x27a1bc=this['apiUrl']+'?'+_0xab9a3f[_0x125c0e(0x93)](),_0x1cc63f=Date[_0x125c0e(0xd9)]();try{console['log']('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console['log'](_0x125c0e(0xd1),this[_0x125c0e(0xb1)]),console['log'](_0x125c0e(0xd3),Object[_0x125c0e(0xdc)](_0xab9a3f['entries']())),console['log']('Full\x20URL\x20(without\x20API\x20key):',_0x27a1bc[_0x125c0e(0xa8)](this['apiKey'],'HIDDEN')),loggerService_1['loggerService'][_0x125c0e(0xc9)]('plisio_direct',_0x125c0e(0x9e),'GET',Object[_0x125c0e(0xdc)](_0xab9a3f[_0x125c0e(0xb8)]()));const _0x17466d=await fetch(_0x27a1bc,{'method':'GET','headers':{'Accept':_0x125c0e(0xdd),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x1d8a2d=Date[_0x125c0e(0xd9)]()-_0x1cc63f;console[_0x125c0e(0x95)](_0x125c0e(0xcc)),console[_0x125c0e(0x95)](_0x125c0e(0x8a),_0x17466d[_0x125c0e(0xa6)]),console['log']('Status\x20Text:',_0x17466d['statusText']),console[_0x125c0e(0x95)](_0x125c0e(0xe6),_0x1d8a2d+'ms');const _0x2de9bf=await _0x17466d[_0x125c0e(0xc6)]();console[_0x125c0e(0x95)](_0x125c0e(0x8e),_0x2de9bf);if(!_0x17466d['ok']){console[_0x125c0e(0xec)](_0x125c0e(0xee)),console[_0x125c0e(0xec)](_0x125c0e(0xb4),_0x17466d[_0x125c0e(0xa6)]),console[_0x125c0e(0xec)](_0x125c0e(0xef),_0x2de9bf),loggerService_1[_0x125c0e(0xaf)][_0x125c0e(0xb9)]('plisio_direct',_0x125c0e(0x9e),_0x17466d['status'],_0x2de9bf,_0x1d8a2d),loggerService_1[_0x125c0e(0xaf)][_0x125c0e(0xa3)]('plisio_direct','/invoices/new',_0x125c0e(0x9a)+_0x17466d[_0x125c0e(0xa6)]+':\x20'+_0x2de9bf);throw new Error(_0x125c0e(0x9b)+_0x17466d[_0x125c0e(0xa6)]+_0x125c0e(0xda)+_0x2de9bf);}let _0x43cd24;try{_0x43cd24=JSON[_0x125c0e(0xa4)](_0x2de9bf);}catch(_0x362cc3){console[_0x125c0e(0xec)](_0x125c0e(0xc1),_0x362cc3),loggerService_1[_0x125c0e(0xaf)][_0x125c0e(0xa3)]('plisio_direct',_0x125c0e(0x9e),_0x125c0e(0xd5)+_0x362cc3);throw new Error(_0x125c0e(0xc7)+_0x2de9bf);}console['log'](_0x125c0e(0xb7)),console[_0x125c0e(0x95)]('Parsed\x20Result:',JSON['stringify'](_0x43cd24,null,0x2)),loggerService_1[_0x125c0e(0xaf)][_0x125c0e(0xb9)](_0x125c0e(0x8c),'/invoices/new',_0x17466d[_0x125c0e(0xa6)],_0x43cd24,_0x1d8a2d);if(_0x43cd24[_0x125c0e(0xa6)]!==_0x125c0e(0xb0)){const _0x764c2b=_0x43cd24[_0x125c0e(0xaa)]||_0x43cd24[_0x125c0e(0xec)]||_0x125c0e(0xd8);console[_0x125c0e(0xec)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x125c0e(0xec)](_0x125c0e(0xd0),_0x764c2b),loggerService_1[_0x125c0e(0xaf)][_0x125c0e(0xa3)]('plisio_direct',_0x125c0e(0x9e),_0x125c0e(0xb6)+_0x764c2b);throw new Error(_0x125c0e(0xac)+_0x764c2b);}if(!_0x43cd24[_0x125c0e(0x99)]?.[_0x125c0e(0xbd)]||!_0x43cd24[_0x125c0e(0x99)]?.[_0x125c0e(0x97)]){console[_0x125c0e(0xec)](_0x125c0e(0xa1)),console[_0x125c0e(0xec)](_0x125c0e(0xc4)),console[_0x125c0e(0xec)](_0x125c0e(0xeb),_0x43cd24['data']),loggerService_1[_0x125c0e(0xaf)][_0x125c0e(0xa3)](_0x125c0e(0x8c),'/invoices/new',_0x125c0e(0xa2));throw new Error(_0x125c0e(0x90));}return console[_0x125c0e(0x95)](_0x125c0e(0x8b)),console[_0x125c0e(0x95)](_0x125c0e(0xe1),_0x43cd24[_0x125c0e(0x99)][_0x125c0e(0xbd)]),console[_0x125c0e(0x95)](_0x125c0e(0xd6),_0x43cd24['data'][_0x125c0e(0x97)]),console[_0x125c0e(0x95)]('Amount:',_0x3f6185,_0x5edc52),_0x38c582&&(console['log']('Source\x20Currency:',_0x38c582,_0x125c0e(0x9c)),console[_0x125c0e(0x95)](_0x125c0e(0xe0),_0x5edc52,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x43cd24['data'][_0x125c0e(0xbd)],'payment_url':_0x43cd24[_0x125c0e(0x99)][_0x125c0e(0x97)],'invoice_total_sum':_0x43cd24['data']['invoice_total_sum'],'qr_code':_0x43cd24['data'][_0x125c0e(0xb3)],'qr_url':_0x43cd24[_0x125c0e(0x99)]['qr_url']};}catch(_0x5b87fd){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x125c0e(0xec)](_0x125c0e(0x92),_0x5b87fd),loggerService_1[_0x125c0e(0xaf)][_0x125c0e(0xa3)]('plisio_direct',_0x125c0e(0x9e),_0x5b87fd);if(_0x5b87fd instanceof Error){console[_0x125c0e(0xec)](_0x125c0e(0xa9),_0x5b87fd[_0x125c0e(0xaa)]),console[_0x125c0e(0xec)](_0x125c0e(0xde),_0x5b87fd['stack']);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x5b87fd[_0x125c0e(0xaa)]);}throw new Error(_0x125c0e(0xca));}}async[a41_0x428332(0xa0)](_0x3679f1){const _0x2851b9=a41_0x428332,_0x479de8=Date[_0x2851b9(0xd9)]();try{if(!this[_0x2851b9(0x94)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x2e31a4=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x3679f1}),_0x174ae5=_0x2851b9(0xad)+_0x3679f1+'?'+_0x2e31a4[_0x2851b9(0x93)]();loggerService_1[_0x2851b9(0xaf)][_0x2851b9(0xc9)](_0x2851b9(0x8c),_0x2851b9(0xe8)+_0x3679f1,'GET',Object[_0x2851b9(0xdc)](_0x2e31a4['entries']()));const _0x2525f1=await fetch(_0x174ae5,{'method':_0x2851b9(0xd4),'headers':{'Accept':_0x2851b9(0xdd),'User-Agent':_0x2851b9(0xab)}}),_0x342309=Date[_0x2851b9(0xd9)]()-_0x479de8;if(!_0x2525f1['ok']){const _0x33b11e=await _0x2525f1['text']();loggerService_1['loggerService'][_0x2851b9(0xb9)]('plisio_direct','/operations/'+_0x3679f1,_0x2525f1['status'],_0x33b11e,_0x342309);throw new Error(_0x2851b9(0x9b)+_0x2525f1[_0x2851b9(0xa6)]);}const _0x90f603=await _0x2525f1['json']();loggerService_1[_0x2851b9(0xaf)][_0x2851b9(0xb9)]('plisio_direct',_0x2851b9(0xe8)+_0x3679f1,_0x2525f1[_0x2851b9(0xa6)],_0x90f603,_0x342309);if(_0x90f603['status']!==_0x2851b9(0xb0)){loggerService_1['loggerService']['logWhiteDomainError'](_0x2851b9(0x8c),'/operations/'+_0x3679f1,_0x2851b9(0xac)+(_0x90f603[_0x2851b9(0xaa)]||_0x90f603[_0x2851b9(0xec)]||_0x2851b9(0xed)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x90f603[_0x2851b9(0xaa)]||_0x90f603[_0x2851b9(0xec)]||'Unknown\x20error'));}let _0x2d51eb=_0x2851b9(0xbe);return{'status':_0x2d51eb};}catch(_0x3db87a){console[_0x2851b9(0xec)]('Plisio\x20payment\x20verification\x20error:',_0x3db87a),loggerService_1[_0x2851b9(0xaf)][_0x2851b9(0xa3)](_0x2851b9(0x8c),'/operations/'+_0x3679f1,_0x3db87a);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x3db87a instanceof Error?_0x3db87a[_0x2851b9(0xaa)]:_0x2851b9(0xed)));}}async[a41_0x428332(0xc2)](_0x16b704){const _0xb2d74=a41_0x428332;console['log'](_0xb2d74(0x9d),_0x16b704);let _0x272e85=_0xb2d74(0xbe);switch(_0x16b704['status']?.[_0xb2d74(0xc8)]()){case _0xb2d74(0xb2):case _0xb2d74(0xae):_0x272e85=_0xb2d74(0x8f);break;case _0xb2d74(0xdb):_0x272e85='EXPIRED';break;case'error':case'cancelled':_0x272e85='FAILED';break;case _0xb2d74(0xce):case'pending':default:_0x272e85=_0xb2d74(0xbe);break;}return{'paymentId':_0x16b704[_0xb2d74(0x8d)]||'','status':_0x272e85,'amount':_0x16b704[_0xb2d74(0xea)],'currency':_0x16b704[_0xb2d74(0xe3)]};}}exports[a41_0x428332(0xcb)]=PlisioService;