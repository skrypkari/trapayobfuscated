'use strict';const a44_0x5c001=a44_0x1b78;(function(_0x4a3094,_0x442499){const _0x4913e2=a44_0x1b78,_0x21020c=_0x4a3094();while(!![]){try{const _0x5013b5=parseInt(_0x4913e2(0x195))/0x1*(-parseInt(_0x4913e2(0x201))/0x2)+-parseInt(_0x4913e2(0x1d6))/0x3*(-parseInt(_0x4913e2(0x1ea))/0x4)+-parseInt(_0x4913e2(0x1ae))/0x5*(parseInt(_0x4913e2(0x1a0))/0x6)+parseInt(_0x4913e2(0x1f9))/0x7+-parseInt(_0x4913e2(0x1a2))/0x8+-parseInt(_0x4913e2(0x1e4))/0x9+parseInt(_0x4913e2(0x1da))/0xa*(parseInt(_0x4913e2(0x1b0))/0xb);if(_0x5013b5===_0x442499)break;else _0x21020c['push'](_0x21020c['shift']());}catch(_0x29e18d){_0x21020c['push'](_0x21020c['shift']());}}}(a44_0x41f2,0xbe29a));Object['defineProperty'](exports,a44_0x5c001(0x1e1),{'value':!![]}),exports[a44_0x5c001(0x1fb)]=void 0x0;function a44_0x41f2(){const _0x231632=['Plisio\x20API\x20error:\x20','===\x20PLISIO\x20SUCCESS\x20===','Response\x20data:','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','isArray','replace','apiUrl','Target\x20Currency:','‚ùå\x20URL\x20','invoice_url','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','URL:','name','text','success','943941GGVEUw','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','currency','21418840yJwnrq','Response\x20Time:','fromEntries','toString','tx_urls','Response\x20Body:','Parsed\x20Result:','__esModule','apiKey','toLowerCase','1041192emkCzW','Full\x20URL\x20(without\x20API\x20key):','FAILED','Processing\x20Plisio\x20webhook:','message','append','12eumsJV','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','https://apitest.trapay.uk/api/webhooks/gateway/plisio','parse','HTTP\x20error!\x20status:\x20','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','https://api.plisio.net/api/v1/operations/','/invoices/new','application/json','order_number','Source\x20Currency:','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','source_amount','Amount:','entries','4618845LYjFQp','../loggerService','PlisioService','error','new','map','===\x20PLISIO\x20API\x20ERROR\x20===','Invoice\x20URL:','10LvIbqz','\x20is\x20invalid:\x20','now','expired','loggerService','(fiat\x20for\x20merchant)','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','‚úÖ\x20URL\x20','env','completed','cancelled','forEach','data','processWebhook','297775PvEVyp','TesSoft\x20Payment\x20System/1.0','json','invoice_total_sum','‚úÖ\x20Processed\x20tx_urls:','verifyPayment','PLISIO_API_KEY','Unknown\x20error\x20from\x20Plisio\x20API','PENDING','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Plisio\x20API\x20key\x20is\x20not\x20configured','730362YjdnYh','logWhiteDomainResponse','2133184SBcEbO','Error\x20Message:','Unknown\x20error','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Business\x20Error:\x20','qr_url','Plisio\x20payment\x20verification\x20error:',',\x20body:\x20','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Parameters:','pending','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','45hEmniG','Raw\x20Response\x20Body:','11Athoat','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','HIDDEN','Error\x20stack:','logWhiteDomainRequest','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','status','HTTP\x20','Failed\x20to\x20parse\x20JSON\x20response:','logWhiteDomainError','\x20->\x20','stringify','plisio_direct','GET','Error\x20details:','createPayment','Error\x20message:','/operations/','log','Status:','üîó\x20Formatted\x20URL:\x20','email','txn_id'];a44_0x41f2=function(){return _0x231632;};return a44_0x41f2();}const loggerService_1=require(a44_0x5c001(0x1fa));function a44_0x1b78(_0xf2af04,_0x11f863){const _0x41f281=a44_0x41f2();return a44_0x1b78=function(_0x1b7805,_0x533a83){_0x1b7805=_0x1b7805-0x189;let _0xbe195c=_0x41f281[_0x1b7805];return _0xbe195c;},a44_0x1b78(_0xf2af04,_0x11f863);}class PlisioService{constructor(){const _0x444ebc=a44_0x5c001;this['apiUrl']='https://api.plisio.net/api/v1/invoices/new',this[_0x444ebc(0x1e2)]=process[_0x444ebc(0x18f)][_0x444ebc(0x19b)]||'',!this[_0x444ebc(0x1e2)]?console['warn']('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x444ebc(0x1c2)](_0x444ebc(0x1ca));}async[a44_0x5c001(0x1bf)](_0x253fb6){const _0x5c89ce=a44_0x5c001,{orderId:_0x57ba44,amount:_0x19566e,currency:_0x39878f,productName:_0x4ba443,description:_0x9fe190,successUrl:_0x2c9daf,failUrl:_0xcbf41c,customerEmail:_0x144d16,customerName:_0x81fcff,isSourceCurrency:_0x5682ee,sourceCurrency:_0x3a028c}=_0x253fb6;if(!this[_0x5c89ce(0x1e2)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x1f0cbc=new URLSearchParams({'api_key':this[_0x5c89ce(0x1e2)],'order_number':_0x57ba44,'order_name':_0x4ba443,'description':_0x9fe190,'success_url':_0x2c9daf,'fail_url':_0xcbf41c,'callback_url':_0x5c89ce(0x1ec)});_0x3a028c?(_0x1f0cbc[_0x5c89ce(0x1e9)](_0x5c89ce(0x1d9),_0x3a028c),_0x1f0cbc[_0x5c89ce(0x1e9)]('source_currency',_0x39878f),_0x1f0cbc[_0x5c89ce(0x1e9)](_0x5c89ce(0x1f6),_0x19566e[_0x5c89ce(0x1dd)]())):(_0x1f0cbc['append']('currency',_0x39878f),_0x1f0cbc[_0x5c89ce(0x1e9)]('amount',_0x19566e[_0x5c89ce(0x1dd)]()));_0x144d16&&_0x1f0cbc[_0x5c89ce(0x1e9)](_0x5c89ce(0x1c5),_0x144d16);_0x81fcff&&_0x1f0cbc[_0x5c89ce(0x1e9)](_0x5c89ce(0x1d3),_0x81fcff);const _0x24eaff=this[_0x5c89ce(0x1cd)]+'?'+_0x1f0cbc[_0x5c89ce(0x1dd)](),_0x5c335b=Date[_0x5c89ce(0x189)]();try{console[_0x5c89ce(0x1c2)](_0x5c89ce(0x1a5)),console[_0x5c89ce(0x1c2)](_0x5c89ce(0x1d2),this[_0x5c89ce(0x1cd)]),console[_0x5c89ce(0x1c2)](_0x5c89ce(0x1ab),Object['fromEntries'](_0x1f0cbc['entries']())),console[_0x5c89ce(0x1c2)](_0x5c89ce(0x1e5),_0x24eaff[_0x5c89ce(0x1cc)](this['apiKey'],_0x5c89ce(0x1b2))),loggerService_1[_0x5c89ce(0x18b)]['logWhiteDomainRequest']('plisio_direct',_0x5c89ce(0x1f1),_0x5c89ce(0x1bd),Object['fromEntries'](_0x1f0cbc[_0x5c89ce(0x1f8)]()));const _0x21150f=await fetch(_0x24eaff,{'method':'GET','headers':{'Accept':_0x5c89ce(0x1f2),'User-Agent':_0x5c89ce(0x196)}}),_0x4fc111=Date[_0x5c89ce(0x189)]()-_0x5c335b;console[_0x5c89ce(0x1c2)](_0x5c89ce(0x19e)),console[_0x5c89ce(0x1c2)](_0x5c89ce(0x1c3),_0x21150f['status']),console['log']('Status\x20Text:',_0x21150f['statusText']),console[_0x5c89ce(0x1c2)](_0x5c89ce(0x1db),_0x4fc111+'ms');const _0x24ff68=await _0x21150f[_0x5c89ce(0x1d4)]();console[_0x5c89ce(0x1c2)](_0x5c89ce(0x1af),_0x24ff68);if(!_0x21150f['ok']){console[_0x5c89ce(0x1fc)](_0x5c89ce(0x1ff)),console[_0x5c89ce(0x1fc)]('HTTP\x20Status:',_0x21150f['status']),console[_0x5c89ce(0x1fc)](_0x5c89ce(0x1df),_0x24ff68),loggerService_1[_0x5c89ce(0x18b)][_0x5c89ce(0x1a1)](_0x5c89ce(0x1bc),_0x5c89ce(0x1f1),_0x21150f['status'],_0x24ff68,_0x4fc111),loggerService_1[_0x5c89ce(0x18b)][_0x5c89ce(0x1b9)](_0x5c89ce(0x1bc),_0x5c89ce(0x1f1),_0x5c89ce(0x1b7)+_0x21150f['status']+':\x20'+_0x24ff68);throw new Error(_0x5c89ce(0x1ee)+_0x21150f[_0x5c89ce(0x1b6)]+_0x5c89ce(0x1a9)+_0x24ff68);}let _0x23aba5;try{_0x23aba5=JSON[_0x5c89ce(0x1ed)](_0x24ff68);}catch(_0xb4852b){console[_0x5c89ce(0x1fc)](_0x5c89ce(0x1b8),_0xb4852b),loggerService_1['loggerService'][_0x5c89ce(0x1b9)](_0x5c89ce(0x1bc),_0x5c89ce(0x1f1),'JSON\x20Parse\x20Error:\x20'+_0xb4852b);throw new Error(_0x5c89ce(0x1d8)+_0x24ff68);}console[_0x5c89ce(0x1c2)](_0x5c89ce(0x1ef)),console[_0x5c89ce(0x1c2)](_0x5c89ce(0x1e0),JSON[_0x5c89ce(0x1bb)](_0x23aba5,null,0x2)),loggerService_1['loggerService'][_0x5c89ce(0x1a1)]('plisio_direct',_0x5c89ce(0x1f1),_0x21150f[_0x5c89ce(0x1b6)],_0x23aba5,_0x4fc111);if(_0x23aba5[_0x5c89ce(0x1b6)]!==_0x5c89ce(0x1d5)){const _0x22dfd3=_0x23aba5[_0x5c89ce(0x1e8)]||_0x23aba5['error']||_0x5c89ce(0x19c);console[_0x5c89ce(0x1fc)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x5c89ce(0x1fc)](_0x5c89ce(0x1a3),_0x22dfd3),loggerService_1[_0x5c89ce(0x18b)][_0x5c89ce(0x1b9)]('plisio_direct','/invoices/new',_0x5c89ce(0x1a6)+_0x22dfd3);throw new Error('Plisio\x20API\x20error:\x20'+_0x22dfd3);}if(!_0x23aba5[_0x5c89ce(0x193)]?.[_0x5c89ce(0x1c6)]||!_0x23aba5[_0x5c89ce(0x193)]?.[_0x5c89ce(0x1d0)]){console[_0x5c89ce(0x1fc)](_0x5c89ce(0x1ad)),console['error'](_0x5c89ce(0x1d1)),console[_0x5c89ce(0x1fc)](_0x5c89ce(0x1c9),_0x23aba5['data']),loggerService_1[_0x5c89ce(0x18b)][_0x5c89ce(0x1b9)](_0x5c89ce(0x1bc),_0x5c89ce(0x1f1),_0x5c89ce(0x1eb));throw new Error(_0x5c89ce(0x1b1));}return console['log'](_0x5c89ce(0x1c8)),console[_0x5c89ce(0x1c2)]('Transaction\x20ID:',_0x23aba5[_0x5c89ce(0x193)]['txn_id']),console[_0x5c89ce(0x1c2)](_0x5c89ce(0x200),_0x23aba5['data']['invoice_url']),console[_0x5c89ce(0x1c2)](_0x5c89ce(0x1f7),_0x19566e,_0x39878f),_0x3a028c&&(console['log'](_0x5c89ce(0x1f4),_0x3a028c,'(crypto\x20for\x20payment)'),console['log'](_0x5c89ce(0x1ce),_0x39878f,_0x5c89ce(0x18c))),{'gateway_payment_id':_0x23aba5['data'][_0x5c89ce(0x1c6)],'payment_url':_0x23aba5['data'][_0x5c89ce(0x1d0)],'invoice_total_sum':_0x23aba5['data'][_0x5c89ce(0x198)],'qr_code':_0x23aba5[_0x5c89ce(0x193)]['qr_code'],'qr_url':_0x23aba5[_0x5c89ce(0x193)][_0x5c89ce(0x1a7)]};}catch(_0x26fa5a){console[_0x5c89ce(0x1fc)](_0x5c89ce(0x1aa)),console[_0x5c89ce(0x1fc)](_0x5c89ce(0x1be),_0x26fa5a),loggerService_1['loggerService'][_0x5c89ce(0x1b9)](_0x5c89ce(0x1bc),_0x5c89ce(0x1f1),_0x26fa5a);if(_0x26fa5a instanceof Error){console['error'](_0x5c89ce(0x1c0),_0x26fa5a[_0x5c89ce(0x1e8)]),console['error'](_0x5c89ce(0x1b3),_0x26fa5a['stack']);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x26fa5a[_0x5c89ce(0x1e8)]);}throw new Error(_0x5c89ce(0x18d));}}async[a44_0x5c001(0x19a)](_0x33f1b6){const _0x3b9eb7=a44_0x5c001,_0x14319b=Date[_0x3b9eb7(0x189)]();try{if(!this[_0x3b9eb7(0x1e2)])throw new Error(_0x3b9eb7(0x19f));const _0xedd11c=new URLSearchParams({'api_key':this[_0x3b9eb7(0x1e2)],'txn_id':_0x33f1b6}),_0x19bce6=_0x3b9eb7(0x1f0)+_0x33f1b6+'?'+_0xedd11c[_0x3b9eb7(0x1dd)]();loggerService_1['loggerService'][_0x3b9eb7(0x1b4)](_0x3b9eb7(0x1bc),_0x3b9eb7(0x1c1)+_0x33f1b6,_0x3b9eb7(0x1bd),Object[_0x3b9eb7(0x1dc)](_0xedd11c[_0x3b9eb7(0x1f8)]()));const _0x415652=await fetch(_0x19bce6,{'method':'GET','headers':{'Accept':_0x3b9eb7(0x1f2),'User-Agent':_0x3b9eb7(0x196)}}),_0x1bf2f6=Date['now']()-_0x14319b;if(!_0x415652['ok']){const _0x103243=await _0x415652[_0x3b9eb7(0x1d4)]();loggerService_1[_0x3b9eb7(0x18b)][_0x3b9eb7(0x1a1)]('plisio_direct',_0x3b9eb7(0x1c1)+_0x33f1b6,_0x415652['status'],_0x103243,_0x1bf2f6);throw new Error(_0x3b9eb7(0x1ee)+_0x415652[_0x3b9eb7(0x1b6)]);}const _0x379e89=await _0x415652[_0x3b9eb7(0x197)]();loggerService_1[_0x3b9eb7(0x18b)][_0x3b9eb7(0x1a1)](_0x3b9eb7(0x1bc),'/operations/'+_0x33f1b6,_0x415652[_0x3b9eb7(0x1b6)],_0x379e89,_0x1bf2f6);if(_0x379e89[_0x3b9eb7(0x1b6)]!=='success'){loggerService_1[_0x3b9eb7(0x18b)][_0x3b9eb7(0x1b9)](_0x3b9eb7(0x1bc),_0x3b9eb7(0x1c1)+_0x33f1b6,_0x3b9eb7(0x1c7)+(_0x379e89['message']||_0x379e89['error']||'Unknown\x20error'));throw new Error(_0x3b9eb7(0x1c7)+(_0x379e89[_0x3b9eb7(0x1e8)]||_0x379e89[_0x3b9eb7(0x1fc)]||'Unknown\x20error'));}let _0xb892c7=_0x3b9eb7(0x19d);return{'status':_0xb892c7};}catch(_0x52c8aa){console[_0x3b9eb7(0x1fc)](_0x3b9eb7(0x1a8),_0x52c8aa),loggerService_1[_0x3b9eb7(0x18b)][_0x3b9eb7(0x1b9)](_0x3b9eb7(0x1bc),'/operations/'+_0x33f1b6,_0x52c8aa);throw new Error(_0x3b9eb7(0x1d7)+(_0x52c8aa instanceof Error?_0x52c8aa[_0x3b9eb7(0x1e8)]:_0x3b9eb7(0x1a4)));}}async[a44_0x5c001(0x194)](_0x449693){const _0x558397=a44_0x5c001;console[_0x558397(0x1c2)](_0x558397(0x1e7),_0x449693);let _0x3e8ad2=_0x558397(0x19d);switch(_0x449693[_0x558397(0x1b6)]?.[_0x558397(0x1e3)]()){case _0x558397(0x190):case'mismatch':_0x3e8ad2='PAID';break;case _0x558397(0x18a):_0x3e8ad2='EXPIRED';break;case'error':case _0x558397(0x191):_0x3e8ad2=_0x558397(0x1e6);break;case _0x558397(0x1fd):case _0x558397(0x1ac):default:_0x3e8ad2='PENDING';break;}let _0x1d009c;if(_0x449693[_0x558397(0x1de)])try{console[_0x558397(0x1c2)](_0x558397(0x1f5),_0x449693[_0x558397(0x1de)]);let _0x2a7dda;if(typeof _0x449693['tx_urls']==='string')_0x2a7dda=JSON['parse'](_0x449693['tx_urls']);else Array[_0x558397(0x1cb)](_0x449693[_0x558397(0x1de)])?_0x2a7dda=_0x449693['tx_urls']:_0x2a7dda=[];_0x1d009c=_0x2a7dda[_0x558397(0x1fe)](_0x395181=>{const _0x387c8a=_0x558397,_0x33c648=_0x395181[_0x387c8a(0x1cc)](/\\/g,'');return console[_0x387c8a(0x1c2)](_0x387c8a(0x1c4)+_0x395181+_0x387c8a(0x1ba)+_0x33c648),_0x33c648;}),console[_0x558397(0x1c2)](_0x558397(0x199),_0x1d009c),_0x1d009c[_0x558397(0x192)]((_0x156fe5,_0x37ce5f)=>{const _0x356ef7=_0x558397;try{new URL(_0x156fe5),console[_0x356ef7(0x1c2)](_0x356ef7(0x18e)+(_0x37ce5f+0x1)+'\x20is\x20valid:\x20'+_0x156fe5);}catch(_0x4edf68){console[_0x356ef7(0x1fc)](_0x356ef7(0x1cf)+(_0x37ce5f+0x1)+_0x356ef7(0x202)+_0x156fe5,_0x4edf68);}});}catch(_0x1bd1f8){console[_0x558397(0x1fc)](_0x558397(0x1b5),_0x1bd1f8),console[_0x558397(0x1fc)]('Raw\x20tx_urls\x20data:',_0x449693[_0x558397(0x1de)]),_0x1d009c=undefined;}return{'paymentId':_0x449693[_0x558397(0x1f3)]||'','status':_0x3e8ad2,'amount':_0x449693['amount'],'currency':_0x449693[_0x558397(0x1d9)],'txUrls':_0x1d009c};}}exports[a44_0x5c001(0x1fb)]=PlisioService;