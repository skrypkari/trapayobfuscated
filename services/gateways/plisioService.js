'use strict';const a43_0x3d09d6=a43_0x4f11;function a43_0x4f11(_0x3a7555,_0x2c40d7){const _0x20335d=a43_0x2033();return a43_0x4f11=function(_0x4f1120,_0x11a9d8){_0x4f1120=_0x4f1120-0x126;let _0x795836=_0x20335d[_0x4f1120];return _0x795836;},a43_0x4f11(_0x3a7555,_0x2c40d7);}(function(_0x4090d7,_0x1a214c){const _0x4fc101=a43_0x4f11,_0x194e88=_0x4090d7();while(!![]){try{const _0x4a5766=-parseInt(_0x4fc101(0x146))/0x1*(-parseInt(_0x4fc101(0x129))/0x2)+parseInt(_0x4fc101(0x178))/0x3*(-parseInt(_0x4fc101(0x13e))/0x4)+-parseInt(_0x4fc101(0x167))/0x5+-parseInt(_0x4fc101(0x14d))/0x6*(parseInt(_0x4fc101(0x15f))/0x7)+-parseInt(_0x4fc101(0x15b))/0x8+parseInt(_0x4fc101(0x14e))/0x9+-parseInt(_0x4fc101(0x19e))/0xa*(-parseInt(_0x4fc101(0x19c))/0xb);if(_0x4a5766===_0x1a214c)break;else _0x194e88['push'](_0x194e88['shift']());}catch(_0x193781){_0x194e88['push'](_0x194e88['shift']());}}}(a43_0x2033,0x6853b));Object[a43_0x3d09d6(0x16f)](exports,'__esModule',{'value':!![]}),exports[a43_0x3d09d6(0x170)]=void 0x0;const loggerService_1=require(a43_0x3d09d6(0x141));class PlisioService{constructor(){const _0x52f3ef=a43_0x3d09d6;this[_0x52f3ef(0x1a0)]=_0x52f3ef(0x18e),this[_0x52f3ef(0x19d)]=process[_0x52f3ef(0x143)]['PLISIO_API_KEY']||'',!this['apiKey']?console[_0x52f3ef(0x164)]('⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x52f3ef(0x166)](_0x52f3ef(0x162));}async[a43_0x3d09d6(0x14c)](_0x468c53){const _0x130386=a43_0x3d09d6,{orderId:_0x56b652,amount:_0x27c377,currency:_0x1eb327,productName:_0x45d9e7,description:_0x4e46c9,successUrl:_0x3b8088,failUrl:_0x2a5020,customerEmail:_0x154466,customerName:_0x4cd2b3,isSourceCurrency:_0x1bc083,sourceCurrency:_0x378ba6}=_0x468c53;if(!this['apiKey'])throw new Error(_0x130386(0x187));const _0x1f6cb2=new URLSearchParams({'api_key':this[_0x130386(0x19d)],'order_number':_0x56b652,'order_name':_0x45d9e7,'description':_0x4e46c9,'success_url':_0x3b8088,'fail_url':_0x2a5020,'callback_url':'https://apitest.trapay.uk/api/webhooks/gateway/plisio'});_0x378ba6?(_0x1f6cb2['append'](_0x130386(0x173),_0x378ba6),_0x1f6cb2[_0x130386(0x18f)](_0x130386(0x16a),_0x1eb327),_0x1f6cb2[_0x130386(0x18f)](_0x130386(0x144),_0x27c377[_0x130386(0x155)]())):(_0x1f6cb2['append']('currency',_0x1eb327),_0x1f6cb2[_0x130386(0x18f)]('amount',_0x27c377['toString']()));_0x154466&&_0x1f6cb2['append'](_0x130386(0x12e),_0x154466);_0x4cd2b3&&_0x1f6cb2[_0x130386(0x18f)](_0x130386(0x199),_0x4cd2b3);const _0x5ce2c3=this['apiUrl']+'?'+_0x1f6cb2['toString'](),_0x42a379=Date[_0x130386(0x132)]();try{console[_0x130386(0x166)](_0x130386(0x18c)),console[_0x130386(0x166)](_0x130386(0x12a),this[_0x130386(0x1a0)]),console['log'](_0x130386(0x163),Object[_0x130386(0x1a1)](_0x1f6cb2[_0x130386(0x12c)]())),console['log'](_0x130386(0x12d),_0x5ce2c3['replace'](this[_0x130386(0x19d)],_0x130386(0x135))),loggerService_1[_0x130386(0x180)][_0x130386(0x156)](_0x130386(0x137),_0x130386(0x15a),_0x130386(0x171),Object['fromEntries'](_0x1f6cb2[_0x130386(0x12c)]()));const _0x2d5772=await fetch(_0x5ce2c3,{'method':_0x130386(0x171),'headers':{'Accept':_0x130386(0x195),'User-Agent':_0x130386(0x153)}}),_0x423a93=Date[_0x130386(0x132)]()-_0x42a379;console['log'](_0x130386(0x152)),console[_0x130386(0x166)](_0x130386(0x147),_0x2d5772['status']),console[_0x130386(0x166)](_0x130386(0x154),_0x2d5772[_0x130386(0x18a)]),console[_0x130386(0x166)]('Response\x20Time:',_0x423a93+'ms');const _0x5a99fc=await _0x2d5772[_0x130386(0x16c)]();console['log']('Raw\x20Response\x20Body:',_0x5a99fc);if(!_0x2d5772['ok']){console[_0x130386(0x134)](_0x130386(0x176)),console[_0x130386(0x134)](_0x130386(0x19b),_0x2d5772[_0x130386(0x194)]),console[_0x130386(0x134)]('Response\x20Body:',_0x5a99fc),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x130386(0x137),_0x130386(0x15a),_0x2d5772[_0x130386(0x194)],_0x5a99fc,_0x423a93),loggerService_1[_0x130386(0x180)]['logWhiteDomainError'](_0x130386(0x137),_0x130386(0x15a),_0x130386(0x12b)+_0x2d5772[_0x130386(0x194)]+':\x20'+_0x5a99fc);throw new Error(_0x130386(0x149)+_0x2d5772[_0x130386(0x194)]+_0x130386(0x189)+_0x5a99fc);}let _0x561efc;try{_0x561efc=JSON['parse'](_0x5a99fc);}catch(_0x11372a){console[_0x130386(0x134)](_0x130386(0x169),_0x11372a),loggerService_1['loggerService'][_0x130386(0x197)](_0x130386(0x137),_0x130386(0x15a),'JSON\x20Parse\x20Error:\x20'+_0x11372a);throw new Error(_0x130386(0x150)+_0x5a99fc);}console[_0x130386(0x166)](_0x130386(0x126)),console[_0x130386(0x166)](_0x130386(0x15d),JSON[_0x130386(0x15e)](_0x561efc,null,0x2)),loggerService_1[_0x130386(0x180)]['logWhiteDomainResponse']('plisio_direct','/invoices/new',_0x2d5772[_0x130386(0x194)],_0x561efc,_0x423a93);if(_0x561efc['status']!==_0x130386(0x17c)){const _0x400be0=_0x561efc[_0x130386(0x161)]||_0x561efc[_0x130386(0x134)]||_0x130386(0x158);console[_0x130386(0x134)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x130386(0x134)](_0x130386(0x168),_0x400be0),loggerService_1[_0x130386(0x180)]['logWhiteDomainError'](_0x130386(0x137),_0x130386(0x15a),_0x130386(0x192)+_0x400be0);throw new Error(_0x130386(0x12f)+_0x400be0);}if(!_0x561efc[_0x130386(0x186)]?.[_0x130386(0x17a)]||!_0x561efc[_0x130386(0x186)]?.['invoice_url']){console[_0x130386(0x134)](_0x130386(0x148)),console['error'](_0x130386(0x13b)),console[_0x130386(0x134)]('Response\x20data:',_0x561efc[_0x130386(0x186)]),loggerService_1[_0x130386(0x180)][_0x130386(0x197)]('plisio_direct',_0x130386(0x15a),_0x130386(0x18d));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x130386(0x166)](_0x130386(0x140)),console[_0x130386(0x166)](_0x130386(0x13d),_0x561efc['data'][_0x130386(0x17a)]),console[_0x130386(0x166)](_0x130386(0x193),_0x561efc[_0x130386(0x186)][_0x130386(0x19a)]),console[_0x130386(0x166)](_0x130386(0x174),_0x27c377,_0x1eb327),_0x378ba6&&(console[_0x130386(0x166)](_0x130386(0x190),_0x378ba6,_0x130386(0x17d)),console[_0x130386(0x166)](_0x130386(0x184),_0x1eb327,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x561efc[_0x130386(0x186)][_0x130386(0x17a)],'payment_url':_0x561efc[_0x130386(0x186)][_0x130386(0x19a)],'invoice_total_sum':_0x561efc[_0x130386(0x186)]['invoice_total_sum'],'qr_code':_0x561efc[_0x130386(0x186)][_0x130386(0x145)],'qr_url':_0x561efc['data'][_0x130386(0x17e)]};}catch(_0x432317){console[_0x130386(0x134)](_0x130386(0x17f)),console[_0x130386(0x134)](_0x130386(0x182),_0x432317),loggerService_1[_0x130386(0x180)][_0x130386(0x197)](_0x130386(0x137),_0x130386(0x15a),_0x432317);if(_0x432317 instanceof Error){console[_0x130386(0x134)](_0x130386(0x13a),_0x432317['message']),console['error']('Error\x20stack:',_0x432317[_0x130386(0x188)]);throw new Error(_0x130386(0x15c)+_0x432317[_0x130386(0x161)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a43_0x3d09d6(0x133)](_0x2627e8){const _0x477f90=a43_0x3d09d6,_0x3b10d1=Date[_0x477f90(0x132)]();try{if(!this[_0x477f90(0x19d)])throw new Error(_0x477f90(0x187));const _0x102fec=new URLSearchParams({'api_key':this[_0x477f90(0x19d)],'txn_id':_0x2627e8}),_0x1e22ff=_0x477f90(0x181)+_0x2627e8+'?'+_0x102fec[_0x477f90(0x155)]();loggerService_1[_0x477f90(0x180)][_0x477f90(0x156)](_0x477f90(0x137),_0x477f90(0x18b)+_0x2627e8,_0x477f90(0x171),Object[_0x477f90(0x1a1)](_0x102fec[_0x477f90(0x12c)]()));const _0xc07180=await fetch(_0x1e22ff,{'method':_0x477f90(0x171),'headers':{'Accept':_0x477f90(0x195),'User-Agent':_0x477f90(0x153)}}),_0x45fd92=Date['now']()-_0x3b10d1;if(!_0xc07180['ok']){const _0x1aaa8f=await _0xc07180[_0x477f90(0x16c)]();loggerService_1[_0x477f90(0x180)][_0x477f90(0x198)](_0x477f90(0x137),_0x477f90(0x18b)+_0x2627e8,_0xc07180[_0x477f90(0x194)],_0x1aaa8f,_0x45fd92);throw new Error(_0x477f90(0x149)+_0xc07180[_0x477f90(0x194)]);}const _0x47ff2f=await _0xc07180[_0x477f90(0x131)]();loggerService_1['loggerService'][_0x477f90(0x198)](_0x477f90(0x137),'/operations/'+_0x2627e8,_0xc07180[_0x477f90(0x194)],_0x47ff2f,_0x45fd92);if(_0x47ff2f[_0x477f90(0x194)]!=='success'){loggerService_1[_0x477f90(0x180)][_0x477f90(0x197)](_0x477f90(0x137),_0x477f90(0x18b)+_0x2627e8,_0x477f90(0x12f)+(_0x47ff2f[_0x477f90(0x161)]||_0x47ff2f['error']||'Unknown\x20error'));throw new Error(_0x477f90(0x12f)+(_0x47ff2f[_0x477f90(0x161)]||_0x47ff2f[_0x477f90(0x134)]||_0x477f90(0x16d)));}let _0x22c239=_0x477f90(0x177);return{'status':_0x22c239};}catch(_0x170a03){console[_0x477f90(0x134)](_0x477f90(0x16e),_0x170a03),loggerService_1[_0x477f90(0x180)][_0x477f90(0x197)](_0x477f90(0x137),'/operations/'+_0x2627e8,_0x170a03);throw new Error(_0x477f90(0x165)+(_0x170a03 instanceof Error?_0x170a03[_0x477f90(0x161)]:_0x477f90(0x16d)));}}async[a43_0x3d09d6(0x157)](_0x26ae6b){const _0x4dab9d=a43_0x3d09d6;console[_0x4dab9d(0x166)](_0x4dab9d(0x128),_0x26ae6b);let _0x78c57a=_0x4dab9d(0x177);switch(_0x26ae6b[_0x4dab9d(0x194)]?.['toLowerCase']()){case _0x4dab9d(0x151):case _0x4dab9d(0x160):_0x78c57a='PAID';break;case _0x4dab9d(0x138):_0x78c57a=_0x4dab9d(0x183);break;case'error':case _0x4dab9d(0x14b):_0x78c57a='FAILED';break;case _0x4dab9d(0x196):case _0x4dab9d(0x179):default:_0x78c57a=_0x4dab9d(0x177);break;}let _0x505b30;if(_0x26ae6b[_0x4dab9d(0x191)])try{console['log'](_0x4dab9d(0x13f),_0x26ae6b[_0x4dab9d(0x191)]);let _0x274deb;if(typeof _0x26ae6b['tx_urls']===_0x4dab9d(0x19f))_0x274deb=JSON[_0x4dab9d(0x159)](_0x26ae6b[_0x4dab9d(0x191)]);else Array[_0x4dab9d(0x142)](_0x26ae6b['tx_urls'])?_0x274deb=_0x26ae6b[_0x4dab9d(0x191)]:_0x274deb=[];_0x505b30=_0x274deb[_0x4dab9d(0x172)](_0x187d48=>{const _0x3a86cb=_0x4dab9d,_0x1c6230=_0x187d48[_0x3a86cb(0x16b)](/\\/g,'');return console[_0x3a86cb(0x166)](_0x3a86cb(0x136)+_0x187d48+_0x3a86cb(0x139)+_0x1c6230),_0x1c6230;}),console['log'](_0x4dab9d(0x127),_0x505b30),_0x505b30[_0x4dab9d(0x13c)]((_0x328ac0,_0x2c6c3e)=>{const _0x5f0ac9=_0x4dab9d;try{new URL(_0x328ac0),console[_0x5f0ac9(0x166)](_0x5f0ac9(0x14a)+(_0x2c6c3e+0x1)+_0x5f0ac9(0x17b)+_0x328ac0);}catch(_0x201044){console[_0x5f0ac9(0x134)](_0x5f0ac9(0x130)+(_0x2c6c3e+0x1)+_0x5f0ac9(0x175)+_0x328ac0,_0x201044);}});}catch(_0x4957b3){console['error']('❌\x20Failed\x20to\x20parse\x20tx_urls:',_0x4957b3),console[_0x4dab9d(0x134)](_0x4dab9d(0x185),_0x26ae6b['tx_urls']),_0x505b30=undefined;}return{'paymentId':_0x26ae6b['order_number']||'','status':_0x78c57a,'amount':_0x26ae6b[_0x4dab9d(0x14f)],'currency':_0x26ae6b[_0x4dab9d(0x173)],'txUrls':_0x505b30};}}function a43_0x2033(){const _0x3d0c89=['255665YythSW','Error\x20Message:','Failed\x20to\x20parse\x20JSON\x20response:','source_currency','replace','text','Unknown\x20error','Plisio\x20payment\x20verification\x20error:','defineProperty','PlisioService','GET','map','currency','Amount:','\x20is\x20invalid:\x20','===\x20PLISIO\x20API\x20ERROR\x20===','PENDING','33YSVwqV','pending','txn_id','\x20is\x20valid:\x20','success','(crypto\x20for\x20payment)','qr_url','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','loggerService','https://api.plisio.net/api/v1/operations/','Error\x20details:','EXPIRED','Target\x20Currency:','Raw\x20tx_urls\x20data:','data','Plisio\x20API\x20key\x20is\x20not\x20configured','stack',',\x20body:\x20','statusText','/operations/','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','https://api.plisio.net/api/v1/invoices/new','append','Source\x20Currency:','tx_urls','Business\x20Error:\x20','Invoice\x20URL:','status','application/json','new','logWhiteDomainError','logWhiteDomainResponse','name','invoice_url','HTTP\x20Status:','44tosTFs','apiKey','4072760PtSVQj','string','apiUrl','fromEntries','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','✅\x20Processed\x20tx_urls:','Processing\x20Plisio\x20webhook:','2YlCbNr','URL:','HTTP\x20','entries','Full\x20URL\x20(without\x20API\x20key):','email','Plisio\x20API\x20error:\x20','❌\x20URL\x20','json','now','verifyPayment','error','HIDDEN','🔗\x20Formatted\x20URL:\x20','plisio_direct','expired','\x20->\x20','Error\x20message:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','forEach','Transaction\x20ID:','240524ZemaZX','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','===\x20PLISIO\x20SUCCESS\x20===','../loggerService','isArray','env','source_amount','qr_code','1097ISwtwH','Status:','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20error!\x20status:\x20','✅\x20URL\x20','cancelled','createPayment','6414WHLiJw','2973195fElciT','amount','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','completed','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','TesSoft\x20Payment\x20System/1.0','Status\x20Text:','toString','logWhiteDomainRequest','processWebhook','Unknown\x20error\x20from\x20Plisio\x20API','parse','/invoices/new','5265368gsNEFj','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Parsed\x20Result:','stringify','1064YWDORr','mismatch','message','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Parameters:','warn','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','log'];a43_0x2033=function(){return _0x3d0c89;};return a43_0x2033();}exports[a43_0x3d09d6(0x170)]=PlisioService;