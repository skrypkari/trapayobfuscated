'use strict';function a44_0x11ed(_0x4e9c7a,_0x474686){const _0x39bcdd=a44_0x39bc();return a44_0x11ed=function(_0x11edca,_0x482687){_0x11edca=_0x11edca-0x1dc;let _0x27ea9c=_0x39bcdd[_0x11edca];return _0x27ea9c;},a44_0x11ed(_0x4e9c7a,_0x474686);}const a44_0x147b5d=a44_0x11ed;(function(_0x4f5b64,_0x48b5a5){const _0x1138c9=a44_0x11ed,_0x34ae00=_0x4f5b64();while(!![]){try{const _0x35f158=-parseInt(_0x1138c9(0x251))/0x1*(parseInt(_0x1138c9(0x259))/0x2)+-parseInt(_0x1138c9(0x1eb))/0x3*(-parseInt(_0x1138c9(0x1f7))/0x4)+-parseInt(_0x1138c9(0x1dd))/0x5*(parseInt(_0x1138c9(0x24e))/0x6)+-parseInt(_0x1138c9(0x250))/0x7+parseInt(_0x1138c9(0x238))/0x8+parseInt(_0x1138c9(0x1f8))/0x9*(-parseInt(_0x1138c9(0x253))/0xa)+parseInt(_0x1138c9(0x223))/0xb;if(_0x35f158===_0x48b5a5)break;else _0x34ae00['push'](_0x34ae00['shift']());}catch(_0x5241d6){_0x34ae00['push'](_0x34ae00['shift']());}}}(a44_0x39bc,0xd9bbc));Object[a44_0x147b5d(0x246)](exports,'__esModule',{'value':!![]}),exports[a44_0x147b5d(0x203)]=void 0x0;const loggerService_1=require(a44_0x147b5d(0x1e9));class PlisioService{constructor(){const _0x29109e=a44_0x147b5d;this[_0x29109e(0x227)]=_0x29109e(0x204),this['apiKey']=process[_0x29109e(0x20f)][_0x29109e(0x206)]||'',!this[_0x29109e(0x201)]?console[_0x29109e(0x240)](_0x29109e(0x205)):console[_0x29109e(0x1e1)](_0x29109e(0x1fd));}async[a44_0x147b5d(0x24c)](_0x344131){const _0x530c74=a44_0x147b5d,{orderId:_0x29386c,amount:_0x57ed8a,currency:_0x5c766d,productName:_0x310c84,description:_0x54855b,successUrl:_0xd9f176,failUrl:_0x48edad,customerEmail:_0x4a5ee7,customerName:_0x19eb4f,isSourceCurrency:_0x4678e9,sourceCurrency:_0x517efa}=_0x344131;if(!this[_0x530c74(0x201)])throw new Error(_0x530c74(0x236));const _0x5ace52=new URLSearchParams({'api_key':this[_0x530c74(0x201)],'order_number':_0x29386c,'order_name':_0x310c84,'description':_0x54855b,'success_url':_0xd9f176,'fail_url':_0x48edad,'callback_url':_0x530c74(0x217)});_0x517efa?(_0x5ace52[_0x530c74(0x249)](_0x530c74(0x237),_0x517efa),_0x5ace52[_0x530c74(0x249)](_0x530c74(0x213),_0x5c766d),_0x5ace52['append'](_0x530c74(0x200),_0x57ed8a[_0x530c74(0x215)]())):(_0x5ace52[_0x530c74(0x249)](_0x530c74(0x237),_0x5c766d),_0x5ace52[_0x530c74(0x249)](_0x530c74(0x23c),_0x57ed8a['toString']()));_0x4a5ee7&&_0x5ace52[_0x530c74(0x249)](_0x530c74(0x214),_0x4a5ee7);_0x19eb4f&&_0x5ace52['append'](_0x530c74(0x20d),_0x19eb4f);const _0x1ba32b=this[_0x530c74(0x227)]+'?'+_0x5ace52[_0x530c74(0x215)](),_0x5c98a3=Date[_0x530c74(0x210)]();try{console[_0x530c74(0x1e1)](_0x530c74(0x228)),console[_0x530c74(0x1e1)]('URL:',this[_0x530c74(0x227)]),console['log'](_0x530c74(0x212),Object[_0x530c74(0x235)](_0x5ace52[_0x530c74(0x1e6)]())),console[_0x530c74(0x1e1)](_0x530c74(0x1f2),_0x1ba32b[_0x530c74(0x247)](this[_0x530c74(0x201)],_0x530c74(0x22c))),loggerService_1[_0x530c74(0x24d)][_0x530c74(0x20e)]('plisio_direct',_0x530c74(0x1ed),_0x530c74(0x1de),Object[_0x530c74(0x235)](_0x5ace52[_0x530c74(0x1e6)]()));const _0x598b2b=await fetch(_0x1ba32b,{'method':_0x530c74(0x1de),'headers':{'Accept':_0x530c74(0x252),'User-Agent':_0x530c74(0x229)}}),_0x111f51=Date['now']()-_0x5c98a3;console['log'](_0x530c74(0x1f5)),console[_0x530c74(0x1e1)](_0x530c74(0x1e4),_0x598b2b[_0x530c74(0x222)]),console['log']('Status\x20Text:',_0x598b2b[_0x530c74(0x211)]),console[_0x530c74(0x1e1)](_0x530c74(0x1fb),_0x111f51+'ms');const _0x4666b7=await _0x598b2b[_0x530c74(0x22f)]();console[_0x530c74(0x1e1)](_0x530c74(0x1ec),_0x4666b7);if(!_0x598b2b['ok']){console[_0x530c74(0x225)](_0x530c74(0x220)),console[_0x530c74(0x225)]('HTTP\x20Status:',_0x598b2b[_0x530c74(0x222)]),console['error'](_0x530c74(0x239),_0x4666b7),loggerService_1['loggerService'][_0x530c74(0x1fc)]('plisio_direct','/invoices/new',_0x598b2b[_0x530c74(0x222)],_0x4666b7,_0x111f51),loggerService_1[_0x530c74(0x24d)][_0x530c74(0x21a)](_0x530c74(0x21e),_0x530c74(0x1ed),_0x530c74(0x25c)+_0x598b2b[_0x530c74(0x222)]+':\x20'+_0x4666b7);throw new Error(_0x530c74(0x248)+_0x598b2b[_0x530c74(0x222)]+_0x530c74(0x208)+_0x4666b7);}let _0x5c48c2;try{_0x5c48c2=JSON[_0x530c74(0x24a)](_0x4666b7);}catch(_0x324672){console[_0x530c74(0x225)](_0x530c74(0x21c),_0x324672),loggerService_1[_0x530c74(0x24d)][_0x530c74(0x21a)](_0x530c74(0x21e),_0x530c74(0x1ed),_0x530c74(0x1e7)+_0x324672);throw new Error(_0x530c74(0x22d)+_0x4666b7);}console[_0x530c74(0x1e1)](_0x530c74(0x25a)),console[_0x530c74(0x1e1)](_0x530c74(0x1e3),JSON[_0x530c74(0x216)](_0x5c48c2,null,0x2)),loggerService_1[_0x530c74(0x24d)]['logWhiteDomainResponse'](_0x530c74(0x21e),_0x530c74(0x1ed),_0x598b2b[_0x530c74(0x222)],_0x5c48c2,_0x111f51);if(_0x5c48c2[_0x530c74(0x222)]!==_0x530c74(0x1f0)){const _0x49660d=_0x5c48c2['message']||_0x5c48c2[_0x530c74(0x225)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x530c74(0x225)](_0x530c74(0x1dc)),console[_0x530c74(0x225)](_0x530c74(0x1f9),_0x49660d),loggerService_1[_0x530c74(0x24d)][_0x530c74(0x21a)](_0x530c74(0x21e),_0x530c74(0x1ed),'Business\x20Error:\x20'+_0x49660d);throw new Error(_0x530c74(0x1fe)+_0x49660d);}if(!_0x5c48c2['data']?.[_0x530c74(0x241)]||!_0x5c48c2[_0x530c74(0x1ff)]?.[_0x530c74(0x1df)]){console[_0x530c74(0x225)](_0x530c74(0x1ee)),console[_0x530c74(0x225)](_0x530c74(0x207)),console[_0x530c74(0x225)](_0x530c74(0x21b),_0x5c48c2[_0x530c74(0x1ff)]),loggerService_1['loggerService'][_0x530c74(0x21a)](_0x530c74(0x21e),'/invoices/new','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x530c74(0x1f1));}return console[_0x530c74(0x1e1)](_0x530c74(0x23e)),console[_0x530c74(0x1e1)](_0x530c74(0x22e),_0x5c48c2[_0x530c74(0x1ff)][_0x530c74(0x241)]),console[_0x530c74(0x1e1)]('Invoice\x20URL:',_0x5c48c2[_0x530c74(0x1ff)][_0x530c74(0x1df)]),console[_0x530c74(0x1e1)](_0x530c74(0x23d),_0x57ed8a,_0x5c766d),_0x517efa&&(console[_0x530c74(0x1e1)](_0x530c74(0x232),_0x517efa,_0x530c74(0x255)),console[_0x530c74(0x1e1)](_0x530c74(0x244),_0x5c766d,_0x530c74(0x1f4))),{'gateway_payment_id':_0x5c48c2[_0x530c74(0x1ff)][_0x530c74(0x241)],'payment_url':_0x5c48c2[_0x530c74(0x1ff)][_0x530c74(0x1df)],'invoice_total_sum':_0x5c48c2[_0x530c74(0x1ff)][_0x530c74(0x24f)],'qr_code':_0x5c48c2[_0x530c74(0x1ff)][_0x530c74(0x234)],'qr_url':_0x5c48c2[_0x530c74(0x1ff)][_0x530c74(0x21d)]};}catch(_0xb756d4){console[_0x530c74(0x225)](_0x530c74(0x1ea)),console[_0x530c74(0x225)](_0x530c74(0x22a),_0xb756d4),loggerService_1[_0x530c74(0x24d)][_0x530c74(0x21a)](_0x530c74(0x21e),_0x530c74(0x1ed),_0xb756d4);if(_0xb756d4 instanceof Error){console[_0x530c74(0x225)](_0x530c74(0x231),_0xb756d4[_0x530c74(0x23f)]),console[_0x530c74(0x225)](_0x530c74(0x242),_0xb756d4[_0x530c74(0x20a)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0xb756d4[_0x530c74(0x23f)]);}throw new Error(_0x530c74(0x221));}}async[a44_0x147b5d(0x20b)](_0x113e23){const _0x240675=a44_0x147b5d,_0x4ed04e=Date[_0x240675(0x210)]();try{if(!this['apiKey'])throw new Error(_0x240675(0x236));const _0x44e39a=new URLSearchParams({'api_key':this[_0x240675(0x201)],'txn_id':_0x113e23}),_0x1d94a8=_0x240675(0x257)+_0x113e23+'?'+_0x44e39a['toString']();loggerService_1[_0x240675(0x24d)]['logWhiteDomainRequest']('plisio_direct','/operations/'+_0x113e23,_0x240675(0x1de),Object['fromEntries'](_0x44e39a[_0x240675(0x1e6)]()));const _0x30e3ab=await fetch(_0x1d94a8,{'method':_0x240675(0x1de),'headers':{'Accept':'application/json','User-Agent':_0x240675(0x229)}}),_0x389665=Date[_0x240675(0x210)]()-_0x4ed04e;if(!_0x30e3ab['ok']){const _0x537319=await _0x30e3ab[_0x240675(0x22f)]();loggerService_1[_0x240675(0x24d)][_0x240675(0x1fc)](_0x240675(0x21e),_0x240675(0x258)+_0x113e23,_0x30e3ab[_0x240675(0x222)],_0x537319,_0x389665);throw new Error(_0x240675(0x248)+_0x30e3ab['status']);}const _0x182cd2=await _0x30e3ab[_0x240675(0x24b)]();loggerService_1[_0x240675(0x24d)]['logWhiteDomainResponse'](_0x240675(0x21e),_0x240675(0x258)+_0x113e23,_0x30e3ab[_0x240675(0x222)],_0x182cd2,_0x389665);if(_0x182cd2[_0x240675(0x222)]!==_0x240675(0x1f0)){loggerService_1[_0x240675(0x24d)][_0x240675(0x21a)](_0x240675(0x21e),_0x240675(0x258)+_0x113e23,_0x240675(0x1fe)+(_0x182cd2[_0x240675(0x23f)]||_0x182cd2['error']||_0x240675(0x1fa)));throw new Error(_0x240675(0x1fe)+(_0x182cd2[_0x240675(0x23f)]||_0x182cd2[_0x240675(0x225)]||_0x240675(0x1fa)));}let _0x5c5f58='PENDING';return{'status':_0x5c5f58};}catch(_0x474fa1){console[_0x240675(0x225)](_0x240675(0x23a),_0x474fa1),loggerService_1['loggerService']['logWhiteDomainError'](_0x240675(0x21e),_0x240675(0x258)+_0x113e23,_0x474fa1);throw new Error(_0x240675(0x230)+(_0x474fa1 instanceof Error?_0x474fa1[_0x240675(0x23f)]:_0x240675(0x1fa)));}}async[a44_0x147b5d(0x1f3)](_0x1713a7){const _0xd7735b=a44_0x147b5d;console[_0xd7735b(0x1e1)](_0xd7735b(0x1e8),_0x1713a7);let _0x307666=_0xd7735b(0x1e2);switch(_0x1713a7[_0xd7735b(0x222)]?.['toLowerCase']()){case _0xd7735b(0x209):case _0xd7735b(0x1e0):_0x307666=_0xd7735b(0x233);break;case _0xd7735b(0x25b):_0x307666=_0xd7735b(0x245);break;case _0xd7735b(0x225):case _0xd7735b(0x256):_0x307666=_0xd7735b(0x226);break;case _0xd7735b(0x21f):case _0xd7735b(0x202):default:_0x307666='PENDING';break;}let _0x390c51;if(_0x1713a7[_0xd7735b(0x22b)])try{console[_0xd7735b(0x1e1)](_0xd7735b(0x1ef),_0x1713a7[_0xd7735b(0x22b)]);let _0x36f0e5;if(typeof _0x1713a7[_0xd7735b(0x22b)]===_0xd7735b(0x218))_0x36f0e5=JSON[_0xd7735b(0x24a)](_0x1713a7[_0xd7735b(0x22b)]);else Array[_0xd7735b(0x1f6)](_0x1713a7[_0xd7735b(0x22b)])?_0x36f0e5=_0x1713a7[_0xd7735b(0x22b)]:_0x36f0e5=[];_0x390c51=_0x36f0e5[_0xd7735b(0x23b)](_0x51b102=>{const _0x1775ea=_0x51b102['replace'](/\\/g,'');return console['log']('🔗\x20Formatted\x20URL:\x20'+_0x51b102+'\x20->\x20'+_0x1775ea),_0x1775ea;}),console[_0xd7735b(0x1e1)]('✅\x20Processed\x20tx_urls:',_0x390c51),_0x390c51['forEach']((_0x1b130c,_0x1cc174)=>{const _0x6f905=_0xd7735b;try{new URL(_0x1b130c),console[_0x6f905(0x1e1)](_0x6f905(0x243)+(_0x1cc174+0x1)+_0x6f905(0x224)+_0x1b130c);}catch(_0x43d4f4){console['error'](_0x6f905(0x254)+(_0x1cc174+0x1)+_0x6f905(0x1e5)+_0x1b130c,_0x43d4f4);}});}catch(_0x2c092c){console['error'](_0xd7735b(0x219),_0x2c092c),console[_0xd7735b(0x225)](_0xd7735b(0x20c),_0x1713a7[_0xd7735b(0x22b)]),_0x390c51=undefined;}return{'paymentId':_0x1713a7['order_number']||'','status':_0x307666,'amount':_0x1713a7[_0xd7735b(0x23c)],'currency':_0x1713a7['currency'],'txUrls':_0x390c51};}}function a44_0x39bc(){const _0x6d3195=['/invoices/new','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','success','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Full\x20URL\x20(without\x20API\x20key):','processWebhook','(fiat\x20for\x20merchant)','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','isArray','4OhOsWY','9MdwztS','Error\x20Message:','Unknown\x20error','Response\x20Time:','logWhiteDomainResponse','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Plisio\x20API\x20error:\x20','data','source_amount','apiKey','pending','PlisioService','https://api.plisio.net/api/v1/invoices/new','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','PLISIO_API_KEY','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response',',\x20body:\x20','completed','stack','verifyPayment','Raw\x20tx_urls\x20data:','name','logWhiteDomainRequest','env','now','statusText','Parameters:','source_currency','email','toString','stringify','https://api.trapay.uk/api/webhooks/gateway/plisio','string','❌\x20Failed\x20to\x20parse\x20tx_urls:','logWhiteDomainError','Response\x20data:','Failed\x20to\x20parse\x20JSON\x20response:','qr_url','plisio_direct','new','===\x20PLISIO\x20API\x20ERROR\x20===','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','status','37660887TdlkDm','\x20is\x20valid:\x20','error','FAILED','apiUrl','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','TesSoft\x20Payment\x20System/1.0','Error\x20details:','tx_urls','HIDDEN','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Transaction\x20ID:','text','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Error\x20message:','Source\x20Currency:','PAID','qr_code','fromEntries','Plisio\x20API\x20key\x20is\x20not\x20configured','currency','9675808gEgNnn','Response\x20Body:','Plisio\x20payment\x20verification\x20error:','map','amount','Amount:','===\x20PLISIO\x20SUCCESS\x20===','message','warn','txn_id','Error\x20stack:','✅\x20URL\x20','Target\x20Currency:','EXPIRED','defineProperty','replace','HTTP\x20error!\x20status:\x20','append','parse','json','createPayment','loggerService','114BmFydJ','invoice_total_sum','11950428fkgqCw','626qrbViO','application/json','13336790xGakuM','❌\x20URL\x20','(crypto\x20for\x20payment)','cancelled','https://api.plisio.net/api/v1/operations/','/operations/','3766yvbXbX','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','expired','HTTP\x20','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','200335xWHrTx','GET','invoice_url','mismatch','log','PENDING','Parsed\x20Result:','Status:','\x20is\x20invalid:\x20','entries','JSON\x20Parse\x20Error:\x20','Processing\x20Plisio\x20webhook:','../loggerService','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','3718671GymVCk','Raw\x20Response\x20Body:'];a44_0x39bc=function(){return _0x6d3195;};return a44_0x39bc();}exports['PlisioService']=PlisioService;