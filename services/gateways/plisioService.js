'use strict';const a44_0x3a4932=a44_0x5f92;function a44_0x5f92(_0x2b5b61,_0xc6e919){const _0x4a338b=a44_0x4a33();return a44_0x5f92=function(_0x5f92d1,_0x189bb6){_0x5f92d1=_0x5f92d1-0x1e8;let _0x58a213=_0x4a338b[_0x5f92d1];return _0x58a213;},a44_0x5f92(_0x2b5b61,_0xc6e919);}(function(_0x5ceb27,_0x2fb9a9){const _0x2464fe=a44_0x5f92,_0xdcd271=_0x5ceb27();while(!![]){try{const _0x22f893=-parseInt(_0x2464fe(0x234))/0x1*(-parseInt(_0x2464fe(0x250))/0x2)+-parseInt(_0x2464fe(0x22c))/0x3*(-parseInt(_0x2464fe(0x1ef))/0x4)+parseInt(_0x2464fe(0x229))/0x5+parseInt(_0x2464fe(0x245))/0x6*(parseInt(_0x2464fe(0x225))/0x7)+parseInt(_0x2464fe(0x21b))/0x8*(parseInt(_0x2464fe(0x246))/0x9)+-parseInt(_0x2464fe(0x203))/0xa*(parseInt(_0x2464fe(0x22f))/0xb)+-parseInt(_0x2464fe(0x259))/0xc;if(_0x22f893===_0x2fb9a9)break;else _0xdcd271['push'](_0xdcd271['shift']());}catch(_0x138912){_0xdcd271['push'](_0xdcd271['shift']());}}}(a44_0x4a33,0xf4105));Object[a44_0x3a4932(0x21d)](exports,a44_0x3a4932(0x201),{'value':!![]}),exports[a44_0x3a4932(0x25e)]=void 0x0;const loggerService_1=require(a44_0x3a4932(0x213));function a44_0x4a33(){const _0x2bd656=['\x20->\x20','toLowerCase','Unknown\x20error','string','Invoice\x20URL:','6640MUMXXu','txn_id','defineProperty','Transaction\x20ID:','invoice_total_sum','application/json','mismatch','URL:','PAID','invoice_url','5893349MXyIRf','email','message','‚úÖ\x20Processed\x20tx_urls:','4610675lAseuV','Processing\x20Plisio\x20webhook:','parse','4940223FGLFtd','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','processWebhook','22zhvFRS','error','loggerService','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20Status:','1hErTjM','logWhiteDomainError','Failed\x20to\x20create\x20Plisio\x20payment:\x20','logWhiteDomainRequest','text','entries','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','currency','https://api.plisio.net/api/v1/operations/','Parameters:','GET','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Source\x20Currency:','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','apiKey','Plisio\x20payment\x20verification\x20error:','Status:','6ClxaqO','3411RRVUjU','log','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','env','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','\x20is\x20invalid:\x20','append','FAILED','1692882aRdNnn','expired','toString','completed','HTTP\x20','/invoices/new','cancelled','amount','Error\x20Message:','29782452SUtaJT','data','Failed\x20to\x20parse\x20JSON\x20response:','plisio_direct','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','PlisioService','https://api.trapay.uk/api/webhooks/gateway/plisio','warn','qr_url','\x20is\x20valid:\x20','tx_urls','‚úÖ\x20URL\x20','PLISIO_API_KEY','now','4ZnWqoU','source_amount','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','HIDDEN','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Amount:','order_number','qr_code','(crypto\x20for\x20payment)','===\x20PLISIO\x20SUCCESS\x20===','HTTP\x20error!\x20status:\x20','replace','PENDING','Response\x20Body:','TesSoft\x20Payment\x20System/1.0','Plisio\x20API\x20error:\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','__esModule','status','5451190swfzaM','/operations/','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Unknown\x20error\x20from\x20Plisio\x20API','logWhiteDomainResponse','Business\x20Error:\x20','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','JSON\x20Parse\x20Error:\x20','Response\x20Time:','statusText','pending','apiUrl','name','Parsed\x20Result:','map','Raw\x20tx_urls\x20data:','../loggerService','success','fromEntries'];a44_0x4a33=function(){return _0x2bd656;};return a44_0x4a33();}class PlisioService{constructor(){const _0x8c444d=a44_0x3a4932;this[_0x8c444d(0x20e)]='https://api.plisio.net/api/v1/invoices/new',this['apiKey']=process[_0x8c444d(0x249)][_0x8c444d(0x1ed)]||'',!this[_0x8c444d(0x242)]?console[_0x8c444d(0x1e8)](_0x8c444d(0x248)):console[_0x8c444d(0x247)](_0x8c444d(0x241));}async['createPayment'](_0x2968ca){const _0x4d51a5=a44_0x3a4932,{orderId:_0x208896,amount:_0x4c6262,currency:_0x1cc10b,productName:_0x4b3069,description:_0xec8c58,successUrl:_0x424dc7,failUrl:_0x503615,customerEmail:_0x5c1b3c,customerName:_0x54d2be,isSourceCurrency:_0x3ae8b9,sourceCurrency:_0x11d208}=_0x2968ca;if(!this[_0x4d51a5(0x242)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x5c15a6=new URLSearchParams({'api_key':this[_0x4d51a5(0x242)],'order_number':_0x208896,'order_name':_0x4b3069,'description':_0xec8c58,'success_url':_0x424dc7,'fail_url':_0x503615,'callback_url':_0x4d51a5(0x25f)});_0x11d208?(_0x5c15a6[_0x4d51a5(0x24e)]('currency',_0x11d208),_0x5c15a6['append']('source_currency',_0x1cc10b),_0x5c15a6[_0x4d51a5(0x24e)](_0x4d51a5(0x1f0),_0x4c6262['toString']())):(_0x5c15a6[_0x4d51a5(0x24e)](_0x4d51a5(0x23b),_0x1cc10b),_0x5c15a6[_0x4d51a5(0x24e)](_0x4d51a5(0x257),_0x4c6262[_0x4d51a5(0x252)]()));_0x5c1b3c&&_0x5c15a6[_0x4d51a5(0x24e)](_0x4d51a5(0x226),_0x5c1b3c);_0x54d2be&&_0x5c15a6['append'](_0x4d51a5(0x20f),_0x54d2be);const _0x1ceb5d=this[_0x4d51a5(0x20e)]+'?'+_0x5c15a6[_0x4d51a5(0x252)](),_0x1da803=Date[_0x4d51a5(0x1ee)]();try{console[_0x4d51a5(0x247)](_0x4d51a5(0x1f3)),console['log'](_0x4d51a5(0x222),this['apiUrl']),console[_0x4d51a5(0x247)](_0x4d51a5(0x23d),Object[_0x4d51a5(0x215)](_0x5c15a6[_0x4d51a5(0x239)]())),console[_0x4d51a5(0x247)]('Full\x20URL\x20(without\x20API\x20key):',_0x1ceb5d[_0x4d51a5(0x1fa)](this[_0x4d51a5(0x242)],_0x4d51a5(0x1f2))),loggerService_1[_0x4d51a5(0x231)][_0x4d51a5(0x237)]('plisio_direct',_0x4d51a5(0x255),_0x4d51a5(0x23e),Object[_0x4d51a5(0x215)](_0x5c15a6['entries']()));const _0x270c8d=await fetch(_0x1ceb5d,{'method':'GET','headers':{'Accept':_0x4d51a5(0x220),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x4f5a25=Date[_0x4d51a5(0x1ee)]()-_0x1da803;console['log']('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x4d51a5(0x247)](_0x4d51a5(0x244),_0x270c8d[_0x4d51a5(0x202)]),console[_0x4d51a5(0x247)]('Status\x20Text:',_0x270c8d[_0x4d51a5(0x20c)]),console['log'](_0x4d51a5(0x20b),_0x4f5a25+'ms');const _0x1f9e4d=await _0x270c8d[_0x4d51a5(0x238)]();console['log']('Raw\x20Response\x20Body:',_0x1f9e4d);if(!_0x270c8d['ok']){console[_0x4d51a5(0x230)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x4d51a5(0x230)](_0x4d51a5(0x233),_0x270c8d[_0x4d51a5(0x202)]),console['error'](_0x4d51a5(0x1fc),_0x1f9e4d),loggerService_1['loggerService'][_0x4d51a5(0x207)](_0x4d51a5(0x25c),_0x4d51a5(0x255),_0x270c8d[_0x4d51a5(0x202)],_0x1f9e4d,_0x4f5a25),loggerService_1[_0x4d51a5(0x231)][_0x4d51a5(0x235)]('plisio_direct',_0x4d51a5(0x255),_0x4d51a5(0x254)+_0x270c8d[_0x4d51a5(0x202)]+':\x20'+_0x1f9e4d);throw new Error(_0x4d51a5(0x1f9)+_0x270c8d[_0x4d51a5(0x202)]+',\x20body:\x20'+_0x1f9e4d);}let _0xbb374b;try{_0xbb374b=JSON[_0x4d51a5(0x22b)](_0x1f9e4d);}catch(_0xb19496){console['error'](_0x4d51a5(0x25b),_0xb19496),loggerService_1[_0x4d51a5(0x231)][_0x4d51a5(0x235)](_0x4d51a5(0x25c),'/invoices/new',_0x4d51a5(0x20a)+_0xb19496);throw new Error(_0x4d51a5(0x23f)+_0x1f9e4d);}console[_0x4d51a5(0x247)](_0x4d51a5(0x25d)),console[_0x4d51a5(0x247)](_0x4d51a5(0x210),JSON['stringify'](_0xbb374b,null,0x2)),loggerService_1[_0x4d51a5(0x231)]['logWhiteDomainResponse'](_0x4d51a5(0x25c),_0x4d51a5(0x255),_0x270c8d['status'],_0xbb374b,_0x4f5a25);if(_0xbb374b['status']!==_0x4d51a5(0x214)){const _0x4ba4ca=_0xbb374b[_0x4d51a5(0x227)]||_0xbb374b['error']||_0x4d51a5(0x206);console[_0x4d51a5(0x230)](_0x4d51a5(0x232)),console['error'](_0x4d51a5(0x258),_0x4ba4ca),loggerService_1[_0x4d51a5(0x231)][_0x4d51a5(0x235)]('plisio_direct',_0x4d51a5(0x255),_0x4d51a5(0x208)+_0x4ba4ca);throw new Error(_0x4d51a5(0x1fe)+_0x4ba4ca);}if(!_0xbb374b[_0x4d51a5(0x25a)]?.[_0x4d51a5(0x21c)]||!_0xbb374b[_0x4d51a5(0x25a)]?.[_0x4d51a5(0x224)]){console[_0x4d51a5(0x230)](_0x4d51a5(0x22d)),console[_0x4d51a5(0x230)](_0x4d51a5(0x24b)),console[_0x4d51a5(0x230)]('Response\x20data:',_0xbb374b[_0x4d51a5(0x25a)]),loggerService_1[_0x4d51a5(0x231)][_0x4d51a5(0x235)](_0x4d51a5(0x25c),_0x4d51a5(0x255),_0x4d51a5(0x209));throw new Error(_0x4d51a5(0x24c));}return console['log'](_0x4d51a5(0x1f8)),console[_0x4d51a5(0x247)](_0x4d51a5(0x21e),_0xbb374b[_0x4d51a5(0x25a)][_0x4d51a5(0x21c)]),console[_0x4d51a5(0x247)](_0x4d51a5(0x21a),_0xbb374b[_0x4d51a5(0x25a)]['invoice_url']),console[_0x4d51a5(0x247)](_0x4d51a5(0x1f4),_0x4c6262,_0x1cc10b),_0x11d208&&(console[_0x4d51a5(0x247)](_0x4d51a5(0x240),_0x11d208,_0x4d51a5(0x1f7)),console['log']('Target\x20Currency:',_0x1cc10b,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0xbb374b[_0x4d51a5(0x25a)][_0x4d51a5(0x21c)],'payment_url':_0xbb374b[_0x4d51a5(0x25a)][_0x4d51a5(0x224)],'invoice_total_sum':_0xbb374b[_0x4d51a5(0x25a)][_0x4d51a5(0x21f)],'qr_code':_0xbb374b[_0x4d51a5(0x25a)][_0x4d51a5(0x1f6)],'qr_url':_0xbb374b['data'][_0x4d51a5(0x1e9)]};}catch(_0x406c6c){console[_0x4d51a5(0x230)](_0x4d51a5(0x205)),console[_0x4d51a5(0x230)]('Error\x20details:',_0x406c6c),loggerService_1[_0x4d51a5(0x231)][_0x4d51a5(0x235)](_0x4d51a5(0x25c),'/invoices/new',_0x406c6c);if(_0x406c6c instanceof Error){console[_0x4d51a5(0x230)]('Error\x20message:',_0x406c6c[_0x4d51a5(0x227)]),console['error']('Error\x20stack:',_0x406c6c['stack']);throw new Error(_0x4d51a5(0x236)+_0x406c6c[_0x4d51a5(0x227)]);}throw new Error(_0x4d51a5(0x24a));}}async['verifyPayment'](_0x34063c){const _0x2365b3=a44_0x3a4932,_0x526146=Date[_0x2365b3(0x1ee)]();try{if(!this['apiKey'])throw new Error(_0x2365b3(0x1ff));const _0x2c89f9=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x34063c}),_0x48358a=_0x2365b3(0x23c)+_0x34063c+'?'+_0x2c89f9[_0x2365b3(0x252)]();loggerService_1[_0x2365b3(0x231)][_0x2365b3(0x237)](_0x2365b3(0x25c),'/operations/'+_0x34063c,_0x2365b3(0x23e),Object['fromEntries'](_0x2c89f9[_0x2365b3(0x239)]()));const _0x358456=await fetch(_0x48358a,{'method':_0x2365b3(0x23e),'headers':{'Accept':_0x2365b3(0x220),'User-Agent':_0x2365b3(0x1fd)}}),_0x2ec8b3=Date[_0x2365b3(0x1ee)]()-_0x526146;if(!_0x358456['ok']){const _0x1db92e=await _0x358456[_0x2365b3(0x238)]();loggerService_1[_0x2365b3(0x231)][_0x2365b3(0x207)](_0x2365b3(0x25c),_0x2365b3(0x204)+_0x34063c,_0x358456['status'],_0x1db92e,_0x2ec8b3);throw new Error(_0x2365b3(0x1f9)+_0x358456[_0x2365b3(0x202)]);}const _0x5597b3=await _0x358456['json']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2365b3(0x25c),'/operations/'+_0x34063c,_0x358456['status'],_0x5597b3,_0x2ec8b3);if(_0x5597b3[_0x2365b3(0x202)]!==_0x2365b3(0x214)){loggerService_1[_0x2365b3(0x231)][_0x2365b3(0x235)](_0x2365b3(0x25c),_0x2365b3(0x204)+_0x34063c,'Plisio\x20API\x20error:\x20'+(_0x5597b3[_0x2365b3(0x227)]||_0x5597b3[_0x2365b3(0x230)]||'Unknown\x20error'));throw new Error('Plisio\x20API\x20error:\x20'+(_0x5597b3['message']||_0x5597b3['error']||_0x2365b3(0x218)));}let _0x315c14=_0x2365b3(0x1fb);return{'status':_0x315c14};}catch(_0x28c098){console[_0x2365b3(0x230)](_0x2365b3(0x243),_0x28c098),loggerService_1[_0x2365b3(0x231)][_0x2365b3(0x235)]('plisio_direct','/operations/'+_0x34063c,_0x28c098);throw new Error(_0x2365b3(0x1f1)+(_0x28c098 instanceof Error?_0x28c098[_0x2365b3(0x227)]:'Unknown\x20error'));}}async[a44_0x3a4932(0x22e)](_0x127eab){const _0x540279=a44_0x3a4932;console[_0x540279(0x247)](_0x540279(0x22a),_0x127eab);let _0x326ad5=_0x540279(0x1fb);switch(_0x127eab[_0x540279(0x202)]?.[_0x540279(0x217)]()){case _0x540279(0x253):case _0x540279(0x221):_0x326ad5=_0x540279(0x223);break;case _0x540279(0x251):_0x326ad5='EXPIRED';break;case'error':case _0x540279(0x256):_0x326ad5=_0x540279(0x24f);break;case'new':case _0x540279(0x20d):default:_0x326ad5='PENDING';break;}let _0x44ea65;if(_0x127eab[_0x540279(0x1eb)])try{console['log'](_0x540279(0x23a),_0x127eab['tx_urls']);let _0x40f710;if(typeof _0x127eab[_0x540279(0x1eb)]===_0x540279(0x219))_0x40f710=JSON['parse'](_0x127eab[_0x540279(0x1eb)]);else Array['isArray'](_0x127eab['tx_urls'])?_0x40f710=_0x127eab['tx_urls']:_0x40f710=[];_0x44ea65=_0x40f710[_0x540279(0x211)](_0x5e2e24=>{const _0x4effd5=_0x540279,_0x23c2f7=_0x5e2e24['replace'](/\\/g,'');return console['log']('üîó\x20Formatted\x20URL:\x20'+_0x5e2e24+_0x4effd5(0x216)+_0x23c2f7),_0x23c2f7;}),console[_0x540279(0x247)](_0x540279(0x228),_0x44ea65),_0x44ea65['forEach']((_0x5ea471,_0x1ff208)=>{const _0x3cd063=_0x540279;try{new URL(_0x5ea471),console[_0x3cd063(0x247)](_0x3cd063(0x1ec)+(_0x1ff208+0x1)+_0x3cd063(0x1ea)+_0x5ea471);}catch(_0x5321f7){console['error']('‚ùå\x20URL\x20'+(_0x1ff208+0x1)+_0x3cd063(0x24d)+_0x5ea471,_0x5321f7);}});}catch(_0xd47d2a){console[_0x540279(0x230)](_0x540279(0x200),_0xd47d2a),console[_0x540279(0x230)](_0x540279(0x212),_0x127eab[_0x540279(0x1eb)]),_0x44ea65=undefined;}return{'paymentId':_0x127eab[_0x540279(0x1f5)]||'','status':_0x326ad5,'amount':_0x127eab['amount'],'currency':_0x127eab['currency'],'txUrls':_0x44ea65};}}exports[a44_0x3a4932(0x25e)]=PlisioService;