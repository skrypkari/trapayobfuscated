'use strict';const a41_0x32fd8e=a41_0xa714;(function(_0x25e58c,_0x36174c){const _0x191776=a41_0xa714,_0x353bfb=_0x25e58c();while(!![]){try{const _0x546040=parseInt(_0x191776(0x118))/0x1+-parseInt(_0x191776(0x134))/0x2+-parseInt(_0x191776(0x10c))/0x3+-parseInt(_0x191776(0x135))/0x4+parseInt(_0x191776(0x112))/0x5*(-parseInt(_0x191776(0x128))/0x6)+parseInt(_0x191776(0x130))/0x7+-parseInt(_0x191776(0x121))/0x8*(-parseInt(_0x191776(0xfd))/0x9);if(_0x546040===_0x36174c)break;else _0x353bfb['push'](_0x353bfb['shift']());}catch(_0x5dfaff){_0x353bfb['push'](_0x353bfb['shift']());}}}(a41_0x2b8b,0x66d3e));function a41_0xa714(_0x4085af,_0x37ce72){const _0x2b8bc5=a41_0x2b8b();return a41_0xa714=function(_0xa7149c,_0x499307){_0xa7149c=_0xa7149c-0xf9;let _0x42ffe6=_0x2b8bc5[_0xa7149c];return _0x42ffe6;},a41_0xa714(_0x4085af,_0x37ce72);}Object[a41_0x32fd8e(0x10e)](exports,'__esModule',{'value':!![]}),exports[a41_0x32fd8e(0x143)]=void 0x0;const loggerService_1=require(a41_0x32fd8e(0x16b));class PlisioService{constructor(){const _0x13af4c=a41_0x32fd8e;this[_0x13af4c(0x14a)]=_0x13af4c(0x10b),this[_0x13af4c(0x13b)]=process[_0x13af4c(0x10f)][_0x13af4c(0x12a)]||'',!this[_0x13af4c(0x13b)]?console['warn'](_0x13af4c(0xfe)):console[_0x13af4c(0x155)](_0x13af4c(0x102));}async['createPayment'](_0x385594){const _0x4a0de2=a41_0x32fd8e,{orderId:_0x3027a8,amount:_0x563f8c,currency:_0x3c843e,productName:_0x436b0c,description:_0x3deb80,successUrl:_0x356720,failUrl:_0x453647,customerEmail:_0x4fce8c,customerName:_0x4da7f3,isSourceCurrency:_0x4e424f,sourceCurrency:_0xafa079}=_0x385594;if(!this[_0x4a0de2(0x13b)])throw new Error(_0x4a0de2(0x110));const _0x1e6a3b=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x3027a8,'order_name':_0x436b0c,'description':_0x3deb80,'success_url':_0x356720,'fail_url':_0x453647,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0xafa079?(_0x1e6a3b[_0x4a0de2(0x14e)](_0x4a0de2(0x122),_0xafa079),_0x1e6a3b['append'](_0x4a0de2(0x132),_0x3c843e),_0x1e6a3b[_0x4a0de2(0x14e)](_0x4a0de2(0x158),_0x563f8c[_0x4a0de2(0x15e)]())):(_0x1e6a3b[_0x4a0de2(0x14e)](_0x4a0de2(0x122),_0x3c843e),_0x1e6a3b[_0x4a0de2(0x14e)](_0x4a0de2(0x13a),_0x563f8c['toString']()));_0x4fce8c&&_0x1e6a3b[_0x4a0de2(0x14e)]('email',_0x4fce8c);_0x4da7f3&&_0x1e6a3b['append'](_0x4a0de2(0x148),_0x4da7f3);const _0x100be5=this[_0x4a0de2(0x14a)]+'?'+_0x1e6a3b[_0x4a0de2(0x15e)](),_0x26ab55=Date['now']();try{console['log'](_0x4a0de2(0x13e)),console['log']('URL:',this['apiUrl']),console['log'](_0x4a0de2(0x12c),Object['fromEntries'](_0x1e6a3b[_0x4a0de2(0x15c)]())),console[_0x4a0de2(0x155)](_0x4a0de2(0x111),_0x100be5[_0x4a0de2(0x153)](this[_0x4a0de2(0x13b)],_0x4a0de2(0x14c))),loggerService_1[_0x4a0de2(0x114)][_0x4a0de2(0x127)](_0x4a0de2(0x140),'/invoices/new',_0x4a0de2(0x149),Object[_0x4a0de2(0x16a)](_0x1e6a3b[_0x4a0de2(0x15c)]()));const _0x566f0d=await fetch(_0x100be5,{'method':_0x4a0de2(0x149),'headers':{'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x531817=Date['now']()-_0x26ab55;console['log'](_0x4a0de2(0x10a)),console[_0x4a0de2(0x155)](_0x4a0de2(0x12b),_0x566f0d[_0x4a0de2(0x147)]),console[_0x4a0de2(0x155)](_0x4a0de2(0x11a),_0x566f0d['statusText']),console[_0x4a0de2(0x155)](_0x4a0de2(0x146),_0x531817+'ms');const _0x1f820f=await _0x566f0d[_0x4a0de2(0x12f)]();console[_0x4a0de2(0x155)](_0x4a0de2(0x144),_0x1f820f);if(!_0x566f0d['ok']){console[_0x4a0de2(0x138)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x566f0d[_0x4a0de2(0x147)]),console['error'](_0x4a0de2(0x13d),_0x1f820f),loggerService_1['loggerService'][_0x4a0de2(0x126)](_0x4a0de2(0x140),_0x4a0de2(0x13c),_0x566f0d['status'],_0x1f820f,_0x531817),loggerService_1[_0x4a0de2(0x114)][_0x4a0de2(0x16c)]('plisio_direct','/invoices/new',_0x4a0de2(0xf9)+_0x566f0d[_0x4a0de2(0x147)]+':\x20'+_0x1f820f);throw new Error(_0x4a0de2(0x139)+_0x566f0d[_0x4a0de2(0x147)]+_0x4a0de2(0x11d)+_0x1f820f);}let _0x2103a7;try{_0x2103a7=JSON['parse'](_0x1f820f);}catch(_0x25871f){console[_0x4a0de2(0x138)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x25871f),loggerService_1['loggerService'][_0x4a0de2(0x16c)](_0x4a0de2(0x140),_0x4a0de2(0x13c),_0x4a0de2(0x14b)+_0x25871f);throw new Error(_0x4a0de2(0x12d)+_0x1f820f);}console[_0x4a0de2(0x155)](_0x4a0de2(0x13f)),console['log'](_0x4a0de2(0x115),JSON[_0x4a0de2(0x150)](_0x2103a7,null,0x2)),loggerService_1[_0x4a0de2(0x114)][_0x4a0de2(0x126)](_0x4a0de2(0x140),'/invoices/new',_0x566f0d[_0x4a0de2(0x147)],_0x2103a7,_0x531817);if(_0x2103a7['status']!==_0x4a0de2(0x100)){const _0x203c2c=_0x2103a7[_0x4a0de2(0x101)]||_0x2103a7['error']||_0x4a0de2(0x11b);console['error']('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x4a0de2(0x138)](_0x4a0de2(0x10d),_0x203c2c),loggerService_1[_0x4a0de2(0x114)][_0x4a0de2(0x16c)](_0x4a0de2(0x140),_0x4a0de2(0x13c),_0x4a0de2(0x15a)+_0x203c2c);throw new Error('Plisio\x20API\x20error:\x20'+_0x203c2c);}if(!_0x2103a7[_0x4a0de2(0x15d)]?.[_0x4a0de2(0x120)]||!_0x2103a7[_0x4a0de2(0x15d)]?.[_0x4a0de2(0x15b)]){console[_0x4a0de2(0x138)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x4a0de2(0x138)](_0x4a0de2(0x156),_0x2103a7['data']),loggerService_1[_0x4a0de2(0x114)][_0x4a0de2(0x16c)](_0x4a0de2(0x140),'/invoices/new',_0x4a0de2(0x157));throw new Error(_0x4a0de2(0x12e));}return console[_0x4a0de2(0x155)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x4a0de2(0x155)](_0x4a0de2(0x11e),_0x2103a7[_0x4a0de2(0x15d)][_0x4a0de2(0x120)]),console[_0x4a0de2(0x155)]('Invoice\x20URL:',_0x2103a7[_0x4a0de2(0x15d)][_0x4a0de2(0x15b)]),console['log'](_0x4a0de2(0x11f),_0x563f8c,_0x3c843e),_0xafa079&&(console[_0x4a0de2(0x155)](_0x4a0de2(0x162),_0xafa079,'(crypto\x20for\x20payment)'),console[_0x4a0de2(0x155)]('Target\x20Currency:',_0x3c843e,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x2103a7['data']['txn_id'],'payment_url':_0x2103a7['data']['invoice_url'],'invoice_total_sum':_0x2103a7[_0x4a0de2(0x15d)][_0x4a0de2(0x168)],'qr_code':_0x2103a7[_0x4a0de2(0x15d)]['qr_code'],'qr_url':_0x2103a7[_0x4a0de2(0x15d)][_0x4a0de2(0x14f)]};}catch(_0x3805b2){console['error'](_0x4a0de2(0x117)),console[_0x4a0de2(0x138)](_0x4a0de2(0x125),_0x3805b2),loggerService_1[_0x4a0de2(0x114)][_0x4a0de2(0x16c)](_0x4a0de2(0x140),'/invoices/new',_0x3805b2);if(_0x3805b2 instanceof Error){console[_0x4a0de2(0x138)]('Error\x20message:',_0x3805b2[_0x4a0de2(0x101)]),console[_0x4a0de2(0x138)](_0x4a0de2(0x136),_0x3805b2[_0x4a0de2(0x119)]);throw new Error(_0x4a0de2(0x154)+_0x3805b2['message']);}throw new Error(_0x4a0de2(0x14d));}}async[a41_0x32fd8e(0x123)](_0x4669b9){const _0x58dbcc=a41_0x32fd8e,_0x564001=Date[_0x58dbcc(0x133)]();try{if(!this[_0x58dbcc(0x13b)])throw new Error(_0x58dbcc(0x110));const _0x421364=new URLSearchParams({'api_key':this[_0x58dbcc(0x13b)],'txn_id':_0x4669b9}),_0x238ebd='https://api.plisio.net/api/v1/operations/'+_0x4669b9+'?'+_0x421364[_0x58dbcc(0x15e)]();loggerService_1[_0x58dbcc(0x114)]['logWhiteDomainRequest'](_0x58dbcc(0x140),'/operations/'+_0x4669b9,_0x58dbcc(0x149),Object[_0x58dbcc(0x16a)](_0x421364[_0x58dbcc(0x15c)]()));const _0x507af5=await fetch(_0x238ebd,{'method':'GET','headers':{'Accept':_0x58dbcc(0x106),'User-Agent':_0x58dbcc(0x107)}}),_0x5594e0=Date['now']()-_0x564001;if(!_0x507af5['ok']){const _0x511f5e=await _0x507af5[_0x58dbcc(0x12f)]();loggerService_1[_0x58dbcc(0x114)][_0x58dbcc(0x126)]('plisio_direct','/operations/'+_0x4669b9,_0x507af5[_0x58dbcc(0x147)],_0x511f5e,_0x5594e0);throw new Error(_0x58dbcc(0x139)+_0x507af5[_0x58dbcc(0x147)]);}const _0x221e77=await _0x507af5[_0x58dbcc(0x152)]();loggerService_1[_0x58dbcc(0x114)][_0x58dbcc(0x126)](_0x58dbcc(0x140),_0x58dbcc(0x145)+_0x4669b9,_0x507af5[_0x58dbcc(0x147)],_0x221e77,_0x5594e0);if(_0x221e77['status']!==_0x58dbcc(0x100)){loggerService_1[_0x58dbcc(0x114)][_0x58dbcc(0x16c)](_0x58dbcc(0x140),_0x58dbcc(0x145)+_0x4669b9,_0x58dbcc(0x131)+(_0x221e77[_0x58dbcc(0x101)]||_0x221e77[_0x58dbcc(0x138)]||_0x58dbcc(0xfa)));throw new Error(_0x58dbcc(0x131)+(_0x221e77[_0x58dbcc(0x101)]||_0x221e77[_0x58dbcc(0x138)]||_0x58dbcc(0xfa)));}let _0x6d8053='PENDING';return{'status':_0x6d8053};}catch(_0x387324){console[_0x58dbcc(0x138)](_0x58dbcc(0x103),_0x387324),loggerService_1['loggerService'][_0x58dbcc(0x16c)](_0x58dbcc(0x140),'/operations/'+_0x4669b9,_0x387324);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x387324 instanceof Error?_0x387324[_0x58dbcc(0x101)]:_0x58dbcc(0xfa)));}}async[a41_0x32fd8e(0x15f)](_0x1c74d2){const _0x38bf02=a41_0x32fd8e;console[_0x38bf02(0x155)](_0x38bf02(0x163),_0x1c74d2);let _0x43de08=_0x38bf02(0x142);switch(_0x1c74d2['status']?.[_0x38bf02(0xfc)]()){case _0x38bf02(0x169):case'mismatch':_0x43de08=_0x38bf02(0x108);break;case'expired':_0x43de08='EXPIRED';break;case _0x38bf02(0x138):case _0x38bf02(0x11c):_0x43de08=_0x38bf02(0x124);break;case _0x38bf02(0x113):case _0x38bf02(0x160):default:_0x43de08=_0x38bf02(0x142);break;}let _0x4dffa2;if(_0x1c74d2['tx_urls'])try{console['log'](_0x38bf02(0x129),_0x1c74d2[_0x38bf02(0x116)]);let _0x16d2ac;if(typeof _0x1c74d2[_0x38bf02(0x116)]===_0x38bf02(0x164))_0x16d2ac=JSON[_0x38bf02(0x159)](_0x1c74d2[_0x38bf02(0x116)]);else Array[_0x38bf02(0x109)](_0x1c74d2['tx_urls'])?_0x16d2ac=_0x1c74d2[_0x38bf02(0x116)]:_0x16d2ac=[];_0x4dffa2=_0x16d2ac[_0x38bf02(0xfb)](_0x261e05=>{const _0x1d358d=_0x38bf02,_0x387e3f=_0x261e05[_0x1d358d(0x153)](/\\/g,'');return console[_0x1d358d(0x155)](_0x1d358d(0x165)+_0x261e05+_0x1d358d(0xff)+_0x387e3f),_0x387e3f;}),console[_0x38bf02(0x155)](_0x38bf02(0x105),_0x4dffa2),_0x4dffa2[_0x38bf02(0x104)]((_0x531237,_0x241d4a)=>{const _0x1bc3cb=_0x38bf02;try{new URL(_0x531237),console[_0x1bc3cb(0x155)]('‚úÖ\x20URL\x20'+(_0x241d4a+0x1)+_0x1bc3cb(0x151)+_0x531237);}catch(_0x5e05e5){console[_0x1bc3cb(0x138)](_0x1bc3cb(0x137)+(_0x241d4a+0x1)+_0x1bc3cb(0x166)+_0x531237,_0x5e05e5);}});}catch(_0x5a826b){console[_0x38bf02(0x138)](_0x38bf02(0x141),_0x5a826b),console['error'](_0x38bf02(0x161),_0x1c74d2[_0x38bf02(0x116)]),_0x4dffa2=undefined;}return{'paymentId':_0x1c74d2[_0x38bf02(0x167)]||'','status':_0x43de08,'amount':_0x1c74d2[_0x38bf02(0x13a)],'currency':_0x1c74d2[_0x38bf02(0x122)],'txUrls':_0x4dffa2};}}function a41_0x2b8b(){const _0x5065e5=['pending','Raw\x20tx_urls\x20data:','Source\x20Currency:','Processing\x20Plisio\x20webhook:','string','üîó\x20Formatted\x20URL:\x20','\x20is\x20invalid:\x20','order_number','invoice_total_sum','completed','fromEntries','../loggerService','logWhiteDomainError','HTTP\x20','Unknown\x20error','map','toLowerCase','639XYIHyq','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','\x20->\x20','success','message','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Plisio\x20payment\x20verification\x20error:','forEach','‚úÖ\x20Processed\x20tx_urls:','application/json','TesSoft\x20Payment\x20System/1.0','PAID','isArray','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','https://api.plisio.net/api/v1/invoices/new','1035870OmOfQt','Error\x20Message:','defineProperty','env','Plisio\x20API\x20key\x20is\x20not\x20configured','Full\x20URL\x20(without\x20API\x20key):','5CUVosw','new','loggerService','Parsed\x20Result:','tx_urls','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','656575qKbqEa','stack','Status\x20Text:','Unknown\x20error\x20from\x20Plisio\x20API','cancelled',',\x20body:\x20','Transaction\x20ID:','Amount:','txn_id','62184bBiiAK','currency','verifyPayment','FAILED','Error\x20details:','logWhiteDomainResponse','logWhiteDomainRequest','68718UwjbYZ','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','PLISIO_API_KEY','Status:','Parameters:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','text','5610416eFSVFM','Plisio\x20API\x20error:\x20','source_currency','now','847998bqIRRh','3232088EuhRjY','Error\x20stack:','‚ùå\x20URL\x20','error','HTTP\x20error!\x20status:\x20','amount','apiKey','/invoices/new','Response\x20Body:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','plisio_direct','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','PENDING','PlisioService','Raw\x20Response\x20Body:','/operations/','Response\x20Time:','status','name','GET','apiUrl','JSON\x20Parse\x20Error:\x20','HIDDEN','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','append','qr_url','stringify','\x20is\x20valid:\x20','json','replace','Failed\x20to\x20create\x20Plisio\x20payment:\x20','log','Response\x20data:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','source_amount','parse','Business\x20Error:\x20','invoice_url','entries','data','toString','processWebhook'];a41_0x2b8b=function(){return _0x5065e5;};return a41_0x2b8b();}exports[a41_0x32fd8e(0x143)]=PlisioService;