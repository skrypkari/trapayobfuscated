'use strict';const a51_0x58c9ac=a51_0x5467;(function(_0x5c7e45,_0x5706d6){const _0x3caf0b=a51_0x5467,_0x17b739=_0x5c7e45();while(!![]){try{const _0x4c3599=parseInt(_0x3caf0b(0x1dd))/0x1*(-parseInt(_0x3caf0b(0x222))/0x2)+parseInt(_0x3caf0b(0x1fa))/0x3*(-parseInt(_0x3caf0b(0x1d7))/0x4)+-parseInt(_0x3caf0b(0x200))/0x5+-parseInt(_0x3caf0b(0x206))/0x6*(-parseInt(_0x3caf0b(0x238))/0x7)+parseInt(_0x3caf0b(0x212))/0x8+parseInt(_0x3caf0b(0x1f5))/0x9*(parseInt(_0x3caf0b(0x1e5))/0xa)+parseInt(_0x3caf0b(0x21e))/0xb;if(_0x4c3599===_0x5706d6)break;else _0x17b739['push'](_0x17b739['shift']());}catch(_0x5a90d2){_0x17b739['push'](_0x17b739['shift']());}}}(a51_0x15b0,0xe8d1d));Object[a51_0x58c9ac(0x20f)](exports,'__esModule',{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a51_0x58c9ac(0x246));function a51_0x15b0(){const _0x2229f8=['mismatch','HTTP\x20error!\x20status:\x20','../loggerService','Plisio\x20payment\x20verification\x20error:','toString','8348vdlSLi','Response\x20Time:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','entries','PENDING','stringify','1xjLzpx','append','Transaction\x20ID:','===\x20PLISIO\x20API\x20ERROR\x20===','Raw\x20tx_urls\x20data:','‚úÖ\x20Processed\x20tx_urls:',',\x20body:\x20','email','150gsbGga','Processing\x20Plisio\x20webhook:','order_number','createPayment','PROCESSING','https://api.plisio.net/api/v1/invoices/new','string','data','new','map','txn_id','Invoice\x20URL:','invoice_total_sum','application/json','/invoices/new','logWhiteDomainResponse','1068930qQKMPt','Payment\x20System/1.0','URL:','===\x20PLISIO\x20SUCCESS\x20===','plisio_direct','2001LFxGog','Error\x20Message:','error','Plisio\x20API\x20error:\x20','Error\x20stack:','Error\x20message:','7745070usbKjw','Target\x20Currency:','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','üîó\x20Formatted\x20URL:\x20','HIDDEN','354UelhyY','apiUrl','tx_urls','apiKey','PlisioService','HTTP\x20Status:','completed','isArray','FAILED','defineProperty','pending','logWhiteDomainError','11182984Tvyjyh','loggerService','EXPIRED','fromEntries','Source\x20Currency:','https://api.trapay.uk/api/webhooks/gateway/plisio','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','amount','message','invoice_url','logWhiteDomainRequest','GET','16584425KZybDJ','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Full\x20URL\x20(without\x20API\x20key):','log','1633822XCAAvz','Amount:','Raw\x20Response\x20Body:','expired','Unknown\x20error\x20from\x20Plisio\x20API','text','currency','source_amount','JSON\x20Parse\x20Error:\x20','(fiat\x20for\x20merchant)','Status\x20Text:','source_currency','‚ùå\x20URL\x20','status','stack','now','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','parse','Unknown\x20error','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','2905oNnexi','forEach','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','PAID','name','success','Parsed\x20Result:','(crypto\x20for\x20payment)','/operations/','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','qr_url','verifyPayment'];a51_0x15b0=function(){return _0x2229f8;};return a51_0x15b0();}function a51_0x5467(_0x4341b7,_0x407c55){const _0x15b07a=a51_0x15b0();return a51_0x5467=function(_0x5467c9,_0x35c3a6){_0x5467c9=_0x5467c9-0x1d5;let _0x3327f=_0x15b07a[_0x5467c9];return _0x3327f;},a51_0x5467(_0x4341b7,_0x407c55);}class PlisioService{constructor(){const _0x184b43=a51_0x58c9ac;this[_0x184b43(0x207)]=_0x184b43(0x1ea),this[_0x184b43(0x209)]=process['env']['PLISIO_API_KEY']||'',!this['apiKey']?console['warn'](_0x184b43(0x232)):console['log'](_0x184b43(0x21f));}async[a51_0x58c9ac(0x1e8)](_0x2556e9){const _0x5ea4c7=a51_0x58c9ac,{orderId:_0x3657a7,amount:_0x42bfc7,currency:_0x2e22dd,productName:_0x5915cd,description:_0xf8cefd,successUrl:_0x552175,failUrl:_0x1826f4,customerEmail:_0x30a559,customerName:_0x410c31,isSourceCurrency:_0x2535b1,sourceCurrency:_0x4931e7}=_0x2556e9;if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0xa84a82=new URLSearchParams({'api_key':this[_0x5ea4c7(0x209)],'order_number':_0x3657a7,'order_name':_0x5915cd,'description':_0xf8cefd,'success_url':_0x552175,'fail_url':_0x1826f4,'callback_url':_0x5ea4c7(0x217)});_0x4931e7?(_0xa84a82[_0x5ea4c7(0x1de)](_0x5ea4c7(0x228),_0x4931e7),_0xa84a82['append'](_0x5ea4c7(0x22d),_0x2e22dd),_0xa84a82[_0x5ea4c7(0x1de)](_0x5ea4c7(0x229),_0x42bfc7[_0x5ea4c7(0x1d6)]())):(_0xa84a82[_0x5ea4c7(0x1de)]('currency',_0x2e22dd),_0xa84a82[_0x5ea4c7(0x1de)](_0x5ea4c7(0x219),_0x42bfc7['toString']()));_0x30a559&&_0xa84a82[_0x5ea4c7(0x1de)](_0x5ea4c7(0x1e4),_0x30a559);_0x410c31&&_0xa84a82[_0x5ea4c7(0x1de)](_0x5ea4c7(0x23c),_0x410c31);const _0x2c14f4=this[_0x5ea4c7(0x207)]+'?'+_0xa84a82[_0x5ea4c7(0x1d6)](),_0x2b74be=Date[_0x5ea4c7(0x231)]();try{console[_0x5ea4c7(0x221)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x5ea4c7(0x221)](_0x5ea4c7(0x1f7),this[_0x5ea4c7(0x207)]),console[_0x5ea4c7(0x221)]('Parameters:',Object[_0x5ea4c7(0x215)](_0xa84a82[_0x5ea4c7(0x1da)]())),console[_0x5ea4c7(0x221)](_0x5ea4c7(0x220),_0x2c14f4['replace'](this['apiKey'],_0x5ea4c7(0x205))),loggerService_1[_0x5ea4c7(0x213)][_0x5ea4c7(0x21c)](_0x5ea4c7(0x1f9),_0x5ea4c7(0x1f3),_0x5ea4c7(0x21d),Object['fromEntries'](_0xa84a82[_0x5ea4c7(0x1da)]()));const _0x5ef35f=await fetch(_0x2c14f4,{'method':'GET','headers':{'Accept':_0x5ea4c7(0x1f2),'User-Agent':'Payment\x20System/1.0'}}),_0x2ba570=Date['now']()-_0x2b74be;console[_0x5ea4c7(0x221)](_0x5ea4c7(0x233)),console['log']('Status:',_0x5ef35f[_0x5ea4c7(0x22f)]),console[_0x5ea4c7(0x221)](_0x5ea4c7(0x22c),_0x5ef35f['statusText']),console[_0x5ea4c7(0x221)](_0x5ea4c7(0x1d8),_0x2ba570+'ms');const _0x1a1469=await _0x5ef35f[_0x5ea4c7(0x227)]();console[_0x5ea4c7(0x221)](_0x5ea4c7(0x224),_0x1a1469);if(!_0x5ef35f['ok']){console[_0x5ea4c7(0x1fc)](_0x5ea4c7(0x1e0)),console[_0x5ea4c7(0x1fc)](_0x5ea4c7(0x20b),_0x5ef35f['status']),console['error']('Response\x20Body:',_0x1a1469),loggerService_1['loggerService'][_0x5ea4c7(0x1f4)](_0x5ea4c7(0x1f9),_0x5ea4c7(0x1f3),_0x5ef35f[_0x5ea4c7(0x22f)],_0x1a1469,_0x2ba570),loggerService_1['loggerService'][_0x5ea4c7(0x211)](_0x5ea4c7(0x1f9),_0x5ea4c7(0x1f3),'HTTP\x20'+_0x5ef35f[_0x5ea4c7(0x22f)]+':\x20'+_0x1a1469);throw new Error(_0x5ea4c7(0x245)+_0x5ef35f['status']+_0x5ea4c7(0x1e3)+_0x1a1469);}let _0x3992bd;try{_0x3992bd=JSON['parse'](_0x1a1469);}catch(_0x1c36a3){console[_0x5ea4c7(0x1fc)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x1c36a3),loggerService_1[_0x5ea4c7(0x213)]['logWhiteDomainError'](_0x5ea4c7(0x1f9),'/invoices/new',_0x5ea4c7(0x22a)+_0x1c36a3);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x1a1469);}console[_0x5ea4c7(0x221)](_0x5ea4c7(0x234)),console['log'](_0x5ea4c7(0x23e),JSON[_0x5ea4c7(0x1dc)](_0x3992bd,null,0x2)),loggerService_1[_0x5ea4c7(0x213)][_0x5ea4c7(0x1f4)](_0x5ea4c7(0x1f9),_0x5ea4c7(0x1f3),_0x5ef35f[_0x5ea4c7(0x22f)],_0x3992bd,_0x2ba570);if(_0x3992bd[_0x5ea4c7(0x22f)]!=='success'){const _0x28f4b3=_0x3992bd[_0x5ea4c7(0x21a)]||_0x3992bd[_0x5ea4c7(0x1fc)]||_0x5ea4c7(0x226);console[_0x5ea4c7(0x1fc)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x5ea4c7(0x1fc)](_0x5ea4c7(0x1fb),_0x28f4b3),loggerService_1['loggerService']['logWhiteDomainError'](_0x5ea4c7(0x1f9),'/invoices/new','Business\x20Error:\x20'+_0x28f4b3);throw new Error(_0x5ea4c7(0x1fd)+_0x28f4b3);}if(!_0x3992bd[_0x5ea4c7(0x1ec)]?.[_0x5ea4c7(0x1ef)]||!_0x3992bd[_0x5ea4c7(0x1ec)]?.[_0x5ea4c7(0x21b)]){console[_0x5ea4c7(0x1fc)](_0x5ea4c7(0x241)),console[_0x5ea4c7(0x1fc)](_0x5ea4c7(0x1d9)),console[_0x5ea4c7(0x1fc)]('Response\x20data:',_0x3992bd[_0x5ea4c7(0x1ec)]),loggerService_1['loggerService'][_0x5ea4c7(0x211)](_0x5ea4c7(0x1f9),_0x5ea4c7(0x1f3),_0x5ea4c7(0x237));throw new Error(_0x5ea4c7(0x23a));}return console[_0x5ea4c7(0x221)](_0x5ea4c7(0x1f8)),console[_0x5ea4c7(0x221)](_0x5ea4c7(0x1df),_0x3992bd['data'][_0x5ea4c7(0x1ef)]),console['log'](_0x5ea4c7(0x1f0),_0x3992bd[_0x5ea4c7(0x1ec)][_0x5ea4c7(0x21b)]),console[_0x5ea4c7(0x221)](_0x5ea4c7(0x223),_0x42bfc7,_0x2e22dd),_0x4931e7&&(console[_0x5ea4c7(0x221)](_0x5ea4c7(0x216),_0x4931e7,_0x5ea4c7(0x23f)),console[_0x5ea4c7(0x221)](_0x5ea4c7(0x201),_0x2e22dd,_0x5ea4c7(0x22b))),{'gateway_payment_id':_0x3992bd[_0x5ea4c7(0x1ec)][_0x5ea4c7(0x1ef)],'payment_url':_0x3992bd[_0x5ea4c7(0x1ec)][_0x5ea4c7(0x21b)],'invoice_total_sum':_0x3992bd[_0x5ea4c7(0x1ec)][_0x5ea4c7(0x1f1)],'qr_code':_0x3992bd['data']['qr_code'],'qr_url':_0x3992bd['data'][_0x5ea4c7(0x242)]};}catch(_0xc82abf){console[_0x5ea4c7(0x1fc)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x5ea4c7(0x1fc)]('Error\x20details:',_0xc82abf),loggerService_1[_0x5ea4c7(0x213)][_0x5ea4c7(0x211)](_0x5ea4c7(0x1f9),_0x5ea4c7(0x1f3),_0xc82abf);if(_0xc82abf instanceof Error){console[_0x5ea4c7(0x1fc)](_0x5ea4c7(0x1ff),_0xc82abf['message']),console[_0x5ea4c7(0x1fc)](_0x5ea4c7(0x1fe),_0xc82abf[_0x5ea4c7(0x230)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0xc82abf['message']);}throw new Error(_0x5ea4c7(0x218));}}async[a51_0x58c9ac(0x243)](_0x569c65){const _0x1ab676=a51_0x58c9ac,_0x324443=Date[_0x1ab676(0x231)]();try{if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x3a7f6e=new URLSearchParams({'api_key':this[_0x1ab676(0x209)],'txn_id':_0x569c65}),_0x2bfc29='https://api.plisio.net/api/v1/operations/'+_0x569c65+'?'+_0x3a7f6e[_0x1ab676(0x1d6)]();loggerService_1[_0x1ab676(0x213)][_0x1ab676(0x21c)](_0x1ab676(0x1f9),_0x1ab676(0x240)+_0x569c65,'GET',Object[_0x1ab676(0x215)](_0x3a7f6e[_0x1ab676(0x1da)]()));const _0x28ea85=await fetch(_0x2bfc29,{'method':_0x1ab676(0x21d),'headers':{'Accept':_0x1ab676(0x1f2),'User-Agent':_0x1ab676(0x1f6)}}),_0x1a98f2=Date[_0x1ab676(0x231)]()-_0x324443;if(!_0x28ea85['ok']){const _0x3c688e=await _0x28ea85['text']();loggerService_1[_0x1ab676(0x213)][_0x1ab676(0x1f4)]('plisio_direct',_0x1ab676(0x240)+_0x569c65,_0x28ea85[_0x1ab676(0x22f)],_0x3c688e,_0x1a98f2);throw new Error('HTTP\x20error!\x20status:\x20'+_0x28ea85[_0x1ab676(0x22f)]);}const _0x15cc98=await _0x28ea85['json']();loggerService_1[_0x1ab676(0x213)][_0x1ab676(0x1f4)]('plisio_direct',_0x1ab676(0x240)+_0x569c65,_0x28ea85[_0x1ab676(0x22f)],_0x15cc98,_0x1a98f2);if(_0x15cc98[_0x1ab676(0x22f)]!==_0x1ab676(0x23d)){loggerService_1['loggerService'][_0x1ab676(0x211)](_0x1ab676(0x1f9),_0x1ab676(0x240)+_0x569c65,'Plisio\x20API\x20error:\x20'+(_0x15cc98['message']||_0x15cc98['error']||_0x1ab676(0x236)));throw new Error(_0x1ab676(0x1fd)+(_0x15cc98[_0x1ab676(0x21a)]||_0x15cc98[_0x1ab676(0x1fc)]||_0x1ab676(0x236)));}let _0x32e1e5=_0x1ab676(0x1db);return{'status':_0x32e1e5};}catch(_0xc73d22){console['error'](_0x1ab676(0x1d5),_0xc73d22),loggerService_1[_0x1ab676(0x213)]['logWhiteDomainError'](_0x1ab676(0x1f9),_0x1ab676(0x240)+_0x569c65,_0xc73d22);throw new Error(_0x1ab676(0x203)+(_0xc73d22 instanceof Error?_0xc73d22[_0x1ab676(0x21a)]:_0x1ab676(0x236)));}}async['processWebhook'](_0x3f865f){const _0x1edd89=a51_0x58c9ac;console[_0x1edd89(0x221)](_0x1edd89(0x1e6),_0x3f865f);let _0x496685=_0x1edd89(0x1db);switch(_0x3f865f['status']?.['toLowerCase']()){case _0x1edd89(0x20c):case _0x1edd89(0x244):_0x496685=_0x1edd89(0x23b);break;case _0x1edd89(0x225):_0x496685=_0x1edd89(0x214);break;case _0x1edd89(0x1fc):case'cancelled':_0x496685=_0x1edd89(0x20e);break;case _0x1edd89(0x1ed):_0x496685='PENDING';break;case _0x1edd89(0x210):_0x496685=_0x1edd89(0x1e9);break;default:_0x496685=_0x1edd89(0x1db);break;}let _0x2d1ceb;if(_0x3f865f['tx_urls'])try{console[_0x1edd89(0x221)](_0x1edd89(0x202),_0x3f865f[_0x1edd89(0x208)]);let _0x54e68c;if(typeof _0x3f865f[_0x1edd89(0x208)]===_0x1edd89(0x1eb))_0x54e68c=JSON[_0x1edd89(0x235)](_0x3f865f[_0x1edd89(0x208)]);else Array[_0x1edd89(0x20d)](_0x3f865f[_0x1edd89(0x208)])?_0x54e68c=_0x3f865f[_0x1edd89(0x208)]:_0x54e68c=[];_0x2d1ceb=_0x54e68c[_0x1edd89(0x1ee)](_0x41bba8=>{const _0x544449=_0x1edd89,_0x305413=_0x41bba8['replace'](/\\/g,'');return console[_0x544449(0x221)](_0x544449(0x204)+_0x41bba8+'\x20->\x20'+_0x305413),_0x305413;}),console[_0x1edd89(0x221)](_0x1edd89(0x1e2),_0x2d1ceb),_0x2d1ceb[_0x1edd89(0x239)]((_0x3c482a,_0x35914f)=>{const _0x42fbd0=_0x1edd89;try{new URL(_0x3c482a),console['log']('‚úÖ\x20URL\x20'+(_0x35914f+0x1)+'\x20is\x20valid:\x20'+_0x3c482a);}catch(_0x1baacc){console[_0x42fbd0(0x1fc)](_0x42fbd0(0x22e)+(_0x35914f+0x1)+'\x20is\x20invalid:\x20'+_0x3c482a,_0x1baacc);}});}catch(_0x5755ce){console[_0x1edd89(0x1fc)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x5755ce),console[_0x1edd89(0x1fc)](_0x1edd89(0x1e1),_0x3f865f['tx_urls']),_0x2d1ceb=undefined;}return{'paymentId':_0x3f865f[_0x1edd89(0x1e7)]||'','status':_0x496685,'amount':_0x3f865f['amount'],'currency':_0x3f865f[_0x1edd89(0x228)],'txUrls':_0x2d1ceb};}}exports[a51_0x58c9ac(0x20a)]=PlisioService;