'use strict';function a44_0x4192(_0x220930,_0x227ef6){const _0x2ccd44=a44_0x2ccd();return a44_0x4192=function(_0x419292,_0x327eb7){_0x419292=_0x419292-0xb0;let _0x212aeb=_0x2ccd44[_0x419292];return _0x212aeb;},a44_0x4192(_0x220930,_0x227ef6);}const a44_0x2dc8b2=a44_0x4192;(function(_0x3cd7e1,_0x1e7317){const _0x468ccf=a44_0x4192,_0x1316f0=_0x3cd7e1();while(!![]){try{const _0x3c9393=parseInt(_0x468ccf(0x11a))/0x1*(parseInt(_0x468ccf(0x119))/0x2)+parseInt(_0x468ccf(0xda))/0x3+-parseInt(_0x468ccf(0xb8))/0x4*(-parseInt(_0x468ccf(0x126))/0x5)+-parseInt(_0x468ccf(0x124))/0x6+-parseInt(_0x468ccf(0xeb))/0x7*(-parseInt(_0x468ccf(0xdc))/0x8)+-parseInt(_0x468ccf(0xfe))/0x9+-parseInt(_0x468ccf(0x123))/0xa;if(_0x3c9393===_0x1e7317)break;else _0x1316f0['push'](_0x1316f0['shift']());}catch(_0x251163){_0x1316f0['push'](_0x1316f0['shift']());}}}(a44_0x2ccd,0x1d223));Object['defineProperty'](exports,a44_0x2dc8b2(0xcf),{'value':!![]}),exports[a44_0x2dc8b2(0xb0)]=void 0x0;function a44_0x2ccd(){const _0x63d467=['/operations/','name','Error\x20message:','PLISIO_API_KEY','loggerService','üîó\x20Formatted\x20URL:\x20','stack','Invoice\x20URL:','warn','invoice_url','Amount:','Plisio\x20API\x20error:\x20','plisio_direct','success','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','toLowerCase','error','toString','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','statusText','188VpPGxw','2492TjSpwS','expired','TesSoft\x20Payment\x20System/1.0','Target\x20Currency:','HIDDEN','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','parse','Response\x20Time:','Plisio\x20API\x20key\x20is\x20not\x20configured','679560kEjrlf','356058FYeYaq','createPayment','11365CVrHTl','Status:','PROCESSING','PlisioService','Response\x20data:','forEach','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','order_number','mismatch','===\x20PLISIO\x20API\x20ERROR\x20===','string','52rdllIC','Parsed\x20Result:','Plisio\x20payment\x20verification\x20error:','message','PAID','tx_urls','new','(crypto\x20for\x20payment)','invoice_total_sum','completed','../loggerService','Unknown\x20error','HTTP\x20','‚úÖ\x20Processed\x20tx_urls:','https://api.trapay.uk/api/webhooks/gateway/plisio','\x20is\x20valid:\x20','Parameters:','env','fromEntries','GET','Transaction\x20ID:','pending','FAILED','__esModule','HTTP\x20error!\x20status:\x20','‚úÖ\x20URL\x20','apiUrl','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','log','logWhiteDomainResponse','Response\x20Body:','Processing\x20Plisio\x20webhook:','verifyPayment','Failed\x20to\x20create\x20Plisio\x20payment:\x20','16452OfOYds','Source\x20Currency:','13648xjGYDS','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','application/json','cancelled','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Failed\x20to\x20parse\x20JSON\x20response:','entries','logWhiteDomainError','apiKey','/invoices/new','HTTP\x20Status:','qr_code','email','isArray','28aMwALn','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','status','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','===\x20PLISIO\x20SUCCESS\x20===','Error\x20Message:','text','‚ùå\x20URL\x20','Error\x20details:','Unknown\x20error\x20from\x20Plisio\x20API','Full\x20URL\x20(without\x20API\x20key):','Error\x20stack:','logWhiteDomainRequest','Raw\x20tx_urls\x20data:','now','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','data','Raw\x20Response\x20Body:','amount','265275RgJaAF','currency','append','JSON\x20Parse\x20Error:\x20','URL:','PENDING','txn_id'];a44_0x2ccd=function(){return _0x63d467;};return a44_0x2ccd();}const loggerService_1=require(a44_0x2dc8b2(0xc2));class PlisioService{constructor(){const _0x6f3680=a44_0x2dc8b2;this['apiUrl']='https://api.plisio.net/api/v1/invoices/new',this[_0x6f3680(0xe5)]=process[_0x6f3680(0xc9)][_0x6f3680(0x108)]||'',!this['apiKey']?console[_0x6f3680(0x10d)](_0x6f3680(0x11f)):console[_0x6f3680(0xd4)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a44_0x2dc8b2(0x125)](_0xc31f56){const _0x45f6e1=a44_0x2dc8b2,{orderId:_0x1e67a9,amount:_0x4cebb9,currency:_0x4c92e8,productName:_0x448b21,description:_0x428388,successUrl:_0x227b0e,failUrl:_0x4ea3f8,customerEmail:_0x453f3f,customerName:_0xfe4043,isSourceCurrency:_0x1f1872,sourceCurrency:_0x2c1595}=_0xc31f56;if(!this['apiKey'])throw new Error(_0x45f6e1(0x122));const _0x2e5312=new URLSearchParams({'api_key':this[_0x45f6e1(0xe5)],'order_number':_0x1e67a9,'order_name':_0x448b21,'description':_0x428388,'success_url':_0x227b0e,'fail_url':_0x4ea3f8,'callback_url':_0x45f6e1(0xc6)});_0x2c1595?(_0x2e5312[_0x45f6e1(0x100)](_0x45f6e1(0xff),_0x2c1595),_0x2e5312[_0x45f6e1(0x100)]('source_currency',_0x4c92e8),_0x2e5312[_0x45f6e1(0x100)]('source_amount',_0x4cebb9[_0x45f6e1(0x116)]())):(_0x2e5312[_0x45f6e1(0x100)](_0x45f6e1(0xff),_0x4c92e8),_0x2e5312[_0x45f6e1(0x100)](_0x45f6e1(0xfd),_0x4cebb9['toString']()));_0x453f3f&&_0x2e5312[_0x45f6e1(0x100)](_0x45f6e1(0xe9),_0x453f3f);_0xfe4043&&_0x2e5312[_0x45f6e1(0x100)](_0x45f6e1(0x106),_0xfe4043);const _0x7e3890=this[_0x45f6e1(0xd2)]+'?'+_0x2e5312[_0x45f6e1(0x116)](),_0xab9fbf=Date[_0x45f6e1(0xf9)]();try{console[_0x45f6e1(0xd4)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x45f6e1(0xd4)](_0x45f6e1(0x102),this['apiUrl']),console[_0x45f6e1(0xd4)](_0x45f6e1(0xc8),Object['fromEntries'](_0x2e5312[_0x45f6e1(0xe3)]())),console[_0x45f6e1(0xd4)](_0x45f6e1(0xf5),_0x7e3890['replace'](this[_0x45f6e1(0xe5)],_0x45f6e1(0x11e))),loggerService_1[_0x45f6e1(0x109)][_0x45f6e1(0xf7)](_0x45f6e1(0x111),_0x45f6e1(0xe6),_0x45f6e1(0xcb),Object[_0x45f6e1(0xca)](_0x2e5312[_0x45f6e1(0xe3)]()));const _0x4a91ec=await fetch(_0x7e3890,{'method':_0x45f6e1(0xcb),'headers':{'Accept':_0x45f6e1(0xde),'User-Agent':_0x45f6e1(0x11c)}}),_0x495cf6=Date['now']()-_0xab9fbf;console[_0x45f6e1(0xd4)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console['log'](_0x45f6e1(0x127),_0x4a91ec[_0x45f6e1(0xed)]),console[_0x45f6e1(0xd4)]('Status\x20Text:',_0x4a91ec[_0x45f6e1(0x118)]),console[_0x45f6e1(0xd4)](_0x45f6e1(0x121),_0x495cf6+'ms');const _0x3945c2=await _0x4a91ec[_0x45f6e1(0xf1)]();console[_0x45f6e1(0xd4)](_0x45f6e1(0xfc),_0x3945c2);if(!_0x4a91ec['ok']){console['error'](_0x45f6e1(0xb6)),console[_0x45f6e1(0x115)](_0x45f6e1(0xe7),_0x4a91ec[_0x45f6e1(0xed)]),console[_0x45f6e1(0x115)](_0x45f6e1(0xd6),_0x3945c2),loggerService_1[_0x45f6e1(0x109)]['logWhiteDomainResponse'](_0x45f6e1(0x111),'/invoices/new',_0x4a91ec['status'],_0x3945c2,_0x495cf6),loggerService_1[_0x45f6e1(0x109)][_0x45f6e1(0xe4)](_0x45f6e1(0x111),'/invoices/new',_0x45f6e1(0xc4)+_0x4a91ec['status']+':\x20'+_0x3945c2);throw new Error(_0x45f6e1(0xd0)+_0x4a91ec['status']+',\x20body:\x20'+_0x3945c2);}let _0x2e61e9;try{_0x2e61e9=JSON['parse'](_0x3945c2);}catch(_0x57fca5){console[_0x45f6e1(0x115)](_0x45f6e1(0xe2),_0x57fca5),loggerService_1[_0x45f6e1(0x109)]['logWhiteDomainError']('plisio_direct',_0x45f6e1(0xe6),_0x45f6e1(0x101)+_0x57fca5);throw new Error(_0x45f6e1(0xd3)+_0x3945c2);}console[_0x45f6e1(0xd4)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console['log'](_0x45f6e1(0xb9),JSON['stringify'](_0x2e61e9,null,0x2)),loggerService_1[_0x45f6e1(0x109)]['logWhiteDomainResponse'](_0x45f6e1(0x111),_0x45f6e1(0xe6),_0x4a91ec[_0x45f6e1(0xed)],_0x2e61e9,_0x495cf6);if(_0x2e61e9[_0x45f6e1(0xed)]!=='success'){const _0x31a5da=_0x2e61e9[_0x45f6e1(0xbb)]||_0x2e61e9[_0x45f6e1(0x115)]||_0x45f6e1(0xf4);console[_0x45f6e1(0x115)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x45f6e1(0xf0),_0x31a5da),loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct','/invoices/new','Business\x20Error:\x20'+_0x31a5da);throw new Error(_0x45f6e1(0x110)+_0x31a5da);}if(!_0x2e61e9['data']?.['txn_id']||!_0x2e61e9[_0x45f6e1(0xfb)]?.[_0x45f6e1(0x10e)]){console[_0x45f6e1(0x115)](_0x45f6e1(0xe0)),console[_0x45f6e1(0x115)](_0x45f6e1(0x117)),console['error'](_0x45f6e1(0xb1),_0x2e61e9[_0x45f6e1(0xfb)]),loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct','/invoices/new',_0x45f6e1(0xfa));throw new Error(_0x45f6e1(0xe1));}return console[_0x45f6e1(0xd4)](_0x45f6e1(0xef)),console['log'](_0x45f6e1(0xcc),_0x2e61e9[_0x45f6e1(0xfb)]['txn_id']),console[_0x45f6e1(0xd4)](_0x45f6e1(0x10c),_0x2e61e9[_0x45f6e1(0xfb)][_0x45f6e1(0x10e)]),console[_0x45f6e1(0xd4)](_0x45f6e1(0x10f),_0x4cebb9,_0x4c92e8),_0x2c1595&&(console[_0x45f6e1(0xd4)](_0x45f6e1(0xdb),_0x2c1595,_0x45f6e1(0xbf)),console['log'](_0x45f6e1(0x11d),_0x4c92e8,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x2e61e9[_0x45f6e1(0xfb)][_0x45f6e1(0x104)],'payment_url':_0x2e61e9['data']['invoice_url'],'invoice_total_sum':_0x2e61e9[_0x45f6e1(0xfb)][_0x45f6e1(0xc0)],'qr_code':_0x2e61e9['data'][_0x45f6e1(0xe8)],'qr_url':_0x2e61e9[_0x45f6e1(0xfb)]['qr_url']};}catch(_0x2fc0f8){console[_0x45f6e1(0x115)](_0x45f6e1(0x113)),console['error'](_0x45f6e1(0xf3),_0x2fc0f8),loggerService_1['loggerService']['logWhiteDomainError'](_0x45f6e1(0x111),'/invoices/new',_0x2fc0f8);if(_0x2fc0f8 instanceof Error){console[_0x45f6e1(0x115)](_0x45f6e1(0x107),_0x2fc0f8[_0x45f6e1(0xbb)]),console[_0x45f6e1(0x115)](_0x45f6e1(0xf6),_0x2fc0f8[_0x45f6e1(0x10b)]);throw new Error(_0x45f6e1(0xd9)+_0x2fc0f8[_0x45f6e1(0xbb)]);}throw new Error(_0x45f6e1(0xee));}}async[a44_0x2dc8b2(0xd8)](_0x3da2ba){const _0x2d908d=a44_0x2dc8b2,_0x7bc320=Date[_0x2d908d(0xf9)]();try{if(!this['apiKey'])throw new Error(_0x2d908d(0x122));const _0x501363=new URLSearchParams({'api_key':this[_0x2d908d(0xe5)],'txn_id':_0x3da2ba}),_0xa11bea='https://api.plisio.net/api/v1/operations/'+_0x3da2ba+'?'+_0x501363[_0x2d908d(0x116)]();loggerService_1[_0x2d908d(0x109)][_0x2d908d(0xf7)](_0x2d908d(0x111),'/operations/'+_0x3da2ba,'GET',Object[_0x2d908d(0xca)](_0x501363[_0x2d908d(0xe3)]()));const _0x490422=await fetch(_0xa11bea,{'method':_0x2d908d(0xcb),'headers':{'Accept':_0x2d908d(0xde),'User-Agent':_0x2d908d(0x11c)}}),_0x1805ca=Date[_0x2d908d(0xf9)]()-_0x7bc320;if(!_0x490422['ok']){const _0x46cbe5=await _0x490422[_0x2d908d(0xf1)]();loggerService_1[_0x2d908d(0x109)][_0x2d908d(0xd5)](_0x2d908d(0x111),_0x2d908d(0x105)+_0x3da2ba,_0x490422[_0x2d908d(0xed)],_0x46cbe5,_0x1805ca);throw new Error(_0x2d908d(0xd0)+_0x490422['status']);}const _0x5ac402=await _0x490422['json']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2d908d(0x111),_0x2d908d(0x105)+_0x3da2ba,_0x490422[_0x2d908d(0xed)],_0x5ac402,_0x1805ca);if(_0x5ac402[_0x2d908d(0xed)]!==_0x2d908d(0x112)){loggerService_1['loggerService'][_0x2d908d(0xe4)](_0x2d908d(0x111),_0x2d908d(0x105)+_0x3da2ba,'Plisio\x20API\x20error:\x20'+(_0x5ac402[_0x2d908d(0xbb)]||_0x5ac402[_0x2d908d(0x115)]||_0x2d908d(0xc3)));throw new Error(_0x2d908d(0x110)+(_0x5ac402[_0x2d908d(0xbb)]||_0x5ac402[_0x2d908d(0x115)]||'Unknown\x20error'));}let _0x4096a8=_0x2d908d(0x103);return{'status':_0x4096a8};}catch(_0x3f431b){console[_0x2d908d(0x115)](_0x2d908d(0xba),_0x3f431b),loggerService_1[_0x2d908d(0x109)]['logWhiteDomainError']('plisio_direct','/operations/'+_0x3da2ba,_0x3f431b);throw new Error(_0x2d908d(0xec)+(_0x3f431b instanceof Error?_0x3f431b['message']:_0x2d908d(0xc3)));}}async['processWebhook'](_0x4f9681){const _0x2747ea=a44_0x2dc8b2;console[_0x2747ea(0xd4)](_0x2747ea(0xd7),_0x4f9681);let _0x4269b1=_0x2747ea(0x103);switch(_0x4f9681[_0x2747ea(0xed)]?.[_0x2747ea(0x114)]()){case _0x2747ea(0xc1):case _0x2747ea(0xb5):_0x4269b1=_0x2747ea(0xbc);break;case _0x2747ea(0x11b):_0x4269b1='EXPIRED';break;case'error':case _0x2747ea(0xdf):_0x4269b1=_0x2747ea(0xce);break;case _0x2747ea(0xbe):_0x4269b1=_0x2747ea(0x103);break;case _0x2747ea(0xcd):_0x4269b1=_0x2747ea(0x128);break;default:_0x4269b1='PENDING';break;}let _0x24f55e;if(_0x4f9681[_0x2747ea(0xbd)])try{console[_0x2747ea(0xd4)](_0x2747ea(0xdd),_0x4f9681['tx_urls']);let _0x400a91;if(typeof _0x4f9681[_0x2747ea(0xbd)]===_0x2747ea(0xb7))_0x400a91=JSON[_0x2747ea(0x120)](_0x4f9681[_0x2747ea(0xbd)]);else Array[_0x2747ea(0xea)](_0x4f9681[_0x2747ea(0xbd)])?_0x400a91=_0x4f9681[_0x2747ea(0xbd)]:_0x400a91=[];_0x24f55e=_0x400a91['map'](_0xeff860=>{const _0x9de7e9=_0x2747ea,_0x37a0ef=_0xeff860['replace'](/\\/g,'');return console[_0x9de7e9(0xd4)](_0x9de7e9(0x10a)+_0xeff860+'\x20->\x20'+_0x37a0ef),_0x37a0ef;}),console[_0x2747ea(0xd4)](_0x2747ea(0xc5),_0x24f55e),_0x24f55e[_0x2747ea(0xb2)]((_0x2df4a1,_0x432b3a)=>{const _0x25df7c=_0x2747ea;try{new URL(_0x2df4a1),console[_0x25df7c(0xd4)](_0x25df7c(0xd1)+(_0x432b3a+0x1)+_0x25df7c(0xc7)+_0x2df4a1);}catch(_0x2d340d){console[_0x25df7c(0x115)](_0x25df7c(0xf2)+(_0x432b3a+0x1)+'\x20is\x20invalid:\x20'+_0x2df4a1,_0x2d340d);}});}catch(_0x18855b){console[_0x2747ea(0x115)](_0x2747ea(0xb3),_0x18855b),console[_0x2747ea(0x115)](_0x2747ea(0xf8),_0x4f9681[_0x2747ea(0xbd)]),_0x24f55e=undefined;}return{'paymentId':_0x4f9681[_0x2747ea(0xb4)]||'','status':_0x4269b1,'amount':_0x4f9681[_0x2747ea(0xfd)],'currency':_0x4f9681['currency'],'txUrls':_0x24f55e};}}exports[a44_0x2dc8b2(0xb0)]=PlisioService;