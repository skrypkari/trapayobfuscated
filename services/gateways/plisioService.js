'use strict';const a41_0x5a73b4=a41_0x5622;(function(_0x3d63c4,_0xdf2725){const _0x5ce688=a41_0x5622,_0x3e063a=_0x3d63c4();while(!![]){try{const _0x4b548b=parseInt(_0x5ce688(0x18c))/0x1*(-parseInt(_0x5ce688(0x15e))/0x2)+parseInt(_0x5ce688(0x15d))/0x3+-parseInt(_0x5ce688(0x174))/0x4*(parseInt(_0x5ce688(0x17d))/0x5)+parseInt(_0x5ce688(0x192))/0x6+parseInt(_0x5ce688(0x14f))/0x7*(-parseInt(_0x5ce688(0x17b))/0x8)+parseInt(_0x5ce688(0x161))/0x9+parseInt(_0x5ce688(0x183))/0xa;if(_0x4b548b===_0xdf2725)break;else _0x3e063a['push'](_0x3e063a['shift']());}catch(_0x3a3bd9){_0x3e063a['push'](_0x3e063a['shift']());}}}(a41_0x4b4c,0xd4e03));function a41_0x4b4c(){const _0xe7601f=['statusText','Parameters:','invoice_url','warn','invoice_total_sum','Status\x20Text:','defineProperty','__esModule','Invoice\x20URL:','stack','completed','loggerService','===\x20PLISIO\x20API\x20ERROR\x20===','Full\x20URL\x20(without\x20API\x20key):','/operations/','now','Plisio\x20payment\x20verification\x20error:','Error\x20Message:','mismatch','Processing\x20Plisio\x20webhook:','HIDDEN','Parsed\x20Result:','text','amount',',\x20body:\x20','entries','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','(fiat\x20for\x20merchant)','Unknown\x20error\x20from\x20Plisio\x20API','HTTP\x20','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','new','stringify','plisio_direct','Error\x20details:','14TEfeck','txn_id','email','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','source_amount','error','FAILED','Target\x20Currency:','data','===\x20PLISIO\x20SUCCESS\x20===','PENDING','order_number','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Error\x20message:','3607602FDdsOV','2NYKvPS','Plisio\x20API\x20key\x20is\x20not\x20configured','Amount:','6286455IobTzN','Plisio\x20API\x20error:\x20','PlisioService','processWebhook','/invoices/new','Status:','Unknown\x20error','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','cancelled','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','HTTP\x20error!\x20status:\x20','toLowerCase','apiKey','EXPIRED','append','fromEntries','status','Response\x20Time:','toString','148IobEZQ','message','JSON\x20Parse\x20Error:\x20','logWhiteDomainResponse','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','TesSoft\x20Payment\x20System/1.0','qr_code','4612280HNRJhB','GET','202225eQeCyh','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainError','log','URL:','16752580TywEEd','https://api.plisio.net/api/v1/invoices/new','success','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','(crypto\x20for\x20payment)','parse','HTTP\x20Status:','logWhiteDomainRequest','apiUrl','1418943VYSXDT','application/json','createPayment','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Response\x20data:','source_currency','8184780dypmzX','currency','https://api.plisio.net/api/v1/operations/','PAID'];a41_0x4b4c=function(){return _0xe7601f;};return a41_0x4b4c();}Object[a41_0x5a73b4(0x132)](exports,a41_0x5a73b4(0x133),{'value':!![]}),exports[a41_0x5a73b4(0x163)]=void 0x0;const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x2aa5f2=a41_0x5a73b4;this[_0x2aa5f2(0x18b)]=_0x2aa5f2(0x184),this['apiKey']=process['env']['PLISIO_API_KEY']||'',!this[_0x2aa5f2(0x16d)]?console[_0x2aa5f2(0x12f)](_0x2aa5f2(0x17e)):console[_0x2aa5f2(0x181)](_0x2aa5f2(0x186));}async[a41_0x5a73b4(0x18e)](_0x4a4362){const _0x207059=a41_0x5a73b4,{orderId:_0x249f99,amount:_0x432681,currency:_0x54d2df,productName:_0x417162,description:_0x1b0834,successUrl:_0x22ed97,failUrl:_0x50056b,customerEmail:_0x5122a0,customerName:_0x4c8098,isSourceCurrency:_0x371e48,sourceCurrency:_0x251cb9}=_0x4a4362;if(!this['apiKey'])throw new Error(_0x207059(0x15f));const _0x581393=new URLSearchParams({'api_key':this[_0x207059(0x16d)],'order_number':_0x249f99,'order_name':_0x417162,'description':_0x1b0834,'success_url':_0x22ed97,'fail_url':_0x50056b});_0x251cb9?(_0x581393[_0x207059(0x16f)](_0x207059(0x193),_0x251cb9),_0x581393['append'](_0x207059(0x191),_0x54d2df),_0x581393[_0x207059(0x16f)](_0x207059(0x153),_0x432681['toString']())):(_0x581393[_0x207059(0x16f)](_0x207059(0x193),_0x54d2df),_0x581393[_0x207059(0x16f)](_0x207059(0x143),_0x432681[_0x207059(0x173)]()));_0x5122a0&&_0x581393[_0x207059(0x16f)](_0x207059(0x151),_0x5122a0);_0x4c8098&&_0x581393[_0x207059(0x16f)]('name',_0x4c8098);const _0x502b9c=this[_0x207059(0x18b)]+'?'+_0x581393[_0x207059(0x173)](),_0x5edc00=Date[_0x207059(0x13b)]();try{console[_0x207059(0x181)](_0x207059(0x15b)),console[_0x207059(0x181)](_0x207059(0x182),this[_0x207059(0x18b)]),console[_0x207059(0x181)](_0x207059(0x197),Object[_0x207059(0x170)](_0x581393[_0x207059(0x145)]())),console[_0x207059(0x181)](_0x207059(0x139),_0x502b9c['replace'](this[_0x207059(0x16d)],_0x207059(0x140))),loggerService_1['loggerService'][_0x207059(0x18a)](_0x207059(0x14d),_0x207059(0x165),'GET',Object[_0x207059(0x170)](_0x581393['entries']()));const _0x123ec3=await fetch(_0x502b9c,{'method':'GET','headers':{'Accept':_0x207059(0x18d),'User-Agent':_0x207059(0x179)}}),_0x152412=Date[_0x207059(0x13b)]()-_0x5edc00;console[_0x207059(0x181)](_0x207059(0x146)),console[_0x207059(0x181)](_0x207059(0x166),_0x123ec3['status']),console[_0x207059(0x181)](_0x207059(0x131),_0x123ec3[_0x207059(0x196)]),console['log'](_0x207059(0x172),_0x152412+'ms');const _0x3aaf55=await _0x123ec3[_0x207059(0x142)]();console[_0x207059(0x181)]('Raw\x20Response\x20Body:',_0x3aaf55);if(!_0x123ec3['ok']){console[_0x207059(0x154)](_0x207059(0x138)),console[_0x207059(0x154)](_0x207059(0x189),_0x123ec3['status']),console[_0x207059(0x154)]('Response\x20Body:',_0x3aaf55),loggerService_1[_0x207059(0x137)]['logWhiteDomainResponse'](_0x207059(0x14d),'/invoices/new',_0x123ec3[_0x207059(0x171)],_0x3aaf55,_0x152412),loggerService_1[_0x207059(0x137)][_0x207059(0x180)](_0x207059(0x14d),'/invoices/new',_0x207059(0x149)+_0x123ec3['status']+':\x20'+_0x3aaf55);throw new Error(_0x207059(0x16b)+_0x123ec3[_0x207059(0x171)]+_0x207059(0x144)+_0x3aaf55);}let _0x39c952;try{_0x39c952=JSON[_0x207059(0x188)](_0x3aaf55);}catch(_0x264142){console[_0x207059(0x154)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x264142),loggerService_1[_0x207059(0x137)][_0x207059(0x180)](_0x207059(0x14d),_0x207059(0x165),_0x207059(0x176)+_0x264142);throw new Error(_0x207059(0x168)+_0x3aaf55);}console[_0x207059(0x181)](_0x207059(0x14a)),console[_0x207059(0x181)](_0x207059(0x141),JSON[_0x207059(0x14c)](_0x39c952,null,0x2)),loggerService_1[_0x207059(0x137)][_0x207059(0x177)](_0x207059(0x14d),_0x207059(0x165),_0x123ec3['status'],_0x39c952,_0x152412);if(_0x39c952[_0x207059(0x171)]!==_0x207059(0x185)){const _0x1bce23=_0x39c952['message']||_0x39c952[_0x207059(0x154)]||_0x207059(0x148);console[_0x207059(0x154)](_0x207059(0x18f)),console[_0x207059(0x154)](_0x207059(0x13d),_0x1bce23),loggerService_1[_0x207059(0x137)][_0x207059(0x180)](_0x207059(0x14d),_0x207059(0x165),'Business\x20Error:\x20'+_0x1bce23);throw new Error(_0x207059(0x162)+_0x1bce23);}if(!_0x39c952[_0x207059(0x157)]?.[_0x207059(0x150)]||!_0x39c952['data']?.[_0x207059(0x198)]){console[_0x207059(0x154)](_0x207059(0x17f)),console[_0x207059(0x154)](_0x207059(0x178)),console[_0x207059(0x154)](_0x207059(0x190),_0x39c952[_0x207059(0x157)]),loggerService_1[_0x207059(0x137)][_0x207059(0x180)](_0x207059(0x14d),'/invoices/new','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x207059(0x152));}return console['log'](_0x207059(0x158)),console[_0x207059(0x181)]('Transaction\x20ID:',_0x39c952[_0x207059(0x157)][_0x207059(0x150)]),console['log'](_0x207059(0x134),_0x39c952[_0x207059(0x157)][_0x207059(0x198)]),console[_0x207059(0x181)](_0x207059(0x160),_0x432681,_0x54d2df),_0x251cb9&&(console['log']('Source\x20Currency:',_0x251cb9,_0x207059(0x187)),console[_0x207059(0x181)](_0x207059(0x156),_0x54d2df,_0x207059(0x147))),{'gateway_payment_id':_0x39c952[_0x207059(0x157)][_0x207059(0x150)],'payment_url':_0x39c952[_0x207059(0x157)][_0x207059(0x198)],'invoice_total_sum':_0x39c952[_0x207059(0x157)][_0x207059(0x130)],'qr_code':_0x39c952[_0x207059(0x157)][_0x207059(0x17a)],'qr_url':_0x39c952[_0x207059(0x157)]['qr_code_url']};}catch(_0x4982e9){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x207059(0x154)](_0x207059(0x14e),_0x4982e9),loggerService_1[_0x207059(0x137)][_0x207059(0x180)](_0x207059(0x14d),_0x207059(0x165),_0x4982e9);if(_0x4982e9 instanceof Error){console['error'](_0x207059(0x15c),_0x4982e9[_0x207059(0x175)]),console['error']('Error\x20stack:',_0x4982e9[_0x207059(0x135)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x4982e9['message']);}throw new Error(_0x207059(0x16a));}}async['verifyPayment'](_0x417af4){const _0x3a8137=a41_0x5a73b4,_0x21f055=Date[_0x3a8137(0x13b)]();try{if(!this[_0x3a8137(0x16d)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x421fde=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x417af4}),_0x4daf95=_0x3a8137(0x194)+_0x417af4+'?'+_0x421fde[_0x3a8137(0x173)]();loggerService_1[_0x3a8137(0x137)][_0x3a8137(0x18a)](_0x3a8137(0x14d),_0x3a8137(0x13a)+_0x417af4,_0x3a8137(0x17c),Object['fromEntries'](_0x421fde[_0x3a8137(0x145)]()));const _0x4d8957=await fetch(_0x4daf95,{'method':'GET','headers':{'Accept':'application/json','User-Agent':_0x3a8137(0x179)}}),_0x23fb10=Date['now']()-_0x21f055;if(!_0x4d8957['ok']){const _0x3d63c5=await _0x4d8957[_0x3a8137(0x142)]();loggerService_1[_0x3a8137(0x137)][_0x3a8137(0x177)](_0x3a8137(0x14d),_0x3a8137(0x13a)+_0x417af4,_0x4d8957[_0x3a8137(0x171)],_0x3d63c5,_0x23fb10);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4d8957['status']);}const _0x687554=await _0x4d8957['json']();loggerService_1[_0x3a8137(0x137)][_0x3a8137(0x177)]('plisio_direct',_0x3a8137(0x13a)+_0x417af4,_0x4d8957[_0x3a8137(0x171)],_0x687554,_0x23fb10);if(_0x687554[_0x3a8137(0x171)]!==_0x3a8137(0x185)){loggerService_1[_0x3a8137(0x137)][_0x3a8137(0x180)]('plisio_direct','/operations/'+_0x417af4,'Plisio\x20API\x20error:\x20'+(_0x687554[_0x3a8137(0x175)]||_0x687554['error']||_0x3a8137(0x167)));throw new Error(_0x3a8137(0x162)+(_0x687554[_0x3a8137(0x175)]||_0x687554['error']||_0x3a8137(0x167)));}let _0x244a59=_0x3a8137(0x159);return{'status':_0x244a59};}catch(_0x4fe745){console['error'](_0x3a8137(0x13c),_0x4fe745),loggerService_1[_0x3a8137(0x137)][_0x3a8137(0x180)](_0x3a8137(0x14d),_0x3a8137(0x13a)+_0x417af4,_0x4fe745);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x4fe745 instanceof Error?_0x4fe745[_0x3a8137(0x175)]:_0x3a8137(0x167)));}}async[a41_0x5a73b4(0x164)](_0x2d09dd){const _0x3c2904=a41_0x5a73b4;console[_0x3c2904(0x181)](_0x3c2904(0x13f),_0x2d09dd);let _0x2ac131=_0x3c2904(0x159);switch(_0x2d09dd[_0x3c2904(0x171)]?.[_0x3c2904(0x16c)]()){case _0x3c2904(0x136):case _0x3c2904(0x13e):_0x2ac131=_0x3c2904(0x195);break;case'expired':_0x2ac131=_0x3c2904(0x16e);break;case _0x3c2904(0x154):case _0x3c2904(0x169):_0x2ac131=_0x3c2904(0x155);break;case _0x3c2904(0x14b):case'pending':default:_0x2ac131='PENDING';break;}return{'paymentId':_0x2d09dd[_0x3c2904(0x15a)]||'','status':_0x2ac131,'amount':_0x2d09dd['amount'],'currency':_0x2d09dd[_0x3c2904(0x193)]};}}function a41_0x5622(_0x58e39a,_0xc94de1){const _0x4b4c73=a41_0x4b4c();return a41_0x5622=function(_0x56222c,_0x523ae8){_0x56222c=_0x56222c-0x12f;let _0x3c105d=_0x4b4c73[_0x56222c];return _0x3c105d;},a41_0x5622(_0x58e39a,_0xc94de1);}exports[a41_0x5a73b4(0x163)]=PlisioService;