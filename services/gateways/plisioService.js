'use strict';const a55_0x21fc3b=a55_0x17f5;(function(_0x3b5001,_0x398bd1){const _0x3e0066=a55_0x17f5,_0x1e06d7=_0x3b5001();while(!![]){try{const _0x56337a=parseInt(_0x3e0066(0x218))/0x1*(-parseInt(_0x3e0066(0x1f8))/0x2)+parseInt(_0x3e0066(0x216))/0x3+parseInt(_0x3e0066(0x235))/0x4+-parseInt(_0x3e0066(0x211))/0x5*(-parseInt(_0x3e0066(0x248))/0x6)+-parseInt(_0x3e0066(0x203))/0x7+-parseInt(_0x3e0066(0x24d))/0x8*(-parseInt(_0x3e0066(0x1fa))/0x9)+parseInt(_0x3e0066(0x205))/0xa;if(_0x56337a===_0x398bd1)break;else _0x1e06d7['push'](_0x1e06d7['shift']());}catch(_0xb25e3f){_0x1e06d7['push'](_0x1e06d7['shift']());}}}(a55_0x3c10,0xd2ceb));function a55_0x3c10(){const _0x1218ea=['source_amount','(fiat\x20for\x20merchant)','message','Response\x20Body:','error','Source\x20Currency:','Response\x20data:','HTTP\x20','map','logWhiteDomainError','===\x20PLISIO\x20API\x20ERROR\x20===','Failed\x20to\x20parse\x20JSON\x20response:','entries','data','invoice_url','currency','106ssdcnq','source_currency','738hgHinp','Unknown\x20error','https://api.trapay.uk/api/webhooks/gateway/plisio','Plisio\x20API\x20key\x20is\x20not\x20configured','../loggerService','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','qr_url','Error\x20message:','Plisio\x20API\x20error:\x20','7847903cVarDM','===\x20PLISIO\x20SUCCESS\x20===','16858210kjQXzI','toString','GET','toLowerCase','Parameters:','logWhiteDomainRequest','log','env',',\x20body:\x20','Unknown\x20error\x20from\x20Plisio\x20API','Response\x20Time:','warn','354055VBIZBl','fromEntries','parse','Business\x20Error:\x20','status','3187533XXgCri','plisio_direct','28837iZCRKP','append','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','completed','FAILED','logWhiteDomainResponse','name','loggerService','Error\x20stack:','PROCESSING','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','❌\x20Failed\x20to\x20parse\x20tx_urls:','email','replace','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Amount:','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','defineProperty','Payment\x20System/1.0','stack','Raw\x20tx_urls\x20data:','❌\x20URL\x20','Status:','__esModule','PENDING','amount','qr_code','verifyPayment','2664720QzlfNt','/invoices/new','apiKey','pending','mismatch','text','PlisioService','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','tx_urls','isArray','HTTP\x20error!\x20status:\x20','HIDDEN','application/json','Raw\x20Response\x20Body:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','success','(crypto\x20for\x20payment)','stringify','txn_id','6kicBTn','string','Error\x20Message:','Plisio\x20payment\x20verification\x20error:','Status\x20Text:','2696tBqCwc','✅\x20URL\x20','https://api.plisio.net/api/v1/invoices/new','apiUrl','/operations/','order_number','\x20->\x20','Full\x20URL\x20(without\x20API\x20key):','new','🔗\x20Formatted\x20URL:\x20','now','statusText','PLISIO_API_KEY','Parsed\x20Result:','PAID','Transaction\x20ID:','EXPIRED','json'];a55_0x3c10=function(){return _0x1218ea;};return a55_0x3c10();}function a55_0x17f5(_0x50c3ee,_0x244c9a){const _0x3c1003=a55_0x3c10();return a55_0x17f5=function(_0x17f5db,_0x38cfdd){_0x17f5db=_0x17f5db-0x1de;let _0x22b44a=_0x3c1003[_0x17f5db];return _0x22b44a;},a55_0x17f5(_0x50c3ee,_0x244c9a);}Object[a55_0x21fc3b(0x22a)](exports,a55_0x21fc3b(0x230),{'value':!![]}),exports[a55_0x21fc3b(0x23b)]=void 0x0;const loggerService_1=require(a55_0x21fc3b(0x1fe));class PlisioService{constructor(){const _0x2f2e04=a55_0x21fc3b;this[_0x2f2e04(0x250)]=_0x2f2e04(0x24f),this[_0x2f2e04(0x237)]=process[_0x2f2e04(0x20c)][_0x2f2e04(0x1e2)]||'',!this[_0x2f2e04(0x237)]?console[_0x2f2e04(0x210)](_0x2f2e04(0x223)):console[_0x2f2e04(0x20b)]('💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async['createPayment'](_0xf0ed63){const _0x5e40bd=a55_0x21fc3b,{orderId:_0x3e7191,amount:_0x32d459,currency:_0x346c59,productName:_0xa5a549,description:_0x5e0ebb,successUrl:_0x73f4a,failUrl:_0x5c2bac,customerEmail:_0x2877d9,customerName:_0x1e9a12,isSourceCurrency:_0x2e725d,sourceCurrency:_0x47f4f2}=_0xf0ed63;if(!this['apiKey'])throw new Error(_0x5e40bd(0x1fd));const _0x234266=new URLSearchParams({'api_key':this[_0x5e40bd(0x237)],'order_number':_0x3e7191,'order_name':_0xa5a549,'description':_0x5e0ebb,'success_url':_0x73f4a,'fail_url':_0x5c2bac,'callback_url':_0x5e40bd(0x1fc)});_0x47f4f2?(_0x234266['append'](_0x5e40bd(0x1f7),_0x47f4f2),_0x234266[_0x5e40bd(0x219)](_0x5e40bd(0x1f9),_0x346c59),_0x234266[_0x5e40bd(0x219)](_0x5e40bd(0x1e8),_0x32d459['toString']())):(_0x234266[_0x5e40bd(0x219)](_0x5e40bd(0x1f7),_0x346c59),_0x234266['append']('amount',_0x32d459[_0x5e40bd(0x206)]()));_0x2877d9&&_0x234266[_0x5e40bd(0x219)](_0x5e40bd(0x225),_0x2877d9);_0x1e9a12&&_0x234266[_0x5e40bd(0x219)](_0x5e40bd(0x21f),_0x1e9a12);const _0xa33da1=this['apiUrl']+'?'+_0x234266[_0x5e40bd(0x206)](),_0x217aaa=Date[_0x5e40bd(0x1e0)]();try{console[_0x5e40bd(0x20b)](_0x5e40bd(0x243)),console['log']('URL:',this[_0x5e40bd(0x250)]),console[_0x5e40bd(0x20b)](_0x5e40bd(0x209),Object[_0x5e40bd(0x212)](_0x234266['entries']())),console[_0x5e40bd(0x20b)](_0x5e40bd(0x254),_0xa33da1[_0x5e40bd(0x226)](this['apiKey'],_0x5e40bd(0x240))),loggerService_1[_0x5e40bd(0x220)][_0x5e40bd(0x20a)](_0x5e40bd(0x217),_0x5e40bd(0x236),_0x5e40bd(0x207),Object[_0x5e40bd(0x212)](_0x234266[_0x5e40bd(0x1f4)]()));const _0x321dd0=await fetch(_0xa33da1,{'method':_0x5e40bd(0x207),'headers':{'Accept':_0x5e40bd(0x241),'User-Agent':_0x5e40bd(0x22b)}}),_0x396200=Date[_0x5e40bd(0x1e0)]()-_0x217aaa;console['log']('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console['log'](_0x5e40bd(0x22f),_0x321dd0[_0x5e40bd(0x215)]),console[_0x5e40bd(0x20b)](_0x5e40bd(0x24c),_0x321dd0[_0x5e40bd(0x1e1)]),console[_0x5e40bd(0x20b)](_0x5e40bd(0x20f),_0x396200+'ms');const _0x4cebe8=await _0x321dd0[_0x5e40bd(0x23a)]();console[_0x5e40bd(0x20b)](_0x5e40bd(0x242),_0x4cebe8);if(!_0x321dd0['ok']){console[_0x5e40bd(0x1ec)](_0x5e40bd(0x1f2)),console[_0x5e40bd(0x1ec)]('HTTP\x20Status:',_0x321dd0[_0x5e40bd(0x215)]),console[_0x5e40bd(0x1ec)](_0x5e40bd(0x1eb),_0x4cebe8),loggerService_1[_0x5e40bd(0x220)][_0x5e40bd(0x21e)](_0x5e40bd(0x217),_0x5e40bd(0x236),_0x321dd0[_0x5e40bd(0x215)],_0x4cebe8,_0x396200),loggerService_1[_0x5e40bd(0x220)][_0x5e40bd(0x1f1)](_0x5e40bd(0x217),'/invoices/new',_0x5e40bd(0x1ef)+_0x321dd0[_0x5e40bd(0x215)]+':\x20'+_0x4cebe8);throw new Error(_0x5e40bd(0x23f)+_0x321dd0[_0x5e40bd(0x215)]+_0x5e40bd(0x20d)+_0x4cebe8);}let _0x17b2fb;try{_0x17b2fb=JSON[_0x5e40bd(0x213)](_0x4cebe8);}catch(_0xe11ce4){console[_0x5e40bd(0x1ec)](_0x5e40bd(0x1f3),_0xe11ce4),loggerService_1[_0x5e40bd(0x220)][_0x5e40bd(0x1f1)](_0x5e40bd(0x217),'/invoices/new','JSON\x20Parse\x20Error:\x20'+_0xe11ce4);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x4cebe8);}console['log']('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x5e40bd(0x20b)](_0x5e40bd(0x1e3),JSON[_0x5e40bd(0x246)](_0x17b2fb,null,0x2)),loggerService_1[_0x5e40bd(0x220)][_0x5e40bd(0x21e)](_0x5e40bd(0x217),_0x5e40bd(0x236),_0x321dd0['status'],_0x17b2fb,_0x396200);if(_0x17b2fb[_0x5e40bd(0x215)]!==_0x5e40bd(0x244)){const _0x307893=_0x17b2fb[_0x5e40bd(0x1ea)]||_0x17b2fb[_0x5e40bd(0x1ec)]||_0x5e40bd(0x20e);console[_0x5e40bd(0x1ec)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x5e40bd(0x24a),_0x307893),loggerService_1['loggerService'][_0x5e40bd(0x1f1)]('plisio_direct',_0x5e40bd(0x236),_0x5e40bd(0x214)+_0x307893);throw new Error(_0x5e40bd(0x202)+_0x307893);}if(!_0x17b2fb[_0x5e40bd(0x1f5)]?.[_0x5e40bd(0x247)]||!_0x17b2fb[_0x5e40bd(0x1f5)]?.[_0x5e40bd(0x1f6)]){console[_0x5e40bd(0x1ec)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x5e40bd(0x1ec)](_0x5e40bd(0x23c)),console[_0x5e40bd(0x1ec)](_0x5e40bd(0x1ee),_0x17b2fb[_0x5e40bd(0x1f5)]),loggerService_1[_0x5e40bd(0x220)][_0x5e40bd(0x1f1)](_0x5e40bd(0x217),_0x5e40bd(0x236),_0x5e40bd(0x1ff));throw new Error(_0x5e40bd(0x227));}return console[_0x5e40bd(0x20b)](_0x5e40bd(0x204)),console[_0x5e40bd(0x20b)](_0x5e40bd(0x1e5),_0x17b2fb[_0x5e40bd(0x1f5)][_0x5e40bd(0x247)]),console[_0x5e40bd(0x20b)]('Invoice\x20URL:',_0x17b2fb[_0x5e40bd(0x1f5)][_0x5e40bd(0x1f6)]),console[_0x5e40bd(0x20b)](_0x5e40bd(0x228),_0x32d459,_0x346c59),_0x47f4f2&&(console[_0x5e40bd(0x20b)](_0x5e40bd(0x1ed),_0x47f4f2,_0x5e40bd(0x245)),console[_0x5e40bd(0x20b)]('Target\x20Currency:',_0x346c59,_0x5e40bd(0x1e9))),{'gateway_payment_id':_0x17b2fb[_0x5e40bd(0x1f5)][_0x5e40bd(0x247)],'payment_url':_0x17b2fb[_0x5e40bd(0x1f5)]['invoice_url'],'invoice_total_sum':_0x17b2fb[_0x5e40bd(0x1f5)]['invoice_total_sum'],'qr_code':_0x17b2fb[_0x5e40bd(0x1f5)][_0x5e40bd(0x233)],'qr_url':_0x17b2fb['data'][_0x5e40bd(0x200)]};}catch(_0xd5e415){console['error'](_0x5e40bd(0x229)),console[_0x5e40bd(0x1ec)]('Error\x20details:',_0xd5e415),loggerService_1[_0x5e40bd(0x220)]['logWhiteDomainError'](_0x5e40bd(0x217),_0x5e40bd(0x236),_0xd5e415);if(_0xd5e415 instanceof Error){console[_0x5e40bd(0x1ec)](_0x5e40bd(0x201),_0xd5e415['message']),console[_0x5e40bd(0x1ec)](_0x5e40bd(0x221),_0xd5e415[_0x5e40bd(0x22c)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0xd5e415[_0x5e40bd(0x1ea)]);}throw new Error(_0x5e40bd(0x21b));}}async[a55_0x21fc3b(0x234)](_0x171727){const _0x3b0ec3=a55_0x21fc3b,_0x561042=Date[_0x3b0ec3(0x1e0)]();try{if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x1621fc=new URLSearchParams({'api_key':this[_0x3b0ec3(0x237)],'txn_id':_0x171727}),_0x3539bd='https://api.plisio.net/api/v1/operations/'+_0x171727+'?'+_0x1621fc['toString']();loggerService_1['loggerService']['logWhiteDomainRequest'](_0x3b0ec3(0x217),'/operations/'+_0x171727,_0x3b0ec3(0x207),Object[_0x3b0ec3(0x212)](_0x1621fc[_0x3b0ec3(0x1f4)]()));const _0x20f80b=await fetch(_0x3539bd,{'method':_0x3b0ec3(0x207),'headers':{'Accept':_0x3b0ec3(0x241),'User-Agent':_0x3b0ec3(0x22b)}}),_0x110aa1=Date['now']()-_0x561042;if(!_0x20f80b['ok']){const _0x2cb8bc=await _0x20f80b[_0x3b0ec3(0x23a)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3b0ec3(0x217),_0x3b0ec3(0x251)+_0x171727,_0x20f80b[_0x3b0ec3(0x215)],_0x2cb8bc,_0x110aa1);throw new Error('HTTP\x20error!\x20status:\x20'+_0x20f80b[_0x3b0ec3(0x215)]);}const _0x5b901d=await _0x20f80b[_0x3b0ec3(0x1e7)]();loggerService_1[_0x3b0ec3(0x220)][_0x3b0ec3(0x21e)](_0x3b0ec3(0x217),'/operations/'+_0x171727,_0x20f80b[_0x3b0ec3(0x215)],_0x5b901d,_0x110aa1);if(_0x5b901d['status']!==_0x3b0ec3(0x244)){loggerService_1[_0x3b0ec3(0x220)][_0x3b0ec3(0x1f1)](_0x3b0ec3(0x217),'/operations/'+_0x171727,'Plisio\x20API\x20error:\x20'+(_0x5b901d[_0x3b0ec3(0x1ea)]||_0x5b901d['error']||_0x3b0ec3(0x1fb)));throw new Error(_0x3b0ec3(0x202)+(_0x5b901d[_0x3b0ec3(0x1ea)]||_0x5b901d[_0x3b0ec3(0x1ec)]||_0x3b0ec3(0x1fb)));}let _0x4739e9=_0x3b0ec3(0x231);return{'status':_0x4739e9};}catch(_0x439676){console['error'](_0x3b0ec3(0x24b),_0x439676),loggerService_1['loggerService'][_0x3b0ec3(0x1f1)]('plisio_direct','/operations/'+_0x171727,_0x439676);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x439676 instanceof Error?_0x439676[_0x3b0ec3(0x1ea)]:_0x3b0ec3(0x1fb)));}}async['processWebhook'](_0x3073cd){const _0x3d7866=a55_0x21fc3b;console[_0x3d7866(0x20b)]('Processing\x20Plisio\x20webhook:',_0x3073cd);let _0x1dad50=_0x3d7866(0x231);switch(_0x3073cd['status']?.[_0x3d7866(0x208)]()){case _0x3d7866(0x21c):case _0x3d7866(0x239):_0x1dad50=_0x3d7866(0x1e4);break;case'expired':_0x1dad50=_0x3d7866(0x1e6);break;case _0x3d7866(0x1ec):case'cancelled':_0x1dad50=_0x3d7866(0x21d);break;case _0x3d7866(0x1de):_0x1dad50='PENDING';break;case _0x3d7866(0x238):_0x1dad50=_0x3d7866(0x222);break;default:_0x1dad50='PENDING';break;}let _0x9d8d20;if(_0x3073cd[_0x3d7866(0x23d)])try{console[_0x3d7866(0x20b)](_0x3d7866(0x21a),_0x3073cd[_0x3d7866(0x23d)]);let _0x4e3d02;if(typeof _0x3073cd[_0x3d7866(0x23d)]===_0x3d7866(0x249))_0x4e3d02=JSON['parse'](_0x3073cd[_0x3d7866(0x23d)]);else Array[_0x3d7866(0x23e)](_0x3073cd['tx_urls'])?_0x4e3d02=_0x3073cd[_0x3d7866(0x23d)]:_0x4e3d02=[];_0x9d8d20=_0x4e3d02[_0x3d7866(0x1f0)](_0x215f7e=>{const _0x3f5fcd=_0x3d7866,_0x4d64d8=_0x215f7e[_0x3f5fcd(0x226)](/\\/g,'');return console['log'](_0x3f5fcd(0x1df)+_0x215f7e+_0x3f5fcd(0x253)+_0x4d64d8),_0x4d64d8;}),console[_0x3d7866(0x20b)]('✅\x20Processed\x20tx_urls:',_0x9d8d20),_0x9d8d20['forEach']((_0x35650a,_0x105229)=>{const _0x4fe548=_0x3d7866;try{new URL(_0x35650a),console[_0x4fe548(0x20b)](_0x4fe548(0x24e)+(_0x105229+0x1)+'\x20is\x20valid:\x20'+_0x35650a);}catch(_0x3373b5){console[_0x4fe548(0x1ec)](_0x4fe548(0x22e)+(_0x105229+0x1)+'\x20is\x20invalid:\x20'+_0x35650a,_0x3373b5);}});}catch(_0x5c646a){console[_0x3d7866(0x1ec)](_0x3d7866(0x224),_0x5c646a),console[_0x3d7866(0x1ec)](_0x3d7866(0x22d),_0x3073cd['tx_urls']),_0x9d8d20=undefined;}return{'paymentId':_0x3073cd[_0x3d7866(0x252)]||'','status':_0x1dad50,'amount':_0x3073cd[_0x3d7866(0x232)],'currency':_0x3073cd[_0x3d7866(0x1f7)],'txUrls':_0x9d8d20};}}exports['PlisioService']=PlisioService;