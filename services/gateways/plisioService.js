'use strict';const a49_0x18f66f=a49_0x10db;function a49_0x23dd(){const _0x543c73=['FAILED','name','message','Parameters:','Error\x20details:','createPayment','logWhiteDomainResponse','stack','application/json','648NavthZ','https://api.trapay.uk/api/webhooks/gateway/plisio','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','‚úÖ\x20URL\x20','4184QzIZHS','https://api.plisio.net/api/v1/invoices/new','1661576yctZil','Invoice\x20URL:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','TesSoft\x20Payment\x20System/1.0','14055xfqQQO','1xOfcbA','isArray','Plisio\x20payment\x20verification\x20error:','HTTP\x20','/invoices/new','/operations/','apiUrl','logWhiteDomainError','Error\x20stack:','completed','Amount:','env','new','141471auohGP','366DQtHqf','Plisio\x20API\x20error:\x20','statusText','Failed\x20to\x20parse\x20JSON\x20response:','PAID','===\x20PLISIO\x20SUCCESS\x20===','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','Parsed\x20Result:','Full\x20URL\x20(without\x20API\x20key):','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','logWhiteDomainRequest','EXPIRED','source_currency','processWebhook','3582908TVUhBp','GET','toString','HTTP\x20error!\x20status:\x20','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','apiKey','success','54FitjPf','error','entries','üîó\x20Formatted\x20URL:\x20','status','PENDING','email','Raw\x20Response\x20Body:','qr_code','cancelled','Status:','replace','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','JSON\x20Parse\x20Error:\x20','../loggerService','order_number','data','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','forEach','PlisioService','parse','loggerService','string','Unknown\x20error','qr_url','Business\x20Error:\x20','Source\x20Currency:','fromEntries','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','verifyPayment','‚ùå\x20URL\x20','log','4024540volKmW','URL:','now',',\x20body:\x20','map','Unknown\x20error\x20from\x20Plisio\x20API','txn_id','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','tx_urls','1204634yePoPp','plisio_direct','text','toLowerCase','defineProperty','source_amount','\x20is\x20valid:\x20','currency','Response\x20Body:','json','‚úÖ\x20Processed\x20tx_urls:','warn','amount','append','18YxuFAX','===\x20PLISIO\x20API\x20ERROR\x20===','Error\x20message:','\x20->\x20','Target\x20Currency:','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','PLISIO_API_KEY','pending','invoice_url','(fiat\x20for\x20merchant)','Plisio\x20API\x20key\x20is\x20not\x20configured','Response\x20Time:'];a49_0x23dd=function(){return _0x543c73;};return a49_0x23dd();}(function(_0x407f89,_0x28fbb4){const _0x32119c=a49_0x10db,_0x370b29=_0x407f89();while(!![]){try{const _0x332e41=-parseInt(_0x32119c(0x13b))/0x1*(-parseInt(_0x32119c(0x187))/0x2)+-parseInt(_0x32119c(0x149))/0x3*(-parseInt(_0x32119c(0x134))/0x4)+-parseInt(_0x32119c(0x13a))/0x5*(parseInt(_0x32119c(0x15e))/0x6)+-parseInt(_0x32119c(0x157))/0x7+parseInt(_0x32119c(0x136))/0x8*(parseInt(_0x32119c(0x195))/0x9)+parseInt(_0x32119c(0x17e))/0xa+parseInt(_0x32119c(0x148))/0xb*(-parseInt(_0x32119c(0x1aa))/0xc);if(_0x332e41===_0x28fbb4)break;else _0x370b29['push'](_0x370b29['shift']());}catch(_0x5f23e){_0x370b29['push'](_0x370b29['shift']());}}}(a49_0x23dd,0x4d2ec));Object[a49_0x18f66f(0x18b)](exports,'__esModule',{'value':!![]}),exports[a49_0x18f66f(0x171)]=void 0x0;function a49_0x10db(_0xa605d8,_0x5437fb){const _0x23dd37=a49_0x23dd();return a49_0x10db=function(_0x10db54,_0x1d3c2c){_0x10db54=_0x10db54-0x133;let _0x55be22=_0x23dd37[_0x10db54];return _0x55be22;},a49_0x10db(_0xa605d8,_0x5437fb);}const loggerService_1=require(a49_0x18f66f(0x16c));class PlisioService{constructor(){const _0x3da75f=a49_0x18f66f;this[_0x3da75f(0x141)]=_0x3da75f(0x135),this[_0x3da75f(0x15c)]=process[_0x3da75f(0x146)][_0x3da75f(0x19b)]||'',!this[_0x3da75f(0x15c)]?console[_0x3da75f(0x192)]('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x3da75f(0x17d)](_0x3da75f(0x152));}async[a49_0x18f66f(0x1a6)](_0xff4b44){const _0xca2a4d=a49_0x18f66f,{orderId:_0x47a8b4,amount:_0x2e142c,currency:_0x4b7a21,productName:_0x293efb,description:_0x610285,successUrl:_0x33dec4,failUrl:_0x19325e,customerEmail:_0x16dc6e,customerName:_0x5cfd72,isSourceCurrency:_0x5ea0a3,sourceCurrency:_0x40352c}=_0xff4b44;if(!this[_0xca2a4d(0x15c)])throw new Error(_0xca2a4d(0x19f));const _0x2adbc8=new URLSearchParams({'api_key':this[_0xca2a4d(0x15c)],'order_number':_0x47a8b4,'order_name':_0x293efb,'description':_0x610285,'success_url':_0x33dec4,'fail_url':_0x19325e,'callback_url':_0xca2a4d(0x1ab)});_0x40352c?(_0x2adbc8['append']('currency',_0x40352c),_0x2adbc8[_0xca2a4d(0x194)](_0xca2a4d(0x155),_0x4b7a21),_0x2adbc8[_0xca2a4d(0x194)](_0xca2a4d(0x18c),_0x2e142c[_0xca2a4d(0x159)]())):(_0x2adbc8['append'](_0xca2a4d(0x18e),_0x4b7a21),_0x2adbc8[_0xca2a4d(0x194)](_0xca2a4d(0x193),_0x2e142c[_0xca2a4d(0x159)]()));_0x16dc6e&&_0x2adbc8[_0xca2a4d(0x194)](_0xca2a4d(0x164),_0x16dc6e);_0x5cfd72&&_0x2adbc8[_0xca2a4d(0x194)](_0xca2a4d(0x1a2),_0x5cfd72);const _0x5452d4=this[_0xca2a4d(0x141)]+'?'+_0x2adbc8[_0xca2a4d(0x159)](),_0x2d87b4=Date[_0xca2a4d(0x180)]();try{console[_0xca2a4d(0x17d)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0xca2a4d(0x17d)](_0xca2a4d(0x17f),this[_0xca2a4d(0x141)]),console[_0xca2a4d(0x17d)](_0xca2a4d(0x1a4),Object[_0xca2a4d(0x179)](_0x2adbc8[_0xca2a4d(0x160)]())),console['log'](_0xca2a4d(0x151),_0x5452d4[_0xca2a4d(0x169)](this[_0xca2a4d(0x15c)],'HIDDEN')),loggerService_1['loggerService'][_0xca2a4d(0x153)](_0xca2a4d(0x188),_0xca2a4d(0x13f),'GET',Object[_0xca2a4d(0x179)](_0x2adbc8[_0xca2a4d(0x160)]()));const _0x50ad0b=await fetch(_0x5452d4,{'method':_0xca2a4d(0x158),'headers':{'Accept':_0xca2a4d(0x1a9),'User-Agent':_0xca2a4d(0x139)}}),_0x20a861=Date[_0xca2a4d(0x180)]()-_0x2d87b4;console[_0xca2a4d(0x17d)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0xca2a4d(0x17d)](_0xca2a4d(0x168),_0x50ad0b[_0xca2a4d(0x162)]),console[_0xca2a4d(0x17d)]('Status\x20Text:',_0x50ad0b[_0xca2a4d(0x14b)]),console[_0xca2a4d(0x17d)](_0xca2a4d(0x1a0),_0x20a861+'ms');const _0x1bd7b9=await _0x50ad0b[_0xca2a4d(0x189)]();console[_0xca2a4d(0x17d)](_0xca2a4d(0x165),_0x1bd7b9);if(!_0x50ad0b['ok']){console[_0xca2a4d(0x15f)](_0xca2a4d(0x196)),console[_0xca2a4d(0x15f)]('HTTP\x20Status:',_0x50ad0b['status']),console[_0xca2a4d(0x15f)](_0xca2a4d(0x18f),_0x1bd7b9),loggerService_1[_0xca2a4d(0x173)][_0xca2a4d(0x1a7)](_0xca2a4d(0x188),'/invoices/new',_0x50ad0b[_0xca2a4d(0x162)],_0x1bd7b9,_0x20a861),loggerService_1['loggerService'][_0xca2a4d(0x142)](_0xca2a4d(0x188),_0xca2a4d(0x13f),_0xca2a4d(0x13e)+_0x50ad0b[_0xca2a4d(0x162)]+':\x20'+_0x1bd7b9);throw new Error(_0xca2a4d(0x15a)+_0x50ad0b[_0xca2a4d(0x162)]+_0xca2a4d(0x181)+_0x1bd7b9);}let _0xa63507;try{_0xa63507=JSON[_0xca2a4d(0x172)](_0x1bd7b9);}catch(_0x13c80e){console[_0xca2a4d(0x15f)](_0xca2a4d(0x14c),_0x13c80e),loggerService_1[_0xca2a4d(0x173)][_0xca2a4d(0x142)]('plisio_direct',_0xca2a4d(0x13f),_0xca2a4d(0x16b)+_0x13c80e);throw new Error(_0xca2a4d(0x16f)+_0x1bd7b9);}console[_0xca2a4d(0x17d)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console['log'](_0xca2a4d(0x150),JSON['stringify'](_0xa63507,null,0x2)),loggerService_1[_0xca2a4d(0x173)][_0xca2a4d(0x1a7)](_0xca2a4d(0x188),_0xca2a4d(0x13f),_0x50ad0b['status'],_0xa63507,_0x20a861);if(_0xa63507[_0xca2a4d(0x162)]!=='success'){const _0x5bf48c=_0xa63507[_0xca2a4d(0x1a3)]||_0xa63507[_0xca2a4d(0x15f)]||_0xca2a4d(0x183);console[_0xca2a4d(0x15f)](_0xca2a4d(0x16a)),console[_0xca2a4d(0x15f)]('Error\x20Message:',_0x5bf48c),loggerService_1[_0xca2a4d(0x173)][_0xca2a4d(0x142)]('plisio_direct',_0xca2a4d(0x13f),_0xca2a4d(0x177)+_0x5bf48c);throw new Error(_0xca2a4d(0x14a)+_0x5bf48c);}if(!_0xa63507['data']?.[_0xca2a4d(0x184)]||!_0xa63507['data']?.['invoice_url']){console[_0xca2a4d(0x15f)](_0xca2a4d(0x17a)),console['error']('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0xca2a4d(0x15f)]('Response\x20data:',_0xa63507[_0xca2a4d(0x16e)]),loggerService_1[_0xca2a4d(0x173)]['logWhiteDomainError']('plisio_direct',_0xca2a4d(0x13f),_0xca2a4d(0x15b));throw new Error(_0xca2a4d(0x138));}return console['log'](_0xca2a4d(0x14e)),console[_0xca2a4d(0x17d)]('Transaction\x20ID:',_0xa63507[_0xca2a4d(0x16e)][_0xca2a4d(0x184)]),console[_0xca2a4d(0x17d)](_0xca2a4d(0x137),_0xa63507['data'][_0xca2a4d(0x19d)]),console[_0xca2a4d(0x17d)](_0xca2a4d(0x145),_0x2e142c,_0x4b7a21),_0x40352c&&(console['log'](_0xca2a4d(0x178),_0x40352c,'(crypto\x20for\x20payment)'),console[_0xca2a4d(0x17d)](_0xca2a4d(0x199),_0x4b7a21,_0xca2a4d(0x19e))),{'gateway_payment_id':_0xa63507[_0xca2a4d(0x16e)]['txn_id'],'payment_url':_0xa63507[_0xca2a4d(0x16e)]['invoice_url'],'invoice_total_sum':_0xa63507[_0xca2a4d(0x16e)]['invoice_total_sum'],'qr_code':_0xa63507[_0xca2a4d(0x16e)][_0xca2a4d(0x166)],'qr_url':_0xa63507['data'][_0xca2a4d(0x176)]};}catch(_0x262ee0){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console['error'](_0xca2a4d(0x1a5),_0x262ee0),loggerService_1['loggerService'][_0xca2a4d(0x142)]('plisio_direct','/invoices/new',_0x262ee0);if(_0x262ee0 instanceof Error){console['error'](_0xca2a4d(0x197),_0x262ee0[_0xca2a4d(0x1a3)]),console[_0xca2a4d(0x15f)](_0xca2a4d(0x143),_0x262ee0[_0xca2a4d(0x1a8)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x262ee0[_0xca2a4d(0x1a3)]);}throw new Error(_0xca2a4d(0x19a));}}async[a49_0x18f66f(0x17b)](_0x3a0cf8){const _0x1923fc=a49_0x18f66f,_0x5bf15a=Date[_0x1923fc(0x180)]();try{if(!this[_0x1923fc(0x15c)])throw new Error(_0x1923fc(0x19f));const _0x302b24=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x3a0cf8}),_0x503edb='https://api.plisio.net/api/v1/operations/'+_0x3a0cf8+'?'+_0x302b24[_0x1923fc(0x159)]();loggerService_1[_0x1923fc(0x173)]['logWhiteDomainRequest']('plisio_direct','/operations/'+_0x3a0cf8,_0x1923fc(0x158),Object['fromEntries'](_0x302b24[_0x1923fc(0x160)]()));const _0x40d094=await fetch(_0x503edb,{'method':_0x1923fc(0x158),'headers':{'Accept':'application/json','User-Agent':_0x1923fc(0x139)}}),_0x33acf0=Date[_0x1923fc(0x180)]()-_0x5bf15a;if(!_0x40d094['ok']){const _0x306478=await _0x40d094[_0x1923fc(0x189)]();loggerService_1[_0x1923fc(0x173)][_0x1923fc(0x1a7)](_0x1923fc(0x188),_0x1923fc(0x140)+_0x3a0cf8,_0x40d094[_0x1923fc(0x162)],_0x306478,_0x33acf0);throw new Error(_0x1923fc(0x15a)+_0x40d094[_0x1923fc(0x162)]);}const _0x33418b=await _0x40d094[_0x1923fc(0x190)]();loggerService_1[_0x1923fc(0x173)]['logWhiteDomainResponse'](_0x1923fc(0x188),_0x1923fc(0x140)+_0x3a0cf8,_0x40d094[_0x1923fc(0x162)],_0x33418b,_0x33acf0);if(_0x33418b[_0x1923fc(0x162)]!==_0x1923fc(0x15d)){loggerService_1[_0x1923fc(0x173)][_0x1923fc(0x142)]('plisio_direct','/operations/'+_0x3a0cf8,_0x1923fc(0x14a)+(_0x33418b[_0x1923fc(0x1a3)]||_0x33418b['error']||_0x1923fc(0x175)));throw new Error(_0x1923fc(0x14a)+(_0x33418b[_0x1923fc(0x1a3)]||_0x33418b[_0x1923fc(0x15f)]||'Unknown\x20error'));}let _0x29e9fd='PENDING';return{'status':_0x29e9fd};}catch(_0x505998){console[_0x1923fc(0x15f)](_0x1923fc(0x13d),_0x505998),loggerService_1[_0x1923fc(0x173)][_0x1923fc(0x142)]('plisio_direct','/operations/'+_0x3a0cf8,_0x505998);throw new Error(_0x1923fc(0x185)+(_0x505998 instanceof Error?_0x505998[_0x1923fc(0x1a3)]:_0x1923fc(0x175)));}}async[a49_0x18f66f(0x156)](_0x2ce6d6){const _0x28c178=a49_0x18f66f;console[_0x28c178(0x17d)]('Processing\x20Plisio\x20webhook:',_0x2ce6d6);let _0x1eea66=_0x28c178(0x163);switch(_0x2ce6d6['status']?.[_0x28c178(0x18a)]()){case _0x28c178(0x144):case'mismatch':_0x1eea66=_0x28c178(0x14d);break;case'expired':_0x1eea66=_0x28c178(0x154);break;case _0x28c178(0x15f):case _0x28c178(0x167):_0x1eea66=_0x28c178(0x1a1);break;case _0x28c178(0x147):_0x1eea66=_0x28c178(0x163);break;case _0x28c178(0x19c):_0x1eea66='PROCESSING';break;default:_0x1eea66=_0x28c178(0x163);break;}let _0x47e7fd;if(_0x2ce6d6[_0x28c178(0x186)])try{console['log'](_0x28c178(0x1ac),_0x2ce6d6['tx_urls']);let _0x2e7e73;if(typeof _0x2ce6d6[_0x28c178(0x186)]===_0x28c178(0x174))_0x2e7e73=JSON[_0x28c178(0x172)](_0x2ce6d6[_0x28c178(0x186)]);else Array[_0x28c178(0x13c)](_0x2ce6d6[_0x28c178(0x186)])?_0x2e7e73=_0x2ce6d6['tx_urls']:_0x2e7e73=[];_0x47e7fd=_0x2e7e73[_0x28c178(0x182)](_0x3930ca=>{const _0x58daa1=_0x28c178,_0x19658e=_0x3930ca[_0x58daa1(0x169)](/\\/g,'');return console[_0x58daa1(0x17d)](_0x58daa1(0x161)+_0x3930ca+_0x58daa1(0x198)+_0x19658e),_0x19658e;}),console[_0x28c178(0x17d)](_0x28c178(0x191),_0x47e7fd),_0x47e7fd[_0x28c178(0x170)]((_0xc66686,_0x3e0af2)=>{const _0x4d91fb=_0x28c178;try{new URL(_0xc66686),console[_0x4d91fb(0x17d)](_0x4d91fb(0x133)+(_0x3e0af2+0x1)+_0x4d91fb(0x18d)+_0xc66686);}catch(_0x52af6d){console[_0x4d91fb(0x15f)](_0x4d91fb(0x17c)+(_0x3e0af2+0x1)+'\x20is\x20invalid:\x20'+_0xc66686,_0x52af6d);}});}catch(_0x227192){console[_0x28c178(0x15f)](_0x28c178(0x14f),_0x227192),console[_0x28c178(0x15f)]('Raw\x20tx_urls\x20data:',_0x2ce6d6[_0x28c178(0x186)]),_0x47e7fd=undefined;}return{'paymentId':_0x2ce6d6[_0x28c178(0x16d)]||'','status':_0x1eea66,'amount':_0x2ce6d6[_0x28c178(0x193)],'currency':_0x2ce6d6[_0x28c178(0x18e)],'txUrls':_0x47e7fd};}}exports[a49_0x18f66f(0x171)]=PlisioService;