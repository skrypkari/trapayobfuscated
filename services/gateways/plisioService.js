'use strict';const a55_0x21134d=a55_0x1087;(function(_0x4b1c42,_0x28a918){const _0x25db7a=a55_0x1087,_0x37cfbe=_0x4b1c42();while(!![]){try{const _0x18b63b=-parseInt(_0x25db7a(0x20c))/0x1+-parseInt(_0x25db7a(0x209))/0x2*(-parseInt(_0x25db7a(0x244))/0x3)+parseInt(_0x25db7a(0x264))/0x4+-parseInt(_0x25db7a(0x24b))/0x5*(parseInt(_0x25db7a(0x21e))/0x6)+-parseInt(_0x25db7a(0x254))/0x7+-parseInt(_0x25db7a(0x255))/0x8*(-parseInt(_0x25db7a(0x24e))/0x9)+parseInt(_0x25db7a(0x201))/0xa*(parseInt(_0x25db7a(0x240))/0xb);if(_0x18b63b===_0x28a918)break;else _0x37cfbe['push'](_0x37cfbe['shift']());}catch(_0x3d02ad){_0x37cfbe['push'](_0x37cfbe['shift']());}}}(a55_0x5279,0x66a96));Object[a55_0x21134d(0x1f8)](exports,'__esModule',{'value':!![]}),exports[a55_0x21134d(0x228)]=void 0x0;const loggerService_1=require(a55_0x21134d(0x22e));class PlisioService{constructor(){const _0x482cd4=a55_0x21134d;this[_0x482cd4(0x249)]=_0x482cd4(0x22f),this[_0x482cd4(0x25f)]=process[_0x482cd4(0x235)]['PLISIO_API_KEY']||'',!this[_0x482cd4(0x25f)]?console['warn']('⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console['log'](_0x482cd4(0x21d));}async['createPayment'](_0x268655){const _0x140d03=a55_0x21134d,{orderId:_0x5e2c4a,amount:_0x1a7617,currency:_0x58c173,productName:_0x27881e,description:_0xee1644,successUrl:_0x4c1d71,failUrl:_0x3a1809,customerEmail:_0x54e1a0,customerName:_0x495b08,isSourceCurrency:_0x2c438e,sourceCurrency:_0x26e532}=_0x268655;if(!this[_0x140d03(0x25f)])throw new Error(_0x140d03(0x224));const _0x57f7e5=new URLSearchParams({'api_key':this[_0x140d03(0x25f)],'order_number':_0x5e2c4a,'order_name':_0x27881e,'description':_0xee1644,'success_url':_0x4c1d71,'fail_url':_0x3a1809,'callback_url':_0x140d03(0x205)});_0x26e532?(_0x57f7e5[_0x140d03(0x1ed)](_0x140d03(0x1f6),_0x26e532),_0x57f7e5[_0x140d03(0x1ed)]('source_currency',_0x58c173),_0x57f7e5[_0x140d03(0x1ed)](_0x140d03(0x23a),_0x1a7617[_0x140d03(0x1ee)]())):(_0x57f7e5[_0x140d03(0x1ed)]('currency',_0x58c173),_0x57f7e5[_0x140d03(0x1ed)]('amount',_0x1a7617['toString']()));_0x54e1a0&&_0x57f7e5[_0x140d03(0x1ed)](_0x140d03(0x256),_0x54e1a0);_0x495b08&&_0x57f7e5[_0x140d03(0x1ed)]('name',_0x495b08);const _0x3b2543=this[_0x140d03(0x249)]+'?'+_0x57f7e5[_0x140d03(0x1ee)](),_0x23133d=Date[_0x140d03(0x22a)]();try{console[_0x140d03(0x1f3)](_0x140d03(0x21c)),console['log'](_0x140d03(0x253),this[_0x140d03(0x249)]),console[_0x140d03(0x1f3)](_0x140d03(0x259),Object[_0x140d03(0x24a)](_0x57f7e5[_0x140d03(0x25a)]())),console[_0x140d03(0x1f3)](_0x140d03(0x217),_0x3b2543[_0x140d03(0x213)](this[_0x140d03(0x25f)],_0x140d03(0x21b))),loggerService_1['loggerService'][_0x140d03(0x20a)](_0x140d03(0x269),_0x140d03(0x231),_0x140d03(0x251),Object[_0x140d03(0x24a)](_0x57f7e5['entries']()));const _0x188882=await fetch(_0x3b2543,{'method':_0x140d03(0x251),'headers':{'Accept':_0x140d03(0x1f1),'User-Agent':_0x140d03(0x20b)}}),_0x43988b=Date[_0x140d03(0x22a)]()-_0x23133d;console['log'](_0x140d03(0x218)),console[_0x140d03(0x1f3)]('Status:',_0x188882[_0x140d03(0x1ef)]),console['log'](_0x140d03(0x24f),_0x188882[_0x140d03(0x20d)]),console['log'](_0x140d03(0x22c),_0x43988b+'ms');const _0x4a5989=await _0x188882[_0x140d03(0x232)]();console[_0x140d03(0x1f3)](_0x140d03(0x223),_0x4a5989);if(!_0x188882['ok']){console[_0x140d03(0x250)](_0x140d03(0x23c)),console[_0x140d03(0x250)](_0x140d03(0x227),_0x188882[_0x140d03(0x1ef)]),console['error'](_0x140d03(0x252),_0x4a5989),loggerService_1[_0x140d03(0x26a)][_0x140d03(0x258)](_0x140d03(0x269),_0x140d03(0x231),_0x188882[_0x140d03(0x1ef)],_0x4a5989,_0x43988b),loggerService_1[_0x140d03(0x26a)]['logWhiteDomainError'](_0x140d03(0x269),'/invoices/new',_0x140d03(0x20f)+_0x188882[_0x140d03(0x1ef)]+':\x20'+_0x4a5989);throw new Error(_0x140d03(0x245)+_0x188882['status']+_0x140d03(0x23d)+_0x4a5989);}let _0x133de1;try{_0x133de1=JSON[_0x140d03(0x238)](_0x4a5989);}catch(_0x37dcfb){console['error'](_0x140d03(0x1f4),_0x37dcfb),loggerService_1[_0x140d03(0x26a)]['logWhiteDomainError'](_0x140d03(0x269),'/invoices/new',_0x140d03(0x22d)+_0x37dcfb);throw new Error(_0x140d03(0x257)+_0x4a5989);}console[_0x140d03(0x1f3)](_0x140d03(0x1ff)),console[_0x140d03(0x1f3)](_0x140d03(0x206),JSON[_0x140d03(0x25e)](_0x133de1,null,0x2)),loggerService_1['loggerService'][_0x140d03(0x258)](_0x140d03(0x269),'/invoices/new',_0x188882['status'],_0x133de1,_0x43988b);if(_0x133de1['status']!==_0x140d03(0x230)){const _0x181379=_0x133de1[_0x140d03(0x24c)]||_0x133de1[_0x140d03(0x250)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x140d03(0x250)](_0x140d03(0x204)),console[_0x140d03(0x250)](_0x140d03(0x248),_0x181379),loggerService_1[_0x140d03(0x26a)][_0x140d03(0x22b)](_0x140d03(0x269),_0x140d03(0x231),_0x140d03(0x23e)+_0x181379);throw new Error(_0x140d03(0x247)+_0x181379);}if(!_0x133de1[_0x140d03(0x25b)]?.[_0x140d03(0x229)]||!_0x133de1[_0x140d03(0x25b)]?.[_0x140d03(0x202)]){console[_0x140d03(0x250)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x140d03(0x250)](_0x140d03(0x239)),console[_0x140d03(0x250)](_0x140d03(0x24d),_0x133de1[_0x140d03(0x25b)]),loggerService_1[_0x140d03(0x26a)]['logWhiteDomainError'](_0x140d03(0x269),_0x140d03(0x231),_0x140d03(0x23f));throw new Error(_0x140d03(0x220));}return console['log'](_0x140d03(0x23b)),console[_0x140d03(0x1f3)](_0x140d03(0x226),_0x133de1['data'][_0x140d03(0x229)]),console[_0x140d03(0x1f3)](_0x140d03(0x1fe),_0x133de1[_0x140d03(0x25b)]['invoice_url']),console[_0x140d03(0x1f3)]('Amount:',_0x1a7617,_0x58c173),_0x26e532&&(console[_0x140d03(0x1f3)](_0x140d03(0x219),_0x26e532,_0x140d03(0x1f7)),console[_0x140d03(0x1f3)](_0x140d03(0x241),_0x58c173,_0x140d03(0x234))),{'gateway_payment_id':_0x133de1['data'][_0x140d03(0x229)],'payment_url':_0x133de1['data'][_0x140d03(0x202)],'invoice_total_sum':_0x133de1['data'][_0x140d03(0x1f5)],'qr_code':_0x133de1[_0x140d03(0x25b)][_0x140d03(0x1f9)],'qr_url':_0x133de1[_0x140d03(0x25b)][_0x140d03(0x233)]};}catch(_0x10b786){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x140d03(0x250)]('Error\x20details:',_0x10b786),loggerService_1['loggerService'][_0x140d03(0x22b)]('plisio_direct',_0x140d03(0x231),_0x10b786);if(_0x10b786 instanceof Error){console[_0x140d03(0x250)](_0x140d03(0x1fb),_0x10b786[_0x140d03(0x24c)]),console[_0x140d03(0x250)](_0x140d03(0x1fa),_0x10b786[_0x140d03(0x210)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x10b786[_0x140d03(0x24c)]);}throw new Error(_0x140d03(0x208));}}async[a55_0x21134d(0x200)](_0x1d7ef3){const _0x15d328=a55_0x21134d,_0x52f3e0=Date['now']();try{if(!this[_0x15d328(0x25f)])throw new Error(_0x15d328(0x224));const _0x2fa9d1=new URLSearchParams({'api_key':this[_0x15d328(0x25f)],'txn_id':_0x1d7ef3}),_0x4e11ee=_0x15d328(0x1fc)+_0x1d7ef3+'?'+_0x2fa9d1['toString']();loggerService_1[_0x15d328(0x26a)]['logWhiteDomainRequest'](_0x15d328(0x269),_0x15d328(0x266)+_0x1d7ef3,'GET',Object[_0x15d328(0x24a)](_0x2fa9d1[_0x15d328(0x25a)]()));const _0x4f3b75=await fetch(_0x4e11ee,{'method':_0x15d328(0x251),'headers':{'Accept':'application/json','User-Agent':_0x15d328(0x20b)}}),_0x49fa0c=Date[_0x15d328(0x22a)]()-_0x52f3e0;if(!_0x4f3b75['ok']){const _0x24298a=await _0x4f3b75['text']();loggerService_1[_0x15d328(0x26a)]['logWhiteDomainResponse'](_0x15d328(0x269),_0x15d328(0x266)+_0x1d7ef3,_0x4f3b75['status'],_0x24298a,_0x49fa0c);throw new Error(_0x15d328(0x245)+_0x4f3b75[_0x15d328(0x1ef)]);}const _0x2c6721=await _0x4f3b75['json']();loggerService_1[_0x15d328(0x26a)][_0x15d328(0x258)](_0x15d328(0x269),_0x15d328(0x266)+_0x1d7ef3,_0x4f3b75[_0x15d328(0x1ef)],_0x2c6721,_0x49fa0c);if(_0x2c6721['status']!=='success'){loggerService_1[_0x15d328(0x26a)]['logWhiteDomainError'](_0x15d328(0x269),'/operations/'+_0x1d7ef3,_0x15d328(0x247)+(_0x2c6721[_0x15d328(0x24c)]||_0x2c6721[_0x15d328(0x250)]||_0x15d328(0x25d)));throw new Error(_0x15d328(0x247)+(_0x2c6721[_0x15d328(0x24c)]||_0x2c6721[_0x15d328(0x250)]||_0x15d328(0x25d)));}let _0x2c47be=_0x15d328(0x215);return{'status':_0x2c47be};}catch(_0x2ad593){console['error'](_0x15d328(0x25c),_0x2ad593),loggerService_1['loggerService'][_0x15d328(0x22b)]('plisio_direct',_0x15d328(0x266)+_0x1d7ef3,_0x2ad593);throw new Error(_0x15d328(0x261)+(_0x2ad593 instanceof Error?_0x2ad593[_0x15d328(0x24c)]:_0x15d328(0x25d)));}}async[a55_0x21134d(0x225)](_0x2c0bf8){const _0x3524e0=a55_0x21134d;console['log'](_0x3524e0(0x1f2),_0x2c0bf8);let _0xee47a6=_0x3524e0(0x215);switch(_0x2c0bf8['status']?.[_0x3524e0(0x236)]()){case _0x3524e0(0x222):case _0x3524e0(0x267):_0xee47a6=_0x3524e0(0x216);break;case _0x3524e0(0x262):_0xee47a6=_0x3524e0(0x212);break;case _0x3524e0(0x250):case _0x3524e0(0x214):_0xee47a6=_0x3524e0(0x21f);break;case _0x3524e0(0x221):_0xee47a6='PENDING';break;case _0x3524e0(0x260):_0xee47a6=_0x3524e0(0x265);break;default:_0xee47a6=_0x3524e0(0x215);break;}let _0x3bbdfc;if(_0x2c0bf8[_0x3524e0(0x211)])try{console[_0x3524e0(0x1f3)](_0x3524e0(0x1fd),_0x2c0bf8[_0x3524e0(0x211)]);let _0x7ac9a8;if(typeof _0x2c0bf8[_0x3524e0(0x211)]===_0x3524e0(0x263))_0x7ac9a8=JSON[_0x3524e0(0x238)](_0x2c0bf8[_0x3524e0(0x211)]);else Array[_0x3524e0(0x243)](_0x2c0bf8[_0x3524e0(0x211)])?_0x7ac9a8=_0x2c0bf8[_0x3524e0(0x211)]:_0x7ac9a8=[];_0x3bbdfc=_0x7ac9a8['map'](_0x21e26f=>{const _0x5ec6dd=_0x3524e0,_0x170ca9=_0x21e26f[_0x5ec6dd(0x213)](/\\/g,'');return console[_0x5ec6dd(0x1f3)]('🔗\x20Formatted\x20URL:\x20'+_0x21e26f+_0x5ec6dd(0x21a)+_0x170ca9),_0x170ca9;}),console[_0x3524e0(0x1f3)](_0x3524e0(0x207),_0x3bbdfc),_0x3bbdfc[_0x3524e0(0x268)]((_0x401d94,_0x33709f)=>{const _0x5f0b34=_0x3524e0;try{new URL(_0x401d94),console[_0x5f0b34(0x1f3)]('✅\x20URL\x20'+(_0x33709f+0x1)+'\x20is\x20valid:\x20'+_0x401d94);}catch(_0x3dac22){console['error'](_0x5f0b34(0x203)+(_0x33709f+0x1)+_0x5f0b34(0x246)+_0x401d94,_0x3dac22);}});}catch(_0x1682bd){console[_0x3524e0(0x250)](_0x3524e0(0x20e),_0x1682bd),console[_0x3524e0(0x250)](_0x3524e0(0x237),_0x2c0bf8[_0x3524e0(0x211)]),_0x3bbdfc=undefined;}return{'paymentId':_0x2c0bf8[_0x3524e0(0x1f0)]||'','status':_0xee47a6,'amount':_0x2c0bf8[_0x3524e0(0x242)],'currency':_0x2c0bf8[_0x3524e0(0x1f6)],'txUrls':_0x3bbdfc};}}function a55_0x5279(){const _0x1ecc05=['Parsed\x20Result:','✅\x20Processed\x20tx_urls:','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','144680QniQay','logWhiteDomainRequest','Payment\x20System/1.0','527550WMTsMU','statusText','❌\x20Failed\x20to\x20parse\x20tx_urls:','HTTP\x20','stack','tx_urls','EXPIRED','replace','cancelled','PENDING','PAID','Full\x20URL\x20(without\x20API\x20key):','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Source\x20Currency:','\x20->\x20','HIDDEN','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','248946zgubGU','FAILED','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','new','completed','Raw\x20Response\x20Body:','Plisio\x20API\x20key\x20is\x20not\x20configured','processWebhook','Transaction\x20ID:','HTTP\x20Status:','PlisioService','txn_id','now','logWhiteDomainError','Response\x20Time:','JSON\x20Parse\x20Error:\x20','../loggerService','https://api.plisio.net/api/v1/invoices/new','success','/invoices/new','text','qr_url','(fiat\x20for\x20merchant)','env','toLowerCase','Raw\x20tx_urls\x20data:','parse','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','source_amount','===\x20PLISIO\x20SUCCESS\x20===','===\x20PLISIO\x20API\x20ERROR\x20===',',\x20body:\x20','Business\x20Error:\x20','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','1889162cJcdhI','Target\x20Currency:','amount','isArray','12rzlmtT','HTTP\x20error!\x20status:\x20','\x20is\x20invalid:\x20','Plisio\x20API\x20error:\x20','Error\x20Message:','apiUrl','fromEntries','20SWPccL','message','Response\x20data:','9ytmnBS','Status\x20Text:','error','GET','Response\x20Body:','URL:','644966QGliwk','4859392SWRiGF','email','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','logWhiteDomainResponse','Parameters:','entries','data','Plisio\x20payment\x20verification\x20error:','Unknown\x20error','stringify','apiKey','pending','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','expired','string','550512pLCOav','PROCESSING','/operations/','mismatch','forEach','plisio_direct','loggerService','append','toString','status','order_number','application/json','Processing\x20Plisio\x20webhook:','log','Failed\x20to\x20parse\x20JSON\x20response:','invoice_total_sum','currency','(crypto\x20for\x20payment)','defineProperty','qr_code','Error\x20stack:','Error\x20message:','https://api.plisio.net/api/v1/operations/','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','Invoice\x20URL:','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','verifyPayment','10ftkgmJ','invoice_url','❌\x20URL\x20','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','https://api.trapay.uk/api/webhooks/gateway/plisio'];a55_0x5279=function(){return _0x1ecc05;};return a55_0x5279();}function a55_0x1087(_0x1ada65,_0x1ee15b){const _0x5279ef=a55_0x5279();return a55_0x1087=function(_0x10870c,_0x12788a){_0x10870c=_0x10870c-0x1ed;let _0x473210=_0x5279ef[_0x10870c];return _0x473210;},a55_0x1087(_0x1ada65,_0x1ee15b);}exports[a55_0x21134d(0x228)]=PlisioService;