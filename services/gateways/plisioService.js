'use strict';const a48_0x4bc275=a48_0x2ee1;(function(_0x1b54bd,_0x12d8a6){const _0x131dc1=a48_0x2ee1,_0x5ed154=_0x1b54bd();while(!![]){try{const _0x357b0c=-parseInt(_0x131dc1(0xd2))/0x1+parseInt(_0x131dc1(0xd1))/0x2+parseInt(_0x131dc1(0xb2))/0x3+parseInt(_0x131dc1(0xf5))/0x4*(-parseInt(_0x131dc1(0xf4))/0x5)+-parseInt(_0x131dc1(0xbf))/0x6+-parseInt(_0x131dc1(0x101))/0x7*(parseInt(_0x131dc1(0xac))/0x8)+parseInt(_0x131dc1(0x10c))/0x9;if(_0x357b0c===_0x12d8a6)break;else _0x5ed154['push'](_0x5ed154['shift']());}catch(_0x7b1fda){_0x5ed154['push'](_0x5ed154['shift']());}}}(a48_0x4320,0x9fd49));Object['defineProperty'](exports,a48_0x4bc275(0x10e),{'value':!![]}),exports[a48_0x4bc275(0xbb)]=void 0x0;const loggerService_1=require('../loggerService');function a48_0x2ee1(_0x3a5ff1,_0x3ce399){const _0x4320a5=a48_0x4320();return a48_0x2ee1=function(_0x2ee1a2,_0x371ed8){_0x2ee1a2=_0x2ee1a2-0xa4;let _0x19093d=_0x4320a5[_0x2ee1a2];return _0x19093d;},a48_0x2ee1(_0x3a5ff1,_0x3ce399);}class PlisioService{constructor(){const _0x580a8e=a48_0x4bc275;this['apiUrl']=_0x580a8e(0xc4),this[_0x580a8e(0x107)]=process[_0x580a8e(0xfc)][_0x580a8e(0xaa)]||'',!this['apiKey']?console['warn'](_0x580a8e(0xd3)):console['log']('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a48_0x4bc275(0x114)](_0x52800d){const _0x238a9b=a48_0x4bc275,{orderId:_0x3f50aa,amount:_0x110c4d,currency:_0x222613,productName:_0xf3c53,description:_0x24b3f8,successUrl:_0x13ecbc,failUrl:_0x4f0fcd,customerEmail:_0x113ef2,customerName:_0x325caa,isSourceCurrency:_0x23d95f,sourceCurrency:_0x57c547}=_0x52800d;if(!this[_0x238a9b(0x107)])throw new Error(_0x238a9b(0xea));const _0x5ed4fd=new URLSearchParams({'api_key':this[_0x238a9b(0x107)],'order_number':_0x3f50aa,'order_name':_0xf3c53,'description':_0x24b3f8,'success_url':_0x13ecbc,'fail_url':_0x4f0fcd,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x57c547?(_0x5ed4fd[_0x238a9b(0xb9)]('currency',_0x57c547),_0x5ed4fd[_0x238a9b(0xb9)](_0x238a9b(0xf3),_0x222613),_0x5ed4fd[_0x238a9b(0xb9)](_0x238a9b(0xd7),_0x110c4d[_0x238a9b(0xab)]())):(_0x5ed4fd[_0x238a9b(0xb9)]('currency',_0x222613),_0x5ed4fd['append']('amount',_0x110c4d[_0x238a9b(0xab)]()));_0x113ef2&&_0x5ed4fd[_0x238a9b(0xb9)]('email',_0x113ef2);_0x325caa&&_0x5ed4fd[_0x238a9b(0xb9)]('name',_0x325caa);const _0x38bd9c=this[_0x238a9b(0xc7)]+'?'+_0x5ed4fd[_0x238a9b(0xab)](),_0x89995a=Date[_0x238a9b(0xfa)]();try{console[_0x238a9b(0xd6)](_0x238a9b(0x10a)),console[_0x238a9b(0xd6)](_0x238a9b(0xad),this[_0x238a9b(0xc7)]),console['log'](_0x238a9b(0xbe),Object[_0x238a9b(0xb8)](_0x5ed4fd[_0x238a9b(0xc0)]())),console[_0x238a9b(0xd6)](_0x238a9b(0xe2),_0x38bd9c[_0x238a9b(0xef)](this[_0x238a9b(0x107)],_0x238a9b(0xba))),loggerService_1[_0x238a9b(0x111)]['logWhiteDomainRequest'](_0x238a9b(0xfd),_0x238a9b(0xf2),_0x238a9b(0xaf),Object[_0x238a9b(0xb8)](_0x5ed4fd[_0x238a9b(0xc0)]()));const _0x1a9570=await fetch(_0x38bd9c,{'method':_0x238a9b(0xaf),'headers':{'Accept':_0x238a9b(0xb6),'User-Agent':_0x238a9b(0xf6)}}),_0x4fae6d=Date['now']()-_0x89995a;console[_0x238a9b(0xd6)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x238a9b(0xd6)](_0x238a9b(0xcf),_0x1a9570[_0x238a9b(0xe9)]),console[_0x238a9b(0xd6)](_0x238a9b(0xb1),_0x1a9570[_0x238a9b(0xa9)]),console[_0x238a9b(0xd6)](_0x238a9b(0xf1),_0x4fae6d+'ms');const _0x5c0b5a=await _0x1a9570[_0x238a9b(0xe7)]();console[_0x238a9b(0xd6)](_0x238a9b(0xdd),_0x5c0b5a);if(!_0x1a9570['ok']){console[_0x238a9b(0x105)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x238a9b(0x105)]('HTTP\x20Status:',_0x1a9570[_0x238a9b(0xe9)]),console[_0x238a9b(0x105)]('Response\x20Body:',_0x5c0b5a),loggerService_1['loggerService'][_0x238a9b(0x103)](_0x238a9b(0xfd),_0x238a9b(0xf2),_0x1a9570[_0x238a9b(0xe9)],_0x5c0b5a,_0x4fae6d),loggerService_1[_0x238a9b(0x111)][_0x238a9b(0xa7)]('plisio_direct',_0x238a9b(0xf2),'HTTP\x20'+_0x1a9570['status']+':\x20'+_0x5c0b5a);throw new Error(_0x238a9b(0x110)+_0x1a9570[_0x238a9b(0xe9)]+_0x238a9b(0x102)+_0x5c0b5a);}let _0x4937e1;try{_0x4937e1=JSON[_0x238a9b(0xc6)](_0x5c0b5a);}catch(_0x3b07e1){console[_0x238a9b(0x105)](_0x238a9b(0xa5),_0x3b07e1),loggerService_1[_0x238a9b(0x111)][_0x238a9b(0xa7)](_0x238a9b(0xfd),_0x238a9b(0xf2),_0x238a9b(0xc9)+_0x3b07e1);throw new Error(_0x238a9b(0xc8)+_0x5c0b5a);}console[_0x238a9b(0xd6)](_0x238a9b(0x106)),console[_0x238a9b(0xd6)]('Parsed\x20Result:',JSON[_0x238a9b(0x10f)](_0x4937e1,null,0x2)),loggerService_1['loggerService'][_0x238a9b(0x103)]('plisio_direct',_0x238a9b(0xf2),_0x1a9570[_0x238a9b(0xe9)],_0x4937e1,_0x4fae6d);if(_0x4937e1[_0x238a9b(0xe9)]!==_0x238a9b(0x10d)){const _0x323193=_0x4937e1[_0x238a9b(0x109)]||_0x4937e1['error']||_0x238a9b(0xeb);console['error'](_0x238a9b(0xf0)),console[_0x238a9b(0x105)](_0x238a9b(0xb7),_0x323193),loggerService_1['loggerService'][_0x238a9b(0xa7)](_0x238a9b(0xfd),_0x238a9b(0xf2),_0x238a9b(0xc1)+_0x323193);throw new Error(_0x238a9b(0xe1)+_0x323193);}if(!_0x4937e1[_0x238a9b(0xf9)]?.['txn_id']||!_0x4937e1[_0x238a9b(0xf9)]?.['invoice_url']){console[_0x238a9b(0x105)](_0x238a9b(0xe3)),console[_0x238a9b(0x105)](_0x238a9b(0xb4)),console[_0x238a9b(0x105)](_0x238a9b(0xb5),_0x4937e1['data']),loggerService_1[_0x238a9b(0x111)][_0x238a9b(0xa7)](_0x238a9b(0xfd),'/invoices/new','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console['log']('===\x20PLISIO\x20SUCCESS\x20==='),console['log'](_0x238a9b(0x112),_0x4937e1[_0x238a9b(0xf9)][_0x238a9b(0xdc)]),console[_0x238a9b(0xd6)](_0x238a9b(0x113),_0x4937e1[_0x238a9b(0xf9)][_0x238a9b(0xbc)]),console[_0x238a9b(0xd6)](_0x238a9b(0xc3),_0x110c4d,_0x222613),_0x57c547&&(console[_0x238a9b(0xd6)]('Source\x20Currency:',_0x57c547,_0x238a9b(0xb3)),console['log'](_0x238a9b(0xa8),_0x222613,_0x238a9b(0xc5))),{'gateway_payment_id':_0x4937e1['data'][_0x238a9b(0xdc)],'payment_url':_0x4937e1[_0x238a9b(0xf9)][_0x238a9b(0xbc)],'invoice_total_sum':_0x4937e1[_0x238a9b(0xf9)][_0x238a9b(0xe5)],'qr_code':_0x4937e1['data'][_0x238a9b(0xff)],'qr_url':_0x4937e1[_0x238a9b(0xf9)][_0x238a9b(0x100)]};}catch(_0x5a75fd){console[_0x238a9b(0x105)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x238a9b(0x105)](_0x238a9b(0xe8),_0x5a75fd),loggerService_1[_0x238a9b(0x111)][_0x238a9b(0xa7)](_0x238a9b(0xfd),_0x238a9b(0xf2),_0x5a75fd);if(_0x5a75fd instanceof Error){console[_0x238a9b(0x105)](_0x238a9b(0xce),_0x5a75fd['message']),console['error'](_0x238a9b(0x108),_0x5a75fd[_0x238a9b(0xd8)]);throw new Error(_0x238a9b(0xd0)+_0x5a75fd[_0x238a9b(0x109)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async['verifyPayment'](_0xda337b){const _0xc0d85b=a48_0x4bc275,_0x337abd=Date[_0xc0d85b(0xfa)]();try{if(!this['apiKey'])throw new Error(_0xc0d85b(0xea));const _0x3404aa=new URLSearchParams({'api_key':this[_0xc0d85b(0x107)],'txn_id':_0xda337b}),_0xd0552a='https://api.plisio.net/api/v1/operations/'+_0xda337b+'?'+_0x3404aa[_0xc0d85b(0xab)]();loggerService_1[_0xc0d85b(0x111)]['logWhiteDomainRequest'](_0xc0d85b(0xfd),_0xc0d85b(0x104)+_0xda337b,_0xc0d85b(0xaf),Object[_0xc0d85b(0xb8)](_0x3404aa[_0xc0d85b(0xc0)]()));const _0x34502c=await fetch(_0xd0552a,{'method':'GET','headers':{'Accept':_0xc0d85b(0xb6),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x4d00e6=Date[_0xc0d85b(0xfa)]()-_0x337abd;if(!_0x34502c['ok']){const _0x261486=await _0x34502c[_0xc0d85b(0xe7)]();loggerService_1['loggerService'][_0xc0d85b(0x103)](_0xc0d85b(0xfd),_0xc0d85b(0x104)+_0xda337b,_0x34502c['status'],_0x261486,_0x4d00e6);throw new Error(_0xc0d85b(0x110)+_0x34502c[_0xc0d85b(0xe9)]);}const _0x2f6e03=await _0x34502c[_0xc0d85b(0xdf)]();loggerService_1[_0xc0d85b(0x111)]['logWhiteDomainResponse'](_0xc0d85b(0xfd),_0xc0d85b(0x104)+_0xda337b,_0x34502c['status'],_0x2f6e03,_0x4d00e6);if(_0x2f6e03[_0xc0d85b(0xe9)]!==_0xc0d85b(0x10d)){loggerService_1['loggerService'][_0xc0d85b(0xa7)](_0xc0d85b(0xfd),_0xc0d85b(0x104)+_0xda337b,_0xc0d85b(0xe1)+(_0x2f6e03[_0xc0d85b(0x109)]||_0x2f6e03[_0xc0d85b(0x105)]||_0xc0d85b(0xde)));throw new Error(_0xc0d85b(0xe1)+(_0x2f6e03[_0xc0d85b(0x109)]||_0x2f6e03[_0xc0d85b(0x105)]||_0xc0d85b(0xde)));}let _0x179e45=_0xc0d85b(0xfe);return{'status':_0x179e45};}catch(_0x277fd2){console[_0xc0d85b(0x105)](_0xc0d85b(0xae),_0x277fd2),loggerService_1['loggerService']['logWhiteDomainError'](_0xc0d85b(0xfd),'/operations/'+_0xda337b,_0x277fd2);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x277fd2 instanceof Error?_0x277fd2[_0xc0d85b(0x109)]:'Unknown\x20error'));}}async[a48_0x4bc275(0xe6)](_0x5872de){const _0x5328c6=a48_0x4bc275;console[_0x5328c6(0xd6)](_0x5328c6(0xa4),_0x5872de);let _0x129dcb=_0x5328c6(0xfe);switch(_0x5872de[_0x5328c6(0xe9)]?.['toLowerCase']()){case _0x5328c6(0xbd):case _0x5328c6(0xb0):_0x129dcb=_0x5328c6(0xcd);break;case _0x5328c6(0xe4):_0x129dcb=_0x5328c6(0xed);break;case _0x5328c6(0x105):case'cancelled':_0x129dcb=_0x5328c6(0xd9);break;case _0x5328c6(0xe0):_0x129dcb=_0x5328c6(0xfe);break;case _0x5328c6(0xa6):_0x129dcb='PROCESSING';break;default:_0x129dcb=_0x5328c6(0xfe);break;}let _0x18a4d7;if(_0x5872de['tx_urls'])try{console[_0x5328c6(0xd6)](_0x5328c6(0xda),_0x5872de[_0x5328c6(0xdb)]);let _0x20eb92;if(typeof _0x5872de[_0x5328c6(0xdb)]===_0x5328c6(0xca))_0x20eb92=JSON['parse'](_0x5872de[_0x5328c6(0xdb)]);else Array['isArray'](_0x5872de[_0x5328c6(0xdb)])?_0x20eb92=_0x5872de['tx_urls']:_0x20eb92=[];_0x18a4d7=_0x20eb92[_0x5328c6(0xfb)](_0x11cceb=>{const _0x307634=_0x5328c6,_0x435ecd=_0x11cceb[_0x307634(0xef)](/\\/g,'');return console[_0x307634(0xd6)](_0x307634(0x10b)+_0x11cceb+_0x307634(0xd5)+_0x435ecd),_0x435ecd;}),console[_0x5328c6(0xd6)]('‚úÖ\x20Processed\x20tx_urls:',_0x18a4d7),_0x18a4d7[_0x5328c6(0xd4)]((_0x596ccb,_0x2ef711)=>{const _0x29451e=_0x5328c6;try{new URL(_0x596ccb),console[_0x29451e(0xd6)](_0x29451e(0xee)+(_0x2ef711+0x1)+_0x29451e(0xc2)+_0x596ccb);}catch(_0x4cc980){console['error']('‚ùå\x20URL\x20'+(_0x2ef711+0x1)+_0x29451e(0xf7)+_0x596ccb,_0x4cc980);}});}catch(_0x22a7a1){console['error'](_0x5328c6(0xf8),_0x22a7a1),console[_0x5328c6(0x105)](_0x5328c6(0xcb),_0x5872de['tx_urls']),_0x18a4d7=undefined;}return{'paymentId':_0x5872de[_0x5328c6(0xec)]||'','status':_0x129dcb,'amount':_0x5872de[_0x5328c6(0xcc)],'currency':_0x5872de['currency'],'txUrls':_0x18a4d7};}}function a48_0x4320(){const _0x2bc8b4=['Target\x20Currency:','statusText','PLISIO_API_KEY','toString','1013552fnrkJa','URL:','Plisio\x20payment\x20verification\x20error:','GET','mismatch','Status\x20Text:','1526703LUnbjS','(crypto\x20for\x20payment)','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','Response\x20data:','application/json','Error\x20Message:','fromEntries','append','HIDDEN','PlisioService','invoice_url','completed','Parameters:','5808150pyEibt','entries','Business\x20Error:\x20','\x20is\x20valid:\x20','Amount:','https://api.plisio.net/api/v1/invoices/new','(fiat\x20for\x20merchant)','parse','apiUrl','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','JSON\x20Parse\x20Error:\x20','string','Raw\x20tx_urls\x20data:','amount','PAID','Error\x20message:','Status:','Failed\x20to\x20create\x20Plisio\x20payment:\x20','693870BmwFbe','901740TfLCQx','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','forEach','\x20->\x20','log','source_amount','stack','FAILED','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','tx_urls','txn_id','Raw\x20Response\x20Body:','Unknown\x20error','json','new','Plisio\x20API\x20error:\x20','Full\x20URL\x20(without\x20API\x20key):','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','expired','invoice_total_sum','processWebhook','text','Error\x20details:','status','Plisio\x20API\x20key\x20is\x20not\x20configured','Unknown\x20error\x20from\x20Plisio\x20API','order_number','EXPIRED','‚úÖ\x20URL\x20','replace','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Response\x20Time:','/invoices/new','source_currency','30dKAniv','460568CxNmbN','TesSoft\x20Payment\x20System/1.0','\x20is\x20invalid:\x20','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','data','now','map','env','plisio_direct','PENDING','qr_code','qr_url','70vOOunA',',\x20body:\x20','logWhiteDomainResponse','/operations/','error','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','apiKey','Error\x20stack:','message','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','üîó\x20Formatted\x20URL:\x20','32637474iDTJnR','success','__esModule','stringify','HTTP\x20error!\x20status:\x20','loggerService','Transaction\x20ID:','Invoice\x20URL:','createPayment','Processing\x20Plisio\x20webhook:','Failed\x20to\x20parse\x20JSON\x20response:','pending','logWhiteDomainError'];a48_0x4320=function(){return _0x2bc8b4;};return a48_0x4320();}exports[a48_0x4bc275(0xbb)]=PlisioService;