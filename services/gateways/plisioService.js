'use strict';const a51_0x12837e=a51_0x243d;(function(_0x5c20f7,_0x1ea690){const _0xf1c8df=a51_0x243d,_0x1c053e=_0x5c20f7();while(!![]){try{const _0x5a96ee=parseInt(_0xf1c8df(0x247))/0x1+-parseInt(_0xf1c8df(0x234))/0x2*(parseInt(_0xf1c8df(0x22f))/0x3)+parseInt(_0xf1c8df(0x23b))/0x4*(-parseInt(_0xf1c8df(0x22b))/0x5)+-parseInt(_0xf1c8df(0x240))/0x6*(parseInt(_0xf1c8df(0x236))/0x7)+parseInt(_0xf1c8df(0x25c))/0x8+parseInt(_0xf1c8df(0x232))/0x9*(parseInt(_0xf1c8df(0x25d))/0xa)+-parseInt(_0xf1c8df(0x241))/0xb*(-parseInt(_0xf1c8df(0x202))/0xc);if(_0x5a96ee===_0x1ea690)break;else _0x1c053e['push'](_0x1c053e['shift']());}catch(_0x3d3629){_0x1c053e['push'](_0x1c053e['shift']());}}}(a51_0x2e46,0xc1e1a));function a51_0x243d(_0x18d2c1,_0x3326d2){const _0x2e46e7=a51_0x2e46();return a51_0x243d=function(_0x243d36,_0x39eea0){_0x243d36=_0x243d36-0x1ee;let _0x3796df=_0x2e46e7[_0x243d36];return _0x3796df;},a51_0x243d(_0x18d2c1,_0x3326d2);}Object[a51_0x12837e(0x246)](exports,'__esModule',{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require('../loggerService');function a51_0x2e46(){const _0x26eb6f=['source_amount','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','mismatch','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','URL:','HTTP\x20error!\x20status:\x20','===\x20PLISIO\x20API\x20ERROR\x20===','Failed\x20to\x20create\x20Plisio\x20payment:\x20','‚ùå\x20URL\x20','Plisio\x20API\x20error:\x20','Error\x20message:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','entries','apiKey','https://api.plisio.net/api/v1/invoices/new','Status\x20Text:','\x20->\x20','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Response\x20Body:','new','6796895leEJib','PlisioService','txn_id','error','246QIkibi','Unknown\x20error\x20from\x20Plisio\x20API','Parameters:','3555621KSTKqx','warn','11062WJlnjP','verifyPayment','7fJsudf','Response\x20data:','Response\x20Time:','Amount:','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','4pfZXDR','tx_urls','invoice_total_sum','success','Full\x20URL\x20(without\x20API\x20key):','2637558rZuiXj','172513HjopPl','pending','HTTP\x20','PLISIO_API_KEY','logWhiteDomainError','defineProperty','538736NWsFRK','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','JSON\x20Parse\x20Error:\x20','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','PENDING',',\x20body:\x20','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','apiUrl','isArray','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','statusText','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','json','toString','invoice_url','toLowerCase','Raw\x20Response\x20Body:','/operations/','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Status:','completed','4057544ISeIte','30HVUcoU','now','‚úÖ\x20Processed\x20tx_urls:','currency','data','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Transaction\x20ID:','Payment\x20System/1.0','cancelled','logWhiteDomainResponse','Target\x20Currency:','string','stringify','order_number','(crypto\x20for\x20payment)','https://api.trapay.uk/api/webhooks/gateway/plisio','qr_code','PROCESSING','loggerService','log','plisio_direct','application/json','Unknown\x20error','amount','===\x20PLISIO\x20SUCCESS\x20===','624YzxQWS','status','fromEntries','Business\x20Error:\x20','env','message','parse','\x20is\x20valid:\x20','source_currency','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','map','GET','(fiat\x20for\x20merchant)','/invoices/new','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','https://api.plisio.net/api/v1/operations/','Error\x20Message:','text','email','PAID','append'];a51_0x2e46=function(){return _0x26eb6f;};return a51_0x2e46();}class PlisioService{constructor(){const _0x23fc4b=a51_0x12837e;this[_0x23fc4b(0x24e)]=_0x23fc4b(0x225),this[_0x23fc4b(0x224)]=process[_0x23fc4b(0x206)][_0x23fc4b(0x244)]||'',!this[_0x23fc4b(0x224)]?console[_0x23fc4b(0x233)](_0x23fc4b(0x24d)):console['log'](_0x23fc4b(0x252));}async['createPayment'](_0x545651){const _0x4f2957=a51_0x12837e,{orderId:_0x2bd216,amount:_0x378fbe,currency:_0x3820e4,productName:_0x297805,description:_0x5d2eec,successUrl:_0x7e31dc,failUrl:_0x1ae80e,customerEmail:_0x4c04c6,customerName:_0x4560f6,isSourceCurrency:_0xb95c6,sourceCurrency:_0x4d3a0c}=_0x545651;if(!this[_0x4f2957(0x224)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x547bd1=new URLSearchParams({'api_key':this[_0x4f2957(0x224)],'order_number':_0x2bd216,'order_name':_0x297805,'description':_0x5d2eec,'success_url':_0x7e31dc,'fail_url':_0x1ae80e,'callback_url':_0x4f2957(0x1f8)});_0x4d3a0c?(_0x547bd1[_0x4f2957(0x216)](_0x4f2957(0x260),_0x4d3a0c),_0x547bd1[_0x4f2957(0x216)](_0x4f2957(0x20a),_0x3820e4),_0x547bd1['append'](_0x4f2957(0x217),_0x378fbe['toString']())):(_0x547bd1[_0x4f2957(0x216)](_0x4f2957(0x260),_0x3820e4),_0x547bd1['append']('amount',_0x378fbe[_0x4f2957(0x254)]()));_0x4c04c6&&_0x547bd1[_0x4f2957(0x216)](_0x4f2957(0x214),_0x4c04c6);_0x4560f6&&_0x547bd1[_0x4f2957(0x216)]('name',_0x4560f6);const _0x2d3da2=this[_0x4f2957(0x24e)]+'?'+_0x547bd1[_0x4f2957(0x254)](),_0xcc6b48=Date[_0x4f2957(0x25e)]();try{console[_0x4f2957(0x1fc)](_0x4f2957(0x228)),console['log'](_0x4f2957(0x21b),this[_0x4f2957(0x24e)]),console['log'](_0x4f2957(0x231),Object['fromEntries'](_0x547bd1['entries']())),console[_0x4f2957(0x1fc)](_0x4f2957(0x23f),_0x2d3da2['replace'](this[_0x4f2957(0x224)],'HIDDEN')),loggerService_1[_0x4f2957(0x1fb)]['logWhiteDomainRequest'](_0x4f2957(0x1fd),_0x4f2957(0x20f),_0x4f2957(0x20d),Object[_0x4f2957(0x204)](_0x547bd1[_0x4f2957(0x223)]()));const _0x2b9ba0=await fetch(_0x2d3da2,{'method':_0x4f2957(0x20d),'headers':{'Accept':_0x4f2957(0x1fe),'User-Agent':_0x4f2957(0x1f0)}}),_0x1ea009=Date[_0x4f2957(0x25e)]()-_0xcc6b48;console[_0x4f2957(0x1fc)](_0x4f2957(0x1ee)),console[_0x4f2957(0x1fc)](_0x4f2957(0x25a),_0x2b9ba0[_0x4f2957(0x203)]),console[_0x4f2957(0x1fc)](_0x4f2957(0x226),_0x2b9ba0[_0x4f2957(0x251)]),console[_0x4f2957(0x1fc)](_0x4f2957(0x238),_0x1ea009+'ms');const _0x5aecfb=await _0x2b9ba0[_0x4f2957(0x213)]();console[_0x4f2957(0x1fc)](_0x4f2957(0x257),_0x5aecfb);if(!_0x2b9ba0['ok']){console[_0x4f2957(0x22e)](_0x4f2957(0x21d)),console[_0x4f2957(0x22e)]('HTTP\x20Status:',_0x2b9ba0['status']),console[_0x4f2957(0x22e)](_0x4f2957(0x229),_0x5aecfb),loggerService_1[_0x4f2957(0x1fb)][_0x4f2957(0x1f2)](_0x4f2957(0x1fd),_0x4f2957(0x20f),_0x2b9ba0[_0x4f2957(0x203)],_0x5aecfb,_0x1ea009),loggerService_1['loggerService'][_0x4f2957(0x245)](_0x4f2957(0x1fd),_0x4f2957(0x20f),_0x4f2957(0x243)+_0x2b9ba0[_0x4f2957(0x203)]+':\x20'+_0x5aecfb);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2b9ba0[_0x4f2957(0x203)]+_0x4f2957(0x24c)+_0x5aecfb);}let _0x30e824;try{_0x30e824=JSON[_0x4f2957(0x208)](_0x5aecfb);}catch(_0x5890d8){console[_0x4f2957(0x22e)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5890d8),loggerService_1[_0x4f2957(0x1fb)]['logWhiteDomainError'](_0x4f2957(0x1fd),_0x4f2957(0x20f),_0x4f2957(0x249)+_0x5890d8);throw new Error(_0x4f2957(0x218)+_0x5aecfb);}console[_0x4f2957(0x1fc)](_0x4f2957(0x250)),console[_0x4f2957(0x1fc)]('Parsed\x20Result:',JSON[_0x4f2957(0x1f5)](_0x30e824,null,0x2)),loggerService_1[_0x4f2957(0x1fb)][_0x4f2957(0x1f2)](_0x4f2957(0x1fd),_0x4f2957(0x20f),_0x2b9ba0['status'],_0x30e824,_0x1ea009);if(_0x30e824[_0x4f2957(0x203)]!==_0x4f2957(0x23e)){const _0x49c62a=_0x30e824[_0x4f2957(0x207)]||_0x30e824[_0x4f2957(0x22e)]||_0x4f2957(0x230);console[_0x4f2957(0x22e)](_0x4f2957(0x23a)),console[_0x4f2957(0x22e)](_0x4f2957(0x212),_0x49c62a),loggerService_1[_0x4f2957(0x1fb)]['logWhiteDomainError'](_0x4f2957(0x1fd),_0x4f2957(0x20f),_0x4f2957(0x205)+_0x49c62a);throw new Error(_0x4f2957(0x220)+_0x49c62a);}if(!_0x30e824[_0x4f2957(0x261)]?.[_0x4f2957(0x22d)]||!_0x30e824['data']?.[_0x4f2957(0x255)]){console[_0x4f2957(0x22e)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x4f2957(0x20b)),console[_0x4f2957(0x22e)](_0x4f2957(0x237),_0x30e824[_0x4f2957(0x261)]),loggerService_1[_0x4f2957(0x1fb)][_0x4f2957(0x245)](_0x4f2957(0x1fd),_0x4f2957(0x20f),_0x4f2957(0x222));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console['log'](_0x4f2957(0x201)),console[_0x4f2957(0x1fc)](_0x4f2957(0x1ef),_0x30e824[_0x4f2957(0x261)]['txn_id']),console[_0x4f2957(0x1fc)]('Invoice\x20URL:',_0x30e824['data']['invoice_url']),console[_0x4f2957(0x1fc)](_0x4f2957(0x239),_0x378fbe,_0x3820e4),_0x4d3a0c&&(console['log']('Source\x20Currency:',_0x4d3a0c,_0x4f2957(0x1f7)),console['log'](_0x4f2957(0x1f3),_0x3820e4,_0x4f2957(0x20e))),{'gateway_payment_id':_0x30e824['data']['txn_id'],'payment_url':_0x30e824[_0x4f2957(0x261)]['invoice_url'],'invoice_total_sum':_0x30e824[_0x4f2957(0x261)][_0x4f2957(0x23d)],'qr_code':_0x30e824[_0x4f2957(0x261)][_0x4f2957(0x1f9)],'qr_url':_0x30e824[_0x4f2957(0x261)]['qr_url']};}catch(_0x3d10ba){console['error'](_0x4f2957(0x24a)),console[_0x4f2957(0x22e)]('Error\x20details:',_0x3d10ba),loggerService_1[_0x4f2957(0x1fb)]['logWhiteDomainError'](_0x4f2957(0x1fd),_0x4f2957(0x20f),_0x3d10ba);if(_0x3d10ba instanceof Error){console[_0x4f2957(0x22e)](_0x4f2957(0x221),_0x3d10ba[_0x4f2957(0x207)]),console['error']('Error\x20stack:',_0x3d10ba['stack']);throw new Error(_0x4f2957(0x21e)+_0x3d10ba['message']);}throw new Error(_0x4f2957(0x21a));}}async[a51_0x12837e(0x235)](_0x10c186){const _0x57eae0=a51_0x12837e,_0x11afc8=Date[_0x57eae0(0x25e)]();try{if(!this[_0x57eae0(0x224)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x1daea0=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x10c186}),_0x2c2bd2=_0x57eae0(0x211)+_0x10c186+'?'+_0x1daea0[_0x57eae0(0x254)]();loggerService_1['loggerService']['logWhiteDomainRequest']('plisio_direct',_0x57eae0(0x258)+_0x10c186,'GET',Object[_0x57eae0(0x204)](_0x1daea0[_0x57eae0(0x223)]()));const _0x2559b5=await fetch(_0x2c2bd2,{'method':_0x57eae0(0x20d),'headers':{'Accept':_0x57eae0(0x1fe),'User-Agent':_0x57eae0(0x1f0)}}),_0x16b495=Date['now']()-_0x11afc8;if(!_0x2559b5['ok']){const _0x439856=await _0x2559b5[_0x57eae0(0x213)]();loggerService_1[_0x57eae0(0x1fb)][_0x57eae0(0x1f2)](_0x57eae0(0x1fd),_0x57eae0(0x258)+_0x10c186,_0x2559b5[_0x57eae0(0x203)],_0x439856,_0x16b495);throw new Error(_0x57eae0(0x21c)+_0x2559b5[_0x57eae0(0x203)]);}const _0x3d9293=await _0x2559b5[_0x57eae0(0x253)]();loggerService_1[_0x57eae0(0x1fb)][_0x57eae0(0x1f2)]('plisio_direct',_0x57eae0(0x258)+_0x10c186,_0x2559b5[_0x57eae0(0x203)],_0x3d9293,_0x16b495);if(_0x3d9293[_0x57eae0(0x203)]!==_0x57eae0(0x23e)){loggerService_1[_0x57eae0(0x1fb)][_0x57eae0(0x245)](_0x57eae0(0x1fd),_0x57eae0(0x258)+_0x10c186,'Plisio\x20API\x20error:\x20'+(_0x3d9293[_0x57eae0(0x207)]||_0x3d9293['error']||'Unknown\x20error'));throw new Error(_0x57eae0(0x220)+(_0x3d9293[_0x57eae0(0x207)]||_0x3d9293[_0x57eae0(0x22e)]||_0x57eae0(0x1ff)));}let _0x145bfb=_0x57eae0(0x24b);return{'status':_0x145bfb};}catch(_0x3bf0e5){console[_0x57eae0(0x22e)]('Plisio\x20payment\x20verification\x20error:',_0x3bf0e5),loggerService_1['loggerService'][_0x57eae0(0x245)](_0x57eae0(0x1fd),'/operations/'+_0x10c186,_0x3bf0e5);throw new Error(_0x57eae0(0x210)+(_0x3bf0e5 instanceof Error?_0x3bf0e5[_0x57eae0(0x207)]:_0x57eae0(0x1ff)));}}async['processWebhook'](_0x48165d){const _0x1e5ec9=a51_0x12837e;console['log']('Processing\x20Plisio\x20webhook:',_0x48165d);let _0x47eea2=_0x1e5ec9(0x24b);switch(_0x48165d[_0x1e5ec9(0x203)]?.[_0x1e5ec9(0x256)]()){case _0x1e5ec9(0x25b):case _0x1e5ec9(0x219):_0x47eea2=_0x1e5ec9(0x215);break;case'expired':_0x47eea2='EXPIRED';break;case _0x1e5ec9(0x22e):case _0x1e5ec9(0x1f1):_0x47eea2='FAILED';break;case _0x1e5ec9(0x22a):_0x47eea2=_0x1e5ec9(0x24b);break;case _0x1e5ec9(0x242):_0x47eea2=_0x1e5ec9(0x1fa);break;default:_0x47eea2=_0x1e5ec9(0x24b);break;}let _0x1fe53a;if(_0x48165d[_0x1e5ec9(0x23c)])try{console[_0x1e5ec9(0x1fc)](_0x1e5ec9(0x259),_0x48165d[_0x1e5ec9(0x23c)]);let _0x34dbe1;if(typeof _0x48165d[_0x1e5ec9(0x23c)]===_0x1e5ec9(0x1f4))_0x34dbe1=JSON[_0x1e5ec9(0x208)](_0x48165d[_0x1e5ec9(0x23c)]);else Array[_0x1e5ec9(0x24f)](_0x48165d[_0x1e5ec9(0x23c)])?_0x34dbe1=_0x48165d['tx_urls']:_0x34dbe1=[];_0x1fe53a=_0x34dbe1[_0x1e5ec9(0x20c)](_0xf6f0a2=>{const _0x41769d=_0x1e5ec9,_0x1c2cea=_0xf6f0a2['replace'](/\\/g,'');return console[_0x41769d(0x1fc)]('üîó\x20Formatted\x20URL:\x20'+_0xf6f0a2+_0x41769d(0x227)+_0x1c2cea),_0x1c2cea;}),console['log'](_0x1e5ec9(0x25f),_0x1fe53a),_0x1fe53a['forEach']((_0xd52257,_0x108ac3)=>{const _0x87859f=_0x1e5ec9;try{new URL(_0xd52257),console[_0x87859f(0x1fc)]('‚úÖ\x20URL\x20'+(_0x108ac3+0x1)+_0x87859f(0x209)+_0xd52257);}catch(_0x3e981b){console[_0x87859f(0x22e)](_0x87859f(0x21f)+(_0x108ac3+0x1)+'\x20is\x20invalid:\x20'+_0xd52257,_0x3e981b);}});}catch(_0xbe0f16){console[_0x1e5ec9(0x22e)](_0x1e5ec9(0x248),_0xbe0f16),console[_0x1e5ec9(0x22e)]('Raw\x20tx_urls\x20data:',_0x48165d[_0x1e5ec9(0x23c)]),_0x1fe53a=undefined;}return{'paymentId':_0x48165d[_0x1e5ec9(0x1f6)]||'','status':_0x47eea2,'amount':_0x48165d[_0x1e5ec9(0x200)],'currency':_0x48165d[_0x1e5ec9(0x260)],'txUrls':_0x1fe53a};}}exports[a51_0x12837e(0x22c)]=PlisioService;