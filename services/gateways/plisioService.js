'use strict';const a66_0xa06e4=a66_0xfd20;(function(_0xef7777,_0x4538ca){const _0x4c4e41=a66_0xfd20,_0x138c25=_0xef7777();while(!![]){try{const _0x1b1d02=parseInt(_0x4c4e41(0xce))/0x1+-parseInt(_0x4c4e41(0x11c))/0x2*(-parseInt(_0x4c4e41(0x100))/0x3)+-parseInt(_0x4c4e41(0xf4))/0x4*(-parseInt(_0x4c4e41(0xb8))/0x5)+-parseInt(_0x4c4e41(0xba))/0x6*(parseInt(_0x4c4e41(0xbe))/0x7)+-parseInt(_0x4c4e41(0xb9))/0x8+parseInt(_0x4c4e41(0xe9))/0x9*(parseInt(_0x4c4e41(0x10d))/0xa)+-parseInt(_0x4c4e41(0x113))/0xb;if(_0x1b1d02===_0x4538ca)break;else _0x138c25['push'](_0x138c25['shift']());}catch(_0xd1b214){_0x138c25['push'](_0x138c25['shift']());}}}(a66_0x37a1,0x5c389));Object['defineProperty'](exports,a66_0xa06e4(0x123),{'value':!![]}),exports[a66_0xa06e4(0xc4)]=void 0x0;const loggerService_1=require(a66_0xa06e4(0xbb));function a66_0xfd20(_0x45dcc5,_0x246a65){_0x45dcc5=_0x45dcc5-0xb7;const _0x37a16a=a66_0x37a1();let _0xfd201f=_0x37a16a[_0x45dcc5];return _0xfd201f;}class PlisioService{constructor(){const _0x194900=a66_0xa06e4;this['apiUrl']='https://api.plisio.net/api/v1/invoices/new',this['apiKey']=process[_0x194900(0x125)][_0x194900(0x10a)]||'',!this[_0x194900(0xd8)]?console['warn'](_0x194900(0xc9)):console[_0x194900(0x122)](_0x194900(0x104));}async[a66_0xa06e4(0x11d)](_0x333012){const _0x97ae84=a66_0xa06e4,{orderId:_0x15d282,amount:_0x545259,currency:_0x3abfdf,productName:_0x36a943,description:_0x1b20b6,successUrl:_0x47c2cc,failUrl:_0xa083f,customerEmail:_0x2c9e08,customerName:_0x73d11b,isSourceCurrency:_0x3d2230,sourceCurrency:_0x4ee035}=_0x333012;if(!this[_0x97ae84(0xd8)])throw new Error(_0x97ae84(0xcd));const _0x2f47c7=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x15d282,'order_name':_0x36a943,'description':_0x1b20b6,'success_url':_0x47c2cc,'fail_url':_0xa083f,'callback_url':_0x97ae84(0x126)});_0x4ee035?(_0x2f47c7[_0x97ae84(0xeb)](_0x97ae84(0xbd),_0x4ee035),_0x2f47c7[_0x97ae84(0xeb)](_0x97ae84(0x10f),_0x3abfdf),_0x2f47c7[_0x97ae84(0xeb)](_0x97ae84(0xde),_0x545259[_0x97ae84(0xed)]())):(_0x2f47c7['append'](_0x97ae84(0xbd),_0x3abfdf),_0x2f47c7[_0x97ae84(0xeb)](_0x97ae84(0x12b),_0x545259[_0x97ae84(0xed)]()));_0x2c9e08&&_0x2f47c7['append'](_0x97ae84(0xf8),_0x2c9e08);_0x73d11b&&_0x2f47c7[_0x97ae84(0xeb)]('name',_0x73d11b);const _0x204460=this[_0x97ae84(0xc5)]+'?'+_0x2f47c7['toString'](),_0x289156=Date[_0x97ae84(0xd1)]();try{console[_0x97ae84(0x122)](_0x97ae84(0x112)),console[_0x97ae84(0x122)](_0x97ae84(0xf6),this['apiUrl']),console[_0x97ae84(0x122)](_0x97ae84(0xcf),Object[_0x97ae84(0xc2)](_0x2f47c7['entries']())),console['log'](_0x97ae84(0xd5),_0x204460[_0x97ae84(0x101)](this[_0x97ae84(0xd8)],_0x97ae84(0xcb))),loggerService_1[_0x97ae84(0x111)]['logWhiteDomainRequest'](_0x97ae84(0x103),_0x97ae84(0x105),_0x97ae84(0x102),Object[_0x97ae84(0xc2)](_0x2f47c7['entries']()));const _0x448df=await fetch(_0x204460,{'method':_0x97ae84(0x102),'headers':{'Accept':_0x97ae84(0xdb),'User-Agent':_0x97ae84(0xea)}}),_0x412a73=Date[_0x97ae84(0xd1)]()-_0x289156;console['log'](_0x97ae84(0x10c)),console[_0x97ae84(0x122)](_0x97ae84(0xf7),_0x448df['status']),console[_0x97ae84(0x122)](_0x97ae84(0xe6),_0x448df[_0x97ae84(0x10b)]),console['log'](_0x97ae84(0x12d),_0x412a73+'ms');const _0x3f548f=await _0x448df['text']();console[_0x97ae84(0x122)](_0x97ae84(0x118),_0x3f548f);if(!_0x448df['ok']){console['error'](_0x97ae84(0xe8)),console[_0x97ae84(0x120)](_0x97ae84(0x116),_0x448df[_0x97ae84(0x106)]),console[_0x97ae84(0x120)](_0x97ae84(0xbc),_0x3f548f),loggerService_1[_0x97ae84(0x111)][_0x97ae84(0x128)](_0x97ae84(0x103),_0x97ae84(0x105),_0x448df[_0x97ae84(0x106)],_0x3f548f,_0x412a73),loggerService_1['loggerService']['logWhiteDomainError'](_0x97ae84(0x103),_0x97ae84(0x105),_0x97ae84(0x132)+_0x448df[_0x97ae84(0x106)]+':\x20'+_0x3f548f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x448df['status']+_0x97ae84(0x12a)+_0x3f548f);}let _0x173bcb;try{_0x173bcb=JSON[_0x97ae84(0xfb)](_0x3f548f);}catch(_0x513443){console[_0x97ae84(0x120)](_0x97ae84(0xff),_0x513443),loggerService_1[_0x97ae84(0x111)][_0x97ae84(0xca)](_0x97ae84(0x103),_0x97ae84(0x105),_0x97ae84(0xe2)+_0x513443);throw new Error(_0x97ae84(0x11e)+_0x3f548f);}console[_0x97ae84(0x122)](_0x97ae84(0xd9)),console[_0x97ae84(0x122)](_0x97ae84(0x108),JSON[_0x97ae84(0xd4)](_0x173bcb,null,0x2)),loggerService_1[_0x97ae84(0x111)]['logWhiteDomainResponse'](_0x97ae84(0x103),_0x97ae84(0x105),_0x448df[_0x97ae84(0x106)],_0x173bcb,_0x412a73);if(_0x173bcb[_0x97ae84(0x106)]!=='success'){const _0x19fd88=_0x173bcb['message']||_0x173bcb['error']||_0x97ae84(0x117);console['error'](_0x97ae84(0x115)),console[_0x97ae84(0x120)](_0x97ae84(0xf1),_0x19fd88),loggerService_1[_0x97ae84(0x111)][_0x97ae84(0xca)](_0x97ae84(0x103),'/invoices/new','Business\x20Error:\x20'+_0x19fd88);throw new Error(_0x97ae84(0xb7)+_0x19fd88);}if(!_0x173bcb[_0x97ae84(0xc3)]?.['txn_id']||!_0x173bcb[_0x97ae84(0xc3)]?.['invoice_url']){console['error'](_0x97ae84(0xf0)),console['error'](_0x97ae84(0xfd)),console[_0x97ae84(0x120)](_0x97ae84(0xdf),_0x173bcb[_0x97ae84(0xc3)]),loggerService_1['loggerService'][_0x97ae84(0xca)](_0x97ae84(0x103),'/invoices/new',_0x97ae84(0x121));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x97ae84(0x122)](_0x97ae84(0xc1)),console['log'](_0x97ae84(0x11b),_0x173bcb[_0x97ae84(0xc3)][_0x97ae84(0xd2)]),console[_0x97ae84(0x122)](_0x97ae84(0x110),_0x173bcb[_0x97ae84(0xc3)]['invoice_url']),console[_0x97ae84(0x122)](_0x97ae84(0xe7),_0x545259,_0x3abfdf),_0x4ee035&&(console[_0x97ae84(0x122)]('Source\x20Currency:',_0x4ee035,'(crypto\x20for\x20payment)'),console[_0x97ae84(0x122)]('Target\x20Currency:',_0x3abfdf,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x173bcb['data'][_0x97ae84(0xd2)],'payment_url':_0x173bcb['data'][_0x97ae84(0x124)],'invoice_total_sum':_0x173bcb['data'][_0x97ae84(0x119)],'qr_code':_0x173bcb[_0x97ae84(0xc3)]['qr_code'],'qr_url':_0x173bcb[_0x97ae84(0xc3)][_0x97ae84(0x11a)]};}catch(_0x509adc){console[_0x97ae84(0x120)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x97ae84(0x120)](_0x97ae84(0xfe),_0x509adc),loggerService_1[_0x97ae84(0x111)][_0x97ae84(0xca)]('plisio_direct',_0x97ae84(0x105),_0x509adc);if(_0x509adc instanceof Error){console['error'](_0x97ae84(0x109),_0x509adc[_0x97ae84(0xc8)]),console[_0x97ae84(0x120)]('Error\x20stack:',_0x509adc[_0x97ae84(0xfa)]);throw new Error(_0x97ae84(0xe5)+_0x509adc[_0x97ae84(0xc8)]);}throw new Error(_0x97ae84(0xda));}}async['verifyPayment'](_0x1bfd6d){const _0x14cfd4=a66_0xa06e4,_0x5935b6=Date[_0x14cfd4(0xd1)]();try{if(!this[_0x14cfd4(0xd8)])throw new Error(_0x14cfd4(0xcd));const _0x2f9834=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x1bfd6d}),_0x49329e=_0x14cfd4(0xc0)+_0x1bfd6d+'?'+_0x2f9834[_0x14cfd4(0xed)]();loggerService_1[_0x14cfd4(0x111)][_0x14cfd4(0xc7)](_0x14cfd4(0x103),_0x14cfd4(0xec)+_0x1bfd6d,_0x14cfd4(0x102),Object[_0x14cfd4(0xc2)](_0x2f9834[_0x14cfd4(0xdd)]()));const _0x2c1dc9=await fetch(_0x49329e,{'method':_0x14cfd4(0x102),'headers':{'Accept':_0x14cfd4(0xdb),'User-Agent':_0x14cfd4(0xea)}}),_0x4fc73f=Date['now']()-_0x5935b6;if(!_0x2c1dc9['ok']){const _0x251805=await _0x2c1dc9[_0x14cfd4(0xf9)]();loggerService_1[_0x14cfd4(0x111)][_0x14cfd4(0x128)](_0x14cfd4(0x103),_0x14cfd4(0xec)+_0x1bfd6d,_0x2c1dc9['status'],_0x251805,_0x4fc73f);throw new Error(_0x14cfd4(0x12f)+_0x2c1dc9[_0x14cfd4(0x106)]);}const _0x414390=await _0x2c1dc9[_0x14cfd4(0x129)]();loggerService_1[_0x14cfd4(0x111)][_0x14cfd4(0x128)](_0x14cfd4(0x103),_0x14cfd4(0xec)+_0x1bfd6d,_0x2c1dc9[_0x14cfd4(0x106)],_0x414390,_0x4fc73f);if(_0x414390[_0x14cfd4(0x106)]!==_0x14cfd4(0xe3)){loggerService_1[_0x14cfd4(0x111)][_0x14cfd4(0xca)](_0x14cfd4(0x103),_0x14cfd4(0xec)+_0x1bfd6d,_0x14cfd4(0xb7)+(_0x414390[_0x14cfd4(0xc8)]||_0x414390[_0x14cfd4(0x120)]||_0x14cfd4(0x114)));throw new Error(_0x14cfd4(0xb7)+(_0x414390[_0x14cfd4(0xc8)]||_0x414390[_0x14cfd4(0x120)]||_0x14cfd4(0x114)));}let _0x4b58cb='PENDING';return{'status':_0x4b58cb};}catch(_0x2d4b91){console['error']('Plisio\x20payment\x20verification\x20error:',_0x2d4b91),loggerService_1[_0x14cfd4(0x111)][_0x14cfd4(0xca)](_0x14cfd4(0x103),_0x14cfd4(0xec)+_0x1bfd6d,_0x2d4b91);throw new Error(_0x14cfd4(0xdc)+(_0x2d4b91 instanceof Error?_0x2d4b91['message']:_0x14cfd4(0x114)));}}async[a66_0xa06e4(0xf5)](_0x566c71){const _0x4c273b=a66_0xa06e4;console[_0x4c273b(0x122)]('Processing\x20Plisio\x20webhook:',_0x566c71);let _0x1ab5e9=_0x4c273b(0xc6);switch(_0x566c71[_0x4c273b(0x106)]?.[_0x4c273b(0x107)]()){case'completed':case _0x4c273b(0xbf):_0x1ab5e9=_0x4c273b(0x12e);break;case _0x4c273b(0xd7):_0x1ab5e9='EXPIRED';break;case'error':case _0x4c273b(0xe0):_0x1ab5e9=_0x4c273b(0xd6);break;case _0x4c273b(0xf3):_0x1ab5e9='PENDING';break;case _0x4c273b(0xd3):_0x1ab5e9=_0x4c273b(0x130);break;default:_0x1ab5e9=_0x4c273b(0xc6);break;}let _0x49655a;if(_0x566c71[_0x4c273b(0x131)])try{console[_0x4c273b(0x122)](_0x4c273b(0xd0),_0x566c71[_0x4c273b(0x131)]);let _0x38ca8c;if(typeof _0x566c71[_0x4c273b(0x131)]===_0x4c273b(0xf2))_0x38ca8c=JSON['parse'](_0x566c71[_0x4c273b(0x131)]);else Array[_0x4c273b(0xe1)](_0x566c71[_0x4c273b(0x131)])?_0x38ca8c=_0x566c71[_0x4c273b(0x131)]:_0x38ca8c=[];_0x49655a=_0x38ca8c[_0x4c273b(0xef)](_0x2d89df=>{const _0x4f2184=_0x4c273b,_0x5eb685=_0x2d89df[_0x4f2184(0x101)](/\\/g,'');return console[_0x4f2184(0x122)](_0x4f2184(0xee)+_0x2d89df+_0x4f2184(0x11f)+_0x5eb685),_0x5eb685;}),console['log'](_0x4c273b(0xe4),_0x49655a),_0x49655a[_0x4c273b(0xfc)]((_0xf21472,_0x1fe000)=>{const _0x37cdac=_0x4c273b;try{new URL(_0xf21472),console[_0x37cdac(0x122)]('‚úÖ\x20URL\x20'+(_0x1fe000+0x1)+_0x37cdac(0xcc)+_0xf21472);}catch(_0x2d85a6){console[_0x37cdac(0x120)](_0x37cdac(0x127)+(_0x1fe000+0x1)+'\x20is\x20invalid:\x20'+_0xf21472,_0x2d85a6);}});}catch(_0x24e8e){console[_0x4c273b(0x120)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x24e8e),console[_0x4c273b(0x120)](_0x4c273b(0x10e),_0x566c71['tx_urls']),_0x49655a=undefined;}return{'paymentId':_0x566c71[_0x4c273b(0x12c)]||'','status':_0x1ab5e9,'amount':_0x566c71[_0x4c273b(0x12b)],'currency':_0x566c71[_0x4c273b(0xbd)],'txUrls':_0x49655a};}}exports[a66_0xa06e4(0xc4)]=PlisioService;function a66_0x37a1(){const _0x2bf5d7=['===\x20PLISIO\x20API\x20ERROR\x20===','3186126iGpAKo','Payment\x20System/1.0','append','/operations/','toString','üîó\x20Formatted\x20URL:\x20','map','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20Message:','string','new','376AiwBSP','processWebhook','URL:','Status:','email','text','stack','parse','forEach','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','Error\x20details:','Failed\x20to\x20parse\x20JSON\x20response:','54ygqqNJ','replace','GET','plisio_direct','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','/invoices/new','status','toLowerCase','Parsed\x20Result:','Error\x20message:','PLISIO_API_KEY','statusText','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','10LafTmg','Raw\x20tx_urls\x20data:','source_currency','Invoice\x20URL:','loggerService','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','702548ijjWKG','Unknown\x20error','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20Status:','Unknown\x20error\x20from\x20Plisio\x20API','Raw\x20Response\x20Body:','invoice_total_sum','qr_url','Transaction\x20ID:','39826HNTmPh','createPayment','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','\x20->\x20','error','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','log','__esModule','invoice_url','env','https://api.trapay.uk/api/webhooks/gateway/plisio','‚ùå\x20URL\x20','logWhiteDomainResponse','json',',\x20body:\x20','amount','order_number','Response\x20Time:','PAID','HTTP\x20error!\x20status:\x20','PROCESSING','tx_urls','HTTP\x20','Plisio\x20API\x20error:\x20','5945TVKKJO','3651424OaJpAG','144bExfxj','../loggerService','Response\x20Body:','currency','128233qShnXs','mismatch','https://api.plisio.net/api/v1/operations/','===\x20PLISIO\x20SUCCESS\x20===','fromEntries','data','PlisioService','apiUrl','PENDING','logWhiteDomainRequest','message','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','logWhiteDomainError','HIDDEN','\x20is\x20valid:\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','513475FJhedk','Parameters:','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','now','txn_id','pending','stringify','Full\x20URL\x20(without\x20API\x20key):','FAILED','expired','apiKey','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','application/json','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','entries','source_amount','Response\x20data:','cancelled','isArray','JSON\x20Parse\x20Error:\x20','success','‚úÖ\x20Processed\x20tx_urls:','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Status\x20Text:','Amount:'];a66_0x37a1=function(){return _0x2bf5d7;};return a66_0x37a1();}