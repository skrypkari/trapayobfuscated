'use strict';const a49_0x30157a=a49_0x1e13;(function(_0x398c02,_0x57845b){const _0x55d953=a49_0x1e13,_0x2b4f24=_0x398c02();while(!![]){try{const _0x2728b0=parseInt(_0x55d953(0xe1))/0x1*(-parseInt(_0x55d953(0xe8))/0x2)+parseInt(_0x55d953(0xe6))/0x3*(-parseInt(_0x55d953(0xdb))/0x4)+-parseInt(_0x55d953(0xb8))/0x5+parseInt(_0x55d953(0x99))/0x6*(-parseInt(_0x55d953(0xd2))/0x7)+-parseInt(_0x55d953(0xbf))/0x8+parseInt(_0x55d953(0xf7))/0x9*(-parseInt(_0x55d953(0xcf))/0xa)+parseInt(_0x55d953(0xb3))/0xb;if(_0x2728b0===_0x57845b)break;else _0x2b4f24['push'](_0x2b4f24['shift']());}catch(_0x252b8){_0x2b4f24['push'](_0x2b4f24['shift']());}}}(a49_0x22cb,0xec589));Object[a49_0x30157a(0x103)](exports,a49_0x30157a(0xbe),{'value':!![]}),exports['PlisioService']=void 0x0;function a49_0x22cb(){const _0x160427=['Status\x20Text:','Full\x20URL\x20(without\x20API\x20key):','logWhiteDomainRequest','Response\x20Time:','processWebhook','HTTP\x20Status:','Failed\x20to\x20parse\x20JSON\x20response:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','1639398UxmfwF','Processing\x20Plisio\x20webhook:','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Unknown\x20error','verifyPayment','completed','statusText','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','\x20is\x20valid:\x20','https://api.trapay.uk/api/webhooks/gateway/plisio','order_number','/invoices/new','FAILED','Source\x20Currency:','Target\x20Currency:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','JSON\x20Parse\x20Error:\x20','log','Response\x20data:','\x20is\x20invalid:\x20','apiUrl','text','URL:','cancelled','https://api.plisio.net/api/v1/invoices/new','email','80408009PvWPqJ','invoice_url',',\x20body:\x20','expired','üîó\x20Formatted\x20URL:\x20','103175NdSWwJ','apiKey','(crypto\x20for\x20payment)','tx_urls','toLowerCase','Error\x20stack:','__esModule','13494864DBcXPV','PlisioService','Error\x20Message:','(fiat\x20for\x20merchant)','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','now','source_currency','isArray','logWhiteDomainError','plisio_direct','Business\x20Error:\x20','amount','invoice_total_sum','env','success','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','10pZDniw','name','currency','35iQaDFH','\x20->\x20','PROCESSING','stack','../loggerService','/operations/','txn_id','TesSoft\x20Payment\x20System/1.0','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','4nFBcJK','json','Response\x20Body:','Parsed\x20Result:','loggerService','application/json','3673JKczwB','Plisio\x20API\x20error:\x20','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','qr_url','3325197wCtfiZ','PLISIO_API_KEY','382xWyqOV','Raw\x20tx_urls\x20data:','‚úÖ\x20Processed\x20tx_urls:','Plisio\x20API\x20key\x20is\x20not\x20configured','stringify','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','HIDDEN','toString','‚ùå\x20URL\x20','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','GET','Raw\x20Response\x20Body:','===\x20PLISIO\x20API\x20ERROR\x20===','fromEntries','Failed\x20to\x20create\x20Plisio\x20payment:\x20','13123314okZswg','===\x20PLISIO\x20SUCCESS\x20===','message','qr_code','data','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','createPayment','forEach','HTTP\x20error!\x20status:\x20','Transaction\x20ID:','mismatch','status','defineProperty','replace','append','warn','Error\x20details:','logWhiteDomainResponse','string','error','PENDING','map','entries'];a49_0x22cb=function(){return _0x160427;};return a49_0x22cb();}const loggerService_1=require(a49_0x30157a(0xd6));class PlisioService{constructor(){const _0xfc6877=a49_0x30157a;this[_0xfc6877(0xad)]=_0xfc6877(0xb1),this[_0xfc6877(0xb9)]=process[_0xfc6877(0xcc)][_0xfc6877(0xe7)]||'',!this[_0xfc6877(0xb9)]?console[_0xfc6877(0x106)](_0xfc6877(0xed)):console[_0xfc6877(0xaa)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a49_0x30157a(0xfd)](_0x1b7172){const _0x337d99=a49_0x30157a,{orderId:_0x46ac6d,amount:_0x5f5141,currency:_0x103ae7,productName:_0x319c82,description:_0x1737ce,successUrl:_0x433cdf,failUrl:_0x28355f,customerEmail:_0x5f3db2,customerName:_0x3bc316,isSourceCurrency:_0x35e23a,sourceCurrency:_0x9ec050}=_0x1b7172;if(!this[_0x337d99(0xb9)])throw new Error(_0x337d99(0xeb));const _0x971cff=new URLSearchParams({'api_key':this[_0x337d99(0xb9)],'order_number':_0x46ac6d,'order_name':_0x319c82,'description':_0x1737ce,'success_url':_0x433cdf,'fail_url':_0x28355f,'callback_url':_0x337d99(0xa2)});_0x9ec050?(_0x971cff[_0x337d99(0x105)](_0x337d99(0xd1),_0x9ec050),_0x971cff[_0x337d99(0x105)](_0x337d99(0xc5),_0x103ae7),_0x971cff[_0x337d99(0x105)]('source_amount',_0x5f5141[_0x337d99(0xef)]())):(_0x971cff[_0x337d99(0x105)]('currency',_0x103ae7),_0x971cff[_0x337d99(0x105)](_0x337d99(0xca),_0x5f5141['toString']()));_0x5f3db2&&_0x971cff[_0x337d99(0x105)](_0x337d99(0xb2),_0x5f3db2);_0x3bc316&&_0x971cff[_0x337d99(0x105)](_0x337d99(0xd0),_0x3bc316);const _0x5eca22=this[_0x337d99(0xad)]+'?'+_0x971cff[_0x337d99(0xef)](),_0x4ecd8c=Date[_0x337d99(0xc4)]();try{console[_0x337d99(0xaa)](_0x337d99(0xda)),console[_0x337d99(0xaa)](_0x337d99(0xaf),this[_0x337d99(0xad)]),console['log']('Parameters:',Object[_0x337d99(0xf5)](_0x971cff[_0x337d99(0x90)]())),console[_0x337d99(0xaa)](_0x337d99(0x92),_0x5eca22[_0x337d99(0x104)](this['apiKey'],_0x337d99(0xee))),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x337d99(0xc8),_0x337d99(0xa4),_0x337d99(0xf2),Object[_0x337d99(0xf5)](_0x971cff[_0x337d99(0x90)]()));const _0xdc1018=await fetch(_0x5eca22,{'method':_0x337d99(0xf2),'headers':{'Accept':'application/json','User-Agent':_0x337d99(0xd9)}}),_0x1543bd=Date[_0x337d99(0xc4)]()-_0x4ecd8c;console[_0x337d99(0xaa)](_0x337d99(0xe3)),console[_0x337d99(0xaa)]('Status:',_0xdc1018['status']),console['log'](_0x337d99(0x91),_0xdc1018[_0x337d99(0x9f)]),console[_0x337d99(0xaa)](_0x337d99(0x94),_0x1543bd+'ms');const _0x5de2b6=await _0xdc1018[_0x337d99(0xae)]();console[_0x337d99(0xaa)](_0x337d99(0xf3),_0x5de2b6);if(!_0xdc1018['ok']){console['error'](_0x337d99(0xf4)),console[_0x337d99(0x10a)](_0x337d99(0x96),_0xdc1018[_0x337d99(0x102)]),console[_0x337d99(0x10a)](_0x337d99(0xdd),_0x5de2b6),loggerService_1['loggerService'][_0x337d99(0x108)](_0x337d99(0xc8),_0x337d99(0xa4),_0xdc1018['status'],_0x5de2b6,_0x1543bd),loggerService_1[_0x337d99(0xdf)][_0x337d99(0xc7)](_0x337d99(0xc8),'/invoices/new','HTTP\x20'+_0xdc1018['status']+':\x20'+_0x5de2b6);throw new Error(_0x337d99(0xff)+_0xdc1018[_0x337d99(0x102)]+_0x337d99(0xb5)+_0x5de2b6);}let _0x4d853e;try{_0x4d853e=JSON['parse'](_0x5de2b6);}catch(_0x397588){console[_0x337d99(0x10a)](_0x337d99(0x97),_0x397588),loggerService_1[_0x337d99(0xdf)][_0x337d99(0xc7)](_0x337d99(0xc8),'/invoices/new',_0x337d99(0xa9)+_0x397588);throw new Error(_0x337d99(0xa8)+_0x5de2b6);}console[_0x337d99(0xaa)](_0x337d99(0xc3)),console[_0x337d99(0xaa)](_0x337d99(0xde),JSON[_0x337d99(0xec)](_0x4d853e,null,0x2)),loggerService_1[_0x337d99(0xdf)]['logWhiteDomainResponse'](_0x337d99(0xc8),_0x337d99(0xa4),_0xdc1018[_0x337d99(0x102)],_0x4d853e,_0x1543bd);if(_0x4d853e[_0x337d99(0x102)]!==_0x337d99(0xcd)){const _0x244e9e=_0x4d853e[_0x337d99(0xf9)]||_0x4d853e[_0x337d99(0x10a)]||'Unknown\x20error\x20from\x20Plisio\x20API';console['error'](_0x337d99(0xa0)),console[_0x337d99(0x10a)](_0x337d99(0xc1),_0x244e9e),loggerService_1[_0x337d99(0xdf)]['logWhiteDomainError'](_0x337d99(0xc8),_0x337d99(0xa4),_0x337d99(0xc9)+_0x244e9e);throw new Error(_0x337d99(0xe2)+_0x244e9e);}if(!_0x4d853e[_0x337d99(0xfb)]?.[_0x337d99(0xd8)]||!_0x4d853e['data']?.[_0x337d99(0xb4)]){console[_0x337d99(0x10a)](_0x337d99(0xfc)),console['error'](_0x337d99(0xce)),console['error'](_0x337d99(0xab),_0x4d853e[_0x337d99(0xfb)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x337d99(0xc8),_0x337d99(0xa4),_0x337d99(0x98));throw new Error(_0x337d99(0xf1));}return console['log'](_0x337d99(0xf8)),console[_0x337d99(0xaa)](_0x337d99(0x100),_0x4d853e[_0x337d99(0xfb)][_0x337d99(0xd8)]),console[_0x337d99(0xaa)]('Invoice\x20URL:',_0x4d853e[_0x337d99(0xfb)][_0x337d99(0xb4)]),console[_0x337d99(0xaa)]('Amount:',_0x5f5141,_0x103ae7),_0x9ec050&&(console[_0x337d99(0xaa)](_0x337d99(0xa6),_0x9ec050,_0x337d99(0xba)),console['log'](_0x337d99(0xa7),_0x103ae7,_0x337d99(0xc2))),{'gateway_payment_id':_0x4d853e[_0x337d99(0xfb)][_0x337d99(0xd8)],'payment_url':_0x4d853e['data'][_0x337d99(0xb4)],'invoice_total_sum':_0x4d853e['data'][_0x337d99(0xcb)],'qr_code':_0x4d853e[_0x337d99(0xfb)][_0x337d99(0xfa)],'qr_url':_0x4d853e[_0x337d99(0xfb)][_0x337d99(0xe5)]};}catch(_0x558287){console[_0x337d99(0x10a)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x337d99(0x10a)](_0x337d99(0x107),_0x558287),loggerService_1[_0x337d99(0xdf)][_0x337d99(0xc7)](_0x337d99(0xc8),_0x337d99(0xa4),_0x558287);if(_0x558287 instanceof Error){console[_0x337d99(0x10a)]('Error\x20message:',_0x558287['message']),console['error'](_0x337d99(0xbd),_0x558287[_0x337d99(0xd5)]);throw new Error(_0x337d99(0xf6)+_0x558287[_0x337d99(0xf9)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a49_0x30157a(0x9d)](_0x2a5f3c){const _0x57e2de=a49_0x30157a,_0x12afbe=Date[_0x57e2de(0xc4)]();try{if(!this[_0x57e2de(0xb9)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x19dec1=new URLSearchParams({'api_key':this[_0x57e2de(0xb9)],'txn_id':_0x2a5f3c}),_0x3d61d7='https://api.plisio.net/api/v1/operations/'+_0x2a5f3c+'?'+_0x19dec1['toString']();loggerService_1['loggerService'][_0x57e2de(0x93)](_0x57e2de(0xc8),'/operations/'+_0x2a5f3c,_0x57e2de(0xf2),Object[_0x57e2de(0xf5)](_0x19dec1[_0x57e2de(0x90)]()));const _0x3099f7=await fetch(_0x3d61d7,{'method':_0x57e2de(0xf2),'headers':{'Accept':_0x57e2de(0xe0),'User-Agent':_0x57e2de(0xd9)}}),_0x4c5621=Date[_0x57e2de(0xc4)]()-_0x12afbe;if(!_0x3099f7['ok']){const _0x42a9a0=await _0x3099f7[_0x57e2de(0xae)]();loggerService_1[_0x57e2de(0xdf)][_0x57e2de(0x108)](_0x57e2de(0xc8),_0x57e2de(0xd7)+_0x2a5f3c,_0x3099f7[_0x57e2de(0x102)],_0x42a9a0,_0x4c5621);throw new Error(_0x57e2de(0xff)+_0x3099f7[_0x57e2de(0x102)]);}const _0x20d9ca=await _0x3099f7[_0x57e2de(0xdc)]();loggerService_1[_0x57e2de(0xdf)][_0x57e2de(0x108)](_0x57e2de(0xc8),'/operations/'+_0x2a5f3c,_0x3099f7[_0x57e2de(0x102)],_0x20d9ca,_0x4c5621);if(_0x20d9ca[_0x57e2de(0x102)]!==_0x57e2de(0xcd)){loggerService_1[_0x57e2de(0xdf)][_0x57e2de(0xc7)](_0x57e2de(0xc8),_0x57e2de(0xd7)+_0x2a5f3c,_0x57e2de(0xe2)+(_0x20d9ca[_0x57e2de(0xf9)]||_0x20d9ca[_0x57e2de(0x10a)]||'Unknown\x20error'));throw new Error('Plisio\x20API\x20error:\x20'+(_0x20d9ca['message']||_0x20d9ca[_0x57e2de(0x10a)]||_0x57e2de(0x9c)));}let _0x2df0fc='PENDING';return{'status':_0x2df0fc};}catch(_0x4dfd45){console[_0x57e2de(0x10a)]('Plisio\x20payment\x20verification\x20error:',_0x4dfd45),loggerService_1[_0x57e2de(0xdf)][_0x57e2de(0xc7)](_0x57e2de(0xc8),_0x57e2de(0xd7)+_0x2a5f3c,_0x4dfd45);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x4dfd45 instanceof Error?_0x4dfd45[_0x57e2de(0xf9)]:_0x57e2de(0x9c)));}}async[a49_0x30157a(0x95)](_0x1b7fa8){const _0x4a3a1b=a49_0x30157a;console[_0x4a3a1b(0xaa)](_0x4a3a1b(0x9a),_0x1b7fa8);let _0x53926d=_0x4a3a1b(0x10b);switch(_0x1b7fa8[_0x4a3a1b(0x102)]?.[_0x4a3a1b(0xbc)]()){case _0x4a3a1b(0x9e):case _0x4a3a1b(0x101):_0x53926d='PAID';break;case _0x4a3a1b(0xb6):_0x53926d='EXPIRED';break;case _0x4a3a1b(0x10a):case _0x4a3a1b(0xb0):_0x53926d=_0x4a3a1b(0xa5);break;case'new':_0x53926d=_0x4a3a1b(0x10b);break;case'pending':_0x53926d=_0x4a3a1b(0xd4);break;default:_0x53926d=_0x4a3a1b(0x10b);break;}let _0x159631;if(_0x1b7fa8[_0x4a3a1b(0xbb)])try{console[_0x4a3a1b(0xaa)](_0x4a3a1b(0x9b),_0x1b7fa8[_0x4a3a1b(0xbb)]);let _0x4ee4e4;if(typeof _0x1b7fa8[_0x4a3a1b(0xbb)]===_0x4a3a1b(0x109))_0x4ee4e4=JSON['parse'](_0x1b7fa8[_0x4a3a1b(0xbb)]);else Array[_0x4a3a1b(0xc6)](_0x1b7fa8['tx_urls'])?_0x4ee4e4=_0x1b7fa8[_0x4a3a1b(0xbb)]:_0x4ee4e4=[];_0x159631=_0x4ee4e4[_0x4a3a1b(0x8f)](_0x12477a=>{const _0x4f6c5b=_0x4a3a1b,_0x35378d=_0x12477a[_0x4f6c5b(0x104)](/\\/g,'');return console[_0x4f6c5b(0xaa)](_0x4f6c5b(0xb7)+_0x12477a+_0x4f6c5b(0xd3)+_0x35378d),_0x35378d;}),console['log'](_0x4a3a1b(0xea),_0x159631),_0x159631[_0x4a3a1b(0xfe)]((_0xc1ec80,_0x5aeb02)=>{const _0x38245d=_0x4a3a1b;try{new URL(_0xc1ec80),console[_0x38245d(0xaa)]('‚úÖ\x20URL\x20'+(_0x5aeb02+0x1)+_0x38245d(0xa1)+_0xc1ec80);}catch(_0x30453e){console[_0x38245d(0x10a)](_0x38245d(0xf0)+(_0x5aeb02+0x1)+_0x38245d(0xac)+_0xc1ec80,_0x30453e);}});}catch(_0x28f395){console[_0x4a3a1b(0x10a)](_0x4a3a1b(0xe4),_0x28f395),console['error'](_0x4a3a1b(0xe9),_0x1b7fa8[_0x4a3a1b(0xbb)]),_0x159631=undefined;}return{'paymentId':_0x1b7fa8[_0x4a3a1b(0xa3)]||'','status':_0x53926d,'amount':_0x1b7fa8[_0x4a3a1b(0xca)],'currency':_0x1b7fa8[_0x4a3a1b(0xd1)],'txUrls':_0x159631};}}function a49_0x1e13(_0x22fe89,_0x3a4501){const _0x22cb00=a49_0x22cb();return a49_0x1e13=function(_0x1e1324,_0x99930){_0x1e1324=_0x1e1324-0x8f;let _0xbd0446=_0x22cb00[_0x1e1324];return _0xbd0446;},a49_0x1e13(_0x22fe89,_0x3a4501);}exports[a49_0x30157a(0xc0)]=PlisioService;