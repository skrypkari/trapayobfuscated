'use strict';const a44_0x3eb43c=a44_0x20fc;(function(_0x542f94,_0xcd61d5){const _0x2f4943=a44_0x20fc,_0x459553=_0x542f94();while(!![]){try{const _0x326bac=parseInt(_0x2f4943(0x1d9))/0x1+parseInt(_0x2f4943(0x20c))/0x2*(-parseInt(_0x2f4943(0x1c7))/0x3)+-parseInt(_0x2f4943(0x1f9))/0x4+-parseInt(_0x2f4943(0x1e2))/0x5+parseInt(_0x2f4943(0x22c))/0x6+-parseInt(_0x2f4943(0x1f8))/0x7+parseInt(_0x2f4943(0x22a))/0x8*(parseInt(_0x2f4943(0x1c3))/0x9);if(_0x326bac===_0xcd61d5)break;else _0x459553['push'](_0x459553['shift']());}catch(_0x4743ff){_0x459553['push'](_0x459553['shift']());}}}(a44_0x2fc3,0xc5888));function a44_0x2fc3(){const _0x5e3535=['===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','invoice_total_sum','312oAwbNV','new','TesSoft\x20Payment\x20System/1.0','fromEntries','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','loggerService','🔗\x20Formatted\x20URL:\x20','processWebhook','verifyPayment','apiKey','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Error\x20stack:','Error\x20Message:','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','message','/operations/','\x20is\x20invalid:\x20','logWhiteDomainResponse','922374DWynzM','Plisio\x20API\x20error:\x20','email','❌\x20URL\x20','https://api.plisio.net/api/v1/operations/','Target\x20Currency:','replace','Status\x20Text:','===\x20PLISIO\x20SUCCESS\x20===','4363785CHDsNI','✅\x20URL\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','plisio_direct','warn','env','amount','map','../loggerService','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','toString','HIDDEN','HTTP\x20','error','application/json','pending','isArray','PLISIO_API_KEY','Unknown\x20error','Unknown\x20error\x20from\x20Plisio\x20API','HTTP\x20Status:','source_amount','1008763uGxfzY','3651468GDEJqp','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Processing\x20Plisio\x20webhook:','data','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','text','Plisio\x20payment\x20verification\x20error:','(fiat\x20for\x20merchant)','Raw\x20tx_urls\x20data:','string','URL:','apiUrl','entries','PlisioService','Invoice\x20URL:','Transaction\x20ID:','append','EXPIRED','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','26654dmawss','tx_urls','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','logWhiteDomainError','success','Raw\x20Response\x20Body:','Response\x20Time:','FAILED','GET','PENDING','Failed\x20to\x20parse\x20JSON\x20response:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','txn_id','Parsed\x20Result:','currency','cancelled','log','\x20is\x20valid:\x20','invoice_url','status','logWhiteDomainRequest',',\x20body:\x20','completed','createPayment','PAID','Source\x20Currency:','qr_url','parse','statusText','14310784wFfGzO','order_number','8481690BAfsFu','\x20->\x20','now','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','forEach','Error\x20message:','✅\x20Processed\x20tx_urls:','/invoices/new','9vJKYRl','stack'];a44_0x2fc3=function(){return _0x5e3535;};return a44_0x2fc3();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a44_0x3eb43c(0x206)]=void 0x0;function a44_0x20fc(_0x4dda11,_0x4cab77){const _0x2fc344=a44_0x2fc3();return a44_0x20fc=function(_0x20fc10,_0x3c0c93){_0x20fc10=_0x20fc10-0x1c2;let _0x3bd86a=_0x2fc344[_0x20fc10];return _0x3bd86a;},a44_0x20fc(_0x4dda11,_0x4cab77);}const loggerService_1=require(a44_0x3eb43c(0x1ea));class PlisioService{constructor(){const _0x5bf6ee=a44_0x3eb43c;this['apiUrl']='https://api.plisio.net/api/v1/invoices/new',this[_0x5bf6ee(0x1d0)]=process[_0x5bf6ee(0x1e7)][_0x5bf6ee(0x1f3)]||'',!this[_0x5bf6ee(0x1d0)]?console[_0x5bf6ee(0x1e6)](_0x5bf6ee(0x1d1)):console['log']('💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a44_0x3eb43c(0x224)](_0x435ddc){const _0x355a8d=a44_0x3eb43c,{orderId:_0x3fb7a8,amount:_0x46775d,currency:_0x87e78e,productName:_0x5c68c2,description:_0x4285f,successUrl:_0x3470a2,failUrl:_0x17d422,customerEmail:_0x4df1de,customerName:_0x37223b,isSourceCurrency:_0x121fb3,sourceCurrency:_0x40ea92}=_0x435ddc;if(!this[_0x355a8d(0x1d0)])throw new Error(_0x355a8d(0x1e4));const _0x3b256b=new URLSearchParams({'api_key':this[_0x355a8d(0x1d0)],'order_number':_0x3fb7a8,'order_name':_0x5c68c2,'description':_0x4285f,'success_url':_0x3470a2,'fail_url':_0x17d422,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x40ea92?(_0x3b256b[_0x355a8d(0x209)]('currency',_0x40ea92),_0x3b256b[_0x355a8d(0x209)]('source_currency',_0x87e78e),_0x3b256b[_0x355a8d(0x209)](_0x355a8d(0x1f7),_0x46775d[_0x355a8d(0x1ec)]())):(_0x3b256b[_0x355a8d(0x209)](_0x355a8d(0x21b),_0x87e78e),_0x3b256b[_0x355a8d(0x209)](_0x355a8d(0x1e8),_0x46775d[_0x355a8d(0x1ec)]()));_0x4df1de&&_0x3b256b[_0x355a8d(0x209)](_0x355a8d(0x1db),_0x4df1de);_0x37223b&&_0x3b256b[_0x355a8d(0x209)]('name',_0x37223b);const _0xbfe66f=this[_0x355a8d(0x204)]+'?'+_0x3b256b[_0x355a8d(0x1ec)](),_0x5e2153=Date['now']();try{console['log'](_0x355a8d(0x1c5)),console[_0x355a8d(0x21d)](_0x355a8d(0x203),this['apiUrl']),console[_0x355a8d(0x21d)]('Parameters:',Object[_0x355a8d(0x1ca)](_0x3b256b[_0x355a8d(0x205)]())),console[_0x355a8d(0x21d)]('Full\x20URL\x20(without\x20API\x20key):',_0xbfe66f[_0x355a8d(0x1df)](this[_0x355a8d(0x1d0)],_0x355a8d(0x1ed))),loggerService_1[_0x355a8d(0x1cc)][_0x355a8d(0x221)]('plisio_direct',_0x355a8d(0x1c2),_0x355a8d(0x214),Object[_0x355a8d(0x1ca)](_0x3b256b[_0x355a8d(0x205)]()));const _0x28007e=await fetch(_0xbfe66f,{'method':'GET','headers':{'Accept':_0x355a8d(0x1f0),'User-Agent':_0x355a8d(0x1c9)}}),_0x36a50c=Date['now']()-_0x5e2153;console[_0x355a8d(0x21d)](_0x355a8d(0x20e)),console[_0x355a8d(0x21d)]('Status:',_0x28007e[_0x355a8d(0x220)]),console[_0x355a8d(0x21d)](_0x355a8d(0x1e0),_0x28007e[_0x355a8d(0x229)]),console[_0x355a8d(0x21d)](_0x355a8d(0x212),_0x36a50c+'ms');const _0x23e863=await _0x28007e[_0x355a8d(0x1fe)]();console['log'](_0x355a8d(0x211),_0x23e863);if(!_0x28007e['ok']){console[_0x355a8d(0x1ef)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error'](_0x355a8d(0x1f6),_0x28007e[_0x355a8d(0x220)]),console[_0x355a8d(0x1ef)]('Response\x20Body:',_0x23e863),loggerService_1[_0x355a8d(0x1cc)]['logWhiteDomainResponse'](_0x355a8d(0x1e5),_0x355a8d(0x1c2),_0x28007e[_0x355a8d(0x220)],_0x23e863,_0x36a50c),loggerService_1[_0x355a8d(0x1cc)][_0x355a8d(0x20f)]('plisio_direct',_0x355a8d(0x1c2),_0x355a8d(0x1ee)+_0x28007e[_0x355a8d(0x220)]+':\x20'+_0x23e863);throw new Error('HTTP\x20error!\x20status:\x20'+_0x28007e['status']+_0x355a8d(0x222)+_0x23e863);}let _0x1977c2;try{_0x1977c2=JSON[_0x355a8d(0x228)](_0x23e863);}catch(_0x1b8ae5){console[_0x355a8d(0x1ef)](_0x355a8d(0x216),_0x1b8ae5),loggerService_1[_0x355a8d(0x1cc)]['logWhiteDomainError'](_0x355a8d(0x1e5),_0x355a8d(0x1c2),'JSON\x20Parse\x20Error:\x20'+_0x1b8ae5);throw new Error(_0x355a8d(0x20b)+_0x23e863);}console['log'](_0x355a8d(0x218)),console[_0x355a8d(0x21d)](_0x355a8d(0x21a),JSON['stringify'](_0x1977c2,null,0x2)),loggerService_1[_0x355a8d(0x1cc)][_0x355a8d(0x1d8)](_0x355a8d(0x1e5),_0x355a8d(0x1c2),_0x28007e['status'],_0x1977c2,_0x36a50c);if(_0x1977c2[_0x355a8d(0x220)]!==_0x355a8d(0x210)){const _0x52702c=_0x1977c2['message']||_0x1977c2[_0x355a8d(0x1ef)]||_0x355a8d(0x1f5);console[_0x355a8d(0x1ef)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x355a8d(0x1ef)](_0x355a8d(0x1d3),_0x52702c),loggerService_1[_0x355a8d(0x1cc)][_0x355a8d(0x20f)](_0x355a8d(0x1e5),_0x355a8d(0x1c2),'Business\x20Error:\x20'+_0x52702c);throw new Error(_0x355a8d(0x1da)+_0x52702c);}if(!_0x1977c2[_0x355a8d(0x1fc)]?.[_0x355a8d(0x219)]||!_0x1977c2[_0x355a8d(0x1fc)]?.[_0x355a8d(0x21f)]){console['error'](_0x355a8d(0x22f)),console[_0x355a8d(0x1ef)](_0x355a8d(0x1cb)),console[_0x355a8d(0x1ef)]('Response\x20data:',_0x1977c2[_0x355a8d(0x1fc)]),loggerService_1['loggerService'][_0x355a8d(0x20f)](_0x355a8d(0x1e5),_0x355a8d(0x1c2),_0x355a8d(0x217));throw new Error(_0x355a8d(0x1fd));}return console[_0x355a8d(0x21d)](_0x355a8d(0x1e1)),console[_0x355a8d(0x21d)](_0x355a8d(0x208),_0x1977c2[_0x355a8d(0x1fc)][_0x355a8d(0x219)]),console[_0x355a8d(0x21d)](_0x355a8d(0x207),_0x1977c2[_0x355a8d(0x1fc)]['invoice_url']),console['log']('Amount:',_0x46775d,_0x87e78e),_0x40ea92&&(console[_0x355a8d(0x21d)](_0x355a8d(0x226),_0x40ea92,'(crypto\x20for\x20payment)'),console[_0x355a8d(0x21d)](_0x355a8d(0x1de),_0x87e78e,_0x355a8d(0x200))),{'gateway_payment_id':_0x1977c2[_0x355a8d(0x1fc)][_0x355a8d(0x219)],'payment_url':_0x1977c2[_0x355a8d(0x1fc)]['invoice_url'],'invoice_total_sum':_0x1977c2[_0x355a8d(0x1fc)][_0x355a8d(0x1c6)],'qr_code':_0x1977c2['data']['qr_code'],'qr_url':_0x1977c2[_0x355a8d(0x1fc)][_0x355a8d(0x227)]};}catch(_0x3b56d2){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x355a8d(0x1ef)]('Error\x20details:',_0x3b56d2),loggerService_1['loggerService']['logWhiteDomainError'](_0x355a8d(0x1e5),_0x355a8d(0x1c2),_0x3b56d2);if(_0x3b56d2 instanceof Error){console[_0x355a8d(0x1ef)](_0x355a8d(0x231),_0x3b56d2[_0x355a8d(0x1d5)]),console[_0x355a8d(0x1ef)](_0x355a8d(0x1d2),_0x3b56d2[_0x355a8d(0x1c4)]);throw new Error(_0x355a8d(0x1fa)+_0x3b56d2[_0x355a8d(0x1d5)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a44_0x3eb43c(0x1cf)](_0x4ebfa0){const _0x3105a6=a44_0x3eb43c,_0x328c3b=Date[_0x3105a6(0x22e)]();try{if(!this[_0x3105a6(0x1d0)])throw new Error(_0x3105a6(0x1e4));const _0x3d4ba4=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x4ebfa0}),_0x355b60=_0x3105a6(0x1dd)+_0x4ebfa0+'?'+_0x3d4ba4[_0x3105a6(0x1ec)]();loggerService_1['loggerService'][_0x3105a6(0x221)](_0x3105a6(0x1e5),_0x3105a6(0x1d6)+_0x4ebfa0,_0x3105a6(0x214),Object[_0x3105a6(0x1ca)](_0x3d4ba4[_0x3105a6(0x205)]()));const _0x56527b=await fetch(_0x355b60,{'method':'GET','headers':{'Accept':_0x3105a6(0x1f0),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x8b26b3=Date[_0x3105a6(0x22e)]()-_0x328c3b;if(!_0x56527b['ok']){const _0x175ced=await _0x56527b['text']();loggerService_1[_0x3105a6(0x1cc)][_0x3105a6(0x1d8)](_0x3105a6(0x1e5),_0x3105a6(0x1d6)+_0x4ebfa0,_0x56527b[_0x3105a6(0x220)],_0x175ced,_0x8b26b3);throw new Error('HTTP\x20error!\x20status:\x20'+_0x56527b['status']);}const _0xf41928=await _0x56527b['json']();loggerService_1['loggerService'][_0x3105a6(0x1d8)](_0x3105a6(0x1e5),_0x3105a6(0x1d6)+_0x4ebfa0,_0x56527b['status'],_0xf41928,_0x8b26b3);if(_0xf41928[_0x3105a6(0x220)]!=='success'){loggerService_1['loggerService'][_0x3105a6(0x20f)](_0x3105a6(0x1e5),_0x3105a6(0x1d6)+_0x4ebfa0,_0x3105a6(0x1da)+(_0xf41928[_0x3105a6(0x1d5)]||_0xf41928[_0x3105a6(0x1ef)]||_0x3105a6(0x1f4)));throw new Error('Plisio\x20API\x20error:\x20'+(_0xf41928[_0x3105a6(0x1d5)]||_0xf41928['error']||_0x3105a6(0x1f4)));}let _0x3be490='PENDING';return{'status':_0x3be490};}catch(_0x301397){console[_0x3105a6(0x1ef)](_0x3105a6(0x1ff),_0x301397),loggerService_1['loggerService']['logWhiteDomainError'](_0x3105a6(0x1e5),_0x3105a6(0x1d6)+_0x4ebfa0,_0x301397);throw new Error(_0x3105a6(0x1eb)+(_0x301397 instanceof Error?_0x301397[_0x3105a6(0x1d5)]:_0x3105a6(0x1f4)));}}async[a44_0x3eb43c(0x1ce)](_0x5b4c3c){const _0x1f5b75=a44_0x3eb43c;console['log'](_0x1f5b75(0x1fb),_0x5b4c3c);let _0x125148='PENDING';switch(_0x5b4c3c['status']?.['toLowerCase']()){case _0x1f5b75(0x223):case'mismatch':_0x125148=_0x1f5b75(0x225);break;case'expired':_0x125148=_0x1f5b75(0x20a);break;case _0x1f5b75(0x1ef):case _0x1f5b75(0x21c):_0x125148=_0x1f5b75(0x213);break;case _0x1f5b75(0x1c8):case _0x1f5b75(0x1f1):default:_0x125148=_0x1f5b75(0x215);break;}let _0x86552b;if(_0x5b4c3c['tx_urls'])try{console[_0x1f5b75(0x21d)](_0x1f5b75(0x1d4),_0x5b4c3c[_0x1f5b75(0x20d)]);let _0x1cc427;if(typeof _0x5b4c3c[_0x1f5b75(0x20d)]===_0x1f5b75(0x202))_0x1cc427=JSON['parse'](_0x5b4c3c[_0x1f5b75(0x20d)]);else Array[_0x1f5b75(0x1f2)](_0x5b4c3c[_0x1f5b75(0x20d)])?_0x1cc427=_0x5b4c3c['tx_urls']:_0x1cc427=[];_0x86552b=_0x1cc427[_0x1f5b75(0x1e9)](_0x3b4057=>{const _0x5302ca=_0x1f5b75,_0x15ea80=_0x3b4057[_0x5302ca(0x1df)](/\\/g,'');return console['log'](_0x5302ca(0x1cd)+_0x3b4057+_0x5302ca(0x22d)+_0x15ea80),_0x15ea80;}),console[_0x1f5b75(0x21d)](_0x1f5b75(0x232),_0x86552b),_0x86552b[_0x1f5b75(0x230)]((_0x1aaf77,_0x1f11ed)=>{const _0x4fd94e=_0x1f5b75;try{new URL(_0x1aaf77),console['log'](_0x4fd94e(0x1e3)+(_0x1f11ed+0x1)+_0x4fd94e(0x21e)+_0x1aaf77);}catch(_0x6ee6f8){console[_0x4fd94e(0x1ef)](_0x4fd94e(0x1dc)+(_0x1f11ed+0x1)+_0x4fd94e(0x1d7)+_0x1aaf77,_0x6ee6f8);}});}catch(_0x267df3){console[_0x1f5b75(0x1ef)]('❌\x20Failed\x20to\x20parse\x20tx_urls:',_0x267df3),console[_0x1f5b75(0x1ef)](_0x1f5b75(0x201),_0x5b4c3c[_0x1f5b75(0x20d)]),_0x86552b=undefined;}return{'paymentId':_0x5b4c3c[_0x1f5b75(0x22b)]||'','status':_0x125148,'amount':_0x5b4c3c['amount'],'currency':_0x5b4c3c[_0x1f5b75(0x21b)],'txUrls':_0x86552b};}}exports[a44_0x3eb43c(0x206)]=PlisioService;