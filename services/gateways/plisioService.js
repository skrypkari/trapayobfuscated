'use strict';const a41_0x51b674=a41_0x142d;(function(_0x1dd1ed,_0x58a9e8){const _0x577d0a=a41_0x142d,_0x138e54=_0x1dd1ed();while(!![]){try{const _0x595bf7=-parseInt(_0x577d0a(0x17f))/0x1*(-parseInt(_0x577d0a(0x137))/0x2)+-parseInt(_0x577d0a(0x13e))/0x3*(-parseInt(_0x577d0a(0x13a))/0x4)+-parseInt(_0x577d0a(0x174))/0x5+-parseInt(_0x577d0a(0x15a))/0x6+-parseInt(_0x577d0a(0x181))/0x7+-parseInt(_0x577d0a(0x151))/0x8*(parseInt(_0x577d0a(0x166))/0x9)+-parseInt(_0x577d0a(0x182))/0xa*(-parseInt(_0x577d0a(0x157))/0xb);if(_0x595bf7===_0x58a9e8)break;else _0x138e54['push'](_0x138e54['shift']());}catch(_0x3da24d){_0x138e54['push'](_0x138e54['shift']());}}}(a41_0x8c60,0xa6a85));function a41_0x8c60(){const _0x5a11e9=['7194vkiVaI','TesSoft\x20Payment\x20System/1.0','logWhiteDomainRequest','3195948eJzjZZ','GET','log','stringify','Full\x20URL\x20(without\x20API\x20key):','HIDDEN','Error\x20stack:','verifyPayment','new','apiUrl','amount','Error\x20message:','453483juJWRl','error','processWebhook','parse','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','message','source_currency','name','Processing\x20Plisio\x20webhook:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','/operations/','logWhiteDomainError','Plisio\x20API\x20error:\x20','PAID','1192880CjRyjX','PLISIO_API_KEY','Unknown\x20error','append','Status\x20Text:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','stack','now','Failed\x20to\x20parse\x20JSON\x20response:','mismatch','Amount:','46CxWBbb','PENDING','3086118gYHuGW','15430fgAKGX','Invoice\x20URL:','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','txn_id','fromEntries','Response\x20data:','loggerService','Plisio\x20API\x20key\x20is\x20not\x20configured','(fiat\x20for\x20merchant)','completed','Target\x20Currency:','toLowerCase','URL:','Response\x20Time:','status','text','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','__esModule','warn','Transaction\x20ID:','Parsed\x20Result:','===\x20PLISIO\x20SUCCESS\x20===','createPayment','email','application/json','https://api.plisio.net/api/v1/operations/','json','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','plisio_direct','FAILED','entries','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','cancelled','57222CkgxpX','Plisio\x20payment\x20verification\x20error:','apiKey','3536cHyeJV','(crypto\x20for\x20payment)','toString','Raw\x20Response\x20Body:','1446woVFVn','data','qr_url','order_number','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Status:','currency','statusText','logWhiteDomainResponse','HTTP\x20Status:','/invoices/new','EXPIRED','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','invoice_url','JSON\x20Parse\x20Error:\x20','PlisioService','Error\x20Message:','expired','136tOtMrb','https://api.trapay.uk/api/webhooks/gateway/plisio','HTTP\x20error!\x20status:\x20','https://api.plisio.net/api/v1/invoices/new',',\x20body:\x20','Parameters:'];a41_0x8c60=function(){return _0x5a11e9;};return a41_0x8c60();}Object['defineProperty'](exports,a41_0x51b674(0x193),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require('../loggerService');function a41_0x142d(_0x5c0b95,_0x129acf){const _0x8c60f6=a41_0x8c60();return a41_0x142d=function(_0x142d1e,_0x24f92c){_0x142d1e=_0x142d1e-0x12d;let _0x43afcc=_0x8c60f6[_0x142d1e];return _0x43afcc;},a41_0x142d(_0x5c0b95,_0x129acf);}class PlisioService{constructor(){const _0x4761b0=a41_0x51b674;this[_0x4761b0(0x163)]=_0x4761b0(0x154),this[_0x4761b0(0x139)]=process['env'][_0x4761b0(0x175)]||'',!this[_0x4761b0(0x139)]?console[_0x4761b0(0x194)]('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x4761b0(0x15c)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a41_0x51b674(0x198)](_0x1fbeb2){const _0x4621e1=a41_0x51b674,{orderId:_0x2dc767,amount:_0xc31f7f,currency:_0x353a25,productName:_0x14bca7,description:_0x4078ba,successUrl:_0xdeb5cb,failUrl:_0x1cf788,customerEmail:_0x2d7216,customerName:_0x5c7a3c,isSourceCurrency:_0x440b54,sourceCurrency:_0x1720df}=_0x1fbeb2;if(!this[_0x4621e1(0x139)])throw new Error(_0x4621e1(0x189));const _0x37627a=new URLSearchParams({'api_key':this[_0x4621e1(0x139)],'order_number':_0x2dc767,'order_name':_0x14bca7,'description':_0x4078ba,'success_url':_0xdeb5cb,'fail_url':_0x1cf788,'callback_url':_0x4621e1(0x152)});_0x1720df?(_0x37627a['append']('currency',_0x1720df),_0x37627a[_0x4621e1(0x177)](_0x4621e1(0x16c),_0x353a25),_0x37627a['append']('source_amount',_0xc31f7f[_0x4621e1(0x13c)]())):(_0x37627a['append'](_0x4621e1(0x145),_0x353a25),_0x37627a['append'](_0x4621e1(0x164),_0xc31f7f[_0x4621e1(0x13c)]()));_0x2d7216&&_0x37627a[_0x4621e1(0x177)](_0x4621e1(0x12d),_0x2d7216);_0x5c7a3c&&_0x37627a[_0x4621e1(0x177)](_0x4621e1(0x16d),_0x5c7a3c);const _0x42f473=this['apiUrl']+'?'+_0x37627a[_0x4621e1(0x13c)](),_0x27ac1e=Date[_0x4621e1(0x17b)]();try{console[_0x4621e1(0x15c)](_0x4621e1(0x16f)),console['log'](_0x4621e1(0x18e),this[_0x4621e1(0x163)]),console['log'](_0x4621e1(0x156),Object[_0x4621e1(0x186)](_0x37627a['entries']())),console['log'](_0x4621e1(0x15e),_0x42f473['replace'](this[_0x4621e1(0x139)],_0x4621e1(0x15f))),loggerService_1['loggerService'][_0x4621e1(0x159)](_0x4621e1(0x132),_0x4621e1(0x149),_0x4621e1(0x15b),Object[_0x4621e1(0x186)](_0x37627a['entries']()));const _0x2c92e6=await fetch(_0x42f473,{'method':_0x4621e1(0x15b),'headers':{'Accept':_0x4621e1(0x12e),'User-Agent':_0x4621e1(0x158)}}),_0x258524=Date[_0x4621e1(0x17b)]()-_0x27ac1e;console['log'](_0x4621e1(0x14b)),console[_0x4621e1(0x15c)](_0x4621e1(0x144),_0x2c92e6[_0x4621e1(0x190)]),console['log'](_0x4621e1(0x178),_0x2c92e6[_0x4621e1(0x146)]),console[_0x4621e1(0x15c)](_0x4621e1(0x18f),_0x258524+'ms');const _0x5755a7=await _0x2c92e6[_0x4621e1(0x191)]();console[_0x4621e1(0x15c)](_0x4621e1(0x13d),_0x5755a7);if(!_0x2c92e6['ok']){console[_0x4621e1(0x167)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x4621e1(0x167)](_0x4621e1(0x148),_0x2c92e6['status']),console[_0x4621e1(0x167)]('Response\x20Body:',_0x5755a7),loggerService_1[_0x4621e1(0x188)][_0x4621e1(0x147)]('plisio_direct',_0x4621e1(0x149),_0x2c92e6[_0x4621e1(0x190)],_0x5755a7,_0x258524),loggerService_1[_0x4621e1(0x188)][_0x4621e1(0x171)](_0x4621e1(0x132),_0x4621e1(0x149),'HTTP\x20'+_0x2c92e6[_0x4621e1(0x190)]+':\x20'+_0x5755a7);throw new Error(_0x4621e1(0x153)+_0x2c92e6['status']+_0x4621e1(0x155)+_0x5755a7);}let _0x2568b1;try{_0x2568b1=JSON[_0x4621e1(0x169)](_0x5755a7);}catch(_0x27f8f1){console[_0x4621e1(0x167)](_0x4621e1(0x17c),_0x27f8f1),loggerService_1[_0x4621e1(0x188)][_0x4621e1(0x171)](_0x4621e1(0x132),_0x4621e1(0x149),_0x4621e1(0x14d)+_0x27f8f1);throw new Error(_0x4621e1(0x143)+_0x5755a7);}console[_0x4621e1(0x15c)](_0x4621e1(0x192)),console['log'](_0x4621e1(0x196),JSON[_0x4621e1(0x15d)](_0x2568b1,null,0x2)),loggerService_1[_0x4621e1(0x188)][_0x4621e1(0x147)](_0x4621e1(0x132),_0x4621e1(0x149),_0x2c92e6['status'],_0x2568b1,_0x258524);if(_0x2568b1[_0x4621e1(0x190)]!=='success'){const _0x1bd7d7=_0x2568b1[_0x4621e1(0x16b)]||_0x2568b1[_0x4621e1(0x167)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x4621e1(0x167)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x4621e1(0x167)](_0x4621e1(0x14f),_0x1bd7d7),loggerService_1[_0x4621e1(0x188)]['logWhiteDomainError']('plisio_direct',_0x4621e1(0x149),'Business\x20Error:\x20'+_0x1bd7d7);throw new Error(_0x4621e1(0x172)+_0x1bd7d7);}if(!_0x2568b1['data']?.[_0x4621e1(0x185)]||!_0x2568b1[_0x4621e1(0x13f)]?.[_0x4621e1(0x14c)]){console[_0x4621e1(0x167)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x4621e1(0x167)](_0x4621e1(0x187),_0x2568b1['data']),loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct',_0x4621e1(0x149),_0x4621e1(0x179));throw new Error(_0x4621e1(0x135));}return console[_0x4621e1(0x15c)](_0x4621e1(0x197)),console[_0x4621e1(0x15c)](_0x4621e1(0x195),_0x2568b1['data'][_0x4621e1(0x185)]),console[_0x4621e1(0x15c)](_0x4621e1(0x183),_0x2568b1['data'][_0x4621e1(0x14c)]),console[_0x4621e1(0x15c)](_0x4621e1(0x17e),_0xc31f7f,_0x353a25),_0x1720df&&(console[_0x4621e1(0x15c)]('Source\x20Currency:',_0x1720df,_0x4621e1(0x13b)),console[_0x4621e1(0x15c)](_0x4621e1(0x18c),_0x353a25,_0x4621e1(0x18a))),{'gateway_payment_id':_0x2568b1[_0x4621e1(0x13f)][_0x4621e1(0x185)],'payment_url':_0x2568b1['data'][_0x4621e1(0x14c)],'invoice_total_sum':_0x2568b1['data']['invoice_total_sum'],'qr_code':_0x2568b1[_0x4621e1(0x13f)]['qr_code'],'qr_url':_0x2568b1[_0x4621e1(0x13f)][_0x4621e1(0x140)]};}catch(_0x3bdd19){console['error'](_0x4621e1(0x184)),console[_0x4621e1(0x167)]('Error\x20details:',_0x3bdd19),loggerService_1[_0x4621e1(0x188)][_0x4621e1(0x171)](_0x4621e1(0x132),_0x4621e1(0x149),_0x3bdd19);if(_0x3bdd19 instanceof Error){console[_0x4621e1(0x167)](_0x4621e1(0x165),_0x3bdd19[_0x4621e1(0x16b)]),console['error'](_0x4621e1(0x160),_0x3bdd19[_0x4621e1(0x17a)]);throw new Error(_0x4621e1(0x142)+_0x3bdd19[_0x4621e1(0x16b)]);}throw new Error(_0x4621e1(0x131));}}async[a41_0x51b674(0x161)](_0x4f841f){const _0x759458=a41_0x51b674,_0x69221e=Date[_0x759458(0x17b)]();try{if(!this[_0x759458(0x139)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x19fd2f=new URLSearchParams({'api_key':this[_0x759458(0x139)],'txn_id':_0x4f841f}),_0x4e7996=_0x759458(0x12f)+_0x4f841f+'?'+_0x19fd2f['toString']();loggerService_1[_0x759458(0x188)][_0x759458(0x159)]('plisio_direct',_0x759458(0x170)+_0x4f841f,'GET',Object[_0x759458(0x186)](_0x19fd2f[_0x759458(0x134)]()));const _0x96ddcf=await fetch(_0x4e7996,{'method':_0x759458(0x15b),'headers':{'Accept':_0x759458(0x12e),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x50d56f=Date[_0x759458(0x17b)]()-_0x69221e;if(!_0x96ddcf['ok']){const _0x42c21b=await _0x96ddcf['text']();loggerService_1[_0x759458(0x188)]['logWhiteDomainResponse']('plisio_direct','/operations/'+_0x4f841f,_0x96ddcf[_0x759458(0x190)],_0x42c21b,_0x50d56f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x96ddcf[_0x759458(0x190)]);}const _0xd950ed=await _0x96ddcf[_0x759458(0x130)]();loggerService_1[_0x759458(0x188)][_0x759458(0x147)](_0x759458(0x132),'/operations/'+_0x4f841f,_0x96ddcf[_0x759458(0x190)],_0xd950ed,_0x50d56f);if(_0xd950ed[_0x759458(0x190)]!=='success'){loggerService_1[_0x759458(0x188)][_0x759458(0x171)]('plisio_direct',_0x759458(0x170)+_0x4f841f,_0x759458(0x172)+(_0xd950ed[_0x759458(0x16b)]||_0xd950ed[_0x759458(0x167)]||_0x759458(0x176)));throw new Error(_0x759458(0x172)+(_0xd950ed[_0x759458(0x16b)]||_0xd950ed[_0x759458(0x167)]||_0x759458(0x176)));}let _0x795b5a=_0x759458(0x180);return{'status':_0x795b5a};}catch(_0x2ca0c4){console[_0x759458(0x167)](_0x759458(0x138),_0x2ca0c4),loggerService_1['loggerService']['logWhiteDomainError'](_0x759458(0x132),_0x759458(0x170)+_0x4f841f,_0x2ca0c4);throw new Error(_0x759458(0x16a)+(_0x2ca0c4 instanceof Error?_0x2ca0c4[_0x759458(0x16b)]:'Unknown\x20error'));}}async[a41_0x51b674(0x168)](_0xe4bb5d){const _0x30652c=a41_0x51b674;console['log'](_0x30652c(0x16e),_0xe4bb5d);let _0x1addc6=_0x30652c(0x180);switch(_0xe4bb5d[_0x30652c(0x190)]?.[_0x30652c(0x18d)]()){case _0x30652c(0x18b):case _0x30652c(0x17d):_0x1addc6=_0x30652c(0x173);break;case _0x30652c(0x150):_0x1addc6=_0x30652c(0x14a);break;case _0x30652c(0x167):case _0x30652c(0x136):_0x1addc6=_0x30652c(0x133);break;case _0x30652c(0x162):case'pending':default:_0x1addc6=_0x30652c(0x180);break;}return{'paymentId':_0xe4bb5d[_0x30652c(0x141)]||'','status':_0x1addc6,'amount':_0xe4bb5d[_0x30652c(0x164)],'currency':_0xe4bb5d[_0x30652c(0x145)]};}}exports[a41_0x51b674(0x14e)]=PlisioService;