'use strict';const a44_0xcaf845=a44_0x5608;function a44_0x3f7e(){const _0x9c3a21=['Failed\x20to\x20create\x20Plisio\x20payment:\x20','(crypto\x20for\x20payment)','Failed\x20to\x20parse\x20JSON\x20response:','Unknown\x20error','expired','verifyPayment','data','logWhiteDomainResponse','EXPIRED','log','text','Response\x20Time:','plisio_direct','name','/operations/','‚ùå\x20URL\x20','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','application/json','statusText','URL:','defineProperty','1011206WKYvUw','Full\x20URL\x20(without\x20API\x20key):','PENDING','8BWGapJ','invoice_url','TesSoft\x20Payment\x20System/1.0','mismatch','warn','(fiat\x20for\x20merchant)','toString','env','22351008lNkwdd','GET','qr_code','Parsed\x20Result:','amount','===\x20PLISIO\x20SUCCESS\x20===','67788PZMopq','Parameters:','JSON\x20Parse\x20Error:\x20','parse','email','FAILED','Plisio\x20API\x20error:\x20','5ZizqRA','15DqWRoK','Unknown\x20error\x20from\x20Plisio\x20API','replace','tx_urls','Business\x20Error:\x20','Response\x20Body:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','‚úÖ\x20URL\x20','invoice_total_sum','error','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','message','\x20is\x20valid:\x20','===\x20PLISIO\x20API\x20ERROR\x20===','apiUrl','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','/invoices/new','apiKey','currency','loggerService','success','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','cancelled','‚úÖ\x20Processed\x20tx_urls:','Processing\x20Plisio\x20webhook:','createPayment','Plisio\x20API\x20key\x20is\x20not\x20configured','PLISIO_API_KEY','forEach','59186HSUwSN','json','status','HTTP\x20error!\x20status:\x20','logWhiteDomainError','isArray','__esModule','Transaction\x20ID:','processWebhook','Status\x20Text:','../loggerService','order_number','completed','fromEntries','10516430eIkUeQ','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','üîó\x20Formatted\x20URL:\x20','HTTP\x20','Error\x20details:',',\x20body:\x20','\x20is\x20invalid:\x20','11JRGeIp','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','126NnXaUe','3183548LgdBBA','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Error\x20Message:','PlisioService','749538STdeFY','source_amount','Invoice\x20URL:','append','Status:','https://api.plisio.net/api/v1/operations/','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Amount:','13rZOkOa','txn_id','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Raw\x20Response\x20Body:','now','PAID'];a44_0x3f7e=function(){return _0x9c3a21;};return a44_0x3f7e();}(function(_0x16f421,_0x708dab){const _0xe6545=a44_0x5608,_0x10e046=_0x16f421();while(!![]){try{const _0x14d055=parseInt(_0xe6545(0x17c))/0x1+parseInt(_0xe6545(0x13c))/0x2*(-parseInt(_0xe6545(0x195))/0x3)+parseInt(_0xe6545(0x154))/0x4*(-parseInt(_0xe6545(0x194))/0x5)+parseInt(_0xe6545(0x18d))/0x6*(-parseInt(_0xe6545(0x153))/0x7)+parseInt(_0xe6545(0x17f))/0x8*(-parseInt(_0xe6545(0x158))/0x9)+parseInt(_0xe6545(0x14a))/0xa*(-parseInt(_0xe6545(0x151))/0xb)+-parseInt(_0xe6545(0x187))/0xc*(-parseInt(_0xe6545(0x161))/0xd);if(_0x14d055===_0x708dab)break;else _0x10e046['push'](_0x10e046['shift']());}catch(_0x3dbb81){_0x10e046['push'](_0x10e046['shift']());}}}(a44_0x3f7e,0x90721));Object[a44_0xcaf845(0x17b)](exports,a44_0xcaf845(0x142),{'value':!![]}),exports[a44_0xcaf845(0x157)]=void 0x0;const loggerService_1=require(a44_0xcaf845(0x146));class PlisioService{constructor(){const _0x1ce956=a44_0xcaf845;this[_0x1ce956(0x1a4)]='https://api.plisio.net/api/v1/invoices/new',this[_0x1ce956(0x130)]=process[_0x1ce956(0x186)][_0x1ce956(0x13a)]||'',!this['apiKey']?console[_0x1ce956(0x183)](_0x1ce956(0x152)):console[_0x1ce956(0x170)](_0x1ce956(0x15f));}async[a44_0xcaf845(0x138)](_0x48c41b){const _0x46de9b=a44_0xcaf845,{orderId:_0x219335,amount:_0x35ec7e,currency:_0x36d5bf,productName:_0x37f868,description:_0x11a7fe,successUrl:_0x71fcb5,failUrl:_0x258cfd,customerEmail:_0x2adec5,customerName:_0x24096d,isSourceCurrency:_0x5b23b3,sourceCurrency:_0x32060f}=_0x48c41b;if(!this[_0x46de9b(0x130)])throw new Error(_0x46de9b(0x139));const _0x1a277d=new URLSearchParams({'api_key':this[_0x46de9b(0x130)],'order_number':_0x219335,'order_name':_0x37f868,'description':_0x11a7fe,'success_url':_0x71fcb5,'fail_url':_0x258cfd,'callback_url':'https://apitest.trapay.uk/api/webhooks/gateway/plisio'});_0x32060f?(_0x1a277d[_0x46de9b(0x15b)](_0x46de9b(0x131),_0x32060f),_0x1a277d[_0x46de9b(0x15b)]('source_currency',_0x36d5bf),_0x1a277d[_0x46de9b(0x15b)](_0x46de9b(0x159),_0x35ec7e[_0x46de9b(0x185)]())):(_0x1a277d[_0x46de9b(0x15b)](_0x46de9b(0x131),_0x36d5bf),_0x1a277d[_0x46de9b(0x15b)](_0x46de9b(0x18b),_0x35ec7e['toString']()));_0x2adec5&&_0x1a277d[_0x46de9b(0x15b)](_0x46de9b(0x191),_0x2adec5);_0x24096d&&_0x1a277d[_0x46de9b(0x15b)](_0x46de9b(0x174),_0x24096d);const _0x458c7d=this[_0x46de9b(0x1a4)]+'?'+_0x1a277d[_0x46de9b(0x185)](),_0x3ea405=Date[_0x46de9b(0x165)]();try{console[_0x46de9b(0x170)](_0x46de9b(0x134)),console[_0x46de9b(0x170)](_0x46de9b(0x17a),this[_0x46de9b(0x1a4)]),console[_0x46de9b(0x170)](_0x46de9b(0x18e),Object[_0x46de9b(0x149)](_0x1a277d['entries']())),console[_0x46de9b(0x170)](_0x46de9b(0x17d),_0x458c7d[_0x46de9b(0x197)](this[_0x46de9b(0x130)],'HIDDEN')),loggerService_1[_0x46de9b(0x132)]['logWhiteDomainRequest']('plisio_direct',_0x46de9b(0x12f),_0x46de9b(0x188),Object[_0x46de9b(0x149)](_0x1a277d['entries']()));const _0x21413d=await fetch(_0x458c7d,{'method':_0x46de9b(0x188),'headers':{'Accept':_0x46de9b(0x178),'User-Agent':_0x46de9b(0x181)}}),_0x1ba845=Date[_0x46de9b(0x165)]()-_0x3ea405;console['log'](_0x46de9b(0x155)),console[_0x46de9b(0x170)](_0x46de9b(0x15c),_0x21413d[_0x46de9b(0x13e)]),console['log'](_0x46de9b(0x145),_0x21413d[_0x46de9b(0x179)]),console[_0x46de9b(0x170)](_0x46de9b(0x172),_0x1ba845+'ms');const _0x1ced4e=await _0x21413d['text']();console[_0x46de9b(0x170)](_0x46de9b(0x164),_0x1ced4e);if(!_0x21413d['ok']){console[_0x46de9b(0x19f)](_0x46de9b(0x1a3)),console[_0x46de9b(0x19f)]('HTTP\x20Status:',_0x21413d[_0x46de9b(0x13e)]),console[_0x46de9b(0x19f)](_0x46de9b(0x19a),_0x1ced4e),loggerService_1[_0x46de9b(0x132)][_0x46de9b(0x16e)](_0x46de9b(0x173),_0x46de9b(0x12f),_0x21413d[_0x46de9b(0x13e)],_0x1ced4e,_0x1ba845),loggerService_1[_0x46de9b(0x132)]['logWhiteDomainError'](_0x46de9b(0x173),_0x46de9b(0x12f),_0x46de9b(0x14d)+_0x21413d[_0x46de9b(0x13e)]+':\x20'+_0x1ced4e);throw new Error(_0x46de9b(0x13f)+_0x21413d[_0x46de9b(0x13e)]+_0x46de9b(0x14f)+_0x1ced4e);}let _0x446c6b;try{_0x446c6b=JSON[_0x46de9b(0x190)](_0x1ced4e);}catch(_0x5e61cb){console['error'](_0x46de9b(0x169),_0x5e61cb),loggerService_1[_0x46de9b(0x132)]['logWhiteDomainError'](_0x46de9b(0x173),_0x46de9b(0x12f),_0x46de9b(0x18f)+_0x5e61cb);throw new Error(_0x46de9b(0x1a0)+_0x1ced4e);}console[_0x46de9b(0x170)](_0x46de9b(0x1a5)),console[_0x46de9b(0x170)](_0x46de9b(0x18a),JSON['stringify'](_0x446c6b,null,0x2)),loggerService_1[_0x46de9b(0x132)][_0x46de9b(0x16e)](_0x46de9b(0x173),_0x46de9b(0x12f),_0x21413d['status'],_0x446c6b,_0x1ba845);if(_0x446c6b[_0x46de9b(0x13e)]!=='success'){const _0x4785be=_0x446c6b['message']||_0x446c6b[_0x46de9b(0x19f)]||_0x46de9b(0x196);console[_0x46de9b(0x19f)](_0x46de9b(0x14b)),console[_0x46de9b(0x19f)](_0x46de9b(0x156),_0x4785be),loggerService_1[_0x46de9b(0x132)][_0x46de9b(0x140)](_0x46de9b(0x173),_0x46de9b(0x12f),_0x46de9b(0x199)+_0x4785be);throw new Error(_0x46de9b(0x193)+_0x4785be);}if(!_0x446c6b[_0x46de9b(0x16d)]?.[_0x46de9b(0x162)]||!_0x446c6b[_0x46de9b(0x16d)]?.[_0x46de9b(0x180)]){console[_0x46de9b(0x19f)](_0x46de9b(0x163)),console[_0x46de9b(0x19f)](_0x46de9b(0x19b)),console[_0x46de9b(0x19f)]('Response\x20data:',_0x446c6b[_0x46de9b(0x16d)]),loggerService_1[_0x46de9b(0x132)][_0x46de9b(0x140)](_0x46de9b(0x173),_0x46de9b(0x12f),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x46de9b(0x170)](_0x46de9b(0x18c)),console[_0x46de9b(0x170)](_0x46de9b(0x143),_0x446c6b[_0x46de9b(0x16d)][_0x46de9b(0x162)]),console['log'](_0x46de9b(0x15a),_0x446c6b['data'][_0x46de9b(0x180)]),console['log'](_0x46de9b(0x160),_0x35ec7e,_0x36d5bf),_0x32060f&&(console[_0x46de9b(0x170)]('Source\x20Currency:',_0x32060f,_0x46de9b(0x168)),console['log']('Target\x20Currency:',_0x36d5bf,_0x46de9b(0x184))),{'gateway_payment_id':_0x446c6b[_0x46de9b(0x16d)][_0x46de9b(0x162)],'payment_url':_0x446c6b['data'][_0x46de9b(0x180)],'invoice_total_sum':_0x446c6b[_0x46de9b(0x16d)][_0x46de9b(0x19e)],'qr_code':_0x446c6b[_0x46de9b(0x16d)][_0x46de9b(0x189)],'qr_url':_0x446c6b[_0x46de9b(0x16d)]['qr_url']};}catch(_0x15d054){console[_0x46de9b(0x19f)](_0x46de9b(0x19c)),console[_0x46de9b(0x19f)](_0x46de9b(0x14e),_0x15d054),loggerService_1[_0x46de9b(0x132)][_0x46de9b(0x140)](_0x46de9b(0x173),'/invoices/new',_0x15d054);if(_0x15d054 instanceof Error){console[_0x46de9b(0x19f)]('Error\x20message:',_0x15d054['message']),console[_0x46de9b(0x19f)]('Error\x20stack:',_0x15d054['stack']);throw new Error(_0x46de9b(0x167)+_0x15d054['message']);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a44_0xcaf845(0x16c)](_0x4edfce){const _0x5f50bc=a44_0xcaf845,_0x1cad4b=Date[_0x5f50bc(0x165)]();try{if(!this[_0x5f50bc(0x130)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x477752=new URLSearchParams({'api_key':this[_0x5f50bc(0x130)],'txn_id':_0x4edfce}),_0x53fc30=_0x5f50bc(0x15d)+_0x4edfce+'?'+_0x477752[_0x5f50bc(0x185)]();loggerService_1[_0x5f50bc(0x132)]['logWhiteDomainRequest'](_0x5f50bc(0x173),_0x5f50bc(0x175)+_0x4edfce,_0x5f50bc(0x188),Object[_0x5f50bc(0x149)](_0x477752['entries']()));const _0x519ddd=await fetch(_0x53fc30,{'method':_0x5f50bc(0x188),'headers':{'Accept':_0x5f50bc(0x178),'User-Agent':_0x5f50bc(0x181)}}),_0x278049=Date['now']()-_0x1cad4b;if(!_0x519ddd['ok']){const _0x4915a9=await _0x519ddd[_0x5f50bc(0x171)]();loggerService_1[_0x5f50bc(0x132)][_0x5f50bc(0x16e)](_0x5f50bc(0x173),'/operations/'+_0x4edfce,_0x519ddd[_0x5f50bc(0x13e)],_0x4915a9,_0x278049);throw new Error(_0x5f50bc(0x13f)+_0x519ddd[_0x5f50bc(0x13e)]);}const _0x5356c6=await _0x519ddd[_0x5f50bc(0x13d)]();loggerService_1[_0x5f50bc(0x132)][_0x5f50bc(0x16e)](_0x5f50bc(0x173),_0x5f50bc(0x175)+_0x4edfce,_0x519ddd[_0x5f50bc(0x13e)],_0x5356c6,_0x278049);if(_0x5356c6[_0x5f50bc(0x13e)]!==_0x5f50bc(0x133)){loggerService_1['loggerService'][_0x5f50bc(0x140)](_0x5f50bc(0x173),_0x5f50bc(0x175)+_0x4edfce,_0x5f50bc(0x193)+(_0x5356c6['message']||_0x5356c6[_0x5f50bc(0x19f)]||'Unknown\x20error'));throw new Error('Plisio\x20API\x20error:\x20'+(_0x5356c6[_0x5f50bc(0x1a1)]||_0x5356c6[_0x5f50bc(0x19f)]||_0x5f50bc(0x16a)));}let _0x762f8c=_0x5f50bc(0x17e);return{'status':_0x762f8c};}catch(_0x5c97c3){console[_0x5f50bc(0x19f)]('Plisio\x20payment\x20verification\x20error:',_0x5c97c3),loggerService_1['loggerService'][_0x5f50bc(0x140)](_0x5f50bc(0x173),_0x5f50bc(0x175)+_0x4edfce,_0x5c97c3);throw new Error(_0x5f50bc(0x15e)+(_0x5c97c3 instanceof Error?_0x5c97c3[_0x5f50bc(0x1a1)]:'Unknown\x20error'));}}async[a44_0xcaf845(0x144)](_0x9c1026){const _0x442c98=a44_0xcaf845;console[_0x442c98(0x170)](_0x442c98(0x137),_0x9c1026);let _0x2812c6=_0x442c98(0x17e);switch(_0x9c1026[_0x442c98(0x13e)]?.['toLowerCase']()){case _0x442c98(0x148):case _0x442c98(0x182):_0x2812c6=_0x442c98(0x166);break;case _0x442c98(0x16b):_0x2812c6=_0x442c98(0x16f);break;case'error':case _0x442c98(0x135):_0x2812c6=_0x442c98(0x192);break;case'new':case'pending':default:_0x2812c6=_0x442c98(0x17e);break;}let _0x4c0ee2;if(_0x9c1026[_0x442c98(0x198)])try{console[_0x442c98(0x170)](_0x442c98(0x177),_0x9c1026['tx_urls']);let _0x2121e8;if(typeof _0x9c1026[_0x442c98(0x198)]==='string')_0x2121e8=JSON['parse'](_0x9c1026[_0x442c98(0x198)]);else Array[_0x442c98(0x141)](_0x9c1026[_0x442c98(0x198)])?_0x2121e8=_0x9c1026[_0x442c98(0x198)]:_0x2121e8=[];_0x4c0ee2=_0x2121e8['map'](_0x1a970a=>{const _0x598996=_0x442c98,_0x6a067=_0x1a970a['replace'](/\\/g,'');return console[_0x598996(0x170)](_0x598996(0x14c)+_0x1a970a+'\x20->\x20'+_0x6a067),_0x6a067;}),console[_0x442c98(0x170)](_0x442c98(0x136),_0x4c0ee2),_0x4c0ee2[_0x442c98(0x13b)]((_0x5e85a3,_0x49c6bf)=>{const _0x5983b2=_0x442c98;try{new URL(_0x5e85a3),console[_0x5983b2(0x170)](_0x5983b2(0x19d)+(_0x49c6bf+0x1)+_0x5983b2(0x1a2)+_0x5e85a3);}catch(_0x47631b){console[_0x5983b2(0x19f)](_0x5983b2(0x176)+(_0x49c6bf+0x1)+_0x5983b2(0x150)+_0x5e85a3,_0x47631b);}});}catch(_0x41fe4e){console[_0x442c98(0x19f)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x41fe4e),console[_0x442c98(0x19f)]('Raw\x20tx_urls\x20data:',_0x9c1026[_0x442c98(0x198)]),_0x4c0ee2=undefined;}return{'paymentId':_0x9c1026[_0x442c98(0x147)]||'','status':_0x2812c6,'amount':_0x9c1026[_0x442c98(0x18b)],'currency':_0x9c1026[_0x442c98(0x131)],'txUrls':_0x4c0ee2};}}function a44_0x5608(_0x436654,_0x3157e4){const _0x3f7e06=a44_0x3f7e();return a44_0x5608=function(_0x5608e2,_0x16bff6){_0x5608e2=_0x5608e2-0x12f;let _0x5819c9=_0x3f7e06[_0x5608e2];return _0x5819c9;},a44_0x5608(_0x436654,_0x3157e4);}exports['PlisioService']=PlisioService;