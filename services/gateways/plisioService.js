'use strict';const a44_0x453122=a44_0x4af7;function a44_0x4af7(_0x58f103,_0x1140e7){const _0x1a6d2b=a44_0x1a6d();return a44_0x4af7=function(_0x4af7f4,_0x3eb4f3){_0x4af7f4=_0x4af7f4-0xd8;let _0x19ee02=_0x1a6d2b[_0x4af7f4];return _0x19ee02;},a44_0x4af7(_0x58f103,_0x1140e7);}(function(_0x46a061,_0x15f695){const _0x139816=a44_0x4af7,_0x2a4486=_0x46a061();while(!![]){try{const _0x4b1c4f=-parseInt(_0x139816(0xd9))/0x1+parseInt(_0x139816(0x145))/0x2+parseInt(_0x139816(0xf7))/0x3+-parseInt(_0x139816(0x12c))/0x4+parseInt(_0x139816(0xfe))/0x5*(-parseInt(_0x139816(0x13c))/0x6)+parseInt(_0x139816(0x11e))/0x7*(-parseInt(_0x139816(0x12f))/0x8)+parseInt(_0x139816(0x142))/0x9;if(_0x4b1c4f===_0x15f695)break;else _0x2a4486['push'](_0x2a4486['shift']());}catch(_0xcbd91c){_0x2a4486['push'](_0x2a4486['shift']());}}}(a44_0x1a6d,0x898a9));Object[a44_0x453122(0xe2)](exports,a44_0x453122(0xe5),{'value':!![]}),exports[a44_0x453122(0xe7)]=void 0x0;const loggerService_1=require(a44_0x453122(0x129));function a44_0x1a6d(){const _0x2f2602=['‚úÖ\x20Processed\x20tx_urls:','Failed\x20to\x20create\x20Plisio\x20payment:\x20','completed','pending','\x20is\x20invalid:\x20','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Plisio\x20API\x20key\x20is\x20not\x20configured','Plisio\x20API\x20error:\x20','43482umtGCi','Raw\x20tx_urls\x20data:','logWhiteDomainRequest','HTTP\x20error!\x20status:\x20','‚ùå\x20URL\x20','PAID','16443441YNtHJS','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Processing\x20Plisio\x20webhook:','1085976nfpfpO','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20Status:','invoice_url','tx_urls','json','env','601266WyNlYB','/operations/','Amount:','https://api.plisio.net/api/v1/operations/','apiKey','https://api.plisio.net/api/v1/invoices/new','Parsed\x20Result:','logWhiteDomainResponse','processWebhook','defineProperty','https://api.trapay.uk/api/webhooks/gateway/plisio','toString','__esModule','Plisio\x20payment\x20verification\x20error:','PlisioService','map','/invoices/new',',\x20body:\x20','parse','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','===\x20PLISIO\x20SUCCESS\x20===','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Status:','Response\x20Time:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','txn_id','log','Source\x20Currency:','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','data','1904820mabmyL','Unknown\x20error','apiUrl','application/json','loggerService','PENDING','logWhiteDomainError','365NWBzcv','forEach','verifyPayment','HIDDEN','Status\x20Text:','status','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','fromEntries','amount','string','Raw\x20Response\x20Body:','cancelled','text','Response\x20data:','email','replace','\x20->\x20','entries','qr_url','(crypto\x20for\x20payment)','currency','EXPIRED','append','Full\x20URL\x20(without\x20API\x20key):','üîó\x20Formatted\x20URL:\x20','Error\x20details:','message','source_currency','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','source_amount','success','917RPuPLa','toLowerCase','now','GET','Error\x20Message:','PLISIO_API_KEY','new','createPayment','TesSoft\x20Payment\x20System/1.0','statusText','FAILED','../loggerService','Error\x20message:','plisio_direct','2746288QPMXNC','Error\x20stack:','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','38152IyDzgi','error','stringify'];a44_0x1a6d=function(){return _0x2f2602;};return a44_0x1a6d();}class PlisioService{constructor(){const _0x3fd85b=a44_0x453122;this[_0x3fd85b(0xf9)]=_0x3fd85b(0xde),this[_0x3fd85b(0xdd)]=process[_0x3fd85b(0xd8)][_0x3fd85b(0x123)]||'',!this[_0x3fd85b(0xdd)]?console['warn']('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console['log'](_0x3fd85b(0x104));}async[a44_0x453122(0x125)](_0x20ef07){const _0x5991b7=a44_0x453122,{orderId:_0x3968f4,amount:_0x5097a6,currency:_0x372a4f,productName:_0x3503e0,description:_0x1e9270,successUrl:_0x4d708c,failUrl:_0x467532,customerEmail:_0x4f2b6a,customerName:_0x4e8d2e,isSourceCurrency:_0x2eb7a6,sourceCurrency:_0x458560}=_0x20ef07;if(!this[_0x5991b7(0xdd)])throw new Error(_0x5991b7(0x13a));const _0x261ff7=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x3968f4,'order_name':_0x3503e0,'description':_0x1e9270,'success_url':_0x4d708c,'fail_url':_0x467532,'callback_url':_0x5991b7(0xe3)});_0x458560?(_0x261ff7['append'](_0x5991b7(0x112),_0x458560),_0x261ff7[_0x5991b7(0x114)](_0x5991b7(0x119),_0x372a4f),_0x261ff7['append'](_0x5991b7(0x11c),_0x5097a6[_0x5991b7(0xe4)]())):(_0x261ff7[_0x5991b7(0x114)](_0x5991b7(0x112),_0x372a4f),_0x261ff7[_0x5991b7(0x114)](_0x5991b7(0x106),_0x5097a6[_0x5991b7(0xe4)]()));_0x4f2b6a&&_0x261ff7['append'](_0x5991b7(0x10c),_0x4f2b6a);_0x4e8d2e&&_0x261ff7[_0x5991b7(0x114)]('name',_0x4e8d2e);const _0x456a37=this[_0x5991b7(0xf9)]+'?'+_0x261ff7[_0x5991b7(0xe4)](),_0x110b19=Date[_0x5991b7(0x120)]();try{console[_0x5991b7(0xf3)](_0x5991b7(0xee)),console[_0x5991b7(0xf3)]('URL:',this[_0x5991b7(0xf9)]),console['log']('Parameters:',Object[_0x5991b7(0x105)](_0x261ff7[_0x5991b7(0x10f)]())),console[_0x5991b7(0xf3)](_0x5991b7(0x115),_0x456a37['replace'](this['apiKey'],_0x5991b7(0x101))),loggerService_1[_0x5991b7(0xfb)]['logWhiteDomainRequest']('plisio_direct',_0x5991b7(0xe9),'GET',Object[_0x5991b7(0x105)](_0x261ff7[_0x5991b7(0x10f)]()));const _0x25cd07=await fetch(_0x456a37,{'method':_0x5991b7(0x121),'headers':{'Accept':_0x5991b7(0xfa),'User-Agent':_0x5991b7(0x126)}}),_0x4d5dc1=Date['now']()-_0x110b19;console[_0x5991b7(0xf3)](_0x5991b7(0xf1)),console['log'](_0x5991b7(0xef),_0x25cd07['status']),console[_0x5991b7(0xf3)](_0x5991b7(0x102),_0x25cd07[_0x5991b7(0x127)]),console[_0x5991b7(0xf3)](_0x5991b7(0xf0),_0x4d5dc1+'ms');const _0x1efb83=await _0x25cd07[_0x5991b7(0x10a)]();console['log'](_0x5991b7(0x108),_0x1efb83);if(!_0x25cd07['ok']){console['error']('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error'](_0x5991b7(0x147),_0x25cd07[_0x5991b7(0x103)]),console['error']('Response\x20Body:',_0x1efb83),loggerService_1['loggerService'][_0x5991b7(0xe0)]('plisio_direct',_0x5991b7(0xe9),_0x25cd07[_0x5991b7(0x103)],_0x1efb83,_0x4d5dc1),loggerService_1[_0x5991b7(0xfb)][_0x5991b7(0xfd)](_0x5991b7(0x12b),_0x5991b7(0xe9),'HTTP\x20'+_0x25cd07['status']+':\x20'+_0x1efb83);throw new Error('HTTP\x20error!\x20status:\x20'+_0x25cd07[_0x5991b7(0x103)]+_0x5991b7(0xea)+_0x1efb83);}let _0x2a7917;try{_0x2a7917=JSON['parse'](_0x1efb83);}catch(_0x278c47){console[_0x5991b7(0x130)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x278c47),loggerService_1[_0x5991b7(0xfb)][_0x5991b7(0xfd)](_0x5991b7(0x12b),'/invoices/new','JSON\x20Parse\x20Error:\x20'+_0x278c47);throw new Error(_0x5991b7(0x138)+_0x1efb83);}console['log']('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console['log'](_0x5991b7(0xdf),JSON[_0x5991b7(0x131)](_0x2a7917,null,0x2)),loggerService_1[_0x5991b7(0xfb)][_0x5991b7(0xe0)]('plisio_direct',_0x5991b7(0xe9),_0x25cd07[_0x5991b7(0x103)],_0x2a7917,_0x4d5dc1);if(_0x2a7917['status']!==_0x5991b7(0x11d)){const _0x2d4752=_0x2a7917[_0x5991b7(0x118)]||_0x2a7917[_0x5991b7(0x130)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x5991b7(0x130)](_0x5991b7(0x146)),console['error'](_0x5991b7(0x122),_0x2d4752),loggerService_1[_0x5991b7(0xfb)][_0x5991b7(0xfd)]('plisio_direct','/invoices/new','Business\x20Error:\x20'+_0x2d4752);throw new Error('Plisio\x20API\x20error:\x20'+_0x2d4752);}if(!_0x2a7917[_0x5991b7(0xf6)]?.[_0x5991b7(0xf2)]||!_0x2a7917[_0x5991b7(0xf6)]?.[_0x5991b7(0x148)]){console[_0x5991b7(0x130)](_0x5991b7(0xf5)),console[_0x5991b7(0x130)](_0x5991b7(0x11b)),console['error'](_0x5991b7(0x10b),_0x2a7917[_0x5991b7(0xf6)]),loggerService_1[_0x5991b7(0xfb)][_0x5991b7(0xfd)](_0x5991b7(0x12b),_0x5991b7(0xe9),_0x5991b7(0x143));throw new Error(_0x5991b7(0x139));}return console['log'](_0x5991b7(0xed)),console[_0x5991b7(0xf3)]('Transaction\x20ID:',_0x2a7917[_0x5991b7(0xf6)][_0x5991b7(0xf2)]),console['log']('Invoice\x20URL:',_0x2a7917[_0x5991b7(0xf6)]['invoice_url']),console[_0x5991b7(0xf3)](_0x5991b7(0xdb),_0x5097a6,_0x372a4f),_0x458560&&(console[_0x5991b7(0xf3)](_0x5991b7(0xf4),_0x458560,_0x5991b7(0x111)),console[_0x5991b7(0xf3)]('Target\x20Currency:',_0x372a4f,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x2a7917['data']['txn_id'],'payment_url':_0x2a7917[_0x5991b7(0xf6)][_0x5991b7(0x148)],'invoice_total_sum':_0x2a7917['data']['invoice_total_sum'],'qr_code':_0x2a7917[_0x5991b7(0xf6)]['qr_code'],'qr_url':_0x2a7917[_0x5991b7(0xf6)][_0x5991b7(0x110)]};}catch(_0x1b15e4){console[_0x5991b7(0x130)](_0x5991b7(0x137)),console[_0x5991b7(0x130)](_0x5991b7(0x117),_0x1b15e4),loggerService_1[_0x5991b7(0xfb)][_0x5991b7(0xfd)]('plisio_direct',_0x5991b7(0xe9),_0x1b15e4);if(_0x1b15e4 instanceof Error){console[_0x5991b7(0x130)](_0x5991b7(0x12a),_0x1b15e4['message']),console['error'](_0x5991b7(0x12d),_0x1b15e4['stack']);throw new Error(_0x5991b7(0x133)+_0x1b15e4[_0x5991b7(0x118)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a44_0x453122(0x100)](_0xeed204){const _0x56e119=a44_0x453122,_0x481f=Date[_0x56e119(0x120)]();try{if(!this[_0x56e119(0xdd)])throw new Error(_0x56e119(0x13a));const _0x5b0191=new URLSearchParams({'api_key':this[_0x56e119(0xdd)],'txn_id':_0xeed204}),_0x56f797=_0x56e119(0xdc)+_0xeed204+'?'+_0x5b0191[_0x56e119(0xe4)]();loggerService_1[_0x56e119(0xfb)][_0x56e119(0x13e)](_0x56e119(0x12b),_0x56e119(0xda)+_0xeed204,_0x56e119(0x121),Object[_0x56e119(0x105)](_0x5b0191[_0x56e119(0x10f)]()));const _0x404fab=await fetch(_0x56f797,{'method':_0x56e119(0x121),'headers':{'Accept':'application/json','User-Agent':_0x56e119(0x126)}}),_0x29ccab=Date[_0x56e119(0x120)]()-_0x481f;if(!_0x404fab['ok']){const _0x1d170b=await _0x404fab[_0x56e119(0x10a)]();loggerService_1[_0x56e119(0xfb)][_0x56e119(0xe0)](_0x56e119(0x12b),'/operations/'+_0xeed204,_0x404fab['status'],_0x1d170b,_0x29ccab);throw new Error(_0x56e119(0x13f)+_0x404fab[_0x56e119(0x103)]);}const _0x1fe308=await _0x404fab[_0x56e119(0x14a)]();loggerService_1[_0x56e119(0xfb)]['logWhiteDomainResponse'](_0x56e119(0x12b),_0x56e119(0xda)+_0xeed204,_0x404fab[_0x56e119(0x103)],_0x1fe308,_0x29ccab);if(_0x1fe308['status']!==_0x56e119(0x11d)){loggerService_1[_0x56e119(0xfb)]['logWhiteDomainError'](_0x56e119(0x12b),_0x56e119(0xda)+_0xeed204,_0x56e119(0x13b)+(_0x1fe308[_0x56e119(0x118)]||_0x1fe308['error']||_0x56e119(0xf8)));throw new Error(_0x56e119(0x13b)+(_0x1fe308['message']||_0x1fe308[_0x56e119(0x130)]||_0x56e119(0xf8)));}let _0x2e52b1=_0x56e119(0xfc);return{'status':_0x2e52b1};}catch(_0x1de8af){console['error'](_0x56e119(0xe6),_0x1de8af),loggerService_1[_0x56e119(0xfb)][_0x56e119(0xfd)](_0x56e119(0x12b),'/operations/'+_0xeed204,_0x1de8af);throw new Error(_0x56e119(0x11a)+(_0x1de8af instanceof Error?_0x1de8af['message']:_0x56e119(0xf8)));}}async[a44_0x453122(0xe1)](_0x246857){const _0x58d522=a44_0x453122;console['log'](_0x58d522(0x144),_0x246857);let _0x4112a6=_0x58d522(0xfc);switch(_0x246857[_0x58d522(0x103)]?.[_0x58d522(0x11f)]()){case _0x58d522(0x134):case'mismatch':_0x4112a6=_0x58d522(0x141);break;case'expired':_0x4112a6=_0x58d522(0x113);break;case _0x58d522(0x130):case _0x58d522(0x109):_0x4112a6=_0x58d522(0x128);break;case _0x58d522(0x124):case _0x58d522(0x135):default:_0x4112a6=_0x58d522(0xfc);break;}let _0x19bbf6;if(_0x246857['tx_urls'])try{console[_0x58d522(0xf3)](_0x58d522(0xec),_0x246857[_0x58d522(0x149)]);let _0x46efb6;if(typeof _0x246857[_0x58d522(0x149)]===_0x58d522(0x107))_0x46efb6=JSON[_0x58d522(0xeb)](_0x246857[_0x58d522(0x149)]);else Array['isArray'](_0x246857['tx_urls'])?_0x46efb6=_0x246857[_0x58d522(0x149)]:_0x46efb6=[];_0x19bbf6=_0x46efb6[_0x58d522(0xe8)](_0xd3d523=>{const _0x25e6f1=_0x58d522,_0x36dd14=_0xd3d523[_0x25e6f1(0x10d)](/\\/g,'');return console[_0x25e6f1(0xf3)](_0x25e6f1(0x116)+_0xd3d523+_0x25e6f1(0x10e)+_0x36dd14),_0x36dd14;}),console[_0x58d522(0xf3)](_0x58d522(0x132),_0x19bbf6),_0x19bbf6[_0x58d522(0xff)]((_0x5f34c0,_0x25d2ae)=>{const _0xe74bca=_0x58d522;try{new URL(_0x5f34c0),console[_0xe74bca(0xf3)]('‚úÖ\x20URL\x20'+(_0x25d2ae+0x1)+'\x20is\x20valid:\x20'+_0x5f34c0);}catch(_0xbd6934){console[_0xe74bca(0x130)](_0xe74bca(0x140)+(_0x25d2ae+0x1)+_0xe74bca(0x136)+_0x5f34c0,_0xbd6934);}});}catch(_0x4fd2e0){console[_0x58d522(0x130)](_0x58d522(0x12e),_0x4fd2e0),console[_0x58d522(0x130)](_0x58d522(0x13d),_0x246857['tx_urls']),_0x19bbf6=undefined;}return{'paymentId':_0x246857['order_number']||'','status':_0x4112a6,'amount':_0x246857['amount'],'currency':_0x246857[_0x58d522(0x112)],'txUrls':_0x19bbf6};}}exports[a44_0x453122(0xe7)]=PlisioService;