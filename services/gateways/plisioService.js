'use strict';const a45_0x2f3d13=a45_0x9f38;(function(_0x3dfacd,_0x3e531b){const _0x44a9a9=a45_0x9f38,_0x383518=_0x3dfacd();while(!![]){try{const _0xd9bd34=-parseInt(_0x44a9a9(0x1df))/0x1+-parseInt(_0x44a9a9(0x1c0))/0x2*(-parseInt(_0x44a9a9(0x1e6))/0x3)+parseInt(_0x44a9a9(0x1db))/0x4+parseInt(_0x44a9a9(0x1dd))/0x5+-parseInt(_0x44a9a9(0x1cf))/0x6+parseInt(_0x44a9a9(0x1f7))/0x7+parseInt(_0x44a9a9(0x1f2))/0x8;if(_0xd9bd34===_0x3e531b)break;else _0x383518['push'](_0x383518['shift']());}catch(_0x1d96e8){_0x383518['push'](_0x383518['shift']());}}}(a45_0x2c4e,0x95e3f));function a45_0x9f38(_0x58f277,_0x3b7a4f){const _0x2c4e1d=a45_0x2c4e();return a45_0x9f38=function(_0x9f3819,_0x23b963){_0x9f3819=_0x9f3819-0x1a2;let _0x1df451=_0x2c4e1d[_0x9f3819];return _0x1df451;},a45_0x9f38(_0x58f277,_0x3b7a4f);}Object[a45_0x2f3d13(0x1fd)](exports,a45_0x2f3d13(0x1dc),{'value':!![]}),exports[a45_0x2f3d13(0x1b2)]=void 0x0;function a45_0x2c4e(){const _0x3cb03e=['email','EXPIRED','Error\x20message:','Business\x20Error:\x20','forEach','new','URL:','logWhiteDomainRequest','Invoice\x20URL:','https://api.plisio.net/api/v1/invoices/new','Response\x20Time:','269744GfZvEz','__esModule','5132695Xzlsef','amount','1222983SNjvNV','log','append','Response\x20data:','name','Plisio\x20API\x20key\x20is\x20not\x20configured','Target\x20Currency:','12oloOLD','/invoices/new','stringify','Parsed\x20Result:','Raw\x20Response\x20Body:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','PAID','order_number','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Plisio\x20payment\x20verification\x20error:','toLowerCase','https://api.trapay.uk/api/webhooks/gateway/plisio','8844880jjnJOr','txn_id','expired','logWhiteDomainError','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','876344TnfjQJ','‚úÖ\x20Processed\x20tx_urls:','JSON\x20Parse\x20Error:\x20','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','pending','PENDING','defineProperty','TesSoft\x20Payment\x20System/1.0','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Raw\x20tx_urls\x20data:','(crypto\x20for\x20payment)','stack','completed','Plisio\x20API\x20error:\x20','(fiat\x20for\x20merchant)','text','processWebhook','cancelled','FAILED','üîó\x20Formatted\x20URL:\x20','parse','===\x20PLISIO\x20API\x20ERROR\x20===','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','plisio_direct','Error\x20details:','Source\x20Currency:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','apiKey','\x20->\x20','warn','currency','logWhiteDomainResponse','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','\x20is\x20invalid:\x20','Processing\x20Plisio\x20webhook:','toString','mismatch','apiUrl','entries','https://api.plisio.net/api/v1/operations/','HTTP\x20Status:','success','error','Error\x20Message:','GET','PlisioService','string','Unknown\x20error','replace','verifyPayment','data','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','invoice_url','Status:','HTTP\x20','json','invoice_total_sum','message','HTTP\x20error!\x20status:\x20','329858ztcKDV','‚úÖ\x20URL\x20','tx_urls','/operations/','status','isArray','qr_code','‚ùå\x20URL\x20','Transaction\x20ID:','qr_url','fromEntries','statusText','loggerService','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','now','6885354IJvAIC'];a45_0x2c4e=function(){return _0x3cb03e;};return a45_0x2c4e();}const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x5e48ed=a45_0x2f3d13;this['apiUrl']=_0x5e48ed(0x1d9),this[_0x5e48ed(0x213)]=process['env']['PLISIO_API_KEY']||'',!this[_0x5e48ed(0x213)]?console[_0x5e48ed(0x1a2)]('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x5e48ed(0x1e0)](_0x5e48ed(0x1a5));}async['createPayment'](_0x106dfd){const _0x53d0b4=a45_0x2f3d13,{orderId:_0x245ac1,amount:_0x179354,currency:_0xe027c1,productName:_0x5b9b23,description:_0x1a35f6,successUrl:_0x6438e8,failUrl:_0x3772e0,customerEmail:_0x297985,customerName:_0x1f7f6b,isSourceCurrency:_0x355c89,sourceCurrency:_0x220a87}=_0x106dfd;if(!this['apiKey'])throw new Error(_0x53d0b4(0x1e4));const _0x12ec38=new URLSearchParams({'api_key':this[_0x53d0b4(0x213)],'order_number':_0x245ac1,'order_name':_0x5b9b23,'description':_0x1a35f6,'success_url':_0x6438e8,'fail_url':_0x3772e0,'callback_url':_0x53d0b4(0x1f1)});_0x220a87?(_0x12ec38[_0x53d0b4(0x1e1)](_0x53d0b4(0x1a3),_0x220a87),_0x12ec38[_0x53d0b4(0x1e1)]('source_currency',_0xe027c1),_0x12ec38[_0x53d0b4(0x1e1)]('source_amount',_0x179354[_0x53d0b4(0x1a8)]())):(_0x12ec38[_0x53d0b4(0x1e1)]('currency',_0xe027c1),_0x12ec38[_0x53d0b4(0x1e1)](_0x53d0b4(0x1de),_0x179354[_0x53d0b4(0x1a8)]()));_0x297985&&_0x12ec38[_0x53d0b4(0x1e1)](_0x53d0b4(0x1d0),_0x297985);_0x1f7f6b&&_0x12ec38[_0x53d0b4(0x1e1)](_0x53d0b4(0x1e3),_0x1f7f6b);const _0x49cdaa=this['apiUrl']+'?'+_0x12ec38[_0x53d0b4(0x1a8)](),_0x4685f3=Date[_0x53d0b4(0x1ce)]();try{console['log'](_0x53d0b4(0x1cd)),console[_0x53d0b4(0x1e0)](_0x53d0b4(0x1d6),this[_0x53d0b4(0x1aa)]),console[_0x53d0b4(0x1e0)]('Parameters:',Object[_0x53d0b4(0x1ca)](_0x12ec38[_0x53d0b4(0x1ab)]())),console[_0x53d0b4(0x1e0)]('Full\x20URL\x20(without\x20API\x20key):',_0x49cdaa[_0x53d0b4(0x1b5)](this[_0x53d0b4(0x213)],'HIDDEN')),loggerService_1[_0x53d0b4(0x1cc)][_0x53d0b4(0x1d7)](_0x53d0b4(0x20e),'/invoices/new','GET',Object[_0x53d0b4(0x1ca)](_0x12ec38[_0x53d0b4(0x1ab)]()));const _0x1cc9c7=await fetch(_0x49cdaa,{'method':_0x53d0b4(0x1b1),'headers':{'Accept':'application/json','User-Agent':_0x53d0b4(0x1fe)}}),_0x3d549e=Date[_0x53d0b4(0x1ce)]()-_0x4685f3;console[_0x53d0b4(0x1e0)](_0x53d0b4(0x211)),console[_0x53d0b4(0x1e0)](_0x53d0b4(0x1ba),_0x1cc9c7[_0x53d0b4(0x1c4)]),console[_0x53d0b4(0x1e0)]('Status\x20Text:',_0x1cc9c7[_0x53d0b4(0x1cb)]),console[_0x53d0b4(0x1e0)](_0x53d0b4(0x1da),_0x3d549e+'ms');const _0x58458a=await _0x1cc9c7[_0x53d0b4(0x206)]();console['log'](_0x53d0b4(0x1ea),_0x58458a);if(!_0x1cc9c7['ok']){console[_0x53d0b4(0x1af)](_0x53d0b4(0x20c)),console[_0x53d0b4(0x1af)](_0x53d0b4(0x1ad),_0x1cc9c7[_0x53d0b4(0x1c4)]),console[_0x53d0b4(0x1af)]('Response\x20Body:',_0x58458a),loggerService_1[_0x53d0b4(0x1cc)]['logWhiteDomainResponse']('plisio_direct',_0x53d0b4(0x1e7),_0x1cc9c7[_0x53d0b4(0x1c4)],_0x58458a,_0x3d549e),loggerService_1['loggerService'][_0x53d0b4(0x1f5)](_0x53d0b4(0x20e),_0x53d0b4(0x1e7),_0x53d0b4(0x1bb)+_0x1cc9c7[_0x53d0b4(0x1c4)]+':\x20'+_0x58458a);throw new Error(_0x53d0b4(0x1bf)+_0x1cc9c7[_0x53d0b4(0x1c4)]+',\x20body:\x20'+_0x58458a);}let _0x4b9bc4;try{_0x4b9bc4=JSON[_0x53d0b4(0x20b)](_0x58458a);}catch(_0x2284a7){console[_0x53d0b4(0x1af)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x2284a7),loggerService_1[_0x53d0b4(0x1cc)][_0x53d0b4(0x1f5)](_0x53d0b4(0x20e),_0x53d0b4(0x1e7),_0x53d0b4(0x1f9)+_0x2284a7);throw new Error(_0x53d0b4(0x212)+_0x58458a);}console[_0x53d0b4(0x1e0)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x53d0b4(0x1e0)](_0x53d0b4(0x1e9),JSON[_0x53d0b4(0x1e8)](_0x4b9bc4,null,0x2)),loggerService_1['loggerService'][_0x53d0b4(0x1a4)]('plisio_direct',_0x53d0b4(0x1e7),_0x1cc9c7[_0x53d0b4(0x1c4)],_0x4b9bc4,_0x3d549e);if(_0x4b9bc4['status']!==_0x53d0b4(0x1ae)){const _0xfc44bd=_0x4b9bc4['message']||_0x4b9bc4[_0x53d0b4(0x1af)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x53d0b4(0x1af)](_0x53d0b4(0x1fa)),console['error'](_0x53d0b4(0x1b0),_0xfc44bd),loggerService_1[_0x53d0b4(0x1cc)][_0x53d0b4(0x1f5)](_0x53d0b4(0x20e),_0x53d0b4(0x1e7),_0x53d0b4(0x1d3)+_0xfc44bd);throw new Error('Plisio\x20API\x20error:\x20'+_0xfc44bd);}if(!_0x4b9bc4[_0x53d0b4(0x1b7)]?.[_0x53d0b4(0x1f3)]||!_0x4b9bc4['data']?.['invoice_url']){console['error']('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x53d0b4(0x1af)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x53d0b4(0x1af)](_0x53d0b4(0x1e2),_0x4b9bc4[_0x53d0b4(0x1b7)]),loggerService_1[_0x53d0b4(0x1cc)][_0x53d0b4(0x1f5)](_0x53d0b4(0x20e),_0x53d0b4(0x1e7),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x53d0b4(0x1eb));}return console['log']('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x53d0b4(0x1e0)](_0x53d0b4(0x1c8),_0x4b9bc4[_0x53d0b4(0x1b7)][_0x53d0b4(0x1f3)]),console[_0x53d0b4(0x1e0)](_0x53d0b4(0x1d8),_0x4b9bc4[_0x53d0b4(0x1b7)][_0x53d0b4(0x1b9)]),console['log']('Amount:',_0x179354,_0xe027c1),_0x220a87&&(console[_0x53d0b4(0x1e0)](_0x53d0b4(0x210),_0x220a87,_0x53d0b4(0x201)),console[_0x53d0b4(0x1e0)](_0x53d0b4(0x1e5),_0xe027c1,_0x53d0b4(0x205))),{'gateway_payment_id':_0x4b9bc4['data'][_0x53d0b4(0x1f3)],'payment_url':_0x4b9bc4[_0x53d0b4(0x1b7)][_0x53d0b4(0x1b9)],'invoice_total_sum':_0x4b9bc4[_0x53d0b4(0x1b7)][_0x53d0b4(0x1bd)],'qr_code':_0x4b9bc4['data'][_0x53d0b4(0x1c6)],'qr_url':_0x4b9bc4['data'][_0x53d0b4(0x1c9)]};}catch(_0x592d68){console['error'](_0x53d0b4(0x1ff)),console[_0x53d0b4(0x1af)](_0x53d0b4(0x20f),_0x592d68),loggerService_1['loggerService'][_0x53d0b4(0x1f5)](_0x53d0b4(0x20e),_0x53d0b4(0x1e7),_0x592d68);if(_0x592d68 instanceof Error){console[_0x53d0b4(0x1af)](_0x53d0b4(0x1d2),_0x592d68[_0x53d0b4(0x1be)]),console[_0x53d0b4(0x1af)]('Error\x20stack:',_0x592d68[_0x53d0b4(0x202)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x592d68[_0x53d0b4(0x1be)]);}throw new Error(_0x53d0b4(0x20d));}}async[a45_0x2f3d13(0x1b6)](_0x54e97c){const _0x39d405=a45_0x2f3d13,_0x5dec37=Date[_0x39d405(0x1ce)]();try{if(!this[_0x39d405(0x213)])throw new Error(_0x39d405(0x1e4));const _0x17fd22=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x54e97c}),_0x33bcf6=_0x39d405(0x1ac)+_0x54e97c+'?'+_0x17fd22['toString']();loggerService_1[_0x39d405(0x1cc)]['logWhiteDomainRequest']('plisio_direct',_0x39d405(0x1c3)+_0x54e97c,_0x39d405(0x1b1),Object[_0x39d405(0x1ca)](_0x17fd22[_0x39d405(0x1ab)]()));const _0x5061a0=await fetch(_0x33bcf6,{'method':'GET','headers':{'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x2b2e43=Date[_0x39d405(0x1ce)]()-_0x5dec37;if(!_0x5061a0['ok']){const _0x4a34b7=await _0x5061a0[_0x39d405(0x206)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x39d405(0x20e),_0x39d405(0x1c3)+_0x54e97c,_0x5061a0[_0x39d405(0x1c4)],_0x4a34b7,_0x2b2e43);throw new Error(_0x39d405(0x1bf)+_0x5061a0[_0x39d405(0x1c4)]);}const _0x412bb6=await _0x5061a0[_0x39d405(0x1bc)]();loggerService_1['loggerService'][_0x39d405(0x1a4)](_0x39d405(0x20e),'/operations/'+_0x54e97c,_0x5061a0[_0x39d405(0x1c4)],_0x412bb6,_0x2b2e43);if(_0x412bb6[_0x39d405(0x1c4)]!==_0x39d405(0x1ae)){loggerService_1['loggerService'][_0x39d405(0x1f5)](_0x39d405(0x20e),_0x39d405(0x1c3)+_0x54e97c,'Plisio\x20API\x20error:\x20'+(_0x412bb6[_0x39d405(0x1be)]||_0x412bb6[_0x39d405(0x1af)]||_0x39d405(0x1b4)));throw new Error(_0x39d405(0x204)+(_0x412bb6[_0x39d405(0x1be)]||_0x412bb6[_0x39d405(0x1af)]||_0x39d405(0x1b4)));}let _0x55b9b7=_0x39d405(0x1fc);return{'status':_0x55b9b7};}catch(_0x4da120){console['error'](_0x39d405(0x1ef),_0x4da120),loggerService_1[_0x39d405(0x1cc)][_0x39d405(0x1f5)]('plisio_direct','/operations/'+_0x54e97c,_0x4da120);throw new Error(_0x39d405(0x1ee)+(_0x4da120 instanceof Error?_0x4da120['message']:'Unknown\x20error'));}}async[a45_0x2f3d13(0x207)](_0x292ba8){const _0x27352a=a45_0x2f3d13;console['log'](_0x27352a(0x1a7),_0x292ba8);let _0x501de3='PENDING';switch(_0x292ba8['status']?.[_0x27352a(0x1f0)]()){case _0x27352a(0x203):case _0x27352a(0x1a9):_0x501de3=_0x27352a(0x1ec);break;case _0x27352a(0x1f4):_0x501de3=_0x27352a(0x1d1);break;case _0x27352a(0x1af):case _0x27352a(0x208):_0x501de3=_0x27352a(0x209);break;case _0x27352a(0x1d5):_0x501de3=_0x27352a(0x1fc);break;case _0x27352a(0x1fb):_0x501de3='PROCESSING';break;default:_0x501de3=_0x27352a(0x1fc);break;}let _0x435b60;if(_0x292ba8['tx_urls'])try{console['log'](_0x27352a(0x1f6),_0x292ba8['tx_urls']);let _0x35b51a;if(typeof _0x292ba8[_0x27352a(0x1c2)]===_0x27352a(0x1b3))_0x35b51a=JSON[_0x27352a(0x20b)](_0x292ba8[_0x27352a(0x1c2)]);else Array[_0x27352a(0x1c5)](_0x292ba8[_0x27352a(0x1c2)])?_0x35b51a=_0x292ba8['tx_urls']:_0x35b51a=[];_0x435b60=_0x35b51a['map'](_0x424291=>{const _0x37b37e=_0x27352a,_0xf10315=_0x424291[_0x37b37e(0x1b5)](/\\/g,'');return console['log'](_0x37b37e(0x20a)+_0x424291+_0x37b37e(0x214)+_0xf10315),_0xf10315;}),console['log'](_0x27352a(0x1f8),_0x435b60),_0x435b60[_0x27352a(0x1d4)]((_0x5756e8,_0x446338)=>{const _0x6690c3=_0x27352a;try{new URL(_0x5756e8),console[_0x6690c3(0x1e0)](_0x6690c3(0x1c1)+(_0x446338+0x1)+'\x20is\x20valid:\x20'+_0x5756e8);}catch(_0x52ee99){console['error'](_0x6690c3(0x1c7)+(_0x446338+0x1)+_0x6690c3(0x1a6)+_0x5756e8,_0x52ee99);}});}catch(_0x11db43){console[_0x27352a(0x1af)](_0x27352a(0x1b8),_0x11db43),console[_0x27352a(0x1af)](_0x27352a(0x200),_0x292ba8['tx_urls']),_0x435b60=undefined;}return{'paymentId':_0x292ba8[_0x27352a(0x1ed)]||'','status':_0x501de3,'amount':_0x292ba8[_0x27352a(0x1de)],'currency':_0x292ba8['currency'],'txUrls':_0x435b60};}}exports[a45_0x2f3d13(0x1b2)]=PlisioService;