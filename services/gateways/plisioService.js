'use strict';const a55_0x45ed2f=a55_0x2b2f;(function(_0x5054d7,_0x5cbff8){const _0x27b608=a55_0x2b2f,_0xd5de91=_0x5054d7();while(!![]){try{const _0x2e43a0=-parseInt(_0x27b608(0x101))/0x1+parseInt(_0x27b608(0x12d))/0x2*(parseInt(_0x27b608(0xed))/0x3)+-parseInt(_0x27b608(0x107))/0x4*(-parseInt(_0x27b608(0xe2))/0x5)+-parseInt(_0x27b608(0x100))/0x6*(-parseInt(_0x27b608(0x134))/0x7)+-parseInt(_0x27b608(0xf1))/0x8+-parseInt(_0x27b608(0xfb))/0x9*(-parseInt(_0x27b608(0xdb))/0xa)+-parseInt(_0x27b608(0x12b))/0xb;if(_0x2e43a0===_0x5cbff8)break;else _0xd5de91['push'](_0xd5de91['shift']());}catch(_0x154e69){_0xd5de91['push'](_0xd5de91['shift']());}}}(a55_0xcbdf,0x4fac9));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a55_0x45ed2f(0x11a)]=void 0x0;const loggerService_1=require('../loggerService');function a55_0xcbdf(){const _0x289776=['amount','replace','stack','Unknown\x20error\x20from\x20Plisio\x20API','Status:','40630RKazAO','source_currency','fromEntries','map','loggerService','logWhiteDomainRequest','Full\x20URL\x20(without\x20API\x20key):','908810mjAjXf','application/json','HTTP\x20error!\x20status:\x20','error','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Error\x20message:','/invoices/new','message','Parameters:','Error\x20stack:','Business\x20Error:\x20','6873fFGqwF','apiKey','Processing\x20Plisio\x20webhook:','mismatch','1014264bmPMRZ','statusText','log','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Source\x20Currency:','expired','logWhiteDomainError','üîó\x20Formatted\x20URL:\x20','status','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','1287jmoGsn','Invoice\x20URL:','HTTP\x20Status:','processWebhook','Raw\x20tx_urls\x20data:','18IhvggW','336794WrjLVU','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','Status\x20Text:','verifyPayment','cancelled','/operations/','4NnZLBg','Parsed\x20Result:','plisio_direct','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','(crypto\x20for\x20payment)','toString','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','\x20->\x20','Payment\x20System/1.0','GET','FAILED','completed','HTTP\x20','data','createPayment','new','PENDING','Transaction\x20ID:','apiUrl','PlisioService','stringify','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Response\x20data:','URL:','invoice_url','https://api.plisio.net/api/v1/invoices/new','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Failed\x20to\x20parse\x20JSON\x20response:','Amount:','pending','\x20is\x20invalid:\x20','PROCESSING','warn','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','JSON\x20Parse\x20Error:\x20','order_number','7206254ddGRSp','Error\x20details:','266hzvjey','parse','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','‚ùå\x20URL\x20','tx_urls','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','currency','880978QRPZAS','txn_id','PLISIO_API_KEY','text',',\x20body:\x20','email','Plisio\x20API\x20error:\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','string','entries','EXPIRED','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Response\x20Time:','now','‚úÖ\x20Processed\x20tx_urls:','append','Unknown\x20error','toLowerCase','logWhiteDomainResponse','Plisio\x20API\x20key\x20is\x20not\x20configured','source_amount','===\x20PLISIO\x20API\x20ERROR\x20==='];a55_0xcbdf=function(){return _0x289776;};return a55_0xcbdf();}function a55_0x2b2f(_0x228fa0,_0x532815){const _0xcbdf84=a55_0xcbdf();return a55_0x2b2f=function(_0x2b2fcd,_0x4d9c0c){_0x2b2fcd=_0x2b2fcd-0xd0;let _0x2e89b9=_0xcbdf84[_0x2b2fcd];return _0x2e89b9;},a55_0x2b2f(_0x228fa0,_0x532815);}class PlisioService{constructor(){const _0x141262=a55_0x45ed2f;this['apiUrl']=_0x141262(0x120),this['apiKey']=process['env'][_0x141262(0x136)]||'',!this[_0x141262(0xee)]?console[_0x141262(0x127)](_0x141262(0xf4)):console['log'](_0x141262(0x128));}async[a55_0x45ed2f(0x115)](_0x388c42){const _0x57e8a2=a55_0x45ed2f,{orderId:_0x219aeb,amount:_0x13b843,currency:_0x403ed2,productName:_0x4b3972,description:_0x19bf34,successUrl:_0x559384,failUrl:_0x493260,customerEmail:_0x52aa5f,customerName:_0x3d98e7,isSourceCurrency:_0x4373bb,sourceCurrency:_0x2a6ab7}=_0x388c42;if(!this[_0x57e8a2(0xee)])throw new Error(_0x57e8a2(0xd3));const _0x2981a8=new URLSearchParams({'api_key':this[_0x57e8a2(0xee)],'order_number':_0x219aeb,'order_name':_0x4b3972,'description':_0x19bf34,'success_url':_0x559384,'fail_url':_0x493260,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x2a6ab7?(_0x2981a8[_0x57e8a2(0x143)](_0x57e8a2(0x133),_0x2a6ab7),_0x2981a8[_0x57e8a2(0x143)](_0x57e8a2(0xdc),_0x403ed2),_0x2981a8[_0x57e8a2(0x143)](_0x57e8a2(0xd4),_0x13b843[_0x57e8a2(0x10c)]())):(_0x2981a8[_0x57e8a2(0x143)]('currency',_0x403ed2),_0x2981a8['append'](_0x57e8a2(0xd6),_0x13b843[_0x57e8a2(0x10c)]()));_0x52aa5f&&_0x2981a8[_0x57e8a2(0x143)](_0x57e8a2(0x139),_0x52aa5f);_0x3d98e7&&_0x2981a8[_0x57e8a2(0x143)]('name',_0x3d98e7);const _0x481721=this[_0x57e8a2(0x119)]+'?'+_0x2981a8['toString'](),_0xa66be7=Date['now']();try{console['log'](_0x57e8a2(0xe6)),console['log'](_0x57e8a2(0x11e),this[_0x57e8a2(0x119)]),console['log'](_0x57e8a2(0xea),Object[_0x57e8a2(0xdd)](_0x2981a8[_0x57e8a2(0x13d)]())),console[_0x57e8a2(0xf3)](_0x57e8a2(0xe1),_0x481721[_0x57e8a2(0xd7)](this['apiKey'],'HIDDEN')),loggerService_1[_0x57e8a2(0xdf)][_0x57e8a2(0xe0)]('plisio_direct',_0x57e8a2(0xe8),_0x57e8a2(0x110),Object[_0x57e8a2(0xdd)](_0x2981a8[_0x57e8a2(0x13d)]()));const _0x50d6f1=await fetch(_0x481721,{'method':_0x57e8a2(0x110),'headers':{'Accept':'application/json','User-Agent':'Payment\x20System/1.0'}}),_0x22df5f=Date[_0x57e8a2(0x141)]()-_0xa66be7;console[_0x57e8a2(0xf3)](_0x57e8a2(0x11c)),console[_0x57e8a2(0xf3)](_0x57e8a2(0xda),_0x50d6f1[_0x57e8a2(0xf9)]),console[_0x57e8a2(0xf3)](_0x57e8a2(0x103),_0x50d6f1[_0x57e8a2(0xf2)]),console['log'](_0x57e8a2(0x140),_0x22df5f+'ms');const _0x1634d5=await _0x50d6f1[_0x57e8a2(0x137)]();console[_0x57e8a2(0xf3)]('Raw\x20Response\x20Body:',_0x1634d5);if(!_0x50d6f1['ok']){console[_0x57e8a2(0xe5)](_0x57e8a2(0xd5)),console[_0x57e8a2(0xe5)](_0x57e8a2(0xfd),_0x50d6f1[_0x57e8a2(0xf9)]),console[_0x57e8a2(0xe5)]('Response\x20Body:',_0x1634d5),loggerService_1[_0x57e8a2(0xdf)][_0x57e8a2(0xd2)](_0x57e8a2(0x109),'/invoices/new',_0x50d6f1['status'],_0x1634d5,_0x22df5f),loggerService_1[_0x57e8a2(0xdf)][_0x57e8a2(0xf7)]('plisio_direct',_0x57e8a2(0xe8),_0x57e8a2(0x113)+_0x50d6f1[_0x57e8a2(0xf9)]+':\x20'+_0x1634d5);throw new Error(_0x57e8a2(0xe4)+_0x50d6f1[_0x57e8a2(0xf9)]+_0x57e8a2(0x138)+_0x1634d5);}let _0x48bb13;try{_0x48bb13=JSON[_0x57e8a2(0x12e)](_0x1634d5);}catch(_0x2616c7){console[_0x57e8a2(0xe5)](_0x57e8a2(0x122),_0x2616c7),loggerService_1[_0x57e8a2(0xdf)][_0x57e8a2(0xf7)](_0x57e8a2(0x109),_0x57e8a2(0xe8),_0x57e8a2(0x129)+_0x2616c7);throw new Error(_0x57e8a2(0x13f)+_0x1634d5);}console['log'](_0x57e8a2(0xfa)),console[_0x57e8a2(0xf3)](_0x57e8a2(0x108),JSON[_0x57e8a2(0x11b)](_0x48bb13,null,0x2)),loggerService_1[_0x57e8a2(0xdf)][_0x57e8a2(0xd2)]('plisio_direct',_0x57e8a2(0xe8),_0x50d6f1[_0x57e8a2(0xf9)],_0x48bb13,_0x22df5f);if(_0x48bb13[_0x57e8a2(0xf9)]!=='success'){const _0x5b0d7f=_0x48bb13[_0x57e8a2(0xe9)]||_0x48bb13['error']||_0x57e8a2(0xd9);console['error'](_0x57e8a2(0x10a)),console[_0x57e8a2(0xe5)]('Error\x20Message:',_0x5b0d7f),loggerService_1['loggerService'][_0x57e8a2(0xf7)]('plisio_direct',_0x57e8a2(0xe8),_0x57e8a2(0xec)+_0x5b0d7f);throw new Error(_0x57e8a2(0x13a)+_0x5b0d7f);}if(!_0x48bb13[_0x57e8a2(0x114)]?.[_0x57e8a2(0x135)]||!_0x48bb13['data']?.[_0x57e8a2(0x11f)]){console[_0x57e8a2(0xe5)](_0x57e8a2(0x12f)),console['error'](_0x57e8a2(0x102)),console[_0x57e8a2(0xe5)](_0x57e8a2(0x11d),_0x48bb13[_0x57e8a2(0x114)]),loggerService_1[_0x57e8a2(0xdf)][_0x57e8a2(0xf7)](_0x57e8a2(0x109),_0x57e8a2(0xe8),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x57e8a2(0x132));}return console['log']('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x57e8a2(0xf3)](_0x57e8a2(0x118),_0x48bb13[_0x57e8a2(0x114)][_0x57e8a2(0x135)]),console[_0x57e8a2(0xf3)](_0x57e8a2(0xfc),_0x48bb13[_0x57e8a2(0x114)][_0x57e8a2(0x11f)]),console[_0x57e8a2(0xf3)](_0x57e8a2(0x123),_0x13b843,_0x403ed2),_0x2a6ab7&&(console[_0x57e8a2(0xf3)](_0x57e8a2(0xf5),_0x2a6ab7,_0x57e8a2(0x10b)),console[_0x57e8a2(0xf3)]('Target\x20Currency:',_0x403ed2,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x48bb13[_0x57e8a2(0x114)][_0x57e8a2(0x135)],'payment_url':_0x48bb13['data'][_0x57e8a2(0x11f)],'invoice_total_sum':_0x48bb13[_0x57e8a2(0x114)]['invoice_total_sum'],'qr_code':_0x48bb13['data']['qr_code'],'qr_url':_0x48bb13[_0x57e8a2(0x114)]['qr_url']};}catch(_0x318392){console[_0x57e8a2(0xe5)](_0x57e8a2(0x10d)),console['error'](_0x57e8a2(0x12c),_0x318392),loggerService_1[_0x57e8a2(0xdf)]['logWhiteDomainError'](_0x57e8a2(0x109),_0x57e8a2(0xe8),_0x318392);if(_0x318392 instanceof Error){console[_0x57e8a2(0xe5)](_0x57e8a2(0xe7),_0x318392[_0x57e8a2(0xe9)]),console[_0x57e8a2(0xe5)](_0x57e8a2(0xeb),_0x318392[_0x57e8a2(0xd8)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x318392[_0x57e8a2(0xe9)]);}throw new Error(_0x57e8a2(0x13b));}}async[a55_0x45ed2f(0x104)](_0x30d97d){const _0x18bbc4=a55_0x45ed2f,_0x4b55a1=Date[_0x18bbc4(0x141)]();try{if(!this[_0x18bbc4(0xee)])throw new Error(_0x18bbc4(0xd3));const _0x2af523=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x30d97d}),_0x1f7fa9='https://api.plisio.net/api/v1/operations/'+_0x30d97d+'?'+_0x2af523[_0x18bbc4(0x10c)]();loggerService_1['loggerService'][_0x18bbc4(0xe0)](_0x18bbc4(0x109),'/operations/'+_0x30d97d,_0x18bbc4(0x110),Object[_0x18bbc4(0xdd)](_0x2af523[_0x18bbc4(0x13d)]()));const _0x45e321=await fetch(_0x1f7fa9,{'method':_0x18bbc4(0x110),'headers':{'Accept':_0x18bbc4(0xe3),'User-Agent':_0x18bbc4(0x10f)}}),_0x26271f=Date['now']()-_0x4b55a1;if(!_0x45e321['ok']){const _0x3334db=await _0x45e321[_0x18bbc4(0x137)]();loggerService_1[_0x18bbc4(0xdf)][_0x18bbc4(0xd2)](_0x18bbc4(0x109),_0x18bbc4(0x106)+_0x30d97d,_0x45e321[_0x18bbc4(0xf9)],_0x3334db,_0x26271f);throw new Error(_0x18bbc4(0xe4)+_0x45e321[_0x18bbc4(0xf9)]);}const _0x33141c=await _0x45e321['json']();loggerService_1[_0x18bbc4(0xdf)][_0x18bbc4(0xd2)]('plisio_direct',_0x18bbc4(0x106)+_0x30d97d,_0x45e321['status'],_0x33141c,_0x26271f);if(_0x33141c['status']!=='success'){loggerService_1[_0x18bbc4(0xdf)][_0x18bbc4(0xf7)](_0x18bbc4(0x109),_0x18bbc4(0x106)+_0x30d97d,_0x18bbc4(0x13a)+(_0x33141c[_0x18bbc4(0xe9)]||_0x33141c[_0x18bbc4(0xe5)]||'Unknown\x20error'));throw new Error(_0x18bbc4(0x13a)+(_0x33141c[_0x18bbc4(0xe9)]||_0x33141c[_0x18bbc4(0xe5)]||'Unknown\x20error'));}let _0x3581b2=_0x18bbc4(0x117);return{'status':_0x3581b2};}catch(_0x4fbc89){console[_0x18bbc4(0xe5)]('Plisio\x20payment\x20verification\x20error:',_0x4fbc89),loggerService_1[_0x18bbc4(0xdf)][_0x18bbc4(0xf7)](_0x18bbc4(0x109),_0x18bbc4(0x106)+_0x30d97d,_0x4fbc89);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x4fbc89 instanceof Error?_0x4fbc89['message']:_0x18bbc4(0xd0)));}}async[a55_0x45ed2f(0xfe)](_0x4a83ac){const _0x23bdfb=a55_0x45ed2f;console[_0x23bdfb(0xf3)](_0x23bdfb(0xef),_0x4a83ac);let _0x3b9349=_0x23bdfb(0x117);switch(_0x4a83ac['status']?.[_0x23bdfb(0xd1)]()){case _0x23bdfb(0x112):case _0x23bdfb(0xf0):_0x3b9349='PAID';break;case _0x23bdfb(0xf6):_0x3b9349=_0x23bdfb(0x13e);break;case'error':case _0x23bdfb(0x105):_0x3b9349=_0x23bdfb(0x111);break;case _0x23bdfb(0x116):_0x3b9349='PENDING';break;case _0x23bdfb(0x124):_0x3b9349=_0x23bdfb(0x126);break;default:_0x3b9349='PENDING';break;}let _0x22f2e4;if(_0x4a83ac[_0x23bdfb(0x131)])try{console[_0x23bdfb(0xf3)](_0x23bdfb(0x121),_0x4a83ac[_0x23bdfb(0x131)]);let _0x4347b2;if(typeof _0x4a83ac[_0x23bdfb(0x131)]===_0x23bdfb(0x13c))_0x4347b2=JSON[_0x23bdfb(0x12e)](_0x4a83ac['tx_urls']);else Array['isArray'](_0x4a83ac[_0x23bdfb(0x131)])?_0x4347b2=_0x4a83ac['tx_urls']:_0x4347b2=[];_0x22f2e4=_0x4347b2[_0x23bdfb(0xde)](_0x4e6c08=>{const _0xbc09c8=_0x23bdfb,_0x37a81c=_0x4e6c08[_0xbc09c8(0xd7)](/\\/g,'');return console['log'](_0xbc09c8(0xf8)+_0x4e6c08+_0xbc09c8(0x10e)+_0x37a81c),_0x37a81c;}),console[_0x23bdfb(0xf3)](_0x23bdfb(0x142),_0x22f2e4),_0x22f2e4['forEach']((_0x5f3da8,_0x10d4c5)=>{const _0x6d291=_0x23bdfb;try{new URL(_0x5f3da8),console[_0x6d291(0xf3)]('‚úÖ\x20URL\x20'+(_0x10d4c5+0x1)+'\x20is\x20valid:\x20'+_0x5f3da8);}catch(_0x52f443){console[_0x6d291(0xe5)](_0x6d291(0x130)+(_0x10d4c5+0x1)+_0x6d291(0x125)+_0x5f3da8,_0x52f443);}});}catch(_0x1d3723){console[_0x23bdfb(0xe5)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x1d3723),console[_0x23bdfb(0xe5)](_0x23bdfb(0xff),_0x4a83ac['tx_urls']),_0x22f2e4=undefined;}return{'paymentId':_0x4a83ac[_0x23bdfb(0x12a)]||'','status':_0x3b9349,'amount':_0x4a83ac[_0x23bdfb(0xd6)],'currency':_0x4a83ac[_0x23bdfb(0x133)],'txUrls':_0x22f2e4};}}exports['PlisioService']=PlisioService;