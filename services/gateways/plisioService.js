'use strict';function a62_0x29eb(_0x3f44e8,_0x29668a){_0x3f44e8=_0x3f44e8-0x16a;const _0x216907=a62_0x2169();let _0x29eb6f=_0x216907[_0x3f44e8];return _0x29eb6f;}const a62_0x526a00=a62_0x29eb;(function(_0x2b9ebc,_0x3fb8ee){const _0x571953=a62_0x29eb,_0x248a7f=_0x2b9ebc();while(!![]){try{const _0x49137e=-parseInt(_0x571953(0x17d))/0x1*(-parseInt(_0x571953(0x1c5))/0x2)+-parseInt(_0x571953(0x1ae))/0x3+-parseInt(_0x571953(0x183))/0x4+parseInt(_0x571953(0x197))/0x5*(parseInt(_0x571953(0x1af))/0x6)+parseInt(_0x571953(0x19a))/0x7*(parseInt(_0x571953(0x1ad))/0x8)+parseInt(_0x571953(0x1d0))/0x9+-parseInt(_0x571953(0x16a))/0xa*(parseInt(_0x571953(0x1d9))/0xb);if(_0x49137e===_0x3fb8ee)break;else _0x248a7f['push'](_0x248a7f['shift']());}catch(_0x6b3091){_0x248a7f['push'](_0x248a7f['shift']());}}}(a62_0x2169,0x71ed6));Object[a62_0x526a00(0x1c9)](exports,'__esModule',{'value':!![]}),exports[a62_0x526a00(0x1d8)]=void 0x0;const loggerService_1=require('../loggerService');function a62_0x2169(){const _0x3f2d0a=['2300172jeDAZo','Full\x20URL\x20(without\x20API\x20key):','PLISIO_API_KEY','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','qr_code','Transaction\x20ID:','URL:','/invoices/new','logWhiteDomainRequest','https://api.plisio.net/api/v1/invoices/new','map','invoice_total_sum','apiKey','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Target\x20Currency:','replace','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','text','16eIvsIu','373023HSCcuN','240756gaeSOj','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Payment\x20System/1.0','\x20is\x20invalid:\x20','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Failed\x20to\x20parse\x20JSON\x20response:','warn','currency','parse','Unknown\x20error\x20from\x20Plisio\x20API','apiUrl','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','processWebhook','Response\x20data:','entries','Raw\x20Response\x20Body:','Plisio\x20API\x20key\x20is\x20not\x20configured','GET','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','success','HTTP\x20','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','30466omHKsH','name','completed','toLowerCase','defineProperty','loggerService','env','Error\x20message:','fromEntries','FAILED','https://api.plisio.net/api/v1/operations/','1319220CXIkmC','source_currency','HTTP\x20error!\x20status:\x20','Processing\x20Plisio\x20webhook:','toString','plisio_direct','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','üîó\x20Formatted\x20URL:\x20','PlisioService','4889082DYNdtn','isArray','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Response\x20Time:','qr_url','Parameters:','data','logWhiteDomainResponse','Failed\x20to\x20create\x20Plisio\x20payment:\x20','HIDDEN','json','30wJqhVO','message','https://api.trapay.uk/api/webhooks/gateway/plisio','append','Parsed\x20Result:','JSON\x20Parse\x20Error:\x20','Error\x20details:','(crypto\x20for\x20payment)','string','Error\x20stack:','Plisio\x20API\x20error:\x20','PENDING','txn_id','\x20->\x20','amount','Source\x20Currency:','pending','source_amount','application/json','29ZPQDUd','status','cancelled','Error\x20Message:','Raw\x20tx_urls\x20data:','\x20is\x20valid:\x20','334200brqFHj','error','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','log','now','verifyPayment','order_number','logWhiteDomainError','‚úÖ\x20URL\x20','HTTP\x20Status:','invoice_url','Unknown\x20error','Invoice\x20URL:','PAID','tx_urls','===\x20PLISIO\x20SUCCESS\x20===','stack','Amount:','/operations/','createPayment','95ZDRJrZ','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','mismatch'];a62_0x2169=function(){return _0x3f2d0a;};return a62_0x2169();}class PlisioService{constructor(){const _0x17a0a0=a62_0x526a00;this[_0x17a0a0(0x1b9)]=_0x17a0a0(0x1a4),this[_0x17a0a0(0x1a7)]=process[_0x17a0a0(0x1cb)][_0x17a0a0(0x19c)]||'',!this[_0x17a0a0(0x1a7)]?console[_0x17a0a0(0x1b5)](_0x17a0a0(0x1b3)):console[_0x17a0a0(0x186)](_0x17a0a0(0x1c1));}async[a62_0x526a00(0x196)](_0x26acc8){const _0x512e8b=a62_0x526a00,{orderId:_0x4749eb,amount:_0x5cf880,currency:_0x36a761,productName:_0x2a2027,description:_0x3c9570,successUrl:_0x108536,failUrl:_0x2f6976,customerEmail:_0x12259c,customerName:_0x4d321c,isSourceCurrency:_0x347883,sourceCurrency:_0x693e99}=_0x26acc8;if(!this['apiKey'])throw new Error(_0x512e8b(0x1bf));const _0x2c453a=new URLSearchParams({'api_key':this[_0x512e8b(0x1a7)],'order_number':_0x4749eb,'order_name':_0x2a2027,'description':_0x3c9570,'success_url':_0x108536,'fail_url':_0x2f6976,'callback_url':_0x512e8b(0x16c)});_0x693e99?(_0x2c453a[_0x512e8b(0x16d)](_0x512e8b(0x1b6),_0x693e99),_0x2c453a[_0x512e8b(0x16d)](_0x512e8b(0x1d1),_0x36a761),_0x2c453a[_0x512e8b(0x16d)](_0x512e8b(0x17b),_0x5cf880[_0x512e8b(0x1d4)]())):(_0x2c453a['append'](_0x512e8b(0x1b6),_0x36a761),_0x2c453a[_0x512e8b(0x16d)](_0x512e8b(0x178),_0x5cf880[_0x512e8b(0x1d4)]()));_0x12259c&&_0x2c453a['append']('email',_0x12259c);_0x4d321c&&_0x2c453a[_0x512e8b(0x16d)](_0x512e8b(0x1c6),_0x4d321c);const _0x3dde57=this['apiUrl']+'?'+_0x2c453a['toString'](),_0x5748ce=Date[_0x512e8b(0x187)]();try{console[_0x512e8b(0x186)](_0x512e8b(0x1c4)),console[_0x512e8b(0x186)](_0x512e8b(0x1a1),this[_0x512e8b(0x1b9)]),console[_0x512e8b(0x186)](_0x512e8b(0x1de),Object[_0x512e8b(0x1cd)](_0x2c453a[_0x512e8b(0x1bd)]())),console['log'](_0x512e8b(0x19b),_0x3dde57[_0x512e8b(0x1aa)](this[_0x512e8b(0x1a7)],_0x512e8b(0x1e2))),loggerService_1[_0x512e8b(0x1ca)][_0x512e8b(0x1a3)](_0x512e8b(0x1d5),'/invoices/new','GET',Object['fromEntries'](_0x2c453a['entries']()));const _0x23a062=await fetch(_0x3dde57,{'method':_0x512e8b(0x1c0),'headers':{'Accept':'application/json','User-Agent':_0x512e8b(0x1b1)}}),_0x1f2014=Date[_0x512e8b(0x187)]()-_0x5748ce;console[_0x512e8b(0x186)](_0x512e8b(0x19e)),console[_0x512e8b(0x186)]('Status:',_0x23a062[_0x512e8b(0x17e)]),console[_0x512e8b(0x186)]('Status\x20Text:',_0x23a062['statusText']),console[_0x512e8b(0x186)](_0x512e8b(0x1dc),_0x1f2014+'ms');const _0x22a09f=await _0x23a062[_0x512e8b(0x1ac)]();console[_0x512e8b(0x186)](_0x512e8b(0x1be),_0x22a09f);if(!_0x23a062['ok']){console[_0x512e8b(0x184)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x512e8b(0x184)](_0x512e8b(0x18c),_0x23a062[_0x512e8b(0x17e)]),console[_0x512e8b(0x184)]('Response\x20Body:',_0x22a09f),loggerService_1['loggerService'][_0x512e8b(0x1e0)](_0x512e8b(0x1d5),_0x512e8b(0x1a2),_0x23a062[_0x512e8b(0x17e)],_0x22a09f,_0x1f2014),loggerService_1[_0x512e8b(0x1ca)][_0x512e8b(0x18a)](_0x512e8b(0x1d5),_0x512e8b(0x1a2),_0x512e8b(0x1c3)+_0x23a062[_0x512e8b(0x17e)]+':\x20'+_0x22a09f);throw new Error(_0x512e8b(0x1d2)+_0x23a062[_0x512e8b(0x17e)]+',\x20body:\x20'+_0x22a09f);}let _0x4b0c94;try{_0x4b0c94=JSON[_0x512e8b(0x1b7)](_0x22a09f);}catch(_0x4ed57b){console[_0x512e8b(0x184)](_0x512e8b(0x1b4),_0x4ed57b),loggerService_1[_0x512e8b(0x1ca)][_0x512e8b(0x18a)](_0x512e8b(0x1d5),_0x512e8b(0x1a2),_0x512e8b(0x16f)+_0x4ed57b);throw new Error(_0x512e8b(0x1ab)+_0x22a09f);}console[_0x512e8b(0x186)](_0x512e8b(0x1db)),console[_0x512e8b(0x186)](_0x512e8b(0x16e),JSON['stringify'](_0x4b0c94,null,0x2)),loggerService_1['loggerService'][_0x512e8b(0x1e0)](_0x512e8b(0x1d5),'/invoices/new',_0x23a062[_0x512e8b(0x17e)],_0x4b0c94,_0x1f2014);if(_0x4b0c94[_0x512e8b(0x17e)]!=='success'){const _0x5923e9=_0x4b0c94[_0x512e8b(0x16b)]||_0x4b0c94['error']||_0x512e8b(0x1b8);console[_0x512e8b(0x184)](_0x512e8b(0x1b0)),console[_0x512e8b(0x184)](_0x512e8b(0x180),_0x5923e9),loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct',_0x512e8b(0x1a2),'Business\x20Error:\x20'+_0x5923e9);throw new Error(_0x512e8b(0x174)+_0x5923e9);}if(!_0x4b0c94['data']?.['txn_id']||!_0x4b0c94[_0x512e8b(0x1df)]?.[_0x512e8b(0x18d)]){console[_0x512e8b(0x184)](_0x512e8b(0x1ba)),console[_0x512e8b(0x184)](_0x512e8b(0x185)),console[_0x512e8b(0x184)](_0x512e8b(0x1bc),_0x4b0c94[_0x512e8b(0x1df)]),loggerService_1[_0x512e8b(0x1ca)]['logWhiteDomainError'](_0x512e8b(0x1d5),_0x512e8b(0x1a2),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x512e8b(0x1d6));}return console['log'](_0x512e8b(0x192)),console[_0x512e8b(0x186)](_0x512e8b(0x1a0),_0x4b0c94[_0x512e8b(0x1df)]['txn_id']),console[_0x512e8b(0x186)](_0x512e8b(0x18f),_0x4b0c94[_0x512e8b(0x1df)][_0x512e8b(0x18d)]),console[_0x512e8b(0x186)](_0x512e8b(0x194),_0x5cf880,_0x36a761),_0x693e99&&(console[_0x512e8b(0x186)](_0x512e8b(0x179),_0x693e99,_0x512e8b(0x171)),console['log'](_0x512e8b(0x1a9),_0x36a761,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x4b0c94[_0x512e8b(0x1df)][_0x512e8b(0x176)],'payment_url':_0x4b0c94['data'][_0x512e8b(0x18d)],'invoice_total_sum':_0x4b0c94['data'][_0x512e8b(0x1a6)],'qr_code':_0x4b0c94[_0x512e8b(0x1df)][_0x512e8b(0x19f)],'qr_url':_0x4b0c94[_0x512e8b(0x1df)][_0x512e8b(0x1dd)]};}catch(_0x3a1bf8){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x512e8b(0x184)](_0x512e8b(0x170),_0x3a1bf8),loggerService_1[_0x512e8b(0x1ca)][_0x512e8b(0x18a)]('plisio_direct',_0x512e8b(0x1a2),_0x3a1bf8);if(_0x3a1bf8 instanceof Error){console[_0x512e8b(0x184)](_0x512e8b(0x1cc),_0x3a1bf8['message']),console[_0x512e8b(0x184)](_0x512e8b(0x173),_0x3a1bf8[_0x512e8b(0x193)]);throw new Error(_0x512e8b(0x1e1)+_0x3a1bf8[_0x512e8b(0x16b)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a62_0x526a00(0x188)](_0x473ae7){const _0x19064e=a62_0x526a00,_0x4dab79=Date[_0x19064e(0x187)]();try{if(!this[_0x19064e(0x1a7)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x27166a=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x473ae7}),_0x228619=_0x19064e(0x1cf)+_0x473ae7+'?'+_0x27166a[_0x19064e(0x1d4)]();loggerService_1[_0x19064e(0x1ca)][_0x19064e(0x1a3)](_0x19064e(0x1d5),_0x19064e(0x195)+_0x473ae7,_0x19064e(0x1c0),Object[_0x19064e(0x1cd)](_0x27166a[_0x19064e(0x1bd)]()));const _0x27f08e=await fetch(_0x228619,{'method':'GET','headers':{'Accept':_0x19064e(0x17c),'User-Agent':_0x19064e(0x1b1)}}),_0x2bd284=Date['now']()-_0x4dab79;if(!_0x27f08e['ok']){const _0x56bdd3=await _0x27f08e[_0x19064e(0x1ac)]();loggerService_1[_0x19064e(0x1ca)][_0x19064e(0x1e0)](_0x19064e(0x1d5),_0x19064e(0x195)+_0x473ae7,_0x27f08e[_0x19064e(0x17e)],_0x56bdd3,_0x2bd284);throw new Error(_0x19064e(0x1d2)+_0x27f08e[_0x19064e(0x17e)]);}const _0x8b20e2=await _0x27f08e[_0x19064e(0x1e3)]();loggerService_1[_0x19064e(0x1ca)][_0x19064e(0x1e0)](_0x19064e(0x1d5),_0x19064e(0x195)+_0x473ae7,_0x27f08e[_0x19064e(0x17e)],_0x8b20e2,_0x2bd284);if(_0x8b20e2[_0x19064e(0x17e)]!==_0x19064e(0x1c2)){loggerService_1[_0x19064e(0x1ca)][_0x19064e(0x18a)](_0x19064e(0x1d5),_0x19064e(0x195)+_0x473ae7,_0x19064e(0x174)+(_0x8b20e2[_0x19064e(0x16b)]||_0x8b20e2[_0x19064e(0x184)]||'Unknown\x20error'));throw new Error(_0x19064e(0x174)+(_0x8b20e2[_0x19064e(0x16b)]||_0x8b20e2[_0x19064e(0x184)]||'Unknown\x20error'));}let _0x2dd5ed='PENDING';return{'status':_0x2dd5ed};}catch(_0x57a130){console[_0x19064e(0x184)]('Plisio\x20payment\x20verification\x20error:',_0x57a130),loggerService_1[_0x19064e(0x1ca)]['logWhiteDomainError'](_0x19064e(0x1d5),_0x19064e(0x195)+_0x473ae7,_0x57a130);throw new Error(_0x19064e(0x1a8)+(_0x57a130 instanceof Error?_0x57a130[_0x19064e(0x16b)]:_0x19064e(0x18e)));}}async[a62_0x526a00(0x1bb)](_0x4e91ab){const _0x2aa851=a62_0x526a00;console['log'](_0x2aa851(0x1d3),_0x4e91ab);let _0x9e4c5f=_0x2aa851(0x175);switch(_0x4e91ab['status']?.[_0x2aa851(0x1c8)]()){case _0x2aa851(0x1c7):case _0x2aa851(0x199):_0x9e4c5f=_0x2aa851(0x190);break;case'expired':_0x9e4c5f='EXPIRED';break;case'error':case _0x2aa851(0x17f):_0x9e4c5f=_0x2aa851(0x1ce);break;case'new':_0x9e4c5f='PENDING';break;case _0x2aa851(0x17a):_0x9e4c5f='PROCESSING';break;default:_0x9e4c5f=_0x2aa851(0x175);break;}let _0x286e3e;if(_0x4e91ab['tx_urls'])try{console['log'](_0x2aa851(0x19d),_0x4e91ab[_0x2aa851(0x191)]);let _0x3af638;if(typeof _0x4e91ab['tx_urls']===_0x2aa851(0x172))_0x3af638=JSON[_0x2aa851(0x1b7)](_0x4e91ab['tx_urls']);else Array[_0x2aa851(0x1da)](_0x4e91ab['tx_urls'])?_0x3af638=_0x4e91ab[_0x2aa851(0x191)]:_0x3af638=[];_0x286e3e=_0x3af638[_0x2aa851(0x1a5)](_0x23a55f=>{const _0x1250f3=_0x2aa851,_0x3c2deb=_0x23a55f[_0x1250f3(0x1aa)](/\\/g,'');return console[_0x1250f3(0x186)](_0x1250f3(0x1d7)+_0x23a55f+_0x1250f3(0x177)+_0x3c2deb),_0x3c2deb;}),console[_0x2aa851(0x186)]('‚úÖ\x20Processed\x20tx_urls:',_0x286e3e),_0x286e3e['forEach']((_0x1a273f,_0x5d4491)=>{const _0x38680f=_0x2aa851;try{new URL(_0x1a273f),console[_0x38680f(0x186)](_0x38680f(0x18b)+(_0x5d4491+0x1)+_0x38680f(0x182)+_0x1a273f);}catch(_0x1464b2){console[_0x38680f(0x184)]('‚ùå\x20URL\x20'+(_0x5d4491+0x1)+_0x38680f(0x1b2)+_0x1a273f,_0x1464b2);}});}catch(_0x536830){console[_0x2aa851(0x184)](_0x2aa851(0x198),_0x536830),console['error'](_0x2aa851(0x181),_0x4e91ab[_0x2aa851(0x191)]),_0x286e3e=undefined;}return{'paymentId':_0x4e91ab[_0x2aa851(0x189)]||'','status':_0x9e4c5f,'amount':_0x4e91ab[_0x2aa851(0x178)],'currency':_0x4e91ab['currency'],'txUrls':_0x286e3e};}}exports[a62_0x526a00(0x1d8)]=PlisioService;