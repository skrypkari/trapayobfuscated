'use strict';const a47_0x28f737=a47_0x5484;(function(_0x44f32f,_0x57a149){const _0x1cfe82=a47_0x5484,_0xd99197=_0x44f32f();while(!![]){try{const _0x27e2d1=-parseInt(_0x1cfe82(0x21a))/0x1*(-parseInt(_0x1cfe82(0x22c))/0x2)+-parseInt(_0x1cfe82(0x1df))/0x3+parseInt(_0x1cfe82(0x20c))/0x4+-parseInt(_0x1cfe82(0x1f1))/0x5*(-parseInt(_0x1cfe82(0x208))/0x6)+-parseInt(_0x1cfe82(0x1ff))/0x7+-parseInt(_0x1cfe82(0x216))/0x8+parseInt(_0x1cfe82(0x1fd))/0x9*(-parseInt(_0x1cfe82(0x1ee))/0xa);if(_0x27e2d1===_0x57a149)break;else _0xd99197['push'](_0xd99197['shift']());}catch(_0x4252dd){_0xd99197['push'](_0xd99197['shift']());}}}(a47_0x21fb,0x5a434));function a47_0x21fb(){const _0x39c420=['HIDDEN','PlisioService','Full\x20URL\x20(without\x20API\x20key):','logWhiteDomainResponse','https://api.plisio.net/api/v1/invoices/new','stringify','map','invoice_total_sum','2729128gnCgva','Parameters:','EXPIRED','HTTP\x20','1lkYwJk','\x20is\x20valid:\x20','Parsed\x20Result:','Error\x20stack:','‚úÖ\x20Processed\x20tx_urls:','Error\x20Message:','‚ùå\x20URL\x20','apiKey','Plisio\x20API\x20error:\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','expired','append','https://api.trapay.uk/api/webhooks/gateway/plisio','===\x20PLISIO\x20SUCCESS\x20===','(crypto\x20for\x20payment)','GET','pending','1277670bUelSy','tx_urls','Business\x20Error:\x20','HTTP\x20error!\x20status:\x20','txn_id','/invoices/new','statusText','status','success','Invoice\x20URL:','../loggerService','message','now','log','\x20->\x20','Failed\x20to\x20parse\x20JSON\x20response:','fromEntries','createPayment',',\x20body:\x20','‚úÖ\x20URL\x20','URL:','string','Raw\x20tx_urls\x20data:','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error\x20from\x20Plisio\x20API','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','__esModule','Source\x20Currency:','Plisio\x20payment\x20verification\x20error:','loggerService','===\x20PLISIO\x20API\x20ERROR\x20===','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','toLowerCase','Failed\x20to\x20create\x20Plisio\x20payment:\x20','plisio_direct','source_currency','cancelled','Raw\x20Response\x20Body:','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Transaction\x20ID:','application/json','JSON\x20Parse\x20Error:\x20','739029YqjsYL','\x20is\x20invalid:\x20','order_number','logWhiteDomainError','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Target\x20Currency:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Unknown\x20error','forEach','data','Error\x20details:','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','source_amount','error','Status\x20Text:','1500AWixRv','currency','/operations/','5XkKudd','PENDING','Status:','FAILED','parse','completed','TesSoft\x20Payment\x20System/1.0','Amount:','email','entries','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Processing\x20Plisio\x20webhook:','2817Axrwrx','toString','3210725ldOISL','invoice_url','qr_url','stack','apiUrl','Response\x20data:','text','isArray','mismatch','4279542prOpAq','Error\x20message:','logWhiteDomainRequest','replace','442932tVpaXj','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='];a47_0x21fb=function(){return _0x39c420;};return a47_0x21fb();}Object['defineProperty'](exports,a47_0x28f737(0x1cf),{'value':!![]}),exports[a47_0x28f737(0x20f)]=void 0x0;const loggerService_1=require(a47_0x28f737(0x236));class PlisioService{constructor(){const _0x1db036=a47_0x28f737;this[_0x1db036(0x203)]=_0x1db036(0x212),this[_0x1db036(0x221)]=process['env']['PLISIO_API_KEY']||'',!this['apiKey']?console['warn']('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console['log'](_0x1db036(0x243));}async[a47_0x28f737(0x23d)](_0x5120bc){const _0xffaee6=a47_0x28f737,{orderId:_0x10760b,amount:_0xcdbe1d,currency:_0x529c04,productName:_0x3db35d,description:_0x1af961,successUrl:_0x3ec4c8,failUrl:_0x5b5689,customerEmail:_0x10cb75,customerName:_0x627b5,isSourceCurrency:_0x356d4f,sourceCurrency:_0x3fdac5}=_0x5120bc;if(!this['apiKey'])throw new Error(_0xffaee6(0x223));const _0x43e71a=new URLSearchParams({'api_key':this[_0xffaee6(0x221)],'order_number':_0x10760b,'order_name':_0x3db35d,'description':_0x1af961,'success_url':_0x3ec4c8,'fail_url':_0x5b5689,'callback_url':_0xffaee6(0x227)});_0x3fdac5?(_0x43e71a['append']('currency',_0x3fdac5),_0x43e71a[_0xffaee6(0x226)](_0xffaee6(0x1d8),_0x529c04),_0x43e71a[_0xffaee6(0x226)](_0xffaee6(0x1eb),_0xcdbe1d['toString']())):(_0x43e71a[_0xffaee6(0x226)](_0xffaee6(0x1ef),_0x529c04),_0x43e71a['append']('amount',_0xcdbe1d[_0xffaee6(0x1fe)]()));_0x10cb75&&_0x43e71a[_0xffaee6(0x226)](_0xffaee6(0x1f9),_0x10cb75);_0x627b5&&_0x43e71a[_0xffaee6(0x226)]('name',_0x627b5);const _0x24ad1e=this['apiUrl']+'?'+_0x43e71a[_0xffaee6(0x1fe)](),_0x3d1db7=Date['now']();try{console[_0xffaee6(0x239)](_0xffaee6(0x1e5)),console[_0xffaee6(0x239)](_0xffaee6(0x240),this[_0xffaee6(0x203)]),console[_0xffaee6(0x239)](_0xffaee6(0x217),Object[_0xffaee6(0x23c)](_0x43e71a['entries']())),console[_0xffaee6(0x239)](_0xffaee6(0x210),_0x24ad1e[_0xffaee6(0x20b)](this[_0xffaee6(0x221)],_0xffaee6(0x20e))),loggerService_1[_0xffaee6(0x1d2)][_0xffaee6(0x20a)](_0xffaee6(0x1d7),'/invoices/new',_0xffaee6(0x22a),Object['fromEntries'](_0x43e71a[_0xffaee6(0x1fa)]()));const _0x2c80cd=await fetch(_0x24ad1e,{'method':_0xffaee6(0x22a),'headers':{'Accept':_0xffaee6(0x1dd),'User-Agent':_0xffaee6(0x1f7)}}),_0x67f10b=Date[_0xffaee6(0x238)]()-_0x3d1db7;console[_0xffaee6(0x239)](_0xffaee6(0x1d4)),console[_0xffaee6(0x239)](_0xffaee6(0x1f3),_0x2c80cd[_0xffaee6(0x233)]),console[_0xffaee6(0x239)](_0xffaee6(0x1ed),_0x2c80cd[_0xffaee6(0x232)]),console[_0xffaee6(0x239)]('Response\x20Time:',_0x67f10b+'ms');const _0x4f5062=await _0x2c80cd['text']();console[_0xffaee6(0x239)](_0xffaee6(0x1da),_0x4f5062);if(!_0x2c80cd['ok']){console['error'](_0xffaee6(0x1d3)),console['error']('HTTP\x20Status:',_0x2c80cd[_0xffaee6(0x233)]),console[_0xffaee6(0x1ec)]('Response\x20Body:',_0x4f5062),loggerService_1[_0xffaee6(0x1d2)][_0xffaee6(0x211)](_0xffaee6(0x1d7),_0xffaee6(0x231),_0x2c80cd[_0xffaee6(0x233)],_0x4f5062,_0x67f10b),loggerService_1[_0xffaee6(0x1d2)][_0xffaee6(0x1e2)](_0xffaee6(0x1d7),_0xffaee6(0x231),_0xffaee6(0x219)+_0x2c80cd[_0xffaee6(0x233)]+':\x20'+_0x4f5062);throw new Error(_0xffaee6(0x22f)+_0x2c80cd['status']+_0xffaee6(0x23e)+_0x4f5062);}let _0x264551;try{_0x264551=JSON[_0xffaee6(0x1f5)](_0x4f5062);}catch(_0x48f596){console[_0xffaee6(0x1ec)](_0xffaee6(0x23b),_0x48f596),loggerService_1[_0xffaee6(0x1d2)][_0xffaee6(0x1e2)](_0xffaee6(0x1d7),_0xffaee6(0x231),_0xffaee6(0x1de)+_0x48f596);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x4f5062);}console[_0xffaee6(0x239)](_0xffaee6(0x1e3)),console[_0xffaee6(0x239)](_0xffaee6(0x21c),JSON[_0xffaee6(0x213)](_0x264551,null,0x2)),loggerService_1[_0xffaee6(0x1d2)][_0xffaee6(0x211)](_0xffaee6(0x1d7),_0xffaee6(0x231),_0x2c80cd[_0xffaee6(0x233)],_0x264551,_0x67f10b);if(_0x264551['status']!==_0xffaee6(0x234)){const _0x1a511c=_0x264551[_0xffaee6(0x237)]||_0x264551[_0xffaee6(0x1ec)]||_0xffaee6(0x245);console[_0xffaee6(0x1ec)](_0xffaee6(0x20d)),console[_0xffaee6(0x1ec)](_0xffaee6(0x21f),_0x1a511c),loggerService_1[_0xffaee6(0x1d2)][_0xffaee6(0x1e2)](_0xffaee6(0x1d7),_0xffaee6(0x231),_0xffaee6(0x22e)+_0x1a511c);throw new Error('Plisio\x20API\x20error:\x20'+_0x1a511c);}if(!_0x264551[_0xffaee6(0x1e8)]?.[_0xffaee6(0x230)]||!_0x264551[_0xffaee6(0x1e8)]?.[_0xffaee6(0x200)]){console['error'](_0xffaee6(0x244)),console[_0xffaee6(0x1ec)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0xffaee6(0x1ec)](_0xffaee6(0x204),_0x264551[_0xffaee6(0x1e8)]),loggerService_1[_0xffaee6(0x1d2)][_0xffaee6(0x1e2)](_0xffaee6(0x1d7),_0xffaee6(0x231),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0xffaee6(0x1fb));}return console[_0xffaee6(0x239)](_0xffaee6(0x228)),console['log'](_0xffaee6(0x1dc),_0x264551[_0xffaee6(0x1e8)][_0xffaee6(0x230)]),console[_0xffaee6(0x239)](_0xffaee6(0x235),_0x264551[_0xffaee6(0x1e8)]['invoice_url']),console[_0xffaee6(0x239)](_0xffaee6(0x1f8),_0xcdbe1d,_0x529c04),_0x3fdac5&&(console[_0xffaee6(0x239)](_0xffaee6(0x1d0),_0x3fdac5,_0xffaee6(0x229)),console['log'](_0xffaee6(0x1e4),_0x529c04,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x264551['data']['txn_id'],'payment_url':_0x264551[_0xffaee6(0x1e8)][_0xffaee6(0x200)],'invoice_total_sum':_0x264551[_0xffaee6(0x1e8)][_0xffaee6(0x215)],'qr_code':_0x264551[_0xffaee6(0x1e8)]['qr_code'],'qr_url':_0x264551['data'][_0xffaee6(0x201)]};}catch(_0x4737e5){console[_0xffaee6(0x1ec)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0xffaee6(0x1ec)](_0xffaee6(0x1e9),_0x4737e5),loggerService_1['loggerService'][_0xffaee6(0x1e2)](_0xffaee6(0x1d7),'/invoices/new',_0x4737e5);if(_0x4737e5 instanceof Error){console[_0xffaee6(0x1ec)](_0xffaee6(0x209),_0x4737e5[_0xffaee6(0x237)]),console['error'](_0xffaee6(0x21d),_0x4737e5[_0xffaee6(0x202)]);throw new Error(_0xffaee6(0x1d6)+_0x4737e5[_0xffaee6(0x237)]);}throw new Error(_0xffaee6(0x224));}}async['verifyPayment'](_0x28cdee){const _0x3808f3=a47_0x28f737,_0x1ff36e=Date[_0x3808f3(0x238)]();try{if(!this[_0x3808f3(0x221)])throw new Error(_0x3808f3(0x223));const _0xfe8c95=new URLSearchParams({'api_key':this[_0x3808f3(0x221)],'txn_id':_0x28cdee}),_0x514324='https://api.plisio.net/api/v1/operations/'+_0x28cdee+'?'+_0xfe8c95[_0x3808f3(0x1fe)]();loggerService_1['loggerService'][_0x3808f3(0x20a)](_0x3808f3(0x1d7),_0x3808f3(0x1f0)+_0x28cdee,'GET',Object[_0x3808f3(0x23c)](_0xfe8c95['entries']()));const _0x59216d=await fetch(_0x514324,{'method':'GET','headers':{'Accept':_0x3808f3(0x1dd),'User-Agent':_0x3808f3(0x1f7)}}),_0x41f866=Date['now']()-_0x1ff36e;if(!_0x59216d['ok']){const _0x455277=await _0x59216d[_0x3808f3(0x205)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3808f3(0x1d7),_0x3808f3(0x1f0)+_0x28cdee,_0x59216d[_0x3808f3(0x233)],_0x455277,_0x41f866);throw new Error(_0x3808f3(0x22f)+_0x59216d[_0x3808f3(0x233)]);}const _0x16ac87=await _0x59216d['json']();loggerService_1['loggerService'][_0x3808f3(0x211)]('plisio_direct',_0x3808f3(0x1f0)+_0x28cdee,_0x59216d[_0x3808f3(0x233)],_0x16ac87,_0x41f866);if(_0x16ac87[_0x3808f3(0x233)]!==_0x3808f3(0x234)){loggerService_1[_0x3808f3(0x1d2)][_0x3808f3(0x1e2)]('plisio_direct',_0x3808f3(0x1f0)+_0x28cdee,_0x3808f3(0x222)+(_0x16ac87['message']||_0x16ac87[_0x3808f3(0x1ec)]||_0x3808f3(0x1e6)));throw new Error(_0x3808f3(0x222)+(_0x16ac87[_0x3808f3(0x237)]||_0x16ac87[_0x3808f3(0x1ec)]||'Unknown\x20error'));}let _0x15c643=_0x3808f3(0x1f2);return{'status':_0x15c643};}catch(_0x43de61){console[_0x3808f3(0x1ec)](_0x3808f3(0x1d1),_0x43de61),loggerService_1[_0x3808f3(0x1d2)][_0x3808f3(0x1e2)]('plisio_direct','/operations/'+_0x28cdee,_0x43de61);throw new Error(_0x3808f3(0x1ea)+(_0x43de61 instanceof Error?_0x43de61[_0x3808f3(0x237)]:_0x3808f3(0x1e6)));}}async['processWebhook'](_0x5370bb){const _0x17b3df=a47_0x28f737;console[_0x17b3df(0x239)](_0x17b3df(0x1fc),_0x5370bb);let _0x33aab6='PENDING';switch(_0x5370bb[_0x17b3df(0x233)]?.[_0x17b3df(0x1d5)]()){case _0x17b3df(0x1f6):case _0x17b3df(0x207):_0x33aab6='PAID';break;case _0x17b3df(0x225):_0x33aab6=_0x17b3df(0x218);break;case _0x17b3df(0x1ec):case _0x17b3df(0x1d9):_0x33aab6=_0x17b3df(0x1f4);break;case'new':_0x33aab6=_0x17b3df(0x1f2);break;case _0x17b3df(0x22b):_0x33aab6='PROCESSING';break;default:_0x33aab6=_0x17b3df(0x1f2);break;}let _0x41c800;if(_0x5370bb[_0x17b3df(0x22d)])try{console[_0x17b3df(0x239)](_0x17b3df(0x1db),_0x5370bb['tx_urls']);let _0x200681;if(typeof _0x5370bb[_0x17b3df(0x22d)]===_0x17b3df(0x241))_0x200681=JSON[_0x17b3df(0x1f5)](_0x5370bb[_0x17b3df(0x22d)]);else Array[_0x17b3df(0x206)](_0x5370bb[_0x17b3df(0x22d)])?_0x200681=_0x5370bb[_0x17b3df(0x22d)]:_0x200681=[];_0x41c800=_0x200681[_0x17b3df(0x214)](_0x520bc8=>{const _0x49fa14=_0x17b3df,_0xf1003f=_0x520bc8[_0x49fa14(0x20b)](/\\/g,'');return console[_0x49fa14(0x239)]('üîó\x20Formatted\x20URL:\x20'+_0x520bc8+_0x49fa14(0x23a)+_0xf1003f),_0xf1003f;}),console[_0x17b3df(0x239)](_0x17b3df(0x21e),_0x41c800),_0x41c800[_0x17b3df(0x1e7)]((_0x2db599,_0x3aa450)=>{const _0x17ff8f=_0x17b3df;try{new URL(_0x2db599),console['log'](_0x17ff8f(0x23f)+(_0x3aa450+0x1)+_0x17ff8f(0x21b)+_0x2db599);}catch(_0x3b3b06){console[_0x17ff8f(0x1ec)](_0x17ff8f(0x220)+(_0x3aa450+0x1)+_0x17ff8f(0x1e0)+_0x2db599,_0x3b3b06);}});}catch(_0x3eee0a){console[_0x17b3df(0x1ec)](_0x17b3df(0x246),_0x3eee0a),console['error'](_0x17b3df(0x242),_0x5370bb[_0x17b3df(0x22d)]),_0x41c800=undefined;}return{'paymentId':_0x5370bb[_0x17b3df(0x1e1)]||'','status':_0x33aab6,'amount':_0x5370bb['amount'],'currency':_0x5370bb[_0x17b3df(0x1ef)],'txUrls':_0x41c800};}}function a47_0x5484(_0x2c2eac,_0x2d3cce){const _0x21fbcb=a47_0x21fb();return a47_0x5484=function(_0x5484b8,_0xc7d93a){_0x5484b8=_0x5484b8-0x1cf;let _0x1c6d92=_0x21fbcb[_0x5484b8];return _0x1c6d92;},a47_0x5484(_0x2c2eac,_0x2d3cce);}exports['PlisioService']=PlisioService;