'use strict';const a44_0x4b7729=a44_0x3f08;(function(_0x12c1c3,_0x394f5d){const _0x5c5727=a44_0x3f08,_0x48d76a=_0x12c1c3();while(!![]){try{const _0x3f8158=-parseInt(_0x5c5727(0xda))/0x1*(-parseInt(_0x5c5727(0x115))/0x2)+parseInt(_0x5c5727(0xed))/0x3*(-parseInt(_0x5c5727(0xdf))/0x4)+-parseInt(_0x5c5727(0xd4))/0x5+parseInt(_0x5c5727(0x111))/0x6*(parseInt(_0x5c5727(0xaa))/0x7)+-parseInt(_0x5c5727(0x10d))/0x8*(parseInt(_0x5c5727(0xb5))/0x9)+parseInt(_0x5c5727(0x102))/0xa*(-parseInt(_0x5c5727(0xee))/0xb)+-parseInt(_0x5c5727(0xe8))/0xc*(-parseInt(_0x5c5727(0xd6))/0xd);if(_0x3f8158===_0x394f5d)break;else _0x48d76a['push'](_0x48d76a['shift']());}catch(_0x47cd9e){_0x48d76a['push'](_0x48d76a['shift']());}}}(a44_0x2844,0xb6f64));function a44_0x3f08(_0x239a8b,_0x2311a3){const _0x2844e8=a44_0x2844();return a44_0x3f08=function(_0x3f0870,_0x27bf67){_0x3f0870=_0x3f0870-0xa9;let _0x467fa1=_0x2844e8[_0x3f0870];return _0x467fa1;},a44_0x3f08(_0x239a8b,_0x2311a3);}function a44_0x2844(){const _0x111375=['toString','EXPIRED','currency','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','message','order_number','===\x20PLISIO\x20SUCCESS\x20===','loggerService','/operations/','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','parse','Raw\x20tx_urls\x20data:','logWhiteDomainResponse','(fiat\x20for\x20merchant)','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','string','forEach','‚ùå\x20URL\x20','Unknown\x20error','invoice_url','1508175zbUOEe','env','741EdRtMp','now','completed','Source\x20Currency:','703VTDJko','Error\x20stack:','qr_url','Unknown\x20error\x20from\x20Plisio\x20API','FAILED','2440CEGpto','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','Plisio\x20payment\x20verification\x20error:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','replace','Processing\x20Plisio\x20webhook:','Response\x20Body:','Plisio\x20API\x20key\x20is\x20not\x20configured','entries','646308FhJgYS','‚úÖ\x20URL\x20','json','txn_id','statusText','6462AkAJDE','44EiGJiK','isArray','Raw\x20Response\x20Body:','Parsed\x20Result:','source_amount','text','Parameters:','Plisio\x20API\x20error:\x20','append','data','warn','PENDING','apiKey','HTTP\x20error!\x20status:\x20','pending','Target\x20Currency:','===\x20PLISIO\x20API\x20ERROR\x20===','\x20is\x20valid:\x20','processWebhook','\x20->\x20','1537790vzCyxz','status','plisio_direct','Amount:','Error\x20message:','apiUrl','error','Response\x20Time:','GET','application/json','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','3700552VbRUeM','‚úÖ\x20Processed\x20tx_urls:','Error\x20details:','verifyPayment','14946Cpsnze','HTTP\x20','HIDDEN','(crypto\x20for\x20payment)','706ggWlsa','tx_urls','Failed\x20to\x20parse\x20JSON\x20response:','https://api.plisio.net/api/v1/operations/','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','log','Status\x20Text:','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Transaction\x20ID:','email','stack','URL:','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','cancelled','https://api.trapay.uk/api/webhooks/gateway/plisio','HTTP\x20Status:','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','map','/invoices/new','Error\x20Message:','üîó\x20Formatted\x20URL:\x20','350FprvDc','\x20is\x20invalid:\x20','Status:','mismatch','TesSoft\x20Payment\x20System/1.0','logWhiteDomainError','success','Response\x20data:','stringify','toLowerCase','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','9jLHxsi','fromEntries','JSON\x20Parse\x20Error:\x20',',\x20body:\x20','../loggerService','logWhiteDomainRequest','new','PlisioService','expired','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Business\x20Error:\x20'];a44_0x2844=function(){return _0x111375;};return a44_0x2844();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a44_0x4b7729(0xbc)]=void 0x0;const loggerService_1=require(a44_0x4b7729(0xb9));class PlisioService{constructor(){const _0x448a6e=a44_0x4b7729;this[_0x448a6e(0x107)]='https://api.plisio.net/api/v1/invoices/new',this['apiKey']=process[_0x448a6e(0xd5)]['PLISIO_API_KEY']||'',!this[_0x448a6e(0xfa)]?console[_0x448a6e(0xf8)](_0x448a6e(0x119)):console[_0x448a6e(0x11a)](_0x448a6e(0xc9));}async['createPayment'](_0x1fa7f3){const _0x9fedc8=a44_0x4b7729,{orderId:_0x6d2075,amount:_0x2e70f2,currency:_0x2aea77,productName:_0x37250e,description:_0x553958,successUrl:_0xb2a049,failUrl:_0x4fda63,customerEmail:_0x52f842,customerName:_0x49a90f,isSourceCurrency:_0x1c9f89,sourceCurrency:_0x1a3a7e}=_0x1fa7f3;if(!this[_0x9fedc8(0xfa)])throw new Error(_0x9fedc8(0xe6));const _0x169d43=new URLSearchParams({'api_key':this[_0x9fedc8(0xfa)],'order_number':_0x6d2075,'order_name':_0x37250e,'description':_0x553958,'success_url':_0xb2a049,'fail_url':_0x4fda63,'callback_url':_0x9fedc8(0x123)});_0x1a3a7e?(_0x169d43[_0x9fedc8(0xf6)](_0x9fedc8(0xc2),_0x1a3a7e),_0x169d43[_0x9fedc8(0xf6)]('source_currency',_0x2aea77),_0x169d43[_0x9fedc8(0xf6)](_0x9fedc8(0xf2),_0x2e70f2[_0x9fedc8(0xc0)]())):(_0x169d43[_0x9fedc8(0xf6)](_0x9fedc8(0xc2),_0x2aea77),_0x169d43['append']('amount',_0x2e70f2[_0x9fedc8(0xc0)]()));_0x52f842&&_0x169d43[_0x9fedc8(0xf6)](_0x9fedc8(0x11e),_0x52f842);_0x49a90f&&_0x169d43[_0x9fedc8(0xf6)]('name',_0x49a90f);const _0x28b0a6=this[_0x9fedc8(0x107)]+'?'+_0x169d43[_0x9fedc8(0xc0)](),_0x4b551a=Date[_0x9fedc8(0xd7)]();try{console[_0x9fedc8(0x11a)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x9fedc8(0x11a)](_0x9fedc8(0x120),this[_0x9fedc8(0x107)]),console[_0x9fedc8(0x11a)](_0x9fedc8(0xf4),Object['fromEntries'](_0x169d43['entries']())),console['log']('Full\x20URL\x20(without\x20API\x20key):',_0x28b0a6[_0x9fedc8(0xe3)](this['apiKey'],_0x9fedc8(0x113))),loggerService_1[_0x9fedc8(0xc7)][_0x9fedc8(0xba)](_0x9fedc8(0x104),_0x9fedc8(0x127),_0x9fedc8(0x10a),Object[_0x9fedc8(0xb6)](_0x169d43[_0x9fedc8(0xe7)]()));const _0x5de860=await fetch(_0x28b0a6,{'method':'GET','headers':{'Accept':_0x9fedc8(0x10b),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x152c83=Date[_0x9fedc8(0xd7)]()-_0x4b551a;console[_0x9fedc8(0x11a)](_0x9fedc8(0xb4)),console[_0x9fedc8(0x11a)](_0x9fedc8(0xac),_0x5de860[_0x9fedc8(0x103)]),console['log'](_0x9fedc8(0x11b),_0x5de860[_0x9fedc8(0xec)]),console[_0x9fedc8(0x11a)](_0x9fedc8(0x109),_0x152c83+'ms');const _0x22659b=await _0x5de860[_0x9fedc8(0xf3)]();console[_0x9fedc8(0x11a)](_0x9fedc8(0xf0),_0x22659b);if(!_0x5de860['ok']){console[_0x9fedc8(0x108)](_0x9fedc8(0xfe)),console[_0x9fedc8(0x108)](_0x9fedc8(0x124),_0x5de860[_0x9fedc8(0x103)]),console['error'](_0x9fedc8(0xe5),_0x22659b),loggerService_1[_0x9fedc8(0xc7)][_0x9fedc8(0xcc)](_0x9fedc8(0x104),'/invoices/new',_0x5de860[_0x9fedc8(0x103)],_0x22659b,_0x152c83),loggerService_1[_0x9fedc8(0xc7)][_0x9fedc8(0xaf)](_0x9fedc8(0x104),_0x9fedc8(0x127),_0x9fedc8(0x112)+_0x5de860[_0x9fedc8(0x103)]+':\x20'+_0x22659b);throw new Error(_0x9fedc8(0xfb)+_0x5de860['status']+_0x9fedc8(0xb8)+_0x22659b);}let _0x41c905;try{_0x41c905=JSON[_0x9fedc8(0xca)](_0x22659b);}catch(_0x2c2963){console[_0x9fedc8(0x108)](_0x9fedc8(0x117),_0x2c2963),loggerService_1['loggerService'][_0x9fedc8(0xaf)]('plisio_direct','/invoices/new',_0x9fedc8(0xb7)+_0x2c2963);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x22659b);}console[_0x9fedc8(0x11a)](_0x9fedc8(0x121)),console['log'](_0x9fedc8(0xf1),JSON[_0x9fedc8(0xb2)](_0x41c905,null,0x2)),loggerService_1[_0x9fedc8(0xc7)][_0x9fedc8(0xcc)]('plisio_direct','/invoices/new',_0x5de860[_0x9fedc8(0x103)],_0x41c905,_0x152c83);if(_0x41c905[_0x9fedc8(0x103)]!==_0x9fedc8(0xb0)){const _0x3d1d2f=_0x41c905[_0x9fedc8(0xc4)]||_0x41c905[_0x9fedc8(0x108)]||_0x9fedc8(0xdd);console[_0x9fedc8(0x108)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x9fedc8(0x108)](_0x9fedc8(0x128),_0x3d1d2f),loggerService_1[_0x9fedc8(0xc7)][_0x9fedc8(0xaf)](_0x9fedc8(0x104),_0x9fedc8(0x127),_0x9fedc8(0xbf)+_0x3d1d2f);throw new Error(_0x9fedc8(0xf5)+_0x3d1d2f);}if(!_0x41c905[_0x9fedc8(0xf7)]?.['txn_id']||!_0x41c905[_0x9fedc8(0xf7)]?.[_0x9fedc8(0xd3)]){console['error'](_0x9fedc8(0x125)),console['error'](_0x9fedc8(0xce)),console[_0x9fedc8(0x108)](_0x9fedc8(0xb1),_0x41c905[_0x9fedc8(0xf7)]),loggerService_1['loggerService'][_0x9fedc8(0xaf)](_0x9fedc8(0x104),_0x9fedc8(0x127),_0x9fedc8(0xe2));throw new Error(_0x9fedc8(0xc3));}return console[_0x9fedc8(0x11a)](_0x9fedc8(0xc6)),console[_0x9fedc8(0x11a)](_0x9fedc8(0x11d),_0x41c905[_0x9fedc8(0xf7)]['txn_id']),console[_0x9fedc8(0x11a)]('Invoice\x20URL:',_0x41c905['data'][_0x9fedc8(0xd3)]),console[_0x9fedc8(0x11a)](_0x9fedc8(0x105),_0x2e70f2,_0x2aea77),_0x1a3a7e&&(console[_0x9fedc8(0x11a)](_0x9fedc8(0xd9),_0x1a3a7e,_0x9fedc8(0x114)),console[_0x9fedc8(0x11a)](_0x9fedc8(0xfd),_0x2aea77,_0x9fedc8(0xcd))),{'gateway_payment_id':_0x41c905[_0x9fedc8(0xf7)][_0x9fedc8(0xeb)],'payment_url':_0x41c905['data'][_0x9fedc8(0xd3)],'invoice_total_sum':_0x41c905[_0x9fedc8(0xf7)]['invoice_total_sum'],'qr_code':_0x41c905[_0x9fedc8(0xf7)]['qr_code'],'qr_url':_0x41c905['data'][_0x9fedc8(0xdc)]};}catch(_0x5d9615){console['error'](_0x9fedc8(0x10c)),console[_0x9fedc8(0x108)](_0x9fedc8(0x10f),_0x5d9615),loggerService_1['loggerService'][_0x9fedc8(0xaf)]('plisio_direct',_0x9fedc8(0x127),_0x5d9615);if(_0x5d9615 instanceof Error){console['error'](_0x9fedc8(0x106),_0x5d9615[_0x9fedc8(0xc4)]),console['error'](_0x9fedc8(0xdb),_0x5d9615[_0x9fedc8(0x11f)]);throw new Error(_0x9fedc8(0xbe)+_0x5d9615[_0x9fedc8(0xc4)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a44_0x4b7729(0x110)](_0xcf9088){const _0x3d2a2d=a44_0x4b7729,_0x2dbbb8=Date['now']();try{if(!this['apiKey'])throw new Error(_0x3d2a2d(0xe6));const _0x442e39=new URLSearchParams({'api_key':this[_0x3d2a2d(0xfa)],'txn_id':_0xcf9088}),_0x45f1e0=_0x3d2a2d(0x118)+_0xcf9088+'?'+_0x442e39[_0x3d2a2d(0xc0)]();loggerService_1[_0x3d2a2d(0xc7)][_0x3d2a2d(0xba)](_0x3d2a2d(0x104),_0x3d2a2d(0xc8)+_0xcf9088,_0x3d2a2d(0x10a),Object['fromEntries'](_0x442e39['entries']()));const _0xe77336=await fetch(_0x45f1e0,{'method':_0x3d2a2d(0x10a),'headers':{'Accept':_0x3d2a2d(0x10b),'User-Agent':_0x3d2a2d(0xae)}}),_0x2b7122=Date['now']()-_0x2dbbb8;if(!_0xe77336['ok']){const _0xd95035=await _0xe77336[_0x3d2a2d(0xf3)]();loggerService_1['loggerService'][_0x3d2a2d(0xcc)](_0x3d2a2d(0x104),'/operations/'+_0xcf9088,_0xe77336[_0x3d2a2d(0x103)],_0xd95035,_0x2b7122);throw new Error(_0x3d2a2d(0xfb)+_0xe77336[_0x3d2a2d(0x103)]);}const _0x3a9f36=await _0xe77336[_0x3d2a2d(0xea)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3d2a2d(0x104),_0x3d2a2d(0xc8)+_0xcf9088,_0xe77336[_0x3d2a2d(0x103)],_0x3a9f36,_0x2b7122);if(_0x3a9f36[_0x3d2a2d(0x103)]!==_0x3d2a2d(0xb0)){loggerService_1['loggerService']['logWhiteDomainError'](_0x3d2a2d(0x104),'/operations/'+_0xcf9088,_0x3d2a2d(0xf5)+(_0x3a9f36[_0x3d2a2d(0xc4)]||_0x3a9f36['error']||_0x3d2a2d(0xd2)));throw new Error(_0x3d2a2d(0xf5)+(_0x3a9f36[_0x3d2a2d(0xc4)]||_0x3a9f36['error']||'Unknown\x20error'));}let _0x4e40dd='PENDING';return{'status':_0x4e40dd};}catch(_0x2b9680){console['error'](_0x3d2a2d(0xe1),_0x2b9680),loggerService_1['loggerService'][_0x3d2a2d(0xaf)](_0x3d2a2d(0x104),_0x3d2a2d(0xc8)+_0xcf9088,_0x2b9680);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x2b9680 instanceof Error?_0x2b9680['message']:_0x3d2a2d(0xd2)));}}async[a44_0x4b7729(0x100)](_0x2b6a94){const _0x179f4e=a44_0x4b7729;console[_0x179f4e(0x11a)](_0x179f4e(0xe4),_0x2b6a94);let _0x5a7320=_0x179f4e(0xf9);switch(_0x2b6a94[_0x179f4e(0x103)]?.[_0x179f4e(0xb3)]()){case _0x179f4e(0xd8):case _0x179f4e(0xad):_0x5a7320='PAID';break;case _0x179f4e(0xbd):_0x5a7320=_0x179f4e(0xc1);break;case'error':case _0x179f4e(0x122):_0x5a7320=_0x179f4e(0xde);break;case _0x179f4e(0xbb):_0x5a7320=_0x179f4e(0xf9);break;case _0x179f4e(0xfc):_0x5a7320='PROCESSING';break;default:_0x5a7320=_0x179f4e(0xf9);break;}let _0x4f50bd;if(_0x2b6a94[_0x179f4e(0x116)])try{console[_0x179f4e(0x11a)](_0x179f4e(0x11c),_0x2b6a94[_0x179f4e(0x116)]);let _0x38c38a;if(typeof _0x2b6a94['tx_urls']===_0x179f4e(0xcf))_0x38c38a=JSON['parse'](_0x2b6a94[_0x179f4e(0x116)]);else Array[_0x179f4e(0xef)](_0x2b6a94['tx_urls'])?_0x38c38a=_0x2b6a94[_0x179f4e(0x116)]:_0x38c38a=[];_0x4f50bd=_0x38c38a[_0x179f4e(0x126)](_0x10c1ca=>{const _0x3be0fd=_0x179f4e,_0x298794=_0x10c1ca[_0x3be0fd(0xe3)](/\\/g,'');return console[_0x3be0fd(0x11a)](_0x3be0fd(0xa9)+_0x10c1ca+_0x3be0fd(0x101)+_0x298794),_0x298794;}),console[_0x179f4e(0x11a)](_0x179f4e(0x10e),_0x4f50bd),_0x4f50bd[_0x179f4e(0xd0)]((_0x1cdf66,_0x1e014e)=>{const _0x2724eb=_0x179f4e;try{new URL(_0x1cdf66),console['log'](_0x2724eb(0xe9)+(_0x1e014e+0x1)+_0x2724eb(0xff)+_0x1cdf66);}catch(_0x48ecce){console[_0x2724eb(0x108)](_0x2724eb(0xd1)+(_0x1e014e+0x1)+_0x2724eb(0xab)+_0x1cdf66,_0x48ecce);}});}catch(_0x489f8e){console[_0x179f4e(0x108)](_0x179f4e(0xe0),_0x489f8e),console['error'](_0x179f4e(0xcb),_0x2b6a94[_0x179f4e(0x116)]),_0x4f50bd=undefined;}return{'paymentId':_0x2b6a94[_0x179f4e(0xc5)]||'','status':_0x5a7320,'amount':_0x2b6a94['amount'],'currency':_0x2b6a94[_0x179f4e(0xc2)],'txUrls':_0x4f50bd};}}exports['PlisioService']=PlisioService;