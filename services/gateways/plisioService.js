'use strict';const a51_0x572d96=a51_0xb194;(function(_0x1f6b22,_0x33678c){const _0x485e1b=a51_0xb194,_0x45c9b2=_0x1f6b22();while(!![]){try{const _0x22d06a=parseInt(_0x485e1b(0x1e4))/0x1+parseInt(_0x485e1b(0x1bb))/0x2+-parseInt(_0x485e1b(0x1c2))/0x3+-parseInt(_0x485e1b(0x1dd))/0x4*(-parseInt(_0x485e1b(0x1e0))/0x5)+parseInt(_0x485e1b(0x1af))/0x6*(-parseInt(_0x485e1b(0x1d4))/0x7)+-parseInt(_0x485e1b(0x1aa))/0x8*(-parseInt(_0x485e1b(0x205))/0x9)+-parseInt(_0x485e1b(0x1ec))/0xa;if(_0x22d06a===_0x33678c)break;else _0x45c9b2['push'](_0x45c9b2['shift']());}catch(_0x3393c8){_0x45c9b2['push'](_0x45c9b2['shift']());}}}(a51_0x1d08,0xf11e0));function a51_0xb194(_0xe4407,_0x1e786c){const _0x1d08a1=a51_0x1d08();return a51_0xb194=function(_0xb19405,_0x3aa0ed){_0xb19405=_0xb19405-0x195;let _0x125579=_0x1d08a1[_0xb19405];return _0x125579;},a51_0xb194(_0xe4407,_0x1e786c);}Object[a51_0x572d96(0x1a1)](exports,'__esModule',{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a51_0x572d96(0x1b5));class PlisioService{constructor(){const _0x3f259b=a51_0x572d96;this[_0x3f259b(0x1c4)]=_0x3f259b(0x1a8),this[_0x3f259b(0x1a2)]=process[_0x3f259b(0x1bf)][_0x3f259b(0x1c5)]||'',!this[_0x3f259b(0x1a2)]?console[_0x3f259b(0x1a6)](_0x3f259b(0x19a)):console[_0x3f259b(0x1a0)](_0x3f259b(0x1c6));}async[a51_0x572d96(0x1e1)](_0x2676a6){const _0x227d7a=a51_0x572d96,{orderId:_0x2b1def,amount:_0x43cf68,currency:_0x3e6acf,productName:_0x144e25,description:_0x3d27c9,successUrl:_0x2e81bf,failUrl:_0x3d8e9f,customerEmail:_0x258076,customerName:_0x4a8296,isSourceCurrency:_0x52acb5,sourceCurrency:_0x310879}=_0x2676a6;if(!this[_0x227d7a(0x1a2)])throw new Error(_0x227d7a(0x1f8));const _0x605e6b=new URLSearchParams({'api_key':this[_0x227d7a(0x1a2)],'order_number':_0x2b1def,'order_name':_0x144e25,'description':_0x3d27c9,'success_url':_0x2e81bf,'fail_url':_0x3d8e9f,'callback_url':_0x227d7a(0x1f5)});_0x310879?(_0x605e6b[_0x227d7a(0x1e5)]('currency',_0x310879),_0x605e6b[_0x227d7a(0x1e5)]('source_currency',_0x3e6acf),_0x605e6b[_0x227d7a(0x1e5)](_0x227d7a(0x1b8),_0x43cf68[_0x227d7a(0x1c9)]())):(_0x605e6b[_0x227d7a(0x1e5)]('currency',_0x3e6acf),_0x605e6b[_0x227d7a(0x1e5)](_0x227d7a(0x1b0),_0x43cf68[_0x227d7a(0x1c9)]()));_0x258076&&_0x605e6b[_0x227d7a(0x1e5)](_0x227d7a(0x202),_0x258076);_0x4a8296&&_0x605e6b[_0x227d7a(0x1e5)](_0x227d7a(0x1fc),_0x4a8296);const _0x128f1c=this[_0x227d7a(0x1c4)]+'?'+_0x605e6b[_0x227d7a(0x1c9)](),_0x17ab6f=Date[_0x227d7a(0x198)]();try{console[_0x227d7a(0x1a0)](_0x227d7a(0x1b1)),console[_0x227d7a(0x1a0)](_0x227d7a(0x1ea),this['apiUrl']),console['log']('Parameters:',Object[_0x227d7a(0x1d2)](_0x605e6b[_0x227d7a(0x1e2)]())),console[_0x227d7a(0x1a0)](_0x227d7a(0x1ad),_0x128f1c['replace'](this[_0x227d7a(0x1a2)],_0x227d7a(0x19d))),loggerService_1[_0x227d7a(0x1c7)][_0x227d7a(0x19b)]('plisio_direct',_0x227d7a(0x1b4),_0x227d7a(0x1ee),Object[_0x227d7a(0x1d2)](_0x605e6b[_0x227d7a(0x1e2)]()));const _0x5d9af7=await fetch(_0x128f1c,{'method':_0x227d7a(0x1ee),'headers':{'Accept':_0x227d7a(0x1cf),'User-Agent':_0x227d7a(0x1d9)}}),_0x216106=Date[_0x227d7a(0x198)]()-_0x17ab6f;console['log'](_0x227d7a(0x1e8)),console[_0x227d7a(0x1a0)](_0x227d7a(0x1d6),_0x5d9af7[_0x227d7a(0x1ab)]),console[_0x227d7a(0x1a0)](_0x227d7a(0x197),_0x5d9af7['statusText']),console['log'](_0x227d7a(0x1e7),_0x216106+'ms');const _0x44e16b=await _0x5d9af7['text']();console[_0x227d7a(0x1a0)](_0x227d7a(0x1ce),_0x44e16b);if(!_0x5d9af7['ok']){console[_0x227d7a(0x1e9)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error'](_0x227d7a(0x1bc),_0x5d9af7[_0x227d7a(0x1ab)]),console['error'](_0x227d7a(0x1d3),_0x44e16b),loggerService_1[_0x227d7a(0x1c7)][_0x227d7a(0x1bd)]('plisio_direct',_0x227d7a(0x1b4),_0x5d9af7[_0x227d7a(0x1ab)],_0x44e16b,_0x216106),loggerService_1['loggerService']['logWhiteDomainError'](_0x227d7a(0x1ae),_0x227d7a(0x1b4),'HTTP\x20'+_0x5d9af7['status']+':\x20'+_0x44e16b);throw new Error(_0x227d7a(0x201)+_0x5d9af7['status']+',\x20body:\x20'+_0x44e16b);}let _0x5d77d5;try{_0x5d77d5=JSON[_0x227d7a(0x1d7)](_0x44e16b);}catch(_0x4e3b2c){console[_0x227d7a(0x1e9)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x4e3b2c),loggerService_1[_0x227d7a(0x1c7)]['logWhiteDomainError'](_0x227d7a(0x1ae),_0x227d7a(0x1b4),_0x227d7a(0x1f1)+_0x4e3b2c);throw new Error(_0x227d7a(0x1f2)+_0x44e16b);}console[_0x227d7a(0x1a0)](_0x227d7a(0x1e6)),console[_0x227d7a(0x1a0)](_0x227d7a(0x1b9),JSON[_0x227d7a(0x1dc)](_0x5d77d5,null,0x2)),loggerService_1[_0x227d7a(0x1c7)]['logWhiteDomainResponse']('plisio_direct',_0x227d7a(0x1b4),_0x5d9af7[_0x227d7a(0x1ab)],_0x5d77d5,_0x216106);if(_0x5d77d5[_0x227d7a(0x1ab)]!==_0x227d7a(0x1df)){const _0x56f719=_0x5d77d5[_0x227d7a(0x19f)]||_0x5d77d5[_0x227d7a(0x1e9)]||_0x227d7a(0x204);console[_0x227d7a(0x1e9)](_0x227d7a(0x1ca)),console['error']('Error\x20Message:',_0x56f719),loggerService_1[_0x227d7a(0x1c7)][_0x227d7a(0x199)](_0x227d7a(0x1ae),_0x227d7a(0x1b4),'Business\x20Error:\x20'+_0x56f719);throw new Error(_0x227d7a(0x1f0)+_0x56f719);}if(!_0x5d77d5[_0x227d7a(0x203)]?.['txn_id']||!_0x5d77d5[_0x227d7a(0x203)]?.[_0x227d7a(0x1b7)]){console[_0x227d7a(0x1e9)](_0x227d7a(0x1c3)),console[_0x227d7a(0x1e9)](_0x227d7a(0x1d1)),console[_0x227d7a(0x1e9)](_0x227d7a(0x1ef),_0x5d77d5[_0x227d7a(0x203)]),loggerService_1[_0x227d7a(0x1c7)][_0x227d7a(0x199)](_0x227d7a(0x1ae),_0x227d7a(0x1b4),_0x227d7a(0x1b2));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x227d7a(0x1a0)](_0x227d7a(0x1db)),console[_0x227d7a(0x1a0)](_0x227d7a(0x1d0),_0x5d77d5['data'][_0x227d7a(0x1a5)]),console[_0x227d7a(0x1a0)]('Invoice\x20URL:',_0x5d77d5[_0x227d7a(0x203)][_0x227d7a(0x1b7)]),console[_0x227d7a(0x1a0)](_0x227d7a(0x1ac),_0x43cf68,_0x3e6acf),_0x310879&&(console[_0x227d7a(0x1a0)]('Source\x20Currency:',_0x310879,'(crypto\x20for\x20payment)'),console[_0x227d7a(0x1a0)](_0x227d7a(0x1f3),_0x3e6acf,_0x227d7a(0x1c0))),{'gateway_payment_id':_0x5d77d5[_0x227d7a(0x203)]['txn_id'],'payment_url':_0x5d77d5['data']['invoice_url'],'invoice_total_sum':_0x5d77d5['data'][_0x227d7a(0x1b3)],'qr_code':_0x5d77d5[_0x227d7a(0x203)][_0x227d7a(0x1ff)],'qr_url':_0x5d77d5[_0x227d7a(0x203)][_0x227d7a(0x1fe)]};}catch(_0x430ccd){console['error'](_0x227d7a(0x1da)),console[_0x227d7a(0x1e9)]('Error\x20details:',_0x430ccd),loggerService_1['loggerService'][_0x227d7a(0x199)](_0x227d7a(0x1ae),_0x227d7a(0x1b4),_0x430ccd);if(_0x430ccd instanceof Error){console[_0x227d7a(0x1e9)]('Error\x20message:',_0x430ccd[_0x227d7a(0x19f)]),console[_0x227d7a(0x1e9)](_0x227d7a(0x196),_0x430ccd[_0x227d7a(0x1cd)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x430ccd[_0x227d7a(0x19f)]);}throw new Error(_0x227d7a(0x1de));}}async['verifyPayment'](_0x14794c){const _0x57c009=a51_0x572d96,_0x51d361=Date[_0x57c009(0x198)]();try{if(!this[_0x57c009(0x1a2)])throw new Error(_0x57c009(0x1f8));const _0x4bf892=new URLSearchParams({'api_key':this[_0x57c009(0x1a2)],'txn_id':_0x14794c}),_0x3269f8=_0x57c009(0x1ba)+_0x14794c+'?'+_0x4bf892['toString']();loggerService_1[_0x57c009(0x1c7)][_0x57c009(0x19b)]('plisio_direct',_0x57c009(0x1d8)+_0x14794c,_0x57c009(0x1ee),Object[_0x57c009(0x1d2)](_0x4bf892[_0x57c009(0x1e2)]()));const _0x24d0f3=await fetch(_0x3269f8,{'method':_0x57c009(0x1ee),'headers':{'Accept':_0x57c009(0x1cf),'User-Agent':_0x57c009(0x1d9)}}),_0x36c7f9=Date[_0x57c009(0x198)]()-_0x51d361;if(!_0x24d0f3['ok']){const _0x1edffe=await _0x24d0f3[_0x57c009(0x1a9)]();loggerService_1['loggerService'][_0x57c009(0x1bd)](_0x57c009(0x1ae),_0x57c009(0x1d8)+_0x14794c,_0x24d0f3[_0x57c009(0x1ab)],_0x1edffe,_0x36c7f9);throw new Error(_0x57c009(0x201)+_0x24d0f3[_0x57c009(0x1ab)]);}const _0x4596fa=await _0x24d0f3[_0x57c009(0x1fb)]();loggerService_1[_0x57c009(0x1c7)][_0x57c009(0x1bd)](_0x57c009(0x1ae),_0x57c009(0x1d8)+_0x14794c,_0x24d0f3[_0x57c009(0x1ab)],_0x4596fa,_0x36c7f9);if(_0x4596fa[_0x57c009(0x1ab)]!==_0x57c009(0x1df)){loggerService_1[_0x57c009(0x1c7)][_0x57c009(0x199)](_0x57c009(0x1ae),_0x57c009(0x1d8)+_0x14794c,_0x57c009(0x1f0)+(_0x4596fa['message']||_0x4596fa[_0x57c009(0x1e9)]||'Unknown\x20error'));throw new Error(_0x57c009(0x1f0)+(_0x4596fa['message']||_0x4596fa['error']||_0x57c009(0x1cc)));}let _0x1e9ab7='PENDING';return{'status':_0x1e9ab7};}catch(_0x3bb1b5){console['error']('Plisio\x20payment\x20verification\x20error:',_0x3bb1b5),loggerService_1['loggerService'][_0x57c009(0x199)]('plisio_direct',_0x57c009(0x1d8)+_0x14794c,_0x3bb1b5);throw new Error(_0x57c009(0x1eb)+(_0x3bb1b5 instanceof Error?_0x3bb1b5[_0x57c009(0x19f)]:_0x57c009(0x1cc)));}}async[a51_0x572d96(0x1fa)](_0x10e059){const _0x425a15=a51_0x572d96;console['log'](_0x425a15(0x1a7),_0x10e059);let _0x263961='PENDING';switch(_0x10e059[_0x425a15(0x1ab)]?.[_0x425a15(0x1e3)]()){case _0x425a15(0x1c8):case'mismatch':_0x263961=_0x425a15(0x1d5);break;case'expired':_0x263961='EXPIRED';break;case _0x425a15(0x1e9):case'cancelled':_0x263961=_0x425a15(0x1a3);break;case _0x425a15(0x1cb):_0x263961=_0x425a15(0x19e);break;case'pending':_0x263961=_0x425a15(0x1fd);break;default:_0x263961='PENDING';break;}let _0x2ef99b;if(_0x10e059['tx_urls'])try{console[_0x425a15(0x1a0)](_0x425a15(0x1c1),_0x10e059[_0x425a15(0x1b6)]);let _0x41ffec;if(typeof _0x10e059[_0x425a15(0x1b6)]===_0x425a15(0x1a4))_0x41ffec=JSON[_0x425a15(0x1d7)](_0x10e059[_0x425a15(0x1b6)]);else Array[_0x425a15(0x1f9)](_0x10e059[_0x425a15(0x1b6)])?_0x41ffec=_0x10e059['tx_urls']:_0x41ffec=[];_0x2ef99b=_0x41ffec['map'](_0x18e75d=>{const _0x2b9ce9=_0x425a15,_0x192d2c=_0x18e75d['replace'](/\\/g,'');return console[_0x2b9ce9(0x1a0)](_0x2b9ce9(0x1f7)+_0x18e75d+'\x20->\x20'+_0x192d2c),_0x192d2c;}),console[_0x425a15(0x1a0)](_0x425a15(0x195),_0x2ef99b),_0x2ef99b[_0x425a15(0x200)]((_0x37b687,_0x3644a8)=>{const _0x586357=_0x425a15;try{new URL(_0x37b687),console[_0x586357(0x1a0)](_0x586357(0x19c)+(_0x3644a8+0x1)+_0x586357(0x1f4)+_0x37b687);}catch(_0x4522fe){console[_0x586357(0x1e9)](_0x586357(0x206)+(_0x3644a8+0x1)+'\x20is\x20invalid:\x20'+_0x37b687,_0x4522fe);}});}catch(_0x2df848){console[_0x425a15(0x1e9)](_0x425a15(0x1ed),_0x2df848),console[_0x425a15(0x1e9)](_0x425a15(0x1be),_0x10e059['tx_urls']),_0x2ef99b=undefined;}return{'paymentId':_0x10e059['order_number']||'','status':_0x263961,'amount':_0x10e059[_0x425a15(0x1b0)],'currency':_0x10e059[_0x425a15(0x1f6)],'txUrls':_0x2ef99b};}}exports['PlisioService']=PlisioService;function a51_0x1d08(){const _0x383bb3=['3540716RsFYro','HTTP\x20Status:','logWhiteDomainResponse','Raw\x20tx_urls\x20data:','env','(fiat\x20for\x20merchant)','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','2169909AAOMvw','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','apiUrl','PLISIO_API_KEY','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','loggerService','completed','toString','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','new','Unknown\x20error','stack','Raw\x20Response\x20Body:','application/json','Transaction\x20ID:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','fromEntries','Response\x20Body:','98sXEdbo','PAID','Status:','parse','/operations/','TesSoft\x20Payment\x20System/1.0','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','===\x20PLISIO\x20SUCCESS\x20===','stringify','122732zMWjhB','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','success','15vBxhEp','createPayment','entries','toLowerCase','1465555kjrfxi','append','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Response\x20Time:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','error','URL:','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','26691490FSlOib','❌\x20Failed\x20to\x20parse\x20tx_urls:','GET','Response\x20data:','Plisio\x20API\x20error:\x20','JSON\x20Parse\x20Error:\x20','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Target\x20Currency:','\x20is\x20valid:\x20','https://api.trapay.uk/api/webhooks/gateway/plisio','currency','🔗\x20Formatted\x20URL:\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','isArray','processWebhook','json','name','PROCESSING','qr_url','qr_code','forEach','HTTP\x20error!\x20status:\x20','email','data','Unknown\x20error\x20from\x20Plisio\x20API','2150577GyXZwl','❌\x20URL\x20','✅\x20Processed\x20tx_urls:','Error\x20stack:','Status\x20Text:','now','logWhiteDomainError','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','logWhiteDomainRequest','✅\x20URL\x20','HIDDEN','PENDING','message','log','defineProperty','apiKey','FAILED','string','txn_id','warn','Processing\x20Plisio\x20webhook:','https://api.plisio.net/api/v1/invoices/new','text','48pBPhCB','status','Amount:','Full\x20URL\x20(without\x20API\x20key):','plisio_direct','163548MMDPCT','amount','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','invoice_total_sum','/invoices/new','../loggerService','tx_urls','invoice_url','source_amount','Parsed\x20Result:','https://api.plisio.net/api/v1/operations/'];a51_0x1d08=function(){return _0x383bb3;};return a51_0x1d08();}