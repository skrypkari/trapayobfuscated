'use strict';const a45_0x351845=a45_0x2636;(function(_0x593ccf,_0x300312){const _0x102af3=a45_0x2636,_0x317021=_0x593ccf();while(!![]){try{const _0x52d169=-parseInt(_0x102af3(0x1a5))/0x1+parseInt(_0x102af3(0x170))/0x2+parseInt(_0x102af3(0x173))/0x3+-parseInt(_0x102af3(0x1c2))/0x4+parseInt(_0x102af3(0x179))/0x5*(-parseInt(_0x102af3(0x1be))/0x6)+-parseInt(_0x102af3(0x1ab))/0x7+parseInt(_0x102af3(0x191))/0x8;if(_0x52d169===_0x300312)break;else _0x317021['push'](_0x317021['shift']());}catch(_0x5dd46a){_0x317021['push'](_0x317021['shift']());}}}(a45_0x18f5,0x562e0));Object[a45_0x351845(0x1b1)](exports,'__esModule',{'value':!![]}),exports['PlisioService']=void 0x0;function a45_0x18f5(){const _0x3afd34=['Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','map','‚ùå\x20URL\x20','Raw\x20tx_urls\x20data:','\x20->\x20','Unknown\x20error\x20from\x20Plisio\x20API','219442hNlNdB','txn_id','PROCESSING','1260969FseiPq','text','toString','logWhiteDomainResponse','plisio_direct','invoice_total_sum','94910PKqRCT','amount','apiKey','parse','qr_code','HTTP\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20','new','JSON\x20Parse\x20Error:\x20','isArray','Invoice\x20URL:','success','message','data','PlisioService','createPayment','status','apiUrl','Status:','string','forEach','currency','Error\x20message:','Parsed\x20Result:','7752072NgTGxW','GET','Target\x20Currency:','(fiat\x20for\x20merchant)','log','env','error','append','source_amount','loggerService','now','verifyPayment','Processing\x20Plisio\x20webhook:','Raw\x20Response\x20Body:','completed','‚úÖ\x20URL\x20','Plisio\x20API\x20error:\x20','cancelled','Business\x20Error:\x20','logWhiteDomainError','674587ehlkye','name','\x20is\x20valid:\x20','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','source_currency','399084ZgzQbO','üîó\x20Formatted\x20URL:\x20','/operations/','invoice_url','Unknown\x20error','replace','defineProperty','Response\x20Body:','processWebhook','Parameters:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','stack','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','statusText','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','PLISIO_API_KEY','warn','90dZJMkG','toLowerCase','EXPIRED','Full\x20URL\x20(without\x20API\x20key):','518928dJCMAD','application/json','Transaction\x20ID:','HTTP\x20error!\x20status:\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Error\x20details:','HTTP\x20Status:','/invoices/new','PENDING','entries','stringify','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','pending','Source\x20Currency:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','tx_urls','\x20is\x20invalid:\x20','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','‚úÖ\x20Processed\x20tx_urls:','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Error\x20Message:','order_number','fromEntries','logWhiteDomainRequest','TesSoft\x20Payment\x20System/1.0','Error\x20stack:'];a45_0x18f5=function(){return _0x3afd34;};return a45_0x18f5();}const loggerService_1=require('../loggerService');function a45_0x2636(_0x2f7590,_0xe2c869){const _0x18f5c6=a45_0x18f5();return a45_0x2636=function(_0x26365b,_0x1b21b5){_0x26365b=_0x26365b-0x162;let _0x290c45=_0x18f5c6[_0x26365b];return _0x290c45;},a45_0x2636(_0x2f7590,_0xe2c869);}class PlisioService{constructor(){const _0x3caa33=a45_0x351845;this[_0x3caa33(0x18a)]='https://api.plisio.net/api/v1/invoices/new',this['apiKey']=process[_0x3caa33(0x196)][_0x3caa33(0x1bc)]||'',!this['apiKey']?console[_0x3caa33(0x1bd)](_0x3caa33(0x1a9)):console['log'](_0x3caa33(0x1c7));}async[a45_0x351845(0x188)](_0x45c798){const _0x326913=a45_0x351845,{orderId:_0x57019a,amount:_0x264261,currency:_0x34edfe,productName:_0x4c08e3,description:_0x1f7431,successUrl:_0x584642,failUrl:_0x39c701,customerEmail:_0x54c5fd,customerName:_0x47a625,isSourceCurrency:_0x20c9a7,sourceCurrency:_0x115da8}=_0x45c798;if(!this[_0x326913(0x17b)])throw new Error(_0x326913(0x1c6));const _0x232ac4=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x57019a,'order_name':_0x4c08e3,'description':_0x1f7431,'success_url':_0x584642,'fail_url':_0x39c701,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x115da8?(_0x232ac4[_0x326913(0x198)]('currency',_0x115da8),_0x232ac4[_0x326913(0x198)](_0x326913(0x1aa),_0x34edfe),_0x232ac4[_0x326913(0x198)](_0x326913(0x199),_0x264261[_0x326913(0x175)]())):(_0x232ac4[_0x326913(0x198)](_0x326913(0x18e),_0x34edfe),_0x232ac4[_0x326913(0x198)](_0x326913(0x17a),_0x264261[_0x326913(0x175)]()));_0x54c5fd&&_0x232ac4['append']('email',_0x54c5fd);_0x47a625&&_0x232ac4[_0x326913(0x198)](_0x326913(0x1a6),_0x47a625);const _0x520b36=this[_0x326913(0x18a)]+'?'+_0x232ac4['toString'](),_0x252744=Date[_0x326913(0x19b)]();try{console[_0x326913(0x195)](_0x326913(0x1ce)),console[_0x326913(0x195)]('URL:',this[_0x326913(0x18a)]),console[_0x326913(0x195)](_0x326913(0x1b4),Object[_0x326913(0x166)](_0x232ac4[_0x326913(0x1cc)]())),console['log'](_0x326913(0x1c1),_0x520b36[_0x326913(0x1b0)](this[_0x326913(0x17b)],'HIDDEN')),loggerService_1[_0x326913(0x19a)][_0x326913(0x167)](_0x326913(0x177),_0x326913(0x1ca),_0x326913(0x192),Object[_0x326913(0x166)](_0x232ac4['entries']()));const _0x2b4308=await fetch(_0x520b36,{'method':'GET','headers':{'Accept':_0x326913(0x1c3),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x4ef6b5=Date[_0x326913(0x19b)]()-_0x252744;console[_0x326913(0x195)](_0x326913(0x1b7)),console['log'](_0x326913(0x18b),_0x2b4308[_0x326913(0x189)]),console[_0x326913(0x195)]('Status\x20Text:',_0x2b4308[_0x326913(0x1b9)]),console['log']('Response\x20Time:',_0x4ef6b5+'ms');const _0x22cc9d=await _0x2b4308[_0x326913(0x174)]();console[_0x326913(0x195)](_0x326913(0x19e),_0x22cc9d);if(!_0x2b4308['ok']){console[_0x326913(0x197)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error'](_0x326913(0x1c9),_0x2b4308[_0x326913(0x189)]),console[_0x326913(0x197)](_0x326913(0x1b2),_0x22cc9d),loggerService_1[_0x326913(0x19a)]['logWhiteDomainResponse'](_0x326913(0x177),_0x326913(0x1ca),_0x2b4308[_0x326913(0x189)],_0x22cc9d,_0x4ef6b5),loggerService_1[_0x326913(0x19a)][_0x326913(0x1a4)]('plisio_direct',_0x326913(0x1ca),_0x326913(0x17e)+_0x2b4308[_0x326913(0x189)]+':\x20'+_0x22cc9d);throw new Error(_0x326913(0x1c5)+_0x2b4308[_0x326913(0x189)]+',\x20body:\x20'+_0x22cc9d);}let _0x2c75ee;try{_0x2c75ee=JSON[_0x326913(0x17c)](_0x22cc9d);}catch(_0x47cde4){console[_0x326913(0x197)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x47cde4),loggerService_1[_0x326913(0x19a)]['logWhiteDomainError']('plisio_direct',_0x326913(0x1ca),_0x326913(0x181)+_0x47cde4);throw new Error(_0x326913(0x1a8)+_0x22cc9d);}console[_0x326913(0x195)](_0x326913(0x1b8)),console[_0x326913(0x195)](_0x326913(0x190),JSON[_0x326913(0x1cd)](_0x2c75ee,null,0x2)),loggerService_1[_0x326913(0x19a)][_0x326913(0x176)](_0x326913(0x177),_0x326913(0x1ca),_0x2b4308[_0x326913(0x189)],_0x2c75ee,_0x4ef6b5);if(_0x2c75ee[_0x326913(0x189)]!==_0x326913(0x184)){const _0x5b9b94=_0x2c75ee[_0x326913(0x185)]||_0x2c75ee[_0x326913(0x197)]||_0x326913(0x16f);console[_0x326913(0x197)](_0x326913(0x1ba)),console[_0x326913(0x197)](_0x326913(0x164),_0x5b9b94),loggerService_1['loggerService'][_0x326913(0x1a4)]('plisio_direct',_0x326913(0x1ca),_0x326913(0x1a3)+_0x5b9b94);throw new Error('Plisio\x20API\x20error:\x20'+_0x5b9b94);}if(!_0x2c75ee[_0x326913(0x186)]?.[_0x326913(0x171)]||!_0x2c75ee[_0x326913(0x186)]?.[_0x326913(0x1ae)]){console[_0x326913(0x197)](_0x326913(0x1d4)),console[_0x326913(0x197)](_0x326913(0x16a)),console['error']('Response\x20data:',_0x2c75ee['data']),loggerService_1[_0x326913(0x19a)]['logWhiteDomainError'](_0x326913(0x177),'/invoices/new',_0x326913(0x1b5));throw new Error(_0x326913(0x1d1));}return console['log']('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x326913(0x195)](_0x326913(0x1c4),_0x2c75ee[_0x326913(0x186)][_0x326913(0x171)]),console['log'](_0x326913(0x183),_0x2c75ee[_0x326913(0x186)][_0x326913(0x1ae)]),console[_0x326913(0x195)]('Amount:',_0x264261,_0x34edfe),_0x115da8&&(console['log'](_0x326913(0x1d0),_0x115da8,'(crypto\x20for\x20payment)'),console['log'](_0x326913(0x193),_0x34edfe,_0x326913(0x194))),{'gateway_payment_id':_0x2c75ee[_0x326913(0x186)][_0x326913(0x171)],'payment_url':_0x2c75ee[_0x326913(0x186)][_0x326913(0x1ae)],'invoice_total_sum':_0x2c75ee[_0x326913(0x186)][_0x326913(0x178)],'qr_code':_0x2c75ee[_0x326913(0x186)][_0x326913(0x17d)],'qr_url':_0x2c75ee[_0x326913(0x186)]['qr_url']};}catch(_0x1e410b){console[_0x326913(0x197)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x326913(0x197)](_0x326913(0x1c8),_0x1e410b),loggerService_1['loggerService'][_0x326913(0x1a4)](_0x326913(0x177),_0x326913(0x1ca),_0x1e410b);if(_0x1e410b instanceof Error){console['error'](_0x326913(0x18f),_0x1e410b['message']),console[_0x326913(0x197)](_0x326913(0x169),_0x1e410b[_0x326913(0x1b6)]);throw new Error(_0x326913(0x17f)+_0x1e410b[_0x326913(0x185)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a45_0x351845(0x19c)](_0x2ca84c){const _0x510f7b=a45_0x351845,_0x39fb03=Date[_0x510f7b(0x19b)]();try{if(!this['apiKey'])throw new Error(_0x510f7b(0x1c6));const _0x436712=new URLSearchParams({'api_key':this[_0x510f7b(0x17b)],'txn_id':_0x2ca84c}),_0x37e629='https://api.plisio.net/api/v1/operations/'+_0x2ca84c+'?'+_0x436712[_0x510f7b(0x175)]();loggerService_1[_0x510f7b(0x19a)]['logWhiteDomainRequest'](_0x510f7b(0x177),'/operations/'+_0x2ca84c,'GET',Object[_0x510f7b(0x166)](_0x436712[_0x510f7b(0x1cc)]()));const _0x1928be=await fetch(_0x37e629,{'method':'GET','headers':{'Accept':_0x510f7b(0x1c3),'User-Agent':_0x510f7b(0x168)}}),_0x5271a4=Date[_0x510f7b(0x19b)]()-_0x39fb03;if(!_0x1928be['ok']){const _0x4db00c=await _0x1928be[_0x510f7b(0x174)]();loggerService_1[_0x510f7b(0x19a)][_0x510f7b(0x176)]('plisio_direct','/operations/'+_0x2ca84c,_0x1928be[_0x510f7b(0x189)],_0x4db00c,_0x5271a4);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1928be[_0x510f7b(0x189)]);}const _0x4cc1d1=await _0x1928be['json']();loggerService_1[_0x510f7b(0x19a)][_0x510f7b(0x176)]('plisio_direct',_0x510f7b(0x1ad)+_0x2ca84c,_0x1928be[_0x510f7b(0x189)],_0x4cc1d1,_0x5271a4);if(_0x4cc1d1['status']!==_0x510f7b(0x184)){loggerService_1[_0x510f7b(0x19a)]['logWhiteDomainError'](_0x510f7b(0x177),_0x510f7b(0x1ad)+_0x2ca84c,_0x510f7b(0x1a1)+(_0x4cc1d1['message']||_0x4cc1d1['error']||'Unknown\x20error'));throw new Error(_0x510f7b(0x1a1)+(_0x4cc1d1[_0x510f7b(0x185)]||_0x4cc1d1[_0x510f7b(0x197)]||_0x510f7b(0x1af)));}let _0x3ddbd9=_0x510f7b(0x1cb);return{'status':_0x3ddbd9};}catch(_0x104ba6){console[_0x510f7b(0x197)]('Plisio\x20payment\x20verification\x20error:',_0x104ba6),loggerService_1[_0x510f7b(0x19a)][_0x510f7b(0x1a4)](_0x510f7b(0x177),_0x510f7b(0x1ad)+_0x2ca84c,_0x104ba6);throw new Error(_0x510f7b(0x1bb)+(_0x104ba6 instanceof Error?_0x104ba6['message']:_0x510f7b(0x1af)));}}async[a45_0x351845(0x1b3)](_0x1cf4d1){const _0x479bba=a45_0x351845;console[_0x479bba(0x195)](_0x479bba(0x19d),_0x1cf4d1);let _0x1a6eab='PENDING';switch(_0x1cf4d1['status']?.[_0x479bba(0x1bf)]()){case _0x479bba(0x19f):case'mismatch':_0x1a6eab='PAID';break;case'expired':_0x1a6eab=_0x479bba(0x1c0);break;case _0x479bba(0x197):case _0x479bba(0x1a2):_0x1a6eab='FAILED';break;case _0x479bba(0x180):_0x1a6eab=_0x479bba(0x1cb);break;case _0x479bba(0x1cf):_0x1a6eab=_0x479bba(0x172);break;default:_0x1a6eab=_0x479bba(0x1cb);break;}let _0x22f3df;if(_0x1cf4d1[_0x479bba(0x1d2)])try{console[_0x479bba(0x195)](_0x479bba(0x163),_0x1cf4d1[_0x479bba(0x1d2)]);let _0x3a1453;if(typeof _0x1cf4d1['tx_urls']===_0x479bba(0x18c))_0x3a1453=JSON[_0x479bba(0x17c)](_0x1cf4d1['tx_urls']);else Array[_0x479bba(0x182)](_0x1cf4d1[_0x479bba(0x1d2)])?_0x3a1453=_0x1cf4d1[_0x479bba(0x1d2)]:_0x3a1453=[];_0x22f3df=_0x3a1453[_0x479bba(0x16b)](_0x2694f7=>{const _0x4445c4=_0x479bba,_0x3b8069=_0x2694f7[_0x4445c4(0x1b0)](/\\/g,'');return console['log'](_0x4445c4(0x1ac)+_0x2694f7+_0x4445c4(0x16e)+_0x3b8069),_0x3b8069;}),console['log'](_0x479bba(0x162),_0x22f3df),_0x22f3df[_0x479bba(0x18d)]((_0x29a394,_0x2c5bbf)=>{const _0x24fb9e=_0x479bba;try{new URL(_0x29a394),console[_0x24fb9e(0x195)](_0x24fb9e(0x1a0)+(_0x2c5bbf+0x1)+_0x24fb9e(0x1a7)+_0x29a394);}catch(_0x2b8f95){console[_0x24fb9e(0x197)](_0x24fb9e(0x16c)+(_0x2c5bbf+0x1)+_0x24fb9e(0x1d3)+_0x29a394,_0x2b8f95);}});}catch(_0x293b86){console[_0x479bba(0x197)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x293b86),console[_0x479bba(0x197)](_0x479bba(0x16d),_0x1cf4d1[_0x479bba(0x1d2)]),_0x22f3df=undefined;}return{'paymentId':_0x1cf4d1[_0x479bba(0x165)]||'','status':_0x1a6eab,'amount':_0x1cf4d1['amount'],'currency':_0x1cf4d1[_0x479bba(0x18e)],'txUrls':_0x22f3df};}}exports[a45_0x351845(0x187)]=PlisioService;