'use strict';const a44_0x41f614=a44_0x1071;(function(_0x129efa,_0x59570d){const _0x362abf=a44_0x1071,_0xa0b9e8=_0x129efa();while(!![]){try{const _0x4fb4dc=parseInt(_0x362abf(0x107))/0x1*(parseInt(_0x362abf(0x97))/0x2)+-parseInt(_0x362abf(0xe3))/0x3+-parseInt(_0x362abf(0xbe))/0x4*(-parseInt(_0x362abf(0xba))/0x5)+parseInt(_0x362abf(0xd7))/0x6+parseInt(_0x362abf(0xc6))/0x7*(parseInt(_0x362abf(0xc9))/0x8)+-parseInt(_0x362abf(0xef))/0x9+-parseInt(_0x362abf(0xc4))/0xa;if(_0x4fb4dc===_0x59570d)break;else _0xa0b9e8['push'](_0xa0b9e8['shift']());}catch(_0x3705e1){_0xa0b9e8['push'](_0xa0b9e8['shift']());}}}(a44_0x1be3,0x1bd75));function a44_0x1071(_0xb562f0,_0x50a7fc){const _0x1be377=a44_0x1be3();return a44_0x1071=function(_0x107176,_0x31904d){_0x107176=_0x107176-0x92;let _0x4b51b6=_0x1be377[_0x107176];return _0x4b51b6;},a44_0x1071(_0xb562f0,_0x50a7fc);}Object[a44_0x41f614(0xcf)](exports,a44_0x41f614(0xbc),{'value':!![]}),exports['PlisioService']=void 0x0;function a44_0x1be3(){const _0x154dbf=['success','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','PLISIO_API_KEY','JSON\x20Parse\x20Error:\x20','2670960tBPHcD','(crypto\x20for\x20payment)','1511279rSAFZw','Error\x20message:','source_amount','8AkZjMv','qr_url','application/json','invoice_url','\x20->\x20','invoice_total_sum','defineProperty','Transaction\x20ID:','Source\x20Currency:','mismatch','Failed\x20to\x20parse\x20JSON\x20response:','TesSoft\x20Payment\x20System/1.0','statusText','../loggerService','1228434YqiPzq','\x20is\x20invalid:\x20','/invoices/new','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','verifyPayment','logWhiteDomainError','map','Unknown\x20error\x20from\x20Plisio\x20API','env','expired','‚úÖ\x20URL\x20','EXPIRED','286521gsPAUO','log','apiKey','text','status','currency','apiUrl','Status\x20Text:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','/operations/','txn_id','pending','1511343oVRtZD','Raw\x20tx_urls\x20data:','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','completed','tx_urls','Parsed\x20Result:','FAILED','https://api.plisio.net/api/v1/invoices/new','json','PlisioService','message','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Plisio\x20API\x20error:\x20','string','Failed\x20to\x20create\x20Plisio\x20payment:\x20','‚ùå\x20URL\x20','URL:','replace','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','logWhiteDomainRequest','isArray','Amount:','now','181859MVzopj','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','loggerService','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','append',',\x20body:\x20','PENDING','===\x20PLISIO\x20SUCCESS\x20===','2WalNEN','cancelled','GET','warn','stringify','(fiat\x20for\x20merchant)','error','Invoice\x20URL:','Response\x20Time:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','entries','logWhiteDomainResponse','source_currency','toLowerCase','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Plisio\x20payment\x20verification\x20error:','amount','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','PAID','https://api.plisio.net/api/v1/operations/','data','fromEntries','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error','HTTP\x20','HTTP\x20Status:','toString','processWebhook','Error\x20details:','Response\x20data:','HIDDEN','Parameters:','Error\x20stack:','new','parse','17530DmhHKG','https://api.trapay.uk/api/webhooks/gateway/plisio','__esModule','plisio_direct','48gdlbve','HTTP\x20error!\x20status:\x20'];a44_0x1be3=function(){return _0x154dbf;};return a44_0x1be3();}const loggerService_1=require(a44_0x41f614(0xd6));class PlisioService{constructor(){const _0x566436=a44_0x41f614;this[_0x566436(0xe9)]=_0x566436(0xf6),this[_0x566436(0xe5)]=process[_0x566436(0xdf)][_0x566436(0xc2)]||'',!this[_0x566436(0xe5)]?console[_0x566436(0x9a)](_0x566436(0xa8)):console[_0x566436(0xe4)](_0x566436(0xda));}async['createPayment'](_0x20ea76){const _0xb0c075=a44_0x41f614,{orderId:_0x62c310,amount:_0x55ed43,currency:_0x877dbe,productName:_0x10966a,description:_0xd84833,successUrl:_0x5ab19a,failUrl:_0x8c35f1,customerEmail:_0x4175b6,customerName:_0x569586,isSourceCurrency:_0x585bde,sourceCurrency:_0x134193}=_0x20ea76;if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x3be025=new URLSearchParams({'api_key':this[_0xb0c075(0xe5)],'order_number':_0x62c310,'order_name':_0x10966a,'description':_0xd84833,'success_url':_0x5ab19a,'fail_url':_0x8c35f1,'callback_url':_0xb0c075(0xbb)});_0x134193?(_0x3be025['append'](_0xb0c075(0xe8),_0x134193),_0x3be025['append'](_0xb0c075(0xa3),_0x877dbe),_0x3be025['append'](_0xb0c075(0xc8),_0x55ed43[_0xb0c075(0xb1)]())):(_0x3be025[_0xb0c075(0x93)](_0xb0c075(0xe8),_0x877dbe),_0x3be025[_0xb0c075(0x93)](_0xb0c075(0xa7),_0x55ed43[_0xb0c075(0xb1)]()));_0x4175b6&&_0x3be025[_0xb0c075(0x93)]('email',_0x4175b6);_0x569586&&_0x3be025[_0xb0c075(0x93)]('name',_0x569586);const _0x29eff5=this[_0xb0c075(0xe9)]+'?'+_0x3be025['toString'](),_0x59f345=Date[_0xb0c075(0x106)]();try{console[_0xb0c075(0xe4)](_0xb0c075(0x102)),console[_0xb0c075(0xe4)](_0xb0c075(0x100),this[_0xb0c075(0xe9)]),console[_0xb0c075(0xe4)](_0xb0c075(0xb6),Object[_0xb0c075(0xac)](_0x3be025['entries']())),console[_0xb0c075(0xe4)]('Full\x20URL\x20(without\x20API\x20key):',_0x29eff5[_0xb0c075(0x101)](this[_0xb0c075(0xe5)],_0xb0c075(0xb5))),loggerService_1[_0xb0c075(0x109)]['logWhiteDomainRequest'](_0xb0c075(0xbd),'/invoices/new',_0xb0c075(0x99),Object[_0xb0c075(0xac)](_0x3be025[_0xb0c075(0xa1)]()));const _0x3448a4=await fetch(_0x29eff5,{'method':_0xb0c075(0x99),'headers':{'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x5b405e=Date[_0xb0c075(0x106)]()-_0x59f345;console[_0xb0c075(0xe4)](_0xb0c075(0xa0)),console['log']('Status:',_0x3448a4[_0xb0c075(0xe7)]),console[_0xb0c075(0xe4)](_0xb0c075(0xea),_0x3448a4[_0xb0c075(0xd5)]),console[_0xb0c075(0xe4)](_0xb0c075(0x9f),_0x5b405e+'ms');const _0xfd0d06=await _0x3448a4[_0xb0c075(0xe6)]();console[_0xb0c075(0xe4)]('Raw\x20Response\x20Body:',_0xfd0d06);if(!_0x3448a4['ok']){console[_0xb0c075(0x9d)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error'](_0xb0c075(0xb0),_0x3448a4[_0xb0c075(0xe7)]),console[_0xb0c075(0x9d)]('Response\x20Body:',_0xfd0d06),loggerService_1['loggerService']['logWhiteDomainResponse'](_0xb0c075(0xbd),_0xb0c075(0xd9),_0x3448a4[_0xb0c075(0xe7)],_0xfd0d06,_0x5b405e),loggerService_1[_0xb0c075(0x109)]['logWhiteDomainError'](_0xb0c075(0xbd),_0xb0c075(0xd9),_0xb0c075(0xaf)+_0x3448a4[_0xb0c075(0xe7)]+':\x20'+_0xfd0d06);throw new Error(_0xb0c075(0xbf)+_0x3448a4[_0xb0c075(0xe7)]+_0xb0c075(0x94)+_0xfd0d06);}let _0x1aa8fe;try{_0x1aa8fe=JSON[_0xb0c075(0xb9)](_0xfd0d06);}catch(_0x4bc1a0){console['error'](_0xb0c075(0xd3),_0x4bc1a0),loggerService_1['loggerService'][_0xb0c075(0xdc)]('plisio_direct',_0xb0c075(0xd9),_0xb0c075(0xc3)+_0x4bc1a0);throw new Error(_0xb0c075(0x108)+_0xfd0d06);}console[_0xb0c075(0xe4)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0xb0c075(0xe4)](_0xb0c075(0xf4),JSON[_0xb0c075(0x9b)](_0x1aa8fe,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0xb0c075(0xbd),_0xb0c075(0xd9),_0x3448a4[_0xb0c075(0xe7)],_0x1aa8fe,_0x5b405e);if(_0x1aa8fe[_0xb0c075(0xe7)]!==_0xb0c075(0xc0)){const _0x628056=_0x1aa8fe[_0xb0c075(0xf9)]||_0x1aa8fe[_0xb0c075(0x9d)]||_0xb0c075(0xde);console[_0xb0c075(0x9d)](_0xb0c075(0x92)),console[_0xb0c075(0x9d)]('Error\x20Message:',_0x628056),loggerService_1[_0xb0c075(0x109)]['logWhiteDomainError'](_0xb0c075(0xbd),_0xb0c075(0xd9),'Business\x20Error:\x20'+_0x628056);throw new Error(_0xb0c075(0xfc)+_0x628056);}if(!_0x1aa8fe[_0xb0c075(0xab)]?.[_0xb0c075(0xed)]||!_0x1aa8fe[_0xb0c075(0xab)]?.[_0xb0c075(0xcc)]){console[_0xb0c075(0x9d)](_0xb0c075(0xad)),console[_0xb0c075(0x9d)](_0xb0c075(0xeb)),console[_0xb0c075(0x9d)](_0xb0c075(0xb4),_0x1aa8fe[_0xb0c075(0xab)]),loggerService_1[_0xb0c075(0x109)]['logWhiteDomainError'](_0xb0c075(0xbd),_0xb0c075(0xd9),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0xb0c075(0xc1));}return console[_0xb0c075(0xe4)](_0xb0c075(0x96)),console['log'](_0xb0c075(0xd0),_0x1aa8fe[_0xb0c075(0xab)][_0xb0c075(0xed)]),console[_0xb0c075(0xe4)](_0xb0c075(0x9e),_0x1aa8fe['data'][_0xb0c075(0xcc)]),console[_0xb0c075(0xe4)](_0xb0c075(0x105),_0x55ed43,_0x877dbe),_0x134193&&(console[_0xb0c075(0xe4)](_0xb0c075(0xd1),_0x134193,_0xb0c075(0xc5)),console[_0xb0c075(0xe4)]('Target\x20Currency:',_0x877dbe,_0xb0c075(0x9c))),{'gateway_payment_id':_0x1aa8fe[_0xb0c075(0xab)]['txn_id'],'payment_url':_0x1aa8fe[_0xb0c075(0xab)][_0xb0c075(0xcc)],'invoice_total_sum':_0x1aa8fe[_0xb0c075(0xab)][_0xb0c075(0xce)],'qr_code':_0x1aa8fe[_0xb0c075(0xab)]['qr_code'],'qr_url':_0x1aa8fe[_0xb0c075(0xab)][_0xb0c075(0xca)]};}catch(_0x554d2c){console[_0xb0c075(0x9d)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0xb0c075(0x9d)](_0xb0c075(0xb3),_0x554d2c),loggerService_1[_0xb0c075(0x109)][_0xb0c075(0xdc)](_0xb0c075(0xbd),_0xb0c075(0xd9),_0x554d2c);if(_0x554d2c instanceof Error){console[_0xb0c075(0x9d)](_0xb0c075(0xc7),_0x554d2c['message']),console[_0xb0c075(0x9d)](_0xb0c075(0xb7),_0x554d2c['stack']);throw new Error(_0xb0c075(0xfe)+_0x554d2c[_0xb0c075(0xf9)]);}throw new Error(_0xb0c075(0xfb));}}async[a44_0x41f614(0xdb)](_0x4e6bbd){const _0x3ce51a=a44_0x41f614,_0xa5701a=Date[_0x3ce51a(0x106)]();try{if(!this[_0x3ce51a(0xe5)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x20d952=new URLSearchParams({'api_key':this[_0x3ce51a(0xe5)],'txn_id':_0x4e6bbd}),_0x3c2847=_0x3ce51a(0xaa)+_0x4e6bbd+'?'+_0x20d952[_0x3ce51a(0xb1)]();loggerService_1['loggerService'][_0x3ce51a(0x103)](_0x3ce51a(0xbd),_0x3ce51a(0xec)+_0x4e6bbd,_0x3ce51a(0x99),Object['fromEntries'](_0x20d952['entries']()));const _0x1ad408=await fetch(_0x3c2847,{'method':'GET','headers':{'Accept':_0x3ce51a(0xcb),'User-Agent':_0x3ce51a(0xd4)}}),_0x2547ca=Date[_0x3ce51a(0x106)]()-_0xa5701a;if(!_0x1ad408['ok']){const _0x6738ee=await _0x1ad408[_0x3ce51a(0xe6)]();loggerService_1['loggerService'][_0x3ce51a(0xa2)](_0x3ce51a(0xbd),_0x3ce51a(0xec)+_0x4e6bbd,_0x1ad408[_0x3ce51a(0xe7)],_0x6738ee,_0x2547ca);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1ad408[_0x3ce51a(0xe7)]);}const _0x15cfdc=await _0x1ad408[_0x3ce51a(0xf7)]();loggerService_1[_0x3ce51a(0x109)][_0x3ce51a(0xa2)]('plisio_direct','/operations/'+_0x4e6bbd,_0x1ad408[_0x3ce51a(0xe7)],_0x15cfdc,_0x2547ca);if(_0x15cfdc[_0x3ce51a(0xe7)]!=='success'){loggerService_1['loggerService'][_0x3ce51a(0xdc)](_0x3ce51a(0xbd),_0x3ce51a(0xec)+_0x4e6bbd,_0x3ce51a(0xfc)+(_0x15cfdc['message']||_0x15cfdc[_0x3ce51a(0x9d)]||_0x3ce51a(0xae)));throw new Error(_0x3ce51a(0xfc)+(_0x15cfdc[_0x3ce51a(0xf9)]||_0x15cfdc[_0x3ce51a(0x9d)]||'Unknown\x20error'));}let _0x444ee1=_0x3ce51a(0x95);return{'status':_0x444ee1};}catch(_0x58d798){console[_0x3ce51a(0x9d)](_0x3ce51a(0xa6),_0x58d798),loggerService_1['loggerService']['logWhiteDomainError'](_0x3ce51a(0xbd),_0x3ce51a(0xec)+_0x4e6bbd,_0x58d798);throw new Error(_0x3ce51a(0xa5)+(_0x58d798 instanceof Error?_0x58d798['message']:_0x3ce51a(0xae)));}}async[a44_0x41f614(0xb2)](_0x2c42bf){const _0x444eda=a44_0x41f614;console[_0x444eda(0xe4)]('Processing\x20Plisio\x20webhook:',_0x2c42bf);let _0x1d6e53=_0x444eda(0x95);switch(_0x2c42bf['status']?.[_0x444eda(0xa4)]()){case _0x444eda(0xf2):case _0x444eda(0xd2):_0x1d6e53=_0x444eda(0xa9);break;case _0x444eda(0xe0):_0x1d6e53=_0x444eda(0xe2);break;case _0x444eda(0x9d):case _0x444eda(0x98):_0x1d6e53=_0x444eda(0xf5);break;case _0x444eda(0xb8):_0x1d6e53=_0x444eda(0x95);break;case _0x444eda(0xee):_0x1d6e53='PROCESSING';break;default:_0x1d6e53=_0x444eda(0x95);break;}let _0x4ad2ce;if(_0x2c42bf[_0x444eda(0xf3)])try{console[_0x444eda(0xe4)](_0x444eda(0xf1),_0x2c42bf[_0x444eda(0xf3)]);let _0x1a9405;if(typeof _0x2c42bf[_0x444eda(0xf3)]===_0x444eda(0xfd))_0x1a9405=JSON[_0x444eda(0xb9)](_0x2c42bf[_0x444eda(0xf3)]);else Array[_0x444eda(0x104)](_0x2c42bf['tx_urls'])?_0x1a9405=_0x2c42bf[_0x444eda(0xf3)]:_0x1a9405=[];_0x4ad2ce=_0x1a9405[_0x444eda(0xdd)](_0x47a9b7=>{const _0x12f178=_0x444eda,_0x482585=_0x47a9b7['replace'](/\\/g,'');return console[_0x12f178(0xe4)]('üîó\x20Formatted\x20URL:\x20'+_0x47a9b7+_0x12f178(0xcd)+_0x482585),_0x482585;}),console['log']('‚úÖ\x20Processed\x20tx_urls:',_0x4ad2ce),_0x4ad2ce['forEach']((_0x53e66f,_0x1c17c2)=>{const _0x3f12ac=_0x444eda;try{new URL(_0x53e66f),console[_0x3f12ac(0xe4)](_0x3f12ac(0xe1)+(_0x1c17c2+0x1)+'\x20is\x20valid:\x20'+_0x53e66f);}catch(_0x11e358){console[_0x3f12ac(0x9d)](_0x3f12ac(0xff)+(_0x1c17c2+0x1)+_0x3f12ac(0xd8)+_0x53e66f,_0x11e358);}});}catch(_0x21d17d){console[_0x444eda(0x9d)](_0x444eda(0xfa),_0x21d17d),console[_0x444eda(0x9d)](_0x444eda(0xf0),_0x2c42bf[_0x444eda(0xf3)]),_0x4ad2ce=undefined;}return{'paymentId':_0x2c42bf['order_number']||'','status':_0x1d6e53,'amount':_0x2c42bf[_0x444eda(0xa7)],'currency':_0x2c42bf['currency'],'txUrls':_0x4ad2ce};}}exports[a44_0x41f614(0xf8)]=PlisioService;