'use strict';function a74_0x4196(_0x2c456a,_0x13da72){_0x2c456a=_0x2c456a-0x8d;const _0x3a4276=a74_0x3a42();let _0x4196a9=_0x3a4276[_0x2c456a];return _0x4196a9;}const a74_0x5845d5=a74_0x4196;(function(_0x32848c,_0x5bc2d2){const _0x532e77=a74_0x4196,_0x412115=_0x32848c();while(!![]){try{const _0x203218=parseInt(_0x532e77(0xf2))/0x1+parseInt(_0x532e77(0xcf))/0x2*(-parseInt(_0x532e77(0xd5))/0x3)+-parseInt(_0x532e77(0xc2))/0x4+-parseInt(_0x532e77(0xa6))/0x5+-parseInt(_0x532e77(0xdc))/0x6*(-parseInt(_0x532e77(0x8d))/0x7)+-parseInt(_0x532e77(0xbe))/0x8+parseInt(_0x532e77(0xb5))/0x9;if(_0x203218===_0x5bc2d2)break;else _0x412115['push'](_0x412115['shift']());}catch(_0x254bf9){_0x412115['push'](_0x412115['shift']());}}}(a74_0x3a42,0x79f0b));Object[a74_0x5845d5(0x91)](exports,a74_0x5845d5(0xed),{'value':!![]}),exports[a74_0x5845d5(0xe4)]=void 0x0;function a74_0x3a42(){const _0x1adcd4=['warn','plisio_direct','(crypto\x20for\x20payment)','Payment\x20System/1.0','Plisio\x20API\x20error:\x20','__esModule','log','verifyPayment','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','HTTP\x20Status:','773718yQrSOX','https://api.plisio.net/api/v1/invoices/new','Error\x20Message:','status','success','Status:','forEach','parse','HTTP\x20error!\x20status:\x20','message','stack','text','\x20is\x20invalid:\x20','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','data','48447DRfnNw','json','qr_url','error','defineProperty','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','PAID','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','source_currency','/operations/','append','new','Parsed\x20Result:','invoice_url','âŒ\x20URL\x20','Parameters:','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','processWebhook','URL:','Processing\x20Plisio\x20webhook:',',\x20body:\x20','Full\x20URL\x20(without\x20API\x20key):','Raw\x20tx_urls\x20data:','Source\x20Currency:','Amount:','4025705fLHxyQ','logWhiteDomainResponse','âœ…\x20Processed\x20tx_urls:','Transaction\x20ID:','PENDING','Error\x20message:','application/json','toString','logWhiteDomainRequest','Plisio\x20API\x20key\x20is\x20not\x20configured','EXPIRED','tx_urls','txn_id','apiUrl','\x20is\x20valid:\x20','13349421yUEoqL','Unknown\x20error\x20from\x20Plisio\x20API','loggerService','amount','mismatch','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','JSON\x20Parse\x20Error:\x20','Response\x20Body:','GET','5642320gKnQZu','ðŸ”—\x20Raw\x20tx_urls\x20from\x20Plisio:','statusText','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','1295508qlZGkK','logWhiteDomainError','entries','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','completed','Invoice\x20URL:','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','currency','Plisio\x20payment\x20verification\x20error:','Raw\x20Response\x20Body:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Unknown\x20error','order_number','43614iCayec','isArray','ðŸ”—\x20Formatted\x20URL:\x20','cancelled','map','fromEntries','18XyoFvf','(fiat\x20for\x20merchant)','âš ï¸\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','apiKey','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','name','âŒ\x20Failed\x20to\x20parse\x20tx_urls:','180YDySTX','PROCESSING','FAILED','/invoices/new','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','===\x20PLISIO\x20SUCCESS\x20===','replace','Failed\x20to\x20parse\x20JSON\x20response:','PlisioService','now','stringify','Error\x20details:'];a74_0x3a42=function(){return _0x1adcd4;};return a74_0x3a42();}const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x2652aa=a74_0x5845d5;this['apiUrl']=_0x2652aa(0xf3),this['apiKey']=process.env.PLISIO_API_KEY||'',!this['apiKey']?console[_0x2652aa(0xe8)](_0x2652aa(0xd7)):console[_0x2652aa(0xee)]('ðŸ’°\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async['createPayment'](_0x15742d){const _0x359875=a74_0x5845d5,{orderId:_0x513d10,amount:_0x7d68fb,currency:_0x1bb006,productName:_0x55b193,description:_0x392935,successUrl:_0x19375f,failUrl:_0x2046bb,customerEmail:_0x103d5d,customerName:_0x3444a3,isSourceCurrency:_0x5e4d6b,sourceCurrency:_0x1ba1f2}=_0x15742d;if(!this[_0x359875(0xd8)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0xf63058=new URLSearchParams({'api_key':this[_0x359875(0xd8)],'order_number':_0x513d10,'order_name':_0x55b193,'description':_0x392935,'success_url':_0x19375f,'fail_url':_0x2046bb,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x1ba1f2?(_0xf63058['append'](_0x359875(0xc9),_0x1ba1f2),_0xf63058[_0x359875(0x97)](_0x359875(0x95),_0x1bb006),_0xf63058[_0x359875(0x97)]('source_amount',_0x7d68fb[_0x359875(0xad)]())):(_0xf63058['append'](_0x359875(0xc9),_0x1bb006),_0xf63058['append'](_0x359875(0xb8),_0x7d68fb[_0x359875(0xad)]()));_0x103d5d&&_0xf63058['append']('email',_0x103d5d);_0x3444a3&&_0xf63058[_0x359875(0x97)](_0x359875(0xda),_0x3444a3);const _0x4b86e6=this[_0x359875(0xb3)]+'?'+_0xf63058[_0x359875(0xad)](),_0x13ef17=Date[_0x359875(0xe5)]();try{console['log'](_0x359875(0x94)),console[_0x359875(0xee)](_0x359875(0x9f),this[_0x359875(0xb3)]),console[_0x359875(0xee)](_0x359875(0x9c),Object[_0x359875(0xd4)](_0xf63058['entries']())),console[_0x359875(0xee)](_0x359875(0xa2),_0x4b86e6[_0x359875(0xe2)](this[_0x359875(0xd8)],'HIDDEN')),loggerService_1[_0x359875(0xb7)][_0x359875(0xae)](_0x359875(0xe9),_0x359875(0xdf),_0x359875(0xbd),Object['fromEntries'](_0xf63058[_0x359875(0xc4)]()));const _0x537d5c=await fetch(_0x4b86e6,{'method':_0x359875(0xbd),'headers':{'Accept':_0x359875(0xac),'User-Agent':_0x359875(0xeb)}}),_0x191587=Date[_0x359875(0xe5)]()-_0x13ef17;console[_0x359875(0xee)](_0x359875(0xff)),console[_0x359875(0xee)](_0x359875(0xf7),_0x537d5c[_0x359875(0xf5)]),console['log']('Status\x20Text:',_0x537d5c[_0x359875(0xc0)]),console['log']('Response\x20Time:',_0x191587+'ms');const _0x2e8305=await _0x537d5c[_0x359875(0xfd)]();console[_0x359875(0xee)](_0x359875(0xcb),_0x2e8305);if(!_0x537d5c['ok']){console['error']('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error'](_0x359875(0xf1),_0x537d5c[_0x359875(0xf5)]),console['error'](_0x359875(0xbc),_0x2e8305),loggerService_1[_0x359875(0xb7)][_0x359875(0xa7)](_0x359875(0xe9),_0x359875(0xdf),_0x537d5c['status'],_0x2e8305,_0x191587),loggerService_1[_0x359875(0xb7)][_0x359875(0xc3)]('plisio_direct',_0x359875(0xdf),'HTTP\x20'+_0x537d5c[_0x359875(0xf5)]+':\x20'+_0x2e8305);throw new Error(_0x359875(0xfa)+_0x537d5c[_0x359875(0xf5)]+_0x359875(0xa1)+_0x2e8305);}let _0x436918;try{_0x436918=JSON[_0x359875(0xf9)](_0x2e8305);}catch(_0x16585e){console[_0x359875(0x90)](_0x359875(0xe3),_0x16585e),loggerService_1['loggerService'][_0x359875(0xc3)](_0x359875(0xe9),_0x359875(0xdf),_0x359875(0xbb)+_0x16585e);throw new Error(_0x359875(0x92)+_0x2e8305);}console[_0x359875(0xee)](_0x359875(0xc1)),console[_0x359875(0xee)](_0x359875(0x99),JSON[_0x359875(0xe6)](_0x436918,null,0x2)),loggerService_1['loggerService'][_0x359875(0xa7)](_0x359875(0xe9),_0x359875(0xdf),_0x537d5c[_0x359875(0xf5)],_0x436918,_0x191587);if(_0x436918[_0x359875(0xf5)]!==_0x359875(0xf6)){const _0x11c5af=_0x436918[_0x359875(0xfb)]||_0x436918[_0x359875(0x90)]||_0x359875(0xb6);console[_0x359875(0x90)](_0x359875(0xe0)),console[_0x359875(0x90)](_0x359875(0xf4),_0x11c5af),loggerService_1['loggerService']['logWhiteDomainError'](_0x359875(0xe9),_0x359875(0xdf),'Business\x20Error:\x20'+_0x11c5af);throw new Error('Plisio\x20API\x20error:\x20'+_0x11c5af);}if(!_0x436918[_0x359875(0x100)]?.[_0x359875(0xb2)]||!_0x436918[_0x359875(0x100)]?.[_0x359875(0x9a)]){console['error'](_0x359875(0xc8)),console[_0x359875(0x90)](_0x359875(0xc5)),console['error']('Response\x20data:',_0x436918[_0x359875(0x100)]),loggerService_1[_0x359875(0xb7)][_0x359875(0xc3)]('plisio_direct',_0x359875(0xdf),_0x359875(0xd9));throw new Error(_0x359875(0xcc));}return console['log'](_0x359875(0xe1)),console[_0x359875(0xee)](_0x359875(0xa9),_0x436918[_0x359875(0x100)][_0x359875(0xb2)]),console[_0x359875(0xee)](_0x359875(0xc7),_0x436918[_0x359875(0x100)]['invoice_url']),console[_0x359875(0xee)](_0x359875(0xa5),_0x7d68fb,_0x1bb006),_0x1ba1f2&&(console[_0x359875(0xee)](_0x359875(0xa4),_0x1ba1f2,_0x359875(0xea)),console['log']('Target\x20Currency:',_0x1bb006,_0x359875(0xd6))),{'gateway_payment_id':_0x436918[_0x359875(0x100)][_0x359875(0xb2)],'payment_url':_0x436918[_0x359875(0x100)][_0x359875(0x9a)],'invoice_total_sum':_0x436918[_0x359875(0x100)]['invoice_total_sum'],'qr_code':_0x436918[_0x359875(0x100)]['qr_code'],'qr_url':_0x436918[_0x359875(0x100)][_0x359875(0x8f)]};}catch(_0x56783c){console[_0x359875(0x90)](_0x359875(0x9d)),console['error'](_0x359875(0xe7),_0x56783c),loggerService_1['loggerService'][_0x359875(0xc3)](_0x359875(0xe9),_0x359875(0xdf),_0x56783c);if(_0x56783c instanceof Error){console[_0x359875(0x90)](_0x359875(0xab),_0x56783c[_0x359875(0xfb)]),console['error']('Error\x20stack:',_0x56783c[_0x359875(0xfc)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x56783c['message']);}throw new Error(_0x359875(0xba));}}async[a74_0x5845d5(0xef)](_0x12a332){const _0x1468cf=a74_0x5845d5,_0x220cf6=Date['now']();try{if(!this[_0x1468cf(0xd8)])throw new Error(_0x1468cf(0xaf));const _0x56044f=new URLSearchParams({'api_key':this[_0x1468cf(0xd8)],'txn_id':_0x12a332}),_0x2ad514='https://api.plisio.net/api/v1/operations/'+_0x12a332+'?'+_0x56044f['toString']();loggerService_1[_0x1468cf(0xb7)][_0x1468cf(0xae)]('plisio_direct',_0x1468cf(0x96)+_0x12a332,'GET',Object[_0x1468cf(0xd4)](_0x56044f[_0x1468cf(0xc4)]()));const _0x528562=await fetch(_0x2ad514,{'method':_0x1468cf(0xbd),'headers':{'Accept':_0x1468cf(0xac),'User-Agent':_0x1468cf(0xeb)}}),_0x22532e=Date['now']()-_0x220cf6;if(!_0x528562['ok']){const _0x24bd7c=await _0x528562[_0x1468cf(0xfd)]();loggerService_1['loggerService'][_0x1468cf(0xa7)](_0x1468cf(0xe9),_0x1468cf(0x96)+_0x12a332,_0x528562[_0x1468cf(0xf5)],_0x24bd7c,_0x22532e);throw new Error(_0x1468cf(0xfa)+_0x528562[_0x1468cf(0xf5)]);}const _0x46990b=await _0x528562[_0x1468cf(0x8e)]();loggerService_1[_0x1468cf(0xb7)][_0x1468cf(0xa7)](_0x1468cf(0xe9),_0x1468cf(0x96)+_0x12a332,_0x528562[_0x1468cf(0xf5)],_0x46990b,_0x22532e);if(_0x46990b[_0x1468cf(0xf5)]!==_0x1468cf(0xf6)){loggerService_1[_0x1468cf(0xb7)][_0x1468cf(0xc3)](_0x1468cf(0xe9),_0x1468cf(0x96)+_0x12a332,_0x1468cf(0xec)+(_0x46990b['message']||_0x46990b[_0x1468cf(0x90)]||'Unknown\x20error'));throw new Error(_0x1468cf(0xec)+(_0x46990b['message']||_0x46990b[_0x1468cf(0x90)]||'Unknown\x20error'));}let _0x59e63c=_0x1468cf(0xaa);return{'status':_0x59e63c};}catch(_0x2deaf1){console[_0x1468cf(0x90)](_0x1468cf(0xca),_0x2deaf1),loggerService_1[_0x1468cf(0xb7)][_0x1468cf(0xc3)]('plisio_direct',_0x1468cf(0x96)+_0x12a332,_0x2deaf1);throw new Error(_0x1468cf(0xf0)+(_0x2deaf1 instanceof Error?_0x2deaf1[_0x1468cf(0xfb)]:_0x1468cf(0xcd)));}}async[a74_0x5845d5(0x9e)](_0x554037){const _0x1d599c=a74_0x5845d5;console[_0x1d599c(0xee)](_0x1d599c(0xa0),_0x554037);let _0x512374=_0x1d599c(0xaa);switch(_0x554037['status']?.['toLowerCase']()){case _0x1d599c(0xc6):case _0x1d599c(0xb9):_0x512374=_0x1d599c(0x93);break;case'expired':_0x512374=_0x1d599c(0xb0);break;case _0x1d599c(0x90):case _0x1d599c(0xd2):_0x512374=_0x1d599c(0xde);break;case _0x1d599c(0x98):_0x512374=_0x1d599c(0xaa);break;case'pending':_0x512374=_0x1d599c(0xdd);break;default:_0x512374=_0x1d599c(0xaa);break;}let _0x1370f1;if(_0x554037[_0x1d599c(0xb1)])try{console[_0x1d599c(0xee)](_0x1d599c(0xbf),_0x554037['tx_urls']);let _0x397975;if(typeof _0x554037['tx_urls']==='string')_0x397975=JSON[_0x1d599c(0xf9)](_0x554037[_0x1d599c(0xb1)]);else Array[_0x1d599c(0xd0)](_0x554037['tx_urls'])?_0x397975=_0x554037[_0x1d599c(0xb1)]:_0x397975=[];_0x1370f1=_0x397975[_0x1d599c(0xd3)](_0x4528ed=>{const _0x3d0bd8=_0x1d599c,_0x3955bd=_0x4528ed[_0x3d0bd8(0xe2)](/\\/g,'');return console['log'](_0x3d0bd8(0xd1)+_0x4528ed+'\x20->\x20'+_0x3955bd),_0x3955bd;}),console[_0x1d599c(0xee)](_0x1d599c(0xa8),_0x1370f1),_0x1370f1[_0x1d599c(0xf8)]((_0x1213c4,_0x35173a)=>{const _0x2e8f30=_0x1d599c;try{new URL(_0x1213c4),console[_0x2e8f30(0xee)]('âœ…\x20URL\x20'+(_0x35173a+0x1)+_0x2e8f30(0xb4)+_0x1213c4);}catch(_0x3c86a7){console[_0x2e8f30(0x90)](_0x2e8f30(0x9b)+(_0x35173a+0x1)+_0x2e8f30(0xfe)+_0x1213c4,_0x3c86a7);}});}catch(_0x11db3f){console[_0x1d599c(0x90)](_0x1d599c(0xdb),_0x11db3f),console[_0x1d599c(0x90)](_0x1d599c(0xa3),_0x554037[_0x1d599c(0xb1)]),_0x1370f1=undefined;}return{'paymentId':_0x554037[_0x1d599c(0xce)]||'','status':_0x512374,'amount':_0x554037[_0x1d599c(0xb8)],'currency':_0x554037['currency'],'txUrls':_0x1370f1};}}exports[a74_0x5845d5(0xe4)]=PlisioService;