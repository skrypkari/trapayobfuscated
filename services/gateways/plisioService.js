'use strict';function a41_0x450e(){const _0x4b6689=['__esModule','HTTP\x20Status:','/invoices/new','PENDING','append','GET','toString','stack','Invoice\x20URL:','statusText','(fiat\x20for\x20merchant)','URL:','message','FAILED','stringify','Status\x20Text:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','28duHmcn','10178ZihUcD','Unknown\x20error','Parsed\x20Result:','Raw\x20Response\x20Body:','Status:','mismatch','https://api.plisio.net/api/v1/operations/','https://api.plisio.net/api/v1/invoices/new','cancelled','Response\x20data:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','5825060xSRuqr','completed','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','===\x20PLISIO\x20SUCCESS\x20===','plisio_direct','logWhiteDomainResponse','status','success','pending','replace','HTTP\x20error!\x20status:\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','/operations/','Response\x20Time:','Plisio\x20API\x20error:\x20','text','data','expired','error','apiKey','Full\x20URL\x20(without\x20API\x20key):','Parameters:','apiUrl','application/json','51738AHbgop','(crypto\x20for\x20payment)','createPayment','loggerService','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','6251960GjERlp','name','2959518kUhYwx','processWebhook','qr_url','2490ssqbfe','Plisio\x20payment\x20verification\x20error:','PlisioService','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','14268896dXlDDW','invoice_total_sum','https://api.trapay.uk/api/webhooks/gateway/plisio','new','TesSoft\x20Payment\x20System/1.0',',\x20body:\x20','Error\x20Message:','HTTP\x20','logWhiteDomainError','amount','currency','===\x20PLISIO\x20API\x20ERROR\x20===','Plisio\x20API\x20key\x20is\x20not\x20configured','Business\x20Error:\x20','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','source_currency','qr_code','Error\x20stack:','Transaction\x20ID:','PLISIO_API_KEY','Source\x20Currency:','PAID','JSON\x20Parse\x20Error:\x20','env','invoice_url','1345970oUIMiW','Target\x20Currency:','toLowerCase','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','fromEntries','../loggerService','now','entries','log','txn_id','18BlHgZu','Processing\x20Plisio\x20webhook:','verifyPayment','order_number','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API'];a41_0x450e=function(){return _0x4b6689;};return a41_0x450e();}function a41_0x17ac(_0x1c9709,_0x1e8ad4){const _0x450e6a=a41_0x450e();return a41_0x17ac=function(_0x17ac06,_0x2715f5){_0x17ac06=_0x17ac06-0x1dc;let _0x42214d=_0x450e6a[_0x17ac06];return _0x42214d;},a41_0x17ac(_0x1c9709,_0x1e8ad4);}const a41_0x41f139=a41_0x17ac;(function(_0x2a6623,_0x454da8){const _0x47a1ed=a41_0x17ac,_0x30ecbd=_0x2a6623();while(!![]){try{const _0x605f47=parseInt(_0x47a1ed(0x1fe))/0x1*(parseInt(_0x47a1ed(0x247))/0x2)+-parseInt(_0x47a1ed(0x206))/0x3+parseInt(_0x47a1ed(0x1e6))/0x4+-parseInt(_0x47a1ed(0x226))/0x5+parseInt(_0x47a1ed(0x209))/0x6*(parseInt(_0x47a1ed(0x248))/0x7)+-parseInt(_0x47a1ed(0x20d))/0x8+-parseInt(_0x47a1ed(0x231))/0x9*(-parseInt(_0x47a1ed(0x204))/0xa);if(_0x605f47===_0x454da8)break;else _0x30ecbd['push'](_0x30ecbd['shift']());}catch(_0x567e05){_0x30ecbd['push'](_0x30ecbd['shift']());}}}(a41_0x450e,0xf2f0f));Object['defineProperty'](exports,a41_0x41f139(0x236),{'value':!![]}),exports[a41_0x41f139(0x20b)]=void 0x0;const loggerService_1=require(a41_0x41f139(0x22c));class PlisioService{constructor(){const _0x4f618f=a41_0x41f139;this[_0x4f618f(0x1fc)]=_0x4f618f(0x1e2),this[_0x4f618f(0x1f9)]=process[_0x4f618f(0x224)][_0x4f618f(0x220)]||'',!this[_0x4f618f(0x1f9)]?console['warn']('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console['log'](_0x4f618f(0x235));}async[a41_0x41f139(0x200)](_0x53b0ae){const _0x2abd6c=a41_0x41f139,{orderId:_0x2c4fc6,amount:_0x54f2e0,currency:_0x26db54,productName:_0x573e11,description:_0x3ea9ef,successUrl:_0x5ae253,failUrl:_0x47055a,customerEmail:_0x23fae0,customerName:_0x53fb0b,isSourceCurrency:_0x14573e,sourceCurrency:_0x108bc1}=_0x53b0ae;if(!this[_0x2abd6c(0x1f9)])throw new Error(_0x2abd6c(0x219));const _0x382215=new URLSearchParams({'api_key':this[_0x2abd6c(0x1f9)],'order_number':_0x2c4fc6,'order_name':_0x573e11,'description':_0x3ea9ef,'success_url':_0x5ae253,'fail_url':_0x47055a,'callback_url':_0x2abd6c(0x20f)});_0x108bc1?(_0x382215['append'](_0x2abd6c(0x217),_0x108bc1),_0x382215[_0x2abd6c(0x23a)](_0x2abd6c(0x21c),_0x26db54),_0x382215[_0x2abd6c(0x23a)]('source_amount',_0x54f2e0[_0x2abd6c(0x23c)]())):(_0x382215[_0x2abd6c(0x23a)]('currency',_0x26db54),_0x382215[_0x2abd6c(0x23a)](_0x2abd6c(0x216),_0x54f2e0[_0x2abd6c(0x23c)]()));_0x23fae0&&_0x382215['append']('email',_0x23fae0);_0x53fb0b&&_0x382215[_0x2abd6c(0x23a)](_0x2abd6c(0x205),_0x53fb0b);const _0x4f140a=this[_0x2abd6c(0x1fc)]+'?'+_0x382215['toString'](),_0x2f6d18=Date[_0x2abd6c(0x22d)]();try{console['log'](_0x2abd6c(0x1e5)),console[_0x2abd6c(0x22f)](_0x2abd6c(0x241),this[_0x2abd6c(0x1fc)]),console[_0x2abd6c(0x22f)](_0x2abd6c(0x1fb),Object['fromEntries'](_0x382215[_0x2abd6c(0x22e)]())),console[_0x2abd6c(0x22f)](_0x2abd6c(0x1fa),_0x4f140a[_0x2abd6c(0x1ef)](this[_0x2abd6c(0x1f9)],'HIDDEN')),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x2abd6c(0x1ea),_0x2abd6c(0x238),_0x2abd6c(0x23b),Object[_0x2abd6c(0x22b)](_0x382215[_0x2abd6c(0x22e)]()));const _0xb22f48=await fetch(_0x4f140a,{'method':'GET','headers':{'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x44c29d=Date['now']()-_0x2f6d18;console['log'](_0x2abd6c(0x229)),console[_0x2abd6c(0x22f)](_0x2abd6c(0x1df),_0xb22f48[_0x2abd6c(0x1ec)]),console['log'](_0x2abd6c(0x245),_0xb22f48[_0x2abd6c(0x23f)]),console[_0x2abd6c(0x22f)](_0x2abd6c(0x1f3),_0x44c29d+'ms');const _0x33944c=await _0xb22f48[_0x2abd6c(0x1f5)]();console[_0x2abd6c(0x22f)](_0x2abd6c(0x1de),_0x33944c);if(!_0xb22f48['ok']){console[_0x2abd6c(0x1f8)](_0x2abd6c(0x218)),console[_0x2abd6c(0x1f8)](_0x2abd6c(0x237),_0xb22f48[_0x2abd6c(0x1ec)]),console['error']('Response\x20Body:',_0x33944c),loggerService_1[_0x2abd6c(0x201)][_0x2abd6c(0x1eb)](_0x2abd6c(0x1ea),_0x2abd6c(0x238),_0xb22f48[_0x2abd6c(0x1ec)],_0x33944c,_0x44c29d),loggerService_1[_0x2abd6c(0x201)][_0x2abd6c(0x215)](_0x2abd6c(0x1ea),_0x2abd6c(0x238),_0x2abd6c(0x214)+_0xb22f48['status']+':\x20'+_0x33944c);throw new Error(_0x2abd6c(0x1f0)+_0xb22f48[_0x2abd6c(0x1ec)]+_0x2abd6c(0x212)+_0x33944c);}let _0x477afd;try{_0x477afd=JSON['parse'](_0x33944c);}catch(_0x459eac){console[_0x2abd6c(0x1f8)](_0x2abd6c(0x202),_0x459eac),loggerService_1[_0x2abd6c(0x201)]['logWhiteDomainError'](_0x2abd6c(0x1ea),_0x2abd6c(0x238),_0x2abd6c(0x223)+_0x459eac);throw new Error(_0x2abd6c(0x246)+_0x33944c);}console['log']('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x2abd6c(0x22f)](_0x2abd6c(0x1dd),JSON[_0x2abd6c(0x244)](_0x477afd,null,0x2)),loggerService_1[_0x2abd6c(0x201)][_0x2abd6c(0x1eb)](_0x2abd6c(0x1ea),'/invoices/new',_0xb22f48['status'],_0x477afd,_0x44c29d);if(_0x477afd[_0x2abd6c(0x1ec)]!=='success'){const _0x3c955b=_0x477afd[_0x2abd6c(0x242)]||_0x477afd[_0x2abd6c(0x1f8)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x2abd6c(0x1f8)](_0x2abd6c(0x21b)),console[_0x2abd6c(0x1f8)](_0x2abd6c(0x213),_0x3c955b),loggerService_1[_0x2abd6c(0x201)][_0x2abd6c(0x215)](_0x2abd6c(0x1ea),'/invoices/new',_0x2abd6c(0x21a)+_0x3c955b);throw new Error(_0x2abd6c(0x1f4)+_0x3c955b);}if(!_0x477afd[_0x2abd6c(0x1f6)]?.[_0x2abd6c(0x230)]||!_0x477afd[_0x2abd6c(0x1f6)]?.[_0x2abd6c(0x225)]){console['error'](_0x2abd6c(0x22a)),console['error']('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x2abd6c(0x1f8)](_0x2abd6c(0x1e4),_0x477afd[_0x2abd6c(0x1f6)]),loggerService_1[_0x2abd6c(0x201)][_0x2abd6c(0x215)](_0x2abd6c(0x1ea),'/invoices/new','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x2abd6c(0x203));}return console[_0x2abd6c(0x22f)](_0x2abd6c(0x1e9)),console[_0x2abd6c(0x22f)](_0x2abd6c(0x21f),_0x477afd[_0x2abd6c(0x1f6)][_0x2abd6c(0x230)]),console['log'](_0x2abd6c(0x23e),_0x477afd[_0x2abd6c(0x1f6)][_0x2abd6c(0x225)]),console[_0x2abd6c(0x22f)]('Amount:',_0x54f2e0,_0x26db54),_0x108bc1&&(console[_0x2abd6c(0x22f)](_0x2abd6c(0x221),_0x108bc1,_0x2abd6c(0x1ff)),console[_0x2abd6c(0x22f)](_0x2abd6c(0x227),_0x26db54,_0x2abd6c(0x240))),{'gateway_payment_id':_0x477afd[_0x2abd6c(0x1f6)][_0x2abd6c(0x230)],'payment_url':_0x477afd[_0x2abd6c(0x1f6)][_0x2abd6c(0x225)],'invoice_total_sum':_0x477afd[_0x2abd6c(0x1f6)][_0x2abd6c(0x20e)],'qr_code':_0x477afd[_0x2abd6c(0x1f6)][_0x2abd6c(0x21d)],'qr_url':_0x477afd[_0x2abd6c(0x1f6)][_0x2abd6c(0x208)]};}catch(_0x42513d){console[_0x2abd6c(0x1f8)](_0x2abd6c(0x1e8)),console[_0x2abd6c(0x1f8)]('Error\x20details:',_0x42513d),loggerService_1[_0x2abd6c(0x201)][_0x2abd6c(0x215)](_0x2abd6c(0x1ea),_0x2abd6c(0x238),_0x42513d);if(_0x42513d instanceof Error){console[_0x2abd6c(0x1f8)]('Error\x20message:',_0x42513d['message']),console[_0x2abd6c(0x1f8)](_0x2abd6c(0x21e),_0x42513d[_0x2abd6c(0x23d)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x42513d[_0x2abd6c(0x242)]);}throw new Error(_0x2abd6c(0x1f1));}}async[a41_0x41f139(0x233)](_0x524e5b){const _0xca857e=a41_0x41f139,_0x1a0ae4=Date[_0xca857e(0x22d)]();try{if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x5dd71c=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x524e5b}),_0x576004=_0xca857e(0x1e1)+_0x524e5b+'?'+_0x5dd71c['toString']();loggerService_1[_0xca857e(0x201)]['logWhiteDomainRequest']('plisio_direct','/operations/'+_0x524e5b,_0xca857e(0x23b),Object[_0xca857e(0x22b)](_0x5dd71c['entries']()));const _0x22ba57=await fetch(_0x576004,{'method':'GET','headers':{'Accept':_0xca857e(0x1fd),'User-Agent':_0xca857e(0x211)}}),_0x4a9aa0=Date[_0xca857e(0x22d)]()-_0x1a0ae4;if(!_0x22ba57['ok']){const _0xa90827=await _0x22ba57[_0xca857e(0x1f5)]();loggerService_1[_0xca857e(0x201)]['logWhiteDomainResponse'](_0xca857e(0x1ea),'/operations/'+_0x524e5b,_0x22ba57[_0xca857e(0x1ec)],_0xa90827,_0x4a9aa0);throw new Error(_0xca857e(0x1f0)+_0x22ba57[_0xca857e(0x1ec)]);}const _0x287d60=await _0x22ba57['json']();loggerService_1[_0xca857e(0x201)][_0xca857e(0x1eb)](_0xca857e(0x1ea),_0xca857e(0x1f2)+_0x524e5b,_0x22ba57[_0xca857e(0x1ec)],_0x287d60,_0x4a9aa0);if(_0x287d60[_0xca857e(0x1ec)]!==_0xca857e(0x1ed)){loggerService_1[_0xca857e(0x201)][_0xca857e(0x215)](_0xca857e(0x1ea),_0xca857e(0x1f2)+_0x524e5b,'Plisio\x20API\x20error:\x20'+(_0x287d60[_0xca857e(0x242)]||_0x287d60[_0xca857e(0x1f8)]||_0xca857e(0x1dc)));throw new Error(_0xca857e(0x1f4)+(_0x287d60[_0xca857e(0x242)]||_0x287d60['error']||'Unknown\x20error'));}let _0x583c6d=_0xca857e(0x239);return{'status':_0x583c6d};}catch(_0xe62589){console['error'](_0xca857e(0x20a),_0xe62589),loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct',_0xca857e(0x1f2)+_0x524e5b,_0xe62589);throw new Error(_0xca857e(0x20c)+(_0xe62589 instanceof Error?_0xe62589['message']:_0xca857e(0x1dc)));}}async[a41_0x41f139(0x207)](_0x4e118c){const _0x5ad38e=a41_0x41f139;console[_0x5ad38e(0x22f)](_0x5ad38e(0x232),_0x4e118c);let _0x4b5b75=_0x5ad38e(0x239);switch(_0x4e118c[_0x5ad38e(0x1ec)]?.[_0x5ad38e(0x228)]()){case _0x5ad38e(0x1e7):case _0x5ad38e(0x1e0):_0x4b5b75=_0x5ad38e(0x222);break;case _0x5ad38e(0x1f7):_0x4b5b75='EXPIRED';break;case _0x5ad38e(0x1f8):case _0x5ad38e(0x1e3):_0x4b5b75=_0x5ad38e(0x243);break;case _0x5ad38e(0x210):case _0x5ad38e(0x1ee):default:_0x4b5b75=_0x5ad38e(0x239);break;}return{'paymentId':_0x4e118c[_0x5ad38e(0x234)]||'','status':_0x4b5b75,'amount':_0x4e118c[_0x5ad38e(0x216)],'currency':_0x4e118c['currency']};}}exports[a41_0x41f139(0x20b)]=PlisioService;