'use strict';const a47_0x785ee6=a47_0x2d6c;function a47_0xcec6(){const _0x41a9d7=['toString','logWhiteDomainResponse','Error\x20details:','parse','success','text','FAILED','Business\x20Error:\x20','Full\x20URL\x20(without\x20API\x20key):','txn_id','Response\x20data:','(fiat\x20for\x20merchant)','../loggerService','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','now','‚úÖ\x20Processed\x20tx_urls:','expired','\x20->\x20','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','logWhiteDomainError','tx_urls','https://api.plisio.net/api/v1/operations/','18kNDbLM','defineProperty','plisio_direct','source_amount','63684BnLyxt','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Plisio\x20API\x20error:\x20','new','Raw\x20Response\x20Body:','Status:','warn','Plisio\x20API\x20key\x20is\x20not\x20configured','qr_url','fromEntries','PENDING','source_currency','3648444sEFUFM','cancelled','PlisioService','qr_code','loggerService','Invoice\x20URL:','830310ARLhvP','Unknown\x20error','Error\x20message:','üîó\x20Formatted\x20URL:\x20','Error\x20stack:','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Error\x20Message:','/operations/','34097327TeQgvE','completed','PROCESSING','3584376MusdLc','pending','apiUrl','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','statusText','Target\x20Currency:','invoice_total_sum','env','Amount:','GET','stack','currency','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','HTTP\x20Status:','createPayment','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','isArray','entries','EXPIRED','407410AFqrGd','error','12JhVPKN','643929gIcEeF','processWebhook','\x20is\x20invalid:\x20','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','1130QZijjM','Plisio\x20payment\x20verification\x20error:','order_number','forEach','/invoices/new','mismatch','status','https://api.trapay.uk/api/webhooks/gateway/plisio','‚ùå\x20URL\x20','apiKey','‚úÖ\x20URL\x20','data','email','amount','Failed\x20to\x20parse\x20JSON\x20response:','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','append','\x20is\x20valid:\x20','application/json','TesSoft\x20Payment\x20System/1.0','invoice_url','stringify','Status\x20Text:','logWhiteDomainRequest','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','7uCTNHd','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','HTTP\x20','toLowerCase','message','log','name','replace','string','(crypto\x20for\x20payment)','map','===\x20PLISIO\x20API\x20ERROR\x20===','JSON\x20Parse\x20Error:\x20','5DQXzil','URL:'];a47_0xcec6=function(){return _0x41a9d7;};return a47_0xcec6();}(function(_0x242b29,_0x41b596){const _0x524779=a47_0x2d6c,_0xec84f6=_0x242b29();while(!![]){try{const _0xcfb434=-parseInt(_0x524779(0x1b0))/0x1+parseInt(_0x524779(0x1ad))/0x2*(-parseInt(_0x524779(0x179))/0x3)+-parseInt(_0x524779(0x189))/0x4*(-parseInt(_0x524779(0x161))/0x5)+-parseInt(_0x524779(0x18f))/0x6*(parseInt(_0x524779(0x152))/0x7)+-parseInt(_0x524779(0x19a))/0x8+parseInt(_0x524779(0x17d))/0x9*(-parseInt(_0x524779(0x1b4))/0xa)+parseInt(_0x524779(0x197))/0xb*(parseInt(_0x524779(0x1af))/0xc);if(_0xcfb434===_0x41b596)break;else _0xec84f6['push'](_0xec84f6['shift']());}catch(_0x5b5379){_0xec84f6['push'](_0xec84f6['shift']());}}}(a47_0xcec6,0xb9789));Object[a47_0x785ee6(0x17a)](exports,'__esModule',{'value':!![]}),exports['PlisioService']=void 0x0;function a47_0x2d6c(_0x5790c5,_0x129cfb){const _0xcec64=a47_0xcec6();return a47_0x2d6c=function(_0x2d6c69,_0x29a936){_0x2d6c69=_0x2d6c69-0x139;let _0xaafdae=_0xcec64[_0x2d6c69];return _0xaafdae;},a47_0x2d6c(_0x5790c5,_0x129cfb);}const loggerService_1=require(a47_0x785ee6(0x16f));class PlisioService{constructor(){const _0xf6f669=a47_0x785ee6;this[_0xf6f669(0x19c)]='https://api.plisio.net/api/v1/invoices/new',this[_0xf6f669(0x141)]=process[_0xf6f669(0x1a1)]['PLISIO_API_KEY']||'',!this[_0xf6f669(0x141)]?console[_0xf6f669(0x183)](_0xf6f669(0x155)):console[_0xf6f669(0x159)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a47_0x785ee6(0x1a8)](_0x2dd7a6){const _0x1bc89f=a47_0x785ee6,{orderId:_0x4a869b,amount:_0xc7fed9,currency:_0x532d3d,productName:_0x54d151,description:_0x1833a2,successUrl:_0x4ed075,failUrl:_0x21668b,customerEmail:_0x4a8ed0,customerName:_0x1220d1,isSourceCurrency:_0x2a5e10,sourceCurrency:_0x45f111}=_0x2dd7a6;if(!this[_0x1bc89f(0x141)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x5b4ee7=new URLSearchParams({'api_key':this[_0x1bc89f(0x141)],'order_number':_0x4a869b,'order_name':_0x54d151,'description':_0x1833a2,'success_url':_0x4ed075,'fail_url':_0x21668b,'callback_url':_0x1bc89f(0x13f)});_0x45f111?(_0x5b4ee7[_0x1bc89f(0x148)](_0x1bc89f(0x1a5),_0x45f111),_0x5b4ee7[_0x1bc89f(0x148)](_0x1bc89f(0x188),_0x532d3d),_0x5b4ee7[_0x1bc89f(0x148)](_0x1bc89f(0x17c),_0xc7fed9[_0x1bc89f(0x163)]())):(_0x5b4ee7[_0x1bc89f(0x148)](_0x1bc89f(0x1a5),_0x532d3d),_0x5b4ee7[_0x1bc89f(0x148)](_0x1bc89f(0x145),_0xc7fed9[_0x1bc89f(0x163)]()));_0x4a8ed0&&_0x5b4ee7[_0x1bc89f(0x148)](_0x1bc89f(0x144),_0x4a8ed0);_0x1220d1&&_0x5b4ee7[_0x1bc89f(0x148)](_0x1bc89f(0x15a),_0x1220d1);const _0x5d6cf0=this[_0x1bc89f(0x19c)]+'?'+_0x5b4ee7[_0x1bc89f(0x163)](),_0xbd1863=Date[_0x1bc89f(0x171)]();try{console[_0x1bc89f(0x159)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x1bc89f(0x159)](_0x1bc89f(0x162),this[_0x1bc89f(0x19c)]),console[_0x1bc89f(0x159)]('Parameters:',Object[_0x1bc89f(0x186)](_0x5b4ee7[_0x1bc89f(0x1ab)]())),console[_0x1bc89f(0x159)](_0x1bc89f(0x16b),_0x5d6cf0['replace'](this[_0x1bc89f(0x141)],'HIDDEN')),loggerService_1[_0x1bc89f(0x18d)][_0x1bc89f(0x14f)](_0x1bc89f(0x17b),'/invoices/new',_0x1bc89f(0x1a3),Object[_0x1bc89f(0x186)](_0x5b4ee7[_0x1bc89f(0x1ab)]()));const _0xbc78d8=await fetch(_0x5d6cf0,{'method':_0x1bc89f(0x1a3),'headers':{'Accept':_0x1bc89f(0x14a),'User-Agent':_0x1bc89f(0x14b)}}),_0x98655a=Date[_0x1bc89f(0x171)]()-_0xbd1863;console[_0x1bc89f(0x159)](_0x1bc89f(0x175)),console[_0x1bc89f(0x159)](_0x1bc89f(0x182),_0xbc78d8[_0x1bc89f(0x13e)]),console['log'](_0x1bc89f(0x14e),_0xbc78d8[_0x1bc89f(0x19e)]),console[_0x1bc89f(0x159)]('Response\x20Time:',_0x98655a+'ms');const _0x1248e6=await _0xbc78d8['text']();console['log'](_0x1bc89f(0x181),_0x1248e6);if(!_0xbc78d8['ok']){console[_0x1bc89f(0x1ae)](_0x1bc89f(0x15f)),console['error'](_0x1bc89f(0x1a7),_0xbc78d8[_0x1bc89f(0x13e)]),console['error']('Response\x20Body:',_0x1248e6),loggerService_1[_0x1bc89f(0x18d)][_0x1bc89f(0x164)](_0x1bc89f(0x17b),_0x1bc89f(0x13c),_0xbc78d8[_0x1bc89f(0x13e)],_0x1248e6,_0x98655a),loggerService_1['loggerService'][_0x1bc89f(0x176)](_0x1bc89f(0x17b),_0x1bc89f(0x13c),_0x1bc89f(0x156)+_0xbc78d8[_0x1bc89f(0x13e)]+':\x20'+_0x1248e6);throw new Error(_0x1bc89f(0x151)+_0xbc78d8['status']+',\x20body:\x20'+_0x1248e6);}let _0x385b40;try{_0x385b40=JSON[_0x1bc89f(0x166)](_0x1248e6);}catch(_0x38a10f){console[_0x1bc89f(0x1ae)](_0x1bc89f(0x146),_0x38a10f),loggerService_1[_0x1bc89f(0x18d)][_0x1bc89f(0x176)](_0x1bc89f(0x17b),_0x1bc89f(0x13c),_0x1bc89f(0x160)+_0x38a10f);throw new Error(_0x1bc89f(0x170)+_0x1248e6);}console[_0x1bc89f(0x159)](_0x1bc89f(0x194)),console[_0x1bc89f(0x159)]('Parsed\x20Result:',JSON[_0x1bc89f(0x14d)](_0x385b40,null,0x2)),loggerService_1[_0x1bc89f(0x18d)]['logWhiteDomainResponse']('plisio_direct',_0x1bc89f(0x13c),_0xbc78d8[_0x1bc89f(0x13e)],_0x385b40,_0x98655a);if(_0x385b40[_0x1bc89f(0x13e)]!==_0x1bc89f(0x167)){const _0x4ca7a6=_0x385b40[_0x1bc89f(0x158)]||_0x385b40[_0x1bc89f(0x1ae)]||'Unknown\x20error\x20from\x20Plisio\x20API';console['error'](_0x1bc89f(0x150)),console[_0x1bc89f(0x1ae)](_0x1bc89f(0x195),_0x4ca7a6),loggerService_1[_0x1bc89f(0x18d)]['logWhiteDomainError'](_0x1bc89f(0x17b),'/invoices/new',_0x1bc89f(0x16a)+_0x4ca7a6);throw new Error(_0x1bc89f(0x17f)+_0x4ca7a6);}if(!_0x385b40[_0x1bc89f(0x143)]?.[_0x1bc89f(0x16c)]||!_0x385b40[_0x1bc89f(0x143)]?.['invoice_url']){console[_0x1bc89f(0x1ae)](_0x1bc89f(0x1b3)),console['error']('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x1bc89f(0x1ae)](_0x1bc89f(0x16d),_0x385b40['data']),loggerService_1['loggerService'][_0x1bc89f(0x176)]('plisio_direct',_0x1bc89f(0x13c),_0x1bc89f(0x154));throw new Error(_0x1bc89f(0x1a9));}return console[_0x1bc89f(0x159)]('===\x20PLISIO\x20SUCCESS\x20==='),console['log']('Transaction\x20ID:',_0x385b40[_0x1bc89f(0x143)][_0x1bc89f(0x16c)]),console[_0x1bc89f(0x159)](_0x1bc89f(0x18e),_0x385b40[_0x1bc89f(0x143)][_0x1bc89f(0x14c)]),console[_0x1bc89f(0x159)](_0x1bc89f(0x1a2),_0xc7fed9,_0x532d3d),_0x45f111&&(console['log']('Source\x20Currency:',_0x45f111,_0x1bc89f(0x15d)),console[_0x1bc89f(0x159)](_0x1bc89f(0x19f),_0x532d3d,_0x1bc89f(0x16e))),{'gateway_payment_id':_0x385b40['data'][_0x1bc89f(0x16c)],'payment_url':_0x385b40[_0x1bc89f(0x143)][_0x1bc89f(0x14c)],'invoice_total_sum':_0x385b40[_0x1bc89f(0x143)][_0x1bc89f(0x1a0)],'qr_code':_0x385b40[_0x1bc89f(0x143)][_0x1bc89f(0x18c)],'qr_url':_0x385b40[_0x1bc89f(0x143)][_0x1bc89f(0x185)]};}catch(_0x1731c2){console['error'](_0x1bc89f(0x147)),console[_0x1bc89f(0x1ae)](_0x1bc89f(0x165),_0x1731c2),loggerService_1[_0x1bc89f(0x18d)]['logWhiteDomainError'](_0x1bc89f(0x17b),_0x1bc89f(0x13c),_0x1731c2);if(_0x1731c2 instanceof Error){console[_0x1bc89f(0x1ae)](_0x1bc89f(0x191),_0x1731c2[_0x1bc89f(0x158)]),console[_0x1bc89f(0x1ae)](_0x1bc89f(0x193),_0x1731c2[_0x1bc89f(0x1a4)]);throw new Error(_0x1bc89f(0x153)+_0x1731c2[_0x1bc89f(0x158)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async['verifyPayment'](_0x50207e){const _0x560e4c=a47_0x785ee6,_0x3470ad=Date[_0x560e4c(0x171)]();try{if(!this[_0x560e4c(0x141)])throw new Error(_0x560e4c(0x184));const _0x34d0ef=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x50207e}),_0x2245aa=_0x560e4c(0x178)+_0x50207e+'?'+_0x34d0ef[_0x560e4c(0x163)]();loggerService_1[_0x560e4c(0x18d)][_0x560e4c(0x14f)](_0x560e4c(0x17b),_0x560e4c(0x196)+_0x50207e,'GET',Object[_0x560e4c(0x186)](_0x34d0ef[_0x560e4c(0x1ab)]()));const _0x525b86=await fetch(_0x2245aa,{'method':_0x560e4c(0x1a3),'headers':{'Accept':_0x560e4c(0x14a),'User-Agent':_0x560e4c(0x14b)}}),_0x1e0e11=Date[_0x560e4c(0x171)]()-_0x3470ad;if(!_0x525b86['ok']){const _0x177f2c=await _0x525b86[_0x560e4c(0x168)]();loggerService_1[_0x560e4c(0x18d)][_0x560e4c(0x164)](_0x560e4c(0x17b),_0x560e4c(0x196)+_0x50207e,_0x525b86[_0x560e4c(0x13e)],_0x177f2c,_0x1e0e11);throw new Error('HTTP\x20error!\x20status:\x20'+_0x525b86[_0x560e4c(0x13e)]);}const _0x350a9a=await _0x525b86['json']();loggerService_1[_0x560e4c(0x18d)][_0x560e4c(0x164)](_0x560e4c(0x17b),_0x560e4c(0x196)+_0x50207e,_0x525b86[_0x560e4c(0x13e)],_0x350a9a,_0x1e0e11);if(_0x350a9a[_0x560e4c(0x13e)]!==_0x560e4c(0x167)){loggerService_1['loggerService']['logWhiteDomainError'](_0x560e4c(0x17b),'/operations/'+_0x50207e,_0x560e4c(0x17f)+(_0x350a9a[_0x560e4c(0x158)]||_0x350a9a[_0x560e4c(0x1ae)]||_0x560e4c(0x190)));throw new Error(_0x560e4c(0x17f)+(_0x350a9a[_0x560e4c(0x158)]||_0x350a9a[_0x560e4c(0x1ae)]||'Unknown\x20error'));}let _0x467c26=_0x560e4c(0x187);return{'status':_0x467c26};}catch(_0x1199fa){console[_0x560e4c(0x1ae)](_0x560e4c(0x139),_0x1199fa),loggerService_1[_0x560e4c(0x18d)][_0x560e4c(0x176)](_0x560e4c(0x17b),_0x560e4c(0x196)+_0x50207e,_0x1199fa);throw new Error(_0x560e4c(0x1a6)+(_0x1199fa instanceof Error?_0x1199fa[_0x560e4c(0x158)]:_0x560e4c(0x190)));}}async[a47_0x785ee6(0x1b1)](_0x49a684){const _0x1bac96=a47_0x785ee6;console['log']('Processing\x20Plisio\x20webhook:',_0x49a684);let _0x857adf=_0x1bac96(0x187);switch(_0x49a684[_0x1bac96(0x13e)]?.[_0x1bac96(0x157)]()){case _0x1bac96(0x198):case _0x1bac96(0x13d):_0x857adf='PAID';break;case _0x1bac96(0x173):_0x857adf=_0x1bac96(0x1ac);break;case _0x1bac96(0x1ae):case _0x1bac96(0x18a):_0x857adf=_0x1bac96(0x169);break;case _0x1bac96(0x180):_0x857adf=_0x1bac96(0x187);break;case _0x1bac96(0x19b):_0x857adf=_0x1bac96(0x199);break;default:_0x857adf='PENDING';break;}let _0x44d48a;if(_0x49a684[_0x1bac96(0x177)])try{console[_0x1bac96(0x159)](_0x1bac96(0x17e),_0x49a684[_0x1bac96(0x177)]);let _0x284ce0;if(typeof _0x49a684['tx_urls']===_0x1bac96(0x15c))_0x284ce0=JSON['parse'](_0x49a684[_0x1bac96(0x177)]);else Array[_0x1bac96(0x1aa)](_0x49a684[_0x1bac96(0x177)])?_0x284ce0=_0x49a684['tx_urls']:_0x284ce0=[];_0x44d48a=_0x284ce0[_0x1bac96(0x15e)](_0x1f9e04=>{const _0x171b7d=_0x1bac96,_0x42dda6=_0x1f9e04[_0x171b7d(0x15b)](/\\/g,'');return console[_0x171b7d(0x159)](_0x171b7d(0x192)+_0x1f9e04+_0x171b7d(0x174)+_0x42dda6),_0x42dda6;}),console['log'](_0x1bac96(0x172),_0x44d48a),_0x44d48a[_0x1bac96(0x13b)]((_0x326af7,_0xa03b7a)=>{const _0x4da939=_0x1bac96;try{new URL(_0x326af7),console[_0x4da939(0x159)](_0x4da939(0x142)+(_0xa03b7a+0x1)+_0x4da939(0x149)+_0x326af7);}catch(_0x2c8cdd){console[_0x4da939(0x1ae)](_0x4da939(0x140)+(_0xa03b7a+0x1)+_0x4da939(0x1b2)+_0x326af7,_0x2c8cdd);}});}catch(_0x38a3cc){console[_0x1bac96(0x1ae)](_0x1bac96(0x19d),_0x38a3cc),console[_0x1bac96(0x1ae)]('Raw\x20tx_urls\x20data:',_0x49a684[_0x1bac96(0x177)]),_0x44d48a=undefined;}return{'paymentId':_0x49a684[_0x1bac96(0x13a)]||'','status':_0x857adf,'amount':_0x49a684[_0x1bac96(0x145)],'currency':_0x49a684[_0x1bac96(0x1a5)],'txUrls':_0x44d48a};}}exports[a47_0x785ee6(0x18b)]=PlisioService;