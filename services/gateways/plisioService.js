'use strict';const a55_0x39b900=a55_0x50ee;(function(_0x4f84c6,_0x205ff3){const _0x1ef45d=a55_0x50ee,_0x32b114=_0x4f84c6();while(!![]){try{const _0x2c0518=parseInt(_0x1ef45d(0x141))/0x1*(parseInt(_0x1ef45d(0x11c))/0x2)+-parseInt(_0x1ef45d(0x177))/0x3+-parseInt(_0x1ef45d(0x12a))/0x4*(-parseInt(_0x1ef45d(0x186))/0x5)+-parseInt(_0x1ef45d(0x150))/0x6+parseInt(_0x1ef45d(0x15a))/0x7+parseInt(_0x1ef45d(0x14a))/0x8*(parseInt(_0x1ef45d(0x12f))/0x9)+parseInt(_0x1ef45d(0x151))/0xa*(-parseInt(_0x1ef45d(0x156))/0xb);if(_0x2c0518===_0x205ff3)break;else _0x32b114['push'](_0x32b114['shift']());}catch(_0xf94193){_0x32b114['push'](_0x32b114['shift']());}}}(a55_0x524f,0x3de0a));function a55_0x524f(){const _0x26b909=['(fiat\x20for\x20merchant)','Failed\x20to\x20parse\x20JSON\x20response:','2799SQwwNM','/operations/','Raw\x20tx_urls\x20data:','completed','statusText','qr_code','invoice_url','isArray','logWhiteDomainRequest','Plisio\x20API\x20key\x20is\x20not\x20configured','error','defineProperty','parse','Transaction\x20ID:','data','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Amount:','JSON\x20Parse\x20Error:\x20','90809PzjYRS','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','now','cancelled','PROCESSING','log','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Error\x20message:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','12968ojGBBm','Error\x20Message:','verifyPayment','loggerService','createPayment','txn_id','721182nfXLPU','1150760hDZslq','amount','Source\x20Currency:','Error\x20details:','toLowerCase','66RRpeAD','replace','email','PLISIO_API_KEY','2585030VqnFWH','\x20is\x20valid:\x20','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','https://api.plisio.net/api/v1/operations/','\x20is\x20invalid:\x20','name','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','PENDING','(crypto\x20for\x20payment)','new','Payment\x20System/1.0','qr_url','Response\x20Time:','map','Parsed\x20Result:','currency','application/json','success','Processing\x20Plisio\x20webhook:','source_amount','entries','Invoice\x20URL:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Unknown\x20error\x20from\x20Plisio\x20API','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','stack','Failed\x20to\x20create\x20Plisio\x20payment:\x20','605346yblXOG','Unknown\x20error','string','message','HTTP\x20Status:','Error\x20stack:','append','Status\x20Text:','status','PAID','Full\x20URL\x20(without\x20API\x20key):','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','/invoices/new','toString','invoice_total_sum','146140zCThyB','logWhiteDomainResponse','forEach','‚ùå\x20URL\x20','apiUrl','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','warn','Raw\x20Response\x20Body:','tx_urls','\x20->\x20','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','8SyAsTm','Plisio\x20API\x20error:\x20','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','plisio_direct','EXPIRED','apiKey','logWhiteDomainError','fromEntries','URL:','‚úÖ\x20Processed\x20tx_urls:','json','GET','text',',\x20body:\x20','4pQCUUn','HTTP\x20error!\x20status:\x20','Plisio\x20payment\x20verification\x20error:'];a55_0x524f=function(){return _0x26b909;};return a55_0x524f();}Object[a55_0x39b900(0x13a)](exports,'__esModule',{'value':!![]}),exports['PlisioService']=void 0x0;function a55_0x50ee(_0x3962f1,_0x2d2f3a){const _0x524fe8=a55_0x524f();return a55_0x50ee=function(_0x50ee4e,_0x3a5d7d){_0x50ee4e=_0x50ee4e-0x113;let _0xc32425=_0x524fe8[_0x50ee4e];return _0xc32425;},a55_0x50ee(_0x3962f1,_0x2d2f3a);}const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x2ac4dd=a55_0x39b900;this[_0x2ac4dd(0x114)]='https://api.plisio.net/api/v1/invoices/new',this[_0x2ac4dd(0x121)]=process['env'][_0x2ac4dd(0x159)]||'',!this[_0x2ac4dd(0x121)]?console[_0x2ac4dd(0x117)](_0x2ac4dd(0x115)):console['log'](_0x2ac4dd(0x182));}async[a55_0x39b900(0x14e)](_0x5ed891){const _0x14607b=a55_0x39b900,{orderId:_0x497fef,amount:_0x5bd612,currency:_0x2bbc5c,productName:_0x4fc170,description:_0x4304d1,successUrl:_0x136081,failUrl:_0x4d6fe3,customerEmail:_0x21275a,customerName:_0xf20780,isSourceCurrency:_0x5242f3,sourceCurrency:_0x375051}=_0x5ed891;if(!this[_0x14607b(0x121)])throw new Error(_0x14607b(0x138));const _0x261e34=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x497fef,'order_name':_0x4fc170,'description':_0x4304d1,'success_url':_0x136081,'fail_url':_0x4d6fe3,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x375051?(_0x261e34[_0x14607b(0x17d)](_0x14607b(0x16a),_0x375051),_0x261e34[_0x14607b(0x17d)]('source_currency',_0x2bbc5c),_0x261e34[_0x14607b(0x17d)](_0x14607b(0x16e),_0x5bd612['toString']())):(_0x261e34[_0x14607b(0x17d)](_0x14607b(0x16a),_0x2bbc5c),_0x261e34['append']('amount',_0x5bd612[_0x14607b(0x184)]()));_0x21275a&&_0x261e34[_0x14607b(0x17d)](_0x14607b(0x158),_0x21275a);_0xf20780&&_0x261e34[_0x14607b(0x17d)](_0x14607b(0x15f),_0xf20780);const _0xf89276=this[_0x14607b(0x114)]+'?'+_0x261e34['toString'](),_0x3ec231=Date[_0x14607b(0x143)]();try{console[_0x14607b(0x146)](_0x14607b(0x149)),console['log'](_0x14607b(0x124),this[_0x14607b(0x114)]),console[_0x14607b(0x146)]('Parameters:',Object['fromEntries'](_0x261e34[_0x14607b(0x16f)]())),console[_0x14607b(0x146)](_0x14607b(0x181),_0xf89276['replace'](this[_0x14607b(0x121)],'HIDDEN')),loggerService_1[_0x14607b(0x14d)][_0x14607b(0x137)](_0x14607b(0x11f),_0x14607b(0x183),_0x14607b(0x127),Object[_0x14607b(0x123)](_0x261e34[_0x14607b(0x16f)]()));const _0x48efb1=await fetch(_0xf89276,{'method':_0x14607b(0x127),'headers':{'Accept':'application/json','User-Agent':_0x14607b(0x165)}}),_0x206473=Date[_0x14607b(0x143)]()-_0x3ec231;console[_0x14607b(0x146)](_0x14607b(0x172)),console[_0x14607b(0x146)]('Status:',_0x48efb1['status']),console['log'](_0x14607b(0x17e),_0x48efb1[_0x14607b(0x133)]),console[_0x14607b(0x146)](_0x14607b(0x167),_0x206473+'ms');const _0xc15875=await _0x48efb1[_0x14607b(0x128)]();console[_0x14607b(0x146)](_0x14607b(0x118),_0xc15875);if(!_0x48efb1['ok']){console['error']('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error'](_0x14607b(0x17b),_0x48efb1[_0x14607b(0x17f)]),console[_0x14607b(0x139)]('Response\x20Body:',_0xc15875),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x14607b(0x11f),_0x14607b(0x183),_0x48efb1[_0x14607b(0x17f)],_0xc15875,_0x206473),loggerService_1['loggerService'][_0x14607b(0x122)](_0x14607b(0x11f),_0x14607b(0x183),'HTTP\x20'+_0x48efb1['status']+':\x20'+_0xc15875);throw new Error(_0x14607b(0x12b)+_0x48efb1['status']+_0x14607b(0x129)+_0xc15875);}let _0xac5f48;try{_0xac5f48=JSON['parse'](_0xc15875);}catch(_0x4de8c5){console['error'](_0x14607b(0x12e),_0x4de8c5),loggerService_1['loggerService'][_0x14607b(0x122)]('plisio_direct',_0x14607b(0x183),_0x14607b(0x140)+_0x4de8c5);throw new Error(_0x14607b(0x160)+_0xc15875);}console[_0x14607b(0x146)](_0x14607b(0x13e)),console['log'](_0x14607b(0x169),JSON['stringify'](_0xac5f48,null,0x2)),loggerService_1[_0x14607b(0x14d)]['logWhiteDomainResponse'](_0x14607b(0x11f),_0x14607b(0x183),_0x48efb1[_0x14607b(0x17f)],_0xac5f48,_0x206473);if(_0xac5f48[_0x14607b(0x17f)]!=='success'){const _0x260079=_0xac5f48['message']||_0xac5f48['error']||_0x14607b(0x173);console[_0x14607b(0x139)](_0x14607b(0x161)),console[_0x14607b(0x139)](_0x14607b(0x14b),_0x260079),loggerService_1[_0x14607b(0x14d)][_0x14607b(0x122)](_0x14607b(0x11f),_0x14607b(0x183),'Business\x20Error:\x20'+_0x260079);throw new Error(_0x14607b(0x11d)+_0x260079);}if(!_0xac5f48[_0x14607b(0x13d)]?.[_0x14607b(0x14f)]||!_0xac5f48['data']?.[_0x14607b(0x135)]){console[_0x14607b(0x139)](_0x14607b(0x142)),console[_0x14607b(0x139)](_0x14607b(0x174)),console[_0x14607b(0x139)]('Response\x20data:',_0xac5f48[_0x14607b(0x13d)]),loggerService_1[_0x14607b(0x14d)]['logWhiteDomainError'](_0x14607b(0x11f),_0x14607b(0x183),_0x14607b(0x171));throw new Error(_0x14607b(0x147));}return console[_0x14607b(0x146)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x14607b(0x146)](_0x14607b(0x13c),_0xac5f48[_0x14607b(0x13d)]['txn_id']),console[_0x14607b(0x146)](_0x14607b(0x170),_0xac5f48['data'][_0x14607b(0x135)]),console[_0x14607b(0x146)](_0x14607b(0x13f),_0x5bd612,_0x2bbc5c),_0x375051&&(console[_0x14607b(0x146)](_0x14607b(0x153),_0x375051,_0x14607b(0x163)),console[_0x14607b(0x146)]('Target\x20Currency:',_0x2bbc5c,_0x14607b(0x12d))),{'gateway_payment_id':_0xac5f48[_0x14607b(0x13d)]['txn_id'],'payment_url':_0xac5f48[_0x14607b(0x13d)][_0x14607b(0x135)],'invoice_total_sum':_0xac5f48[_0x14607b(0x13d)][_0x14607b(0x185)],'qr_code':_0xac5f48[_0x14607b(0x13d)][_0x14607b(0x134)],'qr_url':_0xac5f48[_0x14607b(0x13d)][_0x14607b(0x166)]};}catch(_0x4ea16e){console[_0x14607b(0x139)](_0x14607b(0x15c)),console[_0x14607b(0x139)](_0x14607b(0x154),_0x4ea16e),loggerService_1[_0x14607b(0x14d)][_0x14607b(0x122)](_0x14607b(0x11f),_0x14607b(0x183),_0x4ea16e);if(_0x4ea16e instanceof Error){console[_0x14607b(0x139)](_0x14607b(0x148),_0x4ea16e[_0x14607b(0x17a)]),console[_0x14607b(0x139)](_0x14607b(0x17c),_0x4ea16e[_0x14607b(0x175)]);throw new Error(_0x14607b(0x176)+_0x4ea16e[_0x14607b(0x17a)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a55_0x39b900(0x14c)](_0x3b459e){const _0x319642=a55_0x39b900,_0x233eb1=Date[_0x319642(0x143)]();try{if(!this[_0x319642(0x121)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x50eec7=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x3b459e}),_0x42f91e=_0x319642(0x15d)+_0x3b459e+'?'+_0x50eec7[_0x319642(0x184)]();loggerService_1['loggerService'][_0x319642(0x137)](_0x319642(0x11f),_0x319642(0x130)+_0x3b459e,_0x319642(0x127),Object[_0x319642(0x123)](_0x50eec7[_0x319642(0x16f)]()));const _0x2af460=await fetch(_0x42f91e,{'method':_0x319642(0x127),'headers':{'Accept':_0x319642(0x16b),'User-Agent':_0x319642(0x165)}}),_0x5b95ba=Date[_0x319642(0x143)]()-_0x233eb1;if(!_0x2af460['ok']){const _0x5efacc=await _0x2af460[_0x319642(0x128)]();loggerService_1[_0x319642(0x14d)][_0x319642(0x187)](_0x319642(0x11f),_0x319642(0x130)+_0x3b459e,_0x2af460[_0x319642(0x17f)],_0x5efacc,_0x5b95ba);throw new Error(_0x319642(0x12b)+_0x2af460[_0x319642(0x17f)]);}const _0x4947d3=await _0x2af460[_0x319642(0x126)]();loggerService_1[_0x319642(0x14d)][_0x319642(0x187)](_0x319642(0x11f),'/operations/'+_0x3b459e,_0x2af460[_0x319642(0x17f)],_0x4947d3,_0x5b95ba);if(_0x4947d3['status']!==_0x319642(0x16c)){loggerService_1['loggerService'][_0x319642(0x122)](_0x319642(0x11f),'/operations/'+_0x3b459e,_0x319642(0x11d)+(_0x4947d3[_0x319642(0x17a)]||_0x4947d3[_0x319642(0x139)]||_0x319642(0x178)));throw new Error(_0x319642(0x11d)+(_0x4947d3[_0x319642(0x17a)]||_0x4947d3['error']||_0x319642(0x178)));}let _0x47f64d=_0x319642(0x162);return{'status':_0x47f64d};}catch(_0x5533fe){console[_0x319642(0x139)](_0x319642(0x12c),_0x5533fe),loggerService_1['loggerService'][_0x319642(0x122)](_0x319642(0x11f),'/operations/'+_0x3b459e,_0x5533fe);throw new Error(_0x319642(0x11b)+(_0x5533fe instanceof Error?_0x5533fe[_0x319642(0x17a)]:_0x319642(0x178)));}}async['processWebhook'](_0x5b9c0c){const _0x2beee5=a55_0x39b900;console[_0x2beee5(0x146)](_0x2beee5(0x16d),_0x5b9c0c);let _0x264d56=_0x2beee5(0x162);switch(_0x5b9c0c[_0x2beee5(0x17f)]?.[_0x2beee5(0x155)]()){case _0x2beee5(0x132):case'mismatch':_0x264d56=_0x2beee5(0x180);break;case'expired':_0x264d56=_0x2beee5(0x120);break;case _0x2beee5(0x139):case _0x2beee5(0x144):_0x264d56='FAILED';break;case _0x2beee5(0x164):_0x264d56=_0x2beee5(0x162);break;case'pending':_0x264d56=_0x2beee5(0x145);break;default:_0x264d56=_0x2beee5(0x162);break;}let _0x233719;if(_0x5b9c0c[_0x2beee5(0x119)])try{console['log'](_0x2beee5(0x116),_0x5b9c0c[_0x2beee5(0x119)]);let _0x106c1d;if(typeof _0x5b9c0c[_0x2beee5(0x119)]===_0x2beee5(0x179))_0x106c1d=JSON[_0x2beee5(0x13b)](_0x5b9c0c[_0x2beee5(0x119)]);else Array[_0x2beee5(0x136)](_0x5b9c0c['tx_urls'])?_0x106c1d=_0x5b9c0c[_0x2beee5(0x119)]:_0x106c1d=[];_0x233719=_0x106c1d[_0x2beee5(0x168)](_0x93c9a=>{const _0x3f9bc1=_0x2beee5,_0x13eddb=_0x93c9a[_0x3f9bc1(0x157)](/\\/g,'');return console[_0x3f9bc1(0x146)]('üîó\x20Formatted\x20URL:\x20'+_0x93c9a+_0x3f9bc1(0x11a)+_0x13eddb),_0x13eddb;}),console[_0x2beee5(0x146)](_0x2beee5(0x125),_0x233719),_0x233719[_0x2beee5(0x188)]((_0x492e44,_0x4dc86d)=>{const _0x3056bb=_0x2beee5;try{new URL(_0x492e44),console[_0x3056bb(0x146)]('‚úÖ\x20URL\x20'+(_0x4dc86d+0x1)+_0x3056bb(0x15b)+_0x492e44);}catch(_0x41f9d6){console['error'](_0x3056bb(0x113)+(_0x4dc86d+0x1)+_0x3056bb(0x15e)+_0x492e44,_0x41f9d6);}});}catch(_0x246223){console[_0x2beee5(0x139)](_0x2beee5(0x11e),_0x246223),console[_0x2beee5(0x139)](_0x2beee5(0x131),_0x5b9c0c[_0x2beee5(0x119)]),_0x233719=undefined;}return{'paymentId':_0x5b9c0c['order_number']||'','status':_0x264d56,'amount':_0x5b9c0c[_0x2beee5(0x152)],'currency':_0x5b9c0c[_0x2beee5(0x16a)],'txUrls':_0x233719};}}exports['PlisioService']=PlisioService;