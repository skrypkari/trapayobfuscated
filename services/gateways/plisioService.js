'use strict';const a55_0x334f72=a55_0x1d5d;function a55_0x1d5d(_0x246e17,_0x509496){const _0x14cb25=a55_0x14cb();return a55_0x1d5d=function(_0x1d5dc0,_0x838a60){_0x1d5dc0=_0x1d5dc0-0x1d3;let _0x8ef34d=_0x14cb25[_0x1d5dc0];return _0x8ef34d;},a55_0x1d5d(_0x246e17,_0x509496);}(function(_0x4fa416,_0x4ad1e6){const _0x513f2b=a55_0x1d5d,_0x166a43=_0x4fa416();while(!![]){try{const _0x2322e9=parseInt(_0x513f2b(0x20d))/0x1+parseInt(_0x513f2b(0x220))/0x2*(-parseInt(_0x513f2b(0x1f8))/0x3)+-parseInt(_0x513f2b(0x233))/0x4*(parseInt(_0x513f2b(0x244))/0x5)+parseInt(_0x513f2b(0x1e2))/0x6+-parseInt(_0x513f2b(0x206))/0x7+-parseInt(_0x513f2b(0x24e))/0x8*(-parseInt(_0x513f2b(0x212))/0x9)+-parseInt(_0x513f2b(0x230))/0xa;if(_0x2322e9===_0x4ad1e6)break;else _0x166a43['push'](_0x166a43['shift']());}catch(_0x257df0){_0x166a43['push'](_0x166a43['shift']());}}}(a55_0x14cb,0xc92d7));function a55_0x14cb(){const _0x47c4e6=['tx_urls','366fswDYW','log','===\x20PLISIO\x20API\x20ERROR\x20===','__esModule','PlisioService','HIDDEN','toLowerCase','EXPIRED','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','env','statusText','\x20->\x20','cancelled','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','2227792YEMZLT','json','toString','/invoices/new','Business\x20Error:\x20','Status:','\x20is\x20valid:\x20','1055211vKzVGS','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Parsed\x20Result:','status','27MROTjb','Failed\x20to\x20create\x20Plisio\x20payment:\x20','data','JSON\x20Parse\x20Error:\x20','apiUrl','qr_code','Error\x20stack:','apiKey','Transaction\x20ID:','append','HTTP\x20','Payment\x20System/1.0','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20details:','8570IfhSrH','Raw\x20Response\x20Body:','PENDING','HTTP\x20error!\x20status:\x20','plisio_direct','Source\x20Currency:','/operations/','invoice_total_sum','URL:','Plisio\x20API\x20error:\x20','new','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','mismatch','Status\x20Text:','Amount:','GET','17341730uijzcq','replace','(crypto\x20for\x20payment)','12ihXJrk','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','forEach','isArray','email','PAID','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','now','Invoice\x20URL:','stringify','map','Unknown\x20error\x20from\x20Plisio\x20API','PLISIO_API_KEY','warn','logWhiteDomainResponse','order_number','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','590005HdzIuP','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Parameters:','FAILED','(fiat\x20for\x20merchant)','https://api.trapay.uk/api/webhooks/gateway/plisio','‚ùå\x20URL\x20','Target\x20Currency:','Plisio\x20payment\x20verification\x20error:','success','3234016EXufHl','üîó\x20Formatted\x20URL:\x20','expired','logWhiteDomainError','entries','amount','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','===\x20PLISIO\x20SUCCESS\x20===','message','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','currency','https://api.plisio.net/api/v1/invoices/new','https://api.plisio.net/api/v1/operations/','Response\x20Body:','invoice_url','text','8911548XtTzSp','Unknown\x20error','Response\x20Time:','Error\x20Message:','Processing\x20Plisio\x20webhook:','source_currency','txn_id','fromEntries','qr_url','HTTP\x20Status:','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','defineProperty','Error\x20message:','loggerService','stack','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','parse','\x20is\x20invalid:\x20','‚úÖ\x20URL\x20','error','verifyPayment'];a55_0x14cb=function(){return _0x47c4e6;};return a55_0x14cb();}Object[a55_0x334f72(0x1ed)](exports,a55_0x334f72(0x1fb),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x57047c=a55_0x334f72;this[_0x57047c(0x216)]=_0x57047c(0x1dd),this[_0x57047c(0x219)]=process[_0x57047c(0x201)][_0x57047c(0x23f)]||'',!this[_0x57047c(0x219)]?console[_0x57047c(0x240)](_0x57047c(0x243)):console[_0x57047c(0x1f9)](_0x57047c(0x20e));}async['createPayment'](_0x46de8f){const _0x8c21dd=a55_0x334f72,{orderId:_0x68c631,amount:_0x4bd9b4,currency:_0x3f57bd,productName:_0x29c71a,description:_0x3b7bda,successUrl:_0x5b2db1,failUrl:_0x283cc9,customerEmail:_0x3a82a4,customerName:_0x15ee81,isSourceCurrency:_0x5efdb0,sourceCurrency:_0x4c4eaa}=_0x46de8f;if(!this[_0x8c21dd(0x219)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x55d919=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x68c631,'order_name':_0x29c71a,'description':_0x3b7bda,'success_url':_0x5b2db1,'fail_url':_0x283cc9,'callback_url':_0x8c21dd(0x249)});_0x4c4eaa?(_0x55d919[_0x8c21dd(0x21b)](_0x8c21dd(0x1dc),_0x4c4eaa),_0x55d919[_0x8c21dd(0x21b)](_0x8c21dd(0x1e7),_0x3f57bd),_0x55d919['append']('source_amount',_0x4bd9b4['toString']())):(_0x55d919['append'](_0x8c21dd(0x1dc),_0x3f57bd),_0x55d919[_0x8c21dd(0x21b)]('amount',_0x4bd9b4['toString']()));_0x3a82a4&&_0x55d919['append'](_0x8c21dd(0x237),_0x3a82a4);_0x15ee81&&_0x55d919[_0x8c21dd(0x21b)]('name',_0x15ee81);const _0x165945=this[_0x8c21dd(0x216)]+'?'+_0x55d919[_0x8c21dd(0x208)](),_0x59d5e6=Date[_0x8c21dd(0x23a)]();try{console['log'](_0x8c21dd(0x1db)),console['log'](_0x8c21dd(0x228),this[_0x8c21dd(0x216)]),console['log'](_0x8c21dd(0x246),Object[_0x8c21dd(0x1e9)](_0x55d919[_0x8c21dd(0x1d6)]())),console[_0x8c21dd(0x1f9)]('Full\x20URL\x20(without\x20API\x20key):',_0x165945['replace'](this[_0x8c21dd(0x219)],_0x8c21dd(0x1fd))),loggerService_1[_0x8c21dd(0x1ef)]['logWhiteDomainRequest'](_0x8c21dd(0x224),_0x8c21dd(0x209),_0x8c21dd(0x22f),Object[_0x8c21dd(0x1e9)](_0x55d919['entries']()));const _0x5c2cb0=await fetch(_0x165945,{'method':_0x8c21dd(0x22f),'headers':{'Accept':'application/json','User-Agent':_0x8c21dd(0x21d)}}),_0x11964e=Date[_0x8c21dd(0x23a)]()-_0x59d5e6;console[_0x8c21dd(0x1f9)](_0x8c21dd(0x200)),console[_0x8c21dd(0x1f9)](_0x8c21dd(0x20b),_0x5c2cb0[_0x8c21dd(0x211)]),console[_0x8c21dd(0x1f9)](_0x8c21dd(0x22d),_0x5c2cb0[_0x8c21dd(0x202)]),console['log'](_0x8c21dd(0x1e4),_0x11964e+'ms');const _0x360050=await _0x5c2cb0[_0x8c21dd(0x1e1)]();console[_0x8c21dd(0x1f9)](_0x8c21dd(0x221),_0x360050);if(!_0x5c2cb0['ok']){console[_0x8c21dd(0x1f5)](_0x8c21dd(0x1fa)),console[_0x8c21dd(0x1f5)](_0x8c21dd(0x1eb),_0x5c2cb0[_0x8c21dd(0x211)]),console[_0x8c21dd(0x1f5)](_0x8c21dd(0x1df),_0x360050),loggerService_1[_0x8c21dd(0x1ef)][_0x8c21dd(0x241)](_0x8c21dd(0x224),_0x8c21dd(0x209),_0x5c2cb0[_0x8c21dd(0x211)],_0x360050,_0x11964e),loggerService_1['loggerService'][_0x8c21dd(0x1d5)]('plisio_direct',_0x8c21dd(0x209),_0x8c21dd(0x21c)+_0x5c2cb0[_0x8c21dd(0x211)]+':\x20'+_0x360050);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5c2cb0[_0x8c21dd(0x211)]+',\x20body:\x20'+_0x360050);}let _0x230b32;try{_0x230b32=JSON[_0x8c21dd(0x1f2)](_0x360050);}catch(_0xbaf5bb){console[_0x8c21dd(0x1f5)](_0x8c21dd(0x21e),_0xbaf5bb),loggerService_1[_0x8c21dd(0x1ef)][_0x8c21dd(0x1d5)]('plisio_direct','/invoices/new',_0x8c21dd(0x215)+_0xbaf5bb);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x360050);}console[_0x8c21dd(0x1f9)](_0x8c21dd(0x1d8)),console[_0x8c21dd(0x1f9)](_0x8c21dd(0x210),JSON[_0x8c21dd(0x23c)](_0x230b32,null,0x2)),loggerService_1['loggerService'][_0x8c21dd(0x241)]('plisio_direct',_0x8c21dd(0x209),_0x5c2cb0[_0x8c21dd(0x211)],_0x230b32,_0x11964e);if(_0x230b32['status']!==_0x8c21dd(0x24d)){const _0x50bfd7=_0x230b32[_0x8c21dd(0x1da)]||_0x230b32[_0x8c21dd(0x1f5)]||_0x8c21dd(0x23e);console['error'](_0x8c21dd(0x245)),console[_0x8c21dd(0x1f5)](_0x8c21dd(0x1e5),_0x50bfd7),loggerService_1[_0x8c21dd(0x1ef)][_0x8c21dd(0x1d5)](_0x8c21dd(0x224),_0x8c21dd(0x209),_0x8c21dd(0x20a)+_0x50bfd7);throw new Error(_0x8c21dd(0x229)+_0x50bfd7);}if(!_0x230b32['data']?.['txn_id']||!_0x230b32[_0x8c21dd(0x214)]?.[_0x8c21dd(0x1e0)]){console['error']('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x8c21dd(0x22b)),console['error']('Response\x20data:',_0x230b32[_0x8c21dd(0x214)]),loggerService_1[_0x8c21dd(0x1ef)][_0x8c21dd(0x1d5)](_0x8c21dd(0x224),_0x8c21dd(0x209),_0x8c21dd(0x20f));throw new Error(_0x8c21dd(0x1f1));}return console[_0x8c21dd(0x1f9)](_0x8c21dd(0x1d9)),console[_0x8c21dd(0x1f9)](_0x8c21dd(0x21a),_0x230b32[_0x8c21dd(0x214)][_0x8c21dd(0x1e8)]),console[_0x8c21dd(0x1f9)](_0x8c21dd(0x23b),_0x230b32[_0x8c21dd(0x214)][_0x8c21dd(0x1e0)]),console['log'](_0x8c21dd(0x22e),_0x4bd9b4,_0x3f57bd),_0x4c4eaa&&(console[_0x8c21dd(0x1f9)](_0x8c21dd(0x225),_0x4c4eaa,_0x8c21dd(0x232)),console[_0x8c21dd(0x1f9)](_0x8c21dd(0x24b),_0x3f57bd,_0x8c21dd(0x248))),{'gateway_payment_id':_0x230b32[_0x8c21dd(0x214)][_0x8c21dd(0x1e8)],'payment_url':_0x230b32[_0x8c21dd(0x214)]['invoice_url'],'invoice_total_sum':_0x230b32['data'][_0x8c21dd(0x227)],'qr_code':_0x230b32['data'][_0x8c21dd(0x217)],'qr_url':_0x230b32['data'][_0x8c21dd(0x1ea)]};}catch(_0x5759d8){console[_0x8c21dd(0x1f5)](_0x8c21dd(0x1ec)),console[_0x8c21dd(0x1f5)](_0x8c21dd(0x21f),_0x5759d8),loggerService_1[_0x8c21dd(0x1ef)][_0x8c21dd(0x1d5)](_0x8c21dd(0x224),_0x8c21dd(0x209),_0x5759d8);if(_0x5759d8 instanceof Error){console['error'](_0x8c21dd(0x1ee),_0x5759d8[_0x8c21dd(0x1da)]),console[_0x8c21dd(0x1f5)](_0x8c21dd(0x218),_0x5759d8[_0x8c21dd(0x1f0)]);throw new Error(_0x8c21dd(0x213)+_0x5759d8['message']);}throw new Error(_0x8c21dd(0x205));}}async[a55_0x334f72(0x1f6)](_0x418714){const _0x194318=a55_0x334f72,_0x269fdc=Date[_0x194318(0x23a)]();try{if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x28d9b1=new URLSearchParams({'api_key':this[_0x194318(0x219)],'txn_id':_0x418714}),_0x190f4f=_0x194318(0x1de)+_0x418714+'?'+_0x28d9b1[_0x194318(0x208)]();loggerService_1[_0x194318(0x1ef)]['logWhiteDomainRequest'](_0x194318(0x224),_0x194318(0x226)+_0x418714,'GET',Object[_0x194318(0x1e9)](_0x28d9b1[_0x194318(0x1d6)]()));const _0x2d1640=await fetch(_0x190f4f,{'method':'GET','headers':{'Accept':'application/json','User-Agent':'Payment\x20System/1.0'}}),_0x316b2b=Date[_0x194318(0x23a)]()-_0x269fdc;if(!_0x2d1640['ok']){const _0x160818=await _0x2d1640[_0x194318(0x1e1)]();loggerService_1['loggerService']['logWhiteDomainResponse']('plisio_direct','/operations/'+_0x418714,_0x2d1640[_0x194318(0x211)],_0x160818,_0x316b2b);throw new Error(_0x194318(0x223)+_0x2d1640['status']);}const _0x25e812=await _0x2d1640[_0x194318(0x207)]();loggerService_1['loggerService'][_0x194318(0x241)](_0x194318(0x224),_0x194318(0x226)+_0x418714,_0x2d1640[_0x194318(0x211)],_0x25e812,_0x316b2b);if(_0x25e812[_0x194318(0x211)]!==_0x194318(0x24d)){loggerService_1['loggerService'][_0x194318(0x1d5)](_0x194318(0x224),_0x194318(0x226)+_0x418714,_0x194318(0x229)+(_0x25e812[_0x194318(0x1da)]||_0x25e812[_0x194318(0x1f5)]||_0x194318(0x1e3)));throw new Error(_0x194318(0x229)+(_0x25e812[_0x194318(0x1da)]||_0x25e812[_0x194318(0x1f5)]||_0x194318(0x1e3)));}let _0x3974da=_0x194318(0x222);return{'status':_0x3974da};}catch(_0xea3ed9){console[_0x194318(0x1f5)](_0x194318(0x24c),_0xea3ed9),loggerService_1[_0x194318(0x1ef)]['logWhiteDomainError'](_0x194318(0x224),_0x194318(0x226)+_0x418714,_0xea3ed9);throw new Error(_0x194318(0x234)+(_0xea3ed9 instanceof Error?_0xea3ed9[_0x194318(0x1da)]:'Unknown\x20error'));}}async['processWebhook'](_0x489aa7){const _0xc59fbd=a55_0x334f72;console['log'](_0xc59fbd(0x1e6),_0x489aa7);let _0x57c51f=_0xc59fbd(0x222);switch(_0x489aa7[_0xc59fbd(0x211)]?.[_0xc59fbd(0x1fe)]()){case'completed':case _0xc59fbd(0x22c):_0x57c51f=_0xc59fbd(0x238);break;case _0xc59fbd(0x1d4):_0x57c51f=_0xc59fbd(0x1ff);break;case _0xc59fbd(0x1f5):case _0xc59fbd(0x204):_0x57c51f=_0xc59fbd(0x247);break;case _0xc59fbd(0x22a):_0x57c51f=_0xc59fbd(0x222);break;case'pending':_0x57c51f='PROCESSING';break;default:_0x57c51f=_0xc59fbd(0x222);break;}let _0x309cab;if(_0x489aa7[_0xc59fbd(0x1f7)])try{console[_0xc59fbd(0x1f9)]('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x489aa7[_0xc59fbd(0x1f7)]);let _0x5a75cf;if(typeof _0x489aa7[_0xc59fbd(0x1f7)]==='string')_0x5a75cf=JSON[_0xc59fbd(0x1f2)](_0x489aa7[_0xc59fbd(0x1f7)]);else Array[_0xc59fbd(0x236)](_0x489aa7[_0xc59fbd(0x1f7)])?_0x5a75cf=_0x489aa7[_0xc59fbd(0x1f7)]:_0x5a75cf=[];_0x309cab=_0x5a75cf[_0xc59fbd(0x23d)](_0x413734=>{const _0x2895fb=_0xc59fbd,_0x15ca8e=_0x413734[_0x2895fb(0x231)](/\\/g,'');return console[_0x2895fb(0x1f9)](_0x2895fb(0x1d3)+_0x413734+_0x2895fb(0x203)+_0x15ca8e),_0x15ca8e;}),console['log']('‚úÖ\x20Processed\x20tx_urls:',_0x309cab),_0x309cab[_0xc59fbd(0x235)]((_0x42ddee,_0x4386bf)=>{const _0x280d9d=_0xc59fbd;try{new URL(_0x42ddee),console[_0x280d9d(0x1f9)](_0x280d9d(0x1f4)+(_0x4386bf+0x1)+_0x280d9d(0x20c)+_0x42ddee);}catch(_0xe60f3a){console[_0x280d9d(0x1f5)](_0x280d9d(0x24a)+(_0x4386bf+0x1)+_0x280d9d(0x1f3)+_0x42ddee,_0xe60f3a);}});}catch(_0xf819c0){console[_0xc59fbd(0x1f5)](_0xc59fbd(0x239),_0xf819c0),console[_0xc59fbd(0x1f5)]('Raw\x20tx_urls\x20data:',_0x489aa7[_0xc59fbd(0x1f7)]),_0x309cab=undefined;}return{'paymentId':_0x489aa7[_0xc59fbd(0x242)]||'','status':_0x57c51f,'amount':_0x489aa7[_0xc59fbd(0x1d7)],'currency':_0x489aa7['currency'],'txUrls':_0x309cab};}}exports[a55_0x334f72(0x1fc)]=PlisioService;