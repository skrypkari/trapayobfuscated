'use strict';function a74_0x27bd(_0x44e91a,_0x402002){_0x44e91a=_0x44e91a-0x127;const _0x4cb560=a74_0x4cb5();let _0x27bdf5=_0x4cb560[_0x44e91a];return _0x27bdf5;}function a74_0x4cb5(){const _0x449e55=['processWebhook','Target\x20Currency:','Error\x20Message:','1098456HcHvMM','map','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','warn','Plisio\x20API\x20error:\x20','currency','parse','URL:','ðŸ”—\x20Formatted\x20URL:\x20','Raw\x20Response\x20Body:','amount','JSON\x20Parse\x20Error:\x20','âŒ\x20Failed\x20to\x20parse\x20tx_urls:','stack','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Status:','application/json','loggerService','apiUrl','logWhiteDomainRequest','Payment\x20System/1.0','\x20->\x20','pending','Amount:','now','Invoice\x20URL:','logWhiteDomainResponse','invoice_total_sum','Plisio\x20API\x20key\x20is\x20not\x20configured','Failed\x20to\x20create\x20Plisio\x20payment:\x20','https://api.plisio.net/api/v1/invoices/new','5076925ejMtWd','data','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Failed\x20to\x20parse\x20JSON\x20response:','toString','plisio_direct','PENDING','ðŸ’°\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','PAID','append','entries','source_currency','qr_url','email','25503240mOOneM','text','âœ…\x20Processed\x20tx_urls:','Unknown\x20error','https://api.plisio.net/api/v1/operations/','Parsed\x20Result:','completed','createPayment','cancelled','order_number','GET','error','960rppXXY','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','expired','===\x20PLISIO\x20SUCCESS\x20===','message','38730QkqewG','replace','status','Source\x20Currency:','Plisio\x20payment\x20verification\x20error:','tx_urls','2777284lqVTgt','âš ï¸\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Raw\x20tx_urls\x20data:','success','HTTP\x20error!\x20status:\x20','4091649lXVqCG','fromEntries','===\x20PLISIO\x20API\x20ERROR\x20===','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Error\x20stack:','mismatch','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','toLowerCase','invoice_url','isArray','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','qr_code','verifyPayment','apiKey','PlisioService','Response\x20Time:','âŒ\x20URL\x20','HIDDEN','647226AoJUTg','logWhiteDomainError','/invoices/new','defineProperty','Processing\x20Plisio\x20webhook:','Status\x20Text:','Error\x20details:','log','/operations/','string'];a74_0x4cb5=function(){return _0x449e55;};return a74_0x4cb5();}const a74_0x3e174a=a74_0x27bd;(function(_0x124590,_0x3de336){const _0x111a36=a74_0x27bd,_0x324945=_0x124590();while(!![]){try{const _0x20a850=-parseInt(_0x111a36(0x177))/0x1+parseInt(_0x111a36(0x184))/0x2+parseInt(_0x111a36(0x164))/0x3+parseInt(_0x111a36(0x15f))/0x4+parseInt(_0x111a36(0x159))/0x5*(parseInt(_0x111a36(0x154))/0x6)+parseInt(_0x111a36(0x13a))/0x7+-parseInt(_0x111a36(0x148))/0x8;if(_0x20a850===_0x3de336)break;else _0x324945['push'](_0x324945['shift']());}catch(_0x44ce40){_0x324945['push'](_0x324945['shift']());}}}(a74_0x4cb5,0xb3ea8));Object[a74_0x3e174a(0x17a)](exports,'__esModule',{'value':!![]}),exports[a74_0x3e174a(0x173)]=void 0x0;const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0xbc166d=a74_0x3e174a;this[_0xbc166d(0x12d)]=_0xbc166d(0x139),this[_0xbc166d(0x172)]=process.env.PLISIO_API_KEY||'',!this['apiKey']?console[_0xbc166d(0x187)](_0xbc166d(0x160)):console['log'](_0xbc166d(0x141));}async[a74_0x3e174a(0x14f)](_0x49e02b){const _0x435876=a74_0x3e174a,{orderId:_0x216963,amount:_0x5e171d,currency:_0x2d9673,productName:_0x56a342,description:_0xf56711,successUrl:_0x3038a9,failUrl:_0x30a4bd,customerEmail:_0x1560f1,customerName:_0x3ebb05,isSourceCurrency:_0x11a983,sourceCurrency:_0x378887}=_0x49e02b;if(!this[_0x435876(0x172)])throw new Error(_0x435876(0x137));const _0x384147=new URLSearchParams({'api_key':this[_0x435876(0x172)],'order_number':_0x216963,'order_name':_0x56a342,'description':_0xf56711,'success_url':_0x3038a9,'fail_url':_0x30a4bd,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x378887?(_0x384147[_0x435876(0x143)]('currency',_0x378887),_0x384147[_0x435876(0x143)](_0x435876(0x145),_0x2d9673),_0x384147[_0x435876(0x143)]('source_amount',_0x5e171d['toString']())):(_0x384147[_0x435876(0x143)](_0x435876(0x189),_0x2d9673),_0x384147[_0x435876(0x143)](_0x435876(0x18e),_0x5e171d[_0x435876(0x13e)]()));_0x1560f1&&_0x384147[_0x435876(0x143)](_0x435876(0x147),_0x1560f1);_0x3ebb05&&_0x384147['append']('name',_0x3ebb05);const _0x34d5d8=this[_0x435876(0x12d)]+'?'+_0x384147[_0x435876(0x13e)](),_0x700a87=Date['now']();try{console[_0x435876(0x17e)](_0x435876(0x129)),console[_0x435876(0x17e)](_0x435876(0x18b),this[_0x435876(0x12d)]),console['log']('Parameters:',Object[_0x435876(0x165)](_0x384147[_0x435876(0x144)]())),console[_0x435876(0x17e)]('Full\x20URL\x20(without\x20API\x20key):',_0x34d5d8[_0x435876(0x15a)](this[_0x435876(0x172)],_0x435876(0x176))),loggerService_1[_0x435876(0x12c)][_0x435876(0x12e)](_0x435876(0x13f),_0x435876(0x179),'GET',Object[_0x435876(0x165)](_0x384147['entries']()));const _0x398089=await fetch(_0x34d5d8,{'method':_0x435876(0x152),'headers':{'Accept':_0x435876(0x12b),'User-Agent':_0x435876(0x12f)}}),_0x52ca01=Date['now']()-_0x700a87;console[_0x435876(0x17e)](_0x435876(0x16b)),console['log'](_0x435876(0x12a),_0x398089[_0x435876(0x15b)]),console['log'](_0x435876(0x17c),_0x398089['statusText']),console[_0x435876(0x17e)](_0x435876(0x174),_0x52ca01+'ms');const _0x285e98=await _0x398089[_0x435876(0x149)]();console['log'](_0x435876(0x18d),_0x285e98);if(!_0x398089['ok']){console[_0x435876(0x153)](_0x435876(0x166)),console['error']('HTTP\x20Status:',_0x398089['status']),console[_0x435876(0x153)]('Response\x20Body:',_0x285e98),loggerService_1[_0x435876(0x12c)][_0x435876(0x135)](_0x435876(0x13f),_0x435876(0x179),_0x398089[_0x435876(0x15b)],_0x285e98,_0x52ca01),loggerService_1[_0x435876(0x12c)][_0x435876(0x178)](_0x435876(0x13f),_0x435876(0x179),'HTTP\x20'+_0x398089[_0x435876(0x15b)]+':\x20'+_0x285e98);throw new Error(_0x435876(0x163)+_0x398089[_0x435876(0x15b)]+',\x20body:\x20'+_0x285e98);}let _0x2845af;try{_0x2845af=JSON[_0x435876(0x18a)](_0x285e98);}catch(_0x9e732a){console['error'](_0x435876(0x13d),_0x9e732a),loggerService_1[_0x435876(0x12c)]['logWhiteDomainError']('plisio_direct',_0x435876(0x179),_0x435876(0x18f)+_0x9e732a);throw new Error(_0x435876(0x155)+_0x285e98);}console[_0x435876(0x17e)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x435876(0x17e)](_0x435876(0x14d),JSON['stringify'](_0x2845af,null,0x2)),loggerService_1[_0x435876(0x12c)][_0x435876(0x135)](_0x435876(0x13f),_0x435876(0x179),_0x398089[_0x435876(0x15b)],_0x2845af,_0x52ca01);if(_0x2845af[_0x435876(0x15b)]!==_0x435876(0x162)){const _0x5162d3=_0x2845af[_0x435876(0x158)]||_0x2845af['error']||'Unknown\x20error\x20from\x20Plisio\x20API';console['error'](_0x435876(0x168)),console[_0x435876(0x153)](_0x435876(0x183),_0x5162d3),loggerService_1[_0x435876(0x12c)]['logWhiteDomainError']('plisio_direct','/invoices/new','Business\x20Error:\x20'+_0x5162d3);throw new Error(_0x435876(0x188)+_0x5162d3);}if(!_0x2845af[_0x435876(0x13b)]?.['txn_id']||!_0x2845af[_0x435876(0x13b)]?.[_0x435876(0x16d)]){console[_0x435876(0x153)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x435876(0x153)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x435876(0x153)]('Response\x20data:',_0x2845af[_0x435876(0x13b)]),loggerService_1[_0x435876(0x12c)]['logWhiteDomainError'](_0x435876(0x13f),_0x435876(0x179),_0x435876(0x16f));throw new Error(_0x435876(0x167));}return console[_0x435876(0x17e)](_0x435876(0x157)),console['log']('Transaction\x20ID:',_0x2845af[_0x435876(0x13b)]['txn_id']),console[_0x435876(0x17e)](_0x435876(0x134),_0x2845af[_0x435876(0x13b)][_0x435876(0x16d)]),console['log'](_0x435876(0x132),_0x5e171d,_0x2d9673),_0x378887&&(console[_0x435876(0x17e)](_0x435876(0x15c),_0x378887,'(crypto\x20for\x20payment)'),console[_0x435876(0x17e)](_0x435876(0x182),_0x2d9673,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x2845af[_0x435876(0x13b)]['txn_id'],'payment_url':_0x2845af['data'][_0x435876(0x16d)],'invoice_total_sum':_0x2845af[_0x435876(0x13b)][_0x435876(0x136)],'qr_code':_0x2845af[_0x435876(0x13b)][_0x435876(0x170)],'qr_url':_0x2845af[_0x435876(0x13b)][_0x435876(0x146)]};}catch(_0x2eb9b3){console['error'](_0x435876(0x186)),console['error'](_0x435876(0x17d),_0x2eb9b3),loggerService_1[_0x435876(0x12c)][_0x435876(0x178)](_0x435876(0x13f),_0x435876(0x179),_0x2eb9b3);if(_0x2eb9b3 instanceof Error){console[_0x435876(0x153)]('Error\x20message:',_0x2eb9b3[_0x435876(0x158)]),console[_0x435876(0x153)](_0x435876(0x169),_0x2eb9b3[_0x435876(0x128)]);throw new Error(_0x435876(0x138)+_0x2eb9b3[_0x435876(0x158)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a74_0x3e174a(0x171)](_0xb36957){const _0xa7b718=a74_0x3e174a,_0x24d011=Date[_0xa7b718(0x133)]();try{if(!this[_0xa7b718(0x172)])throw new Error(_0xa7b718(0x137));const _0x37e117=new URLSearchParams({'api_key':this[_0xa7b718(0x172)],'txn_id':_0xb36957}),_0x341567=_0xa7b718(0x14c)+_0xb36957+'?'+_0x37e117['toString']();loggerService_1['loggerService'][_0xa7b718(0x12e)](_0xa7b718(0x13f),_0xa7b718(0x17f)+_0xb36957,_0xa7b718(0x152),Object['fromEntries'](_0x37e117[_0xa7b718(0x144)]()));const _0x52182d=await fetch(_0x341567,{'method':_0xa7b718(0x152),'headers':{'Accept':'application/json','User-Agent':'Payment\x20System/1.0'}}),_0x4eb1b8=Date[_0xa7b718(0x133)]()-_0x24d011;if(!_0x52182d['ok']){const _0x3adad9=await _0x52182d[_0xa7b718(0x149)]();loggerService_1[_0xa7b718(0x12c)][_0xa7b718(0x135)]('plisio_direct','/operations/'+_0xb36957,_0x52182d[_0xa7b718(0x15b)],_0x3adad9,_0x4eb1b8);throw new Error(_0xa7b718(0x163)+_0x52182d['status']);}const _0x566420=await _0x52182d['json']();loggerService_1['loggerService'][_0xa7b718(0x135)](_0xa7b718(0x13f),_0xa7b718(0x17f)+_0xb36957,_0x52182d[_0xa7b718(0x15b)],_0x566420,_0x4eb1b8);if(_0x566420['status']!==_0xa7b718(0x162)){loggerService_1[_0xa7b718(0x12c)]['logWhiteDomainError'](_0xa7b718(0x13f),_0xa7b718(0x17f)+_0xb36957,_0xa7b718(0x188)+(_0x566420[_0xa7b718(0x158)]||_0x566420[_0xa7b718(0x153)]||_0xa7b718(0x14b)));throw new Error(_0xa7b718(0x188)+(_0x566420['message']||_0x566420[_0xa7b718(0x153)]||_0xa7b718(0x14b)));}let _0x68c34c=_0xa7b718(0x140);return{'status':_0x68c34c};}catch(_0x4f426c){console[_0xa7b718(0x153)](_0xa7b718(0x15d),_0x4f426c),loggerService_1['loggerService'][_0xa7b718(0x178)](_0xa7b718(0x13f),_0xa7b718(0x17f)+_0xb36957,_0x4f426c);throw new Error(_0xa7b718(0x13c)+(_0x4f426c instanceof Error?_0x4f426c[_0xa7b718(0x158)]:_0xa7b718(0x14b)));}}async[a74_0x3e174a(0x181)](_0x2d5b11){const _0x3fb36b=a74_0x3e174a;console[_0x3fb36b(0x17e)](_0x3fb36b(0x17b),_0x2d5b11);let _0x4f0c60='PENDING';switch(_0x2d5b11[_0x3fb36b(0x15b)]?.[_0x3fb36b(0x16c)]()){case _0x3fb36b(0x14e):case _0x3fb36b(0x16a):_0x4f0c60=_0x3fb36b(0x142);break;case _0x3fb36b(0x156):_0x4f0c60='EXPIRED';break;case _0x3fb36b(0x153):case _0x3fb36b(0x150):_0x4f0c60='FAILED';break;case'new':_0x4f0c60=_0x3fb36b(0x140);break;case _0x3fb36b(0x131):_0x4f0c60='PROCESSING';break;default:_0x4f0c60='PENDING';break;}let _0x40af0b;if(_0x2d5b11[_0x3fb36b(0x15e)])try{console[_0x3fb36b(0x17e)]('ðŸ”—\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x2d5b11[_0x3fb36b(0x15e)]);let _0xe03864;if(typeof _0x2d5b11['tx_urls']===_0x3fb36b(0x180))_0xe03864=JSON[_0x3fb36b(0x18a)](_0x2d5b11['tx_urls']);else Array[_0x3fb36b(0x16e)](_0x2d5b11[_0x3fb36b(0x15e)])?_0xe03864=_0x2d5b11['tx_urls']:_0xe03864=[];_0x40af0b=_0xe03864[_0x3fb36b(0x185)](_0x34ac1c=>{const _0x7e6b88=_0x3fb36b,_0x22aa2c=_0x34ac1c[_0x7e6b88(0x15a)](/\\/g,'');return console[_0x7e6b88(0x17e)](_0x7e6b88(0x18c)+_0x34ac1c+_0x7e6b88(0x130)+_0x22aa2c),_0x22aa2c;}),console[_0x3fb36b(0x17e)](_0x3fb36b(0x14a),_0x40af0b),_0x40af0b['forEach']((_0x33591b,_0x30986f)=>{const _0x1b218e=_0x3fb36b;try{new URL(_0x33591b),console['log']('âœ…\x20URL\x20'+(_0x30986f+0x1)+'\x20is\x20valid:\x20'+_0x33591b);}catch(_0x48ca57){console[_0x1b218e(0x153)](_0x1b218e(0x175)+(_0x30986f+0x1)+'\x20is\x20invalid:\x20'+_0x33591b,_0x48ca57);}});}catch(_0x4b0dfe){console[_0x3fb36b(0x153)](_0x3fb36b(0x127),_0x4b0dfe),console[_0x3fb36b(0x153)](_0x3fb36b(0x161),_0x2d5b11[_0x3fb36b(0x15e)]),_0x40af0b=undefined;}return{'paymentId':_0x2d5b11[_0x3fb36b(0x151)]||'','status':_0x4f0c60,'amount':_0x2d5b11[_0x3fb36b(0x18e)],'currency':_0x2d5b11['currency'],'txUrls':_0x40af0b};}}exports[a74_0x3e174a(0x173)]=PlisioService;