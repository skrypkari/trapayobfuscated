'use strict';const a41_0x199436=a41_0x50b2;function a41_0x2252(){const _0x46bed6=['Error\x20details:','expired','../loggerService','PAID','amount','loggerService','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','status','HTTP\x20Status:','stack','Parsed\x20Result:','fromEntries','success','txn_id','Target\x20Currency:','TesSoft\x20Payment\x20System/1.0','Failed\x20to\x20create\x20Plisio\x20payment:\x20','now','Source\x20Currency:','Plisio\x20API\x20error:\x20','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Failed\x20to\x20parse\x20JSON\x20response:','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','/operations/','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error',',\x20body:\x20','https://api.plisio.net/api/v1/operations/','stringify','Error\x20message:','replace','Transaction\x20ID:','https://api.trapay.uk/api/webhooks/gateway/plisio','toString','790074tjGEnF','===\x20PLISIO\x20API\x20ERROR\x20===','PLISIO_API_KEY','logWhiteDomainError','EXPIRED','45QgDuoB','Status:','error','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','Amount:','(crypto\x20for\x20payment)','order_number','Business\x20Error:\x20','Error\x20Message:','currency','JSON\x20Parse\x20Error:\x20','warn','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','application/json','name','FAILED','385392kaiivd','Response\x20Time:','entries','Unknown\x20error','pending','verifyPayment','message','Plisio\x20API\x20key\x20is\x20not\x20configured','processWebhook','data','PlisioService','Parameters:','Plisio\x20payment\x20verification\x20error:','31544tCaFDH','https://api.plisio.net/api/v1/invoices/new','invoice_url','log','cancelled','25bERQLL','statusText','mismatch','logWhiteDomainResponse','(fiat\x20for\x20merchant)','Response\x20data:','Unknown\x20error\x20from\x20Plisio\x20API','Invoice\x20URL:','completed','apiKey','153412yUmNnB','HTTP\x20error!\x20status:\x20','Error\x20stack:','1385790thmIvD','698046ACZdbI','invoice_total_sum','PENDING','14PfPraD','HIDDEN','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','createPayment','qr_url','499420NtjokN','apiUrl','plisio_direct','GET','append','toLowerCase','Processing\x20Plisio\x20webhook:','Response\x20Body:','__esModule','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','/invoices/new','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='];a41_0x2252=function(){return _0x46bed6;};return a41_0x2252();}(function(_0x1e7e83,_0x5f1f63){const _0x80e75b=a41_0x50b2,_0x437595=_0x1e7e83();while(!![]){try{const _0x54efd0=parseInt(_0x80e75b(0xf8))/0x1*(parseInt(_0x80e75b(0xa2))/0x2)+parseInt(_0x80e75b(0xd6))/0x3+-parseInt(_0x80e75b(0x9b))/0x4*(parseInt(_0x80e75b(0xfd))/0x5)+-parseInt(_0x80e75b(0x9f))/0x6+-parseInt(_0x80e75b(0x9e))/0x7+-parseInt(_0x80e75b(0xeb))/0x8+parseInt(_0x80e75b(0xdb))/0x9*(parseInt(_0x80e75b(0xa7))/0xa);if(_0x54efd0===_0x5f1f63)break;else _0x437595['push'](_0x437595['shift']());}catch(_0x2fb481){_0x437595['push'](_0x437595['shift']());}}}(a41_0x2252,0x2bdaa));function a41_0x50b2(_0x1bc5ce,_0x2d01a2){const _0x22522d=a41_0x2252();return a41_0x50b2=function(_0x50b235,_0x4f3ec1){_0x50b235=_0x50b235-0x97;let _0x421776=_0x22522d[_0x50b235];return _0x421776;},a41_0x50b2(_0x1bc5ce,_0x2d01a2);}Object['defineProperty'](exports,a41_0x199436(0xaf),{'value':!![]}),exports[a41_0x199436(0xf5)]=void 0x0;const loggerService_1=require(a41_0x199436(0xb5));class PlisioService{constructor(){const _0x1f311c=a41_0x199436;this['apiUrl']=_0x1f311c(0xf9),this['apiKey']=process['env'][_0x1f311c(0xd8)]||'',!this[_0x1f311c(0x9a)]?console[_0x1f311c(0xe6)](_0x1f311c(0xa4)):console[_0x1f311c(0xfb)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a41_0x199436(0xa5)](_0x4797b1){const _0x2de789=a41_0x199436,{orderId:_0x24473a,amount:_0x1d8593,currency:_0x39dc32,productName:_0xd5ed75,description:_0x1b289b,successUrl:_0x291cd3,failUrl:_0x4479e5,customerEmail:_0x4598a7,customerName:_0x472356,isSourceCurrency:_0x584510,sourceCurrency:_0x33357c}=_0x4797b1;if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x54bfa7=new URLSearchParams({'api_key':this[_0x2de789(0x9a)],'order_number':_0x24473a,'order_name':_0xd5ed75,'description':_0x1b289b,'success_url':_0x291cd3,'fail_url':_0x4479e5,'callback_url':_0x2de789(0xd4)});_0x33357c?(_0x54bfa7[_0x2de789(0xab)](_0x2de789(0xe4),_0x33357c),_0x54bfa7[_0x2de789(0xab)]('source_currency',_0x39dc32),_0x54bfa7['append']('source_amount',_0x1d8593[_0x2de789(0xd5)]())):(_0x54bfa7[_0x2de789(0xab)]('currency',_0x39dc32),_0x54bfa7[_0x2de789(0xab)](_0x2de789(0xb7),_0x1d8593[_0x2de789(0xd5)]()));_0x4598a7&&_0x54bfa7[_0x2de789(0xab)]('email',_0x4598a7);_0x472356&&_0x54bfa7[_0x2de789(0xab)](_0x2de789(0xe9),_0x472356);const _0x5c8df8=this[_0x2de789(0xa8)]+'?'+_0x54bfa7[_0x2de789(0xd5)](),_0x4eb479=Date['now']();try{console['log'](_0x2de789(0xb9)),console[_0x2de789(0xfb)]('URL:',this['apiUrl']),console['log'](_0x2de789(0xf6),Object[_0x2de789(0xbf)](_0x54bfa7[_0x2de789(0xed)]())),console['log']('Full\x20URL\x20(without\x20API\x20key):',_0x5c8df8[_0x2de789(0xd2)](this['apiKey'],_0x2de789(0xa3))),loggerService_1[_0x2de789(0xb8)]['logWhiteDomainRequest'](_0x2de789(0xa9),_0x2de789(0xb1),'GET',Object[_0x2de789(0xbf)](_0x54bfa7[_0x2de789(0xed)]()));const _0x5702dc=await fetch(_0x5c8df8,{'method':_0x2de789(0xaa),'headers':{'Accept':'application/json','User-Agent':_0x2de789(0xc3)}}),_0x41e188=Date[_0x2de789(0xc5)]()-_0x4eb479;console[_0x2de789(0xfb)](_0x2de789(0xb2)),console[_0x2de789(0xfb)](_0x2de789(0xdc),_0x5702dc[_0x2de789(0xbb)]),console['log']('Status\x20Text:',_0x5702dc[_0x2de789(0xfe)]),console[_0x2de789(0xfb)](_0x2de789(0xec),_0x41e188+'ms');const _0x89d2a5=await _0x5702dc['text']();console['log']('Raw\x20Response\x20Body:',_0x89d2a5);if(!_0x5702dc['ok']){console[_0x2de789(0xdd)](_0x2de789(0xd7)),console[_0x2de789(0xdd)](_0x2de789(0xbc),_0x5702dc[_0x2de789(0xbb)]),console['error'](_0x2de789(0xae),_0x89d2a5),loggerService_1[_0x2de789(0xb8)][_0x2de789(0x100)]('plisio_direct',_0x2de789(0xb1),_0x5702dc[_0x2de789(0xbb)],_0x89d2a5,_0x41e188),loggerService_1[_0x2de789(0xb8)][_0x2de789(0xd9)](_0x2de789(0xa9),'/invoices/new','HTTP\x20'+_0x5702dc[_0x2de789(0xbb)]+':\x20'+_0x89d2a5);throw new Error(_0x2de789(0x9c)+_0x5702dc[_0x2de789(0xbb)]+_0x2de789(0xce)+_0x89d2a5);}let _0x278945;try{_0x278945=JSON['parse'](_0x89d2a5);}catch(_0x408456){console[_0x2de789(0xdd)](_0x2de789(0xca),_0x408456),loggerService_1[_0x2de789(0xb8)][_0x2de789(0xd9)]('plisio_direct',_0x2de789(0xb1),_0x2de789(0xe5)+_0x408456);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x89d2a5);}console[_0x2de789(0xfb)](_0x2de789(0xe7)),console[_0x2de789(0xfb)](_0x2de789(0xbe),JSON[_0x2de789(0xd0)](_0x278945,null,0x2)),loggerService_1[_0x2de789(0xb8)][_0x2de789(0x100)](_0x2de789(0xa9),'/invoices/new',_0x5702dc[_0x2de789(0xbb)],_0x278945,_0x41e188);if(_0x278945['status']!==_0x2de789(0xc0)){const _0x3c0d08=_0x278945[_0x2de789(0xf1)]||_0x278945[_0x2de789(0xdd)]||_0x2de789(0x97);console['error'](_0x2de789(0xba)),console[_0x2de789(0xdd)](_0x2de789(0xe3),_0x3c0d08),loggerService_1['loggerService'][_0x2de789(0xd9)]('plisio_direct',_0x2de789(0xb1),_0x2de789(0xe2)+_0x3c0d08);throw new Error('Plisio\x20API\x20error:\x20'+_0x3c0d08);}if(!_0x278945[_0x2de789(0xf4)]?.[_0x2de789(0xc1)]||!_0x278945[_0x2de789(0xf4)]?.[_0x2de789(0xfa)]){console[_0x2de789(0xdd)](_0x2de789(0xcb)),console[_0x2de789(0xdd)](_0x2de789(0xde)),console[_0x2de789(0xdd)](_0x2de789(0x102),_0x278945[_0x2de789(0xf4)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x2de789(0xa9),'/invoices/new','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x2de789(0xc9));}return console['log']('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x2de789(0xfb)](_0x2de789(0xd3),_0x278945[_0x2de789(0xf4)][_0x2de789(0xc1)]),console[_0x2de789(0xfb)](_0x2de789(0x98),_0x278945['data'][_0x2de789(0xfa)]),console[_0x2de789(0xfb)](_0x2de789(0xdf),_0x1d8593,_0x39dc32),_0x33357c&&(console[_0x2de789(0xfb)](_0x2de789(0xc6),_0x33357c,_0x2de789(0xe0)),console['log'](_0x2de789(0xc2),_0x39dc32,_0x2de789(0x101))),{'gateway_payment_id':_0x278945[_0x2de789(0xf4)]['txn_id'],'payment_url':_0x278945['data'][_0x2de789(0xfa)],'invoice_total_sum':_0x278945[_0x2de789(0xf4)][_0x2de789(0xa0)],'qr_code':_0x278945[_0x2de789(0xf4)]['qr_code'],'qr_url':_0x278945[_0x2de789(0xf4)][_0x2de789(0xa6)]};}catch(_0x14d4a2){console[_0x2de789(0xdd)](_0x2de789(0xb0)),console[_0x2de789(0xdd)](_0x2de789(0xb3),_0x14d4a2),loggerService_1[_0x2de789(0xb8)][_0x2de789(0xd9)](_0x2de789(0xa9),'/invoices/new',_0x14d4a2);if(_0x14d4a2 instanceof Error){console[_0x2de789(0xdd)](_0x2de789(0xd1),_0x14d4a2[_0x2de789(0xf1)]),console[_0x2de789(0xdd)](_0x2de789(0x9d),_0x14d4a2[_0x2de789(0xbd)]);throw new Error(_0x2de789(0xc4)+_0x14d4a2['message']);}throw new Error(_0x2de789(0xcd));}}async[a41_0x199436(0xf0)](_0x5916ee){const _0x9dfb87=a41_0x199436,_0x49f39d=Date[_0x9dfb87(0xc5)]();try{if(!this[_0x9dfb87(0x9a)])throw new Error(_0x9dfb87(0xf2));const _0x56bfb8=new URLSearchParams({'api_key':this[_0x9dfb87(0x9a)],'txn_id':_0x5916ee}),_0x439a9e=_0x9dfb87(0xcf)+_0x5916ee+'?'+_0x56bfb8[_0x9dfb87(0xd5)]();loggerService_1[_0x9dfb87(0xb8)]['logWhiteDomainRequest'](_0x9dfb87(0xa9),_0x9dfb87(0xcc)+_0x5916ee,_0x9dfb87(0xaa),Object[_0x9dfb87(0xbf)](_0x56bfb8[_0x9dfb87(0xed)]()));const _0x1ea9c9=await fetch(_0x439a9e,{'method':_0x9dfb87(0xaa),'headers':{'Accept':_0x9dfb87(0xe8),'User-Agent':_0x9dfb87(0xc3)}}),_0x5deb51=Date[_0x9dfb87(0xc5)]()-_0x49f39d;if(!_0x1ea9c9['ok']){const _0x125cfd=await _0x1ea9c9['text']();loggerService_1[_0x9dfb87(0xb8)][_0x9dfb87(0x100)](_0x9dfb87(0xa9),_0x9dfb87(0xcc)+_0x5916ee,_0x1ea9c9[_0x9dfb87(0xbb)],_0x125cfd,_0x5deb51);throw new Error(_0x9dfb87(0x9c)+_0x1ea9c9[_0x9dfb87(0xbb)]);}const _0x34796e=await _0x1ea9c9['json']();loggerService_1[_0x9dfb87(0xb8)][_0x9dfb87(0x100)]('plisio_direct',_0x9dfb87(0xcc)+_0x5916ee,_0x1ea9c9[_0x9dfb87(0xbb)],_0x34796e,_0x5deb51);if(_0x34796e[_0x9dfb87(0xbb)]!==_0x9dfb87(0xc0)){loggerService_1[_0x9dfb87(0xb8)]['logWhiteDomainError'](_0x9dfb87(0xa9),'/operations/'+_0x5916ee,'Plisio\x20API\x20error:\x20'+(_0x34796e['message']||_0x34796e['error']||_0x9dfb87(0xee)));throw new Error(_0x9dfb87(0xc7)+(_0x34796e[_0x9dfb87(0xf1)]||_0x34796e[_0x9dfb87(0xdd)]||'Unknown\x20error'));}let _0x38ae4=_0x9dfb87(0xa1);return{'status':_0x38ae4};}catch(_0x198fcf){console[_0x9dfb87(0xdd)](_0x9dfb87(0xf7),_0x198fcf),loggerService_1[_0x9dfb87(0xb8)][_0x9dfb87(0xd9)](_0x9dfb87(0xa9),_0x9dfb87(0xcc)+_0x5916ee,_0x198fcf);throw new Error(_0x9dfb87(0xc8)+(_0x198fcf instanceof Error?_0x198fcf['message']:_0x9dfb87(0xee)));}}async[a41_0x199436(0xf3)](_0x38b032){const _0x2f7b76=a41_0x199436;console[_0x2f7b76(0xfb)](_0x2f7b76(0xad),_0x38b032);let _0x482d69=_0x2f7b76(0xa1);switch(_0x38b032[_0x2f7b76(0xbb)]?.[_0x2f7b76(0xac)]()){case _0x2f7b76(0x99):case _0x2f7b76(0xff):_0x482d69=_0x2f7b76(0xb6);break;case _0x2f7b76(0xb4):_0x482d69=_0x2f7b76(0xda);break;case'error':case _0x2f7b76(0xfc):_0x482d69=_0x2f7b76(0xea);break;case'new':case _0x2f7b76(0xef):default:_0x482d69=_0x2f7b76(0xa1);break;}return{'paymentId':_0x38b032[_0x2f7b76(0xe1)]||'','status':_0x482d69,'amount':_0x38b032[_0x2f7b76(0xb7)],'currency':_0x38b032[_0x2f7b76(0xe4)]};}}exports[a41_0x199436(0xf5)]=PlisioService;