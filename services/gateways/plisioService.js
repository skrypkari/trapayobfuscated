'use strict';const a41_0x8aaad3=a41_0x5a11;(function(_0x1a6350,_0x1a2324){const _0x1cb0d3=a41_0x5a11,_0x43e216=_0x1a6350();while(!![]){try{const _0x2a981c=-parseInt(_0x1cb0d3(0x1d4))/0x1+-parseInt(_0x1cb0d3(0x21c))/0x2*(parseInt(_0x1cb0d3(0x216))/0x3)+-parseInt(_0x1cb0d3(0x1bf))/0x4+parseInt(_0x1cb0d3(0x20b))/0x5*(parseInt(_0x1cb0d3(0x1bd))/0x6)+-parseInt(_0x1cb0d3(0x21b))/0x7*(-parseInt(_0x1cb0d3(0x1e3))/0x8)+parseInt(_0x1cb0d3(0x210))/0x9*(-parseInt(_0x1cb0d3(0x1c3))/0xa)+parseInt(_0x1cb0d3(0x1c7))/0xb;if(_0x2a981c===_0x1a2324)break;else _0x43e216['push'](_0x43e216['shift']());}catch(_0x225140){_0x43e216['push'](_0x43e216['shift']());}}}(a41_0x212f,0x21fcb));function a41_0x5a11(_0x155ce0,_0x5919e6){const _0x212fb5=a41_0x212f();return a41_0x5a11=function(_0x5a1126,_0x1c8ef8){_0x5a1126=_0x5a1126-0x1b9;let _0x424b07=_0x212fb5[_0x5a1126];return _0x424b07;},a41_0x5a11(_0x155ce0,_0x5919e6);}Object['defineProperty'](exports,a41_0x8aaad3(0x20f),{'value':!![]}),exports[a41_0x8aaad3(0x1de)]=void 0x0;const loggerService_1=require(a41_0x8aaad3(0x212));class PlisioService{constructor(){const _0x322486=a41_0x8aaad3;this[_0x322486(0x1fa)]=_0x322486(0x1fd),this['apiKey']=process['env'][_0x322486(0x1c0)]||'',!this[_0x322486(0x20a)]?console[_0x322486(0x20d)](_0x322486(0x1f1)):console[_0x322486(0x1ce)](_0x322486(0x217));}async[a41_0x8aaad3(0x211)](_0x31f747){const _0x211e58=a41_0x8aaad3,{orderId:_0x522dc3,amount:_0x1097be,currency:_0x121b3,productName:_0xaad8df,description:_0x3f6087,successUrl:_0x240b3e,failUrl:_0x161c05,customerEmail:_0x4bf56f,customerName:_0x592597,isSourceCurrency:_0x156469,sourceCurrency:_0x83a458}=_0x31f747;if(!this[_0x211e58(0x20a)])throw new Error(_0x211e58(0x1cb));const _0x2b9cd0=new URLSearchParams({'api_key':this[_0x211e58(0x20a)],'order_number':_0x522dc3,'order_name':_0xaad8df,'description':_0x3f6087,'success_url':_0x240b3e,'fail_url':_0x161c05,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x83a458?(_0x2b9cd0[_0x211e58(0x1e4)]('currency',_0x83a458),_0x2b9cd0[_0x211e58(0x1e4)](_0x211e58(0x20e),_0x121b3),_0x2b9cd0[_0x211e58(0x1e4)]('source_amount',_0x1097be[_0x211e58(0x1cc)]())):(_0x2b9cd0[_0x211e58(0x1e4)](_0x211e58(0x1ea),_0x121b3),_0x2b9cd0[_0x211e58(0x1e4)](_0x211e58(0x1d2),_0x1097be[_0x211e58(0x1cc)]()));_0x4bf56f&&_0x2b9cd0[_0x211e58(0x1e4)](_0x211e58(0x1ca),_0x4bf56f);_0x592597&&_0x2b9cd0['append'](_0x211e58(0x1f9),_0x592597);const _0x2ec8b0=this[_0x211e58(0x1fa)]+'?'+_0x2b9cd0[_0x211e58(0x1cc)](),_0x394c41=Date[_0x211e58(0x1ef)]();try{console[_0x211e58(0x1ce)](_0x211e58(0x206)),console[_0x211e58(0x1ce)]('URL:',this[_0x211e58(0x1fa)]),console[_0x211e58(0x1ce)]('Parameters:',Object[_0x211e58(0x200)](_0x2b9cd0[_0x211e58(0x1e0)]())),console['log'](_0x211e58(0x1f4),_0x2ec8b0[_0x211e58(0x1d9)](this[_0x211e58(0x20a)],_0x211e58(0x208))),loggerService_1[_0x211e58(0x1e6)]['logWhiteDomainRequest'](_0x211e58(0x1d7),_0x211e58(0x1c9),'GET',Object[_0x211e58(0x200)](_0x2b9cd0[_0x211e58(0x1e0)]()));const _0x1f35dc=await fetch(_0x2ec8b0,{'method':'GET','headers':{'Accept':_0x211e58(0x221),'User-Agent':_0x211e58(0x1ed)}}),_0x1acc43=Date[_0x211e58(0x1ef)]()-_0x394c41;console[_0x211e58(0x1ce)](_0x211e58(0x21e)),console[_0x211e58(0x1ce)](_0x211e58(0x1bb),_0x1f35dc[_0x211e58(0x204)]),console['log'](_0x211e58(0x1ee),_0x1f35dc[_0x211e58(0x203)]),console[_0x211e58(0x1ce)]('Response\x20Time:',_0x1acc43+'ms');const _0x5671e6=await _0x1f35dc[_0x211e58(0x1e1)]();console[_0x211e58(0x1ce)](_0x211e58(0x1bc),_0x5671e6);if(!_0x1f35dc['ok']){console[_0x211e58(0x1d8)](_0x211e58(0x205)),console['error'](_0x211e58(0x1d0),_0x1f35dc[_0x211e58(0x204)]),console[_0x211e58(0x1d8)]('Response\x20Body:',_0x5671e6),loggerService_1['loggerService'][_0x211e58(0x219)](_0x211e58(0x1d7),_0x211e58(0x1c9),_0x1f35dc[_0x211e58(0x204)],_0x5671e6,_0x1acc43),loggerService_1[_0x211e58(0x1e6)]['logWhiteDomainError'](_0x211e58(0x1d7),_0x211e58(0x1c9),_0x211e58(0x1c1)+_0x1f35dc['status']+':\x20'+_0x5671e6);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1f35dc[_0x211e58(0x204)]+_0x211e58(0x1ec)+_0x5671e6);}let _0x1a5b08;try{_0x1a5b08=JSON[_0x211e58(0x1da)](_0x5671e6);}catch(_0x20c013){console[_0x211e58(0x1d8)](_0x211e58(0x1c5),_0x20c013),loggerService_1[_0x211e58(0x1e6)][_0x211e58(0x1f0)](_0x211e58(0x1d7),_0x211e58(0x1c9),'JSON\x20Parse\x20Error:\x20'+_0x20c013);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x5671e6);}console['log'](_0x211e58(0x1c4)),console[_0x211e58(0x1ce)](_0x211e58(0x207),JSON[_0x211e58(0x1f8)](_0x1a5b08,null,0x2)),loggerService_1[_0x211e58(0x1e6)][_0x211e58(0x219)](_0x211e58(0x1d7),_0x211e58(0x1c9),_0x1f35dc[_0x211e58(0x204)],_0x1a5b08,_0x1acc43);if(_0x1a5b08[_0x211e58(0x204)]!==_0x211e58(0x1e5)){const _0x2c2cb4=_0x1a5b08[_0x211e58(0x1f7)]||_0x1a5b08[_0x211e58(0x1d8)]||_0x211e58(0x1d1);console[_0x211e58(0x1d8)](_0x211e58(0x1f6)),console[_0x211e58(0x1d8)]('Error\x20Message:',_0x2c2cb4),loggerService_1[_0x211e58(0x1e6)][_0x211e58(0x1f0)](_0x211e58(0x1d7),_0x211e58(0x1c9),_0x211e58(0x1e8)+_0x2c2cb4);throw new Error('Plisio\x20API\x20error:\x20'+_0x2c2cb4);}if(!_0x1a5b08[_0x211e58(0x1fe)]?.['txn_id']||!_0x1a5b08[_0x211e58(0x1fe)]?.[_0x211e58(0x1e2)]){console[_0x211e58(0x1d8)](_0x211e58(0x1d3)),console[_0x211e58(0x1d8)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x211e58(0x1d8)](_0x211e58(0x1b9),_0x1a5b08[_0x211e58(0x1fe)]),loggerService_1['loggerService'][_0x211e58(0x1f0)](_0x211e58(0x1d7),_0x211e58(0x1c9),_0x211e58(0x209));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x211e58(0x1ce)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x211e58(0x1ce)](_0x211e58(0x1f5),_0x1a5b08[_0x211e58(0x1fe)][_0x211e58(0x1f2)]),console['log'](_0x211e58(0x1dc),_0x1a5b08[_0x211e58(0x1fe)][_0x211e58(0x1e2)]),console[_0x211e58(0x1ce)](_0x211e58(0x1e7),_0x1097be,_0x121b3),_0x83a458&&(console['log'](_0x211e58(0x1e9),_0x83a458,'(crypto\x20for\x20payment)'),console[_0x211e58(0x1ce)](_0x211e58(0x21f),_0x121b3,_0x211e58(0x1c6))),{'gateway_payment_id':_0x1a5b08[_0x211e58(0x1fe)][_0x211e58(0x1f2)],'payment_url':_0x1a5b08[_0x211e58(0x1fe)][_0x211e58(0x1e2)],'invoice_total_sum':_0x1a5b08[_0x211e58(0x1fe)][_0x211e58(0x1cd)],'qr_code':_0x1a5b08[_0x211e58(0x1fe)][_0x211e58(0x1c8)],'qr_url':_0x1a5b08[_0x211e58(0x1fe)][_0x211e58(0x202)]};}catch(_0x1081c1){console['error'](_0x211e58(0x201)),console[_0x211e58(0x1d8)](_0x211e58(0x1dd),_0x1081c1),loggerService_1['loggerService'][_0x211e58(0x1f0)](_0x211e58(0x1d7),'/invoices/new',_0x1081c1);if(_0x1081c1 instanceof Error){console[_0x211e58(0x1d8)](_0x211e58(0x1cf),_0x1081c1['message']),console['error'](_0x211e58(0x1be),_0x1081c1[_0x211e58(0x1db)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x1081c1[_0x211e58(0x1f7)]);}throw new Error(_0x211e58(0x1d5));}}async['verifyPayment'](_0x99456a){const _0x3aa816=a41_0x8aaad3,_0x4ad387=Date[_0x3aa816(0x1ef)]();try{if(!this[_0x3aa816(0x20a)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x59b221=new URLSearchParams({'api_key':this[_0x3aa816(0x20a)],'txn_id':_0x99456a}),_0x152dbe=_0x3aa816(0x214)+_0x99456a+'?'+_0x59b221[_0x3aa816(0x1cc)]();loggerService_1[_0x3aa816(0x1e6)]['logWhiteDomainRequest']('plisio_direct',_0x3aa816(0x1fc)+_0x99456a,_0x3aa816(0x1eb),Object[_0x3aa816(0x200)](_0x59b221['entries']()));const _0xc2ae5=await fetch(_0x152dbe,{'method':_0x3aa816(0x1eb),'headers':{'Accept':'application/json','User-Agent':_0x3aa816(0x1ed)}}),_0x432c89=Date[_0x3aa816(0x1ef)]()-_0x4ad387;if(!_0xc2ae5['ok']){const _0x17844d=await _0xc2ae5[_0x3aa816(0x1e1)]();loggerService_1[_0x3aa816(0x1e6)][_0x3aa816(0x219)]('plisio_direct',_0x3aa816(0x1fc)+_0x99456a,_0xc2ae5['status'],_0x17844d,_0x432c89);throw new Error(_0x3aa816(0x21a)+_0xc2ae5['status']);}const _0x365ca7=await _0xc2ae5[_0x3aa816(0x20c)]();loggerService_1['loggerService'][_0x3aa816(0x219)](_0x3aa816(0x1d7),_0x3aa816(0x1fc)+_0x99456a,_0xc2ae5['status'],_0x365ca7,_0x432c89);if(_0x365ca7[_0x3aa816(0x204)]!==_0x3aa816(0x1e5)){loggerService_1[_0x3aa816(0x1e6)]['logWhiteDomainError'](_0x3aa816(0x1d7),_0x3aa816(0x1fc)+_0x99456a,'Plisio\x20API\x20error:\x20'+(_0x365ca7['message']||_0x365ca7['error']||_0x3aa816(0x1f3)));throw new Error(_0x3aa816(0x220)+(_0x365ca7[_0x3aa816(0x1f7)]||_0x365ca7['error']||_0x3aa816(0x1f3)));}let _0x46cf7c=_0x3aa816(0x1fb);return{'status':_0x46cf7c};}catch(_0x454fca){console[_0x3aa816(0x1d8)](_0x3aa816(0x215),_0x454fca),loggerService_1['loggerService'][_0x3aa816(0x1f0)](_0x3aa816(0x1d7),_0x3aa816(0x1fc)+_0x99456a,_0x454fca);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x454fca instanceof Error?_0x454fca[_0x3aa816(0x1f7)]:_0x3aa816(0x1f3)));}}async[a41_0x8aaad3(0x1ba)](_0x1fd020){const _0x295e28=a41_0x8aaad3;console[_0x295e28(0x1ce)](_0x295e28(0x1df),_0x1fd020);let _0x42e266='PENDING';switch(_0x1fd020[_0x295e28(0x204)]?.['toLowerCase']()){case _0x295e28(0x1d6):case _0x295e28(0x213):_0x42e266='PAID';break;case _0x295e28(0x21d):_0x42e266='EXPIRED';break;case _0x295e28(0x1d8):case _0x295e28(0x1c2):_0x42e266='FAILED';break;case _0x295e28(0x218):case _0x295e28(0x1ff):default:_0x42e266=_0x295e28(0x1fb);break;}return{'paymentId':_0x1fd020['order_number']||'','status':_0x42e266,'amount':_0x1fd020[_0x295e28(0x1d2)],'currency':_0x1fd020[_0x295e28(0x1ea)]};}}function a41_0x212f(){const _0x2d68de=['GET',',\x20body:\x20','TesSoft\x20Payment\x20System/1.0','Status\x20Text:','now','logWhiteDomainError','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','txn_id','Unknown\x20error','Full\x20URL\x20(without\x20API\x20key):','Transaction\x20ID:','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','message','stringify','name','apiUrl','PENDING','/operations/','https://api.plisio.net/api/v1/invoices/new','data','pending','fromEntries','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','qr_url','statusText','status','===\x20PLISIO\x20API\x20ERROR\x20===','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Parsed\x20Result:','HIDDEN','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','apiKey','815FbRSoG','json','warn','source_currency','__esModule','6219oriINk','createPayment','../loggerService','mismatch','https://api.plisio.net/api/v1/operations/','Plisio\x20payment\x20verification\x20error:','3TGVHbr','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','new','logWhiteDomainResponse','HTTP\x20error!\x20status:\x20','7CJGolF','59372EPKayr','expired','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Target\x20Currency:','Plisio\x20API\x20error:\x20','application/json','Response\x20data:','processWebhook','Status:','Raw\x20Response\x20Body:','7554poTUtO','Error\x20stack:','974284EdGsbQ','PLISIO_API_KEY','HTTP\x20','cancelled','740HDnNfZ','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Failed\x20to\x20parse\x20JSON\x20response:','(fiat\x20for\x20merchant)','3572899BMrvZU','qr_code','/invoices/new','email','Plisio\x20API\x20key\x20is\x20not\x20configured','toString','invoice_total_sum','log','Error\x20message:','HTTP\x20Status:','Unknown\x20error\x20from\x20Plisio\x20API','amount','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','122618xuVKim','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','completed','plisio_direct','error','replace','parse','stack','Invoice\x20URL:','Error\x20details:','PlisioService','Processing\x20Plisio\x20webhook:','entries','text','invoice_url','449552aEPeeH','append','success','loggerService','Amount:','Business\x20Error:\x20','Source\x20Currency:','currency'];a41_0x212f=function(){return _0x2d68de;};return a41_0x212f();}exports[a41_0x8aaad3(0x1de)]=PlisioService;