'use strict';const a44_0x3c45a0=a44_0x419e;(function(_0x18ffbb,_0x17b16d){const _0x1261d6=a44_0x419e,_0x330895=_0x18ffbb();while(!![]){try{const _0x395737=-parseInt(_0x1261d6(0xfb))/0x1+parseInt(_0x1261d6(0xf1))/0x2+parseInt(_0x1261d6(0xbf))/0x3+-parseInt(_0x1261d6(0xc3))/0x4*(parseInt(_0x1261d6(0xa2))/0x5)+parseInt(_0x1261d6(0x89))/0x6+parseInt(_0x1261d6(0xb9))/0x7*(-parseInt(_0x1261d6(0xb6))/0x8)+parseInt(_0x1261d6(0xcd))/0x9*(parseInt(_0x1261d6(0xba))/0xa);if(_0x395737===_0x17b16d)break;else _0x330895['push'](_0x330895['shift']());}catch(_0x4193c9){_0x330895['push'](_0x330895['shift']());}}}(a44_0x20a7,0x4141c));function a44_0x20a7(){const _0x1b5a4c=['plisio_direct','‚ùå\x20URL\x20','verifyPayment','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','5wMmQJg','‚úÖ\x20Processed\x20tx_urls:','invoice_total_sum','mismatch','Error\x20stack:','application/json','Source\x20Currency:','Amount:','‚úÖ\x20URL\x20','Plisio\x20API\x20error:\x20','invoice_url','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','stringify','Plisio\x20API\x20key\x20is\x20not\x20configured','error','string','apiUrl','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','toString','source_amount','410112qVWrgB','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','pending','35bIvqpx','110hMwfsl','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','Failed\x20to\x20parse\x20JSON\x20response:','/invoices/new','https://apitest.trapay.uk/api/webhooks/gateway/plisio','437619fbZFPD','Plisio\x20payment\x20verification\x20error:','Status\x20Text:','Unknown\x20error\x20from\x20Plisio\x20API','316856FyHrzj','data','HTTP\x20','Parsed\x20Result:','EXPIRED','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Unknown\x20error','HTTP\x20error!\x20status:\x20','FAILED','PENDING','576198AHJyom','forEach','Status:','replace','TesSoft\x20Payment\x20System/1.0','(crypto\x20for\x20payment)','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','defineProperty','stack','\x20->\x20','URL:','logWhiteDomainError','logWhiteDomainResponse','currency','createPayment','../loggerService','amount','PlisioService','\x20is\x20valid:\x20','completed','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','/operations/','txn_id','qr_code','message','logWhiteDomainRequest','Invoice\x20URL:','(fiat\x20for\x20merchant)','\x20is\x20invalid:\x20','https://api.plisio.net/api/v1/operations/','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','fromEntries','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Error\x20Message:','qr_url','new','126960YUJizD','Business\x20Error:\x20','entries','tx_urls','PAID','apiKey','log','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','name','Error\x20details:','519996dxIDDT','append','===\x20PLISIO\x20SUCCESS\x20===','1255362ZvRcGa','Target\x20Currency:','JSON\x20Parse\x20Error:\x20','toLowerCase','cancelled','processWebhook','https://api.plisio.net/api/v1/invoices/new','HTTP\x20Status:','statusText','Response\x20Body:','isArray','parse','map','now','text','status','loggerService','Error\x20message:',',\x20body:\x20','GET','success'];a44_0x20a7=function(){return _0x1b5a4c;};return a44_0x20a7();}function a44_0x419e(_0x2e03eb,_0x34cc32){const _0x20a737=a44_0x20a7();return a44_0x419e=function(_0x419ef3,_0x1711e0){_0x419ef3=_0x419ef3-0x88;let _0x5dd759=_0x20a737[_0x419ef3];return _0x5dd759;},a44_0x419e(_0x2e03eb,_0x34cc32);}Object[a44_0x3c45a0(0xd4)](exports,'__esModule',{'value':!![]}),exports[a44_0x3c45a0(0xde)]=void 0x0;const loggerService_1=require(a44_0x3c45a0(0xdc));class PlisioService{constructor(){const _0x538fe2=a44_0x3c45a0;this[_0x538fe2(0xb2)]=_0x538fe2(0x8f),this[_0x538fe2(0xf6)]=process['env']['PLISIO_API_KEY']||'',!this[_0x538fe2(0xf6)]?console['warn']('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x538fe2(0xf7)](_0x538fe2(0xad));}async[a44_0x3c45a0(0xdb)](_0x11b32d){const _0x29a357=a44_0x3c45a0,{orderId:_0x253b45,amount:_0xc6e3eb,currency:_0x5dec92,productName:_0x317f92,description:_0x4ce32e,successUrl:_0x1c58ab,failUrl:_0x387c16,customerEmail:_0xcd9475,customerName:_0x24d3cc,isSourceCurrency:_0x4cf26a,sourceCurrency:_0x22680f}=_0x11b32d;if(!this[_0x29a357(0xf6)])throw new Error(_0x29a357(0xaf));const _0x1e28e8=new URLSearchParams({'api_key':this[_0x29a357(0xf6)],'order_number':_0x253b45,'order_name':_0x317f92,'description':_0x4ce32e,'success_url':_0x1c58ab,'fail_url':_0x387c16,'callback_url':_0x29a357(0xbe)});_0x22680f?(_0x1e28e8[_0x29a357(0xfc)](_0x29a357(0xda),_0x22680f),_0x1e28e8[_0x29a357(0xfc)]('source_currency',_0x5dec92),_0x1e28e8['append'](_0x29a357(0xb5),_0xc6e3eb[_0x29a357(0xb4)]())):(_0x1e28e8[_0x29a357(0xfc)]('currency',_0x5dec92),_0x1e28e8[_0x29a357(0xfc)]('amount',_0xc6e3eb['toString']()));_0xcd9475&&_0x1e28e8[_0x29a357(0xfc)]('email',_0xcd9475);_0x24d3cc&&_0x1e28e8['append'](_0x29a357(0xf9),_0x24d3cc);const _0x3ec042=this[_0x29a357(0xb2)]+'?'+_0x1e28e8[_0x29a357(0xb4)](),_0x10c40e=Date[_0x29a357(0x96)]();try{console[_0x29a357(0xf7)](_0x29a357(0xed)),console[_0x29a357(0xf7)](_0x29a357(0xd7),this[_0x29a357(0xb2)]),console[_0x29a357(0xf7)]('Parameters:',Object[_0x29a357(0xec)](_0x1e28e8[_0x29a357(0xf3)]())),console[_0x29a357(0xf7)]('Full\x20URL\x20(without\x20API\x20key):',_0x3ec042[_0x29a357(0xd0)](this['apiKey'],'HIDDEN')),loggerService_1[_0x29a357(0x99)][_0x29a357(0xe6)](_0x29a357(0x9e),_0x29a357(0xbd),_0x29a357(0x9c),Object[_0x29a357(0xec)](_0x1e28e8['entries']()));const _0x322f0f=await fetch(_0x3ec042,{'method':'GET','headers':{'Accept':_0x29a357(0xa7),'User-Agent':_0x29a357(0xd1)}}),_0x470965=Date[_0x29a357(0x96)]()-_0x10c40e;console[_0x29a357(0xf7)](_0x29a357(0xeb)),console[_0x29a357(0xf7)](_0x29a357(0xcf),_0x322f0f[_0x29a357(0x98)]),console[_0x29a357(0xf7)](_0x29a357(0xc1),_0x322f0f[_0x29a357(0x91)]),console[_0x29a357(0xf7)]('Response\x20Time:',_0x470965+'ms');const _0x347ba6=await _0x322f0f[_0x29a357(0x97)]();console[_0x29a357(0xf7)]('Raw\x20Response\x20Body:',_0x347ba6);if(!_0x322f0f['ok']){console[_0x29a357(0xb0)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x29a357(0xb0)](_0x29a357(0x90),_0x322f0f[_0x29a357(0x98)]),console[_0x29a357(0xb0)](_0x29a357(0x92),_0x347ba6),loggerService_1[_0x29a357(0x99)]['logWhiteDomainResponse'](_0x29a357(0x9e),'/invoices/new',_0x322f0f[_0x29a357(0x98)],_0x347ba6,_0x470965),loggerService_1['loggerService'][_0x29a357(0xd8)](_0x29a357(0x9e),_0x29a357(0xbd),_0x29a357(0xc5)+_0x322f0f[_0x29a357(0x98)]+':\x20'+_0x347ba6);throw new Error('HTTP\x20error!\x20status:\x20'+_0x322f0f['status']+_0x29a357(0x9b)+_0x347ba6);}let _0x5ba10d;try{_0x5ba10d=JSON[_0x29a357(0x94)](_0x347ba6);}catch(_0x581a66){console[_0x29a357(0xb0)](_0x29a357(0xbc),_0x581a66),loggerService_1[_0x29a357(0x99)][_0x29a357(0xd8)](_0x29a357(0x9e),_0x29a357(0xbd),_0x29a357(0x8b)+_0x581a66);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x347ba6);}console[_0x29a357(0xf7)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x29a357(0xf7)](_0x29a357(0xc6),JSON[_0x29a357(0xae)](_0x5ba10d,null,0x2)),loggerService_1[_0x29a357(0x99)]['logWhiteDomainResponse']('plisio_direct',_0x29a357(0xbd),_0x322f0f[_0x29a357(0x98)],_0x5ba10d,_0x470965);if(_0x5ba10d['status']!==_0x29a357(0x9d)){const _0x217663=_0x5ba10d['message']||_0x5ba10d[_0x29a357(0xb0)]||_0x29a357(0xc2);console[_0x29a357(0xb0)](_0x29a357(0xf8)),console[_0x29a357(0xb0)](_0x29a357(0xee),_0x217663),loggerService_1['loggerService'][_0x29a357(0xd8)]('plisio_direct',_0x29a357(0xbd),_0x29a357(0xf2)+_0x217663);throw new Error(_0x29a357(0xab)+_0x217663);}if(!_0x5ba10d[_0x29a357(0xc4)]?.[_0x29a357(0xe3)]||!_0x5ba10d['data']?.[_0x29a357(0xac)]){console[_0x29a357(0xb0)](_0x29a357(0xb7)),console['error'](_0x29a357(0xbb)),console[_0x29a357(0xb0)]('Response\x20data:',_0x5ba10d[_0x29a357(0xc4)]),loggerService_1[_0x29a357(0x99)]['logWhiteDomainError'](_0x29a357(0x9e),'/invoices/new',_0x29a357(0xd3));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x29a357(0xf7)](_0x29a357(0x88)),console[_0x29a357(0xf7)]('Transaction\x20ID:',_0x5ba10d[_0x29a357(0xc4)][_0x29a357(0xe3)]),console[_0x29a357(0xf7)](_0x29a357(0xe7),_0x5ba10d[_0x29a357(0xc4)][_0x29a357(0xac)]),console['log'](_0x29a357(0xa9),_0xc6e3eb,_0x5dec92),_0x22680f&&(console[_0x29a357(0xf7)](_0x29a357(0xa8),_0x22680f,_0x29a357(0xd2)),console['log'](_0x29a357(0x8a),_0x5dec92,_0x29a357(0xe8))),{'gateway_payment_id':_0x5ba10d[_0x29a357(0xc4)][_0x29a357(0xe3)],'payment_url':_0x5ba10d[_0x29a357(0xc4)][_0x29a357(0xac)],'invoice_total_sum':_0x5ba10d[_0x29a357(0xc4)][_0x29a357(0xa4)],'qr_code':_0x5ba10d['data'][_0x29a357(0xe4)],'qr_url':_0x5ba10d['data'][_0x29a357(0xef)]};}catch(_0x40220d){console[_0x29a357(0xb0)](_0x29a357(0xe1)),console[_0x29a357(0xb0)](_0x29a357(0xfa),_0x40220d),loggerService_1['loggerService'][_0x29a357(0xd8)](_0x29a357(0x9e),_0x29a357(0xbd),_0x40220d);if(_0x40220d instanceof Error){console['error'](_0x29a357(0x9a),_0x40220d[_0x29a357(0xe5)]),console[_0x29a357(0xb0)](_0x29a357(0xa6),_0x40220d[_0x29a357(0xd5)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x40220d[_0x29a357(0xe5)]);}throw new Error(_0x29a357(0xc8));}}async[a44_0x3c45a0(0xa0)](_0x388bd3){const _0xde7cdf=a44_0x3c45a0,_0x18f0a1=Date['now']();try{if(!this[_0xde7cdf(0xf6)])throw new Error(_0xde7cdf(0xaf));const _0x446ae8=new URLSearchParams({'api_key':this[_0xde7cdf(0xf6)],'txn_id':_0x388bd3}),_0x1048ed=_0xde7cdf(0xea)+_0x388bd3+'?'+_0x446ae8[_0xde7cdf(0xb4)]();loggerService_1[_0xde7cdf(0x99)]['logWhiteDomainRequest']('plisio_direct',_0xde7cdf(0xe2)+_0x388bd3,_0xde7cdf(0x9c),Object[_0xde7cdf(0xec)](_0x446ae8[_0xde7cdf(0xf3)]()));const _0x402ed7=await fetch(_0x1048ed,{'method':'GET','headers':{'Accept':_0xde7cdf(0xa7),'User-Agent':_0xde7cdf(0xd1)}}),_0x26e22d=Date[_0xde7cdf(0x96)]()-_0x18f0a1;if(!_0x402ed7['ok']){const _0x5340fa=await _0x402ed7['text']();loggerService_1['loggerService'][_0xde7cdf(0xd9)](_0xde7cdf(0x9e),_0xde7cdf(0xe2)+_0x388bd3,_0x402ed7[_0xde7cdf(0x98)],_0x5340fa,_0x26e22d);throw new Error(_0xde7cdf(0xca)+_0x402ed7['status']);}const _0x104134=await _0x402ed7['json']();loggerService_1['loggerService'][_0xde7cdf(0xd9)](_0xde7cdf(0x9e),_0xde7cdf(0xe2)+_0x388bd3,_0x402ed7[_0xde7cdf(0x98)],_0x104134,_0x26e22d);if(_0x104134[_0xde7cdf(0x98)]!==_0xde7cdf(0x9d)){loggerService_1['loggerService']['logWhiteDomainError'](_0xde7cdf(0x9e),_0xde7cdf(0xe2)+_0x388bd3,_0xde7cdf(0xab)+(_0x104134['message']||_0x104134['error']||_0xde7cdf(0xc9)));throw new Error(_0xde7cdf(0xab)+(_0x104134['message']||_0x104134[_0xde7cdf(0xb0)]||'Unknown\x20error'));}let _0x2c37fd=_0xde7cdf(0xcc);return{'status':_0x2c37fd};}catch(_0x3f13fb){console['error'](_0xde7cdf(0xc0),_0x3f13fb),loggerService_1[_0xde7cdf(0x99)][_0xde7cdf(0xd8)](_0xde7cdf(0x9e),'/operations/'+_0x388bd3,_0x3f13fb);throw new Error(_0xde7cdf(0xa1)+(_0x3f13fb instanceof Error?_0x3f13fb['message']:_0xde7cdf(0xc9)));}}async[a44_0x3c45a0(0x8e)](_0x34953a){const _0x4e10f3=a44_0x3c45a0;console['log']('Processing\x20Plisio\x20webhook:',_0x34953a);let _0x52e870=_0x4e10f3(0xcc);switch(_0x34953a['status']?.[_0x4e10f3(0x8c)]()){case _0x4e10f3(0xe0):case _0x4e10f3(0xa5):_0x52e870=_0x4e10f3(0xf5);break;case'expired':_0x52e870=_0x4e10f3(0xc7);break;case _0x4e10f3(0xb0):case _0x4e10f3(0x8d):_0x52e870=_0x4e10f3(0xcb);break;case _0x4e10f3(0xf0):case _0x4e10f3(0xb8):default:_0x52e870=_0x4e10f3(0xcc);break;}let _0x1acfbf;if(_0x34953a['tx_urls'])try{console['log'](_0x4e10f3(0xb3),_0x34953a[_0x4e10f3(0xf4)]);let _0xe785ff;if(typeof _0x34953a['tx_urls']===_0x4e10f3(0xb1))_0xe785ff=JSON[_0x4e10f3(0x94)](_0x34953a[_0x4e10f3(0xf4)]);else Array[_0x4e10f3(0x93)](_0x34953a[_0x4e10f3(0xf4)])?_0xe785ff=_0x34953a[_0x4e10f3(0xf4)]:_0xe785ff=[];_0x1acfbf=_0xe785ff[_0x4e10f3(0x95)](_0x5d4cc3=>{const _0x25af5a=_0x4e10f3,_0x672b09=_0x5d4cc3[_0x25af5a(0xd0)](/\\/g,'');return console[_0x25af5a(0xf7)]('üîó\x20Formatted\x20URL:\x20'+_0x5d4cc3+_0x25af5a(0xd6)+_0x672b09),_0x672b09;}),console[_0x4e10f3(0xf7)](_0x4e10f3(0xa3),_0x1acfbf),_0x1acfbf[_0x4e10f3(0xce)]((_0x477a1a,_0x299a1f)=>{const _0x473611=_0x4e10f3;try{new URL(_0x477a1a),console[_0x473611(0xf7)](_0x473611(0xaa)+(_0x299a1f+0x1)+_0x473611(0xdf)+_0x477a1a);}catch(_0x2f5f0f){console['error'](_0x473611(0x9f)+(_0x299a1f+0x1)+_0x473611(0xe9)+_0x477a1a,_0x2f5f0f);}});}catch(_0x388748){console[_0x4e10f3(0xb0)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x388748),console[_0x4e10f3(0xb0)]('Raw\x20tx_urls\x20data:',_0x34953a[_0x4e10f3(0xf4)]),_0x1acfbf=undefined;}return{'paymentId':_0x34953a['order_number']||'','status':_0x52e870,'amount':_0x34953a[_0x4e10f3(0xdd)],'currency':_0x34953a['currency'],'txUrls':_0x1acfbf};}}exports[a44_0x3c45a0(0xde)]=PlisioService;