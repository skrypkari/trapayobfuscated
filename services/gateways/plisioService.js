'use strict';const a41_0x38f057=a41_0x3bb7;(function(_0x452cf0,_0x594ef2){const _0x2a2d2d=a41_0x3bb7,_0x41f758=_0x452cf0();while(!![]){try{const _0x19429=-parseInt(_0x2a2d2d(0x229))/0x1+-parseInt(_0x2a2d2d(0x1e9))/0x2+parseInt(_0x2a2d2d(0x1d6))/0x3+parseInt(_0x2a2d2d(0x235))/0x4*(parseInt(_0x2a2d2d(0x20e))/0x5)+-parseInt(_0x2a2d2d(0x1dd))/0x6+parseInt(_0x2a2d2d(0x216))/0x7+parseInt(_0x2a2d2d(0x21a))/0x8*(-parseInt(_0x2a2d2d(0x22e))/0x9);if(_0x19429===_0x594ef2)break;else _0x41f758['push'](_0x41f758['shift']());}catch(_0x1ab98a){_0x41f758['push'](_0x41f758['shift']());}}}(a41_0x3ede,0xde625));Object['defineProperty'](exports,a41_0x38f057(0x1d2),{'value':!![]}),exports[a41_0x38f057(0x1fa)]=void 0x0;const loggerService_1=require(a41_0x38f057(0x232));class PlisioService{constructor(){const _0x52e911=a41_0x38f057;this[_0x52e911(0x22d)]=_0x52e911(0x23b),this[_0x52e911(0x1ea)]=process['env']['PLISIO_API_KEY']||'',!this[_0x52e911(0x1ea)]?console[_0x52e911(0x1dc)](_0x52e911(0x203)):console[_0x52e911(0x227)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a41_0x38f057(0x217)](_0x3e3249){const _0x57a296=a41_0x38f057,{orderId:_0x3f3da3,amount:_0x3dead1,currency:_0x458fea,productName:_0x4ae15f,description:_0x37505c,successUrl:_0x352c9e,failUrl:_0x2a6a6b,customerEmail:_0x313ff9,customerName:_0x58d353,isSourceCurrency:_0x3759ec,sourceCurrency:_0x3f1a5b}=_0x3e3249;if(!this[_0x57a296(0x1ea)])throw new Error(_0x57a296(0x205));const _0x1acac3=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x3f3da3,'order_name':_0x4ae15f,'description':_0x37505c,'success_url':_0x352c9e,'fail_url':_0x2a6a6b,'callback_url':_0x57a296(0x1f0)});_0x3f1a5b?(_0x1acac3[_0x57a296(0x1fc)](_0x57a296(0x21c),_0x3f1a5b),_0x1acac3[_0x57a296(0x1fc)](_0x57a296(0x209),_0x458fea),_0x1acac3[_0x57a296(0x1fc)](_0x57a296(0x1e2),_0x3dead1[_0x57a296(0x224)]())):(_0x1acac3[_0x57a296(0x1fc)](_0x57a296(0x21c),_0x458fea),_0x1acac3['append']('amount',_0x3dead1['toString']()));_0x313ff9&&_0x1acac3[_0x57a296(0x1fc)](_0x57a296(0x234),_0x313ff9);_0x58d353&&_0x1acac3[_0x57a296(0x1fc)](_0x57a296(0x21f),_0x58d353);const _0x520b33=this[_0x57a296(0x22d)]+'?'+_0x1acac3[_0x57a296(0x224)](),_0x1a8304=Date[_0x57a296(0x231)]();try{console[_0x57a296(0x227)](_0x57a296(0x1f9)),console[_0x57a296(0x227)](_0x57a296(0x1d8),this[_0x57a296(0x22d)]),console[_0x57a296(0x227)](_0x57a296(0x218),Object[_0x57a296(0x1ef)](_0x1acac3['entries']())),console[_0x57a296(0x227)]('Full\x20URL\x20(without\x20API\x20key):',_0x520b33[_0x57a296(0x1d7)](this[_0x57a296(0x1ea)],_0x57a296(0x1d1))),loggerService_1[_0x57a296(0x22b)][_0x57a296(0x204)](_0x57a296(0x221),_0x57a296(0x20d),'GET',Object['fromEntries'](_0x1acac3[_0x57a296(0x20b)]()));const _0xac83b7=await fetch(_0x520b33,{'method':_0x57a296(0x1df),'headers':{'Accept':_0x57a296(0x1f8),'User-Agent':_0x57a296(0x233)}}),_0xaa6bf0=Date[_0x57a296(0x231)]()-_0x1a8304;console[_0x57a296(0x227)](_0x57a296(0x220)),console[_0x57a296(0x227)](_0x57a296(0x1e6),_0xac83b7[_0x57a296(0x1f3)]),console[_0x57a296(0x227)](_0x57a296(0x202),_0xac83b7['statusText']),console[_0x57a296(0x227)](_0x57a296(0x206),_0xaa6bf0+'ms');const _0x2106d4=await _0xac83b7[_0x57a296(0x1fd)]();console[_0x57a296(0x227)](_0x57a296(0x1f1),_0x2106d4);if(!_0xac83b7['ok']){console[_0x57a296(0x21e)](_0x57a296(0x214)),console['error'](_0x57a296(0x200),_0xac83b7[_0x57a296(0x1f3)]),console[_0x57a296(0x21e)](_0x57a296(0x238),_0x2106d4),loggerService_1[_0x57a296(0x22b)][_0x57a296(0x1f4)](_0x57a296(0x221),_0x57a296(0x20d),_0xac83b7['status'],_0x2106d4,_0xaa6bf0),loggerService_1['loggerService'][_0x57a296(0x22a)]('plisio_direct','/invoices/new',_0x57a296(0x22c)+_0xac83b7[_0x57a296(0x1f3)]+':\x20'+_0x2106d4);throw new Error(_0x57a296(0x208)+_0xac83b7[_0x57a296(0x1f3)]+_0x57a296(0x1e7)+_0x2106d4);}let _0x27e3d9;try{_0x27e3d9=JSON[_0x57a296(0x1ed)](_0x2106d4);}catch(_0x535653){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x535653),loggerService_1[_0x57a296(0x22b)][_0x57a296(0x22a)](_0x57a296(0x221),_0x57a296(0x20d),_0x57a296(0x228)+_0x535653);throw new Error(_0x57a296(0x23c)+_0x2106d4);}console[_0x57a296(0x227)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x57a296(0x227)](_0x57a296(0x1e1),JSON[_0x57a296(0x1fe)](_0x27e3d9,null,0x2)),loggerService_1[_0x57a296(0x22b)][_0x57a296(0x1f4)](_0x57a296(0x221),_0x57a296(0x20d),_0xac83b7['status'],_0x27e3d9,_0xaa6bf0);if(_0x27e3d9[_0x57a296(0x1f3)]!=='success'){const _0x5ab21e=_0x27e3d9[_0x57a296(0x1f6)]||_0x27e3d9[_0x57a296(0x21e)]||_0x57a296(0x1d4);console[_0x57a296(0x21e)](_0x57a296(0x222)),console[_0x57a296(0x21e)](_0x57a296(0x236),_0x5ab21e),loggerService_1['loggerService']['logWhiteDomainError'](_0x57a296(0x221),'/invoices/new',_0x57a296(0x1e3)+_0x5ab21e);throw new Error(_0x57a296(0x237)+_0x5ab21e);}if(!_0x27e3d9[_0x57a296(0x239)]?.[_0x57a296(0x201)]||!_0x27e3d9[_0x57a296(0x239)]?.[_0x57a296(0x1d9)]){console[_0x57a296(0x21e)](_0x57a296(0x207)),console[_0x57a296(0x21e)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x57a296(0x21e)]('Response\x20data:',_0x27e3d9['data']),loggerService_1[_0x57a296(0x22b)][_0x57a296(0x22a)]('plisio_direct','/invoices/new','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x57a296(0x223));}return console[_0x57a296(0x227)](_0x57a296(0x1f5)),console[_0x57a296(0x227)](_0x57a296(0x1ee),_0x27e3d9[_0x57a296(0x239)][_0x57a296(0x201)]),console[_0x57a296(0x227)](_0x57a296(0x1f2),_0x27e3d9[_0x57a296(0x239)]['invoice_url']),console[_0x57a296(0x227)](_0x57a296(0x1e8),_0x3dead1,_0x458fea),_0x3f1a5b&&(console['log'](_0x57a296(0x225),_0x3f1a5b,_0x57a296(0x1e5)),console[_0x57a296(0x227)](_0x57a296(0x20f),_0x458fea,_0x57a296(0x210))),{'gateway_payment_id':_0x27e3d9[_0x57a296(0x239)][_0x57a296(0x201)],'payment_url':_0x27e3d9[_0x57a296(0x239)][_0x57a296(0x1d9)],'invoice_total_sum':_0x27e3d9[_0x57a296(0x239)][_0x57a296(0x1db)],'qr_code':_0x27e3d9[_0x57a296(0x239)][_0x57a296(0x1ff)],'qr_url':_0x27e3d9[_0x57a296(0x239)]['qr_url']};}catch(_0x172faf){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console['error'](_0x57a296(0x20c),_0x172faf),loggerService_1['loggerService'][_0x57a296(0x22a)](_0x57a296(0x221),_0x57a296(0x20d),_0x172faf);if(_0x172faf instanceof Error){console['error']('Error\x20message:',_0x172faf[_0x57a296(0x1f6)]),console[_0x57a296(0x21e)](_0x57a296(0x20a),_0x172faf['stack']);throw new Error(_0x57a296(0x1e4)+_0x172faf[_0x57a296(0x1f6)]);}throw new Error(_0x57a296(0x1d3));}}async[a41_0x38f057(0x22f)](_0x3ee776){const _0x4da0c6=a41_0x38f057,_0x28df8b=Date[_0x4da0c6(0x231)]();try{if(!this[_0x4da0c6(0x1ea)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x299d00=new URLSearchParams({'api_key':this[_0x4da0c6(0x1ea)],'txn_id':_0x3ee776}),_0x36a608=_0x4da0c6(0x1de)+_0x3ee776+'?'+_0x299d00[_0x4da0c6(0x224)]();loggerService_1['loggerService'][_0x4da0c6(0x204)]('plisio_direct','/operations/'+_0x3ee776,'GET',Object[_0x4da0c6(0x1ef)](_0x299d00[_0x4da0c6(0x20b)]()));const _0x5a2213=await fetch(_0x36a608,{'method':_0x4da0c6(0x1df),'headers':{'Accept':_0x4da0c6(0x1f8),'User-Agent':_0x4da0c6(0x233)}}),_0x4112b4=Date['now']()-_0x28df8b;if(!_0x5a2213['ok']){const _0x642094=await _0x5a2213[_0x4da0c6(0x1fd)]();loggerService_1[_0x4da0c6(0x22b)][_0x4da0c6(0x1f4)]('plisio_direct',_0x4da0c6(0x1e0)+_0x3ee776,_0x5a2213[_0x4da0c6(0x1f3)],_0x642094,_0x4112b4);throw new Error(_0x4da0c6(0x208)+_0x5a2213[_0x4da0c6(0x1f3)]);}const _0x1e7f2d=await _0x5a2213[_0x4da0c6(0x1da)]();loggerService_1['loggerService'][_0x4da0c6(0x1f4)](_0x4da0c6(0x221),'/operations/'+_0x3ee776,_0x5a2213[_0x4da0c6(0x1f3)],_0x1e7f2d,_0x4112b4);if(_0x1e7f2d[_0x4da0c6(0x1f3)]!==_0x4da0c6(0x21b)){loggerService_1['loggerService']['logWhiteDomainError'](_0x4da0c6(0x221),_0x4da0c6(0x1e0)+_0x3ee776,_0x4da0c6(0x237)+(_0x1e7f2d[_0x4da0c6(0x1f6)]||_0x1e7f2d['error']||_0x4da0c6(0x1d5)));throw new Error(_0x4da0c6(0x237)+(_0x1e7f2d['message']||_0x1e7f2d[_0x4da0c6(0x21e)]||_0x4da0c6(0x1d5)));}let _0x59e4e2=_0x4da0c6(0x1ec);return{'status':_0x59e4e2};}catch(_0x4def0a){console[_0x4da0c6(0x21e)](_0x4da0c6(0x21d),_0x4def0a),loggerService_1[_0x4da0c6(0x22b)][_0x4da0c6(0x22a)](_0x4da0c6(0x221),'/operations/'+_0x3ee776,_0x4def0a);throw new Error(_0x4da0c6(0x219)+(_0x4def0a instanceof Error?_0x4def0a['message']:_0x4da0c6(0x1d5)));}}async['processWebhook'](_0x5da8d6){const _0x200c0e=a41_0x38f057;console[_0x200c0e(0x227)](_0x200c0e(0x1fb),_0x5da8d6);let _0x15287a=_0x200c0e(0x1ec);switch(_0x5da8d6[_0x200c0e(0x1f3)]?.[_0x200c0e(0x213)]()){case _0x200c0e(0x212):case _0x200c0e(0x226):_0x15287a=_0x200c0e(0x211);break;case _0x200c0e(0x215):_0x15287a='EXPIRED';break;case _0x200c0e(0x21e):case'cancelled':_0x15287a=_0x200c0e(0x23a);break;case _0x200c0e(0x230):case'pending':default:_0x15287a=_0x200c0e(0x1ec);break;}return{'paymentId':_0x5da8d6[_0x200c0e(0x1eb)]||'','status':_0x15287a,'amount':_0x5da8d6[_0x200c0e(0x1f7)],'currency':_0x5da8d6[_0x200c0e(0x21c)]};}}exports[a41_0x38f057(0x1fa)]=PlisioService;function a41_0x3bb7(_0x58926,_0x429909){const _0x3edea5=a41_0x3ede();return a41_0x3bb7=function(_0x3bb7f7,_0x1ce0e4){_0x3bb7f7=_0x3bb7f7-0x1d1;let _0xb7233b=_0x3edea5[_0x3bb7f7];return _0xb7233b;},a41_0x3bb7(_0x58926,_0x429909);}function a41_0x3ede(){const _0xf1b628=['../loggerService','TesSoft\x20Payment\x20System/1.0','email','92xNnNvp','Error\x20Message:','Plisio\x20API\x20error:\x20','Response\x20Body:','data','FAILED','https://api.plisio.net/api/v1/invoices/new','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','HIDDEN','__esModule','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Unknown\x20error\x20from\x20Plisio\x20API','Unknown\x20error','4801395IbRynm','replace','URL:','invoice_url','json','invoice_total_sum','warn','1968192xeioyw','https://api.plisio.net/api/v1/operations/','GET','/operations/','Parsed\x20Result:','source_amount','Business\x20Error:\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20','(crypto\x20for\x20payment)','Status:',',\x20body:\x20','Amount:','1336564qeLEkA','apiKey','order_number','PENDING','parse','Transaction\x20ID:','fromEntries','https://api.trapay.uk/api/webhooks/gateway/plisio','Raw\x20Response\x20Body:','Invoice\x20URL:','status','logWhiteDomainResponse','===\x20PLISIO\x20SUCCESS\x20===','message','amount','application/json','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','PlisioService','Processing\x20Plisio\x20webhook:','append','text','stringify','qr_code','HTTP\x20Status:','txn_id','Status\x20Text:','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','logWhiteDomainRequest','Plisio\x20API\x20key\x20is\x20not\x20configured','Response\x20Time:','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20error!\x20status:\x20','source_currency','Error\x20stack:','entries','Error\x20details:','/invoices/new','38615XGXWzP','Target\x20Currency:','(fiat\x20for\x20merchant)','PAID','completed','toLowerCase','===\x20PLISIO\x20API\x20ERROR\x20===','expired','8386756MQgFlk','createPayment','Parameters:','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','24zZMMmM','success','currency','Plisio\x20payment\x20verification\x20error:','error','name','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','plisio_direct','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','toString','Source\x20Currency:','mismatch','log','JSON\x20Parse\x20Error:\x20','834370GwPBrl','logWhiteDomainError','loggerService','HTTP\x20','apiUrl','703899WPbWjO','verifyPayment','new','now'];a41_0x3ede=function(){return _0xf1b628;};return a41_0x3ede();}