'use strict';const a62_0x12a812=a62_0x348b;(function(_0x3454a8,_0x203803){const _0x4fb3dd=a62_0x348b,_0x35f7dc=_0x3454a8();while(!![]){try{const _0x56a268=parseInt(_0x4fb3dd(0x21c))/0x1*(parseInt(_0x4fb3dd(0x240))/0x2)+parseInt(_0x4fb3dd(0x208))/0x3*(parseInt(_0x4fb3dd(0x226))/0x4)+-parseInt(_0x4fb3dd(0x25f))/0x5+-parseInt(_0x4fb3dd(0x253))/0x6*(-parseInt(_0x4fb3dd(0x23f))/0x7)+-parseInt(_0x4fb3dd(0x234))/0x8*(-parseInt(_0x4fb3dd(0x1fd))/0x9)+-parseInt(_0x4fb3dd(0x25c))/0xa*(-parseInt(_0x4fb3dd(0x255))/0xb)+-parseInt(_0x4fb3dd(0x238))/0xc;if(_0x56a268===_0x203803)break;else _0x35f7dc['push'](_0x35f7dc['shift']());}catch(_0x5339d1){_0x35f7dc['push'](_0x35f7dc['shift']());}}}(a62_0x252b,0x63d4c));function a62_0x348b(_0x3f1b56,_0x2244c2){_0x3f1b56=_0x3f1b56-0x1f4;const _0x252b41=a62_0x252b();let _0x348b2f=_0x252b41[_0x3f1b56];return _0x348b2f;}Object[a62_0x12a812(0x231)](exports,a62_0x12a812(0x235),{'value':!![]}),exports[a62_0x12a812(0x22e)]=void 0x0;function a62_0x252b(){const _0x5e71d1=['2690570UTAnAc','URL:','toLowerCase','‚úÖ\x20URL\x20','GET','Error\x20stack:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Invoice\x20URL:','new','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Unknown\x20error','Response\x20data:','Payment\x20System/1.0','Unknown\x20error\x20from\x20Plisio\x20API','Business\x20Error:\x20','üîó\x20Formatted\x20URL:\x20','HTTP\x20error!\x20status:\x20','Response\x20Body:','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','HTTP\x20Status:','https://api.plisio.net/api/v1/operations/','invoice_url','qr_code','22131Zitlal','currency','PLISIO_API_KEY','pending','loggerService','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','source_amount','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','\x20->\x20','(fiat\x20for\x20merchant)','order_number','12gdvRzG','parse','Failed\x20to\x20parse\x20JSON\x20response:','/invoices/new','fromEntries','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','data','Parsed\x20Result:','../loggerService','Plisio\x20payment\x20verification\x20error:','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','FAILED','Status\x20Text:','EXPIRED','logWhiteDomainResponse','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','message','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Transaction\x20ID:','qr_url','55SamfcT','/operations/','now','Source\x20Currency:','(crypto\x20for\x20payment)','string','email','\x20is\x20valid:\x20','stack','map','796888zYkOuF','===\x20PLISIO\x20SUCCESS\x20===','Plisio\x20API\x20key\x20is\x20not\x20configured','Error\x20details:','toString','===\x20PLISIO\x20API\x20ERROR\x20===','plisio_direct','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','PlisioService','tx_urls','env','defineProperty','Status:','stringify','136SbUQBE','__esModule','txn_id','Amount:','14055264DUvycG','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Full\x20URL\x20(without\x20API\x20key):','Processing\x20Plisio\x20webhook:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','amount','logWhiteDomainError','1212442xtnYcA','13406Xgtxnc','PROCESSING','text','apiUrl','isArray','Error\x20message:','log','processWebhook','success','application/json','entries','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Error\x20Message:','https://api.plisio.net/api/v1/invoices/new','mismatch','replace','error','forEach','status','6utIbNp','PENDING','3553LbYAWF','cancelled','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Target\x20Currency:','expired','apiKey','Plisio\x20API\x20error:\x20','22840xLQDwN','append','JSON\x20Parse\x20Error:\x20'];a62_0x252b=function(){return _0x5e71d1;};return a62_0x252b();}const loggerService_1=require(a62_0x12a812(0x210));class PlisioService{constructor(){const _0x50a1d2=a62_0x12a812;this['apiUrl']=_0x50a1d2(0x24d),this[_0x50a1d2(0x25a)]=process[_0x50a1d2(0x230)][_0x50a1d2(0x1ff)]||'',!this[_0x50a1d2(0x25a)]?console['warn'](_0x50a1d2(0x1f8)):console[_0x50a1d2(0x246)](_0x50a1d2(0x20d));}async['createPayment'](_0x11c17c){const _0x3102ff=a62_0x12a812,{orderId:_0x35bb3a,amount:_0x2c91cc,currency:_0x40c308,productName:_0x31e7b4,description:_0x94120c,successUrl:_0x382570,failUrl:_0x4a995f,customerEmail:_0x4007c5,customerName:_0x51ab55,isSourceCurrency:_0x1727e8,sourceCurrency:_0x20e835}=_0x11c17c;if(!this[_0x3102ff(0x25a)])throw new Error(_0x3102ff(0x228));const _0x9b9a67=new URLSearchParams({'api_key':this[_0x3102ff(0x25a)],'order_number':_0x35bb3a,'order_name':_0x31e7b4,'description':_0x94120c,'success_url':_0x382570,'fail_url':_0x4a995f,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x20e835?(_0x9b9a67[_0x3102ff(0x25d)](_0x3102ff(0x1fe),_0x20e835),_0x9b9a67['append']('source_currency',_0x40c308),_0x9b9a67[_0x3102ff(0x25d)](_0x3102ff(0x203),_0x2c91cc['toString']())):(_0x9b9a67[_0x3102ff(0x25d)](_0x3102ff(0x1fe),_0x40c308),_0x9b9a67['append'](_0x3102ff(0x23d),_0x2c91cc[_0x3102ff(0x22a)]()));_0x4007c5&&_0x9b9a67[_0x3102ff(0x25d)](_0x3102ff(0x222),_0x4007c5);_0x51ab55&&_0x9b9a67[_0x3102ff(0x25d)]('name',_0x51ab55);const _0x2c15ab=this['apiUrl']+'?'+_0x9b9a67[_0x3102ff(0x22a)](),_0x2cc8ae=Date[_0x3102ff(0x21e)]();try{console[_0x3102ff(0x246)](_0x3102ff(0x239)),console[_0x3102ff(0x246)](_0x3102ff(0x260),this[_0x3102ff(0x243)]),console[_0x3102ff(0x246)]('Parameters:',Object[_0x3102ff(0x20c)](_0x9b9a67[_0x3102ff(0x24a)]())),console[_0x3102ff(0x246)](_0x3102ff(0x23a),_0x2c15ab[_0x3102ff(0x24f)](this[_0x3102ff(0x25a)],'HIDDEN')),loggerService_1[_0x3102ff(0x201)]['logWhiteDomainRequest'](_0x3102ff(0x22c),_0x3102ff(0x20b),_0x3102ff(0x263),Object['fromEntries'](_0x9b9a67[_0x3102ff(0x24a)]()));const _0x26b241=await fetch(_0x2c15ab,{'method':_0x3102ff(0x263),'headers':{'Accept':_0x3102ff(0x249),'User-Agent':_0x3102ff(0x26b)}}),_0x156cbb=Date[_0x3102ff(0x21e)]()-_0x2cc8ae;console[_0x3102ff(0x246)](_0x3102ff(0x268)),console['log'](_0x3102ff(0x232),_0x26b241[_0x3102ff(0x252)]),console['log'](_0x3102ff(0x214),_0x26b241['statusText']),console[_0x3102ff(0x246)]('Response\x20Time:',_0x156cbb+'ms');const _0x44572d=await _0x26b241[_0x3102ff(0x242)]();console['log']('Raw\x20Response\x20Body:',_0x44572d);if(!_0x26b241['ok']){console[_0x3102ff(0x250)](_0x3102ff(0x22b)),console[_0x3102ff(0x250)](_0x3102ff(0x1f9),_0x26b241[_0x3102ff(0x252)]),console[_0x3102ff(0x250)](_0x3102ff(0x1f7),_0x44572d),loggerService_1[_0x3102ff(0x201)][_0x3102ff(0x216)](_0x3102ff(0x22c),_0x3102ff(0x20b),_0x26b241[_0x3102ff(0x252)],_0x44572d,_0x156cbb),loggerService_1[_0x3102ff(0x201)]['logWhiteDomainError'](_0x3102ff(0x22c),_0x3102ff(0x20b),'HTTP\x20'+_0x26b241[_0x3102ff(0x252)]+':\x20'+_0x44572d);throw new Error(_0x3102ff(0x1f6)+_0x26b241[_0x3102ff(0x252)]+',\x20body:\x20'+_0x44572d);}let _0x3c2faa;try{_0x3c2faa=JSON[_0x3102ff(0x209)](_0x44572d);}catch(_0x54fdf2){console[_0x3102ff(0x250)](_0x3102ff(0x20a),_0x54fdf2),loggerService_1['loggerService'][_0x3102ff(0x23e)]('plisio_direct',_0x3102ff(0x20b),_0x3102ff(0x25e)+_0x54fdf2);throw new Error(_0x3102ff(0x202)+_0x44572d);}console[_0x3102ff(0x246)](_0x3102ff(0x219)),console[_0x3102ff(0x246)](_0x3102ff(0x20f),JSON[_0x3102ff(0x233)](_0x3c2faa,null,0x2)),loggerService_1[_0x3102ff(0x201)]['logWhiteDomainResponse'](_0x3102ff(0x22c),_0x3102ff(0x20b),_0x26b241['status'],_0x3c2faa,_0x156cbb);if(_0x3c2faa['status']!==_0x3102ff(0x248)){const _0x403cc9=_0x3c2faa[_0x3102ff(0x218)]||_0x3c2faa[_0x3102ff(0x250)]||_0x3102ff(0x26c);console[_0x3102ff(0x250)](_0x3102ff(0x22d)),console[_0x3102ff(0x250)](_0x3102ff(0x24c),_0x403cc9),loggerService_1[_0x3102ff(0x201)][_0x3102ff(0x23e)]('plisio_direct',_0x3102ff(0x20b),_0x3102ff(0x1f4)+_0x403cc9);throw new Error(_0x3102ff(0x25b)+_0x403cc9);}if(!_0x3c2faa[_0x3102ff(0x20e)]?.[_0x3102ff(0x236)]||!_0x3c2faa['data']?.['invoice_url']){console['error'](_0x3102ff(0x217)),console['error'](_0x3102ff(0x204)),console[_0x3102ff(0x250)](_0x3102ff(0x26a),_0x3c2faa[_0x3102ff(0x20e)]),loggerService_1[_0x3102ff(0x201)]['logWhiteDomainError'](_0x3102ff(0x22c),'/invoices/new',_0x3102ff(0x23c));throw new Error(_0x3102ff(0x265));}return console[_0x3102ff(0x246)](_0x3102ff(0x227)),console['log'](_0x3102ff(0x21a),_0x3c2faa[_0x3102ff(0x20e)]['txn_id']),console[_0x3102ff(0x246)](_0x3102ff(0x266),_0x3c2faa['data'][_0x3102ff(0x1fb)]),console[_0x3102ff(0x246)](_0x3102ff(0x237),_0x2c91cc,_0x40c308),_0x20e835&&(console[_0x3102ff(0x246)](_0x3102ff(0x21f),_0x20e835,_0x3102ff(0x220)),console[_0x3102ff(0x246)](_0x3102ff(0x258),_0x40c308,_0x3102ff(0x206))),{'gateway_payment_id':_0x3c2faa[_0x3102ff(0x20e)][_0x3102ff(0x236)],'payment_url':_0x3c2faa[_0x3102ff(0x20e)]['invoice_url'],'invoice_total_sum':_0x3c2faa['data']['invoice_total_sum'],'qr_code':_0x3c2faa['data'][_0x3102ff(0x1fc)],'qr_url':_0x3c2faa[_0x3102ff(0x20e)][_0x3102ff(0x21b)]};}catch(_0x22ef5e){console[_0x3102ff(0x250)](_0x3102ff(0x212)),console['error'](_0x3102ff(0x229),_0x22ef5e),loggerService_1[_0x3102ff(0x201)][_0x3102ff(0x23e)]('plisio_direct',_0x3102ff(0x20b),_0x22ef5e);if(_0x22ef5e instanceof Error){console[_0x3102ff(0x250)](_0x3102ff(0x245),_0x22ef5e['message']),console[_0x3102ff(0x250)](_0x3102ff(0x264),_0x22ef5e[_0x3102ff(0x224)]);throw new Error(_0x3102ff(0x257)+_0x22ef5e[_0x3102ff(0x218)]);}throw new Error(_0x3102ff(0x24b));}}async['verifyPayment'](_0x332235){const _0x5e5e47=a62_0x12a812,_0x44ec72=Date[_0x5e5e47(0x21e)]();try{if(!this[_0x5e5e47(0x25a)])throw new Error(_0x5e5e47(0x228));const _0x546e99=new URLSearchParams({'api_key':this[_0x5e5e47(0x25a)],'txn_id':_0x332235}),_0x83a251=_0x5e5e47(0x1fa)+_0x332235+'?'+_0x546e99['toString']();loggerService_1[_0x5e5e47(0x201)]['logWhiteDomainRequest']('plisio_direct',_0x5e5e47(0x21d)+_0x332235,'GET',Object['fromEntries'](_0x546e99['entries']()));const _0x58b49d=await fetch(_0x83a251,{'method':_0x5e5e47(0x263),'headers':{'Accept':_0x5e5e47(0x249),'User-Agent':_0x5e5e47(0x26b)}}),_0x21d057=Date[_0x5e5e47(0x21e)]()-_0x44ec72;if(!_0x58b49d['ok']){const _0x4c0cf5=await _0x58b49d[_0x5e5e47(0x242)]();loggerService_1[_0x5e5e47(0x201)][_0x5e5e47(0x216)]('plisio_direct',_0x5e5e47(0x21d)+_0x332235,_0x58b49d[_0x5e5e47(0x252)],_0x4c0cf5,_0x21d057);throw new Error(_0x5e5e47(0x1f6)+_0x58b49d[_0x5e5e47(0x252)]);}const _0x39b66e=await _0x58b49d['json']();loggerService_1[_0x5e5e47(0x201)][_0x5e5e47(0x216)](_0x5e5e47(0x22c),'/operations/'+_0x332235,_0x58b49d[_0x5e5e47(0x252)],_0x39b66e,_0x21d057);if(_0x39b66e[_0x5e5e47(0x252)]!==_0x5e5e47(0x248)){loggerService_1['loggerService']['logWhiteDomainError'](_0x5e5e47(0x22c),_0x5e5e47(0x21d)+_0x332235,_0x5e5e47(0x25b)+(_0x39b66e[_0x5e5e47(0x218)]||_0x39b66e[_0x5e5e47(0x250)]||'Unknown\x20error'));throw new Error(_0x5e5e47(0x25b)+(_0x39b66e[_0x5e5e47(0x218)]||_0x39b66e[_0x5e5e47(0x250)]||_0x5e5e47(0x269)));}let _0xbe180a=_0x5e5e47(0x254);return{'status':_0xbe180a};}catch(_0x53e0ab){console[_0x5e5e47(0x250)](_0x5e5e47(0x211),_0x53e0ab),loggerService_1[_0x5e5e47(0x201)][_0x5e5e47(0x23e)]('plisio_direct',_0x5e5e47(0x21d)+_0x332235,_0x53e0ab);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x53e0ab instanceof Error?_0x53e0ab[_0x5e5e47(0x218)]:_0x5e5e47(0x269)));}}async[a62_0x12a812(0x247)](_0x1d42c8){const _0x27cf13=a62_0x12a812;console[_0x27cf13(0x246)](_0x27cf13(0x23b),_0x1d42c8);let _0x4e7500='PENDING';switch(_0x1d42c8[_0x27cf13(0x252)]?.[_0x27cf13(0x261)]()){case'completed':case _0x27cf13(0x24e):_0x4e7500='PAID';break;case _0x27cf13(0x259):_0x4e7500=_0x27cf13(0x215);break;case _0x27cf13(0x250):case _0x27cf13(0x256):_0x4e7500=_0x27cf13(0x213);break;case _0x27cf13(0x267):_0x4e7500=_0x27cf13(0x254);break;case _0x27cf13(0x200):_0x4e7500=_0x27cf13(0x241);break;default:_0x4e7500=_0x27cf13(0x254);break;}let _0x16ea49;if(_0x1d42c8[_0x27cf13(0x22f)])try{console[_0x27cf13(0x246)]('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x1d42c8[_0x27cf13(0x22f)]);let _0x5912e6;if(typeof _0x1d42c8[_0x27cf13(0x22f)]===_0x27cf13(0x221))_0x5912e6=JSON[_0x27cf13(0x209)](_0x1d42c8[_0x27cf13(0x22f)]);else Array[_0x27cf13(0x244)](_0x1d42c8['tx_urls'])?_0x5912e6=_0x1d42c8[_0x27cf13(0x22f)]:_0x5912e6=[];_0x16ea49=_0x5912e6[_0x27cf13(0x225)](_0xe36a5=>{const _0x56768b=_0x27cf13,_0xb83d3d=_0xe36a5[_0x56768b(0x24f)](/\\/g,'');return console['log'](_0x56768b(0x1f5)+_0xe36a5+_0x56768b(0x205)+_0xb83d3d),_0xb83d3d;}),console[_0x27cf13(0x246)]('‚úÖ\x20Processed\x20tx_urls:',_0x16ea49),_0x16ea49[_0x27cf13(0x251)]((_0x5a8f3a,_0x5236f7)=>{const _0x238598=_0x27cf13;try{new URL(_0x5a8f3a),console[_0x238598(0x246)](_0x238598(0x262)+(_0x5236f7+0x1)+_0x238598(0x223)+_0x5a8f3a);}catch(_0x4ebb50){console['error']('‚ùå\x20URL\x20'+(_0x5236f7+0x1)+'\x20is\x20invalid:\x20'+_0x5a8f3a,_0x4ebb50);}});}catch(_0x8588f3){console[_0x27cf13(0x250)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x8588f3),console['error']('Raw\x20tx_urls\x20data:',_0x1d42c8[_0x27cf13(0x22f)]),_0x16ea49=undefined;}return{'paymentId':_0x1d42c8[_0x27cf13(0x207)]||'','status':_0x4e7500,'amount':_0x1d42c8[_0x27cf13(0x23d)],'currency':_0x1d42c8[_0x27cf13(0x1fe)],'txUrls':_0x16ea49};}}exports['PlisioService']=PlisioService;