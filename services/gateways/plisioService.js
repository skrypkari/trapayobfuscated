'use strict';const a44_0xbcd941=a44_0x4929;(function(_0x38aeb6,_0xebdfa9){const _0x1df892=a44_0x4929,_0x458965=_0x38aeb6();while(!![]){try{const _0x1d246b=parseInt(_0x1df892(0x1d6))/0x1+-parseInt(_0x1df892(0x1c8))/0x2+-parseInt(_0x1df892(0x1e9))/0x3*(-parseInt(_0x1df892(0x1ae))/0x4)+parseInt(_0x1df892(0x1e1))/0x5*(parseInt(_0x1df892(0x1b5))/0x6)+parseInt(_0x1df892(0x1bd))/0x7*(-parseInt(_0x1df892(0x1f0))/0x8)+-parseInt(_0x1df892(0x208))/0x9*(parseInt(_0x1df892(0x21a))/0xa)+-parseInt(_0x1df892(0x1f7))/0xb*(parseInt(_0x1df892(0x1c4))/0xc);if(_0x1d246b===_0xebdfa9)break;else _0x458965['push'](_0x458965['shift']());}catch(_0x5af9a2){_0x458965['push'](_0x458965['shift']());}}}(a44_0x121d,0xdee4c));function a44_0x121d(){const _0x499683=['Full\x20URL\x20(without\x20API\x20key):','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','invoice_url','Unknown\x20error\x20from\x20Plisio\x20API','31386WGZFKj','currency','createPayment','completed','append','HTTP\x20','Parameters:','20168HeqpAO','Error\x20message:','Source\x20Currency:','https://apitest.trapay.uk/api/webhooks/gateway/plisio','name','apiUrl','TesSoft\x20Payment\x20System/1.0','11EGxceE','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','parse','expired','warn','logWhiteDomainError','replace','application/json','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','logWhiteDomainResponse','message','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','defineProperty','source_amount','Unknown\x20error','URL:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','9lcNLMf','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','PAID','/invoices/new','Failed\x20to\x20create\x20Plisio\x20payment:\x20','plisio_direct','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','HIDDEN','HTTP\x20error!\x20status:\x20','log','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','source_currency','PlisioService','loggerService','Response\x20Time:','GET','mismatch','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','5687420FmcCdK','Plisio\x20API\x20error:\x20','env','❌\x20URL\x20','===\x20PLISIO\x20SUCCESS\x20===','✅\x20Processed\x20tx_urls:','Processing\x20Plisio\x20webhook:','text','400aRfGeA','entries','stack','✅\x20URL\x20','apiKey','now','https://api.plisio.net/api/v1/invoices/new','6oQrZPx','toString','order_number','Status\x20Text:','__esModule','Invoice\x20URL:','data','Plisio\x20API\x20key\x20is\x20not\x20configured','2548zOyKXz','toLowerCase','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','\x20->\x20','PENDING','txn_id','../loggerService','9736800zMnjky','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20Status:','PLISIO_API_KEY','2623544ViZPVv','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','/operations/','error','Failed\x20to\x20parse\x20JSON\x20response:','Amount:','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','statusText','\x20is\x20invalid:\x20','Business\x20Error:\x20','qr_url','processWebhook','status','map','1651831RyoWIc','success','qr_code','logWhiteDomainRequest','tx_urls','amount','Raw\x20Response\x20Body:','Plisio\x20payment\x20verification\x20error:','(crypto\x20for\x20payment)','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','JSON\x20Parse\x20Error:\x20','9122495lCCuJZ','forEach','Response\x20Body:','fromEntries'];a44_0x121d=function(){return _0x499683;};return a44_0x121d();}Object[a44_0xbcd941(0x203)](exports,a44_0xbcd941(0x1b9),{'value':!![]}),exports['PlisioService']=void 0x0;function a44_0x4929(_0x34abc0,_0x126d40){const _0x121db1=a44_0x121d();return a44_0x4929=function(_0x4929de,_0x2e858e){_0x4929de=_0x4929de-0x1aa;let _0x234e10=_0x121db1[_0x4929de];return _0x234e10;},a44_0x4929(_0x34abc0,_0x126d40);}const loggerService_1=require(a44_0xbcd941(0x1c3));class PlisioService{constructor(){const _0x5a94d1=a44_0xbcd941;this[_0x5a94d1(0x1f5)]=_0x5a94d1(0x1b4),this[_0x5a94d1(0x1b2)]=process[_0x5a94d1(0x21c)][_0x5a94d1(0x1c7)]||'',!this[_0x5a94d1(0x1b2)]?console[_0x5a94d1(0x1fb)](_0x5a94d1(0x20e)):console['log'](_0x5a94d1(0x219));}async[a44_0xbcd941(0x1eb)](_0x447c7e){const _0x505a34=a44_0xbcd941,{orderId:_0x2d8d9a,amount:_0x46c2a7,currency:_0x2939f0,productName:_0x1649a9,description:_0x21205a,successUrl:_0x3ba2a0,failUrl:_0x490899,customerEmail:_0x46d031,customerName:_0x3cfd22,isSourceCurrency:_0x5cc4ed,sourceCurrency:_0x3401e2}=_0x447c7e;if(!this[_0x505a34(0x1b2)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x3aedbf=new URLSearchParams({'api_key':this[_0x505a34(0x1b2)],'order_number':_0x2d8d9a,'order_name':_0x1649a9,'description':_0x21205a,'success_url':_0x3ba2a0,'fail_url':_0x490899,'callback_url':_0x505a34(0x1f3)});_0x3401e2?(_0x3aedbf[_0x505a34(0x1ed)](_0x505a34(0x1ea),_0x3401e2),_0x3aedbf[_0x505a34(0x1ed)](_0x505a34(0x213),_0x2939f0),_0x3aedbf[_0x505a34(0x1ed)](_0x505a34(0x204),_0x46c2a7[_0x505a34(0x1b6)]())):(_0x3aedbf[_0x505a34(0x1ed)]('currency',_0x2939f0),_0x3aedbf['append'](_0x505a34(0x1db),_0x46c2a7[_0x505a34(0x1b6)]()));_0x46d031&&_0x3aedbf[_0x505a34(0x1ed)]('email',_0x46d031);_0x3cfd22&&_0x3aedbf[_0x505a34(0x1ed)](_0x505a34(0x1f4),_0x3cfd22);const _0x130b5b=this['apiUrl']+'?'+_0x3aedbf[_0x505a34(0x1b6)](),_0x1ff315=Date[_0x505a34(0x1b3)]();try{console[_0x505a34(0x211)](_0x505a34(0x202)),console[_0x505a34(0x211)](_0x505a34(0x206),this[_0x505a34(0x1f5)]),console[_0x505a34(0x211)](_0x505a34(0x1ef),Object[_0x505a34(0x1e4)](_0x3aedbf[_0x505a34(0x1af)]())),console[_0x505a34(0x211)](_0x505a34(0x1e5),_0x130b5b[_0x505a34(0x1fd)](this[_0x505a34(0x1b2)],_0x505a34(0x20f))),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x505a34(0x20d),_0x505a34(0x20b),'GET',Object[_0x505a34(0x1e4)](_0x3aedbf[_0x505a34(0x1af)]()));const _0x4127ef=await fetch(_0x130b5b,{'method':_0x505a34(0x217),'headers':{'Accept':_0x505a34(0x1fe),'User-Agent':_0x505a34(0x1f6)}}),_0x1b6ee6=Date['now']()-_0x1ff315;console[_0x505a34(0x211)](_0x505a34(0x207)),console[_0x505a34(0x211)]('Status:',_0x4127ef['status']),console[_0x505a34(0x211)](_0x505a34(0x1b8),_0x4127ef[_0x505a34(0x1cf)]),console['log'](_0x505a34(0x216),_0x1b6ee6+'ms');const _0x19f0f2=await _0x4127ef[_0x505a34(0x1ad)]();console[_0x505a34(0x211)](_0x505a34(0x1dc),_0x19f0f2);if(!_0x4127ef['ok']){console[_0x505a34(0x1cb)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error'](_0x505a34(0x1c6),_0x4127ef[_0x505a34(0x1d4)]),console['error'](_0x505a34(0x1e3),_0x19f0f2),loggerService_1['loggerService'][_0x505a34(0x200)]('plisio_direct','/invoices/new',_0x4127ef[_0x505a34(0x1d4)],_0x19f0f2,_0x1b6ee6),loggerService_1[_0x505a34(0x215)][_0x505a34(0x1fc)](_0x505a34(0x20d),_0x505a34(0x20b),_0x505a34(0x1ee)+_0x4127ef[_0x505a34(0x1d4)]+':\x20'+_0x19f0f2);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4127ef['status']+',\x20body:\x20'+_0x19f0f2);}let _0x437b02;try{_0x437b02=JSON[_0x505a34(0x1f9)](_0x19f0f2);}catch(_0x1fa7fc){console[_0x505a34(0x1cb)](_0x505a34(0x1cc),_0x1fa7fc),loggerService_1[_0x505a34(0x215)][_0x505a34(0x1fc)]('plisio_direct','/invoices/new',_0x505a34(0x1e0)+_0x1fa7fc);throw new Error(_0x505a34(0x1ff)+_0x19f0f2);}console['log'](_0x505a34(0x209)),console[_0x505a34(0x211)]('Parsed\x20Result:',JSON['stringify'](_0x437b02,null,0x2)),loggerService_1[_0x505a34(0x215)][_0x505a34(0x200)](_0x505a34(0x20d),_0x505a34(0x20b),_0x4127ef[_0x505a34(0x1d4)],_0x437b02,_0x1b6ee6);if(_0x437b02['status']!==_0x505a34(0x1d7)){const _0x3d5c03=_0x437b02[_0x505a34(0x201)]||_0x437b02[_0x505a34(0x1cb)]||_0x505a34(0x1e8);console[_0x505a34(0x1cb)](_0x505a34(0x1f8)),console['error']('Error\x20Message:',_0x3d5c03),loggerService_1[_0x505a34(0x215)][_0x505a34(0x1fc)](_0x505a34(0x20d),_0x505a34(0x20b),_0x505a34(0x1d1)+_0x3d5c03);throw new Error('Plisio\x20API\x20error:\x20'+_0x3d5c03);}if(!_0x437b02[_0x505a34(0x1bb)]?.[_0x505a34(0x1c2)]||!_0x437b02[_0x505a34(0x1bb)]?.[_0x505a34(0x1e7)]){console[_0x505a34(0x1cb)](_0x505a34(0x1c5)),console[_0x505a34(0x1cb)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x505a34(0x1cb)]('Response\x20data:',_0x437b02[_0x505a34(0x1bb)]),loggerService_1[_0x505a34(0x215)]['logWhiteDomainError']('plisio_direct',_0x505a34(0x20b),_0x505a34(0x1df));throw new Error(_0x505a34(0x212));}return console[_0x505a34(0x211)](_0x505a34(0x1aa)),console[_0x505a34(0x211)]('Transaction\x20ID:',_0x437b02[_0x505a34(0x1bb)][_0x505a34(0x1c2)]),console[_0x505a34(0x211)](_0x505a34(0x1ba),_0x437b02['data'][_0x505a34(0x1e7)]),console[_0x505a34(0x211)](_0x505a34(0x1cd),_0x46c2a7,_0x2939f0),_0x3401e2&&(console['log'](_0x505a34(0x1f2),_0x3401e2,_0x505a34(0x1de)),console['log']('Target\x20Currency:',_0x2939f0,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x437b02['data']['txn_id'],'payment_url':_0x437b02[_0x505a34(0x1bb)]['invoice_url'],'invoice_total_sum':_0x437b02[_0x505a34(0x1bb)]['invoice_total_sum'],'qr_code':_0x437b02[_0x505a34(0x1bb)][_0x505a34(0x1d8)],'qr_url':_0x437b02[_0x505a34(0x1bb)][_0x505a34(0x1d2)]};}catch(_0x177241){console[_0x505a34(0x1cb)](_0x505a34(0x1bf)),console['error']('Error\x20details:',_0x177241),loggerService_1['loggerService'][_0x505a34(0x1fc)]('plisio_direct',_0x505a34(0x20b),_0x177241);if(_0x177241 instanceof Error){console['error'](_0x505a34(0x1f1),_0x177241['message']),console[_0x505a34(0x1cb)]('Error\x20stack:',_0x177241[_0x505a34(0x1b0)]);throw new Error(_0x505a34(0x20c)+_0x177241[_0x505a34(0x201)]);}throw new Error(_0x505a34(0x1ce));}}async['verifyPayment'](_0x37307d){const _0x381d7b=a44_0xbcd941,_0x190c7c=Date['now']();try{if(!this['apiKey'])throw new Error(_0x381d7b(0x1bc));const _0x521eb6=new URLSearchParams({'api_key':this[_0x381d7b(0x1b2)],'txn_id':_0x37307d}),_0x3c2dc8='https://api.plisio.net/api/v1/operations/'+_0x37307d+'?'+_0x521eb6['toString']();loggerService_1[_0x381d7b(0x215)][_0x381d7b(0x1d9)](_0x381d7b(0x20d),_0x381d7b(0x1ca)+_0x37307d,_0x381d7b(0x217),Object[_0x381d7b(0x1e4)](_0x521eb6[_0x381d7b(0x1af)]()));const _0x3022c8=await fetch(_0x3c2dc8,{'method':_0x381d7b(0x217),'headers':{'Accept':_0x381d7b(0x1fe),'User-Agent':_0x381d7b(0x1f6)}}),_0x2d0d3b=Date['now']()-_0x190c7c;if(!_0x3022c8['ok']){const _0x280fd6=await _0x3022c8[_0x381d7b(0x1ad)]();loggerService_1[_0x381d7b(0x215)]['logWhiteDomainResponse'](_0x381d7b(0x20d),_0x381d7b(0x1ca)+_0x37307d,_0x3022c8['status'],_0x280fd6,_0x2d0d3b);throw new Error(_0x381d7b(0x210)+_0x3022c8[_0x381d7b(0x1d4)]);}const _0x290d5a=await _0x3022c8['json']();loggerService_1[_0x381d7b(0x215)][_0x381d7b(0x200)]('plisio_direct',_0x381d7b(0x1ca)+_0x37307d,_0x3022c8[_0x381d7b(0x1d4)],_0x290d5a,_0x2d0d3b);if(_0x290d5a['status']!==_0x381d7b(0x1d7)){loggerService_1[_0x381d7b(0x215)]['logWhiteDomainError'](_0x381d7b(0x20d),_0x381d7b(0x1ca)+_0x37307d,_0x381d7b(0x21b)+(_0x290d5a[_0x381d7b(0x201)]||_0x290d5a[_0x381d7b(0x1cb)]||_0x381d7b(0x205)));throw new Error(_0x381d7b(0x21b)+(_0x290d5a[_0x381d7b(0x201)]||_0x290d5a[_0x381d7b(0x1cb)]||'Unknown\x20error'));}let _0x2fe6db=_0x381d7b(0x1c1);return{'status':_0x2fe6db};}catch(_0x539824){console[_0x381d7b(0x1cb)](_0x381d7b(0x1dd),_0x539824),loggerService_1[_0x381d7b(0x215)][_0x381d7b(0x1fc)](_0x381d7b(0x20d),'/operations/'+_0x37307d,_0x539824);throw new Error(_0x381d7b(0x1e6)+(_0x539824 instanceof Error?_0x539824[_0x381d7b(0x201)]:'Unknown\x20error'));}}async[a44_0xbcd941(0x1d3)](_0x789117){const _0x4b1c66=a44_0xbcd941;console[_0x4b1c66(0x211)](_0x4b1c66(0x1ac),_0x789117);let _0x20e3e3=_0x4b1c66(0x1c1);switch(_0x789117[_0x4b1c66(0x1d4)]?.[_0x4b1c66(0x1be)]()){case _0x4b1c66(0x1ec):case _0x4b1c66(0x218):_0x20e3e3=_0x4b1c66(0x20a);break;case _0x4b1c66(0x1fa):_0x20e3e3='EXPIRED';break;case'error':case'cancelled':_0x20e3e3='FAILED';break;case'new':case'pending':default:_0x20e3e3=_0x4b1c66(0x1c1);break;}let _0x1fa594;if(_0x789117['tx_urls'])try{console[_0x4b1c66(0x211)](_0x4b1c66(0x1c9),_0x789117[_0x4b1c66(0x1da)]);let _0x22d9b2;if(typeof _0x789117[_0x4b1c66(0x1da)]==='string')_0x22d9b2=JSON[_0x4b1c66(0x1f9)](_0x789117[_0x4b1c66(0x1da)]);else Array['isArray'](_0x789117[_0x4b1c66(0x1da)])?_0x22d9b2=_0x789117[_0x4b1c66(0x1da)]:_0x22d9b2=[];_0x1fa594=_0x22d9b2[_0x4b1c66(0x1d5)](_0x4488d1=>{const _0x41540a=_0x4b1c66,_0x22a16f=_0x4488d1[_0x41540a(0x1fd)](/\\/g,'');return console[_0x41540a(0x211)]('🔗\x20Formatted\x20URL:\x20'+_0x4488d1+_0x41540a(0x1c0)+_0x22a16f),_0x22a16f;}),console['log'](_0x4b1c66(0x1ab),_0x1fa594),_0x1fa594[_0x4b1c66(0x1e2)]((_0x345460,_0x20e410)=>{const _0x464beb=_0x4b1c66;try{new URL(_0x345460),console[_0x464beb(0x211)](_0x464beb(0x1b1)+(_0x20e410+0x1)+'\x20is\x20valid:\x20'+_0x345460);}catch(_0x43e5c0){console[_0x464beb(0x1cb)](_0x464beb(0x21d)+(_0x20e410+0x1)+_0x464beb(0x1d0)+_0x345460,_0x43e5c0);}});}catch(_0x5dc38e){console[_0x4b1c66(0x1cb)]('❌\x20Failed\x20to\x20parse\x20tx_urls:',_0x5dc38e),console[_0x4b1c66(0x1cb)]('Raw\x20tx_urls\x20data:',_0x789117[_0x4b1c66(0x1da)]),_0x1fa594=undefined;}return{'paymentId':_0x789117[_0x4b1c66(0x1b7)]||'','status':_0x20e3e3,'amount':_0x789117['amount'],'currency':_0x789117[_0x4b1c66(0x1ea)],'txUrls':_0x1fa594};}}exports[a44_0xbcd941(0x214)]=PlisioService;