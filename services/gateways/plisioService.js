'use strict';const a41_0x470a11=a41_0x3b34;(function(_0x197d6c,_0x3b1205){const _0x1de949=a41_0x3b34,_0x5ac05f=_0x197d6c();while(!![]){try{const _0x3e24fc=parseInt(_0x1de949(0x14f))/0x1+parseInt(_0x1de949(0x175))/0x2*(parseInt(_0x1de949(0x11b))/0x3)+-parseInt(_0x1de949(0x146))/0x4*(-parseInt(_0x1de949(0x147))/0x5)+-parseInt(_0x1de949(0x126))/0x6+parseInt(_0x1de949(0x116))/0x7+-parseInt(_0x1de949(0x170))/0x8+-parseInt(_0x1de949(0x13c))/0x9*(-parseInt(_0x1de949(0x119))/0xa);if(_0x3e24fc===_0x3b1205)break;else _0x5ac05f['push'](_0x5ac05f['shift']());}catch(_0x489f8f){_0x5ac05f['push'](_0x5ac05f['shift']());}}}(a41_0x1618,0xf0619));function a41_0x3b34(_0x224139,_0x1f0245){const _0x161897=a41_0x1618();return a41_0x3b34=function(_0x3b3444,_0x183bda){_0x3b3444=_0x3b3444-0x10f;let _0x154f57=_0x161897[_0x3b3444];return _0x154f57;},a41_0x3b34(_0x224139,_0x1f0245);}Object[a41_0x470a11(0x111)](exports,a41_0x470a11(0x129),{'value':!![]}),exports['PlisioService']=void 0x0;function a41_0x1618(){const _0x259bdd=['order_number','/operations/','12OeQRqD','376955eAZDxY','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','GET','invoice_total_sum','===\x20PLISIO\x20API\x20ERROR\x20===','(crypto\x20for\x20payment)','apiUrl','JSON\x20Parse\x20Error:\x20','482180UcFfhM','append','log','logWhiteDomainRequest','mismatch','now','Error\x20Message:','amount','txn_id','Response\x20Body:','success','===\x20PLISIO\x20SUCCESS\x20===','env',',\x20body:\x20','Response\x20data:','Invoice\x20URL:','PENDING','TesSoft\x20Payment\x20System/1.0','text','Failed\x20to\x20create\x20Plisio\x20payment:\x20','application/json','logWhiteDomainError','Response\x20Time:','pending','stack','Amount:','HTTP\x20Status:','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','currency','parse','toLowerCase','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','qr_url','2131824swVzqd','message','HIDDEN','fromEntries','source_currency','341482fpIEYT','/invoices/new','data','https://api.plisio.net/api/v1/invoices/new','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','cancelled','Error\x20details:','defineProperty','loggerService','Full\x20URL\x20(without\x20API\x20key):','entries','Error\x20message:','5867680aIYcqo','Unknown\x20error','logWhiteDomainResponse','10FeZKbS','statusText','6iprppx','Plisio\x20API\x20error:\x20','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','EXPIRED','Processing\x20Plisio\x20webhook:','Transaction\x20ID:','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','FAILED','toString','error','expired','7622238rtznJG','Error\x20stack:','source_amount','__esModule','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','invoice_url','HTTP\x20error!\x20status:\x20','processWebhook','Status\x20Text:','email','replace','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','../loggerService','createPayment','(fiat\x20for\x20merchant)','Plisio\x20API\x20key\x20is\x20not\x20configured','Raw\x20Response\x20Body:','apiKey','stringify','Parameters:','PlisioService','5700393zutWWp','plisio_direct','Unknown\x20error\x20from\x20Plisio\x20API','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20','status','https://api.plisio.net/api/v1/operations/','Status:'];a41_0x1618=function(){return _0x259bdd;};return a41_0x1618();}const loggerService_1=require(a41_0x470a11(0x133));class PlisioService{constructor(){const _0x39a657=a41_0x470a11;this['apiUrl']=_0x39a657(0x178),this[_0x39a657(0x138)]=process[_0x39a657(0x15b)]['PLISIO_API_KEY']||'',!this[_0x39a657(0x138)]?console['warn'](_0x39a657(0x121)):console[_0x39a657(0x151)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a41_0x470a11(0x134)](_0x8c2e41){const _0x553a89=a41_0x470a11,{orderId:_0x80dc49,amount:_0x284f2f,currency:_0x51d1c9,productName:_0x3081e2,description:_0x4ceb7f,successUrl:_0x2d5d17,failUrl:_0x483949,customerEmail:_0x3991be,customerName:_0x5b8068,isSourceCurrency:_0x653319,sourceCurrency:_0x5ec1d1}=_0x8c2e41;if(!this[_0x553a89(0x138)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x561cc7=new URLSearchParams({'api_key':this[_0x553a89(0x138)],'order_number':_0x80dc49,'order_name':_0x3081e2,'description':_0x4ceb7f,'success_url':_0x2d5d17,'fail_url':_0x483949,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x5ec1d1?(_0x561cc7[_0x553a89(0x150)](_0x553a89(0x16b),_0x5ec1d1),_0x561cc7[_0x553a89(0x150)](_0x553a89(0x174),_0x51d1c9),_0x561cc7[_0x553a89(0x150)](_0x553a89(0x128),_0x284f2f[_0x553a89(0x123)]())):(_0x561cc7[_0x553a89(0x150)]('currency',_0x51d1c9),_0x561cc7['append'](_0x553a89(0x156),_0x284f2f[_0x553a89(0x123)]()));_0x3991be&&_0x561cc7[_0x553a89(0x150)](_0x553a89(0x130),_0x3991be);_0x5b8068&&_0x561cc7[_0x553a89(0x150)]('name',_0x5b8068);const _0x2d637e=this[_0x553a89(0x14d)]+'?'+_0x561cc7[_0x553a89(0x123)](),_0x840c9e=Date[_0x553a89(0x154)]();try{console['log']('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x553a89(0x151)]('URL:',this[_0x553a89(0x14d)]),console[_0x553a89(0x151)](_0x553a89(0x13a),Object['fromEntries'](_0x561cc7['entries']())),console['log'](_0x553a89(0x113),_0x2d637e[_0x553a89(0x131)](this[_0x553a89(0x138)],_0x553a89(0x172))),loggerService_1[_0x553a89(0x112)][_0x553a89(0x152)](_0x553a89(0x13d),_0x553a89(0x176),_0x553a89(0x149),Object[_0x553a89(0x173)](_0x561cc7[_0x553a89(0x114)]()));const _0x1f60af=await fetch(_0x2d637e,{'method':'GET','headers':{'Accept':_0x553a89(0x163),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x35ad8b=Date[_0x553a89(0x154)]()-_0x840c9e;console[_0x553a89(0x151)](_0x553a89(0x11d)),console[_0x553a89(0x151)](_0x553a89(0x143),_0x1f60af['status']),console[_0x553a89(0x151)](_0x553a89(0x12f),_0x1f60af[_0x553a89(0x11a)]),console['log'](_0x553a89(0x165),_0x35ad8b+'ms');const _0x542fa2=await _0x1f60af[_0x553a89(0x161)]();console[_0x553a89(0x151)](_0x553a89(0x137),_0x542fa2);if(!_0x1f60af['ok']){console[_0x553a89(0x124)](_0x553a89(0x14b)),console['error'](_0x553a89(0x169),_0x1f60af[_0x553a89(0x141)]),console[_0x553a89(0x124)](_0x553a89(0x158),_0x542fa2),loggerService_1[_0x553a89(0x112)][_0x553a89(0x118)](_0x553a89(0x13d),_0x553a89(0x176),_0x1f60af[_0x553a89(0x141)],_0x542fa2,_0x35ad8b),loggerService_1[_0x553a89(0x112)][_0x553a89(0x164)]('plisio_direct',_0x553a89(0x176),_0x553a89(0x140)+_0x1f60af['status']+':\x20'+_0x542fa2);throw new Error(_0x553a89(0x12d)+_0x1f60af['status']+_0x553a89(0x15c)+_0x542fa2);}let _0x2a8f36;try{_0x2a8f36=JSON[_0x553a89(0x16c)](_0x542fa2);}catch(_0x238258){console[_0x553a89(0x124)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x238258),loggerService_1[_0x553a89(0x112)][_0x553a89(0x164)]('plisio_direct',_0x553a89(0x176),_0x553a89(0x14e)+_0x238258);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x542fa2);}console['log'](_0x553a89(0x179)),console['log']('Parsed\x20Result:',JSON[_0x553a89(0x139)](_0x2a8f36,null,0x2)),loggerService_1[_0x553a89(0x112)]['logWhiteDomainResponse'](_0x553a89(0x13d),'/invoices/new',_0x1f60af[_0x553a89(0x141)],_0x2a8f36,_0x35ad8b);if(_0x2a8f36[_0x553a89(0x141)]!==_0x553a89(0x159)){const _0x24b4d6=_0x2a8f36[_0x553a89(0x171)]||_0x2a8f36[_0x553a89(0x124)]||_0x553a89(0x13e);console[_0x553a89(0x124)](_0x553a89(0x13f)),console['error'](_0x553a89(0x155),_0x24b4d6),loggerService_1[_0x553a89(0x112)]['logWhiteDomainError'](_0x553a89(0x13d),_0x553a89(0x176),'Business\x20Error:\x20'+_0x24b4d6);throw new Error('Plisio\x20API\x20error:\x20'+_0x24b4d6);}if(!_0x2a8f36[_0x553a89(0x177)]?.[_0x553a89(0x157)]||!_0x2a8f36[_0x553a89(0x177)]?.['invoice_url']){console[_0x553a89(0x124)](_0x553a89(0x16e)),console[_0x553a89(0x124)](_0x553a89(0x12a)),console[_0x553a89(0x124)](_0x553a89(0x15d),_0x2a8f36[_0x553a89(0x177)]),loggerService_1['loggerService'][_0x553a89(0x164)]('plisio_direct','/invoices/new',_0x553a89(0x12b));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x553a89(0x151)](_0x553a89(0x15a)),console[_0x553a89(0x151)](_0x553a89(0x120),_0x2a8f36[_0x553a89(0x177)][_0x553a89(0x157)]),console['log'](_0x553a89(0x15e),_0x2a8f36[_0x553a89(0x177)][_0x553a89(0x12c)]),console[_0x553a89(0x151)](_0x553a89(0x168),_0x284f2f,_0x51d1c9),_0x5ec1d1&&(console[_0x553a89(0x151)]('Source\x20Currency:',_0x5ec1d1,_0x553a89(0x14c)),console[_0x553a89(0x151)]('Target\x20Currency:',_0x51d1c9,_0x553a89(0x135))),{'gateway_payment_id':_0x2a8f36[_0x553a89(0x177)][_0x553a89(0x157)],'payment_url':_0x2a8f36[_0x553a89(0x177)][_0x553a89(0x12c)],'invoice_total_sum':_0x2a8f36['data'][_0x553a89(0x14a)],'qr_code':_0x2a8f36[_0x553a89(0x177)]['qr_code'],'qr_url':_0x2a8f36['data'][_0x553a89(0x16f)]};}catch(_0x2de2ae){console[_0x553a89(0x124)](_0x553a89(0x132)),console[_0x553a89(0x124)](_0x553a89(0x110),_0x2de2ae),loggerService_1['loggerService'][_0x553a89(0x164)]('plisio_direct','/invoices/new',_0x2de2ae);if(_0x2de2ae instanceof Error){console['error'](_0x553a89(0x115),_0x2de2ae[_0x553a89(0x171)]),console[_0x553a89(0x124)](_0x553a89(0x127),_0x2de2ae[_0x553a89(0x167)]);throw new Error(_0x553a89(0x162)+_0x2de2ae[_0x553a89(0x171)]);}throw new Error(_0x553a89(0x16a));}}async['verifyPayment'](_0x48ac9a){const _0x1cad2f=a41_0x470a11,_0x2f649e=Date[_0x1cad2f(0x154)]();try{if(!this[_0x1cad2f(0x138)])throw new Error(_0x1cad2f(0x136));const _0xcb43ba=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x48ac9a}),_0x144e8c=_0x1cad2f(0x142)+_0x48ac9a+'?'+_0xcb43ba[_0x1cad2f(0x123)]();loggerService_1[_0x1cad2f(0x112)][_0x1cad2f(0x152)](_0x1cad2f(0x13d),_0x1cad2f(0x145)+_0x48ac9a,_0x1cad2f(0x149),Object[_0x1cad2f(0x173)](_0xcb43ba[_0x1cad2f(0x114)]()));const _0x2a996b=await fetch(_0x144e8c,{'method':'GET','headers':{'Accept':_0x1cad2f(0x163),'User-Agent':_0x1cad2f(0x160)}}),_0x3e9871=Date[_0x1cad2f(0x154)]()-_0x2f649e;if(!_0x2a996b['ok']){const _0x234bcf=await _0x2a996b[_0x1cad2f(0x161)]();loggerService_1[_0x1cad2f(0x112)][_0x1cad2f(0x118)]('plisio_direct',_0x1cad2f(0x145)+_0x48ac9a,_0x2a996b[_0x1cad2f(0x141)],_0x234bcf,_0x3e9871);throw new Error(_0x1cad2f(0x12d)+_0x2a996b[_0x1cad2f(0x141)]);}const _0xedccf2=await _0x2a996b['json']();loggerService_1[_0x1cad2f(0x112)][_0x1cad2f(0x118)](_0x1cad2f(0x13d),_0x1cad2f(0x145)+_0x48ac9a,_0x2a996b[_0x1cad2f(0x141)],_0xedccf2,_0x3e9871);if(_0xedccf2['status']!==_0x1cad2f(0x159)){loggerService_1['loggerService']['logWhiteDomainError'](_0x1cad2f(0x13d),_0x1cad2f(0x145)+_0x48ac9a,_0x1cad2f(0x11c)+(_0xedccf2[_0x1cad2f(0x171)]||_0xedccf2[_0x1cad2f(0x124)]||_0x1cad2f(0x117)));throw new Error('Plisio\x20API\x20error:\x20'+(_0xedccf2[_0x1cad2f(0x171)]||_0xedccf2[_0x1cad2f(0x124)]||'Unknown\x20error'));}let _0x396827=_0x1cad2f(0x15f);return{'status':_0x396827};}catch(_0x3cfd2d){console['error']('Plisio\x20payment\x20verification\x20error:',_0x3cfd2d),loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct',_0x1cad2f(0x145)+_0x48ac9a,_0x3cfd2d);throw new Error(_0x1cad2f(0x148)+(_0x3cfd2d instanceof Error?_0x3cfd2d[_0x1cad2f(0x171)]:_0x1cad2f(0x117)));}}async[a41_0x470a11(0x12e)](_0x2fe34f){const _0x3e6b42=a41_0x470a11;console['log'](_0x3e6b42(0x11f),_0x2fe34f);let _0x120fcf=_0x3e6b42(0x15f);switch(_0x2fe34f[_0x3e6b42(0x141)]?.[_0x3e6b42(0x16d)]()){case'completed':case _0x3e6b42(0x153):_0x120fcf='PAID';break;case _0x3e6b42(0x125):_0x120fcf=_0x3e6b42(0x11e);break;case _0x3e6b42(0x124):case _0x3e6b42(0x10f):_0x120fcf=_0x3e6b42(0x122);break;case'new':case _0x3e6b42(0x166):default:_0x120fcf=_0x3e6b42(0x15f);break;}return{'paymentId':_0x2fe34f[_0x3e6b42(0x144)]||'','status':_0x120fcf,'amount':_0x2fe34f[_0x3e6b42(0x156)],'currency':_0x2fe34f[_0x3e6b42(0x16b)]};}}exports[a41_0x470a11(0x13b)]=PlisioService;