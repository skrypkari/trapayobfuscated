'use strict';const a45_0x4ccb32=a45_0x539c;function a45_0x102c(){const _0x2ddbd1=['invoice_total_sum','Parameters:','email','===\x20PLISIO\x20SUCCESS\x20===',',\x20body:\x20','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','Parsed\x20Result:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','Transaction\x20ID:','log','(crypto\x20for\x20payment)','HTTP\x20error!\x20status:\x20','verifyPayment','plisio_direct','URL:','entries','isArray','now','1077640WzioNE','expired','parse','Amount:','qr_code','Status\x20Text:','toLowerCase','Unknown\x20error\x20from\x20Plisio\x20API','/invoices/new','forEach','PENDING','HIDDEN','25evrgaX','80oSvyfO','stringify','Error\x20Message:','\x20->\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20','‚úÖ\x20Processed\x20tx_urls:','Target\x20Currency:','Status:','toString','env','Error\x20details:','https://api.plisio.net/api/v1/operations/','Response\x20Body:','error','mismatch','processWebhook','TesSoft\x20Payment\x20System/1.0','currency','8769483fjFPot','replace','PlisioService','Plisio\x20API\x20error:\x20','name','Raw\x20tx_urls\x20data:','PLISIO_API_KEY','invoice_url','logWhiteDomainError','createPayment','Failed\x20to\x20parse\x20JSON\x20response:','success','map','data','\x20is\x20invalid:\x20','order_number','stack','/operations/','json','üîó\x20Formatted\x20URL:\x20','apiUrl','warn','pending','append','HTTP\x20','amount','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','11938evYzTU','loggerService','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','text','Unknown\x20error','https://api.plisio.net/api/v1/invoices/new','fromEntries','message','170xtOHxO','status','8322354OnLSAE','Raw\x20Response\x20Body:','Business\x20Error:\x20','Source\x20Currency:','tx_urls','Processing\x20Plisio\x20webhook:','cancelled','new','Plisio\x20API\x20key\x20is\x20not\x20configured','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','txn_id','EXPIRED','qr_url','logWhiteDomainRequest','FAILED','Response\x20data:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','12151200qxHmiJ','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','logWhiteDomainResponse','JSON\x20Parse\x20Error:\x20','completed','source_amount','apiKey','665181JDEeRj','HTTP\x20Status:','../loggerService','GET','(fiat\x20for\x20merchant)','130354ZyqVSZ'];a45_0x102c=function(){return _0x2ddbd1;};return a45_0x102c();}(function(_0x3ad137,_0x4c1766){const _0x17e386=a45_0x539c,_0x175912=_0x3ad137();while(!![]){try{const _0xc984e7=-parseInt(_0x17e386(0x1ac))/0x1*(parseInt(_0x17e386(0x1a4))/0x2)+-parseInt(_0x17e386(0x151))/0x3+parseInt(_0x17e386(0x16a))/0x4*(parseInt(_0x17e386(0x176))/0x5)+-parseInt(_0x17e386(0x1ae))/0x6+parseInt(_0x17e386(0x156))/0x7*(-parseInt(_0x17e386(0x177))/0x8)+parseInt(_0x17e386(0x189))/0x9+parseInt(_0x17e386(0x1bf))/0xa;if(_0xc984e7===_0x4c1766)break;else _0x175912['push'](_0x175912['shift']());}catch(_0xa30f5a){_0x175912['push'](_0x175912['shift']());}}}(a45_0x102c,0xb1725));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a45_0x4ccb32(0x153));class PlisioService{constructor(){const _0x19b6c5=a45_0x4ccb32;this[_0x19b6c5(0x19d)]=_0x19b6c5(0x1a9),this[_0x19b6c5(0x150)]=process[_0x19b6c5(0x180)][_0x19b6c5(0x18f)]||'',!this[_0x19b6c5(0x150)]?console[_0x19b6c5(0x19e)]('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x19b6c5(0x161)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a45_0x4ccb32(0x192)](_0x5a7b26){const _0x1f6257=a45_0x4ccb32,{orderId:_0x5a6469,amount:_0x3a7020,currency:_0x1c6301,productName:_0x53ab00,description:_0x57dfee,successUrl:_0x5f5bc1,failUrl:_0x56b058,customerEmail:_0x528037,customerName:_0x13cb06,isSourceCurrency:_0x495fee,sourceCurrency:_0x231b6c}=_0x5a7b26;if(!this[_0x1f6257(0x150)])throw new Error(_0x1f6257(0x1b6));const _0x29632b=new URLSearchParams({'api_key':this[_0x1f6257(0x150)],'order_number':_0x5a6469,'order_name':_0x53ab00,'description':_0x57dfee,'success_url':_0x5f5bc1,'fail_url':_0x56b058,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x231b6c?(_0x29632b[_0x1f6257(0x1a0)](_0x1f6257(0x188),_0x231b6c),_0x29632b['append']('source_currency',_0x1c6301),_0x29632b[_0x1f6257(0x1a0)](_0x1f6257(0x14f),_0x3a7020[_0x1f6257(0x17f)]())):(_0x29632b['append']('currency',_0x1c6301),_0x29632b[_0x1f6257(0x1a0)]('amount',_0x3a7020[_0x1f6257(0x17f)]()));_0x528037&&_0x29632b[_0x1f6257(0x1a0)](_0x1f6257(0x159),_0x528037);_0x13cb06&&_0x29632b[_0x1f6257(0x1a0)](_0x1f6257(0x18d),_0x13cb06);const _0x35f44a=this[_0x1f6257(0x19d)]+'?'+_0x29632b['toString'](),_0x5b5416=Date[_0x1f6257(0x169)]();try{console['log'](_0x1f6257(0x1be)),console[_0x1f6257(0x161)](_0x1f6257(0x166),this['apiUrl']),console[_0x1f6257(0x161)](_0x1f6257(0x158),Object['fromEntries'](_0x29632b['entries']())),console[_0x1f6257(0x161)]('Full\x20URL\x20(without\x20API\x20key):',_0x35f44a[_0x1f6257(0x18a)](this['apiKey'],_0x1f6257(0x175))),loggerService_1[_0x1f6257(0x1a5)][_0x1f6257(0x1bb)]('plisio_direct',_0x1f6257(0x172),_0x1f6257(0x154),Object[_0x1f6257(0x1aa)](_0x29632b[_0x1f6257(0x167)]()));const _0x562c5b=await fetch(_0x35f44a,{'method':_0x1f6257(0x154),'headers':{'Accept':'application/json','User-Agent':_0x1f6257(0x187)}}),_0x2424f5=Date['now']()-_0x5b5416;console[_0x1f6257(0x161)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x1f6257(0x161)](_0x1f6257(0x17e),_0x562c5b[_0x1f6257(0x1ad)]),console[_0x1f6257(0x161)](_0x1f6257(0x16f),_0x562c5b['statusText']),console['log']('Response\x20Time:',_0x2424f5+'ms');const _0x6addb3=await _0x562c5b[_0x1f6257(0x1a7)]();console[_0x1f6257(0x161)](_0x1f6257(0x1af),_0x6addb3);if(!_0x562c5b['ok']){console[_0x1f6257(0x184)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x1f6257(0x184)](_0x1f6257(0x152),_0x562c5b[_0x1f6257(0x1ad)]),console[_0x1f6257(0x184)](_0x1f6257(0x183),_0x6addb3),loggerService_1[_0x1f6257(0x1a5)][_0x1f6257(0x14c)]('plisio_direct',_0x1f6257(0x172),_0x562c5b[_0x1f6257(0x1ad)],_0x6addb3,_0x2424f5),loggerService_1[_0x1f6257(0x1a5)][_0x1f6257(0x191)](_0x1f6257(0x165),_0x1f6257(0x172),_0x1f6257(0x1a1)+_0x562c5b[_0x1f6257(0x1ad)]+':\x20'+_0x6addb3);throw new Error(_0x1f6257(0x163)+_0x562c5b[_0x1f6257(0x1ad)]+_0x1f6257(0x15b)+_0x6addb3);}let _0x52bc5d;try{_0x52bc5d=JSON[_0x1f6257(0x16c)](_0x6addb3);}catch(_0x1b9d6f){console[_0x1f6257(0x184)](_0x1f6257(0x193),_0x1b9d6f),loggerService_1[_0x1f6257(0x1a5)][_0x1f6257(0x191)](_0x1f6257(0x165),_0x1f6257(0x172),_0x1f6257(0x14d)+_0x1b9d6f);throw new Error(_0x1f6257(0x15c)+_0x6addb3);}console['log']('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x1f6257(0x161)](_0x1f6257(0x15e),JSON[_0x1f6257(0x178)](_0x52bc5d,null,0x2)),loggerService_1[_0x1f6257(0x1a5)][_0x1f6257(0x14c)](_0x1f6257(0x165),'/invoices/new',_0x562c5b[_0x1f6257(0x1ad)],_0x52bc5d,_0x2424f5);if(_0x52bc5d[_0x1f6257(0x1ad)]!=='success'){const _0x3379d0=_0x52bc5d[_0x1f6257(0x1ab)]||_0x52bc5d[_0x1f6257(0x184)]||_0x1f6257(0x171);console[_0x1f6257(0x184)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x1f6257(0x179),_0x3379d0),loggerService_1[_0x1f6257(0x1a5)]['logWhiteDomainError'](_0x1f6257(0x165),'/invoices/new',_0x1f6257(0x1b0)+_0x3379d0);throw new Error('Plisio\x20API\x20error:\x20'+_0x3379d0);}if(!_0x52bc5d['data']?.[_0x1f6257(0x1b8)]||!_0x52bc5d[_0x1f6257(0x196)]?.['invoice_url']){console[_0x1f6257(0x184)](_0x1f6257(0x1b7)),console[_0x1f6257(0x184)](_0x1f6257(0x15f)),console[_0x1f6257(0x184)](_0x1f6257(0x1bd),_0x52bc5d[_0x1f6257(0x196)]),loggerService_1[_0x1f6257(0x1a5)][_0x1f6257(0x191)](_0x1f6257(0x165),_0x1f6257(0x172),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x1f6257(0x161)](_0x1f6257(0x15a)),console[_0x1f6257(0x161)](_0x1f6257(0x160),_0x52bc5d[_0x1f6257(0x196)][_0x1f6257(0x1b8)]),console[_0x1f6257(0x161)]('Invoice\x20URL:',_0x52bc5d[_0x1f6257(0x196)][_0x1f6257(0x190)]),console[_0x1f6257(0x161)](_0x1f6257(0x16d),_0x3a7020,_0x1c6301),_0x231b6c&&(console[_0x1f6257(0x161)](_0x1f6257(0x1b1),_0x231b6c,_0x1f6257(0x162)),console[_0x1f6257(0x161)](_0x1f6257(0x17d),_0x1c6301,_0x1f6257(0x155))),{'gateway_payment_id':_0x52bc5d[_0x1f6257(0x196)][_0x1f6257(0x1b8)],'payment_url':_0x52bc5d[_0x1f6257(0x196)][_0x1f6257(0x190)],'invoice_total_sum':_0x52bc5d['data'][_0x1f6257(0x157)],'qr_code':_0x52bc5d[_0x1f6257(0x196)][_0x1f6257(0x16e)],'qr_url':_0x52bc5d[_0x1f6257(0x196)][_0x1f6257(0x1ba)]};}catch(_0x54f504){console[_0x1f6257(0x184)](_0x1f6257(0x14b)),console[_0x1f6257(0x184)](_0x1f6257(0x181),_0x54f504),loggerService_1['loggerService'][_0x1f6257(0x191)]('plisio_direct',_0x1f6257(0x172),_0x54f504);if(_0x54f504 instanceof Error){console['error']('Error\x20message:',_0x54f504[_0x1f6257(0x1ab)]),console[_0x1f6257(0x184)]('Error\x20stack:',_0x54f504[_0x1f6257(0x199)]);throw new Error(_0x1f6257(0x17b)+_0x54f504[_0x1f6257(0x1ab)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a45_0x4ccb32(0x164)](_0x2da18a){const _0x41dbaf=a45_0x4ccb32,_0x48f425=Date['now']();try{if(!this['apiKey'])throw new Error(_0x41dbaf(0x1b6));const _0x2ae3db=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x2da18a}),_0x1998f9=_0x41dbaf(0x182)+_0x2da18a+'?'+_0x2ae3db['toString']();loggerService_1[_0x41dbaf(0x1a5)][_0x41dbaf(0x1bb)](_0x41dbaf(0x165),_0x41dbaf(0x19a)+_0x2da18a,_0x41dbaf(0x154),Object[_0x41dbaf(0x1aa)](_0x2ae3db[_0x41dbaf(0x167)]()));const _0x3b6739=await fetch(_0x1998f9,{'method':_0x41dbaf(0x154),'headers':{'Accept':'application/json','User-Agent':_0x41dbaf(0x187)}}),_0x2f3274=Date[_0x41dbaf(0x169)]()-_0x48f425;if(!_0x3b6739['ok']){const _0x59917f=await _0x3b6739[_0x41dbaf(0x1a7)]();loggerService_1[_0x41dbaf(0x1a5)][_0x41dbaf(0x14c)]('plisio_direct',_0x41dbaf(0x19a)+_0x2da18a,_0x3b6739[_0x41dbaf(0x1ad)],_0x59917f,_0x2f3274);throw new Error(_0x41dbaf(0x163)+_0x3b6739[_0x41dbaf(0x1ad)]);}const _0x56a13c=await _0x3b6739[_0x41dbaf(0x19b)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x41dbaf(0x165),_0x41dbaf(0x19a)+_0x2da18a,_0x3b6739['status'],_0x56a13c,_0x2f3274);if(_0x56a13c[_0x41dbaf(0x1ad)]!==_0x41dbaf(0x194)){loggerService_1[_0x41dbaf(0x1a5)][_0x41dbaf(0x191)](_0x41dbaf(0x165),'/operations/'+_0x2da18a,'Plisio\x20API\x20error:\x20'+(_0x56a13c['message']||_0x56a13c[_0x41dbaf(0x184)]||_0x41dbaf(0x1a8)));throw new Error(_0x41dbaf(0x18c)+(_0x56a13c['message']||_0x56a13c[_0x41dbaf(0x184)]||_0x41dbaf(0x1a8)));}let _0x37c757=_0x41dbaf(0x174);return{'status':_0x37c757};}catch(_0x3a121b){console['error']('Plisio\x20payment\x20verification\x20error:',_0x3a121b),loggerService_1['loggerService'][_0x41dbaf(0x191)](_0x41dbaf(0x165),'/operations/'+_0x2da18a,_0x3a121b);throw new Error(_0x41dbaf(0x1a3)+(_0x3a121b instanceof Error?_0x3a121b[_0x41dbaf(0x1ab)]:_0x41dbaf(0x1a8)));}}async[a45_0x4ccb32(0x186)](_0x225e23){const _0x2535ac=a45_0x4ccb32;console['log'](_0x2535ac(0x1b3),_0x225e23);let _0x588914=_0x2535ac(0x174);switch(_0x225e23[_0x2535ac(0x1ad)]?.[_0x2535ac(0x170)]()){case _0x2535ac(0x14e):case _0x2535ac(0x185):_0x588914='PAID';break;case _0x2535ac(0x16b):_0x588914=_0x2535ac(0x1b9);break;case'error':case _0x2535ac(0x1b4):_0x588914=_0x2535ac(0x1bc);break;case _0x2535ac(0x1b5):_0x588914=_0x2535ac(0x174);break;case _0x2535ac(0x19f):_0x588914='PROCESSING';break;default:_0x588914=_0x2535ac(0x174);break;}let _0x422c05;if(_0x225e23[_0x2535ac(0x1b2)])try{console['log'](_0x2535ac(0x1a6),_0x225e23[_0x2535ac(0x1b2)]);let _0xbf6250;if(typeof _0x225e23[_0x2535ac(0x1b2)]==='string')_0xbf6250=JSON['parse'](_0x225e23[_0x2535ac(0x1b2)]);else Array[_0x2535ac(0x168)](_0x225e23[_0x2535ac(0x1b2)])?_0xbf6250=_0x225e23['tx_urls']:_0xbf6250=[];_0x422c05=_0xbf6250[_0x2535ac(0x195)](_0x1d92f3=>{const _0x4ff738=_0x2535ac,_0x3ece1e=_0x1d92f3[_0x4ff738(0x18a)](/\\/g,'');return console[_0x4ff738(0x161)](_0x4ff738(0x19c)+_0x1d92f3+_0x4ff738(0x17a)+_0x3ece1e),_0x3ece1e;}),console[_0x2535ac(0x161)](_0x2535ac(0x17c),_0x422c05),_0x422c05[_0x2535ac(0x173)]((_0x3b9079,_0x394747)=>{const _0x16f0a0=_0x2535ac;try{new URL(_0x3b9079),console[_0x16f0a0(0x161)]('‚úÖ\x20URL\x20'+(_0x394747+0x1)+'\x20is\x20valid:\x20'+_0x3b9079);}catch(_0x3d106c){console[_0x16f0a0(0x184)]('‚ùå\x20URL\x20'+(_0x394747+0x1)+_0x16f0a0(0x197)+_0x3b9079,_0x3d106c);}});}catch(_0x2bbd42){console[_0x2535ac(0x184)](_0x2535ac(0x15d),_0x2bbd42),console[_0x2535ac(0x184)](_0x2535ac(0x18e),_0x225e23[_0x2535ac(0x1b2)]),_0x422c05=undefined;}return{'paymentId':_0x225e23[_0x2535ac(0x198)]||'','status':_0x588914,'amount':_0x225e23[_0x2535ac(0x1a2)],'currency':_0x225e23['currency'],'txUrls':_0x422c05};}}function a45_0x539c(_0x48db45,_0x1b7fbe){const _0x102cb6=a45_0x102c();return a45_0x539c=function(_0x539cae,_0x14e75d){_0x539cae=_0x539cae-0x14b;let _0x521ddf=_0x102cb6[_0x539cae];return _0x521ddf;},a45_0x539c(_0x48db45,_0x1b7fbe);}exports[a45_0x4ccb32(0x18b)]=PlisioService;