'use strict';function a41_0x23de(){const _0x26e263=['https://api.trapay.uk/api/webhooks/gateway/plisio','3454765WuQXzN','source_amount','message','fromEntries','warn','createPayment','Response\x20data:','Error\x20Message:','Unknown\x20error','now','expired','Error\x20stack:','env','Parsed\x20Result:','Business\x20Error:\x20','https://api.plisio.net/api/v1/invoices/new','pending','verifyPayment','order_number','TesSoft\x20Payment\x20System/1.0','toLowerCase','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','replace','===\x20PLISIO\x20SUCCESS\x20===','HTTP\x20Status:','Status\x20Text:','Raw\x20Response\x20Body:','1710612HEOzYd','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','(crypto\x20for\x20payment)','Plisio\x20API\x20key\x20is\x20not\x20configured','Response\x20Body:','logWhiteDomainResponse','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','apiKey','/operations/','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Plisio\x20API\x20error:\x20','Parameters:','append','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','3319620sgElNs','JSON\x20Parse\x20Error:\x20','currency','GET','log','PlisioService','118605hgAXVT','error','toString','json','invoice_total_sum','status','/invoices/new','qr_url','8QMDhZG','apiUrl','../loggerService','txn_id','Error\x20details:','email','logWhiteDomainRequest','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Unknown\x20error\x20from\x20Plisio\x20API','invoice_url','FAILED','4493251XKxMFH','new','Error\x20message:','application/json','__esModule','190kGIzfJ','plisio_direct','cancelled','text','20962890fQgvjm','qr_code','logWhiteDomainError','loggerService','2157BzHUar','Target\x20Currency:','HTTP\x20error!\x20status:\x20','amount','Source\x20Currency:','stack','entries','PLISIO_API_KEY','mismatch','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','===\x20PLISIO\x20API\x20ERROR\x20===','name','URL:','PENDING','PAID','EXPIRED','data'];a41_0x23de=function(){return _0x26e263;};return a41_0x23de();}const a41_0x37f483=a41_0x210f;(function(_0x136e5c,_0x3793d5){const _0x18c63d=a41_0x210f,_0x58cfd1=_0x136e5c();while(!![]){try{const _0x1e6e0a=parseInt(_0x18c63d(0x1fb))/0x1+parseInt(_0x18c63d(0x1b1))/0x2*(-parseInt(_0x18c63d(0x1b9))/0x3)+-parseInt(_0x18c63d(0x1f5))/0x4+-parseInt(_0x18c63d(0x1cb))/0x5+parseInt(_0x18c63d(0x1e6))/0x6+parseInt(_0x18c63d(0x1ac))/0x7*(-parseInt(_0x18c63d(0x203))/0x8)+parseInt(_0x18c63d(0x1b5))/0x9;if(_0x1e6e0a===_0x3793d5)break;else _0x58cfd1['push'](_0x58cfd1['shift']());}catch(_0x357654){_0x58cfd1['push'](_0x58cfd1['shift']());}}}(a41_0x23de,0x7a865));Object['defineProperty'](exports,a41_0x37f483(0x1b0),{'value':!![]}),exports[a41_0x37f483(0x1fa)]=void 0x0;const loggerService_1=require(a41_0x37f483(0x205));class PlisioService{constructor(){const _0x3d707a=a41_0x37f483;this[_0x3d707a(0x204)]=_0x3d707a(0x1da),this[_0x3d707a(0x1ee)]=process[_0x3d707a(0x1d7)][_0x3d707a(0x1c0)]||'',!this[_0x3d707a(0x1ee)]?console[_0x3d707a(0x1cf)](_0x3d707a(0x1e0)):console['log']('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a41_0x37f483(0x1d0)](_0xfd8108){const _0x461aa6=a41_0x37f483,{orderId:_0x21144d,amount:_0x561854,currency:_0x33adb3,productName:_0x595d60,description:_0x37a213,successUrl:_0x259c78,failUrl:_0x27dfcc,customerEmail:_0x4eaf93,customerName:_0x194870,isSourceCurrency:_0x4e2138,sourceCurrency:_0xeb2bcd}=_0xfd8108;if(!this[_0x461aa6(0x1ee)])throw new Error(_0x461aa6(0x1e9));const _0x5d81e6=new URLSearchParams({'api_key':this[_0x461aa6(0x1ee)],'order_number':_0x21144d,'order_name':_0x595d60,'description':_0x37a213,'success_url':_0x259c78,'fail_url':_0x27dfcc,'callback_url':_0x461aa6(0x1ca)});_0xeb2bcd?(_0x5d81e6[_0x461aa6(0x1f3)](_0x461aa6(0x1f7),_0xeb2bcd),_0x5d81e6[_0x461aa6(0x1f3)]('source_currency',_0x33adb3),_0x5d81e6['append'](_0x461aa6(0x1cc),_0x561854[_0x461aa6(0x1fd)]())):(_0x5d81e6[_0x461aa6(0x1f3)](_0x461aa6(0x1f7),_0x33adb3),_0x5d81e6[_0x461aa6(0x1f3)](_0x461aa6(0x1bc),_0x561854[_0x461aa6(0x1fd)]()));_0x4eaf93&&_0x5d81e6['append'](_0x461aa6(0x1a4),_0x4eaf93);_0x194870&&_0x5d81e6['append'](_0x461aa6(0x1c4),_0x194870);const _0x16af8c=this[_0x461aa6(0x204)]+'?'+_0x5d81e6[_0x461aa6(0x1fd)](),_0x238f3b=Date['now']();try{console['log'](_0x461aa6(0x1a6)),console[_0x461aa6(0x1f9)](_0x461aa6(0x1c5),this[_0x461aa6(0x204)]),console[_0x461aa6(0x1f9)](_0x461aa6(0x1f2),Object[_0x461aa6(0x1ce)](_0x5d81e6[_0x461aa6(0x1bf)]())),console[_0x461aa6(0x1f9)]('Full\x20URL\x20(without\x20API\x20key):',_0x16af8c[_0x461aa6(0x1e1)](this['apiKey'],'HIDDEN')),loggerService_1[_0x461aa6(0x1b8)][_0x461aa6(0x1a5)](_0x461aa6(0x1b2),_0x461aa6(0x201),_0x461aa6(0x1f8),Object['fromEntries'](_0x5d81e6[_0x461aa6(0x1bf)]()));const _0x54235c=await fetch(_0x16af8c,{'method':'GET','headers':{'Accept':_0x461aa6(0x1af),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x585e67=Date[_0x461aa6(0x1d4)]()-_0x238f3b;console['log']('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x461aa6(0x1f9)]('Status:',_0x54235c[_0x461aa6(0x200)]),console[_0x461aa6(0x1f9)](_0x461aa6(0x1e4),_0x54235c['statusText']),console[_0x461aa6(0x1f9)]('Response\x20Time:',_0x585e67+'ms');const _0x48c157=await _0x54235c[_0x461aa6(0x1b4)]();console['log'](_0x461aa6(0x1e5),_0x48c157);if(!_0x54235c['ok']){console[_0x461aa6(0x1fc)](_0x461aa6(0x1c3)),console[_0x461aa6(0x1fc)](_0x461aa6(0x1e3),_0x54235c[_0x461aa6(0x200)]),console[_0x461aa6(0x1fc)](_0x461aa6(0x1ea),_0x48c157),loggerService_1[_0x461aa6(0x1b8)][_0x461aa6(0x1eb)](_0x461aa6(0x1b2),_0x461aa6(0x201),_0x54235c['status'],_0x48c157,_0x585e67),loggerService_1['loggerService'][_0x461aa6(0x1b7)]('plisio_direct',_0x461aa6(0x201),'HTTP\x20'+_0x54235c['status']+':\x20'+_0x48c157);throw new Error(_0x461aa6(0x1bb)+_0x54235c[_0x461aa6(0x200)]+',\x20body:\x20'+_0x48c157);}let _0x1c66eb;try{_0x1c66eb=JSON['parse'](_0x48c157);}catch(_0x20080c){console[_0x461aa6(0x1fc)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x20080c),loggerService_1[_0x461aa6(0x1b8)]['logWhiteDomainError'](_0x461aa6(0x1b2),_0x461aa6(0x201),_0x461aa6(0x1f6)+_0x20080c);throw new Error(_0x461aa6(0x1f4)+_0x48c157);}console[_0x461aa6(0x1f9)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x461aa6(0x1f9)](_0x461aa6(0x1d8),JSON['stringify'](_0x1c66eb,null,0x2)),loggerService_1[_0x461aa6(0x1b8)][_0x461aa6(0x1eb)](_0x461aa6(0x1b2),'/invoices/new',_0x54235c[_0x461aa6(0x200)],_0x1c66eb,_0x585e67);if(_0x1c66eb[_0x461aa6(0x200)]!=='success'){const _0x3c8c80=_0x1c66eb[_0x461aa6(0x1cd)]||_0x1c66eb[_0x461aa6(0x1fc)]||_0x461aa6(0x1a9);console[_0x461aa6(0x1fc)](_0x461aa6(0x1e7)),console[_0x461aa6(0x1fc)](_0x461aa6(0x1d2),_0x3c8c80),loggerService_1['loggerService']['logWhiteDomainError'](_0x461aa6(0x1b2),_0x461aa6(0x201),_0x461aa6(0x1d9)+_0x3c8c80);throw new Error('Plisio\x20API\x20error:\x20'+_0x3c8c80);}if(!_0x1c66eb['data']?.['txn_id']||!_0x1c66eb[_0x461aa6(0x1c9)]?.['invoice_url']){console[_0x461aa6(0x1fc)](_0x461aa6(0x1a7)),console[_0x461aa6(0x1fc)](_0x461aa6(0x1ed)),console[_0x461aa6(0x1fc)](_0x461aa6(0x1d1),_0x1c66eb[_0x461aa6(0x1c9)]),loggerService_1[_0x461aa6(0x1b8)]['logWhiteDomainError'](_0x461aa6(0x1b2),_0x461aa6(0x201),_0x461aa6(0x1a8));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x461aa6(0x1f9)](_0x461aa6(0x1e2)),console[_0x461aa6(0x1f9)]('Transaction\x20ID:',_0x1c66eb[_0x461aa6(0x1c9)]['txn_id']),console[_0x461aa6(0x1f9)]('Invoice\x20URL:',_0x1c66eb[_0x461aa6(0x1c9)]['invoice_url']),console[_0x461aa6(0x1f9)]('Amount:',_0x561854,_0x33adb3),_0xeb2bcd&&(console[_0x461aa6(0x1f9)](_0x461aa6(0x1bd),_0xeb2bcd,_0x461aa6(0x1e8)),console[_0x461aa6(0x1f9)](_0x461aa6(0x1ba),_0x33adb3,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x1c66eb[_0x461aa6(0x1c9)][_0x461aa6(0x206)],'payment_url':_0x1c66eb['data'][_0x461aa6(0x1aa)],'invoice_total_sum':_0x1c66eb[_0x461aa6(0x1c9)][_0x461aa6(0x1ff)],'qr_code':_0x1c66eb[_0x461aa6(0x1c9)][_0x461aa6(0x1b6)],'qr_url':_0x1c66eb[_0x461aa6(0x1c9)][_0x461aa6(0x202)]};}catch(_0x3b0ac5){console[_0x461aa6(0x1fc)](_0x461aa6(0x1f0)),console[_0x461aa6(0x1fc)](_0x461aa6(0x1a3),_0x3b0ac5),loggerService_1['loggerService'][_0x461aa6(0x1b7)](_0x461aa6(0x1b2),'/invoices/new',_0x3b0ac5);if(_0x3b0ac5 instanceof Error){console['error'](_0x461aa6(0x1ae),_0x3b0ac5[_0x461aa6(0x1cd)]),console[_0x461aa6(0x1fc)](_0x461aa6(0x1d6),_0x3b0ac5[_0x461aa6(0x1be)]);throw new Error(_0x461aa6(0x1ec)+_0x3b0ac5[_0x461aa6(0x1cd)]);}throw new Error(_0x461aa6(0x1c2));}}async[a41_0x37f483(0x1dc)](_0x10c25d){const _0x37e3eb=a41_0x37f483,_0xc62d50=Date[_0x37e3eb(0x1d4)]();try{if(!this[_0x37e3eb(0x1ee)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x55c92e=new URLSearchParams({'api_key':this[_0x37e3eb(0x1ee)],'txn_id':_0x10c25d}),_0x1b01be='https://api.plisio.net/api/v1/operations/'+_0x10c25d+'?'+_0x55c92e[_0x37e3eb(0x1fd)]();loggerService_1['loggerService'][_0x37e3eb(0x1a5)]('plisio_direct',_0x37e3eb(0x1ef)+_0x10c25d,'GET',Object[_0x37e3eb(0x1ce)](_0x55c92e[_0x37e3eb(0x1bf)]()));const _0xcc3dd=await fetch(_0x1b01be,{'method':_0x37e3eb(0x1f8),'headers':{'Accept':'application/json','User-Agent':_0x37e3eb(0x1de)}}),_0x1aaf13=Date[_0x37e3eb(0x1d4)]()-_0xc62d50;if(!_0xcc3dd['ok']){const _0x342e2f=await _0xcc3dd[_0x37e3eb(0x1b4)]();loggerService_1[_0x37e3eb(0x1b8)]['logWhiteDomainResponse'](_0x37e3eb(0x1b2),_0x37e3eb(0x1ef)+_0x10c25d,_0xcc3dd[_0x37e3eb(0x200)],_0x342e2f,_0x1aaf13);throw new Error(_0x37e3eb(0x1bb)+_0xcc3dd[_0x37e3eb(0x200)]);}const _0x4c4ead=await _0xcc3dd[_0x37e3eb(0x1fe)]();loggerService_1[_0x37e3eb(0x1b8)][_0x37e3eb(0x1eb)]('plisio_direct',_0x37e3eb(0x1ef)+_0x10c25d,_0xcc3dd[_0x37e3eb(0x200)],_0x4c4ead,_0x1aaf13);if(_0x4c4ead['status']!=='success'){loggerService_1[_0x37e3eb(0x1b8)][_0x37e3eb(0x1b7)](_0x37e3eb(0x1b2),'/operations/'+_0x10c25d,_0x37e3eb(0x1f1)+(_0x4c4ead['message']||_0x4c4ead['error']||_0x37e3eb(0x1d3)));throw new Error(_0x37e3eb(0x1f1)+(_0x4c4ead[_0x37e3eb(0x1cd)]||_0x4c4ead[_0x37e3eb(0x1fc)]||_0x37e3eb(0x1d3)));}let _0x28c1f6=_0x37e3eb(0x1c6);return{'status':_0x28c1f6};}catch(_0x920853){console[_0x37e3eb(0x1fc)]('Plisio\x20payment\x20verification\x20error:',_0x920853),loggerService_1[_0x37e3eb(0x1b8)][_0x37e3eb(0x1b7)](_0x37e3eb(0x1b2),_0x37e3eb(0x1ef)+_0x10c25d,_0x920853);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x920853 instanceof Error?_0x920853['message']:'Unknown\x20error'));}}async['processWebhook'](_0x464c19){const _0xb16291=a41_0x37f483;console[_0xb16291(0x1f9)]('Processing\x20Plisio\x20webhook:',_0x464c19);let _0x34ea87=_0xb16291(0x1c6);switch(_0x464c19[_0xb16291(0x200)]?.[_0xb16291(0x1df)]()){case'completed':case _0xb16291(0x1c1):_0x34ea87=_0xb16291(0x1c7);break;case _0xb16291(0x1d5):_0x34ea87=_0xb16291(0x1c8);break;case _0xb16291(0x1fc):case _0xb16291(0x1b3):_0x34ea87=_0xb16291(0x1ab);break;case _0xb16291(0x1ad):case _0xb16291(0x1db):default:_0x34ea87=_0xb16291(0x1c6);break;}return{'paymentId':_0x464c19[_0xb16291(0x1dd)]||'','status':_0x34ea87,'amount':_0x464c19[_0xb16291(0x1bc)],'currency':_0x464c19['currency']};}}function a41_0x210f(_0x518b6d,_0x2217a7){const _0x23deb5=a41_0x23de();return a41_0x210f=function(_0x210f16,_0x4e439d){_0x210f16=_0x210f16-0x1a3;let _0x4f765c=_0x23deb5[_0x210f16];return _0x4f765c;},a41_0x210f(_0x518b6d,_0x2217a7);}exports[a41_0x37f483(0x1fa)]=PlisioService;