'use strict';const a62_0x277f8f=a62_0x5312;(function(_0x1cba79,_0x42d9e6){const _0x4c5764=a62_0x5312,_0x132ec8=_0x1cba79();while(!![]){try{const _0x3192f5=parseInt(_0x4c5764(0x96))/0x1+-parseInt(_0x4c5764(0x82))/0x2+parseInt(_0x4c5764(0xed))/0x3*(parseInt(_0x4c5764(0xb7))/0x4)+-parseInt(_0x4c5764(0xe1))/0x5+parseInt(_0x4c5764(0x94))/0x6+parseInt(_0x4c5764(0x7b))/0x7*(parseInt(_0x4c5764(0xad))/0x8)+-parseInt(_0x4c5764(0xd8))/0x9;if(_0x3192f5===_0x42d9e6)break;else _0x132ec8['push'](_0x132ec8['shift']());}catch(_0x5cbf18){_0x132ec8['push'](_0x132ec8['shift']());}}}(a62_0x4037,0x3b15b));Object[a62_0x277f8f(0xcd)](exports,a62_0x277f8f(0x8d),{'value':!![]}),exports[a62_0x277f8f(0xa6)]=void 0x0;const loggerService_1=require(a62_0x277f8f(0xeb));function a62_0x4037(){const _0x2f0d07=['/invoices/new','Failed\x20to\x20parse\x20JSON\x20response:','logWhiteDomainError','1854850FAxbsw','source_currency','toLowerCase','amount','text','processWebhook','Payment\x20System/1.0','toString','ðŸ”—\x20Raw\x20tx_urls\x20from\x20Plisio:','PLISIO_API_KEY','../loggerService','now','3312khAFSr','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','new','Status:','isArray','Unknown\x20error','âš ï¸\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','PENDING','Processing\x20Plisio\x20webhook:','7zDWoiL','json','replace','order_number','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Error\x20details:','\x20is\x20invalid:\x20','296476UoSpBd','data','HTTP\x20error!\x20status:\x20','===\x20PLISIO\x20API\x20ERROR\x20===','string','HTTP\x20',',\x20body:\x20','status','apiKey','env','PROCESSING','__esModule','createPayment','/operations/','invoice_url','EXPIRED','Plisio\x20API\x20key\x20is\x20not\x20configured','Raw\x20tx_urls\x20data:','2109348pkUBlO','âŒ\x20Failed\x20to\x20parse\x20tx_urls:','86409psVPZA','fromEntries','logWhiteDomainRequest','logWhiteDomainResponse','===\x20PLISIO\x20SUCCESS\x20===','entries','parse','âŒ\x20URL\x20','Response\x20Time:','plisio_direct','stack','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','name','message','PAID','https://api.plisio.net/api/v1/operations/','PlisioService','warn','âœ…\x20Processed\x20tx_urls:','(crypto\x20for\x20payment)','Error\x20stack:','Parsed\x20Result:','ðŸ”—\x20Formatted\x20URL:\x20','2313456aNXYLd','âœ…\x20URL\x20','loggerService','GET','completed','HIDDEN','Amount:','success','Target\x20Currency:','email','584ZjFBme','Raw\x20Response\x20Body:','Plisio\x20API\x20error:\x20','Parameters:','source_amount','Error\x20Message:','qr_url','invoice_total_sum','pending','JSON\x20Parse\x20Error:\x20','txn_id','ðŸ’°\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','HTTP\x20Status:','statusText','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','forEach','application/json','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','mismatch','expired','(fiat\x20for\x20merchant)','defineProperty','\x20is\x20valid:\x20','Status\x20Text:','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Unknown\x20error\x20from\x20Plisio\x20API','currency','append','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','apiUrl','\x20->\x20','log','1144026tgYyXW','error','FAILED','https://api.plisio.net/api/v1/invoices/new','tx_urls','Business\x20Error:\x20'];a62_0x4037=function(){return _0x2f0d07;};return a62_0x4037();}function a62_0x5312(_0x2aaa12,_0x4c59b0){_0x2aaa12=_0x2aaa12-0x76;const _0x403726=a62_0x4037();let _0x531274=_0x403726[_0x2aaa12];return _0x531274;}class PlisioService{constructor(){const _0x3a5821=a62_0x277f8f;this[_0x3a5821(0xd5)]=_0x3a5821(0xdb),this[_0x3a5821(0x8a)]=process[_0x3a5821(0x8b)][_0x3a5821(0xea)]||'',!this['apiKey']?console[_0x3a5821(0xa7)](_0x3a5821(0x78)):console['log'](_0x3a5821(0xc2));}async[a62_0x277f8f(0x8e)](_0xd85636){const _0x44ee85=a62_0x277f8f,{orderId:_0x4fc60a,amount:_0x5f5c8d,currency:_0x4a7dd0,productName:_0x5794bd,description:_0x4cd006,successUrl:_0x1a5664,failUrl:_0x261496,customerEmail:_0x250397,customerName:_0x1584cc,isSourceCurrency:_0x5c433c,sourceCurrency:_0x3e8e90}=_0xd85636;if(!this[_0x44ee85(0x8a)])throw new Error(_0x44ee85(0x92));const _0x186ebe=new URLSearchParams({'api_key':this[_0x44ee85(0x8a)],'order_number':_0x4fc60a,'order_name':_0x5794bd,'description':_0x4cd006,'success_url':_0x1a5664,'fail_url':_0x261496,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x3e8e90?(_0x186ebe[_0x44ee85(0xd3)](_0x44ee85(0xd2),_0x3e8e90),_0x186ebe['append'](_0x44ee85(0xe2),_0x4a7dd0),_0x186ebe[_0x44ee85(0xd3)](_0x44ee85(0xbb),_0x5f5c8d['toString']())):(_0x186ebe[_0x44ee85(0xd3)](_0x44ee85(0xd2),_0x4a7dd0),_0x186ebe[_0x44ee85(0xd3)](_0x44ee85(0xe4),_0x5f5c8d[_0x44ee85(0xe8)]()));_0x250397&&_0x186ebe[_0x44ee85(0xd3)](_0x44ee85(0xb6),_0x250397);_0x1584cc&&_0x186ebe['append'](_0x44ee85(0xa2),_0x1584cc);const _0x20da78=this[_0x44ee85(0xd5)]+'?'+_0x186ebe[_0x44ee85(0xe8)](),_0x413236=Date[_0x44ee85(0xec)]();try{console[_0x44ee85(0xd7)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x44ee85(0xd7)]('URL:',this[_0x44ee85(0xd5)]),console[_0x44ee85(0xd7)](_0x44ee85(0xba),Object['fromEntries'](_0x186ebe[_0x44ee85(0x9b)]())),console[_0x44ee85(0xd7)]('Full\x20URL\x20(without\x20API\x20key):',_0x20da78[_0x44ee85(0x7d)](this[_0x44ee85(0x8a)],_0x44ee85(0xb2))),loggerService_1[_0x44ee85(0xaf)][_0x44ee85(0x98)](_0x44ee85(0x9f),'/invoices/new','GET',Object['fromEntries'](_0x186ebe[_0x44ee85(0x9b)]()));const _0x358f48=await fetch(_0x20da78,{'method':_0x44ee85(0xb0),'headers':{'Accept':_0x44ee85(0xc7),'User-Agent':_0x44ee85(0xe7)}}),_0x6b5745=Date[_0x44ee85(0xec)]()-_0x413236;console[_0x44ee85(0xd7)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console['log'](_0x44ee85(0xf0),_0x358f48[_0x44ee85(0x89)]),console[_0x44ee85(0xd7)](_0x44ee85(0xcf),_0x358f48[_0x44ee85(0xc4)]),console['log'](_0x44ee85(0x9e),_0x6b5745+'ms');const _0x1ca618=await _0x358f48[_0x44ee85(0xe5)]();console[_0x44ee85(0xd7)](_0x44ee85(0xb8),_0x1ca618);if(!_0x358f48['ok']){console['error'](_0x44ee85(0x85)),console[_0x44ee85(0xd9)](_0x44ee85(0xc3),_0x358f48['status']),console['error']('Response\x20Body:',_0x1ca618),loggerService_1[_0x44ee85(0xaf)]['logWhiteDomainResponse'](_0x44ee85(0x9f),_0x44ee85(0xde),_0x358f48['status'],_0x1ca618,_0x6b5745),loggerService_1[_0x44ee85(0xaf)][_0x44ee85(0xe0)](_0x44ee85(0x9f),'/invoices/new',_0x44ee85(0x87)+_0x358f48[_0x44ee85(0x89)]+':\x20'+_0x1ca618);throw new Error(_0x44ee85(0x84)+_0x358f48[_0x44ee85(0x89)]+_0x44ee85(0x88)+_0x1ca618);}let _0x502e6e;try{_0x502e6e=JSON[_0x44ee85(0x9c)](_0x1ca618);}catch(_0x470940){console['error'](_0x44ee85(0xdf),_0x470940),loggerService_1[_0x44ee85(0xaf)][_0x44ee85(0xe0)](_0x44ee85(0x9f),_0x44ee85(0xde),_0x44ee85(0xc0)+_0x470940);throw new Error(_0x44ee85(0xc8)+_0x1ca618);}console[_0x44ee85(0xd7)](_0x44ee85(0xd0)),console[_0x44ee85(0xd7)](_0x44ee85(0xab),JSON['stringify'](_0x502e6e,null,0x2)),loggerService_1[_0x44ee85(0xaf)][_0x44ee85(0x99)](_0x44ee85(0x9f),_0x44ee85(0xde),_0x358f48[_0x44ee85(0x89)],_0x502e6e,_0x6b5745);if(_0x502e6e[_0x44ee85(0x89)]!==_0x44ee85(0xb4)){const _0x1a78c8=_0x502e6e[_0x44ee85(0xa3)]||_0x502e6e[_0x44ee85(0xd9)]||_0x44ee85(0xd1);console[_0x44ee85(0xd9)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x44ee85(0xd9)](_0x44ee85(0xbc),_0x1a78c8),loggerService_1[_0x44ee85(0xaf)][_0x44ee85(0xe0)]('plisio_direct',_0x44ee85(0xde),_0x44ee85(0xdd)+_0x1a78c8);throw new Error(_0x44ee85(0xb9)+_0x1a78c8);}if(!_0x502e6e[_0x44ee85(0x83)]?.[_0x44ee85(0xc1)]||!_0x502e6e[_0x44ee85(0x83)]?.['invoice_url']){console[_0x44ee85(0xd9)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x44ee85(0xd9)](_0x44ee85(0xa1)),console[_0x44ee85(0xd9)]('Response\x20data:',_0x502e6e[_0x44ee85(0x83)]),loggerService_1[_0x44ee85(0xaf)]['logWhiteDomainError'](_0x44ee85(0x9f),_0x44ee85(0xde),_0x44ee85(0x7f));throw new Error(_0x44ee85(0xee));}return console['log'](_0x44ee85(0x9a)),console['log']('Transaction\x20ID:',_0x502e6e['data'][_0x44ee85(0xc1)]),console[_0x44ee85(0xd7)]('Invoice\x20URL:',_0x502e6e[_0x44ee85(0x83)]['invoice_url']),console[_0x44ee85(0xd7)](_0x44ee85(0xb3),_0x5f5c8d,_0x4a7dd0),_0x3e8e90&&(console[_0x44ee85(0xd7)]('Source\x20Currency:',_0x3e8e90,_0x44ee85(0xa9)),console[_0x44ee85(0xd7)](_0x44ee85(0xb5),_0x4a7dd0,_0x44ee85(0xcc))),{'gateway_payment_id':_0x502e6e['data']['txn_id'],'payment_url':_0x502e6e['data'][_0x44ee85(0x90)],'invoice_total_sum':_0x502e6e['data'][_0x44ee85(0xbe)],'qr_code':_0x502e6e['data']['qr_code'],'qr_url':_0x502e6e[_0x44ee85(0x83)][_0x44ee85(0xbd)]};}catch(_0x6192df){console[_0x44ee85(0xd9)](_0x44ee85(0xd4)),console[_0x44ee85(0xd9)](_0x44ee85(0x80),_0x6192df),loggerService_1[_0x44ee85(0xaf)][_0x44ee85(0xe0)](_0x44ee85(0x9f),_0x44ee85(0xde),_0x6192df);if(_0x6192df instanceof Error){console[_0x44ee85(0xd9)]('Error\x20message:',_0x6192df[_0x44ee85(0xa3)]),console['error'](_0x44ee85(0xaa),_0x6192df[_0x44ee85(0xa0)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x6192df[_0x44ee85(0xa3)]);}throw new Error(_0x44ee85(0xc5));}}async['verifyPayment'](_0x52b7db){const _0x4d5960=a62_0x277f8f,_0x31072d=Date[_0x4d5960(0xec)]();try{if(!this['apiKey'])throw new Error(_0x4d5960(0x92));const _0xd947ac=new URLSearchParams({'api_key':this[_0x4d5960(0x8a)],'txn_id':_0x52b7db}),_0x21bd30=_0x4d5960(0xa5)+_0x52b7db+'?'+_0xd947ac[_0x4d5960(0xe8)]();loggerService_1[_0x4d5960(0xaf)]['logWhiteDomainRequest'](_0x4d5960(0x9f),_0x4d5960(0x8f)+_0x52b7db,_0x4d5960(0xb0),Object[_0x4d5960(0x97)](_0xd947ac[_0x4d5960(0x9b)]()));const _0x2652d8=await fetch(_0x21bd30,{'method':_0x4d5960(0xb0),'headers':{'Accept':'application/json','User-Agent':_0x4d5960(0xe7)}}),_0x237c89=Date[_0x4d5960(0xec)]()-_0x31072d;if(!_0x2652d8['ok']){const _0x4b86d9=await _0x2652d8['text']();loggerService_1[_0x4d5960(0xaf)][_0x4d5960(0x99)](_0x4d5960(0x9f),_0x4d5960(0x8f)+_0x52b7db,_0x2652d8[_0x4d5960(0x89)],_0x4b86d9,_0x237c89);throw new Error(_0x4d5960(0x84)+_0x2652d8[_0x4d5960(0x89)]);}const _0x104335=await _0x2652d8[_0x4d5960(0x7c)]();loggerService_1[_0x4d5960(0xaf)][_0x4d5960(0x99)](_0x4d5960(0x9f),_0x4d5960(0x8f)+_0x52b7db,_0x2652d8[_0x4d5960(0x89)],_0x104335,_0x237c89);if(_0x104335[_0x4d5960(0x89)]!==_0x4d5960(0xb4)){loggerService_1[_0x4d5960(0xaf)][_0x4d5960(0xe0)](_0x4d5960(0x9f),_0x4d5960(0x8f)+_0x52b7db,'Plisio\x20API\x20error:\x20'+(_0x104335[_0x4d5960(0xa3)]||_0x104335['error']||_0x4d5960(0x77)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x104335[_0x4d5960(0xa3)]||_0x104335[_0x4d5960(0xd9)]||_0x4d5960(0x77)));}let _0x510654=_0x4d5960(0x79);return{'status':_0x510654};}catch(_0x4e95f1){console[_0x4d5960(0xd9)]('Plisio\x20payment\x20verification\x20error:',_0x4e95f1),loggerService_1[_0x4d5960(0xaf)][_0x4d5960(0xe0)](_0x4d5960(0x9f),_0x4d5960(0x8f)+_0x52b7db,_0x4e95f1);throw new Error(_0x4d5960(0xc9)+(_0x4e95f1 instanceof Error?_0x4e95f1[_0x4d5960(0xa3)]:'Unknown\x20error'));}}async[a62_0x277f8f(0xe6)](_0x16776d){const _0x41be1=a62_0x277f8f;console[_0x41be1(0xd7)](_0x41be1(0x7a),_0x16776d);let _0x1a8c97=_0x41be1(0x79);switch(_0x16776d[_0x41be1(0x89)]?.[_0x41be1(0xe3)]()){case _0x41be1(0xb1):case _0x41be1(0xca):_0x1a8c97=_0x41be1(0xa4);break;case _0x41be1(0xcb):_0x1a8c97=_0x41be1(0x91);break;case _0x41be1(0xd9):case'cancelled':_0x1a8c97=_0x41be1(0xda);break;case _0x41be1(0xef):_0x1a8c97=_0x41be1(0x79);break;case _0x41be1(0xbf):_0x1a8c97=_0x41be1(0x8c);break;default:_0x1a8c97=_0x41be1(0x79);break;}let _0x4383d0;if(_0x16776d[_0x41be1(0xdc)])try{console['log'](_0x41be1(0xe9),_0x16776d['tx_urls']);let _0x284e02;if(typeof _0x16776d['tx_urls']===_0x41be1(0x86))_0x284e02=JSON[_0x41be1(0x9c)](_0x16776d[_0x41be1(0xdc)]);else Array[_0x41be1(0x76)](_0x16776d['tx_urls'])?_0x284e02=_0x16776d[_0x41be1(0xdc)]:_0x284e02=[];_0x4383d0=_0x284e02['map'](_0xc9a1f8=>{const _0x196080=_0x41be1,_0x4e6e5d=_0xc9a1f8[_0x196080(0x7d)](/\\/g,'');return console['log'](_0x196080(0xac)+_0xc9a1f8+_0x196080(0xd6)+_0x4e6e5d),_0x4e6e5d;}),console[_0x41be1(0xd7)](_0x41be1(0xa8),_0x4383d0),_0x4383d0[_0x41be1(0xc6)]((_0x47ba02,_0x2a7422)=>{const _0x1ec174=_0x41be1;try{new URL(_0x47ba02),console['log'](_0x1ec174(0xae)+(_0x2a7422+0x1)+_0x1ec174(0xce)+_0x47ba02);}catch(_0x56a028){console[_0x1ec174(0xd9)](_0x1ec174(0x9d)+(_0x2a7422+0x1)+_0x1ec174(0x81)+_0x47ba02,_0x56a028);}});}catch(_0x56a25e){console[_0x41be1(0xd9)](_0x41be1(0x95),_0x56a25e),console['error'](_0x41be1(0x93),_0x16776d[_0x41be1(0xdc)]),_0x4383d0=undefined;}return{'paymentId':_0x16776d[_0x41be1(0x7e)]||'','status':_0x1a8c97,'amount':_0x16776d[_0x41be1(0xe4)],'currency':_0x16776d[_0x41be1(0xd2)],'txUrls':_0x4383d0};}}exports[a62_0x277f8f(0xa6)]=PlisioService;