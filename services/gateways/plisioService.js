'use strict';const a43_0x1bcd40=a43_0x554a;function a43_0x554a(_0x23d4ea,_0x3959d4){const _0x24f2f7=a43_0x24f2();return a43_0x554a=function(_0x554a38,_0x2a3b4e){_0x554a38=_0x554a38-0x10b;let _0x367b7e=_0x24f2f7[_0x554a38];return _0x367b7e;},a43_0x554a(_0x23d4ea,_0x3959d4);}(function(_0x1ad381,_0x229ad6){const _0x51efac=a43_0x554a,_0x4002de=_0x1ad381();while(!![]){try{const _0x418796=-parseInt(_0x51efac(0x184))/0x1+parseInt(_0x51efac(0x16b))/0x2*(-parseInt(_0x51efac(0x165))/0x3)+-parseInt(_0x51efac(0x14a))/0x4*(-parseInt(_0x51efac(0x13e))/0x5)+parseInt(_0x51efac(0x159))/0x6*(-parseInt(_0x51efac(0x12f))/0x7)+-parseInt(_0x51efac(0x17c))/0x8+-parseInt(_0x51efac(0x158))/0x9+parseInt(_0x51efac(0x177))/0xa;if(_0x418796===_0x229ad6)break;else _0x4002de['push'](_0x4002de['shift']());}catch(_0x44bcb6){_0x4002de['push'](_0x4002de['shift']());}}}(a43_0x24f2,0x9a298));Object[a43_0x1bcd40(0x15e)](exports,a43_0x1bcd40(0x10e),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x10cc83=a43_0x1bcd40;this[_0x10cc83(0x15b)]=_0x10cc83(0x136),this[_0x10cc83(0x185)]=process[_0x10cc83(0x114)][_0x10cc83(0x129)]||'',!this[_0x10cc83(0x185)]?console[_0x10cc83(0x145)](_0x10cc83(0x169)):console[_0x10cc83(0x12d)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async['createPayment'](_0x1d5f6b){const _0x18be91=a43_0x1bcd40,{orderId:_0x52b1bf,amount:_0x177086,currency:_0x31037b,productName:_0x4603c6,description:_0x37cedc,successUrl:_0x1fc639,failUrl:_0xc9e6e8,customerEmail:_0x23286c,customerName:_0x26b406,isSourceCurrency:_0x4caf53,sourceCurrency:_0x3596eb}=_0x1d5f6b;if(!this['apiKey'])throw new Error(_0x18be91(0x17b));const _0x18ca59=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x52b1bf,'order_name':_0x4603c6,'description':_0x37cedc,'success_url':_0x1fc639,'fail_url':_0xc9e6e8,'callback_url':_0x18be91(0x17a)});_0x3596eb?(_0x18ca59['append'](_0x18be91(0x13d),_0x3596eb),_0x18ca59['append']('source_currency',_0x31037b),_0x18ca59[_0x18be91(0x140)](_0x18be91(0x137),_0x177086[_0x18be91(0x11b)]())):(_0x18ca59['append'](_0x18be91(0x13d),_0x31037b),_0x18ca59[_0x18be91(0x140)]('amount',_0x177086[_0x18be91(0x11b)]()));_0x23286c&&_0x18ca59['append'](_0x18be91(0x161),_0x23286c);_0x26b406&&_0x18ca59['append'](_0x18be91(0x12e),_0x26b406);const _0x19d247=this['apiUrl']+'?'+_0x18ca59[_0x18be91(0x11b)](),_0x10a456=Date[_0x18be91(0x149)]();try{console[_0x18be91(0x12d)](_0x18be91(0x11e)),console['log'](_0x18be91(0x164),this[_0x18be91(0x15b)]),console[_0x18be91(0x12d)](_0x18be91(0x17d),Object[_0x18be91(0x128)](_0x18ca59[_0x18be91(0x126)]())),console[_0x18be91(0x12d)](_0x18be91(0x11f),_0x19d247['replace'](this[_0x18be91(0x185)],_0x18be91(0x175))),loggerService_1[_0x18be91(0x13b)][_0x18be91(0x116)]('plisio_direct',_0x18be91(0x112),_0x18be91(0x15a),Object[_0x18be91(0x128)](_0x18ca59['entries']()));const _0x126c70=await fetch(_0x19d247,{'method':_0x18be91(0x15a),'headers':{'Accept':_0x18be91(0x138),'User-Agent':_0x18be91(0x14e)}}),_0x5e2a02=Date['now']()-_0x10a456;console[_0x18be91(0x12d)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x18be91(0x12d)](_0x18be91(0x153),_0x126c70[_0x18be91(0x157)]),console['log'](_0x18be91(0x10d),_0x126c70[_0x18be91(0x13a)]),console[_0x18be91(0x12d)](_0x18be91(0x171),_0x5e2a02+'ms');const _0xf599c3=await _0x126c70[_0x18be91(0x155)]();console[_0x18be91(0x12d)]('Raw\x20Response\x20Body:',_0xf599c3);if(!_0x126c70['ok']){console[_0x18be91(0x163)](_0x18be91(0x148)),console['error'](_0x18be91(0x13f),_0x126c70[_0x18be91(0x157)]),console['error'](_0x18be91(0x151),_0xf599c3),loggerService_1[_0x18be91(0x13b)][_0x18be91(0x115)]('plisio_direct',_0x18be91(0x112),_0x126c70[_0x18be91(0x157)],_0xf599c3,_0x5e2a02),loggerService_1[_0x18be91(0x13b)][_0x18be91(0x172)](_0x18be91(0x117),_0x18be91(0x112),_0x18be91(0x113)+_0x126c70[_0x18be91(0x157)]+':\x20'+_0xf599c3);throw new Error(_0x18be91(0x173)+_0x126c70[_0x18be91(0x157)]+_0x18be91(0x14b)+_0xf599c3);}let _0x13854e;try{_0x13854e=JSON[_0x18be91(0x12a)](_0xf599c3);}catch(_0x2b4c7b){console[_0x18be91(0x163)](_0x18be91(0x16a),_0x2b4c7b),loggerService_1[_0x18be91(0x13b)]['logWhiteDomainError']('plisio_direct',_0x18be91(0x112),'JSON\x20Parse\x20Error:\x20'+_0x2b4c7b);throw new Error(_0x18be91(0x133)+_0xf599c3);}console['log'](_0x18be91(0x127)),console['log'](_0x18be91(0x122),JSON[_0x18be91(0x134)](_0x13854e,null,0x2)),loggerService_1[_0x18be91(0x13b)][_0x18be91(0x115)](_0x18be91(0x117),'/invoices/new',_0x126c70[_0x18be91(0x157)],_0x13854e,_0x5e2a02);if(_0x13854e[_0x18be91(0x157)]!==_0x18be91(0x12b)){const _0x3e5571=_0x13854e[_0x18be91(0x142)]||_0x13854e[_0x18be91(0x163)]||_0x18be91(0x12c);console[_0x18be91(0x163)](_0x18be91(0x10f)),console[_0x18be91(0x163)](_0x18be91(0x143),_0x3e5571),loggerService_1[_0x18be91(0x13b)]['logWhiteDomainError']('plisio_direct',_0x18be91(0x112),_0x18be91(0x178)+_0x3e5571);throw new Error(_0x18be91(0x119)+_0x3e5571);}if(!_0x13854e['data']?.[_0x18be91(0x182)]||!_0x13854e['data']?.[_0x18be91(0x14d)]){console['error'](_0x18be91(0x121)),console[_0x18be91(0x163)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console['error'](_0x18be91(0x168),_0x13854e['data']),loggerService_1[_0x18be91(0x13b)][_0x18be91(0x172)](_0x18be91(0x117),_0x18be91(0x112),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x18be91(0x15f));}return console[_0x18be91(0x12d)](_0x18be91(0x181)),console['log'](_0x18be91(0x13c),_0x13854e[_0x18be91(0x17f)]['txn_id']),console[_0x18be91(0x12d)](_0x18be91(0x120),_0x13854e['data']['invoice_url']),console[_0x18be91(0x12d)](_0x18be91(0x125),_0x177086,_0x31037b),_0x3596eb&&(console['log'](_0x18be91(0x16d),_0x3596eb,_0x18be91(0x11a)),console['log'](_0x18be91(0x11d),_0x31037b,_0x18be91(0x110))),{'gateway_payment_id':_0x13854e[_0x18be91(0x17f)][_0x18be91(0x182)],'payment_url':_0x13854e[_0x18be91(0x17f)][_0x18be91(0x14d)],'invoice_total_sum':_0x13854e[_0x18be91(0x17f)][_0x18be91(0x15c)],'qr_code':_0x13854e[_0x18be91(0x17f)][_0x18be91(0x144)],'qr_url':_0x13854e[_0x18be91(0x17f)]['qr_url']};}catch(_0x1d3479){console[_0x18be91(0x163)](_0x18be91(0x10b)),console[_0x18be91(0x163)](_0x18be91(0x10c),_0x1d3479),loggerService_1['loggerService'][_0x18be91(0x172)](_0x18be91(0x117),_0x18be91(0x112),_0x1d3479);if(_0x1d3479 instanceof Error){console[_0x18be91(0x163)]('Error\x20message:',_0x1d3479['message']),console['error'](_0x18be91(0x124),_0x1d3479['stack']);throw new Error(_0x18be91(0x16e)+_0x1d3479['message']);}throw new Error(_0x18be91(0x14c));}}async['verifyPayment'](_0x30acdc){const _0x16dac9=a43_0x1bcd40,_0x5c9e4c=Date[_0x16dac9(0x149)]();try{if(!this[_0x16dac9(0x185)])throw new Error(_0x16dac9(0x17b));const _0x2d3833=new URLSearchParams({'api_key':this[_0x16dac9(0x185)],'txn_id':_0x30acdc}),_0x4d72fa=_0x16dac9(0x11c)+_0x30acdc+'?'+_0x2d3833[_0x16dac9(0x11b)]();loggerService_1[_0x16dac9(0x13b)]['logWhiteDomainRequest'](_0x16dac9(0x117),_0x16dac9(0x141)+_0x30acdc,_0x16dac9(0x15a),Object[_0x16dac9(0x128)](_0x2d3833[_0x16dac9(0x126)]()));const _0x5b6d43=await fetch(_0x4d72fa,{'method':_0x16dac9(0x15a),'headers':{'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x330f89=Date[_0x16dac9(0x149)]()-_0x5c9e4c;if(!_0x5b6d43['ok']){const _0x5b1885=await _0x5b6d43[_0x16dac9(0x155)]();loggerService_1[_0x16dac9(0x13b)][_0x16dac9(0x115)](_0x16dac9(0x117),_0x16dac9(0x141)+_0x30acdc,_0x5b6d43[_0x16dac9(0x157)],_0x5b1885,_0x330f89);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5b6d43['status']);}const _0x478e50=await _0x5b6d43[_0x16dac9(0x16f)]();loggerService_1[_0x16dac9(0x13b)]['logWhiteDomainResponse'](_0x16dac9(0x117),_0x16dac9(0x141)+_0x30acdc,_0x5b6d43[_0x16dac9(0x157)],_0x478e50,_0x330f89);if(_0x478e50[_0x16dac9(0x157)]!==_0x16dac9(0x12b)){loggerService_1[_0x16dac9(0x13b)][_0x16dac9(0x172)](_0x16dac9(0x117),_0x16dac9(0x141)+_0x30acdc,_0x16dac9(0x119)+(_0x478e50[_0x16dac9(0x142)]||_0x478e50[_0x16dac9(0x163)]||'Unknown\x20error'));throw new Error(_0x16dac9(0x119)+(_0x478e50[_0x16dac9(0x142)]||_0x478e50[_0x16dac9(0x163)]||_0x16dac9(0x130)));}let _0x5a9228=_0x16dac9(0x123);return{'status':_0x5a9228};}catch(_0x2a257a){console[_0x16dac9(0x163)]('Plisio\x20payment\x20verification\x20error:',_0x2a257a),loggerService_1[_0x16dac9(0x13b)][_0x16dac9(0x172)](_0x16dac9(0x117),_0x16dac9(0x141)+_0x30acdc,_0x2a257a);throw new Error(_0x16dac9(0x16c)+(_0x2a257a instanceof Error?_0x2a257a['message']:_0x16dac9(0x130)));}}async[a43_0x1bcd40(0x146)](_0x2b163b){const _0x26c91e=a43_0x1bcd40;console[_0x26c91e(0x12d)](_0x26c91e(0x167),_0x2b163b);let _0x2cc0d8=_0x26c91e(0x123);switch(_0x2b163b[_0x26c91e(0x157)]?.[_0x26c91e(0x183)]()){case _0x26c91e(0x17e):case _0x26c91e(0x162):_0x2cc0d8=_0x26c91e(0x132);break;case _0x26c91e(0x160):_0x2cc0d8=_0x26c91e(0x180);break;case _0x26c91e(0x163):case _0x26c91e(0x154):_0x2cc0d8=_0x26c91e(0x170);break;case'new':case _0x26c91e(0x179):default:_0x2cc0d8='PENDING';break;}let _0x76d98;if(_0x2b163b[_0x26c91e(0x150)])try{console['log'](_0x26c91e(0x166),_0x2b163b[_0x26c91e(0x150)]);let _0x324ab1;if(typeof _0x2b163b[_0x26c91e(0x150)]==='string')_0x324ab1=JSON[_0x26c91e(0x12a)](_0x2b163b[_0x26c91e(0x150)]);else Array[_0x26c91e(0x118)](_0x2b163b[_0x26c91e(0x150)])?_0x324ab1=_0x2b163b[_0x26c91e(0x150)]:_0x324ab1=[];_0x76d98=_0x324ab1[_0x26c91e(0x156)](_0x4e369d=>{const _0x143519=_0x26c91e,_0x426b9b=_0x4e369d[_0x143519(0x15d)](/\\/g,'');return console['log'](_0x143519(0x176)+_0x4e369d+'\x20->\x20'+_0x426b9b),_0x426b9b;}),console[_0x26c91e(0x12d)]('‚úÖ\x20Processed\x20tx_urls:',_0x76d98),_0x76d98[_0x26c91e(0x147)]((_0x3e57cd,_0x38fd7d)=>{const _0x4a2662=_0x26c91e;try{new URL(_0x3e57cd),console[_0x4a2662(0x12d)](_0x4a2662(0x174)+(_0x38fd7d+0x1)+_0x4a2662(0x139)+_0x3e57cd);}catch(_0x5a7dbe){console[_0x4a2662(0x163)](_0x4a2662(0x152)+(_0x38fd7d+0x1)+_0x4a2662(0x14f)+_0x3e57cd,_0x5a7dbe);}});}catch(_0x39531f){console['error']('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x39531f),console['error'](_0x26c91e(0x135),_0x2b163b[_0x26c91e(0x150)]),_0x76d98=undefined;}return{'paymentId':_0x2b163b[_0x26c91e(0x131)]||'','status':_0x2cc0d8,'amount':_0x2b163b[_0x26c91e(0x111)],'currency':_0x2b163b[_0x26c91e(0x13d)],'txUrls':_0x76d98};}}function a43_0x24f2(){const _0x5dbcbe=['Processing\x20Plisio\x20webhook:','Response\x20data:','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Failed\x20to\x20parse\x20JSON\x20response:','490XvGngo','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Source\x20Currency:','Failed\x20to\x20create\x20Plisio\x20payment:\x20','json','FAILED','Response\x20Time:','logWhiteDomainError','HTTP\x20error!\x20status:\x20','‚úÖ\x20URL\x20','HIDDEN','üîó\x20Formatted\x20URL:\x20','34129050lkNzQA','Business\x20Error:\x20','pending','https://apitest.trapay.uk/api/webhooks/gateway/plisio','Plisio\x20API\x20key\x20is\x20not\x20configured','5597512vbvIDh','Parameters:','completed','data','EXPIRED','===\x20PLISIO\x20SUCCESS\x20===','txn_id','toLowerCase','55819KdwpWW','apiKey','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Error\x20details:','Status\x20Text:','__esModule','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','(fiat\x20for\x20merchant)','amount','/invoices/new','HTTP\x20','env','logWhiteDomainResponse','logWhiteDomainRequest','plisio_direct','isArray','Plisio\x20API\x20error:\x20','(crypto\x20for\x20payment)','toString','https://api.plisio.net/api/v1/operations/','Target\x20Currency:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Full\x20URL\x20(without\x20API\x20key):','Invoice\x20URL:','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Parsed\x20Result:','PENDING','Error\x20stack:','Amount:','entries','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','fromEntries','PLISIO_API_KEY','parse','success','Unknown\x20error\x20from\x20Plisio\x20API','log','name','7928627AiOzHS','Unknown\x20error','order_number','PAID','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','stringify','Raw\x20tx_urls\x20data:','https://api.plisio.net/api/v1/invoices/new','source_amount','application/json','\x20is\x20valid:\x20','statusText','loggerService','Transaction\x20ID:','currency','15leNJFg','HTTP\x20Status:','append','/operations/','message','Error\x20Message:','qr_code','warn','processWebhook','forEach','===\x20PLISIO\x20API\x20ERROR\x20===','now','658708ZsdsOr',',\x20body:\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','invoice_url','TesSoft\x20Payment\x20System/1.0','\x20is\x20invalid:\x20','tx_urls','Response\x20Body:','‚ùå\x20URL\x20','Status:','cancelled','text','map','status','3275586HemVxo','6WIgavb','GET','apiUrl','invoice_total_sum','replace','defineProperty','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','expired','email','mismatch','error','URL:','12531cXtNvc','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:'];a43_0x24f2=function(){return _0x5dbcbe;};return a43_0x24f2();}exports['PlisioService']=PlisioService;