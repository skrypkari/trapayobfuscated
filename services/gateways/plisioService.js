'use strict';function a44_0x358a(){const _0x47c198=['Invoice\x20URL:','status','env','81ZSthpM','entries','2347150zrFFDD','mismatch','2635CedXHo','forEach','createPayment','string','plisio_direct','toLowerCase','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','üîó\x20Formatted\x20URL:\x20','Full\x20URL\x20(without\x20API\x20key):','PlisioService','statusText','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Response\x20Body:','Plisio\x20API\x20error:\x20','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Response\x20data:','application/json','===\x20PLISIO\x20SUCCESS\x20===','logWhiteDomainRequest','parse','text','txn_id','apiUrl','Response\x20Time:','cancelled','loggerService','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','../loggerService','2483621hPOSHZ','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Transaction\x20ID:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','append','error','Error\x20details:','Source\x20Currency:','Failed\x20to\x20parse\x20JSON\x20response:','Raw\x20Response\x20Body:','Parameters:','isArray','logWhiteDomainError','invoice_url','EXPIRED','Raw\x20tx_urls\x20data:','https://api.plisio.net/api/v1/operations/',',\x20body:\x20','386KQPiEP','now','replace','GET','Plisio\x20payment\x20verification\x20error:','qr_url','defineProperty','currency','808080fgARJY','Target\x20Currency:','Status\x20Text:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','data','/invoices/new','success','‚ùå\x20URL\x20','Amount:','stack','logWhiteDomainResponse','40QyNpLs','Unknown\x20error\x20from\x20Plisio\x20API','‚úÖ\x20URL\x20','Error\x20Message:','fromEntries','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','tx_urls','qr_code','66380vuIvWD','282573KXAYHc','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','apiKey','Error\x20message:','FAILED','‚úÖ\x20Processed\x20tx_urls:','__esModule','Business\x20Error:\x20','PENDING','/operations/','message','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','PAID','1017135ytSNpf','source_currency','HTTP\x20Status:','log','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Unknown\x20error','invoice_total_sum','amount','processWebhook','source_amount','pending','Plisio\x20API\x20key\x20is\x20not\x20configured','===\x20PLISIO\x20API\x20ERROR\x20===','\x20is\x20valid:\x20','Processing\x20Plisio\x20webhook:','Parsed\x20Result:','email','HTTP\x20','Error\x20stack:','TesSoft\x20Payment\x20System/1.0','HTTP\x20error!\x20status:\x20','map','HIDDEN','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='];a44_0x358a=function(){return _0x47c198;};return a44_0x358a();}const a44_0x39583d=a44_0x8c94;(function(_0x5d7565,_0x2a69eb){const _0x1f0e43=a44_0x8c94,_0x8f40e4=_0x5d7565();while(!![]){try{const _0x39e542=-parseInt(_0x1f0e43(0x16a))/0x1*(-parseInt(_0x1f0e43(0x198))/0x2)+parseInt(_0x1f0e43(0x166))/0x3*(-parseInt(_0x1f0e43(0x1b3))/0x4)+-parseInt(_0x1f0e43(0x1c1))/0x5+parseInt(_0x1f0e43(0x1a0))/0x6+parseInt(_0x1f0e43(0x186))/0x7+parseInt(_0x1f0e43(0x1ab))/0x8*(parseInt(_0x1f0e43(0x1b4))/0x9)+-parseInt(_0x1f0e43(0x168))/0xa;if(_0x39e542===_0x2a69eb)break;else _0x8f40e4['push'](_0x8f40e4['shift']());}catch(_0x1de55f){_0x8f40e4['push'](_0x8f40e4['shift']());}}}(a44_0x358a,0x41a10));Object[a44_0x39583d(0x19e)](exports,a44_0x39583d(0x1ba),{'value':!![]}),exports[a44_0x39583d(0x173)]=void 0x0;function a44_0x8c94(_0x202542,_0x16366e){const _0x358a7f=a44_0x358a();return a44_0x8c94=function(_0x8c94a5,_0x5a66e5){_0x8c94a5=_0x8c94a5-0x155;let _0xe95836=_0x358a7f[_0x8c94a5];return _0xe95836;},a44_0x8c94(_0x202542,_0x16366e);}const loggerService_1=require(a44_0x39583d(0x185));class PlisioService{constructor(){const _0x3478eb=a44_0x39583d;this[_0x3478eb(0x180)]='https://api.plisio.net/api/v1/invoices/new',this[_0x3478eb(0x1b6)]=process[_0x3478eb(0x165)]['PLISIO_API_KEY']||'',!this[_0x3478eb(0x1b6)]?console['warn'](_0x3478eb(0x178)):console[_0x3478eb(0x1c4)](_0x3478eb(0x170));}async[a44_0x39583d(0x16c)](_0x5f4dbc){const _0x1c354e=a44_0x39583d,{orderId:_0x47e9cf,amount:_0x1c5dad,currency:_0x28d71e,productName:_0x53c987,description:_0x464063,successUrl:_0x156388,failUrl:_0x5959ee,customerEmail:_0x407527,customerName:_0x34bea1,isSourceCurrency:_0x1cbcfc,sourceCurrency:_0x50ca0a}=_0x5f4dbc;if(!this['apiKey'])throw new Error(_0x1c354e(0x156));const _0x1fbdee=new URLSearchParams({'api_key':this[_0x1c354e(0x1b6)],'order_number':_0x47e9cf,'order_name':_0x53c987,'description':_0x464063,'success_url':_0x156388,'fail_url':_0x5959ee,'callback_url':'https://apitest.trapay.uk/api/webhooks/gateway/plisio'});_0x50ca0a?(_0x1fbdee['append'](_0x1c354e(0x19f),_0x50ca0a),_0x1fbdee[_0x1c354e(0x18a)](_0x1c354e(0x1c2),_0x28d71e),_0x1fbdee[_0x1c354e(0x18a)](_0x1c354e(0x1ca),_0x1c5dad['toString']())):(_0x1fbdee[_0x1c354e(0x18a)](_0x1c354e(0x19f),_0x28d71e),_0x1fbdee[_0x1c354e(0x18a)](_0x1c354e(0x1c8),_0x1c5dad['toString']()));_0x407527&&_0x1fbdee[_0x1c354e(0x18a)](_0x1c354e(0x15b),_0x407527);_0x34bea1&&_0x1fbdee[_0x1c354e(0x18a)]('name',_0x34bea1);const _0x22cd7c=this[_0x1c354e(0x180)]+'?'+_0x1fbdee['toString'](),_0x7fe87f=Date[_0x1c354e(0x199)]();try{console['log']('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x1c354e(0x1c4)]('URL:',this[_0x1c354e(0x180)]),console['log'](_0x1c354e(0x190),Object[_0x1c354e(0x1af)](_0x1fbdee[_0x1c354e(0x167)]())),console[_0x1c354e(0x1c4)](_0x1c354e(0x172),_0x22cd7c[_0x1c354e(0x19a)](this[_0x1c354e(0x1b6)],_0x1c354e(0x161))),loggerService_1[_0x1c354e(0x183)]['logWhiteDomainRequest'](_0x1c354e(0x16e),_0x1c354e(0x1a5),_0x1c354e(0x19b),Object[_0x1c354e(0x1af)](_0x1fbdee['entries']()));const _0x53a920=await fetch(_0x22cd7c,{'method':_0x1c354e(0x19b),'headers':{'Accept':_0x1c354e(0x17a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x1d3553=Date[_0x1c354e(0x199)]()-_0x7fe87f;console['log'](_0x1c354e(0x162)),console['log']('Status:',_0x53a920[_0x1c354e(0x164)]),console[_0x1c354e(0x1c4)](_0x1c354e(0x1a2),_0x53a920[_0x1c354e(0x174)]),console[_0x1c354e(0x1c4)](_0x1c354e(0x181),_0x1d3553+'ms');const _0x25c379=await _0x53a920[_0x1c354e(0x17e)]();console[_0x1c354e(0x1c4)](_0x1c354e(0x18f),_0x25c379);if(!_0x53a920['ok']){console['error'](_0x1c354e(0x157)),console[_0x1c354e(0x18b)](_0x1c354e(0x1c3),_0x53a920[_0x1c354e(0x164)]),console['error'](_0x1c354e(0x176),_0x25c379),loggerService_1['loggerService'][_0x1c354e(0x1aa)]('plisio_direct',_0x1c354e(0x1a5),_0x53a920[_0x1c354e(0x164)],_0x25c379,_0x1d3553),loggerService_1[_0x1c354e(0x183)][_0x1c354e(0x192)](_0x1c354e(0x16e),'/invoices/new',_0x1c354e(0x15c)+_0x53a920[_0x1c354e(0x164)]+':\x20'+_0x25c379);throw new Error(_0x1c354e(0x15f)+_0x53a920[_0x1c354e(0x164)]+_0x1c354e(0x197)+_0x25c379);}let _0x2cdb90;try{_0x2cdb90=JSON[_0x1c354e(0x17d)](_0x25c379);}catch(_0x26400b){console['error'](_0x1c354e(0x18e),_0x26400b),loggerService_1[_0x1c354e(0x183)]['logWhiteDomainError'](_0x1c354e(0x16e),_0x1c354e(0x1a5),'JSON\x20Parse\x20Error:\x20'+_0x26400b);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x25c379);}console[_0x1c354e(0x1c4)](_0x1c354e(0x1bf)),console[_0x1c354e(0x1c4)](_0x1c354e(0x15a),JSON['stringify'](_0x2cdb90,null,0x2)),loggerService_1['loggerService'][_0x1c354e(0x1aa)](_0x1c354e(0x16e),_0x1c354e(0x1a5),_0x53a920[_0x1c354e(0x164)],_0x2cdb90,_0x1d3553);if(_0x2cdb90[_0x1c354e(0x164)]!==_0x1c354e(0x1a6)){const _0xd4298f=_0x2cdb90[_0x1c354e(0x1be)]||_0x2cdb90['error']||_0x1c354e(0x1ac);console['error'](_0x1c354e(0x184)),console['error'](_0x1c354e(0x1ae),_0xd4298f),loggerService_1[_0x1c354e(0x183)][_0x1c354e(0x192)]('plisio_direct',_0x1c354e(0x1a5),_0x1c354e(0x1bb)+_0xd4298f);throw new Error(_0x1c354e(0x177)+_0xd4298f);}if(!_0x2cdb90[_0x1c354e(0x1a4)]?.['txn_id']||!_0x2cdb90['data']?.[_0x1c354e(0x193)]){console[_0x1c354e(0x18b)](_0x1c354e(0x175)),console[_0x1c354e(0x18b)](_0x1c354e(0x189)),console[_0x1c354e(0x18b)](_0x1c354e(0x179),_0x2cdb90[_0x1c354e(0x1a4)]),loggerService_1[_0x1c354e(0x183)][_0x1c354e(0x192)](_0x1c354e(0x16e),_0x1c354e(0x1a5),_0x1c354e(0x1b5));throw new Error(_0x1c354e(0x1a3));}return console['log'](_0x1c354e(0x17b)),console['log'](_0x1c354e(0x188),_0x2cdb90[_0x1c354e(0x1a4)][_0x1c354e(0x17f)]),console[_0x1c354e(0x1c4)](_0x1c354e(0x163),_0x2cdb90['data'][_0x1c354e(0x193)]),console['log'](_0x1c354e(0x1a8),_0x1c5dad,_0x28d71e),_0x50ca0a&&(console[_0x1c354e(0x1c4)](_0x1c354e(0x18d),_0x50ca0a,'(crypto\x20for\x20payment)'),console['log'](_0x1c354e(0x1a1),_0x28d71e,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x2cdb90[_0x1c354e(0x1a4)][_0x1c354e(0x17f)],'payment_url':_0x2cdb90[_0x1c354e(0x1a4)][_0x1c354e(0x193)],'invoice_total_sum':_0x2cdb90[_0x1c354e(0x1a4)][_0x1c354e(0x1c7)],'qr_code':_0x2cdb90[_0x1c354e(0x1a4)][_0x1c354e(0x1b2)],'qr_url':_0x2cdb90['data'][_0x1c354e(0x19d)]};}catch(_0x432844){console[_0x1c354e(0x18b)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x1c354e(0x18b)](_0x1c354e(0x18c),_0x432844),loggerService_1[_0x1c354e(0x183)][_0x1c354e(0x192)](_0x1c354e(0x16e),_0x1c354e(0x1a5),_0x432844);if(_0x432844 instanceof Error){console[_0x1c354e(0x18b)](_0x1c354e(0x1b7),_0x432844[_0x1c354e(0x1be)]),console[_0x1c354e(0x18b)](_0x1c354e(0x15d),_0x432844[_0x1c354e(0x1a9)]);throw new Error(_0x1c354e(0x187)+_0x432844['message']);}throw new Error(_0x1c354e(0x1c5));}}async['verifyPayment'](_0x3aa654){const _0x94066d=a44_0x39583d,_0x49dde5=Date[_0x94066d(0x199)]();try{if(!this['apiKey'])throw new Error(_0x94066d(0x156));const _0x671961=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x3aa654}),_0x70f735=_0x94066d(0x196)+_0x3aa654+'?'+_0x671961['toString']();loggerService_1[_0x94066d(0x183)][_0x94066d(0x17c)](_0x94066d(0x16e),_0x94066d(0x1bd)+_0x3aa654,_0x94066d(0x19b),Object[_0x94066d(0x1af)](_0x671961[_0x94066d(0x167)]()));const _0x151df1=await fetch(_0x70f735,{'method':_0x94066d(0x19b),'headers':{'Accept':_0x94066d(0x17a),'User-Agent':_0x94066d(0x15e)}}),_0x2f1209=Date[_0x94066d(0x199)]()-_0x49dde5;if(!_0x151df1['ok']){const _0x13942f=await _0x151df1['text']();loggerService_1['loggerService'][_0x94066d(0x1aa)](_0x94066d(0x16e),_0x94066d(0x1bd)+_0x3aa654,_0x151df1[_0x94066d(0x164)],_0x13942f,_0x2f1209);throw new Error(_0x94066d(0x15f)+_0x151df1[_0x94066d(0x164)]);}const _0x395638=await _0x151df1['json']();loggerService_1['loggerService'][_0x94066d(0x1aa)](_0x94066d(0x16e),_0x94066d(0x1bd)+_0x3aa654,_0x151df1[_0x94066d(0x164)],_0x395638,_0x2f1209);if(_0x395638[_0x94066d(0x164)]!==_0x94066d(0x1a6)){loggerService_1[_0x94066d(0x183)]['logWhiteDomainError']('plisio_direct',_0x94066d(0x1bd)+_0x3aa654,'Plisio\x20API\x20error:\x20'+(_0x395638[_0x94066d(0x1be)]||_0x395638['error']||_0x94066d(0x1c6)));throw new Error(_0x94066d(0x177)+(_0x395638['message']||_0x395638[_0x94066d(0x18b)]||_0x94066d(0x1c6)));}let _0x2d6ec3=_0x94066d(0x1bc);return{'status':_0x2d6ec3};}catch(_0x584c2b){console[_0x94066d(0x18b)](_0x94066d(0x19c),_0x584c2b),loggerService_1[_0x94066d(0x183)][_0x94066d(0x192)](_0x94066d(0x16e),_0x94066d(0x1bd)+_0x3aa654,_0x584c2b);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x584c2b instanceof Error?_0x584c2b[_0x94066d(0x1be)]:_0x94066d(0x1c6)));}}async[a44_0x39583d(0x1c9)](_0x2fb679){const _0x4f6de7=a44_0x39583d;console['log'](_0x4f6de7(0x159),_0x2fb679);let _0xc0d656=_0x4f6de7(0x1bc);switch(_0x2fb679['status']?.[_0x4f6de7(0x16f)]()){case'completed':case _0x4f6de7(0x169):_0xc0d656=_0x4f6de7(0x1c0);break;case'expired':_0xc0d656=_0x4f6de7(0x194);break;case _0x4f6de7(0x18b):case _0x4f6de7(0x182):_0xc0d656=_0x4f6de7(0x1b8);break;case'new':case _0x4f6de7(0x155):default:_0xc0d656='PENDING';break;}let _0x1ca7cb;if(_0x2fb679[_0x4f6de7(0x1b1)])try{console[_0x4f6de7(0x1c4)](_0x4f6de7(0x1b0),_0x2fb679['tx_urls']);let _0x4bd80d;if(typeof _0x2fb679['tx_urls']===_0x4f6de7(0x16d))_0x4bd80d=JSON['parse'](_0x2fb679[_0x4f6de7(0x1b1)]);else Array[_0x4f6de7(0x191)](_0x2fb679['tx_urls'])?_0x4bd80d=_0x2fb679[_0x4f6de7(0x1b1)]:_0x4bd80d=[];_0x1ca7cb=_0x4bd80d[_0x4f6de7(0x160)](_0x2c0fa6=>{const _0x19cbcb=_0x4f6de7,_0x517891=_0x2c0fa6[_0x19cbcb(0x19a)](/\\/g,'');return console[_0x19cbcb(0x1c4)](_0x19cbcb(0x171)+_0x2c0fa6+'\x20->\x20'+_0x517891),_0x517891;}),console[_0x4f6de7(0x1c4)](_0x4f6de7(0x1b9),_0x1ca7cb),_0x1ca7cb[_0x4f6de7(0x16b)]((_0x9413f0,_0x16702c)=>{const _0x5d5159=_0x4f6de7;try{new URL(_0x9413f0),console[_0x5d5159(0x1c4)](_0x5d5159(0x1ad)+(_0x16702c+0x1)+_0x5d5159(0x158)+_0x9413f0);}catch(_0x3b7118){console['error'](_0x5d5159(0x1a7)+(_0x16702c+0x1)+'\x20is\x20invalid:\x20'+_0x9413f0,_0x3b7118);}});}catch(_0x1b3c45){console[_0x4f6de7(0x18b)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x1b3c45),console[_0x4f6de7(0x18b)](_0x4f6de7(0x195),_0x2fb679['tx_urls']),_0x1ca7cb=undefined;}return{'paymentId':_0x2fb679['order_number']||'','status':_0xc0d656,'amount':_0x2fb679[_0x4f6de7(0x1c8)],'currency':_0x2fb679[_0x4f6de7(0x19f)],'txUrls':_0x1ca7cb};}}exports[a44_0x39583d(0x173)]=PlisioService;