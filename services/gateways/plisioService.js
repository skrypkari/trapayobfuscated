'use strict';const a52_0x1d8237=a52_0x5721;function a52_0x5721(_0x574ade,_0x54fef6){const _0x3d8fdc=a52_0x3d8f();return a52_0x5721=function(_0x5721fe,_0x165df3){_0x5721fe=_0x5721fe-0x72;let _0x3ab38e=_0x3d8fdc[_0x5721fe];return _0x3ab38e;},a52_0x5721(_0x574ade,_0x54fef6);}(function(_0x54a5c5,_0x32b27e){const _0x57339f=a52_0x5721,_0x2296f6=_0x54a5c5();while(!![]){try{const _0x11dd81=-parseInt(_0x57339f(0xac))/0x1*(-parseInt(_0x57339f(0x95))/0x2)+-parseInt(_0x57339f(0x9f))/0x3+parseInt(_0x57339f(0xdf))/0x4*(-parseInt(_0x57339f(0xa8))/0x5)+-parseInt(_0x57339f(0xe4))/0x6*(-parseInt(_0x57339f(0xa0))/0x7)+parseInt(_0x57339f(0xb4))/0x8+-parseInt(_0x57339f(0xba))/0x9+-parseInt(_0x57339f(0xb5))/0xa;if(_0x11dd81===_0x32b27e)break;else _0x2296f6['push'](_0x2296f6['shift']());}catch(_0xc667bc){_0x2296f6['push'](_0x2296f6['shift']());}}}(a52_0x3d8f,0xe7c5a));Object['defineProperty'](exports,a52_0x1d8237(0xa3),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a52_0x1d8237(0x74));function a52_0x3d8f(){const _0x34fc4e=['https://api.plisio.net/api/v1/operations/','Unknown\x20error','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','createPayment','/operations/','stack','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','plisio_direct','Source\x20Currency:','apiKey','üîó\x20Formatted\x20URL:\x20','(crypto\x20for\x20payment)','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Response\x20Body:','logWhiteDomainResponse','Transaction\x20ID:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','warn','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','txn_id','apiUrl',',\x20body:\x20','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Full\x20URL\x20(without\x20API\x20key):','application/json','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Failed\x20to\x20create\x20Plisio\x20payment:\x20','completed','\x20is\x20valid:\x20','‚úÖ\x20Processed\x20tx_urls:','invoice_total_sum','Status\x20Text:','https://api.trapay.uk/api/webhooks/gateway/plisio','processWebhook','qr_code','3910804QTHqqi','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','/invoices/new','parse','HTTP\x20Status:','9739182SOkZMT','string','map','data','message','qr_url','Error\x20stack:','verifyPayment','../loggerService','fromEntries','tx_urls','Invoice\x20URL:','Plisio\x20API\x20key\x20is\x20not\x20configured','text','toLowerCase','Unknown\x20error\x20from\x20Plisio\x20API','name','PENDING','PAID','source_currency','FAILED','stringify','amount','Business\x20Error:\x20','\x20->\x20','Parsed\x20Result:','PLISIO_API_KEY','Raw\x20Response\x20Body:','json','Response\x20Time:','forEach','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Target\x20Currency:','append','logWhiteDomainError','source_amount','Plisio\x20payment\x20verification\x20error:','GET','isArray','mismatch','Failed\x20to\x20parse\x20JSON\x20response:','1366IvkOxr','replace','Processing\x20Plisio\x20webhook:','entries','Status:','https://api.plisio.net/api/v1/invoices/new','email','expired','error','‚ùå\x20URL\x20','682506pGcbjG','7aByCai','success','now','__esModule','log','HTTP\x20','logWhiteDomainRequest','new','5RwiayV','cancelled','invoice_url','Response\x20data:','1091fwOolo','Amount:','EXPIRED','loggerService','Plisio\x20API\x20error:\x20','‚úÖ\x20URL\x20','Raw\x20tx_urls\x20data:','status','11104552JwKiNF','10251810JyANyM','JSON\x20Parse\x20Error:\x20','currency','===\x20PLISIO\x20API\x20ERROR\x20===','statusText','5190273OHYSRT'];a52_0x3d8f=function(){return _0x34fc4e;};return a52_0x3d8f();}class PlisioService{constructor(){const _0x1f0eda=a52_0x1d8237;this[_0x1f0eda(0xd0)]=_0x1f0eda(0x9a),this['apiKey']=process['env'][_0x1f0eda(0x86)]||'',!this[_0x1f0eda(0xc4)]?console[_0x1f0eda(0xcc)](_0x1f0eda(0xe0)):console[_0x1f0eda(0xa4)](_0x1f0eda(0xd5));}async[a52_0x1d8237(0xbe)](_0x141ef3){const _0x905334=a52_0x1d8237,{orderId:_0x33f626,amount:_0x153e4c,currency:_0x2f4b54,productName:_0x213ee8,description:_0x82f981,successUrl:_0xac403c,failUrl:_0x3c40a2,customerEmail:_0x37d753,customerName:_0x165440,isSourceCurrency:_0x3252b3,sourceCurrency:_0x4541dc}=_0x141ef3;if(!this[_0x905334(0xc4)])throw new Error(_0x905334(0x78));const _0x261492=new URLSearchParams({'api_key':this[_0x905334(0xc4)],'order_number':_0x33f626,'order_name':_0x213ee8,'description':_0x82f981,'success_url':_0xac403c,'fail_url':_0x3c40a2,'callback_url':_0x905334(0xdc)});_0x4541dc?(_0x261492[_0x905334(0x8d)](_0x905334(0xb7),_0x4541dc),_0x261492['append'](_0x905334(0x7f),_0x2f4b54),_0x261492[_0x905334(0x8d)](_0x905334(0x8f),_0x153e4c['toString']())):(_0x261492[_0x905334(0x8d)](_0x905334(0xb7),_0x2f4b54),_0x261492[_0x905334(0x8d)](_0x905334(0x82),_0x153e4c['toString']()));_0x37d753&&_0x261492[_0x905334(0x8d)](_0x905334(0x9b),_0x37d753);_0x165440&&_0x261492[_0x905334(0x8d)](_0x905334(0x7c),_0x165440);const _0x488fb=this[_0x905334(0xd0)]+'?'+_0x261492['toString'](),_0xf28fdb=Date[_0x905334(0xa2)]();try{console[_0x905334(0xa4)](_0x905334(0x8b)),console[_0x905334(0xa4)]('URL:',this[_0x905334(0xd0)]),console[_0x905334(0xa4)]('Parameters:',Object[_0x905334(0x75)](_0x261492[_0x905334(0x98)]())),console[_0x905334(0xa4)](_0x905334(0xd3),_0x488fb[_0x905334(0x96)](this[_0x905334(0xc4)],'HIDDEN')),loggerService_1[_0x905334(0xaf)][_0x905334(0xa6)](_0x905334(0xc2),_0x905334(0xe1),'GET',Object[_0x905334(0x75)](_0x261492['entries']()));const _0x4fa745=await fetch(_0x488fb,{'method':_0x905334(0x91),'headers':{'Accept':_0x905334(0xd4),'User-Agent':'Payment\x20System/1.0'}}),_0x314769=Date['now']()-_0xf28fdb;console[_0x905334(0xa4)](_0x905334(0xcb)),console[_0x905334(0xa4)](_0x905334(0x99),_0x4fa745['status']),console['log'](_0x905334(0xdb),_0x4fa745[_0x905334(0xb9)]),console['log'](_0x905334(0x89),_0x314769+'ms');const _0x320c49=await _0x4fa745[_0x905334(0x79)]();console[_0x905334(0xa4)](_0x905334(0x87),_0x320c49);if(!_0x4fa745['ok']){console[_0x905334(0x9d)](_0x905334(0xb8)),console['error'](_0x905334(0xe3),_0x4fa745[_0x905334(0xb3)]),console[_0x905334(0x9d)](_0x905334(0xc8),_0x320c49),loggerService_1['loggerService'][_0x905334(0xc9)](_0x905334(0xc2),_0x905334(0xe1),_0x4fa745['status'],_0x320c49,_0x314769),loggerService_1['loggerService'][_0x905334(0x8e)](_0x905334(0xc2),'/invoices/new',_0x905334(0xa5)+_0x4fa745[_0x905334(0xb3)]+':\x20'+_0x320c49);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4fa745[_0x905334(0xb3)]+_0x905334(0xd1)+_0x320c49);}let _0x30d69b;try{_0x30d69b=JSON[_0x905334(0xe2)](_0x320c49);}catch(_0x3f0f00){console[_0x905334(0x9d)](_0x905334(0x94),_0x3f0f00),loggerService_1['loggerService'][_0x905334(0x8e)](_0x905334(0xc2),_0x905334(0xe1),_0x905334(0xb6)+_0x3f0f00);throw new Error(_0x905334(0xce)+_0x320c49);}console[_0x905334(0xa4)](_0x905334(0xd2)),console[_0x905334(0xa4)](_0x905334(0x85),JSON[_0x905334(0x81)](_0x30d69b,null,0x2)),loggerService_1[_0x905334(0xaf)][_0x905334(0xc9)](_0x905334(0xc2),_0x905334(0xe1),_0x4fa745[_0x905334(0xb3)],_0x30d69b,_0x314769);if(_0x30d69b['status']!=='success'){const _0x5a7230=_0x30d69b[_0x905334(0xe8)]||_0x30d69b[_0x905334(0x9d)]||_0x905334(0x7b);console[_0x905334(0x9d)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x5a7230),loggerService_1['loggerService'][_0x905334(0x8e)](_0x905334(0xc2),_0x905334(0xe1),_0x905334(0x83)+_0x5a7230);throw new Error(_0x905334(0xb0)+_0x5a7230);}if(!_0x30d69b[_0x905334(0xe7)]?.['txn_id']||!_0x30d69b[_0x905334(0xe7)]?.[_0x905334(0xaa)]){console['error']('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x905334(0x9d)](_0x905334(0xc1)),console['error'](_0x905334(0xab),_0x30d69b[_0x905334(0xe7)]),loggerService_1[_0x905334(0xaf)][_0x905334(0x8e)]('plisio_direct','/invoices/new',_0x905334(0xbd));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console['log']('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x905334(0xa4)](_0x905334(0xca),_0x30d69b[_0x905334(0xe7)][_0x905334(0xcf)]),console[_0x905334(0xa4)](_0x905334(0x77),_0x30d69b['data']['invoice_url']),console[_0x905334(0xa4)](_0x905334(0xad),_0x153e4c,_0x2f4b54),_0x4541dc&&(console[_0x905334(0xa4)](_0x905334(0xc3),_0x4541dc,_0x905334(0xc6)),console[_0x905334(0xa4)](_0x905334(0x8c),_0x2f4b54,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x30d69b[_0x905334(0xe7)][_0x905334(0xcf)],'payment_url':_0x30d69b[_0x905334(0xe7)]['invoice_url'],'invoice_total_sum':_0x30d69b[_0x905334(0xe7)][_0x905334(0xda)],'qr_code':_0x30d69b[_0x905334(0xe7)][_0x905334(0xde)],'qr_url':_0x30d69b[_0x905334(0xe7)][_0x905334(0xe9)]};}catch(_0x467cd7){console[_0x905334(0x9d)](_0x905334(0xcd)),console[_0x905334(0x9d)]('Error\x20details:',_0x467cd7),loggerService_1['loggerService']['logWhiteDomainError'](_0x905334(0xc2),_0x905334(0xe1),_0x467cd7);if(_0x467cd7 instanceof Error){console[_0x905334(0x9d)]('Error\x20message:',_0x467cd7[_0x905334(0xe8)]),console[_0x905334(0x9d)](_0x905334(0x72),_0x467cd7[_0x905334(0xc0)]);throw new Error(_0x905334(0xd6)+_0x467cd7[_0x905334(0xe8)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a52_0x1d8237(0x73)](_0x5b67ef){const _0xda556e=a52_0x1d8237,_0x28f1ab=Date[_0xda556e(0xa2)]();try{if(!this[_0xda556e(0xc4)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x35fd9e=new URLSearchParams({'api_key':this[_0xda556e(0xc4)],'txn_id':_0x5b67ef}),_0x4f809d=_0xda556e(0xbb)+_0x5b67ef+'?'+_0x35fd9e['toString']();loggerService_1[_0xda556e(0xaf)][_0xda556e(0xa6)](_0xda556e(0xc2),_0xda556e(0xbf)+_0x5b67ef,'GET',Object[_0xda556e(0x75)](_0x35fd9e[_0xda556e(0x98)]()));const _0x227a37=await fetch(_0x4f809d,{'method':_0xda556e(0x91),'headers':{'Accept':_0xda556e(0xd4),'User-Agent':'Payment\x20System/1.0'}}),_0x107686=Date[_0xda556e(0xa2)]()-_0x28f1ab;if(!_0x227a37['ok']){const _0x2b70e7=await _0x227a37[_0xda556e(0x79)]();loggerService_1[_0xda556e(0xaf)]['logWhiteDomainResponse'](_0xda556e(0xc2),'/operations/'+_0x5b67ef,_0x227a37['status'],_0x2b70e7,_0x107686);throw new Error('HTTP\x20error!\x20status:\x20'+_0x227a37[_0xda556e(0xb3)]);}const _0x79a38a=await _0x227a37[_0xda556e(0x88)]();loggerService_1['loggerService'][_0xda556e(0xc9)]('plisio_direct',_0xda556e(0xbf)+_0x5b67ef,_0x227a37[_0xda556e(0xb3)],_0x79a38a,_0x107686);if(_0x79a38a[_0xda556e(0xb3)]!==_0xda556e(0xa1)){loggerService_1[_0xda556e(0xaf)][_0xda556e(0x8e)](_0xda556e(0xc2),_0xda556e(0xbf)+_0x5b67ef,'Plisio\x20API\x20error:\x20'+(_0x79a38a['message']||_0x79a38a[_0xda556e(0x9d)]||'Unknown\x20error'));throw new Error(_0xda556e(0xb0)+(_0x79a38a['message']||_0x79a38a['error']||_0xda556e(0xbc)));}let _0x456915=_0xda556e(0x7d);return{'status':_0x456915};}catch(_0x50b2ae){console['error'](_0xda556e(0x90),_0x50b2ae),loggerService_1[_0xda556e(0xaf)][_0xda556e(0x8e)](_0xda556e(0xc2),_0xda556e(0xbf)+_0x5b67ef,_0x50b2ae);throw new Error(_0xda556e(0xc7)+(_0x50b2ae instanceof Error?_0x50b2ae[_0xda556e(0xe8)]:_0xda556e(0xbc)));}}async[a52_0x1d8237(0xdd)](_0x6c5b2){const _0xb76126=a52_0x1d8237;console[_0xb76126(0xa4)](_0xb76126(0x97),_0x6c5b2);let _0x250e33=_0xb76126(0x7d);switch(_0x6c5b2[_0xb76126(0xb3)]?.[_0xb76126(0x7a)]()){case _0xb76126(0xd7):case _0xb76126(0x93):_0x250e33=_0xb76126(0x7e);break;case _0xb76126(0x9c):_0x250e33=_0xb76126(0xae);break;case _0xb76126(0x9d):case _0xb76126(0xa9):_0x250e33=_0xb76126(0x80);break;case _0xb76126(0xa7):_0x250e33=_0xb76126(0x7d);break;case'pending':_0x250e33='PROCESSING';break;default:_0x250e33=_0xb76126(0x7d);break;}let _0x45891e;if(_0x6c5b2[_0xb76126(0x76)])try{console[_0xb76126(0xa4)]('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x6c5b2['tx_urls']);let _0x554a62;if(typeof _0x6c5b2[_0xb76126(0x76)]===_0xb76126(0xe5))_0x554a62=JSON[_0xb76126(0xe2)](_0x6c5b2[_0xb76126(0x76)]);else Array[_0xb76126(0x92)](_0x6c5b2[_0xb76126(0x76)])?_0x554a62=_0x6c5b2[_0xb76126(0x76)]:_0x554a62=[];_0x45891e=_0x554a62[_0xb76126(0xe6)](_0x5125a7=>{const _0x55aa02=_0xb76126,_0x569f66=_0x5125a7[_0x55aa02(0x96)](/\\/g,'');return console[_0x55aa02(0xa4)](_0x55aa02(0xc5)+_0x5125a7+_0x55aa02(0x84)+_0x569f66),_0x569f66;}),console['log'](_0xb76126(0xd9),_0x45891e),_0x45891e[_0xb76126(0x8a)]((_0x482a6b,_0x31030a)=>{const _0x47bcd2=_0xb76126;try{new URL(_0x482a6b),console[_0x47bcd2(0xa4)](_0x47bcd2(0xb1)+(_0x31030a+0x1)+_0x47bcd2(0xd8)+_0x482a6b);}catch(_0x206038){console[_0x47bcd2(0x9d)](_0x47bcd2(0x9e)+(_0x31030a+0x1)+'\x20is\x20invalid:\x20'+_0x482a6b,_0x206038);}});}catch(_0x5f305e){console['error']('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x5f305e),console[_0xb76126(0x9d)](_0xb76126(0xb2),_0x6c5b2['tx_urls']),_0x45891e=undefined;}return{'paymentId':_0x6c5b2['order_number']||'','status':_0x250e33,'amount':_0x6c5b2[_0xb76126(0x82)],'currency':_0x6c5b2['currency'],'txUrls':_0x45891e};}}exports['PlisioService']=PlisioService;