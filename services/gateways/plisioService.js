'use strict';const a45_0x1de13b=a45_0x2dc1;(function(_0x1b12a0,_0x1fecfb){const _0x1b08f5=a45_0x2dc1,_0x2e71b3=_0x1b12a0();while(!![]){try{const _0x24ac48=parseInt(_0x1b08f5(0x11f))/0x1+-parseInt(_0x1b08f5(0xde))/0x2+parseInt(_0x1b08f5(0x116))/0x3+-parseInt(_0x1b08f5(0x127))/0x4+-parseInt(_0x1b08f5(0x113))/0x5+parseInt(_0x1b08f5(0x123))/0x6*(-parseInt(_0x1b08f5(0x109))/0x7)+-parseInt(_0x1b08f5(0xd4))/0x8*(-parseInt(_0x1b08f5(0xe3))/0x9);if(_0x24ac48===_0x1fecfb)break;else _0x2e71b3['push'](_0x2e71b3['shift']());}catch(_0x103243){_0x2e71b3['push'](_0x2e71b3['shift']());}}}(a45_0x1cbf,0x41c53));function a45_0x2dc1(_0x4b5a8,_0x5012c0){const _0x1cbf3a=a45_0x1cbf();return a45_0x2dc1=function(_0x2dc1fb,_0x36488a){_0x2dc1fb=_0x2dc1fb-0xcf;let _0x5633ee=_0x1cbf3a[_0x2dc1fb];return _0x5633ee;},a45_0x2dc1(_0x4b5a8,_0x5012c0);}Object[a45_0x1de13b(0xef)](exports,'__esModule',{'value':!![]}),exports[a45_0x1de13b(0xd2)]=void 0x0;const loggerService_1=require(a45_0x1de13b(0x12b));class PlisioService{constructor(){const _0x22a7ce=a45_0x1de13b;this['apiUrl']=_0x22a7ce(0x140),this[_0x22a7ce(0x132)]=process[_0x22a7ce(0xdd)][_0x22a7ce(0x119)]||'',!this[_0x22a7ce(0x132)]?console[_0x22a7ce(0xf5)]('⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console['log'](_0x22a7ce(0xe2));}async[a45_0x1de13b(0xe0)](_0x5b4639){const _0xea60e3=a45_0x1de13b,{orderId:_0x18b330,amount:_0x2e62ca,currency:_0x1892aa,productName:_0x4331c5,description:_0x2619a9,successUrl:_0x526dfe,failUrl:_0x45d57f,customerEmail:_0x2ba9c1,customerName:_0xbf13e1,isSourceCurrency:_0x203416,sourceCurrency:_0x8801f8}=_0x5b4639;if(!this[_0xea60e3(0x132)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x53fa7a=new URLSearchParams({'api_key':this[_0xea60e3(0x132)],'order_number':_0x18b330,'order_name':_0x4331c5,'description':_0x2619a9,'success_url':_0x526dfe,'fail_url':_0x45d57f,'callback_url':_0xea60e3(0x122)});_0x8801f8?(_0x53fa7a[_0xea60e3(0x137)](_0xea60e3(0xd9),_0x8801f8),_0x53fa7a['append'](_0xea60e3(0x11b),_0x1892aa),_0x53fa7a['append'](_0xea60e3(0xf1),_0x2e62ca['toString']())):(_0x53fa7a[_0xea60e3(0x137)](_0xea60e3(0xd9),_0x1892aa),_0x53fa7a[_0xea60e3(0x137)]('amount',_0x2e62ca[_0xea60e3(0xe8)]()));_0x2ba9c1&&_0x53fa7a[_0xea60e3(0x137)](_0xea60e3(0xdf),_0x2ba9c1);_0xbf13e1&&_0x53fa7a['append'](_0xea60e3(0xd0),_0xbf13e1);const _0x4380d3=this[_0xea60e3(0x135)]+'?'+_0x53fa7a[_0xea60e3(0xe8)](),_0x401523=Date[_0xea60e3(0x11c)]();try{console[_0xea60e3(0x136)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0xea60e3(0x136)](_0xea60e3(0xee),this['apiUrl']),console[_0xea60e3(0x136)](_0xea60e3(0xe1),Object[_0xea60e3(0xe4)](_0x53fa7a[_0xea60e3(0x112)]())),console[_0xea60e3(0x136)](_0xea60e3(0x10a),_0x4380d3[_0xea60e3(0x10d)](this['apiKey'],'HIDDEN')),loggerService_1[_0xea60e3(0xf6)][_0xea60e3(0x126)]('plisio_direct',_0xea60e3(0x131),_0xea60e3(0x138),Object['fromEntries'](_0x53fa7a[_0xea60e3(0x112)]()));const _0x40530a=await fetch(_0x4380d3,{'method':_0xea60e3(0x138),'headers':{'Accept':_0xea60e3(0x11a),'User-Agent':_0xea60e3(0x105)}}),_0x12349e=Date[_0xea60e3(0x11c)]()-_0x401523;console[_0xea60e3(0x136)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0xea60e3(0x136)]('Status:',_0x40530a[_0xea60e3(0x11d)]),console[_0xea60e3(0x136)]('Status\x20Text:',_0x40530a['statusText']),console[_0xea60e3(0x136)](_0xea60e3(0x110),_0x12349e+'ms');const _0x310c72=await _0x40530a[_0xea60e3(0x11e)]();console[_0xea60e3(0x136)](_0xea60e3(0x111),_0x310c72);if(!_0x40530a['ok']){console[_0xea60e3(0x101)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0xea60e3(0x101)]('HTTP\x20Status:',_0x40530a[_0xea60e3(0x11d)]),console[_0xea60e3(0x101)](_0xea60e3(0x10e),_0x310c72),loggerService_1[_0xea60e3(0xf6)]['logWhiteDomainResponse'](_0xea60e3(0xdc),_0xea60e3(0x131),_0x40530a['status'],_0x310c72,_0x12349e),loggerService_1[_0xea60e3(0xf6)][_0xea60e3(0xfc)](_0xea60e3(0xdc),_0xea60e3(0x131),'HTTP\x20'+_0x40530a[_0xea60e3(0x11d)]+':\x20'+_0x310c72);throw new Error(_0xea60e3(0xfb)+_0x40530a[_0xea60e3(0x11d)]+',\x20body:\x20'+_0x310c72);}let _0x330a72;try{_0x330a72=JSON[_0xea60e3(0xdb)](_0x310c72);}catch(_0x3849ab){console[_0xea60e3(0x101)](_0xea60e3(0x117),_0x3849ab),loggerService_1[_0xea60e3(0xf6)][_0xea60e3(0xfc)]('plisio_direct',_0xea60e3(0x131),_0xea60e3(0x124)+_0x3849ab);throw new Error(_0xea60e3(0xd8)+_0x310c72);}console[_0xea60e3(0x136)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0xea60e3(0x136)]('Parsed\x20Result:',JSON[_0xea60e3(0xeb)](_0x330a72,null,0x2)),loggerService_1[_0xea60e3(0xf6)][_0xea60e3(0x13f)](_0xea60e3(0xdc),_0xea60e3(0x131),_0x40530a[_0xea60e3(0x11d)],_0x330a72,_0x12349e);if(_0x330a72[_0xea60e3(0x11d)]!=='success'){const _0x112f97=_0x330a72[_0xea60e3(0x125)]||_0x330a72[_0xea60e3(0x101)]||_0xea60e3(0x121);console[_0xea60e3(0x101)](_0xea60e3(0x143)),console['error'](_0xea60e3(0x129),_0x112f97),loggerService_1[_0xea60e3(0xf6)]['logWhiteDomainError'](_0xea60e3(0xdc),'/invoices/new',_0xea60e3(0x13a)+_0x112f97);throw new Error(_0xea60e3(0x142)+_0x112f97);}if(!_0x330a72['data']?.[_0xea60e3(0x12c)]||!_0x330a72['data']?.[_0xea60e3(0xf2)]){console[_0xea60e3(0x101)](_0xea60e3(0xfe)),console[_0xea60e3(0x101)](_0xea60e3(0xd6)),console[_0xea60e3(0x101)]('Response\x20data:',_0x330a72['data']),loggerService_1[_0xea60e3(0xf6)][_0xea60e3(0xfc)]('plisio_direct',_0xea60e3(0x131),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0xea60e3(0xd3));}return console['log'](_0xea60e3(0xda)),console[_0xea60e3(0x136)]('Transaction\x20ID:',_0x330a72[_0xea60e3(0xfa)][_0xea60e3(0x12c)]),console['log'](_0xea60e3(0x118),_0x330a72['data'][_0xea60e3(0xf2)]),console[_0xea60e3(0x136)](_0xea60e3(0x108),_0x2e62ca,_0x1892aa),_0x8801f8&&(console['log'](_0xea60e3(0x120),_0x8801f8,'(crypto\x20for\x20payment)'),console[_0xea60e3(0x136)](_0xea60e3(0x139),_0x1892aa,_0xea60e3(0x100))),{'gateway_payment_id':_0x330a72['data'][_0xea60e3(0x12c)],'payment_url':_0x330a72[_0xea60e3(0xfa)][_0xea60e3(0xf2)],'invoice_total_sum':_0x330a72[_0xea60e3(0xfa)][_0xea60e3(0xf3)],'qr_code':_0x330a72[_0xea60e3(0xfa)][_0xea60e3(0x10b)],'qr_url':_0x330a72[_0xea60e3(0xfa)]['qr_url']};}catch(_0x68796b){console[_0xea60e3(0x101)](_0xea60e3(0x128)),console[_0xea60e3(0x101)](_0xea60e3(0xf4),_0x68796b),loggerService_1['loggerService']['logWhiteDomainError'](_0xea60e3(0xdc),'/invoices/new',_0x68796b);if(_0x68796b instanceof Error){console[_0xea60e3(0x101)](_0xea60e3(0x133),_0x68796b[_0xea60e3(0x125)]),console[_0xea60e3(0x101)]('Error\x20stack:',_0x68796b[_0xea60e3(0x107)]);throw new Error(_0xea60e3(0xe5)+_0x68796b[_0xea60e3(0x125)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a45_0x1de13b(0x141)](_0x2e9f8e){const _0x48cabe=a45_0x1de13b,_0x2bfff9=Date[_0x48cabe(0x11c)]();try{if(!this[_0x48cabe(0x132)])throw new Error(_0x48cabe(0x13e));const _0xc0a562=new URLSearchParams({'api_key':this[_0x48cabe(0x132)],'txn_id':_0x2e9f8e}),_0x2ee24b=_0x48cabe(0xec)+_0x2e9f8e+'?'+_0xc0a562[_0x48cabe(0xe8)]();loggerService_1[_0x48cabe(0xf6)]['logWhiteDomainRequest'](_0x48cabe(0xdc),_0x48cabe(0xd5)+_0x2e9f8e,_0x48cabe(0x138),Object[_0x48cabe(0xe4)](_0xc0a562['entries']()));const _0x5c73f8=await fetch(_0x2ee24b,{'method':'GET','headers':{'Accept':_0x48cabe(0x11a),'User-Agent':_0x48cabe(0x105)}}),_0x51a860=Date[_0x48cabe(0x11c)]()-_0x2bfff9;if(!_0x5c73f8['ok']){const _0x7ccdee=await _0x5c73f8[_0x48cabe(0x11e)]();loggerService_1['loggerService'][_0x48cabe(0x13f)](_0x48cabe(0xdc),'/operations/'+_0x2e9f8e,_0x5c73f8['status'],_0x7ccdee,_0x51a860);throw new Error(_0x48cabe(0xfb)+_0x5c73f8[_0x48cabe(0x11d)]);}const _0x3774f2=await _0x5c73f8[_0x48cabe(0xe7)]();loggerService_1['loggerService'][_0x48cabe(0x13f)](_0x48cabe(0xdc),_0x48cabe(0xd5)+_0x2e9f8e,_0x5c73f8[_0x48cabe(0x11d)],_0x3774f2,_0x51a860);if(_0x3774f2[_0x48cabe(0x11d)]!==_0x48cabe(0x104)){loggerService_1['loggerService'][_0x48cabe(0xfc)]('plisio_direct',_0x48cabe(0xd5)+_0x2e9f8e,_0x48cabe(0x142)+(_0x3774f2['message']||_0x3774f2[_0x48cabe(0x101)]||_0x48cabe(0xe6)));throw new Error(_0x48cabe(0x142)+(_0x3774f2['message']||_0x3774f2[_0x48cabe(0x101)]||_0x48cabe(0xe6)));}let _0x14c41d='PENDING';return{'status':_0x14c41d};}catch(_0x49b81c){console[_0x48cabe(0x101)](_0x48cabe(0xea),_0x49b81c),loggerService_1['loggerService'][_0x48cabe(0xfc)]('plisio_direct',_0x48cabe(0xd5)+_0x2e9f8e,_0x49b81c);throw new Error(_0x48cabe(0xf9)+(_0x49b81c instanceof Error?_0x49b81c['message']:_0x48cabe(0xe6)));}}async[a45_0x1de13b(0xd7)](_0x90da57){const _0x2d77cf=a45_0x1de13b;console['log'](_0x2d77cf(0xff),_0x90da57);let _0x2391b1=_0x2d77cf(0x103);switch(_0x90da57['status']?.[_0x2d77cf(0x10c)]()){case _0x2d77cf(0xcf):case _0x2d77cf(0x12a):_0x2391b1=_0x2d77cf(0x13b);break;case _0x2d77cf(0xed):_0x2391b1=_0x2d77cf(0xf7);break;case _0x2d77cf(0x101):case'cancelled':_0x2391b1='FAILED';break;case _0x2d77cf(0x12f):_0x2391b1=_0x2d77cf(0x103);break;case _0x2d77cf(0xd1):_0x2391b1=_0x2d77cf(0x134);break;default:_0x2391b1=_0x2d77cf(0x103);break;}let _0x938d56;if(_0x90da57[_0x2d77cf(0xe9)])try{console['log'](_0x2d77cf(0xfd),_0x90da57['tx_urls']);let _0x1e4614;if(typeof _0x90da57[_0x2d77cf(0xe9)]===_0x2d77cf(0x114))_0x1e4614=JSON[_0x2d77cf(0xdb)](_0x90da57[_0x2d77cf(0xe9)]);else Array['isArray'](_0x90da57[_0x2d77cf(0xe9)])?_0x1e4614=_0x90da57[_0x2d77cf(0xe9)]:_0x1e4614=[];_0x938d56=_0x1e4614[_0x2d77cf(0xf0)](_0x439785=>{const _0x4dc7ed=_0x2d77cf,_0x2d6520=_0x439785[_0x4dc7ed(0x10d)](/\\/g,'');return console[_0x4dc7ed(0x136)](_0x4dc7ed(0x102)+_0x439785+_0x4dc7ed(0x12d)+_0x2d6520),_0x2d6520;}),console[_0x2d77cf(0x136)](_0x2d77cf(0x13c),_0x938d56),_0x938d56[_0x2d77cf(0x115)]((_0x6974c1,_0x395809)=>{const _0xbb870b=_0x2d77cf;try{new URL(_0x6974c1),console[_0xbb870b(0x136)](_0xbb870b(0x10f)+(_0x395809+0x1)+_0xbb870b(0x130)+_0x6974c1);}catch(_0x5401c9){console[_0xbb870b(0x101)](_0xbb870b(0x106)+(_0x395809+0x1)+_0xbb870b(0x12e)+_0x6974c1,_0x5401c9);}});}catch(_0x21cad1){console[_0x2d77cf(0x101)]('❌\x20Failed\x20to\x20parse\x20tx_urls:',_0x21cad1),console[_0x2d77cf(0x101)]('Raw\x20tx_urls\x20data:',_0x90da57[_0x2d77cf(0xe9)]),_0x938d56=undefined;}return{'paymentId':_0x90da57[_0x2d77cf(0xf8)]||'','status':_0x2391b1,'amount':_0x90da57[_0x2d77cf(0x13d)],'currency':_0x90da57[_0x2d77cf(0xd9)],'txUrls':_0x938d56};}}function a45_0x1cbf(){const _0x27f41c=['/operations/','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','processWebhook','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','currency','===\x20PLISIO\x20SUCCESS\x20===','parse','plisio_direct','env','1048924pkJYDB','email','createPayment','Parameters:','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','144aIlvAg','fromEntries','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Unknown\x20error','json','toString','tx_urls','Plisio\x20payment\x20verification\x20error:','stringify','https://api.plisio.net/api/v1/operations/','expired','URL:','defineProperty','map','source_amount','invoice_url','invoice_total_sum','Error\x20details:','warn','loggerService','EXPIRED','order_number','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','data','HTTP\x20error!\x20status:\x20','logWhiteDomainError','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Processing\x20Plisio\x20webhook:','(fiat\x20for\x20merchant)','error','🔗\x20Formatted\x20URL:\x20','PENDING','success','TesSoft\x20Payment\x20System/1.0','❌\x20URL\x20','stack','Amount:','2051JhZapG','Full\x20URL\x20(without\x20API\x20key):','qr_code','toLowerCase','replace','Response\x20Body:','✅\x20URL\x20','Response\x20Time:','Raw\x20Response\x20Body:','entries','943395heofpP','string','forEach','685440Qlczix','Failed\x20to\x20parse\x20JSON\x20response:','Invoice\x20URL:','PLISIO_API_KEY','application/json','source_currency','now','status','text','371378yLDfSc','Source\x20Currency:','Unknown\x20error\x20from\x20Plisio\x20API','https://api.trapay.uk/api/webhooks/gateway/plisio','10614WtmYGy','JSON\x20Parse\x20Error:\x20','message','logWhiteDomainRequest','1132852sHZZeV','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Error\x20Message:','mismatch','../loggerService','txn_id','\x20->\x20','\x20is\x20invalid:\x20','new','\x20is\x20valid:\x20','/invoices/new','apiKey','Error\x20message:','PROCESSING','apiUrl','log','append','GET','Target\x20Currency:','Business\x20Error:\x20','PAID','✅\x20Processed\x20tx_urls:','amount','Plisio\x20API\x20key\x20is\x20not\x20configured','logWhiteDomainResponse','https://api.plisio.net/api/v1/invoices/new','verifyPayment','Plisio\x20API\x20error:\x20','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','completed','name','pending','PlisioService','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','592104TRoLie'];a45_0x1cbf=function(){return _0x27f41c;};return a45_0x1cbf();}exports[a45_0x1de13b(0xd2)]=PlisioService;