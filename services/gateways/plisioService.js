'use strict';const a47_0x37f277=a47_0x2baf;(function(_0xf26c07,_0x3bbf6f){const _0x34482d=a47_0x2baf,_0x562666=_0xf26c07();while(!![]){try{const _0x2b3e7e=-parseInt(_0x34482d(0x17f))/0x1+parseInt(_0x34482d(0x1bb))/0x2*(-parseInt(_0x34482d(0x1cd))/0x3)+-parseInt(_0x34482d(0x1e5))/0x4*(-parseInt(_0x34482d(0x1b4))/0x5)+parseInt(_0x34482d(0x1e0))/0x6*(-parseInt(_0x34482d(0x1a6))/0x7)+parseInt(_0x34482d(0x1d8))/0x8*(-parseInt(_0x34482d(0x1eb))/0x9)+parseInt(_0x34482d(0x1b9))/0xa*(parseInt(_0x34482d(0x185))/0xb)+parseInt(_0x34482d(0x1ef))/0xc;if(_0x2b3e7e===_0x3bbf6f)break;else _0x562666['push'](_0x562666['shift']());}catch(_0x3e0e4e){_0x562666['push'](_0x562666['shift']());}}}(a47_0x7ace,0x1f25c));function a47_0x7ace(){const _0x506621=['===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','4902imoMjY','qr_url','HTTP\x20Status:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','__esModule','message','currency','PENDING','Error\x20stack:','https://api.plisio.net/api/v1/invoices/new','invoice_url','16UxXZna','apiUrl','toString','‚úÖ\x20Processed\x20tx_urls:','PAID','Error\x20details:','entries','toLowerCase','103266GZRjtX','plisio_direct','success','Source\x20Currency:','statusText','869956VrZmfh','stack','isArray','data','Target\x20Currency:','\x20is\x20valid:\x20','301221NEzNVI','TesSoft\x20Payment\x20System/1.0','new','qr_code','3472332xHwUXG','error','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','apiKey','PROCESSING','defineProperty','Unknown\x20error\x20from\x20Plisio\x20API','(fiat\x20for\x20merchant)','Response\x20data:','Failed\x20to\x20parse\x20JSON\x20response:','27840sQarvC','logWhiteDomainError','GET','FAILED','map','log','55wgIFrF','‚úÖ\x20URL\x20','now','expired','HTTP\x20','‚ùå\x20URL\x20','application/json','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','loggerService','amount','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','warn','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','replace','Response\x20Time:','invoice_total_sum','fromEntries','logWhiteDomainResponse','Status:','append','Plisio\x20API\x20key\x20is\x20not\x20configured','forEach','processWebhook','verifyPayment','mismatch','/invoices/new','\x20->\x20','PlisioService','Unknown\x20error',',\x20body:\x20','Raw\x20tx_urls\x20data:','Error\x20message:','Invoice\x20URL:','63RFaymL','name','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Business\x20Error:\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Response\x20Body:','order_number','logWhiteDomainRequest','/operations/','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','https://api.plisio.net/api/v1/operations/','status','EXPIRED','PLISIO_API_KEY','5xhNyuP','tx_urls','URL:','Status\x20Text:','Processing\x20Plisio\x20webhook:','221210zndYsv','Full\x20URL\x20(without\x20API\x20key):','294VGQLoA','source_amount','HTTP\x20error!\x20status:\x20','Plisio\x20API\x20error:\x20','===\x20PLISIO\x20SUCCESS\x20===','Plisio\x20payment\x20verification\x20error:','text','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Raw\x20Response\x20Body:','json','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','===\x20PLISIO\x20API\x20ERROR\x20===','parse','pending','cancelled','txn_id','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url'];a47_0x7ace=function(){return _0x506621;};return a47_0x7ace();}Object[a47_0x37f277(0x17a)](exports,a47_0x37f277(0x1d1),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require('../loggerService');function a47_0x2baf(_0x11672f,_0x30db9a){const _0x7aced5=a47_0x7ace();return a47_0x2baf=function(_0x2baf45,_0x48aea5){_0x2baf45=_0x2baf45-0x178;let _0x39541e=_0x7aced5[_0x2baf45];return _0x39541e;},a47_0x2baf(_0x11672f,_0x30db9a);}class PlisioService{constructor(){const _0x2b3f57=a47_0x37f277;this[_0x2b3f57(0x1d9)]=_0x2b3f57(0x1d6),this['apiKey']=process['env'][_0x2b3f57(0x1b3)]||'',!this[_0x2b3f57(0x178)]?console[_0x2b3f57(0x190)]('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console['log'](_0x2b3f57(0x1af));}async['createPayment'](_0x3b0415){const _0x5f0506=a47_0x37f277,{orderId:_0x54667c,amount:_0x4c85e6,currency:_0x4010d4,productName:_0x4f0856,description:_0x199548,successUrl:_0x3d2468,failUrl:_0xe915d0,customerEmail:_0x394405,customerName:_0x49ffed,isSourceCurrency:_0x3f929b,sourceCurrency:_0x430469}=_0x3b0415;if(!this[_0x5f0506(0x178)])throw new Error(_0x5f0506(0x199));const _0x11bf74=new URLSearchParams({'api_key':this[_0x5f0506(0x178)],'order_number':_0x54667c,'order_name':_0x4f0856,'description':_0x199548,'success_url':_0x3d2468,'fail_url':_0xe915d0,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x430469?(_0x11bf74[_0x5f0506(0x198)](_0x5f0506(0x1d3),_0x430469),_0x11bf74[_0x5f0506(0x198)]('source_currency',_0x4010d4),_0x11bf74[_0x5f0506(0x198)](_0x5f0506(0x1bc),_0x4c85e6[_0x5f0506(0x1da)]())):(_0x11bf74['append'](_0x5f0506(0x1d3),_0x4010d4),_0x11bf74[_0x5f0506(0x198)](_0x5f0506(0x18e),_0x4c85e6[_0x5f0506(0x1da)]()));_0x394405&&_0x11bf74[_0x5f0506(0x198)]('email',_0x394405);_0x49ffed&&_0x11bf74[_0x5f0506(0x198)](_0x5f0506(0x1a7),_0x49ffed);const _0x318fa5=this[_0x5f0506(0x1d9)]+'?'+_0x11bf74[_0x5f0506(0x1da)](),_0x587411=Date[_0x5f0506(0x187)]();try{console['log'](_0x5f0506(0x1c5)),console[_0x5f0506(0x184)](_0x5f0506(0x1b6),this[_0x5f0506(0x1d9)]),console[_0x5f0506(0x184)]('Parameters:',Object['fromEntries'](_0x11bf74['entries']())),console['log'](_0x5f0506(0x1ba),_0x318fa5[_0x5f0506(0x192)](this[_0x5f0506(0x178)],'HIDDEN')),loggerService_1[_0x5f0506(0x18d)]['logWhiteDomainRequest']('plisio_direct',_0x5f0506(0x19e),_0x5f0506(0x181),Object[_0x5f0506(0x195)](_0x11bf74[_0x5f0506(0x1de)]()));const _0x4e877c=await fetch(_0x318fa5,{'method':_0x5f0506(0x181),'headers':{'Accept':_0x5f0506(0x18b),'User-Agent':_0x5f0506(0x1ec)}}),_0x51c73a=Date['now']()-_0x587411;console[_0x5f0506(0x184)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console['log'](_0x5f0506(0x197),_0x4e877c[_0x5f0506(0x1b1)]),console['log'](_0x5f0506(0x1b7),_0x4e877c[_0x5f0506(0x1e4)]),console[_0x5f0506(0x184)](_0x5f0506(0x193),_0x51c73a+'ms');const _0x1590ff=await _0x4e877c[_0x5f0506(0x1c1)]();console[_0x5f0506(0x184)](_0x5f0506(0x1c3),_0x1590ff);if(!_0x4e877c['ok']){console[_0x5f0506(0x1f0)](_0x5f0506(0x1c6)),console[_0x5f0506(0x1f0)](_0x5f0506(0x1cf),_0x4e877c['status']),console['error'](_0x5f0506(0x1ab),_0x1590ff),loggerService_1[_0x5f0506(0x18d)]['logWhiteDomainResponse']('plisio_direct','/invoices/new',_0x4e877c[_0x5f0506(0x1b1)],_0x1590ff,_0x51c73a),loggerService_1['loggerService'][_0x5f0506(0x180)](_0x5f0506(0x1e1),_0x5f0506(0x19e),_0x5f0506(0x189)+_0x4e877c['status']+':\x20'+_0x1590ff);throw new Error(_0x5f0506(0x1bd)+_0x4e877c[_0x5f0506(0x1b1)]+_0x5f0506(0x1a2)+_0x1590ff);}let _0x25686d;try{_0x25686d=JSON[_0x5f0506(0x1c7)](_0x1590ff);}catch(_0x3b95e4){console[_0x5f0506(0x1f0)](_0x5f0506(0x17e),_0x3b95e4),loggerService_1[_0x5f0506(0x18d)][_0x5f0506(0x180)]('plisio_direct',_0x5f0506(0x19e),'JSON\x20Parse\x20Error:\x20'+_0x3b95e4);throw new Error(_0x5f0506(0x18c)+_0x1590ff);}console['log'](_0x5f0506(0x191)),console[_0x5f0506(0x184)]('Parsed\x20Result:',JSON['stringify'](_0x25686d,null,0x2)),loggerService_1[_0x5f0506(0x18d)]['logWhiteDomainResponse'](_0x5f0506(0x1e1),_0x5f0506(0x19e),_0x4e877c[_0x5f0506(0x1b1)],_0x25686d,_0x51c73a);if(_0x25686d[_0x5f0506(0x1b1)]!==_0x5f0506(0x1e2)){const _0x4aa05f=_0x25686d['message']||_0x25686d[_0x5f0506(0x1f0)]||_0x5f0506(0x17b);console[_0x5f0506(0x1f0)](_0x5f0506(0x1cc)),console[_0x5f0506(0x1f0)]('Error\x20Message:',_0x4aa05f),loggerService_1[_0x5f0506(0x18d)][_0x5f0506(0x180)](_0x5f0506(0x1e1),_0x5f0506(0x19e),_0x5f0506(0x1a9)+_0x4aa05f);throw new Error(_0x5f0506(0x1be)+_0x4aa05f);}if(!_0x25686d[_0x5f0506(0x1e8)]?.[_0x5f0506(0x1ca)]||!_0x25686d[_0x5f0506(0x1e8)]?.[_0x5f0506(0x1d7)]){console[_0x5f0506(0x1f0)](_0x5f0506(0x1c2)),console[_0x5f0506(0x1f0)](_0x5f0506(0x1d0)),console[_0x5f0506(0x1f0)](_0x5f0506(0x17d),_0x25686d[_0x5f0506(0x1e8)]),loggerService_1['loggerService'][_0x5f0506(0x180)]('plisio_direct',_0x5f0506(0x19e),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x5f0506(0x1cb));}return console['log'](_0x5f0506(0x1bf)),console[_0x5f0506(0x184)]('Transaction\x20ID:',_0x25686d[_0x5f0506(0x1e8)]['txn_id']),console[_0x5f0506(0x184)](_0x5f0506(0x1a5),_0x25686d[_0x5f0506(0x1e8)][_0x5f0506(0x1d7)]),console[_0x5f0506(0x184)]('Amount:',_0x4c85e6,_0x4010d4),_0x430469&&(console[_0x5f0506(0x184)](_0x5f0506(0x1e3),_0x430469,'(crypto\x20for\x20payment)'),console[_0x5f0506(0x184)](_0x5f0506(0x1e9),_0x4010d4,_0x5f0506(0x17c))),{'gateway_payment_id':_0x25686d['data'][_0x5f0506(0x1ca)],'payment_url':_0x25686d[_0x5f0506(0x1e8)]['invoice_url'],'invoice_total_sum':_0x25686d[_0x5f0506(0x1e8)][_0x5f0506(0x194)],'qr_code':_0x25686d[_0x5f0506(0x1e8)][_0x5f0506(0x1ee)],'qr_url':_0x25686d[_0x5f0506(0x1e8)][_0x5f0506(0x1ce)]};}catch(_0x18e502){console[_0x5f0506(0x1f0)](_0x5f0506(0x1a8)),console[_0x5f0506(0x1f0)](_0x5f0506(0x1dd),_0x18e502),loggerService_1[_0x5f0506(0x18d)][_0x5f0506(0x180)](_0x5f0506(0x1e1),_0x5f0506(0x19e),_0x18e502);if(_0x18e502 instanceof Error){console[_0x5f0506(0x1f0)](_0x5f0506(0x1a4),_0x18e502[_0x5f0506(0x1d2)]),console[_0x5f0506(0x1f0)](_0x5f0506(0x1d5),_0x18e502[_0x5f0506(0x1e6)]);throw new Error(_0x5f0506(0x1aa)+_0x18e502['message']);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a47_0x37f277(0x19c)](_0x221036){const _0x254f0d=a47_0x37f277,_0x30d7e1=Date['now']();try{if(!this[_0x254f0d(0x178)])throw new Error(_0x254f0d(0x199));const _0x52cfe6=new URLSearchParams({'api_key':this[_0x254f0d(0x178)],'txn_id':_0x221036}),_0x500a45=_0x254f0d(0x1b0)+_0x221036+'?'+_0x52cfe6[_0x254f0d(0x1da)]();loggerService_1[_0x254f0d(0x18d)][_0x254f0d(0x1ad)](_0x254f0d(0x1e1),_0x254f0d(0x1ae)+_0x221036,_0x254f0d(0x181),Object['fromEntries'](_0x52cfe6[_0x254f0d(0x1de)]()));const _0x5a8dd4=await fetch(_0x500a45,{'method':_0x254f0d(0x181),'headers':{'Accept':_0x254f0d(0x18b),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x5e5ded=Date[_0x254f0d(0x187)]()-_0x30d7e1;if(!_0x5a8dd4['ok']){const _0x6d13e4=await _0x5a8dd4['text']();loggerService_1['loggerService'][_0x254f0d(0x196)](_0x254f0d(0x1e1),_0x254f0d(0x1ae)+_0x221036,_0x5a8dd4[_0x254f0d(0x1b1)],_0x6d13e4,_0x5e5ded);throw new Error(_0x254f0d(0x1bd)+_0x5a8dd4[_0x254f0d(0x1b1)]);}const _0x3cae45=await _0x5a8dd4[_0x254f0d(0x1c4)]();loggerService_1['loggerService'][_0x254f0d(0x196)](_0x254f0d(0x1e1),_0x254f0d(0x1ae)+_0x221036,_0x5a8dd4[_0x254f0d(0x1b1)],_0x3cae45,_0x5e5ded);if(_0x3cae45[_0x254f0d(0x1b1)]!==_0x254f0d(0x1e2)){loggerService_1['loggerService'][_0x254f0d(0x180)]('plisio_direct','/operations/'+_0x221036,'Plisio\x20API\x20error:\x20'+(_0x3cae45[_0x254f0d(0x1d2)]||_0x3cae45[_0x254f0d(0x1f0)]||_0x254f0d(0x1a1)));throw new Error(_0x254f0d(0x1be)+(_0x3cae45['message']||_0x3cae45[_0x254f0d(0x1f0)]||_0x254f0d(0x1a1)));}let _0xd319e1='PENDING';return{'status':_0xd319e1};}catch(_0x141e58){console[_0x254f0d(0x1f0)](_0x254f0d(0x1c0),_0x141e58),loggerService_1[_0x254f0d(0x18d)][_0x254f0d(0x180)](_0x254f0d(0x1e1),_0x254f0d(0x1ae)+_0x221036,_0x141e58);throw new Error(_0x254f0d(0x1f1)+(_0x141e58 instanceof Error?_0x141e58[_0x254f0d(0x1d2)]:'Unknown\x20error'));}}async[a47_0x37f277(0x19b)](_0x507b98){const _0x4e7f11=a47_0x37f277;console['log'](_0x4e7f11(0x1b8),_0x507b98);let _0x38a6e7=_0x4e7f11(0x1d4);switch(_0x507b98[_0x4e7f11(0x1b1)]?.[_0x4e7f11(0x1df)]()){case'completed':case _0x4e7f11(0x19d):_0x38a6e7=_0x4e7f11(0x1dc);break;case _0x4e7f11(0x188):_0x38a6e7=_0x4e7f11(0x1b2);break;case'error':case _0x4e7f11(0x1c9):_0x38a6e7=_0x4e7f11(0x182);break;case _0x4e7f11(0x1ed):_0x38a6e7=_0x4e7f11(0x1d4);break;case _0x4e7f11(0x1c8):_0x38a6e7=_0x4e7f11(0x179);break;default:_0x38a6e7='PENDING';break;}let _0x4963d5;if(_0x507b98[_0x4e7f11(0x1b5)])try{console[_0x4e7f11(0x184)]('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x507b98[_0x4e7f11(0x1b5)]);let _0x16d24d;if(typeof _0x507b98[_0x4e7f11(0x1b5)]==='string')_0x16d24d=JSON[_0x4e7f11(0x1c7)](_0x507b98[_0x4e7f11(0x1b5)]);else Array[_0x4e7f11(0x1e7)](_0x507b98[_0x4e7f11(0x1b5)])?_0x16d24d=_0x507b98[_0x4e7f11(0x1b5)]:_0x16d24d=[];_0x4963d5=_0x16d24d[_0x4e7f11(0x183)](_0x585a1c=>{const _0x512189=_0x4e7f11,_0x42a61d=_0x585a1c['replace'](/\\/g,'');return console[_0x512189(0x184)]('üîó\x20Formatted\x20URL:\x20'+_0x585a1c+_0x512189(0x19f)+_0x42a61d),_0x42a61d;}),console[_0x4e7f11(0x184)](_0x4e7f11(0x1db),_0x4963d5),_0x4963d5[_0x4e7f11(0x19a)]((_0x8868e5,_0x4c885a)=>{const _0x1356e6=_0x4e7f11;try{new URL(_0x8868e5),console[_0x1356e6(0x184)](_0x1356e6(0x186)+(_0x4c885a+0x1)+_0x1356e6(0x1ea)+_0x8868e5);}catch(_0x5641ab){console[_0x1356e6(0x1f0)](_0x1356e6(0x18a)+(_0x4c885a+0x1)+'\x20is\x20invalid:\x20'+_0x8868e5,_0x5641ab);}});}catch(_0x32361e){console[_0x4e7f11(0x1f0)](_0x4e7f11(0x18f),_0x32361e),console[_0x4e7f11(0x1f0)](_0x4e7f11(0x1a3),_0x507b98[_0x4e7f11(0x1b5)]),_0x4963d5=undefined;}return{'paymentId':_0x507b98[_0x4e7f11(0x1ac)]||'','status':_0x38a6e7,'amount':_0x507b98[_0x4e7f11(0x18e)],'currency':_0x507b98[_0x4e7f11(0x1d3)],'txUrls':_0x4963d5};}}exports[a47_0x37f277(0x1a0)]=PlisioService;