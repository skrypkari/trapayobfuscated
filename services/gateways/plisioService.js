'use strict';function a62_0x240d(){const _0x3a01a7=['apiUrl','data','PAID','âŒ\x20Failed\x20to\x20parse\x20tx_urls:','logWhiteDomainResponse','defineProperty','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','3465545vRwTOp','Plisio\x20API\x20key\x20is\x20not\x20configured','148rOnAOh','qr_url','\x20is\x20valid:\x20','\x20is\x20invalid:\x20','(fiat\x20for\x20merchant)','amount','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Parsed\x20Result:','processWebhook','tx_urls','parse','application/json','HTTP\x20Status:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','===\x20PLISIO\x20API\x20ERROR\x20===','17046099sQQXHQ','Raw\x20Response\x20Body:','âŒ\x20URL\x20','Payment\x20System/1.0','HTTP\x20','PENDING','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','stack','toString','Plisio\x20API\x20error:\x20','status','Invoice\x20URL:','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','5290554pSwJkP','forEach','Failed\x20to\x20create\x20Plisio\x20payment:\x20','\x20->\x20','txn_id','/operations/','success','env','../loggerService','Status\x20Text:','apiKey','now','map','logWhiteDomainError','logWhiteDomainRequest','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','json','EXPIRED','append','entries','Plisio\x20payment\x20verification\x20error:','URL:','7903BjmyJX','toLowerCase','loggerService','5648vREGqy','new','2616DthRAd','Target\x20Currency:','Error\x20Message:','872668eNjrth','ðŸ”—\x20Raw\x20tx_urls\x20from\x20Plisio:','error','pending','HTTP\x20error!\x20status:\x20','Failed\x20to\x20parse\x20JSON\x20response:','https://api.trapay.uk/api/webhooks/gateway/plisio','Unknown\x20error','/invoices/new','Error\x20details:','createPayment','plisio_direct','mismatch','Response\x20Body:','GET','Error\x20message:','string','Parameters:','Processing\x20Plisio\x20webhook:','https://api.plisio.net/api/v1/invoices/new','Raw\x20tx_urls\x20data:','FAILED','(crypto\x20for\x20payment)','Status:','replace','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','warn','order_number','invoice_url','PlisioService','text','log','ðŸ”—\x20Formatted\x20URL:\x20','email','qr_code','stringify','currency','JSON\x20Parse\x20Error:\x20','Full\x20URL\x20(without\x20API\x20key):','fromEntries','Error\x20stack:','source_amount','âœ…\x20Processed\x20tx_urls:','Unknown\x20error\x20from\x20Plisio\x20API','1521254wYupQY','message','HIDDEN','https://api.plisio.net/api/v1/operations/','Response\x20data:','ðŸ’°\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API'];a62_0x240d=function(){return _0x3a01a7;};return a62_0x240d();}const a62_0x5d656c=a62_0x1cbf;(function(_0x29bcae,_0x4799fd){const _0x252528=a62_0x1cbf,_0x2315e3=_0x29bcae();while(!![]){try{const _0x499efc=parseInt(_0x252528(0x184))/0x1+parseInt(_0x252528(0x13b))/0x2+parseInt(_0x252528(0x181))/0x3*(-parseInt(_0x252528(0x14a))/0x4)+parseInt(_0x252528(0x148))/0x5+parseInt(_0x252528(0x166))/0x6+parseInt(_0x252528(0x17c))/0x7*(-parseInt(_0x252528(0x17f))/0x8)+-parseInt(_0x252528(0x159))/0x9;if(_0x499efc===_0x4799fd)break;else _0x2315e3['push'](_0x2315e3['shift']());}catch(_0x5bb05f){_0x2315e3['push'](_0x2315e3['shift']());}}}(a62_0x240d,0x765ce));Object[a62_0x5d656c(0x146)](exports,'__esModule',{'value':!![]}),exports[a62_0x5d656c(0x12c)]=void 0x0;const loggerService_1=require(a62_0x5d656c(0x16e));function a62_0x1cbf(_0x5e3a86,_0x30661e){_0x5e3a86=_0x5e3a86-0x12a;const _0x240dea=a62_0x240d();let _0x1cbf49=_0x240dea[_0x5e3a86];return _0x1cbf49;}class PlisioService{constructor(){const _0x45e518=a62_0x5d656c;this[_0x45e518(0x141)]=_0x45e518(0x197),this[_0x45e518(0x170)]=process[_0x45e518(0x16d)]['PLISIO_API_KEY']||'',!this[_0x45e518(0x170)]?console[_0x45e518(0x19e)]('âš ï¸\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console['log'](_0x45e518(0x140));}async[a62_0x5d656c(0x18e)](_0x45c90d){const _0x3f8020=a62_0x5d656c,{orderId:_0x3b79e7,amount:_0x337bb9,currency:_0x5161d1,productName:_0x40c330,description:_0x350c0b,successUrl:_0x5b2c28,failUrl:_0x2fc21c,customerEmail:_0x2a2381,customerName:_0x2cecde,isSourceCurrency:_0x4f6044,sourceCurrency:_0x42c4f5}=_0x45c90d;if(!this[_0x3f8020(0x170)])throw new Error(_0x3f8020(0x149));const _0x29d596=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x3b79e7,'order_name':_0x40c330,'description':_0x350c0b,'success_url':_0x5b2c28,'fail_url':_0x2fc21c,'callback_url':_0x3f8020(0x18a)});_0x42c4f5?(_0x29d596[_0x3f8020(0x178)](_0x3f8020(0x133),_0x42c4f5),_0x29d596[_0x3f8020(0x178)]('source_currency',_0x5161d1),_0x29d596[_0x3f8020(0x178)](_0x3f8020(0x138),_0x337bb9[_0x3f8020(0x161)]())):(_0x29d596[_0x3f8020(0x178)](_0x3f8020(0x133),_0x5161d1),_0x29d596[_0x3f8020(0x178)](_0x3f8020(0x14f),_0x337bb9[_0x3f8020(0x161)]()));_0x2a2381&&_0x29d596[_0x3f8020(0x178)](_0x3f8020(0x130),_0x2a2381);_0x2cecde&&_0x29d596['append']('name',_0x2cecde);const _0x235853=this[_0x3f8020(0x141)]+'?'+_0x29d596[_0x3f8020(0x161)](),_0x4b9c2f=Date['now']();try{console['log'](_0x3f8020(0x15f)),console['log'](_0x3f8020(0x17b),this[_0x3f8020(0x141)]),console[_0x3f8020(0x12e)](_0x3f8020(0x195),Object['fromEntries'](_0x29d596[_0x3f8020(0x179)]())),console['log'](_0x3f8020(0x135),_0x235853['replace'](this['apiKey'],_0x3f8020(0x13d))),loggerService_1[_0x3f8020(0x17e)][_0x3f8020(0x174)]('plisio_direct','/invoices/new',_0x3f8020(0x192),Object[_0x3f8020(0x136)](_0x29d596['entries']()));const _0x50e19c=await fetch(_0x235853,{'method':'GET','headers':{'Accept':_0x3f8020(0x155),'User-Agent':_0x3f8020(0x15c)}}),_0x458387=Date['now']()-_0x4b9c2f;console['log'](_0x3f8020(0x157)),console[_0x3f8020(0x12e)](_0x3f8020(0x19b),_0x50e19c[_0x3f8020(0x163)]),console[_0x3f8020(0x12e)](_0x3f8020(0x16f),_0x50e19c['statusText']),console[_0x3f8020(0x12e)]('Response\x20Time:',_0x458387+'ms');const _0x4fc2c4=await _0x50e19c[_0x3f8020(0x12d)]();console['log'](_0x3f8020(0x15a),_0x4fc2c4);if(!_0x50e19c['ok']){console[_0x3f8020(0x186)](_0x3f8020(0x158)),console[_0x3f8020(0x186)](_0x3f8020(0x156),_0x50e19c[_0x3f8020(0x163)]),console['error'](_0x3f8020(0x191),_0x4fc2c4),loggerService_1[_0x3f8020(0x17e)]['logWhiteDomainResponse'](_0x3f8020(0x18f),_0x3f8020(0x18c),_0x50e19c['status'],_0x4fc2c4,_0x458387),loggerService_1['loggerService'][_0x3f8020(0x173)]('plisio_direct',_0x3f8020(0x18c),_0x3f8020(0x15d)+_0x50e19c[_0x3f8020(0x163)]+':\x20'+_0x4fc2c4);throw new Error(_0x3f8020(0x188)+_0x50e19c['status']+',\x20body:\x20'+_0x4fc2c4);}let _0x48dfca;try{_0x48dfca=JSON['parse'](_0x4fc2c4);}catch(_0x31290b){console[_0x3f8020(0x186)](_0x3f8020(0x189),_0x31290b),loggerService_1['loggerService']['logWhiteDomainError'](_0x3f8020(0x18f),'/invoices/new',_0x3f8020(0x134)+_0x31290b);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x4fc2c4);}console[_0x3f8020(0x12e)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x3f8020(0x12e)](_0x3f8020(0x151),JSON[_0x3f8020(0x132)](_0x48dfca,null,0x2)),loggerService_1['loggerService'][_0x3f8020(0x145)]('plisio_direct',_0x3f8020(0x18c),_0x50e19c['status'],_0x48dfca,_0x458387);if(_0x48dfca[_0x3f8020(0x163)]!==_0x3f8020(0x16c)){const _0x121136=_0x48dfca[_0x3f8020(0x13c)]||_0x48dfca[_0x3f8020(0x186)]||_0x3f8020(0x13a);console[_0x3f8020(0x186)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x3f8020(0x186)](_0x3f8020(0x183),_0x121136),loggerService_1[_0x3f8020(0x17e)][_0x3f8020(0x173)](_0x3f8020(0x18f),_0x3f8020(0x18c),'Business\x20Error:\x20'+_0x121136);throw new Error(_0x3f8020(0x162)+_0x121136);}if(!_0x48dfca['data']?.[_0x3f8020(0x16a)]||!_0x48dfca[_0x3f8020(0x142)]?.['invoice_url']){console['error'](_0x3f8020(0x19d)),console['error']('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x3f8020(0x186)](_0x3f8020(0x13f),_0x48dfca[_0x3f8020(0x142)]),loggerService_1[_0x3f8020(0x17e)][_0x3f8020(0x173)](_0x3f8020(0x18f),_0x3f8020(0x18c),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x3f8020(0x147));}return console[_0x3f8020(0x12e)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x3f8020(0x12e)]('Transaction\x20ID:',_0x48dfca[_0x3f8020(0x142)][_0x3f8020(0x16a)]),console[_0x3f8020(0x12e)](_0x3f8020(0x164),_0x48dfca[_0x3f8020(0x142)]['invoice_url']),console[_0x3f8020(0x12e)]('Amount:',_0x337bb9,_0x5161d1),_0x42c4f5&&(console[_0x3f8020(0x12e)]('Source\x20Currency:',_0x42c4f5,_0x3f8020(0x19a)),console['log'](_0x3f8020(0x182),_0x5161d1,_0x3f8020(0x14e))),{'gateway_payment_id':_0x48dfca[_0x3f8020(0x142)][_0x3f8020(0x16a)],'payment_url':_0x48dfca[_0x3f8020(0x142)][_0x3f8020(0x12b)],'invoice_total_sum':_0x48dfca['data']['invoice_total_sum'],'qr_code':_0x48dfca[_0x3f8020(0x142)][_0x3f8020(0x131)],'qr_url':_0x48dfca[_0x3f8020(0x142)][_0x3f8020(0x14b)]};}catch(_0x4d7d47){console[_0x3f8020(0x186)](_0x3f8020(0x165)),console[_0x3f8020(0x186)](_0x3f8020(0x18d),_0x4d7d47),loggerService_1[_0x3f8020(0x17e)][_0x3f8020(0x173)](_0x3f8020(0x18f),_0x3f8020(0x18c),_0x4d7d47);if(_0x4d7d47 instanceof Error){console['error'](_0x3f8020(0x193),_0x4d7d47['message']),console[_0x3f8020(0x186)](_0x3f8020(0x137),_0x4d7d47[_0x3f8020(0x160)]);throw new Error(_0x3f8020(0x168)+_0x4d7d47[_0x3f8020(0x13c)]);}throw new Error(_0x3f8020(0x150));}}async['verifyPayment'](_0x53c757){const _0x29c310=a62_0x5d656c,_0x2f3553=Date[_0x29c310(0x171)]();try{if(!this[_0x29c310(0x170)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x43bc26=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x53c757}),_0x4fb19f=_0x29c310(0x13e)+_0x53c757+'?'+_0x43bc26[_0x29c310(0x161)]();loggerService_1[_0x29c310(0x17e)][_0x29c310(0x174)](_0x29c310(0x18f),'/operations/'+_0x53c757,_0x29c310(0x192),Object['fromEntries'](_0x43bc26[_0x29c310(0x179)]()));const _0x1f6212=await fetch(_0x4fb19f,{'method':_0x29c310(0x192),'headers':{'Accept':_0x29c310(0x155),'User-Agent':'Payment\x20System/1.0'}}),_0x54b359=Date[_0x29c310(0x171)]()-_0x2f3553;if(!_0x1f6212['ok']){const _0x548297=await _0x1f6212[_0x29c310(0x12d)]();loggerService_1[_0x29c310(0x17e)][_0x29c310(0x145)](_0x29c310(0x18f),_0x29c310(0x16b)+_0x53c757,_0x1f6212['status'],_0x548297,_0x54b359);throw new Error(_0x29c310(0x188)+_0x1f6212[_0x29c310(0x163)]);}const _0x10c9c4=await _0x1f6212[_0x29c310(0x176)]();loggerService_1[_0x29c310(0x17e)][_0x29c310(0x145)](_0x29c310(0x18f),_0x29c310(0x16b)+_0x53c757,_0x1f6212[_0x29c310(0x163)],_0x10c9c4,_0x54b359);if(_0x10c9c4[_0x29c310(0x163)]!==_0x29c310(0x16c)){loggerService_1[_0x29c310(0x17e)][_0x29c310(0x173)]('plisio_direct','/operations/'+_0x53c757,_0x29c310(0x162)+(_0x10c9c4[_0x29c310(0x13c)]||_0x10c9c4['error']||_0x29c310(0x18b)));throw new Error(_0x29c310(0x162)+(_0x10c9c4[_0x29c310(0x13c)]||_0x10c9c4[_0x29c310(0x186)]||_0x29c310(0x18b)));}let _0x32f980=_0x29c310(0x15e);return{'status':_0x32f980};}catch(_0x9e191e){console[_0x29c310(0x186)](_0x29c310(0x17a),_0x9e191e),loggerService_1[_0x29c310(0x17e)][_0x29c310(0x173)](_0x29c310(0x18f),_0x29c310(0x16b)+_0x53c757,_0x9e191e);throw new Error(_0x29c310(0x175)+(_0x9e191e instanceof Error?_0x9e191e[_0x29c310(0x13c)]:_0x29c310(0x18b)));}}async[a62_0x5d656c(0x152)](_0x42926a){const _0x1fc8b9=a62_0x5d656c;console[_0x1fc8b9(0x12e)](_0x1fc8b9(0x196),_0x42926a);let _0x214961='PENDING';switch(_0x42926a['status']?.[_0x1fc8b9(0x17d)]()){case'completed':case _0x1fc8b9(0x190):_0x214961=_0x1fc8b9(0x143);break;case'expired':_0x214961=_0x1fc8b9(0x177);break;case _0x1fc8b9(0x186):case'cancelled':_0x214961=_0x1fc8b9(0x199);break;case _0x1fc8b9(0x180):_0x214961=_0x1fc8b9(0x15e);break;case _0x1fc8b9(0x187):_0x214961='PROCESSING';break;default:_0x214961=_0x1fc8b9(0x15e);break;}let _0x2bfc13;if(_0x42926a[_0x1fc8b9(0x153)])try{console[_0x1fc8b9(0x12e)](_0x1fc8b9(0x185),_0x42926a[_0x1fc8b9(0x153)]);let _0x9bf1b4;if(typeof _0x42926a[_0x1fc8b9(0x153)]===_0x1fc8b9(0x194))_0x9bf1b4=JSON[_0x1fc8b9(0x154)](_0x42926a['tx_urls']);else Array['isArray'](_0x42926a[_0x1fc8b9(0x153)])?_0x9bf1b4=_0x42926a[_0x1fc8b9(0x153)]:_0x9bf1b4=[];_0x2bfc13=_0x9bf1b4[_0x1fc8b9(0x172)](_0x166acb=>{const _0xe69eff=_0x1fc8b9,_0xa4787d=_0x166acb[_0xe69eff(0x19c)](/\\/g,'');return console[_0xe69eff(0x12e)](_0xe69eff(0x12f)+_0x166acb+_0xe69eff(0x169)+_0xa4787d),_0xa4787d;}),console[_0x1fc8b9(0x12e)](_0x1fc8b9(0x139),_0x2bfc13),_0x2bfc13[_0x1fc8b9(0x167)]((_0x38fe63,_0x6ec60d)=>{const _0x2b8e8d=_0x1fc8b9;try{new URL(_0x38fe63),console[_0x2b8e8d(0x12e)]('âœ…\x20URL\x20'+(_0x6ec60d+0x1)+_0x2b8e8d(0x14c)+_0x38fe63);}catch(_0x5c8db9){console[_0x2b8e8d(0x186)](_0x2b8e8d(0x15b)+(_0x6ec60d+0x1)+_0x2b8e8d(0x14d)+_0x38fe63,_0x5c8db9);}});}catch(_0x429f14){console[_0x1fc8b9(0x186)](_0x1fc8b9(0x144),_0x429f14),console[_0x1fc8b9(0x186)](_0x1fc8b9(0x198),_0x42926a[_0x1fc8b9(0x153)]),_0x2bfc13=undefined;}return{'paymentId':_0x42926a[_0x1fc8b9(0x12a)]||'','status':_0x214961,'amount':_0x42926a[_0x1fc8b9(0x14f)],'currency':_0x42926a[_0x1fc8b9(0x133)],'txUrls':_0x2bfc13};}}exports['PlisioService']=PlisioService;