'use strict';const a43_0x1b66e5=a43_0x1bf3;(function(_0x2d7fe9,_0x16b5d8){const _0x2f3b7c=a43_0x1bf3,_0x4a3573=_0x2d7fe9();while(!![]){try{const _0xc8dc24=parseInt(_0x2f3b7c(0xe4))/0x1*(-parseInt(_0x2f3b7c(0xd0))/0x2)+parseInt(_0x2f3b7c(0xdc))/0x3*(-parseInt(_0x2f3b7c(0xe1))/0x4)+-parseInt(_0x2f3b7c(0xef))/0x5*(parseInt(_0x2f3b7c(0xe7))/0x6)+-parseInt(_0x2f3b7c(0xec))/0x7*(-parseInt(_0x2f3b7c(0xd1))/0x8)+-parseInt(_0x2f3b7c(0x114))/0x9+parseInt(_0x2f3b7c(0xc3))/0xa+parseInt(_0x2f3b7c(0xbc))/0xb*(parseInt(_0x2f3b7c(0x112))/0xc);if(_0xc8dc24===_0x16b5d8)break;else _0x4a3573['push'](_0x4a3573['shift']());}catch(_0x348093){_0x4a3573['push'](_0x4a3573['shift']());}}}(a43_0x1cd9,0x57501));Object[a43_0x1b66e5(0x103)](exports,a43_0x1b66e5(0xed),{'value':!![]}),exports[a43_0x1b66e5(0xcc)]=void 0x0;const loggerService_1=require('../loggerService');function a43_0x1bf3(_0x407a3c,_0x3baebd){const _0x1cd940=a43_0x1cd9();return a43_0x1bf3=function(_0x1bf3ae,_0x1d1d11){_0x1bf3ae=_0x1bf3ae-0xbc;let _0x15f83a=_0x1cd940[_0x1bf3ae];return _0x15f83a;},a43_0x1bf3(_0x407a3c,_0x3baebd);}class PlisioService{constructor(){const _0x1b4293=a43_0x1b66e5;this[_0x1b4293(0x12e)]=_0x1b4293(0xf4),this[_0x1b4293(0xf6)]=process[_0x1b4293(0xc9)]['PLISIO_API_KEY']||'',!this['apiKey']?console[_0x1b4293(0x101)](_0x1b4293(0x102)):console[_0x1b4293(0x12c)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async['createPayment'](_0x688e88){const _0x48172c=a43_0x1b66e5,{orderId:_0x5308a2,amount:_0x1e34a0,currency:_0x3ef98d,productName:_0x2a0a14,description:_0x5cada2,successUrl:_0x347fab,failUrl:_0x4d1f35,customerEmail:_0x16dfb8,customerName:_0x363580,isSourceCurrency:_0x1bbd12,sourceCurrency:_0x2d8a24}=_0x688e88;if(!this[_0x48172c(0xf6)])throw new Error(_0x48172c(0xcf));const _0x3ccbcd=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x5308a2,'order_name':_0x2a0a14,'description':_0x5cada2,'success_url':_0x347fab,'fail_url':_0x4d1f35,'callback_url':_0x48172c(0xe8)});_0x2d8a24?(_0x3ccbcd[_0x48172c(0xd4)]('currency',_0x2d8a24),_0x3ccbcd[_0x48172c(0xd4)](_0x48172c(0xd2),_0x3ef98d),_0x3ccbcd[_0x48172c(0xd4)](_0x48172c(0x121),_0x1e34a0[_0x48172c(0xee)]())):(_0x3ccbcd[_0x48172c(0xd4)](_0x48172c(0x11f),_0x3ef98d),_0x3ccbcd[_0x48172c(0xd4)](_0x48172c(0x128),_0x1e34a0['toString']()));_0x16dfb8&&_0x3ccbcd[_0x48172c(0xd4)](_0x48172c(0x12a),_0x16dfb8);_0x363580&&_0x3ccbcd[_0x48172c(0xd4)](_0x48172c(0x126),_0x363580);const _0x4ce0ae=this[_0x48172c(0x12e)]+'?'+_0x3ccbcd[_0x48172c(0xee)](),_0x2c8a98=Date['now']();try{console['log']('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x48172c(0x12c)](_0x48172c(0xdb),this[_0x48172c(0x12e)]),console['log'](_0x48172c(0x105),Object['fromEntries'](_0x3ccbcd[_0x48172c(0x12f)]())),console[_0x48172c(0x12c)](_0x48172c(0x109),_0x4ce0ae[_0x48172c(0xe9)](this[_0x48172c(0xf6)],_0x48172c(0xf5))),loggerService_1[_0x48172c(0x108)][_0x48172c(0xda)](_0x48172c(0xdd),_0x48172c(0xc6),_0x48172c(0xfd),Object[_0x48172c(0xde)](_0x3ccbcd[_0x48172c(0x12f)]()));const _0x1b8cac=await fetch(_0x4ce0ae,{'method':_0x48172c(0xfd),'headers':{'Accept':_0x48172c(0xc7),'User-Agent':_0x48172c(0x120)}}),_0x25bca9=Date['now']()-_0x2c8a98;console[_0x48172c(0x12c)](_0x48172c(0xf0)),console[_0x48172c(0x12c)](_0x48172c(0x11e),_0x1b8cac[_0x48172c(0xe5)]),console[_0x48172c(0x12c)]('Status\x20Text:',_0x1b8cac[_0x48172c(0xfc)]),console[_0x48172c(0x12c)](_0x48172c(0x106),_0x25bca9+'ms');const _0x40b230=await _0x1b8cac['text']();console[_0x48172c(0x12c)]('Raw\x20Response\x20Body:',_0x40b230);if(!_0x1b8cac['ok']){console[_0x48172c(0x12b)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x48172c(0x12b)](_0x48172c(0xea),_0x1b8cac[_0x48172c(0xe5)]),console['error'](_0x48172c(0x117),_0x40b230),loggerService_1[_0x48172c(0x108)][_0x48172c(0xce)](_0x48172c(0xdd),_0x48172c(0xc6),_0x1b8cac[_0x48172c(0xe5)],_0x40b230,_0x25bca9),loggerService_1[_0x48172c(0x108)][_0x48172c(0x10e)](_0x48172c(0xdd),_0x48172c(0xc6),_0x48172c(0xca)+_0x1b8cac[_0x48172c(0xe5)]+':\x20'+_0x40b230);throw new Error(_0x48172c(0xe0)+_0x1b8cac[_0x48172c(0xe5)]+_0x48172c(0x116)+_0x40b230);}let _0x5475b0;try{_0x5475b0=JSON[_0x48172c(0xd8)](_0x40b230);}catch(_0x871714){console['error'](_0x48172c(0x123),_0x871714),loggerService_1[_0x48172c(0x108)]['logWhiteDomainError'](_0x48172c(0xdd),'/invoices/new',_0x48172c(0xcb)+_0x871714);throw new Error(_0x48172c(0xc2)+_0x40b230);}console[_0x48172c(0x12c)](_0x48172c(0xc0)),console[_0x48172c(0x12c)](_0x48172c(0x10c),JSON[_0x48172c(0xeb)](_0x5475b0,null,0x2)),loggerService_1[_0x48172c(0x108)]['logWhiteDomainResponse']('plisio_direct','/invoices/new',_0x1b8cac[_0x48172c(0xe5)],_0x5475b0,_0x25bca9);if(_0x5475b0[_0x48172c(0xe5)]!==_0x48172c(0x110)){const _0x510fe7=_0x5475b0[_0x48172c(0xc4)]||_0x5475b0[_0x48172c(0x12b)]||_0x48172c(0xf7);console[_0x48172c(0x12b)](_0x48172c(0xcd)),console['error'](_0x48172c(0xd5),_0x510fe7),loggerService_1[_0x48172c(0x108)][_0x48172c(0x10e)](_0x48172c(0xdd),_0x48172c(0xc6),_0x48172c(0xf2)+_0x510fe7);throw new Error(_0x48172c(0x107)+_0x510fe7);}if(!_0x5475b0['data']?.[_0x48172c(0xc1)]||!_0x5475b0[_0x48172c(0x12d)]?.[_0x48172c(0xe2)]){console[_0x48172c(0x12b)](_0x48172c(0x119)),console['error'](_0x48172c(0xbf)),console['error'](_0x48172c(0x11a),_0x5475b0[_0x48172c(0x12d)]),loggerService_1['loggerService'][_0x48172c(0x10e)](_0x48172c(0xdd),_0x48172c(0xc6),_0x48172c(0xc8));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x48172c(0x12c)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x48172c(0x12c)](_0x48172c(0xdf),_0x5475b0[_0x48172c(0x12d)]['txn_id']),console[_0x48172c(0x12c)](_0x48172c(0x115),_0x5475b0['data']['invoice_url']),console[_0x48172c(0x12c)](_0x48172c(0x124),_0x1e34a0,_0x3ef98d),_0x2d8a24&&(console[_0x48172c(0x12c)](_0x48172c(0x11c),_0x2d8a24,_0x48172c(0x122)),console[_0x48172c(0x12c)](_0x48172c(0x125),_0x3ef98d,_0x48172c(0xe6))),{'gateway_payment_id':_0x5475b0[_0x48172c(0x12d)][_0x48172c(0xc1)],'payment_url':_0x5475b0[_0x48172c(0x12d)]['invoice_url'],'invoice_total_sum':_0x5475b0[_0x48172c(0x12d)]['invoice_total_sum'],'qr_code':_0x5475b0[_0x48172c(0x12d)][_0x48172c(0xf9)],'qr_url':_0x5475b0['data'][_0x48172c(0xfe)]};}catch(_0x388408){console[_0x48172c(0x12b)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x48172c(0x12b)](_0x48172c(0xbd),_0x388408),loggerService_1[_0x48172c(0x108)]['logWhiteDomainError']('plisio_direct','/invoices/new',_0x388408);if(_0x388408 instanceof Error){console['error'](_0x48172c(0x118),_0x388408[_0x48172c(0xc4)]),console['error']('Error\x20stack:',_0x388408['stack']);throw new Error(_0x48172c(0x10b)+_0x388408[_0x48172c(0xc4)]);}throw new Error(_0x48172c(0xc5));}}async[a43_0x1b66e5(0x11b)](_0x54c8b5){const _0x108ffe=a43_0x1b66e5,_0x5cbafc=Date[_0x108ffe(0xbe)]();try{if(!this[_0x108ffe(0xf6)])throw new Error(_0x108ffe(0xcf));const _0x163e7f=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x54c8b5}),_0x34bb41=_0x108ffe(0x10d)+_0x54c8b5+'?'+_0x163e7f[_0x108ffe(0xee)]();loggerService_1[_0x108ffe(0x108)][_0x108ffe(0xda)](_0x108ffe(0xdd),_0x108ffe(0xd9)+_0x54c8b5,_0x108ffe(0xfd),Object['fromEntries'](_0x163e7f[_0x108ffe(0x12f)]()));const _0x4c4550=await fetch(_0x34bb41,{'method':_0x108ffe(0xfd),'headers':{'Accept':_0x108ffe(0xc7),'User-Agent':_0x108ffe(0x120)}}),_0x257fc3=Date[_0x108ffe(0xbe)]()-_0x5cbafc;if(!_0x4c4550['ok']){const _0x2a5384=await _0x4c4550[_0x108ffe(0xfb)]();loggerService_1[_0x108ffe(0x108)]['logWhiteDomainResponse'](_0x108ffe(0xdd),_0x108ffe(0xd9)+_0x54c8b5,_0x4c4550[_0x108ffe(0xe5)],_0x2a5384,_0x257fc3);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4c4550['status']);}const _0x134d55=await _0x4c4550['json']();loggerService_1['loggerService'][_0x108ffe(0xce)]('plisio_direct',_0x108ffe(0xd9)+_0x54c8b5,_0x4c4550['status'],_0x134d55,_0x257fc3);if(_0x134d55[_0x108ffe(0xe5)]!=='success'){loggerService_1[_0x108ffe(0x108)][_0x108ffe(0x10e)](_0x108ffe(0xdd),_0x108ffe(0xd9)+_0x54c8b5,_0x108ffe(0x107)+(_0x134d55['message']||_0x134d55[_0x108ffe(0x12b)]||_0x108ffe(0xff)));throw new Error(_0x108ffe(0x107)+(_0x134d55[_0x108ffe(0xc4)]||_0x134d55['error']||_0x108ffe(0xff)));}let _0x554f58='PENDING';return{'status':_0x554f58};}catch(_0x32bd74){console[_0x108ffe(0x12b)]('Plisio\x20payment\x20verification\x20error:',_0x32bd74),loggerService_1[_0x108ffe(0x108)][_0x108ffe(0x10e)]('plisio_direct',_0x108ffe(0xd9)+_0x54c8b5,_0x32bd74);throw new Error(_0x108ffe(0x10f)+(_0x32bd74 instanceof Error?_0x32bd74['message']:_0x108ffe(0xff)));}}async[a43_0x1b66e5(0xd3)](_0x4db1c1){const _0x485fed=a43_0x1b66e5;console[_0x485fed(0x12c)](_0x485fed(0xd7),_0x4db1c1);let _0x3d16b5=_0x485fed(0xf1);switch(_0x4db1c1[_0x485fed(0xe5)]?.[_0x485fed(0x100)]()){case _0x485fed(0x113):case _0x485fed(0x11d):_0x3d16b5=_0x485fed(0x111);break;case _0x485fed(0xe3):_0x3d16b5='EXPIRED';break;case'error':case'cancelled':_0x3d16b5='FAILED';break;case'new':case _0x485fed(0xd6):default:_0x3d16b5=_0x485fed(0xf1);break;}let _0x1a4753;if(_0x4db1c1[_0x485fed(0x129)])try{console['log']('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x4db1c1[_0x485fed(0x129)]);let _0xfbdbeb;if(typeof _0x4db1c1[_0x485fed(0x129)]===_0x485fed(0x104))_0xfbdbeb=JSON[_0x485fed(0xd8)](_0x4db1c1['tx_urls']);else Array['isArray'](_0x4db1c1[_0x485fed(0x129)])?_0xfbdbeb=_0x4db1c1[_0x485fed(0x129)]:_0xfbdbeb=[];_0x1a4753=_0xfbdbeb['map'](_0x5a68a3=>{const _0x5d3143=_0x485fed,_0x6788bc=_0x5a68a3[_0x5d3143(0xe9)](/\\/g,'');return console['log']('üîó\x20Formatted\x20URL:\x20'+_0x5a68a3+_0x5d3143(0xfa)+_0x6788bc),_0x6788bc;}),console[_0x485fed(0x12c)]('‚úÖ\x20Processed\x20tx_urls:',_0x1a4753),_0x1a4753['forEach']((_0x2a0f6a,_0x1a7b45)=>{const _0x116b5b=_0x485fed;try{new URL(_0x2a0f6a),console[_0x116b5b(0x12c)]('‚úÖ\x20URL\x20'+(_0x1a7b45+0x1)+_0x116b5b(0xf3)+_0x2a0f6a);}catch(_0x461cab){console[_0x116b5b(0x12b)]('‚ùå\x20URL\x20'+(_0x1a7b45+0x1)+_0x116b5b(0xf8)+_0x2a0f6a,_0x461cab);}});}catch(_0x17d396){console[_0x485fed(0x12b)](_0x485fed(0x127),_0x17d396),console[_0x485fed(0x12b)]('Raw\x20tx_urls\x20data:',_0x4db1c1[_0x485fed(0x129)]),_0x1a4753=undefined;}return{'paymentId':_0x4db1c1[_0x485fed(0x10a)]||'','status':_0x3d16b5,'amount':_0x4db1c1['amount'],'currency':_0x4db1c1[_0x485fed(0x11f)],'txUrls':_0x1a4753};}}function a43_0x1cd9(){const _0x44f4fe=['HIDDEN','apiKey','Unknown\x20error\x20from\x20Plisio\x20API','\x20is\x20invalid:\x20','qr_code','\x20->\x20','text','statusText','GET','qr_url','Unknown\x20error','toLowerCase','warn','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','defineProperty','string','Parameters:','Response\x20Time:','Plisio\x20API\x20error:\x20','loggerService','Full\x20URL\x20(without\x20API\x20key):','order_number','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Parsed\x20Result:','https://api.plisio.net/api/v1/operations/','logWhiteDomainError','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','success','PAID','24636RaFjNm','completed','1639602HTvMKD','Invoice\x20URL:',',\x20body:\x20','Response\x20Body:','Error\x20message:','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Response\x20data:','verifyPayment','Source\x20Currency:','mismatch','Status:','currency','TesSoft\x20Payment\x20System/1.0','source_amount','(crypto\x20for\x20payment)','Failed\x20to\x20parse\x20JSON\x20response:','Amount:','Target\x20Currency:','name','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','amount','tx_urls','email','error','log','data','apiUrl','entries','4367WbFlrY','Error\x20details:','now','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','txn_id','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','2664610ZLAPhN','message','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','/invoices/new','application/json','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','env','HTTP\x20','JSON\x20Parse\x20Error:\x20','PlisioService','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','logWhiteDomainResponse','Plisio\x20API\x20key\x20is\x20not\x20configured','32948UAXReL','4496gIgyVM','source_currency','processWebhook','append','Error\x20Message:','pending','Processing\x20Plisio\x20webhook:','parse','/operations/','logWhiteDomainRequest','URL:','3381qABdhI','plisio_direct','fromEntries','Transaction\x20ID:','HTTP\x20error!\x20status:\x20','340JXoMpq','invoice_url','expired','19GDUIgZ','status','(fiat\x20for\x20merchant)','72xgjdWe','https://apitest.trapay.uk/api/webhooks/gateway/plisio','replace','HTTP\x20Status:','stringify','6517rHnJdm','__esModule','toString','273380wOvVks','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','PENDING','Business\x20Error:\x20','\x20is\x20valid:\x20','https://api.plisio.net/api/v1/invoices/new'];a43_0x1cd9=function(){return _0x44f4fe;};return a43_0x1cd9();}exports['PlisioService']=PlisioService;