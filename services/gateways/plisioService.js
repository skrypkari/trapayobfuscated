'use strict';function a41_0x5b95(_0x35bf85,_0x2ddfc1){const _0x65f1d5=a41_0x65f1();return a41_0x5b95=function(_0x5b95fc,_0x266814){_0x5b95fc=_0x5b95fc-0xfd;let _0x1d3088=_0x65f1d5[_0x5b95fc];return _0x1d3088;},a41_0x5b95(_0x35bf85,_0x2ddfc1);}const a41_0x5813ca=a41_0x5b95;(function(_0x15d401,_0x4a6520){const _0x140734=a41_0x5b95,_0x58a41a=_0x15d401();while(!![]){try{const _0x539df6=-parseInt(_0x140734(0x11a))/0x1+parseInt(_0x140734(0x13f))/0x2+-parseInt(_0x140734(0x118))/0x3+-parseInt(_0x140734(0x157))/0x4+-parseInt(_0x140734(0x11b))/0x5*(-parseInt(_0x140734(0x156))/0x6)+parseInt(_0x140734(0x135))/0x7+-parseInt(_0x140734(0x10f))/0x8*(parseInt(_0x140734(0x108))/0x9);if(_0x539df6===_0x4a6520)break;else _0x58a41a['push'](_0x58a41a['shift']());}catch(_0x4c80b2){_0x58a41a['push'](_0x58a41a['shift']());}}}(a41_0x65f1,0x5745a));Object[a41_0x5813ca(0x15a)](exports,a41_0x5813ca(0x107),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require('../loggerService');function a41_0x65f1(){const _0x479044=['source_currency','invoice_total_sum','order_number','stack','plisio_direct','logWhiteDomainResponse','fromEntries','===\x20PLISIO\x20API\x20ERROR\x20===','Response\x20Body:','413064gznwdn','URL:','logWhiteDomainError','===\x20PLISIO\x20SUCCESS\x20===','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','GET','PLISIO_API_KEY','Error\x20details:','parse','EXPIRED','Transaction\x20ID:','Response\x20data:','Unknown\x20error\x20from\x20Plisio\x20API','Parameters:',',\x20body:\x20','JSON\x20Parse\x20Error:\x20','now','json','Error\x20stack:','currency','HTTP\x20','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','txn_id','1404gMdCHu','48288pHmbFR','TesSoft\x20Payment\x20System/1.0','https://api.plisio.net/api/v1/operations/','defineProperty','Invoice\x20URL:','append','Parsed\x20Result:','replace','message','completed','entries','Failed\x20to\x20parse\x20JSON\x20response:','cancelled','Plisio\x20API\x20error:\x20','logWhiteDomainRequest','Plisio\x20payment\x20verification\x20error:','HTTP\x20Status:','expired','Processing\x20Plisio\x20webhook:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','text','createPayment','Full\x20URL\x20(without\x20API\x20key):','Status\x20Text:','error','__esModule','1959291UpqKve','Status:','invoice_url','data','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','log','toString','24ltYjUz','verifyPayment','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','/invoices/new','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','1038630aXeWdx','name','135279rNuQZd','14540CuBRrP','Response\x20Time:','env','(crypto\x20for\x20payment)','source_amount','processWebhook','Source\x20Currency:','HIDDEN','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','stringify','amount','Business\x20Error:\x20','PENDING','apiUrl','Raw\x20Response\x20Body:','status','https://api.plisio.net/api/v1/invoices/new','FAILED','loggerService','Unknown\x20error','Plisio\x20API\x20key\x20is\x20not\x20configured','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','apiKey','pending','success','/operations/','4319840bXfLlc'];a41_0x65f1=function(){return _0x479044;};return a41_0x65f1();}class PlisioService{constructor(){const _0x4062d3=a41_0x5813ca;this[_0x4062d3(0x128)]=_0x4062d3(0x12b),this['apiKey']=process[_0x4062d3(0x11d)][_0x4062d3(0x145)]||'',!this['apiKey']?console['warn'](_0x4062d3(0x111)):console[_0x4062d3(0x10d)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a41_0x5813ca(0x103)](_0x508dd9){const _0x4afe91=a41_0x5813ca,{orderId:_0x26532b,amount:_0x412548,currency:_0x55af11,productName:_0x369020,description:_0x4c5735,successUrl:_0xd90659,failUrl:_0x6cc2c1,customerEmail:_0x5ea87e,customerName:_0x572bc2,isSourceCurrency:_0xe288ed,sourceCurrency:_0x349b70}=_0x508dd9;if(!this[_0x4afe91(0x131)])throw new Error(_0x4afe91(0x12f));const _0x1fc613=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x26532b,'order_name':_0x369020,'description':_0x4c5735,'success_url':_0xd90659,'fail_url':_0x6cc2c1});_0x349b70?(_0x1fc613[_0x4afe91(0x15c)](_0x4afe91(0x152),_0x349b70),_0x1fc613[_0x4afe91(0x15c)](_0x4afe91(0x136),_0x55af11),_0x1fc613[_0x4afe91(0x15c)](_0x4afe91(0x11f),_0x412548[_0x4afe91(0x10e)]())):(_0x1fc613[_0x4afe91(0x15c)](_0x4afe91(0x152),_0x55af11),_0x1fc613[_0x4afe91(0x15c)](_0x4afe91(0x125),_0x412548[_0x4afe91(0x10e)]()));_0x5ea87e&&_0x1fc613['append']('email',_0x5ea87e);_0x572bc2&&_0x1fc613['append'](_0x4afe91(0x119),_0x572bc2);const _0x443e39=this[_0x4afe91(0x128)]+'?'+_0x1fc613[_0x4afe91(0x10e)](),_0x4d6ebe=Date[_0x4afe91(0x14f)]();try{console[_0x4afe91(0x10d)](_0x4afe91(0x117)),console[_0x4afe91(0x10d)](_0x4afe91(0x140),this[_0x4afe91(0x128)]),console[_0x4afe91(0x10d)](_0x4afe91(0x14c),Object['fromEntries'](_0x1fc613[_0x4afe91(0x161)]())),console[_0x4afe91(0x10d)](_0x4afe91(0x104),_0x443e39[_0x4afe91(0x15e)](this[_0x4afe91(0x131)],_0x4afe91(0x122))),loggerService_1['loggerService'][_0x4afe91(0x165)](_0x4afe91(0x13a),_0x4afe91(0x114),_0x4afe91(0x144),Object[_0x4afe91(0x13c)](_0x1fc613[_0x4afe91(0x161)]()));const _0x21745e=await fetch(_0x443e39,{'method':'GET','headers':{'Accept':'application/json','User-Agent':_0x4afe91(0x158)}}),_0x26d159=Date[_0x4afe91(0x14f)]()-_0x4d6ebe;console[_0x4afe91(0x10d)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console['log'](_0x4afe91(0x109),_0x21745e[_0x4afe91(0x12a)]),console[_0x4afe91(0x10d)](_0x4afe91(0x105),_0x21745e['statusText']),console[_0x4afe91(0x10d)](_0x4afe91(0x11c),_0x26d159+'ms');const _0xfdf2fe=await _0x21745e['text']();console[_0x4afe91(0x10d)](_0x4afe91(0x129),_0xfdf2fe);if(!_0x21745e['ok']){console[_0x4afe91(0x106)](_0x4afe91(0x13d)),console[_0x4afe91(0x106)](_0x4afe91(0xfe),_0x21745e['status']),console[_0x4afe91(0x106)](_0x4afe91(0x13e),_0xfdf2fe),loggerService_1[_0x4afe91(0x12d)]['logWhiteDomainResponse'](_0x4afe91(0x13a),'/invoices/new',_0x21745e['status'],_0xfdf2fe,_0x26d159),loggerService_1[_0x4afe91(0x12d)][_0x4afe91(0x141)](_0x4afe91(0x13a),_0x4afe91(0x114),_0x4afe91(0x153)+_0x21745e[_0x4afe91(0x12a)]+':\x20'+_0xfdf2fe);throw new Error(_0x4afe91(0x113)+_0x21745e[_0x4afe91(0x12a)]+_0x4afe91(0x14d)+_0xfdf2fe);}let _0x361d40;try{_0x361d40=JSON[_0x4afe91(0x147)](_0xfdf2fe);}catch(_0x5dd2b1){console[_0x4afe91(0x106)](_0x4afe91(0x162),_0x5dd2b1),loggerService_1['loggerService']['logWhiteDomainError'](_0x4afe91(0x13a),_0x4afe91(0x114),_0x4afe91(0x14e)+_0x5dd2b1);throw new Error(_0x4afe91(0x10c)+_0xfdf2fe);}console[_0x4afe91(0x10d)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console['log'](_0x4afe91(0x15d),JSON[_0x4afe91(0x124)](_0x361d40,null,0x2)),loggerService_1['loggerService'][_0x4afe91(0x13b)](_0x4afe91(0x13a),_0x4afe91(0x114),_0x21745e['status'],_0x361d40,_0x26d159);if(_0x361d40[_0x4afe91(0x12a)]!==_0x4afe91(0x133)){const _0x18c2ec=_0x361d40['message']||_0x361d40[_0x4afe91(0x106)]||_0x4afe91(0x14b);console[_0x4afe91(0x106)](_0x4afe91(0x112)),console[_0x4afe91(0x106)]('Error\x20Message:',_0x18c2ec),loggerService_1[_0x4afe91(0x12d)]['logWhiteDomainError']('plisio_direct',_0x4afe91(0x114),_0x4afe91(0x126)+_0x18c2ec);throw new Error('Plisio\x20API\x20error:\x20'+_0x18c2ec);}if(!_0x361d40['data']?.[_0x4afe91(0x155)]||!_0x361d40[_0x4afe91(0x10b)]?.[_0x4afe91(0x10a)]){console[_0x4afe91(0x106)](_0x4afe91(0x143)),console[_0x4afe91(0x106)](_0x4afe91(0x154)),console[_0x4afe91(0x106)](_0x4afe91(0x14a),_0x361d40[_0x4afe91(0x10b)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x4afe91(0x13a),_0x4afe91(0x114),_0x4afe91(0x101));throw new Error(_0x4afe91(0x116));}return console[_0x4afe91(0x10d)](_0x4afe91(0x142)),console[_0x4afe91(0x10d)](_0x4afe91(0x149),_0x361d40[_0x4afe91(0x10b)][_0x4afe91(0x155)]),console['log'](_0x4afe91(0x15b),_0x361d40[_0x4afe91(0x10b)][_0x4afe91(0x10a)]),console[_0x4afe91(0x10d)]('Amount:',_0x412548,_0x55af11),_0x349b70&&(console[_0x4afe91(0x10d)](_0x4afe91(0x121),_0x349b70,_0x4afe91(0x11e)),console[_0x4afe91(0x10d)]('Target\x20Currency:',_0x55af11,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x361d40[_0x4afe91(0x10b)][_0x4afe91(0x155)],'payment_url':_0x361d40[_0x4afe91(0x10b)][_0x4afe91(0x10a)],'invoice_total_sum':_0x361d40[_0x4afe91(0x10b)][_0x4afe91(0x137)],'qr_code':_0x361d40['data']['qr_code'],'qr_url':_0x361d40[_0x4afe91(0x10b)]['qr_url']};}catch(_0xa43138){console[_0x4afe91(0x106)](_0x4afe91(0x130)),console[_0x4afe91(0x106)](_0x4afe91(0x146),_0xa43138),loggerService_1['loggerService'][_0x4afe91(0x141)](_0x4afe91(0x13a),_0x4afe91(0x114),_0xa43138);if(_0xa43138 instanceof Error){console[_0x4afe91(0x106)]('Error\x20message:',_0xa43138['message']),console[_0x4afe91(0x106)](_0x4afe91(0x151),_0xa43138[_0x4afe91(0x139)]);throw new Error(_0x4afe91(0x115)+_0xa43138[_0x4afe91(0x15f)]);}throw new Error(_0x4afe91(0x123));}}async[a41_0x5813ca(0x110)](_0x1a1c2b){const _0x1037fe=a41_0x5813ca,_0x23356b=Date[_0x1037fe(0x14f)]();try{if(!this['apiKey'])throw new Error(_0x1037fe(0x12f));const _0x3092ce=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x1a1c2b}),_0x248ce3=_0x1037fe(0x159)+_0x1a1c2b+'?'+_0x3092ce[_0x1037fe(0x10e)]();loggerService_1['loggerService'][_0x1037fe(0x165)](_0x1037fe(0x13a),_0x1037fe(0x134)+_0x1a1c2b,_0x1037fe(0x144),Object[_0x1037fe(0x13c)](_0x3092ce[_0x1037fe(0x161)]()));const _0x37b6b0=await fetch(_0x248ce3,{'method':_0x1037fe(0x144),'headers':{'Accept':'application/json','User-Agent':_0x1037fe(0x158)}}),_0x307a07=Date['now']()-_0x23356b;if(!_0x37b6b0['ok']){const _0xb77346=await _0x37b6b0[_0x1037fe(0x102)]();loggerService_1[_0x1037fe(0x12d)][_0x1037fe(0x13b)](_0x1037fe(0x13a),_0x1037fe(0x134)+_0x1a1c2b,_0x37b6b0[_0x1037fe(0x12a)],_0xb77346,_0x307a07);throw new Error(_0x1037fe(0x113)+_0x37b6b0[_0x1037fe(0x12a)]);}const _0xe8133=await _0x37b6b0[_0x1037fe(0x150)]();loggerService_1[_0x1037fe(0x12d)]['logWhiteDomainResponse'](_0x1037fe(0x13a),_0x1037fe(0x134)+_0x1a1c2b,_0x37b6b0[_0x1037fe(0x12a)],_0xe8133,_0x307a07);if(_0xe8133[_0x1037fe(0x12a)]!==_0x1037fe(0x133)){loggerService_1[_0x1037fe(0x12d)][_0x1037fe(0x141)](_0x1037fe(0x13a),'/operations/'+_0x1a1c2b,_0x1037fe(0x164)+(_0xe8133[_0x1037fe(0x15f)]||_0xe8133['error']||_0x1037fe(0x12e)));throw new Error(_0x1037fe(0x164)+(_0xe8133['message']||_0xe8133[_0x1037fe(0x106)]||_0x1037fe(0x12e)));}let _0x52804d=_0x1037fe(0x127);return{'status':_0x52804d};}catch(_0x12ce46){console[_0x1037fe(0x106)](_0x1037fe(0xfd),_0x12ce46),loggerService_1[_0x1037fe(0x12d)][_0x1037fe(0x141)](_0x1037fe(0x13a),_0x1037fe(0x134)+_0x1a1c2b,_0x12ce46);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x12ce46 instanceof Error?_0x12ce46[_0x1037fe(0x15f)]:_0x1037fe(0x12e)));}}async[a41_0x5813ca(0x120)](_0x2fa62d){const _0x1bb528=a41_0x5813ca;console[_0x1bb528(0x10d)](_0x1bb528(0x100),_0x2fa62d);let _0xed672b=_0x1bb528(0x127);switch(_0x2fa62d['status']?.['toLowerCase']()){case _0x1bb528(0x160):case'mismatch':_0xed672b='PAID';break;case _0x1bb528(0xff):_0xed672b=_0x1bb528(0x148);break;case _0x1bb528(0x106):case _0x1bb528(0x163):_0xed672b=_0x1bb528(0x12c);break;case'new':case _0x1bb528(0x132):default:_0xed672b=_0x1bb528(0x127);break;}return{'paymentId':_0x2fa62d[_0x1bb528(0x138)]||'','status':_0xed672b,'amount':_0x2fa62d['amount'],'currency':_0x2fa62d[_0x1bb528(0x152)]};}}exports['PlisioService']=PlisioService;