'use strict';const a43_0x21e060=a43_0x2aff;(function(_0x2ff2e9,_0x33d492){const _0x44da61=a43_0x2aff,_0x23565e=_0x2ff2e9();while(!![]){try{const _0x3b3364=-parseInt(_0x44da61(0x1db))/0x1*(-parseInt(_0x44da61(0x1df))/0x2)+-parseInt(_0x44da61(0x213))/0x3+-parseInt(_0x44da61(0x1b5))/0x4*(-parseInt(_0x44da61(0x1d3))/0x5)+parseInt(_0x44da61(0x1ed))/0x6*(parseInt(_0x44da61(0x1c6))/0x7)+-parseInt(_0x44da61(0x1c7))/0x8+-parseInt(_0x44da61(0x1b4))/0x9+parseInt(_0x44da61(0x1d4))/0xa;if(_0x3b3364===_0x33d492)break;else _0x23565e['push'](_0x23565e['shift']());}catch(_0xff4a2d){_0x23565e['push'](_0x23565e['shift']());}}}(a43_0x98cf,0x73dff));function a43_0x2aff(_0x4c701c,_0x4de8da){const _0x98cf5c=a43_0x98cf();return a43_0x2aff=function(_0x2afff8,_0x369d9a){_0x2afff8=_0x2afff8-0x1b0;let _0x48280c=_0x98cf5c[_0x2afff8];return _0x48280c;},a43_0x2aff(_0x4c701c,_0x4de8da);}function a43_0x98cf(){const _0x254e22=['invoice_url','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','PAID','/operations/','../loggerService','qr_url','Raw\x20tx_urls\x20data:','PlisioService','GET','processWebhook','===\x20PLISIO\x20API\x20ERROR\x20===','PENDING','Processing\x20Plisio\x20webhook:','Unknown\x20error','logWhiteDomainError','loggerService','error','TesSoft\x20Payment\x20System/1.0','__esModule','Status:','HTTP\x20Status:','(crypto\x20for\x20payment)','Plisio\x20API\x20key\x20is\x20not\x20configured','source_amount','HTTP\x20','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','email','new','log','toString','Raw\x20Response\x20Body:','https://api.plisio.net/api/v1/operations/','\x20is\x20invalid:\x20','Plisio\x20payment\x20verification\x20error:','status','stringify','2755779IGhiaH','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','txn_id','data','Business\x20Error:\x20','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','text','plisio_direct','Invoice\x20URL:','logWhiteDomainResponse','Amount:','Error\x20Message:','Parsed\x20Result:','toLowerCase','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','7804818BHoDoz','1667876yPDzdb','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','string','Response\x20data:','Failed\x20to\x20parse\x20JSON\x20response:','/invoices/new','Source\x20Currency:','Parameters:','pending','apiKey','logWhiteDomainRequest','message','‚ùå\x20URL\x20','Response\x20Body:',',\x20body:\x20','env','warn','76433vHGrqF','2706872OOCFRD','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','\x20is\x20valid:\x20','isArray','qr_code','application/json','verifyPayment','Target\x20Currency:','now','PLISIO_API_KEY','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Error\x20message:','5iXfgdr','19062440JCEzCq','Plisio\x20API\x20error:\x20','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','append','order_number','Transaction\x20ID:','currency','21005xveaoy','tx_urls','HTTP\x20error!\x20status:\x20','‚úÖ\x20Processed\x20tx_urls:','20BHANQu','completed','json','replace','statusText','amount','success','https://api.plisio.net/api/v1/invoices/new','expired','EXPIRED','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','apiUrl','fromEntries','invoice_total_sum','36VMkvFs','Error\x20stack:'];a43_0x98cf=function(){return _0x254e22;};return a43_0x98cf();}Object['defineProperty'](exports,a43_0x21e060(0x201),{'value':!![]}),exports[a43_0x21e060(0x1f6)]=void 0x0;const loggerService_1=require(a43_0x21e060(0x1f3));class PlisioService{constructor(){const _0x215520=a43_0x21e060;this[_0x215520(0x1ea)]=_0x215520(0x1e6),this[_0x215520(0x1be)]=process[_0x215520(0x1c4)][_0x215520(0x1d0)]||'',!this[_0x215520(0x1be)]?console[_0x215520(0x1c5)](_0x215520(0x215)):console[_0x215520(0x20b)](_0x215520(0x1d1));}async['createPayment'](_0x15569a){const _0x533af2=a43_0x21e060,{orderId:_0x4208ff,amount:_0x51e451,currency:_0xf1a65c,productName:_0x564af2,description:_0xeeaea0,successUrl:_0x2ef62e,failUrl:_0x3cb739,customerEmail:_0x3cf4ef,customerName:_0x28ea00,isSourceCurrency:_0x3e30bc,sourceCurrency:_0x481548}=_0x15569a;if(!this[_0x533af2(0x1be)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x2a4176=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x4208ff,'order_name':_0x564af2,'description':_0xeeaea0,'success_url':_0x2ef62e,'fail_url':_0x3cb739,'callback_url':'https://apitest.trapay.uk/api/webhooks/gateway/plisio'});_0x481548?(_0x2a4176[_0x533af2(0x1d7)]('currency',_0x481548),_0x2a4176[_0x533af2(0x1d7)]('source_currency',_0xf1a65c),_0x2a4176[_0x533af2(0x1d7)](_0x533af2(0x206),_0x51e451[_0x533af2(0x20c)]())):(_0x2a4176[_0x533af2(0x1d7)](_0x533af2(0x1da),_0xf1a65c),_0x2a4176[_0x533af2(0x1d7)](_0x533af2(0x1e4),_0x51e451[_0x533af2(0x20c)]()));_0x3cf4ef&&_0x2a4176[_0x533af2(0x1d7)](_0x533af2(0x209),_0x3cf4ef);_0x28ea00&&_0x2a4176[_0x533af2(0x1d7)]('name',_0x28ea00);const _0x32a442=this[_0x533af2(0x1ea)]+'?'+_0x2a4176[_0x533af2(0x20c)](),_0x752372=Date['now']();try{console['log'](_0x533af2(0x208)),console['log']('URL:',this[_0x533af2(0x1ea)]),console['log'](_0x533af2(0x1bc),Object[_0x533af2(0x1eb)](_0x2a4176['entries']())),console[_0x533af2(0x20b)]('Full\x20URL\x20(without\x20API\x20key):',_0x32a442[_0x533af2(0x1e2)](this[_0x533af2(0x1be)],'HIDDEN')),loggerService_1[_0x533af2(0x1fe)]['logWhiteDomainRequest'](_0x533af2(0x21c),_0x533af2(0x1ba),'GET',Object[_0x533af2(0x1eb)](_0x2a4176['entries']()));const _0x23cf2e=await fetch(_0x32a442,{'method':_0x533af2(0x1f7),'headers':{'Accept':_0x533af2(0x1cc),'User-Agent':_0x533af2(0x200)}}),_0x4e8b58=Date['now']()-_0x752372;console[_0x533af2(0x20b)](_0x533af2(0x1e9)),console[_0x533af2(0x20b)](_0x533af2(0x202),_0x23cf2e[_0x533af2(0x211)]),console[_0x533af2(0x20b)]('Status\x20Text:',_0x23cf2e[_0x533af2(0x1e3)]),console[_0x533af2(0x20b)]('Response\x20Time:',_0x4e8b58+'ms');const _0x57b1fa=await _0x23cf2e['text']();console[_0x533af2(0x20b)](_0x533af2(0x20d),_0x57b1fa);if(!_0x23cf2e['ok']){console[_0x533af2(0x1ff)](_0x533af2(0x1f9)),console['error'](_0x533af2(0x203),_0x23cf2e[_0x533af2(0x211)]),console[_0x533af2(0x1ff)](_0x533af2(0x1c2),_0x57b1fa),loggerService_1[_0x533af2(0x1fe)][_0x533af2(0x21e)](_0x533af2(0x21c),'/invoices/new',_0x23cf2e[_0x533af2(0x211)],_0x57b1fa,_0x4e8b58),loggerService_1['loggerService'][_0x533af2(0x1fd)]('plisio_direct',_0x533af2(0x1ba),_0x533af2(0x207)+_0x23cf2e['status']+':\x20'+_0x57b1fa);throw new Error('HTTP\x20error!\x20status:\x20'+_0x23cf2e[_0x533af2(0x211)]+_0x533af2(0x1c3)+_0x57b1fa);}let _0x4f7047;try{_0x4f7047=JSON['parse'](_0x57b1fa);}catch(_0x18e0b1){console['error'](_0x533af2(0x1b9),_0x18e0b1),loggerService_1['loggerService'][_0x533af2(0x1fd)](_0x533af2(0x21c),_0x533af2(0x1ba),'JSON\x20Parse\x20Error:\x20'+_0x18e0b1);throw new Error(_0x533af2(0x1b3)+_0x57b1fa);}console[_0x533af2(0x20b)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x533af2(0x20b)](_0x533af2(0x1b1),JSON[_0x533af2(0x212)](_0x4f7047,null,0x2)),loggerService_1['loggerService'][_0x533af2(0x21e)](_0x533af2(0x21c),_0x533af2(0x1ba),_0x23cf2e[_0x533af2(0x211)],_0x4f7047,_0x4e8b58);if(_0x4f7047[_0x533af2(0x211)]!==_0x533af2(0x1e5)){const _0x3b79d3=_0x4f7047['message']||_0x4f7047['error']||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x533af2(0x1ff)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x533af2(0x1ff)](_0x533af2(0x1b0),_0x3b79d3),loggerService_1[_0x533af2(0x1fe)]['logWhiteDomainError'](_0x533af2(0x21c),_0x533af2(0x1ba),_0x533af2(0x219)+_0x3b79d3);throw new Error('Plisio\x20API\x20error:\x20'+_0x3b79d3);}if(!_0x4f7047[_0x533af2(0x218)]?.[_0x533af2(0x217)]||!_0x4f7047['data']?.[_0x533af2(0x1ef)]){console[_0x533af2(0x1ff)](_0x533af2(0x1d6)),console[_0x533af2(0x1ff)](_0x533af2(0x216)),console[_0x533af2(0x1ff)](_0x533af2(0x1b8),_0x4f7047['data']),loggerService_1['loggerService'][_0x533af2(0x1fd)](_0x533af2(0x21c),'/invoices/new',_0x533af2(0x1b6));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x533af2(0x20b)]('===\x20PLISIO\x20SUCCESS\x20==='),console['log'](_0x533af2(0x1d9),_0x4f7047[_0x533af2(0x218)][_0x533af2(0x217)]),console[_0x533af2(0x20b)](_0x533af2(0x21d),_0x4f7047[_0x533af2(0x218)][_0x533af2(0x1ef)]),console[_0x533af2(0x20b)](_0x533af2(0x21f),_0x51e451,_0xf1a65c),_0x481548&&(console[_0x533af2(0x20b)](_0x533af2(0x1bb),_0x481548,_0x533af2(0x204)),console['log'](_0x533af2(0x1ce),_0xf1a65c,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x4f7047[_0x533af2(0x218)][_0x533af2(0x217)],'payment_url':_0x4f7047['data'][_0x533af2(0x1ef)],'invoice_total_sum':_0x4f7047['data'][_0x533af2(0x1ec)],'qr_code':_0x4f7047[_0x533af2(0x218)][_0x533af2(0x1cb)],'qr_url':_0x4f7047[_0x533af2(0x218)][_0x533af2(0x1f4)]};}catch(_0x127dc4){console[_0x533af2(0x1ff)](_0x533af2(0x1c8)),console[_0x533af2(0x1ff)]('Error\x20details:',_0x127dc4),loggerService_1[_0x533af2(0x1fe)][_0x533af2(0x1fd)](_0x533af2(0x21c),_0x533af2(0x1ba),_0x127dc4);if(_0x127dc4 instanceof Error){console['error'](_0x533af2(0x1d2),_0x127dc4[_0x533af2(0x1c0)]),console['error'](_0x533af2(0x1ee),_0x127dc4['stack']);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x127dc4[_0x533af2(0x1c0)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a43_0x21e060(0x1cd)](_0x2f3c91){const _0x3e7d79=a43_0x21e060,_0x54d8d2=Date[_0x3e7d79(0x1cf)]();try{if(!this['apiKey'])throw new Error(_0x3e7d79(0x205));const _0x58db46=new URLSearchParams({'api_key':this[_0x3e7d79(0x1be)],'txn_id':_0x2f3c91}),_0x2f8d13=_0x3e7d79(0x20e)+_0x2f3c91+'?'+_0x58db46['toString']();loggerService_1[_0x3e7d79(0x1fe)][_0x3e7d79(0x1bf)](_0x3e7d79(0x21c),_0x3e7d79(0x1f2)+_0x2f3c91,_0x3e7d79(0x1f7),Object['fromEntries'](_0x58db46['entries']()));const _0x900521=await fetch(_0x2f8d13,{'method':_0x3e7d79(0x1f7),'headers':{'Accept':'application/json','User-Agent':_0x3e7d79(0x200)}}),_0x35b6f5=Date[_0x3e7d79(0x1cf)]()-_0x54d8d2;if(!_0x900521['ok']){const _0x6c1c85=await _0x900521[_0x3e7d79(0x21b)]();loggerService_1[_0x3e7d79(0x1fe)][_0x3e7d79(0x21e)](_0x3e7d79(0x21c),_0x3e7d79(0x1f2)+_0x2f3c91,_0x900521[_0x3e7d79(0x211)],_0x6c1c85,_0x35b6f5);throw new Error(_0x3e7d79(0x1dd)+_0x900521[_0x3e7d79(0x211)]);}const _0xeebc84=await _0x900521[_0x3e7d79(0x1e1)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3e7d79(0x21c),_0x3e7d79(0x1f2)+_0x2f3c91,_0x900521['status'],_0xeebc84,_0x35b6f5);if(_0xeebc84[_0x3e7d79(0x211)]!=='success'){loggerService_1[_0x3e7d79(0x1fe)][_0x3e7d79(0x1fd)](_0x3e7d79(0x21c),_0x3e7d79(0x1f2)+_0x2f3c91,_0x3e7d79(0x1d5)+(_0xeebc84[_0x3e7d79(0x1c0)]||_0xeebc84[_0x3e7d79(0x1ff)]||_0x3e7d79(0x1fc)));throw new Error(_0x3e7d79(0x1d5)+(_0xeebc84[_0x3e7d79(0x1c0)]||_0xeebc84[_0x3e7d79(0x1ff)]||_0x3e7d79(0x1fc)));}let _0x518654=_0x3e7d79(0x1fa);return{'status':_0x518654};}catch(_0x1abd2e){console[_0x3e7d79(0x1ff)](_0x3e7d79(0x210),_0x1abd2e),loggerService_1[_0x3e7d79(0x1fe)]['logWhiteDomainError'](_0x3e7d79(0x21c),'/operations/'+_0x2f3c91,_0x1abd2e);throw new Error(_0x3e7d79(0x214)+(_0x1abd2e instanceof Error?_0x1abd2e['message']:'Unknown\x20error'));}}async[a43_0x21e060(0x1f8)](_0x595a07){const _0x21cf87=a43_0x21e060;console[_0x21cf87(0x20b)](_0x21cf87(0x1fb),_0x595a07);let _0x322027='PENDING';switch(_0x595a07[_0x21cf87(0x211)]?.[_0x21cf87(0x1b2)]()){case _0x21cf87(0x1e0):case'mismatch':_0x322027=_0x21cf87(0x1f1);break;case _0x21cf87(0x1e7):_0x322027=_0x21cf87(0x1e8);break;case'error':case'cancelled':_0x322027='FAILED';break;case _0x21cf87(0x20a):case _0x21cf87(0x1bd):default:_0x322027='PENDING';break;}let _0x1a683a;if(_0x595a07[_0x21cf87(0x1dc)])try{console['log'](_0x21cf87(0x21a),_0x595a07['tx_urls']);let _0x3fa1f8;if(typeof _0x595a07[_0x21cf87(0x1dc)]===_0x21cf87(0x1b7))_0x3fa1f8=JSON['parse'](_0x595a07[_0x21cf87(0x1dc)]);else Array[_0x21cf87(0x1ca)](_0x595a07[_0x21cf87(0x1dc)])?_0x3fa1f8=_0x595a07[_0x21cf87(0x1dc)]:_0x3fa1f8=[];_0x1a683a=_0x3fa1f8['map'](_0x1fd32a=>{const _0x3b766c=_0x21cf87,_0x16525=_0x1fd32a['replace'](/\\/g,'');return console[_0x3b766c(0x20b)]('üîó\x20Formatted\x20URL:\x20'+_0x1fd32a+'\x20->\x20'+_0x16525),_0x16525;}),console[_0x21cf87(0x20b)](_0x21cf87(0x1de),_0x1a683a),_0x1a683a['forEach']((_0x118269,_0x2d4024)=>{const _0xb999fc=_0x21cf87;try{new URL(_0x118269),console[_0xb999fc(0x20b)]('‚úÖ\x20URL\x20'+(_0x2d4024+0x1)+_0xb999fc(0x1c9)+_0x118269);}catch(_0x1076ac){console[_0xb999fc(0x1ff)](_0xb999fc(0x1c1)+(_0x2d4024+0x1)+_0xb999fc(0x20f)+_0x118269,_0x1076ac);}});}catch(_0x46292c){console[_0x21cf87(0x1ff)](_0x21cf87(0x1f0),_0x46292c),console['error'](_0x21cf87(0x1f5),_0x595a07[_0x21cf87(0x1dc)]),_0x1a683a=undefined;}return{'paymentId':_0x595a07[_0x21cf87(0x1d8)]||'','status':_0x322027,'amount':_0x595a07['amount'],'currency':_0x595a07[_0x21cf87(0x1da)],'txUrls':_0x1a683a};}}exports[a43_0x21e060(0x1f6)]=PlisioService;