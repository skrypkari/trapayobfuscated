'use strict';const a44_0x48b23a=a44_0x4a2f;function a44_0x4a2f(_0x2d1d75,_0x2e794c){const _0x2c50cc=a44_0x2c50();return a44_0x4a2f=function(_0x4a2fb3,_0x1b88c5){_0x4a2fb3=_0x4a2fb3-0x66;let _0x2a2d44=_0x2c50cc[_0x4a2fb3];return _0x2a2d44;},a44_0x4a2f(_0x2d1d75,_0x2e794c);}function a44_0x2c50(){const _0x3ad2e2=['112670jbPzzC','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Raw\x20Response\x20Body:','HIDDEN','new','Unknown\x20error\x20from\x20Plisio\x20API','name','‚úÖ\x20Processed\x20tx_urls:','loggerService','PENDING','14463xQsYoT','parse','email','now','logWhiteDomainError','../loggerService','6aNMpZF','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','stack','plisio_direct','warn','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','URL:','Business\x20Error:\x20','Error\x20stack:','Source\x20Currency:','3170TsdJMJ','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','entries','Parsed\x20Result:','append','map','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','qr_url','currency','createPayment','invoice_url','Unknown\x20error','application/json','fromEntries','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','(fiat\x20for\x20merchant)','cancelled','https://api.plisio.net/api/v1/invoices/new','Response\x20Time:','GET','expired','logWhiteDomainResponse','TesSoft\x20Payment\x20System/1.0','txn_id','error','Error\x20Message:','json','Plisio\x20API\x20key\x20is\x20not\x20configured','Parameters:','data','toString','apiKey','PlisioService','1479095xwMuka','‚úÖ\x20URL\x20','forEach','status','Target\x20Currency:','https://apitest.trapay.uk/api/webhooks/gateway/plisio','EXPIRED','üîó\x20Formatted\x20URL:\x20','Status\x20Text:','/invoices/new','Plisio\x20API\x20error:\x20','/operations/','apiUrl','Error\x20details:','Processing\x20Plisio\x20webhook:','18XVfWWC','source_amount','‚ùå\x20URL\x20','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===',',\x20body:\x20','6661490KgbWCQ','119016vfLEPo','HTTP\x20error!\x20status:\x20','Transaction\x20ID:','pending','__esModule','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Full\x20URL\x20(without\x20API\x20key):','https://api.plisio.net/api/v1/operations/','1004716FNfohI','Invoice\x20URL:','completed','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','success','103852UHCHBj','qr_code','text','Response\x20data:','string','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Response\x20Body:','toLowerCase','amount','tx_urls','message','HTTP\x20','source_currency','Failed\x20to\x20parse\x20JSON\x20response:','log','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','===\x20PLISIO\x20SUCCESS\x20===','processWebhook','(crypto\x20for\x20payment)','defineProperty','\x20is\x20valid:\x20','replace','16zdaRww','logWhiteDomainRequest','env'];a44_0x2c50=function(){return _0x3ad2e2;};return a44_0x2c50();}(function(_0x506011,_0x4ade19){const _0x40758d=a44_0x4a2f,_0x4f2856=_0x506011();while(!![]){try{const _0x216aec=-parseInt(_0x40758d(0x8f))/0x1+-parseInt(_0x40758d(0x67))/0x2*(-parseInt(_0x40758d(0xda))/0x3)+parseInt(_0x40758d(0x6f))/0x4+-parseInt(_0x40758d(0xcb))/0x5*(parseInt(_0x40758d(0x9f))/0x6)+parseInt(_0x40758d(0x75))/0x7*(-parseInt(_0x40758d(0x8c))/0x8)+-parseInt(_0x40758d(0x99))/0x9*(parseInt(_0x40758d(0xaa))/0xa)+parseInt(_0x40758d(0x66))/0xb;if(_0x216aec===_0x4ade19)break;else _0x4f2856['push'](_0x4f2856['shift']());}catch(_0x4b6738){_0x4f2856['push'](_0x4f2856['shift']());}}}(a44_0x2c50,0x40ffd));Object[a44_0x48b23a(0x89)](exports,a44_0x48b23a(0x6b),{'value':!![]}),exports[a44_0x48b23a(0xca)]=void 0x0;const loggerService_1=require(a44_0x48b23a(0x9e));class PlisioService{constructor(){const _0x45dcbb=a44_0x48b23a;this['apiUrl']=_0x45dcbb(0xbb),this['apiKey']=process[_0x45dcbb(0x8e)]['PLISIO_API_KEY']||'',!this[_0x45dcbb(0xc9)]?console[_0x45dcbb(0xa4)]('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x45dcbb(0x84)](_0x45dcbb(0xa0));}async[a44_0x48b23a(0xb3)](_0x2544d7){const _0x277f8e=a44_0x48b23a,{orderId:_0x46e026,amount:_0x4f8fc0,currency:_0x5db3b4,productName:_0x1e4acc,description:_0x235a59,successUrl:_0x5e7900,failUrl:_0x280168,customerEmail:_0xbd918b,customerName:_0x299e49,isSourceCurrency:_0x45b87a,sourceCurrency:_0x348505}=_0x2544d7;if(!this[_0x277f8e(0xc9)])throw new Error(_0x277f8e(0xc5));const _0x145dd1=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x46e026,'order_name':_0x1e4acc,'description':_0x235a59,'success_url':_0x5e7900,'fail_url':_0x280168,'callback_url':_0x277f8e(0xd0)});_0x348505?(_0x145dd1[_0x277f8e(0xae)](_0x277f8e(0xb2),_0x348505),_0x145dd1[_0x277f8e(0xae)](_0x277f8e(0x82),_0x5db3b4),_0x145dd1['append'](_0x277f8e(0xdb),_0x4f8fc0['toString']())):(_0x145dd1[_0x277f8e(0xae)]('currency',_0x5db3b4),_0x145dd1[_0x277f8e(0xae)](_0x277f8e(0x7e),_0x4f8fc0[_0x277f8e(0xc8)]()));_0xbd918b&&_0x145dd1[_0x277f8e(0xae)](_0x277f8e(0x9b),_0xbd918b);_0x299e49&&_0x145dd1[_0x277f8e(0xae)](_0x277f8e(0x95),_0x299e49);const _0x4a006b=this[_0x277f8e(0xd7)]+'?'+_0x145dd1[_0x277f8e(0xc8)](),_0x4a4af9=Date[_0x277f8e(0x9c)]();try{console[_0x277f8e(0x84)](_0x277f8e(0xab)),console[_0x277f8e(0x84)](_0x277f8e(0xa6),this[_0x277f8e(0xd7)]),console[_0x277f8e(0x84)](_0x277f8e(0xc6),Object[_0x277f8e(0xb7)](_0x145dd1[_0x277f8e(0xac)]())),console['log'](_0x277f8e(0x6d),_0x4a006b[_0x277f8e(0x8b)](this['apiKey'],_0x277f8e(0x92))),loggerService_1[_0x277f8e(0x97)]['logWhiteDomainRequest'](_0x277f8e(0xa3),_0x277f8e(0xd4),'GET',Object[_0x277f8e(0xb7)](_0x145dd1[_0x277f8e(0xac)]()));const _0x349851=await fetch(_0x4a006b,{'method':'GET','headers':{'Accept':'application/json','User-Agent':_0x277f8e(0xc0)}}),_0x7f52b1=Date[_0x277f8e(0x9c)]()-_0x4a4af9;console[_0x277f8e(0x84)](_0x277f8e(0xdd)),console[_0x277f8e(0x84)]('Status:',_0x349851['status']),console['log'](_0x277f8e(0xd3),_0x349851['statusText']),console[_0x277f8e(0x84)](_0x277f8e(0xbc),_0x7f52b1+'ms');const _0x35446c=await _0x349851[_0x277f8e(0x77)]();console[_0x277f8e(0x84)](_0x277f8e(0x91),_0x35446c);if(!_0x349851['ok']){console[_0x277f8e(0xc2)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x277f8e(0xc2)]('HTTP\x20Status:',_0x349851[_0x277f8e(0xce)]),console[_0x277f8e(0xc2)](_0x277f8e(0x7c),_0x35446c),loggerService_1[_0x277f8e(0x97)][_0x277f8e(0xbf)](_0x277f8e(0xa3),_0x277f8e(0xd4),_0x349851[_0x277f8e(0xce)],_0x35446c,_0x7f52b1),loggerService_1[_0x277f8e(0x97)][_0x277f8e(0x9d)](_0x277f8e(0xa3),'/invoices/new',_0x277f8e(0x81)+_0x349851['status']+':\x20'+_0x35446c);throw new Error('HTTP\x20error!\x20status:\x20'+_0x349851[_0x277f8e(0xce)]+_0x277f8e(0xde)+_0x35446c);}let _0x17ec8b;try{_0x17ec8b=JSON[_0x277f8e(0x9a)](_0x35446c);}catch(_0x349663){console[_0x277f8e(0xc2)](_0x277f8e(0x83),_0x349663),loggerService_1[_0x277f8e(0x97)]['logWhiteDomainError'](_0x277f8e(0xa3),_0x277f8e(0xd4),'JSON\x20Parse\x20Error:\x20'+_0x349663);throw new Error(_0x277f8e(0x72)+_0x35446c);}console[_0x277f8e(0x84)](_0x277f8e(0x73)),console[_0x277f8e(0x84)](_0x277f8e(0xad),JSON['stringify'](_0x17ec8b,null,0x2)),loggerService_1[_0x277f8e(0x97)][_0x277f8e(0xbf)]('plisio_direct','/invoices/new',_0x349851[_0x277f8e(0xce)],_0x17ec8b,_0x7f52b1);if(_0x17ec8b[_0x277f8e(0xce)]!==_0x277f8e(0x74)){const _0x5a4864=_0x17ec8b[_0x277f8e(0x80)]||_0x17ec8b[_0x277f8e(0xc2)]||_0x277f8e(0x94);console[_0x277f8e(0xc2)](_0x277f8e(0x90)),console[_0x277f8e(0xc2)](_0x277f8e(0xc3),_0x5a4864),loggerService_1[_0x277f8e(0x97)][_0x277f8e(0x9d)](_0x277f8e(0xa3),_0x277f8e(0xd4),_0x277f8e(0xa7)+_0x5a4864);throw new Error('Plisio\x20API\x20error:\x20'+_0x5a4864);}if(!_0x17ec8b[_0x277f8e(0xc7)]?.[_0x277f8e(0xc1)]||!_0x17ec8b[_0x277f8e(0xc7)]?.[_0x277f8e(0xb4)]){console['error'](_0x277f8e(0xb8)),console[_0x277f8e(0xc2)](_0x277f8e(0xa1)),console['error'](_0x277f8e(0x78),_0x17ec8b['data']),loggerService_1[_0x277f8e(0x97)]['logWhiteDomainError'](_0x277f8e(0xa3),_0x277f8e(0xd4),_0x277f8e(0x7b));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x277f8e(0x84)](_0x277f8e(0x86)),console[_0x277f8e(0x84)](_0x277f8e(0x69),_0x17ec8b[_0x277f8e(0xc7)]['txn_id']),console[_0x277f8e(0x84)](_0x277f8e(0x70),_0x17ec8b[_0x277f8e(0xc7)][_0x277f8e(0xb4)]),console['log']('Amount:',_0x4f8fc0,_0x5db3b4),_0x348505&&(console['log'](_0x277f8e(0xa9),_0x348505,_0x277f8e(0x88)),console[_0x277f8e(0x84)](_0x277f8e(0xcf),_0x5db3b4,_0x277f8e(0xb9))),{'gateway_payment_id':_0x17ec8b['data'][_0x277f8e(0xc1)],'payment_url':_0x17ec8b['data'][_0x277f8e(0xb4)],'invoice_total_sum':_0x17ec8b[_0x277f8e(0xc7)]['invoice_total_sum'],'qr_code':_0x17ec8b[_0x277f8e(0xc7)][_0x277f8e(0x76)],'qr_url':_0x17ec8b['data'][_0x277f8e(0xb1)]};}catch(_0x1205cc){console[_0x277f8e(0xc2)](_0x277f8e(0x85)),console[_0x277f8e(0xc2)](_0x277f8e(0xd8),_0x1205cc),loggerService_1[_0x277f8e(0x97)][_0x277f8e(0x9d)](_0x277f8e(0xa3),_0x277f8e(0xd4),_0x1205cc);if(_0x1205cc instanceof Error){console['error']('Error\x20message:',_0x1205cc[_0x277f8e(0x80)]),console['error'](_0x277f8e(0xa8),_0x1205cc[_0x277f8e(0xa2)]);throw new Error(_0x277f8e(0x6c)+_0x1205cc[_0x277f8e(0x80)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async['verifyPayment'](_0x21c6e1){const _0x56445a=a44_0x48b23a,_0x57122e=Date[_0x56445a(0x9c)]();try{if(!this[_0x56445a(0xc9)])throw new Error(_0x56445a(0xc5));const _0xefaf16=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x21c6e1}),_0x867fbe=_0x56445a(0x6e)+_0x21c6e1+'?'+_0xefaf16[_0x56445a(0xc8)]();loggerService_1[_0x56445a(0x97)][_0x56445a(0x8d)](_0x56445a(0xa3),_0x56445a(0xd6)+_0x21c6e1,_0x56445a(0xbd),Object[_0x56445a(0xb7)](_0xefaf16[_0x56445a(0xac)]()));const _0x4a4c67=await fetch(_0x867fbe,{'method':_0x56445a(0xbd),'headers':{'Accept':_0x56445a(0xb6),'User-Agent':_0x56445a(0xc0)}}),_0xaec549=Date[_0x56445a(0x9c)]()-_0x57122e;if(!_0x4a4c67['ok']){const _0x5a9001=await _0x4a4c67[_0x56445a(0x77)]();loggerService_1[_0x56445a(0x97)][_0x56445a(0xbf)](_0x56445a(0xa3),_0x56445a(0xd6)+_0x21c6e1,_0x4a4c67[_0x56445a(0xce)],_0x5a9001,_0xaec549);throw new Error(_0x56445a(0x68)+_0x4a4c67['status']);}const _0xe0cb61=await _0x4a4c67[_0x56445a(0xc4)]();loggerService_1[_0x56445a(0x97)]['logWhiteDomainResponse'](_0x56445a(0xa3),_0x56445a(0xd6)+_0x21c6e1,_0x4a4c67['status'],_0xe0cb61,_0xaec549);if(_0xe0cb61['status']!==_0x56445a(0x74)){loggerService_1[_0x56445a(0x97)][_0x56445a(0x9d)](_0x56445a(0xa3),_0x56445a(0xd6)+_0x21c6e1,_0x56445a(0xd5)+(_0xe0cb61['message']||_0xe0cb61[_0x56445a(0xc2)]||_0x56445a(0xb5)));throw new Error(_0x56445a(0xd5)+(_0xe0cb61[_0x56445a(0x80)]||_0xe0cb61[_0x56445a(0xc2)]||'Unknown\x20error'));}let _0x8a5e57='PENDING';return{'status':_0x8a5e57};}catch(_0x25a66d){console[_0x56445a(0xc2)]('Plisio\x20payment\x20verification\x20error:',_0x25a66d),loggerService_1[_0x56445a(0x97)][_0x56445a(0x9d)]('plisio_direct','/operations/'+_0x21c6e1,_0x25a66d);throw new Error(_0x56445a(0xa5)+(_0x25a66d instanceof Error?_0x25a66d[_0x56445a(0x80)]:_0x56445a(0xb5)));}}async[a44_0x48b23a(0x87)](_0x5f032b){const _0x29f4d5=a44_0x48b23a;console[_0x29f4d5(0x84)](_0x29f4d5(0xd9),_0x5f032b);let _0x495c13=_0x29f4d5(0x98);switch(_0x5f032b[_0x29f4d5(0xce)]?.[_0x29f4d5(0x7d)]()){case _0x29f4d5(0x71):case'mismatch':_0x495c13='PAID';break;case _0x29f4d5(0xbe):_0x495c13=_0x29f4d5(0xd1);break;case'error':case _0x29f4d5(0xba):_0x495c13='FAILED';break;case _0x29f4d5(0x93):case _0x29f4d5(0x6a):default:_0x495c13=_0x29f4d5(0x98);break;}let _0x3b9c99;if(_0x5f032b['tx_urls'])try{console[_0x29f4d5(0x84)](_0x29f4d5(0xb0),_0x5f032b['tx_urls']);let _0x342706;if(typeof _0x5f032b[_0x29f4d5(0x7f)]===_0x29f4d5(0x79))_0x342706=JSON[_0x29f4d5(0x9a)](_0x5f032b[_0x29f4d5(0x7f)]);else Array['isArray'](_0x5f032b[_0x29f4d5(0x7f)])?_0x342706=_0x5f032b[_0x29f4d5(0x7f)]:_0x342706=[];_0x3b9c99=_0x342706[_0x29f4d5(0xaf)](_0x2f2ce4=>{const _0x2f7aab=_0x29f4d5,_0x494789=_0x2f2ce4[_0x2f7aab(0x8b)](/\\/g,'');return console[_0x2f7aab(0x84)](_0x2f7aab(0xd2)+_0x2f2ce4+'\x20->\x20'+_0x494789),_0x494789;}),console['log'](_0x29f4d5(0x96),_0x3b9c99),_0x3b9c99[_0x29f4d5(0xcd)]((_0xfb479e,_0x18cfc0)=>{const _0x154693=_0x29f4d5;try{new URL(_0xfb479e),console[_0x154693(0x84)](_0x154693(0xcc)+(_0x18cfc0+0x1)+_0x154693(0x8a)+_0xfb479e);}catch(_0x2e196e){console[_0x154693(0xc2)](_0x154693(0xdc)+(_0x18cfc0+0x1)+'\x20is\x20invalid:\x20'+_0xfb479e,_0x2e196e);}});}catch(_0x40e773){console[_0x29f4d5(0xc2)](_0x29f4d5(0x7a),_0x40e773),console[_0x29f4d5(0xc2)]('Raw\x20tx_urls\x20data:',_0x5f032b[_0x29f4d5(0x7f)]),_0x3b9c99=undefined;}return{'paymentId':_0x5f032b['order_number']||'','status':_0x495c13,'amount':_0x5f032b[_0x29f4d5(0x7e)],'currency':_0x5f032b[_0x29f4d5(0xb2)],'txUrls':_0x3b9c99};}}exports['PlisioService']=PlisioService;