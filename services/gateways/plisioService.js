'use strict';function a49_0x5342(){const _0x4eff74=['name','Status:','Source\x20Currency:','Response\x20data:','invoice_url','../loggerService','PLISIO_API_KEY','/invoices/new','createPayment','FAILED','3757275HOWJDS','Error\x20Message:','toString','Invoice\x20URL:','logWhiteDomainResponse','apiKey','pending','toLowerCase','90066EmJipI','env','status','Plisio\x20API\x20error:\x20','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','source_amount','170UpFrDI','Unknown\x20error\x20from\x20Plisio\x20API','JSON\x20Parse\x20Error:\x20','\x20is\x20valid:\x20','/operations/','json','2452278RKcdIu','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','currency','Unknown\x20error','Processing\x20Plisio\x20webhook:','now','HTTP\x20error!\x20status:\x20','string','===\x20PLISIO\x20API\x20ERROR\x20===','loggerService','tx_urls','Target\x20Currency:','\x20->\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','apiUrl','Error\x20stack:','append','defineProperty','Full\x20URL\x20(without\x20API\x20key):','1252803jCWsif','log','error','7104936LAiIHX','message','processWebhook','email','GET','‚úÖ\x20Processed\x20tx_urls:','üîó\x20Formatted\x20URL:\x20','txn_id','fromEntries','parse','__esModule','plisio_direct','cancelled','(crypto\x20for\x20payment)','completed','PlisioService','PAID','Parameters:','https://api.trapay.uk/api/webhooks/gateway/plisio','application/json','logWhiteDomainRequest','Error\x20message:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','order_number','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','qr_code','map','EXPIRED','expired','entries','HTTP\x20','Parsed\x20Result:','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','isArray','invoice_total_sum','replace','stringify','Amount:','mismatch','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','60vhJmQT','160144BWVqUn','Business\x20Error:\x20','logWhiteDomainError','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','===\x20PLISIO\x20SUCCESS\x20===','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','forEach','new','321461rXTvuX','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PENDING','text','TesSoft\x20Payment\x20System/1.0','10ENPgSi','qr_url',',\x20body:\x20','Transaction\x20ID:','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Status\x20Text:','Response\x20Body:','data','Plisio\x20payment\x20verification\x20error:'];a49_0x5342=function(){return _0x4eff74;};return a49_0x5342();}const a49_0xd0ff4f=a49_0x88a1;(function(_0x442419,_0x1910ed){const _0x480e6a=a49_0x88a1,_0x34bbf0=_0x442419();while(!![]){try{const _0x4a3dac=parseInt(_0x480e6a(0xdc))/0x1+parseInt(_0x480e6a(0xc9))/0x2+parseInt(_0x480e6a(0x107))/0x3*(-parseInt(_0x480e6a(0x108))/0x4)+parseInt(_0x480e6a(0xc3))/0x5*(-parseInt(_0x480e6a(0x130))/0x6)+-parseInt(_0x480e6a(0x110))/0x7+-parseInt(_0x480e6a(0xdf))/0x8+parseInt(_0x480e6a(0x128))/0x9*(parseInt(_0x480e6a(0x115))/0xa);if(_0x4a3dac===_0x1910ed)break;else _0x34bbf0['push'](_0x34bbf0['shift']());}catch(_0x189748){_0x34bbf0['push'](_0x34bbf0['shift']());}}}(a49_0x5342,0x9f013));Object[a49_0xd0ff4f(0xda)](exports,a49_0xd0ff4f(0xe9),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a49_0xd0ff4f(0x123));class PlisioService{constructor(){const _0x221ac7=a49_0xd0ff4f;this[_0x221ac7(0xd7)]='https://api.plisio.net/api/v1/invoices/new',this[_0x221ac7(0x12d)]=process[_0x221ac7(0x131)][_0x221ac7(0x124)]||'',!this[_0x221ac7(0x12d)]?console['warn']('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x221ac7(0xdd)](_0x221ac7(0x10d));}async[a49_0xd0ff4f(0x126)](_0x3ebfc3){const _0x3f40bb=a49_0xd0ff4f,{orderId:_0x31e4ff,amount:_0x31ae5a,currency:_0x27443f,productName:_0x132f53,description:_0x2ef686,successUrl:_0x1819c7,failUrl:_0x3ea883,customerEmail:_0x3719dd,customerName:_0x3c95d3,isSourceCurrency:_0x1aef75,sourceCurrency:_0x2f2b82}=_0x3ebfc3;if(!this[_0x3f40bb(0x12d)])throw new Error(_0x3f40bb(0xd6));const _0x30b543=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x31e4ff,'order_name':_0x132f53,'description':_0x2ef686,'success_url':_0x1819c7,'fail_url':_0x3ea883,'callback_url':_0x3f40bb(0xf1)});_0x2f2b82?(_0x30b543[_0x3f40bb(0xd9)]('currency',_0x2f2b82),_0x30b543[_0x3f40bb(0xd9)]('source_currency',_0x27443f),_0x30b543[_0x3f40bb(0xd9)](_0x3f40bb(0xc2),_0x31ae5a[_0x3f40bb(0x12a)]())):(_0x30b543[_0x3f40bb(0xd9)](_0x3f40bb(0xcb),_0x27443f),_0x30b543[_0x3f40bb(0xd9)]('amount',_0x31ae5a[_0x3f40bb(0x12a)]()));_0x3719dd&&_0x30b543[_0x3f40bb(0xd9)](_0x3f40bb(0xe2),_0x3719dd);_0x3c95d3&&_0x30b543[_0x3f40bb(0xd9)](_0x3f40bb(0x11e),_0x3c95d3);const _0x1e78c7=this[_0x3f40bb(0xd7)]+'?'+_0x30b543[_0x3f40bb(0x12a)](),_0x584bd9=Date['now']();try{console[_0x3f40bb(0xdd)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x3f40bb(0xdd)]('URL:',this[_0x3f40bb(0xd7)]),console[_0x3f40bb(0xdd)](_0x3f40bb(0xf0),Object[_0x3f40bb(0xe7)](_0x30b543[_0x3f40bb(0xfc)]())),console['log'](_0x3f40bb(0xdb),_0x1e78c7['replace'](this[_0x3f40bb(0x12d)],'HIDDEN')),loggerService_1[_0x3f40bb(0xd2)]['logWhiteDomainRequest']('plisio_direct',_0x3f40bb(0x125),_0x3f40bb(0xe3),Object[_0x3f40bb(0xe7)](_0x30b543[_0x3f40bb(0xfc)]()));const _0x27ea6c=await fetch(_0x1e78c7,{'method':_0x3f40bb(0xe3),'headers':{'Accept':_0x3f40bb(0xf2),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x194b34=Date[_0x3f40bb(0xce)]()-_0x584bd9;console['log']('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x3f40bb(0xdd)](_0x3f40bb(0x11f),_0x27ea6c[_0x3f40bb(0x132)]),console[_0x3f40bb(0xdd)](_0x3f40bb(0x11a),_0x27ea6c['statusText']),console[_0x3f40bb(0xdd)]('Response\x20Time:',_0x194b34+'ms');const _0xf495f5=await _0x27ea6c['text']();console[_0x3f40bb(0xdd)]('Raw\x20Response\x20Body:',_0xf495f5);if(!_0x27ea6c['ok']){console[_0x3f40bb(0xde)](_0x3f40bb(0xd1)),console[_0x3f40bb(0xde)]('HTTP\x20Status:',_0x27ea6c[_0x3f40bb(0x132)]),console['error'](_0x3f40bb(0x11b),_0xf495f5),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3f40bb(0xea),_0x3f40bb(0x125),_0x27ea6c['status'],_0xf495f5,_0x194b34),loggerService_1['loggerService'][_0x3f40bb(0x10a)](_0x3f40bb(0xea),_0x3f40bb(0x125),_0x3f40bb(0xfd)+_0x27ea6c['status']+':\x20'+_0xf495f5);throw new Error(_0x3f40bb(0xcf)+_0x27ea6c[_0x3f40bb(0x132)]+_0x3f40bb(0x117)+_0xf495f5);}let _0x935c8b;try{_0x935c8b=JSON[_0x3f40bb(0xe8)](_0xf495f5);}catch(_0x324e33){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x324e33),loggerService_1['loggerService'][_0x3f40bb(0x10a)]('plisio_direct',_0x3f40bb(0x125),_0x3f40bb(0xc5)+_0x324e33);throw new Error(_0x3f40bb(0xc1)+_0xf495f5);}console[_0x3f40bb(0xdd)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x3f40bb(0xdd)](_0x3f40bb(0xfe),JSON[_0x3f40bb(0x103)](_0x935c8b,null,0x2)),loggerService_1[_0x3f40bb(0xd2)][_0x3f40bb(0x12c)]('plisio_direct',_0x3f40bb(0x125),_0x27ea6c['status'],_0x935c8b,_0x194b34);if(_0x935c8b[_0x3f40bb(0x132)]!=='success'){const _0x4f0435=_0x935c8b[_0x3f40bb(0xe0)]||_0x935c8b[_0x3f40bb(0xde)]||_0x3f40bb(0xc4);console['error'](_0x3f40bb(0xca)),console['error'](_0x3f40bb(0x129),_0x4f0435),loggerService_1[_0x3f40bb(0xd2)][_0x3f40bb(0x10a)](_0x3f40bb(0xea),'/invoices/new',_0x3f40bb(0x109)+_0x4f0435);throw new Error(_0x3f40bb(0x133)+_0x4f0435);}if(!_0x935c8b[_0x3f40bb(0x11c)]?.[_0x3f40bb(0xe6)]||!_0x935c8b[_0x3f40bb(0x11c)]?.[_0x3f40bb(0x122)]){console[_0x3f40bb(0xde)](_0x3f40bb(0x111)),console[_0x3f40bb(0xde)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console['error'](_0x3f40bb(0x121),_0x935c8b[_0x3f40bb(0x11c)]),loggerService_1[_0x3f40bb(0xd2)][_0x3f40bb(0x10a)](_0x3f40bb(0xea),_0x3f40bb(0x125),_0x3f40bb(0xf5));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x3f40bb(0xdd)](_0x3f40bb(0x10c)),console[_0x3f40bb(0xdd)](_0x3f40bb(0x118),_0x935c8b[_0x3f40bb(0x11c)]['txn_id']),console[_0x3f40bb(0xdd)](_0x3f40bb(0x12b),_0x935c8b['data'][_0x3f40bb(0x122)]),console['log'](_0x3f40bb(0x104),_0x31ae5a,_0x27443f),_0x2f2b82&&(console['log'](_0x3f40bb(0x120),_0x2f2b82,_0x3f40bb(0xec)),console[_0x3f40bb(0xdd)](_0x3f40bb(0xd4),_0x27443f,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x935c8b['data'][_0x3f40bb(0xe6)],'payment_url':_0x935c8b['data'][_0x3f40bb(0x122)],'invoice_total_sum':_0x935c8b[_0x3f40bb(0x11c)][_0x3f40bb(0x101)],'qr_code':_0x935c8b[_0x3f40bb(0x11c)][_0x3f40bb(0xf8)],'qr_url':_0x935c8b[_0x3f40bb(0x11c)][_0x3f40bb(0x116)]};}catch(_0x27f739){console[_0x3f40bb(0xde)](_0x3f40bb(0x10b)),console[_0x3f40bb(0xde)]('Error\x20details:',_0x27f739),loggerService_1['loggerService'][_0x3f40bb(0x10a)](_0x3f40bb(0xea),'/invoices/new',_0x27f739);if(_0x27f739 instanceof Error){console['error'](_0x3f40bb(0xf4),_0x27f739[_0x3f40bb(0xe0)]),console[_0x3f40bb(0xde)](_0x3f40bb(0xd8),_0x27f739['stack']);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x27f739[_0x3f40bb(0xe0)]);}throw new Error(_0x3f40bb(0xff));}}async['verifyPayment'](_0x3e2e6b){const _0x71e181=a49_0xd0ff4f,_0x15826c=Date[_0x71e181(0xce)]();try{if(!this['apiKey'])throw new Error(_0x71e181(0xd6));const _0x68fd3=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x3e2e6b}),_0x4ac5e6='https://api.plisio.net/api/v1/operations/'+_0x3e2e6b+'?'+_0x68fd3[_0x71e181(0x12a)]();loggerService_1['loggerService'][_0x71e181(0xf3)](_0x71e181(0xea),_0x71e181(0xc7)+_0x3e2e6b,_0x71e181(0xe3),Object[_0x71e181(0xe7)](_0x68fd3['entries']()));const _0xe332ab=await fetch(_0x4ac5e6,{'method':_0x71e181(0xe3),'headers':{'Accept':_0x71e181(0xf2),'User-Agent':_0x71e181(0x114)}}),_0x51d53f=Date[_0x71e181(0xce)]()-_0x15826c;if(!_0xe332ab['ok']){const _0x52d8a3=await _0xe332ab[_0x71e181(0x113)]();loggerService_1[_0x71e181(0xd2)]['logWhiteDomainResponse']('plisio_direct',_0x71e181(0xc7)+_0x3e2e6b,_0xe332ab[_0x71e181(0x132)],_0x52d8a3,_0x51d53f);throw new Error(_0x71e181(0xcf)+_0xe332ab[_0x71e181(0x132)]);}const _0x3e94ce=await _0xe332ab[_0x71e181(0xc8)]();loggerService_1[_0x71e181(0xd2)][_0x71e181(0x12c)](_0x71e181(0xea),_0x71e181(0xc7)+_0x3e2e6b,_0xe332ab[_0x71e181(0x132)],_0x3e94ce,_0x51d53f);if(_0x3e94ce[_0x71e181(0x132)]!=='success'){loggerService_1['loggerService'][_0x71e181(0x10a)](_0x71e181(0xea),_0x71e181(0xc7)+_0x3e2e6b,_0x71e181(0x133)+(_0x3e94ce[_0x71e181(0xe0)]||_0x3e94ce[_0x71e181(0xde)]||'Unknown\x20error'));throw new Error(_0x71e181(0x133)+(_0x3e94ce[_0x71e181(0xe0)]||_0x3e94ce[_0x71e181(0xde)]||'Unknown\x20error'));}let _0x49c160='PENDING';return{'status':_0x49c160};}catch(_0x592871){console[_0x71e181(0xde)](_0x71e181(0x11d),_0x592871),loggerService_1[_0x71e181(0xd2)][_0x71e181(0x10a)](_0x71e181(0xea),'/operations/'+_0x3e2e6b,_0x592871);throw new Error(_0x71e181(0x106)+(_0x592871 instanceof Error?_0x592871[_0x71e181(0xe0)]:_0x71e181(0xcc)));}}async[a49_0xd0ff4f(0xe1)](_0x1968da){const _0x175f3e=a49_0xd0ff4f;console[_0x175f3e(0xdd)](_0x175f3e(0xcd),_0x1968da);let _0x31b9d8='PENDING';switch(_0x1968da['status']?.[_0x175f3e(0x12f)]()){case _0x175f3e(0xed):case _0x175f3e(0x105):_0x31b9d8=_0x175f3e(0xef);break;case _0x175f3e(0xfb):_0x31b9d8=_0x175f3e(0xfa);break;case _0x175f3e(0xde):case _0x175f3e(0xeb):_0x31b9d8=_0x175f3e(0x127);break;case _0x175f3e(0x10f):_0x31b9d8='PENDING';break;case _0x175f3e(0x12e):_0x31b9d8='PROCESSING';break;default:_0x31b9d8=_0x175f3e(0x112);break;}let _0x15b278;if(_0x1968da[_0x175f3e(0xd3)])try{console[_0x175f3e(0xdd)](_0x175f3e(0x119),_0x1968da[_0x175f3e(0xd3)]);let _0x144b7b;if(typeof _0x1968da[_0x175f3e(0xd3)]===_0x175f3e(0xd0))_0x144b7b=JSON[_0x175f3e(0xe8)](_0x1968da['tx_urls']);else Array[_0x175f3e(0x100)](_0x1968da[_0x175f3e(0xd3)])?_0x144b7b=_0x1968da[_0x175f3e(0xd3)]:_0x144b7b=[];_0x15b278=_0x144b7b[_0x175f3e(0xf9)](_0x4fe059=>{const _0x339f3a=_0x175f3e,_0x4dedd1=_0x4fe059[_0x339f3a(0x102)](/\\/g,'');return console[_0x339f3a(0xdd)](_0x339f3a(0xe5)+_0x4fe059+_0x339f3a(0xd5)+_0x4dedd1),_0x4dedd1;}),console[_0x175f3e(0xdd)](_0x175f3e(0xe4),_0x15b278),_0x15b278[_0x175f3e(0x10e)]((_0x11a3e0,_0x236916)=>{const _0x3ed1d9=_0x175f3e;try{new URL(_0x11a3e0),console[_0x3ed1d9(0xdd)]('‚úÖ\x20URL\x20'+(_0x236916+0x1)+_0x3ed1d9(0xc6)+_0x11a3e0);}catch(_0x14a80a){console[_0x3ed1d9(0xde)]('‚ùå\x20URL\x20'+(_0x236916+0x1)+'\x20is\x20invalid:\x20'+_0x11a3e0,_0x14a80a);}});}catch(_0x3147a0){console[_0x175f3e(0xde)](_0x175f3e(0xf7),_0x3147a0),console[_0x175f3e(0xde)]('Raw\x20tx_urls\x20data:',_0x1968da[_0x175f3e(0xd3)]),_0x15b278=undefined;}return{'paymentId':_0x1968da[_0x175f3e(0xf6)]||'','status':_0x31b9d8,'amount':_0x1968da['amount'],'currency':_0x1968da[_0x175f3e(0xcb)],'txUrls':_0x15b278};}}function a49_0x88a1(_0x5029bb,_0x3e6f6f){const _0x53428b=a49_0x5342();return a49_0x88a1=function(_0x88a19e,_0x1ddba0){_0x88a19e=_0x88a19e-0xc1;let _0x3676d9=_0x53428b[_0x88a19e];return _0x3676d9;},a49_0x88a1(_0x5029bb,_0x3e6f6f);}exports[a49_0xd0ff4f(0xee)]=PlisioService;