'use strict';const a62_0x29ce84=a62_0x3042;(function(_0x5f53d0,_0x2edca2){const _0x1a76ee=a62_0x3042,_0x266fd6=_0x5f53d0();while(!![]){try{const _0x346f07=-parseInt(_0x1a76ee(0xe6))/0x1+-parseInt(_0x1a76ee(0xcc))/0x2*(parseInt(_0x1a76ee(0x91))/0x3)+-parseInt(_0x1a76ee(0xd0))/0x4+-parseInt(_0x1a76ee(0xb2))/0x5*(parseInt(_0x1a76ee(0xea))/0x6)+-parseInt(_0x1a76ee(0xcb))/0x7+-parseInt(_0x1a76ee(0xb4))/0x8*(parseInt(_0x1a76ee(0xdf))/0x9)+parseInt(_0x1a76ee(0x96))/0xa;if(_0x346f07===_0x2edca2)break;else _0x266fd6['push'](_0x266fd6['shift']());}catch(_0x2d26c9){_0x266fd6['push'](_0x266fd6['shift']());}}}(a62_0x11bb,0xc8a91));function a62_0x3042(_0x399337,_0x51aacc){_0x399337=_0x399337-0x87;const _0x11bb97=a62_0x11bb();let _0x3042f9=_0x11bb97[_0x399337];return _0x3042f9;}Object[a62_0x29ce84(0xa9)](exports,'__esModule',{'value':!![]}),exports[a62_0x29ce84(0xc9)]=void 0x0;const loggerService_1=require('../loggerService');function a62_0x11bb(){const _0x15cd32=['message','currency','PLISIO_API_KEY','JSON\x20Parse\x20Error:\x20','stack','source_currency','statusText','text','HIDDEN','153JvPFRG','error','cancelled','FAILED','‚ùå\x20URL\x20','invoice_url','EXPIRED','776968nkdoDi','https://api.plisio.net/api/v1/operations/','PENDING','Plisio\x20API\x20key\x20is\x20not\x20configured','2147352YfdLYn','apiUrl','Payment\x20System/1.0','Parameters:','Status\x20Text:','GET','logWhiteDomainError','Error\x20stack:','Plisio\x20API\x20error:\x20','===\x20PLISIO\x20API\x20ERROR\x20===','append','entries','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','application/json','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Invoice\x20URL:','qr_url','Unknown\x20error\x20from\x20Plisio\x20API','Source\x20Currency:','mismatch','email','Failed\x20to\x20create\x20Plisio\x20payment:\x20','3FSsDRB','Full\x20URL\x20(without\x20API\x20key):','loggerService','order_number','data','67244910kwmFmM','replace','Business\x20Error:\x20','tx_urls','amount','Plisio\x20payment\x20verification\x20error:','verifyPayment','invoice_total_sum','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Raw\x20Response\x20Body:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','HTTP\x20Status:','warn','stringify','new','pending','Unknown\x20error','source_amount','Error\x20message:','defineProperty','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','/invoices/new',',\x20body:\x20','Transaction\x20ID:','name','‚úÖ\x20URL\x20','json','HTTP\x20error!\x20status:\x20','5lXTRco','now','596856KlcBqR','fromEntries','env','logWhiteDomainResponse','plisio_direct','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','/operations/','===\x20PLISIO\x20SUCCESS\x20===','status','log','Response\x20Body:','Error\x20details:','(crypto\x20for\x20payment)','processWebhook','parse','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','logWhiteDomainRequest','createPayment','Processing\x20Plisio\x20webhook:','toString','txn_id','PlisioService','apiKey','4683301KaLtRL','2462828pXGBTn','Error\x20Message:','\x20is\x20valid:\x20','Amount:','6395800wfdqYo','Status:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','PROCESSING','Failed\x20to\x20parse\x20JSON\x20response:','map'];a62_0x11bb=function(){return _0x15cd32;};return a62_0x11bb();}class PlisioService{constructor(){const _0x2a925f=a62_0x29ce84;this[_0x2a925f(0xeb)]='https://api.plisio.net/api/v1/invoices/new',this[_0x2a925f(0xca)]=process[_0x2a925f(0xb6)][_0x2a925f(0xd8)]||'',!this[_0x2a925f(0xca)]?console[_0x2a925f(0xa2)](_0x2a925f(0xc3)):console[_0x2a925f(0xbd)](_0x2a925f(0x89));}async[a62_0x29ce84(0xc5)](_0x4e6147){const _0x579121=a62_0x29ce84,{orderId:_0x252916,amount:_0x1c20db,currency:_0x18ea71,productName:_0x57e03f,description:_0x5e39f8,successUrl:_0x19d0b0,failUrl:_0x39f75c,customerEmail:_0x368a1e,customerName:_0x243488,isSourceCurrency:_0x167a24,sourceCurrency:_0x4e22f6}=_0x4e6147;if(!this['apiKey'])throw new Error(_0x579121(0xe9));const _0x2cb482=new URLSearchParams({'api_key':this[_0x579121(0xca)],'order_number':_0x252916,'order_name':_0x57e03f,'description':_0x5e39f8,'success_url':_0x19d0b0,'fail_url':_0x39f75c,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x4e22f6?(_0x2cb482['append'](_0x579121(0xd7),_0x4e22f6),_0x2cb482['append'](_0x579121(0xdb),_0x18ea71),_0x2cb482[_0x579121(0xf4)](_0x579121(0xa7),_0x1c20db['toString']())):(_0x2cb482[_0x579121(0xf4)](_0x579121(0xd7),_0x18ea71),_0x2cb482[_0x579121(0xf4)](_0x579121(0x9a),_0x1c20db['toString']()));_0x368a1e&&_0x2cb482[_0x579121(0xf4)](_0x579121(0x8f),_0x368a1e);_0x243488&&_0x2cb482[_0x579121(0xf4)](_0x579121(0xae),_0x243488);const _0x1faccd=this[_0x579121(0xeb)]+'?'+_0x2cb482[_0x579121(0xc7)](),_0x1b7b0d=Date[_0x579121(0xb3)]();try{console[_0x579121(0xbd)](_0x579121(0xa0)),console[_0x579121(0xbd)]('URL:',this[_0x579121(0xeb)]),console[_0x579121(0xbd)](_0x579121(0xed),Object[_0x579121(0xb5)](_0x2cb482[_0x579121(0xf5)]())),console[_0x579121(0xbd)](_0x579121(0x92),_0x1faccd[_0x579121(0x97)](this[_0x579121(0xca)],_0x579121(0xde))),loggerService_1[_0x579121(0x93)][_0x579121(0xc4)]('plisio_direct','/invoices/new','GET',Object[_0x579121(0xb5)](_0x2cb482[_0x579121(0xf5)]()));const _0x3b698f=await fetch(_0x1faccd,{'method':_0x579121(0xef),'headers':{'Accept':_0x579121(0x88),'User-Agent':_0x579121(0xec)}}),_0x539806=Date['now']()-_0x1b7b0d;console[_0x579121(0xbd)](_0x579121(0xd2)),console['log'](_0x579121(0xd1),_0x3b698f[_0x579121(0xbc)]),console[_0x579121(0xbd)](_0x579121(0xee),_0x3b698f[_0x579121(0xdc)]),console[_0x579121(0xbd)]('Response\x20Time:',_0x539806+'ms');const _0x113732=await _0x3b698f[_0x579121(0xdd)]();console[_0x579121(0xbd)](_0x579121(0x9f),_0x113732);if(!_0x3b698f['ok']){console[_0x579121(0xe0)](_0x579121(0xf3)),console[_0x579121(0xe0)](_0x579121(0xa1),_0x3b698f[_0x579121(0xbc)]),console[_0x579121(0xe0)](_0x579121(0xbe),_0x113732),loggerService_1[_0x579121(0x93)][_0x579121(0xb7)]('plisio_direct','/invoices/new',_0x3b698f[_0x579121(0xbc)],_0x113732,_0x539806),loggerService_1['loggerService'][_0x579121(0xf0)](_0x579121(0xb8),_0x579121(0xab),'HTTP\x20'+_0x3b698f[_0x579121(0xbc)]+':\x20'+_0x113732);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3b698f[_0x579121(0xbc)]+_0x579121(0xac)+_0x113732);}let _0x321089;try{_0x321089=JSON[_0x579121(0xc2)](_0x113732);}catch(_0x112361){console[_0x579121(0xe0)](_0x579121(0xd4),_0x112361),loggerService_1[_0x579121(0x93)][_0x579121(0xf0)](_0x579121(0xb8),_0x579121(0xab),_0x579121(0xd9)+_0x112361);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x113732);}console[_0x579121(0xbd)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x579121(0xbd)]('Parsed\x20Result:',JSON[_0x579121(0xa3)](_0x321089,null,0x2)),loggerService_1[_0x579121(0x93)][_0x579121(0xb7)](_0x579121(0xb8),_0x579121(0xab),_0x3b698f[_0x579121(0xbc)],_0x321089,_0x539806);if(_0x321089['status']!=='success'){const _0x20310c=_0x321089[_0x579121(0xd6)]||_0x321089[_0x579121(0xe0)]||_0x579121(0x8c);console[_0x579121(0xe0)](_0x579121(0x87)),console['error'](_0x579121(0xcd),_0x20310c),loggerService_1[_0x579121(0x93)][_0x579121(0xf0)](_0x579121(0xb8),'/invoices/new',_0x579121(0x98)+_0x20310c);throw new Error(_0x579121(0xf2)+_0x20310c);}if(!_0x321089[_0x579121(0x95)]?.[_0x579121(0xc8)]||!_0x321089[_0x579121(0x95)]?.[_0x579121(0xe4)]){console[_0x579121(0xe0)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x579121(0xe0)](_0x579121(0xaa)),console[_0x579121(0xe0)]('Response\x20data:',_0x321089['data']),loggerService_1[_0x579121(0x93)][_0x579121(0xf0)](_0x579121(0xb8),'/invoices/new','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x579121(0x9e));}return console[_0x579121(0xbd)](_0x579121(0xbb)),console['log'](_0x579121(0xad),_0x321089['data'][_0x579121(0xc8)]),console['log'](_0x579121(0x8a),_0x321089['data']['invoice_url']),console['log'](_0x579121(0xcf),_0x1c20db,_0x18ea71),_0x4e22f6&&(console['log'](_0x579121(0x8d),_0x4e22f6,_0x579121(0xc0)),console['log']('Target\x20Currency:',_0x18ea71,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x321089['data'][_0x579121(0xc8)],'payment_url':_0x321089[_0x579121(0x95)]['invoice_url'],'invoice_total_sum':_0x321089[_0x579121(0x95)][_0x579121(0x9d)],'qr_code':_0x321089['data']['qr_code'],'qr_url':_0x321089['data'][_0x579121(0x8b)]};}catch(_0x1a29c7){console[_0x579121(0xe0)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x579121(0xe0)](_0x579121(0xbf),_0x1a29c7),loggerService_1[_0x579121(0x93)][_0x579121(0xf0)](_0x579121(0xb8),_0x579121(0xab),_0x1a29c7);if(_0x1a29c7 instanceof Error){console[_0x579121(0xe0)](_0x579121(0xa8),_0x1a29c7[_0x579121(0xd6)]),console['error'](_0x579121(0xf1),_0x1a29c7[_0x579121(0xda)]);throw new Error(_0x579121(0x90)+_0x1a29c7[_0x579121(0xd6)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a62_0x29ce84(0x9c)](_0x201481){const _0x21601b=a62_0x29ce84,_0x8a1a04=Date[_0x21601b(0xb3)]();try{if(!this[_0x21601b(0xca)])throw new Error(_0x21601b(0xe9));const _0x37f9cb=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x201481}),_0x1c3bdb=_0x21601b(0xe7)+_0x201481+'?'+_0x37f9cb[_0x21601b(0xc7)]();loggerService_1['loggerService'][_0x21601b(0xc4)](_0x21601b(0xb8),_0x21601b(0xba)+_0x201481,_0x21601b(0xef),Object[_0x21601b(0xb5)](_0x37f9cb[_0x21601b(0xf5)]()));const _0x54e78e=await fetch(_0x1c3bdb,{'method':_0x21601b(0xef),'headers':{'Accept':'application/json','User-Agent':_0x21601b(0xec)}}),_0xbf01f8=Date[_0x21601b(0xb3)]()-_0x8a1a04;if(!_0x54e78e['ok']){const _0x6e4e67=await _0x54e78e[_0x21601b(0xdd)]();loggerService_1['loggerService'][_0x21601b(0xb7)](_0x21601b(0xb8),_0x21601b(0xba)+_0x201481,_0x54e78e[_0x21601b(0xbc)],_0x6e4e67,_0xbf01f8);throw new Error(_0x21601b(0xb1)+_0x54e78e['status']);}const _0x10be0b=await _0x54e78e[_0x21601b(0xb0)]();loggerService_1[_0x21601b(0x93)][_0x21601b(0xb7)]('plisio_direct',_0x21601b(0xba)+_0x201481,_0x54e78e['status'],_0x10be0b,_0xbf01f8);if(_0x10be0b[_0x21601b(0xbc)]!=='success'){loggerService_1['loggerService'][_0x21601b(0xf0)](_0x21601b(0xb8),'/operations/'+_0x201481,_0x21601b(0xf2)+(_0x10be0b[_0x21601b(0xd6)]||_0x10be0b[_0x21601b(0xe0)]||_0x21601b(0xa6)));throw new Error(_0x21601b(0xf2)+(_0x10be0b[_0x21601b(0xd6)]||_0x10be0b['error']||_0x21601b(0xa6)));}let _0x24c678=_0x21601b(0xe8);return{'status':_0x24c678};}catch(_0x3283f1){console['error'](_0x21601b(0x9b),_0x3283f1),loggerService_1['loggerService']['logWhiteDomainError'](_0x21601b(0xb8),_0x21601b(0xba)+_0x201481,_0x3283f1);throw new Error(_0x21601b(0xb9)+(_0x3283f1 instanceof Error?_0x3283f1['message']:_0x21601b(0xa6)));}}async[a62_0x29ce84(0xc1)](_0x226d74){const _0x427cd1=a62_0x29ce84;console[_0x427cd1(0xbd)](_0x427cd1(0xc6),_0x226d74);let _0x3dbe92=_0x427cd1(0xe8);switch(_0x226d74[_0x427cd1(0xbc)]?.['toLowerCase']()){case'completed':case _0x427cd1(0x8e):_0x3dbe92='PAID';break;case'expired':_0x3dbe92=_0x427cd1(0xe5);break;case'error':case _0x427cd1(0xe1):_0x3dbe92=_0x427cd1(0xe2);break;case _0x427cd1(0xa4):_0x3dbe92=_0x427cd1(0xe8);break;case _0x427cd1(0xa5):_0x3dbe92=_0x427cd1(0xd3);break;default:_0x3dbe92=_0x427cd1(0xe8);break;}let _0x2ba37;if(_0x226d74[_0x427cd1(0x99)])try{console[_0x427cd1(0xbd)]('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x226d74[_0x427cd1(0x99)]);let _0x379ffe;if(typeof _0x226d74[_0x427cd1(0x99)]==='string')_0x379ffe=JSON[_0x427cd1(0xc2)](_0x226d74['tx_urls']);else Array['isArray'](_0x226d74[_0x427cd1(0x99)])?_0x379ffe=_0x226d74[_0x427cd1(0x99)]:_0x379ffe=[];_0x2ba37=_0x379ffe[_0x427cd1(0xd5)](_0x21d60b=>{const _0x503a06=_0x427cd1,_0x248d38=_0x21d60b[_0x503a06(0x97)](/\\/g,'');return console[_0x503a06(0xbd)]('üîó\x20Formatted\x20URL:\x20'+_0x21d60b+'\x20->\x20'+_0x248d38),_0x248d38;}),console['log']('‚úÖ\x20Processed\x20tx_urls:',_0x2ba37),_0x2ba37['forEach']((_0x44c459,_0x42b20b)=>{const _0x3df6e3=_0x427cd1;try{new URL(_0x44c459),console[_0x3df6e3(0xbd)](_0x3df6e3(0xaf)+(_0x42b20b+0x1)+_0x3df6e3(0xce)+_0x44c459);}catch(_0x94a1cd){console[_0x3df6e3(0xe0)](_0x3df6e3(0xe3)+(_0x42b20b+0x1)+'\x20is\x20invalid:\x20'+_0x44c459,_0x94a1cd);}});}catch(_0x36d13f){console['error']('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x36d13f),console[_0x427cd1(0xe0)]('Raw\x20tx_urls\x20data:',_0x226d74[_0x427cd1(0x99)]),_0x2ba37=undefined;}return{'paymentId':_0x226d74[_0x427cd1(0x94)]||'','status':_0x3dbe92,'amount':_0x226d74['amount'],'currency':_0x226d74[_0x427cd1(0xd7)],'txUrls':_0x2ba37};}}exports[a62_0x29ce84(0xc9)]=PlisioService;