'use strict';const a55_0x204ea9=a55_0x5e33;(function(_0x28b01f,_0x354694){const _0x524b3f=a55_0x5e33,_0x287ce6=_0x28b01f();while(!![]){try{const _0x5d9c48=-parseInt(_0x524b3f(0x19a))/0x1*(-parseInt(_0x524b3f(0x1ea))/0x2)+-parseInt(_0x524b3f(0x19c))/0x3+parseInt(_0x524b3f(0x1fd))/0x4*(-parseInt(_0x524b3f(0x1f0))/0x5)+-parseInt(_0x524b3f(0x1ae))/0x6+parseInt(_0x524b3f(0x1fb))/0x7*(parseInt(_0x524b3f(0x1e3))/0x8)+-parseInt(_0x524b3f(0x1a0))/0x9+parseInt(_0x524b3f(0x1d8))/0xa*(parseInt(_0x524b3f(0x1d6))/0xb);if(_0x5d9c48===_0x354694)break;else _0x287ce6['push'](_0x287ce6['shift']());}catch(_0x4f567f){_0x287ce6['push'](_0x287ce6['shift']());}}}(a55_0x1370,0x95715));Object[a55_0x204ea9(0x1a7)](exports,a55_0x204ea9(0x1b1),{'value':!![]}),exports[a55_0x204ea9(0x1f4)]=void 0x0;const loggerService_1=require(a55_0x204ea9(0x1ad));function a55_0x1370(){const _0x37870c=['processWebhook','Target\x20Currency:','HTTP\x20Status:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','string','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','status','1kQGBdB','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','1246287AhUZTE','https://api.trapay.uk/api/webhooks/gateway/plisio','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Response\x20Body:','2148840SToNaL','warn','FAILED','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','order_number','Plisio\x20API\x20key\x20is\x20not\x20configured','PAID','defineProperty','Raw\x20Response\x20Body:','toLowerCase','log','expired','\x20->\x20','../loggerService','500172Ytwtgr','Invoice\x20URL:','now','__esModule','text','Status\x20Text:','Plisio\x20payment\x20verification\x20error:','new','üîó\x20Formatted\x20URL:\x20','source_currency','PROCESSING','replace','‚úÖ\x20URL\x20','PENDING','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','message','HIDDEN','mismatch','(crypto\x20for\x20payment)','\x20is\x20invalid:\x20','invoice_url','EXPIRED','parse','Error\x20details:','https://api.plisio.net/api/v1/operations/','logWhiteDomainRequest','/operations/','pending','toString','amount','invoice_total_sum','URL:','entries','logWhiteDomainError','HTTP\x20','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','append','success','loggerService','completed','7468945CSNfwi','PLISIO_API_KEY','10eEkWCD','Source\x20Currency:','cancelled','qr_code','apiKey','fromEntries','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','txn_id','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','env','Response\x20data:','8176304AsrtLe','Unknown\x20error','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','source_amount','logWhiteDomainResponse','error','‚úÖ\x20Processed\x20tx_urls:','227474qfvtla','Response\x20Time:','Payment\x20System/1.0','data','GET','email','990gGEDFT','currency','map','Plisio\x20API\x20error:\x20','PlisioService','/invoices/new','tx_urls','Business\x20Error:\x20','Raw\x20tx_urls\x20data:','plisio_direct','application/json','7egbWPu','isArray','9396QsAXjb','Transaction\x20ID:','Full\x20URL\x20(without\x20API\x20key):','Failed\x20to\x20create\x20Plisio\x20payment:\x20','qr_url','stack','Parameters:','Status:','Parsed\x20Result:'];a55_0x1370=function(){return _0x37870c;};return a55_0x1370();}class PlisioService{constructor(){const _0x4182a1=a55_0x204ea9;this['apiUrl']='https://api.plisio.net/api/v1/invoices/new',this[_0x4182a1(0x1dc)]=process[_0x4182a1(0x1e1)][_0x4182a1(0x1d7)]||'',!this[_0x4182a1(0x1dc)]?console[_0x4182a1(0x1a1)](_0x4182a1(0x1bc)):console['log']('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async['createPayment'](_0x3ff90f){const _0x3c6d6a=a55_0x204ea9,{orderId:_0x4f1ef9,amount:_0x38a439,currency:_0x2ffc5b,productName:_0x327fc9,description:_0xbd72a9,successUrl:_0x1a4a67,failUrl:_0xbb09cf,customerEmail:_0xf8369e,customerName:_0x7f5ca4,isSourceCurrency:_0x4edfb8,sourceCurrency:_0x25233a}=_0x3ff90f;if(!this[_0x3c6d6a(0x1dc)])throw new Error(_0x3c6d6a(0x1a5));const _0x42be80=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x4f1ef9,'order_name':_0x327fc9,'description':_0xbd72a9,'success_url':_0x1a4a67,'fail_url':_0xbb09cf,'callback_url':_0x3c6d6a(0x19d)});_0x25233a?(_0x42be80[_0x3c6d6a(0x1d2)]('currency',_0x25233a),_0x42be80['append'](_0x3c6d6a(0x1b7),_0x2ffc5b),_0x42be80['append'](_0x3c6d6a(0x1e6),_0x38a439[_0x3c6d6a(0x1ca)]())):(_0x42be80[_0x3c6d6a(0x1d2)](_0x3c6d6a(0x1f1),_0x2ffc5b),_0x42be80[_0x3c6d6a(0x1d2)](_0x3c6d6a(0x1cb),_0x38a439[_0x3c6d6a(0x1ca)]()));_0xf8369e&&_0x42be80[_0x3c6d6a(0x1d2)](_0x3c6d6a(0x1ef),_0xf8369e);_0x7f5ca4&&_0x42be80[_0x3c6d6a(0x1d2)]('name',_0x7f5ca4);const _0x1f8776=this['apiUrl']+'?'+_0x42be80['toString'](),_0x189b8c=Date['now']();try{console[_0x3c6d6a(0x1aa)](_0x3c6d6a(0x196)),console[_0x3c6d6a(0x1aa)](_0x3c6d6a(0x1cd),this['apiUrl']),console[_0x3c6d6a(0x1aa)](_0x3c6d6a(0x190),Object[_0x3c6d6a(0x1dd)](_0x42be80[_0x3c6d6a(0x1ce)]())),console[_0x3c6d6a(0x1aa)](_0x3c6d6a(0x1ff),_0x1f8776['replace'](this[_0x3c6d6a(0x1dc)],_0x3c6d6a(0x1be))),loggerService_1[_0x3c6d6a(0x1d4)][_0x3c6d6a(0x1c7)]('plisio_direct',_0x3c6d6a(0x1f5),_0x3c6d6a(0x1ee),Object[_0x3c6d6a(0x1dd)](_0x42be80['entries']()));const _0x368482=await fetch(_0x1f8776,{'method':_0x3c6d6a(0x1ee),'headers':{'Accept':_0x3c6d6a(0x1fa),'User-Agent':_0x3c6d6a(0x1ec)}}),_0x3f1ae9=Date[_0x3c6d6a(0x1b0)]()-_0x189b8c;console['log'](_0x3c6d6a(0x1e5)),console[_0x3c6d6a(0x1aa)](_0x3c6d6a(0x191),_0x368482[_0x3c6d6a(0x199)]),console[_0x3c6d6a(0x1aa)](_0x3c6d6a(0x1b3),_0x368482['statusText']),console['log'](_0x3c6d6a(0x1eb),_0x3f1ae9+'ms');const _0x420e36=await _0x368482['text']();console[_0x3c6d6a(0x1aa)](_0x3c6d6a(0x1a8),_0x420e36);if(!_0x368482['ok']){console[_0x3c6d6a(0x1e8)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x3c6d6a(0x1e8)](_0x3c6d6a(0x195),_0x368482[_0x3c6d6a(0x199)]),console['error'](_0x3c6d6a(0x19f),_0x420e36),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3c6d6a(0x1f9),_0x3c6d6a(0x1f5),_0x368482[_0x3c6d6a(0x199)],_0x420e36,_0x3f1ae9),loggerService_1[_0x3c6d6a(0x1d4)][_0x3c6d6a(0x1cf)](_0x3c6d6a(0x1f9),_0x3c6d6a(0x1f5),_0x3c6d6a(0x1d0)+_0x368482[_0x3c6d6a(0x199)]+':\x20'+_0x420e36);throw new Error('HTTP\x20error!\x20status:\x20'+_0x368482[_0x3c6d6a(0x199)]+',\x20body:\x20'+_0x420e36);}let _0x34e15c;try{_0x34e15c=JSON[_0x3c6d6a(0x1c4)](_0x420e36);}catch(_0x3f5bf8){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x3f5bf8),loggerService_1[_0x3c6d6a(0x1d4)][_0x3c6d6a(0x1cf)](_0x3c6d6a(0x1f9),_0x3c6d6a(0x1f5),'JSON\x20Parse\x20Error:\x20'+_0x3f5bf8);throw new Error(_0x3c6d6a(0x198)+_0x420e36);}console[_0x3c6d6a(0x1aa)](_0x3c6d6a(0x19b)),console[_0x3c6d6a(0x1aa)](_0x3c6d6a(0x192),JSON['stringify'](_0x34e15c,null,0x2)),loggerService_1[_0x3c6d6a(0x1d4)][_0x3c6d6a(0x1e7)](_0x3c6d6a(0x1f9),_0x3c6d6a(0x1f5),_0x368482[_0x3c6d6a(0x199)],_0x34e15c,_0x3f1ae9);if(_0x34e15c[_0x3c6d6a(0x199)]!=='success'){const _0xf0c31e=_0x34e15c['message']||_0x34e15c[_0x3c6d6a(0x1e8)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x3c6d6a(0x1e8)](_0x3c6d6a(0x1d1)),console['error']('Error\x20Message:',_0xf0c31e),loggerService_1[_0x3c6d6a(0x1d4)][_0x3c6d6a(0x1cf)]('plisio_direct',_0x3c6d6a(0x1f5),_0x3c6d6a(0x1f7)+_0xf0c31e);throw new Error('Plisio\x20API\x20error:\x20'+_0xf0c31e);}if(!_0x34e15c['data']?.['txn_id']||!_0x34e15c[_0x3c6d6a(0x1ed)]?.[_0x3c6d6a(0x1c2)]){console['error']('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3c6d6a(0x1e8)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console['error'](_0x3c6d6a(0x1e2),_0x34e15c[_0x3c6d6a(0x1ed)]),loggerService_1[_0x3c6d6a(0x1d4)][_0x3c6d6a(0x1cf)]('plisio_direct','/invoices/new',_0x3c6d6a(0x1a3));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x3c6d6a(0x1aa)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x3c6d6a(0x1aa)](_0x3c6d6a(0x1fe),_0x34e15c[_0x3c6d6a(0x1ed)][_0x3c6d6a(0x1df)]),console[_0x3c6d6a(0x1aa)](_0x3c6d6a(0x1af),_0x34e15c[_0x3c6d6a(0x1ed)][_0x3c6d6a(0x1c2)]),console[_0x3c6d6a(0x1aa)]('Amount:',_0x38a439,_0x2ffc5b),_0x25233a&&(console[_0x3c6d6a(0x1aa)](_0x3c6d6a(0x1d9),_0x25233a,_0x3c6d6a(0x1c0)),console[_0x3c6d6a(0x1aa)](_0x3c6d6a(0x194),_0x2ffc5b,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x34e15c['data'][_0x3c6d6a(0x1df)],'payment_url':_0x34e15c[_0x3c6d6a(0x1ed)][_0x3c6d6a(0x1c2)],'invoice_total_sum':_0x34e15c[_0x3c6d6a(0x1ed)][_0x3c6d6a(0x1cc)],'qr_code':_0x34e15c[_0x3c6d6a(0x1ed)][_0x3c6d6a(0x1db)],'qr_url':_0x34e15c['data'][_0x3c6d6a(0x201)]};}catch(_0x41eadb){console[_0x3c6d6a(0x1e8)](_0x3c6d6a(0x19e)),console[_0x3c6d6a(0x1e8)](_0x3c6d6a(0x1c5),_0x41eadb),loggerService_1[_0x3c6d6a(0x1d4)]['logWhiteDomainError'](_0x3c6d6a(0x1f9),_0x3c6d6a(0x1f5),_0x41eadb);if(_0x41eadb instanceof Error){console[_0x3c6d6a(0x1e8)]('Error\x20message:',_0x41eadb[_0x3c6d6a(0x1bd)]),console[_0x3c6d6a(0x1e8)]('Error\x20stack:',_0x41eadb[_0x3c6d6a(0x18f)]);throw new Error(_0x3c6d6a(0x200)+_0x41eadb[_0x3c6d6a(0x1bd)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async['verifyPayment'](_0x1e046f){const _0x330fb1=a55_0x204ea9,_0x2d22e0=Date[_0x330fb1(0x1b0)]();try{if(!this[_0x330fb1(0x1dc)])throw new Error(_0x330fb1(0x1a5));const _0x387a63=new URLSearchParams({'api_key':this[_0x330fb1(0x1dc)],'txn_id':_0x1e046f}),_0x51df78=_0x330fb1(0x1c6)+_0x1e046f+'?'+_0x387a63[_0x330fb1(0x1ca)]();loggerService_1[_0x330fb1(0x1d4)][_0x330fb1(0x1c7)](_0x330fb1(0x1f9),_0x330fb1(0x1c8)+_0x1e046f,_0x330fb1(0x1ee),Object[_0x330fb1(0x1dd)](_0x387a63[_0x330fb1(0x1ce)]()));const _0x1a389b=await fetch(_0x51df78,{'method':_0x330fb1(0x1ee),'headers':{'Accept':_0x330fb1(0x1fa),'User-Agent':_0x330fb1(0x1ec)}}),_0x3aabb7=Date[_0x330fb1(0x1b0)]()-_0x2d22e0;if(!_0x1a389b['ok']){const _0x536155=await _0x1a389b[_0x330fb1(0x1b2)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x330fb1(0x1f9),_0x330fb1(0x1c8)+_0x1e046f,_0x1a389b[_0x330fb1(0x199)],_0x536155,_0x3aabb7);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1a389b[_0x330fb1(0x199)]);}const _0x3cca8e=await _0x1a389b['json']();loggerService_1[_0x330fb1(0x1d4)][_0x330fb1(0x1e7)](_0x330fb1(0x1f9),_0x330fb1(0x1c8)+_0x1e046f,_0x1a389b[_0x330fb1(0x199)],_0x3cca8e,_0x3aabb7);if(_0x3cca8e['status']!==_0x330fb1(0x1d3)){loggerService_1[_0x330fb1(0x1d4)][_0x330fb1(0x1cf)](_0x330fb1(0x1f9),_0x330fb1(0x1c8)+_0x1e046f,_0x330fb1(0x1f3)+(_0x3cca8e[_0x330fb1(0x1bd)]||_0x3cca8e[_0x330fb1(0x1e8)]||'Unknown\x20error'));throw new Error(_0x330fb1(0x1f3)+(_0x3cca8e['message']||_0x3cca8e[_0x330fb1(0x1e8)]||_0x330fb1(0x1e4)));}let _0x1ef740=_0x330fb1(0x1bb);return{'status':_0x1ef740};}catch(_0x4a2ab1){console[_0x330fb1(0x1e8)](_0x330fb1(0x1b4),_0x4a2ab1),loggerService_1[_0x330fb1(0x1d4)][_0x330fb1(0x1cf)]('plisio_direct',_0x330fb1(0x1c8)+_0x1e046f,_0x4a2ab1);throw new Error(_0x330fb1(0x1de)+(_0x4a2ab1 instanceof Error?_0x4a2ab1[_0x330fb1(0x1bd)]:'Unknown\x20error'));}}async[a55_0x204ea9(0x193)](_0x2d27eb){const _0x514b7b=a55_0x204ea9;console[_0x514b7b(0x1aa)]('Processing\x20Plisio\x20webhook:',_0x2d27eb);let _0x1a09ab=_0x514b7b(0x1bb);switch(_0x2d27eb[_0x514b7b(0x199)]?.[_0x514b7b(0x1a9)]()){case _0x514b7b(0x1d5):case _0x514b7b(0x1bf):_0x1a09ab=_0x514b7b(0x1a6);break;case _0x514b7b(0x1ab):_0x1a09ab=_0x514b7b(0x1c3);break;case _0x514b7b(0x1e8):case _0x514b7b(0x1da):_0x1a09ab=_0x514b7b(0x1a2);break;case _0x514b7b(0x1b5):_0x1a09ab=_0x514b7b(0x1bb);break;case _0x514b7b(0x1c9):_0x1a09ab=_0x514b7b(0x1b8);break;default:_0x1a09ab='PENDING';break;}let _0x2fcf81;if(_0x2d27eb[_0x514b7b(0x1f6)])try{console[_0x514b7b(0x1aa)](_0x514b7b(0x1e0),_0x2d27eb[_0x514b7b(0x1f6)]);let _0x5e28c5;if(typeof _0x2d27eb[_0x514b7b(0x1f6)]===_0x514b7b(0x197))_0x5e28c5=JSON[_0x514b7b(0x1c4)](_0x2d27eb[_0x514b7b(0x1f6)]);else Array[_0x514b7b(0x1fc)](_0x2d27eb[_0x514b7b(0x1f6)])?_0x5e28c5=_0x2d27eb['tx_urls']:_0x5e28c5=[];_0x2fcf81=_0x5e28c5[_0x514b7b(0x1f2)](_0x44ea3c=>{const _0x2aea26=_0x514b7b,_0xcd6b7d=_0x44ea3c[_0x2aea26(0x1b9)](/\\/g,'');return console[_0x2aea26(0x1aa)](_0x2aea26(0x1b6)+_0x44ea3c+_0x2aea26(0x1ac)+_0xcd6b7d),_0xcd6b7d;}),console[_0x514b7b(0x1aa)](_0x514b7b(0x1e9),_0x2fcf81),_0x2fcf81['forEach']((_0x10b1bf,_0x4be5b0)=>{const _0x424c9b=_0x514b7b;try{new URL(_0x10b1bf),console[_0x424c9b(0x1aa)](_0x424c9b(0x1ba)+(_0x4be5b0+0x1)+'\x20is\x20valid:\x20'+_0x10b1bf);}catch(_0x3f229d){console['error']('‚ùå\x20URL\x20'+(_0x4be5b0+0x1)+_0x424c9b(0x1c1)+_0x10b1bf,_0x3f229d);}});}catch(_0x42ea7a){console['error']('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x42ea7a),console[_0x514b7b(0x1e8)](_0x514b7b(0x1f8),_0x2d27eb[_0x514b7b(0x1f6)]),_0x2fcf81=undefined;}return{'paymentId':_0x2d27eb[_0x514b7b(0x1a4)]||'','status':_0x1a09ab,'amount':_0x2d27eb[_0x514b7b(0x1cb)],'currency':_0x2d27eb[_0x514b7b(0x1f1)],'txUrls':_0x2fcf81};}}function a55_0x5e33(_0x4d8d69,_0x1d5128){const _0x13708d=a55_0x1370();return a55_0x5e33=function(_0x5e3377,_0x39e7a8){_0x5e3377=_0x5e3377-0x18f;let _0x41b0ac=_0x13708d[_0x5e3377];return _0x41b0ac;},a55_0x5e33(_0x4d8d69,_0x1d5128);}exports[a55_0x204ea9(0x1f4)]=PlisioService;