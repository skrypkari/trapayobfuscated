'use strict';function a52_0x4e3e(){const _0x2ada18=['PlisioService','../loggerService','(fiat\x20for\x20merchant)','687375ygvsLT','5645755qQsLgB','now','Plisio\x20API\x20error:\x20','Source\x20Currency:','(crypto\x20for\x20payment)','/invoices/new','tx_urls','6751170sXOAwk','5531407dYtsaD','3mduxWQ','source_currency','Parameters:','invoice_url','data','name','__esModule','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','log','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','amount','currency','qr_code','invoice_total_sum','verifyPayment','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','toString','EXPIRED','txn_id','HTTP\x20','\x20is\x20invalid:\x20','qr_url','Error\x20details:','new','string','4604TbOLhZ','error','env','HTTP\x20error!\x20status:\x20','Plisio\x20payment\x20verification\x20error:',',\x20body:\x20','mismatch','success','PROCESSING','785986ILESXP','text','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','json','apiUrl','loggerService','plisio_direct','replace','application/json','/operations/','Response\x20Time:','Status:','toLowerCase','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Failed\x20to\x20parse\x20JSON\x20response:','source_amount','expired','createPayment','Transaction\x20ID:','GET','8aHHVBF','append','logWhiteDomainError','PAID','status','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','email','forEach','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','pending','Parsed\x20Result:','Unknown\x20error','Full\x20URL\x20(without\x20API\x20key):','Raw\x20tx_urls\x20data:','parse','Unknown\x20error\x20from\x20Plisio\x20API','map','===\x20PLISIO\x20SUCCESS\x20===','cancelled','apiKey','fromEntries','PLISIO_API_KEY','https://api.plisio.net/api/v1/invoices/new','Error\x20message:','message','Plisio\x20API\x20key\x20is\x20not\x20configured','1945230FlwfVy','‚ùå\x20URL\x20','entries','Response\x20Body:','Error\x20stack:','1212EwifnH','\x20->\x20','completed','PENDING','URL:','Status\x20Text:','logWhiteDomainResponse','HTTP\x20Status:','statusText','logWhiteDomainRequest','processWebhook','warn'];a52_0x4e3e=function(){return _0x2ada18;};return a52_0x4e3e();}const a52_0x597041=a52_0x1030;(function(_0x2429bd,_0x5d1fff){const _0x2d3541=a52_0x1030,_0x4d55c0=_0x2429bd();while(!![]){try{const _0x439b3d=parseInt(_0x2d3541(0x80))/0x1*(parseInt(_0x2d3541(0xa5))/0x2)+parseInt(_0x2d3541(0xd8))/0x3*(parseInt(_0x2d3541(0x9c))/0x4)+-parseInt(_0x2d3541(0xe8))/0x5+parseInt(_0x2d3541(0xd3))/0x6+-parseInt(_0x2d3541(0x7f))/0x7*(parseInt(_0x2d3541(0xb9))/0x8)+-parseInt(_0x2d3541(0xe7))/0x9+parseInt(_0x2d3541(0x7e))/0xa;if(_0x439b3d===_0x5d1fff)break;else _0x4d55c0['push'](_0x4d55c0['shift']());}catch(_0x3027f9){_0x4d55c0['push'](_0x4d55c0['shift']());}}}(a52_0x4e3e,0x9e19a));function a52_0x1030(_0x26b1c5,_0x141c5c){const _0x4e3e98=a52_0x4e3e();return a52_0x1030=function(_0x1030ee,_0x3e2dc1){_0x1030ee=_0x1030ee-0x7c;let _0x12b021=_0x4e3e98[_0x1030ee];return _0x12b021;},a52_0x1030(_0x26b1c5,_0x141c5c);}Object['defineProperty'](exports,a52_0x597041(0x86),{'value':!![]}),exports[a52_0x597041(0xe4)]=void 0x0;const loggerService_1=require(a52_0x597041(0xe5));class PlisioService{constructor(){const _0x844829=a52_0x597041;this[_0x844829(0xa9)]=_0x844829(0xcf),this[_0x844829(0xcc)]=process[_0x844829(0x9e)][_0x844829(0xce)]||'',!this[_0x844829(0xcc)]?console[_0x844829(0xe3)]('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x844829(0x8a)](_0x844829(0xa7));}async[a52_0x597041(0xb6)](_0x32227c){const _0x195272=a52_0x597041,{orderId:_0x487cf2,amount:_0x209c81,currency:_0x414c88,productName:_0x38972b,description:_0x293fb7,successUrl:_0x2e8a28,failUrl:_0xcaa4c,customerEmail:_0xbd6994,customerName:_0x45d5f2,isSourceCurrency:_0x58d60c,sourceCurrency:_0x240908}=_0x32227c;if(!this[_0x195272(0xcc)])throw new Error(_0x195272(0xd2));const _0x33f933=new URLSearchParams({'api_key':this[_0x195272(0xcc)],'order_number':_0x487cf2,'order_name':_0x38972b,'description':_0x293fb7,'success_url':_0x2e8a28,'fail_url':_0xcaa4c,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x240908?(_0x33f933['append'](_0x195272(0x8d),_0x240908),_0x33f933['append'](_0x195272(0x81),_0x414c88),_0x33f933[_0x195272(0xba)](_0x195272(0xb4),_0x209c81[_0x195272(0x93)]())):(_0x33f933[_0x195272(0xba)](_0x195272(0x8d),_0x414c88),_0x33f933[_0x195272(0xba)]('amount',_0x209c81[_0x195272(0x93)]()));_0xbd6994&&_0x33f933[_0x195272(0xba)](_0x195272(0xbf),_0xbd6994);_0x45d5f2&&_0x33f933[_0x195272(0xba)](_0x195272(0x85),_0x45d5f2);const _0x477360=this[_0x195272(0xa9)]+'?'+_0x33f933[_0x195272(0x93)](),_0x1d4d4a=Date[_0x195272(0xe9)]();try{console[_0x195272(0x8a)](_0x195272(0x87)),console[_0x195272(0x8a)](_0x195272(0xdc),this[_0x195272(0xa9)]),console[_0x195272(0x8a)](_0x195272(0x82),Object['fromEntries'](_0x33f933[_0x195272(0xd5)]())),console[_0x195272(0x8a)](_0x195272(0xc5),_0x477360[_0x195272(0xac)](this[_0x195272(0xcc)],'HIDDEN')),loggerService_1[_0x195272(0xaa)][_0x195272(0xe1)](_0x195272(0xab),_0x195272(0x7c),_0x195272(0xb8),Object[_0x195272(0xcd)](_0x33f933['entries']()));const _0x3aa675=await fetch(_0x477360,{'method':_0x195272(0xb8),'headers':{'Accept':_0x195272(0xad),'User-Agent':'Payment\x20System/1.0'}}),_0x215bcc=Date[_0x195272(0xe9)]()-_0x1d4d4a;console[_0x195272(0x8a)](_0x195272(0xc1)),console[_0x195272(0x8a)](_0x195272(0xb0),_0x3aa675[_0x195272(0xbd)]),console[_0x195272(0x8a)](_0x195272(0xdd),_0x3aa675[_0x195272(0xe0)]),console[_0x195272(0x8a)](_0x195272(0xaf),_0x215bcc+'ms');const _0x239756=await _0x3aa675[_0x195272(0xa6)]();console[_0x195272(0x8a)]('Raw\x20Response\x20Body:',_0x239756);if(!_0x3aa675['ok']){console['error']('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error'](_0x195272(0xdf),_0x3aa675[_0x195272(0xbd)]),console['error'](_0x195272(0xd6),_0x239756),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x195272(0xab),_0x195272(0x7c),_0x3aa675[_0x195272(0xbd)],_0x239756,_0x215bcc),loggerService_1[_0x195272(0xaa)][_0x195272(0xbb)](_0x195272(0xab),'/invoices/new',_0x195272(0x96)+_0x3aa675[_0x195272(0xbd)]+':\x20'+_0x239756);throw new Error(_0x195272(0x9f)+_0x3aa675['status']+_0x195272(0xa1)+_0x239756);}let _0x6de21a;try{_0x6de21a=JSON[_0x195272(0xc7)](_0x239756);}catch(_0x339d5f){console[_0x195272(0x9d)](_0x195272(0xb3),_0x339d5f),loggerService_1[_0x195272(0xaa)]['logWhiteDomainError'](_0x195272(0xab),_0x195272(0x7c),'JSON\x20Parse\x20Error:\x20'+_0x339d5f);throw new Error(_0x195272(0xb2)+_0x239756);}console[_0x195272(0x8a)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console['log'](_0x195272(0xc3),JSON['stringify'](_0x6de21a,null,0x2)),loggerService_1[_0x195272(0xaa)]['logWhiteDomainResponse'](_0x195272(0xab),_0x195272(0x7c),_0x3aa675[_0x195272(0xbd)],_0x6de21a,_0x215bcc);if(_0x6de21a[_0x195272(0xbd)]!=='success'){const _0x5aaf6f=_0x6de21a[_0x195272(0xd1)]||_0x6de21a[_0x195272(0x9d)]||_0x195272(0xc8);console[_0x195272(0x9d)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x195272(0x9d)]('Error\x20Message:',_0x5aaf6f),loggerService_1['loggerService'][_0x195272(0xbb)]('plisio_direct',_0x195272(0x7c),'Business\x20Error:\x20'+_0x5aaf6f);throw new Error(_0x195272(0xea)+_0x5aaf6f);}if(!_0x6de21a['data']?.[_0x195272(0x95)]||!_0x6de21a['data']?.['invoice_url']){console['error'](_0x195272(0x89)),console['error'](_0x195272(0xbe)),console[_0x195272(0x9d)]('Response\x20data:',_0x6de21a['data']),loggerService_1['loggerService'][_0x195272(0xbb)](_0x195272(0xab),_0x195272(0x7c),_0x195272(0x8b));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x195272(0x8a)](_0x195272(0xca)),console[_0x195272(0x8a)](_0x195272(0xb7),_0x6de21a[_0x195272(0x84)][_0x195272(0x95)]),console['log']('Invoice\x20URL:',_0x6de21a['data'][_0x195272(0x83)]),console['log']('Amount:',_0x209c81,_0x414c88),_0x240908&&(console[_0x195272(0x8a)](_0x195272(0xeb),_0x240908,_0x195272(0xec)),console[_0x195272(0x8a)]('Target\x20Currency:',_0x414c88,_0x195272(0xe6))),{'gateway_payment_id':_0x6de21a[_0x195272(0x84)]['txn_id'],'payment_url':_0x6de21a[_0x195272(0x84)]['invoice_url'],'invoice_total_sum':_0x6de21a[_0x195272(0x84)][_0x195272(0x8f)],'qr_code':_0x6de21a[_0x195272(0x84)][_0x195272(0x8e)],'qr_url':_0x6de21a[_0x195272(0x84)][_0x195272(0x98)]};}catch(_0x383c5d){console['error'](_0x195272(0x88)),console[_0x195272(0x9d)](_0x195272(0x99),_0x383c5d),loggerService_1[_0x195272(0xaa)][_0x195272(0xbb)]('plisio_direct',_0x195272(0x7c),_0x383c5d);if(_0x383c5d instanceof Error){console['error'](_0x195272(0xd0),_0x383c5d[_0x195272(0xd1)]),console[_0x195272(0x9d)](_0x195272(0xd7),_0x383c5d['stack']);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x383c5d['message']);}throw new Error(_0x195272(0x92));}}async[a52_0x597041(0x90)](_0x4df8ce){const _0x408a89=a52_0x597041,_0xdbb0f=Date[_0x408a89(0xe9)]();try{if(!this[_0x408a89(0xcc)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x199df3=new URLSearchParams({'api_key':this[_0x408a89(0xcc)],'txn_id':_0x4df8ce}),_0x2d548b='https://api.plisio.net/api/v1/operations/'+_0x4df8ce+'?'+_0x199df3['toString']();loggerService_1[_0x408a89(0xaa)][_0x408a89(0xe1)](_0x408a89(0xab),_0x408a89(0xae)+_0x4df8ce,_0x408a89(0xb8),Object[_0x408a89(0xcd)](_0x199df3[_0x408a89(0xd5)]()));const _0x3fb734=await fetch(_0x2d548b,{'method':'GET','headers':{'Accept':'application/json','User-Agent':'Payment\x20System/1.0'}}),_0x4d963c=Date[_0x408a89(0xe9)]()-_0xdbb0f;if(!_0x3fb734['ok']){const _0x4cb65d=await _0x3fb734['text']();loggerService_1[_0x408a89(0xaa)]['logWhiteDomainResponse'](_0x408a89(0xab),_0x408a89(0xae)+_0x4df8ce,_0x3fb734[_0x408a89(0xbd)],_0x4cb65d,_0x4d963c);throw new Error(_0x408a89(0x9f)+_0x3fb734[_0x408a89(0xbd)]);}const _0x3fe1dd=await _0x3fb734[_0x408a89(0xa8)]();loggerService_1[_0x408a89(0xaa)][_0x408a89(0xde)](_0x408a89(0xab),_0x408a89(0xae)+_0x4df8ce,_0x3fb734[_0x408a89(0xbd)],_0x3fe1dd,_0x4d963c);if(_0x3fe1dd[_0x408a89(0xbd)]!==_0x408a89(0xa3)){loggerService_1[_0x408a89(0xaa)][_0x408a89(0xbb)](_0x408a89(0xab),_0x408a89(0xae)+_0x4df8ce,_0x408a89(0xea)+(_0x3fe1dd[_0x408a89(0xd1)]||_0x3fe1dd[_0x408a89(0x9d)]||_0x408a89(0xc4)));throw new Error(_0x408a89(0xea)+(_0x3fe1dd['message']||_0x3fe1dd[_0x408a89(0x9d)]||'Unknown\x20error'));}let _0x8cc709=_0x408a89(0xdb);return{'status':_0x8cc709};}catch(_0x27bc42){console['error'](_0x408a89(0xa0),_0x27bc42),loggerService_1[_0x408a89(0xaa)][_0x408a89(0xbb)]('plisio_direct',_0x408a89(0xae)+_0x4df8ce,_0x27bc42);throw new Error(_0x408a89(0x91)+(_0x27bc42 instanceof Error?_0x27bc42['message']:_0x408a89(0xc4)));}}async[a52_0x597041(0xe2)](_0x290c3d){const _0x10f44f=a52_0x597041;console[_0x10f44f(0x8a)]('Processing\x20Plisio\x20webhook:',_0x290c3d);let _0x2d8d8c='PENDING';switch(_0x290c3d[_0x10f44f(0xbd)]?.[_0x10f44f(0xb1)]()){case _0x10f44f(0xda):case _0x10f44f(0xa2):_0x2d8d8c=_0x10f44f(0xbc);break;case _0x10f44f(0xb5):_0x2d8d8c=_0x10f44f(0x94);break;case _0x10f44f(0x9d):case _0x10f44f(0xcb):_0x2d8d8c='FAILED';break;case _0x10f44f(0x9a):_0x2d8d8c=_0x10f44f(0xdb);break;case _0x10f44f(0xc2):_0x2d8d8c=_0x10f44f(0xa4);break;default:_0x2d8d8c=_0x10f44f(0xdb);break;}let _0x4e8467;if(_0x290c3d[_0x10f44f(0x7d)])try{console[_0x10f44f(0x8a)]('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x290c3d[_0x10f44f(0x7d)]);let _0x130b54;if(typeof _0x290c3d[_0x10f44f(0x7d)]===_0x10f44f(0x9b))_0x130b54=JSON['parse'](_0x290c3d[_0x10f44f(0x7d)]);else Array['isArray'](_0x290c3d[_0x10f44f(0x7d)])?_0x130b54=_0x290c3d[_0x10f44f(0x7d)]:_0x130b54=[];_0x4e8467=_0x130b54[_0x10f44f(0xc9)](_0x191b5b=>{const _0x50a132=_0x10f44f,_0x35df71=_0x191b5b[_0x50a132(0xac)](/\\/g,'');return console[_0x50a132(0x8a)]('üîó\x20Formatted\x20URL:\x20'+_0x191b5b+_0x50a132(0xd9)+_0x35df71),_0x35df71;}),console[_0x10f44f(0x8a)]('‚úÖ\x20Processed\x20tx_urls:',_0x4e8467),_0x4e8467[_0x10f44f(0xc0)]((_0x372fbc,_0x34bcb9)=>{const _0x54d3bd=_0x10f44f;try{new URL(_0x372fbc),console['log']('‚úÖ\x20URL\x20'+(_0x34bcb9+0x1)+'\x20is\x20valid:\x20'+_0x372fbc);}catch(_0x4c454d){console[_0x54d3bd(0x9d)](_0x54d3bd(0xd4)+(_0x34bcb9+0x1)+_0x54d3bd(0x97)+_0x372fbc,_0x4c454d);}});}catch(_0x5ddf17){console[_0x10f44f(0x9d)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x5ddf17),console[_0x10f44f(0x9d)](_0x10f44f(0xc6),_0x290c3d[_0x10f44f(0x7d)]),_0x4e8467=undefined;}return{'paymentId':_0x290c3d['order_number']||'','status':_0x2d8d8c,'amount':_0x290c3d[_0x10f44f(0x8c)],'currency':_0x290c3d[_0x10f44f(0x8d)],'txUrls':_0x4e8467};}}exports['PlisioService']=PlisioService;