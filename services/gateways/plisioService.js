'use strict';const a41_0x1e7182=a41_0x217a;function a41_0x2a8d(){const _0x1efe36=[',\x20body:\x20','URL:','PAID','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','Processing\x20Plisio\x20webhook:','apiKey','message','Parameters:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','replace','1282476JnhLEJ','warn','Failed\x20to\x20create\x20Plisio\x20payment:\x20','application/json','now','===\x20PLISIO\x20SUCCESS\x20===','name','verifyPayment','cancelled','../loggerService','1506NwDzKI','PLISIO_API_KEY','Unknown\x20error\x20from\x20Plisio\x20API','email','stringify','text','1698950zYztEr','HTTP\x20Status:','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Response\x20Time:','toString','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','/invoices/new','Plisio\x20API\x20error:\x20','source_currency','874174QDzIMq','expired','FAILED','Plisio\x20API\x20key\x20is\x20not\x20configured','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','error','fromEntries','https://api.trapay.uk/api/webhooks/gateway/plisio','GET','Unknown\x20error','apiUrl','TesSoft\x20Payment\x20System/1.0','Failed\x20to\x20parse\x20JSON\x20response:','log','parse','PENDING','mismatch','6236320KnWrFn','loggerService','Response\x20data:','===\x20PLISIO\x20API\x20ERROR\x20===','Transaction\x20ID:','696762PHrFJE','PlisioService','https://api.plisio.net/api/v1/operations/','/operations/','processWebhook','Error\x20details:','completed','Target\x20Currency:','logWhiteDomainResponse','currency','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','stack','Response\x20Body:','toLowerCase','source_amount','json','entries','status','txn_id','https://api.plisio.net/api/v1/invoices/new','plisio_direct','JSON\x20Parse\x20Error:\x20','Status\x20Text:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Plisio\x20payment\x20verification\x20error:','data','env','amount','invoice_url','Error\x20Message:','Error\x20message:','append','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','33OroEts','Invoice\x20URL:','success','defineProperty','logWhiteDomainError','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','EXPIRED','98571vOfoKX','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url'];a41_0x2a8d=function(){return _0x1efe36;};return a41_0x2a8d();}function a41_0x217a(_0x27fd3f,_0x19b7f1){const _0x2a8db6=a41_0x2a8d();return a41_0x217a=function(_0x217afb,_0x5c5a76){_0x217afb=_0x217afb-0x1d3;let _0x5b70f8=_0x2a8db6[_0x217afb];return _0x5b70f8;},a41_0x217a(_0x27fd3f,_0x19b7f1);}(function(_0x265f39,_0x474864){const _0x5b596a=a41_0x217a,_0x22e0b7=_0x265f39();while(!![]){try{const _0x145d3c=-parseInt(_0x5b596a(0x1db))/0x1*(-parseInt(_0x5b596a(0x1f9))/0x2)+parseInt(_0x5b596a(0x1e2))/0x3+parseInt(_0x5b596a(0x1ef))/0x4+parseInt(_0x5b596a(0x1ff))/0x5+parseInt(_0x5b596a(0x21e))/0x6+parseInt(_0x5b596a(0x208))/0x7+-parseInt(_0x5b596a(0x219))/0x8;if(_0x145d3c===_0x474864)break;else _0x22e0b7['push'](_0x22e0b7['shift']());}catch(_0x1e26c2){_0x22e0b7['push'](_0x22e0b7['shift']());}}}(a41_0x2a8d,0x2bd80));Object[a41_0x1e7182(0x1de)](exports,'__esModule',{'value':!![]}),exports[a41_0x1e7182(0x21f)]=void 0x0;const loggerService_1=require(a41_0x1e7182(0x1f8));class PlisioService{constructor(){const _0x18f6ea=a41_0x1e7182;this[_0x18f6ea(0x212)]=_0x18f6ea(0x232),this[_0x18f6ea(0x1ea)]=process[_0x18f6ea(0x1d4)][_0x18f6ea(0x1fa)]||'',!this[_0x18f6ea(0x1ea)]?console[_0x18f6ea(0x1f0)](_0x18f6ea(0x1da)):console[_0x18f6ea(0x215)](_0x18f6ea(0x228));}async['createPayment'](_0x2431ee){const _0x5bdd9e=a41_0x1e7182,{orderId:_0x4722bb,amount:_0x51253,currency:_0x45e90b,productName:_0x2704de,description:_0x4d3df8,successUrl:_0x2d39c3,failUrl:_0x57f01b,customerEmail:_0x2f71c3,customerName:_0x32e57c,isSourceCurrency:_0x373658,sourceCurrency:_0x3de016}=_0x2431ee;if(!this[_0x5bdd9e(0x1ea)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x3029aa=new URLSearchParams({'api_key':this[_0x5bdd9e(0x1ea)],'order_number':_0x4722bb,'order_name':_0x2704de,'description':_0x4d3df8,'success_url':_0x2d39c3,'fail_url':_0x57f01b,'callback_url':_0x5bdd9e(0x20f)});_0x3de016?(_0x3029aa[_0x5bdd9e(0x1d9)](_0x5bdd9e(0x227),_0x3de016),_0x3029aa[_0x5bdd9e(0x1d9)](_0x5bdd9e(0x207),_0x45e90b),_0x3029aa[_0x5bdd9e(0x1d9)](_0x5bdd9e(0x22d),_0x51253[_0x5bdd9e(0x203)]())):(_0x3029aa['append'](_0x5bdd9e(0x227),_0x45e90b),_0x3029aa[_0x5bdd9e(0x1d9)](_0x5bdd9e(0x1d5),_0x51253['toString']()));_0x2f71c3&&_0x3029aa[_0x5bdd9e(0x1d9)](_0x5bdd9e(0x1fc),_0x2f71c3);_0x32e57c&&_0x3029aa[_0x5bdd9e(0x1d9)](_0x5bdd9e(0x1f5),_0x32e57c);const _0x569f4f=this[_0x5bdd9e(0x212)]+'?'+_0x3029aa[_0x5bdd9e(0x203)](),_0xd1d85f=Date['now']();try{console[_0x5bdd9e(0x215)](_0x5bdd9e(0x1ed)),console['log'](_0x5bdd9e(0x1e5),this[_0x5bdd9e(0x212)]),console[_0x5bdd9e(0x215)](_0x5bdd9e(0x1ec),Object[_0x5bdd9e(0x20e)](_0x3029aa[_0x5bdd9e(0x22f)]())),console[_0x5bdd9e(0x215)]('Full\x20URL\x20(without\x20API\x20key):',_0x569f4f[_0x5bdd9e(0x1ee)](this[_0x5bdd9e(0x1ea)],'HIDDEN')),loggerService_1[_0x5bdd9e(0x21a)]['logWhiteDomainRequest']('plisio_direct',_0x5bdd9e(0x205),_0x5bdd9e(0x210),Object[_0x5bdd9e(0x20e)](_0x3029aa['entries']()));const _0x476185=await fetch(_0x569f4f,{'method':_0x5bdd9e(0x210),'headers':{'Accept':_0x5bdd9e(0x1f2),'User-Agent':_0x5bdd9e(0x213)}}),_0x562969=Date['now']()-_0xd1d85f;console['log'](_0x5bdd9e(0x236)),console['log']('Status:',_0x476185[_0x5bdd9e(0x230)]),console['log'](_0x5bdd9e(0x235),_0x476185['statusText']),console[_0x5bdd9e(0x215)](_0x5bdd9e(0x202),_0x562969+'ms');const _0x17e588=await _0x476185[_0x5bdd9e(0x1fe)]();console['log']('Raw\x20Response\x20Body:',_0x17e588);if(!_0x476185['ok']){console[_0x5bdd9e(0x20d)](_0x5bdd9e(0x21c)),console[_0x5bdd9e(0x20d)](_0x5bdd9e(0x200),_0x476185[_0x5bdd9e(0x230)]),console['error'](_0x5bdd9e(0x22b),_0x17e588),loggerService_1['loggerService'][_0x5bdd9e(0x226)](_0x5bdd9e(0x233),_0x5bdd9e(0x205),_0x476185[_0x5bdd9e(0x230)],_0x17e588,_0x562969),loggerService_1[_0x5bdd9e(0x21a)][_0x5bdd9e(0x1df)](_0x5bdd9e(0x233),_0x5bdd9e(0x205),'HTTP\x20'+_0x476185[_0x5bdd9e(0x230)]+':\x20'+_0x17e588);throw new Error('HTTP\x20error!\x20status:\x20'+_0x476185[_0x5bdd9e(0x230)]+_0x5bdd9e(0x1e4)+_0x17e588);}let _0x371843;try{_0x371843=JSON[_0x5bdd9e(0x216)](_0x17e588);}catch(_0x356704){console['error'](_0x5bdd9e(0x214),_0x356704),loggerService_1[_0x5bdd9e(0x21a)][_0x5bdd9e(0x1df)](_0x5bdd9e(0x233),_0x5bdd9e(0x205),_0x5bdd9e(0x234)+_0x356704);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x17e588);}console[_0x5bdd9e(0x215)](_0x5bdd9e(0x20c)),console['log']('Parsed\x20Result:',JSON[_0x5bdd9e(0x1fd)](_0x371843,null,0x2)),loggerService_1[_0x5bdd9e(0x21a)]['logWhiteDomainResponse'](_0x5bdd9e(0x233),'/invoices/new',_0x476185[_0x5bdd9e(0x230)],_0x371843,_0x562969);if(_0x371843[_0x5bdd9e(0x230)]!=='success'){const _0x566fe6=_0x371843['message']||_0x371843[_0x5bdd9e(0x20d)]||_0x5bdd9e(0x1fb);console[_0x5bdd9e(0x20d)](_0x5bdd9e(0x204)),console[_0x5bdd9e(0x20d)](_0x5bdd9e(0x1d7),_0x566fe6),loggerService_1['loggerService'][_0x5bdd9e(0x1df)](_0x5bdd9e(0x233),'/invoices/new','Business\x20Error:\x20'+_0x566fe6);throw new Error(_0x5bdd9e(0x206)+_0x566fe6);}if(!_0x371843[_0x5bdd9e(0x1d3)]?.[_0x5bdd9e(0x231)]||!_0x371843[_0x5bdd9e(0x1d3)]?.[_0x5bdd9e(0x1d6)]){console[_0x5bdd9e(0x20d)](_0x5bdd9e(0x1e7)),console['error']('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x5bdd9e(0x20d)](_0x5bdd9e(0x21b),_0x371843[_0x5bdd9e(0x1d3)]),loggerService_1[_0x5bdd9e(0x21a)]['logWhiteDomainError'](_0x5bdd9e(0x233),_0x5bdd9e(0x205),_0x5bdd9e(0x1e8));throw new Error(_0x5bdd9e(0x1e3));}return console['log'](_0x5bdd9e(0x1f4)),console['log'](_0x5bdd9e(0x21d),_0x371843[_0x5bdd9e(0x1d3)][_0x5bdd9e(0x231)]),console[_0x5bdd9e(0x215)](_0x5bdd9e(0x1dc),_0x371843['data'][_0x5bdd9e(0x1d6)]),console['log']('Amount:',_0x51253,_0x45e90b),_0x3de016&&(console[_0x5bdd9e(0x215)]('Source\x20Currency:',_0x3de016,'(crypto\x20for\x20payment)'),console[_0x5bdd9e(0x215)](_0x5bdd9e(0x225),_0x45e90b,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x371843[_0x5bdd9e(0x1d3)][_0x5bdd9e(0x231)],'payment_url':_0x371843['data'][_0x5bdd9e(0x1d6)],'invoice_total_sum':_0x371843[_0x5bdd9e(0x1d3)]['invoice_total_sum'],'qr_code':_0x371843['data']['qr_code'],'qr_url':_0x371843[_0x5bdd9e(0x1d3)]['qr_url']};}catch(_0x325cf8){console[_0x5bdd9e(0x20d)](_0x5bdd9e(0x201)),console[_0x5bdd9e(0x20d)](_0x5bdd9e(0x223),_0x325cf8),loggerService_1[_0x5bdd9e(0x21a)]['logWhiteDomainError']('plisio_direct',_0x5bdd9e(0x205),_0x325cf8);if(_0x325cf8 instanceof Error){console[_0x5bdd9e(0x20d)](_0x5bdd9e(0x1d8),_0x325cf8[_0x5bdd9e(0x1eb)]),console[_0x5bdd9e(0x20d)]('Error\x20stack:',_0x325cf8[_0x5bdd9e(0x22a)]);throw new Error(_0x5bdd9e(0x1f1)+_0x325cf8['message']);}throw new Error(_0x5bdd9e(0x1e0));}}async[a41_0x1e7182(0x1f6)](_0x1c7c2f){const _0x324f5f=a41_0x1e7182,_0x1fd36b=Date[_0x324f5f(0x1f3)]();try{if(!this['apiKey'])throw new Error(_0x324f5f(0x20b));const _0x4f4851=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x1c7c2f}),_0x367188=_0x324f5f(0x220)+_0x1c7c2f+'?'+_0x4f4851[_0x324f5f(0x203)]();loggerService_1[_0x324f5f(0x21a)]['logWhiteDomainRequest'](_0x324f5f(0x233),_0x324f5f(0x221)+_0x1c7c2f,_0x324f5f(0x210),Object['fromEntries'](_0x4f4851[_0x324f5f(0x22f)]()));const _0x1e8042=await fetch(_0x367188,{'method':_0x324f5f(0x210),'headers':{'Accept':_0x324f5f(0x1f2),'User-Agent':_0x324f5f(0x213)}}),_0x10d68a=Date['now']()-_0x1fd36b;if(!_0x1e8042['ok']){const _0x5a84e2=await _0x1e8042[_0x324f5f(0x1fe)]();loggerService_1['loggerService'][_0x324f5f(0x226)](_0x324f5f(0x233),_0x324f5f(0x221)+_0x1c7c2f,_0x1e8042[_0x324f5f(0x230)],_0x5a84e2,_0x10d68a);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1e8042[_0x324f5f(0x230)]);}const _0x5c7c35=await _0x1e8042[_0x324f5f(0x22e)]();loggerService_1['loggerService'][_0x324f5f(0x226)](_0x324f5f(0x233),'/operations/'+_0x1c7c2f,_0x1e8042[_0x324f5f(0x230)],_0x5c7c35,_0x10d68a);if(_0x5c7c35[_0x324f5f(0x230)]!==_0x324f5f(0x1dd)){loggerService_1[_0x324f5f(0x21a)][_0x324f5f(0x1df)](_0x324f5f(0x233),_0x324f5f(0x221)+_0x1c7c2f,_0x324f5f(0x206)+(_0x5c7c35[_0x324f5f(0x1eb)]||_0x5c7c35[_0x324f5f(0x20d)]||'Unknown\x20error'));throw new Error(_0x324f5f(0x206)+(_0x5c7c35[_0x324f5f(0x1eb)]||_0x5c7c35[_0x324f5f(0x20d)]||_0x324f5f(0x211)));}let _0x33d8da=_0x324f5f(0x217);return{'status':_0x33d8da};}catch(_0x4b9ac1){console['error'](_0x324f5f(0x237),_0x4b9ac1),loggerService_1['loggerService'][_0x324f5f(0x1df)](_0x324f5f(0x233),_0x324f5f(0x221)+_0x1c7c2f,_0x4b9ac1);throw new Error(_0x324f5f(0x229)+(_0x4b9ac1 instanceof Error?_0x4b9ac1[_0x324f5f(0x1eb)]:_0x324f5f(0x211)));}}async[a41_0x1e7182(0x222)](_0x2d0aec){const _0x10b923=a41_0x1e7182;console['log'](_0x10b923(0x1e9),_0x2d0aec);let _0x22bffd='PENDING';switch(_0x2d0aec['status']?.[_0x10b923(0x22c)]()){case _0x10b923(0x224):case _0x10b923(0x218):_0x22bffd=_0x10b923(0x1e6);break;case _0x10b923(0x209):_0x22bffd=_0x10b923(0x1e1);break;case'error':case _0x10b923(0x1f7):_0x22bffd=_0x10b923(0x20a);break;case'new':case'pending':default:_0x22bffd=_0x10b923(0x217);break;}return{'paymentId':_0x2d0aec['order_number']||'','status':_0x22bffd,'amount':_0x2d0aec[_0x10b923(0x1d5)],'currency':_0x2d0aec[_0x10b923(0x227)]};}}exports[a41_0x1e7182(0x21f)]=PlisioService;