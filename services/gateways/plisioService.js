'use strict';const a49_0x5d9882=a49_0x4f64;(function(_0x30b181,_0x3aad4d){const _0x463635=a49_0x4f64,_0x174b31=_0x30b181();while(!![]){try{const _0x117af4=-parseInt(_0x463635(0xf9))/0x1+parseInt(_0x463635(0xe4))/0x2+-parseInt(_0x463635(0x121))/0x3*(parseInt(_0x463635(0xca))/0x4)+-parseInt(_0x463635(0xe0))/0x5*(-parseInt(_0x463635(0xc4))/0x6)+parseInt(_0x463635(0xbc))/0x7+-parseInt(_0x463635(0x122))/0x8+parseInt(_0x463635(0xf6))/0x9;if(_0x117af4===_0x3aad4d)break;else _0x174b31['push'](_0x174b31['shift']());}catch(_0x4a97ed){_0x174b31['push'](_0x174b31['shift']());}}}(a49_0x57d7,0x9d17a));Object[a49_0x5d9882(0x123)](exports,a49_0x5d9882(0xc3),{'value':!![]}),exports[a49_0x5d9882(0xea)]=void 0x0;function a49_0x4f64(_0x4e4729,_0x26cd6e){const _0x57d75f=a49_0x57d7();return a49_0x4f64=function(_0x4f642b,_0x1db8c3){_0x4f642b=_0x4f642b-0xaf;let _0x338f7a=_0x57d75f[_0x4f642b];return _0x338f7a;},a49_0x4f64(_0x4e4729,_0x26cd6e);}function a49_0x57d7(){const _0x3d0b87=['invoice_url','apiUrl','606hpIOwM','9514208dDZHxB','defineProperty','stack','Source\x20Currency:','\x20->\x20','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','createPayment','application/json','Error\x20Message:','entries','Target\x20Currency:','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','text','tx_urls','921102JPyADo','URL:','Status:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','logWhiteDomainRequest','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','source_amount','__esModule','2144442nMlQtq','GET','data','FAILED','HTTP\x20','toString','21168EFXEEG','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Plisio\x20API\x20error:\x20','‚úÖ\x20Processed\x20tx_urls:','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','Full\x20URL\x20(without\x20API\x20key):','Error\x20stack:','Response\x20Time:','string','email','now','https://api.trapay.uk/api/webhooks/gateway/plisio','Failed\x20to\x20parse\x20JSON\x20response:',',\x20body:\x20','logWhiteDomainError','Parameters:','txn_id','TesSoft\x20Payment\x20System/1.0','https://api.plisio.net/api/v1/operations/','(fiat\x20for\x20merchant)','‚úÖ\x20URL\x20','expired','10tiYUBE','PAID','Failed\x20to\x20create\x20Plisio\x20payment:\x20','isArray','26856OWYtKN','PROCESSING','append','parse','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','forEach','PlisioService','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','statusText','JSON\x20Parse\x20Error:\x20','logWhiteDomainResponse','source_currency','===\x20PLISIO\x20SUCCESS\x20===','success','Response\x20data:','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','amount','currency','27967644vaGNJZ','fromEntries','env','1065634FKdSNI','/invoices/new','map','cancelled','message','warn','plisio_direct','toLowerCase','loggerService','/operations/','log','Response\x20Body:','Unknown\x20error\x20from\x20Plisio\x20API','error','json','../loggerService','Parsed\x20Result:','üîó\x20Formatted\x20URL:\x20','PENDING','apiKey','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','\x20is\x20valid:\x20','completed','Unknown\x20error','Status\x20Text:','replace','name','Plisio\x20payment\x20verification\x20error:','mismatch','Error\x20message:','https://api.plisio.net/api/v1/invoices/new','invoice_total_sum','EXPIRED','new','HTTP\x20error!\x20status:\x20','status','processWebhook','HIDDEN'];a49_0x57d7=function(){return _0x3d0b87;};return a49_0x57d7();}const loggerService_1=require(a49_0x5d9882(0x108));class PlisioService{constructor(){const _0xe75688=a49_0x5d9882;this[_0xe75688(0x120)]=_0xe75688(0x117),this[_0xe75688(0x10c)]=process[_0xe75688(0xf8)]['PLISIO_API_KEY']||'',!this['apiKey']?console[_0xe75688(0xfe)](_0xe75688(0xb3)):console[_0xe75688(0x103)](_0xe75688(0xf3));}async[a49_0x5d9882(0xb4)](_0xaaf0ea){const _0x34bc0d=a49_0x5d9882,{orderId:_0x45c811,amount:_0x410463,currency:_0x45fdf8,productName:_0xdf60aa,description:_0x8b6c25,successUrl:_0x50616d,failUrl:_0x55f192,customerEmail:_0x5e1c91,customerName:_0x4c834e,isSourceCurrency:_0x213a36,sourceCurrency:_0x341bb0}=_0xaaf0ea;if(!this[_0x34bc0d(0x10c)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x22e8b1=new URLSearchParams({'api_key':this[_0x34bc0d(0x10c)],'order_number':_0x45c811,'order_name':_0xdf60aa,'description':_0x8b6c25,'success_url':_0x50616d,'fail_url':_0x55f192,'callback_url':_0x34bc0d(0xd5)});_0x341bb0?(_0x22e8b1[_0x34bc0d(0xe6)]('currency',_0x341bb0),_0x22e8b1['append'](_0x34bc0d(0xef),_0x45fdf8),_0x22e8b1[_0x34bc0d(0xe6)](_0x34bc0d(0xc2),_0x410463['toString']())):(_0x22e8b1['append'](_0x34bc0d(0xf5),_0x45fdf8),_0x22e8b1[_0x34bc0d(0xe6)](_0x34bc0d(0xf4),_0x410463[_0x34bc0d(0xc9)]()));_0x5e1c91&&_0x22e8b1[_0x34bc0d(0xe6)](_0x34bc0d(0xd3),_0x5e1c91);_0x4c834e&&_0x22e8b1[_0x34bc0d(0xe6)](_0x34bc0d(0x113),_0x4c834e);const _0x19e34a=this['apiUrl']+'?'+_0x22e8b1['toString'](),_0x876714=Date['now']();try{console[_0x34bc0d(0x103)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x34bc0d(0x103)](_0x34bc0d(0xbd),this['apiUrl']),console[_0x34bc0d(0x103)](_0x34bc0d(0xd9),Object['fromEntries'](_0x22e8b1[_0x34bc0d(0xb7)]())),console[_0x34bc0d(0x103)](_0x34bc0d(0xcf),_0x19e34a['replace'](this[_0x34bc0d(0x10c)],_0x34bc0d(0x11e))),loggerService_1[_0x34bc0d(0x101)][_0x34bc0d(0xc0)]('plisio_direct',_0x34bc0d(0xfa),_0x34bc0d(0xc5),Object[_0x34bc0d(0xf7)](_0x22e8b1[_0x34bc0d(0xb7)]()));const _0x3ad13a=await fetch(_0x19e34a,{'method':_0x34bc0d(0xc5),'headers':{'Accept':_0x34bc0d(0xb5),'User-Agent':_0x34bc0d(0xdb)}}),_0x50d553=Date[_0x34bc0d(0xd4)]()-_0x876714;console[_0x34bc0d(0x103)](_0x34bc0d(0xb2)),console[_0x34bc0d(0x103)](_0x34bc0d(0xbe),_0x3ad13a['status']),console['log'](_0x34bc0d(0x111),_0x3ad13a[_0x34bc0d(0xec)]),console[_0x34bc0d(0x103)](_0x34bc0d(0xd1),_0x50d553+'ms');const _0x3251f7=await _0x3ad13a['text']();console[_0x34bc0d(0x103)]('Raw\x20Response\x20Body:',_0x3251f7);if(!_0x3ad13a['ok']){console['error']('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x34bc0d(0x106)]('HTTP\x20Status:',_0x3ad13a[_0x34bc0d(0x11c)]),console[_0x34bc0d(0x106)](_0x34bc0d(0x104),_0x3251f7),loggerService_1[_0x34bc0d(0x101)][_0x34bc0d(0xee)](_0x34bc0d(0xff),_0x34bc0d(0xfa),_0x3ad13a[_0x34bc0d(0x11c)],_0x3251f7,_0x50d553),loggerService_1[_0x34bc0d(0x101)][_0x34bc0d(0xd8)](_0x34bc0d(0xff),_0x34bc0d(0xfa),_0x34bc0d(0xc8)+_0x3ad13a[_0x34bc0d(0x11c)]+':\x20'+_0x3251f7);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3ad13a[_0x34bc0d(0x11c)]+_0x34bc0d(0xd7)+_0x3251f7);}let _0x21b8eb;try{_0x21b8eb=JSON[_0x34bc0d(0xe7)](_0x3251f7);}catch(_0x405dc6){console[_0x34bc0d(0x106)](_0x34bc0d(0xd6),_0x405dc6),loggerService_1[_0x34bc0d(0x101)][_0x34bc0d(0xd8)](_0x34bc0d(0xff),_0x34bc0d(0xfa),_0x34bc0d(0xed)+_0x405dc6);throw new Error(_0x34bc0d(0xc1)+_0x3251f7);}console[_0x34bc0d(0x103)](_0x34bc0d(0xb1)),console[_0x34bc0d(0x103)](_0x34bc0d(0x109),JSON['stringify'](_0x21b8eb,null,0x2)),loggerService_1[_0x34bc0d(0x101)][_0x34bc0d(0xee)](_0x34bc0d(0xff),_0x34bc0d(0xfa),_0x3ad13a[_0x34bc0d(0x11c)],_0x21b8eb,_0x50d553);if(_0x21b8eb[_0x34bc0d(0x11c)]!=='success'){const _0x373e50=_0x21b8eb['message']||_0x21b8eb[_0x34bc0d(0x106)]||_0x34bc0d(0x105);console['error'](_0x34bc0d(0xeb)),console[_0x34bc0d(0x106)](_0x34bc0d(0xb6),_0x373e50),loggerService_1['loggerService'][_0x34bc0d(0xd8)]('plisio_direct','/invoices/new','Business\x20Error:\x20'+_0x373e50);throw new Error(_0x34bc0d(0xcc)+_0x373e50);}if(!_0x21b8eb['data']?.[_0x34bc0d(0xda)]||!_0x21b8eb['data']?.[_0x34bc0d(0x11f)]){console['error']('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x34bc0d(0x106)](_0x34bc0d(0xe8)),console[_0x34bc0d(0x106)](_0x34bc0d(0xf2),_0x21b8eb[_0x34bc0d(0xc6)]),loggerService_1['loggerService'][_0x34bc0d(0xd8)](_0x34bc0d(0xff),_0x34bc0d(0xfa),_0x34bc0d(0xbf));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console['log'](_0x34bc0d(0xf0)),console[_0x34bc0d(0x103)]('Transaction\x20ID:',_0x21b8eb[_0x34bc0d(0xc6)]['txn_id']),console['log']('Invoice\x20URL:',_0x21b8eb['data'][_0x34bc0d(0x11f)]),console[_0x34bc0d(0x103)]('Amount:',_0x410463,_0x45fdf8),_0x341bb0&&(console[_0x34bc0d(0x103)](_0x34bc0d(0xaf),_0x341bb0,'(crypto\x20for\x20payment)'),console[_0x34bc0d(0x103)](_0x34bc0d(0xb8),_0x45fdf8,_0x34bc0d(0xdd))),{'gateway_payment_id':_0x21b8eb[_0x34bc0d(0xc6)][_0x34bc0d(0xda)],'payment_url':_0x21b8eb[_0x34bc0d(0xc6)][_0x34bc0d(0x11f)],'invoice_total_sum':_0x21b8eb[_0x34bc0d(0xc6)][_0x34bc0d(0x118)],'qr_code':_0x21b8eb[_0x34bc0d(0xc6)]['qr_code'],'qr_url':_0x21b8eb[_0x34bc0d(0xc6)]['qr_url']};}catch(_0x22476f){console[_0x34bc0d(0x106)](_0x34bc0d(0xb9)),console[_0x34bc0d(0x106)]('Error\x20details:',_0x22476f),loggerService_1['loggerService'][_0x34bc0d(0xd8)](_0x34bc0d(0xff),_0x34bc0d(0xfa),_0x22476f);if(_0x22476f instanceof Error){console[_0x34bc0d(0x106)](_0x34bc0d(0x116),_0x22476f[_0x34bc0d(0xfd)]),console[_0x34bc0d(0x106)](_0x34bc0d(0xd0),_0x22476f[_0x34bc0d(0x124)]);throw new Error(_0x34bc0d(0xe2)+_0x22476f[_0x34bc0d(0xfd)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async['verifyPayment'](_0x46cc13){const _0x4c5e4e=a49_0x5d9882,_0x4ec2d4=Date[_0x4c5e4e(0xd4)]();try{if(!this[_0x4c5e4e(0x10c)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x57dc71=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x46cc13}),_0x1a5cef=_0x4c5e4e(0xdc)+_0x46cc13+'?'+_0x57dc71[_0x4c5e4e(0xc9)]();loggerService_1[_0x4c5e4e(0x101)][_0x4c5e4e(0xc0)](_0x4c5e4e(0xff),_0x4c5e4e(0x102)+_0x46cc13,_0x4c5e4e(0xc5),Object['fromEntries'](_0x57dc71[_0x4c5e4e(0xb7)]()));const _0xf7466b=await fetch(_0x1a5cef,{'method':_0x4c5e4e(0xc5),'headers':{'Accept':'application/json','User-Agent':_0x4c5e4e(0xdb)}}),_0xe26c4f=Date['now']()-_0x4ec2d4;if(!_0xf7466b['ok']){const _0x23902b=await _0xf7466b[_0x4c5e4e(0xba)]();loggerService_1[_0x4c5e4e(0x101)][_0x4c5e4e(0xee)](_0x4c5e4e(0xff),'/operations/'+_0x46cc13,_0xf7466b[_0x4c5e4e(0x11c)],_0x23902b,_0xe26c4f);throw new Error(_0x4c5e4e(0x11b)+_0xf7466b['status']);}const _0x53c6f3=await _0xf7466b[_0x4c5e4e(0x107)]();loggerService_1[_0x4c5e4e(0x101)][_0x4c5e4e(0xee)]('plisio_direct','/operations/'+_0x46cc13,_0xf7466b[_0x4c5e4e(0x11c)],_0x53c6f3,_0xe26c4f);if(_0x53c6f3[_0x4c5e4e(0x11c)]!==_0x4c5e4e(0xf1)){loggerService_1[_0x4c5e4e(0x101)][_0x4c5e4e(0xd8)](_0x4c5e4e(0xff),_0x4c5e4e(0x102)+_0x46cc13,'Plisio\x20API\x20error:\x20'+(_0x53c6f3['message']||_0x53c6f3[_0x4c5e4e(0x106)]||_0x4c5e4e(0x110)));throw new Error(_0x4c5e4e(0xcc)+(_0x53c6f3[_0x4c5e4e(0xfd)]||_0x53c6f3[_0x4c5e4e(0x106)]||_0x4c5e4e(0x110)));}let _0x59b544=_0x4c5e4e(0x10b);return{'status':_0x59b544};}catch(_0x17a1fc){console[_0x4c5e4e(0x106)](_0x4c5e4e(0x114),_0x17a1fc),loggerService_1['loggerService'][_0x4c5e4e(0xd8)](_0x4c5e4e(0xff),_0x4c5e4e(0x102)+_0x46cc13,_0x17a1fc);throw new Error(_0x4c5e4e(0x10d)+(_0x17a1fc instanceof Error?_0x17a1fc[_0x4c5e4e(0xfd)]:_0x4c5e4e(0x110)));}}async[a49_0x5d9882(0x11d)](_0x2fb3fc){const _0x177a7c=a49_0x5d9882;console['log']('Processing\x20Plisio\x20webhook:',_0x2fb3fc);let _0x535073='PENDING';switch(_0x2fb3fc['status']?.[_0x177a7c(0x100)]()){case _0x177a7c(0x10f):case _0x177a7c(0x115):_0x535073=_0x177a7c(0xe1);break;case _0x177a7c(0xdf):_0x535073=_0x177a7c(0x119);break;case _0x177a7c(0x106):case _0x177a7c(0xfc):_0x535073=_0x177a7c(0xc7);break;case _0x177a7c(0x11a):_0x535073=_0x177a7c(0x10b);break;case'pending':_0x535073=_0x177a7c(0xe5);break;default:_0x535073=_0x177a7c(0x10b);break;}let _0x5586bc;if(_0x2fb3fc['tx_urls'])try{console[_0x177a7c(0x103)](_0x177a7c(0xcb),_0x2fb3fc['tx_urls']);let _0x5c87bc;if(typeof _0x2fb3fc[_0x177a7c(0xbb)]===_0x177a7c(0xd2))_0x5c87bc=JSON['parse'](_0x2fb3fc[_0x177a7c(0xbb)]);else Array[_0x177a7c(0xe3)](_0x2fb3fc[_0x177a7c(0xbb)])?_0x5c87bc=_0x2fb3fc[_0x177a7c(0xbb)]:_0x5c87bc=[];_0x5586bc=_0x5c87bc[_0x177a7c(0xfb)](_0x511fe1=>{const _0x27e9e3=_0x177a7c,_0x24cc32=_0x511fe1[_0x27e9e3(0x112)](/\\/g,'');return console['log'](_0x27e9e3(0x10a)+_0x511fe1+_0x27e9e3(0xb0)+_0x24cc32),_0x24cc32;}),console[_0x177a7c(0x103)](_0x177a7c(0xcd),_0x5586bc),_0x5586bc[_0x177a7c(0xe9)]((_0x4b7b84,_0x260a92)=>{const _0x44a68d=_0x177a7c;try{new URL(_0x4b7b84),console['log'](_0x44a68d(0xde)+(_0x260a92+0x1)+_0x44a68d(0x10e)+_0x4b7b84);}catch(_0x52dae8){console[_0x44a68d(0x106)]('‚ùå\x20URL\x20'+(_0x260a92+0x1)+'\x20is\x20invalid:\x20'+_0x4b7b84,_0x52dae8);}});}catch(_0x2994df){console[_0x177a7c(0x106)](_0x177a7c(0xce),_0x2994df),console[_0x177a7c(0x106)]('Raw\x20tx_urls\x20data:',_0x2fb3fc[_0x177a7c(0xbb)]),_0x5586bc=undefined;}return{'paymentId':_0x2fb3fc['order_number']||'','status':_0x535073,'amount':_0x2fb3fc[_0x177a7c(0xf4)],'currency':_0x2fb3fc[_0x177a7c(0xf5)],'txUrls':_0x5586bc};}}exports['PlisioService']=PlisioService;