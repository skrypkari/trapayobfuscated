'use strict';const a44_0x58c44d=a44_0x179b;(function(_0x1e9e0d,_0x22455b){const _0x25d747=a44_0x179b,_0x1bf7c2=_0x1e9e0d();while(!![]){try{const _0x19cbc0=-parseInt(_0x25d747(0xef))/0x1*(parseInt(_0x25d747(0xc8))/0x2)+parseInt(_0x25d747(0xb4))/0x3*(parseInt(_0x25d747(0x9b))/0x4)+-parseInt(_0x25d747(0xed))/0x5+parseInt(_0x25d747(0xbb))/0x6+parseInt(_0x25d747(0xc9))/0x7*(parseInt(_0x25d747(0x9e))/0x8)+parseInt(_0x25d747(0x83))/0x9+-parseInt(_0x25d747(0xe1))/0xa;if(_0x19cbc0===_0x22455b)break;else _0x1bf7c2['push'](_0x1bf7c2['shift']());}catch(_0x348cc6){_0x1bf7c2['push'](_0x1bf7c2['shift']());}}}(a44_0x34e7,0xb89f7));Object[a44_0x58c44d(0xa8)](exports,a44_0x58c44d(0xac),{'value':!![]}),exports[a44_0x58c44d(0x8d)]=void 0x0;const loggerService_1=require(a44_0x58c44d(0xbe));class PlisioService{constructor(){const _0xea5033=a44_0x58c44d;this[_0xea5033(0xd2)]=_0xea5033(0xd7),this['apiKey']=process['env'][_0xea5033(0x9a)]||'',!this['apiKey']?console[_0xea5033(0xcf)](_0xea5033(0xda)):console['log'](_0xea5033(0xc2));}async[a44_0x58c44d(0xd1)](_0x198b45){const _0x2fe187=a44_0x58c44d,{orderId:_0x566a37,amount:_0x803159,currency:_0x42a1f8,productName:_0x5a1d0f,description:_0x5d7509,successUrl:_0x489645,failUrl:_0x3ce242,customerEmail:_0x54edbd,customerName:_0x62c165,isSourceCurrency:_0x20e983,sourceCurrency:_0x4364c7}=_0x198b45;if(!this['apiKey'])throw new Error(_0x2fe187(0x8b));const _0x6a013d=new URLSearchParams({'api_key':this[_0x2fe187(0x8f)],'order_number':_0x566a37,'order_name':_0x5a1d0f,'description':_0x5d7509,'success_url':_0x489645,'fail_url':_0x3ce242,'callback_url':'https://apitest.trapay.uk/api/webhooks/gateway/plisio'});_0x4364c7?(_0x6a013d['append'](_0x2fe187(0xa7),_0x4364c7),_0x6a013d[_0x2fe187(0x86)](_0x2fe187(0xa4),_0x42a1f8),_0x6a013d[_0x2fe187(0x86)]('source_amount',_0x803159[_0x2fe187(0xd3)]())):(_0x6a013d[_0x2fe187(0x86)](_0x2fe187(0xa7),_0x42a1f8),_0x6a013d[_0x2fe187(0x86)](_0x2fe187(0x90),_0x803159[_0x2fe187(0xd3)]()));_0x54edbd&&_0x6a013d[_0x2fe187(0x86)](_0x2fe187(0x9d),_0x54edbd);_0x62c165&&_0x6a013d[_0x2fe187(0x86)](_0x2fe187(0xa0),_0x62c165);const _0x1c5eaf=this[_0x2fe187(0xd2)]+'?'+_0x6a013d[_0x2fe187(0xd3)](),_0x39eeb8=Date[_0x2fe187(0x89)]();try{console['log'](_0x2fe187(0x88)),console[_0x2fe187(0xb2)]('URL:',this[_0x2fe187(0xd2)]),console['log']('Parameters:',Object[_0x2fe187(0xb8)](_0x6a013d[_0x2fe187(0x95)]())),console[_0x2fe187(0xb2)](_0x2fe187(0xab),_0x1c5eaf['replace'](this[_0x2fe187(0x8f)],'HIDDEN')),loggerService_1[_0x2fe187(0xd6)][_0x2fe187(0xb6)](_0x2fe187(0xba),_0x2fe187(0xca),'GET',Object[_0x2fe187(0xb8)](_0x6a013d[_0x2fe187(0x95)]()));const _0x12d938=await fetch(_0x1c5eaf,{'method':_0x2fe187(0xe3),'headers':{'Accept':'application/json','User-Agent':_0x2fe187(0x93)}}),_0x55e9dd=Date[_0x2fe187(0x89)]()-_0x39eeb8;console[_0x2fe187(0xb2)](_0x2fe187(0xe4)),console['log'](_0x2fe187(0x84),_0x12d938[_0x2fe187(0xd9)]),console[_0x2fe187(0xb2)]('Status\x20Text:',_0x12d938['statusText']),console['log'](_0x2fe187(0xc7),_0x55e9dd+'ms');const _0x4590c3=await _0x12d938[_0x2fe187(0xf0)]();console[_0x2fe187(0xb2)](_0x2fe187(0xa5),_0x4590c3);if(!_0x12d938['ok']){console[_0x2fe187(0xe8)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x12d938[_0x2fe187(0xd9)]),console[_0x2fe187(0xe8)](_0x2fe187(0x94),_0x4590c3),loggerService_1[_0x2fe187(0xd6)][_0x2fe187(0xc6)](_0x2fe187(0xba),_0x2fe187(0xca),_0x12d938[_0x2fe187(0xd9)],_0x4590c3,_0x55e9dd),loggerService_1[_0x2fe187(0xd6)][_0x2fe187(0xb5)](_0x2fe187(0xba),'/invoices/new','HTTP\x20'+_0x12d938[_0x2fe187(0xd9)]+':\x20'+_0x4590c3);throw new Error(_0x2fe187(0xdc)+_0x12d938[_0x2fe187(0xd9)]+_0x2fe187(0xd0)+_0x4590c3);}let _0x3f60f1;try{_0x3f60f1=JSON[_0x2fe187(0x8a)](_0x4590c3);}catch(_0x5469e5){console[_0x2fe187(0xe8)](_0x2fe187(0xb7),_0x5469e5),loggerService_1[_0x2fe187(0xd6)][_0x2fe187(0xb5)]('plisio_direct','/invoices/new',_0x2fe187(0x97)+_0x5469e5);throw new Error(_0x2fe187(0xd5)+_0x4590c3);}console['log'](_0x2fe187(0xcb)),console[_0x2fe187(0xb2)](_0x2fe187(0x85),JSON[_0x2fe187(0x98)](_0x3f60f1,null,0x2)),loggerService_1[_0x2fe187(0xd6)][_0x2fe187(0xc6)]('plisio_direct',_0x2fe187(0xca),_0x12d938[_0x2fe187(0xd9)],_0x3f60f1,_0x55e9dd);if(_0x3f60f1['status']!==_0x2fe187(0x87)){const _0x44e955=_0x3f60f1['message']||_0x3f60f1[_0x2fe187(0xe8)]||_0x2fe187(0xdb);console[_0x2fe187(0xe8)](_0x2fe187(0x8e)),console['error']('Error\x20Message:',_0x44e955),loggerService_1[_0x2fe187(0xd6)]['logWhiteDomainError'](_0x2fe187(0xba),_0x2fe187(0xca),_0x2fe187(0xaa)+_0x44e955);throw new Error(_0x2fe187(0xe0)+_0x44e955);}if(!_0x3f60f1[_0x2fe187(0xf1)]?.['txn_id']||!_0x3f60f1[_0x2fe187(0xf1)]?.[_0x2fe187(0xf2)]){console[_0x2fe187(0xe8)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2fe187(0xe8)](_0x2fe187(0xeb)),console['error']('Response\x20data:',_0x3f60f1[_0x2fe187(0xf1)]),loggerService_1['loggerService'][_0x2fe187(0xb5)](_0x2fe187(0xba),_0x2fe187(0xca),_0x2fe187(0xbc));throw new Error(_0x2fe187(0x9c));}return console['log'](_0x2fe187(0xde)),console['log'](_0x2fe187(0x92),_0x3f60f1[_0x2fe187(0xf1)]['txn_id']),console[_0x2fe187(0xb2)]('Invoice\x20URL:',_0x3f60f1[_0x2fe187(0xf1)][_0x2fe187(0xf2)]),console['log']('Amount:',_0x803159,_0x42a1f8),_0x4364c7&&(console['log'](_0x2fe187(0xb9),_0x4364c7,_0x2fe187(0xa9)),console['log'](_0x2fe187(0xc5),_0x42a1f8,_0x2fe187(0x9f))),{'gateway_payment_id':_0x3f60f1[_0x2fe187(0xf1)]['txn_id'],'payment_url':_0x3f60f1['data']['invoice_url'],'invoice_total_sum':_0x3f60f1[_0x2fe187(0xf1)]['invoice_total_sum'],'qr_code':_0x3f60f1[_0x2fe187(0xf1)]['qr_code'],'qr_url':_0x3f60f1[_0x2fe187(0xf1)][_0x2fe187(0xaf)]};}catch(_0x2c4125){console[_0x2fe187(0xe8)](_0x2fe187(0xa3)),console[_0x2fe187(0xe8)](_0x2fe187(0xc1),_0x2c4125),loggerService_1[_0x2fe187(0xd6)][_0x2fe187(0xb5)](_0x2fe187(0xba),'/invoices/new',_0x2c4125);if(_0x2c4125 instanceof Error){console[_0x2fe187(0xe8)]('Error\x20message:',_0x2c4125['message']),console[_0x2fe187(0xe8)]('Error\x20stack:',_0x2c4125['stack']);throw new Error(_0x2fe187(0xe6)+_0x2c4125[_0x2fe187(0xa1)]);}throw new Error(_0x2fe187(0xc3));}}async[a44_0x58c44d(0xbd)](_0x5a1838){const _0x5026a8=a44_0x58c44d,_0x40c0eb=Date[_0x5026a8(0x89)]();try{if(!this[_0x5026a8(0x8f)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x362e5e=new URLSearchParams({'api_key':this[_0x5026a8(0x8f)],'txn_id':_0x5a1838}),_0x56d548=_0x5026a8(0xe9)+_0x5a1838+'?'+_0x362e5e[_0x5026a8(0xd3)]();loggerService_1['loggerService'][_0x5026a8(0xb6)](_0x5026a8(0xba),_0x5026a8(0x91)+_0x5a1838,_0x5026a8(0xe3),Object['fromEntries'](_0x362e5e[_0x5026a8(0x95)]()));const _0x295ef1=await fetch(_0x56d548,{'method':'GET','headers':{'Accept':_0x5026a8(0x99),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x2eb02c=Date[_0x5026a8(0x89)]()-_0x40c0eb;if(!_0x295ef1['ok']){const _0x3837cd=await _0x295ef1[_0x5026a8(0xf0)]();loggerService_1[_0x5026a8(0xd6)]['logWhiteDomainResponse'](_0x5026a8(0xba),'/operations/'+_0x5a1838,_0x295ef1[_0x5026a8(0xd9)],_0x3837cd,_0x2eb02c);throw new Error(_0x5026a8(0xdc)+_0x295ef1[_0x5026a8(0xd9)]);}const _0x28f7e6=await _0x295ef1['json']();loggerService_1['loggerService'][_0x5026a8(0xc6)](_0x5026a8(0xba),_0x5026a8(0x91)+_0x5a1838,_0x295ef1[_0x5026a8(0xd9)],_0x28f7e6,_0x2eb02c);if(_0x28f7e6[_0x5026a8(0xd9)]!=='success'){loggerService_1['loggerService'][_0x5026a8(0xb5)]('plisio_direct',_0x5026a8(0x91)+_0x5a1838,'Plisio\x20API\x20error:\x20'+(_0x28f7e6['message']||_0x28f7e6[_0x5026a8(0xe8)]||_0x5026a8(0x96)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x28f7e6[_0x5026a8(0xa1)]||_0x28f7e6[_0x5026a8(0xe8)]||_0x5026a8(0x96)));}let _0x27aa30=_0x5026a8(0xe5);return{'status':_0x27aa30};}catch(_0x29114e){console[_0x5026a8(0xe8)](_0x5026a8(0xc4),_0x29114e),loggerService_1[_0x5026a8(0xd6)]['logWhiteDomainError'](_0x5026a8(0xba),_0x5026a8(0x91)+_0x5a1838,_0x29114e);throw new Error(_0x5026a8(0xb3)+(_0x29114e instanceof Error?_0x29114e[_0x5026a8(0xa1)]:_0x5026a8(0x96)));}}async[a44_0x58c44d(0xc0)](_0x5013ea){const _0x468df9=a44_0x58c44d;console['log'](_0x468df9(0xb1),_0x5013ea);let _0x40a522=_0x468df9(0xe5);switch(_0x5013ea[_0x468df9(0xd9)]?.[_0x468df9(0xb0)]()){case _0x468df9(0xd8):case'mismatch':_0x40a522=_0x468df9(0xae);break;case _0x468df9(0xcc):_0x40a522=_0x468df9(0xdd);break;case'error':case _0x468df9(0xbf):_0x40a522=_0x468df9(0xee);break;case _0x468df9(0xa2):case _0x468df9(0xa6):default:_0x40a522=_0x468df9(0xe5);break;}let _0x55fbc5;if(_0x5013ea[_0x468df9(0xec)])try{console[_0x468df9(0xb2)](_0x468df9(0xd4),_0x5013ea[_0x468df9(0xec)]);let _0x453a43;if(typeof _0x5013ea[_0x468df9(0xec)]==='string')_0x453a43=JSON['parse'](_0x5013ea[_0x468df9(0xec)]);else Array[_0x468df9(0xe2)](_0x5013ea[_0x468df9(0xec)])?_0x453a43=_0x5013ea['tx_urls']:_0x453a43=[];_0x55fbc5=_0x453a43[_0x468df9(0xcd)](_0x3caa80=>{const _0x3dc2ba=_0x468df9,_0x897660=_0x3caa80[_0x3dc2ba(0xe7)](/\\/g,'');return console[_0x3dc2ba(0xb2)](_0x3dc2ba(0xea)+_0x3caa80+'\x20->\x20'+_0x897660),_0x897660;}),console[_0x468df9(0xb2)](_0x468df9(0xdf),_0x55fbc5),_0x55fbc5['forEach']((_0x21a0a5,_0x2d09ee)=>{const _0x5b48b7=_0x468df9;try{new URL(_0x21a0a5),console['log'](_0x5b48b7(0xce)+(_0x2d09ee+0x1)+'\x20is\x20valid:\x20'+_0x21a0a5);}catch(_0x99d684){console[_0x5b48b7(0xe8)]('‚ùå\x20URL\x20'+(_0x2d09ee+0x1)+'\x20is\x20invalid:\x20'+_0x21a0a5,_0x99d684);}});}catch(_0x20a785){console[_0x468df9(0xe8)](_0x468df9(0xad),_0x20a785),console[_0x468df9(0xe8)](_0x468df9(0x8c),_0x5013ea[_0x468df9(0xec)]),_0x55fbc5=undefined;}return{'paymentId':_0x5013ea['order_number']||'','status':_0x40a522,'amount':_0x5013ea[_0x468df9(0x90)],'currency':_0x5013ea['currency'],'txUrls':_0x55fbc5};}}function a44_0x34e7(){const _0xbd064a=['isArray','GET','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','PENDING','Failed\x20to\x20create\x20Plisio\x20payment:\x20','replace','error','https://api.plisio.net/api/v1/operations/','üîó\x20Formatted\x20URL:\x20','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','tx_urls','4970985iLXXyM','FAILED','1hxBNFv','text','data','invoice_url','11009529TEFFTB','Status:','Parsed\x20Result:','append','success','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','now','parse','Plisio\x20API\x20key\x20is\x20not\x20configured','Raw\x20tx_urls\x20data:','PlisioService','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','apiKey','amount','/operations/','Transaction\x20ID:','TesSoft\x20Payment\x20System/1.0','Response\x20Body:','entries','Unknown\x20error','JSON\x20Parse\x20Error:\x20','stringify','application/json','PLISIO_API_KEY','28HEbUQH','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','email','816ydEvcL','(fiat\x20for\x20merchant)','name','message','new','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','source_currency','Raw\x20Response\x20Body:','pending','currency','defineProperty','(crypto\x20for\x20payment)','Business\x20Error:\x20','Full\x20URL\x20(without\x20API\x20key):','__esModule','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','PAID','qr_url','toLowerCase','Processing\x20Plisio\x20webhook:','log','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','518991EaHfKX','logWhiteDomainError','logWhiteDomainRequest','Failed\x20to\x20parse\x20JSON\x20response:','fromEntries','Source\x20Currency:','plisio_direct','5147358SMCONc','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','verifyPayment','../loggerService','cancelled','processWebhook','Error\x20details:','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Plisio\x20payment\x20verification\x20error:','Target\x20Currency:','logWhiteDomainResponse','Response\x20Time:','2856092yXQmGL','59269bNPSpi','/invoices/new','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','expired','map','‚úÖ\x20URL\x20','warn',',\x20body:\x20','createPayment','apiUrl','toString','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','loggerService','https://api.plisio.net/api/v1/invoices/new','completed','status','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Unknown\x20error\x20from\x20Plisio\x20API','HTTP\x20error!\x20status:\x20','EXPIRED','===\x20PLISIO\x20SUCCESS\x20===','‚úÖ\x20Processed\x20tx_urls:','Plisio\x20API\x20error:\x20','9773290gZKmjF'];a44_0x34e7=function(){return _0xbd064a;};return a44_0x34e7();}function a44_0x179b(_0x13579c,_0x125f22){const _0x34e7a8=a44_0x34e7();return a44_0x179b=function(_0x179bee,_0x5dbb7c){_0x179bee=_0x179bee-0x83;let _0x51c78a=_0x34e7a8[_0x179bee];return _0x51c78a;},a44_0x179b(_0x13579c,_0x125f22);}exports[a44_0x58c44d(0x8d)]=PlisioService;