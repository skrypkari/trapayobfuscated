'use strict';const a68_0x1d8450=a68_0x1514;(function(_0x3a2443,_0x4fa554){const _0x431f5e=a68_0x1514,_0x204575=_0x3a2443();while(!![]){try{const _0x5ece27=-parseInt(_0x431f5e(0x238))/0x1+-parseInt(_0x431f5e(0x1ed))/0x2*(parseInt(_0x431f5e(0x211))/0x3)+parseInt(_0x431f5e(0x1df))/0x4*(-parseInt(_0x431f5e(0x219))/0x5)+parseInt(_0x431f5e(0x240))/0x6*(-parseInt(_0x431f5e(0x20b))/0x7)+-parseInt(_0x431f5e(0x239))/0x8+-parseInt(_0x431f5e(0x221))/0x9*(-parseInt(_0x431f5e(0x208))/0xa)+parseInt(_0x431f5e(0x21d))/0xb;if(_0x5ece27===_0x4fa554)break;else _0x204575['push'](_0x204575['shift']());}catch(_0x1c3d9a){_0x204575['push'](_0x204575['shift']());}}}(a68_0x383e,0x46613));function a68_0x1514(_0x47ed1b,_0x47fc11){_0x47ed1b=_0x47ed1b-0x1d5;const _0x383e74=a68_0x383e();let _0x1514bf=_0x383e74[_0x47ed1b];return _0x1514bf;}Object[a68_0x1d8450(0x22a)](exports,a68_0x1d8450(0x1e7),{'value':!![]}),exports[a68_0x1d8450(0x1f4)]=void 0x0;function a68_0x383e(){const _0x48b604=['Raw\x20tx_urls\x20data:','PAID','70254qzQkdJ','Full\x20URL\x20(without\x20API\x20key):','source_currency','replace','Raw\x20Response\x20Body:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','tx_urls','error','log','Response\x20data:','loggerService','source_amount','Processing\x20Plisio\x20webhook:','toString','currency','Payment\x20System/1.0','success','\x20is\x20invalid:\x20','/invoices/new','Failed\x20to\x20parse\x20JSON\x20response:','cancelled','284NPYiYi','Unknown\x20error','Response\x20Body:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','üîó\x20Formatted\x20URL:\x20','logWhiteDomainRequest','expired','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','__esModule','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','GET','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','isArray','data','36978BDTfRe','text','qr_code','invoice_url','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','(fiat\x20for\x20merchant)','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','PlisioService','/operations/','‚úÖ\x20Processed\x20tx_urls:','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','Parsed\x20Result:','status','processWebhook','Parameters:','entries','HTTP\x20error!\x20status:\x20','apiUrl','Plisio\x20payment\x20verification\x20error:','Failed\x20to\x20create\x20Plisio\x20payment:\x20','application/json','forEach','===\x20PLISIO\x20SUCCESS\x20===','now','Amount:','invoice_total_sum','toLowerCase','40iusAzn','message','qr_url','21mSPmsD','PENDING','warn','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','completed','Source\x20Currency:','54JNNuLG','createPayment','===\x20PLISIO\x20API\x20ERROR\x20===','parse','URL:','Unknown\x20error\x20from\x20Plisio\x20API','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Plisio\x20API\x20error:\x20','9880lXsOvO','https://api.plisio.net/api/v1/operations/','Error\x20message:','name','11387288wCCZbZ','order_number','\x20->\x20','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','639756GhfLxV','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','HTTP\x20','apiKey','amount','https://api.trapay.uk/api/webhooks/gateway/plisio','Plisio\x20API\x20key\x20is\x20not\x20configured','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','stringify','defineProperty','FAILED','logWhiteDomainError','Error\x20details:','json','map','verifyPayment','txn_id','PROCESSING','plisio_direct','Response\x20Time:','mismatch','string','Transaction\x20ID:','340056AjDbWA','1463904GsnMkM','Target\x20Currency:','logWhiteDomainResponse','append','EXPIRED'];a68_0x383e=function(){return _0x48b604;};return a68_0x383e();}const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x1ccd7a=a68_0x1d8450;this[_0x1ccd7a(0x1fe)]='https://api.plisio.net/api/v1/invoices/new',this[_0x1ccd7a(0x224)]=process.env.PLISIO_API_KEY||'',!this['apiKey']?console[_0x1ccd7a(0x20d)](_0x1ccd7a(0x228)):console[_0x1ccd7a(0x248)](_0x1ccd7a(0x222));}async[a68_0x1d8450(0x212)](_0x5a5c42){const _0x2216c9=a68_0x1d8450,{orderId:_0x4b2550,amount:_0x5643ae,currency:_0x17e1b7,productName:_0x17621c,description:_0x4adce5,successUrl:_0x6f0ad4,failUrl:_0x447ebf,customerEmail:_0x4befb5,customerName:_0x2d9ac5,isSourceCurrency:_0x2cc894,sourceCurrency:_0x15befc}=_0x5a5c42;if(!this[_0x2216c9(0x224)])throw new Error(_0x2216c9(0x227));const _0x1c1df4=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x4b2550,'order_name':_0x17621c,'description':_0x4adce5,'success_url':_0x6f0ad4,'fail_url':_0x447ebf,'callback_url':_0x2216c9(0x226)});_0x15befc?(_0x1c1df4[_0x2216c9(0x23c)](_0x2216c9(0x1d8),_0x15befc),_0x1c1df4[_0x2216c9(0x23c)](_0x2216c9(0x242),_0x17e1b7),_0x1c1df4['append'](_0x2216c9(0x1d5),_0x5643ae['toString']())):(_0x1c1df4['append'](_0x2216c9(0x1d8),_0x17e1b7),_0x1c1df4[_0x2216c9(0x23c)](_0x2216c9(0x225),_0x5643ae['toString']()));_0x4befb5&&_0x1c1df4['append']('email',_0x4befb5);_0x2d9ac5&&_0x1c1df4[_0x2216c9(0x23c)](_0x2216c9(0x21c),_0x2d9ac5);const _0x3f8b25=this[_0x2216c9(0x1fe)]+'?'+_0x1c1df4['toString'](),_0x32ea29=Date[_0x2216c9(0x204)]();try{console[_0x2216c9(0x248)](_0x2216c9(0x220)),console[_0x2216c9(0x248)](_0x2216c9(0x215),this[_0x2216c9(0x1fe)]),console['log'](_0x2216c9(0x1fb),Object['fromEntries'](_0x1c1df4['entries']())),console['log'](_0x2216c9(0x241),_0x3f8b25[_0x2216c9(0x243)](this[_0x2216c9(0x224)],'HIDDEN')),loggerService_1[_0x2216c9(0x24a)][_0x2216c9(0x1e4)]('plisio_direct',_0x2216c9(0x1dc),_0x2216c9(0x1e9),Object['fromEntries'](_0x1c1df4[_0x2216c9(0x1fc)]()));const _0xa9d6fa=await fetch(_0x3f8b25,{'method':_0x2216c9(0x1e9),'headers':{'Accept':_0x2216c9(0x201),'User-Agent':_0x2216c9(0x1d9)}}),_0x5656f1=Date[_0x2216c9(0x204)]()-_0x32ea29;console['log']('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x2216c9(0x248)]('Status:',_0xa9d6fa[_0x2216c9(0x1f9)]),console[_0x2216c9(0x248)]('Status\x20Text:',_0xa9d6fa['statusText']),console[_0x2216c9(0x248)](_0x2216c9(0x234),_0x5656f1+'ms');const _0x126db2=await _0xa9d6fa['text']();console[_0x2216c9(0x248)](_0x2216c9(0x244),_0x126db2);if(!_0xa9d6fa['ok']){console[_0x2216c9(0x247)](_0x2216c9(0x213)),console[_0x2216c9(0x247)]('HTTP\x20Status:',_0xa9d6fa[_0x2216c9(0x1f9)]),console['error'](_0x2216c9(0x1e1),_0x126db2),loggerService_1['loggerService'][_0x2216c9(0x23b)](_0x2216c9(0x233),'/invoices/new',_0xa9d6fa[_0x2216c9(0x1f9)],_0x126db2,_0x5656f1),loggerService_1['loggerService'][_0x2216c9(0x22c)](_0x2216c9(0x233),'/invoices/new',_0x2216c9(0x223)+_0xa9d6fa[_0x2216c9(0x1f9)]+':\x20'+_0x126db2);throw new Error('HTTP\x20error!\x20status:\x20'+_0xa9d6fa[_0x2216c9(0x1f9)]+',\x20body:\x20'+_0x126db2);}let _0x37b332;try{_0x37b332=JSON[_0x2216c9(0x214)](_0x126db2);}catch(_0x1ffdf3){console[_0x2216c9(0x247)](_0x2216c9(0x1dd),_0x1ffdf3),loggerService_1[_0x2216c9(0x24a)][_0x2216c9(0x22c)]('plisio_direct',_0x2216c9(0x1dc),'JSON\x20Parse\x20Error:\x20'+_0x1ffdf3);throw new Error(_0x2216c9(0x245)+_0x126db2);}console[_0x2216c9(0x248)](_0x2216c9(0x217)),console[_0x2216c9(0x248)](_0x2216c9(0x1f8),JSON[_0x2216c9(0x229)](_0x37b332,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2216c9(0x233),_0x2216c9(0x1dc),_0xa9d6fa[_0x2216c9(0x1f9)],_0x37b332,_0x5656f1);if(_0x37b332['status']!==_0x2216c9(0x1da)){const _0x1343dc=_0x37b332[_0x2216c9(0x209)]||_0x37b332[_0x2216c9(0x247)]||_0x2216c9(0x216);console[_0x2216c9(0x247)](_0x2216c9(0x20e)),console[_0x2216c9(0x247)]('Error\x20Message:',_0x1343dc),loggerService_1[_0x2216c9(0x24a)][_0x2216c9(0x22c)](_0x2216c9(0x233),'/invoices/new','Business\x20Error:\x20'+_0x1343dc);throw new Error(_0x2216c9(0x218)+_0x1343dc);}if(!_0x37b332[_0x2216c9(0x1ec)]?.[_0x2216c9(0x231)]||!_0x37b332['data']?.[_0x2216c9(0x1f0)]){console[_0x2216c9(0x247)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2216c9(0x247)](_0x2216c9(0x1e2)),console[_0x2216c9(0x247)](_0x2216c9(0x249),_0x37b332['data']),loggerService_1[_0x2216c9(0x24a)]['logWhiteDomainError'](_0x2216c9(0x233),_0x2216c9(0x1dc),_0x2216c9(0x1e8));throw new Error(_0x2216c9(0x1f3));}return console[_0x2216c9(0x248)](_0x2216c9(0x203)),console[_0x2216c9(0x248)](_0x2216c9(0x237),_0x37b332[_0x2216c9(0x1ec)][_0x2216c9(0x231)]),console[_0x2216c9(0x248)]('Invoice\x20URL:',_0x37b332['data']['invoice_url']),console[_0x2216c9(0x248)](_0x2216c9(0x205),_0x5643ae,_0x17e1b7),_0x15befc&&(console[_0x2216c9(0x248)](_0x2216c9(0x210),_0x15befc,'(crypto\x20for\x20payment)'),console[_0x2216c9(0x248)](_0x2216c9(0x23a),_0x17e1b7,_0x2216c9(0x1f2))),{'gateway_payment_id':_0x37b332[_0x2216c9(0x1ec)][_0x2216c9(0x231)],'payment_url':_0x37b332[_0x2216c9(0x1ec)][_0x2216c9(0x1f0)],'invoice_total_sum':_0x37b332[_0x2216c9(0x1ec)][_0x2216c9(0x206)],'qr_code':_0x37b332[_0x2216c9(0x1ec)][_0x2216c9(0x1ef)],'qr_url':_0x37b332[_0x2216c9(0x1ec)][_0x2216c9(0x20a)]};}catch(_0x3dc9c0){console[_0x2216c9(0x247)](_0x2216c9(0x1e6)),console[_0x2216c9(0x247)](_0x2216c9(0x22d),_0x3dc9c0),loggerService_1[_0x2216c9(0x24a)][_0x2216c9(0x22c)](_0x2216c9(0x233),_0x2216c9(0x1dc),_0x3dc9c0);if(_0x3dc9c0 instanceof Error){console['error'](_0x2216c9(0x21b),_0x3dc9c0[_0x2216c9(0x209)]),console['error']('Error\x20stack:',_0x3dc9c0['stack']);throw new Error(_0x2216c9(0x200)+_0x3dc9c0[_0x2216c9(0x209)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a68_0x1d8450(0x230)](_0x2e3126){const _0x98d071=a68_0x1d8450,_0x1b6707=Date[_0x98d071(0x204)]();try{if(!this['apiKey'])throw new Error(_0x98d071(0x227));const _0x3ea40b=new URLSearchParams({'api_key':this[_0x98d071(0x224)],'txn_id':_0x2e3126}),_0x1ed214=_0x98d071(0x21a)+_0x2e3126+'?'+_0x3ea40b[_0x98d071(0x1d7)]();loggerService_1[_0x98d071(0x24a)][_0x98d071(0x1e4)](_0x98d071(0x233),_0x98d071(0x1f5)+_0x2e3126,_0x98d071(0x1e9),Object['fromEntries'](_0x3ea40b[_0x98d071(0x1fc)]()));const _0xb4d667=await fetch(_0x1ed214,{'method':'GET','headers':{'Accept':_0x98d071(0x201),'User-Agent':'Payment\x20System/1.0'}}),_0x5b271e=Date['now']()-_0x1b6707;if(!_0xb4d667['ok']){const _0x49b11d=await _0xb4d667[_0x98d071(0x1ee)]();loggerService_1[_0x98d071(0x24a)][_0x98d071(0x23b)](_0x98d071(0x233),_0x98d071(0x1f5)+_0x2e3126,_0xb4d667[_0x98d071(0x1f9)],_0x49b11d,_0x5b271e);throw new Error(_0x98d071(0x1fd)+_0xb4d667[_0x98d071(0x1f9)]);}const _0x39b1eb=await _0xb4d667[_0x98d071(0x22e)]();loggerService_1[_0x98d071(0x24a)][_0x98d071(0x23b)](_0x98d071(0x233),_0x98d071(0x1f5)+_0x2e3126,_0xb4d667[_0x98d071(0x1f9)],_0x39b1eb,_0x5b271e);if(_0x39b1eb[_0x98d071(0x1f9)]!=='success'){loggerService_1[_0x98d071(0x24a)][_0x98d071(0x22c)](_0x98d071(0x233),_0x98d071(0x1f5)+_0x2e3126,_0x98d071(0x218)+(_0x39b1eb[_0x98d071(0x209)]||_0x39b1eb[_0x98d071(0x247)]||_0x98d071(0x1e0)));throw new Error(_0x98d071(0x218)+(_0x39b1eb[_0x98d071(0x209)]||_0x39b1eb[_0x98d071(0x247)]||_0x98d071(0x1e0)));}let _0x2b3f31='PENDING';return{'status':_0x2b3f31};}catch(_0x555ace){console[_0x98d071(0x247)](_0x98d071(0x1ff),_0x555ace),loggerService_1[_0x98d071(0x24a)][_0x98d071(0x22c)]('plisio_direct',_0x98d071(0x1f5)+_0x2e3126,_0x555ace);throw new Error(_0x98d071(0x1ea)+(_0x555ace instanceof Error?_0x555ace[_0x98d071(0x209)]:_0x98d071(0x1e0)));}}async[a68_0x1d8450(0x1fa)](_0x4d1611){const _0x333ce9=a68_0x1d8450;console[_0x333ce9(0x248)](_0x333ce9(0x1d6),_0x4d1611);let _0x4f0ed4=_0x333ce9(0x20c);switch(_0x4d1611[_0x333ce9(0x1f9)]?.[_0x333ce9(0x207)]()){case _0x333ce9(0x20f):case _0x333ce9(0x235):_0x4f0ed4=_0x333ce9(0x23f);break;case _0x333ce9(0x1e5):_0x4f0ed4=_0x333ce9(0x23d);break;case _0x333ce9(0x247):case _0x333ce9(0x1de):_0x4f0ed4=_0x333ce9(0x22b);break;case'new':_0x4f0ed4=_0x333ce9(0x20c);break;case'pending':_0x4f0ed4=_0x333ce9(0x232);break;default:_0x4f0ed4=_0x333ce9(0x20c);break;}let _0x40e06e;if(_0x4d1611[_0x333ce9(0x246)])try{console['log'](_0x333ce9(0x1f1),_0x4d1611[_0x333ce9(0x246)]);let _0x1a8d1e;if(typeof _0x4d1611['tx_urls']===_0x333ce9(0x236))_0x1a8d1e=JSON[_0x333ce9(0x214)](_0x4d1611['tx_urls']);else Array[_0x333ce9(0x1eb)](_0x4d1611[_0x333ce9(0x246)])?_0x1a8d1e=_0x4d1611['tx_urls']:_0x1a8d1e=[];_0x40e06e=_0x1a8d1e[_0x333ce9(0x22f)](_0x4eed2d=>{const _0x101f81=_0x333ce9,_0x1a89a6=_0x4eed2d[_0x101f81(0x243)](/\\/g,'');return console[_0x101f81(0x248)](_0x101f81(0x1e3)+_0x4eed2d+_0x101f81(0x21f)+_0x1a89a6),_0x1a89a6;}),console[_0x333ce9(0x248)](_0x333ce9(0x1f6),_0x40e06e),_0x40e06e[_0x333ce9(0x202)]((_0x5e199e,_0x2e4c30)=>{const _0x47b4fd=_0x333ce9;try{new URL(_0x5e199e),console[_0x47b4fd(0x248)]('‚úÖ\x20URL\x20'+(_0x2e4c30+0x1)+'\x20is\x20valid:\x20'+_0x5e199e);}catch(_0x10ac09){console['error']('‚ùå\x20URL\x20'+(_0x2e4c30+0x1)+_0x47b4fd(0x1db)+_0x5e199e,_0x10ac09);}});}catch(_0x99b55a){console[_0x333ce9(0x247)](_0x333ce9(0x1f7),_0x99b55a),console[_0x333ce9(0x247)](_0x333ce9(0x23e),_0x4d1611[_0x333ce9(0x246)]),_0x40e06e=undefined;}return{'paymentId':_0x4d1611[_0x333ce9(0x21e)]||'','status':_0x4f0ed4,'amount':_0x4d1611[_0x333ce9(0x225)],'currency':_0x4d1611['currency'],'txUrls':_0x40e06e};}}exports['PlisioService']=PlisioService;