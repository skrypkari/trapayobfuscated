'use strict';function a62_0x15ad(_0x5f52ac,_0x404215){_0x5f52ac=_0x5f52ac-0xa0;const _0x258e08=a62_0x258e();let _0x15adde=_0x258e08[_0x5f52ac];return _0x15adde;}function a62_0x258e(){const _0x561cc2=['Error\x20details:','URL:','txn_id','data','currency','fromEntries','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','pending','PlisioService','source_amount','Business\x20Error:\x20','error','https://api.plisio.net/api/v1/operations/','âœ…\x20Processed\x20tx_urls:','HTTP\x20','4075359fCrFDs','replace','Response\x20data:','success','Error\x20message:','ðŸ”—\x20Formatted\x20URL:\x20','Plisio\x20payment\x20verification\x20error:','FAILED','invoice_url','Source\x20Currency:','application/json','expired','\x20is\x20invalid:\x20','apiKey','Failed\x20to\x20parse\x20JSON\x20response:','Unknown\x20error','PROCESSING','âœ…\x20URL\x20','invoice_total_sum','__esModule','createPayment','9065530cdygox','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','768115GHNrMP','now','logWhiteDomainError','PAID','order_number','forEach','Error\x20Message:','/invoices/new','2346larxuh','Target\x20Currency:','name','log','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Response\x20Body:','logWhiteDomainRequest','HTTP\x20Status:','statusText','8UvqrTO','Status\x20Text:','âŒ\x20URL\x20','Processing\x20Plisio\x20webhook:','warn','apiUrl','âŒ\x20Failed\x20to\x20parse\x20tx_urls:','map','Transaction\x20ID:','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','../loggerService','qr_url','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','13881NQDUpV','HIDDEN','GET','Plisio\x20API\x20error:\x20','===\x20PLISIO\x20SUCCESS\x20===','plisio_direct','Invoice\x20URL:','Raw\x20Response\x20Body:','JSON\x20Parse\x20Error:\x20','amount','\x20is\x20valid:\x20','message','(fiat\x20for\x20merchant)','/operations/','12074064VcOBmD','logWhiteDomainResponse','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','ðŸ”—\x20Raw\x20tx_urls\x20from\x20Plisio:','defineProperty','source_currency','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','entries','HTTP\x20error!\x20status:\x20','mismatch','(crypto\x20for\x20payment)','stack','Unknown\x20error\x20from\x20Plisio\x20API','append','tx_urls','status','completed','Plisio\x20API\x20key\x20is\x20not\x20configured','stringify','loggerService','toString','qr_code','toLowerCase','965961KKSPTw','Status:','EXPIRED','cancelled','Parameters:','Payment\x20System/1.0','===\x20PLISIO\x20API\x20ERROR\x20===','12Zzpyxn','âš ï¸\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','email','332941iERsiC','\x20->\x20','PENDING','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PLISIO_API_KEY','env','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','verifyPayment'];a62_0x258e=function(){return _0x561cc2;};return a62_0x258e();}const a62_0x5e54b=a62_0x15ad;(function(_0x4f9ef5,_0x2ddf6f){const _0x34d607=a62_0x15ad,_0x73b90=_0x4f9ef5();while(!![]){try{const _0x174b48=parseInt(_0x34d607(0xb2))/0x1*(-parseInt(_0x34d607(0xf1))/0x2)+parseInt(_0x34d607(0xc9))/0x3+parseInt(_0x34d607(0xae))/0x4*(-parseInt(_0x34d607(0xe0))/0x5)+-parseInt(_0x34d607(0xe8))/0x6*(-parseInt(_0x34d607(0xfe))/0x7)+parseInt(_0x34d607(0x10c))/0x8+-parseInt(_0x34d607(0xa7))/0x9+-parseInt(_0x34d607(0xde))/0xa;if(_0x174b48===_0x2ddf6f)break;else _0x73b90['push'](_0x73b90['shift']());}catch(_0x2059c9){_0x73b90['push'](_0x73b90['shift']());}}}(a62_0x258e,0xcc3c5));Object[a62_0x5e54b(0x110)](exports,a62_0x5e54b(0xdc),{'value':!![]}),exports[a62_0x5e54b(0xc2)]=void 0x0;const loggerService_1=require(a62_0x5e54b(0xfb));class PlisioService{constructor(){const _0x5d417b=a62_0x5e54b;this['apiUrl']='https://api.plisio.net/api/v1/invoices/new',this[_0x5d417b(0xd6)]=process[_0x5d417b(0xb7)][_0x5d417b(0xb6)]||'',!this['apiKey']?console[_0x5d417b(0xf5)](_0x5d417b(0xaf)):console['log']('ðŸ’°\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a62_0x5e54b(0xdd)](_0x37696f){const _0x4e3f20=a62_0x5e54b,{orderId:_0x8acdca,amount:_0xfdbb02,currency:_0x460be0,productName:_0x4b6b01,description:_0x2b159a,successUrl:_0x55a787,failUrl:_0xeb29b3,customerEmail:_0x5f501e,customerName:_0x13fe61,isSourceCurrency:_0x34e4e9,sourceCurrency:_0x36f1e5}=_0x37696f;if(!this[_0x4e3f20(0xd6)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0xfae757=new URLSearchParams({'api_key':this[_0x4e3f20(0xd6)],'order_number':_0x8acdca,'order_name':_0x4b6b01,'description':_0x2b159a,'success_url':_0x55a787,'fail_url':_0xeb29b3,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x36f1e5?(_0xfae757[_0x4e3f20(0x119)](_0x4e3f20(0xbe),_0x36f1e5),_0xfae757['append'](_0x4e3f20(0x111),_0x460be0),_0xfae757[_0x4e3f20(0x119)](_0x4e3f20(0xc3),_0xfdbb02[_0x4e3f20(0xa4)]())):(_0xfae757[_0x4e3f20(0x119)]('currency',_0x460be0),_0xfae757[_0x4e3f20(0x119)]('amount',_0xfdbb02['toString']()));_0x5f501e&&_0xfae757[_0x4e3f20(0x119)](_0x4e3f20(0xb1),_0x5f501e);_0x13fe61&&_0xfae757[_0x4e3f20(0x119)](_0x4e3f20(0xea),_0x13fe61);const _0x204e52=this[_0x4e3f20(0xf6)]+'?'+_0xfae757[_0x4e3f20(0xa4)](),_0x139474=Date[_0x4e3f20(0xe1)]();try{console[_0x4e3f20(0xeb)](_0x4e3f20(0xb0)),console['log'](_0x4e3f20(0xbb),this[_0x4e3f20(0xf6)]),console['log'](_0x4e3f20(0xab),Object[_0x4e3f20(0xbf)](_0xfae757[_0x4e3f20(0x113)]())),console[_0x4e3f20(0xeb)]('Full\x20URL\x20(without\x20API\x20key):',_0x204e52[_0x4e3f20(0xca)](this[_0x4e3f20(0xd6)],_0x4e3f20(0xff))),loggerService_1[_0x4e3f20(0xa3)]['logWhiteDomainRequest']('plisio_direct','/invoices/new',_0x4e3f20(0x100),Object['fromEntries'](_0xfae757[_0x4e3f20(0x113)]()));const _0x50f3ef=await fetch(_0x204e52,{'method':_0x4e3f20(0x100),'headers':{'Accept':_0x4e3f20(0xd3),'User-Agent':_0x4e3f20(0xac)}}),_0x29a3a8=Date[_0x4e3f20(0xe1)]()-_0x139474;console[_0x4e3f20(0xeb)](_0x4e3f20(0xb8)),console[_0x4e3f20(0xeb)](_0x4e3f20(0xa8),_0x50f3ef[_0x4e3f20(0x11b)]),console[_0x4e3f20(0xeb)](_0x4e3f20(0xf2),_0x50f3ef[_0x4e3f20(0xf0)]),console['log']('Response\x20Time:',_0x29a3a8+'ms');const _0x47e6ea=await _0x50f3ef['text']();console[_0x4e3f20(0xeb)](_0x4e3f20(0x105),_0x47e6ea);if(!_0x50f3ef['ok']){console['error'](_0x4e3f20(0xad)),console[_0x4e3f20(0xc5)](_0x4e3f20(0xef),_0x50f3ef[_0x4e3f20(0x11b)]),console['error'](_0x4e3f20(0xed),_0x47e6ea),loggerService_1[_0x4e3f20(0xa3)][_0x4e3f20(0x10d)](_0x4e3f20(0x103),_0x4e3f20(0xe7),_0x50f3ef[_0x4e3f20(0x11b)],_0x47e6ea,_0x29a3a8),loggerService_1[_0x4e3f20(0xa3)]['logWhiteDomainError']('plisio_direct',_0x4e3f20(0xe7),_0x4e3f20(0xc8)+_0x50f3ef[_0x4e3f20(0x11b)]+':\x20'+_0x47e6ea);throw new Error(_0x4e3f20(0x114)+_0x50f3ef[_0x4e3f20(0x11b)]+',\x20body:\x20'+_0x47e6ea);}let _0x26df53;try{_0x26df53=JSON['parse'](_0x47e6ea);}catch(_0x580bd7){console[_0x4e3f20(0xc5)](_0x4e3f20(0xd7),_0x580bd7),loggerService_1[_0x4e3f20(0xa3)][_0x4e3f20(0xe2)]('plisio_direct',_0x4e3f20(0xe7),_0x4e3f20(0x106)+_0x580bd7);throw new Error(_0x4e3f20(0xdf)+_0x47e6ea);}console[_0x4e3f20(0xeb)](_0x4e3f20(0x112)),console[_0x4e3f20(0xeb)]('Parsed\x20Result:',JSON[_0x4e3f20(0xa2)](_0x26df53,null,0x2)),loggerService_1[_0x4e3f20(0xa3)][_0x4e3f20(0x10d)]('plisio_direct',_0x4e3f20(0xe7),_0x50f3ef[_0x4e3f20(0x11b)],_0x26df53,_0x29a3a8);if(_0x26df53['status']!==_0x4e3f20(0xcc)){const _0x198174=_0x26df53[_0x4e3f20(0x109)]||_0x26df53['error']||_0x4e3f20(0x118);console[_0x4e3f20(0xc5)](_0x4e3f20(0xfa)),console[_0x4e3f20(0xc5)](_0x4e3f20(0xe6),_0x198174),loggerService_1[_0x4e3f20(0xa3)]['logWhiteDomainError'](_0x4e3f20(0x103),_0x4e3f20(0xe7),_0x4e3f20(0xc4)+_0x198174);throw new Error(_0x4e3f20(0x101)+_0x198174);}if(!_0x26df53[_0x4e3f20(0xbd)]?.[_0x4e3f20(0xbc)]||!_0x26df53[_0x4e3f20(0xbd)]?.[_0x4e3f20(0xd1)]){console[_0x4e3f20(0xc5)](_0x4e3f20(0xb5)),console['error'](_0x4e3f20(0xfd)),console[_0x4e3f20(0xc5)](_0x4e3f20(0xcb),_0x26df53['data']),loggerService_1[_0x4e3f20(0xa3)][_0x4e3f20(0xe2)](_0x4e3f20(0x103),_0x4e3f20(0xe7),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x4e3f20(0x10e));}return console[_0x4e3f20(0xeb)](_0x4e3f20(0x102)),console['log'](_0x4e3f20(0xf9),_0x26df53['data']['txn_id']),console['log'](_0x4e3f20(0x104),_0x26df53[_0x4e3f20(0xbd)][_0x4e3f20(0xd1)]),console[_0x4e3f20(0xeb)]('Amount:',_0xfdbb02,_0x460be0),_0x36f1e5&&(console[_0x4e3f20(0xeb)](_0x4e3f20(0xd2),_0x36f1e5,_0x4e3f20(0x116)),console[_0x4e3f20(0xeb)](_0x4e3f20(0xe9),_0x460be0,_0x4e3f20(0x10a))),{'gateway_payment_id':_0x26df53[_0x4e3f20(0xbd)][_0x4e3f20(0xbc)],'payment_url':_0x26df53['data']['invoice_url'],'invoice_total_sum':_0x26df53[_0x4e3f20(0xbd)][_0x4e3f20(0xdb)],'qr_code':_0x26df53[_0x4e3f20(0xbd)][_0x4e3f20(0xa5)],'qr_url':_0x26df53[_0x4e3f20(0xbd)][_0x4e3f20(0xfc)]};}catch(_0x54c55c){console[_0x4e3f20(0xc5)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x4e3f20(0xc5)](_0x4e3f20(0xba),_0x54c55c),loggerService_1['loggerService']['logWhiteDomainError'](_0x4e3f20(0x103),'/invoices/new',_0x54c55c);if(_0x54c55c instanceof Error){console[_0x4e3f20(0xc5)](_0x4e3f20(0xcd),_0x54c55c[_0x4e3f20(0x109)]),console['error']('Error\x20stack:',_0x54c55c[_0x4e3f20(0x117)]);throw new Error(_0x4e3f20(0xec)+_0x54c55c[_0x4e3f20(0x109)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a62_0x5e54b(0xb9)](_0x2bedcb){const _0x53a2ba=a62_0x5e54b,_0x13a7b7=Date[_0x53a2ba(0xe1)]();try{if(!this[_0x53a2ba(0xd6)])throw new Error(_0x53a2ba(0xa1));const _0x58124a=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x2bedcb}),_0x25c005=_0x53a2ba(0xc6)+_0x2bedcb+'?'+_0x58124a[_0x53a2ba(0xa4)]();loggerService_1['loggerService'][_0x53a2ba(0xee)](_0x53a2ba(0x103),_0x53a2ba(0x10b)+_0x2bedcb,_0x53a2ba(0x100),Object[_0x53a2ba(0xbf)](_0x58124a[_0x53a2ba(0x113)]()));const _0x509762=await fetch(_0x25c005,{'method':'GET','headers':{'Accept':_0x53a2ba(0xd3),'User-Agent':_0x53a2ba(0xac)}}),_0x1c5d93=Date['now']()-_0x13a7b7;if(!_0x509762['ok']){const _0x5ab15a=await _0x509762['text']();loggerService_1[_0x53a2ba(0xa3)][_0x53a2ba(0x10d)](_0x53a2ba(0x103),'/operations/'+_0x2bedcb,_0x509762['status'],_0x5ab15a,_0x1c5d93);throw new Error('HTTP\x20error!\x20status:\x20'+_0x509762[_0x53a2ba(0x11b)]);}const _0x252645=await _0x509762['json']();loggerService_1[_0x53a2ba(0xa3)][_0x53a2ba(0x10d)](_0x53a2ba(0x103),_0x53a2ba(0x10b)+_0x2bedcb,_0x509762['status'],_0x252645,_0x1c5d93);if(_0x252645[_0x53a2ba(0x11b)]!==_0x53a2ba(0xcc)){loggerService_1['loggerService'][_0x53a2ba(0xe2)](_0x53a2ba(0x103),_0x53a2ba(0x10b)+_0x2bedcb,_0x53a2ba(0x101)+(_0x252645['message']||_0x252645[_0x53a2ba(0xc5)]||_0x53a2ba(0xd8)));throw new Error(_0x53a2ba(0x101)+(_0x252645[_0x53a2ba(0x109)]||_0x252645[_0x53a2ba(0xc5)]||'Unknown\x20error'));}let _0x3d58ce=_0x53a2ba(0xb4);return{'status':_0x3d58ce};}catch(_0x2a071f){console['error'](_0x53a2ba(0xcf),_0x2a071f),loggerService_1[_0x53a2ba(0xa3)]['logWhiteDomainError'](_0x53a2ba(0x103),_0x53a2ba(0x10b)+_0x2bedcb,_0x2a071f);throw new Error(_0x53a2ba(0xc0)+(_0x2a071f instanceof Error?_0x2a071f[_0x53a2ba(0x109)]:_0x53a2ba(0xd8)));}}async['processWebhook'](_0x10b852){const _0xf3609d=a62_0x5e54b;console[_0xf3609d(0xeb)](_0xf3609d(0xf4),_0x10b852);let _0x5b13f9=_0xf3609d(0xb4);switch(_0x10b852[_0xf3609d(0x11b)]?.[_0xf3609d(0xa6)]()){case _0xf3609d(0xa0):case _0xf3609d(0x115):_0x5b13f9=_0xf3609d(0xe3);break;case _0xf3609d(0xd4):_0x5b13f9=_0xf3609d(0xa9);break;case _0xf3609d(0xc5):case _0xf3609d(0xaa):_0x5b13f9=_0xf3609d(0xd0);break;case'new':_0x5b13f9=_0xf3609d(0xb4);break;case _0xf3609d(0xc1):_0x5b13f9=_0xf3609d(0xd9);break;default:_0x5b13f9=_0xf3609d(0xb4);break;}let _0x5a3372;if(_0x10b852[_0xf3609d(0x11a)])try{console[_0xf3609d(0xeb)](_0xf3609d(0x10f),_0x10b852[_0xf3609d(0x11a)]);let _0xfd1655;if(typeof _0x10b852[_0xf3609d(0x11a)]==='string')_0xfd1655=JSON['parse'](_0x10b852[_0xf3609d(0x11a)]);else Array['isArray'](_0x10b852[_0xf3609d(0x11a)])?_0xfd1655=_0x10b852[_0xf3609d(0x11a)]:_0xfd1655=[];_0x5a3372=_0xfd1655[_0xf3609d(0xf8)](_0xe1b35d=>{const _0x5aa816=_0xf3609d,_0x52ae3f=_0xe1b35d[_0x5aa816(0xca)](/\\/g,'');return console[_0x5aa816(0xeb)](_0x5aa816(0xce)+_0xe1b35d+_0x5aa816(0xb3)+_0x52ae3f),_0x52ae3f;}),console['log'](_0xf3609d(0xc7),_0x5a3372),_0x5a3372[_0xf3609d(0xe5)]((_0x42eec3,_0x3865e0)=>{const _0x100d6a=_0xf3609d;try{new URL(_0x42eec3),console[_0x100d6a(0xeb)](_0x100d6a(0xda)+(_0x3865e0+0x1)+_0x100d6a(0x108)+_0x42eec3);}catch(_0x537108){console[_0x100d6a(0xc5)](_0x100d6a(0xf3)+(_0x3865e0+0x1)+_0x100d6a(0xd5)+_0x42eec3,_0x537108);}});}catch(_0xbe2f9a){console[_0xf3609d(0xc5)](_0xf3609d(0xf7),_0xbe2f9a),console[_0xf3609d(0xc5)]('Raw\x20tx_urls\x20data:',_0x10b852['tx_urls']),_0x5a3372=undefined;}return{'paymentId':_0x10b852[_0xf3609d(0xe4)]||'','status':_0x5b13f9,'amount':_0x10b852[_0xf3609d(0x107)],'currency':_0x10b852[_0xf3609d(0xbe)],'txUrls':_0x5a3372};}}exports[a62_0x5e54b(0xc2)]=PlisioService;