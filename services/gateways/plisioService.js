'use strict';const a41_0x588aef=a41_0x3ef0;function a41_0x3ef0(_0xce336f,_0x2b2cdf){const _0x3c6b89=a41_0x3c6b();return a41_0x3ef0=function(_0x3ef01e,_0x5593e5){_0x3ef01e=_0x3ef01e-0x111;let _0x56c06b=_0x3c6b89[_0x3ef01e];return _0x56c06b;},a41_0x3ef0(_0xce336f,_0x2b2cdf);}(function(_0xadf237,_0x393272){const _0x220a78=a41_0x3ef0,_0x5280ea=_0xadf237();while(!![]){try{const _0x3de582=-parseInt(_0x220a78(0x16e))/0x1+parseInt(_0x220a78(0x137))/0x2*(parseInt(_0x220a78(0x13d))/0x3)+-parseInt(_0x220a78(0x12b))/0x4+parseInt(_0x220a78(0x15e))/0x5+-parseInt(_0x220a78(0x118))/0x6+-parseInt(_0x220a78(0x130))/0x7*(parseInt(_0x220a78(0x154))/0x8)+parseInt(_0x220a78(0x16a))/0x9;if(_0x3de582===_0x393272)break;else _0x5280ea['push'](_0x5280ea['shift']());}catch(_0x2f56fe){_0x5280ea['push'](_0x5280ea['shift']());}}}(a41_0x3c6b,0xdab22));Object['defineProperty'](exports,a41_0x588aef(0x171),{'value':!![]}),exports[a41_0x588aef(0x16f)]=void 0x0;function a41_0x3c6b(){const _0xed0f5b=['invoice_url','stringify','PENDING','amount','Status:','log','application/json','35781471CDzrqa','completed','message','Unknown\x20error','1221838DiicSy','PlisioService','Error\x20details:','__esModule','Processing\x20Plisio\x20webhook:','/invoices/new','currency','Business\x20Error:\x20','now','status','error','8790030ZvOQFn','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Response\x20data:','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','PAID','Failed\x20to\x20parse\x20JSON\x20response:','warn','Parameters:','apiKey','source_amount','===\x20PLISIO\x20API\x20ERROR\x20===','Plisio\x20payment\x20verification\x20error:','apiUrl','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','processWebhook','expired','GET','../loggerService','3431028PGcwsj','logWhiteDomainError','/operations/','PLISIO_API_KEY','Failed\x20to\x20create\x20Plisio\x20payment:\x20','21fcGgeB','HTTP\x20error!\x20status:\x20','json','===\x20PLISIO\x20SUCCESS\x20===','logWhiteDomainRequest','email','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','344426clfCKE','qr_code','Invoice\x20URL:','Plisio\x20API\x20error:\x20','text','toString','15kRaGSi','data','Unknown\x20error\x20from\x20Plisio\x20API','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','https://api.plisio.net/api/v1/invoices/new','Transaction\x20ID:','loggerService','Status\x20Text:','Error\x20Message:','URL:','plisio_direct','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','qr_url','fromEntries','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','logWhiteDomainResponse','Full\x20URL\x20(without\x20API\x20key):','replace',',\x20body:\x20','invoice_total_sum','env','Plisio\x20API\x20key\x20is\x20not\x20configured','FAILED','1298768SelMeb','(fiat\x20for\x20merchant)','Response\x20Time:','name','JSON\x20Parse\x20Error:\x20','verifyPayment','txn_id','success','new','TesSoft\x20Payment\x20System/1.0','453160GQooCI','append','entries','Amount:','Source\x20Currency:'];a41_0x3c6b=function(){return _0xed0f5b;};return a41_0x3c6b();}const loggerService_1=require(a41_0x588aef(0x12a));class PlisioService{constructor(){const _0x2f5f95=a41_0x588aef;this[_0x2f5f95(0x125)]=_0x2f5f95(0x141),this[_0x2f5f95(0x121)]=process[_0x2f5f95(0x151)][_0x2f5f95(0x12e)]||'',!this[_0x2f5f95(0x121)]?console[_0x2f5f95(0x11f)](_0x2f5f95(0x119)):console[_0x2f5f95(0x168)](_0x2f5f95(0x11c));}async['createPayment'](_0x1b8af4){const _0x4ffb8e=a41_0x588aef,{orderId:_0x30d177,amount:_0x590720,currency:_0xace45e,productName:_0x2cc289,description:_0x332045,successUrl:_0x23650c,failUrl:_0x546010,customerEmail:_0x1de9ea,customerName:_0x455fe7,isSourceCurrency:_0x1aea5d,sourceCurrency:_0x2622bf}=_0x1b8af4;if(!this['apiKey'])throw new Error(_0x4ffb8e(0x152));const _0x4189ae=new URLSearchParams({'api_key':this[_0x4ffb8e(0x121)],'order_number':_0x30d177,'order_name':_0x2cc289,'description':_0x332045,'success_url':_0x23650c,'fail_url':_0x546010,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x2622bf?(_0x4189ae[_0x4ffb8e(0x15f)](_0x4ffb8e(0x113),_0x2622bf),_0x4189ae[_0x4ffb8e(0x15f)]('source_currency',_0xace45e),_0x4189ae['append'](_0x4ffb8e(0x122),_0x590720[_0x4ffb8e(0x13c)]())):(_0x4189ae['append'](_0x4ffb8e(0x113),_0xace45e),_0x4189ae[_0x4ffb8e(0x15f)](_0x4ffb8e(0x166),_0x590720[_0x4ffb8e(0x13c)]()));_0x1de9ea&&_0x4189ae['append'](_0x4ffb8e(0x135),_0x1de9ea);_0x455fe7&&_0x4189ae['append'](_0x4ffb8e(0x157),_0x455fe7);const _0x47b823=this[_0x4ffb8e(0x125)]+'?'+_0x4189ae[_0x4ffb8e(0x13c)](),_0x266bbd=Date[_0x4ffb8e(0x115)]();try{console[_0x4ffb8e(0x168)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x4ffb8e(0x168)](_0x4ffb8e(0x146),this[_0x4ffb8e(0x125)]),console[_0x4ffb8e(0x168)](_0x4ffb8e(0x120),Object['fromEntries'](_0x4189ae[_0x4ffb8e(0x160)]())),console[_0x4ffb8e(0x168)](_0x4ffb8e(0x14d),_0x47b823[_0x4ffb8e(0x14e)](this[_0x4ffb8e(0x121)],'HIDDEN')),loggerService_1[_0x4ffb8e(0x143)][_0x4ffb8e(0x134)]('plisio_direct',_0x4ffb8e(0x112),_0x4ffb8e(0x129),Object[_0x4ffb8e(0x14a)](_0x4189ae[_0x4ffb8e(0x160)]()));const _0x276a7d=await fetch(_0x47b823,{'method':_0x4ffb8e(0x129),'headers':{'Accept':_0x4ffb8e(0x169),'User-Agent':_0x4ffb8e(0x15d)}}),_0x59c066=Date[_0x4ffb8e(0x115)]()-_0x266bbd;console['log']('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x4ffb8e(0x168)](_0x4ffb8e(0x167),_0x276a7d['status']),console['log'](_0x4ffb8e(0x144),_0x276a7d['statusText']),console[_0x4ffb8e(0x168)](_0x4ffb8e(0x156),_0x59c066+'ms');const _0x47b481=await _0x276a7d[_0x4ffb8e(0x13b)]();console[_0x4ffb8e(0x168)]('Raw\x20Response\x20Body:',_0x47b481);if(!_0x276a7d['ok']){console['error'](_0x4ffb8e(0x123)),console[_0x4ffb8e(0x117)]('HTTP\x20Status:',_0x276a7d['status']),console[_0x4ffb8e(0x117)]('Response\x20Body:',_0x47b481),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4ffb8e(0x147),'/invoices/new',_0x276a7d[_0x4ffb8e(0x116)],_0x47b481,_0x59c066),loggerService_1['loggerService'][_0x4ffb8e(0x12c)](_0x4ffb8e(0x147),_0x4ffb8e(0x112),'HTTP\x20'+_0x276a7d[_0x4ffb8e(0x116)]+':\x20'+_0x47b481);throw new Error(_0x4ffb8e(0x131)+_0x276a7d[_0x4ffb8e(0x116)]+_0x4ffb8e(0x14f)+_0x47b481);}let _0xcb5fa1;try{_0xcb5fa1=JSON['parse'](_0x47b481);}catch(_0x17cbb2){console['error'](_0x4ffb8e(0x11e),_0x17cbb2),loggerService_1[_0x4ffb8e(0x143)][_0x4ffb8e(0x12c)](_0x4ffb8e(0x147),_0x4ffb8e(0x112),_0x4ffb8e(0x158)+_0x17cbb2);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x47b481);}console[_0x4ffb8e(0x168)](_0x4ffb8e(0x148)),console[_0x4ffb8e(0x168)]('Parsed\x20Result:',JSON[_0x4ffb8e(0x164)](_0xcb5fa1,null,0x2)),loggerService_1[_0x4ffb8e(0x143)][_0x4ffb8e(0x14c)](_0x4ffb8e(0x147),_0x4ffb8e(0x112),_0x276a7d[_0x4ffb8e(0x116)],_0xcb5fa1,_0x59c066);if(_0xcb5fa1[_0x4ffb8e(0x116)]!==_0x4ffb8e(0x15b)){const _0x343c4b=_0xcb5fa1[_0x4ffb8e(0x16c)]||_0xcb5fa1['error']||_0x4ffb8e(0x13f);console[_0x4ffb8e(0x117)](_0x4ffb8e(0x14b)),console['error'](_0x4ffb8e(0x145),_0x343c4b),loggerService_1[_0x4ffb8e(0x143)]['logWhiteDomainError']('plisio_direct',_0x4ffb8e(0x112),_0x4ffb8e(0x114)+_0x343c4b);throw new Error(_0x4ffb8e(0x13a)+_0x343c4b);}if(!_0xcb5fa1[_0x4ffb8e(0x13e)]?.[_0x4ffb8e(0x15a)]||!_0xcb5fa1['data']?.[_0x4ffb8e(0x163)]){console[_0x4ffb8e(0x117)](_0x4ffb8e(0x11a)),console[_0x4ffb8e(0x117)](_0x4ffb8e(0x136)),console[_0x4ffb8e(0x117)](_0x4ffb8e(0x11b),_0xcb5fa1[_0x4ffb8e(0x13e)]),loggerService_1[_0x4ffb8e(0x143)][_0x4ffb8e(0x12c)](_0x4ffb8e(0x147),_0x4ffb8e(0x112),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x4ffb8e(0x140));}return console[_0x4ffb8e(0x168)](_0x4ffb8e(0x133)),console[_0x4ffb8e(0x168)](_0x4ffb8e(0x142),_0xcb5fa1[_0x4ffb8e(0x13e)][_0x4ffb8e(0x15a)]),console['log'](_0x4ffb8e(0x139),_0xcb5fa1[_0x4ffb8e(0x13e)]['invoice_url']),console[_0x4ffb8e(0x168)](_0x4ffb8e(0x161),_0x590720,_0xace45e),_0x2622bf&&(console['log'](_0x4ffb8e(0x162),_0x2622bf,'(crypto\x20for\x20payment)'),console[_0x4ffb8e(0x168)]('Target\x20Currency:',_0xace45e,_0x4ffb8e(0x155))),{'gateway_payment_id':_0xcb5fa1['data'][_0x4ffb8e(0x15a)],'payment_url':_0xcb5fa1[_0x4ffb8e(0x13e)]['invoice_url'],'invoice_total_sum':_0xcb5fa1['data'][_0x4ffb8e(0x150)],'qr_code':_0xcb5fa1[_0x4ffb8e(0x13e)][_0x4ffb8e(0x138)],'qr_url':_0xcb5fa1[_0x4ffb8e(0x13e)][_0x4ffb8e(0x149)]};}catch(_0x5cc942){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x4ffb8e(0x117)](_0x4ffb8e(0x170),_0x5cc942),loggerService_1['loggerService'][_0x4ffb8e(0x12c)](_0x4ffb8e(0x147),_0x4ffb8e(0x112),_0x5cc942);if(_0x5cc942 instanceof Error){console['error']('Error\x20message:',_0x5cc942[_0x4ffb8e(0x16c)]),console[_0x4ffb8e(0x117)]('Error\x20stack:',_0x5cc942['stack']);throw new Error(_0x4ffb8e(0x12f)+_0x5cc942['message']);}throw new Error(_0x4ffb8e(0x126));}}async[a41_0x588aef(0x159)](_0x10e03e){const _0x15c525=a41_0x588aef,_0x1e3fc2=Date[_0x15c525(0x115)]();try{if(!this['apiKey'])throw new Error(_0x15c525(0x152));const _0x4a4be7=new URLSearchParams({'api_key':this[_0x15c525(0x121)],'txn_id':_0x10e03e}),_0x4885cb='https://api.plisio.net/api/v1/operations/'+_0x10e03e+'?'+_0x4a4be7[_0x15c525(0x13c)]();loggerService_1['loggerService']['logWhiteDomainRequest'](_0x15c525(0x147),'/operations/'+_0x10e03e,_0x15c525(0x129),Object[_0x15c525(0x14a)](_0x4a4be7['entries']()));const _0x87771c=await fetch(_0x4885cb,{'method':'GET','headers':{'Accept':_0x15c525(0x169),'User-Agent':_0x15c525(0x15d)}}),_0x518ad0=Date[_0x15c525(0x115)]()-_0x1e3fc2;if(!_0x87771c['ok']){const _0x20d259=await _0x87771c[_0x15c525(0x13b)]();loggerService_1[_0x15c525(0x143)][_0x15c525(0x14c)]('plisio_direct','/operations/'+_0x10e03e,_0x87771c['status'],_0x20d259,_0x518ad0);throw new Error(_0x15c525(0x131)+_0x87771c[_0x15c525(0x116)]);}const _0x5a3c9c=await _0x87771c[_0x15c525(0x132)]();loggerService_1[_0x15c525(0x143)][_0x15c525(0x14c)]('plisio_direct',_0x15c525(0x12d)+_0x10e03e,_0x87771c['status'],_0x5a3c9c,_0x518ad0);if(_0x5a3c9c[_0x15c525(0x116)]!==_0x15c525(0x15b)){loggerService_1['loggerService'][_0x15c525(0x12c)](_0x15c525(0x147),_0x15c525(0x12d)+_0x10e03e,_0x15c525(0x13a)+(_0x5a3c9c[_0x15c525(0x16c)]||_0x5a3c9c[_0x15c525(0x117)]||'Unknown\x20error'));throw new Error(_0x15c525(0x13a)+(_0x5a3c9c['message']||_0x5a3c9c[_0x15c525(0x117)]||_0x15c525(0x16d)));}let _0x1f269e=_0x15c525(0x165);return{'status':_0x1f269e};}catch(_0x195202){console['error'](_0x15c525(0x124),_0x195202),loggerService_1[_0x15c525(0x143)][_0x15c525(0x12c)](_0x15c525(0x147),_0x15c525(0x12d)+_0x10e03e,_0x195202);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x195202 instanceof Error?_0x195202[_0x15c525(0x16c)]:'Unknown\x20error'));}}async[a41_0x588aef(0x127)](_0x4d8216){const _0x1ae770=a41_0x588aef;console[_0x1ae770(0x168)](_0x1ae770(0x111),_0x4d8216);let _0x58ebcd='PENDING';switch(_0x4d8216[_0x1ae770(0x116)]?.['toLowerCase']()){case _0x1ae770(0x16b):case'mismatch':_0x58ebcd=_0x1ae770(0x11d);break;case _0x1ae770(0x128):_0x58ebcd='EXPIRED';break;case _0x1ae770(0x117):case'cancelled':_0x58ebcd=_0x1ae770(0x153);break;case _0x1ae770(0x15c):case'pending':default:_0x58ebcd='PENDING';break;}return{'paymentId':_0x4d8216['order_number']||'','status':_0x58ebcd,'amount':_0x4d8216[_0x1ae770(0x166)],'currency':_0x4d8216[_0x1ae770(0x113)]};}}exports[a41_0x588aef(0x16f)]=PlisioService;