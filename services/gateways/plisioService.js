'use strict';const a47_0x10c983=a47_0xa88b;(function(_0x41616e,_0x1089f8){const _0x173b81=a47_0xa88b,_0x47e4ea=_0x41616e();while(!![]){try{const _0x3e5f44=parseInt(_0x173b81(0x1f2))/0x1+-parseInt(_0x173b81(0x185))/0x2+-parseInt(_0x173b81(0x1a0))/0x3*(-parseInt(_0x173b81(0x1c9))/0x4)+-parseInt(_0x173b81(0x1aa))/0x5+parseInt(_0x173b81(0x1cc))/0x6*(-parseInt(_0x173b81(0x1dc))/0x7)+parseInt(_0x173b81(0x19e))/0x8+-parseInt(_0x173b81(0x18d))/0x9;if(_0x3e5f44===_0x1089f8)break;else _0x47e4ea['push'](_0x47e4ea['shift']());}catch(_0x2e154f){_0x47e4ea['push'](_0x47e4ea['shift']());}}}(a47_0xe980,0x18ae2));function a47_0xe980(){const _0x3d1f09=['order_number','GET','isArray','HTTP\x20error!\x20status:\x20','\x20is\x20invalid:\x20','Target\x20Currency:','üîó\x20Formatted\x20URL:\x20','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Business\x20Error:\x20','statusText','source_amount','Transaction\x20ID:','replace','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','forEach','‚ùå\x20URL\x20','defineProperty','Unknown\x20error\x20from\x20Plisio\x20API','log','\x20->\x20','entries','qr_code','string','‚úÖ\x20URL\x20','FAILED','currency','toLowerCase','invoice_url','Error\x20details:','logWhiteDomainResponse','737560WyMBUt','append','PAID','6oDUmts','\x20is\x20valid:\x20','Error\x20Message:','cancelled','JSON\x20Parse\x20Error:\x20','Status\x20Text:','PlisioService','Status:','fromEntries','EXPIRED','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','URL:','warn','Raw\x20tx_urls\x20data:','Unknown\x20error','qr_url','833651mvLfjt','Raw\x20Response\x20Body:','plisio_direct','Plisio\x20payment\x20verification\x20error:','amount','now','Plisio\x20API\x20error:\x20','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','HIDDEN','https://api.plisio.net/api/v1/invoices/new','text','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','source_currency','(crypto\x20for\x20payment)','Response\x20Time:','name','TesSoft\x20Payment\x20System/1.0','logWhiteDomainError','message','completed','toString','29491zCyBFN','processWebhook','HTTP\x20','‚úÖ\x20Processed\x20tx_urls:','Failed\x20to\x20parse\x20JSON\x20response:','PLISIO_API_KEY','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','apiKey','parse','logWhiteDomainRequest','success','185378ePHdQU','https://api.plisio.net/api/v1/operations/','status','expired','__esModule','PROCESSING','/operations/','HTTP\x20Status:','12726sStpXE','txn_id','new','env','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','loggerService','(fiat\x20for\x20merchant)','Amount:','tx_urls','===\x20PLISIO\x20API\x20ERROR\x20===','stack','Plisio\x20API\x20key\x20is\x20not\x20configured','===\x20PLISIO\x20SUCCESS\x20===','PENDING','/invoices/new','https://api.trapay.uk/api/webhooks/gateway/plisio','apiUrl','972272wdzqfp','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','3kAgcoC','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','data','error',',\x20body:\x20','mismatch','Parameters:','createPayment','application/json','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','105645ZYsWbh'];a47_0xe980=function(){return _0x3d1f09;};return a47_0xe980();}Object[a47_0x10c983(0x1bb)](exports,a47_0x10c983(0x189),{'value':!![]}),exports[a47_0x10c983(0x1d2)]=void 0x0;function a47_0xa88b(_0x3ea93f,_0x18aa61){const _0xe9806e=a47_0xe980();return a47_0xa88b=function(_0xa88b95,_0xe792be){_0xa88b95=_0xa88b95-0x17e;let _0x32a26c=_0xe9806e[_0xa88b95];return _0x32a26c;},a47_0xa88b(_0x3ea93f,_0x18aa61);}const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x509096=a47_0x10c983;this[_0x509096(0x19d)]=_0x509096(0x1e5),this[_0x509096(0x181)]=process[_0x509096(0x190)][_0x509096(0x17f)]||'',!this[_0x509096(0x181)]?console[_0x509096(0x1d8)](_0x509096(0x1e3)):console['log'](_0x509096(0x191));}async[a47_0x10c983(0x1a7)](_0x104dfb){const _0x4db145=a47_0x10c983,{orderId:_0x5f146a,amount:_0x3d4b91,currency:_0x6e65e4,productName:_0x1000ca,description:_0xdfb0ba,successUrl:_0x319931,failUrl:_0xa1bb42,customerEmail:_0xf6e9b,customerName:_0x54e986,isSourceCurrency:_0x135832,sourceCurrency:_0x15fd2e}=_0x104dfb;if(!this[_0x4db145(0x181)])throw new Error(_0x4db145(0x198));const _0x2fdd9d=new URLSearchParams({'api_key':this[_0x4db145(0x181)],'order_number':_0x5f146a,'order_name':_0x1000ca,'description':_0xdfb0ba,'success_url':_0x319931,'fail_url':_0xa1bb42,'callback_url':_0x4db145(0x19c)});_0x15fd2e?(_0x2fdd9d[_0x4db145(0x1ca)](_0x4db145(0x1c4),_0x15fd2e),_0x2fdd9d[_0x4db145(0x1ca)](_0x4db145(0x1e9),_0x6e65e4),_0x2fdd9d[_0x4db145(0x1ca)](_0x4db145(0x1b5),_0x3d4b91[_0x4db145(0x1f1)]())):(_0x2fdd9d['append']('currency',_0x6e65e4),_0x2fdd9d[_0x4db145(0x1ca)](_0x4db145(0x1e0),_0x3d4b91['toString']()));_0xf6e9b&&_0x2fdd9d['append']('email',_0xf6e9b);_0x54e986&&_0x2fdd9d['append'](_0x4db145(0x1ec),_0x54e986);const _0x2054f2=this[_0x4db145(0x19d)]+'?'+_0x2fdd9d[_0x4db145(0x1f1)](),_0x1415de=Date[_0x4db145(0x1e1)]();try{console[_0x4db145(0x1bd)](_0x4db145(0x1a1)),console[_0x4db145(0x1bd)](_0x4db145(0x1d7),this[_0x4db145(0x19d)]),console[_0x4db145(0x1bd)](_0x4db145(0x1a6),Object[_0x4db145(0x1d4)](_0x2fdd9d[_0x4db145(0x1bf)]())),console[_0x4db145(0x1bd)]('Full\x20URL\x20(without\x20API\x20key):',_0x2054f2[_0x4db145(0x1b7)](this[_0x4db145(0x181)],_0x4db145(0x1e4))),loggerService_1[_0x4db145(0x192)][_0x4db145(0x183)]('plisio_direct',_0x4db145(0x19b),_0x4db145(0x1ac),Object[_0x4db145(0x1d4)](_0x2fdd9d['entries']()));const _0x7a3b67=await fetch(_0x2054f2,{'method':_0x4db145(0x1ac),'headers':{'Accept':_0x4db145(0x1a8),'User-Agent':_0x4db145(0x1ed)}}),_0x1a4ba4=Date[_0x4db145(0x1e1)]()-_0x1415de;console[_0x4db145(0x1bd)](_0x4db145(0x19f)),console[_0x4db145(0x1bd)](_0x4db145(0x1d3),_0x7a3b67[_0x4db145(0x187)]),console[_0x4db145(0x1bd)](_0x4db145(0x1d1),_0x7a3b67[_0x4db145(0x1b4)]),console[_0x4db145(0x1bd)](_0x4db145(0x1eb),_0x1a4ba4+'ms');const _0x11adee=await _0x7a3b67[_0x4db145(0x1e6)]();console[_0x4db145(0x1bd)](_0x4db145(0x1dd),_0x11adee);if(!_0x7a3b67['ok']){console[_0x4db145(0x1a3)](_0x4db145(0x196)),console[_0x4db145(0x1a3)](_0x4db145(0x18c),_0x7a3b67[_0x4db145(0x187)]),console['error']('Response\x20Body:',_0x11adee),loggerService_1['loggerService'][_0x4db145(0x1c8)]('plisio_direct',_0x4db145(0x19b),_0x7a3b67['status'],_0x11adee,_0x1a4ba4),loggerService_1['loggerService'][_0x4db145(0x1ee)](_0x4db145(0x1de),_0x4db145(0x19b),_0x4db145(0x1f4)+_0x7a3b67[_0x4db145(0x187)]+':\x20'+_0x11adee);throw new Error(_0x4db145(0x1ae)+_0x7a3b67[_0x4db145(0x187)]+_0x4db145(0x1a4)+_0x11adee);}let _0x314c99;try{_0x314c99=JSON[_0x4db145(0x182)](_0x11adee);}catch(_0x3c982d){console[_0x4db145(0x1a3)](_0x4db145(0x17e),_0x3c982d),loggerService_1['loggerService'][_0x4db145(0x1ee)]('plisio_direct',_0x4db145(0x19b),_0x4db145(0x1d0)+_0x3c982d);throw new Error(_0x4db145(0x1e7)+_0x11adee);}console[_0x4db145(0x1bd)](_0x4db145(0x1a9)),console[_0x4db145(0x1bd)]('Parsed\x20Result:',JSON['stringify'](_0x314c99,null,0x2)),loggerService_1[_0x4db145(0x192)][_0x4db145(0x1c8)](_0x4db145(0x1de),'/invoices/new',_0x7a3b67[_0x4db145(0x187)],_0x314c99,_0x1a4ba4);if(_0x314c99[_0x4db145(0x187)]!==_0x4db145(0x184)){const _0x300d20=_0x314c99['message']||_0x314c99['error']||_0x4db145(0x1bc);console['error']('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x4db145(0x1ce),_0x300d20),loggerService_1[_0x4db145(0x192)][_0x4db145(0x1ee)](_0x4db145(0x1de),_0x4db145(0x19b),_0x4db145(0x1b3)+_0x300d20);throw new Error('Plisio\x20API\x20error:\x20'+_0x300d20);}if(!_0x314c99['data']?.[_0x4db145(0x18e)]||!_0x314c99[_0x4db145(0x1a2)]?.[_0x4db145(0x1c6)]){console[_0x4db145(0x1a3)](_0x4db145(0x180)),console[_0x4db145(0x1a3)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x4db145(0x1a3)]('Response\x20data:',_0x314c99[_0x4db145(0x1a2)]),loggerService_1[_0x4db145(0x192)][_0x4db145(0x1ee)](_0x4db145(0x1de),_0x4db145(0x19b),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x4db145(0x1b2));}return console[_0x4db145(0x1bd)](_0x4db145(0x199)),console[_0x4db145(0x1bd)](_0x4db145(0x1b6),_0x314c99[_0x4db145(0x1a2)][_0x4db145(0x18e)]),console['log']('Invoice\x20URL:',_0x314c99[_0x4db145(0x1a2)][_0x4db145(0x1c6)]),console[_0x4db145(0x1bd)](_0x4db145(0x194),_0x3d4b91,_0x6e65e4),_0x15fd2e&&(console[_0x4db145(0x1bd)]('Source\x20Currency:',_0x15fd2e,_0x4db145(0x1ea)),console['log'](_0x4db145(0x1b0),_0x6e65e4,_0x4db145(0x193))),{'gateway_payment_id':_0x314c99[_0x4db145(0x1a2)][_0x4db145(0x18e)],'payment_url':_0x314c99[_0x4db145(0x1a2)][_0x4db145(0x1c6)],'invoice_total_sum':_0x314c99['data']['invoice_total_sum'],'qr_code':_0x314c99[_0x4db145(0x1a2)][_0x4db145(0x1c0)],'qr_url':_0x314c99[_0x4db145(0x1a2)][_0x4db145(0x1db)]};}catch(_0x8f2de3){console[_0x4db145(0x1a3)](_0x4db145(0x1e8)),console['error'](_0x4db145(0x1c7),_0x8f2de3),loggerService_1[_0x4db145(0x192)][_0x4db145(0x1ee)](_0x4db145(0x1de),_0x4db145(0x19b),_0x8f2de3);if(_0x8f2de3 instanceof Error){console['error']('Error\x20message:',_0x8f2de3[_0x4db145(0x1ef)]),console['error']('Error\x20stack:',_0x8f2de3[_0x4db145(0x197)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x8f2de3[_0x4db145(0x1ef)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async['verifyPayment'](_0x25c5a0){const _0x3bbbae=a47_0x10c983,_0x5ae47e=Date[_0x3bbbae(0x1e1)]();try{if(!this['apiKey'])throw new Error(_0x3bbbae(0x198));const _0x346a13=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x25c5a0}),_0xf68290=_0x3bbbae(0x186)+_0x25c5a0+'?'+_0x346a13[_0x3bbbae(0x1f1)]();loggerService_1[_0x3bbbae(0x192)][_0x3bbbae(0x183)](_0x3bbbae(0x1de),'/operations/'+_0x25c5a0,'GET',Object[_0x3bbbae(0x1d4)](_0x346a13['entries']()));const _0x3df73e=await fetch(_0xf68290,{'method':_0x3bbbae(0x1ac),'headers':{'Accept':_0x3bbbae(0x1a8),'User-Agent':_0x3bbbae(0x1ed)}}),_0x2aa339=Date[_0x3bbbae(0x1e1)]()-_0x5ae47e;if(!_0x3df73e['ok']){const _0x240110=await _0x3df73e['text']();loggerService_1['loggerService'][_0x3bbbae(0x1c8)]('plisio_direct',_0x3bbbae(0x18b)+_0x25c5a0,_0x3df73e[_0x3bbbae(0x187)],_0x240110,_0x2aa339);throw new Error(_0x3bbbae(0x1ae)+_0x3df73e[_0x3bbbae(0x187)]);}const _0x30546f=await _0x3df73e['json']();loggerService_1['loggerService']['logWhiteDomainResponse']('plisio_direct',_0x3bbbae(0x18b)+_0x25c5a0,_0x3df73e[_0x3bbbae(0x187)],_0x30546f,_0x2aa339);if(_0x30546f[_0x3bbbae(0x187)]!==_0x3bbbae(0x184)){loggerService_1[_0x3bbbae(0x192)]['logWhiteDomainError'](_0x3bbbae(0x1de),_0x3bbbae(0x18b)+_0x25c5a0,_0x3bbbae(0x1e2)+(_0x30546f[_0x3bbbae(0x1ef)]||_0x30546f[_0x3bbbae(0x1a3)]||_0x3bbbae(0x1da)));throw new Error(_0x3bbbae(0x1e2)+(_0x30546f[_0x3bbbae(0x1ef)]||_0x30546f[_0x3bbbae(0x1a3)]||'Unknown\x20error'));}let _0x1a8c64=_0x3bbbae(0x19a);return{'status':_0x1a8c64};}catch(_0x2e6da3){console[_0x3bbbae(0x1a3)](_0x3bbbae(0x1df),_0x2e6da3),loggerService_1[_0x3bbbae(0x192)][_0x3bbbae(0x1ee)](_0x3bbbae(0x1de),_0x3bbbae(0x18b)+_0x25c5a0,_0x2e6da3);throw new Error(_0x3bbbae(0x1d6)+(_0x2e6da3 instanceof Error?_0x2e6da3[_0x3bbbae(0x1ef)]:_0x3bbbae(0x1da)));}}async[a47_0x10c983(0x1f3)](_0x259701){const _0x5de2b6=a47_0x10c983;console[_0x5de2b6(0x1bd)]('Processing\x20Plisio\x20webhook:',_0x259701);let _0x2c839a='PENDING';switch(_0x259701[_0x5de2b6(0x187)]?.[_0x5de2b6(0x1c5)]()){case _0x5de2b6(0x1f0):case _0x5de2b6(0x1a5):_0x2c839a=_0x5de2b6(0x1cb);break;case _0x5de2b6(0x188):_0x2c839a=_0x5de2b6(0x1d5);break;case _0x5de2b6(0x1a3):case _0x5de2b6(0x1cf):_0x2c839a=_0x5de2b6(0x1c3);break;case _0x5de2b6(0x18f):_0x2c839a=_0x5de2b6(0x19a);break;case'pending':_0x2c839a=_0x5de2b6(0x18a);break;default:_0x2c839a='PENDING';break;}let _0x104260;if(_0x259701['tx_urls'])try{console[_0x5de2b6(0x1bd)]('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x259701[_0x5de2b6(0x195)]);let _0x21ec1e;if(typeof _0x259701['tx_urls']===_0x5de2b6(0x1c1))_0x21ec1e=JSON['parse'](_0x259701[_0x5de2b6(0x195)]);else Array[_0x5de2b6(0x1ad)](_0x259701[_0x5de2b6(0x195)])?_0x21ec1e=_0x259701[_0x5de2b6(0x195)]:_0x21ec1e=[];_0x104260=_0x21ec1e['map'](_0x21b8e3=>{const _0x215153=_0x5de2b6,_0x276406=_0x21b8e3[_0x215153(0x1b7)](/\\/g,'');return console['log'](_0x215153(0x1b1)+_0x21b8e3+_0x215153(0x1be)+_0x276406),_0x276406;}),console[_0x5de2b6(0x1bd)](_0x5de2b6(0x1f5),_0x104260),_0x104260[_0x5de2b6(0x1b9)]((_0x291609,_0x21cc50)=>{const _0x221954=_0x5de2b6;try{new URL(_0x291609),console[_0x221954(0x1bd)](_0x221954(0x1c2)+(_0x21cc50+0x1)+_0x221954(0x1cd)+_0x291609);}catch(_0x3979dc){console[_0x221954(0x1a3)](_0x221954(0x1ba)+(_0x21cc50+0x1)+_0x221954(0x1af)+_0x291609,_0x3979dc);}});}catch(_0x57de2f){console[_0x5de2b6(0x1a3)](_0x5de2b6(0x1b8),_0x57de2f),console['error'](_0x5de2b6(0x1d9),_0x259701[_0x5de2b6(0x195)]),_0x104260=undefined;}return{'paymentId':_0x259701[_0x5de2b6(0x1ab)]||'','status':_0x2c839a,'amount':_0x259701[_0x5de2b6(0x1e0)],'currency':_0x259701['currency'],'txUrls':_0x104260};}}exports[a47_0x10c983(0x1d2)]=PlisioService;