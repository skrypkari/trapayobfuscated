'use strict';const a44_0x342512=a44_0x3481;function a44_0x25cf(){const _0x1401b7=['\x20->\x20','name','tx_urls','apiKey','message','txn_id','invoice_url','Plisio\x20API\x20key\x20is\x20not\x20configured','Unknown\x20error\x20from\x20Plisio\x20API','24906KxBGGr','HTTP\x20Status:','env','Response\x20data:','forEach','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','(crypto\x20for\x20payment)','Parameters:','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','HTTP\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','/operations/','Business\x20Error:\x20','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','‚úÖ\x20URL\x20','append','https://api.plisio.net/api/v1/operations/','===\x20PLISIO\x20SUCCESS\x20===','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PENDING','GET','apiUrl','toLowerCase','https://api.plisio.net/api/v1/invoices/new','===\x20PLISIO\x20API\x20ERROR\x20===','statusText','logWhiteDomainError','URL:','parse','Failed\x20to\x20create\x20Plisio\x20payment:\x20','warn','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','loggerService','\x20is\x20invalid:\x20','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','success','TesSoft\x20Payment\x20System/1.0','qr_code','stringify','PAID','Transaction\x20ID:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','log','8622xKawQR','toString','Invoice\x20URL:','source_currency','FAILED','Error\x20details:','HTTP\x20error!\x20status:\x20','Error\x20stack:','currency','(fiat\x20for\x20merchant)','createPayment','verifyPayment','isArray','4960kzdkRP','Error\x20Message:','mismatch','qr_url','/invoices/new','‚ùå\x20URL\x20','215ditqGw','completed','error','HIDDEN','Full\x20URL\x20(without\x20API\x20key):','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','PLISIO_API_KEY','Source\x20Currency:','application/json','data','242523oRbpVR','status','PlisioService','defineProperty','processWebhook','amount','../loggerService','Response\x20Time:','Failed\x20to\x20parse\x20JSON\x20response:','fromEntries','order_number','cancelled','entries','Amount:','1773975pvHlgU','pending','stack','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','map','logWhiteDomainResponse','1349898KkAYsw','source_amount','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','now','json','505648fWPRUB','Unknown\x20error','plisio_direct','string','653128SgCcHe','Target\x20Currency:','‚úÖ\x20Processed\x20tx_urls:','4fmKRgx','text','Plisio\x20API\x20error:\x20','\x20is\x20valid:\x20','logWhiteDomainRequest'];a44_0x25cf=function(){return _0x1401b7;};return a44_0x25cf();}(function(_0x4fe79a,_0x3f47bc){const _0x23e1ca=a44_0x3481,_0x50e07c=_0x4fe79a();while(!![]){try{const _0x4ea888=-parseInt(_0x23e1ca(0x1b4))/0x1+parseInt(_0x23e1ca(0x1c8))/0x2+-parseInt(_0x23e1ca(0x1c2))/0x3*(-parseInt(_0x23e1ca(0x1d4))/0x4)+parseInt(_0x23e1ca(0x221))/0x5*(-parseInt(_0x23e1ca(0x1e2))/0x6)+-parseInt(_0x23e1ca(0x1d1))/0x7+parseInt(_0x23e1ca(0x1cd))/0x8+-parseInt(_0x23e1ca(0x20e))/0x9*(parseInt(_0x23e1ca(0x21b))/0xa);if(_0x4ea888===_0x3f47bc)break;else _0x50e07c['push'](_0x50e07c['shift']());}catch(_0x1a61fe){_0x50e07c['push'](_0x50e07c['shift']());}}}(a44_0x25cf,0x53018));Object[a44_0x342512(0x1b7)](exports,'__esModule',{'value':!![]}),exports[a44_0x342512(0x1b6)]=void 0x0;function a44_0x3481(_0x653ebb,_0x2041f0){const _0x25cf8d=a44_0x25cf();return a44_0x3481=function(_0x3481a0,_0x3e13e8){_0x3481a0=_0x3481a0-0x1ab;let _0x1d61af=_0x25cf8d[_0x3481a0];return _0x1d61af;},a44_0x3481(_0x653ebb,_0x2041f0);}const loggerService_1=require(a44_0x342512(0x1ba));class PlisioService{constructor(){const _0x29f8b1=a44_0x342512;this[_0x29f8b1(0x1f8)]=_0x29f8b1(0x1fa),this[_0x29f8b1(0x1dc)]=process[_0x29f8b1(0x1e4)][_0x29f8b1(0x1b0)]||'',!this[_0x29f8b1(0x1dc)]?console[_0x29f8b1(0x201)](_0x29f8b1(0x205)):console[_0x29f8b1(0x20d)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a44_0x342512(0x218)](_0x267879){const _0x123617=a44_0x342512,{orderId:_0xeb8a,amount:_0x381024,currency:_0x1fc462,productName:_0x1fc593,description:_0x377980,successUrl:_0x2b439e,failUrl:_0x1f2aa0,customerEmail:_0x51825b,customerName:_0x216cab,isSourceCurrency:_0x31feaa,sourceCurrency:_0x2a796a}=_0x267879;if(!this['apiKey'])throw new Error(_0x123617(0x1e0));const _0x1d0c92=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0xeb8a,'order_name':_0x1fc593,'description':_0x377980,'success_url':_0x2b439e,'fail_url':_0x1f2aa0,'callback_url':'https://apitest.trapay.uk/api/webhooks/gateway/plisio'});_0x2a796a?(_0x1d0c92[_0x123617(0x1f2)](_0x123617(0x216),_0x2a796a),_0x1d0c92['append'](_0x123617(0x211),_0x1fc462),_0x1d0c92[_0x123617(0x1f2)](_0x123617(0x1c9),_0x381024[_0x123617(0x20f)]())):(_0x1d0c92[_0x123617(0x1f2)]('currency',_0x1fc462),_0x1d0c92['append'](_0x123617(0x1b9),_0x381024[_0x123617(0x20f)]()));_0x51825b&&_0x1d0c92[_0x123617(0x1f2)]('email',_0x51825b);_0x216cab&&_0x1d0c92[_0x123617(0x1f2)](_0x123617(0x1da),_0x216cab);const _0x5b1835=this[_0x123617(0x1f8)]+'?'+_0x1d0c92[_0x123617(0x20f)](),_0x22afb1=Date['now']();try{console[_0x123617(0x20d)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x123617(0x20d)](_0x123617(0x1fe),this[_0x123617(0x1f8)]),console[_0x123617(0x20d)](_0x123617(0x1e9),Object[_0x123617(0x1bd)](_0x1d0c92['entries']())),console['log'](_0x123617(0x1ae),_0x5b1835['replace'](this[_0x123617(0x1dc)],_0x123617(0x1ad))),loggerService_1['loggerService'][_0x123617(0x1d8)]('plisio_direct','/invoices/new',_0x123617(0x1f7),Object[_0x123617(0x1bd)](_0x1d0c92[_0x123617(0x1c0)]()));const _0xd1a952=await fetch(_0x5b1835,{'method':_0x123617(0x1f7),'headers':{'Accept':_0x123617(0x1b2),'User-Agent':_0x123617(0x207)}}),_0x167256=Date[_0x123617(0x1cb)]()-_0x22afb1;console['log'](_0x123617(0x20c)),console[_0x123617(0x20d)]('Status:',_0xd1a952[_0x123617(0x1b5)]),console[_0x123617(0x20d)]('Status\x20Text:',_0xd1a952[_0x123617(0x1fc)]),console['log'](_0x123617(0x1bb),_0x167256+'ms');const _0x20cc68=await _0xd1a952[_0x123617(0x1d5)]();console['log']('Raw\x20Response\x20Body:',_0x20cc68);if(!_0xd1a952['ok']){console[_0x123617(0x1ac)](_0x123617(0x1fb)),console[_0x123617(0x1ac)](_0x123617(0x1e3),_0xd1a952[_0x123617(0x1b5)]),console['error']('Response\x20Body:',_0x20cc68),loggerService_1[_0x123617(0x203)]['logWhiteDomainResponse']('plisio_direct','/invoices/new',_0xd1a952[_0x123617(0x1b5)],_0x20cc68,_0x167256),loggerService_1[_0x123617(0x203)][_0x123617(0x1fd)](_0x123617(0x1cf),_0x123617(0x21f),_0x123617(0x1eb)+_0xd1a952['status']+':\x20'+_0x20cc68);throw new Error(_0x123617(0x214)+_0xd1a952[_0x123617(0x1b5)]+',\x20body:\x20'+_0x20cc68);}let _0xb05195;try{_0xb05195=JSON[_0x123617(0x1ff)](_0x20cc68);}catch(_0x391ded){console[_0x123617(0x1ac)](_0x123617(0x1bc),_0x391ded),loggerService_1[_0x123617(0x203)][_0x123617(0x1fd)](_0x123617(0x1cf),'/invoices/new','JSON\x20Parse\x20Error:\x20'+_0x391ded);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x20cc68);}console[_0x123617(0x20d)](_0x123617(0x1ea)),console['log']('Parsed\x20Result:',JSON[_0x123617(0x209)](_0xb05195,null,0x2)),loggerService_1[_0x123617(0x203)][_0x123617(0x1c7)](_0x123617(0x1cf),_0x123617(0x21f),_0xd1a952[_0x123617(0x1b5)],_0xb05195,_0x167256);if(_0xb05195['status']!==_0x123617(0x206)){const _0x1acc41=_0xb05195[_0x123617(0x1dd)]||_0xb05195[_0x123617(0x1ac)]||_0x123617(0x1e1);console[_0x123617(0x1ac)](_0x123617(0x1ed)),console[_0x123617(0x1ac)](_0x123617(0x21c),_0x1acc41),loggerService_1['loggerService'][_0x123617(0x1fd)](_0x123617(0x1cf),_0x123617(0x21f),_0x123617(0x1ef)+_0x1acc41);throw new Error(_0x123617(0x1d6)+_0x1acc41);}if(!_0xb05195[_0x123617(0x1b3)]?.['txn_id']||!_0xb05195[_0x123617(0x1b3)]?.['invoice_url']){console[_0x123617(0x1ac)](_0x123617(0x1f5)),console[_0x123617(0x1ac)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x123617(0x1ac)](_0x123617(0x1e5),_0xb05195[_0x123617(0x1b3)]),loggerService_1['loggerService'][_0x123617(0x1fd)](_0x123617(0x1cf),'/invoices/new',_0x123617(0x1ca));throw new Error(_0x123617(0x202));}return console[_0x123617(0x20d)](_0x123617(0x1f4)),console[_0x123617(0x20d)](_0x123617(0x20b),_0xb05195[_0x123617(0x1b3)][_0x123617(0x1de)]),console[_0x123617(0x20d)](_0x123617(0x210),_0xb05195[_0x123617(0x1b3)][_0x123617(0x1df)]),console['log'](_0x123617(0x1c1),_0x381024,_0x1fc462),_0x2a796a&&(console[_0x123617(0x20d)](_0x123617(0x1b1),_0x2a796a,_0x123617(0x1e8)),console['log'](_0x123617(0x1d2),_0x1fc462,_0x123617(0x217))),{'gateway_payment_id':_0xb05195['data'][_0x123617(0x1de)],'payment_url':_0xb05195['data'][_0x123617(0x1df)],'invoice_total_sum':_0xb05195[_0x123617(0x1b3)]['invoice_total_sum'],'qr_code':_0xb05195[_0x123617(0x1b3)][_0x123617(0x208)],'qr_url':_0xb05195[_0x123617(0x1b3)][_0x123617(0x21e)]};}catch(_0x15c074){console[_0x123617(0x1ac)](_0x123617(0x1e7)),console[_0x123617(0x1ac)](_0x123617(0x213),_0x15c074),loggerService_1[_0x123617(0x203)][_0x123617(0x1fd)](_0x123617(0x1cf),_0x123617(0x21f),_0x15c074);if(_0x15c074 instanceof Error){console['error']('Error\x20message:',_0x15c074[_0x123617(0x1dd)]),console[_0x123617(0x1ac)](_0x123617(0x215),_0x15c074[_0x123617(0x1c4)]);throw new Error(_0x123617(0x200)+_0x15c074[_0x123617(0x1dd)]);}throw new Error(_0x123617(0x1ec));}}async[a44_0x342512(0x219)](_0x29f3a5){const _0x537eca=a44_0x342512,_0x19b8be=Date[_0x537eca(0x1cb)]();try{if(!this[_0x537eca(0x1dc)])throw new Error(_0x537eca(0x1e0));const _0x4cbd71=new URLSearchParams({'api_key':this[_0x537eca(0x1dc)],'txn_id':_0x29f3a5}),_0x5d510d=_0x537eca(0x1f3)+_0x29f3a5+'?'+_0x4cbd71[_0x537eca(0x20f)]();loggerService_1[_0x537eca(0x203)][_0x537eca(0x1d8)](_0x537eca(0x1cf),_0x537eca(0x1ee)+_0x29f3a5,_0x537eca(0x1f7),Object[_0x537eca(0x1bd)](_0x4cbd71[_0x537eca(0x1c0)]()));const _0x1d6b92=await fetch(_0x5d510d,{'method':'GET','headers':{'Accept':_0x537eca(0x1b2),'User-Agent':_0x537eca(0x207)}}),_0x1b4242=Date[_0x537eca(0x1cb)]()-_0x19b8be;if(!_0x1d6b92['ok']){const _0x5ec252=await _0x1d6b92[_0x537eca(0x1d5)]();loggerService_1[_0x537eca(0x203)]['logWhiteDomainResponse'](_0x537eca(0x1cf),_0x537eca(0x1ee)+_0x29f3a5,_0x1d6b92[_0x537eca(0x1b5)],_0x5ec252,_0x1b4242);throw new Error(_0x537eca(0x214)+_0x1d6b92[_0x537eca(0x1b5)]);}const _0x3b91f6=await _0x1d6b92[_0x537eca(0x1cc)]();loggerService_1[_0x537eca(0x203)][_0x537eca(0x1c7)](_0x537eca(0x1cf),_0x537eca(0x1ee)+_0x29f3a5,_0x1d6b92['status'],_0x3b91f6,_0x1b4242);if(_0x3b91f6['status']!=='success'){loggerService_1['loggerService'][_0x537eca(0x1fd)](_0x537eca(0x1cf),_0x537eca(0x1ee)+_0x29f3a5,_0x537eca(0x1d6)+(_0x3b91f6[_0x537eca(0x1dd)]||_0x3b91f6['error']||_0x537eca(0x1ce)));throw new Error(_0x537eca(0x1d6)+(_0x3b91f6['message']||_0x3b91f6[_0x537eca(0x1ac)]||_0x537eca(0x1ce)));}let _0x4b12c8=_0x537eca(0x1f6);return{'status':_0x4b12c8};}catch(_0x398298){console[_0x537eca(0x1ac)]('Plisio\x20payment\x20verification\x20error:',_0x398298),loggerService_1[_0x537eca(0x203)][_0x537eca(0x1fd)](_0x537eca(0x1cf),_0x537eca(0x1ee)+_0x29f3a5,_0x398298);throw new Error(_0x537eca(0x1f0)+(_0x398298 instanceof Error?_0x398298['message']:_0x537eca(0x1ce)));}}async[a44_0x342512(0x1b8)](_0x41ad24){const _0x2db413=a44_0x342512;console['log']('Processing\x20Plisio\x20webhook:',_0x41ad24);let _0x338c85=_0x2db413(0x1f6);switch(_0x41ad24[_0x2db413(0x1b5)]?.[_0x2db413(0x1f9)]()){case _0x2db413(0x1ab):case _0x2db413(0x21d):_0x338c85=_0x2db413(0x20a);break;case'expired':_0x338c85='EXPIRED';break;case _0x2db413(0x1ac):case _0x2db413(0x1bf):_0x338c85=_0x2db413(0x212);break;case'new':case _0x2db413(0x1c3):default:_0x338c85=_0x2db413(0x1f6);break;}let _0x4c1162;if(_0x41ad24[_0x2db413(0x1db)])try{console[_0x2db413(0x20d)](_0x2db413(0x1c5),_0x41ad24['tx_urls']);let _0x542bca;if(typeof _0x41ad24['tx_urls']===_0x2db413(0x1d0))_0x542bca=JSON['parse'](_0x41ad24[_0x2db413(0x1db)]);else Array[_0x2db413(0x21a)](_0x41ad24['tx_urls'])?_0x542bca=_0x41ad24[_0x2db413(0x1db)]:_0x542bca=[];_0x4c1162=_0x542bca[_0x2db413(0x1c6)](_0x4ffa2b=>{const _0x4aa18c=_0x2db413,_0x7025b5=_0x4ffa2b['replace'](/\\/g,'');return console[_0x4aa18c(0x20d)]('üîó\x20Formatted\x20URL:\x20'+_0x4ffa2b+_0x4aa18c(0x1d9)+_0x7025b5),_0x7025b5;}),console[_0x2db413(0x20d)](_0x2db413(0x1d3),_0x4c1162),_0x4c1162[_0x2db413(0x1e6)]((_0x49054d,_0x1ad31f)=>{const _0x4285c2=_0x2db413;try{new URL(_0x49054d),console[_0x4285c2(0x20d)](_0x4285c2(0x1f1)+(_0x1ad31f+0x1)+_0x4285c2(0x1d7)+_0x49054d);}catch(_0x1ffa17){console[_0x4285c2(0x1ac)](_0x4285c2(0x220)+(_0x1ad31f+0x1)+_0x4285c2(0x204)+_0x49054d,_0x1ffa17);}});}catch(_0x61162d){console[_0x2db413(0x1ac)](_0x2db413(0x1af),_0x61162d),console[_0x2db413(0x1ac)]('Raw\x20tx_urls\x20data:',_0x41ad24[_0x2db413(0x1db)]),_0x4c1162=undefined;}return{'paymentId':_0x41ad24[_0x2db413(0x1be)]||'','status':_0x338c85,'amount':_0x41ad24[_0x2db413(0x1b9)],'currency':_0x41ad24['currency'],'txUrls':_0x4c1162};}}exports['PlisioService']=PlisioService;