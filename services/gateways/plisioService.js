'use strict';const a62_0x46533b=a62_0x5566;function a62_0x5566(_0xf38335,_0x33e52a){_0xf38335=_0xf38335-0xbf;const _0x52231e=a62_0x5223();let _0x5566e5=_0x52231e[_0xf38335];return _0x5566e5;}(function(_0x2e2bb4,_0x298210){const _0x48e78f=a62_0x5566,_0x488ebf=_0x2e2bb4();while(!![]){try{const _0x2ceb1b=-parseInt(_0x48e78f(0xe9))/0x1+-parseInt(_0x48e78f(0x119))/0x2+-parseInt(_0x48e78f(0xf2))/0x3*(parseInt(_0x48e78f(0x128))/0x4)+-parseInt(_0x48e78f(0xc0))/0x5+parseInt(_0x48e78f(0xc6))/0x6+-parseInt(_0x48e78f(0x124))/0x7+parseInt(_0x48e78f(0x12d))/0x8*(parseInt(_0x48e78f(0xf0))/0x9);if(_0x2ceb1b===_0x298210)break;else _0x488ebf['push'](_0x488ebf['shift']());}catch(_0x4c8c75){_0x488ebf['push'](_0x488ebf['shift']());}}}(a62_0x5223,0x86f1c));function a62_0x5223(){const _0x4d1e72=['823828dyrSif','‚ùå\x20URL\x20','Full\x20URL\x20(without\x20API\x20key):','HTTP\x20','loggerService','6846584MEcesO','Plisio\x20API\x20key\x20is\x20not\x20configured','../loggerService','HTTP\x20Status:','pending','‚úÖ\x20Processed\x20tx_urls:','üîó\x20Formatted\x20URL:\x20','/operations/','replace','Error\x20message:','parse','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','https://api.trapay.uk/api/webhooks/gateway/plisio','1622095CZcBsO','HTTP\x20error!\x20status:\x20','log','Processing\x20Plisio\x20webhook:','Response\x20data:','Status\x20Text:','1002666Ltlkty','PLISIO_API_KEY','message','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','map','application/json','stringify','Error\x20stack:','HIDDEN','invoice_url','status','apiKey','===\x20PLISIO\x20API\x20ERROR\x20===','Raw\x20Response\x20Body:','Invoice\x20URL:','error','PROCESSING','tx_urls','Error\x20details:','invoice_total_sum','defineProperty','EXPIRED','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','URL:','isArray','entries','Target\x20Currency:','Unknown\x20error','name','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','fromEntries','warn','toString',',\x20body:\x20','180112ylaspM','JSON\x20Parse\x20Error:\x20','new','json','===\x20PLISIO\x20SUCCESS\x20===','https://api.plisio.net/api/v1/invoices/new','Amount:','27DVloea','data','9MAXGjS','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','amount','/invoices/new','apiUrl','Transaction\x20ID:','PENDING','Response\x20Time:','GET','__esModule','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Response\x20Body:','Business\x20Error:\x20','currency','append','Parameters:','qr_code','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','expired','statusText','\x20is\x20invalid:\x20','string','verifyPayment','\x20is\x20valid:\x20','qr_url','success','plisio_direct','source_amount','txn_id','\x20->\x20','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Failed\x20to\x20create\x20Plisio\x20payment:\x20','https://api.plisio.net/api/v1/operations/','Plisio\x20API\x20error:\x20','logWhiteDomainError','FAILED','Status:','(fiat\x20for\x20merchant)','1824168jxerKD','processWebhook','createPayment','logWhiteDomainResponse','now','‚úÖ\x20URL\x20','text','email','logWhiteDomainRequest','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','toLowerCase','1031534yshlko','Unknown\x20error\x20from\x20Plisio\x20API','stack','completed'];a62_0x5223=function(){return _0x4d1e72;};return a62_0x5223();}Object[a62_0x46533b(0xda)](exports,a62_0x46533b(0xfb),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a62_0x46533b(0x12f));class PlisioService{constructor(){const _0x3cfe94=a62_0x46533b;this['apiUrl']=_0x3cfe94(0xee),this[_0x3cfe94(0xd1)]=process['env'][_0x3cfe94(0xc7)]||'',!this[_0x3cfe94(0xd1)]?console[_0x3cfe94(0xe6)](_0x3cfe94(0x111)):console['log'](_0x3cfe94(0xdc));}async[a62_0x46533b(0x11b)](_0x1ac82e){const _0x527e50=a62_0x46533b,{orderId:_0x2fe84e,amount:_0x51acad,currency:_0x3e9e78,productName:_0xa9232f,description:_0x1a5152,successUrl:_0x36e9e4,failUrl:_0x59df9d,customerEmail:_0x1151bc,customerName:_0x476815,isSourceCurrency:_0x57ae56,sourceCurrency:_0x40c31c}=_0x1ac82e;if(!this['apiKey'])throw new Error(_0x527e50(0x12e));const _0x100026=new URLSearchParams({'api_key':this[_0x527e50(0xd1)],'order_number':_0x2fe84e,'order_name':_0xa9232f,'description':_0x1a5152,'success_url':_0x36e9e4,'fail_url':_0x59df9d,'callback_url':_0x527e50(0xbf)});_0x40c31c?(_0x100026[_0x527e50(0x100)](_0x527e50(0xff),_0x40c31c),_0x100026[_0x527e50(0x100)]('source_currency',_0x3e9e78),_0x100026['append'](_0x527e50(0x10e),_0x51acad[_0x527e50(0xe7)]())):(_0x100026[_0x527e50(0x100)](_0x527e50(0xff),_0x3e9e78),_0x100026['append'](_0x527e50(0xf4),_0x51acad[_0x527e50(0xe7)]()));_0x1151bc&&_0x100026[_0x527e50(0x100)](_0x527e50(0x120),_0x1151bc);_0x476815&&_0x100026[_0x527e50(0x100)](_0x527e50(0xe3),_0x476815);const _0x5607be=this[_0x527e50(0xf6)]+'?'+_0x100026[_0x527e50(0xe7)](),_0xd43974=Date[_0x527e50(0x11d)]();try{console[_0x527e50(0xc2)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console['log'](_0x527e50(0xde),this['apiUrl']),console[_0x527e50(0xc2)](_0x527e50(0x101),Object[_0x527e50(0xe5)](_0x100026['entries']())),console['log'](_0x527e50(0x12a),_0x5607be[_0x527e50(0x135)](this[_0x527e50(0xd1)],_0x527e50(0xce))),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x527e50(0x10d),'/invoices/new','GET',Object['fromEntries'](_0x100026[_0x527e50(0xe0)]()));const _0x4fcd43=await fetch(_0x5607be,{'method':_0x527e50(0xfa),'headers':{'Accept':_0x527e50(0xcb),'User-Agent':'Payment\x20System/1.0'}}),_0x5eceae=Date[_0x527e50(0x11d)]()-_0xd43974;console['log'](_0x527e50(0xe4)),console['log'](_0x527e50(0x117),_0x4fcd43[_0x527e50(0xd0)]),console['log'](_0x527e50(0xc5),_0x4fcd43[_0x527e50(0x106)]),console[_0x527e50(0xc2)](_0x527e50(0xf9),_0x5eceae+'ms');const _0x34a950=await _0x4fcd43['text']();console[_0x527e50(0xc2)](_0x527e50(0xd3),_0x34a950);if(!_0x4fcd43['ok']){console['error'](_0x527e50(0xd2)),console['error'](_0x527e50(0x130),_0x4fcd43[_0x527e50(0xd0)]),console[_0x527e50(0xd5)](_0x527e50(0xfd),_0x34a950),loggerService_1[_0x527e50(0x12c)]['logWhiteDomainResponse'](_0x527e50(0x10d),'/invoices/new',_0x4fcd43[_0x527e50(0xd0)],_0x34a950,_0x5eceae),loggerService_1[_0x527e50(0x12c)][_0x527e50(0x115)](_0x527e50(0x10d),_0x527e50(0xf5),_0x527e50(0x12b)+_0x4fcd43[_0x527e50(0xd0)]+':\x20'+_0x34a950);throw new Error(_0x527e50(0xc1)+_0x4fcd43['status']+_0x527e50(0xe8)+_0x34a950);}let _0x5b75e6;try{_0x5b75e6=JSON[_0x527e50(0x137)](_0x34a950);}catch(_0x6c33c1){console[_0x527e50(0xd5)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x6c33c1),loggerService_1[_0x527e50(0x12c)]['logWhiteDomainError'](_0x527e50(0x10d),_0x527e50(0xf5),_0x527e50(0xea)+_0x6c33c1);throw new Error(_0x527e50(0xfc)+_0x34a950);}console[_0x527e50(0xc2)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x527e50(0xc2)]('Parsed\x20Result:',JSON[_0x527e50(0xcc)](_0x5b75e6,null,0x2)),loggerService_1[_0x527e50(0x12c)][_0x527e50(0x11c)]('plisio_direct',_0x527e50(0xf5),_0x4fcd43[_0x527e50(0xd0)],_0x5b75e6,_0x5eceae);if(_0x5b75e6[_0x527e50(0xd0)]!==_0x527e50(0x10c)){const _0x45bac2=_0x5b75e6[_0x527e50(0xc8)]||_0x5b75e6[_0x527e50(0xd5)]||_0x527e50(0x125);console['error'](_0x527e50(0xf3)),console['error']('Error\x20Message:',_0x45bac2),loggerService_1[_0x527e50(0x12c)][_0x527e50(0x115)](_0x527e50(0x10d),'/invoices/new',_0x527e50(0xfe)+_0x45bac2);throw new Error('Plisio\x20API\x20error:\x20'+_0x45bac2);}if(!_0x5b75e6[_0x527e50(0xf1)]?.[_0x527e50(0x10f)]||!_0x5b75e6[_0x527e50(0xf1)]?.[_0x527e50(0xcf)]){console[_0x527e50(0xd5)](_0x527e50(0xc9)),console[_0x527e50(0xd5)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x527e50(0xd5)](_0x527e50(0xc4),_0x5b75e6[_0x527e50(0xf1)]),loggerService_1['loggerService'][_0x527e50(0x115)]('plisio_direct',_0x527e50(0xf5),_0x527e50(0x103));throw new Error(_0x527e50(0xdd));}return console['log'](_0x527e50(0xed)),console[_0x527e50(0xc2)](_0x527e50(0xf7),_0x5b75e6['data'][_0x527e50(0x10f)]),console[_0x527e50(0xc2)](_0x527e50(0xd4),_0x5b75e6['data'][_0x527e50(0xcf)]),console[_0x527e50(0xc2)](_0x527e50(0xef),_0x51acad,_0x3e9e78),_0x40c31c&&(console[_0x527e50(0xc2)]('Source\x20Currency:',_0x40c31c,'(crypto\x20for\x20payment)'),console[_0x527e50(0xc2)](_0x527e50(0xe1),_0x3e9e78,_0x527e50(0x118))),{'gateway_payment_id':_0x5b75e6['data'][_0x527e50(0x10f)],'payment_url':_0x5b75e6[_0x527e50(0xf1)][_0x527e50(0xcf)],'invoice_total_sum':_0x5b75e6[_0x527e50(0xf1)][_0x527e50(0xd9)],'qr_code':_0x5b75e6[_0x527e50(0xf1)][_0x527e50(0x102)],'qr_url':_0x5b75e6[_0x527e50(0xf1)][_0x527e50(0x10b)]};}catch(_0x3bed18){console[_0x527e50(0xd5)](_0x527e50(0x138)),console['error'](_0x527e50(0xd8),_0x3bed18),loggerService_1['loggerService'][_0x527e50(0x115)](_0x527e50(0x10d),'/invoices/new',_0x3bed18);if(_0x3bed18 instanceof Error){console[_0x527e50(0xd5)](_0x527e50(0x136),_0x3bed18[_0x527e50(0xc8)]),console[_0x527e50(0xd5)](_0x527e50(0xcd),_0x3bed18[_0x527e50(0x126)]);throw new Error(_0x527e50(0x112)+_0x3bed18[_0x527e50(0xc8)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a62_0x46533b(0x109)](_0x31aa4b){const _0x22e495=a62_0x46533b,_0x1b51f8=Date['now']();try{if(!this['apiKey'])throw new Error(_0x22e495(0x12e));const _0x4d9c6c=new URLSearchParams({'api_key':this[_0x22e495(0xd1)],'txn_id':_0x31aa4b}),_0x498747=_0x22e495(0x113)+_0x31aa4b+'?'+_0x4d9c6c['toString']();loggerService_1[_0x22e495(0x12c)][_0x22e495(0x121)](_0x22e495(0x10d),_0x22e495(0x134)+_0x31aa4b,_0x22e495(0xfa),Object['fromEntries'](_0x4d9c6c[_0x22e495(0xe0)]()));const _0x5e2d2a=await fetch(_0x498747,{'method':_0x22e495(0xfa),'headers':{'Accept':_0x22e495(0xcb),'User-Agent':'Payment\x20System/1.0'}}),_0x5e01a4=Date[_0x22e495(0x11d)]()-_0x1b51f8;if(!_0x5e2d2a['ok']){const _0x547ac7=await _0x5e2d2a[_0x22e495(0x11f)]();loggerService_1['loggerService'][_0x22e495(0x11c)](_0x22e495(0x10d),_0x22e495(0x134)+_0x31aa4b,_0x5e2d2a[_0x22e495(0xd0)],_0x547ac7,_0x5e01a4);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5e2d2a[_0x22e495(0xd0)]);}const _0x4343d1=await _0x5e2d2a[_0x22e495(0xec)]();loggerService_1[_0x22e495(0x12c)][_0x22e495(0x11c)](_0x22e495(0x10d),'/operations/'+_0x31aa4b,_0x5e2d2a['status'],_0x4343d1,_0x5e01a4);if(_0x4343d1[_0x22e495(0xd0)]!==_0x22e495(0x10c)){loggerService_1[_0x22e495(0x12c)][_0x22e495(0x115)](_0x22e495(0x10d),_0x22e495(0x134)+_0x31aa4b,_0x22e495(0x114)+(_0x4343d1[_0x22e495(0xc8)]||_0x4343d1[_0x22e495(0xd5)]||_0x22e495(0xe2)));throw new Error(_0x22e495(0x114)+(_0x4343d1['message']||_0x4343d1[_0x22e495(0xd5)]||'Unknown\x20error'));}let _0x513469=_0x22e495(0xf8);return{'status':_0x513469};}catch(_0x3ba8a7){console[_0x22e495(0xd5)]('Plisio\x20payment\x20verification\x20error:',_0x3ba8a7),loggerService_1[_0x22e495(0x12c)][_0x22e495(0x115)](_0x22e495(0x10d),_0x22e495(0x134)+_0x31aa4b,_0x3ba8a7);throw new Error(_0x22e495(0x122)+(_0x3ba8a7 instanceof Error?_0x3ba8a7[_0x22e495(0xc8)]:_0x22e495(0xe2)));}}async[a62_0x46533b(0x11a)](_0x4b0d1a){const _0x26708c=a62_0x46533b;console['log'](_0x26708c(0xc3),_0x4b0d1a);let _0x3ef98d=_0x26708c(0xf8);switch(_0x4b0d1a[_0x26708c(0xd0)]?.[_0x26708c(0x123)]()){case _0x26708c(0x127):case'mismatch':_0x3ef98d='PAID';break;case _0x26708c(0x105):_0x3ef98d=_0x26708c(0xdb);break;case _0x26708c(0xd5):case'cancelled':_0x3ef98d=_0x26708c(0x116);break;case _0x26708c(0xeb):_0x3ef98d=_0x26708c(0xf8);break;case _0x26708c(0x131):_0x3ef98d=_0x26708c(0xd6);break;default:_0x3ef98d=_0x26708c(0xf8);break;}let _0x2c8bc9;if(_0x4b0d1a['tx_urls'])try{console['log'](_0x26708c(0x104),_0x4b0d1a[_0x26708c(0xd7)]);let _0x20ea65;if(typeof _0x4b0d1a[_0x26708c(0xd7)]===_0x26708c(0x108))_0x20ea65=JSON[_0x26708c(0x137)](_0x4b0d1a[_0x26708c(0xd7)]);else Array[_0x26708c(0xdf)](_0x4b0d1a[_0x26708c(0xd7)])?_0x20ea65=_0x4b0d1a['tx_urls']:_0x20ea65=[];_0x2c8bc9=_0x20ea65[_0x26708c(0xca)](_0x46e4a5=>{const _0xa4305f=_0x26708c,_0x3f6c08=_0x46e4a5[_0xa4305f(0x135)](/\\/g,'');return console[_0xa4305f(0xc2)](_0xa4305f(0x133)+_0x46e4a5+_0xa4305f(0x110)+_0x3f6c08),_0x3f6c08;}),console[_0x26708c(0xc2)](_0x26708c(0x132),_0x2c8bc9),_0x2c8bc9['forEach']((_0x4c8168,_0x427686)=>{const _0x538b7f=_0x26708c;try{new URL(_0x4c8168),console[_0x538b7f(0xc2)](_0x538b7f(0x11e)+(_0x427686+0x1)+_0x538b7f(0x10a)+_0x4c8168);}catch(_0x1931d4){console[_0x538b7f(0xd5)](_0x538b7f(0x129)+(_0x427686+0x1)+_0x538b7f(0x107)+_0x4c8168,_0x1931d4);}});}catch(_0x46a9eb){console[_0x26708c(0xd5)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x46a9eb),console['error']('Raw\x20tx_urls\x20data:',_0x4b0d1a[_0x26708c(0xd7)]),_0x2c8bc9=undefined;}return{'paymentId':_0x4b0d1a['order_number']||'','status':_0x3ef98d,'amount':_0x4b0d1a['amount'],'currency':_0x4b0d1a[_0x26708c(0xff)],'txUrls':_0x2c8bc9};}}exports['PlisioService']=PlisioService;