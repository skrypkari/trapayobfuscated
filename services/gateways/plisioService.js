'use strict';function a51_0xaaf3(){const _0x2e99a3=['Invoice\x20URL:','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Response\x20data:','Status:','parse','verifyPayment','log','invoice_total_sum','apiKey','source_amount','createPayment','Raw\x20tx_urls\x20data:','apiUrl','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Error\x20stack:','Unknown\x20error','29658FuvvGS','GET','❌\x20URL\x20','invoice_url','Status\x20Text:','email','Raw\x20Response\x20Body:','54402ufWdAI','tx_urls','TesSoft\x20Payment\x20System/1.0','❌\x20Failed\x20to\x20parse\x20tx_urls:','map','973RBzHib','81912MqNSko','===\x20PLISIO\x20API\x20ERROR\x20===','toLowerCase','string','plisio_direct','31bWLJHF','qr_url','currency','pending','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','FAILED','Error\x20Message:','isArray','HTTP\x20','data','EXPIRED','stringify','\x20is\x20invalid:\x20','error','PlisioService','/invoices/new','entries','amount','defineProperty','qr_code','expired','Processing\x20Plisio\x20webhook:',',\x20body:\x20','warn','Amount:','replace','stack','logWhiteDomainRequest','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','json','Full\x20URL\x20(without\x20API\x20key):','/operations/','Target\x20Currency:','source_currency','env','Response\x20Body:','Parsed\x20Result:','message','append','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','https://api.trapay.uk/api/webhooks/gateway/plisio','forEach','(fiat\x20for\x20merchant)','23456988ooSADH','2510605igoDVh','Plisio\x20API\x20error:\x20','statusText','logWhiteDomainError','HTTP\x20Status:','\x20->\x20','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','now','PROCESSING','Response\x20Time:','(crypto\x20for\x20payment)','text','name','Parameters:','Plisio\x20payment\x20verification\x20error:','🔗\x20Formatted\x20URL:\x20','HTTP\x20error!\x20status:\x20','success','processWebhook','toString','completed','application/json','JSON\x20Parse\x20Error:\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Error\x20message:','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','fromEntries','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','\x20is\x20valid:\x20','mismatch','txn_id','6603240uUzfRh','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','logWhiteDomainResponse','loggerService','PENDING','status','1186148pqfBRs'];a51_0xaaf3=function(){return _0x2e99a3;};return a51_0xaaf3();}function a51_0xed94(_0x16e63c,_0x1030e2){const _0xaaf35c=a51_0xaaf3();return a51_0xed94=function(_0xed942a,_0x202269){_0xed942a=_0xed942a-0x6e;let _0x29aa53=_0xaaf35c[_0xed942a];return _0x29aa53;},a51_0xed94(_0x16e63c,_0x1030e2);}const a51_0x34af5d=a51_0xed94;(function(_0x238892,_0x557d9e){const _0x4af92d=a51_0xed94,_0xa4ca08=_0x238892();while(!![]){try{const _0x3673ab=-parseInt(_0x4af92d(0x8d))/0x1*(parseInt(_0x4af92d(0x82))/0x2)+-parseInt(_0x4af92d(0x88))/0x3+-parseInt(_0x4af92d(0xde))/0x4+parseInt(_0x4af92d(0xb9))/0x5+-parseInt(_0x4af92d(0x7b))/0x6*(parseInt(_0x4af92d(0x87))/0x7)+-parseInt(_0x4af92d(0xd8))/0x8+parseInt(_0x4af92d(0xb8))/0x9;if(_0x3673ab===_0x557d9e)break;else _0xa4ca08['push'](_0xa4ca08['shift']());}catch(_0x330dc4){_0xa4ca08['push'](_0xa4ca08['shift']());}}}(a51_0xaaf3,0x68b63));Object[a51_0x34af5d(0x9f)](exports,'__esModule',{'value':!![]}),exports[a51_0x34af5d(0x9b)]=void 0x0;const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x3c3bce=a51_0x34af5d;this['apiUrl']='https://api.plisio.net/api/v1/invoices/new',this[_0x3c3bce(0x73)]=process[_0x3c3bce(0xaf)]['PLISIO_API_KEY']||'',!this[_0x3c3bce(0x73)]?console[_0x3c3bce(0xa4)](_0x3c3bce(0xe0)):console['log'](_0x3c3bce(0xd4));}async[a51_0x34af5d(0x75)](_0x368bac){const _0x388c2b=a51_0x34af5d,{orderId:_0x46c03e,amount:_0x206071,currency:_0x43e893,productName:_0x932826,description:_0x39b48f,successUrl:_0x9660fd,failUrl:_0x446808,customerEmail:_0x41bf0b,customerName:_0x69d7b7,isSourceCurrency:_0x171315,sourceCurrency:_0x1fc826}=_0x368bac;if(!this[_0x388c2b(0x73)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x478dc6=new URLSearchParams({'api_key':this[_0x388c2b(0x73)],'order_number':_0x46c03e,'order_name':_0x932826,'description':_0x39b48f,'success_url':_0x9660fd,'fail_url':_0x446808,'callback_url':_0x388c2b(0xb5)});_0x1fc826?(_0x478dc6[_0x388c2b(0xb3)](_0x388c2b(0x8f),_0x1fc826),_0x478dc6[_0x388c2b(0xb3)](_0x388c2b(0xae),_0x43e893),_0x478dc6[_0x388c2b(0xb3)](_0x388c2b(0x74),_0x206071[_0x388c2b(0xcc)]())):(_0x478dc6['append'](_0x388c2b(0x8f),_0x43e893),_0x478dc6[_0x388c2b(0xb3)](_0x388c2b(0x9e),_0x206071[_0x388c2b(0xcc)]()));_0x41bf0b&&_0x478dc6['append'](_0x388c2b(0x80),_0x41bf0b);_0x69d7b7&&_0x478dc6[_0x388c2b(0xb3)](_0x388c2b(0xc5),_0x69d7b7);const _0x27bc88=this[_0x388c2b(0x77)]+'?'+_0x478dc6[_0x388c2b(0xcc)](),_0x4a4093=Date[_0x388c2b(0xc0)]();try{console[_0x388c2b(0x71)](_0x388c2b(0x91)),console['log']('URL:',this[_0x388c2b(0x77)]),console[_0x388c2b(0x71)](_0x388c2b(0xc6),Object[_0x388c2b(0xd3)](_0x478dc6[_0x388c2b(0x9d)]())),console['log'](_0x388c2b(0xab),_0x27bc88[_0x388c2b(0xa6)](this[_0x388c2b(0x73)],'HIDDEN')),loggerService_1['loggerService'][_0x388c2b(0xa8)](_0x388c2b(0x8c),_0x388c2b(0x9c),_0x388c2b(0x7c),Object[_0x388c2b(0xd3)](_0x478dc6[_0x388c2b(0x9d)]()));const _0x2be81d=await fetch(_0x27bc88,{'method':_0x388c2b(0x7c),'headers':{'Accept':_0x388c2b(0xce),'User-Agent':_0x388c2b(0x84)}}),_0x4a7daf=Date[_0x388c2b(0xc0)]()-_0x4a4093;console[_0x388c2b(0x71)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x388c2b(0x71)](_0x388c2b(0x6e),_0x2be81d[_0x388c2b(0xdd)]),console['log'](_0x388c2b(0x7f),_0x2be81d[_0x388c2b(0xbb)]),console[_0x388c2b(0x71)](_0x388c2b(0xc2),_0x4a7daf+'ms');const _0x3c0b3c=await _0x2be81d['text']();console['log'](_0x388c2b(0x81),_0x3c0b3c);if(!_0x2be81d['ok']){console[_0x388c2b(0x9a)](_0x388c2b(0x89)),console[_0x388c2b(0x9a)](_0x388c2b(0xbd),_0x2be81d[_0x388c2b(0xdd)]),console[_0x388c2b(0x9a)](_0x388c2b(0xb0),_0x3c0b3c),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x388c2b(0x8c),_0x388c2b(0x9c),_0x2be81d[_0x388c2b(0xdd)],_0x3c0b3c,_0x4a7daf),loggerService_1[_0x388c2b(0xdb)]['logWhiteDomainError'](_0x388c2b(0x8c),'/invoices/new',_0x388c2b(0x95)+_0x2be81d[_0x388c2b(0xdd)]+':\x20'+_0x3c0b3c);throw new Error(_0x388c2b(0xc9)+_0x2be81d['status']+_0x388c2b(0xa3)+_0x3c0b3c);}let _0x469f1d;try{_0x469f1d=JSON['parse'](_0x3c0b3c);}catch(_0xe10a67){console[_0x388c2b(0x9a)]('Failed\x20to\x20parse\x20JSON\x20response:',_0xe10a67),loggerService_1[_0x388c2b(0xdb)][_0x388c2b(0xbc)](_0x388c2b(0x8c),_0x388c2b(0x9c),_0x388c2b(0xcf)+_0xe10a67);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x3c0b3c);}console[_0x388c2b(0x71)](_0x388c2b(0xbf)),console[_0x388c2b(0x71)](_0x388c2b(0xb1),JSON[_0x388c2b(0x98)](_0x469f1d,null,0x2)),loggerService_1[_0x388c2b(0xdb)]['logWhiteDomainResponse'](_0x388c2b(0x8c),_0x388c2b(0x9c),_0x2be81d['status'],_0x469f1d,_0x4a7daf);if(_0x469f1d[_0x388c2b(0xdd)]!==_0x388c2b(0xca)){const _0x27f3f1=_0x469f1d['message']||_0x469f1d[_0x388c2b(0x9a)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x388c2b(0x9a)](_0x388c2b(0x78)),console[_0x388c2b(0x9a)](_0x388c2b(0x93),_0x27f3f1),loggerService_1['loggerService'][_0x388c2b(0xbc)](_0x388c2b(0x8c),'/invoices/new','Business\x20Error:\x20'+_0x27f3f1);throw new Error(_0x388c2b(0xba)+_0x27f3f1);}if(!_0x469f1d[_0x388c2b(0x96)]?.['txn_id']||!_0x469f1d[_0x388c2b(0x96)]?.['invoice_url']){console[_0x388c2b(0x9a)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x388c2b(0x9a)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x388c2b(0x9a)](_0x388c2b(0xe1),_0x469f1d[_0x388c2b(0x96)]),loggerService_1['loggerService'][_0x388c2b(0xbc)](_0x388c2b(0x8c),_0x388c2b(0x9c),_0x388c2b(0xb4));throw new Error(_0x388c2b(0xd9));}return console[_0x388c2b(0x71)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x388c2b(0x71)]('Transaction\x20ID:',_0x469f1d[_0x388c2b(0x96)][_0x388c2b(0xd7)]),console[_0x388c2b(0x71)](_0x388c2b(0xdf),_0x469f1d[_0x388c2b(0x96)][_0x388c2b(0x7e)]),console['log'](_0x388c2b(0xa5),_0x206071,_0x43e893),_0x1fc826&&(console[_0x388c2b(0x71)]('Source\x20Currency:',_0x1fc826,_0x388c2b(0xc3)),console[_0x388c2b(0x71)](_0x388c2b(0xad),_0x43e893,_0x388c2b(0xb7))),{'gateway_payment_id':_0x469f1d[_0x388c2b(0x96)]['txn_id'],'payment_url':_0x469f1d[_0x388c2b(0x96)]['invoice_url'],'invoice_total_sum':_0x469f1d[_0x388c2b(0x96)][_0x388c2b(0x72)],'qr_code':_0x469f1d[_0x388c2b(0x96)][_0x388c2b(0xa0)],'qr_url':_0x469f1d[_0x388c2b(0x96)][_0x388c2b(0x8e)]};}catch(_0x4fed8c){console['error'](_0x388c2b(0xd2)),console[_0x388c2b(0x9a)]('Error\x20details:',_0x4fed8c),loggerService_1[_0x388c2b(0xdb)][_0x388c2b(0xbc)]('plisio_direct',_0x388c2b(0x9c),_0x4fed8c);if(_0x4fed8c instanceof Error){console[_0x388c2b(0x9a)](_0x388c2b(0xd1),_0x4fed8c[_0x388c2b(0xb2)]),console[_0x388c2b(0x9a)](_0x388c2b(0x79),_0x4fed8c[_0x388c2b(0xa7)]);throw new Error(_0x388c2b(0xd0)+_0x4fed8c[_0x388c2b(0xb2)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a51_0x34af5d(0x70)](_0xf594fa){const _0x218e9a=a51_0x34af5d,_0x40a226=Date['now']();try{if(!this[_0x218e9a(0x73)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x1165b6=new URLSearchParams({'api_key':this[_0x218e9a(0x73)],'txn_id':_0xf594fa}),_0x2a34d3='https://api.plisio.net/api/v1/operations/'+_0xf594fa+'?'+_0x1165b6[_0x218e9a(0xcc)]();loggerService_1['loggerService']['logWhiteDomainRequest'](_0x218e9a(0x8c),'/operations/'+_0xf594fa,'GET',Object[_0x218e9a(0xd3)](_0x1165b6[_0x218e9a(0x9d)]()));const _0x491f37=await fetch(_0x2a34d3,{'method':_0x218e9a(0x7c),'headers':{'Accept':'application/json','User-Agent':_0x218e9a(0x84)}}),_0x40a3b2=Date[_0x218e9a(0xc0)]()-_0x40a226;if(!_0x491f37['ok']){const _0x11180a=await _0x491f37[_0x218e9a(0xc4)]();loggerService_1[_0x218e9a(0xdb)]['logWhiteDomainResponse'](_0x218e9a(0x8c),'/operations/'+_0xf594fa,_0x491f37['status'],_0x11180a,_0x40a3b2);throw new Error(_0x218e9a(0xc9)+_0x491f37[_0x218e9a(0xdd)]);}const _0x1f02ca=await _0x491f37[_0x218e9a(0xaa)]();loggerService_1[_0x218e9a(0xdb)][_0x218e9a(0xda)](_0x218e9a(0x8c),_0x218e9a(0xac)+_0xf594fa,_0x491f37[_0x218e9a(0xdd)],_0x1f02ca,_0x40a3b2);if(_0x1f02ca[_0x218e9a(0xdd)]!==_0x218e9a(0xca)){loggerService_1['loggerService'][_0x218e9a(0xbc)](_0x218e9a(0x8c),_0x218e9a(0xac)+_0xf594fa,_0x218e9a(0xba)+(_0x1f02ca['message']||_0x1f02ca[_0x218e9a(0x9a)]||'Unknown\x20error'));throw new Error('Plisio\x20API\x20error:\x20'+(_0x1f02ca[_0x218e9a(0xb2)]||_0x1f02ca[_0x218e9a(0x9a)]||_0x218e9a(0x7a)));}let _0x40935c='PENDING';return{'status':_0x40935c};}catch(_0x559505){console[_0x218e9a(0x9a)](_0x218e9a(0xc7),_0x559505),loggerService_1[_0x218e9a(0xdb)][_0x218e9a(0xbc)](_0x218e9a(0x8c),_0x218e9a(0xac)+_0xf594fa,_0x559505);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x559505 instanceof Error?_0x559505[_0x218e9a(0xb2)]:_0x218e9a(0x7a)));}}async[a51_0x34af5d(0xcb)](_0x149153){const _0x164980=a51_0x34af5d;console['log'](_0x164980(0xa2),_0x149153);let _0x3d4676=_0x164980(0xdc);switch(_0x149153[_0x164980(0xdd)]?.[_0x164980(0x8a)]()){case _0x164980(0xcd):case _0x164980(0xd6):_0x3d4676='PAID';break;case _0x164980(0xa1):_0x3d4676=_0x164980(0x97);break;case _0x164980(0x9a):case'cancelled':_0x3d4676=_0x164980(0x92);break;case'new':_0x3d4676=_0x164980(0xdc);break;case _0x164980(0x90):_0x3d4676=_0x164980(0xc1);break;default:_0x3d4676=_0x164980(0xdc);break;}let _0x529d43;if(_0x149153['tx_urls'])try{console[_0x164980(0x71)](_0x164980(0xa9),_0x149153[_0x164980(0x83)]);let _0x21c07f;if(typeof _0x149153[_0x164980(0x83)]===_0x164980(0x8b))_0x21c07f=JSON[_0x164980(0x6f)](_0x149153[_0x164980(0x83)]);else Array[_0x164980(0x94)](_0x149153[_0x164980(0x83)])?_0x21c07f=_0x149153[_0x164980(0x83)]:_0x21c07f=[];_0x529d43=_0x21c07f[_0x164980(0x86)](_0x1602d5=>{const _0x2b6089=_0x164980,_0x362212=_0x1602d5[_0x2b6089(0xa6)](/\\/g,'');return console['log'](_0x2b6089(0xc8)+_0x1602d5+_0x2b6089(0xbe)+_0x362212),_0x362212;}),console['log']('✅\x20Processed\x20tx_urls:',_0x529d43),_0x529d43[_0x164980(0xb6)]((_0xbd5c86,_0x499cf0)=>{const _0x3c8c0a=_0x164980;try{new URL(_0xbd5c86),console[_0x3c8c0a(0x71)]('✅\x20URL\x20'+(_0x499cf0+0x1)+_0x3c8c0a(0xd5)+_0xbd5c86);}catch(_0x1e8c6a){console[_0x3c8c0a(0x9a)](_0x3c8c0a(0x7d)+(_0x499cf0+0x1)+_0x3c8c0a(0x99)+_0xbd5c86,_0x1e8c6a);}});}catch(_0x1e95ab){console[_0x164980(0x9a)](_0x164980(0x85),_0x1e95ab),console['error'](_0x164980(0x76),_0x149153[_0x164980(0x83)]),_0x529d43=undefined;}return{'paymentId':_0x149153['order_number']||'','status':_0x3d4676,'amount':_0x149153['amount'],'currency':_0x149153[_0x164980(0x8f)],'txUrls':_0x529d43};}}exports[a51_0x34af5d(0x9b)]=PlisioService;