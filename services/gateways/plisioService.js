'use strict';const a41_0x321c51=a41_0x2343;(function(_0x3b5344,_0x425aa2){const _0x4e08a6=a41_0x2343,_0x4a7081=_0x3b5344();while(!![]){try{const _0x496e11=parseInt(_0x4e08a6(0x1b3))/0x1+parseInt(_0x4e08a6(0x189))/0x2+-parseInt(_0x4e08a6(0x1d3))/0x3*(-parseInt(_0x4e08a6(0x1ac))/0x4)+parseInt(_0x4e08a6(0x1be))/0x5+parseInt(_0x4e08a6(0x1ad))/0x6+-parseInt(_0x4e08a6(0x18c))/0x7+-parseInt(_0x4e08a6(0x1ab))/0x8*(parseInt(_0x4e08a6(0x1cd))/0x9);if(_0x496e11===_0x425aa2)break;else _0x4a7081['push'](_0x4a7081['shift']());}catch(_0x2ee358){_0x4a7081['push'](_0x4a7081['shift']());}}}(a41_0x49e0,0xd84ec));function a41_0x2343(_0x3900d2,_0x1bb19f){const _0x49e06e=a41_0x49e0();return a41_0x2343=function(_0x2343d9,_0x2ff200){_0x2343d9=_0x2343d9-0x184;let _0x5e303c=_0x49e06e[_0x2343d9];return _0x5e303c;},a41_0x2343(_0x3900d2,_0x1bb19f);}function a41_0x49e0(){const _0xd2d0d7=['Full\x20URL\x20(without\x20API\x20key):','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','PlisioService','invoice_total_sum','json','PAID','PLISIO_API_KEY','Failed\x20to\x20parse\x20JSON\x20response:','env','entries','status','mismatch','logWhiteDomainError','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Error\x20Message:','Error\x20message:','Plisio\x20API\x20key\x20is\x20not\x20configured','Error\x20stack:','TesSoft\x20Payment\x20System/1.0','warn','FAILED','invoice_url','HTTP\x20','Source\x20Currency:','pending','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Parameters:','679112InkcZV','application/json','order_number','2892316fgvlOc','txn_id','Processing\x20Plisio\x20webhook:','Target\x20Currency:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','HTTP\x20error!\x20status:\x20','EXPIRED','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url',',\x20body:\x20','Response\x20Body:','message','expired','Plisio\x20API\x20error:\x20','cancelled','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','PENDING','Amount:','error','Raw\x20Response\x20Body:','stack','JSON\x20Parse\x20Error:\x20','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','Error\x20details:','apiKey','toString','Status:','Status\x20Text:','statusText','stringify','logWhiteDomainResponse','Unknown\x20error','8YErYMw','932nWMpyG','6399084wofOjm','new','data','Parsed\x20Result:','fromEntries','/invoices/new','492462RCiSXP','(fiat\x20for\x20merchant)','../loggerService','verifyPayment','currency','HIDDEN','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Transaction\x20ID:','/operations/','GET','Response\x20data:','7351840yjZFke','https://api.plisio.net/api/v1/invoices/new','source_currency','apiUrl','log','logWhiteDomainRequest','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','https://api.trapay.uk/api/webhooks/gateway/plisio','Business\x20Error:\x20','createPayment','===\x20PLISIO\x20API\x20ERROR\x20===','qr_url','toLowerCase','plisio_direct','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','34294131MraccP','processWebhook','replace','name','amount','__esModule','22413iecBcL','now','Plisio\x20payment\x20verification\x20error:','append','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','success','loggerService','source_amount','text','parse'];a41_0x49e0=function(){return _0xd2d0d7;};return a41_0x49e0();}Object['defineProperty'](exports,a41_0x321c51(0x1d2),{'value':!![]}),exports[a41_0x321c51(0x1df)]=void 0x0;const loggerService_1=require(a41_0x321c51(0x1b5));class PlisioService{constructor(){const _0x3297db=a41_0x321c51;this[_0x3297db(0x1c1)]=_0x3297db(0x1bf),this['apiKey']=process[_0x3297db(0x1e5)][_0x3297db(0x1e3)]||'',!this['apiKey']?console[_0x3297db(0x1f0)](_0x3297db(0x1b9)):console[_0x3297db(0x1c2)](_0x3297db(0x1cc));}async[a41_0x321c51(0x1c7)](_0x5249a2){const _0x5b7073=a41_0x321c51,{orderId:_0x29e31a,amount:_0x3fe552,currency:_0x38ec6d,productName:_0x167e5e,description:_0x5dfe08,successUrl:_0x5401d5,failUrl:_0x1210c0,customerEmail:_0x5bdaac,customerName:_0x9f31f,isSourceCurrency:_0x5129e5,sourceCurrency:_0x423379}=_0x5249a2;if(!this[_0x5b7073(0x1a3)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x18c498=new URLSearchParams({'api_key':this[_0x5b7073(0x1a3)],'order_number':_0x29e31a,'order_name':_0x167e5e,'description':_0x5dfe08,'success_url':_0x5401d5,'fail_url':_0x1210c0,'callback_url':_0x5b7073(0x1c5)});_0x423379?(_0x18c498[_0x5b7073(0x1d6)](_0x5b7073(0x1b7),_0x423379),_0x18c498[_0x5b7073(0x1d6)](_0x5b7073(0x1c0),_0x38ec6d),_0x18c498[_0x5b7073(0x1d6)](_0x5b7073(0x1da),_0x3fe552[_0x5b7073(0x1a4)]())):(_0x18c498[_0x5b7073(0x1d6)](_0x5b7073(0x1b7),_0x38ec6d),_0x18c498[_0x5b7073(0x1d6)](_0x5b7073(0x1d1),_0x3fe552[_0x5b7073(0x1a4)]()));_0x5bdaac&&_0x18c498[_0x5b7073(0x1d6)]('email',_0x5bdaac);_0x9f31f&&_0x18c498['append'](_0x5b7073(0x1d0),_0x9f31f);const _0x15df67=this[_0x5b7073(0x1c1)]+'?'+_0x18c498[_0x5b7073(0x1a4)](),_0x2e6ab0=Date['now']();try{console[_0x5b7073(0x1c2)](_0x5b7073(0x1c4)),console[_0x5b7073(0x1c2)]('URL:',this['apiUrl']),console[_0x5b7073(0x1c2)](_0x5b7073(0x188),Object['fromEntries'](_0x18c498[_0x5b7073(0x1e6)]())),console[_0x5b7073(0x1c2)](_0x5b7073(0x1dd),_0x15df67[_0x5b7073(0x1cf)](this[_0x5b7073(0x1a3)],_0x5b7073(0x1b8))),loggerService_1[_0x5b7073(0x1d9)][_0x5b7073(0x1c3)]('plisio_direct',_0x5b7073(0x1b2),_0x5b7073(0x1bc),Object['fromEntries'](_0x18c498[_0x5b7073(0x1e6)]()));const _0x4b6f9e=await fetch(_0x15df67,{'method':_0x5b7073(0x1bc),'headers':{'Accept':'application/json','User-Agent':_0x5b7073(0x1ef)}}),_0x40a83b=Date[_0x5b7073(0x1d4)]()-_0x2e6ab0;console[_0x5b7073(0x1c2)](_0x5b7073(0x1a1)),console[_0x5b7073(0x1c2)](_0x5b7073(0x1a5),_0x4b6f9e[_0x5b7073(0x1e7)]),console[_0x5b7073(0x1c2)](_0x5b7073(0x1a6),_0x4b6f9e[_0x5b7073(0x1a7)]),console[_0x5b7073(0x1c2)]('Response\x20Time:',_0x40a83b+'ms');const _0x55684d=await _0x4b6f9e[_0x5b7073(0x1db)]();console[_0x5b7073(0x1c2)](_0x5b7073(0x19e),_0x55684d);if(!_0x4b6f9e['ok']){console[_0x5b7073(0x19d)](_0x5b7073(0x1c8)),console[_0x5b7073(0x19d)]('HTTP\x20Status:',_0x4b6f9e[_0x5b7073(0x1e7)]),console[_0x5b7073(0x19d)](_0x5b7073(0x195),_0x55684d),loggerService_1[_0x5b7073(0x1d9)][_0x5b7073(0x1a9)](_0x5b7073(0x1cb),_0x5b7073(0x1b2),_0x4b6f9e[_0x5b7073(0x1e7)],_0x55684d,_0x40a83b),loggerService_1[_0x5b7073(0x1d9)][_0x5b7073(0x1e9)](_0x5b7073(0x1cb),_0x5b7073(0x1b2),_0x5b7073(0x184)+_0x4b6f9e['status']+':\x20'+_0x55684d);throw new Error(_0x5b7073(0x191)+_0x4b6f9e[_0x5b7073(0x1e7)]+_0x5b7073(0x194)+_0x55684d);}let _0x55444c;try{_0x55444c=JSON[_0x5b7073(0x1dc)](_0x55684d);}catch(_0x29feca){console[_0x5b7073(0x19d)](_0x5b7073(0x1e4),_0x29feca),loggerService_1['loggerService'][_0x5b7073(0x1e9)](_0x5b7073(0x1cb),_0x5b7073(0x1b2),_0x5b7073(0x1a0)+_0x29feca);throw new Error(_0x5b7073(0x19a)+_0x55684d);}console[_0x5b7073(0x1c2)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x5b7073(0x1c2)](_0x5b7073(0x1b0),JSON[_0x5b7073(0x1a8)](_0x55444c,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x5b7073(0x1cb),_0x5b7073(0x1b2),_0x4b6f9e[_0x5b7073(0x1e7)],_0x55444c,_0x40a83b);if(_0x55444c[_0x5b7073(0x1e7)]!==_0x5b7073(0x1d8)){const _0xc20ef=_0x55444c[_0x5b7073(0x196)]||_0x55444c[_0x5b7073(0x19d)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x5b7073(0x19d)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x5b7073(0x1eb),_0xc20ef),loggerService_1[_0x5b7073(0x1d9)][_0x5b7073(0x1e9)](_0x5b7073(0x1cb),_0x5b7073(0x1b2),_0x5b7073(0x1c6)+_0xc20ef);throw new Error(_0x5b7073(0x198)+_0xc20ef);}if(!_0x55444c[_0x5b7073(0x1af)]?.[_0x5b7073(0x18d)]||!_0x55444c['data']?.[_0x5b7073(0x1f2)]){console[_0x5b7073(0x19d)](_0x5b7073(0x187)),console['error'](_0x5b7073(0x190)),console[_0x5b7073(0x19d)](_0x5b7073(0x1bd),_0x55444c['data']),loggerService_1[_0x5b7073(0x1d9)][_0x5b7073(0x1e9)](_0x5b7073(0x1cb),_0x5b7073(0x1b2),_0x5b7073(0x1de));throw new Error(_0x5b7073(0x193));}return console[_0x5b7073(0x1c2)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x5b7073(0x1c2)](_0x5b7073(0x1ba),_0x55444c[_0x5b7073(0x1af)][_0x5b7073(0x18d)]),console[_0x5b7073(0x1c2)]('Invoice\x20URL:',_0x55444c[_0x5b7073(0x1af)][_0x5b7073(0x1f2)]),console[_0x5b7073(0x1c2)](_0x5b7073(0x19c),_0x3fe552,_0x38ec6d),_0x423379&&(console[_0x5b7073(0x1c2)](_0x5b7073(0x185),_0x423379,'(crypto\x20for\x20payment)'),console[_0x5b7073(0x1c2)](_0x5b7073(0x18f),_0x38ec6d,_0x5b7073(0x1b4))),{'gateway_payment_id':_0x55444c[_0x5b7073(0x1af)]['txn_id'],'payment_url':_0x55444c[_0x5b7073(0x1af)][_0x5b7073(0x1f2)],'invoice_total_sum':_0x55444c[_0x5b7073(0x1af)][_0x5b7073(0x1e0)],'qr_code':_0x55444c[_0x5b7073(0x1af)]['qr_code'],'qr_url':_0x55444c[_0x5b7073(0x1af)][_0x5b7073(0x1c9)]};}catch(_0xd072cd){console['error']('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x5b7073(0x19d)](_0x5b7073(0x1a2),_0xd072cd),loggerService_1['loggerService']['logWhiteDomainError'](_0x5b7073(0x1cb),_0x5b7073(0x1b2),_0xd072cd);if(_0xd072cd instanceof Error){console[_0x5b7073(0x19d)](_0x5b7073(0x1ec),_0xd072cd['message']),console[_0x5b7073(0x19d)](_0x5b7073(0x1ee),_0xd072cd[_0x5b7073(0x19f)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0xd072cd[_0x5b7073(0x196)]);}throw new Error(_0x5b7073(0x1ea));}}async[a41_0x321c51(0x1b6)](_0x2cc475){const _0x8313de=a41_0x321c51,_0x96a442=Date['now']();try{if(!this['apiKey'])throw new Error(_0x8313de(0x1ed));const _0x10a46f=new URLSearchParams({'api_key':this[_0x8313de(0x1a3)],'txn_id':_0x2cc475}),_0x6e86e2='https://api.plisio.net/api/v1/operations/'+_0x2cc475+'?'+_0x10a46f[_0x8313de(0x1a4)]();loggerService_1['loggerService'][_0x8313de(0x1c3)]('plisio_direct',_0x8313de(0x1bb)+_0x2cc475,'GET',Object[_0x8313de(0x1b1)](_0x10a46f[_0x8313de(0x1e6)]()));const _0x37f404=await fetch(_0x6e86e2,{'method':_0x8313de(0x1bc),'headers':{'Accept':_0x8313de(0x18a),'User-Agent':_0x8313de(0x1ef)}}),_0x2d6ea1=Date[_0x8313de(0x1d4)]()-_0x96a442;if(!_0x37f404['ok']){const _0x5e4a1c=await _0x37f404['text']();loggerService_1['loggerService'][_0x8313de(0x1a9)](_0x8313de(0x1cb),_0x8313de(0x1bb)+_0x2cc475,_0x37f404['status'],_0x5e4a1c,_0x2d6ea1);throw new Error(_0x8313de(0x191)+_0x37f404[_0x8313de(0x1e7)]);}const _0x3cdd99=await _0x37f404[_0x8313de(0x1e1)]();loggerService_1['loggerService'][_0x8313de(0x1a9)](_0x8313de(0x1cb),_0x8313de(0x1bb)+_0x2cc475,_0x37f404['status'],_0x3cdd99,_0x2d6ea1);if(_0x3cdd99[_0x8313de(0x1e7)]!==_0x8313de(0x1d8)){loggerService_1[_0x8313de(0x1d9)]['logWhiteDomainError'](_0x8313de(0x1cb),'/operations/'+_0x2cc475,_0x8313de(0x198)+(_0x3cdd99[_0x8313de(0x196)]||_0x3cdd99[_0x8313de(0x19d)]||_0x8313de(0x1aa)));throw new Error(_0x8313de(0x198)+(_0x3cdd99[_0x8313de(0x196)]||_0x3cdd99['error']||_0x8313de(0x1aa)));}let _0xe95205=_0x8313de(0x19b);return{'status':_0xe95205};}catch(_0x3c9d45){console['error'](_0x8313de(0x1d5),_0x3c9d45),loggerService_1[_0x8313de(0x1d9)][_0x8313de(0x1e9)]('plisio_direct','/operations/'+_0x2cc475,_0x3c9d45);throw new Error(_0x8313de(0x1d7)+(_0x3c9d45 instanceof Error?_0x3c9d45[_0x8313de(0x196)]:_0x8313de(0x1aa)));}}async[a41_0x321c51(0x1ce)](_0x844c1a){const _0x4fba82=a41_0x321c51;console[_0x4fba82(0x1c2)](_0x4fba82(0x18e),_0x844c1a);let _0x1d865e=_0x4fba82(0x19b);switch(_0x844c1a['status']?.[_0x4fba82(0x1ca)]()){case'completed':case _0x4fba82(0x1e8):_0x1d865e=_0x4fba82(0x1e2);break;case _0x4fba82(0x197):_0x1d865e=_0x4fba82(0x192);break;case _0x4fba82(0x19d):case _0x4fba82(0x199):_0x1d865e=_0x4fba82(0x1f1);break;case _0x4fba82(0x1ae):case _0x4fba82(0x186):default:_0x1d865e='PENDING';break;}return{'paymentId':_0x844c1a[_0x4fba82(0x18b)]||'','status':_0x1d865e,'amount':_0x844c1a[_0x4fba82(0x1d1)],'currency':_0x844c1a[_0x4fba82(0x1b7)]};}}exports[a41_0x321c51(0x1df)]=PlisioService;