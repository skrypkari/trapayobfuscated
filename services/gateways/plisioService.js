'use strict';const a44_0x54ec24=a44_0x4b13;function a44_0x1a7f(){const _0x449287=['‚ùå\x20URL\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20','map','Processing\x20Plisio\x20webhook:','Error\x20stack:','logWhiteDomainRequest','TesSoft\x20Payment\x20System/1.0','Plisio\x20API\x20error:\x20','Full\x20URL\x20(without\x20API\x20key):','verifyPayment','Response\x20Body:','Parameters:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','application/json','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','fromEntries','new','\x20->\x20','Unknown\x20error\x20from\x20Plisio\x20API','\x20is\x20valid:\x20','Parsed\x20Result:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','logWhiteDomainError','Error\x20message:','loggerService','Raw\x20Response\x20Body:','285765nzJAZS','PLISIO_API_KEY','isArray','8rWsDXK','===\x20PLISIO\x20SUCCESS\x20===','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','HIDDEN','amount','email','1990296MkEVSZ','invoice_total_sum','Transaction\x20ID:','log','../loggerService','Error\x20details:','FAILED','HTTP\x20','plisio_direct','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','warn','===\x20PLISIO\x20API\x20ERROR\x20===','invoice_url','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','12AmTxJW','replace','__esModule','createPayment','now','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','data','append','PENDING','‚úÖ\x20URL\x20','HTTP\x20error!\x20status:\x20','Response\x20data:','txn_id','997032amXOau','20eYbrnI','apiKey','success','currency','Raw\x20tx_urls\x20data:','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','(fiat\x20for\x20merchant)','(crypto\x20for\x20payment)','/operations/','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','string','json','error','cancelled','PlisioService','293679fXngGP','stringify','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','494010WVLiQb','GET','parse','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Invoice\x20URL:','811188rxYTCC','444LnbcRw','status','https://api.plisio.net/api/v1/invoices/new','PAID','logWhiteDomainResponse','Source\x20Currency:','apiUrl','362daBGUl','toString','order_number','tx_urls','\x20is\x20invalid:\x20','source_amount','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','https://api.trapay.uk/api/webhooks/gateway/plisio','Unknown\x20error','expired','HTTP\x20Status:','Response\x20Time:','message','URL:','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Status\x20Text:','pending','forEach','qr_url','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','/invoices/new','Plisio\x20API\x20key\x20is\x20not\x20configured','Target\x20Currency:','toLowerCase'];a44_0x1a7f=function(){return _0x449287;};return a44_0x1a7f();}function a44_0x4b13(_0x329832,_0xc7f95c){const _0x1a7f89=a44_0x1a7f();return a44_0x4b13=function(_0x4b13ad,_0xbbb3ef){_0x4b13ad=_0x4b13ad-0x9f;let _0x842976=_0x1a7f89[_0x4b13ad];return _0x842976;},a44_0x4b13(_0x329832,_0xc7f95c);}(function(_0x87b36,_0x50b64a){const _0x4b7762=a44_0x4b13,_0x4a4e6f=_0x87b36();while(!![]){try{const _0x14528b=-parseInt(_0x4b7762(0x115))/0x1*(-parseInt(_0x4b7762(0xa5))/0x2)+-parseInt(_0x4b7762(0xd7))/0x3*(parseInt(_0x4b7762(0xda))/0x4)+parseInt(_0x4b7762(0x10f))/0x5+parseInt(_0x4b7762(0xee))/0x6*(-parseInt(_0x4b7762(0x114))/0x7)+parseInt(_0x4b7762(0xfb))/0x8+parseInt(_0x4b7762(0x10c))/0x9*(parseInt(_0x4b7762(0xfc))/0xa)+parseInt(_0x4b7762(0xe0))/0xb;if(_0x14528b===_0x50b64a)break;else _0x4a4e6f['push'](_0x4a4e6f['shift']());}catch(_0x56c3fc){_0x4a4e6f['push'](_0x4a4e6f['shift']());}}}(a44_0x1a7f,0x1f2e3));Object['defineProperty'](exports,a44_0x54ec24(0xf0),{'value':!![]}),exports[a44_0x54ec24(0x10b)]=void 0x0;const loggerService_1=require(a44_0x54ec24(0xe4));class PlisioService{constructor(){const _0x84e93f=a44_0x54ec24;this[_0x84e93f(0xa4)]=_0x84e93f(0xa0),this[_0x84e93f(0xfd)]=process['env'][_0x84e93f(0xd8)]||'',!this['apiKey']?console[_0x84e93f(0xea)](_0x84e93f(0xab)):console[_0x84e93f(0xe3)](_0x84e93f(0xb8));}async[a44_0x54ec24(0xf1)](_0xc00fb){const _0x4e95b1=a44_0x54ec24,{orderId:_0x3d3301,amount:_0x4a1e9a,currency:_0x30ef75,productName:_0x2e3c80,description:_0x1eef2a,successUrl:_0x5a1596,failUrl:_0x3c109e,customerEmail:_0x247c48,customerName:_0x2e3781,isSourceCurrency:_0x3cd2a7,sourceCurrency:_0x5103ba}=_0xc00fb;if(!this[_0x4e95b1(0xfd)])throw new Error(_0x4e95b1(0xba));const _0x486f5e=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x3d3301,'order_name':_0x2e3c80,'description':_0x1eef2a,'success_url':_0x5a1596,'fail_url':_0x3c109e,'callback_url':_0x4e95b1(0xac)});_0x5103ba?(_0x486f5e[_0x4e95b1(0xf5)](_0x4e95b1(0xff),_0x5103ba),_0x486f5e[_0x4e95b1(0xf5)]('source_currency',_0x30ef75),_0x486f5e[_0x4e95b1(0xf5)](_0x4e95b1(0xaa),_0x4a1e9a[_0x4e95b1(0xa6)]())):(_0x486f5e[_0x4e95b1(0xf5)](_0x4e95b1(0xff),_0x30ef75),_0x486f5e[_0x4e95b1(0xf5)](_0x4e95b1(0xde),_0x4a1e9a[_0x4e95b1(0xa6)]()));_0x247c48&&_0x486f5e[_0x4e95b1(0xf5)](_0x4e95b1(0xdf),_0x247c48);_0x2e3781&&_0x486f5e[_0x4e95b1(0xf5)]('name',_0x2e3781);const _0x1e9c4a=this[_0x4e95b1(0xa4)]+'?'+_0x486f5e['toString'](),_0x2ff3da=Date[_0x4e95b1(0xf2)]();try{console['log'](_0x4e95b1(0x106)),console[_0x4e95b1(0xe3)](_0x4e95b1(0xb2),this[_0x4e95b1(0xa4)]),console[_0x4e95b1(0xe3)](_0x4e95b1(0xc8),Object[_0x4e95b1(0xcc)](_0x486f5e['entries']())),console[_0x4e95b1(0xe3)](_0x4e95b1(0xc5),_0x1e9c4a[_0x4e95b1(0xef)](this[_0x4e95b1(0xfd)],_0x4e95b1(0xdd))),loggerService_1['loggerService'][_0x4e95b1(0xc2)]('plisio_direct',_0x4e95b1(0xb9),_0x4e95b1(0x110),Object[_0x4e95b1(0xcc)](_0x486f5e['entries']()));const _0x4cf17d=await fetch(_0x1e9c4a,{'method':_0x4e95b1(0x110),'headers':{'Accept':_0x4e95b1(0xca),'User-Agent':_0x4e95b1(0xc3)}}),_0x499fdd=Date[_0x4e95b1(0xf2)]()-_0x2ff3da;console[_0x4e95b1(0xe3)](_0x4e95b1(0xd2)),console[_0x4e95b1(0xe3)]('Status:',_0x4cf17d[_0x4e95b1(0x9f)]),console[_0x4e95b1(0xe3)](_0x4e95b1(0xb4),_0x4cf17d['statusText']),console['log'](_0x4e95b1(0xb0),_0x499fdd+'ms');const _0x28e771=await _0x4cf17d['text']();console[_0x4e95b1(0xe3)](_0x4e95b1(0xd6),_0x28e771);if(!_0x4cf17d['ok']){console[_0x4e95b1(0x109)](_0x4e95b1(0xeb)),console[_0x4e95b1(0x109)](_0x4e95b1(0xaf),_0x4cf17d[_0x4e95b1(0x9f)]),console[_0x4e95b1(0x109)](_0x4e95b1(0xc7),_0x28e771),loggerService_1[_0x4e95b1(0xd5)][_0x4e95b1(0xa2)](_0x4e95b1(0xe8),_0x4e95b1(0xb9),_0x4cf17d[_0x4e95b1(0x9f)],_0x28e771,_0x499fdd),loggerService_1['loggerService'][_0x4e95b1(0xd3)](_0x4e95b1(0xe8),_0x4e95b1(0xb9),_0x4e95b1(0xe7)+_0x4cf17d['status']+':\x20'+_0x28e771);throw new Error(_0x4e95b1(0xf8)+_0x4cf17d['status']+',\x20body:\x20'+_0x28e771);}let _0x1faa5d;try{_0x1faa5d=JSON[_0x4e95b1(0x111)](_0x28e771);}catch(_0x20ab37){console[_0x4e95b1(0x109)](_0x4e95b1(0x101),_0x20ab37),loggerService_1[_0x4e95b1(0xd5)][_0x4e95b1(0xd3)]('plisio_direct',_0x4e95b1(0xb9),'JSON\x20Parse\x20Error:\x20'+_0x20ab37);throw new Error(_0x4e95b1(0x102)+_0x28e771);}console[_0x4e95b1(0xe3)](_0x4e95b1(0x10e)),console[_0x4e95b1(0xe3)](_0x4e95b1(0xd1),JSON[_0x4e95b1(0x10d)](_0x1faa5d,null,0x2)),loggerService_1[_0x4e95b1(0xd5)][_0x4e95b1(0xa2)](_0x4e95b1(0xe8),_0x4e95b1(0xb9),_0x4cf17d['status'],_0x1faa5d,_0x499fdd);if(_0x1faa5d[_0x4e95b1(0x9f)]!==_0x4e95b1(0xfe)){const _0x37267c=_0x1faa5d['message']||_0x1faa5d[_0x4e95b1(0x109)]||_0x4e95b1(0xcf);console['error'](_0x4e95b1(0xf3)),console[_0x4e95b1(0x109)]('Error\x20Message:',_0x37267c),loggerService_1['loggerService'][_0x4e95b1(0xd3)](_0x4e95b1(0xe8),'/invoices/new','Business\x20Error:\x20'+_0x37267c);throw new Error(_0x4e95b1(0xc4)+_0x37267c);}if(!_0x1faa5d['data']?.[_0x4e95b1(0xfa)]||!_0x1faa5d[_0x4e95b1(0xf4)]?.[_0x4e95b1(0xec)]){console['error'](_0x4e95b1(0xcb)),console['error'](_0x4e95b1(0xed)),console[_0x4e95b1(0x109)](_0x4e95b1(0xf9),_0x1faa5d[_0x4e95b1(0xf4)]),loggerService_1['loggerService']['logWhiteDomainError'](_0x4e95b1(0xe8),_0x4e95b1(0xb9),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x4e95b1(0xc9));}return console['log'](_0x4e95b1(0xdb)),console[_0x4e95b1(0xe3)](_0x4e95b1(0xe2),_0x1faa5d[_0x4e95b1(0xf4)][_0x4e95b1(0xfa)]),console[_0x4e95b1(0xe3)](_0x4e95b1(0x113),_0x1faa5d['data'][_0x4e95b1(0xec)]),console[_0x4e95b1(0xe3)]('Amount:',_0x4a1e9a,_0x30ef75),_0x5103ba&&(console['log'](_0x4e95b1(0xa3),_0x5103ba,_0x4e95b1(0x104)),console[_0x4e95b1(0xe3)](_0x4e95b1(0xbb),_0x30ef75,_0x4e95b1(0x103))),{'gateway_payment_id':_0x1faa5d[_0x4e95b1(0xf4)][_0x4e95b1(0xfa)],'payment_url':_0x1faa5d['data'][_0x4e95b1(0xec)],'invoice_total_sum':_0x1faa5d[_0x4e95b1(0xf4)][_0x4e95b1(0xe1)],'qr_code':_0x1faa5d['data']['qr_code'],'qr_url':_0x1faa5d['data'][_0x4e95b1(0xb7)]};}catch(_0xa54759){console[_0x4e95b1(0x109)](_0x4e95b1(0x112)),console[_0x4e95b1(0x109)](_0x4e95b1(0xe5),_0xa54759),loggerService_1[_0x4e95b1(0xd5)][_0x4e95b1(0xd3)](_0x4e95b1(0xe8),'/invoices/new',_0xa54759);if(_0xa54759 instanceof Error){console[_0x4e95b1(0x109)](_0x4e95b1(0xd4),_0xa54759[_0x4e95b1(0xb1)]),console['error'](_0x4e95b1(0xc1),_0xa54759['stack']);throw new Error(_0x4e95b1(0xbe)+_0xa54759[_0x4e95b1(0xb1)]);}throw new Error(_0x4e95b1(0xdc));}}async[a44_0x54ec24(0xc6)](_0x52a15a){const _0x4e049a=a44_0x54ec24,_0x255b71=Date['now']();try{if(!this[_0x4e049a(0xfd)])throw new Error(_0x4e049a(0xba));const _0x532639=new URLSearchParams({'api_key':this[_0x4e049a(0xfd)],'txn_id':_0x52a15a}),_0x5b79d0='https://api.plisio.net/api/v1/operations/'+_0x52a15a+'?'+_0x532639[_0x4e049a(0xa6)]();loggerService_1[_0x4e049a(0xd5)][_0x4e049a(0xc2)](_0x4e049a(0xe8),'/operations/'+_0x52a15a,_0x4e049a(0x110),Object[_0x4e049a(0xcc)](_0x532639['entries']()));const _0x2a529e=await fetch(_0x5b79d0,{'method':_0x4e049a(0x110),'headers':{'Accept':_0x4e049a(0xca),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x4dd33d=Date['now']()-_0x255b71;if(!_0x2a529e['ok']){const _0x5b2a03=await _0x2a529e['text']();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4e049a(0xe8),_0x4e049a(0x105)+_0x52a15a,_0x2a529e[_0x4e049a(0x9f)],_0x5b2a03,_0x4dd33d);throw new Error(_0x4e049a(0xf8)+_0x2a529e['status']);}const _0x27b2aa=await _0x2a529e[_0x4e049a(0x108)]();loggerService_1[_0x4e049a(0xd5)]['logWhiteDomainResponse']('plisio_direct','/operations/'+_0x52a15a,_0x2a529e['status'],_0x27b2aa,_0x4dd33d);if(_0x27b2aa['status']!==_0x4e049a(0xfe)){loggerService_1[_0x4e049a(0xd5)][_0x4e049a(0xd3)](_0x4e049a(0xe8),'/operations/'+_0x52a15a,_0x4e049a(0xc4)+(_0x27b2aa[_0x4e049a(0xb1)]||_0x27b2aa['error']||_0x4e049a(0xad)));throw new Error(_0x4e049a(0xc4)+(_0x27b2aa['message']||_0x27b2aa[_0x4e049a(0x109)]||_0x4e049a(0xad)));}let _0x36cc08='PENDING';return{'status':_0x36cc08};}catch(_0x28ca09){console[_0x4e049a(0x109)]('Plisio\x20payment\x20verification\x20error:',_0x28ca09),loggerService_1['loggerService'][_0x4e049a(0xd3)](_0x4e049a(0xe8),_0x4e049a(0x105)+_0x52a15a,_0x28ca09);throw new Error(_0x4e049a(0xb3)+(_0x28ca09 instanceof Error?_0x28ca09[_0x4e049a(0xb1)]:_0x4e049a(0xad)));}}async['processWebhook'](_0x200d31){const _0x5a4665=a44_0x54ec24;console[_0x5a4665(0xe3)](_0x5a4665(0xc0),_0x200d31);let _0x105865='PENDING';switch(_0x200d31[_0x5a4665(0x9f)]?.[_0x5a4665(0xbc)]()){case'completed':case'mismatch':_0x105865=_0x5a4665(0xa1);break;case _0x5a4665(0xae):_0x105865='EXPIRED';break;case _0x5a4665(0x109):case _0x5a4665(0x10a):_0x105865=_0x5a4665(0xe6);break;case _0x5a4665(0xcd):case _0x5a4665(0xb5):default:_0x105865=_0x5a4665(0xf6);break;}let _0x378949;if(_0x200d31[_0x5a4665(0xa8)])try{console[_0x5a4665(0xe3)]('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x200d31[_0x5a4665(0xa8)]);let _0x25c6bf;if(typeof _0x200d31[_0x5a4665(0xa8)]===_0x5a4665(0x107))_0x25c6bf=JSON[_0x5a4665(0x111)](_0x200d31[_0x5a4665(0xa8)]);else Array[_0x5a4665(0xd9)](_0x200d31[_0x5a4665(0xa8)])?_0x25c6bf=_0x200d31[_0x5a4665(0xa8)]:_0x25c6bf=[];_0x378949=_0x25c6bf[_0x5a4665(0xbf)](_0x4b19d3=>{const _0x1bceef=_0x5a4665,_0x212653=_0x4b19d3['replace'](/\\/g,'');return console[_0x1bceef(0xe3)]('üîó\x20Formatted\x20URL:\x20'+_0x4b19d3+_0x1bceef(0xce)+_0x212653),_0x212653;}),console[_0x5a4665(0xe3)]('‚úÖ\x20Processed\x20tx_urls:',_0x378949),_0x378949[_0x5a4665(0xb6)]((_0x1ac97b,_0x4b48fc)=>{const _0x4fae81=_0x5a4665;try{new URL(_0x1ac97b),console[_0x4fae81(0xe3)](_0x4fae81(0xf7)+(_0x4b48fc+0x1)+_0x4fae81(0xd0)+_0x1ac97b);}catch(_0x69f86d){console[_0x4fae81(0x109)](_0x4fae81(0xbd)+(_0x4b48fc+0x1)+_0x4fae81(0xa9)+_0x1ac97b,_0x69f86d);}});}catch(_0x28e9f0){console[_0x5a4665(0x109)](_0x5a4665(0xe9),_0x28e9f0),console['error'](_0x5a4665(0x100),_0x200d31[_0x5a4665(0xa8)]),_0x378949=undefined;}return{'paymentId':_0x200d31[_0x5a4665(0xa7)]||'','status':_0x105865,'amount':_0x200d31[_0x5a4665(0xde)],'currency':_0x200d31['currency'],'txUrls':_0x378949};}}exports[a44_0x54ec24(0x10b)]=PlisioService;