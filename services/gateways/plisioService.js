'use strict';function a44_0x28ce(){const _0x1fdd89=['Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','124Zkxqgj','processWebhook','toLowerCase','completed','===\x20PLISIO\x20API\x20ERROR\x20===','Response\x20Time:','Business\x20Error:\x20','text','txn_id','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','stringify','createPayment','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','source_currency','HTTP\x20','Error\x20Message:','Raw\x20tx_urls\x20data:','plisio_direct','now','124xOPUWS','append','https://api.plisio.net/api/v1/operations/','qr_code','\x20->\x20','HTTP\x20Status:','defineProperty','‚úÖ\x20Processed\x20tx_urls:','new','11809503LmVfRv','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Transaction\x20ID:','statusText','712XuCcei','name','2776875ppiCrk','invoice_total_sum','currency','invoice_url','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','‚úÖ\x20URL\x20','parse','EXPIRED','expired','logWhiteDomainRequest','72129YXvhDh','logWhiteDomainResponse','(crypto\x20for\x20payment)','Target\x20Currency:','/invoices/new','apiUrl','PENDING','isArray','PlisioService','Unknown\x20error\x20from\x20Plisio\x20API','11oplRtv','üîó\x20Formatted\x20URL:\x20','Raw\x20Response\x20Body:','GET','Failed\x20to\x20create\x20Plisio\x20payment:\x20','qr_url','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Parameters:','logWhiteDomainError','apiKey','__esModule','amount','URL:','PAID','===\x20PLISIO\x20SUCCESS\x20===','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Unknown\x20error','../loggerService','6pbjmEY','Source\x20Currency:','Processing\x20Plisio\x20webhook:','env','Response\x20data:','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Plisio\x20API\x20key\x20is\x20not\x20configured','Plisio\x20API\x20error:\x20','tx_urls','\x20is\x20valid:\x20','FAILED','loggerService','replace','status','43883rDuMQE','TesSoft\x20Payment\x20System/1.0','300QWuzOX','email','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','success','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Invoice\x20URL:','HTTP\x20error!\x20status:\x20','20918GPrLQp','data','application/json','json','Error\x20stack:','entries','error','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','stack','toString','message','834899fyiplO','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','fromEntries','warn','PLISIO_API_KEY','‚ùå\x20URL\x20','7139910EouTjn','\x20is\x20invalid:\x20','log','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','/operations/','https://api.plisio.net/api/v1/invoices/new'];a44_0x28ce=function(){return _0x1fdd89;};return a44_0x28ce();}function a44_0x3a3d(_0x57b9cd,_0x4cc92e){const _0x28cec0=a44_0x28ce();return a44_0x3a3d=function(_0x3a3df3,_0x27ab4a){_0x3a3df3=_0x3a3df3-0x14a;let _0x32c5a6=_0x28cec0[_0x3a3df3];return _0x32c5a6;},a44_0x3a3d(_0x57b9cd,_0x4cc92e);}const a44_0xe55865=a44_0x3a3d;(function(_0x15e35e,_0x4d69e6){const _0x1977ec=a44_0x3a3d,_0x15c4db=_0x15e35e();while(!![]){try{const _0x1d60f9=-parseInt(_0x1977ec(0x194))/0x1*(-parseInt(_0x1977ec(0x167))/0x2)+parseInt(_0x1977ec(0x1ad))/0x3*(-parseInt(_0x1977ec(0x181))/0x4)+parseInt(_0x1977ec(0x1a3))/0x5*(parseInt(_0x1977ec(0x150))/0x6)+-parseInt(_0x1977ec(0x15e))/0x7*(parseInt(_0x1977ec(0x1a1))/0x8)+parseInt(_0x1977ec(0x19d))/0x9+-parseInt(_0x1977ec(0x17a))/0xa*(-parseInt(_0x1977ec(0x1b7))/0xb)+-parseInt(_0x1977ec(0x160))/0xc*(parseInt(_0x1977ec(0x174))/0xd);if(_0x1d60f9===_0x4d69e6)break;else _0x15c4db['push'](_0x15c4db['shift']());}catch(_0x507c37){_0x15c4db['push'](_0x15c4db['shift']());}}}(a44_0x28ce,0xecb80));Object[a44_0xe55865(0x19a)](exports,a44_0xe55865(0x1c1),{'value':!![]}),exports[a44_0xe55865(0x1b5)]=void 0x0;const loggerService_1=require(a44_0xe55865(0x14f));class PlisioService{constructor(){const _0x565c7a=a44_0xe55865;this[_0x565c7a(0x1b2)]=_0x565c7a(0x17f),this[_0x565c7a(0x1c0)]=process[_0x565c7a(0x153)][_0x565c7a(0x178)]||'',!this[_0x565c7a(0x1c0)]?console[_0x565c7a(0x177)](_0x565c7a(0x155)):console[_0x565c7a(0x17c)](_0x565c7a(0x1bd));}async[a44_0xe55865(0x18c)](_0x9a4c2e){const _0x319a39=a44_0xe55865,{orderId:_0x236c71,amount:_0x170f93,currency:_0xd9166d,productName:_0x32327c,description:_0x2132f2,successUrl:_0x95c175,failUrl:_0x4b0e0a,customerEmail:_0x347513,customerName:_0x34682e,isSourceCurrency:_0x4b9229,sourceCurrency:_0x53b905}=_0x9a4c2e;if(!this[_0x319a39(0x1c0)])throw new Error(_0x319a39(0x156));const _0x349dfc=new URLSearchParams({'api_key':this[_0x319a39(0x1c0)],'order_number':_0x236c71,'order_name':_0x32327c,'description':_0x2132f2,'success_url':_0x95c175,'fail_url':_0x4b0e0a,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x53b905?(_0x349dfc['append'](_0x319a39(0x1a5),_0x53b905),_0x349dfc['append'](_0x319a39(0x18e),_0xd9166d),_0x349dfc['append']('source_amount',_0x170f93[_0x319a39(0x172)]())):(_0x349dfc[_0x319a39(0x195)](_0x319a39(0x1a5),_0xd9166d),_0x349dfc['append'](_0x319a39(0x1c2),_0x170f93[_0x319a39(0x172)]()));_0x347513&&_0x349dfc['append'](_0x319a39(0x161),_0x347513);_0x34682e&&_0x349dfc[_0x319a39(0x195)](_0x319a39(0x1a2),_0x34682e);const _0x42a0c4=this[_0x319a39(0x1b2)]+'?'+_0x349dfc[_0x319a39(0x172)](),_0xfeaa61=Date[_0x319a39(0x193)]();try{console[_0x319a39(0x17c)](_0x319a39(0x16f)),console[_0x319a39(0x17c)](_0x319a39(0x14a),this['apiUrl']),console[_0x319a39(0x17c)](_0x319a39(0x1be),Object[_0x319a39(0x176)](_0x349dfc[_0x319a39(0x16c)]())),console['log']('Full\x20URL\x20(without\x20API\x20key):',_0x42a0c4['replace'](this[_0x319a39(0x1c0)],'HIDDEN')),loggerService_1[_0x319a39(0x15b)][_0x319a39(0x1ac)](_0x319a39(0x192),_0x319a39(0x1b1),_0x319a39(0x1ba),Object[_0x319a39(0x176)](_0x349dfc[_0x319a39(0x16c)]()));const _0x465907=await fetch(_0x42a0c4,{'method':_0x319a39(0x1ba),'headers':{'Accept':_0x319a39(0x169),'User-Agent':_0x319a39(0x15f)}}),_0x1032b6=Date['now']()-_0xfeaa61;console['log'](_0x319a39(0x175)),console[_0x319a39(0x17c)]('Status:',_0x465907[_0x319a39(0x15d)]),console[_0x319a39(0x17c)]('Status\x20Text:',_0x465907[_0x319a39(0x1a0)]),console['log'](_0x319a39(0x186),_0x1032b6+'ms');const _0x982deb=await _0x465907[_0x319a39(0x188)]();console[_0x319a39(0x17c)](_0x319a39(0x1b9),_0x982deb);if(!_0x465907['ok']){console[_0x319a39(0x16d)](_0x319a39(0x185)),console[_0x319a39(0x16d)](_0x319a39(0x199),_0x465907[_0x319a39(0x15d)]),console[_0x319a39(0x16d)]('Response\x20Body:',_0x982deb),loggerService_1[_0x319a39(0x15b)][_0x319a39(0x1ae)]('plisio_direct',_0x319a39(0x1b1),_0x465907[_0x319a39(0x15d)],_0x982deb,_0x1032b6),loggerService_1[_0x319a39(0x15b)][_0x319a39(0x1bf)](_0x319a39(0x192),_0x319a39(0x1b1),_0x319a39(0x18f)+_0x465907[_0x319a39(0x15d)]+':\x20'+_0x982deb);throw new Error(_0x319a39(0x166)+_0x465907['status']+',\x20body:\x20'+_0x982deb);}let _0x5e67e1;try{_0x5e67e1=JSON[_0x319a39(0x1a9)](_0x982deb);}catch(_0x68e773){console[_0x319a39(0x16d)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x68e773),loggerService_1[_0x319a39(0x15b)][_0x319a39(0x1bf)](_0x319a39(0x192),_0x319a39(0x1b1),'JSON\x20Parse\x20Error:\x20'+_0x68e773);throw new Error(_0x319a39(0x19e)+_0x982deb);}console['log'](_0x319a39(0x18a)),console[_0x319a39(0x17c)]('Parsed\x20Result:',JSON[_0x319a39(0x18b)](_0x5e67e1,null,0x2)),loggerService_1['loggerService'][_0x319a39(0x1ae)](_0x319a39(0x192),_0x319a39(0x1b1),_0x465907[_0x319a39(0x15d)],_0x5e67e1,_0x1032b6);if(_0x5e67e1['status']!==_0x319a39(0x163)){const _0x264538=_0x5e67e1[_0x319a39(0x173)]||_0x5e67e1[_0x319a39(0x16d)]||_0x319a39(0x1b6);console[_0x319a39(0x16d)](_0x319a39(0x162)),console[_0x319a39(0x16d)](_0x319a39(0x190),_0x264538),loggerService_1[_0x319a39(0x15b)][_0x319a39(0x1bf)](_0x319a39(0x192),_0x319a39(0x1b1),_0x319a39(0x187)+_0x264538);throw new Error('Plisio\x20API\x20error:\x20'+_0x264538);}if(!_0x5e67e1[_0x319a39(0x168)]?.[_0x319a39(0x189)]||!_0x5e67e1[_0x319a39(0x168)]?.['invoice_url']){console['error'](_0x319a39(0x170)),console[_0x319a39(0x16d)](_0x319a39(0x1a7)),console[_0x319a39(0x16d)](_0x319a39(0x154),_0x5e67e1[_0x319a39(0x168)]),loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct',_0x319a39(0x1b1),_0x319a39(0x180));throw new Error(_0x319a39(0x17d));}return console[_0x319a39(0x17c)](_0x319a39(0x14c)),console[_0x319a39(0x17c)](_0x319a39(0x19f),_0x5e67e1[_0x319a39(0x168)]['txn_id']),console[_0x319a39(0x17c)](_0x319a39(0x165),_0x5e67e1[_0x319a39(0x168)][_0x319a39(0x1a6)]),console[_0x319a39(0x17c)]('Amount:',_0x170f93,_0xd9166d),_0x53b905&&(console[_0x319a39(0x17c)](_0x319a39(0x151),_0x53b905,_0x319a39(0x1af)),console[_0x319a39(0x17c)](_0x319a39(0x1b0),_0xd9166d,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x5e67e1['data']['txn_id'],'payment_url':_0x5e67e1[_0x319a39(0x168)]['invoice_url'],'invoice_total_sum':_0x5e67e1[_0x319a39(0x168)][_0x319a39(0x1a4)],'qr_code':_0x5e67e1[_0x319a39(0x168)][_0x319a39(0x197)],'qr_url':_0x5e67e1[_0x319a39(0x168)][_0x319a39(0x1bc)]};}catch(_0x3cd79f){console[_0x319a39(0x16d)](_0x319a39(0x14d)),console[_0x319a39(0x16d)]('Error\x20details:',_0x3cd79f),loggerService_1[_0x319a39(0x15b)][_0x319a39(0x1bf)](_0x319a39(0x192),'/invoices/new',_0x3cd79f);if(_0x3cd79f instanceof Error){console[_0x319a39(0x16d)]('Error\x20message:',_0x3cd79f[_0x319a39(0x173)]),console[_0x319a39(0x16d)](_0x319a39(0x16b),_0x3cd79f[_0x319a39(0x171)]);throw new Error(_0x319a39(0x1bb)+_0x3cd79f[_0x319a39(0x173)]);}throw new Error(_0x319a39(0x164));}}async['verifyPayment'](_0x319dec){const _0x50be26=a44_0xe55865,_0x1653db=Date[_0x50be26(0x193)]();try{if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x33bf12=new URLSearchParams({'api_key':this[_0x50be26(0x1c0)],'txn_id':_0x319dec}),_0x534d04=_0x50be26(0x196)+_0x319dec+'?'+_0x33bf12['toString']();loggerService_1['loggerService'][_0x50be26(0x1ac)](_0x50be26(0x192),'/operations/'+_0x319dec,_0x50be26(0x1ba),Object['fromEntries'](_0x33bf12[_0x50be26(0x16c)]()));const _0x4e0ccd=await fetch(_0x534d04,{'method':_0x50be26(0x1ba),'headers':{'Accept':_0x50be26(0x169),'User-Agent':_0x50be26(0x15f)}}),_0x4224d8=Date[_0x50be26(0x193)]()-_0x1653db;if(!_0x4e0ccd['ok']){const _0x2bdb50=await _0x4e0ccd[_0x50be26(0x188)]();loggerService_1['loggerService']['logWhiteDomainResponse'](_0x50be26(0x192),_0x50be26(0x17e)+_0x319dec,_0x4e0ccd[_0x50be26(0x15d)],_0x2bdb50,_0x4224d8);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4e0ccd[_0x50be26(0x15d)]);}const _0x4757a5=await _0x4e0ccd[_0x50be26(0x16a)]();loggerService_1[_0x50be26(0x15b)][_0x50be26(0x1ae)](_0x50be26(0x192),'/operations/'+_0x319dec,_0x4e0ccd[_0x50be26(0x15d)],_0x4757a5,_0x4224d8);if(_0x4757a5[_0x50be26(0x15d)]!==_0x50be26(0x163)){loggerService_1[_0x50be26(0x15b)][_0x50be26(0x1bf)](_0x50be26(0x192),_0x50be26(0x17e)+_0x319dec,_0x50be26(0x157)+(_0x4757a5[_0x50be26(0x173)]||_0x4757a5[_0x50be26(0x16d)]||_0x50be26(0x14e)));throw new Error(_0x50be26(0x157)+(_0x4757a5[_0x50be26(0x173)]||_0x4757a5['error']||_0x50be26(0x14e)));}let _0x19ed88=_0x50be26(0x1b3);return{'status':_0x19ed88};}catch(_0xf66e6a){console['error']('Plisio\x20payment\x20verification\x20error:',_0xf66e6a),loggerService_1['loggerService']['logWhiteDomainError'](_0x50be26(0x192),_0x50be26(0x17e)+_0x319dec,_0xf66e6a);throw new Error(_0x50be26(0x18d)+(_0xf66e6a instanceof Error?_0xf66e6a[_0x50be26(0x173)]:_0x50be26(0x14e)));}}async[a44_0xe55865(0x182)](_0xe787ba){const _0x372d5e=a44_0xe55865;console[_0x372d5e(0x17c)](_0x372d5e(0x152),_0xe787ba);let _0x5c3204=_0x372d5e(0x1b3);switch(_0xe787ba['status']?.[_0x372d5e(0x183)]()){case _0x372d5e(0x184):case'mismatch':_0x5c3204=_0x372d5e(0x14b);break;case _0x372d5e(0x1ab):_0x5c3204=_0x372d5e(0x1aa);break;case _0x372d5e(0x16d):case'cancelled':_0x5c3204=_0x372d5e(0x15a);break;case _0x372d5e(0x19c):case'pending':default:_0x5c3204=_0x372d5e(0x1b3);break;}let _0x4407a7;if(_0xe787ba[_0x372d5e(0x158)])try{console[_0x372d5e(0x17c)](_0x372d5e(0x16e),_0xe787ba[_0x372d5e(0x158)]);let _0x130c74;if(typeof _0xe787ba['tx_urls']==='string')_0x130c74=JSON[_0x372d5e(0x1a9)](_0xe787ba[_0x372d5e(0x158)]);else Array[_0x372d5e(0x1b4)](_0xe787ba[_0x372d5e(0x158)])?_0x130c74=_0xe787ba['tx_urls']:_0x130c74=[];_0x4407a7=_0x130c74['map'](_0x45884e=>{const _0xb38c60=_0x372d5e,_0x4a745c=_0x45884e[_0xb38c60(0x15c)](/\\/g,'');return console[_0xb38c60(0x17c)](_0xb38c60(0x1b8)+_0x45884e+_0xb38c60(0x198)+_0x4a745c),_0x4a745c;}),console[_0x372d5e(0x17c)](_0x372d5e(0x19b),_0x4407a7),_0x4407a7['forEach']((_0x22f366,_0x27b2c3)=>{const _0x5e5862=_0x372d5e;try{new URL(_0x22f366),console[_0x5e5862(0x17c)](_0x5e5862(0x1a8)+(_0x27b2c3+0x1)+_0x5e5862(0x159)+_0x22f366);}catch(_0x2eefc9){console[_0x5e5862(0x16d)](_0x5e5862(0x179)+(_0x27b2c3+0x1)+_0x5e5862(0x17b)+_0x22f366,_0x2eefc9);}});}catch(_0x23e805){console['error']('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x23e805),console[_0x372d5e(0x16d)](_0x372d5e(0x191),_0xe787ba[_0x372d5e(0x158)]),_0x4407a7=undefined;}return{'paymentId':_0xe787ba['order_number']||'','status':_0x5c3204,'amount':_0xe787ba[_0x372d5e(0x1c2)],'currency':_0xe787ba[_0x372d5e(0x1a5)],'txUrls':_0x4407a7};}}exports[a44_0xe55865(0x1b5)]=PlisioService;