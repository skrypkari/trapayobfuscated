'use strict';const a48_0x465412=a48_0x3a40;function a48_0x5408(){const _0x52cf68=['fromEntries','Unknown\x20error','logWhiteDomainError','Parsed\x20Result:','HTTP\x20error!\x20status:\x20','error','https://api.plisio.net/api/v1/invoices/new','env','../loggerService','Status\x20Text:','order_number','parse','❌\x20Failed\x20to\x20parse\x20tx_urls:','message','✅\x20URL\x20','data','append','stack','PENDING','EXPIRED','PLISIO_API_KEY','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','entries','JSON\x20Parse\x20Error:\x20','GET','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','Response\x20data:','verifyPayment','warn','1128pEzeje','Error\x20stack:','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Raw\x20Response\x20Body:','Failed\x20to\x20create\x20Plisio\x20payment:\x20','tx_urls','/operations/','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','expired','5472230EqUfdb','new','Parameters:','14940qtFwTC','cancelled','pending','success','713120smdspg','completed','source_amount','FAILED','===\x20PLISIO\x20API\x20ERROR\x20===','Plisio\x20API\x20key\x20is\x20not\x20configured','2937155mkLrWg','Processing\x20Plisio\x20webhook:','https://api.plisio.net/api/v1/operations/','qr_url','Response\x20Body:','__esModule','apiKey','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url',',\x20body:\x20','Business\x20Error:\x20','application/json','Plisio\x20API\x20error:\x20','now','Amount:','email','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','\x20->\x20','PAID','name','string','/invoices/new','loggerService','invoice_total_sum','HIDDEN','https://api.trapay.uk/api/webhooks/gateway/plisio','status','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','currency','238387VeDDTM','isArray','toString','amount','replace','toLowerCase','log','===\x20PLISIO\x20SUCCESS\x20===','URL:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','statusText','logWhiteDomainResponse','apiUrl','qr_code','Unknown\x20error\x20from\x20Plisio\x20API','Target\x20Currency:','txn_id','519043hBXMeP','\x20is\x20invalid:\x20','stringify','1417424HcNMsV','PlisioService','🔗\x20Formatted\x20URL:\x20','processWebhook','invoice_url','TesSoft\x20Payment\x20System/1.0','3NUVvlb','Response\x20Time:','plisio_direct','Error\x20message:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','text','map','Raw\x20tx_urls\x20data:','42vtkXlq','createPayment','Full\x20URL\x20(without\x20API\x20key):','(fiat\x20for\x20merchant)','Invoice\x20URL:'];a48_0x5408=function(){return _0x52cf68;};return a48_0x5408();}function a48_0x3a40(_0x5a915c,_0x276dd7){const _0x5408b2=a48_0x5408();return a48_0x3a40=function(_0x3a40ac,_0x144576){_0x3a40ac=_0x3a40ac-0x12c;let _0x33f292=_0x5408b2[_0x3a40ac];return _0x33f292;},a48_0x3a40(_0x5a915c,_0x276dd7);}(function(_0x5669e6,_0x517117){const _0x3ebb77=a48_0x3a40,_0x4a4fc2=_0x5669e6();while(!![]){try{const _0x4d134a=parseInt(_0x3ebb77(0x183))/0x1+parseInt(_0x3ebb77(0x197))/0x2*(parseInt(_0x3ebb77(0x19d))/0x3)+-parseInt(_0x3ebb77(0x161))/0x4+-parseInt(_0x3ebb77(0x167))/0x5+-parseInt(_0x3ebb77(0x12e))/0x6*(-parseInt(_0x3ebb77(0x194))/0x7)+parseInt(_0x3ebb77(0x150))/0x8*(parseInt(_0x3ebb77(0x15d))/0x9)+-parseInt(_0x3ebb77(0x15a))/0xa;if(_0x4d134a===_0x517117)break;else _0x4a4fc2['push'](_0x4a4fc2['shift']());}catch(_0x3fab79){_0x4a4fc2['push'](_0x4a4fc2['shift']());}}}(a48_0x5408,0x5e8c4));Object['defineProperty'](exports,a48_0x465412(0x16c),{'value':!![]}),exports[a48_0x465412(0x198)]=void 0x0;const loggerService_1=require(a48_0x465412(0x13b));class PlisioService{constructor(){const _0x33c09a=a48_0x465412;this[_0x33c09a(0x18f)]=_0x33c09a(0x139),this['apiKey']=process[_0x33c09a(0x13a)][_0x33c09a(0x147)]||'',!this['apiKey']?console[_0x33c09a(0x14f)](_0x33c09a(0x157)):console[_0x33c09a(0x189)](_0x33c09a(0x181));}async[a48_0x465412(0x12f)](_0x9a33a7){const _0x4dc8cf=a48_0x465412,{orderId:_0x3b3320,amount:_0x256e20,currency:_0x58da83,productName:_0x3e591b,description:_0x51325e,successUrl:_0x122bb7,failUrl:_0x5859f6,customerEmail:_0x2cd6f5,customerName:_0x1d39fe,isSourceCurrency:_0x4f3421,sourceCurrency:_0xf97e48}=_0x9a33a7;if(!this[_0x4dc8cf(0x16d)])throw new Error(_0x4dc8cf(0x166));const _0x962a77=new URLSearchParams({'api_key':this[_0x4dc8cf(0x16d)],'order_number':_0x3b3320,'order_name':_0x3e591b,'description':_0x51325e,'success_url':_0x122bb7,'fail_url':_0x5859f6,'callback_url':_0x4dc8cf(0x17f)});_0xf97e48?(_0x962a77[_0x4dc8cf(0x143)](_0x4dc8cf(0x182),_0xf97e48),_0x962a77[_0x4dc8cf(0x143)]('source_currency',_0x58da83),_0x962a77[_0x4dc8cf(0x143)](_0x4dc8cf(0x163),_0x256e20[_0x4dc8cf(0x185)]())):(_0x962a77[_0x4dc8cf(0x143)](_0x4dc8cf(0x182),_0x58da83),_0x962a77['append'](_0x4dc8cf(0x186),_0x256e20['toString']()));_0x2cd6f5&&_0x962a77['append'](_0x4dc8cf(0x175),_0x2cd6f5);_0x1d39fe&&_0x962a77['append'](_0x4dc8cf(0x179),_0x1d39fe);const _0x20818f=this[_0x4dc8cf(0x18f)]+'?'+_0x962a77[_0x4dc8cf(0x185)](),_0x529452=Date[_0x4dc8cf(0x173)]();try{console[_0x4dc8cf(0x189)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x4dc8cf(0x189)](_0x4dc8cf(0x18b),this['apiUrl']),console[_0x4dc8cf(0x189)](_0x4dc8cf(0x15c),Object[_0x4dc8cf(0x133)](_0x962a77['entries']())),console[_0x4dc8cf(0x189)](_0x4dc8cf(0x130),_0x20818f[_0x4dc8cf(0x187)](this[_0x4dc8cf(0x16d)],_0x4dc8cf(0x17e))),loggerService_1[_0x4dc8cf(0x17c)]['logWhiteDomainRequest'](_0x4dc8cf(0x19f),_0x4dc8cf(0x17b),_0x4dc8cf(0x14b),Object[_0x4dc8cf(0x133)](_0x962a77[_0x4dc8cf(0x149)]()));const _0x22abaf=await fetch(_0x20818f,{'method':_0x4dc8cf(0x14b),'headers':{'Accept':_0x4dc8cf(0x171),'User-Agent':_0x4dc8cf(0x19c)}}),_0x17b5d9=Date['now']()-_0x529452;console[_0x4dc8cf(0x189)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x4dc8cf(0x189)]('Status:',_0x22abaf[_0x4dc8cf(0x180)]),console[_0x4dc8cf(0x189)](_0x4dc8cf(0x13c),_0x22abaf[_0x4dc8cf(0x18d)]),console[_0x4dc8cf(0x189)](_0x4dc8cf(0x19e),_0x17b5d9+'ms');const _0x171dde=await _0x22abaf[_0x4dc8cf(0x1a2)]();console['log'](_0x4dc8cf(0x153),_0x171dde);if(!_0x22abaf['ok']){console[_0x4dc8cf(0x138)](_0x4dc8cf(0x165)),console['error']('HTTP\x20Status:',_0x22abaf[_0x4dc8cf(0x180)]),console[_0x4dc8cf(0x138)](_0x4dc8cf(0x16b),_0x171dde),loggerService_1[_0x4dc8cf(0x17c)][_0x4dc8cf(0x18e)](_0x4dc8cf(0x19f),_0x4dc8cf(0x17b),_0x22abaf['status'],_0x171dde,_0x17b5d9),loggerService_1['loggerService'][_0x4dc8cf(0x135)](_0x4dc8cf(0x19f),_0x4dc8cf(0x17b),'HTTP\x20'+_0x22abaf[_0x4dc8cf(0x180)]+':\x20'+_0x171dde);throw new Error(_0x4dc8cf(0x137)+_0x22abaf['status']+_0x4dc8cf(0x16f)+_0x171dde);}let _0x3dd04e;try{_0x3dd04e=JSON['parse'](_0x171dde);}catch(_0x2a2048){console[_0x4dc8cf(0x138)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x2a2048),loggerService_1[_0x4dc8cf(0x17c)][_0x4dc8cf(0x135)]('plisio_direct',_0x4dc8cf(0x17b),_0x4dc8cf(0x14a)+_0x2a2048);throw new Error(_0x4dc8cf(0x18c)+_0x171dde);}console[_0x4dc8cf(0x189)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console['log'](_0x4dc8cf(0x136),JSON[_0x4dc8cf(0x196)](_0x3dd04e,null,0x2)),loggerService_1[_0x4dc8cf(0x17c)][_0x4dc8cf(0x18e)](_0x4dc8cf(0x19f),_0x4dc8cf(0x17b),_0x22abaf['status'],_0x3dd04e,_0x17b5d9);if(_0x3dd04e[_0x4dc8cf(0x180)]!==_0x4dc8cf(0x160)){const _0x44bd51=_0x3dd04e[_0x4dc8cf(0x140)]||_0x3dd04e['error']||_0x4dc8cf(0x191);console['error'](_0x4dc8cf(0x152)),console['error']('Error\x20Message:',_0x44bd51),loggerService_1[_0x4dc8cf(0x17c)][_0x4dc8cf(0x135)](_0x4dc8cf(0x19f),_0x4dc8cf(0x17b),_0x4dc8cf(0x170)+_0x44bd51);throw new Error(_0x4dc8cf(0x172)+_0x44bd51);}if(!_0x3dd04e['data']?.[_0x4dc8cf(0x193)]||!_0x3dd04e[_0x4dc8cf(0x142)]?.[_0x4dc8cf(0x19b)]){console[_0x4dc8cf(0x138)](_0x4dc8cf(0x176)),console['error']('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console['error'](_0x4dc8cf(0x14d),_0x3dd04e[_0x4dc8cf(0x142)]),loggerService_1['loggerService'][_0x4dc8cf(0x135)]('plisio_direct',_0x4dc8cf(0x17b),_0x4dc8cf(0x16e));throw new Error(_0x4dc8cf(0x1a1));}return console[_0x4dc8cf(0x189)](_0x4dc8cf(0x18a)),console[_0x4dc8cf(0x189)]('Transaction\x20ID:',_0x3dd04e[_0x4dc8cf(0x142)][_0x4dc8cf(0x193)]),console['log'](_0x4dc8cf(0x132),_0x3dd04e['data']['invoice_url']),console[_0x4dc8cf(0x189)](_0x4dc8cf(0x174),_0x256e20,_0x58da83),_0xf97e48&&(console[_0x4dc8cf(0x189)]('Source\x20Currency:',_0xf97e48,'(crypto\x20for\x20payment)'),console['log'](_0x4dc8cf(0x192),_0x58da83,_0x4dc8cf(0x131))),{'gateway_payment_id':_0x3dd04e['data'][_0x4dc8cf(0x193)],'payment_url':_0x3dd04e['data'][_0x4dc8cf(0x19b)],'invoice_total_sum':_0x3dd04e[_0x4dc8cf(0x142)][_0x4dc8cf(0x17d)],'qr_code':_0x3dd04e[_0x4dc8cf(0x142)][_0x4dc8cf(0x190)],'qr_url':_0x3dd04e['data'][_0x4dc8cf(0x16a)]};}catch(_0x386f75){console[_0x4dc8cf(0x138)](_0x4dc8cf(0x148)),console['error']('Error\x20details:',_0x386f75),loggerService_1[_0x4dc8cf(0x17c)][_0x4dc8cf(0x135)](_0x4dc8cf(0x19f),_0x4dc8cf(0x17b),_0x386f75);if(_0x386f75 instanceof Error){console[_0x4dc8cf(0x138)](_0x4dc8cf(0x1a0),_0x386f75[_0x4dc8cf(0x140)]),console['error'](_0x4dc8cf(0x151),_0x386f75[_0x4dc8cf(0x144)]);throw new Error(_0x4dc8cf(0x154)+_0x386f75[_0x4dc8cf(0x140)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a48_0x465412(0x14e)](_0xcf9629){const _0x597323=a48_0x465412,_0xc3d658=Date[_0x597323(0x173)]();try{if(!this[_0x597323(0x16d)])throw new Error(_0x597323(0x166));const _0x12f7ca=new URLSearchParams({'api_key':this[_0x597323(0x16d)],'txn_id':_0xcf9629}),_0x5cd6bc=_0x597323(0x169)+_0xcf9629+'?'+_0x12f7ca[_0x597323(0x185)]();loggerService_1[_0x597323(0x17c)]['logWhiteDomainRequest'](_0x597323(0x19f),_0x597323(0x156)+_0xcf9629,_0x597323(0x14b),Object[_0x597323(0x133)](_0x12f7ca['entries']()));const _0x3fd4df=await fetch(_0x5cd6bc,{'method':_0x597323(0x14b),'headers':{'Accept':_0x597323(0x171),'User-Agent':_0x597323(0x19c)}}),_0x240f1d=Date[_0x597323(0x173)]()-_0xc3d658;if(!_0x3fd4df['ok']){const _0x999aaf=await _0x3fd4df[_0x597323(0x1a2)]();loggerService_1[_0x597323(0x17c)][_0x597323(0x18e)](_0x597323(0x19f),_0x597323(0x156)+_0xcf9629,_0x3fd4df[_0x597323(0x180)],_0x999aaf,_0x240f1d);throw new Error(_0x597323(0x137)+_0x3fd4df[_0x597323(0x180)]);}const _0x567133=await _0x3fd4df['json']();loggerService_1[_0x597323(0x17c)][_0x597323(0x18e)](_0x597323(0x19f),_0x597323(0x156)+_0xcf9629,_0x3fd4df[_0x597323(0x180)],_0x567133,_0x240f1d);if(_0x567133[_0x597323(0x180)]!==_0x597323(0x160)){loggerService_1[_0x597323(0x17c)][_0x597323(0x135)](_0x597323(0x19f),_0x597323(0x156)+_0xcf9629,'Plisio\x20API\x20error:\x20'+(_0x567133[_0x597323(0x140)]||_0x567133[_0x597323(0x138)]||_0x597323(0x134)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x567133[_0x597323(0x140)]||_0x567133[_0x597323(0x138)]||'Unknown\x20error'));}let _0x110dec=_0x597323(0x145);return{'status':_0x110dec};}catch(_0x2d374c){console[_0x597323(0x138)]('Plisio\x20payment\x20verification\x20error:',_0x2d374c),loggerService_1['loggerService'][_0x597323(0x135)]('plisio_direct',_0x597323(0x156)+_0xcf9629,_0x2d374c);throw new Error(_0x597323(0x158)+(_0x2d374c instanceof Error?_0x2d374c[_0x597323(0x140)]:_0x597323(0x134)));}}async[a48_0x465412(0x19a)](_0x2d2dee){const _0x1fa387=a48_0x465412;console[_0x1fa387(0x189)](_0x1fa387(0x168),_0x2d2dee);let _0x3e02b0=_0x1fa387(0x145);switch(_0x2d2dee[_0x1fa387(0x180)]?.[_0x1fa387(0x188)]()){case _0x1fa387(0x162):case'mismatch':_0x3e02b0=_0x1fa387(0x178);break;case _0x1fa387(0x159):_0x3e02b0=_0x1fa387(0x146);break;case _0x1fa387(0x138):case _0x1fa387(0x15e):_0x3e02b0=_0x1fa387(0x164);break;case _0x1fa387(0x15b):_0x3e02b0=_0x1fa387(0x145);break;case _0x1fa387(0x15f):_0x3e02b0='PROCESSING';break;default:_0x3e02b0=_0x1fa387(0x145);break;}let _0x4464b5;if(_0x2d2dee[_0x1fa387(0x155)])try{console[_0x1fa387(0x189)](_0x1fa387(0x14c),_0x2d2dee[_0x1fa387(0x155)]);let _0x4339b3;if(typeof _0x2d2dee[_0x1fa387(0x155)]===_0x1fa387(0x17a))_0x4339b3=JSON[_0x1fa387(0x13e)](_0x2d2dee[_0x1fa387(0x155)]);else Array[_0x1fa387(0x184)](_0x2d2dee[_0x1fa387(0x155)])?_0x4339b3=_0x2d2dee['tx_urls']:_0x4339b3=[];_0x4464b5=_0x4339b3[_0x1fa387(0x12c)](_0x5dd815=>{const _0x5552d0=_0x1fa387,_0x2d422c=_0x5dd815[_0x5552d0(0x187)](/\\/g,'');return console[_0x5552d0(0x189)](_0x5552d0(0x199)+_0x5dd815+_0x5552d0(0x177)+_0x2d422c),_0x2d422c;}),console[_0x1fa387(0x189)]('✅\x20Processed\x20tx_urls:',_0x4464b5),_0x4464b5['forEach']((_0x174120,_0x42ed10)=>{const _0x31ad53=_0x1fa387;try{new URL(_0x174120),console[_0x31ad53(0x189)](_0x31ad53(0x141)+(_0x42ed10+0x1)+'\x20is\x20valid:\x20'+_0x174120);}catch(_0x3f2b75){console[_0x31ad53(0x138)]('❌\x20URL\x20'+(_0x42ed10+0x1)+_0x31ad53(0x195)+_0x174120,_0x3f2b75);}});}catch(_0x24e961){console[_0x1fa387(0x138)](_0x1fa387(0x13f),_0x24e961),console[_0x1fa387(0x138)](_0x1fa387(0x12d),_0x2d2dee[_0x1fa387(0x155)]),_0x4464b5=undefined;}return{'paymentId':_0x2d2dee[_0x1fa387(0x13d)]||'','status':_0x3e02b0,'amount':_0x2d2dee[_0x1fa387(0x186)],'currency':_0x2d2dee[_0x1fa387(0x182)],'txUrls':_0x4464b5};}}exports['PlisioService']=PlisioService;