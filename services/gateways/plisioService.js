'use strict';const a44_0x28b877=a44_0x36cd;(function(_0x421063,_0x5b648f){const _0x4bf4e3=a44_0x36cd,_0x1eb17b=_0x421063();while(!![]){try{const _0x2af06d=-parseInt(_0x4bf4e3(0x194))/0x1*(parseInt(_0x4bf4e3(0x1c2))/0x2)+parseInt(_0x4bf4e3(0x155))/0x3+-parseInt(_0x4bf4e3(0x161))/0x4+-parseInt(_0x4bf4e3(0x175))/0x5*(parseInt(_0x4bf4e3(0x1c5))/0x6)+-parseInt(_0x4bf4e3(0x1ac))/0x7+parseInt(_0x4bf4e3(0x19d))/0x8+parseInt(_0x4bf4e3(0x197))/0x9*(parseInt(_0x4bf4e3(0x162))/0xa);if(_0x2af06d===_0x5b648f)break;else _0x1eb17b['push'](_0x1eb17b['shift']());}catch(_0x59438f){_0x1eb17b['push'](_0x1eb17b['shift']());}}}(a44_0x1f02,0xba42c));Object[a44_0x28b877(0x17f)](exports,'__esModule',{'value':!![]}),exports[a44_0x28b877(0x1c8)]=void 0x0;function a44_0x36cd(_0x93c6e,_0x4c06b9){const _0x1f02e1=a44_0x1f02();return a44_0x36cd=function(_0x36cd46,_0x1f2402){_0x36cd46=_0x36cd46-0x153;let _0x52a73c=_0x1f02e1[_0x36cd46];return _0x52a73c;},a44_0x36cd(_0x93c6e,_0x4c06b9);}const loggerService_1=require(a44_0x28b877(0x18f));class PlisioService{constructor(){const _0x4008ed=a44_0x28b877;this[_0x4008ed(0x1b3)]=_0x4008ed(0x163),this[_0x4008ed(0x157)]=process[_0x4008ed(0x18d)]['PLISIO_API_KEY']||'',!this['apiKey']?console[_0x4008ed(0x154)](_0x4008ed(0x196)):console[_0x4008ed(0x1b6)](_0x4008ed(0x1a1));}async[a44_0x28b877(0x156)](_0x464549){const _0x9bcd2e=a44_0x28b877,{orderId:_0x580393,amount:_0x1b0239,currency:_0x5c53cc,productName:_0x4fc959,description:_0x5c6d9,successUrl:_0x34d8d6,failUrl:_0x407416,customerEmail:_0x971bcf,customerName:_0x459042,isSourceCurrency:_0x5c20b4,sourceCurrency:_0x570da7}=_0x464549;if(!this['apiKey'])throw new Error(_0x9bcd2e(0x188));const _0x340e7b=new URLSearchParams({'api_key':this[_0x9bcd2e(0x157)],'order_number':_0x580393,'order_name':_0x4fc959,'description':_0x5c6d9,'success_url':_0x34d8d6,'fail_url':_0x407416,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x570da7?(_0x340e7b[_0x9bcd2e(0x191)](_0x9bcd2e(0x1c6),_0x570da7),_0x340e7b[_0x9bcd2e(0x191)](_0x9bcd2e(0x187),_0x5c53cc),_0x340e7b[_0x9bcd2e(0x191)](_0x9bcd2e(0x15f),_0x1b0239[_0x9bcd2e(0x16c)]())):(_0x340e7b[_0x9bcd2e(0x191)](_0x9bcd2e(0x1c6),_0x5c53cc),_0x340e7b['append'](_0x9bcd2e(0x1a5),_0x1b0239['toString']()));_0x971bcf&&_0x340e7b[_0x9bcd2e(0x191)](_0x9bcd2e(0x1c3),_0x971bcf);_0x459042&&_0x340e7b[_0x9bcd2e(0x191)](_0x9bcd2e(0x1a4),_0x459042);const _0x19c460=this[_0x9bcd2e(0x1b3)]+'?'+_0x340e7b[_0x9bcd2e(0x16c)](),_0x3f43ee=Date[_0x9bcd2e(0x18c)]();try{console['log'](_0x9bcd2e(0x185)),console['log'](_0x9bcd2e(0x1a3),this['apiUrl']),console[_0x9bcd2e(0x1b6)](_0x9bcd2e(0x173),Object[_0x9bcd2e(0x172)](_0x340e7b[_0x9bcd2e(0x199)]())),console[_0x9bcd2e(0x1b6)](_0x9bcd2e(0x180),_0x19c460[_0x9bcd2e(0x181)](this[_0x9bcd2e(0x157)],_0x9bcd2e(0x1a0))),loggerService_1[_0x9bcd2e(0x1b1)][_0x9bcd2e(0x15a)](_0x9bcd2e(0x186),_0x9bcd2e(0x178),_0x9bcd2e(0x16d),Object[_0x9bcd2e(0x172)](_0x340e7b[_0x9bcd2e(0x199)]()));const _0x1c920c=await fetch(_0x19c460,{'method':_0x9bcd2e(0x16d),'headers':{'Accept':'application/json','User-Agent':_0x9bcd2e(0x1af)}}),_0x48157e=Date[_0x9bcd2e(0x18c)]()-_0x3f43ee;console['log'](_0x9bcd2e(0x18a)),console[_0x9bcd2e(0x1b6)](_0x9bcd2e(0x1c1),_0x1c920c[_0x9bcd2e(0x17e)]),console[_0x9bcd2e(0x1b6)](_0x9bcd2e(0x168),_0x1c920c['statusText']),console[_0x9bcd2e(0x1b6)](_0x9bcd2e(0x183),_0x48157e+'ms');const _0x131457=await _0x1c920c[_0x9bcd2e(0x1a2)]();console[_0x9bcd2e(0x1b6)](_0x9bcd2e(0x153),_0x131457);if(!_0x1c920c['ok']){console['error'](_0x9bcd2e(0x1aa)),console[_0x9bcd2e(0x16a)](_0x9bcd2e(0x193),_0x1c920c[_0x9bcd2e(0x17e)]),console[_0x9bcd2e(0x16a)](_0x9bcd2e(0x1be),_0x131457),loggerService_1['loggerService'][_0x9bcd2e(0x17c)]('plisio_direct','/invoices/new',_0x1c920c[_0x9bcd2e(0x17e)],_0x131457,_0x48157e),loggerService_1[_0x9bcd2e(0x1b1)]['logWhiteDomainError'](_0x9bcd2e(0x186),_0x9bcd2e(0x178),_0x9bcd2e(0x167)+_0x1c920c[_0x9bcd2e(0x17e)]+':\x20'+_0x131457);throw new Error(_0x9bcd2e(0x1a8)+_0x1c920c[_0x9bcd2e(0x17e)]+_0x9bcd2e(0x18b)+_0x131457);}let _0xe042f8;try{_0xe042f8=JSON[_0x9bcd2e(0x1b2)](_0x131457);}catch(_0x540183){console[_0x9bcd2e(0x16a)](_0x9bcd2e(0x179),_0x540183),loggerService_1['loggerService'][_0x9bcd2e(0x160)](_0x9bcd2e(0x186),_0x9bcd2e(0x178),'JSON\x20Parse\x20Error:\x20'+_0x540183);throw new Error(_0x9bcd2e(0x1ab)+_0x131457);}console[_0x9bcd2e(0x1b6)](_0x9bcd2e(0x1ad)),console[_0x9bcd2e(0x1b6)](_0x9bcd2e(0x17d),JSON[_0x9bcd2e(0x15e)](_0xe042f8,null,0x2)),loggerService_1[_0x9bcd2e(0x1b1)]['logWhiteDomainResponse'](_0x9bcd2e(0x186),_0x9bcd2e(0x178),_0x1c920c[_0x9bcd2e(0x17e)],_0xe042f8,_0x48157e);if(_0xe042f8[_0x9bcd2e(0x17e)]!=='success'){const _0x247202=_0xe042f8[_0x9bcd2e(0x1a7)]||_0xe042f8[_0x9bcd2e(0x16a)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x9bcd2e(0x16a)](_0x9bcd2e(0x1bb)),console['error'](_0x9bcd2e(0x165),_0x247202),loggerService_1[_0x9bcd2e(0x1b1)]['logWhiteDomainError'](_0x9bcd2e(0x186),_0x9bcd2e(0x178),_0x9bcd2e(0x1c0)+_0x247202);throw new Error('Plisio\x20API\x20error:\x20'+_0x247202);}if(!_0xe042f8[_0x9bcd2e(0x19e)]?.['txn_id']||!_0xe042f8['data']?.[_0x9bcd2e(0x190)]){console[_0x9bcd2e(0x16a)](_0x9bcd2e(0x158)),console['error'](_0x9bcd2e(0x1b4)),console[_0x9bcd2e(0x16a)](_0x9bcd2e(0x192),_0xe042f8[_0x9bcd2e(0x19e)]),loggerService_1[_0x9bcd2e(0x1b1)][_0x9bcd2e(0x160)](_0x9bcd2e(0x186),'/invoices/new',_0x9bcd2e(0x16e));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x9bcd2e(0x1b6)](_0x9bcd2e(0x1c4)),console[_0x9bcd2e(0x1b6)](_0x9bcd2e(0x171),_0xe042f8[_0x9bcd2e(0x19e)][_0x9bcd2e(0x1b0)]),console[_0x9bcd2e(0x1b6)](_0x9bcd2e(0x15b),_0xe042f8[_0x9bcd2e(0x19e)]['invoice_url']),console[_0x9bcd2e(0x1b6)](_0x9bcd2e(0x1c9),_0x1b0239,_0x5c53cc),_0x570da7&&(console[_0x9bcd2e(0x1b6)](_0x9bcd2e(0x1bc),_0x570da7,_0x9bcd2e(0x17b)),console['log']('Target\x20Currency:',_0x5c53cc,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0xe042f8['data'][_0x9bcd2e(0x1b0)],'payment_url':_0xe042f8[_0x9bcd2e(0x19e)][_0x9bcd2e(0x190)],'invoice_total_sum':_0xe042f8[_0x9bcd2e(0x19e)][_0x9bcd2e(0x1bf)],'qr_code':_0xe042f8[_0x9bcd2e(0x19e)][_0x9bcd2e(0x1b9)],'qr_url':_0xe042f8[_0x9bcd2e(0x19e)][_0x9bcd2e(0x170)]};}catch(_0x457a42){console[_0x9bcd2e(0x16a)](_0x9bcd2e(0x198)),console['error'](_0x9bcd2e(0x159),_0x457a42),loggerService_1[_0x9bcd2e(0x1b1)][_0x9bcd2e(0x160)](_0x9bcd2e(0x186),'/invoices/new',_0x457a42);if(_0x457a42 instanceof Error){console[_0x9bcd2e(0x16a)](_0x9bcd2e(0x166),_0x457a42[_0x9bcd2e(0x1a7)]),console[_0x9bcd2e(0x16a)](_0x9bcd2e(0x1a9),_0x457a42[_0x9bcd2e(0x174)]);throw new Error(_0x9bcd2e(0x1b8)+_0x457a42[_0x9bcd2e(0x1a7)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a44_0x28b877(0x1ae)](_0x8ab96f){const _0x1f53ed=a44_0x28b877,_0x41f342=Date[_0x1f53ed(0x18c)]();try{if(!this[_0x1f53ed(0x157)])throw new Error(_0x1f53ed(0x188));const _0x1ee649=new URLSearchParams({'api_key':this[_0x1f53ed(0x157)],'txn_id':_0x8ab96f}),_0x54419a='https://api.plisio.net/api/v1/operations/'+_0x8ab96f+'?'+_0x1ee649[_0x1f53ed(0x16c)]();loggerService_1[_0x1f53ed(0x1b1)][_0x1f53ed(0x15a)](_0x1f53ed(0x186),_0x1f53ed(0x19b)+_0x8ab96f,_0x1f53ed(0x16d),Object[_0x1f53ed(0x172)](_0x1ee649['entries']()));const _0x1b16a8=await fetch(_0x54419a,{'method':_0x1f53ed(0x16d),'headers':{'Accept':_0x1f53ed(0x182),'User-Agent':_0x1f53ed(0x1af)}}),_0x27aa06=Date[_0x1f53ed(0x18c)]()-_0x41f342;if(!_0x1b16a8['ok']){const _0x3971b2=await _0x1b16a8[_0x1f53ed(0x1a2)]();loggerService_1[_0x1f53ed(0x1b1)][_0x1f53ed(0x17c)](_0x1f53ed(0x186),'/operations/'+_0x8ab96f,_0x1b16a8[_0x1f53ed(0x17e)],_0x3971b2,_0x27aa06);throw new Error(_0x1f53ed(0x1a8)+_0x1b16a8[_0x1f53ed(0x17e)]);}const _0x5a85e4=await _0x1b16a8['json']();loggerService_1['loggerService'][_0x1f53ed(0x17c)](_0x1f53ed(0x186),_0x1f53ed(0x19b)+_0x8ab96f,_0x1b16a8[_0x1f53ed(0x17e)],_0x5a85e4,_0x27aa06);if(_0x5a85e4[_0x1f53ed(0x17e)]!==_0x1f53ed(0x15c)){loggerService_1['loggerService'][_0x1f53ed(0x160)]('plisio_direct',_0x1f53ed(0x19b)+_0x8ab96f,'Plisio\x20API\x20error:\x20'+(_0x5a85e4['message']||_0x5a85e4['error']||'Unknown\x20error'));throw new Error('Plisio\x20API\x20error:\x20'+(_0x5a85e4[_0x1f53ed(0x1a7)]||_0x5a85e4['error']||_0x1f53ed(0x184)));}let _0x1e7c54='PENDING';return{'status':_0x1e7c54};}catch(_0x437c3a){console[_0x1f53ed(0x16a)](_0x1f53ed(0x17a),_0x437c3a),loggerService_1['loggerService'][_0x1f53ed(0x160)](_0x1f53ed(0x186),_0x1f53ed(0x19b)+_0x8ab96f,_0x437c3a);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x437c3a instanceof Error?_0x437c3a['message']:_0x1f53ed(0x184)));}}async[a44_0x28b877(0x1a6)](_0x5f3ca4){const _0x1229fd=a44_0x28b877;console[_0x1229fd(0x1b6)]('Processing\x20Plisio\x20webhook:',_0x5f3ca4);let _0x2f8785=_0x1229fd(0x189);switch(_0x5f3ca4[_0x1229fd(0x17e)]?.['toLowerCase']()){case _0x1229fd(0x19a):case _0x1229fd(0x1b7):_0x2f8785=_0x1229fd(0x1ca);break;case _0x1229fd(0x16f):_0x2f8785=_0x1229fd(0x19c);break;case _0x1229fd(0x16a):case'cancelled':_0x2f8785='FAILED';break;case _0x1229fd(0x1ba):case _0x1229fd(0x177):default:_0x2f8785=_0x1229fd(0x189);break;}let _0x47a234;if(_0x5f3ca4[_0x1229fd(0x19f)])try{console[_0x1229fd(0x1b6)]('🔗\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x5f3ca4[_0x1229fd(0x19f)]);let _0x1518e3;if(typeof _0x5f3ca4[_0x1229fd(0x19f)]==='string')_0x1518e3=JSON['parse'](_0x5f3ca4['tx_urls']);else Array[_0x1229fd(0x15d)](_0x5f3ca4[_0x1229fd(0x19f)])?_0x1518e3=_0x5f3ca4[_0x1229fd(0x19f)]:_0x1518e3=[];_0x47a234=_0x1518e3['map'](_0x52cbf6=>{const _0x482761=_0x1229fd,_0x433e4e=_0x52cbf6['replace'](/\\/g,'');return console[_0x482761(0x1b6)](_0x482761(0x176)+_0x52cbf6+_0x482761(0x16b)+_0x433e4e),_0x433e4e;}),console[_0x1229fd(0x1b6)](_0x1229fd(0x1bd),_0x47a234),_0x47a234['forEach']((_0x45840a,_0x11a1ea)=>{const _0xe37199=_0x1229fd;try{new URL(_0x45840a),console[_0xe37199(0x1b6)](_0xe37199(0x1c7)+(_0x11a1ea+0x1)+_0xe37199(0x18e)+_0x45840a);}catch(_0x77c7b3){console[_0xe37199(0x16a)](_0xe37199(0x1b5)+(_0x11a1ea+0x1)+_0xe37199(0x164)+_0x45840a,_0x77c7b3);}});}catch(_0x21971c){console[_0x1229fd(0x16a)](_0x1229fd(0x169),_0x21971c),console['error']('Raw\x20tx_urls\x20data:',_0x5f3ca4[_0x1229fd(0x19f)]),_0x47a234=undefined;}return{'paymentId':_0x5f3ca4[_0x1229fd(0x195)]||'','status':_0x2f8785,'amount':_0x5f3ca4[_0x1229fd(0x1a5)],'currency':_0x5f3ca4[_0x1229fd(0x1c6)],'txUrls':_0x47a234};}}function a44_0x1f02(){const _0x3804e3=['/operations/','EXPIRED','4152968BjGtgS','data','tx_urls','HIDDEN','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','text','URL:','name','amount','processWebhook','message','HTTP\x20error!\x20status:\x20','Error\x20stack:','===\x20PLISIO\x20API\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','939533RgrJrQ','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','verifyPayment','TesSoft\x20Payment\x20System/1.0','txn_id','loggerService','parse','apiUrl','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','❌\x20URL\x20','log','mismatch','Failed\x20to\x20create\x20Plisio\x20payment:\x20','qr_code','new','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Source\x20Currency:','✅\x20Processed\x20tx_urls:','Response\x20Body:','invoice_total_sum','Business\x20Error:\x20','Status:','32324XDvqIh','email','===\x20PLISIO\x20SUCCESS\x20===','4044966dpNXYr','currency','✅\x20URL\x20','PlisioService','Amount:','PAID','Raw\x20Response\x20Body:','warn','2880513EBdycp','createPayment','apiKey','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20details:','logWhiteDomainRequest','Invoice\x20URL:','success','isArray','stringify','source_amount','logWhiteDomainError','3586544aSPYbN','50ZUrswT','https://api.plisio.net/api/v1/invoices/new','\x20is\x20invalid:\x20','Error\x20Message:','Error\x20message:','HTTP\x20','Status\x20Text:','❌\x20Failed\x20to\x20parse\x20tx_urls:','error','\x20->\x20','toString','GET','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','expired','qr_url','Transaction\x20ID:','fromEntries','Parameters:','stack','10aZQwni','🔗\x20Formatted\x20URL:\x20','pending','/invoices/new','Failed\x20to\x20parse\x20JSON\x20response:','Plisio\x20payment\x20verification\x20error:','(crypto\x20for\x20payment)','logWhiteDomainResponse','Parsed\x20Result:','status','defineProperty','Full\x20URL\x20(without\x20API\x20key):','replace','application/json','Response\x20Time:','Unknown\x20error','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','plisio_direct','source_currency','Plisio\x20API\x20key\x20is\x20not\x20configured','PENDING','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===',',\x20body:\x20','now','env','\x20is\x20valid:\x20','../loggerService','invoice_url','append','Response\x20data:','HTTP\x20Status:','23rIZDJn','order_number','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','3662163TgaBdD','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','entries','completed'];a44_0x1f02=function(){return _0x3804e3;};return a44_0x1f02();}exports['PlisioService']=PlisioService;