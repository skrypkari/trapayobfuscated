'use strict';const a47_0x23b2c7=a47_0x5235;(function(_0x2c4d5b,_0xde8fd2){const _0x40d8e5=a47_0x5235,_0x598493=_0x2c4d5b();while(!![]){try{const _0x1f0d50=parseInt(_0x40d8e5(0x144))/0x1*(-parseInt(_0x40d8e5(0x198))/0x2)+-parseInt(_0x40d8e5(0x190))/0x3*(-parseInt(_0x40d8e5(0x155))/0x4)+-parseInt(_0x40d8e5(0x17d))/0x5+parseInt(_0x40d8e5(0x16f))/0x6+-parseInt(_0x40d8e5(0x152))/0x7+parseInt(_0x40d8e5(0x16c))/0x8*(-parseInt(_0x40d8e5(0x164))/0x9)+parseInt(_0x40d8e5(0x184))/0xa;if(_0x1f0d50===_0xde8fd2)break;else _0x598493['push'](_0x598493['shift']());}catch(_0x42aa67){_0x598493['push'](_0x598493['shift']());}}}(a47_0x5b78,0x34bfe));Object[a47_0x23b2c7(0x1a4)](exports,a47_0x23b2c7(0x15a),{'value':!![]}),exports[a47_0x23b2c7(0x145)]=void 0x0;const loggerService_1=require(a47_0x23b2c7(0x1a5));function a47_0x5b78(){const _0x5ca7a9=['cancelled','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','===\x20PLISIO\x20API\x20ERROR\x20===','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','HTTP\x20error!\x20status:\x20',',\x20body:\x20','14882WbDjOI','PlisioService','toString','‚úÖ\x20URL\x20','apiKey','createPayment','name','Error\x20stack:','toLowerCase','Raw\x20tx_urls\x20data:','‚úÖ\x20Processed\x20tx_urls:','expired','üîó\x20Formatted\x20URL:\x20','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','2764825SfuPcO','logWhiteDomainError','log','256548XtsgHy','Amount:','entries','PAID','fromEntries','__esModule','qr_code','Full\x20URL\x20(without\x20API\x20key):','application/json','HTTP\x20Status:','Unknown\x20error','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','order_number','https://api.plisio.net/api/v1/invoices/new','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','497862Kjxzhj','mismatch','string','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','/invoices/new','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','plisio_direct','logWhiteDomainResponse','48zLZDTD','Status\x20Text:','invoice_url','920538VGVAti','PLISIO_API_KEY','txn_id','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','parse','append','https://api.trapay.uk/api/webhooks/gateway/plisio','email','TesSoft\x20Payment\x20System/1.0','env','Response\x20Time:','\x20is\x20invalid:\x20','https://api.plisio.net/api/v1/operations/','json','1728520UOhKYI','Error\x20Message:','status','/operations/','\x20is\x20valid:\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20','processWebhook','13595110soAlxG','replace','loggerService','message','Plisio\x20API\x20error:\x20','JSON\x20Parse\x20Error:\x20','(crypto\x20for\x20payment)','isArray','error','Response\x20data:','completed','tx_urls','9ocHMQn','Plisio\x20API\x20key\x20is\x20not\x20configured','stringify','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','HIDDEN','currency','Business\x20Error:\x20','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','56XNpMon','amount','Failed\x20to\x20parse\x20JSON\x20response:','Target\x20Currency:','pending','apiUrl','FAILED','Plisio\x20payment\x20verification\x20error:','Raw\x20Response\x20Body:','map','success','data','defineProperty','../loggerService','source_amount','text','forEach','GET','Response\x20Body:','logWhiteDomainRequest','Source\x20Currency:','now','Unknown\x20error\x20from\x20Plisio\x20API','PENDING'];a47_0x5b78=function(){return _0x5ca7a9;};return a47_0x5b78();}class PlisioService{constructor(){const _0xad634f=a47_0x23b2c7;this[_0xad634f(0x19d)]=_0xad634f(0x162),this[_0xad634f(0x148)]=process[_0xad634f(0x178)][_0xad634f(0x170)]||'',!this[_0xad634f(0x148)]?console['warn'](_0xad634f(0x167)):console[_0xad634f(0x154)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a47_0x23b2c7(0x149)](_0x31d933){const _0x49b901=a47_0x23b2c7,{orderId:_0x598a68,amount:_0x1ef373,currency:_0x3b289e,productName:_0x145609,description:_0x41d570,successUrl:_0x14a8a1,failUrl:_0x21c830,customerEmail:_0x2741f5,customerName:_0x4c372,isSourceCurrency:_0xb4634b,sourceCurrency:_0x5e7bc4}=_0x31d933;if(!this[_0x49b901(0x148)])throw new Error(_0x49b901(0x191));const _0x5102c1=new URLSearchParams({'api_key':this[_0x49b901(0x148)],'order_number':_0x598a68,'order_name':_0x145609,'description':_0x41d570,'success_url':_0x14a8a1,'fail_url':_0x21c830,'callback_url':_0x49b901(0x175)});_0x5e7bc4?(_0x5102c1['append'](_0x49b901(0x195),_0x5e7bc4),_0x5102c1[_0x49b901(0x174)]('source_currency',_0x3b289e),_0x5102c1[_0x49b901(0x174)](_0x49b901(0x1a6),_0x1ef373[_0x49b901(0x146)]())):(_0x5102c1[_0x49b901(0x174)](_0x49b901(0x195),_0x3b289e),_0x5102c1[_0x49b901(0x174)](_0x49b901(0x199),_0x1ef373[_0x49b901(0x146)]()));_0x2741f5&&_0x5102c1[_0x49b901(0x174)](_0x49b901(0x176),_0x2741f5);_0x4c372&&_0x5102c1[_0x49b901(0x174)](_0x49b901(0x14a),_0x4c372);const _0x42c9d2=this[_0x49b901(0x19d)]+'?'+_0x5102c1[_0x49b901(0x146)](),_0x572308=Date[_0x49b901(0x1ad)]();try{console[_0x49b901(0x154)](_0x49b901(0x151)),console[_0x49b901(0x154)]('URL:',this[_0x49b901(0x19d)]),console['log']('Parameters:',Object['fromEntries'](_0x5102c1[_0x49b901(0x157)]())),console[_0x49b901(0x154)](_0x49b901(0x15c),_0x42c9d2['replace'](this[_0x49b901(0x148)],_0x49b901(0x194))),loggerService_1[_0x49b901(0x186)]['logWhiteDomainRequest'](_0x49b901(0x16a),'/invoices/new','GET',Object['fromEntries'](_0x5102c1['entries']()));const _0x25ea8e=await fetch(_0x42c9d2,{'method':_0x49b901(0x1a9),'headers':{'Accept':_0x49b901(0x15d),'User-Agent':_0x49b901(0x177)}}),_0x282ad5=Date[_0x49b901(0x1ad)]()-_0x572308;console[_0x49b901(0x154)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x49b901(0x154)]('Status:',_0x25ea8e[_0x49b901(0x17f)]),console[_0x49b901(0x154)](_0x49b901(0x16d),_0x25ea8e['statusText']),console[_0x49b901(0x154)](_0x49b901(0x179),_0x282ad5+'ms');const _0x5ef01e=await _0x25ea8e[_0x49b901(0x1a7)]();console[_0x49b901(0x154)](_0x49b901(0x1a0),_0x5ef01e);if(!_0x25ea8e['ok']){console['error'](_0x49b901(0x1b2)),console['error'](_0x49b901(0x15e),_0x25ea8e[_0x49b901(0x17f)]),console[_0x49b901(0x18c)](_0x49b901(0x1aa),_0x5ef01e),loggerService_1[_0x49b901(0x186)][_0x49b901(0x16b)](_0x49b901(0x16a),_0x49b901(0x168),_0x25ea8e[_0x49b901(0x17f)],_0x5ef01e,_0x282ad5),loggerService_1[_0x49b901(0x186)]['logWhiteDomainError']('plisio_direct',_0x49b901(0x168),'HTTP\x20'+_0x25ea8e[_0x49b901(0x17f)]+':\x20'+_0x5ef01e);throw new Error(_0x49b901(0x142)+_0x25ea8e[_0x49b901(0x17f)]+_0x49b901(0x143)+_0x5ef01e);}let _0x2159b3;try{_0x2159b3=JSON[_0x49b901(0x173)](_0x5ef01e);}catch(_0x244766){console[_0x49b901(0x18c)](_0x49b901(0x19a),_0x244766),loggerService_1[_0x49b901(0x186)]['logWhiteDomainError']('plisio_direct',_0x49b901(0x168),_0x49b901(0x189)+_0x244766);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x5ef01e);}console['log'](_0x49b901(0x193)),console[_0x49b901(0x154)]('Parsed\x20Result:',JSON[_0x49b901(0x192)](_0x2159b3,null,0x2)),loggerService_1[_0x49b901(0x186)][_0x49b901(0x16b)](_0x49b901(0x16a),_0x49b901(0x168),_0x25ea8e[_0x49b901(0x17f)],_0x2159b3,_0x282ad5);if(_0x2159b3['status']!==_0x49b901(0x1a2)){const _0x39ee75=_0x2159b3[_0x49b901(0x187)]||_0x2159b3['error']||_0x49b901(0x1ae);console[_0x49b901(0x18c)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x49b901(0x17e),_0x39ee75),loggerService_1[_0x49b901(0x186)]['logWhiteDomainError'](_0x49b901(0x16a),'/invoices/new',_0x49b901(0x196)+_0x39ee75);throw new Error(_0x49b901(0x188)+_0x39ee75);}if(!_0x2159b3[_0x49b901(0x1a3)]?.[_0x49b901(0x171)]||!_0x2159b3[_0x49b901(0x1a3)]?.[_0x49b901(0x16e)]){console[_0x49b901(0x18c)](_0x49b901(0x197)),console[_0x49b901(0x18c)](_0x49b901(0x169)),console[_0x49b901(0x18c)](_0x49b901(0x18d),_0x2159b3[_0x49b901(0x1a3)]),loggerService_1[_0x49b901(0x186)][_0x49b901(0x153)](_0x49b901(0x16a),_0x49b901(0x168),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x49b901(0x141));}return console[_0x49b901(0x154)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x49b901(0x154)]('Transaction\x20ID:',_0x2159b3[_0x49b901(0x1a3)][_0x49b901(0x171)]),console['log']('Invoice\x20URL:',_0x2159b3[_0x49b901(0x1a3)][_0x49b901(0x16e)]),console[_0x49b901(0x154)](_0x49b901(0x156),_0x1ef373,_0x3b289e),_0x5e7bc4&&(console['log'](_0x49b901(0x1ac),_0x5e7bc4,_0x49b901(0x18a)),console[_0x49b901(0x154)](_0x49b901(0x19b),_0x3b289e,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x2159b3['data'][_0x49b901(0x171)],'payment_url':_0x2159b3['data']['invoice_url'],'invoice_total_sum':_0x2159b3[_0x49b901(0x1a3)]['invoice_total_sum'],'qr_code':_0x2159b3['data'][_0x49b901(0x15b)],'qr_url':_0x2159b3[_0x49b901(0x1a3)]['qr_url']};}catch(_0x14462c){console[_0x49b901(0x18c)](_0x49b901(0x163)),console['error']('Error\x20details:',_0x14462c),loggerService_1['loggerService'][_0x49b901(0x153)](_0x49b901(0x16a),'/invoices/new',_0x14462c);if(_0x14462c instanceof Error){console[_0x49b901(0x18c)]('Error\x20message:',_0x14462c[_0x49b901(0x187)]),console[_0x49b901(0x18c)](_0x49b901(0x14b),_0x14462c['stack']);throw new Error(_0x49b901(0x182)+_0x14462c[_0x49b901(0x187)]);}throw new Error(_0x49b901(0x1b1));}}async['verifyPayment'](_0x2d0b11){const _0x467cf3=a47_0x23b2c7,_0x105a07=Date[_0x467cf3(0x1ad)]();try{if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x360022=new URLSearchParams({'api_key':this[_0x467cf3(0x148)],'txn_id':_0x2d0b11}),_0xac5c1a=_0x467cf3(0x17b)+_0x2d0b11+'?'+_0x360022[_0x467cf3(0x146)]();loggerService_1['loggerService'][_0x467cf3(0x1ab)]('plisio_direct','/operations/'+_0x2d0b11,_0x467cf3(0x1a9),Object[_0x467cf3(0x159)](_0x360022[_0x467cf3(0x157)]()));const _0x108bd3=await fetch(_0xac5c1a,{'method':'GET','headers':{'Accept':_0x467cf3(0x15d),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x5ce5be=Date[_0x467cf3(0x1ad)]()-_0x105a07;if(!_0x108bd3['ok']){const _0x5b1f93=await _0x108bd3[_0x467cf3(0x1a7)]();loggerService_1['loggerService'][_0x467cf3(0x16b)]('plisio_direct',_0x467cf3(0x180)+_0x2d0b11,_0x108bd3['status'],_0x5b1f93,_0x5ce5be);throw new Error(_0x467cf3(0x142)+_0x108bd3[_0x467cf3(0x17f)]);}const _0x437fe8=await _0x108bd3[_0x467cf3(0x17c)]();loggerService_1[_0x467cf3(0x186)][_0x467cf3(0x16b)](_0x467cf3(0x16a),_0x467cf3(0x180)+_0x2d0b11,_0x108bd3[_0x467cf3(0x17f)],_0x437fe8,_0x5ce5be);if(_0x437fe8[_0x467cf3(0x17f)]!==_0x467cf3(0x1a2)){loggerService_1[_0x467cf3(0x186)][_0x467cf3(0x153)](_0x467cf3(0x16a),_0x467cf3(0x180)+_0x2d0b11,_0x467cf3(0x188)+(_0x437fe8[_0x467cf3(0x187)]||_0x437fe8[_0x467cf3(0x18c)]||'Unknown\x20error'));throw new Error('Plisio\x20API\x20error:\x20'+(_0x437fe8['message']||_0x437fe8[_0x467cf3(0x18c)]||_0x467cf3(0x15f)));}let _0x2b52a4=_0x467cf3(0x1af);return{'status':_0x2b52a4};}catch(_0x433e13){console[_0x467cf3(0x18c)](_0x467cf3(0x19f),_0x433e13),loggerService_1[_0x467cf3(0x186)]['logWhiteDomainError'](_0x467cf3(0x16a),'/operations/'+_0x2d0b11,_0x433e13);throw new Error(_0x467cf3(0x160)+(_0x433e13 instanceof Error?_0x433e13[_0x467cf3(0x187)]:_0x467cf3(0x15f)));}}async[a47_0x23b2c7(0x183)](_0x2ecd1c){const _0x51c876=a47_0x23b2c7;console[_0x51c876(0x154)]('Processing\x20Plisio\x20webhook:',_0x2ecd1c);let _0x26c813=_0x51c876(0x1af);switch(_0x2ecd1c[_0x51c876(0x17f)]?.[_0x51c876(0x14c)]()){case _0x51c876(0x18e):case _0x51c876(0x165):_0x26c813=_0x51c876(0x158);break;case _0x51c876(0x14f):_0x26c813='EXPIRED';break;case _0x51c876(0x18c):case _0x51c876(0x1b0):_0x26c813=_0x51c876(0x19e);break;case'new':_0x26c813='PENDING';break;case _0x51c876(0x19c):_0x26c813='PROCESSING';break;default:_0x26c813=_0x51c876(0x1af);break;}let _0x310e70;if(_0x2ecd1c[_0x51c876(0x18f)])try{console[_0x51c876(0x154)]('üîó\x20Raw\x20tx_urls\x20from\x20Plisio:',_0x2ecd1c[_0x51c876(0x18f)]);let _0x12adf7;if(typeof _0x2ecd1c['tx_urls']===_0x51c876(0x166))_0x12adf7=JSON['parse'](_0x2ecd1c['tx_urls']);else Array[_0x51c876(0x18b)](_0x2ecd1c[_0x51c876(0x18f)])?_0x12adf7=_0x2ecd1c[_0x51c876(0x18f)]:_0x12adf7=[];_0x310e70=_0x12adf7[_0x51c876(0x1a1)](_0x202d49=>{const _0x50223a=_0x51c876,_0x3741f8=_0x202d49[_0x50223a(0x185)](/\\/g,'');return console[_0x50223a(0x154)](_0x50223a(0x150)+_0x202d49+'\x20->\x20'+_0x3741f8),_0x3741f8;}),console[_0x51c876(0x154)](_0x51c876(0x14e),_0x310e70),_0x310e70[_0x51c876(0x1a8)]((_0x55c1ba,_0x48885f)=>{const _0x247e55=_0x51c876;try{new URL(_0x55c1ba),console['log'](_0x247e55(0x147)+(_0x48885f+0x1)+_0x247e55(0x181)+_0x55c1ba);}catch(_0x35856c){console['error']('‚ùå\x20URL\x20'+(_0x48885f+0x1)+_0x247e55(0x17a)+_0x55c1ba,_0x35856c);}});}catch(_0x3d5e1f){console['error'](_0x51c876(0x172),_0x3d5e1f),console['error'](_0x51c876(0x14d),_0x2ecd1c[_0x51c876(0x18f)]),_0x310e70=undefined;}return{'paymentId':_0x2ecd1c[_0x51c876(0x161)]||'','status':_0x26c813,'amount':_0x2ecd1c[_0x51c876(0x199)],'currency':_0x2ecd1c[_0x51c876(0x195)],'txUrls':_0x310e70};}}function a47_0x5235(_0x26afd9,_0x16950c){const _0x5b78f7=a47_0x5b78();return a47_0x5235=function(_0x5235bf,_0x33f04f){_0x5235bf=_0x5235bf-0x141;let _0x4d65c9=_0x5b78f7[_0x5235bf];return _0x4d65c9;},a47_0x5235(_0x26afd9,_0x16950c);}exports['PlisioService']=PlisioService;