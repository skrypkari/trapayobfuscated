'use strict';const a66_0x3f4515=a66_0x314f;(function(_0x3c39fa,_0x3fbb30){const _0x658ea1=a66_0x314f,_0x594e69=_0x3c39fa();while(!![]){try{const _0x345134=-parseInt(_0x658ea1(0x1a7))/0x1*(-parseInt(_0x658ea1(0x165))/0x2)+parseInt(_0x658ea1(0x16b))/0x3*(parseInt(_0x658ea1(0x1a6))/0x4)+-parseInt(_0x658ea1(0x1c8))/0x5+-parseInt(_0x658ea1(0x19e))/0x6*(parseInt(_0x658ea1(0x1ca))/0x7)+-parseInt(_0x658ea1(0x1ad))/0x8*(-parseInt(_0x658ea1(0x1c4))/0x9)+-parseInt(_0x658ea1(0x1ba))/0xa*(parseInt(_0x658ea1(0x17b))/0xb)+parseInt(_0x658ea1(0x17f))/0xc;if(_0x345134===_0x3fbb30)break;else _0x594e69['push'](_0x594e69['shift']());}catch(_0x27695e){_0x594e69['push'](_0x594e69['shift']());}}}(a66_0x282f,0x90490));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a66_0x3f4515(0x191)]=void 0x0;const loggerService_1=require(a66_0x3f4515(0x1d7));function a66_0x282f(){const _0x4ed257=['Full\x20URL\x20(without\x20API\x20key):','data','logWhiteDomainResponse','HIDDEN','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','14YNrWvh','Status\x20Text:','ðŸ”—\x20Formatted\x20URL:\x20','loggerService','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','1326zPbofS','source_currency','forEach','apiKey','PLISIO_API_KEY',',\x20body:\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20','map','PROCESSING','===\x20PLISIO\x20API\x20ERROR\x20===','===\x20PLISIO\x20SUCCESS\x20===','Payment\x20System/1.0','source_amount','logWhiteDomainError','invoice_total_sum','PAID','1692163WRzcYO','ðŸ”—\x20Raw\x20tx_urls\x20from\x20Plisio:','createPayment','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','18006804yzBOtK','error','expired','amount','invoice_url','Plisio\x20payment\x20verification\x20error:','Error\x20message:','Error\x20details:','Response\x20Time:','PENDING','(crypto\x20for\x20payment)','email','Transaction\x20ID:','name','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','apiUrl','txn_id','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','PlisioService','order_number','logWhiteDomainRequest','statusText','Invoice\x20URL:','Raw\x20Response\x20Body:','currency','toLowerCase','fromEntries','Raw\x20tx_urls\x20data:','Target\x20Currency:','message','Unknown\x20error','6umkIEr','/operations/','parse','cancelled','text','Plisio\x20API\x20key\x20is\x20not\x20configured','stack','(fiat\x20for\x20merchant)','2552kgRaXh','2459ZlbOFv','string','qr_url','âŒ\x20Failed\x20to\x20parse\x20tx_urls:','âŒ\x20URL\x20','/invoices/new','16lRyJbU','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','\x20is\x20valid:\x20','application/json','URL:','env','\x20->\x20','tx_urls','status','\x20is\x20invalid:\x20','Parsed\x20Result:','Business\x20Error:\x20','mismatch','10rzOGrX','https://api.plisio.net/api/v1/invoices/new','HTTP\x20','log','json','HTTP\x20Status:','GET','append','entries','Response\x20Body:','207414CjtVLr','âœ…\x20Processed\x20tx_urls:','âœ…\x20URL\x20','Parameters:','2583270eccNZJ','Plisio\x20API\x20error:\x20','4090723hexJpc','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','toString','plisio_direct','HTTP\x20error!\x20status:\x20','âš ï¸\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Error\x20stack:','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','JSON\x20Parse\x20Error:\x20','now','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','replace','isArray','../loggerService'];a66_0x282f=function(){return _0x4ed257;};return a66_0x282f();}function a66_0x314f(_0x4c733b,_0x11b80b){_0x4c733b=_0x4c733b-0x165;const _0x282f2b=a66_0x282f();let _0x314f27=_0x282f2b[_0x4c733b];return _0x314f27;}class PlisioService{constructor(){const _0x108c8f=a66_0x3f4515;this[_0x108c8f(0x18e)]=_0x108c8f(0x1bb),this[_0x108c8f(0x16e)]=process[_0x108c8f(0x1b2)][_0x108c8f(0x16f)]||'',!this[_0x108c8f(0x16e)]?console['warn'](_0x108c8f(0x1cf)):console[_0x108c8f(0x1bd)]('ðŸ’°\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a66_0x3f4515(0x17d)](_0x591b80){const _0x43edf9=a66_0x3f4515,{orderId:_0x40602d,amount:_0x347bb1,currency:_0x540729,productName:_0x2ed4eb,description:_0x128a1b,successUrl:_0x52ff6f,failUrl:_0x242629,customerEmail:_0x2dc68d,customerName:_0x548820,isSourceCurrency:_0x3eb276,sourceCurrency:_0x2af0d4}=_0x591b80;if(!this[_0x43edf9(0x16e)])throw new Error(_0x43edf9(0x1a3));const _0x15e133=new URLSearchParams({'api_key':this[_0x43edf9(0x16e)],'order_number':_0x40602d,'order_name':_0x2ed4eb,'description':_0x128a1b,'success_url':_0x52ff6f,'fail_url':_0x242629,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x2af0d4?(_0x15e133['append'](_0x43edf9(0x197),_0x2af0d4),_0x15e133['append'](_0x43edf9(0x16c),_0x540729),_0x15e133[_0x43edf9(0x1c1)](_0x43edf9(0x177),_0x347bb1[_0x43edf9(0x1cc)]())):(_0x15e133[_0x43edf9(0x1c1)](_0x43edf9(0x197),_0x540729),_0x15e133[_0x43edf9(0x1c1)]('amount',_0x347bb1['toString']()));_0x2dc68d&&_0x15e133[_0x43edf9(0x1c1)](_0x43edf9(0x18a),_0x2dc68d);_0x548820&&_0x15e133['append'](_0x43edf9(0x18c),_0x548820);const _0x5c08c6=this[_0x43edf9(0x18e)]+'?'+_0x15e133[_0x43edf9(0x1cc)](),_0x362378=Date[_0x43edf9(0x1d3)]();try{console[_0x43edf9(0x1bd)](_0x43edf9(0x1d4)),console[_0x43edf9(0x1bd)](_0x43edf9(0x1b1),this[_0x43edf9(0x18e)]),console[_0x43edf9(0x1bd)](_0x43edf9(0x1c7),Object[_0x43edf9(0x199)](_0x15e133[_0x43edf9(0x1c2)]())),console[_0x43edf9(0x1bd)](_0x43edf9(0x1d8),_0x5c08c6[_0x43edf9(0x1d5)](this[_0x43edf9(0x16e)],_0x43edf9(0x1db))),loggerService_1[_0x43edf9(0x168)]['logWhiteDomainRequest']('plisio_direct',_0x43edf9(0x1ac),'GET',Object[_0x43edf9(0x199)](_0x15e133[_0x43edf9(0x1c2)]()));const _0x45850c=await fetch(_0x5c08c6,{'method':_0x43edf9(0x1c0),'headers':{'Accept':_0x43edf9(0x1b0),'User-Agent':_0x43edf9(0x176)}}),_0x1763d9=Date['now']()-_0x362378;console['log'](_0x43edf9(0x17e)),console[_0x43edf9(0x1bd)]('Status:',_0x45850c[_0x43edf9(0x1b5)]),console[_0x43edf9(0x1bd)](_0x43edf9(0x166),_0x45850c[_0x43edf9(0x194)]),console[_0x43edf9(0x1bd)](_0x43edf9(0x187),_0x1763d9+'ms');const _0x198d05=await _0x45850c[_0x43edf9(0x1a2)]();console['log'](_0x43edf9(0x196),_0x198d05);if(!_0x45850c['ok']){console[_0x43edf9(0x180)](_0x43edf9(0x174)),console['error'](_0x43edf9(0x1bf),_0x45850c[_0x43edf9(0x1b5)]),console[_0x43edf9(0x180)](_0x43edf9(0x1c3),_0x198d05),loggerService_1['loggerService'][_0x43edf9(0x1da)](_0x43edf9(0x1cd),_0x43edf9(0x1ac),_0x45850c[_0x43edf9(0x1b5)],_0x198d05,_0x1763d9),loggerService_1[_0x43edf9(0x168)][_0x43edf9(0x178)](_0x43edf9(0x1cd),'/invoices/new',_0x43edf9(0x1bc)+_0x45850c[_0x43edf9(0x1b5)]+':\x20'+_0x198d05);throw new Error(_0x43edf9(0x1ce)+_0x45850c[_0x43edf9(0x1b5)]+_0x43edf9(0x170)+_0x198d05);}let _0x4a985b;try{_0x4a985b=JSON['parse'](_0x198d05);}catch(_0x5015a7){console[_0x43edf9(0x180)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5015a7),loggerService_1[_0x43edf9(0x168)][_0x43edf9(0x178)](_0x43edf9(0x1cd),'/invoices/new',_0x43edf9(0x1d2)+_0x5015a7);throw new Error(_0x43edf9(0x190)+_0x198d05);}console[_0x43edf9(0x1bd)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x43edf9(0x1bd)](_0x43edf9(0x1b7),JSON['stringify'](_0x4a985b,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x43edf9(0x1cd),'/invoices/new',_0x45850c['status'],_0x4a985b,_0x1763d9);if(_0x4a985b[_0x43edf9(0x1b5)]!=='success'){const _0x5dae68=_0x4a985b['message']||_0x4a985b[_0x43edf9(0x180)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x43edf9(0x180)](_0x43edf9(0x169)),console['error']('Error\x20Message:',_0x5dae68),loggerService_1['loggerService'][_0x43edf9(0x178)]('plisio_direct','/invoices/new',_0x43edf9(0x1b8)+_0x5dae68);throw new Error('Plisio\x20API\x20error:\x20'+_0x5dae68);}if(!_0x4a985b[_0x43edf9(0x1d9)]?.[_0x43edf9(0x18f)]||!_0x4a985b[_0x43edf9(0x1d9)]?.['invoice_url']){console['error']('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x43edf9(0x1cb)),console[_0x43edf9(0x180)]('Response\x20data:',_0x4a985b[_0x43edf9(0x1d9)]),loggerService_1[_0x43edf9(0x168)][_0x43edf9(0x178)](_0x43edf9(0x1cd),_0x43edf9(0x1ac),_0x43edf9(0x1dc));throw new Error(_0x43edf9(0x1ae));}return console[_0x43edf9(0x1bd)](_0x43edf9(0x175)),console[_0x43edf9(0x1bd)](_0x43edf9(0x18b),_0x4a985b[_0x43edf9(0x1d9)][_0x43edf9(0x18f)]),console[_0x43edf9(0x1bd)](_0x43edf9(0x195),_0x4a985b[_0x43edf9(0x1d9)][_0x43edf9(0x183)]),console[_0x43edf9(0x1bd)]('Amount:',_0x347bb1,_0x540729),_0x2af0d4&&(console['log']('Source\x20Currency:',_0x2af0d4,_0x43edf9(0x189)),console[_0x43edf9(0x1bd)](_0x43edf9(0x19b),_0x540729,_0x43edf9(0x1a5))),{'gateway_payment_id':_0x4a985b[_0x43edf9(0x1d9)]['txn_id'],'payment_url':_0x4a985b['data']['invoice_url'],'invoice_total_sum':_0x4a985b[_0x43edf9(0x1d9)][_0x43edf9(0x179)],'qr_code':_0x4a985b['data']['qr_code'],'qr_url':_0x4a985b[_0x43edf9(0x1d9)][_0x43edf9(0x1a9)]};}catch(_0x5a3b83){console['error'](_0x43edf9(0x16a)),console[_0x43edf9(0x180)](_0x43edf9(0x186),_0x5a3b83),loggerService_1[_0x43edf9(0x168)][_0x43edf9(0x178)](_0x43edf9(0x1cd),_0x43edf9(0x1ac),_0x5a3b83);if(_0x5a3b83 instanceof Error){console[_0x43edf9(0x180)](_0x43edf9(0x185),_0x5a3b83[_0x43edf9(0x19c)]),console[_0x43edf9(0x180)](_0x43edf9(0x1d0),_0x5a3b83[_0x43edf9(0x1a4)]);throw new Error(_0x43edf9(0x171)+_0x5a3b83[_0x43edf9(0x19c)]);}throw new Error(_0x43edf9(0x1d1));}}async['verifyPayment'](_0x76b89e){const _0xed46b7=a66_0x3f4515,_0x232eda=Date['now']();try{if(!this[_0xed46b7(0x16e)])throw new Error(_0xed46b7(0x1a3));const _0x3f299a=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x76b89e}),_0x35d562='https://api.plisio.net/api/v1/operations/'+_0x76b89e+'?'+_0x3f299a['toString']();loggerService_1['loggerService'][_0xed46b7(0x193)](_0xed46b7(0x1cd),_0xed46b7(0x19f)+_0x76b89e,'GET',Object['fromEntries'](_0x3f299a[_0xed46b7(0x1c2)]()));const _0x3c6faa=await fetch(_0x35d562,{'method':_0xed46b7(0x1c0),'headers':{'Accept':'application/json','User-Agent':'Payment\x20System/1.0'}}),_0x44eee1=Date['now']()-_0x232eda;if(!_0x3c6faa['ok']){const _0x5d16d1=await _0x3c6faa[_0xed46b7(0x1a2)]();loggerService_1[_0xed46b7(0x168)][_0xed46b7(0x1da)](_0xed46b7(0x1cd),'/operations/'+_0x76b89e,_0x3c6faa['status'],_0x5d16d1,_0x44eee1);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3c6faa['status']);}const _0x44e05f=await _0x3c6faa[_0xed46b7(0x1be)]();loggerService_1[_0xed46b7(0x168)][_0xed46b7(0x1da)](_0xed46b7(0x1cd),_0xed46b7(0x19f)+_0x76b89e,_0x3c6faa[_0xed46b7(0x1b5)],_0x44e05f,_0x44eee1);if(_0x44e05f[_0xed46b7(0x1b5)]!=='success'){loggerService_1['loggerService'][_0xed46b7(0x178)]('plisio_direct',_0xed46b7(0x19f)+_0x76b89e,_0xed46b7(0x1c9)+(_0x44e05f[_0xed46b7(0x19c)]||_0x44e05f[_0xed46b7(0x180)]||_0xed46b7(0x19d)));throw new Error(_0xed46b7(0x1c9)+(_0x44e05f[_0xed46b7(0x19c)]||_0x44e05f[_0xed46b7(0x180)]||_0xed46b7(0x19d)));}let _0x2722ca=_0xed46b7(0x188);return{'status':_0x2722ca};}catch(_0x3444e4){console[_0xed46b7(0x180)](_0xed46b7(0x184),_0x3444e4),loggerService_1[_0xed46b7(0x168)]['logWhiteDomainError'](_0xed46b7(0x1cd),'/operations/'+_0x76b89e,_0x3444e4);throw new Error(_0xed46b7(0x18d)+(_0x3444e4 instanceof Error?_0x3444e4['message']:_0xed46b7(0x19d)));}}async['processWebhook'](_0x299e7e){const _0x32d148=a66_0x3f4515;console[_0x32d148(0x1bd)]('Processing\x20Plisio\x20webhook:',_0x299e7e);let _0x2d7601='PENDING';switch(_0x299e7e[_0x32d148(0x1b5)]?.[_0x32d148(0x198)]()){case'completed':case _0x32d148(0x1b9):_0x2d7601=_0x32d148(0x17a);break;case _0x32d148(0x181):_0x2d7601='EXPIRED';break;case _0x32d148(0x180):case _0x32d148(0x1a1):_0x2d7601='FAILED';break;case'new':_0x2d7601=_0x32d148(0x188);break;case'pending':_0x2d7601=_0x32d148(0x173);break;default:_0x2d7601=_0x32d148(0x188);break;}let _0x4c66a9;if(_0x299e7e[_0x32d148(0x1b4)])try{console[_0x32d148(0x1bd)](_0x32d148(0x17c),_0x299e7e[_0x32d148(0x1b4)]);let _0x2cfd01;if(typeof _0x299e7e[_0x32d148(0x1b4)]===_0x32d148(0x1a8))_0x2cfd01=JSON[_0x32d148(0x1a0)](_0x299e7e[_0x32d148(0x1b4)]);else Array[_0x32d148(0x1d6)](_0x299e7e[_0x32d148(0x1b4)])?_0x2cfd01=_0x299e7e[_0x32d148(0x1b4)]:_0x2cfd01=[];_0x4c66a9=_0x2cfd01[_0x32d148(0x172)](_0x4715cc=>{const _0x44921e=_0x32d148,_0x15f7f2=_0x4715cc[_0x44921e(0x1d5)](/\\/g,'');return console[_0x44921e(0x1bd)](_0x44921e(0x167)+_0x4715cc+_0x44921e(0x1b3)+_0x15f7f2),_0x15f7f2;}),console[_0x32d148(0x1bd)](_0x32d148(0x1c5),_0x4c66a9),_0x4c66a9[_0x32d148(0x16d)]((_0x478aa7,_0x17415f)=>{const _0x52ae1e=_0x32d148;try{new URL(_0x478aa7),console['log'](_0x52ae1e(0x1c6)+(_0x17415f+0x1)+_0x52ae1e(0x1af)+_0x478aa7);}catch(_0x223de5){console['error'](_0x52ae1e(0x1ab)+(_0x17415f+0x1)+_0x52ae1e(0x1b6)+_0x478aa7,_0x223de5);}});}catch(_0x331346){console['error'](_0x32d148(0x1aa),_0x331346),console[_0x32d148(0x180)](_0x32d148(0x19a),_0x299e7e['tx_urls']),_0x4c66a9=undefined;}return{'paymentId':_0x299e7e[_0x32d148(0x192)]||'','status':_0x2d7601,'amount':_0x299e7e[_0x32d148(0x182)],'currency':_0x299e7e[_0x32d148(0x197)],'txUrls':_0x4c66a9};}}exports[a66_0x3f4515(0x191)]=PlisioService;