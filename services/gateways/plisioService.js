'use strict';const a74_0x212fab=a74_0x5e18;(function(_0x468a28,_0x371590){const _0x124aa1=a74_0x5e18,_0x46d499=_0x468a28();while(!![]){try{const _0x4fc7bd=-parseInt(_0x124aa1(0x166))/0x1*(parseInt(_0x124aa1(0x1b2))/0x2)+-parseInt(_0x124aa1(0x163))/0x3*(-parseInt(_0x124aa1(0x1a5))/0x4)+parseInt(_0x124aa1(0x194))/0x5*(-parseInt(_0x124aa1(0x1c3))/0x6)+parseInt(_0x124aa1(0x1ac))/0x7*(parseInt(_0x124aa1(0x184))/0x8)+-parseInt(_0x124aa1(0x19c))/0x9+-parseInt(_0x124aa1(0x179))/0xa*(parseInt(_0x124aa1(0x187))/0xb)+parseInt(_0x124aa1(0x1b1))/0xc*(parseInt(_0x124aa1(0x175))/0xd);if(_0x4fc7bd===_0x371590)break;else _0x46d499['push'](_0x46d499['shift']());}catch(_0xe39656){_0x46d499['push'](_0x46d499['shift']());}}}(a74_0x2f10,0x35d1f));Object['defineProperty'](exports,a74_0x212fab(0x1b0),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require(a74_0x212fab(0x181));class PlisioService{constructor(){const _0x4c250a=a74_0x212fab;this[_0x4c250a(0x14d)]=_0x4c250a(0x1aa),this[_0x4c250a(0x15b)]=process.env.PLISIO_API_KEY||'',!this['apiKey']?console['warn'](_0x4c250a(0x191)):console[_0x4c250a(0x1c1)](_0x4c250a(0x154));}async[a74_0x212fab(0x14f)](_0x4e472f){const _0x516630=a74_0x212fab,{orderId:_0x1c949f,amount:_0x4129d0,currency:_0x521924,productName:_0x338ac1,description:_0x4ba31c,successUrl:_0x5ddfd2,failUrl:_0x3ee7c0,customerEmail:_0x52a801,customerName:_0x42121c,isSourceCurrency:_0x523c03,sourceCurrency:_0xd9cd90}=_0x4e472f;if(!this[_0x516630(0x15b)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x215f9d=new URLSearchParams({'api_key':this[_0x516630(0x15b)],'order_number':_0x1c949f,'order_name':_0x338ac1,'description':_0x4ba31c,'success_url':_0x5ddfd2,'fail_url':_0x3ee7c0,'callback_url':_0x516630(0x1ba)});_0xd9cd90?(_0x215f9d['append'](_0x516630(0x1a8),_0xd9cd90),_0x215f9d[_0x516630(0x14b)](_0x516630(0x14e),_0x521924),_0x215f9d[_0x516630(0x14b)](_0x516630(0x17c),_0x4129d0[_0x516630(0x14c)]())):(_0x215f9d[_0x516630(0x14b)](_0x516630(0x1a8),_0x521924),_0x215f9d['append'](_0x516630(0x164),_0x4129d0[_0x516630(0x14c)]()));_0x52a801&&_0x215f9d['append']('email',_0x52a801);_0x42121c&&_0x215f9d[_0x516630(0x14b)]('name',_0x42121c);const _0x5d0c56=this[_0x516630(0x14d)]+'?'+_0x215f9d[_0x516630(0x14c)](),_0x10b838=Date['now']();try{console[_0x516630(0x1c1)](_0x516630(0x165)),console[_0x516630(0x1c1)](_0x516630(0x15c),this['apiUrl']),console['log'](_0x516630(0x157),Object[_0x516630(0x160)](_0x215f9d['entries']())),console[_0x516630(0x1c1)](_0x516630(0x182),_0x5d0c56[_0x516630(0x1be)](this['apiKey'],_0x516630(0x16c))),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x516630(0x19a),_0x516630(0x1a2),_0x516630(0x178),Object[_0x516630(0x160)](_0x215f9d[_0x516630(0x1a1)]()));const _0x5535cd=await fetch(_0x5d0c56,{'method':'GET','headers':{'Accept':_0x516630(0x150),'User-Agent':'Payment\x20System/1.0'}}),_0x3b524e=Date[_0x516630(0x1b9)]()-_0x10b838;console['log'](_0x516630(0x1b8)),console[_0x516630(0x1c1)](_0x516630(0x1b7),_0x5535cd[_0x516630(0x153)]),console[_0x516630(0x1c1)]('Status\x20Text:',_0x5535cd[_0x516630(0x17f)]),console[_0x516630(0x1c1)]('Response\x20Time:',_0x3b524e+'ms');const _0x28ebe5=await _0x5535cd[_0x516630(0x15a)]();console[_0x516630(0x1c1)](_0x516630(0x186),_0x28ebe5);if(!_0x5535cd['ok']){console[_0x516630(0x196)](_0x516630(0x18f)),console[_0x516630(0x196)](_0x516630(0x1c0),_0x5535cd[_0x516630(0x153)]),console[_0x516630(0x196)](_0x516630(0x19f),_0x28ebe5),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x516630(0x19a),_0x516630(0x1a2),_0x5535cd[_0x516630(0x153)],_0x28ebe5,_0x3b524e),loggerService_1['loggerService']['logWhiteDomainError'](_0x516630(0x19a),_0x516630(0x1a2),_0x516630(0x189)+_0x5535cd[_0x516630(0x153)]+':\x20'+_0x28ebe5);throw new Error(_0x516630(0x15f)+_0x5535cd[_0x516630(0x153)]+_0x516630(0x171)+_0x28ebe5);}let _0x954ff9;try{_0x954ff9=JSON[_0x516630(0x151)](_0x28ebe5);}catch(_0x24b248){console['error'](_0x516630(0x1c4),_0x24b248),loggerService_1[_0x516630(0x190)][_0x516630(0x17e)](_0x516630(0x19a),_0x516630(0x1a2),_0x516630(0x19b)+_0x24b248);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x28ebe5);}console[_0x516630(0x1c1)](_0x516630(0x1a3)),console[_0x516630(0x1c1)]('Parsed\x20Result:',JSON['stringify'](_0x954ff9,null,0x2)),loggerService_1[_0x516630(0x190)][_0x516630(0x169)](_0x516630(0x19a),'/invoices/new',_0x5535cd[_0x516630(0x153)],_0x954ff9,_0x3b524e);if(_0x954ff9['status']!=='success'){const _0x4cefb7=_0x954ff9[_0x516630(0x174)]||_0x954ff9[_0x516630(0x196)]||_0x516630(0x159);console[_0x516630(0x196)](_0x516630(0x199)),console[_0x516630(0x196)](_0x516630(0x1b6),_0x4cefb7),loggerService_1[_0x516630(0x190)][_0x516630(0x17e)](_0x516630(0x19a),_0x516630(0x1a2),'Business\x20Error:\x20'+_0x4cefb7);throw new Error('Plisio\x20API\x20error:\x20'+_0x4cefb7);}if(!_0x954ff9[_0x516630(0x16e)]?.[_0x516630(0x198)]||!_0x954ff9[_0x516630(0x16e)]?.['invoice_url']){console['error'](_0x516630(0x197)),console[_0x516630(0x196)](_0x516630(0x1c2)),console[_0x516630(0x196)](_0x516630(0x161),_0x954ff9[_0x516630(0x16e)]),loggerService_1['loggerService'][_0x516630(0x17e)](_0x516630(0x19a),_0x516630(0x1a2),_0x516630(0x155));throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x516630(0x1c1)](_0x516630(0x1af)),console[_0x516630(0x1c1)](_0x516630(0x1b4),_0x954ff9[_0x516630(0x16e)][_0x516630(0x198)]),console[_0x516630(0x1c1)](_0x516630(0x193),_0x954ff9[_0x516630(0x16e)][_0x516630(0x1ad)]),console[_0x516630(0x1c1)](_0x516630(0x16b),_0x4129d0,_0x521924),_0xd9cd90&&(console[_0x516630(0x1c1)](_0x516630(0x195),_0xd9cd90,_0x516630(0x19d)),console['log'](_0x516630(0x1a4),_0x521924,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x954ff9[_0x516630(0x16e)][_0x516630(0x198)],'payment_url':_0x954ff9[_0x516630(0x16e)][_0x516630(0x1ad)],'invoice_total_sum':_0x954ff9[_0x516630(0x16e)]['invoice_total_sum'],'qr_code':_0x954ff9[_0x516630(0x16e)][_0x516630(0x18c)],'qr_url':_0x954ff9[_0x516630(0x16e)][_0x516630(0x17d)]};}catch(_0x1ef804){console[_0x516630(0x196)](_0x516630(0x16d)),console[_0x516630(0x196)](_0x516630(0x185),_0x1ef804),loggerService_1[_0x516630(0x190)]['logWhiteDomainError'](_0x516630(0x19a),_0x516630(0x1a2),_0x1ef804);if(_0x1ef804 instanceof Error){console[_0x516630(0x196)](_0x516630(0x1b3),_0x1ef804['message']),console['error'](_0x516630(0x162),_0x1ef804[_0x516630(0x1bd)]);throw new Error(_0x516630(0x183)+_0x1ef804['message']);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async['verifyPayment'](_0x775959){const _0x243508=a74_0x212fab,_0x4390eb=Date[_0x243508(0x1b9)]();try{if(!this[_0x243508(0x15b)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x26a9b7=new URLSearchParams({'api_key':this[_0x243508(0x15b)],'txn_id':_0x775959}),_0x33a6a0=_0x243508(0x1bc)+_0x775959+'?'+_0x26a9b7[_0x243508(0x14c)]();loggerService_1['loggerService'][_0x243508(0x170)](_0x243508(0x19a),'/operations/'+_0x775959,_0x243508(0x178),Object[_0x243508(0x160)](_0x26a9b7['entries']()));const _0x2780f2=await fetch(_0x33a6a0,{'method':_0x243508(0x178),'headers':{'Accept':_0x243508(0x150),'User-Agent':_0x243508(0x152)}}),_0x4d0b07=Date[_0x243508(0x1b9)]()-_0x4390eb;if(!_0x2780f2['ok']){const _0x497f0a=await _0x2780f2[_0x243508(0x15a)]();loggerService_1[_0x243508(0x190)][_0x243508(0x169)](_0x243508(0x19a),'/operations/'+_0x775959,_0x2780f2[_0x243508(0x153)],_0x497f0a,_0x4d0b07);throw new Error(_0x243508(0x15f)+_0x2780f2[_0x243508(0x153)]);}const _0x344011=await _0x2780f2[_0x243508(0x1a0)]();loggerService_1[_0x243508(0x190)]['logWhiteDomainResponse'](_0x243508(0x19a),_0x243508(0x168)+_0x775959,_0x2780f2[_0x243508(0x153)],_0x344011,_0x4d0b07);if(_0x344011[_0x243508(0x153)]!==_0x243508(0x173)){loggerService_1[_0x243508(0x190)][_0x243508(0x17e)]('plisio_direct',_0x243508(0x168)+_0x775959,_0x243508(0x1b5)+(_0x344011[_0x243508(0x174)]||_0x344011[_0x243508(0x196)]||_0x243508(0x192)));throw new Error(_0x243508(0x1b5)+(_0x344011['message']||_0x344011['error']||_0x243508(0x192)));}let _0x2901ae='PENDING';return{'status':_0x2901ae};}catch(_0x24ae27){console['error'](_0x243508(0x16a),_0x24ae27),loggerService_1[_0x243508(0x190)]['logWhiteDomainError']('plisio_direct',_0x243508(0x168)+_0x775959,_0x24ae27);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x24ae27 instanceof Error?_0x24ae27[_0x243508(0x174)]:_0x243508(0x192)));}}async[a74_0x212fab(0x156)](_0x59ec70){const _0xbff28a=a74_0x212fab;console[_0xbff28a(0x1c1)](_0xbff28a(0x1ab),_0x59ec70);let _0x552721='PENDING';switch(_0x59ec70['status']?.[_0xbff28a(0x15e)]()){case _0xbff28a(0x167):case _0xbff28a(0x1ae):_0x552721=_0xbff28a(0x17a);break;case _0xbff28a(0x1a9):_0x552721=_0xbff28a(0x19e);break;case _0xbff28a(0x196):case _0xbff28a(0x177):_0x552721=_0xbff28a(0x18a);break;case _0xbff28a(0x18b):_0x552721=_0xbff28a(0x188);break;case _0xbff28a(0x180):_0x552721='PROCESSING';break;default:_0x552721=_0xbff28a(0x188);break;}let _0x242bb3;if(_0x59ec70[_0xbff28a(0x1a7)])try{console[_0xbff28a(0x1c1)](_0xbff28a(0x18d),_0x59ec70[_0xbff28a(0x1a7)]);let _0x54fefb;if(typeof _0x59ec70[_0xbff28a(0x1a7)]===_0xbff28a(0x15d))_0x54fefb=JSON[_0xbff28a(0x151)](_0x59ec70[_0xbff28a(0x1a7)]);else Array[_0xbff28a(0x172)](_0x59ec70[_0xbff28a(0x1a7)])?_0x54fefb=_0x59ec70[_0xbff28a(0x1a7)]:_0x54fefb=[];_0x242bb3=_0x54fefb['map'](_0x3c5b49=>{const _0x165c01=_0xbff28a,_0x530169=_0x3c5b49[_0x165c01(0x1be)](/\\/g,'');return console[_0x165c01(0x1c1)](_0x165c01(0x1bf)+_0x3c5b49+_0x165c01(0x1a6)+_0x530169),_0x530169;}),console[_0xbff28a(0x1c1)]('âœ…\x20Processed\x20tx_urls:',_0x242bb3),_0x242bb3[_0xbff28a(0x16f)]((_0x2b57f2,_0x2d768c)=>{const _0x3b828e=_0xbff28a;try{new URL(_0x2b57f2),console[_0x3b828e(0x1c1)](_0x3b828e(0x18e)+(_0x2d768c+0x1)+_0x3b828e(0x176)+_0x2b57f2);}catch(_0x313ed0){console[_0x3b828e(0x196)]('âŒ\x20URL\x20'+(_0x2d768c+0x1)+_0x3b828e(0x17b)+_0x2b57f2,_0x313ed0);}});}catch(_0x36c669){console[_0xbff28a(0x196)](_0xbff28a(0x1bb),_0x36c669),console[_0xbff28a(0x196)](_0xbff28a(0x158),_0x59ec70['tx_urls']),_0x242bb3=undefined;}return{'paymentId':_0x59ec70['order_number']||'','status':_0x552721,'amount':_0x59ec70[_0xbff28a(0x164)],'currency':_0x59ec70['currency'],'txUrls':_0x242bb3};}}function a74_0x5e18(_0xa7a693,_0x1d7835){_0xa7a693=_0xa7a693-0x14b;const _0x2f10d6=a74_0x2f10();let _0x5e182d=_0x2f10d6[_0xa7a693];return _0x5e182d;}function a74_0x2f10(){const _0x376e6d=['1404732qkAnyP','458cFYiOs','Error\x20message:','Transaction\x20ID:','Plisio\x20API\x20error:\x20','Error\x20Message:','Status:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','now','https://api.trapay.uk/api/webhooks/gateway/plisio','âŒ\x20Failed\x20to\x20parse\x20tx_urls:','https://api.plisio.net/api/v1/operations/','stack','replace','ðŸ”—\x20Formatted\x20URL:\x20','HTTP\x20Status:','log','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','6nDuQqf','Failed\x20to\x20parse\x20JSON\x20response:','append','toString','apiUrl','source_currency','createPayment','application/json','parse','Payment\x20System/1.0','status','ðŸ’°\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','processWebhook','Parameters:','Raw\x20tx_urls\x20data:','Unknown\x20error\x20from\x20Plisio\x20API','text','apiKey','URL:','string','toLowerCase','HTTP\x20error!\x20status:\x20','fromEntries','Response\x20data:','Error\x20stack:','37371lklFmx','amount','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','2IWnRwY','completed','/operations/','logWhiteDomainResponse','Plisio\x20payment\x20verification\x20error:','Amount:','HIDDEN','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','data','forEach','logWhiteDomainRequest',',\x20body:\x20','isArray','success','message','91nHqTjs','\x20is\x20valid:\x20','cancelled','GET','26090vUqWKR','PAID','\x20is\x20invalid:\x20','source_amount','qr_url','logWhiteDomainError','statusText','pending','../loggerService','Full\x20URL\x20(without\x20API\x20key):','Failed\x20to\x20create\x20Plisio\x20payment:\x20','940736FpfWhs','Error\x20details:','Raw\x20Response\x20Body:','1727wPOyLv','PENDING','HTTP\x20','FAILED','new','qr_code','ðŸ”—\x20Raw\x20tx_urls\x20from\x20Plisio:','âœ…\x20URL\x20','===\x20PLISIO\x20API\x20ERROR\x20===','loggerService','âš ï¸\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','Unknown\x20error','Invoice\x20URL:','928535JDeOtz','Source\x20Currency:','error','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','txn_id','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','plisio_direct','JSON\x20Parse\x20Error:\x20','2369700mmSYMk','(crypto\x20for\x20payment)','EXPIRED','Response\x20Body:','json','entries','/invoices/new','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Target\x20Currency:','8ldYglD','\x20->\x20','tx_urls','currency','expired','https://api.plisio.net/api/v1/invoices/new','Processing\x20Plisio\x20webhook:','14JHidZC','invoice_url','mismatch','===\x20PLISIO\x20SUCCESS\x20===','__esModule'];a74_0x2f10=function(){return _0x376e6d;};return a74_0x2f10();}exports['PlisioService']=PlisioService;