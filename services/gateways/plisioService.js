'use strict';const a44_0x19a700=a44_0x2128;(function(_0x5248f8,_0x233ee1){const _0x1ffcfd=a44_0x2128,_0x493000=_0x5248f8();while(!![]){try{const _0x3c4721=-parseInt(_0x1ffcfd(0x164))/0x1+-parseInt(_0x1ffcfd(0x155))/0x2*(-parseInt(_0x1ffcfd(0x16e))/0x3)+-parseInt(_0x1ffcfd(0x103))/0x4+parseInt(_0x1ffcfd(0x173))/0x5+parseInt(_0x1ffcfd(0x144))/0x6+parseInt(_0x1ffcfd(0x14f))/0x7*(-parseInt(_0x1ffcfd(0x112))/0x8)+parseInt(_0x1ffcfd(0x152))/0x9;if(_0x3c4721===_0x233ee1)break;else _0x493000['push'](_0x493000['shift']());}catch(_0x2fff8a){_0x493000['push'](_0x493000['shift']());}}}(a44_0x5b58,0xba642));Object[a44_0x19a700(0x16f)](exports,a44_0x19a700(0x15f),{'value':!![]}),exports[a44_0x19a700(0x14c)]=void 0x0;const loggerService_1=require('../loggerService');function a44_0x5b58(){const _0x2b1555=['Error\x20message:','HTTP\x20Status:','Error\x20details:','8vGZTKJ','parse','/invoices/new','txn_id','https://api.plisio.net/api/v1/operations/','Error\x20Message:','string','isArray','Failed\x20to\x20parse\x20JSON\x20response:','logWhiteDomainResponse','(crypto\x20for\x20payment)','PROCESSING','Parameters:','Raw\x20Response\x20Body:','‚úÖ\x20Processed\x20tx_urls:','success','message','https://api.trapay.uk/api/webhooks/gateway/plisio','Error\x20stack:','Response\x20Time:','TesSoft\x20Payment\x20System/1.0','forEach','Response\x20Body:','Processing\x20Plisio\x20webhook:','warn','env','Plisio\x20payment\x20verification\x20error:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','PAID','text','/operations/','json','Source\x20Currency:','Plisio\x20API\x20error:\x20','GET','Target\x20Currency:','entries','source_amount','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','application/json','order_number','processWebhook','Unknown\x20error','Plisio\x20API\x20key\x20is\x20not\x20configured','tx_urls','\x20->\x20','name','status','mismatch','expired','8716980oLHmoM','\x20is\x20invalid:\x20','JSON\x20Parse\x20Error:\x20','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','logWhiteDomainRequest','log','source_currency','toLowerCase','PlisioService','apiUrl','===\x20PLISIO\x20SUCCESS\x20===','120281PvOyLL','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','\x20is\x20valid:\x20','526005zRkYGt','Response\x20data:','stack','2zELkVz','invoice_url','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','FAILED','loggerService','new','fromEntries','‚ùå\x20URL\x20','cancelled','__esModule','currency','PLISIO_API_KEY','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','1208899aAooiu','apiKey','Amount:','replace','now','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','error','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','createPayment','https://api.plisio.net/api/v1/invoices/new','1001919FITjet','defineProperty','Parsed\x20Result:','amount','üîó\x20Formatted\x20URL:\x20','3393330kYrBYF','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','‚úÖ\x20URL\x20','statusText','stringify','2137496QFAvET','logWhiteDomainError','PENDING','append','Unknown\x20error\x20from\x20Plisio\x20API','data','invoice_total_sum','Invoice\x20URL:','toString','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','plisio_direct','Full\x20URL\x20(without\x20API\x20key):'];a44_0x5b58=function(){return _0x2b1555;};return a44_0x5b58();}function a44_0x2128(_0x174105,_0x1f707e){const _0x5b5853=a44_0x5b58();return a44_0x2128=function(_0x21281e,_0x4ae4bc){_0x21281e=_0x21281e-0x101;let _0x2707cb=_0x5b5853[_0x21281e];return _0x2707cb;},a44_0x2128(_0x174105,_0x1f707e);}class PlisioService{constructor(){const _0xd9e91b=a44_0x19a700;this[_0xd9e91b(0x14d)]=_0xd9e91b(0x16d),this['apiKey']=process[_0xd9e91b(0x12b)][_0xd9e91b(0x161)]||'',!this['apiKey']?console[_0xd9e91b(0x12a)]('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console['log'](_0xd9e91b(0x150));}async[a44_0x19a700(0x16c)](_0x23ae38){const _0x4ab855=a44_0x19a700,{orderId:_0x2ac60c,amount:_0x4d47bb,currency:_0x449542,productName:_0x13d626,description:_0x200332,successUrl:_0x2cf6c9,failUrl:_0x2e884c,customerEmail:_0x2db4c6,customerName:_0x50ac79,isSourceCurrency:_0x24b1ae,sourceCurrency:_0x18ae9c}=_0x23ae38;if(!this['apiKey'])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x3e5427=new URLSearchParams({'api_key':this[_0x4ab855(0x165)],'order_number':_0x2ac60c,'order_name':_0x13d626,'description':_0x200332,'success_url':_0x2cf6c9,'fail_url':_0x2e884c,'callback_url':_0x4ab855(0x123)});_0x18ae9c?(_0x3e5427[_0x4ab855(0x106)](_0x4ab855(0x160),_0x18ae9c),_0x3e5427['append'](_0x4ab855(0x14a),_0x449542),_0x3e5427['append'](_0x4ab855(0x137),_0x4d47bb[_0x4ab855(0x10b)]())):(_0x3e5427[_0x4ab855(0x106)](_0x4ab855(0x160),_0x449542),_0x3e5427[_0x4ab855(0x106)]('amount',_0x4d47bb[_0x4ab855(0x10b)]()));_0x2db4c6&&_0x3e5427[_0x4ab855(0x106)]('email',_0x2db4c6);_0x50ac79&&_0x3e5427[_0x4ab855(0x106)](_0x4ab855(0x140),_0x50ac79);const _0x23bedd=this[_0x4ab855(0x14d)]+'?'+_0x3e5427['toString'](),_0x29f10a=Date[_0x4ab855(0x168)]();try{console[_0x4ab855(0x149)](_0x4ab855(0x174)),console[_0x4ab855(0x149)]('URL:',this[_0x4ab855(0x14d)]),console[_0x4ab855(0x149)](_0x4ab855(0x11e),Object['fromEntries'](_0x3e5427[_0x4ab855(0x136)]())),console[_0x4ab855(0x149)](_0x4ab855(0x10e),_0x23bedd[_0x4ab855(0x167)](this[_0x4ab855(0x165)],'HIDDEN')),loggerService_1[_0x4ab855(0x15a)]['logWhiteDomainRequest'](_0x4ab855(0x10d),_0x4ab855(0x114),_0x4ab855(0x134),Object['fromEntries'](_0x3e5427[_0x4ab855(0x136)]()));const _0xde3726=await fetch(_0x23bedd,{'method':'GET','headers':{'Accept':_0x4ab855(0x139),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x1d6238=Date[_0x4ab855(0x168)]()-_0x29f10a;console['log'](_0x4ab855(0x163)),console[_0x4ab855(0x149)]('Status:',_0xde3726[_0x4ab855(0x141)]),console[_0x4ab855(0x149)]('Status\x20Text:',_0xde3726[_0x4ab855(0x101)]),console[_0x4ab855(0x149)](_0x4ab855(0x125),_0x1d6238+'ms');const _0x1f133b=await _0xde3726['text']();console['log'](_0x4ab855(0x11f),_0x1f133b);if(!_0xde3726['ok']){console[_0x4ab855(0x16a)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x4ab855(0x16a)](_0x4ab855(0x110),_0xde3726[_0x4ab855(0x141)]),console[_0x4ab855(0x16a)](_0x4ab855(0x128),_0x1f133b),loggerService_1[_0x4ab855(0x15a)][_0x4ab855(0x11b)]('plisio_direct',_0x4ab855(0x114),_0xde3726[_0x4ab855(0x141)],_0x1f133b,_0x1d6238),loggerService_1[_0x4ab855(0x15a)]['logWhiteDomainError'](_0x4ab855(0x10d),_0x4ab855(0x114),'HTTP\x20'+_0xde3726[_0x4ab855(0x141)]+':\x20'+_0x1f133b);throw new Error('HTTP\x20error!\x20status:\x20'+_0xde3726[_0x4ab855(0x141)]+',\x20body:\x20'+_0x1f133b);}let _0x4e3019;try{_0x4e3019=JSON['parse'](_0x1f133b);}catch(_0x26da64){console[_0x4ab855(0x16a)](_0x4ab855(0x11a),_0x26da64),loggerService_1[_0x4ab855(0x15a)][_0x4ab855(0x104)](_0x4ab855(0x10d),_0x4ab855(0x114),_0x4ab855(0x146)+_0x26da64);throw new Error(_0x4ab855(0x12d)+_0x1f133b);}console['log'](_0x4ab855(0x16b)),console[_0x4ab855(0x149)](_0x4ab855(0x170),JSON[_0x4ab855(0x102)](_0x4e3019,null,0x2)),loggerService_1[_0x4ab855(0x15a)][_0x4ab855(0x11b)](_0x4ab855(0x10d),_0x4ab855(0x114),_0xde3726[_0x4ab855(0x141)],_0x4e3019,_0x1d6238);if(_0x4e3019['status']!==_0x4ab855(0x121)){const _0x4f83d8=_0x4e3019[_0x4ab855(0x122)]||_0x4e3019[_0x4ab855(0x16a)]||_0x4ab855(0x107);console[_0x4ab855(0x16a)](_0x4ab855(0x147)),console[_0x4ab855(0x16a)](_0x4ab855(0x117),_0x4f83d8),loggerService_1[_0x4ab855(0x15a)][_0x4ab855(0x104)](_0x4ab855(0x10d),_0x4ab855(0x114),'Business\x20Error:\x20'+_0x4f83d8);throw new Error('Plisio\x20API\x20error:\x20'+_0x4f83d8);}if(!_0x4e3019[_0x4ab855(0x108)]?.[_0x4ab855(0x115)]||!_0x4e3019[_0x4ab855(0x108)]?.[_0x4ab855(0x156)]){console[_0x4ab855(0x16a)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4ab855(0x16a)](_0x4ab855(0x162)),console[_0x4ab855(0x16a)](_0x4ab855(0x153),_0x4e3019[_0x4ab855(0x108)]),loggerService_1[_0x4ab855(0x15a)][_0x4ab855(0x104)](_0x4ab855(0x10d),_0x4ab855(0x114),_0x4ab855(0x169));throw new Error(_0x4ab855(0x158));}return console[_0x4ab855(0x149)](_0x4ab855(0x14e)),console['log']('Transaction\x20ID:',_0x4e3019[_0x4ab855(0x108)][_0x4ab855(0x115)]),console['log'](_0x4ab855(0x10a),_0x4e3019[_0x4ab855(0x108)][_0x4ab855(0x156)]),console[_0x4ab855(0x149)](_0x4ab855(0x166),_0x4d47bb,_0x449542),_0x18ae9c&&(console[_0x4ab855(0x149)](_0x4ab855(0x132),_0x18ae9c,_0x4ab855(0x11c)),console['log'](_0x4ab855(0x135),_0x449542,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x4e3019[_0x4ab855(0x108)][_0x4ab855(0x115)],'payment_url':_0x4e3019[_0x4ab855(0x108)]['invoice_url'],'invoice_total_sum':_0x4e3019[_0x4ab855(0x108)][_0x4ab855(0x109)],'qr_code':_0x4e3019[_0x4ab855(0x108)]['qr_code'],'qr_url':_0x4e3019[_0x4ab855(0x108)]['qr_url']};}catch(_0x2422ab){console[_0x4ab855(0x16a)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x4ab855(0x16a)](_0x4ab855(0x111),_0x2422ab),loggerService_1[_0x4ab855(0x15a)][_0x4ab855(0x104)](_0x4ab855(0x10d),_0x4ab855(0x114),_0x2422ab);if(_0x2422ab instanceof Error){console[_0x4ab855(0x16a)](_0x4ab855(0x10f),_0x2422ab[_0x4ab855(0x122)]),console['error'](_0x4ab855(0x124),_0x2422ab[_0x4ab855(0x154)]);throw new Error(_0x4ab855(0x157)+_0x2422ab[_0x4ab855(0x122)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async['verifyPayment'](_0x14a52f){const _0xca107f=a44_0x19a700,_0x4bb7a1=Date['now']();try{if(!this[_0xca107f(0x165)])throw new Error(_0xca107f(0x13d));const _0x5312d4=new URLSearchParams({'api_key':this[_0xca107f(0x165)],'txn_id':_0x14a52f}),_0x298ebe=_0xca107f(0x116)+_0x14a52f+'?'+_0x5312d4[_0xca107f(0x10b)]();loggerService_1['loggerService'][_0xca107f(0x148)](_0xca107f(0x10d),'/operations/'+_0x14a52f,_0xca107f(0x134),Object[_0xca107f(0x15c)](_0x5312d4[_0xca107f(0x136)]()));const _0x22cd6c=await fetch(_0x298ebe,{'method':_0xca107f(0x134),'headers':{'Accept':'application/json','User-Agent':_0xca107f(0x126)}}),_0xad39fb=Date[_0xca107f(0x168)]()-_0x4bb7a1;if(!_0x22cd6c['ok']){const _0x448a35=await _0x22cd6c[_0xca107f(0x12f)]();loggerService_1['loggerService'][_0xca107f(0x11b)](_0xca107f(0x10d),_0xca107f(0x130)+_0x14a52f,_0x22cd6c[_0xca107f(0x141)],_0x448a35,_0xad39fb);throw new Error('HTTP\x20error!\x20status:\x20'+_0x22cd6c[_0xca107f(0x141)]);}const _0x46367e=await _0x22cd6c[_0xca107f(0x131)]();loggerService_1[_0xca107f(0x15a)]['logWhiteDomainResponse'](_0xca107f(0x10d),_0xca107f(0x130)+_0x14a52f,_0x22cd6c[_0xca107f(0x141)],_0x46367e,_0xad39fb);if(_0x46367e[_0xca107f(0x141)]!=='success'){loggerService_1[_0xca107f(0x15a)][_0xca107f(0x104)](_0xca107f(0x10d),_0xca107f(0x130)+_0x14a52f,_0xca107f(0x133)+(_0x46367e[_0xca107f(0x122)]||_0x46367e[_0xca107f(0x16a)]||_0xca107f(0x13c)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x46367e[_0xca107f(0x122)]||_0x46367e[_0xca107f(0x16a)]||_0xca107f(0x13c)));}let _0x5c6140=_0xca107f(0x105);return{'status':_0x5c6140};}catch(_0x58982b){console['error'](_0xca107f(0x12c),_0x58982b),loggerService_1[_0xca107f(0x15a)][_0xca107f(0x104)]('plisio_direct',_0xca107f(0x130)+_0x14a52f,_0x58982b);throw new Error(_0xca107f(0x10c)+(_0x58982b instanceof Error?_0x58982b[_0xca107f(0x122)]:_0xca107f(0x13c)));}}async[a44_0x19a700(0x13b)](_0x85df9a){const _0x15da9d=a44_0x19a700;console[_0x15da9d(0x149)](_0x15da9d(0x129),_0x85df9a);let _0x497ad3=_0x15da9d(0x105);switch(_0x85df9a['status']?.[_0x15da9d(0x14b)]()){case'completed':case _0x15da9d(0x142):_0x497ad3=_0x15da9d(0x12e);break;case _0x15da9d(0x143):_0x497ad3='EXPIRED';break;case _0x15da9d(0x16a):case _0x15da9d(0x15e):_0x497ad3=_0x15da9d(0x159);break;case _0x15da9d(0x15b):_0x497ad3='PENDING';break;case'pending':_0x497ad3=_0x15da9d(0x11d);break;default:_0x497ad3=_0x15da9d(0x105);break;}let _0x2921c4;if(_0x85df9a[_0x15da9d(0x13e)])try{console[_0x15da9d(0x149)](_0x15da9d(0x138),_0x85df9a[_0x15da9d(0x13e)]);let _0x7ff43a;if(typeof _0x85df9a['tx_urls']===_0x15da9d(0x118))_0x7ff43a=JSON[_0x15da9d(0x113)](_0x85df9a[_0x15da9d(0x13e)]);else Array[_0x15da9d(0x119)](_0x85df9a[_0x15da9d(0x13e)])?_0x7ff43a=_0x85df9a[_0x15da9d(0x13e)]:_0x7ff43a=[];_0x2921c4=_0x7ff43a['map'](_0xdc74a5=>{const _0x21aa51=_0x15da9d,_0x3091e0=_0xdc74a5[_0x21aa51(0x167)](/\\/g,'');return console[_0x21aa51(0x149)](_0x21aa51(0x172)+_0xdc74a5+_0x21aa51(0x13f)+_0x3091e0),_0x3091e0;}),console[_0x15da9d(0x149)](_0x15da9d(0x120),_0x2921c4),_0x2921c4[_0x15da9d(0x127)]((_0x56fbf4,_0x5166fc)=>{const _0x1b6e81=_0x15da9d;try{new URL(_0x56fbf4),console[_0x1b6e81(0x149)](_0x1b6e81(0x175)+(_0x5166fc+0x1)+_0x1b6e81(0x151)+_0x56fbf4);}catch(_0x1610c0){console[_0x1b6e81(0x16a)](_0x1b6e81(0x15d)+(_0x5166fc+0x1)+_0x1b6e81(0x145)+_0x56fbf4,_0x1610c0);}});}catch(_0x41a4b5){console[_0x15da9d(0x16a)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x41a4b5),console['error']('Raw\x20tx_urls\x20data:',_0x85df9a[_0x15da9d(0x13e)]),_0x2921c4=undefined;}return{'paymentId':_0x85df9a[_0x15da9d(0x13a)]||'','status':_0x497ad3,'amount':_0x85df9a[_0x15da9d(0x171)],'currency':_0x85df9a[_0x15da9d(0x160)],'txUrls':_0x2921c4};}}exports[a44_0x19a700(0x14c)]=PlisioService;