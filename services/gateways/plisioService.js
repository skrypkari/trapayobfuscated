'use strict';function a44_0x1ff0(){const _0x32f0a=['PlisioService','statusText','tx_urls','PENDING','map','new','mismatch','plisio_direct','PROCESSING','invoice_total_sum','source_amount','fromEntries','stack','stringify','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','status','‚úÖ\x20Processed\x20tx_urls:','HTTP\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','amount','Unknown\x20error\x20from\x20Plisio\x20API','352HngHgg','logWhiteDomainResponse','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','defineProperty','apiKey','processWebhook','Parameters:','log','Source\x20Currency:','Transaction\x20ID:','670eyxIUU','data','2809596eSHMzv','currency','Unknown\x20error','Response\x20data:','source_currency','https://api.trapay.uk/api/webhooks/gateway/plisio','expired','Invoice\x20URL:','logWhiteDomainError','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','===\x20PLISIO\x20API\x20ERROR\x20===','HTTP\x20Status:',',\x20body:\x20','Response\x20Body:','\x20is\x20invalid:\x20','completed','/operations/','===\x20PLISIO\x20SUCCESS\x20===','verifyPayment','üîó\x20Formatted\x20URL:\x20','qr_url','2308186wmlHxb','now','Failed\x20to\x20create\x20Plisio\x20payment:\x20','append','944456KbgcuJ','Processing\x20Plisio\x20webhook:','success','Plisio\x20payment\x20verification\x20error:','19502WWpGaJ','HTTP\x20error!\x20status:\x20','Error\x20message:','9JYJZAF','pending','env','HIDDEN','logWhiteDomainRequest','isArray','entries','Raw\x20tx_urls\x20data:','https://api.plisio.net/api/v1/invoices/new','toLowerCase','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','JSON\x20Parse\x20Error:\x20','URL:','apiUrl','PLISIO_API_KEY','Status:','invoice_url','warn','cancelled','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','\x20->\x20','text','__esModule','Amount:','loggerService','1389750LZpHWA','FAILED','TesSoft\x20Payment\x20System/1.0','Failed\x20to\x20parse\x20JSON\x20response:','parse','replace','Error\x20stack:','createPayment','Plisio\x20API\x20error:\x20','../loggerService','169227vQArjz','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','GET','(fiat\x20for\x20merchant)','email','application/json','88664LlwBAf','Error\x20details:','txn_id','message','/invoices/new','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','toString','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','error','Response\x20Time:','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'];a44_0x1ff0=function(){return _0x32f0a;};return a44_0x1ff0();}const a44_0x26d150=a44_0x42d9;(function(_0xc38cab,_0x52771d){const _0x1905ab=a44_0x42d9,_0x217620=_0xc38cab();while(!![]){try{const _0x383081=parseInt(_0x1905ab(0x1b4))/0x1+parseInt(_0x1905ab(0x1b0))/0x2+parseInt(_0x1905ab(0x1bb))/0x3*(parseInt(_0x1905ab(0x16d))/0x4)+parseInt(_0x1905ab(0x15d))/0x5+-parseInt(_0x1905ab(0x19b))/0x6+parseInt(_0x1905ab(0x1b8))/0x7*(-parseInt(_0x1905ab(0x18f))/0x8)+-parseInt(_0x1905ab(0x167))/0x9*(parseInt(_0x1905ab(0x199))/0xa);if(_0x383081===_0x52771d)break;else _0x217620['push'](_0x217620['shift']());}catch(_0x39a30c){_0x217620['push'](_0x217620['shift']());}}}(a44_0x1ff0,0x909da));function a44_0x42d9(_0x5d6eb3,_0x209bdc){const _0x1ff01b=a44_0x1ff0();return a44_0x42d9=function(_0x42d9e2,_0x24895a){_0x42d9e2=_0x42d9e2-0x15a;let _0x13c91d=_0x1ff01b[_0x42d9e2];return _0x13c91d;},a44_0x42d9(_0x5d6eb3,_0x209bdc);}Object[a44_0x26d150(0x192)](exports,a44_0x26d150(0x15a),{'value':!![]}),exports[a44_0x26d150(0x17a)]=void 0x0;const loggerService_1=require(a44_0x26d150(0x166));class PlisioService{constructor(){const _0x5637b9=a44_0x26d150;this[_0x5637b9(0x1c8)]=_0x5637b9(0x1c3),this[_0x5637b9(0x193)]=process[_0x5637b9(0x1bd)][_0x5637b9(0x1c9)]||'',!this['apiKey']?console[_0x5637b9(0x1cc)](_0x5637b9(0x168)):console[_0x5637b9(0x196)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a44_0x26d150(0x164)](_0x2dabb7){const _0x1efc9b=a44_0x26d150,{orderId:_0x338f3b,amount:_0x5c6e5e,currency:_0x6205cf,productName:_0x3d5960,description:_0x44854f,successUrl:_0x4986c8,failUrl:_0x20f1be,customerEmail:_0x134d96,customerName:_0x2a9c90,isSourceCurrency:_0x2c6a2a,sourceCurrency:_0x1fe54b}=_0x2dabb7;if(!this[_0x1efc9b(0x193)])throw new Error(_0x1efc9b(0x18c));const _0xf583ad=new URLSearchParams({'api_key':this[_0x1efc9b(0x193)],'order_number':_0x338f3b,'order_name':_0x3d5960,'description':_0x44854f,'success_url':_0x4986c8,'fail_url':_0x20f1be,'callback_url':_0x1efc9b(0x1a0)});_0x1fe54b?(_0xf583ad['append'](_0x1efc9b(0x19c),_0x1fe54b),_0xf583ad[_0x1efc9b(0x1b3)](_0x1efc9b(0x19f),_0x6205cf),_0xf583ad[_0x1efc9b(0x1b3)](_0x1efc9b(0x184),_0x5c6e5e[_0x1efc9b(0x174)]())):(_0xf583ad[_0x1efc9b(0x1b3)]('currency',_0x6205cf),_0xf583ad[_0x1efc9b(0x1b3)](_0x1efc9b(0x18d),_0x5c6e5e[_0x1efc9b(0x174)]()));_0x134d96&&_0xf583ad[_0x1efc9b(0x1b3)](_0x1efc9b(0x16b),_0x134d96);_0x2a9c90&&_0xf583ad[_0x1efc9b(0x1b3)]('name',_0x2a9c90);const _0x3900c7=this[_0x1efc9b(0x1c8)]+'?'+_0xf583ad[_0x1efc9b(0x174)](),_0x4dc170=Date[_0x1efc9b(0x1b1)]();try{console['log']('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console['log'](_0x1efc9b(0x1c7),this[_0x1efc9b(0x1c8)]),console[_0x1efc9b(0x196)](_0x1efc9b(0x195),Object[_0x1efc9b(0x185)](_0xf583ad[_0x1efc9b(0x1c1)]())),console['log']('Full\x20URL\x20(without\x20API\x20key):',_0x3900c7[_0x1efc9b(0x162)](this[_0x1efc9b(0x193)],_0x1efc9b(0x1be))),loggerService_1[_0x1efc9b(0x15c)][_0x1efc9b(0x1bf)](_0x1efc9b(0x181),_0x1efc9b(0x171),_0x1efc9b(0x169),Object[_0x1efc9b(0x185)](_0xf583ad[_0x1efc9b(0x1c1)]()));const _0x5cc325=await fetch(_0x3900c7,{'method':_0x1efc9b(0x169),'headers':{'Accept':_0x1efc9b(0x16c),'User-Agent':_0x1efc9b(0x15f)}}),_0x2d84d4=Date[_0x1efc9b(0x1b1)]()-_0x4dc170;console['log'](_0x1efc9b(0x1c5)),console[_0x1efc9b(0x196)](_0x1efc9b(0x1ca),_0x5cc325[_0x1efc9b(0x189)]),console[_0x1efc9b(0x196)]('Status\x20Text:',_0x5cc325[_0x1efc9b(0x17b)]),console[_0x1efc9b(0x196)](_0x1efc9b(0x178),_0x2d84d4+'ms');const _0x49cab8=await _0x5cc325[_0x1efc9b(0x1d0)]();console[_0x1efc9b(0x196)]('Raw\x20Response\x20Body:',_0x49cab8);if(!_0x5cc325['ok']){console[_0x1efc9b(0x177)](_0x1efc9b(0x1a5)),console['error'](_0x1efc9b(0x1a6),_0x5cc325[_0x1efc9b(0x189)]),console[_0x1efc9b(0x177)](_0x1efc9b(0x1a8),_0x49cab8),loggerService_1['loggerService'][_0x1efc9b(0x190)](_0x1efc9b(0x181),_0x1efc9b(0x171),_0x5cc325['status'],_0x49cab8,_0x2d84d4),loggerService_1[_0x1efc9b(0x15c)]['logWhiteDomainError'](_0x1efc9b(0x181),_0x1efc9b(0x171),_0x1efc9b(0x18b)+_0x5cc325[_0x1efc9b(0x189)]+':\x20'+_0x49cab8);throw new Error(_0x1efc9b(0x1b9)+_0x5cc325[_0x1efc9b(0x189)]+_0x1efc9b(0x1a7)+_0x49cab8);}let _0x2cd22f;try{_0x2cd22f=JSON[_0x1efc9b(0x161)](_0x49cab8);}catch(_0x42671e){console[_0x1efc9b(0x177)](_0x1efc9b(0x160),_0x42671e),loggerService_1['loggerService'][_0x1efc9b(0x1a3)]('plisio_direct',_0x1efc9b(0x171),_0x1efc9b(0x1c6)+_0x42671e);throw new Error(_0x1efc9b(0x179)+_0x49cab8);}console['log'](_0x1efc9b(0x191)),console[_0x1efc9b(0x196)]('Parsed\x20Result:',JSON[_0x1efc9b(0x187)](_0x2cd22f,null,0x2)),loggerService_1[_0x1efc9b(0x15c)]['logWhiteDomainResponse'](_0x1efc9b(0x181),'/invoices/new',_0x5cc325[_0x1efc9b(0x189)],_0x2cd22f,_0x2d84d4);if(_0x2cd22f[_0x1efc9b(0x189)]!==_0x1efc9b(0x1b6)){const _0x46c183=_0x2cd22f[_0x1efc9b(0x170)]||_0x2cd22f[_0x1efc9b(0x177)]||_0x1efc9b(0x18e);console[_0x1efc9b(0x177)](_0x1efc9b(0x173)),console[_0x1efc9b(0x177)]('Error\x20Message:',_0x46c183),loggerService_1[_0x1efc9b(0x15c)]['logWhiteDomainError'](_0x1efc9b(0x181),_0x1efc9b(0x171),'Business\x20Error:\x20'+_0x46c183);throw new Error('Plisio\x20API\x20error:\x20'+_0x46c183);}if(!_0x2cd22f[_0x1efc9b(0x19a)]?.[_0x1efc9b(0x16f)]||!_0x2cd22f[_0x1efc9b(0x19a)]?.[_0x1efc9b(0x1cb)]){console[_0x1efc9b(0x177)](_0x1efc9b(0x172)),console['error'](_0x1efc9b(0x1a4)),console['error'](_0x1efc9b(0x19e),_0x2cd22f[_0x1efc9b(0x19a)]),loggerService_1[_0x1efc9b(0x15c)][_0x1efc9b(0x1a3)](_0x1efc9b(0x181),'/invoices/new','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x1efc9b(0x175));}return console[_0x1efc9b(0x196)](_0x1efc9b(0x1ac)),console['log'](_0x1efc9b(0x198),_0x2cd22f[_0x1efc9b(0x19a)]['txn_id']),console['log'](_0x1efc9b(0x1a2),_0x2cd22f[_0x1efc9b(0x19a)][_0x1efc9b(0x1cb)]),console[_0x1efc9b(0x196)](_0x1efc9b(0x15b),_0x5c6e5e,_0x6205cf),_0x1fe54b&&(console[_0x1efc9b(0x196)](_0x1efc9b(0x197),_0x1fe54b,'(crypto\x20for\x20payment)'),console[_0x1efc9b(0x196)]('Target\x20Currency:',_0x6205cf,_0x1efc9b(0x16a))),{'gateway_payment_id':_0x2cd22f[_0x1efc9b(0x19a)]['txn_id'],'payment_url':_0x2cd22f[_0x1efc9b(0x19a)][_0x1efc9b(0x1cb)],'invoice_total_sum':_0x2cd22f[_0x1efc9b(0x19a)][_0x1efc9b(0x183)],'qr_code':_0x2cd22f[_0x1efc9b(0x19a)]['qr_code'],'qr_url':_0x2cd22f[_0x1efc9b(0x19a)][_0x1efc9b(0x1af)]};}catch(_0xc10935){console[_0x1efc9b(0x177)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x1efc9b(0x177)](_0x1efc9b(0x16e),_0xc10935),loggerService_1[_0x1efc9b(0x15c)][_0x1efc9b(0x1a3)](_0x1efc9b(0x181),_0x1efc9b(0x171),_0xc10935);if(_0xc10935 instanceof Error){console[_0x1efc9b(0x177)](_0x1efc9b(0x1ba),_0xc10935[_0x1efc9b(0x170)]),console[_0x1efc9b(0x177)](_0x1efc9b(0x163),_0xc10935[_0x1efc9b(0x186)]);throw new Error(_0x1efc9b(0x1b2)+_0xc10935[_0x1efc9b(0x170)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a44_0x26d150(0x1ad)](_0xcd67a5){const _0x376cc4=a44_0x26d150,_0x2b5d1a=Date['now']();try{if(!this[_0x376cc4(0x193)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0xfd5058=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0xcd67a5}),_0x28b030='https://api.plisio.net/api/v1/operations/'+_0xcd67a5+'?'+_0xfd5058[_0x376cc4(0x174)]();loggerService_1[_0x376cc4(0x15c)]['logWhiteDomainRequest']('plisio_direct',_0x376cc4(0x1ab)+_0xcd67a5,_0x376cc4(0x169),Object['fromEntries'](_0xfd5058[_0x376cc4(0x1c1)]()));const _0x27b3d5=await fetch(_0x28b030,{'method':_0x376cc4(0x169),'headers':{'Accept':_0x376cc4(0x16c),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x58e484=Date[_0x376cc4(0x1b1)]()-_0x2b5d1a;if(!_0x27b3d5['ok']){const _0x21bbf9=await _0x27b3d5[_0x376cc4(0x1d0)]();loggerService_1[_0x376cc4(0x15c)]['logWhiteDomainResponse']('plisio_direct','/operations/'+_0xcd67a5,_0x27b3d5['status'],_0x21bbf9,_0x58e484);throw new Error(_0x376cc4(0x1b9)+_0x27b3d5[_0x376cc4(0x189)]);}const _0x17cb47=await _0x27b3d5['json']();loggerService_1[_0x376cc4(0x15c)]['logWhiteDomainResponse']('plisio_direct',_0x376cc4(0x1ab)+_0xcd67a5,_0x27b3d5['status'],_0x17cb47,_0x58e484);if(_0x17cb47[_0x376cc4(0x189)]!==_0x376cc4(0x1b6)){loggerService_1[_0x376cc4(0x15c)][_0x376cc4(0x1a3)](_0x376cc4(0x181),_0x376cc4(0x1ab)+_0xcd67a5,'Plisio\x20API\x20error:\x20'+(_0x17cb47[_0x376cc4(0x170)]||_0x17cb47[_0x376cc4(0x177)]||_0x376cc4(0x19d)));throw new Error(_0x376cc4(0x165)+(_0x17cb47[_0x376cc4(0x170)]||_0x17cb47[_0x376cc4(0x177)]||_0x376cc4(0x19d)));}let _0x2caad2=_0x376cc4(0x17d);return{'status':_0x2caad2};}catch(_0x3559bd){console['error'](_0x376cc4(0x1b7),_0x3559bd),loggerService_1[_0x376cc4(0x15c)][_0x376cc4(0x1a3)](_0x376cc4(0x181),_0x376cc4(0x1ab)+_0xcd67a5,_0x3559bd);throw new Error(_0x376cc4(0x176)+(_0x3559bd instanceof Error?_0x3559bd['message']:'Unknown\x20error'));}}async[a44_0x26d150(0x194)](_0x1bd68e){const _0x73ee45=a44_0x26d150;console[_0x73ee45(0x196)](_0x73ee45(0x1b5),_0x1bd68e);let _0x2354de=_0x73ee45(0x17d);switch(_0x1bd68e[_0x73ee45(0x189)]?.[_0x73ee45(0x1c4)]()){case _0x73ee45(0x1aa):case _0x73ee45(0x180):_0x2354de='PAID';break;case _0x73ee45(0x1a1):_0x2354de='EXPIRED';break;case _0x73ee45(0x177):case _0x73ee45(0x1cd):_0x2354de=_0x73ee45(0x15e);break;case _0x73ee45(0x17f):_0x2354de=_0x73ee45(0x17d);break;case _0x73ee45(0x1bc):_0x2354de=_0x73ee45(0x182);break;default:_0x2354de=_0x73ee45(0x17d);break;}let _0x29b038;if(_0x1bd68e[_0x73ee45(0x17c)])try{console[_0x73ee45(0x196)](_0x73ee45(0x1ce),_0x1bd68e[_0x73ee45(0x17c)]);let _0x1088dd;if(typeof _0x1bd68e[_0x73ee45(0x17c)]==='string')_0x1088dd=JSON['parse'](_0x1bd68e['tx_urls']);else Array[_0x73ee45(0x1c0)](_0x1bd68e[_0x73ee45(0x17c)])?_0x1088dd=_0x1bd68e['tx_urls']:_0x1088dd=[];_0x29b038=_0x1088dd[_0x73ee45(0x17e)](_0x13e0ff=>{const _0x372411=_0x73ee45,_0x128a26=_0x13e0ff[_0x372411(0x162)](/\\/g,'');return console[_0x372411(0x196)](_0x372411(0x1ae)+_0x13e0ff+_0x372411(0x1cf)+_0x128a26),_0x128a26;}),console[_0x73ee45(0x196)](_0x73ee45(0x18a),_0x29b038),_0x29b038['forEach']((_0x35ddb4,_0x38654b)=>{const _0x776861=_0x73ee45;try{new URL(_0x35ddb4),console[_0x776861(0x196)]('‚úÖ\x20URL\x20'+(_0x38654b+0x1)+'\x20is\x20valid:\x20'+_0x35ddb4);}catch(_0x700b69){console['error']('‚ùå\x20URL\x20'+(_0x38654b+0x1)+_0x776861(0x1a9)+_0x35ddb4,_0x700b69);}});}catch(_0x4e44d4){console[_0x73ee45(0x177)](_0x73ee45(0x188),_0x4e44d4),console[_0x73ee45(0x177)](_0x73ee45(0x1c2),_0x1bd68e[_0x73ee45(0x17c)]),_0x29b038=undefined;}return{'paymentId':_0x1bd68e['order_number']||'','status':_0x2354de,'amount':_0x1bd68e['amount'],'currency':_0x1bd68e[_0x73ee45(0x19c)],'txUrls':_0x29b038};}}exports[a44_0x26d150(0x17a)]=PlisioService;