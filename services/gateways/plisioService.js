'use strict';const a45_0x2b68b5=a45_0xd7cd;(function(_0x34b393,_0x3e733b){const _0x289c46=a45_0xd7cd,_0x4e0abf=_0x34b393();while(!![]){try{const _0x5c03f0=-parseInt(_0x289c46(0xae))/0x1*(parseInt(_0x289c46(0xa7))/0x2)+parseInt(_0x289c46(0xcf))/0x3+-parseInt(_0x289c46(0xa9))/0x4+-parseInt(_0x289c46(0xfe))/0x5+parseInt(_0x289c46(0xc4))/0x6*(-parseInt(_0x289c46(0x10d))/0x7)+-parseInt(_0x289c46(0x117))/0x8*(parseInt(_0x289c46(0xf8))/0x9)+parseInt(_0x289c46(0xbf))/0xa;if(_0x5c03f0===_0x3e733b)break;else _0x4e0abf['push'](_0x4e0abf['shift']());}catch(_0x42a7fc){_0x4e0abf['push'](_0x4e0abf['shift']());}}}(a45_0x265d,0xc42db));function a45_0x265d(){const _0x161dd7=['order_number','logWhiteDomainResponse','isArray','üîó\x20Formatted\x20URL:\x20','Unknown\x20error','error','pending','‚úÖ\x20Processed\x20tx_urls:','6663391NbKOfl','stack','Raw\x20tx_urls\x20data:','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','PAID','Failed\x20to\x20parse\x20JSON\x20response:','source_currency','env','message','invoice_url','112UPYJsL','PLISIO_API_KEY','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','(crypto\x20for\x20payment)','completed','Plisio\x20API\x20error:\x20','toLowerCase','application/json','createPayment','2159334RzeeWr','Business\x20Error:\x20','3405924SrueES','HIDDEN','stringify','/operations/','toString','1qZykRC','txn_id','HTTP\x20error!\x20status:\x20','Parameters:','loggerService','source_amount','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','now','URL:','Parsed\x20Result:','cancelled','apiKey','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','name','Plisio\x20payment\x20verification\x20error:','Error\x20stack:','Response\x20data:','34631290hXRTYq','https://api.plisio.net/api/v1/invoices/new','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','replace','\x20is\x20valid:\x20','6QNrgaY','‚úÖ\x20URL\x20','text','log','../loggerService','entries','PlisioService','https://api.plisio.net/api/v1/operations/','plisio_direct','Error\x20message:','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','2237898mrWHxV','https://api.trapay.uk/api/webhooks/gateway/plisio','status','===\x20PLISIO\x20API\x20ERROR\x20===','append','tx_urls','Full\x20URL\x20(without\x20API\x20key):','(fiat\x20for\x20merchant)','PROCESSING','logWhiteDomainError','qr_url','PENDING','Status:','currency','Error\x20Message:','HTTP\x20Status:','mismatch','expired','processWebhook','/invoices/new','qr_code','Processing\x20Plisio\x20webhook:','forEach','Target\x20Currency:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','TesSoft\x20Payment\x20System/1.0','Source\x20Currency:','GET','logWhiteDomainRequest','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','success','new','map','warn','EXPIRED','data','parse','‚ùå\x20URL\x20','\x20is\x20invalid:\x20','Amount:','apiUrl','325692JyHoYu','string','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Plisio\x20API\x20key\x20is\x20not\x20configured',',\x20body:\x20','email','79275Dgaaav','Raw\x20Response\x20Body:','FAILED','HTTP\x20','Response\x20Body:','fromEntries','Failed\x20to\x20verify\x20Plisio\x20payment:\x20'];a45_0x265d=function(){return _0x161dd7;};return a45_0x265d();}function a45_0xd7cd(_0x2095b9,_0x1fe90f){const _0x265dc5=a45_0x265d();return a45_0xd7cd=function(_0xd7cd5a,_0x2b1815){_0xd7cd5a=_0xd7cd5a-0xa5;let _0x3be408=_0x265dc5[_0xd7cd5a];return _0x3be408;},a45_0xd7cd(_0x2095b9,_0x1fe90f);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a45_0x2b68b5(0xca)]=void 0x0;const loggerService_1=require(a45_0x2b68b5(0xc8));class PlisioService{constructor(){const _0x2d519d=a45_0x2b68b5;this['apiUrl']=_0x2d519d(0xc0),this['apiKey']=process[_0x2d519d(0x114)][_0x2d519d(0x118)]||'',!this['apiKey']?console[_0x2d519d(0xf0)]('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x2d519d(0xc7)]('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a45_0x2b68b5(0xa6)](_0x5bbd2b){const _0x33132e=a45_0x2b68b5,{orderId:_0x1cea1a,amount:_0x39a2e2,currency:_0x39c2b4,productName:_0x1d71b3,description:_0x41e092,successUrl:_0x327db9,failUrl:_0x305797,customerEmail:_0x3c5a8c,customerName:_0x1a788c,isSourceCurrency:_0x3ce967,sourceCurrency:_0x27d9d3}=_0x5bbd2b;if(!this[_0x33132e(0xb9)])throw new Error(_0x33132e(0xfb));const _0x4afb8e=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x1cea1a,'order_name':_0x1d71b3,'description':_0x41e092,'success_url':_0x327db9,'fail_url':_0x305797,'callback_url':_0x33132e(0xd0)});_0x27d9d3?(_0x4afb8e[_0x33132e(0xd3)](_0x33132e(0xdc),_0x27d9d3),_0x4afb8e[_0x33132e(0xd3)](_0x33132e(0x113),_0x39c2b4),_0x4afb8e[_0x33132e(0xd3)](_0x33132e(0xb3),_0x39a2e2[_0x33132e(0xad)]())):(_0x4afb8e['append'](_0x33132e(0xdc),_0x39c2b4),_0x4afb8e['append']('amount',_0x39a2e2[_0x33132e(0xad)]()));_0x3c5a8c&&_0x4afb8e[_0x33132e(0xd3)](_0x33132e(0xfd),_0x3c5a8c);_0x1a788c&&_0x4afb8e['append'](_0x33132e(0xbb),_0x1a788c);const _0x547f7b=this[_0x33132e(0xf7)]+'?'+_0x4afb8e[_0x33132e(0xad)](),_0x5d0ed5=Date[_0x33132e(0xb5)]();try{console['log'](_0x33132e(0xb4)),console[_0x33132e(0xc7)](_0x33132e(0xb6),this[_0x33132e(0xf7)]),console[_0x33132e(0xc7)](_0x33132e(0xb1),Object[_0x33132e(0x103)](_0x4afb8e['entries']())),console['log'](_0x33132e(0xd5),_0x547f7b[_0x33132e(0xc2)](this[_0x33132e(0xb9)],_0x33132e(0xaa))),loggerService_1['loggerService'][_0x33132e(0xeb)](_0x33132e(0xcc),_0x33132e(0xe2),_0x33132e(0xea),Object[_0x33132e(0x103)](_0x4afb8e[_0x33132e(0xc9)]()));const _0x1c5693=await fetch(_0x547f7b,{'method':_0x33132e(0xea),'headers':{'Accept':_0x33132e(0xa5),'User-Agent':_0x33132e(0xe8)}}),_0x5a8b09=Date['now']()-_0x5d0ed5;console[_0x33132e(0xc7)](_0x33132e(0xe7)),console[_0x33132e(0xc7)](_0x33132e(0xdb),_0x1c5693[_0x33132e(0xd1)]),console[_0x33132e(0xc7)]('Status\x20Text:',_0x1c5693['statusText']),console[_0x33132e(0xc7)]('Response\x20Time:',_0x5a8b09+'ms');const _0x3e977=await _0x1c5693['text']();console[_0x33132e(0xc7)](_0x33132e(0xff),_0x3e977);if(!_0x1c5693['ok']){console[_0x33132e(0x10a)](_0x33132e(0xd2)),console[_0x33132e(0x10a)](_0x33132e(0xde),_0x1c5693[_0x33132e(0xd1)]),console[_0x33132e(0x10a)](_0x33132e(0x102),_0x3e977),loggerService_1[_0x33132e(0xb2)]['logWhiteDomainResponse'](_0x33132e(0xcc),'/invoices/new',_0x1c5693[_0x33132e(0xd1)],_0x3e977,_0x5a8b09),loggerService_1[_0x33132e(0xb2)][_0x33132e(0xd8)](_0x33132e(0xcc),_0x33132e(0xe2),_0x33132e(0x101)+_0x1c5693[_0x33132e(0xd1)]+':\x20'+_0x3e977);throw new Error(_0x33132e(0xb0)+_0x1c5693[_0x33132e(0xd1)]+_0x33132e(0xfc)+_0x3e977);}let _0x35b473;try{_0x35b473=JSON[_0x33132e(0xf3)](_0x3e977);}catch(_0x3899a3){console[_0x33132e(0x10a)](_0x33132e(0x112),_0x3899a3),loggerService_1['loggerService'][_0x33132e(0xd8)](_0x33132e(0xcc),'/invoices/new','JSON\x20Parse\x20Error:\x20'+_0x3899a3);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x3e977);}console[_0x33132e(0xc7)](_0x33132e(0xec)),console[_0x33132e(0xc7)](_0x33132e(0xb7),JSON[_0x33132e(0xab)](_0x35b473,null,0x2)),loggerService_1[_0x33132e(0xb2)][_0x33132e(0x106)](_0x33132e(0xcc),'/invoices/new',_0x1c5693['status'],_0x35b473,_0x5a8b09);if(_0x35b473['status']!==_0x33132e(0xed)){const _0x110229=_0x35b473[_0x33132e(0x115)]||_0x35b473[_0x33132e(0x10a)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x33132e(0x10a)](_0x33132e(0x110)),console[_0x33132e(0x10a)](_0x33132e(0xdd),_0x110229),loggerService_1[_0x33132e(0xb2)][_0x33132e(0xd8)](_0x33132e(0xcc),'/invoices/new',_0x33132e(0xa8)+_0x110229);throw new Error(_0x33132e(0x11d)+_0x110229);}if(!_0x35b473[_0x33132e(0xf2)]?.[_0x33132e(0xaf)]||!_0x35b473[_0x33132e(0xf2)]?.[_0x33132e(0x116)]){console[_0x33132e(0x10a)](_0x33132e(0x119)),console[_0x33132e(0x10a)](_0x33132e(0x11a)),console['error'](_0x33132e(0xbe),_0x35b473['data']),loggerService_1[_0x33132e(0xb2)][_0x33132e(0xd8)](_0x33132e(0xcc),_0x33132e(0xe2),_0x33132e(0xba));throw new Error(_0x33132e(0xfa));}return console[_0x33132e(0xc7)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x33132e(0xc7)]('Transaction\x20ID:',_0x35b473['data']['txn_id']),console[_0x33132e(0xc7)]('Invoice\x20URL:',_0x35b473[_0x33132e(0xf2)][_0x33132e(0x116)]),console['log'](_0x33132e(0xf6),_0x39a2e2,_0x39c2b4),_0x27d9d3&&(console[_0x33132e(0xc7)](_0x33132e(0xe9),_0x27d9d3,_0x33132e(0x11b)),console[_0x33132e(0xc7)](_0x33132e(0xe6),_0x39c2b4,_0x33132e(0xd6))),{'gateway_payment_id':_0x35b473[_0x33132e(0xf2)]['txn_id'],'payment_url':_0x35b473['data'][_0x33132e(0x116)],'invoice_total_sum':_0x35b473[_0x33132e(0xf2)]['invoice_total_sum'],'qr_code':_0x35b473['data'][_0x33132e(0xe3)],'qr_url':_0x35b473[_0x33132e(0xf2)][_0x33132e(0xd9)]};}catch(_0x59d95c){console[_0x33132e(0x10a)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x33132e(0x10a)]('Error\x20details:',_0x59d95c),loggerService_1[_0x33132e(0xb2)][_0x33132e(0xd8)](_0x33132e(0xcc),_0x33132e(0xe2),_0x59d95c);if(_0x59d95c instanceof Error){console[_0x33132e(0x10a)](_0x33132e(0xcd),_0x59d95c['message']),console[_0x33132e(0x10a)](_0x33132e(0xbd),_0x59d95c[_0x33132e(0x10e)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x59d95c[_0x33132e(0x115)]);}throw new Error(_0x33132e(0xce));}}async['verifyPayment'](_0x17c577){const _0x43d9ad=a45_0x2b68b5,_0x575c9a=Date[_0x43d9ad(0xb5)]();try{if(!this['apiKey'])throw new Error(_0x43d9ad(0xfb));const _0x1ab29c=new URLSearchParams({'api_key':this[_0x43d9ad(0xb9)],'txn_id':_0x17c577}),_0x584483=_0x43d9ad(0xcb)+_0x17c577+'?'+_0x1ab29c[_0x43d9ad(0xad)]();loggerService_1[_0x43d9ad(0xb2)][_0x43d9ad(0xeb)](_0x43d9ad(0xcc),'/operations/'+_0x17c577,'GET',Object[_0x43d9ad(0x103)](_0x1ab29c['entries']()));const _0x45f5a8=await fetch(_0x584483,{'method':_0x43d9ad(0xea),'headers':{'Accept':_0x43d9ad(0xa5),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x33d589=Date[_0x43d9ad(0xb5)]()-_0x575c9a;if(!_0x45f5a8['ok']){const _0x28fd47=await _0x45f5a8[_0x43d9ad(0xc6)]();loggerService_1['loggerService'][_0x43d9ad(0x106)]('plisio_direct','/operations/'+_0x17c577,_0x45f5a8[_0x43d9ad(0xd1)],_0x28fd47,_0x33d589);throw new Error(_0x43d9ad(0xb0)+_0x45f5a8['status']);}const _0x13409a=await _0x45f5a8['json']();loggerService_1['loggerService'][_0x43d9ad(0x106)](_0x43d9ad(0xcc),'/operations/'+_0x17c577,_0x45f5a8[_0x43d9ad(0xd1)],_0x13409a,_0x33d589);if(_0x13409a[_0x43d9ad(0xd1)]!==_0x43d9ad(0xed)){loggerService_1[_0x43d9ad(0xb2)][_0x43d9ad(0xd8)]('plisio_direct',_0x43d9ad(0xac)+_0x17c577,'Plisio\x20API\x20error:\x20'+(_0x13409a[_0x43d9ad(0x115)]||_0x13409a['error']||_0x43d9ad(0x109)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x13409a['message']||_0x13409a[_0x43d9ad(0x10a)]||_0x43d9ad(0x109)));}let _0x2325d2=_0x43d9ad(0xda);return{'status':_0x2325d2};}catch(_0x40ff7f){console[_0x43d9ad(0x10a)](_0x43d9ad(0xbc),_0x40ff7f),loggerService_1[_0x43d9ad(0xb2)][_0x43d9ad(0xd8)](_0x43d9ad(0xcc),_0x43d9ad(0xac)+_0x17c577,_0x40ff7f);throw new Error(_0x43d9ad(0x104)+(_0x40ff7f instanceof Error?_0x40ff7f[_0x43d9ad(0x115)]:_0x43d9ad(0x109)));}}async[a45_0x2b68b5(0xe1)](_0x441a48){const _0x3bd925=a45_0x2b68b5;console['log'](_0x3bd925(0xe4),_0x441a48);let _0x5ddaca=_0x3bd925(0xda);switch(_0x441a48['status']?.[_0x3bd925(0x11e)]()){case _0x3bd925(0x11c):case _0x3bd925(0xdf):_0x5ddaca=_0x3bd925(0x111);break;case _0x3bd925(0xe0):_0x5ddaca=_0x3bd925(0xf1);break;case'error':case _0x3bd925(0xb8):_0x5ddaca=_0x3bd925(0x100);break;case _0x3bd925(0xee):_0x5ddaca=_0x3bd925(0xda);break;case _0x3bd925(0x10b):_0x5ddaca=_0x3bd925(0xd7);break;default:_0x5ddaca=_0x3bd925(0xda);break;}let _0x37e54d;if(_0x441a48[_0x3bd925(0xd4)])try{console['log'](_0x3bd925(0xc1),_0x441a48[_0x3bd925(0xd4)]);let _0x3d001f;if(typeof _0x441a48[_0x3bd925(0xd4)]===_0x3bd925(0xf9))_0x3d001f=JSON[_0x3bd925(0xf3)](_0x441a48[_0x3bd925(0xd4)]);else Array[_0x3bd925(0x107)](_0x441a48[_0x3bd925(0xd4)])?_0x3d001f=_0x441a48['tx_urls']:_0x3d001f=[];_0x37e54d=_0x3d001f[_0x3bd925(0xef)](_0x11774c=>{const _0xa878d5=_0x3bd925,_0x5bf694=_0x11774c[_0xa878d5(0xc2)](/\\/g,'');return console[_0xa878d5(0xc7)](_0xa878d5(0x108)+_0x11774c+'\x20->\x20'+_0x5bf694),_0x5bf694;}),console[_0x3bd925(0xc7)](_0x3bd925(0x10c),_0x37e54d),_0x37e54d[_0x3bd925(0xe5)]((_0x596377,_0x5afef6)=>{const _0x28cc1c=_0x3bd925;try{new URL(_0x596377),console['log'](_0x28cc1c(0xc5)+(_0x5afef6+0x1)+_0x28cc1c(0xc3)+_0x596377);}catch(_0x5babd3){console[_0x28cc1c(0x10a)](_0x28cc1c(0xf4)+(_0x5afef6+0x1)+_0x28cc1c(0xf5)+_0x596377,_0x5babd3);}});}catch(_0x4800fa){console[_0x3bd925(0x10a)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x4800fa),console[_0x3bd925(0x10a)](_0x3bd925(0x10f),_0x441a48[_0x3bd925(0xd4)]),_0x37e54d=undefined;}return{'paymentId':_0x441a48[_0x3bd925(0x105)]||'','status':_0x5ddaca,'amount':_0x441a48['amount'],'currency':_0x441a48[_0x3bd925(0xdc)],'txUrls':_0x37e54d};}}exports[a45_0x2b68b5(0xca)]=PlisioService;