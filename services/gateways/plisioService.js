'use strict';const a44_0x4a72e4=a44_0x5bd9;function a44_0x5bd9(_0x2092d5,_0xa632b8){const _0x40ec8d=a44_0x40ec();return a44_0x5bd9=function(_0x5bd9c2,_0x4fc2a1){_0x5bd9c2=_0x5bd9c2-0x1de;let _0x114af0=_0x40ec8d[_0x5bd9c2];return _0x114af0;},a44_0x5bd9(_0x2092d5,_0xa632b8);}function a44_0x40ec(){const _0x3d57e3=['üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','amount','260742yKSicB','PLISIO_API_KEY','Plisio\x20API\x20error:\x20','https://api.plisio.net/api/v1/invoices/new','URL:','email','parse','fromEntries','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Plisio\x20payment\x20verification\x20error:','mismatch','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','/operations/','currency','txn_id','Unknown\x20error\x20from\x20Plisio\x20API','Status\x20Text:','error','2563016NvHBfQ','source_currency',',\x20body:\x20','üîó\x20Formatted\x20URL:\x20','name','JSON\x20Parse\x20Error:\x20','tx_urls','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','stringify','data','Response\x20Time:','apiUrl','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','message','‚úÖ\x20Processed\x20tx_urls:','createPayment','Error\x20details:','Invoice\x20URL:','Raw\x20Response\x20Body:','json','invoice_url','statusText','HTTP\x20','HIDDEN','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','HTTP\x20error!\x20status:\x20','35iwMYjC','Parsed\x20Result:','\x20->\x20','loggerService','replace','defineProperty','../loggerService','‚ùå\x20URL\x20','text','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','EXPIRED','Target\x20Currency:','Plisio\x20API\x20key\x20is\x20not\x20configured','920007Cowrvi','completed','/invoices/new','Failed\x20to\x20parse\x20JSON\x20response:','order_number','toLowerCase','Parameters:','https://api.plisio.net/api/v1/operations/','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Response\x20data:','apiKey','map','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Amount:','logWhiteDomainRequest','2367522KhFwml','logWhiteDomainError','10IiaiyZ','FAILED','forEach','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','status','application/json','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','qr_code','env','cancelled','GET','processWebhook','Error\x20message:','expired','419poFIhV','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','4KgQDjw','Processing\x20Plisio\x20webhook:','Unknown\x20error','Full\x20URL\x20(without\x20API\x20key):','verifyPayment','402430YBOSLj','Error\x20Message:','stack','480105ftoreK','762izcTWo','log','PlisioService','plisio_direct','now','toString','Transaction\x20ID:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','entries','PENDING','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','TesSoft\x20Payment\x20System/1.0','Source\x20Currency:','warn','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','pending','PAID','new','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','append','logWhiteDomainResponse'];a44_0x40ec=function(){return _0x3d57e3;};return a44_0x40ec();}(function(_0x3d7741,_0x58d0b2){const _0x314ec2=a44_0x5bd9,_0xd0777b=_0x3d7741();while(!![]){try{const _0x281a6c=-parseInt(_0x314ec2(0x251))/0x1*(parseInt(_0x314ec2(0x1e2))/0x2)+parseInt(_0x314ec2(0x1e1))/0x3+-parseInt(_0x314ec2(0x253))/0x4*(parseInt(_0x314ec2(0x1de))/0x5)+-parseInt(_0x314ec2(0x1f9))/0x6*(-parseInt(_0x314ec2(0x225))/0x7)+-parseInt(_0x314ec2(0x20b))/0x8+parseInt(_0x314ec2(0x241))/0x9+-parseInt(_0x314ec2(0x243))/0xa*(-parseInt(_0x314ec2(0x232))/0xb);if(_0x281a6c===_0x58d0b2)break;else _0xd0777b['push'](_0xd0777b['shift']());}catch(_0x3b77c7){_0xd0777b['push'](_0xd0777b['shift']());}}}(a44_0x40ec,0x27eb9));Object[a44_0x4a72e4(0x22a)](exports,'__esModule',{'value':!![]}),exports[a44_0x4a72e4(0x1e4)]=void 0x0;const loggerService_1=require(a44_0x4a72e4(0x22b));class PlisioService{constructor(){const _0x5f198c=a44_0x4a72e4;this[_0x5f198c(0x216)]=_0x5f198c(0x1fc),this[_0x5f198c(0x23c)]=process[_0x5f198c(0x24b)][_0x5f198c(0x1fa)]||'',!this[_0x5f198c(0x23c)]?console[_0x5f198c(0x1ef)](_0x5f198c(0x1f4)):console['log'](_0x5f198c(0x223));}async[a44_0x4a72e4(0x21a)](_0x2bc14f){const _0x167c0d=a44_0x4a72e4,{orderId:_0x1400ac,amount:_0x285841,currency:_0x209726,productName:_0x191780,description:_0xd7aa0f,successUrl:_0x5973b4,failUrl:_0x3c2a58,customerEmail:_0x3c4371,customerName:_0x2e7955,isSourceCurrency:_0x51d4da,sourceCurrency:_0x5615c2}=_0x2bc14f;if(!this[_0x167c0d(0x23c)])throw new Error(_0x167c0d(0x231));const _0x51a1b0=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x1400ac,'order_name':_0x191780,'description':_0xd7aa0f,'success_url':_0x5973b4,'fail_url':_0x3c2a58,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x5615c2?(_0x51a1b0[_0x167c0d(0x1f5)]('currency',_0x5615c2),_0x51a1b0[_0x167c0d(0x1f5)](_0x167c0d(0x20c),_0x209726),_0x51a1b0[_0x167c0d(0x1f5)]('source_amount',_0x285841[_0x167c0d(0x1e7)]())):(_0x51a1b0[_0x167c0d(0x1f5)](_0x167c0d(0x206),_0x209726),_0x51a1b0[_0x167c0d(0x1f5)](_0x167c0d(0x1f8),_0x285841[_0x167c0d(0x1e7)]()));_0x3c4371&&_0x51a1b0[_0x167c0d(0x1f5)](_0x167c0d(0x1fe),_0x3c4371);_0x2e7955&&_0x51a1b0[_0x167c0d(0x1f5)](_0x167c0d(0x20f),_0x2e7955);const _0x166e25=this['apiUrl']+'?'+_0x51a1b0[_0x167c0d(0x1e7)](),_0x4597c0=Date[_0x167c0d(0x1e6)]();try{console['log'](_0x167c0d(0x22e)),console[_0x167c0d(0x1e3)](_0x167c0d(0x1fd),this[_0x167c0d(0x216)]),console['log'](_0x167c0d(0x238),Object[_0x167c0d(0x200)](_0x51a1b0[_0x167c0d(0x1ea)]())),console['log'](_0x167c0d(0x256),_0x166e25[_0x167c0d(0x229)](this[_0x167c0d(0x23c)],_0x167c0d(0x222))),loggerService_1[_0x167c0d(0x228)][_0x167c0d(0x240)]('plisio_direct',_0x167c0d(0x234),_0x167c0d(0x24d),Object['fromEntries'](_0x51a1b0[_0x167c0d(0x1ea)]()));const _0x19a7b0=await fetch(_0x166e25,{'method':_0x167c0d(0x24d),'headers':{'Accept':_0x167c0d(0x248),'User-Agent':_0x167c0d(0x1ed)}}),_0x51bb1a=Date[_0x167c0d(0x1e6)]()-_0x4597c0;console['log'](_0x167c0d(0x1ec)),console[_0x167c0d(0x1e3)]('Status:',_0x19a7b0[_0x167c0d(0x247)]),console[_0x167c0d(0x1e3)](_0x167c0d(0x209),_0x19a7b0[_0x167c0d(0x220)]),console[_0x167c0d(0x1e3)](_0x167c0d(0x215),_0x51bb1a+'ms');const _0x2f8633=await _0x19a7b0[_0x167c0d(0x22d)]();console['log'](_0x167c0d(0x21d),_0x2f8633);if(!_0x19a7b0['ok']){console[_0x167c0d(0x20a)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x167c0d(0x20a)]('HTTP\x20Status:',_0x19a7b0[_0x167c0d(0x247)]),console['error']('Response\x20Body:',_0x2f8633),loggerService_1[_0x167c0d(0x228)][_0x167c0d(0x1f6)](_0x167c0d(0x1e5),_0x167c0d(0x234),_0x19a7b0['status'],_0x2f8633,_0x51bb1a),loggerService_1[_0x167c0d(0x228)][_0x167c0d(0x242)](_0x167c0d(0x1e5),'/invoices/new',_0x167c0d(0x221)+_0x19a7b0[_0x167c0d(0x247)]+':\x20'+_0x2f8633);throw new Error('HTTP\x20error!\x20status:\x20'+_0x19a7b0[_0x167c0d(0x247)]+_0x167c0d(0x20d)+_0x2f8633);}let _0x2df7c8;try{_0x2df7c8=JSON[_0x167c0d(0x1ff)](_0x2f8633);}catch(_0x4dd758){console['error'](_0x167c0d(0x235),_0x4dd758),loggerService_1[_0x167c0d(0x228)]['logWhiteDomainError'](_0x167c0d(0x1e5),_0x167c0d(0x234),_0x167c0d(0x210)+_0x4dd758);throw new Error(_0x167c0d(0x1f0)+_0x2f8633);}console['log'](_0x167c0d(0x204)),console[_0x167c0d(0x1e3)](_0x167c0d(0x226),JSON[_0x167c0d(0x213)](_0x2df7c8,null,0x2)),loggerService_1[_0x167c0d(0x228)][_0x167c0d(0x1f6)]('plisio_direct',_0x167c0d(0x234),_0x19a7b0[_0x167c0d(0x247)],_0x2df7c8,_0x51bb1a);if(_0x2df7c8[_0x167c0d(0x247)]!=='success'){const _0x1b516d=_0x2df7c8[_0x167c0d(0x218)]||_0x2df7c8[_0x167c0d(0x20a)]||_0x167c0d(0x208);console[_0x167c0d(0x20a)](_0x167c0d(0x246)),console[_0x167c0d(0x20a)](_0x167c0d(0x1df),_0x1b516d),loggerService_1[_0x167c0d(0x228)][_0x167c0d(0x242)](_0x167c0d(0x1e5),'/invoices/new','Business\x20Error:\x20'+_0x1b516d);throw new Error('Plisio\x20API\x20error:\x20'+_0x1b516d);}if(!_0x2df7c8[_0x167c0d(0x214)]?.['txn_id']||!_0x2df7c8[_0x167c0d(0x214)]?.[_0x167c0d(0x21f)]){console[_0x167c0d(0x20a)](_0x167c0d(0x201)),console[_0x167c0d(0x20a)](_0x167c0d(0x212)),console[_0x167c0d(0x20a)](_0x167c0d(0x23b),_0x2df7c8[_0x167c0d(0x214)]),loggerService_1['loggerService'][_0x167c0d(0x242)](_0x167c0d(0x1e5),_0x167c0d(0x234),_0x167c0d(0x1e9));throw new Error(_0x167c0d(0x23a));}return console[_0x167c0d(0x1e3)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x167c0d(0x1e3)](_0x167c0d(0x1e8),_0x2df7c8[_0x167c0d(0x214)][_0x167c0d(0x207)]),console[_0x167c0d(0x1e3)](_0x167c0d(0x21c),_0x2df7c8['data'][_0x167c0d(0x21f)]),console[_0x167c0d(0x1e3)](_0x167c0d(0x23f),_0x285841,_0x209726),_0x5615c2&&(console['log'](_0x167c0d(0x1ee),_0x5615c2,'(crypto\x20for\x20payment)'),console['log'](_0x167c0d(0x230),_0x209726,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x2df7c8[_0x167c0d(0x214)]['txn_id'],'payment_url':_0x2df7c8[_0x167c0d(0x214)]['invoice_url'],'invoice_total_sum':_0x2df7c8['data']['invoice_total_sum'],'qr_code':_0x2df7c8[_0x167c0d(0x214)][_0x167c0d(0x24a)],'qr_url':_0x2df7c8[_0x167c0d(0x214)]['qr_url']};}catch(_0x5be252){console[_0x167c0d(0x20a)](_0x167c0d(0x252)),console[_0x167c0d(0x20a)](_0x167c0d(0x21b),_0x5be252),loggerService_1[_0x167c0d(0x228)]['logWhiteDomainError'](_0x167c0d(0x1e5),'/invoices/new',_0x5be252);if(_0x5be252 instanceof Error){console['error'](_0x167c0d(0x24f),_0x5be252[_0x167c0d(0x218)]),console[_0x167c0d(0x20a)]('Error\x20stack:',_0x5be252[_0x167c0d(0x1e0)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x5be252['message']);}throw new Error(_0x167c0d(0x23e));}}async[a44_0x4a72e4(0x257)](_0x4db677){const _0x17460a=a44_0x4a72e4,_0x39ae09=Date['now']();try{if(!this[_0x17460a(0x23c)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x374484=new URLSearchParams({'api_key':this[_0x17460a(0x23c)],'txn_id':_0x4db677}),_0x15925e=_0x17460a(0x239)+_0x4db677+'?'+_0x374484[_0x17460a(0x1e7)]();loggerService_1[_0x17460a(0x228)][_0x17460a(0x240)]('plisio_direct',_0x17460a(0x205)+_0x4db677,_0x17460a(0x24d),Object[_0x17460a(0x200)](_0x374484[_0x17460a(0x1ea)]()));const _0x3190a9=await fetch(_0x15925e,{'method':_0x17460a(0x24d),'headers':{'Accept':_0x17460a(0x248),'User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x161b61=Date['now']()-_0x39ae09;if(!_0x3190a9['ok']){const _0x3380d9=await _0x3190a9[_0x17460a(0x22d)]();loggerService_1[_0x17460a(0x228)][_0x17460a(0x1f6)](_0x17460a(0x1e5),_0x17460a(0x205)+_0x4db677,_0x3190a9[_0x17460a(0x247)],_0x3380d9,_0x161b61);throw new Error(_0x17460a(0x224)+_0x3190a9[_0x17460a(0x247)]);}const _0xb0ee69=await _0x3190a9[_0x17460a(0x21e)]();loggerService_1[_0x17460a(0x228)]['logWhiteDomainResponse'](_0x17460a(0x1e5),_0x17460a(0x205)+_0x4db677,_0x3190a9[_0x17460a(0x247)],_0xb0ee69,_0x161b61);if(_0xb0ee69[_0x17460a(0x247)]!=='success'){loggerService_1[_0x17460a(0x228)][_0x17460a(0x242)]('plisio_direct',_0x17460a(0x205)+_0x4db677,_0x17460a(0x1fb)+(_0xb0ee69[_0x17460a(0x218)]||_0xb0ee69['error']||_0x17460a(0x255)));throw new Error('Plisio\x20API\x20error:\x20'+(_0xb0ee69[_0x17460a(0x218)]||_0xb0ee69[_0x17460a(0x20a)]||_0x17460a(0x255)));}let _0x91a3e5=_0x17460a(0x1eb);return{'status':_0x91a3e5};}catch(_0x90c366){console[_0x17460a(0x20a)](_0x17460a(0x202),_0x90c366),loggerService_1['loggerService'][_0x17460a(0x242)]('plisio_direct',_0x17460a(0x205)+_0x4db677,_0x90c366);throw new Error(_0x17460a(0x217)+(_0x90c366 instanceof Error?_0x90c366[_0x17460a(0x218)]:_0x17460a(0x255)));}}async[a44_0x4a72e4(0x24e)](_0x187141){const _0x526f88=a44_0x4a72e4;console['log'](_0x526f88(0x254),_0x187141);let _0x1b159e=_0x526f88(0x1eb);switch(_0x187141[_0x526f88(0x247)]?.[_0x526f88(0x237)]()){case _0x526f88(0x233):case _0x526f88(0x203):_0x1b159e=_0x526f88(0x1f2);break;case _0x526f88(0x250):_0x1b159e=_0x526f88(0x22f);break;case _0x526f88(0x20a):case _0x526f88(0x24c):_0x1b159e=_0x526f88(0x244);break;case _0x526f88(0x1f3):case _0x526f88(0x1f1):default:_0x1b159e='PENDING';break;}let _0xf7746c;if(_0x187141[_0x526f88(0x211)])try{console[_0x526f88(0x1e3)](_0x526f88(0x1f7),_0x187141[_0x526f88(0x211)]);let _0x127498;if(typeof _0x187141['tx_urls']==='string')_0x127498=JSON[_0x526f88(0x1ff)](_0x187141[_0x526f88(0x211)]);else Array['isArray'](_0x187141['tx_urls'])?_0x127498=_0x187141[_0x526f88(0x211)]:_0x127498=[];_0xf7746c=_0x127498[_0x526f88(0x23d)](_0x555073=>{const _0x449b49=_0x526f88,_0x293839=_0x555073['replace'](/\\/g,'');return console[_0x449b49(0x1e3)](_0x449b49(0x20e)+_0x555073+_0x449b49(0x227)+_0x293839),_0x293839;}),console[_0x526f88(0x1e3)](_0x526f88(0x219),_0xf7746c),_0xf7746c[_0x526f88(0x245)]((_0x3a7026,_0x477558)=>{const _0x433916=_0x526f88;try{new URL(_0x3a7026),console[_0x433916(0x1e3)]('‚úÖ\x20URL\x20'+(_0x477558+0x1)+'\x20is\x20valid:\x20'+_0x3a7026);}catch(_0x2b8e66){console[_0x433916(0x20a)](_0x433916(0x22c)+(_0x477558+0x1)+'\x20is\x20invalid:\x20'+_0x3a7026,_0x2b8e66);}});}catch(_0x558cff){console[_0x526f88(0x20a)](_0x526f88(0x249),_0x558cff),console[_0x526f88(0x20a)]('Raw\x20tx_urls\x20data:',_0x187141[_0x526f88(0x211)]),_0xf7746c=undefined;}return{'paymentId':_0x187141[_0x526f88(0x236)]||'','status':_0x1b159e,'amount':_0x187141[_0x526f88(0x1f8)],'currency':_0x187141[_0x526f88(0x206)],'txUrls':_0xf7746c};}}exports['PlisioService']=PlisioService;