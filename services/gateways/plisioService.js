'use strict';function a47_0x5562(){const _0xba1406=['error','toString','map','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','Business\x20Error:\x20','1526001IDtQxb','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','application/json','PROCESSING','parse','10YFumfR','success','log','Processing\x20Plisio\x20webhook:','__esModule','fromEntries','TesSoft\x20Payment\x20System/1.0','Status\x20Text:','stringify','append','974196SUbCzY','isArray','280Jqqmiq','stack','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','7669080yGjdxL','https://api.plisio.net/api/v1/operations/','FAILED','Response\x20Body:','Plisio\x20payment\x20verification\x20error:','data','Error\x20stack:','‚úÖ\x20Processed\x20tx_urls:','HIDDEN','‚úÖ\x20URL\x20','Error\x20Message:','\x20is\x20invalid:\x20','new','üîó\x20Formatted\x20URL:\x20','name','verifyPayment','completed','status','5598621hTbWfy','apiKey','string','source_amount','amount','Amount:','Error\x20details:','email','Error\x20message:','Failed\x20to\x20parse\x20JSON\x20response:','GET','EXPIRED','now','PlisioService','(fiat\x20for\x20merchant)','cancelled','10SySoYN','replace','currency','entries','PLISIO_API_KEY','PAID','Plisio\x20API\x20key\x20is\x20not\x20configured','processWebhook','4vyojEZ','HTTP\x20Status:','logWhiteDomainError','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','invoice_url','411696uXZIjz','Response\x20Time:','logWhiteDomainResponse','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20','loggerService','Invoice\x20URL:','expired','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','mismatch','plisio_direct','Unknown\x20error','‚ùå\x20URL\x20','/operations/','Transaction\x20ID:','491669sQtRqG',',\x20body:\x20','https://api.plisio.net/api/v1/invoices/new','env','https://api.trapay.uk/api/webhooks/gateway/plisio','===\x20PLISIO\x20SUCCESS\x20===','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','json','message','\x20->\x20','invoice_total_sum','Raw\x20Response\x20Body:','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','134267vfLPPw','HTTP\x20error!\x20status:\x20','tx_urls','createPayment','PENDING','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','forEach','Parsed\x20Result:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','/invoices/new','txn_id','\x20is\x20valid:\x20','qr_code','statusText','../loggerService','(crypto\x20for\x20payment)','Raw\x20tx_urls\x20data:','Plisio\x20API\x20error:\x20','apiUrl','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','source_currency','33gOXJOa'];a47_0x5562=function(){return _0xba1406;};return a47_0x5562();}const a47_0x897bb9=a47_0x5ac4;function a47_0x5ac4(_0x5a78b3,_0x3447da){const _0x556218=a47_0x5562();return a47_0x5ac4=function(_0x5ac420,_0x221ed1){_0x5ac420=_0x5ac420-0x1d9;let _0x323461=_0x556218[_0x5ac420];return _0x323461;},a47_0x5ac4(_0x5a78b3,_0x3447da);}(function(_0x4816c0,_0x2e4338){const _0x14bb62=a47_0x5ac4,_0x40f6d0=_0x4816c0();while(!![]){try{const _0x3f4693=-parseInt(_0x14bb62(0x247))/0x1*(-parseInt(_0x14bb62(0x233))/0x2)+parseInt(_0x14bb62(0x1f5))/0x3+-parseInt(_0x14bb62(0x204))/0x4*(-parseInt(_0x14bb62(0x1fa))/0x5)+-parseInt(_0x14bb62(0x209))/0x6+-parseInt(_0x14bb62(0x1d9))/0x7*(parseInt(_0x14bb62(0x206))/0x8)+-parseInt(_0x14bb62(0x21b))/0x9*(-parseInt(_0x14bb62(0x22b))/0xa)+-parseInt(_0x14bb62(0x1ee))/0xb*(-parseInt(_0x14bb62(0x238))/0xc);if(_0x3f4693===_0x2e4338)break;else _0x40f6d0['push'](_0x40f6d0['shift']());}catch(_0x10976e){_0x40f6d0['push'](_0x40f6d0['shift']());}}}(a47_0x5562,0xb8395));Object['defineProperty'](exports,a47_0x897bb9(0x1fe),{'value':!![]}),exports[a47_0x897bb9(0x228)]=void 0x0;const loggerService_1=require(a47_0x897bb9(0x1e7));class PlisioService{constructor(){const _0x3b11a2=a47_0x897bb9;this[_0x3b11a2(0x1eb)]=_0x3b11a2(0x249),this[_0x3b11a2(0x21c)]=process[_0x3b11a2(0x24a)][_0x3b11a2(0x22f)]||'',!this[_0x3b11a2(0x21c)]?console['warn']('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x3b11a2(0x1fc)](_0x3b11a2(0x1de));}async[a47_0x897bb9(0x1dc)](_0x4388c0){const _0x1c783f=a47_0x897bb9,{orderId:_0x22d966,amount:_0x53640d,currency:_0x1d3833,productName:_0xa12271,description:_0x5b94ad,successUrl:_0x4979cf,failUrl:_0x2c26a0,customerEmail:_0x378ce6,customerName:_0x16ad58,isSourceCurrency:_0x20b25e,sourceCurrency:_0x34524f}=_0x4388c0;if(!this[_0x1c783f(0x21c)])throw new Error(_0x1c783f(0x231));const _0x3857fa=new URLSearchParams({'api_key':this[_0x1c783f(0x21c)],'order_number':_0x22d966,'order_name':_0xa12271,'description':_0x5b94ad,'success_url':_0x4979cf,'fail_url':_0x2c26a0,'callback_url':_0x1c783f(0x24b)});_0x34524f?(_0x3857fa['append'](_0x1c783f(0x22d),_0x34524f),_0x3857fa[_0x1c783f(0x203)](_0x1c783f(0x1ed),_0x1d3833),_0x3857fa[_0x1c783f(0x203)](_0x1c783f(0x21e),_0x53640d[_0x1c783f(0x1f0)]())):(_0x3857fa[_0x1c783f(0x203)](_0x1c783f(0x22d),_0x1d3833),_0x3857fa[_0x1c783f(0x203)](_0x1c783f(0x21f),_0x53640d[_0x1c783f(0x1f0)]()));_0x378ce6&&_0x3857fa[_0x1c783f(0x203)](_0x1c783f(0x222),_0x378ce6);_0x16ad58&&_0x3857fa[_0x1c783f(0x203)](_0x1c783f(0x217),_0x16ad58);const _0x7bde05=this[_0x1c783f(0x1eb)]+'?'+_0x3857fa[_0x1c783f(0x1f0)](),_0x635603=Date[_0x1c783f(0x227)]();try{console['log'](_0x1c783f(0x254)),console[_0x1c783f(0x1fc)]('URL:',this['apiUrl']),console[_0x1c783f(0x1fc)]('Parameters:',Object[_0x1c783f(0x1ff)](_0x3857fa[_0x1c783f(0x22e)]())),console[_0x1c783f(0x1fc)]('Full\x20URL\x20(without\x20API\x20key):',_0x7bde05['replace'](this[_0x1c783f(0x21c)],_0x1c783f(0x211))),loggerService_1['loggerService']['logWhiteDomainRequest']('plisio_direct','/invoices/new',_0x1c783f(0x225),Object[_0x1c783f(0x1ff)](_0x3857fa[_0x1c783f(0x22e)]()));const _0x4fcee0=await fetch(_0x7bde05,{'method':_0x1c783f(0x225),'headers':{'Accept':_0x1c783f(0x1f7),'User-Agent':_0x1c783f(0x200)}}),_0x7e9ba7=Date[_0x1c783f(0x227)]()-_0x635603;console[_0x1c783f(0x1fc)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x1c783f(0x1fc)]('Status:',_0x4fcee0[_0x1c783f(0x21a)]),console[_0x1c783f(0x1fc)](_0x1c783f(0x201),_0x4fcee0[_0x1c783f(0x1e6)]),console[_0x1c783f(0x1fc)](_0x1c783f(0x239),_0x7e9ba7+'ms');const _0x15daa2=await _0x4fcee0['text']();console[_0x1c783f(0x1fc)](_0x1c783f(0x252),_0x15daa2);if(!_0x4fcee0['ok']){console[_0x1c783f(0x1ef)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error'](_0x1c783f(0x234),_0x4fcee0['status']),console[_0x1c783f(0x1ef)](_0x1c783f(0x20c),_0x15daa2),loggerService_1[_0x1c783f(0x23d)][_0x1c783f(0x23a)](_0x1c783f(0x242),'/invoices/new',_0x4fcee0[_0x1c783f(0x21a)],_0x15daa2,_0x7e9ba7),loggerService_1[_0x1c783f(0x23d)][_0x1c783f(0x235)](_0x1c783f(0x242),_0x1c783f(0x1e2),'HTTP\x20'+_0x4fcee0['status']+':\x20'+_0x15daa2);throw new Error(_0x1c783f(0x1da)+_0x4fcee0[_0x1c783f(0x21a)]+_0x1c783f(0x248)+_0x15daa2);}let _0x16cf3d;try{_0x16cf3d=JSON[_0x1c783f(0x1f9)](_0x15daa2);}catch(_0x37f834){console['error'](_0x1c783f(0x224),_0x37f834),loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct',_0x1c783f(0x1e2),'JSON\x20Parse\x20Error:\x20'+_0x37f834);throw new Error(_0x1c783f(0x236)+_0x15daa2);}console['log'](_0x1c783f(0x1f6)),console['log'](_0x1c783f(0x1e0),JSON[_0x1c783f(0x202)](_0x16cf3d,null,0x2)),loggerService_1[_0x1c783f(0x23d)][_0x1c783f(0x23a)](_0x1c783f(0x242),_0x1c783f(0x1e2),_0x4fcee0[_0x1c783f(0x21a)],_0x16cf3d,_0x7e9ba7);if(_0x16cf3d[_0x1c783f(0x21a)]!==_0x1c783f(0x1fb)){const _0x3bbeda=_0x16cf3d[_0x1c783f(0x24f)]||_0x16cf3d['error']||'Unknown\x20error\x20from\x20Plisio\x20API';console['error'](_0x1c783f(0x1f3)),console[_0x1c783f(0x1ef)](_0x1c783f(0x213),_0x3bbeda),loggerService_1[_0x1c783f(0x23d)][_0x1c783f(0x235)](_0x1c783f(0x242),_0x1c783f(0x1e2),_0x1c783f(0x1f4)+_0x3bbeda);throw new Error(_0x1c783f(0x1ea)+_0x3bbeda);}if(!_0x16cf3d[_0x1c783f(0x20e)]?.[_0x1c783f(0x1e3)]||!_0x16cf3d[_0x1c783f(0x20e)]?.[_0x1c783f(0x237)]){console[_0x1c783f(0x1ef)](_0x1c783f(0x1ec)),console[_0x1c783f(0x1ef)](_0x1c783f(0x24d)),console[_0x1c783f(0x1ef)]('Response\x20data:',_0x16cf3d[_0x1c783f(0x20e)]),loggerService_1[_0x1c783f(0x23d)][_0x1c783f(0x235)](_0x1c783f(0x242),_0x1c783f(0x1e2),_0x1c783f(0x253));throw new Error(_0x1c783f(0x1e1));}return console[_0x1c783f(0x1fc)](_0x1c783f(0x24c)),console[_0x1c783f(0x1fc)](_0x1c783f(0x246),_0x16cf3d[_0x1c783f(0x20e)]['txn_id']),console[_0x1c783f(0x1fc)](_0x1c783f(0x23e),_0x16cf3d[_0x1c783f(0x20e)][_0x1c783f(0x237)]),console[_0x1c783f(0x1fc)](_0x1c783f(0x220),_0x53640d,_0x1d3833),_0x34524f&&(console[_0x1c783f(0x1fc)]('Source\x20Currency:',_0x34524f,_0x1c783f(0x1e8)),console['log']('Target\x20Currency:',_0x1d3833,_0x1c783f(0x229))),{'gateway_payment_id':_0x16cf3d['data'][_0x1c783f(0x1e3)],'payment_url':_0x16cf3d['data'][_0x1c783f(0x237)],'invoice_total_sum':_0x16cf3d[_0x1c783f(0x20e)][_0x1c783f(0x251)],'qr_code':_0x16cf3d['data'][_0x1c783f(0x1e5)],'qr_url':_0x16cf3d[_0x1c783f(0x20e)]['qr_url']};}catch(_0x4c9e45){console[_0x1c783f(0x1ef)](_0x1c783f(0x208)),console[_0x1c783f(0x1ef)](_0x1c783f(0x221),_0x4c9e45),loggerService_1['loggerService'][_0x1c783f(0x235)]('plisio_direct',_0x1c783f(0x1e2),_0x4c9e45);if(_0x4c9e45 instanceof Error){console[_0x1c783f(0x1ef)](_0x1c783f(0x223),_0x4c9e45['message']),console['error'](_0x1c783f(0x20f),_0x4c9e45[_0x1c783f(0x207)]);throw new Error(_0x1c783f(0x23c)+_0x4c9e45[_0x1c783f(0x24f)]);}throw new Error(_0x1c783f(0x240));}}async[a47_0x897bb9(0x218)](_0x589906){const _0x104798=a47_0x897bb9,_0x5b0012=Date[_0x104798(0x227)]();try{if(!this[_0x104798(0x21c)])throw new Error(_0x104798(0x231));const _0x53bf71=new URLSearchParams({'api_key':this[_0x104798(0x21c)],'txn_id':_0x589906}),_0x258cb8=_0x104798(0x20a)+_0x589906+'?'+_0x53bf71[_0x104798(0x1f0)]();loggerService_1[_0x104798(0x23d)]['logWhiteDomainRequest'](_0x104798(0x242),'/operations/'+_0x589906,_0x104798(0x225),Object[_0x104798(0x1ff)](_0x53bf71[_0x104798(0x22e)]()));const _0x525773=await fetch(_0x258cb8,{'method':_0x104798(0x225),'headers':{'Accept':_0x104798(0x1f7),'User-Agent':_0x104798(0x200)}}),_0xb641d5=Date[_0x104798(0x227)]()-_0x5b0012;if(!_0x525773['ok']){const _0x1faa29=await _0x525773['text']();loggerService_1[_0x104798(0x23d)][_0x104798(0x23a)](_0x104798(0x242),'/operations/'+_0x589906,_0x525773[_0x104798(0x21a)],_0x1faa29,_0xb641d5);throw new Error(_0x104798(0x1da)+_0x525773[_0x104798(0x21a)]);}const _0x30ade9=await _0x525773[_0x104798(0x24e)]();loggerService_1[_0x104798(0x23d)]['logWhiteDomainResponse']('plisio_direct',_0x104798(0x245)+_0x589906,_0x525773[_0x104798(0x21a)],_0x30ade9,_0xb641d5);if(_0x30ade9[_0x104798(0x21a)]!==_0x104798(0x1fb)){loggerService_1['loggerService'][_0x104798(0x235)](_0x104798(0x242),_0x104798(0x245)+_0x589906,_0x104798(0x1ea)+(_0x30ade9[_0x104798(0x24f)]||_0x30ade9[_0x104798(0x1ef)]||_0x104798(0x243)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x30ade9[_0x104798(0x24f)]||_0x30ade9[_0x104798(0x1ef)]||_0x104798(0x243)));}let _0x4b9a40=_0x104798(0x1dd);return{'status':_0x4b9a40};}catch(_0x36c734){console[_0x104798(0x1ef)](_0x104798(0x20d),_0x36c734),loggerService_1[_0x104798(0x23d)]['logWhiteDomainError'](_0x104798(0x242),_0x104798(0x245)+_0x589906,_0x36c734);throw new Error(_0x104798(0x23b)+(_0x36c734 instanceof Error?_0x36c734[_0x104798(0x24f)]:_0x104798(0x243)));}}async[a47_0x897bb9(0x232)](_0x4e92b8){const _0x3452dc=a47_0x897bb9;console['log'](_0x3452dc(0x1fd),_0x4e92b8);let _0xcfa00c=_0x3452dc(0x1dd);switch(_0x4e92b8[_0x3452dc(0x21a)]?.['toLowerCase']()){case _0x3452dc(0x219):case _0x3452dc(0x241):_0xcfa00c=_0x3452dc(0x230);break;case _0x3452dc(0x23f):_0xcfa00c=_0x3452dc(0x226);break;case _0x3452dc(0x1ef):case _0x3452dc(0x22a):_0xcfa00c=_0x3452dc(0x20b);break;case _0x3452dc(0x215):_0xcfa00c=_0x3452dc(0x1dd);break;case'pending':_0xcfa00c=_0x3452dc(0x1f8);break;default:_0xcfa00c=_0x3452dc(0x1dd);break;}let _0x2c07e0;if(_0x4e92b8['tx_urls'])try{console[_0x3452dc(0x1fc)](_0x3452dc(0x1f2),_0x4e92b8[_0x3452dc(0x1db)]);let _0x13085a;if(typeof _0x4e92b8[_0x3452dc(0x1db)]===_0x3452dc(0x21d))_0x13085a=JSON['parse'](_0x4e92b8[_0x3452dc(0x1db)]);else Array[_0x3452dc(0x205)](_0x4e92b8[_0x3452dc(0x1db)])?_0x13085a=_0x4e92b8[_0x3452dc(0x1db)]:_0x13085a=[];_0x2c07e0=_0x13085a[_0x3452dc(0x1f1)](_0x5e0dd6=>{const _0x7a85f6=_0x3452dc,_0x4fd033=_0x5e0dd6[_0x7a85f6(0x22c)](/\\/g,'');return console[_0x7a85f6(0x1fc)](_0x7a85f6(0x216)+_0x5e0dd6+_0x7a85f6(0x250)+_0x4fd033),_0x4fd033;}),console['log'](_0x3452dc(0x210),_0x2c07e0),_0x2c07e0[_0x3452dc(0x1df)]((_0x2ec07c,_0x380636)=>{const _0x131bfb=_0x3452dc;try{new URL(_0x2ec07c),console[_0x131bfb(0x1fc)](_0x131bfb(0x212)+(_0x380636+0x1)+_0x131bfb(0x1e4)+_0x2ec07c);}catch(_0x5c2ec8){console[_0x131bfb(0x1ef)](_0x131bfb(0x244)+(_0x380636+0x1)+_0x131bfb(0x214)+_0x2ec07c,_0x5c2ec8);}});}catch(_0x4029e2){console[_0x3452dc(0x1ef)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x4029e2),console['error'](_0x3452dc(0x1e9),_0x4e92b8[_0x3452dc(0x1db)]),_0x2c07e0=undefined;}return{'paymentId':_0x4e92b8['order_number']||'','status':_0xcfa00c,'amount':_0x4e92b8['amount'],'currency':_0x4e92b8[_0x3452dc(0x22d)],'txUrls':_0x2c07e0};}}exports['PlisioService']=PlisioService;