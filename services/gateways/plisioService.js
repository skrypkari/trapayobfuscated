'use strict';const a44_0x5ee3b7=a44_0x2b8f;(function(_0x3eb33c,_0x50dc71){const _0x49e1ee=a44_0x2b8f,_0xf0917e=_0x3eb33c();while(!![]){try{const _0x477a79=-parseInt(_0x49e1ee(0x1fc))/0x1+-parseInt(_0x49e1ee(0x23d))/0x2+-parseInt(_0x49e1ee(0x1e8))/0x3*(-parseInt(_0x49e1ee(0x234))/0x4)+parseInt(_0x49e1ee(0x201))/0x5*(-parseInt(_0x49e1ee(0x1e4))/0x6)+parseInt(_0x49e1ee(0x1e7))/0x7*(-parseInt(_0x49e1ee(0x1f4))/0x8)+parseInt(_0x49e1ee(0x242))/0x9+-parseInt(_0x49e1ee(0x1f8))/0xa*(-parseInt(_0x49e1ee(0x236))/0xb);if(_0x477a79===_0x50dc71)break;else _0xf0917e['push'](_0xf0917e['shift']());}catch(_0x1ea760){_0xf0917e['push'](_0xf0917e['shift']());}}}(a44_0x509a,0x22aab));Object[a44_0x5ee3b7(0x1fb)](exports,a44_0x5ee3b7(0x1f0),{'value':!![]}),exports['PlisioService']=void 0x0;const loggerService_1=require('../loggerService');class PlisioService{constructor(){const _0x2217da=a44_0x5ee3b7;this[_0x2217da(0x23c)]='https://api.plisio.net/api/v1/invoices/new',this['apiKey']=process[_0x2217da(0x21e)]['PLISIO_API_KEY']||'',!this[_0x2217da(0x24e)]?console[_0x2217da(0x1f6)]('⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x2217da(0x1eb)](_0x2217da(0x21f));}async[a44_0x5ee3b7(0x208)](_0x1ed558){const _0x4b5c2e=a44_0x5ee3b7,{orderId:_0x3c9def,amount:_0x44ba36,currency:_0x2a3d1e,productName:_0x3813f4,description:_0x121a6a,successUrl:_0x27e45e,failUrl:_0x4b2623,customerEmail:_0x3fcf6e,customerName:_0x3ceea7,isSourceCurrency:_0xf23b57,sourceCurrency:_0x39fd18}=_0x1ed558;if(!this[_0x4b5c2e(0x24e)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x1afac0=new URLSearchParams({'api_key':this[_0x4b5c2e(0x24e)],'order_number':_0x3c9def,'order_name':_0x3813f4,'description':_0x121a6a,'success_url':_0x27e45e,'fail_url':_0x4b2623,'callback_url':_0x4b5c2e(0x22e)});_0x39fd18?(_0x1afac0[_0x4b5c2e(0x1e3)](_0x4b5c2e(0x21c),_0x39fd18),_0x1afac0[_0x4b5c2e(0x1e3)](_0x4b5c2e(0x24f),_0x2a3d1e),_0x1afac0[_0x4b5c2e(0x1e3)]('source_amount',_0x44ba36[_0x4b5c2e(0x20d)]())):(_0x1afac0[_0x4b5c2e(0x1e3)](_0x4b5c2e(0x21c),_0x2a3d1e),_0x1afac0[_0x4b5c2e(0x1e3)]('amount',_0x44ba36[_0x4b5c2e(0x20d)]()));_0x3fcf6e&&_0x1afac0[_0x4b5c2e(0x1e3)](_0x4b5c2e(0x225),_0x3fcf6e);_0x3ceea7&&_0x1afac0[_0x4b5c2e(0x1e3)]('name',_0x3ceea7);const _0x3fc6b4=this[_0x4b5c2e(0x23c)]+'?'+_0x1afac0[_0x4b5c2e(0x20d)](),_0x5a066a=Date[_0x4b5c2e(0x1e9)]();try{console['log'](_0x4b5c2e(0x224)),console[_0x4b5c2e(0x1eb)](_0x4b5c2e(0x21b),this['apiUrl']),console[_0x4b5c2e(0x1eb)]('Parameters:',Object[_0x4b5c2e(0x23e)](_0x1afac0[_0x4b5c2e(0x22c)]())),console['log']('Full\x20URL\x20(without\x20API\x20key):',_0x3fc6b4[_0x4b5c2e(0x24d)](this[_0x4b5c2e(0x24e)],_0x4b5c2e(0x1fe))),loggerService_1['loggerService'][_0x4b5c2e(0x23a)](_0x4b5c2e(0x205),_0x4b5c2e(0x222),_0x4b5c2e(0x202),Object[_0x4b5c2e(0x23e)](_0x1afac0[_0x4b5c2e(0x22c)]()));const _0x57781e=await fetch(_0x3fc6b4,{'method':_0x4b5c2e(0x202),'headers':{'Accept':_0x4b5c2e(0x1f9),'User-Agent':_0x4b5c2e(0x249)}}),_0x4180e3=Date['now']()-_0x5a066a;console['log'](_0x4b5c2e(0x230)),console[_0x4b5c2e(0x1eb)](_0x4b5c2e(0x1ff),_0x57781e[_0x4b5c2e(0x218)]),console[_0x4b5c2e(0x1eb)](_0x4b5c2e(0x20a),_0x57781e[_0x4b5c2e(0x1e6)]),console[_0x4b5c2e(0x1eb)]('Response\x20Time:',_0x4180e3+'ms');const _0x1425d3=await _0x57781e[_0x4b5c2e(0x203)]();console[_0x4b5c2e(0x1eb)]('Raw\x20Response\x20Body:',_0x1425d3);if(!_0x57781e['ok']){console[_0x4b5c2e(0x227)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x57781e[_0x4b5c2e(0x218)]),console['error'](_0x4b5c2e(0x244),_0x1425d3),loggerService_1['loggerService'][_0x4b5c2e(0x217)](_0x4b5c2e(0x205),'/invoices/new',_0x57781e[_0x4b5c2e(0x218)],_0x1425d3,_0x4180e3),loggerService_1[_0x4b5c2e(0x228)]['logWhiteDomainError'](_0x4b5c2e(0x205),_0x4b5c2e(0x222),_0x4b5c2e(0x226)+_0x57781e[_0x4b5c2e(0x218)]+':\x20'+_0x1425d3);throw new Error(_0x4b5c2e(0x232)+_0x57781e[_0x4b5c2e(0x218)]+_0x4b5c2e(0x247)+_0x1425d3);}let _0x374684;try{_0x374684=JSON['parse'](_0x1425d3);}catch(_0x254847){console[_0x4b5c2e(0x227)](_0x4b5c2e(0x210),_0x254847),loggerService_1[_0x4b5c2e(0x228)]['logWhiteDomainError'](_0x4b5c2e(0x205),_0x4b5c2e(0x222),_0x4b5c2e(0x1fa)+_0x254847);throw new Error('Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20'+_0x1425d3);}console[_0x4b5c2e(0x1eb)](_0x4b5c2e(0x209)),console['log']('Parsed\x20Result:',JSON['stringify'](_0x374684,null,0x2)),loggerService_1[_0x4b5c2e(0x228)][_0x4b5c2e(0x217)](_0x4b5c2e(0x205),_0x4b5c2e(0x222),_0x57781e['status'],_0x374684,_0x4180e3);if(_0x374684[_0x4b5c2e(0x218)]!=='success'){const _0x38532b=_0x374684[_0x4b5c2e(0x219)]||_0x374684[_0x4b5c2e(0x227)]||_0x4b5c2e(0x1ee);console['error'](_0x4b5c2e(0x1f2)),console[_0x4b5c2e(0x227)](_0x4b5c2e(0x211),_0x38532b),loggerService_1[_0x4b5c2e(0x228)][_0x4b5c2e(0x22d)](_0x4b5c2e(0x205),_0x4b5c2e(0x222),_0x4b5c2e(0x23b)+_0x38532b);throw new Error(_0x4b5c2e(0x1ef)+_0x38532b);}if(!_0x374684[_0x4b5c2e(0x220)]?.[_0x4b5c2e(0x233)]||!_0x374684['data']?.[_0x4b5c2e(0x1f1)]){console[_0x4b5c2e(0x227)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4b5c2e(0x227)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x4b5c2e(0x227)](_0x4b5c2e(0x207),_0x374684[_0x4b5c2e(0x220)]),loggerService_1[_0x4b5c2e(0x228)][_0x4b5c2e(0x22d)](_0x4b5c2e(0x205),_0x4b5c2e(0x222),'Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x4b5c2e(0x1eb)](_0x4b5c2e(0x24a)),console[_0x4b5c2e(0x1eb)]('Transaction\x20ID:',_0x374684[_0x4b5c2e(0x220)][_0x4b5c2e(0x233)]),console[_0x4b5c2e(0x1eb)]('Invoice\x20URL:',_0x374684[_0x4b5c2e(0x220)]['invoice_url']),console[_0x4b5c2e(0x1eb)](_0x4b5c2e(0x22f),_0x44ba36,_0x2a3d1e),_0x39fd18&&(console[_0x4b5c2e(0x1eb)](_0x4b5c2e(0x20b),_0x39fd18,_0x4b5c2e(0x1f7)),console['log'](_0x4b5c2e(0x223),_0x2a3d1e,_0x4b5c2e(0x213))),{'gateway_payment_id':_0x374684[_0x4b5c2e(0x220)][_0x4b5c2e(0x233)],'payment_url':_0x374684['data'][_0x4b5c2e(0x1f1)],'invoice_total_sum':_0x374684[_0x4b5c2e(0x220)][_0x4b5c2e(0x246)],'qr_code':_0x374684['data'][_0x4b5c2e(0x1ea)],'qr_url':_0x374684[_0x4b5c2e(0x220)][_0x4b5c2e(0x231)]};}catch(_0x460067){console['error'](_0x4b5c2e(0x21d)),console[_0x4b5c2e(0x227)](_0x4b5c2e(0x240),_0x460067),loggerService_1[_0x4b5c2e(0x228)][_0x4b5c2e(0x22d)](_0x4b5c2e(0x205),_0x4b5c2e(0x222),_0x460067);if(_0x460067 instanceof Error){console[_0x4b5c2e(0x227)](_0x4b5c2e(0x237),_0x460067[_0x4b5c2e(0x219)]),console[_0x4b5c2e(0x227)]('Error\x20stack:',_0x460067[_0x4b5c2e(0x1f3)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x460067[_0x4b5c2e(0x219)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a44_0x5ee3b7(0x20e)](_0x5a8300){const _0x2bba42=a44_0x5ee3b7,_0x5b4503=Date['now']();try{if(!this[_0x2bba42(0x24e)])throw new Error(_0x2bba42(0x251));const _0x46c2fa=new URLSearchParams({'api_key':this[_0x2bba42(0x24e)],'txn_id':_0x5a8300}),_0x2cd3e3=_0x2bba42(0x239)+_0x5a8300+'?'+_0x46c2fa[_0x2bba42(0x20d)]();loggerService_1['loggerService'][_0x2bba42(0x23a)](_0x2bba42(0x205),_0x2bba42(0x206)+_0x5a8300,_0x2bba42(0x202),Object[_0x2bba42(0x23e)](_0x46c2fa['entries']()));const _0x454c78=await fetch(_0x2cd3e3,{'method':_0x2bba42(0x202),'headers':{'Accept':_0x2bba42(0x1f9),'User-Agent':_0x2bba42(0x249)}}),_0x5add3d=Date['now']()-_0x5b4503;if(!_0x454c78['ok']){const _0x3f3034=await _0x454c78[_0x2bba42(0x203)]();loggerService_1[_0x2bba42(0x228)][_0x2bba42(0x217)](_0x2bba42(0x205),_0x2bba42(0x206)+_0x5a8300,_0x454c78['status'],_0x3f3034,_0x5add3d);throw new Error(_0x2bba42(0x232)+_0x454c78[_0x2bba42(0x218)]);}const _0x178d92=await _0x454c78[_0x2bba42(0x20c)]();loggerService_1[_0x2bba42(0x228)][_0x2bba42(0x217)]('plisio_direct',_0x2bba42(0x206)+_0x5a8300,_0x454c78['status'],_0x178d92,_0x5add3d);if(_0x178d92[_0x2bba42(0x218)]!=='success'){loggerService_1[_0x2bba42(0x228)]['logWhiteDomainError']('plisio_direct',_0x2bba42(0x206)+_0x5a8300,_0x2bba42(0x1ef)+(_0x178d92[_0x2bba42(0x219)]||_0x178d92[_0x2bba42(0x227)]||_0x2bba42(0x229)));throw new Error(_0x2bba42(0x1ef)+(_0x178d92[_0x2bba42(0x219)]||_0x178d92['error']||_0x2bba42(0x229)));}let _0x1f330b=_0x2bba42(0x1ed);return{'status':_0x1f330b};}catch(_0x190711){console[_0x2bba42(0x227)](_0x2bba42(0x1f5),_0x190711),loggerService_1[_0x2bba42(0x228)]['logWhiteDomainError'](_0x2bba42(0x205),_0x2bba42(0x206)+_0x5a8300,_0x190711);throw new Error(_0x2bba42(0x22a)+(_0x190711 instanceof Error?_0x190711[_0x2bba42(0x219)]:_0x2bba42(0x229)));}}async[a44_0x5ee3b7(0x1e5)](_0x1082dd){const _0x543cd0=a44_0x5ee3b7;console[_0x543cd0(0x1eb)]('Processing\x20Plisio\x20webhook:',_0x1082dd);let _0x270bc0=_0x543cd0(0x1ed);switch(_0x1082dd['status']?.[_0x543cd0(0x238)]()){case'completed':case'mismatch':_0x270bc0='PAID';break;case _0x543cd0(0x214):_0x270bc0=_0x543cd0(0x1fd);break;case _0x543cd0(0x227):case'cancelled':_0x270bc0=_0x543cd0(0x24c);break;case'new':case _0x543cd0(0x245):default:_0x270bc0='PENDING';break;}let _0x415b85;if(_0x1082dd[_0x543cd0(0x215)])try{console[_0x543cd0(0x1eb)](_0x543cd0(0x248),_0x1082dd[_0x543cd0(0x215)]);let _0x243710;if(typeof _0x1082dd['tx_urls']===_0x543cd0(0x221))_0x243710=JSON[_0x543cd0(0x235)](_0x1082dd[_0x543cd0(0x215)]);else Array[_0x543cd0(0x216)](_0x1082dd[_0x543cd0(0x215)])?_0x243710=_0x1082dd[_0x543cd0(0x215)]:_0x243710=[];_0x415b85=_0x243710[_0x543cd0(0x20f)](_0x522e81=>{const _0x2ca52d=_0x543cd0,_0x50a640=_0x522e81[_0x2ca52d(0x24d)](/\\/g,'');return console[_0x2ca52d(0x1eb)](_0x2ca52d(0x23f)+_0x522e81+_0x2ca52d(0x204)+_0x50a640),_0x50a640;}),console[_0x543cd0(0x1eb)](_0x543cd0(0x24b),_0x415b85),_0x415b85[_0x543cd0(0x250)]((_0x5c016,_0x4a9ce2)=>{const _0x725c3d=_0x543cd0;try{new URL(_0x5c016),console[_0x725c3d(0x1eb)](_0x725c3d(0x212)+(_0x4a9ce2+0x1)+_0x725c3d(0x200)+_0x5c016);}catch(_0x1129af){console[_0x725c3d(0x227)]('❌\x20URL\x20'+(_0x4a9ce2+0x1)+_0x725c3d(0x22b)+_0x5c016,_0x1129af);}});}catch(_0xf7f4e6){console[_0x543cd0(0x227)](_0x543cd0(0x1ec),_0xf7f4e6),console[_0x543cd0(0x227)](_0x543cd0(0x241),_0x1082dd[_0x543cd0(0x215)]),_0x415b85=undefined;}return{'paymentId':_0x1082dd[_0x543cd0(0x243)]||'','status':_0x270bc0,'amount':_0x1082dd[_0x543cd0(0x21a)],'currency':_0x1082dd['currency'],'txUrls':_0x415b85};}}exports['PlisioService']=PlisioService;function a44_0x2b8f(_0x35ce0e,_0x113740){const _0x509a11=a44_0x509a();return a44_0x2b8f=function(_0x2b8f35,_0x37401f){_0x2b8f35=_0x2b8f35-0x1e3;let _0xb11568=_0x509a11[_0x2b8f35];return _0xb11568;},a44_0x2b8f(_0x35ce0e,_0x113740);}function a44_0x509a(){const _0x4bec8c=['logWhiteDomainError','https://api.trapay.uk/api/webhooks/gateway/plisio','Amount:','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','qr_url','HTTP\x20error!\x20status:\x20','txn_id','16JiUGpU','parse','429jKGLQJ','Error\x20message:','toLowerCase','https://api.plisio.net/api/v1/operations/','logWhiteDomainRequest','Business\x20Error:\x20','apiUrl','479194tMDhPz','fromEntries','🔗\x20Formatted\x20URL:\x20','Error\x20details:','Raw\x20tx_urls\x20data:','2099925LDEXiX','order_number','Response\x20Body:','pending','invoice_total_sum',',\x20body:\x20','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','TesSoft\x20Payment\x20System/1.0','===\x20PLISIO\x20SUCCESS\x20===','✅\x20Processed\x20tx_urls:','FAILED','replace','apiKey','source_currency','forEach','Plisio\x20API\x20key\x20is\x20not\x20configured','append','6HdzlSm','processWebhook','statusText','35FadKBB','198066SLgSte','now','qr_code','log','❌\x20Failed\x20to\x20parse\x20tx_urls:','PENDING','Unknown\x20error\x20from\x20Plisio\x20API','Plisio\x20API\x20error:\x20','__esModule','invoice_url','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','stack','287608upBfJq','Plisio\x20payment\x20verification\x20error:','warn','(crypto\x20for\x20payment)','119650LGiRRQ','application/json','JSON\x20Parse\x20Error:\x20','defineProperty','152795xqyCmn','EXPIRED','HIDDEN','Status:','\x20is\x20valid:\x20','1249530rQFcaS','GET','text','\x20->\x20','plisio_direct','/operations/','Response\x20data:','createPayment','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','Status\x20Text:','Source\x20Currency:','json','toString','verifyPayment','map','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20Message:','✅\x20URL\x20','(fiat\x20for\x20merchant)','expired','tx_urls','isArray','logWhiteDomainResponse','status','message','amount','URL:','currency','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','env','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','data','string','/invoices/new','Target\x20Currency:','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','email','HTTP\x20','error','loggerService','Unknown\x20error','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','\x20is\x20invalid:\x20','entries'];a44_0x509a=function(){return _0x4bec8c;};return a44_0x509a();}