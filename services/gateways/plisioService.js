'use strict';const a51_0x5b4f23=a51_0x5287;(function(_0x4ae828,_0x5a2b40){const _0xb7cac2=a51_0x5287,_0x3bcfec=_0x4ae828();while(!![]){try{const _0x373c4f=parseInt(_0xb7cac2(0x1e7))/0x1+parseInt(_0xb7cac2(0x1fd))/0x2*(parseInt(_0xb7cac2(0x204))/0x3)+parseInt(_0xb7cac2(0x22c))/0x4+parseInt(_0xb7cac2(0x22d))/0x5*(-parseInt(_0xb7cac2(0x21a))/0x6)+-parseInt(_0xb7cac2(0x1da))/0x7+parseInt(_0xb7cac2(0x20d))/0x8*(-parseInt(_0xb7cac2(0x1ed))/0x9)+-parseInt(_0xb7cac2(0x21f))/0xa*(-parseInt(_0xb7cac2(0x209))/0xb);if(_0x373c4f===_0x5a2b40)break;else _0x3bcfec['push'](_0x3bcfec['shift']());}catch(_0x5ba4fe){_0x3bcfec['push'](_0x3bcfec['shift']());}}}(a51_0x49cd,0x84501));function a51_0x5287(_0x3029d9,_0x153de0){const _0x49cd39=a51_0x49cd();return a51_0x5287=function(_0x5287a2,_0x26fa91){_0x5287a2=_0x5287a2-0x1cd;let _0x23dc49=_0x49cd39[_0x5287a2];return _0x23dc49;},a51_0x5287(_0x3029d9,_0x153de0);}Object['defineProperty'](exports,a51_0x5b4f23(0x225),{'value':!![]}),exports[a51_0x5b4f23(0x1f1)]=void 0x0;const loggerService_1=require(a51_0x5b4f23(0x1e3));function a51_0x49cd(){const _0x5b53c5=['invoice_url','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','❌\x20URL\x20','PAID','7215047wJDyMF','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','text','logWhiteDomainRequest','warn','now','processWebhook','Amount:','EXPIRED','../loggerService','plisio_direct','Status:','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','697853TipPcr','new','apiKey','toString','TesSoft\x20Payment\x20System/1.0','Plisio\x20API\x20key\x20is\x20not\x20configured','1235205pnxfUI','expired','Business\x20Error:\x20','Invoice\x20URL:','PlisioService','Unknown\x20error','✅\x20Processed\x20tx_urls:','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','logWhiteDomainResponse','/operations/','Unknown\x20error\x20from\x20Plisio\x20API','toLowerCase','URL:','https://api.plisio.net/api/v1/invoices/new','===\x20PLISIO\x20SUCCESS\x20===','env','466510uvjErq','mismatch','Parameters:','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','cancelled','tx_urls','pending','9ImeZVz','JSON\x20Parse\x20Error:\x20','Error\x20message:','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','9482671SOLqLa','https://api.trapay.uk/api/webhooks/gateway/plisio','Plisio\x20API\x20error:\x20','PENDING','8xSNIKT','success','order_number','amount','/invoices/new','loggerService','HTTP\x20','verifyPayment','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','parse','Failed\x20to\x20create\x20Plisio\x20payment:\x20','replace','(crypto\x20for\x20payment)','5103372qsdJfM','logWhiteDomainError','error','\x20is\x20invalid:\x20','Processing\x20Plisio\x20webhook:','10IoNNqu','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','message','txn_id','PLISIO_API_KEY','Full\x20URL\x20(without\x20API\x20key):','__esModule','Target\x20Currency:','status','entries','apiUrl','(fiat\x20for\x20merchant)','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','1203208jbMcco','5REdyAG','Response\x20Time:','\x20is\x20valid:\x20','name','Raw\x20tx_urls\x20data:','FAILED','invoice_total_sum','✅\x20URL\x20','currency','forEach','source_amount','stringify','🔗\x20Formatted\x20URL:\x20','Response\x20data:','\x20->\x20','data','statusText','fromEntries','GET','Error\x20stack:','isArray','qr_url','append','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','application/json','Failed\x20to\x20parse\x20JSON\x20response:','source_currency','Response\x20Body:','json','log',',\x20body:\x20','createPayment'];a51_0x49cd=function(){return _0x5b53c5;};return a51_0x49cd();}class PlisioService{constructor(){const _0x50cfd4=a51_0x5b4f23;this[_0x50cfd4(0x229)]=_0x50cfd4(0x1fa),this[_0x50cfd4(0x1e9)]=process[_0x50cfd4(0x1fc)][_0x50cfd4(0x223)]||'',!this[_0x50cfd4(0x1e9)]?console[_0x50cfd4(0x1de)](_0x50cfd4(0x1e6)):console['log']('💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a51_0x5b4f23(0x1d5)](_0x18379b){const _0x2af6b3=a51_0x5b4f23,{orderId:_0x573a2c,amount:_0x5e1627,currency:_0x36fa5e,productName:_0x30a68e,description:_0x10f0b5,successUrl:_0x2c9eb5,failUrl:_0x58029a,customerEmail:_0x4e508d,customerName:_0xf1028,isSourceCurrency:_0x437c61,sourceCurrency:_0x3ae670}=_0x18379b;if(!this[_0x2af6b3(0x1e9)])throw new Error(_0x2af6b3(0x1ec));const _0x4adc87=new URLSearchParams({'api_key':this['apiKey'],'order_number':_0x573a2c,'order_name':_0x30a68e,'description':_0x10f0b5,'success_url':_0x2c9eb5,'fail_url':_0x58029a,'callback_url':_0x2af6b3(0x20a)});_0x3ae670?(_0x4adc87[_0x2af6b3(0x243)]('currency',_0x3ae670),_0x4adc87['append'](_0x2af6b3(0x1d0),_0x36fa5e),_0x4adc87[_0x2af6b3(0x243)](_0x2af6b3(0x237),_0x5e1627[_0x2af6b3(0x1ea)]())):(_0x4adc87['append']('currency',_0x36fa5e),_0x4adc87[_0x2af6b3(0x243)](_0x2af6b3(0x210),_0x5e1627[_0x2af6b3(0x1ea)]()));_0x4e508d&&_0x4adc87[_0x2af6b3(0x243)]('email',_0x4e508d);_0xf1028&&_0x4adc87[_0x2af6b3(0x243)](_0x2af6b3(0x230),_0xf1028);const _0x324b70=this['apiUrl']+'?'+_0x4adc87[_0x2af6b3(0x1ea)](),_0x1c5330=Date['now']();try{console[_0x2af6b3(0x1d3)](_0x2af6b3(0x215)),console[_0x2af6b3(0x1d3)](_0x2af6b3(0x1f9),this[_0x2af6b3(0x229)]),console[_0x2af6b3(0x1d3)](_0x2af6b3(0x1ff),Object[_0x2af6b3(0x23e)](_0x4adc87[_0x2af6b3(0x228)]())),console['log'](_0x2af6b3(0x224),_0x324b70[_0x2af6b3(0x218)](this[_0x2af6b3(0x1e9)],'HIDDEN')),loggerService_1['loggerService'][_0x2af6b3(0x1dd)](_0x2af6b3(0x1e4),_0x2af6b3(0x211),_0x2af6b3(0x23f),Object[_0x2af6b3(0x23e)](_0x4adc87[_0x2af6b3(0x228)]()));const _0x2f6aea=await fetch(_0x324b70,{'method':_0x2af6b3(0x23f),'headers':{'Accept':_0x2af6b3(0x1ce),'User-Agent':_0x2af6b3(0x1eb)}}),_0x35d243=Date[_0x2af6b3(0x1df)]()-_0x1c5330;console[_0x2af6b3(0x1d3)](_0x2af6b3(0x1cd)),console[_0x2af6b3(0x1d3)](_0x2af6b3(0x1e5),_0x2f6aea[_0x2af6b3(0x227)]),console[_0x2af6b3(0x1d3)]('Status\x20Text:',_0x2f6aea[_0x2af6b3(0x23d)]),console[_0x2af6b3(0x1d3)](_0x2af6b3(0x22e),_0x35d243+'ms');const _0x5b3d91=await _0x2f6aea[_0x2af6b3(0x1dc)]();console[_0x2af6b3(0x1d3)]('Raw\x20Response\x20Body:',_0x5b3d91);if(!_0x2f6aea['ok']){console[_0x2af6b3(0x21c)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x2af6b3(0x21c)]('HTTP\x20Status:',_0x2f6aea[_0x2af6b3(0x227)]),console['error'](_0x2af6b3(0x1d1),_0x5b3d91),loggerService_1[_0x2af6b3(0x212)][_0x2af6b3(0x1f5)]('plisio_direct','/invoices/new',_0x2f6aea['status'],_0x5b3d91,_0x35d243),loggerService_1['loggerService']['logWhiteDomainError']('plisio_direct','/invoices/new',_0x2af6b3(0x213)+_0x2f6aea[_0x2af6b3(0x227)]+':\x20'+_0x5b3d91);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2f6aea[_0x2af6b3(0x227)]+_0x2af6b3(0x1d4)+_0x5b3d91);}let _0x5aab5a;try{_0x5aab5a=JSON['parse'](_0x5b3d91);}catch(_0x472518){console['error'](_0x2af6b3(0x1cf),_0x472518),loggerService_1['loggerService'][_0x2af6b3(0x21b)](_0x2af6b3(0x1e4),_0x2af6b3(0x211),_0x2af6b3(0x205)+_0x472518);throw new Error(_0x2af6b3(0x220)+_0x5b3d91);}console['log']('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x2af6b3(0x1d3)]('Parsed\x20Result:',JSON[_0x2af6b3(0x238)](_0x5aab5a,null,0x2)),loggerService_1[_0x2af6b3(0x212)]['logWhiteDomainResponse'](_0x2af6b3(0x1e4),_0x2af6b3(0x211),_0x2f6aea[_0x2af6b3(0x227)],_0x5aab5a,_0x35d243);if(_0x5aab5a['status']!==_0x2af6b3(0x20e)){const _0x3c9799=_0x5aab5a['message']||_0x5aab5a[_0x2af6b3(0x21c)]||_0x2af6b3(0x1f7);console[_0x2af6b3(0x21c)](_0x2af6b3(0x200)),console[_0x2af6b3(0x21c)]('Error\x20Message:',_0x3c9799),loggerService_1[_0x2af6b3(0x212)][_0x2af6b3(0x21b)](_0x2af6b3(0x1e4),'/invoices/new',_0x2af6b3(0x1ef)+_0x3c9799);throw new Error(_0x2af6b3(0x20b)+_0x3c9799);}if(!_0x5aab5a[_0x2af6b3(0x23c)]?.[_0x2af6b3(0x222)]||!_0x5aab5a[_0x2af6b3(0x23c)]?.[_0x2af6b3(0x1d6)]){console['error'](_0x2af6b3(0x1db)),console[_0x2af6b3(0x21c)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x2af6b3(0x21c)](_0x2af6b3(0x23a),_0x5aab5a[_0x2af6b3(0x23c)]),loggerService_1[_0x2af6b3(0x212)][_0x2af6b3(0x21b)](_0x2af6b3(0x1e4),'/invoices/new','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error(_0x2af6b3(0x1d7));}return console[_0x2af6b3(0x1d3)](_0x2af6b3(0x1fb)),console[_0x2af6b3(0x1d3)]('Transaction\x20ID:',_0x5aab5a[_0x2af6b3(0x23c)][_0x2af6b3(0x222)]),console[_0x2af6b3(0x1d3)](_0x2af6b3(0x1f0),_0x5aab5a['data']['invoice_url']),console[_0x2af6b3(0x1d3)](_0x2af6b3(0x1e1),_0x5e1627,_0x36fa5e),_0x3ae670&&(console[_0x2af6b3(0x1d3)]('Source\x20Currency:',_0x3ae670,_0x2af6b3(0x219)),console[_0x2af6b3(0x1d3)](_0x2af6b3(0x226),_0x36fa5e,_0x2af6b3(0x22a))),{'gateway_payment_id':_0x5aab5a[_0x2af6b3(0x23c)][_0x2af6b3(0x222)],'payment_url':_0x5aab5a[_0x2af6b3(0x23c)][_0x2af6b3(0x1d6)],'invoice_total_sum':_0x5aab5a['data'][_0x2af6b3(0x233)],'qr_code':_0x5aab5a[_0x2af6b3(0x23c)]['qr_code'],'qr_url':_0x5aab5a[_0x2af6b3(0x23c)][_0x2af6b3(0x242)]};}catch(_0x40d881){console[_0x2af6b3(0x21c)](_0x2af6b3(0x208)),console[_0x2af6b3(0x21c)]('Error\x20details:',_0x40d881),loggerService_1[_0x2af6b3(0x212)][_0x2af6b3(0x21b)](_0x2af6b3(0x1e4),'/invoices/new',_0x40d881);if(_0x40d881 instanceof Error){console[_0x2af6b3(0x21c)](_0x2af6b3(0x206),_0x40d881[_0x2af6b3(0x221)]),console['error'](_0x2af6b3(0x240),_0x40d881['stack']);throw new Error(_0x2af6b3(0x217)+_0x40d881[_0x2af6b3(0x221)]);}throw new Error(_0x2af6b3(0x207));}}async[a51_0x5b4f23(0x214)](_0xc620dd){const _0xf80c54=a51_0x5b4f23,_0x19ae9e=Date[_0xf80c54(0x1df)]();try{if(!this[_0xf80c54(0x1e9)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x5a9086=new URLSearchParams({'api_key':this[_0xf80c54(0x1e9)],'txn_id':_0xc620dd}),_0x40f560='https://api.plisio.net/api/v1/operations/'+_0xc620dd+'?'+_0x5a9086[_0xf80c54(0x1ea)]();loggerService_1[_0xf80c54(0x212)]['logWhiteDomainRequest'](_0xf80c54(0x1e4),_0xf80c54(0x1f6)+_0xc620dd,'GET',Object[_0xf80c54(0x23e)](_0x5a9086['entries']()));const _0x1e2900=await fetch(_0x40f560,{'method':_0xf80c54(0x23f),'headers':{'Accept':_0xf80c54(0x1ce),'User-Agent':_0xf80c54(0x1eb)}}),_0x452a05=Date[_0xf80c54(0x1df)]()-_0x19ae9e;if(!_0x1e2900['ok']){const _0x13c3ec=await _0x1e2900['text']();loggerService_1[_0xf80c54(0x212)][_0xf80c54(0x1f5)](_0xf80c54(0x1e4),_0xf80c54(0x1f6)+_0xc620dd,_0x1e2900[_0xf80c54(0x227)],_0x13c3ec,_0x452a05);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1e2900[_0xf80c54(0x227)]);}const _0x5690e3=await _0x1e2900[_0xf80c54(0x1d2)]();loggerService_1['loggerService'][_0xf80c54(0x1f5)](_0xf80c54(0x1e4),_0xf80c54(0x1f6)+_0xc620dd,_0x1e2900[_0xf80c54(0x227)],_0x5690e3,_0x452a05);if(_0x5690e3[_0xf80c54(0x227)]!==_0xf80c54(0x20e)){loggerService_1[_0xf80c54(0x212)][_0xf80c54(0x21b)]('plisio_direct',_0xf80c54(0x1f6)+_0xc620dd,_0xf80c54(0x20b)+(_0x5690e3[_0xf80c54(0x221)]||_0x5690e3[_0xf80c54(0x21c)]||_0xf80c54(0x1f2)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x5690e3[_0xf80c54(0x221)]||_0x5690e3[_0xf80c54(0x21c)]||_0xf80c54(0x1f2)));}let _0x16f428=_0xf80c54(0x20c);return{'status':_0x16f428};}catch(_0x3dd8f7){console[_0xf80c54(0x21c)]('Plisio\x20payment\x20verification\x20error:',_0x3dd8f7),loggerService_1[_0xf80c54(0x212)]['logWhiteDomainError'](_0xf80c54(0x1e4),'/operations/'+_0xc620dd,_0x3dd8f7);throw new Error(_0xf80c54(0x22b)+(_0x3dd8f7 instanceof Error?_0x3dd8f7[_0xf80c54(0x221)]:_0xf80c54(0x1f2)));}}async[a51_0x5b4f23(0x1e0)](_0x5799c9){const _0x224bb9=a51_0x5b4f23;console['log'](_0x224bb9(0x21e),_0x5799c9);let _0xf3cdb2=_0x224bb9(0x20c);switch(_0x5799c9[_0x224bb9(0x227)]?.[_0x224bb9(0x1f8)]()){case'completed':case _0x224bb9(0x1fe):_0xf3cdb2=_0x224bb9(0x1d9);break;case _0x224bb9(0x1ee):_0xf3cdb2=_0x224bb9(0x1e2);break;case _0x224bb9(0x21c):case _0x224bb9(0x201):_0xf3cdb2=_0x224bb9(0x232);break;case _0x224bb9(0x1e8):_0xf3cdb2='PENDING';break;case _0x224bb9(0x203):_0xf3cdb2='PROCESSING';break;default:_0xf3cdb2=_0x224bb9(0x20c);break;}let _0x24d2b0;if(_0x5799c9[_0x224bb9(0x202)])try{console['log'](_0x224bb9(0x1f4),_0x5799c9[_0x224bb9(0x202)]);let _0x132e0d;if(typeof _0x5799c9[_0x224bb9(0x202)]==='string')_0x132e0d=JSON[_0x224bb9(0x216)](_0x5799c9[_0x224bb9(0x202)]);else Array[_0x224bb9(0x241)](_0x5799c9['tx_urls'])?_0x132e0d=_0x5799c9['tx_urls']:_0x132e0d=[];_0x24d2b0=_0x132e0d['map'](_0x618669=>{const _0x1d6d8f=_0x224bb9,_0x1c8d91=_0x618669[_0x1d6d8f(0x218)](/\\/g,'');return console[_0x1d6d8f(0x1d3)](_0x1d6d8f(0x239)+_0x618669+_0x1d6d8f(0x23b)+_0x1c8d91),_0x1c8d91;}),console[_0x224bb9(0x1d3)](_0x224bb9(0x1f3),_0x24d2b0),_0x24d2b0[_0x224bb9(0x236)]((_0x2a53a2,_0x4a9a62)=>{const _0x113ec7=_0x224bb9;try{new URL(_0x2a53a2),console[_0x113ec7(0x1d3)](_0x113ec7(0x234)+(_0x4a9a62+0x1)+_0x113ec7(0x22f)+_0x2a53a2);}catch(_0x363901){console[_0x113ec7(0x21c)](_0x113ec7(0x1d8)+(_0x4a9a62+0x1)+_0x113ec7(0x21d)+_0x2a53a2,_0x363901);}});}catch(_0x3d845a){console['error']('❌\x20Failed\x20to\x20parse\x20tx_urls:',_0x3d845a),console[_0x224bb9(0x21c)](_0x224bb9(0x231),_0x5799c9[_0x224bb9(0x202)]),_0x24d2b0=undefined;}return{'paymentId':_0x5799c9[_0x224bb9(0x20f)]||'','status':_0xf3cdb2,'amount':_0x5799c9['amount'],'currency':_0x5799c9[_0x224bb9(0x235)],'txUrls':_0x24d2b0};}}exports[a51_0x5b4f23(0x1f1)]=PlisioService;