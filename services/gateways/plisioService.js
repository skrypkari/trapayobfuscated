'use strict';const a41_0x4426ee=a41_0x5cf3;(function(_0x3b1958,_0x4e5e85){const _0x309edf=a41_0x5cf3,_0x478526=_0x3b1958();while(!![]){try{const _0x3b7f59=parseInt(_0x309edf(0x1b7))/0x1+-parseInt(_0x309edf(0x219))/0x2+-parseInt(_0x309edf(0x1c5))/0x3+-parseInt(_0x309edf(0x1bf))/0x4+parseInt(_0x309edf(0x1ed))/0x5+parseInt(_0x309edf(0x20d))/0x6+-parseInt(_0x309edf(0x1cd))/0x7*(-parseInt(_0x309edf(0x1be))/0x8);if(_0x3b7f59===_0x4e5e85)break;else _0x478526['push'](_0x478526['shift']());}catch(_0x12d265){_0x478526['push'](_0x478526['shift']());}}}(a41_0x5aa9,0xdab01));Object[a41_0x4426ee(0x1fc)](exports,a41_0x4426ee(0x1f9),{'value':!![]}),exports[a41_0x4426ee(0x1da)]=void 0x0;function a41_0x5aa9(){const _0x3c432f=['name','stringify','Source\x20Currency:','plisio_direct','PENDING','text','Plisio\x20API\x20error:\x20',',\x20body:\x20','__esModule','apiUrl','env','defineProperty','Error\x20stack:','error','amount','GET','message','now','data','Plisio\x20payment\x20verification\x20error:','application/json','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','invoice_url','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','pending','Status:','Unknown\x20error','createPayment','6139230aNwqhz','===\x20PLISIO\x20API\x20ERROR\x20===','loggerService','Unknown\x20error\x20from\x20Plisio\x20API','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','status','source_amount','/operations/','log','Raw\x20Response\x20Body:','Error\x20Message:','HTTP\x20error!\x20status:\x20','2411554lRcLdC','Response\x20Body:','Processing\x20Plisio\x20webhook:','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','Parameters:','558838auNNGI','Invoice\x20URL:','mismatch','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Plisio\x20API\x20key\x20is\x20not\x20configured','verifyPayment','email','6192424odrBKR','6528aPDPmY','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','processWebhook','append','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','logWhiteDomainRequest','4137348jhwbjC','qr_code','Failed\x20to\x20parse\x20JSON\x20response:','===\x20PLISIO\x20SUCCESS\x20===','order_number','expired','completed','new','7xQOtWZ','EXPIRED','../loggerService','logWhiteDomainResponse','cancelled','Full\x20URL\x20(without\x20API\x20key):','logWhiteDomainError','HTTP\x20','replace','Target\x20Currency:','qr_url','Failed\x20to\x20create\x20Plisio\x20payment:\x20','warn','PlisioService','Amount:','/invoices/new','stack','toLowerCase','https://api.plisio.net/api/v1/invoices/new','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','toString','entries','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','apiKey','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','statusText','Response\x20data:','txn_id','FAILED','TesSoft\x20Payment\x20System/1.0','JSON\x20Parse\x20Error:\x20','https://api.plisio.net/api/v1/operations/','5630870JKSkNe','Error\x20details:','Transaction\x20ID:','Error\x20message:'];a41_0x5aa9=function(){return _0x3c432f;};return a41_0x5aa9();}const loggerService_1=require(a41_0x4426ee(0x1cf));function a41_0x5cf3(_0x286913,_0x3f1ce9){const _0x5aa933=a41_0x5aa9();return a41_0x5cf3=function(_0x5cf3e3,_0x107b0d){_0x5cf3e3=_0x5cf3e3-0x1b6;let _0x3a65c9=_0x5aa933[_0x5cf3e3];return _0x3a65c9;},a41_0x5cf3(_0x286913,_0x3f1ce9);}class PlisioService{constructor(){const _0x58c2bb=a41_0x4426ee;this[_0x58c2bb(0x1fa)]=_0x58c2bb(0x1df),this['apiKey']=process[_0x58c2bb(0x1fb)]['PLISIO_API_KEY']||'',!this['apiKey']?console[_0x58c2bb(0x1d9)]('‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables'):console[_0x58c2bb(0x215)](_0x58c2bb(0x1e0));}async[a41_0x4426ee(0x20c)](_0x468c8b){const _0x32bcf0=a41_0x4426ee,{orderId:_0x2c5460,amount:_0x444f89,currency:_0x4eb93b,productName:_0x1afd65,description:_0x43f0af,successUrl:_0x32a5ca,failUrl:_0x1324fb,customerEmail:_0x2db063,customerName:_0xdcd064,isSourceCurrency:_0x47cf43,sourceCurrency:_0x53a1ae}=_0x468c8b;if(!this['apiKey'])throw new Error(_0x32bcf0(0x1bb));const _0x3c1de8=new URLSearchParams({'api_key':this[_0x32bcf0(0x1e4)],'order_number':_0x2c5460,'order_name':_0x1afd65,'description':_0x43f0af,'success_url':_0x32a5ca,'fail_url':_0x1324fb,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x53a1ae?(_0x3c1de8['append']('currency',_0x53a1ae),_0x3c1de8['append']('source_currency',_0x4eb93b),_0x3c1de8[_0x32bcf0(0x1c2)](_0x32bcf0(0x213),_0x444f89[_0x32bcf0(0x1e1)]())):(_0x3c1de8[_0x32bcf0(0x1c2)]('currency',_0x4eb93b),_0x3c1de8[_0x32bcf0(0x1c2)](_0x32bcf0(0x1ff),_0x444f89['toString']()));_0x2db063&&_0x3c1de8[_0x32bcf0(0x1c2)](_0x32bcf0(0x1bd),_0x2db063);_0xdcd064&&_0x3c1de8['append'](_0x32bcf0(0x1f1),_0xdcd064);const _0x49205a=this[_0x32bcf0(0x1fa)]+'?'+_0x3c1de8[_0x32bcf0(0x1e1)](),_0x45ec6d=Date[_0x32bcf0(0x202)]();try{console[_0x32bcf0(0x215)](_0x32bcf0(0x206)),console[_0x32bcf0(0x215)]('URL:',this[_0x32bcf0(0x1fa)]),console['log'](_0x32bcf0(0x1b6),Object['fromEntries'](_0x3c1de8[_0x32bcf0(0x1e2)]())),console[_0x32bcf0(0x215)](_0x32bcf0(0x1d2),_0x49205a[_0x32bcf0(0x1d5)](this['apiKey'],'HIDDEN')),loggerService_1[_0x32bcf0(0x20f)][_0x32bcf0(0x1c4)]('plisio_direct',_0x32bcf0(0x1dc),_0x32bcf0(0x200),Object['fromEntries'](_0x3c1de8['entries']()));const _0x258266=await fetch(_0x49205a,{'method':_0x32bcf0(0x200),'headers':{'Accept':_0x32bcf0(0x205),'User-Agent':_0x32bcf0(0x1ea)}}),_0x42bec2=Date[_0x32bcf0(0x202)]()-_0x45ec6d;console['log']('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x32bcf0(0x215)](_0x32bcf0(0x20a),_0x258266['status']),console[_0x32bcf0(0x215)]('Status\x20Text:',_0x258266[_0x32bcf0(0x1e6)]),console[_0x32bcf0(0x215)]('Response\x20Time:',_0x42bec2+'ms');const _0x1752e6=await _0x258266[_0x32bcf0(0x1f6)]();console[_0x32bcf0(0x215)](_0x32bcf0(0x216),_0x1752e6);if(!_0x258266['ok']){console[_0x32bcf0(0x1fe)](_0x32bcf0(0x20e)),console[_0x32bcf0(0x1fe)]('HTTP\x20Status:',_0x258266[_0x32bcf0(0x212)]),console[_0x32bcf0(0x1fe)](_0x32bcf0(0x21a),_0x1752e6),loggerService_1['loggerService'][_0x32bcf0(0x1d0)](_0x32bcf0(0x1f4),'/invoices/new',_0x258266[_0x32bcf0(0x212)],_0x1752e6,_0x42bec2),loggerService_1[_0x32bcf0(0x20f)]['logWhiteDomainError']('plisio_direct',_0x32bcf0(0x1dc),_0x32bcf0(0x1d4)+_0x258266[_0x32bcf0(0x212)]+':\x20'+_0x1752e6);throw new Error(_0x32bcf0(0x218)+_0x258266[_0x32bcf0(0x212)]+_0x32bcf0(0x1f8)+_0x1752e6);}let _0x211be3;try{_0x211be3=JSON['parse'](_0x1752e6);}catch(_0x217c36){console[_0x32bcf0(0x1fe)](_0x32bcf0(0x1c7),_0x217c36),loggerService_1[_0x32bcf0(0x20f)][_0x32bcf0(0x1d3)](_0x32bcf0(0x1f4),'/invoices/new',_0x32bcf0(0x1eb)+_0x217c36);throw new Error(_0x32bcf0(0x1c3)+_0x1752e6);}console['log'](_0x32bcf0(0x208)),console[_0x32bcf0(0x215)]('Parsed\x20Result:',JSON[_0x32bcf0(0x1f2)](_0x211be3,null,0x2)),loggerService_1[_0x32bcf0(0x20f)][_0x32bcf0(0x1d0)]('plisio_direct','/invoices/new',_0x258266[_0x32bcf0(0x212)],_0x211be3,_0x42bec2);if(_0x211be3[_0x32bcf0(0x212)]!=='success'){const _0x349bca=_0x211be3[_0x32bcf0(0x201)]||_0x211be3[_0x32bcf0(0x1fe)]||_0x32bcf0(0x210);console['error'](_0x32bcf0(0x211)),console[_0x32bcf0(0x1fe)](_0x32bcf0(0x217),_0x349bca),loggerService_1[_0x32bcf0(0x20f)][_0x32bcf0(0x1d3)](_0x32bcf0(0x1f4),_0x32bcf0(0x1dc),'Business\x20Error:\x20'+_0x349bca);throw new Error(_0x32bcf0(0x1f7)+_0x349bca);}if(!_0x211be3[_0x32bcf0(0x203)]?.[_0x32bcf0(0x1e8)]||!_0x211be3[_0x32bcf0(0x203)]?.[_0x32bcf0(0x207)]){console[_0x32bcf0(0x1fe)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x32bcf0(0x1fe)](_0x32bcf0(0x1e3)),console[_0x32bcf0(0x1fe)](_0x32bcf0(0x1e7),_0x211be3[_0x32bcf0(0x203)]),loggerService_1[_0x32bcf0(0x20f)][_0x32bcf0(0x1d3)]('plisio_direct',_0x32bcf0(0x1dc),_0x32bcf0(0x1e5));throw new Error(_0x32bcf0(0x1c0));}return console['log'](_0x32bcf0(0x1c8)),console[_0x32bcf0(0x215)](_0x32bcf0(0x1ef),_0x211be3[_0x32bcf0(0x203)][_0x32bcf0(0x1e8)]),console[_0x32bcf0(0x215)](_0x32bcf0(0x1b8),_0x211be3[_0x32bcf0(0x203)]['invoice_url']),console['log'](_0x32bcf0(0x1db),_0x444f89,_0x4eb93b),_0x53a1ae&&(console[_0x32bcf0(0x215)](_0x32bcf0(0x1f3),_0x53a1ae,'(crypto\x20for\x20payment)'),console['log'](_0x32bcf0(0x1d6),_0x4eb93b,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x211be3[_0x32bcf0(0x203)][_0x32bcf0(0x1e8)],'payment_url':_0x211be3[_0x32bcf0(0x203)][_0x32bcf0(0x207)],'invoice_total_sum':_0x211be3['data']['invoice_total_sum'],'qr_code':_0x211be3[_0x32bcf0(0x203)][_0x32bcf0(0x1c6)],'qr_url':_0x211be3[_0x32bcf0(0x203)][_0x32bcf0(0x1d7)]};}catch(_0x1f4f37){console[_0x32bcf0(0x1fe)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console['error'](_0x32bcf0(0x1ee),_0x1f4f37),loggerService_1[_0x32bcf0(0x20f)][_0x32bcf0(0x1d3)](_0x32bcf0(0x1f4),_0x32bcf0(0x1dc),_0x1f4f37);if(_0x1f4f37 instanceof Error){console[_0x32bcf0(0x1fe)](_0x32bcf0(0x1f0),_0x1f4f37[_0x32bcf0(0x201)]),console[_0x32bcf0(0x1fe)](_0x32bcf0(0x1fd),_0x1f4f37[_0x32bcf0(0x1dd)]);throw new Error(_0x32bcf0(0x1d8)+_0x1f4f37[_0x32bcf0(0x201)]);}throw new Error(_0x32bcf0(0x21c));}}async[a41_0x4426ee(0x1bc)](_0x5ea032){const _0x1065a9=a41_0x4426ee,_0x3706e8=Date['now']();try{if(!this['apiKey'])throw new Error(_0x1065a9(0x1bb));const _0x5ae4d8=new URLSearchParams({'api_key':this[_0x1065a9(0x1e4)],'txn_id':_0x5ea032}),_0x1dd81b=_0x1065a9(0x1ec)+_0x5ea032+'?'+_0x5ae4d8[_0x1065a9(0x1e1)]();loggerService_1[_0x1065a9(0x20f)][_0x1065a9(0x1c4)](_0x1065a9(0x1f4),_0x1065a9(0x214)+_0x5ea032,_0x1065a9(0x200),Object['fromEntries'](_0x5ae4d8[_0x1065a9(0x1e2)]()));const _0x314731=await fetch(_0x1dd81b,{'method':_0x1065a9(0x200),'headers':{'Accept':_0x1065a9(0x205),'User-Agent':_0x1065a9(0x1ea)}}),_0x3e26ff=Date['now']()-_0x3706e8;if(!_0x314731['ok']){const _0x4a0b34=await _0x314731[_0x1065a9(0x1f6)]();loggerService_1[_0x1065a9(0x20f)][_0x1065a9(0x1d0)](_0x1065a9(0x1f4),_0x1065a9(0x214)+_0x5ea032,_0x314731[_0x1065a9(0x212)],_0x4a0b34,_0x3e26ff);throw new Error('HTTP\x20error!\x20status:\x20'+_0x314731['status']);}const _0x3f1e2a=await _0x314731['json']();loggerService_1[_0x1065a9(0x20f)][_0x1065a9(0x1d0)](_0x1065a9(0x1f4),_0x1065a9(0x214)+_0x5ea032,_0x314731['status'],_0x3f1e2a,_0x3e26ff);if(_0x3f1e2a['status']!=='success'){loggerService_1[_0x1065a9(0x20f)]['logWhiteDomainError']('plisio_direct','/operations/'+_0x5ea032,_0x1065a9(0x1f7)+(_0x3f1e2a[_0x1065a9(0x201)]||_0x3f1e2a['error']||_0x1065a9(0x20b)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x3f1e2a[_0x1065a9(0x201)]||_0x3f1e2a[_0x1065a9(0x1fe)]||_0x1065a9(0x20b)));}let _0x29f903=_0x1065a9(0x1f5);return{'status':_0x29f903};}catch(_0x23be1f){console['error'](_0x1065a9(0x204),_0x23be1f),loggerService_1[_0x1065a9(0x20f)][_0x1065a9(0x1d3)](_0x1065a9(0x1f4),_0x1065a9(0x214)+_0x5ea032,_0x23be1f);throw new Error(_0x1065a9(0x1ba)+(_0x23be1f instanceof Error?_0x23be1f[_0x1065a9(0x201)]:_0x1065a9(0x20b)));}}async[a41_0x4426ee(0x1c1)](_0x4a2e95){const _0x41c8e3=a41_0x4426ee;console[_0x41c8e3(0x215)](_0x41c8e3(0x21b),_0x4a2e95);let _0x5ca892=_0x41c8e3(0x1f5);switch(_0x4a2e95[_0x41c8e3(0x212)]?.[_0x41c8e3(0x1de)]()){case _0x41c8e3(0x1cb):case _0x41c8e3(0x1b9):_0x5ca892='PAID';break;case _0x41c8e3(0x1ca):_0x5ca892=_0x41c8e3(0x1ce);break;case _0x41c8e3(0x1fe):case _0x41c8e3(0x1d1):_0x5ca892=_0x41c8e3(0x1e9);break;case _0x41c8e3(0x1cc):case _0x41c8e3(0x209):default:_0x5ca892=_0x41c8e3(0x1f5);break;}return{'paymentId':_0x4a2e95[_0x41c8e3(0x1c9)]||'','status':_0x5ca892,'amount':_0x4a2e95[_0x41c8e3(0x1ff)],'currency':_0x4a2e95['currency']};}}exports['PlisioService']=PlisioService;