'use strict';const a49_0x39d748=a49_0x3883;(function(_0x14dda3,_0x3a8566){const _0xdf2cbc=a49_0x3883,_0xa5a07e=_0x14dda3();while(!![]){try{const _0x3195d6=-parseInt(_0xdf2cbc(0x142))/0x1*(parseInt(_0xdf2cbc(0x159))/0x2)+parseInt(_0xdf2cbc(0x16b))/0x3*(-parseInt(_0xdf2cbc(0x118))/0x4)+-parseInt(_0xdf2cbc(0x11d))/0x5+-parseInt(_0xdf2cbc(0x163))/0x6+parseInt(_0xdf2cbc(0x14d))/0x7+parseInt(_0xdf2cbc(0x107))/0x8+-parseInt(_0xdf2cbc(0x102))/0x9*(-parseInt(_0xdf2cbc(0x120))/0xa);if(_0x3195d6===_0x3a8566)break;else _0xa5a07e['push'](_0xa5a07e['shift']());}catch(_0x4de9dc){_0xa5a07e['push'](_0xa5a07e['shift']());}}}(a49_0x2d25,0x7803a));Object['defineProperty'](exports,a49_0x39d748(0x114),{'value':!![]}),exports[a49_0x39d748(0x15e)]=void 0x0;const loggerService_1=require('../loggerService');function a49_0x2d25(){const _0x4d792d=['logWhiteDomainRequest','HIDDEN','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Parsed\x20Result:','773898rgXkRG','success','Response\x20Time:','completed','createPayment','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','===\x20PLISIO\x20API\x20ERROR\x20===','Raw\x20tx_urls\x20data:','9PLKXxh','processWebhook','\x20->\x20','Failed\x20to\x20create\x20Plisio\x20payment:\x20','PENDING','Error\x20stack:','/invoices/new','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','log','/operations/','error','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','text','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','verifyPayment','Target\x20Currency:','invoice_total_sum','477UxOzfh','amount','Error\x20message:','HTTP\x20error!\x20status:\x20','GET','6494904AkrEOl','append','env','(crypto\x20for\x20payment)','message','PROCESSING','tx_urls','\x20is\x20invalid:\x20','txn_id','EXPIRED','Business\x20Error:\x20','logWhiteDomainError','JSON\x20Parse\x20Error:\x20','__esModule','Plisio\x20API\x20key\x20is\x20not\x20configured','qr_url','Invoice\x20URL:','481576NtbWXS','Error\x20Message:','plisio_direct','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','isArray','2156055XvzxUk','Error\x20details:','apiKey','121100vvhJWT','stringify','\x20is\x20valid:\x20','json','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','loggerService','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','order_number','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','TesSoft\x20Payment\x20System/1.0','Plisio\x20API\x20error:\x20','Plisio\x20payment\x20verification\x20error:','Failed\x20to\x20parse\x20JSON\x20response:','email','Unknown\x20error','https://api.trapay.uk/api/webhooks/gateway/plisio','PAID','apiUrl','fromEntries','https://api.plisio.net/api/v1/operations/','Unknown\x20error\x20from\x20Plisio\x20API','statusText','Response\x20data:','parse','source_amount','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','‚úÖ\x20Processed\x20tx_urls:','Source\x20Currency:','entries','URL:','application/json','invoice_url','https://api.plisio.net/api/v1/invoices/new','Response\x20Body:','277370iuHKAN','forEach','cancelled','now','data','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','map','üîó\x20Formatted\x20URL:\x20',',\x20body:\x20','Status\x20Text:','source_currency','5539597AnKNDY','(fiat\x20for\x20merchant)','stack','‚ùå\x20URL\x20','HTTP\x20','HTTP\x20Status:','===\x20PLISIO\x20SUCCESS\x20===','Full\x20URL\x20(without\x20API\x20key):','logWhiteDomainResponse','replace','status','currency','6SgSMqG','FAILED','expired','Processing\x20Plisio\x20webhook:','toString','PlisioService'];a49_0x2d25=function(){return _0x4d792d;};return a49_0x2d25();}class PlisioService{constructor(){const _0x425fd5=a49_0x39d748;this['apiUrl']=_0x425fd5(0x140),this[_0x425fd5(0x11f)]=process[_0x425fd5(0x109)]['PLISIO_API_KEY']||'',!this['apiKey']?console['warn'](_0x425fd5(0x168)):console['log']('üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API');}async[a49_0x39d748(0x167)](_0x42b075){const _0x340f3e=a49_0x39d748,{orderId:_0x4bcf1f,amount:_0x415008,currency:_0x1e66ec,productName:_0x30e59a,description:_0x5eb43c,successUrl:_0x3c31ea,failUrl:_0x280b54,customerEmail:_0x3c42f1,customerName:_0x53f7a6,isSourceCurrency:_0x4d7dcb,sourceCurrency:_0x4d2eb6}=_0x42b075;if(!this['apiKey'])throw new Error(_0x340f3e(0x115));const _0x1fde0b=new URLSearchParams({'api_key':this[_0x340f3e(0x11f)],'order_number':_0x4bcf1f,'order_name':_0x30e59a,'description':_0x5eb43c,'success_url':_0x3c31ea,'fail_url':_0x280b54,'callback_url':_0x340f3e(0x12f)});_0x4d2eb6?(_0x1fde0b[_0x340f3e(0x108)](_0x340f3e(0x158),_0x4d2eb6),_0x1fde0b['append'](_0x340f3e(0x14c),_0x1e66ec),_0x1fde0b[_0x340f3e(0x108)](_0x340f3e(0x138),_0x415008[_0x340f3e(0x15d)]())):(_0x1fde0b['append']('currency',_0x1e66ec),_0x1fde0b[_0x340f3e(0x108)](_0x340f3e(0x103),_0x415008[_0x340f3e(0x15d)]()));_0x3c42f1&&_0x1fde0b['append'](_0x340f3e(0x12d),_0x3c42f1);_0x53f7a6&&_0x1fde0b['append']('name',_0x53f7a6);const _0x18a190=this[_0x340f3e(0x131)]+'?'+_0x1fde0b[_0x340f3e(0x15d)](),_0x1eefb7=Date['now']();try{console['log'](_0x340f3e(0xfe)),console[_0x340f3e(0x173)](_0x340f3e(0x13d),this[_0x340f3e(0x131)]),console['log']('Parameters:',Object['fromEntries'](_0x1fde0b[_0x340f3e(0x13c)]())),console[_0x340f3e(0x173)](_0x340f3e(0x154),_0x18a190['replace'](this[_0x340f3e(0x11f)],_0x340f3e(0x160))),loggerService_1[_0x340f3e(0x125)]['logWhiteDomainRequest'](_0x340f3e(0x11a),'/invoices/new','GET',Object[_0x340f3e(0x132)](_0x1fde0b[_0x340f3e(0x13c)]()));const _0x161d04=await fetch(_0x18a190,{'method':_0x340f3e(0x106),'headers':{'Accept':'application/json','User-Agent':_0x340f3e(0x129)}}),_0x53887d=Date[_0x340f3e(0x145)]()-_0x1eefb7;console[_0x340f3e(0x173)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x340f3e(0x173)]('Status:',_0x161d04['status']),console[_0x340f3e(0x173)](_0x340f3e(0x14b),_0x161d04[_0x340f3e(0x135)]),console[_0x340f3e(0x173)](_0x340f3e(0x165),_0x53887d+'ms');const _0xd14633=await _0x161d04['text']();console['log']('Raw\x20Response\x20Body:',_0xd14633);if(!_0x161d04['ok']){console['error'](_0x340f3e(0x169)),console[_0x340f3e(0x175)](_0x340f3e(0x152),_0x161d04[_0x340f3e(0x157)]),console[_0x340f3e(0x175)](_0x340f3e(0x141),_0xd14633),loggerService_1['loggerService'][_0x340f3e(0x155)](_0x340f3e(0x11a),_0x340f3e(0x171),_0x161d04['status'],_0xd14633,_0x53887d),loggerService_1[_0x340f3e(0x125)][_0x340f3e(0x112)](_0x340f3e(0x11a),_0x340f3e(0x171),_0x340f3e(0x151)+_0x161d04[_0x340f3e(0x157)]+':\x20'+_0xd14633);throw new Error(_0x340f3e(0x105)+_0x161d04[_0x340f3e(0x157)]+_0x340f3e(0x14a)+_0xd14633);}let _0x2df5e4;try{_0x2df5e4=JSON['parse'](_0xd14633);}catch(_0x3568a9){console[_0x340f3e(0x175)](_0x340f3e(0x12c),_0x3568a9),loggerService_1[_0x340f3e(0x125)][_0x340f3e(0x112)]('plisio_direct','/invoices/new',_0x340f3e(0x113)+_0x3568a9);throw new Error(_0x340f3e(0x139)+_0xd14633);}console[_0x340f3e(0x173)](_0x340f3e(0x128)),console[_0x340f3e(0x173)](_0x340f3e(0x162),JSON[_0x340f3e(0x121)](_0x2df5e4,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x340f3e(0x11a),_0x340f3e(0x171),_0x161d04['status'],_0x2df5e4,_0x53887d);if(_0x2df5e4['status']!==_0x340f3e(0x164)){const _0x18586c=_0x2df5e4[_0x340f3e(0x10b)]||_0x2df5e4[_0x340f3e(0x175)]||_0x340f3e(0x134);console[_0x340f3e(0x175)]('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x340f3e(0x175)](_0x340f3e(0x119),_0x18586c),loggerService_1['loggerService']['logWhiteDomainError'](_0x340f3e(0x11a),_0x340f3e(0x171),_0x340f3e(0x111)+_0x18586c);throw new Error(_0x340f3e(0x12a)+_0x18586c);}if(!_0x2df5e4['data']?.[_0x340f3e(0x10f)]||!_0x2df5e4[_0x340f3e(0x146)]?.[_0x340f3e(0x13f)]){console[_0x340f3e(0x175)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x340f3e(0x175)]('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console[_0x340f3e(0x175)](_0x340f3e(0x136),_0x2df5e4['data']),loggerService_1[_0x340f3e(0x125)][_0x340f3e(0x112)](_0x340f3e(0x11a),_0x340f3e(0x171),_0x340f3e(0x11b));throw new Error(_0x340f3e(0x147));}return console[_0x340f3e(0x173)](_0x340f3e(0x153)),console[_0x340f3e(0x173)]('Transaction\x20ID:',_0x2df5e4[_0x340f3e(0x146)][_0x340f3e(0x10f)]),console['log'](_0x340f3e(0x117),_0x2df5e4[_0x340f3e(0x146)]['invoice_url']),console['log']('Amount:',_0x415008,_0x1e66ec),_0x4d2eb6&&(console[_0x340f3e(0x173)](_0x340f3e(0x13b),_0x4d2eb6,_0x340f3e(0x10a)),console[_0x340f3e(0x173)](_0x340f3e(0x100),_0x1e66ec,_0x340f3e(0x14e))),{'gateway_payment_id':_0x2df5e4[_0x340f3e(0x146)]['txn_id'],'payment_url':_0x2df5e4[_0x340f3e(0x146)][_0x340f3e(0x13f)],'invoice_total_sum':_0x2df5e4[_0x340f3e(0x146)][_0x340f3e(0x101)],'qr_code':_0x2df5e4['data']['qr_code'],'qr_url':_0x2df5e4[_0x340f3e(0x146)][_0x340f3e(0x116)]};}catch(_0x54b782){console[_0x340f3e(0x175)](_0x340f3e(0x172)),console[_0x340f3e(0x175)](_0x340f3e(0x11e),_0x54b782),loggerService_1[_0x340f3e(0x125)]['logWhiteDomainError']('plisio_direct','/invoices/new',_0x54b782);if(_0x54b782 instanceof Error){console[_0x340f3e(0x175)](_0x340f3e(0x104),_0x54b782['message']),console[_0x340f3e(0x175)](_0x340f3e(0x170),_0x54b782[_0x340f3e(0x14f)]);throw new Error(_0x340f3e(0x16e)+_0x54b782[_0x340f3e(0x10b)]);}throw new Error(_0x340f3e(0x124));}}async[a49_0x39d748(0xff)](_0x30e695){const _0x430c28=a49_0x39d748,_0x5cd0f8=Date['now']();try{if(!this[_0x430c28(0x11f)])throw new Error(_0x430c28(0x115));const _0x1a814b=new URLSearchParams({'api_key':this['apiKey'],'txn_id':_0x30e695}),_0x1f012b=_0x430c28(0x133)+_0x30e695+'?'+_0x1a814b[_0x430c28(0x15d)]();loggerService_1[_0x430c28(0x125)][_0x430c28(0x15f)]('plisio_direct','/operations/'+_0x30e695,_0x430c28(0x106),Object[_0x430c28(0x132)](_0x1a814b['entries']()));const _0x4e4125=await fetch(_0x1f012b,{'method':_0x430c28(0x106),'headers':{'Accept':_0x430c28(0x13e),'User-Agent':_0x430c28(0x129)}}),_0x3ff374=Date['now']()-_0x5cd0f8;if(!_0x4e4125['ok']){const _0x27f8ed=await _0x4e4125[_0x430c28(0xfd)]();loggerService_1['loggerService'][_0x430c28(0x155)](_0x430c28(0x11a),_0x430c28(0x174)+_0x30e695,_0x4e4125[_0x430c28(0x157)],_0x27f8ed,_0x3ff374);throw new Error(_0x430c28(0x105)+_0x4e4125[_0x430c28(0x157)]);}const _0x17ff8f=await _0x4e4125[_0x430c28(0x123)]();loggerService_1[_0x430c28(0x125)]['logWhiteDomainResponse']('plisio_direct',_0x430c28(0x174)+_0x30e695,_0x4e4125[_0x430c28(0x157)],_0x17ff8f,_0x3ff374);if(_0x17ff8f[_0x430c28(0x157)]!==_0x430c28(0x164)){loggerService_1[_0x430c28(0x125)][_0x430c28(0x112)](_0x430c28(0x11a),'/operations/'+_0x30e695,_0x430c28(0x12a)+(_0x17ff8f[_0x430c28(0x10b)]||_0x17ff8f[_0x430c28(0x175)]||_0x430c28(0x12e)));throw new Error('Plisio\x20API\x20error:\x20'+(_0x17ff8f[_0x430c28(0x10b)]||_0x17ff8f['error']||_0x430c28(0x12e)));}let _0x3d80d5=_0x430c28(0x16f);return{'status':_0x3d80d5};}catch(_0x5207c3){console['error'](_0x430c28(0x12b),_0x5207c3),loggerService_1[_0x430c28(0x125)][_0x430c28(0x112)](_0x430c28(0x11a),'/operations/'+_0x30e695,_0x5207c3);throw new Error(_0x430c28(0x161)+(_0x5207c3 instanceof Error?_0x5207c3[_0x430c28(0x10b)]:'Unknown\x20error'));}}async[a49_0x39d748(0x16c)](_0x5ae5ac){const _0xcdec7a=a49_0x39d748;console[_0xcdec7a(0x173)](_0xcdec7a(0x15c),_0x5ae5ac);let _0x4d9a6b=_0xcdec7a(0x16f);switch(_0x5ae5ac['status']?.['toLowerCase']()){case _0xcdec7a(0x166):case'mismatch':_0x4d9a6b=_0xcdec7a(0x130);break;case _0xcdec7a(0x15b):_0x4d9a6b=_0xcdec7a(0x110);break;case'error':case _0xcdec7a(0x144):_0x4d9a6b=_0xcdec7a(0x15a);break;case'new':_0x4d9a6b=_0xcdec7a(0x16f);break;case'pending':_0x4d9a6b=_0xcdec7a(0x10c);break;default:_0x4d9a6b=_0xcdec7a(0x16f);break;}let _0x3b82f4;if(_0x5ae5ac[_0xcdec7a(0x10d)])try{console['log'](_0xcdec7a(0xfc),_0x5ae5ac[_0xcdec7a(0x10d)]);let _0x1224c5;if(typeof _0x5ae5ac[_0xcdec7a(0x10d)]==='string')_0x1224c5=JSON[_0xcdec7a(0x137)](_0x5ae5ac['tx_urls']);else Array[_0xcdec7a(0x11c)](_0x5ae5ac[_0xcdec7a(0x10d)])?_0x1224c5=_0x5ae5ac[_0xcdec7a(0x10d)]:_0x1224c5=[];_0x3b82f4=_0x1224c5[_0xcdec7a(0x148)](_0x12488b=>{const _0x4151ea=_0xcdec7a,_0x1e0f2b=_0x12488b[_0x4151ea(0x156)](/\\/g,'');return console[_0x4151ea(0x173)](_0x4151ea(0x149)+_0x12488b+_0x4151ea(0x16d)+_0x1e0f2b),_0x1e0f2b;}),console[_0xcdec7a(0x173)](_0xcdec7a(0x13a),_0x3b82f4),_0x3b82f4[_0xcdec7a(0x143)]((_0x395be1,_0x38c9ee)=>{const _0x3ccba6=_0xcdec7a;try{new URL(_0x395be1),console[_0x3ccba6(0x173)]('‚úÖ\x20URL\x20'+(_0x38c9ee+0x1)+_0x3ccba6(0x122)+_0x395be1);}catch(_0x1e639d){console[_0x3ccba6(0x175)](_0x3ccba6(0x150)+(_0x38c9ee+0x1)+_0x3ccba6(0x10e)+_0x395be1,_0x1e639d);}});}catch(_0x4b5873){console['error'](_0xcdec7a(0x126),_0x4b5873),console[_0xcdec7a(0x175)](_0xcdec7a(0x16a),_0x5ae5ac['tx_urls']),_0x3b82f4=undefined;}return{'paymentId':_0x5ae5ac[_0xcdec7a(0x127)]||'','status':_0x4d9a6b,'amount':_0x5ae5ac['amount'],'currency':_0x5ae5ac[_0xcdec7a(0x158)],'txUrls':_0x3b82f4};}}function a49_0x3883(_0x472da4,_0x5e0a3e){const _0x2d2500=a49_0x2d25();return a49_0x3883=function(_0x388356,_0x259393){_0x388356=_0x388356-0xfc;let _0x5a07b=_0x2d2500[_0x388356];return _0x5a07b;},a49_0x3883(_0x472da4,_0x5e0a3e);}exports[a49_0x39d748(0x15e)]=PlisioService;