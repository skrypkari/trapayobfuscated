'use strict';const a48_0x2ee169=a48_0x27d5;function a48_0x27d5(_0x14e286,_0x22aa70){const _0x5ce195=a48_0x5ce1();return a48_0x27d5=function(_0x27d50d,_0x5f5612){_0x27d50d=_0x27d50d-0x119;let _0x3fabd9=_0x5ce195[_0x27d50d];return _0x3fabd9;},a48_0x27d5(_0x14e286,_0x22aa70);}(function(_0x1f5266,_0x259049){const _0x294c7a=a48_0x27d5,_0x1d9be0=_0x1f5266();while(!![]){try{const _0x38d995=parseInt(_0x294c7a(0x124))/0x1+parseInt(_0x294c7a(0x13e))/0x2+-parseInt(_0x294c7a(0x119))/0x3*(parseInt(_0x294c7a(0x146))/0x4)+parseInt(_0x294c7a(0x189))/0x5+-parseInt(_0x294c7a(0x142))/0x6*(-parseInt(_0x294c7a(0x148))/0x7)+parseInt(_0x294c7a(0x14f))/0x8+-parseInt(_0x294c7a(0x184))/0x9*(parseInt(_0x294c7a(0x12d))/0xa);if(_0x38d995===_0x259049)break;else _0x1d9be0['push'](_0x1d9be0['shift']());}catch(_0x4a09a4){_0x1d9be0['push'](_0x1d9be0['shift']());}}}(a48_0x5ce1,0xbcda1));Object[a48_0x2ee169(0x126)](exports,a48_0x2ee169(0x17d),{'value':!![]}),exports[a48_0x2ee169(0x125)]=void 0x0;const loggerService_1=require(a48_0x2ee169(0x155));class PlisioService{constructor(){const _0x331450=a48_0x2ee169;this[_0x331450(0x123)]=_0x331450(0x173),this[_0x331450(0x147)]=process['env'][_0x331450(0x144)]||'',!this[_0x331450(0x147)]?console['warn'](_0x331450(0x183)):console[_0x331450(0x11b)](_0x331450(0x152));}async[a48_0x2ee169(0x164)](_0x191137){const _0x24ffa6=a48_0x2ee169,{orderId:_0x30779c,amount:_0x1e86c0,currency:_0xdbd74a,productName:_0x3acca5,description:_0x2cb229,successUrl:_0x381ff8,failUrl:_0x179c01,customerEmail:_0x1ff2d1,customerName:_0x3d244b,isSourceCurrency:_0x4204de,sourceCurrency:_0x1c70aa}=_0x191137;if(!this[_0x24ffa6(0x147)])throw new Error(_0x24ffa6(0x180));const _0x73cebc=new URLSearchParams({'api_key':this[_0x24ffa6(0x147)],'order_number':_0x30779c,'order_name':_0x3acca5,'description':_0x2cb229,'success_url':_0x381ff8,'fail_url':_0x179c01,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x1c70aa?(_0x73cebc[_0x24ffa6(0x15b)](_0x24ffa6(0x13b),_0x1c70aa),_0x73cebc['append'](_0x24ffa6(0x158),_0xdbd74a),_0x73cebc[_0x24ffa6(0x15b)](_0x24ffa6(0x13c),_0x1e86c0[_0x24ffa6(0x14b)]())):(_0x73cebc[_0x24ffa6(0x15b)]('currency',_0xdbd74a),_0x73cebc['append'](_0x24ffa6(0x128),_0x1e86c0[_0x24ffa6(0x14b)]()));_0x1ff2d1&&_0x73cebc[_0x24ffa6(0x15b)](_0x24ffa6(0x18b),_0x1ff2d1);_0x3d244b&&_0x73cebc[_0x24ffa6(0x15b)]('name',_0x3d244b);const _0x35e85a=this[_0x24ffa6(0x123)]+'?'+_0x73cebc[_0x24ffa6(0x14b)](),_0x38ab44=Date[_0x24ffa6(0x137)]();try{console['log'](_0x24ffa6(0x120)),console[_0x24ffa6(0x11b)](_0x24ffa6(0x182),this[_0x24ffa6(0x123)]),console[_0x24ffa6(0x11b)](_0x24ffa6(0x165),Object[_0x24ffa6(0x187)](_0x73cebc['entries']())),console['log']('Full\x20URL\x20(without\x20API\x20key):',_0x35e85a[_0x24ffa6(0x138)](this[_0x24ffa6(0x147)],_0x24ffa6(0x11e))),loggerService_1['loggerService'][_0x24ffa6(0x134)](_0x24ffa6(0x18c),_0x24ffa6(0x154),_0x24ffa6(0x13d),Object['fromEntries'](_0x73cebc[_0x24ffa6(0x16b)]()));const _0x4d507e=await fetch(_0x35e85a,{'method':_0x24ffa6(0x13d),'headers':{'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x4223a1=Date[_0x24ffa6(0x137)]()-_0x38ab44;console['log']('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x24ffa6(0x11b)](_0x24ffa6(0x12b),_0x4d507e[_0x24ffa6(0x17f)]),console[_0x24ffa6(0x11b)](_0x24ffa6(0x140),_0x4d507e['statusText']),console[_0x24ffa6(0x11b)](_0x24ffa6(0x186),_0x4223a1+'ms');const _0x502c5e=await _0x4d507e[_0x24ffa6(0x12f)]();console[_0x24ffa6(0x11b)](_0x24ffa6(0x172),_0x502c5e);if(!_0x4d507e['ok']){console[_0x24ffa6(0x139)](_0x24ffa6(0x16e)),console['error']('HTTP\x20Status:',_0x4d507e[_0x24ffa6(0x17f)]),console[_0x24ffa6(0x139)](_0x24ffa6(0x15a),_0x502c5e),loggerService_1[_0x24ffa6(0x17b)]['logWhiteDomainResponse'](_0x24ffa6(0x18c),_0x24ffa6(0x154),_0x4d507e['status'],_0x502c5e,_0x4223a1),loggerService_1['loggerService'][_0x24ffa6(0x151)](_0x24ffa6(0x18c),'/invoices/new',_0x24ffa6(0x122)+_0x4d507e[_0x24ffa6(0x17f)]+':\x20'+_0x502c5e);throw new Error(_0x24ffa6(0x153)+_0x4d507e['status']+_0x24ffa6(0x181)+_0x502c5e);}let _0x5f21ee;try{_0x5f21ee=JSON['parse'](_0x502c5e);}catch(_0x88cfc4){console[_0x24ffa6(0x139)](_0x24ffa6(0x14a),_0x88cfc4),loggerService_1[_0x24ffa6(0x17b)][_0x24ffa6(0x151)](_0x24ffa6(0x18c),_0x24ffa6(0x154),_0x24ffa6(0x15e)+_0x88cfc4);throw new Error(_0x24ffa6(0x11a)+_0x502c5e);}console[_0x24ffa6(0x11b)](_0x24ffa6(0x188)),console[_0x24ffa6(0x11b)]('Parsed\x20Result:',JSON['stringify'](_0x5f21ee,null,0x2)),loggerService_1[_0x24ffa6(0x17b)][_0x24ffa6(0x149)](_0x24ffa6(0x18c),_0x24ffa6(0x154),_0x4d507e[_0x24ffa6(0x17f)],_0x5f21ee,_0x4223a1);if(_0x5f21ee[_0x24ffa6(0x17f)]!=='success'){const _0x359540=_0x5f21ee['message']||_0x5f21ee[_0x24ffa6(0x139)]||'Unknown\x20error\x20from\x20Plisio\x20API';console['error'](_0x24ffa6(0x133)),console[_0x24ffa6(0x139)](_0x24ffa6(0x135),_0x359540),loggerService_1[_0x24ffa6(0x17b)][_0x24ffa6(0x151)](_0x24ffa6(0x18c),_0x24ffa6(0x154),_0x24ffa6(0x166)+_0x359540);throw new Error('Plisio\x20API\x20error:\x20'+_0x359540);}if(!_0x5f21ee[_0x24ffa6(0x14e)]?.[_0x24ffa6(0x175)]||!_0x5f21ee['data']?.[_0x24ffa6(0x18d)]){console[_0x24ffa6(0x139)](_0x24ffa6(0x150)),console[_0x24ffa6(0x139)](_0x24ffa6(0x145)),console[_0x24ffa6(0x139)]('Response\x20data:',_0x5f21ee['data']),loggerService_1['loggerService'][_0x24ffa6(0x151)](_0x24ffa6(0x18c),_0x24ffa6(0x154),_0x24ffa6(0x14c));throw new Error(_0x24ffa6(0x12a));}return console[_0x24ffa6(0x11b)](_0x24ffa6(0x131)),console[_0x24ffa6(0x11b)](_0x24ffa6(0x16c),_0x5f21ee[_0x24ffa6(0x14e)]['txn_id']),console['log'](_0x24ffa6(0x130),_0x5f21ee[_0x24ffa6(0x14e)][_0x24ffa6(0x18d)]),console[_0x24ffa6(0x11b)](_0x24ffa6(0x160),_0x1e86c0,_0xdbd74a),_0x1c70aa&&(console[_0x24ffa6(0x11b)]('Source\x20Currency:',_0x1c70aa,_0x24ffa6(0x185)),console['log']('Target\x20Currency:',_0xdbd74a,_0x24ffa6(0x13f))),{'gateway_payment_id':_0x5f21ee['data']['txn_id'],'payment_url':_0x5f21ee[_0x24ffa6(0x14e)][_0x24ffa6(0x18d)],'invoice_total_sum':_0x5f21ee['data']['invoice_total_sum'],'qr_code':_0x5f21ee['data']['qr_code'],'qr_url':_0x5f21ee[_0x24ffa6(0x14e)]['qr_url']};}catch(_0xf6bf60){console[_0x24ffa6(0x139)](_0x24ffa6(0x159)),console[_0x24ffa6(0x139)]('Error\x20details:',_0xf6bf60),loggerService_1[_0x24ffa6(0x17b)]['logWhiteDomainError'](_0x24ffa6(0x18c),'/invoices/new',_0xf6bf60);if(_0xf6bf60 instanceof Error){console[_0x24ffa6(0x139)](_0x24ffa6(0x129),_0xf6bf60['message']),console[_0x24ffa6(0x139)](_0x24ffa6(0x16d),_0xf6bf60[_0x24ffa6(0x15c)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0xf6bf60['message']);}throw new Error(_0x24ffa6(0x168));}}async[a48_0x2ee169(0x141)](_0x1d31d1){const _0x147774=a48_0x2ee169,_0x2ebb60=Date[_0x147774(0x137)]();try{if(!this[_0x147774(0x147)])throw new Error('Plisio\x20API\x20key\x20is\x20not\x20configured');const _0x536434=new URLSearchParams({'api_key':this[_0x147774(0x147)],'txn_id':_0x1d31d1}),_0x4f1632=_0x147774(0x136)+_0x1d31d1+'?'+_0x536434[_0x147774(0x14b)]();loggerService_1[_0x147774(0x17b)][_0x147774(0x134)](_0x147774(0x18c),'/operations/'+_0x1d31d1,_0x147774(0x13d),Object['fromEntries'](_0x536434['entries']()));const _0x13f0a2=await fetch(_0x4f1632,{'method':_0x147774(0x13d),'headers':{'Accept':_0x147774(0x179),'User-Agent':_0x147774(0x178)}}),_0x51dc1b=Date[_0x147774(0x137)]()-_0x2ebb60;if(!_0x13f0a2['ok']){const _0x218c63=await _0x13f0a2['text']();loggerService_1[_0x147774(0x17b)]['logWhiteDomainResponse'](_0x147774(0x18c),_0x147774(0x11c)+_0x1d31d1,_0x13f0a2[_0x147774(0x17f)],_0x218c63,_0x51dc1b);throw new Error(_0x147774(0x153)+_0x13f0a2[_0x147774(0x17f)]);}const _0x1c597d=await _0x13f0a2[_0x147774(0x167)]();loggerService_1[_0x147774(0x17b)][_0x147774(0x149)](_0x147774(0x18c),_0x147774(0x11c)+_0x1d31d1,_0x13f0a2['status'],_0x1c597d,_0x51dc1b);if(_0x1c597d[_0x147774(0x17f)]!==_0x147774(0x132)){loggerService_1[_0x147774(0x17b)][_0x147774(0x151)]('plisio_direct',_0x147774(0x11c)+_0x1d31d1,_0x147774(0x15d)+(_0x1c597d[_0x147774(0x176)]||_0x1c597d['error']||_0x147774(0x170)));throw new Error(_0x147774(0x15d)+(_0x1c597d[_0x147774(0x176)]||_0x1c597d[_0x147774(0x139)]||'Unknown\x20error'));}let _0x594f31='PENDING';return{'status':_0x594f31};}catch(_0x947457){console[_0x147774(0x139)](_0x147774(0x13a),_0x947457),loggerService_1[_0x147774(0x17b)]['logWhiteDomainError'](_0x147774(0x18c),_0x147774(0x11c)+_0x1d31d1,_0x947457);throw new Error(_0x147774(0x171)+(_0x947457 instanceof Error?_0x947457[_0x147774(0x176)]:_0x147774(0x170)));}}async[a48_0x2ee169(0x18a)](_0x199387){const _0x4b1146=a48_0x2ee169;console[_0x4b1146(0x11b)]('Processing\x20Plisio\x20webhook:',_0x199387);let _0x40760c=_0x4b1146(0x169);switch(_0x199387[_0x4b1146(0x17f)]?.['toLowerCase']()){case _0x4b1146(0x11d):case _0x4b1146(0x14d):_0x40760c=_0x4b1146(0x16f);break;case _0x4b1146(0x17a):_0x40760c='EXPIRED';break;case'error':case _0x4b1146(0x16a):_0x40760c=_0x4b1146(0x143);break;case'new':_0x40760c=_0x4b1146(0x169);break;case _0x4b1146(0x17e):_0x40760c=_0x4b1146(0x11f);break;default:_0x40760c=_0x4b1146(0x169);break;}let _0xbe0fd3;if(_0x199387[_0x4b1146(0x163)])try{console[_0x4b1146(0x11b)](_0x4b1146(0x177),_0x199387[_0x4b1146(0x163)]);let _0x1da671;if(typeof _0x199387['tx_urls']==='string')_0x1da671=JSON[_0x4b1146(0x12c)](_0x199387[_0x4b1146(0x163)]);else Array[_0x4b1146(0x156)](_0x199387[_0x4b1146(0x163)])?_0x1da671=_0x199387[_0x4b1146(0x163)]:_0x1da671=[];_0xbe0fd3=_0x1da671[_0x4b1146(0x162)](_0x5104f6=>{const _0x4b1cec=_0x4b1146,_0x4fba12=_0x5104f6[_0x4b1cec(0x138)](/\\/g,'');return console['log'](_0x4b1cec(0x157)+_0x5104f6+_0x4b1cec(0x127)+_0x4fba12),_0x4fba12;}),console[_0x4b1146(0x11b)](_0x4b1146(0x15f),_0xbe0fd3),_0xbe0fd3['forEach']((_0x221d04,_0x822e31)=>{const _0x1b1ff8=_0x4b1146;try{new URL(_0x221d04),console[_0x1b1ff8(0x11b)](_0x1b1ff8(0x161)+(_0x822e31+0x1)+_0x1b1ff8(0x174)+_0x221d04);}catch(_0x3f16ee){console[_0x1b1ff8(0x139)](_0x1b1ff8(0x121)+(_0x822e31+0x1)+_0x1b1ff8(0x17c)+_0x221d04,_0x3f16ee);}});}catch(_0x2342d8){console[_0x4b1146(0x139)]('‚ùå\x20Failed\x20to\x20parse\x20tx_urls:',_0x2342d8),console[_0x4b1146(0x139)]('Raw\x20tx_urls\x20data:',_0x199387[_0x4b1146(0x163)]),_0xbe0fd3=undefined;}return{'paymentId':_0x199387[_0x4b1146(0x12e)]||'','status':_0x40760c,'amount':_0x199387['amount'],'currency':_0x199387['currency'],'txUrls':_0xbe0fd3};}}exports[a48_0x2ee169(0x125)]=PlisioService;function a48_0x5ce1(){const _0x2bb745=['67278nMoeEu','FAILED','PLISIO_API_KEY','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','3216476tYqwRR','apiKey','371mOVuOp','logWhiteDomainResponse','Failed\x20to\x20parse\x20JSON\x20response:','toString','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','mismatch','data','7746632fsvkZL','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainError','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','HTTP\x20error!\x20status:\x20','/invoices/new','../loggerService','isArray','üîó\x20Formatted\x20URL:\x20','source_currency','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Response\x20Body:','append','stack','Plisio\x20API\x20error:\x20','JSON\x20Parse\x20Error:\x20','‚úÖ\x20Processed\x20tx_urls:','Amount:','‚úÖ\x20URL\x20','map','tx_urls','createPayment','Parameters:','Business\x20Error:\x20','json','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','PENDING','cancelled','entries','Transaction\x20ID:','Error\x20stack:','===\x20PLISIO\x20API\x20ERROR\x20===','PAID','Unknown\x20error','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','Raw\x20Response\x20Body:','https://api.plisio.net/api/v1/invoices/new','\x20is\x20valid:\x20','txn_id','message','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','TesSoft\x20Payment\x20System/1.0','application/json','expired','loggerService','\x20is\x20invalid:\x20','__esModule','pending','status','Plisio\x20API\x20key\x20is\x20not\x20configured',',\x20body:\x20','URL:','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','9KuMADN','(crypto\x20for\x20payment)','Response\x20Time:','fromEntries','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','493450fNIOZW','processWebhook','email','plisio_direct','invoice_url','3lapFJa','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','log','/operations/','completed','HIDDEN','PROCESSING','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','‚ùå\x20URL\x20','HTTP\x20','apiUrl','1209135uiHpmJ','PlisioService','defineProperty','\x20->\x20','amount','Error\x20message:','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','Status:','parse','17860580UTOUnh','order_number','text','Invoice\x20URL:','===\x20PLISIO\x20SUCCESS\x20===','success','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','logWhiteDomainRequest','Error\x20Message:','https://api.plisio.net/api/v1/operations/','now','replace','error','Plisio\x20payment\x20verification\x20error:','currency','source_amount','GET','986542ciCtXS','(fiat\x20for\x20merchant)','Status\x20Text:','verifyPayment'];a48_0x5ce1=function(){return _0x2bb745;};return a48_0x5ce1();}