'use strict';const a68_0x5ab812=a68_0x12bd;function a68_0x12bd(_0x2029e8,_0x2b218e){_0x2029e8=_0x2029e8-0x1c0;const _0xdb5521=a68_0xdb55();let _0x12bd9e=_0xdb5521[_0x2029e8];return _0x12bd9e;}(function(_0x312d94,_0x32e3d3){const _0x5d3de4=a68_0x12bd,_0x1d9d81=_0x312d94();while(!![]){try{const _0xcbe6ab=-parseInt(_0x5d3de4(0x228))/0x1*(-parseInt(_0x5d3de4(0x217))/0x2)+parseInt(_0x5d3de4(0x1ce))/0x3+parseInt(_0x5d3de4(0x1db))/0x4+parseInt(_0x5d3de4(0x1f9))/0x5*(parseInt(_0x5d3de4(0x1f0))/0x6)+-parseInt(_0x5d3de4(0x205))/0x7+-parseInt(_0x5d3de4(0x215))/0x8+-parseInt(_0x5d3de4(0x1e8))/0x9;if(_0xcbe6ab===_0x32e3d3)break;else _0x1d9d81['push'](_0x1d9d81['shift']());}catch(_0x1baa43){_0x1d9d81['push'](_0x1d9d81['shift']());}}}(a68_0xdb55,0x5ae43));Object[a68_0x5ab812(0x1d7)](exports,a68_0x5ab812(0x202),{'value':!![]}),exports[a68_0x5ab812(0x1eb)]=void 0x0;const loggerService_1=require(a68_0x5ab812(0x223));function a68_0xdb55(){const _0x2f7e40=['EXPIRED','email','üîó\x20Formatted\x20URL:\x20','stack','apiKey','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','(fiat\x20for\x20merchant)','invoice_total_sum','Raw\x20tx_urls\x20data:',',\x20body:\x20','toString','pending','expired','invoice_url','loggerService','FAILED','Response\x20Time:','source_amount','823797jxInWD','HTTP\x20Status:','map','https://api.plisio.net/api/v1/operations/','logWhiteDomainError','fromEntries','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20create\x20Plisio\x20payment:\x20','Unknown\x20error','defineProperty','Parameters:','logWhiteDomainRequest','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','1948124odmYuW','processWebhook','Error\x20details:','isArray','(crypto\x20for\x20payment)','‚ùå\x20Failed\x20to\x20parse\x20tx_urls:','error','qr_code','logWhiteDomainResponse','Plisio\x20API\x20key\x20is\x20not\x20configured','amount','\x20->\x20','===\x20PLISIO\x20API\x20ERROR\x20===','97335qhOTha','Payment\x20System/1.0','tx_urls','PlisioService','üîó\x20Raw\x20tx_urls\x20from\x20Plisio:','Plisio\x20payment\x20verification\x20error:','Error\x20Message:','Response\x20Body:','2066610IUiMjx','qr_url','new','now','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','verifyPayment','stringify','log','Invoice\x20URL:','5TCeuDd','PROCESSING','message','warn','Status\x20Text:','/operations/','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','replace','data','__esModule','entries','Processing\x20Plisio\x20webhook:','4885510GLbkPA','forEach','createPayment','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','statusText','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','‚úÖ\x20Processed\x20tx_urls:','cancelled','order_number','HTTP\x20error!\x20status:\x20','PENDING','append','JSON\x20Parse\x20Error:\x20','parse','Error\x20stack:','PAID','2902856AKoixR','Plisio\x20API\x20error:\x20','675656pmBJxV','GET','Raw\x20Response\x20Body:','txn_id','Target\x20Currency:','source_currency','Source\x20Currency:','Full\x20URL\x20(without\x20API\x20key):','completed','Transaction\x20ID:','text','\x20is\x20invalid:\x20','../loggerService','application/json','Status:','success','status','1xwEvdV','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','Parsed\x20Result:','apiUrl','json','https://api.plisio.net/api/v1/invoices/new','HIDDEN','/invoices/new','plisio_direct','Business\x20Error:\x20','HTTP\x20','===\x20PLISIO\x20SUCCESS\x20===','currency','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','mismatch','toLowerCase'];a68_0xdb55=function(){return _0x2f7e40;};return a68_0xdb55();}class PlisioService{constructor(){const _0x27695f=a68_0x5ab812;this[_0x27695f(0x22b)]=_0x27695f(0x22d),this['apiKey']=process.env.PLISIO_API_KEY||'',!this[_0x27695f(0x1c0)]?console[_0x27695f(0x1fc)](_0x27695f(0x1ff)):console['log'](_0x27695f(0x229));}async[a68_0x5ab812(0x207)](_0x41c474){const _0x10f777=a68_0x5ab812,{orderId:_0x1b63ac,amount:_0x142097,currency:_0x51257c,productName:_0x44d382,description:_0x288589,successUrl:_0x16cf79,failUrl:_0x47bf8e,customerEmail:_0x12c071,customerName:_0x32b24f,isSourceCurrency:_0x1d24ea,sourceCurrency:_0x48ff0c}=_0x41c474;if(!this[_0x10f777(0x1c0)])throw new Error(_0x10f777(0x1e4));const _0x5313be=new URLSearchParams({'api_key':this[_0x10f777(0x1c0)],'order_number':_0x1b63ac,'order_name':_0x44d382,'description':_0x288589,'success_url':_0x16cf79,'fail_url':_0x47bf8e,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x48ff0c?(_0x5313be[_0x10f777(0x210)](_0x10f777(0x234),_0x48ff0c),_0x5313be['append'](_0x10f777(0x21c),_0x51257c),_0x5313be[_0x10f777(0x210)](_0x10f777(0x1cd),_0x142097['toString']())):(_0x5313be[_0x10f777(0x210)]('currency',_0x51257c),_0x5313be[_0x10f777(0x210)](_0x10f777(0x1e5),_0x142097[_0x10f777(0x1c6)]()));_0x12c071&&_0x5313be[_0x10f777(0x210)](_0x10f777(0x239),_0x12c071);_0x32b24f&&_0x5313be[_0x10f777(0x210)]('name',_0x32b24f);const _0xb7dac9=this[_0x10f777(0x22b)]+'?'+_0x5313be[_0x10f777(0x1c6)](),_0x5f49b7=Date[_0x10f777(0x1f3)]();try{console[_0x10f777(0x1f7)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x10f777(0x1f7)]('URL:',this[_0x10f777(0x22b)]),console[_0x10f777(0x1f7)](_0x10f777(0x1d8),Object[_0x10f777(0x1d3)](_0x5313be[_0x10f777(0x203)]())),console['log'](_0x10f777(0x21e),_0xb7dac9[_0x10f777(0x200)](this[_0x10f777(0x1c0)],_0x10f777(0x22e))),loggerService_1['loggerService'][_0x10f777(0x1d9)](_0x10f777(0x230),_0x10f777(0x22f),_0x10f777(0x218),Object[_0x10f777(0x1d3)](_0x5313be['entries']()));const _0x53a7ea=await fetch(_0xb7dac9,{'method':_0x10f777(0x218),'headers':{'Accept':_0x10f777(0x224),'User-Agent':_0x10f777(0x1e9)}}),_0x5b365a=Date['now']()-_0x5f49b7;console[_0x10f777(0x1f7)]('===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='),console[_0x10f777(0x1f7)](_0x10f777(0x225),_0x53a7ea[_0x10f777(0x227)]),console[_0x10f777(0x1f7)](_0x10f777(0x1fd),_0x53a7ea[_0x10f777(0x209)]),console[_0x10f777(0x1f7)](_0x10f777(0x1cc),_0x5b365a+'ms');const _0x2b9a8a=await _0x53a7ea['text']();console['log'](_0x10f777(0x219),_0x2b9a8a);if(!_0x53a7ea['ok']){console[_0x10f777(0x1e1)](_0x10f777(0x1e7)),console[_0x10f777(0x1e1)](_0x10f777(0x1cf),_0x53a7ea[_0x10f777(0x227)]),console[_0x10f777(0x1e1)](_0x10f777(0x1ef),_0x2b9a8a),loggerService_1[_0x10f777(0x1ca)]['logWhiteDomainResponse'](_0x10f777(0x230),_0x10f777(0x22f),_0x53a7ea[_0x10f777(0x227)],_0x2b9a8a,_0x5b365a),loggerService_1[_0x10f777(0x1ca)][_0x10f777(0x1d2)](_0x10f777(0x230),'/invoices/new',_0x10f777(0x232)+_0x53a7ea[_0x10f777(0x227)]+':\x20'+_0x2b9a8a);throw new Error(_0x10f777(0x20e)+_0x53a7ea['status']+_0x10f777(0x1c5)+_0x2b9a8a);}let _0x41d52f;try{_0x41d52f=JSON[_0x10f777(0x212)](_0x2b9a8a);}catch(_0x1bdeb7){console['error'](_0x10f777(0x1d4),_0x1bdeb7),loggerService_1[_0x10f777(0x1ca)]['logWhiteDomainError'](_0x10f777(0x230),_0x10f777(0x22f),_0x10f777(0x211)+_0x1bdeb7);throw new Error(_0x10f777(0x208)+_0x2b9a8a);}console[_0x10f777(0x1f7)](_0x10f777(0x1f4)),console['log'](_0x10f777(0x22a),JSON[_0x10f777(0x1f6)](_0x41d52f,null,0x2)),loggerService_1[_0x10f777(0x1ca)][_0x10f777(0x1e3)](_0x10f777(0x230),_0x10f777(0x22f),_0x53a7ea['status'],_0x41d52f,_0x5b365a);if(_0x41d52f['status']!==_0x10f777(0x226)){const _0x353376=_0x41d52f['message']||_0x41d52f[_0x10f777(0x1e1)]||'Unknown\x20error\x20from\x20Plisio\x20API';console['error']('===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x10f777(0x1e1)](_0x10f777(0x1ee),_0x353376),loggerService_1[_0x10f777(0x1ca)][_0x10f777(0x1d2)]('plisio_direct','/invoices/new',_0x10f777(0x231)+_0x353376);throw new Error(_0x10f777(0x216)+_0x353376);}if(!_0x41d52f[_0x10f777(0x201)]?.[_0x10f777(0x21a)]||!_0x41d52f[_0x10f777(0x201)]?.[_0x10f777(0x1c9)]){console[_0x10f777(0x1e1)]('===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response'),console['error']('Response\x20data:',_0x41d52f[_0x10f777(0x201)]),loggerService_1[_0x10f777(0x1ca)][_0x10f777(0x1d2)](_0x10f777(0x230),_0x10f777(0x22f),_0x10f777(0x1c1));throw new Error(_0x10f777(0x1da));}return console[_0x10f777(0x1f7)](_0x10f777(0x233)),console[_0x10f777(0x1f7)](_0x10f777(0x220),_0x41d52f['data']['txn_id']),console[_0x10f777(0x1f7)](_0x10f777(0x1f8),_0x41d52f[_0x10f777(0x201)][_0x10f777(0x1c9)]),console[_0x10f777(0x1f7)]('Amount:',_0x142097,_0x51257c),_0x48ff0c&&(console[_0x10f777(0x1f7)](_0x10f777(0x21d),_0x48ff0c,_0x10f777(0x1df)),console[_0x10f777(0x1f7)](_0x10f777(0x21b),_0x51257c,_0x10f777(0x1c2))),{'gateway_payment_id':_0x41d52f[_0x10f777(0x201)][_0x10f777(0x21a)],'payment_url':_0x41d52f[_0x10f777(0x201)]['invoice_url'],'invoice_total_sum':_0x41d52f['data'][_0x10f777(0x1c3)],'qr_code':_0x41d52f[_0x10f777(0x201)][_0x10f777(0x1e2)],'qr_url':_0x41d52f['data'][_0x10f777(0x1f1)]};}catch(_0xc9aa){console[_0x10f777(0x1e1)]('===\x20PLISIO\x20SERVICE\x20ERROR\x20==='),console[_0x10f777(0x1e1)](_0x10f777(0x1dd),_0xc9aa),loggerService_1['loggerService'][_0x10f777(0x1d2)](_0x10f777(0x230),_0x10f777(0x22f),_0xc9aa);if(_0xc9aa instanceof Error){console['error']('Error\x20message:',_0xc9aa[_0x10f777(0x1fb)]),console[_0x10f777(0x1e1)](_0x10f777(0x213),_0xc9aa[_0x10f777(0x23b)]);throw new Error(_0x10f777(0x1d5)+_0xc9aa['message']);}throw new Error(_0x10f777(0x235));}}async[a68_0x5ab812(0x1f5)](_0x1d312f){const _0x269827=a68_0x5ab812,_0x101c6f=Date[_0x269827(0x1f3)]();try{if(!this[_0x269827(0x1c0)])throw new Error(_0x269827(0x1e4));const _0x33b62b=new URLSearchParams({'api_key':this[_0x269827(0x1c0)],'txn_id':_0x1d312f}),_0x485e4c=_0x269827(0x1d1)+_0x1d312f+'?'+_0x33b62b['toString']();loggerService_1[_0x269827(0x1ca)][_0x269827(0x1d9)](_0x269827(0x230),_0x269827(0x1fe)+_0x1d312f,'GET',Object[_0x269827(0x1d3)](_0x33b62b['entries']()));const _0xb4dfa6=await fetch(_0x485e4c,{'method':_0x269827(0x218),'headers':{'Accept':_0x269827(0x224),'User-Agent':_0x269827(0x1e9)}}),_0x3265c3=Date[_0x269827(0x1f3)]()-_0x101c6f;if(!_0xb4dfa6['ok']){const _0xb7d5f3=await _0xb4dfa6[_0x269827(0x221)]();loggerService_1[_0x269827(0x1ca)][_0x269827(0x1e3)](_0x269827(0x230),_0x269827(0x1fe)+_0x1d312f,_0xb4dfa6[_0x269827(0x227)],_0xb7d5f3,_0x3265c3);throw new Error(_0x269827(0x20e)+_0xb4dfa6['status']);}const _0x3f3d0b=await _0xb4dfa6[_0x269827(0x22c)]();loggerService_1[_0x269827(0x1ca)][_0x269827(0x1e3)](_0x269827(0x230),_0x269827(0x1fe)+_0x1d312f,_0xb4dfa6['status'],_0x3f3d0b,_0x3265c3);if(_0x3f3d0b[_0x269827(0x227)]!==_0x269827(0x226)){loggerService_1[_0x269827(0x1ca)][_0x269827(0x1d2)](_0x269827(0x230),'/operations/'+_0x1d312f,_0x269827(0x216)+(_0x3f3d0b[_0x269827(0x1fb)]||_0x3f3d0b['error']||_0x269827(0x1d6)));throw new Error(_0x269827(0x216)+(_0x3f3d0b[_0x269827(0x1fb)]||_0x3f3d0b['error']||_0x269827(0x1d6)));}let _0xa36011=_0x269827(0x20f);return{'status':_0xa36011};}catch(_0x4ddcce){console[_0x269827(0x1e1)](_0x269827(0x1ed),_0x4ddcce),loggerService_1[_0x269827(0x1ca)][_0x269827(0x1d2)](_0x269827(0x230),_0x269827(0x1fe)+_0x1d312f,_0x4ddcce);throw new Error(_0x269827(0x20a)+(_0x4ddcce instanceof Error?_0x4ddcce[_0x269827(0x1fb)]:_0x269827(0x1d6)));}}async[a68_0x5ab812(0x1dc)](_0x59aac4){const _0x21f798=a68_0x5ab812;console[_0x21f798(0x1f7)](_0x21f798(0x204),_0x59aac4);let _0x21b728=_0x21f798(0x20f);switch(_0x59aac4['status']?.[_0x21f798(0x237)]()){case _0x21f798(0x21f):case _0x21f798(0x236):_0x21b728=_0x21f798(0x214);break;case _0x21f798(0x1c8):_0x21b728=_0x21f798(0x238);break;case _0x21f798(0x1e1):case _0x21f798(0x20c):_0x21b728=_0x21f798(0x1cb);break;case _0x21f798(0x1f2):_0x21b728='PENDING';break;case _0x21f798(0x1c7):_0x21b728=_0x21f798(0x1fa);break;default:_0x21b728=_0x21f798(0x20f);break;}let _0x12e840;if(_0x59aac4[_0x21f798(0x1ea)])try{console[_0x21f798(0x1f7)](_0x21f798(0x1ec),_0x59aac4[_0x21f798(0x1ea)]);let _0x262481;if(typeof _0x59aac4[_0x21f798(0x1ea)]==='string')_0x262481=JSON[_0x21f798(0x212)](_0x59aac4[_0x21f798(0x1ea)]);else Array[_0x21f798(0x1de)](_0x59aac4['tx_urls'])?_0x262481=_0x59aac4[_0x21f798(0x1ea)]:_0x262481=[];_0x12e840=_0x262481[_0x21f798(0x1d0)](_0x21dd8d=>{const _0x1453eb=_0x21f798,_0x2aa361=_0x21dd8d[_0x1453eb(0x200)](/\\/g,'');return console[_0x1453eb(0x1f7)](_0x1453eb(0x23a)+_0x21dd8d+_0x1453eb(0x1e6)+_0x2aa361),_0x2aa361;}),console[_0x21f798(0x1f7)](_0x21f798(0x20b),_0x12e840),_0x12e840[_0x21f798(0x206)]((_0x4d5436,_0x105add)=>{const _0x48b0db=_0x21f798;try{new URL(_0x4d5436),console['log']('‚úÖ\x20URL\x20'+(_0x105add+0x1)+'\x20is\x20valid:\x20'+_0x4d5436);}catch(_0x55bd3f){console[_0x48b0db(0x1e1)]('‚ùå\x20URL\x20'+(_0x105add+0x1)+_0x48b0db(0x222)+_0x4d5436,_0x55bd3f);}});}catch(_0x4d8083){console[_0x21f798(0x1e1)](_0x21f798(0x1e0),_0x4d8083),console[_0x21f798(0x1e1)](_0x21f798(0x1c4),_0x59aac4[_0x21f798(0x1ea)]),_0x12e840=undefined;}return{'paymentId':_0x59aac4[_0x21f798(0x20d)]||'','status':_0x21b728,'amount':_0x59aac4[_0x21f798(0x1e5)],'currency':_0x59aac4[_0x21f798(0x234)],'txUrls':_0x12e840};}}exports[a68_0x5ab812(0x1eb)]=PlisioService;