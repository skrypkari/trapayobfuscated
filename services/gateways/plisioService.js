'use strict';const a51_0x1d8fb4=a51_0x2c4d;function a51_0x2c4d(_0x296332,_0x5b2149){const _0x5ad51a=a51_0x5ad5();return a51_0x2c4d=function(_0x2c4d30,_0x2d851e){_0x2c4d30=_0x2c4d30-0x199;let _0x503946=_0x5ad51a[_0x2c4d30];return _0x503946;},a51_0x2c4d(_0x296332,_0x5b2149);}(function(_0x4fd97a,_0x170361){const _0x550960=a51_0x2c4d,_0x3a7999=_0x4fd97a();while(!![]){try{const _0x5611b1=parseInt(_0x550960(0x1a9))/0x1+parseInt(_0x550960(0x1ef))/0x2*(parseInt(_0x550960(0x19c))/0x3)+-parseInt(_0x550960(0x1bb))/0x4*(-parseInt(_0x550960(0x1b0))/0x5)+-parseInt(_0x550960(0x1b7))/0x6+parseInt(_0x550960(0x1b2))/0x7*(-parseInt(_0x550960(0x1da))/0x8)+parseInt(_0x550960(0x1a1))/0x9*(-parseInt(_0x550960(0x1bd))/0xa)+parseInt(_0x550960(0x206))/0xb;if(_0x5611b1===_0x170361)break;else _0x3a7999['push'](_0x3a7999['shift']());}catch(_0x51e64f){_0x3a7999['push'](_0x3a7999['shift']());}}}(a51_0x5ad5,0x35c4c));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a51_0x1d8fb4(0x202)]=void 0x0;const loggerService_1=require(a51_0x1d8fb4(0x1a4));class PlisioService{constructor(){const _0x571894=a51_0x1d8fb4;this['apiUrl']='https://api.plisio.net/api/v1/invoices/new',this[_0x571894(0x1c0)]=process[_0x571894(0x1f1)][_0x571894(0x1e9)]||'',!this[_0x571894(0x1c0)]?console['warn'](_0x571894(0x1ae)):console[_0x571894(0x1e8)](_0x571894(0x20a));}async['createPayment'](_0x51f174){const _0x169c79=a51_0x1d8fb4,{orderId:_0x508e25,amount:_0x56bfbe,currency:_0x2f9765,productName:_0x127714,description:_0x2a494c,successUrl:_0x347d7a,failUrl:_0xcd5785,customerEmail:_0x32fb6a,customerName:_0x2c4eae,isSourceCurrency:_0x5b67fc,sourceCurrency:_0x22b126}=_0x51f174;if(!this[_0x169c79(0x1c0)])throw new Error(_0x169c79(0x1ce));const _0xb8c17c=new URLSearchParams({'api_key':this[_0x169c79(0x1c0)],'order_number':_0x508e25,'order_name':_0x127714,'description':_0x2a494c,'success_url':_0x347d7a,'fail_url':_0xcd5785,'callback_url':'https://api.trapay.uk/api/webhooks/gateway/plisio'});_0x22b126?(_0xb8c17c['append'](_0x169c79(0x1f5),_0x22b126),_0xb8c17c[_0x169c79(0x1f7)](_0x169c79(0x204),_0x2f9765),_0xb8c17c[_0x169c79(0x1f7)](_0x169c79(0x1b1),_0x56bfbe['toString']())):(_0xb8c17c[_0x169c79(0x1f7)]('currency',_0x2f9765),_0xb8c17c['append'](_0x169c79(0x1e2),_0x56bfbe['toString']()));_0x32fb6a&&_0xb8c17c[_0x169c79(0x1f7)]('email',_0x32fb6a);_0x2c4eae&&_0xb8c17c[_0x169c79(0x1f7)](_0x169c79(0x1b3),_0x2c4eae);const _0x5722d8=this[_0x169c79(0x1b8)]+'?'+_0xb8c17c[_0x169c79(0x1e6)](),_0x3b40e6=Date[_0x169c79(0x1cd)]();try{console[_0x169c79(0x1e8)](_0x169c79(0x19d)),console[_0x169c79(0x1e8)](_0x169c79(0x1d9),this[_0x169c79(0x1b8)]),console['log']('Parameters:',Object['fromEntries'](_0xb8c17c[_0x169c79(0x1fe)]())),console[_0x169c79(0x1e8)](_0x169c79(0x1f0),_0x5722d8['replace'](this[_0x169c79(0x1c0)],'HIDDEN')),loggerService_1[_0x169c79(0x1a2)][_0x169c79(0x1ab)]('plisio_direct',_0x169c79(0x1c3),_0x169c79(0x1f2),Object[_0x169c79(0x1bc)](_0xb8c17c[_0x169c79(0x1fe)]()));const _0x3d1677=await fetch(_0x5722d8,{'method':_0x169c79(0x1f2),'headers':{'Accept':_0x169c79(0x1d8),'User-Agent':_0x169c79(0x1dd)}}),_0x1aab48=Date[_0x169c79(0x1cd)]()-_0x3b40e6;console[_0x169c79(0x1e8)](_0x169c79(0x1b4)),console['log'](_0x169c79(0x1f4),_0x3d1677['status']),console[_0x169c79(0x1e8)]('Status\x20Text:',_0x3d1677[_0x169c79(0x1ec)]),console['log']('Response\x20Time:',_0x1aab48+'ms');const _0x5f0bd7=await _0x3d1677['text']();console['log']('Raw\x20Response\x20Body:',_0x5f0bd7);if(!_0x3d1677['ok']){console[_0x169c79(0x1bf)]('===\x20PLISIO\x20API\x20ERROR\x20==='),console[_0x169c79(0x1bf)](_0x169c79(0x1b9),_0x3d1677['status']),console['error'](_0x169c79(0x1f9),_0x5f0bd7),loggerService_1[_0x169c79(0x1a2)][_0x169c79(0x1dc)](_0x169c79(0x1e3),'/invoices/new',_0x3d1677['status'],_0x5f0bd7,_0x1aab48),loggerService_1[_0x169c79(0x1a2)]['logWhiteDomainError'](_0x169c79(0x1e3),_0x169c79(0x1c3),_0x169c79(0x1fd)+_0x3d1677[_0x169c79(0x1ed)]+':\x20'+_0x5f0bd7);throw new Error(_0x169c79(0x1a7)+_0x3d1677[_0x169c79(0x1ed)]+_0x169c79(0x1e5)+_0x5f0bd7);}let _0x2a470a;try{_0x2a470a=JSON[_0x169c79(0x1c5)](_0x5f0bd7);}catch(_0x4db69a){console[_0x169c79(0x1bf)](_0x169c79(0x1c6),_0x4db69a),loggerService_1[_0x169c79(0x1a2)][_0x169c79(0x1d4)](_0x169c79(0x1e3),_0x169c79(0x1c3),_0x169c79(0x1ca)+_0x4db69a);throw new Error(_0x169c79(0x1b6)+_0x5f0bd7);}console['log'](_0x169c79(0x1be)),console[_0x169c79(0x1e8)]('Parsed\x20Result:',JSON[_0x169c79(0x1c2)](_0x2a470a,null,0x2)),loggerService_1[_0x169c79(0x1a2)][_0x169c79(0x1dc)]('plisio_direct',_0x169c79(0x1c3),_0x3d1677[_0x169c79(0x1ed)],_0x2a470a,_0x1aab48);if(_0x2a470a[_0x169c79(0x1ed)]!=='success'){const _0x4e8fb3=_0x2a470a[_0x169c79(0x1c8)]||_0x2a470a[_0x169c79(0x1bf)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x169c79(0x1bf)](_0x169c79(0x1c7)),console['error'](_0x169c79(0x1fb),_0x4e8fb3),loggerService_1[_0x169c79(0x1a2)][_0x169c79(0x1d4)](_0x169c79(0x1e3),_0x169c79(0x1c3),'Business\x20Error:\x20'+_0x4e8fb3);throw new Error(_0x169c79(0x1a8)+_0x4e8fb3);}if(!_0x2a470a[_0x169c79(0x1cc)]?.[_0x169c79(0x1e4)]||!_0x2a470a[_0x169c79(0x1cc)]?.[_0x169c79(0x1f6)]){console[_0x169c79(0x1bf)](_0x169c79(0x1eb)),console[_0x169c79(0x1bf)](_0x169c79(0x1fc)),console[_0x169c79(0x1bf)]('Response\x20data:',_0x2a470a[_0x169c79(0x1cc)]),loggerService_1[_0x169c79(0x1a2)]['logWhiteDomainError'](_0x169c79(0x1e3),'/invoices/new',_0x169c79(0x1cf));throw new Error(_0x169c79(0x1ea));}return console[_0x169c79(0x1e8)]('===\x20PLISIO\x20SUCCESS\x20==='),console[_0x169c79(0x1e8)](_0x169c79(0x1d6),_0x2a470a[_0x169c79(0x1cc)][_0x169c79(0x1e4)]),console[_0x169c79(0x1e8)](_0x169c79(0x1de),_0x2a470a[_0x169c79(0x1cc)][_0x169c79(0x1f6)]),console[_0x169c79(0x1e8)](_0x169c79(0x1c4),_0x56bfbe,_0x2f9765),_0x22b126&&(console[_0x169c79(0x1e8)](_0x169c79(0x200),_0x22b126,'(crypto\x20for\x20payment)'),console[_0x169c79(0x1e8)](_0x169c79(0x1d3),_0x2f9765,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x2a470a[_0x169c79(0x1cc)]['txn_id'],'payment_url':_0x2a470a[_0x169c79(0x1cc)][_0x169c79(0x1f6)],'invoice_total_sum':_0x2a470a[_0x169c79(0x1cc)][_0x169c79(0x19a)],'qr_code':_0x2a470a[_0x169c79(0x1cc)][_0x169c79(0x1d0)],'qr_url':_0x2a470a[_0x169c79(0x1cc)][_0x169c79(0x1ba)]};}catch(_0x162760){console[_0x169c79(0x1bf)](_0x169c79(0x1d2)),console[_0x169c79(0x1bf)]('Error\x20details:',_0x162760),loggerService_1[_0x169c79(0x1a2)][_0x169c79(0x1d4)](_0x169c79(0x1e3),_0x169c79(0x1c3),_0x162760);if(_0x162760 instanceof Error){console['error'](_0x169c79(0x207),_0x162760[_0x169c79(0x1c8)]),console[_0x169c79(0x1bf)]('Error\x20stack:',_0x162760[_0x169c79(0x1a5)]);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x162760[_0x169c79(0x1c8)]);}throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error');}}async[a51_0x1d8fb4(0x1c1)](_0x40d373){const _0x261cea=a51_0x1d8fb4,_0x17682f=Date['now']();try{if(!this[_0x261cea(0x1c0)])throw new Error(_0x261cea(0x1ce));const _0x26fde0=new URLSearchParams({'api_key':this[_0x261cea(0x1c0)],'txn_id':_0x40d373}),_0x543fca='https://api.plisio.net/api/v1/operations/'+_0x40d373+'?'+_0x26fde0['toString']();loggerService_1[_0x261cea(0x1a2)][_0x261cea(0x1ab)](_0x261cea(0x1e3),_0x261cea(0x1c9)+_0x40d373,_0x261cea(0x1f2),Object[_0x261cea(0x1bc)](_0x26fde0[_0x261cea(0x1fe)]()));const _0x4d097c=await fetch(_0x543fca,{'method':_0x261cea(0x1f2),'headers':{'Accept':_0x261cea(0x1d8),'User-Agent':_0x261cea(0x1dd)}}),_0x4b97d8=Date[_0x261cea(0x1cd)]()-_0x17682f;if(!_0x4d097c['ok']){const _0x2ee48f=await _0x4d097c[_0x261cea(0x1ff)]();loggerService_1[_0x261cea(0x1a2)][_0x261cea(0x1dc)](_0x261cea(0x1e3),_0x261cea(0x1c9)+_0x40d373,_0x4d097c['status'],_0x2ee48f,_0x4b97d8);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4d097c[_0x261cea(0x1ed)]);}const _0x2ac462=await _0x4d097c['json']();loggerService_1[_0x261cea(0x1a2)][_0x261cea(0x1dc)](_0x261cea(0x1e3),_0x261cea(0x1c9)+_0x40d373,_0x4d097c[_0x261cea(0x1ed)],_0x2ac462,_0x4b97d8);if(_0x2ac462['status']!==_0x261cea(0x208)){loggerService_1[_0x261cea(0x1a2)]['logWhiteDomainError'](_0x261cea(0x1e3),'/operations/'+_0x40d373,_0x261cea(0x1a8)+(_0x2ac462['message']||_0x2ac462[_0x261cea(0x1bf)]||_0x261cea(0x209)));throw new Error(_0x261cea(0x1a8)+(_0x2ac462[_0x261cea(0x1c8)]||_0x2ac462[_0x261cea(0x1bf)]||_0x261cea(0x209)));}let _0x483a5a=_0x261cea(0x1af);return{'status':_0x483a5a};}catch(_0x3956fb){console[_0x261cea(0x1bf)](_0x261cea(0x19e),_0x3956fb),loggerService_1['loggerService'][_0x261cea(0x1d4)](_0x261cea(0x1e3),_0x261cea(0x1c9)+_0x40d373,_0x3956fb);throw new Error('Failed\x20to\x20verify\x20Plisio\x20payment:\x20'+(_0x3956fb instanceof Error?_0x3956fb[_0x261cea(0x1c8)]:_0x261cea(0x209)));}}async[a51_0x1d8fb4(0x1db)](_0x5243b2){const _0x10a9be=a51_0x1d8fb4;console[_0x10a9be(0x1e8)](_0x10a9be(0x1fa),_0x5243b2);let _0x1939cd=_0x10a9be(0x1af);switch(_0x5243b2[_0x10a9be(0x1ed)]?.[_0x10a9be(0x1f3)]()){case _0x10a9be(0x203):case _0x10a9be(0x1d1):_0x1939cd=_0x10a9be(0x1a3);break;case _0x10a9be(0x1aa):_0x1939cd=_0x10a9be(0x1ee);break;case _0x10a9be(0x1bf):case'cancelled':_0x1939cd=_0x10a9be(0x201);break;case _0x10a9be(0x1e0):_0x1939cd=_0x10a9be(0x1af);break;case _0x10a9be(0x19b):_0x1939cd=_0x10a9be(0x1b5);break;default:_0x1939cd=_0x10a9be(0x1af);break;}let _0x1b904c;if(_0x5243b2['tx_urls'])try{console['log'](_0x10a9be(0x1d5),_0x5243b2[_0x10a9be(0x1ac)]);let _0x203a2b;if(typeof _0x5243b2['tx_urls']===_0x10a9be(0x1ad))_0x203a2b=JSON[_0x10a9be(0x1c5)](_0x5243b2['tx_urls']);else Array[_0x10a9be(0x1df)](_0x5243b2[_0x10a9be(0x1ac)])?_0x203a2b=_0x5243b2[_0x10a9be(0x1ac)]:_0x203a2b=[];_0x1b904c=_0x203a2b[_0x10a9be(0x1d7)](_0x3cbe28=>{const _0x5d602c=_0x10a9be,_0x1ed036=_0x3cbe28['replace'](/\\/g,'');return console[_0x5d602c(0x1e8)](_0x5d602c(0x205)+_0x3cbe28+_0x5d602c(0x199)+_0x1ed036),_0x1ed036;}),console[_0x10a9be(0x1e8)]('✅\x20Processed\x20tx_urls:',_0x1b904c),_0x1b904c[_0x10a9be(0x1a6)]((_0x5ad8fc,_0x1df927)=>{const _0x1a3850=_0x10a9be;try{new URL(_0x5ad8fc),console[_0x1a3850(0x1e8)](_0x1a3850(0x19f)+(_0x1df927+0x1)+'\x20is\x20valid:\x20'+_0x5ad8fc);}catch(_0x6e46cb){console['error'](_0x1a3850(0x1e1)+(_0x1df927+0x1)+_0x1a3850(0x1e7)+_0x5ad8fc,_0x6e46cb);}});}catch(_0x46fb3b){console[_0x10a9be(0x1bf)](_0x10a9be(0x1cb),_0x46fb3b),console[_0x10a9be(0x1bf)](_0x10a9be(0x1a0),_0x5243b2[_0x10a9be(0x1ac)]),_0x1b904c=undefined;}return{'paymentId':_0x5243b2[_0x10a9be(0x1f8)]||'','status':_0x1939cd,'amount':_0x5243b2[_0x10a9be(0x1e2)],'currency':_0x5243b2[_0x10a9be(0x1f5)],'txUrls':_0x1b904c};}}function a51_0x5ad5(){const _0x2d2cb6=['PROCESSING','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','1050096gpGyQK','apiUrl','HTTP\x20Status:','qr_url','4xnMhXc','fromEntries','30jkBrzY','===\x20PARSED\x20PLISIO\x20RESPONSE\x20===','error','apiKey','verifyPayment','stringify','/invoices/new','Amount:','parse','Failed\x20to\x20parse\x20JSON\x20response:','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','message','/operations/','JSON\x20Parse\x20Error:\x20','❌\x20Failed\x20to\x20parse\x20tx_urls:','data','now','Plisio\x20API\x20key\x20is\x20not\x20configured','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url','qr_code','mismatch','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','Target\x20Currency:','logWhiteDomainError','🔗\x20Raw\x20tx_urls\x20from\x20Plisio:','Transaction\x20ID:','map','application/json','URL:','8Lqzmwq','processWebhook','logWhiteDomainResponse','TesSoft\x20Payment\x20System/1.0','Invoice\x20URL:','isArray','new','❌\x20URL\x20','amount','plisio_direct','txn_id',',\x20body:\x20','toString','\x20is\x20invalid:\x20','log','PLISIO_API_KEY','Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','statusText','status','EXPIRED','12WaKLVq','Full\x20URL\x20(without\x20API\x20key):','env','GET','toLowerCase','Status:','currency','invoice_url','append','order_number','Response\x20Body:','Processing\x20Plisio\x20webhook:','Error\x20Message:','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','HTTP\x20','entries','text','Source\x20Currency:','FAILED','PlisioService','completed','source_currency','🔗\x20Formatted\x20URL:\x20','4095025bhepTT','Error\x20message:','success','Unknown\x20error','💰\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','\x20->\x20','invoice_total_sum','pending','98064jOIuFJ','===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20===','Plisio\x20payment\x20verification\x20error:','✅\x20URL\x20','Raw\x20tx_urls\x20data:','636219HdYZYb','loggerService','PAID','../loggerService','stack','forEach','HTTP\x20error!\x20status:\x20','Plisio\x20API\x20error:\x20','207478bleQHK','expired','logWhiteDomainRequest','tx_urls','string','⚠️\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','PENDING','1073425QiQbkF','source_amount','2682687cUDiPU','name','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20==='];a51_0x5ad5=function(){return _0x2d2cb6;};return a51_0x5ad5();}exports['PlisioService']=PlisioService;