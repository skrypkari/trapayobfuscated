'use strict';const a49_0x1bd6b6=a49_0x2914;(function(_0x2fc4b2,_0x14b2c4){const _0x187cac=a49_0x2914,_0x31c500=_0x2fc4b2();while(!![]){try{const _0x2cb01e=-parseInt(_0x187cac(0x1c1))/0x1*(-parseInt(_0x187cac(0x1e8))/0x2)+parseInt(_0x187cac(0x201))/0x3+parseInt(_0x187cac(0x1aa))/0x4+parseInt(_0x187cac(0x186))/0x5*(-parseInt(_0x187cac(0x1c7))/0x6)+parseInt(_0x187cac(0x1cc))/0x7*(parseInt(_0x187cac(0x1eb))/0x8)+-parseInt(_0x187cac(0x188))/0x9+-parseInt(_0x187cac(0x204))/0xa;if(_0x2cb01e===_0x14b2c4)break;else _0x31c500['push'](_0x31c500['shift']());}catch(_0x3b53e4){_0x31c500['push'](_0x31c500['shift']());}}}(a49_0xc63e,0xc0f16));Object[a49_0x1bd6b6(0x1ea)](exports,'__esModule',{'value':!![]}),exports[a49_0x1bd6b6(0x1fe)]=void 0x0;const loggerService_1=require(a49_0x1bd6b6(0x187));function a49_0x2914(_0xac4722,_0x3a61b1){const _0xc63eab=a49_0xc63e();return a49_0x2914=function(_0x29142e,_0xfeef16){_0x29142e=_0x29142e-0x183;let _0x4d4d80=_0xc63eab[_0x29142e];return _0x4d4d80;},a49_0x2914(_0xac4722,_0x3a61b1);}function a49_0xc63e(){const _0xe65174=['Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','verifyPayment','currency','Request\x20Body:','message','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','gateway_payment_id','üè¶\x20Payment\x20Detail:','EUR','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','/status','not\x20found','expired','now','QRCodeURL','payment_url','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','ExpiryTime','log','HTTP\x20Status:','logWhiteDomainError','Unknown\x20error\x20from\x20CoinToPay\x20API','Status\x20API\x20Error:\x20','toLowerCase','Result:','statusUrl','956388vEtMDD','Error\x20message:','PaymentDetail','Response\x20Time:','üìä\x20Status\x20check\x20URL:','CoinToPay\x20payment\x20status\x20check\x20error:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','fromEntries','EXPIRED','timeout','entries','Error\x20details:','Incomplete\x20response:\x20missing\x20data','status','Error\x20stack:','paid','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','loggerService','https://tesoft.uk/gateway/cointopay/status.php','CoinToPay\x20API\x20error:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','PAID','cancelled','2UnAqyr','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Status\x20Code:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Amount','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','36hTsyYz','created','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','error','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','7rAJRhW','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','cointopay','apiUrl','Response\x20data:','Raw\x20Response\x20Body:','Amount:','createPaymentLink','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','stack','result','application/json','success','data','HTTP\x20','/create','Parsed\x20Result:','logWhiteDomainResponse','Error\x20Message:','Currency:','Missing\x20data\x20in\x20response','not\x20confirmed','amount','FAILED','inputCurrency','stringify','POST','CreatedOn','395534bHXIPJ','JSON\x20Parse\x20Error:\x20','defineProperty','6954728QISedL','&alternative=false','Transaction\x20ID:','match','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Confirmed\x20On:','PENDING','logWhiteDomainRequest','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','text','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Payment\x20System/1.0','Failed\x20to\x20parse\x20JSON\x20response:','Status','checkPaymentStatus','status_code','awaiting\x20fiat','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Status:','CoinToPayService','parse','headers','2880108xpRthg','Payment\x20URL\x20(original):','waiting','5402300jqRrZA','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Gateway\x20Payment\x20ID:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','366290YOqNkX','../loggerService','6245424rkDDSg','Headers:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','TransactionConfirmedOn','merchant_reference_id','\x20EUR','failed','Response\x20Body:'];a49_0xc63e=function(){return _0xe65174;};return a49_0xc63e();}class CoinToPayService{constructor(){const _0x5efc2=a49_0x1bd6b6;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this[_0x5efc2(0x1a9)]=_0x5efc2(0x1bc),console['log'](_0x5efc2(0x1f5)),console[_0x5efc2(0x1a2)](_0x5efc2(0x1ae),this['statusUrl']);}async[a49_0x1bd6b6(0x1d3)](_0x1928d2){const _0x49b14c=a49_0x1bd6b6,{orderId:_0x4e575a,amount:_0x12610e}=_0x1928d2;console[_0x49b14c(0x1a2)](_0x49b14c(0x18a)+_0x12610e+_0x49b14c(0x18d));const _0x1acda5={'amount':_0x12610e},_0x2b31c0=Date['now']();try{console[_0x49b14c(0x1a2)](_0x49b14c(0x1c9)),console['log']('URL:',this[_0x49b14c(0x1cf)]),console[_0x49b14c(0x1a2)](_0x49b14c(0x193),JSON[_0x49b14c(0x1e5)](_0x1acda5,null,0x2)),console[_0x49b14c(0x1a2)]('Amount:',_0x12610e,_0x49b14c(0x1b0)),loggerService_1[_0x49b14c(0x1bb)][_0x49b14c(0x1f2)](_0x49b14c(0x1ce),_0x49b14c(0x1db),'POST',_0x1acda5);const _0x3055d3=await fetch(this[_0x49b14c(0x1cf)],{'method':_0x49b14c(0x1e6),'headers':{'Content-Type':_0x49b14c(0x1d7),'Accept':'application/json','User-Agent':_0x49b14c(0x1f6)},'body':JSON[_0x49b14c(0x1e5)](_0x1acda5)}),_0x38e9c6=Date['now']()-_0x2b31c0;console['log'](_0x49b14c(0x1be)),console[_0x49b14c(0x1a2)](_0x49b14c(0x1fd),_0x3055d3['status']),console[_0x49b14c(0x1a2)]('Status\x20Text:',_0x3055d3['statusText']),console['log'](_0x49b14c(0x189),Object[_0x49b14c(0x1b1)](_0x3055d3[_0x49b14c(0x200)][_0x49b14c(0x1b4)]())),console[_0x49b14c(0x1a2)](_0x49b14c(0x1ad),_0x38e9c6+'ms');const _0x40ad11=await _0x3055d3[_0x49b14c(0x1f4)]();console[_0x49b14c(0x1a2)](_0x49b14c(0x1d1),_0x40ad11);if(!_0x3055d3['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x49b14c(0x1a3),_0x3055d3[_0x49b14c(0x1b7)]),console[_0x49b14c(0x1ca)](_0x49b14c(0x18f),_0x40ad11),loggerService_1[_0x49b14c(0x1bb)]['logWhiteDomainResponse'](_0x49b14c(0x1ce),_0x49b14c(0x1db),_0x3055d3[_0x49b14c(0x1b7)],_0x40ad11,_0x38e9c6),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x49b14c(0x1db),_0x49b14c(0x1da)+_0x3055d3[_0x49b14c(0x1b7)]+':\x20'+_0x40ad11);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3055d3[_0x49b14c(0x1b7)]+',\x20body:\x20'+_0x40ad11);}let _0x41f2bd;try{_0x41f2bd=JSON[_0x49b14c(0x1ff)](_0x40ad11);}catch(_0x479a11){console['error'](_0x49b14c(0x1f7),_0x479a11),loggerService_1['loggerService'][_0x49b14c(0x1a4)](_0x49b14c(0x1ce),'/create',_0x49b14c(0x1e9)+_0x479a11);throw new Error(_0x49b14c(0x1c4)+_0x40ad11);}console[_0x49b14c(0x1a2)](_0x49b14c(0x185)),console[_0x49b14c(0x1a2)](_0x49b14c(0x1dc),JSON[_0x49b14c(0x1e5)](_0x41f2bd,null,0x2)),loggerService_1['loggerService'][_0x49b14c(0x1dd)]('cointopay',_0x49b14c(0x1db),_0x3055d3[_0x49b14c(0x1b7)],_0x41f2bd,_0x38e9c6);if(_0x41f2bd[_0x49b14c(0x1ca)]){const _0x3b93fa=_0x41f2bd['message']||_0x41f2bd['error']||_0x49b14c(0x1a5);console[_0x49b14c(0x1ca)](_0x49b14c(0x1cd)),console['error'](_0x49b14c(0x1de),_0x3b93fa),loggerService_1[_0x49b14c(0x1bb)]['logWhiteDomainError']('cointopay',_0x49b14c(0x1db),'Business\x20Error:\x20'+_0x3b93fa);throw new Error(_0x49b14c(0x1bd)+_0x3b93fa);}if(!_0x41f2bd['payment_url']||!_0x41f2bd['gateway_payment_id']){console['error'](_0x49b14c(0x1a0)),console[_0x49b14c(0x1ca)](_0x49b14c(0x1d4)),console[_0x49b14c(0x1ca)](_0x49b14c(0x1d0),_0x41f2bd),loggerService_1[_0x49b14c(0x1bb)][_0x49b14c(0x1a4)](_0x49b14c(0x1ce),_0x49b14c(0x1db),_0x49b14c(0x1cb));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x49b14c(0x1a2)](_0x49b14c(0x184),_0x41f2bd[_0x49b14c(0x196)]),console['log'](_0x49b14c(0x202),_0x41f2bd['payment_url']);const _0x5c976=_0x41f2bd[_0x49b14c(0x19f)]+_0x49b14c(0x1ec);return console[_0x49b14c(0x1a2)]('Payment\x20URL\x20(modified):',_0x5c976),console[_0x49b14c(0x1a2)](_0x49b14c(0x1d2),_0x12610e,_0x49b14c(0x198)),{'gateway_payment_id':_0x41f2bd[_0x49b14c(0x196)],'payment_url':_0x5c976};}catch(_0x2a91dd){console[_0x49b14c(0x1ca)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x49b14c(0x1ca)](_0x49b14c(0x1b5),_0x2a91dd),loggerService_1['loggerService']['logWhiteDomainError'](_0x49b14c(0x1ce),'/create',_0x2a91dd);if(_0x2a91dd instanceof Error){console[_0x49b14c(0x1ca)](_0x49b14c(0x1ab),_0x2a91dd[_0x49b14c(0x194)]),console[_0x49b14c(0x1ca)](_0x49b14c(0x1b8),_0x2a91dd[_0x49b14c(0x1d5)]);throw new Error(_0x49b14c(0x199)+_0x2a91dd[_0x49b14c(0x194)]);}throw new Error(_0x49b14c(0x1c2));}}async['checkPaymentStatus'](_0x13d173){const _0x26156d=a49_0x1bd6b6,_0x1595d8=Date['now']();try{console['log'](_0x26156d(0x1c6)+_0x13d173);const _0x341c7a={'gatewayPaymentId':_0x13d173};loggerService_1[_0x26156d(0x1bb)][_0x26156d(0x1f2)](_0x26156d(0x1ce),_0x26156d(0x19a),_0x26156d(0x1e6),_0x341c7a);const _0x3bf7a1=await fetch(this[_0x26156d(0x1a9)],{'method':_0x26156d(0x1e6),'headers':{'Content-Type':'application/json','Accept':_0x26156d(0x1d7),'User-Agent':_0x26156d(0x1f6)},'body':JSON[_0x26156d(0x1e5)](_0x341c7a)}),_0x4c13e8=Date[_0x26156d(0x19d)]()-_0x1595d8;console[_0x26156d(0x1a2)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x26156d(0x1a2)](_0x26156d(0x1fd),_0x3bf7a1[_0x26156d(0x1b7)]),console[_0x26156d(0x1a2)](_0x26156d(0x1ad),_0x4c13e8+'ms');if(!_0x3bf7a1['ok']){const _0xe70f8b=await _0x3bf7a1[_0x26156d(0x1f4)]();console[_0x26156d(0x1ca)](_0x26156d(0x1a3),_0x3bf7a1[_0x26156d(0x1b7)]),console[_0x26156d(0x1ca)](_0x26156d(0x18f),_0xe70f8b),loggerService_1[_0x26156d(0x1bb)][_0x26156d(0x1dd)](_0x26156d(0x1ce),'/status',_0x3bf7a1[_0x26156d(0x1b7)],_0xe70f8b,_0x4c13e8),loggerService_1['loggerService'][_0x26156d(0x1a4)](_0x26156d(0x1ce),'/status',_0x26156d(0x1da)+_0x3bf7a1[_0x26156d(0x1b7)]+':\x20'+_0xe70f8b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3bf7a1[_0x26156d(0x1b7)]);}const _0x4271d4=await _0x3bf7a1['text']();console[_0x26156d(0x1a2)]('Raw\x20Response\x20Body:',_0x4271d4);let _0x179fcd;try{_0x179fcd=JSON[_0x26156d(0x1ff)](_0x4271d4);}catch(_0x312bf5){console[_0x26156d(0x1ca)](_0x26156d(0x1f7),_0x312bf5),loggerService_1['loggerService'][_0x26156d(0x1a4)]('cointopay',_0x26156d(0x19a),_0x26156d(0x1e9)+_0x312bf5);throw new Error(_0x26156d(0x1ef)+_0x4271d4);}loggerService_1[_0x26156d(0x1bb)]['logWhiteDomainResponse'](_0x26156d(0x1ce),_0x26156d(0x19a),_0x3bf7a1[_0x26156d(0x1b7)],_0x179fcd,_0x4c13e8),console[_0x26156d(0x1a2)](_0x26156d(0x1fc)),console[_0x26156d(0x1a2)](_0x26156d(0x1a8),_0x179fcd[_0x26156d(0x1d6)]),console[_0x26156d(0x1a2)](_0x26156d(0x1c3),_0x179fcd[_0x26156d(0x1fa)]),console[_0x26156d(0x1a2)]('Payment\x20Status:',_0x179fcd[_0x26156d(0x1d9)]?.[_0x26156d(0x1f8)]),console[_0x26156d(0x1a2)]('Amount:',_0x179fcd['data']?.[_0x26156d(0x1c5)]),console[_0x26156d(0x1a2)](_0x26156d(0x1df),_0x179fcd['data']?.['inputCurrency']);if(_0x179fcd['result']!==_0x26156d(0x1d8)||_0x179fcd[_0x26156d(0x1fa)]!==0xc8){const _0x19df78=_0x179fcd[_0x26156d(0x194)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x19df78),loggerService_1[_0x26156d(0x1bb)][_0x26156d(0x1a4)](_0x26156d(0x1ce),_0x26156d(0x19a),_0x26156d(0x1a6)+_0x19df78);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x19df78);}if(!_0x179fcd[_0x26156d(0x1d9)]){console[_0x26156d(0x1ca)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x26156d(0x1ca)](_0x26156d(0x1e0)),loggerService_1[_0x26156d(0x1bb)]['logWhiteDomainError'](_0x26156d(0x1ce),_0x26156d(0x19a),_0x26156d(0x1b6));throw new Error(_0x26156d(0x190));}let _0x17e87b=_0x26156d(0x1f1);switch(_0x179fcd[_0x26156d(0x1d9)][_0x26156d(0x1f8)]?.[_0x26156d(0x1a7)]()){case _0x26156d(0x1b9):_0x17e87b='PAID';break;case'cancelled':case _0x26156d(0x18e):case _0x26156d(0x1ca):_0x17e87b=_0x26156d(0x1e3);break;case'expired':case _0x26156d(0x1b3):_0x17e87b='EXPIRED';break;case'waiting':case _0x26156d(0x1fb):case'pending':case'created':default:_0x17e87b=_0x26156d(0x1f1);break;}let _0x1efdff,_0x442b7f;if(_0x179fcd[_0x26156d(0x1d9)][_0x26156d(0x1ac)]){const _0x5f3e5b=_0x179fcd[_0x26156d(0x1d9)][_0x26156d(0x1ac)];console[_0x26156d(0x1a2)](_0x26156d(0x197),_0x5f3e5b);const _0x43b124=_0x5f3e5b[_0x26156d(0x1ee)](/IBAN\s+([A-Z0-9]+)/i);_0x43b124&&(_0x1efdff=_0x43b124[0x1],console[_0x26156d(0x1a2)]('üè¶\x20Extracted\x20IBAN:',_0x1efdff)),_0x442b7f=_0x5f3e5b;}const _0x1b92ae={'iban':_0x1efdff,'bankDetails':_0x442b7f,'transactionId':_0x179fcd[_0x26156d(0x1d9)]['TransactionID'],'coinAddress':_0x179fcd[_0x26156d(0x1d9)]['coinAddress'],'qrCodeUrl':_0x179fcd['data'][_0x26156d(0x19e)],'expiryTime':_0x179fcd[_0x26156d(0x1d9)][_0x26156d(0x1a1)],'createdOn':_0x179fcd[_0x26156d(0x1d9)][_0x26156d(0x1e7)],'confirmedOn':_0x179fcd['data']['TransactionConfirmedOn']};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console['log'](_0x26156d(0x1fd),_0x179fcd[_0x26156d(0x1d9)][_0x26156d(0x1f8)],'->',_0x17e87b),console[_0x26156d(0x1a2)](_0x26156d(0x1d2),_0x179fcd[_0x26156d(0x1d9)]['Amount'],_0x179fcd[_0x26156d(0x1d9)]['inputCurrency']),console[_0x26156d(0x1a2)](_0x26156d(0x1ed),_0x179fcd[_0x26156d(0x1d9)]['TransactionID']),console[_0x26156d(0x1a2)]('IBAN:',_0x1efdff||_0x26156d(0x19b)),console['log']('Created\x20On:',_0x179fcd['data'][_0x26156d(0x1e7)]),console[_0x26156d(0x1a2)](_0x26156d(0x1f0),_0x179fcd[_0x26156d(0x1d9)][_0x26156d(0x18b)]||_0x26156d(0x1e1));if(_0x179fcd[_0x26156d(0x1d9)][_0x26156d(0x1f8)]?.[_0x26156d(0x1a7)]()===_0x26156d(0x1fb))console[_0x26156d(0x1a2)](_0x26156d(0x1f3));else _0x179fcd[_0x26156d(0x1d9)]['Status']?.[_0x26156d(0x1a7)]()===_0x26156d(0x1b9)&&console[_0x26156d(0x1a2)](_0x26156d(0x195));return{'status':_0x17e87b,'amount':parseFloat(_0x179fcd[_0x26156d(0x1d9)][_0x26156d(0x1c5)])||undefined,'currency':_0x179fcd['data'][_0x26156d(0x1e4)]||_0x26156d(0x198),'paymentDetails':_0x1b92ae};}catch(_0x3259ef){console[_0x26156d(0x1ca)](_0x26156d(0x1af),_0x3259ef),loggerService_1['loggerService'][_0x26156d(0x1a4)]('cointopay',_0x26156d(0x19a),_0x3259ef);throw new Error(_0x26156d(0x1ba)+(_0x3259ef instanceof Error?_0x3259ef['message']:'Unknown\x20error'));}}async[a49_0x1bd6b6(0x191)](_0x43a929){const _0x3bdc18=a49_0x1bd6b6,_0x31a045=await this[_0x3bdc18(0x1f9)](_0x43a929);return{'status':_0x31a045[_0x3bdc18(0x1b7)],'amount':_0x31a045[_0x3bdc18(0x1e2)],'currency':_0x31a045['currency']};}async['processWebhook'](_0x4d2ea2){const _0x522f1d=a49_0x1bd6b6;console[_0x522f1d(0x1a2)](_0x522f1d(0x183),_0x4d2ea2);let _0x3b233c=_0x522f1d(0x1f1);switch(_0x4d2ea2[_0x522f1d(0x1b7)]?.['toLowerCase']()){case'paid':_0x3b233c=_0x522f1d(0x1bf);break;case _0x522f1d(0x1c0):case _0x522f1d(0x18e):case'error':_0x3b233c=_0x522f1d(0x1e3);break;case _0x522f1d(0x19c):case'timeout':_0x3b233c=_0x522f1d(0x1b2);break;case'pending':case _0x522f1d(0x203):case _0x522f1d(0x1fb):case _0x522f1d(0x1c8):default:_0x3b233c=_0x522f1d(0x1f1);break;}return{'paymentId':_0x4d2ea2['order_id']||_0x4d2ea2[_0x522f1d(0x18c)]||'','status':_0x3b233c,'amount':_0x4d2ea2['amount'],'currency':_0x4d2ea2[_0x522f1d(0x192)]||_0x522f1d(0x198)};}}exports[a49_0x1bd6b6(0x1fe)]=CoinToPayService;