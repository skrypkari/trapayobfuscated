'use strict';const a55_0x44a2b3=a55_0x27d8;function a55_0x33d5(){const _0x2f8b1f=['toLowerCase','created','waiting','logWhiteDomainRequest','status_code','Parsed\x20Result:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','status','Failed\x20to\x20parse\x20JSON\x20response:','success','Response\x20data:','Confirmed\x20On:','Unknown\x20error','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','HTTP\x20','__esModule','HTTP\x20Status:','match','not\x20confirmed','Request\x20Body:','defineProperty','5130NgBwec','PaymentDetail','Currency:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','order_id','application/json','verifyPayment','/create','paid','cointopay','IBAN:','now','Status:','Response\x20Body:','PENDING','pending','Payment\x20System/1.0','logWhiteDomainError','54476bPuKBY','36EZEmjL','checkPaymentStatus','EUR',',\x20body:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','statusUrl','result','HTTP\x20error!\x20status:\x20','expired','Error\x20message:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20details:','https://tesoft.uk/gateway/cointopay/','entries','not\x20found','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','failed','198054GMkcON','420XHZmhb','Amount:','Payment\x20URL\x20(modified):','loggerService','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','CoinToPay\x20payment\x20status\x20check\x20error:','CoinToPay\x20API\x20error:\x20','statusText','2939314PppAoO','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','316693szdVjp','timeout','data','Payment\x20URL\x20(original):','===\x20COINTOPAY\x20SUCCESS\x20===','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','createPaymentLink','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Business\x20Error:\x20','merchant_reference_id','apiUrl','URL:','stringify','stack','===\x20COINTOPAY\x20API\x20ERROR\x20===','fromEntries','155daApgL','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','EXPIRED','PAID','119367HPbRcn','Amount','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','ðŸ¦\x20Extracted\x20IBAN:','gateway_payment_id','TransactionConfirmedOn','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Missing\x20data\x20in\x20response','awaiting\x20fiat','text','inputCurrency','395054gqNjom','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20Message:','CoinToPayService','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Headers:','error','POST','ExpiryTime','Transaction\x20ID:','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','amount','Status\x20Text:','cancelled','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','message','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','52QjhNaR','payment_url','coinAddress','QRCodeURL','11992CYAmcw','Status','currency','Gateway\x20Payment\x20ID:','/status','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','JSON\x20Parse\x20Error:\x20','log','Raw\x20Response\x20Body:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','logWhiteDomainResponse','Response\x20Time:','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','FAILED','204QkopdO','TransactionID','Incomplete\x20response:\x20missing\x20data'];a55_0x33d5=function(){return _0x2f8b1f;};return a55_0x33d5();}(function(_0x2136db,_0x585ce3){const _0x245dfb=a55_0x27d8,_0x267208=_0x2136db();while(!![]){try{const _0x51beda=-parseInt(_0x245dfb(0xee))/0x1*(parseInt(_0x245dfb(0xed))/0x2)+-parseInt(_0x245dfb(0x121))/0x3*(-parseInt(_0x245dfb(0xb1))/0x4)+parseInt(_0x245dfb(0x11d))/0x5*(-parseInt(_0x245dfb(0xff))/0x6)+-parseInt(_0x245dfb(0x108))/0x7+parseInt(_0x245dfb(0xb5))/0x8*(parseInt(_0x245dfb(0xdb))/0x9)+parseInt(_0x245dfb(0x100))/0xa*(parseInt(_0x245dfb(0x9f))/0xb)+-parseInt(_0x245dfb(0xc3))/0xc*(-parseInt(_0x245dfb(0x10a))/0xd);if(_0x51beda===_0x585ce3)break;else _0x267208['push'](_0x267208['shift']());}catch(_0x387834){_0x267208['push'](_0x267208['shift']());}}}(a55_0x33d5,0xd483f));Object[a55_0x44a2b3(0xda)](exports,a55_0x44a2b3(0xd5),{'value':!![]}),exports[a55_0x44a2b3(0xa3)]=void 0x0;function a55_0x27d8(_0x3a36cd,_0x85be9b){_0x3a36cd=_0x3a36cd-0x99;const _0x33d59a=a55_0x33d5();let _0x27d871=_0x33d59a[_0x3a36cd];return _0x27d871;}const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x371f3e=a55_0x44a2b3;this[_0x371f3e(0x117)]=_0x371f3e(0xfa),this[_0x371f3e(0xf3)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x371f3e(0xbc)](_0x371f3e(0xaa)),console[_0x371f3e(0xbc)]('ðŸ“Š\x20Status\x20check\x20URL:',this[_0x371f3e(0xf3)]);}async[a55_0x44a2b3(0x112)](_0x2d59f7){const _0x195e6d=a55_0x44a2b3,{orderId:_0x4e2ce9,amount:_0x423b21}=_0x2d59f7;console[_0x195e6d(0xbc)](_0x195e6d(0xc1)+_0x423b21+'\x20EUR');const _0x2f7c17={'amount':_0x423b21},_0x3603c3=Date[_0x195e6d(0xe6)]();try{console[_0x195e6d(0xbc)](_0x195e6d(0xa0)),console[_0x195e6d(0xbc)](_0x195e6d(0x118),this[_0x195e6d(0x117)]),console[_0x195e6d(0xbc)](_0x195e6d(0xd9),JSON[_0x195e6d(0x119)](_0x2f7c17,null,0x2)),console[_0x195e6d(0xbc)](_0x195e6d(0x101),_0x423b21,_0x195e6d(0xd3)),loggerService_1[_0x195e6d(0x103)][_0x195e6d(0xc9)]('cointopay',_0x195e6d(0xe2),_0x195e6d(0xa7),_0x2f7c17);const _0x520d9f=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x195e6d(0xe0),'User-Agent':_0x195e6d(0xeb)},'body':JSON[_0x195e6d(0x119)](_0x2f7c17)}),_0x47fa91=Date[_0x195e6d(0xe6)]()-_0x3603c3;console[_0x195e6d(0xbc)](_0x195e6d(0xf8)),console['log']('Status:',_0x520d9f[_0x195e6d(0xcd)]),console['log'](_0x195e6d(0xac),_0x520d9f[_0x195e6d(0x107)]),console['log'](_0x195e6d(0xa5),Object[_0x195e6d(0x11c)](_0x520d9f['headers'][_0x195e6d(0xfb)]())),console['log'](_0x195e6d(0xc0),_0x47fa91+'ms');const _0x45d2e4=await _0x520d9f[_0x195e6d(0x9d)]();console['log'](_0x195e6d(0xbd),_0x45d2e4);if(!_0x520d9f['ok']){console[_0x195e6d(0xa6)](_0x195e6d(0x11b)),console[_0x195e6d(0xa6)]('HTTP\x20Status:',_0x520d9f['status']),console[_0x195e6d(0xa6)](_0x195e6d(0xe8),_0x45d2e4),loggerService_1[_0x195e6d(0x103)]['logWhiteDomainResponse'](_0x195e6d(0xe4),'/create',_0x520d9f[_0x195e6d(0xcd)],_0x45d2e4,_0x47fa91),loggerService_1[_0x195e6d(0x103)][_0x195e6d(0xec)](_0x195e6d(0xe4),'/create',_0x195e6d(0xd4)+_0x520d9f[_0x195e6d(0xcd)]+':\x20'+_0x45d2e4);throw new Error('HTTP\x20error!\x20status:\x20'+_0x520d9f[_0x195e6d(0xcd)]+_0x195e6d(0xf1)+_0x45d2e4);}let _0x14f573;try{_0x14f573=JSON['parse'](_0x45d2e4);}catch(_0x444134){console[_0x195e6d(0xa6)](_0x195e6d(0xce),_0x444134),loggerService_1['loggerService'][_0x195e6d(0xec)](_0x195e6d(0xe4),_0x195e6d(0xe2),_0x195e6d(0xbb)+_0x444134);throw new Error(_0x195e6d(0x114)+_0x45d2e4);}console[_0x195e6d(0xbc)](_0x195e6d(0xde)),console[_0x195e6d(0xbc)](_0x195e6d(0xcb),JSON[_0x195e6d(0x119)](_0x14f573,null,0x2)),loggerService_1[_0x195e6d(0x103)][_0x195e6d(0xbf)](_0x195e6d(0xe4),'/create',_0x520d9f[_0x195e6d(0xcd)],_0x14f573,_0x47fa91);if(_0x14f573[_0x195e6d(0xa6)]){const _0x4333d9=_0x14f573['message']||_0x14f573[_0x195e6d(0xa6)]||_0x195e6d(0xf2);console[_0x195e6d(0xa6)](_0x195e6d(0x123)),console[_0x195e6d(0xa6)](_0x195e6d(0xa2),_0x4333d9),loggerService_1[_0x195e6d(0x103)][_0x195e6d(0xec)](_0x195e6d(0xe4),_0x195e6d(0xe2),_0x195e6d(0x115)+_0x4333d9);throw new Error(_0x195e6d(0x106)+_0x4333d9);}if(!_0x14f573['payment_url']||!_0x14f573['gateway_payment_id']){console[_0x195e6d(0xa6)](_0x195e6d(0x109)),console[_0x195e6d(0xa6)](_0x195e6d(0x104)),console[_0x195e6d(0xa6)](_0x195e6d(0xd0),_0x14f573),loggerService_1[_0x195e6d(0x103)]['logWhiteDomainError'](_0x195e6d(0xe4),'/create',_0x195e6d(0xa1));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console['log'](_0x195e6d(0x10e)),console[_0x195e6d(0xbc)](_0x195e6d(0xb8),_0x14f573[_0x195e6d(0x126)]),console[_0x195e6d(0xbc)](_0x195e6d(0x10d),_0x14f573[_0x195e6d(0xb2)]);const _0x2b4275=_0x14f573[_0x195e6d(0xb2)]+'&alternative=false';return console[_0x195e6d(0xbc)](_0x195e6d(0x102),_0x2b4275),console[_0x195e6d(0xbc)](_0x195e6d(0x101),_0x423b21,'EUR'),{'gateway_payment_id':_0x14f573[_0x195e6d(0x126)],'payment_url':_0x2b4275};}catch(_0x5b4a59){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x195e6d(0xa6)](_0x195e6d(0xf9),_0x5b4a59),loggerService_1['loggerService'][_0x195e6d(0xec)](_0x195e6d(0xe4),_0x195e6d(0xe2),_0x5b4a59);if(_0x5b4a59 instanceof Error){console[_0x195e6d(0xa6)](_0x195e6d(0xf7),_0x5b4a59['message']),console[_0x195e6d(0xa6)]('Error\x20stack:',_0x5b4a59[_0x195e6d(0x11a)]);throw new Error(_0x195e6d(0xbe)+_0x5b4a59[_0x195e6d(0xaf)]);}throw new Error(_0x195e6d(0x110));}}async[a55_0x44a2b3(0xef)](_0x4a87ae){const _0x41e1e0=a55_0x44a2b3,_0x4b8797=Date[_0x41e1e0(0xe6)]();try{console[_0x41e1e0(0xbc)](_0x41e1e0(0x111)+_0x4a87ae);const _0x36b9c7={'gatewayPaymentId':_0x4a87ae};loggerService_1[_0x41e1e0(0x103)][_0x41e1e0(0xc9)]('cointopay','/status',_0x41e1e0(0xa7),_0x36b9c7);const _0x142151=await fetch(this[_0x41e1e0(0xf3)],{'method':_0x41e1e0(0xa7),'headers':{'Content-Type':'application/json','Accept':_0x41e1e0(0xe0),'User-Agent':_0x41e1e0(0xeb)},'body':JSON['stringify'](_0x36b9c7)}),_0xc0fe0e=Date['now']()-_0x4b8797;console[_0x41e1e0(0xbc)](_0x41e1e0(0xb0)),console[_0x41e1e0(0xbc)]('Status:',_0x142151[_0x41e1e0(0xcd)]),console[_0x41e1e0(0xbc)]('Response\x20Time:',_0xc0fe0e+'ms');if(!_0x142151['ok']){const _0x1be0a3=await _0x142151[_0x41e1e0(0x9d)]();console['error'](_0x41e1e0(0xd6),_0x142151[_0x41e1e0(0xcd)]),console['error'](_0x41e1e0(0xe8),_0x1be0a3),loggerService_1[_0x41e1e0(0x103)][_0x41e1e0(0xbf)](_0x41e1e0(0xe4),_0x41e1e0(0xb9),_0x142151[_0x41e1e0(0xcd)],_0x1be0a3,_0xc0fe0e),loggerService_1[_0x41e1e0(0x103)][_0x41e1e0(0xec)]('cointopay',_0x41e1e0(0xb9),_0x41e1e0(0xd4)+_0x142151[_0x41e1e0(0xcd)]+':\x20'+_0x1be0a3);throw new Error(_0x41e1e0(0xf5)+_0x142151[_0x41e1e0(0xcd)]);}const _0x2b7d93=await _0x142151['text']();console[_0x41e1e0(0xbc)](_0x41e1e0(0xbd),_0x2b7d93);let _0x7dd9a4;try{_0x7dd9a4=JSON['parse'](_0x2b7d93);}catch(_0x418243){console[_0x41e1e0(0xa6)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x418243),loggerService_1[_0x41e1e0(0x103)]['logWhiteDomainError']('cointopay',_0x41e1e0(0xb9),'JSON\x20Parse\x20Error:\x20'+_0x418243);throw new Error(_0x41e1e0(0x11e)+_0x2b7d93);}loggerService_1[_0x41e1e0(0x103)][_0x41e1e0(0xbf)](_0x41e1e0(0xe4),_0x41e1e0(0xb9),_0x142151['status'],_0x7dd9a4,_0xc0fe0e),console['log'](_0x41e1e0(0x124)),console[_0x41e1e0(0xbc)]('Result:',_0x7dd9a4['result']),console[_0x41e1e0(0xbc)]('Status\x20Code:',_0x7dd9a4[_0x41e1e0(0xca)]),console[_0x41e1e0(0xbc)]('Payment\x20Status:',_0x7dd9a4[_0x41e1e0(0x10c)]?.['Status']),console[_0x41e1e0(0xbc)]('Amount:',_0x7dd9a4[_0x41e1e0(0x10c)]?.[_0x41e1e0(0x122)]),console[_0x41e1e0(0xbc)](_0x41e1e0(0xdd),_0x7dd9a4['data']?.['inputCurrency']);if(_0x7dd9a4[_0x41e1e0(0xf4)]!==_0x41e1e0(0xcf)||_0x7dd9a4[_0x41e1e0(0xca)]!==0xc8){const _0x531c40=_0x7dd9a4[_0x41e1e0(0xaf)]||_0x41e1e0(0x113);console['error'](_0x41e1e0(0x9a)),console[_0x41e1e0(0xa6)]('Error\x20Message:',_0x531c40),loggerService_1[_0x41e1e0(0x103)][_0x41e1e0(0xec)](_0x41e1e0(0xe4),_0x41e1e0(0xb9),'Status\x20API\x20Error:\x20'+_0x531c40);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x531c40);}if(!_0x7dd9a4['data']){console[_0x41e1e0(0xa6)](_0x41e1e0(0xae)),console[_0x41e1e0(0xa6)](_0x41e1e0(0x9b)),loggerService_1[_0x41e1e0(0x103)][_0x41e1e0(0xec)](_0x41e1e0(0xe4),'/status',_0x41e1e0(0xc5));throw new Error(_0x41e1e0(0xa4));}let _0x442424='PENDING';switch(_0x7dd9a4[_0x41e1e0(0x10c)][_0x41e1e0(0xb6)]?.['toLowerCase']()){case'paid':_0x442424=_0x41e1e0(0x120);break;case _0x41e1e0(0xad):case _0x41e1e0(0xfe):case _0x41e1e0(0xa6):_0x442424=_0x41e1e0(0xc2);break;case _0x41e1e0(0xf6):case _0x41e1e0(0x10b):_0x442424=_0x41e1e0(0x11f);break;case'waiting':case _0x41e1e0(0x9c):case _0x41e1e0(0xea):case'created':default:_0x442424='PENDING';break;}let _0x5ce8bc,_0x3a6a98;if(_0x7dd9a4[_0x41e1e0(0x10c)][_0x41e1e0(0xdc)]){const _0x3b1a35=_0x7dd9a4[_0x41e1e0(0x10c)]['PaymentDetail'];console[_0x41e1e0(0xbc)]('ðŸ¦\x20Payment\x20Detail:',_0x3b1a35);const _0x1e556f=_0x3b1a35[_0x41e1e0(0xd7)](/IBAN\s+([A-Z0-9]+)/i);_0x1e556f&&(_0x5ce8bc=_0x1e556f[0x1],console[_0x41e1e0(0xbc)](_0x41e1e0(0x125),_0x5ce8bc)),_0x3a6a98=_0x3b1a35;}const _0x2e59be={'iban':_0x5ce8bc,'bankDetails':_0x3a6a98,'transactionId':_0x7dd9a4[_0x41e1e0(0x10c)][_0x41e1e0(0xc4)],'coinAddress':_0x7dd9a4[_0x41e1e0(0x10c)][_0x41e1e0(0xb3)],'qrCodeUrl':_0x7dd9a4[_0x41e1e0(0x10c)][_0x41e1e0(0xb4)],'expiryTime':_0x7dd9a4[_0x41e1e0(0x10c)][_0x41e1e0(0xa8)],'createdOn':_0x7dd9a4[_0x41e1e0(0x10c)]['CreatedOn'],'confirmedOn':_0x7dd9a4[_0x41e1e0(0x10c)]['TransactionConfirmedOn']};console[_0x41e1e0(0xbc)](_0x41e1e0(0xcc)),console['log'](_0x41e1e0(0xe7),_0x7dd9a4[_0x41e1e0(0x10c)][_0x41e1e0(0xb6)],'->',_0x442424),console[_0x41e1e0(0xbc)](_0x41e1e0(0x101),_0x7dd9a4['data'][_0x41e1e0(0x122)],_0x7dd9a4[_0x41e1e0(0x10c)]['inputCurrency']),console['log'](_0x41e1e0(0xa9),_0x7dd9a4['data'][_0x41e1e0(0xc4)]),console[_0x41e1e0(0xbc)](_0x41e1e0(0xe5),_0x5ce8bc||_0x41e1e0(0xfc)),console[_0x41e1e0(0xbc)]('Created\x20On:',_0x7dd9a4[_0x41e1e0(0x10c)]['CreatedOn']),console['log'](_0x41e1e0(0xd1),_0x7dd9a4[_0x41e1e0(0x10c)][_0x41e1e0(0x99)]||_0x41e1e0(0xd8));if(_0x7dd9a4[_0x41e1e0(0x10c)][_0x41e1e0(0xb6)]?.[_0x41e1e0(0xc6)]()===_0x41e1e0(0x9c))console[_0x41e1e0(0xbc)](_0x41e1e0(0x10f));else _0x7dd9a4[_0x41e1e0(0x10c)][_0x41e1e0(0xb6)]?.[_0x41e1e0(0xc6)]()===_0x41e1e0(0xe3)&&console['log'](_0x41e1e0(0xfd));return{'status':_0x442424,'amount':parseFloat(_0x7dd9a4[_0x41e1e0(0x10c)][_0x41e1e0(0x122)])||undefined,'currency':_0x7dd9a4[_0x41e1e0(0x10c)][_0x41e1e0(0x9e)]||_0x41e1e0(0xf0),'paymentDetails':_0x2e59be};}catch(_0x5fca63){console['error'](_0x41e1e0(0x105),_0x5fca63),loggerService_1[_0x41e1e0(0x103)]['logWhiteDomainError']('cointopay','/status',_0x5fca63);throw new Error(_0x41e1e0(0xba)+(_0x5fca63 instanceof Error?_0x5fca63[_0x41e1e0(0xaf)]:_0x41e1e0(0xd2)));}}async[a55_0x44a2b3(0xe1)](_0x466b44){const _0x402d89=a55_0x44a2b3,_0x541f36=await this[_0x402d89(0xef)](_0x466b44);return{'status':_0x541f36[_0x402d89(0xcd)],'amount':_0x541f36[_0x402d89(0xab)],'currency':_0x541f36[_0x402d89(0xb7)]};}async['processWebhook'](_0x50dfb3){const _0x43b052=a55_0x44a2b3;console['log']('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x50dfb3);let _0x244276=_0x43b052(0xe9);switch(_0x50dfb3[_0x43b052(0xcd)]?.['toLowerCase']()){case _0x43b052(0xe3):_0x244276=_0x43b052(0x120);break;case _0x43b052(0xad):case'failed':case _0x43b052(0xa6):_0x244276=_0x43b052(0xc2);break;case'expired':case _0x43b052(0x10b):_0x244276=_0x43b052(0x11f);break;case _0x43b052(0xea):case _0x43b052(0xc8):case'awaiting\x20fiat':case _0x43b052(0xc7):default:_0x244276='PENDING';break;}return{'paymentId':_0x50dfb3[_0x43b052(0xdf)]||_0x50dfb3[_0x43b052(0x116)]||'','status':_0x244276,'amount':_0x50dfb3[_0x43b052(0xab)],'currency':_0x50dfb3[_0x43b052(0xb7)]||_0x43b052(0xf0)};}}exports[a55_0x44a2b3(0xa3)]=CoinToPayService;