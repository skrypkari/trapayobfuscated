'use strict';const a38_0x5a3683=a38_0x5003;(function(_0x31f011,_0xfdeb7b){const _0x8ff889=a38_0x5003,_0x25f54d=_0x31f011();while(!![]){try{const _0x1bc939=-parseInt(_0x8ff889(0x205))/0x1*(parseInt(_0x8ff889(0x201))/0x2)+parseInt(_0x8ff889(0x1dd))/0x3*(parseInt(_0x8ff889(0x1f3))/0x4)+parseInt(_0x8ff889(0x1ef))/0x5*(parseInt(_0x8ff889(0x1c3))/0x6)+parseInt(_0x8ff889(0x1ed))/0x7+parseInt(_0x8ff889(0x1d1))/0x8+parseInt(_0x8ff889(0x1fd))/0x9*(parseInt(_0x8ff889(0x19c))/0xa)+-parseInt(_0x8ff889(0x1c4))/0xb;if(_0x1bc939===_0xfdeb7b)break;else _0x25f54d['push'](_0x25f54d['shift']());}catch(_0x2cdea6){_0x25f54d['push'](_0x25f54d['shift']());}}}(a38_0x2f33,0xa8ebc));function a38_0x2f33(){const _0x573886=['===\x20COINTOPAY\x20SUCCESS\x20===','/create','logWhiteDomainRequest','Parsed\x20Result:','Error\x20Message:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','6eQUVtR','CoinToPay\x20payment\x20status\x20check\x20error:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Business\x20Error:\x20','payment_url','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Currency:','FAILED','verifyPayment','status_code','not\x20found','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Status:','statusText','CoinToPay\x20API\x20error:\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','5347923yAaWpT','Amount:','354970RdxeLi','POST','Status\x20API\x20Error:\x20','Response\x20Time:','1043516GYuHve','URL:','CreatedOn','üè¶\x20Extracted\x20IBAN:','pending','coinAddress','application/json','üìä\x20Status\x20check\x20URL:','paid','message','54FozFMw','status','cointopay','PAID','126484wQGFaS','loggerService','result','now','10CMYCLq','üè¶\x20Payment\x20Detail:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','toLowerCase','log','checkPaymentStatus','data','CoinToPayService','statusUrl','HTTP\x20','Failed\x20to\x20parse\x20JSON\x20response:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','success','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Request\x20Body:','Payment\x20URL:','Error\x20stack:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','awaiting\x20fiat','inputCurrency','parse','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','\x20EUR','Gateway\x20Payment\x20ID:','apiUrl','JSON\x20Parse\x20Error:\x20','1931810QancVd','TransactionConfirmedOn','order_id','PENDING','stringify','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','TesSoft\x20Payment\x20System/1.0','EUR','fromEntries','Transaction\x20ID:','error','timeout','amount','Raw\x20Response\x20Body:','headers','Amount','expired','TransactionID','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','CoinToPay\x20status\x20API\x20error:\x20','text','created','logWhiteDomainResponse','gateway_payment_id',',\x20body:\x20','Missing\x20data\x20in\x20response','IBAN:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','EXPIRED','cancelled','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Response\x20data:','../loggerService','match','__esModule','stack','HTTP\x20Status:','failed','24NtMLfr','24600004vyuAWs','not\x20confirmed','HTTP\x20error!\x20status:\x20','currency','/status','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Status','PaymentDetail','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','ExpiryTime','===\x20COINTOPAY\x20API\x20ERROR\x20===','waiting','Response\x20Body:','6655000CNTBLr','Created\x20On:','entries','logWhiteDomainError','createPaymentLink','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API'];a38_0x2f33=function(){return _0x573886;};return a38_0x2f33();}Object['defineProperty'](exports,a38_0x5a3683(0x1bf),{'value':!![]}),exports[a38_0x5a3683(0x20c)]=void 0x0;function a38_0x5003(_0xc7316b,_0x4f99bb){const _0x2f334c=a38_0x2f33();return a38_0x5003=function(_0x5003dc,_0x2de783){_0x5003dc=_0x5003dc-0x193;let _0x29dec6=_0x2f334c[_0x5003dc];return _0x29dec6;},a38_0x5003(_0xc7316b,_0x4f99bb);}const loggerService_1=require(a38_0x5a3683(0x1bd));class CoinToPayService{constructor(){const _0x4ffdc0=a38_0x5a3683;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this[_0x4ffdc0(0x20d)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x4ffdc0(0x209)](_0x4ffdc0(0x1e2)),console[_0x4ffdc0(0x209)](_0x4ffdc0(0x1fa),this[_0x4ffdc0(0x20d)]);}async[a38_0x5a3683(0x1d5)](_0x2d4492){const _0x209d95=a38_0x5a3683,{orderId:_0x503b52,amount:_0x4594c9}=_0x2d4492;console[_0x209d95(0x209)](_0x209d95(0x1b7)+_0x4594c9+_0x209d95(0x198));const _0x3e7cb5={'amount':_0x4594c9},_0xe57f16=Date['now']();try{console[_0x209d95(0x209)](_0x209d95(0x1a1)),console[_0x209d95(0x209)](_0x209d95(0x1f4),this[_0x209d95(0x19a)]),console[_0x209d95(0x209)](_0x209d95(0x213),JSON[_0x209d95(0x1a0)](_0x3e7cb5,null,0x2)),console['log'](_0x209d95(0x1ee),_0x4594c9,_0x209d95(0x1cc)),loggerService_1[_0x209d95(0x202)][_0x209d95(0x1d9)]('cointopay',_0x209d95(0x1d8),_0x209d95(0x1f0),_0x3e7cb5);const _0x191b13=await fetch(this['apiUrl'],{'method':_0x209d95(0x1f0),'headers':{'Content-Type':_0x209d95(0x1f9),'Accept':_0x209d95(0x1f9),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x209d95(0x1a0)](_0x3e7cb5)}),_0x53ffc4=Date[_0x209d95(0x204)]()-_0xe57f16;console[_0x209d95(0x209)](_0x209d95(0x193)),console[_0x209d95(0x209)](_0x209d95(0x1e9),_0x191b13[_0x209d95(0x1fe)]),console[_0x209d95(0x209)]('Status\x20Text:',_0x191b13[_0x209d95(0x1ea)]),console['log']('Headers:',Object[_0x209d95(0x1a4)](_0x191b13[_0x209d95(0x1aa)][_0x209d95(0x1d3)]())),console['log'](_0x209d95(0x1f2),_0x53ffc4+'ms');const _0x3afcef=await _0x191b13[_0x209d95(0x1b0)]();console[_0x209d95(0x209)](_0x209d95(0x1a9),_0x3afcef);if(!_0x191b13['ok']){console[_0x209d95(0x1a6)](_0x209d95(0x1ce)),console[_0x209d95(0x1a6)](_0x209d95(0x1c1),_0x191b13['status']),console[_0x209d95(0x1a6)](_0x209d95(0x1d0),_0x3afcef),loggerService_1['loggerService'][_0x209d95(0x1b2)](_0x209d95(0x1ff),_0x209d95(0x1d8),_0x191b13[_0x209d95(0x1fe)],_0x3afcef,_0x53ffc4),loggerService_1[_0x209d95(0x202)][_0x209d95(0x1d4)]('cointopay',_0x209d95(0x1d8),_0x209d95(0x20e)+_0x191b13[_0x209d95(0x1fe)]+':\x20'+_0x3afcef);throw new Error(_0x209d95(0x1c6)+_0x191b13['status']+_0x209d95(0x1b4)+_0x3afcef);}let _0x21f711;try{_0x21f711=JSON[_0x209d95(0x196)](_0x3afcef);}catch(_0x1afc77){console[_0x209d95(0x1a6)](_0x209d95(0x20f),_0x1afc77),loggerService_1[_0x209d95(0x202)]['logWhiteDomainError'](_0x209d95(0x1ff),_0x209d95(0x1d8),'JSON\x20Parse\x20Error:\x20'+_0x1afc77);throw new Error(_0x209d95(0x1dc)+_0x3afcef);}console['log']('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x209d95(0x209)](_0x209d95(0x1da),JSON['stringify'](_0x21f711,null,0x2)),loggerService_1['loggerService'][_0x209d95(0x1b2)](_0x209d95(0x1ff),'/create',_0x191b13['status'],_0x21f711,_0x53ffc4);if(_0x21f711['error']){const _0x4f21f9=_0x21f711[_0x209d95(0x1fc)]||_0x21f711['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x209d95(0x1a6)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x209d95(0x1db),_0x4f21f9),loggerService_1['loggerService'][_0x209d95(0x1d4)](_0x209d95(0x1ff),_0x209d95(0x1d8),_0x209d95(0x1e0)+_0x4f21f9);throw new Error(_0x209d95(0x1eb)+_0x4f21f9);}if(!_0x21f711[_0x209d95(0x1e1)]||!_0x21f711[_0x209d95(0x1b3)]){console[_0x209d95(0x1a6)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x209d95(0x1a6)](_0x209d95(0x1ec)),console[_0x209d95(0x1a6)](_0x209d95(0x1bc),_0x21f711),loggerService_1[_0x209d95(0x202)][_0x209d95(0x1d4)](_0x209d95(0x1ff),_0x209d95(0x1d8),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x209d95(0x209)](_0x209d95(0x1d7)),console[_0x209d95(0x209)](_0x209d95(0x199),_0x21f711[_0x209d95(0x1b3)]),console['log'](_0x209d95(0x214),_0x21f711[_0x209d95(0x1e1)]),console[_0x209d95(0x209)]('Amount:',_0x4594c9,_0x209d95(0x1a3)),{'gateway_payment_id':_0x21f711['gateway_payment_id'],'payment_url':_0x21f711[_0x209d95(0x1e1)]};}catch(_0x21c407){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x209d95(0x1a6)]('Error\x20details:',_0x21c407),loggerService_1[_0x209d95(0x202)][_0x209d95(0x1d4)]('cointopay','/create',_0x21c407);if(_0x21c407 instanceof Error){console[_0x209d95(0x1a6)]('Error\x20message:',_0x21c407[_0x209d95(0x1fc)]),console[_0x209d95(0x1a6)](_0x209d95(0x215),_0x21c407[_0x209d95(0x1c0)]);throw new Error(_0x209d95(0x197)+_0x21c407[_0x209d95(0x1fc)]);}throw new Error(_0x209d95(0x1df));}}async[a38_0x5a3683(0x20a)](_0xaa388b){const _0x355ba1=a38_0x5a3683,_0x24613a=Date['now']();try{console[_0x355ba1(0x209)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0xaa388b);const _0x1c4de9={'gatewayPaymentId':_0xaa388b};loggerService_1[_0x355ba1(0x202)][_0x355ba1(0x1d9)](_0x355ba1(0x1ff),_0x355ba1(0x1c8),_0x355ba1(0x1f0),_0x1c4de9);const _0x5938cf=await fetch(this[_0x355ba1(0x20d)],{'method':_0x355ba1(0x1f0),'headers':{'Content-Type':_0x355ba1(0x1f9),'Accept':_0x355ba1(0x1f9),'User-Agent':_0x355ba1(0x1a2)},'body':JSON[_0x355ba1(0x1a0)](_0x1c4de9)}),_0x149231=Date['now']()-_0x24613a;console['log'](_0x355ba1(0x1c9)),console[_0x355ba1(0x209)](_0x355ba1(0x1e9),_0x5938cf[_0x355ba1(0x1fe)]),console[_0x355ba1(0x209)](_0x355ba1(0x1f2),_0x149231+'ms');if(!_0x5938cf['ok']){const _0x35daed=await _0x5938cf[_0x355ba1(0x1b0)]();console[_0x355ba1(0x1a6)](_0x355ba1(0x1c1),_0x5938cf[_0x355ba1(0x1fe)]),console[_0x355ba1(0x1a6)](_0x355ba1(0x1d0),_0x35daed),loggerService_1['loggerService'][_0x355ba1(0x1b2)]('cointopay',_0x355ba1(0x1c8),_0x5938cf[_0x355ba1(0x1fe)],_0x35daed,_0x149231),loggerService_1['loggerService']['logWhiteDomainError'](_0x355ba1(0x1ff),_0x355ba1(0x1c8),'HTTP\x20'+_0x5938cf['status']+':\x20'+_0x35daed);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5938cf[_0x355ba1(0x1fe)]);}const _0x1368da=await _0x5938cf['text']();console[_0x355ba1(0x209)]('Raw\x20Response\x20Body:',_0x1368da);let _0x5377a1;try{_0x5377a1=JSON[_0x355ba1(0x196)](_0x1368da);}catch(_0x17aafb){console[_0x355ba1(0x1a6)](_0x355ba1(0x20f),_0x17aafb),loggerService_1[_0x355ba1(0x202)][_0x355ba1(0x1d4)](_0x355ba1(0x1ff),'/status',_0x355ba1(0x19b)+_0x17aafb);throw new Error(_0x355ba1(0x1e8)+_0x1368da);}loggerService_1['loggerService'][_0x355ba1(0x1b2)](_0x355ba1(0x1ff),_0x355ba1(0x1c8),_0x5938cf[_0x355ba1(0x1fe)],_0x5377a1,_0x149231),console[_0x355ba1(0x209)](_0x355ba1(0x1ba)),console['log']('Result:',_0x5377a1[_0x355ba1(0x203)]),console[_0x355ba1(0x209)]('Status\x20Code:',_0x5377a1['status_code']),console[_0x355ba1(0x209)]('Payment\x20Status:',_0x5377a1[_0x355ba1(0x20b)]?.[_0x355ba1(0x1ca)]),console[_0x355ba1(0x209)]('Amount:',_0x5377a1['data']?.['Amount']),console['log'](_0x355ba1(0x1e3),_0x5377a1[_0x355ba1(0x20b)]?.[_0x355ba1(0x195)]);if(_0x5377a1[_0x355ba1(0x203)]!==_0x355ba1(0x211)||_0x5377a1[_0x355ba1(0x1e6)]!==0xc8){const _0x1abf45=_0x5377a1[_0x355ba1(0x1fc)]||_0x355ba1(0x1d6);console[_0x355ba1(0x1a6)](_0x355ba1(0x1ae)),console[_0x355ba1(0x1a6)](_0x355ba1(0x1db),_0x1abf45),loggerService_1[_0x355ba1(0x202)]['logWhiteDomainError'](_0x355ba1(0x1ff),_0x355ba1(0x1c8),_0x355ba1(0x1f1)+_0x1abf45);throw new Error(_0x355ba1(0x1af)+_0x1abf45);}if(!_0x5377a1['data']){console[_0x355ba1(0x1a6)](_0x355ba1(0x212)),console['error'](_0x355ba1(0x1b5)),loggerService_1[_0x355ba1(0x202)][_0x355ba1(0x1d4)](_0x355ba1(0x1ff),_0x355ba1(0x1c8),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x355ba1(0x1bb));}let _0x477ccb=_0x355ba1(0x19f);switch(_0x5377a1['data']['Status']?.[_0x355ba1(0x208)]()){case'paid':_0x477ccb=_0x355ba1(0x200);break;case _0x355ba1(0x1b9):case _0x355ba1(0x1c2):case _0x355ba1(0x1a6):_0x477ccb=_0x355ba1(0x1e4);break;case'expired':case _0x355ba1(0x1a7):_0x477ccb='EXPIRED';break;case'waiting':case _0x355ba1(0x194):case _0x355ba1(0x1f7):case _0x355ba1(0x1b1):default:_0x477ccb='PENDING';break;}let _0x2c3065,_0x54ea94;if(_0x5377a1[_0x355ba1(0x20b)]['PaymentDetail']){const _0x4177fa=_0x5377a1['data'][_0x355ba1(0x1cb)];console['log'](_0x355ba1(0x206),_0x4177fa);const _0x4992d9=_0x4177fa[_0x355ba1(0x1be)](/IBAN\s+([A-Z0-9]+)/i);_0x4992d9&&(_0x2c3065=_0x4992d9[0x1],console[_0x355ba1(0x209)](_0x355ba1(0x1f6),_0x2c3065)),_0x54ea94=_0x4177fa;}const _0x37fc39={'iban':_0x2c3065,'bankDetails':_0x54ea94,'transactionId':_0x5377a1['data'][_0x355ba1(0x1ad)],'coinAddress':_0x5377a1[_0x355ba1(0x20b)][_0x355ba1(0x1f8)],'qrCodeUrl':_0x5377a1[_0x355ba1(0x20b)]['QRCodeURL'],'expiryTime':_0x5377a1['data'][_0x355ba1(0x1cd)],'createdOn':_0x5377a1[_0x355ba1(0x20b)]['CreatedOn'],'confirmedOn':_0x5377a1[_0x355ba1(0x20b)][_0x355ba1(0x19d)]};console[_0x355ba1(0x209)](_0x355ba1(0x207)),console[_0x355ba1(0x209)]('Status:',_0x5377a1[_0x355ba1(0x20b)][_0x355ba1(0x1ca)],'->',_0x477ccb),console['log'](_0x355ba1(0x1ee),_0x5377a1[_0x355ba1(0x20b)][_0x355ba1(0x1ab)],_0x5377a1[_0x355ba1(0x20b)][_0x355ba1(0x195)]),console[_0x355ba1(0x209)](_0x355ba1(0x1a5),_0x5377a1[_0x355ba1(0x20b)][_0x355ba1(0x1ad)]),console[_0x355ba1(0x209)](_0x355ba1(0x1b6),_0x2c3065||_0x355ba1(0x1e7)),console[_0x355ba1(0x209)](_0x355ba1(0x1d2),_0x5377a1['data'][_0x355ba1(0x1f5)]),console['log']('Confirmed\x20On:',_0x5377a1[_0x355ba1(0x20b)][_0x355ba1(0x19d)]||_0x355ba1(0x1c5));if(_0x5377a1[_0x355ba1(0x20b)]['Status']?.[_0x355ba1(0x208)]()===_0x355ba1(0x194))console['log'](_0x355ba1(0x210));else _0x5377a1[_0x355ba1(0x20b)][_0x355ba1(0x1ca)]?.[_0x355ba1(0x208)]()===_0x355ba1(0x1fb)&&console[_0x355ba1(0x209)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x477ccb,'amount':parseFloat(_0x5377a1[_0x355ba1(0x20b)][_0x355ba1(0x1ab)])||undefined,'currency':_0x5377a1['data']['inputCurrency']||_0x355ba1(0x1a3),'paymentDetails':_0x37fc39};}catch(_0x2bb9b5){console['error'](_0x355ba1(0x1de),_0x2bb9b5),loggerService_1[_0x355ba1(0x202)][_0x355ba1(0x1d4)](_0x355ba1(0x1ff),_0x355ba1(0x1c8),_0x2bb9b5);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x2bb9b5 instanceof Error?_0x2bb9b5[_0x355ba1(0x1fc)]:'Unknown\x20error'));}}async[a38_0x5a3683(0x1e5)](_0x5d5746){const _0x35054a=a38_0x5a3683,_0x3afbb6=await this[_0x35054a(0x20a)](_0x5d5746);return{'status':_0x3afbb6[_0x35054a(0x1fe)],'amount':_0x3afbb6[_0x35054a(0x1a8)],'currency':_0x3afbb6['currency']};}async['processWebhook'](_0x42adc2){const _0x4274a7=a38_0x5a3683;console[_0x4274a7(0x209)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x42adc2);let _0x2e28b9='PENDING';switch(_0x42adc2['status']?.[_0x4274a7(0x208)]()){case _0x4274a7(0x1fb):_0x2e28b9=_0x4274a7(0x200);break;case _0x4274a7(0x1b9):case _0x4274a7(0x1c2):case _0x4274a7(0x1a6):_0x2e28b9='FAILED';break;case _0x4274a7(0x1ac):case _0x4274a7(0x1a7):_0x2e28b9=_0x4274a7(0x1b8);break;case _0x4274a7(0x1f7):case _0x4274a7(0x1cf):case _0x4274a7(0x194):case'created':default:_0x2e28b9=_0x4274a7(0x19f);break;}return{'paymentId':_0x42adc2[_0x4274a7(0x19e)]||_0x42adc2['merchant_reference_id']||'','status':_0x2e28b9,'amount':_0x42adc2[_0x4274a7(0x1a8)],'currency':_0x42adc2[_0x4274a7(0x1c7)]||_0x4274a7(0x1a3)};}}exports[a38_0x5a3683(0x20c)]=CoinToPayService;