'use strict';const a49_0x1107e9=a49_0x3d44;function a49_0x3d44(_0x333024,_0x53c788){const _0x497256=a49_0x4972();return a49_0x3d44=function(_0x3d4493,_0x2d8503){_0x3d4493=_0x3d4493-0x112;let _0x3912cf=_0x497256[_0x3d4493];return _0x3912cf;},a49_0x3d44(_0x333024,_0x53c788);}(function(_0x107321,_0x25d436){const _0x4da5d7=a49_0x3d44,_0x6a613b=_0x107321();while(!![]){try{const _0x217e9e=-parseInt(_0x4da5d7(0x13e))/0x1+-parseInt(_0x4da5d7(0x130))/0x2*(-parseInt(_0x4da5d7(0x160))/0x3)+-parseInt(_0x4da5d7(0x12f))/0x4*(parseInt(_0x4da5d7(0x151))/0x5)+-parseInt(_0x4da5d7(0x176))/0x6+parseInt(_0x4da5d7(0x149))/0x7*(-parseInt(_0x4da5d7(0x144))/0x8)+parseInt(_0x4da5d7(0x162))/0x9+parseInt(_0x4da5d7(0x166))/0xa*(parseInt(_0x4da5d7(0x161))/0xb);if(_0x217e9e===_0x25d436)break;else _0x6a613b['push'](_0x6a613b['shift']());}catch(_0x4c245e){_0x6a613b['push'](_0x6a613b['shift']());}}}(a49_0x4972,0xca1d0));Object[a49_0x1107e9(0x19b)](exports,'__esModule',{'value':!![]}),exports[a49_0x1107e9(0x17c)]=void 0x0;const loggerService_1=require(a49_0x1107e9(0x12e));class CoinToPayService{constructor(){const _0x2d753a=a49_0x1107e9;this['apiUrl']=_0x2d753a(0x15e),this[_0x2d753a(0x198)]=_0x2d753a(0x137),console[_0x2d753a(0x114)](_0x2d753a(0x12b)),console[_0x2d753a(0x114)](_0x2d753a(0x134),this[_0x2d753a(0x198)]);}async['createPaymentLink'](_0x1f712c){const _0x4998f4=a49_0x1107e9,{orderId:_0x25432b,amount:_0x2ce46e}=_0x1f712c;console[_0x4998f4(0x114)](_0x4998f4(0x16c)+_0x2ce46e+_0x4998f4(0x188));const _0x1d6f59={'amount':_0x2ce46e},_0xf62d27=Date[_0x4998f4(0x181)]();try{console[_0x4998f4(0x114)](_0x4998f4(0x146)),console['log']('URL:',this[_0x4998f4(0x195)]),console[_0x4998f4(0x114)](_0x4998f4(0x115),JSON[_0x4998f4(0x19c)](_0x1d6f59,null,0x2)),console['log']('Amount:',_0x2ce46e,_0x4998f4(0x128)),loggerService_1[_0x4998f4(0x126)][_0x4998f4(0x197)](_0x4998f4(0x179),'/create','POST',_0x1d6f59);const _0x59fcac=await fetch(this[_0x4998f4(0x195)],{'method':_0x4998f4(0x16d),'headers':{'Content-Type':_0x4998f4(0x158),'Accept':_0x4998f4(0x158),'User-Agent':_0x4998f4(0x117)},'body':JSON[_0x4998f4(0x19c)](_0x1d6f59)}),_0x1873ab=Date[_0x4998f4(0x181)]()-_0xf62d27;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log']('Status:',_0x59fcac[_0x4998f4(0x192)]),console['log'](_0x4998f4(0x184),_0x59fcac[_0x4998f4(0x145)]),console[_0x4998f4(0x114)](_0x4998f4(0x193),Object[_0x4998f4(0x132)](_0x59fcac[_0x4998f4(0x183)][_0x4998f4(0x190)]())),console[_0x4998f4(0x114)](_0x4998f4(0x124),_0x1873ab+'ms');const _0x55bf88=await _0x59fcac[_0x4998f4(0x14e)]();console[_0x4998f4(0x114)]('Raw\x20Response\x20Body:',_0x55bf88);if(!_0x59fcac['ok']){console[_0x4998f4(0x133)](_0x4998f4(0x11f)),console[_0x4998f4(0x133)](_0x4998f4(0x155),_0x59fcac[_0x4998f4(0x192)]),console[_0x4998f4(0x133)](_0x4998f4(0x189),_0x55bf88),loggerService_1[_0x4998f4(0x126)][_0x4998f4(0x120)](_0x4998f4(0x179),_0x4998f4(0x13d),_0x59fcac[_0x4998f4(0x192)],_0x55bf88,_0x1873ab),loggerService_1[_0x4998f4(0x126)]['logWhiteDomainError'](_0x4998f4(0x179),_0x4998f4(0x13d),'HTTP\x20'+_0x59fcac[_0x4998f4(0x192)]+':\x20'+_0x55bf88);throw new Error(_0x4998f4(0x171)+_0x59fcac[_0x4998f4(0x192)]+_0x4998f4(0x147)+_0x55bf88);}let _0x4f0024;try{_0x4f0024=JSON[_0x4998f4(0x173)](_0x55bf88);}catch(_0x5329c4){console[_0x4998f4(0x133)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5329c4),loggerService_1['loggerService']['logWhiteDomainError'](_0x4998f4(0x179),_0x4998f4(0x13d),_0x4998f4(0x163)+_0x5329c4);throw new Error(_0x4998f4(0x194)+_0x55bf88);}console[_0x4998f4(0x114)](_0x4998f4(0x119)),console[_0x4998f4(0x114)](_0x4998f4(0x165),JSON[_0x4998f4(0x19c)](_0x4f0024,null,0x2)),loggerService_1['loggerService'][_0x4998f4(0x120)](_0x4998f4(0x179),'/create',_0x59fcac[_0x4998f4(0x192)],_0x4f0024,_0x1873ab);if(_0x4f0024[_0x4998f4(0x133)]){const _0x1d9b6d=_0x4f0024[_0x4998f4(0x172)]||_0x4f0024['error']||_0x4998f4(0x14d);console[_0x4998f4(0x133)](_0x4998f4(0x122)),console['error'](_0x4998f4(0x157),_0x1d9b6d),loggerService_1[_0x4998f4(0x126)][_0x4998f4(0x174)](_0x4998f4(0x179),'/create',_0x4998f4(0x153)+_0x1d9b6d);throw new Error(_0x4998f4(0x14b)+_0x1d9b6d);}if(!_0x4f0024[_0x4998f4(0x17a)]||!_0x4f0024[_0x4998f4(0x131)]){console[_0x4998f4(0x133)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x4998f4(0x14f)),console['error'](_0x4998f4(0x18e),_0x4f0024),loggerService_1['loggerService'][_0x4998f4(0x174)]('cointopay',_0x4998f4(0x13d),_0x4998f4(0x18d));throw new Error(_0x4998f4(0x17e));}console['log'](_0x4998f4(0x140)),console['log'](_0x4998f4(0x11b),_0x4f0024[_0x4998f4(0x131)]),console[_0x4998f4(0x114)]('Payment\x20URL\x20(original):',_0x4f0024[_0x4998f4(0x17a)]);const _0x542496=_0x4f0024[_0x4998f4(0x17a)]+_0x4998f4(0x169);return console[_0x4998f4(0x114)](_0x4998f4(0x135),_0x542496),console[_0x4998f4(0x114)](_0x4998f4(0x112),_0x2ce46e,_0x4998f4(0x12d)),{'gateway_payment_id':_0x4f0024[_0x4998f4(0x131)],'payment_url':_0x542496};}catch(_0x1e66d5){console[_0x4998f4(0x133)](_0x4998f4(0x168)),console[_0x4998f4(0x133)](_0x4998f4(0x123),_0x1e66d5),loggerService_1['loggerService'][_0x4998f4(0x174)](_0x4998f4(0x179),_0x4998f4(0x13d),_0x1e66d5);if(_0x1e66d5 instanceof Error){console[_0x4998f4(0x133)](_0x4998f4(0x159),_0x1e66d5[_0x4998f4(0x172)]),console[_0x4998f4(0x133)](_0x4998f4(0x164),_0x1e66d5[_0x4998f4(0x17b)]);throw new Error(_0x4998f4(0x18f)+_0x1e66d5[_0x4998f4(0x172)]);}throw new Error(_0x4998f4(0x138));}}async[a49_0x1107e9(0x113)](_0x43c863){const _0x69ec34=a49_0x1107e9,_0x129e33=Date['now']();try{console[_0x69ec34(0x114)](_0x69ec34(0x14c)+_0x43c863);const _0x3ba21c={'gatewayPaymentId':_0x43c863};loggerService_1[_0x69ec34(0x126)][_0x69ec34(0x197)]('cointopay',_0x69ec34(0x19a),_0x69ec34(0x16d),_0x3ba21c);const _0x7ad8da=await fetch(this[_0x69ec34(0x198)],{'method':_0x69ec34(0x16d),'headers':{'Content-Type':_0x69ec34(0x158),'Accept':_0x69ec34(0x158),'User-Agent':_0x69ec34(0x117)},'body':JSON[_0x69ec34(0x19c)](_0x3ba21c)}),_0x39218a=Date[_0x69ec34(0x181)]()-_0x129e33;console[_0x69ec34(0x114)](_0x69ec34(0x14a)),console[_0x69ec34(0x114)](_0x69ec34(0x13f),_0x7ad8da[_0x69ec34(0x192)]),console[_0x69ec34(0x114)](_0x69ec34(0x124),_0x39218a+'ms');if(!_0x7ad8da['ok']){const _0x26a1b7=await _0x7ad8da[_0x69ec34(0x14e)]();console[_0x69ec34(0x133)]('HTTP\x20Status:',_0x7ad8da[_0x69ec34(0x192)]),console[_0x69ec34(0x133)](_0x69ec34(0x189),_0x26a1b7),loggerService_1[_0x69ec34(0x126)][_0x69ec34(0x120)](_0x69ec34(0x179),'/status',_0x7ad8da[_0x69ec34(0x192)],_0x26a1b7,_0x39218a),loggerService_1[_0x69ec34(0x126)][_0x69ec34(0x174)](_0x69ec34(0x179),_0x69ec34(0x19a),_0x69ec34(0x177)+_0x7ad8da[_0x69ec34(0x192)]+':\x20'+_0x26a1b7);throw new Error(_0x69ec34(0x171)+_0x7ad8da['status']);}const _0x325d35=await _0x7ad8da[_0x69ec34(0x14e)]();console['log'](_0x69ec34(0x170),_0x325d35);let _0x55d34b;try{_0x55d34b=JSON[_0x69ec34(0x173)](_0x325d35);}catch(_0x37bc8b){console['error'](_0x69ec34(0x142),_0x37bc8b),loggerService_1['loggerService'][_0x69ec34(0x174)](_0x69ec34(0x179),_0x69ec34(0x19a),_0x69ec34(0x163)+_0x37bc8b);throw new Error(_0x69ec34(0x152)+_0x325d35);}loggerService_1[_0x69ec34(0x126)][_0x69ec34(0x120)](_0x69ec34(0x179),_0x69ec34(0x19a),_0x7ad8da[_0x69ec34(0x192)],_0x55d34b,_0x39218a),console[_0x69ec34(0x114)](_0x69ec34(0x13c)),console['log'](_0x69ec34(0x143),_0x55d34b[_0x69ec34(0x118)]),console[_0x69ec34(0x114)](_0x69ec34(0x15b),_0x55d34b[_0x69ec34(0x150)]),console[_0x69ec34(0x114)](_0x69ec34(0x148),_0x55d34b[_0x69ec34(0x175)]?.['Status']),console[_0x69ec34(0x114)]('Amount:',_0x55d34b[_0x69ec34(0x175)]?.[_0x69ec34(0x154)]),console[_0x69ec34(0x114)]('Currency:',_0x55d34b[_0x69ec34(0x175)]?.[_0x69ec34(0x15c)]);if(_0x55d34b['result']!=='success'||_0x55d34b['status_code']!==0xc8){const _0x37365d=_0x55d34b['message']||_0x69ec34(0x12c);console[_0x69ec34(0x133)](_0x69ec34(0x141)),console[_0x69ec34(0x133)](_0x69ec34(0x157),_0x37365d),loggerService_1[_0x69ec34(0x126)][_0x69ec34(0x174)](_0x69ec34(0x179),'/status',_0x69ec34(0x139)+_0x37365d);throw new Error(_0x69ec34(0x167)+_0x37365d);}if(!_0x55d34b[_0x69ec34(0x175)]){console[_0x69ec34(0x133)](_0x69ec34(0x187)),console['error'](_0x69ec34(0x16e)),loggerService_1[_0x69ec34(0x126)][_0x69ec34(0x174)](_0x69ec34(0x179),_0x69ec34(0x19a),_0x69ec34(0x196));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x450da6=_0x69ec34(0x11c);switch(_0x55d34b[_0x69ec34(0x175)][_0x69ec34(0x136)]?.[_0x69ec34(0x182)]()){case'paid':_0x450da6=_0x69ec34(0x15d);break;case _0x69ec34(0x16b):case _0x69ec34(0x11d):case _0x69ec34(0x133):_0x450da6='FAILED';break;case _0x69ec34(0x13b):case'timeout':_0x450da6=_0x69ec34(0x191);break;case _0x69ec34(0x186):case'awaiting\x20fiat':case'pending':case _0x69ec34(0x18c):default:_0x450da6=_0x69ec34(0x11c);break;}let _0x2ee4ee,_0x1c5e1e;if(_0x55d34b['data'][_0x69ec34(0x12a)]){const _0x41be53=_0x55d34b['data']['PaymentDetail'];console[_0x69ec34(0x114)](_0x69ec34(0x178),_0x41be53);const _0x1b2bbe=_0x41be53[_0x69ec34(0x129)](/IBAN\s+([A-Z0-9]+)/i);_0x1b2bbe&&(_0x2ee4ee=_0x1b2bbe[0x1],console[_0x69ec34(0x114)]('🏦\x20Extracted\x20IBAN:',_0x2ee4ee)),_0x1c5e1e=_0x41be53;}const _0x32fe99={'iban':_0x2ee4ee,'bankDetails':_0x1c5e1e,'transactionId':_0x55d34b[_0x69ec34(0x175)][_0x69ec34(0x16a)],'coinAddress':_0x55d34b[_0x69ec34(0x175)]['coinAddress'],'qrCodeUrl':_0x55d34b[_0x69ec34(0x175)][_0x69ec34(0x17f)],'expiryTime':_0x55d34b[_0x69ec34(0x175)]['ExpiryTime'],'createdOn':_0x55d34b['data'][_0x69ec34(0x127)],'confirmedOn':_0x55d34b[_0x69ec34(0x175)][_0x69ec34(0x11a)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console['log'](_0x69ec34(0x13f),_0x55d34b[_0x69ec34(0x175)][_0x69ec34(0x136)],'->',_0x450da6),console[_0x69ec34(0x114)](_0x69ec34(0x112),_0x55d34b[_0x69ec34(0x175)][_0x69ec34(0x154)],_0x55d34b[_0x69ec34(0x175)][_0x69ec34(0x15c)]),console[_0x69ec34(0x114)](_0x69ec34(0x13a),_0x55d34b[_0x69ec34(0x175)]['TransactionID']),console[_0x69ec34(0x114)]('IBAN:',_0x2ee4ee||_0x69ec34(0x121)),console['log']('Created\x20On:',_0x55d34b['data'][_0x69ec34(0x127)]),console['log'](_0x69ec34(0x16f),_0x55d34b[_0x69ec34(0x175)][_0x69ec34(0x11a)]||_0x69ec34(0x199));if(_0x55d34b[_0x69ec34(0x175)]['Status']?.[_0x69ec34(0x182)]()===_0x69ec34(0x18a))console['log']('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x55d34b['data'][_0x69ec34(0x136)]?.[_0x69ec34(0x182)]()===_0x69ec34(0x125)&&console[_0x69ec34(0x114)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x450da6,'amount':parseFloat(_0x55d34b[_0x69ec34(0x175)][_0x69ec34(0x154)])||undefined,'currency':_0x55d34b['data'][_0x69ec34(0x15c)]||_0x69ec34(0x12d),'paymentDetails':_0x32fe99};}catch(_0x5f3bf6){console[_0x69ec34(0x133)](_0x69ec34(0x180),_0x5f3bf6),loggerService_1['loggerService'][_0x69ec34(0x174)](_0x69ec34(0x179),_0x69ec34(0x19a),_0x5f3bf6);throw new Error(_0x69ec34(0x15a)+(_0x5f3bf6 instanceof Error?_0x5f3bf6['message']:_0x69ec34(0x15f)));}}async[a49_0x1107e9(0x156)](_0xcd2954){const _0x488d58=a49_0x1107e9,_0x152351=await this[_0x488d58(0x113)](_0xcd2954);return{'status':_0x152351[_0x488d58(0x192)],'amount':_0x152351[_0x488d58(0x18b)],'currency':_0x152351['currency']};}async[a49_0x1107e9(0x185)](_0x166475){const _0x715f4f=a49_0x1107e9;console[_0x715f4f(0x114)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x166475);let _0x21b307=_0x715f4f(0x11c);switch(_0x166475[_0x715f4f(0x192)]?.[_0x715f4f(0x182)]()){case _0x715f4f(0x125):_0x21b307=_0x715f4f(0x15d);break;case _0x715f4f(0x16b):case _0x715f4f(0x11d):case _0x715f4f(0x133):_0x21b307='FAILED';break;case _0x715f4f(0x13b):case'timeout':_0x21b307='EXPIRED';break;case'pending':case _0x715f4f(0x186):case _0x715f4f(0x18a):case _0x715f4f(0x18c):default:_0x21b307=_0x715f4f(0x11c);break;}return{'paymentId':_0x166475[_0x715f4f(0x116)]||_0x166475[_0x715f4f(0x17d)]||'','status':_0x21b307,'amount':_0x166475[_0x715f4f(0x18b)],'currency':_0x166475[_0x715f4f(0x11e)]||'EUR'};}}function a49_0x4972(){const _0x151cef=['===\x20COINTOPAY\x20API\x20ERROR\x20===','logWhiteDomainResponse','not\x20found','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Error\x20details:','Response\x20Time:','paid','loggerService','CreatedOn','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','match','PaymentDetail','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','EUR','../loggerService','1319576JSAdwb','6898GXVbDv','gateway_payment_id','fromEntries','error','📊\x20Status\x20check\x20URL:','Payment\x20URL\x20(modified):','Status','https://tesoft.uk/gateway/cointopay/status.php','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Status\x20API\x20Error:\x20','Transaction\x20ID:','expired','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','/create','866037PPOMZp','Status:','===\x20COINTOPAY\x20SUCCESS\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Failed\x20to\x20parse\x20JSON\x20response:','Result:','1968suZacv','statusText','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===',',\x20body:\x20','Payment\x20Status:','532iLLjKk','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','CoinToPay\x20API\x20error:\x20','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','text','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','status_code','10tdyjnO','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Business\x20Error:\x20','Amount','HTTP\x20Status:','verifyPayment','Error\x20Message:','application/json','Error\x20message:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Status\x20Code:','inputCurrency','PAID','https://tesoft.uk/gateway/cointopay/','Unknown\x20error','789FpdbjW','1421519dQGxGA','7337826eeWyVL','JSON\x20Parse\x20Error:\x20','Error\x20stack:','Parsed\x20Result:','160HFhnQm','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','&alternative=false','TransactionID','cancelled','🪙\x20Creating\x20CoinToPay\x20payment:\x20','POST','Missing\x20data\x20in\x20response','Confirmed\x20On:','Raw\x20Response\x20Body:','HTTP\x20error!\x20status:\x20','message','parse','logWhiteDomainError','data','8506128OLhvwJ','HTTP\x20','🏦\x20Payment\x20Detail:','cointopay','payment_url','stack','CoinToPayService','merchant_reference_id','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','QRCodeURL','CoinToPay\x20payment\x20status\x20check\x20error:','now','toLowerCase','headers','Status\x20Text:','processWebhook','waiting','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','\x20EUR','Response\x20Body:','awaiting\x20fiat','amount','created','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Response\x20data:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','entries','EXPIRED','status','Headers:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','apiUrl','Incomplete\x20response:\x20missing\x20data','logWhiteDomainRequest','statusUrl','not\x20confirmed','/status','defineProperty','stringify','Amount:','checkPaymentStatus','log','Request\x20Body:','order_id','Payment\x20System/1.0','result','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','TransactionConfirmedOn','Gateway\x20Payment\x20ID:','PENDING','failed','currency'];a49_0x4972=function(){return _0x151cef;};return a49_0x4972();}exports['CoinToPayService']=CoinToPayService;