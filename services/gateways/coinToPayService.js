'use strict';const a55_0x2f20c3=a55_0x4525;(function(_0x3e0d8a,_0x35b012){const _0xede6db=a55_0x4525,_0x4a0fe5=_0x3e0d8a();while(!![]){try{const _0x72549f=-parseInt(_0xede6db(0x18b))/0x1+-parseInt(_0xede6db(0x194))/0x2+-parseInt(_0xede6db(0x17b))/0x3+parseInt(_0xede6db(0x19e))/0x4+parseInt(_0xede6db(0x1ae))/0x5*(parseInt(_0xede6db(0x1a6))/0x6)+parseInt(_0xede6db(0x1ba))/0x7*(-parseInt(_0xede6db(0x168))/0x8)+-parseInt(_0xede6db(0x153))/0x9*(-parseInt(_0xede6db(0x19a))/0xa);if(_0x72549f===_0x35b012)break;else _0x4a0fe5['push'](_0x4a0fe5['shift']());}catch(_0x15ed9d){_0x4a0fe5['push'](_0x4a0fe5['shift']());}}}(a55_0x3fea,0xde9a7));function a55_0x3fea(){const _0x50e7c6=['TransactionID','result','data','message','1602TaJwJq','Request\x20Body:','Response\x20Time:','logWhiteDomainRequest','Currency:','Status','not\x20found','order_id','15235aPQNgL','\x20EUR','Payment\x20URL\x20(original):','Failed\x20to\x20parse\x20JSON\x20response:','Raw\x20Response\x20Body:','Missing\x20data\x20in\x20response','defineProperty','PENDING','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','coinAddress','Headers:','../loggerService','56nJCrgh','CoinToPay\x20API\x20error:\x20','fromEntries','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','paid','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','pending','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Unknown\x20error','logWhiteDomainResponse','timeout','merchant_reference_id','/status','apiUrl','PAID','inputCurrency','Result:','error','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','awaiting\x20fiat','status_code','Error\x20stack:','stack','Error\x20Message:','currency','logWhiteDomainError','CoinToPayService','7663905TWMjgO','Gateway\x20Payment\x20ID:','===\x20COINTOPAY\x20API\x20ERROR\x20===','CoinToPay\x20payment\x20status\x20check\x20error:','CreatedOn','===\x20COINTOPAY\x20SUCCESS\x20===','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','cointopay','/create','URL:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','log','stringify','toLowerCase','status','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','PaymentDetail','waiting','Amount:','FAILED','verifyPayment','281872NZLbtJ','EUR','text','EXPIRED','Payment\x20System/1.0','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','headers','HTTP\x20Status:','gateway_payment_id','HTTP\x20error!\x20status:\x20','expired','payment_url','POST','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status:','now','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','https://tesoft.uk/gateway/cointopay/','application/json','3097818oIZchy','Incomplete\x20response:\x20missing\x20data','cancelled','JSON\x20Parse\x20Error:\x20','TransactionConfirmedOn','Response\x20data:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','entries','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Error\x20details:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','__esModule','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Amount','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','639745SlCMev','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','QRCodeURL','IBAN:','parse','Status\x20Code:','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','amount',',\x20body:\x20','1312506qnBuGf','Confirmed\x20On:','created','ðŸ¦\x20Payment\x20Detail:','Payment\x20URL\x20(modified):','loggerService','20nciZsP','Response\x20Body:','success','failed','4022480bNzmKG','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','statusUrl','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID'];a55_0x3fea=function(){return _0x50e7c6;};return a55_0x3fea();}Object[a55_0x2f20c3(0x1b4)](exports,a55_0x2f20c3(0x186),{'value':!![]}),exports[a55_0x2f20c3(0x152)]=void 0x0;const loggerService_1=require(a55_0x2f20c3(0x1b9));function a55_0x4525(_0x4df9e3,_0x5b6be6){_0x4df9e3=_0x4df9e3-0x14b;const _0x3fea9f=a55_0x3fea();let _0x452591=_0x3fea9f[_0x4df9e3];return _0x452591;}class CoinToPayService{constructor(){const _0x1ef6e4=a55_0x2f20c3;this[_0x1ef6e4(0x1c7)]=_0x1ef6e4(0x179),this[_0x1ef6e4(0x1a0)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x1ef6e4(0x15e)]('ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x1ef6e4(0x15e)]('ðŸ“Š\x20Status\x20check\x20URL:',this['statusUrl']);}async['createPaymentLink'](_0x2b4cc9){const _0xdd8cd3=a55_0x2f20c3,{orderId:_0x579963,amount:_0x3853c1}=_0x2b4cc9;console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x191)+_0x3853c1+_0xdd8cd3(0x1af));const _0x111265={'amount':_0x3853c1},_0x5d3118=Date[_0xdd8cd3(0x177)]();try{console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x1bd)),console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x15c),this[_0xdd8cd3(0x1c7)]),console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x1a7),JSON[_0xdd8cd3(0x15f)](_0x111265,null,0x2)),console[_0xdd8cd3(0x15e)]('Amount:',_0x3853c1,_0xdd8cd3(0x162)),loggerService_1[_0xdd8cd3(0x199)][_0xdd8cd3(0x1a9)](_0xdd8cd3(0x15a),_0xdd8cd3(0x15b),_0xdd8cd3(0x174),_0x111265);const _0x4f552f=await fetch(this[_0xdd8cd3(0x1c7)],{'method':_0xdd8cd3(0x174),'headers':{'Content-Type':_0xdd8cd3(0x17a),'Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON[_0xdd8cd3(0x15f)](_0x111265)}),_0x231d2b=Date['now']()-_0x5d3118;console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x175)),console['log']('Status:',_0x4f552f[_0xdd8cd3(0x161)]),console[_0xdd8cd3(0x15e)]('Status\x20Text:',_0x4f552f['statusText']),console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x1b8),Object[_0xdd8cd3(0x1bc)](_0x4f552f[_0xdd8cd3(0x16e)][_0xdd8cd3(0x182)]())),console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x1a8),_0x231d2b+'ms');const _0x2a6b5c=await _0x4f552f[_0xdd8cd3(0x16a)]();console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x1b2),_0x2a6b5c);if(!_0x4f552f['ok']){console[_0xdd8cd3(0x1cb)](_0xdd8cd3(0x155)),console[_0xdd8cd3(0x1cb)](_0xdd8cd3(0x16f),_0x4f552f[_0xdd8cd3(0x161)]),console[_0xdd8cd3(0x1cb)](_0xdd8cd3(0x19b),_0x2a6b5c),loggerService_1['loggerService'][_0xdd8cd3(0x1c3)]('cointopay','/create',_0x4f552f['status'],_0x2a6b5c,_0x231d2b),loggerService_1[_0xdd8cd3(0x199)][_0xdd8cd3(0x151)]('cointopay',_0xdd8cd3(0x15b),'HTTP\x20'+_0x4f552f[_0xdd8cd3(0x161)]+':\x20'+_0x2a6b5c);throw new Error(_0xdd8cd3(0x171)+_0x4f552f[_0xdd8cd3(0x161)]+_0xdd8cd3(0x193)+_0x2a6b5c);}let _0x276dcc;try{_0x276dcc=JSON[_0xdd8cd3(0x18f)](_0x2a6b5c);}catch(_0x6fe96e){console[_0xdd8cd3(0x1cb)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x6fe96e),loggerService_1[_0xdd8cd3(0x199)][_0xdd8cd3(0x151)](_0xdd8cd3(0x15a),_0xdd8cd3(0x15b),_0xdd8cd3(0x17e)+_0x6fe96e);throw new Error(_0xdd8cd3(0x18c)+_0x2a6b5c);}console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x189)),console[_0xdd8cd3(0x15e)]('Parsed\x20Result:',JSON[_0xdd8cd3(0x15f)](_0x276dcc,null,0x2)),loggerService_1[_0xdd8cd3(0x199)][_0xdd8cd3(0x1c3)](_0xdd8cd3(0x15a),_0xdd8cd3(0x15b),_0x4f552f['status'],_0x276dcc,_0x231d2b);if(_0x276dcc[_0xdd8cd3(0x1cb)]){const _0x4655a4=_0x276dcc['message']||_0x276dcc['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0xdd8cd3(0x1cb)](_0xdd8cd3(0x183)),console[_0xdd8cd3(0x1cb)](_0xdd8cd3(0x14f),_0x4655a4),loggerService_1[_0xdd8cd3(0x199)][_0xdd8cd3(0x151)]('cointopay',_0xdd8cd3(0x15b),'Business\x20Error:\x20'+_0x4655a4);throw new Error(_0xdd8cd3(0x1bb)+_0x4655a4);}if(!_0x276dcc[_0xdd8cd3(0x173)]||!_0x276dcc[_0xdd8cd3(0x170)]){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0xdd8cd3(0x181)),console[_0xdd8cd3(0x1cb)](_0xdd8cd3(0x180),_0x276dcc),loggerService_1['loggerService'][_0xdd8cd3(0x151)](_0xdd8cd3(0x15a),_0xdd8cd3(0x15b),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0xdd8cd3(0x1bf));}console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x158)),console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x154),_0x276dcc[_0xdd8cd3(0x170)]),console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x1b0),_0x276dcc[_0xdd8cd3(0x173)]);const _0x232bb5=_0x276dcc['payment_url']+'&alternative=false';return console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x198),_0x232bb5),console[_0xdd8cd3(0x15e)](_0xdd8cd3(0x165),_0x3853c1,'EUR'),{'gateway_payment_id':_0x276dcc[_0xdd8cd3(0x170)],'payment_url':_0x232bb5};}catch(_0x54f4ca){console[_0xdd8cd3(0x1cb)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0xdd8cd3(0x1cb)](_0xdd8cd3(0x184),_0x54f4ca),loggerService_1[_0xdd8cd3(0x199)][_0xdd8cd3(0x151)](_0xdd8cd3(0x15a),_0xdd8cd3(0x15b),_0x54f4ca);if(_0x54f4ca instanceof Error){console['error']('Error\x20message:',_0x54f4ca[_0xdd8cd3(0x1a5)]),console[_0xdd8cd3(0x1cb)](_0xdd8cd3(0x14d),_0x54f4ca[_0xdd8cd3(0x14e)]);throw new Error(_0xdd8cd3(0x16d)+_0x54f4ca[_0xdd8cd3(0x1a5)]);}throw new Error(_0xdd8cd3(0x178));}}async['checkPaymentStatus'](_0x59532a){const _0x438a01=a55_0x2f20c3,_0x1625f3=Date['now']();try{console[_0x438a01(0x15e)](_0x438a01(0x1c1)+_0x59532a);const _0x1ef041={'gatewayPaymentId':_0x59532a};loggerService_1[_0x438a01(0x199)][_0x438a01(0x1a9)](_0x438a01(0x15a),_0x438a01(0x1c6),_0x438a01(0x174),_0x1ef041);const _0x1d121b=await fetch(this[_0x438a01(0x1a0)],{'method':_0x438a01(0x174),'headers':{'Content-Type':_0x438a01(0x17a),'Accept':_0x438a01(0x17a),'User-Agent':_0x438a01(0x16c)},'body':JSON[_0x438a01(0x15f)](_0x1ef041)}),_0xad7b09=Date['now']()-_0x1625f3;console[_0x438a01(0x15e)](_0x438a01(0x18a)),console[_0x438a01(0x15e)]('Status:',_0x1d121b[_0x438a01(0x161)]),console[_0x438a01(0x15e)](_0x438a01(0x1a8),_0xad7b09+'ms');if(!_0x1d121b['ok']){const _0x1a081c=await _0x1d121b[_0x438a01(0x16a)]();console[_0x438a01(0x1cb)](_0x438a01(0x16f),_0x1d121b[_0x438a01(0x161)]),console[_0x438a01(0x1cb)](_0x438a01(0x19b),_0x1a081c),loggerService_1[_0x438a01(0x199)]['logWhiteDomainResponse'](_0x438a01(0x15a),_0x438a01(0x1c6),_0x1d121b['status'],_0x1a081c,_0xad7b09),loggerService_1[_0x438a01(0x199)][_0x438a01(0x151)](_0x438a01(0x15a),'/status','HTTP\x20'+_0x1d121b['status']+':\x20'+_0x1a081c);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1d121b[_0x438a01(0x161)]);}const _0x15283e=await _0x1d121b['text']();console[_0x438a01(0x15e)]('Raw\x20Response\x20Body:',_0x15283e);let _0x274bb4;try{_0x274bb4=JSON[_0x438a01(0x18f)](_0x15283e);}catch(_0x511c79){console['error'](_0x438a01(0x1b1),_0x511c79),loggerService_1['loggerService'][_0x438a01(0x151)](_0x438a01(0x15a),_0x438a01(0x1c6),'JSON\x20Parse\x20Error:\x20'+_0x511c79);throw new Error(_0x438a01(0x187)+_0x15283e);}loggerService_1[_0x438a01(0x199)][_0x438a01(0x1c3)](_0x438a01(0x15a),_0x438a01(0x1c6),_0x1d121b[_0x438a01(0x161)],_0x274bb4,_0xad7b09),console[_0x438a01(0x15e)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x438a01(0x1ca),_0x274bb4[_0x438a01(0x1a3)]),console[_0x438a01(0x15e)](_0x438a01(0x190),_0x274bb4[_0x438a01(0x14c)]),console[_0x438a01(0x15e)]('Payment\x20Status:',_0x274bb4['data']?.['Status']),console['log']('Amount:',_0x274bb4['data']?.['Amount']),console[_0x438a01(0x15e)](_0x438a01(0x1aa),_0x274bb4[_0x438a01(0x1a4)]?.['inputCurrency']);if(_0x274bb4[_0x438a01(0x1a3)]!==_0x438a01(0x19c)||_0x274bb4[_0x438a01(0x14c)]!==0xc8){const _0x32bd31=_0x274bb4[_0x438a01(0x1a5)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x438a01(0x1cb)](_0x438a01(0x1cc)),console[_0x438a01(0x1cb)](_0x438a01(0x14f),_0x32bd31),loggerService_1[_0x438a01(0x199)][_0x438a01(0x151)](_0x438a01(0x15a),_0x438a01(0x1c6),'Status\x20API\x20Error:\x20'+_0x32bd31);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x32bd31);}if(!_0x274bb4['data']){console[_0x438a01(0x1cb)](_0x438a01(0x185)),console[_0x438a01(0x1cb)](_0x438a01(0x1b3)),loggerService_1[_0x438a01(0x199)][_0x438a01(0x151)]('cointopay',_0x438a01(0x1c6),_0x438a01(0x17c));throw new Error(_0x438a01(0x159));}let _0x36b697=_0x438a01(0x1b5);switch(_0x274bb4[_0x438a01(0x1a4)][_0x438a01(0x1ab)]?.[_0x438a01(0x160)]()){case _0x438a01(0x1be):_0x36b697='PAID';break;case _0x438a01(0x17d):case _0x438a01(0x19d):case _0x438a01(0x1cb):_0x36b697=_0x438a01(0x166);break;case'expired':case _0x438a01(0x1c4):_0x36b697=_0x438a01(0x16b);break;case _0x438a01(0x164):case'awaiting\x20fiat':case'pending':case _0x438a01(0x196):default:_0x36b697='PENDING';break;}let _0x383f4f,_0x3bdebd;if(_0x274bb4['data']['PaymentDetail']){const _0x5119e2=_0x274bb4[_0x438a01(0x1a4)][_0x438a01(0x163)];console['log'](_0x438a01(0x197),_0x5119e2);const _0x19e0c5=_0x5119e2['match'](/IBAN\s+([A-Z0-9]+)/i);_0x19e0c5&&(_0x383f4f=_0x19e0c5[0x1],console[_0x438a01(0x15e)]('ðŸ¦\x20Extracted\x20IBAN:',_0x383f4f)),_0x3bdebd=_0x5119e2;}const _0x34e24d={'iban':_0x383f4f,'bankDetails':_0x3bdebd,'transactionId':_0x274bb4[_0x438a01(0x1a4)][_0x438a01(0x1a2)],'coinAddress':_0x274bb4['data'][_0x438a01(0x1b7)],'qrCodeUrl':_0x274bb4[_0x438a01(0x1a4)][_0x438a01(0x18d)],'expiryTime':_0x274bb4[_0x438a01(0x1a4)]['ExpiryTime'],'createdOn':_0x274bb4[_0x438a01(0x1a4)][_0x438a01(0x157)],'confirmedOn':_0x274bb4['data']['TransactionConfirmedOn']};console[_0x438a01(0x15e)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x438a01(0x15e)](_0x438a01(0x176),_0x274bb4['data']['Status'],'->',_0x36b697),console[_0x438a01(0x15e)]('Amount:',_0x274bb4[_0x438a01(0x1a4)][_0x438a01(0x188)],_0x274bb4[_0x438a01(0x1a4)][_0x438a01(0x1c9)]),console[_0x438a01(0x15e)]('Transaction\x20ID:',_0x274bb4[_0x438a01(0x1a4)][_0x438a01(0x1a2)]),console['log'](_0x438a01(0x18e),_0x383f4f||_0x438a01(0x1ac)),console[_0x438a01(0x15e)]('Created\x20On:',_0x274bb4['data']['CreatedOn']),console[_0x438a01(0x15e)](_0x438a01(0x195),_0x274bb4[_0x438a01(0x1a4)][_0x438a01(0x17f)]||'not\x20confirmed');if(_0x274bb4[_0x438a01(0x1a4)]['Status']?.['toLowerCase']()===_0x438a01(0x14b))console['log'](_0x438a01(0x1b6));else _0x274bb4[_0x438a01(0x1a4)][_0x438a01(0x1ab)]?.[_0x438a01(0x160)]()===_0x438a01(0x1be)&&console['log'](_0x438a01(0x1a1));return{'status':_0x36b697,'amount':parseFloat(_0x274bb4[_0x438a01(0x1a4)]['Amount'])||undefined,'currency':_0x274bb4[_0x438a01(0x1a4)]['inputCurrency']||_0x438a01(0x169),'paymentDetails':_0x34e24d};}catch(_0x570c22){console[_0x438a01(0x1cb)](_0x438a01(0x156),_0x570c22),loggerService_1[_0x438a01(0x199)][_0x438a01(0x151)](_0x438a01(0x15a),_0x438a01(0x1c6),_0x570c22);throw new Error(_0x438a01(0x19f)+(_0x570c22 instanceof Error?_0x570c22['message']:_0x438a01(0x1c2)));}}async[a55_0x2f20c3(0x167)](_0x58faef){const _0x5e1de1=a55_0x2f20c3,_0x266287=await this['checkPaymentStatus'](_0x58faef);return{'status':_0x266287[_0x5e1de1(0x161)],'amount':_0x266287['amount'],'currency':_0x266287[_0x5e1de1(0x150)]};}async['processWebhook'](_0x3c2cd3){const _0x24dc39=a55_0x2f20c3;console[_0x24dc39(0x15e)](_0x24dc39(0x15d),_0x3c2cd3);let _0x413e2d='PENDING';switch(_0x3c2cd3[_0x24dc39(0x161)]?.[_0x24dc39(0x160)]()){case _0x24dc39(0x1be):_0x413e2d=_0x24dc39(0x1c8);break;case _0x24dc39(0x17d):case _0x24dc39(0x19d):case _0x24dc39(0x1cb):_0x413e2d='FAILED';break;case _0x24dc39(0x172):case'timeout':_0x413e2d=_0x24dc39(0x16b);break;case _0x24dc39(0x1c0):case _0x24dc39(0x164):case'awaiting\x20fiat':case _0x24dc39(0x196):default:_0x413e2d=_0x24dc39(0x1b5);break;}return{'paymentId':_0x3c2cd3[_0x24dc39(0x1ad)]||_0x3c2cd3[_0x24dc39(0x1c5)]||'','status':_0x413e2d,'amount':_0x3c2cd3[_0x24dc39(0x192)],'currency':_0x3c2cd3['currency']||_0x24dc39(0x169)};}}exports[a55_0x2f20c3(0x152)]=CoinToPayService;