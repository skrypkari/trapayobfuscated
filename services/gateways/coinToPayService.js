'use strict';const a57_0x287e29=a57_0x3790;(function(_0x4079eb,_0x482c74){const _0x34f159=a57_0x3790,_0x50cdf3=_0x4079eb();while(!![]){try{const _0x3508d4=parseInt(_0x34f159(0xc6))/0x1*(parseInt(_0x34f159(0xe0))/0x2)+-parseInt(_0x34f159(0x7a))/0x3*(-parseInt(_0x34f159(0x84))/0x4)+parseInt(_0x34f159(0xa0))/0x5+parseInt(_0x34f159(0x7e))/0x6+parseInt(_0x34f159(0xd9))/0x7*(-parseInt(_0x34f159(0xe4))/0x8)+-parseInt(_0x34f159(0xec))/0x9*(-parseInt(_0x34f159(0xfc))/0xa)+-parseInt(_0x34f159(0x90))/0xb;if(_0x3508d4===_0x482c74)break;else _0x50cdf3['push'](_0x50cdf3['shift']());}catch(_0x318830){_0x50cdf3['push'](_0x50cdf3['shift']());}}}(a57_0x4891,0x8ebb8));function a57_0x3790(_0x2942d2,_0x140c60){_0x2942d2=_0x2942d2-0x73;const _0x489197=a57_0x4891();let _0x3790ff=_0x489197[_0x2942d2];return _0x3790ff;}function a57_0x4891(){const _0x3e71d0=['Status\x20API\x20Error:\x20','not\x20found','now','Response\x20Time:','66iEVgtl','payment_url','Request\x20Body:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Result:','../loggerService','TransactionConfirmedOn','stringify','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','HTTP\x20Status:','defineProperty','CoinToPay\x20payment\x20status\x20check\x20error:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','POST','Headers:','Status\x20Code:','headers','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','500059YGMDYp','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','CoinToPayService','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','PENDING','Response\x20Body:','PaymentDetail','11878UgAxRU','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','verifyPayment','logWhiteDomainResponse','8dvnQPH','entries','IBAN:','toLowerCase','loggerService','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Raw\x20Response\x20Body:','Error\x20message:','207KOcOGq','application/json','__esModule','timeout','/create','Amount','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Error\x20Message:','Status\x20Text:','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','status','result','Business\x20Error:\x20','URL:','Gateway\x20Payment\x20ID:','text','138790oHAxuW','FAILED','apiUrl','inputCurrency',',\x20body:\x20','EUR','Failed\x20to\x20parse\x20JSON\x20response:','parse','JSON\x20Parse\x20Error:\x20','12aXVItL','Currency:','logWhiteDomainError','Payment\x20Status:','7482qaGNOf','checkPaymentStatus','not\x20confirmed','expired','processWebhook','error','603980vtEVqh','success','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','ðŸ“Š\x20Status\x20check\x20URL:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Incomplete\x20response:\x20missing\x20data','data','\x20EUR','gateway_payment_id','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','12403556iMRIjR','cointopay','merchant_reference_id','Created\x20On:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','statusUrl','pending','EXPIRED','failed','log','message','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','QRCodeURL','stack','waiting','===\x20COINTOPAY\x20API\x20ERROR\x20===','2336235VzlKzQ','Payment\x20URL\x20(original):','status_code','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','created','HTTP\x20','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Amount:','CreatedOn','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','TransactionID','currency','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Status:','Confirmed\x20On:','awaiting\x20fiat','ExpiryTime','order_id','PAID','HTTP\x20error!\x20status:\x20','Transaction\x20ID:','logWhiteDomainRequest','Parsed\x20Result:','/status','paid','amount','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','statusText','Status','cancelled','Response\x20data:','Payment\x20System/1.0','Unknown\x20error'];a57_0x4891=function(){return _0x3e71d0;};return a57_0x4891();}Object[a57_0x287e29(0xd1)](exports,a57_0x287e29(0xee),{'value':!![]}),exports[a57_0x287e29(0xdb)]=void 0x0;const loggerService_1=require(a57_0x287e29(0xcc));class CoinToPayService{constructor(){const _0x42ac02=a57_0x287e29;this[_0x42ac02(0x73)]='https://tesoft.uk/gateway/cointopay/',this[_0x42ac02(0x95)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x42ac02(0x99)](_0x42ac02(0xa3)),console[_0x42ac02(0x99)](_0x42ac02(0x87),this[_0x42ac02(0x95)]);}async['createPaymentLink'](_0x5b3c4a){const _0x5aef9f=a57_0x287e29,{orderId:_0x1d3f21,amount:_0x3f2c96}=_0x5b3c4a;console['log'](_0x5aef9f(0x8e)+_0x3f2c96+_0x5aef9f(0x8b));const _0x6c7129={'amount':_0x3f2c96},_0x11d650=Date[_0x5aef9f(0xc4)]();try{console[_0x5aef9f(0x99)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x5aef9f(0x99)](_0x5aef9f(0xf9),this[_0x5aef9f(0x73)]),console['log'](_0x5aef9f(0xc8),JSON[_0x5aef9f(0xce)](_0x6c7129,null,0x2)),console['log'](_0x5aef9f(0xa8),_0x3f2c96,_0x5aef9f(0xc9)),loggerService_1['loggerService'][_0x5aef9f(0xb6)](_0x5aef9f(0x91),_0x5aef9f(0xf0),'POST',_0x6c7129);const _0x361263=await fetch(this[_0x5aef9f(0x73)],{'method':_0x5aef9f(0xd4),'headers':{'Content-Type':_0x5aef9f(0xed),'Accept':'application/json','User-Agent':_0x5aef9f(0xc0)},'body':JSON[_0x5aef9f(0xce)](_0x6c7129)}),_0x1b63a2=Date[_0x5aef9f(0xc4)]()-_0x11d650;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x5aef9f(0x99)](_0x5aef9f(0xae),_0x361263[_0x5aef9f(0xf6)]),console[_0x5aef9f(0x99)](_0x5aef9f(0xf4),_0x361263[_0x5aef9f(0xbc)]),console[_0x5aef9f(0x99)](_0x5aef9f(0xd5),Object['fromEntries'](_0x361263[_0x5aef9f(0xd7)][_0x5aef9f(0xe5)]())),console['log'](_0x5aef9f(0xc5),_0x1b63a2+'ms');const _0x117bce=await _0x361263[_0x5aef9f(0xfb)]();console[_0x5aef9f(0x99)](_0x5aef9f(0xea),_0x117bce);if(!_0x361263['ok']){console[_0x5aef9f(0x83)](_0x5aef9f(0x9f)),console[_0x5aef9f(0x83)](_0x5aef9f(0xd0),_0x361263[_0x5aef9f(0xf6)]),console[_0x5aef9f(0x83)](_0x5aef9f(0xde),_0x117bce),loggerService_1[_0x5aef9f(0xe8)]['logWhiteDomainResponse'](_0x5aef9f(0x91),'/create',_0x361263[_0x5aef9f(0xf6)],_0x117bce,_0x1b63a2),loggerService_1[_0x5aef9f(0xe8)][_0x5aef9f(0x7c)](_0x5aef9f(0x91),_0x5aef9f(0xf0),_0x5aef9f(0xa5)+_0x361263[_0x5aef9f(0xf6)]+':\x20'+_0x117bce);throw new Error(_0x5aef9f(0xb4)+_0x361263[_0x5aef9f(0xf6)]+_0x5aef9f(0x75)+_0x117bce);}let _0x56513d;try{_0x56513d=JSON['parse'](_0x117bce);}catch(_0x3ba463){console['error'](_0x5aef9f(0x77),_0x3ba463),loggerService_1[_0x5aef9f(0xe8)][_0x5aef9f(0x7c)](_0x5aef9f(0x91),_0x5aef9f(0xf0),_0x5aef9f(0x79)+_0x3ba463);throw new Error(_0x5aef9f(0x94)+_0x117bce);}console['log'](_0x5aef9f(0xda)),console[_0x5aef9f(0x99)](_0x5aef9f(0xb7),JSON['stringify'](_0x56513d,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x5aef9f(0x91),_0x5aef9f(0xf0),_0x361263[_0x5aef9f(0xf6)],_0x56513d,_0x1b63a2);if(_0x56513d[_0x5aef9f(0x83)]){const _0x44fef0=_0x56513d['message']||_0x56513d[_0x5aef9f(0x83)]||_0x5aef9f(0x8f);console[_0x5aef9f(0x83)](_0x5aef9f(0xe1)),console[_0x5aef9f(0x83)](_0x5aef9f(0xf3),_0x44fef0),loggerService_1[_0x5aef9f(0xe8)][_0x5aef9f(0x7c)]('cointopay',_0x5aef9f(0xf0),_0x5aef9f(0xf8)+_0x44fef0);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x44fef0);}if(!_0x56513d[_0x5aef9f(0xc7)]||!_0x56513d[_0x5aef9f(0x8c)]){console['error'](_0x5aef9f(0x9b)),console[_0x5aef9f(0x83)](_0x5aef9f(0xf2)),console[_0x5aef9f(0x83)](_0x5aef9f(0xbf),_0x56513d),loggerService_1[_0x5aef9f(0xe8)][_0x5aef9f(0x7c)](_0x5aef9f(0x91),_0x5aef9f(0xf0),_0x5aef9f(0x8d));throw new Error(_0x5aef9f(0xd3));}console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x5aef9f(0x99)](_0x5aef9f(0xfa),_0x56513d['gateway_payment_id']),console['log'](_0x5aef9f(0xa1),_0x56513d['payment_url']);const _0xcbbbc1=_0x56513d['payment_url']+'&alternative=false';return console[_0x5aef9f(0x99)]('Payment\x20URL\x20(modified):',_0xcbbbc1),console['log'](_0x5aef9f(0xa8),_0x3f2c96,_0x5aef9f(0x76)),{'gateway_payment_id':_0x56513d[_0x5aef9f(0x8c)],'payment_url':_0xcbbbc1};}catch(_0x4cf60a){console[_0x5aef9f(0x83)](_0x5aef9f(0xcf)),console[_0x5aef9f(0x83)]('Error\x20details:',_0x4cf60a),loggerService_1[_0x5aef9f(0xe8)][_0x5aef9f(0x7c)](_0x5aef9f(0x91),'/create',_0x4cf60a);if(_0x4cf60a instanceof Error){console[_0x5aef9f(0x83)](_0x5aef9f(0xeb),_0x4cf60a['message']),console[_0x5aef9f(0x83)]('Error\x20stack:',_0x4cf60a[_0x5aef9f(0x9d)]);throw new Error(_0x5aef9f(0xe9)+_0x4cf60a[_0x5aef9f(0x9a)]);}throw new Error(_0x5aef9f(0xd8));}}async['checkPaymentStatus'](_0x41518a){const _0x4a4786=a57_0x287e29,_0x264753=Date[_0x4a4786(0xc4)]();try{console[_0x4a4786(0x99)](_0x4a4786(0xdc)+_0x41518a);const _0x1a080f={'gatewayPaymentId':_0x41518a};loggerService_1[_0x4a4786(0xe8)][_0x4a4786(0xb6)](_0x4a4786(0x91),_0x4a4786(0xb8),_0x4a4786(0xd4),_0x1a080f);const _0x573a9b=await fetch(this[_0x4a4786(0x95)],{'method':_0x4a4786(0xd4),'headers':{'Content-Type':_0x4a4786(0xed),'Accept':_0x4a4786(0xed),'User-Agent':_0x4a4786(0xc0)},'body':JSON['stringify'](_0x1a080f)}),_0x512d2a=Date[_0x4a4786(0xc4)]()-_0x264753;console[_0x4a4786(0x99)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x4a4786(0x99)](_0x4a4786(0xae),_0x573a9b['status']),console[_0x4a4786(0x99)](_0x4a4786(0xc5),_0x512d2a+'ms');if(!_0x573a9b['ok']){const _0x20d132=await _0x573a9b[_0x4a4786(0xfb)]();console[_0x4a4786(0x83)]('HTTP\x20Status:',_0x573a9b['status']),console[_0x4a4786(0x83)](_0x4a4786(0xde),_0x20d132),loggerService_1[_0x4a4786(0xe8)][_0x4a4786(0xe3)]('cointopay',_0x4a4786(0xb8),_0x573a9b[_0x4a4786(0xf6)],_0x20d132,_0x512d2a),loggerService_1[_0x4a4786(0xe8)][_0x4a4786(0x7c)](_0x4a4786(0x91),_0x4a4786(0xb8),'HTTP\x20'+_0x573a9b[_0x4a4786(0xf6)]+':\x20'+_0x20d132);throw new Error(_0x4a4786(0xb4)+_0x573a9b[_0x4a4786(0xf6)]);}const _0x3efebb=await _0x573a9b[_0x4a4786(0xfb)]();console[_0x4a4786(0x99)](_0x4a4786(0xea),_0x3efebb);let _0x12cc3f;try{_0x12cc3f=JSON[_0x4a4786(0x78)](_0x3efebb);}catch(_0x4474cc){console[_0x4a4786(0x83)](_0x4a4786(0x77),_0x4474cc),loggerService_1[_0x4a4786(0xe8)][_0x4a4786(0x7c)]('cointopay','/status','JSON\x20Parse\x20Error:\x20'+_0x4474cc);throw new Error(_0x4a4786(0xbb)+_0x3efebb);}loggerService_1[_0x4a4786(0xe8)]['logWhiteDomainResponse'](_0x4a4786(0x91),_0x4a4786(0xb8),_0x573a9b[_0x4a4786(0xf6)],_0x12cc3f,_0x512d2a),console[_0x4a4786(0x99)](_0x4a4786(0x86)),console[_0x4a4786(0x99)](_0x4a4786(0xcb),_0x12cc3f[_0x4a4786(0xf7)]),console['log'](_0x4a4786(0xd6),_0x12cc3f[_0x4a4786(0xa2)]),console[_0x4a4786(0x99)](_0x4a4786(0x7d),_0x12cc3f[_0x4a4786(0x8a)]?.[_0x4a4786(0xbd)]),console['log']('Amount:',_0x12cc3f[_0x4a4786(0x8a)]?.['Amount']),console[_0x4a4786(0x99)](_0x4a4786(0x7b),_0x12cc3f[_0x4a4786(0x8a)]?.[_0x4a4786(0x74)]);if(_0x12cc3f['result']!==_0x4a4786(0x85)||_0x12cc3f[_0x4a4786(0xa2)]!==0xc8){const _0x285916=_0x12cc3f[_0x4a4786(0x9a)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x4a4786(0x83)](_0x4a4786(0xaa)),console[_0x4a4786(0x83)](_0x4a4786(0xf3),_0x285916),loggerService_1[_0x4a4786(0xe8)][_0x4a4786(0x7c)](_0x4a4786(0x91),_0x4a4786(0xb8),_0x4a4786(0xc2)+_0x285916);throw new Error(_0x4a4786(0xa6)+_0x285916);}if(!_0x12cc3f[_0x4a4786(0x8a)]){console['error'](_0x4a4786(0xa7)),console[_0x4a4786(0x83)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x4a4786(0xe8)][_0x4a4786(0x7c)](_0x4a4786(0x91),_0x4a4786(0xb8),_0x4a4786(0x89));throw new Error(_0x4a4786(0x88));}let _0x2948bc=_0x4a4786(0xdd);switch(_0x12cc3f['data'][_0x4a4786(0xbd)]?.['toLowerCase']()){case _0x4a4786(0xb9):_0x2948bc=_0x4a4786(0xb3);break;case'cancelled':case _0x4a4786(0x98):case _0x4a4786(0x83):_0x2948bc=_0x4a4786(0xfd);break;case _0x4a4786(0x81):case _0x4a4786(0xef):_0x2948bc='EXPIRED';break;case _0x4a4786(0x9e):case'awaiting\x20fiat':case _0x4a4786(0x96):case _0x4a4786(0xa4):default:_0x2948bc='PENDING';break;}let _0x2f0dce,_0x2f1cb2;if(_0x12cc3f['data'][_0x4a4786(0xdf)]){const _0x5d60c5=_0x12cc3f[_0x4a4786(0x8a)][_0x4a4786(0xdf)];console[_0x4a4786(0x99)]('ðŸ¦\x20Payment\x20Detail:',_0x5d60c5);const _0x2ab32d=_0x5d60c5['match'](/IBAN\s+([A-Z0-9]+)/i);_0x2ab32d&&(_0x2f0dce=_0x2ab32d[0x1],console[_0x4a4786(0x99)]('ðŸ¦\x20Extracted\x20IBAN:',_0x2f0dce)),_0x2f1cb2=_0x5d60c5;}const _0x30415b={'iban':_0x2f0dce,'bankDetails':_0x2f1cb2,'transactionId':_0x12cc3f[_0x4a4786(0x8a)][_0x4a4786(0xab)],'coinAddress':_0x12cc3f[_0x4a4786(0x8a)]['coinAddress'],'qrCodeUrl':_0x12cc3f[_0x4a4786(0x8a)][_0x4a4786(0x9c)],'expiryTime':_0x12cc3f[_0x4a4786(0x8a)][_0x4a4786(0xb1)],'createdOn':_0x12cc3f['data'][_0x4a4786(0xa9)],'confirmedOn':_0x12cc3f[_0x4a4786(0x8a)]['TransactionConfirmedOn']};console[_0x4a4786(0x99)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x4a4786(0x99)](_0x4a4786(0xae),_0x12cc3f['data'][_0x4a4786(0xbd)],'->',_0x2948bc),console[_0x4a4786(0x99)](_0x4a4786(0xa8),_0x12cc3f['data'][_0x4a4786(0xf1)],_0x12cc3f[_0x4a4786(0x8a)][_0x4a4786(0x74)]),console[_0x4a4786(0x99)](_0x4a4786(0xb5),_0x12cc3f[_0x4a4786(0x8a)]['TransactionID']),console[_0x4a4786(0x99)](_0x4a4786(0xe6),_0x2f0dce||_0x4a4786(0xc3)),console['log'](_0x4a4786(0x93),_0x12cc3f[_0x4a4786(0x8a)][_0x4a4786(0xa9)]),console[_0x4a4786(0x99)](_0x4a4786(0xaf),_0x12cc3f[_0x4a4786(0x8a)][_0x4a4786(0xcd)]||_0x4a4786(0x80));if(_0x12cc3f['data'][_0x4a4786(0xbd)]?.[_0x4a4786(0xe7)]()===_0x4a4786(0xb0))console[_0x4a4786(0x99)](_0x4a4786(0xad));else _0x12cc3f[_0x4a4786(0x8a)]['Status']?.['toLowerCase']()===_0x4a4786(0xb9)&&console[_0x4a4786(0x99)](_0x4a4786(0xf5));return{'status':_0x2948bc,'amount':parseFloat(_0x12cc3f[_0x4a4786(0x8a)]['Amount'])||undefined,'currency':_0x12cc3f[_0x4a4786(0x8a)]['inputCurrency']||_0x4a4786(0x76),'paymentDetails':_0x30415b};}catch(_0x3873eb){console[_0x4a4786(0x83)](_0x4a4786(0xd2),_0x3873eb),loggerService_1['loggerService'][_0x4a4786(0x7c)](_0x4a4786(0x91),_0x4a4786(0xb8),_0x3873eb);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x3873eb instanceof Error?_0x3873eb[_0x4a4786(0x9a)]:_0x4a4786(0xc1)));}}async[a57_0x287e29(0xe2)](_0x2beb0d){const _0x1909f8=a57_0x287e29,_0x828c74=await this[_0x1909f8(0x7f)](_0x2beb0d);return{'status':_0x828c74[_0x1909f8(0xf6)],'amount':_0x828c74[_0x1909f8(0xba)],'currency':_0x828c74[_0x1909f8(0xac)]};}async[a57_0x287e29(0x82)](_0x92b6c1){const _0x3a4ca9=a57_0x287e29;console[_0x3a4ca9(0x99)](_0x3a4ca9(0xca),_0x92b6c1);let _0xdd4ed6='PENDING';switch(_0x92b6c1[_0x3a4ca9(0xf6)]?.[_0x3a4ca9(0xe7)]()){case'paid':_0xdd4ed6='PAID';break;case _0x3a4ca9(0xbe):case'failed':case _0x3a4ca9(0x83):_0xdd4ed6=_0x3a4ca9(0xfd);break;case _0x3a4ca9(0x81):case _0x3a4ca9(0xef):_0xdd4ed6=_0x3a4ca9(0x97);break;case'pending':case _0x3a4ca9(0x9e):case _0x3a4ca9(0xb0):case _0x3a4ca9(0xa4):default:_0xdd4ed6='PENDING';break;}return{'paymentId':_0x92b6c1[_0x3a4ca9(0xb2)]||_0x92b6c1[_0x3a4ca9(0x92)]||'','status':_0xdd4ed6,'amount':_0x92b6c1['amount'],'currency':_0x92b6c1[_0x3a4ca9(0xac)]||_0x3a4ca9(0x76)};}}exports[a57_0x287e29(0xdb)]=CoinToPayService;