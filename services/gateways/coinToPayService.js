'use strict';const a43_0x2ffcf6=a43_0x3d60;(function(_0x111457,_0x2dddf1){const _0x598b8b=a43_0x3d60,_0x2d3381=_0x111457();while(!![]){try{const _0x1473dc=-parseInt(_0x598b8b(0x125))/0x1*(-parseInt(_0x598b8b(0xe0))/0x2)+parseInt(_0x598b8b(0xf2))/0x3*(-parseInt(_0x598b8b(0x133))/0x4)+-parseInt(_0x598b8b(0x11e))/0x5*(-parseInt(_0x598b8b(0xf0))/0x6)+-parseInt(_0x598b8b(0xd7))/0x7*(-parseInt(_0x598b8b(0x137))/0x8)+parseInt(_0x598b8b(0x11f))/0x9+parseInt(_0x598b8b(0xef))/0xa*(parseInt(_0x598b8b(0x120))/0xb)+-parseInt(_0x598b8b(0x132))/0xc*(parseInt(_0x598b8b(0x138))/0xd);if(_0x1473dc===_0x2dddf1)break;else _0x2d3381['push'](_0x2d3381['shift']());}catch(_0x12e495){_0x2d3381['push'](_0x2d3381['shift']());}}}(a43_0x1de6,0xc1f54));Object[a43_0x2ffcf6(0xfd)](exports,a43_0x2ffcf6(0x10b),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a43_0x2ffcf6(0x11d));function a43_0x1de6(){const _0x371f17=['toLowerCase','QRCodeURL','Missing\x20data\x20in\x20response','__esModule','Transaction\x20ID:','checkPaymentStatus','PaymentDetail','POST','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','paid','stringify','statusUrl','Amount','Incomplete\x20response:\x20missing\x20data','order_id','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','inputCurrency','üè¶\x20Extracted\x20IBAN:','Status\x20Code:','EXPIRED','TesSoft\x20Payment\x20System/1.0','../loggerService','1274730XIyoqB','7542882rXlKsr','550781WHhFdl','coinAddress','Response\x20Time:','success','HTTP\x20','25773PRDkkE','Status','Error\x20Message:','logWhiteDomainRequest','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20SUCCESS\x20===','EUR','expired','logWhiteDomainResponse','Headers:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','PAID','217572BnmOMd','1469016umUmUC','Raw\x20Response\x20Body:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','headers','2420424xqgboI','533gecHVW','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','TransactionConfirmedOn','payment_url','stack','waiting','JSON\x20Parse\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','cancelled','match','status_code','Created\x20On:','/create','üìä\x20Status\x20check\x20URL:','/status','application/json','error','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Status\x20API\x20Error:\x20','CoinToPay\x20API\x20error:\x20','CoinToPay\x20status\x20API\x20error:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','FAILED','Gateway\x20Payment\x20ID:','Error\x20details:','result','processWebhook','Business\x20Error:\x20','text','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Response\x20Body:','\x20EUR','===\x20COINTOPAY\x20API\x20ERROR\x20===','CreatedOn','status','https://tesoft.uk/gateway/cointopay/status.php','Unknown\x20error\x20from\x20CoinToPay\x20API','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Error\x20stack:','parse','not\x20confirmed','Unknown\x20error','createPaymentLink','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','14HWEeVk','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID',',\x20body:\x20','amount','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','data','Error\x20message:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','74qFiFjy','timeout','logWhiteDomainError','gateway_payment_id','HTTP\x20error!\x20status:\x20','loggerService','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','pending','Result:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Request\x20Body:','Confirmed\x20On:','message','created','üè¶\x20Payment\x20Detail:','20nwhMjD','12UTLnZx','Payment\x20URL:','12MldmYZ','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','awaiting\x20fiat','log','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Parsed\x20Result:','apiUrl','cointopay','https://tesoft.uk/gateway/cointopay/','not\x20found','defineProperty','now','failed','Currency:','URL:','PENDING','currency','Amount:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','HTTP\x20Status:','fromEntries'];a43_0x1de6=function(){return _0x371f17;};return a43_0x1de6();}function a43_0x3d60(_0x286a08,_0x106c64){const _0x1de6b1=a43_0x1de6();return a43_0x3d60=function(_0x3d608b,_0x288133){_0x3d608b=_0x3d608b-0xd4;let _0x3dc77a=_0x1de6b1[_0x3d608b];return _0x3dc77a;},a43_0x3d60(_0x286a08,_0x106c64);}class CoinToPayService{constructor(){const _0x3d6b22=a43_0x2ffcf6;this[_0x3d6b22(0xf9)]=_0x3d6b22(0xfb),this[_0x3d6b22(0x113)]=_0x3d6b22(0x15d),console[_0x3d6b22(0xf5)](_0x3d6b22(0xd6)),console[_0x3d6b22(0xf5)](_0x3d6b22(0x147),this[_0x3d6b22(0x113)]);}async[a43_0x2ffcf6(0xd4)](_0x3f364b){const _0x4ddd28=a43_0x2ffcf6,{orderId:_0x7c9f05,amount:_0x3fdfdb}=_0x3f364b;console[_0x4ddd28(0xf5)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x3fdfdb+_0x4ddd28(0x159));const _0x191b78={'amount':_0x3fdfdb},_0x37c5c5=Date[_0x4ddd28(0xfe)]();try{console[_0x4ddd28(0xf5)](_0x4ddd28(0x130)),console[_0x4ddd28(0xf5)](_0x4ddd28(0x101),this['apiUrl']),console[_0x4ddd28(0xf5)](_0x4ddd28(0xea),JSON[_0x4ddd28(0x112)](_0x191b78,null,0x2)),console[_0x4ddd28(0xf5)]('Amount:',_0x3fdfdb,_0x4ddd28(0xf6)),loggerService_1[_0x4ddd28(0xe5)][_0x4ddd28(0x128)](_0x4ddd28(0xfa),_0x4ddd28(0x146),_0x4ddd28(0x10f),_0x191b78);const _0x238911=await fetch(this['apiUrl'],{'method':_0x4ddd28(0x10f),'headers':{'Content-Type':_0x4ddd28(0x149),'Accept':_0x4ddd28(0x149),'User-Agent':_0x4ddd28(0x11c)},'body':JSON[_0x4ddd28(0x112)](_0x191b78)}),_0x2d0935=Date[_0x4ddd28(0xfe)]()-_0x37c5c5;console[_0x4ddd28(0xf5)](_0x4ddd28(0x157)),console['log']('Status:',_0x238911['status']),console['log']('Status\x20Text:',_0x238911['statusText']),console[_0x4ddd28(0xf5)](_0x4ddd28(0x12f),Object[_0x4ddd28(0x107)](_0x238911[_0x4ddd28(0x136)]['entries']())),console[_0x4ddd28(0xf5)](_0x4ddd28(0x122),_0x2d0935+'ms');const _0x1252b7=await _0x238911['text']();console[_0x4ddd28(0xf5)](_0x4ddd28(0x134),_0x1252b7);if(!_0x238911['ok']){console[_0x4ddd28(0x14a)](_0x4ddd28(0x15a)),console['error'](_0x4ddd28(0x106),_0x238911[_0x4ddd28(0x15c)]),console[_0x4ddd28(0x14a)](_0x4ddd28(0x158),_0x1252b7),loggerService_1['loggerService'][_0x4ddd28(0x12e)](_0x4ddd28(0xfa),'/create',_0x238911['status'],_0x1252b7,_0x2d0935),loggerService_1[_0x4ddd28(0xe5)][_0x4ddd28(0xe2)](_0x4ddd28(0xfa),_0x4ddd28(0x146),_0x4ddd28(0x124)+_0x238911['status']+':\x20'+_0x1252b7);throw new Error(_0x4ddd28(0xe4)+_0x238911[_0x4ddd28(0x15c)]+_0x4ddd28(0xd9)+_0x1252b7);}let _0x3fdd2f;try{_0x3fdd2f=JSON['parse'](_0x1252b7);}catch(_0x10a5a5){console[_0x4ddd28(0x14a)](_0x4ddd28(0x12a),_0x10a5a5),loggerService_1[_0x4ddd28(0xe5)][_0x4ddd28(0xe2)]('cointopay','/create',_0x4ddd28(0x13e)+_0x10a5a5);throw new Error(_0x4ddd28(0x14b)+_0x1252b7);}console['log'](_0x4ddd28(0x140)),console[_0x4ddd28(0xf5)](_0x4ddd28(0xf8),JSON[_0x4ddd28(0x112)](_0x3fdd2f,null,0x2)),loggerService_1[_0x4ddd28(0xe5)][_0x4ddd28(0x12e)]('cointopay','/create',_0x238911[_0x4ddd28(0x15c)],_0x3fdd2f,_0x2d0935);if(_0x3fdd2f['error']){const _0xe90109=_0x3fdd2f[_0x4ddd28(0xec)]||_0x3fdd2f[_0x4ddd28(0x14a)]||_0x4ddd28(0x15e);console[_0x4ddd28(0x14a)](_0x4ddd28(0xe6)),console[_0x4ddd28(0x14a)](_0x4ddd28(0x127),_0xe90109),loggerService_1[_0x4ddd28(0xe5)][_0x4ddd28(0xe2)]('cointopay','/create',_0x4ddd28(0x155)+_0xe90109);throw new Error(_0x4ddd28(0x14d)+_0xe90109);}if(!_0x3fdd2f[_0x4ddd28(0x13b)]||!_0x3fdd2f[_0x4ddd28(0xe3)]){console[_0x4ddd28(0x14a)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4ddd28(0x14a)](_0x4ddd28(0xdb)),console[_0x4ddd28(0x14a)]('Response\x20data:',_0x3fdd2f),loggerService_1[_0x4ddd28(0xe5)][_0x4ddd28(0xe2)](_0x4ddd28(0xfa),_0x4ddd28(0x146),_0x4ddd28(0x141));throw new Error(_0x4ddd28(0xdf));}return console[_0x4ddd28(0xf5)](_0x4ddd28(0x12b)),console[_0x4ddd28(0xf5)](_0x4ddd28(0x151),_0x3fdd2f[_0x4ddd28(0xe3)]),console[_0x4ddd28(0xf5)](_0x4ddd28(0xf1),_0x3fdd2f[_0x4ddd28(0x13b)]),console['log'](_0x4ddd28(0x104),_0x3fdfdb,_0x4ddd28(0x12c)),{'gateway_payment_id':_0x3fdd2f[_0x4ddd28(0xe3)],'payment_url':_0x3fdd2f['payment_url']};}catch(_0x2c770e){console[_0x4ddd28(0x14a)](_0x4ddd28(0x135)),console[_0x4ddd28(0x14a)](_0x4ddd28(0x152),_0x2c770e),loggerService_1[_0x4ddd28(0xe5)][_0x4ddd28(0xe2)]('cointopay',_0x4ddd28(0x146),_0x2c770e);if(_0x2c770e instanceof Error){console[_0x4ddd28(0x14a)](_0x4ddd28(0xde),_0x2c770e[_0x4ddd28(0xec)]),console['error'](_0x4ddd28(0x160),_0x2c770e[_0x4ddd28(0x13c)]);throw new Error(_0x4ddd28(0x15f)+_0x2c770e[_0x4ddd28(0xec)]);}throw new Error(_0x4ddd28(0xe9));}}async[a43_0x2ffcf6(0x10d)](_0x5800d5){const _0x193f3c=a43_0x2ffcf6,_0xa29f48=Date[_0x193f3c(0xfe)]();try{console[_0x193f3c(0xf5)](_0x193f3c(0xf7)+_0x5800d5);const _0x4c90ee={'gatewayPaymentId':_0x5800d5};loggerService_1[_0x193f3c(0xe5)][_0x193f3c(0x128)](_0x193f3c(0xfa),_0x193f3c(0x148),_0x193f3c(0x10f),_0x4c90ee);const _0x2bac45=await fetch(this[_0x193f3c(0x113)],{'method':_0x193f3c(0x10f),'headers':{'Content-Type':'application/json','Accept':_0x193f3c(0x149),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x193f3c(0x112)](_0x4c90ee)}),_0x3b4191=Date['now']()-_0xa29f48;console['log'](_0x193f3c(0x13f)),console['log']('Status:',_0x2bac45[_0x193f3c(0x15c)]),console[_0x193f3c(0xf5)](_0x193f3c(0x122),_0x3b4191+'ms');if(!_0x2bac45['ok']){const _0x472b0b=await _0x2bac45[_0x193f3c(0x156)]();console[_0x193f3c(0x14a)](_0x193f3c(0x106),_0x2bac45[_0x193f3c(0x15c)]),console[_0x193f3c(0x14a)](_0x193f3c(0x158),_0x472b0b),loggerService_1[_0x193f3c(0xe5)][_0x193f3c(0x12e)](_0x193f3c(0xfa),'/status',_0x2bac45['status'],_0x472b0b,_0x3b4191),loggerService_1[_0x193f3c(0xe5)][_0x193f3c(0xe2)]('cointopay',_0x193f3c(0x148),_0x193f3c(0x124)+_0x2bac45[_0x193f3c(0x15c)]+':\x20'+_0x472b0b);throw new Error(_0x193f3c(0xe4)+_0x2bac45[_0x193f3c(0x15c)]);}const _0x4cee97=await _0x2bac45[_0x193f3c(0x156)]();console[_0x193f3c(0xf5)](_0x193f3c(0x134),_0x4cee97);let _0x1d2d57;try{_0x1d2d57=JSON[_0x193f3c(0x161)](_0x4cee97);}catch(_0x1046d4){console[_0x193f3c(0x14a)](_0x193f3c(0x12a),_0x1046d4),loggerService_1[_0x193f3c(0xe5)][_0x193f3c(0xe2)](_0x193f3c(0xfa),'/status',_0x193f3c(0x13e)+_0x1046d4);throw new Error(_0x193f3c(0x129)+_0x4cee97);}loggerService_1[_0x193f3c(0xe5)]['logWhiteDomainResponse']('cointopay',_0x193f3c(0x148),_0x2bac45['status'],_0x1d2d57,_0x3b4191),console[_0x193f3c(0xf5)](_0x193f3c(0xdc)),console['log'](_0x193f3c(0xe8),_0x1d2d57[_0x193f3c(0x153)]),console[_0x193f3c(0xf5)](_0x193f3c(0x11a),_0x1d2d57[_0x193f3c(0x144)]),console[_0x193f3c(0xf5)]('Payment\x20Status:',_0x1d2d57[_0x193f3c(0xdd)]?.[_0x193f3c(0x126)]),console[_0x193f3c(0xf5)](_0x193f3c(0x104),_0x1d2d57[_0x193f3c(0xdd)]?.['Amount']),console[_0x193f3c(0xf5)](_0x193f3c(0x100),_0x1d2d57[_0x193f3c(0xdd)]?.[_0x193f3c(0x118)]);if(_0x1d2d57['result']!==_0x193f3c(0x123)||_0x1d2d57['status_code']!==0xc8){const _0x3de20b=_0x1d2d57[_0x193f3c(0xec)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error'](_0x193f3c(0x110)),console[_0x193f3c(0x14a)]('Error\x20Message:',_0x3de20b),loggerService_1[_0x193f3c(0xe5)]['logWhiteDomainError'](_0x193f3c(0xfa),_0x193f3c(0x148),_0x193f3c(0x14c)+_0x3de20b);throw new Error(_0x193f3c(0x14e)+_0x3de20b);}if(!_0x1d2d57[_0x193f3c(0xdd)]){console[_0x193f3c(0x14a)](_0x193f3c(0xf3)),console[_0x193f3c(0x14a)](_0x193f3c(0x10a)),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x193f3c(0x148),_0x193f3c(0x115));throw new Error(_0x193f3c(0x14f));}let _0x3db1a7=_0x193f3c(0x102);switch(_0x1d2d57[_0x193f3c(0xdd)][_0x193f3c(0x126)]?.[_0x193f3c(0x108)]()){case _0x193f3c(0x111):_0x3db1a7=_0x193f3c(0x131);break;case _0x193f3c(0x142):case _0x193f3c(0xff):case _0x193f3c(0x14a):_0x3db1a7=_0x193f3c(0x150);break;case _0x193f3c(0x12d):case'timeout':_0x3db1a7=_0x193f3c(0x11b);break;case _0x193f3c(0x13d):case _0x193f3c(0xf4):case _0x193f3c(0xe7):case'created':default:_0x3db1a7=_0x193f3c(0x102);break;}let _0x2af449,_0x53182d;if(_0x1d2d57[_0x193f3c(0xdd)][_0x193f3c(0x10e)]){const _0x31f1f7=_0x1d2d57[_0x193f3c(0xdd)][_0x193f3c(0x10e)];console['log'](_0x193f3c(0xee),_0x31f1f7);const _0x27520b=_0x31f1f7[_0x193f3c(0x143)](/IBAN\s+([A-Z0-9]+)/i);_0x27520b&&(_0x2af449=_0x27520b[0x1],console[_0x193f3c(0xf5)](_0x193f3c(0x119),_0x2af449)),_0x53182d=_0x31f1f7;}const _0x22e580={'iban':_0x2af449,'bankDetails':_0x53182d,'transactionId':_0x1d2d57[_0x193f3c(0xdd)]['TransactionID'],'coinAddress':_0x1d2d57[_0x193f3c(0xdd)][_0x193f3c(0x121)],'qrCodeUrl':_0x1d2d57[_0x193f3c(0xdd)][_0x193f3c(0x109)],'expiryTime':_0x1d2d57[_0x193f3c(0xdd)]['ExpiryTime'],'createdOn':_0x1d2d57[_0x193f3c(0xdd)][_0x193f3c(0x15b)],'confirmedOn':_0x1d2d57[_0x193f3c(0xdd)]['TransactionConfirmedOn']};console[_0x193f3c(0xf5)](_0x193f3c(0x117)),console['log']('Status:',_0x1d2d57['data']['Status'],'->',_0x3db1a7),console[_0x193f3c(0xf5)]('Amount:',_0x1d2d57[_0x193f3c(0xdd)][_0x193f3c(0x114)],_0x1d2d57[_0x193f3c(0xdd)][_0x193f3c(0x118)]),console[_0x193f3c(0xf5)](_0x193f3c(0x10c),_0x1d2d57[_0x193f3c(0xdd)]['TransactionID']),console[_0x193f3c(0xf5)]('IBAN:',_0x2af449||_0x193f3c(0xfc)),console[_0x193f3c(0xf5)](_0x193f3c(0x145),_0x1d2d57[_0x193f3c(0xdd)][_0x193f3c(0x15b)]),console[_0x193f3c(0xf5)](_0x193f3c(0xeb),_0x1d2d57[_0x193f3c(0xdd)][_0x193f3c(0x13a)]||_0x193f3c(0x162));if(_0x1d2d57[_0x193f3c(0xdd)][_0x193f3c(0x126)]?.[_0x193f3c(0x108)]()===_0x193f3c(0xf4))console[_0x193f3c(0xf5)](_0x193f3c(0x139));else _0x1d2d57[_0x193f3c(0xdd)][_0x193f3c(0x126)]?.[_0x193f3c(0x108)]()===_0x193f3c(0x111)&&console[_0x193f3c(0xf5)](_0x193f3c(0xd8));return{'status':_0x3db1a7,'amount':parseFloat(_0x1d2d57[_0x193f3c(0xdd)][_0x193f3c(0x114)])||undefined,'currency':_0x1d2d57['data'][_0x193f3c(0x118)]||_0x193f3c(0x12c),'paymentDetails':_0x22e580};}catch(_0x3fbc6c){console[_0x193f3c(0x14a)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x3fbc6c),loggerService_1['loggerService'][_0x193f3c(0xe2)](_0x193f3c(0xfa),_0x193f3c(0x148),_0x3fbc6c);throw new Error(_0x193f3c(0xd5)+(_0x3fbc6c instanceof Error?_0x3fbc6c[_0x193f3c(0xec)]:_0x193f3c(0x163)));}}async['verifyPayment'](_0x1abf6a){const _0x24ec13=a43_0x2ffcf6,_0x55134a=await this[_0x24ec13(0x10d)](_0x1abf6a);return{'status':_0x55134a[_0x24ec13(0x15c)],'amount':_0x55134a[_0x24ec13(0xda)],'currency':_0x55134a[_0x24ec13(0x103)]};}async[a43_0x2ffcf6(0x154)](_0x5a9342){const _0x35e65f=a43_0x2ffcf6;console[_0x35e65f(0xf5)](_0x35e65f(0x105),_0x5a9342);let _0x2b6645=_0x35e65f(0x102);switch(_0x5a9342[_0x35e65f(0x15c)]?.['toLowerCase']()){case _0x35e65f(0x111):_0x2b6645='PAID';break;case'cancelled':case'failed':case _0x35e65f(0x14a):_0x2b6645=_0x35e65f(0x150);break;case'expired':case _0x35e65f(0xe1):_0x2b6645=_0x35e65f(0x11b);break;case _0x35e65f(0xe7):case _0x35e65f(0x13d):case _0x35e65f(0xf4):case _0x35e65f(0xed):default:_0x2b6645=_0x35e65f(0x102);break;}return{'paymentId':_0x5a9342[_0x35e65f(0x116)]||_0x5a9342['merchant_reference_id']||'','status':_0x2b6645,'amount':_0x5a9342[_0x35e65f(0xda)],'currency':_0x5a9342[_0x35e65f(0x103)]||_0x35e65f(0x12c)};}}exports['CoinToPayService']=CoinToPayService;