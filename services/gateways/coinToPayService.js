'use strict';const a40_0x4d8ed5=a40_0x2b35;(function(_0x166225,_0x670ed5){const _0x1eb7b6=a40_0x2b35,_0x4ce5f9=_0x166225();while(!![]){try{const _0x18c8cb=parseInt(_0x1eb7b6(0x10e))/0x1*(-parseInt(_0x1eb7b6(0x11c))/0x2)+parseInt(_0x1eb7b6(0x129))/0x3+-parseInt(_0x1eb7b6(0x13d))/0x4*(-parseInt(_0x1eb7b6(0x106))/0x5)+-parseInt(_0x1eb7b6(0x10a))/0x6+-parseInt(_0x1eb7b6(0x188))/0x7+parseInt(_0x1eb7b6(0x165))/0x8+parseInt(_0x1eb7b6(0x13f))/0x9*(parseInt(_0x1eb7b6(0x126))/0xa);if(_0x18c8cb===_0x670ed5)break;else _0x4ce5f9['push'](_0x4ce5f9['shift']());}catch(_0x20278d){_0x4ce5f9['push'](_0x4ce5f9['shift']());}}}(a40_0xdd75,0xf183a));function a40_0xdd75(){const _0x597e6c=['===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','HTTP\x20Status:','Confirmed\x20On:','Request\x20Body:','3372jowBSe','processWebhook','/status','EXPIRED','PENDING','awaiting\x20fiat','HTTP\x20','Amount','not\x20confirmed','Error\x20stack:','92690IdruOC','gateway_payment_id','match','699873ZXWfSf','Response\x20Time:','cointopay','message','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','CreatedOn','POST','result','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','statusUrl','parse','Payment\x20Status:','Status:','status','now','loggerService','Response\x20data:','CoinToPayService','data','23964BxPoIz','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','1647RiTYgW','status_code','Parsed\x20Result:','payment_url','Payment\x20URL:','Business\x20Error:\x20','FAILED','amount','currency','HTTP\x20error!\x20status:\x20','https://tesoft.uk/gateway/cointopay/status.php','Error\x20message:','merchant_reference_id','Status\x20API\x20Error:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','Result:','Transaction\x20ID:','Amount:','IBAN:','toLowerCase','paid','stack','not\x20found','expired','Status','verifyPayment','log','cancelled','Created\x20On:','Error\x20details:','statusText','CoinToPay\x20API\x20error:\x20','üìä\x20Status\x20check\x20URL:','Missing\x20data\x20in\x20response','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','/create','11170160zZMXiM','failed','entries','PAID','PaymentDetail','success','Unknown\x20error','logWhiteDomainError','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Status\x20Code:','../loggerService','application/json','Error\x20Message:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Failed\x20to\x20parse\x20JSON\x20response:','error','üè¶\x20Payment\x20Detail:','stringify','defineProperty','order_id','coinAddress','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','JSON\x20Parse\x20Error:\x20','pending','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','created','TransactionID','ExpiryTime','üè¶\x20Extracted\x20IBAN:','fromEntries','TesSoft\x20Payment\x20System/1.0','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','10297273NOeJMT','logWhiteDomainResponse','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','465JXTvha','===\x20COINTOPAY\x20SUCCESS\x20===','Response\x20Body:','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','3558948pJsmhK','text','Raw\x20Response\x20Body:','EUR','492sHTzRE','URL:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','apiUrl','createPaymentLink','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','inputCurrency','logWhiteDomainRequest'];a40_0xdd75=function(){return _0x597e6c;};return a40_0xdd75();}Object[a40_0x4d8ed5(0x177)](exports,'__esModule',{'value':!![]}),exports[a40_0x4d8ed5(0x13b)]=void 0x0;function a40_0x2b35(_0x389639,_0x3ae483){const _0xdd757d=a40_0xdd75();return a40_0x2b35=function(_0x2b359a,_0x7c6fa7){_0x2b359a=_0x2b359a-0x104;let _0x102994=_0xdd757d[_0x2b359a];return _0x102994;},a40_0x2b35(_0x389639,_0x3ae483);}const loggerService_1=require(a40_0x4d8ed5(0x16f));class CoinToPayService{constructor(){const _0x49ff43=a40_0x4d8ed5;this[_0x49ff43(0x111)]='https://tesoft.uk/gateway/cointopay/',this['statusUrl']=_0x49ff43(0x149),console[_0x49ff43(0x159)](_0x49ff43(0x12e)),console[_0x49ff43(0x159)](_0x49ff43(0x15f),this[_0x49ff43(0x133)]);}async[a40_0x4d8ed5(0x112)](_0x5b5850){const _0x101c1f=a40_0x4d8ed5,{orderId:_0x4248c5,amount:_0x45662c}=_0x5b5850;console[_0x101c1f(0x159)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x45662c+'\x20EUR');const _0x3d8ed9={'amount':_0x45662c},_0x58e527=Date[_0x101c1f(0x138)]();try{console[_0x101c1f(0x159)](_0x101c1f(0x105)),console['log'](_0x101c1f(0x10f),this['apiUrl']),console[_0x101c1f(0x159)](_0x101c1f(0x11b),JSON[_0x101c1f(0x176)](_0x3d8ed9,null,0x2)),console[_0x101c1f(0x159)](_0x101c1f(0x150),_0x45662c,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x101c1f(0x12b),_0x101c1f(0x164),_0x101c1f(0x130),_0x3d8ed9);const _0x1f504d=await fetch(this['apiUrl'],{'method':_0x101c1f(0x130),'headers':{'Content-Type':'application/json','Accept':_0x101c1f(0x170),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x101c1f(0x176)](_0x3d8ed9)}),_0x34ca01=Date[_0x101c1f(0x138)]()-_0x58e527;console[_0x101c1f(0x159)](_0x101c1f(0x162)),console[_0x101c1f(0x159)](_0x101c1f(0x136),_0x1f504d[_0x101c1f(0x137)]),console[_0x101c1f(0x159)]('Status\x20Text:',_0x1f504d[_0x101c1f(0x15d)]),console['log']('Headers:',Object[_0x101c1f(0x185)](_0x1f504d['headers'][_0x101c1f(0x167)]())),console[_0x101c1f(0x159)](_0x101c1f(0x12a),_0x34ca01+'ms');const _0x55d4cb=await _0x1f504d[_0x101c1f(0x10b)]();console[_0x101c1f(0x159)](_0x101c1f(0x10c),_0x55d4cb);if(!_0x1f504d['ok']){console[_0x101c1f(0x174)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x101c1f(0x174)](_0x101c1f(0x119),_0x1f504d[_0x101c1f(0x137)]),console[_0x101c1f(0x174)](_0x101c1f(0x108),_0x55d4cb),loggerService_1['loggerService'][_0x101c1f(0x104)](_0x101c1f(0x12b),_0x101c1f(0x164),_0x1f504d[_0x101c1f(0x137)],_0x55d4cb,_0x34ca01),loggerService_1[_0x101c1f(0x139)][_0x101c1f(0x16c)](_0x101c1f(0x12b),_0x101c1f(0x164),_0x101c1f(0x122)+_0x1f504d[_0x101c1f(0x137)]+':\x20'+_0x55d4cb);throw new Error(_0x101c1f(0x148)+_0x1f504d[_0x101c1f(0x137)]+',\x20body:\x20'+_0x55d4cb);}let _0xa53341;try{_0xa53341=JSON[_0x101c1f(0x134)](_0x55d4cb);}catch(_0x3adb64){console[_0x101c1f(0x174)](_0x101c1f(0x173),_0x3adb64),loggerService_1[_0x101c1f(0x139)]['logWhiteDomainError'](_0x101c1f(0x12b),_0x101c1f(0x164),_0x101c1f(0x17c)+_0x3adb64);throw new Error(_0x101c1f(0x163)+_0x55d4cb);}console[_0x101c1f(0x159)](_0x101c1f(0x117)),console[_0x101c1f(0x159)](_0x101c1f(0x141),JSON['stringify'](_0xa53341,null,0x2)),loggerService_1[_0x101c1f(0x139)][_0x101c1f(0x104)](_0x101c1f(0x12b),_0x101c1f(0x164),_0x1f504d[_0x101c1f(0x137)],_0xa53341,_0x34ca01);if(_0xa53341[_0x101c1f(0x174)]){const _0x2786c5=_0xa53341[_0x101c1f(0x12c)]||_0xa53341[_0x101c1f(0x174)]||_0x101c1f(0x17b);console[_0x101c1f(0x174)](_0x101c1f(0x17a)),console['error'](_0x101c1f(0x171),_0x2786c5),loggerService_1[_0x101c1f(0x139)][_0x101c1f(0x16c)](_0x101c1f(0x12b),_0x101c1f(0x164),_0x101c1f(0x144)+_0x2786c5);throw new Error(_0x101c1f(0x15e)+_0x2786c5);}if(!_0xa53341[_0x101c1f(0x142)]||!_0xa53341[_0x101c1f(0x127)]){console[_0x101c1f(0x174)](_0x101c1f(0x132)),console[_0x101c1f(0x174)](_0x101c1f(0x114)),console[_0x101c1f(0x174)](_0x101c1f(0x13a),_0xa53341),loggerService_1[_0x101c1f(0x139)][_0x101c1f(0x16c)](_0x101c1f(0x12b),_0x101c1f(0x164),_0x101c1f(0x161));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x101c1f(0x159)](_0x101c1f(0x107)),console[_0x101c1f(0x159)]('Gateway\x20Payment\x20ID:',_0xa53341[_0x101c1f(0x127)]),console['log'](_0x101c1f(0x143),_0xa53341[_0x101c1f(0x142)]),console[_0x101c1f(0x159)](_0x101c1f(0x150),_0x45662c,'EUR'),{'gateway_payment_id':_0xa53341['gateway_payment_id'],'payment_url':_0xa53341['payment_url']};}catch(_0x159ecb){console['error'](_0x101c1f(0x17e)),console[_0x101c1f(0x174)](_0x101c1f(0x15c),_0x159ecb),loggerService_1['loggerService']['logWhiteDomainError'](_0x101c1f(0x12b),_0x101c1f(0x164),_0x159ecb);if(_0x159ecb instanceof Error){console[_0x101c1f(0x174)](_0x101c1f(0x14a),_0x159ecb[_0x101c1f(0x12c)]),console[_0x101c1f(0x174)](_0x101c1f(0x125),_0x159ecb[_0x101c1f(0x154)]);throw new Error(_0x101c1f(0x187)+_0x159ecb[_0x101c1f(0x12c)]);}throw new Error(_0x101c1f(0x12d));}}async['checkPaymentStatus'](_0x48ffbf){const _0x4e98bb=a40_0x4d8ed5,_0x524be6=Date[_0x4e98bb(0x138)]();try{console[_0x4e98bb(0x159)](_0x4e98bb(0x109)+_0x48ffbf);const _0x515103={'gatewayPaymentId':_0x48ffbf};loggerService_1[_0x4e98bb(0x139)][_0x4e98bb(0x116)](_0x4e98bb(0x12b),_0x4e98bb(0x11e),_0x4e98bb(0x130),_0x515103);const _0x3f08d9=await fetch(this['statusUrl'],{'method':_0x4e98bb(0x130),'headers':{'Content-Type':_0x4e98bb(0x170),'Accept':'application/json','User-Agent':_0x4e98bb(0x186)},'body':JSON[_0x4e98bb(0x176)](_0x515103)}),_0x5b7401=Date[_0x4e98bb(0x138)]()-_0x524be6;console[_0x4e98bb(0x159)](_0x4e98bb(0x13e)),console[_0x4e98bb(0x159)](_0x4e98bb(0x136),_0x3f08d9[_0x4e98bb(0x137)]),console['log'](_0x4e98bb(0x12a),_0x5b7401+'ms');if(!_0x3f08d9['ok']){const _0x3ec77b=await _0x3f08d9[_0x4e98bb(0x10b)]();console[_0x4e98bb(0x174)]('HTTP\x20Status:',_0x3f08d9[_0x4e98bb(0x137)]),console[_0x4e98bb(0x174)]('Response\x20Body:',_0x3ec77b),loggerService_1['loggerService'][_0x4e98bb(0x104)](_0x4e98bb(0x12b),'/status',_0x3f08d9[_0x4e98bb(0x137)],_0x3ec77b,_0x5b7401),loggerService_1[_0x4e98bb(0x139)][_0x4e98bb(0x16c)](_0x4e98bb(0x12b),_0x4e98bb(0x11e),_0x4e98bb(0x122)+_0x3f08d9[_0x4e98bb(0x137)]+':\x20'+_0x3ec77b);throw new Error(_0x4e98bb(0x148)+_0x3f08d9[_0x4e98bb(0x137)]);}const _0x3360a5=await _0x3f08d9[_0x4e98bb(0x10b)]();console[_0x4e98bb(0x159)](_0x4e98bb(0x10c),_0x3360a5);let _0x13e84e;try{_0x13e84e=JSON[_0x4e98bb(0x134)](_0x3360a5);}catch(_0x487580){console['error'](_0x4e98bb(0x173),_0x487580),loggerService_1[_0x4e98bb(0x139)][_0x4e98bb(0x16c)](_0x4e98bb(0x12b),_0x4e98bb(0x11e),_0x4e98bb(0x17c)+_0x487580);throw new Error(_0x4e98bb(0x172)+_0x3360a5);}loggerService_1[_0x4e98bb(0x139)]['logWhiteDomainResponse'](_0x4e98bb(0x12b),_0x4e98bb(0x11e),_0x3f08d9['status'],_0x13e84e,_0x5b7401),console[_0x4e98bb(0x159)](_0x4e98bb(0x110)),console[_0x4e98bb(0x159)](_0x4e98bb(0x14e),_0x13e84e[_0x4e98bb(0x131)]),console[_0x4e98bb(0x159)](_0x4e98bb(0x16e),_0x13e84e[_0x4e98bb(0x140)]),console['log'](_0x4e98bb(0x135),_0x13e84e[_0x4e98bb(0x13c)]?.[_0x4e98bb(0x157)]),console['log'](_0x4e98bb(0x150),_0x13e84e[_0x4e98bb(0x13c)]?.['Amount']),console['log']('Currency:',_0x13e84e[_0x4e98bb(0x13c)]?.[_0x4e98bb(0x115)]);if(_0x13e84e['result']!==_0x4e98bb(0x16a)||_0x13e84e[_0x4e98bb(0x140)]!==0xc8){const _0x2b9266=_0x13e84e[_0x4e98bb(0x12c)]||_0x4e98bb(0x17f);console[_0x4e98bb(0x174)](_0x4e98bb(0x180)),console[_0x4e98bb(0x174)](_0x4e98bb(0x171),_0x2b9266),loggerService_1['loggerService']['logWhiteDomainError'](_0x4e98bb(0x12b),_0x4e98bb(0x11e),_0x4e98bb(0x14c)+_0x2b9266);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x2b9266);}if(!_0x13e84e[_0x4e98bb(0x13c)]){console[_0x4e98bb(0x174)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4e98bb(0x174)](_0x4e98bb(0x160)),loggerService_1[_0x4e98bb(0x139)][_0x4e98bb(0x16c)](_0x4e98bb(0x12b),_0x4e98bb(0x11e),'Incomplete\x20response:\x20missing\x20data');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x32c80d='PENDING';switch(_0x13e84e[_0x4e98bb(0x13c)][_0x4e98bb(0x157)]?.[_0x4e98bb(0x152)]()){case'paid':_0x32c80d=_0x4e98bb(0x168);break;case _0x4e98bb(0x15a):case _0x4e98bb(0x166):case'error':_0x32c80d=_0x4e98bb(0x145);break;case _0x4e98bb(0x156):case'timeout':_0x32c80d=_0x4e98bb(0x11f);break;case'waiting':case _0x4e98bb(0x121):case'pending':case _0x4e98bb(0x181):default:_0x32c80d=_0x4e98bb(0x120);break;}let _0x46e811,_0x5e7439;if(_0x13e84e['data'][_0x4e98bb(0x169)]){const _0x2998b9=_0x13e84e['data'][_0x4e98bb(0x169)];console[_0x4e98bb(0x159)](_0x4e98bb(0x175),_0x2998b9);const _0x191f22=_0x2998b9[_0x4e98bb(0x128)](/IBAN\s+([A-Z0-9]+)/i);_0x191f22&&(_0x46e811=_0x191f22[0x1],console[_0x4e98bb(0x159)](_0x4e98bb(0x184),_0x46e811)),_0x5e7439=_0x2998b9;}const _0x8d3a2a={'iban':_0x46e811,'bankDetails':_0x5e7439,'transactionId':_0x13e84e[_0x4e98bb(0x13c)]['TransactionID'],'coinAddress':_0x13e84e[_0x4e98bb(0x13c)][_0x4e98bb(0x179)],'qrCodeUrl':_0x13e84e[_0x4e98bb(0x13c)]['QRCodeURL'],'expiryTime':_0x13e84e[_0x4e98bb(0x13c)][_0x4e98bb(0x183)],'createdOn':_0x13e84e[_0x4e98bb(0x13c)][_0x4e98bb(0x12f)],'confirmedOn':_0x13e84e[_0x4e98bb(0x13c)]['TransactionConfirmedOn']};console[_0x4e98bb(0x159)](_0x4e98bb(0x16d)),console[_0x4e98bb(0x159)](_0x4e98bb(0x136),_0x13e84e[_0x4e98bb(0x13c)][_0x4e98bb(0x157)],'->',_0x32c80d),console[_0x4e98bb(0x159)]('Amount:',_0x13e84e['data'][_0x4e98bb(0x123)],_0x13e84e[_0x4e98bb(0x13c)]['inputCurrency']),console['log'](_0x4e98bb(0x14f),_0x13e84e[_0x4e98bb(0x13c)][_0x4e98bb(0x182)]),console[_0x4e98bb(0x159)](_0x4e98bb(0x151),_0x46e811||_0x4e98bb(0x155)),console[_0x4e98bb(0x159)](_0x4e98bb(0x15b),_0x13e84e[_0x4e98bb(0x13c)][_0x4e98bb(0x12f)]),console[_0x4e98bb(0x159)](_0x4e98bb(0x11a),_0x13e84e[_0x4e98bb(0x13c)]['TransactionConfirmedOn']||_0x4e98bb(0x124));if(_0x13e84e[_0x4e98bb(0x13c)][_0x4e98bb(0x157)]?.[_0x4e98bb(0x152)]()===_0x4e98bb(0x121))console[_0x4e98bb(0x159)](_0x4e98bb(0x113));else _0x13e84e[_0x4e98bb(0x13c)]['Status']?.[_0x4e98bb(0x152)]()==='paid'&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x32c80d,'amount':parseFloat(_0x13e84e[_0x4e98bb(0x13c)]['Amount'])||undefined,'currency':_0x13e84e[_0x4e98bb(0x13c)][_0x4e98bb(0x115)]||_0x4e98bb(0x10d),'paymentDetails':_0x8d3a2a};}catch(_0x3392f1){console['error'](_0x4e98bb(0x14d),_0x3392f1),loggerService_1[_0x4e98bb(0x139)][_0x4e98bb(0x16c)](_0x4e98bb(0x12b),'/status',_0x3392f1);throw new Error(_0x4e98bb(0x118)+(_0x3392f1 instanceof Error?_0x3392f1['message']:_0x4e98bb(0x16b)));}}async[a40_0x4d8ed5(0x158)](_0x10d583){const _0x1509a3=a40_0x4d8ed5,_0x58abb6=await this['checkPaymentStatus'](_0x10d583);return{'status':_0x58abb6[_0x1509a3(0x137)],'amount':_0x58abb6['amount'],'currency':_0x58abb6[_0x1509a3(0x147)]};}async[a40_0x4d8ed5(0x11d)](_0x1e8a2b){const _0x12afca=a40_0x4d8ed5;console[_0x12afca(0x159)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x1e8a2b);let _0x16d2d0=_0x12afca(0x120);switch(_0x1e8a2b[_0x12afca(0x137)]?.['toLowerCase']()){case _0x12afca(0x153):_0x16d2d0=_0x12afca(0x168);break;case _0x12afca(0x15a):case _0x12afca(0x166):case _0x12afca(0x174):_0x16d2d0=_0x12afca(0x145);break;case _0x12afca(0x156):case'timeout':_0x16d2d0='EXPIRED';break;case _0x12afca(0x17d):case'waiting':case _0x12afca(0x121):case _0x12afca(0x181):default:_0x16d2d0=_0x12afca(0x120);break;}return{'paymentId':_0x1e8a2b[_0x12afca(0x178)]||_0x1e8a2b[_0x12afca(0x14b)]||'','status':_0x16d2d0,'amount':_0x1e8a2b[_0x12afca(0x146)],'currency':_0x1e8a2b[_0x12afca(0x147)]||_0x12afca(0x10d)};}}exports['CoinToPayService']=CoinToPayService;