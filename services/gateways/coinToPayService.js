'use strict';function a44_0x2845(_0x4c7d31,_0x546f22){const _0x240c33=a44_0x240c();return a44_0x2845=function(_0x284591,_0x268381){_0x284591=_0x284591-0x168;let _0x34f59d=_0x240c33[_0x284591];return _0x34f59d;},a44_0x2845(_0x4c7d31,_0x546f22);}const a44_0x4256b5=a44_0x2845;(function(_0x261bc8,_0x39319e){const _0x4a4f0a=a44_0x2845,_0x46853f=_0x261bc8();while(!![]){try{const _0x49f07d=parseInt(_0x4a4f0a(0x18f))/0x1*(-parseInt(_0x4a4f0a(0x181))/0x2)+-parseInt(_0x4a4f0a(0x1c4))/0x3*(parseInt(_0x4a4f0a(0x1c0))/0x4)+-parseInt(_0x4a4f0a(0x1c8))/0x5*(-parseInt(_0x4a4f0a(0x1e1))/0x6)+parseInt(_0x4a4f0a(0x1ca))/0x7*(-parseInt(_0x4a4f0a(0x190))/0x8)+parseInt(_0x4a4f0a(0x1de))/0x9+parseInt(_0x4a4f0a(0x1be))/0xa+parseInt(_0x4a4f0a(0x188))/0xb*(parseInt(_0x4a4f0a(0x178))/0xc);if(_0x49f07d===_0x39319e)break;else _0x46853f['push'](_0x46853f['shift']());}catch(_0xd1d400){_0x46853f['push'](_0x46853f['shift']());}}}(a44_0x240c,0x19027));function a44_0x240c(){const _0x10d409=['entries','Status','defineProperty','fromEntries','text','POST','/create','Status:','Status\x20Code:','createPaymentLink','1411070McCfLo','Response\x20Time:','308YIFhsM','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','PAID','Error\x20Message:','2721ZBYkwc','HTTP\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','CreatedOn','30oqazhw','paid','21khQhsk','logWhiteDomainRequest','Response\x20Body:','order_id','inputCurrency','TransactionID','Payment\x20Status:','now','TesSoft\x20Payment\x20System/1.0','ExpiryTime','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','HTTP\x20Status:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','CoinToPayService','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Amount','Error\x20message:','Response\x20data:','loggerService','IBAN:','1087677OrOkXO','apiUrl','amount','193986pstdWK','headers','application/json','CoinToPay\x20payment\x20status\x20check\x20error:','JSON\x20Parse\x20Error:\x20','toLowerCase','__esModule','URL:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','PaymentDetail','PENDING','failed','Error\x20stack:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','coinAddress','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','logWhiteDomainError','Failed\x20to\x20parse\x20JSON\x20response:','EXPIRED','Request\x20Body:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','created','data','pending','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','statusUrl','https://tesoft.uk/gateway/cointopay/status.php','cointopay','36sAmVMp','parse','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','checkPaymentStatus','Payment\x20URL:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','status_code','2UPZXaV','match','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','FAILED','log','expired',',\x20body:\x20','66737RGCiRX','\x20EUR','CoinToPay\x20status\x20API\x20error:\x20','timeout','stringify','Result:','üè¶\x20Payment\x20Detail:','136083lqEDqr','442096rBVYfs','waiting','verifyPayment','currency','gateway_payment_id','Status\x20API\x20Error:\x20','status','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status\x20Text:','EUR','TransactionConfirmedOn','error','processWebhook','cancelled','Parsed\x20Result:','Confirmed\x20On:','logWhiteDomainResponse','Transaction\x20ID:','message','statusText','Raw\x20Response\x20Body:','awaiting\x20fiat','not\x20found','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','merchant_reference_id','/status','Amount:','QRCodeURL','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','not\x20confirmed','===\x20COINTOPAY\x20API\x20ERROR\x20===','üìä\x20Status\x20check\x20URL:','payment_url'];a44_0x240c=function(){return _0x10d409;};return a44_0x240c();}Object[a44_0x4256b5(0x1b6)](exports,a44_0x4256b5(0x1e7),{'value':!![]}),exports[a44_0x4256b5(0x1d7)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x487ad0=a44_0x4256b5;this[_0x487ad0(0x1df)]='https://tesoft.uk/gateway/cointopay/',this[_0x487ad0(0x175)]=_0x487ad0(0x176),console['log']('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x487ad0(0x185)](_0x487ad0(0x1b2),this[_0x487ad0(0x175)]);}async[a44_0x4256b5(0x1bd)](_0x580e82){const _0x3eb43e=a44_0x4256b5,{orderId:_0xc1ccd0,amount:_0x2d9b92}=_0x580e82;console[_0x3eb43e(0x185)](_0x3eb43e(0x1c6)+_0x2d9b92+_0x3eb43e(0x189));const _0x32eed4={'amount':_0x2d9b92},_0x1494ce=Date['now']();try{console[_0x3eb43e(0x185)](_0x3eb43e(0x1a8)),console[_0x3eb43e(0x185)](_0x3eb43e(0x1e8),this['apiUrl']),console[_0x3eb43e(0x185)](_0x3eb43e(0x16f),JSON['stringify'](_0x32eed4,null,0x2)),console[_0x3eb43e(0x185)](_0x3eb43e(0x1ad),_0x2d9b92,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x3eb43e(0x1dc)]['logWhiteDomainRequest'](_0x3eb43e(0x177),'/create',_0x3eb43e(0x1b9),_0x32eed4);const _0x1c6f2b=await fetch(this[_0x3eb43e(0x1df)],{'method':'POST','headers':{'Content-Type':_0x3eb43e(0x1e3),'Accept':_0x3eb43e(0x1e3),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x3eb43e(0x18c)](_0x32eed4)}),_0x2420a0=Date[_0x3eb43e(0x1d1)]()-_0x1494ce;console[_0x3eb43e(0x185)](_0x3eb43e(0x1d6)),console[_0x3eb43e(0x185)](_0x3eb43e(0x1bb),_0x1c6f2b[_0x3eb43e(0x196)]),console[_0x3eb43e(0x185)](_0x3eb43e(0x198),_0x1c6f2b[_0x3eb43e(0x1a3)]),console[_0x3eb43e(0x185)]('Headers:',Object[_0x3eb43e(0x1b7)](_0x1c6f2b[_0x3eb43e(0x1e2)][_0x3eb43e(0x1b4)]())),console['log'](_0x3eb43e(0x1bf),_0x2420a0+'ms');const _0x479aae=await _0x1c6f2b[_0x3eb43e(0x1b8)]();console[_0x3eb43e(0x185)]('Raw\x20Response\x20Body:',_0x479aae);if(!_0x1c6f2b['ok']){console['error'](_0x3eb43e(0x1b1)),console['error'](_0x3eb43e(0x1d5),_0x1c6f2b['status']),console[_0x3eb43e(0x19b)](_0x3eb43e(0x1cc),_0x479aae),loggerService_1[_0x3eb43e(0x1dc)][_0x3eb43e(0x1a0)](_0x3eb43e(0x177),_0x3eb43e(0x1ba),_0x1c6f2b['status'],_0x479aae,_0x2420a0),loggerService_1['loggerService'][_0x3eb43e(0x16c)](_0x3eb43e(0x177),_0x3eb43e(0x1ba),'HTTP\x20'+_0x1c6f2b[_0x3eb43e(0x196)]+':\x20'+_0x479aae);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1c6f2b[_0x3eb43e(0x196)]+_0x3eb43e(0x187)+_0x479aae);}let _0x3457ae;try{_0x3457ae=JSON['parse'](_0x479aae);}catch(_0x457fa2){console[_0x3eb43e(0x19b)](_0x3eb43e(0x16d),_0x457fa2),loggerService_1[_0x3eb43e(0x1dc)][_0x3eb43e(0x16c)](_0x3eb43e(0x177),_0x3eb43e(0x1ba),_0x3eb43e(0x1e5)+_0x457fa2);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x479aae);}console[_0x3eb43e(0x185)](_0x3eb43e(0x170)),console['log'](_0x3eb43e(0x19e),JSON[_0x3eb43e(0x18c)](_0x3457ae,null,0x2)),loggerService_1[_0x3eb43e(0x1dc)][_0x3eb43e(0x1a0)](_0x3eb43e(0x177),'/create',_0x1c6f2b[_0x3eb43e(0x196)],_0x3457ae,_0x2420a0);if(_0x3457ae['error']){const _0x5e67a2=_0x3457ae[_0x3eb43e(0x1a2)]||_0x3457ae[_0x3eb43e(0x19b)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console['error'](_0x3eb43e(0x1aa)),console[_0x3eb43e(0x19b)](_0x3eb43e(0x1c3),_0x5e67a2),loggerService_1['loggerService'][_0x3eb43e(0x16c)](_0x3eb43e(0x177),_0x3eb43e(0x1ba),'Business\x20Error:\x20'+_0x5e67a2);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x5e67a2);}if(!_0x3457ae[_0x3eb43e(0x1b3)]||!_0x3457ae[_0x3eb43e(0x194)]){console[_0x3eb43e(0x19b)](_0x3eb43e(0x17a)),console[_0x3eb43e(0x19b)](_0x3eb43e(0x1c1)),console[_0x3eb43e(0x19b)](_0x3eb43e(0x1db),_0x3457ae),loggerService_1[_0x3eb43e(0x1dc)][_0x3eb43e(0x16c)](_0x3eb43e(0x177),_0x3eb43e(0x1ba),_0x3eb43e(0x1e9));throw new Error(_0x3eb43e(0x17d));}return console[_0x3eb43e(0x185)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x3eb43e(0x185)]('Gateway\x20Payment\x20ID:',_0x3457ae[_0x3eb43e(0x194)]),console[_0x3eb43e(0x185)](_0x3eb43e(0x17c),_0x3457ae[_0x3eb43e(0x1b3)]),console['log'](_0x3eb43e(0x1ad),_0x2d9b92,_0x3eb43e(0x199)),{'gateway_payment_id':_0x3457ae[_0x3eb43e(0x194)],'payment_url':_0x3457ae[_0x3eb43e(0x1b3)]};}catch(_0x63d69e){console[_0x3eb43e(0x19b)](_0x3eb43e(0x169)),console[_0x3eb43e(0x19b)]('Error\x20details:',_0x63d69e),loggerService_1['loggerService'][_0x3eb43e(0x16c)](_0x3eb43e(0x177),_0x3eb43e(0x1ba),_0x63d69e);if(_0x63d69e instanceof Error){console['error'](_0x3eb43e(0x1da),_0x63d69e['message']),console[_0x3eb43e(0x19b)](_0x3eb43e(0x168),_0x63d69e['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x63d69e[_0x3eb43e(0x1a2)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a44_0x4256b5(0x17b)](_0x25649f){const _0x35e613=a44_0x4256b5,_0x5336b2=Date[_0x35e613(0x1d1)]();try{console[_0x35e613(0x185)](_0x35e613(0x1af)+_0x25649f);const _0x2e8b0a={'gatewayPaymentId':_0x25649f};loggerService_1[_0x35e613(0x1dc)][_0x35e613(0x1cb)](_0x35e613(0x177),_0x35e613(0x1ac),_0x35e613(0x1b9),_0x2e8b0a);const _0x488ca5=await fetch(this['statusUrl'],{'method':_0x35e613(0x1b9),'headers':{'Content-Type':_0x35e613(0x1e3),'Accept':_0x35e613(0x1e3),'User-Agent':_0x35e613(0x1d2)},'body':JSON[_0x35e613(0x18c)](_0x2e8b0a)}),_0x48ec11=Date[_0x35e613(0x1d1)]()-_0x5336b2;console['log'](_0x35e613(0x1d8)),console[_0x35e613(0x185)](_0x35e613(0x1bb),_0x488ca5[_0x35e613(0x196)]),console['log']('Response\x20Time:',_0x48ec11+'ms');if(!_0x488ca5['ok']){const _0x2aa236=await _0x488ca5[_0x35e613(0x1b8)]();console['error'](_0x35e613(0x1d5),_0x488ca5['status']),console[_0x35e613(0x19b)](_0x35e613(0x1cc),_0x2aa236),loggerService_1['loggerService'][_0x35e613(0x1a0)]('cointopay',_0x35e613(0x1ac),_0x488ca5[_0x35e613(0x196)],_0x2aa236,_0x48ec11),loggerService_1[_0x35e613(0x1dc)]['logWhiteDomainError'](_0x35e613(0x177),_0x35e613(0x1ac),_0x35e613(0x1c5)+_0x488ca5[_0x35e613(0x196)]+':\x20'+_0x2aa236);throw new Error('HTTP\x20error!\x20status:\x20'+_0x488ca5['status']);}const _0x10479a=await _0x488ca5['text']();console['log'](_0x35e613(0x1a4),_0x10479a);let _0x441f31;try{_0x441f31=JSON[_0x35e613(0x179)](_0x10479a);}catch(_0x598554){console[_0x35e613(0x19b)](_0x35e613(0x16d),_0x598554),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x35e613(0x1ac),_0x35e613(0x1e5)+_0x598554);throw new Error(_0x35e613(0x17f)+_0x10479a);}loggerService_1[_0x35e613(0x1dc)][_0x35e613(0x1a0)](_0x35e613(0x177),'/status',_0x488ca5[_0x35e613(0x196)],_0x441f31,_0x48ec11),console[_0x35e613(0x185)](_0x35e613(0x1a7)),console[_0x35e613(0x185)](_0x35e613(0x18d),_0x441f31['result']),console[_0x35e613(0x185)](_0x35e613(0x1bc),_0x441f31[_0x35e613(0x180)]),console[_0x35e613(0x185)](_0x35e613(0x1d0),_0x441f31[_0x35e613(0x172)]?.[_0x35e613(0x1b5)]),console[_0x35e613(0x185)](_0x35e613(0x1ad),_0x441f31[_0x35e613(0x172)]?.[_0x35e613(0x1d9)]),console[_0x35e613(0x185)]('Currency:',_0x441f31[_0x35e613(0x172)]?.[_0x35e613(0x1ce)]);if(_0x441f31['result']!=='success'||_0x441f31[_0x35e613(0x180)]!==0xc8){const _0x1cf1c1=_0x441f31[_0x35e613(0x1a2)]||_0x35e613(0x183);console[_0x35e613(0x19b)](_0x35e613(0x1d4)),console[_0x35e613(0x19b)](_0x35e613(0x1c3),_0x1cf1c1),loggerService_1[_0x35e613(0x1dc)][_0x35e613(0x16c)](_0x35e613(0x177),_0x35e613(0x1ac),_0x35e613(0x195)+_0x1cf1c1);throw new Error(_0x35e613(0x18a)+_0x1cf1c1);}if(!_0x441f31[_0x35e613(0x172)]){console[_0x35e613(0x19b)](_0x35e613(0x197)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x35e613(0x1dc)][_0x35e613(0x16c)](_0x35e613(0x177),_0x35e613(0x1ac),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x35e613(0x17e));}let _0x962a3=_0x35e613(0x1eb);switch(_0x441f31[_0x35e613(0x172)][_0x35e613(0x1b5)]?.['toLowerCase']()){case _0x35e613(0x1c9):_0x962a3='PAID';break;case _0x35e613(0x19d):case _0x35e613(0x1ec):case _0x35e613(0x19b):_0x962a3=_0x35e613(0x184);break;case'expired':case _0x35e613(0x18b):_0x962a3=_0x35e613(0x16e);break;case _0x35e613(0x191):case _0x35e613(0x1a5):case _0x35e613(0x173):case'created':default:_0x962a3=_0x35e613(0x1eb);break;}let _0x4988a6,_0x19d5aa;if(_0x441f31['data'][_0x35e613(0x1ea)]){const _0x55afdf=_0x441f31['data']['PaymentDetail'];console[_0x35e613(0x185)](_0x35e613(0x18e),_0x55afdf);const _0x18321f=_0x55afdf[_0x35e613(0x182)](/IBAN\s+([A-Z0-9]+)/i);_0x18321f&&(_0x4988a6=_0x18321f[0x1],console[_0x35e613(0x185)]('üè¶\x20Extracted\x20IBAN:',_0x4988a6)),_0x19d5aa=_0x55afdf;}const _0x55df19={'iban':_0x4988a6,'bankDetails':_0x19d5aa,'transactionId':_0x441f31[_0x35e613(0x172)][_0x35e613(0x1cf)],'coinAddress':_0x441f31[_0x35e613(0x172)][_0x35e613(0x16a)],'qrCodeUrl':_0x441f31[_0x35e613(0x172)][_0x35e613(0x1ae)],'expiryTime':_0x441f31[_0x35e613(0x172)][_0x35e613(0x1d3)],'createdOn':_0x441f31[_0x35e613(0x172)][_0x35e613(0x1c7)],'confirmedOn':_0x441f31[_0x35e613(0x172)][_0x35e613(0x19a)]};console['log'](_0x35e613(0x16b)),console[_0x35e613(0x185)]('Status:',_0x441f31['data'][_0x35e613(0x1b5)],'->',_0x962a3),console[_0x35e613(0x185)](_0x35e613(0x1ad),_0x441f31[_0x35e613(0x172)][_0x35e613(0x1d9)],_0x441f31['data']['inputCurrency']),console[_0x35e613(0x185)](_0x35e613(0x1a1),_0x441f31[_0x35e613(0x172)][_0x35e613(0x1cf)]),console[_0x35e613(0x185)](_0x35e613(0x1dd),_0x4988a6||_0x35e613(0x1a6)),console[_0x35e613(0x185)]('Created\x20On:',_0x441f31[_0x35e613(0x172)][_0x35e613(0x1c7)]),console['log'](_0x35e613(0x19f),_0x441f31[_0x35e613(0x172)][_0x35e613(0x19a)]||_0x35e613(0x1b0));if(_0x441f31[_0x35e613(0x172)][_0x35e613(0x1b5)]?.[_0x35e613(0x1e6)]()==='awaiting\x20fiat')console['log'](_0x35e613(0x174));else _0x441f31[_0x35e613(0x172)][_0x35e613(0x1b5)]?.[_0x35e613(0x1e6)]()===_0x35e613(0x1c9)&&console[_0x35e613(0x185)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x962a3,'amount':parseFloat(_0x441f31['data'][_0x35e613(0x1d9)])||undefined,'currency':_0x441f31[_0x35e613(0x172)][_0x35e613(0x1ce)]||_0x35e613(0x199),'paymentDetails':_0x55df19};}catch(_0x2e8b0e){console['error'](_0x35e613(0x1e4),_0x2e8b0e),loggerService_1['loggerService'][_0x35e613(0x16c)](_0x35e613(0x177),_0x35e613(0x1ac),_0x2e8b0e);throw new Error(_0x35e613(0x1a9)+(_0x2e8b0e instanceof Error?_0x2e8b0e[_0x35e613(0x1a2)]:'Unknown\x20error'));}}async[a44_0x4256b5(0x192)](_0x2f66e7){const _0x50dc45=a44_0x4256b5,_0x9beebc=await this['checkPaymentStatus'](_0x2f66e7);return{'status':_0x9beebc[_0x50dc45(0x196)],'amount':_0x9beebc[_0x50dc45(0x1e0)],'currency':_0x9beebc[_0x50dc45(0x193)]};}async[a44_0x4256b5(0x19c)](_0x4bc223){const _0x54f9e0=a44_0x4256b5;console[_0x54f9e0(0x185)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x4bc223);let _0xbf6fc7=_0x54f9e0(0x1eb);switch(_0x4bc223[_0x54f9e0(0x196)]?.[_0x54f9e0(0x1e6)]()){case _0x54f9e0(0x1c9):_0xbf6fc7=_0x54f9e0(0x1c2);break;case _0x54f9e0(0x19d):case _0x54f9e0(0x1ec):case'error':_0xbf6fc7='FAILED';break;case _0x54f9e0(0x186):case _0x54f9e0(0x18b):_0xbf6fc7='EXPIRED';break;case _0x54f9e0(0x173):case _0x54f9e0(0x191):case _0x54f9e0(0x1a5):case _0x54f9e0(0x171):default:_0xbf6fc7=_0x54f9e0(0x1eb);break;}return{'paymentId':_0x4bc223[_0x54f9e0(0x1cd)]||_0x4bc223[_0x54f9e0(0x1ab)]||'','status':_0xbf6fc7,'amount':_0x4bc223[_0x54f9e0(0x1e0)],'currency':_0x4bc223[_0x54f9e0(0x193)]||'EUR'};}}exports[a44_0x4256b5(0x1d7)]=CoinToPayService;