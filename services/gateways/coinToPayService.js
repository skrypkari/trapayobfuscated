'use strict';const a40_0x40981f=a40_0x2b95;(function(_0x1d0f70,_0x6e718b){const _0x2293c5=a40_0x2b95,_0x288bd5=_0x1d0f70();while(!![]){try{const _0x13e1ed=-parseInt(_0x2293c5(0x213))/0x1*(parseInt(_0x2293c5(0x1f9))/0x2)+-parseInt(_0x2293c5(0x209))/0x3*(parseInt(_0x2293c5(0x1cc))/0x4)+parseInt(_0x2293c5(0x21d))/0x5*(-parseInt(_0x2293c5(0x1e5))/0x6)+-parseInt(_0x2293c5(0x203))/0x7*(parseInt(_0x2293c5(0x1ce))/0x8)+parseInt(_0x2293c5(0x1fc))/0x9+parseInt(_0x2293c5(0x20a))/0xa*(-parseInt(_0x2293c5(0x215))/0xb)+parseInt(_0x2293c5(0x1d1))/0xc;if(_0x13e1ed===_0x6e718b)break;else _0x288bd5['push'](_0x288bd5['shift']());}catch(_0x1edbd4){_0x288bd5['push'](_0x288bd5['shift']());}}}(a40_0x48f0,0x4773f));function a40_0x2b95(_0x4ef383,_0x4e2fbd){const _0x48f094=a40_0x48f0();return a40_0x2b95=function(_0x2b955d,_0xfe2d8d){_0x2b955d=_0x2b955d-0x1ab;let _0x3c4013=_0x48f094[_0x2b955d];return _0x3c4013;},a40_0x2b95(_0x4ef383,_0x4e2fbd);}Object['defineProperty'](exports,a40_0x40981f(0x1b7),{'value':!![]}),exports[a40_0x40981f(0x221)]=void 0x0;const loggerService_1=require(a40_0x40981f(0x1d2));class CoinToPayService{constructor(){const _0x5b2111=a40_0x40981f;this[_0x5b2111(0x1ae)]='https://tesoft.uk/gateway/cointopay/',this[_0x5b2111(0x219)]='https://tesoft.uk/gateway/cointopay/status.php',console['log'](_0x5b2111(0x1bb)),console['log']('📊\x20Status\x20check\x20URL:',this[_0x5b2111(0x219)]);}async[a40_0x40981f(0x1e9)](_0x23e608){const _0x26fe76=a40_0x40981f,{orderId:_0x2c61c4,amount:_0x28baa1}=_0x23e608;console['log'](_0x26fe76(0x1ba)+_0x28baa1+_0x26fe76(0x1b2));const _0x6b0b7={'amount':_0x28baa1},_0x356b14=Date['now']();try{console[_0x26fe76(0x1f8)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x26fe76(0x1f8)]('URL:',this[_0x26fe76(0x1ae)]),console[_0x26fe76(0x1f8)](_0x26fe76(0x1c9),JSON['stringify'](_0x6b0b7,null,0x2)),console[_0x26fe76(0x1f8)]('Amount:',_0x28baa1,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x26fe76(0x21b)]['logWhiteDomainRequest']('cointopay',_0x26fe76(0x20b),'POST',_0x6b0b7);const _0x3e2199=await fetch(this['apiUrl'],{'method':_0x26fe76(0x1fd),'headers':{'Content-Type':_0x26fe76(0x1de),'Accept':_0x26fe76(0x1de),'User-Agent':_0x26fe76(0x1d8)},'body':JSON[_0x26fe76(0x1c5)](_0x6b0b7)}),_0x1b0647=Date['now']()-_0x356b14;console['log'](_0x26fe76(0x1e2)),console[_0x26fe76(0x1f8)](_0x26fe76(0x211),_0x3e2199[_0x26fe76(0x1fe)]),console['log'](_0x26fe76(0x1e8),_0x3e2199[_0x26fe76(0x1c4)]),console['log']('Headers:',Object[_0x26fe76(0x1ec)](_0x3e2199[_0x26fe76(0x1db)][_0x26fe76(0x206)]())),console[_0x26fe76(0x1f8)]('Response\x20Time:',_0x1b0647+'ms');const _0x35a434=await _0x3e2199[_0x26fe76(0x229)]();console['log'](_0x26fe76(0x224),_0x35a434);if(!_0x3e2199['ok']){console[_0x26fe76(0x202)](_0x26fe76(0x1f3)),console['error'](_0x26fe76(0x1bf),_0x3e2199[_0x26fe76(0x1fe)]),console[_0x26fe76(0x202)]('Response\x20Body:',_0x35a434),loggerService_1[_0x26fe76(0x21b)][_0x26fe76(0x1c3)](_0x26fe76(0x1ea),_0x26fe76(0x20b),_0x3e2199[_0x26fe76(0x1fe)],_0x35a434,_0x1b0647),loggerService_1['loggerService'][_0x26fe76(0x1ff)]('cointopay','/create',_0x26fe76(0x21e)+_0x3e2199[_0x26fe76(0x1fe)]+':\x20'+_0x35a434);throw new Error(_0x26fe76(0x20e)+_0x3e2199[_0x26fe76(0x1fe)]+_0x26fe76(0x1bd)+_0x35a434);}let _0x308423;try{_0x308423=JSON['parse'](_0x35a434);}catch(_0x3c5469){console[_0x26fe76(0x202)](_0x26fe76(0x1cd),_0x3c5469),loggerService_1[_0x26fe76(0x21b)][_0x26fe76(0x1ff)](_0x26fe76(0x1ea),'/create',_0x26fe76(0x1e4)+_0x3c5469);throw new Error(_0x26fe76(0x1d5)+_0x35a434);}console[_0x26fe76(0x1f8)](_0x26fe76(0x1ad)),console[_0x26fe76(0x1f8)]('Parsed\x20Result:',JSON['stringify'](_0x308423,null,0x2)),loggerService_1[_0x26fe76(0x21b)]['logWhiteDomainResponse'](_0x26fe76(0x1ea),_0x26fe76(0x20b),_0x3e2199[_0x26fe76(0x1fe)],_0x308423,_0x1b0647);if(_0x308423['error']){const _0x4bd253=_0x308423[_0x26fe76(0x1f1)]||_0x308423['error']||_0x26fe76(0x1fa);console[_0x26fe76(0x202)](_0x26fe76(0x20d)),console[_0x26fe76(0x202)](_0x26fe76(0x201),_0x4bd253),loggerService_1['loggerService']['logWhiteDomainError'](_0x26fe76(0x1ea),_0x26fe76(0x20b),_0x26fe76(0x20c)+_0x4bd253);throw new Error(_0x26fe76(0x1dd)+_0x4bd253);}if(!_0x308423[_0x26fe76(0x1c8)]||!_0x308423[_0x26fe76(0x1be)]){console[_0x26fe76(0x202)](_0x26fe76(0x223)),console[_0x26fe76(0x202)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error']('Response\x20data:',_0x308423),loggerService_1[_0x26fe76(0x21b)][_0x26fe76(0x1ff)]('cointopay',_0x26fe76(0x20b),_0x26fe76(0x20f));throw new Error(_0x26fe76(0x218));}return console[_0x26fe76(0x1f8)](_0x26fe76(0x1c2)),console['log'](_0x26fe76(0x228),_0x308423['gateway_payment_id']),console[_0x26fe76(0x1f8)](_0x26fe76(0x1cf),_0x308423[_0x26fe76(0x1c8)]),console[_0x26fe76(0x1f8)]('Amount:',_0x28baa1,'EUR'),{'gateway_payment_id':_0x308423[_0x26fe76(0x1be)],'payment_url':_0x308423[_0x26fe76(0x1c8)]};}catch(_0x2cb935){console['error'](_0x26fe76(0x227)),console[_0x26fe76(0x202)](_0x26fe76(0x1b0),_0x2cb935),loggerService_1[_0x26fe76(0x21b)][_0x26fe76(0x1ff)](_0x26fe76(0x1ea),_0x26fe76(0x20b),_0x2cb935);if(_0x2cb935 instanceof Error){console[_0x26fe76(0x202)]('Error\x20message:',_0x2cb935[_0x26fe76(0x1f1)]),console['error'](_0x26fe76(0x1cb),_0x2cb935[_0x26fe76(0x1ed)]);throw new Error(_0x26fe76(0x1df)+_0x2cb935[_0x26fe76(0x1f1)]);}throw new Error(_0x26fe76(0x217));}}async['checkPaymentStatus'](_0x2897c8){const _0x382ade=a40_0x40981f,_0x88bd03=Date[_0x382ade(0x225)]();try{console[_0x382ade(0x1f8)](_0x382ade(0x21a)+_0x2897c8);const _0x46a1ca={'gatewayPaymentId':_0x2897c8};loggerService_1[_0x382ade(0x21b)][_0x382ade(0x1c1)](_0x382ade(0x1ea),_0x382ade(0x1da),_0x382ade(0x1fd),_0x46a1ca);const _0x1256c6=await fetch(this[_0x382ade(0x219)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x382ade(0x1de),'User-Agent':_0x382ade(0x1d8)},'body':JSON['stringify'](_0x46a1ca)}),_0x5be681=Date[_0x382ade(0x225)]()-_0x88bd03;console[_0x382ade(0x1f8)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x382ade(0x1f8)]('Status:',_0x1256c6[_0x382ade(0x1fe)]),console[_0x382ade(0x1f8)](_0x382ade(0x1f4),_0x5be681+'ms');if(!_0x1256c6['ok']){const _0x1a1016=await _0x1256c6[_0x382ade(0x229)]();console[_0x382ade(0x202)]('HTTP\x20Status:',_0x1256c6['status']),console[_0x382ade(0x202)](_0x382ade(0x1e1),_0x1a1016),loggerService_1['loggerService'][_0x382ade(0x1c3)](_0x382ade(0x1ea),_0x382ade(0x1da),_0x1256c6[_0x382ade(0x1fe)],_0x1a1016,_0x5be681),loggerService_1[_0x382ade(0x21b)][_0x382ade(0x1ff)](_0x382ade(0x1ea),_0x382ade(0x1da),'HTTP\x20'+_0x1256c6[_0x382ade(0x1fe)]+':\x20'+_0x1a1016);throw new Error(_0x382ade(0x20e)+_0x1256c6[_0x382ade(0x1fe)]);}const _0x491e53=await _0x1256c6[_0x382ade(0x229)]();console[_0x382ade(0x1f8)](_0x382ade(0x224),_0x491e53);let _0x283977;try{_0x283977=JSON[_0x382ade(0x1b9)](_0x491e53);}catch(_0x227885){console['error'](_0x382ade(0x1cd),_0x227885),loggerService_1[_0x382ade(0x21b)][_0x382ade(0x1ff)](_0x382ade(0x1ea),_0x382ade(0x1da),'JSON\x20Parse\x20Error:\x20'+_0x227885);throw new Error(_0x382ade(0x210)+_0x491e53);}loggerService_1[_0x382ade(0x21b)]['logWhiteDomainResponse'](_0x382ade(0x1ea),_0x382ade(0x1da),_0x1256c6[_0x382ade(0x1fe)],_0x283977,_0x5be681),console['log'](_0x382ade(0x1ca)),console[_0x382ade(0x1f8)]('Result:',_0x283977['result']),console[_0x382ade(0x1f8)](_0x382ade(0x1eb),_0x283977['status_code']),console[_0x382ade(0x1f8)]('Payment\x20Status:',_0x283977[_0x382ade(0x1bc)]?.['Status']),console['log'](_0x382ade(0x216),_0x283977['data']?.[_0x382ade(0x1c0)]),console[_0x382ade(0x1f8)](_0x382ade(0x1ac),_0x283977[_0x382ade(0x1bc)]?.[_0x382ade(0x1b1)]);if(_0x283977[_0x382ade(0x1e3)]!==_0x382ade(0x1f6)||_0x283977['status_code']!==0xc8){const _0x4326b8=_0x283977['message']||_0x382ade(0x1b4);console[_0x382ade(0x202)](_0x382ade(0x205)),console['error'](_0x382ade(0x201),_0x4326b8),loggerService_1[_0x382ade(0x21b)][_0x382ade(0x1ff)](_0x382ade(0x1ea),_0x382ade(0x1da),'Status\x20API\x20Error:\x20'+_0x4326b8);throw new Error(_0x382ade(0x1e6)+_0x4326b8);}if(!_0x283977[_0x382ade(0x1bc)]){console[_0x382ade(0x202)](_0x382ade(0x1f7)),console[_0x382ade(0x202)](_0x382ade(0x22b)),loggerService_1[_0x382ade(0x21b)][_0x382ade(0x1ff)](_0x382ade(0x1ea),'/status',_0x382ade(0x208));throw new Error(_0x382ade(0x1d9));}let _0x40e7e8=_0x382ade(0x214);switch(_0x283977[_0x382ade(0x1bc)][_0x382ade(0x1f2)]?.[_0x382ade(0x1c6)]()){case _0x382ade(0x1c7):_0x40e7e8=_0x382ade(0x1b8);break;case _0x382ade(0x1d7):case'failed':case _0x382ade(0x202):_0x40e7e8=_0x382ade(0x1e7);break;case _0x382ade(0x1d3):case _0x382ade(0x226):_0x40e7e8=_0x382ade(0x1b6);break;case _0x382ade(0x1af):case _0x382ade(0x220):case _0x382ade(0x1b5):case _0x382ade(0x1ee):default:_0x40e7e8=_0x382ade(0x214);break;}let _0x10d049,_0x52f959;if(_0x283977[_0x382ade(0x1bc)][_0x382ade(0x1ab)]){const _0x424c83=_0x283977[_0x382ade(0x1bc)][_0x382ade(0x1ab)];console[_0x382ade(0x1f8)](_0x382ade(0x1fb),_0x424c83);const _0x261860=_0x424c83['match'](/IBAN\s+([A-Z0-9]+)/i);_0x261860&&(_0x10d049=_0x261860[0x1],console['log']('🏦\x20Extracted\x20IBAN:',_0x10d049)),_0x52f959=_0x424c83;}const _0x291eb6={'iban':_0x10d049,'bankDetails':_0x52f959,'transactionId':_0x283977[_0x382ade(0x1bc)][_0x382ade(0x1d0)],'coinAddress':_0x283977['data'][_0x382ade(0x1f5)],'qrCodeUrl':_0x283977[_0x382ade(0x1bc)][_0x382ade(0x1dc)],'expiryTime':_0x283977[_0x382ade(0x1bc)]['ExpiryTime'],'createdOn':_0x283977['data'][_0x382ade(0x204)],'confirmedOn':_0x283977[_0x382ade(0x1bc)]['TransactionConfirmedOn']};console[_0x382ade(0x1f8)](_0x382ade(0x1d6)),console[_0x382ade(0x1f8)](_0x382ade(0x211),_0x283977[_0x382ade(0x1bc)]['Status'],'->',_0x40e7e8),console[_0x382ade(0x1f8)](_0x382ade(0x216),_0x283977[_0x382ade(0x1bc)][_0x382ade(0x1c0)],_0x283977[_0x382ade(0x1bc)]['inputCurrency']),console[_0x382ade(0x1f8)]('Transaction\x20ID:',_0x283977['data'][_0x382ade(0x1d0)]),console['log']('IBAN:',_0x10d049||_0x382ade(0x1e0)),console[_0x382ade(0x1f8)]('Created\x20On:',_0x283977[_0x382ade(0x1bc)]['CreatedOn']),console[_0x382ade(0x1f8)]('Confirmed\x20On:',_0x283977[_0x382ade(0x1bc)][_0x382ade(0x207)]||_0x382ade(0x1ef));if(_0x283977[_0x382ade(0x1bc)]['Status']?.[_0x382ade(0x1c6)]()===_0x382ade(0x220))console['log'](_0x382ade(0x1b3));else _0x283977[_0x382ade(0x1bc)][_0x382ade(0x1f2)]?.[_0x382ade(0x1c6)]()===_0x382ade(0x1c7)&&console['log']('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x40e7e8,'amount':parseFloat(_0x283977[_0x382ade(0x1bc)]['Amount'])||undefined,'currency':_0x283977[_0x382ade(0x1bc)]['inputCurrency']||'EUR','paymentDetails':_0x291eb6};}catch(_0x3b0918){console[_0x382ade(0x202)](_0x382ade(0x22a),_0x3b0918),loggerService_1[_0x382ade(0x21b)][_0x382ade(0x1ff)](_0x382ade(0x1ea),'/status',_0x3b0918);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x3b0918 instanceof Error?_0x3b0918[_0x382ade(0x1f1)]:_0x382ade(0x222)));}}async[a40_0x40981f(0x1f0)](_0xb86ffb){const _0x5f19fe=a40_0x40981f,_0x44fe79=await this[_0x5f19fe(0x212)](_0xb86ffb);return{'status':_0x44fe79['status'],'amount':_0x44fe79[_0x5f19fe(0x200)],'currency':_0x44fe79['currency']};}async['processWebhook'](_0x210f83){const _0x22217b=a40_0x40981f;console['log'](_0x22217b(0x21f),_0x210f83);let _0x4150ad=_0x22217b(0x214);switch(_0x210f83[_0x22217b(0x1fe)]?.[_0x22217b(0x1c6)]()){case _0x22217b(0x1c7):_0x4150ad=_0x22217b(0x1b8);break;case'cancelled':case'failed':case _0x22217b(0x202):_0x4150ad='FAILED';break;case _0x22217b(0x1d3):case _0x22217b(0x226):_0x4150ad='EXPIRED';break;case _0x22217b(0x1b5):case _0x22217b(0x1af):case'awaiting\x20fiat':case'created':default:_0x4150ad='PENDING';break;}return{'paymentId':_0x210f83[_0x22217b(0x21c)]||_0x210f83['merchant_reference_id']||'','status':_0x4150ad,'amount':_0x210f83['amount'],'currency':_0x210f83[_0x22217b(0x1d4)]||'EUR'};}}function a40_0x48f0(){const _0x36cc70=['createPaymentLink','cointopay','Status\x20Code:','fromEntries','stack','created','not\x20confirmed','verifyPayment','message','Status','===\x20COINTOPAY\x20API\x20ERROR\x20===','Response\x20Time:','coinAddress','success','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','log','2WaFXzp','Unknown\x20error\x20from\x20CoinToPay\x20API','🏦\x20Payment\x20Detail:','1893384HnSnNI','POST','status','logWhiteDomainError','amount','Error\x20Message:','error','1809920lDpcsL','CreatedOn','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','entries','TransactionConfirmedOn','Incomplete\x20response:\x20missing\x20data','3nTljyy','225370SQpeTR','/create','Business\x20Error:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Status:','checkPaymentStatus','126323bQwCTy','PENDING','187mpBryb','Amount:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','statusUrl','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','loggerService','order_id','5FKeEfO','HTTP\x20','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','awaiting\x20fiat','CoinToPayService','Unknown\x20error','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Raw\x20Response\x20Body:','now','timeout','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Gateway\x20Payment\x20ID:','text','CoinToPay\x20payment\x20status\x20check\x20error:','Missing\x20data\x20in\x20response','PaymentDetail','Currency:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','apiUrl','waiting','Error\x20details:','inputCurrency','\x20EUR','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','pending','EXPIRED','__esModule','PAID','parse','🪙\x20Creating\x20CoinToPay\x20payment:\x20','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','data',',\x20body:\x20','gateway_payment_id','HTTP\x20Status:','Amount','logWhiteDomainRequest','===\x20COINTOPAY\x20SUCCESS\x20===','logWhiteDomainResponse','statusText','stringify','toLowerCase','paid','payment_url','Request\x20Body:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Error\x20stack:','577628NQcjwO','Failed\x20to\x20parse\x20JSON\x20response:','16RsasXQ','Payment\x20URL:','TransactionID','19439412NRnFpE','../loggerService','expired','currency','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','cancelled','TesSoft\x20Payment\x20System/1.0','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','/status','headers','QRCodeURL','CoinToPay\x20API\x20error:\x20','application/json','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','not\x20found','Response\x20Body:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','result','JSON\x20Parse\x20Error:\x20','2200062wAztVc','CoinToPay\x20status\x20API\x20error:\x20','FAILED','Status\x20Text:'];a40_0x48f0=function(){return _0x36cc70;};return a40_0x48f0();}exports[a40_0x40981f(0x221)]=CoinToPayService;