'use strict';const a55_0x46131b=a55_0x5b3e;(function(_0x2558ff,_0x325a12){const _0x51310c=a55_0x5b3e,_0x546d2f=_0x2558ff();while(!![]){try{const _0x533942=-parseInt(_0x51310c(0x1df))/0x1*(-parseInt(_0x51310c(0x226))/0x2)+-parseInt(_0x51310c(0x1af))/0x3*(-parseInt(_0x51310c(0x1e6))/0x4)+-parseInt(_0x51310c(0x221))/0x5+-parseInt(_0x51310c(0x1a0))/0x6*(-parseInt(_0x51310c(0x20d))/0x7)+-parseInt(_0x51310c(0x1dd))/0x8+parseInt(_0x51310c(0x218))/0x9+-parseInt(_0x51310c(0x1b5))/0xa*(-parseInt(_0x51310c(0x1d4))/0xb);if(_0x533942===_0x325a12)break;else _0x546d2f['push'](_0x546d2f['shift']());}catch(_0x2694a0){_0x546d2f['push'](_0x546d2f['shift']());}}}(a55_0x7fd3,0x42775));function a55_0x5b3e(_0x239c41,_0x211a73){_0x239c41=_0x239c41-0x1a0;const _0x7fd363=a55_0x7fd3();let _0x5b3eb7=_0x7fd363[_0x239c41];return _0x5b3eb7;}Object[a55_0x46131b(0x213)](exports,a55_0x46131b(0x1cb),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a55_0x46131b(0x1ef));class CoinToPayService{constructor(){const _0x208675=a55_0x46131b;this[_0x208675(0x1cc)]='https://tesoft.uk/gateway/cointopay/',this[_0x208675(0x1c4)]=_0x208675(0x1b3),console[_0x208675(0x212)](_0x208675(0x1b1)),console[_0x208675(0x212)](_0x208675(0x1ca),this[_0x208675(0x1c4)]);}async[a55_0x46131b(0x219)](_0x4701e5){const _0x59e07c=a55_0x46131b,{orderId:_0x1205ad,amount:_0x44ebc3}=_0x4701e5;console[_0x59e07c(0x212)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x44ebc3+_0x59e07c(0x1f4));const _0x358a00={'amount':_0x44ebc3},_0x55e382=Date[_0x59e07c(0x1cd)]();try{console['log'](_0x59e07c(0x1e3)),console[_0x59e07c(0x212)](_0x59e07c(0x1a3),this[_0x59e07c(0x1cc)]),console['log'](_0x59e07c(0x201),JSON['stringify'](_0x358a00,null,0x2)),console[_0x59e07c(0x212)]('Amount:',_0x44ebc3,_0x59e07c(0x1d6)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x59e07c(0x214),_0x59e07c(0x1bc),_0x59e07c(0x20b),_0x358a00);const _0x11dd51=await fetch(this['apiUrl'],{'method':_0x59e07c(0x20b),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x59e07c(0x1bf)},'body':JSON[_0x59e07c(0x1ec)](_0x358a00)}),_0x2d9ed3=Date[_0x59e07c(0x1cd)]()-_0x55e382;console[_0x59e07c(0x212)](_0x59e07c(0x1de)),console[_0x59e07c(0x212)](_0x59e07c(0x1a8),_0x11dd51[_0x59e07c(0x1a9)]),console['log'](_0x59e07c(0x1e7),_0x11dd51[_0x59e07c(0x20e)]),console[_0x59e07c(0x212)](_0x59e07c(0x1c3),Object[_0x59e07c(0x1da)](_0x11dd51[_0x59e07c(0x203)][_0x59e07c(0x1ed)]())),console['log']('Response\x20Time:',_0x2d9ed3+'ms');const _0x4c887d=await _0x11dd51[_0x59e07c(0x1e1)]();console[_0x59e07c(0x212)]('Raw\x20Response\x20Body:',_0x4c887d);if(!_0x11dd51['ok']){console[_0x59e07c(0x1c1)](_0x59e07c(0x224)),console[_0x59e07c(0x1c1)](_0x59e07c(0x1a4),_0x11dd51[_0x59e07c(0x1a9)]),console[_0x59e07c(0x1c1)](_0x59e07c(0x200),_0x4c887d),loggerService_1[_0x59e07c(0x1b4)][_0x59e07c(0x220)](_0x59e07c(0x214),'/create',_0x11dd51[_0x59e07c(0x1a9)],_0x4c887d,_0x2d9ed3),loggerService_1['loggerService'][_0x59e07c(0x20f)]('cointopay',_0x59e07c(0x1bc),_0x59e07c(0x1dc)+_0x11dd51['status']+':\x20'+_0x4c887d);throw new Error('HTTP\x20error!\x20status:\x20'+_0x11dd51[_0x59e07c(0x1a9)]+',\x20body:\x20'+_0x4c887d);}let _0x14db9e;try{_0x14db9e=JSON[_0x59e07c(0x1c6)](_0x4c887d);}catch(_0x4068bb){console[_0x59e07c(0x1c1)](_0x59e07c(0x1f5),_0x4068bb),loggerService_1[_0x59e07c(0x1b4)]['logWhiteDomainError']('cointopay',_0x59e07c(0x1bc),_0x59e07c(0x202)+_0x4068bb);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x4c887d);}console[_0x59e07c(0x212)](_0x59e07c(0x1b7)),console[_0x59e07c(0x212)](_0x59e07c(0x1d0),JSON[_0x59e07c(0x1ec)](_0x14db9e,null,0x2)),loggerService_1['loggerService'][_0x59e07c(0x220)](_0x59e07c(0x214),_0x59e07c(0x1bc),_0x11dd51[_0x59e07c(0x1a9)],_0x14db9e,_0x2d9ed3);if(_0x14db9e[_0x59e07c(0x1c1)]){const _0x595115=_0x14db9e[_0x59e07c(0x207)]||_0x14db9e[_0x59e07c(0x1c1)]||_0x59e07c(0x1d2);console['error'](_0x59e07c(0x1b0)),console['error']('Error\x20Message:',_0x595115),loggerService_1[_0x59e07c(0x1b4)][_0x59e07c(0x20f)](_0x59e07c(0x214),_0x59e07c(0x1bc),_0x59e07c(0x1e0)+_0x595115);throw new Error(_0x59e07c(0x1ff)+_0x595115);}if(!_0x14db9e[_0x59e07c(0x1b2)]||!_0x14db9e[_0x59e07c(0x1fe)]){console[_0x59e07c(0x1c1)](_0x59e07c(0x1a5)),console[_0x59e07c(0x1c1)](_0x59e07c(0x206)),console['error'](_0x59e07c(0x1aa),_0x14db9e),loggerService_1[_0x59e07c(0x1b4)]['logWhiteDomainError']('cointopay',_0x59e07c(0x1bc),_0x59e07c(0x1c7));throw new Error(_0x59e07c(0x204));}console[_0x59e07c(0x212)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x59e07c(0x212)](_0x59e07c(0x1a6),_0x14db9e[_0x59e07c(0x1fe)]),console[_0x59e07c(0x212)](_0x59e07c(0x1e2),_0x14db9e[_0x59e07c(0x1b2)]);const _0x16b736=_0x14db9e[_0x59e07c(0x1b2)]+_0x59e07c(0x1f2);return console[_0x59e07c(0x212)]('Payment\x20URL\x20(modified):',_0x16b736),console[_0x59e07c(0x212)](_0x59e07c(0x1ab),_0x44ebc3,_0x59e07c(0x1ac)),{'gateway_payment_id':_0x14db9e[_0x59e07c(0x1fe)],'payment_url':_0x16b736};}catch(_0x438e77){console[_0x59e07c(0x1c1)](_0x59e07c(0x1fb)),console[_0x59e07c(0x1c1)]('Error\x20details:',_0x438e77),loggerService_1[_0x59e07c(0x1b4)][_0x59e07c(0x20f)](_0x59e07c(0x214),_0x59e07c(0x1bc),_0x438e77);if(_0x438e77 instanceof Error){console[_0x59e07c(0x1c1)](_0x59e07c(0x1e4),_0x438e77['message']),console[_0x59e07c(0x1c1)](_0x59e07c(0x1f3),_0x438e77[_0x59e07c(0x209)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x438e77['message']);}throw new Error(_0x59e07c(0x1d9));}}async[a55_0x46131b(0x1a1)](_0xc87eab){const _0x5ccc79=a55_0x46131b,_0xc3d32e=Date[_0x5ccc79(0x1cd)]();try{console['log'](_0x5ccc79(0x1e5)+_0xc87eab);const _0xb9d226={'gatewayPaymentId':_0xc87eab};loggerService_1[_0x5ccc79(0x1b4)][_0x5ccc79(0x1b6)](_0x5ccc79(0x214),_0x5ccc79(0x1d3),_0x5ccc79(0x20b),_0xb9d226);const _0x2b4d91=await fetch(this[_0x5ccc79(0x1c4)],{'method':_0x5ccc79(0x20b),'headers':{'Content-Type':_0x5ccc79(0x1c5),'Accept':'application/json','User-Agent':_0x5ccc79(0x1bf)},'body':JSON['stringify'](_0xb9d226)}),_0x1032a9=Date[_0x5ccc79(0x1cd)]()-_0xc3d32e;console[_0x5ccc79(0x212)](_0x5ccc79(0x21e)),console[_0x5ccc79(0x212)](_0x5ccc79(0x1a8),_0x2b4d91[_0x5ccc79(0x1a9)]),console[_0x5ccc79(0x212)](_0x5ccc79(0x1e9),_0x1032a9+'ms');if(!_0x2b4d91['ok']){const _0x1012a5=await _0x2b4d91['text']();console[_0x5ccc79(0x1c1)]('HTTP\x20Status:',_0x2b4d91[_0x5ccc79(0x1a9)]),console[_0x5ccc79(0x1c1)]('Response\x20Body:',_0x1012a5),loggerService_1[_0x5ccc79(0x1b4)][_0x5ccc79(0x220)](_0x5ccc79(0x214),'/status',_0x2b4d91[_0x5ccc79(0x1a9)],_0x1012a5,_0x1032a9),loggerService_1[_0x5ccc79(0x1b4)][_0x5ccc79(0x20f)](_0x5ccc79(0x214),_0x5ccc79(0x1d3),_0x5ccc79(0x1dc)+_0x2b4d91[_0x5ccc79(0x1a9)]+':\x20'+_0x1012a5);throw new Error(_0x5ccc79(0x1ba)+_0x2b4d91[_0x5ccc79(0x1a9)]);}const _0x5d27fc=await _0x2b4d91['text']();console['log'](_0x5ccc79(0x210),_0x5d27fc);let _0x2854b0;try{_0x2854b0=JSON[_0x5ccc79(0x1c6)](_0x5d27fc);}catch(_0x3b894a){console[_0x5ccc79(0x1c1)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x3b894a),loggerService_1[_0x5ccc79(0x1b4)][_0x5ccc79(0x20f)](_0x5ccc79(0x214),_0x5ccc79(0x1d3),'JSON\x20Parse\x20Error:\x20'+_0x3b894a);throw new Error(_0x5ccc79(0x21a)+_0x5d27fc);}loggerService_1[_0x5ccc79(0x1b4)]['logWhiteDomainResponse'](_0x5ccc79(0x214),_0x5ccc79(0x1d3),_0x2b4d91[_0x5ccc79(0x1a9)],_0x2854b0,_0x1032a9),console[_0x5ccc79(0x212)](_0x5ccc79(0x1fc)),console[_0x5ccc79(0x212)]('Result:',_0x2854b0['result']),console[_0x5ccc79(0x212)](_0x5ccc79(0x1bb),_0x2854b0['status_code']),console[_0x5ccc79(0x212)]('Payment\x20Status:',_0x2854b0[_0x5ccc79(0x227)]?.[_0x5ccc79(0x1d5)]),console[_0x5ccc79(0x212)](_0x5ccc79(0x1ab),_0x2854b0[_0x5ccc79(0x227)]?.['Amount']),console['log']('Currency:',_0x2854b0[_0x5ccc79(0x227)]?.['inputCurrency']);if(_0x2854b0[_0x5ccc79(0x1fd)]!==_0x5ccc79(0x20c)||_0x2854b0['status_code']!==0xc8){const _0x44c459=_0x2854b0[_0x5ccc79(0x207)]||_0x5ccc79(0x1db);console[_0x5ccc79(0x1c1)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x5ccc79(0x1c1)](_0x5ccc79(0x205),_0x44c459),loggerService_1['loggerService'][_0x5ccc79(0x20f)](_0x5ccc79(0x214),_0x5ccc79(0x1d3),_0x5ccc79(0x21d)+_0x44c459);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x44c459);}if(!_0x2854b0[_0x5ccc79(0x227)]){console[_0x5ccc79(0x1c1)](_0x5ccc79(0x1eb)),console[_0x5ccc79(0x1c1)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x5ccc79(0x1b4)][_0x5ccc79(0x20f)](_0x5ccc79(0x214),_0x5ccc79(0x1d3),_0x5ccc79(0x1bd));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x45dcfb=_0x5ccc79(0x1ee);switch(_0x2854b0[_0x5ccc79(0x227)]['Status']?.['toLowerCase']()){case _0x5ccc79(0x20a):_0x45dcfb=_0x5ccc79(0x1f6);break;case'cancelled':case'failed':case _0x5ccc79(0x1c1):_0x45dcfb='FAILED';break;case _0x5ccc79(0x1f7):case _0x5ccc79(0x1c9):_0x45dcfb=_0x5ccc79(0x208);break;case _0x5ccc79(0x1d8):case _0x5ccc79(0x211):case _0x5ccc79(0x223):case _0x5ccc79(0x1ea):default:_0x45dcfb=_0x5ccc79(0x1ee);break;}let _0x574326,_0x4b5849;if(_0x2854b0[_0x5ccc79(0x227)]['PaymentDetail']){const _0xc560c9=_0x2854b0[_0x5ccc79(0x227)][_0x5ccc79(0x21c)];console['log'](_0x5ccc79(0x1f9),_0xc560c9);const _0x48b13a=_0xc560c9[_0x5ccc79(0x1e8)](/IBAN\s+([A-Z0-9]+)/i);_0x48b13a&&(_0x574326=_0x48b13a[0x1],console[_0x5ccc79(0x212)](_0x5ccc79(0x21b),_0x574326)),_0x4b5849=_0xc560c9;}const _0x4d25ab={'iban':_0x574326,'bankDetails':_0x4b5849,'transactionId':_0x2854b0['data'][_0x5ccc79(0x1ad)],'coinAddress':_0x2854b0[_0x5ccc79(0x227)][_0x5ccc79(0x1c2)],'qrCodeUrl':_0x2854b0[_0x5ccc79(0x227)][_0x5ccc79(0x1f8)],'expiryTime':_0x2854b0[_0x5ccc79(0x227)]['ExpiryTime'],'createdOn':_0x2854b0[_0x5ccc79(0x227)][_0x5ccc79(0x1f1)],'confirmedOn':_0x2854b0[_0x5ccc79(0x227)][_0x5ccc79(0x1ae)]};console['log'](_0x5ccc79(0x21f)),console['log'](_0x5ccc79(0x1a8),_0x2854b0[_0x5ccc79(0x227)][_0x5ccc79(0x1d5)],'->',_0x45dcfb),console[_0x5ccc79(0x212)](_0x5ccc79(0x1ab),_0x2854b0[_0x5ccc79(0x227)][_0x5ccc79(0x1fa)],_0x2854b0[_0x5ccc79(0x227)][_0x5ccc79(0x217)]),console[_0x5ccc79(0x212)](_0x5ccc79(0x1cf),_0x2854b0[_0x5ccc79(0x227)][_0x5ccc79(0x1ad)]),console[_0x5ccc79(0x212)](_0x5ccc79(0x1f0),_0x574326||'not\x20found'),console['log'](_0x5ccc79(0x216),_0x2854b0[_0x5ccc79(0x227)][_0x5ccc79(0x1f1)]),console[_0x5ccc79(0x212)](_0x5ccc79(0x1c0),_0x2854b0['data'][_0x5ccc79(0x1ae)]||_0x5ccc79(0x1ce));if(_0x2854b0[_0x5ccc79(0x227)][_0x5ccc79(0x1d5)]?.[_0x5ccc79(0x222)]()===_0x5ccc79(0x211))console[_0x5ccc79(0x212)](_0x5ccc79(0x1c8));else _0x2854b0[_0x5ccc79(0x227)][_0x5ccc79(0x1d5)]?.[_0x5ccc79(0x222)]()==='paid'&&console[_0x5ccc79(0x212)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x45dcfb,'amount':parseFloat(_0x2854b0['data']['Amount'])||undefined,'currency':_0x2854b0[_0x5ccc79(0x227)][_0x5ccc79(0x217)]||_0x5ccc79(0x1ac),'paymentDetails':_0x4d25ab};}catch(_0x1acff1){console[_0x5ccc79(0x1c1)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x1acff1),loggerService_1[_0x5ccc79(0x1b4)][_0x5ccc79(0x20f)](_0x5ccc79(0x214),_0x5ccc79(0x1d3),_0x1acff1);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x1acff1 instanceof Error?_0x1acff1[_0x5ccc79(0x207)]:_0x5ccc79(0x225)));}}async[a55_0x46131b(0x1d1)](_0x4252dd){const _0x35fc88=a55_0x46131b,_0x43bec0=await this['checkPaymentStatus'](_0x4252dd);return{'status':_0x43bec0[_0x35fc88(0x1a9)],'amount':_0x43bec0[_0x35fc88(0x1b9)],'currency':_0x43bec0[_0x35fc88(0x215)]};}async[a55_0x46131b(0x1a7)](_0x345ee5){const _0x233174=a55_0x46131b;console[_0x233174(0x212)](_0x233174(0x1be),_0x345ee5);let _0x2bf4b5=_0x233174(0x1ee);switch(_0x345ee5[_0x233174(0x1a9)]?.[_0x233174(0x222)]()){case _0x233174(0x20a):_0x2bf4b5='PAID';break;case _0x233174(0x1a2):case'failed':case'error':_0x2bf4b5=_0x233174(0x1d7);break;case _0x233174(0x1f7):case'timeout':_0x2bf4b5='EXPIRED';break;case _0x233174(0x223):case _0x233174(0x1d8):case _0x233174(0x211):case'created':default:_0x2bf4b5='PENDING';break;}return{'paymentId':_0x345ee5[_0x233174(0x1b8)]||_0x345ee5['merchant_reference_id']||'','status':_0x2bf4b5,'amount':_0x345ee5[_0x233174(0x1b9)],'currency':_0x345ee5['currency']||_0x233174(0x1ac)};}}exports['CoinToPayService']=CoinToPayService;function a55_0x7fd3(){const _0x2b612b=['Transaction\x20ID:','Parsed\x20Result:','verifyPayment','Unknown\x20error\x20from\x20CoinToPay\x20API','/status','143935iNcQKY','Status','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','FAILED','waiting','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','fromEntries','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','HTTP\x20','3296768BDhRLR','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','1wJBkUu','Business\x20Error:\x20','text','Payment\x20URL\x20(original):','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Error\x20message:','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','437068puHcRa','Status\x20Text:','match','Response\x20Time:','created','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','stringify','entries','PENDING','../loggerService','IBAN:','CreatedOn','&alternative=false','Error\x20stack:','\x20EUR','Failed\x20to\x20parse\x20JSON\x20response:','PAID','expired','QRCodeURL','üè¶\x20Payment\x20Detail:','Amount','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','result','gateway_payment_id','CoinToPay\x20API\x20error:\x20','Response\x20Body:','Request\x20Body:','JSON\x20Parse\x20Error:\x20','headers','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20Message:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','message','EXPIRED','stack','paid','POST','success','106701vTKuYJ','statusText','logWhiteDomainError','Raw\x20Response\x20Body:','awaiting\x20fiat','log','defineProperty','cointopay','currency','Created\x20On:','inputCurrency','1866762rArOlQ','createPaymentLink','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','üè¶\x20Extracted\x20IBAN:','PaymentDetail','Status\x20API\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','logWhiteDomainResponse','1580785knsoXX','toLowerCase','pending','===\x20COINTOPAY\x20API\x20ERROR\x20===','Unknown\x20error','945138IWBCwl','data','78BRNuve','checkPaymentStatus','cancelled','URL:','HTTP\x20Status:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Gateway\x20Payment\x20ID:','processWebhook','Status:','status','Response\x20data:','Amount:','EUR','TransactionID','TransactionConfirmedOn','3nDePEI','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','payment_url','https://tesoft.uk/gateway/cointopay/status.php','loggerService','10XrzBwm','logWhiteDomainRequest','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','order_id','amount','HTTP\x20error!\x20status:\x20','Status\x20Code:','/create','Incomplete\x20response:\x20missing\x20data','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Payment\x20System/1.0','Confirmed\x20On:','error','coinAddress','Headers:','statusUrl','application/json','parse','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','timeout','üìä\x20Status\x20check\x20URL:','__esModule','apiUrl','now','not\x20confirmed'];a55_0x7fd3=function(){return _0x2b612b;};return a55_0x7fd3();}