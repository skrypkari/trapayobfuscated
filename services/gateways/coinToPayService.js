'use strict';const a49_0x1256e1=a49_0x3d3c;(function(_0x48d1f2,_0x2b6228){const _0x471f01=a49_0x3d3c,_0x3cf7e5=_0x48d1f2();while(!![]){try{const _0x12fd16=parseInt(_0x471f01(0xb6))/0x1+parseInt(_0x471f01(0xd1))/0x2+-parseInt(_0x471f01(0xee))/0x3+parseInt(_0x471f01(0x74))/0x4*(-parseInt(_0x471f01(0xad))/0x5)+parseInt(_0x471f01(0x97))/0x6*(-parseInt(_0x471f01(0xc8))/0x7)+parseInt(_0x471f01(0xbc))/0x8*(-parseInt(_0x471f01(0xf3))/0x9)+parseInt(_0x471f01(0xa6))/0xa;if(_0x12fd16===_0x2b6228)break;else _0x3cf7e5['push'](_0x3cf7e5['shift']());}catch(_0x5e0f46){_0x3cf7e5['push'](_0x3cf7e5['shift']());}}}(a49_0x31fb,0xdc8d2));function a49_0x3d3c(_0x110890,_0x256da7){const _0x31fb6f=a49_0x31fb();return a49_0x3d3c=function(_0x3d3ce9,_0x2ca559){_0x3d3ce9=_0x3d3ce9-0x71;let _0x1ccdd4=_0x31fb6f[_0x3d3ce9];return _0x1ccdd4;},a49_0x3d3c(_0x110890,_0x256da7);}Object[a49_0x1256e1(0xe6)](exports,a49_0x1256e1(0xde),{'value':!![]}),exports[a49_0x1256e1(0x8f)]=void 0x0;const loggerService_1=require(a49_0x1256e1(0x9e));class CoinToPayService{constructor(){const _0x492674=a49_0x1256e1;this['apiUrl']=_0x492674(0xa7),this[_0x492674(0x92)]=_0x492674(0xd9),console[_0x492674(0xe0)](_0x492674(0xb2)),console[_0x492674(0xe0)]('📊\x20Status\x20check\x20URL:',this[_0x492674(0x92)]);}async['createPaymentLink'](_0x25dbc4){const _0x5bece8=a49_0x1256e1,{orderId:_0x1f0749,amount:_0x4c03e3}=_0x25dbc4;console[_0x5bece8(0xe0)]('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x4c03e3+'\x20EUR');const _0x21ea30={'amount':_0x4c03e3},_0x404af5=Date[_0x5bece8(0x93)]();try{console[_0x5bece8(0xe0)](_0x5bece8(0xf5)),console[_0x5bece8(0xe0)](_0x5bece8(0x7a),this[_0x5bece8(0x77)]),console[_0x5bece8(0xe0)](_0x5bece8(0x7e),JSON['stringify'](_0x21ea30,null,0x2)),console[_0x5bece8(0xe0)]('Amount:',_0x4c03e3,_0x5bece8(0x89)),loggerService_1[_0x5bece8(0xdc)][_0x5bece8(0xe2)](_0x5bece8(0xdd),_0x5bece8(0xd4),_0x5bece8(0xd0),_0x21ea30);const _0xf5da32=await fetch(this['apiUrl'],{'method':_0x5bece8(0xd0),'headers':{'Content-Type':_0x5bece8(0x90),'Accept':_0x5bece8(0x90),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x5bece8(0xa9)](_0x21ea30)}),_0x1bb8ac=Date[_0x5bece8(0x93)]()-_0x404af5;console[_0x5bece8(0xe0)](_0x5bece8(0xed)),console['log'](_0x5bece8(0xc4),_0xf5da32[_0x5bece8(0xe8)]),console[_0x5bece8(0xe0)](_0x5bece8(0x94),_0xf5da32[_0x5bece8(0xe4)]),console['log'](_0x5bece8(0x7d),Object[_0x5bece8(0xf6)](_0xf5da32[_0x5bece8(0xf2)][_0x5bece8(0xc3)]())),console[_0x5bece8(0xe0)](_0x5bece8(0xae),_0x1bb8ac+'ms');const _0x5b72eb=await _0xf5da32[_0x5bece8(0xe1)]();console[_0x5bece8(0xe0)](_0x5bece8(0x8c),_0x5b72eb);if(!_0xf5da32['ok']){console['error'](_0x5bece8(0xf0)),console[_0x5bece8(0xbe)](_0x5bece8(0xe7),_0xf5da32[_0x5bece8(0xe8)]),console[_0x5bece8(0xbe)](_0x5bece8(0xc7),_0x5b72eb),loggerService_1[_0x5bece8(0xdc)][_0x5bece8(0xab)](_0x5bece8(0xdd),_0x5bece8(0xd4),_0xf5da32[_0x5bece8(0xe8)],_0x5b72eb,_0x1bb8ac),loggerService_1['loggerService'][_0x5bece8(0x7c)](_0x5bece8(0xdd),'/create',_0x5bece8(0xf4)+_0xf5da32[_0x5bece8(0xe8)]+':\x20'+_0x5b72eb);throw new Error(_0x5bece8(0xb7)+_0xf5da32[_0x5bece8(0xe8)]+',\x20body:\x20'+_0x5b72eb);}let _0x2e7102;try{_0x2e7102=JSON[_0x5bece8(0xb4)](_0x5b72eb);}catch(_0x457a28){console[_0x5bece8(0xbe)](_0x5bece8(0x81),_0x457a28),loggerService_1[_0x5bece8(0xdc)][_0x5bece8(0x7c)](_0x5bece8(0xdd),'/create',_0x5bece8(0x75)+_0x457a28);throw new Error(_0x5bece8(0xa8)+_0x5b72eb);}console['log'](_0x5bece8(0x88)),console[_0x5bece8(0xe0)](_0x5bece8(0xc0),JSON[_0x5bece8(0xa9)](_0x2e7102,null,0x2)),loggerService_1[_0x5bece8(0xdc)][_0x5bece8(0xab)](_0x5bece8(0xdd),'/create',_0xf5da32[_0x5bece8(0xe8)],_0x2e7102,_0x1bb8ac);if(_0x2e7102[_0x5bece8(0xbe)]){const _0x76469b=_0x2e7102[_0x5bece8(0xcf)]||_0x2e7102[_0x5bece8(0xbe)]||_0x5bece8(0xa4);console[_0x5bece8(0xbe)](_0x5bece8(0x9a)),console[_0x5bece8(0xbe)](_0x5bece8(0x71),_0x76469b),loggerService_1[_0x5bece8(0xdc)][_0x5bece8(0x7c)](_0x5bece8(0xdd),_0x5bece8(0xd4),'Business\x20Error:\x20'+_0x76469b);throw new Error(_0x5bece8(0xbd)+_0x76469b);}if(!_0x2e7102[_0x5bece8(0x9d)]||!_0x2e7102[_0x5bece8(0xd3)]){console[_0x5bece8(0xbe)](_0x5bece8(0xaa)),console[_0x5bece8(0xbe)](_0x5bece8(0xd5)),console[_0x5bece8(0xbe)](_0x5bece8(0xaf),_0x2e7102),loggerService_1['loggerService'][_0x5bece8(0x7c)]('cointopay',_0x5bece8(0xd4),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x5bece8(0xa0));}console['log'](_0x5bece8(0xa3)),console[_0x5bece8(0xe0)](_0x5bece8(0xb1),_0x2e7102[_0x5bece8(0xd3)]),console[_0x5bece8(0xe0)]('Payment\x20URL\x20(original):',_0x2e7102[_0x5bece8(0x9d)]);const _0x255417=_0x2e7102[_0x5bece8(0x9d)]+_0x5bece8(0xe9);return console[_0x5bece8(0xe0)](_0x5bece8(0xc5),_0x255417),console['log']('Amount:',_0x4c03e3,_0x5bece8(0xbb)),{'gateway_payment_id':_0x2e7102[_0x5bece8(0xd3)],'payment_url':_0x255417};}catch(_0x381484){console[_0x5bece8(0xbe)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x5bece8(0xbe)](_0x5bece8(0xcb),_0x381484),loggerService_1['loggerService'][_0x5bece8(0x7c)](_0x5bece8(0xdd),_0x5bece8(0xd4),_0x381484);if(_0x381484 instanceof Error){console[_0x5bece8(0xbe)](_0x5bece8(0x83),_0x381484[_0x5bece8(0xcf)]),console['error'](_0x5bece8(0x82),_0x381484[_0x5bece8(0xd8)]);throw new Error(_0x5bece8(0x85)+_0x381484[_0x5bece8(0xcf)]);}throw new Error(_0x5bece8(0xb5));}}async[a49_0x1256e1(0xdf)](_0x1f7307){const _0x597db4=a49_0x1256e1,_0x140c1a=Date['now']();try{console[_0x597db4(0xe0)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x1f7307);const _0x534d53={'gatewayPaymentId':_0x1f7307};loggerService_1[_0x597db4(0xdc)]['logWhiteDomainRequest'](_0x597db4(0xdd),_0x597db4(0xce),'POST',_0x534d53);const _0x22458c=await fetch(this[_0x597db4(0x92)],{'method':_0x597db4(0xd0),'headers':{'Content-Type':_0x597db4(0x90),'Accept':_0x597db4(0x90),'User-Agent':_0x597db4(0x8e)},'body':JSON['stringify'](_0x534d53)}),_0x38f4b5=Date[_0x597db4(0x93)]()-_0x140c1a;console[_0x597db4(0xe0)](_0x597db4(0x95)),console[_0x597db4(0xe0)]('Status:',_0x22458c[_0x597db4(0xe8)]),console[_0x597db4(0xe0)](_0x597db4(0xae),_0x38f4b5+'ms');if(!_0x22458c['ok']){const _0x12e1ff=await _0x22458c[_0x597db4(0xe1)]();console[_0x597db4(0xbe)]('HTTP\x20Status:',_0x22458c[_0x597db4(0xe8)]),console[_0x597db4(0xbe)](_0x597db4(0xc7),_0x12e1ff),loggerService_1['loggerService'][_0x597db4(0xab)]('cointopay',_0x597db4(0xce),_0x22458c[_0x597db4(0xe8)],_0x12e1ff,_0x38f4b5),loggerService_1[_0x597db4(0xdc)][_0x597db4(0x7c)](_0x597db4(0xdd),'/status','HTTP\x20'+_0x22458c[_0x597db4(0xe8)]+':\x20'+_0x12e1ff);throw new Error(_0x597db4(0xb7)+_0x22458c[_0x597db4(0xe8)]);}const _0x55c9ae=await _0x22458c[_0x597db4(0xe1)]();console['log'](_0x597db4(0x8c),_0x55c9ae);let _0x243a34;try{_0x243a34=JSON[_0x597db4(0xb4)](_0x55c9ae);}catch(_0x2e0868){console[_0x597db4(0xbe)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x2e0868),loggerService_1['loggerService'][_0x597db4(0x7c)]('cointopay',_0x597db4(0xce),'JSON\x20Parse\x20Error:\x20'+_0x2e0868);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x55c9ae);}loggerService_1[_0x597db4(0xdc)][_0x597db4(0xab)](_0x597db4(0xdd),_0x597db4(0xce),_0x22458c[_0x597db4(0xe8)],_0x243a34,_0x38f4b5),console[_0x597db4(0xe0)](_0x597db4(0x8b)),console[_0x597db4(0xe0)](_0x597db4(0x84),_0x243a34[_0x597db4(0xeb)]),console[_0x597db4(0xe0)](_0x597db4(0xdb),_0x243a34[_0x597db4(0x80)]),console[_0x597db4(0xe0)](_0x597db4(0xca),_0x243a34[_0x597db4(0xda)]?.['Status']),console[_0x597db4(0xe0)]('Amount:',_0x243a34[_0x597db4(0xda)]?.[_0x597db4(0xd6)]),console[_0x597db4(0xe0)](_0x597db4(0xd2),_0x243a34[_0x597db4(0xda)]?.[_0x597db4(0xcd)]);if(_0x243a34['result']!=='success'||_0x243a34[_0x597db4(0x80)]!==0xc8){const _0x508228=_0x243a34[_0x597db4(0xcf)]||_0x597db4(0xf7);console['error'](_0x597db4(0x7f)),console[_0x597db4(0xbe)](_0x597db4(0x71),_0x508228),loggerService_1[_0x597db4(0xdc)][_0x597db4(0x7c)](_0x597db4(0xdd),_0x597db4(0xce),_0x597db4(0x9b)+_0x508228);throw new Error(_0x597db4(0x96)+_0x508228);}if(!_0x243a34[_0x597db4(0xda)]){console[_0x597db4(0xbe)](_0x597db4(0xe3)),console[_0x597db4(0xbe)](_0x597db4(0x99)),loggerService_1[_0x597db4(0xdc)][_0x597db4(0x7c)]('cointopay',_0x597db4(0xce),_0x597db4(0x9f));throw new Error(_0x597db4(0xef));}let _0x45ddb4=_0x597db4(0x78);switch(_0x243a34[_0x597db4(0xda)]['Status']?.[_0x597db4(0x73)]()){case _0x597db4(0xd7):_0x45ddb4=_0x597db4(0xf1);break;case _0x597db4(0xc1):case _0x597db4(0xcc):case _0x597db4(0xbe):_0x45ddb4=_0x597db4(0xec);break;case _0x597db4(0xb3):case _0x597db4(0xa2):_0x45ddb4=_0x597db4(0xba);break;case _0x597db4(0xe5):case _0x597db4(0x9c):case _0x597db4(0xa5):case _0x597db4(0xea):default:_0x45ddb4=_0x597db4(0x78);break;}let _0x58c647,_0x3ed77f;if(_0x243a34[_0x597db4(0xda)]['PaymentDetail']){const _0x161b43=_0x243a34['data'][_0x597db4(0x86)];console[_0x597db4(0xe0)](_0x597db4(0x7b),_0x161b43);const _0x649ab8=_0x161b43[_0x597db4(0x72)](/IBAN\s+([A-Z0-9]+)/i);_0x649ab8&&(_0x58c647=_0x649ab8[0x1],console[_0x597db4(0xe0)](_0x597db4(0x8d),_0x58c647)),_0x3ed77f=_0x161b43;}const _0x39261c={'iban':_0x58c647,'bankDetails':_0x3ed77f,'transactionId':_0x243a34[_0x597db4(0xda)][_0x597db4(0xc2)],'coinAddress':_0x243a34[_0x597db4(0xda)][_0x597db4(0xb8)],'qrCodeUrl':_0x243a34[_0x597db4(0xda)]['QRCodeURL'],'expiryTime':_0x243a34[_0x597db4(0xda)][_0x597db4(0x98)],'createdOn':_0x243a34[_0x597db4(0xda)]['CreatedOn'],'confirmedOn':_0x243a34[_0x597db4(0xda)][_0x597db4(0xac)]};console[_0x597db4(0xe0)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x597db4(0xe0)]('Status:',_0x243a34[_0x597db4(0xda)][_0x597db4(0xb0)],'->',_0x45ddb4),console['log']('Amount:',_0x243a34[_0x597db4(0xda)][_0x597db4(0xd6)],_0x243a34[_0x597db4(0xda)][_0x597db4(0xcd)]),console['log'](_0x597db4(0xa1),_0x243a34['data'][_0x597db4(0xc2)]),console[_0x597db4(0xe0)](_0x597db4(0x87),_0x58c647||_0x597db4(0x8a)),console[_0x597db4(0xe0)](_0x597db4(0xc6),_0x243a34[_0x597db4(0xda)]['CreatedOn']),console[_0x597db4(0xe0)]('Confirmed\x20On:',_0x243a34['data'][_0x597db4(0xac)]||'not\x20confirmed');if(_0x243a34[_0x597db4(0xda)]['Status']?.['toLowerCase']()===_0x597db4(0x9c))console[_0x597db4(0xe0)]('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x243a34[_0x597db4(0xda)][_0x597db4(0xb0)]?.[_0x597db4(0x73)]()===_0x597db4(0xd7)&&console[_0x597db4(0xe0)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x45ddb4,'amount':parseFloat(_0x243a34[_0x597db4(0xda)]['Amount'])||undefined,'currency':_0x243a34[_0x597db4(0xda)][_0x597db4(0xcd)]||_0x597db4(0xbb),'paymentDetails':_0x39261c};}catch(_0x43a44c){console[_0x597db4(0xbe)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x43a44c),loggerService_1['loggerService']['logWhiteDomainError'](_0x597db4(0xdd),'/status',_0x43a44c);throw new Error(_0x597db4(0xb9)+(_0x43a44c instanceof Error?_0x43a44c[_0x597db4(0xcf)]:'Unknown\x20error'));}}async['verifyPayment'](_0x776c6b){const _0xfffa6d=a49_0x1256e1,_0x4f673b=await this[_0xfffa6d(0xdf)](_0x776c6b);return{'status':_0x4f673b[_0xfffa6d(0xe8)],'amount':_0x4f673b[_0xfffa6d(0xbf)],'currency':_0x4f673b[_0xfffa6d(0x76)]};}async[a49_0x1256e1(0x91)](_0x4af3dc){const _0x3a3ff7=a49_0x1256e1;console[_0x3a3ff7(0xe0)](_0x3a3ff7(0xc9),_0x4af3dc);let _0x3b252f='PENDING';switch(_0x4af3dc[_0x3a3ff7(0xe8)]?.[_0x3a3ff7(0x73)]()){case _0x3a3ff7(0xd7):_0x3b252f=_0x3a3ff7(0xf1);break;case'cancelled':case'failed':case'error':_0x3b252f=_0x3a3ff7(0xec);break;case _0x3a3ff7(0xb3):case _0x3a3ff7(0xa2):_0x3b252f=_0x3a3ff7(0xba);break;case _0x3a3ff7(0xa5):case'waiting':case'awaiting\x20fiat':case'created':default:_0x3b252f=_0x3a3ff7(0x78);break;}return{'paymentId':_0x4af3dc['order_id']||_0x4af3dc[_0x3a3ff7(0x79)]||'','status':_0x3b252f,'amount':_0x4af3dc[_0x3a3ff7(0xbf)],'currency':_0x4af3dc[_0x3a3ff7(0x76)]||'EUR'};}}function a49_0x31fb(){const _0xb0c6c=['TransactionID','entries','Status:','Payment\x20URL\x20(modified):','Created\x20On:','Response\x20Body:','3654707pVRObA','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Payment\x20Status:','Error\x20details:','failed','inputCurrency','/status','message','POST','438986tdjeba','Currency:','gateway_payment_id','/create','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Amount','paid','stack','https://tesoft.uk/gateway/cointopay/status.php','data','Status\x20Code:','loggerService','cointopay','__esModule','checkPaymentStatus','log','text','logWhiteDomainRequest','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','statusText','waiting','defineProperty','HTTP\x20Status:','status','&alternative=false','created','result','FAILED','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','2933973Cqvpht','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','===\x20COINTOPAY\x20API\x20ERROR\x20===','PAID','headers','18JQHVcd','HTTP\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','fromEntries','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Error\x20Message:','match','toLowerCase','121868XdMSvO','JSON\x20Parse\x20Error:\x20','currency','apiUrl','PENDING','merchant_reference_id','URL:','🏦\x20Payment\x20Detail:','logWhiteDomainError','Headers:','Request\x20Body:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','status_code','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20stack:','Error\x20message:','Result:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','PaymentDetail','IBAN:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','not\x20found','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Raw\x20Response\x20Body:','🏦\x20Extracted\x20IBAN:','Payment\x20System/1.0','CoinToPayService','application/json','processWebhook','statusUrl','now','Status\x20Text:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','CoinToPay\x20status\x20API\x20error:\x20','18XtcUiR','ExpiryTime','Missing\x20data\x20in\x20response','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Status\x20API\x20Error:\x20','awaiting\x20fiat','payment_url','../loggerService','Incomplete\x20response:\x20missing\x20data','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Transaction\x20ID:','timeout','===\x20COINTOPAY\x20SUCCESS\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','pending','37107930RRZyBY','https://tesoft.uk/gateway/cointopay/','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','stringify','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainResponse','TransactionConfirmedOn','5dqygig','Response\x20Time:','Response\x20data:','Status','Gateway\x20Payment\x20ID:','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','expired','parse','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','765515XMJVaJ','HTTP\x20error!\x20status:\x20','coinAddress','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','EXPIRED','EUR','4870648osSlms','CoinToPay\x20API\x20error:\x20','error','amount','Parsed\x20Result:','cancelled'];a49_0x31fb=function(){return _0xb0c6c;};return a49_0x31fb();}exports['CoinToPayService']=CoinToPayService;