'use strict';function a38_0xb9c9(_0x2c29e7,_0x4e45c7){const _0x2bc3cd=a38_0x2bc3();return a38_0xb9c9=function(_0xb9c9e4,_0x524d1d){_0xb9c9e4=_0xb9c9e4-0xd1;let _0x20141b=_0x2bc3cd[_0xb9c9e4];return _0x20141b;},a38_0xb9c9(_0x2c29e7,_0x4e45c7);}const a38_0x6b0dc=a38_0xb9c9;(function(_0x105329,_0x2e8fdc){const _0x38d082=a38_0xb9c9,_0x13ebad=_0x105329();while(!![]){try{const _0x3432f5=-parseInt(_0x38d082(0x115))/0x1+-parseInt(_0x38d082(0xe6))/0x2+-parseInt(_0x38d082(0x114))/0x3+-parseInt(_0x38d082(0xd3))/0x4*(-parseInt(_0x38d082(0x12e))/0x5)+parseInt(_0x38d082(0x13e))/0x6+parseInt(_0x38d082(0xf9))/0x7*(parseInt(_0x38d082(0x152))/0x8)+parseInt(_0x38d082(0x121))/0x9*(parseInt(_0x38d082(0x14f))/0xa);if(_0x3432f5===_0x2e8fdc)break;else _0x13ebad['push'](_0x13ebad['shift']());}catch(_0x444552){_0x13ebad['push'](_0x13ebad['shift']());}}}(a38_0x2bc3,0x7721f));Object[a38_0x6b0dc(0x107)](exports,'__esModule',{'value':!![]}),exports['CoinToPayService']=void 0x0;function a38_0x2bc3(){const _0x200149=['created','CoinToPay\x20status\x20API\x20error:\x20','Confirmed\x20On:','message','cointopay','URL:','QRCodeURL','coinAddress','üè¶\x20Extracted\x20IBAN:','POST','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','application/json','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','TransactionID','Error\x20Message:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','14GLnUtW','Status\x20Code:','fromEntries','Failed\x20to\x20parse\x20JSON\x20response:','cancelled','EXPIRED','payment_url','loggerService','entries','Status\x20Text:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','result','Transaction\x20ID:','logWhiteDomainError','defineProperty','Amount:','/status','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Response\x20Body:','CoinToPayService','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','FAILED','Headers:',',\x20body:\x20','EUR','https://tesoft.uk/gateway/cointopay/status.php','Payment\x20Status:','1784574fJkHpZ','682511otMebD','Business\x20Error:\x20','HTTP\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','processWebhook','Amount','Error\x20details:','match','expired','failed','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','5210190eboVNb','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','inputCurrency','waiting','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','not\x20confirmed','\x20EUR','CoinToPay\x20payment\x20status\x20check\x20error:','status','Unknown\x20error','statusUrl','Incomplete\x20response:\x20missing\x20data','Status:','19105icCRKi','headers','PENDING','merchant_reference_id','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','logWhiteDomainRequest','ExpiryTime','JSON\x20Parse\x20Error:\x20','üìä\x20Status\x20check\x20URL:','apiUrl','statusText','PAID','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','parse','stack','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','2002716WZtjwG','log','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Response\x20data:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','IBAN:','Result:','PaymentDetail','logWhiteDomainResponse','now','Created\x20On:','Status','Response\x20Time:','checkPaymentStatus','HTTP\x20error!\x20status:\x20','Payment\x20URL:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','20FMhYpK','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','status_code','1874960yuXRcp','stringify','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','paid','awaiting\x20fiat','text','data','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Parsed\x20Result:','pending','124CJxZkm','Gateway\x20Payment\x20ID:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','error','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Unknown\x20error\x20from\x20CoinToPay\x20API','Missing\x20data\x20in\x20response','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','toLowerCase','TesSoft\x20Payment\x20System/1.0','https://tesoft.uk/gateway/cointopay/','/create','timeout','HTTP\x20Status:','createPaymentLink','CoinToPay\x20API\x20error:\x20','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','amount','626922WtiiTe','../loggerService','===\x20COINTOPAY\x20SUCCESS\x20==='];a38_0x2bc3=function(){return _0x200149;};return a38_0x2bc3();}const loggerService_1=require(a38_0x6b0dc(0xe7));class CoinToPayService{constructor(){const _0x82894f=a38_0x6b0dc;this[_0x82894f(0x137)]=_0x82894f(0xdd),this[_0x82894f(0x12b)]=_0x82894f(0x112),console[_0x82894f(0x13f)](_0x82894f(0xda)),console[_0x82894f(0x13f)](_0x82894f(0x136),this['statusUrl']);}async[a38_0x6b0dc(0xe1)](_0xd3b3bc){const _0x13def3=a38_0x6b0dc,{orderId:_0x2ce072,amount:_0x2dfc17}=_0xd3b3bc;console[_0x13def3(0x13f)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x2dfc17+_0x13def3(0x127));const _0x5e712c={'amount':_0x2dfc17},_0x1955bd=Date[_0x13def3(0x147)]();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x13def3(0x13f)](_0x13def3(0xee),this[_0x13def3(0x137)]),console['log']('Request\x20Body:',JSON[_0x13def3(0x153)](_0x5e712c,null,0x2)),console[_0x13def3(0x13f)](_0x13def3(0x108),_0x2dfc17,_0x13def3(0xe4)),loggerService_1[_0x13def3(0x100)][_0x13def3(0x133)]('cointopay',_0x13def3(0xde),_0x13def3(0xf2),_0x5e712c);const _0x10930f=await fetch(this[_0x13def3(0x137)],{'method':_0x13def3(0xf2),'headers':{'Content-Type':_0x13def3(0xf4),'Accept':'application/json','User-Agent':_0x13def3(0xdc)},'body':JSON['stringify'](_0x5e712c)}),_0x402e83=Date[_0x13def3(0x147)]()-_0x1955bd;console[_0x13def3(0x13f)](_0x13def3(0x120)),console[_0x13def3(0x13f)](_0x13def3(0x12d),_0x10930f['status']),console[_0x13def3(0x13f)](_0x13def3(0x102),_0x10930f[_0x13def3(0x138)]),console[_0x13def3(0x13f)](_0x13def3(0x10f),Object[_0x13def3(0xfb)](_0x10930f[_0x13def3(0x12f)][_0x13def3(0x101)]())),console[_0x13def3(0x13f)](_0x13def3(0x14a),_0x402e83+'ms');const _0x36a304=await _0x10930f[_0x13def3(0x157)]();console[_0x13def3(0x13f)]('Raw\x20Response\x20Body:',_0x36a304);if(!_0x10930f['ok']){console[_0x13def3(0xd6)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x13def3(0xd6)](_0x13def3(0xe0),_0x10930f[_0x13def3(0x129)]),console[_0x13def3(0xd6)](_0x13def3(0x10b),_0x36a304),loggerService_1[_0x13def3(0x100)][_0x13def3(0x146)]('cointopay',_0x13def3(0xde),_0x10930f[_0x13def3(0x129)],_0x36a304,_0x402e83),loggerService_1[_0x13def3(0x100)][_0x13def3(0x106)](_0x13def3(0xed),_0x13def3(0xde),_0x13def3(0x117)+_0x10930f[_0x13def3(0x129)]+':\x20'+_0x36a304);throw new Error(_0x13def3(0x14c)+_0x10930f[_0x13def3(0x129)]+_0x13def3(0x110)+_0x36a304);}let _0x4551c1;try{_0x4551c1=JSON['parse'](_0x36a304);}catch(_0x321f36){console[_0x13def3(0xd6)](_0x13def3(0xfc),_0x321f36),loggerService_1['loggerService'][_0x13def3(0x106)]('cointopay',_0x13def3(0xde),'JSON\x20Parse\x20Error:\x20'+_0x321f36);throw new Error(_0x13def3(0x122)+_0x36a304);}console[_0x13def3(0x13f)](_0x13def3(0x13d)),console[_0x13def3(0x13f)](_0x13def3(0xd1),JSON[_0x13def3(0x153)](_0x4551c1,null,0x2)),loggerService_1[_0x13def3(0x100)][_0x13def3(0x146)](_0x13def3(0xed),_0x13def3(0xde),_0x10930f[_0x13def3(0x129)],_0x4551c1,_0x402e83);if(_0x4551c1[_0x13def3(0xd6)]){const _0x1c5015=_0x4551c1[_0x13def3(0xec)]||_0x4551c1[_0x13def3(0xd6)]||_0x13def3(0xd8);console[_0x13def3(0xd6)](_0x13def3(0x125)),console['error'](_0x13def3(0xf7),_0x1c5015),loggerService_1['loggerService'][_0x13def3(0x106)](_0x13def3(0xed),_0x13def3(0xde),_0x13def3(0x116)+_0x1c5015);throw new Error(_0x13def3(0xe2)+_0x1c5015);}if(!_0x4551c1[_0x13def3(0xff)]||!_0x4551c1['gateway_payment_id']){console[_0x13def3(0xd6)](_0x13def3(0x10d)),console[_0x13def3(0xd6)](_0x13def3(0xf3)),console[_0x13def3(0xd6)](_0x13def3(0x141),_0x4551c1),loggerService_1[_0x13def3(0x100)]['logWhiteDomainError'](_0x13def3(0xed),_0x13def3(0xde),_0x13def3(0xf8));throw new Error(_0x13def3(0xf5));}return console[_0x13def3(0x13f)](_0x13def3(0xe8)),console['log'](_0x13def3(0xd4),_0x4551c1['gateway_payment_id']),console[_0x13def3(0x13f)](_0x13def3(0x14d),_0x4551c1['payment_url']),console['log'](_0x13def3(0x108),_0x2dfc17,_0x13def3(0x111)),{'gateway_payment_id':_0x4551c1['gateway_payment_id'],'payment_url':_0x4551c1[_0x13def3(0xff)]};}catch(_0x533daf){console[_0x13def3(0xd6)](_0x13def3(0x14e)),console[_0x13def3(0xd6)](_0x13def3(0x11c),_0x533daf),loggerService_1[_0x13def3(0x100)]['logWhiteDomainError']('cointopay',_0x13def3(0xde),_0x533daf);if(_0x533daf instanceof Error){console[_0x13def3(0xd6)]('Error\x20message:',_0x533daf[_0x13def3(0xec)]),console[_0x13def3(0xd6)]('Error\x20stack:',_0x533daf[_0x13def3(0x13c)]);throw new Error(_0x13def3(0x119)+_0x533daf[_0x13def3(0xec)]);}throw new Error(_0x13def3(0xd7));}}async[a38_0x6b0dc(0x14b)](_0x240260){const _0x152547=a38_0x6b0dc,_0x102363=Date[_0x152547(0x147)]();try{console[_0x152547(0x13f)](_0x152547(0x159)+_0x240260);const _0x173d21={'gatewayPaymentId':_0x240260};loggerService_1[_0x152547(0x100)]['logWhiteDomainRequest']('cointopay',_0x152547(0x109),_0x152547(0xf2),_0x173d21);const _0x1cd8f0=await fetch(this[_0x152547(0x12b)],{'method':_0x152547(0xf2),'headers':{'Content-Type':_0x152547(0xf4),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x152547(0x153)](_0x173d21)}),_0x17fcad=Date[_0x152547(0x147)]()-_0x102363;console['log'](_0x152547(0x118)),console[_0x152547(0x13f)](_0x152547(0x12d),_0x1cd8f0[_0x152547(0x129)]),console[_0x152547(0x13f)](_0x152547(0x14a),_0x17fcad+'ms');if(!_0x1cd8f0['ok']){const _0x3fea8b=await _0x1cd8f0[_0x152547(0x157)]();console[_0x152547(0xd6)](_0x152547(0xe0),_0x1cd8f0[_0x152547(0x129)]),console[_0x152547(0xd6)](_0x152547(0x10b),_0x3fea8b),loggerService_1['loggerService'][_0x152547(0x146)](_0x152547(0xed),_0x152547(0x109),_0x1cd8f0['status'],_0x3fea8b,_0x17fcad),loggerService_1['loggerService']['logWhiteDomainError'](_0x152547(0xed),'/status',_0x152547(0x117)+_0x1cd8f0[_0x152547(0x129)]+':\x20'+_0x3fea8b);throw new Error(_0x152547(0x14c)+_0x1cd8f0[_0x152547(0x129)]);}const _0x46102a=await _0x1cd8f0['text']();console['log']('Raw\x20Response\x20Body:',_0x46102a);let _0x4db945;try{_0x4db945=JSON[_0x152547(0x13b)](_0x46102a);}catch(_0x22ce9e){console[_0x152547(0xd6)](_0x152547(0xfc),_0x22ce9e),loggerService_1[_0x152547(0x100)]['logWhiteDomainError'](_0x152547(0xed),_0x152547(0x109),_0x152547(0x135)+_0x22ce9e);throw new Error(_0x152547(0x154)+_0x46102a);}loggerService_1[_0x152547(0x100)][_0x152547(0x146)](_0x152547(0xed),_0x152547(0x109),_0x1cd8f0[_0x152547(0x129)],_0x4db945,_0x17fcad),console[_0x152547(0x13f)](_0x152547(0xe3)),console[_0x152547(0x13f)](_0x152547(0x144),_0x4db945['result']),console[_0x152547(0x13f)](_0x152547(0xfa),_0x4db945[_0x152547(0x151)]),console[_0x152547(0x13f)](_0x152547(0x113),_0x4db945[_0x152547(0x158)]?.[_0x152547(0x149)]),console[_0x152547(0x13f)]('Amount:',_0x4db945[_0x152547(0x158)]?.['Amount']),console[_0x152547(0x13f)]('Currency:',_0x4db945[_0x152547(0x158)]?.[_0x152547(0x123)]);if(_0x4db945[_0x152547(0x104)]!=='success'||_0x4db945[_0x152547(0x151)]!==0xc8){const _0x4c8829=_0x4db945[_0x152547(0xec)]||_0x152547(0x13a);console[_0x152547(0xd6)](_0x152547(0x150)),console[_0x152547(0xd6)](_0x152547(0xf7),_0x4c8829),loggerService_1[_0x152547(0x100)][_0x152547(0x106)]('cointopay','/status','Status\x20API\x20Error:\x20'+_0x4c8829);throw new Error(_0x152547(0xea)+_0x4c8829);}if(!_0x4db945['data']){console[_0x152547(0xd6)](_0x152547(0x142)),console['error'](_0x152547(0xd9)),loggerService_1[_0x152547(0x100)]['logWhiteDomainError'](_0x152547(0xed),_0x152547(0x109),_0x152547(0x12c));throw new Error(_0x152547(0x10a));}let _0x9384f9=_0x152547(0x130);switch(_0x4db945[_0x152547(0x158)][_0x152547(0x149)]?.['toLowerCase']()){case _0x152547(0x155):_0x9384f9=_0x152547(0x139);break;case _0x152547(0xfd):case _0x152547(0x11f):case'error':_0x9384f9=_0x152547(0x10e);break;case'expired':case _0x152547(0xdf):_0x9384f9=_0x152547(0xfe);break;case'waiting':case _0x152547(0x156):case'pending':case'created':default:_0x9384f9=_0x152547(0x130);break;}let _0x1a359f,_0x50efd3;if(_0x4db945[_0x152547(0x158)][_0x152547(0x145)]){const _0x3a8a59=_0x4db945[_0x152547(0x158)][_0x152547(0x145)];console[_0x152547(0x13f)]('üè¶\x20Payment\x20Detail:',_0x3a8a59);const _0x4515f8=_0x3a8a59[_0x152547(0x11d)](/IBAN\s+([A-Z0-9]+)/i);_0x4515f8&&(_0x1a359f=_0x4515f8[0x1],console['log'](_0x152547(0xf1),_0x1a359f)),_0x50efd3=_0x3a8a59;}const _0x8a70c={'iban':_0x1a359f,'bankDetails':_0x50efd3,'transactionId':_0x4db945['data'][_0x152547(0xf6)],'coinAddress':_0x4db945['data'][_0x152547(0xf0)],'qrCodeUrl':_0x4db945[_0x152547(0x158)][_0x152547(0xef)],'expiryTime':_0x4db945[_0x152547(0x158)][_0x152547(0x134)],'createdOn':_0x4db945[_0x152547(0x158)]['CreatedOn'],'confirmedOn':_0x4db945[_0x152547(0x158)]['TransactionConfirmedOn']};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console['log'](_0x152547(0x12d),_0x4db945['data']['Status'],'->',_0x9384f9),console['log'](_0x152547(0x108),_0x4db945[_0x152547(0x158)][_0x152547(0x11b)],_0x4db945[_0x152547(0x158)][_0x152547(0x123)]),console['log'](_0x152547(0x105),_0x4db945[_0x152547(0x158)][_0x152547(0xf6)]),console[_0x152547(0x13f)](_0x152547(0x143),_0x1a359f||'not\x20found'),console[_0x152547(0x13f)](_0x152547(0x148),_0x4db945['data']['CreatedOn']),console[_0x152547(0x13f)](_0x152547(0xeb),_0x4db945[_0x152547(0x158)]['TransactionConfirmedOn']||_0x152547(0x126));if(_0x4db945[_0x152547(0x158)][_0x152547(0x149)]?.['toLowerCase']()===_0x152547(0x156))console['log'](_0x152547(0x103));else _0x4db945[_0x152547(0x158)][_0x152547(0x149)]?.[_0x152547(0xdb)]()===_0x152547(0x155)&&console['log'](_0x152547(0x132));return{'status':_0x9384f9,'amount':parseFloat(_0x4db945[_0x152547(0x158)][_0x152547(0x11b)])||undefined,'currency':_0x4db945['data'][_0x152547(0x123)]||_0x152547(0x111),'paymentDetails':_0x8a70c};}catch(_0x4f5933){console[_0x152547(0xd6)](_0x152547(0x128),_0x4f5933),loggerService_1[_0x152547(0x100)][_0x152547(0x106)](_0x152547(0xed),_0x152547(0x109),_0x4f5933);throw new Error(_0x152547(0xd5)+(_0x4f5933 instanceof Error?_0x4f5933[_0x152547(0xec)]:_0x152547(0x12a)));}}async['verifyPayment'](_0x1735b4){const _0x54d723=a38_0x6b0dc,_0x411f03=await this[_0x54d723(0x14b)](_0x1735b4);return{'status':_0x411f03[_0x54d723(0x129)],'amount':_0x411f03[_0x54d723(0xe5)],'currency':_0x411f03['currency']};}async[a38_0x6b0dc(0x11a)](_0x1ba45c){const _0x382c9a=a38_0x6b0dc;console[_0x382c9a(0x13f)](_0x382c9a(0x140),_0x1ba45c);let _0xa37fa6=_0x382c9a(0x130);switch(_0x1ba45c['status']?.['toLowerCase']()){case _0x382c9a(0x155):_0xa37fa6=_0x382c9a(0x139);break;case'cancelled':case _0x382c9a(0x11f):case'error':_0xa37fa6=_0x382c9a(0x10e);break;case _0x382c9a(0x11e):case'timeout':_0xa37fa6=_0x382c9a(0xfe);break;case _0x382c9a(0xd2):case _0x382c9a(0x124):case _0x382c9a(0x156):case _0x382c9a(0xe9):default:_0xa37fa6=_0x382c9a(0x130);break;}return{'paymentId':_0x1ba45c['order_id']||_0x1ba45c[_0x382c9a(0x131)]||'','status':_0xa37fa6,'amount':_0x1ba45c[_0x382c9a(0xe5)],'currency':_0x1ba45c['currency']||'EUR'};}}exports[a38_0x6b0dc(0x10c)]=CoinToPayService;