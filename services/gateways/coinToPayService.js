'use strict';const a41_0x5c5f89=a41_0xfd2a;(function(_0x4603f0,_0x220e19){const _0x573a48=a41_0xfd2a,_0x523af9=_0x4603f0();while(!![]){try{const _0x101868=-parseInt(_0x573a48(0x207))/0x1+parseInt(_0x573a48(0x236))/0x2*(parseInt(_0x573a48(0x1df))/0x3)+parseInt(_0x573a48(0x1fb))/0x4+-parseInt(_0x573a48(0x1f1))/0x5+parseInt(_0x573a48(0x1e6))/0x6+parseInt(_0x573a48(0x1fd))/0x7+-parseInt(_0x573a48(0x234))/0x8;if(_0x101868===_0x220e19)break;else _0x523af9['push'](_0x523af9['shift']());}catch(_0x16c368){_0x523af9['push'](_0x523af9['shift']());}}}(a41_0x4906,0x65630));function a41_0x4906(){const _0x212afc=['5307267enKDhP','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','application/json','statusUrl','Created\x20On:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Payment\x20URL:','awaiting\x20fiat','IBAN:','__esModule','373300NwUVtj','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','log','Unknown\x20error','error','TransactionConfirmedOn','logWhiteDomainResponse','Transaction\x20ID:','status','entries','Status\x20Code:','cointopay','https://tesoft.uk/gateway/cointopay/','stringify','Response\x20Time:','cancelled','Gateway\x20Payment\x20ID:','result','pending','checkPaymentStatus','TransactionID','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','CoinToPayService','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainError','ExpiryTime','amount','üè¶\x20Payment\x20Detail:','payment_url','verifyPayment','PAID','Status:','/status','created','logWhiteDomainRequest','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','not\x20found','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','gateway_payment_id','Parsed\x20Result:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','QRCodeURL','timeout','statusText','\x20EUR','2722952kaxqWs','Error\x20Message:','2018msZBAF','TesSoft\x20Payment\x20System/1.0','Incomplete\x20response:\x20missing\x20data','loggerService','not\x20confirmed','failed','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','CoinToPay\x20API\x20error:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Request\x20Body:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Business\x20Error:\x20','Error\x20message:','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','FAILED','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','expired','processWebhook','Payment\x20Status:','coinAddress','inputCurrency','PaymentDetail','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','parse','JSON\x20Parse\x20Error:\x20','EUR','Failed\x20to\x20parse\x20JSON\x20response:','waiting','message','text','currency','/create','Amount:','paid','CreatedOn','Result:','Error\x20stack:','Raw\x20Response\x20Body:','apiUrl',',\x20body:\x20','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','1095bTtnDb','now','PENDING','Status\x20API\x20Error:\x20','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Headers:','stack','2332080atDrPC','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','order_id','Response\x20Body:','EXPIRED','Amount','Status','Status\x20Text:','Response\x20data:','data','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','2284730RMwodT','POST','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','toLowerCase','success','createPaymentLink','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','defineProperty','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','282996vWhSBD','HTTP\x20error!\x20status:\x20'];a41_0x4906=function(){return _0x212afc;};return a41_0x4906();}Object[a41_0x5c5f89(0x1f8)](exports,a41_0x5c5f89(0x206),{'value':!![]}),exports[a41_0x5c5f89(0x21d)]=void 0x0;const loggerService_1=require('../loggerService');function a41_0xfd2a(_0x5e7320,_0x31b122){const _0x49064d=a41_0x4906();return a41_0xfd2a=function(_0xfd2aa3,_0x36fe8f){_0xfd2aa3=_0xfd2aa3-0x1c4;let _0xa27919=_0x49064d[_0xfd2aa3];return _0xa27919;},a41_0xfd2a(_0x5e7320,_0x31b122);}class CoinToPayService{constructor(){const _0x5d16bd=a41_0x5c5f89;this['apiUrl']=_0x5d16bd(0x213),this[_0x5d16bd(0x200)]=_0x5d16bd(0x241),console[_0x5d16bd(0x209)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x5d16bd(0x209)]('üìä\x20Status\x20check\x20URL:',this[_0x5d16bd(0x200)]);}async[a41_0x5c5f89(0x1f6)](_0x512d85){const _0x1e231a=a41_0x5c5f89,{orderId:_0xe25ee8,amount:_0x58decc}=_0x512d85;console['log'](_0x1e231a(0x208)+_0x58decc+_0x1e231a(0x233));const _0xd26d07={'amount':_0x58decc},_0x537a8e=Date[_0x1e231a(0x1e0)]();try{console[_0x1e231a(0x209)](_0x1e231a(0x23c)),console['log']('URL:',this['apiUrl']),console[_0x1e231a(0x209)](_0x1e231a(0x243),JSON['stringify'](_0xd26d07,null,0x2)),console['log']('Amount:',_0x58decc,_0x1e231a(0x1f7)),loggerService_1[_0x1e231a(0x239)][_0x1e231a(0x229)]('cointopay','/create',_0x1e231a(0x1f2),_0xd26d07);const _0x50b083=await fetch(this[_0x1e231a(0x1dc)],{'method':'POST','headers':{'Content-Type':_0x1e231a(0x1ff),'Accept':'application/json','User-Agent':_0x1e231a(0x237)},'body':JSON[_0x1e231a(0x214)](_0xd26d07)}),_0x403230=Date[_0x1e231a(0x1e0)]()-_0x537a8e;console['log'](_0x1e231a(0x23f)),console[_0x1e231a(0x209)](_0x1e231a(0x226),_0x50b083['status']),console[_0x1e231a(0x209)](_0x1e231a(0x1ed),_0x50b083[_0x1e231a(0x232)]),console[_0x1e231a(0x209)](_0x1e231a(0x1e4),Object['fromEntries'](_0x50b083['headers'][_0x1e231a(0x210)]())),console[_0x1e231a(0x209)](_0x1e231a(0x215),_0x403230+'ms');const _0x52cbd6=await _0x50b083[_0x1e231a(0x1d3)]();console[_0x1e231a(0x209)](_0x1e231a(0x1db),_0x52cbd6);if(!_0x50b083['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x50b083[_0x1e231a(0x20f)]),console[_0x1e231a(0x20b)](_0x1e231a(0x1e9),_0x52cbd6),loggerService_1[_0x1e231a(0x239)]['logWhiteDomainResponse'](_0x1e231a(0x212),_0x1e231a(0x1d5),_0x50b083[_0x1e231a(0x20f)],_0x52cbd6,_0x403230),loggerService_1[_0x1e231a(0x239)][_0x1e231a(0x21f)](_0x1e231a(0x212),_0x1e231a(0x1d5),'HTTP\x20'+_0x50b083[_0x1e231a(0x20f)]+':\x20'+_0x52cbd6);throw new Error(_0x1e231a(0x1fc)+_0x50b083['status']+_0x1e231a(0x1dd)+_0x52cbd6);}let _0x285f52;try{_0x285f52=JSON[_0x1e231a(0x1cd)](_0x52cbd6);}catch(_0x5e2dc7){console['error'](_0x1e231a(0x1d0),_0x5e2dc7),loggerService_1[_0x1e231a(0x239)][_0x1e231a(0x21f)](_0x1e231a(0x212),_0x1e231a(0x1d5),'JSON\x20Parse\x20Error:\x20'+_0x5e2dc7);throw new Error(_0x1e231a(0x22c)+_0x52cbd6);}console[_0x1e231a(0x209)](_0x1e231a(0x1f0)),console[_0x1e231a(0x209)](_0x1e231a(0x22e),JSON[_0x1e231a(0x214)](_0x285f52,null,0x2)),loggerService_1[_0x1e231a(0x239)][_0x1e231a(0x20d)](_0x1e231a(0x212),_0x1e231a(0x1d5),_0x50b083[_0x1e231a(0x20f)],_0x285f52,_0x403230);if(_0x285f52['error']){const _0xe2969f=_0x285f52[_0x1e231a(0x1d2)]||_0x285f52['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x1e231a(0x20b)](_0x1e231a(0x23e)),console[_0x1e231a(0x20b)]('Error\x20Message:',_0xe2969f),loggerService_1[_0x1e231a(0x239)]['logWhiteDomainError']('cointopay',_0x1e231a(0x1d5),_0x1e231a(0x245)+_0xe2969f);throw new Error(_0x1e231a(0x23d)+_0xe2969f);}if(!_0x285f52[_0x1e231a(0x223)]||!_0x285f52['gateway_payment_id']){console[_0x1e231a(0x20b)](_0x1e231a(0x21e)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error'](_0x1e231a(0x1ee),_0x285f52),loggerService_1[_0x1e231a(0x239)]['logWhiteDomainError'](_0x1e231a(0x212),_0x1e231a(0x1d5),_0x1e231a(0x1f3));throw new Error(_0x1e231a(0x202));}return console[_0x1e231a(0x209)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log'](_0x1e231a(0x217),_0x285f52[_0x1e231a(0x22d)]),console[_0x1e231a(0x209)](_0x1e231a(0x203),_0x285f52['payment_url']),console[_0x1e231a(0x209)](_0x1e231a(0x1d6),_0x58decc,_0x1e231a(0x1cf)),{'gateway_payment_id':_0x285f52[_0x1e231a(0x22d)],'payment_url':_0x285f52[_0x1e231a(0x223)]};}catch(_0x3da8af){console[_0x1e231a(0x20b)](_0x1e231a(0x1fe)),console[_0x1e231a(0x20b)]('Error\x20details:',_0x3da8af),loggerService_1[_0x1e231a(0x239)]['logWhiteDomainError']('cointopay',_0x1e231a(0x1d5),_0x3da8af);if(_0x3da8af instanceof Error){console[_0x1e231a(0x20b)](_0x1e231a(0x246),_0x3da8af[_0x1e231a(0x1d2)]),console[_0x1e231a(0x20b)](_0x1e231a(0x1da),_0x3da8af[_0x1e231a(0x1e5)]);throw new Error(_0x1e231a(0x1cc)+_0x3da8af[_0x1e231a(0x1d2)]);}throw new Error(_0x1e231a(0x21c));}}async[a41_0x5c5f89(0x21a)](_0x376498){const _0x572b34=a41_0x5c5f89,_0x17920b=Date[_0x572b34(0x1e0)]();try{console[_0x572b34(0x209)](_0x572b34(0x247)+_0x376498);const _0x1d5de8={'gatewayPaymentId':_0x376498};loggerService_1[_0x572b34(0x239)][_0x572b34(0x229)](_0x572b34(0x212),_0x572b34(0x227),_0x572b34(0x1f2),_0x1d5de8);const _0x449e2d=await fetch(this[_0x572b34(0x200)],{'method':_0x572b34(0x1f2),'headers':{'Content-Type':_0x572b34(0x1ff),'Accept':_0x572b34(0x1ff),'User-Agent':_0x572b34(0x237)},'body':JSON[_0x572b34(0x214)](_0x1d5de8)}),_0x2bf72f=Date[_0x572b34(0x1e0)]()-_0x17920b;console[_0x572b34(0x209)](_0x572b34(0x1e7)),console[_0x572b34(0x209)]('Status:',_0x449e2d[_0x572b34(0x20f)]),console['log']('Response\x20Time:',_0x2bf72f+'ms');if(!_0x449e2d['ok']){const _0x364d41=await _0x449e2d[_0x572b34(0x1d3)]();console[_0x572b34(0x20b)]('HTTP\x20Status:',_0x449e2d['status']),console[_0x572b34(0x20b)](_0x572b34(0x1e9),_0x364d41),loggerService_1[_0x572b34(0x239)][_0x572b34(0x20d)]('cointopay',_0x572b34(0x227),_0x449e2d[_0x572b34(0x20f)],_0x364d41,_0x2bf72f),loggerService_1[_0x572b34(0x239)]['logWhiteDomainError'](_0x572b34(0x212),_0x572b34(0x227),'HTTP\x20'+_0x449e2d[_0x572b34(0x20f)]+':\x20'+_0x364d41);throw new Error(_0x572b34(0x1fc)+_0x449e2d[_0x572b34(0x20f)]);}const _0x286e22=await _0x449e2d[_0x572b34(0x1d3)]();console[_0x572b34(0x209)](_0x572b34(0x1db),_0x286e22);let _0x4b1e0d;try{_0x4b1e0d=JSON[_0x572b34(0x1cd)](_0x286e22);}catch(_0x2a8580){console[_0x572b34(0x20b)](_0x572b34(0x1d0),_0x2a8580),loggerService_1['loggerService'][_0x572b34(0x21f)](_0x572b34(0x212),_0x572b34(0x227),_0x572b34(0x1ce)+_0x2a8580);throw new Error(_0x572b34(0x22f)+_0x286e22);}loggerService_1[_0x572b34(0x239)][_0x572b34(0x20d)](_0x572b34(0x212),'/status',_0x449e2d[_0x572b34(0x20f)],_0x4b1e0d,_0x2bf72f),console['log'](_0x572b34(0x1de)),console[_0x572b34(0x209)](_0x572b34(0x1d9),_0x4b1e0d[_0x572b34(0x218)]),console['log'](_0x572b34(0x211),_0x4b1e0d['status_code']),console[_0x572b34(0x209)](_0x572b34(0x1c8),_0x4b1e0d[_0x572b34(0x1ef)]?.[_0x572b34(0x1ec)]),console[_0x572b34(0x209)](_0x572b34(0x1d6),_0x4b1e0d['data']?.['Amount']),console[_0x572b34(0x209)]('Currency:',_0x4b1e0d[_0x572b34(0x1ef)]?.[_0x572b34(0x1ca)]);if(_0x4b1e0d[_0x572b34(0x218)]!==_0x572b34(0x1f5)||_0x4b1e0d['status_code']!==0xc8){const _0x5282f4=_0x4b1e0d['message']||_0x572b34(0x22a);console[_0x572b34(0x20b)](_0x572b34(0x1c5)),console[_0x572b34(0x20b)](_0x572b34(0x235),_0x5282f4),loggerService_1[_0x572b34(0x239)]['logWhiteDomainError']('cointopay',_0x572b34(0x227),_0x572b34(0x1e2)+_0x5282f4);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x5282f4);}if(!_0x4b1e0d['data']){console[_0x572b34(0x20b)](_0x572b34(0x242)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x572b34(0x239)][_0x572b34(0x21f)](_0x572b34(0x212),_0x572b34(0x227),_0x572b34(0x238));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x27beb5=_0x572b34(0x1e1);switch(_0x4b1e0d[_0x572b34(0x1ef)][_0x572b34(0x1ec)]?.[_0x572b34(0x1f4)]()){case'paid':_0x27beb5=_0x572b34(0x225);break;case _0x572b34(0x216):case _0x572b34(0x23b):case'error':_0x27beb5=_0x572b34(0x1c4);break;case _0x572b34(0x1c6):case _0x572b34(0x231):_0x27beb5='EXPIRED';break;case'waiting':case _0x572b34(0x204):case'pending':case'created':default:_0x27beb5='PENDING';break;}let _0x26e2cd,_0x1ffb57;if(_0x4b1e0d['data'][_0x572b34(0x1cb)]){const _0x461430=_0x4b1e0d[_0x572b34(0x1ef)][_0x572b34(0x1cb)];console[_0x572b34(0x209)](_0x572b34(0x222),_0x461430);const _0x3e864f=_0x461430['match'](/IBAN\s+([A-Z0-9]+)/i);_0x3e864f&&(_0x26e2cd=_0x3e864f[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0x26e2cd)),_0x1ffb57=_0x461430;}const _0x2aed64={'iban':_0x26e2cd,'bankDetails':_0x1ffb57,'transactionId':_0x4b1e0d[_0x572b34(0x1ef)][_0x572b34(0x21b)],'coinAddress':_0x4b1e0d[_0x572b34(0x1ef)][_0x572b34(0x1c9)],'qrCodeUrl':_0x4b1e0d[_0x572b34(0x1ef)][_0x572b34(0x230)],'expiryTime':_0x4b1e0d[_0x572b34(0x1ef)][_0x572b34(0x220)],'createdOn':_0x4b1e0d[_0x572b34(0x1ef)]['CreatedOn'],'confirmedOn':_0x4b1e0d[_0x572b34(0x1ef)][_0x572b34(0x20c)]};console['log'](_0x572b34(0x244)),console[_0x572b34(0x209)](_0x572b34(0x226),_0x4b1e0d[_0x572b34(0x1ef)]['Status'],'->',_0x27beb5),console[_0x572b34(0x209)](_0x572b34(0x1d6),_0x4b1e0d[_0x572b34(0x1ef)][_0x572b34(0x1eb)],_0x4b1e0d[_0x572b34(0x1ef)]['inputCurrency']),console['log'](_0x572b34(0x20e),_0x4b1e0d[_0x572b34(0x1ef)]['TransactionID']),console[_0x572b34(0x209)](_0x572b34(0x205),_0x26e2cd||_0x572b34(0x22b)),console['log'](_0x572b34(0x201),_0x4b1e0d[_0x572b34(0x1ef)][_0x572b34(0x1d8)]),console[_0x572b34(0x209)]('Confirmed\x20On:',_0x4b1e0d[_0x572b34(0x1ef)][_0x572b34(0x20c)]||_0x572b34(0x23a));if(_0x4b1e0d['data']['Status']?.['toLowerCase']()===_0x572b34(0x204))console[_0x572b34(0x209)](_0x572b34(0x1e3));else _0x4b1e0d[_0x572b34(0x1ef)]['Status']?.[_0x572b34(0x1f4)]()===_0x572b34(0x1d7)&&console[_0x572b34(0x209)](_0x572b34(0x240));return{'status':_0x27beb5,'amount':parseFloat(_0x4b1e0d['data']['Amount'])||undefined,'currency':_0x4b1e0d[_0x572b34(0x1ef)][_0x572b34(0x1ca)]||_0x572b34(0x1cf),'paymentDetails':_0x2aed64};}catch(_0x3a1544){console[_0x572b34(0x20b)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x3a1544),loggerService_1[_0x572b34(0x239)][_0x572b34(0x21f)](_0x572b34(0x212),_0x572b34(0x227),_0x3a1544);throw new Error(_0x572b34(0x1f9)+(_0x3a1544 instanceof Error?_0x3a1544[_0x572b34(0x1d2)]:_0x572b34(0x20a)));}}async[a41_0x5c5f89(0x224)](_0xb79600){const _0x3fca24=a41_0x5c5f89,_0x20fea5=await this[_0x3fca24(0x21a)](_0xb79600);return{'status':_0x20fea5[_0x3fca24(0x20f)],'amount':_0x20fea5[_0x3fca24(0x221)],'currency':_0x20fea5[_0x3fca24(0x1d4)]};}async[a41_0x5c5f89(0x1c7)](_0x3a3ae3){const _0xddaa6f=a41_0x5c5f89;console['log'](_0xddaa6f(0x1fa),_0x3a3ae3);let _0x344809='PENDING';switch(_0x3a3ae3[_0xddaa6f(0x20f)]?.['toLowerCase']()){case _0xddaa6f(0x1d7):_0x344809=_0xddaa6f(0x225);break;case'cancelled':case _0xddaa6f(0x23b):case _0xddaa6f(0x20b):_0x344809='FAILED';break;case _0xddaa6f(0x1c6):case _0xddaa6f(0x231):_0x344809=_0xddaa6f(0x1ea);break;case _0xddaa6f(0x219):case _0xddaa6f(0x1d1):case _0xddaa6f(0x204):case _0xddaa6f(0x228):default:_0x344809=_0xddaa6f(0x1e1);break;}return{'paymentId':_0x3a3ae3[_0xddaa6f(0x1e8)]||_0x3a3ae3['merchant_reference_id']||'','status':_0x344809,'amount':_0x3a3ae3[_0xddaa6f(0x221)],'currency':_0x3a3ae3[_0xddaa6f(0x1d4)]||_0xddaa6f(0x1cf)};}}exports[a41_0x5c5f89(0x21d)]=CoinToPayService;