'use strict';const a43_0x909f7c=a43_0x5353;(function(_0x16e4f5,_0x170025){const _0x5155e6=a43_0x5353,_0x429510=_0x16e4f5();while(!![]){try{const _0x58ebc3=-parseInt(_0x5155e6(0xde))/0x1*(-parseInt(_0x5155e6(0xfc))/0x2)+-parseInt(_0x5155e6(0x128))/0x3+-parseInt(_0x5155e6(0xf7))/0x4*(parseInt(_0x5155e6(0x135))/0x5)+parseInt(_0x5155e6(0x101))/0x6+-parseInt(_0x5155e6(0x117))/0x7*(parseInt(_0x5155e6(0x139))/0x8)+parseInt(_0x5155e6(0x10f))/0x9*(parseInt(_0x5155e6(0x13a))/0xa)+-parseInt(_0x5155e6(0x121))/0xb*(parseInt(_0x5155e6(0x119))/0xc);if(_0x58ebc3===_0x170025)break;else _0x429510['push'](_0x429510['shift']());}catch(_0x66b5a){_0x429510['push'](_0x429510['shift']());}}}(a43_0x2d35,0x69c21));Object['defineProperty'](exports,a43_0x909f7c(0xef),{'value':!![]}),exports[a43_0x909f7c(0x129)]=void 0x0;const loggerService_1=require('../loggerService');function a43_0x5353(_0x231af9,_0x200a54){const _0x2d35ab=a43_0x2d35();return a43_0x5353=function(_0x5353c2,_0x1011d9){_0x5353c2=_0x5353c2-0xbe;let _0x3c85ef=_0x2d35ab[_0x5353c2];return _0x3c85ef;},a43_0x5353(_0x231af9,_0x200a54);}class CoinToPayService{constructor(){const _0x523247=a43_0x909f7c;this['apiUrl']=_0x523247(0x131),this[_0x523247(0xfe)]=_0x523247(0xfa),console[_0x523247(0x11f)](_0x523247(0xcc)),console['log'](_0x523247(0x11c),this[_0x523247(0xfe)]);}async[a43_0x909f7c(0x133)](_0x282608){const _0x16d06a=a43_0x909f7c,{orderId:_0x2b9ff4,amount:_0x5b8591}=_0x282608;console['log']('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x5b8591+_0x16d06a(0x10b));const _0x78a2ba={'amount':_0x5b8591},_0x4a0cba=Date['now']();try{console[_0x16d06a(0x11f)](_0x16d06a(0xf2)),console[_0x16d06a(0x11f)](_0x16d06a(0xeb),this[_0x16d06a(0xbe)]),console[_0x16d06a(0x11f)](_0x16d06a(0xe7),JSON[_0x16d06a(0xe6)](_0x78a2ba,null,0x2)),console[_0x16d06a(0x11f)](_0x16d06a(0xcb),_0x5b8591,_0x16d06a(0xd2)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x16d06a(0x105),'/create',_0x16d06a(0x13c),_0x78a2ba);const _0x3219ad=await fetch(this[_0x16d06a(0xbe)],{'method':_0x16d06a(0x13c),'headers':{'Content-Type':_0x16d06a(0xc1),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x16d06a(0xe6)](_0x78a2ba)}),_0x146925=Date[_0x16d06a(0x10e)]()-_0x4a0cba;console[_0x16d06a(0x11f)](_0x16d06a(0xdc)),console['log'](_0x16d06a(0x123),_0x3219ad['status']),console[_0x16d06a(0x11f)](_0x16d06a(0x113),_0x3219ad[_0x16d06a(0xcd)]),console[_0x16d06a(0x11f)](_0x16d06a(0x111),Object['fromEntries'](_0x3219ad['headers'][_0x16d06a(0x120)]())),console[_0x16d06a(0x11f)](_0x16d06a(0xec),_0x146925+'ms');const _0x48199d=await _0x3219ad[_0x16d06a(0xf0)]();console[_0x16d06a(0x11f)](_0x16d06a(0x132),_0x48199d);if(!_0x3219ad['ok']){console['error'](_0x16d06a(0xf6)),console[_0x16d06a(0x118)](_0x16d06a(0xc7),_0x3219ad[_0x16d06a(0x11e)]),console[_0x16d06a(0x118)]('Response\x20Body:',_0x48199d),loggerService_1[_0x16d06a(0x12f)][_0x16d06a(0x122)](_0x16d06a(0x105),_0x16d06a(0x124),_0x3219ad[_0x16d06a(0x11e)],_0x48199d,_0x146925),loggerService_1[_0x16d06a(0x12f)][_0x16d06a(0x12a)](_0x16d06a(0x105),_0x16d06a(0x124),_0x16d06a(0xf8)+_0x3219ad[_0x16d06a(0x11e)]+':\x20'+_0x48199d);throw new Error(_0x16d06a(0x10d)+_0x3219ad[_0x16d06a(0x11e)]+_0x16d06a(0xd7)+_0x48199d);}let _0x478fb6;try{_0x478fb6=JSON[_0x16d06a(0xc3)](_0x48199d);}catch(_0x316ad6){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x316ad6),loggerService_1[_0x16d06a(0x12f)][_0x16d06a(0x12a)](_0x16d06a(0x105),_0x16d06a(0x124),_0x16d06a(0xd4)+_0x316ad6);throw new Error(_0x16d06a(0x110)+_0x48199d);}console[_0x16d06a(0x11f)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x16d06a(0x11f)](_0x16d06a(0x127),JSON[_0x16d06a(0xe6)](_0x478fb6,null,0x2)),loggerService_1['loggerService'][_0x16d06a(0x122)](_0x16d06a(0x105),_0x16d06a(0x124),_0x3219ad[_0x16d06a(0x11e)],_0x478fb6,_0x146925);if(_0x478fb6[_0x16d06a(0x118)]){const _0x13abde=_0x478fb6[_0x16d06a(0x106)]||_0x478fb6['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x16d06a(0x118)](_0x16d06a(0x12d)),console[_0x16d06a(0x118)](_0x16d06a(0xc8),_0x13abde),loggerService_1['loggerService'][_0x16d06a(0x12a)]('cointopay',_0x16d06a(0x124),_0x16d06a(0xed)+_0x13abde);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x13abde);}if(!_0x478fb6[_0x16d06a(0xea)]||!_0x478fb6[_0x16d06a(0x13b)]){console['error'](_0x16d06a(0x134)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x16d06a(0x118)]('Response\x20data:',_0x478fb6),loggerService_1[_0x16d06a(0x12f)]['logWhiteDomainError']('cointopay',_0x16d06a(0x124),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console['log'](_0x16d06a(0xe0)),console['log'](_0x16d06a(0x104),_0x478fb6[_0x16d06a(0x13b)]),console[_0x16d06a(0x11f)]('Payment\x20URL:',_0x478fb6['payment_url']),console['log']('Amount:',_0x5b8591,'EUR'),{'gateway_payment_id':_0x478fb6[_0x16d06a(0x13b)],'payment_url':_0x478fb6['payment_url']};}catch(_0x594367){console['error'](_0x16d06a(0xce)),console[_0x16d06a(0x118)](_0x16d06a(0x12c),_0x594367),loggerService_1[_0x16d06a(0x12f)][_0x16d06a(0x12a)](_0x16d06a(0x105),'/create',_0x594367);if(_0x594367 instanceof Error){console[_0x16d06a(0x118)](_0x16d06a(0xd1),_0x594367[_0x16d06a(0x106)]),console[_0x16d06a(0x118)](_0x16d06a(0xc5),_0x594367['stack']);throw new Error(_0x16d06a(0x136)+_0x594367[_0x16d06a(0x106)]);}throw new Error(_0x16d06a(0xfb));}}async[a43_0x909f7c(0xff)](_0x114114){const _0x266306=a43_0x909f7c,_0x99751e=Date['now']();try{console[_0x266306(0x11f)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x114114);const _0x11923f={'gatewayPaymentId':_0x114114};loggerService_1[_0x266306(0x12f)]['logWhiteDomainRequest']('cointopay',_0x266306(0xdd),_0x266306(0x13c),_0x11923f);const _0x152d86=await fetch(this[_0x266306(0xfe)],{'method':_0x266306(0x13c),'headers':{'Content-Type':_0x266306(0xc1),'Accept':_0x266306(0xc1),'User-Agent':_0x266306(0x103)},'body':JSON['stringify'](_0x11923f)}),_0x2d4594=Date['now']()-_0x99751e;console[_0x266306(0x11f)](_0x266306(0xd9)),console['log'](_0x266306(0x123),_0x152d86[_0x266306(0x11e)]),console[_0x266306(0x11f)]('Response\x20Time:',_0x2d4594+'ms');if(!_0x152d86['ok']){const _0x5d7b4d=await _0x152d86['text']();console[_0x266306(0x118)](_0x266306(0xc7),_0x152d86['status']),console['error']('Response\x20Body:',_0x5d7b4d),loggerService_1[_0x266306(0x12f)][_0x266306(0x122)](_0x266306(0x105),_0x266306(0xdd),_0x152d86[_0x266306(0x11e)],_0x5d7b4d,_0x2d4594),loggerService_1[_0x266306(0x12f)][_0x266306(0x12a)](_0x266306(0x105),_0x266306(0xdd),_0x266306(0xf8)+_0x152d86['status']+':\x20'+_0x5d7b4d);throw new Error(_0x266306(0x10d)+_0x152d86[_0x266306(0x11e)]);}const _0x39bdb7=await _0x152d86[_0x266306(0xf0)]();console['log'](_0x266306(0x132),_0x39bdb7);let _0x5ecfa6;try{_0x5ecfa6=JSON[_0x266306(0xc3)](_0x39bdb7);}catch(_0x3314cc){console[_0x266306(0x118)](_0x266306(0x109),_0x3314cc),loggerService_1[_0x266306(0x12f)][_0x266306(0x12a)]('cointopay',_0x266306(0xdd),_0x266306(0xd4)+_0x3314cc);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x39bdb7);}loggerService_1[_0x266306(0x12f)][_0x266306(0x122)](_0x266306(0x105),_0x266306(0xdd),_0x152d86[_0x266306(0x11e)],_0x5ecfa6,_0x2d4594),console['log'](_0x266306(0x10c)),console[_0x266306(0x11f)](_0x266306(0xe4),_0x5ecfa6[_0x266306(0xda)]),console['log'](_0x266306(0x100),_0x5ecfa6[_0x266306(0xd5)]),console[_0x266306(0x11f)](_0x266306(0x12e),_0x5ecfa6[_0x266306(0xf4)]?.['Status']),console['log']('Amount:',_0x5ecfa6['data']?.[_0x266306(0x114)]),console[_0x266306(0x11f)](_0x266306(0xca),_0x5ecfa6['data']?.[_0x266306(0xc2)]);if(_0x5ecfa6[_0x266306(0xda)]!==_0x266306(0x102)||_0x5ecfa6['status_code']!==0xc8){const _0x34be33=_0x5ecfa6[_0x266306(0x106)]||_0x266306(0x11a);console[_0x266306(0x118)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x266306(0x118)]('Error\x20Message:',_0x34be33),loggerService_1[_0x266306(0x12f)]['logWhiteDomainError']('cointopay',_0x266306(0xdd),_0x266306(0x10a)+_0x34be33);throw new Error(_0x266306(0x107)+_0x34be33);}if(!_0x5ecfa6['data']){console[_0x266306(0x118)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x266306(0x118)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x266306(0xdd),_0x266306(0x112));throw new Error(_0x266306(0xc6));}let _0x1ed3b7=_0x266306(0xe9);switch(_0x5ecfa6[_0x266306(0xf4)][_0x266306(0x137)]?.['toLowerCase']()){case _0x266306(0xc9):_0x1ed3b7=_0x266306(0xf5);break;case _0x266306(0x108):case _0x266306(0xfd):case _0x266306(0x118):_0x1ed3b7=_0x266306(0x115);break;case _0x266306(0x125):case _0x266306(0xd6):_0x1ed3b7='EXPIRED';break;case _0x266306(0xdb):case'awaiting\x20fiat':case _0x266306(0x11b):case _0x266306(0xc0):default:_0x1ed3b7=_0x266306(0xe9);break;}let _0x430579,_0x2b018f;if(_0x5ecfa6['data'][_0x266306(0xe5)]){const _0x5c73fe=_0x5ecfa6[_0x266306(0xf4)]['PaymentDetail'];console[_0x266306(0x11f)](_0x266306(0xcf),_0x5c73fe);const _0x4c6d29=_0x5c73fe[_0x266306(0x130)](/IBAN\s+([A-Z0-9]+)/i);_0x4c6d29&&(_0x430579=_0x4c6d29[0x1],console[_0x266306(0x11f)](_0x266306(0xee),_0x430579)),_0x2b018f=_0x5c73fe;}const _0x584205={'iban':_0x430579,'bankDetails':_0x2b018f,'transactionId':_0x5ecfa6[_0x266306(0xf4)]['TransactionID'],'coinAddress':_0x5ecfa6['data']['coinAddress'],'qrCodeUrl':_0x5ecfa6[_0x266306(0xf4)][_0x266306(0xe2)],'expiryTime':_0x5ecfa6['data']['ExpiryTime'],'createdOn':_0x5ecfa6[_0x266306(0xf4)][_0x266306(0xd8)],'confirmedOn':_0x5ecfa6['data'][_0x266306(0xf1)]};console[_0x266306(0x11f)](_0x266306(0xf9)),console[_0x266306(0x11f)](_0x266306(0x123),_0x5ecfa6[_0x266306(0xf4)][_0x266306(0x137)],'->',_0x1ed3b7),console[_0x266306(0x11f)](_0x266306(0xcb),_0x5ecfa6[_0x266306(0xf4)][_0x266306(0x114)],_0x5ecfa6[_0x266306(0xf4)][_0x266306(0xc2)]),console[_0x266306(0x11f)]('Transaction\x20ID:',_0x5ecfa6['data']['TransactionID']),console[_0x266306(0x11f)]('IBAN:',_0x430579||_0x266306(0xbf)),console[_0x266306(0x11f)]('Created\x20On:',_0x5ecfa6[_0x266306(0xf4)][_0x266306(0xd8)]),console[_0x266306(0x11f)]('Confirmed\x20On:',_0x5ecfa6['data'][_0x266306(0xf1)]||_0x266306(0xd0));if(_0x5ecfa6[_0x266306(0xf4)]['Status']?.[_0x266306(0x116)]()===_0x266306(0xd3))console[_0x266306(0x11f)]('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x5ecfa6[_0x266306(0xf4)][_0x266306(0x137)]?.[_0x266306(0x116)]()==='paid'&&console[_0x266306(0x11f)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x1ed3b7,'amount':parseFloat(_0x5ecfa6['data'][_0x266306(0x114)])||undefined,'currency':_0x5ecfa6[_0x266306(0xf4)][_0x266306(0xc2)]||'EUR','paymentDetails':_0x584205};}catch(_0x41563b){console['error'](_0x266306(0xe3),_0x41563b),loggerService_1['loggerService'][_0x266306(0x12a)](_0x266306(0x105),'/status',_0x41563b);throw new Error(_0x266306(0xf3)+(_0x41563b instanceof Error?_0x41563b[_0x266306(0x106)]:_0x266306(0xdf)));}}async['verifyPayment'](_0x291076){const _0x579f40=a43_0x909f7c,_0x222e15=await this['checkPaymentStatus'](_0x291076);return{'status':_0x222e15['status'],'amount':_0x222e15[_0x579f40(0xc4)],'currency':_0x222e15[_0x579f40(0x12b)]};}async[a43_0x909f7c(0x11d)](_0x3a00d9){const _0xf37075=a43_0x909f7c;console['log'](_0xf37075(0xe8),_0x3a00d9);let _0x2da9d4='PENDING';switch(_0x3a00d9['status']?.['toLowerCase']()){case _0xf37075(0xc9):_0x2da9d4='PAID';break;case'cancelled':case _0xf37075(0xfd):case _0xf37075(0x118):_0x2da9d4=_0xf37075(0x115);break;case'expired':case _0xf37075(0xd6):_0x2da9d4=_0xf37075(0x138);break;case _0xf37075(0x11b):case _0xf37075(0xdb):case _0xf37075(0xd3):case _0xf37075(0xc0):default:_0x2da9d4=_0xf37075(0xe9);break;}return{'paymentId':_0x3a00d9['order_id']||_0x3a00d9[_0xf37075(0x126)]||'','status':_0x2da9d4,'amount':_0x3a00d9[_0xf37075(0xc4)],'currency':_0x3a00d9['currency']||_0xf37075(0xe1)};}}function a43_0x2d35(){const _0xe2b770=['18778rwuLJn','failed','statusUrl','checkPaymentStatus','Status\x20Code:','2892930noAWwd','success','TesSoft\x20Payment\x20System/1.0','Gateway\x20Payment\x20ID:','cointopay','message','CoinToPay\x20status\x20API\x20error:\x20','cancelled','Failed\x20to\x20parse\x20JSON\x20response:','Status\x20API\x20Error:\x20','\x20EUR','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','HTTP\x20error!\x20status:\x20','now','1791CXAcEC','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Headers:','Incomplete\x20response:\x20missing\x20data','Status\x20Text:','Amount','FAILED','toLowerCase','1322601FaTlFx','error','12KoVCWM','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','pending','📊\x20Status\x20check\x20URL:','processWebhook','status','log','entries','9672212XdNUwH','logWhiteDomainResponse','Status:','/create','expired','merchant_reference_id','Parsed\x20Result:','1098855INPoiY','CoinToPayService','logWhiteDomainError','currency','Error\x20details:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Payment\x20Status:','loggerService','match','https://tesoft.uk/gateway/cointopay/','Raw\x20Response\x20Body:','createPaymentLink','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','310665GqnjYT','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Status','EXPIRED','8YRKZOV','36710JWSSlM','gateway_payment_id','POST','apiUrl','not\x20found','created','application/json','inputCurrency','parse','amount','Error\x20stack:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','HTTP\x20Status:','Error\x20Message:','paid','Currency:','Amount:','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','statusText','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','🏦\x20Payment\x20Detail:','not\x20confirmed','Error\x20message:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','awaiting\x20fiat','JSON\x20Parse\x20Error:\x20','status_code','timeout',',\x20body:\x20','CreatedOn','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','result','waiting','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','/status','83IbmIDB','Unknown\x20error','===\x20COINTOPAY\x20SUCCESS\x20===','EUR','QRCodeURL','CoinToPay\x20payment\x20status\x20check\x20error:','Result:','PaymentDetail','stringify','Request\x20Body:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','PENDING','payment_url','URL:','Response\x20Time:','Business\x20Error:\x20','🏦\x20Extracted\x20IBAN:','__esModule','text','TransactionConfirmedOn','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','data','PAID','===\x20COINTOPAY\x20API\x20ERROR\x20===','8tjZYNc','HTTP\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','https://tesoft.uk/gateway/cointopay/status.php','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error'];a43_0x2d35=function(){return _0xe2b770;};return a43_0x2d35();}exports[a43_0x909f7c(0x129)]=CoinToPayService;