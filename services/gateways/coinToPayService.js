'use strict';const a41_0x2997c9=a41_0x5257;(function(_0x2290ad,_0x2adeff){const _0x1c573b=a41_0x5257,_0x4dd547=_0x2290ad();while(!![]){try{const _0x31ea32=parseInt(_0x1c573b(0x20c))/0x1*(parseInt(_0x1c573b(0x1d6))/0x2)+-parseInt(_0x1c573b(0x1cf))/0x3*(-parseInt(_0x1c573b(0x1b2))/0x4)+parseInt(_0x1c573b(0x198))/0x5*(-parseInt(_0x1c573b(0x1c0))/0x6)+parseInt(_0x1c573b(0x1c8))/0x7+-parseInt(_0x1c573b(0x18a))/0x8+parseInt(_0x1c573b(0x1e6))/0x9+-parseInt(_0x1c573b(0x1de))/0xa;if(_0x31ea32===_0x2adeff)break;else _0x4dd547['push'](_0x4dd547['shift']());}catch(_0x341412){_0x4dd547['push'](_0x4dd547['shift']());}}}(a41_0x3114,0xeb775));function a41_0x5257(_0x293278,_0xd8d692){const _0x3114f8=a41_0x3114();return a41_0x5257=function(_0x5257a6,_0x4ac57b){_0x5257a6=_0x5257a6-0x18a;let _0x2be96f=_0x3114f8[_0x5257a6];return _0x2be96f;},a41_0x5257(_0x293278,_0xd8d692);}Object[a41_0x2997c9(0x1dc)](exports,a41_0x2997c9(0x1f8),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a41_0x2997c9(0x199));class CoinToPayService{constructor(){const _0x26e9bd=a41_0x2997c9;this['apiUrl']=_0x26e9bd(0x1e9),this[_0x26e9bd(0x1b4)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x26e9bd(0x1d4)]('🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x26e9bd(0x1d4)]('📊\x20Status\x20check\x20URL:',this['statusUrl']);}async[a41_0x2997c9(0x1ad)](_0x30b634){const _0x1aaf14=a41_0x2997c9,{orderId:_0x5bc71e,amount:_0x19c3c0}=_0x30b634;console[_0x1aaf14(0x1d4)](_0x1aaf14(0x1d7)+_0x19c3c0+_0x1aaf14(0x1a2));const _0x4c8a02={'amount':_0x19c3c0},_0x23097a=Date[_0x1aaf14(0x1c1)]();try{console['log'](_0x1aaf14(0x1a4)),console['log'](_0x1aaf14(0x1f6),this['apiUrl']),console[_0x1aaf14(0x1d4)](_0x1aaf14(0x1f3),JSON[_0x1aaf14(0x1c9)](_0x4c8a02,null,0x2)),console['log'](_0x1aaf14(0x19d),_0x19c3c0,_0x1aaf14(0x1f2)),loggerService_1[_0x1aaf14(0x1a8)][_0x1aaf14(0x209)](_0x1aaf14(0x1f5),_0x1aaf14(0x20a),_0x1aaf14(0x1a7),_0x4c8a02);const _0x1a5ad5=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x1aaf14(0x192),'Accept':_0x1aaf14(0x192),'User-Agent':_0x1aaf14(0x1b6)},'body':JSON[_0x1aaf14(0x1c9)](_0x4c8a02)}),_0x410771=Date[_0x1aaf14(0x1c1)]()-_0x23097a;console['log'](_0x1aaf14(0x1bb)),console[_0x1aaf14(0x1d4)](_0x1aaf14(0x208),_0x1a5ad5[_0x1aaf14(0x191)]),console['log'](_0x1aaf14(0x1e5),_0x1a5ad5['statusText']),console[_0x1aaf14(0x1d4)](_0x1aaf14(0x1ae),Object['fromEntries'](_0x1a5ad5[_0x1aaf14(0x202)][_0x1aaf14(0x1c6)]())),console[_0x1aaf14(0x1d4)](_0x1aaf14(0x1a3),_0x410771+'ms');const _0x34f29c=await _0x1a5ad5[_0x1aaf14(0x1e4)]();console[_0x1aaf14(0x1d4)](_0x1aaf14(0x1df),_0x34f29c);if(!_0x1a5ad5['ok']){console[_0x1aaf14(0x1e2)](_0x1aaf14(0x1ab)),console[_0x1aaf14(0x1e2)](_0x1aaf14(0x1fe),_0x1a5ad5[_0x1aaf14(0x191)]),console[_0x1aaf14(0x1e2)](_0x1aaf14(0x207),_0x34f29c),loggerService_1['loggerService'][_0x1aaf14(0x1e0)]('cointopay',_0x1aaf14(0x20a),_0x1a5ad5[_0x1aaf14(0x191)],_0x34f29c,_0x410771),loggerService_1['loggerService'][_0x1aaf14(0x1d2)](_0x1aaf14(0x1f5),_0x1aaf14(0x20a),'HTTP\x20'+_0x1a5ad5[_0x1aaf14(0x191)]+':\x20'+_0x34f29c);throw new Error(_0x1aaf14(0x195)+_0x1a5ad5[_0x1aaf14(0x191)]+_0x1aaf14(0x20b)+_0x34f29c);}let _0x1542de;try{_0x1542de=JSON[_0x1aaf14(0x201)](_0x34f29c);}catch(_0x1c2142){console['error'](_0x1aaf14(0x193),_0x1c2142),loggerService_1[_0x1aaf14(0x1a8)][_0x1aaf14(0x1d2)](_0x1aaf14(0x1f5),_0x1aaf14(0x20a),_0x1aaf14(0x1b5)+_0x1c2142);throw new Error(_0x1aaf14(0x1d9)+_0x34f29c);}console[_0x1aaf14(0x1d4)](_0x1aaf14(0x1ca)),console[_0x1aaf14(0x1d4)](_0x1aaf14(0x1ef),JSON['stringify'](_0x1542de,null,0x2)),loggerService_1[_0x1aaf14(0x1a8)][_0x1aaf14(0x1e0)](_0x1aaf14(0x1f5),'/create',_0x1a5ad5[_0x1aaf14(0x191)],_0x1542de,_0x410771);if(_0x1542de[_0x1aaf14(0x1e2)]){const _0x33d78f=_0x1542de[_0x1aaf14(0x1be)]||_0x1542de[_0x1aaf14(0x1e2)]||_0x1aaf14(0x205);console['error'](_0x1aaf14(0x203)),console['error']('Error\x20Message:',_0x33d78f),loggerService_1['loggerService'][_0x1aaf14(0x1d2)](_0x1aaf14(0x1f5),'/create',_0x1aaf14(0x18d)+_0x33d78f);throw new Error(_0x1aaf14(0x1d5)+_0x33d78f);}if(!_0x1542de[_0x1aaf14(0x1da)]||!_0x1542de[_0x1aaf14(0x1b9)]){console['error'](_0x1aaf14(0x18f)),console[_0x1aaf14(0x1e2)](_0x1aaf14(0x1dd)),console[_0x1aaf14(0x1e2)]('Response\x20data:',_0x1542de),loggerService_1[_0x1aaf14(0x1a8)]['logWhiteDomainError'](_0x1aaf14(0x1f5),_0x1aaf14(0x20a),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x1aaf14(0x204));}return console['log'](_0x1aaf14(0x18e)),console[_0x1aaf14(0x1d4)](_0x1aaf14(0x1f7),_0x1542de['gateway_payment_id']),console[_0x1aaf14(0x1d4)](_0x1aaf14(0x1b1),_0x1542de[_0x1aaf14(0x1da)]),console[_0x1aaf14(0x1d4)](_0x1aaf14(0x19d),_0x19c3c0,_0x1aaf14(0x1c2)),{'gateway_payment_id':_0x1542de[_0x1aaf14(0x1b9)],'payment_url':_0x1542de[_0x1aaf14(0x1da)]};}catch(_0x2272da){console[_0x1aaf14(0x1e2)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x1aaf14(0x1e2)](_0x1aaf14(0x1a0),_0x2272da),loggerService_1[_0x1aaf14(0x1a8)][_0x1aaf14(0x1d2)](_0x1aaf14(0x1f5),'/create',_0x2272da);if(_0x2272da instanceof Error){console[_0x1aaf14(0x1e2)]('Error\x20message:',_0x2272da[_0x1aaf14(0x1be)]),console[_0x1aaf14(0x1e2)](_0x1aaf14(0x1bc),_0x2272da['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x2272da[_0x1aaf14(0x1be)]);}throw new Error(_0x1aaf14(0x1fa));}}async[a41_0x2997c9(0x206)](_0x3c5f13){const _0x29c81d=a41_0x2997c9,_0x522f18=Date[_0x29c81d(0x1c1)]();try{console['log'](_0x29c81d(0x1e3)+_0x3c5f13);const _0x278412={'gatewayPaymentId':_0x3c5f13};loggerService_1[_0x29c81d(0x1a8)]['logWhiteDomainRequest'](_0x29c81d(0x1f5),'/status',_0x29c81d(0x1a7),_0x278412);const _0x560030=await fetch(this[_0x29c81d(0x1b4)],{'method':_0x29c81d(0x1a7),'headers':{'Content-Type':_0x29c81d(0x192),'Accept':_0x29c81d(0x192),'User-Agent':_0x29c81d(0x1b6)},'body':JSON[_0x29c81d(0x1c9)](_0x278412)}),_0x14f822=Date[_0x29c81d(0x1c1)]()-_0x522f18;console[_0x29c81d(0x1d4)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log'](_0x29c81d(0x208),_0x560030[_0x29c81d(0x191)]),console[_0x29c81d(0x1d4)](_0x29c81d(0x1a3),_0x14f822+'ms');if(!_0x560030['ok']){const _0x486e90=await _0x560030[_0x29c81d(0x1e4)]();console[_0x29c81d(0x1e2)](_0x29c81d(0x1fe),_0x560030[_0x29c81d(0x191)]),console[_0x29c81d(0x1e2)](_0x29c81d(0x207),_0x486e90),loggerService_1[_0x29c81d(0x1a8)][_0x29c81d(0x1e0)](_0x29c81d(0x1f5),'/status',_0x560030['status'],_0x486e90,_0x14f822),loggerService_1[_0x29c81d(0x1a8)][_0x29c81d(0x1d2)](_0x29c81d(0x1f5),'/status','HTTP\x20'+_0x560030[_0x29c81d(0x191)]+':\x20'+_0x486e90);throw new Error(_0x29c81d(0x195)+_0x560030[_0x29c81d(0x191)]);}const _0x12bf9e=await _0x560030[_0x29c81d(0x1e4)]();console['log']('Raw\x20Response\x20Body:',_0x12bf9e);let _0x36d364;try{_0x36d364=JSON['parse'](_0x12bf9e);}catch(_0x196eac){console['error'](_0x29c81d(0x193),_0x196eac),loggerService_1['loggerService'][_0x29c81d(0x1d2)](_0x29c81d(0x1f5),_0x29c81d(0x1b8),_0x29c81d(0x1b5)+_0x196eac);throw new Error(_0x29c81d(0x1f4)+_0x12bf9e);}loggerService_1[_0x29c81d(0x1a8)]['logWhiteDomainResponse'](_0x29c81d(0x1f5),_0x29c81d(0x1b8),_0x560030['status'],_0x36d364,_0x14f822),console[_0x29c81d(0x1d4)](_0x29c81d(0x19a)),console[_0x29c81d(0x1d4)]('Result:',_0x36d364[_0x29c81d(0x1b0)]),console[_0x29c81d(0x1d4)](_0x29c81d(0x1fc),_0x36d364[_0x29c81d(0x19e)]),console[_0x29c81d(0x1d4)]('Payment\x20Status:',_0x36d364[_0x29c81d(0x1f1)]?.[_0x29c81d(0x1aa)]),console[_0x29c81d(0x1d4)](_0x29c81d(0x19d),_0x36d364[_0x29c81d(0x1f1)]?.[_0x29c81d(0x1c5)]),console[_0x29c81d(0x1d4)](_0x29c81d(0x200),_0x36d364[_0x29c81d(0x1f1)]?.[_0x29c81d(0x1cb)]);if(_0x36d364['result']!=='success'||_0x36d364[_0x29c81d(0x19e)]!==0xc8){const _0x478186=_0x36d364[_0x29c81d(0x1be)]||_0x29c81d(0x1b7);console[_0x29c81d(0x1e2)](_0x29c81d(0x1bf)),console['error'](_0x29c81d(0x1fb),_0x478186),loggerService_1['loggerService'][_0x29c81d(0x1d2)](_0x29c81d(0x1f5),'/status',_0x29c81d(0x1bd)+_0x478186);throw new Error(_0x29c81d(0x1e7)+_0x478186);}if(!_0x36d364[_0x29c81d(0x1f1)]){console[_0x29c81d(0x1e2)](_0x29c81d(0x20d)),console[_0x29c81d(0x1e2)](_0x29c81d(0x1f9)),loggerService_1[_0x29c81d(0x1a8)][_0x29c81d(0x1d2)](_0x29c81d(0x1f5),_0x29c81d(0x1b8),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x29c81d(0x1a5));}let _0x4ae7d0=_0x29c81d(0x1c3);switch(_0x36d364['data'][_0x29c81d(0x1aa)]?.['toLowerCase']()){case'paid':_0x4ae7d0=_0x29c81d(0x1d0);break;case _0x29c81d(0x18c):case _0x29c81d(0x197):case _0x29c81d(0x1e2):_0x4ae7d0=_0x29c81d(0x194);break;case _0x29c81d(0x196):case _0x29c81d(0x19f):_0x4ae7d0=_0x29c81d(0x1e8);break;case _0x29c81d(0x1fd):case _0x29c81d(0x1d3):case _0x29c81d(0x1e1):case'created':default:_0x4ae7d0='PENDING';break;}let _0x32ea1a,_0x1cda33;if(_0x36d364[_0x29c81d(0x1f1)][_0x29c81d(0x1cc)]){const _0x11271b=_0x36d364[_0x29c81d(0x1f1)]['PaymentDetail'];console[_0x29c81d(0x1d4)](_0x29c81d(0x1db),_0x11271b);const _0x413327=_0x11271b[_0x29c81d(0x1ec)](/IBAN\s+([A-Z0-9]+)/i);_0x413327&&(_0x32ea1a=_0x413327[0x1],console[_0x29c81d(0x1d4)](_0x29c81d(0x1ea),_0x32ea1a)),_0x1cda33=_0x11271b;}const _0x468def={'iban':_0x32ea1a,'bankDetails':_0x1cda33,'transactionId':_0x36d364[_0x29c81d(0x1f1)][_0x29c81d(0x1af)],'coinAddress':_0x36d364[_0x29c81d(0x1f1)][_0x29c81d(0x1c7)],'qrCodeUrl':_0x36d364[_0x29c81d(0x1f1)]['QRCodeURL'],'expiryTime':_0x36d364['data']['ExpiryTime'],'createdOn':_0x36d364['data'][_0x29c81d(0x1ee)],'confirmedOn':_0x36d364[_0x29c81d(0x1f1)][_0x29c81d(0x1f0)]};console[_0x29c81d(0x1d4)](_0x29c81d(0x1ba)),console[_0x29c81d(0x1d4)](_0x29c81d(0x208),_0x36d364[_0x29c81d(0x1f1)][_0x29c81d(0x1aa)],'->',_0x4ae7d0),console[_0x29c81d(0x1d4)](_0x29c81d(0x19d),_0x36d364[_0x29c81d(0x1f1)]['Amount'],_0x36d364['data']['inputCurrency']),console[_0x29c81d(0x1d4)](_0x29c81d(0x1d1),_0x36d364['data'][_0x29c81d(0x1af)]),console[_0x29c81d(0x1d4)](_0x29c81d(0x1ce),_0x32ea1a||'not\x20found'),console['log'](_0x29c81d(0x1ac),_0x36d364['data'][_0x29c81d(0x1ee)]),console['log'](_0x29c81d(0x1eb),_0x36d364[_0x29c81d(0x1f1)][_0x29c81d(0x1f0)]||_0x29c81d(0x1b3));if(_0x36d364['data'][_0x29c81d(0x1aa)]?.[_0x29c81d(0x1a9)]()===_0x29c81d(0x1d3))console['log'](_0x29c81d(0x19c));else _0x36d364[_0x29c81d(0x1f1)][_0x29c81d(0x1aa)]?.[_0x29c81d(0x1a9)]()===_0x29c81d(0x1ff)&&console['log'](_0x29c81d(0x19b));return{'status':_0x4ae7d0,'amount':parseFloat(_0x36d364[_0x29c81d(0x1f1)]['Amount'])||undefined,'currency':_0x36d364[_0x29c81d(0x1f1)][_0x29c81d(0x1cb)]||'EUR','paymentDetails':_0x468def};}catch(_0x419c8e){console[_0x29c81d(0x1e2)](_0x29c81d(0x1c4),_0x419c8e),loggerService_1[_0x29c81d(0x1a8)]['logWhiteDomainError'](_0x29c81d(0x1f5),'/status',_0x419c8e);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x419c8e instanceof Error?_0x419c8e[_0x29c81d(0x1be)]:'Unknown\x20error'));}}async[a41_0x2997c9(0x1a6)](_0x17039a){const _0x4e197a=a41_0x2997c9,_0x435a84=await this['checkPaymentStatus'](_0x17039a);return{'status':_0x435a84[_0x4e197a(0x191)],'amount':_0x435a84['amount'],'currency':_0x435a84['currency']};}async[a41_0x2997c9(0x1cd)](_0x586b90){const _0x52ae77=a41_0x2997c9;console['log'](_0x52ae77(0x1ed),_0x586b90);let _0xd13dff=_0x52ae77(0x1c3);switch(_0x586b90['status']?.[_0x52ae77(0x1a9)]()){case _0x52ae77(0x1ff):_0xd13dff=_0x52ae77(0x1d0);break;case _0x52ae77(0x18c):case'failed':case'error':_0xd13dff=_0x52ae77(0x194);break;case _0x52ae77(0x196):case'timeout':_0xd13dff=_0x52ae77(0x1e8);break;case _0x52ae77(0x1e1):case _0x52ae77(0x1fd):case _0x52ae77(0x1d3):case'created':default:_0xd13dff='PENDING';break;}return{'paymentId':_0x586b90[_0x52ae77(0x1a1)]||_0x586b90[_0x52ae77(0x18b)]||'','status':_0xd13dff,'amount':_0x586b90[_0x52ae77(0x1d8)],'currency':_0x586b90['currency']||_0x52ae77(0x1c2)};}}exports[a41_0x2997c9(0x190)]=CoinToPayService;function a41_0x3114(){const _0x411dd0=['PENDING','CoinToPay\x20payment\x20status\x20check\x20error:','Amount','entries','coinAddress','11293730RBNmVH','stringify','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','inputCurrency','PaymentDetail','processWebhook','IBAN:','24vbkKte','PAID','Transaction\x20ID:','logWhiteDomainError','awaiting\x20fiat','log','CoinToPay\x20API\x20error:\x20','276314aBkLlS','🪙\x20Creating\x20CoinToPay\x20payment:\x20','amount','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','payment_url','🏦\x20Payment\x20Detail:','defineProperty','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','27109780NGEEIj','Raw\x20Response\x20Body:','logWhiteDomainResponse','pending','error','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','text','Status\x20Text:','5720913EzSTGe','CoinToPay\x20status\x20API\x20error:\x20','EXPIRED','https://tesoft.uk/gateway/cointopay/','🏦\x20Extracted\x20IBAN:','Confirmed\x20On:','match','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','CreatedOn','Parsed\x20Result:','TransactionConfirmedOn','data','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Request\x20Body:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','cointopay','URL:','Gateway\x20Payment\x20ID:','__esModule','Missing\x20data\x20in\x20response','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Error\x20Message:','Status\x20Code:','waiting','HTTP\x20Status:','paid','Currency:','parse','headers','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Unknown\x20error\x20from\x20CoinToPay\x20API','checkPaymentStatus','Response\x20Body:','Status:','logWhiteDomainRequest','/create',',\x20body:\x20','8wzOvPs','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','2187416rqQcih','merchant_reference_id','cancelled','Business\x20Error:\x20','===\x20COINTOPAY\x20SUCCESS\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','CoinToPayService','status','application/json','Failed\x20to\x20parse\x20JSON\x20response:','FAILED','HTTP\x20error!\x20status:\x20','expired','failed','598745CLVwES','../loggerService','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Amount:','status_code','timeout','Error\x20details:','order_id','\x20EUR','Response\x20Time:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','verifyPayment','POST','loggerService','toLowerCase','Status','===\x20COINTOPAY\x20API\x20ERROR\x20===','Created\x20On:','createPaymentLink','Headers:','TransactionID','result','Payment\x20URL:','357160KCqFLC','not\x20confirmed','statusUrl','JSON\x20Parse\x20Error:\x20','TesSoft\x20Payment\x20System/1.0','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','/status','gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20stack:','Status\x20API\x20Error:\x20','message','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','6imUKbm','now','EUR'];a41_0x3114=function(){return _0x411dd0;};return a41_0x3114();}