'use strict';function a40_0x39b4(){const _0x2f412d=['/create','logWhiteDomainResponse','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Payment\x20Status:','fromEntries','PaymentDetail','3414YYkeHo','apiUrl','Result:','10zxQkKu','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','coinAddress','result','Payment\x20URL:','TesSoft\x20Payment\x20System/1.0','checkPaymentStatus','Status\x20Code:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','EXPIRED','now','CoinToPay\x20status\x20API\x20error:\x20','__esModule','failed','EUR','inputCurrency','Status\x20API\x20Error:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','defineProperty','üè¶\x20Payment\x20Detail:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','PENDING','expired','gateway_payment_id','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','stringify','Error\x20message:','https://tesoft.uk/gateway/cointopay/status.php',',\x20body:\x20','status_code','1118384AkTMqo','Status\x20Text:','cointopay','Response\x20Time:','71094sLqWsm','error','Error\x20Message:','loggerService','amount','FAILED','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','paid','1396139CUdhlM','POST','created','üìä\x20Status\x20check\x20URL:','awaiting\x20fiat','Business\x20Error:\x20','payment_url','HTTP\x20Status:','Response\x20Body:','application/json','Amount:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','19579780etBoCx','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Confirmed\x20On:','Status:','createPaymentLink','order_id','log','../loggerService','TransactionID','===\x20COINTOPAY\x20API\x20ERROR\x20===','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','12016640lxsSsO','Raw\x20Response\x20Body:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','https://tesoft.uk/gateway/cointopay/','Currency:','timeout','PAID','ExpiryTime','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','waiting','statusUrl','currency','207cgWyNj','pending','Created\x20On:','status','Error\x20stack:','CoinToPay\x20API\x20error:\x20','/status','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Request\x20Body:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','URL:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Status','2iclTYC','QRCodeURL','statusText','3073EbXGms','HTTP\x20error!\x20status:\x20','merchant_reference_id','text','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Gateway\x20Payment\x20ID:','message','toLowerCase','not\x20confirmed','HTTP\x20','match','JSON\x20Parse\x20Error:\x20','Amount','logWhiteDomainError','587490OlRsVZ','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Headers:','Missing\x20data\x20in\x20response','\x20EUR','parse','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','headers','CreatedOn','Unknown\x20error','logWhiteDomainRequest','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20details:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Parsed\x20Result:','TransactionConfirmedOn','cancelled','CoinToPayService','data','===\x20COINTOPAY\x20SUCCESS\x20==='];a40_0x39b4=function(){return _0x2f412d;};return a40_0x39b4();}const a40_0x4845e4=a40_0xceb5;function a40_0xceb5(_0x1e005e,_0x3ab95e){const _0x39b4ac=a40_0x39b4();return a40_0xceb5=function(_0xceb5a5,_0x337693){_0xceb5a5=_0xceb5a5-0x1b1;let _0x5df3a3=_0x39b4ac[_0xceb5a5];return _0x5df3a3;},a40_0xceb5(_0x1e005e,_0x3ab95e);}(function(_0x50be3e,_0x5adc14){const _0x165dc1=a40_0xceb5,_0x2e2b58=_0x50be3e();while(!![]){try{const _0x3cb47e=-parseInt(_0x165dc1(0x234))/0x1+-parseInt(_0x165dc1(0x1da))/0x2*(parseInt(_0x165dc1(0x22c))/0x3)+parseInt(_0x165dc1(0x228))/0x4*(parseInt(_0x165dc1(0x209))/0x5)+-parseInt(_0x165dc1(0x206))/0x6*(parseInt(_0x165dc1(0x1dd))/0x7)+parseInt(_0x165dc1(0x1c0))/0x8+parseInt(_0x165dc1(0x1cc))/0x9*(-parseInt(_0x165dc1(0x1eb))/0xa)+parseInt(_0x165dc1(0x1b5))/0xb;if(_0x3cb47e===_0x5adc14)break;else _0x2e2b58['push'](_0x2e2b58['shift']());}catch(_0x343a75){_0x2e2b58['push'](_0x2e2b58['shift']());}}}(a40_0x39b4,0xc84ad));Object[a40_0x4845e4(0x21c)](exports,a40_0x4845e4(0x215),{'value':!![]}),exports[a40_0x4845e4(0x1fd)]=void 0x0;const loggerService_1=require(a40_0x4845e4(0x1bc));class CoinToPayService{constructor(){const _0x22e75b=a40_0x4845e4;this[_0x22e75b(0x207)]=_0x22e75b(0x1c3),this[_0x22e75b(0x1ca)]=_0x22e75b(0x225),console[_0x22e75b(0x1bb)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log'](_0x22e75b(0x237),this['statusUrl']);}async[a40_0x4845e4(0x1b9)](_0x20d15f){const _0x498a3a=a40_0x4845e4,{orderId:_0x440fc0,amount:_0x591da4}=_0x20d15f;console[_0x498a3a(0x1bb)](_0x498a3a(0x1bf)+_0x591da4+_0x498a3a(0x1f0));const _0x238b34={'amount':_0x591da4},_0x30e45e=Date[_0x498a3a(0x213)]();try{console['log'](_0x498a3a(0x20a)),console[_0x498a3a(0x1bb)](_0x498a3a(0x1d6),this[_0x498a3a(0x207)]),console[_0x498a3a(0x1bb)](_0x498a3a(0x1d4),JSON[_0x498a3a(0x223)](_0x238b34,null,0x2)),console[_0x498a3a(0x1bb)](_0x498a3a(0x1b3),_0x591da4,_0x498a3a(0x1d5)),loggerService_1[_0x498a3a(0x22f)][_0x498a3a(0x1f6)](_0x498a3a(0x22a),_0x498a3a(0x200),'POST',_0x238b34);const _0x298a17=await fetch(this[_0x498a3a(0x207)],{'method':_0x498a3a(0x235),'headers':{'Content-Type':_0x498a3a(0x1b2),'Accept':_0x498a3a(0x1b2),'User-Agent':_0x498a3a(0x20e)},'body':JSON[_0x498a3a(0x223)](_0x238b34)}),_0x3c8a89=Date['now']()-_0x30e45e;console[_0x498a3a(0x1bb)](_0x498a3a(0x1c2)),console[_0x498a3a(0x1bb)](_0x498a3a(0x1b8),_0x298a17['status']),console[_0x498a3a(0x1bb)](_0x498a3a(0x229),_0x298a17[_0x498a3a(0x1dc)]),console[_0x498a3a(0x1bb)](_0x498a3a(0x1ee),Object[_0x498a3a(0x204)](_0x298a17[_0x498a3a(0x1f3)]['entries']())),console['log'](_0x498a3a(0x22b),_0x3c8a89+'ms');const _0x421c56=await _0x298a17[_0x498a3a(0x1e0)]();console[_0x498a3a(0x1bb)](_0x498a3a(0x1c1),_0x421c56);if(!_0x298a17['ok']){console[_0x498a3a(0x22d)](_0x498a3a(0x1be)),console[_0x498a3a(0x22d)](_0x498a3a(0x23b),_0x298a17[_0x498a3a(0x1cf)]),console[_0x498a3a(0x22d)](_0x498a3a(0x1b1),_0x421c56),loggerService_1[_0x498a3a(0x22f)][_0x498a3a(0x201)](_0x498a3a(0x22a),_0x498a3a(0x200),_0x298a17[_0x498a3a(0x1cf)],_0x421c56,_0x3c8a89),loggerService_1['loggerService']['logWhiteDomainError'](_0x498a3a(0x22a),'/create',_0x498a3a(0x1e6)+_0x298a17['status']+':\x20'+_0x421c56);throw new Error(_0x498a3a(0x1de)+_0x298a17[_0x498a3a(0x1cf)]+_0x498a3a(0x226)+_0x421c56);}let _0x4aa56d;try{_0x4aa56d=JSON[_0x498a3a(0x1f1)](_0x421c56);}catch(_0x86a6d6){console[_0x498a3a(0x22d)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x86a6d6),loggerService_1[_0x498a3a(0x22f)][_0x498a3a(0x1ea)](_0x498a3a(0x22a),_0x498a3a(0x200),_0x498a3a(0x1e8)+_0x86a6d6);throw new Error(_0x498a3a(0x202)+_0x421c56);}console[_0x498a3a(0x1bb)](_0x498a3a(0x1b4)),console[_0x498a3a(0x1bb)](_0x498a3a(0x1fa),JSON[_0x498a3a(0x223)](_0x4aa56d,null,0x2)),loggerService_1[_0x498a3a(0x22f)][_0x498a3a(0x201)](_0x498a3a(0x22a),'/create',_0x298a17['status'],_0x4aa56d,_0x3c8a89);if(_0x4aa56d['error']){const _0x122c28=_0x4aa56d[_0x498a3a(0x1e3)]||_0x4aa56d[_0x498a3a(0x22d)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x498a3a(0x22d)](_0x498a3a(0x21b)),console[_0x498a3a(0x22d)]('Error\x20Message:',_0x122c28),loggerService_1[_0x498a3a(0x22f)][_0x498a3a(0x1ea)]('cointopay','/create',_0x498a3a(0x239)+_0x122c28);throw new Error(_0x498a3a(0x1d1)+_0x122c28);}if(!_0x4aa56d['payment_url']||!_0x4aa56d[_0x498a3a(0x221)]){console[_0x498a3a(0x22d)](_0x498a3a(0x222)),console[_0x498a3a(0x22d)](_0x498a3a(0x1c8)),console[_0x498a3a(0x22d)]('Response\x20data:',_0x4aa56d),loggerService_1['loggerService'][_0x498a3a(0x1ea)](_0x498a3a(0x22a),_0x498a3a(0x200),_0x498a3a(0x1f7));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x498a3a(0x1bb)](_0x498a3a(0x1ff)),console[_0x498a3a(0x1bb)](_0x498a3a(0x1e2),_0x4aa56d[_0x498a3a(0x221)]),console[_0x498a3a(0x1bb)](_0x498a3a(0x20d),_0x4aa56d[_0x498a3a(0x23a)]),console[_0x498a3a(0x1bb)](_0x498a3a(0x1b3),_0x591da4,_0x498a3a(0x217)),{'gateway_payment_id':_0x4aa56d['gateway_payment_id'],'payment_url':_0x4aa56d[_0x498a3a(0x23a)]};}catch(_0x556977){console[_0x498a3a(0x22d)](_0x498a3a(0x1ec)),console[_0x498a3a(0x22d)](_0x498a3a(0x1f8),_0x556977),loggerService_1[_0x498a3a(0x22f)][_0x498a3a(0x1ea)](_0x498a3a(0x22a),_0x498a3a(0x200),_0x556977);if(_0x556977 instanceof Error){console['error'](_0x498a3a(0x224),_0x556977[_0x498a3a(0x1e3)]),console[_0x498a3a(0x22d)](_0x498a3a(0x1d0),_0x556977['stack']);throw new Error(_0x498a3a(0x1f2)+_0x556977['message']);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x3d7225){const _0x109134=a40_0x4845e4,_0x1bf8f6=Date[_0x109134(0x213)]();try{console[_0x109134(0x1bb)](_0x109134(0x1ed)+_0x3d7225);const _0x265b42={'gatewayPaymentId':_0x3d7225};loggerService_1[_0x109134(0x22f)]['logWhiteDomainRequest'](_0x109134(0x22a),_0x109134(0x1d2),_0x109134(0x235),_0x265b42);const _0x202e84=await fetch(this['statusUrl'],{'method':_0x109134(0x235),'headers':{'Content-Type':_0x109134(0x1b2),'Accept':'application/json','User-Agent':_0x109134(0x20e)},'body':JSON[_0x109134(0x223)](_0x265b42)}),_0x3d2620=Date[_0x109134(0x213)]()-_0x1bf8f6;console['log'](_0x109134(0x1d7)),console[_0x109134(0x1bb)]('Status:',_0x202e84[_0x109134(0x1cf)]),console[_0x109134(0x1bb)](_0x109134(0x22b),_0x3d2620+'ms');if(!_0x202e84['ok']){const _0x170644=await _0x202e84[_0x109134(0x1e0)]();console['error']('HTTP\x20Status:',_0x202e84['status']),console['error'](_0x109134(0x1b1),_0x170644),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x109134(0x22a),'/status',_0x202e84[_0x109134(0x1cf)],_0x170644,_0x3d2620),loggerService_1['loggerService'][_0x109134(0x1ea)](_0x109134(0x22a),_0x109134(0x1d2),_0x109134(0x1e6)+_0x202e84[_0x109134(0x1cf)]+':\x20'+_0x170644);throw new Error(_0x109134(0x1de)+_0x202e84['status']);}const _0x18f78a=await _0x202e84['text']();console[_0x109134(0x1bb)](_0x109134(0x1c1),_0x18f78a);let _0x454afb;try{_0x454afb=JSON[_0x109134(0x1f1)](_0x18f78a);}catch(_0x299ecd){console[_0x109134(0x22d)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x299ecd),loggerService_1[_0x109134(0x22f)][_0x109134(0x1ea)](_0x109134(0x22a),_0x109134(0x1d2),'JSON\x20Parse\x20Error:\x20'+_0x299ecd);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x18f78a);}loggerService_1[_0x109134(0x22f)][_0x109134(0x201)](_0x109134(0x22a),_0x109134(0x1d2),_0x202e84['status'],_0x454afb,_0x3d2620),console[_0x109134(0x1bb)](_0x109134(0x1b6)),console[_0x109134(0x1bb)](_0x109134(0x208),_0x454afb[_0x109134(0x20c)]),console[_0x109134(0x1bb)](_0x109134(0x210),_0x454afb['status_code']),console[_0x109134(0x1bb)](_0x109134(0x203),_0x454afb[_0x109134(0x1fe)]?.[_0x109134(0x1d9)]),console['log'](_0x109134(0x1b3),_0x454afb['data']?.['Amount']),console['log'](_0x109134(0x1c4),_0x454afb[_0x109134(0x1fe)]?.['inputCurrency']);if(_0x454afb[_0x109134(0x20c)]!=='success'||_0x454afb[_0x109134(0x227)]!==0xc8){const _0x4af1c3=_0x454afb[_0x109134(0x1e3)]||_0x109134(0x1d3);console[_0x109134(0x22d)](_0x109134(0x1e1)),console[_0x109134(0x22d)](_0x109134(0x22e),_0x4af1c3),loggerService_1['loggerService']['logWhiteDomainError'](_0x109134(0x22a),_0x109134(0x1d2),_0x109134(0x219)+_0x4af1c3);throw new Error(_0x109134(0x214)+_0x4af1c3);}if(!_0x454afb['data']){console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x109134(0x22d)](_0x109134(0x1ef)),loggerService_1['loggerService'][_0x109134(0x1ea)](_0x109134(0x22a),_0x109134(0x1d2),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x109134(0x211));}let _0x4a321f='PENDING';switch(_0x454afb[_0x109134(0x1fe)][_0x109134(0x1d9)]?.[_0x109134(0x1e4)]()){case _0x109134(0x233):_0x4a321f=_0x109134(0x1c6);break;case _0x109134(0x1fc):case _0x109134(0x216):case _0x109134(0x22d):_0x4a321f='FAILED';break;case _0x109134(0x220):case _0x109134(0x1c5):_0x4a321f=_0x109134(0x212);break;case _0x109134(0x1c9):case'awaiting\x20fiat':case _0x109134(0x1cd):case _0x109134(0x236):default:_0x4a321f='PENDING';break;}let _0x15a2d7,_0xbab442;if(_0x454afb['data'][_0x109134(0x205)]){const _0x2c6fcd=_0x454afb[_0x109134(0x1fe)][_0x109134(0x205)];console[_0x109134(0x1bb)](_0x109134(0x21d),_0x2c6fcd);const _0x44e670=_0x2c6fcd[_0x109134(0x1e7)](/IBAN\s+([A-Z0-9]+)/i);_0x44e670&&(_0x15a2d7=_0x44e670[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0x15a2d7)),_0xbab442=_0x2c6fcd;}const _0x34ae8e={'iban':_0x15a2d7,'bankDetails':_0xbab442,'transactionId':_0x454afb[_0x109134(0x1fe)][_0x109134(0x1bd)],'coinAddress':_0x454afb['data'][_0x109134(0x20b)],'qrCodeUrl':_0x454afb[_0x109134(0x1fe)][_0x109134(0x1db)],'expiryTime':_0x454afb['data'][_0x109134(0x1c7)],'createdOn':_0x454afb['data'][_0x109134(0x1f4)],'confirmedOn':_0x454afb[_0x109134(0x1fe)]['TransactionConfirmedOn']};console[_0x109134(0x1bb)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x109134(0x1bb)]('Status:',_0x454afb['data'][_0x109134(0x1d9)],'->',_0x4a321f),console[_0x109134(0x1bb)](_0x109134(0x1b3),_0x454afb[_0x109134(0x1fe)][_0x109134(0x1e9)],_0x454afb[_0x109134(0x1fe)][_0x109134(0x218)]),console[_0x109134(0x1bb)]('Transaction\x20ID:',_0x454afb[_0x109134(0x1fe)]['TransactionID']),console[_0x109134(0x1bb)]('IBAN:',_0x15a2d7||'not\x20found'),console[_0x109134(0x1bb)](_0x109134(0x1ce),_0x454afb['data']['CreatedOn']),console[_0x109134(0x1bb)](_0x109134(0x1b7),_0x454afb[_0x109134(0x1fe)][_0x109134(0x1fb)]||_0x109134(0x1e5));if(_0x454afb[_0x109134(0x1fe)][_0x109134(0x1d9)]?.[_0x109134(0x1e4)]()===_0x109134(0x238))console[_0x109134(0x1bb)](_0x109134(0x1f9));else _0x454afb[_0x109134(0x1fe)][_0x109134(0x1d9)]?.[_0x109134(0x1e4)]()===_0x109134(0x233)&&console['log'](_0x109134(0x21e));return{'status':_0x4a321f,'amount':parseFloat(_0x454afb[_0x109134(0x1fe)]['Amount'])||undefined,'currency':_0x454afb[_0x109134(0x1fe)][_0x109134(0x218)]||_0x109134(0x217),'paymentDetails':_0x34ae8e};}catch(_0x574684){console[_0x109134(0x22d)](_0x109134(0x21a),_0x574684),loggerService_1['loggerService'][_0x109134(0x1ea)]('cointopay',_0x109134(0x1d2),_0x574684);throw new Error(_0x109134(0x1d8)+(_0x574684 instanceof Error?_0x574684[_0x109134(0x1e3)]:_0x109134(0x1f5)));}}async['verifyPayment'](_0x48f30d){const _0x4a6164=a40_0x4845e4,_0x2910ba=await this[_0x4a6164(0x20f)](_0x48f30d);return{'status':_0x2910ba['status'],'amount':_0x2910ba[_0x4a6164(0x230)],'currency':_0x2910ba[_0x4a6164(0x1cb)]};}async['processWebhook'](_0x436dcf){const _0x2b8893=a40_0x4845e4;console[_0x2b8893(0x1bb)](_0x2b8893(0x232),_0x436dcf);let _0x5e961c='PENDING';switch(_0x436dcf['status']?.[_0x2b8893(0x1e4)]()){case _0x2b8893(0x233):_0x5e961c=_0x2b8893(0x1c6);break;case _0x2b8893(0x1fc):case'failed':case _0x2b8893(0x22d):_0x5e961c=_0x2b8893(0x231);break;case _0x2b8893(0x220):case _0x2b8893(0x1c5):_0x5e961c=_0x2b8893(0x212);break;case'pending':case _0x2b8893(0x1c9):case _0x2b8893(0x238):case _0x2b8893(0x236):default:_0x5e961c=_0x2b8893(0x21f);break;}return{'paymentId':_0x436dcf[_0x2b8893(0x1ba)]||_0x436dcf[_0x2b8893(0x1df)]||'','status':_0x5e961c,'amount':_0x436dcf[_0x2b8893(0x230)],'currency':_0x436dcf[_0x2b8893(0x1cb)]||_0x2b8893(0x217)};}}exports['CoinToPayService']=CoinToPayService;