'use strict';const a38_0x1dde2a=a38_0x15dd;function a38_0x15dd(_0x2abde3,_0x5b05b2){const _0x326937=a38_0x3269();return a38_0x15dd=function(_0x15ddd5,_0x1fe492){_0x15ddd5=_0x15ddd5-0xf6;let _0x374a84=_0x326937[_0x15ddd5];return _0x374a84;},a38_0x15dd(_0x2abde3,_0x5b05b2);}function a38_0x3269(){const _0x28bb76=['logWhiteDomainRequest','525HOLVUN','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','HTTP\x20','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','match','Missing\x20data\x20in\x20response','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Response\x20data:','processWebhook','===\x20COINTOPAY\x20SUCCESS\x20===','434Eazrva','coinAddress','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','CreatedOn','Status\x20Code:','now','446748GdiYLB','amount','Result:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','TransactionID','created','Business\x20Error:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','CoinToPay\x20API\x20error:\x20','\x20EUR','paid','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','EXPIRED','Gateway\x20Payment\x20ID:','apiUrl','order_id','inputCurrency','Status:','log','/status','Amount','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','data','success','payment_url','Error\x20stack:','Error\x20details:','loggerService','608105awtWeb','Response\x20Time:','statusUrl','Status\x20Text:','Amount:','currency','../loggerService','POST','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Raw\x20Response\x20Body:','JSON\x20Parse\x20Error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','waiting','failed','not\x20confirmed','result','https://tesoft.uk/gateway/cointopay/status.php','pending','EUR','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Request\x20Body:','Failed\x20to\x20parse\x20JSON\x20response:','toLowerCase','entries','Error\x20Message:','logWhiteDomainResponse','HTTP\x20error!\x20status:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','status','IBAN:','cancelled','cointopay','Status\x20API\x20Error:\x20','PAID','gateway_payment_id','402339frQAUq','checkPaymentStatus','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','text','198297jcSKig','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','PENDING','not\x20found','QRCodeURL','expired','createPaymentLink','__esModule','ðŸ“Š\x20Status\x20check\x20URL:','awaiting\x20fiat','40GysBzO','Payment\x20URL:',',\x20body:\x20','stringify','1289QSixyF','error','merchant_reference_id','CoinToPayService','TesSoft\x20Payment\x20System/1.0','stack','https://tesoft.uk/gateway/cointopay/','logWhiteDomainError','CoinToPay\x20payment\x20status\x20check\x20error:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','PaymentDetail','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','parse','FAILED','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY\x20API\x20ERROR\x20===','Currency:','/create','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','statusText','1359FUlYyH','Status','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Parsed\x20Result:','application/json','message','Payment\x20Status:','TransactionConfirmedOn','14408dIazAi','ExpiryTime','12792SqZuQT','defineProperty','status_code'];a38_0x3269=function(){return _0x28bb76;};return a38_0x3269();}(function(_0x49a1cd,_0x111154){const _0x51631f=a38_0x15dd,_0x1d9ec8=_0x49a1cd();while(!![]){try{const _0x1c08a2=parseInt(_0x51631f(0x12c))/0x1*(parseInt(_0x51631f(0x15b))/0x2)+parseInt(_0x51631f(0x11a))/0x3+parseInt(_0x51631f(0x161))/0x4+parseInt(_0x51631f(0xf7))/0x5+-parseInt(_0x51631f(0x14d))/0x6*(parseInt(_0x51631f(0x151))/0x7)+-parseInt(_0x51631f(0x14b))/0x8*(parseInt(_0x51631f(0x141))/0x9)+-parseInt(_0x51631f(0x128))/0xa*(parseInt(_0x51631f(0x11e))/0xb);if(_0x1c08a2===_0x111154)break;else _0x1d9ec8['push'](_0x1d9ec8['shift']());}catch(_0x337428){_0x1d9ec8['push'](_0x1d9ec8['shift']());}}}(a38_0x3269,0x22f47));Object[a38_0x1dde2a(0x14e)](exports,a38_0x1dde2a(0x125),{'value':!![]}),exports[a38_0x1dde2a(0x12f)]=void 0x0;const loggerService_1=require(a38_0x1dde2a(0xfd));class CoinToPayService{constructor(){const _0x60276d=a38_0x1dde2a;this['apiUrl']=_0x60276d(0x132),this[_0x60276d(0xf9)]=_0x60276d(0x107),console['log'](_0x60276d(0x152)),console[_0x60276d(0x173)](_0x60276d(0x126),this[_0x60276d(0xf9)]);}async[a38_0x1dde2a(0x124)](_0x54589f){const _0x336703=a38_0x1dde2a,{orderId:_0x599bf7,amount:_0x34a164}=_0x54589f;console[_0x336703(0x173)](_0x336703(0x11f)+_0x34a164+_0x336703(0x16a));const _0x493ae9={'amount':_0x34a164},_0x3c0f5d=Date[_0x336703(0x160)]();try{console[_0x336703(0x173)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x336703(0x173)]('URL:',this[_0x336703(0x16f)]),console['log'](_0x336703(0x10b),JSON[_0x336703(0x12b)](_0x493ae9,null,0x2)),console[_0x336703(0x173)]('Amount:',_0x34a164,_0x336703(0x176)),loggerService_1[_0x336703(0xf6)][_0x336703(0x150)]('cointopay',_0x336703(0x13d),_0x336703(0xfe),_0x493ae9);const _0x2a0778=await fetch(this[_0x336703(0x16f)],{'method':_0x336703(0xfe),'headers':{'Content-Type':_0x336703(0x147),'Accept':'application/json','User-Agent':_0x336703(0x130)},'body':JSON[_0x336703(0x12b)](_0x493ae9)}),_0x588587=Date['now']()-_0x3c0f5d;console[_0x336703(0x173)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x336703(0x172),_0x2a0778[_0x336703(0x113)]),console['log'](_0x336703(0xfa),_0x2a0778[_0x336703(0x140)]),console[_0x336703(0x173)]('Headers:',Object['fromEntries'](_0x2a0778['headers'][_0x336703(0x10e)]())),console['log']('Response\x20Time:',_0x588587+'ms');const _0x4036ac=await _0x2a0778[_0x336703(0x11d)]();console['log'](_0x336703(0x100),_0x4036ac);if(!_0x2a0778['ok']){console[_0x336703(0x12d)](_0x336703(0x13b)),console['error']('HTTP\x20Status:',_0x2a0778[_0x336703(0x113)]),console[_0x336703(0x12d)]('Response\x20Body:',_0x4036ac),loggerService_1[_0x336703(0xf6)][_0x336703(0x110)]('cointopay',_0x336703(0x13d),_0x2a0778[_0x336703(0x113)],_0x4036ac,_0x588587),loggerService_1[_0x336703(0xf6)][_0x336703(0x133)](_0x336703(0x116),_0x336703(0x13d),_0x336703(0x153)+_0x2a0778[_0x336703(0x113)]+':\x20'+_0x4036ac);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2a0778[_0x336703(0x113)]+_0x336703(0x12a)+_0x4036ac);}let _0x158e2f;try{_0x158e2f=JSON[_0x336703(0x138)](_0x4036ac);}catch(_0x1bf0d8){console[_0x336703(0x12d)](_0x336703(0x10c),_0x1bf0d8),loggerService_1[_0x336703(0xf6)][_0x336703(0x133)](_0x336703(0x116),_0x336703(0x13d),'JSON\x20Parse\x20Error:\x20'+_0x1bf0d8);throw new Error(_0x336703(0x112)+_0x4036ac);}console[_0x336703(0x173)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x336703(0x173)](_0x336703(0x146),JSON['stringify'](_0x158e2f,null,0x2)),loggerService_1['loggerService'][_0x336703(0x110)](_0x336703(0x116),'/create',_0x2a0778[_0x336703(0x113)],_0x158e2f,_0x588587);if(_0x158e2f[_0x336703(0x12d)]){const _0x15b39e=_0x158e2f[_0x336703(0x148)]||_0x158e2f[_0x336703(0x12d)]||_0x336703(0x102);console[_0x336703(0x12d)](_0x336703(0x168)),console[_0x336703(0x12d)](_0x336703(0x10f),_0x15b39e),loggerService_1['loggerService'][_0x336703(0x133)](_0x336703(0x116),'/create',_0x336703(0x167)+_0x15b39e);throw new Error(_0x336703(0x169)+_0x15b39e);}if(!_0x158e2f[_0x336703(0x17b)]||!_0x158e2f[_0x336703(0x119)]){console[_0x336703(0x12d)](_0x336703(0x154)),console[_0x336703(0x12d)](_0x336703(0x145)),console[_0x336703(0x12d)](_0x336703(0x158),_0x158e2f),loggerService_1[_0x336703(0xf6)][_0x336703(0x133)]('cointopay',_0x336703(0x13d),_0x336703(0x137));throw new Error(_0x336703(0xff));}return console[_0x336703(0x173)](_0x336703(0x15a)),console[_0x336703(0x173)](_0x336703(0x16e),_0x158e2f[_0x336703(0x119)]),console[_0x336703(0x173)](_0x336703(0x129),_0x158e2f[_0x336703(0x17b)]),console[_0x336703(0x173)](_0x336703(0xfb),_0x34a164,_0x336703(0x109)),{'gateway_payment_id':_0x158e2f['gateway_payment_id'],'payment_url':_0x158e2f['payment_url']};}catch(_0x136dc5){console['error'](_0x336703(0x177)),console['error'](_0x336703(0x17d),_0x136dc5),loggerService_1[_0x336703(0xf6)]['logWhiteDomainError'](_0x336703(0x116),_0x336703(0x13d),_0x136dc5);if(_0x136dc5 instanceof Error){console[_0x336703(0x12d)]('Error\x20message:',_0x136dc5[_0x336703(0x148)]),console['error'](_0x336703(0x17c),_0x136dc5[_0x336703(0x131)]);throw new Error(_0x336703(0x16c)+_0x136dc5[_0x336703(0x148)]);}throw new Error(_0x336703(0x178));}}async[a38_0x1dde2a(0x11b)](_0x125034){const _0x242df1=a38_0x1dde2a,_0xae5d64=Date[_0x242df1(0x160)]();try{console[_0x242df1(0x173)](_0x242df1(0x11c)+_0x125034);const _0x2fd31a={'gatewayPaymentId':_0x125034};loggerService_1[_0x242df1(0xf6)]['logWhiteDomainRequest'](_0x242df1(0x116),_0x242df1(0x174),_0x242df1(0xfe),_0x2fd31a);const _0x318c29=await fetch(this[_0x242df1(0xf9)],{'method':'POST','headers':{'Content-Type':_0x242df1(0x147),'Accept':_0x242df1(0x147),'User-Agent':_0x242df1(0x130)},'body':JSON[_0x242df1(0x12b)](_0x2fd31a)}),_0x59df5c=Date['now']()-_0xae5d64;console[_0x242df1(0x173)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x242df1(0x173)](_0x242df1(0x172),_0x318c29[_0x242df1(0x113)]),console[_0x242df1(0x173)](_0x242df1(0xf8),_0x59df5c+'ms');if(!_0x318c29['ok']){const _0x2f027e=await _0x318c29['text']();console[_0x242df1(0x12d)]('HTTP\x20Status:',_0x318c29['status']),console[_0x242df1(0x12d)]('Response\x20Body:',_0x2f027e),loggerService_1['loggerService'][_0x242df1(0x110)](_0x242df1(0x116),_0x242df1(0x174),_0x318c29[_0x242df1(0x113)],_0x2f027e,_0x59df5c),loggerService_1['loggerService'][_0x242df1(0x133)](_0x242df1(0x116),_0x242df1(0x174),_0x242df1(0x153)+_0x318c29[_0x242df1(0x113)]+':\x20'+_0x2f027e);throw new Error(_0x242df1(0x111)+_0x318c29[_0x242df1(0x113)]);}const _0x3527aa=await _0x318c29[_0x242df1(0x11d)]();console[_0x242df1(0x173)](_0x242df1(0x100),_0x3527aa);let _0x534053;try{_0x534053=JSON[_0x242df1(0x138)](_0x3527aa);}catch(_0x385a4c){console[_0x242df1(0x12d)](_0x242df1(0x10c),_0x385a4c),loggerService_1[_0x242df1(0xf6)]['logWhiteDomainError'](_0x242df1(0x116),_0x242df1(0x174),_0x242df1(0x101)+_0x385a4c);throw new Error(_0x242df1(0x13f)+_0x3527aa);}loggerService_1[_0x242df1(0xf6)]['logWhiteDomainResponse'](_0x242df1(0x116),'/status',_0x318c29[_0x242df1(0x113)],_0x534053,_0x59df5c),console[_0x242df1(0x173)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x242df1(0x173)](_0x242df1(0x163),_0x534053['result']),console[_0x242df1(0x173)](_0x242df1(0x15f),_0x534053['status_code']),console['log'](_0x242df1(0x149),_0x534053[_0x242df1(0x179)]?.[_0x242df1(0x142)]),console[_0x242df1(0x173)](_0x242df1(0xfb),_0x534053[_0x242df1(0x179)]?.[_0x242df1(0x175)]),console[_0x242df1(0x173)](_0x242df1(0x13c),_0x534053['data']?.[_0x242df1(0x171)]);if(_0x534053[_0x242df1(0x106)]!==_0x242df1(0x17a)||_0x534053[_0x242df1(0x14f)]!==0xc8){const _0x25f10f=_0x534053[_0x242df1(0x148)]||_0x242df1(0x144);console['error'](_0x242df1(0x164)),console['error'](_0x242df1(0x10f),_0x25f10f),loggerService_1[_0x242df1(0xf6)][_0x242df1(0x133)](_0x242df1(0x116),'/status',_0x242df1(0x117)+_0x25f10f);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x25f10f);}if(!_0x534053[_0x242df1(0x179)]){console['error'](_0x242df1(0x13e)),console[_0x242df1(0x12d)](_0x242df1(0x156)),loggerService_1[_0x242df1(0xf6)][_0x242df1(0x133)](_0x242df1(0x116),_0x242df1(0x174),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x242df1(0x157));}let _0x5af523=_0x242df1(0x120);switch(_0x534053[_0x242df1(0x179)][_0x242df1(0x142)]?.[_0x242df1(0x10d)]()){case _0x242df1(0x16b):_0x5af523='PAID';break;case _0x242df1(0x115):case _0x242df1(0x104):case _0x242df1(0x12d):_0x5af523=_0x242df1(0x139);break;case _0x242df1(0x123):case'timeout':_0x5af523=_0x242df1(0x16d);break;case _0x242df1(0x103):case _0x242df1(0x127):case'pending':case'created':default:_0x5af523='PENDING';break;}let _0x31c589,_0x321525;if(_0x534053[_0x242df1(0x179)][_0x242df1(0x136)]){const _0x5e3154=_0x534053[_0x242df1(0x179)][_0x242df1(0x136)];console[_0x242df1(0x173)]('ðŸ¦\x20Payment\x20Detail:',_0x5e3154);const _0x57092d=_0x5e3154[_0x242df1(0x155)](/IBAN\s+([A-Z0-9]+)/i);_0x57092d&&(_0x31c589=_0x57092d[0x1],console[_0x242df1(0x173)]('ðŸ¦\x20Extracted\x20IBAN:',_0x31c589)),_0x321525=_0x5e3154;}const _0x3e9a9f={'iban':_0x31c589,'bankDetails':_0x321525,'transactionId':_0x534053['data'][_0x242df1(0x165)],'coinAddress':_0x534053[_0x242df1(0x179)][_0x242df1(0x15c)],'qrCodeUrl':_0x534053['data'][_0x242df1(0x122)],'expiryTime':_0x534053['data'][_0x242df1(0x14c)],'createdOn':_0x534053[_0x242df1(0x179)][_0x242df1(0x15e)],'confirmedOn':_0x534053[_0x242df1(0x179)][_0x242df1(0x14a)]};console[_0x242df1(0x173)](_0x242df1(0x10a)),console[_0x242df1(0x173)](_0x242df1(0x172),_0x534053['data'][_0x242df1(0x142)],'->',_0x5af523),console[_0x242df1(0x173)](_0x242df1(0xfb),_0x534053[_0x242df1(0x179)][_0x242df1(0x175)],_0x534053['data'][_0x242df1(0x171)]),console[_0x242df1(0x173)]('Transaction\x20ID:',_0x534053[_0x242df1(0x179)]['TransactionID']),console['log'](_0x242df1(0x114),_0x31c589||_0x242df1(0x121)),console[_0x242df1(0x173)]('Created\x20On:',_0x534053[_0x242df1(0x179)][_0x242df1(0x15e)]),console[_0x242df1(0x173)]('Confirmed\x20On:',_0x534053[_0x242df1(0x179)]['TransactionConfirmedOn']||_0x242df1(0x105));if(_0x534053[_0x242df1(0x179)][_0x242df1(0x142)]?.[_0x242df1(0x10d)]()==='awaiting\x20fiat')console[_0x242df1(0x173)](_0x242df1(0x143));else _0x534053[_0x242df1(0x179)][_0x242df1(0x142)]?.['toLowerCase']()===_0x242df1(0x16b)&&console['log'](_0x242df1(0x15d));return{'status':_0x5af523,'amount':parseFloat(_0x534053[_0x242df1(0x179)][_0x242df1(0x175)])||undefined,'currency':_0x534053[_0x242df1(0x179)][_0x242df1(0x171)]||_0x242df1(0x109),'paymentDetails':_0x3e9a9f};}catch(_0x42157f){console[_0x242df1(0x12d)](_0x242df1(0x134),_0x42157f),loggerService_1[_0x242df1(0xf6)]['logWhiteDomainError'](_0x242df1(0x116),'/status',_0x42157f);throw new Error(_0x242df1(0x135)+(_0x42157f instanceof Error?_0x42157f['message']:'Unknown\x20error'));}}async['verifyPayment'](_0xbc1c5a){const _0x639597=a38_0x1dde2a,_0x1b69c9=await this[_0x639597(0x11b)](_0xbc1c5a);return{'status':_0x1b69c9[_0x639597(0x113)],'amount':_0x1b69c9[_0x639597(0x162)],'currency':_0x1b69c9['currency']};}async[a38_0x1dde2a(0x159)](_0x83a5d2){const _0x5364be=a38_0x1dde2a;console[_0x5364be(0x173)](_0x5364be(0x13a),_0x83a5d2);let _0x5069ba='PENDING';switch(_0x83a5d2[_0x5364be(0x113)]?.[_0x5364be(0x10d)]()){case _0x5364be(0x16b):_0x5069ba=_0x5364be(0x118);break;case _0x5364be(0x115):case _0x5364be(0x104):case _0x5364be(0x12d):_0x5069ba=_0x5364be(0x139);break;case'expired':case'timeout':_0x5069ba=_0x5364be(0x16d);break;case _0x5364be(0x108):case _0x5364be(0x103):case _0x5364be(0x127):case _0x5364be(0x166):default:_0x5069ba=_0x5364be(0x120);break;}return{'paymentId':_0x83a5d2[_0x5364be(0x170)]||_0x83a5d2[_0x5364be(0x12e)]||'','status':_0x5069ba,'amount':_0x83a5d2[_0x5364be(0x162)],'currency':_0x83a5d2[_0x5364be(0xfc)]||_0x5364be(0x109)};}}exports['CoinToPayService']=CoinToPayService;