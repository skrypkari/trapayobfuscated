'use strict';const a38_0x5b74b8=a38_0x6967;(function(_0x177496,_0xf4738f){const _0x485faf=a38_0x6967,_0x3060bb=_0x177496();while(!![]){try{const _0x8fb0c1=-parseInt(_0x485faf(0xaa))/0x1*(parseInt(_0x485faf(0x10b))/0x2)+-parseInt(_0x485faf(0x110))/0x3+-parseInt(_0x485faf(0x10a))/0x4*(parseInt(_0x485faf(0x116))/0x5)+parseInt(_0x485faf(0x101))/0x6*(-parseInt(_0x485faf(0x9f))/0x7)+parseInt(_0x485faf(0x117))/0x8*(-parseInt(_0x485faf(0xc3))/0x9)+-parseInt(_0x485faf(0xfc))/0xa*(parseInt(_0x485faf(0xb2))/0xb)+parseInt(_0x485faf(0xb6))/0xc;if(_0x8fb0c1===_0xf4738f)break;else _0x3060bb['push'](_0x3060bb['shift']());}catch(_0x313b98){_0x3060bb['push'](_0x3060bb['shift']());}}}(a38_0x5b02,0x243be));Object[a38_0x5b74b8(0xf0)](exports,'__esModule',{'value':!![]}),exports[a38_0x5b74b8(0xe4)]=void 0x0;const loggerService_1=require(a38_0x5b74b8(0xbd));function a38_0x6967(_0x4fd1c2,_0x1cce19){const _0x5b02cd=a38_0x5b02();return a38_0x6967=function(_0x6967ea,_0x2ad3a1){_0x6967ea=_0x6967ea-0x9f;let _0x508cfb=_0x5b02cd[_0x6967ea];return _0x508cfb;},a38_0x6967(_0x4fd1c2,_0x1cce19);}class CoinToPayService{constructor(){const _0x1331bc=a38_0x5b74b8;this[_0x1331bc(0x113)]='https://tesoft.uk/gateway/cointopay/',this[_0x1331bc(0x11d)]=_0x1331bc(0x114),console[_0x1331bc(0xda)](_0x1331bc(0x102)),console[_0x1331bc(0xda)](_0x1331bc(0xe6),this[_0x1331bc(0x11d)]);}async[a38_0x5b74b8(0xcf)](_0x1c94c9){const _0xa068a=a38_0x5b74b8,{orderId:_0x1bac73,amount:_0x2d12d9}=_0x1c94c9;console[_0xa068a(0xda)](_0xa068a(0xf9)+_0x2d12d9+'\x20EUR');const _0x4d6c62={'amount':_0x2d12d9},_0x5f18c6=Date[_0xa068a(0xf8)]();try{console[_0xa068a(0xda)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0xa068a(0xda)](_0xa068a(0xb4),this[_0xa068a(0x113)]),console[_0xa068a(0xda)](_0xa068a(0xdc),JSON[_0xa068a(0xfa)](_0x4d6c62,null,0x2)),console[_0xa068a(0xda)](_0xa068a(0xa5),_0x2d12d9,_0xa068a(0x103)),loggerService_1['loggerService'][_0xa068a(0xe3)](_0xa068a(0x11b),_0xa068a(0x11a),'POST',_0x4d6c62);const _0x2112cb=await fetch(this[_0xa068a(0x113)],{'method':_0xa068a(0xdf),'headers':{'Content-Type':_0xa068a(0xfe),'Accept':_0xa068a(0xfe),'User-Agent':_0xa068a(0xc9)},'body':JSON[_0xa068a(0xfa)](_0x4d6c62)}),_0x2365c8=Date['now']()-_0x5f18c6;console[_0xa068a(0xda)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0xa068a(0xda)](_0xa068a(0xbe),_0x2112cb['status']),console[_0xa068a(0xda)]('Status\x20Text:',_0x2112cb['statusText']),console[_0xa068a(0xda)]('Headers:',Object[_0xa068a(0xf4)](_0x2112cb[_0xa068a(0x108)]['entries']())),console[_0xa068a(0xda)]('Response\x20Time:',_0x2365c8+'ms');const _0x309211=await _0x2112cb['text']();console[_0xa068a(0xda)](_0xa068a(0x115),_0x309211);if(!_0x2112cb['ok']){console[_0xa068a(0x109)](_0xa068a(0xa9)),console[_0xa068a(0x109)]('HTTP\x20Status:',_0x2112cb[_0xa068a(0xa6)]),console[_0xa068a(0x109)](_0xa068a(0xb3),_0x309211),loggerService_1[_0xa068a(0xd6)]['logWhiteDomainResponse']('cointopay',_0xa068a(0x11a),_0x2112cb[_0xa068a(0xa6)],_0x309211,_0x2365c8),loggerService_1[_0xa068a(0xd6)][_0xa068a(0xad)](_0xa068a(0x11b),_0xa068a(0x11a),_0xa068a(0x122)+_0x2112cb[_0xa068a(0xa6)]+':\x20'+_0x309211);throw new Error(_0xa068a(0xce)+_0x2112cb[_0xa068a(0xa6)]+_0xa068a(0xc0)+_0x309211);}let _0x248b6d;try{_0x248b6d=JSON[_0xa068a(0xd2)](_0x309211);}catch(_0x14db00){console['error'](_0xa068a(0xb1),_0x14db00),loggerService_1['loggerService']['logWhiteDomainError'](_0xa068a(0x11b),_0xa068a(0x11a),_0xa068a(0x121)+_0x14db00);throw new Error(_0xa068a(0xb0)+_0x309211);}console[_0xa068a(0xda)](_0xa068a(0x106)),console[_0xa068a(0xda)](_0xa068a(0xcb),JSON[_0xa068a(0xfa)](_0x248b6d,null,0x2)),loggerService_1[_0xa068a(0xd6)][_0xa068a(0xb8)](_0xa068a(0x11b),'/create',_0x2112cb['status'],_0x248b6d,_0x2365c8);if(_0x248b6d['error']){const _0xa5ba4a=_0x248b6d[_0xa068a(0xab)]||_0x248b6d['error']||_0xa068a(0xd5);console[_0xa068a(0x109)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0xa068a(0x109)](_0xa068a(0x104),_0xa5ba4a),loggerService_1[_0xa068a(0xd6)]['logWhiteDomainError'](_0xa068a(0x11b),_0xa068a(0x11a),_0xa068a(0xbb)+_0xa5ba4a);throw new Error(_0xa068a(0xfd)+_0xa5ba4a);}if(!_0x248b6d[_0xa068a(0xef)]||!_0x248b6d[_0xa068a(0xe8)]){console['error'](_0xa068a(0xdd)),console[_0xa068a(0x109)](_0xa068a(0x105)),console[_0xa068a(0x109)]('Response\x20data:',_0x248b6d),loggerService_1[_0xa068a(0xd6)][_0xa068a(0xad)](_0xa068a(0x11b),'/create',_0xa068a(0x112));throw new Error(_0xa068a(0xe7));}return console[_0xa068a(0xda)](_0xa068a(0xc4)),console['log'](_0xa068a(0x107),_0x248b6d[_0xa068a(0xe8)]),console[_0xa068a(0xda)]('Payment\x20URL:',_0x248b6d[_0xa068a(0xef)]),console[_0xa068a(0xda)](_0xa068a(0xa5),_0x2d12d9,_0xa068a(0xcc)),{'gateway_payment_id':_0x248b6d['gateway_payment_id'],'payment_url':_0x248b6d[_0xa068a(0xef)]};}catch(_0x2ee0df){console[_0xa068a(0x109)](_0xa068a(0xf5)),console[_0xa068a(0x109)](_0xa068a(0xf7),_0x2ee0df),loggerService_1[_0xa068a(0xd6)][_0xa068a(0xad)](_0xa068a(0x11b),_0xa068a(0x11a),_0x2ee0df);if(_0x2ee0df instanceof Error){console['error'](_0xa068a(0xe1),_0x2ee0df[_0xa068a(0xab)]),console['error'](_0xa068a(0xe5),_0x2ee0df[_0xa068a(0x100)]);throw new Error(_0xa068a(0xac)+_0x2ee0df['message']);}throw new Error(_0xa068a(0xb9));}}async['checkPaymentStatus'](_0x37904b){const _0x524c08=a38_0x5b74b8,_0x44c0b6=Date['now']();try{console[_0x524c08(0xda)](_0x524c08(0xeb)+_0x37904b);const _0x574cea={'gatewayPaymentId':_0x37904b};loggerService_1[_0x524c08(0xd6)]['logWhiteDomainRequest'](_0x524c08(0x11b),_0x524c08(0xee),_0x524c08(0xdf),_0x574cea);const _0x2188f3=await fetch(this[_0x524c08(0x11d)],{'method':_0x524c08(0xdf),'headers':{'Content-Type':_0x524c08(0xfe),'Accept':'application/json','User-Agent':_0x524c08(0xc9)},'body':JSON[_0x524c08(0xfa)](_0x574cea)}),_0x370142=Date['now']()-_0x44c0b6;console[_0x524c08(0xda)](_0x524c08(0xea)),console[_0x524c08(0xda)](_0x524c08(0xbe),_0x2188f3[_0x524c08(0xa6)]),console[_0x524c08(0xda)](_0x524c08(0x120),_0x370142+'ms');if(!_0x2188f3['ok']){const _0x39d454=await _0x2188f3[_0x524c08(0xbc)]();console[_0x524c08(0x109)](_0x524c08(0xb7),_0x2188f3[_0x524c08(0xa6)]),console['error']('Response\x20Body:',_0x39d454),loggerService_1[_0x524c08(0xd6)][_0x524c08(0xb8)](_0x524c08(0x11b),'/status',_0x2188f3[_0x524c08(0xa6)],_0x39d454,_0x370142),loggerService_1[_0x524c08(0xd6)][_0x524c08(0xad)](_0x524c08(0x11b),_0x524c08(0xee),_0x524c08(0x122)+_0x2188f3['status']+':\x20'+_0x39d454);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2188f3[_0x524c08(0xa6)]);}const _0x47a3f1=await _0x2188f3[_0x524c08(0xbc)]();console['log'](_0x524c08(0x115),_0x47a3f1);let _0x10571b;try{_0x10571b=JSON['parse'](_0x47a3f1);}catch(_0x4279cb){console['error'](_0x524c08(0xb1),_0x4279cb),loggerService_1['loggerService'][_0x524c08(0xad)](_0x524c08(0x11b),_0x524c08(0xee),_0x524c08(0x121)+_0x4279cb);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x47a3f1);}loggerService_1[_0x524c08(0xd6)][_0x524c08(0xb8)]('cointopay',_0x524c08(0xee),_0x2188f3[_0x524c08(0xa6)],_0x10571b,_0x370142),console['log'](_0x524c08(0xb5)),console[_0x524c08(0xda)](_0x524c08(0xa2),_0x10571b[_0x524c08(0xed)]),console['log']('Status\x20Code:',_0x10571b[_0x524c08(0xec)]),console['log'](_0x524c08(0xf2),_0x10571b[_0x524c08(0xe0)]?.[_0x524c08(0x10f)]),console[_0x524c08(0xda)](_0x524c08(0xa5),_0x10571b[_0x524c08(0xe0)]?.[_0x524c08(0xfb)]),console['log'](_0x524c08(0xa3),_0x10571b[_0x524c08(0xe0)]?.[_0x524c08(0xc8)]);if(_0x10571b[_0x524c08(0xed)]!=='success'||_0x10571b['status_code']!==0xc8){const _0x3e9104=_0x10571b[_0x524c08(0xab)]||_0x524c08(0xdb);console[_0x524c08(0x109)](_0x524c08(0x111)),console['error']('Error\x20Message:',_0x3e9104),loggerService_1[_0x524c08(0xd6)][_0x524c08(0xad)](_0x524c08(0x11b),_0x524c08(0xee),_0x524c08(0xa0)+_0x3e9104);throw new Error(_0x524c08(0xa1)+_0x3e9104);}if(!_0x10571b[_0x524c08(0xe0)]){console['error'](_0x524c08(0xf3)),console[_0x524c08(0x109)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x524c08(0xad)](_0x524c08(0x11b),_0x524c08(0xee),_0x524c08(0xc1));throw new Error(_0x524c08(0x10d));}let _0x29a52b=_0x524c08(0xd0);switch(_0x10571b[_0x524c08(0xe0)][_0x524c08(0x10f)]?.[_0x524c08(0x124)]()){case _0x524c08(0xc6):_0x29a52b=_0x524c08(0x11e);break;case _0x524c08(0xf1):case'failed':case _0x524c08(0x109):_0x29a52b=_0x524c08(0x11f);break;case'expired':case _0x524c08(0xe2):_0x29a52b=_0x524c08(0xbf);break;case'waiting':case'awaiting\x20fiat':case _0x524c08(0xc7):case'created':default:_0x29a52b=_0x524c08(0xd0);break;}let _0x5bbcdc,_0x20b5a8;if(_0x10571b[_0x524c08(0xe0)][_0x524c08(0xa7)]){const _0x358557=_0x10571b['data'][_0x524c08(0xa7)];console[_0x524c08(0xda)](_0x524c08(0xd8),_0x358557);const _0x17983a=_0x358557[_0x524c08(0xae)](/IBAN\s+([A-Z0-9]+)/i);_0x17983a&&(_0x5bbcdc=_0x17983a[0x1],console[_0x524c08(0xda)](_0x524c08(0x123),_0x5bbcdc)),_0x20b5a8=_0x358557;}const _0x44c1c9={'iban':_0x5bbcdc,'bankDetails':_0x20b5a8,'transactionId':_0x10571b[_0x524c08(0xe0)]['TransactionID'],'coinAddress':_0x10571b[_0x524c08(0xe0)][_0x524c08(0x10e)],'qrCodeUrl':_0x10571b[_0x524c08(0xe0)][_0x524c08(0xcd)],'expiryTime':_0x10571b[_0x524c08(0xe0)]['ExpiryTime'],'createdOn':_0x10571b[_0x524c08(0xe0)][_0x524c08(0xd4)],'confirmedOn':_0x10571b['data'][_0x524c08(0xa4)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x524c08(0xda)]('Status:',_0x10571b[_0x524c08(0xe0)][_0x524c08(0x10f)],'->',_0x29a52b),console[_0x524c08(0xda)](_0x524c08(0xa5),_0x10571b[_0x524c08(0xe0)]['Amount'],_0x10571b[_0x524c08(0xe0)]['inputCurrency']),console[_0x524c08(0xda)]('Transaction\x20ID:',_0x10571b[_0x524c08(0xe0)]['TransactionID']),console[_0x524c08(0xda)](_0x524c08(0x10c),_0x5bbcdc||_0x524c08(0xaf)),console[_0x524c08(0xda)](_0x524c08(0xe9),_0x10571b[_0x524c08(0xe0)][_0x524c08(0xd4)]),console[_0x524c08(0xda)](_0x524c08(0xff),_0x10571b['data'][_0x524c08(0xa4)]||'not\x20confirmed');if(_0x10571b['data'][_0x524c08(0x10f)]?.[_0x524c08(0x124)]()===_0x524c08(0xf6))console['log'](_0x524c08(0x119));else _0x10571b[_0x524c08(0xe0)][_0x524c08(0x10f)]?.['toLowerCase']()===_0x524c08(0xc6)&&console[_0x524c08(0xda)](_0x524c08(0xc2));return{'status':_0x29a52b,'amount':parseFloat(_0x10571b[_0x524c08(0xe0)]['Amount'])||undefined,'currency':_0x10571b[_0x524c08(0xe0)]['inputCurrency']||_0x524c08(0xcc),'paymentDetails':_0x44c1c9};}catch(_0xab7dd9){console[_0x524c08(0x109)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0xab7dd9),loggerService_1[_0x524c08(0xd6)]['logWhiteDomainError'](_0x524c08(0x11b),_0x524c08(0xee),_0xab7dd9);throw new Error(_0x524c08(0xd9)+(_0xab7dd9 instanceof Error?_0xab7dd9[_0x524c08(0xab)]:_0x524c08(0xd3)));}}async['verifyPayment'](_0x1f9e7b){const _0x277c2a=a38_0x5b74b8,_0x272046=await this[_0x277c2a(0xc5)](_0x1f9e7b);return{'status':_0x272046[_0x277c2a(0xa6)],'amount':_0x272046[_0x277c2a(0xa8)],'currency':_0x272046[_0x277c2a(0xde)]};}async[a38_0x5b74b8(0xd7)](_0x2f2599){const _0xe7c9a9=a38_0x5b74b8;console[_0xe7c9a9(0xda)](_0xe7c9a9(0x118),_0x2f2599);let _0xdd9c47=_0xe7c9a9(0xd0);switch(_0x2f2599[_0xe7c9a9(0xa6)]?.[_0xe7c9a9(0x124)]()){case _0xe7c9a9(0xc6):_0xdd9c47=_0xe7c9a9(0x11e);break;case'cancelled':case _0xe7c9a9(0xba):case _0xe7c9a9(0x109):_0xdd9c47=_0xe7c9a9(0x11f);break;case _0xe7c9a9(0xca):case _0xe7c9a9(0xe2):_0xdd9c47='EXPIRED';break;case _0xe7c9a9(0xc7):case _0xe7c9a9(0xd1):case _0xe7c9a9(0xf6):case _0xe7c9a9(0x11c):default:_0xdd9c47='PENDING';break;}return{'paymentId':_0x2f2599['order_id']||_0x2f2599['merchant_reference_id']||'','status':_0xdd9c47,'amount':_0x2f2599['amount'],'currency':_0x2f2599[_0xe7c9a9(0xde)]||_0xe7c9a9(0xcc)};}}exports[a38_0x5b74b8(0xe4)]=CoinToPayService;function a38_0x5b02(){const _0x58e293=['defineProperty','cancelled','Payment\x20Status:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','fromEntries','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','awaiting\x20fiat','Error\x20details:','now','🪙\x20Creating\x20CoinToPay\x20payment:\x20','stringify','Amount','721510BQoKOt','CoinToPay\x20API\x20error:\x20','application/json','Confirmed\x20On:','stack','932742PZRuWC','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Error\x20Message:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Gateway\x20Payment\x20ID:','headers','error','43000mDszgy','8fqmElx','IBAN:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','coinAddress','Status','677022YwaCGB','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','apiUrl','https://tesoft.uk/gateway/cointopay/status.php','Raw\x20Response\x20Body:','100ghEYWq','40CxWOKl','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','/create','cointopay','created','statusUrl','PAID','FAILED','Response\x20Time:','JSON\x20Parse\x20Error:\x20','HTTP\x20','🏦\x20Extracted\x20IBAN:','toLowerCase','7ennllM','Status\x20API\x20Error:\x20','CoinToPay\x20status\x20API\x20error:\x20','Result:','Currency:','TransactionConfirmedOn','Amount:','status','PaymentDetail','amount','===\x20COINTOPAY\x20API\x20ERROR\x20===','64580iFtMmr','message','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','logWhiteDomainError','match','not\x20found','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Failed\x20to\x20parse\x20JSON\x20response:','11wsdwaH','Response\x20Body:','URL:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','15790032hvLWBf','HTTP\x20Status:','logWhiteDomainResponse','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','failed','Business\x20Error:\x20','text','../loggerService','Status:','EXPIRED',',\x20body:\x20','Incomplete\x20response:\x20missing\x20data','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','433476iNxDho','===\x20COINTOPAY\x20SUCCESS\x20===','checkPaymentStatus','paid','pending','inputCurrency','TesSoft\x20Payment\x20System/1.0','expired','Parsed\x20Result:','EUR','QRCodeURL','HTTP\x20error!\x20status:\x20','createPaymentLink','PENDING','waiting','parse','Unknown\x20error','CreatedOn','Unknown\x20error\x20from\x20CoinToPay\x20API','loggerService','processWebhook','🏦\x20Payment\x20Detail:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','log','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Request\x20Body:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','currency','POST','data','Error\x20message:','timeout','logWhiteDomainRequest','CoinToPayService','Error\x20stack:','📊\x20Status\x20check\x20URL:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','gateway_payment_id','Created\x20On:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','status_code','result','/status','payment_url'];a38_0x5b02=function(){return _0x58e293;};return a38_0x5b02();}