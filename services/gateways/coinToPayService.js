'use strict';const a61_0x53cdfd=a61_0x41c3;(function(_0x1edd96,_0x46e72c){const _0x42aa5c=a61_0x41c3,_0x10f0ef=_0x1edd96();while(!![]){try{const _0x987dc0=parseInt(_0x42aa5c(0xdc))/0x1+parseInt(_0x42aa5c(0xed))/0x2+-parseInt(_0x42aa5c(0xda))/0x3+parseInt(_0x42aa5c(0xf1))/0x4+-parseInt(_0x42aa5c(0xd8))/0x5*(parseInt(_0x42aa5c(0x111))/0x6)+-parseInt(_0x42aa5c(0xce))/0x7*(parseInt(_0x42aa5c(0xcb))/0x8)+parseInt(_0x42aa5c(0xfa))/0x9*(parseInt(_0x42aa5c(0xc8))/0xa);if(_0x987dc0===_0x46e72c)break;else _0x10f0ef['push'](_0x10f0ef['shift']());}catch(_0x48d76d){_0x10f0ef['push'](_0x10f0ef['shift']());}}}(a61_0x534a,0x815f7));Object[a61_0x53cdfd(0xc0)](exports,a61_0x53cdfd(0x131),{'value':!![]}),exports[a61_0x53cdfd(0xd7)]=void 0x0;const loggerService_1=require(a61_0x53cdfd(0xc9));class CoinToPayService{constructor(){const _0x3e30be=a61_0x53cdfd;this[_0x3e30be(0x109)]=_0x3e30be(0xf0),this[_0x3e30be(0xf9)]=_0x3e30be(0x110),console[_0x3e30be(0x101)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x3e30be(0x101)](_0x3e30be(0xf4),this[_0x3e30be(0xf9)]);}async['createPaymentLink'](_0x4770c7){const _0x48f720=a61_0x53cdfd,{orderId:_0x2d9110,amount:_0x1c429d}=_0x4770c7;console[_0x48f720(0x101)](_0x48f720(0xd6)+_0x1c429d+'\x20EUR');const _0x48d25d={'amount':_0x1c429d},_0x4a7a2f=Date[_0x48f720(0xc1)]();try{console[_0x48f720(0x101)](_0x48f720(0x104)),console['log'](_0x48f720(0xeb),this[_0x48f720(0x109)]),console[_0x48f720(0x101)](_0x48f720(0x115),JSON[_0x48f720(0xc7)](_0x48d25d,null,0x2)),console[_0x48f720(0x101)]('Amount:',_0x1c429d,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x48f720(0x108)]['logWhiteDomainRequest'](_0x48f720(0x103),_0x48f720(0xfd),_0x48f720(0xea),_0x48d25d);const _0x4c43ee=await fetch(this[_0x48f720(0x109)],{'method':_0x48f720(0xea),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x48f720(0x12b)},'body':JSON[_0x48f720(0xc7)](_0x48d25d)}),_0x54e871=Date['now']()-_0x4a7a2f;console['log'](_0x48f720(0x11d)),console[_0x48f720(0x101)](_0x48f720(0x11c),_0x4c43ee['status']),console[_0x48f720(0x101)](_0x48f720(0x12e),_0x4c43ee['statusText']),console[_0x48f720(0x101)]('Headers:',Object['fromEntries'](_0x4c43ee[_0x48f720(0x120)]['entries']())),console['log'](_0x48f720(0xdf),_0x54e871+'ms');const _0x16d31a=await _0x4c43ee[_0x48f720(0xd2)]();console[_0x48f720(0x101)](_0x48f720(0xf7),_0x16d31a);if(!_0x4c43ee['ok']){console['error'](_0x48f720(0x13a)),console['error'](_0x48f720(0xc5),_0x4c43ee[_0x48f720(0x13c)]),console[_0x48f720(0x107)]('Response\x20Body:',_0x16d31a),loggerService_1[_0x48f720(0x108)][_0x48f720(0xf5)](_0x48f720(0x103),_0x48f720(0xfd),_0x4c43ee[_0x48f720(0x13c)],_0x16d31a,_0x54e871),loggerService_1[_0x48f720(0x108)][_0x48f720(0xe8)](_0x48f720(0x103),_0x48f720(0xfd),'HTTP\x20'+_0x4c43ee[_0x48f720(0x13c)]+':\x20'+_0x16d31a);throw new Error(_0x48f720(0x134)+_0x4c43ee['status']+_0x48f720(0xc3)+_0x16d31a);}let _0x3602fc;try{_0x3602fc=JSON[_0x48f720(0x121)](_0x16d31a);}catch(_0x266e78){console[_0x48f720(0x107)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x266e78),loggerService_1['loggerService']['logWhiteDomainError'](_0x48f720(0x103),'/create','JSON\x20Parse\x20Error:\x20'+_0x266e78);throw new Error(_0x48f720(0x122)+_0x16d31a);}console['log'](_0x48f720(0x10f)),console[_0x48f720(0x101)](_0x48f720(0xc2),JSON[_0x48f720(0xc7)](_0x3602fc,null,0x2)),loggerService_1[_0x48f720(0x108)][_0x48f720(0xf5)]('cointopay','/create',_0x4c43ee[_0x48f720(0x13c)],_0x3602fc,_0x54e871);if(_0x3602fc[_0x48f720(0x107)]){const _0x37efc0=_0x3602fc['message']||_0x3602fc[_0x48f720(0x107)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x48f720(0x107)](_0x48f720(0xf2)),console['error'](_0x48f720(0x114),_0x37efc0),loggerService_1['loggerService'][_0x48f720(0xe8)](_0x48f720(0x103),'/create',_0x48f720(0x128)+_0x37efc0);throw new Error(_0x48f720(0x12a)+_0x37efc0);}if(!_0x3602fc[_0x48f720(0xcc)]||!_0x3602fc[_0x48f720(0xc4)]){console[_0x48f720(0x107)](_0x48f720(0xd9)),console[_0x48f720(0x107)](_0x48f720(0xd1)),console[_0x48f720(0x107)](_0x48f720(0xe0),_0x3602fc),loggerService_1['loggerService'][_0x48f720(0xe8)]('cointopay',_0x48f720(0xfd),_0x48f720(0x118));throw new Error(_0x48f720(0x123));}console[_0x48f720(0x101)](_0x48f720(0xd4)),console[_0x48f720(0x101)](_0x48f720(0xe4),_0x3602fc['gateway_payment_id']),console['log']('Payment\x20URL\x20(original):',_0x3602fc['payment_url']);const _0x38b654=_0x3602fc[_0x48f720(0xcc)]+_0x48f720(0x10a);return console[_0x48f720(0x101)](_0x48f720(0x10b),_0x38b654),console['log']('Amount:',_0x1c429d,_0x48f720(0x11a)),{'gateway_payment_id':_0x3602fc['gateway_payment_id'],'payment_url':_0x38b654};}catch(_0x2fb3bb){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x48f720(0x107)](_0x48f720(0xe9),_0x2fb3bb),loggerService_1[_0x48f720(0x108)]['logWhiteDomainError']('cointopay',_0x48f720(0xfd),_0x2fb3bb);if(_0x2fb3bb instanceof Error){console[_0x48f720(0x107)]('Error\x20message:',_0x2fb3bb[_0x48f720(0x125)]),console[_0x48f720(0x107)](_0x48f720(0x11b),_0x2fb3bb[_0x48f720(0xe7)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x2fb3bb[_0x48f720(0x125)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x46ad65){const _0x3f7416=a61_0x53cdfd,_0xad5a0b=Date[_0x3f7416(0xc1)]();try{console[_0x3f7416(0x101)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x46ad65);const _0x4de75a={'gatewayPaymentId':_0x46ad65};loggerService_1[_0x3f7416(0x108)][_0x3f7416(0x138)]('cointopay',_0x3f7416(0x13b),'POST',_0x4de75a);const _0x478f2e=await fetch(this[_0x3f7416(0xf9)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x3f7416(0x12b)},'body':JSON[_0x3f7416(0xc7)](_0x4de75a)}),_0x2fc45a=Date[_0x3f7416(0xc1)]()-_0xad5a0b;console[_0x3f7416(0x101)](_0x3f7416(0x13f)),console[_0x3f7416(0x101)](_0x3f7416(0x11c),_0x478f2e[_0x3f7416(0x13c)]),console['log']('Response\x20Time:',_0x2fc45a+'ms');if(!_0x478f2e['ok']){const _0x39482f=await _0x478f2e[_0x3f7416(0xd2)]();console[_0x3f7416(0x107)]('HTTP\x20Status:',_0x478f2e[_0x3f7416(0x13c)]),console['error'](_0x3f7416(0xcd),_0x39482f),loggerService_1['loggerService'][_0x3f7416(0xf5)]('cointopay',_0x3f7416(0x13b),_0x478f2e[_0x3f7416(0x13c)],_0x39482f,_0x2fc45a),loggerService_1['loggerService'][_0x3f7416(0xe8)](_0x3f7416(0x103),'/status','HTTP\x20'+_0x478f2e['status']+':\x20'+_0x39482f);throw new Error(_0x3f7416(0x134)+_0x478f2e[_0x3f7416(0x13c)]);}const _0x422f4e=await _0x478f2e[_0x3f7416(0xd2)]();console['log'](_0x3f7416(0xf7),_0x422f4e);let _0x2b0f77;try{_0x2b0f77=JSON[_0x3f7416(0x121)](_0x422f4e);}catch(_0x57e7e){console[_0x3f7416(0x107)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x57e7e),loggerService_1['loggerService'][_0x3f7416(0xe8)](_0x3f7416(0x103),_0x3f7416(0x13b),'JSON\x20Parse\x20Error:\x20'+_0x57e7e);throw new Error(_0x3f7416(0x113)+_0x422f4e);}loggerService_1[_0x3f7416(0x108)][_0x3f7416(0xf5)]('cointopay',_0x3f7416(0x13b),_0x478f2e[_0x3f7416(0x13c)],_0x2b0f77,_0x2fc45a),console[_0x3f7416(0x101)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x3f7416(0x101)](_0x3f7416(0x100),_0x2b0f77['result']),console['log'](_0x3f7416(0xee),_0x2b0f77[_0x3f7416(0xf6)]),console[_0x3f7416(0x101)](_0x3f7416(0x13d),_0x2b0f77['data']?.[_0x3f7416(0xfb)]),console['log'](_0x3f7416(0x112),_0x2b0f77['data']?.[_0x3f7416(0xdb)]),console['log'](_0x3f7416(0xfc),_0x2b0f77[_0x3f7416(0xec)]?.['inputCurrency']);if(_0x2b0f77['result']!=='success'||_0x2b0f77[_0x3f7416(0xf6)]!==0xc8){const _0x25efe4=_0x2b0f77['message']||_0x3f7416(0xe3);console['error'](_0x3f7416(0xca)),console['error'](_0x3f7416(0x114),_0x25efe4),loggerService_1[_0x3f7416(0x108)][_0x3f7416(0xe8)](_0x3f7416(0x103),_0x3f7416(0x13b),_0x3f7416(0x126)+_0x25efe4);throw new Error(_0x3f7416(0xdd)+_0x25efe4);}if(!_0x2b0f77[_0x3f7416(0xec)]){console['error'](_0x3f7416(0x102)),console[_0x3f7416(0x107)](_0x3f7416(0x10c)),loggerService_1[_0x3f7416(0x108)][_0x3f7416(0xe8)]('cointopay',_0x3f7416(0x13b),_0x3f7416(0xd5));throw new Error(_0x3f7416(0x124));}let _0xbe0523='PENDING';switch(_0x2b0f77[_0x3f7416(0xec)]['Status']?.[_0x3f7416(0x12d)]()){case _0x3f7416(0x13e):_0xbe0523='PAID';break;case _0x3f7416(0x132):case _0x3f7416(0x106):case _0x3f7416(0x107):_0xbe0523=_0x3f7416(0x11f);break;case _0x3f7416(0x127):case'timeout':_0xbe0523=_0x3f7416(0xe2);break;case'waiting':case'awaiting\x20fiat':case'pending':case'created':default:_0xbe0523=_0x3f7416(0xf3);break;}let _0x1969c6,_0x1bd1b8;if(_0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0xff)]){const _0x4ce0a6=_0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0xff)];console[_0x3f7416(0x101)](_0x3f7416(0xd3),_0x4ce0a6);const _0x13fc55=_0x4ce0a6['match'](/IBAN\s+([A-Z0-9]+)/i);_0x13fc55&&(_0x1969c6=_0x13fc55[0x1],console[_0x3f7416(0x101)]('üè¶\x20Extracted\x20IBAN:',_0x1969c6)),_0x1bd1b8=_0x4ce0a6;}const _0x1df634={'iban':_0x1969c6,'bankDetails':_0x1bd1b8,'transactionId':_0x2b0f77[_0x3f7416(0xec)]['TransactionID'],'coinAddress':_0x2b0f77[_0x3f7416(0xec)]['coinAddress'],'qrCodeUrl':_0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0x133)],'expiryTime':_0x2b0f77[_0x3f7416(0xec)]['ExpiryTime'],'createdOn':_0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0x12f)],'confirmedOn':_0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0xfe)]};console[_0x3f7416(0x101)](_0x3f7416(0xef)),console['log'](_0x3f7416(0x11c),_0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0xfb)],'->',_0xbe0523),console[_0x3f7416(0x101)](_0x3f7416(0x112),_0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0xdb)],_0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0xe1)]),console[_0x3f7416(0x101)](_0x3f7416(0x135),_0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0xe6)]),console[_0x3f7416(0x101)]('IBAN:',_0x1969c6||_0x3f7416(0x136)),console['log'](_0x3f7416(0x139),_0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0x12f)]),console[_0x3f7416(0x101)](_0x3f7416(0xc6),_0x2b0f77[_0x3f7416(0xec)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0xfb)]?.[_0x3f7416(0x12d)]()===_0x3f7416(0x10e))console[_0x3f7416(0x101)](_0x3f7416(0x117));else _0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0xfb)]?.['toLowerCase']()===_0x3f7416(0x13e)&&console[_0x3f7416(0x101)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0xbe0523,'amount':parseFloat(_0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0xdb)])||undefined,'currency':_0x2b0f77[_0x3f7416(0xec)][_0x3f7416(0xe1)]||'EUR','paymentDetails':_0x1df634};}catch(_0x3e5f55){console[_0x3f7416(0x107)](_0x3f7416(0xd0),_0x3e5f55),loggerService_1[_0x3f7416(0x108)][_0x3f7416(0xe8)](_0x3f7416(0x103),'/status',_0x3e5f55);throw new Error(_0x3f7416(0xde)+(_0x3e5f55 instanceof Error?_0x3e5f55['message']:_0x3f7416(0xe5)));}}async[a61_0x53cdfd(0xcf)](_0x2f9a77){const _0x1f1736=a61_0x53cdfd,_0x4c15a1=await this[_0x1f1736(0x129)](_0x2f9a77);return{'status':_0x4c15a1[_0x1f1736(0x13c)],'amount':_0x4c15a1['amount'],'currency':_0x4c15a1[_0x1f1736(0x105)]};}async[a61_0x53cdfd(0x116)](_0x2ea57b){const _0xeaa382=a61_0x53cdfd;console[_0xeaa382(0x101)](_0xeaa382(0x119),_0x2ea57b);let _0x46f5ae=_0xeaa382(0xf3);switch(_0x2ea57b[_0xeaa382(0x13c)]?.[_0xeaa382(0x12d)]()){case'paid':_0x46f5ae='PAID';break;case _0xeaa382(0x132):case _0xeaa382(0x106):case _0xeaa382(0x107):_0x46f5ae=_0xeaa382(0x11f);break;case _0xeaa382(0x127):case _0xeaa382(0x130):_0x46f5ae=_0xeaa382(0xe2);break;case _0xeaa382(0x10d):case'waiting':case _0xeaa382(0x10e):case _0xeaa382(0xf8):default:_0x46f5ae='PENDING';break;}return{'paymentId':_0x2ea57b[_0xeaa382(0x137)]||_0x2ea57b[_0xeaa382(0x11e)]||'','status':_0x46f5ae,'amount':_0x2ea57b[_0xeaa382(0x12c)],'currency':_0x2ea57b[_0xeaa382(0x105)]||_0xeaa382(0x11a)};}}function a61_0x41c3(_0x5af51d,_0xd15285){_0x5af51d=_0x5af51d-0xc0;const _0x534aa0=a61_0x534a();let _0x41c3f3=_0x534aa0[_0x5af51d];return _0x41c3f3;}function a61_0x534a(){const _0x73b79a=['Amount:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Error\x20Message:','Request\x20Body:','processWebhook','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','EUR','Error\x20stack:','Status:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','merchant_reference_id','FAILED','headers','parse','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','message','Status\x20API\x20Error:\x20','expired','Business\x20Error:\x20','checkPaymentStatus','CoinToPay\x20API\x20error:\x20','Payment\x20System/1.0','amount','toLowerCase','Status\x20Text:','CreatedOn','timeout','__esModule','cancelled','QRCodeURL','HTTP\x20error!\x20status:\x20','Transaction\x20ID:','not\x20found','order_id','logWhiteDomainRequest','Created\x20On:','===\x20COINTOPAY\x20API\x20ERROR\x20===','/status','status','Payment\x20Status:','paid','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','defineProperty','now','Parsed\x20Result:',',\x20body:\x20','gateway_payment_id','HTTP\x20Status:','Confirmed\x20On:','stringify','675790WUdzSp','../loggerService','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','1388864OVCibl','payment_url','Response\x20Body:','28nCXpty','verifyPayment','CoinToPay\x20payment\x20status\x20check\x20error:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','text','üè¶\x20Payment\x20Detail:','===\x20COINTOPAY\x20SUCCESS\x20===','Incomplete\x20response:\x20missing\x20data','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','CoinToPayService','5OmJvgA','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','2152092zMHmub','Amount','271452eAvYdU','CoinToPay\x20status\x20API\x20error:\x20','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Response\x20Time:','Response\x20data:','inputCurrency','EXPIRED','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Gateway\x20Payment\x20ID:','Unknown\x20error','TransactionID','stack','logWhiteDomainError','Error\x20details:','POST','URL:','data','2102372pkALto','Status\x20Code:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','https://tesoft.uk/gateway/cointopay/','3799476kTqEhN','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','PENDING','üìä\x20Status\x20check\x20URL:','logWhiteDomainResponse','status_code','Raw\x20Response\x20Body:','created','statusUrl','81whiTRR','Status','Currency:','/create','TransactionConfirmedOn','PaymentDetail','Result:','log','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','cointopay','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','currency','failed','error','loggerService','apiUrl','&alternative=false','Payment\x20URL\x20(modified):','Missing\x20data\x20in\x20response','pending','awaiting\x20fiat','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','https://tesoft.uk/gateway/cointopay/status.php','5634066zOgwpE'];a61_0x534a=function(){return _0x73b79a;};return a61_0x534a();}exports[a61_0x53cdfd(0xd7)]=CoinToPayService;