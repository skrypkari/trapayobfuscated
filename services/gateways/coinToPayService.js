'use strict';const a49_0x387a17=a49_0x1310;function a49_0x1a67(){const _0x34e574=['Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','fromEntries','Incomplete\x20response:\x20missing\x20data','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Result:','message','payment_url','Missing\x20data\x20in\x20response','logWhiteDomainError','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','33nljjjE','CreatedOn','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','cointopay','success','EUR','pending','Failed\x20to\x20parse\x20JSON\x20response:','checkPaymentStatus','expired','createPaymentLink','timeout','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','verifyPayment','Payment\x20System/1.0','currency','Amount:','statusUrl','status_code','&alternative=false','entries','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','/create','failed','Status','stack','https://tesoft.uk/gateway/cointopay/','Response\x20Body:','Gateway\x20Payment\x20ID:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','waiting','6004072EUNDOg','log','üè¶\x20Payment\x20Detail:','not\x20confirmed','apiUrl','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','error','POST','Headers:','defineProperty','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Status\x20Text:','processWebhook','toLowerCase','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Created\x20On:','merchant_reference_id','inputCurrency','7vnbjQk','loggerService','Parsed\x20Result:','amount','4693167cQGAAv','8NvyqQO','https://tesoft.uk/gateway/cointopay/status.php','HTTP\x20error!\x20status:\x20','Currency:','CoinToPay\x20API\x20error:\x20','ExpiryTime','HTTP\x20Status:','EXPIRED','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainRequest','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','JSON\x20Parse\x20Error:\x20','Status\x20Code:','Payment\x20Status:','PENDING','Confirmed\x20On:','===\x20COINTOPAY\x20API\x20ERROR\x20===','PAID','Raw\x20Response\x20Body:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','\x20EUR','üè¶\x20Extracted\x20IBAN:','36990uBtlbR',',\x20body:\x20','Error\x20Message:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','383190qHZFfD','FAILED','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','CoinToPay\x20status\x20API\x20error:\x20','text','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','5AysnzK','not\x20found','TransactionID','application/json','Error\x20details:','Error\x20message:','result','../loggerService','Request\x20Body:','Payment\x20URL\x20(original):','544683ZgKMzc','parse','paid','logWhiteDomainResponse','PaymentDetail','7071756peyWmz','Status:','4552386AqEySa','10wlttVJ','data','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Unknown\x20error\x20from\x20CoinToPay\x20API','created','stringify','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','match','URL:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','gateway_payment_id','CoinToPayService','/status','TransactionConfirmedOn','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','status','cancelled','awaiting\x20fiat','Response\x20Time:'];a49_0x1a67=function(){return _0x34e574;};return a49_0x1a67();}(function(_0x1488da,_0x2cec57){const _0x25a2e0=a49_0x1310,_0x42cd00=_0x1488da();while(!![]){try{const _0x16f255=parseInt(_0x25a2e0(0x12c))/0x1*(-parseInt(_0x25a2e0(0x110))/0x2)+-parseInt(_0x25a2e0(0x124))/0x3*(parseInt(_0x25a2e0(0x182))/0x4)+parseInt(_0x25a2e0(0x11a))/0x5*(parseInt(_0x25a2e0(0x12b))/0x6)+-parseInt(_0x25a2e0(0x17d))/0x7*(parseInt(_0x25a2e0(0x16b))/0x8)+parseInt(_0x25a2e0(0x181))/0x9+-parseInt(_0x25a2e0(0x114))/0xa*(parseInt(_0x25a2e0(0x14b))/0xb)+parseInt(_0x25a2e0(0x129))/0xc;if(_0x16f255===_0x2cec57)break;else _0x42cd00['push'](_0x42cd00['shift']());}catch(_0x8880){_0x42cd00['push'](_0x42cd00['shift']());}}}(a49_0x1a67,0x6f521));function a49_0x1310(_0x91579d,_0x1186ba){const _0x1a6766=a49_0x1a67();return a49_0x1310=function(_0x131032,_0x4d2608){_0x131032=_0x131032-0x105;let _0x45ba80=_0x1a6766[_0x131032];return _0x45ba80;},a49_0x1310(_0x91579d,_0x1186ba);}Object[a49_0x387a17(0x174)](exports,'__esModule',{'value':!![]}),exports[a49_0x387a17(0x137)]=void 0x0;const loggerService_1=require(a49_0x387a17(0x121));class CoinToPayService{constructor(){const _0xf6d628=a49_0x387a17;this['apiUrl']=_0xf6d628(0x165),this[_0xf6d628(0x15c)]=_0xf6d628(0x183),console[_0xf6d628(0x16c)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log']('üìä\x20Status\x20check\x20URL:',this['statusUrl']);}async[a49_0x387a17(0x155)](_0x20ead9){const _0x4704c5=a49_0x387a17,{orderId:_0x548921,amount:_0x332ca7}=_0x20ead9;console[_0x4704c5(0x16c)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x332ca7+_0x4704c5(0x10e));const _0x35c526={'amount':_0x332ca7},_0x585bfd=Date['now']();try{console[_0x4704c5(0x16c)](_0x4704c5(0x160)),console['log'](_0x4704c5(0x134),this[_0x4704c5(0x16f)]),console[_0x4704c5(0x16c)](_0x4704c5(0x122),JSON[_0x4704c5(0x131)](_0x35c526,null,0x2)),console[_0x4704c5(0x16c)]('Amount:',_0x332ca7,_0x4704c5(0x140)),loggerService_1[_0x4704c5(0x17e)][_0x4704c5(0x18b)]('cointopay','/create',_0x4704c5(0x172),_0x35c526);const _0x511521=await fetch(this[_0x4704c5(0x16f)],{'method':'POST','headers':{'Content-Type':_0x4704c5(0x11d),'Accept':_0x4704c5(0x11d),'User-Agent':'Payment\x20System/1.0'},'body':JSON['stringify'](_0x35c526)}),_0x44f1ff=Date['now']()-_0x585bfd;console[_0x4704c5(0x16c)](_0x4704c5(0x18a)),console[_0x4704c5(0x16c)](_0x4704c5(0x12a),_0x511521[_0x4704c5(0x13b)]),console[_0x4704c5(0x16c)](_0x4704c5(0x176),_0x511521['statusText']),console[_0x4704c5(0x16c)](_0x4704c5(0x173),Object[_0x4704c5(0x142)](_0x511521['headers'][_0x4704c5(0x15f)]())),console[_0x4704c5(0x16c)]('Response\x20Time:',_0x44f1ff+'ms');const _0x1bf138=await _0x511521[_0x4704c5(0x118)]();console[_0x4704c5(0x16c)]('Raw\x20Response\x20Body:',_0x1bf138);if(!_0x511521['ok']){console['error'](_0x4704c5(0x10a)),console[_0x4704c5(0x171)]('HTTP\x20Status:',_0x511521['status']),console[_0x4704c5(0x171)](_0x4704c5(0x166),_0x1bf138),loggerService_1[_0x4704c5(0x17e)][_0x4704c5(0x127)](_0x4704c5(0x14e),'/create',_0x511521[_0x4704c5(0x13b)],_0x1bf138,_0x44f1ff),loggerService_1[_0x4704c5(0x17e)][_0x4704c5(0x149)](_0x4704c5(0x14e),_0x4704c5(0x161),'HTTP\x20'+_0x511521[_0x4704c5(0x13b)]+':\x20'+_0x1bf138);throw new Error(_0x4704c5(0x184)+_0x511521[_0x4704c5(0x13b)]+_0x4704c5(0x111)+_0x1bf138);}let _0x45e44f;try{_0x45e44f=JSON[_0x4704c5(0x125)](_0x1bf138);}catch(_0x1b3eef){console[_0x4704c5(0x171)](_0x4704c5(0x152),_0x1b3eef),loggerService_1['loggerService']['logWhiteDomainError'](_0x4704c5(0x14e),'/create',_0x4704c5(0x105)+_0x1b3eef);throw new Error(_0x4704c5(0x144)+_0x1bf138);}console[_0x4704c5(0x16c)](_0x4704c5(0x168)),console[_0x4704c5(0x16c)](_0x4704c5(0x17f),JSON[_0x4704c5(0x131)](_0x45e44f,null,0x2)),loggerService_1[_0x4704c5(0x17e)][_0x4704c5(0x127)]('cointopay',_0x4704c5(0x161),_0x511521[_0x4704c5(0x13b)],_0x45e44f,_0x44f1ff);if(_0x45e44f[_0x4704c5(0x171)]){const _0x5cddb2=_0x45e44f[_0x4704c5(0x146)]||_0x45e44f[_0x4704c5(0x171)]||_0x4704c5(0x12f);console['error'](_0x4704c5(0x141)),console[_0x4704c5(0x171)](_0x4704c5(0x112),_0x5cddb2),loggerService_1[_0x4704c5(0x17e)][_0x4704c5(0x149)](_0x4704c5(0x14e),_0x4704c5(0x161),'Business\x20Error:\x20'+_0x5cddb2);throw new Error(_0x4704c5(0x186)+_0x5cddb2);}if(!_0x45e44f[_0x4704c5(0x147)]||!_0x45e44f[_0x4704c5(0x136)]){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4704c5(0x171)](_0x4704c5(0x179)),console[_0x4704c5(0x171)]('Response\x20data:',_0x45e44f),loggerService_1[_0x4704c5(0x17e)][_0x4704c5(0x149)](_0x4704c5(0x14e),_0x4704c5(0x161),_0x4704c5(0x14a));throw new Error(_0x4704c5(0x113));}console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x4704c5(0x16c)](_0x4704c5(0x167),_0x45e44f['gateway_payment_id']),console[_0x4704c5(0x16c)](_0x4704c5(0x123),_0x45e44f[_0x4704c5(0x147)]);const _0x90afc3=_0x45e44f[_0x4704c5(0x147)]+_0x4704c5(0x15e);return console[_0x4704c5(0x16c)]('Payment\x20URL\x20(modified):',_0x90afc3),console[_0x4704c5(0x16c)](_0x4704c5(0x15b),_0x332ca7,_0x4704c5(0x150)),{'gateway_payment_id':_0x45e44f[_0x4704c5(0x136)],'payment_url':_0x90afc3};}catch(_0x2068cf){console['error'](_0x4704c5(0x135)),console['error'](_0x4704c5(0x11e),_0x2068cf),loggerService_1[_0x4704c5(0x17e)][_0x4704c5(0x149)](_0x4704c5(0x14e),_0x4704c5(0x161),_0x2068cf);if(_0x2068cf instanceof Error){console[_0x4704c5(0x171)](_0x4704c5(0x11f),_0x2068cf[_0x4704c5(0x146)]),console[_0x4704c5(0x171)]('Error\x20stack:',_0x2068cf[_0x4704c5(0x164)]);throw new Error(_0x4704c5(0x119)+_0x2068cf[_0x4704c5(0x146)]);}throw new Error(_0x4704c5(0x18c));}}async[a49_0x387a17(0x153)](_0x46fbfe){const _0x1ccc5c=a49_0x387a17,_0xd6ebfd=Date['now']();try{console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x14d)+_0x46fbfe);const _0xcb0d22={'gatewayPaymentId':_0x46fbfe};loggerService_1[_0x1ccc5c(0x17e)][_0x1ccc5c(0x18b)](_0x1ccc5c(0x14e),_0x1ccc5c(0x138),_0x1ccc5c(0x172),_0xcb0d22);const _0x1e273c=await fetch(this[_0x1ccc5c(0x15c)],{'method':_0x1ccc5c(0x172),'headers':{'Content-Type':'application/json','Accept':_0x1ccc5c(0x11d),'User-Agent':_0x1ccc5c(0x159)},'body':JSON[_0x1ccc5c(0x131)](_0xcb0d22)}),_0x32f741=Date['now']()-_0xd6ebfd;console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x170)),console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x12a),_0x1e273c[_0x1ccc5c(0x13b)]),console['log'](_0x1ccc5c(0x13e),_0x32f741+'ms');if(!_0x1e273c['ok']){const _0x4fcd1b=await _0x1e273c[_0x1ccc5c(0x118)]();console[_0x1ccc5c(0x171)](_0x1ccc5c(0x188),_0x1e273c['status']),console['error']('Response\x20Body:',_0x4fcd1b),loggerService_1[_0x1ccc5c(0x17e)]['logWhiteDomainResponse']('cointopay','/status',_0x1e273c['status'],_0x4fcd1b,_0x32f741),loggerService_1['loggerService'][_0x1ccc5c(0x149)](_0x1ccc5c(0x14e),'/status','HTTP\x20'+_0x1e273c[_0x1ccc5c(0x13b)]+':\x20'+_0x4fcd1b);throw new Error(_0x1ccc5c(0x184)+_0x1e273c[_0x1ccc5c(0x13b)]);}const _0x30856b=await _0x1e273c[_0x1ccc5c(0x118)]();console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x10c),_0x30856b);let _0x9c1954;try{_0x9c1954=JSON[_0x1ccc5c(0x125)](_0x30856b);}catch(_0x4bd212){console[_0x1ccc5c(0x171)](_0x1ccc5c(0x152),_0x4bd212),loggerService_1['loggerService']['logWhiteDomainError'](_0x1ccc5c(0x14e),'/status',_0x1ccc5c(0x105)+_0x4bd212);throw new Error(_0x1ccc5c(0x169)+_0x30856b);}loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1ccc5c(0x14e),_0x1ccc5c(0x138),_0x1e273c[_0x1ccc5c(0x13b)],_0x9c1954,_0x32f741),console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x13a)),console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x145),_0x9c1954[_0x1ccc5c(0x120)]),console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x106),_0x9c1954[_0x1ccc5c(0x15d)]),console['log'](_0x1ccc5c(0x107),_0x9c1954[_0x1ccc5c(0x12d)]?.[_0x1ccc5c(0x163)]),console['log'](_0x1ccc5c(0x15b),_0x9c1954[_0x1ccc5c(0x12d)]?.['Amount']),console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x185),_0x9c1954[_0x1ccc5c(0x12d)]?.['inputCurrency']);if(_0x9c1954[_0x1ccc5c(0x120)]!==_0x1ccc5c(0x14f)||_0x9c1954[_0x1ccc5c(0x15d)]!==0xc8){const _0x3670b2=_0x9c1954['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x1ccc5c(0x171)](_0x1ccc5c(0x116)),console['error'](_0x1ccc5c(0x112),_0x3670b2),loggerService_1[_0x1ccc5c(0x17e)][_0x1ccc5c(0x149)](_0x1ccc5c(0x14e),_0x1ccc5c(0x138),'Status\x20API\x20Error:\x20'+_0x3670b2);throw new Error(_0x1ccc5c(0x117)+_0x3670b2);}if(!_0x9c1954[_0x1ccc5c(0x12d)]){console[_0x1ccc5c(0x171)](_0x1ccc5c(0x157)),console[_0x1ccc5c(0x171)](_0x1ccc5c(0x148)),loggerService_1['loggerService'][_0x1ccc5c(0x149)](_0x1ccc5c(0x14e),'/status',_0x1ccc5c(0x143));throw new Error(_0x1ccc5c(0x12e));}let _0x943184=_0x1ccc5c(0x108);switch(_0x9c1954[_0x1ccc5c(0x12d)][_0x1ccc5c(0x163)]?.[_0x1ccc5c(0x178)]()){case _0x1ccc5c(0x126):_0x943184=_0x1ccc5c(0x10b);break;case _0x1ccc5c(0x13c):case'failed':case _0x1ccc5c(0x171):_0x943184=_0x1ccc5c(0x115);break;case _0x1ccc5c(0x154):case _0x1ccc5c(0x156):_0x943184=_0x1ccc5c(0x189);break;case _0x1ccc5c(0x16a):case _0x1ccc5c(0x13d):case _0x1ccc5c(0x151):case _0x1ccc5c(0x130):default:_0x943184=_0x1ccc5c(0x108);break;}let _0x12abbb,_0x4bb960;if(_0x9c1954[_0x1ccc5c(0x12d)][_0x1ccc5c(0x128)]){const _0x17923f=_0x9c1954[_0x1ccc5c(0x12d)][_0x1ccc5c(0x128)];console['log'](_0x1ccc5c(0x16d),_0x17923f);const _0x2fccad=_0x17923f[_0x1ccc5c(0x133)](/IBAN\s+([A-Z0-9]+)/i);_0x2fccad&&(_0x12abbb=_0x2fccad[0x1],console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x10f),_0x12abbb)),_0x4bb960=_0x17923f;}const _0x3d807e={'iban':_0x12abbb,'bankDetails':_0x4bb960,'transactionId':_0x9c1954[_0x1ccc5c(0x12d)][_0x1ccc5c(0x11c)],'coinAddress':_0x9c1954[_0x1ccc5c(0x12d)]['coinAddress'],'qrCodeUrl':_0x9c1954[_0x1ccc5c(0x12d)]['QRCodeURL'],'expiryTime':_0x9c1954[_0x1ccc5c(0x12d)][_0x1ccc5c(0x187)],'createdOn':_0x9c1954['data'][_0x1ccc5c(0x14c)],'confirmedOn':_0x9c1954[_0x1ccc5c(0x12d)][_0x1ccc5c(0x139)]};console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x10d)),console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x12a),_0x9c1954[_0x1ccc5c(0x12d)][_0x1ccc5c(0x163)],'->',_0x943184),console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x15b),_0x9c1954[_0x1ccc5c(0x12d)]['Amount'],_0x9c1954[_0x1ccc5c(0x12d)][_0x1ccc5c(0x17c)]),console[_0x1ccc5c(0x16c)]('Transaction\x20ID:',_0x9c1954[_0x1ccc5c(0x12d)][_0x1ccc5c(0x11c)]),console[_0x1ccc5c(0x16c)]('IBAN:',_0x12abbb||_0x1ccc5c(0x11b)),console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x17a),_0x9c1954[_0x1ccc5c(0x12d)]['CreatedOn']),console['log'](_0x1ccc5c(0x109),_0x9c1954[_0x1ccc5c(0x12d)][_0x1ccc5c(0x139)]||_0x1ccc5c(0x16e));if(_0x9c1954[_0x1ccc5c(0x12d)][_0x1ccc5c(0x163)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x1ccc5c(0x16c)](_0x1ccc5c(0x132));else _0x9c1954[_0x1ccc5c(0x12d)]['Status']?.[_0x1ccc5c(0x178)]()===_0x1ccc5c(0x126)&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x943184,'amount':parseFloat(_0x9c1954[_0x1ccc5c(0x12d)]['Amount'])||undefined,'currency':_0x9c1954['data']['inputCurrency']||_0x1ccc5c(0x150),'paymentDetails':_0x3d807e};}catch(_0x5bae73){console[_0x1ccc5c(0x171)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x5bae73),loggerService_1[_0x1ccc5c(0x17e)]['logWhiteDomainError'](_0x1ccc5c(0x14e),'/status',_0x5bae73);throw new Error(_0x1ccc5c(0x13f)+(_0x5bae73 instanceof Error?_0x5bae73[_0x1ccc5c(0x146)]:'Unknown\x20error'));}}async[a49_0x387a17(0x158)](_0x3ca1d4){const _0x53d178=a49_0x387a17,_0x367f99=await this[_0x53d178(0x153)](_0x3ca1d4);return{'status':_0x367f99[_0x53d178(0x13b)],'amount':_0x367f99[_0x53d178(0x180)],'currency':_0x367f99[_0x53d178(0x15a)]};}async[a49_0x387a17(0x177)](_0x2292fb){const _0x44db87=a49_0x387a17;console[_0x44db87(0x16c)](_0x44db87(0x175),_0x2292fb);let _0x5ce445=_0x44db87(0x108);switch(_0x2292fb[_0x44db87(0x13b)]?.[_0x44db87(0x178)]()){case _0x44db87(0x126):_0x5ce445='PAID';break;case _0x44db87(0x13c):case _0x44db87(0x162):case _0x44db87(0x171):_0x5ce445=_0x44db87(0x115);break;case _0x44db87(0x154):case _0x44db87(0x156):_0x5ce445=_0x44db87(0x189);break;case _0x44db87(0x151):case'waiting':case _0x44db87(0x13d):case _0x44db87(0x130):default:_0x5ce445=_0x44db87(0x108);break;}return{'paymentId':_0x2292fb['order_id']||_0x2292fb[_0x44db87(0x17b)]||'','status':_0x5ce445,'amount':_0x2292fb[_0x44db87(0x180)],'currency':_0x2292fb[_0x44db87(0x15a)]||_0x44db87(0x150)};}}exports[a49_0x387a17(0x137)]=CoinToPayService;