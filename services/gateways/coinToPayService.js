'use strict';const a40_0x370109=a40_0x2d09;(function(_0x370fd6,_0x5786be){const _0x4d9e2c=a40_0x2d09,_0x5b4268=_0x370fd6();while(!![]){try{const _0x412d1f=parseInt(_0x4d9e2c(0x18a))/0x1*(parseInt(_0x4d9e2c(0x1a6))/0x2)+-parseInt(_0x4d9e2c(0x1c3))/0x3+-parseInt(_0x4d9e2c(0x19f))/0x4*(-parseInt(_0x4d9e2c(0x191))/0x5)+-parseInt(_0x4d9e2c(0x1d2))/0x6+-parseInt(_0x4d9e2c(0x169))/0x7+-parseInt(_0x4d9e2c(0x1e3))/0x8*(parseInt(_0x4d9e2c(0x183))/0x9)+parseInt(_0x4d9e2c(0x1a2))/0xa;if(_0x412d1f===_0x5786be)break;else _0x5b4268['push'](_0x5b4268['shift']());}catch(_0x53a6c6){_0x5b4268['push'](_0x5b4268['shift']());}}}(a40_0x5dd9,0x78495));function a40_0x5dd9(){const _0x5b37b5=['expired','payment_url','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','parse','Error\x20details:','https://tesoft.uk/gateway/cointopay/status.php','/create','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','PaymentDetail','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','awaiting\x20fiat','HTTP\x20Status:','log','headers','loggerService','üìä\x20Status\x20check\x20URL:','pending','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Response\x20data:','paid','Status:','1234245GqRCQM','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Status\x20Text:','CoinToPay\x20API\x20error:\x20','timeout','/status','TesSoft\x20Payment\x20System/1.0','stringify','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','EUR','===\x20COINTOPAY\x20API\x20ERROR\x20===','status','text','Status\x20API\x20Error:\x20','cointopay','3585840JxAHwM','stack','CoinToPayService','TransactionConfirmedOn','message','coinAddress','Incomplete\x20response:\x20missing\x20data','HTTP\x20','gateway_payment_id','üè¶\x20Extracted\x20IBAN:','entries','TransactionID','not\x20found','QRCodeURL','POST','üè¶\x20Payment\x20Detail:','Response\x20Body:','8uupLHb','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','===\x20COINTOPAY\x20SUCCESS\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','FAILED','Status','checkPaymentStatus','Headers:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Payment\x20URL:','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20Message:','status_code','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','failed','Error\x20stack:','167538MxSpti','Parsed\x20Result:','Raw\x20Response\x20Body:','PAID',',\x20body:\x20','Created\x20On:','ExpiryTime','processWebhook','../loggerService','JSON\x20Parse\x20Error:\x20','Amount','created','logWhiteDomainRequest','Unknown\x20error\x20from\x20CoinToPay\x20API','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','statusUrl','toLowerCase','HTTP\x20error!\x20status:\x20','Unknown\x20error','fromEntries','Gateway\x20Payment\x20ID:','__esModule','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','PENDING','result','4179339YNOWmP','success','CreatedOn','defineProperty','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','\x20EUR','Response\x20Time:','3sFXUGD','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','apiUrl','EXPIRED','amount','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','currency','1495rVansf','Missing\x20data\x20in\x20response','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','merchant_reference_id','data','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','cancelled','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','error','Result:','logWhiteDomainError','logWhiteDomainResponse','Status\x20Code:','4060xCjRnD','inputCurrency','Transaction\x20ID:','15925570CDhxjz','Confirmed\x20On:','Currency:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','62674nhdKIt','match','URL:','now','waiting','Amount:','application/json','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error'];a40_0x5dd9=function(){return _0x5b37b5;};return a40_0x5dd9();}Object[a40_0x370109(0x186)](exports,a40_0x370109(0x17f),{'value':!![]}),exports['CoinToPayService']=void 0x0;function a40_0x2d09(_0x4699d4,_0x266467){const _0x5dd90e=a40_0x5dd9();return a40_0x2d09=function(_0x2d09ca,_0x31caee){_0x2d09ca=_0x2d09ca-0x15c;let _0x4be92f=_0x5dd90e[_0x2d09ca];return _0x4be92f;},a40_0x2d09(_0x4699d4,_0x266467);}const loggerService_1=require(a40_0x370109(0x171));class CoinToPayService{constructor(){const _0x549ca4=a40_0x370109;this[_0x549ca4(0x18c)]='https://tesoft.uk/gateway/cointopay/',this[_0x549ca4(0x179)]=_0x549ca4(0x1b3),console['log'](_0x549ca4(0x1a5)),console[_0x549ca4(0x1ba)](_0x549ca4(0x1bd),this[_0x549ca4(0x179)]);}async['createPaymentLink'](_0x2b0737){const _0xc80840=a40_0x370109,{orderId:_0x5c7581,amount:_0x298808}=_0x2b0737;console[_0xc80840(0x1ba)](_0xc80840(0x197)+_0x298808+_0xc80840(0x188));const _0x1a2c76={'amount':_0x298808},_0x408ea3=Date[_0xc80840(0x1a9)]();try{console['log'](_0xc80840(0x1bf)),console[_0xc80840(0x1ba)](_0xc80840(0x1a8),this[_0xc80840(0x18c)]),console[_0xc80840(0x1ba)]('Request\x20Body:',JSON['stringify'](_0x1a2c76,null,0x2)),console['log'](_0xc80840(0x1ab),_0x298808,_0xc80840(0x199)),loggerService_1[_0xc80840(0x1bc)][_0xc80840(0x175)](_0xc80840(0x1d1),'/create',_0xc80840(0x1e0),_0x1a2c76);const _0x2959aa=await fetch(this[_0xc80840(0x18c)],{'method':_0xc80840(0x1e0),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0xc80840(0x1c9)},'body':JSON[_0xc80840(0x1ca)](_0x1a2c76)}),_0x4ae77c=Date['now']()-_0x408ea3;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0xc80840(0x1ba)](_0xc80840(0x1c2),_0x2959aa[_0xc80840(0x1ce)]),console[_0xc80840(0x1ba)](_0xc80840(0x1c5),_0x2959aa['statusText']),console[_0xc80840(0x1ba)](_0xc80840(0x160),Object[_0xc80840(0x17d)](_0x2959aa[_0xc80840(0x1bb)][_0xc80840(0x1dc)]())),console['log'](_0xc80840(0x189),_0x4ae77c+'ms');const _0x2d7a52=await _0x2959aa[_0xc80840(0x1cf)]();console[_0xc80840(0x1ba)](_0xc80840(0x16b),_0x2d7a52);if(!_0x2959aa['ok']){console[_0xc80840(0x19a)](_0xc80840(0x1cd)),console[_0xc80840(0x19a)](_0xc80840(0x1b9),_0x2959aa[_0xc80840(0x1ce)]),console[_0xc80840(0x19a)](_0xc80840(0x1e2),_0x2d7a52),loggerService_1['loggerService'][_0xc80840(0x19d)](_0xc80840(0x1d1),_0xc80840(0x1b4),_0x2959aa[_0xc80840(0x1ce)],_0x2d7a52,_0x4ae77c),loggerService_1[_0xc80840(0x1bc)][_0xc80840(0x19c)]('cointopay',_0xc80840(0x1b4),_0xc80840(0x1d9)+_0x2959aa['status']+':\x20'+_0x2d7a52);throw new Error(_0xc80840(0x17b)+_0x2959aa[_0xc80840(0x1ce)]+_0xc80840(0x16d)+_0x2d7a52);}let _0x224181;try{_0x224181=JSON[_0xc80840(0x1b1)](_0x2d7a52);}catch(_0x4500d6){console[_0xc80840(0x19a)](_0xc80840(0x163),_0x4500d6),loggerService_1['loggerService'][_0xc80840(0x19c)](_0xc80840(0x1d1),'/create',_0xc80840(0x172)+_0x4500d6);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x2d7a52);}console['log'](_0xc80840(0x1e4)),console[_0xc80840(0x1ba)](_0xc80840(0x16a),JSON[_0xc80840(0x1ca)](_0x224181,null,0x2)),loggerService_1[_0xc80840(0x1bc)][_0xc80840(0x19d)](_0xc80840(0x1d1),_0xc80840(0x1b4),_0x2959aa[_0xc80840(0x1ce)],_0x224181,_0x4ae77c);if(_0x224181['error']){const _0x37206c=_0x224181[_0xc80840(0x1d6)]||_0x224181['error']||_0xc80840(0x176);console[_0xc80840(0x19a)](_0xc80840(0x1b5)),console[_0xc80840(0x19a)](_0xc80840(0x164),_0x37206c),loggerService_1['loggerService'][_0xc80840(0x19c)]('cointopay',_0xc80840(0x1b4),'Business\x20Error:\x20'+_0x37206c);throw new Error(_0xc80840(0x1c6)+_0x37206c);}if(!_0x224181[_0xc80840(0x1af)]||!_0x224181[_0xc80840(0x1da)]){console[_0xc80840(0x19a)](_0xc80840(0x166)),console[_0xc80840(0x19a)](_0xc80840(0x180)),console['error'](_0xc80840(0x1c0),_0x224181),loggerService_1[_0xc80840(0x1bc)][_0xc80840(0x19c)](_0xc80840(0x1d1),'/create',_0xc80840(0x1b7));throw new Error(_0xc80840(0x1cb));}return console['log'](_0xc80840(0x1e5)),console[_0xc80840(0x1ba)](_0xc80840(0x17e),_0x224181[_0xc80840(0x1da)]),console[_0xc80840(0x1ba)](_0xc80840(0x162),_0x224181[_0xc80840(0x1af)]),console[_0xc80840(0x1ba)](_0xc80840(0x1ab),_0x298808,_0xc80840(0x1cc)),{'gateway_payment_id':_0x224181[_0xc80840(0x1da)],'payment_url':_0x224181[_0xc80840(0x1af)]};}catch(_0x5c01b0){console['error'](_0xc80840(0x194)),console[_0xc80840(0x19a)](_0xc80840(0x1b2),_0x5c01b0),loggerService_1[_0xc80840(0x1bc)][_0xc80840(0x19c)](_0xc80840(0x1d1),'/create',_0x5c01b0);if(_0x5c01b0 instanceof Error){console[_0xc80840(0x19a)]('Error\x20message:',_0x5c01b0[_0xc80840(0x1d6)]),console[_0xc80840(0x19a)](_0xc80840(0x168),_0x5c01b0[_0xc80840(0x1d3)]);throw new Error(_0xc80840(0x15c)+_0x5c01b0[_0xc80840(0x1d6)]);}throw new Error(_0xc80840(0x1ad));}}async[a40_0x370109(0x15f)](_0x53d754){const _0x5e4430=a40_0x370109,_0x11759e=Date[_0x5e4430(0x1a9)]();try{console[_0x5e4430(0x1ba)](_0x5e4430(0x18b)+_0x53d754);const _0x25ac0c={'gatewayPaymentId':_0x53d754};loggerService_1[_0x5e4430(0x1bc)][_0x5e4430(0x175)](_0x5e4430(0x1d1),_0x5e4430(0x1c8),_0x5e4430(0x1e0),_0x25ac0c);const _0x59bafe=await fetch(this[_0x5e4430(0x179)],{'method':_0x5e4430(0x1e0),'headers':{'Content-Type':'application/json','Accept':_0x5e4430(0x1ac),'User-Agent':_0x5e4430(0x1c9)},'body':JSON[_0x5e4430(0x1ca)](_0x25ac0c)}),_0x5a2c24=Date[_0x5e4430(0x1a9)]()-_0x11759e;console[_0x5e4430(0x1ba)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x5e4430(0x1ba)](_0x5e4430(0x1c2),_0x59bafe[_0x5e4430(0x1ce)]),console[_0x5e4430(0x1ba)](_0x5e4430(0x189),_0x5a2c24+'ms');if(!_0x59bafe['ok']){const _0x5c4a78=await _0x59bafe[_0x5e4430(0x1cf)]();console[_0x5e4430(0x19a)](_0x5e4430(0x1b9),_0x59bafe['status']),console[_0x5e4430(0x19a)]('Response\x20Body:',_0x5c4a78),loggerService_1[_0x5e4430(0x1bc)][_0x5e4430(0x19d)](_0x5e4430(0x1d1),_0x5e4430(0x1c8),_0x59bafe[_0x5e4430(0x1ce)],_0x5c4a78,_0x5a2c24),loggerService_1['loggerService'][_0x5e4430(0x19c)]('cointopay',_0x5e4430(0x1c8),_0x5e4430(0x1d9)+_0x59bafe['status']+':\x20'+_0x5c4a78);throw new Error(_0x5e4430(0x17b)+_0x59bafe[_0x5e4430(0x1ce)]);}const _0x3452db=await _0x59bafe[_0x5e4430(0x1cf)]();console[_0x5e4430(0x1ba)](_0x5e4430(0x16b),_0x3452db);let _0x4b0c69;try{_0x4b0c69=JSON['parse'](_0x3452db);}catch(_0x36252b){console[_0x5e4430(0x19a)](_0x5e4430(0x163),_0x36252b),loggerService_1[_0x5e4430(0x1bc)][_0x5e4430(0x19c)]('cointopay',_0x5e4430(0x1c8),_0x5e4430(0x172)+_0x36252b);throw new Error(_0x5e4430(0x1c4)+_0x3452db);}loggerService_1[_0x5e4430(0x1bc)][_0x5e4430(0x19d)](_0x5e4430(0x1d1),_0x5e4430(0x1c8),_0x59bafe[_0x5e4430(0x1ce)],_0x4b0c69,_0x5a2c24),console['log'](_0x5e4430(0x161)),console['log'](_0x5e4430(0x19b),_0x4b0c69['result']),console[_0x5e4430(0x1ba)](_0x5e4430(0x19e),_0x4b0c69['status_code']),console[_0x5e4430(0x1ba)]('Payment\x20Status:',_0x4b0c69[_0x5e4430(0x196)]?.[_0x5e4430(0x15e)]),console['log'](_0x5e4430(0x1ab),_0x4b0c69['data']?.[_0x5e4430(0x173)]),console[_0x5e4430(0x1ba)](_0x5e4430(0x1a4),_0x4b0c69['data']?.[_0x5e4430(0x1a0)]);if(_0x4b0c69[_0x5e4430(0x182)]!==_0x5e4430(0x184)||_0x4b0c69[_0x5e4430(0x165)]!==0xc8){const _0x4f8c58=_0x4b0c69[_0x5e4430(0x1d6)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x5e4430(0x19a)](_0x5e4430(0x187)),console[_0x5e4430(0x19a)](_0x5e4430(0x164),_0x4f8c58),loggerService_1[_0x5e4430(0x1bc)][_0x5e4430(0x19c)](_0x5e4430(0x1d1),'/status',_0x5e4430(0x1d0)+_0x4f8c58);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x4f8c58);}if(!_0x4b0c69[_0x5e4430(0x196)]){console[_0x5e4430(0x19a)](_0x5e4430(0x18f)),console[_0x5e4430(0x19a)](_0x5e4430(0x192)),loggerService_1[_0x5e4430(0x1bc)]['logWhiteDomainError'](_0x5e4430(0x1d1),_0x5e4430(0x1c8),_0x5e4430(0x1d8));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x53c4c5=_0x5e4430(0x181);switch(_0x4b0c69[_0x5e4430(0x196)][_0x5e4430(0x15e)]?.[_0x5e4430(0x17a)]()){case _0x5e4430(0x1c1):_0x53c4c5=_0x5e4430(0x16c);break;case'cancelled':case'failed':case _0x5e4430(0x19a):_0x53c4c5=_0x5e4430(0x15d);break;case _0x5e4430(0x1ae):case'timeout':_0x53c4c5=_0x5e4430(0x18d);break;case _0x5e4430(0x1aa):case'awaiting\x20fiat':case _0x5e4430(0x1be):case _0x5e4430(0x174):default:_0x53c4c5=_0x5e4430(0x181);break;}let _0x19acf7,_0x31844d;if(_0x4b0c69['data'][_0x5e4430(0x1b6)]){const _0x2604e1=_0x4b0c69[_0x5e4430(0x196)][_0x5e4430(0x1b6)];console[_0x5e4430(0x1ba)](_0x5e4430(0x1e1),_0x2604e1);const _0x208fbf=_0x2604e1[_0x5e4430(0x1a7)](/IBAN\s+([A-Z0-9]+)/i);_0x208fbf&&(_0x19acf7=_0x208fbf[0x1],console[_0x5e4430(0x1ba)](_0x5e4430(0x1db),_0x19acf7)),_0x31844d=_0x2604e1;}const _0xd311cb={'iban':_0x19acf7,'bankDetails':_0x31844d,'transactionId':_0x4b0c69['data'][_0x5e4430(0x1dd)],'coinAddress':_0x4b0c69[_0x5e4430(0x196)][_0x5e4430(0x1d7)],'qrCodeUrl':_0x4b0c69['data'][_0x5e4430(0x1df)],'expiryTime':_0x4b0c69[_0x5e4430(0x196)][_0x5e4430(0x16f)],'createdOn':_0x4b0c69['data'][_0x5e4430(0x185)],'confirmedOn':_0x4b0c69[_0x5e4430(0x196)][_0x5e4430(0x1d5)]};console[_0x5e4430(0x1ba)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x5e4430(0x1ba)](_0x5e4430(0x1c2),_0x4b0c69[_0x5e4430(0x196)][_0x5e4430(0x15e)],'->',_0x53c4c5),console['log'](_0x5e4430(0x1ab),_0x4b0c69[_0x5e4430(0x196)]['Amount'],_0x4b0c69[_0x5e4430(0x196)][_0x5e4430(0x1a0)]),console[_0x5e4430(0x1ba)](_0x5e4430(0x1a1),_0x4b0c69['data'][_0x5e4430(0x1dd)]),console[_0x5e4430(0x1ba)]('IBAN:',_0x19acf7||_0x5e4430(0x1de)),console[_0x5e4430(0x1ba)](_0x5e4430(0x16e),_0x4b0c69['data']['CreatedOn']),console[_0x5e4430(0x1ba)](_0x5e4430(0x1a3),_0x4b0c69[_0x5e4430(0x196)][_0x5e4430(0x1d5)]||'not\x20confirmed');if(_0x4b0c69[_0x5e4430(0x196)]['Status']?.[_0x5e4430(0x17a)]()===_0x5e4430(0x1b8))console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x4b0c69[_0x5e4430(0x196)]['Status']?.[_0x5e4430(0x17a)]()===_0x5e4430(0x1c1)&&console[_0x5e4430(0x1ba)](_0x5e4430(0x193));return{'status':_0x53c4c5,'amount':parseFloat(_0x4b0c69[_0x5e4430(0x196)][_0x5e4430(0x173)])||undefined,'currency':_0x4b0c69['data'][_0x5e4430(0x1a0)]||_0x5e4430(0x1cc),'paymentDetails':_0xd311cb};}catch(_0x1cfca4){console[_0x5e4430(0x19a)](_0x5e4430(0x178),_0x1cfca4),loggerService_1['loggerService'][_0x5e4430(0x19c)](_0x5e4430(0x1d1),_0x5e4430(0x1c8),_0x1cfca4);throw new Error(_0x5e4430(0x177)+(_0x1cfca4 instanceof Error?_0x1cfca4['message']:_0x5e4430(0x17c)));}}async['verifyPayment'](_0x3698ed){const _0x422d60=a40_0x370109,_0x1f949c=await this[_0x422d60(0x15f)](_0x3698ed);return{'status':_0x1f949c[_0x422d60(0x1ce)],'amount':_0x1f949c[_0x422d60(0x18e)],'currency':_0x1f949c[_0x422d60(0x190)]};}async[a40_0x370109(0x170)](_0x24c2e4){const _0x14a761=a40_0x370109;console[_0x14a761(0x1ba)](_0x14a761(0x1b0),_0x24c2e4);let _0x245028=_0x14a761(0x181);switch(_0x24c2e4[_0x14a761(0x1ce)]?.[_0x14a761(0x17a)]()){case'paid':_0x245028='PAID';break;case _0x14a761(0x198):case _0x14a761(0x167):case _0x14a761(0x19a):_0x245028=_0x14a761(0x15d);break;case _0x14a761(0x1ae):case _0x14a761(0x1c7):_0x245028=_0x14a761(0x18d);break;case _0x14a761(0x1be):case'waiting':case _0x14a761(0x1b8):case'created':default:_0x245028='PENDING';break;}return{'paymentId':_0x24c2e4['order_id']||_0x24c2e4[_0x14a761(0x195)]||'','status':_0x245028,'amount':_0x24c2e4[_0x14a761(0x18e)],'currency':_0x24c2e4[_0x14a761(0x190)]||_0x14a761(0x1cc)};}}exports[a40_0x370109(0x1d4)]=CoinToPayService;