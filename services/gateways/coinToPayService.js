'use strict';function a49_0x3028(){const _0x21e90d=['Confirmed\x20On:','pending','QRCodeURL','Unknown\x20error\x20from\x20CoinToPay\x20API','logWhiteDomainResponse','Missing\x20data\x20in\x20response','not\x20found','3032EdKVBC','PAID','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','error','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','now','paid','Headers:','Error\x20message:','awaiting\x20fiat','fromEntries','üè¶\x20Payment\x20Detail:','Status','Status:','Error\x20stack:','POST','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','message','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','FAILED','waiting','inputCurrency','text','üìä\x20Status\x20check\x20URL:','success','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','headers','payment_url','HTTP\x20Status:','2346lWPTTY','https://tesoft.uk/gateway/cointopay/','__esModule','Gateway\x20Payment\x20ID:','order_id','EXPIRED','Incomplete\x20response:\x20missing\x20data','Amount:','Unknown\x20error','Response\x20Time:','PENDING','cointopay','entries','166720qABJyC','failed','/status','Request\x20Body:','üè¶\x20Extracted\x20IBAN:','statusUrl','Status\x20Text:','gateway_payment_id','HTTP\x20','loggerService','cancelled','\x20EUR','status_code','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','PaymentDetail','Error\x20Message:','Transaction\x20ID:','not\x20confirmed','Payment\x20System/1.0','211979wBjLMg','Response\x20Body:','statusText','processWebhook','result','logWhiteDomainError','HTTP\x20error!\x20status:\x20','2159528JcgbWn','createPaymentLink','verifyPayment','log','Amount','currency','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','expired','54XSJULf','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Failed\x20to\x20parse\x20JSON\x20response:','ExpiryTime','checkPaymentStatus','CoinToPay\x20payment\x20status\x20check\x20error:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','status','amount','merchant_reference_id',',\x20body:\x20','defineProperty','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','URL:','toLowerCase','timeout','data','created','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','TransactionConfirmedOn','9085500jRbJSr','/create','24nmzYVH','IBAN:','Parsed\x20Result:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','apiUrl','Raw\x20Response\x20Body:','EUR','4165540PwFHNm','&alternative=false','Result:','parse','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','TransactionID','1560861nMaHCj','application/json','CreatedOn','stringify','match','Status\x20Code:','JSON\x20Parse\x20Error:\x20','https://tesoft.uk/gateway/cointopay/status.php'];a49_0x3028=function(){return _0x21e90d;};return a49_0x3028();}const a49_0x3a9740=a49_0x1f5c;function a49_0x1f5c(_0x42d597,_0x45dbbd){const _0x302814=a49_0x3028();return a49_0x1f5c=function(_0x1f5cfd,_0x4a1fab){_0x1f5cfd=_0x1f5cfd-0x75;let _0x62e135=_0x302814[_0x1f5cfd];return _0x62e135;},a49_0x1f5c(_0x42d597,_0x45dbbd);}(function(_0x1639f8,_0x2a0db7){const _0xdc231f=a49_0x1f5c,_0x41c89b=_0x1639f8();while(!![]){try{const _0x470ae5=parseInt(_0xdc231f(0xa4))/0x1+-parseInt(_0xdc231f(0xe9))/0x2*(-parseInt(_0xdc231f(0x84))/0x3)+-parseInt(_0xdc231f(0xd4))/0x4+-parseInt(_0xdc231f(0x91))/0x5*(-parseInt(_0xdc231f(0xb3))/0x6)+-parseInt(_0xdc231f(0xab))/0x7+parseInt(_0xdc231f(0xcd))/0x8*(-parseInt(_0xdc231f(0xda))/0x9)+parseInt(_0xdc231f(0xcb))/0xa;if(_0x470ae5===_0x2a0db7)break;else _0x41c89b['push'](_0x41c89b['shift']());}catch(_0x571a1f){_0x41c89b['push'](_0x41c89b['shift']());}}}(a49_0x3028,0xb3ad9));Object[a49_0x3a9740(0xbe)](exports,a49_0x3a9740(0x86),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x336e82=a49_0x3a9740;this[_0x336e82(0xd1)]=_0x336e82(0x85),this['statusUrl']=_0x336e82(0xe1),console[_0x336e82(0xae)](_0x336e82(0xc8)),console['log'](_0x336e82(0x7e),this[_0x336e82(0x96)]);}async[a49_0x3a9740(0xac)](_0x28cae5){const _0x518aee=a49_0x3a9740,{orderId:_0x3f996d,amount:_0x8a823b}=_0x28cae5;console['log'](_0x518aee(0xc1)+_0x8a823b+_0x518aee(0x9c));const _0xa1958c={'amount':_0x8a823b},_0x106f27=Date['now']();try{console[_0x518aee(0xae)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x518aee(0xae)](_0x518aee(0xc3),this[_0x518aee(0xd1)]),console[_0x518aee(0xae)](_0x518aee(0x94),JSON[_0x518aee(0xdd)](_0xa1958c,null,0x2)),console[_0x518aee(0xae)](_0x518aee(0x8b),_0x8a823b,_0x518aee(0x78)),loggerService_1[_0x518aee(0x9a)]['logWhiteDomainRequest'](_0x518aee(0x8f),_0x518aee(0xcc),_0x518aee(0xf9),_0xa1958c);const _0x222ed3=await fetch(this[_0x518aee(0xd1)],{'method':_0x518aee(0xf9),'headers':{'Content-Type':'application/json','Accept':_0x518aee(0xdb),'User-Agent':_0x518aee(0xa3)},'body':JSON[_0x518aee(0xdd)](_0xa1958c)}),_0x16989f=Date[_0x518aee(0xef)]()-_0x106f27;console[_0x518aee(0xae)](_0x518aee(0xeb)),console[_0x518aee(0xae)]('Status:',_0x222ed3[_0x518aee(0xba)]),console[_0x518aee(0xae)](_0x518aee(0x97),_0x222ed3[_0x518aee(0xa6)]),console['log'](_0x518aee(0xf1),Object[_0x518aee(0xf4)](_0x222ed3[_0x518aee(0x81)][_0x518aee(0x90)]())),console[_0x518aee(0xae)](_0x518aee(0x8d),_0x16989f+'ms');const _0x2af8f1=await _0x222ed3[_0x518aee(0x7d)]();console[_0x518aee(0xae)](_0x518aee(0xd2),_0x2af8f1);if(!_0x222ed3['ok']){console[_0x518aee(0xec)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x518aee(0xec)](_0x518aee(0x83),_0x222ed3[_0x518aee(0xba)]),console[_0x518aee(0xec)](_0x518aee(0xa5),_0x2af8f1),loggerService_1[_0x518aee(0x9a)]['logWhiteDomainResponse'](_0x518aee(0x8f),_0x518aee(0xcc),_0x222ed3[_0x518aee(0xba)],_0x2af8f1,_0x16989f),loggerService_1[_0x518aee(0x9a)]['logWhiteDomainError'](_0x518aee(0x8f),_0x518aee(0xcc),_0x518aee(0x99)+_0x222ed3['status']+':\x20'+_0x2af8f1);throw new Error(_0x518aee(0xaa)+_0x222ed3[_0x518aee(0xba)]+_0x518aee(0xbd)+_0x2af8f1);}let _0xd8818f;try{_0xd8818f=JSON[_0x518aee(0xd7)](_0x2af8f1);}catch(_0x33be0d){console[_0x518aee(0xec)](_0x518aee(0xb5),_0x33be0d),loggerService_1[_0x518aee(0x9a)][_0x518aee(0xa9)]('cointopay',_0x518aee(0xcc),_0x518aee(0xe0)+_0x33be0d);throw new Error(_0x518aee(0xed)+_0x2af8f1);}console[_0x518aee(0xae)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x518aee(0xae)](_0x518aee(0xcf),JSON[_0x518aee(0xdd)](_0xd8818f,null,0x2)),loggerService_1[_0x518aee(0x9a)][_0x518aee(0xe6)](_0x518aee(0x8f),_0x518aee(0xcc),_0x222ed3[_0x518aee(0xba)],_0xd8818f,_0x16989f);if(_0xd8818f['error']){const _0x2b3742=_0xd8818f[_0x518aee(0x76)]||_0xd8818f[_0x518aee(0xec)]||_0x518aee(0xe5);console['error'](_0x518aee(0xbf)),console[_0x518aee(0xec)](_0x518aee(0xa0),_0x2b3742),loggerService_1[_0x518aee(0x9a)]['logWhiteDomainError'](_0x518aee(0x8f),_0x518aee(0xcc),'Business\x20Error:\x20'+_0x2b3742);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x2b3742);}if(!_0xd8818f[_0x518aee(0x82)]||!_0xd8818f[_0x518aee(0x98)]){console[_0x518aee(0xec)](_0x518aee(0x75)),console[_0x518aee(0xec)](_0x518aee(0x79)),console[_0x518aee(0xec)]('Response\x20data:',_0xd8818f),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x518aee(0xcc),_0x518aee(0xb1));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x518aee(0xae)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x518aee(0xae)](_0x518aee(0x87),_0xd8818f[_0x518aee(0x98)]),console[_0x518aee(0xae)]('Payment\x20URL\x20(original):',_0xd8818f[_0x518aee(0x82)]);const _0x25b511=_0xd8818f[_0x518aee(0x82)]+_0x518aee(0xd5);return console[_0x518aee(0xae)]('Payment\x20URL\x20(modified):',_0x25b511),console['log'](_0x518aee(0x8b),_0x8a823b,_0x518aee(0xd3)),{'gateway_payment_id':_0xd8818f['gateway_payment_id'],'payment_url':_0x25b511};}catch(_0x4aa779){console[_0x518aee(0xec)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x518aee(0xec)]('Error\x20details:',_0x4aa779),loggerService_1['loggerService'][_0x518aee(0xa9)]('cointopay',_0x518aee(0xcc),_0x4aa779);if(_0x4aa779 instanceof Error){console[_0x518aee(0xec)](_0x518aee(0xf2),_0x4aa779['message']),console[_0x518aee(0xec)](_0x518aee(0xf8),_0x4aa779['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x4aa779[_0x518aee(0x76)]);}throw new Error(_0x518aee(0x80));}}async[a49_0x3a9740(0xb7)](_0x3cd4db){const _0x3b5846=a49_0x3a9740,_0x37fcc5=Date[_0x3b5846(0xef)]();try{console[_0x3b5846(0xae)](_0x3b5846(0xd8)+_0x3cd4db);const _0x1be0a8={'gatewayPaymentId':_0x3cd4db};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x3b5846(0x8f),'/status',_0x3b5846(0xf9),_0x1be0a8);const _0x2fabbf=await fetch(this['statusUrl'],{'method':_0x3b5846(0xf9),'headers':{'Content-Type':'application/json','Accept':_0x3b5846(0xdb),'User-Agent':_0x3b5846(0xa3)},'body':JSON[_0x3b5846(0xdd)](_0x1be0a8)}),_0x26c4f6=Date['now']()-_0x37fcc5;console[_0x3b5846(0xae)](_0x3b5846(0x77)),console[_0x3b5846(0xae)]('Status:',_0x2fabbf[_0x3b5846(0xba)]),console[_0x3b5846(0xae)](_0x3b5846(0x8d),_0x26c4f6+'ms');if(!_0x2fabbf['ok']){const _0x49f24b=await _0x2fabbf[_0x3b5846(0x7d)]();console[_0x3b5846(0xec)](_0x3b5846(0x83),_0x2fabbf[_0x3b5846(0xba)]),console[_0x3b5846(0xec)]('Response\x20Body:',_0x49f24b),loggerService_1[_0x3b5846(0x9a)][_0x3b5846(0xe6)](_0x3b5846(0x8f),'/status',_0x2fabbf[_0x3b5846(0xba)],_0x49f24b,_0x26c4f6),loggerService_1[_0x3b5846(0x9a)][_0x3b5846(0xa9)](_0x3b5846(0x8f),_0x3b5846(0x93),'HTTP\x20'+_0x2fabbf[_0x3b5846(0xba)]+':\x20'+_0x49f24b);throw new Error(_0x3b5846(0xaa)+_0x2fabbf[_0x3b5846(0xba)]);}const _0x400535=await _0x2fabbf[_0x3b5846(0x7d)]();console[_0x3b5846(0xae)](_0x3b5846(0xd2),_0x400535);let _0x30f87f;try{_0x30f87f=JSON[_0x3b5846(0xd7)](_0x400535);}catch(_0x25c694){console['error'](_0x3b5846(0xb5),_0x25c694),loggerService_1['loggerService']['logWhiteDomainError'](_0x3b5846(0x8f),_0x3b5846(0x93),'JSON\x20Parse\x20Error:\x20'+_0x25c694);throw new Error(_0x3b5846(0xc0)+_0x400535);}loggerService_1[_0x3b5846(0x9a)]['logWhiteDomainResponse'](_0x3b5846(0x8f),_0x3b5846(0x93),_0x2fabbf[_0x3b5846(0xba)],_0x30f87f,_0x26c4f6),console[_0x3b5846(0xae)](_0x3b5846(0x9e)),console[_0x3b5846(0xae)](_0x3b5846(0xd6),_0x30f87f[_0x3b5846(0xa8)]),console[_0x3b5846(0xae)](_0x3b5846(0xdf),_0x30f87f[_0x3b5846(0x9d)]),console['log']('Payment\x20Status:',_0x30f87f[_0x3b5846(0xc6)]?.['Status']),console[_0x3b5846(0xae)]('Amount:',_0x30f87f[_0x3b5846(0xc6)]?.[_0x3b5846(0xaf)]),console[_0x3b5846(0xae)]('Currency:',_0x30f87f['data']?.[_0x3b5846(0x7c)]);if(_0x30f87f['result']!==_0x3b5846(0x7f)||_0x30f87f[_0x3b5846(0x9d)]!==0xc8){const _0x1a10bf=_0x30f87f['message']||_0x3b5846(0xee);console[_0x3b5846(0xec)](_0x3b5846(0xc2)),console[_0x3b5846(0xec)](_0x3b5846(0xa0),_0x1a10bf),loggerService_1['loggerService'][_0x3b5846(0xa9)]('cointopay',_0x3b5846(0x93),'Status\x20API\x20Error:\x20'+_0x1a10bf);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x1a10bf);}if(!_0x30f87f['data']){console[_0x3b5846(0xec)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3b5846(0xec)](_0x3b5846(0xe7)),loggerService_1[_0x3b5846(0x9a)]['logWhiteDomainError'](_0x3b5846(0x8f),_0x3b5846(0x93),_0x3b5846(0x8a));throw new Error(_0x3b5846(0xd0));}let _0x29fbdf=_0x3b5846(0x8e);switch(_0x30f87f['data'][_0x3b5846(0xf6)]?.[_0x3b5846(0xc4)]()){case _0x3b5846(0xf0):_0x29fbdf=_0x3b5846(0xea);break;case'cancelled':case _0x3b5846(0x92):case _0x3b5846(0xec):_0x29fbdf=_0x3b5846(0x7a);break;case _0x3b5846(0xb2):case _0x3b5846(0xc5):_0x29fbdf=_0x3b5846(0x89);break;case _0x3b5846(0x7b):case _0x3b5846(0xf3):case _0x3b5846(0xe3):case _0x3b5846(0xc7):default:_0x29fbdf=_0x3b5846(0x8e);break;}let _0x20ee52,_0x45dfc4;if(_0x30f87f[_0x3b5846(0xc6)]['PaymentDetail']){const _0x33bdf3=_0x30f87f[_0x3b5846(0xc6)][_0x3b5846(0x9f)];console[_0x3b5846(0xae)](_0x3b5846(0xf5),_0x33bdf3);const _0x427145=_0x33bdf3[_0x3b5846(0xde)](/IBAN\s+([A-Z0-9]+)/i);_0x427145&&(_0x20ee52=_0x427145[0x1],console['log'](_0x3b5846(0x95),_0x20ee52)),_0x45dfc4=_0x33bdf3;}const _0xba46ce={'iban':_0x20ee52,'bankDetails':_0x45dfc4,'transactionId':_0x30f87f[_0x3b5846(0xc6)][_0x3b5846(0xd9)],'coinAddress':_0x30f87f[_0x3b5846(0xc6)]['coinAddress'],'qrCodeUrl':_0x30f87f[_0x3b5846(0xc6)][_0x3b5846(0xe4)],'expiryTime':_0x30f87f['data'][_0x3b5846(0xb6)],'createdOn':_0x30f87f[_0x3b5846(0xc6)][_0x3b5846(0xdc)],'confirmedOn':_0x30f87f['data'][_0x3b5846(0xca)]};console[_0x3b5846(0xae)](_0x3b5846(0xc9)),console[_0x3b5846(0xae)](_0x3b5846(0xf7),_0x30f87f['data'][_0x3b5846(0xf6)],'->',_0x29fbdf),console[_0x3b5846(0xae)](_0x3b5846(0x8b),_0x30f87f[_0x3b5846(0xc6)]['Amount'],_0x30f87f['data'][_0x3b5846(0x7c)]),console[_0x3b5846(0xae)](_0x3b5846(0xa1),_0x30f87f[_0x3b5846(0xc6)][_0x3b5846(0xd9)]),console[_0x3b5846(0xae)](_0x3b5846(0xce),_0x20ee52||_0x3b5846(0xe8)),console[_0x3b5846(0xae)]('Created\x20On:',_0x30f87f[_0x3b5846(0xc6)][_0x3b5846(0xdc)]),console['log'](_0x3b5846(0xe2),_0x30f87f[_0x3b5846(0xc6)][_0x3b5846(0xca)]||_0x3b5846(0xa2));if(_0x30f87f[_0x3b5846(0xc6)][_0x3b5846(0xf6)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x3b5846(0xae)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x30f87f['data'][_0x3b5846(0xf6)]?.[_0x3b5846(0xc4)]()===_0x3b5846(0xf0)&&console[_0x3b5846(0xae)](_0x3b5846(0xb9));return{'status':_0x29fbdf,'amount':parseFloat(_0x30f87f['data'][_0x3b5846(0xaf)])||undefined,'currency':_0x30f87f[_0x3b5846(0xc6)][_0x3b5846(0x7c)]||'EUR','paymentDetails':_0xba46ce};}catch(_0x3b84db){console[_0x3b5846(0xec)](_0x3b5846(0xb8),_0x3b84db),loggerService_1['loggerService'][_0x3b5846(0xa9)](_0x3b5846(0x8f),_0x3b5846(0x93),_0x3b84db);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x3b84db instanceof Error?_0x3b84db[_0x3b5846(0x76)]:_0x3b5846(0x8c)));}}async[a49_0x3a9740(0xad)](_0x436600){const _0x4d4ae9=a49_0x3a9740,_0x3b85fe=await this[_0x4d4ae9(0xb7)](_0x436600);return{'status':_0x3b85fe['status'],'amount':_0x3b85fe[_0x4d4ae9(0xbb)],'currency':_0x3b85fe[_0x4d4ae9(0xb0)]};}async[a49_0x3a9740(0xa7)](_0x1ed273){const _0x368907=a49_0x3a9740;console[_0x368907(0xae)](_0x368907(0xb4),_0x1ed273);let _0x44cc97=_0x368907(0x8e);switch(_0x1ed273[_0x368907(0xba)]?.[_0x368907(0xc4)]()){case _0x368907(0xf0):_0x44cc97=_0x368907(0xea);break;case _0x368907(0x9b):case _0x368907(0x92):case _0x368907(0xec):_0x44cc97='FAILED';break;case'expired':case _0x368907(0xc5):_0x44cc97=_0x368907(0x89);break;case'pending':case'waiting':case _0x368907(0xf3):case _0x368907(0xc7):default:_0x44cc97=_0x368907(0x8e);break;}return{'paymentId':_0x1ed273[_0x368907(0x88)]||_0x1ed273[_0x368907(0xbc)]||'','status':_0x44cc97,'amount':_0x1ed273[_0x368907(0xbb)],'currency':_0x1ed273[_0x368907(0xb0)]||'EUR'};}}exports['CoinToPayService']=CoinToPayService;