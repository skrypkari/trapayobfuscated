'use strict';const a40_0x502b9c=a40_0x7f0c;(function(_0x10354,_0xa8ff63){const _0x2d5677=a40_0x7f0c,_0x544a4d=_0x10354();while(!![]){try{const _0x4a08cf=-parseInt(_0x2d5677(0x118))/0x1+parseInt(_0x2d5677(0x12a))/0x2+parseInt(_0x2d5677(0xd1))/0x3*(-parseInt(_0x2d5677(0xd6))/0x4)+-parseInt(_0x2d5677(0x146))/0x5*(-parseInt(_0x2d5677(0x139))/0x6)+parseInt(_0x2d5677(0x109))/0x7+-parseInt(_0x2d5677(0xdb))/0x8+parseInt(_0x2d5677(0xee))/0x9;if(_0x4a08cf===_0xa8ff63)break;else _0x544a4d['push'](_0x544a4d['shift']());}catch(_0x62fba5){_0x544a4d['push'](_0x544a4d['shift']());}}}(a40_0xd3cb,0xb2d08));Object[a40_0x502b9c(0xe1)](exports,a40_0x502b9c(0xf5),{'value':!![]}),exports[a40_0x502b9c(0x122)]=void 0x0;const loggerService_1=require(a40_0x502b9c(0x13e));class CoinToPayService{constructor(){const _0x4d1ee9=a40_0x502b9c;this[_0x4d1ee9(0x141)]='https://tesoft.uk/gateway/cointopay/',this[_0x4d1ee9(0xdc)]=_0x4d1ee9(0xea),console['log'](_0x4d1ee9(0x129)),console['log']('📊\x20Status\x20check\x20URL:',this[_0x4d1ee9(0xdc)]);}async[a40_0x502b9c(0xdf)](_0x1d34c3){const _0x4d602a=a40_0x502b9c,{orderId:_0x1aef71,amount:_0x35a487}=_0x1d34c3;console[_0x4d602a(0xed)](_0x4d602a(0xc0)+_0x35a487+'\x20EUR');const _0x5b99e0={'amount':_0x35a487},_0x23c7d0=Date['now']();try{console[_0x4d602a(0xed)](_0x4d602a(0xe8)),console[_0x4d602a(0xed)](_0x4d602a(0xf4),this[_0x4d602a(0x141)]),console[_0x4d602a(0xed)](_0x4d602a(0x131),JSON[_0x4d602a(0x100)](_0x5b99e0,null,0x2)),console[_0x4d602a(0xed)](_0x4d602a(0xd7),_0x35a487,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x4d602a(0x107),_0x4d602a(0xec),_0x4d602a(0x140),_0x5b99e0);const _0x8e31ed=await fetch(this['apiUrl'],{'method':_0x4d602a(0x140),'headers':{'Content-Type':_0x4d602a(0x11a),'Accept':_0x4d602a(0x11a),'User-Agent':_0x4d602a(0xeb)},'body':JSON[_0x4d602a(0x100)](_0x5b99e0)}),_0xeadf0b=Date[_0x4d602a(0x11d)]()-_0x23c7d0;console[_0x4d602a(0xed)](_0x4d602a(0x115)),console[_0x4d602a(0xed)](_0x4d602a(0xc8),_0x8e31ed[_0x4d602a(0xf8)]),console[_0x4d602a(0xed)](_0x4d602a(0xc2),_0x8e31ed[_0x4d602a(0x106)]),console[_0x4d602a(0xed)](_0x4d602a(0xf2),Object[_0x4d602a(0x117)](_0x8e31ed[_0x4d602a(0xfe)][_0x4d602a(0xcc)]())),console[_0x4d602a(0xed)](_0x4d602a(0x13f),_0xeadf0b+'ms');const _0x5481c5=await _0x8e31ed['text']();console[_0x4d602a(0xed)]('Raw\x20Response\x20Body:',_0x5481c5);if(!_0x8e31ed['ok']){console['error'](_0x4d602a(0x130)),console[_0x4d602a(0x143)](_0x4d602a(0x127),_0x8e31ed[_0x4d602a(0xf8)]),console['error']('Response\x20Body:',_0x5481c5),loggerService_1[_0x4d602a(0xf6)][_0x4d602a(0x113)](_0x4d602a(0x107),_0x4d602a(0xec),_0x8e31ed['status'],_0x5481c5,_0xeadf0b),loggerService_1['loggerService'][_0x4d602a(0x138)](_0x4d602a(0x107),'/create',_0x4d602a(0x142)+_0x8e31ed[_0x4d602a(0xf8)]+':\x20'+_0x5481c5);throw new Error(_0x4d602a(0x119)+_0x8e31ed[_0x4d602a(0xf8)]+_0x4d602a(0x134)+_0x5481c5);}let _0x4eaa03;try{_0x4eaa03=JSON[_0x4d602a(0x135)](_0x5481c5);}catch(_0x2d31ae){console[_0x4d602a(0x143)](_0x4d602a(0xca),_0x2d31ae),loggerService_1[_0x4d602a(0xf6)][_0x4d602a(0x138)]('cointopay',_0x4d602a(0xec),_0x4d602a(0x103)+_0x2d31ae);throw new Error(_0x4d602a(0xe3)+_0x5481c5);}console[_0x4d602a(0xed)](_0x4d602a(0x13a)),console[_0x4d602a(0xed)](_0x4d602a(0x111),JSON[_0x4d602a(0x100)](_0x4eaa03,null,0x2)),loggerService_1['loggerService'][_0x4d602a(0x113)](_0x4d602a(0x107),_0x4d602a(0xec),_0x8e31ed['status'],_0x4eaa03,_0xeadf0b);if(_0x4eaa03['error']){const _0x281d0f=_0x4eaa03[_0x4d602a(0x120)]||_0x4eaa03[_0x4d602a(0x143)]||_0x4d602a(0x128);console[_0x4d602a(0x143)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x4d602a(0xfc),_0x281d0f),loggerService_1[_0x4d602a(0xf6)][_0x4d602a(0x138)]('cointopay',_0x4d602a(0xec),_0x4d602a(0x101)+_0x281d0f);throw new Error(_0x4d602a(0xf3)+_0x281d0f);}if(!_0x4eaa03[_0x4d602a(0x147)]||!_0x4eaa03[_0x4d602a(0x10a)]){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4d602a(0x143)](_0x4d602a(0xc7)),console[_0x4d602a(0x143)](_0x4d602a(0xda),_0x4eaa03),loggerService_1[_0x4d602a(0xf6)]['logWhiteDomainError'](_0x4d602a(0x107),_0x4d602a(0xec),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x4d602a(0xd4));}return console[_0x4d602a(0xed)](_0x4d602a(0x104)),console[_0x4d602a(0xed)](_0x4d602a(0x148),_0x4eaa03[_0x4d602a(0x10a)]),console[_0x4d602a(0xed)]('Payment\x20URL:',_0x4eaa03[_0x4d602a(0x147)]),console[_0x4d602a(0xed)](_0x4d602a(0xd7),_0x35a487,_0x4d602a(0x12f)),{'gateway_payment_id':_0x4eaa03['gateway_payment_id'],'payment_url':_0x4eaa03[_0x4d602a(0x147)]};}catch(_0x595ef3){console[_0x4d602a(0x143)](_0x4d602a(0x126)),console[_0x4d602a(0x143)](_0x4d602a(0xfa),_0x595ef3),loggerService_1['loggerService']['logWhiteDomainError'](_0x4d602a(0x107),_0x4d602a(0xec),_0x595ef3);if(_0x595ef3 instanceof Error){console[_0x4d602a(0x143)](_0x4d602a(0xf0),_0x595ef3[_0x4d602a(0x120)]),console[_0x4d602a(0x143)]('Error\x20stack:',_0x595ef3[_0x4d602a(0xd3)]);throw new Error(_0x4d602a(0xff)+_0x595ef3[_0x4d602a(0x120)]);}throw new Error(_0x4d602a(0x137));}}async[a40_0x502b9c(0x10d)](_0x404db9){const _0xcaa55e=a40_0x502b9c,_0x1976b3=Date[_0xcaa55e(0x11d)]();try{console[_0xcaa55e(0xed)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x404db9);const _0x4c3fe2={'gatewayPaymentId':_0x404db9};loggerService_1[_0xcaa55e(0xf6)][_0xcaa55e(0xe6)](_0xcaa55e(0x107),_0xcaa55e(0xf9),_0xcaa55e(0x140),_0x4c3fe2);const _0x71d596=await fetch(this[_0xcaa55e(0xdc)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0xcaa55e(0x11a),'User-Agent':_0xcaa55e(0xeb)},'body':JSON[_0xcaa55e(0x100)](_0x4c3fe2)}),_0x1b8233=Date[_0xcaa55e(0x11d)]()-_0x1976b3;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0xcaa55e(0xed)](_0xcaa55e(0xc8),_0x71d596[_0xcaa55e(0xf8)]),console[_0xcaa55e(0xed)](_0xcaa55e(0x13f),_0x1b8233+'ms');if(!_0x71d596['ok']){const _0x57e408=await _0x71d596[_0xcaa55e(0x12c)]();console['error'](_0xcaa55e(0x127),_0x71d596[_0xcaa55e(0xf8)]),console['error'](_0xcaa55e(0xd8),_0x57e408),loggerService_1[_0xcaa55e(0xf6)][_0xcaa55e(0x113)](_0xcaa55e(0x107),_0xcaa55e(0xf9),_0x71d596[_0xcaa55e(0xf8)],_0x57e408,_0x1b8233),loggerService_1[_0xcaa55e(0xf6)][_0xcaa55e(0x138)](_0xcaa55e(0x107),_0xcaa55e(0xf9),_0xcaa55e(0x142)+_0x71d596['status']+':\x20'+_0x57e408);throw new Error(_0xcaa55e(0x119)+_0x71d596[_0xcaa55e(0xf8)]);}const _0x4bc372=await _0x71d596['text']();console[_0xcaa55e(0xed)](_0xcaa55e(0x10b),_0x4bc372);let _0x458ca8;try{_0x458ca8=JSON['parse'](_0x4bc372);}catch(_0x226558){console[_0xcaa55e(0x143)](_0xcaa55e(0xca),_0x226558),loggerService_1[_0xcaa55e(0xf6)][_0xcaa55e(0x138)](_0xcaa55e(0x107),_0xcaa55e(0xf9),_0xcaa55e(0x103)+_0x226558);throw new Error(_0xcaa55e(0x121)+_0x4bc372);}loggerService_1[_0xcaa55e(0xf6)][_0xcaa55e(0x113)]('cointopay',_0xcaa55e(0xf9),_0x71d596[_0xcaa55e(0xf8)],_0x458ca8,_0x1b8233),console[_0xcaa55e(0xed)](_0xcaa55e(0xde)),console[_0xcaa55e(0xed)]('Result:',_0x458ca8[_0xcaa55e(0xce)]),console[_0xcaa55e(0xed)](_0xcaa55e(0x108),_0x458ca8[_0xcaa55e(0x124)]),console[_0xcaa55e(0xed)]('Payment\x20Status:',_0x458ca8[_0xcaa55e(0x114)]?.['Status']),console[_0xcaa55e(0xed)](_0xcaa55e(0xd7),_0x458ca8['data']?.[_0xcaa55e(0x10e)]),console[_0xcaa55e(0xed)](_0xcaa55e(0xef),_0x458ca8[_0xcaa55e(0x114)]?.[_0xcaa55e(0x11c)]);if(_0x458ca8[_0xcaa55e(0xce)]!==_0xcaa55e(0xfd)||_0x458ca8[_0xcaa55e(0x124)]!==0xc8){const _0x14e835=_0x458ca8['message']||_0xcaa55e(0xc4);console['error'](_0xcaa55e(0xcb)),console[_0xcaa55e(0x143)](_0xcaa55e(0xfc),_0x14e835),loggerService_1['loggerService'][_0xcaa55e(0x138)](_0xcaa55e(0x107),_0xcaa55e(0xf9),_0xcaa55e(0x13b)+_0x14e835);throw new Error(_0xcaa55e(0xf1)+_0x14e835);}if(!_0x458ca8[_0xcaa55e(0x114)]){console[_0xcaa55e(0x143)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0xcaa55e(0x143)](_0xcaa55e(0x10f)),loggerService_1[_0xcaa55e(0xf6)]['logWhiteDomainError'](_0xcaa55e(0x107),'/status',_0xcaa55e(0x10c));throw new Error(_0xcaa55e(0x11b));}let _0x5173d9=_0xcaa55e(0xd2);switch(_0x458ca8[_0xcaa55e(0x114)]['Status']?.[_0xcaa55e(0x145)]()){case'paid':_0x5173d9=_0xcaa55e(0x13c);break;case _0xcaa55e(0x12e):case _0xcaa55e(0xf7):case'error':_0x5173d9='FAILED';break;case'expired':case'timeout':_0x5173d9=_0xcaa55e(0xe4);break;case _0xcaa55e(0xcd):case _0xcaa55e(0x105):case _0xcaa55e(0xc3):case _0xcaa55e(0xc1):default:_0x5173d9='PENDING';break;}let _0x5ce31c,_0x436ebd;if(_0x458ca8[_0xcaa55e(0x114)][_0xcaa55e(0xdd)]){const _0x157295=_0x458ca8[_0xcaa55e(0x114)]['PaymentDetail'];console[_0xcaa55e(0xed)]('🏦\x20Payment\x20Detail:',_0x157295);const _0x58b478=_0x157295[_0xcaa55e(0x112)](/IBAN\s+([A-Z0-9]+)/i);_0x58b478&&(_0x5ce31c=_0x58b478[0x1],console[_0xcaa55e(0xed)](_0xcaa55e(0x12b),_0x5ce31c)),_0x436ebd=_0x157295;}const _0x109abf={'iban':_0x5ce31c,'bankDetails':_0x436ebd,'transactionId':_0x458ca8[_0xcaa55e(0x114)][_0xcaa55e(0x133)],'coinAddress':_0x458ca8[_0xcaa55e(0x114)][_0xcaa55e(0x125)],'qrCodeUrl':_0x458ca8[_0xcaa55e(0x114)][_0xcaa55e(0x132)],'expiryTime':_0x458ca8['data'][_0xcaa55e(0x123)],'createdOn':_0x458ca8['data'][_0xcaa55e(0xc6)],'confirmedOn':_0x458ca8[_0xcaa55e(0x114)]['TransactionConfirmedOn']};console['log'](_0xcaa55e(0xe9)),console[_0xcaa55e(0xed)](_0xcaa55e(0xc8),_0x458ca8[_0xcaa55e(0x114)]['Status'],'->',_0x5173d9),console[_0xcaa55e(0xed)](_0xcaa55e(0xd7),_0x458ca8['data'][_0xcaa55e(0x10e)],_0x458ca8[_0xcaa55e(0x114)][_0xcaa55e(0x11c)]),console[_0xcaa55e(0xed)](_0xcaa55e(0xcf),_0x458ca8[_0xcaa55e(0x114)][_0xcaa55e(0x133)]),console['log']('IBAN:',_0x5ce31c||_0xcaa55e(0x13d)),console[_0xcaa55e(0xed)](_0xcaa55e(0xd5),_0x458ca8['data'][_0xcaa55e(0xc6)]),console[_0xcaa55e(0xed)](_0xcaa55e(0x136),_0x458ca8['data'][_0xcaa55e(0xe2)]||_0xcaa55e(0xc9));if(_0x458ca8['data']['Status']?.['toLowerCase']()===_0xcaa55e(0x105))console[_0xcaa55e(0xed)]('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x458ca8[_0xcaa55e(0x114)][_0xcaa55e(0x116)]?.['toLowerCase']()===_0xcaa55e(0xfb)&&console[_0xcaa55e(0xed)](_0xcaa55e(0xd9));return{'status':_0x5173d9,'amount':parseFloat(_0x458ca8[_0xcaa55e(0x114)][_0xcaa55e(0x10e)])||undefined,'currency':_0x458ca8[_0xcaa55e(0x114)][_0xcaa55e(0x11c)]||_0xcaa55e(0x12f),'paymentDetails':_0x109abf};}catch(_0x69767a){console[_0xcaa55e(0x143)](_0xcaa55e(0xe0),_0x69767a),loggerService_1[_0xcaa55e(0xf6)][_0xcaa55e(0x138)](_0xcaa55e(0x107),'/status',_0x69767a);throw new Error(_0xcaa55e(0xc5)+(_0x69767a instanceof Error?_0x69767a[_0xcaa55e(0x120)]:_0xcaa55e(0xd0)));}}async[a40_0x502b9c(0x102)](_0x5d26d8){const _0xd80866=a40_0x502b9c,_0x1b7297=await this[_0xd80866(0x10d)](_0x5d26d8);return{'status':_0x1b7297['status'],'amount':_0x1b7297[_0xd80866(0x12d)],'currency':_0x1b7297['currency']};}async[a40_0x502b9c(0xe5)](_0x1c7190){const _0x46480f=a40_0x502b9c;console[_0x46480f(0xed)](_0x46480f(0x11e),_0x1c7190);let _0x25bb19=_0x46480f(0xd2);switch(_0x1c7190[_0x46480f(0xf8)]?.[_0x46480f(0x145)]()){case _0x46480f(0xfb):_0x25bb19=_0x46480f(0x13c);break;case _0x46480f(0x12e):case _0x46480f(0xf7):case _0x46480f(0x143):_0x25bb19=_0x46480f(0x144);break;case _0x46480f(0x11f):case _0x46480f(0xbf):_0x25bb19='EXPIRED';break;case _0x46480f(0xc3):case'waiting':case _0x46480f(0x105):case _0x46480f(0xc1):default:_0x25bb19=_0x46480f(0xd2);break;}return{'paymentId':_0x1c7190[_0x46480f(0x110)]||_0x1c7190[_0x46480f(0xe7)]||'','status':_0x25bb19,'amount':_0x1c7190['amount'],'currency':_0x1c7190['currency']||'EUR'};}}exports['CoinToPayService']=CoinToPayService;function a40_0x7f0c(_0x24497d,_0x611564){const _0xd3cbef=a40_0xd3cb();return a40_0x7f0c=function(_0x7f0c6f,_0x55607b){_0x7f0c6f=_0x7f0c6f-0xbf;let _0x36da55=_0xd3cbef[_0x7f0c6f];return _0x36da55;},a40_0x7f0c(_0x24497d,_0x611564);}function a40_0xd3cb(){const _0xed068a=['success','headers','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','stringify','Business\x20Error:\x20','verifyPayment','JSON\x20Parse\x20Error:\x20','===\x20COINTOPAY\x20SUCCESS\x20===','awaiting\x20fiat','statusText','cointopay','Status\x20Code:','4283153mspstm','gateway_payment_id','Raw\x20Response\x20Body:','Incomplete\x20response:\x20missing\x20data','checkPaymentStatus','Amount','Missing\x20data\x20in\x20response','order_id','Parsed\x20Result:','match','logWhiteDomainResponse','data','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status','fromEntries','368657sipVzM','HTTP\x20error!\x20status:\x20','application/json','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','inputCurrency','now','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','expired','message','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','CoinToPayService','ExpiryTime','status_code','coinAddress','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','HTTP\x20Status:','Unknown\x20error\x20from\x20CoinToPay\x20API','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','515480AtQhNh','🏦\x20Extracted\x20IBAN:','text','amount','cancelled','EUR','===\x20COINTOPAY\x20API\x20ERROR\x20===','Request\x20Body:','QRCodeURL','TransactionID',',\x20body:\x20','parse','Confirmed\x20On:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','logWhiteDomainError','7734DTRATS','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Status\x20API\x20Error:\x20','PAID','not\x20found','../loggerService','Response\x20Time:','POST','apiUrl','HTTP\x20','error','FAILED','toLowerCase','4885Jkpkmw','payment_url','Gateway\x20Payment\x20ID:','timeout','🪙\x20Creating\x20CoinToPay\x20payment:\x20','created','Status\x20Text:','pending','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','CreatedOn','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Status:','not\x20confirmed','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','entries','waiting','result','Transaction\x20ID:','Unknown\x20error','3yetuyC','PENDING','stack','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Created\x20On:','3289288iqWSxa','Amount:','Response\x20Body:','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Response\x20data:','2349320flbdxX','statusUrl','PaymentDetail','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','createPaymentLink','CoinToPay\x20payment\x20status\x20check\x20error:','defineProperty','TransactionConfirmedOn','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','EXPIRED','processWebhook','logWhiteDomainRequest','merchant_reference_id','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','https://tesoft.uk/gateway/cointopay/status.php','TesSoft\x20Payment\x20System/1.0','/create','log','792864yPYCxE','Currency:','Error\x20message:','CoinToPay\x20status\x20API\x20error:\x20','Headers:','CoinToPay\x20API\x20error:\x20','URL:','__esModule','loggerService','failed','status','/status','Error\x20details:','paid','Error\x20Message:'];a40_0xd3cb=function(){return _0xed068a;};return a40_0xd3cb();}