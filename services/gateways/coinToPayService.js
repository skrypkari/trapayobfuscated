'use strict';const a41_0x42c2eb=a41_0x1499;(function(_0x17c2bb,_0x1237d7){const _0x122bba=a41_0x1499,_0x1d2952=_0x17c2bb();while(!![]){try{const _0x405e9a=parseInt(_0x122bba(0x1e2))/0x1*(-parseInt(_0x122bba(0x1b1))/0x2)+parseInt(_0x122bba(0x1fe))/0x3+parseInt(_0x122bba(0x194))/0x4+-parseInt(_0x122bba(0x1bc))/0x5*(parseInt(_0x122bba(0x214))/0x6)+-parseInt(_0x122bba(0x202))/0x7*(parseInt(_0x122bba(0x1fd))/0x8)+parseInt(_0x122bba(0x206))/0x9+parseInt(_0x122bba(0x1b9))/0xa*(parseInt(_0x122bba(0x18d))/0xb);if(_0x405e9a===_0x1237d7)break;else _0x1d2952['push'](_0x1d2952['shift']());}catch(_0xa7fdad){_0x1d2952['push'](_0x1d2952['shift']());}}}(a41_0x3877,0x42422));Object[a41_0x42c2eb(0x20e)](exports,'__esModule',{'value':!![]}),exports[a41_0x42c2eb(0x18c)]=void 0x0;function a41_0x1499(_0xf78482,_0x2964d7){const _0x3877b3=a41_0x3877();return a41_0x1499=function(_0x14996f,_0x13fad3){_0x14996f=_0x14996f-0x18c;let _0x46cdd7=_0x3877b3[_0x14996f];return _0x46cdd7;},a41_0x1499(_0xf78482,_0x2964d7);}const loggerService_1=require(a41_0x42c2eb(0x1f4));class CoinToPayService{constructor(){const _0x2b672d=a41_0x42c2eb;this['apiUrl']=_0x2b672d(0x1e9),this['statusUrl']=_0x2b672d(0x20d),console['log'](_0x2b672d(0x1bb)),console[_0x2b672d(0x200)](_0x2b672d(0x1b5),this[_0x2b672d(0x207)]);}async[a41_0x42c2eb(0x215)](_0xeb0763){const _0x3716fd=a41_0x42c2eb,{orderId:_0x57bd6f,amount:_0x40aec1}=_0xeb0763;console[_0x3716fd(0x200)](_0x3716fd(0x1d3)+_0x40aec1+'\x20EUR');const _0x1d58e2={'amount':_0x40aec1},_0x23977a=Date[_0x3716fd(0x1ea)]();try{console['log'](_0x3716fd(0x19c)),console[_0x3716fd(0x200)]('URL:',this[_0x3716fd(0x1c1)]),console[_0x3716fd(0x200)](_0x3716fd(0x1ca),JSON[_0x3716fd(0x198)](_0x1d58e2,null,0x2)),console[_0x3716fd(0x200)](_0x3716fd(0x1bd),_0x40aec1,_0x3716fd(0x20f)),loggerService_1[_0x3716fd(0x1a8)]['logWhiteDomainRequest'](_0x3716fd(0x1f3),_0x3716fd(0x1b7),'POST',_0x1d58e2);const _0x2691dd=await fetch(this[_0x3716fd(0x1c1)],{'method':_0x3716fd(0x19e),'headers':{'Content-Type':_0x3716fd(0x1af),'Accept':_0x3716fd(0x1af),'User-Agent':_0x3716fd(0x201)},'body':JSON[_0x3716fd(0x198)](_0x1d58e2)}),_0x435d10=Date[_0x3716fd(0x1ea)]()-_0x23977a;console[_0x3716fd(0x200)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x3716fd(0x200)](_0x3716fd(0x1c9),_0x2691dd[_0x3716fd(0x1dc)]),console['log'](_0x3716fd(0x1da),_0x2691dd['statusText']),console[_0x3716fd(0x200)](_0x3716fd(0x1a0),Object[_0x3716fd(0x1e4)](_0x2691dd[_0x3716fd(0x20c)][_0x3716fd(0x1e6)]())),console[_0x3716fd(0x200)](_0x3716fd(0x1a3),_0x435d10+'ms');const _0x46f2d7=await _0x2691dd[_0x3716fd(0x1f6)]();console[_0x3716fd(0x200)](_0x3716fd(0x1ba),_0x46f2d7);if(!_0x2691dd['ok']){console['error'](_0x3716fd(0x210)),console[_0x3716fd(0x1c5)]('HTTP\x20Status:',_0x2691dd['status']),console[_0x3716fd(0x1c5)](_0x3716fd(0x1b4),_0x46f2d7),loggerService_1[_0x3716fd(0x1a8)][_0x3716fd(0x195)]('cointopay',_0x3716fd(0x1b7),_0x2691dd[_0x3716fd(0x1dc)],_0x46f2d7,_0x435d10),loggerService_1[_0x3716fd(0x1a8)][_0x3716fd(0x1e3)](_0x3716fd(0x1f3),_0x3716fd(0x1b7),_0x3716fd(0x1d8)+_0x2691dd[_0x3716fd(0x1dc)]+':\x20'+_0x46f2d7);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2691dd[_0x3716fd(0x1dc)]+',\x20body:\x20'+_0x46f2d7);}let _0x5af7d8;try{_0x5af7d8=JSON[_0x3716fd(0x1a7)](_0x46f2d7);}catch(_0x326b2b){console['error'](_0x3716fd(0x1ac),_0x326b2b),loggerService_1[_0x3716fd(0x1a8)][_0x3716fd(0x1e3)]('cointopay','/create',_0x3716fd(0x1c6)+_0x326b2b);throw new Error(_0x3716fd(0x1d1)+_0x46f2d7);}console['log']('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x3716fd(0x200)](_0x3716fd(0x1d9),JSON[_0x3716fd(0x198)](_0x5af7d8,null,0x2)),loggerService_1[_0x3716fd(0x1a8)]['logWhiteDomainResponse'](_0x3716fd(0x1f3),_0x3716fd(0x1b7),_0x2691dd[_0x3716fd(0x1dc)],_0x5af7d8,_0x435d10);if(_0x5af7d8[_0x3716fd(0x1c5)]){const _0xf70e30=_0x5af7d8[_0x3716fd(0x1fb)]||_0x5af7d8[_0x3716fd(0x1c5)]||_0x3716fd(0x208);console[_0x3716fd(0x1c5)](_0x3716fd(0x190)),console['error']('Error\x20Message:',_0xf70e30),loggerService_1[_0x3716fd(0x1a8)][_0x3716fd(0x1e3)](_0x3716fd(0x1f3),_0x3716fd(0x1b7),_0x3716fd(0x1e8)+_0xf70e30);throw new Error(_0x3716fd(0x199)+_0xf70e30);}if(!_0x5af7d8[_0x3716fd(0x1b6)]||!_0x5af7d8[_0x3716fd(0x191)]){console[_0x3716fd(0x1c5)](_0x3716fd(0x1ff)),console['error'](_0x3716fd(0x20b)),console[_0x3716fd(0x1c5)](_0x3716fd(0x1cf),_0x5af7d8),loggerService_1['loggerService'][_0x3716fd(0x1e3)](_0x3716fd(0x1f3),_0x3716fd(0x1b7),_0x3716fd(0x1c8));throw new Error(_0x3716fd(0x19a));}return console[_0x3716fd(0x200)](_0x3716fd(0x1eb)),console[_0x3716fd(0x200)]('Gateway\x20Payment\x20ID:',_0x5af7d8[_0x3716fd(0x191)]),console['log'](_0x3716fd(0x1f0),_0x5af7d8[_0x3716fd(0x1b6)]),console[_0x3716fd(0x200)](_0x3716fd(0x1bd),_0x40aec1,_0x3716fd(0x1df)),{'gateway_payment_id':_0x5af7d8[_0x3716fd(0x191)],'payment_url':_0x5af7d8[_0x3716fd(0x1b6)]};}catch(_0x29ab07){console[_0x3716fd(0x1c5)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x3716fd(0x1c5)]('Error\x20details:',_0x29ab07),loggerService_1[_0x3716fd(0x1a8)][_0x3716fd(0x1e3)](_0x3716fd(0x1f3),_0x3716fd(0x1b7),_0x29ab07);if(_0x29ab07 instanceof Error){console[_0x3716fd(0x1c5)](_0x3716fd(0x1e7),_0x29ab07[_0x3716fd(0x1fb)]),console['error'](_0x3716fd(0x209),_0x29ab07[_0x3716fd(0x1e0)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x29ab07['message']);}throw new Error(_0x3716fd(0x1a2));}}async[a41_0x42c2eb(0x19d)](_0x49b9a3){const _0x20cca7=a41_0x42c2eb,_0x56aff9=Date[_0x20cca7(0x1ea)]();try{console['log'](_0x20cca7(0x213)+_0x49b9a3);const _0x444866={'gatewayPaymentId':_0x49b9a3};loggerService_1['loggerService'][_0x20cca7(0x1d4)](_0x20cca7(0x1f3),'/status',_0x20cca7(0x19e),_0x444866);const _0xddbdc8=await fetch(this[_0x20cca7(0x207)],{'method':_0x20cca7(0x19e),'headers':{'Content-Type':_0x20cca7(0x1af),'Accept':_0x20cca7(0x1af),'User-Agent':_0x20cca7(0x201)},'body':JSON['stringify'](_0x444866)}),_0x237886=Date['now']()-_0x56aff9;console[_0x20cca7(0x200)](_0x20cca7(0x211)),console['log']('Status:',_0xddbdc8[_0x20cca7(0x1dc)]),console['log']('Response\x20Time:',_0x237886+'ms');if(!_0xddbdc8['ok']){const _0x3c1322=await _0xddbdc8[_0x20cca7(0x1f6)]();console[_0x20cca7(0x1c5)](_0x20cca7(0x1ec),_0xddbdc8['status']),console[_0x20cca7(0x1c5)]('Response\x20Body:',_0x3c1322),loggerService_1[_0x20cca7(0x1a8)][_0x20cca7(0x195)](_0x20cca7(0x1f3),_0x20cca7(0x1ae),_0xddbdc8[_0x20cca7(0x1dc)],_0x3c1322,_0x237886),loggerService_1[_0x20cca7(0x1a8)][_0x20cca7(0x1e3)](_0x20cca7(0x1f3),_0x20cca7(0x1ae),_0x20cca7(0x1d8)+_0xddbdc8['status']+':\x20'+_0x3c1322);throw new Error('HTTP\x20error!\x20status:\x20'+_0xddbdc8[_0x20cca7(0x1dc)]);}const _0x442b17=await _0xddbdc8[_0x20cca7(0x1f6)]();console[_0x20cca7(0x200)](_0x20cca7(0x1ba),_0x442b17);let _0x47531c;try{_0x47531c=JSON['parse'](_0x442b17);}catch(_0xd5b60a){console[_0x20cca7(0x1c5)]('Failed\x20to\x20parse\x20JSON\x20response:',_0xd5b60a),loggerService_1[_0x20cca7(0x1a8)][_0x20cca7(0x1e3)](_0x20cca7(0x1f3),_0x20cca7(0x1ae),_0x20cca7(0x1c6)+_0xd5b60a);throw new Error(_0x20cca7(0x1c2)+_0x442b17);}loggerService_1['loggerService'][_0x20cca7(0x195)](_0x20cca7(0x1f3),_0x20cca7(0x1ae),_0xddbdc8[_0x20cca7(0x1dc)],_0x47531c,_0x237886),console[_0x20cca7(0x200)](_0x20cca7(0x1cc)),console['log'](_0x20cca7(0x1ad),_0x47531c[_0x20cca7(0x1a6)]),console['log'](_0x20cca7(0x1f2),_0x47531c['status_code']),console[_0x20cca7(0x200)](_0x20cca7(0x1fc),_0x47531c['data']?.[_0x20cca7(0x1b8)]),console['log'](_0x20cca7(0x1bd),_0x47531c[_0x20cca7(0x1bf)]?.['Amount']),console['log'](_0x20cca7(0x212),_0x47531c[_0x20cca7(0x1bf)]?.['inputCurrency']);if(_0x47531c[_0x20cca7(0x1a6)]!==_0x20cca7(0x1dd)||_0x47531c[_0x20cca7(0x19b)]!==0xc8){const _0xe4aa5d=_0x47531c[_0x20cca7(0x1fb)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x20cca7(0x1c5)](_0x20cca7(0x1a1),_0xe4aa5d),loggerService_1[_0x20cca7(0x1a8)][_0x20cca7(0x1e3)](_0x20cca7(0x1f3),_0x20cca7(0x1ae),_0x20cca7(0x1e1)+_0xe4aa5d);throw new Error(_0x20cca7(0x197)+_0xe4aa5d);}if(!_0x47531c['data']){console[_0x20cca7(0x1c5)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x20cca7(0x1c5)](_0x20cca7(0x204)),loggerService_1[_0x20cca7(0x1a8)]['logWhiteDomainError'](_0x20cca7(0x1f3),'/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0x20cca7(0x1c0));}let _0xac0b39=_0x20cca7(0x205);switch(_0x47531c[_0x20cca7(0x1bf)][_0x20cca7(0x1b8)]?.[_0x20cca7(0x1ee)]()){case _0x20cca7(0x1ab):_0xac0b39=_0x20cca7(0x1aa);break;case'cancelled':case _0x20cca7(0x1de):case _0x20cca7(0x1c5):_0xac0b39='FAILED';break;case _0x20cca7(0x1b0):case _0x20cca7(0x1f1):_0xac0b39=_0x20cca7(0x1ef);break;case _0x20cca7(0x1c7):case _0x20cca7(0x1d0):case _0x20cca7(0x1e5):case _0x20cca7(0x1d2):default:_0xac0b39='PENDING';break;}let _0x348976,_0x3467cd;if(_0x47531c[_0x20cca7(0x1bf)][_0x20cca7(0x1db)]){const _0x10a709=_0x47531c[_0x20cca7(0x1bf)][_0x20cca7(0x1db)];console[_0x20cca7(0x200)](_0x20cca7(0x1f9),_0x10a709);const _0xd7c182=_0x10a709[_0x20cca7(0x196)](/IBAN\s+([A-Z0-9]+)/i);_0xd7c182&&(_0x348976=_0xd7c182[0x1],console['log']('🏦\x20Extracted\x20IBAN:',_0x348976)),_0x3467cd=_0x10a709;}const _0x77f0e0={'iban':_0x348976,'bankDetails':_0x3467cd,'transactionId':_0x47531c['data'][_0x20cca7(0x1d5)],'coinAddress':_0x47531c[_0x20cca7(0x1bf)][_0x20cca7(0x18f)],'qrCodeUrl':_0x47531c[_0x20cca7(0x1bf)][_0x20cca7(0x1d6)],'expiryTime':_0x47531c[_0x20cca7(0x1bf)][_0x20cca7(0x1ed)],'createdOn':_0x47531c[_0x20cca7(0x1bf)][_0x20cca7(0x1b2)],'confirmedOn':_0x47531c['data'][_0x20cca7(0x1c3)]};console['log'](_0x20cca7(0x19f)),console[_0x20cca7(0x200)](_0x20cca7(0x1c9),_0x47531c[_0x20cca7(0x1bf)]['Status'],'->',_0xac0b39),console[_0x20cca7(0x200)](_0x20cca7(0x1bd),_0x47531c[_0x20cca7(0x1bf)][_0x20cca7(0x20a)],_0x47531c['data']['inputCurrency']),console['log'](_0x20cca7(0x1c4),_0x47531c['data'][_0x20cca7(0x1d5)]),console[_0x20cca7(0x200)](_0x20cca7(0x1fa),_0x348976||'not\x20found'),console[_0x20cca7(0x200)](_0x20cca7(0x1ce),_0x47531c[_0x20cca7(0x1bf)][_0x20cca7(0x1b2)]),console[_0x20cca7(0x200)](_0x20cca7(0x203),_0x47531c[_0x20cca7(0x1bf)][_0x20cca7(0x1c3)]||'not\x20confirmed');if(_0x47531c[_0x20cca7(0x1bf)]['Status']?.[_0x20cca7(0x1ee)]()===_0x20cca7(0x1d0))console[_0x20cca7(0x200)](_0x20cca7(0x1cd));else _0x47531c[_0x20cca7(0x1bf)][_0x20cca7(0x1b8)]?.[_0x20cca7(0x1ee)]()===_0x20cca7(0x1ab)&&console[_0x20cca7(0x200)](_0x20cca7(0x1be));return{'status':_0xac0b39,'amount':parseFloat(_0x47531c[_0x20cca7(0x1bf)][_0x20cca7(0x20a)])||undefined,'currency':_0x47531c[_0x20cca7(0x1bf)][_0x20cca7(0x1d7)]||_0x20cca7(0x1df),'paymentDetails':_0x77f0e0};}catch(_0x35e6f0){console[_0x20cca7(0x1c5)](_0x20cca7(0x192),_0x35e6f0),loggerService_1[_0x20cca7(0x1a8)]['logWhiteDomainError'](_0x20cca7(0x1f3),_0x20cca7(0x1ae),_0x35e6f0);throw new Error(_0x20cca7(0x1b3)+(_0x35e6f0 instanceof Error?_0x35e6f0[_0x20cca7(0x1fb)]:_0x20cca7(0x1f5)));}}async['verifyPayment'](_0x15a1b4){const _0x23cf03=a41_0x42c2eb,_0x44d207=await this[_0x23cf03(0x19d)](_0x15a1b4);return{'status':_0x44d207[_0x23cf03(0x1dc)],'amount':_0x44d207[_0x23cf03(0x1a4)],'currency':_0x44d207['currency']};}async[a41_0x42c2eb(0x1f7)](_0x27f2ee){const _0x31e287=a41_0x42c2eb;console[_0x31e287(0x200)](_0x31e287(0x18e),_0x27f2ee);let _0x1a5445=_0x31e287(0x205);switch(_0x27f2ee[_0x31e287(0x1dc)]?.[_0x31e287(0x1ee)]()){case _0x31e287(0x1ab):_0x1a5445=_0x31e287(0x1aa);break;case _0x31e287(0x1cb):case _0x31e287(0x1de):case _0x31e287(0x1c5):_0x1a5445=_0x31e287(0x1a9);break;case'expired':case'timeout':_0x1a5445=_0x31e287(0x1ef);break;case _0x31e287(0x1e5):case _0x31e287(0x1c7):case _0x31e287(0x1d0):case'created':default:_0x1a5445=_0x31e287(0x205);break;}return{'paymentId':_0x27f2ee[_0x31e287(0x193)]||_0x27f2ee[_0x31e287(0x1f8)]||'','status':_0x1a5445,'amount':_0x27f2ee['amount'],'currency':_0x27f2ee[_0x31e287(0x1a5)]||'EUR'};}}exports[a41_0x42c2eb(0x18c)]=CoinToPayService;function a41_0x3877(){const _0x48b598=['currency','result','parse','loggerService','FAILED','PAID','paid','Failed\x20to\x20parse\x20JSON\x20response:','Result:','/status','application/json','expired','993908yNLpXK','CreatedOn','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Response\x20Body:','📊\x20Status\x20check\x20URL:','payment_url','/create','Status','10QZJxYL','Raw\x20Response\x20Body:','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','1685meFEEn','Amount:','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','data','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','apiUrl','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','TransactionConfirmedOn','Transaction\x20ID:','error','JSON\x20Parse\x20Error:\x20','waiting','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status:','Request\x20Body:','cancelled','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Created\x20On:','Response\x20data:','awaiting\x20fiat','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','created','🪙\x20Creating\x20CoinToPay\x20payment:\x20','logWhiteDomainRequest','TransactionID','QRCodeURL','inputCurrency','HTTP\x20','Parsed\x20Result:','Status\x20Text:','PaymentDetail','status','success','failed','EUR','stack','Status\x20API\x20Error:\x20','1HbhJRS','logWhiteDomainError','fromEntries','pending','entries','Error\x20message:','Business\x20Error:\x20','https://tesoft.uk/gateway/cointopay/','now','===\x20COINTOPAY\x20SUCCESS\x20===','HTTP\x20Status:','ExpiryTime','toLowerCase','EXPIRED','Payment\x20URL:','timeout','Status\x20Code:','cointopay','../loggerService','Unknown\x20error','text','processWebhook','merchant_reference_id','🏦\x20Payment\x20Detail:','IBAN:','message','Payment\x20Status:','57408UqGnAy','621396CiPiYQ','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','log','TesSoft\x20Payment\x20System/1.0','525gppyaB','Confirmed\x20On:','Missing\x20data\x20in\x20response','PENDING','1200951wPgFYp','statusUrl','Unknown\x20error\x20from\x20CoinToPay\x20API','Error\x20stack:','Amount','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','headers','https://tesoft.uk/gateway/cointopay/status.php','defineProperty','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Currency:','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','8706WdUhGR','createPaymentLink','CoinToPayService','13320659lEgSfM','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','coinAddress','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','gateway_payment_id','CoinToPay\x20payment\x20status\x20check\x20error:','order_id','975980WKneCg','logWhiteDomainResponse','match','CoinToPay\x20status\x20API\x20error:\x20','stringify','CoinToPay\x20API\x20error:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','status_code','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','checkPaymentStatus','POST','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Headers:','Error\x20Message:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Response\x20Time:','amount'];a41_0x3877=function(){return _0x48b598;};return a41_0x3877();}