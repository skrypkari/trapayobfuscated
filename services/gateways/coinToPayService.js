'use strict';const a38_0x185d65=a38_0x32d3;(function(_0x3f8d74,_0x109c9a){const _0x47290d=a38_0x32d3,_0x34a049=_0x3f8d74();while(!![]){try{const _0x4c1120=parseInt(_0x47290d(0x1b5))/0x1+parseInt(_0x47290d(0x203))/0x2+parseInt(_0x47290d(0x1fb))/0x3*(-parseInt(_0x47290d(0x198))/0x4)+-parseInt(_0x47290d(0x1ae))/0x5+-parseInt(_0x47290d(0x1c1))/0x6*(-parseInt(_0x47290d(0x1c2))/0x7)+parseInt(_0x47290d(0x211))/0x8*(parseInt(_0x47290d(0x1a4))/0x9)+-parseInt(_0x47290d(0x206))/0xa;if(_0x4c1120===_0x109c9a)break;else _0x34a049['push'](_0x34a049['shift']());}catch(_0x564e99){_0x34a049['push'](_0x34a049['shift']());}}}(a38_0x15f7,0x51923));Object[a38_0x185d65(0x1ec)](exports,'__esModule',{'value':!![]}),exports[a38_0x185d65(0x1f3)]=void 0x0;function a38_0x32d3(_0x566a21,_0x5e6a7b){const _0x15f7eb=a38_0x15f7();return a38_0x32d3=function(_0x32d33c,_0x1c3396){_0x32d33c=_0x32d33c-0x192;let _0x4e966b=_0x15f7eb[_0x32d33c];return _0x4e966b;},a38_0x32d3(_0x566a21,_0x5e6a7b);}const loggerService_1=require(a38_0x185d65(0x1cf));class CoinToPayService{constructor(){const _0x201534=a38_0x185d65;this['apiUrl']=_0x201534(0x20c),this[_0x201534(0x1b1)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x201534(0x201)](_0x201534(0x1a6)),console[_0x201534(0x201)](_0x201534(0x19c),this[_0x201534(0x1b1)]);}async[a38_0x185d65(0x19e)](_0x1de436){const _0x37f594=a38_0x185d65,{orderId:_0x2fa3e5,amount:_0x409bf3}=_0x1de436;console[_0x37f594(0x201)](_0x37f594(0x1d4)+_0x409bf3+_0x37f594(0x216));const _0x2d199a={'amount':_0x409bf3},_0x32e564=Date['now']();try{console[_0x37f594(0x201)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x37f594(0x201)]('URL:',this[_0x37f594(0x1aa)]),console[_0x37f594(0x201)]('Request\x20Body:',JSON[_0x37f594(0x1ca)](_0x2d199a,null,0x2)),console[_0x37f594(0x201)](_0x37f594(0x1b9),_0x409bf3,_0x37f594(0x1e3)),loggerService_1[_0x37f594(0x1de)][_0x37f594(0x1ac)]('cointopay','/create',_0x37f594(0x1f2),_0x2d199a);const _0x2f8edc=await fetch(this['apiUrl'],{'method':_0x37f594(0x1f2),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x37f594(0x1ab)},'body':JSON[_0x37f594(0x1ca)](_0x2d199a)}),_0x104c1b=Date['now']()-_0x32e564;console['log'](_0x37f594(0x1e1)),console[_0x37f594(0x201)](_0x37f594(0x1bb),_0x2f8edc[_0x37f594(0x1a5)]),console['log'](_0x37f594(0x209),_0x2f8edc[_0x37f594(0x1fd)]),console[_0x37f594(0x201)](_0x37f594(0x1ad),Object[_0x37f594(0x1ba)](_0x2f8edc[_0x37f594(0x1ee)][_0x37f594(0x1dc)]())),console[_0x37f594(0x201)](_0x37f594(0x1d8),_0x104c1b+'ms');const _0xdaf73b=await _0x2f8edc['text']();console['log'](_0x37f594(0x1be),_0xdaf73b);if(!_0x2f8edc['ok']){console[_0x37f594(0x1d9)](_0x37f594(0x1d1)),console[_0x37f594(0x1d9)](_0x37f594(0x199),_0x2f8edc[_0x37f594(0x1a5)]),console[_0x37f594(0x1d9)]('Response\x20Body:',_0xdaf73b),loggerService_1['loggerService'][_0x37f594(0x1c4)](_0x37f594(0x1ea),_0x37f594(0x20f),_0x2f8edc[_0x37f594(0x1a5)],_0xdaf73b,_0x104c1b),loggerService_1[_0x37f594(0x1de)]['logWhiteDomainError'](_0x37f594(0x1ea),_0x37f594(0x20f),_0x37f594(0x1cc)+_0x2f8edc[_0x37f594(0x1a5)]+':\x20'+_0xdaf73b);throw new Error(_0x37f594(0x213)+_0x2f8edc[_0x37f594(0x1a5)]+',\x20body:\x20'+_0xdaf73b);}let _0x137ada;try{_0x137ada=JSON[_0x37f594(0x1e8)](_0xdaf73b);}catch(_0x271636){console[_0x37f594(0x1d9)](_0x37f594(0x1bc),_0x271636),loggerService_1['loggerService'][_0x37f594(0x200)](_0x37f594(0x1ea),_0x37f594(0x20f),'JSON\x20Parse\x20Error:\x20'+_0x271636);throw new Error(_0x37f594(0x1db)+_0xdaf73b);}console[_0x37f594(0x201)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x37f594(0x201)]('Parsed\x20Result:',JSON[_0x37f594(0x1ca)](_0x137ada,null,0x2)),loggerService_1['loggerService'][_0x37f594(0x1c4)](_0x37f594(0x1ea),'/create',_0x2f8edc['status'],_0x137ada,_0x104c1b);if(_0x137ada[_0x37f594(0x1d9)]){const _0x31b4df=_0x137ada[_0x37f594(0x1c9)]||_0x137ada['error']||_0x37f594(0x1af);console[_0x37f594(0x1d9)](_0x37f594(0x1bf)),console['error'](_0x37f594(0x20b),_0x31b4df),loggerService_1[_0x37f594(0x1de)][_0x37f594(0x200)](_0x37f594(0x1ea),_0x37f594(0x20f),_0x37f594(0x196)+_0x31b4df);throw new Error(_0x37f594(0x217)+_0x31b4df);}if(!_0x137ada[_0x37f594(0x1e0)]||!_0x137ada[_0x37f594(0x1df)]){console[_0x37f594(0x1d9)](_0x37f594(0x1f0)),console[_0x37f594(0x1d9)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x37f594(0x1d9)](_0x37f594(0x1ce),_0x137ada),loggerService_1[_0x37f594(0x1de)][_0x37f594(0x200)](_0x37f594(0x1ea),'/create',_0x37f594(0x1a9));throw new Error(_0x37f594(0x1da));}return console[_0x37f594(0x201)](_0x37f594(0x1c0)),console[_0x37f594(0x201)](_0x37f594(0x1e7),_0x137ada[_0x37f594(0x1df)]),console['log']('Payment\x20URL:',_0x137ada[_0x37f594(0x1e0)]),console['log'](_0x37f594(0x1b9),_0x409bf3,_0x37f594(0x1f5)),{'gateway_payment_id':_0x137ada[_0x37f594(0x1df)],'payment_url':_0x137ada[_0x37f594(0x1e0)]};}catch(_0x4d2602){console[_0x37f594(0x1d9)](_0x37f594(0x1ef)),console[_0x37f594(0x1d9)](_0x37f594(0x1cd),_0x4d2602),loggerService_1['loggerService'][_0x37f594(0x200)](_0x37f594(0x1ea),'/create',_0x4d2602);if(_0x4d2602 instanceof Error){console[_0x37f594(0x1d9)]('Error\x20message:',_0x4d2602[_0x37f594(0x1c9)]),console['error'](_0x37f594(0x1ed),_0x4d2602[_0x37f594(0x1a7)]);throw new Error(_0x37f594(0x1f8)+_0x4d2602['message']);}throw new Error(_0x37f594(0x1b0));}}async['checkPaymentStatus'](_0x3d1ffa){const _0x48c8a1=a38_0x185d65,_0xe0f0e0=Date[_0x48c8a1(0x1b3)]();try{console['log'](_0x48c8a1(0x1c6)+_0x3d1ffa);const _0x54047a={'gatewayPaymentId':_0x3d1ffa};loggerService_1[_0x48c8a1(0x1de)]['logWhiteDomainRequest'](_0x48c8a1(0x1ea),_0x48c8a1(0x195),_0x48c8a1(0x1f2),_0x54047a);const _0x65e104=await fetch(this[_0x48c8a1(0x1b1)],{'method':'POST','headers':{'Content-Type':_0x48c8a1(0x193),'Accept':_0x48c8a1(0x193),'User-Agent':_0x48c8a1(0x1ab)},'body':JSON[_0x48c8a1(0x1ca)](_0x54047a)}),_0x337049=Date['now']()-_0xe0f0e0;console[_0x48c8a1(0x201)](_0x48c8a1(0x1f1)),console[_0x48c8a1(0x201)]('Status:',_0x65e104[_0x48c8a1(0x1a5)]),console['log'](_0x48c8a1(0x1d8),_0x337049+'ms');if(!_0x65e104['ok']){const _0x287e50=await _0x65e104[_0x48c8a1(0x1c5)]();console[_0x48c8a1(0x1d9)]('HTTP\x20Status:',_0x65e104[_0x48c8a1(0x1a5)]),console['error'](_0x48c8a1(0x1cb),_0x287e50),loggerService_1[_0x48c8a1(0x1de)][_0x48c8a1(0x1c4)](_0x48c8a1(0x1ea),_0x48c8a1(0x195),_0x65e104[_0x48c8a1(0x1a5)],_0x287e50,_0x337049),loggerService_1[_0x48c8a1(0x1de)][_0x48c8a1(0x200)](_0x48c8a1(0x1ea),_0x48c8a1(0x195),_0x48c8a1(0x1cc)+_0x65e104[_0x48c8a1(0x1a5)]+':\x20'+_0x287e50);throw new Error(_0x48c8a1(0x213)+_0x65e104[_0x48c8a1(0x1a5)]);}const _0x414fb3=await _0x65e104[_0x48c8a1(0x1c5)]();console[_0x48c8a1(0x201)]('Raw\x20Response\x20Body:',_0x414fb3);let _0xad8ed4;try{_0xad8ed4=JSON[_0x48c8a1(0x1e8)](_0x414fb3);}catch(_0x33b70a){console[_0x48c8a1(0x1d9)](_0x48c8a1(0x1bc),_0x33b70a),loggerService_1['loggerService'][_0x48c8a1(0x200)](_0x48c8a1(0x1ea),'/status',_0x48c8a1(0x1d3)+_0x33b70a);throw new Error(_0x48c8a1(0x1dd)+_0x414fb3);}loggerService_1[_0x48c8a1(0x1de)][_0x48c8a1(0x1c4)]('cointopay',_0x48c8a1(0x195),_0x65e104[_0x48c8a1(0x1a5)],_0xad8ed4,_0x337049),console[_0x48c8a1(0x201)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x48c8a1(0x201)](_0x48c8a1(0x1f4),_0xad8ed4['result']),console[_0x48c8a1(0x201)](_0x48c8a1(0x205),_0xad8ed4[_0x48c8a1(0x204)]),console['log'](_0x48c8a1(0x20e),_0xad8ed4[_0x48c8a1(0x1fe)]?.['Status']),console['log']('Amount:',_0xad8ed4[_0x48c8a1(0x1fe)]?.[_0x48c8a1(0x1b7)]),console[_0x48c8a1(0x201)](_0x48c8a1(0x1c3),_0xad8ed4[_0x48c8a1(0x1fe)]?.[_0x48c8a1(0x19a)]);if(_0xad8ed4[_0x48c8a1(0x210)]!==_0x48c8a1(0x1a2)||_0xad8ed4[_0x48c8a1(0x204)]!==0xc8){const _0x21d59d=_0xad8ed4[_0x48c8a1(0x1c9)]||_0x48c8a1(0x197);console[_0x48c8a1(0x1d9)](_0x48c8a1(0x1e9)),console['error'](_0x48c8a1(0x20b),_0x21d59d),loggerService_1[_0x48c8a1(0x1de)][_0x48c8a1(0x200)]('cointopay','/status',_0x48c8a1(0x1d5)+_0x21d59d);throw new Error(_0x48c8a1(0x1bd)+_0x21d59d);}if(!_0xad8ed4[_0x48c8a1(0x1fe)]){console[_0x48c8a1(0x1d9)](_0x48c8a1(0x1d0)),console['error'](_0x48c8a1(0x19b)),loggerService_1[_0x48c8a1(0x1de)]['logWhiteDomainError']('cointopay','/status',_0x48c8a1(0x1b2));throw new Error(_0x48c8a1(0x1c8));}let _0x2efa2f=_0x48c8a1(0x1f9);switch(_0xad8ed4[_0x48c8a1(0x1fe)][_0x48c8a1(0x19d)]?.[_0x48c8a1(0x1b8)]()){case'paid':_0x2efa2f=_0x48c8a1(0x1f7);break;case _0x48c8a1(0x1eb):case _0x48c8a1(0x20a):case _0x48c8a1(0x1d9):_0x2efa2f=_0x48c8a1(0x1e2);break;case'expired':case _0x48c8a1(0x1a3):_0x2efa2f='EXPIRED';break;case _0x48c8a1(0x1b4):case'awaiting\x20fiat':case _0x48c8a1(0x1e6):case'created':default:_0x2efa2f=_0x48c8a1(0x1f9);break;}let _0x3f4ec0,_0x7c8238;if(_0xad8ed4[_0x48c8a1(0x1fe)]['PaymentDetail']){const _0x53eb61=_0xad8ed4[_0x48c8a1(0x1fe)][_0x48c8a1(0x1d7)];console[_0x48c8a1(0x201)](_0x48c8a1(0x1fc),_0x53eb61);const _0x260116=_0x53eb61[_0x48c8a1(0x208)](/IBAN\s+([A-Z0-9]+)/i);_0x260116&&(_0x3f4ec0=_0x260116[0x1],console[_0x48c8a1(0x201)](_0x48c8a1(0x214),_0x3f4ec0)),_0x7c8238=_0x53eb61;}const _0x6252e0={'iban':_0x3f4ec0,'bankDetails':_0x7c8238,'transactionId':_0xad8ed4['data'][_0x48c8a1(0x1e5)],'coinAddress':_0xad8ed4[_0x48c8a1(0x1fe)]['coinAddress'],'qrCodeUrl':_0xad8ed4[_0x48c8a1(0x1fe)][_0x48c8a1(0x202)],'expiryTime':_0xad8ed4[_0x48c8a1(0x1fe)][_0x48c8a1(0x194)],'createdOn':_0xad8ed4[_0x48c8a1(0x1fe)][_0x48c8a1(0x19f)],'confirmedOn':_0xad8ed4['data'][_0x48c8a1(0x1d2)]};console[_0x48c8a1(0x201)](_0x48c8a1(0x212)),console['log'](_0x48c8a1(0x1bb),_0xad8ed4[_0x48c8a1(0x1fe)][_0x48c8a1(0x19d)],'->',_0x2efa2f),console[_0x48c8a1(0x201)](_0x48c8a1(0x1b9),_0xad8ed4[_0x48c8a1(0x1fe)][_0x48c8a1(0x1b7)],_0xad8ed4[_0x48c8a1(0x1fe)][_0x48c8a1(0x19a)]),console[_0x48c8a1(0x201)](_0x48c8a1(0x1d6),_0xad8ed4['data']['TransactionID']),console[_0x48c8a1(0x201)]('IBAN:',_0x3f4ec0||_0x48c8a1(0x1c7)),console[_0x48c8a1(0x201)]('Created\x20On:',_0xad8ed4[_0x48c8a1(0x1fe)][_0x48c8a1(0x19f)]),console[_0x48c8a1(0x201)](_0x48c8a1(0x1e4),_0xad8ed4[_0x48c8a1(0x1fe)][_0x48c8a1(0x1d2)]||'not\x20confirmed');if(_0xad8ed4[_0x48c8a1(0x1fe)][_0x48c8a1(0x19d)]?.[_0x48c8a1(0x1b8)]()===_0x48c8a1(0x207))console[_0x48c8a1(0x201)](_0x48c8a1(0x1f6));else _0xad8ed4[_0x48c8a1(0x1fe)][_0x48c8a1(0x19d)]?.[_0x48c8a1(0x1b8)]()===_0x48c8a1(0x192)&&console[_0x48c8a1(0x201)](_0x48c8a1(0x1fa));return{'status':_0x2efa2f,'amount':parseFloat(_0xad8ed4[_0x48c8a1(0x1fe)][_0x48c8a1(0x1b7)])||undefined,'currency':_0xad8ed4['data'][_0x48c8a1(0x19a)]||_0x48c8a1(0x1f5),'paymentDetails':_0x6252e0};}catch(_0x1e8489){console[_0x48c8a1(0x1d9)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x1e8489),loggerService_1[_0x48c8a1(0x1de)][_0x48c8a1(0x200)]('cointopay','/status',_0x1e8489);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x1e8489 instanceof Error?_0x1e8489[_0x48c8a1(0x1c9)]:'Unknown\x20error'));}}async[a38_0x185d65(0x1a8)](_0x2d49d8){const _0x44576a=a38_0x185d65,_0x554591=await this['checkPaymentStatus'](_0x2d49d8);return{'status':_0x554591[_0x44576a(0x1a5)],'amount':_0x554591['amount'],'currency':_0x554591[_0x44576a(0x1a0)]};}async['processWebhook'](_0xfcac29){const _0x50f6d5=a38_0x185d65;console['log'](_0x50f6d5(0x1a1),_0xfcac29);let _0x575b36='PENDING';switch(_0xfcac29[_0x50f6d5(0x1a5)]?.[_0x50f6d5(0x1b8)]()){case'paid':_0x575b36='PAID';break;case _0x50f6d5(0x1eb):case _0x50f6d5(0x20a):case _0x50f6d5(0x1d9):_0x575b36=_0x50f6d5(0x1e2);break;case _0x50f6d5(0x215):case _0x50f6d5(0x1a3):_0x575b36=_0x50f6d5(0x20d);break;case _0x50f6d5(0x1e6):case _0x50f6d5(0x1b4):case _0x50f6d5(0x207):case'created':default:_0x575b36='PENDING';break;}return{'paymentId':_0xfcac29['order_id']||_0xfcac29[_0x50f6d5(0x1b6)]||'','status':_0x575b36,'amount':_0xfcac29[_0x50f6d5(0x1ff)],'currency':_0xfcac29[_0x50f6d5(0x1a0)]||'EUR'};}}function a38_0x15f7(){const _0x40db77=['now','waiting','163001YWEejk','merchant_reference_id','Amount','toLowerCase','Amount:','fromEntries','Status:','Failed\x20to\x20parse\x20JSON\x20response:','CoinToPay\x20status\x20API\x20error:\x20','Raw\x20Response\x20Body:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','===\x20COINTOPAY\x20SUCCESS\x20===','12HWxJPQ','2174347WHXOgK','Currency:','logWhiteDomainResponse','text','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','not\x20found','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','message','stringify','Response\x20Body:','HTTP\x20','Error\x20details:','Response\x20data:','../loggerService','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20ERROR\x20===','TransactionConfirmedOn','JSON\x20Parse\x20Error:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Status\x20API\x20Error:\x20','Transaction\x20ID:','PaymentDetail','Response\x20Time:','error','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','entries','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','loggerService','gateway_payment_id','payment_url','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','FAILED','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Confirmed\x20On:','TransactionID','pending','Gateway\x20Payment\x20ID:','parse','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','cointopay','cancelled','defineProperty','Error\x20stack:','headers','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','POST','CoinToPayService','Result:','EUR','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','PAID','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','PENDING','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','6189jnvAhz','üè¶\x20Payment\x20Detail:','statusText','data','amount','logWhiteDomainError','log','QRCodeURL','656138uOgshT','status_code','Status\x20Code:','4488850JoHgMJ','awaiting\x20fiat','match','Status\x20Text:','failed','Error\x20Message:','https://tesoft.uk/gateway/cointopay/','EXPIRED','Payment\x20Status:','/create','result','3548536AuDPOU','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','HTTP\x20error!\x20status:\x20','üè¶\x20Extracted\x20IBAN:','expired','\x20EUR','CoinToPay\x20API\x20error:\x20','paid','application/json','ExpiryTime','/status','Business\x20Error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','1004CehsaE','HTTP\x20Status:','inputCurrency','Missing\x20data\x20in\x20response','üìä\x20Status\x20check\x20URL:','Status','createPaymentLink','CreatedOn','currency','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','success','timeout','9tHUJyw','status','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','stack','verifyPayment','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','apiUrl','TesSoft\x20Payment\x20System/1.0','logWhiteDomainRequest','Headers:','1275330iWTjYk','Unknown\x20error\x20from\x20CoinToPay\x20API','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','statusUrl','Incomplete\x20response:\x20missing\x20data'];a38_0x15f7=function(){return _0x40db77;};return a38_0x15f7();}exports[a38_0x185d65(0x1f3)]=CoinToPayService;