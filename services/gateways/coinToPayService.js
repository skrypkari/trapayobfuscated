'use strict';const a40_0x3893d0=a40_0x414c;(function(_0x383985,_0x4fcb0f){const _0xf49c5e=a40_0x414c,_0x32c152=_0x383985();while(!![]){try{const _0x238a69=-parseInt(_0xf49c5e(0x1db))/0x1+-parseInt(_0xf49c5e(0x1ff))/0x2+-parseInt(_0xf49c5e(0x23e))/0x3*(parseInt(_0xf49c5e(0x23a))/0x4)+-parseInt(_0xf49c5e(0x1d9))/0x5+-parseInt(_0xf49c5e(0x1e4))/0x6*(-parseInt(_0xf49c5e(0x240))/0x7)+parseInt(_0xf49c5e(0x221))/0x8+parseInt(_0xf49c5e(0x213))/0x9;if(_0x238a69===_0x4fcb0f)break;else _0x32c152['push'](_0x32c152['shift']());}catch(_0x3ca291){_0x32c152['push'](_0x32c152['shift']());}}}(a40_0x1a7d,0x28b40));function a40_0x414c(_0x591dd1,_0x30d375){const _0x1a7d97=a40_0x1a7d();return a40_0x414c=function(_0x414c3e,_0x148660){_0x414c3e=_0x414c3e-0x1d7;let _0x266149=_0x1a7d97[_0x414c3e];return _0x266149;},a40_0x414c(_0x591dd1,_0x30d375);}Object[a40_0x3893d0(0x204)](exports,a40_0x3893d0(0x225),{'value':!![]}),exports[a40_0x3893d0(0x1fa)]=void 0x0;function a40_0x1a7d(){const _0x5792fb=['stack','pending','defineProperty','JSON\x20Parse\x20Error:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Gateway\x20Payment\x20ID:','amount','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Request\x20Body:','Amount','CoinToPay\x20payment\x20status\x20check\x20error:','IBAN:','Response\x20Body:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','success','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','4373136utzNuw','POST','Error\x20Message:','Headers:','coinAddress','processWebhook','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','status','Currency:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Missing\x20data\x20in\x20response','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Error\x20details:','FAILED','411400zzMvag','currency','CoinToPay\x20status\x20API\x20error:\x20','\x20EUR','__esModule','EXPIRED','HTTP\x20','Incomplete\x20response:\x20missing\x20data','text','status_code','logWhiteDomainError','Response\x20Time:','QRCodeURL','EUR','data','parse','Response\x20data:','cointopay','Status:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Status','HTTP\x20Status:','apiUrl','../loggerService','cancelled','12748YkAtTq','inputCurrency','headers','timeout','195EoldxT','failed','84AsIaEg','application/json','ExpiryTime','log','CreatedOn','now','payment_url','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','not\x20confirmed','/create','match','Unknown\x20error\x20from\x20CoinToPay\x20API','order_id','üìä\x20Status\x20check\x20URL:','message','===\x20COINTOPAY\x20SUCCESS\x20===','Transaction\x20ID:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20stack:','üè¶\x20Extracted\x20IBAN:','toLowerCase','result','393280ggMcVP','/status','84906FsWZcE','TesSoft\x20Payment\x20System/1.0','PAID','gateway_payment_id','expired','entries','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','loggerService','paid','2940ULlPtR','waiting','Failed\x20to\x20parse\x20JSON\x20response:','Status\x20API\x20Error:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','createPaymentLink','stringify','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Parsed\x20Result:','TransactionID','awaiting\x20fiat','HTTP\x20error!\x20status:\x20','TransactionConfirmedOn','PENDING','statusUrl','Business\x20Error:\x20','logWhiteDomainResponse','created','Payment\x20URL:','Amount:','error','Raw\x20Response\x20Body:','CoinToPayService','logWhiteDomainRequest','Created\x20On:','https://tesoft.uk/gateway/cointopay/status.php','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','11544nnQwJv','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','CoinToPay\x20API\x20error:\x20'];a40_0x1a7d=function(){return _0x5792fb;};return a40_0x1a7d();}const loggerService_1=require(a40_0x3893d0(0x238));class CoinToPayService{constructor(){const _0xcbcd67=a40_0x3893d0;this[_0xcbcd67(0x237)]='https://tesoft.uk/gateway/cointopay/',this[_0xcbcd67(0x1f2)]=_0xcbcd67(0x1fd),console[_0xcbcd67(0x243)](_0xcbcd67(0x253)),console['log'](_0xcbcd67(0x24e),this['statusUrl']);}async[a40_0x3893d0(0x1e9)](_0x572269){const _0x15007d=a40_0x3893d0,{orderId:_0x202eba,amount:_0x212aa3}=_0x572269;console[_0x15007d(0x243)](_0x15007d(0x1e8)+_0x212aa3+_0x15007d(0x224));const _0x51a8aa={'amount':_0x212aa3},_0x591b1b=Date['now']();try{console['log'](_0x15007d(0x21c)),console[_0x15007d(0x243)]('URL:',this[_0x15007d(0x237)]),console[_0x15007d(0x243)](_0x15007d(0x20a),JSON[_0x15007d(0x1ea)](_0x51a8aa,null,0x2)),console[_0x15007d(0x243)](_0x15007d(0x1f7),_0x212aa3,_0x15007d(0x21e)),loggerService_1['loggerService'][_0x15007d(0x1fb)](_0x15007d(0x232),_0x15007d(0x24a),_0x15007d(0x214),_0x51a8aa);const _0x550555=await fetch(this['apiUrl'],{'method':_0x15007d(0x214),'headers':{'Content-Type':_0x15007d(0x241),'Accept':_0x15007d(0x241),'User-Agent':_0x15007d(0x1dc)},'body':JSON[_0x15007d(0x1ea)](_0x51a8aa)}),_0xef4a31=Date[_0x15007d(0x245)]()-_0x591b1b;console[_0x15007d(0x243)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x15007d(0x243)]('Status:',_0x550555['status']),console['log']('Status\x20Text:',_0x550555['statusText']),console[_0x15007d(0x243)](_0x15007d(0x216),Object['fromEntries'](_0x550555[_0x15007d(0x23c)][_0x15007d(0x1e0)]())),console[_0x15007d(0x243)](_0x15007d(0x22c),_0xef4a31+'ms');const _0xc3bf9d=await _0x550555['text']();console[_0x15007d(0x243)](_0x15007d(0x1f9),_0xc3bf9d);if(!_0x550555['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x15007d(0x1f8)](_0x15007d(0x236),_0x550555[_0x15007d(0x21a)]),console[_0x15007d(0x1f8)](_0x15007d(0x20e),_0xc3bf9d),loggerService_1[_0x15007d(0x1e2)][_0x15007d(0x1f4)](_0x15007d(0x232),_0x15007d(0x24a),_0x550555['status'],_0xc3bf9d,_0xef4a31),loggerService_1[_0x15007d(0x1e2)][_0x15007d(0x22b)](_0x15007d(0x232),_0x15007d(0x24a),_0x15007d(0x227)+_0x550555['status']+':\x20'+_0xc3bf9d);throw new Error('HTTP\x20error!\x20status:\x20'+_0x550555['status']+',\x20body:\x20'+_0xc3bf9d);}let _0x20b952;try{_0x20b952=JSON[_0x15007d(0x230)](_0xc3bf9d);}catch(_0x39c1f2){console['error'](_0x15007d(0x1e6),_0x39c1f2),loggerService_1['loggerService']['logWhiteDomainError'](_0x15007d(0x232),'/create','JSON\x20Parse\x20Error:\x20'+_0x39c1f2);throw new Error(_0x15007d(0x219)+_0xc3bf9d);}console['log'](_0x15007d(0x206)),console['log'](_0x15007d(0x1ec),JSON[_0x15007d(0x1ea)](_0x20b952,null,0x2)),loggerService_1[_0x15007d(0x1e2)]['logWhiteDomainResponse'](_0x15007d(0x232),_0x15007d(0x24a),_0x550555[_0x15007d(0x21a)],_0x20b952,_0xef4a31);if(_0x20b952[_0x15007d(0x1f8)]){const _0x3efe9a=_0x20b952[_0x15007d(0x24f)]||_0x20b952['error']||_0x15007d(0x24c);console[_0x15007d(0x1f8)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x15007d(0x1f8)]('Error\x20Message:',_0x3efe9a),loggerService_1[_0x15007d(0x1e2)][_0x15007d(0x22b)](_0x15007d(0x232),_0x15007d(0x24a),_0x15007d(0x1f3)+_0x3efe9a);throw new Error(_0x15007d(0x201)+_0x3efe9a);}if(!_0x20b952[_0x15007d(0x246)]||!_0x20b952['gateway_payment_id']){console['error'](_0x15007d(0x20f)),console[_0x15007d(0x1f8)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x15007d(0x1f8)](_0x15007d(0x231),_0x20b952),loggerService_1[_0x15007d(0x1e2)][_0x15007d(0x22b)]('cointopay',_0x15007d(0x24a),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x15007d(0x1eb));}return console[_0x15007d(0x243)](_0x15007d(0x250)),console['log'](_0x15007d(0x207),_0x20b952[_0x15007d(0x1de)]),console[_0x15007d(0x243)](_0x15007d(0x1f6),_0x20b952[_0x15007d(0x246)]),console[_0x15007d(0x243)](_0x15007d(0x1f7),_0x212aa3,_0x15007d(0x22e)),{'gateway_payment_id':_0x20b952[_0x15007d(0x1de)],'payment_url':_0x20b952[_0x15007d(0x246)]};}catch(_0x272736){console[_0x15007d(0x1f8)](_0x15007d(0x247)),console[_0x15007d(0x1f8)](_0x15007d(0x21f),_0x272736),loggerService_1[_0x15007d(0x1e2)][_0x15007d(0x22b)]('cointopay',_0x15007d(0x24a),_0x272736);if(_0x272736 instanceof Error){console[_0x15007d(0x1f8)]('Error\x20message:',_0x272736[_0x15007d(0x24f)]),console['error'](_0x15007d(0x254),_0x272736[_0x15007d(0x202)]);throw new Error(_0x15007d(0x200)+_0x272736[_0x15007d(0x24f)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x4cbea0){const _0x51befa=a40_0x3893d0,_0x369de6=Date[_0x51befa(0x245)]();try{console['log'](_0x51befa(0x209)+_0x4cbea0);const _0x2036ef={'gatewayPaymentId':_0x4cbea0};loggerService_1[_0x51befa(0x1e2)][_0x51befa(0x1fb)](_0x51befa(0x232),_0x51befa(0x1da),_0x51befa(0x214),_0x2036ef);const _0x1596ce=await fetch(this[_0x51befa(0x1f2)],{'method':_0x51befa(0x214),'headers':{'Content-Type':_0x51befa(0x241),'Accept':_0x51befa(0x241),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x51befa(0x1ea)](_0x2036ef)}),_0x15c651=Date['now']()-_0x369de6;console[_0x51befa(0x243)](_0x51befa(0x211)),console[_0x51befa(0x243)]('Status:',_0x1596ce[_0x51befa(0x21a)]),console[_0x51befa(0x243)](_0x51befa(0x22c),_0x15c651+'ms');if(!_0x1596ce['ok']){const _0x5a3d99=await _0x1596ce[_0x51befa(0x229)]();console['error']('HTTP\x20Status:',_0x1596ce[_0x51befa(0x21a)]),console[_0x51befa(0x1f8)](_0x51befa(0x20e),_0x5a3d99),loggerService_1[_0x51befa(0x1e2)][_0x51befa(0x1f4)](_0x51befa(0x232),'/status',_0x1596ce[_0x51befa(0x21a)],_0x5a3d99,_0x15c651),loggerService_1[_0x51befa(0x1e2)]['logWhiteDomainError'](_0x51befa(0x232),_0x51befa(0x1da),_0x51befa(0x227)+_0x1596ce[_0x51befa(0x21a)]+':\x20'+_0x5a3d99);throw new Error(_0x51befa(0x1ef)+_0x1596ce[_0x51befa(0x21a)]);}const _0x128e72=await _0x1596ce['text']();console[_0x51befa(0x243)](_0x51befa(0x1f9),_0x128e72);let _0x41a214;try{_0x41a214=JSON[_0x51befa(0x230)](_0x128e72);}catch(_0x3f0522){console[_0x51befa(0x1f8)](_0x51befa(0x1e6),_0x3f0522),loggerService_1[_0x51befa(0x1e2)]['logWhiteDomainError'](_0x51befa(0x232),'/status',_0x51befa(0x205)+_0x3f0522);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x128e72);}loggerService_1[_0x51befa(0x1e2)][_0x51befa(0x1f4)]('cointopay',_0x51befa(0x1da),_0x1596ce[_0x51befa(0x21a)],_0x41a214,_0x15c651),console[_0x51befa(0x243)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x51befa(0x243)]('Result:',_0x41a214[_0x51befa(0x1d8)]),console[_0x51befa(0x243)]('Status\x20Code:',_0x41a214[_0x51befa(0x22a)]),console[_0x51befa(0x243)]('Payment\x20Status:',_0x41a214[_0x51befa(0x22f)]?.[_0x51befa(0x235)]),console[_0x51befa(0x243)](_0x51befa(0x1f7),_0x41a214[_0x51befa(0x22f)]?.[_0x51befa(0x20b)]),console[_0x51befa(0x243)](_0x51befa(0x21b),_0x41a214[_0x51befa(0x22f)]?.[_0x51befa(0x23b)]);if(_0x41a214['result']!==_0x51befa(0x210)||_0x41a214[_0x51befa(0x22a)]!==0xc8){const _0x2958d0=_0x41a214[_0x51befa(0x24f)]||_0x51befa(0x248);console[_0x51befa(0x1f8)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x51befa(0x1f8)](_0x51befa(0x215),_0x2958d0),loggerService_1[_0x51befa(0x1e2)][_0x51befa(0x22b)](_0x51befa(0x232),'/status',_0x51befa(0x1e7)+_0x2958d0);throw new Error(_0x51befa(0x223)+_0x2958d0);}if(!_0x41a214[_0x51befa(0x22f)]){console[_0x51befa(0x1f8)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x51befa(0x1f8)](_0x51befa(0x21d)),loggerService_1['loggerService'][_0x51befa(0x22b)](_0x51befa(0x232),'/status',_0x51befa(0x228));throw new Error(_0x51befa(0x252));}let _0x5d16af=_0x51befa(0x1f1);switch(_0x41a214[_0x51befa(0x22f)]['Status']?.[_0x51befa(0x1d7)]()){case _0x51befa(0x1e3):_0x5d16af='PAID';break;case _0x51befa(0x239):case'failed':case _0x51befa(0x1f8):_0x5d16af=_0x51befa(0x220);break;case _0x51befa(0x1df):case _0x51befa(0x23d):_0x5d16af='EXPIRED';break;case _0x51befa(0x1e5):case _0x51befa(0x1ee):case _0x51befa(0x203):case _0x51befa(0x1f5):default:_0x5d16af='PENDING';break;}let _0x45e59a,_0x4e1562;if(_0x41a214[_0x51befa(0x22f)]['PaymentDetail']){const _0x5da5d6=_0x41a214[_0x51befa(0x22f)]['PaymentDetail'];console[_0x51befa(0x243)]('üè¶\x20Payment\x20Detail:',_0x5da5d6);const _0x4262af=_0x5da5d6[_0x51befa(0x24b)](/IBAN\s+([A-Z0-9]+)/i);_0x4262af&&(_0x45e59a=_0x4262af[0x1],console[_0x51befa(0x243)](_0x51befa(0x255),_0x45e59a)),_0x4e1562=_0x5da5d6;}const _0x329b58={'iban':_0x45e59a,'bankDetails':_0x4e1562,'transactionId':_0x41a214['data']['TransactionID'],'coinAddress':_0x41a214[_0x51befa(0x22f)][_0x51befa(0x217)],'qrCodeUrl':_0x41a214[_0x51befa(0x22f)][_0x51befa(0x22d)],'expiryTime':_0x41a214[_0x51befa(0x22f)][_0x51befa(0x242)],'createdOn':_0x41a214[_0x51befa(0x22f)][_0x51befa(0x244)],'confirmedOn':_0x41a214[_0x51befa(0x22f)][_0x51befa(0x1f0)]};console[_0x51befa(0x243)](_0x51befa(0x1e1)),console[_0x51befa(0x243)](_0x51befa(0x233),_0x41a214[_0x51befa(0x22f)][_0x51befa(0x235)],'->',_0x5d16af),console[_0x51befa(0x243)](_0x51befa(0x1f7),_0x41a214[_0x51befa(0x22f)][_0x51befa(0x20b)],_0x41a214[_0x51befa(0x22f)][_0x51befa(0x23b)]),console[_0x51befa(0x243)](_0x51befa(0x251),_0x41a214[_0x51befa(0x22f)][_0x51befa(0x1ed)]),console[_0x51befa(0x243)](_0x51befa(0x20d),_0x45e59a||'not\x20found'),console[_0x51befa(0x243)](_0x51befa(0x1fc),_0x41a214[_0x51befa(0x22f)][_0x51befa(0x244)]),console[_0x51befa(0x243)]('Confirmed\x20On:',_0x41a214[_0x51befa(0x22f)][_0x51befa(0x1f0)]||_0x51befa(0x249));if(_0x41a214['data']['Status']?.[_0x51befa(0x1d7)]()===_0x51befa(0x1ee))console[_0x51befa(0x243)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x41a214[_0x51befa(0x22f)][_0x51befa(0x235)]?.[_0x51befa(0x1d7)]()===_0x51befa(0x1e3)&&console[_0x51befa(0x243)](_0x51befa(0x234));return{'status':_0x5d16af,'amount':parseFloat(_0x41a214[_0x51befa(0x22f)][_0x51befa(0x20b)])||undefined,'currency':_0x41a214[_0x51befa(0x22f)][_0x51befa(0x23b)]||_0x51befa(0x22e),'paymentDetails':_0x329b58};}catch(_0x424e20){console[_0x51befa(0x1f8)](_0x51befa(0x20c),_0x424e20),loggerService_1[_0x51befa(0x1e2)]['logWhiteDomainError'](_0x51befa(0x232),'/status',_0x424e20);throw new Error(_0x51befa(0x212)+(_0x424e20 instanceof Error?_0x424e20['message']:'Unknown\x20error'));}}async['verifyPayment'](_0x8ba6a7){const _0x252531=a40_0x3893d0,_0x197247=await this['checkPaymentStatus'](_0x8ba6a7);return{'status':_0x197247[_0x252531(0x21a)],'amount':_0x197247[_0x252531(0x208)],'currency':_0x197247['currency']};}async[a40_0x3893d0(0x218)](_0x11c925){const _0x1c5e74=a40_0x3893d0;console['log'](_0x1c5e74(0x1fe),_0x11c925);let _0x47e4c6=_0x1c5e74(0x1f1);switch(_0x11c925[_0x1c5e74(0x21a)]?.[_0x1c5e74(0x1d7)]()){case'paid':_0x47e4c6=_0x1c5e74(0x1dd);break;case _0x1c5e74(0x239):case _0x1c5e74(0x23f):case _0x1c5e74(0x1f8):_0x47e4c6=_0x1c5e74(0x220);break;case _0x1c5e74(0x1df):case'timeout':_0x47e4c6=_0x1c5e74(0x226);break;case _0x1c5e74(0x203):case'waiting':case'awaiting\x20fiat':case _0x1c5e74(0x1f5):default:_0x47e4c6='PENDING';break;}return{'paymentId':_0x11c925[_0x1c5e74(0x24d)]||_0x11c925['merchant_reference_id']||'','status':_0x47e4c6,'amount':_0x11c925['amount'],'currency':_0x11c925[_0x1c5e74(0x222)]||_0x1c5e74(0x22e)};}}exports[a40_0x3893d0(0x1fa)]=CoinToPayService;