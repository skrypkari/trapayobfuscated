'use strict';function a47_0x5bdc(_0x23517d,_0x321578){const _0xc655e4=a47_0xc655();return a47_0x5bdc=function(_0x5bdcb1,_0xedde59){_0x5bdcb1=_0x5bdcb1-0xc0;let _0x367e6a=_0xc655e4[_0x5bdcb1];return _0x367e6a;},a47_0x5bdc(_0x23517d,_0x321578);}const a47_0x4664c6=a47_0x5bdc;(function(_0x462db7,_0x40c2f5){const _0x15bc09=a47_0x5bdc,_0x19f65c=_0x462db7();while(!![]){try{const _0x40bcd9=-parseInt(_0x15bc09(0xfd))/0x1+-parseInt(_0x15bc09(0xf2))/0x2*(-parseInt(_0x15bc09(0xd4))/0x3)+parseInt(_0x15bc09(0xec))/0x4*(-parseInt(_0x15bc09(0xe3))/0x5)+-parseInt(_0x15bc09(0xc9))/0x6+-parseInt(_0x15bc09(0xd8))/0x7+parseInt(_0x15bc09(0xc7))/0x8+parseInt(_0x15bc09(0x114))/0x9*(parseInt(_0x15bc09(0x107))/0xa);if(_0x40bcd9===_0x40c2f5)break;else _0x19f65c['push'](_0x19f65c['shift']());}catch(_0x5e0798){_0x19f65c['push'](_0x19f65c['shift']());}}}(a47_0xc655,0xef333));function a47_0xc655(){const _0x3a8f23=['6864207HSKgqp','pending','order_id','/status','log','processWebhook','expired','Payment\x20Status:','inputCurrency','URL:','paid','517980NrrZzt','loggerService','logWhiteDomainResponse','cancelled','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','PAID','data','not\x20confirmed','match','32lYSZkm','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','TransactionConfirmedOn','Business\x20Error:\x20','Parsed\x20Result:','Confirmed\x20On:','1368iFOEor','application/json','Headers:','Incomplete\x20response:\x20missing\x20data','Error\x20details:','ExpiryTime','Gateway\x20Payment\x20ID:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','statusText','defineProperty','Response\x20data:','1310885TrQKcP','EXPIRED','Status\x20Code:','gateway_payment_id','Payment\x20System/1.0','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','JSON\x20Parse\x20Error:\x20','coinAddress','statusUrl','20cNPlPs','cointopay','CoinToPay\x20payment\x20status\x20check\x20error:','Payment\x20URL\x20(modified):','message','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Unknown\x20error','Response\x20Body:','status','CoinToPay\x20status\x20API\x20error:\x20','Status','../loggerService',',\x20body:\x20','17777952gbskjv','CoinToPay\x20API\x20error:\x20','Amount:','toLowerCase','timeout','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','now','logWhiteDomainRequest','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Amount','stringify','/create','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','POST','Failed\x20to\x20parse\x20JSON\x20response:','https://tesoft.uk/gateway/cointopay/','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Result:','CoinToPayService','headers','HTTP\x20Status:','fromEntries','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','QRCodeURL','verifyPayment','Status:','CreatedOn','parse','Response\x20Time:','payment_url','awaiting\x20fiat','TransactionID','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','PENDING','Request\x20Body:','currency','apiUrl','checkPaymentStatus','&alternative=false','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','FAILED','created','failed','Unknown\x20error\x20from\x20CoinToPay\x20API','Payment\x20URL\x20(original):','stack','result','createPaymentLink','5391224eexQPF','Status\x20API\x20Error:\x20','10481100CtPcCc','EUR','status_code','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','HTTP\x20error!\x20status:\x20','HTTP\x20','üè¶\x20Extracted\x20IBAN:','waiting','error','PaymentDetail','not\x20found','5361SgPOmY','logWhiteDomainError','text','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'];a47_0xc655=function(){return _0x3a8f23;};return a47_0xc655();}Object[a47_0x4664c6(0xfb)](exports,'__esModule',{'value':!![]}),exports[a47_0x4664c6(0x127)]=void 0x0;const loggerService_1=require(a47_0x4664c6(0x112));class CoinToPayService{constructor(){const _0xd204ba=a47_0x4664c6;this[_0xd204ba(0x139)]=_0xd204ba(0x124),this['statusUrl']='https://tesoft.uk/gateway/cointopay/status.php',console[_0xd204ba(0xdc)](_0xd204ba(0x13c)),console[_0xd204ba(0xdc)]('üìä\x20Status\x20check\x20URL:',this[_0xd204ba(0x106)]);}async[a47_0x4664c6(0xc6)](_0x5f10ea){const _0x5ceeab=a47_0x4664c6,{orderId:_0x2fe651,amount:_0x3a1c51}=_0x5f10ea;console['log'](_0x5ceeab(0x121)+_0x3a1c51+'\x20EUR');const _0x14b95={'amount':_0x3a1c51},_0x2de8c4=Date[_0x5ceeab(0x11b)]();try{console[_0x5ceeab(0xdc)](_0x5ceeab(0x12b)),console['log'](_0x5ceeab(0xe1),this[_0x5ceeab(0x139)]),console[_0x5ceeab(0xdc)](_0x5ceeab(0x137),JSON[_0x5ceeab(0x11f)](_0x14b95,null,0x2)),console[_0x5ceeab(0xdc)](_0x5ceeab(0x116),_0x3a1c51,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x5ceeab(0xe4)][_0x5ceeab(0x11c)]('cointopay','/create','POST',_0x14b95);const _0x53b5ac=await fetch(this[_0x5ceeab(0x139)],{'method':_0x5ceeab(0x122),'headers':{'Content-Type':'application/json','Accept':_0x5ceeab(0xf3),'User-Agent':_0x5ceeab(0x101)},'body':JSON[_0x5ceeab(0x11f)](_0x14b95)}),_0x518afd=Date[_0x5ceeab(0x11b)]()-_0x2de8c4;console[_0x5ceeab(0xdc)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x5ceeab(0x12e),_0x53b5ac['status']),console[_0x5ceeab(0xdc)]('Status\x20Text:',_0x53b5ac[_0x5ceeab(0xfa)]),console['log'](_0x5ceeab(0xf4),Object[_0x5ceeab(0x12a)](_0x53b5ac[_0x5ceeab(0x128)]['entries']())),console[_0x5ceeab(0xdc)](_0x5ceeab(0x131),_0x518afd+'ms');const _0x7a79fd=await _0x53b5ac[_0x5ceeab(0xd6)]();console['log']('Raw\x20Response\x20Body:',_0x7a79fd);if(!_0x53b5ac['ok']){console[_0x5ceeab(0xd1)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x53b5ac[_0x5ceeab(0x10f)]),console['error'](_0x5ceeab(0x10e),_0x7a79fd),loggerService_1[_0x5ceeab(0xe4)]['logWhiteDomainResponse'](_0x5ceeab(0x108),_0x5ceeab(0x120),_0x53b5ac['status'],_0x7a79fd,_0x518afd),loggerService_1[_0x5ceeab(0xe4)][_0x5ceeab(0xd5)](_0x5ceeab(0x108),_0x5ceeab(0x120),_0x5ceeab(0xce)+_0x53b5ac[_0x5ceeab(0x10f)]+':\x20'+_0x7a79fd);throw new Error(_0x5ceeab(0xcd)+_0x53b5ac['status']+_0x5ceeab(0x113)+_0x7a79fd);}let _0xc6f696;try{_0xc6f696=JSON[_0x5ceeab(0x130)](_0x7a79fd);}catch(_0x2e86a6){console[_0x5ceeab(0xd1)](_0x5ceeab(0x123),_0x2e86a6),loggerService_1[_0x5ceeab(0xe4)][_0x5ceeab(0xd5)](_0x5ceeab(0x108),_0x5ceeab(0x120),_0x5ceeab(0x104)+_0x2e86a6);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x7a79fd);}console[_0x5ceeab(0xdc)](_0x5ceeab(0x11d)),console[_0x5ceeab(0xdc)](_0x5ceeab(0xf0),JSON[_0x5ceeab(0x11f)](_0xc6f696,null,0x2)),loggerService_1[_0x5ceeab(0xe4)]['logWhiteDomainResponse'](_0x5ceeab(0x108),_0x5ceeab(0x120),_0x53b5ac[_0x5ceeab(0x10f)],_0xc6f696,_0x518afd);if(_0xc6f696[_0x5ceeab(0xd1)]){const _0x5c6c52=_0xc6f696[_0x5ceeab(0x10b)]||_0xc6f696['error']||_0x5ceeab(0xc2);console[_0x5ceeab(0xd1)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x5ceeab(0xd1)]('Error\x20Message:',_0x5c6c52),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x5ceeab(0x120),_0x5ceeab(0xef)+_0x5c6c52);throw new Error(_0x5ceeab(0x115)+_0x5c6c52);}if(!_0xc6f696[_0x5ceeab(0x132)]||!_0xc6f696[_0x5ceeab(0x100)]){console[_0x5ceeab(0xd1)](_0x5ceeab(0xf9)),console[_0x5ceeab(0xd1)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x5ceeab(0xd1)](_0x5ceeab(0xfc),_0xc6f696),loggerService_1[_0x5ceeab(0xe4)]['logWhiteDomainError'](_0x5ceeab(0x108),_0x5ceeab(0x120),_0x5ceeab(0xed));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x5ceeab(0xdc)](_0x5ceeab(0xf8),_0xc6f696[_0x5ceeab(0x100)]),console[_0x5ceeab(0xdc)](_0x5ceeab(0xc3),_0xc6f696['payment_url']);const _0x2e50d2=_0xc6f696[_0x5ceeab(0x132)]+_0x5ceeab(0x13b);return console[_0x5ceeab(0xdc)](_0x5ceeab(0x10a),_0x2e50d2),console[_0x5ceeab(0xdc)](_0x5ceeab(0x116),_0x3a1c51,_0x5ceeab(0xca)),{'gateway_payment_id':_0xc6f696[_0x5ceeab(0x100)],'payment_url':_0x2e50d2};}catch(_0x568354){console[_0x5ceeab(0xd1)](_0x5ceeab(0x135)),console[_0x5ceeab(0xd1)](_0x5ceeab(0xf6),_0x568354),loggerService_1['loggerService'][_0x5ceeab(0xd5)](_0x5ceeab(0x108),_0x5ceeab(0x120),_0x568354);if(_0x568354 instanceof Error){console[_0x5ceeab(0xd1)]('Error\x20message:',_0x568354[_0x5ceeab(0x10b)]),console[_0x5ceeab(0xd1)]('Error\x20stack:',_0x568354[_0x5ceeab(0xc4)]);throw new Error(_0x5ceeab(0x103)+_0x568354[_0x5ceeab(0x10b)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a47_0x4664c6(0x13a)](_0x3f4d1d){const _0x5795db=a47_0x4664c6,_0x2ece33=Date[_0x5795db(0x11b)]();try{console[_0x5795db(0xdc)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x3f4d1d);const _0x4172bb={'gatewayPaymentId':_0x3f4d1d};loggerService_1[_0x5795db(0xe4)][_0x5795db(0x11c)]('cointopay',_0x5795db(0xdb),'POST',_0x4172bb);const _0x75c97f=await fetch(this[_0x5795db(0x106)],{'method':_0x5795db(0x122),'headers':{'Content-Type':_0x5795db(0xf3),'Accept':_0x5795db(0xf3),'User-Agent':_0x5795db(0x101)},'body':JSON[_0x5795db(0x11f)](_0x4172bb)}),_0x118291=Date[_0x5795db(0x11b)]()-_0x2ece33;console[_0x5795db(0xdc)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x5795db(0xdc)](_0x5795db(0x12e),_0x75c97f[_0x5795db(0x10f)]),console[_0x5795db(0xdc)](_0x5795db(0x131),_0x118291+'ms');if(!_0x75c97f['ok']){const _0x4813bb=await _0x75c97f[_0x5795db(0xd6)]();console[_0x5795db(0xd1)](_0x5795db(0x129),_0x75c97f[_0x5795db(0x10f)]),console[_0x5795db(0xd1)](_0x5795db(0x10e),_0x4813bb),loggerService_1[_0x5795db(0xe4)][_0x5795db(0xe5)]('cointopay',_0x5795db(0xdb),_0x75c97f['status'],_0x4813bb,_0x118291),loggerService_1[_0x5795db(0xe4)][_0x5795db(0xd5)](_0x5795db(0x108),_0x5795db(0xdb),_0x5795db(0xce)+_0x75c97f[_0x5795db(0x10f)]+':\x20'+_0x4813bb);throw new Error('HTTP\x20error!\x20status:\x20'+_0x75c97f[_0x5795db(0x10f)]);}const _0x22fe64=await _0x75c97f[_0x5795db(0xd6)]();console[_0x5795db(0xdc)]('Raw\x20Response\x20Body:',_0x22fe64);let _0x21175;try{_0x21175=JSON[_0x5795db(0x130)](_0x22fe64);}catch(_0x19cd2a){console[_0x5795db(0xd1)](_0x5795db(0x123),_0x19cd2a),loggerService_1[_0x5795db(0xe4)][_0x5795db(0xd5)](_0x5795db(0x108),_0x5795db(0xdb),_0x5795db(0x104)+_0x19cd2a);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x22fe64);}loggerService_1[_0x5795db(0xe4)]['logWhiteDomainResponse'](_0x5795db(0x108),_0x5795db(0xdb),_0x75c97f[_0x5795db(0x10f)],_0x21175,_0x118291),console[_0x5795db(0xdc)](_0x5795db(0x102)),console[_0x5795db(0xdc)](_0x5795db(0x126),_0x21175[_0x5795db(0xc5)]),console[_0x5795db(0xdc)](_0x5795db(0xff),_0x21175[_0x5795db(0xcb)]),console[_0x5795db(0xdc)](_0x5795db(0xdf),_0x21175[_0x5795db(0xe9)]?.[_0x5795db(0x111)]),console['log'](_0x5795db(0x116),_0x21175[_0x5795db(0xe9)]?.[_0x5795db(0x11e)]),console[_0x5795db(0xdc)]('Currency:',_0x21175[_0x5795db(0xe9)]?.[_0x5795db(0xe0)]);if(_0x21175[_0x5795db(0xc5)]!=='success'||_0x21175[_0x5795db(0xcb)]!==0xc8){const _0x3caccc=_0x21175['message']||_0x5795db(0xe7);console[_0x5795db(0xd1)](_0x5795db(0x10c)),console[_0x5795db(0xd1)]('Error\x20Message:',_0x3caccc),loggerService_1[_0x5795db(0xe4)]['logWhiteDomainError'](_0x5795db(0x108),_0x5795db(0xdb),_0x5795db(0xc8)+_0x3caccc);throw new Error(_0x5795db(0x110)+_0x3caccc);}if(!_0x21175[_0x5795db(0xe9)]){console[_0x5795db(0xd1)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x5795db(0xd1)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x5795db(0xe4)][_0x5795db(0xd5)](_0x5795db(0x108),'/status',_0x5795db(0xf5));throw new Error(_0x5795db(0xcc));}let _0x75dc84=_0x5795db(0x136);switch(_0x21175[_0x5795db(0xe9)]['Status']?.[_0x5795db(0x117)]()){case _0x5795db(0xe2):_0x75dc84=_0x5795db(0xe8);break;case _0x5795db(0xe6):case _0x5795db(0xc1):case'error':_0x75dc84=_0x5795db(0x13d);break;case _0x5795db(0xde):case _0x5795db(0x118):_0x75dc84=_0x5795db(0xfe);break;case'waiting':case _0x5795db(0x133):case _0x5795db(0xd9):case _0x5795db(0xc0):default:_0x75dc84=_0x5795db(0x136);break;}let _0x3a02f1,_0x4e7590;if(_0x21175[_0x5795db(0xe9)][_0x5795db(0xd2)]){const _0x37aba1=_0x21175[_0x5795db(0xe9)]['PaymentDetail'];console[_0x5795db(0xdc)]('üè¶\x20Payment\x20Detail:',_0x37aba1);const _0x47ada8=_0x37aba1[_0x5795db(0xeb)](/IBAN\s+([A-Z0-9]+)/i);_0x47ada8&&(_0x3a02f1=_0x47ada8[0x1],console[_0x5795db(0xdc)](_0x5795db(0xcf),_0x3a02f1)),_0x4e7590=_0x37aba1;}const _0x1866ca={'iban':_0x3a02f1,'bankDetails':_0x4e7590,'transactionId':_0x21175[_0x5795db(0xe9)][_0x5795db(0x134)],'coinAddress':_0x21175['data'][_0x5795db(0x105)],'qrCodeUrl':_0x21175[_0x5795db(0xe9)][_0x5795db(0x12c)],'expiryTime':_0x21175[_0x5795db(0xe9)][_0x5795db(0xf7)],'createdOn':_0x21175[_0x5795db(0xe9)][_0x5795db(0x12f)],'confirmedOn':_0x21175[_0x5795db(0xe9)][_0x5795db(0xee)]};console[_0x5795db(0xdc)](_0x5795db(0x125)),console[_0x5795db(0xdc)]('Status:',_0x21175['data'][_0x5795db(0x111)],'->',_0x75dc84),console[_0x5795db(0xdc)]('Amount:',_0x21175[_0x5795db(0xe9)][_0x5795db(0x11e)],_0x21175[_0x5795db(0xe9)][_0x5795db(0xe0)]),console[_0x5795db(0xdc)]('Transaction\x20ID:',_0x21175[_0x5795db(0xe9)][_0x5795db(0x134)]),console[_0x5795db(0xdc)]('IBAN:',_0x3a02f1||_0x5795db(0xd3)),console['log']('Created\x20On:',_0x21175[_0x5795db(0xe9)][_0x5795db(0x12f)]),console[_0x5795db(0xdc)](_0x5795db(0xf1),_0x21175[_0x5795db(0xe9)][_0x5795db(0xee)]||_0x5795db(0xea));if(_0x21175[_0x5795db(0xe9)][_0x5795db(0x111)]?.[_0x5795db(0x117)]()===_0x5795db(0x133))console[_0x5795db(0xdc)](_0x5795db(0x119));else _0x21175[_0x5795db(0xe9)][_0x5795db(0x111)]?.[_0x5795db(0x117)]()==='paid'&&console[_0x5795db(0xdc)](_0x5795db(0x11a));return{'status':_0x75dc84,'amount':parseFloat(_0x21175[_0x5795db(0xe9)][_0x5795db(0x11e)])||undefined,'currency':_0x21175[_0x5795db(0xe9)][_0x5795db(0xe0)]||_0x5795db(0xca),'paymentDetails':_0x1866ca};}catch(_0x46ddef){console[_0x5795db(0xd1)](_0x5795db(0x109),_0x46ddef),loggerService_1[_0x5795db(0xe4)]['logWhiteDomainError'](_0x5795db(0x108),_0x5795db(0xdb),_0x46ddef);throw new Error(_0x5795db(0xd7)+(_0x46ddef instanceof Error?_0x46ddef['message']:_0x5795db(0x10d)));}}async[a47_0x4664c6(0x12d)](_0x696c81){const _0x38a9f0=a47_0x4664c6,_0x39b1bc=await this[_0x38a9f0(0x13a)](_0x696c81);return{'status':_0x39b1bc[_0x38a9f0(0x10f)],'amount':_0x39b1bc['amount'],'currency':_0x39b1bc[_0x38a9f0(0x138)]};}async[a47_0x4664c6(0xdd)](_0x5419ad){const _0x1fedd8=a47_0x4664c6;console[_0x1fedd8(0xdc)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x5419ad);let _0x94a854=_0x1fedd8(0x136);switch(_0x5419ad[_0x1fedd8(0x10f)]?.[_0x1fedd8(0x117)]()){case _0x1fedd8(0xe2):_0x94a854=_0x1fedd8(0xe8);break;case _0x1fedd8(0xe6):case _0x1fedd8(0xc1):case _0x1fedd8(0xd1):_0x94a854='FAILED';break;case _0x1fedd8(0xde):case _0x1fedd8(0x118):_0x94a854=_0x1fedd8(0xfe);break;case'pending':case _0x1fedd8(0xd0):case _0x1fedd8(0x133):case _0x1fedd8(0xc0):default:_0x94a854=_0x1fedd8(0x136);break;}return{'paymentId':_0x5419ad[_0x1fedd8(0xda)]||_0x5419ad['merchant_reference_id']||'','status':_0x94a854,'amount':_0x5419ad['amount'],'currency':_0x5419ad[_0x1fedd8(0x138)]||_0x1fedd8(0xca)};}}exports['CoinToPayService']=CoinToPayService;