'use strict';const a40_0x4bb4f6=a40_0x5dfb;(function(_0x1e9753,_0x4a82fc){const _0x1657ba=a40_0x5dfb,_0x5269ce=_0x1e9753();while(!![]){try{const _0x414c16=parseInt(_0x1657ba(0x13d))/0x1+-parseInt(_0x1657ba(0x187))/0x2*(parseInt(_0x1657ba(0x1a4))/0x3)+-parseInt(_0x1657ba(0x13b))/0x4*(-parseInt(_0x1657ba(0x15e))/0x5)+-parseInt(_0x1657ba(0x197))/0x6*(parseInt(_0x1657ba(0x17f))/0x7)+parseInt(_0x1657ba(0x17b))/0x8+-parseInt(_0x1657ba(0x171))/0x9+parseInt(_0x1657ba(0x192))/0xa;if(_0x414c16===_0x4a82fc)break;else _0x5269ce['push'](_0x5269ce['shift']());}catch(_0x1bbb3c){_0x5269ce['push'](_0x5269ce['shift']());}}}(a40_0x403a,0xb8d49));function a40_0x5dfb(_0x1c34a1,_0x5ef523){const _0x403a27=a40_0x403a();return a40_0x5dfb=function(_0x5dfb4f,_0x53629f){_0x5dfb4f=_0x5dfb4f-0x133;let _0x39700a=_0x403a27[_0x5dfb4f];return _0x39700a;},a40_0x5dfb(_0x1c34a1,_0x5ef523);}Object[a40_0x4bb4f6(0x144)](exports,'__esModule',{'value':!![]}),exports[a40_0x4bb4f6(0x1af)]=void 0x0;const loggerService_1=require(a40_0x4bb4f6(0x16f));function a40_0x403a(){const _0x1339ae=['timeout','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','createPaymentLink','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Parsed\x20Result:','coinAddress','CoinToPayService','JSON\x20Parse\x20Error:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','entries','https://tesoft.uk/gateway/cointopay/','Response\x20Body:','EXPIRED','HTTP\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','üè¶\x20Payment\x20Detail:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','expired','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','gateway_payment_id','TesSoft\x20Payment\x20System/1.0','stringify','1089500EygtIX','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','358752NNgfBL','Currency:','fromEntries','PAID','/status','result','message','defineProperty','Confirmed\x20On:','application/json','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','match','loggerService','HTTP\x20Status:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Status:','failed','===\x20COINTOPAY\x20SUCCESS\x20===','Status','Error\x20Message:','TransactionConfirmedOn','üè¶\x20Extracted\x20IBAN:','awaiting\x20fiat','QRCodeURL','Transaction\x20ID:','Status\x20Text:','Result:','Request\x20Body:','text','created','CoinToPay\x20status\x20API\x20error:\x20','POST','üìä\x20Status\x20check\x20URL:','20QGWDjB','URL:','headers','verifyPayment','logWhiteDomainError','log','logWhiteDomainRequest','FAILED','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Headers:','now','parse','inputCurrency',',\x20body:\x20','paid','cointopay','order_id','../loggerService','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','13584762ysrCrr','Failed\x20to\x20parse\x20JSON\x20response:','TransactionID','toLowerCase','CreatedOn','pending','waiting','ExpiryTime','statusUrl','PENDING','10043656DqYZOw','Error\x20details:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','EUR','7OgQPYo','/create','logWhiteDomainResponse','Business\x20Error:\x20','cancelled','currency','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','data','1409950jqHHmU','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','status','success','payment_url','statusText','Status\x20API\x20Error:\x20','Error\x20message:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','https://tesoft.uk/gateway/cointopay/status.php','3502210mRDPYT','merchant_reference_id','Response\x20Time:','amount','Raw\x20Response\x20Body:','494832dnomkY','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Unknown\x20error\x20from\x20CoinToPay\x20API','error','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','processWebhook','Amount:','\x20EUR','status_code','apiUrl','Payment\x20Status:','Gateway\x20Payment\x20ID:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','3jqWttt','checkPaymentStatus','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Amount','PaymentDetail'];a40_0x403a=function(){return _0x1339ae;};return a40_0x403a();}class CoinToPayService{constructor(){const _0x227cfa=a40_0x4bb4f6;this[_0x227cfa(0x1a0)]=_0x227cfa(0x1b3),this['statusUrl']=_0x227cfa(0x191),console[_0x227cfa(0x163)](_0x227cfa(0x1ac)),console[_0x227cfa(0x163)](_0x227cfa(0x15d),this[_0x227cfa(0x179)]);}async[a40_0x4bb4f6(0x1ab)](_0x4b7b3c){const _0x233136=a40_0x4bb4f6,{orderId:_0x34cb71,amount:_0x2e5805}=_0x4b7b3c;console['log'](_0x233136(0x188)+_0x2e5805+_0x233136(0x19e));const _0x3b816d={'amount':_0x2e5805},_0x338ee6=Date[_0x233136(0x168)]();try{console['log'](_0x233136(0x189)),console['log'](_0x233136(0x15f),this[_0x233136(0x1a0)]),console[_0x233136(0x163)](_0x233136(0x158),JSON[_0x233136(0x13a)](_0x3b816d,null,0x2)),console[_0x233136(0x163)](_0x233136(0x19d),_0x2e5805,_0x233136(0x185)),loggerService_1[_0x233136(0x149)][_0x233136(0x164)]('cointopay','/create',_0x233136(0x15c),_0x3b816d);const _0x44b581=await fetch(this['apiUrl'],{'method':_0x233136(0x15c),'headers':{'Content-Type':_0x233136(0x146),'Accept':'application/json','User-Agent':_0x233136(0x139)},'body':JSON['stringify'](_0x3b816d)}),_0x3ebf1d=Date['now']()-_0x338ee6;console['log'](_0x233136(0x1b1)),console[_0x233136(0x163)](_0x233136(0x14c),_0x44b581[_0x233136(0x18a)]),console[_0x233136(0x163)](_0x233136(0x156),_0x44b581[_0x233136(0x18d)]),console[_0x233136(0x163)](_0x233136(0x167),Object[_0x233136(0x13f)](_0x44b581[_0x233136(0x160)][_0x233136(0x1b2)]())),console[_0x233136(0x163)](_0x233136(0x194),_0x3ebf1d+'ms');const _0x2921c2=await _0x44b581[_0x233136(0x159)]();console[_0x233136(0x163)](_0x233136(0x196),_0x2921c2);if(!_0x44b581['ok']){console[_0x233136(0x19a)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x233136(0x14a),_0x44b581[_0x233136(0x18a)]),console[_0x233136(0x19a)](_0x233136(0x1b4),_0x2921c2),loggerService_1[_0x233136(0x149)]['logWhiteDomainResponse'](_0x233136(0x16d),_0x233136(0x180),_0x44b581[_0x233136(0x18a)],_0x2921c2,_0x3ebf1d),loggerService_1[_0x233136(0x149)][_0x233136(0x162)]('cointopay',_0x233136(0x180),'HTTP\x20'+_0x44b581['status']+':\x20'+_0x2921c2);throw new Error(_0x233136(0x134)+_0x44b581[_0x233136(0x18a)]+_0x233136(0x16b)+_0x2921c2);}let _0x4c8385;try{_0x4c8385=JSON[_0x233136(0x169)](_0x2921c2);}catch(_0x4cc002){console[_0x233136(0x19a)](_0x233136(0x172),_0x4cc002),loggerService_1[_0x233136(0x149)]['logWhiteDomainError'](_0x233136(0x16d),'/create','JSON\x20Parse\x20Error:\x20'+_0x4cc002);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x2921c2);}console['log'](_0x233136(0x13c)),console[_0x233136(0x163)](_0x233136(0x1ad),JSON[_0x233136(0x13a)](_0x4c8385,null,0x2)),loggerService_1[_0x233136(0x149)][_0x233136(0x181)](_0x233136(0x16d),'/create',_0x44b581[_0x233136(0x18a)],_0x4c8385,_0x3ebf1d);if(_0x4c8385[_0x233136(0x19a)]){const _0x368a46=_0x4c8385[_0x233136(0x143)]||_0x4c8385['error']||_0x233136(0x199);console[_0x233136(0x19a)](_0x233136(0x133)),console['error'](_0x233136(0x150),_0x368a46),loggerService_1[_0x233136(0x149)][_0x233136(0x162)](_0x233136(0x16d),_0x233136(0x180),_0x233136(0x182)+_0x368a46);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x368a46);}if(!_0x4c8385['payment_url']||!_0x4c8385[_0x233136(0x138)]){console[_0x233136(0x19a)](_0x233136(0x17d)),console[_0x233136(0x19a)](_0x233136(0x147)),console[_0x233136(0x19a)]('Response\x20data:',_0x4c8385),loggerService_1[_0x233136(0x149)][_0x233136(0x162)](_0x233136(0x16d),_0x233136(0x180),_0x233136(0x135));throw new Error(_0x233136(0x198));}return console['log'](_0x233136(0x14e)),console['log'](_0x233136(0x1a2),_0x4c8385['gateway_payment_id']),console[_0x233136(0x163)]('Payment\x20URL:',_0x4c8385[_0x233136(0x18c)]),console[_0x233136(0x163)](_0x233136(0x19d),_0x2e5805,_0x233136(0x17e)),{'gateway_payment_id':_0x4c8385[_0x233136(0x138)],'payment_url':_0x4c8385[_0x233136(0x18c)]};}catch(_0x3c19be){console['error'](_0x233136(0x166)),console[_0x233136(0x19a)](_0x233136(0x17c),_0x3c19be),loggerService_1['loggerService'][_0x233136(0x162)](_0x233136(0x16d),_0x233136(0x180),_0x3c19be);if(_0x3c19be instanceof Error){console[_0x233136(0x19a)](_0x233136(0x18f),_0x3c19be['message']),console[_0x233136(0x19a)]('Error\x20stack:',_0x3c19be['stack']);throw new Error(_0x233136(0x190)+_0x3c19be[_0x233136(0x143)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x4bb4f6(0x1a5)](_0x5d95de){const _0x5cdf3d=a40_0x4bb4f6,_0x3266f7=Date['now']();try{console['log'](_0x5cdf3d(0x1aa)+_0x5d95de);const _0x38b39f={'gatewayPaymentId':_0x5d95de};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x5cdf3d(0x16d),_0x5cdf3d(0x141),_0x5cdf3d(0x15c),_0x38b39f);const _0x9d72b0=await fetch(this[_0x5cdf3d(0x179)],{'method':_0x5cdf3d(0x15c),'headers':{'Content-Type':_0x5cdf3d(0x146),'Accept':_0x5cdf3d(0x146),'User-Agent':_0x5cdf3d(0x139)},'body':JSON[_0x5cdf3d(0x13a)](_0x38b39f)}),_0x24af7b=Date[_0x5cdf3d(0x168)]()-_0x3266f7;console[_0x5cdf3d(0x163)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x5cdf3d(0x163)](_0x5cdf3d(0x14c),_0x9d72b0['status']),console['log'](_0x5cdf3d(0x194),_0x24af7b+'ms');if(!_0x9d72b0['ok']){const _0x4530cf=await _0x9d72b0['text']();console[_0x5cdf3d(0x19a)](_0x5cdf3d(0x14a),_0x9d72b0['status']),console[_0x5cdf3d(0x19a)](_0x5cdf3d(0x1b4),_0x4530cf),loggerService_1[_0x5cdf3d(0x149)][_0x5cdf3d(0x181)](_0x5cdf3d(0x16d),_0x5cdf3d(0x141),_0x9d72b0[_0x5cdf3d(0x18a)],_0x4530cf,_0x24af7b),loggerService_1[_0x5cdf3d(0x149)][_0x5cdf3d(0x162)]('cointopay',_0x5cdf3d(0x141),_0x5cdf3d(0x1b6)+_0x9d72b0[_0x5cdf3d(0x18a)]+':\x20'+_0x4530cf);throw new Error(_0x5cdf3d(0x134)+_0x9d72b0['status']);}const _0x32dfe1=await _0x9d72b0[_0x5cdf3d(0x159)]();console[_0x5cdf3d(0x163)](_0x5cdf3d(0x196),_0x32dfe1);let _0x2dd2f0;try{_0x2dd2f0=JSON[_0x5cdf3d(0x169)](_0x32dfe1);}catch(_0x491925){console[_0x5cdf3d(0x19a)](_0x5cdf3d(0x172),_0x491925),loggerService_1[_0x5cdf3d(0x149)][_0x5cdf3d(0x162)](_0x5cdf3d(0x16d),_0x5cdf3d(0x141),_0x5cdf3d(0x1b0)+_0x491925);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x32dfe1);}loggerService_1['loggerService'][_0x5cdf3d(0x181)](_0x5cdf3d(0x16d),_0x5cdf3d(0x141),_0x9d72b0[_0x5cdf3d(0x18a)],_0x2dd2f0,_0x24af7b),console['log'](_0x5cdf3d(0x137)),console[_0x5cdf3d(0x163)](_0x5cdf3d(0x157),_0x2dd2f0[_0x5cdf3d(0x142)]),console[_0x5cdf3d(0x163)]('Status\x20Code:',_0x2dd2f0[_0x5cdf3d(0x19f)]),console[_0x5cdf3d(0x163)](_0x5cdf3d(0x1a1),_0x2dd2f0[_0x5cdf3d(0x186)]?.[_0x5cdf3d(0x14f)]),console['log'](_0x5cdf3d(0x19d),_0x2dd2f0[_0x5cdf3d(0x186)]?.['Amount']),console['log'](_0x5cdf3d(0x13e),_0x2dd2f0['data']?.['inputCurrency']);if(_0x2dd2f0[_0x5cdf3d(0x142)]!==_0x5cdf3d(0x18b)||_0x2dd2f0[_0x5cdf3d(0x19f)]!==0xc8){const _0x1fb139=_0x2dd2f0[_0x5cdf3d(0x143)]||_0x5cdf3d(0x1a6);console[_0x5cdf3d(0x19a)](_0x5cdf3d(0x1b7)),console[_0x5cdf3d(0x19a)](_0x5cdf3d(0x150),_0x1fb139),loggerService_1[_0x5cdf3d(0x149)]['logWhiteDomainError'](_0x5cdf3d(0x16d),_0x5cdf3d(0x141),_0x5cdf3d(0x18e)+_0x1fb139);throw new Error(_0x5cdf3d(0x15b)+_0x1fb139);}if(!_0x2dd2f0['data']){console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x5cdf3d(0x19a)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x5cdf3d(0x149)][_0x5cdf3d(0x162)]('cointopay','/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0x5cdf3d(0x19b));}let _0x1b2a77='PENDING';switch(_0x2dd2f0[_0x5cdf3d(0x186)][_0x5cdf3d(0x14f)]?.[_0x5cdf3d(0x174)]()){case _0x5cdf3d(0x16c):_0x1b2a77=_0x5cdf3d(0x140);break;case _0x5cdf3d(0x183):case'failed':case _0x5cdf3d(0x19a):_0x1b2a77='FAILED';break;case _0x5cdf3d(0x136):case _0x5cdf3d(0x1a9):_0x1b2a77=_0x5cdf3d(0x1b5);break;case _0x5cdf3d(0x177):case _0x5cdf3d(0x153):case _0x5cdf3d(0x176):case'created':default:_0x1b2a77=_0x5cdf3d(0x17a);break;}let _0x5dd62f,_0x1c948e;if(_0x2dd2f0['data'][_0x5cdf3d(0x1a8)]){const _0x28143b=_0x2dd2f0[_0x5cdf3d(0x186)][_0x5cdf3d(0x1a8)];console['log'](_0x5cdf3d(0x1b8),_0x28143b);const _0x3848fb=_0x28143b[_0x5cdf3d(0x148)](/IBAN\s+([A-Z0-9]+)/i);_0x3848fb&&(_0x5dd62f=_0x3848fb[0x1],console[_0x5cdf3d(0x163)](_0x5cdf3d(0x152),_0x5dd62f)),_0x1c948e=_0x28143b;}const _0x57ef8b={'iban':_0x5dd62f,'bankDetails':_0x1c948e,'transactionId':_0x2dd2f0[_0x5cdf3d(0x186)][_0x5cdf3d(0x173)],'coinAddress':_0x2dd2f0[_0x5cdf3d(0x186)][_0x5cdf3d(0x1ae)],'qrCodeUrl':_0x2dd2f0['data'][_0x5cdf3d(0x154)],'expiryTime':_0x2dd2f0['data'][_0x5cdf3d(0x178)],'createdOn':_0x2dd2f0[_0x5cdf3d(0x186)][_0x5cdf3d(0x175)],'confirmedOn':_0x2dd2f0[_0x5cdf3d(0x186)][_0x5cdf3d(0x151)]};console['log'](_0x5cdf3d(0x14b)),console[_0x5cdf3d(0x163)]('Status:',_0x2dd2f0['data']['Status'],'->',_0x1b2a77),console[_0x5cdf3d(0x163)](_0x5cdf3d(0x19d),_0x2dd2f0[_0x5cdf3d(0x186)][_0x5cdf3d(0x1a7)],_0x2dd2f0['data'][_0x5cdf3d(0x16a)]),console[_0x5cdf3d(0x163)](_0x5cdf3d(0x155),_0x2dd2f0[_0x5cdf3d(0x186)][_0x5cdf3d(0x173)]),console[_0x5cdf3d(0x163)]('IBAN:',_0x5dd62f||'not\x20found'),console[_0x5cdf3d(0x163)]('Created\x20On:',_0x2dd2f0[_0x5cdf3d(0x186)][_0x5cdf3d(0x175)]),console['log'](_0x5cdf3d(0x145),_0x2dd2f0[_0x5cdf3d(0x186)][_0x5cdf3d(0x151)]||'not\x20confirmed');if(_0x2dd2f0[_0x5cdf3d(0x186)][_0x5cdf3d(0x14f)]?.['toLowerCase']()===_0x5cdf3d(0x153))console[_0x5cdf3d(0x163)](_0x5cdf3d(0x170));else _0x2dd2f0[_0x5cdf3d(0x186)][_0x5cdf3d(0x14f)]?.[_0x5cdf3d(0x174)]()===_0x5cdf3d(0x16c)&&console[_0x5cdf3d(0x163)](_0x5cdf3d(0x1a3));return{'status':_0x1b2a77,'amount':parseFloat(_0x2dd2f0[_0x5cdf3d(0x186)]['Amount'])||undefined,'currency':_0x2dd2f0['data']['inputCurrency']||_0x5cdf3d(0x17e),'paymentDetails':_0x57ef8b};}catch(_0x246217){console[_0x5cdf3d(0x19a)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x246217),loggerService_1[_0x5cdf3d(0x149)][_0x5cdf3d(0x162)]('cointopay',_0x5cdf3d(0x141),_0x246217);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x246217 instanceof Error?_0x246217[_0x5cdf3d(0x143)]:'Unknown\x20error'));}}async[a40_0x4bb4f6(0x161)](_0x2b626c){const _0x188b89=a40_0x4bb4f6,_0x32ae9e=await this[_0x188b89(0x1a5)](_0x2b626c);return{'status':_0x32ae9e[_0x188b89(0x18a)],'amount':_0x32ae9e[_0x188b89(0x195)],'currency':_0x32ae9e[_0x188b89(0x184)]};}async[a40_0x4bb4f6(0x19c)](_0x171083){const _0x51818d=a40_0x4bb4f6;console['log']('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x171083);let _0x3c7ca5=_0x51818d(0x17a);switch(_0x171083[_0x51818d(0x18a)]?.[_0x51818d(0x174)]()){case _0x51818d(0x16c):_0x3c7ca5=_0x51818d(0x140);break;case _0x51818d(0x183):case _0x51818d(0x14d):case _0x51818d(0x19a):_0x3c7ca5=_0x51818d(0x165);break;case'expired':case _0x51818d(0x1a9):_0x3c7ca5=_0x51818d(0x1b5);break;case _0x51818d(0x176):case _0x51818d(0x177):case _0x51818d(0x153):case _0x51818d(0x15a):default:_0x3c7ca5=_0x51818d(0x17a);break;}return{'paymentId':_0x171083[_0x51818d(0x16e)]||_0x171083[_0x51818d(0x193)]||'','status':_0x3c7ca5,'amount':_0x171083[_0x51818d(0x195)],'currency':_0x171083[_0x51818d(0x184)]||_0x51818d(0x17e)};}}exports['CoinToPayService']=CoinToPayService;