'use strict';const a38_0x54ccf9=a38_0x4b43;(function(_0x2c9942,_0x421ae1){const _0x3f131e=a38_0x4b43,_0x55652c=_0x2c9942();while(!![]){try{const _0x1ffac1=parseInt(_0x3f131e(0x101))/0x1+parseInt(_0x3f131e(0x147))/0x2+parseInt(_0x3f131e(0x116))/0x3+-parseInt(_0x3f131e(0x106))/0x4+parseInt(_0x3f131e(0xff))/0x5*(parseInt(_0x3f131e(0xe4))/0x6)+-parseInt(_0x3f131e(0x13c))/0x7*(parseInt(_0x3f131e(0x138))/0x8)+parseInt(_0x3f131e(0x100))/0x9;if(_0x1ffac1===_0x421ae1)break;else _0x55652c['push'](_0x55652c['shift']());}catch(_0x567375){_0x55652c['push'](_0x55652c['shift']());}}}(a38_0x3cb4,0xdbc56));Object[a38_0x54ccf9(0xf0)](exports,a38_0x54ccf9(0xdb),{'value':!![]}),exports[a38_0x54ccf9(0x10d)]=void 0x0;const loggerService_1=require(a38_0x54ccf9(0xd1));function a38_0x4b43(_0x1fd4c1,_0x2f619c){const _0x3cb4fc=a38_0x3cb4();return a38_0x4b43=function(_0x4b4374,_0x132e3a){_0x4b4374=_0x4b4374-0xcf;let _0x7a302b=_0x3cb4fc[_0x4b4374];return _0x7a302b;},a38_0x4b43(_0x1fd4c1,_0x2f619c);}class CoinToPayService{constructor(){const _0x303946=a38_0x54ccf9;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this[_0x303946(0x13b)]='https://tesoft.uk/gateway/cointopay/status.php',console['log']('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x303946(0x142)](_0x303946(0x145),this['statusUrl']);}async[a38_0x54ccf9(0xfd)](_0x10e0db){const _0x1a6a45=a38_0x54ccf9,{orderId:_0x1b87b3,amount:_0x4925b2}=_0x10e0db;console[_0x1a6a45(0x142)](_0x1a6a45(0xea)+_0x4925b2+_0x1a6a45(0xd5));const _0x2ab01a={'amount':_0x4925b2},_0x2b7a51=Date[_0x1a6a45(0x112)]();try{console['log'](_0x1a6a45(0xe7)),console[_0x1a6a45(0x142)](_0x1a6a45(0x129),this['apiUrl']),console[_0x1a6a45(0x142)](_0x1a6a45(0xd8),JSON[_0x1a6a45(0x124)](_0x2ab01a,null,0x2)),console[_0x1a6a45(0x142)](_0x1a6a45(0x14d),_0x4925b2,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x1a6a45(0xf3)]['logWhiteDomainRequest']('cointopay','/create','POST',_0x2ab01a);const _0x5cc22e=await fetch(this[_0x1a6a45(0x11e)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x1a6a45(0x14a),'User-Agent':_0x1a6a45(0xf7)},'body':JSON[_0x1a6a45(0x124)](_0x2ab01a)}),_0x40af95=Date[_0x1a6a45(0x112)]()-_0x2b7a51;console[_0x1a6a45(0x142)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x1a6a45(0x142)](_0x1a6a45(0xf2),_0x5cc22e[_0x1a6a45(0x148)]),console['log'](_0x1a6a45(0xe0),_0x5cc22e[_0x1a6a45(0x102)]),console[_0x1a6a45(0x142)]('Headers:',Object[_0x1a6a45(0x114)](_0x5cc22e['headers']['entries']())),console[_0x1a6a45(0x142)](_0x1a6a45(0x108),_0x40af95+'ms');const _0x5e1ce1=await _0x5cc22e[_0x1a6a45(0xd4)]();console[_0x1a6a45(0x142)]('Raw\x20Response\x20Body:',_0x5e1ce1);if(!_0x5cc22e['ok']){console[_0x1a6a45(0x140)](_0x1a6a45(0xe1)),console['error']('HTTP\x20Status:',_0x5cc22e['status']),console['error'](_0x1a6a45(0x113),_0x5e1ce1),loggerService_1[_0x1a6a45(0xf3)][_0x1a6a45(0x11a)](_0x1a6a45(0x107),_0x1a6a45(0x143),_0x5cc22e['status'],_0x5e1ce1,_0x40af95),loggerService_1[_0x1a6a45(0xf3)][_0x1a6a45(0xf6)](_0x1a6a45(0x107),'/create',_0x1a6a45(0x118)+_0x5cc22e[_0x1a6a45(0x148)]+':\x20'+_0x5e1ce1);throw new Error(_0x1a6a45(0xda)+_0x5cc22e[_0x1a6a45(0x148)]+_0x1a6a45(0x12c)+_0x5e1ce1);}let _0x52b7c3;try{_0x52b7c3=JSON[_0x1a6a45(0xf9)](_0x5e1ce1);}catch(_0x2d79ee){console[_0x1a6a45(0x140)](_0x1a6a45(0x13a),_0x2d79ee),loggerService_1[_0x1a6a45(0xf3)]['logWhiteDomainError'](_0x1a6a45(0x107),'/create','JSON\x20Parse\x20Error:\x20'+_0x2d79ee);throw new Error(_0x1a6a45(0xcf)+_0x5e1ce1);}console[_0x1a6a45(0x142)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x1a6a45(0x142)](_0x1a6a45(0x12e),JSON[_0x1a6a45(0x124)](_0x52b7c3,null,0x2)),loggerService_1[_0x1a6a45(0xf3)][_0x1a6a45(0x11a)](_0x1a6a45(0x107),_0x1a6a45(0x143),_0x5cc22e['status'],_0x52b7c3,_0x40af95);if(_0x52b7c3['error']){const _0x17d086=_0x52b7c3[_0x1a6a45(0x149)]||_0x52b7c3[_0x1a6a45(0x140)]||_0x1a6a45(0xfc);console[_0x1a6a45(0x140)](_0x1a6a45(0x132)),console['error']('Error\x20Message:',_0x17d086),loggerService_1[_0x1a6a45(0xf3)]['logWhiteDomainError'](_0x1a6a45(0x107),_0x1a6a45(0x143),_0x1a6a45(0x10e)+_0x17d086);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x17d086);}if(!_0x52b7c3[_0x1a6a45(0xf4)]||!_0x52b7c3[_0x1a6a45(0x134)]){console[_0x1a6a45(0x140)](_0x1a6a45(0x120)),console[_0x1a6a45(0x140)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x1a6a45(0x140)](_0x1a6a45(0xec),_0x52b7c3),loggerService_1[_0x1a6a45(0xf3)][_0x1a6a45(0xf6)](_0x1a6a45(0x107),'/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x1a6a45(0x12f));}return console['log'](_0x1a6a45(0x13e)),console[_0x1a6a45(0x142)](_0x1a6a45(0xdc),_0x52b7c3[_0x1a6a45(0x134)]),console[_0x1a6a45(0x142)](_0x1a6a45(0xed),_0x52b7c3[_0x1a6a45(0xf4)]),console[_0x1a6a45(0x142)]('Amount:',_0x4925b2,_0x1a6a45(0x104)),{'gateway_payment_id':_0x52b7c3[_0x1a6a45(0x134)],'payment_url':_0x52b7c3['payment_url']};}catch(_0x3df8a9){console[_0x1a6a45(0x140)](_0x1a6a45(0xdd)),console[_0x1a6a45(0x140)](_0x1a6a45(0xf5),_0x3df8a9),loggerService_1[_0x1a6a45(0xf3)][_0x1a6a45(0xf6)]('cointopay',_0x1a6a45(0x143),_0x3df8a9);if(_0x3df8a9 instanceof Error){console[_0x1a6a45(0x140)](_0x1a6a45(0x119),_0x3df8a9[_0x1a6a45(0x149)]),console[_0x1a6a45(0x140)](_0x1a6a45(0xd3),_0x3df8a9['stack']);throw new Error(_0x1a6a45(0x126)+_0x3df8a9['message']);}throw new Error(_0x1a6a45(0x109));}}async[a38_0x54ccf9(0xe3)](_0x409987){const _0x929dec=a38_0x54ccf9,_0x49887c=Date[_0x929dec(0x112)]();try{console[_0x929dec(0x142)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x409987);const _0x26d3f3={'gatewayPaymentId':_0x409987};loggerService_1[_0x929dec(0xf3)]['logWhiteDomainRequest'](_0x929dec(0x107),_0x929dec(0x10c),_0x929dec(0xe2),_0x26d3f3);const _0x32a777=await fetch(this['statusUrl'],{'method':_0x929dec(0xe2),'headers':{'Content-Type':_0x929dec(0x14a),'Accept':_0x929dec(0x14a),'User-Agent':_0x929dec(0xf7)},'body':JSON[_0x929dec(0x124)](_0x26d3f3)}),_0x32f72e=Date[_0x929dec(0x112)]()-_0x49887c;console[_0x929dec(0x142)](_0x929dec(0x14e)),console['log'](_0x929dec(0xf2),_0x32a777[_0x929dec(0x148)]),console[_0x929dec(0x142)]('Response\x20Time:',_0x32f72e+'ms');if(!_0x32a777['ok']){const _0xdaccac=await _0x32a777[_0x929dec(0xd4)]();console['error']('HTTP\x20Status:',_0x32a777[_0x929dec(0x148)]),console['error'](_0x929dec(0x113),_0xdaccac),loggerService_1[_0x929dec(0xf3)][_0x929dec(0x11a)](_0x929dec(0x107),'/status',_0x32a777['status'],_0xdaccac,_0x32f72e),loggerService_1[_0x929dec(0xf3)][_0x929dec(0xf6)](_0x929dec(0x107),_0x929dec(0x10c),_0x929dec(0x118)+_0x32a777[_0x929dec(0x148)]+':\x20'+_0xdaccac);throw new Error(_0x929dec(0xda)+_0x32a777[_0x929dec(0x148)]);}const _0x2b049f=await _0x32a777[_0x929dec(0xd4)]();console[_0x929dec(0x142)]('Raw\x20Response\x20Body:',_0x2b049f);let _0x27e7c3;try{_0x27e7c3=JSON[_0x929dec(0xf9)](_0x2b049f);}catch(_0x5147cb){console[_0x929dec(0x140)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5147cb),loggerService_1[_0x929dec(0xf3)][_0x929dec(0xf6)]('cointopay','/status','JSON\x20Parse\x20Error:\x20'+_0x5147cb);throw new Error(_0x929dec(0x110)+_0x2b049f);}loggerService_1[_0x929dec(0xf3)][_0x929dec(0x11a)](_0x929dec(0x107),'/status',_0x32a777[_0x929dec(0x148)],_0x27e7c3,_0x32f72e),console['log'](_0x929dec(0xe8)),console['log'](_0x929dec(0x137),_0x27e7c3[_0x929dec(0x125)]),console['log'](_0x929dec(0x128),_0x27e7c3[_0x929dec(0x130)]),console['log'](_0x929dec(0xf1),_0x27e7c3[_0x929dec(0xee)]?.['Status']),console[_0x929dec(0x142)](_0x929dec(0x14d),_0x27e7c3[_0x929dec(0xee)]?.['Amount']),console['log'](_0x929dec(0xef),_0x27e7c3[_0x929dec(0xee)]?.[_0x929dec(0xd0)]);if(_0x27e7c3['result']!==_0x929dec(0x11f)||_0x27e7c3[_0x929dec(0x130)]!==0xc8){const _0x2ed164=_0x27e7c3[_0x929dec(0x149)]||_0x929dec(0xd7);console['error'](_0x929dec(0x13f)),console[_0x929dec(0x140)](_0x929dec(0x139),_0x2ed164),loggerService_1[_0x929dec(0xf3)][_0x929dec(0xf6)](_0x929dec(0x107),_0x929dec(0x10c),_0x929dec(0x144)+_0x2ed164);throw new Error(_0x929dec(0x117)+_0x2ed164);}if(!_0x27e7c3[_0x929dec(0xee)]){console['error'](_0x929dec(0x11b)),console[_0x929dec(0x140)](_0x929dec(0x146)),loggerService_1[_0x929dec(0xf3)][_0x929dec(0xf6)](_0x929dec(0x107),_0x929dec(0x10c),_0x929dec(0x103));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x11a02a=_0x929dec(0x14f);switch(_0x27e7c3[_0x929dec(0xee)][_0x929dec(0x11d)]?.['toLowerCase']()){case _0x929dec(0xf8):_0x11a02a=_0x929dec(0x133);break;case _0x929dec(0x111):case _0x929dec(0x12d):case _0x929dec(0x140):_0x11a02a=_0x929dec(0xfb);break;case _0x929dec(0x136):case _0x929dec(0xe6):_0x11a02a=_0x929dec(0xfe);break;case'waiting':case _0x929dec(0x121):case'pending':case _0x929dec(0x10f):default:_0x11a02a=_0x929dec(0x14f);break;}let _0x59bf1b,_0x1a68bc;if(_0x27e7c3[_0x929dec(0xee)][_0x929dec(0xd9)]){const _0x569c7d=_0x27e7c3['data']['PaymentDetail'];console[_0x929dec(0x142)](_0x929dec(0x13d),_0x569c7d);const _0x18b3c4=_0x569c7d['match'](/IBAN\s+([A-Z0-9]+)/i);_0x18b3c4&&(_0x59bf1b=_0x18b3c4[0x1],console[_0x929dec(0x142)](_0x929dec(0xd2),_0x59bf1b)),_0x1a68bc=_0x569c7d;}const _0x529fa8={'iban':_0x59bf1b,'bankDetails':_0x1a68bc,'transactionId':_0x27e7c3['data'][_0x929dec(0xeb)],'coinAddress':_0x27e7c3[_0x929dec(0xee)]['coinAddress'],'qrCodeUrl':_0x27e7c3[_0x929dec(0xee)][_0x929dec(0x14b)],'expiryTime':_0x27e7c3[_0x929dec(0xee)]['ExpiryTime'],'createdOn':_0x27e7c3[_0x929dec(0xee)][_0x929dec(0xd6)],'confirmedOn':_0x27e7c3['data'][_0x929dec(0x141)]};console[_0x929dec(0x142)](_0x929dec(0x12b)),console['log'](_0x929dec(0xf2),_0x27e7c3[_0x929dec(0xee)][_0x929dec(0x11d)],'->',_0x11a02a),console[_0x929dec(0x142)](_0x929dec(0x14d),_0x27e7c3[_0x929dec(0xee)][_0x929dec(0x105)],_0x27e7c3[_0x929dec(0xee)][_0x929dec(0xd0)]),console[_0x929dec(0x142)](_0x929dec(0x122),_0x27e7c3[_0x929dec(0xee)]['TransactionID']),console[_0x929dec(0x142)]('IBAN:',_0x59bf1b||_0x929dec(0x11c)),console[_0x929dec(0x142)]('Created\x20On:',_0x27e7c3[_0x929dec(0xee)]['CreatedOn']),console['log']('Confirmed\x20On:',_0x27e7c3[_0x929dec(0xee)][_0x929dec(0x141)]||_0x929dec(0x127));if(_0x27e7c3[_0x929dec(0xee)][_0x929dec(0x11d)]?.[_0x929dec(0x14c)]()===_0x929dec(0x121))console['log'](_0x929dec(0x115));else _0x27e7c3[_0x929dec(0xee)][_0x929dec(0x11d)]?.[_0x929dec(0x14c)]()===_0x929dec(0xf8)&&console['log'](_0x929dec(0xe5));return{'status':_0x11a02a,'amount':parseFloat(_0x27e7c3[_0x929dec(0xee)][_0x929dec(0x105)])||undefined,'currency':_0x27e7c3[_0x929dec(0xee)][_0x929dec(0xd0)]||'EUR','paymentDetails':_0x529fa8};}catch(_0x2c2254){console['error'](_0x929dec(0x135),_0x2c2254),loggerService_1[_0x929dec(0xf3)][_0x929dec(0xf6)](_0x929dec(0x107),_0x929dec(0x10c),_0x2c2254);throw new Error(_0x929dec(0x131)+(_0x2c2254 instanceof Error?_0x2c2254[_0x929dec(0x149)]:_0x929dec(0x123)));}}async[a38_0x54ccf9(0xfa)](_0x311fc7){const _0x27c3ea=a38_0x54ccf9,_0x44dccc=await this[_0x27c3ea(0xe3)](_0x311fc7);return{'status':_0x44dccc[_0x27c3ea(0x148)],'amount':_0x44dccc[_0x27c3ea(0xe9)],'currency':_0x44dccc[_0x27c3ea(0xdf)]};}async[a38_0x54ccf9(0x12a)](_0xb12871){const _0x2dbd75=a38_0x54ccf9;console[_0x2dbd75(0x142)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0xb12871);let _0x8ef01a=_0x2dbd75(0x14f);switch(_0xb12871[_0x2dbd75(0x148)]?.[_0x2dbd75(0x14c)]()){case'paid':_0x8ef01a=_0x2dbd75(0x133);break;case'cancelled':case'failed':case _0x2dbd75(0x140):_0x8ef01a=_0x2dbd75(0xfb);break;case _0x2dbd75(0x136):case _0x2dbd75(0xe6):_0x8ef01a='EXPIRED';break;case _0x2dbd75(0x10b):case _0x2dbd75(0xde):case _0x2dbd75(0x121):case'created':default:_0x8ef01a=_0x2dbd75(0x14f);break;}return{'paymentId':_0xb12871['order_id']||_0xb12871[_0x2dbd75(0x10a)]||'','status':_0x8ef01a,'amount':_0xb12871[_0x2dbd75(0xe9)],'currency':_0xb12871['currency']||'EUR'};}}function a38_0x3cb4(){const _0x1f08ce=['Response\x20Time:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','merchant_reference_id','pending','/status','CoinToPayService','Business\x20Error:\x20','created','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','cancelled','now','Response\x20Body:','fromEntries','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','1651500wyRTnF','CoinToPay\x20status\x20API\x20error:\x20','HTTP\x20','Error\x20message:','logWhiteDomainResponse','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','not\x20found','Status','apiUrl','success','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','awaiting\x20fiat','Transaction\x20ID:','Unknown\x20error','stringify','result','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','not\x20confirmed','Status\x20Code:','URL:','processWebhook','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===',',\x20body:\x20','failed','Parsed\x20Result:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','status_code','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','PAID','gateway_payment_id','CoinToPay\x20payment\x20status\x20check\x20error:','expired','Result:','10636880OiFgDF','Error\x20Message:','Failed\x20to\x20parse\x20JSON\x20response:','statusUrl','7qDeZpJ','üè¶\x20Payment\x20Detail:','===\x20COINTOPAY\x20SUCCESS\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','error','TransactionConfirmedOn','log','/create','Status\x20API\x20Error:\x20','üìä\x20Status\x20check\x20URL:','Missing\x20data\x20in\x20response','1921674gFifOn','status','message','application/json','QRCodeURL','toLowerCase','Amount:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','PENDING','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','inputCurrency','../loggerService','üè¶\x20Extracted\x20IBAN:','Error\x20stack:','text','\x20EUR','CreatedOn','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Request\x20Body:','PaymentDetail','HTTP\x20error!\x20status:\x20','__esModule','Gateway\x20Payment\x20ID:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','waiting','currency','Status\x20Text:','===\x20COINTOPAY\x20API\x20ERROR\x20===','POST','checkPaymentStatus','871422MNVQnW','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','timeout','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','amount','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','TransactionID','Response\x20data:','Payment\x20URL:','data','Currency:','defineProperty','Payment\x20Status:','Status:','loggerService','payment_url','Error\x20details:','logWhiteDomainError','TesSoft\x20Payment\x20System/1.0','paid','parse','verifyPayment','FAILED','Unknown\x20error\x20from\x20CoinToPay\x20API','createPaymentLink','EXPIRED','45dZbFXo','8191314quQViu','108527lSGZHb','statusText','Incomplete\x20response:\x20missing\x20data','EUR','Amount','6429404JnHxcn','cointopay'];a38_0x3cb4=function(){return _0x1f08ce;};return a38_0x3cb4();}exports[a38_0x54ccf9(0x10d)]=CoinToPayService;