'use strict';function a38_0xd492(){const _0x3be4ad=['statusText','https://tesoft.uk/gateway/cointopay/status.php','error','__esModule','status','awaiting\x20fiat','CoinToPay\x20payment\x20status\x20check\x20error:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Error\x20stack:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','9KhWHEm','POST','paid','Status','pending','checkPaymentStatus','merchant_reference_id','Payment\x20Status:','Transaction\x20ID:','https://tesoft.uk/gateway/cointopay/','IBAN:','HTTP\x20Status:','TransactionID','verifyPayment','6180lvOyGz','now','payment_url','FAILED','Response\x20Time:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','597001okrNUw','amount','788236oqmwzy','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Result:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Response\x20Body:','JSON\x20Parse\x20Error:\x20','success','Status:','log','logWhiteDomainResponse','5598rRbzHU','message','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','stack','parse','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Parsed\x20Result:','Amount','entries','CreatedOn','PAID','\x20EUR','/status','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Created\x20On:',',\x20body:\x20','timeout','Raw\x20Response\x20Body:','processWebhook','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','CoinToPay\x20API\x20error:\x20','createPaymentLink','not\x20found','===\x20COINTOPAY\x20SUCCESS\x20===','Status\x20Code:','5pwTGzC','üè¶\x20Extracted\x20IBAN:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','created','PaymentDetail','loggerService','Headers:','cointopay','match','application/json','Response\x20data:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PENDING','Unknown\x20error','logWhiteDomainRequest','headers','Currency:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','6162fsOHyV','CoinToPayService','text','Amount:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','/create','expired','cancelled','status_code','Unknown\x20error\x20from\x20CoinToPay\x20API','Payment\x20URL:','apiUrl','Incomplete\x20response:\x20missing\x20data','150854DMjmhl','4835000dAgutI','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Confirmed\x20On:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','CoinToPay\x20status\x20API\x20error:\x20','TesSoft\x20Payment\x20System/1.0','data','defineProperty','EUR','HTTP\x20error!\x20status:\x20','gateway_payment_id','toLowerCase','result','statusUrl','failed','URL:','logWhiteDomainError','stringify','Request\x20Body:','Gateway\x20Payment\x20ID:','1803039nlkYvI','Failed\x20to\x20parse\x20JSON\x20response:','üìä\x20Status\x20check\x20URL:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','waiting','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Status\x20Text:','HTTP\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','fromEntries','Error\x20Message:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='];a38_0xd492=function(){return _0x3be4ad;};return a38_0xd492();}const a38_0x460c06=a38_0x2e65;(function(_0x3cb730,_0x587722){const _0x37fe1e=a38_0x2e65,_0x310020=_0x3cb730();while(!![]){try{const _0x1a26ac=-parseInt(_0x37fe1e(0xd4))/0x1+-parseInt(_0x37fe1e(0x93))/0x2*(-parseInt(_0x37fe1e(0xbf))/0x3)+parseInt(_0x37fe1e(0xd6))/0x4+-parseInt(_0x37fe1e(0x74))/0x5*(-parseInt(_0x37fe1e(0x86))/0x6)+parseInt(_0x37fe1e(0xa8))/0x7+parseInt(_0x37fe1e(0x94))/0x8+parseInt(_0x37fe1e(0xe1))/0x9*(-parseInt(_0x37fe1e(0xcd))/0xa);if(_0x1a26ac===_0x587722)break;else _0x310020['push'](_0x310020['shift']());}catch(_0x4b8e00){_0x310020['push'](_0x310020['shift']());}}}(a38_0xd492,0x4a71a));Object[a38_0x460c06(0x9b)](exports,a38_0x460c06(0xb7),{'value':!![]}),exports[a38_0x460c06(0x87)]=void 0x0;const loggerService_1=require('../loggerService');function a38_0x2e65(_0x5ecaae,_0x54daf1){const _0xd4920f=a38_0xd492();return a38_0x2e65=function(_0x2e65de,_0x28897){_0x2e65de=_0x2e65de-0x6b;let _0x21de7b=_0xd4920f[_0x2e65de];return _0x21de7b;},a38_0x2e65(_0x5ecaae,_0x54daf1);}class CoinToPayService{constructor(){const _0x337dcb=a38_0x460c06;this['apiUrl']=_0x337dcb(0xc8),this[_0x337dcb(0xa1)]=_0x337dcb(0xb5),console['log'](_0x337dcb(0xbe)),console['log'](_0x337dcb(0xaa),this['statusUrl']);}async[a38_0x460c06(0x70)](_0x2efce1){const _0x204b3d=a38_0x460c06,{orderId:_0x24ecfd,amount:_0xeb2028}=_0x2efce1;console[_0x204b3d(0xdf)](_0x204b3d(0x76)+_0xeb2028+_0x204b3d(0xed));const _0xf1a610={'amount':_0xeb2028},_0x204e08=Date['now']();try{console[_0x204b3d(0xdf)](_0x204b3d(0xef)),console[_0x204b3d(0xdf)](_0x204b3d(0xa3),this[_0x204b3d(0x91)]),console[_0x204b3d(0xdf)](_0x204b3d(0xa6),JSON[_0x204b3d(0xa5)](_0xf1a610,null,0x2)),console['log']('Amount:',_0xeb2028,_0x204b3d(0x97)),loggerService_1[_0x204b3d(0x79)][_0x204b3d(0x82)](_0x204b3d(0x7b),'/create',_0x204b3d(0xc0),_0xf1a610);const _0x4caefd=await fetch(this[_0x204b3d(0x91)],{'method':_0x204b3d(0xc0),'headers':{'Content-Type':'application/json','Accept':_0x204b3d(0x7d),'User-Agent':_0x204b3d(0x99)},'body':JSON['stringify'](_0xf1a610)}),_0x7fb998=Date[_0x204b3d(0xce)]()-_0x204e08;console[_0x204b3d(0xdf)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x204b3d(0xde),_0x4caefd[_0x204b3d(0xb8)]),console[_0x204b3d(0xdf)](_0x204b3d(0xae),_0x4caefd[_0x204b3d(0xb4)]),console[_0x204b3d(0xdf)](_0x204b3d(0x7a),Object[_0x204b3d(0xb1)](_0x4caefd[_0x204b3d(0x83)][_0x204b3d(0xea)]())),console[_0x204b3d(0xdf)](_0x204b3d(0xd1),_0x7fb998+'ms');const _0x2abc23=await _0x4caefd[_0x204b3d(0x88)]();console['log'](_0x204b3d(0x6c),_0x2abc23);if(!_0x4caefd['ok']){console[_0x204b3d(0xb6)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x204b3d(0xca),_0x4caefd[_0x204b3d(0xb8)]),console[_0x204b3d(0xb6)]('Response\x20Body:',_0x2abc23),loggerService_1['loggerService'][_0x204b3d(0xe0)](_0x204b3d(0x7b),_0x204b3d(0x8b),_0x4caefd['status'],_0x2abc23,_0x7fb998),loggerService_1[_0x204b3d(0x79)][_0x204b3d(0xa4)](_0x204b3d(0x7b),_0x204b3d(0x8b),_0x204b3d(0xaf)+_0x4caefd[_0x204b3d(0xb8)]+':\x20'+_0x2abc23);throw new Error(_0x204b3d(0x9d)+_0x4caefd['status']+_0x204b3d(0xf1)+_0x2abc23);}let _0x4de8ec;try{_0x4de8ec=JSON[_0x204b3d(0xe6)](_0x2abc23);}catch(_0x1694d0){console[_0x204b3d(0xb6)](_0x204b3d(0xa9),_0x1694d0),loggerService_1['loggerService']['logWhiteDomainError'](_0x204b3d(0x7b),_0x204b3d(0x8b),_0x204b3d(0xdc)+_0x1694d0);throw new Error(_0x204b3d(0xd7)+_0x2abc23);}console[_0x204b3d(0xdf)](_0x204b3d(0xad)),console[_0x204b3d(0xdf)](_0x204b3d(0xe8),JSON['stringify'](_0x4de8ec,null,0x2)),loggerService_1[_0x204b3d(0x79)][_0x204b3d(0xe0)](_0x204b3d(0x7b),_0x204b3d(0x8b),_0x4caefd[_0x204b3d(0xb8)],_0x4de8ec,_0x7fb998);if(_0x4de8ec[_0x204b3d(0xb6)]){const _0x41d297=_0x4de8ec[_0x204b3d(0xe2)]||_0x4de8ec['error']||_0x204b3d(0x8f);console[_0x204b3d(0xb6)](_0x204b3d(0xe3)),console['error']('Error\x20Message:',_0x41d297),loggerService_1[_0x204b3d(0x79)]['logWhiteDomainError'](_0x204b3d(0x7b),'/create','Business\x20Error:\x20'+_0x41d297);throw new Error(_0x204b3d(0x6f)+_0x41d297);}if(!_0x4de8ec['payment_url']||!_0x4de8ec[_0x204b3d(0x9e)]){console['error'](_0x204b3d(0xbd)),console[_0x204b3d(0xb6)](_0x204b3d(0x6e)),console['error'](_0x204b3d(0x7e),_0x4de8ec),loggerService_1[_0x204b3d(0x79)]['logWhiteDomainError'](_0x204b3d(0x7b),'/create',_0x204b3d(0x85));throw new Error(_0x204b3d(0xd9));}return console['log'](_0x204b3d(0x72)),console['log'](_0x204b3d(0xa7),_0x4de8ec[_0x204b3d(0x9e)]),console[_0x204b3d(0xdf)](_0x204b3d(0x90),_0x4de8ec[_0x204b3d(0xcf)]),console['log'](_0x204b3d(0x89),_0xeb2028,_0x204b3d(0x9c)),{'gateway_payment_id':_0x4de8ec['gateway_payment_id'],'payment_url':_0x4de8ec[_0x204b3d(0xcf)]};}catch(_0x2a7d77){console[_0x204b3d(0xb6)](_0x204b3d(0xda)),console[_0x204b3d(0xb6)]('Error\x20details:',_0x2a7d77),loggerService_1[_0x204b3d(0x79)][_0x204b3d(0xa4)](_0x204b3d(0x7b),'/create',_0x2a7d77);if(_0x2a7d77 instanceof Error){console[_0x204b3d(0xb6)]('Error\x20message:',_0x2a7d77[_0x204b3d(0xe2)]),console['error'](_0x204b3d(0xbc),_0x2a7d77[_0x204b3d(0xe5)]);throw new Error(_0x204b3d(0xd3)+_0x2a7d77[_0x204b3d(0xe2)]);}throw new Error(_0x204b3d(0xab));}}async[a38_0x460c06(0xc4)](_0x55b094){const _0x51f8b5=a38_0x460c06,_0x1ced3f=Date['now']();try{console[_0x51f8b5(0xdf)](_0x51f8b5(0xe4)+_0x55b094);const _0x2108ed={'gatewayPaymentId':_0x55b094};loggerService_1[_0x51f8b5(0x79)][_0x51f8b5(0x82)](_0x51f8b5(0x7b),_0x51f8b5(0xee),'POST',_0x2108ed);const _0x20b8e7=await fetch(this[_0x51f8b5(0xa1)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x51f8b5(0x7d),'User-Agent':_0x51f8b5(0x99)},'body':JSON[_0x51f8b5(0xa5)](_0x2108ed)}),_0x12784b=Date[_0x51f8b5(0xce)]()-_0x1ced3f;console[_0x51f8b5(0xdf)](_0x51f8b5(0xb3)),console[_0x51f8b5(0xdf)](_0x51f8b5(0xde),_0x20b8e7[_0x51f8b5(0xb8)]),console[_0x51f8b5(0xdf)](_0x51f8b5(0xd1),_0x12784b+'ms');if(!_0x20b8e7['ok']){const _0xe4273f=await _0x20b8e7[_0x51f8b5(0x88)]();console[_0x51f8b5(0xb6)]('HTTP\x20Status:',_0x20b8e7[_0x51f8b5(0xb8)]),console[_0x51f8b5(0xb6)](_0x51f8b5(0xdb),_0xe4273f),loggerService_1[_0x51f8b5(0x79)][_0x51f8b5(0xe0)](_0x51f8b5(0x7b),_0x51f8b5(0xee),_0x20b8e7['status'],_0xe4273f,_0x12784b),loggerService_1[_0x51f8b5(0x79)][_0x51f8b5(0xa4)](_0x51f8b5(0x7b),_0x51f8b5(0xee),_0x51f8b5(0xaf)+_0x20b8e7[_0x51f8b5(0xb8)]+':\x20'+_0xe4273f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x20b8e7[_0x51f8b5(0xb8)]);}const _0x250ceb=await _0x20b8e7[_0x51f8b5(0x88)]();console[_0x51f8b5(0xdf)](_0x51f8b5(0x6c),_0x250ceb);let _0x39b5bf;try{_0x39b5bf=JSON[_0x51f8b5(0xe6)](_0x250ceb);}catch(_0x367224){console[_0x51f8b5(0xb6)](_0x51f8b5(0xa9),_0x367224),loggerService_1[_0x51f8b5(0x79)][_0x51f8b5(0xa4)]('cointopay',_0x51f8b5(0xee),_0x51f8b5(0xdc)+_0x367224);throw new Error(_0x51f8b5(0x8a)+_0x250ceb);}loggerService_1['loggerService'][_0x51f8b5(0xe0)](_0x51f8b5(0x7b),_0x51f8b5(0xee),_0x20b8e7[_0x51f8b5(0xb8)],_0x39b5bf,_0x12784b),console[_0x51f8b5(0xdf)](_0x51f8b5(0x95)),console[_0x51f8b5(0xdf)](_0x51f8b5(0xd8),_0x39b5bf[_0x51f8b5(0xa0)]),console[_0x51f8b5(0xdf)](_0x51f8b5(0x73),_0x39b5bf[_0x51f8b5(0x8e)]),console[_0x51f8b5(0xdf)](_0x51f8b5(0xc6),_0x39b5bf[_0x51f8b5(0x9a)]?.[_0x51f8b5(0xc2)]),console[_0x51f8b5(0xdf)](_0x51f8b5(0x89),_0x39b5bf[_0x51f8b5(0x9a)]?.[_0x51f8b5(0xe9)]),console[_0x51f8b5(0xdf)](_0x51f8b5(0x84),_0x39b5bf[_0x51f8b5(0x9a)]?.['inputCurrency']);if(_0x39b5bf[_0x51f8b5(0xa0)]!==_0x51f8b5(0xdd)||_0x39b5bf[_0x51f8b5(0x8e)]!==0xc8){const _0x59fee5=_0x39b5bf['message']||_0x51f8b5(0xbb);console[_0x51f8b5(0xb6)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x51f8b5(0xb6)](_0x51f8b5(0xb2),_0x59fee5),loggerService_1[_0x51f8b5(0x79)][_0x51f8b5(0xa4)]('cointopay',_0x51f8b5(0xee),'Status\x20API\x20Error:\x20'+_0x59fee5);throw new Error(_0x51f8b5(0x98)+_0x59fee5);}if(!_0x39b5bf[_0x51f8b5(0x9a)]){console[_0x51f8b5(0xb6)](_0x51f8b5(0x7f)),console[_0x51f8b5(0xb6)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x51f8b5(0x79)][_0x51f8b5(0xa4)]('cointopay',_0x51f8b5(0xee),_0x51f8b5(0x92));throw new Error(_0x51f8b5(0xb0));}let _0x2ed9cc=_0x51f8b5(0x80);switch(_0x39b5bf['data'][_0x51f8b5(0xc2)]?.[_0x51f8b5(0x9f)]()){case _0x51f8b5(0xc1):_0x2ed9cc='PAID';break;case _0x51f8b5(0x8d):case _0x51f8b5(0xa2):case _0x51f8b5(0xb6):_0x2ed9cc=_0x51f8b5(0xd0);break;case _0x51f8b5(0x8c):case'timeout':_0x2ed9cc='EXPIRED';break;case _0x51f8b5(0xac):case _0x51f8b5(0xb9):case _0x51f8b5(0xc3):case _0x51f8b5(0x77):default:_0x2ed9cc='PENDING';break;}let _0x208bbc,_0x539530;if(_0x39b5bf[_0x51f8b5(0x9a)]['PaymentDetail']){const _0x5ee9ea=_0x39b5bf[_0x51f8b5(0x9a)][_0x51f8b5(0x78)];console['log']('üè¶\x20Payment\x20Detail:',_0x5ee9ea);const _0x5876fc=_0x5ee9ea[_0x51f8b5(0x7c)](/IBAN\s+([A-Z0-9]+)/i);_0x5876fc&&(_0x208bbc=_0x5876fc[0x1],console[_0x51f8b5(0xdf)](_0x51f8b5(0x75),_0x208bbc)),_0x539530=_0x5ee9ea;}const _0x5b3c30={'iban':_0x208bbc,'bankDetails':_0x539530,'transactionId':_0x39b5bf['data'][_0x51f8b5(0xcb)],'coinAddress':_0x39b5bf[_0x51f8b5(0x9a)]['coinAddress'],'qrCodeUrl':_0x39b5bf['data']['QRCodeURL'],'expiryTime':_0x39b5bf[_0x51f8b5(0x9a)]['ExpiryTime'],'createdOn':_0x39b5bf[_0x51f8b5(0x9a)]['CreatedOn'],'confirmedOn':_0x39b5bf[_0x51f8b5(0x9a)]['TransactionConfirmedOn']};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x51f8b5(0xdf)]('Status:',_0x39b5bf[_0x51f8b5(0x9a)][_0x51f8b5(0xc2)],'->',_0x2ed9cc),console[_0x51f8b5(0xdf)](_0x51f8b5(0x89),_0x39b5bf['data'][_0x51f8b5(0xe9)],_0x39b5bf[_0x51f8b5(0x9a)]['inputCurrency']),console[_0x51f8b5(0xdf)](_0x51f8b5(0xc7),_0x39b5bf[_0x51f8b5(0x9a)][_0x51f8b5(0xcb)]),console[_0x51f8b5(0xdf)](_0x51f8b5(0xc9),_0x208bbc||_0x51f8b5(0x71)),console[_0x51f8b5(0xdf)](_0x51f8b5(0xf0),_0x39b5bf[_0x51f8b5(0x9a)][_0x51f8b5(0xeb)]),console[_0x51f8b5(0xdf)](_0x51f8b5(0x96),_0x39b5bf[_0x51f8b5(0x9a)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x39b5bf[_0x51f8b5(0x9a)][_0x51f8b5(0xc2)]?.[_0x51f8b5(0x9f)]()==='awaiting\x20fiat')console[_0x51f8b5(0xdf)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x39b5bf[_0x51f8b5(0x9a)][_0x51f8b5(0xc2)]?.[_0x51f8b5(0x9f)]()===_0x51f8b5(0xc1)&&console['log'](_0x51f8b5(0xd2));return{'status':_0x2ed9cc,'amount':parseFloat(_0x39b5bf[_0x51f8b5(0x9a)]['Amount'])||undefined,'currency':_0x39b5bf[_0x51f8b5(0x9a)]['inputCurrency']||_0x51f8b5(0x9c),'paymentDetails':_0x5b3c30};}catch(_0x5a3326){console[_0x51f8b5(0xb6)](_0x51f8b5(0xba),_0x5a3326),loggerService_1[_0x51f8b5(0x79)]['logWhiteDomainError'](_0x51f8b5(0x7b),_0x51f8b5(0xee),_0x5a3326);throw new Error(_0x51f8b5(0xe7)+(_0x5a3326 instanceof Error?_0x5a3326[_0x51f8b5(0xe2)]:_0x51f8b5(0x81)));}}async[a38_0x460c06(0xcc)](_0xd84f3){const _0x5caab3=a38_0x460c06,_0x33f0d9=await this[_0x5caab3(0xc4)](_0xd84f3);return{'status':_0x33f0d9[_0x5caab3(0xb8)],'amount':_0x33f0d9[_0x5caab3(0xd5)],'currency':_0x33f0d9['currency']};}async[a38_0x460c06(0x6d)](_0x4110dc){const _0x40a715=a38_0x460c06;console[_0x40a715(0xdf)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x4110dc);let _0x449f3f=_0x40a715(0x80);switch(_0x4110dc[_0x40a715(0xb8)]?.[_0x40a715(0x9f)]()){case'paid':_0x449f3f=_0x40a715(0xec);break;case _0x40a715(0x8d):case _0x40a715(0xa2):case _0x40a715(0xb6):_0x449f3f=_0x40a715(0xd0);break;case _0x40a715(0x8c):case _0x40a715(0x6b):_0x449f3f='EXPIRED';break;case _0x40a715(0xc3):case _0x40a715(0xac):case'awaiting\x20fiat':case _0x40a715(0x77):default:_0x449f3f=_0x40a715(0x80);break;}return{'paymentId':_0x4110dc['order_id']||_0x4110dc[_0x40a715(0xc5)]||'','status':_0x449f3f,'amount':_0x4110dc[_0x40a715(0xd5)],'currency':_0x4110dc['currency']||'EUR'};}}exports[a38_0x460c06(0x87)]=CoinToPayService;