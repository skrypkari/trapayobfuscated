'use strict';function a65_0x1c77(){const _0x324500=['logWhiteDomainResponse','CoinToPay\x20payment\x20status\x20check\x20error:','POST','Payment\x20Status:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','IBAN:','entries','headers','timeout','Unknown\x20error','merchant_reference_id','data','Response\x20data:','status_code','error','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','apiUrl','cointopay','4600175zloykY','Error\x20Message:','Request\x20Body:','EXPIRED','FAILED','URL:','Error\x20details:','Status:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','parse','2806216ujkhZW','Gateway\x20Payment\x20ID:','coinAddress','now','CoinToPay\x20status\x20API\x20error:\x20','Parsed\x20Result:','EUR','message','ðŸ¦\x20Extracted\x20IBAN:','fromEntries','21lbkPzL','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','../loggerService','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','paid','ðŸ¦\x20Payment\x20Detail:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status\x20Text:','QRCodeURL','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','logWhiteDomainError','Transaction\x20ID:','text','CreatedOn','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20','Result:','awaiting\x20fiat','gateway_payment_id','Payment\x20URL\x20(modified):','checkPaymentStatus','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Status\x20Code:','PENDING','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Headers:','result','amount','JSON\x20Parse\x20Error:\x20','PaymentDetail','7xfEkFQ','/create','Failed\x20to\x20parse\x20JSON\x20response:','TransactionConfirmedOn','804527DsSgUW','Error\x20stack:','logWhiteDomainRequest','defineProperty','stringify','__esModule','https://tesoft.uk/gateway/cointopay/status.php','match','===\x20COINTOPAY\x20API\x20ERROR\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Error\x20message:','waiting','Payment\x20System/1.0','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Response\x20Time:','application/json','ExpiryTime','/status','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','success','stack','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','\x20EUR','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','failed','Incomplete\x20response:\x20missing\x20data','processWebhook','verifyPayment','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','pending','statusText','statusUrl','currency','Response\x20Body:','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','order_id','inputCurrency','785484UpjqUF','cancelled','Raw\x20Response\x20Body:','expired','status','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','toLowerCase','log','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Payment\x20URL\x20(original):','CoinToPayService','Status','841242vDMpwz','Amount:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','307884yUypWv','16272450EAdCnB','TransactionID','Amount','Missing\x20data\x20in\x20response','PAID','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','created',',\x20body:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','HTTP\x20Status:','loggerService','payment_url'];a65_0x1c77=function(){return _0x324500;};return a65_0x1c77();}const a65_0x22f426=a65_0x481f;(function(_0x1c80ef,_0x46aee1){const _0x200d44=a65_0x481f,_0x517890=_0x1c80ef();while(!![]){try{const _0x5c1d30=-parseInt(_0x200d44(0x134))/0x1+parseInt(_0x200d44(0x15b))/0x2+parseInt(_0x200d44(0x111))/0x3*(parseInt(_0x200d44(0x16a))/0x4)+-parseInt(_0x200d44(0xfd))/0x5+-parseInt(_0x200d44(0x167))/0x6*(parseInt(_0x200d44(0x130))/0x7)+-parseInt(_0x200d44(0x107))/0x8+parseInt(_0x200d44(0x16b))/0x9;if(_0x5c1d30===_0x46aee1)break;else _0x517890['push'](_0x517890['shift']());}catch(_0x158d42){_0x517890['push'](_0x517890['shift']());}}}(a65_0x1c77,0x7ff0b));function a65_0x481f(_0x40674d,_0x45bef8){_0x40674d=_0x40674d-0xfa;const _0x1c7720=a65_0x1c77();let _0x481f9d=_0x1c7720[_0x40674d];return _0x481f9d;}Object[a65_0x22f426(0x137)](exports,a65_0x22f426(0x139),{'value':!![]}),exports[a65_0x22f426(0x165)]=void 0x0;const loggerService_1=require(a65_0x22f426(0x113));class CoinToPayService{constructor(){const _0x906d10=a65_0x22f426;this[_0x906d10(0xfb)]='https://tesoft.uk/gateway/cointopay/',this[_0x906d10(0x155)]=_0x906d10(0x13a),console[_0x906d10(0x162)](_0x906d10(0x115)),console[_0x906d10(0x162)]('ðŸ“Š\x20Status\x20check\x20URL:',this['statusUrl']);}async['createPaymentLink'](_0x4ce174){const _0x328f97=a65_0x22f426,{orderId:_0x3fe756,amount:_0x25e202}=_0x4ce174;console[_0x328f97(0x162)](_0x328f97(0x147)+_0x25e202+_0x328f97(0x14b));const _0x40a736={'amount':_0x25e202},_0x5f6c97=Date['now']();try{console[_0x328f97(0x162)](_0x328f97(0x170)),console['log'](_0x328f97(0x102),this[_0x328f97(0xfb)]),console[_0x328f97(0x162)](_0x328f97(0xff),JSON['stringify'](_0x40a736,null,0x2)),console[_0x328f97(0x162)](_0x328f97(0x168),_0x25e202,_0x328f97(0xfa)),loggerService_1[_0x328f97(0x175)][_0x328f97(0x136)](_0x328f97(0xfc),_0x328f97(0x131),_0x328f97(0x179),_0x40a736);const _0x556a67=await fetch(this[_0x328f97(0xfb)],{'method':_0x328f97(0x179),'headers':{'Content-Type':_0x328f97(0x143),'Accept':_0x328f97(0x143),'User-Agent':_0x328f97(0x140)},'body':JSON[_0x328f97(0x138)](_0x40a736)}),_0x3a06f2=Date[_0x328f97(0x10a)]()-_0x5f6c97;console['log'](_0x328f97(0x118)),console['log'](_0x328f97(0x104),_0x556a67[_0x328f97(0x15f)]),console[_0x328f97(0x162)](_0x328f97(0x119),_0x556a67[_0x328f97(0x154)]),console[_0x328f97(0x162)](_0x328f97(0x12b),Object[_0x328f97(0x110)](_0x556a67[_0x328f97(0x17e)][_0x328f97(0x17d)]())),console[_0x328f97(0x162)]('Response\x20Time:',_0x3a06f2+'ms');const _0x44fde1=await _0x556a67[_0x328f97(0x11e)]();console['log']('Raw\x20Response\x20Body:',_0x44fde1);if(!_0x556a67['ok']){console[_0x328f97(0x185)](_0x328f97(0x13c)),console['error']('HTTP\x20Status:',_0x556a67[_0x328f97(0x15f)]),console['error'](_0x328f97(0x157),_0x44fde1),loggerService_1[_0x328f97(0x175)]['logWhiteDomainResponse'](_0x328f97(0xfc),_0x328f97(0x131),_0x556a67['status'],_0x44fde1,_0x3a06f2),loggerService_1[_0x328f97(0x175)]['logWhiteDomainError'](_0x328f97(0xfc),_0x328f97(0x131),'HTTP\x20'+_0x556a67[_0x328f97(0x15f)]+':\x20'+_0x44fde1);throw new Error('HTTP\x20error!\x20status:\x20'+_0x556a67[_0x328f97(0x15f)]+_0x328f97(0x172)+_0x44fde1);}let _0x455c45;try{_0x455c45=JSON[_0x328f97(0x106)](_0x44fde1);}catch(_0x1dc77f){console[_0x328f97(0x185)](_0x328f97(0x132),_0x1dc77f),loggerService_1[_0x328f97(0x175)]['logWhiteDomainError']('cointopay',_0x328f97(0x131),_0x328f97(0x12e)+_0x1dc77f);throw new Error(_0x328f97(0x12a)+_0x44fde1);}console[_0x328f97(0x162)](_0x328f97(0x127)),console[_0x328f97(0x162)](_0x328f97(0x10c),JSON[_0x328f97(0x138)](_0x455c45,null,0x2)),loggerService_1[_0x328f97(0x175)]['logWhiteDomainResponse'](_0x328f97(0xfc),_0x328f97(0x131),_0x556a67['status'],_0x455c45,_0x3a06f2);if(_0x455c45[_0x328f97(0x185)]){const _0x4bb064=_0x455c45[_0x328f97(0x10e)]||_0x455c45['error']||_0x328f97(0x173);console['error']('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x4bb064),loggerService_1[_0x328f97(0x175)]['logWhiteDomainError']('cointopay',_0x328f97(0x131),'Business\x20Error:\x20'+_0x4bb064);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x4bb064);}if(!_0x455c45[_0x328f97(0x176)]||!_0x455c45['gateway_payment_id']){console[_0x328f97(0x185)](_0x328f97(0x120)),console['error'](_0x328f97(0x151)),console['error'](_0x328f97(0x183),_0x455c45),loggerService_1[_0x328f97(0x175)][_0x328f97(0x11c)]('cointopay','/create',_0x328f97(0x152));throw new Error(_0x328f97(0x163));}console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log'](_0x328f97(0x108),_0x455c45[_0x328f97(0x124)]),console[_0x328f97(0x162)](_0x328f97(0x164),_0x455c45[_0x328f97(0x176)]);const _0x2a1118=_0x455c45[_0x328f97(0x176)]+'&alternative=false';return console[_0x328f97(0x162)](_0x328f97(0x125),_0x2a1118),console[_0x328f97(0x162)]('Amount:',_0x25e202,_0x328f97(0x10d)),{'gateway_payment_id':_0x455c45[_0x328f97(0x124)],'payment_url':_0x2a1118};}catch(_0x5d609a){console[_0x328f97(0x185)](_0x328f97(0x17b)),console[_0x328f97(0x185)](_0x328f97(0x103),_0x5d609a),loggerService_1['loggerService'][_0x328f97(0x11c)]('cointopay',_0x328f97(0x131),_0x5d609a);if(_0x5d609a instanceof Error){console[_0x328f97(0x185)](_0x328f97(0x13e),_0x5d609a[_0x328f97(0x10e)]),console[_0x328f97(0x185)](_0x328f97(0x135),_0x5d609a[_0x328f97(0x149)]);throw new Error(_0x328f97(0x13d)+_0x5d609a[_0x328f97(0x10e)]);}throw new Error(_0x328f97(0x146));}}async[a65_0x22f426(0x126)](_0x289f63){const _0x549abf=a65_0x22f426,_0x3219aa=Date[_0x549abf(0x10a)]();try{console[_0x549abf(0x162)](_0x549abf(0x158)+_0x289f63);const _0x75f804={'gatewayPaymentId':_0x289f63};loggerService_1[_0x549abf(0x175)][_0x549abf(0x136)](_0x549abf(0xfc),_0x549abf(0x145),_0x549abf(0x179),_0x75f804);const _0x28ab0e=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x549abf(0x140)},'body':JSON[_0x549abf(0x138)](_0x75f804)}),_0x1a3cf4=Date[_0x549abf(0x10a)]()-_0x3219aa;console[_0x549abf(0x162)](_0x549abf(0x169)),console[_0x549abf(0x162)](_0x549abf(0x104),_0x28ab0e[_0x549abf(0x15f)]),console[_0x549abf(0x162)](_0x549abf(0x142),_0x1a3cf4+'ms');if(!_0x28ab0e['ok']){const _0x5c1b2b=await _0x28ab0e[_0x549abf(0x11e)]();console[_0x549abf(0x185)](_0x549abf(0x174),_0x28ab0e[_0x549abf(0x15f)]),console['error'](_0x549abf(0x157),_0x5c1b2b),loggerService_1[_0x549abf(0x175)]['logWhiteDomainResponse'](_0x549abf(0xfc),_0x549abf(0x145),_0x28ab0e[_0x549abf(0x15f)],_0x5c1b2b,_0x1a3cf4),loggerService_1[_0x549abf(0x175)][_0x549abf(0x11c)](_0x549abf(0xfc),_0x549abf(0x145),_0x549abf(0x121)+_0x28ab0e['status']+':\x20'+_0x5c1b2b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x28ab0e[_0x549abf(0x15f)]);}const _0x23437f=await _0x28ab0e['text']();console[_0x549abf(0x162)](_0x549abf(0x15d),_0x23437f);let _0x35ad50;try{_0x35ad50=JSON[_0x549abf(0x106)](_0x23437f);}catch(_0x253868){console[_0x549abf(0x185)](_0x549abf(0x132),_0x253868),loggerService_1[_0x549abf(0x175)]['logWhiteDomainError'](_0x549abf(0xfc),_0x549abf(0x145),'JSON\x20Parse\x20Error:\x20'+_0x253868);throw new Error(_0x549abf(0x105)+_0x23437f);}loggerService_1[_0x549abf(0x175)][_0x549abf(0x177)]('cointopay',_0x549abf(0x145),_0x28ab0e[_0x549abf(0x15f)],_0x35ad50,_0x1a3cf4),console[_0x549abf(0x162)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x549abf(0x162)](_0x549abf(0x122),_0x35ad50[_0x549abf(0x12c)]),console[_0x549abf(0x162)](_0x549abf(0x128),_0x35ad50[_0x549abf(0x184)]),console[_0x549abf(0x162)](_0x549abf(0x17a),_0x35ad50['data']?.['Status']),console[_0x549abf(0x162)](_0x549abf(0x168),_0x35ad50[_0x549abf(0x182)]?.['Amount']),console[_0x549abf(0x162)]('Currency:',_0x35ad50['data']?.[_0x549abf(0x15a)]);if(_0x35ad50['result']!==_0x549abf(0x148)||_0x35ad50[_0x549abf(0x184)]!==0xc8){const _0x15ac16=_0x35ad50['message']||_0x549abf(0x11b);console[_0x549abf(0x185)](_0x549abf(0x14c)),console[_0x549abf(0x185)](_0x549abf(0xfe),_0x15ac16),loggerService_1[_0x549abf(0x175)]['logWhiteDomainError'](_0x549abf(0xfc),_0x549abf(0x145),'Status\x20API\x20Error:\x20'+_0x15ac16);throw new Error(_0x549abf(0x10b)+_0x15ac16);}if(!_0x35ad50[_0x549abf(0x182)]){console[_0x549abf(0x185)](_0x549abf(0x112)),console[_0x549abf(0x185)](_0x549abf(0x16e)),loggerService_1[_0x549abf(0x175)]['logWhiteDomainError']('cointopay',_0x549abf(0x145),_0x549abf(0x14e));throw new Error(_0x549abf(0x14a));}let _0x14594c=_0x549abf(0x129);switch(_0x35ad50[_0x549abf(0x182)]['Status']?.[_0x549abf(0x161)]()){case _0x549abf(0x116):_0x14594c=_0x549abf(0x16f);break;case _0x549abf(0x15c):case'failed':case'error':_0x14594c=_0x549abf(0x101);break;case'expired':case _0x549abf(0x17f):_0x14594c=_0x549abf(0x100);break;case'waiting':case'awaiting\x20fiat':case'pending':case _0x549abf(0x171):default:_0x14594c=_0x549abf(0x129);break;}let _0x40d8c1,_0x2a20d6;if(_0x35ad50[_0x549abf(0x182)][_0x549abf(0x12f)]){const _0x7c0c87=_0x35ad50[_0x549abf(0x182)]['PaymentDetail'];console['log'](_0x549abf(0x117),_0x7c0c87);const _0x255b00=_0x7c0c87[_0x549abf(0x13b)](/IBAN\s+([A-Z0-9]+)/i);_0x255b00&&(_0x40d8c1=_0x255b00[0x1],console['log'](_0x549abf(0x10f),_0x40d8c1)),_0x2a20d6=_0x7c0c87;}const _0x2dfade={'iban':_0x40d8c1,'bankDetails':_0x2a20d6,'transactionId':_0x35ad50[_0x549abf(0x182)][_0x549abf(0x16c)],'coinAddress':_0x35ad50[_0x549abf(0x182)][_0x549abf(0x109)],'qrCodeUrl':_0x35ad50[_0x549abf(0x182)][_0x549abf(0x11a)],'expiryTime':_0x35ad50['data'][_0x549abf(0x144)],'createdOn':_0x35ad50[_0x549abf(0x182)][_0x549abf(0x11f)],'confirmedOn':_0x35ad50[_0x549abf(0x182)][_0x549abf(0x133)]};console[_0x549abf(0x162)](_0x549abf(0x141)),console[_0x549abf(0x162)](_0x549abf(0x104),_0x35ad50[_0x549abf(0x182)]['Status'],'->',_0x14594c),console[_0x549abf(0x162)]('Amount:',_0x35ad50['data'][_0x549abf(0x16d)],_0x35ad50[_0x549abf(0x182)]['inputCurrency']),console[_0x549abf(0x162)](_0x549abf(0x11d),_0x35ad50[_0x549abf(0x182)]['TransactionID']),console[_0x549abf(0x162)](_0x549abf(0x17c),_0x40d8c1||'not\x20found'),console[_0x549abf(0x162)]('Created\x20On:',_0x35ad50['data'][_0x549abf(0x11f)]),console[_0x549abf(0x162)]('Confirmed\x20On:',_0x35ad50['data'][_0x549abf(0x133)]||'not\x20confirmed');if(_0x35ad50[_0x549abf(0x182)][_0x549abf(0x166)]?.[_0x549abf(0x161)]()===_0x549abf(0x123))console['log'](_0x549abf(0x160));else _0x35ad50[_0x549abf(0x182)][_0x549abf(0x166)]?.['toLowerCase']()===_0x549abf(0x116)&&console[_0x549abf(0x162)]('âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x14594c,'amount':parseFloat(_0x35ad50['data'][_0x549abf(0x16d)])||undefined,'currency':_0x35ad50['data'][_0x549abf(0x15a)]||'EUR','paymentDetails':_0x2dfade};}catch(_0xadea67){console['error'](_0x549abf(0x178),_0xadea67),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x549abf(0x145),_0xadea67);throw new Error(_0x549abf(0x114)+(_0xadea67 instanceof Error?_0xadea67[_0x549abf(0x10e)]:_0x549abf(0x180)));}}async[a65_0x22f426(0x150)](_0x51f0b3){const _0x1a0533=a65_0x22f426,_0x4d4672=await this[_0x1a0533(0x126)](_0x51f0b3);return{'status':_0x4d4672[_0x1a0533(0x15f)],'amount':_0x4d4672['amount'],'currency':_0x4d4672[_0x1a0533(0x156)]};}async[a65_0x22f426(0x14f)](_0x37bc3a){const _0x541148=a65_0x22f426;console[_0x541148(0x162)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x37bc3a);let _0x4073fc=_0x541148(0x129);switch(_0x37bc3a[_0x541148(0x15f)]?.[_0x541148(0x161)]()){case _0x541148(0x116):_0x4073fc=_0x541148(0x16f);break;case'cancelled':case _0x541148(0x14d):case _0x541148(0x185):_0x4073fc=_0x541148(0x101);break;case _0x541148(0x15e):case _0x541148(0x17f):_0x4073fc='EXPIRED';break;case _0x541148(0x153):case _0x541148(0x13f):case _0x541148(0x123):case _0x541148(0x171):default:_0x4073fc=_0x541148(0x129);break;}return{'paymentId':_0x37bc3a[_0x541148(0x159)]||_0x37bc3a[_0x541148(0x181)]||'','status':_0x4073fc,'amount':_0x37bc3a[_0x541148(0x12d)],'currency':_0x37bc3a[_0x541148(0x156)]||_0x541148(0x10d)};}}exports[a65_0x22f426(0x165)]=CoinToPayService;