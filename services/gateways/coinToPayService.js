'use strict';const a40_0x423529=a40_0x29f7;(function(_0x38cd9d,_0x34ca3c){const _0x39ec0f=a40_0x29f7,_0x512003=_0x38cd9d();while(!![]){try{const _0x27ee56=-parseInt(_0x39ec0f(0x101))/0x1+parseInt(_0x39ec0f(0xd0))/0x2+-parseInt(_0x39ec0f(0x111))/0x3*(-parseInt(_0x39ec0f(0x106))/0x4)+parseInt(_0x39ec0f(0xa3))/0x5+parseInt(_0x39ec0f(0xb2))/0x6*(parseInt(_0x39ec0f(0xc6))/0x7)+parseInt(_0x39ec0f(0x102))/0x8+-parseInt(_0x39ec0f(0x94))/0x9*(parseInt(_0x39ec0f(0x90))/0xa);if(_0x27ee56===_0x34ca3c)break;else _0x512003['push'](_0x512003['shift']());}catch(_0x1ef0ae){_0x512003['push'](_0x512003['shift']());}}}(a40_0x28df,0x5951d));Object['defineProperty'](exports,a40_0x423529(0xbe),{'value':!![]}),exports[a40_0x423529(0xe5)]=void 0x0;const loggerService_1=require(a40_0x423529(0xcb));function a40_0x28df(){const _0x20e325=['===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20stack:','headers','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','apiUrl','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','status','cointopay','CoinToPayService','statusUrl','waiting','üè¶\x20Extracted\x20IBAN:','stringify','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','match','amount','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','loggerService','Payment\x20URL:','Unknown\x20error','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Transaction\x20ID:','/create','PENDING','Payment\x20Status:','order_id','Raw\x20Response\x20Body:','Missing\x20data\x20in\x20response','toLowerCase','Status\x20Code:','CoinToPay\x20payment\x20status\x20check\x20error:','log','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','cancelled','Business\x20Error:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','13571enYvdP','4701456qcQgMz','timeout','Result:','Error\x20Message:','1096hhhZKW','logWhiteDomainError','gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','IBAN:','Unknown\x20error\x20from\x20CoinToPay\x20API','status_code','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','https://tesoft.uk/gateway/cointopay/','Incomplete\x20response:\x20missing\x20data','not\x20confirmed','4776rfIYEA','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','text','JSON\x20Parse\x20Error:\x20','EXPIRED','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','entries','merchant_reference_id','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Headers:','===\x20COINTOPAY\x20API\x20ERROR\x20===','statusText','awaiting\x20fiat','TransactionID','5090VydFXQ','===\x20COINTOPAY\x20SUCCESS\x20===','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Status','26982TFRzFY','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Response\x20Body:','expired','processWebhook','created','message','ExpiryTime','Gateway\x20Payment\x20ID:','failed','error','/status','logWhiteDomainResponse','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Error\x20details:','407420MPSbeR','application/json','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Request\x20Body:','QRCodeURL','FAILED','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','üìä\x20Status\x20check\x20URL:','Status\x20Text:','HTTP\x20','TesSoft\x20Payment\x20System/1.0','CoinToPay\x20status\x20API\x20error:\x20','TransactionConfirmedOn','inputCurrency','URL:','185202tQtiQd','paid','pending','HTTP\x20Status:','Response\x20data:','üè¶\x20Payment\x20Detail:','now','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','POST','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','CoinToPay\x20API\x20error:\x20','__esModule','Currency:','EUR','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Amount','Status:','CreatedOn','data','91eAcDBM','https://tesoft.uk/gateway/cointopay/status.php','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','parse','Amount:','../loggerService','logWhiteDomainRequest','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','result','fromEntries','797522GfRmNI','Status\x20API\x20Error:\x20','currency','Confirmed\x20On:','Error\x20message:','HTTP\x20error!\x20status:\x20','checkPaymentStatus','success','payment_url','PAID','\x20EUR','Response\x20Time:'];a40_0x28df=function(){return _0x20e325;};return a40_0x28df();}class CoinToPayService{constructor(){const _0x3571a9=a40_0x423529;this['apiUrl']=_0x3571a9(0x10e),this['statusUrl']=_0x3571a9(0xc7),console[_0x3571a9(0xfc)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log'](_0x3571a9(0xaa),this[_0x3571a9(0xe6)]);}async['createPaymentLink'](_0x4cea87){const _0x20fd54=a40_0x423529,{orderId:_0x2465ed,amount:_0x56df90}=_0x4cea87;console['log'](_0x20fd54(0xb9)+_0x56df90+_0x20fd54(0xda));const _0x243b4e={'amount':_0x56df90},_0x5d8def=Date['now']();try{console['log'](_0x20fd54(0xe2)),console[_0x20fd54(0xfc)](_0x20fd54(0xb1),this[_0x20fd54(0xe1)]),console[_0x20fd54(0xfc)](_0x20fd54(0xa6),JSON[_0x20fd54(0xe9)](_0x243b4e,null,0x2)),console[_0x20fd54(0xfc)](_0x20fd54(0xca),_0x56df90,_0x20fd54(0x8a)),loggerService_1[_0x20fd54(0xee)][_0x20fd54(0xcc)](_0x20fd54(0xe4),_0x20fd54(0xf3),'POST',_0x243b4e);const _0x54cb57=await fetch(this[_0x20fd54(0xe1)],{'method':'POST','headers':{'Content-Type':_0x20fd54(0xa4),'Accept':_0x20fd54(0xa4),'User-Agent':_0x20fd54(0xad)},'body':JSON[_0x20fd54(0xe9)](_0x243b4e)}),_0x2259db=Date[_0x20fd54(0xb8)]()-_0x5d8def;console['log'](_0x20fd54(0xdc)),console['log'](_0x20fd54(0xc3),_0x54cb57[_0x20fd54(0xe3)]),console['log'](_0x20fd54(0xab),_0x54cb57[_0x20fd54(0x8d)]),console['log'](_0x20fd54(0x8b),Object[_0x20fd54(0xcf)](_0x54cb57[_0x20fd54(0xde)][_0x20fd54(0x117)]())),console['log'](_0x20fd54(0xdb),_0x2259db+'ms');const _0x48bb0c=await _0x54cb57['text']();console['log'](_0x20fd54(0xf7),_0x48bb0c);if(!_0x54cb57['ok']){console['error'](_0x20fd54(0x8c)),console[_0x20fd54(0x9e)](_0x20fd54(0xb5),_0x54cb57[_0x20fd54(0xe3)]),console[_0x20fd54(0x9e)]('Response\x20Body:',_0x48bb0c),loggerService_1[_0x20fd54(0xee)][_0x20fd54(0xa0)](_0x20fd54(0xe4),_0x20fd54(0xf3),_0x54cb57[_0x20fd54(0xe3)],_0x48bb0c,_0x2259db),loggerService_1[_0x20fd54(0xee)][_0x20fd54(0x107)](_0x20fd54(0xe4),_0x20fd54(0xf3),'HTTP\x20'+_0x54cb57['status']+':\x20'+_0x48bb0c);throw new Error(_0x20fd54(0xd5)+_0x54cb57[_0x20fd54(0xe3)]+',\x20body:\x20'+_0x48bb0c);}let _0x2d1ec9;try{_0x2d1ec9=JSON[_0x20fd54(0xc9)](_0x48bb0c);}catch(_0x5d2b95){console[_0x20fd54(0x9e)](_0x20fd54(0xbb),_0x5d2b95),loggerService_1['loggerService']['logWhiteDomainError'](_0x20fd54(0xe4),_0x20fd54(0xf3),_0x20fd54(0x114)+_0x5d2b95);throw new Error(_0x20fd54(0x112)+_0x48bb0c);}console[_0x20fd54(0xfc)](_0x20fd54(0xfd)),console['log']('Parsed\x20Result:',JSON[_0x20fd54(0xe9)](_0x2d1ec9,null,0x2)),loggerService_1[_0x20fd54(0xee)][_0x20fd54(0xa0)]('cointopay',_0x20fd54(0xf3),_0x54cb57['status'],_0x2d1ec9,_0x2259db);if(_0x2d1ec9[_0x20fd54(0x9e)]){const _0x5c9660=_0x2d1ec9[_0x20fd54(0x9a)]||_0x2d1ec9[_0x20fd54(0x9e)]||_0x20fd54(0x10b);console[_0x20fd54(0x9e)](_0x20fd54(0x100)),console['error'](_0x20fd54(0x105),_0x5c9660),loggerService_1[_0x20fd54(0xee)][_0x20fd54(0x107)](_0x20fd54(0xe4),'/create',_0x20fd54(0xff)+_0x5c9660);throw new Error(_0x20fd54(0xbd)+_0x5c9660);}if(!_0x2d1ec9['payment_url']||!_0x2d1ec9[_0x20fd54(0x108)]){console[_0x20fd54(0x9e)](_0x20fd54(0xf1)),console[_0x20fd54(0x9e)](_0x20fd54(0x116)),console['error'](_0x20fd54(0xb6),_0x2d1ec9),loggerService_1['loggerService'][_0x20fd54(0x107)](_0x20fd54(0xe4),_0x20fd54(0xf3),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x20fd54(0xcd));}return console[_0x20fd54(0xfc)](_0x20fd54(0x91)),console[_0x20fd54(0xfc)](_0x20fd54(0x9c),_0x2d1ec9[_0x20fd54(0x108)]),console[_0x20fd54(0xfc)](_0x20fd54(0xef),_0x2d1ec9[_0x20fd54(0xd8)]),console[_0x20fd54(0xfc)](_0x20fd54(0xca),_0x56df90,'EUR'),{'gateway_payment_id':_0x2d1ec9[_0x20fd54(0x108)],'payment_url':_0x2d1ec9[_0x20fd54(0xd8)]};}catch(_0x10395c){console[_0x20fd54(0x9e)](_0x20fd54(0xe0)),console[_0x20fd54(0x9e)](_0x20fd54(0xa2),_0x10395c),loggerService_1[_0x20fd54(0xee)][_0x20fd54(0x107)]('cointopay',_0x20fd54(0xf3),_0x10395c);if(_0x10395c instanceof Error){console[_0x20fd54(0x9e)](_0x20fd54(0xd4),_0x10395c[_0x20fd54(0x9a)]),console[_0x20fd54(0x9e)](_0x20fd54(0xdd),_0x10395c['stack']);throw new Error(_0x20fd54(0xea)+_0x10395c['message']);}throw new Error(_0x20fd54(0xbc));}}async[a40_0x423529(0xd6)](_0x36461d){const _0x1a4373=a40_0x423529,_0x3d9585=Date['now']();try{console[_0x1a4373(0xfc)](_0x1a4373(0x92)+_0x36461d);const _0x4ec471={'gatewayPaymentId':_0x36461d};loggerService_1[_0x1a4373(0xee)][_0x1a4373(0xcc)](_0x1a4373(0xe4),'/status',_0x1a4373(0xba),_0x4ec471);const _0x17eec7=await fetch(this[_0x1a4373(0xe6)],{'method':_0x1a4373(0xba),'headers':{'Content-Type':'application/json','Accept':_0x1a4373(0xa4),'User-Agent':_0x1a4373(0xad)},'body':JSON['stringify'](_0x4ec471)}),_0x4ced4b=Date['now']()-_0x3d9585;console['log'](_0x1a4373(0xc1)),console[_0x1a4373(0xfc)](_0x1a4373(0xc3),_0x17eec7[_0x1a4373(0xe3)]),console[_0x1a4373(0xfc)](_0x1a4373(0xdb),_0x4ced4b+'ms');if(!_0x17eec7['ok']){const _0x18059f=await _0x17eec7[_0x1a4373(0x113)]();console['error']('HTTP\x20Status:',_0x17eec7['status']),console[_0x1a4373(0x9e)](_0x1a4373(0x96),_0x18059f),loggerService_1[_0x1a4373(0xee)][_0x1a4373(0xa0)]('cointopay',_0x1a4373(0x9f),_0x17eec7[_0x1a4373(0xe3)],_0x18059f,_0x4ced4b),loggerService_1[_0x1a4373(0xee)][_0x1a4373(0x107)](_0x1a4373(0xe4),_0x1a4373(0x9f),_0x1a4373(0xac)+_0x17eec7['status']+':\x20'+_0x18059f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x17eec7[_0x1a4373(0xe3)]);}const _0x3cef4d=await _0x17eec7[_0x1a4373(0x113)]();console['log']('Raw\x20Response\x20Body:',_0x3cef4d);let _0x4494bc;try{_0x4494bc=JSON[_0x1a4373(0xc9)](_0x3cef4d);}catch(_0x58e249){console[_0x1a4373(0x9e)](_0x1a4373(0xbb),_0x58e249),loggerService_1[_0x1a4373(0xee)][_0x1a4373(0x107)](_0x1a4373(0xe4),'/status',_0x1a4373(0x114)+_0x58e249);throw new Error(_0x1a4373(0xa1)+_0x3cef4d);}loggerService_1[_0x1a4373(0xee)][_0x1a4373(0xa0)](_0x1a4373(0xe4),_0x1a4373(0x9f),_0x17eec7[_0x1a4373(0xe3)],_0x4494bc,_0x4ced4b),console['log'](_0x1a4373(0xa9)),console[_0x1a4373(0xfc)](_0x1a4373(0x104),_0x4494bc[_0x1a4373(0xce)]),console[_0x1a4373(0xfc)](_0x1a4373(0xfa),_0x4494bc[_0x1a4373(0x10c)]),console[_0x1a4373(0xfc)](_0x1a4373(0xf5),_0x4494bc[_0x1a4373(0xc5)]?.[_0x1a4373(0x93)]),console[_0x1a4373(0xfc)](_0x1a4373(0xca),_0x4494bc['data']?.['Amount']),console[_0x1a4373(0xfc)](_0x1a4373(0xbf),_0x4494bc['data']?.['inputCurrency']);if(_0x4494bc[_0x1a4373(0xce)]!==_0x1a4373(0xd7)||_0x4494bc['status_code']!==0xc8){const _0x3e468f=_0x4494bc[_0x1a4373(0x9a)]||_0x1a4373(0xdf);console['error'](_0x1a4373(0x109)),console[_0x1a4373(0x9e)](_0x1a4373(0x105),_0x3e468f),loggerService_1[_0x1a4373(0xee)]['logWhiteDomainError'](_0x1a4373(0xe4),_0x1a4373(0x9f),_0x1a4373(0xd1)+_0x3e468f);throw new Error(_0x1a4373(0xae)+_0x3e468f);}if(!_0x4494bc[_0x1a4373(0xc5)]){console['error'](_0x1a4373(0xed)),console[_0x1a4373(0x9e)](_0x1a4373(0xf8)),loggerService_1[_0x1a4373(0xee)][_0x1a4373(0x107)](_0x1a4373(0xe4),_0x1a4373(0x9f),_0x1a4373(0x10f));throw new Error(_0x1a4373(0xc8));}let _0x451bb8=_0x1a4373(0xf4);switch(_0x4494bc[_0x1a4373(0xc5)][_0x1a4373(0x93)]?.[_0x1a4373(0xf9)]()){case _0x1a4373(0xb3):_0x451bb8=_0x1a4373(0xd9);break;case _0x1a4373(0xfe):case _0x1a4373(0x9d):case'error':_0x451bb8=_0x1a4373(0xa8);break;case _0x1a4373(0x97):case _0x1a4373(0x103):_0x451bb8=_0x1a4373(0x115);break;case _0x1a4373(0xe7):case'awaiting\x20fiat':case _0x1a4373(0xb4):case _0x1a4373(0x99):default:_0x451bb8=_0x1a4373(0xf4);break;}let _0x352b34,_0x4786ca;if(_0x4494bc[_0x1a4373(0xc5)]['PaymentDetail']){const _0x2816c5=_0x4494bc['data']['PaymentDetail'];console[_0x1a4373(0xfc)](_0x1a4373(0xb7),_0x2816c5);const _0x5ef1f9=_0x2816c5[_0x1a4373(0xeb)](/IBAN\s+([A-Z0-9]+)/i);_0x5ef1f9&&(_0x352b34=_0x5ef1f9[0x1],console[_0x1a4373(0xfc)](_0x1a4373(0xe8),_0x352b34)),_0x4786ca=_0x2816c5;}const _0x438e9b={'iban':_0x352b34,'bankDetails':_0x4786ca,'transactionId':_0x4494bc['data']['TransactionID'],'coinAddress':_0x4494bc[_0x1a4373(0xc5)]['coinAddress'],'qrCodeUrl':_0x4494bc['data'][_0x1a4373(0xa7)],'expiryTime':_0x4494bc['data'][_0x1a4373(0x9b)],'createdOn':_0x4494bc[_0x1a4373(0xc5)][_0x1a4373(0xc4)],'confirmedOn':_0x4494bc[_0x1a4373(0xc5)][_0x1a4373(0xaf)]};console['log'](_0x1a4373(0x10d)),console['log']('Status:',_0x4494bc['data']['Status'],'->',_0x451bb8),console[_0x1a4373(0xfc)]('Amount:',_0x4494bc[_0x1a4373(0xc5)]['Amount'],_0x4494bc['data'][_0x1a4373(0xb0)]),console[_0x1a4373(0xfc)](_0x1a4373(0xf2),_0x4494bc[_0x1a4373(0xc5)][_0x1a4373(0x8f)]),console['log'](_0x1a4373(0x10a),_0x352b34||'not\x20found'),console['log']('Created\x20On:',_0x4494bc[_0x1a4373(0xc5)][_0x1a4373(0xc4)]),console[_0x1a4373(0xfc)](_0x1a4373(0xd3),_0x4494bc[_0x1a4373(0xc5)][_0x1a4373(0xaf)]||_0x1a4373(0x110));if(_0x4494bc[_0x1a4373(0xc5)][_0x1a4373(0x93)]?.[_0x1a4373(0xf9)]()==='awaiting\x20fiat')console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x4494bc['data'][_0x1a4373(0x93)]?.['toLowerCase']()===_0x1a4373(0xb3)&&console[_0x1a4373(0xfc)](_0x1a4373(0x95));return{'status':_0x451bb8,'amount':parseFloat(_0x4494bc[_0x1a4373(0xc5)][_0x1a4373(0xc2)])||undefined,'currency':_0x4494bc[_0x1a4373(0xc5)][_0x1a4373(0xb0)]||'EUR','paymentDetails':_0x438e9b};}catch(_0x117530){console[_0x1a4373(0x9e)](_0x1a4373(0xfb),_0x117530),loggerService_1[_0x1a4373(0xee)][_0x1a4373(0x107)](_0x1a4373(0xe4),_0x1a4373(0x9f),_0x117530);throw new Error(_0x1a4373(0xa5)+(_0x117530 instanceof Error?_0x117530[_0x1a4373(0x9a)]:_0x1a4373(0xf0)));}}async['verifyPayment'](_0x51e3bc){const _0x4582a1=a40_0x423529,_0x5829d8=await this[_0x4582a1(0xd6)](_0x51e3bc);return{'status':_0x5829d8[_0x4582a1(0xe3)],'amount':_0x5829d8[_0x4582a1(0xec)],'currency':_0x5829d8[_0x4582a1(0xd2)]};}async[a40_0x423529(0x98)](_0x81c6f8){const _0x35d4a0=a40_0x423529;console[_0x35d4a0(0xfc)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x81c6f8);let _0x49aff9=_0x35d4a0(0xf4);switch(_0x81c6f8['status']?.[_0x35d4a0(0xf9)]()){case _0x35d4a0(0xb3):_0x49aff9=_0x35d4a0(0xd9);break;case _0x35d4a0(0xfe):case _0x35d4a0(0x9d):case _0x35d4a0(0x9e):_0x49aff9=_0x35d4a0(0xa8);break;case'expired':case'timeout':_0x49aff9='EXPIRED';break;case _0x35d4a0(0xb4):case _0x35d4a0(0xe7):case _0x35d4a0(0x8e):case _0x35d4a0(0x99):default:_0x49aff9=_0x35d4a0(0xf4);break;}return{'paymentId':_0x81c6f8[_0x35d4a0(0xf6)]||_0x81c6f8[_0x35d4a0(0x118)]||'','status':_0x49aff9,'amount':_0x81c6f8['amount'],'currency':_0x81c6f8['currency']||_0x35d4a0(0xc0)};}}function a40_0x29f7(_0x19e68f,_0x3b8ce0){const _0x28df01=a40_0x28df();return a40_0x29f7=function(_0x29f705,_0x600783){_0x29f705=_0x29f705-0x8a;let _0x49a219=_0x28df01[_0x29f705];return _0x49a219;},a40_0x29f7(_0x19e68f,_0x3b8ce0);}exports['CoinToPayService']=CoinToPayService;