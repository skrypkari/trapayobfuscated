'use strict';function a40_0x4b5d(){const _0x24a422=['/create','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Response\x20Time:','Missing\x20data\x20in\x20response','PAID','FAILED','application/json','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','EXPIRED','status','TesSoft\x20Payment\x20System/1.0','Payment\x20Status:','https://tesoft.uk/gateway/cointopay/','Payment\x20URL:','Status\x20Code:','Error\x20details:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','HTTP\x20','parse','statusText','processWebhook','statusUrl','Created\x20On:','1915pQZtYe','result','order_id','üè¶\x20Extracted\x20IBAN:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','üìä\x20Status\x20check\x20URL:','EUR','stringify','TransactionID','TransactionConfirmedOn','124548nmfEsc','not\x20found','pending','stack','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','status_code','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','CoinToPay\x20API\x20error:\x20','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','failed','paid','cointopay','inputCurrency','1925550shqfcu','entries','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','match','/status','Response\x20data:','JSON\x20Parse\x20Error:\x20','Confirmed\x20On:','Status','HTTP\x20error!\x20status:\x20','üè¶\x20Payment\x20Detail:','CreatedOn','3159pklYeu','logWhiteDomainResponse','createPaymentLink','message','expired','Raw\x20Response\x20Body:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','now','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','218eizOcl','log','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','7464toUwib','CoinToPay\x20payment\x20status\x20check\x20error:','payment_url','Unknown\x20error\x20from\x20CoinToPay\x20API','logWhiteDomainRequest','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','waiting','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','../loggerService','Amount','Status\x20API\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Amount:','POST','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','4871372TKcGbJ','Response\x20Body:','6vhStxO','HTTP\x20Status:','__esModule','IBAN:','checkPaymentStatus','Transaction\x20ID:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','apiUrl','ExpiryTime','logWhiteDomainError','Failed\x20to\x20parse\x20JSON\x20response:','awaiting\x20fiat','loggerService','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','https://tesoft.uk/gateway/cointopay/status.php','QRCodeURL','text','Status:','PENDING','Error\x20message:','2205854TqMaUF','===\x20COINTOPAY\x20API\x20ERROR\x20===','merchant_reference_id','coinAddress','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','error','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','PaymentDetail','===\x20COINTOPAY\x20SUCCESS\x20===','fromEntries','CoinToPayService','Result:','Gateway\x20Payment\x20ID:','data','Parsed\x20Result:','gateway_payment_id','Headers:','defineProperty','Error\x20Message:','80umPSrM','cancelled','created','613948wEHjIY','toLowerCase','amount','not\x20confirmed'];a40_0x4b5d=function(){return _0x24a422;};return a40_0x4b5d();}const a40_0x2eecc7=a40_0x2cd9;(function(_0x42dd43,_0x33ab23){const _0x990efe=a40_0x2cd9,_0x37b8a3=_0x42dd43();while(!![]){try{const _0x3c4eed=parseInt(_0x990efe(0x175))/0x1*(parseInt(_0x990efe(0x1a1))/0x2)+parseInt(_0x990efe(0x1b5))/0x3*(parseInt(_0x990efe(0x15a))/0x4)+parseInt(_0x990efe(0x157))/0x5*(parseInt(_0x990efe(0x17f))/0x6)+parseInt(_0x990efe(0x1c9))/0x7+parseInt(_0x990efe(0x1a4))/0x8*(-parseInt(_0x990efe(0x198))/0x9)+-parseInt(_0x990efe(0x18c))/0xa+-parseInt(_0x990efe(0x1b3))/0xb;if(_0x3c4eed===_0x33ab23)break;else _0x37b8a3['push'](_0x37b8a3['shift']());}catch(_0x34c66c){_0x37b8a3['push'](_0x37b8a3['shift']());}}}(a40_0x4b5d,0x30d85));Object[a40_0x2eecc7(0x155)](exports,a40_0x2eecc7(0x1b7),{'value':!![]}),exports[a40_0x2eecc7(0x1d4)]=void 0x0;function a40_0x2cd9(_0x5eea84,_0x172f3a){const _0x4b5ded=a40_0x4b5d();return a40_0x2cd9=function(_0x2cd921,_0x36854d){_0x2cd921=_0x2cd921-0x153;let _0x160f1c=_0x4b5ded[_0x2cd921];return _0x160f1c;},a40_0x2cd9(_0x5eea84,_0x172f3a);}const loggerService_1=require(a40_0x2eecc7(0x1ac));class CoinToPayService{constructor(){const _0x39cbaf=a40_0x2eecc7;this[_0x39cbaf(0x1bc)]=_0x39cbaf(0x16a),this[_0x39cbaf(0x173)]=_0x39cbaf(0x1c3),console[_0x39cbaf(0x1a2)](_0x39cbaf(0x19e)),console[_0x39cbaf(0x1a2)](_0x39cbaf(0x17a),this[_0x39cbaf(0x173)]);}async[a40_0x2eecc7(0x19a)](_0x5bad7a){const _0x234659=a40_0x2eecc7,{orderId:_0x531ceb,amount:_0x31c410}=_0x5bad7a;console[_0x234659(0x1a2)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x31c410+'\x20EUR');const _0x4c469e={'amount':_0x31c410},_0x4f8416=Date[_0x234659(0x19f)]();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x234659(0x1a2)]('URL:',this[_0x234659(0x1bc)]),console['log']('Request\x20Body:',JSON[_0x234659(0x17c)](_0x4c469e,null,0x2)),console[_0x234659(0x1a2)](_0x234659(0x1b0),_0x31c410,_0x234659(0x16e)),loggerService_1[_0x234659(0x1c1)][_0x234659(0x1a8)](_0x234659(0x18a),_0x234659(0x15e),_0x234659(0x1b1),_0x4c469e);const _0xe852d1=await fetch(this[_0x234659(0x1bc)],{'method':_0x234659(0x1b1),'headers':{'Content-Type':_0x234659(0x164),'Accept':'application/json','User-Agent':_0x234659(0x168)},'body':JSON[_0x234659(0x17c)](_0x4c469e)}),_0x18959c=Date['now']()-_0x4f8416;console[_0x234659(0x1a2)](_0x234659(0x1a3)),console[_0x234659(0x1a2)](_0x234659(0x1c6),_0xe852d1[_0x234659(0x167)]),console[_0x234659(0x1a2)]('Status\x20Text:',_0xe852d1[_0x234659(0x171)]),console[_0x234659(0x1a2)](_0x234659(0x154),Object[_0x234659(0x1d3)](_0xe852d1['headers'][_0x234659(0x18d)]())),console[_0x234659(0x1a2)](_0x234659(0x160),_0x18959c+'ms');const _0x40b73f=await _0xe852d1[_0x234659(0x1c5)]();console['log'](_0x234659(0x19d),_0x40b73f);if(!_0xe852d1['ok']){console['error'](_0x234659(0x1ca)),console['error'](_0x234659(0x1b6),_0xe852d1[_0x234659(0x167)]),console[_0x234659(0x1cf)](_0x234659(0x1b4),_0x40b73f),loggerService_1[_0x234659(0x1c1)][_0x234659(0x199)](_0x234659(0x18a),'/create',_0xe852d1[_0x234659(0x167)],_0x40b73f,_0x18959c),loggerService_1[_0x234659(0x1c1)][_0x234659(0x1be)]('cointopay',_0x234659(0x15e),_0x234659(0x16f)+_0xe852d1['status']+':\x20'+_0x40b73f);throw new Error(_0x234659(0x195)+_0xe852d1[_0x234659(0x167)]+',\x20body:\x20'+_0x40b73f);}let _0x13cc1a;try{_0x13cc1a=JSON[_0x234659(0x170)](_0x40b73f);}catch(_0x2ae48f){console[_0x234659(0x1cf)](_0x234659(0x1bf),_0x2ae48f),loggerService_1[_0x234659(0x1c1)][_0x234659(0x1be)](_0x234659(0x18a),_0x234659(0x15e),_0x234659(0x192)+_0x2ae48f);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x40b73f);}console['log'](_0x234659(0x1cd)),console[_0x234659(0x1a2)](_0x234659(0x1d8),JSON['stringify'](_0x13cc1a,null,0x2)),loggerService_1['loggerService'][_0x234659(0x199)]('cointopay','/create',_0xe852d1[_0x234659(0x167)],_0x13cc1a,_0x18959c);if(_0x13cc1a['error']){const _0x33781a=_0x13cc1a['message']||_0x13cc1a[_0x234659(0x1cf)]||_0x234659(0x1a7);console[_0x234659(0x1cf)](_0x234659(0x18e)),console[_0x234659(0x1cf)](_0x234659(0x156),_0x33781a),loggerService_1[_0x234659(0x1c1)][_0x234659(0x1be)](_0x234659(0x18a),'/create','Business\x20Error:\x20'+_0x33781a);throw new Error(_0x234659(0x186)+_0x33781a);}if(!_0x13cc1a[_0x234659(0x1a6)]||!_0x13cc1a[_0x234659(0x153)]){console[_0x234659(0x1cf)](_0x234659(0x1c2)),console[_0x234659(0x1cf)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error'](_0x234659(0x191),_0x13cc1a),loggerService_1['loggerService']['logWhiteDomainError'](_0x234659(0x18a),_0x234659(0x15e),_0x234659(0x165));throw new Error(_0x234659(0x1a0));}return console[_0x234659(0x1a2)](_0x234659(0x1d2)),console[_0x234659(0x1a2)](_0x234659(0x1d6),_0x13cc1a[_0x234659(0x153)]),console['log'](_0x234659(0x16b),_0x13cc1a[_0x234659(0x1a6)]),console[_0x234659(0x1a2)](_0x234659(0x1b0),_0x31c410,_0x234659(0x17b)),{'gateway_payment_id':_0x13cc1a['gateway_payment_id'],'payment_url':_0x13cc1a[_0x234659(0x1a6)]};}catch(_0x4b7241){console[_0x234659(0x1cf)](_0x234659(0x1a9)),console[_0x234659(0x1cf)](_0x234659(0x16d),_0x4b7241),loggerService_1[_0x234659(0x1c1)][_0x234659(0x1be)](_0x234659(0x18a),_0x234659(0x15e),_0x4b7241);if(_0x4b7241 instanceof Error){console[_0x234659(0x1cf)](_0x234659(0x1c8),_0x4b7241['message']),console['error']('Error\x20stack:',_0x4b7241[_0x234659(0x182)]);throw new Error(_0x234659(0x185)+_0x4b7241[_0x234659(0x19b)]);}throw new Error(_0x234659(0x179));}}async[a40_0x2eecc7(0x1b9)](_0x112802){const _0x56318e=a40_0x2eecc7,_0x470c37=Date[_0x56318e(0x19f)]();try{console[_0x56318e(0x1a2)](_0x56318e(0x187)+_0x112802);const _0x2b5069={'gatewayPaymentId':_0x112802};loggerService_1[_0x56318e(0x1c1)]['logWhiteDomainRequest'](_0x56318e(0x18a),_0x56318e(0x190),'POST',_0x2b5069);const _0x29830e=await fetch(this[_0x56318e(0x173)],{'method':_0x56318e(0x1b1),'headers':{'Content-Type':_0x56318e(0x164),'Accept':_0x56318e(0x164),'User-Agent':_0x56318e(0x168)},'body':JSON[_0x56318e(0x17c)](_0x2b5069)}),_0x477afb=Date[_0x56318e(0x19f)]()-_0x470c37;console[_0x56318e(0x1a2)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log']('Status:',_0x29830e[_0x56318e(0x167)]),console[_0x56318e(0x1a2)](_0x56318e(0x160),_0x477afb+'ms');if(!_0x29830e['ok']){const _0x3512a8=await _0x29830e[_0x56318e(0x1c5)]();console[_0x56318e(0x1cf)](_0x56318e(0x1b6),_0x29830e[_0x56318e(0x167)]),console[_0x56318e(0x1cf)](_0x56318e(0x1b4),_0x3512a8),loggerService_1[_0x56318e(0x1c1)]['logWhiteDomainResponse']('cointopay',_0x56318e(0x190),_0x29830e[_0x56318e(0x167)],_0x3512a8,_0x477afb),loggerService_1[_0x56318e(0x1c1)][_0x56318e(0x1be)](_0x56318e(0x18a),'/status',_0x56318e(0x16f)+_0x29830e[_0x56318e(0x167)]+':\x20'+_0x3512a8);throw new Error('HTTP\x20error!\x20status:\x20'+_0x29830e['status']);}const _0x801eb3=await _0x29830e['text']();console[_0x56318e(0x1a2)](_0x56318e(0x19d),_0x801eb3);let _0x5b073d;try{_0x5b073d=JSON[_0x56318e(0x170)](_0x801eb3);}catch(_0x4cd3db){console[_0x56318e(0x1cf)](_0x56318e(0x1bf),_0x4cd3db),loggerService_1[_0x56318e(0x1c1)][_0x56318e(0x1be)](_0x56318e(0x18a),_0x56318e(0x190),_0x56318e(0x192)+_0x4cd3db);throw new Error(_0x56318e(0x15f)+_0x801eb3);}loggerService_1[_0x56318e(0x1c1)][_0x56318e(0x199)]('cointopay',_0x56318e(0x190),_0x29830e[_0x56318e(0x167)],_0x5b073d,_0x477afb),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x56318e(0x1a2)](_0x56318e(0x1d5),_0x5b073d[_0x56318e(0x176)]),console[_0x56318e(0x1a2)](_0x56318e(0x16c),_0x5b073d[_0x56318e(0x184)]),console[_0x56318e(0x1a2)](_0x56318e(0x169),_0x5b073d[_0x56318e(0x1d7)]?.[_0x56318e(0x194)]),console[_0x56318e(0x1a2)]('Amount:',_0x5b073d[_0x56318e(0x1d7)]?.['Amount']),console[_0x56318e(0x1a2)]('Currency:',_0x5b073d[_0x56318e(0x1d7)]?.['inputCurrency']);if(_0x5b073d[_0x56318e(0x176)]!=='success'||_0x5b073d[_0x56318e(0x184)]!==0xc8){const _0x55b661=_0x5b073d[_0x56318e(0x19b)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x56318e(0x1cf)]('Error\x20Message:',_0x55b661),loggerService_1[_0x56318e(0x1c1)][_0x56318e(0x1be)]('cointopay',_0x56318e(0x190),_0x56318e(0x1ae)+_0x55b661);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x55b661);}if(!_0x5b073d[_0x56318e(0x1d7)]){console[_0x56318e(0x1cf)](_0x56318e(0x1af)),console[_0x56318e(0x1cf)](_0x56318e(0x161)),loggerService_1[_0x56318e(0x1c1)][_0x56318e(0x1be)](_0x56318e(0x18a),_0x56318e(0x190),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x56318e(0x1ab));}let _0x46f22b=_0x56318e(0x1c7);switch(_0x5b073d['data']['Status']?.[_0x56318e(0x15b)]()){case'paid':_0x46f22b=_0x56318e(0x162);break;case _0x56318e(0x158):case _0x56318e(0x188):case _0x56318e(0x1cf):_0x46f22b=_0x56318e(0x163);break;case _0x56318e(0x19c):case'timeout':_0x46f22b=_0x56318e(0x166);break;case _0x56318e(0x1aa):case _0x56318e(0x1c0):case _0x56318e(0x181):case _0x56318e(0x159):default:_0x46f22b=_0x56318e(0x1c7);break;}let _0x4fbbb0,_0x1f330f;if(_0x5b073d[_0x56318e(0x1d7)][_0x56318e(0x1d1)]){const _0x2316ec=_0x5b073d[_0x56318e(0x1d7)][_0x56318e(0x1d1)];console['log'](_0x56318e(0x196),_0x2316ec);const _0x2720ca=_0x2316ec[_0x56318e(0x18f)](/IBAN\s+([A-Z0-9]+)/i);_0x2720ca&&(_0x4fbbb0=_0x2720ca[0x1],console[_0x56318e(0x1a2)](_0x56318e(0x178),_0x4fbbb0)),_0x1f330f=_0x2316ec;}const _0x347191={'iban':_0x4fbbb0,'bankDetails':_0x1f330f,'transactionId':_0x5b073d['data'][_0x56318e(0x17d)],'coinAddress':_0x5b073d[_0x56318e(0x1d7)][_0x56318e(0x1cc)],'qrCodeUrl':_0x5b073d[_0x56318e(0x1d7)][_0x56318e(0x1c4)],'expiryTime':_0x5b073d['data'][_0x56318e(0x1bd)],'createdOn':_0x5b073d[_0x56318e(0x1d7)]['CreatedOn'],'confirmedOn':_0x5b073d[_0x56318e(0x1d7)][_0x56318e(0x17e)]};console['log'](_0x56318e(0x1d0)),console[_0x56318e(0x1a2)](_0x56318e(0x1c6),_0x5b073d[_0x56318e(0x1d7)]['Status'],'->',_0x46f22b),console['log'](_0x56318e(0x1b0),_0x5b073d[_0x56318e(0x1d7)]['Amount'],_0x5b073d[_0x56318e(0x1d7)][_0x56318e(0x18b)]),console[_0x56318e(0x1a2)](_0x56318e(0x1ba),_0x5b073d[_0x56318e(0x1d7)][_0x56318e(0x17d)]),console[_0x56318e(0x1a2)](_0x56318e(0x1b8),_0x4fbbb0||_0x56318e(0x180)),console[_0x56318e(0x1a2)](_0x56318e(0x174),_0x5b073d['data'][_0x56318e(0x197)]),console[_0x56318e(0x1a2)](_0x56318e(0x193),_0x5b073d['data'][_0x56318e(0x17e)]||_0x56318e(0x15d));if(_0x5b073d[_0x56318e(0x1d7)]['Status']?.[_0x56318e(0x15b)]()===_0x56318e(0x1c0))console[_0x56318e(0x1a2)](_0x56318e(0x1bb));else _0x5b073d[_0x56318e(0x1d7)]['Status']?.[_0x56318e(0x15b)]()===_0x56318e(0x189)&&console[_0x56318e(0x1a2)](_0x56318e(0x1b2));return{'status':_0x46f22b,'amount':parseFloat(_0x5b073d[_0x56318e(0x1d7)][_0x56318e(0x1ad)])||undefined,'currency':_0x5b073d[_0x56318e(0x1d7)][_0x56318e(0x18b)]||_0x56318e(0x17b),'paymentDetails':_0x347191};}catch(_0x1dc953){console[_0x56318e(0x1cf)](_0x56318e(0x1a5),_0x1dc953),loggerService_1[_0x56318e(0x1c1)][_0x56318e(0x1be)](_0x56318e(0x18a),_0x56318e(0x190),_0x1dc953);throw new Error(_0x56318e(0x183)+(_0x1dc953 instanceof Error?_0x1dc953[_0x56318e(0x19b)]:'Unknown\x20error'));}}async['verifyPayment'](_0x560120){const _0x2ae3ad=a40_0x2eecc7,_0x170666=await this[_0x2ae3ad(0x1b9)](_0x560120);return{'status':_0x170666[_0x2ae3ad(0x167)],'amount':_0x170666[_0x2ae3ad(0x15c)],'currency':_0x170666['currency']};}async[a40_0x2eecc7(0x172)](_0x16984f){const _0x5eeef3=a40_0x2eecc7;console['log'](_0x5eeef3(0x1ce),_0x16984f);let _0x7d81dd=_0x5eeef3(0x1c7);switch(_0x16984f[_0x5eeef3(0x167)]?.['toLowerCase']()){case _0x5eeef3(0x189):_0x7d81dd=_0x5eeef3(0x162);break;case'cancelled':case _0x5eeef3(0x188):case _0x5eeef3(0x1cf):_0x7d81dd=_0x5eeef3(0x163);break;case _0x5eeef3(0x19c):case'timeout':_0x7d81dd='EXPIRED';break;case'pending':case _0x5eeef3(0x1aa):case'awaiting\x20fiat':case'created':default:_0x7d81dd=_0x5eeef3(0x1c7);break;}return{'paymentId':_0x16984f[_0x5eeef3(0x177)]||_0x16984f[_0x5eeef3(0x1cb)]||'','status':_0x7d81dd,'amount':_0x16984f[_0x5eeef3(0x15c)],'currency':_0x16984f['currency']||_0x5eeef3(0x17b)};}}exports[a40_0x2eecc7(0x1d4)]=CoinToPayService;