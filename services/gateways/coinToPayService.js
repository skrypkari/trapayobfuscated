'use strict';const a38_0x18655b=a38_0x5152;(function(_0xa9c44d,_0x4bbf99){const _0x5939f9=a38_0x5152,_0x330a69=_0xa9c44d();while(!![]){try{const _0x2c7e64=-parseInt(_0x5939f9(0x19c))/0x1*(-parseInt(_0x5939f9(0x15d))/0x2)+-parseInt(_0x5939f9(0x1c1))/0x3*(-parseInt(_0x5939f9(0x196))/0x4)+parseInt(_0x5939f9(0x1a9))/0x5*(parseInt(_0x5939f9(0x157))/0x6)+parseInt(_0x5939f9(0x1ba))/0x7*(parseInt(_0x5939f9(0x175))/0x8)+-parseInt(_0x5939f9(0x165))/0x9+parseInt(_0x5939f9(0x14c))/0xa+-parseInt(_0x5939f9(0x163))/0xb;if(_0x2c7e64===_0x4bbf99)break;else _0x330a69['push'](_0x330a69['shift']());}catch(_0x197821){_0x330a69['push'](_0x330a69['shift']());}}}(a38_0x508f,0x5fe5d));function a38_0x5152(_0x590ac5,_0x498d50){const _0x508f0f=a38_0x508f();return a38_0x5152=function(_0x515211,_0x47be60){_0x515211=_0x515211-0x144;let _0x6b56fe=_0x508f0f[_0x515211];return _0x6b56fe;},a38_0x5152(_0x590ac5,_0x498d50);}Object[a38_0x18655b(0x18f)](exports,a38_0x18655b(0x170),{'value':!![]}),exports[a38_0x18655b(0x1a0)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x2ada1e=a38_0x18655b;this[_0x2ada1e(0x15e)]='https://tesoft.uk/gateway/cointopay/',this[_0x2ada1e(0x16c)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x2ada1e(0x1a7)](_0x2ada1e(0x1bd)),console['log']('üìä\x20Status\x20check\x20URL:',this['statusUrl']);}async['createPaymentLink'](_0x24d435){const _0x3595e1=a38_0x18655b,{orderId:_0x58d1cf,amount:_0x10fe6a}=_0x24d435;console[_0x3595e1(0x1a7)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x10fe6a+_0x3595e1(0x167));const _0x4d3063={'amount':_0x10fe6a},_0x5914a6=Date[_0x3595e1(0x198)]();try{console[_0x3595e1(0x1a7)](_0x3595e1(0x1b3)),console[_0x3595e1(0x1a7)]('URL:',this['apiUrl']),console[_0x3595e1(0x1a7)](_0x3595e1(0x1af),JSON[_0x3595e1(0x1ac)](_0x4d3063,null,0x2)),console[_0x3595e1(0x1a7)](_0x3595e1(0x14d),_0x10fe6a,_0x3595e1(0x1b4)),loggerService_1['loggerService'][_0x3595e1(0x156)](_0x3595e1(0x17f),_0x3595e1(0x186),_0x3595e1(0x17c),_0x4d3063);const _0x347da7=await fetch(this[_0x3595e1(0x15e)],{'method':_0x3595e1(0x17c),'headers':{'Content-Type':_0x3595e1(0x16b),'Accept':'application/json','User-Agent':_0x3595e1(0x177)},'body':JSON[_0x3595e1(0x1ac)](_0x4d3063)}),_0x563b9b=Date[_0x3595e1(0x198)]()-_0x5914a6;console[_0x3595e1(0x1a7)](_0x3595e1(0x147)),console[_0x3595e1(0x1a7)]('Status:',_0x347da7[_0x3595e1(0x17e)]),console['log'](_0x3595e1(0x146),_0x347da7[_0x3595e1(0x1b8)]),console[_0x3595e1(0x1a7)](_0x3595e1(0x190),Object[_0x3595e1(0x1b7)](_0x347da7[_0x3595e1(0x14a)][_0x3595e1(0x1a6)]())),console['log'](_0x3595e1(0x1bb),_0x563b9b+'ms');const _0x1867d5=await _0x347da7[_0x3595e1(0x1c2)]();console[_0x3595e1(0x1a7)](_0x3595e1(0x1be),_0x1867d5);if(!_0x347da7['ok']){console[_0x3595e1(0x1b5)](_0x3595e1(0x159)),console[_0x3595e1(0x1b5)](_0x3595e1(0x18c),_0x347da7[_0x3595e1(0x17e)]),console[_0x3595e1(0x1b5)](_0x3595e1(0x16f),_0x1867d5),loggerService_1[_0x3595e1(0x160)][_0x3595e1(0x158)]('cointopay',_0x3595e1(0x186),_0x347da7[_0x3595e1(0x17e)],_0x1867d5,_0x563b9b),loggerService_1[_0x3595e1(0x160)]['logWhiteDomainError'](_0x3595e1(0x17f),'/create',_0x3595e1(0x169)+_0x347da7[_0x3595e1(0x17e)]+':\x20'+_0x1867d5);throw new Error(_0x3595e1(0x1a3)+_0x347da7[_0x3595e1(0x17e)]+_0x3595e1(0x1b1)+_0x1867d5);}let _0x2428ba;try{_0x2428ba=JSON[_0x3595e1(0x171)](_0x1867d5);}catch(_0x651009){console['error'](_0x3595e1(0x166),_0x651009),loggerService_1[_0x3595e1(0x160)][_0x3595e1(0x1a2)](_0x3595e1(0x17f),'/create',_0x3595e1(0x18a)+_0x651009);throw new Error(_0x3595e1(0x1b6)+_0x1867d5);}console['log'](_0x3595e1(0x162)),console[_0x3595e1(0x1a7)]('Parsed\x20Result:',JSON[_0x3595e1(0x1ac)](_0x2428ba,null,0x2)),loggerService_1[_0x3595e1(0x160)][_0x3595e1(0x158)](_0x3595e1(0x17f),'/create',_0x347da7[_0x3595e1(0x17e)],_0x2428ba,_0x563b9b);if(_0x2428ba[_0x3595e1(0x1b5)]){const _0x245d3b=_0x2428ba[_0x3595e1(0x195)]||_0x2428ba[_0x3595e1(0x1b5)]||_0x3595e1(0x172);console[_0x3595e1(0x1b5)](_0x3595e1(0x15c)),console[_0x3595e1(0x1b5)](_0x3595e1(0x1a4),_0x245d3b),loggerService_1['loggerService'][_0x3595e1(0x1a2)](_0x3595e1(0x17f),_0x3595e1(0x186),_0x3595e1(0x149)+_0x245d3b);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x245d3b);}if(!_0x2428ba[_0x3595e1(0x182)]||!_0x2428ba[_0x3595e1(0x179)]){console[_0x3595e1(0x1b5)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3595e1(0x1b5)](_0x3595e1(0x16a)),console[_0x3595e1(0x1b5)]('Response\x20data:',_0x2428ba),loggerService_1['loggerService'][_0x3595e1(0x1a2)](_0x3595e1(0x17f),'/create',_0x3595e1(0x199));throw new Error(_0x3595e1(0x145));}return console[_0x3595e1(0x1a7)](_0x3595e1(0x189)),console[_0x3595e1(0x1a7)]('Gateway\x20Payment\x20ID:',_0x2428ba[_0x3595e1(0x179)]),console[_0x3595e1(0x1a7)](_0x3595e1(0x15b),_0x2428ba[_0x3595e1(0x182)]),console[_0x3595e1(0x1a7)](_0x3595e1(0x14d),_0x10fe6a,'EUR'),{'gateway_payment_id':_0x2428ba[_0x3595e1(0x179)],'payment_url':_0x2428ba[_0x3595e1(0x182)]};}catch(_0x379ee4){console[_0x3595e1(0x1b5)](_0x3595e1(0x185)),console[_0x3595e1(0x1b5)](_0x3595e1(0x19b),_0x379ee4),loggerService_1['loggerService'][_0x3595e1(0x1a2)]('cointopay',_0x3595e1(0x186),_0x379ee4);if(_0x379ee4 instanceof Error){console[_0x3595e1(0x1b5)](_0x3595e1(0x161),_0x379ee4[_0x3595e1(0x195)]),console['error'](_0x3595e1(0x1bc),_0x379ee4[_0x3595e1(0x148)]);throw new Error(_0x3595e1(0x151)+_0x379ee4[_0x3595e1(0x195)]);}throw new Error(_0x3595e1(0x1b0));}}async['checkPaymentStatus'](_0x17114b){const _0x1b9c86=a38_0x18655b,_0x5399a8=Date[_0x1b9c86(0x198)]();try{console[_0x1b9c86(0x1a7)](_0x1b9c86(0x17d)+_0x17114b);const _0x20b1d9={'gatewayPaymentId':_0x17114b};loggerService_1[_0x1b9c86(0x160)]['logWhiteDomainRequest'](_0x1b9c86(0x17f),_0x1b9c86(0x1c0),'POST',_0x20b1d9);const _0x26120f=await fetch(this[_0x1b9c86(0x16c)],{'method':'POST','headers':{'Content-Type':_0x1b9c86(0x16b),'Accept':_0x1b9c86(0x16b),'User-Agent':_0x1b9c86(0x177)},'body':JSON['stringify'](_0x20b1d9)}),_0x57c3d3=Date['now']()-_0x5399a8;console['log'](_0x1b9c86(0x184)),console[_0x1b9c86(0x1a7)]('Status:',_0x26120f[_0x1b9c86(0x17e)]),console['log'](_0x1b9c86(0x1bb),_0x57c3d3+'ms');if(!_0x26120f['ok']){const _0xdf0911=await _0x26120f['text']();console[_0x1b9c86(0x1b5)](_0x1b9c86(0x18c),_0x26120f[_0x1b9c86(0x17e)]),console[_0x1b9c86(0x1b5)](_0x1b9c86(0x16f),_0xdf0911),loggerService_1[_0x1b9c86(0x160)][_0x1b9c86(0x158)](_0x1b9c86(0x17f),_0x1b9c86(0x1c0),_0x26120f['status'],_0xdf0911,_0x57c3d3),loggerService_1['loggerService'][_0x1b9c86(0x1a2)]('cointopay','/status',_0x1b9c86(0x169)+_0x26120f[_0x1b9c86(0x17e)]+':\x20'+_0xdf0911);throw new Error(_0x1b9c86(0x1a3)+_0x26120f[_0x1b9c86(0x17e)]);}const _0x374ccf=await _0x26120f[_0x1b9c86(0x1c2)]();console[_0x1b9c86(0x1a7)](_0x1b9c86(0x1be),_0x374ccf);let _0x5695c3;try{_0x5695c3=JSON[_0x1b9c86(0x171)](_0x374ccf);}catch(_0x1e7e67){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x1e7e67),loggerService_1[_0x1b9c86(0x160)]['logWhiteDomainError'](_0x1b9c86(0x17f),_0x1b9c86(0x1c0),_0x1b9c86(0x18a)+_0x1e7e67);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x374ccf);}loggerService_1['loggerService'][_0x1b9c86(0x158)]('cointopay',_0x1b9c86(0x1c0),_0x26120f['status'],_0x5695c3,_0x57c3d3),console[_0x1b9c86(0x1a7)](_0x1b9c86(0x153)),console[_0x1b9c86(0x1a7)](_0x1b9c86(0x15f),_0x5695c3['result']),console['log']('Status\x20Code:',_0x5695c3[_0x1b9c86(0x144)]),console[_0x1b9c86(0x1a7)](_0x1b9c86(0x18e),_0x5695c3[_0x1b9c86(0x14b)]?.[_0x1b9c86(0x191)]),console[_0x1b9c86(0x1a7)](_0x1b9c86(0x14d),_0x5695c3[_0x1b9c86(0x14b)]?.[_0x1b9c86(0x19f)]),console[_0x1b9c86(0x1a7)](_0x1b9c86(0x188),_0x5695c3[_0x1b9c86(0x14b)]?.['inputCurrency']);if(_0x5695c3[_0x1b9c86(0x197)]!==_0x1b9c86(0x1aa)||_0x5695c3[_0x1b9c86(0x144)]!==0xc8){const _0x1bec7c=_0x5695c3[_0x1b9c86(0x195)]||_0x1b9c86(0x1a8);console[_0x1b9c86(0x1b5)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x1b9c86(0x1b5)](_0x1b9c86(0x1a4),_0x1bec7c),loggerService_1[_0x1b9c86(0x160)][_0x1b9c86(0x1a2)](_0x1b9c86(0x17f),_0x1b9c86(0x1c0),'Status\x20API\x20Error:\x20'+_0x1bec7c);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x1bec7c);}if(!_0x5695c3[_0x1b9c86(0x14b)]){console[_0x1b9c86(0x1b5)](_0x1b9c86(0x168)),console[_0x1b9c86(0x1b5)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x1b9c86(0x160)][_0x1b9c86(0x1a2)](_0x1b9c86(0x17f),'/status','Incomplete\x20response:\x20missing\x20data');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x13cb9a='PENDING';switch(_0x5695c3[_0x1b9c86(0x14b)][_0x1b9c86(0x191)]?.[_0x1b9c86(0x18b)]()){case'paid':_0x13cb9a='PAID';break;case'cancelled':case _0x1b9c86(0x15a):case'error':_0x13cb9a=_0x1b9c86(0x1a5);break;case'expired':case _0x1b9c86(0x14f):_0x13cb9a='EXPIRED';break;case _0x1b9c86(0x16e):case _0x1b9c86(0x1b9):case'pending':case'created':default:_0x13cb9a=_0x1b9c86(0x1a1);break;}let _0x3ee9c9,_0x460c08;if(_0x5695c3[_0x1b9c86(0x14b)][_0x1b9c86(0x154)]){const _0x508a9b=_0x5695c3[_0x1b9c86(0x14b)][_0x1b9c86(0x154)];console[_0x1b9c86(0x1a7)](_0x1b9c86(0x1b2),_0x508a9b);const _0x51eaec=_0x508a9b['match'](/IBAN\s+([A-Z0-9]+)/i);_0x51eaec&&(_0x3ee9c9=_0x51eaec[0x1],console[_0x1b9c86(0x1a7)](_0x1b9c86(0x152),_0x3ee9c9)),_0x460c08=_0x508a9b;}const _0x13d56b={'iban':_0x3ee9c9,'bankDetails':_0x460c08,'transactionId':_0x5695c3[_0x1b9c86(0x14b)]['TransactionID'],'coinAddress':_0x5695c3[_0x1b9c86(0x14b)][_0x1b9c86(0x18d)],'qrCodeUrl':_0x5695c3['data'][_0x1b9c86(0x192)],'expiryTime':_0x5695c3[_0x1b9c86(0x14b)][_0x1b9c86(0x17a)],'createdOn':_0x5695c3[_0x1b9c86(0x14b)]['CreatedOn'],'confirmedOn':_0x5695c3['data']['TransactionConfirmedOn']};console[_0x1b9c86(0x1a7)](_0x1b9c86(0x1bf)),console['log'](_0x1b9c86(0x1ad),_0x5695c3[_0x1b9c86(0x14b)][_0x1b9c86(0x191)],'->',_0x13cb9a),console[_0x1b9c86(0x1a7)]('Amount:',_0x5695c3[_0x1b9c86(0x14b)][_0x1b9c86(0x19f)],_0x5695c3[_0x1b9c86(0x14b)][_0x1b9c86(0x14e)]),console['log']('Transaction\x20ID:',_0x5695c3[_0x1b9c86(0x14b)][_0x1b9c86(0x181)]),console[_0x1b9c86(0x1a7)](_0x1b9c86(0x176),_0x3ee9c9||_0x1b9c86(0x187)),console['log'](_0x1b9c86(0x19e),_0x5695c3[_0x1b9c86(0x14b)]['CreatedOn']),console['log'](_0x1b9c86(0x19d),_0x5695c3['data'][_0x1b9c86(0x183)]||_0x1b9c86(0x17b));if(_0x5695c3[_0x1b9c86(0x14b)][_0x1b9c86(0x191)]?.[_0x1b9c86(0x18b)]()===_0x1b9c86(0x1b9))console[_0x1b9c86(0x1a7)](_0x1b9c86(0x150));else _0x5695c3[_0x1b9c86(0x14b)][_0x1b9c86(0x191)]?.[_0x1b9c86(0x18b)]()===_0x1b9c86(0x1c3)&&console[_0x1b9c86(0x1a7)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x13cb9a,'amount':parseFloat(_0x5695c3[_0x1b9c86(0x14b)][_0x1b9c86(0x19f)])||undefined,'currency':_0x5695c3[_0x1b9c86(0x14b)][_0x1b9c86(0x14e)]||_0x1b9c86(0x178),'paymentDetails':_0x13d56b};}catch(_0x2f0e2b){console['error'](_0x1b9c86(0x155),_0x2f0e2b),loggerService_1[_0x1b9c86(0x160)]['logWhiteDomainError'](_0x1b9c86(0x17f),'/status',_0x2f0e2b);throw new Error(_0x1b9c86(0x1ae)+(_0x2f0e2b instanceof Error?_0x2f0e2b[_0x1b9c86(0x195)]:_0x1b9c86(0x194)));}}async['verifyPayment'](_0x552420){const _0x5ccafe=a38_0x18655b,_0x31f629=await this['checkPaymentStatus'](_0x552420);return{'status':_0x31f629[_0x5ccafe(0x17e)],'amount':_0x31f629[_0x5ccafe(0x193)],'currency':_0x31f629[_0x5ccafe(0x180)]};}async[a38_0x18655b(0x16d)](_0x2d4459){const _0xe60bcf=a38_0x18655b;console[_0xe60bcf(0x1a7)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x2d4459);let _0x4dedd4='PENDING';switch(_0x2d4459['status']?.['toLowerCase']()){case _0xe60bcf(0x1c3):_0x4dedd4=_0xe60bcf(0x19a);break;case _0xe60bcf(0x164):case _0xe60bcf(0x15a):case'error':_0x4dedd4=_0xe60bcf(0x1a5);break;case'expired':case _0xe60bcf(0x14f):_0x4dedd4=_0xe60bcf(0x1ab);break;case'pending':case _0xe60bcf(0x16e):case _0xe60bcf(0x1b9):case _0xe60bcf(0x174):default:_0x4dedd4=_0xe60bcf(0x1a1);break;}return{'paymentId':_0x2d4459['order_id']||_0x2d4459[_0xe60bcf(0x173)]||'','status':_0x4dedd4,'amount':_0x2d4459[_0xe60bcf(0x193)],'currency':_0x2d4459[_0xe60bcf(0x180)]||_0xe60bcf(0x178)};}}function a38_0x508f(){const _0x4a3b88=['CoinToPay\x20payment\x20status\x20check\x20error:','logWhiteDomainRequest','4565682VIoGPI','logWhiteDomainResponse','===\x20COINTOPAY\x20API\x20ERROR\x20===','failed','Payment\x20URL:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','2DbScqn','apiUrl','Result:','loggerService','Error\x20message:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','7077477YnJNpT','cancelled','3654198BEKwBJ','Failed\x20to\x20parse\x20JSON\x20response:','\x20EUR','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','application/json','statusUrl','processWebhook','waiting','Response\x20Body:','__esModule','parse','Unknown\x20error\x20from\x20CoinToPay\x20API','merchant_reference_id','created','1216QbgJcZ','IBAN:','TesSoft\x20Payment\x20System/1.0','EUR','gateway_payment_id','ExpiryTime','not\x20confirmed','POST','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','status','cointopay','currency','TransactionID','payment_url','TransactionConfirmedOn','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','/create','not\x20found','Currency:','===\x20COINTOPAY\x20SUCCESS\x20===','JSON\x20Parse\x20Error:\x20','toLowerCase','HTTP\x20Status:','coinAddress','Payment\x20Status:','defineProperty','Headers:','Status','QRCodeURL','amount','Unknown\x20error','message','14320fEKfjJ','result','now','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','PAID','Error\x20details:','104902aKrrco','Confirmed\x20On:','Created\x20On:','Amount','CoinToPayService','PENDING','logWhiteDomainError','HTTP\x20error!\x20status:\x20','Error\x20Message:','FAILED','entries','log','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','5rrBcRQ','success','EXPIRED','stringify','Status:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Request\x20Body:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error',',\x20body:\x20','üè¶\x20Payment\x20Detail:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','error','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','fromEntries','statusText','awaiting\x20fiat','6251QAOiUo','Response\x20Time:','Error\x20stack:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Raw\x20Response\x20Body:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','/status','48tbKCzs','text','paid','status_code','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status\x20Text:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','stack','Business\x20Error:\x20','headers','data','3833610sqWOLo','Amount:','inputCurrency','timeout','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','üè¶\x20Extracted\x20IBAN:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','PaymentDetail'];a38_0x508f=function(){return _0x4a3b88;};return a38_0x508f();}exports[a38_0x18655b(0x1a0)]=CoinToPayService;