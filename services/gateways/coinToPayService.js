'use strict';const a41_0x3c7555=a41_0x4f17;(function(_0x46e371,_0x4e65a1){const _0x15ff5e=a41_0x4f17,_0x5b0f7f=_0x46e371();while(!![]){try{const _0xef5c3c=parseInt(_0x15ff5e(0xa1))/0x1*(-parseInt(_0x15ff5e(0x10d))/0x2)+-parseInt(_0x15ff5e(0x100))/0x3+parseInt(_0x15ff5e(0xdb))/0x4+-parseInt(_0x15ff5e(0xa9))/0x5+-parseInt(_0x15ff5e(0xe9))/0x6*(parseInt(_0x15ff5e(0xe4))/0x7)+-parseInt(_0x15ff5e(0xd0))/0x8+parseInt(_0x15ff5e(0x94))/0x9;if(_0xef5c3c===_0x4e65a1)break;else _0x5b0f7f['push'](_0x5b0f7f['shift']());}catch(_0x3dc765){_0x5b0f7f['push'](_0x5b0f7f['shift']());}}}(a41_0x1f89,0x9caf7));function a41_0x4f17(_0x9d79d3,_0x1c4877){const _0x1f8917=a41_0x1f89();return a41_0x4f17=function(_0x4f1757,_0x4c79f8){_0x4f1757=_0x4f1757-0x8a;let _0x4650e8=_0x1f8917[_0x4f1757];return _0x4650e8;},a41_0x4f17(_0x9d79d3,_0x1c4877);}Object[a41_0x3c7555(0xa6)](exports,'__esModule',{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require('../loggerService');function a41_0x1f89(){const _0x3a62f4=['timeout','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','paid','amount','statusUrl','createPaymentLink','Status\x20Code:','CoinToPayService','log','FAILED','stringify','waiting','Error\x20Message:','Amount:','Business\x20Error:\x20','success','logWhiteDomainResponse','TesSoft\x20Payment\x20System/1.0','Error\x20message:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','apiUrl','not\x20found','1550544KPWwVP','EUR','Amount','inputCurrency','toLowerCase','status_code','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Payment\x20URL:','Status\x20API\x20Error:\x20','cancelled','Unknown\x20error','verifyPayment','PAID','8LkXFmI','Status\x20Text:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Confirmed\x20On:','EXPIRED','status','PaymentDetail','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Response\x20Body:','Transaction\x20ID:','HTTP\x20','14063247nwzbKM','headers','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Error\x20stack:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','URL:','checkPaymentStatus','not\x20confirmed','entries','CoinToPay\x20status\x20API\x20error:\x20','Payment\x20Status:','Status','result','308170fKJNlp','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','application/json','statusText','loggerService','defineProperty','pending','===\x20COINTOPAY\x20SUCCESS\x20===','384870lKVcQq','Failed\x20to\x20parse\x20JSON\x20response:','CoinToPay\x20payment\x20status\x20check\x20error:','parse','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','üè¶\x20Payment\x20Detail:',',\x20body:\x20','ExpiryTime','TransactionID','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','fromEntries','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Parsed\x20Result:','currency','Result:','/create','created','HTTP\x20Status:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Response\x20data:','PENDING','match','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','awaiting\x20fiat','gateway_payment_id','payment_url','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','order_id','Headers:','text','Status:','Raw\x20Response\x20Body:','coinAddress','CreatedOn','message','TransactionConfirmedOn','160000DloSoC','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','JSON\x20Parse\x20Error:\x20','Missing\x20data\x20in\x20response','now','data','Response\x20Time:','logWhiteDomainRequest','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','/status','4887752PmIubv','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','QRCodeURL','merchant_reference_id','error','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Gateway\x20Payment\x20ID:','cointopay','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','518413qNBdAY','POST','logWhiteDomainError','failed','Currency:','24PfqcuZ'];a41_0x1f89=function(){return _0x3a62f4;};return a41_0x1f89();}class CoinToPayService{constructor(){const _0x48a070=a41_0x3c7555;this[_0x48a070(0xfe)]='https://tesoft.uk/gateway/cointopay/',this[_0x48a070(0xee)]=_0x48a070(0xc0),console[_0x48a070(0xf2)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log']('üìä\x20Status\x20check\x20URL:',this[_0x48a070(0xee)]);}async[a41_0x3c7555(0xef)](_0x501d62){const _0xb15ea5=a41_0x3c7555,{orderId:_0x4ec64e,amount:_0x378c38}=_0x501d62;console[_0xb15ea5(0xf2)](_0xb15ea5(0xeb)+_0x378c38+'\x20EUR');const _0x45f767={'amount':_0x378c38},_0x4ae10c=Date['now']();try{console[_0xb15ea5(0xf2)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0xb15ea5(0xf2)](_0xb15ea5(0x99),this['apiUrl']),console[_0xb15ea5(0xf2)]('Request\x20Body:',JSON['stringify'](_0x45f767,null,0x2)),console[_0xb15ea5(0xf2)](_0xb15ea5(0xf7),_0x378c38,_0xb15ea5(0xb2)),loggerService_1[_0xb15ea5(0xa5)][_0xb15ea5(0xd8)](_0xb15ea5(0xe2),_0xb15ea5(0xb9),_0xb15ea5(0xe5),_0x45f767);const _0x391bcb=await fetch(this[_0xb15ea5(0xfe)],{'method':_0xb15ea5(0xe5),'headers':{'Content-Type':_0xb15ea5(0xa3),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0xb15ea5(0xf4)](_0x45f767)}),_0x9a12c6=Date['now']()-_0x4ae10c;console[_0xb15ea5(0xf2)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0xb15ea5(0xca),_0x391bcb[_0xb15ea5(0x8e)]),console[_0xb15ea5(0xf2)](_0xb15ea5(0x8a),_0x391bcb[_0xb15ea5(0xa4)]),console[_0xb15ea5(0xf2)](_0xb15ea5(0xc8),Object[_0xb15ea5(0xb3)](_0x391bcb[_0xb15ea5(0x95)][_0xb15ea5(0x9c)]())),console[_0xb15ea5(0xf2)](_0xb15ea5(0xd7),_0x9a12c6+'ms');const _0x145c5d=await _0x391bcb[_0xb15ea5(0xc9)]();console[_0xb15ea5(0xf2)](_0xb15ea5(0xcb),_0x145c5d);if(!_0x391bcb['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0xb15ea5(0xdf)]('HTTP\x20Status:',_0x391bcb['status']),console[_0xb15ea5(0xdf)](_0xb15ea5(0x91),_0x145c5d),loggerService_1[_0xb15ea5(0xa5)][_0xb15ea5(0xfa)](_0xb15ea5(0xe2),_0xb15ea5(0xb9),_0x391bcb['status'],_0x145c5d,_0x9a12c6),loggerService_1[_0xb15ea5(0xa5)]['logWhiteDomainError'](_0xb15ea5(0xe2),'/create',_0xb15ea5(0x93)+_0x391bcb['status']+':\x20'+_0x145c5d);throw new Error(_0xb15ea5(0xb4)+_0x391bcb[_0xb15ea5(0x8e)]+_0xb15ea5(0xaf)+_0x145c5d);}let _0x1a2b64;try{_0x1a2b64=JSON[_0xb15ea5(0xac)](_0x145c5d);}catch(_0x1cf530){console['error'](_0xb15ea5(0xaa),_0x1cf530),loggerService_1[_0xb15ea5(0xa5)][_0xb15ea5(0xe6)](_0xb15ea5(0xe2),'/create',_0xb15ea5(0xd3)+_0x1cf530);throw new Error(_0xb15ea5(0xc2)+_0x145c5d);}console['log'](_0xb15ea5(0xbc)),console[_0xb15ea5(0xf2)](_0xb15ea5(0xb6),JSON['stringify'](_0x1a2b64,null,0x2)),loggerService_1[_0xb15ea5(0xa5)][_0xb15ea5(0xfa)](_0xb15ea5(0xe2),_0xb15ea5(0xb9),_0x391bcb[_0xb15ea5(0x8e)],_0x1a2b64,_0x9a12c6);if(_0x1a2b64['error']){const _0x9648a6=_0x1a2b64[_0xb15ea5(0xce)]||_0x1a2b64[_0xb15ea5(0xdf)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0xb15ea5(0xdf)](_0xb15ea5(0xd1)),console[_0xb15ea5(0xdf)](_0xb15ea5(0xf6),_0x9648a6),loggerService_1['loggerService'][_0xb15ea5(0xe6)](_0xb15ea5(0xe2),_0xb15ea5(0xb9),_0xb15ea5(0xf8)+_0x9648a6);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x9648a6);}if(!_0x1a2b64['payment_url']||!_0x1a2b64['gateway_payment_id']){console[_0xb15ea5(0xdf)](_0xb15ea5(0xe0)),console[_0xb15ea5(0xdf)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0xb15ea5(0xdf)](_0xb15ea5(0xbd),_0x1a2b64),loggerService_1['loggerService']['logWhiteDomainError'](_0xb15ea5(0xe2),_0xb15ea5(0xb9),_0xb15ea5(0xa2));throw new Error(_0xb15ea5(0xd9));}return console[_0xb15ea5(0xf2)](_0xb15ea5(0xa8)),console['log'](_0xb15ea5(0xe1),_0x1a2b64[_0xb15ea5(0xc4)]),console['log'](_0xb15ea5(0x107),_0x1a2b64[_0xb15ea5(0xc5)]),console[_0xb15ea5(0xf2)](_0xb15ea5(0xf7),_0x378c38,_0xb15ea5(0x101)),{'gateway_payment_id':_0x1a2b64[_0xb15ea5(0xc4)],'payment_url':_0x1a2b64[_0xb15ea5(0xc5)]};}catch(_0x59a898){console[_0xb15ea5(0xdf)](_0xb15ea5(0xc1)),console[_0xb15ea5(0xdf)]('Error\x20details:',_0x59a898),loggerService_1[_0xb15ea5(0xa5)][_0xb15ea5(0xe6)](_0xb15ea5(0xe2),_0xb15ea5(0xb9),_0x59a898);if(_0x59a898 instanceof Error){console[_0xb15ea5(0xdf)](_0xb15ea5(0xfc),_0x59a898[_0xb15ea5(0xce)]),console[_0xb15ea5(0xdf)](_0xb15ea5(0x97),_0x59a898['stack']);throw new Error(_0xb15ea5(0xdc)+_0x59a898[_0xb15ea5(0xce)]);}throw new Error(_0xb15ea5(0xc6));}}async[a41_0x3c7555(0x9a)](_0x24ba3b){const _0x4160db=a41_0x3c7555,_0x21f700=Date[_0x4160db(0xd5)]();try{console[_0x4160db(0xf2)](_0x4160db(0xd2)+_0x24ba3b);const _0x510cb5={'gatewayPaymentId':_0x24ba3b};loggerService_1[_0x4160db(0xa5)][_0x4160db(0xd8)](_0x4160db(0xe2),_0x4160db(0xda),'POST',_0x510cb5);const _0x33c957=await fetch(this[_0x4160db(0xee)],{'method':_0x4160db(0xe5),'headers':{'Content-Type':_0x4160db(0xa3),'Accept':_0x4160db(0xa3),'User-Agent':_0x4160db(0xfb)},'body':JSON[_0x4160db(0xf4)](_0x510cb5)}),_0x53418d=Date[_0x4160db(0xd5)]()-_0x21f700;console[_0x4160db(0xf2)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log'](_0x4160db(0xca),_0x33c957['status']),console['log'](_0x4160db(0xd7),_0x53418d+'ms');if(!_0x33c957['ok']){const _0x2e28fd=await _0x33c957[_0x4160db(0xc9)]();console['error'](_0x4160db(0xbb),_0x33c957[_0x4160db(0x8e)]),console[_0x4160db(0xdf)](_0x4160db(0x91),_0x2e28fd),loggerService_1[_0x4160db(0xa5)][_0x4160db(0xfa)](_0x4160db(0xe2),_0x4160db(0xda),_0x33c957['status'],_0x2e28fd,_0x53418d),loggerService_1[_0x4160db(0xa5)][_0x4160db(0xe6)]('cointopay',_0x4160db(0xda),_0x4160db(0x93)+_0x33c957[_0x4160db(0x8e)]+':\x20'+_0x2e28fd);throw new Error('HTTP\x20error!\x20status:\x20'+_0x33c957[_0x4160db(0x8e)]);}const _0x244b8b=await _0x33c957[_0x4160db(0xc9)]();console['log'](_0x4160db(0xcb),_0x244b8b);let _0x10d61a;try{_0x10d61a=JSON[_0x4160db(0xac)](_0x244b8b);}catch(_0xbcf4be){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0xbcf4be),loggerService_1[_0x4160db(0xa5)]['logWhiteDomainError'](_0x4160db(0xe2),_0x4160db(0xda),'JSON\x20Parse\x20Error:\x20'+_0xbcf4be);throw new Error(_0x4160db(0xe3)+_0x244b8b);}loggerService_1[_0x4160db(0xa5)][_0x4160db(0xfa)]('cointopay',_0x4160db(0xda),_0x33c957[_0x4160db(0x8e)],_0x10d61a,_0x53418d),console[_0x4160db(0xf2)](_0x4160db(0x98)),console[_0x4160db(0xf2)](_0x4160db(0xb8),_0x10d61a[_0x4160db(0xa0)]),console['log'](_0x4160db(0xf0),_0x10d61a[_0x4160db(0x105)]),console['log'](_0x4160db(0x9e),_0x10d61a[_0x4160db(0xd6)]?.[_0x4160db(0x9f)]),console[_0x4160db(0xf2)](_0x4160db(0xf7),_0x10d61a['data']?.[_0x4160db(0x102)]),console['log'](_0x4160db(0xe8),_0x10d61a[_0x4160db(0xd6)]?.[_0x4160db(0x103)]);if(_0x10d61a['result']!==_0x4160db(0xf9)||_0x10d61a[_0x4160db(0x105)]!==0xc8){const _0x383814=_0x10d61a[_0x4160db(0xce)]||_0x4160db(0x90);console[_0x4160db(0xdf)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x4160db(0xdf)](_0x4160db(0xf6),_0x383814),loggerService_1[_0x4160db(0xa5)][_0x4160db(0xe6)](_0x4160db(0xe2),'/status',_0x4160db(0x108)+_0x383814);throw new Error(_0x4160db(0x9d)+_0x383814);}if(!_0x10d61a[_0x4160db(0xd6)]){console[_0x4160db(0xdf)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4160db(0xdf)](_0x4160db(0xd4)),loggerService_1[_0x4160db(0xa5)][_0x4160db(0xe6)](_0x4160db(0xe2),_0x4160db(0xda),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x4160db(0x106));}let _0x3f61e3=_0x4160db(0xbe);switch(_0x10d61a[_0x4160db(0xd6)][_0x4160db(0x9f)]?.['toLowerCase']()){case _0x4160db(0xec):_0x3f61e3=_0x4160db(0x10c);break;case _0x4160db(0x109):case _0x4160db(0xe7):case'error':_0x3f61e3=_0x4160db(0xf3);break;case'expired':case _0x4160db(0xea):_0x3f61e3=_0x4160db(0x8d);break;case'waiting':case'awaiting\x20fiat':case _0x4160db(0xa7):case _0x4160db(0xba):default:_0x3f61e3=_0x4160db(0xbe);break;}let _0x25dda2,_0x2e4fda;if(_0x10d61a[_0x4160db(0xd6)][_0x4160db(0x8f)]){const _0x3126c7=_0x10d61a['data'][_0x4160db(0x8f)];console[_0x4160db(0xf2)](_0x4160db(0xae),_0x3126c7);const _0xae6865=_0x3126c7[_0x4160db(0xbf)](/IBAN\s+([A-Z0-9]+)/i);_0xae6865&&(_0x25dda2=_0xae6865[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0x25dda2)),_0x2e4fda=_0x3126c7;}const _0x526901={'iban':_0x25dda2,'bankDetails':_0x2e4fda,'transactionId':_0x10d61a[_0x4160db(0xd6)][_0x4160db(0xb1)],'coinAddress':_0x10d61a[_0x4160db(0xd6)][_0x4160db(0xcc)],'qrCodeUrl':_0x10d61a[_0x4160db(0xd6)][_0x4160db(0xdd)],'expiryTime':_0x10d61a['data'][_0x4160db(0xb0)],'createdOn':_0x10d61a[_0x4160db(0xd6)][_0x4160db(0xcd)],'confirmedOn':_0x10d61a[_0x4160db(0xd6)][_0x4160db(0xcf)]};console[_0x4160db(0xf2)](_0x4160db(0xb5)),console[_0x4160db(0xf2)]('Status:',_0x10d61a['data']['Status'],'->',_0x3f61e3),console[_0x4160db(0xf2)]('Amount:',_0x10d61a['data'][_0x4160db(0x102)],_0x10d61a[_0x4160db(0xd6)][_0x4160db(0x103)]),console[_0x4160db(0xf2)](_0x4160db(0x92),_0x10d61a[_0x4160db(0xd6)][_0x4160db(0xb1)]),console[_0x4160db(0xf2)]('IBAN:',_0x25dda2||_0x4160db(0xff)),console[_0x4160db(0xf2)]('Created\x20On:',_0x10d61a[_0x4160db(0xd6)][_0x4160db(0xcd)]),console[_0x4160db(0xf2)](_0x4160db(0x8c),_0x10d61a['data'][_0x4160db(0xcf)]||_0x4160db(0x9b));if(_0x10d61a[_0x4160db(0xd6)][_0x4160db(0x9f)]?.[_0x4160db(0x104)]()===_0x4160db(0xc3))console['log'](_0x4160db(0xfd));else _0x10d61a[_0x4160db(0xd6)][_0x4160db(0x9f)]?.[_0x4160db(0x104)]()==='paid'&&console['log'](_0x4160db(0xad));return{'status':_0x3f61e3,'amount':parseFloat(_0x10d61a[_0x4160db(0xd6)][_0x4160db(0x102)])||undefined,'currency':_0x10d61a['data'][_0x4160db(0x103)]||_0x4160db(0x101),'paymentDetails':_0x526901};}catch(_0x28b978){console[_0x4160db(0xdf)](_0x4160db(0xab),_0x28b978),loggerService_1[_0x4160db(0xa5)][_0x4160db(0xe6)](_0x4160db(0xe2),_0x4160db(0xda),_0x28b978);throw new Error(_0x4160db(0x96)+(_0x28b978 instanceof Error?_0x28b978[_0x4160db(0xce)]:_0x4160db(0x10a)));}}async[a41_0x3c7555(0x10b)](_0x30301f){const _0x35490d=a41_0x3c7555,_0x2c42ee=await this[_0x35490d(0x9a)](_0x30301f);return{'status':_0x2c42ee[_0x35490d(0x8e)],'amount':_0x2c42ee[_0x35490d(0xed)],'currency':_0x2c42ee[_0x35490d(0xb7)]};}async['processWebhook'](_0x562c53){const _0x15fc04=a41_0x3c7555;console[_0x15fc04(0xf2)](_0x15fc04(0x8b),_0x562c53);let _0x2c677f='PENDING';switch(_0x562c53[_0x15fc04(0x8e)]?.[_0x15fc04(0x104)]()){case _0x15fc04(0xec):_0x2c677f=_0x15fc04(0x10c);break;case _0x15fc04(0x109):case'failed':case'error':_0x2c677f=_0x15fc04(0xf3);break;case'expired':case'timeout':_0x2c677f=_0x15fc04(0x8d);break;case'pending':case _0x15fc04(0xf5):case _0x15fc04(0xc3):case _0x15fc04(0xba):default:_0x2c677f=_0x15fc04(0xbe);break;}return{'paymentId':_0x562c53[_0x15fc04(0xc7)]||_0x562c53[_0x15fc04(0xde)]||'','status':_0x2c677f,'amount':_0x562c53[_0x15fc04(0xed)],'currency':_0x562c53[_0x15fc04(0xb7)]||_0x15fc04(0x101)};}}exports[a41_0x3c7555(0xf1)]=CoinToPayService;