'use strict';const a46_0x132ab9=a46_0x368a;(function(_0x5df711,_0x375383){const _0x1c46ff=a46_0x368a,_0x1824c0=_0x5df711();while(!![]){try{const _0x42b2fb=-parseInt(_0x1c46ff(0x116))/0x1*(-parseInt(_0x1c46ff(0xc0))/0x2)+parseInt(_0x1c46ff(0xe7))/0x3+parseInt(_0x1c46ff(0xd1))/0x4+-parseInt(_0x1c46ff(0xd2))/0x5+parseInt(_0x1c46ff(0x124))/0x6+-parseInt(_0x1c46ff(0x118))/0x7*(-parseInt(_0x1c46ff(0xc8))/0x8)+parseInt(_0x1c46ff(0xcf))/0x9*(-parseInt(_0x1c46ff(0x114))/0xa);if(_0x42b2fb===_0x375383)break;else _0x1824c0['push'](_0x1824c0['shift']());}catch(_0x1c5fb7){_0x1824c0['push'](_0x1824c0['shift']());}}}(a46_0x24dc,0x60c1f));function a46_0x368a(_0x473eb0,_0x44aad4){const _0x24dc4a=a46_0x24dc();return a46_0x368a=function(_0x368aa9,_0x54f31d){_0x368aa9=_0x368aa9-0xa0;let _0xf1ed17=_0x24dc4a[_0x368aa9];return _0xf1ed17;},a46_0x368a(_0x473eb0,_0x44aad4);}function a46_0x24dc(){const _0x108de7=['Response\x20Time:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','PENDING','JSON\x20Parse\x20Error:\x20','Payment\x20URL:','45uZnaUA','QRCodeURL','2572408AhjVsd','2505745nvmEtQ','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','CoinToPayService','Result:','now','stringify','cointopay','===\x20COINTOPAY\x20SUCCESS\x20===','application/json','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','/create','message','expired','timeout','\x20EUR','üè¶\x20Extracted\x20IBAN:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Created\x20On:','statusText','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','537924uXBibm','not\x20found','Parsed\x20Result:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','/status','===\x20COINTOPAY\x20API\x20ERROR\x20===','amount','entries','Incomplete\x20response:\x20missing\x20data','Request\x20Body:','error','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','verifyPayment','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','payment_url','HTTP\x20Status:','data','Headers:','Confirmed\x20On:','Gateway\x20Payment\x20ID:','Unknown\x20error','Raw\x20Response\x20Body:','cancelled','pending','apiUrl','paid','coinAddress','match','loggerService','parse','createPaymentLink','order_id','CoinToPay\x20API\x20error:\x20','Status:','currency','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','TransactionID','https://tesoft.uk/gateway/cointopay/status.php','Response\x20Body:','text','Amount:','Status\x20Text:','Error\x20stack:','TesSoft\x20Payment\x20System/1.0','CoinToPay\x20payment\x20status\x20check\x20error:','1034130hOUQmx','logWhiteDomainError','2oZCQgW','FAILED','63pHUPjk','checkPaymentStatus','result','gateway_payment_id','statusUrl','POST','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','PAID','logWhiteDomainResponse','Error\x20Message:','merchant_reference_id','928404UkyFse','Amount','üìä\x20Status\x20check\x20URL:','EUR','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===',',\x20body:\x20','üè¶\x20Payment\x20Detail:','Missing\x20data\x20in\x20response','PaymentDetail','Unknown\x20error\x20from\x20CoinToPay\x20API','Error\x20message:','created','Response\x20data:','CreatedOn','not\x20confirmed','logWhiteDomainRequest','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','URL:','https://tesoft.uk/gateway/cointopay/','Payment\x20Status:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','status','defineProperty','toLowerCase','headers','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','success','TransactionConfirmedOn','failed','log','inputCurrency','HTTP\x20error!\x20status:\x20','Status','EXPIRED','../loggerService','Currency:','405646DYftYg','CoinToPay\x20status\x20API\x20error:\x20','processWebhook','waiting','HTTP\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','awaiting\x20fiat','Failed\x20to\x20parse\x20JSON\x20response:','28216IJZarZ','status_code'];a46_0x24dc=function(){return _0x108de7;};return a46_0x24dc();}Object[a46_0x132ab9(0xb1)](exports,'__esModule',{'value':!![]}),exports[a46_0x132ab9(0xd4)]=void 0x0;const loggerService_1=require(a46_0x132ab9(0xbe));class CoinToPayService{constructor(){const _0x354f06=a46_0x132ab9;this[_0x354f06(0xff)]=_0x354f06(0xad),this[_0x354f06(0x11c)]=_0x354f06(0x10c),console[_0x354f06(0xb9)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x354f06(0xb9)](_0x354f06(0x126),this[_0x354f06(0x11c)]);}async[a46_0x132ab9(0x105)](_0x59bd0e){const _0x3a3c75=a46_0x132ab9,{orderId:_0xc900b0,amount:_0x4691d2}=_0x59bd0e;console[_0x3a3c75(0xb9)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x4691d2+_0x3a3c75(0xe0));const _0x5e1d26={'amount':_0x4691d2},_0x536d73=Date[_0x3a3c75(0xd6)]();try{console[_0x3a3c75(0xb9)](_0x3a3c75(0xc5)),console[_0x3a3c75(0xb9)](_0x3a3c75(0xac),this[_0x3a3c75(0xff)]),console[_0x3a3c75(0xb9)](_0x3a3c75(0xf0),JSON['stringify'](_0x5e1d26,null,0x2)),console[_0x3a3c75(0xb9)]('Amount:',_0x4691d2,_0x3a3c75(0xe2)),loggerService_1['loggerService'][_0x3a3c75(0xaa)]('cointopay',_0x3a3c75(0xdc),_0x3a3c75(0x11d),_0x5e1d26);const _0x58c85c=await fetch(this[_0x3a3c75(0xff)],{'method':_0x3a3c75(0x11d),'headers':{'Content-Type':_0x3a3c75(0xda),'Accept':_0x3a3c75(0xda),'User-Agent':_0x3a3c75(0x112)},'body':JSON[_0x3a3c75(0xd7)](_0x5e1d26)}),_0x3c0d26=Date[_0x3a3c75(0xd6)]()-_0x536d73;console[_0x3a3c75(0xb9)](_0x3a3c75(0x128)),console['log'](_0x3a3c75(0x108),_0x58c85c['status']),console[_0x3a3c75(0xb9)](_0x3a3c75(0x110),_0x58c85c[_0x3a3c75(0xe4)]),console['log'](_0x3a3c75(0xf8),Object['fromEntries'](_0x58c85c[_0x3a3c75(0xb3)][_0x3a3c75(0xee)]())),console['log'](_0x3a3c75(0xca),_0x3c0d26+'ms');const _0x534598=await _0x58c85c[_0x3a3c75(0x10e)]();console['log'](_0x3a3c75(0xfc),_0x534598);if(!_0x58c85c['ok']){console[_0x3a3c75(0xf1)](_0x3a3c75(0xec)),console[_0x3a3c75(0xf1)](_0x3a3c75(0xf6),_0x58c85c['status']),console[_0x3a3c75(0xf1)](_0x3a3c75(0x10d),_0x534598),loggerService_1[_0x3a3c75(0x103)][_0x3a3c75(0x121)]('cointopay',_0x3a3c75(0xdc),_0x58c85c[_0x3a3c75(0xb0)],_0x534598,_0x3c0d26),loggerService_1[_0x3a3c75(0x103)][_0x3a3c75(0x115)](_0x3a3c75(0xd8),_0x3a3c75(0xdc),_0x3a3c75(0xc4)+_0x58c85c['status']+':\x20'+_0x534598);throw new Error(_0x3a3c75(0xbb)+_0x58c85c[_0x3a3c75(0xb0)]+_0x3a3c75(0xa0)+_0x534598);}let _0x5d923b;try{_0x5d923b=JSON[_0x3a3c75(0x104)](_0x534598);}catch(_0x4db4df){console[_0x3a3c75(0xf1)](_0x3a3c75(0xc7),_0x4db4df),loggerService_1[_0x3a3c75(0x103)][_0x3a3c75(0x115)](_0x3a3c75(0xd8),_0x3a3c75(0xdc),_0x3a3c75(0xcd)+_0x4db4df);throw new Error(_0x3a3c75(0xe6)+_0x534598);}console[_0x3a3c75(0xb9)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x3a3c75(0xb9)](_0x3a3c75(0xe9),JSON['stringify'](_0x5d923b,null,0x2)),loggerService_1[_0x3a3c75(0x103)][_0x3a3c75(0x121)]('cointopay',_0x3a3c75(0xdc),_0x58c85c['status'],_0x5d923b,_0x3c0d26);if(_0x5d923b[_0x3a3c75(0xf1)]){const _0x5e639e=_0x5d923b['message']||_0x5d923b[_0x3a3c75(0xf1)]||_0x3a3c75(0xa4);console[_0x3a3c75(0xf1)](_0x3a3c75(0xb4)),console[_0x3a3c75(0xf1)]('Error\x20Message:',_0x5e639e),loggerService_1[_0x3a3c75(0x103)][_0x3a3c75(0x115)](_0x3a3c75(0xd8),_0x3a3c75(0xdc),'Business\x20Error:\x20'+_0x5e639e);throw new Error(_0x3a3c75(0x107)+_0x5e639e);}if(!_0x5d923b[_0x3a3c75(0xf5)]||!_0x5d923b[_0x3a3c75(0x11b)]){console[_0x3a3c75(0xf1)](_0x3a3c75(0xf2)),console[_0x3a3c75(0xf1)](_0x3a3c75(0xdb)),console[_0x3a3c75(0xf1)](_0x3a3c75(0xa7),_0x5d923b),loggerService_1[_0x3a3c75(0x103)]['logWhiteDomainError'](_0x3a3c75(0xd8),_0x3a3c75(0xdc),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x3a3c75(0xcb));}return console[_0x3a3c75(0xb9)](_0x3a3c75(0xd9)),console[_0x3a3c75(0xb9)](_0x3a3c75(0xfa),_0x5d923b[_0x3a3c75(0x11b)]),console[_0x3a3c75(0xb9)](_0x3a3c75(0xce),_0x5d923b[_0x3a3c75(0xf5)]),console[_0x3a3c75(0xb9)](_0x3a3c75(0x10f),_0x4691d2,_0x3a3c75(0x127)),{'gateway_payment_id':_0x5d923b['gateway_payment_id'],'payment_url':_0x5d923b[_0x3a3c75(0xf5)]};}catch(_0xae14a4){console[_0x3a3c75(0xf1)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x3a3c75(0xf1)]('Error\x20details:',_0xae14a4),loggerService_1[_0x3a3c75(0x103)]['logWhiteDomainError'](_0x3a3c75(0xd8),_0x3a3c75(0xdc),_0xae14a4);if(_0xae14a4 instanceof Error){console[_0x3a3c75(0xf1)](_0x3a3c75(0xa5),_0xae14a4[_0x3a3c75(0xdd)]),console['error'](_0x3a3c75(0x111),_0xae14a4['stack']);throw new Error(_0x3a3c75(0xe5)+_0xae14a4[_0x3a3c75(0xdd)]);}throw new Error(_0x3a3c75(0x10a));}}async[a46_0x132ab9(0x119)](_0x1d4087){const _0x310cf7=a46_0x132ab9,_0x1facc3=Date[_0x310cf7(0xd6)]();try{console[_0x310cf7(0xb9)](_0x310cf7(0x11e)+_0x1d4087);const _0x316d54={'gatewayPaymentId':_0x1d4087};loggerService_1['loggerService'][_0x310cf7(0xaa)](_0x310cf7(0xd8),_0x310cf7(0xeb),'POST',_0x316d54);const _0xa6ff20=await fetch(this[_0x310cf7(0x11c)],{'method':_0x310cf7(0x11d),'headers':{'Content-Type':_0x310cf7(0xda),'Accept':'application/json','User-Agent':_0x310cf7(0x112)},'body':JSON[_0x310cf7(0xd7)](_0x316d54)}),_0x2ee053=Date[_0x310cf7(0xd6)]()-_0x1facc3;console[_0x310cf7(0xb9)](_0x310cf7(0xf4)),console['log'](_0x310cf7(0x108),_0xa6ff20['status']),console[_0x310cf7(0xb9)](_0x310cf7(0xca),_0x2ee053+'ms');if(!_0xa6ff20['ok']){const _0x25c7c9=await _0xa6ff20[_0x310cf7(0x10e)]();console[_0x310cf7(0xf1)](_0x310cf7(0xf6),_0xa6ff20[_0x310cf7(0xb0)]),console[_0x310cf7(0xf1)]('Response\x20Body:',_0x25c7c9),loggerService_1[_0x310cf7(0x103)][_0x310cf7(0x121)](_0x310cf7(0xd8),_0x310cf7(0xeb),_0xa6ff20[_0x310cf7(0xb0)],_0x25c7c9,_0x2ee053),loggerService_1[_0x310cf7(0x103)]['logWhiteDomainError'](_0x310cf7(0xd8),'/status','HTTP\x20'+_0xa6ff20[_0x310cf7(0xb0)]+':\x20'+_0x25c7c9);throw new Error(_0x310cf7(0xbb)+_0xa6ff20['status']);}const _0x390f0d=await _0xa6ff20[_0x310cf7(0x10e)]();console[_0x310cf7(0xb9)](_0x310cf7(0xfc),_0x390f0d);let _0x227358;try{_0x227358=JSON[_0x310cf7(0x104)](_0x390f0d);}catch(_0x427360){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x427360),loggerService_1[_0x310cf7(0x103)][_0x310cf7(0x115)](_0x310cf7(0xd8),_0x310cf7(0xeb),'JSON\x20Parse\x20Error:\x20'+_0x427360);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x390f0d);}loggerService_1['loggerService'][_0x310cf7(0x121)](_0x310cf7(0xd8),_0x310cf7(0xeb),_0xa6ff20[_0x310cf7(0xb0)],_0x227358,_0x2ee053),console[_0x310cf7(0xb9)](_0x310cf7(0xaf)),console['log'](_0x310cf7(0xd5),_0x227358[_0x310cf7(0x11a)]),console[_0x310cf7(0xb9)]('Status\x20Code:',_0x227358['status_code']),console[_0x310cf7(0xb9)](_0x310cf7(0xae),_0x227358[_0x310cf7(0xf7)]?.['Status']),console[_0x310cf7(0xb9)]('Amount:',_0x227358[_0x310cf7(0xf7)]?.[_0x310cf7(0x125)]),console[_0x310cf7(0xb9)](_0x310cf7(0xbf),_0x227358[_0x310cf7(0xf7)]?.[_0x310cf7(0xba)]);if(_0x227358[_0x310cf7(0x11a)]!==_0x310cf7(0xb6)||_0x227358[_0x310cf7(0xc9)]!==0xc8){const _0x51e4b0=_0x227358[_0x310cf7(0xdd)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x310cf7(0xf1)](_0x310cf7(0xd3)),console[_0x310cf7(0xf1)](_0x310cf7(0x122),_0x51e4b0),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x310cf7(0xeb),'Status\x20API\x20Error:\x20'+_0x51e4b0);throw new Error(_0x310cf7(0xc1)+_0x51e4b0);}if(!_0x227358[_0x310cf7(0xf7)]){console[_0x310cf7(0xf1)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x310cf7(0xf1)](_0x310cf7(0xa2)),loggerService_1[_0x310cf7(0x103)][_0x310cf7(0x115)](_0x310cf7(0xd8),_0x310cf7(0xeb),_0x310cf7(0xef));throw new Error(_0x310cf7(0xb5));}let _0x45c43c=_0x310cf7(0xcc);switch(_0x227358[_0x310cf7(0xf7)][_0x310cf7(0xbc)]?.['toLowerCase']()){case'paid':_0x45c43c='PAID';break;case _0x310cf7(0xfd):case _0x310cf7(0xb8):case _0x310cf7(0xf1):_0x45c43c=_0x310cf7(0x117);break;case _0x310cf7(0xde):case _0x310cf7(0xdf):_0x45c43c=_0x310cf7(0xbd);break;case _0x310cf7(0xc3):case _0x310cf7(0xc6):case _0x310cf7(0xfe):case'created':default:_0x45c43c=_0x310cf7(0xcc);break;}let _0x5b932f,_0x39d334;if(_0x227358[_0x310cf7(0xf7)][_0x310cf7(0xa3)]){const _0x401745=_0x227358[_0x310cf7(0xf7)][_0x310cf7(0xa3)];console['log'](_0x310cf7(0xa1),_0x401745);const _0x5c5f21=_0x401745[_0x310cf7(0x102)](/IBAN\s+([A-Z0-9]+)/i);_0x5c5f21&&(_0x5b932f=_0x5c5f21[0x1],console[_0x310cf7(0xb9)](_0x310cf7(0xe1),_0x5b932f)),_0x39d334=_0x401745;}const _0x4d82b5={'iban':_0x5b932f,'bankDetails':_0x39d334,'transactionId':_0x227358[_0x310cf7(0xf7)]['TransactionID'],'coinAddress':_0x227358[_0x310cf7(0xf7)][_0x310cf7(0x101)],'qrCodeUrl':_0x227358['data'][_0x310cf7(0xd0)],'expiryTime':_0x227358['data']['ExpiryTime'],'createdOn':_0x227358[_0x310cf7(0xf7)][_0x310cf7(0xa8)],'confirmedOn':_0x227358[_0x310cf7(0xf7)][_0x310cf7(0xb7)]};console[_0x310cf7(0xb9)](_0x310cf7(0xab)),console[_0x310cf7(0xb9)](_0x310cf7(0x108),_0x227358[_0x310cf7(0xf7)]['Status'],'->',_0x45c43c),console['log'](_0x310cf7(0x10f),_0x227358[_0x310cf7(0xf7)][_0x310cf7(0x125)],_0x227358[_0x310cf7(0xf7)]['inputCurrency']),console['log']('Transaction\x20ID:',_0x227358[_0x310cf7(0xf7)][_0x310cf7(0x10b)]),console['log']('IBAN:',_0x5b932f||_0x310cf7(0xe8)),console[_0x310cf7(0xb9)](_0x310cf7(0xe3),_0x227358[_0x310cf7(0xf7)][_0x310cf7(0xa8)]),console['log'](_0x310cf7(0xf9),_0x227358[_0x310cf7(0xf7)][_0x310cf7(0xb7)]||_0x310cf7(0xa9));if(_0x227358[_0x310cf7(0xf7)][_0x310cf7(0xbc)]?.[_0x310cf7(0xb2)]()===_0x310cf7(0xc6))console[_0x310cf7(0xb9)](_0x310cf7(0x11f));else _0x227358[_0x310cf7(0xf7)][_0x310cf7(0xbc)]?.[_0x310cf7(0xb2)]()===_0x310cf7(0x100)&&console[_0x310cf7(0xb9)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x45c43c,'amount':parseFloat(_0x227358['data'][_0x310cf7(0x125)])||undefined,'currency':_0x227358[_0x310cf7(0xf7)][_0x310cf7(0xba)]||'EUR','paymentDetails':_0x4d82b5};}catch(_0x1c4470){console['error'](_0x310cf7(0x113),_0x1c4470),loggerService_1[_0x310cf7(0x103)][_0x310cf7(0x115)](_0x310cf7(0xd8),_0x310cf7(0xeb),_0x1c4470);throw new Error(_0x310cf7(0xea)+(_0x1c4470 instanceof Error?_0x1c4470['message']:_0x310cf7(0xfb)));}}async[a46_0x132ab9(0xf3)](_0x173241){const _0x179f3a=a46_0x132ab9,_0x38e242=await this[_0x179f3a(0x119)](_0x173241);return{'status':_0x38e242['status'],'amount':_0x38e242[_0x179f3a(0xed)],'currency':_0x38e242[_0x179f3a(0x109)]};}async[a46_0x132ab9(0xc2)](_0x569aeb){const _0x1cfa72=a46_0x132ab9;console[_0x1cfa72(0xb9)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x569aeb);let _0x21f9c2=_0x1cfa72(0xcc);switch(_0x569aeb[_0x1cfa72(0xb0)]?.['toLowerCase']()){case'paid':_0x21f9c2=_0x1cfa72(0x120);break;case _0x1cfa72(0xfd):case _0x1cfa72(0xb8):case'error':_0x21f9c2='FAILED';break;case _0x1cfa72(0xde):case _0x1cfa72(0xdf):_0x21f9c2=_0x1cfa72(0xbd);break;case _0x1cfa72(0xfe):case _0x1cfa72(0xc3):case _0x1cfa72(0xc6):case _0x1cfa72(0xa6):default:_0x21f9c2='PENDING';break;}return{'paymentId':_0x569aeb[_0x1cfa72(0x106)]||_0x569aeb[_0x1cfa72(0x123)]||'','status':_0x21f9c2,'amount':_0x569aeb[_0x1cfa72(0xed)],'currency':_0x569aeb[_0x1cfa72(0x109)]||_0x1cfa72(0x127)};}}exports[a46_0x132ab9(0xd4)]=CoinToPayService;