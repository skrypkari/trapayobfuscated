'use strict';const a38_0x15485e=a38_0xc8a4;(function(_0x4b73ee,_0x398716){const _0x4a779a=a38_0xc8a4,_0x46fbe1=_0x4b73ee();while(!![]){try{const _0x2e65e7=parseInt(_0x4a779a(0xde))/0x1+-parseInt(_0x4a779a(0xf7))/0x2+-parseInt(_0x4a779a(0x130))/0x3*(parseInt(_0x4a779a(0xdc))/0x4)+parseInt(_0x4a779a(0x140))/0x5*(-parseInt(_0x4a779a(0x12d))/0x6)+-parseInt(_0x4a779a(0x126))/0x7+parseInt(_0x4a779a(0xfa))/0x8+parseInt(_0x4a779a(0xe0))/0x9;if(_0x2e65e7===_0x398716)break;else _0x46fbe1['push'](_0x46fbe1['shift']());}catch(_0x4e5086){_0x46fbe1['push'](_0x46fbe1['shift']());}}}(a38_0x2014,0x8d788));Object[a38_0x15485e(0x105)](exports,'__esModule',{'value':!![]}),exports[a38_0x15485e(0xcf)]=void 0x0;function a38_0xc8a4(_0x396ae2,_0x69b071){const _0x201495=a38_0x2014();return a38_0xc8a4=function(_0xc8a425,_0x2e486f){_0xc8a425=_0xc8a425-0xbe;let _0x10a3a8=_0x201495[_0xc8a425];return _0x10a3a8;},a38_0xc8a4(_0x396ae2,_0x69b071);}const loggerService_1=require(a38_0x15485e(0x103));function a38_0x2014(){const _0x479203=['Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Response\x20data:','Error\x20details:','now','TesSoft\x20Payment\x20System/1.0','currency','Error\x20Message:','Amount','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','https://tesoft.uk/gateway/cointopay/','/create','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','application/json','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Error\x20stack:','Missing\x20data\x20in\x20response','pending','PaymentDetail','status','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','CoinToPay\x20API\x20error:\x20','959236zLrZba','üè¶\x20Extracted\x20IBAN:','stringify','8610272BeyqmP','Created\x20On:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','paid','error','text','===\x20COINTOPAY\x20API\x20ERROR\x20===','expired','entries','../loggerService','data','defineProperty','failed','message','created','order_id','parse','TransactionID','not\x20confirmed','Status:','Status\x20Code:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','logWhiteDomainError','logWhiteDomainResponse','not\x20found','log','POST','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','HTTP\x20error!\x20status:\x20','/status','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Raw\x20Response\x20Body:','Amount:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status\x20API\x20Error:\x20','Incomplete\x20response:\x20missing\x20data','payment_url','JSON\x20Parse\x20Error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','EUR','Payment\x20URL:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','2240973OHOcXl','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','HTTP\x20Status:','QRCodeURL','Response\x20Time:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','amount','6xYsKAy','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','toLowerCase','435129wGiuHD','Currency:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','merchant_reference_id','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','createPaymentLink','cointopay','Headers:','awaiting\x20fiat','IBAN:','EXPIRED','result','\x20EUR','loggerService','gateway_payment_id','4420545UTisha','Business\x20Error:\x20','üìä\x20Status\x20check\x20URL:','waiting','Status\x20Text:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','verifyPayment','Unknown\x20error',',\x20body:\x20','HTTP\x20','FAILED','logWhiteDomainRequest','TransactionConfirmedOn','checkPaymentStatus','success','fromEntries','Transaction\x20ID:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','CoinToPayService','status_code','statusUrl','Error\x20message:','apiUrl','CreatedOn','PENDING','Status','inputCurrency','ExpiryTime','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','28gLqMxg','cancelled','510125BFLcgd','statusText','15229998aVGhGL','üè¶\x20Payment\x20Detail:'];a38_0x2014=function(){return _0x479203;};return a38_0x2014();}class CoinToPayService{constructor(){const _0x2ed585=a38_0x15485e;this[_0x2ed585(0xd3)]=_0x2ed585(0xeb),this[_0x2ed585(0xd1)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x2ed585(0x114)](_0x2ed585(0x12b)),console['log'](_0x2ed585(0xbf),this[_0x2ed585(0xd1)]);}async[a38_0x15485e(0x136)](_0x42ed68){const _0x1917bf=a38_0x15485e,{orderId:_0xde8981,amount:_0x25738b}=_0x42ed68;console[_0x1917bf(0x114)](_0x1917bf(0x116)+_0x25738b+_0x1917bf(0x13d));const _0x32f47a={'amount':_0x25738b},_0x209a10=Date[_0x1917bf(0xe5)]();try{console[_0x1917bf(0x114)](_0x1917bf(0x119)),console[_0x1917bf(0x114)]('URL:',this[_0x1917bf(0xd3)]),console[_0x1917bf(0x114)]('Request\x20Body:',JSON[_0x1917bf(0xf9)](_0x32f47a,null,0x2)),console[_0x1917bf(0x114)]('Amount:',_0x25738b,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay',_0x1917bf(0xec),_0x1917bf(0x115),_0x32f47a);const _0x368b80=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x1917bf(0xee),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1917bf(0xf9)](_0x32f47a)}),_0x50fe63=Date[_0x1917bf(0xe5)]()-_0x209a10;console[_0x1917bf(0x114)](_0x1917bf(0x11c)),console[_0x1917bf(0x114)](_0x1917bf(0x10d),_0x368b80['status']),console[_0x1917bf(0x114)](_0x1917bf(0xc1),_0x368b80[_0x1917bf(0xdf)]),console[_0x1917bf(0x114)](_0x1917bf(0x138),Object[_0x1917bf(0xcc)](_0x368b80['headers'][_0x1917bf(0x102)]())),console[_0x1917bf(0x114)](_0x1917bf(0x12a),_0x50fe63+'ms');const _0x47170e=await _0x368b80['text']();console['log'](_0x1917bf(0x11a),_0x47170e);if(!_0x368b80['ok']){console[_0x1917bf(0xfe)](_0x1917bf(0x100)),console[_0x1917bf(0xfe)]('HTTP\x20Status:',_0x368b80[_0x1917bf(0xf4)]),console[_0x1917bf(0xfe)]('Response\x20Body:',_0x47170e),loggerService_1[_0x1917bf(0x13e)][_0x1917bf(0x112)](_0x1917bf(0x137),_0x1917bf(0xec),_0x368b80[_0x1917bf(0xf4)],_0x47170e,_0x50fe63),loggerService_1[_0x1917bf(0x13e)]['logWhiteDomainError']('cointopay',_0x1917bf(0xec),'HTTP\x20'+_0x368b80[_0x1917bf(0xf4)]+':\x20'+_0x47170e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x368b80[_0x1917bf(0xf4)]+_0x1917bf(0xc5)+_0x47170e);}let _0xb9d01f;try{_0xb9d01f=JSON[_0x1917bf(0x10a)](_0x47170e);}catch(_0x3bb690){console[_0x1917bf(0xfe)](_0x1917bf(0xda),_0x3bb690),loggerService_1[_0x1917bf(0x13e)][_0x1917bf(0x111)](_0x1917bf(0x137),_0x1917bf(0xec),'JSON\x20Parse\x20Error:\x20'+_0x3bb690);throw new Error(_0x1917bf(0xe2)+_0x47170e);}console[_0x1917bf(0x114)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console['log']('Parsed\x20Result:',JSON[_0x1917bf(0xf9)](_0xb9d01f,null,0x2)),loggerService_1[_0x1917bf(0x13e)][_0x1917bf(0x112)](_0x1917bf(0x137),_0x1917bf(0xec),_0x368b80[_0x1917bf(0xf4)],_0xb9d01f,_0x50fe63);if(_0xb9d01f['error']){const _0x4dc414=_0xb9d01f['message']||_0xb9d01f['error']||_0x1917bf(0x121);console[_0x1917bf(0xfe)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x1917bf(0xe8),_0x4dc414),loggerService_1[_0x1917bf(0x13e)][_0x1917bf(0x111)](_0x1917bf(0x137),_0x1917bf(0xec),_0x1917bf(0xbe)+_0x4dc414);throw new Error(_0x1917bf(0xf6)+_0x4dc414);}if(!_0xb9d01f[_0x1917bf(0x11f)]||!_0xb9d01f[_0x1917bf(0x13f)]){console[_0x1917bf(0xfe)](_0x1917bf(0x125)),console['error'](_0x1917bf(0x134)),console[_0x1917bf(0xfe)](_0x1917bf(0xe3),_0xb9d01f),loggerService_1[_0x1917bf(0x13e)][_0x1917bf(0x111)](_0x1917bf(0x137),_0x1917bf(0xec),_0x1917bf(0xea));throw new Error(_0x1917bf(0x135));}return console[_0x1917bf(0x114)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x1917bf(0x114)]('Gateway\x20Payment\x20ID:',_0xb9d01f[_0x1917bf(0x13f)]),console[_0x1917bf(0x114)](_0x1917bf(0x124),_0xb9d01f['payment_url']),console[_0x1917bf(0x114)]('Amount:',_0x25738b,_0x1917bf(0x123)),{'gateway_payment_id':_0xb9d01f[_0x1917bf(0x13f)],'payment_url':_0xb9d01f[_0x1917bf(0x11f)]};}catch(_0x39ea22){console[_0x1917bf(0xfe)](_0x1917bf(0xed)),console['error'](_0x1917bf(0xe4),_0x39ea22),loggerService_1[_0x1917bf(0x13e)][_0x1917bf(0x111)](_0x1917bf(0x137),'/create',_0x39ea22);if(_0x39ea22 instanceof Error){console[_0x1917bf(0xfe)](_0x1917bf(0xd2),_0x39ea22[_0x1917bf(0x107)]),console['error'](_0x1917bf(0xf0),_0x39ea22['stack']);throw new Error(_0x1917bf(0xf5)+_0x39ea22[_0x1917bf(0x107)]);}throw new Error(_0x1917bf(0x110));}}async[a38_0x15485e(0xca)](_0x33e6f7){const _0x1e3eff=a38_0x15485e,_0x4a9bbe=Date['now']();try{console[_0x1e3eff(0x114)](_0x1e3eff(0x12e)+_0x33e6f7);const _0x29a770={'gatewayPaymentId':_0x33e6f7};loggerService_1['loggerService'][_0x1e3eff(0xc8)](_0x1e3eff(0x137),_0x1e3eff(0x118),_0x1e3eff(0x115),_0x29a770);const _0xf2e957=await fetch(this[_0x1e3eff(0xd1)],{'method':'POST','headers':{'Content-Type':_0x1e3eff(0xee),'Accept':_0x1e3eff(0xee),'User-Agent':_0x1e3eff(0xe6)},'body':JSON[_0x1e3eff(0xf9)](_0x29a770)}),_0x228442=Date[_0x1e3eff(0xe5)]()-_0x4a9bbe;console[_0x1e3eff(0x114)](_0x1e3eff(0xef)),console[_0x1e3eff(0x114)](_0x1e3eff(0x10d),_0xf2e957[_0x1e3eff(0xf4)]),console[_0x1e3eff(0x114)](_0x1e3eff(0x12a),_0x228442+'ms');if(!_0xf2e957['ok']){const _0x11fe38=await _0xf2e957[_0x1e3eff(0xff)]();console['error'](_0x1e3eff(0x128),_0xf2e957['status']),console['error']('Response\x20Body:',_0x11fe38),loggerService_1['loggerService'][_0x1e3eff(0x112)](_0x1e3eff(0x137),_0x1e3eff(0x118),_0xf2e957[_0x1e3eff(0xf4)],_0x11fe38,_0x228442),loggerService_1['loggerService'][_0x1e3eff(0x111)]('cointopay',_0x1e3eff(0x118),_0x1e3eff(0xc6)+_0xf2e957[_0x1e3eff(0xf4)]+':\x20'+_0x11fe38);throw new Error(_0x1e3eff(0x117)+_0xf2e957[_0x1e3eff(0xf4)]);}const _0x241b06=await _0xf2e957['text']();console[_0x1e3eff(0x114)](_0x1e3eff(0x11a),_0x241b06);let _0x986706;try{_0x986706=JSON[_0x1e3eff(0x10a)](_0x241b06);}catch(_0x375815){console[_0x1e3eff(0xfe)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x375815),loggerService_1[_0x1e3eff(0x13e)][_0x1e3eff(0x111)](_0x1e3eff(0x137),'/status',_0x1e3eff(0x120)+_0x375815);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x241b06);}loggerService_1[_0x1e3eff(0x13e)]['logWhiteDomainResponse'](_0x1e3eff(0x137),_0x1e3eff(0x118),_0xf2e957[_0x1e3eff(0xf4)],_0x986706,_0x228442),console[_0x1e3eff(0x114)](_0x1e3eff(0x122)),console[_0x1e3eff(0x114)]('Result:',_0x986706[_0x1e3eff(0x13c)]),console[_0x1e3eff(0x114)](_0x1e3eff(0x10e),_0x986706[_0x1e3eff(0xd0)]),console[_0x1e3eff(0x114)]('Payment\x20Status:',_0x986706[_0x1e3eff(0x104)]?.[_0x1e3eff(0xd6)]),console[_0x1e3eff(0x114)](_0x1e3eff(0x11b),_0x986706['data']?.[_0x1e3eff(0xe9)]),console[_0x1e3eff(0x114)](_0x1e3eff(0x131),_0x986706['data']?.[_0x1e3eff(0xd7)]);if(_0x986706[_0x1e3eff(0x13c)]!==_0x1e3eff(0xcb)||_0x986706[_0x1e3eff(0xd0)]!==0xc8){const _0x42ffc0=_0x986706[_0x1e3eff(0x107)]||_0x1e3eff(0xd9);console[_0x1e3eff(0xfe)](_0x1e3eff(0x127)),console[_0x1e3eff(0xfe)](_0x1e3eff(0xe8),_0x42ffc0),loggerService_1[_0x1e3eff(0x13e)]['logWhiteDomainError'](_0x1e3eff(0x137),_0x1e3eff(0x118),_0x1e3eff(0x11d)+_0x42ffc0);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x42ffc0);}if(!_0x986706[_0x1e3eff(0x104)]){console[_0x1e3eff(0xfe)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1e3eff(0xfe)](_0x1e3eff(0xf1)),loggerService_1['loggerService'][_0x1e3eff(0x111)](_0x1e3eff(0x137),_0x1e3eff(0x118),_0x1e3eff(0x11e));throw new Error(_0x1e3eff(0xdb));}let _0x247039=_0x1e3eff(0xd5);switch(_0x986706[_0x1e3eff(0x104)][_0x1e3eff(0xd6)]?.['toLowerCase']()){case _0x1e3eff(0xfd):_0x247039='PAID';break;case _0x1e3eff(0xdd):case _0x1e3eff(0x106):case _0x1e3eff(0xfe):_0x247039=_0x1e3eff(0xc7);break;case _0x1e3eff(0x101):case'timeout':_0x247039=_0x1e3eff(0x13b);break;case'waiting':case _0x1e3eff(0x139):case _0x1e3eff(0xf2):case _0x1e3eff(0x108):default:_0x247039=_0x1e3eff(0xd5);break;}let _0x1f5727,_0x508ad0;if(_0x986706[_0x1e3eff(0x104)][_0x1e3eff(0xf3)]){const _0x3a70d4=_0x986706[_0x1e3eff(0x104)]['PaymentDetail'];console['log'](_0x1e3eff(0xe1),_0x3a70d4);const _0x10ffc6=_0x3a70d4['match'](/IBAN\s+([A-Z0-9]+)/i);_0x10ffc6&&(_0x1f5727=_0x10ffc6[0x1],console[_0x1e3eff(0x114)](_0x1e3eff(0xf8),_0x1f5727)),_0x508ad0=_0x3a70d4;}const _0x465f9d={'iban':_0x1f5727,'bankDetails':_0x508ad0,'transactionId':_0x986706['data']['TransactionID'],'coinAddress':_0x986706[_0x1e3eff(0x104)]['coinAddress'],'qrCodeUrl':_0x986706[_0x1e3eff(0x104)][_0x1e3eff(0x129)],'expiryTime':_0x986706[_0x1e3eff(0x104)][_0x1e3eff(0xd8)],'createdOn':_0x986706['data'][_0x1e3eff(0xd4)],'confirmedOn':_0x986706[_0x1e3eff(0x104)][_0x1e3eff(0xc9)]};console[_0x1e3eff(0x114)](_0x1e3eff(0xfc)),console[_0x1e3eff(0x114)](_0x1e3eff(0x10d),_0x986706[_0x1e3eff(0x104)][_0x1e3eff(0xd6)],'->',_0x247039),console[_0x1e3eff(0x114)](_0x1e3eff(0x11b),_0x986706[_0x1e3eff(0x104)][_0x1e3eff(0xe9)],_0x986706[_0x1e3eff(0x104)][_0x1e3eff(0xd7)]),console[_0x1e3eff(0x114)](_0x1e3eff(0xcd),_0x986706[_0x1e3eff(0x104)][_0x1e3eff(0x10b)]),console[_0x1e3eff(0x114)](_0x1e3eff(0x13a),_0x1f5727||_0x1e3eff(0x113)),console[_0x1e3eff(0x114)](_0x1e3eff(0xfb),_0x986706[_0x1e3eff(0x104)][_0x1e3eff(0xd4)]),console[_0x1e3eff(0x114)]('Confirmed\x20On:',_0x986706[_0x1e3eff(0x104)][_0x1e3eff(0xc9)]||_0x1e3eff(0x10c));if(_0x986706[_0x1e3eff(0x104)][_0x1e3eff(0xd6)]?.['toLowerCase']()===_0x1e3eff(0x139))console[_0x1e3eff(0x114)](_0x1e3eff(0xce));else _0x986706[_0x1e3eff(0x104)]['Status']?.[_0x1e3eff(0x12f)]()==='paid'&&console[_0x1e3eff(0x114)](_0x1e3eff(0x10f));return{'status':_0x247039,'amount':parseFloat(_0x986706['data']['Amount'])||undefined,'currency':_0x986706[_0x1e3eff(0x104)]['inputCurrency']||_0x1e3eff(0x123),'paymentDetails':_0x465f9d};}catch(_0x47e585){console[_0x1e3eff(0xfe)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x47e585),loggerService_1[_0x1e3eff(0x13e)]['logWhiteDomainError'](_0x1e3eff(0x137),_0x1e3eff(0x118),_0x47e585);throw new Error(_0x1e3eff(0x132)+(_0x47e585 instanceof Error?_0x47e585[_0x1e3eff(0x107)]:_0x1e3eff(0xc4)));}}async[a38_0x15485e(0xc3)](_0x1e35ef){const _0x20a1fb=a38_0x15485e,_0x18b5b2=await this[_0x20a1fb(0xca)](_0x1e35ef);return{'status':_0x18b5b2[_0x20a1fb(0xf4)],'amount':_0x18b5b2[_0x20a1fb(0x12c)],'currency':_0x18b5b2['currency']};}async['processWebhook'](_0x22c869){const _0x3f7a6d=a38_0x15485e;console[_0x3f7a6d(0x114)](_0x3f7a6d(0xc2),_0x22c869);let _0x313203=_0x3f7a6d(0xd5);switch(_0x22c869['status']?.[_0x3f7a6d(0x12f)]()){case _0x3f7a6d(0xfd):_0x313203='PAID';break;case _0x3f7a6d(0xdd):case _0x3f7a6d(0x106):case _0x3f7a6d(0xfe):_0x313203=_0x3f7a6d(0xc7);break;case _0x3f7a6d(0x101):case'timeout':_0x313203='EXPIRED';break;case _0x3f7a6d(0xf2):case _0x3f7a6d(0xc0):case _0x3f7a6d(0x139):case _0x3f7a6d(0x108):default:_0x313203='PENDING';break;}return{'paymentId':_0x22c869[_0x3f7a6d(0x109)]||_0x22c869[_0x3f7a6d(0x133)]||'','status':_0x313203,'amount':_0x22c869['amount'],'currency':_0x22c869[_0x3f7a6d(0xe7)]||_0x3f7a6d(0x123)};}}exports[a38_0x15485e(0xcf)]=CoinToPayService;