'use strict';const a47_0xbe293d=a47_0xdb0c;(function(_0x3e53ca,_0x41ad03){const _0x407145=a47_0xdb0c,_0x15aaf3=_0x3e53ca();while(!![]){try{const _0x525089=parseInt(_0x407145(0x1dd))/0x1*(parseInt(_0x407145(0x18b))/0x2)+-parseInt(_0x407145(0x18d))/0x3+-parseInt(_0x407145(0x1bf))/0x4*(parseInt(_0x407145(0x1f2))/0x5)+-parseInt(_0x407145(0x1d4))/0x6*(-parseInt(_0x407145(0x1aa))/0x7)+parseInt(_0x407145(0x1ee))/0x8+-parseInt(_0x407145(0x1f6))/0x9*(-parseInt(_0x407145(0x17d))/0xa)+-parseInt(_0x407145(0x1be))/0xb*(parseInt(_0x407145(0x1db))/0xc);if(_0x525089===_0x41ad03)break;else _0x15aaf3['push'](_0x15aaf3['shift']());}catch(_0x4c07c8){_0x15aaf3['push'](_0x15aaf3['shift']());}}}(a47_0x4858,0x872a1));function a47_0xdb0c(_0xa67fda,_0x3eda7c){const _0x485832=a47_0x4858();return a47_0xdb0c=function(_0xdb0c3b,_0x26dc10){_0xdb0c3b=_0xdb0c3b-0x173;let _0x448067=_0x485832[_0xdb0c3b];return _0x448067;},a47_0xdb0c(_0xa67fda,_0x3eda7c);}Object[a47_0xbe293d(0x1d6)](exports,a47_0xbe293d(0x1d7),{'value':!![]}),exports[a47_0xbe293d(0x1c4)]=void 0x0;const loggerService_1=require(a47_0xbe293d(0x1ba));class CoinToPayService{constructor(){const _0x35ed24=a47_0xbe293d;this[_0x35ed24(0x1a4)]=_0x35ed24(0x1cd),this[_0x35ed24(0x1c0)]=_0x35ed24(0x1a0),console[_0x35ed24(0x1d1)](_0x35ed24(0x1a5)),console[_0x35ed24(0x1d1)](_0x35ed24(0x1f0),this['statusUrl']);}async[a47_0xbe293d(0x1a3)](_0xb224d9){const _0x415357=a47_0xbe293d,{orderId:_0x4bdf7b,amount:_0x11c16a}=_0xb224d9;console[_0x415357(0x1d1)](_0x415357(0x1fd)+_0x11c16a+_0x415357(0x18e));const _0x514b2e={'amount':_0x11c16a},_0x540cc9=Date[_0x415357(0x1bd)]();try{console[_0x415357(0x1d1)](_0x415357(0x189)),console['log'](_0x415357(0x19f),this['apiUrl']),console[_0x415357(0x1d1)](_0x415357(0x1cf),JSON[_0x415357(0x1b4)](_0x514b2e,null,0x2)),console[_0x415357(0x1d1)](_0x415357(0x1f7),_0x11c16a,_0x415357(0x199)),loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay','/create',_0x415357(0x181),_0x514b2e);const _0x4664a5=await fetch(this['apiUrl'],{'method':_0x415357(0x181),'headers':{'Content-Type':'application/json','Accept':_0x415357(0x18a),'User-Agent':_0x415357(0x196)},'body':JSON[_0x415357(0x1b4)](_0x514b2e)}),_0x4afb52=Date[_0x415357(0x1bd)]()-_0x540cc9;console[_0x415357(0x1d1)](_0x415357(0x188)),console['log']('Status:',_0x4664a5[_0x415357(0x190)]),console['log'](_0x415357(0x1ec),_0x4664a5[_0x415357(0x1ab)]),console[_0x415357(0x1d1)](_0x415357(0x192),Object['fromEntries'](_0x4664a5['headers'][_0x415357(0x1f5)]())),console[_0x415357(0x1d1)](_0x415357(0x1c7),_0x4afb52+'ms');const _0x376c99=await _0x4664a5[_0x415357(0x180)]();console[_0x415357(0x1d1)](_0x415357(0x1ce),_0x376c99);if(!_0x4664a5['ok']){console[_0x415357(0x1d3)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x415357(0x178),_0x4664a5[_0x415357(0x190)]),console[_0x415357(0x1d3)]('Response\x20Body:',_0x376c99),loggerService_1['loggerService'][_0x415357(0x1ad)](_0x415357(0x1ca),_0x415357(0x1fa),_0x4664a5['status'],_0x376c99,_0x4afb52),loggerService_1[_0x415357(0x1f1)][_0x415357(0x1c5)](_0x415357(0x1ca),'/create','HTTP\x20'+_0x4664a5[_0x415357(0x190)]+':\x20'+_0x376c99);throw new Error(_0x415357(0x197)+_0x4664a5[_0x415357(0x190)]+_0x415357(0x1c2)+_0x376c99);}let _0x3d2e84;try{_0x3d2e84=JSON[_0x415357(0x187)](_0x376c99);}catch(_0x31a250){console['error'](_0x415357(0x1e8),_0x31a250),loggerService_1[_0x415357(0x1f1)][_0x415357(0x1c5)]('cointopay',_0x415357(0x1fa),_0x415357(0x176)+_0x31a250);throw new Error(_0x415357(0x1b5)+_0x376c99);}console[_0x415357(0x1d1)](_0x415357(0x1dc)),console[_0x415357(0x1d1)](_0x415357(0x173),JSON[_0x415357(0x1b4)](_0x3d2e84,null,0x2)),loggerService_1[_0x415357(0x1f1)][_0x415357(0x1ad)](_0x415357(0x1ca),_0x415357(0x1fa),_0x4664a5[_0x415357(0x190)],_0x3d2e84,_0x4afb52);if(_0x3d2e84[_0x415357(0x1d3)]){const _0x2a856f=_0x3d2e84['message']||_0x3d2e84['error']||_0x415357(0x17a);console[_0x415357(0x1d3)](_0x415357(0x1ea)),console[_0x415357(0x1d3)]('Error\x20Message:',_0x2a856f),loggerService_1['loggerService'][_0x415357(0x1c5)](_0x415357(0x1ca),_0x415357(0x1fa),'Business\x20Error:\x20'+_0x2a856f);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x2a856f);}if(!_0x3d2e84[_0x415357(0x1b9)]||!_0x3d2e84[_0x415357(0x1f3)]){console[_0x415357(0x1d3)](_0x415357(0x19e)),console['error'](_0x415357(0x1c1)),console[_0x415357(0x1d3)]('Response\x20data:',_0x3d2e84),loggerService_1[_0x415357(0x1f1)][_0x415357(0x1c5)]('cointopay',_0x415357(0x1fa),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x415357(0x1d1)](_0x415357(0x1f8)),console[_0x415357(0x1d1)](_0x415357(0x182),_0x3d2e84[_0x415357(0x1f3)]),console['log'](_0x415357(0x1b8),_0x3d2e84[_0x415357(0x1b9)]);const _0x2b5fc7=_0x3d2e84[_0x415357(0x1b9)]+_0x415357(0x198);return console[_0x415357(0x1d1)](_0x415357(0x1c6),_0x2b5fc7),console[_0x415357(0x1d1)]('Amount:',_0x11c16a,_0x415357(0x1a2)),{'gateway_payment_id':_0x3d2e84[_0x415357(0x1f3)],'payment_url':_0x2b5fc7};}catch(_0x25da3f){console[_0x415357(0x1d3)](_0x415357(0x19a)),console['error'](_0x415357(0x1d0),_0x25da3f),loggerService_1[_0x415357(0x1f1)]['logWhiteDomainError'](_0x415357(0x1ca),_0x415357(0x1fa),_0x25da3f);if(_0x25da3f instanceof Error){console[_0x415357(0x1d3)](_0x415357(0x1b7),_0x25da3f[_0x415357(0x1a9)]),console[_0x415357(0x1d3)](_0x415357(0x1b2),_0x25da3f[_0x415357(0x17c)]);throw new Error(_0x415357(0x191)+_0x25da3f[_0x415357(0x1a9)]);}throw new Error(_0x415357(0x1de));}}async[a47_0xbe293d(0x1d9)](_0x35bec4){const _0x409e48=a47_0xbe293d,_0x3c1985=Date[_0x409e48(0x1bd)]();try{console[_0x409e48(0x1d1)](_0x409e48(0x1ac)+_0x35bec4);const _0x1e40a4={'gatewayPaymentId':_0x35bec4};loggerService_1[_0x409e48(0x1f1)][_0x409e48(0x1cc)](_0x409e48(0x1ca),_0x409e48(0x183),_0x409e48(0x181),_0x1e40a4);const _0x307954=await fetch(this[_0x409e48(0x1c0)],{'method':_0x409e48(0x181),'headers':{'Content-Type':'application/json','Accept':_0x409e48(0x18a),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x409e48(0x1b4)](_0x1e40a4)}),_0x1dace3=Date[_0x409e48(0x1bd)]()-_0x3c1985;console[_0x409e48(0x1d1)](_0x409e48(0x1fc)),console['log'](_0x409e48(0x1a7),_0x307954['status']),console[_0x409e48(0x1d1)](_0x409e48(0x1c7),_0x1dace3+'ms');if(!_0x307954['ok']){const _0x23ec99=await _0x307954[_0x409e48(0x180)]();console['error'](_0x409e48(0x178),_0x307954['status']),console[_0x409e48(0x1d3)](_0x409e48(0x1a8),_0x23ec99),loggerService_1[_0x409e48(0x1f1)]['logWhiteDomainResponse'](_0x409e48(0x1ca),_0x409e48(0x183),_0x307954['status'],_0x23ec99,_0x1dace3),loggerService_1[_0x409e48(0x1f1)][_0x409e48(0x1c5)](_0x409e48(0x1ca),'/status',_0x409e48(0x1c8)+_0x307954[_0x409e48(0x190)]+':\x20'+_0x23ec99);throw new Error('HTTP\x20error!\x20status:\x20'+_0x307954[_0x409e48(0x190)]);}const _0x3f384e=await _0x307954['text']();console[_0x409e48(0x1d1)]('Raw\x20Response\x20Body:',_0x3f384e);let _0x2e637a;try{_0x2e637a=JSON[_0x409e48(0x187)](_0x3f384e);}catch(_0x3b169e){console['error'](_0x409e48(0x1e8),_0x3b169e),loggerService_1[_0x409e48(0x1f1)][_0x409e48(0x1c5)](_0x409e48(0x1ca),_0x409e48(0x183),_0x409e48(0x176)+_0x3b169e);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x3f384e);}loggerService_1[_0x409e48(0x1f1)]['logWhiteDomainResponse']('cointopay',_0x409e48(0x183),_0x307954[_0x409e48(0x190)],_0x2e637a,_0x1dace3),console[_0x409e48(0x1d1)](_0x409e48(0x1e3)),console[_0x409e48(0x1d1)](_0x409e48(0x19c),_0x2e637a[_0x409e48(0x1f9)]),console[_0x409e48(0x1d1)]('Status\x20Code:',_0x2e637a[_0x409e48(0x1bc)]),console[_0x409e48(0x1d1)](_0x409e48(0x179),_0x2e637a[_0x409e48(0x195)]?.[_0x409e48(0x1c9)]),console['log'](_0x409e48(0x1f7),_0x2e637a['data']?.[_0x409e48(0x18c)]),console[_0x409e48(0x1d1)]('Currency:',_0x2e637a['data']?.[_0x409e48(0x1e4)]);if(_0x2e637a[_0x409e48(0x1f9)]!=='success'||_0x2e637a[_0x409e48(0x1bc)]!==0xc8){const _0x141c61=_0x2e637a[_0x409e48(0x1a9)]||_0x409e48(0x19d);console[_0x409e48(0x1d3)](_0x409e48(0x193)),console['error'](_0x409e48(0x1a6),_0x141c61),loggerService_1[_0x409e48(0x1f1)][_0x409e48(0x1c5)]('cointopay',_0x409e48(0x183),'Status\x20API\x20Error:\x20'+_0x141c61);throw new Error(_0x409e48(0x1ae)+_0x141c61);}if(!_0x2e637a[_0x409e48(0x195)]){console[_0x409e48(0x1d3)](_0x409e48(0x1e2)),console['error'](_0x409e48(0x1ed)),loggerService_1[_0x409e48(0x1f1)][_0x409e48(0x1c5)](_0x409e48(0x1ca),_0x409e48(0x183),_0x409e48(0x1da));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x2b18f2=_0x409e48(0x185);switch(_0x2e637a[_0x409e48(0x195)][_0x409e48(0x1c9)]?.[_0x409e48(0x1e7)]()){case _0x409e48(0x1d5):_0x2b18f2=_0x409e48(0x19b);break;case _0x409e48(0x1cb):case _0x409e48(0x174):case _0x409e48(0x1d3):_0x2b18f2=_0x409e48(0x1e5);break;case _0x409e48(0x1e1):case _0x409e48(0x1c3):_0x2b18f2=_0x409e48(0x1e9);break;case _0x409e48(0x186):case'awaiting\x20fiat':case _0x409e48(0x1ef):case _0x409e48(0x1fb):default:_0x2b18f2='PENDING';break;}let _0x5d9de6,_0x235015;if(_0x2e637a[_0x409e48(0x195)][_0x409e48(0x1d8)]){const _0x1cfaa3=_0x2e637a['data'][_0x409e48(0x1d8)];console[_0x409e48(0x1d1)]('🏦\x20Payment\x20Detail:',_0x1cfaa3);const _0x81a3ed=_0x1cfaa3[_0x409e48(0x177)](/IBAN\s+([A-Z0-9]+)/i);_0x81a3ed&&(_0x5d9de6=_0x81a3ed[0x1],console[_0x409e48(0x1d1)](_0x409e48(0x1e0),_0x5d9de6)),_0x235015=_0x1cfaa3;}const _0xcb3bf2={'iban':_0x5d9de6,'bankDetails':_0x235015,'transactionId':_0x2e637a[_0x409e48(0x195)]['TransactionID'],'coinAddress':_0x2e637a[_0x409e48(0x195)]['coinAddress'],'qrCodeUrl':_0x2e637a['data'][_0x409e48(0x17e)],'expiryTime':_0x2e637a[_0x409e48(0x195)][_0x409e48(0x1b0)],'createdOn':_0x2e637a['data'][_0x409e48(0x1eb)],'confirmedOn':_0x2e637a[_0x409e48(0x195)][_0x409e48(0x1b3)]};console[_0x409e48(0x1d1)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console['log'](_0x409e48(0x1a7),_0x2e637a['data'][_0x409e48(0x1c9)],'->',_0x2b18f2),console[_0x409e48(0x1d1)](_0x409e48(0x1f7),_0x2e637a['data'][_0x409e48(0x18c)],_0x2e637a['data'][_0x409e48(0x1e4)]),console[_0x409e48(0x1d1)](_0x409e48(0x1e6),_0x2e637a['data'][_0x409e48(0x1d2)]),console[_0x409e48(0x1d1)]('IBAN:',_0x5d9de6||_0x409e48(0x1af)),console['log'](_0x409e48(0x184),_0x2e637a[_0x409e48(0x195)][_0x409e48(0x1eb)]),console[_0x409e48(0x1d1)]('Confirmed\x20On:',_0x2e637a[_0x409e48(0x195)]['TransactionConfirmedOn']||_0x409e48(0x1a1));if(_0x2e637a[_0x409e48(0x195)][_0x409e48(0x1c9)]?.[_0x409e48(0x1e7)]()===_0x409e48(0x18f))console[_0x409e48(0x1d1)](_0x409e48(0x194));else _0x2e637a[_0x409e48(0x195)][_0x409e48(0x1c9)]?.[_0x409e48(0x1e7)]()===_0x409e48(0x1d5)&&console['log'](_0x409e48(0x175));return{'status':_0x2b18f2,'amount':parseFloat(_0x2e637a[_0x409e48(0x195)][_0x409e48(0x18c)])||undefined,'currency':_0x2e637a[_0x409e48(0x195)]['inputCurrency']||_0x409e48(0x1a2),'paymentDetails':_0xcb3bf2};}catch(_0x31b7c8){console[_0x409e48(0x1d3)](_0x409e48(0x1b6),_0x31b7c8),loggerService_1['loggerService'][_0x409e48(0x1c5)](_0x409e48(0x1ca),'/status',_0x31b7c8);throw new Error(_0x409e48(0x1b1)+(_0x31b7c8 instanceof Error?_0x31b7c8['message']:_0x409e48(0x17f)));}}async[a47_0xbe293d(0x1f4)](_0x2ce017){const _0x112c6b=a47_0xbe293d,_0x3e92fb=await this[_0x112c6b(0x1d9)](_0x2ce017);return{'status':_0x3e92fb[_0x112c6b(0x190)],'amount':_0x3e92fb[_0x112c6b(0x1bb)],'currency':_0x3e92fb['currency']};}async[a47_0xbe293d(0x17b)](_0xbcf923){const _0x559031=a47_0xbe293d;console[_0x559031(0x1d1)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0xbcf923);let _0x5db314=_0x559031(0x185);switch(_0xbcf923['status']?.[_0x559031(0x1e7)]()){case _0x559031(0x1d5):_0x5db314=_0x559031(0x19b);break;case _0x559031(0x1cb):case _0x559031(0x174):case _0x559031(0x1d3):_0x5db314=_0x559031(0x1e5);break;case'expired':case _0x559031(0x1c3):_0x5db314=_0x559031(0x1e9);break;case _0x559031(0x1ef):case _0x559031(0x186):case _0x559031(0x18f):case _0x559031(0x1fb):default:_0x5db314=_0x559031(0x185);break;}return{'paymentId':_0xbcf923[_0x559031(0x1fe)]||_0xbcf923[_0x559031(0x1df)]||'','status':_0x5db314,'amount':_0xbcf923[_0x559031(0x1bb)],'currency':_0xbcf923['currency']||_0x559031(0x1a2)};}}function a47_0x4858(){const _0x5ab6a7=['CreatedOn','Status\x20Text:','Missing\x20data\x20in\x20response','4681248rjlLNw','pending','📊\x20Status\x20check\x20URL:','loggerService','19705giGxkD','gateway_payment_id','verifyPayment','entries','27qqmkbQ','Amount:','===\x20COINTOPAY\x20SUCCESS\x20===','result','/create','created','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','🪙\x20Creating\x20CoinToPay\x20payment:\x20','order_id','Parsed\x20Result:','failed','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','JSON\x20Parse\x20Error:\x20','match','HTTP\x20Status:','Payment\x20Status:','Unknown\x20error\x20from\x20CoinToPay\x20API','processWebhook','stack','14670tUlhsM','QRCodeURL','Unknown\x20error','text','POST','Gateway\x20Payment\x20ID:','/status','Created\x20On:','PENDING','waiting','parse','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','application/json','1448290VOUbnX','Amount','1549989vuXtbF','\x20EUR','awaiting\x20fiat','status','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Headers:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','data','Payment\x20System/1.0','HTTP\x20error!\x20status:\x20','&alternative=false','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','PAID','Result:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','URL:','https://tesoft.uk/gateway/cointopay/status.php','not\x20confirmed','EUR','createPaymentLink','apiUrl','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20Message:','Status:','Response\x20Body:','message','7317709VzLTUK','statusText','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','logWhiteDomainResponse','CoinToPay\x20status\x20API\x20error:\x20','not\x20found','ExpiryTime','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Error\x20stack:','TransactionConfirmedOn','stringify','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','Error\x20message:','Payment\x20URL\x20(original):','payment_url','../loggerService','amount','status_code','now','11kWrGBK','560zRGmqp','statusUrl','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response',',\x20body:\x20','timeout','CoinToPayService','logWhiteDomainError','Payment\x20URL\x20(modified):','Response\x20Time:','HTTP\x20','Status','cointopay','cancelled','logWhiteDomainRequest','https://tesoft.uk/gateway/cointopay/','Raw\x20Response\x20Body:','Request\x20Body:','Error\x20details:','log','TransactionID','error','6lCwiIk','paid','defineProperty','__esModule','PaymentDetail','checkPaymentStatus','Incomplete\x20response:\x20missing\x20data','8844636QMddXj','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','1BIUlPK','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','merchant_reference_id','🏦\x20Extracted\x20IBAN:','expired','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','inputCurrency','FAILED','Transaction\x20ID:','toLowerCase','Failed\x20to\x20parse\x20JSON\x20response:','EXPIRED','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='];a47_0x4858=function(){return _0x5ab6a7;};return a47_0x4858();}exports[a47_0xbe293d(0x1c4)]=CoinToPayService;