'use strict';function a38_0x4ff8(){const _0x138c7c=['1309875kjgwLh','\x20EUR','Error\x20stack:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Amount:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','timeout','logWhiteDomainResponse','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Response\x20Time:','inputCurrency','101050GGhJYs','message','expired','IBAN:','toLowerCase','checkPaymentStatus','createPaymentLink','Gateway\x20Payment\x20ID:','923155zBdJbv','POST','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','https://tesoft.uk/gateway/cointopay/status.php','cancelled','Error\x20Message:','headers','gateway_payment_id','statusText','ExpiryTime','application/json','8612eekRFU','===\x20COINTOPAY\x20SUCCESS\x20===','Status','parse','not\x20found','Status\x20Text:','HTTP\x20Status:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','HTTP\x20error!\x20status:\x20','status_code','üè¶\x20Extracted\x20IBAN:','https://tesoft.uk/gateway/cointopay/','coinAddress','TesSoft\x20Payment\x20System/1.0','CoinToPay\x20payment\x20status\x20check\x20error:','CoinToPay\x20API\x20error:\x20','currency','HTTP\x20','üìä\x20Status\x20check\x20URL:','amount','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','entries','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','cointopay','EUR','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','__esModule','stack','Status\x20API\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','TransactionID','waiting','failed','Incomplete\x20response:\x20missing\x20data','statusUrl','PAID','defineProperty','422040pDEmuR','CreatedOn','Currency:','awaiting\x20fiat',',\x20body:\x20','payment_url','Result:','Headers:','PaymentDetail','logWhiteDomainError','6vPxPzf','üè¶\x20Payment\x20Detail:','45848DdnDSj','Status:','apiUrl','now','/create','CoinToPay\x20status\x20API\x20error:\x20','779556lCxFku','Transaction\x20ID:','fromEntries','CoinToPayService','Business\x20Error:\x20','verifyPayment','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Unknown\x20error','error','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','status','TransactionConfirmedOn','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','text','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Payment\x20Status:','EXPIRED','PENDING','Missing\x20data\x20in\x20response','Payment\x20URL:','success','Response\x20Body:','JSON\x20Parse\x20Error:\x20','order_id','Error\x20details:','pending','Failed\x20to\x20parse\x20JSON\x20response:','loggerService','stringify','/status','data','URL:','not\x20confirmed','paid','Unknown\x20error\x20from\x20CoinToPay\x20API','FAILED','log','logWhiteDomainRequest','match','657DEHDum','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','created'];a38_0x4ff8=function(){return _0x138c7c;};return a38_0x4ff8();}const a38_0x5218e6=a38_0xca36;(function(_0xc8cfb2,_0x4f14ec){const _0x2f50c0=a38_0xca36,_0x347d1b=_0xc8cfb2();while(!![]){try{const _0x30ea69=parseInt(_0x2f50c0(0x20d))/0x1+-parseInt(_0x2f50c0(0x220))/0x2+-parseInt(_0x2f50c0(0x245))/0x3+parseInt(_0x2f50c0(0x257))/0x4+-parseInt(_0x2f50c0(0x215))/0x5*(-parseInt(_0x2f50c0(0x24f))/0x6)+parseInt(_0x2f50c0(0x201))/0x7+parseInt(_0x2f50c0(0x251))/0x8*(-parseInt(_0x2f50c0(0x1fc))/0x9);if(_0x30ea69===_0x4f14ec)break;else _0x347d1b['push'](_0x347d1b['shift']());}catch(_0x766625){_0x347d1b['push'](_0x347d1b['shift']());}}}(a38_0x4ff8,0x1979a));function a38_0xca36(_0x2b8467,_0x1a3fb6){const _0x4ff80e=a38_0x4ff8();return a38_0xca36=function(_0xca36aa,_0x9b1691){_0xca36aa=_0xca36aa-0x1de;let _0x47927c=_0x4ff80e[_0xca36aa];return _0x47927c;},a38_0xca36(_0x2b8467,_0x1a3fb6);}Object[a38_0x5218e6(0x244)](exports,a38_0x5218e6(0x23a),{'value':!![]}),exports[a38_0x5218e6(0x25a)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x56d1d4=a38_0x5218e6;this['apiUrl']=_0x56d1d4(0x22b),this['statusUrl']=_0x56d1d4(0x218),console[_0x56d1d4(0x1f9)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x56d1d4(0x1f9)](_0x56d1d4(0x232),this[_0x56d1d4(0x242)]);}async[a38_0x5218e6(0x213)](_0x24c0fe){const _0x1a7a3b=a38_0x5218e6,{orderId:_0x1e9195,amount:_0x194702}=_0x24c0fe;console['log'](_0x1a7a3b(0x205)+_0x194702+_0x1a7a3b(0x202));const _0x597c2d={'amount':_0x194702},_0x147506=Date['now']();try{console[_0x1a7a3b(0x1f9)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console['log'](_0x1a7a3b(0x1f4),this[_0x1a7a3b(0x253)]),console[_0x1a7a3b(0x1f9)]('Request\x20Body:',JSON[_0x1a7a3b(0x1f1)](_0x597c2d,null,0x2)),console['log'](_0x1a7a3b(0x206),_0x194702,_0x1a7a3b(0x204)),loggerService_1[_0x1a7a3b(0x1f0)][_0x1a7a3b(0x1fa)](_0x1a7a3b(0x237),_0x1a7a3b(0x255),_0x1a7a3b(0x216),_0x597c2d);const _0x1b158a=await fetch(this[_0x1a7a3b(0x253)],{'method':_0x1a7a3b(0x216),'headers':{'Content-Type':'application/json','Accept':_0x1a7a3b(0x21f),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x597c2d)}),_0x3eee21=Date[_0x1a7a3b(0x254)]()-_0x147506;console[_0x1a7a3b(0x1f9)](_0x1a7a3b(0x1df)),console[_0x1a7a3b(0x1f9)]('Status:',_0x1b158a[_0x1a7a3b(0x261)]),console[_0x1a7a3b(0x1f9)](_0x1a7a3b(0x225),_0x1b158a[_0x1a7a3b(0x21d)]),console[_0x1a7a3b(0x1f9)](_0x1a7a3b(0x24c),Object[_0x1a7a3b(0x259)](_0x1b158a[_0x1a7a3b(0x21b)][_0x1a7a3b(0x235)]())),console[_0x1a7a3b(0x1f9)](_0x1a7a3b(0x20b),_0x3eee21+'ms');const _0x11c31=await _0x1b158a['text']();console[_0x1a7a3b(0x1f9)]('Raw\x20Response\x20Body:',_0x11c31);if(!_0x1b158a['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x1a7a3b(0x226),_0x1b158a[_0x1a7a3b(0x261)]),console[_0x1a7a3b(0x25f)](_0x1a7a3b(0x1ea),_0x11c31),loggerService_1[_0x1a7a3b(0x1f0)][_0x1a7a3b(0x209)](_0x1a7a3b(0x237),'/create',_0x1b158a[_0x1a7a3b(0x261)],_0x11c31,_0x3eee21),loggerService_1[_0x1a7a3b(0x1f0)][_0x1a7a3b(0x24e)](_0x1a7a3b(0x237),_0x1a7a3b(0x255),_0x1a7a3b(0x231)+_0x1b158a[_0x1a7a3b(0x261)]+':\x20'+_0x11c31);throw new Error(_0x1a7a3b(0x228)+_0x1b158a[_0x1a7a3b(0x261)]+_0x1a7a3b(0x249)+_0x11c31);}let _0x24d2c2;try{_0x24d2c2=JSON[_0x1a7a3b(0x223)](_0x11c31);}catch(_0x253fb1){console[_0x1a7a3b(0x25f)](_0x1a7a3b(0x1ef),_0x253fb1),loggerService_1[_0x1a7a3b(0x1f0)][_0x1a7a3b(0x24e)](_0x1a7a3b(0x237),_0x1a7a3b(0x255),_0x1a7a3b(0x1eb)+_0x253fb1);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x11c31);}console['log'](_0x1a7a3b(0x227)),console[_0x1a7a3b(0x1f9)]('Parsed\x20Result:',JSON['stringify'](_0x24d2c2,null,0x2)),loggerService_1[_0x1a7a3b(0x1f0)]['logWhiteDomainResponse'](_0x1a7a3b(0x237),_0x1a7a3b(0x255),_0x1b158a[_0x1a7a3b(0x261)],_0x24d2c2,_0x3eee21);if(_0x24d2c2[_0x1a7a3b(0x25f)]){const _0x16d2e1=_0x24d2c2['message']||_0x24d2c2[_0x1a7a3b(0x25f)]||_0x1a7a3b(0x1f7);console[_0x1a7a3b(0x25f)](_0x1a7a3b(0x207)),console[_0x1a7a3b(0x25f)](_0x1a7a3b(0x21a),_0x16d2e1),loggerService_1[_0x1a7a3b(0x1f0)][_0x1a7a3b(0x24e)](_0x1a7a3b(0x237),_0x1a7a3b(0x255),_0x1a7a3b(0x25b)+_0x16d2e1);throw new Error(_0x1a7a3b(0x22f)+_0x16d2e1);}if(!_0x24d2c2[_0x1a7a3b(0x24a)]||!_0x24d2c2[_0x1a7a3b(0x21c)]){console[_0x1a7a3b(0x25f)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1a7a3b(0x25f)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x1a7a3b(0x25f)]('Response\x20data:',_0x24d2c2),loggerService_1[_0x1a7a3b(0x1f0)]['logWhiteDomainError'](_0x1a7a3b(0x237),'/create',_0x1a7a3b(0x236));throw new Error(_0x1a7a3b(0x1e3));}return console[_0x1a7a3b(0x1f9)](_0x1a7a3b(0x221)),console[_0x1a7a3b(0x1f9)](_0x1a7a3b(0x214),_0x24d2c2[_0x1a7a3b(0x21c)]),console[_0x1a7a3b(0x1f9)](_0x1a7a3b(0x1e8),_0x24d2c2[_0x1a7a3b(0x24a)]),console[_0x1a7a3b(0x1f9)]('Amount:',_0x194702,_0x1a7a3b(0x238)),{'gateway_payment_id':_0x24d2c2[_0x1a7a3b(0x21c)],'payment_url':_0x24d2c2[_0x1a7a3b(0x24a)]};}catch(_0x586d54){console[_0x1a7a3b(0x25f)](_0x1a7a3b(0x234)),console[_0x1a7a3b(0x25f)](_0x1a7a3b(0x1ed),_0x586d54),loggerService_1[_0x1a7a3b(0x1f0)][_0x1a7a3b(0x24e)](_0x1a7a3b(0x237),_0x1a7a3b(0x255),_0x586d54);if(_0x586d54 instanceof Error){console[_0x1a7a3b(0x25f)]('Error\x20message:',_0x586d54['message']),console['error'](_0x1a7a3b(0x203),_0x586d54[_0x1a7a3b(0x23b)]);throw new Error(_0x1a7a3b(0x1e1)+_0x586d54[_0x1a7a3b(0x20e)]);}throw new Error(_0x1a7a3b(0x1fd));}}async[a38_0x5218e6(0x212)](_0x3e4c88){const _0x1af8ec=a38_0x5218e6,_0x423eda=Date[_0x1af8ec(0x254)]();try{console[_0x1af8ec(0x1f9)](_0x1af8ec(0x1ff)+_0x3e4c88);const _0x1103e2={'gatewayPaymentId':_0x3e4c88};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x1af8ec(0x237),_0x1af8ec(0x1f2),_0x1af8ec(0x216),_0x1103e2);const _0x21c1a1=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0x1af8ec(0x21f),'Accept':_0x1af8ec(0x21f),'User-Agent':_0x1af8ec(0x22d)},'body':JSON['stringify'](_0x1103e2)}),_0x1c6865=Date[_0x1af8ec(0x254)]()-_0x423eda;console['log'](_0x1af8ec(0x1e0)),console['log'](_0x1af8ec(0x252),_0x21c1a1[_0x1af8ec(0x261)]),console[_0x1af8ec(0x1f9)](_0x1af8ec(0x20b),_0x1c6865+'ms');if(!_0x21c1a1['ok']){const _0xdeda72=await _0x21c1a1[_0x1af8ec(0x1e2)]();console[_0x1af8ec(0x25f)](_0x1af8ec(0x226),_0x21c1a1[_0x1af8ec(0x261)]),console['error']('Response\x20Body:',_0xdeda72),loggerService_1[_0x1af8ec(0x1f0)][_0x1af8ec(0x209)](_0x1af8ec(0x237),'/status',_0x21c1a1[_0x1af8ec(0x261)],_0xdeda72,_0x1c6865),loggerService_1[_0x1af8ec(0x1f0)][_0x1af8ec(0x24e)](_0x1af8ec(0x237),_0x1af8ec(0x1f2),_0x1af8ec(0x231)+_0x21c1a1[_0x1af8ec(0x261)]+':\x20'+_0xdeda72);throw new Error(_0x1af8ec(0x228)+_0x21c1a1[_0x1af8ec(0x261)]);}const _0x145770=await _0x21c1a1[_0x1af8ec(0x1e2)]();console[_0x1af8ec(0x1f9)]('Raw\x20Response\x20Body:',_0x145770);let _0x580d37;try{_0x580d37=JSON['parse'](_0x145770);}catch(_0x16386c){console[_0x1af8ec(0x25f)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x16386c),loggerService_1[_0x1af8ec(0x1f0)]['logWhiteDomainError']('cointopay','/status',_0x1af8ec(0x1eb)+_0x16386c);throw new Error(_0x1af8ec(0x239)+_0x145770);}loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1af8ec(0x237),_0x1af8ec(0x1f2),_0x21c1a1[_0x1af8ec(0x261)],_0x580d37,_0x1c6865),console[_0x1af8ec(0x1f9)](_0x1af8ec(0x1fe)),console[_0x1af8ec(0x1f9)](_0x1af8ec(0x24b),_0x580d37['result']),console[_0x1af8ec(0x1f9)]('Status\x20Code:',_0x580d37[_0x1af8ec(0x229)]),console[_0x1af8ec(0x1f9)](_0x1af8ec(0x1e4),_0x580d37[_0x1af8ec(0x1f3)]?.[_0x1af8ec(0x222)]),console[_0x1af8ec(0x1f9)](_0x1af8ec(0x206),_0x580d37[_0x1af8ec(0x1f3)]?.['Amount']),console[_0x1af8ec(0x1f9)](_0x1af8ec(0x247),_0x580d37[_0x1af8ec(0x1f3)]?.['inputCurrency']);if(_0x580d37['result']!==_0x1af8ec(0x1e9)||_0x580d37[_0x1af8ec(0x229)]!==0xc8){const _0x1c6e67=_0x580d37[_0x1af8ec(0x20e)]||_0x1af8ec(0x20a);console[_0x1af8ec(0x25f)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error'](_0x1af8ec(0x21a),_0x1c6e67),loggerService_1[_0x1af8ec(0x1f0)][_0x1af8ec(0x24e)]('cointopay',_0x1af8ec(0x1f2),_0x1af8ec(0x23c)+_0x1c6e67);throw new Error(_0x1af8ec(0x256)+_0x1c6e67);}if(!_0x580d37['data']){console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1af8ec(0x25f)](_0x1af8ec(0x1e7)),loggerService_1['loggerService'][_0x1af8ec(0x24e)](_0x1af8ec(0x237),_0x1af8ec(0x1f2),_0x1af8ec(0x241));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x43dc58=_0x1af8ec(0x1e6);switch(_0x580d37[_0x1af8ec(0x1f3)][_0x1af8ec(0x222)]?.[_0x1af8ec(0x211)]()){case _0x1af8ec(0x1f6):_0x43dc58=_0x1af8ec(0x243);break;case _0x1af8ec(0x219):case _0x1af8ec(0x240):case _0x1af8ec(0x25f):_0x43dc58=_0x1af8ec(0x1f8);break;case _0x1af8ec(0x20f):case _0x1af8ec(0x208):_0x43dc58='EXPIRED';break;case'waiting':case _0x1af8ec(0x248):case _0x1af8ec(0x1ee):case _0x1af8ec(0x200):default:_0x43dc58=_0x1af8ec(0x1e6);break;}let _0x14ac34,_0x4fd5d4;if(_0x580d37['data'][_0x1af8ec(0x24d)]){const _0x1e2a95=_0x580d37[_0x1af8ec(0x1f3)]['PaymentDetail'];console['log'](_0x1af8ec(0x250),_0x1e2a95);const _0x240484=_0x1e2a95[_0x1af8ec(0x1fb)](/IBAN\s+([A-Z0-9]+)/i);_0x240484&&(_0x14ac34=_0x240484[0x1],console[_0x1af8ec(0x1f9)](_0x1af8ec(0x22a),_0x14ac34)),_0x4fd5d4=_0x1e2a95;}const _0x5a6a45={'iban':_0x14ac34,'bankDetails':_0x4fd5d4,'transactionId':_0x580d37[_0x1af8ec(0x1f3)][_0x1af8ec(0x23e)],'coinAddress':_0x580d37[_0x1af8ec(0x1f3)][_0x1af8ec(0x22c)],'qrCodeUrl':_0x580d37[_0x1af8ec(0x1f3)]['QRCodeURL'],'expiryTime':_0x580d37[_0x1af8ec(0x1f3)][_0x1af8ec(0x21e)],'createdOn':_0x580d37[_0x1af8ec(0x1f3)][_0x1af8ec(0x246)],'confirmedOn':_0x580d37[_0x1af8ec(0x1f3)][_0x1af8ec(0x1de)]};console[_0x1af8ec(0x1f9)](_0x1af8ec(0x23d)),console[_0x1af8ec(0x1f9)](_0x1af8ec(0x252),_0x580d37[_0x1af8ec(0x1f3)][_0x1af8ec(0x222)],'->',_0x43dc58),console['log']('Amount:',_0x580d37[_0x1af8ec(0x1f3)]['Amount'],_0x580d37[_0x1af8ec(0x1f3)][_0x1af8ec(0x20c)]),console[_0x1af8ec(0x1f9)](_0x1af8ec(0x258),_0x580d37[_0x1af8ec(0x1f3)]['TransactionID']),console[_0x1af8ec(0x1f9)](_0x1af8ec(0x210),_0x14ac34||_0x1af8ec(0x224)),console['log']('Created\x20On:',_0x580d37[_0x1af8ec(0x1f3)]['CreatedOn']),console[_0x1af8ec(0x1f9)]('Confirmed\x20On:',_0x580d37['data'][_0x1af8ec(0x1de)]||_0x1af8ec(0x1f5));if(_0x580d37[_0x1af8ec(0x1f3)][_0x1af8ec(0x222)]?.[_0x1af8ec(0x211)]()==='awaiting\x20fiat')console['log'](_0x1af8ec(0x25d));else _0x580d37[_0x1af8ec(0x1f3)][_0x1af8ec(0x222)]?.[_0x1af8ec(0x211)]()==='paid'&&console['log'](_0x1af8ec(0x217));return{'status':_0x43dc58,'amount':parseFloat(_0x580d37['data']['Amount'])||undefined,'currency':_0x580d37[_0x1af8ec(0x1f3)][_0x1af8ec(0x20c)]||_0x1af8ec(0x238),'paymentDetails':_0x5a6a45};}catch(_0x415779){console[_0x1af8ec(0x25f)](_0x1af8ec(0x22e),_0x415779),loggerService_1[_0x1af8ec(0x1f0)][_0x1af8ec(0x24e)](_0x1af8ec(0x237),'/status',_0x415779);throw new Error(_0x1af8ec(0x260)+(_0x415779 instanceof Error?_0x415779[_0x1af8ec(0x20e)]:_0x1af8ec(0x25e)));}}async[a38_0x5218e6(0x25c)](_0x32d59c){const _0xbcfbfc=a38_0x5218e6,_0x493f35=await this[_0xbcfbfc(0x212)](_0x32d59c);return{'status':_0x493f35['status'],'amount':_0x493f35[_0xbcfbfc(0x233)],'currency':_0x493f35['currency']};}async['processWebhook'](_0xf522a7){const _0x26dd87=a38_0x5218e6;console['log']('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0xf522a7);let _0xf9fc64=_0x26dd87(0x1e6);switch(_0xf522a7['status']?.[_0x26dd87(0x211)]()){case _0x26dd87(0x1f6):_0xf9fc64=_0x26dd87(0x243);break;case _0x26dd87(0x219):case'failed':case _0x26dd87(0x25f):_0xf9fc64=_0x26dd87(0x1f8);break;case _0x26dd87(0x20f):case _0x26dd87(0x208):_0xf9fc64=_0x26dd87(0x1e5);break;case _0x26dd87(0x1ee):case _0x26dd87(0x23f):case _0x26dd87(0x248):case _0x26dd87(0x200):default:_0xf9fc64=_0x26dd87(0x1e6);break;}return{'paymentId':_0xf522a7[_0x26dd87(0x1ec)]||_0xf522a7['merchant_reference_id']||'','status':_0xf9fc64,'amount':_0xf522a7[_0x26dd87(0x233)],'currency':_0xf522a7[_0x26dd87(0x230)]||'EUR'};}}exports[a38_0x5218e6(0x25a)]=CoinToPayService;