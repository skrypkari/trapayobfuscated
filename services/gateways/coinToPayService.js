'use strict';const a55_0x377109=a55_0x3d97;function a55_0x3d97(_0x5ee37f,_0x177e66){_0x5ee37f=_0x5ee37f-0x137;const _0x18bc53=a55_0x18bc();let _0x3d97f=_0x18bc53[_0x5ee37f];return _0x3d97f;}(function(_0x501d76,_0x20794a){const _0x449a7f=a55_0x3d97,_0xeb37fb=_0x501d76();while(!![]){try{const _0x33f47f=-parseInt(_0x449a7f(0x153))/0x1+parseInt(_0x449a7f(0x190))/0x2+-parseInt(_0x449a7f(0x184))/0x3+parseInt(_0x449a7f(0x177))/0x4*(-parseInt(_0x449a7f(0x1a8))/0x5)+-parseInt(_0x449a7f(0x166))/0x6*(-parseInt(_0x449a7f(0x175))/0x7)+parseInt(_0x449a7f(0x1c4))/0x8*(-parseInt(_0x449a7f(0x199))/0x9)+parseInt(_0x449a7f(0x161))/0xa*(parseInt(_0x449a7f(0x13e))/0xb);if(_0x33f47f===_0x20794a)break;else _0xeb37fb['push'](_0xeb37fb['shift']());}catch(_0x3a7489){_0xeb37fb['push'](_0xeb37fb['shift']());}}}(a55_0x18bc,0x3b76b));Object[a55_0x377109(0x1ba)](exports,'__esModule',{'value':!![]}),exports[a55_0x377109(0x1be)]=void 0x0;const loggerService_1=require(a55_0x377109(0x159));class CoinToPayService{constructor(){const _0x1fa754=a55_0x377109;this['apiUrl']=_0x1fa754(0x149),this['statusUrl']=_0x1fa754(0x1c3),console[_0x1fa754(0x1a6)](_0x1fa754(0x186)),console[_0x1fa754(0x1a6)](_0x1fa754(0x196),this[_0x1fa754(0x164)]);}async[a55_0x377109(0x192)](_0xe9315f){const _0x4f7666=a55_0x377109,{orderId:_0x2a2e08,amount:_0x3b4e4f}=_0xe9315f;console[_0x4f7666(0x1a6)](_0x4f7666(0x1b4)+_0x3b4e4f+_0x4f7666(0x173));const _0x29392d={'amount':_0x3b4e4f},_0x20c1e9=Date[_0x4f7666(0x191)]();try{console[_0x4f7666(0x1a6)](_0x4f7666(0x1b0)),console['log'](_0x4f7666(0x163),this[_0x4f7666(0x1c2)]),console[_0x4f7666(0x1a6)](_0x4f7666(0x13b),JSON[_0x4f7666(0x1bb)](_0x29392d,null,0x2)),console[_0x4f7666(0x1a6)](_0x4f7666(0x18e),_0x3b4e4f,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x4f7666(0x143)][_0x4f7666(0x15e)](_0x4f7666(0x1aa),'/create','POST',_0x29392d);const _0x28d07e=await fetch(this['apiUrl'],{'method':_0x4f7666(0x145),'headers':{'Content-Type':_0x4f7666(0x18a),'Accept':_0x4f7666(0x18a),'User-Agent':_0x4f7666(0x19e)},'body':JSON[_0x4f7666(0x1bb)](_0x29392d)}),_0x4d7e03=Date['now']()-_0x20c1e9;console[_0x4f7666(0x1a6)](_0x4f7666(0x198)),console['log'](_0x4f7666(0x16e),_0x28d07e['status']),console['log'](_0x4f7666(0x1ac),_0x28d07e[_0x4f7666(0x16c)]),console['log'](_0x4f7666(0x15a),Object['fromEntries'](_0x28d07e['headers'][_0x4f7666(0x188)]())),console[_0x4f7666(0x1a6)](_0x4f7666(0x1a0),_0x4d7e03+'ms');const _0x2ec763=await _0x28d07e[_0x4f7666(0x17e)]();console[_0x4f7666(0x1a6)](_0x4f7666(0x17c),_0x2ec763);if(!_0x28d07e['ok']){console[_0x4f7666(0x16f)](_0x4f7666(0x1b6)),console[_0x4f7666(0x16f)](_0x4f7666(0x181),_0x28d07e[_0x4f7666(0x1c1)]),console[_0x4f7666(0x16f)](_0x4f7666(0x1ae),_0x2ec763),loggerService_1['loggerService'][_0x4f7666(0x170)](_0x4f7666(0x1aa),_0x4f7666(0x183),_0x28d07e[_0x4f7666(0x1c1)],_0x2ec763,_0x4d7e03),loggerService_1['loggerService'][_0x4f7666(0x180)](_0x4f7666(0x1aa),'/create',_0x4f7666(0x169)+_0x28d07e[_0x4f7666(0x1c1)]+':\x20'+_0x2ec763);throw new Error(_0x4f7666(0x187)+_0x28d07e['status']+_0x4f7666(0x146)+_0x2ec763);}let _0x2d9181;try{_0x2d9181=JSON[_0x4f7666(0x155)](_0x2ec763);}catch(_0x1ff099){console[_0x4f7666(0x16f)](_0x4f7666(0x1ab),_0x1ff099),loggerService_1[_0x4f7666(0x143)][_0x4f7666(0x180)](_0x4f7666(0x1aa),'/create',_0x4f7666(0x165)+_0x1ff099);throw new Error(_0x4f7666(0x14e)+_0x2ec763);}console[_0x4f7666(0x1a6)](_0x4f7666(0x14f)),console['log'](_0x4f7666(0x15c),JSON[_0x4f7666(0x1bb)](_0x2d9181,null,0x2)),loggerService_1['loggerService'][_0x4f7666(0x170)](_0x4f7666(0x1aa),_0x4f7666(0x183),_0x28d07e[_0x4f7666(0x1c1)],_0x2d9181,_0x4d7e03);if(_0x2d9181[_0x4f7666(0x16f)]){const _0xd6712e=_0x2d9181['message']||_0x2d9181[_0x4f7666(0x16f)]||_0x4f7666(0x14a);console['error'](_0x4f7666(0x16a)),console[_0x4f7666(0x16f)](_0x4f7666(0x19d),_0xd6712e),loggerService_1['loggerService'][_0x4f7666(0x180)]('cointopay',_0x4f7666(0x183),_0x4f7666(0x158)+_0xd6712e);throw new Error(_0x4f7666(0x197)+_0xd6712e);}if(!_0x2d9181[_0x4f7666(0x15b)]||!_0x2d9181[_0x4f7666(0x182)]){console[_0x4f7666(0x16f)](_0x4f7666(0x1b5)),console[_0x4f7666(0x16f)](_0x4f7666(0x1a1)),console[_0x4f7666(0x16f)](_0x4f7666(0x1a5),_0x2d9181),loggerService_1[_0x4f7666(0x143)][_0x4f7666(0x180)](_0x4f7666(0x1aa),_0x4f7666(0x183),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x4f7666(0x13d));}console[_0x4f7666(0x1a6)](_0x4f7666(0x19a)),console[_0x4f7666(0x1a6)]('Gateway\x20Payment\x20ID:',_0x2d9181[_0x4f7666(0x182)]),console[_0x4f7666(0x1a6)](_0x4f7666(0x179),_0x2d9181[_0x4f7666(0x15b)]);const _0x2174a1=_0x2d9181['payment_url']+'&alternative=false';return console['log']('Payment\x20URL\x20(modified):',_0x2174a1),console[_0x4f7666(0x1a6)](_0x4f7666(0x18e),_0x3b4e4f,_0x4f7666(0x142)),{'gateway_payment_id':_0x2d9181[_0x4f7666(0x182)],'payment_url':_0x2174a1};}catch(_0x55830f){console[_0x4f7666(0x16f)](_0x4f7666(0x19c)),console[_0x4f7666(0x16f)](_0x4f7666(0x17d),_0x55830f),loggerService_1[_0x4f7666(0x143)]['logWhiteDomainError']('cointopay',_0x4f7666(0x183),_0x55830f);if(_0x55830f instanceof Error){console['error'](_0x4f7666(0x172),_0x55830f[_0x4f7666(0x185)]),console[_0x4f7666(0x16f)](_0x4f7666(0x195),_0x55830f[_0x4f7666(0x1af)]);throw new Error(_0x4f7666(0x140)+_0x55830f[_0x4f7666(0x185)]);}throw new Error(_0x4f7666(0x19b));}}async[a55_0x377109(0x16d)](_0x433503){const _0x28adb3=a55_0x377109,_0x428207=Date[_0x28adb3(0x191)]();try{console[_0x28adb3(0x1a6)](_0x28adb3(0x144)+_0x433503);const _0x227539={'gatewayPaymentId':_0x433503};loggerService_1[_0x28adb3(0x143)][_0x28adb3(0x15e)](_0x28adb3(0x1aa),_0x28adb3(0x15d),'POST',_0x227539);const _0x2afdb2=await fetch(this[_0x28adb3(0x164)],{'method':_0x28adb3(0x145),'headers':{'Content-Type':'application/json','Accept':_0x28adb3(0x18a),'User-Agent':_0x28adb3(0x19e)},'body':JSON['stringify'](_0x227539)}),_0x6147ef=Date['now']()-_0x428207;console['log'](_0x28adb3(0x162)),console[_0x28adb3(0x1a6)]('Status:',_0x2afdb2['status']),console[_0x28adb3(0x1a6)]('Response\x20Time:',_0x6147ef+'ms');if(!_0x2afdb2['ok']){const _0x41ef99=await _0x2afdb2['text']();console[_0x28adb3(0x16f)](_0x28adb3(0x181),_0x2afdb2[_0x28adb3(0x1c1)]),console['error'](_0x28adb3(0x1ae),_0x41ef99),loggerService_1[_0x28adb3(0x143)][_0x28adb3(0x170)](_0x28adb3(0x1aa),_0x28adb3(0x15d),_0x2afdb2['status'],_0x41ef99,_0x6147ef),loggerService_1[_0x28adb3(0x143)][_0x28adb3(0x180)](_0x28adb3(0x1aa),_0x28adb3(0x15d),_0x28adb3(0x169)+_0x2afdb2[_0x28adb3(0x1c1)]+':\x20'+_0x41ef99);throw new Error(_0x28adb3(0x187)+_0x2afdb2[_0x28adb3(0x1c1)]);}const _0x2df833=await _0x2afdb2[_0x28adb3(0x17e)]();console[_0x28adb3(0x1a6)](_0x28adb3(0x17c),_0x2df833);let _0x311d68;try{_0x311d68=JSON['parse'](_0x2df833);}catch(_0x1faae2){console[_0x28adb3(0x16f)](_0x28adb3(0x1ab),_0x1faae2),loggerService_1[_0x28adb3(0x143)][_0x28adb3(0x180)]('cointopay',_0x28adb3(0x15d),_0x28adb3(0x165)+_0x1faae2);throw new Error(_0x28adb3(0x1bc)+_0x2df833);}loggerService_1[_0x28adb3(0x143)]['logWhiteDomainResponse'](_0x28adb3(0x1aa),'/status',_0x2afdb2['status'],_0x311d68,_0x6147ef),console[_0x28adb3(0x1a6)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x28adb3(0x1a6)]('Result:',_0x311d68['result']),console[_0x28adb3(0x1a6)](_0x28adb3(0x18c),_0x311d68[_0x28adb3(0x14c)]),console[_0x28adb3(0x1a6)](_0x28adb3(0x171),_0x311d68[_0x28adb3(0x1ad)]?.[_0x28adb3(0x13f)]),console[_0x28adb3(0x1a6)](_0x28adb3(0x18e),_0x311d68[_0x28adb3(0x1ad)]?.[_0x28adb3(0x14d)]),console[_0x28adb3(0x1a6)](_0x28adb3(0x17f),_0x311d68[_0x28adb3(0x1ad)]?.[_0x28adb3(0x1bf)]);if(_0x311d68[_0x28adb3(0x17a)]!==_0x28adb3(0x160)||_0x311d68[_0x28adb3(0x14c)]!==0xc8){const _0x4b39d6=_0x311d68[_0x28adb3(0x185)]||_0x28adb3(0x15f);console[_0x28adb3(0x16f)](_0x28adb3(0x18d)),console[_0x28adb3(0x16f)](_0x28adb3(0x19d),_0x4b39d6),loggerService_1['loggerService']['logWhiteDomainError'](_0x28adb3(0x1aa),_0x28adb3(0x15d),_0x28adb3(0x1b2)+_0x4b39d6);throw new Error(_0x28adb3(0x137)+_0x4b39d6);}if(!_0x311d68[_0x28adb3(0x1ad)]){console['error'](_0x28adb3(0x176)),console[_0x28adb3(0x16f)](_0x28adb3(0x1b9)),loggerService_1[_0x28adb3(0x143)][_0x28adb3(0x180)]('cointopay',_0x28adb3(0x15d),_0x28adb3(0x1bd));throw new Error(_0x28adb3(0x1b3));}let _0x4b916f=_0x28adb3(0x148);switch(_0x311d68[_0x28adb3(0x1ad)][_0x28adb3(0x13f)]?.[_0x28adb3(0x1a2)]()){case _0x28adb3(0x152):_0x4b916f='PAID';break;case _0x28adb3(0x1a9):case _0x28adb3(0x168):case _0x28adb3(0x16f):_0x4b916f='FAILED';break;case'expired':case _0x28adb3(0x141):_0x4b916f='EXPIRED';break;case _0x28adb3(0x193):case _0x28adb3(0x150):case _0x28adb3(0x1b8):case _0x28adb3(0x147):default:_0x4b916f=_0x28adb3(0x148);break;}let _0x4891f1,_0x5bd3a0;if(_0x311d68[_0x28adb3(0x1ad)][_0x28adb3(0x151)]){const _0x86df6=_0x311d68[_0x28adb3(0x1ad)][_0x28adb3(0x151)];console['log']('üè¶\x20Payment\x20Detail:',_0x86df6);const _0x19181f=_0x86df6[_0x28adb3(0x189)](/IBAN\s+([A-Z0-9]+)/i);_0x19181f&&(_0x4891f1=_0x19181f[0x1],console[_0x28adb3(0x1a6)](_0x28adb3(0x14b),_0x4891f1)),_0x5bd3a0=_0x86df6;}const _0x479ad6={'iban':_0x4891f1,'bankDetails':_0x5bd3a0,'transactionId':_0x311d68[_0x28adb3(0x1ad)]['TransactionID'],'coinAddress':_0x311d68[_0x28adb3(0x1ad)]['coinAddress'],'qrCodeUrl':_0x311d68[_0x28adb3(0x1ad)][_0x28adb3(0x1a7)],'expiryTime':_0x311d68[_0x28adb3(0x1ad)][_0x28adb3(0x13a)],'createdOn':_0x311d68[_0x28adb3(0x1ad)][_0x28adb3(0x156)],'confirmedOn':_0x311d68[_0x28adb3(0x1ad)][_0x28adb3(0x139)]};console['log'](_0x28adb3(0x157)),console[_0x28adb3(0x1a6)](_0x28adb3(0x16e),_0x311d68[_0x28adb3(0x1ad)][_0x28adb3(0x13f)],'->',_0x4b916f),console[_0x28adb3(0x1a6)](_0x28adb3(0x18e),_0x311d68['data'][_0x28adb3(0x14d)],_0x311d68['data']['inputCurrency']),console[_0x28adb3(0x1a6)](_0x28adb3(0x178),_0x311d68[_0x28adb3(0x1ad)]['TransactionID']),console[_0x28adb3(0x1a6)](_0x28adb3(0x138),_0x4891f1||_0x28adb3(0x1a3)),console[_0x28adb3(0x1a6)](_0x28adb3(0x19f),_0x311d68[_0x28adb3(0x1ad)][_0x28adb3(0x156)]),console[_0x28adb3(0x1a6)](_0x28adb3(0x194),_0x311d68[_0x28adb3(0x1ad)][_0x28adb3(0x139)]||_0x28adb3(0x1c0));if(_0x311d68[_0x28adb3(0x1ad)]['Status']?.['toLowerCase']()===_0x28adb3(0x150))console[_0x28adb3(0x1a6)](_0x28adb3(0x18f));else _0x311d68[_0x28adb3(0x1ad)]['Status']?.['toLowerCase']()==='paid'&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x4b916f,'amount':parseFloat(_0x311d68['data'][_0x28adb3(0x14d)])||undefined,'currency':_0x311d68['data']['inputCurrency']||'EUR','paymentDetails':_0x479ad6};}catch(_0x3170b0){console[_0x28adb3(0x16f)](_0x28adb3(0x18b),_0x3170b0),loggerService_1[_0x28adb3(0x143)]['logWhiteDomainError'](_0x28adb3(0x1aa),_0x28adb3(0x15d),_0x3170b0);throw new Error(_0x28adb3(0x174)+(_0x3170b0 instanceof Error?_0x3170b0[_0x28adb3(0x185)]:_0x28adb3(0x16b)));}}async[a55_0x377109(0x17b)](_0x1676e3){const _0x386fbd=a55_0x377109,_0x3d83e5=await this[_0x386fbd(0x16d)](_0x1676e3);return{'status':_0x3d83e5[_0x386fbd(0x1c1)],'amount':_0x3d83e5[_0x386fbd(0x154)],'currency':_0x3d83e5[_0x386fbd(0x1b7)]};}async['processWebhook'](_0x34fcb0){const _0x42de48=a55_0x377109;console[_0x42de48(0x1a6)](_0x42de48(0x1a4),_0x34fcb0);let _0x575d30=_0x42de48(0x148);switch(_0x34fcb0[_0x42de48(0x1c1)]?.[_0x42de48(0x1a2)]()){case _0x42de48(0x152):_0x575d30=_0x42de48(0x167);break;case _0x42de48(0x1a9):case _0x42de48(0x168):case _0x42de48(0x16f):_0x575d30='FAILED';break;case _0x42de48(0x1b1):case _0x42de48(0x141):_0x575d30='EXPIRED';break;case _0x42de48(0x1b8):case _0x42de48(0x193):case _0x42de48(0x150):case'created':default:_0x575d30=_0x42de48(0x148);break;}return{'paymentId':_0x34fcb0['order_id']||_0x34fcb0[_0x42de48(0x13c)]||'','status':_0x575d30,'amount':_0x34fcb0[_0x42de48(0x154)],'currency':_0x34fcb0[_0x42de48(0x1b7)]||_0x42de48(0x142)};}}function a55_0x18bc(){const _0x6372ab=['Raw\x20Response\x20Body:','Error\x20details:','text','Currency:','logWhiteDomainError','HTTP\x20Status:','gateway_payment_id','/create','1376517gCXOJb','message','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','HTTP\x20error!\x20status:\x20','entries','match','application/json','CoinToPay\x20payment\x20status\x20check\x20error:','Status\x20Code:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Amount:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','352404YziKdp','now','createPaymentLink','waiting','Confirmed\x20On:','Error\x20stack:','üìä\x20Status\x20check\x20URL:','CoinToPay\x20API\x20error:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','2482317FulAyk','===\x20COINTOPAY\x20SUCCESS\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Error\x20Message:','Payment\x20System/1.0','Created\x20On:','Response\x20Time:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','toLowerCase','not\x20found','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Response\x20data:','log','QRCodeURL','459730KJuvHp','cancelled','cointopay','Failed\x20to\x20parse\x20JSON\x20response:','Status\x20Text:','data','Response\x20Body:','stack','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','expired','Status\x20API\x20Error:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20ERROR\x20===','currency','pending','Missing\x20data\x20in\x20response','defineProperty','stringify','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Incomplete\x20response:\x20missing\x20data','CoinToPayService','inputCurrency','not\x20confirmed','status','apiUrl','https://tesoft.uk/gateway/cointopay/status.php','8BOeATi','CoinToPay\x20status\x20API\x20error:\x20','IBAN:','TransactionConfirmedOn','ExpiryTime','Request\x20Body:','merchant_reference_id','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','3486703yksmYs','Status','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','timeout','EUR','loggerService','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','POST',',\x20body:\x20','created','PENDING','https://tesoft.uk/gateway/cointopay/','Unknown\x20error\x20from\x20CoinToPay\x20API','üè¶\x20Extracted\x20IBAN:','status_code','Amount','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','awaiting\x20fiat','PaymentDetail','paid','122390UnKTAn','amount','parse','CreatedOn','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Business\x20Error:\x20','../loggerService','Headers:','payment_url','Parsed\x20Result:','/status','logWhiteDomainRequest','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','success','30SQoKas','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','URL:','statusUrl','JSON\x20Parse\x20Error:\x20','341268qMeJgx','PAID','failed','HTTP\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Unknown\x20error','statusText','checkPaymentStatus','Status:','error','logWhiteDomainResponse','Payment\x20Status:','Error\x20message:','\x20EUR','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','42qZYYaC','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','16GPXgsP','Transaction\x20ID:','Payment\x20URL\x20(original):','result','verifyPayment'];a55_0x18bc=function(){return _0x6372ab;};return a55_0x18bc();}exports['CoinToPayService']=CoinToPayService;