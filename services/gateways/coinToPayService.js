'use strict';function a41_0x9c6d(_0xa37af2,_0xd69a4d){const _0x21e1f0=a41_0x21e1();return a41_0x9c6d=function(_0x9c6d20,_0x28fcee){_0x9c6d20=_0x9c6d20-0x1df;let _0x6a32e9=_0x21e1f0[_0x9c6d20];return _0x6a32e9;},a41_0x9c6d(_0xa37af2,_0xd69a4d);}const a41_0x21dd29=a41_0x9c6d;(function(_0xdbfdf5,_0x3ec07f){const _0x38a26c=a41_0x9c6d,_0x3d6d94=_0xdbfdf5();while(!![]){try{const _0x5ddfaf=parseInt(_0x38a26c(0x25a))/0x1+parseInt(_0x38a26c(0x208))/0x2*(-parseInt(_0x38a26c(0x201))/0x3)+parseInt(_0x38a26c(0x209))/0x4*(parseInt(_0x38a26c(0x226))/0x5)+-parseInt(_0x38a26c(0x214))/0x6*(-parseInt(_0x38a26c(0x1e6))/0x7)+parseInt(_0x38a26c(0x1ff))/0x8+-parseInt(_0x38a26c(0x200))/0x9*(-parseInt(_0x38a26c(0x20d))/0xa)+-parseInt(_0x38a26c(0x1e9))/0xb;if(_0x5ddfaf===_0x3ec07f)break;else _0x3d6d94['push'](_0x3d6d94['shift']());}catch(_0x34a0a4){_0x3d6d94['push'](_0x3d6d94['shift']());}}}(a41_0x21e1,0x67f2c));Object[a41_0x21dd29(0x1e4)](exports,a41_0x21dd29(0x24b),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a41_0x21dd29(0x1fa));class CoinToPayService{constructor(){const _0x4772ef=a41_0x21dd29;this[_0x4772ef(0x23b)]=_0x4772ef(0x20a),this['statusUrl']=_0x4772ef(0x204),console[_0x4772ef(0x25d)](_0x4772ef(0x21d)),console[_0x4772ef(0x25d)](_0x4772ef(0x25f),this[_0x4772ef(0x236)]);}async['createPaymentLink'](_0x13ac91){const _0x50d12a=a41_0x21dd29,{orderId:_0x26ec26,amount:_0x131bce}=_0x13ac91;console['log'](_0x50d12a(0x224)+_0x131bce+_0x50d12a(0x262));const _0x27236b={'amount':_0x131bce},_0x3edf25=Date[_0x50d12a(0x237)]();try{console[_0x50d12a(0x25d)](_0x50d12a(0x23f)),console[_0x50d12a(0x25d)](_0x50d12a(0x258),this['apiUrl']),console[_0x50d12a(0x25d)]('Request\x20Body:',JSON[_0x50d12a(0x20b)](_0x27236b,null,0x2)),console[_0x50d12a(0x25d)]('Amount:',_0x131bce,_0x50d12a(0x1f0)),loggerService_1['loggerService'][_0x50d12a(0x1e3)](_0x50d12a(0x1fc),_0x50d12a(0x266),_0x50d12a(0x252),_0x27236b);const _0x3b117f=await fetch(this[_0x50d12a(0x23b)],{'method':'POST','headers':{'Content-Type':_0x50d12a(0x24e),'Accept':_0x50d12a(0x24e),'User-Agent':_0x50d12a(0x234)},'body':JSON[_0x50d12a(0x20b)](_0x27236b)}),_0x342abc=Date['now']()-_0x3edf25;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x50d12a(0x239),_0x3b117f[_0x50d12a(0x22f)]),console['log'](_0x50d12a(0x229),_0x3b117f['statusText']),console[_0x50d12a(0x25d)](_0x50d12a(0x24a),Object[_0x50d12a(0x1f7)](_0x3b117f[_0x50d12a(0x241)][_0x50d12a(0x1f1)]())),console[_0x50d12a(0x25d)]('Response\x20Time:',_0x342abc+'ms');const _0x4a5e74=await _0x3b117f['text']();console[_0x50d12a(0x25d)](_0x50d12a(0x23d),_0x4a5e74);if(!_0x3b117f['ok']){console[_0x50d12a(0x206)](_0x50d12a(0x249)),console[_0x50d12a(0x206)](_0x50d12a(0x246),_0x3b117f['status']),console[_0x50d12a(0x206)](_0x50d12a(0x251),_0x4a5e74),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x50d12a(0x1fc),_0x50d12a(0x266),_0x3b117f['status'],_0x4a5e74,_0x342abc),loggerService_1['loggerService']['logWhiteDomainError'](_0x50d12a(0x1fc),_0x50d12a(0x266),_0x50d12a(0x1fd)+_0x3b117f[_0x50d12a(0x22f)]+':\x20'+_0x4a5e74);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3b117f['status']+_0x50d12a(0x22d)+_0x4a5e74);}let _0x2a7954;try{_0x2a7954=JSON[_0x50d12a(0x1f4)](_0x4a5e74);}catch(_0x250bef){console[_0x50d12a(0x206)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x250bef),loggerService_1[_0x50d12a(0x21c)]['logWhiteDomainError'](_0x50d12a(0x1fc),_0x50d12a(0x266),'JSON\x20Parse\x20Error:\x20'+_0x250bef);throw new Error(_0x50d12a(0x1f6)+_0x4a5e74);}console[_0x50d12a(0x25d)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x50d12a(0x25d)](_0x50d12a(0x230),JSON[_0x50d12a(0x20b)](_0x2a7954,null,0x2)),loggerService_1[_0x50d12a(0x21c)][_0x50d12a(0x1f8)](_0x50d12a(0x1fc),_0x50d12a(0x266),_0x3b117f[_0x50d12a(0x22f)],_0x2a7954,_0x342abc);if(_0x2a7954[_0x50d12a(0x206)]){const _0x35fc47=_0x2a7954[_0x50d12a(0x260)]||_0x2a7954[_0x50d12a(0x206)]||_0x50d12a(0x225);console[_0x50d12a(0x206)](_0x50d12a(0x1fe)),console[_0x50d12a(0x206)](_0x50d12a(0x21f),_0x35fc47),loggerService_1[_0x50d12a(0x21c)][_0x50d12a(0x20c)](_0x50d12a(0x1fc),_0x50d12a(0x266),_0x50d12a(0x1f9)+_0x35fc47);throw new Error(_0x50d12a(0x244)+_0x35fc47);}if(!_0x2a7954[_0x50d12a(0x210)]||!_0x2a7954[_0x50d12a(0x232)]){console[_0x50d12a(0x206)](_0x50d12a(0x22c)),console[_0x50d12a(0x206)](_0x50d12a(0x221)),console[_0x50d12a(0x206)](_0x50d12a(0x245),_0x2a7954),loggerService_1['loggerService'][_0x50d12a(0x20c)]('cointopay',_0x50d12a(0x266),_0x50d12a(0x22a));throw new Error(_0x50d12a(0x238));}return console[_0x50d12a(0x25d)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x50d12a(0x25d)](_0x50d12a(0x264),_0x2a7954['gateway_payment_id']),console[_0x50d12a(0x25d)](_0x50d12a(0x254),_0x2a7954[_0x50d12a(0x210)]),console[_0x50d12a(0x25d)]('Amount:',_0x131bce,_0x50d12a(0x24d)),{'gateway_payment_id':_0x2a7954['gateway_payment_id'],'payment_url':_0x2a7954[_0x50d12a(0x210)]};}catch(_0x48f863){console[_0x50d12a(0x206)](_0x50d12a(0x242)),console[_0x50d12a(0x206)](_0x50d12a(0x263),_0x48f863),loggerService_1['loggerService']['logWhiteDomainError'](_0x50d12a(0x1fc),'/create',_0x48f863);if(_0x48f863 instanceof Error){console[_0x50d12a(0x206)](_0x50d12a(0x240),_0x48f863['message']),console[_0x50d12a(0x206)]('Error\x20stack:',_0x48f863[_0x50d12a(0x23c)]);throw new Error(_0x50d12a(0x220)+_0x48f863[_0x50d12a(0x260)]);}throw new Error(_0x50d12a(0x1e5));}}async['checkPaymentStatus'](_0x299bb0){const _0x14a531=a41_0x21dd29,_0x1c08bd=Date[_0x14a531(0x237)]();try{console[_0x14a531(0x25d)](_0x14a531(0x215)+_0x299bb0);const _0x20875d={'gatewayPaymentId':_0x299bb0};loggerService_1[_0x14a531(0x21c)][_0x14a531(0x1e3)]('cointopay',_0x14a531(0x1f2),_0x14a531(0x252),_0x20875d);const _0x39d104=await fetch(this[_0x14a531(0x236)],{'method':_0x14a531(0x252),'headers':{'Content-Type':_0x14a531(0x24e),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x14a531(0x20b)](_0x20875d)}),_0x1fc46d=Date[_0x14a531(0x237)]()-_0x1c08bd;console[_0x14a531(0x25d)](_0x14a531(0x24c)),console[_0x14a531(0x25d)](_0x14a531(0x239),_0x39d104[_0x14a531(0x22f)]),console[_0x14a531(0x25d)](_0x14a531(0x1ed),_0x1fc46d+'ms');if(!_0x39d104['ok']){const _0xfded2b=await _0x39d104[_0x14a531(0x255)]();console[_0x14a531(0x206)](_0x14a531(0x246),_0x39d104[_0x14a531(0x22f)]),console[_0x14a531(0x206)](_0x14a531(0x251),_0xfded2b),loggerService_1[_0x14a531(0x21c)][_0x14a531(0x1f8)](_0x14a531(0x1fc),_0x14a531(0x1f2),_0x39d104[_0x14a531(0x22f)],_0xfded2b,_0x1fc46d),loggerService_1[_0x14a531(0x21c)][_0x14a531(0x20c)]('cointopay',_0x14a531(0x1f2),_0x14a531(0x1fd)+_0x39d104[_0x14a531(0x22f)]+':\x20'+_0xfded2b);throw new Error(_0x14a531(0x227)+_0x39d104[_0x14a531(0x22f)]);}const _0x44c93c=await _0x39d104[_0x14a531(0x255)]();console['log'](_0x14a531(0x23d),_0x44c93c);let _0x319cee;try{_0x319cee=JSON['parse'](_0x44c93c);}catch(_0x5111a7){console['error'](_0x14a531(0x25c),_0x5111a7),loggerService_1[_0x14a531(0x21c)][_0x14a531(0x20c)]('cointopay',_0x14a531(0x1f2),_0x14a531(0x24f)+_0x5111a7);throw new Error(_0x14a531(0x217)+_0x44c93c);}loggerService_1[_0x14a531(0x21c)][_0x14a531(0x1f8)]('cointopay','/status',_0x39d104[_0x14a531(0x22f)],_0x319cee,_0x1fc46d),console[_0x14a531(0x25d)](_0x14a531(0x267)),console[_0x14a531(0x25d)](_0x14a531(0x22e),_0x319cee[_0x14a531(0x1df)]),console[_0x14a531(0x25d)](_0x14a531(0x1ee),_0x319cee[_0x14a531(0x1e8)]),console['log'](_0x14a531(0x212),_0x319cee[_0x14a531(0x218)]?.[_0x14a531(0x203)]),console[_0x14a531(0x25d)](_0x14a531(0x202),_0x319cee[_0x14a531(0x218)]?.[_0x14a531(0x21e)]),console[_0x14a531(0x25d)]('Currency:',_0x319cee[_0x14a531(0x218)]?.[_0x14a531(0x216)]);if(_0x319cee['result']!==_0x14a531(0x268)||_0x319cee['status_code']!==0xc8){const _0x57d149=_0x319cee[_0x14a531(0x260)]||_0x14a531(0x1ec);console['error'](_0x14a531(0x1f5)),console[_0x14a531(0x206)]('Error\x20Message:',_0x57d149),loggerService_1[_0x14a531(0x21c)][_0x14a531(0x20c)](_0x14a531(0x1fc),_0x14a531(0x1f2),_0x14a531(0x211)+_0x57d149);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x57d149);}if(!_0x319cee[_0x14a531(0x218)]){console['error'](_0x14a531(0x20f)),console['error'](_0x14a531(0x1fb)),loggerService_1[_0x14a531(0x21c)]['logWhiteDomainError'](_0x14a531(0x1fc),_0x14a531(0x1f2),_0x14a531(0x265));throw new Error(_0x14a531(0x247));}let _0x370ef1=_0x14a531(0x1eb);switch(_0x319cee['data'][_0x14a531(0x203)]?.[_0x14a531(0x1ea)]()){case _0x14a531(0x22b):_0x370ef1='PAID';break;case _0x14a531(0x248):case _0x14a531(0x23e):case _0x14a531(0x206):_0x370ef1='FAILED';break;case _0x14a531(0x257):case _0x14a531(0x20e):_0x370ef1=_0x14a531(0x25b);break;case _0x14a531(0x1f3):case _0x14a531(0x1e1):case _0x14a531(0x269):case _0x14a531(0x235):default:_0x370ef1=_0x14a531(0x1eb);break;}let _0x40fced,_0x451e7d;if(_0x319cee[_0x14a531(0x218)][_0x14a531(0x243)]){const _0x32e094=_0x319cee[_0x14a531(0x218)][_0x14a531(0x243)];console[_0x14a531(0x25d)](_0x14a531(0x222),_0x32e094);const _0x161fb1=_0x32e094[_0x14a531(0x205)](/IBAN\s+([A-Z0-9]+)/i);_0x161fb1&&(_0x40fced=_0x161fb1[0x1],console[_0x14a531(0x25d)](_0x14a531(0x23a),_0x40fced)),_0x451e7d=_0x32e094;}const _0x427de9={'iban':_0x40fced,'bankDetails':_0x451e7d,'transactionId':_0x319cee[_0x14a531(0x218)][_0x14a531(0x1e2)],'coinAddress':_0x319cee['data'][_0x14a531(0x253)],'qrCodeUrl':_0x319cee[_0x14a531(0x218)][_0x14a531(0x261)],'expiryTime':_0x319cee[_0x14a531(0x218)]['ExpiryTime'],'createdOn':_0x319cee['data']['CreatedOn'],'confirmedOn':_0x319cee['data'][_0x14a531(0x1e7)]};console[_0x14a531(0x25d)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x14a531(0x25d)](_0x14a531(0x239),_0x319cee[_0x14a531(0x218)][_0x14a531(0x203)],'->',_0x370ef1),console[_0x14a531(0x25d)]('Amount:',_0x319cee['data'][_0x14a531(0x21e)],_0x319cee[_0x14a531(0x218)][_0x14a531(0x216)]),console[_0x14a531(0x25d)]('Transaction\x20ID:',_0x319cee[_0x14a531(0x218)][_0x14a531(0x1e2)]),console['log'](_0x14a531(0x250),_0x40fced||_0x14a531(0x231)),console[_0x14a531(0x25d)](_0x14a531(0x25e),_0x319cee['data'][_0x14a531(0x21b)]),console[_0x14a531(0x25d)](_0x14a531(0x228),_0x319cee[_0x14a531(0x218)][_0x14a531(0x1e7)]||_0x14a531(0x219));if(_0x319cee[_0x14a531(0x218)]['Status']?.[_0x14a531(0x1ea)]()===_0x14a531(0x1e1))console[_0x14a531(0x25d)](_0x14a531(0x223));else _0x319cee['data'][_0x14a531(0x203)]?.[_0x14a531(0x1ea)]()===_0x14a531(0x22b)&&console[_0x14a531(0x25d)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x370ef1,'amount':parseFloat(_0x319cee[_0x14a531(0x218)]['Amount'])||undefined,'currency':_0x319cee[_0x14a531(0x218)][_0x14a531(0x216)]||_0x14a531(0x24d),'paymentDetails':_0x427de9};}catch(_0x40f64b){console[_0x14a531(0x206)](_0x14a531(0x1e0),_0x40f64b),loggerService_1[_0x14a531(0x21c)][_0x14a531(0x20c)](_0x14a531(0x1fc),_0x14a531(0x1f2),_0x40f64b);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x40f64b instanceof Error?_0x40f64b[_0x14a531(0x260)]:'Unknown\x20error'));}}async[a41_0x21dd29(0x207)](_0x487821){const _0x41b6af=a41_0x21dd29,_0x2e8f82=await this['checkPaymentStatus'](_0x487821);return{'status':_0x2e8f82[_0x41b6af(0x22f)],'amount':_0x2e8f82[_0x41b6af(0x21a)],'currency':_0x2e8f82[_0x41b6af(0x256)]};}async['processWebhook'](_0x35efdd){const _0x4bfeed=a41_0x21dd29;console[_0x4bfeed(0x25d)](_0x4bfeed(0x1ef),_0x35efdd);let _0x14caaa=_0x4bfeed(0x1eb);switch(_0x35efdd[_0x4bfeed(0x22f)]?.[_0x4bfeed(0x1ea)]()){case'paid':_0x14caaa=_0x4bfeed(0x233);break;case _0x4bfeed(0x248):case _0x4bfeed(0x23e):case _0x4bfeed(0x206):_0x14caaa=_0x4bfeed(0x213);break;case _0x4bfeed(0x257):case _0x4bfeed(0x20e):_0x14caaa='EXPIRED';break;case'pending':case _0x4bfeed(0x1f3):case _0x4bfeed(0x1e1):case _0x4bfeed(0x235):default:_0x14caaa=_0x4bfeed(0x1eb);break;}return{'paymentId':_0x35efdd['order_id']||_0x35efdd['merchant_reference_id']||'','status':_0x14caaa,'amount':_0x35efdd[_0x4bfeed(0x21a)],'currency':_0x35efdd[_0x4bfeed(0x256)]||_0x4bfeed(0x24d)};}}function a41_0x21e1(){const _0x18c7a7=['timeout','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','payment_url','Status\x20API\x20Error:\x20','Payment\x20Status:','FAILED','24186cVcmQN','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','inputCurrency','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','data','not\x20confirmed','amount','CreatedOn','loggerService','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Amount','Error\x20Message:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','🏦\x20Payment\x20Detail:','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','🪙\x20Creating\x20CoinToPay\x20payment:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','175JGQGcI','HTTP\x20error!\x20status:\x20','Confirmed\x20On:','Status\x20Text:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','paid','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===',',\x20body:\x20','Result:','status','Parsed\x20Result:','not\x20found','gateway_payment_id','PAID','TesSoft\x20Payment\x20System/1.0','created','statusUrl','now','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status:','🏦\x20Extracted\x20IBAN:','apiUrl','stack','Raw\x20Response\x20Body:','failed','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Error\x20message:','headers','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','PaymentDetail','CoinToPay\x20API\x20error:\x20','Response\x20data:','HTTP\x20Status:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','cancelled','===\x20COINTOPAY\x20API\x20ERROR\x20===','Headers:','__esModule','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','EUR','application/json','JSON\x20Parse\x20Error:\x20','IBAN:','Response\x20Body:','POST','coinAddress','Payment\x20URL:','text','currency','expired','URL:','CoinToPayService','432861ZQnOVy','EXPIRED','Failed\x20to\x20parse\x20JSON\x20response:','log','Created\x20On:','📊\x20Status\x20check\x20URL:','message','QRCodeURL','\x20EUR','Error\x20details:','Gateway\x20Payment\x20ID:','Incomplete\x20response:\x20missing\x20data','/create','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','success','pending','result','CoinToPay\x20payment\x20status\x20check\x20error:','awaiting\x20fiat','TransactionID','logWhiteDomainRequest','defineProperty','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','588aPFlYc','TransactionConfirmedOn','status_code','13161720kCArgq','toLowerCase','PENDING','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Response\x20Time:','Status\x20Code:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','entries','/status','waiting','parse','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','fromEntries','logWhiteDomainResponse','Business\x20Error:\x20','../loggerService','Missing\x20data\x20in\x20response','cointopay','HTTP\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','684960qVVkmc','19899IsErXl','375YoCFhe','Amount:','Status','https://tesoft.uk/gateway/cointopay/status.php','match','error','verifyPayment','4106togWcO','53104lVWOqT','https://tesoft.uk/gateway/cointopay/','stringify','logWhiteDomainError','2520rJIxJe'];a41_0x21e1=function(){return _0x18c7a7;};return a41_0x21e1();}exports[a41_0x21dd29(0x259)]=CoinToPayService;