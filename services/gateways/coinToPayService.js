'use strict';const a57_0x42a3c8=a57_0x539d;(function(_0x3cf166,_0x32c715){const _0x48469d=a57_0x539d,_0xab2832=_0x3cf166();while(!![]){try{const _0xa2318b=-parseInt(_0x48469d(0x178))/0x1+parseInt(_0x48469d(0x124))/0x2*(parseInt(_0x48469d(0x125))/0x3)+parseInt(_0x48469d(0x134))/0x4*(-parseInt(_0x48469d(0x153))/0x5)+-parseInt(_0x48469d(0x174))/0x6*(parseInt(_0x48469d(0x199))/0x7)+-parseInt(_0x48469d(0x121))/0x8+parseInt(_0x48469d(0x131))/0x9*(-parseInt(_0x48469d(0x15e))/0xa)+-parseInt(_0x48469d(0x172))/0xb*(-parseInt(_0x48469d(0x11f))/0xc);if(_0xa2318b===_0x32c715)break;else _0xab2832['push'](_0xab2832['shift']());}catch(_0x4c6068){_0xab2832['push'](_0xab2832['shift']());}}}(a57_0x15f2,0x19a7c));function a57_0x15f2(){const _0x3cb844=['timeout','1416dBDavJ','stack','1507664gSYmdB','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Business\x20Error:\x20','366zCvLQx','2250rmFioM','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','../loggerService','Unknown\x20error','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','FAILED','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','\x20EUR','Unknown\x20error\x20from\x20CoinToPay\x20API','JSON\x20Parse\x20Error:\x20','status','CoinToPay\x20payment\x20status\x20check\x20error:','9spUCJV','HTTP\x20Status:','===\x20COINTOPAY\x20SUCCESS\x20===','8icGALT','ðŸ¦\x20Extracted\x20IBAN:','loggerService','logWhiteDomainRequest','Status:','Headers:','ðŸ“Š\x20Status\x20check\x20URL:','ðŸ¦\x20Payment\x20Detail:','Confirmed\x20On:','HTTP\x20','status_code','waiting','merchant_reference_id','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','toLowerCase','Failed\x20to\x20parse\x20JSON\x20response:','stringify','PENDING','HTTP\x20error!\x20status:\x20','inputCurrency','gateway_payment_id','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','paid','Payment\x20System/1.0','failed','POST','amount','Payment\x20URL\x20(original):','result','Amount','pending','3710sVdfVb','Request\x20Body:','error','payment_url','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','parse','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','TransactionID','CoinToPay\x20API\x20error:\x20','1446620CdUxMa','/status','createPaymentLink','now','expired','currency','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Status\x20Text:','EUR','text','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','ExpiryTime','message','statusText','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','entries','&alternative=false','processWebhook','CoinToPayService','PaymentDetail','48026HjQTYF','fromEntries','162348gpeNXV','https://tesoft.uk/gateway/cointopay/status.php','Status','CoinToPay\x20status\x20API\x20error:\x20','104518XKVPDr','checkPaymentStatus','awaiting\x20fiat','/create','Error\x20details:','Error\x20Message:','order_id','defineProperty','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Response\x20Body:','Status\x20API\x20Error:\x20','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Gateway\x20Payment\x20ID:','CreatedOn','created','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','TransactionConfirmedOn','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','log','coinAddress','application/json','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Created\x20On:','not\x20found','Error\x20stack:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','cointopay','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Response\x20Time:','Error\x20message:','https://tesoft.uk/gateway/cointopay/','Amount:','28faSDTI','Currency:','PAID','Status\x20Code:','Transaction\x20ID:',',\x20body:\x20','statusUrl','Response\x20data:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','cancelled','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','apiUrl','data','logWhiteDomainError','logWhiteDomainResponse'];a57_0x15f2=function(){return _0x3cb844;};return a57_0x15f2();}Object[a57_0x42a3c8(0x17f)](exports,'__esModule',{'value':!![]}),exports[a57_0x42a3c8(0x170)]=void 0x0;const loggerService_1=require(a57_0x42a3c8(0x127));class CoinToPayService{constructor(){const _0x9430ce=a57_0x42a3c8;this['apiUrl']=_0x9430ce(0x197),this[_0x9430ce(0x19f)]=_0x9430ce(0x175),console[_0x9430ce(0x18a)](_0x9430ce(0x157)),console[_0x9430ce(0x18a)](_0x9430ce(0x13a),this[_0x9430ce(0x19f)]);}async[a57_0x42a3c8(0x160)](_0x4a46bd){const _0x21f43d=a57_0x42a3c8,{orderId:_0x42db96,amount:_0x3d96cb}=_0x4a46bd;console[_0x21f43d(0x18a)](_0x21f43d(0x158)+_0x3d96cb+_0x21f43d(0x12c));const _0x346aaa={'amount':_0x3d96cb},_0x4f0166=Date[_0x21f43d(0x161)]();try{console['log'](_0x21f43d(0x126)),console[_0x21f43d(0x18a)]('URL:',this[_0x21f43d(0x1a4)]),console[_0x21f43d(0x18a)](_0x21f43d(0x154),JSON[_0x21f43d(0x144)](_0x346aaa,null,0x2)),console[_0x21f43d(0x18a)](_0x21f43d(0x198),_0x3d96cb,_0x21f43d(0x168)),loggerService_1[_0x21f43d(0x136)][_0x21f43d(0x137)]('cointopay',_0x21f43d(0x17b),_0x21f43d(0x14d),_0x346aaa);const _0x4300f8=await fetch(this[_0x21f43d(0x1a4)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x21f43d(0x14b)},'body':JSON[_0x21f43d(0x144)](_0x346aaa)}),_0x4f2991=Date[_0x21f43d(0x161)]()-_0x4f0166;console[_0x21f43d(0x18a)](_0x21f43d(0x149)),console['log'](_0x21f43d(0x138),_0x4300f8['status']),console['log'](_0x21f43d(0x165),_0x4300f8[_0x21f43d(0x16b)]),console['log'](_0x21f43d(0x139),Object[_0x21f43d(0x173)](_0x4300f8['headers'][_0x21f43d(0x16d)]())),console[_0x21f43d(0x18a)](_0x21f43d(0x195),_0x4f2991+'ms');const _0x14ed77=await _0x4300f8['text']();console[_0x21f43d(0x18a)]('Raw\x20Response\x20Body:',_0x14ed77);if(!_0x4300f8['ok']){console[_0x21f43d(0x155)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x21f43d(0x132),_0x4300f8[_0x21f43d(0x12f)]),console[_0x21f43d(0x155)](_0x21f43d(0x181),_0x14ed77),loggerService_1[_0x21f43d(0x136)][_0x21f43d(0x11d)](_0x21f43d(0x193),_0x21f43d(0x17b),_0x4300f8[_0x21f43d(0x12f)],_0x14ed77,_0x4f2991),loggerService_1['loggerService'][_0x21f43d(0x11c)]('cointopay',_0x21f43d(0x17b),'HTTP\x20'+_0x4300f8['status']+':\x20'+_0x14ed77);throw new Error(_0x21f43d(0x146)+_0x4300f8[_0x21f43d(0x12f)]+_0x21f43d(0x19e)+_0x14ed77);}let _0xdb658e;try{_0xdb658e=JSON[_0x21f43d(0x159)](_0x14ed77);}catch(_0x4795e5){console[_0x21f43d(0x155)](_0x21f43d(0x143),_0x4795e5),loggerService_1[_0x21f43d(0x136)][_0x21f43d(0x11c)]('cointopay',_0x21f43d(0x17b),_0x21f43d(0x12e)+_0x4795e5);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x14ed77);}console[_0x21f43d(0x18a)](_0x21f43d(0x18d)),console[_0x21f43d(0x18a)]('Parsed\x20Result:',JSON[_0x21f43d(0x144)](_0xdb658e,null,0x2)),loggerService_1[_0x21f43d(0x136)][_0x21f43d(0x11d)](_0x21f43d(0x193),'/create',_0x4300f8[_0x21f43d(0x12f)],_0xdb658e,_0x4f2991);if(_0xdb658e[_0x21f43d(0x155)]){const _0x553213=_0xdb658e[_0x21f43d(0x16a)]||_0xdb658e[_0x21f43d(0x155)]||_0x21f43d(0x12d);console[_0x21f43d(0x155)](_0x21f43d(0x15b)),console[_0x21f43d(0x155)]('Error\x20Message:',_0x553213),loggerService_1[_0x21f43d(0x136)][_0x21f43d(0x11c)]('cointopay',_0x21f43d(0x17b),_0x21f43d(0x123)+_0x553213);throw new Error(_0x21f43d(0x15d)+_0x553213);}if(!_0xdb658e[_0x21f43d(0x156)]||!_0xdb658e[_0x21f43d(0x148)]){console[_0x21f43d(0x155)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x21f43d(0x155)](_0x21f43d(0x192)),console[_0x21f43d(0x155)](_0x21f43d(0x1a0),_0xdb658e),loggerService_1[_0x21f43d(0x136)][_0x21f43d(0x11c)](_0x21f43d(0x193),_0x21f43d(0x17b),_0x21f43d(0x16c));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x21f43d(0x18a)](_0x21f43d(0x133)),console[_0x21f43d(0x18a)](_0x21f43d(0x184),_0xdb658e[_0x21f43d(0x148)]),console['log'](_0x21f43d(0x14f),_0xdb658e[_0x21f43d(0x156)]);const _0x575e22=_0xdb658e[_0x21f43d(0x156)]+_0x21f43d(0x16e);return console[_0x21f43d(0x18a)]('Payment\x20URL\x20(modified):',_0x575e22),console[_0x21f43d(0x18a)](_0x21f43d(0x198),_0x3d96cb,'EUR'),{'gateway_payment_id':_0xdb658e[_0x21f43d(0x148)],'payment_url':_0x575e22};}catch(_0x4ae5a6){console[_0x21f43d(0x155)](_0x21f43d(0x1a1)),console[_0x21f43d(0x155)](_0x21f43d(0x17c),_0x4ae5a6),loggerService_1[_0x21f43d(0x136)][_0x21f43d(0x11c)]('cointopay',_0x21f43d(0x17b),_0x4ae5a6);if(_0x4ae5a6 instanceof Error){console[_0x21f43d(0x155)](_0x21f43d(0x196),_0x4ae5a6[_0x21f43d(0x16a)]),console[_0x21f43d(0x155)](_0x21f43d(0x190),_0x4ae5a6[_0x21f43d(0x120)]);throw new Error(_0x21f43d(0x189)+_0x4ae5a6[_0x21f43d(0x16a)]);}throw new Error(_0x21f43d(0x191));}}async[a57_0x42a3c8(0x179)](_0x28e145){const _0x443c19=a57_0x42a3c8,_0x1f67ed=Date[_0x443c19(0x161)]();try{console[_0x443c19(0x18a)](_0x443c19(0x12b)+_0x28e145);const _0x386afd={'gatewayPaymentId':_0x28e145};loggerService_1[_0x443c19(0x136)][_0x443c19(0x137)]('cointopay',_0x443c19(0x15f),_0x443c19(0x14d),_0x386afd);const _0x507478=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0x443c19(0x18c),'Accept':_0x443c19(0x18c),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x443c19(0x144)](_0x386afd)}),_0x5a40be=Date[_0x443c19(0x161)]()-_0x1f67ed;console[_0x443c19(0x18a)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x443c19(0x18a)]('Status:',_0x507478[_0x443c19(0x12f)]),console[_0x443c19(0x18a)](_0x443c19(0x195),_0x5a40be+'ms');if(!_0x507478['ok']){const _0x1ce4b2=await _0x507478[_0x443c19(0x167)]();console['error']('HTTP\x20Status:',_0x507478['status']),console[_0x443c19(0x155)]('Response\x20Body:',_0x1ce4b2),loggerService_1['loggerService'][_0x443c19(0x11d)](_0x443c19(0x193),_0x443c19(0x15f),_0x507478[_0x443c19(0x12f)],_0x1ce4b2,_0x5a40be),loggerService_1[_0x443c19(0x136)]['logWhiteDomainError'](_0x443c19(0x193),'/status',_0x443c19(0x13d)+_0x507478['status']+':\x20'+_0x1ce4b2);throw new Error('HTTP\x20error!\x20status:\x20'+_0x507478[_0x443c19(0x12f)]);}const _0x49c45d=await _0x507478[_0x443c19(0x167)]();console['log']('Raw\x20Response\x20Body:',_0x49c45d);let _0xa953ea;try{_0xa953ea=JSON[_0x443c19(0x159)](_0x49c45d);}catch(_0x2d0fd6){console['error'](_0x443c19(0x143),_0x2d0fd6),loggerService_1['loggerService'][_0x443c19(0x11c)](_0x443c19(0x193),'/status',_0x443c19(0x12e)+_0x2d0fd6);throw new Error(_0x443c19(0x129)+_0x49c45d);}loggerService_1[_0x443c19(0x136)][_0x443c19(0x11d)](_0x443c19(0x193),_0x443c19(0x15f),_0x507478[_0x443c19(0x12f)],_0xa953ea,_0x5a40be),console['log'](_0x443c19(0x141)),console['log']('Result:',_0xa953ea[_0x443c19(0x150)]),console[_0x443c19(0x18a)](_0x443c19(0x19c),_0xa953ea[_0x443c19(0x13e)]),console[_0x443c19(0x18a)]('Payment\x20Status:',_0xa953ea[_0x443c19(0x11b)]?.[_0x443c19(0x176)]),console[_0x443c19(0x18a)](_0x443c19(0x198),_0xa953ea[_0x443c19(0x11b)]?.[_0x443c19(0x151)]),console[_0x443c19(0x18a)](_0x443c19(0x19a),_0xa953ea[_0x443c19(0x11b)]?.['inputCurrency']);if(_0xa953ea[_0x443c19(0x150)]!=='success'||_0xa953ea[_0x443c19(0x13e)]!==0xc8){const _0xc10ee8=_0xa953ea['message']||_0x443c19(0x187);console[_0x443c19(0x155)](_0x443c19(0x15a)),console['error'](_0x443c19(0x17d),_0xc10ee8),loggerService_1[_0x443c19(0x136)][_0x443c19(0x11c)](_0x443c19(0x193),'/status',_0x443c19(0x182)+_0xc10ee8);throw new Error(_0x443c19(0x177)+_0xc10ee8);}if(!_0xa953ea[_0x443c19(0x11b)]){console[_0x443c19(0x155)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x443c19(0x155)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x443c19(0x11c)](_0x443c19(0x193),_0x443c19(0x15f),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x443c19(0x180));}let _0x291ea6=_0x443c19(0x145);switch(_0xa953ea['data'][_0x443c19(0x176)]?.['toLowerCase']()){case _0x443c19(0x14a):_0x291ea6=_0x443c19(0x19b);break;case _0x443c19(0x1a2):case _0x443c19(0x14c):case'error':_0x291ea6=_0x443c19(0x12a);break;case'expired':case'timeout':_0x291ea6='EXPIRED';break;case _0x443c19(0x13f):case _0x443c19(0x17a):case _0x443c19(0x152):case _0x443c19(0x186):default:_0x291ea6=_0x443c19(0x145);break;}let _0x30cf3b,_0x284e97;if(_0xa953ea[_0x443c19(0x11b)][_0x443c19(0x171)]){const _0x122caf=_0xa953ea[_0x443c19(0x11b)][_0x443c19(0x171)];console[_0x443c19(0x18a)](_0x443c19(0x13b),_0x122caf);const _0x205720=_0x122caf['match'](/IBAN\s+([A-Z0-9]+)/i);_0x205720&&(_0x30cf3b=_0x205720[0x1],console[_0x443c19(0x18a)](_0x443c19(0x135),_0x30cf3b)),_0x284e97=_0x122caf;}const _0x47652c={'iban':_0x30cf3b,'bankDetails':_0x284e97,'transactionId':_0xa953ea['data']['TransactionID'],'coinAddress':_0xa953ea[_0x443c19(0x11b)][_0x443c19(0x18b)],'qrCodeUrl':_0xa953ea['data']['QRCodeURL'],'expiryTime':_0xa953ea[_0x443c19(0x11b)][_0x443c19(0x169)],'createdOn':_0xa953ea[_0x443c19(0x11b)][_0x443c19(0x185)],'confirmedOn':_0xa953ea[_0x443c19(0x11b)][_0x443c19(0x188)]};console[_0x443c19(0x18a)](_0x443c19(0x1a3)),console[_0x443c19(0x18a)]('Status:',_0xa953ea[_0x443c19(0x11b)][_0x443c19(0x176)],'->',_0x291ea6),console[_0x443c19(0x18a)](_0x443c19(0x198),_0xa953ea[_0x443c19(0x11b)][_0x443c19(0x151)],_0xa953ea[_0x443c19(0x11b)][_0x443c19(0x147)]),console[_0x443c19(0x18a)](_0x443c19(0x19d),_0xa953ea['data'][_0x443c19(0x15c)]),console[_0x443c19(0x18a)]('IBAN:',_0x30cf3b||_0x443c19(0x18f)),console[_0x443c19(0x18a)](_0x443c19(0x18e),_0xa953ea[_0x443c19(0x11b)][_0x443c19(0x185)]),console[_0x443c19(0x18a)](_0x443c19(0x13c),_0xa953ea[_0x443c19(0x11b)][_0x443c19(0x188)]||'not\x20confirmed');if(_0xa953ea[_0x443c19(0x11b)]['Status']?.[_0x443c19(0x142)]()===_0x443c19(0x17a))console[_0x443c19(0x18a)](_0x443c19(0x194));else _0xa953ea[_0x443c19(0x11b)][_0x443c19(0x176)]?.[_0x443c19(0x142)]()===_0x443c19(0x14a)&&console[_0x443c19(0x18a)](_0x443c19(0x122));return{'status':_0x291ea6,'amount':parseFloat(_0xa953ea[_0x443c19(0x11b)]['Amount'])||undefined,'currency':_0xa953ea[_0x443c19(0x11b)]['inputCurrency']||_0x443c19(0x166),'paymentDetails':_0x47652c};}catch(_0x238c8a){console[_0x443c19(0x155)](_0x443c19(0x130),_0x238c8a),loggerService_1[_0x443c19(0x136)][_0x443c19(0x11c)](_0x443c19(0x193),_0x443c19(0x15f),_0x238c8a);throw new Error(_0x443c19(0x183)+(_0x238c8a instanceof Error?_0x238c8a[_0x443c19(0x16a)]:_0x443c19(0x128)));}}async['verifyPayment'](_0x369455){const _0x417cf2=a57_0x42a3c8,_0xab2e29=await this[_0x417cf2(0x179)](_0x369455);return{'status':_0xab2e29[_0x417cf2(0x12f)],'amount':_0xab2e29[_0x417cf2(0x14e)],'currency':_0xab2e29['currency']};}async[a57_0x42a3c8(0x16f)](_0x38f265){const _0x2d7c50=a57_0x42a3c8;console[_0x2d7c50(0x18a)](_0x2d7c50(0x164),_0x38f265);let _0x461379=_0x2d7c50(0x145);switch(_0x38f265[_0x2d7c50(0x12f)]?.[_0x2d7c50(0x142)]()){case _0x2d7c50(0x14a):_0x461379='PAID';break;case _0x2d7c50(0x1a2):case _0x2d7c50(0x14c):case _0x2d7c50(0x155):_0x461379=_0x2d7c50(0x12a);break;case _0x2d7c50(0x162):case _0x2d7c50(0x11e):_0x461379='EXPIRED';break;case _0x2d7c50(0x152):case _0x2d7c50(0x13f):case _0x2d7c50(0x17a):case'created':default:_0x461379='PENDING';break;}return{'paymentId':_0x38f265[_0x2d7c50(0x17e)]||_0x38f265[_0x2d7c50(0x140)]||'','status':_0x461379,'amount':_0x38f265[_0x2d7c50(0x14e)],'currency':_0x38f265[_0x2d7c50(0x163)]||_0x2d7c50(0x166)};}}function a57_0x539d(_0x40618b,_0x5b7de2){_0x40618b=_0x40618b-0x11b;const _0x15f24e=a57_0x15f2();let _0x539d60=_0x15f24e[_0x40618b];return _0x539d60;}exports[a57_0x42a3c8(0x170)]=CoinToPayService;