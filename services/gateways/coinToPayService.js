'use strict';function a57_0x546c(){const _0xf7c981=['5226727EoFYBB','statusText','ðŸ¦\x20Payment\x20Detail:','cancelled','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','not\x20confirmed','===\x20COINTOPAY\x20SUCCESS\x20===','stringify','application/json','../loggerService','merchant_reference_id','cointopay','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','inputCurrency','Currency:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','18ukhOns','message','result','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','logWhiteDomainRequest','failed','logWhiteDomainResponse','478330uqpSsf','428037ppTbFc','timeout','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','9686NCUvGs','Request\x20Body:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','awaiting\x20fiat','HTTP\x20','Missing\x20data\x20in\x20response','amount','TransactionID','stack','Status\x20Text:','EUR','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','CoinToPay\x20API\x20error:\x20','Status\x20Code:','HTTP\x20Status:','JSON\x20Parse\x20Error:\x20','\x20EUR','12rqsjsQ','TransactionConfirmedOn','not\x20found','Raw\x20Response\x20Body:','568JuNsFD','PENDING','match','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','PAID','/create','CoinToPay\x20payment\x20status\x20check\x20error:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','expired','pending','378190cAOglZ','Result:','Payment\x20System/1.0','Amount:','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','waiting','HTTP\x20error!\x20status:\x20','CoinToPay\x20status\x20API\x20error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','Status','paid','PaymentDetail','__esModule','apiUrl','Response\x20Body:','data','Headers:','fromEntries','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','URL:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Gateway\x20Payment\x20ID:','statusUrl','created','CreatedOn','Payment\x20URL\x20(original):','checkPaymentStatus','Status\x20API\x20Error:\x20','toLowerCase','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20Message:','Failed\x20to\x20parse\x20JSON\x20response:','Amount','verifyPayment','gateway_payment_id','Error\x20stack:','CoinToPayService','Payment\x20Status:','log','Response\x20Time:','status_code','ðŸ¦\x20Extracted\x20IBAN:','coinAddress','33iyuELF','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','parse','logWhiteDomainError','Incomplete\x20response:\x20missing\x20data','POST','text','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','57113dingSo','FAILED','entries','17973120wIVLUw','now','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Status:','EXPIRED','/status','success','payment_url','defineProperty','ExpiryTime','order_id','Parsed\x20Result:','loggerService','https://tesoft.uk/gateway/cointopay/status.php','headers','status','12UuZXRL','createPaymentLink','error','Error\x20details:'];a57_0x546c=function(){return _0xf7c981;};return a57_0x546c();}const a57_0x347c4a=a57_0x172d;(function(_0x5ac6a2,_0x2def41){const _0x131480=a57_0x172d,_0x427ff6=_0x5ac6a2();while(!![]){try{const _0x5d9160=-parseInt(_0x131480(0x19a))/0x1*(parseInt(_0x131480(0x1d6))/0x2)+-parseInt(_0x131480(0x1d3))/0x3*(parseInt(_0x131480(0x1e8))/0x4)+parseInt(_0x131480(0x1d2))/0x5*(-parseInt(_0x131480(0x1b6))/0x6)+-parseInt(_0x131480(0x1a3))/0x7*(parseInt(_0x131480(0x1ec))/0x8)+-parseInt(_0x131480(0x1cb))/0x9*(parseInt(_0x131480(0x1f8))/0xa)+parseInt(_0x131480(0x1ba))/0xb+parseInt(_0x131480(0x1a6))/0xc;if(_0x5d9160===_0x2def41)break;else _0x427ff6['push'](_0x427ff6['shift']());}catch(_0x495dfa){_0x427ff6['push'](_0x427ff6['shift']());}}}(a57_0x546c,0x838b2));Object[a57_0x347c4a(0x1ae)](exports,a57_0x347c4a(0x204),{'value':!![]}),exports[a57_0x347c4a(0x193)]=void 0x0;const loggerService_1=require(a57_0x347c4a(0x1c3));class CoinToPayService{constructor(){const _0x3026f6=a57_0x347c4a;this[_0x3026f6(0x205)]='https://tesoft.uk/gateway/cointopay/',this[_0x3026f6(0x185)]=_0x3026f6(0x1b3),console['log']('ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x3026f6(0x195)]('ðŸ“Š\x20Status\x20check\x20URL:',this[_0x3026f6(0x185)]);}async[a57_0x347c4a(0x1b7)](_0x314d35){const _0x47e16e=a57_0x347c4a,{orderId:_0x168827,amount:_0x35dcc3}=_0x314d35;console['log'](_0x47e16e(0x1fc)+_0x35dcc3+_0x47e16e(0x1e7));const _0x1d0141={'amount':_0x35dcc3},_0x38fafc=Date[_0x47e16e(0x1a7)]();try{console['log'](_0x47e16e(0x19c)),console[_0x47e16e(0x195)](_0x47e16e(0x20b),this[_0x47e16e(0x205)]),console[_0x47e16e(0x195)](_0x47e16e(0x1d7),JSON['stringify'](_0x1d0141,null,0x2)),console[_0x47e16e(0x195)](_0x47e16e(0x1fb),_0x35dcc3,_0x47e16e(0x1c9)),loggerService_1['loggerService'][_0x47e16e(0x1cf)](_0x47e16e(0x1c5),_0x47e16e(0x1f1),_0x47e16e(0x1a0),_0x1d0141);const _0x352669=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x47e16e(0x1c2),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x47e16e(0x1c1)](_0x1d0141)}),_0x27fa5f=Date[_0x47e16e(0x1a7)]()-_0x38fafc;console['log'](_0x47e16e(0x1d5)),console[_0x47e16e(0x195)](_0x47e16e(0x1a9),_0x352669[_0x47e16e(0x1b5)]),console[_0x47e16e(0x195)](_0x47e16e(0x1e0),_0x352669[_0x47e16e(0x1bb)]),console[_0x47e16e(0x195)](_0x47e16e(0x208),Object[_0x47e16e(0x209)](_0x352669[_0x47e16e(0x1b4)][_0x47e16e(0x1a5)]())),console['log'](_0x47e16e(0x196),_0x27fa5f+'ms');const _0x36ab76=await _0x352669[_0x47e16e(0x1a1)]();console[_0x47e16e(0x195)]('Raw\x20Response\x20Body:',_0x36ab76);if(!_0x352669['ok']){console[_0x47e16e(0x1b8)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x47e16e(0x1e5),_0x352669['status']),console[_0x47e16e(0x1b8)](_0x47e16e(0x206),_0x36ab76),loggerService_1[_0x47e16e(0x1b2)][_0x47e16e(0x1d1)](_0x47e16e(0x1c5),_0x47e16e(0x1f1),_0x352669['status'],_0x36ab76,_0x27fa5f),loggerService_1['loggerService'][_0x47e16e(0x19e)]('cointopay','/create',_0x47e16e(0x1db)+_0x352669[_0x47e16e(0x1b5)]+':\x20'+_0x36ab76);throw new Error(_0x47e16e(0x1fe)+_0x352669[_0x47e16e(0x1b5)]+',\x20body:\x20'+_0x36ab76);}let _0x18cf3b;try{_0x18cf3b=JSON[_0x47e16e(0x19d)](_0x36ab76);}catch(_0x6bb54){console[_0x47e16e(0x1b8)](_0x47e16e(0x18e),_0x6bb54),loggerService_1[_0x47e16e(0x1b2)][_0x47e16e(0x19e)]('cointopay',_0x47e16e(0x1f1),_0x47e16e(0x1e6)+_0x6bb54);throw new Error(_0x47e16e(0x1a8)+_0x36ab76);}console['log'](_0x47e16e(0x1f4)),console[_0x47e16e(0x195)](_0x47e16e(0x1b1),JSON[_0x47e16e(0x1c1)](_0x18cf3b,null,0x2)),loggerService_1[_0x47e16e(0x1b2)][_0x47e16e(0x1d1)](_0x47e16e(0x1c5),_0x47e16e(0x1f1),_0x352669[_0x47e16e(0x1b5)],_0x18cf3b,_0x27fa5f);if(_0x18cf3b[_0x47e16e(0x1b8)]){const _0x8963b7=_0x18cf3b[_0x47e16e(0x1cc)]||_0x18cf3b[_0x47e16e(0x1b8)]||_0x47e16e(0x200);console[_0x47e16e(0x1b8)](_0x47e16e(0x1be)),console[_0x47e16e(0x1b8)](_0x47e16e(0x18d),_0x8963b7),loggerService_1[_0x47e16e(0x1b2)][_0x47e16e(0x19e)](_0x47e16e(0x1c5),'/create','Business\x20Error:\x20'+_0x8963b7);throw new Error(_0x47e16e(0x1e3)+_0x8963b7);}if(!_0x18cf3b['payment_url']||!_0x18cf3b[_0x47e16e(0x191)]){console[_0x47e16e(0x1b8)](_0x47e16e(0x183)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x47e16e(0x1b8)]('Response\x20data:',_0x18cf3b),loggerService_1[_0x47e16e(0x1b2)][_0x47e16e(0x19e)](_0x47e16e(0x1c5),_0x47e16e(0x1f1),_0x47e16e(0x1a2));throw new Error(_0x47e16e(0x1d8));}console[_0x47e16e(0x195)](_0x47e16e(0x1c0)),console['log'](_0x47e16e(0x184),_0x18cf3b[_0x47e16e(0x191)]),console[_0x47e16e(0x195)](_0x47e16e(0x188),_0x18cf3b[_0x47e16e(0x1ad)]);const _0xe29101=_0x18cf3b['payment_url']+'&alternative=false';return console[_0x47e16e(0x195)]('Payment\x20URL\x20(modified):',_0xe29101),console[_0x47e16e(0x195)](_0x47e16e(0x1fb),_0x35dcc3,_0x47e16e(0x1e1)),{'gateway_payment_id':_0x18cf3b[_0x47e16e(0x191)],'payment_url':_0xe29101};}catch(_0x2232f4){console[_0x47e16e(0x1b8)](_0x47e16e(0x1ef)),console[_0x47e16e(0x1b8)](_0x47e16e(0x1b9),_0x2232f4),loggerService_1[_0x47e16e(0x1b2)]['logWhiteDomainError'](_0x47e16e(0x1c5),_0x47e16e(0x1f1),_0x2232f4);if(_0x2232f4 instanceof Error){console[_0x47e16e(0x1b8)]('Error\x20message:',_0x2232f4['message']),console[_0x47e16e(0x1b8)](_0x47e16e(0x192),_0x2232f4[_0x47e16e(0x1df)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x2232f4[_0x47e16e(0x1cc)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a57_0x347c4a(0x189)](_0x384237){const _0x5265fd=a57_0x347c4a,_0x582486=Date[_0x5265fd(0x1a7)]();try{console[_0x5265fd(0x195)]('ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x384237);const _0x314da4={'gatewayPaymentId':_0x384237};loggerService_1[_0x5265fd(0x1b2)][_0x5265fd(0x1cf)](_0x5265fd(0x1c5),_0x5265fd(0x1ab),_0x5265fd(0x1a0),_0x314da4);const _0x1cb666=await fetch(this[_0x5265fd(0x185)],{'method':_0x5265fd(0x1a0),'headers':{'Content-Type':_0x5265fd(0x1c2),'Accept':_0x5265fd(0x1c2),'User-Agent':_0x5265fd(0x1fa)},'body':JSON['stringify'](_0x314da4)}),_0x48aee9=Date[_0x5265fd(0x1a7)]()-_0x582486;console['log'](_0x5265fd(0x19b)),console['log'](_0x5265fd(0x1a9),_0x1cb666['status']),console[_0x5265fd(0x195)](_0x5265fd(0x196),_0x48aee9+'ms');if(!_0x1cb666['ok']){const _0x1cb21c=await _0x1cb666[_0x5265fd(0x1a1)]();console['error']('HTTP\x20Status:',_0x1cb666['status']),console['error'](_0x5265fd(0x206),_0x1cb21c),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x5265fd(0x1c5),_0x5265fd(0x1ab),_0x1cb666[_0x5265fd(0x1b5)],_0x1cb21c,_0x48aee9),loggerService_1[_0x5265fd(0x1b2)][_0x5265fd(0x19e)]('cointopay',_0x5265fd(0x1ab),_0x5265fd(0x1db)+_0x1cb666[_0x5265fd(0x1b5)]+':\x20'+_0x1cb21c);throw new Error(_0x5265fd(0x1fe)+_0x1cb666['status']);}const _0x246a1d=await _0x1cb666[_0x5265fd(0x1a1)]();console['log'](_0x5265fd(0x1eb),_0x246a1d);let _0x470b72;try{_0x470b72=JSON['parse'](_0x246a1d);}catch(_0x4fc913){console[_0x5265fd(0x1b8)](_0x5265fd(0x18e),_0x4fc913),loggerService_1['loggerService'][_0x5265fd(0x19e)](_0x5265fd(0x1c5),_0x5265fd(0x1ab),_0x5265fd(0x1e6)+_0x4fc913);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x246a1d);}loggerService_1[_0x5265fd(0x1b2)][_0x5265fd(0x1d1)](_0x5265fd(0x1c5),'/status',_0x1cb666[_0x5265fd(0x1b5)],_0x470b72,_0x48aee9),console[_0x5265fd(0x195)](_0x5265fd(0x1c6)),console[_0x5265fd(0x195)](_0x5265fd(0x1f9),_0x470b72[_0x5265fd(0x1cd)]),console[_0x5265fd(0x195)](_0x5265fd(0x1e4),_0x470b72[_0x5265fd(0x197)]),console[_0x5265fd(0x195)](_0x5265fd(0x194),_0x470b72[_0x5265fd(0x207)]?.[_0x5265fd(0x201)]),console[_0x5265fd(0x195)]('Amount:',_0x470b72[_0x5265fd(0x207)]?.['Amount']),console['log'](_0x5265fd(0x1c8),_0x470b72[_0x5265fd(0x207)]?.['inputCurrency']);if(_0x470b72['result']!==_0x5265fd(0x1ac)||_0x470b72[_0x5265fd(0x197)]!==0xc8){const _0x1967c8=_0x470b72[_0x5265fd(0x1cc)]||_0x5265fd(0x1ce);console[_0x5265fd(0x1b8)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x5265fd(0x1b8)]('Error\x20Message:',_0x1967c8),loggerService_1[_0x5265fd(0x1b2)][_0x5265fd(0x19e)]('cointopay',_0x5265fd(0x1ab),_0x5265fd(0x18a)+_0x1967c8);throw new Error(_0x5265fd(0x1ff)+_0x1967c8);}if(!_0x470b72[_0x5265fd(0x207)]){console[_0x5265fd(0x1b8)](_0x5265fd(0x18c)),console['error'](_0x5265fd(0x1dc)),loggerService_1['loggerService'][_0x5265fd(0x19e)](_0x5265fd(0x1c5),_0x5265fd(0x1ab),_0x5265fd(0x19f));throw new Error(_0x5265fd(0x1f3));}let _0x1d4192=_0x5265fd(0x1ed);switch(_0x470b72[_0x5265fd(0x207)][_0x5265fd(0x201)]?.[_0x5265fd(0x18b)]()){case _0x5265fd(0x202):_0x1d4192=_0x5265fd(0x1f0);break;case _0x5265fd(0x1bd):case _0x5265fd(0x1d0):case _0x5265fd(0x1b8):_0x1d4192=_0x5265fd(0x1a4);break;case'expired':case'timeout':_0x1d4192=_0x5265fd(0x1aa);break;case _0x5265fd(0x1fd):case _0x5265fd(0x1da):case'pending':case'created':default:_0x1d4192=_0x5265fd(0x1ed);break;}let _0x11f9f4,_0x2b8211;if(_0x470b72[_0x5265fd(0x207)][_0x5265fd(0x203)]){const _0x30ce89=_0x470b72[_0x5265fd(0x207)][_0x5265fd(0x203)];console[_0x5265fd(0x195)](_0x5265fd(0x1bc),_0x30ce89);const _0x2f43b1=_0x30ce89[_0x5265fd(0x1ee)](/IBAN\s+([A-Z0-9]+)/i);_0x2f43b1&&(_0x11f9f4=_0x2f43b1[0x1],console[_0x5265fd(0x195)](_0x5265fd(0x198),_0x11f9f4)),_0x2b8211=_0x30ce89;}const _0x3b5484={'iban':_0x11f9f4,'bankDetails':_0x2b8211,'transactionId':_0x470b72[_0x5265fd(0x207)]['TransactionID'],'coinAddress':_0x470b72[_0x5265fd(0x207)][_0x5265fd(0x199)],'qrCodeUrl':_0x470b72[_0x5265fd(0x207)]['QRCodeURL'],'expiryTime':_0x470b72[_0x5265fd(0x207)][_0x5265fd(0x1af)],'createdOn':_0x470b72['data'][_0x5265fd(0x187)],'confirmedOn':_0x470b72[_0x5265fd(0x207)][_0x5265fd(0x1e9)]};console['log'](_0x5265fd(0x1d9)),console['log'](_0x5265fd(0x1a9),_0x470b72[_0x5265fd(0x207)][_0x5265fd(0x201)],'->',_0x1d4192),console[_0x5265fd(0x195)]('Amount:',_0x470b72[_0x5265fd(0x207)][_0x5265fd(0x18f)],_0x470b72['data'][_0x5265fd(0x1c7)]),console[_0x5265fd(0x195)]('Transaction\x20ID:',_0x470b72[_0x5265fd(0x207)][_0x5265fd(0x1de)]),console[_0x5265fd(0x195)]('IBAN:',_0x11f9f4||_0x5265fd(0x1ea)),console['log']('Created\x20On:',_0x470b72[_0x5265fd(0x207)][_0x5265fd(0x187)]),console['log']('Confirmed\x20On:',_0x470b72['data'][_0x5265fd(0x1e9)]||_0x5265fd(0x1bf));if(_0x470b72[_0x5265fd(0x207)][_0x5265fd(0x201)]?.[_0x5265fd(0x18b)]()==='awaiting\x20fiat')console['log'](_0x5265fd(0x1e2));else _0x470b72[_0x5265fd(0x207)]['Status']?.[_0x5265fd(0x18b)]()===_0x5265fd(0x202)&&console[_0x5265fd(0x195)](_0x5265fd(0x1ca));return{'status':_0x1d4192,'amount':parseFloat(_0x470b72[_0x5265fd(0x207)][_0x5265fd(0x18f)])||undefined,'currency':_0x470b72[_0x5265fd(0x207)][_0x5265fd(0x1c7)]||_0x5265fd(0x1e1),'paymentDetails':_0x3b5484};}catch(_0x4c94c9){console['error'](_0x5265fd(0x1f2),_0x4c94c9),loggerService_1[_0x5265fd(0x1b2)][_0x5265fd(0x19e)]('cointopay',_0x5265fd(0x1ab),_0x4c94c9);throw new Error(_0x5265fd(0x1f5)+(_0x4c94c9 instanceof Error?_0x4c94c9[_0x5265fd(0x1cc)]:'Unknown\x20error'));}}async[a57_0x347c4a(0x190)](_0x43ce72){const _0x4c39d2=a57_0x347c4a,_0x416375=await this[_0x4c39d2(0x189)](_0x43ce72);return{'status':_0x416375[_0x4c39d2(0x1b5)],'amount':_0x416375[_0x4c39d2(0x1dd)],'currency':_0x416375['currency']};}async['processWebhook'](_0x35f144){const _0x1e423a=a57_0x347c4a;console[_0x1e423a(0x195)](_0x1e423a(0x20a),_0x35f144);let _0x33d444=_0x1e423a(0x1ed);switch(_0x35f144[_0x1e423a(0x1b5)]?.[_0x1e423a(0x18b)]()){case'paid':_0x33d444=_0x1e423a(0x1f0);break;case _0x1e423a(0x1bd):case _0x1e423a(0x1d0):case _0x1e423a(0x1b8):_0x33d444=_0x1e423a(0x1a4);break;case _0x1e423a(0x1f6):case _0x1e423a(0x1d4):_0x33d444=_0x1e423a(0x1aa);break;case _0x1e423a(0x1f7):case'waiting':case'awaiting\x20fiat':case _0x1e423a(0x186):default:_0x33d444='PENDING';break;}return{'paymentId':_0x35f144[_0x1e423a(0x1b0)]||_0x35f144[_0x1e423a(0x1c4)]||'','status':_0x33d444,'amount':_0x35f144[_0x1e423a(0x1dd)],'currency':_0x35f144['currency']||_0x1e423a(0x1e1)};}}function a57_0x172d(_0x513ece,_0x2bbe0a){_0x513ece=_0x513ece-0x183;const _0x546cae=a57_0x546c();let _0x172d99=_0x546cae[_0x513ece];return _0x172d99;}exports['CoinToPayService']=CoinToPayService;