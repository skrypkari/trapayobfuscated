'use strict';function a40_0x1811(){const _0x3b07b8=['gateway_payment_id','paid','Unknown\x20error\x20from\x20CoinToPay\x20API','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20API\x20ERROR\x20===','122646HDozyy','Status','CreatedOn','HTTP\x20Status:','üìä\x20Status\x20check\x20URL:','awaiting\x20fiat','error','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','logWhiteDomainError','ExpiryTime','application/json','/create','https://tesoft.uk/gateway/cointopay/status.php','Gateway\x20Payment\x20ID:','2105121bLaJhx','JSON\x20Parse\x20Error:\x20','Error\x20stack:','headers','FAILED','message','Created\x20On:','üè¶\x20Payment\x20Detail:','Business\x20Error:\x20','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','coinAddress','4408796gkMfRr','Error\x20Message:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','status_code','result','Amount:','TransactionID',',\x20body:\x20','timeout','checkPaymentStatus','TransactionConfirmedOn','Headers:','inputCurrency','QRCodeURL','Confirmed\x20On:','634648pkfIoJ','Amount','378jyQlgQ','PAID','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','cointopay','Parsed\x20Result:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','CoinToPayService','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','fromEntries','\x20EUR','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','log','Error\x20message:','4qmcXFr','logWhiteDomainRequest','success','115xiRKHX','Status\x20Code:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','waiting','3171096asUolA','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','status','Payment\x20Status:','createPaymentLink','Request\x20Body:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','now','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','/status','merchant_reference_id','Error\x20details:','EXPIRED','Transaction\x20ID:','logWhiteDomainResponse','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Response\x20Body:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','order_id','IBAN:','expired','TesSoft\x20Payment\x20System/1.0','PENDING','pending','stack','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','parse','text','toLowerCase','processWebhook','Status\x20Text:','URL:','Missing\x20data\x20in\x20response','not\x20found','Response\x20data:','3904580EUYYZa','payment_url','3748ceQhmB','Failed\x20to\x20parse\x20JSON\x20response:','HTTP\x20','Incomplete\x20response:\x20missing\x20data','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Status\x20API\x20Error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','loggerService','failed','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','üè¶\x20Extracted\x20IBAN:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','created','match','Unknown\x20error','POST','statusUrl','Response\x20Time:','amount','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Currency:','stringify','Raw\x20Response\x20Body:','apiUrl','PaymentDetail','EUR','Status:','data'];a40_0x1811=function(){return _0x3b07b8;};return a40_0x1811();}function a40_0x9ae3(_0x535fb2,_0x18a77a){const _0x1811b0=a40_0x1811();return a40_0x9ae3=function(_0x9ae391,_0x4475d3){_0x9ae391=_0x9ae391-0x139;let _0x414a6e=_0x1811b0[_0x9ae391];return _0x414a6e;},a40_0x9ae3(_0x535fb2,_0x18a77a);}const a40_0x1d367b=a40_0x9ae3;(function(_0x52ee0b,_0x621900){const _0x1222b8=a40_0x9ae3,_0x1b84ab=_0x52ee0b();while(!![]){try{const _0x379748=parseInt(_0x1222b8(0x164))/0x1*(-parseInt(_0x1222b8(0x19f))/0x2)+-parseInt(_0x1222b8(0x148))/0x3*(parseInt(_0x1222b8(0x171))/0x4)+-parseInt(_0x1222b8(0x174))/0x5*(-parseInt(_0x1222b8(0x13a))/0x6)+parseInt(_0x1222b8(0x153))/0x7+parseInt(_0x1222b8(0x162))/0x8+parseInt(_0x1222b8(0x178))/0x9+parseInt(_0x1222b8(0x19d))/0xa;if(_0x379748===_0x621900)break;else _0x1b84ab['push'](_0x1b84ab['shift']());}catch(_0x2cf557){_0x1b84ab['push'](_0x1b84ab['shift']());}}}(a40_0x1811,0x7d019));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a40_0x1d367b(0x16a)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x5dad3b=a40_0x1d367b;this[_0x5dad3b(0x1b9)]='https://tesoft.uk/gateway/cointopay/',this['statusUrl']=_0x5dad3b(0x146),console[_0x5dad3b(0x16f)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x5dad3b(0x16f)](_0x5dad3b(0x13e),this[_0x5dad3b(0x1b1)]);}async[a40_0x1d367b(0x17c)](_0x8f97c2){const _0x3a346c=a40_0x1d367b,{orderId:_0x543097,amount:_0x3ac52a}=_0x8f97c2;console['log'](_0x3a346c(0x179)+_0x3ac52a+_0x3a346c(0x16d));const _0x27ba49={'amount':_0x3ac52a},_0x41a870=Date[_0x3a346c(0x17f)]();try{console[_0x3a346c(0x16f)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x3a346c(0x16f)](_0x3a346c(0x199),this[_0x3a346c(0x1b9)]),console[_0x3a346c(0x16f)](_0x3a346c(0x17d),JSON[_0x3a346c(0x1b7)](_0x27ba49,null,0x2)),console[_0x3a346c(0x16f)](_0x3a346c(0x158),_0x3ac52a,_0x3a346c(0x155)),loggerService_1[_0x3a346c(0x1a6)]['logWhiteDomainRequest']('cointopay',_0x3a346c(0x145),_0x3a346c(0x1b0),_0x27ba49);const _0x653130=await fetch(this['apiUrl'],{'method':_0x3a346c(0x1b0),'headers':{'Content-Type':_0x3a346c(0x144),'Accept':'application/json','User-Agent':_0x3a346c(0x18f)},'body':JSON[_0x3a346c(0x1b7)](_0x27ba49)}),_0x3d40=Date['now']()-_0x41a870;console[_0x3a346c(0x16f)](_0x3a346c(0x1c1)),console[_0x3a346c(0x16f)](_0x3a346c(0x1bc),_0x653130[_0x3a346c(0x17a)]),console[_0x3a346c(0x16f)](_0x3a346c(0x198),_0x653130['statusText']),console[_0x3a346c(0x16f)](_0x3a346c(0x15e),Object[_0x3a346c(0x16c)](_0x653130[_0x3a346c(0x14b)]['entries']())),console['log']('Response\x20Time:',_0x3d40+'ms');const _0x22fd96=await _0x653130['text']();console[_0x3a346c(0x16f)](_0x3a346c(0x1b8),_0x22fd96);if(!_0x653130['ok']){console[_0x3a346c(0x140)](_0x3a346c(0x139)),console['error'](_0x3a346c(0x13d),_0x653130['status']),console['error'](_0x3a346c(0x18a),_0x22fd96),loggerService_1[_0x3a346c(0x1a6)][_0x3a346c(0x188)](_0x3a346c(0x167),_0x3a346c(0x145),_0x653130[_0x3a346c(0x17a)],_0x22fd96,_0x3d40),loggerService_1[_0x3a346c(0x1a6)][_0x3a346c(0x142)](_0x3a346c(0x167),'/create',_0x3a346c(0x1a1)+_0x653130[_0x3a346c(0x17a)]+':\x20'+_0x22fd96);throw new Error(_0x3a346c(0x181)+_0x653130[_0x3a346c(0x17a)]+_0x3a346c(0x15a)+_0x22fd96);}let _0x7e8e52;try{_0x7e8e52=JSON[_0x3a346c(0x194)](_0x22fd96);}catch(_0x2e9010){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x2e9010),loggerService_1[_0x3a346c(0x1a6)][_0x3a346c(0x142)](_0x3a346c(0x167),_0x3a346c(0x145),_0x3a346c(0x149)+_0x2e9010);throw new Error(_0x3a346c(0x1ac)+_0x22fd96);}console[_0x3a346c(0x16f)](_0x3a346c(0x169)),console['log'](_0x3a346c(0x168),JSON[_0x3a346c(0x1b7)](_0x7e8e52,null,0x2)),loggerService_1[_0x3a346c(0x1a6)]['logWhiteDomainResponse'](_0x3a346c(0x167),_0x3a346c(0x145),_0x653130[_0x3a346c(0x17a)],_0x7e8e52,_0x3d40);if(_0x7e8e52['error']){const _0x52a6f3=_0x7e8e52['message']||_0x7e8e52[_0x3a346c(0x140)]||_0x3a346c(0x1c0);console[_0x3a346c(0x140)](_0x3a346c(0x16b)),console['error'](_0x3a346c(0x154),_0x52a6f3),loggerService_1['loggerService'][_0x3a346c(0x142)](_0x3a346c(0x167),_0x3a346c(0x145),_0x3a346c(0x150)+_0x52a6f3);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x52a6f3);}if(!_0x7e8e52[_0x3a346c(0x19e)]||!_0x7e8e52[_0x3a346c(0x1be)]){console[_0x3a346c(0x140)](_0x3a346c(0x1b4)),console[_0x3a346c(0x140)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error'](_0x3a346c(0x19c),_0x7e8e52),loggerService_1['loggerService'][_0x3a346c(0x142)](_0x3a346c(0x167),'/create',_0x3a346c(0x141));throw new Error(_0x3a346c(0x176));}return console[_0x3a346c(0x16f)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x3a346c(0x16f)](_0x3a346c(0x147),_0x7e8e52[_0x3a346c(0x1be)]),console[_0x3a346c(0x16f)]('Payment\x20URL:',_0x7e8e52[_0x3a346c(0x19e)]),console[_0x3a346c(0x16f)](_0x3a346c(0x158),_0x3ac52a,_0x3a346c(0x1bb)),{'gateway_payment_id':_0x7e8e52[_0x3a346c(0x1be)],'payment_url':_0x7e8e52['payment_url']};}catch(_0x115d26){console['error'](_0x3a346c(0x16e)),console[_0x3a346c(0x140)](_0x3a346c(0x185),_0x115d26),loggerService_1[_0x3a346c(0x1a6)][_0x3a346c(0x142)]('cointopay','/create',_0x115d26);if(_0x115d26 instanceof Error){console['error'](_0x3a346c(0x170),_0x115d26[_0x3a346c(0x14d)]),console[_0x3a346c(0x140)](_0x3a346c(0x14a),_0x115d26[_0x3a346c(0x192)]);throw new Error(_0x3a346c(0x1b5)+_0x115d26[_0x3a346c(0x14d)]);}throw new Error(_0x3a346c(0x1a5));}}async[a40_0x1d367b(0x15c)](_0x3c5443){const _0x2305e3=a40_0x1d367b,_0x361f7d=Date[_0x2305e3(0x17f)]();try{console[_0x2305e3(0x16f)](_0x2305e3(0x193)+_0x3c5443);const _0x2b83d0={'gatewayPaymentId':_0x3c5443};loggerService_1['loggerService'][_0x2305e3(0x172)](_0x2305e3(0x167),_0x2305e3(0x183),_0x2305e3(0x1b0),_0x2b83d0);const _0x9e255e=await fetch(this['statusUrl'],{'method':_0x2305e3(0x1b0),'headers':{'Content-Type':_0x2305e3(0x144),'Accept':_0x2305e3(0x144),'User-Agent':_0x2305e3(0x18f)},'body':JSON[_0x2305e3(0x1b7)](_0x2b83d0)}),_0x404843=Date[_0x2305e3(0x17f)]()-_0x361f7d;console[_0x2305e3(0x16f)](_0x2305e3(0x182)),console[_0x2305e3(0x16f)]('Status:',_0x9e255e['status']),console[_0x2305e3(0x16f)](_0x2305e3(0x1b2),_0x404843+'ms');if(!_0x9e255e['ok']){const _0x2723fa=await _0x9e255e[_0x2305e3(0x195)]();console[_0x2305e3(0x140)](_0x2305e3(0x13d),_0x9e255e['status']),console[_0x2305e3(0x140)](_0x2305e3(0x18a),_0x2723fa),loggerService_1[_0x2305e3(0x1a6)][_0x2305e3(0x188)](_0x2305e3(0x167),_0x2305e3(0x183),_0x9e255e['status'],_0x2723fa,_0x404843),loggerService_1['loggerService'][_0x2305e3(0x142)](_0x2305e3(0x167),_0x2305e3(0x183),_0x2305e3(0x1a1)+_0x9e255e[_0x2305e3(0x17a)]+':\x20'+_0x2723fa);throw new Error(_0x2305e3(0x181)+_0x9e255e[_0x2305e3(0x17a)]);}const _0x2b7faa=await _0x9e255e[_0x2305e3(0x195)]();console[_0x2305e3(0x16f)]('Raw\x20Response\x20Body:',_0x2b7faa);let _0x2e0237;try{_0x2e0237=JSON['parse'](_0x2b7faa);}catch(_0x4b6d85){console[_0x2305e3(0x140)](_0x2305e3(0x1a0),_0x4b6d85),loggerService_1[_0x2305e3(0x1a6)][_0x2305e3(0x142)](_0x2305e3(0x167),_0x2305e3(0x183),_0x2305e3(0x149)+_0x4b6d85);throw new Error(_0x2305e3(0x166)+_0x2b7faa);}loggerService_1[_0x2305e3(0x1a6)][_0x2305e3(0x188)]('cointopay',_0x2305e3(0x183),_0x9e255e['status'],_0x2e0237,_0x404843),console[_0x2305e3(0x16f)](_0x2305e3(0x18b)),console[_0x2305e3(0x16f)]('Result:',_0x2e0237[_0x2305e3(0x157)]),console[_0x2305e3(0x16f)](_0x2305e3(0x175),_0x2e0237[_0x2305e3(0x156)]),console[_0x2305e3(0x16f)](_0x2305e3(0x17b),_0x2e0237[_0x2305e3(0x1bd)]?.[_0x2305e3(0x13b)]),console[_0x2305e3(0x16f)]('Amount:',_0x2e0237[_0x2305e3(0x1bd)]?.[_0x2305e3(0x163)]),console[_0x2305e3(0x16f)](_0x2305e3(0x1b6),_0x2e0237[_0x2305e3(0x1bd)]?.[_0x2305e3(0x15f)]);if(_0x2e0237[_0x2305e3(0x157)]!==_0x2305e3(0x173)||_0x2e0237['status_code']!==0xc8){const _0x476f4f=_0x2e0237['message']||_0x2305e3(0x1a3);console[_0x2305e3(0x140)](_0x2305e3(0x180)),console[_0x2305e3(0x140)]('Error\x20Message:',_0x476f4f),loggerService_1[_0x2305e3(0x1a6)][_0x2305e3(0x142)](_0x2305e3(0x167),_0x2305e3(0x183),_0x2305e3(0x1a4)+_0x476f4f);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x476f4f);}if(!_0x2e0237[_0x2305e3(0x1bd)]){console['error'](_0x2305e3(0x189)),console[_0x2305e3(0x140)](_0x2305e3(0x19a)),loggerService_1['loggerService']['logWhiteDomainError'](_0x2305e3(0x167),_0x2305e3(0x183),_0x2305e3(0x1a2));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x33ea5a='PENDING';switch(_0x2e0237['data']['Status']?.[_0x2305e3(0x196)]()){case _0x2305e3(0x1bf):_0x33ea5a=_0x2305e3(0x165);break;case'cancelled':case'failed':case _0x2305e3(0x140):_0x33ea5a=_0x2305e3(0x14c);break;case _0x2305e3(0x18e):case _0x2305e3(0x15b):_0x33ea5a=_0x2305e3(0x186);break;case _0x2305e3(0x177):case _0x2305e3(0x13f):case _0x2305e3(0x191):case _0x2305e3(0x1ad):default:_0x33ea5a=_0x2305e3(0x190);break;}let _0x3cc019,_0x1d761f;if(_0x2e0237[_0x2305e3(0x1bd)][_0x2305e3(0x1ba)]){const _0x265ff2=_0x2e0237[_0x2305e3(0x1bd)][_0x2305e3(0x1ba)];console[_0x2305e3(0x16f)](_0x2305e3(0x14f),_0x265ff2);const _0x2be668=_0x265ff2[_0x2305e3(0x1ae)](/IBAN\s+([A-Z0-9]+)/i);_0x2be668&&(_0x3cc019=_0x2be668[0x1],console[_0x2305e3(0x16f)](_0x2305e3(0x1ab),_0x3cc019)),_0x1d761f=_0x265ff2;}const _0x3dbe1c={'iban':_0x3cc019,'bankDetails':_0x1d761f,'transactionId':_0x2e0237[_0x2305e3(0x1bd)][_0x2305e3(0x159)],'coinAddress':_0x2e0237['data'][_0x2305e3(0x152)],'qrCodeUrl':_0x2e0237['data'][_0x2305e3(0x160)],'expiryTime':_0x2e0237[_0x2305e3(0x1bd)][_0x2305e3(0x143)],'createdOn':_0x2e0237[_0x2305e3(0x1bd)]['CreatedOn'],'confirmedOn':_0x2e0237[_0x2305e3(0x1bd)][_0x2305e3(0x15d)]};console[_0x2305e3(0x16f)](_0x2305e3(0x1aa)),console[_0x2305e3(0x16f)](_0x2305e3(0x1bc),_0x2e0237[_0x2305e3(0x1bd)]['Status'],'->',_0x33ea5a),console['log']('Amount:',_0x2e0237[_0x2305e3(0x1bd)]['Amount'],_0x2e0237[_0x2305e3(0x1bd)]['inputCurrency']),console[_0x2305e3(0x16f)](_0x2305e3(0x187),_0x2e0237[_0x2305e3(0x1bd)]['TransactionID']),console[_0x2305e3(0x16f)](_0x2305e3(0x18d),_0x3cc019||_0x2305e3(0x19b)),console[_0x2305e3(0x16f)](_0x2305e3(0x14e),_0x2e0237[_0x2305e3(0x1bd)][_0x2305e3(0x13c)]),console['log'](_0x2305e3(0x161),_0x2e0237['data']['TransactionConfirmedOn']||'not\x20confirmed');if(_0x2e0237[_0x2305e3(0x1bd)][_0x2305e3(0x13b)]?.['toLowerCase']()===_0x2305e3(0x13f))console[_0x2305e3(0x16f)](_0x2305e3(0x17e));else _0x2e0237[_0x2305e3(0x1bd)][_0x2305e3(0x13b)]?.['toLowerCase']()===_0x2305e3(0x1bf)&&console[_0x2305e3(0x16f)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x33ea5a,'amount':parseFloat(_0x2e0237[_0x2305e3(0x1bd)]['Amount'])||undefined,'currency':_0x2e0237[_0x2305e3(0x1bd)][_0x2305e3(0x15f)]||_0x2305e3(0x1bb),'paymentDetails':_0x3dbe1c};}catch(_0x6b22a5){console[_0x2305e3(0x140)](_0x2305e3(0x1a9),_0x6b22a5),loggerService_1[_0x2305e3(0x1a6)]['logWhiteDomainError'](_0x2305e3(0x167),_0x2305e3(0x183),_0x6b22a5);throw new Error(_0x2305e3(0x1a8)+(_0x6b22a5 instanceof Error?_0x6b22a5[_0x2305e3(0x14d)]:_0x2305e3(0x1af)));}}async['verifyPayment'](_0x2b70f2){const _0xd8f881=a40_0x1d367b,_0x1763e0=await this[_0xd8f881(0x15c)](_0x2b70f2);return{'status':_0x1763e0[_0xd8f881(0x17a)],'amount':_0x1763e0[_0xd8f881(0x1b3)],'currency':_0x1763e0['currency']};}async[a40_0x1d367b(0x197)](_0x15d8c9){const _0x318f2a=a40_0x1d367b;console['log'](_0x318f2a(0x151),_0x15d8c9);let _0x35b692='PENDING';switch(_0x15d8c9[_0x318f2a(0x17a)]?.[_0x318f2a(0x196)]()){case _0x318f2a(0x1bf):_0x35b692='PAID';break;case'cancelled':case _0x318f2a(0x1a7):case _0x318f2a(0x140):_0x35b692=_0x318f2a(0x14c);break;case'expired':case'timeout':_0x35b692=_0x318f2a(0x186);break;case _0x318f2a(0x191):case _0x318f2a(0x177):case _0x318f2a(0x13f):case _0x318f2a(0x1ad):default:_0x35b692=_0x318f2a(0x190);break;}return{'paymentId':_0x15d8c9[_0x318f2a(0x18c)]||_0x15d8c9[_0x318f2a(0x184)]||'','status':_0x35b692,'amount':_0x15d8c9[_0x318f2a(0x1b3)],'currency':_0x15d8c9['currency']||_0x318f2a(0x1bb)};}}exports['CoinToPayService']=CoinToPayService;