'use strict';const a55_0x32e0cb=a55_0x3df7;function a55_0x3d41(){const _0x5b172e=['/status','payment_url','parse','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','https://tesoft.uk/gateway/cointopay/status.php','expired','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','30oxZsrC','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Created\x20On:','708lGBgwk','\x20EUR','toLowerCase','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','success','checkPaymentStatus','now','not\x20found','status','awaiting\x20fiat','7089710qeHukJ','HTTP\x20','logWhiteDomainResponse','Error\x20Message:','gateway_payment_id','Amount','Payment\x20Status:','verifyPayment','error','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','1798885ZzeeWV','status_code','113376ezJfxQ','apiUrl','Unknown\x20error','134035uNhYil','Error\x20message:','Payment\x20URL\x20(modified):','/create','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===',',\x20body:\x20','Status\x20Code:','Status:','not\x20confirmed','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','fromEntries','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','text','Parsed\x20Result:','../loggerService','waiting','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','__esModule','POST','stack','log','JSON\x20Parse\x20Error:\x20','CoinToPay\x20API\x20error:\x20','message','CoinToPay\x20payment\x20status\x20check\x20error:','QRCodeURL','timeout','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','loggerService','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','13113PNBGUw','coinAddress','statusText','result','stringify','Currency:','order_id','pending','inputCurrency','&alternative=false','Result:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','EXPIRED','match','Status','FAILED','Error\x20details:','TransactionID','CoinToPayService','data','HTTP\x20error!\x20status:\x20','amount','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status\x20API\x20Error:\x20','Error\x20stack:','Response\x20data:','paid','Request\x20Body:','EUR','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Payment\x20URL\x20(original):','===\x20COINTOPAY\x20SUCCESS\x20===','Confirmed\x20On:','failed','Headers:','Response\x20Time:','1830563ljIRyK','PENDING','Raw\x20Response\x20Body:','logWhiteDomainError','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','application/json','ðŸ¦\x20Extracted\x20IBAN:','CoinToPay\x20status\x20API\x20error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','144NqCZYV','Status\x20Text:','TransactionConfirmedOn','6cOcOCS','logWhiteDomainRequest','Response\x20Body:','URL:','12jGNhTe','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','createPaymentLink','PAID','merchant_reference_id','created','Amount:','Business\x20Error:\x20','216909DbWxxK','cointopay','statusUrl','PaymentDetail','HTTP\x20Status:','Gateway\x20Payment\x20ID:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','entries','processWebhook'];a55_0x3d41=function(){return _0x5b172e;};return a55_0x3d41();}(function(_0x428d31,_0x18186c){const _0x2215cc=a55_0x3df7,_0x231dc2=_0x428d31();while(!![]){try{const _0x4cd071=-parseInt(_0x2215cc(0x243))/0x1*(parseInt(_0x2215cc(0x20e))/0x2)+-parseInt(_0x2215cc(0x1de))/0x3*(-parseInt(_0x2215cc(0x22d))/0x4)+-parseInt(_0x2215cc(0x246))/0x5*(-parseInt(_0x2215cc(0x22a))/0x6)+parseInt(_0x2215cc(0x202))/0x7+parseInt(_0x2215cc(0x20b))/0x8*(parseInt(_0x2215cc(0x21a))/0x9)+-parseInt(_0x2215cc(0x237))/0xa+-parseInt(_0x2215cc(0x241))/0xb*(parseInt(_0x2215cc(0x212))/0xc);if(_0x4cd071===_0x18186c)break;else _0x231dc2['push'](_0x231dc2['shift']());}catch(_0x473be9){_0x231dc2['push'](_0x231dc2['shift']());}}}(a55_0x3d41,0x5f4fb));function a55_0x3df7(_0xeaf6af,_0x11f198){_0xeaf6af=_0xeaf6af-0x1cd;const _0x3d413e=a55_0x3d41();let _0x3df78c=_0x3d413e[_0xeaf6af];return _0x3df78c;}Object['defineProperty'](exports,a55_0x32e0cb(0x1d1),{'value':!![]}),exports[a55_0x32e0cb(0x1f0)]=void 0x0;const loggerService_1=require(a55_0x32e0cb(0x1ce));class CoinToPayService{constructor(){const _0x2743b3=a55_0x32e0cb;this[_0x2743b3(0x244)]='https://tesoft.uk/gateway/cointopay/',this[_0x2743b3(0x21c)]=_0x2743b3(0x227),console['log'](_0x2743b3(0x250)),console['log']('ðŸ“Š\x20Status\x20check\x20URL:',this[_0x2743b3(0x21c)]);}async[a55_0x32e0cb(0x214)](_0x10dbd5){const _0x3e63c6=a55_0x32e0cb,{orderId:_0x48c2c9,amount:_0x4db1b8}=_0x10dbd5;console[_0x3e63c6(0x1d4)](_0x3e63c6(0x230)+_0x4db1b8+_0x3e63c6(0x22e));const _0x1a0482={'amount':_0x4db1b8},_0x429386=Date[_0x3e63c6(0x233)]();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console['log'](_0x3e63c6(0x211),this[_0x3e63c6(0x244)]),console[_0x3e63c6(0x1d4)](_0x3e63c6(0x1f9),JSON[_0x3e63c6(0x1e2)](_0x1a0482,null,0x2)),console[_0x3e63c6(0x1d4)](_0x3e63c6(0x218),_0x4db1b8,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x3e63c6(0x1dc)][_0x3e63c6(0x20f)]('cointopay',_0x3e63c6(0x249),_0x3e63c6(0x1d2),_0x1a0482);const _0x2d07de=await fetch(this[_0x3e63c6(0x244)],{'method':_0x3e63c6(0x1d2),'headers':{'Content-Type':'application/json','Accept':_0x3e63c6(0x207),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x3e63c6(0x1e2)](_0x1a0482)}),_0x33c22c=Date[_0x3e63c6(0x233)]()-_0x429386;console['log'](_0x3e63c6(0x24b)),console[_0x3e63c6(0x1d4)]('Status:',_0x2d07de['status']),console[_0x3e63c6(0x1d4)](_0x3e63c6(0x20c),_0x2d07de[_0x3e63c6(0x1e0)]),console[_0x3e63c6(0x1d4)](_0x3e63c6(0x200),Object[_0x3e63c6(0x251)](_0x2d07de['headers'][_0x3e63c6(0x221)]())),console[_0x3e63c6(0x1d4)](_0x3e63c6(0x201),_0x33c22c+'ms');const _0x50e0d2=await _0x2d07de['text']();console[_0x3e63c6(0x1d4)](_0x3e63c6(0x204),_0x50e0d2);if(!_0x2d07de['ok']){console[_0x3e63c6(0x23f)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x3e63c6(0x21e),_0x2d07de[_0x3e63c6(0x235)]),console[_0x3e63c6(0x23f)]('Response\x20Body:',_0x50e0d2),loggerService_1[_0x3e63c6(0x1dc)][_0x3e63c6(0x239)](_0x3e63c6(0x21b),_0x3e63c6(0x249),_0x2d07de[_0x3e63c6(0x235)],_0x50e0d2,_0x33c22c),loggerService_1['loggerService'][_0x3e63c6(0x205)](_0x3e63c6(0x21b),'/create',_0x3e63c6(0x238)+_0x2d07de['status']+':\x20'+_0x50e0d2);throw new Error(_0x3e63c6(0x1f2)+_0x2d07de[_0x3e63c6(0x235)]+_0x3e63c6(0x24c)+_0x50e0d2);}let _0x5a7fbd;try{_0x5a7fbd=JSON[_0x3e63c6(0x225)](_0x50e0d2);}catch(_0x2ec00e){console['error'](_0x3e63c6(0x24a),_0x2ec00e),loggerService_1[_0x3e63c6(0x1dc)][_0x3e63c6(0x205)](_0x3e63c6(0x21b),'/create','JSON\x20Parse\x20Error:\x20'+_0x2ec00e);throw new Error(_0x3e63c6(0x226)+_0x50e0d2);}console[_0x3e63c6(0x1d4)](_0x3e63c6(0x213)),console[_0x3e63c6(0x1d4)](_0x3e63c6(0x1cd),JSON[_0x3e63c6(0x1e2)](_0x5a7fbd,null,0x2)),loggerService_1[_0x3e63c6(0x1dc)][_0x3e63c6(0x239)](_0x3e63c6(0x21b),'/create',_0x2d07de[_0x3e63c6(0x235)],_0x5a7fbd,_0x33c22c);if(_0x5a7fbd['error']){const _0x223009=_0x5a7fbd[_0x3e63c6(0x1d7)]||_0x5a7fbd[_0x3e63c6(0x23f)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x3e63c6(0x23f)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x3e63c6(0x23a),_0x223009),loggerService_1[_0x3e63c6(0x1dc)][_0x3e63c6(0x205)](_0x3e63c6(0x21b),_0x3e63c6(0x249),_0x3e63c6(0x219)+_0x223009);throw new Error(_0x3e63c6(0x1d6)+_0x223009);}if(!_0x5a7fbd['payment_url']||!_0x5a7fbd[_0x3e63c6(0x23b)]){console[_0x3e63c6(0x23f)](_0x3e63c6(0x1e9)),console[_0x3e63c6(0x23f)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x3e63c6(0x23f)](_0x3e63c6(0x1f7),_0x5a7fbd),loggerService_1[_0x3e63c6(0x1dc)][_0x3e63c6(0x205)]('cointopay',_0x3e63c6(0x249),_0x3e63c6(0x1f4));throw new Error(_0x3e63c6(0x206));}console['log'](_0x3e63c6(0x1fd)),console['log'](_0x3e63c6(0x21f),_0x5a7fbd[_0x3e63c6(0x23b)]),console['log'](_0x3e63c6(0x1fc),_0x5a7fbd[_0x3e63c6(0x224)]);const _0xeda772=_0x5a7fbd[_0x3e63c6(0x224)]+_0x3e63c6(0x1e7);return console['log'](_0x3e63c6(0x248),_0xeda772),console[_0x3e63c6(0x1d4)](_0x3e63c6(0x218),_0x4db1b8,_0x3e63c6(0x1fa)),{'gateway_payment_id':_0x5a7fbd['gateway_payment_id'],'payment_url':_0xeda772};}catch(_0x47b2e7){console[_0x3e63c6(0x23f)](_0x3e63c6(0x1dd)),console[_0x3e63c6(0x23f)](_0x3e63c6(0x1ee),_0x47b2e7),loggerService_1[_0x3e63c6(0x1dc)][_0x3e63c6(0x205)](_0x3e63c6(0x21b),_0x3e63c6(0x249),_0x47b2e7);if(_0x47b2e7 instanceof Error){console[_0x3e63c6(0x23f)](_0x3e63c6(0x247),_0x47b2e7[_0x3e63c6(0x1d7)]),console['error'](_0x3e63c6(0x1f6),_0x47b2e7[_0x3e63c6(0x1d3)]);throw new Error(_0x3e63c6(0x20a)+_0x47b2e7[_0x3e63c6(0x1d7)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a55_0x32e0cb(0x232)](_0x46fa1a){const _0x2e06c=a55_0x32e0cb,_0x265e57=Date[_0x2e06c(0x233)]();try{console['log'](_0x2e06c(0x229)+_0x46fa1a);const _0x6c1f6c={'gatewayPaymentId':_0x46fa1a};loggerService_1[_0x2e06c(0x1dc)]['logWhiteDomainRequest'](_0x2e06c(0x21b),_0x2e06c(0x223),'POST',_0x6c1f6c);const _0x2fbf3f=await fetch(this['statusUrl'],{'method':_0x2e06c(0x1d2),'headers':{'Content-Type':'application/json','Accept':_0x2e06c(0x207),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x2e06c(0x1e2)](_0x6c1f6c)}),_0x4cfbf=Date['now']()-_0x265e57;console[_0x2e06c(0x1d4)](_0x2e06c(0x22b)),console[_0x2e06c(0x1d4)](_0x2e06c(0x24e),_0x2fbf3f['status']),console['log'](_0x2e06c(0x201),_0x4cfbf+'ms');if(!_0x2fbf3f['ok']){const _0x28adac=await _0x2fbf3f[_0x2e06c(0x253)]();console[_0x2e06c(0x23f)](_0x2e06c(0x21e),_0x2fbf3f['status']),console[_0x2e06c(0x23f)](_0x2e06c(0x210),_0x28adac),loggerService_1[_0x2e06c(0x1dc)][_0x2e06c(0x239)](_0x2e06c(0x21b),_0x2e06c(0x223),_0x2fbf3f[_0x2e06c(0x235)],_0x28adac,_0x4cfbf),loggerService_1[_0x2e06c(0x1dc)][_0x2e06c(0x205)](_0x2e06c(0x21b),_0x2e06c(0x223),_0x2e06c(0x238)+_0x2fbf3f[_0x2e06c(0x235)]+':\x20'+_0x28adac);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2fbf3f[_0x2e06c(0x235)]);}const _0x1aa6f8=await _0x2fbf3f['text']();console[_0x2e06c(0x1d4)](_0x2e06c(0x204),_0x1aa6f8);let _0x20b46d;try{_0x20b46d=JSON[_0x2e06c(0x225)](_0x1aa6f8);}catch(_0x47ba64){console[_0x2e06c(0x23f)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x47ba64),loggerService_1[_0x2e06c(0x1dc)]['logWhiteDomainError'](_0x2e06c(0x21b),_0x2e06c(0x223),_0x2e06c(0x1d5)+_0x47ba64);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x1aa6f8);}loggerService_1[_0x2e06c(0x1dc)][_0x2e06c(0x239)](_0x2e06c(0x21b),_0x2e06c(0x223),_0x2fbf3f[_0x2e06c(0x235)],_0x20b46d,_0x4cfbf),console[_0x2e06c(0x1d4)](_0x2e06c(0x252)),console[_0x2e06c(0x1d4)](_0x2e06c(0x1e8),_0x20b46d[_0x2e06c(0x1e1)]),console['log'](_0x2e06c(0x24d),_0x20b46d['status_code']),console[_0x2e06c(0x1d4)](_0x2e06c(0x23d),_0x20b46d[_0x2e06c(0x1f1)]?.[_0x2e06c(0x1ec)]),console[_0x2e06c(0x1d4)]('Amount:',_0x20b46d[_0x2e06c(0x1f1)]?.[_0x2e06c(0x23c)]),console['log'](_0x2e06c(0x1e3),_0x20b46d[_0x2e06c(0x1f1)]?.['inputCurrency']);if(_0x20b46d[_0x2e06c(0x1e1)]!==_0x2e06c(0x231)||_0x20b46d[_0x2e06c(0x242)]!==0xc8){const _0x37ebb6=_0x20b46d[_0x2e06c(0x1d7)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x2e06c(0x23f)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x2e06c(0x23f)]('Error\x20Message:',_0x37ebb6),loggerService_1['loggerService'][_0x2e06c(0x205)](_0x2e06c(0x21b),'/status',_0x2e06c(0x1f5)+_0x37ebb6);throw new Error(_0x2e06c(0x209)+_0x37ebb6);}if(!_0x20b46d['data']){console[_0x2e06c(0x23f)](_0x2e06c(0x240)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x2e06c(0x1dc)][_0x2e06c(0x205)]('cointopay',_0x2e06c(0x223),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x2e06c(0x1d0));}let _0x91c263='PENDING';switch(_0x20b46d[_0x2e06c(0x1f1)][_0x2e06c(0x1ec)]?.[_0x2e06c(0x22f)]()){case _0x2e06c(0x1f8):_0x91c263=_0x2e06c(0x215);break;case'cancelled':case _0x2e06c(0x1ff):case _0x2e06c(0x23f):_0x91c263=_0x2e06c(0x1ed);break;case _0x2e06c(0x228):case _0x2e06c(0x1da):_0x91c263=_0x2e06c(0x1ea);break;case _0x2e06c(0x1cf):case _0x2e06c(0x236):case'pending':case _0x2e06c(0x217):default:_0x91c263=_0x2e06c(0x203);break;}let _0x35af15,_0x13e911;if(_0x20b46d[_0x2e06c(0x1f1)][_0x2e06c(0x21d)]){const _0x2e6b0f=_0x20b46d['data'][_0x2e06c(0x21d)];console['log']('ðŸ¦\x20Payment\x20Detail:',_0x2e6b0f);const _0xc0a231=_0x2e6b0f[_0x2e06c(0x1eb)](/IBAN\s+([A-Z0-9]+)/i);_0xc0a231&&(_0x35af15=_0xc0a231[0x1],console[_0x2e06c(0x1d4)](_0x2e06c(0x208),_0x35af15)),_0x13e911=_0x2e6b0f;}const _0x364e8c={'iban':_0x35af15,'bankDetails':_0x13e911,'transactionId':_0x20b46d[_0x2e06c(0x1f1)][_0x2e06c(0x1ef)],'coinAddress':_0x20b46d[_0x2e06c(0x1f1)][_0x2e06c(0x1df)],'qrCodeUrl':_0x20b46d[_0x2e06c(0x1f1)][_0x2e06c(0x1d9)],'expiryTime':_0x20b46d[_0x2e06c(0x1f1)]['ExpiryTime'],'createdOn':_0x20b46d[_0x2e06c(0x1f1)]['CreatedOn'],'confirmedOn':_0x20b46d['data'][_0x2e06c(0x20d)]};console[_0x2e06c(0x1d4)](_0x2e06c(0x1fb)),console[_0x2e06c(0x1d4)](_0x2e06c(0x24e),_0x20b46d['data']['Status'],'->',_0x91c263),console[_0x2e06c(0x1d4)](_0x2e06c(0x218),_0x20b46d[_0x2e06c(0x1f1)]['Amount'],_0x20b46d[_0x2e06c(0x1f1)]['inputCurrency']),console[_0x2e06c(0x1d4)]('Transaction\x20ID:',_0x20b46d['data'][_0x2e06c(0x1ef)]),console[_0x2e06c(0x1d4)]('IBAN:',_0x35af15||_0x2e06c(0x234)),console[_0x2e06c(0x1d4)](_0x2e06c(0x22c),_0x20b46d[_0x2e06c(0x1f1)]['CreatedOn']),console[_0x2e06c(0x1d4)](_0x2e06c(0x1fe),_0x20b46d[_0x2e06c(0x1f1)]['TransactionConfirmedOn']||_0x2e06c(0x24f));if(_0x20b46d[_0x2e06c(0x1f1)]['Status']?.['toLowerCase']()===_0x2e06c(0x236))console[_0x2e06c(0x1d4)]('ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x20b46d[_0x2e06c(0x1f1)]['Status']?.[_0x2e06c(0x22f)]()===_0x2e06c(0x1f8)&&console[_0x2e06c(0x1d4)]('âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x91c263,'amount':parseFloat(_0x20b46d[_0x2e06c(0x1f1)][_0x2e06c(0x23c)])||undefined,'currency':_0x20b46d[_0x2e06c(0x1f1)][_0x2e06c(0x1e6)]||_0x2e06c(0x1fa),'paymentDetails':_0x364e8c};}catch(_0x46b9f0){console[_0x2e06c(0x23f)](_0x2e06c(0x1d8),_0x46b9f0),loggerService_1[_0x2e06c(0x1dc)][_0x2e06c(0x205)](_0x2e06c(0x21b),'/status',_0x46b9f0);throw new Error(_0x2e06c(0x1db)+(_0x46b9f0 instanceof Error?_0x46b9f0[_0x2e06c(0x1d7)]:_0x2e06c(0x245)));}}async[a55_0x32e0cb(0x23e)](_0x29b76b){const _0x1eef96=a55_0x32e0cb,_0x12bbc9=await this[_0x1eef96(0x232)](_0x29b76b);return{'status':_0x12bbc9['status'],'amount':_0x12bbc9[_0x1eef96(0x1f3)],'currency':_0x12bbc9['currency']};}async[a55_0x32e0cb(0x222)](_0x4a3d52){const _0x385165=a55_0x32e0cb;console[_0x385165(0x1d4)](_0x385165(0x220),_0x4a3d52);let _0x1dfaf9='PENDING';switch(_0x4a3d52[_0x385165(0x235)]?.[_0x385165(0x22f)]()){case _0x385165(0x1f8):_0x1dfaf9=_0x385165(0x215);break;case'cancelled':case _0x385165(0x1ff):case _0x385165(0x23f):_0x1dfaf9=_0x385165(0x1ed);break;case'expired':case _0x385165(0x1da):_0x1dfaf9=_0x385165(0x1ea);break;case _0x385165(0x1e5):case _0x385165(0x1cf):case _0x385165(0x236):case _0x385165(0x217):default:_0x1dfaf9=_0x385165(0x203);break;}return{'paymentId':_0x4a3d52[_0x385165(0x1e4)]||_0x4a3d52[_0x385165(0x216)]||'','status':_0x1dfaf9,'amount':_0x4a3d52[_0x385165(0x1f3)],'currency':_0x4a3d52['currency']||'EUR'};}}exports[a55_0x32e0cb(0x1f0)]=CoinToPayService;