'use strict';function a37_0x15fd(){const _0x581a76=['===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Amount:','toLowerCase','715950bFCVwX','inputCurrency','Status','Response\x20data:','HTTP\x20','Result:','log','Transaction\x20ID:','Unknown\x20error','202838SCiCJu','CoinToPay\x20payment\x20status\x20check\x20error:','PENDING','Amount','cointopay','paid','QRCodeURL','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','/create','timeout','POST','EUR','failed','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','awaiting\x20fiat','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Error\x20details:','success','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','PAID','Response\x20Body:','stringify','data','expired','HTTP\x20Status:','313032wSzVqF','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','processWebhook','entries','payment_url','parse','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','merchant_reference_id','logWhiteDomainRequest','1414080QleoES','not\x20confirmed','\x20EUR','Raw\x20Response\x20Body:','message','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','loggerService','created','logWhiteDomainError','verifyPayment','TesSoft\x20Payment\x20System/1.0','https://tesoft.uk/gateway/cointopay/status.php','checkPaymentStatus','pending','JSON\x20Parse\x20Error:\x20','FAILED','IBAN:','Status\x20API\x20Error:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','12607ZsDvIT','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','headers','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','TransactionConfirmedOn','üè¶\x20Payment\x20Detail:','Error\x20message:','45IsncgS','CoinToPayService','CreatedOn','===\x20COINTOPAY\x20SUCCESS\x20===','statusText','fromEntries','application/json','defineProperty','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','error','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','coinAddress','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Business\x20Error:\x20','CoinToPay\x20status\x20API\x20error:\x20','Missing\x20data\x20in\x20response','statusUrl','Request\x20Body:','status','https://tesoft.uk/gateway/cointopay/','currency','2QbVCsR','Confirmed\x20On:','match','amount','Status:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','logWhiteDomainResponse','üè¶\x20Extracted\x20IBAN:','/status','TransactionID','Status\x20Text:','2154936ijkgeM','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','URL:','27268OAewEx','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Failed\x20to\x20parse\x20JSON\x20response:','createPaymentLink','__esModule','Payment\x20URL:','result','text','Response\x20Time:','gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','HTTP\x20error!\x20status:\x20','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API',',\x20body:\x20','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','apiUrl','EXPIRED','waiting','now','Status\x20Code:','cancelled'];a37_0x15fd=function(){return _0x581a76;};return a37_0x15fd();}const a37_0x5df064=a37_0x5298;(function(_0x3282c8,_0x450db9){const _0x4d116c=a37_0x5298,_0x2801fc=_0x3282c8();while(!![]){try{const _0x4d0ce0=-parseInt(_0x4d116c(0x1cb))/0x1*(-parseInt(_0x4d116c(0x176))/0x2)+-parseInt(_0x4d116c(0x1b5))/0x3*(-parseInt(_0x4d116c(0x1d9))/0x4)+parseInt(_0x4d116c(0x19b))/0x5+-parseInt(_0x4d116c(0x190))/0x6+-parseInt(_0x4d116c(0x1ae))/0x7+-parseInt(_0x4d116c(0x1d6))/0x8+-parseInt(_0x4d116c(0x16d))/0x9;if(_0x4d0ce0===_0x450db9)break;else _0x2801fc['push'](_0x2801fc['shift']());}catch(_0x42ba99){_0x2801fc['push'](_0x2801fc['shift']());}}}(a37_0x15fd,0x2d2bb));function a37_0x5298(_0x276d43,_0x4a366c){const _0x15fd62=a37_0x15fd();return a37_0x5298=function(_0x529810,_0x237e5a){_0x529810=_0x529810-0x15f;let _0x44a4bd=_0x15fd62[_0x529810];return _0x44a4bd;},a37_0x5298(_0x276d43,_0x4a366c);}Object[a37_0x5df064(0x1bc)](exports,a37_0x5df064(0x1dd),{'value':!![]}),exports[a37_0x5df064(0x1b6)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x4f5d22=a37_0x5df064;this[_0x4f5d22(0x164)]=_0x4f5d22(0x1c9),this[_0x4f5d22(0x1c6)]=_0x4f5d22(0x1a6),console[_0x4f5d22(0x173)](_0x4f5d22(0x17d)),console['log']('üìä\x20Status\x20check\x20URL:',this['statusUrl']);}async[a37_0x5df064(0x1dc)](_0x155f3c){const _0xb7a3dd=a37_0x5df064,{orderId:_0x5029e8,amount:_0x1e79c9}=_0x155f3c;console[_0xb7a3dd(0x173)](_0xb7a3dd(0x191)+_0x1e79c9+_0xb7a3dd(0x19d));const _0x3decdf={'amount':_0x1e79c9},_0x147331=Date[_0xb7a3dd(0x167)]();try{console[_0xb7a3dd(0x173)](_0xb7a3dd(0x186)),console[_0xb7a3dd(0x173)](_0xb7a3dd(0x1d8),this[_0xb7a3dd(0x164)]),console['log'](_0xb7a3dd(0x1c7),JSON[_0xb7a3dd(0x18c)](_0x3decdf,null,0x2)),console['log'](_0xb7a3dd(0x16b),_0x1e79c9,_0xb7a3dd(0x1bd)),loggerService_1[_0xb7a3dd(0x1a1)][_0xb7a3dd(0x19a)](_0xb7a3dd(0x17a),_0xb7a3dd(0x17f),'POST',_0x3decdf);const _0x1f7cd9=await fetch(this[_0xb7a3dd(0x164)],{'method':_0xb7a3dd(0x181),'headers':{'Content-Type':_0xb7a3dd(0x1bb),'Accept':'application/json','User-Agent':_0xb7a3dd(0x1a5)},'body':JSON[_0xb7a3dd(0x18c)](_0x3decdf)}),_0x1749ef=Date[_0xb7a3dd(0x167)]()-_0x147331;console[_0xb7a3dd(0x173)](_0xb7a3dd(0x1ad)),console['log']('Status:',_0x1f7cd9['status']),console[_0xb7a3dd(0x173)](_0xb7a3dd(0x1d5),_0x1f7cd9[_0xb7a3dd(0x1b9)]),console[_0xb7a3dd(0x173)]('Headers:',Object[_0xb7a3dd(0x1ba)](_0x1f7cd9[_0xb7a3dd(0x1b0)][_0xb7a3dd(0x195)]())),console[_0xb7a3dd(0x173)](_0xb7a3dd(0x1e1),_0x1749ef+'ms');const _0x1636d4=await _0x1f7cd9['text']();console[_0xb7a3dd(0x173)](_0xb7a3dd(0x19e),_0x1636d4);if(!_0x1f7cd9['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0xb7a3dd(0x1be)](_0xb7a3dd(0x18f),_0x1f7cd9['status']),console[_0xb7a3dd(0x1be)](_0xb7a3dd(0x18b),_0x1636d4),loggerService_1['loggerService']['logWhiteDomainResponse'](_0xb7a3dd(0x17a),_0xb7a3dd(0x17f),_0x1f7cd9['status'],_0x1636d4,_0x1749ef),loggerService_1['loggerService'][_0xb7a3dd(0x1a3)](_0xb7a3dd(0x17a),_0xb7a3dd(0x17f),_0xb7a3dd(0x171)+_0x1f7cd9[_0xb7a3dd(0x1c8)]+':\x20'+_0x1636d4);throw new Error(_0xb7a3dd(0x160)+_0x1f7cd9[_0xb7a3dd(0x1c8)]+_0xb7a3dd(0x162)+_0x1636d4);}let _0x4b256b;try{_0x4b256b=JSON['parse'](_0x1636d4);}catch(_0x213d53){console[_0xb7a3dd(0x1be)](_0xb7a3dd(0x1db),_0x213d53),loggerService_1['loggerService'][_0xb7a3dd(0x1a3)]('cointopay',_0xb7a3dd(0x17f),'JSON\x20Parse\x20Error:\x20'+_0x213d53);throw new Error(_0xb7a3dd(0x192)+_0x1636d4);}console[_0xb7a3dd(0x173)](_0xb7a3dd(0x1da)),console[_0xb7a3dd(0x173)]('Parsed\x20Result:',JSON[_0xb7a3dd(0x18c)](_0x4b256b,null,0x2)),loggerService_1['loggerService'][_0xb7a3dd(0x1d1)](_0xb7a3dd(0x17a),_0xb7a3dd(0x17f),_0x1f7cd9['status'],_0x4b256b,_0x1749ef);if(_0x4b256b[_0xb7a3dd(0x1be)]){const _0x222e28=_0x4b256b[_0xb7a3dd(0x19f)]||_0x4b256b[_0xb7a3dd(0x1be)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0xb7a3dd(0x1be)](_0xb7a3dd(0x184)),console['error']('Error\x20Message:',_0x222e28),loggerService_1[_0xb7a3dd(0x1a1)][_0xb7a3dd(0x1a3)]('cointopay',_0xb7a3dd(0x17f),_0xb7a3dd(0x1c3)+_0x222e28);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x222e28);}if(!_0x4b256b[_0xb7a3dd(0x196)]||!_0x4b256b[_0xb7a3dd(0x1e2)]){console[_0xb7a3dd(0x1be)](_0xb7a3dd(0x1b1)),console[_0xb7a3dd(0x1be)](_0xb7a3dd(0x17e)),console[_0xb7a3dd(0x1be)](_0xb7a3dd(0x170),_0x4b256b),loggerService_1['loggerService']['logWhiteDomainError'](_0xb7a3dd(0x17a),_0xb7a3dd(0x17f),_0xb7a3dd(0x1af));throw new Error(_0xb7a3dd(0x1c0));}return console[_0xb7a3dd(0x173)](_0xb7a3dd(0x1b8)),console['log']('Gateway\x20Payment\x20ID:',_0x4b256b[_0xb7a3dd(0x1e2)]),console[_0xb7a3dd(0x173)](_0xb7a3dd(0x1de),_0x4b256b[_0xb7a3dd(0x196)]),console[_0xb7a3dd(0x173)](_0xb7a3dd(0x16b),_0x1e79c9,_0xb7a3dd(0x182)),{'gateway_payment_id':_0x4b256b[_0xb7a3dd(0x1e2)],'payment_url':_0x4b256b['payment_url']};}catch(_0x2f0a82){console['error'](_0xb7a3dd(0x193)),console['error'](_0xb7a3dd(0x187),_0x2f0a82),loggerService_1[_0xb7a3dd(0x1a1)][_0xb7a3dd(0x1a3)](_0xb7a3dd(0x17a),_0xb7a3dd(0x17f),_0x2f0a82);if(_0x2f0a82 instanceof Error){console[_0xb7a3dd(0x1be)](_0xb7a3dd(0x1b4),_0x2f0a82[_0xb7a3dd(0x19f)]),console[_0xb7a3dd(0x1be)]('Error\x20stack:',_0x2f0a82['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x2f0a82[_0xb7a3dd(0x19f)]);}throw new Error(_0xb7a3dd(0x1a0));}}async[a37_0x5df064(0x1a7)](_0xc596e0){const _0x9b969a=a37_0x5df064,_0xfc9d73=Date['now']();try{console[_0x9b969a(0x173)](_0x9b969a(0x1c2)+_0xc596e0);const _0x413e1b={'gatewayPaymentId':_0xc596e0};loggerService_1[_0x9b969a(0x1a1)][_0x9b969a(0x19a)](_0x9b969a(0x17a),_0x9b969a(0x1d3),'POST',_0x413e1b);const _0x9bf316=await fetch(this[_0x9b969a(0x1c6)],{'method':_0x9b969a(0x181),'headers':{'Content-Type':_0x9b969a(0x1bb),'Accept':_0x9b969a(0x1bb),'User-Agent':_0x9b969a(0x1a5)},'body':JSON['stringify'](_0x413e1b)}),_0x3bf52e=Date[_0x9b969a(0x167)]()-_0xfc9d73;console[_0x9b969a(0x173)](_0x9b969a(0x198)),console['log'](_0x9b969a(0x1cf),_0x9bf316[_0x9b969a(0x1c8)]),console[_0x9b969a(0x173)](_0x9b969a(0x1e1),_0x3bf52e+'ms');if(!_0x9bf316['ok']){const _0x1762db=await _0x9bf316[_0x9b969a(0x1e0)]();console[_0x9b969a(0x1be)](_0x9b969a(0x18f),_0x9bf316[_0x9b969a(0x1c8)]),console[_0x9b969a(0x1be)](_0x9b969a(0x18b),_0x1762db),loggerService_1[_0x9b969a(0x1a1)]['logWhiteDomainResponse'](_0x9b969a(0x17a),'/status',_0x9bf316[_0x9b969a(0x1c8)],_0x1762db,_0x3bf52e),loggerService_1[_0x9b969a(0x1a1)][_0x9b969a(0x1a3)]('cointopay',_0x9b969a(0x1d3),_0x9b969a(0x171)+_0x9bf316['status']+':\x20'+_0x1762db);throw new Error(_0x9b969a(0x160)+_0x9bf316['status']);}const _0x2644d6=await _0x9bf316['text']();console[_0x9b969a(0x173)]('Raw\x20Response\x20Body:',_0x2644d6);let _0x115132;try{_0x115132=JSON[_0x9b969a(0x197)](_0x2644d6);}catch(_0x26a7d8){console[_0x9b969a(0x1be)](_0x9b969a(0x1db),_0x26a7d8),loggerService_1[_0x9b969a(0x1a1)]['logWhiteDomainError'](_0x9b969a(0x17a),_0x9b969a(0x1d3),_0x9b969a(0x1a9)+_0x26a7d8);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x2644d6);}loggerService_1[_0x9b969a(0x1a1)]['logWhiteDomainResponse'](_0x9b969a(0x17a),_0x9b969a(0x1d3),_0x9bf316[_0x9b969a(0x1c8)],_0x115132,_0x3bf52e),console[_0x9b969a(0x173)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x9b969a(0x173)](_0x9b969a(0x172),_0x115132['result']),console[_0x9b969a(0x173)](_0x9b969a(0x168),_0x115132['status_code']),console['log']('Payment\x20Status:',_0x115132[_0x9b969a(0x18d)]?.[_0x9b969a(0x16f)]),console[_0x9b969a(0x173)](_0x9b969a(0x16b),_0x115132[_0x9b969a(0x18d)]?.[_0x9b969a(0x179)]),console[_0x9b969a(0x173)]('Currency:',_0x115132['data']?.[_0x9b969a(0x16e)]);if(_0x115132[_0x9b969a(0x1df)]!==_0x9b969a(0x188)||_0x115132['status_code']!==0xc8){const _0x13d1fa=_0x115132['message']||_0x9b969a(0x161);console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x13d1fa),loggerService_1[_0x9b969a(0x1a1)][_0x9b969a(0x1a3)]('cointopay',_0x9b969a(0x1d3),_0x9b969a(0x1ac)+_0x13d1fa);throw new Error(_0x9b969a(0x1c4)+_0x13d1fa);}if(!_0x115132['data']){console[_0x9b969a(0x1be)](_0x9b969a(0x16a)),console['error'](_0x9b969a(0x1c5)),loggerService_1[_0x9b969a(0x1a1)][_0x9b969a(0x1a3)](_0x9b969a(0x17a),_0x9b969a(0x1d3),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x9b969a(0x1bf));}let _0x50f360='PENDING';switch(_0x115132[_0x9b969a(0x18d)]['Status']?.[_0x9b969a(0x16c)]()){case _0x9b969a(0x17b):_0x50f360=_0x9b969a(0x18a);break;case _0x9b969a(0x169):case'failed':case'error':_0x50f360=_0x9b969a(0x1aa);break;case _0x9b969a(0x18e):case _0x9b969a(0x180):_0x50f360=_0x9b969a(0x165);break;case _0x9b969a(0x166):case _0x9b969a(0x185):case'pending':case _0x9b969a(0x1a2):default:_0x50f360=_0x9b969a(0x178);break;}let _0x457265,_0x2eef4;if(_0x115132[_0x9b969a(0x18d)]['PaymentDetail']){const _0x15b25e=_0x115132['data']['PaymentDetail'];console[_0x9b969a(0x173)](_0x9b969a(0x1b3),_0x15b25e);const _0x2ef8f9=_0x15b25e[_0x9b969a(0x1cd)](/IBAN\s+([A-Z0-9]+)/i);_0x2ef8f9&&(_0x457265=_0x2ef8f9[0x1],console[_0x9b969a(0x173)](_0x9b969a(0x1d2),_0x457265)),_0x2eef4=_0x15b25e;}const _0x39857f={'iban':_0x457265,'bankDetails':_0x2eef4,'transactionId':_0x115132[_0x9b969a(0x18d)][_0x9b969a(0x1d4)],'coinAddress':_0x115132[_0x9b969a(0x18d)][_0x9b969a(0x1c1)],'qrCodeUrl':_0x115132['data'][_0x9b969a(0x17c)],'expiryTime':_0x115132[_0x9b969a(0x18d)]['ExpiryTime'],'createdOn':_0x115132[_0x9b969a(0x18d)][_0x9b969a(0x1b7)],'confirmedOn':_0x115132[_0x9b969a(0x18d)][_0x9b969a(0x1b2)]};console['log'](_0x9b969a(0x15f)),console[_0x9b969a(0x173)](_0x9b969a(0x1cf),_0x115132[_0x9b969a(0x18d)][_0x9b969a(0x16f)],'->',_0x50f360),console['log'](_0x9b969a(0x16b),_0x115132['data'][_0x9b969a(0x179)],_0x115132['data']['inputCurrency']),console['log'](_0x9b969a(0x174),_0x115132[_0x9b969a(0x18d)][_0x9b969a(0x1d4)]),console[_0x9b969a(0x173)](_0x9b969a(0x1ab),_0x457265||'not\x20found'),console[_0x9b969a(0x173)]('Created\x20On:',_0x115132[_0x9b969a(0x18d)][_0x9b969a(0x1b7)]),console['log'](_0x9b969a(0x1cc),_0x115132[_0x9b969a(0x18d)][_0x9b969a(0x1b2)]||_0x9b969a(0x19c));if(_0x115132[_0x9b969a(0x18d)][_0x9b969a(0x16f)]?.[_0x9b969a(0x16c)]()===_0x9b969a(0x185))console['log'](_0x9b969a(0x189));else _0x115132[_0x9b969a(0x18d)][_0x9b969a(0x16f)]?.[_0x9b969a(0x16c)]()==='paid'&&console[_0x9b969a(0x173)](_0x9b969a(0x163));return{'status':_0x50f360,'amount':parseFloat(_0x115132[_0x9b969a(0x18d)][_0x9b969a(0x179)])||undefined,'currency':_0x115132['data'][_0x9b969a(0x16e)]||_0x9b969a(0x182),'paymentDetails':_0x39857f};}catch(_0x1c0d8b){console[_0x9b969a(0x1be)](_0x9b969a(0x177),_0x1c0d8b),loggerService_1[_0x9b969a(0x1a1)][_0x9b969a(0x1a3)](_0x9b969a(0x17a),_0x9b969a(0x1d3),_0x1c0d8b);throw new Error(_0x9b969a(0x1d0)+(_0x1c0d8b instanceof Error?_0x1c0d8b['message']:_0x9b969a(0x175)));}}async[a37_0x5df064(0x1a4)](_0x4b4755){const _0x38dad0=a37_0x5df064,_0x39417d=await this[_0x38dad0(0x1a7)](_0x4b4755);return{'status':_0x39417d['status'],'amount':_0x39417d['amount'],'currency':_0x39417d[_0x38dad0(0x1ca)]};}async[a37_0x5df064(0x194)](_0x1e79b7){const _0x4fbeee=a37_0x5df064;console[_0x4fbeee(0x173)](_0x4fbeee(0x1d7),_0x1e79b7);let _0x57789c='PENDING';switch(_0x1e79b7[_0x4fbeee(0x1c8)]?.[_0x4fbeee(0x16c)]()){case _0x4fbeee(0x17b):_0x57789c=_0x4fbeee(0x18a);break;case _0x4fbeee(0x169):case _0x4fbeee(0x183):case _0x4fbeee(0x1be):_0x57789c='FAILED';break;case _0x4fbeee(0x18e):case _0x4fbeee(0x180):_0x57789c=_0x4fbeee(0x165);break;case _0x4fbeee(0x1a8):case'waiting':case _0x4fbeee(0x185):case _0x4fbeee(0x1a2):default:_0x57789c='PENDING';break;}return{'paymentId':_0x1e79b7['order_id']||_0x1e79b7[_0x4fbeee(0x199)]||'','status':_0x57789c,'amount':_0x1e79b7[_0x4fbeee(0x1ce)],'currency':_0x1e79b7[_0x4fbeee(0x1ca)]||_0x4fbeee(0x182)};}}exports[a37_0x5df064(0x1b6)]=CoinToPayService;