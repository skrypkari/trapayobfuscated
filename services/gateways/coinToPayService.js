'use strict';const a40_0x4aa4d7=a40_0xf147;function a40_0x2411(){const _0xbfe32a=['Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20COINTOPAY\x20SUCCESS\x20===','EXPIRED','not\x20found','HTTP\x20','Error\x20Message:','Currency:','not\x20confirmed','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Error\x20details:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','174520oQASWO','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20API\x20ERROR\x20===','created','expired','https://tesoft.uk/gateway/cointopay/status.php','Incomplete\x20response:\x20missing\x20data','parse','Response\x20Time:','success','Unknown\x20error\x20from\x20CoinToPay\x20API','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','CreatedOn','pending','/create','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','POST','cancelled','Parsed\x20Result:','Raw\x20Response\x20Body:','10iFXMZl','Confirmed\x20On:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','/status','üìä\x20Status\x20check\x20URL:','Missing\x20data\x20in\x20response','status',',\x20body:\x20','131682FXXetu','JSON\x20Parse\x20Error:\x20','Error\x20stack:','TesSoft\x20Payment\x20System/1.0','Response\x20Body:','PAID','gateway_payment_id','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','HTTP\x20error!\x20status:\x20','logWhiteDomainRequest','result','data','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','processWebhook','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','199884FNiGcv','10KjBqKr','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','3630006RrlFnI','Status','currency','Request\x20Body:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','checkPaymentStatus','14oizBRv','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','EUR','waiting','Result:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','coinAddress','order_id','toLowerCase','error','ExpiryTime','message','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','108110ZMXmLX','verifyPayment','Failed\x20to\x20parse\x20JSON\x20response:','paid','apiUrl','now','fromEntries','stringify','üè¶\x20Extracted\x20IBAN:','log','PENDING','status_code','Status\x20API\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Business\x20Error:\x20','payment_url','amount','Response\x20data:','awaiting\x20fiat','CoinToPay\x20API\x20error:\x20','501207dmMyQB','Amount:','TransactionConfirmedOn','QRCodeURL','application/json','text','Gateway\x20Payment\x20ID:','defineProperty','logWhiteDomainError','CoinToPayService','cointopay','Amount','Error\x20message:','statusUrl','createPaymentLink','entries','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','662604MncOKZ','CoinToPay\x20payment\x20status\x20check\x20error:','timeout','Status\x20Text:','logWhiteDomainResponse','merchant_reference_id','PaymentDetail','failed','245GWtIJS','FAILED','HTTP\x20Status:','loggerService','headers','stack','inputCurrency','Payment\x20Status:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','407IKNCjr','__esModule','TransactionID','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):'];a40_0x2411=function(){return _0xbfe32a;};return a40_0x2411();}function a40_0xf147(_0x440c9c,_0x2c753c){const _0x241159=a40_0x2411();return a40_0xf147=function(_0xf14778,_0xeb387f){_0xf14778=_0xf14778-0x12d;let _0x3885ac=_0x241159[_0xf14778];return _0x3885ac;},a40_0xf147(_0x440c9c,_0x2c753c);}(function(_0x5e73aa,_0x3fe5cc){const _0x207932=a40_0xf147,_0x409d21=_0x5e73aa();while(!![]){try{const _0x399d58=parseInt(_0x207932(0x1a0))/0x1*(parseInt(_0x207932(0x1ad))/0x2)+parseInt(_0x207932(0x13b))/0x3+-parseInt(_0x207932(0x14c))/0x4+-parseInt(_0x207932(0x198))/0x5*(parseInt(_0x207932(0x188))/0x6)+parseInt(_0x207932(0x154))/0x7*(parseInt(_0x207932(0x16c))/0x8)+-parseInt(_0x207932(0x19a))/0x9*(parseInt(_0x207932(0x180))/0xa)+parseInt(_0x207932(0x15d))/0xb*(-parseInt(_0x207932(0x197))/0xc);if(_0x399d58===_0x3fe5cc)break;else _0x409d21['push'](_0x409d21['shift']());}catch(_0x573cc5){_0x409d21['push'](_0x409d21['shift']());}}}(a40_0x2411,0x6fdc0));Object[a40_0x4aa4d7(0x142)](exports,a40_0x4aa4d7(0x15e),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x85173b=a40_0x4aa4d7;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this[_0x85173b(0x148)]=_0x85173b(0x171),console[_0x85173b(0x130)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x85173b(0x130)](_0x85173b(0x184),this['statusUrl']);}async[a40_0x4aa4d7(0x149)](_0x3df48e){const _0x51bb5a=a40_0x4aa4d7,{orderId:_0x53c511,amount:_0x423f09}=_0x3df48e;console[_0x51bb5a(0x130)](_0x51bb5a(0x19e)+_0x423f09+'\x20EUR');const _0x1cd690={'amount':_0x423f09},_0x159f7e=Date[_0x51bb5a(0x1b2)]();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x51bb5a(0x130)]('URL:',this[_0x51bb5a(0x1b1)]),console[_0x51bb5a(0x130)](_0x51bb5a(0x19d),JSON[_0x51bb5a(0x12e)](_0x1cd690,null,0x2)),console[_0x51bb5a(0x130)]('Amount:',_0x423f09,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x51bb5a(0x157)][_0x51bb5a(0x191)](_0x51bb5a(0x145),_0x51bb5a(0x17a),_0x51bb5a(0x17c),_0x1cd690);const _0x4610eb=await fetch(this[_0x51bb5a(0x1b1)],{'method':'POST','headers':{'Content-Type':_0x51bb5a(0x13f),'Accept':'application/json','User-Agent':_0x51bb5a(0x18b)},'body':JSON['stringify'](_0x1cd690)}),_0x1d14e3=Date[_0x51bb5a(0x1b2)]()-_0x159f7e;console[_0x51bb5a(0x130)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log']('Status:',_0x4610eb['status']),console[_0x51bb5a(0x130)](_0x51bb5a(0x14f),_0x4610eb['statusText']),console[_0x51bb5a(0x130)]('Headers:',Object[_0x51bb5a(0x12d)](_0x4610eb[_0x51bb5a(0x158)][_0x51bb5a(0x14a)]())),console[_0x51bb5a(0x130)](_0x51bb5a(0x174),_0x1d14e3+'ms');const _0x2606f5=await _0x4610eb[_0x51bb5a(0x140)]();console[_0x51bb5a(0x130)](_0x51bb5a(0x17f),_0x2606f5);if(!_0x4610eb['ok']){console[_0x51bb5a(0x1a9)](_0x51bb5a(0x16e)),console[_0x51bb5a(0x1a9)]('HTTP\x20Status:',_0x4610eb[_0x51bb5a(0x186)]),console['error'](_0x51bb5a(0x18c),_0x2606f5),loggerService_1[_0x51bb5a(0x157)][_0x51bb5a(0x150)](_0x51bb5a(0x145),'/create',_0x4610eb[_0x51bb5a(0x186)],_0x2606f5,_0x1d14e3),loggerService_1[_0x51bb5a(0x157)][_0x51bb5a(0x143)]('cointopay',_0x51bb5a(0x17a),'HTTP\x20'+_0x4610eb['status']+':\x20'+_0x2606f5);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4610eb[_0x51bb5a(0x186)]+_0x51bb5a(0x187)+_0x2606f5);}let _0x131aa9;try{_0x131aa9=JSON[_0x51bb5a(0x173)](_0x2606f5);}catch(_0x8aac6b){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x8aac6b),loggerService_1[_0x51bb5a(0x157)]['logWhiteDomainError'](_0x51bb5a(0x145),_0x51bb5a(0x17a),_0x51bb5a(0x189)+_0x8aac6b);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x2606f5);}console[_0x51bb5a(0x130)](_0x51bb5a(0x1ac)),console[_0x51bb5a(0x130)](_0x51bb5a(0x17e),JSON[_0x51bb5a(0x12e)](_0x131aa9,null,0x2)),loggerService_1[_0x51bb5a(0x157)][_0x51bb5a(0x150)]('cointopay',_0x51bb5a(0x17a),_0x4610eb[_0x51bb5a(0x186)],_0x131aa9,_0x1d14e3);if(_0x131aa9[_0x51bb5a(0x1a9)]){const _0x3e6ef9=_0x131aa9[_0x51bb5a(0x1ab)]||_0x131aa9[_0x51bb5a(0x1a9)]||_0x51bb5a(0x176);console[_0x51bb5a(0x1a9)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x51bb5a(0x1a9)]('Error\x20Message:',_0x3e6ef9),loggerService_1['loggerService']['logWhiteDomainError'](_0x51bb5a(0x145),'/create',_0x51bb5a(0x135)+_0x3e6ef9);throw new Error(_0x51bb5a(0x13a)+_0x3e6ef9);}if(!_0x131aa9['payment_url']||!_0x131aa9['gateway_payment_id']){console[_0x51bb5a(0x1a9)](_0x51bb5a(0x1a5)),console['error'](_0x51bb5a(0x18f)),console[_0x51bb5a(0x1a9)](_0x51bb5a(0x138),_0x131aa9),loggerService_1['loggerService'][_0x51bb5a(0x143)](_0x51bb5a(0x145),_0x51bb5a(0x17a),_0x51bb5a(0x1a1));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console['log'](_0x51bb5a(0x162)),console['log'](_0x51bb5a(0x141),_0x131aa9[_0x51bb5a(0x18e)]),console[_0x51bb5a(0x130)]('Payment\x20URL:',_0x131aa9[_0x51bb5a(0x136)]),console[_0x51bb5a(0x130)](_0x51bb5a(0x13c),_0x423f09,_0x51bb5a(0x1a2)),{'gateway_payment_id':_0x131aa9[_0x51bb5a(0x18e)],'payment_url':_0x131aa9[_0x51bb5a(0x136)]};}catch(_0x81ed07){console['error'](_0x51bb5a(0x177)),console['error'](_0x51bb5a(0x16a),_0x81ed07),loggerService_1[_0x51bb5a(0x157)][_0x51bb5a(0x143)](_0x51bb5a(0x145),_0x51bb5a(0x17a),_0x81ed07);if(_0x81ed07 instanceof Error){console[_0x51bb5a(0x1a9)](_0x51bb5a(0x147),_0x81ed07[_0x51bb5a(0x1ab)]),console['error'](_0x51bb5a(0x18a),_0x81ed07[_0x51bb5a(0x159)]);throw new Error(_0x51bb5a(0x182)+_0x81ed07[_0x51bb5a(0x1ab)]);}throw new Error(_0x51bb5a(0x17b));}}async[a40_0x4aa4d7(0x19f)](_0x3715e4){const _0x221dbf=a40_0x4aa4d7,_0x2aee4b=Date[_0x221dbf(0x1b2)]();try{console[_0x221dbf(0x130)](_0x221dbf(0x194)+_0x3715e4);const _0x12740d={'gatewayPaymentId':_0x3715e4};loggerService_1['loggerService'][_0x221dbf(0x191)]('cointopay',_0x221dbf(0x183),'POST',_0x12740d);const _0x595f44=await fetch(this[_0x221dbf(0x148)],{'method':_0x221dbf(0x17c),'headers':{'Content-Type':_0x221dbf(0x13f),'Accept':_0x221dbf(0x13f),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x12740d)}),_0x12e47e=Date['now']()-_0x2aee4b;console[_0x221dbf(0x130)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x221dbf(0x130)]('Status:',_0x595f44[_0x221dbf(0x186)]),console[_0x221dbf(0x130)](_0x221dbf(0x174),_0x12e47e+'ms');if(!_0x595f44['ok']){const _0x3bb19a=await _0x595f44['text']();console['error'](_0x221dbf(0x156),_0x595f44[_0x221dbf(0x186)]),console[_0x221dbf(0x1a9)]('Response\x20Body:',_0x3bb19a),loggerService_1[_0x221dbf(0x157)][_0x221dbf(0x150)](_0x221dbf(0x145),_0x221dbf(0x183),_0x595f44[_0x221dbf(0x186)],_0x3bb19a,_0x12e47e),loggerService_1[_0x221dbf(0x157)][_0x221dbf(0x143)](_0x221dbf(0x145),_0x221dbf(0x183),_0x221dbf(0x165)+_0x595f44[_0x221dbf(0x186)]+':\x20'+_0x3bb19a);throw new Error(_0x221dbf(0x190)+_0x595f44['status']);}const _0xb45f78=await _0x595f44[_0x221dbf(0x140)]();console[_0x221dbf(0x130)]('Raw\x20Response\x20Body:',_0xb45f78);let _0x23f14c;try{_0x23f14c=JSON[_0x221dbf(0x173)](_0xb45f78);}catch(_0x1c2532){console['error'](_0x221dbf(0x1af),_0x1c2532),loggerService_1['loggerService'][_0x221dbf(0x143)](_0x221dbf(0x145),'/status','JSON\x20Parse\x20Error:\x20'+_0x1c2532);throw new Error(_0x221dbf(0x15c)+_0xb45f78);}loggerService_1['loggerService']['logWhiteDomainResponse'](_0x221dbf(0x145),_0x221dbf(0x183),_0x595f44[_0x221dbf(0x186)],_0x23f14c,_0x12e47e),console[_0x221dbf(0x130)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x221dbf(0x130)](_0x221dbf(0x1a4),_0x23f14c[_0x221dbf(0x192)]),console[_0x221dbf(0x130)]('Status\x20Code:',_0x23f14c[_0x221dbf(0x132)]),console[_0x221dbf(0x130)](_0x221dbf(0x15b),_0x23f14c['data']?.[_0x221dbf(0x19b)]),console['log']('Amount:',_0x23f14c[_0x221dbf(0x193)]?.[_0x221dbf(0x146)]),console[_0x221dbf(0x130)](_0x221dbf(0x167),_0x23f14c[_0x221dbf(0x193)]?.[_0x221dbf(0x15a)]);if(_0x23f14c['result']!==_0x221dbf(0x175)||_0x23f14c[_0x221dbf(0x132)]!==0xc8){const _0x240e9b=_0x23f14c[_0x221dbf(0x1ab)]||_0x221dbf(0x14b);console[_0x221dbf(0x1a9)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x221dbf(0x1a9)](_0x221dbf(0x166),_0x240e9b),loggerService_1['loggerService'][_0x221dbf(0x143)](_0x221dbf(0x145),_0x221dbf(0x183),_0x221dbf(0x133)+_0x240e9b);throw new Error(_0x221dbf(0x16d)+_0x240e9b);}if(!_0x23f14c['data']){console['error'](_0x221dbf(0x196)),console[_0x221dbf(0x1a9)](_0x221dbf(0x185)),loggerService_1[_0x221dbf(0x157)]['logWhiteDomainError']('cointopay',_0x221dbf(0x183),_0x221dbf(0x172));throw new Error(_0x221dbf(0x199));}let _0x4cd597=_0x221dbf(0x131);switch(_0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x19b)]?.[_0x221dbf(0x1a8)]()){case _0x221dbf(0x1b0):_0x4cd597=_0x221dbf(0x18d);break;case _0x221dbf(0x17d):case'failed':case _0x221dbf(0x1a9):_0x4cd597=_0x221dbf(0x155);break;case'expired':case _0x221dbf(0x14e):_0x4cd597=_0x221dbf(0x163);break;case _0x221dbf(0x1a3):case _0x221dbf(0x139):case _0x221dbf(0x179):case _0x221dbf(0x16f):default:_0x4cd597=_0x221dbf(0x131);break;}let _0x168247,_0x4d603d;if(_0x23f14c['data'][_0x221dbf(0x152)]){const _0xfb7283=_0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x152)];console[_0x221dbf(0x130)]('üè¶\x20Payment\x20Detail:',_0xfb7283);const _0x21672c=_0xfb7283['match'](/IBAN\s+([A-Z0-9]+)/i);_0x21672c&&(_0x168247=_0x21672c[0x1],console['log'](_0x221dbf(0x12f),_0x168247)),_0x4d603d=_0xfb7283;}const _0x21e5d1={'iban':_0x168247,'bankDetails':_0x4d603d,'transactionId':_0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x15f)],'coinAddress':_0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x1a6)],'qrCodeUrl':_0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x13e)],'expiryTime':_0x23f14c['data'][_0x221dbf(0x1aa)],'createdOn':_0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x178)],'confirmedOn':_0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x13d)]};console[_0x221dbf(0x130)](_0x221dbf(0x134)),console[_0x221dbf(0x130)]('Status:',_0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x19b)],'->',_0x4cd597),console[_0x221dbf(0x130)](_0x221dbf(0x13c),_0x23f14c['data']['Amount'],_0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x15a)]),console[_0x221dbf(0x130)]('Transaction\x20ID:',_0x23f14c[_0x221dbf(0x193)]['TransactionID']),console[_0x221dbf(0x130)]('IBAN:',_0x168247||_0x221dbf(0x164)),console['log']('Created\x20On:',_0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x178)]),console[_0x221dbf(0x130)](_0x221dbf(0x181),_0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x13d)]||_0x221dbf(0x168));if(_0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x19b)]?.[_0x221dbf(0x1a8)]()===_0x221dbf(0x139))console[_0x221dbf(0x130)](_0x221dbf(0x169));else _0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x19b)]?.[_0x221dbf(0x1a8)]()===_0x221dbf(0x1b0)&&console[_0x221dbf(0x130)](_0x221dbf(0x16b));return{'status':_0x4cd597,'amount':parseFloat(_0x23f14c['data'][_0x221dbf(0x146)])||undefined,'currency':_0x23f14c[_0x221dbf(0x193)][_0x221dbf(0x15a)]||_0x221dbf(0x1a2),'paymentDetails':_0x21e5d1};}catch(_0xb678be){console[_0x221dbf(0x1a9)](_0x221dbf(0x14d),_0xb678be),loggerService_1[_0x221dbf(0x157)][_0x221dbf(0x143)]('cointopay',_0x221dbf(0x183),_0xb678be);throw new Error(_0x221dbf(0x161)+(_0xb678be instanceof Error?_0xb678be[_0x221dbf(0x1ab)]:'Unknown\x20error'));}}async[a40_0x4aa4d7(0x1ae)](_0x42bd14){const _0x2c839c=a40_0x4aa4d7,_0x1121c6=await this[_0x2c839c(0x19f)](_0x42bd14);return{'status':_0x1121c6['status'],'amount':_0x1121c6['amount'],'currency':_0x1121c6[_0x2c839c(0x19c)]};}async[a40_0x4aa4d7(0x195)](_0x455a39){const _0x556914=a40_0x4aa4d7;console[_0x556914(0x130)](_0x556914(0x160),_0x455a39);let _0x4770a1='PENDING';switch(_0x455a39[_0x556914(0x186)]?.[_0x556914(0x1a8)]()){case _0x556914(0x1b0):_0x4770a1=_0x556914(0x18d);break;case _0x556914(0x17d):case _0x556914(0x153):case'error':_0x4770a1=_0x556914(0x155);break;case _0x556914(0x170):case _0x556914(0x14e):_0x4770a1=_0x556914(0x163);break;case'pending':case _0x556914(0x1a3):case'awaiting\x20fiat':case _0x556914(0x16f):default:_0x4770a1='PENDING';break;}return{'paymentId':_0x455a39[_0x556914(0x1a7)]||_0x455a39[_0x556914(0x151)]||'','status':_0x4770a1,'amount':_0x455a39[_0x556914(0x137)],'currency':_0x455a39[_0x556914(0x19c)]||_0x556914(0x1a2)};}}exports[a40_0x4aa4d7(0x144)]=CoinToPayService;