'use strict';const a40_0x5f5868=a40_0x53a0;(function(_0x25beed,_0x23d036){const _0x2be498=a40_0x53a0,_0x4449d0=_0x25beed();while(!![]){try{const _0x1d5545=-parseInt(_0x2be498(0x21f))/0x1+parseInt(_0x2be498(0x1d5))/0x2+parseInt(_0x2be498(0x234))/0x3+-parseInt(_0x2be498(0x1c6))/0x4*(parseInt(_0x2be498(0x1e9))/0x5)+parseInt(_0x2be498(0x1cf))/0x6+-parseInt(_0x2be498(0x20f))/0x7+-parseInt(_0x2be498(0x1db))/0x8*(-parseInt(_0x2be498(0x238))/0x9);if(_0x1d5545===_0x23d036)break;else _0x4449d0['push'](_0x4449d0['shift']());}catch(_0x177f84){_0x4449d0['push'](_0x4449d0['shift']());}}}(a40_0x3e66,0x1fd01));function a40_0x53a0(_0x1abbcd,_0x15771a){const _0x3e662b=a40_0x3e66();return a40_0x53a0=function(_0x53a065,_0x224e4f){_0x53a065=_0x53a065-0x1c0;let _0x51a928=_0x3e662b[_0x53a065];return _0x51a928;},a40_0x53a0(_0x1abbcd,_0x15771a);}Object[a40_0x5f5868(0x1ce)](exports,a40_0x5f5868(0x1df),{'value':!![]}),exports[a40_0x5f5868(0x1f0)]=void 0x0;const loggerService_1=require(a40_0x5f5868(0x1fa));class CoinToPayService{constructor(){const _0x40b097=a40_0x5f5868;this[_0x40b097(0x20c)]=_0x40b097(0x242),this[_0x40b097(0x1de)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x40b097(0x21b)](_0x40b097(0x217)),console[_0x40b097(0x21b)](_0x40b097(0x20b),this[_0x40b097(0x1de)]);}async[a40_0x5f5868(0x1f5)](_0x2c6251){const _0x18486a=a40_0x5f5868,{orderId:_0x3317a6,amount:_0x3bcf8f}=_0x2c6251;console[_0x18486a(0x21b)]('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x3bcf8f+'\x20EUR');const _0x2c39a7={'amount':_0x3bcf8f},_0x5ed952=Date[_0x18486a(0x1e0)]();try{console[_0x18486a(0x21b)](_0x18486a(0x1fb)),console['log']('URL:',this[_0x18486a(0x20c)]),console[_0x18486a(0x21b)]('Request\x20Body:',JSON[_0x18486a(0x205)](_0x2c39a7,null,0x2)),console[_0x18486a(0x21b)](_0x18486a(0x220),_0x3bcf8f,_0x18486a(0x20a)),loggerService_1['loggerService'][_0x18486a(0x206)](_0x18486a(0x21a),_0x18486a(0x219),_0x18486a(0x240),_0x2c39a7);const _0x5913b5=await fetch(this[_0x18486a(0x20c)],{'method':_0x18486a(0x240),'headers':{'Content-Type':_0x18486a(0x1d4),'Accept':_0x18486a(0x1d4),'User-Agent':_0x18486a(0x224)},'body':JSON[_0x18486a(0x205)](_0x2c39a7)}),_0x48e562=Date[_0x18486a(0x1e0)]()-_0x5ed952;console[_0x18486a(0x21b)](_0x18486a(0x209)),console[_0x18486a(0x21b)](_0x18486a(0x245),_0x5913b5[_0x18486a(0x244)]),console[_0x18486a(0x21b)](_0x18486a(0x213),_0x5913b5['statusText']),console[_0x18486a(0x21b)](_0x18486a(0x1e2),Object[_0x18486a(0x229)](_0x5913b5[_0x18486a(0x1dc)][_0x18486a(0x1ec)]())),console[_0x18486a(0x21b)](_0x18486a(0x1ef),_0x48e562+'ms');const _0xa86517=await _0x5913b5[_0x18486a(0x200)]();console[_0x18486a(0x21b)](_0x18486a(0x1fc),_0xa86517);if(!_0x5913b5['ok']){console[_0x18486a(0x1e4)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x18486a(0x226),_0x5913b5[_0x18486a(0x244)]),console[_0x18486a(0x1e4)](_0x18486a(0x1c1),_0xa86517),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x18486a(0x219),_0x5913b5[_0x18486a(0x244)],_0xa86517,_0x48e562),loggerService_1[_0x18486a(0x227)]['logWhiteDomainError'](_0x18486a(0x21a),'/create','HTTP\x20'+_0x5913b5['status']+':\x20'+_0xa86517);throw new Error(_0x18486a(0x241)+_0x5913b5[_0x18486a(0x244)]+',\x20body:\x20'+_0xa86517);}let _0x3a686f;try{_0x3a686f=JSON[_0x18486a(0x22a)](_0xa86517);}catch(_0x43dcc3){console['error'](_0x18486a(0x233),_0x43dcc3),loggerService_1[_0x18486a(0x227)][_0x18486a(0x21e)](_0x18486a(0x21a),_0x18486a(0x219),_0x18486a(0x23a)+_0x43dcc3);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0xa86517);}console[_0x18486a(0x21b)](_0x18486a(0x1e3)),console[_0x18486a(0x21b)]('Parsed\x20Result:',JSON['stringify'](_0x3a686f,null,0x2)),loggerService_1['loggerService'][_0x18486a(0x1c5)](_0x18486a(0x21a),_0x18486a(0x219),_0x5913b5['status'],_0x3a686f,_0x48e562);if(_0x3a686f['error']){const _0x4d282b=_0x3a686f[_0x18486a(0x1d1)]||_0x3a686f[_0x18486a(0x1e4)]||_0x18486a(0x1fd);console['error'](_0x18486a(0x221)),console[_0x18486a(0x1e4)](_0x18486a(0x225),_0x4d282b),loggerService_1[_0x18486a(0x227)]['logWhiteDomainError'](_0x18486a(0x21a),_0x18486a(0x219),_0x18486a(0x235)+_0x4d282b);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x4d282b);}if(!_0x3a686f['payment_url']||!_0x3a686f[_0x18486a(0x223)]){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x18486a(0x22c)),console['error'](_0x18486a(0x1f8),_0x3a686f),loggerService_1[_0x18486a(0x227)][_0x18486a(0x21e)](_0x18486a(0x21a),_0x18486a(0x219),_0x18486a(0x1cd));throw new Error(_0x18486a(0x1ca));}return console[_0x18486a(0x21b)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x18486a(0x21b)]('Gateway\x20Payment\x20ID:',_0x3a686f['gateway_payment_id']),console[_0x18486a(0x21b)]('Payment\x20URL:',_0x3a686f[_0x18486a(0x204)]),console[_0x18486a(0x21b)](_0x18486a(0x220),_0x3bcf8f,_0x18486a(0x1c9)),{'gateway_payment_id':_0x3a686f[_0x18486a(0x223)],'payment_url':_0x3a686f[_0x18486a(0x204)]};}catch(_0x55cbea){console[_0x18486a(0x1e4)](_0x18486a(0x207)),console[_0x18486a(0x1e4)](_0x18486a(0x202),_0x55cbea),loggerService_1[_0x18486a(0x227)][_0x18486a(0x21e)](_0x18486a(0x21a),_0x18486a(0x219),_0x55cbea);if(_0x55cbea instanceof Error){console[_0x18486a(0x1e4)](_0x18486a(0x21d),_0x55cbea['message']),console[_0x18486a(0x1e4)](_0x18486a(0x201),_0x55cbea[_0x18486a(0x1c8)]);throw new Error(_0x18486a(0x1cb)+_0x55cbea[_0x18486a(0x1d1)]);}throw new Error(_0x18486a(0x211));}}async[a40_0x5f5868(0x22f)](_0x5b980b){const _0x45d088=a40_0x5f5868,_0x3cd3a5=Date['now']();try{console[_0x45d088(0x21b)](_0x45d088(0x1ea)+_0x5b980b);const _0x8a609f={'gatewayPaymentId':_0x5b980b};loggerService_1[_0x45d088(0x227)][_0x45d088(0x206)]('cointopay',_0x45d088(0x1fe),_0x45d088(0x240),_0x8a609f);const _0x37d196=await fetch(this[_0x45d088(0x1de)],{'method':_0x45d088(0x240),'headers':{'Content-Type':_0x45d088(0x1d4),'Accept':_0x45d088(0x1d4),'User-Agent':_0x45d088(0x224)},'body':JSON[_0x45d088(0x205)](_0x8a609f)}),_0xb2a3f1=Date[_0x45d088(0x1e0)]()-_0x3cd3a5;console['log'](_0x45d088(0x1c0)),console['log'](_0x45d088(0x245),_0x37d196['status']),console[_0x45d088(0x21b)](_0x45d088(0x1ef),_0xb2a3f1+'ms');if(!_0x37d196['ok']){const _0x219c5f=await _0x37d196[_0x45d088(0x200)]();console['error']('HTTP\x20Status:',_0x37d196['status']),console['error'](_0x45d088(0x1c1),_0x219c5f),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x45d088(0x21a),'/status',_0x37d196[_0x45d088(0x244)],_0x219c5f,_0xb2a3f1),loggerService_1['loggerService'][_0x45d088(0x21e)](_0x45d088(0x21a),_0x45d088(0x1fe),'HTTP\x20'+_0x37d196[_0x45d088(0x244)]+':\x20'+_0x219c5f);throw new Error(_0x45d088(0x241)+_0x37d196[_0x45d088(0x244)]);}const _0x517725=await _0x37d196['text']();console[_0x45d088(0x21b)](_0x45d088(0x1fc),_0x517725);let _0x56694f;try{_0x56694f=JSON['parse'](_0x517725);}catch(_0x474bed){console[_0x45d088(0x1e4)](_0x45d088(0x233),_0x474bed),loggerService_1[_0x45d088(0x227)]['logWhiteDomainError'](_0x45d088(0x21a),_0x45d088(0x1fe),_0x45d088(0x23a)+_0x474bed);throw new Error(_0x45d088(0x1e6)+_0x517725);}loggerService_1[_0x45d088(0x227)][_0x45d088(0x1c5)]('cointopay',_0x45d088(0x1fe),_0x37d196[_0x45d088(0x244)],_0x56694f,_0xb2a3f1),console['log'](_0x45d088(0x23f)),console['log'](_0x45d088(0x1f4),_0x56694f[_0x45d088(0x1f2)]),console[_0x45d088(0x21b)](_0x45d088(0x1d9),_0x56694f[_0x45d088(0x239)]),console[_0x45d088(0x21b)]('Payment\x20Status:',_0x56694f[_0x45d088(0x208)]?.[_0x45d088(0x1f6)]),console['log'](_0x45d088(0x220),_0x56694f['data']?.['Amount']),console[_0x45d088(0x21b)](_0x45d088(0x23d),_0x56694f[_0x45d088(0x208)]?.[_0x45d088(0x1d8)]);if(_0x56694f[_0x45d088(0x1f2)]!==_0x45d088(0x212)||_0x56694f[_0x45d088(0x239)]!==0xc8){const _0x5b1cd6=_0x56694f[_0x45d088(0x1d1)]||_0x45d088(0x1f7);console[_0x45d088(0x1e4)](_0x45d088(0x1e1)),console['error'](_0x45d088(0x225),_0x5b1cd6),loggerService_1['loggerService'][_0x45d088(0x21e)](_0x45d088(0x21a),'/status',_0x45d088(0x236)+_0x5b1cd6);throw new Error(_0x45d088(0x22b)+_0x5b1cd6);}if(!_0x56694f[_0x45d088(0x208)]){console[_0x45d088(0x1e4)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x45d088(0x1cc)),loggerService_1['loggerService'][_0x45d088(0x21e)]('cointopay',_0x45d088(0x1fe),_0x45d088(0x1c4));throw new Error(_0x45d088(0x1ff));}let _0x44124b=_0x45d088(0x1da);switch(_0x56694f[_0x45d088(0x208)]['Status']?.[_0x45d088(0x237)]()){case _0x45d088(0x1f1):_0x44124b='PAID';break;case _0x45d088(0x1d2):case _0x45d088(0x1e5):case _0x45d088(0x1e4):_0x44124b=_0x45d088(0x1dd);break;case _0x45d088(0x215):case _0x45d088(0x222):_0x44124b='EXPIRED';break;case _0x45d088(0x20e):case'awaiting\x20fiat':case _0x45d088(0x22e):case _0x45d088(0x230):default:_0x44124b=_0x45d088(0x1da);break;}let _0x1b13c7,_0x108ea7;if(_0x56694f[_0x45d088(0x208)][_0x45d088(0x243)]){const _0x39f2d4=_0x56694f[_0x45d088(0x208)][_0x45d088(0x243)];console[_0x45d088(0x21b)](_0x45d088(0x1c3),_0x39f2d4);const _0x114233=_0x39f2d4[_0x45d088(0x1e8)](/IBAN\s+([A-Z0-9]+)/i);_0x114233&&(_0x1b13c7=_0x114233[0x1],console[_0x45d088(0x21b)](_0x45d088(0x20d),_0x1b13c7)),_0x108ea7=_0x39f2d4;}const _0x2c8370={'iban':_0x1b13c7,'bankDetails':_0x108ea7,'transactionId':_0x56694f[_0x45d088(0x208)][_0x45d088(0x1ed)],'coinAddress':_0x56694f[_0x45d088(0x208)][_0x45d088(0x1c2)],'qrCodeUrl':_0x56694f[_0x45d088(0x208)][_0x45d088(0x228)],'expiryTime':_0x56694f['data'][_0x45d088(0x23b)],'createdOn':_0x56694f[_0x45d088(0x208)]['CreatedOn'],'confirmedOn':_0x56694f[_0x45d088(0x208)][_0x45d088(0x214)]};console[_0x45d088(0x21b)](_0x45d088(0x1d3)),console['log'](_0x45d088(0x245),_0x56694f[_0x45d088(0x208)][_0x45d088(0x1f6)],'->',_0x44124b),console['log'](_0x45d088(0x220),_0x56694f[_0x45d088(0x208)][_0x45d088(0x22d)],_0x56694f['data'][_0x45d088(0x1d8)]),console['log'](_0x45d088(0x210),_0x56694f['data'][_0x45d088(0x1ed)]),console[_0x45d088(0x21b)](_0x45d088(0x203),_0x1b13c7||_0x45d088(0x1d6)),console[_0x45d088(0x21b)]('Created\x20On:',_0x56694f[_0x45d088(0x208)][_0x45d088(0x1c7)]),console[_0x45d088(0x21b)](_0x45d088(0x23e),_0x56694f[_0x45d088(0x208)][_0x45d088(0x214)]||_0x45d088(0x1d7));if(_0x56694f[_0x45d088(0x208)]['Status']?.[_0x45d088(0x237)]()===_0x45d088(0x21c))console[_0x45d088(0x21b)](_0x45d088(0x1ee));else _0x56694f[_0x45d088(0x208)][_0x45d088(0x1f6)]?.[_0x45d088(0x237)]()==='paid'&&console[_0x45d088(0x21b)](_0x45d088(0x1f9));return{'status':_0x44124b,'amount':parseFloat(_0x56694f[_0x45d088(0x208)][_0x45d088(0x22d)])||undefined,'currency':_0x56694f[_0x45d088(0x208)][_0x45d088(0x1d8)]||'EUR','paymentDetails':_0x2c8370};}catch(_0xef58cd){console[_0x45d088(0x1e4)](_0x45d088(0x1eb),_0xef58cd),loggerService_1[_0x45d088(0x227)][_0x45d088(0x21e)](_0x45d088(0x21a),_0x45d088(0x1fe),_0xef58cd);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0xef58cd instanceof Error?_0xef58cd[_0x45d088(0x1d1)]:_0x45d088(0x1f3)));}}async[a40_0x5f5868(0x232)](_0x3a08c2){const _0x20e1eb=a40_0x5f5868,_0x29ca70=await this[_0x20e1eb(0x22f)](_0x3a08c2);return{'status':_0x29ca70[_0x20e1eb(0x244)],'amount':_0x29ca70[_0x20e1eb(0x23c)],'currency':_0x29ca70[_0x20e1eb(0x218)]};}async['processWebhook'](_0x5a5f45){const _0x485d25=a40_0x5f5868;console['log'](_0x485d25(0x1d0),_0x5a5f45);let _0x5a8914=_0x485d25(0x1da);switch(_0x5a5f45[_0x485d25(0x244)]?.['toLowerCase']()){case _0x485d25(0x1f1):_0x5a8914=_0x485d25(0x1e7);break;case _0x485d25(0x1d2):case'failed':case _0x485d25(0x1e4):_0x5a8914=_0x485d25(0x1dd);break;case _0x485d25(0x215):case _0x485d25(0x222):_0x5a8914='EXPIRED';break;case'pending':case _0x485d25(0x20e):case _0x485d25(0x21c):case _0x485d25(0x230):default:_0x5a8914='PENDING';break;}return{'paymentId':_0x5a5f45[_0x485d25(0x231)]||_0x5a5f45[_0x485d25(0x216)]||'','status':_0x5a8914,'amount':_0x5a5f45['amount'],'currency':_0x5a5f45[_0x485d25(0x218)]||_0x485d25(0x1c9)};}}exports[a40_0x5f5868(0x1f0)]=CoinToPayService;function a40_0x3e66(){const _0x4019c9=['24246BSnTxj','Business\x20Error:\x20','Status\x20API\x20Error:\x20','toLowerCase','27suRCCn','status_code','JSON\x20Parse\x20Error:\x20','ExpiryTime','amount','Currency:','Confirmed\x20On:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','POST','HTTP\x20error!\x20status:\x20','https://tesoft.uk/gateway/cointopay/','PaymentDetail','status','Status:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Response\x20Body:','coinAddress','🏦\x20Payment\x20Detail:','Incomplete\x20response:\x20missing\x20data','logWhiteDomainResponse','52dUoplM','CreatedOn','stack','EUR','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Missing\x20data\x20in\x20response','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','defineProperty','461556pXJMBY','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','message','cancelled','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','application/json','296730LcisWf','not\x20found','not\x20confirmed','inputCurrency','Status\x20Code:','PENDING','331664pJTCNZ','headers','FAILED','statusUrl','__esModule','now','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Headers:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','error','failed','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','PAID','match','51205JBrORm','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','entries','TransactionID','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Response\x20Time:','CoinToPayService','paid','result','Unknown\x20error','Result:','createPaymentLink','Status','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Response\x20data:','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','../loggerService','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Raw\x20Response\x20Body:','Unknown\x20error\x20from\x20CoinToPay\x20API','/status','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','text','Error\x20stack:','Error\x20details:','IBAN:','payment_url','stringify','logWhiteDomainRequest','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','data','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','📊\x20Status\x20check\x20URL:','apiUrl','🏦\x20Extracted\x20IBAN:','waiting','448385WxKUYe','Transaction\x20ID:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','success','Status\x20Text:','TransactionConfirmedOn','expired','merchant_reference_id','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','currency','/create','cointopay','log','awaiting\x20fiat','Error\x20message:','logWhiteDomainError','30254NcOQHq','Amount:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','timeout','gateway_payment_id','TesSoft\x20Payment\x20System/1.0','Error\x20Message:','HTTP\x20Status:','loggerService','QRCodeURL','fromEntries','parse','CoinToPay\x20status\x20API\x20error:\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Amount','pending','checkPaymentStatus','created','order_id','verifyPayment','Failed\x20to\x20parse\x20JSON\x20response:'];a40_0x3e66=function(){return _0x4019c9;};return a40_0x3e66();}