'use strict';const a41_0x2dbea9=a41_0x448d;(function(_0x3fd2cd,_0x2fbcdd){const _0x1f50a3=a41_0x448d,_0x3d4430=_0x3fd2cd();while(!![]){try{const _0x4f19fb=parseInt(_0x1f50a3(0x180))/0x1+-parseInt(_0x1f50a3(0x173))/0x2+parseInt(_0x1f50a3(0x130))/0x3*(-parseInt(_0x1f50a3(0x15b))/0x4)+-parseInt(_0x1f50a3(0x126))/0x5*(-parseInt(_0x1f50a3(0x187))/0x6)+parseInt(_0x1f50a3(0x158))/0x7+parseInt(_0x1f50a3(0x197))/0x8+-parseInt(_0x1f50a3(0x145))/0x9;if(_0x4f19fb===_0x2fbcdd)break;else _0x3d4430['push'](_0x3d4430['shift']());}catch(_0x51a579){_0x3d4430['push'](_0x3d4430['shift']());}}}(a41_0x2323,0xb77c8));Object[a41_0x2dbea9(0x191)](exports,a41_0x2dbea9(0x125),{'value':!![]}),exports[a41_0x2dbea9(0x17f)]=void 0x0;const loggerService_1=require(a41_0x2dbea9(0x12d));function a41_0x448d(_0x29da2f,_0x5408cb){const _0x232309=a41_0x2323();return a41_0x448d=function(_0x448d77,_0x124097){_0x448d77=_0x448d77-0x114;let _0x576bba=_0x232309[_0x448d77];return _0x576bba;},a41_0x448d(_0x29da2f,_0x5408cb);}class CoinToPayService{constructor(){const _0x4d7080=a41_0x2dbea9;this[_0x4d7080(0x16f)]='https://tesoft.uk/gateway/cointopay/',this[_0x4d7080(0x12a)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x4d7080(0x12b)]('🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log']('📊\x20Status\x20check\x20URL:',this[_0x4d7080(0x12a)]);}async[a41_0x2dbea9(0x176)](_0x5ac406){const _0x1f747e=a41_0x2dbea9,{orderId:_0x1a1e08,amount:_0x231470}=_0x5ac406;console['log']('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x231470+_0x1f747e(0x18e));const _0x355b56={'amount':_0x231470},_0x1042be=Date[_0x1f747e(0x13b)]();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x1f747e(0x12b)](_0x1f747e(0x137),this[_0x1f747e(0x16f)]),console[_0x1f747e(0x12b)](_0x1f747e(0x150),JSON[_0x1f747e(0x169)](_0x355b56,null,0x2)),console[_0x1f747e(0x12b)](_0x1f747e(0x190),_0x231470,_0x1f747e(0x15e)),loggerService_1[_0x1f747e(0x11b)][_0x1f747e(0x189)](_0x1f747e(0x192),_0x1f747e(0x199),_0x1f747e(0x114),_0x355b56);const _0x2dfc1c=await fetch(this[_0x1f747e(0x16f)],{'method':_0x1f747e(0x114),'headers':{'Content-Type':_0x1f747e(0x186),'Accept':_0x1f747e(0x186),'User-Agent':_0x1f747e(0x168)},'body':JSON['stringify'](_0x355b56)}),_0x5844b9=Date[_0x1f747e(0x13b)]()-_0x1042be;console[_0x1f747e(0x12b)](_0x1f747e(0x196)),console[_0x1f747e(0x12b)](_0x1f747e(0x118),_0x2dfc1c[_0x1f747e(0x181)]),console['log'](_0x1f747e(0x11a),_0x2dfc1c[_0x1f747e(0x122)]),console[_0x1f747e(0x12b)]('Headers:',Object[_0x1f747e(0x175)](_0x2dfc1c[_0x1f747e(0x147)]['entries']())),console[_0x1f747e(0x12b)](_0x1f747e(0x133),_0x5844b9+'ms');const _0x395677=await _0x2dfc1c[_0x1f747e(0x149)]();console['log'](_0x1f747e(0x18d),_0x395677);if(!_0x2dfc1c['ok']){console['error'](_0x1f747e(0x119)),console['error'](_0x1f747e(0x13d),_0x2dfc1c[_0x1f747e(0x181)]),console[_0x1f747e(0x155)](_0x1f747e(0x11f),_0x395677),loggerService_1[_0x1f747e(0x11b)]['logWhiteDomainResponse'](_0x1f747e(0x192),_0x1f747e(0x199),_0x2dfc1c[_0x1f747e(0x181)],_0x395677,_0x5844b9),loggerService_1['loggerService'][_0x1f747e(0x127)](_0x1f747e(0x192),_0x1f747e(0x199),_0x1f747e(0x12c)+_0x2dfc1c['status']+':\x20'+_0x395677);throw new Error(_0x1f747e(0x13e)+_0x2dfc1c[_0x1f747e(0x181)]+',\x20body:\x20'+_0x395677);}let _0x303a6a;try{_0x303a6a=JSON[_0x1f747e(0x13c)](_0x395677);}catch(_0x1b4e40){console[_0x1f747e(0x155)](_0x1f747e(0x165),_0x1b4e40),loggerService_1[_0x1f747e(0x11b)]['logWhiteDomainError'](_0x1f747e(0x192),_0x1f747e(0x199),_0x1f747e(0x136)+_0x1b4e40);throw new Error(_0x1f747e(0x138)+_0x395677);}console[_0x1f747e(0x12b)](_0x1f747e(0x143)),console[_0x1f747e(0x12b)](_0x1f747e(0x19b),JSON['stringify'](_0x303a6a,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1f747e(0x192),_0x1f747e(0x199),_0x2dfc1c[_0x1f747e(0x181)],_0x303a6a,_0x5844b9);if(_0x303a6a['error']){const _0x20c305=_0x303a6a[_0x1f747e(0x18c)]||_0x303a6a[_0x1f747e(0x155)]||_0x1f747e(0x19a);console[_0x1f747e(0x155)](_0x1f747e(0x177)),console[_0x1f747e(0x155)](_0x1f747e(0x124),_0x20c305),loggerService_1[_0x1f747e(0x11b)]['logWhiteDomainError'](_0x1f747e(0x192),_0x1f747e(0x199),'Business\x20Error:\x20'+_0x20c305);throw new Error(_0x1f747e(0x172)+_0x20c305);}if(!_0x303a6a['payment_url']||!_0x303a6a[_0x1f747e(0x17d)]){console[_0x1f747e(0x155)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1f747e(0x155)](_0x1f747e(0x140)),console[_0x1f747e(0x155)](_0x1f747e(0x152),_0x303a6a),loggerService_1[_0x1f747e(0x11b)][_0x1f747e(0x127)](_0x1f747e(0x192),'/create',_0x1f747e(0x153));throw new Error(_0x1f747e(0x17c));}return console[_0x1f747e(0x12b)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log'](_0x1f747e(0x15c),_0x303a6a[_0x1f747e(0x17d)]),console['log'](_0x1f747e(0x16d),_0x303a6a[_0x1f747e(0x174)]),console['log'](_0x1f747e(0x190),_0x231470,_0x1f747e(0x166)),{'gateway_payment_id':_0x303a6a['gateway_payment_id'],'payment_url':_0x303a6a['payment_url']};}catch(_0x518de5){console[_0x1f747e(0x155)](_0x1f747e(0x16c)),console['error'](_0x1f747e(0x15f),_0x518de5),loggerService_1[_0x1f747e(0x11b)][_0x1f747e(0x127)](_0x1f747e(0x192),_0x1f747e(0x199),_0x518de5);if(_0x518de5 instanceof Error){console[_0x1f747e(0x155)](_0x1f747e(0x16a),_0x518de5[_0x1f747e(0x18c)]),console[_0x1f747e(0x155)](_0x1f747e(0x163),_0x518de5[_0x1f747e(0x135)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x518de5[_0x1f747e(0x18c)]);}throw new Error(_0x1f747e(0x183));}}async[a41_0x2dbea9(0x161)](_0x2c9e0a){const _0x2225e6=a41_0x2dbea9,_0x9dbed2=Date[_0x2225e6(0x13b)]();try{console[_0x2225e6(0x12b)](_0x2225e6(0x156)+_0x2c9e0a);const _0x1a7948={'gatewayPaymentId':_0x2c9e0a};loggerService_1[_0x2225e6(0x11b)][_0x2225e6(0x189)](_0x2225e6(0x192),_0x2225e6(0x17e),_0x2225e6(0x114),_0x1a7948);const _0x5e662f=await fetch(this[_0x2225e6(0x12a)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x2225e6(0x186),'User-Agent':_0x2225e6(0x168)},'body':JSON['stringify'](_0x1a7948)}),_0x2c0a11=Date['now']()-_0x9dbed2;console[_0x2225e6(0x12b)](_0x2225e6(0x14f)),console[_0x2225e6(0x12b)]('Status:',_0x5e662f[_0x2225e6(0x181)]),console[_0x2225e6(0x12b)](_0x2225e6(0x133),_0x2c0a11+'ms');if(!_0x5e662f['ok']){const _0x28dc34=await _0x5e662f[_0x2225e6(0x149)]();console['error']('HTTP\x20Status:',_0x5e662f[_0x2225e6(0x181)]),console[_0x2225e6(0x155)](_0x2225e6(0x11f),_0x28dc34),loggerService_1[_0x2225e6(0x11b)]['logWhiteDomainResponse'](_0x2225e6(0x192),_0x2225e6(0x17e),_0x5e662f[_0x2225e6(0x181)],_0x28dc34,_0x2c0a11),loggerService_1[_0x2225e6(0x11b)][_0x2225e6(0x127)](_0x2225e6(0x192),_0x2225e6(0x17e),_0x2225e6(0x12c)+_0x5e662f['status']+':\x20'+_0x28dc34);throw new Error(_0x2225e6(0x13e)+_0x5e662f[_0x2225e6(0x181)]);}const _0x3f80c8=await _0x5e662f[_0x2225e6(0x149)]();console['log'](_0x2225e6(0x18d),_0x3f80c8);let _0x182768;try{_0x182768=JSON['parse'](_0x3f80c8);}catch(_0x36c99e){console[_0x2225e6(0x155)](_0x2225e6(0x165),_0x36c99e),loggerService_1[_0x2225e6(0x11b)]['logWhiteDomainError'](_0x2225e6(0x192),_0x2225e6(0x17e),'JSON\x20Parse\x20Error:\x20'+_0x36c99e);throw new Error(_0x2225e6(0x17b)+_0x3f80c8);}loggerService_1[_0x2225e6(0x11b)][_0x2225e6(0x134)](_0x2225e6(0x192),_0x2225e6(0x17e),_0x5e662f[_0x2225e6(0x181)],_0x182768,_0x2c0a11),console['log'](_0x2225e6(0x117)),console[_0x2225e6(0x12b)](_0x2225e6(0x16b),_0x182768[_0x2225e6(0x15d)]),console[_0x2225e6(0x12b)]('Status\x20Code:',_0x182768[_0x2225e6(0x139)]),console[_0x2225e6(0x12b)]('Payment\x20Status:',_0x182768[_0x2225e6(0x15a)]?.[_0x2225e6(0x141)]),console[_0x2225e6(0x12b)](_0x2225e6(0x190),_0x182768[_0x2225e6(0x15a)]?.[_0x2225e6(0x162)]),console[_0x2225e6(0x12b)](_0x2225e6(0x116),_0x182768[_0x2225e6(0x15a)]?.[_0x2225e6(0x129)]);if(_0x182768[_0x2225e6(0x15d)]!==_0x2225e6(0x123)||_0x182768[_0x2225e6(0x139)]!==0xc8){const _0x5291d0=_0x182768[_0x2225e6(0x18c)]||_0x2225e6(0x151);console['error'](_0x2225e6(0x198)),console[_0x2225e6(0x155)](_0x2225e6(0x124),_0x5291d0),loggerService_1[_0x2225e6(0x11b)]['logWhiteDomainError'](_0x2225e6(0x192),_0x2225e6(0x17e),_0x2225e6(0x11d)+_0x5291d0);throw new Error(_0x2225e6(0x115)+_0x5291d0);}if(!_0x182768['data']){console[_0x2225e6(0x155)](_0x2225e6(0x128)),console[_0x2225e6(0x155)](_0x2225e6(0x13a)),loggerService_1[_0x2225e6(0x11b)]['logWhiteDomainError']('cointopay',_0x2225e6(0x17e),'Incomplete\x20response:\x20missing\x20data');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x4fc650=_0x2225e6(0x182);switch(_0x182768[_0x2225e6(0x15a)]['Status']?.[_0x2225e6(0x13f)]()){case _0x2225e6(0x18a):_0x4fc650=_0x2225e6(0x195);break;case _0x2225e6(0x193):case _0x2225e6(0x179):case _0x2225e6(0x155):_0x4fc650=_0x2225e6(0x17a);break;case _0x2225e6(0x142):case _0x2225e6(0x14d):_0x4fc650=_0x2225e6(0x146);break;case'waiting':case _0x2225e6(0x171):case _0x2225e6(0x14a):case _0x2225e6(0x144):default:_0x4fc650='PENDING';break;}let _0x552ea2,_0x4ceecf;if(_0x182768['data'][_0x2225e6(0x14c)]){const _0x7fba54=_0x182768[_0x2225e6(0x15a)]['PaymentDetail'];console['log'](_0x2225e6(0x178),_0x7fba54);const _0x4a9ebe=_0x7fba54[_0x2225e6(0x188)](/IBAN\s+([A-Z0-9]+)/i);_0x4a9ebe&&(_0x552ea2=_0x4a9ebe[0x1],console[_0x2225e6(0x12b)](_0x2225e6(0x12f),_0x552ea2)),_0x4ceecf=_0x7fba54;}const _0x1d6303={'iban':_0x552ea2,'bankDetails':_0x4ceecf,'transactionId':_0x182768[_0x2225e6(0x15a)][_0x2225e6(0x159)],'coinAddress':_0x182768['data'][_0x2225e6(0x132)],'qrCodeUrl':_0x182768[_0x2225e6(0x15a)][_0x2225e6(0x148)],'expiryTime':_0x182768[_0x2225e6(0x15a)]['ExpiryTime'],'createdOn':_0x182768[_0x2225e6(0x15a)][_0x2225e6(0x170)],'confirmedOn':_0x182768[_0x2225e6(0x15a)][_0x2225e6(0x11e)]};console[_0x2225e6(0x12b)](_0x2225e6(0x184)),console['log'](_0x2225e6(0x118),_0x182768[_0x2225e6(0x15a)][_0x2225e6(0x141)],'->',_0x4fc650),console[_0x2225e6(0x12b)]('Amount:',_0x182768[_0x2225e6(0x15a)]['Amount'],_0x182768[_0x2225e6(0x15a)][_0x2225e6(0x129)]),console[_0x2225e6(0x12b)](_0x2225e6(0x12e),_0x182768[_0x2225e6(0x15a)]['TransactionID']),console['log'](_0x2225e6(0x185),_0x552ea2||_0x2225e6(0x160)),console[_0x2225e6(0x12b)]('Created\x20On:',_0x182768['data'][_0x2225e6(0x170)]),console[_0x2225e6(0x12b)](_0x2225e6(0x18f),_0x182768[_0x2225e6(0x15a)][_0x2225e6(0x11e)]||_0x2225e6(0x194));if(_0x182768[_0x2225e6(0x15a)][_0x2225e6(0x141)]?.[_0x2225e6(0x13f)]()===_0x2225e6(0x171))console[_0x2225e6(0x12b)](_0x2225e6(0x131));else _0x182768[_0x2225e6(0x15a)][_0x2225e6(0x141)]?.[_0x2225e6(0x13f)]()===_0x2225e6(0x18a)&&console[_0x2225e6(0x12b)](_0x2225e6(0x19c));return{'status':_0x4fc650,'amount':parseFloat(_0x182768['data'][_0x2225e6(0x162)])||undefined,'currency':_0x182768[_0x2225e6(0x15a)][_0x2225e6(0x129)]||_0x2225e6(0x166),'paymentDetails':_0x1d6303};}catch(_0x5818f1){console[_0x2225e6(0x155)](_0x2225e6(0x157),_0x5818f1),loggerService_1[_0x2225e6(0x11b)][_0x2225e6(0x127)]('cointopay',_0x2225e6(0x17e),_0x5818f1);throw new Error(_0x2225e6(0x164)+(_0x5818f1 instanceof Error?_0x5818f1[_0x2225e6(0x18c)]:_0x2225e6(0x11c)));}}async[a41_0x2dbea9(0x121)](_0x51aff2){const _0x1e5084=a41_0x2dbea9,_0x2c3a1d=await this[_0x1e5084(0x161)](_0x51aff2);return{'status':_0x2c3a1d[_0x1e5084(0x181)],'amount':_0x2c3a1d[_0x1e5084(0x14b)],'currency':_0x2c3a1d[_0x1e5084(0x16e)]};}async[a41_0x2dbea9(0x18b)](_0x151d05){const _0x2c81d6=a41_0x2dbea9;console[_0x2c81d6(0x12b)](_0x2c81d6(0x120),_0x151d05);let _0x2f3761=_0x2c81d6(0x182);switch(_0x151d05['status']?.['toLowerCase']()){case'paid':_0x2f3761=_0x2c81d6(0x195);break;case'cancelled':case _0x2c81d6(0x179):case _0x2c81d6(0x155):_0x2f3761=_0x2c81d6(0x17a);break;case _0x2c81d6(0x142):case _0x2c81d6(0x14d):_0x2f3761='EXPIRED';break;case _0x2c81d6(0x14a):case _0x2c81d6(0x167):case'awaiting\x20fiat':case _0x2c81d6(0x144):default:_0x2f3761=_0x2c81d6(0x182);break;}return{'paymentId':_0x151d05[_0x2c81d6(0x14e)]||_0x151d05[_0x2c81d6(0x154)]||'','status':_0x2f3761,'amount':_0x151d05[_0x2c81d6(0x14b)],'currency':_0x151d05[_0x2c81d6(0x16e)]||_0x2c81d6(0x166)};}}function a41_0x2323(){const _0x5cce03=['apiUrl','CreatedOn','awaiting\x20fiat','CoinToPay\x20API\x20error:\x20','2319270BgaZxd','payment_url','fromEntries','createPaymentLink','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','🏦\x20Payment\x20Detail:','failed','FAILED','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','gateway_payment_id','/status','CoinToPayService','1318956cCCyBe','status','PENDING','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','IBAN:','application/json','5888220RhhVAa','match','logWhiteDomainRequest','paid','processWebhook','message','Raw\x20Response\x20Body:','\x20EUR','Confirmed\x20On:','Amount:','defineProperty','cointopay','cancelled','not\x20confirmed','PAID','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','9694560TuKULZ','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','/create','Unknown\x20error\x20from\x20CoinToPay\x20API','Parsed\x20Result:','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','POST','CoinToPay\x20status\x20API\x20error:\x20','Currency:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Status:','===\x20COINTOPAY\x20API\x20ERROR\x20===','Status\x20Text:','loggerService','Unknown\x20error','Status\x20API\x20Error:\x20','TransactionConfirmedOn','Response\x20Body:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','verifyPayment','statusText','success','Error\x20Message:','__esModule','5nLQLeq','logWhiteDomainError','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','inputCurrency','statusUrl','log','HTTP\x20','../loggerService','Transaction\x20ID:','🏦\x20Extracted\x20IBAN:','129hXrdDD','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','coinAddress','Response\x20Time:','logWhiteDomainResponse','stack','JSON\x20Parse\x20Error:\x20','URL:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','status_code','Missing\x20data\x20in\x20response','now','parse','HTTP\x20Status:','HTTP\x20error!\x20status:\x20','toLowerCase','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Status','expired','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','created','13563720wnaIld','EXPIRED','headers','QRCodeURL','text','pending','amount','PaymentDetail','timeout','order_id','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Request\x20Body:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Response\x20data:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','merchant_reference_id','error','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','4364486YmCXtg','TransactionID','data','66732geIhUo','Gateway\x20Payment\x20ID:','result','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Error\x20details:','not\x20found','checkPaymentStatus','Amount','Error\x20stack:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Failed\x20to\x20parse\x20JSON\x20response:','EUR','waiting','TesSoft\x20Payment\x20System/1.0','stringify','Error\x20message:','Result:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Payment\x20URL:','currency'];a41_0x2323=function(){return _0x5cce03;};return a41_0x2323();}exports[a41_0x2dbea9(0x17f)]=CoinToPayService;