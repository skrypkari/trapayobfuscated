'use strict';const a61_0xe9bba4=a61_0x53a3;(function(_0x3196c7,_0x36f384){const _0x246efd=a61_0x53a3,_0x4f419a=_0x3196c7();while(!![]){try{const _0x45014e=parseInt(_0x246efd(0x138))/0x1+parseInt(_0x246efd(0x135))/0x2+-parseInt(_0x246efd(0xf3))/0x3+-parseInt(_0x246efd(0x15b))/0x4*(parseInt(_0x246efd(0x10c))/0x5)+parseInt(_0x246efd(0x153))/0x6+-parseInt(_0x246efd(0x15f))/0x7*(parseInt(_0x246efd(0x165))/0x8)+-parseInt(_0x246efd(0x112))/0x9*(-parseInt(_0x246efd(0xf1))/0xa);if(_0x45014e===_0x36f384)break;else _0x4f419a['push'](_0x4f419a['shift']());}catch(_0x398acd){_0x4f419a['push'](_0x4f419a['shift']());}}}(a61_0x48be,0x18798));Object[a61_0xe9bba4(0x114)](exports,a61_0xe9bba4(0x147),{'value':!![]}),exports[a61_0xe9bba4(0x109)]=void 0x0;const loggerService_1=require(a61_0xe9bba4(0x137));function a61_0x53a3(_0x2c3b32,_0x54fdad){_0x2c3b32=_0x2c3b32-0xf0;const _0x48be6c=a61_0x48be();let _0x53a35d=_0x48be6c[_0x2c3b32];return _0x53a35d;}function a61_0x48be(){const _0x47e32b=['TransactionConfirmedOn','EXPIRED','1949590hQqHJg','gateway_payment_id','548394YFRnqa','cointopay','Incomplete\x20response:\x20missing\x20data','not\x20confirmed','TransactionID','failed','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Currency:','expired','awaiting\x20fiat','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','coinAddress','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','cancelled','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20',',\x20body:\x20','Payment\x20System/1.0','statusText','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Missing\x20data\x20in\x20response','data','CoinToPayService','Parsed\x20Result:','/status','561380PFtxWA','Response\x20data:','Failed\x20to\x20parse\x20JSON\x20response:','Status','message','Error\x20message:','9ygelmB','checkPaymentStatus','defineProperty','payment_url','loggerService','currency','Unknown\x20error','Headers:','paid','CreatedOn','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','fromEntries','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','inputCurrency','timeout','PaymentDetail','stack','pending','ðŸ“Š\x20Status\x20check\x20URL:','now','success','Amount:','apiUrl','PENDING','Payment\x20Status:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','log','parse','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','waiting','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','/create','entries','status_code','\x20EUR','258346VxviNJ','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','../loggerService','138884OdBJwl','FAILED','Response\x20Body:','stringify','HTTP\x20','processWebhook','Response\x20Time:','Status\x20Text:','CoinToPay\x20API\x20error:\x20','status','Business\x20Error:\x20','Status:','match','error','POST','__esModule','result','logWhiteDomainResponse','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','application/json','&alternative=false','ExpiryTime','JSON\x20Parse\x20Error:\x20','QRCodeURL','EUR','===\x20COINTOPAY\x20API\x20ERROR\x20===','statusUrl','730710mibIBv','merchant_reference_id','Status\x20API\x20Error:\x20','not\x20found','text','Confirmed\x20On:','createPaymentLink','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','4XBVyxn','logWhiteDomainError','Unknown\x20error\x20from\x20CoinToPay\x20API','Amount','7FNfwMj','CoinToPay\x20payment\x20status\x20check\x20error:','HTTP\x20error!\x20status:\x20','CoinToPay\x20status\x20API\x20error:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','1515832HenCQL','Error\x20stack:','logWhiteDomainRequest','Error\x20Message:','ðŸ¦\x20Extracted\x20IBAN:','Created\x20On:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Transaction\x20ID:','toLowerCase','Raw\x20Response\x20Body:','PAID','HTTP\x20Status:','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20details:','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Result:','ðŸ¦\x20Payment\x20Detail:'];a61_0x48be=function(){return _0x47e32b;};return a61_0x48be();}class CoinToPayService{constructor(){const _0x4c6ab1=a61_0xe9bba4;this[_0x4c6ab1(0x128)]='https://tesoft.uk/gateway/cointopay/',this[_0x4c6ab1(0x152)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x4c6ab1(0x12c)](_0x4c6ab1(0x171)),console[_0x4c6ab1(0x12c)](_0x4c6ab1(0x124),this[_0x4c6ab1(0x152)]);}async[a61_0xe9bba4(0x159)](_0x3911fc){const _0x150c9e=a61_0xe9bba4,{orderId:_0x195be2,amount:_0x13c477}=_0x3911fc;console[_0x150c9e(0x12c)](_0x150c9e(0x164)+_0x13c477+_0x150c9e(0x134));const _0x433655={'amount':_0x13c477},_0x381d33=Date[_0x150c9e(0x125)]();try{console[_0x150c9e(0x12c)](_0x150c9e(0xfd)),console[_0x150c9e(0x12c)]('URL:',this[_0x150c9e(0x128)]),console[_0x150c9e(0x12c)]('Request\x20Body:',JSON[_0x150c9e(0x13b)](_0x433655,null,0x2)),console[_0x150c9e(0x12c)]('Amount:',_0x13c477,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x150c9e(0x116)][_0x150c9e(0x167)]('cointopay',_0x150c9e(0x131),_0x150c9e(0x146),_0x433655);const _0x3bce44=await fetch(this['apiUrl'],{'method':_0x150c9e(0x146),'headers':{'Content-Type':_0x150c9e(0x14b),'Accept':_0x150c9e(0x14b),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x150c9e(0x13b)](_0x433655)}),_0x23c8f2=Date[_0x150c9e(0x125)]()-_0x381d33;console['log'](_0x150c9e(0x130)),console[_0x150c9e(0x12c)](_0x150c9e(0x143),_0x3bce44[_0x150c9e(0x141)]),console[_0x150c9e(0x12c)](_0x150c9e(0x13f),_0x3bce44[_0x150c9e(0x104)]),console[_0x150c9e(0x12c)](_0x150c9e(0x119),Object[_0x150c9e(0x11d)](_0x3bce44['headers'][_0x150c9e(0x132)]())),console[_0x150c9e(0x12c)](_0x150c9e(0x13e),_0x23c8f2+'ms');const _0x1f8df8=await _0x3bce44[_0x150c9e(0x157)]();console['log'](_0x150c9e(0x16e),_0x1f8df8);if(!_0x3bce44['ok']){console[_0x150c9e(0x145)](_0x150c9e(0x151)),console[_0x150c9e(0x145)]('HTTP\x20Status:',_0x3bce44[_0x150c9e(0x141)]),console[_0x150c9e(0x145)](_0x150c9e(0x13a),_0x1f8df8),loggerService_1[_0x150c9e(0x116)][_0x150c9e(0x149)](_0x150c9e(0xf4),_0x150c9e(0x131),_0x3bce44[_0x150c9e(0x141)],_0x1f8df8,_0x23c8f2),loggerService_1[_0x150c9e(0x116)][_0x150c9e(0x15c)]('cointopay','/create','HTTP\x20'+_0x3bce44[_0x150c9e(0x141)]+':\x20'+_0x1f8df8);throw new Error(_0x150c9e(0x161)+_0x3bce44[_0x150c9e(0x141)]+_0x150c9e(0x102)+_0x1f8df8);}let _0x4e8ac9;try{_0x4e8ac9=JSON[_0x150c9e(0x12d)](_0x1f8df8);}catch(_0x4be759){console[_0x150c9e(0x145)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x4be759),loggerService_1[_0x150c9e(0x116)][_0x150c9e(0x15c)](_0x150c9e(0xf4),_0x150c9e(0x131),'JSON\x20Parse\x20Error:\x20'+_0x4be759);throw new Error(_0x150c9e(0x12e)+_0x1f8df8);}console['log'](_0x150c9e(0x163)),console['log'](_0x150c9e(0x10a),JSON[_0x150c9e(0x13b)](_0x4e8ac9,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x150c9e(0xf4),'/create',_0x3bce44[_0x150c9e(0x141)],_0x4e8ac9,_0x23c8f2);if(_0x4e8ac9[_0x150c9e(0x145)]){const _0x71ac3e=_0x4e8ac9[_0x150c9e(0x110)]||_0x4e8ac9[_0x150c9e(0x145)]||_0x150c9e(0x15d);console[_0x150c9e(0x145)](_0x150c9e(0x12b)),console['error'](_0x150c9e(0x168),_0x71ac3e),loggerService_1[_0x150c9e(0x116)][_0x150c9e(0x15c)](_0x150c9e(0xf4),_0x150c9e(0x131),_0x150c9e(0x142)+_0x71ac3e);throw new Error(_0x150c9e(0x140)+_0x71ac3e);}if(!_0x4e8ac9[_0x150c9e(0x115)]||!_0x4e8ac9['gateway_payment_id']){console[_0x150c9e(0x145)](_0x150c9e(0x15a)),console[_0x150c9e(0x145)](_0x150c9e(0x106)),console[_0x150c9e(0x145)](_0x150c9e(0x10d),_0x4e8ac9),loggerService_1['loggerService']['logWhiteDomainError'](_0x150c9e(0xf4),_0x150c9e(0x131),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x150c9e(0x12c)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x150c9e(0x12c)]('Gateway\x20Payment\x20ID:',_0x4e8ac9[_0x150c9e(0xf2)]),console[_0x150c9e(0x12c)]('Payment\x20URL\x20(original):',_0x4e8ac9[_0x150c9e(0x115)]);const _0x4e5394=_0x4e8ac9['payment_url']+_0x150c9e(0x14c);return console['log']('Payment\x20URL\x20(modified):',_0x4e5394),console[_0x150c9e(0x12c)]('Amount:',_0x13c477,_0x150c9e(0x150)),{'gateway_payment_id':_0x4e8ac9[_0x150c9e(0xf2)],'payment_url':_0x4e5394};}catch(_0x377bc0){console[_0x150c9e(0x145)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console['error'](_0x150c9e(0x172),_0x377bc0),loggerService_1['loggerService'][_0x150c9e(0x15c)](_0x150c9e(0xf4),_0x150c9e(0x131),_0x377bc0);if(_0x377bc0 instanceof Error){console[_0x150c9e(0x145)](_0x150c9e(0x111),_0x377bc0[_0x150c9e(0x110)]),console[_0x150c9e(0x145)](_0x150c9e(0x166),_0x377bc0[_0x150c9e(0x122)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x377bc0[_0x150c9e(0x110)]);}throw new Error(_0x150c9e(0x11c));}}async['checkPaymentStatus'](_0x171a93){const _0x554a0c=a61_0xe9bba4,_0x44be42=Date['now']();try{console[_0x554a0c(0x12c)](_0x554a0c(0x101)+_0x171a93);const _0x3fffc0={'gatewayPaymentId':_0x171a93};loggerService_1['loggerService'][_0x554a0c(0x167)](_0x554a0c(0xf4),_0x554a0c(0x10b),_0x554a0c(0x146),_0x3fffc0);const _0xe6b971=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0x554a0c(0x14b),'Accept':'application/json','User-Agent':_0x554a0c(0x103)},'body':JSON[_0x554a0c(0x13b)](_0x3fffc0)}),_0x5f42b3=Date[_0x554a0c(0x125)]()-_0x44be42;console[_0x554a0c(0x12c)](_0x554a0c(0xf9)),console[_0x554a0c(0x12c)]('Status:',_0xe6b971[_0x554a0c(0x141)]),console['log']('Response\x20Time:',_0x5f42b3+'ms');if(!_0xe6b971['ok']){const _0x40e292=await _0xe6b971['text']();console['error'](_0x554a0c(0x170),_0xe6b971[_0x554a0c(0x141)]),console[_0x554a0c(0x145)]('Response\x20Body:',_0x40e292),loggerService_1[_0x554a0c(0x116)][_0x554a0c(0x149)](_0x554a0c(0xf4),'/status',_0xe6b971[_0x554a0c(0x141)],_0x40e292,_0x5f42b3),loggerService_1[_0x554a0c(0x116)][_0x554a0c(0x15c)]('cointopay',_0x554a0c(0x10b),_0x554a0c(0x13c)+_0xe6b971[_0x554a0c(0x141)]+':\x20'+_0x40e292);throw new Error(_0x554a0c(0x161)+_0xe6b971[_0x554a0c(0x141)]);}const _0x134366=await _0xe6b971['text']();console[_0x554a0c(0x12c)]('Raw\x20Response\x20Body:',_0x134366);let _0x552866;try{_0x552866=JSON[_0x554a0c(0x12d)](_0x134366);}catch(_0x3339ea){console[_0x554a0c(0x145)](_0x554a0c(0x10e),_0x3339ea),loggerService_1[_0x554a0c(0x116)][_0x554a0c(0x15c)]('cointopay',_0x554a0c(0x10b),_0x554a0c(0x14e)+_0x3339ea);throw new Error(_0x554a0c(0x11e)+_0x134366);}loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay','/status',_0xe6b971['status'],_0x552866,_0x5f42b3),console[_0x554a0c(0x12c)](_0x554a0c(0x14a)),console[_0x554a0c(0x12c)](_0x554a0c(0x175),_0x552866[_0x554a0c(0x148)]),console[_0x554a0c(0x12c)]('Status\x20Code:',_0x552866[_0x554a0c(0x133)]),console[_0x554a0c(0x12c)](_0x554a0c(0x12a),_0x552866[_0x554a0c(0x108)]?.[_0x554a0c(0x10f)]),console[_0x554a0c(0x12c)](_0x554a0c(0x127),_0x552866[_0x554a0c(0x108)]?.[_0x554a0c(0x15e)]),console[_0x554a0c(0x12c)](_0x554a0c(0xfa),_0x552866[_0x554a0c(0x108)]?.[_0x554a0c(0x11f)]);if(_0x552866['result']!==_0x554a0c(0x126)||_0x552866[_0x554a0c(0x133)]!==0xc8){const _0x52a657=_0x552866[_0x554a0c(0x110)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error'](_0x554a0c(0x16b)),console['error'](_0x554a0c(0x168),_0x52a657),loggerService_1[_0x554a0c(0x116)][_0x554a0c(0x15c)](_0x554a0c(0xf4),'/status',_0x554a0c(0x155)+_0x52a657);throw new Error(_0x554a0c(0x162)+_0x52a657);}if(!_0x552866['data']){console[_0x554a0c(0x145)](_0x554a0c(0xff)),console['error'](_0x554a0c(0x107)),loggerService_1[_0x554a0c(0x116)][_0x554a0c(0x15c)]('cointopay',_0x554a0c(0x10b),_0x554a0c(0xf5));throw new Error(_0x554a0c(0x136));}let _0x3c241b=_0x554a0c(0x129);switch(_0x552866[_0x554a0c(0x108)][_0x554a0c(0x10f)]?.['toLowerCase']()){case _0x554a0c(0x11a):_0x3c241b=_0x554a0c(0x16f);break;case _0x554a0c(0x100):case _0x554a0c(0xf8):case'error':_0x3c241b='FAILED';break;case _0x554a0c(0xfb):case _0x554a0c(0x120):_0x3c241b=_0x554a0c(0xf0);break;case _0x554a0c(0x12f):case _0x554a0c(0xfc):case _0x554a0c(0x123):case'created':default:_0x3c241b=_0x554a0c(0x129);break;}let _0x516283,_0x17367c;if(_0x552866['data']['PaymentDetail']){const _0x4629c6=_0x552866[_0x554a0c(0x108)][_0x554a0c(0x121)];console[_0x554a0c(0x12c)](_0x554a0c(0x176),_0x4629c6);const _0x464f54=_0x4629c6[_0x554a0c(0x144)](/IBAN\s+([A-Z0-9]+)/i);_0x464f54&&(_0x516283=_0x464f54[0x1],console[_0x554a0c(0x12c)](_0x554a0c(0x169),_0x516283)),_0x17367c=_0x4629c6;}const _0x15b72b={'iban':_0x516283,'bankDetails':_0x17367c,'transactionId':_0x552866[_0x554a0c(0x108)][_0x554a0c(0xf7)],'coinAddress':_0x552866[_0x554a0c(0x108)][_0x554a0c(0xfe)],'qrCodeUrl':_0x552866[_0x554a0c(0x108)][_0x554a0c(0x14f)],'expiryTime':_0x552866[_0x554a0c(0x108)][_0x554a0c(0x14d)],'createdOn':_0x552866['data'][_0x554a0c(0x11b)],'confirmedOn':_0x552866[_0x554a0c(0x108)][_0x554a0c(0x177)]};console[_0x554a0c(0x12c)](_0x554a0c(0x105)),console[_0x554a0c(0x12c)](_0x554a0c(0x143),_0x552866[_0x554a0c(0x108)][_0x554a0c(0x10f)],'->',_0x3c241b),console['log'](_0x554a0c(0x127),_0x552866[_0x554a0c(0x108)]['Amount'],_0x552866[_0x554a0c(0x108)]['inputCurrency']),console[_0x554a0c(0x12c)](_0x554a0c(0x16c),_0x552866['data'][_0x554a0c(0xf7)]),console['log']('IBAN:',_0x516283||_0x554a0c(0x156)),console[_0x554a0c(0x12c)](_0x554a0c(0x16a),_0x552866['data'][_0x554a0c(0x11b)]),console[_0x554a0c(0x12c)](_0x554a0c(0x158),_0x552866['data'][_0x554a0c(0x177)]||_0x554a0c(0xf6));if(_0x552866[_0x554a0c(0x108)][_0x554a0c(0x10f)]?.[_0x554a0c(0x16d)]()===_0x554a0c(0xfc))console[_0x554a0c(0x12c)]('ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x552866[_0x554a0c(0x108)]['Status']?.[_0x554a0c(0x16d)]()===_0x554a0c(0x11a)&&console[_0x554a0c(0x12c)](_0x554a0c(0x173));return{'status':_0x3c241b,'amount':parseFloat(_0x552866['data'][_0x554a0c(0x15e)])||undefined,'currency':_0x552866[_0x554a0c(0x108)][_0x554a0c(0x11f)]||_0x554a0c(0x150),'paymentDetails':_0x15b72b};}catch(_0x2c72da){console[_0x554a0c(0x145)](_0x554a0c(0x160),_0x2c72da),loggerService_1[_0x554a0c(0x116)][_0x554a0c(0x15c)](_0x554a0c(0xf4),_0x554a0c(0x10b),_0x2c72da);throw new Error(_0x554a0c(0x174)+(_0x2c72da instanceof Error?_0x2c72da[_0x554a0c(0x110)]:_0x554a0c(0x118)));}}async['verifyPayment'](_0xda97df){const _0x2cfef7=a61_0xe9bba4,_0x7b6f48=await this[_0x2cfef7(0x113)](_0xda97df);return{'status':_0x7b6f48[_0x2cfef7(0x141)],'amount':_0x7b6f48['amount'],'currency':_0x7b6f48['currency']};}async[a61_0xe9bba4(0x13d)](_0x85468c){const _0x50f600=a61_0xe9bba4;console[_0x50f600(0x12c)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x85468c);let _0x1d5312=_0x50f600(0x129);switch(_0x85468c[_0x50f600(0x141)]?.[_0x50f600(0x16d)]()){case _0x50f600(0x11a):_0x1d5312=_0x50f600(0x16f);break;case _0x50f600(0x100):case'failed':case _0x50f600(0x145):_0x1d5312=_0x50f600(0x139);break;case _0x50f600(0xfb):case'timeout':_0x1d5312=_0x50f600(0xf0);break;case _0x50f600(0x123):case _0x50f600(0x12f):case'awaiting\x20fiat':case'created':default:_0x1d5312='PENDING';break;}return{'paymentId':_0x85468c['order_id']||_0x85468c[_0x50f600(0x154)]||'','status':_0x1d5312,'amount':_0x85468c['amount'],'currency':_0x85468c[_0x50f600(0x117)]||'EUR'};}}exports[a61_0xe9bba4(0x109)]=CoinToPayService;