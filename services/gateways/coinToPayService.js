'use strict';const a40_0x1ceec5=a40_0x2b5f;(function(_0x235c07,_0x280b5d){const _0x448dc3=a40_0x2b5f,_0x2e1d80=_0x235c07();while(!![]){try{const _0x371a11=-parseInt(_0x448dc3(0xe1))/0x1+-parseInt(_0x448dc3(0xa3))/0x2+-parseInt(_0x448dc3(0xbe))/0x3+-parseInt(_0x448dc3(0x9c))/0x4*(parseInt(_0x448dc3(0x7c))/0x5)+-parseInt(_0x448dc3(0x92))/0x6*(-parseInt(_0x448dc3(0x77))/0x7)+parseInt(_0x448dc3(0x7a))/0x8*(parseInt(_0x448dc3(0xe3))/0x9)+-parseInt(_0x448dc3(0x87))/0xa*(-parseInt(_0x448dc3(0xac))/0xb);if(_0x371a11===_0x280b5d)break;else _0x2e1d80['push'](_0x2e1d80['shift']());}catch(_0xb80fcd){_0x2e1d80['push'](_0x2e1d80['shift']());}}}(a40_0x3ca2,0xe2352));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a40_0x1ceec5(0x73)]=void 0x0;const loggerService_1=require(a40_0x1ceec5(0xa4));function a40_0x3ca2(){const _0x10f554=['CoinToPayService','HTTP\x20error!\x20status:\x20','Error\x20stack:','message','7JJfFuP','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','gateway_payment_id','3800tgymmN','expired','5695uMRZlf','HTTP\x20','Status','Response\x20Time:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20details:','failed','statusUrl','Response\x20Body:','CreatedOn','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','10ajbPRm','/create','cancelled','HTTP\x20Status:','Response\x20data:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Currency:','processWebhook','timeout','Unknown\x20error','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','9077190SYUTrO','Status\x20Text:','Request\x20Body:','üè¶\x20Extracted\x20IBAN:','logWhiteDomainError','EUR','data','not\x20confirmed','POST','awaiting\x20fiat','1616DvVtFu','status','text','not\x20found','PaymentDetail','Amount','parse','3236380zOeoOa','../loggerService','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','verifyPayment','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','cointopay','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','application/json','26149937dUYfYh','apiUrl','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','TesSoft\x20Payment\x20System/1.0','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainResponse','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','waiting','Missing\x20data\x20in\x20response','currency','statusText','Business\x20Error:\x20','payment_url','üìä\x20Status\x20check\x20URL:','error','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','CoinToPay\x20status\x20API\x20error:\x20','991764YLanUi','FAILED','amount','Error\x20message:','pending','Amount:','CoinToPay\x20API\x20error:\x20','status_code','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','TransactionID','QRCodeURL','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Headers:','loggerService','IBAN:','log','===\x20COINTOPAY\x20SUCCESS\x20===','\x20EUR','ExpiryTime','Raw\x20Response\x20Body:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Status\x20Code:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','TransactionConfirmedOn','Gateway\x20Payment\x20ID:','Error\x20Message:','now','logWhiteDomainRequest','EXPIRED','Failed\x20to\x20parse\x20JSON\x20response:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','paid','result','match','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','1844752TcABeI','order_id','24444edACQg','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','toLowerCase','Status:','stringify','created','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','PENDING','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','checkPaymentStatus','inputCurrency','/status','Status\x20API\x20Error:\x20','JSON\x20Parse\x20Error:\x20'];a40_0x3ca2=function(){return _0x10f554;};return a40_0x3ca2();}class CoinToPayService{constructor(){const _0x5c4354=a40_0x1ceec5;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this['statusUrl']='https://tesoft.uk/gateway/cointopay/status.php',console['log'](_0x5c4354(0x80)),console['log'](_0x5c4354(0xba),this[_0x5c4354(0x83)]);}async['createPaymentLink'](_0x54e812){const _0x5c8486=a40_0x1ceec5,{orderId:_0x548217,amount:_0x52bb7d}=_0x54e812;console[_0x5c8486(0xcd)](_0x5c8486(0xb3)+_0x52bb7d+_0x5c8486(0xcf));const _0x4f29f2={'amount':_0x52bb7d},_0x5a7eb6=Date[_0x5c8486(0xd8)]();try{console['log'](_0x5c8486(0xd2)),console[_0x5c8486(0xcd)]('URL:',this['apiUrl']),console[_0x5c8486(0xcd)](_0x5c8486(0x94),JSON[_0x5c8486(0x69)](_0x4f29f2,null,0x2)),console[_0x5c8486(0xcd)]('Amount:',_0x52bb7d,_0x5c8486(0x6d)),loggerService_1['loggerService'][_0x5c8486(0xd9)]('cointopay',_0x5c8486(0x88),'POST',_0x4f29f2);const _0x3b751e=await fetch(this[_0x5c8486(0xad)],{'method':_0x5c8486(0x9a),'headers':{'Content-Type':_0x5c8486(0xab),'Accept':_0x5c8486(0xab),'User-Agent':_0x5c8486(0xaf)},'body':JSON[_0x5c8486(0x69)](_0x4f29f2)}),_0x4dc2bd=Date[_0x5c8486(0xd8)]()-_0x5a7eb6;console[_0x5c8486(0xcd)](_0x5c8486(0xc9)),console[_0x5c8486(0xcd)](_0x5c8486(0x68),_0x3b751e[_0x5c8486(0x9d)]),console[_0x5c8486(0xcd)](_0x5c8486(0x93),_0x3b751e[_0x5c8486(0xb7)]),console['log'](_0x5c8486(0xca),Object['fromEntries'](_0x3b751e['headers']['entries']())),console[_0x5c8486(0xcd)](_0x5c8486(0x7f),_0x4dc2bd+'ms');const _0xd1bb62=await _0x3b751e[_0x5c8486(0x9e)]();console[_0x5c8486(0xcd)](_0x5c8486(0xd1),_0xd1bb62);if(!_0x3b751e['ok']){console[_0x5c8486(0xbb)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x5c8486(0xbb)](_0x5c8486(0x8a),_0x3b751e[_0x5c8486(0x9d)]),console[_0x5c8486(0xbb)](_0x5c8486(0x84),_0xd1bb62),loggerService_1[_0x5c8486(0xcb)]['logWhiteDomainResponse'](_0x5c8486(0xa9),_0x5c8486(0x88),_0x3b751e[_0x5c8486(0x9d)],_0xd1bb62,_0x4dc2bd),loggerService_1[_0x5c8486(0xcb)][_0x5c8486(0x96)](_0x5c8486(0xa9),_0x5c8486(0x88),_0x5c8486(0x7d)+_0x3b751e[_0x5c8486(0x9d)]+':\x20'+_0xd1bb62);throw new Error(_0x5c8486(0x74)+_0x3b751e['status']+',\x20body:\x20'+_0xd1bb62);}let _0x239b56;try{_0x239b56=JSON['parse'](_0xd1bb62);}catch(_0xdcdd1a){console[_0x5c8486(0xbb)]('Failed\x20to\x20parse\x20JSON\x20response:',_0xdcdd1a),loggerService_1[_0x5c8486(0xcb)][_0x5c8486(0x96)](_0x5c8486(0xa9),'/create',_0x5c8486(0x72)+_0xdcdd1a);throw new Error(_0x5c8486(0xbc)+_0xd1bb62);}console[_0x5c8486(0xcd)](_0x5c8486(0x8c)),console[_0x5c8486(0xcd)]('Parsed\x20Result:',JSON[_0x5c8486(0x69)](_0x239b56,null,0x2)),loggerService_1[_0x5c8486(0xcb)][_0x5c8486(0xb1)](_0x5c8486(0xa9),_0x5c8486(0x88),_0x3b751e['status'],_0x239b56,_0x4dc2bd);if(_0x239b56[_0x5c8486(0xbb)]){const _0x1f95be=_0x239b56[_0x5c8486(0x76)]||_0x239b56[_0x5c8486(0xbb)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x5c8486(0xbb)](_0x5c8486(0xa8)),console[_0x5c8486(0xbb)](_0x5c8486(0xd7),_0x1f95be),loggerService_1[_0x5c8486(0xcb)][_0x5c8486(0x96)](_0x5c8486(0xa9),'/create',_0x5c8486(0xb8)+_0x1f95be);throw new Error(_0x5c8486(0xc4)+_0x1f95be);}if(!_0x239b56[_0x5c8486(0xb9)]||!_0x239b56['gateway_payment_id']){console['error'](_0x5c8486(0xb0)),console['error'](_0x5c8486(0xb2)),console[_0x5c8486(0xbb)](_0x5c8486(0x8b),_0x239b56),loggerService_1[_0x5c8486(0xcb)][_0x5c8486(0x96)](_0x5c8486(0xa9),_0x5c8486(0x88),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x5c8486(0x6b));}return console['log'](_0x5c8486(0xce)),console[_0x5c8486(0xcd)](_0x5c8486(0xd6),_0x239b56[_0x5c8486(0x79)]),console[_0x5c8486(0xcd)]('Payment\x20URL:',_0x239b56[_0x5c8486(0xb9)]),console[_0x5c8486(0xcd)]('Amount:',_0x52bb7d,_0x5c8486(0x97)),{'gateway_payment_id':_0x239b56[_0x5c8486(0x79)],'payment_url':_0x239b56[_0x5c8486(0xb9)]};}catch(_0x2ee74d){console[_0x5c8486(0xbb)](_0x5c8486(0x78)),console[_0x5c8486(0xbb)](_0x5c8486(0x81),_0x2ee74d),loggerService_1[_0x5c8486(0xcb)][_0x5c8486(0x96)](_0x5c8486(0xa9),'/create',_0x2ee74d);if(_0x2ee74d instanceof Error){console[_0x5c8486(0xbb)](_0x5c8486(0xc1),_0x2ee74d[_0x5c8486(0x76)]),console[_0x5c8486(0xbb)](_0x5c8486(0x75),_0x2ee74d['stack']);throw new Error(_0x5c8486(0xa5)+_0x2ee74d[_0x5c8486(0x76)]);}throw new Error(_0x5c8486(0xe0));}}async[a40_0x1ceec5(0x6e)](_0x2a9f0c){const _0x3a1811=a40_0x1ceec5,_0x128387=Date['now']();try{console['log']('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x2a9f0c);const _0x88c559={'gatewayPaymentId':_0x2a9f0c};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x3a1811(0xa9),'/status',_0x3a1811(0x9a),_0x88c559);const _0x108696=await fetch(this['statusUrl'],{'method':_0x3a1811(0x9a),'headers':{'Content-Type':_0x3a1811(0xab),'Accept':_0x3a1811(0xab),'User-Agent':_0x3a1811(0xaf)},'body':JSON[_0x3a1811(0x69)](_0x88c559)}),_0x4ecc08=Date[_0x3a1811(0xd8)]()-_0x128387;console[_0x3a1811(0xcd)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x3a1811(0xcd)](_0x3a1811(0x68),_0x108696[_0x3a1811(0x9d)]),console[_0x3a1811(0xcd)](_0x3a1811(0x7f),_0x4ecc08+'ms');if(!_0x108696['ok']){const _0x1d878a=await _0x108696['text']();console[_0x3a1811(0xbb)](_0x3a1811(0x8a),_0x108696[_0x3a1811(0x9d)]),console[_0x3a1811(0xbb)](_0x3a1811(0x84),_0x1d878a),loggerService_1[_0x3a1811(0xcb)][_0x3a1811(0xb1)](_0x3a1811(0xa9),_0x3a1811(0x70),_0x108696[_0x3a1811(0x9d)],_0x1d878a,_0x4ecc08),loggerService_1[_0x3a1811(0xcb)]['logWhiteDomainError'](_0x3a1811(0xa9),_0x3a1811(0x70),_0x3a1811(0x7d)+_0x108696[_0x3a1811(0x9d)]+':\x20'+_0x1d878a);throw new Error(_0x3a1811(0x74)+_0x108696['status']);}const _0x5ea82b=await _0x108696[_0x3a1811(0x9e)]();console[_0x3a1811(0xcd)](_0x3a1811(0xd1),_0x5ea82b);let _0xde747e;try{_0xde747e=JSON[_0x3a1811(0xa2)](_0x5ea82b);}catch(_0x12faf2){console[_0x3a1811(0xbb)](_0x3a1811(0xdb),_0x12faf2),loggerService_1[_0x3a1811(0xcb)][_0x3a1811(0x96)]('cointopay','/status',_0x3a1811(0x72)+_0x12faf2);throw new Error(_0x3a1811(0xa6)+_0x5ea82b);}loggerService_1[_0x3a1811(0xcb)][_0x3a1811(0xb1)](_0x3a1811(0xa9),_0x3a1811(0x70),_0x108696[_0x3a1811(0x9d)],_0xde747e,_0x4ecc08),console['log'](_0x3a1811(0x91)),console[_0x3a1811(0xcd)]('Result:',_0xde747e[_0x3a1811(0xde)]),console['log'](_0x3a1811(0xd3),_0xde747e[_0x3a1811(0xc5)]),console['log']('Payment\x20Status:',_0xde747e[_0x3a1811(0x98)]?.[_0x3a1811(0x7e)]),console[_0x3a1811(0xcd)]('Amount:',_0xde747e[_0x3a1811(0x98)]?.[_0x3a1811(0xa1)]),console[_0x3a1811(0xcd)](_0x3a1811(0x8d),_0xde747e['data']?.[_0x3a1811(0x6f)]);if(_0xde747e[_0x3a1811(0xde)]!=='success'||_0xde747e[_0x3a1811(0xc5)]!==0xc8){const _0x48b445=_0xde747e[_0x3a1811(0x76)]||_0x3a1811(0xd4);console[_0x3a1811(0xbb)](_0x3a1811(0x86)),console[_0x3a1811(0xbb)]('Error\x20Message:',_0x48b445),loggerService_1[_0x3a1811(0xcb)]['logWhiteDomainError'](_0x3a1811(0xa9),'/status',_0x3a1811(0x71)+_0x48b445);throw new Error(_0x3a1811(0xbd)+_0x48b445);}if(!_0xde747e[_0x3a1811(0x98)]){console[_0x3a1811(0xbb)](_0x3a1811(0x66)),console[_0x3a1811(0xbb)](_0x3a1811(0xb5)),loggerService_1[_0x3a1811(0xcb)][_0x3a1811(0x96)]('cointopay','/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0x3a1811(0xc6));}let _0x441030=_0x3a1811(0x6c);switch(_0xde747e[_0x3a1811(0x98)][_0x3a1811(0x7e)]?.['toLowerCase']()){case _0x3a1811(0xdd):_0x441030='PAID';break;case'cancelled':case _0x3a1811(0x82):case _0x3a1811(0xbb):_0x441030='FAILED';break;case _0x3a1811(0x7b):case _0x3a1811(0x8f):_0x441030=_0x3a1811(0xda);break;case _0x3a1811(0xb4):case _0x3a1811(0x9b):case _0x3a1811(0xc2):case _0x3a1811(0x6a):default:_0x441030=_0x3a1811(0x6c);break;}let _0x447436,_0x520645;if(_0xde747e[_0x3a1811(0x98)]['PaymentDetail']){const _0x2e10a4=_0xde747e[_0x3a1811(0x98)][_0x3a1811(0xa0)];console['log']('üè¶\x20Payment\x20Detail:',_0x2e10a4);const _0x267edc=_0x2e10a4[_0x3a1811(0xdf)](/IBAN\s+([A-Z0-9]+)/i);_0x267edc&&(_0x447436=_0x267edc[0x1],console[_0x3a1811(0xcd)](_0x3a1811(0x95),_0x447436)),_0x520645=_0x2e10a4;}const _0x2dc332={'iban':_0x447436,'bankDetails':_0x520645,'transactionId':_0xde747e[_0x3a1811(0x98)][_0x3a1811(0xc7)],'coinAddress':_0xde747e[_0x3a1811(0x98)]['coinAddress'],'qrCodeUrl':_0xde747e[_0x3a1811(0x98)][_0x3a1811(0xc8)],'expiryTime':_0xde747e[_0x3a1811(0x98)][_0x3a1811(0xd0)],'createdOn':_0xde747e['data'][_0x3a1811(0x85)],'confirmedOn':_0xde747e[_0x3a1811(0x98)][_0x3a1811(0xd5)]};console[_0x3a1811(0xcd)](_0x3a1811(0xae)),console[_0x3a1811(0xcd)](_0x3a1811(0x68),_0xde747e[_0x3a1811(0x98)][_0x3a1811(0x7e)],'->',_0x441030),console[_0x3a1811(0xcd)](_0x3a1811(0xc3),_0xde747e[_0x3a1811(0x98)][_0x3a1811(0xa1)],_0xde747e['data'][_0x3a1811(0x6f)]),console[_0x3a1811(0xcd)]('Transaction\x20ID:',_0xde747e[_0x3a1811(0x98)][_0x3a1811(0xc7)]),console[_0x3a1811(0xcd)](_0x3a1811(0xcc),_0x447436||_0x3a1811(0x9f)),console['log']('Created\x20On:',_0xde747e[_0x3a1811(0x98)][_0x3a1811(0x85)]),console['log']('Confirmed\x20On:',_0xde747e['data'][_0x3a1811(0xd5)]||_0x3a1811(0x99));if(_0xde747e['data'][_0x3a1811(0x7e)]?.[_0x3a1811(0x67)]()===_0x3a1811(0x9b))console[_0x3a1811(0xcd)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0xde747e['data'][_0x3a1811(0x7e)]?.['toLowerCase']()==='paid'&&console[_0x3a1811(0xcd)](_0x3a1811(0xdc));return{'status':_0x441030,'amount':parseFloat(_0xde747e[_0x3a1811(0x98)][_0x3a1811(0xa1)])||undefined,'currency':_0xde747e[_0x3a1811(0x98)][_0x3a1811(0x6f)]||'EUR','paymentDetails':_0x2dc332};}catch(_0x487f2c){console[_0x3a1811(0xbb)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x487f2c),loggerService_1[_0x3a1811(0xcb)][_0x3a1811(0x96)]('cointopay',_0x3a1811(0x70),_0x487f2c);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x487f2c instanceof Error?_0x487f2c[_0x3a1811(0x76)]:_0x3a1811(0x90)));}}async[a40_0x1ceec5(0xa7)](_0x68b665){const _0x217438=a40_0x1ceec5,_0x58546f=await this[_0x217438(0x6e)](_0x68b665);return{'status':_0x58546f[_0x217438(0x9d)],'amount':_0x58546f[_0x217438(0xc0)],'currency':_0x58546f[_0x217438(0xb6)]};}async[a40_0x1ceec5(0x8e)](_0x39c91a){const _0x1cee4f=a40_0x1ceec5;console[_0x1cee4f(0xcd)](_0x1cee4f(0xaa),_0x39c91a);let _0x6369b0=_0x1cee4f(0x6c);switch(_0x39c91a[_0x1cee4f(0x9d)]?.['toLowerCase']()){case _0x1cee4f(0xdd):_0x6369b0='PAID';break;case _0x1cee4f(0x89):case _0x1cee4f(0x82):case _0x1cee4f(0xbb):_0x6369b0=_0x1cee4f(0xbf);break;case _0x1cee4f(0x7b):case _0x1cee4f(0x8f):_0x6369b0='EXPIRED';break;case _0x1cee4f(0xc2):case'waiting':case'awaiting\x20fiat':case _0x1cee4f(0x6a):default:_0x6369b0=_0x1cee4f(0x6c);break;}return{'paymentId':_0x39c91a[_0x1cee4f(0xe2)]||_0x39c91a['merchant_reference_id']||'','status':_0x6369b0,'amount':_0x39c91a[_0x1cee4f(0xc0)],'currency':_0x39c91a['currency']||_0x1cee4f(0x97)};}}function a40_0x2b5f(_0x17b55b,_0x24ada6){const _0x3ca2ca=a40_0x3ca2();return a40_0x2b5f=function(_0x2b5f86,_0x18b9ca){_0x2b5f86=_0x2b5f86-0x66;let _0x555110=_0x3ca2ca[_0x2b5f86];return _0x555110;},a40_0x2b5f(_0x17b55b,_0x24ada6);}exports[a40_0x1ceec5(0x73)]=CoinToPayService;